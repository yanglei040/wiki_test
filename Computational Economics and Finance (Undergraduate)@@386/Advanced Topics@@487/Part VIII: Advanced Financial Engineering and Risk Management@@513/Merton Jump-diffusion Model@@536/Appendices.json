{"hands_on_practices": [{"introduction": "To begin, we connect the theoretical parameters of the Merton model to a tangible market instrument: the variance swap. These contracts are directly linked to the realized volatility of an asset, and pricing them requires calculating the expected quadratic variation of the asset's log-returns. This exercise [@problem_id:2410146] demonstrates how the fair variance strike is a simple sum of the contributions from the continuous diffusion, represented by $\\sigma^2$, and from the stochastic jumps, providing a clear and powerful insight into how different sources of risk are priced.", "id": "2410146", "problem": "A stock price process is modeled under the risk-neutral measure as a Merton jump-diffusion. Let $S_t$ denote the stock price, and let $X_t = \\ln S_t$ denote the logarithm of the stock price. The risk-neutral dynamics of $S_t$ are given by\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - q - \\lambda \\kappa \\right) dt + \\sigma \\, dW_t + (J - 1) \\, dN_t,\n$$\nwhere $r$ is the continuously compounded risk-free rate, $q$ is the continuous dividend yield, $\\sigma \\ge 0$ is the diffusion volatility, $W_t$ is a standard Brownian motion, $N_t$ is a Poisson process with intensity $\\lambda \\ge 0$, $J$ is the multiplicative jump size with $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$ independent of $W_t$ and $N_t$, and $\\kappa = \\mathbb{E}[J - 1] = e^{\\mu_J + \\tfrac{1}{2}\\delta_J^2} - 1$. All parameters are constants. Assume that all expectations are taken under the risk-neutral measure.\n\nA variance swap with maturity $T$ pays at time $T$ the payoff based on the annualized realized variance of log-returns:\n$$\n\\text{Payoff} = N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right),\n$$\nwhere $[X]_T$ is the quadratic variation of $X_t$ over $[0,T]$, $K$ is the agreed variance strike (as a decimal, not a percentage), and $N_{\\text{var}}$ is the variance notional. The time-$0$ price is the risk-neutral discounted expectation of this payoff at rate $r$.\n\nTask:\n1) Starting only from the model definition above and well-tested facts about quadratic variation and moments of a Poisson process, derive an expression for the fair annualized variance swap strike $K_{\\text{var}}$ in terms of the model parameters $(\\sigma, \\lambda, \\mu_J, \\delta_J)$.\n\n2) Use your derived expression to write a program that computes:\n- the fair strike $K_{\\text{var}}$, and\n- the time-$0$ present value $\\text{PV}_0$ of a variance swap with given agreed strike $K$ and variance notional $N_{\\text{var}}$, using the risk-neutral discount factor $e^{-rT}$, where the payoff is $N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right)$.\n\nAll inputs related to rates, volatilities, intensities, and strikes must be provided as decimals (for example, input $\\sigma = 0.2$ for a $20$ percent diffusion volatility). No physical units or angles are involved. All outputs must be rounded to $10$ decimal places.\n\nTest suite:\nUse the following five parameter sets, each specified as $(\\sigma, \\lambda, \\mu_J, \\delta_J, T, r, q, K, N_{\\text{var}})$, with all entries as decimals:\n- Case A: $(0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000)$\n- Case B: $(0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500)$\n- Case C: $(0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000)$\n- Case D: $(0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000)$\n- Case E: $(0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000)$\n\nOutput specification:\nYour program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list of floats $[K_{\\text{var}}, \\text{PV}_0]$, both rounded to $10$ decimal places. For example:\n\"[[Kvar_A,PV_A],[Kvar_B,PV_B],[Kvar_C,PV_C],[Kvar_D,PV_D],[Kvar_E,PV_E]]\".", "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n- **Model**: Merton jump-diffusion model for stock price $S_t$ under the risk-neutral measure.\n- **Stock Price Dynamics**:\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - q - \\lambda \\kappa \\right) dt + \\sigma \\, dW_t + (J - 1) \\, dN_t\n$$\n- **Log-Price**: $X_t = \\ln S_t$.\n- **Parameters**:\n  - $r$: continuously compounded risk-free rate.\n  - $q$: continuous dividend yield.\n  - $\\sigma \\ge 0$: diffusion volatility.\n  - $W_t$: standard Brownian motion.\n  - $N_t$: Poisson process with intensity $\\lambda \\ge 0$.\n  - $J$: multiplicative jump size, with $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$.\n  - $\\kappa = \\mathbb{E}[J - 1] = e^{\\mu_J + \\tfrac{1}{2}\\delta_J^2} - 1$.\n- **Assumptions**: $J$ is independent of $W_t$ and $N_t$. All expectations are under the risk-neutral measure. All parameters are constants.\n- **Variance Swap Payoff**: $N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right)$ at maturity $T$.\n  - $[X]_T$: quadratic variation of $X_t$ over $[0,T]$.\n  - $K$: agreed variance strike.\n  - $N_{\\text{var}}$: variance notional.\n- **Task 1**: Derive an expression for the fair annualized variance swap strike $K_{\\text{var}}$ in terms of $(\\sigma, \\lambda, \\mu_J, \\delta_J)$.\n- **Task 2**: Write a program to compute $K_{\\text{var}}$ and the time-$0$ present value $\\text{PV}_0$ of the variance swap.\n- **Test Suite**: Five parameter sets are provided: $(\\sigma, \\lambda, \\mu_J, \\delta_J, T, r, q, K, N_{\\text{var}})$.\n  - Case A: $(0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000)$\n  - Case B: $(0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500)$\n  - Case C: $(0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000)$\n  - Case D: $(0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000)$\n  - Case E: $(0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000)$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria.\n- **Scientifically Grounded**: The Merton jump-diffusion model is a cornerstone of modern quantitative finance. The definition of a variance swap, its payoff structure based on the quadratic variation of log-returns, and risk-neutral pricing are all standard and well-established concepts. The problem is firmly rooted in financial mathematics.\n- **Well-Posed**: The problem provides a complete set of model parameters and asks for the derivation of specific, well-defined quantities ($K_{\\text{var}}$ and $\\text{PV}_0$). The tasks are clear and a unique solution exists based on standard theory.\n- **Objective**: The problem is stated in precise, formal mathematical language, devoid of any subjectivity or ambiguity.\n- **Consistency and Completeness**: The model is fully specified. The definition of the compensator term $\\lambda \\kappa$ is consistent with the requirement that the discounted asset price is a martingale under the risk-neutral measure. All parameters required for the calculation are provided in the test suite. The problem is self-contained and internally consistent.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a standard, well-posed problem in computational finance that requires a rigorous derivation based on stochastic calculus. A solution will be provided.\n\n### Derivation and Solution\nThe solution is developed in three stages: first, we derive the dynamics of the log-price $X_t$; second, we derive the expected quadratic variation of $X_t$ to find the fair variance strike $K_{\\text{var}}$; third, we derive the present value of the variance swap.\n\n**1. Dynamics of the Log-Price $X_t$**\n\nWe start with the SDE for the stock price $S_t$:\n$$\ndS_t = S_{t-} \\left(r - q - \\lambda \\kappa \\right) dt + S_{t-} \\sigma \\, dW_t + S_{t-} (J - 1) \\, dN_t\n$$\nTo find the dynamics of $X_t = \\ln S_t$, we apply Itô's lemma for jump-diffusion processes. For a function $f(S_t)$, the dynamics are given by:\n$$\ndf(S_t) = \\frac{\\partial f}{\\partial S_{t-}} dS_t^c + \\frac{1}{2} \\frac{\\partial^2 f}{\\partial S_{t-}^2} (dS_t^c)^2 + \\left[ f(S_t) - f(S_{t-}) \\right] dN_t\n$$\nHere, $f(S) = \\ln S$, so $\\frac{\\partial f}{\\partial S} = \\frac{1}{S}$ and $\\frac{\\partial^2 f}{\\partial S^2} = -\\frac{1}{S^2}$. The continuous part of the dynamics is $dS_t^c = S_{t-}(r - q - \\lambda \\kappa) dt + S_{t-} \\sigma dW_t$. The quadratic variation of the continuous part is $(dS_t^c)^2 = (S_{t-} \\sigma dW_t)^2 = S_{t-}^2 \\sigma^2 dt$.\n\nAt a jump, the price changes from $S_{t-}$ to $S_t = S_{t-} J$. The change in log-price is $\\Delta X_t = \\ln(S_t) - \\ln(S_{t-}) = \\ln(S_{t-}J) - \\ln(S_{t-}) = \\ln J$.\n\nSubstituting these into Itô's formula:\n$$\ndX_t = \\frac{1}{S_{t-}} \\left[ S_{t-} \\left(r - q - \\lambda \\kappa \\right) dt + S_{t-} \\sigma \\, dW_t \\right] + \\frac{1}{2} \\left( -\\frac{1}{S_{t-}^2} \\right) S_{t-}^2 \\sigma^2 dt + \\ln J \\, dN_t\n$$\nSimplifying the expression gives the SDE for the log-price $X_t$:\n$$\ndX_t = \\left( r - q - \\lambda \\kappa - \\frac{1}{2}\\sigma^2 \\right) dt + \\sigma dW_t + \\ln J \\, dN_t\n$$\n\n**2. Fair Variance Strike $K_{\\text{var}}$**\n\nThe fair variance strike, $K_{\\text{var}}$, is the value of $K$ that makes the swap's initial value zero. This is equivalent to the risk-neutral expected annualized realized variance:\n$$\nK_{\\text{var}} = \\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right]\n$$\nThe quadratic variation, $[X]_T$, of the jump-diffusion process $X_t$ is the sum of the quadratic variation from the continuous (Brownian) part and the sum of the squared jumps:\n$$\n[X]_T = \\left[ \\int_0^T \\sigma dW_t \\right]_T + \\left[ \\sum_{i=1}^{N_T} \\ln J_i \\right]_T = \\int_0^T \\sigma^2 dt + \\sum_{i=1}^{N_T} (\\ln J_i)^2\n$$\nSince $\\sigma$ is a constant, this simplifies to:\n$$\n[X]_T = \\sigma^2 T + \\sum_{i=1}^{N_T} (\\ln J_i)^2\n$$\nNow, we take the expectation under the risk-neutral measure. By linearity of expectation:\n$$\n\\mathbb{E} \\left[ [X]_T \\right] = \\mathbb{E}[\\sigma^2 T] + \\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right] = \\sigma^2 T + \\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right]\n$$\nThe second term is the expectation of a random sum. Using the law of total expectation (conditioning on $N_T$), where the jump sizes $(\\ln J_i)^2$ are independent of the number of jumps $N_T$:\n$$\n\\mathbb{E}\\left[ \\sum_{i=1}^{N_T} (\\ln J_i)^2 \\right] = \\mathbb{E}[N_T] \\mathbb{E}[(\\ln J)^2]\n$$\nFor a Poisson process with intensity $\\lambda$, $\\mathbb{E}[N_T] = \\lambda T$.\nFor the jump component, we are given $\\ln J \\sim \\mathcal{N}(\\mu_J, \\delta_J^2)$. The second moment of a normal random variable $Z \\sim \\mathcal{N}(\\mu, \\sigma^2)$ is $\\mathbb{E}[Z^2] = \\text{Var}(Z) + (\\mathbb{E}[Z])^2 = \\sigma^2 + \\mu^2$.\nTherefore, $\\mathbb{E}[(\\ln J)^2] = \\delta_J^2 + \\mu_J^2$.\n\nSubstituting these results back:\n$$\n\\mathbb{E} \\left[ [X]_T \\right] = \\sigma^2 T + (\\lambda T) (\\mu_J^2 + \\delta_J^2)\n$$\nFinally, we find the fair annualized variance strike $K_{\\text{var}}$ by dividing by $T$:\n$$\nK_{\\text{var}} = \\frac{1}{T} \\left( \\sigma^2 T + \\lambda T (\\mu_J^2 + \\delta_J^2) \\right)\n$$\n$$\nK_{\\text{var}} = \\sigma^2 + \\lambda (\\mu_J^2 + \\delta_J^2)\n$$\nThis expression is independent of $T$, $r$, and $q$, as expected for a fair variance strike under this model.\n\n**3. Present Value of the Variance Swap $\\text{PV}_0$**\n\nThe time-$0$ price, or present value $\\text{PV}_0$, of the variance swap is the discounted risk-neutral expectation of its payoff:\n$$\n\\text{PV}_0 = e^{-rT} \\mathbb{E} \\left[ N_{\\text{var}} \\left( \\frac{1}{T} [X]_T - K \\right) \\right]\n$$\nUsing the linearity of expectation and factoring out constants:\n$$\n\\text{PV}_0 = e^{-rT} N_{\\text{var}} \\left( \\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right] - K \\right)\n$$\nWe have already shown that $\\frac{1}{T} \\mathbb{E} \\left[ [X]_T \\right] = K_{\\text{var}}$. Therefore, the present value is:\n$$\n\\text{PV}_0 = e^{-rT} N_{\\text{var}} (K_{\\text{var}} - K)\n$$\n\nThese derived formulae will be implemented in the program.\n- Fair Strike: $K_{\\text{var}} = \\sigma^2 + \\lambda (\\mu_J^2 + \\delta_J^2)$\n- Present Value: $\\text{PV}_0 = N_{\\text{var}} (K_{\\text{var}} - K) e^{-rT}$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the fair variance strike and present value of a variance swap\n    under the Merton jump-diffusion model for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, lam, mu_J, delta_J, T, r, q, K, N_var)\n    test_cases = [\n        (0.2, 0.5, -0.1, 0.2, 1.0, 0.03, 0.0, 0.06, 10000),     # Case A\n        (0.3, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.09, 7500),      # Case B\n        (0.0, 1.2, 0.05, 0.3, 0.5, 0.01, 0.0, 0.12, 5000),    # Case C\n        (0.25, 0.05, -0.2, 0.0, 1.5, 0.05, 0.0, 0.0645, 8000),# Case D\n        (0.15, 0.4, -0.02, 0.1, 3.0, 0.07, 0.02, 0.02, 12000),   # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for the current test case.\n        # The dividend yield 'q' is part of the model definition but does not\n        # affect the quadratic variation of the log-price, so it is not used in the final formulas.\n        sigma, lam, mu_J, delta_J, T, r, q, K, N_var = case\n\n        # 1. Calculate the fair annualized variance swap strike (K_var).\n        # The formula is K_var = sigma^2 + lambda * (mu_J^2 + delta_J^2).\n        # This represents the annualized expected quadratic variation of log-returns.\n        # It is the sum of the variance from the continuous diffusion part (sigma^2)\n        # and the variance from the jump part (lambda * E[(ln J)^2]).\n        \n        # contribution from jumps is jump frequency * expected squared log-jump size\n        jump_variance_contribution = lam * (mu_J**2 + delta_J**2)\n        \n        # fair strike is sum of diffusion variance and jump variance\n        k_var = sigma**2 + jump_variance_contribution\n\n        # 2. Calculate the time-0 present value (PV_0) of the variance swap.\n        # The formula is PV_0 = N_var * (K_var - K) * exp(-r*T).\n        # This is the discounted risk-neutral expectation of the swap's payoff.\n        \n        pv_0 = N_var * (k_var - K) * np.exp(-r * T)\n\n        # Round the results to 10 decimal places as required.\n        k_var_rounded = round(k_var, 10)\n        pv_0_rounded = round(pv_0, 10)\n        \n        results.append([k_var_rounded, pv_0_rounded])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list is used to format each pair.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"}, {"introduction": "Moving from pricing to risk management, we now explore how jumps affect option sensitivities, or \"Greeks.\" Unlike in the purely diffusive Black-Scholes world, the possibility of sudden jumps introduces new complexities, particularly for options with discontinuous payoffs near their expiration. This conceptual exercise [@problem_id:2404600] will sharpen your intuition by analyzing the behavior of Delta and Gamma in a short-maturity limit, revealing how the continuous diffusion component dominates the local risk profile even when jumps are a possibility.", "id": "2404600", "problem": "Consider a digital (cash-or-nothing) call option with maturity $T$ and strike $K$ written on an asset price process $\\{S_t\\}_{t \\ge 0}$ that follows a Merton jump-diffusion under the risk-neutral measure, with dynamics\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - \\lambda \\kappa\\right)\\,dt + \\sigma\\,dW_t + (J - 1)\\,dN_t,\n$$\nwhere $r$ is the risk-free rate, $\\sigma > 0$ is the diffusion volatility, $N_t$ is a Poisson process with intensity $\\lambda > 0$, and the independent and identically distributed jump sizes $J$ satisfy $\\mathbb{E}[J - 1] = \\kappa$ and are independent of $W_t$ and $N_t$. The digital call payoff is $\\mathbf{1}_{\\{S_T > K\\}}$. Let $V(S,t)$ denote the time-$t$ price for $S_t = S$, so that\n$$\nV(S,t) \\;=\\; \\mathbb{E}^{\\mathbb{Q}}\\!\\left[ e^{-r(T-t)} \\,\\mathbf{1}_{\\{S_T > K\\}} \\,\\big|\\, S_t = S \\right].\n$$\nDefine the standard Greeks at time $t$: delta $\\Delta = \\partial V/\\partial S$, gamma $\\Gamma = \\partial^2 V/\\partial S^2$, and vega $\\nu = \\partial V/\\partial \\sigma$. Consider the short-maturity regime with time to maturity $\\tau = T - t \\downarrow 0$, and focus on the local behavior for $S$ in a neighborhood of $K$ (assume $S$ can approach $K$ at a rate that may depend on $\\tau$). Using only the following foundational elements:\n- the law of iterated expectations and conditioning on the number of jumps,\n- the small-time expansion of a Poisson process $\\mathbb{P}(N_{t+\\tau} - N_t = 0) = 1 - \\lambda \\tau + o(\\tau)$, $\\mathbb{P}(N_{t+\\tau} - N_t = 1) = \\lambda \\tau + o(\\tau)$, $\\mathbb{P}(N_{t+\\tau} - N_t \\ge 2) = o(\\tau)$,\n- the risk-neutral valuation principle,\n- the fact that conditional on no jump, the short-time log-return is approximately Gaussian with variance $\\sigma^2 \\tau$,\n\nwhich of the following statements best characterizes the leading-order behavior of the Greeks as $\\tau \\downarrow 0$?\n\nA. As $\\tau \\downarrow 0$, the delta $\\Delta$ exhibits a localized blow-up near $S = K$ of order $O(\\tau^{-1/2})$, the gamma $\\Gamma$ exhibits a localized blow-up near $S = K$ of order $O(\\tau^{-1})$, the vega $\\nu \\to 0$, and the sensitivity to the jump intensity $\\partial V/\\partial \\lambda = O(\\tau)$.\n\nB. The presence of jumps regularizes the payoffs so that both $\\Delta$ and $\\Gamma$ remain bounded near $S = K$, while $\\nu$ diverges as $O(\\tau^{-1/2})$ because jump risk dominates at short maturities.\n\nC. The delta $\\Delta$ remains finite, the gamma $\\Gamma$ diverges more strongly as $O(\\tau^{-2})$ due to jump arrivals, and the vega $\\nu$ converges to a positive constant as $\\tau \\downarrow 0$.\n\nD. All three Greeks $\\Delta$, $\\Gamma$, and $\\nu$ converge to $0$ for all $S$, including $S = K$, because there is too little time for either diffusion or jumps to impact the price materially.", "solution": "The problem asks for the leading-order behavior of the Greeks (Delta, Gamma, Vega) and the sensitivity to jump intensity for a digital call option under the Merton jump-diffusion model as the time to maturity $\\tau = T-t$ approaches zero.\n\nFirst, we validate the problem statement.\nThe problem describes a standard financial derivative (a digital call option) and a standard asset price model (Merton's jump-diffusion model) under the risk-neutral measure $\\mathbb{Q}$. The provided stochastic differential equation (SDE) is:\n$$\n\\frac{dS_t}{S_{t-}} = \\left(r - \\lambda \\kappa\\right)\\,dt + \\sigma\\,dW_t + (J - 1)\\,dN_t\n$$\nwhere $\\kappa = \\mathbb{E}^{\\mathbb{Q}}[J - 1]$. The drift term $(r - \\lambda \\kappa)$ correctly compensates for the expected jump size to ensure the discounted asset price is a martingale under $\\mathbb{Q}$, as required by the risk-neutral valuation principle. The problem setup, including the pricing formula, the definition of the Greeks, and the foundational elements to be used for the analysis, is self-contained, scientifically grounded in mathematical finance, and well-posed. The problem is therefore valid.\n\nNow, we proceed to the solution. The price of the option is given by\n$$\nV(S,t) \\;=\\; e^{-r\\tau} \\,\\mathbb{E}^{\\mathbb{Q}}\\!\\left[ \\mathbf{1}_{\\{S_T > K\\}} \\,\\big|\\, S_t = S \\right]\n$$\nWe use the law of iterated expectations, conditioning on the number of jumps $N(\\tau) = N_T - N_t$ in the interval $[t, T]$ of length $\\tau$. Using the provided small-time expansion for the Poisson process:\n$$\n\\mathbb{P}(N(\\tau)=0) = 1 - \\lambda \\tau + o(\\tau)\n$$\n$$\n\\mathbb{P}(N(\\tau)=1) = \\lambda \\tau + o(\\tau)\n$$\n$$\n\\mathbb{P}(N(\\tau) \\ge 2) = o(\\tau)\n$$\nWe can approximate the option price by considering at most one jump:\n$$\nV(S,t) \\approx e^{-r\\tau} \\left[ \\mathbb{P}(N(\\tau)=0) \\mathbb{E}^{\\mathbb{Q}}[\\mathbf{1}_{\\{S_T > K\\}} | S_t=S, N(\\tau)=0] + \\mathbb{P}(N(\\tau)=1) \\mathbb{E}^{\\mathbb{Q}}[\\mathbf{1}_{\\{S_T > K\\}} | S_t=S, N(\\tau)=1] \\right]\n$$\nLet $P_0 = \\mathbb{E}^{\\mathbb{Q}}[\\mathbf{1}_{\\{S_T > K\\}} | S_t=S, N(\\tau)=0]$ and $P_1 = \\mathbb{E}^{\\mathbb{Q}}[\\mathbf{1}_{\\{S_T > K\\}} | S_t=S, N(\\tau)=1]$.\nSubstituting the Poisson probabilities and $e^{-r\\tau} \\approx 1-r\\tau$, we get:\n$$\nV(S,t) \\approx (1-r\\tau) \\left[ (1 - \\lambda\\tau) P_0 + \\lambda\\tau P_1 \\right] + o(\\tau)\n$$\n$$\nV(S,t) \\approx P_0 - (r+\\lambda)\\tau P_0 + \\lambda\\tau P_1 + o(\\tau)\n$$\n\n**Analysis of the No-Jump Component ($P_0$)**\nConditional on no jumps, the asset price follows a geometric Brownian motion with drift $r_{eff} = r - \\lambda\\kappa$:\n$$\n\\frac{dS_u}{S_u} = (r - \\lambda\\kappa) du + \\sigma dW_u, \\quad u \\in [t, T]\n$$\nThe solution is $S_T = S \\exp\\left((r - \\lambda\\kappa - \\frac{1}{2}\\sigma^2)\\tau + \\sigma\\sqrt{\\tau}Z\\right)$, where $Z \\sim \\mathcal{N}(0,1)$. The probability of the option finishing in-the-money is:\n$$\nP_0 = \\mathbb{P}(S_T > K) = \\mathbb{P}\\left(Z > \\frac{\\log(K/S) - (r - \\lambda\\kappa - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}}\\right) = N(d_2)\n$$\nwhere $N(\\cdot)$ is the standard normal CDF and\n$$\nd_2 = \\frac{\\log(S/K) + (r - \\lambda\\kappa - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}}\n$$\nThis is the standard Black-Scholes formula for a digital call with adjusted drift. The non-trivial behavior as $\\tau \\downarrow 0$ occurs in a neighborhood of $S=K$ where $\\log(S/K) = O(\\sqrt{\\tau})$.\n\n**Analysis of the One-Jump Component ($P_1$)**\nConditional on one jump, the terminal price is $S_T = S J \\exp\\left((r - \\lambda\\kappa - \\frac{1}{2}\\sigma^2)\\tau + \\sigma\\sqrt{\\tau}Z\\right)$. The probability of finishing in-the-money is an expectation over the jump size $J$:\n$$\nP_1 = \\mathbb{E}_{J}\\left[N\\left(\\frac{\\log(SJ/K) + (r - \\lambda\\kappa - \\frac{1}{2}\\sigma^2)\\tau}{\\sigma\\sqrt{\\tau}}\\right)\\right]\n$$\nAs $\\tau \\downarrow 0$, the argument of $N(\\cdot)$ goes to $+\\infty$ if $SJ > K$ and $-\\infty$ if $SJ < K$. Thus, $N(\\cdot)$ behaves like a step function $\\mathbf{1}_{\\{SJ > K\\}}$.\n$$\nP_1 \\approx \\mathbb{E}_{J}[\\mathbf{1}_{\\{SJ > K\\}}] = \\mathbb{P}(J > K/S)\n$$\nThis is a smooth function of $S$ (assuming the distribution of $J$ is continuous) and is of order $O(1)$ with respect to $\\tau$.\n\n**Behavior of the Greeks**\n\n**Delta ($\\Delta = \\partial V/\\partial S$) and Gamma ($\\Gamma = \\partial^2 V/\\partial S^2$):**\n$$\n\\Delta = \\frac{\\partial V}{\\partial S} \\approx \\frac{\\partial P_0}{\\partial S} + O(\\tau), \\quad \\Gamma = \\frac{\\partial^2 V}{\\partial S^2} \\approx \\frac{\\partial^2 P_0}{\\partial S^2} + O(\\tau)\n$$\nThe derivatives of $P_1$ are smooth and of order $O(1)$, but they are multiplied by $\\lambda\\tau$, so their contribution to the total Greeks is $O(\\tau)$. The behavior is dominated by the no-jump component. The greeks of a standard digital option are well-known:\n$$\n\\frac{\\partial P_0}{\\partial S} = n(d_2) \\frac{\\partial d_2}{\\partial S} = \\frac{n(d_2)}{S\\sigma\\sqrt{\\tau}}\n$$\n$$\n\\frac{\\partial^2 P_0}{\\partial S^2} = \\frac{\\partial}{\\partial S}\\left(\\frac{n(d_2)}{S\\sigma\\sqrt{\\tau}}\\right) = \\frac{-d_2n(d_2)}{S^2\\sigma^2\\tau} - \\frac{n(d_2)}{S^2\\sigma\\sqrt{\\tau}}\n$$\nNear the strike $S=K$, $d_2=O(\\log(S/K)/\\sqrt{\\tau}) + O(\\sqrt{\\tau})$. In the region $\\log(S/K) \\sim O(\\sqrt{\\tau})$, $d_2$ is $O(1)$ and $n(d_2)$ is $O(1)$.\nThus, near $S=K$, the Delta exhibits a localized blow-up of order $\\Delta \\sim O(\\tau^{-1/2})$, and the Gamma exhibits a sign-changing localized blow-up of order $\\Gamma \\sim O(\\tau^{-1})$.\n\n**Vega ($\\nu = \\partial V/\\partial \\sigma$):**\nThe jump-size distribution of $J$ is assumed to be independent of $\\sigma$, so $\\partial P_1/\\partial \\sigma = 0$ at leading order. Vega is dominated by the no-jump component.\n$$\n\\nu \\approx \\frac{\\partial P_0}{\\partial \\sigma} = n(d_2)\\frac{\\partial d_2}{\\partial \\sigma} = n(d_2)\\left(-\\frac{\\log(S/K) + (r-\\lambda\\kappa)\\tau}{\\sigma^2\\sqrt{\\tau}} - \\frac{\\sqrt{\\tau}}{2}\\right)\n$$\nFor any fixed $S \\neq K$, $\\log(S/K)$ is a non-zero constant. As $\\tau \\downarrow 0$, the term $|\\log(S/K)|/(\\sigma^2\\sqrt{\\tau})$ diverges. The Gaussian density $n(d_2)$ decays to zero exponentially fast, faster than the polynomial divergence, so $\\nu \\to 0$.\nFor $S=K$, $\\log(S/K)=0$. Then $d_2=O(\\sqrt{\\tau})$ and $\\partial d_2/\\partial \\sigma = O(\\sqrt{\\tau})$. Hence $\\nu(K, \\tau) = O(\\sqrt{\\tau}) \\to 0$.\nThus, for any fixed stock price $S$, the vega converges to zero. This is known as pointwise convergence.\n\n**Sensitivity to Jump Intensity ($\\partial V/\\partial \\lambda$):**\nThe price $V$ depends on $\\lambda$ explicitly through the Poisson probability and implicitly through the drift compensation term in $P_0$.\n$$\nV \\approx (1-(r+\\lambda)\\tau)P_0(\\lambda) + \\lambda\\tau P_1(\\lambda)\n$$\nDifferentiating with respect to $\\lambda$:\n$$\n\\frac{\\partial V}{\\partial \\lambda} \\approx -\\tau P_0 + (1-(r+\\lambda)\\tau)\\frac{\\partial P_0}{\\partial \\lambda} + \\tau P_1 + \\lambda\\tau\\frac{\\partial P_1}{\\partial\\lambda}\n$$\nThe crucial term is $\\frac{\\partial P_0}{\\partial \\lambda} = n(d_2) \\frac{\\partial d_2}{\\partial \\lambda} = n(d_2) \\left(\\frac{-\\kappa\\tau}{\\sigma\\sqrt{\\tau}}\\right) = -\\frac{\\kappa\\sqrt{\\tau}}{\\sigma} n(d_2)$.\nThis term is of order $O(\\sqrt{\\tau})$. The other terms are of order $O(\\tau)$ or smaller. Therefore, unless $\\kappa = \\mathbb{E}[J-1]=0$, the leading-order behavior is $\\partial V/\\partial \\lambda \\sim O(\\sqrt{\\tau})$.\nThe statement $\\partial V/\\partial \\lambda = O(\\tau)$ would hold if $\\kappa=0$ or if one were to ignore the dependence of the diffusive drift on $\\lambda$.\n\n**Evaluating the Options**\n\n*   **A. As $\\tau \\downarrow 0$, the delta $\\Delta$ exhibits a localized blow-up near $S = K$ of order $O(\\tau^{-1/2})$, the gamma $\\Gamma$ exhibits a localized blow-up near $S = K$ of order $O(\\tau^{-1})$, the vega $\\nu \\to 0$, and the sensitivity to the jump intensity $\\partial V/\\partial \\lambda = O(\\tau)$.**\n    - The statements about $\\Delta$ and $\\Gamma$ are correct.\n    - The statement about $\\nu$ is correct in the sense of pointwise convergence.\n    - The statement about $\\partial V/\\partial \\lambda$ is questionable; our derivation indicates $O(\\sqrt{\\tau})$. However, it might be based on a simplified analysis or the special case $\\kappa=0$.\n*   **B. The presence of jumps regularizes the payoffs so that both $\\Delta$ and $\\Gamma$ remain bounded near $S = K$...** This is incorrect. The probability of no jump is $1-O(\\tau)$, so the diffusive singularity dominates.\n*   **C. The delta $\\Delta$ remains finite, the gamma $\\Gamma$ diverges more strongly as $O(\\tau^{-2})$...** This is incorrect. $\\Delta$ diverges and the $\\Gamma$ divergence is $O(\\tau^{-1})$.\n*   **D. All three Greeks $\\Delta$, $\\Gamma$, and $\\nu$ converge to $0$ for all $S$...** This is incorrect. $\\Delta$ and $\\Gamma$ diverge near the strike.\n\n**Conclusion**\nOption A correctly identifies the short-maturity behavior of Delta and Gamma, which are the most prominent features. It also correctly describes the pointwise convergence of Vega. The statement regarding the sensitivity to $\\lambda$ is inconsistent with a full derivation but could be seen as a result of a simplified model or reasoning. Options B, C, and D make fundamentally incorrect claims about the dominant Greek behaviors. Therefore, Option A provides the best characterization among the choices.", "answer": "$$\\boxed{A}$$"}, {"introduction": "To conclude our practical exploration, we shift our focus from pricing derivatives to the field of asset management. This exercise [@problem_id:2410147] tackles the classic problem of determining the optimal portfolio allocation for an investor facing an asset that follows a jump-diffusion process. Successfully solving this requires not only applying stochastic calculus for jump-diffusions but also carefully handling the practical constraints imposed by the possibility of large, negative jumps, which can pose a significant risk to an investor's wealth.", "id": "2410147", "problem": "An investor with constant relative risk aversion (CRRA) utility chooses a constant portfolio weight in a market with one risk-free asset and one risky asset whose price follows a jump-diffusion process. The investor’s utility over terminal wealth is CRRA with coefficient of relative risk aversion equal to $1$ (log utility), that is, $U(W) = \\ln(W)$. The risk-free asset grows at a continuously compounded rate $r$. The risky asset price $S_t$ evolves according to the Merton jump-diffusion specification\n$$\n\\frac{dS_t}{S_{t-}} = \\mu\\,dt + \\sigma\\,dB_t + y\\,dN_t,\n$$\nwhere $B_t$ is a standard Brownian motion, $N_t$ is a Poisson process with intensity $\\lambda$ independent of $B_t$, and $y$ is a constant jump size with $-1<y<\\infty$ so that at each jump the asset price is multiplied by $(1+y)$. The investor allocates a constant fraction $w$ of wealth to the risky asset (and the remainder to the risk-free asset), with no consumption and no transaction costs, and wealth must remain positive almost surely at all times.\n\nGiven the parameter values $r = 0.02$, $\\mu = 0.10$, $\\sigma = 0.20$, $\\lambda = 0.10$, and $y = -0.20$, determine the optimal constant portfolio weight $w^{\\star}$ that maximizes expected utility of terminal wealth under these dynamics, subject to the requirement that wealth remains positive at jump times. Round your answer to four significant figures. Express your final answer as a decimal with no units.", "solution": "The problem requires the determination of the optimal constant portfolio weight $w^{\\star}$ that maximizes the expected utility of terminal wealth for an investor with logarithmic utility, $U(W) = \\ln(W)$. The market consists of a risk-free asset with a constant rate of return $r$ and a risky asset whose price $S_t$ follows Merton's jump-diffusion model.\n\nFirst, we must validate the problem.\nStep 1: Extract Givens.\n- Utility function: $U(W) = \\ln(W)$, corresponding to a coefficient of relative risk aversion $\\gamma=1$.\n- Risk-free rate: $r$.\n- Risky asset price dynamics: $\\frac{dS_t}{S_{t-}} = \\mu\\,dt + \\sigma\\,dB_t + y\\,dN_t$.\n- $B_t$ is a standard Brownian motion.\n- $N_t$ is a Poisson process with intensity $\\lambda$, independent of $B_t$.\n- $y$ is the constant jump size, with $-1 < y < \\infty$.\n- $w$ is the constant fraction of wealth in the risky asset.\n- Constraint: Wealth $W_t$ must remain positive almost surely.\n- Parameter values: $r = 0.02$, $\\mu = 0.10$, $\\sigma = 0.20$, $\\lambda = 0.10$, $y = -0.20$.\n- Objective: Find the optimal weight $w^{\\star}$ and round the result to four significant figures.\n\nStep 2: Validate Using Extracted Givens.\nThe problem is scientifically grounded, rooted in the established theory of portfolio optimization under jump-diffusion processes developed by Robert C. Merton. It is well-posed, providing a clear objective function (maximization of expected log-utility) and all necessary parameters. The language is objective and precise. The constraints are clearly defined and standard for this class of problem. Therefore, the problem is valid.\n\nStep 3: Verdict and Action.\nThe problem is valid. A solution will be derived.\n\nThe wealth process $W_t$ evolves according to the stochastic differential equation (SDE) that combines the returns from the risk-free and risky assets. The fraction of wealth in the risky asset is $w$, and in the risk-free asset is $1-w$. The differential of wealth $dW_t$ is given by:\n$$\ndW_t = W_t (1-w) (r dt) + W_t w \\frac{dS_t}{S_{t-}}\n$$\nSubstituting the SDE for the risky asset, we get the wealth dynamics:\n$$\n\\frac{dW_t}{W_{t-}} = (1-w) r dt + w (\\mu dt + \\sigma dB_t + y dN_t)\n$$\n$$\n\\frac{dW_t}{W_{t-}} = ((1-w)r + w\\mu) dt + w\\sigma dB_t + wy dN_t\n$$\nAt a jump time $\\tau$, the wealth changes from $W_{\\tau-}$ to $W_{\\tau} = W_{\\tau-} + W_{\\tau-}wy = W_{\\tau-}(1+wy)$. The problem states that wealth must remain positive almost surely. This implies that at any jump time, $W_{\\tau} > 0$. Since $W_{\\tau-} > 0$, we must have the condition:\n$$\n1 + wy > 0\n$$\nGiven the parameter $y = -0.20$, this imposes a constraint on the portfolio weight $w$:\n$$\n1 + w(-0.20) > 0 \\implies 1 > 0.20w \\implies w < \\frac{1}{0.20} \\implies w < 5\n$$\nThis constraint is critical for finding the correct solution.\n\nThe investor's objective is to maximize $E[U(W_T)] = E[\\ln(W_T)]$. To do this, we apply Ito's Lemma for jump-diffusion processes to the function $f(W_t) = \\ln(W_t)$. The SDE for $\\ln(W_t)$ is:\n$$\nd\\ln(W_t) = \\left( \\frac{\\partial \\ln(W)}{\\partial W} \\mu_W + \\frac{1}{2} \\frac{\\partial^2 \\ln(W)}{\\partial W^2} \\sigma_W^2 \\right) dt + \\frac{\\partial \\ln(W)}{\\partial W} \\sigma_W dB_t + (\\ln(W_{t-}(1+wy)) - \\ln(W_{t-})) dN_t\n$$\nwhere $\\mu_W = W_{t-}((1-w)r + w\\mu)$ is the drift of wealth and $\\sigma_W = W_{t-}w\\sigma$ is the diffusion term of wealth. The derivatives are $\\frac{\\partial \\ln(W)}{\\partial W} = \\frac{1}{W}$ and $\\frac{\\partial^2 \\ln(W)}{\\partial W^2} = -\\frac{1}{W^2}$. Substituting these into the formula yields:\n$$\nd\\ln(W_t) = \\left( \\frac{1}{W_{t-}} W_{t-}((1-w)r + w\\mu) - \\frac{1}{2} \\frac{1}{W_{t-}^2} (W_{t-}w\\sigma)^2 \\right) dt + \\frac{1}{W_{t-}} (W_{t-}w\\sigma) dB_t + \\ln(1+wy) dN_t\n$$\nSimplifying this expression gives:\n$$\nd\\ln(W_t) = \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 \\right) dt + w\\sigma dB_t + \\ln(1+wy) dN_t\n$$\nIntegrating from $t=0$ to $t=T$ and taking the expectation:\n$$\nE[\\ln(W_T)] = \\ln(W_0) + \\int_0^T E[ d\\ln(W_t) ]\n$$\n$$\nE[\\ln(W_T)] = \\ln(W_0) + \\int_0^T \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 \\right) dt + E\\left[\\int_0^T w\\sigma dB_t\\right] + E\\left[\\int_0^T \\ln(1+wy) dN_t\\right]\n$$\nUsing the properties $E[dB_t] = 0$ and $E[dN_t] = \\lambda dt$, we get:\n$$\nE[\\ln(W_T)] = \\ln(W_0) + T \\left( r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 + \\lambda\\ln(1+wy) \\right)\n$$\nTo maximize expected terminal log-utility, we must maximize the time-independent growth rate term, which we define as $g(w)$:\n$$\ng(w) = r + w(\\mu-r) - \\frac{1}{2}w^2\\sigma^2 + \\lambda\\ln(1+wy)\n$$\nThe optimization problem is $\\max_{w} g(w)$ subject to $w < 5$. We find the optimal weight $w^{\\star}$ using the first-order condition (FOC), $\\frac{dg}{dw} = 0$:\n$$\n\\frac{dg}{dw} = (\\mu-r) - w\\sigma^2 + \\frac{\\lambda y}{1+wy} = 0\n$$\nThe second-order condition (SOC) for a maximum is $\\frac{d^2g}{dw^2} < 0$:\n$$\n\\frac{d^2g}{dw^2} = -\\sigma^2 - \\frac{\\lambda y^2}{(1+wy)^2}\n$$\nSince $\\sigma^2 > 0$, $\\lambda > 0$, and $y^2 > 0$, the SOC is always satisfied for any $w$ where $1+wy \\ne 0$. Thus, a solution to the FOC will yield a global maximum within the domain.\n\nWe now solve the FOC for $w$. Let's substitute the given parameters: $r = 0.02$, $\\mu = 0.10$, $\\sigma = 0.20$, $\\lambda = 0.10$, $y = -0.20$. This gives $\\mu-r = 0.08$ and $\\sigma^2 = 0.04$.\n$$\n0.08 - w(0.04) + \\frac{0.10(-0.20)}{1+w(-0.20)} = 0\n$$\n$$\n0.08 - 0.04w - \\frac{0.02}{1-0.20w} = 0\n$$\nMultiply the entire equation by $(1-0.20w)$ to clear the denominator:\n$$\n(0.08 - 0.04w)(1 - 0.20w) - 0.02 = 0\n$$\n$$\n0.08 - 0.016w - 0.04w + 0.008w^2 - 0.02 = 0\n$$\n$$\n0.008w^2 - 0.056w + 0.06 = 0\n$$\nTo simplify, multiply by $1000$ and divide by $4$:\n$$\n8w^2 - 56w + 60 = 0\n$$\n$$\n2w^2 - 14w + 15 = 0\n$$\nWe solve this quadratic equation for $w$ using the quadratic formula, $w = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$, with $a=2$, $b=-14$, $c=15$:\n$$\nw = \\frac{14 \\pm \\sqrt{(-14)^2 - 4(2)(15)}}{2(2)} = \\frac{14 \\pm \\sqrt{196 - 120}}{4} = \\frac{14 \\pm \\sqrt{76}}{4}\n$$\nSince $\\sqrt{76} = \\sqrt{4 \\times 19} = 2\\sqrt{19}$, the solutions are:\n$$\nw = \\frac{14 \\pm 2\\sqrt{19}}{4} = \\frac{7 \\pm \\sqrt{19}}{2}\n$$\nThis provides two potential roots:\n$$\nw_1 = \\frac{7 + \\sqrt{19}}{2} \\quad \\text{and} \\quad w_2 = \\frac{7 - \\sqrt{19}}{2}\n$$\nWe must check these solutions against the positivity constraint $w < 5$.\nNumerically, $\\sqrt{19} \\approx 4.3589$.\n$$\nw_1 \\approx \\frac{7 + 4.3589}{2} \\approx \\frac{11.3589}{2} \\approx 5.679\n$$\n$$\nw_2 \\approx \\frac{7 - 4.3589}{2} \\approx \\frac{2.6411}{2} \\approx 1.32055\n$$\nThe solution $w_1 \\approx 5.679$ violates the constraint $w < 5$. Therefore, it is not an admissible solution.\nThe solution $w_2 \\approx 1.32055$ satisfies the constraint $w < 5$ and is the unique optimal weight $w^{\\star}$.\nThe problem requires the answer to be rounded to four significant figures.\n$$\nw^{\\star} = 1.32055\\ldots \\approx 1.321\n$$\nThis is the optimal fraction of wealth to be allocated to the risky asset.", "answer": "$$\\boxed{1.321}$$"}]}