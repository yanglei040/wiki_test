{"hands_on_practices": [{"introduction": "第一个练习是一个基础热身。我们将探索最直接的情景：使用一个高斯分布对另一个高斯分布进行采样。通过这个练习，你将分析推导出有效提议分布的关键条件——“重尾”原则——并在这个理想情况下找到提议分布的最优选择。这个实践为你优化接受—拒绝采样方法建立了核心直觉。", "problem": "一个一维目标概率密度函数 $p(x)$ 是均值为 $0$、标准差为 $\\sigma_p$ 的高斯分布，即 $p(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_p}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma_p^{2}}\\right)$。你希望使用接受-拒绝采样法，其提议密度 $g(x)$ 是一个均值为 $0$、标准差为 $\\sigma_g$ 的高斯分布，即 $g(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_g}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma_g^{2}}\\right)$。在接受-拒绝采样中，一个包络常数 $M$ 必须对所有 $x \\in \\mathbb{R}$ 满足 $p(x) \\leq M\\,g(x)$，并且只有当满足该条件的最小容许 $M$ 为有限值时，该算法才是良定义的。在所有存在有限 $M$ 的 $\\sigma_g$ 选项中，确定使这个最小容许包络常数 $M$ 最小化的 $\\sigma_g$ 值。请用 $\\sigma_p$ 给出最优 $\\sigma_g$ 的闭式表达式作为最终答案。无需数值近似，也无需单位。", "solution": "对问题陈述的有效性进行严格审查。\n\n第 1 步：提取已知条件\n- 目标概率密度函数 (PDF)：$p(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_p}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma_p^{2}}\\right)$，这是一个均值为 $0$、标准差为 $\\sigma_p$ 的高斯分布。\n- 提议概率密度函数 (PDF)：$g(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_g}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma_g^{2}}\\right)$，这是一个均值为 $0$、标准差为 $\\sigma_g$ 的高斯分布。\n- 接受-拒绝条件：对所有 $x \\in \\mathbb{R}$，有 $p(x) \\leq M\\,g(x)$。\n- 目标：找到使最小容许包络常数 $M$ 最小化的 $\\sigma_g$ 值。\n- 约束条件：最优 $\\sigma_g$ 的搜索范围仅限于那些存在有限 $M$ 的值。\n\n第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，因为它涉及标准且成熟的接受-拒绝采样算法，这是计算物理学和统计学中的一种基础技术。所涉及的函数，即高斯分布，在这些领域中无处不在。该问题是良构的，要求在明确的约束条件下，最小化一个关于参数（$\\sigma_g$）的良定义量（$M$）。语言客观且数学上精确。问题是自洽的，没有逻辑矛盾、事实错误或歧义。\n\n第 3 步：结论与行动\n该问题被判定为有效。将提供一个严谨的解法。\n\n接受-拒绝方法的核心在于条件 $p(x) \\leq M g(x)$ 对所有 $x$ 均成立。为确保算法的最高效率，我们必须找到对于给定的分布对 $p(x)$ 和 $g(x)$ 满足此不等式的最小可能常数 $M$。这个最小的 $M$ 由比率 $\\frac{p(x)}{g(x)}$ 在 $x$ 的整个定义域上的上确界给出。设该比率为 $f(x)$。\n\n$$\nM = \\sup_{x \\in \\mathbb{R}} f(x) = \\sup_{x \\in \\mathbb{R}} \\frac{p(x)}{g(x)}\n$$\n\n我们代入 $p(x)$ 和 $g(x)$ 的给定表达式：\n\n$$\nf(x) = \\frac{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_p}\\exp\\left(-\\frac{x^{2}}{2\\sigma_p^{2}}\\right)}{\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_g}\\exp\\left(-\\frac{x^{2}}{2\\sigma_g^{2}}\\right)}\n$$\n\n化简表达式，常数项 $\\frac{1}{\\sqrt{2\\pi}}$ 被消去：\n\n$$\nf(x) = \\frac{\\sigma_g}{\\sigma_p} \\exp\\left(-\\frac{x^{2}}{2\\sigma_p^{2}} + \\frac{x^{2}}{2\\sigma_g^{2}}\\right)\n$$\n\n合并指数部分的项：\n\n$$\nf(x) = \\frac{\\sigma_g}{\\sigma_p} \\exp\\left(\\frac{x^{2}}{2}\\left(\\frac{1}{\\sigma_g^{2}} - \\frac{1}{\\sigma_p^{2}}\\right)\\right)\n$$\n\n只有当 $M$ 是有限值时，该算法才是良定义的。为了使 $M = \\sup_{x \\in \\mathbb{R}} f(x)$ 为有限值，函数 $f(x)$ 在 $x \\to \\pm\\infty$ 时必须是有界的。当 $|x|$ 很大时，$f(x)$ 的行为由指数项主导。如果指数中 $x^{2}$ 的系数为正，那么当 $|x| \\to \\infty$ 时，$f(x)$ 将无界增长。因此，要使有限的 $M$ 存在，该系数必须是非正的。这确立了对 $\\sigma_g$ 的条件：\n\n$$\n\\frac{1}{\\sigma_g^{2}} - \\frac{1}{\\sigma_p^{2}} \\leq 0\n$$\n\n$$\n\\frac{1}{\\sigma_g^{2}} \\leq \\frac{1}{\\sigma_p^{2}}\n$$\n\n由于 $\\sigma_g$ 和 $\\sigma_p$ 都是标准差，它们严格为正。因此，我们可以对两边取倒数并反转不等号，然后取平方根：\n\n$$\n\\sigma_g^{2} \\geq \\sigma_p^{2} \\implies \\sigma_g \\geq \\sigma_p\n$$\n\n这就是问题陈述中提到的，所有存在有限 $M$ 的 $\\sigma_g$ 的选择集合。其物理解释是，提议分布 $g(x)$ 的尾部必须至少与目标分布 $p(x)$ 的尾部一样“重”，才能在所有地方都包住它。\n\n现在，对于任何满足 $\\sigma_g \\geq \\sigma_p$ 的 $\\sigma_g$，系数 $\\left(\\frac{1}{\\sigma_g^{2}} - \\frac{1}{\\sigma_p^{2}}\\right)$ 是非正的。因此，当 $x^2$ 最小时，即 $x=0$ 时，项 $\\exp\\left(\\frac{x^{2}}{2}\\left(\\frac{1}{\\sigma_g^{2}} - \\frac{1}{\\sigma_p^{2}}\\right)\\right)$ 取得其最大值。在这一点，指数项为 $\\exp(0) = 1$。\n\n因此，对于一个给定的有效 $\\sigma_g$，最小的容许包络常数 $M$ 为：\n\n$$\nM(\\sigma_g) = f(0) = \\frac{\\sigma_g}{\\sigma_p} \\exp(0) = \\frac{\\sigma_g}{\\sigma_p}\n$$\n\n问题要求我们在约束条件 $\\sigma_g \\geq \\sigma_p$ 下，找到使函数 $M(\\sigma_g)$ 最小化的 $\\sigma_g$ 值。需要最小化的函数是 $M(\\sigma_g) = \\frac{\\sigma_g}{\\sigma_p}$。由于 $\\sigma_p$ 是一个正常数，所以 $M(\\sigma_g)$ 是 $\\sigma_g$ 的一个线性递增函数。要在一个区间上最小化一个线性递增函数，必须选择该函数定义域中的最小值。$\\sigma_g$ 的定义域是 $[\\sigma_p, \\infty)$。\n\n因此，$M(\\sigma_g)$ 的最小值在该定义域的下边界处达到，即：\n\n$$\n\\sigma_g = \\sigma_p\n$$\n\n在这个最优值下，常数 $M$ 变为 $M = \\frac{\\sigma_p}{\\sigma_p} = 1$，这对应于 $1/M = 1$ 的接受率。这是可能的最有效场景，发生在提议分布与目标分布完全相同时。", "answer": "$$\n\\boxed{\\sigma_p}\n$$", "id": "2370869"}, {"introduction": "在第一个基础案例之上，下一个练习提出了一个更复杂的分析挑战。在这里，目标分布不再是高斯分布（一个四次势），这需要更精细的优化来找到最佳的高斯提议分布。这个练习将锻炼你的微积分技巧，并展示在非平凡场景中如何优化提议分布的参数以最大化采样效率。", "problem": "一个处在无量纲四次禁闭势中的一维粒子，其未归一化的玻尔兹曼权重由目标函数 $\\varphi(x) = \\exp\\!\\big(-x^{4}/2\\big)$ 给出，其中 $x \\in \\mathbb{R}$。为使用接受-拒绝采样法从相应的归一化分布中抽取样本，我们考虑一族归一化的高斯提议密度 $q_{\\alpha}(x) = \\dfrac{1}{\\sqrt{2\\pi}\\,\\alpha}\\,\\exp\\!\\big(-x^{2}/(2\\alpha^{2})\\big)$，其尺度参数 $\\alpha > 0$ 是可控的。定义包络常数 $M(\\alpha)$ 为满足 $\\varphi(x) \\leq M(\\alpha)\\,q_{\\alpha}(x)$ 对所有 $x \\in \\mathbb{R}$ 成立的最小实数。\n\n请以闭合形式确定使 $M(\\alpha)$ 最小化的 $\\alpha$ 值。请以最优 $\\alpha$ 的精确解析表达式给出答案，不得包含数值近似或单位。", "solution": "问题陈述需经验证。\n\n**第1步：提取已知条件**\n- 目标函数：$\\varphi(x) = \\exp(-x^{4}/2)$，对于 $x \\in \\mathbb{R}$。\n- 提议密度族：$q_{\\alpha}(x) = \\dfrac{1}{\\sqrt{2\\pi}\\,\\alpha}\\,\\exp(-x^{2}/(2\\alpha^{2}})$，对于 $\\alpha > 0$。\n- 包络常数定义：$M(\\alpha)$ 是使得 $\\varphi(x) \\leq M(\\alpha)\\,q_{\\alpha}(x)$ 对所有 $x \\in \\mathbb{R}$ 成立的最小实数。\n- 目标：找到使 $M(\\alpha)$ 最小化的 $\\alpha$ 值。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学或事实合理性**：该问题是计算物理和统计学中的一个标准练习，涉及接受-拒绝采样法的优化。所用函数和概念（玻尔兹曼权重、高斯密度）均为标准且正确的。该问题在科学上是合理的。\n- **适定性**：这是一个定义明确的优化任务。它要求找到函数 $M(\\alpha)$ 的最小化子，该函数由给定的函数 $\\varphi(x)$ 和 $q_{\\alpha}(x)$ 导出。可以合理预期解的存在性和唯一性。\n- **目标陈述**：该问题使用精确的数学语言陈述，没有主观或模糊的术语。\n- **完整性与一致性**：该问题提供了所有必要的定义和约束。没有信息缺失或相互矛盾。\n\n**第3步：结论与行动**\n该问题有效。将提供完整解。\n\n接受-拒绝采样法的核心是找到一个包络常数 $M(\\alpha)$，使得对所有 $x$ 都有 $\\varphi(x) \\le M(\\alpha) q_{\\alpha}(x)$。为了最大化采样算法的效率，必须找到该常数的最小可能值。对于一个给定的 $\\alpha$，这个最小值由两个函数比率的最大值给出。\n$$M(\\alpha) = \\sup_{x \\in \\mathbb{R}} \\frac{\\varphi(x)}{q_{\\alpha}(x)}$$\n我们定义比率函数 $R(x, \\alpha)$：\n$$R(x, \\alpha) = \\frac{\\varphi(x)}{q_{\\alpha}(x)} = \\frac{\\exp(-x^{4}/2)}{\\frac{1}{\\sqrt{2\\pi}\\,\\alpha}\\,\\exp(-x^{2}/(2\\alpha^{2}))} = \\sqrt{2\\pi}\\,\\alpha \\exp\\left(-\\frac{x^{4}}{2} + \\frac{x^{2}}{2\\alpha^{2}}\\right)$$\n为求出在 $\\alpha > 0$ 固定时 $R(x, \\alpha)$ 关于 $x$ 的最大值，更简单的方法是求其自然对数的最大值，因为 $\\ln$ 是一个严格单调递增函数。令 $g(x, \\alpha) = \\ln(R(x, \\alpha))$。\n$$g(x, \\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{x^{4}}{2} + \\frac{x^{2}}{2\\alpha^{2}}$$\n为求最大值，我们计算其关于 $x$ 的偏导数并令其为零：\n$$\\frac{\\partial g}{\\partial x} = -2x^{3} + \\frac{x}{\\alpha^{2}} = x\\left(\\frac{1}{\\alpha^{2}} - 2x^{2}\\right)$$\n令 $\\frac{\\partial g}{\\partial x} = 0$ 得到临界点 $x=0$ 和 $x^{2} = \\frac{1}{2\\alpha^{2}}$。为确定这些临界点的性质，我们考察二阶偏导数：\n$$\\frac{\\partial^{2} g}{\\partial x^{2}} = -6x^{2} + \\frac{1}{\\alpha^{2}}$$\n在 $x=0$ 处，$\\frac{\\partial^{2} g}{\\partial x^{2}}|_{x=0} = \\frac{1}{\\alpha^{2}} > 0$，这对应一个局部最小值。\n在 $x^{2} = \\frac{1}{2\\alpha^{2}}$ 处，$\\frac{\\partial^{2} g}{\\partial x^{2}}|_{x^{2}=1/(2\\alpha^{2})} = -6\\left(\\frac{1}{2\\alpha^{2}}\\right) + \\frac{1}{\\alpha^{2}} = -\\frac{3}{\\alpha^{2}} + \\frac{1}{\\alpha^{2}} = -\\frac{2}{\\alpha^{2}} < 0$。这表示一个局部最大值。因此，$g(x, \\alpha)$ 的上确界出现在 $x^{2} = \\frac{1}{2\\alpha^{2}}$ 处。\n\n将这个 $x^2$ 的值代回 $g(x, \\alpha)$ 的表达式，得到最大值，我们记作 $g_{\\max}(\\alpha)$：\n$$g_{\\max}(\\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{1}{2}\\left(\\frac{1}{2\\alpha^{2}}\\right)^{2} + \\frac{1}{2\\alpha^{2}}\\left(\\frac{1}{2\\alpha^{2}}\\right)$$\n$$g_{\\max}(\\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{1}{8\\alpha^{4}} + \\frac{1}{4\\alpha^{4}} = \\ln(\\sqrt{2\\pi}\\,\\alpha) + \\frac{1}{8\\alpha^{4}}$$\n包络常数 $M(\\alpha)$ 是该值的指数：\n$$M(\\alpha) = \\exp(g_{\\max}(\\alpha)) = \\exp\\left(\\ln(\\sqrt{2\\pi}\\,\\alpha) + \\frac{1}{8\\alpha^{4}}\\right) = \\sqrt{2\\pi}\\,\\alpha \\exp\\left(\\frac{1}{8\\alpha^{4}}\\right)$$\n目标是找到使 $M(\\alpha)$ 最小化的 $\\alpha$ 值。我们可以通过最小化 $\\ln(M(\\alpha))$ 来实现这一点，我们称之为 $h(\\alpha)$。\n$$h(\\alpha) = \\ln(M(\\alpha)) = \\ln(\\sqrt{2\\pi}) + \\ln(\\alpha) + \\frac{1}{8\\alpha^{4}} = \\ln(\\sqrt{2\\pi}) + \\ln(\\alpha) + \\frac{1}{8}\\alpha^{-4}$$\n我们将 $h(\\alpha)$ 对 $\\alpha$ 求导，并令导数为零：\n$$\\frac{dh}{d\\alpha} = \\frac{1}{\\alpha} + \\frac{1}{8}(-4)\\alpha^{-5} = \\frac{1}{\\alpha} - \\frac{1}{2\\alpha^{5}}$$\n令 $\\frac{dh}{d\\alpha} = 0$：\n$$\\frac{1}{\\alpha} - \\frac{1}{2\\alpha^{5}} = 0$$\n因为 $\\alpha > 0$，我们可以两边乘以 $2\\alpha^{5}$ 得到：\n$$2\\alpha^{4} - 1 = 0 \\implies \\alpha^{4} = \\frac{1}{2}$$\n唯一的正实数解是：\n$$\\alpha = \\left(\\frac{1}{2}\\right)^{1/4}$$\n为确认这是一个最小值，我们考察 $h(\\alpha)$ 的二阶导数：\n$$\\frac{d^{2}h}{d\\alpha^{2}} = \\frac{d}{d\\alpha}\\left(\\alpha^{-1} - \\frac{1}{2}\\alpha^{-5}\\right) = -\\alpha^{-2} - \\frac{1}{2}(-5)\\alpha^{-6} = -\\frac{1}{\\alpha^{2}} + \\frac{5}{2\\alpha^{6}}$$\n将 $\\alpha^4 = 1/2$ 的值代入二阶导数：\n$$\\frac{d^{2}h}{d\\alpha^{2}} = \\frac{1}{\\alpha^{6}}\\left(\\frac{5}{2} - \\alpha^{4}\\right) = \\frac{1}{\\alpha^{6}}\\left(\\frac{5}{2} - \\frac{1}{2}\\right) = \\frac{2}{\\alpha^{6}}$$\n由于 $\\alpha > 0$，$\\alpha^{6}$ 为正，所以 $\\frac{d^{2}h}{d\\alpha^{2}} > 0$。这证实了我们找到的 $\\alpha$ 值对应于 $M(\\alpha)$ 的一个局部最小值。\n因此，使包络常数 $M(\\alpha)$ 最小化的 $\\alpha$ 值为 $\\left(\\frac{1}{2}\\right)^{1/4}$。", "answer": "$$\\boxed{\\left(\\frac{1}{2}\\right)^{1/4}}$$", "id": "2370842"}, {"introduction": "从分析理论转向计算实践，最后一个练习解决了一个常见且重要的问题：从多峰分布中采样。你将实现并比较两种不同的提议策略：一种是简单的单峰近似，另一种是更复杂的、与目标结构相匹配的混合模型。这个动手编程问题突显了精心设计提议分布以反映目标关键特征的强大威力，它能显著提高采样效率。", "problem": "您将比较使用两种不同的提议策略，从一个一维双峰目标概率密度函数中抽取样本时，接受-拒绝采样 (ARS) 的效率。目标分布是两个正态分布的混合。效率度量是接受率，对于一个有效的 ARS 设置，该值等于包络常数的倒数。\n\n基本原理和定义：\n- 概率密度函数 $f(x)$ 是一个非负函数，满足 $\\int_{-\\infty}^{\\infty} f(x)\\,dx = 1$。\n- 在接受-拒绝采样 (ARS) 中，我们选择一个提议密度 $g(x)$（满足 $\\int g(x)\\,dx = 1$）和一个常数 $M \\ge 1$，使得对于所有 $x \\in \\mathbb{R}$ 都有 $M\\,g(x) \\ge f(x)$。ARS 过程从 $g$ 中抽取 $X$（记作 $X \\sim g$）并从 $\\text{Uniform}(0,1)$ 分布中抽取 $U$，如果 $U \\le \\frac{f(X)}{M g(X)}$，则接受 $X$。这保证了被接受的 $X$ 值服从 $f$ 分布。\n- 接受率是 $X \\sim g$ 时 $\\mathbb{E}\\left[\\frac{f(X)}{M g(X)}\\right]$ 的期望值。在 ARS 条件下，且 $f$ 已归一化（积分为 1），接受率等于 $\\frac{1}{M}$。\n\n待研究的目标和提议：\n- 目标密度 $f(x)$：两个正态分量的混合，它们具有共同的标准差 $\\sigma_t > 0$、均值 $\\mu_1$ 和 $\\mu_2$，以及第一个模态的混合权重 $w \\in (0,1)$，\n$$\nf(x) \\;=\\; w\\,\\phi(x;\\mu_1,\\sigma_t) \\;+\\; (1-w)\\,\\phi(x;\\mu_2,\\sigma_t),\n$$\n其中 $\\phi(x;\\mu,\\sigma)$ 是正态密度\n$$\n\\phi(x;\\mu,\\sigma) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right).\n$$\n- 提议 A（单一单峰提议）$g_s(x)$：一个单一正态密度，其均值选为混合均值 $\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$，标准差选为混合方差的平方根，\n$$\n\\sigma_p \\;=\\; \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}, \\qquad g_s(x) = \\phi(x;\\mu_p,\\sigma_p).\n$$\n- 提议 B（两个策略性放置的单峰提议的混合）$g_m(x)$：两个正态分量的混合，其中心位于两个模态处，具有与目标相同的标准差和权重，\n$$\ng_m(x) \\;=\\; w\\,\\phi(x;\\mu_1,\\sigma_t) \\;+\\; (1-w)\\,\\phi(x;\\mu_2,\\sigma_t).\n$$\n\n计算任务：\n- 对于下述套件中的每个测试用例，为每个提议计算一个有效的包络常数，\n$$\nM_s \\;\\ge\\; \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g_s(x)}, \\qquad\nM_m \\;\\ge\\; \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g_m(x)}.\n$$\n- 由于精确的上确界可能无法以闭式形式获得，因此需要通过在一个足够宽且密集的网格上评估该比率，然后将观测到的最大比率乘以一个小的安全系数来保证有效性，从而计算一个数值上有效的上界。使用定义域\n$$\n[x_{\\min}, x_{\\max}] \\;=\\; \\big[\\min(\\mu_1,\\mu_2) - L,\\; \\max(\\mu_1,\\mu_2) + L\\big], \\quad L \\;=\\; 8\\,\\sigma_t + |\\mu_2-\\mu_1|,\n$$\n在此区间上使用一个包含 $N_{\\text{grid}} = 200001$ 个点的均匀网格。令 $\\widehat{M}$ 表示在网格上观测到的最大比率。定义认证常数为\n$$\nM \\;=\\; \\gamma\\,\\widehat{M}, \\quad \\text{其中安全系数 } \\gamma \\;=\\; 1.0005.\n$$\n- 分别计算提议 $g_s$ 和 $g_m$ 的接受率 $a_s = 1/M_s$ 和 $a_m = 1/M_m$。\n- 对于每个测试用例，以十进制数形式报告改进因子 $I = a_m/a_s$。\n\n测试套件：\n- 用例 1（平衡、分离良好的模态）：$\\mu_1 = -3$, $\\mu_2 = 3$, $\\sigma_t = 1$, $w = 0.5$。\n- 用例 2（平衡、中度重叠的模态）：$\\mu_1 = -1$, $\\mu_2 = 1$, $\\sigma_t = 1$, $w = 0.5$。\n- 用例 3（不等权重、分离的模态）：$\\mu_1 = 0$, $\\mu_2 = 8$, $\\sigma_t = 1$, $w = 0.9$。\n- 用例 4（平衡、极端分离的模态）：$\\mu_1 = -6$, $\\mu_2 = 6$, $\\sigma_t = 1$, $w = 0.5$。\n\n答案规格：\n- 对于每个测试用例，答案是代表改进因子 $a_m/a_s$ 的单个浮点数 $I$。\n- 您的程序必须产生单行输出，其中包含测试套件的改进因子，以逗号分隔的列表形式呈现，顺序同上，并用方括号括起来。每个浮点数必须四舍五入到六位小数（使用小数形式，而非百分比）。例如，一个有效的输出格式是 $[1.234000,2.000000, \\dots]$。", "solution": "问题要求对从双峰目标概率密度函数进行接受-拒绝采样 (ARS) 的两种不同提议策略的效率进行对比分析。效率由接受率量化，该值是包络常数 $M$ 的倒数。改进因子定义为两种提议的接受率之比。\n\n目标概率密度函数 $f(x)$ 是两个正态分布的混合：\n$$\nf(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)\n$$\n其中 $\\phi(x;\\mu,\\sigma)$ 是正态概率密度函数：\n$$\n\\phi(x;\\mu,\\sigma) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)\n$$\n参数是均值 $\\mu_1$ 和 $\\mu_2$、共同的标准差 $\\sigma_t > 0$ 以及混合权重 $w \\in (0,1)$。\n\n指定了两种提议密度用于分析。\n\n提议 A，一个单一单峰提议 $g_s(x)$，是一个正态密度，其均值和方差与目标混合分布 $f(x)$ 的均值和方差相匹配。混合的均值是 $\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$，方差是 $\\sigma_p^2 = \\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2$。因此，该提议是：\n$$\ng_s(x) = \\phi(x; \\mu_p, \\sigma_p) \\quad \\text{其中} \\quad \\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2, \\quad \\sigma_p = \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}\n$$\n该策略试图用一个单一、更宽的正态分布来近似双峰目标。\n\n提议 B，一个混合提议 $g_m(x)$，被构造成与目标密度相同：\n$$\ng_m(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)\n$$\n这代表一个“完美”的提议，因为它与目标分布具有相同的形式。\n\n接受-拒绝采样的核心依赖于一个包络常数 $M$，使得对于所有 $x$ 都有 $f(x) \\le M\\,g(x)$。满足此条件的最小常数是 $M = \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g(x)}$。接受概率（或效率）由 $a = 1/M$ 给出。我们必须分别为提议 $g_s(x)$ 和 $g_m(x)$ 计算包络常数 $M_s$ 和 $M_m$。\n\n对于提议 B，由于 $g_m(x) = f(x)$，其比率恒等于一：\n$$\n\\frac{f(x)}{g_m(x)} = 1, \\quad \\forall x \\in \\mathbb{R}\n$$\n因此，理论上的上确界是 $\\sup_{x} \\frac{f(x)}{g_m(x)} = 1$。在任何网格上，数值上观测到的最大值 $\\widehat{M}_m$ 将是 $1$（在浮点精度范围内）。根据问题说明，认证常数是 $M_m = \\gamma\\,\\widehat{M}_m = \\gamma \\cdot 1 = \\gamma$，其中 $\\gamma = 1.0005$ 是安全系数。相应的接受率是 $a_m = 1/M_m = 1/\\gamma$。\n\n对于提议 A，比率 $r_s(x) = f(x)/g_s(x)$ 不是一个常数。解析地确定其上确界并非易事。问题强制要求使用一种数值方法：我们在一个指定的密集网格上找到该比率的最大值，即 $\\widehat{M}_s = \\max_{x \\in \\text{grid}} r_s(x)$。认证常数则为 $M_s = \\gamma\\,\\widehat{M}_s$。此提议的接受率为 $a_s = 1/M_s$。\n\n我们的目标是计算改进因子 $I$，它被定义为接受率之比：\n$$\nI = \\frac{a_m}{a_s}\n$$\n将用认证常数表示的接受率表达式代入，我们得到：\n$$\nI = \\frac{1/M_m}{1/M_s} = \\frac{M_s}{M_m}\n$$\n使用定义 $M_s = \\gamma\\,\\widehat{M}_s$ 和 $M_m = \\gamma$，改进因子的表达式简化为：\n$$\nI = \\frac{\\gamma\\,\\widehat{M}_s}{\\gamma} = \\widehat{M}_s\n$$\n因此，所需的改进因子恰好是在应用安全系数之前，在数值网格上观测到的比率 $f(x)/g_s(x)$ 的最大值。这就是我们必须为每个测试用例计算的量。\n\n每个测试用例的计算步骤如下：\n1.  给定参数 $\\mu_1$, $\\mu_2$, $\\sigma_t$ 和 $w$。\n2.  定义目标密度函数 $f(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)$。\n3.  计算单一提议 $g_s(x)$ 的参数：\n    -   均值：$\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$\n    -   标准差：$\\sigma_p = \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}$\n4.  构建数值网格。定义域为 $[x_{\\min}, x_{\\max}]$，其中：\n    -   $L = 8\\,\\sigma_t + |\\mu_2-\\mu_1|$\n    -   $x_{\\min} = \\min(\\mu_1,\\mu_2) - L$\n    -   $x_{\\max} = \\max(\\mu_1,\\mu_2) + L$\n    -   网格在此定义域上包含 $N_{\\text{grid}} = 200001$ 个均匀分布的点。\n5.  在网格的每个点上计算函数 $f(x)$ 和 $g_s(x)$ 的值。\n6.  为所有网格点计算比率 $r_s(x) = f(x)/g_s(x)$。如果 $g_s(x)$ 接近于零，必须特别小心，但考虑到网格很宽以及正态分布的性质，分子和分母在尾部都会趋于零，它们的比率将是良态的。\n7.  改进因子 $I$ 是在比率数组中找到的最大值：$I = \\max(r_s(x))$。\n8.  对套件中提供的所有四个测试用例重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the improvement factor of a mixture proposal over a single \n    unimodal proposal for acceptance-rejection sampling.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (balanced, well-separated modes)\n        {'mu1': -3.0, 'mu2': 3.0, 'sigma_t': 1.0, 'w': 0.5},\n        # Case 2 (balanced, moderately overlapping modes)\n        {'mu1': -1.0, 'mu2': 1.0, 'sigma_t': 1.0, 'w': 0.5},\n        # Case 3 (unequal weights, separated modes)\n        {'mu1': 0.0, 'mu2': 8.0, 'sigma_t': 1.0, 'w': 0.9},\n        # Case 4 (balanced, extremely separated modes)\n        {'mu1': -6.0, 'mu2': 6.0, 'sigma_t': 1.0, 'w': 0.5},\n    ]\n\n    # Constants from the problem statement\n    N_grid = 200001\n    \n    results = []\n\n    for case in test_cases:\n        mu1 = case['mu1']\n        mu2 = case['mu2']\n        sigma_t = case['sigma_t']\n        w = case['w']\n\n        # 1. Define the target density function f(x)\n        def f(x_vals):\n            term1 = w * norm.pdf(x_vals, loc=mu1, scale=sigma_t)\n            term2 = (1.0 - w) * norm.pdf(x_vals, loc=mu2, scale=sigma_t)\n            return term1 + term2\n\n        # 2. Calculate parameters for the single proposal g_s(x)\n        mu_p = w * mu1 + (1.0 - w) * mu2\n        var_p = sigma_t**2 + w * (1.0 - w) * (mu2 - mu1)**2\n        sigma_p = np.sqrt(var_p)\n\n        # 3. Define the single proposal density g_s(x)\n        def g_s(x_vals):\n            return norm.pdf(x_vals, loc=mu_p, scale=sigma_p)\n\n        # 4. Construct the numerical grid\n        L = 8.0 * sigma_t + np.abs(mu2 - mu1)\n        x_min = min(mu1, mu2) - L\n        x_max = max(mu1, mu2) + L\n        x_grid = np.linspace(x_min, x_max, N_grid)\n\n        # 5. Evaluate f(x) and g_s(x) on the grid\n        f_vals = f(x_grid)\n        g_s_vals = g_s(x_grid)\n\n        # 6. Compute the ratio r_s(x) = f(x) / g_s(x)\n        # To avoid division by zero or NaN, we handle cases where g_s is very small.\n        # If g_s(x) is near zero, f(x) must also be near zero for the ratio to be finite.\n        # In the extreme tails, both are effectively zero, and the ratio tends to zero.\n        # We can safely replace g_s_vals=0 with a very small number, or filter them.\n        # Here, we only divide where g_s_vals is non-zero.\n        # The result of f(x)/g(x) approaches 0 where g(x) goes to 0 faster than f(x),\n        # which is the case in the tails.\n        ratio_s = np.zeros_like(f_vals)\n        non_zero_mask = g_s_vals > 0\n        ratio_s[non_zero_mask] = f_vals[non_zero_mask] / g_s_vals[non_zero_mask]\n\n        # 7. The improvement factor I is the max of the ratio\n        # I = M_s / M_m = (gamma * M_hat_s) / (gamma * M_hat_m)\n        # M_hat_m = 1 because g_m(x) = f(x). So, I = M_hat_s.\n        improvement_factor = np.max(ratio_s)\n        results.append(improvement_factor)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2370829"}]}