{"hands_on_practices": [{"introduction": "格子玻尔兹曼方法 (Lattice Boltzmann Method, LBM) 的核心魅力在于其简洁的微观规则能够准确地重现宏观流体行为。本练习将引导你运用 Chapman-Enskog 展开这一关键数学工具，揭示 LBM 动理学方程与宏观纳维-斯托克斯方程之间的深刻联系。通过亲手推导运动粘度表达式，你将深刻理解松弛时间 $\\tau$ 这一微观参数如何直接决定流体的宏观物理性质，从而为 LBM 的可靠性建立坚实的理论基础。[@problem_id:2501012]", "problem": "考虑一种用于模拟等温、弱可压流动的非热格子玻尔兹曼方法（LBM），该方法使用单弛豫时间 Bhatnagar-Gross-Krook (BGK) 碰撞模型。其离散动理学方程为\n$$\nf_i(\\mathbf{x}+\\mathbf{e}_i \\,\\Delta t,\\, t+\\Delta t) - f_i(\\mathbf{x},t) \\;=\\; -\\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t)-f_i^{\\mathrm{eq}}(\\mathbf{x},t)\\right],\n$$\n其中，$f_i$ 是与离散速度 $\\mathbf{e}_i$ 相关的离散分布函数，$f_i^{\\mathrm{eq}}$ 是其局域平衡态，$\\tau$ 是弛豫时间，$\\Delta t$ 是时间步长。局域流体动力学场由以下公式定义：\n$$\n\\rho \\;=\\; \\sum_i f_i, \\qquad \\rho \\,\\mathbf{u} \\;=\\; \\sum_i \\mathbf{e}_i f_i.\n$$\n假设一个二阶等温平衡态分布函数形式如下：\n$$\nf_i^{\\mathrm{eq}} \\;=\\; w_i \\,\\rho \\left[ 1 + \\frac{\\mathbf{e}_i\\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i\\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2 c_s^2} \\right],\n$$\n其中权重 $w_i$ 和格子声速 $c_s$ 满足各向同性约束：\n$$\n\\sum_i w_i \\;=\\; 1,\\quad \\sum_i w_i\\, e_{i\\alpha} \\;=\\; 0,\\quad \\sum_i w_i\\, e_{i\\alpha} e_{i\\beta} \\;=\\; c_s^2 \\delta_{\\alpha\\beta},\\quad \\sum_i w_i\\, e_{i\\alpha} e_{i\\beta} e_{i\\gamma} \\;=\\; 0,\n$$\n和\n$$\n\\sum_i w_i\\, e_{i\\alpha} e_{i\\beta} e_{i\\gamma} e_{i\\delta} \\;=\\; c_s^4\\left(\\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta} + \\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta} + \\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma}\\right),\n$$\n其中 $\\delta_{\\alpha\\beta}$ 是 Kronecker δ函数，希腊字母下标表示笛卡尔分量，并遵循爱因斯坦求和约定。利用在空间和时间尺度上展开至二阶的 Chapman-Enskog 展开方法，从离散动理学方程本身以及上述平衡态和各向同性关系出发（但不预先假设任何目标宏观输运系数），推导出所涌现的 Navier-Stokes 动量方程，并用 $\\tau$, $\\Delta t$ 和 $c_s$ 表示运动粘度 $\\nu$.\n\n然后，根据您的推导，陈述为保证运动粘度为非负值时对 $\\tau$ 的约束条件，并从耗散的角度解释其物理意义。您的解释必须基于推导出的宏观方程的结构，而不是借助外部公式。\n\n请将最终答案表示为仅包含 $\\tau$, $\\Delta t$ 和 $c_s$ 的单一闭式解析表达式。最终答案框中不要包含任何单位。无需进行数值计算。", "solution": "本题要求使用 Chapman-Enskog 展开推导等温格子玻尔兹曼模型的运动粘度 $\\nu$。我们首先验证问题陈述的有效性。\n\n题目给出了 Bhatnagar-Gross-Krook (BGK) 模型的离散动理学方程、宏观密度 $\\rho$ 和动量 $\\rho \\mathbf{u}$ 的定义、二阶等温平衡分布函数 $f_i^{\\mathrm{eq}}$，以及格子权重 $w_i$ 和速度 $\\mathbf{e}_i$ 所需的各向同性条件。所有给定的方程和定义在格子玻尔兹曼方法（LBM）的理论框架内都是标准且正确的。该问题是自洽的，其科学基础植根于计算流体动力学的既定理论，且提问客观。因此，该问题被认定为有效，我们可以着手求解。\n\n我们的出发点是离散的 LBM 方程：\n$$\nf_i(\\mathbf{x}+\\mathbf{e}_i \\Delta t, t+\\Delta t) - f_i(\\mathbf{x},t) = -\\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t)-f_i^{\\mathrm{eq}}(\\mathbf{x},t)\\right]\n$$\n其中 $f_i$ 是粒子分布函数，$\\mathbf{e}_i$ 是离散速度，$\\Delta t$ 是时间步长，$\\tau$ 是弛豫时间。我们对左侧在 $\\Delta t$ 上进行泰勒展开至二阶：\n$$\n\\Delta t \\left(\\partial_t + \\mathbf{e}_i \\cdot \\nabla\\right) f_i + \\frac{(\\Delta t)^2}{2} \\left(\\partial_t + \\mathbf{e}_i \\cdot \\nabla\\right)^2 f_i + O((\\Delta t)^3) = -\\frac{\\Delta t}{\\tau}\\left(f_i-f_i^{\\mathrm{eq}}\\right)\n$$\n两边同除以 $\\Delta t$，我们得到带有修正项的连续类玻尔兹曼方程：\n$$\n\\left(\\partial_t + \\mathbf{e}_i \\cdot \\nabla\\right) f_i + \\frac{\\Delta t}{2} \\left(\\partial_t + \\mathbf{e}_i \\cdot \\nabla\\right)^2 f_i = -\\frac{1}{\\tau}\\left(f_i-f_i^{\\mathrm{eq}}\\right)\n$$\n我们引入算子 $D_i = \\partial_t + \\mathbf{e}_i \\cdot \\nabla$。方程变为：\n$$\nD_i f_i + \\frac{\\Delta t}{2} D_i^2 f_i = -\\frac{1}{\\tau}\\left(f_i-f_i^{\\mathrm{eq}}\\right)\n$$\n现在我们应用 Chapman-Enskog 多尺度展开。我们引入一个形式上的小参数 $\\epsilon$（与 Knudsen 数相关），并展开分布函数和导数：\n$$\nf_i = f_i^{(0)} + \\epsilon f_i^{(1)} + \\epsilon^2 f_i^{(2)} + \\dots\n$$\n$$\n\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}, \\qquad \\nabla = \\epsilon \\nabla_1\n$$\n根据定义，零阶分布是平衡分布，即 $f_i^{(0)} = f_i^{\\mathrm{eq}}$。宏观场 $\\rho$ 和 $\\mathbf{u}$ 完全由平衡分布决定，这对非平衡部分施加了以下条件：\n$$\n\\sum_i f_i^{(k)} = 0 \\quad \\text{and} \\quad \\sum_i \\mathbf{e}_i f_i^{(k)} = \\mathbf{0} \\quad \\text{for } k \\geq 1\n$$\n将展开式代入动理学方程，并按 $\\epsilon$ 的幂次整理各项：\n\n在 $\\epsilon^1$ 阶：\n$$\n(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(1)}\n$$\n令 $D_{i1} = \\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1$，我们得到一阶非平衡分布：\n$$\nf_i^{(1)} = -\\tau D_{i1} f_i^{(0)}\n$$\n\n在 $\\epsilon^2$ 阶：\n$$\n\\partial_{t_2} f_i^{(0)} + (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(1)} + \\frac{\\Delta t}{2} (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)}\n$$\n使用 $D_{i1}$ 记号，上式变为：\n$$\n\\partial_{t_2} f_i^{(0)} + D_{i1} f_i^{(1)} + \\frac{\\Delta t}{2} D_{i1}^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)}\n$$\n代入 $f_i^{(1)}$ 的表达式：\n$$\n\\partial_{t_2} f_i^{(0)} + D_{i1} (-\\tau D_{i1} f_i^{(0)}) + \\frac{\\Delta t}{2} D_{i1}^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)}\n$$\n$$\n\\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{\\Delta t}{2}\\right) D_{i1}^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)}\n$$\n现在，我们通过对这些尺度化方程取矩来推导宏观方程。\n对 $\\epsilon^1$ 阶方程取零阶矩（$\\sum_i$）和一阶矩（$\\sum_i \\mathbf{e}_i$）可得到气体动力学的 Euler 方程：\n$$\n\\partial_{t_1} \\rho + \\nabla_1 \\cdot (\\rho \\mathbf{u}) = 0\n$$\n$$\n\\partial_{t_1} (\\rho u_\\alpha) + \\partial_{1\\beta} \\Pi_{\\alpha\\beta}^{(0)} = 0\n$$\n其中 $\\Pi_{\\alpha\\beta}^{(0)} = \\sum_i e_{i\\alpha} e_{i\\beta} f_i^{(0)}$。利用给定的 $f_i^{\\mathrm{eq}}$ 和各向同性条件，可以证明 $\\Pi_{\\alpha\\beta}^{(0)} = \\rho u_\\alpha u_\\beta + p \\delta_{\\alpha\\beta}$，其中压力 $p = \\rho c_s^2$。\n\n为了得到 Navier-Stokes 方程的耗散项，我们分析 $\\epsilon^2$ 尺度的方程。完整的动量方程通过对各尺度的贡献求和得到：$\\partial_t(\\rho u_\\alpha) = \\epsilon \\partial_{t_1}(\\rho u_\\alpha) + \\epsilon^2 \\partial_{t_2}(\\rho u_\\alpha) + \\dots$。\n$\\partial_t (\\rho u_\\alpha) + \\partial_\\beta \\Pi_{\\alpha\\beta}^{(0)} = \\epsilon (\\partial_{t_1}(\\rho u_\\alpha) + \\partial_{1\\beta}\\Pi_{\\alpha\\beta}^{(0)}) + \\epsilon^2 (\\partial_{t_2}(\\rho u_\\alpha) + \\partial_{1\\beta}\\Pi_{\\alpha\\beta}^{(1)}) + \\dots$\n由于 Euler 动量方程，$\\epsilon$ 阶项为零。领头阶的修正是粘性效应的来源。\n$$\n\\partial_t (\\rho u_\\alpha) + \\partial_\\beta \\Pi_{\\alpha\\beta}^{(0)} = \\epsilon^2 \\left( \\partial_{t_2}(\\rho u_\\alpha) + \\partial_{1\\beta} \\Pi_{\\alpha\\beta}^{(1)} \\right)\n$$\n$\\partial_{1\\beta} \\Pi_{\\alpha\\beta}^{(1)}$ 项可以被证明产生粘性，但这个过程比较复杂。一个更直接的方法是对 $\\epsilon^2$ 阶动理学方程取一阶矩。\n$$\n\\sum_i e_{i\\alpha} \\left[ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{\\Delta t}{2}\\right) D_{i1}^2 f_i^{(0)} \\right] = -\\frac{1}{\\tau} \\sum_i e_{i\\alpha} f_i^{(2)}\n$$\n由于施加的守恒约束 $\\sum_i \\mathbf{e}_i f_i^{(2)} = \\mathbf{0}$，右侧为零。这得到：\n$$\n\\partial_{t_2}(\\rho u_\\alpha) = \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\sum_i e_{i\\alpha} D_{i1}^2 f_i^{(0)}\n$$\n我们在低马赫数极限下（$|\\mathbf{u}| \\ll c_s$, $\\rho \\approx \\rho_0 \\approx \\text{const}$）计算右侧的和。\n$$\n\\sum_i e_{i\\alpha} D_{i1}^2 f_i^{(0)} = \\sum_i e_{i\\alpha} (\\partial_{t_1} + e_{i\\gamma}\\partial_{1\\gamma})^2 f_i^{(0)} = \\partial_{t_1}\\nabla_{1\\beta} \\Pi_{\\alpha\\beta}^{(0)} + \\partial_{1\\beta}\\partial_{1\\gamma} \\sum_i e_{i\\alpha}e_{i\\beta}e_{i\\gamma}f_i^{(0)}\n$$\n时间导数项包含了声波传播效应，其马赫数阶数高于粘性项。我们忽略它。剩余项涉及 $f_i^{(0)}$ 的三阶矩张量 $T_{\\alpha\\beta\\gamma}^{(0)} = \\sum_i e_{i\\alpha}e_{i\\beta}e_{i\\gamma}f_i^{(0)}$。对于低马赫数，$f_i^{(0)} \\approx w_i \\rho (1 + \\frac{\\mathbf{e}_i\\cdot\\mathbf{u}}{c_s^2})$，这给出 $T_{\\alpha\\beta\\gamma}^{(0)} \\approx \\rho c_s^2 (u_\\gamma \\delta_{\\alpha\\beta} + u_\\beta \\delta_{\\alpha\\gamma} + u_\\alpha \\delta_{\\beta\\gamma})$。\n因此，我们有：\n$$\n\\partial_{t_2}(\\rho u_\\alpha) \\approx \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\partial_{1\\beta}\\partial_{1\\gamma} T_{\\alpha\\beta\\gamma}^{(0)} = \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\rho c_s^2 \\partial_{1\\beta}\\partial_{1\\gamma} (u_\\gamma \\delta_{\\alpha\\beta} + u_\\beta\\delta_{\\alpha\\gamma} + u_\\alpha\\delta_{\\beta\\gamma})\n$$\n$$\n\\partial_{t_2}(\\rho u_\\alpha) \\approx \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\rho c_s^2 \\left( \\partial_{1\\beta}\\partial_{1\\alpha}u_\\beta + \\partial_{1\\beta}\\partial_{1\\beta}u_\\alpha + \\partial_{1\\alpha}\\partial_{1\\beta}u_\\beta \\right) = \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\rho c_s^2 \\left( \\nabla_1^2 u_\\alpha + 2\\partial_{1\\alpha}(\\nabla_1 \\cdot \\mathbf{u}) \\right)\n$$\n重构完整的动量方程并恢复到物理尺度（$\\epsilon=1, \\partial_{1\\alpha} \\to \\partial_\\alpha$）：\n$$\n\\partial_t(\\rho u_\\alpha) + \\partial_\\beta(\\rho u_\\alpha u_\\beta + p\\delta_{\\alpha\\beta}) = \\left(\\tau - \\frac{\\Delta t}{2}\\right) \\rho c_s^2 \\left( \\nabla^2 u_\\alpha + 2\\partial_\\alpha(\\nabla \\cdot \\mathbf{u}) \\right)\n$$\n右侧是粘性应力张量 $\\partial_\\beta \\sigma'_{\\alpha\\beta}$ 的散度。Navier-Stokes 粘性项的标准形式是 $\\partial_\\beta \\left[ \\mu(\\partial_\\alpha u_\\beta + \\partial_\\beta u_\\alpha) + \\lambda\\delta_{\\alpha\\beta}\\nabla\\cdot\\mathbf{u} \\right] = \\mu\\nabla^2 u_\\alpha + (\\mu+\\lambda)\\partial_\\alpha(\\nabla\\cdot\\mathbf{u})$。\n通过将推导出的方程与标准形式进行比较，我们确定动力剪切粘度 $\\mu$ 是 $\\nabla^2 u_\\alpha$ 项的系数：\n$$\n\\mu = \\rho c_s^2 \\left(\\tau - \\frac{\\Delta t}{2}\\right)\n$$\n运动粘度 $\\nu$ 定义为 $\\nu = \\mu/\\rho$。因此：\n$$\n\\nu = c_s^2 \\left(\\tau - \\frac{\\Delta t}{2}\\right)\n$$\n为使涌现的流体动力学具有物理意义，系统必须是耗散的，这要求运动粘度为非负，即 $\\nu \\ge 0$。由于 $c_s^2 > 0$，这施加了稳定性约束：\n$$\n\\tau - \\frac{\\Delta t}{2} \\ge 0 \\quad \\implies \\quad \\tau \\ge \\frac{\\Delta t}{2}\n$$\n这一约束的物理相关性植根于热力学第二定律，该定律要求粘性流中存在耗散。负粘度将意味着反耗散，即动能从热浴中自发产生，导致速度涨落的无控制增长和数值不稳定性。$-\\frac{\\Delta t}{2} c_s^2$ 项可以解释为一种负的“数值粘度”，它纯粹由动理学方程在时间和空间上的离散化产生。由 $\\tau c_s^2$ 代表的物理弛豫机制必须足够强，以克服这种数值反耗散，从而确保总粘度为正，并使模拟保持稳定。", "answer": "$$\n\\boxed{c_s^2 \\left( \\tau - \\frac{\\Delta t}{2} \\right)}\n$$", "id": "2501012"}, {"introduction": "在掌握了理论基础之后，动手实现是检验和深化理解的最佳方式。本练习要求你编写一个完整的三维 LBM 模拟程序，以经典的泰勒-格林涡流问题作为基准进行测试。通过将模拟结果与精确的解析解进行对比，你不仅能获得宝贵的编程和代码验证经验，还能通过比较 D3Q19 和 D3Q15 两种不同晶格模型的精度，直观地感受模型选择对模拟结果的影响。[@problem_id:2407073]", "problem": "实现一个独立的程序，模拟用于三维不可压流的等温单弛豫时间玻尔兹曼 Bhatnagar-Gross-Krook (BGK) 格子玻尔兹曼方法。程序需使用 D3Q19 和 D3Q15 两种速度集，并针对衰减的泰勒-格林涡问题比较它们的精度。所有物理量均以格子单位表示，其中格子间距 $\\Delta x$ 和时间步长 $\\Delta t$ 均等于 $1$。\n\n离散速度集和权重如下。\n\n对于 D3Q19，离散速度 $\\{\\mathbf{c}_i\\}_{i=0}^{18}$ 和权重 $\\{w_i\\}_{i=0}^{18}$ 为：\n- 一个静止速度：$\\mathbf{c}_0=(0,0,0)$，权重 $w_0=\\tfrac{1}{3}$。\n- 六个面心速度：$(\\pm 1,0,0)$, $(0,\\pm 1,0)$, $(0,0,\\pm 1)$，权重 $w_i=\\tfrac{1}{18}$。\n- 十二个边心速度：$(\\pm 1,\\pm 1,0)$, $(\\pm 1,0,\\pm 1)$, $(0,\\pm 1,\\pm 1)$，权重 $w_i=\\tfrac{1}{36}$。\n\n对于 D3Q15，离散速度 $\\{\\mathbf{c}_i\\}_{i=0}^{14}$ 和权重 $\\{w_i\\}_{i=0}^{14}$ 为：\n- 一个静止速度：$\\mathbf{c}_0=(0,0,0)$，权重 $w_0=\\tfrac{2}{9}$。\n- 六个面心速度：$(\\pm 1,0,0)$, $(0,\\pm 1,0)$, $(0,0,\\pm 1)$，权重 $w_i=\\tfrac{1}{9}$。\n- 八个角点速度：$(\\pm 1,\\pm 1,\\pm 1)$，权重 $w_i=\\tfrac{1}{72}$。\n\n对于这两种速度集，等温格子声速均满足 $c_s^2=\\tfrac{1}{3}$。格子单位下的运动粘度 $\\nu$ 与弛豫时间 $\\tau$ 的关系为 $\\nu=c_s^2(\\tau-\\tfrac{1}{2})$。\n\n考虑一个三重周期性立方体区域，每个坐标方向上有 $N$ 个节点，并采用周期性边界条件。设时间 $t=0$ 时的初始条件为无散的泰勒-格林涡\n$$\nu_x(x,y,z,0)=U_0\\sin\\left(\\frac{2\\pi x}{N}\\right)\\cos\\left(\\frac{2\\pi y}{N}\\right)\\cos\\left(\\frac{2\\pi z}{N}\\right), \\quad\nu_y(x,y,z,0)=-U_0\\cos\\left(\\frac{2\\pi x}{N}\\right)\\sin\\left(\\frac{2\\pi y}{N}\\right)\\cos\\left(\\frac{2\\pi z}{N}\\right), \\quad\nu_z(x,y,z,0)=0,\n$$\n密度均匀，为 $\\rho(x,y,z,0)=1$。对于不可压纳维-斯托克斯方程的相应衰减解，速度场保持相同的空间形式，并随时间按如下规律衰减\n$$\n\\mathbf{u}(x,y,z,t)=\\mathbf{u}(x,y,z,0)\\exp\\left(-\\nu k^2 t\\right), \\quad \\text{其中 } k^2=3\\left(\\frac{2\\pi}{N}\\right)^2.\n$$\n\n使用 BGK 碰撞算子和全方向周期性边界条件，实现 D3Q19 和 D3Q15 两种模型。从初始条件开始演化指定的步数 $T$，并计算在时间 $t=T$ 时，数值速度场相对于泰勒-格林涡解析解的相对 $\\ell^2$ 误差：\n$$\nE=\\frac{\\left\\|\\mathbf{u}_{\\text{num}}(\\cdot,T)-\\mathbf{u}_{\\text{ana}}(\\cdot,T)\\right\\|_2}{\\left\\|\\mathbf{u}_{\\text{ana}}(\\cdot,T)\\right\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示在所有网格节点和所有三个速度分量上计算的离散 $\\ell^2$ 范数。\n\n使用以下测试套件，每个案例指定 $(N,\\tau,T,U_0)$:\n- 案例 A (通用): $(N,\\tau,T,U_0)=\\left(16,\\,0.8,\\,60,\\,0.05\\right)$。\n- 案例 B (较低粘度): $(N,\\tau,T,U_0)=\\left(16,\\,0.6,\\,60,\\,0.05\\right)$。\n- 案例 C (更粗网格，更短时间): $(N,\\tau,T,U_0)=\\left(8,\\,0.8,\\,20,\\,0.05\\right)$。\n\n对于每个案例，计算 D3Q19 的误差 $E_{19}$ 和 D3Q15 的误差 $E_{15}$，并确定布尔值 $B$。当且仅当 $E_{19}<E_{15}$ 时，$B$ 为真。\n\n您的程序应生成单行输出，其中包含三个案例的结果，结果为逗号分隔的列表，并用方括号括起来，顺序如下：\n$$\n\\left[E_{19}^{(A)},E_{15}^{(A)},B^{(A)},E_{19}^{(B)},E_{15}^{(B)},B^{(B)},E_{19}^{(C)},E_{15}^{(C)},B^{(C)}\\right],\n$$\n其中每个 $E$ 值必须四舍五入到恰好六位小数。不应打印其他任何文本。", "solution": "所提出的问题是计算流体力学领域中一个定义明确的标准基准测试，用于验证数值格式。该问题被称为衰减的泰勒-格林涡。问题陈述具有科学依据、内部一致，并包含了获得唯一解所需的所有必要信息。它要求实现并比较用于三维格子玻尔兹曼方法 (LBM) 的两种常见格子结构：D3Q19 和 D3Q15。验证已成功，并将提供一个解决方案。\n\n解决方案的核心是采用 Bhatnagar-Gross-Krook (BGK) 单弛豫时间碰撞算子的格子玻尔兹曼方法 (LBM)。在 LBM 中，流体动力学通过在规则格子上追踪离散粒子分布函数 $f_i(\\mathbf{x}, t)$ 的演化来模拟。每个函数 $f_i$ 代表在时间 $t$、格子节点 $\\mathbf{x}$ 处，以离散速度 $\\mathbf{c}_i$ 运动的流体粒子布居数。这些布居数的演化由格子玻尔兹曼方程控制：\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i\\Delta t, t + \\Delta t) - f_i(\\mathbf{x}, t) = \\Omega_i\n$$\n其中 $\\Omega_i$ 是碰撞算子。问题指定了 BGK 模型，其中 $\\Omega_i = -\\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)]$。这里，$\\tau$ 是弛豫时间，$f_i^{eq}$ 是局部平衡分布函数。\n\n在每个时间增量 $\\Delta t$ 内，模拟分为两个步骤进行：\n\n1.  **碰撞步：** 在每个格子节点上，粒子分布向其局部平衡态弛豫。碰撞后的状态 $f_i^*$ 计算如下：\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)]\n    $$\n\n2.  **迁移步：** 碰撞后的分布 $f_i^*$ 根据其速度传播到相邻的格子节点：\n    $$\n    f_i(\\mathbf{x} + \\mathbf{c}_i, t + 1) = f_i^*(\\mathbf{x}, t)\n    $$\n    如问题所述，我们在格子单位下工作，其中格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$。\n\n宏观流体属性，特别是密度 $\\rho$ 和速度 $\\mathbf{u}$，作为分布函数的矩来计算：\n$$\n\\rho = \\sum_{i} f_i\n$$\n$$\n\\rho\\mathbf{u} = \\sum_{i} f_i \\mathbf{c}_i\n$$\n\n平衡分布函数 $f_i^{eq}$ 是局部宏观属性的函数。对于近乎不可压的流动，速度的二阶展开是足够的：\n$$\nf_i^{eq}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right]\n$$\n其中 $w_i$ 是特定模型的权重，$c_s$ 是格子声速，对于两种模型均给定为 $c_s^2 = \\frac{1}{3}$。\n\n问题要求实现两个速度集：D3Q19（3 维，19 个速度）和 D3Q15（3 维，15 个速度）。离散速度 $\\{\\mathbf{c}_i\\}$ 和权重 $\\{w_i\\}$ 在问题陈述中已提供，它们是定义特定 LBM 模型的基础。运动粘度 $\\nu$ 通过 $\\nu = c_s^2(\\tau - 0.5)$ 与弛豫时间相关。\n\n模拟方法如下：\n\n**1. 初始化：**\n定义一个大小为 $N \\times N \\times N$ 的立方体区域。根据给定的泰勒-格林涡公式，初始化宏观速度场 $\\mathbf{u}(\\mathbf{x}, 0)$ 和密度场 $\\rho(\\mathbf{x}, 0)$。\n-   对所有 $\\mathbf{x}$，$\\rho(\\mathbf{x}, 0) = 1$。\n-   $\\mathbf{u}(\\mathbf{x}, 0) = [u_x(0), u_y(0), u_z(0)]$，如问题中所定义。\n为确保一致性，初始粒子分布 $f_i(\\mathbf{x}, 0)$ 设置为其平衡值 $f_i^{eq}(\\rho(\\mathbf{x}, 0), \\mathbf{u}(\\mathbf{x}, 0))$。\n\n**2. 时间演化：**\n模拟演化 $T$ 个时间步。在每个步骤中：\na.  从当前分布 $f_i(t)$ 计算宏观量 $\\rho(t)$ 和 $\\mathbf{u}(t)$。\nb.  使用这些新的宏观值计算平衡分布 $f_i^{eq}(t)$。\nc.  执行碰撞步以获得 $f_i^*(t)$。\nd.  执行迁移步以获得 $f_i(t+1)$。对于指定的周期性边界条件，这可以通过对分布函数数组执行循环移位操作来高效实现。\n\n**3. 误差计算：**\n经过 $T$ 步后，从最终分布 $f_i(\\mathbf{x}, T)$ 计算出最终的数值速度场 $\\mathbf{u}_{\\text{num}}(\\mathbf{x}, T)$。将其与衰减的泰勒-格林涡的解析解进行比较：\n$$\n\\mathbf{u}_{\\text{ana}}(x,y,z,T) = \\mathbf{u}(x,y,z,0)\\exp\\left(-\\nu k^2 T\\right)\n$$\n其中衰减波数为 $k^2=3\\left(\\frac{2\\pi}{N}\\right)^2$，粘度为 $\\nu = \\frac{1}{3}(\\tau-\\frac{1}{2})$。\n然后按规定计算相对 $\\ell^2$ 误差 $E$：\n$$\nE=\\frac{\\left\\|\\mathbf{u}_{\\text{num}}(\\cdot,T)-\\mathbf{u}_{\\text{ana}}(\\cdot,T)\\right\\|_2}{\\left\\|\\mathbf{u}_{\\text{ana}}(\\cdot,T)\\right\\|_2}\n$$\n范数 $\\|\\cdot\\|_2$ 是在所有网格节点和所有三个速度分量上计算的标准欧几里得范数。\n\n对每个测试案例（A、B、C）以及 D3Q19 和 D3Q15 两种模型重复此过程。数值实现利用 `numpy` 库进行高效的矢量化数组操作，这对此类模拟的性能至关重要。具体来说，`np.einsum` 用于矩计算中的缩并运算，`np.roll` 用于迁移步骤。", "answer": "```python\n# The final answer must be a single, complete, standalone program.\n# It solves the problem by simulating a 3D Taylor-Green vortex flow using LBM.\n\nimport numpy as np\n# from scipy import ... # Scipy is not required for this problem.\n\ndef get_lattice_models():\n    \"\"\"Defines the D3Q19 and D3Q15 lattice models.\"\"\"\n    # D3Q19 Model\n    c19 = np.array([\n        [0, 0, 0], [1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0],\n        [0, 0, 1], [0, 0, -1], [1, 1, 0], [-1, 1, 0], [1, -1, 0],\n        [-1, -1, 0], [1, 0, 1], [-1, 0, 1], [1, 0, -1],\n        [-1, 0, -1], [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]\n    ], dtype=int)\n    w19 = np.array([\n        1/3] + [1/18]*6 + [1/36]*12\n    )\n\n    # D3Q15 Model\n    c15 = np.array([\n        [0, 0, 0], [1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0],\n        [0, 0, 1], [0, 0, -1], [1, 1, 1], [-1, 1, 1], [1, -1, 1],\n        [1, 1, -1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1],\n        [-1, -1, -1]\n    ], dtype=int)\n    w15 = np.array([\n        2/9] + [1/9]*6 + [1/72]*8\n    )\n\n    return (c19, w19), (c15, w15)\n\ndef run_lbm(N, tau, T, U0, lattice_c, lattice_w):\n    \"\"\"\n    Runs a 3D LBM simulation for the Taylor-Green vortex.\n    \n    Args:\n        N (int): Number of nodes in each direction.\n        tau (float): Relaxation time.\n        T (int): Total number of time steps.\n        U0 (float): Initial velocity amplitude.\n        lattice_c (np.ndarray): Discrete velocities, shape (Q, 3).\n        lattice_w (np.ndarray): Weights, shape (Q,).\n        \n    Returns:\n        float: The relative l2 error of the velocity field at time T.\n    \"\"\"\n    Q = lattice_c.shape[0]\n    cs_sq = 1/3.0\n    \n    # 1. Initialization\n    x, y, z = np.mgrid[0:N, 0:N, 0:N]\n    twopi_N = 2 * np.pi / N\n    \n    u0 = np.zeros((3, N, N, N))\n    u0[0] = U0 * np.sin(twopi_N * x) * np.cos(twopi_N * y) * np.cos(twopi_N * z)\n    u0[1] = -U0 * np.cos(twopi_N * x) * np.sin(twopi_N * y) * np.cos(twopi_N * z)\n    \n    rho0 = np.ones((N, N, N))\n    \n    # Initialize f at equilibrium f_eq(rho0, u0)\n    u_dot_c_0 = np.einsum('ia,axyz->ixyz', lattice_c, u0)\n    u0_sq = np.einsum('axyz,axyz->xyz', u0, u0)\n    \n    term1_0 = u_dot_c_0 / cs_sq\n    term2_0 = 0.5 * (u_dot_c_0**2) / (cs_sq**2)\n    term3_0 = -0.5 * u0_sq / cs_sq\n\n    f = (lattice_w[:, None, None, None] * rho0[None, :, :, :] *\n         (1 + term1_0 + term2_0 + term3_0[None, :, :, :]))\n    \n    inv_tau = 1.0 / tau\n\n    # 2. Main Loop\n    for _ in range(T):\n        # Macroscopic quantities\n        rho = np.sum(f, axis=0)\n        u = np.einsum('ia,ixyz->axyz', lattice_c, f) / rho\n        \n        # Collision step\n        u_dot_c = np.einsum('ia,axyz->ixyz', lattice_c, u)\n        u_sq = np.einsum('axyz,axyz->xyz', u, u)\n        \n        term1 = u_dot_c / cs_sq\n        term2 = 0.5 * (u_dot_c**2) / (cs_sq**2)\n        term3 = -0.5 * u_sq / cs_sq\n        \n        f_eq = (lattice_w[:, None, None, None] * rho[None, :, :, :] *\n                (1 + term1 + term2 + term3[None, :, :, :]))\n        \n        f -= inv_tau * (f - f_eq)\n        \n        # Streaming step\n        for i in range(Q):\n            f[i] = np.roll(f[i], shift=lattice_c[i], axis=(0, 1, 2))\n\n    # 3. Post-processing\n    rho_final = np.sum(f, axis=0)\n    u_num = np.einsum('ia,ixyz->axyz', lattice_c, f) / rho_final\n\n    # Analytical velocity at T\n    nu = cs_sq * (tau - 0.5)\n    k_sq = 3 * (twopi_N**2)\n    decay = np.exp(-nu * k_sq * T)\n    u_ana = u0 * decay\n    \n    # Error calculation\n    diff_sq_sum = np.sum((u_num - u_ana)**2)\n    ana_sq_sum = np.sum(u_ana**2)\n    \n    error = np.sqrt(diff_sq_sum / ana_sq_sum)\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    d3q19_model, d3q15_model = get_lattice_models()\n    c19, w19 = d3q19_model\n    c15, w15 = d3q15_model\n\n    test_cases = [\n        # Case A (general)\n        (16, 0.8, 60, 0.05),\n        # Case B (lower viscosity)\n        (16, 0.6, 60, 0.05),\n        # Case C (coarser grid, shorter time)\n        (8, 0.8, 20, 0.05),\n    ]\n\n    results = []\n    for N, tau, T, U0 in test_cases:\n        E19 = run_lbm(N, tau, T, U0, c19, w19)\n        E15 = run_lbm(N, tau, T, U0, c15, w15)\n        B = E19  E15\n        \n        results.append(f\"{E19:.6f}\")\n        results.append(f\"{E15:.6f}\")\n        results.append(str(B))\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2407073"}, {"introduction": "任何流体模拟的成败都离不开对边界条件的精确处理。本练习将焦点转向 LBM 中一个关键且精妙的领域：边界条件的设计。你将探索如何为热流问题构建边界，并推导一个特定的微观反弹格式如何等效于宏观层面上的 Robin 型边界条件，从而产生温度跳跃（热滑移）现象。这个过程完美地展示了 LBM 的优雅之处——通过简单的局部规则，即可在宏观上实现复杂的物理效应。[@problem_id:458581]", "problem": "格子玻尔兹曼方法（LBM）是一种强大的流体动力学模拟数值技术，它通过在离散格子上追踪粒子分布函数 $f_i(\\vec{x}, t)$ 的演化，在介观尺度上进行操作。对于热流问题，通常会引入第二个分布函数 $g_i(\\vec{x}, t)$ 来表示热能场。\n\n考虑一个由BGK（Bhatnagar-Gross-Krook）碰撞模型控制的、在静止介质中进行热传导的热LBM模拟。对于离散方向 $i$，热分布函数 $g_i(\\vec{x}, t)$ 的演化方程由下式给出：\n$$\ng_i(\\vec{x} + \\vec{c}_i \\delta t, t + \\delta t) - g_i(\\vec{x}, t) = -\\frac{\\delta t}{\\tau_g} \\left( g_i(\\vec{x}, t) - g_i^{\\text{eq}}(\\vec{x}, t) \\right)\n$$\n其中 $\\vec{c}_i$ 是离散格子速度，$\\delta t$ 是时间步长（下文设为1），$\\tau_g$ 是热场的弛豫时间。\n\n宏观温度 $T$ 定义为分布函数的零阶矩：\n$$\nT(\\vec{x}, t) = \\sum_i g_i(\\vec{x}, t)\n$$\n对于静止流体（$\\vec{u}=0$），相应的平衡分布函数 $g_i^{\\text{eq}}$ 为：\n$$\ng_i^{\\text{eq}} = w_i T\n$$\n其中 $w_i$ 是与每个方向 $i$ 相关联的权重因子。该模拟在二维九速（D2Q9）格子上进行。格子速度为 $\\vec{c}_0=(0,0)$、$\\vec{c}_{1-4}=(\\pm 1, 0), (0, \\pm 1)$ 和 $\\vec{c}_{5-8}=(\\pm 1, \\pm 1)$。相应的权重为 $w_0=4/9$、$w_{1-4}=1/9$ 和 $w_{5-8}=1/36$。\n\n在 $y=0$ 处有一个固定的静止边界。为了模拟该壁面上的热效应，我们应用一个特定的边界条件。我们将分布函数相对于给定壁面温度 $T_w$ 的非平衡部分定义为 $g'_i = g_i - w_i T_w$。该边界条件是对这个非平衡部分应用的修正反弹格式。对于离开壁面进入流体域的粒子群 $i$（即速度的y分量 $c_{iy}  0$），该格式由下式给出：\n$$\ng'_i(\\vec{x}_w) = A \\, g'_{\\bar{i}}(\\vec{x}_w)\n$$\n其中 $\\vec{x}_w$ 是壁面上的一个格点，$A$ 是一个常数参数，$\\bar{i}$ 表示与 $i$ 相反的方向（即 $\\vec{c}_{\\bar{i}} = -\\vec{c}_i$）。入射的粒子群 $g'_{\\bar{i}}$ 由壁面附近的流体状态决定。\n\n已知这种介观边界规则会在壁面上产生一个宏观温度跳跃（或热滑移），它由一个Robin型边界条件描述：\n$$\nT(\\vec{x}_w) - T_w = \\lambda_T \\frac{\\partial T}{\\partial y}\\bigg|_{\\vec{x}_w}\n$$\n这里，$T(\\vec{x}_w)$ 是壁面处的有效流体温度，而 $\\lambda_T$ 是温度跳跃长度。\n\n使用对入射非平衡分布的一阶Chapman-Enskog展开，推导用边界参数 $A$ 和热弛豫时间 $\\tau_g$ 表示的温度跳跃长度 $\\lambda_T$ 的表达式。", "solution": "我们通过应用给定的介观边界规则和一阶Chapman-Enskog展开，来求解用 $A$ 和 $\\tau_g$ 表示的宏观温度跳跃\n$$\\Delta T \\equiv T(\\vec x_w)-T_w$$\n\n1. 定义壁面处的非平衡部分：\n   $$g'_i(\\vec x_w)=g_i(\\vec x_w)-w_iT_w\\,. $$\n\n2. 对于静止介质，Chapman-Enskog展开到一阶精度（克努森数）可得\n   $$g_i(\\vec x,t)=g_i^{\\rm eq}+g_i^{(1)},\\qquad \n     g_i^{(1)}=-\\tau_g\\,\\bigl(\\vec c_i\\cdot\\nabla\\bigr)g_i^{\\rm eq}\\,. $$\n   由于 $g_i^{\\rm eq}=w_iT$，在壁面处 $\\partial_tT=0$，且仅剩下 $y$ 方向的梯度：\n   $$g_i^{(1)}=-\\tau_g\\,c_{iy}\\,w_i\\,\\partial_yT\\Big|_{w}\\,. $$\n\n3. 因此，与 $w_iT_w$ 的总偏差为\n   $$g'_i=-\\tau_g\\,c_{iy}\\,w_i\\,\\partial_yT\\Big|_{w}+w_i\\,(T(\\vec x_w)-T_w)\n        =-\\tau_g\\,c_{iy}\\,w_i\\,\\partial_yT\\Big|_{w}+w_i\\,\\Delta T\\,. $$\n   对于相反方向 $\\bar i$，$c_{\\bar i,y}=-c_{i,y}$ 且 $w_{\\bar i}=w_i$，所以\n   $$g'_{\\bar i}=\\tau_g\\,c_{iy}\\,w_i\\,\\partial_yT\\Big|_{w}+w_i\\,\\Delta T\\,. $$\n\n4. 对于 $c_{iy}0$ 的修正反弹边界条件可写为\n   $$g'_i(\\vec x_w)=A\\,g'_{\\bar i}(\\vec x_w)\\,. $$\n   代入上述展开式并除以 $w_i$ 可得\n   $$-\\tau_g\\,c_{iy}\\,\\partial_yT+\\Delta T\n     =A\\!\\bigl(\\tau_g\\,c_{iy}\\,\\partial_yT+\\Delta T\\bigr)\\,. $$\n\n5. 由于对于在 $y=0$ 处的所有出射方向，都有 $c_{iy}=1$，重新整理可得：\n   $$(1-A)\\,\\Delta T=(A+1)\\,\\tau_g\\,\\partial_yT\\quad\\Longrightarrow\\quad\n     \\Delta T=\\frac{A+1}{1-A}\\,\\tau_g\\,\\partial_yT\\Big|_{w}\\,. $$\n\n6. 根据跳跃长度 $\\lambda_T$ 的定义，$\\Delta T=\\lambda_T\\partial_yT|_{w}$，因此可得跳跃长度的表达式。", "answer": "$$\\boxed{\\frac{\\tau_g\\,(1 + A)}{1 - A}}$$", "id": "458581"}]}