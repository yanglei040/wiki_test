{"hands_on_practices": [{"introduction": "要真正掌握边界元方法（BEM），没有什么比从头开始手动构建并求解一个简单的系统更有效了。这个练习将引导你为一个经典的二维静电学问题——计算两块平行导体板之间的电容——建立一个 $2 \\times 2$ 的BEM系统。通过这个过程，你将亲手应用单层势的基本原理，计算由对数形式的格林函数定义的积分，并最终求解出具有物理意义的电容量，从而将抽象的理论转化为具体的计算步骤。", "problem": "考虑在二维静电学中，有两条完全相同、理想导电的直条带，置于介电常数为 $\\varepsilon$ 的均匀介质中。条带平行于 $x$ 轴，中心分别位于 $y=+h$（上条带）和 $y=-h$（下条带），且每条都从 $x=-a$ 延伸至 $x=+a$。假设在平面外方向上具有不变性（单位深度公式）。\n\n上条带的电势维持在 $+V_{0}/2$，下条带的电势维持在 $-V_{0}/2$，其中 $V_{0} > 0$。将每条条带模拟为单个常数源单元，其上带有未知的均匀线电荷密度 $\\lambda_{1}$（上）和 $\\lambda_{2}$（下），并在每条条带的中心（即每条条带上 $x=0$ 的位置）施加边界条件。\n\n使用直接边界元法以及拉普拉斯方程的二维自由空间基本解，\n$$\nG(\\mathbf{r}) \\;=\\; -\\frac{1}{2\\pi}\\,\\ln\\!\\left(\\frac{|\\mathbf{r}|}{L_{0}}\\right),\n$$\n其中 $L_{0} > 0$ 是一个任意的参考长度，引入该长度是为了使对数的参数无量纲化。写出表示配置点上节点电势的二乘二线性系统（用未知的线电荷密度表示），解析地计算矩阵元素，求解 $\\lambda_{1}$ 和 $\\lambda_{2}$，然后计算单位平面外深度的电容，\n$$\nC' \\;=\\; \\frac{Q'}{V_{0}}, \\quad \\text{其中} \\quad Q' \\;=\\; \\int_{-a}^{a} \\lambda_{1}\\,\\mathrm{d}x \\;=\\; 2a\\,\\lambda_{1}.\n$$\n请以 $\\varepsilon$、$a$ 和 $h$ 表示的 $C'$ 的单个闭式解析表达式的形式给出最终答案。不要进行任何数值近似或四舍五入。以法拉/米（farads per meter）为单位表示单位平面外深度的电容。", "solution": "在尝试任何求解之前，需对问题陈述进行验证。\n\n步骤 1：提取已知条件。\n- 系统：二维静电学中的两条完全相同、理想导电的直条带。\n- 介质：介电常数为 $\\varepsilon$ 的均匀介质。\n- 几何结构：条带平行于 $x$ 轴。上条带中心位于 $y=+h$，下条带中心位于 $y=-h$。每条都从 $x=-a$ 延伸至 $x=+a$。系统在平面外方向上具有不变性。\n- 边界条件：上条带电势为 $\\phi_1 = +V_{0}/2$。下条带电势为 $\\phi_2 = -V_{0}/2$，其中 $V_{0} > 0$。\n- 模型：每条条带是一个单一常数源单元。上条带带有均匀线电荷密度 $\\lambda_{1}$。下条带带有均匀线电荷密度 $\\lambda_{2}$。\n- 方法：直接边界元法（BEM），在每条条带的中心进行配置。上条带的中心为 $\\mathbf{r}_1 = (0, +h)$。下条带的中心为 $\\mathbf{r}_2 = (0,-h)$。\n- 基本解：拉普拉斯方程的二维自由空间格林函数为 $G(\\mathbf{r}) = -\\frac{1}{2\\pi}\\,\\ln\\left(\\frac{|\\mathbf{r}|}{L_{0}}\\right)$，其中 $L_{0} > 0$ 是一个参考长度。\n- 目标：\n  1. 建立节点电势的 $2 \\times 2$ 线性系统。\n  2. 解析地计算矩阵元素。\n  3. 求解 $\\lambda_{1}$ 和 $\\lambda_{2}$。\n  4. 计算单位平面外深度的电容，$C' = Q'/V_{0}$，其中上条带单位深度的总电荷为 $Q' = \\int_{-a}^{a} \\lambda_{1}\\,\\mathrm{d}x = 2a\\,\\lambda_{1}$。\n  5. $C'$ 的最终答案必须是关于 $\\varepsilon$、$a$ 和 $h$ 的闭式表达式。\n\n步骤 2：使用提取的已知条件进行验证。\n- 科学依据：该问题在二维静电学和边界元法的既定框架内提出。所提供的基本解对于二维拉普拉斯方程是正确的，并且使用它从源分布计算电势是标准做法。\n- 适定性：该问题是适定的。它提供了所有必要的信息（几何结构、边界条件、物理属性和简化模型），以在指定模型的约束内确定电容的唯一值。\n- 客观性：问题陈述使用了精确、客观和标准的科学术语。\n- 缺陷清单：该问题未违反任何无效性标准。它在科学上是合理的、可形式化的、完整的、可行的、结构良好的且可验证的。所采用的模型（每条带单个常数单元）是 BEM 中的一种标准粗网格近似。\n\n步骤 3：结论与行动。\n该问题被判定为有效。现在将展开严谨的求解过程。\n\n在介电常数为 $\\varepsilon$ 的介质中，由沿轮廓 $\\Gamma$ 的线电荷分布 $\\lambda(\\mathbf{r}')$ 在场点 $\\mathbf{r}=(x,y)$ 处产生的电势 $\\phi(\\mathbf{r})$ 由单层势积分给出：\n$$ \\phi(\\mathbf{r}) \\;=\\; \\int_{\\Gamma} \\frac{\\lambda(\\mathbf{r}')}{\\varepsilon} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}\\Gamma' $$\n在此问题中，轮廓 $\\Gamma$ 由两条不相交的条带 $\\Gamma_1$（上）和 $\\Gamma_2$（下）组成。每条条带上的电荷密度是恒定的：对于 $\\mathbf{r}' \\in \\Gamma_1$，$\\lambda(\\mathbf{r}')=\\lambda_1$；对于 $\\mathbf{r}' \\in \\Gamma_2$，$\\lambda(\\mathbf{r}')=\\lambda_2$。\n任意点 $\\mathbf{r}$ 处的电势是两条条带产生电势的叠加：\n$$ \\phi(\\mathbf{r}) \\;=\\; \\frac{\\lambda_1}{\\varepsilon} \\int_{\\Gamma_1} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}x' + \\frac{\\lambda_2}{\\varepsilon} \\int_{\\Gamma_2} G(\\mathbf{r} - \\mathbf{r}') \\,\\mathrm{d}x' $$\n其中 $\\Gamma_1$ 是从 $(-a, h)$ 到 $(a, h)$ 的线段，$\\Gamma_2$ 是从 $(-a, -h)$ 到 $(a, -h)$ 的线段。\n\n我们在配置点（即条带的中心）处应用给定的边界条件：上条带为 $\\mathbf{r}_1=(0, h)$，下条带为 $\\mathbf{r}_2=(0, -h)$。\n$$ \\phi(\\mathbf{r}_1) = +\\frac{V_0}{2} \\quad \\text{和} \\quad \\phi(\\mathbf{r}_2) = -\\frac{V_0}{2} $$\n这导出了关于未知电荷密度 $\\lambda_1$ 和 $\\lambda_2$ 的 $2 \\times 2$ 线性方程组：\n$$ \\begin{pmatrix} M_{11} & M_{12} \\\\ M_{21} & M_{22} \\end{pmatrix} \\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\end{pmatrix} = \\begin{pmatrix} +V_0/2 \\\\ -V_0/2 \\end{pmatrix} $$\n矩阵元素 $M_{ij}$ 表示在条带 $j$ 上单位电荷密度在配置点 $\\mathbf{r}_i$ 处产生的电势，再乘以 $1/\\varepsilon$。\n$$ M_{ij} = \\frac{1}{\\varepsilon} \\int_{\\Gamma_j} G(\\mathbf{r}_i - \\mathbf{r}') \\,\\mathrm{d}x' $$\n\n我们现在解析地计算矩阵元素。\n对于 $M_{11}$，即由 $\\Gamma_1$ 上的单位电荷在 $\\mathbf{r}_1=(0,h)$ 处产生的电势：\n$$ M_{11} = \\frac{1}{\\varepsilon} \\int_{-a}^{a} G((0,h) - (x',h)) \\,\\mathrm{d}x' = \\frac{1}{\\varepsilon} \\int_{-a}^{a} -\\frac{1}{2\\pi} \\ln\\left(\\frac{|-x'|}{L_0}\\right) \\,\\mathrm{d}x' $$\n$$ M_{11} = -\\frac{1}{2\\pi\\varepsilon} \\cdot 2 \\int_{0}^{a} \\ln\\left(\\frac{x'}{L_0}\\right) \\,\\mathrm{d}x' = -\\frac{1}{\\pi\\varepsilon} \\left[ x'\\ln\\left(\\frac{x'}{L_0}\\right) - x' \\right]_0^a $$\n利用 $\\lim_{x' \\to 0^+} x'\\ln(x') = 0$ 这一事实，我们得到：\n$$ M_{11} = -\\frac{1}{\\pi\\varepsilon} \\left( a\\ln\\left(\\frac{a}{L_0}\\right) - a \\right) = -\\frac{a}{\\pi\\varepsilon} \\left(\\ln\\left(\\frac{a}{L_0}\\right) - 1\\right) $$\n根据几何结构的对称性，$M_{22} = M_{11}$。\n\n对于 $M_{12}$，即由 $\\Gamma_2$ 上的单位电荷在 $\\mathbf{r}_1=(0,h)$ 处产生的电势：\n$$ M_{12} = \\frac{1}{\\varepsilon} \\int_{-a}^{a} G((0,h) - (x',-h)) \\,\\mathrm{d}x' = \\frac{1}{\\varepsilon} \\int_{-a}^{a} -\\frac{1}{2\\pi} \\ln\\left(\\frac{\\sqrt{x'^2 + (2h)^2}}{L_0}\\right) \\,\\mathrm{d}x' $$\n$$ M_{12} = -\\frac{1}{2\\pi\\varepsilon} \\int_{-a}^{a} \\left(\\frac{1}{2}\\ln(x'^2 + 4h^2) - \\ln(L_0)\\right) \\,\\mathrm{d}x' $$\n$\\ln(x^2+c^2)$ 的积分是 $x\\ln(x^2+c^2) - 2x + 2c\\arctan(x/c)$。\n$$ \\int_{-a}^{a} \\ln(x'^2+4h^2) \\,\\mathrm{d}x' = \\left[ x'\\ln(x'^2+4h^2) - 2x' + 4h\\arctan\\left(\\frac{x'}{2h}\\right) \\right]_{-a}^{a} $$\n$$ = 2a\\ln(a^2+4h^2) - 4a + 8h\\arctan\\left(\\frac{a}{2h}\\right) $$\n将此结果代入 $M_{12}$ 的表达式中：\n$$ M_{12} = -\\frac{1}{2\\pi\\varepsilon} \\left[ \\frac{1}{2}\\left(2a\\ln(a^2+4h^2) - 4a + 8h\\arctan\\left(\\frac{a}{2h}\\right)\\right) - 2a\\ln(L_0) \\right] $$\n$$ M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\frac{1}{2}\\ln(a^2+4h^2) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) - \\ln(L_0) \\right] $$\n$$ M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{L_0}\\right) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n根据对称性，$M_{21} = M_{12}$。\n\n方程组为：\n$$ M_{11} \\lambda_1 + M_{12} \\lambda_2 = +\\frac{V_0}{2} $$\n$$ M_{12} \\lambda_1 + M_{11} \\lambda_2 = -\\frac{V_0}{2} $$\n将这两个方程相加得到 $(M_{11}+M_{12})(\\lambda_1+\\lambda_2)=0$。对于任何物理几何结构，$M_{11}+M_{12} \\neq 0$，因此我们必须有 $\\lambda_2 = -\\lambda_1$。\n将此代入第一个方程：\n$$ (M_{11} - M_{12})\\lambda_1 = \\frac{V_0}{2} \\implies \\lambda_1 = \\frac{V_0}{2(M_{11} - M_{12})} $$\n我们计算差值 $M_{11}-M_{12}$：\n$$ M_{11} - M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\left(\\ln\\left(\\frac{a}{L_0}\\right) - 1\\right) - \\left(\\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{L_0}\\right) - 1 + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right)\\right) \\right] $$\n$$ = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln(a) - \\ln(L_0) - \\ln(\\sqrt{a^2+4h^2}) + \\ln(L_0) - \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n任意长度 $L_0$ 被消除了，对于一个物理量来说，这本就该如此。\n$$ M_{11} - M_{12} = -\\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{a}{\\sqrt{a^2+4h^2}}\\right) - \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n$$ = \\frac{a}{\\pi\\varepsilon} \\left[ \\ln\\left(\\frac{\\sqrt{a^2+4h^2}}{a}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n$$ = \\frac{a}{\\pi\\varepsilon} \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right] $$\n现在我们求 $\\lambda_1$：\n$$ \\lambda_1 = \\frac{V_0}{2} \\left( \\frac{\\pi\\varepsilon}{a \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right]} \\right) $$\n单位深度的电容为 $C' = Q'/V_0 = 2a\\lambda_1/V_0$。\n$$ C' = \\frac{2a}{V_0} \\lambda_1 = \\frac{a}{V_0} \\frac{V_0 \\pi\\varepsilon}{a \\left[ \\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right) \\right]} $$\n$$ C' = \\frac{\\pi\\varepsilon}{\\frac{1}{2}\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{2h}{a}\\arctan\\left(\\frac{a}{2h}\\right)} $$\n将分子和分母同乘以 $2$ 以简化表达式，得到最终结果。\n$$ C' = \\frac{2\\pi\\varepsilon}{\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{4h}{a}\\arctan\\left(\\frac{a}{2h}\\right)} $$\n该表达式给出了单位深度电容，以法拉/米为单位，并且如要求的那样，仅依赖于 $\\varepsilon$、$a$ 和 $h$。\n该结果可以在理想平行板电容器的极限情况下（$a \\gg h$）进行验证。令 $z=2h/a \\ll 1$。分母变为 $\\ln(1+z^2) + 2z \\arctan(1/z) \\approx z^2 + 2z(\\pi/2 - z) = \\pi z - z^2 \\approx \\pi z = 2\\pi h/a$。因此，$C' \\approx \\frac{2\\pi\\varepsilon}{2\\pi h/a} = \\varepsilon\\frac{a}{h}$，这是宽度为 $2a$、间距为 $2h$ 的两条平行板在忽略边缘场情况下的单位深度电容的正确公式。所得到的公式在模型的近似范围内正确地包含了边缘效应。", "answer": "$$\n\\boxed{\\frac{2\\pi\\varepsilon}{\\ln\\left(1+\\frac{4h^2}{a^2}\\right) + \\frac{4h}{a}\\arctan\\left(\\frac{a}{2h}\\right)}}\n$$", "id": "2374801"}, {"introduction": "在编写边界元程序时，最核心也最具挑战性的部分之一是如何精确处理奇异积分。这个练习聚焦于边界元方法的心脏——对数核函数在直线单元上的积分。你将首先从第一性原理出发，推导出这个积分的解析表达式，该表达式在单元自影响（即源点与场点重合）的奇异情况下依然精确有效，然后通过编程实现这一公式，并用一系列覆盖不同几何构型的测试用例来验证其鲁棒性。", "problem": "考虑拉普拉斯方程的二维对数核，其定义为标量函数 $K(\\mathbf{x},\\mathbf{x}_0) = \\ln r$，其中 $r = \\|\\mathbf{x} - \\mathbf{x}_0\\|$ 是源点 $\\mathbf{x}$ 与场点 $\\mathbf{x}_0$ 之间的欧几里得距离。对于一个直线常数单元，设该单元为平面上连接端点 $\\mathbf{A} = (x_1, y_1)$ 和 $\\mathbf{B} = (x_2, y_2)$ 的线段 $\\Gamma$，并设场点为 $\\mathbf{P} = (x_f, y_f)$。定义线积分\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell,\n$$\n其中 $d\\ell$ 是沿 $\\Gamma$ 的线元，$L_0$ 是为使对数参数无量纲化而引入的固定参考长度。所有距离必须以米为单位，并使用 $L_0 = 1\\,\\mathrm{m}$。量 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ 的单位是米。\n\n任务：\n- 从第一性原理出发，推导出一个 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ 的闭式表达式。该表达式对任何非退化直线段 $\\Gamma$ 和平面上任何场点 $\\mathbf{P}$ 均有效，包括当 $\\mathbf{P}$ 到线段所在直线的垂直距离为零且 $\\mathbf{P}$ 在该直线上的投影位于线段内部时的极限情况。\n- 实现一个程序，使用推导出的闭式表达式对以下测试集计算 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$，其中所有坐标均以米为单位：\n  - 测试 1：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,0.4)$。\n  - 测试 2：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,0)$。\n  - 测试 3：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,10^{-12})$。\n  - 测试 4：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (-0.5,0)$。\n  - 测试 5：$\\mathbf{A} = (1,2)$，$\\mathbf{B} = (4,6)$，$\\mathbf{P} = (3,3)$。\n  - 测试 6：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (10^{-9},0)$，$\\mathbf{P} = (0,1)$。\n  - 测试 7：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (1,0)$。\n\n在任何中间表达式中（例如，反正切函数），角度单位（若适用）必须是弧度。最终的数值结果必须以米表示。\n\n您的程序必须生成单行输出，其中包含测试 1 到 7 的结果，以逗号分隔的十进制数列表形式呈现，并用方括号括起。例如，输出格式必须为\n$[r_1,r_2,r_3,r_4,r_5,r_6,r_7]$\n其中每个 $r_k$ 是对应于测试 $k$ 的浮点数（单位为米），格式化为小数点后有 $12$ 位数字。不允许有任何额外输出。", "solution": "该问题已经过验证，被认为是有效的。它具有科学依据、是适定的且客观的。问题陈述是完整的、一致的并且可形式化的。该积分是二维位势论和边界元法中的一个标准元素。对数奇点是可积的，这确保了即使当计算点位于积分路径上时，问题仍然是适定的。\n\n该问题要求推导并实现以下积分的闭式解：\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell\n$$\n给定参考长度 $L_0=1$，对数函数的参数变为无量纲。由于 $\\ln(1)=0$，我们有 $\\ln(\\|\\mathbf{x} - \\mathbf{P}\\|/L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|) - \\ln(L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|)$。令 $r = \\|\\mathbf{x} - \\mathbf{P}\\|$。该积分简化为：\n$$\nI = \\int_{\\Gamma} \\ln r \\, d\\ell\n$$\n\n为了求解此积分，我们为线段 $\\Gamma$ 建立一个局部坐标系 $(\\xi, \\eta)$。设原点位于点 $\\mathbf{A}$，$\\xi$ 轴与从 $\\mathbf{A}$ 到 $\\mathbf{B}$ 的向量对齐。线段的长度为 $L = \\|\\mathbf{B} - \\mathbf{A}\\|$。线段上的点 $\\mathbf{x}$ 可以由 $\\xi \\in [0, L]$ 参数化。线元为 $d\\ell = d\\xi$。\n\n沿线段的单位切向量为 $\\mathbf{t} = (\\mathbf{B} - \\mathbf{A})/L$。从 $\\mathbf{t}$ 逆时针旋转得到的单位法向量是 $\\mathbf{n}$。场点 $\\mathbf{P}$ 在此局部坐标系中可以用坐标 $(\\xi_p, \\eta_p)$ 描述，它们是向量 $\\mathbf{P} - \\mathbf{A}$ 在局部坐标轴上的投影：\n$$\n\\xi_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{t}\n$$\n$$\n\\eta_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{n}\n$$\n从线段上一点 $\\mathbf{x}(\\xi)$（局部坐标为 $(\\xi, 0)$）到场点 $\\mathbf{P}$（局部坐标为 $(\\xi_p, \\eta_p)$）的距离 $r$ 由下式给出：\n$$\nr = \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2}\n$$\n积分变为：\n$$\nI = \\int_{0}^{L} \\ln \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi = \\frac{1}{2} \\int_{0}^{L} \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi\n$$\n\n我们使用分部积分法 $\\int u \\, dv = uv - \\int v \\, du$ 求解不定积分 $J(\\xi) = \\int \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi$。令 $u = \\ln((\\xi - \\xi_p)^2 + \\eta_p^2)$ 且 $dv = d\\xi$。为方便起见，我们选择 $v = \\xi - \\xi_p$。则 $du = \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} d\\xi$。\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - \\int (\\xi - \\xi_p) \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi\n$$\n剩下的积分通过换元法计算。令 $s = \\xi - \\xi_p$：\n$$\n\\int \\frac{2s^2}{s^2 + \\eta_p^2} \\, ds = \\int \\frac{2(s^2 + \\eta_p^2) - 2\\eta_p^2}{s^2 + \\eta_p^2} \\, ds = \\int \\left( 2 - \\frac{2\\eta_p^2}{s^2 + \\eta_p^2} \\right) ds\n$$\n$$\n= 2s - 2\\eta_p^2 \\int \\frac{1}{s^2 + \\eta_p^2} ds = 2s - 2\\eta_p \\arctan\\left(\\frac{s}{\\eta_p}\\right)\n$$\n此式对 $\\eta_p \\neq 0$ 的任何符号均成立。将 $s = \\xi - \\xi_p$ 代回：\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln\\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - 2(\\xi - \\xi_p) + 2\\eta_p \\arctan\\left(\\frac{\\xi - \\xi_p}{\\eta_p}\\right)\n$$\n定积分为 $I = \\frac{1}{2}[J(L) - J(0)]$。令 $R_A = \\|\\mathbf{P} - \\mathbf{A}\\| = \\sqrt{\\xi_p^2 + \\eta_p^2}$ 且 $R_B = \\|\\mathbf{P} - \\mathbf{B}\\| = \\sqrt{(L-\\xi_p)^2 + \\eta_p^2}$。\n$$\nJ(L) = (L-\\xi_p)\\ln(R_B^2) - 2(L-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{L-\\xi_p}{\\eta_p}\\right)\n$$\n$$\nJ(0) = (-\\xi_p)\\ln(R_A^2) - 2(-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right)\n$$\n相减并化简可得：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) - \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right) \\right)\n$$\n使用恒等式 $\\arctan(-x) = -\\arctan(x)$，表达式简化为：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) + \\arctan\\left(\\frac{\\xi_p}{\\eta_p}\\right) \\right)\n$$\n此表达式是关于 $\\eta_p$ 的偶函数，因为当 $\\eta_p < 0$ 时，初始因子 $\\eta_p$ 为负，但每个 $\\arctan$ 项的符号也翻转，从而得到相同的值。因此，我们可以使用 $|\\eta_p|$ 来书写公式，以强调这种对称性：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + |\\eta_p| \\left( \\arctan\\left(\\frac{L - \\xi_p}{|\\eta_p|}\\right) + \\arctan\\left(\\frac{\\xi_p}{|\\eta_p|}\\right) \\right)\n$$\n\n现在，考虑 $\\mathbf{P}$ 位于包含线段 $\\Gamma$ 的直线上的极限情况，即 $\\eta_p = 0$。我们直接对这种情况计算积分：\n$$\nI = \\int_0^L \\ln|\\xi - \\xi_p| \\, d\\xi\n$$\n使用 $\\ln|u|$ 的反导数，即 $u \\ln|u| - u$：\n$$\nI = \\left[ (\\xi - \\xi_p) \\ln|\\xi - \\xi_p| - (\\xi - \\xi_p) \\right]_0^L\n$$\n$$\n= \\left((L - \\xi_p)\\ln|L - \\xi_p| - (L - \\xi_p)\\right) - \\left((-\\xi_p)\\ln|-\\xi_p| - (-\\xi_p)\\right)\n$$\n$$\nI = (L - \\xi_p)\\ln|L - \\xi_p| + \\xi_p\\ln|\\xi_p| - L\n$$\n此表达式也是通用公式在 $\\eta_p \\to 0$ 时的极限，因为 $\\lim_{y \\to 0} y \\arctan(K/y) = 0$。在实现时，必须注意对数参数为零的情况（即 $\\xi_p=0$ 或 $\\xi_p=L$）。在这些情况下，项 $x \\ln|x|$ 必须按其极限（即 $0$）进行计算。\n\n实现将使用这两个公式。对 $|\\eta_p|/L$ 使用一个小的数值容差，以在通用公式和数值上更稳定的共线情况公式之间进行选择。\n$\\mathbf{P}$ 在局部坐标系中的坐标计算如下：\n$L = \\sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$\n$\\xi_p = \\frac{(x_f-x_1)(x_2-x_1) + (y_f-y_1)(y_2-y_1)}{L}$\n$\\eta_p = \\frac{(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)}{L}$\n量 $(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)$ 与二维向量叉积有关，并表示由向量 $\\mathbf{P}-\\mathbf{A}$ 和 $\\mathbf{B}-\\mathbf{A}$ 构成的平行四边形的有向面积。", "answer": "```python\nimport numpy as np\n\ndef _x_times_log_abs_x(x):\n    \"\"\"\n    Calculates x * log(|x|) with a safeguard for x=0.\n    The limit of x*log|x| as x approaches 0 is 0.\n    \"\"\"\n    if np.abs(x) < 1e-30:\n        return 0.0\n    return x * np.log(np.abs(x))\n\ndef calculate_integral(A_coords, B_coords, P_coords):\n    \"\"\"\n    Calculates the integral I = integral over Gamma of ln(r) dl,\n    where Gamma is the line segment from A to B and r is the distance from a point on Gamma to P.\n    \n    Args:\n        A_coords (tuple): Coordinates of point A (x1, y1).\n        B_coords (tuple): Coordinates of point B (x2, y2).\n        P_coords (tuple): Coordinates of field point P (xf, yf).\n\n    Returns:\n        float: The value of the integral.\n    \"\"\"\n    A = np.array(A_coords, dtype=np.float64)\n    B = np.array(B_coords, dtype=np.float64)\n    P = np.array(P_coords, dtype=np.float64)\n\n    vec_AB = B - A\n    L_sq = vec_AB.dot(vec_AB)\n\n    # If the segment is a point (degenerate), the integral is zero.\n    if L_sq < 1e-30:\n        return 0.0\n    \n    L = np.sqrt(L_sq)\n    vec_AP = P - A\n\n    # Project P onto the local coordinate system of the segment.\n    # xi_p is the coordinate along the segment.\n    xi_p = vec_AP.dot(vec_AB) / L\n    \n    # eta_p is the perpendicular distance from P to the line containing the segment.\n    # It is calculated using the 2D cross product equivalent.\n    # The sign convention here corresponds to a normal vector obtained by a\n    # counter-clockwise rotation of the tangent vector.\n    # However, the final formula is independent of the sign of eta_p.\n    cross_prod = vec_AP[0] * vec_AB[1] - vec_AP[1] * vec_AB[0]\n    eta_p = -cross_prod / L\n\n    # Check for collinearity using a relative tolerance.\n    # If P is on (or very close to) the line containing the segment.\n    if np.abs(eta_p) / L < 1e-15:\n        term1 = _x_times_log_abs_x(L - xi_p)\n        term2 = _x_times_log_abs_x(xi_p)\n        return term1 + term2 - L\n    else:\n        # General case where P is not on the line.\n        abs_eta_p = np.abs(eta_p)\n        \n        # Distances from P to endpoints A and B.\n        # Calculated using local coordinates for robustness.\n        R_A = np.sqrt(xi_p**2 + eta_p**2)\n        R_B = np.sqrt((L - xi_p)**2 + eta_p**2)\n\n        term_log_A = xi_p * np.log(R_A)\n        term_log_B = (L - xi_p) * np.log(R_B)\n        \n        # Arctangent term.\n        arg1 = (L - xi_p) / abs_eta_p\n        arg2 = xi_p / abs_eta_p\n        term_atan = abs_eta_p * (np.arctan(arg1) + np.arctan(arg2))\n        \n        return term_log_A + term_log_B - L + term_atan\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases and prints the results\n    in the required format.\n    \"\"\"\n    test_cases = [\n        # Test 1: General case\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.4)},\n        # Test 2: P on the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.0)},\n        # Test 3: P very close to the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 1e-12)},\n        # Test 4: P on line extension\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (-0.5, 0.0)},\n        # Test 5: General segment and point\n        {'A': (1.0, 2.0), 'B': (4.0, 6.0), 'P': (3.0, 3.0)},\n        # Test 6: Very short segment\n        {'A': (0.0, 0.0), 'B': (1e-9, 0.0), 'P': (0.0, 1.0)},\n        # Test 7: P at an endpoint\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (1.0, 0.0)},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_integral(case['A'], case['B'], case['P'])\n        results.append(f\"{result:.12f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2377305"}, {"introduction": "掌握了基本原理和核心积分的实现后，现在是时候将所有知识融会贯通，解决一个具有实际物理背景的复杂问题了。这个综合性练习将引导你使用边界元方法来模拟电化学沉积过程中金属枝晶尖端的电场增强效应，这是一个典型的“尖端放电”问题。你将需要构建一个完整的BEM求解器，包括离散化复杂边界（椭圆）、组装系统矩阵、求解未知的边界密度，并最终计算和分析作为关键物理指标的电场增强因子，从而完整体验BEM作为一种强大数值模拟工具的全过程。", "problem": "考虑一个二维准静态电化学沉积情景，其中金属枝晶被建模为嵌入均匀电解质中的一个不可穿透的理想导电夹杂物。在稀溶液、稳态条件下，静电势满足拉普拉斯方程。您将使用边界元法（BEM）对枝晶尖端的电场增强进行建模。\n\n基本原理与模型。设电解质占据有界域 $\\Omega \\subset \\mathbb{R}^2$，该区域定义为以原点为中心、半径为 $R$ 的外圆与一个内部金属夹杂物之间的区域。该夹杂物通过一个以原点为中心、半长轴和半短轴分别为 $a$ 和 $b$ 且与坐标轴对齐的椭圆来近似枝晶的横截面。静电势 $\\phi(\\mathbf{x})$ 在 $\\Omega$ 内满足拉普拉斯方程 $\\nabla^2 \\phi = 0$。金属夹杂物边界 $\\Gamma_c$ 是一个等势导体，因此在 $\\Gamma_c$上施加Dirichlet数据 $\\phi = 0$。远场由一个半径为 $R$ 的大边界圆 $\\Gamma_R$ 近似，在该边界上指定Dirichlet数据 $\\phi(\\mathbf{x}) = -E_0 x$，以模拟一个大小为 $E_0$、沿x轴正方向的均匀外加电场。这里 $x$ 表示第一个笛卡尔坐标，$E_0 > 0$ 是一个常数。所有长度都是无量纲的，角度必须以弧度为单位处理。\n\n边界积分表述。使用二维拉普拉斯方程的自由空间格林函数 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。利用支撑在边界并集 $\\Gamma = \\Gamma_c \\cup \\Gamma_R$ 上的未知密度 $\\sigma$ 的单层势来表示 $\\Omega$ 内的解：\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\n在边界配置点上施加Dirichlet条件，从而得到一个关于 $\\sigma$ 的积分方程，该方程需要进行数值求解。\n\n数值离散化。将 $\\Gamma_c$ 离散为一条折线，该折线通过对椭圆 $(x(t),y(t)) = (a \\cos t, b \\sin t)$ 在 $t \\in [0, 2\\pi)$ 上进行均匀参数化生成 $N_c$ 个直线单元得到。将 $\\Gamma_R$ 离散为一条折线，该折线通过对圆 $(x(\\theta),y(\\theta)) = (R \\cos \\theta, R \\sin \\theta)$ 在 $\\theta \\in [0,2\\pi)$ 上进行均匀参数化生成 $N_R$ 个直线单元得到。在每个单元上使用常数基函数，并在单元中点进行配置。对于单层算子，使用中点法则近似非对角线上的相互作用，并通过计算在直线段上的精确积分来处理自作用项。具体来说，对于长度为 $L_j$、中点为 $\\mathbf{y}_j$ 的单元 $j$，以及位于单元 $i \\neq j$ 上的配置点 $\\mathbf{x}_i$，近似为\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j,\n$$\n其中 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。对于对角项 $i=j$，使用以配置点为中心的长度为 $L_i$ 的直线段的解析自作用项，\n$$\n\\int_{-L_i/2}^{L_i/2} \\left(-\\dfrac{1}{2\\pi}\\right) \\ln |s| \\, \\mathrm{d}s \\;=\\; -\\dfrac{1}{2\\pi} \\left( L_i \\ln\\frac{L_i}{2} - L_i \\right).\n$$\n为未知的单层密度向量 $\\boldsymbol{\\sigma}$ 组装稠密线性系统，并直接求解。\n\n电场评估与增强因子。电场为 $\\mathbf{E}(\\mathbf{x}) = -\\nabla \\phi(\\mathbf{x})$。求解出 $\\boldsymbol{\\sigma}$ 后，在椭圆前端尖端附近的一点 $(x,y) = (a+\\delta, 0)$ 处计算 $\\nabla \\phi$ 的值，其中 $\\delta$ 是一个在测试套件中指定的微小正向偏移。使用常数单元和中点近似，\n$$\n\\nabla \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left[ \\int_{\\Gamma_j} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\right] \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left( \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}_j) \\, L_j \\right),\n$$\n其中\n$$\n\\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\dfrac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\n计算增强因子 $\\beta = \\dfrac{\\|\\mathbf{E}(a+\\delta,0)\\|}{E_0}$。\n\n测试套件。实现所述算法，并为以下三组参数集计算 $\\beta$。这三组参数集分别用于探究圆形夹杂物、中等拉长的椭圆和高度拉长的椭圆。在所有情况下，角度均以弧度为单位，结果为无量纲数。\n\n-   情况1（基准，近似圆形导体）：$a = 1.0$, $b = 1.0$, $R = 10.0$, $N_c = 120$, $N_R = 180$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n-   情况2（中等拉长的枝晶）：$a = 2.0$, $b = 0.5$, $R = 12.0$, $N_c = 140$, $N_R = 200$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n-   情况3（高度拉长的枝晶）：$a = 3.0$, $b = 0.3$, $R = 15.0$, $N_c = 160$, $N_R = 220$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的、按上述情况顺序排列的逗号分隔列表，例如 $[\\beta_1,\\beta_2,\\beta_3]$。每个 $\\beta_k$ 必须是一个浮点数。", "solution": "我们从均匀、稳态、无自由电荷的电解质中静电场的基本控制方程出发，即域 $\\Omega$ 内的拉普拉斯方程 $\\nabla^2 \\phi = 0$。边界是并集 $\\Gamma = \\Gamma_c \\cup \\Gamma_R$，其中 $\\Gamma_c$ 表示金属夹杂物（枝晶横截面），$\\Gamma_R$ 表示近似远场的一个大人造边界。Dirichlet数据被指定：在 $\\Gamma_c$ 上 $\\phi = 0$，因为导体是等势的；在 $\\Gamma_R$ 上 $\\phi = -E_0 x$，以模拟一个大小为 $E_0$、沿x轴对齐的均匀外加电场。\n\n边界积分表示原理。对于二维拉普拉斯方程，其基本解（自由空间格林函数）是 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。一个经典的表示公式将调和函数 $\\phi$ 表示为支撑在边界上的单层势，\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\n对于足够光滑边界上的Dirichlet边值问题，单层势拟设可以得到一个关于未知密度 $\\sigma$ 的第一类Fredholm积分方程。该方程通过从域内部取极限 $\\mathbf{x} \\to \\Gamma$ 并施加给定的边界值获得。得到的方程是\n$$\n\\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = f(\\mathbf{x}), \\quad \\mathbf{x} \\in \\Gamma,\n$$\n其中在 $\\Gamma_c$ 上 $f(\\mathbf{x}) = 0$，在 $\\Gamma_R$ 上 $f(\\mathbf{x}) = -E_0 x$。对于Dirichlet问题，在满足对当前几何形状成立的技术条件下，该算子是可逆的，从而保证了 $\\sigma$ 的唯一解。\n\n通过常数单元和配置法进行离散化。我们将边界 $\\Gamma$ 划分为 $N = N_c + N_R$ 个直线段。在椭圆上，我们使用参数曲线 $(x(t),y(t)) = (a\\cos t,b\\sin t)$，其中 $t \\in [0,2\\pi)$，并将其均匀划分为 $N_c$ 个线段；在圆上，我们使用 $(x(\\theta),y(\\theta)) = (R\\cos \\theta,R\\sin \\theta)$，其中 $\\theta \\in [0,2\\pi)$，并将其均匀划分为 $N_R$ 个线段。在每个线段 $j$ 上，我们近似 $\\sigma$ 为常数值 $\\sigma_j$，并在各线段的中点 $\\mathbf{x}_i$ 处对积分方程进行配置。对于 $i \\neq j$，中点法则得到\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\sigma_j \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j \\, \\sigma_j,\n$$\n其中 $\\mathbf{y}_j$ 是线段 $j$ 的中点，$L_j$ 是其长度。对于对角自作用项 $i=j$，我们精确计算以配置点为中心的直线段上的积分。在局部坐标系中，线段与 $s \\in [-L_i/2,L_i/2]$ 上的 $s$ 轴重合，且配置点位于 $s=0$，我们有\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\int_{-L_i/2}^{L_i/2} \\ln|s| \\, \\mathrm{d}s = -\\frac{1}{2\\pi} \\left( \\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s \\right).\n$$\n使用反导数 $\\int \\ln s \\, \\mathrm{d}s = s \\ln s - s$，我们得到\n$$\n\\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s = 2 \\left[ s \\ln s - s \\right]_{0}^{L_i/2} = 2 \\left( \\frac{L_i}{2} \\ln \\frac{L_i}{2} - \\frac{L_i}{2} \\right) = L_i \\ln \\frac{L_i}{2} - L_i.\n$$\n因此，对角项为\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\left( L_i \\ln \\frac{L_i}{2} - L_i \\right).\n$$\n汇集所有项定义了一个稠密线性系统 $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$，其中\n$$\nA_{ij} = \\begin{cases}\n-\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}_i - \\mathbf{y}_j\\| \\cdot L_j, & i \\neq j \\\\[6pt]\n-\\dfrac{1}{2\\pi} \\left( L_i \\ln \\dfrac{L_i}{2} - L_i \\right), & i = j\n\\end{cases}\n$$\n且 $\\mathbf{f}$ 堆叠了各中点处的边界数据值：对于 $\\mathbf{x}_i \\in \\Gamma_c$，有 $f(\\mathbf{x}_i) = 0$；对于 $\\mathbf{x}_i \\in \\Gamma_R$，有 $f(\\mathbf{x}_i) = -E_0 x_i$。求解该系统即可得到单层密度 $\\boldsymbol{\\sigma}$ 的常数元近似。\n\n电场评估。电场为 $\\mathbf{E} = -\\nabla \\phi$。在积分号下对单层势求导可得\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) = \\int_{\\Gamma} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\n使用常数单元和中点近似，\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\left( -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}_j}{\\|\\mathbf{x}-\\mathbf{y}_j\\|^2} \\right) L_j.\n$$\n我们在 $\\mathbf{x}_{\\mathrm{tip}} = (a+\\delta, 0)$ 处计算该值，其中 $\\delta$ 是一个小的正数，以避免在边界上出现奇异行为。增强因子则为\n$$\n\\beta = \\frac{\\|\\mathbf{E}(\\mathbf{x}_{\\mathrm{tip}})\\|}{E_0} = \\frac{\\| -\\nabla \\phi(\\mathbf{x}_{\\mathrm{tip}}) \\|}{E_0}.\n$$\n\n结合原理的算法步骤。\n-   分别以 $N_c$ 和 $N_R$ 个点在 $t \\in [0,2\\pi)$ 和 $\\theta \\in [0,2\\pi)$ 上均匀采样，构建 $\\Gamma_c$ 和 $\\Gamma_R$，并在连续采样点之间形成直线段。计算线段中点 $\\mathbf{y}_j$ 和长度 $L_j$。\n-   使用上述 $A_{ij}$ 的表达式构建稠密矩阵 $\\mathbf{A}$，其中非对角项采用向量化计算，对角项采用解析表达式。根据给定的边界值组装右端项 $\\mathbf{f}$。\n-   使用直接线性求解器求解 $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$。\n-   通过中点求积公式在 $\\mathbf{x}_{\\mathrm{tip}}$ 处计算 $\\nabla \\phi$，并计算 $\\beta$。\n-   对每个测试用例重复上述步骤。\n\n验证预期。对于圆形夹杂物情况（$a=b$），经典势理论表明，在均匀电场中的圆柱形导体，其前端极点的表面场强大小约为 $2E_0$。因此，计算出的 $\\beta$ 值接近2表明实现是一致的。增加纵横比 $a/b$ 会使尖端更尖锐并增加 $\\beta$，这与尖锐导体处的电场增强效应一致。\n\n程序将以 $[\\beta_1,\\beta_2,\\beta_3]$ 的格式输出单行结果，其中每个 $\\beta_k$ 是对应测试用例计算出的浮点数增强因子。", "answer": "```python\nimport numpy as np\n\ndef discretize_ellipse(a, b, N):\n    # Uniform parameterization in radians\n    t = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = a * np.cos(t)\n    y = b * np.sin(t)\n    # Segment endpoints\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    # Midpoints and lengths\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef discretize_circle(R, N):\n    theta = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = R * np.cos(theta)\n    y = R * np.sin(theta)\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef assemble_single_layer_matrix(centers, lengths):\n    # centers: (N,2), lengths: (N,)\n    X = centers[:, 0][:, None]\n    Y = centers[:, 1][:, None]\n    dX = X - X.T\n    dY = Y - Y.T\n    r = np.sqrt(dX**2 + dY**2)\n    # Avoid log(0) on diagonal temporarily\n    np.fill_diagonal(r, 1.0)\n    G = -(1.0/(2.0*np.pi)) * np.log(r)\n    # Multiply each column by source element length\n    A = G * lengths[None, :]\n    # Replace diagonal with analytic self-term\n    diag = -(1.0/(2.0*np.pi)) * (lengths * (np.log(lengths/2.0) - 1.0))\n    np.fill_diagonal(A, diag)\n    return A\n\ndef solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac):\n    # Discretize boundaries\n    c_centers, c_lengths = discretize_ellipse(a, b, Nc)\n    R_centers, R_lengths = discretize_circle(R, NR)\n    centers = np.vstack((c_centers, R_centers))\n    lengths = np.concatenate((c_lengths, R_lengths))\n    N = centers.shape[0]\n    # Boundary data f: 0 on conductor, -E0*x on outer boundary\n    f_conductor = np.zeros(Nc)\n    f_outer = -E0 * R_centers[:, 0]\n    f = np.concatenate((f_conductor, f_outer))\n    # Assemble matrix and solve\n    A = assemble_single_layer_matrix(centers, lengths)\n    sigma = np.linalg.solve(A, f)\n    # Evaluate gradient at tip point (a+delta, 0)\n    delta = delta_frac * a\n    x_eval = np.array([a + delta, 0.0])\n    dx = x_eval[0] - centers[:, 0]\n    dy = x_eval[1] - centers[:, 1]\n    r2 = dx*dx + dy*dy\n    # Gradient of Green's function wrt field point: -(1/(2π)) * (r_vec)/|r|^2\n    factor = -(1.0/(2.0*np.pi))\n    # Weighted by element lengths and densities\n    w = sigma * lengths\n    grad_phi_x = np.sum(w * factor * (dx / r2))\n    grad_phi_y = np.sum(w * factor * (dy / r2))\n    Ex = -grad_phi_x\n    Ey = -grad_phi_y\n    E_mag = np.sqrt(Ex*Ex + Ey*Ey)\n    beta = E_mag / E0\n    return beta\n\ndef solve():\n    # Test cases: (a, b, R, Nc, NR, E0, delta_frac)\n    test_cases = [\n        (1.0, 1.0, 10.0, 120, 180, 1.0, 0.02),\n        (2.0, 0.5, 12.0, 140, 200, 1.0, 0.02),\n        (3.0, 0.3, 15.0, 160, 220, 1.0, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, b, R, Nc, NR, E0, delta_frac = case\n        beta = solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac)\n        results.append(beta)\n\n    # Print in required single-line format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2377246"}]}