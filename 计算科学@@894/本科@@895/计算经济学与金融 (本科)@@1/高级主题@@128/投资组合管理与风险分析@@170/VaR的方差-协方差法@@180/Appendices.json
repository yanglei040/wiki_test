{"hands_on_practices": [{"introduction": "理论学习之后，最重要的一步就是将其付诸实践。这个练习旨在将方差-协方差 VaR 的核心数学公式转化为实际的计算代码。通过处理一个多资产投资组合，你将练习使用矩阵运算来计算投资组合的预期收益 ($\\mu_p = w^{\\top}\\mu$) 和方差 ($\\sigma_p^2 = w^{\\top}\\Sigma w$)，并最终应用 VaR 公式得出风险价值。这项基础练习对于掌握该方法的计算精髓至关重要 [@problem_id:2447014]。", "id": "2447014", "problem": "给定一个包含$N$种资产的投资组合，其线性敞口向量为 $w \\in \\mathbb{R}^{N}$，每日资产收益向量为 $r \\in \\mathbb{R}^{N}$，每日均值收益向量为 $\\mu \\in \\mathbb{R}^{N}$，每日方差-协方差矩阵为 $\\Sigma \\in \\mathbb{R}^{N \\times N}$。假设 $r$ 服从均值为 $\\mu$、协方差为 $\\Sigma$ 的多元正态分布。单日投资组合收益为 $R_{p} = w^{\\top} r$，与投资组合价值使用相同货币单位的单日投资组合损失为 $L = -V \\, R_{p}$，其中 $V \\in \\mathbb{R}_{+}$ 是当前投资组合的价值。将尾部概率为 $\\alpha \\in (0,1)$ 的单日在险价值 (VaR) 定义为满足 $\\mathbb{P}(L > v) = \\alpha$ 的数值 $v$。所有概率都是无单位的。所有收益均以小数表示，不带百分号。\n\n编写一个完整的程序，使用方差-协方差法，在正态性假设下，为以下每个测试用例计算单日在险价值。每个结果必须以与 $V$ 相同的货币单位表示，并四舍五入到两位小数。你的程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔的结果列表（例如，$[x_{1},x_{2},x_{3}]$），且不含空格。\n\n测试套件：\n- 案例 $1$（一般多资产情况）：\n  - $N = 3$\n  - $w = [\\,0.5,\\,0.3,\\,0.2\\,]$\n  - $\\mu = [\\,0.0005,\\,0.0002,\\,-0.0001\\,]$\n  - $\\Sigma = \\begin{bmatrix}\n  0.000225 & 0.00003 & 0.00015 \\\\\n  0.00003 & 0.0001 & 0.00006 \\\\\n  0.00015 & 0.00006 & 0.0004\n  \\end{bmatrix}$\n  - $V = 1000000$\n  - $\\alpha = 0.01$\n- 案例 $2$（完美对冲，零方差）：\n  - $N = 2$\n  - $w = [\\,0.5,\\,-0.5\\,]$\n  - $\\mu = [\\,0.0002,\\,0.0002\\,]$\n  - $\\Sigma = \\begin{bmatrix}\n  0.0001 & 0.0001 \\\\\n  0.0001 & 0.0001\n  \\end{bmatrix}$\n  - $V = 2000000$\n  - $\\alpha = 0.01$\n- 案例 $3$（单资产情况）：\n  - $N = 1$\n  - $w = [\\,1.0\\,]$\n  - $\\mu = [\\,-0.0003\\,]$\n  - $\\Sigma = \\begin{bmatrix} 0.0009 \\end{bmatrix}$\n  - $V = 500000$\n  - $\\alpha = 0.05$\n\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔的结果列表（例如，$[result1,result2,result3]$）。每个 $resulti$ 必须是四舍五入到两位小数的浮点数。不应打印其他任何文本。", "solution": "该问题要求使用方差-协方差法计算一个包含$N$种资产的投资组合的单日在险价值 ($VaR$)。该问题定义明确，科学上合理，并为得出唯一解提供了所有必要的数据。核心假设是每日资产收益向量 $r$ 服从多元正态分布，$r \\sim \\mathcal{N}(\\mu, \\Sigma)$。\n\n首先，我们必须确定单日投资组合收益 $R_{p}$ 的统计分布。投资组合收益是个体资产收益的线性组合，由方程 $R_{p} = w^{\\top} r$ 指定，其中 $w$ 是投资组合权重向量。多元正态分布的一个基本性质是其分量的任何线性组合也服从正态分布。因此，$R_{p}$ 服从单变量正态分布。\n\n投资组合收益的均值 $\\mu_{p}$ 是 $R_{p}$ 的期望值：\n$$ \\mu_{p} = \\mathbb{E}[R_{p}] = \\mathbb{E}[w^{\\top} r] = w^{\\top} \\mathbb{E}[r] = w^{\\top} \\mu $$\n投资组合收益的方差 $\\sigma_{p}^2$ 由下式给出：\n$$ \\sigma_{p}^2 = \\text{Var}(R_{p}) = \\text{Var}(w^{\\top} r) = w^{\\top} \\text{Var}(r) w = w^{\\top} \\Sigma w $$\n因此，投资组合收益的分布为 $R_{p} \\sim \\mathcal{N}(\\mu_{p}, \\sigma_{p}^2)$。\n\n接下来，我们考虑投资组合损失 $L$，其定义为 $L = -V R_{p}$，其中 $V$ 是当前投资组合的价值。由于 $L$ 是正态分布变量 $R_{p}$ 的线性变换，因此 $L$ 也服从正态分布。\n损失的均值 $\\mu_{L}$ 为：\n$$ \\mu_{L} = \\mathbb{E}[L] = \\mathbb{E}[-V R_{p}] = -V \\mathbb{E}[R_{p}] = -V \\mu_{p} = -V w^{\\top} \\mu $$\n损失的方差 $\\sigma_{L}^2$ 为：\n$$ \\sigma_{L}^2 = \\text{Var}(L) = \\text{Var}(-V R_{p}) = (-V)^2 \\text{Var}(R_{p}) = V^2 \\sigma_{p}^2 = V^2 (w^{\\top} \\Sigma w) $$\n损失的标准差为 $\\sigma_{L} = V \\sigma_{p} = V \\sqrt{w^{\\top} \\Sigma w}$。\n所以，投资组合损失的分布为 $L \\sim \\mathcal{N}(\\mu_{L}, \\sigma_{L}^2)$。\n\n尾部概率为 $\\alpha$ 的在险价值，记为 $v$，由条件 $\\mathbb{P}(L > v) = \\alpha$ 定义。为了求解 $v$，我们对正态随机变量 $L$ 进行标准化。设 $Z$ 为一个标准正态变量，$Z \\sim \\mathcal{N}(0, 1)$。我们可以将 $L$ 表示为 $L = \\mu_{L} + \\sigma_{L} Z$。该概率陈述变为：\n$$ \\mathbb{P}(\\mu_{L} + \\sigma_{L} Z > v) = \\alpha $$\n假设 $\\sigma_{L} > 0$，我们整理该不等式：\n$$ \\mathbb{P}\\left(Z > \\frac{v - \\mu_{L}}{\\sigma_{L}}\\right) = \\alpha $$\n设 $z_{\\alpha}$ 为标准正态分布的上$\\alpha$分位数，即满足 $\\mathbb{P}(Z > z_{\\alpha}) = \\alpha$ 的值。该值等价于累积分布函数（CDF） $\\Phi$ 在 $1 - \\alpha$ 处的反函数值，即 $z_{\\alpha} = \\Phi^{-1}(1 - \\alpha)$。\n通过令概率函数的参数相等，我们得到：\n$$ \\frac{v - \\mu_{L}}{\\sigma_{L}} = z_{\\alpha} $$\n求解 $v$ 可得出 $VaR_{\\alpha}$ 的公式：\n$$ v = \\text{VaR}_{\\alpha} = \\mu_{L} + z_{\\alpha} \\sigma_{L} $$\n代入 $\\mu_{L}$ 和 $\\sigma_{L}$ 的表达式，我们得到最终的计算公式：\n$$ \\text{VaR}_{\\alpha} = -V (w^{\\top} \\mu) + z_{\\alpha} V \\sqrt{w^{\\top} \\Sigma w} $$\n这可以改写为：\n$$ \\text{VaR}_{\\alpha} = V (z_{\\alpha} \\sigma_{p} - \\mu_{p}) $$\n在投资组合方差 $\\sigma_{p}^2 = 0$ 的特殊情况下，投资组合收益是确定性的：$R_{p} = \\mu_{p}$。损失也是确定性的，$L = -V\\mu_{p}$。根据分位数的广义定义，对于任何 $\\alpha \\in (0,1)$，$\\text{VaR}_{\\alpha} = -V\\mu_{p}$，这与通用公式是一致的，因为包含 $\\sigma_{p}$ 的项变为零。\n\n解决每个测试用例的算法如下：\n$1$. 对于一组给定的参数 $\\{w, \\mu, \\Sigma, V, \\alpha\\}$，首先计算投资组合的平均收益 $\\mu_{p} = w^{\\top} \\mu$。\n$2$. 计算投资组合收益的方差 $\\sigma_{p}^2 = w^{\\top} \\Sigma w$。\n$3$. 计算投资组合收益的标准差 $\\sigma_{p} = \\sqrt{\\sigma_{p}^2}$。\n$4$. 使用数值函数计算 $\\Phi^{-1}(1 - \\alpha)$，以确定与尾部概率 $\\alpha$ 对应的标准正态分位数 $z_{\\alpha}$。\n$5$. 使用公式 $\\text{VaR}_{\\alpha} = V(z_{\\alpha} \\sigma_{p} - \\mu_{p})$ 计算 $VaR$。\n$6$. 将最终结果四舍五入到两位小数。\n此过程将应用于所提供的三个测试用例中的每一个。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the one-day Value-at-Risk for a portfolio using the\n    variance-covariance method under the normality assumption.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general multi-asset case)\n        {\n            \"w\": np.array([0.5, 0.3, 0.2]),\n            \"mu\": np.array([0.0005, 0.0002, -0.0001]),\n            \"Sigma\": np.array([\n                [0.000225, 0.00003, 0.00015],\n                [0.00003, 0.0001, 0.00006],\n                [0.00015, 0.00006, 0.0004]\n            ]),\n            \"V\": 1000000.0,\n            \"alpha\": 0.01\n        },\n        # Case 2 (perfect hedge, zero variance)\n        {\n            \"w\": np.array([0.5, -0.5]),\n            \"mu\": np.array([0.0002, 0.0002]),\n            \"Sigma\": np.array([\n                [0.0001, 0.0001],\n                [0.0001, 0.0001]\n            ]),\n            \"V\": 2000000.0,\n            \"alpha\": 0.01\n        },\n        # Case 3 (single-asset case)\n        {\n            \"w\": np.array([1.0]),\n            \"mu\": np.array([-0.0003]),\n            \"Sigma\": np.array([[0.0009]]),\n            \"V\": 500000.0,\n            \"alpha\": 0.05\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        w = case[\"w\"]\n        mu = case[\"mu\"]\n        Sigma = case[\"Sigma\"]\n        V = case[\"V\"]\n        alpha = case[\"alpha\"]\n\n        # 1. Calculate portfolio mean return (mu_p)\n        # mu_p = w^T * mu\n        mu_p = w.T @ mu\n\n        # 2. Calculate portfolio variance of return (sigma_p^2)\n        # sigma_p_sq = w^T * Sigma * w\n        sigma_p_sq = w.T @ Sigma @ w\n\n        # 3. Calculate portfolio standard deviation of return (sigma_p)\n        sigma_p = np.sqrt(sigma_p_sq)\n\n        # 4. Find the standard normal quantile for the given confidence level\n        # z_alpha = Phi^-1(1 - alpha)\n        z_alpha = norm.ppf(1 - alpha)\n\n        # 5. Compute the Value-at-Risk (VaR)\n        # VaR = V * (z_alpha * sigma_p - mu_p)\n        var_value = V * (z_alpha * sigma_p - mu_p)\n\n        # Format the result to two decimal places.\n        results.append(f\"{var_value:.2f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"}, {"introduction": "一个模型的强大之处不仅在于其普遍适用性，也在于我们对其边界条件的深刻理解。本练习通过一个假设情景——资产间的相关性达到完美的 $1$ ($\\rho=1$)——来探索模型的理论极限。这个思想实验将挑战你对协方差矩阵 ($\\Sigma$) 性质及其在风险计算中作用的理解，揭示完美相关性如何导致风险维度的降低，甚至允许构建零风险的投资组合 [@problem_id:2446972]。", "id": "2446972", "problem": "考虑一个包含$2$只股票的投资组合，其（连续复利）日收益率收集在向量 $\\mathbf{r} = (r_1, r_2)^\\top$ 中。假设 $\\mathbb{E}[\\mathbf{r}] = \\mathbf{0}$ 且 $\\operatorname{Cov}(\\mathbf{r}) = \\Sigma$，其中\n$$\n\\Sigma = \\begin{pmatrix}\n\\sigma_1^2 & \\rho\\,\\sigma_1 \\sigma_2 \\\\\n\\rho\\,\\sigma_1 \\sigma_2 & \\sigma_2^2\n\\end{pmatrix},\n$$\n其中 $\\sigma_1 > 0$, $\\sigma_2 > 0$，且相关系数 $\\rho \\in [-1,1]$。设投资组合的收益率为 $R_p = w_1 r_1 + w_2 r_2$，其中 $w_1, w_2 \\in \\mathbb{R}$ 为固定权重。在风险价值（VaR）的方差-协方差（delta-正态）方法下，假设 $\\mathbf{r}$ 服从联合正态分布，则置信水平为 $p \\in (0,1)$ 的单日VaR是根据 $R_p$ 的分布计算得出的。设 $z_p$ 表示标准正态分布的上$p$-分位数。\n\n假设这两只股票变为完全正相关，即 $\\rho=1$。下列哪个陈述最能描述这对协方差矩阵 $\\Sigma$ 和投资组合VaR计算的影响？\n\nA. $\\Sigma$ 保持满秩（$2$）和正定；VaR 仍按 $z_p \\sqrt{\\mathbf{w}^\\top \\Sigma \\mathbf{w}}$ 计算，且仅当 $(w_1,w_2) = (0,0)$ 时才等于 $0$。\n\nB. $\\Sigma$ 变为秩为$1$（奇异），对应于单一的共同风险因子；对于给定的线性投资组合，VaR 仍然是良定义的，且等于 $z_p \\,\\lvert w_1 \\sigma_1 + w_2 \\sigma_2 \\rvert$，尽管需要正定性的数值程序（例如，不带主元选择的 Cholesky 分解）可能会失败。\n\nC. $\\Sigma$ 变为秩为$0$；所有方差都消失了，且无论 $(w_1,w_2)$ 如何，VaR 都为 $0$。\n\nD. $\\rho = 1$ 使得 $\\Sigma$ 作为协方差矩阵无效，因此VaR未定义。\n\nE. $\\Sigma$ 变为秩为$1$，且由于相关性达到最大，VaR 发散至 $+\\infty$。", "solution": "必须首先验证问题陈述的科学性和逻辑一致性。\n\n### 步骤1：提取已知条件\n- 一个投资组合包含$2$只股票。\n- 日收益率向量为 $\\mathbf{r} = (r_1, r_2)^\\top$。\n- 期望收益率为 $\\mathbb{E}[\\mathbf{r}] = \\mathbf{0}$。\n- 收益率的协方差矩阵为 $\\operatorname{Cov}(\\mathbf{r}) = \\Sigma = \\begin{pmatrix} \\sigma_1^2 & \\rho\\,\\sigma_1 \\sigma_2 \\\\ \\rho\\,\\sigma_1 \\sigma_2 & \\sigma_2^2 \\end{pmatrix}$。\n- 参数约束为 $\\sigma_1 > 0$, $\\sigma_2 > 0$, 且 $\\rho \\in [-1,1]$。\n- 投资组合收益率为 $R_p = w_1 r_1 + w_2 r_2 = \\mathbf{w}^\\top \\mathbf{r}$，其中 $\\mathbf{w}=(w_1, w_2)^\\top$ 是固定权重。\n- 风险价值（VaR）的模型是方差-协方差（delta-正态）方法。\n- 收益率 $\\mathbf{r}$ 被假设服从联合正态分布。\n- 符号 $z_p$ 表示标准正态分布的上$p$-分位数，即，如果 $Z \\sim N(0,1)$，则 $P(Z > z_p) = p$。\n- 需要分析的具体条件是完全正相关，$\\rho = 1$。\n- 问题要求对 $\\rho=1$ 对 $\\Sigma$ 和投资组合VaR的影响给出最佳描述。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题设定在现代投资组合理论和风险管理的标准框架内。\n- **科学基础：** 投资组合收益率、协方差矩阵以及VaR的方差-协方差方法的定义在金融数学和计量经济学中是标准的。联合正态性假设是该模型的基石。对极限情况 $\\rho=1$ 的分析是一个有效的数学练习。该问题在科学上是合理的。\n- **良态性：** 分析该情况所需的所有要素均已提供。问题具体而明确。从前提可以推导出一个唯一、稳定且有意义的解。\n- **客观性：** 问题使用精确的数学和金融术语进行陈述。没有主观或基于观点的断言。\n\n### 步骤3：结论与行动\n问题陈述是有效的。这是一个计算金融学中的良定义问题。将推导一个完整的解。\n\n### 解的推导\n该问题要求我们分析当相关系数 $\\rho$ 设置为其最大值 $\\rho=1$ 时的系统状态。我们将检验协方差矩阵 $\\Sigma$ 的性质，然后计算投资组合的风险价值（VaR）。\n\n#### 对 $\\rho=1$ 条件下协方差矩阵 $\\Sigma$ 的分析\n当 $\\rho=1$ 时，协方差矩阵变为：\n$$\n\\Sigma = \\begin{pmatrix}\n\\sigma_1^2 & \\sigma_1 \\sigma_2 \\\\\n\\sigma_1 \\sigma_2 & \\sigma_2^2\n\\end{pmatrix}\n$$\n为了确定该矩阵的秩，我们计算其行列式：\n$$\n\\det(\\Sigma) = (\\sigma_1^2)(\\sigma_2^2) - (\\sigma_1 \\sigma_2)(\\sigma_1 \\sigma_2) = \\sigma_1^2 \\sigma_2^2 - \\sigma_1^2 \\sigma_2^2 = 0\n$$\n由于行列式为零，该矩阵是奇异的。对于一个 $2 \\times 2$ 矩阵，这意味着其秩小于 $2$。由于我们已知 $\\sigma_1 > 0$ 和 $\\sigma_2 > 0$，对角线元素 $\\sigma_1^2$ 和 $\\sigma_2^2$ 是非零的。因此，$\\Sigma$ 不是零矩阵，其秩不能为 $0$。因此，$\\Sigma$ 的秩必须恰好为 $1$。\n\n一个奇异的协方差矩阵是半正定的，但不是正定的。要使矩阵 $M$ 成为一个有效的协方差矩阵，它必须是对称且半正定的。$\\Sigma$ 显然是对称的。为了检查半正定性，我们检验对于任意非零向量 $\\mathbf{x} = (x_1, x_2)^\\top$ 的二次型 $\\mathbf{x}^\\top \\Sigma \\mathbf{x}$：\n$$\n\\mathbf{x}^\\top \\Sigma \\mathbf{x} = \\begin{pmatrix} x_1 & x_2 \\end{pmatrix} \\begin{pmatrix} \\sigma_1^2 & \\sigma_1 \\sigma_2 \\\\ \\sigma_1 \\sigma_2 & \\sigma_2^2 \\end{pmatrix} \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix} = x_1^2 \\sigma_1^2 + 2x_1 x_2 \\sigma_1 \\sigma_2 + x_2^2 \\sigma_2^2 = (x_1 \\sigma_1 + x_2 \\sigma_2)^2\n$$\n由于对于所有实数 $x_1, x_2, \\sigma_1, \\sigma_2$，$(x_1 \\sigma_1 + x_2 \\sigma_2)^2 \\geq 0$，该矩阵是半正定的，并且是一个有效的（尽管是奇异的）协方差矩阵。\n\n条件 $\\rho=1$ 意味着随机变量 $r_1$ 和 $r_2$ 是完全线性相关的。具体来说，它们的标准化版本是相等的：$r_1/\\sigma_1 = r_2/\\sigma_2$。我们可以用一个单一的、共同的潜在风险因子来表示这两种收益率，比如说 $F = r_1/\\sigma_1$，它服从标准正态分布 $N(0,1)$。那么 $r_1 = \\sigma_1 F$ 且 $r_2 = \\sigma_2 F$。\n\n#### 投资组合VaR的计算\n投资组合收益率为 $R_p = w_1 r_1 + w_2 r_2$。由于 $\\mathbb{E}[\\mathbf{r}] = \\mathbf{0}$，期望投资组合收益率为 $\\mathbb{E}[R_p] = w_1 \\mathbb{E}[r_1] + w_2 \\mathbb{E}[r_2] = 0$。\n投资组合收益率的方差 $\\sigma_p^2$ 由下式给出：\n$$\n\\sigma_p^2 = \\operatorname{Var}(R_p) = \\mathbf{w}^\\top \\Sigma \\mathbf{w}\n$$\n使用我们之前推导出的二次型表达式，其中 $\\mathbf{x}=\\mathbf{w}$：\n$$\n\\sigma_p^2 = (w_1 \\sigma_1 + w_2 \\sigma_2)^2\n$$\n因此，投资组合收益率的标准差为：\n$$\n\\sigma_p = \\sqrt{(w_1 \\sigma_1 + w_2 \\sigma_2)^2} = |w_1 \\sigma_1 + w_2 \\sigma_2|\n$$\n在方差-协方差方法下，投资组合收益率 $R_p$ 服从正态分布，$R_p \\sim N(0, \\sigma_p^2)$。投资组合损失为 $L = -R_p$。置信水平为 $1-p$（对应于尾部概率 $p$）的VaR是满足 $P(L > \\text{VaR}) = p$ 的值。这导出了公式：\n$$\n\\text{VaR} = \\sigma_p z_p\n$$\n其中 $z_p$ 是标准正态分布的上$p$-分位数。\n代入我们关于 $\\sigma_p$ 的表达式：\n$$\n\\text{VaR} = z_p |w_1 \\sigma_1 + w_2 \\sigma_2|\n$$\nVaR是良定义且有限的。\n\n### 逐项分析\n\n**A. $\\Sigma$ 保持满秩（$2$）和正定；VaR 仍按 $z_p \\sqrt{\\mathbf{w}^\\top \\Sigma \\mathbf{w}}$ 计算，且仅当 $(w_1,w_2) = (0,0)$ 时才等于 $0$。**\n- 关于 $\\Sigma$ 保持满秩（$2$）和正定的陈述是**不正确**的。如前所示，$\\det(\\Sigma)=0$，所以该矩阵是秩为1的奇异矩阵（半正定，而非正定）。\n- 关于VaR仅在 $(w_1,w_2) = (0,0)$ 时等于0的陈述也是**不正确**的。VaR是 $z_p |w_1 \\sigma_1 + w_2 \\sigma_2|$。假设 $p \\in (0,1)$，$z_p$ 是有限的。如果 $p<0.5$，$z_p>0$。当 $w_1 \\sigma_1 + w_2 \\sigma_2 = 0$ 时，VaR为零。由于 $\\sigma_1, \\sigma_2 > 0$，这对于非零权重是可以满足的，例如，通过选择 $w_1 = \\sigma_2$ 和 $w_2 = -\\sigma_1$。这对应于由两个完全相关的资产构建的无风险投资组合。\n\n**B. $\\Sigma$ 变为秩为$1$（奇异），对应于单一的共同风险因子；对于给定的线性投资组合，VaR 仍然是良定义的，且等于 $z_p \\,\\lvert w_1 \\sigma_1 + w_2 \\sigma_2 \\rvert$，尽管需要正定性的数值程序（例如，不带主元选择的 Cholesky 分解）可能会失败。**\n- “$\\Sigma$ 变为秩为$1$（奇异）”：**正确**。我们已经证明了这一点。\n- “对应于单一的共同风险因子”：**正确**。我们证明了 $r_1$ 和 $r_2$ 变为完全成比例，$r_2 = (\\sigma_2/\\sigma_1)r_1$。\n- “对于给定的线性投资组合，VaR 仍然是良定义的”：**正确**。投资组合收益率是一个经过缩放的正态变量，因此其分布和分位数是良定义的。\n- “等于 $z_p \\,\\lvert w_1 \\sigma_1 + w_2 \\sigma_2 \\rvert$”：**正确**。这与我们推导的公式相符。\n- “需要正定性的数值程序（例如，不带主元选择的 Cholesky 分解）可能会失败”：**正确**。标准的Cholesky分解算法仅保证对正定矩阵有效。将其应用于像这样的奇异矩阵将导致计算失败（由于浮点误差，试图对零或负数取平方根）。\n这个陈述的每个部分都是准确的。\n\n**C. $\\Sigma$ 变为秩为$0$；所有方差都消失了，且无论 $(w_1,w_2)$ 如何，VaR 都为 $0$。**\n- “$\\Sigma$ 变为秩为$0$”：**不正确**。秩为0的矩阵是零矩阵。由于 $\\sigma_1, \\sigma_2 > 0$，$\\Sigma$ 不是零矩阵。其秩为1。\n- “所有方差都消失了”：**不正确**。单个方差 $\\sigma_1^2$ 和 $\\sigma_2^2$ 是正的。\n- “无论 $(w_1,w_2)$ 如何，VaR 都为 $0$”：**不正确**。VaR通常是非零的。\n\n**D. $\\rho = 1$ 使得 $\\Sigma$ 作为协方差矩阵无效，因此VaR未定义。**\n- “$\\rho = 1$ 使得 $\\Sigma$ 作为协方差矩阵无效”：**不正确**。我们已经证明，对于 $\\rho=1$，$\\Sigma$ 是对称且半正定的，这是一个矩阵成为有效协方差矩阵的充分必要条件。\n- “VaR未定义”：**不正确**。我们推导出了一个良定义且有限的VaR值。\n\n**E. $\\Sigma$ 变为秩为$1$，且由于相关性达到最大，VaR 发散至 $+\\infty$。**\n- “$\\Sigma$ 变为秩为$1$”：**正确**。\n- “VaR 发散至 $+\\infty$”：**不正确**。VaR是有限量 $z_p |w_1 \\sigma_1 + w_2 \\sigma_2|$。最大的相关性意味着风险是完全对齐的，而不是它们是无限的。事实上，这种完全对齐允许构建零风险投资组合的可能性，从而导致VaR为0。\n\n基于此详细分析，选项B是唯一提供完整且正确情况描述的陈述。", "answer": "$$\\boxed{B}$$"}, {"introduction": "作为一名严谨的风险管理者，你必须学会批判性地审视你的工具，而不仅仅是机械地使用它们。这个练习旨在培养这种批判性思维，它展示了方差-协方差 VaR 模型最著名的“盲点”。你将分析一些特殊构建的投资组合，它们的计算 VaR 为零，但在现实中却隐藏着巨大的经济风险，这是因为模型忽略了非线性风险（如伽马 $\\Gamma$）或未建模的风险因素 [@problem_id:2447005]。", "id": "2447005", "problem": "一位风险经理采用方差-协方差法计算一日时间范围内的风险价值（VaR）。该方法将一日的投资组合损益建模为联合正态分布的风险因子变化的线性函数。具体而言：(i)对于线性工具投资组合，一日损益被建模为风险因子变化向量的仿射线性形式；(ii)对于包含单一股票欧式期权的投资组合，银行采用对股票价格的一阶（delta）线性化，并忽略了诸如gamma和vega等高阶项。该股票的一日连续复利回报率被建模为均值为零、方差为$\\sigma^{2}$的正态分布。当前股价为$S_{0}$。在此建模选择下，一个对所有建模的风险因子其净一阶敏感度恰好为零的投资组合，其计算出的一日VaR为零。\n\n在上述方差-协方差程序下，下列哪个投资组合计算出的一日VaR为零，但在经济现实中仍然具有极高风险？选择所有适用项。\n\nA. 卖出1份欧式看涨期权和卖出1份欧式看跌期权，两者均以该股票为标的，具有相同的到期日和行权价 $K=S_{0}$；无股票或现金头寸。\n\nB. 仅持有一张1天后到期的无风险国库券；无其他头寸，并忽略1天内的利率风险。\n\nC. 买入1股该股票，并卖出市场指数期货，名义本金的选择使得投资组合相对于市场指数的贝塔值恰好为零。VaR系统仅将市场指数作为权益风险因子建模，并忽略了个股的特质性波动。\n\nD. 买入1份欧式看涨期权和卖出1份欧式看跌期权，两者均以该股票为标的，具有相同的到期日和行权价 $K=S_{0}$；无股票或现金头寸。", "solution": "我们从陈述的建模基础开始分析。方差-协方差VaR假设一日损益 $P$ 被建模为联合正态分布的风险因子变化的线性函数。对于只有一个风险因子（其价格）的单一标的股票，期权和股票投资组合的价值 $V$ 在一天内的delta线性化变化为\n$$\n\\Delta V \\approx \\delta \\,\\Delta S,\n$$\n其中 $\\delta$ 是对股票价格 $S$ 的净一阶敏感度（美元delta），而 $\\Delta S$ 是 $S$ 在一天内的变化。如果股票的一日回报率被建模为均值为零、方差为 $\\sigma^{2}$ 的正态分布，那么 $\\Delta S$ 近似服从均值为零、标准差为 $S_{0}\\sigma$ 的正态分布。在方差-协方差法下，置信度为 $\\alpha$ 的一日VaR（忽略微小的均值效应）为\n$$\n\\mathrm{VaR}_{\\alpha} \\propto |\\delta|\\,S_{0}\\sigma,\n$$\n因此，如果对所有建模的风险因子的净一阶敏感度 $\\delta$ 恰好为零，则计算出的一日VaR为零。然而，如果线性化忽略了重要的高阶风险（如gamma、vega）或遗漏了相关风险因子（如特质性部分），经济风险可能仍然很大。\n\n现在逐一评估每个选项。\n\n选项A：卖出1份欧式看涨期权和卖出1份欧式看跌期权，两者均为平价期权，行权价 $K=S_{0}$，到期日相同；无股票或现金头寸。\n\n根据无套利原理，在Black–Scholes框架下，对于无股息支付股票的欧式期权，看涨期权的delta为 $\\Delta_{c}=N(d_{1})$，看跌期权的delta为 $\\Delta_{p}=N(d_{1})-1$，其中 $N(\\cdot)$ 是标准正态累积分布函数，而 $d_{1}$ 是通常的Black–Scholes项。在远期平价(At-the-money forward)时，有 $d_{1}=0$ 因而 $N(0)=\\tfrac{1}{2}$。因此，在初始时，\n$$\n\\Delta_{c}=\\tfrac{1}{2},\\qquad \\Delta_{p}=-\\tfrac{1}{2}.\n$$\n卖出跨式组合（卖出1份看涨期权和1份看跌期权）的净delta为\n$$\n\\delta_{\\text{net}} = -\\Delta_{c} - \\Delta_{p} = -\\tfrac{1}{2} - (-\\tfrac{1}{2}) = 0.\n$$\n在忽略了gamma和vega的方差-协方差（delta-正态）法下，计算出的一日VaR因此为零，因为对唯​​一建模因子的一阶敞口为零。从经济角度看，该头寸风险极高：一个卖出的平价跨式组合是空头凸性（负gamma）。对于足够大的价格变动 $|\\Delta S|$，二阶项 $\\tfrac{1}{2}\\Gamma (\\Delta S)^{2}$（对于卖出跨式组合，$\\Gamma<0$）将占主导地位，可能产生巨大的损失。结论：正确。\n\n选项B：仅持有一张1天后到期的无风险国库券；忽略1天内的利率风险。\n\n根据所述假设，一日内的回报在1天内实际上是确定性的，并且没有建模的随机风险因子敞口。计算出的一日VaR为零，但该头寸并非“风险极高”；实际上，它被建模（并意图）为在该时间范围内无风险。这不满足“仍然具有极高风险”的要求。结论：不正确。\n\n选项C：买入1股该股票，并卖出市场指数期货以使投资组合的贝塔值恰好为零；VaR系统仅将市场指数作为权益因子建模，并忽略了特质性风险。\n\n设该股票的回报率分解为 $R_{i}=\\beta_{i} R_{m}+\\varepsilon_{i}$，其中 $R_{m}$ 是市场指数回报率，$\\varepsilon_{i}$ 是特质性部分，其方差为 $\\sigma_{\\varepsilon}^{2}$，且与 $R_{m}$ 独立。根据假设，方差-协方差系统只对 $R_{m}$ 建模，并将投资组合的敞口映射到单一因子 $R_{m}$ 上。选择期货的名义本金以将净贝塔值设为零，使得对 $R_{m}$ 建模的一阶敞口恰好为零。因此，在银行的因子集下，计算出的一日VaR为零。从经济角度看，该头寸仍然带有单只股票的特质性部分 $\\varepsilon_{i}$，这可能很大（例如，公司特定新闻、盈利意外）。由于该风险因子被模型忽略，它不计入计算的VaR中，但在现实中可能导致巨大损失。因此，该投资组合计算出的VaR为零，但潜在风险仍然极高。结论：正确。\n\n选项D：买入1份欧式看涨期权和卖出1份欧式看跌期权，两者均为平价期权，行权价 $K=S_{0}$；无股票或现金头寸。\n\n根据买卖权平价关系和delta，该头寸是一个合成远期：净delta等于\n$$\n\\delta_{\\text{net}} = \\Delta_{c} - \\Delta_{p} = \\tfrac{1}{2} - (-\\tfrac{1}{2}) = 1,\n$$\n所以它对股票价格有非零的一阶敞口。在方差-协方差法下，计算出的一日VaR与 $S_{0}\\sigma$ 成正比，并且严格为正，不为零。尽管该头寸可能有风险，但它不满足“通过方差-协方差法计算VaR为零”的条件。结论：不正确。\n\n总结：选项A和C满足在方差-协方差法下计算的VaR为零的条件，同时由于分别忽略了高阶（gamma）风险和遗漏了特质性风险，在经济上具有非常高的风险。", "answer": "$$\\boxed{AC}$$"}]}