{"hands_on_practices": [{"introduction": "资本配置线（CAL）的标准模型建立在一个关键假设之上：存在一个完全无风险的资产。然而，在现实世界中，即使是政府债券也存在违约风险。本练习旨在探讨当这个“无风险”资产并非真正无风险时，资本配置线会发生怎样的定性变化。通过分析这一假设的放松，你将深入理解投资机会集从理想化的直线向更现实的曲线（双曲线）的转变，从而培养对金融模型前提的批判性思维。[@problem_id:2438516]", "id": "2438516", "problem": "在现代投资组合理论（MPT）中，资本分配线（CAL）是由无风险资产和给定风险投资组合构成的投资组合的均值-标准差对集合。假设通常被视为无风险的资产实际上存在一个虽小但非零的违约概率 $p_d \\in (0,1)$，因此其回报是一个具有正方差的随机变量。考虑一个投资者，他可以在这种可违约的“现金”资产和给定的风险投资组合之间分配财富。在均值-方差平面上，$p_d>0$ 对资本分配线（CAL）产生的定性影响是什么？\n\nA. CAL保持不变：它仍然是一条穿过无风险利率的直线，因为一个小的 $p_d$ 仅降低了预期回报，但不影响其几何形状。\n\nB. CAL仍然是一条直线，只是平移至从可违约资产的预期回报开始，斜率与之前相同。\n\nC. CAL不再是一条直线：当 $p_d>0$ 时，“现金”资产具有正方差，并且通常与风险投资组合存在非零协方差，因此混合这两种资产所得到的可达均值-标准差对的集合是弯曲的；不存在方差为零的截距，并且相对于真正的无风险情况，可达集向内移动。\n\nD. CAL变得更陡峭，因为违约风险为“无风险”资产的预期回报增加了一个利差，其影响超过了增加的方差。\n\nE. CAL由于违约风险而成为一条在切点投资組合处有拐点的直线，但仍然在纵轴上与可违约资产的预期回报相交。", "solution": "必须首先验证问题陈述的科学性和逻辑完整性。\n\n### 步骤1：提取已知条件\n- **背景**：现代投资组合理论（MPT）。\n- **研究对象**：资本分配线（CAL），即结合无风险资产和单一风险投资组合所形成的投资组合的均值-标准差对的集合。\n- **修正**：通常被认为是无风险的资产现在是一种“可违约的‘现金’资产”。\n- **修正后资产的属性**：\n    - 它有一个虽小但非零的违约概率，$p_d \\in (0,1)$。\n    - 它的回报是一个随机变量，意味着它的方差为正。\n- **投资者的行为**：在这种可违约资产和一个给定的风险投资组合之间分配资本。\n- **问题**：在均值-方差（或均值-标准差）平面上，$p_d > 0$ 对CAL的形状有何定性影响？\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题在金融经济学中有充分的理论基础。无风险资产面临违约风险（例如，政府债券的主权信用风险）的概念是基本MPT模型的一个标准且重要的扩展。这在科学上是合理的。\n- **适定性**：该问题是适定的。它询问当一个核心假设（存在真正无风险的资产）被放宽时，投资机会集的几何形状会发生何种定性变化。新的几何形状由投资组合数学的原理唯一确定。\n- **客观性**：该问题以金融学和经济学通用的精确、客观和技术性语言陈述。没有歧义或主观性。\n\n### 步骤3：结论与行动\n问题陈述是有效的。它在计算经济学和金融学领域内提出了一个清晰、一致且科学合理的问题。可以进行严格的推导。\n\n### 推导\n\n我们首先建立基准情况，即标准的资本分配线（CAL）。设 $R_f$ 为真正无风险资产的回报，因此其预期回报为 $E[R_f] = r_f$，方差为 $\\text{Var}(R_f) = \\sigma_f^2 = 0$。设 $P$ 为一个风险投资组合，其预期回报为 $E[R_P] = \\mu_P$，标准差为 $\\text{StdDev}(R_P) = \\sigma_P > 0$。\n\n构建一个新投资组合 $N$，其在风险投资组合 $P$ 中的权重为 $w$，在无风险资产中的权重为 $(1-w)$。\n该投资组合的预期回报为：\n$$ \\mu_N = w \\mu_P + (1-w) r_f $$\n该投资組合的方差为：\n$$ \\sigma_N^2 = w^2 \\sigma_P^2 + (1-w)^2 \\sigma_f^2 + 2w(1-w)\\text{Cov}(R_P, R_f) $$\n由于无风险资产的方差为零，$\\sigma_f = 0$，其与任何其他资产的协方差也为零。表达式简化为：\n$$ \\sigma_N^2 = w^2 \\sigma_P^2 \\implies \\sigma_N = |w| \\sigma_P $$\n假设投资者持有风险资产的多头头寸（$w \\ge 0$），则有 $w = \\sigma_N / \\sigma_P$。将此代入预期回报方程：\n$$ \\mu_N = r_f + \\frac{\\sigma_N}{\\sigma_P}(\\mu_P - r_f) = r_f + \\left( \\frac{\\mu_P - r_f}{\\sigma_P} \\right) \\sigma_N $$\n这是 $(\\sigma, \\mu)$ 平面上的一条直线方程，其縱轴截距为 $(0, r_f)$。这条线就是CAL。\n\n现在，我们引入问题中描述的修正。将“无风险”资产替换为一种可违约的“现金”资产，我们称之为 $C$。设其回报为随机变量 $R_C$。问题陈述其违约概率为 $p_d \\in (0,1)$，因此具有正方差。让我们将其形式化。假设该资产在无违约状态下（概率为 $1-p_d$）产生回报 $r_{ok}$，在违约状态下（概率为 $p_d$）产生较低的回报 $r_{fail}$。\n预期回报为 $\\mu_C = E[R_C] = (1-p_d)r_{ok} + p_d r_{fail}$。\n方差为 $\\sigma_C^2 = \\text{Var}(R_C) = p_d(1-p_d)(r_{ok} - r_{fail})^2$。由于 $p_d \\in (0,1)$ 且要使风险有意义 $r_{ok} \\neq r_{fail}$，显然 $\\sigma_C^2 > 0$。\n\n因此，投资者现在是在组合两种风险资产：投资组合 $P$（特征为 $\\mu_P, \\sigma_P$）和可违约资产 $C$（特征为 $\\mu_C, \\sigma_C > 0$）。\n让我们构建一个新投资组合 $N'$，其在 $P$ 中的权重为 $w$，在 $C$ 中的权重为 $(1-w)$。\n预期回报为：\n$$ \\mu_{N'} = w \\mu_P + (1-w) \\mu_C $$\n方差为：\n$$ \\sigma_{N'}^2 = w^2 \\sigma_P^2 + (1-w)^2 \\sigma_C^2 + 2w(1-w)\\rho_{PC}\\sigma_P\\sigma_C $$\n其中 $\\rho_{PC}$ 是 $P$ 和 $C$ 回报之间的相关系数。违约风险通常是系统性风险的一个组成部分，因此可以合理假设 $\\rho_{PC}$ 不为零。\n\n这是两种风险资产投资组合的标准公式。当权重 $w$ 变化时，可达的 $(\\sigma_{N'}, \\mu_{N'})$ 对的集合在均值-标准差平面上描绘出一条双曲线。除非在 $\\rho_{PC} = \\pm 1$ 的退化情况下，它不是一条直线。\n\n主要后果是：\n1.  **曲率**：机会集不再是线性的。它是一条曲线（双曲线的一个分支）。\n2.  **无零风险截距**：可违约资产 $C$ 本身具有正的标准差 $\\sigma_C > 0$。由100%资产 $C$ 构成的投资组合由点 $(\\sigma_C, \\mu_C)$ 表示。通过组合 $P$ 和 $C$ 形成的最小方差投资组合也将具有正方差（除非 $\\rho_{PC}=-1$ 且权重被精确选择，这是一个特例而非普遍属性）。因此，新的机会集不会与 $\\sigma=0$ 的纵轴相交。\n3.  **被原始CAL所支配**：原始的CAL代表了最佳的风险-回报权衡。引入一个不完美之处（“无风险”资产中的风险）必然导致一组严格更差的投资机会。新的弯曲前沿将位于原始直线CAL的“内部”，意味着对于任何给定的风险水平 $\\sigma > \\sigma_C$，可实现的预期回报 $\\mu_{N'}$ 将低于原始CAL上的回报。\n\n### 逐项分析\n\n**A. CAL保持不变：它仍然是一条穿过无风险利率的直线，因为一个小的 $p_d$ 仅降低了预期回报，但不影响其几何形状。**\n这是**错误**的。违约风险 $p_d > 0$ 的存在从根本上将“现金”资产的性质从无风险变为有风险（$\\sigma_C > 0$）。两种风险资产的组合产生一个弯曲的（双曲线的）机会集，而不是一条直线。几何形状被深刻地影响了。\n\n**B. CAL仍然是一条直线，只是平移至从可违约资产的预期回报开始，斜率与之前相同。**\n这是**错误**的。它犯了两个错误。首先，机会集不是一条直线。其次，它不能在纵轴上“开始”，因为可违约资产本身具有正风险，$\\sigma_C > 0$。\n\n**C. CAL不再是一条直线：当 $p_d>0$ 时，“现金”资产具有正方差，并且通常与风险投资组合存在非零协方差，因此混合这两种资产所得到的可达均值-标准差对的集合是弯曲的；不存在方差为零的截距，并且相对于真正的无风险情况，可达集向内移动。**\n这是**正确**的。该选项准确地总结了此修正的所有后果。\n- “不再是一条直线...是弯曲的”：正确，它变成了一条双曲线。\n- “‘现金’资产具有正方差”：正确，如推导所示 $\\sigma_C^2 > 0$。\n- “通常非零的协方差”：正确，因为违约事件通常与更广泛的市场状况相关联。\n- “无零方差截距”：正确，最小方差投资组合的 $\\sigma_{min} > 0$。\n- “可达集向内移动”：正确，新的机会集被原始CAL所支配。\n\n**D. CAL变得更陡峭，因为违约风险为“无风险”资产的预期回报增加了一个利差，其影响超过了增加的方差。**\n这是**错误**的。主要缺陷在于机会集不再是一条线，因此将其“斜率”描述为“更陡峭”是没有意义的。关于违约风险为预期回报增加利差的前提在此背景下也是一个令人困惑的陈述；如果说有什么影响的话，对于给定的承诺回报，违约风险会降低预期回报。\n\n**E. CAL由于违约风险而成为一条在切点投資組合处有拐点的直线，但仍然在纵轴上与可违约资产的预期回报相交。**\n这是**错误**的。带拐点的线不是正确的形状；正确的形状是平滑的双曲线。此外，该集合不与纵轴相交。该前提在多个方面都有缺陷。", "answer": "$$\\boxed{C}$$"}, {"introduction": "现代投资组合理论的基石是均值-方差分析，它使用标准差作为风险的度量。但波动性真的是风险的全部吗？本练习挑战了这一传统观念，引导你使用一个对投资者可能更具意义的风险度量——“下行标准差”（downside deviation）。你将基于这个只关注负向波动的风险指标，构建一条新的资本配置线，其斜率即为索提诺比率（Sortino ratio）。这个实践将帮助你理解风险度量的多样性，并掌握如何根据不同的风险偏好来调整和构建投资策略。[@problem_id:2438521]", "id": "2438521", "problem": "投资者可以在一个无风险资产和一个单一风险资产之间分配财富。无风险资产具有恒定的总简单回报率 $r_{f}$，而风险资产的简单回报率 $R$ 服从均值为 $\\mu$、标准差为 $\\sigma$ 的正态分布。投资者使用相对于最低可接受回报率 (MAR) 的下行偏差来评估风险，该最低可接受回报率等于无风险利率。具体来说，定义超额回报 $X \\equiv R - r_{f}$ 以及风险资产的下行偏差（相对于 $r_{f}$）为\n$$\nD \\equiv \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, X)\\big)^{2}\\right]}。\n$$\n设一个投资组合将比例为 $w$ 的资金投资于风险资产，比例为 $1 - w$ 的资金投资于无风险资产，其中 $w \\geq 0$。投资组合的回报率为 $R_{p} \\equiv r_{f} + w\\,(R - r_{f})$。设投资组合的下行偏差（相对于 $r_{f}$）为 $D_{p} \\equiv \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, R_{p} - r_{f})\\big)^{2}\\right]}$。\n\n在给定参数值 $r_{f} = 0.02$，$\\mu = 0.08$ 和 $\\sigma = 0.20$ 的情况下，构建“Sortino 比率”资本配置线 (CAL)：即当 $w$ 在 $[0, 1]$ 区间内变化时，投资组合的预期回报 $\\mathbb{E}[R_{p}]$ 与其下行偏差 $D_{p}$ 之间的线性关系。你的最终答案必须是形如 $r_{f} + S\\,D_{p}$ 的单一解析表达式，其中数值斜率 $S$ 是根据上述正态模型从第一性原理计算得出。将斜率 $S$ 四舍五入到四位有效数字。所有回报率均以小数形式表示（例如，$8\\%$ 表示为 $0.08$）。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 无风险资产总简单回报率：$r_{f}$\n- 风险资产简单回报率：$R \\sim \\mathcal{N}(\\mu, \\sigma^2)$\n- 超额回报：$X \\equiv R - r_{f}$\n- 风险资产的下行偏差：$D \\equiv \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, X)\\big)^{2}\\right]}$\n- 投资组合中风险资产的权重：$w \\in [0, 1]$\n- 投资组合回报率：$R_{p} \\equiv r_{f} + w\\,(R - r_{f})$\n- 投资组合下行偏差：$D_{p} \\equiv \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, R_{p} - r_{f})\\big)^{2}\\right]}$\n- 参数值：$r_{f} = 0.02$，$\\mu = 0.08$，$\\sigma = 0.20$\n- 目标：找出 $\\mathbb{E}[R_{p}]$ 和 $D_{p}$ 之间形如 $r_{f} + S\\,D_{p}$ 的线性关系，并计算斜率 $S$ 的数值。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在量化金融领域，特别是投资组合理论中，具有科学依据。它使用了标准且定义明确的概念，例如回报率的正态分布、无风险利率、投资组合配置、预期回报，以及一个类似于 Sortino 比率分母的下行风险度量。这是一个适定问题，提供了所有必要的数据和定义，以推导出斜率 $S$ 的唯一解。语言客观而精确。数值对于金融市场是现实的。该问题是自洽的、一致的，并且在数学上是可解的。\n\n**步骤3：结论与行动**\n问题有效。将推导一个严谨的解。\n\n**资本配置线的推导**\n\n目标是建立投资组合的预期回报 $\\mathbb{E}[R_{p}]$ 与其下行偏差 $D_{p}$ 之间的线性关系。\n\n首先，我们表示投资组合的预期回报。投资组合的回报率由 $R_{p} = r_{f} + w(R - r_{f})$ 给出。根据期望算子的线性性质：\n$$\n\\mathbb{E}[R_{p}] = \\mathbb{E}[r_{f} + w(R - r_{f})] = r_{f} + w\\mathbb{E}[R - r_{f}]\n$$\n由于 $\\mathbb{E}[R] = \\mu$，预期超额回报为 $\\mathbb{E}[R - r_{f}] = \\mu - r_{f}$。因此，\n$$\n\\mathbb{E}[R_{p}] = r_{f} + w(\\mu - r_{f})\n$$\n\n接下来，我们分析投资组合的下行偏差 $D_{p}$。投资组合的超额回报是 $R_{p} - r_{f} = w(R - r_{f}) = wX$。将此代入 $D_{p}$ 的定义中：\n$$\nD_{p} = \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, R_{p} - r_{f})\\big)^{2}\\right]} = \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, wX)\\big)^{2}\\right]}\n$$\n鉴于权重 $w$ 是非负的（$w \\geq 0$），我们可以将其从 $\\min$ 函数中提出：\n$$\n\\min(0, wX) = w \\min(0, X)\n$$\n因此，\n$$\nD_{p} = \\sqrt{\\mathbb{E}\\!\\left[\\big(w \\min(0, X)\\big)^{2}\\right]} = \\sqrt{\\mathbb{E}\\!\\left[w^2 \\big(\\min(0, X)\\big)^{2}\\right]}\n$$\n由于 $w$ 相对于期望是常数，我们可以将 $w^2$ 从期望中提出：\n$$\nD_{p} = \\sqrt{w^2 \\mathbb{E}\\!\\left[\\big(\\min(0, X)\\big)^{2}\\right]} = |w| \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, X)\\big)^{2}\\right]}\n$$\n因为 $w \\geq 0$，所以 $|w| = w$。根据定义，$D = \\sqrt{\\mathbb{E}\\!\\left[\\big(\\min(0, X)\\big)^{2}\\right]}$。这得到了投资组合下行偏差与风险资产下行偏差之间的线性关系：\n$$\nD_{p} = wD\n$$\n为了构建资本配置线 (CAL)，我们从我们推导出的两个方程中消去权重 $w$。从第二个方程，我们得到 $w = D_{p} / D$（假设 $D \\neq 0$）。将此代入投资组合预期回报的方程中：\n$$\n\\mathbb{E}[R_{p}] = r_{f} + \\left(\\frac{D_{p}}{D}\\right)(\\mu - r_{f})\n$$\n重新整理这个方程，得到预期回报与下行偏差之间的线性关系：\n$$\n\\mathbb{E}[R_{p}] = r_{f} + \\left(\\frac{\\mu - r_{f}}{D}\\right) D_{p}\n$$\n这就是 CAL 的方程，其斜率 $S = (\\mu - r_{f}) / D$。这个斜率是风险资产的 Sortino 比率，其中目标回报率是无风险利率 $r_f$。\n\n**下行偏差 $D$ 的计算**\n为了求出斜率 $S$ 的数值，我们必须先计算 $D$。超额回报 $X=R-r_f$ 服从正态分布。由于 $R \\sim \\mathcal{N}(\\mu, \\sigma^2)$，则 $X \\sim \\mathcal{N}(\\mu_X, \\sigma^2)$，其中 $\\mu_X = \\mu - r_f$。\n量 $D^2$ 定义为 $\\mathbb{E}[(\\min(0, X))^2]$。这个期望可以通过对 $X$ 的概率密度函数 (PDF)（记为 $f_X(x)$）进行积分来计算：\n$$\nD^2 = \\int_{-\\infty}^{\\infty} (\\min(0, x))^2 f_X(x) dx = \\int_{-\\infty}^{0} x^2 f_X(x) dx\n$$\n这个积分是 $X$ 的正态分布的二阶下偏矩，阈值为 $0$。二阶下偏矩的通用公式，$LPM_2(c) = \\int_{-\\infty}^{c}(c-x)^2 f_X(x)dx$，是：\n$$\nLPM_2(c) = (\\sigma^2 + (\\mu_X - c)^2) \\Phi\\left(\\frac{c - \\mu_X}{\\sigma}\\right) - \\sigma(\\mu_X - c)\\phi\\left(\\frac{c - \\mu_X}{\\sigma}\\right)\n$$\n其中 $\\phi(\\cdot)$ 和 $\\Phi(\\cdot)$ 分别是标准正态分布的概率密度函数 (PDF) 和累积分布函数 (CDF)。\n在我们的案例中，积分是针对 $(\\min(0,X))^2 = (0-X)^2$（当 $X<0$ 时）和 $0$（其他情况）。所以我们需要计算 $LPM_2(0)$：\n$$\nD^2 = \\int_{-\\infty}^{0} (0-x)^2 f_X(x) dx = LPM_2(0)\n$$\n在通用公式中设 $c=0$：\n$$\nD^2 = (\\sigma^2 + \\mu_X^2) \\Phi\\left(-\\frac{\\mu_X}{\\sigma}\\right) - \\sigma(\\mu_X)\\phi\\left(-\\frac{\\mu_X}{\\sigma}\\right)\n$$\n使用性质 $\\phi(-z) = \\phi(z)$，我们将其写为：\n$$\nD^2 = (\\sigma^2 + \\mu_X^2) \\Phi\\left(-\\frac{\\mu_X}{\\sigma}\\right) + \\sigma\\mu_X\\phi\\left(\\frac{\\mu_X}{\\sigma}\\right)\n$$\n这似乎包含一个符号错误。让我用分部积分重新推导。正确的公式是 $D^2 = (\\sigma^2 + \\mu_X^2)\\Phi(-\\mu_X/\\sigma) - \\sigma \\mu_X \\phi(-\\mu_X/\\sigma)$。\n让我们重新检查标准公式。该项确实是 $-\\sigma(\\mu_X-c)\\phi(\\frac{c-\\mu_X}{\\sigma})$。当 $c=0$ 时，它就是 $-\\sigma(\\mu_X)\\phi(-\\mu_X/\\sigma)$。我的公式是正确的。\n\n现在，我们代入数值：\n$r_{f} = 0.02$\n$\\mu = 0.08$\n$\\sigma = 0.20$\n\n$X$ 分布的参数是：\n$\\mu_X = \\mu - r_{f} = 0.08 - 0.02 = 0.06$\n$\\sigma = 0.20$\n\n正态分布函数的参数是 $k = -\\mu_X / \\sigma = -0.06 / 0.20 = -0.3$。\n我们需要 $\\Phi(-0.3)$ 和 $\\phi(-0.3)$ 的值。\n$\\phi(-0.3) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(-0.3)^2}{2}\\right) \\approx 0.381388$\n$\\Phi(-0.3) \\approx 0.382089$\n\n现在我们计算 $D^2$：\n$\\sigma^2 = (0.20)^2 = 0.04$\n$\\mu_X^2 = (0.06)^2 = 0.0036$\n$\\sigma\\mu_X = (0.20)(0.06) = 0.012$\n\n$$\nD^2 = (0.04 + 0.0036) \\Phi(-0.3) - (0.012) \\phi(-0.3)\n$$\n$$\nD^2 \\approx (0.0436)(0.382089) - (0.012)(0.381388)\n$$\n$$\nD^2 \\approx 0.01665908 - 0.00457666 = 0.01208242\n$$\n下行偏差 $D$ 是平方根：\n$$\nD = \\sqrt{D^2} \\approx \\sqrt{0.01208242} \\approx 0.109920\n$$\n最后，我们计算斜率 $S$：\n$$\nS = \\frac{\\mu - r_{f}}{D} = \\frac{\\mu_X}{D} \\approx \\frac{0.06}{0.109920} \\approx 0.545851\n$$\n问题要求将斜率 $S$ 四舍五入到四位有效数字。\n$$\nS \\approx 0.5459\n$$\n得到的“Sortino 比率”资本配置线由表达式 $r_f + S D_p$ 给出，其中我们代入给定的 $r_f$ 值和计算出的 $S$ 值。最终的关系表达式为：\n$$\n\\mathbb{E}[R_{p}] = 0.02 + 0.5459 \\, D_{p}\n$$\n问题要求最终答案是这种形式的解析表达式。", "answer": "$$\n\\boxed{0.02 + 0.5459 D_{p}}\n$$"}, {"introduction": "理论上，寻找切线投资组合的公式简洁而优美，但在实践中，尤其是在面对众多资产时，我们必须依靠计算工具来实现这些理论。本练习将带你从理论走向实践，要求你为一个包含50种风险资产的投资组合编写代码，以确定其切线投资组合和资本市场线（CML）。你将应用 $w^* \\propto \\Sigma^{-1}(\\mu - r_f \\mathbf{1})$ 这一核心公式，通过矩阵运算解决多资产优化问题。这个综合性练习不仅能巩固你对理论的理解，更能让你掌握将金融模型转化为可执行代码的关键计算技能。[@problem_id:2438483]", "id": "2438483", "problem": "给定一个包含 $50$ 种风险资产的投资域。令 $R$ 表示资产回报率的 $50 \\times 50$ 相关系数矩阵，$\\sigma \\in \\mathbb{R}^{50}$ 为资产标准差向量，$\\mu \\in \\mathbb{R}^{50}$ 为预期回报率向量（所有值均以小数而非百分比表示），$\\Sigma = D R D$ 为协方差矩阵，其中 $D = \\operatorname{diag}(\\sigma)$。存在一个无风险利率 $r_f \\in \\mathbb{R}$（也以小数表示）。考虑由无风险资产和切点投资组合构成的资本配置线 (Capital Allocation Line, CAL)，在均衡状态下也称为资本市场线 (Capital Market Line, CML)。\n\n定义切点投资组合 $w^\\star \\in \\mathbb{R}^{50}$ 为最大化夏普比率的优化问题的解，允许卖空并满足预算约束：\n- 针对 $w \\in \\mathbb{R}^{50}$ 最大化 $(\\mu^\\top w - r_f)/\\sqrt{w^\\top \\Sigma w}$，\n- 约束条件为 $\\mathbf{1}^\\top w = 1$，其中 $\\mathbf{1}$ 是 $\\mathbb{R}^{50}$ 中的全一向量。\n\n令资本配置线 (CAL) 的斜率为 $S = (\\mu^\\top w^\\star - r_f)/\\sqrt{(w^\\star)^\\top \\Sigma w^\\star}$。对于任意目标标准差 $\\bar{\\sigma} \\ge 0$，CAL 上的预期回报率为 $E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\, \\bar{\\sigma}$。\n\n对于下方的每个测试用例，您必须：\n- 按规定构建 $R$、$\\sigma$、$\\mu$ 和 $\\Sigma$；\n- 在允许卖空的条件下，根据给定的 $r_f$ 和约束 $\\mathbf{1}^\\top w^\\star = 1$ 计算切点投资组合 $w^\\star$；\n- 针对目标标准差 $\\bar{\\sigma} \\in \\{0.0, 0.05, 0.15\\}$，计算 CAL 斜率 $S$ 和 CAL 预期回报率 $E_{\\text{CAL}}(\\bar{\\sigma})$。\n\n所有回报率和标准差均为无单位的小数。报告所有浮点数输出时，四舍五入至 $6$ 位小数。\n\n每个用例的测试套件和数据构建方法：\n- 对于给定的种子 $s \\in \\mathbb{Z}$，使用该种子定义一个随机数生成器。生成一个包含独立标准正态分布条目的矩阵 $A \\in \\mathbb{R}^{50 \\times 50}$。令 $M = A A^\\top$。通过 $R_{ij} = M_{ij}/\\sqrt{M_{ii} M_{jj}}$ (对所有 $i,j$) 定义相关系数矩阵 $R$。对于每个 $i \\in \\{1,\\dots,50\\}$，从 $[0.05, 0.35]$ 上的连续均匀分布中独立抽取 $\\sigma_i$。对于每个 $i \\in \\{1,\\dots,50\\}$，从 $[0.02, 0.18]$ 上的连续均匀分布中独立抽取 $\\mu_i$。设置 $D = \\operatorname{diag}(\\sigma)$ 和 $\\Sigma = D R D$。\n- 使用以下测试用例：\n    1. 用例 1：种子 $s=7$，无风险利率 $r_f = 0.02$。\n    2. 用例 2：种子 $s=11$，无风险利率 $r_f = 0.00$。\n    3. 用例 3：种子 $s=13$，无风险利率 $r_f = -0.01$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。对于每个测试用例，输出列表 $[S, E_{\\text{CAL}}(0.0), E_{\\text{CAL}}(0.05), E_{\\text{CAL}}(0.15)]$，其中每个条目四舍五入到 $6$ 位小数。最终输出必须是一个包含三个测试用例结果的单一列表。例如，最终输出格式必须为：\n[[S1,E1_0.0,E1_0.05,E1_0.15],[S2,E2_0.0,E2_0.05,E2_0.15],[S3,E3_0.0,E3_0.05,E3_0.15]].", "solution": "该问题陈述经确认为科学上合理、定义明确、客观且信息自足。它描述了现代投资组合理论中的一个标准问题：资本配置线 (CAL) 的确定。我们将进行完整的推导和计算求解。\n\n基本任务是找到“切点投资组合”，这是风险资产的投资组合，当与无风险资产结合时，能提供最佳的风险-回报权衡。在预期回报率-标准差平面上，该投资组合位于风险资产有效前沿与始于无风险利率的直线之间的切点。这条直线就是资本配置线。CAL 的斜率即为切点投资组合的夏普比率。\n\n令 `$w \\in \\mathbb{R}^{50}` 为 `$50$` 种风险资产的权重向量，权重之和为一：`$\\mathbf{1}^\\top w = 1$`，其中 `$\\mathbf{1}` 是全为 1 的向量。允许卖空，因此 `$w_i \\in \\mathbb{R}`。这样一个投资组合的预期回报率为 `$E[R_p] = \\mu^\\top w$`，其方差为 `$\\sigma_p^2 = w^\\top \\Sigma w$`，其中 `$\\mu}` 是预期回报率向量，`$\\Sigma}` 是资产回报率的协方差矩阵。\n\n目标是最大化风险资产投资组合的夏普比率 `$S_p$`：\n$$ \\text{maximize}_{w} \\quad S_p(w) = \\frac{\\mu^\\top w - r_f}{\\sqrt{w^\\top \\Sigma w}} $$\n约束条件为预算约束：\n$$ \\mathbf{1}^\\top w = 1 $$\n其中 `$r_f$` 是无风险回报率。\n\n令 `$\\mu_e = \\mu - r_f \\mathbf{1}` 为相对于无风险利率的超额预期回报向量。目标函数变为最大化 `$(\\mu_e^\\top w)/\\sqrt{w^\\top \\Sigma w}`。投资组合理论中的一个已知结论是，该问题的解是一个其权重 `$w` 与 `$\\Sigma^{-1} \\mu_e` 成比例的投资组合。这可以通过求解一个等价的优化问题来正式证明：在超额回报 `$\\mu_e^\\top w = C$`（对于某个常数 `$C > 0$`）固定的水平上，最小化方差 `$\\frac{1}{2} w^\\top \\Sigma w`。这个等价问题的拉格朗日函数是 `$\\mathcal{L}(w, \\lambda) = \\frac{1}{2} w^\\top \\Sigma w - \\lambda (\\mu_e^\\top w - C)$`。\n对 `$w$` 求导并令其为零，得到一阶条件：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial w} = \\Sigma w - \\lambda \\mu_e = 0 $$\n假设 `$\\Sigma}` 是可逆的（根据指定的构造方法，其可逆的概率为 `$1}`），我们发现任何此类最优投资组合的权重都具有以下形式：\n$$ w = \\lambda \\Sigma^{-1} \\mu_e $$\n这意味着切点投资组合的权重 `$w^\\star$` 与我们记为 `$w_{\\text{unscaled}} = \\Sigma^{-1} \\mu_e$` 的向量成比例。\n\n为了找到满足预算约束 `$\\mathbf{1}^\\top w^\\star = 1$` 的具体权重 `$w^\\star$`，我们必须对这个未经缩放的权重向量进行归一化。令 `$k = \\mathbf{1}^\\top w_{\\text{unscaled}}$` 为未经缩放的权重之和。那么归一化后的切点投资组合权重为：\n$$ w^\\star = \\frac{w_{\\text{unscaled}}}{k} = \\frac{\\Sigma^{-1} \\mu_e}{\\mathbf{1}^\\top (\\Sigma^{-1} \\mu_e)} = \\frac{\\Sigma^{-1} (\\mu - r_f \\mathbf{1})}{\\mathbf{1}^\\top \\Sigma^{-1} (\\mu - r_f \\mathbf{1})} $$\n在计算上，求解线性方程组 `$\\Sigma w_{\\text{unscaled}} = \\mu_e$` 以得到 `$w_{\\text{unscaled}}$` 比直接计算 `$\\Sigma}` 的逆矩阵在数值上更稳定。\n\n一旦确定了切点投资组合的权重 `$w^\\star$`，我们就可以计算其预期回报率 `$\\mu_p^\\star = \\mu^\\top w^\\star$` 和标准差 `$\\sigma_p^\\star = \\sqrt{(w^\\star)^\\top \\Sigma w^\\star}`。\n\n资本配置线的斜率 `$S$` 是该切点投资组合的夏普比率：\n$$ S = \\frac{\\mu_p^\\star - r_f}{\\sigma_p^\\star} = \\frac{\\mu^\\top w^\\star - r_f}{\\sqrt{(w^\\star)^\\top \\Sigma w^\\star}} $$\n\n最后，对于给定的目标标准差 `$\\bar{\\sigma} \\ge 0$`，CAL 上的预期回报率由以下线性关系给出：\n$$ E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\cdot \\bar{\\sigma} $$\n该公式描述了一个完整投资组合的预期回报率，该投资组合通过将一定比例的资本分配给切点投资组合，剩余部分分配给无风险资产而形成。对于 `$\\bar{\\sigma} = 0.0$`，投资组合 `$100\\%$` 投资于无风险资产，且 `$E_{\\text{CAL}}(0.0) = r_f$`。\n\n每个测试用例的算法如下：\n1.  使用给定的种子 `$s$` 初始化一个随机数生成器。\n2.  生成一个 `$50 \\times 50$` 的标准正态随机变量矩阵 `$A$`，其元素来自 `$\\mathcal{N}(0, 1)$`。\n3.  计算 `$M = A A^\\top$`。\n4.  构建相关系数矩阵 `$R$`，其中 `$R_{ij} = M_{ij} / \\sqrt{M_{ii} M_{jj}}$`。\n5.  从 `$U(0.05, 0.35)$` 生成标准差向量 `$\\sigma$`，并从 `$U(0.02, 0.18)$` 生成预期回报率向量 `$\\mu$`。\n6.  构建协方差矩阵 `$\\Sigma = D R D$`，其中 `$D = \\operatorname{diag}(\\sigma)$`。\n7.  计算超额回报向量 `$\\mu_e = \\mu - r_f \\mathbf{1}`。\n8.  求解线性方程组 `$\\Sigma w_{\\text{unscaled}} = \\mu_e$` 以得到 `$w_{\\text{unscaled}}$`。\n9.  归一化权重：`$w^\\star = w_{\\text{unscaled}} / (\\mathbf{1}^\\top w_{\\text{unscaled}})$`。\n10. 计算 CAL 斜率 `$S = (\\mu^\\top w^\\star - r_f) / \\sqrt{(w^\\star)^\\top \\Sigma w^\\star}`。\n11. 对 `$\\bar{\\sigma} \\in \\{0.0, 0.05, 0.15\\}` 计算 `$E_{\\text{CAL}}(\\bar{\\sigma}) = r_f + S \\cdot \\bar{\\sigma}`。\n12. 整理结果并四舍五入至 `$6$` 位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Capital Allocation Line slope and expected returns for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (seed, risk-free rate)\n        (7, 0.02),\n        (11, 0.00),\n        (13, -0.01),\n    ]\n\n    target_sigmas = [0.0, 0.05, 0.15]\n    all_results = []\n    \n    for case in test_cases:\n        s, r_f = case\n        \n        # --- Start of calculation for one case ---\n        N = 50  # Number of assets\n        rng = np.random.default_rng(seed=s)\n\n        # Step 1: Generate asset parameters\n        # Generate random matrix A and use it to construct a valid correlation matrix R\n        A = rng.standard_normal((N, N))\n        M = A @ A.T\n\n        # R_ij = M_ij / sqrt(M_ii * M_jj)\n        diag_M = np.diag(M)\n        diag_M_inv_sqrt = np.diag(1.0 / np.sqrt(diag_M))\n        R = diag_M_inv_sqrt @ M @ diag_M_inv_sqrt\n\n        # Generate vectors for standard deviation and expected return\n        sigma_vec = rng.uniform(0.05, 0.35, N)\n        mu_vec = rng.uniform(0.02, 0.18, N)\n\n        # Construct covariance matrix Sigma = D * R * D\n        D = np.diag(sigma_vec)\n        Sigma = D @ R @ D\n\n        # Step 2: Compute the tangency portfolio\n        # Vector of excess returns over the risk-free rate\n        mu_e = mu_vec - r_f\n        \n        # Solve the linear system Sigma * w_unscaled = mu_e for unscaled weights.\n        # This is more numerically stable than inverting Sigma.\n        w_unscaled = np.linalg.solve(Sigma, mu_e)\n\n        # Normalize weights to sum to 1 to get the tangency portfolio weights\n        w_star = w_unscaled / np.sum(w_unscaled)\n\n        # Step 3: Compute the CAL slope S\n        # Calculate expected return and standard deviation of the tangency portfolio\n        mu_p_star = mu_vec.T @ w_star\n        sigma_p_star = np.sqrt(w_star.T @ Sigma @ w_star)\n\n        # The slope S is the Sharpe ratio of the tangency portfolio\n        S = (mu_p_star - r_f) / sigma_p_star\n\n        # Step 4: Compute CAL expected returns for target standard deviations\n        E_cal_values = [r_f + S * ts for ts in target_sigmas]\n        \n        # Collect the results for the current case: [S, E_CAL(0.0), E_CAL(0.05), E_CAL(0.15)]\n        case_result_list = [S] + E_cal_values\n        \n        # --- End of calculation for one case ---\n        all_results.append(case_result_list)\n\n    # Final print statement in the exact required format.\n    # Format: [[S1,E1_0.0,E1_0.05,E1_0.15],[S2,...],[S3,...]]\n    outer_parts = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        inner_parts = [f\"{val:.6f}\" for val in res_list]\n        outer_parts.append(f\"[{','.join(inner_parts)}]\")\n    \n    final_output_str = f\"[{','.join(outer_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n\n```"}]}