{"hands_on_practices": [{"introduction": "这项练习旨在巩固估值的基石：两阶段贴现现金流（DCF）模型。你将练习为一种常见的现实世界情景建模，即一家公司在进入稳定、永续增长轨道之前，会经历一个快速的超常增长期。掌握这项技术 [@problem_id:2388239] 对于准确评估处于不同生命周期阶段的公司至关重要。", "id": "2388239", "problem": "一家公司在每个期末产生公司自由现金流 (FCFF)。在时间 $t=1$ 时的预期 FCFF 为 $C_1 = 100$ 百万美元。在 $t=1,2,3,4,5$ 期间，FCFF 以每个时期 $g_H = 0.20$ 的固定比率增长。从 $t=6$ 开始并无限持续，FCFF 以每个时期 $g_L = 0.04$ 的稳定比率增长。适用于这些现金流的固定折现率，即公司的加权平均资本成本，为每个时期 $r = 0.15$。假设不存在非经营性资产或负债，因此公司在时间 $t=0$ 的价值等于所有预期 FCFF 的现值。\n\n计算公司在时间 $t=0$ 时的价值。以百万美元为单位表示您的答案，并四舍五入至四位有效数字。", "solution": "以比率 $r$ 折现的一系列自由现金流 $\\{C_t\\}_{t=1}^{\\infty}$ 在时间 $t=0$ 的现值由现金流折现 (DCF) 的定义给出：\n$$\nV_0 \\;=\\; \\sum_{t=1}^{\\infty} \\frac{C_t}{(1+r)^{t}}.\n$$\n现金流过程是分段的。在前 $N=5$ 个时期，现金流从 $t=1$ 时的 $C_1$ 开始，以高增长率 $g_H$ 增长：\n$$\nC_t \\;=\\; C_1 (1+g_H)^{t-1}, \\quad t=1,2,3,4,5.\n$$\n从 $t=6$ 时期起，现金流永远以稳定增长率 $g_L$ 增长：\n$$\nC_{t} \\;=\\; C_6 (1+g_L)^{t-6}, \\quad t \\ge 6,\n$$\n其中 $C_6 \\;=\\; C_5 (1+g_L)$ 且 $C_5 \\;=\\; C_1 (1+g_H)^{4}$。\n\n因此，根据现值的可加性，公司的价值等于前5期现金流的现值与终期现金流（从$t=6$开始，以$g_L$比率增长的永续年金）在$t=0$时的现值之和。第一个组成部分是一个有限和：\n$$\n\\text{PV}_{\\text{high}} \\;=\\; \\sum_{t=1}^{5} \\frac{C_1 (1+g_H)^{t-1}}{(1+r)^{t}}\n\\;=\\; \\frac{C_1}{1+r} \\sum_{t=0}^{4} \\left(\\frac{1+g_H}{1+r}\\right)^{t}.\n$$\n这是一个公比为 $k \\equiv \\frac{1+g_H}{1+r}$ 的有限几何级数。利用几何级数公式，\n$$\n\\text{PV}_{\\text{high}} \\;=\\; \\frac{C_1}{1+r} \\cdot \\frac{1 - k^{5}}{1 - k}.\n$$\n\n第二个组成部分是终期现金流的现值，它可用一个在时间-5的终值来表示，该终值等于从$t=6$开始的增长型永续年金的价值：\n$$\n\\text{TV}_{5} \\;=\\; \\frac{C_6}{r - g_L}\n\\;=\\; \\frac{C_5 (1+g_L)}{r - g_L}\n\\;=\\; \\frac{C_1 (1+g_H)^{4} (1+g_L)}{r - g_L}.\n$$\n将此终值折现回5个时期至$t=0$，可得\n$$\n\\text{PV}_{\\text{term}} \\;=\\; \\frac{\\text{TV}_{5}}{(1+r)^{5}} \\;=\\; \\frac{C_1 (1+g_H)^{4} (1+g_L)}{(r - g_L)(1+r)^{5}}.\n$$\n\n因此，\n$$\nV_0 \\;=\\; \\text{PV}_{\\text{high}} + \\text{PV}_{\\text{term}}\n\\;=\\; \\frac{C_1}{1+r} \\cdot \\frac{1 - \\left(\\frac{1+g_H}{1+r}\\right)^{5}}{1 - \\frac{1+g_H}{1+r}}\n\\;+\\; \\frac{C_1 (1+g_H)^{4} (1+g_L)}{(r - g_L)(1+r)^{5}}.\n$$\n\n代入给定值 $C_1 = 100$，$g_H = 0.20$，$g_L = 0.04$，$r = 0.15$：\n- $1+r = \\frac{23}{20}$，\n- $1+g_H = \\frac{6}{5}$，\n- $1+g_L = \\frac{26}{25}$，\n- $\\frac{1+g_H}{1+r} = \\frac{6/5}{23/20} = \\frac{24}{23}$，\n- $r - g_L = \\frac{3}{20} - \\frac{1}{25} = \\frac{11}{100}$。\n\n精确计算每个组成部分。\n\n首先，高增长阶段：\n$$\n\\text{PV}_{\\text{high}} \\;=\\; \\frac{100}{23/20} \\cdot \\frac{1 - \\left(\\frac{24}{23}\\right)^{5}}{1 - \\frac{24}{23}}\n\\;=\\; \\left(\\frac{2000}{23}\\right) \\cdot \\frac{1 - \\left(\\frac{24}{23}\\right)^{5}}{-\\frac{1}{23}}\n\\;=\\; 2000 \\left[\\left(\\frac{24}{23}\\right)^{5} - 1\\right].\n$$\n由于 $\\left(\\frac{24}{23}\\right)^{5} = \\frac{24^{5}}{23^{5}} = \\frac{7{,}962{,}624}{6{,}436{,}343}$，我们有\n$$\n\\text{PV}_{\\text{high}} \\;=\\; 2000 \\left(\\frac{7{,}962{,}624 - 6{,}436{,}343}{6{,}436{,}343}\\right)\n\\;=\\; \\frac{3{,}052{,}562{,}000}{6{,}436{,}343}\n\\;\\approx\\; 474.269583.\n$$\n\n其次，终值部分：\n$$\n\\text{PV}_{\\text{term}} \\;=\\; \\frac{100 \\left(\\frac{6}{5}\\right)^{4} \\left(\\frac{26}{25}\\right)}{(11/100)\\left(\\frac{23}{20}\\right)^{5}}\n\\;=\\; \\frac{100 \\cdot \\frac{1296}{625} \\cdot \\frac{26}{25}}{\\frac{11}{100} \\cdot \\frac{6{,}436{,}343}{3{,}200{,}000}}\n\\;=\\; \\frac{336{,}960{,}000}{171{,}875} \\cdot \\frac{3{,}200{,}000}{6{,}436{,}343}\n\\;=\\; \\frac{8{,}626{,}176{,}000{,}000}{8{,}849{,}969{,}125}\n\\;\\approx\\; 974.712553.\n$$\n\n因此，\n$$\nV_0 \\;=\\; \\text{PV}_{\\text{high}} + \\text{PV}_{\\text{term}}\n\\;\\approx\\; 474.269583 + 974.712553\n\\;=\\; 1{,}448.982136.\n$$\n\n以百万美元表示并四舍五入至四位有效数字，公司的价值为 $1{,}449$。", "answer": "$$\\boxed{1449}$$"}, {"introduction": "现实世界的预测本身具有不确定性，本练习将超越单点估计，以构建更具弹性的估值模型。你将学习应用情景分析，这是一种通过定义不同且互斥的未来经济状态（例如，衰退、基准、高增长）来构建不确定性的有效方法。通过为每种情景计算估值并根据其概率进行加权 [@problem_id:2388264]，你将得出一个更能稳健地反映所有可能结果范围的期望值。", "id": "2388264", "problem": "一家公司的无杠杆公司自由现金流 (FCFF) 在三个相互排斥的宏观经济情景下，对第 $1$ 年至第 $5$ 年进行了预测。假设加权平均资本成本 (WACC) 为恒定的 $r = 0.09$。在第 $5$ 年末，每种情景都将过渡到一个从第 $6$ 年开始的永续增长阶段，其永续增长率 $g$ 因情景而异。FCFF（以百万货币单位计）、情景概率和长期增长率如下：\n\n- 衰退情景：概率为 $0.25$；第 $1$–$5$ 年的 FCFF 分别为 $\\{100, 95, 100, 110, 115\\}$；长期增长率 $g = 0.015$。\n- 基准情景：概率为 $0.55$；第 $1$–$5$ 年的 FCFF 分别为 $\\{120, 126, 132, 138, 145\\}$；长期增长率 $g = 0.025$。\n- 高增长情景：概率为 $0.20$；第 $1$–$5$ 年的 FCFF 分别为 $\\{130, 145, 160, 175, 190\\}$；长期增长率 $g = 0.035$。\n\n假设所有现金流均在每年年末发生，第 $6$ 年的预测 FCFF 等于第 $5$ 年的 FCFF 按其情景的增长率 $g$ 增长后的值，并且第 $5$ 年末的终值等于该情景下从第 $6$ 年开始的无限期 FCFF 流在第 $5$ 年的现值。使用现金流折现估值法，计算在时间 $0$ 点的概率加权企业价值。\n\n以百万货币单位表示最终价值。将您的答案四舍五入至四位有效数字。", "solution": "问题陈述经核实具有科学依据、提法明确且客观。它展示了不确定性下的现金流折现 (DCF) 分析的标准应用，这是计算金融学中的一个基本课题。所有必要数据均已提供，且参数一致。具体而言，永续增长模型收敛的条件，即加权平均资本成本 ($r$) 必须大于永续增长率 ($g$)，在所有三种情景下都得到满足：$0.09 > 0.015$，$0.09 > 0.025$ 和 $0.09 > 0.035$。因此，我们可以开始解题。\n\n在时间 $t=0$ 的企业价值，记为 $EV_0$，是为三种相互排斥的情景分别计算的企业价值的概率加权总和。令 $i \\in \\{1, 2, 3\\}$ 分别代表衰退、基准和高增长情景。总企业价值由下式给出：\n$$EV_0 = \\sum_{i=1}^{3} P_i \\cdot EV_{0,i}$$\n其中 $P_i$是情景 $i$ 的概率，$EV_{0,i}$ 是情景 $i$ 下时间 $t=0$ 的企业价值。\n\n对于每个情景 $i$，企业价值 $EV_{0,i}$ 是两个部分的和：明确预测期内（第 $t=1$ 年至第 $t=5$ 年）的公司自由现金流 ($FCFF$) 的现值，以及终值 ($TV_{5,i}$) 的现值，该终值反映了从第 $t=6$ 年开始直至永续的所有现金流的价值。\n$$EV_{0,i} = \\left( \\sum_{t=1}^{5} \\frac{FCFF_{i,t}}{(1+r)^t} \\right) + \\frac{TV_{5,i}}{(1+r)^5}$$\n第 $5$ 年末的终值 $TV_{5,i}$ 使用戈登增长模型计算，该模型假设现金流以恒定速率 $g_i$ 永续增长。\n$$TV_{5,i} = \\frac{FCFF_{i,6}}{r - g_i} = \\frac{FCFF_{i,5}(1+g_i)}{r - g_i}$$\n\n现在我们使用给定的折现率 $r = 0.09$ 计算每种情景下的 $EV_{0,i}$。\n\n情景 1：衰退\n- 概率：$P_1 = 0.25$\n- 第 $1-5$ 年的 FCFF：$\\{100, 95, 100, 110, 115\\}$\n- 永续增长率：$g_1 = 0.015$\n- 第 $5$ 年的终值为：\n$$TV_{5,1} = \\frac{FCFF_{1,5}(1+g_1)}{r - g_1} = \\frac{115(1+0.015)}{0.09 - 0.015} = \\frac{115(1.015)}{0.075} = \\frac{116.725}{0.075} \\approx 1556.333$$\n- 此情景下的企业价值为：\n$$EV_{0,1} = \\frac{100}{(1.09)^1} + \\frac{95}{(1.09)^2} + \\frac{100}{(1.09)^3} + \\frac{110}{(1.09)^4} + \\frac{115}{(1.09)^5} + \\frac{TV_{5,1}}{(1.09)^5}$$\n$$EV_{0,1} \\approx 91.743 + 79.960 + 77.218 + 77.927 + 74.742 + \\frac{1556.333}{1.538624} \\approx 401.590 + 1011.510 = 1413.100$$\n\n情景 2：基准\n- 概率：$P_2 = 0.55$\n- 第 $1-5$ 年的 FCFF：$\\{120, 126, 132, 138, 145\\}$\n- 永续增长率：$g_2 = 0.025$\n- 第 $5$ 年的终值为：\n$$TV_{5,2} = \\frac{FCFF_{2,5}(1+g_2)}{r - g_2} = \\frac{145(1+0.025)}{0.09 - 0.025} = \\frac{145(1.025)}{0.065} = \\frac{148.625}{0.065} \\approx 2286.538$$\n- 此情景下的企业价值为：\n$$EV_{0,2} = \\frac{120}{(1.09)^1} + \\frac{126}{(1.09)^2} + \\frac{132}{(1.09)^3} + \\frac{138}{(1.09)^4} + \\frac{145}{(1.09)^5} + \\frac{TV_{5,2}}{(1.09)^5}$$\n$$EV_{0,2} \\approx 110.092 + 106.052 + 101.928 + 97.763 + 94.240 + \\frac{2286.538}{1.538624} \\approx 510.075 + 1486.126 = 1996.201$$\n\n情景 3：高增长\n- 概率：$P_3 = 0.20$\n- 第 $1-5$ 年的 FCFF：$\\{130, 145, 160, 175, 190\\}$\n- 永续增长率：$g_3 = 0.035$\n- 第 $5$ 年的终值为：\n$$TV_{5,3} = \\frac{FCFF_{3,5}(1+g_3)}{r - g_3} = \\frac{190(1+0.035)}{0.09 - 0.035} = \\frac{190(1.035)}{0.055} = \\frac{196.65}{0.055} \\approx 3575.455$$\n- 此情景下的企业价值为：\n$$EV_{0,3} = \\frac{130}{(1.09)^1} + \\frac{145}{(1.09)^2} + \\frac{160}{(1.09)^3} + \\frac{175}{(1.09)^4} + \\frac{190}{(1.09)^5} + \\frac{TV_{5,3}}{(1.09)^5}$$\n$$EV_{0,3} \\approx 119.266 + 122.044 + 123.549 + 123.974 + 123.487 + \\frac{3575.455}{1.538624} \\approx 612.320 + 2323.829 = 2936.149$$\n\n最后，我们通过结合每种情景的价值来计算概率加权的企业价值：\n$$EV_0 = P_1 \\cdot EV_{0,1} + P_2 \\cdot EV_{0,2} + P_3 \\cdot EV_{0,3}$$\n$$EV_0 \\approx (0.25)(1413.100) + (0.55)(1996.201) + (0.20)(2936.149)$$\n$$EV_0 \\approx 353.275 + 1097.911 + 587.230 = 2038.416$$\n\n题目要求将最终答案四舍五入至四位有效数字。计算出的价值约为 $2038.416$。前四位有效数字是 $2$、$0$、$3$ 和 $8$。第五位有效数字是 $4$，因此我们向下舍入。\n最终的概率加权企业价值为 $2038$ 百万货币单位。", "answer": "$$\\boxed{2038}$$"}, {"introduction": "成为一名熟练的建模师不仅需要构建模型，还需要理解其局限性和关键驱动因素。本练习侧重于敏感性分析，这是一种对估值进行压力测试并识别哪些假设对最终结果影响最大的关键技术。通过编程方式评估企业价值如何响应贴现率 $r$ 和增长率 $g$ 等关键变量的变化 [@problem_id:2388216]，你可以量化模型的风险，并准确定位需要进一步尽职调查的最关键领域。", "id": "2388216", "problem": "要求您实现一个程序，计算为现金流折现（DCF）估值生成多维敏感性“蜘蛛图”所需的数据，但无需进行绘图。蜘蛛图将显示当几个关键输入变量受到对称的乘法冲击时，企业价值如何响应。您的程序必须精确计算这些冲击响应，并以单一标准化的嵌套列表格式输出。\n\n您应以货币时间价值和现值原理作为基本依据：未来现金流序列的现值等于这些现金流以适当的利率折现后的总和。对于一个永续增长模型，当其恒定增长率严格小于折现率时，其现值为有限值。您还必须使用连接增长、已投资资本回报率和再投资的恒等式：如果 $g$ 是营业利润的增长率，$\\mathrm{ROIC}$ 是已投资资本回报率，而 $b$ 是税后净营业利润中用于再投资的比例，则有 $g = \\mathrm{ROIC} \\times b$。\n\n定义一个基于 $T$ 个离散时期的简单公司模型：\n- 收入演变规律为 $R_t = R_{t-1} \\cdot (1 + g)$，其中 $t \\in \\{1,\\dots,T\\}$，从 $R_0$ 开始。\n- 营业利润率 $m$ 和税率 $\\tau$ 是常数。税后净营业利润为 $\\mathrm{NOPAT}_t = m \\cdot R_t \\cdot (1 - \\tau)$。\n- 再投资率为 $b = \\min\\{\\max\\{g/\\mathrm{ROIC}, 0\\}, 0.95\\}$，旨在确保 $0 \\le b &lt; 1$ 以实现数值稳定性，同时也反映了 $g = \\mathrm{ROIC} \\cdot b$ 的关系。\n- 每个预测年度的自由现金流为 $\\mathrm{FCF}_t = \\mathrm{NOPAT}_t \\cdot (1 - b)$，其中 $t \\in \\{1,\\dots,T\\}$。\n- 终期使用恒定的终期增长率 $g_{\\text{term}}$，且 $g_{\\text{term}} &lt; r$（折现率），终期再投资率为 $b_{\\text{term}} = \\min\\{\\max\\{g_{\\text{term}}/\\mathrm{ROIC}, 0\\}, 0.95\\}$。计算 $\\mathrm{FCF}_{T+1} = \\mathrm{NOPAT}_{T+1} \\cdot (1 - b_{\\text{term}})$，其中 $\\mathrm{NOPAT}_{T+1} = m \\cdot R_T \\cdot (1 + g_{\\text{term}}) \\cdot (1 - \\tau)$。\n\n将企业价值定义为\n$$\n\\mathrm{EV} = \\sum_{t=1}^{T} \\frac{\\mathrm{FCF}_t}{(1 + r)^t} \\;+\\; \\frac{\\mathrm{FCF}_{T+1}}{(r - g_{\\text{term}}) \\cdot (1 + r)^T}.\n$$\n\n您的程序必须：\n- 实现一个函数，根据给定的 $R_0, g, m, \\tau, \\mathrm{ROIC}, r, g_{\\text{term}}$ 和 $T$ 来计算 $\\mathrm{EV}$。\n- 对于一个给定的基准参数集，计算当对下列五个变量中的每一个（一次一个）施加对称的乘法冲击时 $\\mathrm{EV}$ 的相对变化，同时保持其他变量不变：\n  1. 折现率 $r$，\n  2. 增长率 $g$，\n  3. 营业利润率 $m$，\n  4. 税率 $\\tau$，\n  5. 已投资资本回报率 $\\mathrm{ROIC}$。\n- 对于给定的冲击幅度集 $S = \\{s_1, s_2\\}$（例如 $s_1 = -0.1, s_2 = +0.1$），将每个 $s \\in S$ 应用于变量 $x$，即用 $x \\cdot (1 + s)$ 替换其基准值 $x$。对于每种冲击情况，计算价值的相对变化，其定义为\n$$\n\\Delta_{\\mathrm{EV}}(x, s) \\equiv \\frac{\\mathrm{EV}(x \\cdot (1+s))}{\\mathrm{EV}(x)} - 1.\n$$\n- 按照 $[r, g, m, \\tau, \\mathrm{ROIC}]$ 的变量顺序汇总结果，并为每个变量返回一个包含两个浮点数 $[\\Delta_{\\mathrm{EV}}(x, s_1), \\Delta_{\\mathrm{EV}}(x, s_2)]$ 的列表，以表示蜘蛛图上该变量坐标轴的径向坐标。\n\n测试套件。您的程序必须运行以下三个基准参数集和冲击幅度，并按照下面指定的格式将所有三个案例的结果输出到一行中：\n- 案例 A（正常路径）：$R_0 = 100.0$, $g = 0.05$, $m = 0.20$, $\\tau = 0.25$, $\\mathrm{ROIC} = 0.12$, $r = 0.09$, $g_{\\text{term}} = 0.02$, $T = 5$, $S = \\{-0.1, +0.1\\}$。\n- 案例 B（边界情况，折现率接近终期增长率）：$R_0 = 120.0$, $g = 0.04$, $m = 0.15$, $\\tau = 0.30$, $\\mathrm{ROIC} = 0.10$, $r = 0.06$, $g_{\\text{term}} = 0.045$, $T = 5$, $S = \\{-0.1, +0.1\\}$。确保在冲击下 $r &gt; g_{\\text{term}}$ 仍然成立。\n- 案例 C（边缘情况，低 $\\mathrm{ROIC}$ 与高再投资）：$R_0 = 90.0$, $g = 0.06$, $m = 0.18$, $\\tau = 0.22$, $\\mathrm{ROIC} = 0.08, r = 0.10, g_{\\text{term}} = 0.025$, $T = 5$, $S = \\{-0.1, +0.1\\}$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个嵌套列表，该列表有三个元素（每个案例一个）。每个案例元素本身是一个包含五个列表的列表，严格按照 $[r, g, m, \\tau, \\mathrm{ROIC}]$ 的变量顺序排列，其中每个内部列表包含 $[\\Delta_{\\mathrm{EV}}(\\cdot, -0.1), \\Delta_{\\mathrm{EV}}(\\cdot, +0.1)]$ 的两个浮点数。所有浮点数必须四舍五入到 $6$ 位小数。最终打印的字符串必须不含任何空格。格式示例（非实际数值）：\n$[[[a_{11},a_{12}],[a_{21},a_{22}],[a_{31},a_{32}],[a_{41},a_{42}],[a_{51},a_{52}]],[[b_{11},b_{12}],\\dots],[[c_{11},c_{12}],\\dots]]$。", "solution": "问题陈述已经过分析，并被认为是有效的。这是一个在计算金融领域中提法得当、有科学依据的问题，没有矛盾或歧义。任务是实现一个标准的两阶段现金流折现（DCF）模型，并对其关键参数进行敏感性分析。\n\n问题的核心是计算公司的企业价值（$\\mathrm{EV}$），其定义为未来自由现金流（$\\mathrm{FCF}$）的现值。所提供的模型是一个两阶段DCF模型，包含一个为期 $T$ 年的明确预测期和一个代表所有后续现金流的终值。\n\n模型参数为：\n- $R_0$：时间 $t=0$ 时的初始收入。\n- $g$：明确预测期内的收入增长率。\n- $m$：营业利润率（恒定）。\n- $\\tau$：公司税率（恒定）。\n- $\\mathrm{ROIC}$：已投资资本回报率（恒定）。\n- $r$：折现率（资本成本）。\n- $g_{\\text{term}}$：第 $T$ 年后现金流的终期增长率。\n- $T$：明确预测期的长度（以年为单位）。\n\n该算法分两个主要部分进行：首先，实现 $\\mathrm{EV}$ 的计算；其次，系统地对输入变量施加冲击，以衡量 $\\mathrm{EV}$ 的敏感性。\n\n首先，我们对给定参数集的 $\\mathrm{EV}$ 计算进行形式化。\n对于从 $1$ 到 $T$ 的每一年 $t$，财务量按顺序确定：\n1.  第 $t$ 年的收入是根据上一年的收入和增长率 $g$ 预测的：\n    $$R_t = R_{t-1} \\cdot (1 + g)$$\n    这个递归定义意味着 $R_t = R_0 \\cdot (1 + g)^t$。\n\n2.  税后净营业利润（$\\mathrm{NOPAT}$）是使用营业利润率 $m$ 和税率 $\\tau$ 从收入中计算得出：\n    $$\\mathrm{NOPAT}_t = R_t \\cdot m \\cdot (1 - \\tau)$$\n\n3.  为了支持增长，$\\mathrm{NOPAT}$ 的一部分 $b$ 将被再投资回公司。这个再投资率 $b$ 通过基本恒等式 $g = b \\cdot \\mathrm{ROIC}$ 与增长率 $g$ 和已投资资本回报率 $\\mathrm{ROIC}$ 相关联。由此，我们推导出 $b = g / \\mathrm{ROIC}$。问题施加了约束以确保 $b$ 在经济学上是合理的，具体为 $0 \\le b \\le 0.95$。这是通过以下公式强制执行的：\n    $$b = \\min(\\max(g / \\mathrm{ROIC}, 0), 0.95)$$\n\n4.  公司的自由现金流（$\\mathrm{FCF}$）是 $\\mathrm{NOPAT}$ 中未被再投资的部分：\n    $$\\mathrm{FCF}_t = \\mathrm{NOPAT}_t \\cdot (1 - b)$$\n\n在明确预测期内（$t=1, \\dots, T$）产生的自由现金流的现值，是每个 $\\mathrm{FCF}_t$ 以利率 $r$ 折现后的总和：\n$$\\mathrm{PV}_{\\text{forecast}} = \\sum_{t=1}^{T} \\frac{\\mathrm{FCF}_t}{(1 + r)^t}$$\n\n在明确预测期之后，假设公司以恒定的终期增长率 $g_{\\text{term}}$ 增长。终值（$\\mathrm{TV}_T$）捕捉了从第 $T+1$ 年起所有现金流在时间 $T$ 的现值。这是使用戈登增长模型计算的，该模型需要终期第一年的自由现金流 $\\mathrm{FCF}_{T+1}$。\n1.  首先，我们通过增长上一时期的NOPAT来计算 $\\mathrm{NOPAT}_{T+1}$，这可以通过 $R_T$ 表达：\n    $$\\mathrm{NOPAT}_{T+1} = (R_T \\cdot (1+g_{\\text{term}})) \\cdot m \\cdot (1-\\tau)$$\n2.  终期再投资率 $b_{\\text{term}}$ 由终期增长率 $g_{\\text{term}}$ 和 $\\mathrm{ROIC}$ 决定：\n    $$b_{\\text{term}} = \\min(\\max(g_{\\text{term}} / \\mathrm{ROIC}, 0), 0.95)$$\n    注意，$\\mathrm{ROIC}$ 假设在永续期内保持不变。\n3.  那么第 $T+1$ 年的自由现金流是：\n    $$\\mathrm{FCF}_{T+1} = \\mathrm{NOPAT}_{T+1} \\cdot (1 - b_{\\text{term}})$$\n4.  在时间 $T$ 的终值是一个永续增长体的价值，仅在 $r > g_{\\text{term}}$ 时有效：\n    $$\\mathrm{TV}_T = \\frac{\\mathrm{FCF}_{T+1}}{r - g_{\\text{term}}}$$\n5.  这个终值必须折现回现时（$t=0$）：\n    $$\\mathrm{PV}_{\\text{terminal}} = \\frac{\\mathrm{TV}_T}{(1+r)^T}$$\n\n总企业价值是这两个时期现值的总和：\n$$\\mathrm{EV} = \\mathrm{PV}_{\\text{forecast}} + \\mathrm{PV}_{\\text{terminal}}$$\n\n算法的第二部分是敏感性分析。对于给定的基准参数集，我们首先计算基准企业价值 $\\mathrm{EV}_{\\text{base}}$。然后，对于集合 $\\{r, g, m, \\tau, \\mathrm{ROIC}\\}$ 中的每个变量 $x$，我们应用乘法冲击。对于集合 $S = \\{-0.1, +0.1\\}$ 中的每个冲击幅度 $s$，变量的基准值被替换为 $x' = x \\cdot (1+s)$，而所有其他参数保持其基准值。使用这组修改后的参数计算新的企业价值 $\\mathrm{EV}_{\\text{shocked}}$。然后，$\\mathrm{EV}$ 的相对变化计算如下：\n$$\\Delta_{\\mathrm{EV}}(x, s) = \\frac{\\mathrm{EV}(x \\cdot (1+s))}{\\mathrm{EV}_{\\text{base}}} - 1$$\n对五个变量中的每一个和两个冲击值重复此过程。结果按照规定汇总成嵌套列表结构，数值四舍五入到 $6$ 位小数。\n\n具体实现将包括一个主函数，用于执行上述的DCF估值。第二个更高层次的函数将通过遍历测试案例、待冲击的变量和冲击幅度来管理敏感性分析，为每种情景调用估值函数，并将结果整理成预定的最终格式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_ev(R0, g, m, tau, roic, r, g_term, T):\n    \"\"\"\n    Computes the Enterprise Value (EV) using a two-stage DCF model.\n    \"\"\"\n    # The condition r > g_term must hold for the terminal value perpetuity formula to be valid.\n    # This is checked at the validation stage and holds for all required calculations.\n    # An explicit check is included for function robustness.\n    if r <= g_term:\n        return np.nan\n\n    # --- Forecast Period Calculation ---\n\n    # Calculate reinvestment rate for the forecast period (b).\n    # Handle roic = 0 case, though not in test data, for robustness.\n    if roic == 0:\n        b = 0.95 if g > 0 else 0.0\n    else:\n        b = np.clip(g / roic, 0, 0.95)\n\n    # Project revenues, NOPAT, and FCF for t=1 through t=T.\n    t_values = np.arange(1, T + 1)\n    revenues_t = R0 * np.power(1 + g, t_values)\n    nopat_t = revenues_t * m * (1 - tau)\n    fcf_t = nopat_t * (1 - b)\n\n    # Discount the FCFs to present value.\n    discount_factors = np.power(1 + r, t_values)\n    pv_fcf = np.sum(fcf_t / discount_factors)\n\n    # --- Terminal Value Calculation ---\n\n    # Calculate terminal reinvestment rate (b_term).\n    if roic == 0:\n        b_term = 0.95 if g_term > 0 else 0.0\n    else:\n        b_term = np.clip(g_term / roic, 0, 0.95)\n\n    # Calculate NOPAT and FCF for the first year of the terminal period (t=T+1).\n    revenue_T = R0 * np.power(1 + g, T)\n    nopat_T_plus_1 = revenue_T * (1 + g_term) * m * (1 - tau)\n    fcf_T_plus_1 = nopat_T_plus_1 * (1 - b_term)\n\n    # Calculate terminal value at time T.\n    tv_T = fcf_T_plus_1 / (r - g_term)\n\n    # Discount terminal value to present value.\n    pv_tv = tv_T / np.power(1 + r, T)\n\n    # Total Enterprise Value is the sum of the two present value components.\n    ev = pv_fcf + pv_tv\n    return ev\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (happy path)\n        {'R0': 100.0, 'g': 0.05, 'm': 0.20, 'tau': 0.25, 'roic': 0.12, 'r': 0.09, 'g_term': 0.02, 'T': 5},\n        # Case B (boundary, discount close to terminal growth)\n        {'R0': 120.0, 'g': 0.04, 'm': 0.15, 'tau': 0.30, 'roic': 0.10, 'r': 0.06, 'g_term': 0.045, 'T': 5},\n        # Case C (edge, low ROIC with high reinvestment)\n        {'R0': 90.0, 'g': 0.06, 'm': 0.18, 'tau': 0.22, 'roic': 0.08, 'r': 0.10, 'g_term': 0.025, 'T': 5},\n    ]\n\n    shocks = [-0.1, 0.1]\n    shock_vars_order = ['r', 'g', 'm', 'tau', 'roic']\n\n    all_results = []\n    \n    for base_params in test_cases:\n        # Calculate the baseline Enterprise Value\n        ev_base = compute_ev(**base_params)\n        \n        case_results = []\n        for var_key in shock_vars_order:\n            var_shock_results = []\n            for s in shocks:\n                shocked_params = base_params.copy()\n                shocked_params[var_key] *= (1 + s)\n                \n                # Recalculate EV with the shocked parameter\n                ev_shocked = compute_ev(**shocked_params)\n                \n                # Calculate the fractional change in EV\n                if ev_base == 0:\n                    delta_ev = np.nan if ev_shocked != 0 else 0.0\n                else:    \n                    delta_ev = (ev_shocked / ev_base) - 1.0\n\n                var_shock_results.append(delta_ev)\n            \n            case_results.append(var_shock_results)\n        \n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified:\n    # A nested list, rounded to 6 decimal places, with no spaces.\n    case_strings = []\n    for case_res in all_results:\n        var_strings = []\n        for var_res in case_res:\n            formatted_floats = [f\"{x:.6f}\" for x in var_res]\n            var_strings.append(f'[{\",\".join(formatted_floats)}]')\n        case_strings.append(f'[{\",\".join(var_strings)}]')\n\n    final_output_string = f'[{\",\".join(case_strings)}]'\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"}]}