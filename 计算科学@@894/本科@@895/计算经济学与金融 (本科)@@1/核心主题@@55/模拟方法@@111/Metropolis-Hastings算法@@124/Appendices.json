{"hands_on_practices": [{"introduction": "Metropolis-Hastings 算法的核心在于其接受-拒绝机制，它决定了马尔可夫链是否移动到一个新的状态。这个基础练习将带你直接计算接受概率，这是理解和实现该算法的第一步。通过处理一个离散的目标分布（泊松分布），你将熟练掌握 M-H 算法中最核心的计算环节 [@problem_id:1962612]。", "id": "1962612", "problem": "一位统计学家正在实现一个马尔可夫链蒙特卡洛 (MCMC) 模拟，以从一个目标概率分布中生成样本。选定的目标分布是泊松分布，该分布用于建模在固定的时间或空间间隔内发生事件的次数 $k$。泊松分布的概率质量函数由下式给出：\n$$ P(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!} $$\n其中 $\\lambda$ 是事件的平均发生率。对于本次特定的模拟，参数设定为 $\\lambda = 5$。\n\n该模拟使用 Metropolis-Hastings 算法和一个对称提议分布，这意味着从状态 $k_1$ 移动到状态 $k_2$ 的提议概率与从状态 $k_2$ 移动到状态 $k_1$ 的提议概率相同。\n\n假设马尔可夫链的当前状态是 $k=5$。然后算法提议移动到一个新状态 $k'=6$。\n\n计算从 $k=5$ 移动到 $k'=6$ 这个提议移动的接受概率。将您的答案表示为保留三位有效数字的小数。", "solution": "在使用对称提议分布的 Metropolis-Hastings 算法中，从状态 $k$ 移动到状态 $k'$ 的提议移动的接受概率为\n$$\n\\alpha = \\min\\left(1, \\frac{\\pi(k')}{\\pi(k)}\\right),\n$$\n其中 $\\pi(\\cdot)$ 是目标概率质量函数。对于参数为 $\\lambda$ 的泊松分布，其概率质量函数为\n$$\n\\pi(k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}.\n$$\n因此，该比率可简化为\n$$\n\\frac{\\pi(k')}{\\pi(k)} = \\frac{\\lambda^{k'} \\exp(-\\lambda) / k'!}{\\lambda^{k} \\exp(-\\lambda) / k!} = \\lambda^{k'-k} \\frac{k!}{k'!}.\n$$\n当 $k=5$, $k'=6$ 且 $\\lambda=5$ 时，我们有 $k'-k=1$ 且 $6! = 6 \\cdot 5!$，所以\n$$\n\\frac{\\pi(6)}{\\pi(5)} = \\lambda \\cdot \\frac{5!}{6!} = \\lambda \\cdot \\frac{1}{6} = \\frac{5}{6}.\n$$\n因此，接受概率是\n$$\n\\alpha = \\min\\left(1, \\frac{5}{6}\\right) = \\frac{5}{6}.\n$$\n表示为保留三位有效数字的小数，结果是 $0.833$。", "answer": "$$\\boxed{0.833}$$"}, {"introduction": "在掌握了基本计算之后，让我们来探讨一个在实际应用中常见的挑战：多峰分布。这个思想实验将揭示当提议分布的步长相对于目标分布的复杂性而言太小时会发生什么 [@problem_id:1962668]。理解这种情况对于诊断 MCMC 链的收敛问题至关重要，并能帮助你认识到为何调整提议分布是每个 MCMC 从业者都必须具备的关键技能。", "id": "1962668", "problem": "一位数据科学家正在分析一个复杂气候模型参数 $\\theta$ 的后验概率分布。分析显示，记为 $p(\\theta)$ 的后验分布是双峰的，在 $\\theta_A$ 和 $\\theta_B$ 处有两个明显的高概率峰，它们之间由一个非常宽的低概率区域隔开。为了探索该分布并估计后验均值等性质，这位科学家采用了 Metropolis-Hastings (M-H) 算法。\n\nM-H 采样器以位于第一个峰 $\\theta_A$ 附近高概率区域内的初始值 $\\theta_0$ 进行初始化。使用了对称提议分布 $q(\\theta' | \\theta) = \\mathcal{N}(\\theta' | \\theta, \\sigma^2)$，其中 $\\mathcal{N}$ 是以当前状态 $\\theta$ 为中心、标准差为 $\\sigma$ 的正态分布，$\\sigma$ 代表提议步长。这位科学家为了获得高接受率，选择了一个相对于两峰间距 $|\\theta_A - \\theta_B|$ 非常小的 $\\sigma$ 值。\n\n在运行 M-H 采样器非常多次迭代后，下列哪个描述最准确地刻画了这次模拟的预期结果？\n\nA. 采样器将高效地找到后验分布 $p(\\theta)$ 的全局最大值并停留在那里，从而为参数提供一个极好的点估计。\nB. 提议状态的接受率将非常低，导致链停留在初始状态 $\\theta_0$ 附近，并且只探索了参数空间中很小的一部分。\nC. 生成的样本链将高度自相关，其直方图将主要呈现 $\\theta_A$ 附近峰的形状，而无法发现 $\\theta_B$ 附近的峰。\nD. 样本将在两个峰之间系统性地交替，以规律的频率从 $\\theta_A$ 区域跳到 $\\theta_B$ 区域，再跳回来。\nE. 链的状态将几乎相互独立，表明采样器已成功收敛到真实的双峰后验分布。", "solution": "我们分析使用对称提议分布且提议尺度相对于后验分布 $p(\\theta)$ 在 $\\theta_{A}$ 和 $\\theta_{B}$ 处的两个分离的峰之间的距离非常小的 Metropolis-Hastings (M-H) 采样器。\n\n对于对称提议分布 $q(\\theta' \\mid \\theta) = \\mathcal{N}(\\theta' \\mid \\theta, \\sigma^{2})$，Metropolis-Hastings 的接受概率为\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\}。\n$$\n链在 $\\theta_{A}$ 附近的高概率区域以 $\\theta_{0}$ 初始化。因为选择的 $\\sigma$ 相对于分离距离 $|\\theta_{A} - \\theta_{B}|$ 非常小，所以提议的移动满足 $|\\theta' - \\theta| = O(\\sigma)$，因此会保持在离当前状态非常近的位置。在一个峰附近的高概率区域，对于小步长的移动，$p(\\theta')$ 与 $p(\\theta)$ 相近，所以\n$$\n\\frac{p(\\theta')}{p(\\theta)} \\approx 1,\n$$\n这意味着 $a(\\theta \\rightarrow \\theta') \\approx 1$，且局部接受率很高。因此，选项 B（非常低的接受率）与峰内小步长移动的行为相矛盾。\n\n接下来，考虑峰之间的转换。在高斯提议分布下，从 $\\theta_{A}$ 附近的当前状态直接提议一个 $\\theta_{B}$ 附近的状态的概率是\n$$\nq(\\theta_{B} \\mid \\theta) \\propto \\exp\\left(-\\frac{|\\theta_{B} - \\theta|^{2}}{2 \\sigma^{2}}\\right)。\n$$\n由于 $\\sigma \\ll |\\theta_{A} - \\theta_{B}|$，这个提议概率在 $|\\theta_{A} - \\theta_{B}|^{2} / \\sigma^{2}$ 上是指数级小的。因此，在实际的时间尺度上，基本不会提议直接跨越低概率谷的跳转。另外，通过许多小步来穿越这个谷地需要重复地提议移动到 $p(\\theta') \\ll p(\\theta)$ 的区域，对于这种情况\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\} \\ll 1,\n$$\n所以这样的步长移动绝大多数会被拒绝。因此，在很长一段时间内，链实际上被困在 $\\theta_{A}$ 附近，在实践中无法发现 $\\theta_{B}$。\n\n因为移动是非常局部的，并且链停留在同一个峰内，所以连续的样本是高度自相关的。因此，经验直方图反映了 $\\theta_{A}$ 周围的局部形状，但没有捕捉到 $\\theta_{B}$ 附近的分离峰。这排除了选项 E（独立性和成功收敛）和选项 D（在峰之间规律性交替）。选项 A 是不正确的，因为 M-H 是一个以 $p(\\theta)$ 为目标的采样器，而不是一个优化器；此外，在小步长和双峰性的情况下，它既不能高效地找到全局最大值，也不能停留在那里。\n\n因此，最准确的描述是，链表现出高度自相关性，主要在 $\\theta_{A}$ 的邻域内采样，并且未能发现第二个峰 $\\theta_{B}$。\n\n正确的选项是 C。", "answer": "$$\\boxed{C}$$"}, {"introduction": "最后，我们将在高效探索这一主题上更进一步，深入研究提议分布设计的艺术。通过为一个相关的二元分布比较两种不同的提议方案，你将定量地看到一个“智能”的、尊重目标分布几何特性的提议如何显著提高采样效率 [@problem_id:1962663]。这个练习将帮助你从算法的基础实现跨越到更高级的优化应用，让你体验到 MCMC 方法的强大与精妙。", "id": "1962663", "problem": "一位统计学家正在使用 Metropolis-Hastings 算法从 $\\mathbb{R}^2$ 上的一个二元目标分布中进行抽样，该分布的概率密度函数 (PDF) $\\pi(x, y)$ 与下式成正比：\n$$\n\\pi(x, y) \\propto \\exp\\left(-\\frac{x^2 - 2\\rho xy + y^2}{2(1-\\rho^2)}\\right)\n$$\n其中 $\\rho$ 是一个常数相关参数，满足 $0 < \\rho < 1$。\n\n马尔可夫链的当前状态是 $(X_t, Y_t) = (c, c)$，其中 $c$ 是一个正常数。考虑两种不同的对称随机游走提议方案来生成一个候选状态 $(X', Y')$。\n\n**方案 1：** 生成一个提议状态 $(X'_1, Y'_1)$，其步长为 $(X'_1 - X_t, Y'_1 - Y_t) = (\\epsilon, -\\epsilon)$，其中 $\\epsilon$ 是一个小的正常数。因此，提议状态为 $(X'_1, Y'_1) = (c+\\epsilon, c-\\epsilon)$。\n\n**方案 2：** 生成一个提议状态 $(X'_2, Y'_2)$，其步长为 $(X'_2 - X_t, Y'_2 - Y_t) = (\\epsilon, \\epsilon)$，使用相同的常数 $\\epsilon$。因此，提议状态为 $(X'_2, Y'_2) = (c+\\epsilon, c+\\epsilon)$。\n\n令 $\\alpha_1$ 为方案 1 下提议的 Metropolis-Hastings 接受概率，令 $\\alpha_2$ 为方案 2 下提议的接受概率。确定比率 $R = \\frac{\\alpha_2}{\\alpha_1}$。请用一个关于 $c$、$\\epsilon$ 和 $\\rho$ 的单闭式解析表达式来表示你的答案。", "solution": "对于对称随机游走的 Metropolis-Hastings 提议，接受概率为 $\\alpha=\\min\\{1, \\pi(x',y')/\\pi(x,y)\\}$。由于两种方案中的提议都是对称的，Hastings 比率会消去，因此\n$$\n\\frac{\\pi(x',y')}{\\pi(c,c)}=\\exp\\left(E(x',y')-E(c,c)\\right),\n$$\n其中对数密度为\n$$\nE(x,y)=-\\frac{x^{2}-2\\rho xy+y^{2}}{2(1-\\rho^{2})},\n$$\n我们定义\n$$\nQ(x,y)=x^{2}-2\\rho xy+y^{2},\\quad E(x,y)=-\\frac{Q(x,y)}{2(1-\\rho^{2})}.\n$$\n因此\n$$\n\\ln\\left(\\frac{\\pi(x',y')}{\\pi(c,c)}\\right)=-\\frac{Q(x',y')-Q(c,c)}{2(1-\\rho^{2})}.\n$$\n\n在当前状态 $(c,c)$ 下，\n$$\nQ(c,c)=c^{2}-2\\rho c^{2}+c^{2}=2c^{2}(1-\\rho).\n$$\n\n方案 1：$(x',y')=(c+\\epsilon,c-\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}-2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}-\\epsilon^{2}.\n$$\n因此\n$$\nQ_{1}=x'^{2}-2\\rho x'y'+y'^{2}=(2c^{2}+2\\epsilon^{2})-2\\rho(c^{2}-\\epsilon^{2})=2c^{2}(1-\\rho)+2\\epsilon^{2}(1+\\rho).\n$$\n所以\n$$\nQ_{1}-Q(c,c)=2\\epsilon^{2}(1+\\rho),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{1},y'_{1})}{\\pi(c,c)}\\right)=-\\frac{2\\epsilon^{2}(1+\\rho)}{2(1-\\rho^{2})}=-\\frac{\\epsilon^{2}}{1-\\rho}.\n$$\n由于当 $0<\\rho<1$ 时，该值为负，所以接受概率为\n$$\n\\alpha_{1}=\\exp\\left(-\\frac{\\epsilon^{2}}{1-\\rho}\\right).\n$$\n\n方案 2：$(x',y')=(c+\\epsilon,c+\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}+2c\\epsilon+\\epsilon^{2}.\n$$\n因此\n$$\nQ_{2}=x'^{2}-2\\rho x'y'+y'^{2}=2(1-\\rho)(c^{2}+2c\\epsilon+\\epsilon^{2}),\n$$\n所以\n$$\nQ_{2}-Q(c,c)=2(1-\\rho)(2c\\epsilon+\\epsilon^{2}),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{2},y'_{2})}{\\pi(c,c)}\\right)=-\\frac{2(1-\\rho)(2c\\epsilon+\\epsilon^{2})}{2(1-\\rho^{2})}=-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}.\n$$\n当 $c>0$，$\\epsilon>0$，$0<\\rho<1$ 时，该值也为负，所以\n$$\n\\alpha_{2}=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}\\right).\n$$\n\n因此，比率 $R=\\alpha_{2}/\\alpha_{1}$ 是\n$$\nR=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}+\\frac{\\epsilon^{2}}{1-\\rho}\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\epsilon^{2}\\left[\\frac{1}{1-\\rho}-\\frac{1}{1+\\rho}\\right]\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}\\right).\n$$", "answer": "$$\\boxed{\\exp\\left(\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}-\\frac{2c\\,\\epsilon}{1+\\rho}\\right)}$$"}]}