{"hands_on_practices": [{"introduction": "马科维茨模型的核心在于通过资产组合来管理风险与回报。这个练习将带你进行一次基础但至关重要的实践：直接应用投资组合方差公式。通过这个练习，你将学会如何计算两种资产的具体权重，以构建一个恰好满足特定风险水平（即方差 $\n\\sigma_p^2$）的投资组合，这是风险管理中的一项基本技能。[@problem_id:2438015]", "id": "2438015", "problem": "在计算金融学中，考虑一个由两种风险资产组成的投资组合，其收益率分别为 $r_{1}$ 和 $r_{2}$。设收益率的标准差分别为 $\\sigma_{1} = 0.4$ 和 $\\sigma_{2} = 0.2$，相关系数为 $\\rho = 0.95$。投资组合中资产1的权重为 $w$，资产2的权重为 $1 - w$，且不允许卖空，因此 $w \\in [0,1]$。假设二阶矩存在，并使用定义 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。确定 $w \\in [0,1]$ 的值，使得投资组合的方差等于目标水平 $0.085$。将您的答案四舍五入到 $6$ 位有效数字。", "solution": "此问题需经过验证。\n\n**步骤1：提取已知条件**\n-   资产数量：$2$。\n-   收益率：$r_{1}$、$r_{2}$。\n-   资产1的标准差：$\\sigma_{1} = 0.4$。\n-   资产2的标准差：$\\sigma_{2} = 0.2$。\n-   收益率的相关系数：$\\rho = 0.95$。\n-   资产1的权重：$w$。\n-   资产2的权重：$1 - w$。\n-   权重约束：$w \\in [0,1]$。\n-   协方差定义：$\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。\n-   目标投资组合方差：$\\sigma_{p}^2 = 0.085$。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于现代金融学的基本概念——Markowitz 投资组合理论。投资组合方差的公式是标准公式。所有提供的常数在数值上都是合理的。该问题具有科学依据。\n-   **适定性**：该问题要求找到一个特定的值 $w$ 以产生目标方差。这需要解一个关于 $w$ 的方程。该设定导出一个二次方程，这是一个数学上的适定问题。\n-   **客观性**：该问题使用金融学和数学中精确、客观和标准的术语进行陈述。\n-   **完整性**：提供了构建和解决问题所需的所有必要数据（$\\sigma_1, \\sigma_2, \\rho$, 目标方差）和约束条件（$w \\in [0,1]$）。\n-   **一致性**：数据和条件是内部一致的。不存在矛盾。\n\n**步骤3：结论与行动**\n该问题有效。将提供解答。\n\n一个由两种资产组成，权重分别为 $w_{1}$ 和 $w_{2}$ 的投资组合的方差由以下公式给出：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\operatorname{Cov}(r_{1}, r_{2})\n$$\n协方差定义为 $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$。将此代入方差公式可得：\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\rho \\sigma_{1} \\sigma_{2}\n$$\n在本问题中，权重为 $w_{1} = w$ 和 $w_{2} = 1 - w$。我们已知以下数值：$\\sigma_{1} = 0.4$, $\\sigma_{2} = 0.2$, 和 $\\rho = 0.95$。\n我们将这些数值代入方差方程：\n$$\n\\sigma_{p}^2(w) = w^2 \\sigma_{1}^2 + (1-w)^2 \\sigma_{2}^2 + 2w(1-w)\\rho\\sigma_{1}\\sigma_{2}\n$$\n首先，我们计算所需的项：\n-   资产1的方差：$\\sigma_{1}^2 = (0.4)^2 = 0.16$。\n-   资产2的方差：$\\sigma_{2}^2 = (0.2)^2 = 0.04$。\n-   协方差项：$\\rho \\sigma_{1} \\sigma_{2} = (0.95)(0.4)(0.2) = 0.076$。\n\n现在，我们将这些数值代入 $\\sigma_{p}^2(w)$ 的表达式中：\n$$\n\\sigma_{p}^2(w) = w^2(0.16) + (1-w)^2(0.04) + 2w(1-w)(0.076)\n$$\n为了求出 $w$ 的值，我们展开并简化这个表达式：\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + (1 - 2w + w^2)(0.04) + (2w - 2w^2)(0.076)\n$$\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + 0.04 - 0.08w + 0.04w^2 + 0.152w - 0.152w^2\n$$\n按 $w$ 的幂次对各项进行分组：\n$$\n\\sigma_{p}^2(w) = (0.16 + 0.04 - 0.152)w^2 + (-0.08 + 0.152)w + 0.04\n$$\n$$\n\\sigma_{p}^2(w) = 0.048w^2 + 0.072w + 0.04\n$$\n问题要求投资组合的方差等于目标水平 $0.085$。我们将 $\\sigma_{p}^2(w)$ 的表达式设为该值：\n$$\n0.048w^2 + 0.072w + 0.04 = 0.085\n$$\n这构成了一个二次方程。为了解出 $w$，我们将方程重新排列成标准形式 $Aw^2 + Bw + C = 0$：\n$$\n0.048w^2 + 0.072w + (0.04 - 0.085) = 0\n$$\n$$\n0.048w^2 + 0.072w - 0.045 = 0\n$$\n为了简化系数，我们可以将整个方程乘以 $1000$：\n$$\n48w^2 + 72w - 45 = 0\n$$\n这个方程可以通过将所有项除以它们的最大公约数 $3$ 来进一步简化：\n$$\n16w^2 + 24w - 15 = 0\n$$\n这个问题已经简化为求解一个二次方程的根。虽然像二分法这样的数值算法可以近似求解根，但解析解是精确的，因此更优。我们应用二次公式 $w = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$，其中 $A=16$, $B=24$, 且 $C=-15$。\n\n首先，计算判别式 $\\Delta = B^2 - 4AC$：\n$$\n\\Delta = (24)^2 - 4(16)(-15) = 576 + 960 = 1536\n$$\n现在，求解 $w$ 的根：\n$$\nw = \\frac{-24 \\pm \\sqrt{1536}}{2(16)} = \\frac{-24 \\pm \\sqrt{256 \\times 6}}{32} = \\frac{-24 \\pm 16\\sqrt{6}}{32}\n$$\n简化 $w$ 的表达式：\n$$\nw = \\frac{-3 \\pm 2\\sqrt{6}}{4}\n$$\n这给出了 $w$ 的两个可能解：\n$$\nw_{1} = \\frac{-3 + 2\\sqrt{6}}{4} \\quad \\text{和} \\quad w_{2} = \\frac{-3 - 2\\sqrt{6}}{4}\n$$\n问题规定不允许卖空，这施加了约束条件 $w \\in [0,1]$。我们必须检查哪个解落在这个区间内。\n使用近似值 $\\sqrt{6} \\approx 2.449$：\n$$\nw_{1} \\approx \\frac{-3 + 2(2.449)}{4} = \\frac{-3 + 4.898}{4} = \\frac{1.898}{4} \\approx 0.4745\n$$\n这个解 $w_1$ 在区间 $[0,1]$ 内。\n$$\nw_{2} \\approx \\frac{-3 - 2(2.449)}{4} = \\frac{-3 - 4.898}{4} = \\frac{-7.898}{4} \\approx -1.9745\n$$\n这个解 $w_2$ 是负数，因此在允许的区间 $[0,1]$ 之外。它对应于资产1的空头头寸，这是被禁止的。\n\n因此，唯一有效的权重是 $w = \\frac{-3 + 2\\sqrt{6}}{4}$。\n问题要求一个四舍五入到 $6$ 位有效数字的数值答案。\n$$\nw = \\frac{-3 + 2\\sqrt{6}}{4} \\approx 0.474744871...\n$$\n将此值四舍五入到 $6$ 位有效数字得到 $0.474745$。", "answer": "$$\n\\boxed{0.474745}\n$$"}, {"introduction": "理论模型到现实应用的过渡常常伴随着各种约束。虽然无约束的马科维茨模型在理论上很优美，但现实中的投资往往禁止卖空（即权重 $w_i \\geq 0$）。这个实践练习要求你通过编程来量化这一“无卖空”约束带来的影响，即通过比较有约束和无约束下最优投资组合的夏普比率差异，来计算该约束的“成本”。[@problem_id:2442592]", "id": "2442592", "problem": "给定一系列独立的 Markowitz 均值-方差投资组合选择环境的实例。在每个实例中，有有限数量的风险资产，其期望收益向量为 $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$（每期的小数值），协方差矩阵为对称正定的 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$（每期的方差）。存在一个无风险资产，其收益率为 $r_f$（每期的小数值）。投资组合由风险资产上的权重向量 $\\boldsymbol{w} \\in \\mathbb{R}^n$ 表示，该向量满足预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$，其中 $\\boldsymbol{1}$ 是全为1的向量。$\\boldsymbol{w}$ 的期望收益为 $\\mathbb{E}[R_p] = \\boldsymbol{\\mu}^\\top \\boldsymbol{w}$，其方差为 $\\mathrm{Var}(R_p) = \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$。相对于无风险利率 $r_f$，$\\boldsymbol{w}$ 的夏普比率定义为\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\n切点投资组合是满足 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 且能最大化 $S(\\boldsymbol{w})$ 的任意 $\\boldsymbol{w}$。考虑切点投资组合问题的两个版本：\n- 无约束：$\\boldsymbol{w}$ 可以有负分量（允许卖空）。\n- 无卖空约束：$\\boldsymbol{w} \\succeq \\boldsymbol{0}$（逐分量非负，禁止卖空）。\n\n将无卖空约束的成本定义为无约束和有约束的切点投资组合的夏普比率之间的非负差值：\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star,\n$$\n以小数形式表示（不带百分号）。\n\n基于上述基本定义，实现一个程序，对于下方的每个测试实例，计算无约束切点投资组合的夏普比率、无卖空约束的切点投资组合的夏普比率，并返回成本，该成本为一个浮点数，四舍五入到小数点后六位。程序不得假定除所述金融解释之外的任何资产单位，且所有输出必须是不带百分号的小数。\n\n测试套件（每个案例为 $(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f)$）：\n\n- 案例 1：\n  - $\\boldsymbol{\\mu} = [\\,0.12,\\,0.10,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.040 & 0.006 & 0.004\\\\\n  0.006 & 0.0225 & 0.0025\\\\\n  0.004 & 0.0025 & 0.010\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- 案例 2：\n  - $\\boldsymbol{\\mu} = [\\,0.14,\\,0.08,\\,0.06\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.050 & 0.010 & 0.008\\\\\n  0.010 & 0.040 & 0.012\\\\\n  0.008 & 0.012 & 0.030\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- 案例 3：\n  - $\\boldsymbol{\\mu} = [\\,0.11,\\,0.13,\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.030 & 0.012 & 0.006 & -0.003\\\\\n  0.012 & 0.050 & 0.009 & 0.000\\\\\n  0.006 & 0.009 & 0.020 & 0.004\\\\\n  -0.003 & 0.000 & 0.004 & 0.015\n  \\end{bmatrix}$\n  - $r_f = 0.02$\n\n- 案例 4：\n  - $\\boldsymbol{\\mu} = [\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.015 & 0.006\\\\\n  0.006 & 0.025\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n您的程序应生成单行输出，其中包含所有案例的结果，格式为方括号内用逗号分隔的列表，例如 $[\\,x_1, x_2, x_3, x_4\\,]$，其中每个 $x_i$ 是计算出的成本，四舍五入到小数点后六位。必须只打印这一行。", "solution": "所述问题是有效的。它在科学上基于已建立的 Markowitz 均值-方差优化框架，在数学上是适定的 (well-posed)，并且所有必要的数据和约束都已提供。我们可以开始进行正式求解。\n\n该问题要求计算对 Markowitz 切点投资组合施加无卖空约束所带来的成本。此成本定义为无约束和有约束优化问题中可实现的最大夏普比率之差。我们将依次分析每个优化问题来构建解决方案。\n\n设 $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ 为期望收益向量，$r_f$ 为无风险利率，$\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ 为 n 种风险资产的对称正定协方差矩阵。超出无风险利率的超额收益向量表示为 $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$，其中 $\\boldsymbol{1}$ 是全为1的向量。权重为 $\\boldsymbol{w} \\in \\mathbb{R}^n$ 的投资组合的夏普比率由下式给出：\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}} = \\frac{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\n问题在于找到在不同约束条件下能最大化 $S(\\boldsymbol{w})$ 的投资组合权重 $\\boldsymbol{w}$。\n\n首先，我们处理无约束切点投资组合问题。优化问题是在预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 下最大化 $S(\\boldsymbol{w})$。夏普比率的一个关键特性是其对于权重 $\\boldsymbol{w}$ 的正向缩放具有不变性。这使得问题可以被重构为一个更易于求解的形式。最大化 $S(\\boldsymbol{w})$ 等价于在固定的投资组合超额收益水平（例如 $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$）下，最小化投资组合方差 $\\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$。预算约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 并非寻找最大夏普比率本身所必需，而是用于确定切点投资组合的具体权重，这些权重可以通过缩放简化问题的解来得到。该简化问题的拉格朗日函数为 $\\mathcal{L}(\\boldsymbol{w}, \\lambda) = \\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} - \\lambda(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} - 1)$。一阶条件 $\\nabla_{\\boldsymbol{w}}\\mathcal{L} = \\boldsymbol{\\Sigma}\\boldsymbol{w} - \\lambda\\boldsymbol{\\mu}_e = \\boldsymbol{0}$ 意味着 $\\boldsymbol{w} = \\lambda \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e$。将其代入约束 $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$ 中，得到 $\\lambda = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e)^{-1}$。解决此子问题的投资组合方差为 $\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}} = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}$。夏普比率 $S = (\\boldsymbol{\\mu}_e^\\top \\tilde{\\boldsymbol{w}}) / \\sqrt{\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}}} = 1 / \\sqrt{(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}}$。因此，无约束情况下的最大夏普比率由以下解析公式给出：\n$$\nS_{\\text{unconstrained}}^\\star = \\sqrt{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e} = \\sqrt{(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})}.\n$$\n\n接下来，我们处理无卖空约束的切点投资组合。该优化问题增加了约束 $\\boldsymbol{w} \\succeq \\boldsymbol{0}$（逐分量非负）。问题是在约束 $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ 和 $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ 下最大化 $S(\\boldsymbol{w})$。利用同样的尺度不变性原理，该问题可以转化为一个二次规划（QP）问题。我们在固定超额收益水平上最小化方差，同时遵守非负约束。该二次规划问题表述如下：\n$$\n\\begin{aligned}\n& \\underset{\\boldsymbol{w} \\in \\mathbb{R}^n}{\\text{最小化}}\n& & \\frac{1}{2} \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} \\\\\n& \\text{约束条件}\n& & \\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1 \\\\\n& & & \\boldsymbol{w} \\succeq \\boldsymbol{0}.\n\\end{aligned}\n$$\n这是一个凸优化问题，因为目标函数是凸的（由于 $\\boldsymbol{\\Sigma}$ 是正定的），且约束是线性的。它没有通用的解析解，必须通过数值方法求解。设 $\\boldsymbol{w}_c^\\star$ 是解此二次规划问题的最优权重向量。在这些约束下实现的最小方差为 $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$。相应的最大夏普比率从目标值导出：$S = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}_c^\\star) / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star} = 1 / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}$。因此，有约束情况下的最大夏普比率为：\n$$\nS_{\\text{constrained}}^\\star = \\frac{1}{\\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}}.\n$$\n\n最后，无卖空约束的成本计算为两个最大夏普比率之间的非负差值：\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star.\n$$\n每个测试案例的计算算法如下：\n1. 构建超额收益向量 $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$。\n2. 计算协方差矩阵的逆矩阵 $\\boldsymbol{\\Sigma}^{-1}$。\n3. 使用上述推导的解析公式计算 $S_{\\text{unconstrained}}^\\star$。\n4. 数值求解二次规划问题，找到有约束问题的最优权重 $\\boldsymbol{w}_c^\\star$。\n5. 从解 $\\boldsymbol{w}_c^\\star$ 中，计算相应的投资组合方差 $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$，并随后求得 $S_{\\text{constrained}}^\\star$。\n6. 计算成本并将结果四舍五入到指定的小数点后六位精度。\n此过程将为每个提供的测试案例实施。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Computes the cost of the no-short-selling constraint for a series of\n    Markowitz portfolio optimization problems.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: mu, Sigma, rf\n        (np.array([0.12, 0.10, 0.07]),\n         np.array([[0.040, 0.006, 0.004],\n                   [0.006, 0.0225, 0.0025],\n                   [0.004, 0.0025, 0.010]]),\n         0.03),\n        # Case 2: mu, Sigma, rf\n        (np.array([0.14, 0.08, 0.06]),\n         np.array([[0.050, 0.010, 0.008],\n                   [0.010, 0.040, 0.012],\n                   [0.008, 0.012, 0.030]]),\n         0.03),\n        # Case 3: mu, Sigma, rf\n        (np.array([0.11, 0.13, 0.09, 0.07]),\n         np.array([[0.030, 0.012, 0.006, -0.003],\n                   [0.012, 0.050, 0.009, 0.000],\n                   [0.006, 0.009, 0.020, 0.004],\n                   [-0.003, 0.000, 0.004, 0.015]]),\n         0.02),\n        # Case 4: mu, Sigma, rf\n        (np.array([0.09, 0.07]),\n         np.array([[0.015, 0.006],\n                   [0.006, 0.025]]),\n         0.03)\n    ]\n\n    results = []\n    for mu, Sigma, rf in test_cases:\n        n = len(mu)\n        mu_e = mu - rf\n\n        # 1. Unconstrained Tangency Portfolio Sharpe Ratio\n        Sigma_inv = np.linalg.inv(Sigma)\n        # S_unconstrained^2 = mu_e.T * Sigma_inv * mu_e\n        s_unconstrained_sq = mu_e.T @ Sigma_inv @ mu_e\n        s_unconstrained = np.sqrt(s_unconstrained_sq)\n\n        # 2. Constrained (No-Short-Selling) Tangency Portfolio Sharpe Ratio\n        # We solve the QP: min 0.5 * w.T * Sigma * w, s.t. mu_e.T * w = 1 and w >= 0\n        \n        # Objective function to minimize\n        def objective_func(w, S):\n            return 0.5 * w.T @ S @ w\n\n        # Equality constraint: mu_e.T * w - 1 = 0\n        cons = ({'type': 'eq',\n                 'fun': lambda w, me: me.T @ w - 1,\n                 'args': (mu_e,)})\n        \n        # Bounds for weights: w_i >= 0 for all i\n        bnds = tuple((0, None) for _ in range(n))\n        \n        # Initial guess: a feasible point satisfying constraints.\n        # An equal weight portfolio is scaled to meet the equality constraint.\n        w0_init = np.ones(n) / n\n        w0 = w0_init / (mu_e.T @ w0_init)\n\n        # Solve the Quadratic Program using SLSQP\n        qp_result = minimize(objective_func, w0, args=(Sigma,), method='SLSQP',\n                             bounds=bnds, constraints=cons)\n        \n        # w_c_star is the solution to the QP\n        w_c_star = qp_result.x\n        \n        # The minimized variance is w_c_star.T * Sigma * w_c_star = 2 * qp_result.fun\n        # S_constrained = 1 / sqrt(variance)\n        variance_constrained = w_c_star.T @ Sigma @ w_c_star\n        s_constrained = 1 / np.sqrt(variance_constrained)\n        \n        # 3. Cost of the no-short-selling constraint\n        cost = s_unconstrained - s_constrained\n        results.append(cost)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"}, {"introduction": "马科维茨优化模型的一个关键挑战是其对输入参数（如预期收益 $\\boldsymbol{\\mu}$ 和协方差 $\\boldsymbol{\\Sigma}$）的敏感性，而这些参数的估计本身就存在不确定性。本练习模拟了一个非常现实的情景：比较一个在危机前数据上“最优”的投资组合和一个简单的 “$1/N$” 等权重投资组合在金融危机期间的实际表现。这个实践突显了样本内优化与样本外稳健性之间的重要区别，这是量化金融领域的核心议题。[@problem_id:2442584]", "id": "2442584", "problem": "给定一个包含 $N$ 种风险资产的设定。对于每种资产 $i \\in \\{1,\\dots,N\\}$，设危机前的预期收益率为向量 $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$ 的第 $i$ 个分量，危机前的收益率协方差矩阵为 $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$，该矩阵为对称正定矩阵。在金融危机期间，预期收益率和协方差分别变为 $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$。每个时期的无风险利率为 $r_f \\in \\mathbb{R}$。所有收益率必须以小数形式处理和报告（例如，$0.01$ 表示百分之一）。\n\n定义两种完全投资的投资组合：\n- 等权重投资组合，其中所有 $i$ 的权重为 $w^{\\text{eq}}_i = \\frac{1}{N}$。\n- Markowitz最优投资组合（完全投资下的切线投资组合），该组合由危机前参数计算得出，是最大化危机前夏普比率 $(\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f)/\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}$ 问题的解 $\\boldsymbol{w}^{\\star} \\in \\mathbb{R}^N$，约束条件为 $\\sum_{i=1}^{N} w_i = 1$。\n\n对于每个给定的测试用例，使用 $\\boldsymbol{\\mu}_{\\text{crisis}}$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}}$ 计算两种投资组合的样本外（危机时期）夏普比率：\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f)\n= \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}}}.\n$$\n然后，为每个测试用例输出差值\n$$\n\\Delta = \\text{SR}(\\boldsymbol{w}^{\\text{eq}}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f) - \\text{SR}(\\boldsymbol{w}^{\\star}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f),\n$$\n四舍五入保留 $6$ 位小数。\n\n使用以下测试套件，其中包含 3 个用例，分别用于评估典型表现、相等条件和压力配置。在所有用例中，使用 $r_f = 0.0$ 和 $N = 3$。\n\n- 测试用例 1（典型配置）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.012, 0.008]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0005, 0.0003])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.025, -0.022, -0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0015, 0.0009])$\n- 测试用例 2（所有资产相同的对称边界）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.010, 0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0004, 0.0004])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.020, -0.020, -0.020]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0012, 0.0012])$\n- 测试用例 3（危机前集中和不利的危机逆转的压力配置）：\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.020, 0.008, 0.006]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0003, 0.0006, 0.0005])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.040, -0.010, -0.012]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0024, 0.0020])$\n\n您的程序应生成单行输出，其中包含 3 个测试用例的结果，格式为方括号括起来的逗号分隔列表，例如 $[\\Delta_1,\\Delta_2,\\Delta_3]$，其中每个 $\\Delta_k$ 是一个四舍五入到 6 位小数的浮点数。", "solution": "问题陈述已经过严谨分析。它本身是自洽的，科学上基于成熟的金融理论，并且在数学上是适定的。所有参数均已提供，且没有内部矛盾。因此，该问题被认定为有效，并将提供解决方案。\n\n任务是比较两种不同投资组合配置策略的样本外（危机时期）表现：一种是简单的等权重投资组合，另一种是 Markowitz 最优化的切线投资组合。表现度量指标是夏普比率。问题的核心在于首先确定每种投资组合的资产权重，然后使用这些权重计算它们在危机条件下的各自的夏普比率。\n\n我们来定义一个包含 $N$ 种风险资产的市场的参数：\n- $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$：预期收益率向量，危机前。\n- $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$：收益率协方差矩阵，危机前。\n- $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$：预期收益率向量，危机期间。\n- $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$：收益率协方差矩阵，危机期间。\n- $r_f \\in \\mathbb{R}$：无风险收益率。\n\n权重向量为 $\\boldsymbol{w} \\in \\mathbb{R}^N$ 的投资组合的夏普比率由下式给出\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f) = \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}}\n$$\n其中 $\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}$ 是投资组合的预期收益率，$\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}$ 是其标准差（波动率）。\n\n分析过程分为四个步骤。\n\n步骤 1：等权重投资组合（$\\boldsymbol{w}^{\\text{eq}}$）\n该投资组合通过将资本平均分配给所有 $N$ 种资产来构建。因此，每种资产 $i$ 的权重为 $w^{\\text{eq}}_i = \\frac{1}{N}$。权重向量为\n$$\n\\boldsymbol{w}^{\\text{eq}} = \\frac{1}{N}\\boldsymbol{1}\n$$\n其中 $\\boldsymbol{1}$ 是 $N$ 维全一向量。对于给定的问题，$N=3$，所以 $\\boldsymbol{w}^{\\text{eq}} = [1/3, 1/3, 1/3]^{\\top}$。\n\n步骤 2：Markowitz 最优切线投资组合（$\\boldsymbol{w}^{\\star}$）\n该投资组合 $\\boldsymbol{w}^{\\star}$ 是最大化危机前夏普比率问题的解，约束条件是投资组合完全投资（$\\sum_{i=1}^{N} w_i = 1$）。优化问题如下：\n$$\n\\max_{\\boldsymbol{w}} \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}} \\quad \\text{subject to} \\quad \\boldsymbol{w}^{\\top}\\boldsymbol{1} = 1\n$$\n令 $\\boldsymbol{\\mu}_{\\text{excess}} = \\boldsymbol{\\mu}_{\\text{pre}} - r_f \\boldsymbol{1}$ 为危机前相对于无风险利率的超额收益率向量。该问题的解在投资组合理论中是公认的。未缩放的最优权重与 $\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}$ 成正比。为满足完全投资约束，我们对这些权重进行归一化：\n$$\n\\boldsymbol{w}^{\\star} = \\frac{\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}}{\\boldsymbol{1}^{\\top}(\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}})}\n$$\n这个向量 $\\boldsymbol{w}^{\\star}$ 是使用危机前参数计算的。它代表了基于危机前可用信息的最优配置策略。\n\n步骤 3：计算样本外夏普比率\n我们需要评估两种投资组合在危机期间的表现。这意味着我们使用权重向量 $\\boldsymbol{w}^{\\text{eq}}$ 和 $\\boldsymbol{w}^{\\star}$（它们是固定的），并使用危机时期的参数 $\\boldsymbol{\\mu}_{\\text{crisis}}$ 和 $\\boldsymbol{\\Sigma}_{\\text{crisis}}$ 来计算它们的夏普比率。\n等权重投资组合的夏普比率为：\n$$\n\\text{SR}_{\\text{eq}} = \\frac{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\text{eq}}}}\n$$\nMarkowitz 投资组合的夏普比率为：\n$$\n\\text{SR}_{\\star} = \\frac{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\star}}}\n$$\n\n步骤 4：最终差值计算\n每个测试用例的最终输出是这两个样本外夏普比率之间的差值：\n$$\n\\Delta = \\text{SR}_{\\text{eq}} - \\text{SR}_{\\star}\n$$\n这个量衡量了当在样本外的危机数据上进行评估时，朴素的等权重策略相比于 Markowitz 最优策略的表现好多少（如果为正）或差多少（如果为负）。一个正的 $\\Delta$ 表明，简单的多样化投资比最优化的投资组合更具稳健性，而后者很可能对未能持续的危机前状况产生了过拟合。\n\n在实现方面，我们注意到所有提供的协方差矩阵都是对角矩阵。一个对角矩阵 $\\boldsymbol{\\Sigma} = \\mathrm{diag}([\\sigma_1^2, \\dots, \\sigma_N^2])$ 的逆矩阵也是对角矩阵：$\\boldsymbol{\\Sigma}^{-1} = \\mathrm{diag}([1/\\sigma_1^2, \\dots, 1/\\sigma_N^2])$。这简化了 $\\boldsymbol{w}^{\\star}$ 的计算。对于所有测试用例，$N=3$ 且 $r_f=0.0$，这进一步将 $\\boldsymbol{\\mu}_{\\text{excess}}$ 简化为 $\\boldsymbol{\\mu}_{\\text{pre}}$。将使用这些公式对每个测试用例进行计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the portfolio performance comparison problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.012, 0.008]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0005, 0.0003]),\n            \"mu_crisis\": np.array([-0.025, -0.022, -0.010]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0015, 0.0009])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.010, 0.010]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0004, 0.0004]),\n            \"mu_crisis\": np.array([-0.020, -0.020, -0.020]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0012, 0.0012])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.020, 0.008, 0.006]),\n            \"Sigma_pre\": np.diag([0.0003, 0.0006, 0.0005]),\n            \"mu_crisis\": np.array([-0.040, -0.010, -0.012]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0024, 0.0020])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        r_f = case[\"r_f\"]\n        mu_pre = case[\"mu_pre\"]\n        Sigma_pre = case[\"Sigma_pre\"]\n        mu_crisis = case[\"mu_crisis\"]\n        Sigma_crisis = case[\"Sigma_crisis\"]\n\n        # 1. Define the equal-weight portfolio\n        w_eq = np.ones(N) / N\n\n        # 2. Compute the Markowitz-optimized portfolio (tangency portfolio)\n        # using pre-crisis parameters.\n        mu_excess_pre = mu_pre - r_f * np.ones(N)\n        Sigma_pre_inv = np.linalg.inv(Sigma_pre)\n        \n        # Unscaled weights for tangency portfolio\n        w_tilde = Sigma_pre_inv @ mu_excess_pre\n        \n        # Normalize weights to sum to 1\n        w_star = w_tilde / np.sum(w_tilde)\n\n        def calculate_sharpe_ratio(w, mu, Sigma, rf):\n            \"\"\"\n            Calculates the Sharpe ratio for a given portfolio and market parameters.\n            \"\"\"\n            portfolio_return = w.T @ mu\n            portfolio_variance = w.T @ Sigma @ w\n            if portfolio_variance <= 0:\n                # Handle cases with zero or negative variance for numerical stability.\n                # A portfolio with zero volatility and positive excess return has infinite Sharpe ratio.\n                # Here, we expect positive variance.\n                return np.inf if portfolio_return - rf > 0 else -np.inf if portfolio_return - rf < 0 else 0.0\n            \n            portfolio_std_dev = np.sqrt(portfolio_variance)\n            return (portfolio_return - rf) / portfolio_std_dev\n\n        # 3. Calculate out-of-sample Sharpe ratios using crisis parameters\n        sr_eq = calculate_sharpe_ratio(w_eq, mu_crisis, Sigma_crisis, r_f)\n        sr_star = calculate_sharpe_ratio(w_star, mu_crisis, Sigma_crisis, r_f)\n        \n        # 4. Compute the difference and round to 6 decimals\n        delta = sr_eq - sr_star\n        results.append(round(delta, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"}]}