{"hands_on_practices": [{"introduction": "信赖域方法的每一次迭代都围绕着求解一个核心子问题：在一个球形“信赖域”内最小化目标函数的二次模型。这个基础练习将带你亲手解决一个简单的一维信赖域子问题。通过这个过程，你将掌握判断无约束最优点是否在信赖域内，并据此决定最终步长是取无约束最优点还是边界点的关键逻辑 [@problem_id:2224504]。", "id": "2224504", "problem": "在无约束优化的背景下，信赖域方法在当前点附近使用一个更简单的模型函数 $m(p)$ 来迭代地近似一个复杂函数。下一步的步长 $p$ 是通过求解信赖域子问题来确定的，该子问题涉及在一个半径为 $\\Delta > 0$ 的“信赖域”内最小化此模型，在该区域内模型被认为是原始函数的可靠近似。该子问题形式化地表述为：\n$$\n\\min_{p} m(p) \\quad \\text{subject to} \\quad \\|p\\| \\le \\Delta\n$$\n考虑一个一维优化场景，其中对于步长 $p \\in \\mathbb{R}$ 的模型函数是一个二次函数，由下式给出：\n$$\nm(p) = g p + \\frac{1}{2} H p^2 + c\n$$\n其中梯度项 $g = 2$，Hessian 项 $H = 6$，以及一个任意常数 $c$。步长受信赖域半径 $\\Delta = 0.1$ 的约束。\n\n求解此一维信赖域子问题，确定最优步长 $p$。请以精确小数形式给出答案。", "solution": "我们必须在信赖域约束 $|p| \\le \\Delta$ 下最小化二次模型 $m(p) = g p + \\frac{1}{2} H p^{2} + c$，其中给定值为 $g=2$，$H=6$ 和 $\\Delta=0.1$。常数 $c$ 不影响最小化点，因此可以忽略。\n\n考虑该信赖域子问题的拉格朗日函数：\n$$\n\\mathcal{L}(p,\\lambda) = g p + \\frac{1}{2} H p^{2} + \\lambda \\left(p^{2} - \\Delta^{2}\\right),\n$$\n其中 $\\lambda \\ge 0$。Karush-Kuhn-Tucker (KKT) 条件为：\n1. 平稳性：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial p} = g + H p + 2 \\lambda p = 0.\n$$\n2. 原始可行性：$|p| \\le \\Delta$。\n3. 对偶可行性：$\\lambda \\ge 0$。\n4. 互补松弛性：$\\lambda \\left(p^{2} - \\Delta^{2}\\right) = 0$。\n\n情况1（内部解）：如果 $|p| < \\Delta$，那么 $\\lambda = 0$，平稳性条件给出\n$$\ng + H p = 0 \\quad \\Rightarrow \\quad p_{u} = -\\frac{g}{H}.\n$$\n对于 $g=2$ 和 $H=6$，这给出 $p_{u} = -\\frac{2}{6} = -\\frac{1}{3}$。检查可行性：$|p_{u}| = \\frac{1}{3} > 0.1 = \\Delta$，因此内部解是不可行的。\n\n情况2（边界解）：此时 $p^{2} = \\Delta^{2}$，所以 $p = \\pm \\Delta$。平稳性条件变为\n$$\ng + H p + 2 \\lambda p = 0 \\quad \\Rightarrow \\quad (H + 2 \\lambda) p = -g.\n$$\n由于 $H + 2 \\lambda \\ge 0$，$p$ 的符号必须与 $-g$ 的符号一致。当 $g = 2 > 0$ 时，我们必须取 $p = -\\Delta = -0.1$。为了验证对偶可行性，我们求解 $\\lambda$：\n$$\n(H + 2 \\lambda)(-\\Delta) = -g \\quad \\Rightarrow \\quad (H + 2 \\lambda)\\Delta = g \\quad \\Rightarrow \\quad 2 \\lambda = \\frac{g}{\\Delta} - H.\n$$\n代入 $g=2$，$\\Delta=0.1$ 和 $H=6$ 给出\n$$\n2 \\lambda = \\frac{2}{0.1} - 6 = 20 - 6 = 14 \\quad \\Rightarrow \\quad \\lambda = 7 \\ge 0,\n$$\n这满足了对偶可行性和互补松弛性条件。\n\n因此，最优信赖域步长是在负梯度方向上的边界步长：\n$$\np^{\\star} = -\\Delta = -0.1.\n$$", "answer": "$$\\boxed{-0.1}$$"}, {"introduction": "与梯度下降等一阶方法相比，信赖域方法的一个显著优势是它能有效处理非凸问题，特别是能够逃离鞍点。本练习设置了一个具有不定Hessian矩阵的二次函数，其原点是一个典型的鞍点。你将通过计算发现，信赖域方法如何利用负曲率信息，找到一个有效的下降方向，从而成功逃离梯度几乎为零的鞍点区域 [@problem_id:2444737]。", "id": "2444737", "problem": "考虑一个关于两个变量的二次目标函数的无约束最小化问题：\n$$f(x) = -x_{1}^{2} + x_{2}^{2}, \\quad x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}.$$\n在当前迭代点\n$$x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},$$\n一个使用欧几里得范数和信赖域半径 $\\Delta > 0$ 的信赖域方法构建了二次模型\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s,$$\n并通过求解以下问题来计算精确的信赖域步长：\n$$\\min_{s \\in \\mathbb{R}^{2}} \\; m_{k}(s) \\quad \\text{subject to} \\quad \\|s\\|_{2} \\le \\Delta.$$\n在所有全局最小化子中，约定所选步长的第一个分量为非负。\n\n确定精确的信赖域步长 $s_{k}$ 作为 $\\Delta$ 的函数。请以 $1 \\times 2$ 行向量的形式给出答案。不需要进行数值舍入。", "solution": "我们从二次目标函数的梯度和Hessian矩阵的定义开始。目标函数为\n$$f(x) = -x_{1}^{2} + x_{2}^{2},$$\n因此，对于任意 $x \\in \\mathbb{R}^{2}$，其梯度和Hessian矩阵为\n$$\\nabla f(x) = \\begin{pmatrix} -2 x_{1} \\\\ 2 x_{2} \\end{pmatrix}, \\qquad \\nabla^{2} f(x) = \\begin{pmatrix} -2 & 0 \\\\ 0 & 2 \\end{pmatrix}.$$\n在信赖域中心 $x_{k} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 处，梯度为\n$$\\nabla f(x_{k}) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.$$\n因此，在 $x_{k}$ 处的二次模型为\n$$m_{k}(s) = f(x_{k}) + \\nabla f(x_{k})^{\\top} s + \\tfrac{1}{2}\\, s^{\\top} \\nabla^{2} f(x_{k})\\, s = f(0) + \\tfrac{1}{2}\\, s^{\\top} H s,$$\n其中我们记 $H \\coloneqq \\nabla^{2} f(x_{k}) = \\begin{pmatrix} -2 & 0 \\\\ 0 & 2 \\end{pmatrix}$。常数项 $f(0)$ 与 $m_{k}$ 的最小化子无关，因此信赖域子问题简化为\n$$\\min_{\\|s\\|_{2} \\le \\Delta} \\; \\tfrac{1}{2}\\, s^{\\top} H s.$$\n因为 $H$ 是对称不定的，我们分析其特征结构。$H$ 的特征对为\n$$(\\lambda_{1}, v_{1}) = (-2, \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}), \\qquad (\\lambda_{2}, v_{2}) = (2, \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}).$$\n对于任意非零向量 $s$，记 $s = r u$，其中 $r = \\|s\\|_{2}$ 且 $\\|u\\|_{2} = 1$。那么\n$$\\tfrac{1}{2}\\, s^{\\top} H s = \\tfrac{1}{2}\\, r^{2}\\, u^{\\top} H u.$$\n对于固定的 $r$，在单位向量 $u$ 上进行最小化等价于最小化瑞利商 $u^{\\top} H u$，其最小值在与 $H$ 的最小特征值相关联的任意特征向量处取得。由于最小特征值为 $\\lambda_{\\min} = -2$，对应的特征向量为 $\\pm v_{1}$，因此在球面 $\\|s\\|_{2} = r$ 上的最小化子是 $s = r (\\pm v_{1})$。\n\n在信赖域 $\\|s\\|_{2} \\le \\Delta$ 内，当 $r$ 沿着负曲率方向增加时，目标函数值减小，因此约束最小化子位于边界上，此时 $r = \\Delta$，方向 $u$ 等于对应于 $\\lambda_{\\min}$ 的特征向量。根据要求 $s$ 的第一个分量为非负的选择约定，我们选择 $u = v_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$ 而不是 $-v_{1}$。因此，精确的信赖域步长是\n$$s_{k} = \\Delta \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}.$$\n该步长与模型的负曲率方向一致，因此沿着鞍点的不稳定流形移动，这展示了信赖域方法如何沿着负曲率方向逃离鞍点。\n\n表示为 $1 \\times 2$ 的行向量，该步长是\n$$\\begin{pmatrix} \\Delta & 0 \\end{pmatrix}.$$", "answer": "$$\\boxed{\\begin{pmatrix}\\Delta & 0\\end{pmatrix}}$$"}, {"introduction": "在实际应用中，精确求解信赖域子问题可能成本高昂，因此发展了许多近似求解算法，其中狗腿法（Dogleg Method）是一种经典且高效的策略。本练习将理论与金融实践相结合，要求你将狗腿法应用于一个经典的均值-方差投资组合优化问题。通过这个练习，你将把抽象的算法步骤与计算金融中的具体情境联系起来，从而巩固对信赖域方法实际运作方式的理解 [@problem_id:2444773]。", "id": "2444773", "problem": "考虑一个用于计算金融的双资产均值-方差目标。设权重 $w \\in \\mathbb{R}^{2}$ 的无约束目标为\n$$\nf(w) \\;=\\; \\frac{\\gamma}{2}\\, w^{\\top} \\Sigma \\, w \\;-\\; \\mu^{\\top} w,\n$$\n其中风险厌恶参数为 $\\gamma = 2$，预期超额回报为 $\\mu = \\begin{pmatrix}0.5 \\\\ 0.2\\end{pmatrix}$，以及一个对称正定矩阵\n$$\n\\Sigma \\;=\\; \\begin{pmatrix}2 & 1 \\\n$$4pt] 1 & 3\\end{pmatrix}.\n$$\n在当前迭代点 $w^{0} = \\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$，考虑二阶模型\n$$\nm(s) \\;=\\; f(w^{0}) \\;+\\; \\nabla f(w^{0})^{\\top} s \\;+\\; \\frac{1}{2}\\, s^{\\top} \\nabla^{2} f(w^{0}) \\, s,\n$$\n以及一个半径为 $\\Delta = 0.11$ 的欧几里得信赖域 $\\{\\, s \\in \\mathbb{R}^{2} : \\|s\\|_{2} \\le \\Delta \\,\\}$。使用应用于 $m(s)$ 的狗腿信赖域策略，确定唯一的标量 $\\tau \\in [0,1]$，使得当柯西点严格位于信赖域内部且完全牛顿步严格位于其外部时，狗腿步恰好落在信赖域边界上。\n\n将 $\\tau$ 的最终值以四舍五入到四位有效数字的小数形式给出。", "solution": "对问题陈述进行验证。\n\n**第一步：提取已知条件**\n- 目标函数：$f(w) = \\frac{\\gamma}{2} w^{\\top} \\Sigma w - \\mu^{\\top} w$，对于 $w \\in \\mathbb{R}^{2}$。\n- 风险厌恶参数：$\\gamma = 2$。\n- 预期超额回报：$\\mu = \\begin{pmatrix} 0.5 \\\\ 0.2 \\end{pmatrix}$。\n- 协方差矩阵：$\\Sigma = \\begin{pmatrix} 2 & 1 \\\\ 1 & 3 \\end{pmatrix}$。\n- 当前迭代点：$w^{0} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n- 二次模型：$m(s) = f(w^{0}) + \\nabla f(w^{0})^{\\top} s + \\frac{1}{2} s^{\\top} \\nabla^{2} f(w^{0}) s$。\n- 信赖域：$\\{ s \\in \\mathbb{R}^{2} : \\|s\\|_{2} \\le \\Delta \\}$。\n- 信赖域半径：$\\Delta = 0.11$。\n- 方法：狗腿信赖域策略。\n- 条件：柯西点严格位于信赖域内部，完全牛顿步严格位于其外部。\n- 目标：找到唯一的标量 $\\tau \\in [0,1]$，使得狗腿步位于信赖域边界上。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，植根于数值优化的标准理论及其在计算金融（均值-方差优化）中的应用。矩阵 $\\Sigma$ 是对称的。其特征值是 $(\\lambda-2)(\\lambda-3) - 1 = 0$ 的根，即 $\\lambda^2 - 5\\lambda + 5 = 0$。根为 $\\lambda = \\frac{5 \\pm \\sqrt{5}}{2}$，两者均为正，因此 $\\Sigma$ 是正定的，符合协方差矩阵的要求。该问题是适定的，提供了确定唯一解 $\\tau$ 所需的所有数据和约束。语言客观、精确。未发现任何缺陷。\n\n**第三步：结论与行动**\n问题有效。将推导解答。\n\n**解的推导**\n狗腿法构造一条路径来近似二次模型 $m(s)$ 的最小化子。这需要目标函数 $f(w)$ 在当前迭代点 $w^0$ 的梯度和海森矩阵。\n\n目标函数为 $f(w) = \\frac{\\gamma}{2} w^{\\top} \\Sigma w - \\mu^{\\top} w$。\n梯度为 $\\nabla f(w) = \\gamma \\Sigma w - \\mu$。\n海森矩阵为 $\\nabla^2 f(w) = \\gamma \\Sigma$。\n\n在迭代点 $w^0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，模型的梯度 $g$ 和海森矩阵 $B$ 分别为：\n$$\ng = \\nabla f(w^0) = \\gamma \\Sigma w^0 - \\mu = -\\mu = -\\begin{pmatrix} 0.5 \\\\ 0.2 \\end{pmatrix} = \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix}\n$$\n$$\nB = \\nabla^2 f(w^0) = \\gamma \\Sigma = 2 \\begin{pmatrix} 2 & 1 \\\\ 1 & 3 \\end{pmatrix} = \\begin{pmatrix} 4 & 2 \\\\ 2 & 6 \\end{pmatrix}\n$$\n二次模型为 $m(s) = g^{\\top}s + \\frac{1}{2}s^{\\top}B s$，因为 $f(w^0) = 0$。\n\n狗腿路径是使用两个点构造的：柯西点 $s_C$ 和牛顿步 $s_N$。\n\n首先，我们求出无约束柯西步 $s_{UC}$，它是在最速下降方向 $-g$ 上最小化 $m(s)$ 的步长：\n$$\ns_{UC} = -\\alpha g, \\quad \\text{其中} \\quad \\alpha = \\frac{g^{\\top}g}{g^{\\top}Bg}\n$$\n我们计算必要的标量：\n$$\ng^{\\top}g = (-0.5)^2 + (-0.2)^2 = 0.25 + 0.04 = 0.29\n$$\n$$\ng^{\\top}Bg = \\begin{pmatrix} -0.5 & -0.2 \\end{pmatrix} \\begin{pmatrix} 4 & 2 \\\\ 2 & 6 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix} = \\begin{pmatrix} -0.5 & -0.2 \\end{pmatrix} \\begin{pmatrix} -2.4 \\\\ -2.2 \\end{pmatrix} = 1.2 + 0.44 = 1.64\n$$\n所以，$\\alpha = \\frac{0.29}{1.64} = \\frac{29}{164}$。\n无约束柯西步为：\n$$\ns_{UC} = -\\frac{29}{164} \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix} = \\frac{29}{164} \\begin{pmatrix} 0.5 \\\\ 0.2 \\end{pmatrix}\n$$\n$s_{UC}$ 的范数平方为 $\\|s_{UC}\\|^2_2 = \\alpha^2 (g^{\\top}g) = (\\frac{29}{164})^2 (0.29) = \\frac{243.89}{26896} \\approx 0.00906796$。\n因此，$\\|s_{UC}\\|_2 \\approx \\sqrt{0.00906796} \\approx 0.095226$。由于 $\\|s_{UC}\\|_2 < \\Delta = 0.11$，柯西点严格位于信赖域内部的条件得到满足。柯西点为 $s_C = s_{UC}$。\n\n接下来，我们计算牛顿步 $s_N$，它是 $m(s)$ 的无约束最小化子。\n$$\ns_N = -B^{-1}g\n$$\n$B$ 的逆矩阵是：\n$$\nB^{-1} = \\frac{1}{4 \\cdot 6 - 2 \\cdot 2} \\begin{pmatrix} 6 & -2 \\\\ -2 & 4 \\end{pmatrix} = \\frac{1}{20} \\begin{pmatrix} 6 & -2 \\\\ -2 & 4 \\end{pmatrix} = \\begin{pmatrix} 0.3 & -0.1 \\\\ -0.1 & 0.2 \\end{pmatrix}\n$$\n$$\ns_N = -\\begin{pmatrix} 0.3 & -0.1 \\\\ -0.1 & 0.2 \\end{pmatrix} \\begin{pmatrix} -0.5 \\\\ -0.2 \\end{pmatrix} = -\\begin{pmatrix} -0.15+0.02 \\\\ 0.05-0.04 \\end{pmatrix} = -\\begin{pmatrix} -0.13 \\\\ 0.01 \\end{pmatrix} = \\begin{pmatrix} 0.13 \\\\ -0.01 \\end{pmatrix}\n$$\n$s_N$ 的范数平方为 $\\|s_N\\|^2_2 = (0.13)^2 + (-0.01)^2 = 0.0169 + 0.0001 = 0.017$。\n因此，$\\|s_N\\|_2 = \\sqrt{0.017} \\approx 0.13038$。由于 $\\|s_N\\|_2 > \\Delta = 0.11$，牛顿步严格位于信赖域外部的条件得到满足。\n\n狗腿步 $s_D$ 是从原点到 $s_C$ 再到 $s_N$ 的路径上，位于信赖域边界上的点。鉴于 $\\|s_C\\|_2 < \\Delta$ 且 $\\|s_N\\|_2 > \\Delta$，步长 $s_D$ 必须位于连接 $s_C$ 和 $s_N$ 的线段上。我们可以将此线段上的任意点参数化为 $s(\\tau) = s_C + \\tau(s_N - s_C)$，其中标量 $\\tau \\in [0,1]$。\n我们需要找到特定的 $\\tau$ 使得 $\\|s(\\tau)\\|_2 = \\Delta$。将两边平方：\n$$\n\\|s_C + \\tau(s_N - s_C)\\|_2^2 = \\Delta^2\n$$\n展开此式可得到关于 $\\tau$ 的二次方程：\n$$\n\\|s_N - s_C\\|_2^2 \\tau^2 + 2 s_C^{\\top}(s_N - s_C) \\tau + (\\|s_C\\|_2^2 - \\Delta^2) = 0\n$$\n设系数为 $a$、$b$ 和 $c$。我们使用高精度值计算它们：\n$d_1 = \\|s_C\\|_2^2 = (\\frac{29}{164})^2 (0.29) \\approx 0.0090679655$\n$d_3 = \\|s_N\\|_2^2 = 0.017$\n$d_2 = s_C^{\\top}s_N = \\left(\\frac{29}{164}\\begin{pmatrix} 0.5 \\\\ 0.2 \\end{pmatrix}\\right)^{\\top} \\begin{pmatrix} 0.13 \\\\ -0.01 \\end{pmatrix} = \\frac{29}{164}(0.5 \\cdot 0.13 + 0.2 \\cdot (-0.01)) = \\frac{29}{164}(0.065-0.002) = \\frac{29 \\cdot 0.063}{164} \\approx 0.0111402439$\n\n二次方程 $a\\tau^2+b\\tau+c=0$ 的系数为：\n$a = \\|s_N - s_C\\|_2^2 = \\|s_N\\|_2^2 - 2 s_C^{\\top}s_N + \\|s_C\\|_2^2 = d_3 - 2d_2 + d_1$\n$a \\approx 0.017 - 2(0.0111402439) + 0.0090679655 \\approx 0.0037874777$\n$b = 2 s_C^{\\top}(s_N - s_C) = 2(s_C^{\\top}s_N - \\|s_C\\|_2^2) = 2(d_2 - d_1)$\n$b \\approx 2(0.0111402439 - 0.0090679655) \\approx 0.0041445568$\n$c = \\|s_C\\|_2^2 - \\Delta^2 = d_1 - (0.11)^2$\n$c \\approx 0.0090679655 - 0.0121 = -0.0030320345$\n\n我们使用二次公式 $\\tau = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解 $\\tau$：\n$b^2 - 4ac \\approx (0.0041445568)^2 - 4(0.0037874777)(-0.0030320345) \\approx 1.717734 \\times 10^{-5} + 4.593721 \\times 10^{-5} = 6.311455 \\times 10^{-5}$\n$\\sqrt{b^2 - 4ac} \\approx 0.007944466$\n$$\n\\tau = \\frac{-0.0041445568 \\pm 0.007944466}{2(0.0037874777)} = \\frac{-0.0041445568 \\pm 0.007944466}{0.0075749554}\n$$\n我们要求 $\\tau \\in [0,1]$，因此我们取正根：\n$$\n\\tau = \\frac{-0.0041445568 + 0.007944466}{0.0075749554} = \\frac{0.0037999092}{0.0075749554} \\approx 0.501641\n$$\n四舍五入到四位有效数字，我们得到 $\\tau \\approx 0.5016$。", "answer": "$$\n\\boxed{0.5016}\n$$"}]}