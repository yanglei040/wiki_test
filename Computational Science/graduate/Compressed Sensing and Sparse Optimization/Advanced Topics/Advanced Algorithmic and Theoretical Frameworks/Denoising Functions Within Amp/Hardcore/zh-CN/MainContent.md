## 引言
[近似消息传递](@entry_id:746497)（Approximate Message Passing, AMP）作为一种解决大规模高维逆问题的强大算法框架，已在信号处理和机器学习领域引起广泛关注。其核心迭代过程包含一个看似简单的[非线性](@entry_id:637147)处理步骤，通常被称为“去噪”。然而，这一[去噪](@entry_id:165626)函数的选择和设计直接决定了算法的成败，构成了算法性能的关键。尽管AMP的迭代形式简洁，但深刻理解去噪函数如何与算法的其余部分相互作用，以及如何根据具体问题定制最优的去噪策略，仍然是一个重要的知识缺口。

本文旨在系统性地揭示[AMP算法](@entry_id:746421)中去噪函数的核心作用。我们将从第一性原理出发，首先在“原则与机制”一章中，深入探讨支撑AMP卓越性能的状态演化（State Evolution）理论和关键的昂萨格修正项，解释算法如何被抽象为一系列简单的标量[去噪](@entry_id:165626)问题。接着，在“应用与跨学科联系”一章中，我们将展示如何通过设计不同的[去噪](@entry_id:165626)函数，将AMP框架灵活地应用于从结构化[稀疏恢复](@entry_id:199430)到[图信号处理](@entry_id:183351)和即插即用机器学习的广泛场景。最后，“动手实践”部分将提供具体的编程练习，帮助读者将理论知识转化为实践技能。

现在，让我们一同深入探索，揭开AMP中去噪函数的奥秘。

## 原则与机制

在前一章中，我们介绍了[近似消息传递](@entry_id:746497)（Approximate Message Passing, AMP）算法作为解决大规模[线性逆问题](@entry_id:751313)的一种高效迭代框架。[AMP算法](@entry_id:746421)的迭代过程在两个核心步骤之间交替：一个线性混合步骤和一个分量可分的[非线性](@entry_id:637147)处理步骤。本章将深入探讨第二个步骤——[非线性](@entry_id:637147)去噪函数在[AMP算法](@entry_id:746421)中的核心作用、其背后的关键机制，以及如何通过一个名为“状态演化”（State Evolution, SE）的强大理论工具来精确分析和设计这些函数。

### AMP的核心洞察：[去噪](@entry_id:165626)与状态演化抽象

[AMP算法](@entry_id:746421)的迭代结构，表面上类似于经典的迭代阈值算法（如ISTA），但其性能却有天壤之别。其卓越性能的根源在于一个深刻的统计现象。在许多情况下，特别是在测量矩阵$A$的元素是[独立同分布](@entry_id:169067)（i.i.d.）的高斯[随机变量](@entry_id:195330)时，进入去噪器$\eta_t$的有效输入信号$z^t = x^t + A^T r^t$（其中$x^t$是第$t$次迭代的信号估计，$r^t$是残差）在每一坐标上的行为，都如同真实信号$x_0$被一个简单的[高斯白噪声](@entry_id:749762)所污染。

具体而言，在高维极限下（即信号维度$n$和测量数$m$趋于无穷，而其比率$m/n \to \delta$保持不变），输入到[去噪](@entry_id:165626)器的向量$z^t$的各个分量$z_i^t$渐近地服从[分布](@entry_id:182848)$x_{0,i} + \tau_t g_i$，其中$g_i \sim \mathcal{N}(0, 1)$是标准高斯噪声，而$\tau_t$是一个确定性的标量，代表了在第$t$次迭代时的有效噪声[标准差](@entry_id:153618)。

这个惊人的结果，即**状态演化（State Evolution, SE）**，是AMP理论的基石。它将一个高维、确定性但行为复杂的[迭代算法](@entry_id:160288)的分析，简化为对一个标量[加性高斯白噪声](@entry_id:269320)（[AWGN](@entry_id:269320)）信道中一系列去噪问题的分析。我们不再需要追踪$n$维向量$x^t$的完整轨迹，只需追踪标量参数$\tau_t$的演化即可。

### 昂萨格修正项：“魔法”之所在

上述理想的高斯噪声特性并非自然而然发生。标准的迭代算法（如ISTA）的有效噪声会随着迭代变得越来越复杂，并与测量矩阵$A$相关联，从而破坏了上述简化。AMP的“魔法”在于其残差更新规则中引入了一个额外的项，称为**昂萨格（Onsager）修正项**。

对于一个典型的AMP更新，残差$r^t$的计算方式如下：
$$
r^{t+1} = y - Ax^{t+1} + b_{t+1} r^t
$$
这里的$b_{t+1} r^t$就是昂萨格修正项。它的精确形式依赖于测量矩阵$A$的统计分布，其作用是主动抵消由[非线性](@entry_id:637147)[去噪](@entry_id:165626)步骤$\eta_t$引入的[伪相关](@entry_id:755254)性，从而确保传递到下一次迭代的有效噪声保持（渐近）高斯性和白化特性。

这个修正项的系数$b_{t+1}$与去噪函数$\eta_t$的导数直接相关。例如，当测量矩阵的元素$A_{ij} \sim \mathcal{N}(0, 1/m)$时，昂萨格系数由[去噪](@entry_id:165626)器在输入$z^t$处的**散度（divergence）**给出：
$$
b_{t+1} = \frac{1}{m} \sum_{i=1}^{n} \left. \frac{\partial \eta_{t,i}(z)}{\partial z_i} \right|_{z=z^t} = \frac{1}{m} \mathrm{div}\,\eta_t(z^t)
$$
其中$\eta_{t,i}$是[去噪](@entry_id:165626)函数$\eta_t$的第$i$个分量。

为了更具体地理解这一点，让我们考虑一个广泛使用的[去噪](@entry_id:165626)器：**软[阈值函数](@entry_id:272436)** $\eta_{\tau}(u) = \mathrm{sign}(u) \max\{|u| - \tau, 0\}$。此函数的导数（在可导点）为$1$（当$|u| > \tau$时）或$0$（当$|u|  \tau$时）。因此，其散度就是其输出中非零元素的数量。假设在某次迭代中，我们有$m=6$，并且[去噪](@entry_id:165626)器$\eta_{0.85}$的输入为$z = (1.5, 0.3, -0.9, 2.1, -0.7, 0.0, 1.0, -1.2, 0.8)$。通过计算[绝对值](@entry_id:147688)大于阈值$0.85$的分量个数（即$1.5, -0.9, 2.1, 1.0, -1.2$），我们得到散度为$5$。因此，昂萨格系数为$b = 5/6$ 。这个简单的计算揭示了昂萨格项如何自适应地根据[去噪](@entry_id:165626)器“激活”的信号分量比例来调整自身。

### 状态演化动态与[不动点](@entry_id:156394)

有了状态演化抽象和昂萨格修正项的机制，我们现在可以精确预测[AMP算法](@entry_id:746421)的宏观性能。有效噪声[方差](@entry_id:200758)$\tau_t^2$的演化遵循一个确定性的标量递归关系：
$$
\tau_{t+1}^2 = \sigma_w^2 + \frac{1}{\delta} \mathbb{E}\left[ \big(\eta_t(x_0 + \tau_t g) - x_0\big)^2 \right]
$$
其中，$\sigma_w^2$是外部测量噪声的[方差](@entry_id:200758)，$\delta = m/n$是测量率，而期望$\mathbb{E}[\cdot]$是关于真实信号$x_0$的先验分布和标准高斯噪声$g \sim \mathcal{N}(0,1)$计算的。这个期望项正是[去噪](@entry_id:165626)器$\eta_t$在面对信噪比由$\tau_t$决定的[AWGN信道](@entry_id:269115)时的**均方误差（Mean Squared Error, MSE）**。

这个递归关系定义了一个关于$\tau^2$的动力学系统。如果该系统收敛到一个**[不动点](@entry_id:156394)**$\tau^\star$，即满足：
$$
\tau^{\star 2} = \sigma_w^2 + \frac{1}{\delta} \mathrm{MSE}(\tau^\star)
$$
那么，这个[不动点](@entry_id:156394)$\tau^\star$就预测了[AMP算法](@entry_id:746421)在收敛后的渐近性能。最终的重建[均方误差](@entry_id:175403)将是$m^\star = \mathrm{MSE}(\tau^\star)$。这个强大的框架使我们能够在不实际运行耗时的[AMP算法](@entry_id:746421)的情况下，仅通过求解一个标量方程来评估其性能。

### [去噪](@entry_id:165626)器的设计与分析

状态演化方程明确指出了[去噪](@entry_id:165626)器$\eta_t$在AMP中的核心地位：算法的整体性能直接取决于其在标量高斯信道中的去噪性能。

#### 最优与失配[去噪](@entry_id:165626)

为了使每一轮迭代的[误差最小化](@entry_id:163081)，SE方程告诉我们应该选择能够最小化$\mathrm{MSE}(\tau_t)$的[去噪](@entry_id:165626)器。根据[贝叶斯估计](@entry_id:137133)理论，最优的去噪器是**[后验均值](@entry_id:173826)估计器（Posterior Mean Estimator, PME）**，也称为最小均方误差（MMSE）估计器。它由下式给出：
$$
\eta_t^{\mathrm{opt}}(y) = \mathbb{E}[X | X + \tau_t G = y]
$$
其中$X$是遵循真实信号先验分布的[随机变量](@entry_id:195330)，$G \sim \mathcal{N}(0,1)$。

然而，在实践中，我们可能不知道信号的真实[先验分布](@entry_id:141376)，或者为了计算简便而使用一个近似的先验。这便引出了**失配[去噪](@entry_id:165626)（mismatched denoising）**的问题。状态演化框架同样能够精确量化这种失配带来的性能影响。

一个重要的发现是，MMSE估计器具有局部鲁棒性。假设真实信号[方差](@entry_id:200758)为$v$，但我们使用的去噪器错误地假设[方差](@entry_id:200758)为$v_{\mathrm{mis}} = v + \epsilon$。通过SE分析可以证明，当失配很小（$\epsilon \to 0$）时，算法稳态误差$\tau^2(\epsilon)$对失配的[一阶导数](@entry_id:749425)为零，即$\frac{d}{d\epsilon}\tau^2(\epsilon)|_{\epsilon=0} = 0$ 。这表明，最优估计器在其最优点附近对模型参数的微小扰动不敏感，这是一个非常理想的性质。

然而，当失配较大时，性能下降会很显著。例如，若真实信号是[重尾](@entry_id:274276)的（如[学生t分布](@entry_id:267063)），而我们错误地使用了尾部较轻的拉普拉斯先验去噪器，性能差距会很明显。通过**[特威迪公式](@entry_id:756243)（Tweedie's formula）**，可以将[去噪](@entry_id:165626)器与先验分布的[对数导数](@entry_id:169238)（[得分函数](@entry_id:164520)）联系起来，进而在小噪声极限下，将MSE差距与两种[先验分布](@entry_id:141376)的**费雪信息（Fisher information）**联系起来，从而进行定量分析。

#### [对抗鲁棒性](@entry_id:636207)

除了模型失配，我们还可能关心算法在面对**[对抗性攻击](@entry_id:635501)**时的鲁棒性。我们可以在SE框架中对此进行建模。假设有效信道中除了[高斯噪声](@entry_id:260752)外，还存在一个有界的[对抗性扰动](@entry_id:746324)$Z$，即$Y^t = X + \tau_t W + Z$，其中$|Z| \le \zeta$。为了设计鲁棒的算法，我们可以约束去噪器的**[影响函数](@entry_id:168646)**（即其导数）$\psi(y) = \eta'(y)$。例如，通过限制$|\eta'(y)| \le L$，我们可以限制单个异常输入对输出的影响。对于一个简单的线性[去噪](@entry_id:165626)器$\eta(y)=\alpha y$，我们可以求解在最坏的对[抗扰动](@entry_id:262021)下最小化MSE的最优缩放因子$\alpha_\star$，从而得到一个具有可证明鲁棒性的SE更新规则 。

### 进阶主题与实践考量

#### 即插即用AMP与黑箱去噪器

现代信号处理中，许多最先进的去噪器（例如基于[深度学习](@entry_id:142022)的[去噪](@entry_id:165626)器）并没有简单的解析表达式，它们是“黑箱”函数。这是否意味着我们无法在AMP中使用它们，因为我们无法计算昂萨格项所需的散度？答案是否定的。利用[高斯随机向量](@entry_id:635820)的一个巧妙性质（与[斯坦因引理](@entry_id:261636)相关），我们可以通过一次性的**[蒙特卡洛估计](@entry_id:637986)**来近似计算散度：
$$
\mathrm{div}\, D(v) \approx \frac{1}{\epsilon} z^T (D(v + \epsilon z) - D(v))
$$
其中$z \sim \mathcal{N}(0, I_n)$是一个随机高斯向量，$\epsilon$是一个小标量。这个强大的技术使得我们能够将几乎任何现成的[去噪](@entry_id:165626)算法“即插即用”到AMP框架中，极大地扩展了AMP的应用范围 。

#### 随机去噪器

SE框架的灵活性甚至允许我们分析[去噪](@entry_id:165626)器本身就是随机的情况。例如，考虑一个阈值随机[抖动](@entry_id:200248)的[软阈值](@entry_id:635249)去噪器，其阈值为$\Theta_t = \lambda_t + \Lambda_t$，其中$\Lambda_t \sim \mathcal{N}(0, \sigma_\lambda^2)$。此时，昂萨格系数需要对去噪器的内在随机性进行平均，变为$b_t = \mathbb{E}[\eta_t'(R_t; \Theta_t)] = \mathbb{P}(|R_t| > \Theta_t)$。这个概率可以被精确地计算出来，其表达式涉及一个二元正态累积分布函数，展示了SE分析复杂[随机系统](@entry_id:187663)的能力 。

#### [算法稳定性](@entry_id:147637)与阻尼

SE递归本身是一个动力系统，它不一定总是收敛，或者[收敛速度](@entry_id:636873)可能很慢。为了改善其收敛性，可以引入**阻尼（damping）**。令$m_t = \tau_t^2$，阻尼后的更新为$m_{t+1} = (1-\alpha) m_t + \alpha \Psi(m_t)$，其中$\Psi$是原始的SE映射，$\alpha \in (0, 1]$是阻尼参数。通过收缩映射理论分析，我们可以确定保证收敛的条件。有趣的是，如果原始映射$\Psi$已经是[利普希茨常数](@entry_id:146583)$L  1$的收缩映射，那么不使用阻尼（$\alpha=1$）会得到最快的[收敛速度](@entry_id:636873)。阻尼主要在原始映射不收缩时发挥关键作用，以确保收敛 。

#### [去噪](@entry_id:165626)器引发的[相变](@entry_id:147324)

[去噪](@entry_id:165626)器的选择对SE动力学有着至关重要的影响，甚至可以引发**[相变](@entry_id:147324)（phase transition）**。考虑一个通过参数$\eta$从简单（如[软阈值](@entry_id:635249)）到复杂（如最优MMSE）平滑变化的去噪器家族。当改变$\eta$时，SE的[不动点](@entry_id:156394)$\tau^\star$也会随之改变。在某些参数区域，这种变化是平滑的；而在另一些区域，$\tau^\star$可能会发生剧烈跳跃，这就是[相变](@entry_id:147324)。更奇特的是，系统可能出现**[多稳态](@entry_id:180390)（multi-stability）**，即存在多个稳定的SE[不动点](@entry_id:156394)。此时，[AMP算法](@entry_id:746421)的最终性能将取决于其初始化（例如，从一个乐观的低误差初始值开始，还是从一个悲观的高误差初始值开始）。这种行为与[统计物理学](@entry_id:142945)中的[自旋玻璃](@entry_id:143993)理论惊人地相似，它揭示了对于某些难题，只有足够“智能”的去噪器（$\eta$足够大）才能帮助算法“隧穿”到一个好的[不动点](@entry_id:156394)，从而实现成功的[信号恢复](@entry_id:195705) 。

#### 理论的扩展与基石

尽管本章的讨论主要围绕i.i.d.高斯矩阵展开，但AMP的思想具有更广泛的普适性。对于其他类型的随机矩阵系综，如**右旋不变矩阵**（例如$A=sQ$，其中$Q$是随机正交矩阵），也存在类似的SE理论，通常称为**向量AMP（VAMP）**。通过分析为这类矩阵设计的酉不变[去噪](@entry_id:165626)器，我们可以看到[消息传递算法](@entry_id:262248)和SE分析的相通之处 。

最后，值得强调的是，状态演化这一看似神奇的现象，背后有坚实的数学基础。其严格证明依赖于对[去噪](@entry_id:165626)函数$\eta_t$施加一定的[正则性条件](@entry_id:166962)。例如，函数不能增长过快，这通常通过要求其满足**k阶伪利普希茨（pseudo-Lipschitz of order k）**条件来保证。此外，其导数也需要有足够的正则性，以确保经验平均的昂萨格项能够收敛到其理论预测值。这些技术条件是确保SE理论严谨性的关键 。

总之，去噪函数是[AMP算法](@entry_id:746421)的心脏，而状态演化则是理解其搏动的听诊器。通过精心设计[去噪](@entry_id:165626)器并利用SE进行分析，我们不仅可以预测算法性能，还能赋予其鲁棒性、稳定性和适应性，从而解决各种具有挑战性的[高维推断](@entry_id:750277)问题。