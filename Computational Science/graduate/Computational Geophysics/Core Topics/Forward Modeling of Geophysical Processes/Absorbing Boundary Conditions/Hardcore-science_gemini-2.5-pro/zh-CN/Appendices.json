{
    "hands_on_practices": [
        {
            "introduction": "我们实践的第一步是分析最基础的吸收边界条件之一：一阶Engquist-Majda（EM）边界。通过这个练习，你将从第一性原理出发，为入射到EM边界上的平面波推导其反射系数。这项基础性的分析练习旨在揭示人工边界如何产生非物理反射，并量化这些反射误差如何随波的入射角度变化，为你理解更复杂方法的必要性奠定基础。",
            "id": "3572784",
            "problem": "考虑在波速为常数 $c$ 的均匀、各向同性介质中，标量场 $u(x,y,t)$ 的二维声波方程\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} = c^{2} \\left( \\frac{\\partial^{2} u}{\\partial x^{2}} + \\frac{\\partial^{2} u}{\\partial y^{2}} \\right).\n$$\n计算域为半空间 $x \\leq 0$，在 $x=0$ 处有一个截断边界。为了最大限度地减少在 $x=0$ 处的人为反射，施加了一阶 Engquist–Majda 型吸收边界条件 (ABC)，\n$$\n\\left( \\frac{\\partial}{\\partial t} + c \\frac{\\partial}{\\partial x} \\right) u(x=0,y,t) = 0,\n$$\n该条件通过忽略切向耦合来近似沿 $+x$ 方向的单向传播。\n\n域内的一个时谐平面波解具有以下形式\n$$\nu_{\\text{inc}}(x,y,t) = \\exp\\!\\big( i (k_{x} x + k_{y} y - \\omega t) \\big),\n$$\n其中 $\\omega = c k$ 且 $k = \\sqrt{k_{x}^{2} + k_{y}^{2}}$。入射角 $\\theta \\in [0,\\pi/2)$ 是相对于边界法线（$+x$ 轴）定义的，因此 $k_{x} = k \\cos\\theta$ 和 $k_{y} = k \\sin\\theta$。由于 ABC 的存在，会产生一个反射波，可以写成\n$$\nu_{\\text{ref}}(x,y,t) = R(\\theta)\\, \\exp\\!\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big),\n$$\n其中 $R(\\theta)$ 是复反射系数，定义为边界处反射波振幅与入射波振幅之比。\n\n从声波方程和指定的边界条件出发，推导出 $R(\\theta)$ 的闭式解，然后通过能量反射分数来量化与角度相关的误差\n$$\ne(\\theta) = \\left| R(\\theta) \\right|^{2}.\n$$\n请提供 $R(\\theta)$ 和 $e(\\theta)$ 关于 $\\theta$ 的最终表达式，其中 $\\theta$ 以弧度表示。无需进行数值计算或四舍五入。最终答案必须是单个闭式解析表达式或按规定格式表示的此类表达式的单行矩阵。",
            "solution": "该问题是有效的，因为它具有科学依据、适定、客观且自洽。该分析涉及计算波传播中的一个标准和基础性课题。我们现在开始推导。\n\n域 $x \\leq 0$ 中的总声场 $u(x,y,t)$ 是入射波 $u_{\\text{inc}}$ 和在边界 $x=0$ 处产生的反射波 $u_{\\text{ref}}$ 的线性叠加。\n$$\nu(x,y,t) = u_{\\text{inc}}(x,y,t) + u_{\\text{ref}}(x,y,t)\n$$\n代入给定的入射波和反射波形式：\n$$\nu(x,y,t) = \\exp\\!\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta)\\, \\exp\\!\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\n问题要求在边界 $x=0$ 处应用一阶 Engquist–Majda 吸收边界条件 (ABC)：\n$$\n\\left( \\frac{\\partial}{\\partial t} + c \\frac{\\partial}{\\partial x} \\right) u(x,y,t) \\bigg|_{x=0} = 0\n$$\n要应用此条件，我们首先计算总场 $u(x,y,t)$ 的必要偏导数。\n\n关于时间 $t$ 的偏导数是：\n$$\n\\frac{\\partial u}{\\partial t} = (-i \\omega) \\exp\\!\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta) (-i \\omega) \\exp\\!\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\n$$\n\\frac{\\partial u}{\\partial t} = -i \\omega \\left( u_{\\text{inc}} + u_{\\text{ref}} \\right)\n$$\n关于空间坐标 $x$ 的偏导数是：\n$$\n\\frac{\\partial u}{\\partial x} = (i k_{x}) \\exp\\!\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta) (-i k_{x}) \\exp\\!\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\n$$\n\\frac{\\partial u}{\\partial x} = i k_{x} \\left( u_{\\text{inc}} - u_{\\text{ref}} \\right)\n$$\n现在，我们将这些导数代入 ABC 算子中：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = -i \\omega (u_{\\text{inc}} + u_{\\text{ref}}) + c(i k_{x} (u_{\\text{inc}} - u_{\\text{ref}}))\n$$\n按 $u_{\\text{inc}}$ 和 $u_{\\text{ref}}$ 分组各项：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = (-i \\omega + i c k_{x}) u_{\\text{inc}} + (-i \\omega - i c k_{x}) u_{\\text{ref}}\n$$\n我们现在在边界 $x=0$ 处计算此表达式的值。在 $x=0$ 处，入射波和反射波项变为：\n$$\nu_{\\text{inc}}(0,y,t) = \\exp\\!\\big( i (k_{y} y - \\omega t) \\big)\n$$\n$$\nu_{\\text{ref}}(0,y,t) = R(\\theta)\\, \\exp\\!\\big( i (k_{y} y - \\omega t) \\big) = R(\\theta) u_{\\text{inc}}(0,y,t)\n$$\n将此关系代入边界 $x=0$ 处的边界条件方程中：\n$$\n(-i \\omega + i c k_{x}) u_{\\text{inc}}(0,y,t) + (-i \\omega - i c k_{x}) R(\\theta) u_{\\text{inc}}(0,y,t) = 0\n$$\n由于 $u_{\\text{inc}}(0,y,t)$ 不恒为零，我们可以将其消去，得到一个关于反射系数 $R(\\theta)$ 的代数方程：\n$$\n(-i \\omega + i c k_{x}) + (-i \\omega - i c k_{x}) R(\\theta) = 0\n$$\n求解 $R(\\theta)$：\n$$\nR(\\theta) (-i \\omega - i c k_{x}) = -(-i \\omega + i c k_{x}) = i \\omega - i c k_{x}\n$$\n$$\nR(\\theta) = \\frac{i \\omega - i c k_{x}}{-i \\omega - i c k_{x}} = \\frac{i(\\omega - c k_{x})}{-i(\\omega + c k_{x})} = - \\frac{\\omega - c k_{x}}{\\omega + c k_{x}} = \\frac{c k_{x} - \\omega}{c k_{x} + \\omega}\n$$\n为了用入射角 $\\theta$ 表示 $R(\\theta)$，我们使用给定的关系式：\n$\\omega = c k$ 和 $k_{x} = k \\cos\\theta$。\n将它们代入 $R(\\theta)$ 的表达式中：\n$$\nR(\\theta) = \\frac{c(k \\cos\\theta) - ck}{c(k \\cos\\theta) + ck}\n$$\n从分子和分母中提出公因子 $ck$：\n$$\nR(\\theta) = \\frac{ck(\\cos\\theta - 1)}{ck(\\cos\\theta + 1)} = \\frac{\\cos\\theta - 1}{\\cos\\theta + 1}\n$$\n这个表达式可以使用三角半角恒等式 $1-\\cos\\theta = 2\\sin^2(\\frac{\\theta}{2})$ 和 $1+\\cos\\theta = 2\\cos^2(\\frac{\\theta}{2})$ 来简化：\n$$\nR(\\theta) = \\frac{-(1 - \\cos\\theta)}{1 + \\cos\\theta} = -\\frac{2\\sin^2(\\frac{\\theta}{2})}{2\\cos^2(\\frac{\\theta}{2})} = -\\tan^2\\!\\left(\\frac{\\theta}{2}\\right)\n$$\n这就是反射系数的闭式表达式。\n\n接下来，我们通过能量反射分数 $e(\\theta) = |R(\\theta)|^{2}$ 来量化与角度相关的误差。角 $\\theta$ 在 $[0, \\pi/2)$ 区间内，因此 $\\cos\\theta$ 是实数，从而 $R(\\theta)$ 也是实数。\n$$\ne(\\theta) = \\left| -\\tan^2\\!\\left(\\frac{\\theta}{2}\\right) \\right|^2 = \\left( \\tan^2\\!\\left(\\frac{\\theta}{2}\\right) \\right)^2 = \\tan^4\\!\\left(\\frac{\\theta}{2}\\right)\n$$\n或者，使用以 $\\cos\\theta$ 表示的表达式：\n$$\ne(\\theta) = \\left| \\frac{\\cos\\theta - 1}{\\cos\\theta + 1} \\right|^2 = \\left( \\frac{\\cos\\theta - 1}{\\cos\\theta + 1} \\right)^2 = \\left( \\frac{1 - \\cos\\theta}{1 + \\cos\\theta} \\right)^2\n$$\n两种形式是等价的。用正切表示的公式更简洁。\n\n最终结果是反射系数 $R(\\theta)$ 和能量反射分数 $e(\\theta)$ 的表达式。\n$R(\\theta) = -\\tan^2(\\frac{\\theta}{2})$\n$e(\\theta) = \\tan^4(\\frac{\\theta}{2})$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\tan^2\\left(\\frac{\\theta}{2}\\right)  \\tan^4\\left(\\frac{\\theta}{2}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "虽然简单的吸收边界条件（如Engquist-Majda）为我们提供了一个理论起点，但在实际应用中，它们的性能往往不足以满足高精度模拟的需求。这项实践将通过直接比较一阶Engquist-Majda边界与更先进的完美匹配层（PML）的性能，让你直观地感受到二者在吸收效果上的巨大差异。通过编码实现并量化误差，你将深刻理解为何PML已成为现代波动方程数值模拟中的标准技术。",
            "id": "3572766",
            "problem": "您需要分析均匀声学介质中时谐平面波的吸收情况，并比较一阶Engquist–Majda吸收边界条件与完美匹配层（PML）的性能。在二维空间中进行分析，但使用平面波分析法，将问题简化为边界法向方向上的一维问题。从均匀介质中的标量声波方程、平面波拟设以及这些吸收边界模型的标准定义出发。\n\n考虑一个声速为常数 $c$（单位：$\\mathrm{m/s}$）的均匀、各向同性声学介质。一个角频率为 $\\omega$（单位：$\\mathrm{rad/s}$）的时谐平面波以入射角 $\\theta$（单位：度）入射到一个垂直边界上，该角度从边界法线方向朝切线方向测量。边界附近物理域内的总场是入射平面波与其反射波的叠加。使用以下基本事实作为您的出发点：\n\n- 声压场 $u(\\mathbf{x},t)$ 满足标量声波方程 $\\partial_{t}^{2} u - c^{2} \\nabla^{2} u = 0$。\n- 时谐平面波解可以写成 $u(\\mathbf{x},t) = \\Re\\{\\hat{u} \\exp(i(\\mathbf{k}\\cdot\\mathbf{x} - \\omega t))\\}$，其中 $\\|\\mathbf{k}\\| = \\omega/c$。\n- 在一个沿 $+x$ 方向的外向单位法向量为 $\\mathbf{n}$ 的垂直边界上，一阶Engquist–Majda边界条件是一个单向算子，它在边界上强制要求向外传播的法向分量满足 $\\partial_{t} u + c\\,\\partial_{x} u = 0$。\n- 完美匹配层（PML）可以在频域中通过在边界法向方向 $x$ 上进行复坐标伸展来建模，伸展因子为 $s(x) = 1 + i\\,\\sigma(x)/\\omega$，其中 $\\sigma(x) \\ge 0$ 是一个阻尼剖面，作用于附加在物理边界之外、厚度为 $L_{\\mathrm{pml}}$ 的层上。假设PML入口是完美匹配的（在界面处没有反射），并且PML的远端由一个完美反射体终止，因此唯一的反射来自于波在有损层中两次穿过后发生的截断。使用多项式剖面 $\\sigma(x) = \\sigma_{\\max}\\,(x/L_{\\mathrm{pml}})^{m}$，其中 $m$ 是一个非负整数，$x \\in [0, L_{\\mathrm{pml}}]$ 衡量进入PML的深度。\n\n任务：\n\n1) 从第一性原理出发，使用平面波拟设和Engquist–Majda单向算子，推导作用于倾斜入射角为 $\\theta$ 的平面波的一阶Engquist–Majda边界的复反射系数 $R_{\\mathrm{EM1}}(\\theta,\\omega)$。将吸收误差表示为模值 $\\lvert R_{\\mathrm{EM1}} \\rvert$。\n\n2) 在具有多项式剖面和PML外边界完美反射的连续频域PML模型中，推导在物理域中看到的净反射的模值。使用边界法向波数 $k_{n} = (\\omega/c)\\cos\\theta$ 和复伸展因子 $s(x)$ 来获得一个关于 $\\sigma_{\\max}$、$L_{\\mathrm{pml}}$、$m$、$c$ 和 $\\theta$ 的 $\\lvert R_{\\mathrm{PML}} \\rvert$ 的闭式表达式。将吸收误差表示为 $\\lvert R_{\\mathrm{PML}} \\rvert$。\n\n3) 设计 $\\sigma_{\\max}$ 以实现一个与频率无关的目标PML反射模值 $\\lvert R_{\\mathrm{PML}} \\rvert = R_{\\mathrm{target}}$。显式求解 $\\sigma_{\\max}$，用 $R_{\\mathrm{target}}$、$L_{\\mathrm{pml}}$、$m$、$c$ 和 $\\theta$ 表示。\n\n4) 实现一个程序，该程序为提供的测试集中的每个频率，根据固定的角度 $\\theta$ 和介质参数，计算误差对 $\\lvert R_{\\mathrm{EM1}} \\rvert$ 和 $\\lvert R_{\\mathrm{PML}} \\rvert$。使用推导出的闭式表达式。所有角度在问题陈述中必须以度为单位处理，但在计算中需转换为弧度。频率必须以 $\\mathrm{Hz}$ 为单位处理，并在需要时使用 $\\omega = 2\\pi f$ 转换为角频率。由于误差是无量纲的模值，报告时无需单位。\n\n本问题的物理和数值参数：\n\n- 声速 $c = 1500$ $\\mathrm{m/s}$。\n- 入射角 $\\theta = 60^\\circ$。\n- PML厚度 $L_{\\mathrm{pml}} = 50$ $\\mathrm{m}$。\n- PML多项式阶数 $m = 2$。\n- PML目标反射模值 $R_{\\mathrm{target}} = 10^{-6}$，用于设置 $\\sigma_{\\max}$。\n- 频率 $f$（单位：$\\mathrm{Hz}$）：$[5, 25, 100, 400, 1600]$。\n\n测试集：\n\n- 情况 A（正常情况）：$f = 100$。\n- 情况 B（低频）：$f = 5$。\n- 情况 C（中频）：$f = 25$。\n- 情况 D（高频）：$f = 400$。\n- 情况 E（相同介质参数下的甚高频）：$f = 1600$。\n\n输出要求：\n\n- 对每个测试频率 $f$，计算一个三元组 $[f, \\lvert R_{\\mathrm{EM1}} \\rvert, \\lvert R_{\\mathrm{PML}} \\rvert]$。将三元组中的每个数字四舍五入到恰好 $6$ 位小数。\n- 您的程序应生成单行输出，其中包含所有测试频率的结果，格式为由逗号分隔的这些三元组的列表，并用方括号括起来，例如：$[[f_{1},e_{1}^{\\mathrm{EM1}},e_{1}^{\\mathrm{PML}}],[f_{2},e_{2}^{\\mathrm{EM1}},e_{2}^{\\mathrm{PML}}],\\ldots]$。",
            "solution": "该问题是有效的，因为它在科学上基于标准的声波理论和计算方法，所有必需的参数都已提供，问题是适定的，并且没有矛盾或含糊之处。我们将首先推导反射系数的解析表达式，然后进行数值实现。\n\n问题的核心是分析时谐平面波 $u(\\mathbf{x}, t)$ 从人工边界的反射。压力场 $u$ 满足均匀介质中声速为 $c$ 的标量声波方程：\n$$\n\\partial_{t}^{2} u - c^{2} \\nabla^{2} u = 0\n$$\n我们考虑形式为 $u(\\mathbf{x}, t) = \\Re\\{\\hat{u}(\\mathbf{x}) \\exp(-i\\omega t)\\}$ 的平面波解，其中 $\\omega$ 是角频率。将其代入波动方程，得到复振幅 $\\hat{u}(\\mathbf{x})$ 的亥姆霍兹方程：\n$$\n\\nabla^{2} \\hat{u} + k^{2} \\hat{u} = 0\n$$\n其中波数为 $k = \\omega/c$。波矢 $\\mathbf{k} = (k_x, k_y)$ 的模为 $\\|\\mathbf{k}\\| = k$。对于以相对于边界法线（$x$轴）的角 $\\theta$ 入射的波，波矢的分量为 $k_x = k \\cos\\theta = (\\omega/c)\\cos\\theta$ 和 $k_y = k \\sin\\theta = (\\omega/c)\\sin\\theta$。\n\n边界附近的总场是入射波（$u_I$）和反射波（$u_R$）的叠加。设物理域为 $x \\le x_b$，边界位于 $x=x_b$。入射波沿 $+x$ 方向传播，反射波沿 $-x$ 方向传播。它们的复振幅为：\n$$\n\\hat{u}_I(x, y) = A_I \\exp(i(k_x x + k_y y))\n$$\n$$\n\\hat{u}_R(x, y) = A_R \\exp(i(-k_x x + k_y y))\n$$\n总复振幅为 $\\hat{u} = \\hat{u}_I + \\hat{u}_R$。边界上的反射系数定义为 $R = \\hat{u}_R(x_b, y) / \\hat{u}_I(x_b, y)$。\n\n**任务1：一阶Engquist–Majda反射系数**\n\n一阶Engquist–Majda吸收边界条件（ABC）给出为：\n$$\n\\partial_{t} u + c\\,\\partial_{x} u = 0\n$$\n此条件应用于边界 $x=x_b$ 上的总场 $u$。对于时谐场，$\\partial_t$ 等效于乘以 $-i\\omega$。频域中的边界条件变为：\n$$\n-i\\omega \\hat{u} + c\\,\\partial_{x} \\hat{u} = 0 \\quad \\text{在 } x=x_b\n$$\n我们在边界处计算这些项。总场为 $\\hat{u}(x_b, y) = (A_I e^{ik_x x_b} + A_R e^{-ik_x x_b})e^{ik_y y}$。其空间导数为 $\\partial_x \\hat{u}(x_b, y) = (ik_x A_I e^{ik_x x_b} - ik_x A_R e^{-ik_x x_b})e^{ik_y y}$。\n将这些代入边界条件方程：\n$$\n-i\\omega (A_I e^{ik_x x_b} + A_R e^{-ik_x x_b}) + c(ik_x A_I e^{ik_x x_b} - ik_x A_R e^{-ik_x x_b}) = 0\n$$\n除以公因子 $i e^{ik_y y}$ 并重新整理各项：\n$$\n-\\omega(A_I e^{ik_x x_b} + A_R e^{-ik_x x_b}) + c k_x(A_I e^{ik_x x_b} - A_R e^{-ik_x x_b}) = 0\n$$\n$$\nA_I e^{ik_x x_b} (ck_x - \\omega) = A_R e^{-ik_x x_b} (ck_x + \\omega)\n$$\n反射系数是 $R_{\\mathrm{EM1}} = \\frac{A_R e^{-ik_x x_b}}{A_I e^{ik_x x_b}}$。解此比例可得：\n$$\nR_{\\mathrm{EM1}} = \\frac{ck_x - \\omega}{ck_x + \\omega}\n$$\n代入 $k_x = (\\omega/c)\\cos\\theta$：\n$$\nR_{\\mathrm{EM1}}(\\theta) = \\frac{c(\\omega/c)\\cos\\theta - \\omega}{c(\\omega/c)\\cos\\theta + \\omega} = \\frac{\\omega\\cos\\theta - \\omega}{\\omega\\cos\\theta + \\omega} = \\frac{\\cos\\theta - 1}{\\cos\\theta + 1}\n$$\n吸收误差是模 $|R_{\\mathrm{EM1}}|$。由于 $\\theta \\in [0, 90^\\circ]$，$\\cos\\theta \\in [0, 1]$，所以 $1+\\cos\\theta \\ge 0$ 且 $\\cos\\theta-1 \\le 0$。因此：\n$$\n|R_{\\mathrm{EM1}}| = \\left|\\frac{\\cos\\theta - 1}{\\cos\\theta + 1}\\right| = \\frac{1 - \\cos\\theta}{1 + \\cos\\theta}\n$$\n此表达式与频率 $\\omega$ 无关，这是一阶ABC的一个特征。\n\n**任务2：完美匹配层（PML）反射系数**\n\n在PML中，垂直于边界的坐标（$x$方向）被复数伸展。PML中平面波的修正亥姆霍兹方程可以使用局部波数进行分析。使用给定的伸展因子 $s(x) = 1 + i\\sigma(x)/\\omega$，PML内部 $x$ 方向的波数 $\\tilde{k}_x(x)$ 变为复数：\n$$\n\\tilde{k}_x(x) = k_x s(x) = (\\omega/c)\\cos\\theta \\left(1 + \\frac{i\\sigma(x)}{\\omega}\\right) = \\frac{\\omega\\cos\\theta}{c} + i\\frac{\\sigma(x)\\cos\\theta}{c}\n$$\n$\\tilde{k}_x$的虚部导致波的衰减。一个从物理域入口 $x=0$ 传播到PML中深度为 $x$ 的波，其振幅会乘以一个衰减因子 $A(x) = \\exp(-\\int_0^x \\text{Im}\\{\\tilde{k}_x(x')\\} dx')$。\n反射 $|R_{\\mathrm{PML}}|$ 是由于波在厚度为 $L_{\\mathrm{pml}}$ 的PML中往返一次，并在远端 $x=L_{\\mathrm{pml}}$ 处发生完美反射（模为1）所致。总衰减对应于 $2 L_{\\mathrm{pml}}$ 的路径长度。\n$$\n|R_{\\mathrm{PML}}| = \\exp\\left(-2 \\int_0^{L_{\\mathrm{pml}}} \\text{Im}\\{\\tilde{k}_x(x)\\} dx\\right)\n$$\n虚部的积分为：\n$$\n\\int_0^{L_{\\mathrm{pml}}} \\text{Im}\\{\\tilde{k}_x(x)\\} dx = \\int_0^{L_{\\mathrm{pml}}} \\frac{\\sigma(x)\\cos\\theta}{c} dx = \\frac{\\cos\\theta}{c} \\int_0^{L_{\\mathrm{pml}}} \\sigma(x) dx\n$$\n使用指定的多项式剖面 $\\sigma(x) = \\sigma_{\\max}\\,(x/L_{\\mathrm{pml}})^{m}$：\n$$\n\\int_0^{L_{\\mathrm{pml}}} \\sigma(x) dx = \\sigma_{\\max} \\int_0^{L_{\\mathrm{pml}}} \\left(\\frac{x}{L_{\\mathrm{pml}}}\\right)^m dx = \\frac{\\sigma_{\\max}}{L_{\\mathrm{pml}}^m} \\left[\\frac{x^{m+1}}{m+1}\\right]_0^{L_{\\mathrm{pml}}} = \\frac{\\sigma_{\\max} L_{\\mathrm{pml}}}{m+1}\n$$\n将此代回，我们得到PML反射模值的最终表达式：\n$$\n|R_{\\mathrm{PML}}| = \\exp\\left(-2 \\frac{\\cos\\theta}{c} \\frac{\\sigma_{\\max} L_{\\mathrm{pml}}}{m+1}\\right)\n$$\n这种形式的PML，其中伸展因子 $s(x)$ 中的 $\\sigma(x)$ 按 $1/\\omega$ 缩放，产生的反射系数其模值与频率无关。\n\n**任务3：$\\sigma_{\\max}$ 的设计**\n\n我们的任务是设计PML以实现一个特定的目标反射模值 $|R_{\\mathrm{PML}}| = R_{\\mathrm{target}}$。我们可以对上述表达式求解 $\\sigma_{\\max}$：\n$$\n\\ln(R_{\\mathrm{target}}) = -2 \\frac{\\sigma_{\\max} L_{\\mathrm{pml}} \\cos\\theta}{c(m+1)}\n$$\n$$\n\\sigma_{\\max} = -\\frac{c(m+1)\\ln(R_{\\mathrm{target}})}{2 L_{\\mathrm{pml}} \\cos\\theta}\n$$\n由于 $R_{\\mathrm{target}}  1$，其自然对数为负，从而确保 $\\sigma_{\\max} > 0$。\n\n**任务4：数值实现**\n\n程序将实现所推导的公式。\n参数为 $c=1500\\,\\mathrm{m/s}$、$\\theta=60^\\circ$、$L_{\\mathrm{pml}}=50\\,\\mathrm{m}$、$m=2$ 和 $R_{\\mathrm{target}}=10^{-6}$。所有计算均使用国际单位制（SI）和弧度制角度。\n首先，我们计算 $\\cos\\theta = \\cos(60^\\circ) = 0.5$。\n对于Engquist–Majda边界，误差对所有频率都是恒定的：\n$$\n|R_{\\mathrm{EM1}}| = \\frac{1 - 0.5}{1 + 0.5} = \\frac{0.5}{1.5} = \\frac{1}{3}\n$$\n接下来，我们计算所需的 $\\sigma_{\\max}$ 以实现 $|R_{\\mathrm{PML}}| = R_{\\mathrm{target}}$：\n$$\n\\sigma_{\\max} = -\\frac{1500 \\cdot (2+1) \\cdot \\ln(10^{-6})}{2 \\cdot 50 \\cdot 0.5} = -\\frac{4500 \\cdot (-6 \\ln 10)}{50} = 540 \\ln 10\n$$\n程序将使用此 $\\sigma_{\\max}$ 值和任务2中推导的公式来计算 $|R_{\\mathrm{PML}}|$。根据构造，对于所有频率，结果必须是 $R_{\\mathrm{target}}=10^{-6}$，在机器精度范围内。\n代码将遍历指定的频率，计算两个误差值，将它们格式化为6位小数，并以要求的列表格式打印结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares absorption errors for Engquist-Majda and PML\n    boundary conditions for acoustic plane waves.\n    \"\"\"\n    \n    # Define physical and numerical parameters from the problem statement.\n    test_cases = [\n        # (frequency in Hz)\n        5.0,\n        25.0,\n        100.0,\n        400.0,\n        1600.0\n    ]\n    \n    c = 1500.0  # Sound speed (m/s)\n    theta_deg = 60.0  # Incidence angle (degrees)\n    L_pml = 50.0  # PML thickness (m)\n    m = 2  # PML polynomial order\n    R_target = 1.0e-6  # PML target reflection magnitude\n\n    # Convert angle to radians for trigonometric functions\n    theta_rad = np.deg2rad(theta_deg)\n    cos_theta = np.cos(theta_rad)\n\n    def calculate_em1_error(cos_th):\n        \"\"\"\n        Calculates the reflection magnitude for the first-order \n        Engquist-Majda boundary condition.\n        Formula: |R_EM1| = (1 - cos(theta)) / (1 + cos(theta))\n        This is independent of frequency.\n        \"\"\"\n        if 1.0 + cos_th == 0:\n            return np.inf\n        return (1.0 - cos_th) / (1.0 + cos_th)\n\n    def design_sigma_max(R_tgt, L, m_order, c_speed, cos_th):\n        \"\"\"\n        Calculates the optimal PML damping parameter sigma_max to achieve\n        a target reflection magnitude.\n        Formula: sigma_max = -c*(m+1)*ln(R_target) / (2*L*cos(theta))\n        \"\"\"\n        # np.log is the natural logarithm (ln)\n        numerator = -c_speed * (m_order + 1) * np.log(R_tgt)\n        denominator = 2.0 * L * cos_th\n        if denominator == 0:\n            return np.inf\n        return numerator / denominator\n\n    def calculate_pml_error(sigma_max, L, m_order, c_speed, cos_th):\n        \"\"\"\n        Calculates the PML reflection magnitude using the derived formula and a \n        given sigma_max. The result should be R_target by design.\n        Formula: |R_PML| = exp(-2 * sigma_max * L * cos(theta) / (c * (m+1)))\n        \"\"\"\n        exponent = -2.0 * sigma_max * L * cos_th / (c_speed * (m_order + 1))\n        return np.exp(exponent)\n\n    # Pre-calculate the optimal sigma_max based on the target reflection\n    sigma_max_val = design_sigma_max(R_target, L_pml, m, c, cos_theta)\n    \n    results = []\n    for f in test_cases:\n        # 1. Calculate the Engquist-Majda error.\n        # The result is independent of frequency, but we calculate it in the loop\n        # to demonstrate the computation for each test case.\n        err_em1 = calculate_em1_error(cos_theta)\n        \n        # 2. Calculate the PML error.\n        # Using the designed sigma_max, this will yield R_target,\n        # confirming the correctness of our derivations. The result is also\n        # frequency-independent by design.\n        err_pml = calculate_pml_error(sigma_max_val, L_pml, m, c, cos_theta)\n        \n        # Format the result for the current frequency as a string.\n        # Each value is rounded to exactly 6 decimal places.\n        result_str = f\"[{f:.6f},{err_em1:.6f},{err_pml:.6f}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个稳健的数值模型不仅需要有效吸收传播波，还必须正确处理那些不传播能量但同样存在的倏逝波（evanescent waves）。这项练习将引导你探索一个更深层次的问题：吸收边界条件如何与倏逝波相互作用，这是一个确保数值模拟稳定性和准确性的关键细节。你将分析一个简化的边界条件如何因错误处理倏逝波而导致非物理反射，并学习如何通过运动学校正（kinematic scaling）来设计一个能同时正确处理传播波和倏逝波的边界条件。",
            "id": "3572754",
            "problem": "要求您评估吸收边界条件 (ABC) 在均匀声学介质中遇到由亚临界入射产生的倏逝分量时的行为。请从第一性原理出发，推导所需的关系式，然后实现一个计算测试，以测量 ABC 是否会虚假地吸收或反射非传播分量，并提出一种校正缩放方法。您的程序必须是完整且可运行的，并且必须为指定的测试套件计算结果，并以文末描述的精确格式生成这些结果。\n\n考虑一个均匀、无损耗的声学介质，其特征是具有恒定的波速 $c$（单位：米/秒）。设角频率为 $\\omega$（单位：弧度/秒）的时谐场 $u(\\mathbf{x},t)$ 满足声波方程。通过分离变量法，时谐部分 $u(\\mathbf{x})$ 服从 Helmholtz 方程\n$$\n\\nabla^2 u + k^2 u = 0,\n$$\n其中 $k = \\omega / c$ 是波数（单位：弧度/米）。对于一个相对于 $z=0$ 处平面边界分解为切向和法向分量的平面波，定义切向波数 $k_x$（单位：弧度/米）和法向波数\n$$\nk_n = \\sqrt{k^2 - k_x^2},\n$$\n约定取主平方根，以使 $\\operatorname{Im}(k_n) \\ge 0$。亚临界入射指的是 $k_x > k$ 的情况，此时 $k_n = i \\alpha$，其中 $\\alpha = \\sqrt{k_x^2 - k^2} > 0$，场在 $z$ 方向上是倏逝的，对于 $z > 0$，其形式为 $u(z) \\propto e^{-\\alpha z}$。\n\n在平面 $z=0$ 上的一个一阶局部吸收边界条件 (ABC) 通过 Robin 型边界条件建模\n$$\n\\frac{\\partial u}{\\partial z} = s \\, u,\n$$\n其中 $s$ 是由该方案选择的一个复数类阻抗参数。两种广泛使用的选择是：\n- 一个不依赖于射线参数 $k_x$ 的朴素 Sommerfeld 型选择 $s = i k$。\n- 一个依赖于法向波数的运动学缩放选择 $s = i k_n$。\n\n您的任务是：\n1. 从 Helmholtz 方程和平面波分解出发，推导在 $z=0$ 处，一个法向波数为 $k_n$ 的模式入射到该边界条件上的反射系数 $R$。从边界条件和 $z=0$ 附近的模式叠加出发，说明 $R$ 如何依赖于 $s$ 和 $k_n$。\n2. 将您的结果应用于倏逝情况 $k_x > k$，并根据边界处增长和衰减指数之间的比率解释反射幅值 $|R|$ 的物理意义。解释为什么一个 ABC 不应该虚假地吸收或反射倏逝分量，以及关于 $s$ 的什么条件可以消除这种虚假效应。\n3. 基于您的推导，为 $s$ 提出一个校正缩放方案，该方案能够与传播分量（$k_x \\le k$）和倏逝分量（$k_x > k$）的物理上正确的处理方式保持一致。\n\n然后实现一个程序，对于每个测试用例，计算在朴素选择 $s = i k$ 和校正缩放选择 $s = i k_n$ 下的幅值 $|R|$。使用以下测试套件，其中所有物理量必须以指定的单位进行解释：\n- 频率 $f$（单位：$\\mathrm{Hz}$），其中 $\\omega = 2\\pi f$。\n- 波速 $c$（单位：$\\mathrm{m/s}$）。\n- 射线参数比 $r = k_x / k$（无量纲），由此可得 $k_x = r\\,k$。\n\n测试套件（每项为 $(f,c,r)$）：\n1. $(10, 1500, 0.0)$：法向入射，传播波。\n2. $(10, 1500, 0.8)$：斜入射，传播波。\n3. $(10, 1500, 0.999)$：低于截止频率的近掠射，传播波。\n4. $(10, 1500, 1.001)$：略高于截止频率，倏逝波。\n5. $(10, 1500, 1.2)$：远高于截止频率，倏逝波。\n6. $(20, 2000, 1.5)$：在不同 $f$ 和 $c$ 下的强倏逝波，倏逝波。\n\n您的程序必须：\n- 计算 $k = 2\\pi f / c$（单位：$\\mathrm{rad/m}$）和 $k_x = r\\,k$。\n- 如果 $k_x \\le k$，则计算 $k_n = \\sqrt{k^2 - k_x^2}$；如果 $k_x > k$，则计算 $k_n = i \\sqrt{k_x^2 - k^2}$。\n- 对于每种情况，计算在 $s = i k$ 和 $s = i k_n$ 下的幅值 $|R|$。\n\n最终输出格式：\n- 生成单行文本，其中包含一个用方括号括起来的、由逗号分隔的浮点数平铺列表。\n- 该列表必须总共包含 $12$ 个条目：按顺序对每个测试用例，首先输出朴素选择的 $|R|$，然后输出缩放选择的 $|R|$。\n- 每个打印的数字必须四舍五入到六位小数。\n带有占位符值的示例格式：$[0.123456,0.000000,0.234567,0.000000,\\dots]$。",
            "solution": "该问题经评估在科学上是合理的、适定的和完整的。为得到唯一解所需的所有物理原理、方程和参数都已提供。我们开始进行求解。\n\n基本任务是分析声波方程的一阶吸收边界条件 (ABC) 的性能，特别是它与倏逝波的相互作用。我们首先推导反射系数，然后分析其在不同物理区域和边界条件参数化下的行为，最后提出并测试一个校正方案。\n\n### 1. 反射系数 $R$ 的推导\n\n我们考虑一个时谐声场 $u(\\mathbf{x})$，它在波速为 $c$、角频率为 $\\omega$ 的均匀介质中满足 Helmholtz 方程：\n$$\n\\nabla^2 u + k^2 u = 0,\n$$\n其中 $k = \\omega/c$ 是波数。我们分析位于 $z=0$ 的平面边界附近的场。场可以分解为平面波，每个平面波由一个切向波数 $k_x$ 表征。对于一个固定的 $k_x$，场的空间依赖关系形式为 $u(x,z) = U(z) e^{i k_x x}$。将此代入 Helmholtz 方程，得到关于 $U(z)$ 的常微分方程：\n$$\n\\frac{d^2U}{dz^2} + (k^2 - k_x^2)U = 0 \\quad \\implies \\quad \\frac{d^2U}{dz^2} + k_n^2 U = 0,\n$$\n其中 $k_n = \\sqrt{k^2 - k_x^2}$ 是法向波数。问题指定了约定 $\\operatorname{Im}(k_n) \\ge 0$。\n\n设计算域为 $z \\le 0$。从域内入射到 $z=0$ 边界的波沿 $+z$ 方向传播。反射波沿 $-z$ 方向传播。总场 $U(z)$ 是这两个分量的叠加：\n$$\nU(z) = \\underbrace{A e^{i k_n z}}_{\\text{入射波}} + \\underbrace{B e^{-i k_n z}}_{\\text{反射波}},\n$$\n其中 $A$ 是入射波的振幅，$B$ 是反射波的振幅。反射系数定义为这些振幅之比，$R = B/A$。因此，我们可以将边界附近的总场写为：\n$$\nU(z) = A (e^{i k_n z} + R e^{-i k_n z}).\n$$\nABC 以 Robin 型边界条件的形式在 $z=0$ 处给出：\n$$\n\\frac{\\partial u}{\\partial z} = s u,\n$$\n其中 $s$ 是定义边界条件的参数。由于因子 $e^{i k_x x}$ 是公共的，这直接适用于 $U(z)$：\n$$\n\\left. \\frac{dU}{dz} \\right|_{z=0} = s \\, U(0).\n$$\n我们计算必要的项：\n- $U(0) = A(e^0 + R e^0) = A(1+R)$。\n- $\\frac{dU}{dz} = A(i k_n e^{i k_n z} - i k_n R e^{-i k_n z})$。\n- $\\left. \\frac{dU}{dz} \\right|_{z=0} = A(i k_n - i k_n R) = i k_n A(1-R)$。\n\n将这些代入边界条件方程：\n$$\ni k_n A(1-R) = s A(1+R).\n$$\n假设 $A \\neq 0$，我们可以解出 $R$：\n$$\ni k_n - i k_n R = s + sR \\\\\ni k_n - s = R(s + i k_n) \\\\\nR = \\frac{i k_n - s}{s + i k_n}.\n$$\n这个表达式给出了法向波数为 $k_n$ 的波入射到由参数 $s$ 表征的边界上的反射系数 $R$。\n\n### 2. 倏逝情况分析\n\n当切向波数大于总波数时，即 $k_x > k$ 时，出现倏逝区域。在这种情况下，$k_n^2 = k^2 - k_x^2  0$。我们定义一个正实数衰减常数 $\\alpha = \\sqrt{k_x^2 - k^2}$。法向波数在约束 $\\operatorname{Im}(k_n) \\ge 0$ 下，变为纯虚数：\n$$\nk_n = \\sqrt{-\\alpha^2} = i \\alpha.\n$$\n将 $k_n = i\\alpha$ 代入总场 $U(z)$ 的表达式中：\n$$\nU(z) = A(e^{i(i\\alpha)z} + R e^{-i(i\\alpha)z}) = A(e^{-\\alpha z} + R e^{\\alpha z}).\n$$\n在这种情况下，场是一个指数衰减分量（$e^{-\\alpha z}$）和一个指数增长分量（$e^{\\alpha z}$）的叠加。前者是物理上预期的，而后者是非物理的，不应由无源边界产生。反射系数 $R$ 现在表示由边界条件产生的虚假增长模式的相对振幅。\n\n一个理想的 ABC 应该模拟一个无限的、无源的介质。在这样的介质中，倏逝场只会衰减至零。因此，一个完美的倏逝波 ABC 必须不产生任何增长分量，这意味着系数 $R$ 必须为零。我们来寻找实现这一目标的关于 $s$ 的条件。我们将 $k_n = i\\alpha$ 代入我们的 $R$ 公式中：\n$$\nR = \\frac{i(i\\alpha) - s}{s + i(i\\alpha)} = \\frac{-\\alpha - s}{s - \\alpha}.\n$$\n为了没有虚假反射（即不产生增长模式），我们必须有 $R=0$。这要求分子为零：\n$$\n-\\alpha - s = 0 \\quad \\implies \\quad s = -\\alpha.\n$$\n这是完美吸收衰减率为 $\\alpha$ 的倏逝模式的理想 $s$ 选择。\n\n### 3. ABC 参数 $s$ 的校正缩放\n\n我们已经找到了两种独立情况下的理想参数 $s$：\n- **传播波 ($k_x \\le k$)：** 此处 $k_n$ 是正实数。完美单向 ABC 的条件是匹配出射波的阻抗，这对应于设置 $s = i k_n$。由此得出 $R = \\frac{ik_n - ik_n}{ik_n + ik_n} = 0$。\n- **倏逝波 ($k_x > k$)：** 此处 $k_n = i\\alpha$。防止虚假生成增长模式的条件是 $s = -\\alpha$。\n\n我们寻求一个在两种情况下都正确的、统一的 $s$ 表达式。我们注意到，在倏逝波的情况下，$s = -\\alpha = i(i\\alpha) = i k_n$。\n因此，选择\n$$\ns = i k_n\n$$\n是理想的校正缩放，它对 **所有** $k_x$ 值都有效。它能完美吸收任何入射的平面波，无论是传播波还是倏逝波。这就是问题中提到的“运动学缩放选择”。\n\n我们将其与“朴素”的 Sommerfeld 型选择 $s = i k$进行对比，后者与入射角（即 $k_x$）无关。对于这种朴素选择，反射系数为：\n$$\nR_{\\text{naive}} = \\frac{i k_n - i k}{i k + i k_n} = \\frac{k_n - k}{k_n + k}.\n$$\n- 对于传播波 ($k_x  k$)，$k_n = \\sqrt{k^2 - k_x^2}$ 是实数且 $0  k_n \\le k$。因此，$R_{\\text{naive}} \\neq 0$（除非 $k_x=0$，此时 $k_n=k$ 且 $R=0$）。\n- 对于倏逝波 ($k_x > k$)，$k_n = i\\alpha$ 是纯虚数。反射系数变为 $R_{\\text{naive}} = \\frac{i\\alpha - k}{i\\alpha + k}$。其幅值为：\n$$\n|R_{\\text{naive}}| = \\left| \\frac{-k + i\\alpha}{k + i\\alpha} \\right| = \\frac{\\sqrt{(-k)^2 + \\alpha^2}}{\\sqrt{k^2 + \\alpha^2}} = 1.\n$$\n这表明，朴素的 ABC 对所有倏逝模式都表现为完美反射体，这是一个非常不希望出现的人为效应。\n\n计算测试将比较朴素选择 ($s=ik$) 和缩放选择 ($s=ik_n$) 下的 $|R|$。对于缩放选择，根据推导，所有情况下都有 $|R_{\\text{scaled}}|=0$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the reflection coefficient magnitude for a first-order ABC\n    under two different parameterizations (naive and scaled) for a suite of test cases.\n    \"\"\"\n    # Test suite: each tuple is (frequency f [Hz], wave speed c [m/s], ray parameter ratio r = kx/k)\n    test_cases = [\n        (10, 1500, 0.0),    # Normal incidence, propagating\n        (10, 1500, 0.8),    # Oblique incidence, propagating\n        (10, 1500, 0.999),  # Near-grazing, propagating\n        (10, 1500, 1.001),  # Slightly evanescent\n        (10, 1500, 1.2),    # Evanescent\n        (20, 2000, 1.5),    # Strongly evanescent\n    ]\n\n    results = []\n\n    for f, c, r in test_cases:\n        # Calculate primary physical quantities\n        # k: total wavenumber in rad/m\n        # kx: tangential wavenumber in rad/m\n        k = 2.0 * np.pi * f / c\n        kx = r * k\n\n        # Calculate the squared normal wavenumber\n        # This can be negative for evanescent waves\n        kn_squared = k**2 - kx**2\n\n        # Calculate the normal wavenumber kn, enforcing the Im(kn) >= 0 convention.\n        # np.sqrt on a complex number returns the principal root, which automatically\n        # satisfies this convention for real arguments (positive or negative).\n        kn = np.sqrt(kn_squared + 0j)\n\n        # 1. Compute reflection for the naive choice: s = i*k\n        # The reflection coefficient is R = (k_n - k) / (k_n + k)\n        # The denominator k_n + k is zero only if k=0 (not in tests) or k_n = -k.\n        # Since Im(kn) >= 0 and Re(kn) >= 0, and k > 0, this cannot happen.\n        R_naive_num = kn - k\n        R_naive_den = kn + k\n        R_naive = R_naive_num / R_naive_den\n        abs_R_naive = np.abs(R_naive)\n\n        # 2. Compute reflection for the kinematically scaled choice: s = i*k_n\n        # The reflection coefficient is R = (i*k_n - s) / (s + i*k_n).\n        # With s = i*k_n, the numerator becomes zero, so R = 0, provided k_n is not zero.\n        # If k_n is zero (critical incidence, r=1), the formula is 0/0, but the limit is 0.\n        # Thus, the reflection is always zero for the scaled choice.\n        abs_R_scaled = 0.0\n\n        results.append(round(abs_R_naive, 6))\n        results.append(round(abs_R_scaled, 6))\n\n    # Format the final output string as required\n    print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}