{
    "hands_on_practices": [
        {
            "introduction": "This first exercise grounds our study in the most fundamental scenario: a normally incident acoustic wave. By deriving the reflection and transmission coefficients from first principles, you will directly connect the material properties of density ($\\rho$) and velocity ($c$) to the concept of acoustic impedance ($Z = \\rho c$). This practice is essential for building intuition about how impedance contrast governs wave partitioning at an interface, a concept that underpins all seismic reflection interpretation. ",
            "id": "3613488",
            "problem": "A plane, time-harmonic, normally incident compressional (acoustic) wave in medium $1$ encounters a planar interface with medium $2$ at $x=0$. Assume the linear acoustic approximation with no mode conversion, and that both media are homogeneous, isotropic, and lossless. Let the mass densities be $\\rho_{1}$ and $\\rho_{2}$, the compressional wave speeds be $c_{1}$ and $c_{2}$, and the acoustic impedances be $Z_{1}=\\rho_{1} c_{1}$ and $Z_{2}=\\rho_{2} c_{2}$. The incident wave travels in the $+x$ direction from medium $1$ toward medium $2$. The amplitude reflection coefficient $R$ and amplitude transmission coefficient $T$ are defined with respect to pressure amplitudes as the complex ratios of reflected-to-incident and transmitted-to-incident pressure amplitudes, respectively.\n\nStarting from the linearized equations of motion and mass conservation for acoustics, together with the continuity of pressure and normal particle velocity at $x=0$, derive expressions for $R$ and $T$ at normal incidence. Then evaluate $R$ and $T$ for the specific material properties\n$\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$, $c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$, $\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$, and $c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$. Briefly interpret the sign of $R$ for the case $Z_{2}<Z_{1}$ in terms of phase reversal of the reflected pressure.\n\nReport the final numerical values of $R$ and $T$ as dimensionless amplitude ratios, rounded to four significant figures, in the form of a row matrix $\\begin{pmatrix} R  T \\end{pmatrix}$. Do not include units in the final reported values.",
            "solution": "The problem posed is valid. It is a standard, well-posed problem in linear acoustics and wave propagation, grounded in fundamental physical principles. It is self-contained, with all necessary data and conditions provided, and free from any scientific or logical inconsistencies. We may therefore proceed with a formal solution.\n\nThe derivation begins with the one-dimensional linearized equations for acoustic waves in a homogeneous, lossless fluid. The equation of motion (Euler's equation) is:\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}\n$$\nand the equation of mass conservation, combined with the constitutive relation for a fluid, is:\n$$\n\\frac{1}{\\rho c^2} \\frac{\\partial p}{\\partial t} = -\\frac{\\partial v_x}{\\partial x}\n$$\nHere, $p$ is the acoustic pressure, $v_x$ is the particle velocity in the $x$-direction, $\\rho$ is the mass density, $c$ is the wave speed, $t$ is time, and $x$ is the spatial coordinate.\n\nWe seek time-harmonic solutions of the form $p(x,t) = P(x)e^{-i\\omega t}$ and $v_x(x,t) = V_x(x)e^{-i\\omega t}$, where $\\omega$ is the angular frequency. Substituting these forms into the governing equations yields:\n$$\n-i\\omega \\rho V_x(x) = -\\frac{d P(x)}{dx}\n$$\n$$\n-i\\omega \\frac{1}{\\rho c^2} P(x) = -\\frac{d V_x(x)}{dx}\n$$\nThese can be combined to form the Helmholtz equation for pressure, $\\frac{d^2 P(x)}{dx^2} + k^2 P(x) = 0$, where $k = \\omega/c$ is the wavenumber. The general solutions describe plane waves traveling in the $+x$ and $-x$ directions.\n\nIn medium $1$ ($x0$), we have an incident wave traveling in the $+x$ direction and a reflected wave traveling in the $-x$ direction. The total pressure field is the superposition of these two waves:\n$$\np_1(x,t) = P_I e^{i(k_1 x - \\omega t)} + P_R e^{i(-k_1 x - \\omega t)}\n$$\nwhere $k_1 = \\omega/c_1$. $P_I$ is the complex amplitude of the incident pressure wave and $P_R$ is the complex amplitude of the reflected pressure wave.\n\nIn medium $2$ ($x0$), there is only a transmitted wave traveling in the $+x$ direction:\n$$\np_2(x,t) = P_T e^{i(k_2 x - \\omega t)}\n$$\nwhere $k_2 = \\omega/c_2$ and $P_T$ is the complex amplitude of the transmitted pressure wave.\n\nNext, we derive the expressions for particle velocity. From the equation of motion, $V_x(x) = \\frac{1}{i\\omega\\rho} \\frac{dP(x)}{dx}$. Applying this to the pressure fields in each medium:\nFor medium $1$:\n$$\nv_{x1}(x,t) = \\frac{1}{i\\omega\\rho_1} \\frac{\\partial}{\\partial x} \\left( P_I e^{ik_1 x} + P_R e^{-ik_1 x} \\right) e^{-i\\omega t} = \\frac{k_1}{\\omega\\rho_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\nUsing $k_1 = \\omega/c_1$ and the definition of acoustic impedance $Z_1 = \\rho_1 c_1$, this simplifies to:\n$$\nv_{x1}(x,t) = \\frac{1}{Z_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\nFor medium $2$:\n$$\nv_{x2}(x,t) = \\frac{1}{i\\omega\\rho_2} \\frac{\\partial}{\\partial x} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t} = \\frac{k_2}{\\omega\\rho_2} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t}\n$$\nUsing $k_2 = \\omega/c_2$ and $Z_2 = \\rho_2 c_2$, this simplifies to:\n$$\nv_{x2}(x,t) = \\frac{1}{Z_2} P_T e^{ik_2 x} e^{-i\\omega t}\n$$\nAt the interface $x=0$, the physical boundary conditions require the continuity of pressure and the continuity of the normal component of particle velocity.\n$1$. $p_1(0,t) = p_2(0,t)$\n$2$. $v_{x1}(0,t) = v_{x2}(0,t)$\n\nApplying the first boundary condition at $x=0$:\n$$\nP_I e^{0} + P_R e^{0} = P_T e^{0} \\implies P_I + P_R = P_T\n$$\nApplying the second boundary condition at $x=0$:\n$$\n\\frac{1}{Z_1} \\left( P_I e^{0} - P_R e^{0} \\right) = \\frac{1}{Z_2} P_T e^{0} \\implies \\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2} P_T\n$$\nWe now have a system of two linear equations. We solve for the amplitude reflection coefficient $R = P_R/P_I$ and the amplitude transmission coefficient $T = P_T/P_I$.\nSubstitute $P_T = P_I + P_R$ into the second equation:\n$$\n\\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2}(P_I + P_R)\n$$\nMultiply by $Z_1 Z_2$ to clear the denominators:\n$$\nZ_2(P_I - P_R) = Z_1(P_I + P_R)\n$$\n$$\nZ_2 P_I - Z_2 P_R = Z_1 P_I + Z_1 P_R\n$$\nGroup terms with $P_I$ and $P_R$:\n$$\nP_I(Z_2 - Z_1) = P_R(Z_1 + Z_2)\n$$\nSolving for the reflection coefficient $R = P_R/P_I$:\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2}\n$$\nTo find the transmission coefficient $T = P_T/P_I$, we use the relation $P_T = P_I + P_R$. Dividing by $P_I$ gives $T = 1 + R$:\n$$\nT = 1 + \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{(Z_1 + Z_2) + (Z_2 - Z_1)}{Z_1 + Z_2} = \\frac{2 Z_2}{Z_1 + Z_2}\n$$\nNow, we evaluate these expressions for the given material properties:\n$\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$, $c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$\n$\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$, $c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$\n\nFirst, calculate the acoustic impedances $Z_1$ and $Z_2$:\n$$\nZ_1 = \\rho_1 c_1 = (2900)(6000) = 17,400,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 1.74 \\times 10^7\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\n$$\nZ_2 = \\rho_2 c_2 = (1800)(2000) = 3,600,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 3.6 \\times 10^6\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\nNow, calculate $R$ and $T$:\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{3.6 \\times 10^6 - 17.4 \\times 10^6}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{-13.8 \\times 10^6}{21.0 \\times 10^6} = -\\frac{13.8}{21.0} \\approx -0.6571428...\n$$\n$$\nT = \\frac{2 Z_2}{Z_1 + Z_2} = \\frac{2 \\times (3.6 \\times 10^6)}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{7.2 \\times 10^6}{21.0 \\times 10^6} = \\frac{7.2}{21.0} \\approx 0.3428571...\n$$\nRounding to four significant figures, we get $R = -0.6571$ and $T = 0.3429$.\n\nFinally, we interpret the sign of $R$ for the case $Z_2  Z_1$, which holds for the given numerical values. The reflection coefficient $R = P_R/P_I$ is the ratio of complex pressure amplitudes. A negative real value for $R$ signifies a phase shift of $\\pi$ radians ($180^\\circ$) between the reflected pressure wave and the incident pressure wave at the boundary, because $P_R = R P_I = -|R| P_I$. In the complex plane, multiplication by $-1$ is equivalent to a rotation by $\\pi$. Thus, when an acoustic wave reflects off an interface with a medium of lower acoustic impedance, the reflected pressure wave undergoes a phase reversal. This is analogous to a mechanical wave on a string reflecting from a free end.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.6571  0.3429\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building upon the normal incidence case, we now introduce the effect of an oblique angle of approach. This practice requires you to work with slowness vectors, a cornerstone of modern seismology, to derive angle-dependent reflection coefficients. Moreover, by examining incidence from both sides of the interface, you will numerically verify the principle of reciprocity, a profound and elegant symmetry in wave physics that serves as a powerful tool for validating numerical codes. ",
            "id": "3613481",
            "problem": "Consider a single, planar interface at $z=0$ separating two homogeneous, isotropic acoustic fluids, labeled medium $1$ for $z0$ and medium $2$ for $z0$. Each medium is characterized by density $\\rho$ (in $\\mathrm{kg/m^3}$) and compressional (acoustic) wave speed $c$ (in $\\mathrm{m/s}$). A time-harmonic plane wave with angular frequency $\\omega$ propagates in the $x$-$z$ plane, with horizontal slowness $p$ (in $\\mathrm{s/m}$), so that the phase is $\\omega \\left(p x + q z - t\\right)$, where $q$ is the vertical slowness satisfying the dispersion relation. Assume lossless media and no mode conversion other than reflection and transmission of acoustic waves. All angles appearing in intermediate derivations are in radians.\n\nStarting from first principles appropriate to computational geophysics, use the following base:\n- The acoustic constitutive relation and equation of motion linking pressure $p(x,z,t)$ and particle velocity $\\mathbf{v}(x,z,t)$ through the sound speed $c$ and density $\\rho$, together with plane-wave solutions in homogeneous media.\n- Boundary conditions of continuity of pressure and continuity of the normal component of particle velocity at the interface $z=0$.\n- Snell's law for plane waves at an interface expressed in slowness form: the horizontal slowness $p$ is conserved across the interface.\n\nDefine the vertical slowness in medium $j\\in\\{1,2\\}$ for the acoustic wave as\n$$\nq_j = \\sqrt{\\frac{1}{c_j^2} - p^2},\n$$\nand the cosine of the incidence/transmission angle (with respect to the interface normal) as\n$$\n\\cos\\theta_j = c_j q_j = \\sqrt{1 - \\left(p c_j\\right)^2}.\n$$\nDefine the angle-dependent normal specific acoustic impedance in medium $j$ as\n$$\nZ_j^{(n)} = \\frac{\\rho_j c_j}{\\cos\\theta_j}.\n$$\n\nTasks:\n1. Derive from the boundary conditions and plane-wave kinematics the pressure reflection coefficient for incidence from medium $1$ onto medium $2$, denoted $R_{12}(p)$, and the pressure reflection coefficient for incidence from medium $2$ onto medium $1$, denoted $R_{21}(p)$, both at the same horizontal slowness $p$.\n2. Using reciprocity and careful sign accounting for the direction of the normal component of particle velocity, show the appropriate normalization needed to numerically cross-check reflectivities computed from opposite sides. In particular, explain why comparing $R_{12}(p)$ with $-R_{21}(p)$ is the correct reciprocity-based normalization for pressure reflectivity at an interface, and why this comparison should yield equality in ideal, lossless acoustics for all admissible $p$.\n3. Implement a program that, for each provided test case, computes $R_{12}(p)$ and $R_{21}(p)$ using the physically valid expressions derived from the base principles above and then evaluates the absolute difference\n$$\n\\Delta(p) = \\left|R_{12}(p) - \\left(-R_{21}(p)\\right)\\right|.\n$$\nYour program should return $\\Delta(p)$ as a floating-point number for each test case.\n\nImportant implementation details:\n- Use the slowness-based expressions to compute $\\cos\\theta_j = \\sqrt{1 - \\left(p c_j\\right)^2}$; to ensure scientific realism, only cases with $p  \\min\\left\\{\\frac{1}{c_1},\\frac{1}{c_2}\\right\\}$ should be included in the test suite so that both $\\cos\\theta_1$ and $\\cos\\theta_2$ are real and nonnegative, corresponding to propagating waves in both media without evanescence.\n- The reflection coefficients are dimensionless; return the absolute differences $\\Delta(p)$ as dimensionless floats.\n- Numerical angles are implicit through $\\cos\\theta_j$; if any angle were to be explicitly reported, it would be in radians. No angle needs to be output.\n- The final output must be a single line containing the results for all test cases as a comma-separated list enclosed in square brackets, for example, `[0.0,0.0,0.0]`.\n\nTest suite:\nCompute $\\Delta(p)$ for the following scientifically plausible cases (all parameters in $\\mathrm{kg/m^3}$, $\\mathrm{m/s}$, and $p$ in $\\mathrm{s/m}$):\n- Case $1$ (general contrast, oblique incidence): $(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2200,1800,0.0002)$.\n- Case $2$ (normal incidence): $(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2200,1800,0.0)$.\n- Case $3$ (identical media): $(\\rho_1,c_1,\\rho_2,c_2,p) = (2000,2500,2000,2500,0.0001)$.\n- Case $4$ (near critical in the faster medium, still propagating): $(\\rho_1,c_1,\\rho_2,c_2,p) = (1800,1800,2200,2500,0.000399)$.\n- Case $5$ (strong impedance contrast, oblique incidence): $(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2700,6000,0.00015)$.\n\nAnswer specification:\n- For each case, compute $\\Delta(p)$ to full double-precision accuracy and return it as a float.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[Δ₁,Δ₂,Δ₃,Δ₄,Δ₅]`, with no extra whitespace or commentary.",
            "solution": "The problem requires the derivation and numerical verification of the pressure reflection coefficients at a planar interface between two acoustic fluid media. The solution will proceed in three parts as requested: first, the derivation of the reflection coefficients $R_{12}(p)$ and $R_{21}(p)$; second, an explanation of the reciprocity relationship between them; and third, the design of a numerical algorithm to verify this relationship.\n\n### Part 1: Derivation of Reflection Coefficients\n\nWe begin from the first principles of acoustic wave propagation in a fluid. The relationship between the pressure field $P$ and the particle velocity field $\\mathbf{v}$ for a time-harmonic plane wave is governed by the linearized equation of motion, $\\rho \\frac{\\partial \\mathbf{v}}{\\partial t} = -\\nabla P$. For a plane wave of the form $P(x,z,t) = P_0 e^{i\\omega(px + qz - t)}$, where $p$ is the horizontal slowness and $q$ is the vertical slowness, the gradient is $\\nabla P = i\\omega(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$. The time derivative of velocity is $\\frac{\\partial \\mathbf{v}}{\\partial t} = -i\\omega\\mathbf{v}$. Substituting these into the equation of motion yields:\n$\\rho(-i\\omega\\mathbf{v}) = -i\\omega(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$\n$\\mathbf{v} = \\frac{1}{\\rho}(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$\n\nThe component of particle velocity normal to the interface at $z=0$ is the $z$-component, $v_z$:\n$v_z = \\frac{q}{\\rho} P$\n\nThe sign of $q$ determines the direction of vertical propagation. We adopt the convention that $q_j = \\sqrt{1/c_j^2 - p^2}$ is positive for a wave propagating in the $+z$ direction (downgoing), and the vertical phase term is $e^{i\\omega q_j z}$. A wave propagating in the $-z$ direction (upgoing) has a vertical phase term $e^{-i\\omega q_j z}$, which corresponds to a vertical slowness of $-q_j$.\n\n**Derivation of $R_{12}(p)$: Incidence from Medium 1**\n\nFor incidence from medium $1$ ($z0$) to medium $2$ ($z0$), the total wavefield consists of an incident wave ($I$) and a reflected wave ($R$) in medium $1$, and a transmitted wave ($T$) in medium $2$.\n\nIn medium $1$ ($z0$):\nThe pressure is $P_1 = P_I + P_R$. The incident wave is downgoing ($+q_1$) and the reflected wave is upgoing ($-q_1$).\n$P_1(x,z,t) = \\left( A_I e^{i\\omega q_1 z} + A_R e^{-i\\omega q_1 z} \\right) e^{i\\omega(px - t)}$\nThe normal velocity $v_{z,1}$ is the sum of contributions from the incident and reflected waves:\n$v_{z,1} = \\frac{q_1}{\\rho_1} P_I + \\frac{-q_1}{\\rho_1} P_R = \\frac{q_1}{\\rho_1} (P_I - P_R) = \\frac{q_1}{\\rho_1} \\left( A_I e^{i\\omega q_1 z} - A_R e^{-i\\omega q_1 z} \\right) e^{i\\omega(px - t)}$\n\nIn medium $2$ ($z0$):\nThe pressure $P_2 = P_T$ consists of only the downgoing ($+q_2$) transmitted wave.\n$P_2(x,z,t) = A_T e^{i\\omega q_2 z} e^{i\\omega(px - t)}$\nThe normal velocity $v_{z,2}$ is:\n$v_{z,2} = \\frac{q_2}{\\rho_2} P_T = \\frac{q_2}{\\rho_2} A_T e^{i\\omega q_2 z} e^{i\\omega(px - t)}$\n\nThe boundary conditions at the interface $z=0$ are continuity of pressure ($P_1=P_2$) and continuity of normal particle velocity ($v_{z,1}=v_{z,2}$).\n$1$. $P_1(z=0) = P_2(z=0) \\implies A_I + A_R = A_T$\n$2$. $v_{z,1}(z=0) = v_{z,2}(z=0) \\implies \\frac{q_1}{\\rho_1}(A_I - A_R) = \\frac{q_2}{\\rho_2}A_T$\n\nThe pressure reflection coefficient is $R_{12}(p) = A_R / A_I$. Substituting $A_T$ from the first equation into the second:\n$\\frac{q_1}{\\rho_1}(A_I - A_R) = \\frac{q_2}{\\rho_2}(A_I + A_R)$\nDividing by $A_I$:\n$\\frac{q_1}{\\rho_1}(1 - R_{12}) = \\frac{q_2}{\\rho_2}(1 + R_{12})$\nRearranging to solve for $R_{12}$:\n$\\frac{q_1}{\\rho_1} - \\frac{q_2}{\\rho_2} = R_{12} \\left(\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}\\right) \\implies R_{12}(p) = \\frac{\\frac{q_1}{\\rho_1} - \\frac{q_2}{\\rho_2}}{\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}}$\n\nUsing the problem's definition of angle-dependent normal specific acoustic impedance, $Z_j^{(n)} = \\frac{\\rho_j c_j}{\\cos\\theta_j} = \\frac{\\rho_j c_j}{c_j q_j} = \\frac{\\rho_j}{q_j}$, we can write $\\frac{q_j}{\\rho_j} = \\frac{1}{Z_j^{(n)}}$.\nSubstituting this into the expression for $R_{12}$:\n$$\nR_{12}(p) = \\frac{\\frac{1}{Z_1^{(n)}} - \\frac{1}{Z_2^{(n)}}}{\\frac{1}{Z_1^{(n)}} + \\frac{1}{Z_2^{(n)}}} = \\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}\n$$\n\n**Derivation of $R_{21}(p)$: Incidence from Medium 2**\n\nNow, the incident wave is in medium $2$, propagating upwards ($-z$ direction).\nIn medium $2$ ($z0$):\nThe incident wave is upgoing ($-q_2$), and the reflected wave is downgoing ($+q_2$).\n$P_2(x,z,t) = \\left( A'_I e^{-i\\omega q_2 z} + A'_R e^{i\\omega q_2 z} \\right) e^{i\\omega(px - t)}$\n$v_{z,2} = \\frac{-q_2}{\\rho_2}P'_I + \\frac{q_2}{\\rho_2}P'_R = \\frac{q_2}{\\rho_2}(-A'_I e^{-i\\omega q_2 z} + A'_R e^{i\\omega q_2 z}) e^{i\\omega(px - t)}$\n\nIn medium $1$ ($z0$):\nThe transmitted wave is upgoing ($-q_1$).\n$P_1(x,z,t) = A'_T e^{-i\\omega q_1 z} e^{i\\omega(px - t)}$\n$v_{z,1} = \\frac{-q_1}{\\rho_1}P'_T = \\frac{-q_1}{\\rho_1}A'_T e^{-i\\omega q_1 z} e^{i\\omega(px - t)}$\n\nApplying boundary conditions at $z=0$:\n$1$. $P_1(z=0) = P_2(z=0) \\implies A'_T = A'_I + A'_R$\n$2$. $v_{z,1}(z=0) = v_{z,2}(z=0) \\implies \\frac{-q_1}{\\rho_1} A'_T = \\frac{q_2}{\\rho_2}(-A'_I + A'_R)$\n\nThe reflection coefficient is $R_{21}(p) = A'_R / A'_I$. Substituting for $A'_T$:\n$\\frac{-q_1}{\\rho_1}(A'_I + A'_R) = \\frac{q_2}{\\rho_2}(-A'_I + A'_R)$\nDividing by $A'_I$:\n$\\frac{-q_1}{\\rho_1}(1 + R_{21}) = \\frac{q_2}{\\rho_2}(-1 + R_{21})$\nRearranging:\n$\\frac{q_2}{\\rho_2} - \\frac{q_1}{\\rho_1} = R_{21}\\left(\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}\\right) \\implies R_{21}(p) = \\frac{\\frac{q_2}{\\rho_2} - \\frac{q_1}{\\rho_1}}{\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}}$\n\nIn terms of normal impedances:\n$$\nR_{21}(p) = \\frac{\\frac{1}{Z_2^{(n)}} - \\frac{1}{Z_1^{(n)}}}{\\frac{1}{Z_1^{(n)}} + \\frac{1}{Z_2^{(n)}}} = \\frac{Z_1^{(n)} - Z_2^{(n)}}{Z_1^{(n)} + Z_2^{(n)}}\n$$\n\n### Part 2: Reciprocity and Normalization\n\nBy comparing the derived expressions for the two reflection coefficients:\n$R_{12}(p) = \\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}$\n$R_{21}(p) = \\frac{Z_1^{(n)} - Z_2^{(n)}}{Z_1^{(n)} + Z_2^{(n)}} = -\\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}$\n\nIt is immediately apparent that for any pair of media and any admissible horizontal slowness $p$:\n$$\nR_{12}(p) = -R_{21}(p)\n$$\nThis fundamental relationship, sometimes known as a Stokes relation, is a direct consequence of the reciprocity principle in wave physics. The physical setup for measuring $R_{21}$ is kinematically reversed compared to that for $R_{12}$. The incident wave direction relative to the interface normal is opposite (upgoing vs. downgoing). This reversal of the geometric arrangement of incident and reflected waves, while keeping the coordinate system fixed, introduces a sign change into the boundary condition for normal velocity, which propagates through the derivation to yield a sign change in the reflection coefficient itself.\n\nTherefore, the correct way to cross-check reflectivities computed from opposite sides is to verify the equality $R_{12}(p) = -R_{21}(p)$, or equivalently, $R_{12}(p) + R_{21}(p) = 0$. The evaluation of $\\Delta(p) = |R_{12}(p) - (-R_{21}(p))| = |R_{12}(p) + R_{21}(p)|$ provides a numerical test of this identity. For lossless media and exact arithmetic, $\\Delta(p)$ must be identically zero. Within a numerical implementation, its value serves as a stringent test of the correctness of the formulas and their translation into code, as it should be zero up to the limits of floating-point precision.\n\n### Part 3: Algorithm Implementation\n\nThe program will compute $\\Delta(p)$ for each test case by implementing the derived formulas. For a given set of parameters $(\\rho_1, c_1, \\rho_2, c_2, p)$:\n$1$. Calculate the square of the vertical slowness for each medium: $q_j^2 = (1/c_j)^2 - p^2$. The problem statement guarantees $p  \\min(1/c_1, 1/c_2)$, so $q_j^2$ is positive.\n$2$. Calculate the vertical slowness $q_j = \\sqrt{q_j^2}$.\n$3$. Calculate the angle-dependent normal specific acoustic impedance for each medium: $Z_j^{(n)} = \\rho_j / q_j$.\n$4$. Calculate the reflection coefficients $R_{12}(p)$ and $R_{21}(p)$ using the impedance-based formulas:\n   $R_{12}(p) = (Z_2^{(n)} - Z_1^{(n)}) / (Z_2^{(n)} + Z_1^{(n)})$\n   $R_{21}(p) = (Z_1^{(n)} - Z_2^{(n)}) / (Z_1^{(n)} + Z_2^{(n)})$\n$5$. Compute the absolute difference $\\Delta(p) = |R_{12}(p) + R_{21}(p)|$.\nThis process is repeated for all test cases, and the results are collected into a list.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute difference |R_12(p) - (-R_21(p))| for a series of test cases\n    involving acoustic wave reflection at a planar interface.\n    \"\"\"\n\n    # test_cases are tuples of (rho1, c1, rho2, c2, p)\n    # Units: rho in kg/m^3, c in m/s, p in s/m\n    test_cases = [\n        # Case 1 (general contrast, oblique incidence)\n        (1000, 1500, 2200, 1800, 0.0002),\n        # Case 2 (normal incidence)\n        (1000, 1500, 2200, 1800, 0.0),\n        # Case 3 (identical media)\n        (2000, 2500, 2000, 2500, 0.0001),\n        # Case 4 (near critical in the faster medium, still propagating)\n        (1800, 1800, 2200, 2500, 0.000399),\n        # Case 5 (strong impedance contrast, oblique incidence)\n        (1000, 1500, 2700, 6000, 0.00015),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho1, c1, rho2, c2, p = case\n        \n        # Calculate square of horizontal slowness\n        p_sq = p**2\n        \n        # Calculate square of vertical slowness for each medium.\n        # The problem statement guarantees that the arguments to the square root\n        # will be positive (p  min(1/c1, 1/c2)).\n        q1_sq = (1.0/c1)**2 - p_sq\n        q2_sq = (1.0/c2)**2 - p_sq\n        \n        # Calculate vertical slowness\n        q1 = np.sqrt(q1_sq)\n        q2 = np.sqrt(q2_sq)\n        \n        # Calculate angle-dependent normal specific acoustic impedance\n        # Z_j^(n) = rho_j / q_j\n        # This is equivalent to the provided definition:\n        # Z_j^(n) = (rho_j * c_j) / sqrt(1 - (p * c_j)^2)\n        z1_n = rho1 / q1\n        z2_n = rho2 / q2\n        \n        # Calculate the pressure reflection coefficient for incidence from medium 1 to 2\n        # R_12(p) = (Z_2^(n) - Z_1^(n)) / (Z_2^(n) + Z_1^(n))\n        r12 = (z2_n - z1_n) / (z2_n + z1_n)\n        \n        # Calculate the pressure reflection coefficient for incidence from medium 2 to 1\n        # R_21(p) = (Z_1^(n) - Z_2^(n)) / (Z_1^(n) + Z_2^(n))\n        r21 = (z1_n - z2_n) / (z1_n + z2_n)\n        \n        # Evaluate the absolute difference described in the problem.\n        # This tests the reciprocity relation R_12(p) = -R_21(p).\n        # Analytically, delta should be zero. Numerically, it should be zero\n        # or a value very close to machine precision.\n        delta = abs(r12 - (-r21))\n        \n        results.append(delta)\n\n    # Format the final output as a comma-separated list in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice moves from the simplified acoustic approximation to the full elastic reality of the Earth's subsurface, where mode conversions between P-waves and S-waves are critical. You are tasked with implementing the complete Zoeppritz equations, which form the theoretical basis for Amplitude Versus Offset (AVO) analysis. This exercise will challenge you to handle the computational complexities of post-critical reflections and evanescent waves, a crucial skill for any computational geophysicist modeling realistic wave phenomena. ",
            "id": "3613464",
            "problem": "You are tasked with building a complete, runnable program that computes the complex amplitude reflection and transmission coefficients for plane-wave P-SV coupling at a planar interface between two homogeneous, isotropic, linear-elastic half-spaces using the full Zoeppritz equations. The solver must be stable when crossing the transmitted P-wave critical angle, where the transmitted angle becomes complex because $\\sin\\theta_t > 1$. You must implement a mathematically principled continuation strategy through this regime that respects the physical outgoing-wave condition, and you must test the numerical stability and branch choices for complex transmitted angles. Angles must be specified in radians. All physical quantities must use the International System of Units.\n\nFundamental base to use:\n- Linear elasticity for isotropic media with Lamé parameters $\\lambda$ and $\\mu$, mass density $\\rho$, compressional-wave speed $\\alpha$, and shear-wave speed $\\beta$, related by $\\mu=\\rho\\beta^2$ and $\\lambda=\\rho\\alpha^2-2\\mu$.\n- Plane-wave kinematics with horizontal slowness $p$ and vertical slowness $q$, where for a wave of speed $v$,\n$$\np=\\frac{\\sin\\theta}{\\alpha_1}\\quad\\text{for an incident P-wave at angle }\\theta\\text{ in the top medium},\n$$\nand\n$$\nq(v,p)=\\sqrt{\\frac{1}{v^2}-p^2},\n$$\nwith the square root taken in the complex plane so that for $p > 1/v$ (evanescent regime) the branch yields $q$ with positive imaginary part for downgoing waves. The vertical coordinate increases downward, the interface is at $z=0$, and the plane-wave phase is $e^{i\\omega(px+szqz)}$ with $s=+1$ for downgoing and $s=-1$ for upgoing constituents.\n\nYou must derive and implement the boundary conditions at the interface based on continuity of displacement components $u_x$, $u_z$ and continuity of traction components $\\sigma_{xz}$, $\\sigma_{zz}$. For two half-spaces labeled $1$ (top) and $2$ (bottom), for an incident P-wave of unit potential amplitude in medium $1$, define the unknown complex amplitude coefficients:\n- $R_{PP}$: upgoing reflected P-wave in medium $1$,\n- $R_{PS}$: upgoing reflected SV-wave in medium $1$,\n- $T_{PP}$: downgoing transmitted P-wave in medium $2$,\n- $T_{PS}$: downgoing transmitted SV-wave in medium $2$.\n\nUsing scalar potentials $\\phi$ for P and $\\psi$ for SV, the plane-wave displacement and traction contributions for a constituent with sign $s\\in\\{+1,-1\\}$ are\n$u_x = i\\omega(p\\,\\phi - s\\,q\\,\\psi)$, $u_z = i\\omega(s\\,q\\,\\phi + p\\,\\psi)$,\n$$\n\\sigma_{xz} = -\\mu\\,\\omega^2\\left(2p\\,s\\,q\\,\\phi + \\left(p^2-(s\\,q)^2\\right)\\psi\\right),\\quad\n\\sigma_{zz} = -\\omega^2\\left(\\left((\\lambda+2\\mu)(s\\,q)^2+\\lambda p^2\\right)\\phi + 2\\mu p\\,s\\,q\\,\\psi\\right).\n$$\nBy superposition of the incident and scattered constituents and enforcing boundary conditions at $z=0$, you must form and solve a $4\\times 4$ complex linear system for $[R_{PP},R_{PS},T_{PP},T_{PS}]^\\top$. Express the system using the horizontal slowness $p$, vertical slownesses $q_{1P},q_{1S},q_{2P},q_{2S}$, Lamé parameters $(\\lambda_1,\\mu_1)$ and $(\\lambda_2,\\mu_2)$, and densities $(\\rho_1,\\rho_2)$. The four scalar equations to assemble are:\n1. Continuity of $u_x$:\n$p(1+R_{PP}) + q_{1S}R_{PS} = p\\,T_{PP} - q_{2S}T_{PS}.$\n2. Continuity of $u_z$:\n$q_{1P}(1 - R_{PP}) + p\\,R_{PS} = q_{2P}T_{PP} + p\\,T_{PS}.$\n3. Continuity of $\\sigma_{xz}$:\n$\\mu_1\\left(2p\\,q_{1P}R_{PP} - (p^2-q_{1S}^2)R_{PS}\\right) + \\mu_2\\left(2p\\,q_{2P}T_{PP} + (p^2-q_{2S}^2)T_{PS}\\right) = \\mu_1(2p\\,q_{1P}).$\n4. Continuity of $\\sigma_{zz}$:\n$-\\left((\\lambda_1+2\\mu_1)q_{1P}^2 + \\lambda_1 p^2\\right)(1+R_{PP}) + 2\\mu_1 p\\,q_{1S} R_{PS} + \\left((\\lambda_2+2\\mu_2)q_{2P}^2 + \\lambda_2 p^2\\right)T_{PP} + 2\\mu_2 p\\,q_{2S}T_{PS} = 0.$\n\nAlgorithmic requirements:\n- Use complex arithmetic throughout so that $q(v,p)$ is robust across the critical angle.\n- Implement a branch-selection strategy for $q(v,p)$ that yields $\\operatorname{Im}(q)\\ge 0$ in the evanescent regime, ensuring physically acceptable downgoing decay in medium $2$ and consistent upgoing behavior in medium $1$ via the sign $s$ in the formulas.\n- Solve the $4\\times 4$ system with a numerically stable method. If the matrix is ill-conditioned near the critical angle, use a least-squares fallback.\n\nUnits and angle conventions:\n- $\\alpha$, $\\beta$ in $\\text{m/s}$,\n- $\\rho$ in $\\text{kg/m}^3$,\n- angles in radians,\n- the returned coefficients are dimensionless complex amplitudes.\n\nTest suite:\nYour program must evaluate the solver for the following six parameter sets $(\\alpha_1, \\beta_1, \\rho_1, \\alpha_2, \\beta_2, \\rho_2, \\theta_1)$, where $\\theta_1$ is the incident P-wave angle in radians in medium $1$.\n1. $(2500, 1200, 2200, 3000, 1500, 2400, 0.8)$: subcritical reference.\n2. $(2500, 1200, 2200, 3000, 1500, 2400, 0.985)$: near transmitted P critical, slightly below.\n3. $(2500, 1200, 2200, 3000, 1500, 2400, 0.995)$: just above transmitted P critical (evanescent $q_{2P}$).\n4. $(3000, 1500, 2200, 3000, 1500, 2200, 0.5)$: identical media sanity check.\n5. $(2000, 1000, 2000, 4000, 2200, 2800, 1.2)$: strong contrast, high angle, supercritical in medium $2$ for P.\n6. $(2500, 1400, 2100, 3200, 1800, 2600, 1.3)$: high angle across moderate contrast.\n\nFinal output specification:\n- For each test case, return the list $[ \\Re(R_{PP}), \\Im(R_{PP}), \\Re(R_{PS}), \\Im(R_{PS}), \\Re(T_{PP}), \\Im(T_{PP}), \\Re(T_{PS}), \\Im(T_{PS}) ]$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list of these lists enclosed in square brackets. For example: `[ [a1,a2,...,a8], [b1,b2,...,b8], ... ]`.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It presents a well-posed, scientifically grounded problem in computational geophysics, based on the established principles of linear elastodynamics. The provided equations, definitions, and parameters are internally consistent and allow for the formulation and solution of a complete physical problem.\n\nThe task is to compute the complex reflection and transmission coefficients for a plane P-wave impinging on a planar boundary between two distinct elastic media. This is governed by the Zoeppritz equations, which arise from enforcing boundary conditions on displacement and traction at the interface. The problem is formulated for P-SV coupled waves, requiring the solution of a $4 \\times 4$ linear system for the four unknown wave amplitudes: reflected P ($R_{PP}$), reflected SV ($R_{PS}$), transmitted P ($T_{PP}$), and transmitted SV ($T_{PS}$).\n\nThe solution proceeds through the following steps:\n\n**1. Kinematic Parameters**\nThe kinematics of all plane waves are linked by Snell's law, which states that the horizontal slowness, $p$, is conserved across the interface. For an incident P-wave in medium $1$ with velocity $\\alpha_1$ at an angle $\\theta_1$ from the normal, the horizontal slowness is:\n$$\np = \\frac{\\sin\\theta_1}{\\alpha_1}\n$$\nThe vertical slowness, $q$, for any wave (P or SV) with velocity $v$ is dependent on $p$:\n$$\nq(v, p) = \\sqrt{\\frac{1}{v^2} - p^2}\n$$\nTo handle post-critical incidence, where $p > 1/v$, the term inside the square root becomes negative, and $q$ becomes imaginary. The calculation must be performed in the complex plane. The physical requirement for a stable solution is that evanescent waves (imaginary $q$) must decay away from the interface. Given the coordinate system where $z$ increases downwards, downgoing transmitted waves in medium $2$ ($z > 0$) must decay for increasing $z$, and upgoing reflected waves in medium $1$ ($z  0$) must decay for decreasing $z$. Both conditions are satisfied by choosing the branch of the complex square root such that $\\operatorname{Im}(q) \\ge 0$. Standard numerical libraries for complex arithmetic, such as NumPy, adhere to this convention for the principal root. We thus define the four required vertical slownesses:\n- Incident/Reflected P-wave in medium 1: $q_{1P} = \\sqrt{1/\\alpha_1^2 - p^2 + 0j}$\n- Reflected SV-wave in medium 1: $q_{1S} = \\sqrt{1/\\beta_1^2 - p^2 + 0j}$\n- Transmitted P-wave in medium 2: $q_{2P} = \\sqrt{1/\\alpha_2^2 - p^2 + 0j}$\n- Transmitted SV-wave in medium 2: $q_{2S} = \\sqrt{1/\\beta_2^2 - p^2 + 0j}$\n\n**2. Formulation of the Linear System**\nThe four boundary conditions (continuity of horizontal displacement $u_x$, vertical displacement $u_z$, shear traction $\\sigma_{xz}$, and normal traction $\\sigma_{zz}$) yield a system of four linear equations. Let the vector of unknown complex amplitudes be $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$. The system can be written in matrix form as $A\\mathbf{x} = \\mathbf{b}$. By rearranging the four equations provided in the problem statement, we identify the components of the matrix $A$ and the vector $\\mathbf{b}$.\n\nFrom continuity of $u_x$:\n$$ p R_{PP} + q_{1S} R_{PS} - p T_{PP} + q_{2S} T_{PS} = -p $$\nFrom continuity of $u_z$:\n$$ -q_{1P} R_{PP} + p R_{PS} - q_{2P} T_{PP} - p T_{PS} = -q_{1P} $$\nFrom continuity of $\\sigma_{xz}$:\n$$ (2\\mu_1 p q_{1P}) R_{PP} - \\mu_1(p^2-q_{1S}^2) R_{PS} + (2\\mu_2 p q_{2P}) T_{PP} + \\mu_2(p^2-q_{2S}^2) T_{PS} = 2\\mu_1 p q_{1P} $$\nFrom continuity of $\\sigma_{zz}$, after rearrangement and simplification as detailed below:\n$$ -C_1 R_{PP} + (2\\mu_1 p q_{1S}) R_{PS} + C_2 T_{PP} + (2\\mu_2 p q_{2S}) T_{PS} = C_1 $$\nwhere $C_1 = \\rho_1(1-2\\beta_1^2 p^2)$ and $C_2 = \\rho_2(1-2\\beta_2^2 p^2)$. This simplification arises from expressing the Lamé parameter $\\lambda$ in terms of density $\\rho$ and wave speeds $\\alpha, \\beta$, i.e., $\\lambda = \\rho(\\alpha^2 - 2\\beta^2)$, and using the identity $p^2+q_P^2 = 1/\\alpha^2$.\n\nThe resulting $4 \\times 4$ complex matrix $A$ is:\n$$\nA = \\begin{pmatrix}\np  q_{1S}  -p  q_{2S} \\\\\n-q_{1P}  p  -q_{2P}  -p \\\\\n2\\mu_1 p q_{1P}  -\\mu_1(p^2-q_{1S}^2)  2\\mu_2 p q_{2P}  \\mu_2(p^2-q_{2S}^2) \\\\\n-C_1  2\\mu_1 p q_{1S}  C_2  2\\mu_2 p q_{2S}\n\\end{pmatrix}\n$$\nAnd the complex vector $\\mathbf{b}$ is:\n$$\n\\mathbf{b} = \\begin{pmatrix} -p \\\\ -q_{1P} \\\\ 2\\mu_1 p q_{1P} \\\\ C_1 \\end{pmatrix}\n$$\nHere, the shear moduli are $\\mu_1 = \\rho_1\\beta_1^2$ and $\\mu_2 = \\rho_2\\beta_2^2$.\n\n**3. Algorithmic Solution**\nThe algorithm proceeds as follows for each test case:\n1. Given the material properties $(\\alpha_1, \\beta_1, \\rho_1, \\alpha_2, \\beta_2, \\rho_2)$ and the incident angle $\\theta_1$.\n2. Calculate the horizontal slowness $p$.\n3. Calculate the four complex vertical slownesses $q_{1P}, q_{1S}, q_{2P}, q_{2S}$.\n4. Calculate the necessary intermediate terms, such as $\\mu_1, \\mu_2, C_1, C_2$.\n5. Construct the complex matrix $A$ and vector $\\mathbf{b}$ as defined above.\n6. Solve the linear system $A\\mathbf{x} = \\mathbf{b}$ for the vector of coefficients $\\mathbf{x}$. A standard linear solver, such as that provided by `numpy.linalg.solve`, is sufficient and numerically stable for non-singular cases. The problem's mention of a least-squares fallback is a valid consideration for a general-purpose robust implementation, but direct solution is appropriate here.\n7. The resulting vector $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$ contains the desired complex coefficients.\n8. For final output, the real and imaginary parts of each coefficient are extracted and formatted as specified. The special case of identical media serves as a sanity check, for which the solution must be $\\mathbf{x}=[0,0,1,0]^\\top$, corresponding to perfect transmission and no reflection.\n\nThis procedure correctly and robustly implements the Zoeppritz equations, respecting the physics of wave propagation, including the behavior at and beyond critical angles.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_zoeppritz(alpha1, beta1, rho1, alpha2, beta2, rho2, theta1_rad):\n    \"\"\"\n    Computes P-SV reflection/transmission coefficients using the Zoeppritz equations.\n\n    The implementation solves the 4x4 linear system derived from boundary conditions\n    at the interface between two elastic half-spaces. Complex arithmetic is used\n    throughout to handle post-critical angle scenarios.\n\n    Args:\n        alpha1 (float): P-wave speed in medium 1 (m/s).\n        beta1 (float): S-wave speed in medium 1 (m/s).\n        rho1 (float): Density of medium 1 (kg/m^3).\n        alpha2 (float): P-wave speed in medium 2 (m/s).\n        beta2 (float): S-wave speed in medium 2 (m/s).\n        rho2 (float): Density of medium 2 (kg/m^3).\n        theta1_rad (float): Incident P-wave angle in medium 1 (radians).\n\n    Returns:\n        list: A list of 8 floats representing the real and imaginary parts of\n              the four complex coefficients [R_PP, R_PS, T_PP, T_PS].\n    \"\"\"\n    # 1. Calculate slowness and other parameters\n    # For theta1_rad approaching pi/2, p can be very close to 1/alpha1.\n    # A small tolerance may be needed for numerical stability if grazing angle is allowed.\n    # Here we assume test cases are not at exactly pi/2.\n    if np.isclose(theta1_rad, np.pi/2):\n        p = 1.0 / alpha1\n    else:\n        p = np.sin(theta1_rad) / alpha1\n\n    # 2. Calculate vertical slownesses\n    # Using complex numbers from the start ensures correct branch cuts for evanescent waves.\n    # The condition Im(q) = 0 is handled correctly by np.sqrt for a complex argument.\n    q_alpha1 = np.sqrt(1/alpha1**2 - p**2 + 0j)\n    q_beta1 = np.sqrt(1/beta1**2 - p**2 + 0j)\n    q_alpha2 = np.sqrt(1/alpha2**2 - p**2 + 0j)\n    q_beta2 = np.sqrt(1/beta2**2 - p**2 + 0j)\n\n    # 3. Assemble the Zoeppritz matrix A and vector b\n    # These are derived directly from the four boundary condition equations provided\n    # in the problem statement.\n    # The unknown vector is x = [R_PP, R_PS, T_PP, T_PS]^T\n    \n    A = np.zeros((4, 4), dtype=np.complex128)\n    b = np.zeros(4, dtype=np.complex128)\n    \n    mu1 = rho1 * beta1**2\n    mu2 = rho2 * beta2**2\n\n    # Row 1: Continuity of horizontal displacement u_x\n    A[0, 0] = p\n    A[0, 1] = q_beta1\n    A[0, 2] = -p\n    A[0, 3] = q_beta2\n    b[0] = -p\n\n    # Row 2: Continuity of vertical displacement u_z\n    A[1, 0] = -q_alpha1\n    A[1, 1] = p\n    A[1, 2] = -q_alpha2\n    A[1, 3] = -p\n    b[1] = -q_alpha1\n\n    # Row 3: Continuity of shear traction sigma_xz\n    A[2, 0] = 2 * mu1 * p * q_alpha1\n    A[2, 1] = -mu1 * (p**2 - q_beta1**2)\n    A[2, 2] = 2 * mu2 * p * q_alpha2\n    A[2, 3] = mu2 * (p**2 - q_beta2**2)\n    b[2] = 2 * mu1 * p * q_alpha1\n\n    # Row 4: Continuity of normal traction sigma_zz\n    # Using the simplified expressions C1 and C2 as derived in the solution description.\n    C1 = rho1 * (1 - 2 * beta1**2 * p**2)\n    C2 = rho2 * (1 - 2 * beta2**2 * p**2)\n    A[3, 0] = -C1\n    A[3, 1] = 2 * mu1 * p * q_beta1\n    A[3, 2] = C2\n    A[3, 3] = 2 * mu2 * p * q_beta2\n    b[3] = C1\n    \n    # 4. Solve the linear system\n    try:\n        coeffs = np.linalg.solve(A, b)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares for ill-conditioned matrices (e.g., at critical angles)\n        coeffs, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n\n    # 5. Format output\n    # Flatten the complex coefficients into a list of real and imaginary parts\n    # [Re(R_PP), Im(R_PP), Re(R_PS), Im(R_PS), Re(T_PP), Im(T_PP), Re(T_PS), Im(T_PS)]\n    result = [\n        coeffs[0].real, coeffs[0].imag,\n        coeffs[1].real, coeffs[1].imag,\n        coeffs[2].real, coeffs[2].imag,\n        coeffs[3].real, coeffs[3].imag,\n    ]\n    return result\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.8),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.985),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.995),\n        (3000, 1500, 2200, 3000, 1500, 2200, 0.5),\n        (2000, 1000, 2000, 4000, 2200, 2800, 1.2),\n        (2500, 1400, 2100, 3200, 1800, 2600, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the coefficients for one case\n        coefficients = solve_zoeppritz(*case)\n        results.append(coefficients)\n\n    # Format the final output string exactly as required.\n    # e.g., [[a1,a2,...,a8],[b1,b2,...,b8],...]\n    # No spaces after commas inside the inner lists.\n    inner_parts = [f\"[{','.join(f'{x:.17g}' for x in r)}]\" for r in results]\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}