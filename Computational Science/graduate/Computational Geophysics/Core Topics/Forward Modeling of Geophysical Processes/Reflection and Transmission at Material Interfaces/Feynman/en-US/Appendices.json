{
    "hands_on_practices": [
        {
            "introduction": "To build robust computational models of wave propagation, we must first master the fundamental physics of how waves interact at material boundaries. This exercise grounds your understanding by tasking you with deriving the reflection and transmission coefficients for the simplest case: an acoustic wave at normal incidence to a single planar interface. By starting from the first principles of motion and mass conservation, you will see how the concept of acoustic impedance, $Z = \\rho c$, naturally arises as the controlling factor for wave partitioning and will interpret the physical meaning of a phase reversal in the reflected wave .",
            "id": "3613488",
            "problem": "A plane, time-harmonic, normally incident compressional (acoustic) wave in medium $1$ encounters a planar interface with medium $2$ at $x=0$. Assume the linear acoustic approximation with no mode conversion, and that both media are homogeneous, isotropic, and lossless. Let the mass densities be $\\rho_{1}$ and $\\rho_{2}$, the compressional wave speeds be $c_{1}$ and $c_{2}$, and the acoustic impedances be $Z_{1}=\\rho_{1} c_{1}$ and $Z_{2}=\\rho_{2} c_{2}$. The incident wave travels in the $+x$ direction from medium $1$ toward medium $2$. The amplitude reflection coefficient $R$ and amplitude transmission coefficient $T$ are defined with respect to pressure amplitudes as the complex ratios of reflected-to-incident and transmitted-to-incident pressure amplitudes, respectively.\n\nStarting from the linearized equations of motion and mass conservation for acoustics, together with the continuity of pressure and normal particle velocity at $x=0$, derive expressions for $R$ and $T$ at normal incidence. Then evaluate $R$ and $T$ for the specific material properties\n$\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$, $c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$, $\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$, and $c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$. Briefly interpret the sign of $R$ for the case $Z_{2}<Z_{1}$ in terms of phase reversal of the reflected pressure.\n\nReport the final numerical values of $R$ and $T$ as dimensionless amplitude ratios, rounded to four significant figures, in the form of a row matrix $\\begin{pmatrix} R & T \\end{pmatrix}$. Do not include units in the final reported values.",
            "solution": "The problem posed is valid. It is a standard, well-posed problem in linear acoustics and wave propagation, grounded in fundamental physical principles. It is self-contained, with all necessary data and conditions provided, and free from any scientific or logical inconsistencies. We may therefore proceed with a formal solution.\n\nThe derivation begins with the one-dimensional linearized equations for acoustic waves in a homogeneous, lossless fluid. The equation of motion (Euler's equation) is:\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}\n$$\nand the equation of mass conservation, combined with the constitutive relation for a fluid, is:\n$$\n\\frac{1}{\\rho c^2} \\frac{\\partial p}{\\partial t} = -\\frac{\\partial v_x}{\\partial x}\n$$\nHere, $p$ is the acoustic pressure, $v_x$ is the particle velocity in the $x$-direction, $\\rho$ is the mass density, $c$ is the wave speed, $t$ is time, and $x$ is the spatial coordinate.\n\nWe seek time-harmonic solutions of the form $p(x,t) = P(x)e^{-i\\omega t}$ and $v_x(x,t) = V_x(x)e^{-i\\omega t}$, where $\\omega$ is the angular frequency. Substituting these forms into the governing equations yields:\n$$\n-i\\omega \\rho V_x(x) = -\\frac{d P(x)}{dx}\n$$\n$$\n-i\\omega \\frac{1}{\\rho c^2} P(x) = -\\frac{d V_x(x)}{dx}\n$$\nThese can be combined to form the Helmholtz equation for pressure, $\\frac{d^2 P(x)}{dx^2} + k^2 P(x) = 0$, where $k = \\omega/c$ is the wavenumber. The general solutions describe plane waves traveling in the $+x$ and $-x$ directions.\n\nIn medium $1$ ($x<0$), we have an incident wave traveling in the $+x$ direction and a reflected wave traveling in the $-x$ direction. The total pressure field is the superposition of these two waves:\n$$\np_1(x,t) = P_I e^{i(k_1 x - \\omega t)} + P_R e^{i(-k_1 x - \\omega t)}\n$$\nwhere $k_1 = \\omega/c_1$. $P_I$ is the complex amplitude of the incident pressure wave and $P_R$ is the complex amplitude of the reflected pressure wave.\n\nIn medium $2$ ($x>0$), there is only a transmitted wave traveling in the $+x$ direction:\n$$\np_2(x,t) = P_T e^{i(k_2 x - \\omega t)}\n$$\nwhere $k_2 = \\omega/c_2$ and $P_T$ is the complex amplitude of the transmitted pressure wave.\n\nNext, we derive the expressions for particle velocity. From the equation of motion, $V_x(x) = \\frac{1}{i\\omega\\rho} \\frac{dP(x)}{dx}$. Applying this to the pressure fields in each medium:\nFor medium $1$:\n$$\nv_{x1}(x,t) = \\frac{1}{i\\omega\\rho_1} \\frac{\\partial}{\\partial x} \\left( P_I e^{ik_1 x} + P_R e^{-ik_1 x} \\right) e^{-i\\omega t} = \\frac{k_1}{\\omega\\rho_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\nUsing $k_1 = \\omega/c_1$ and the definition of acoustic impedance $Z_1 = \\rho_1 c_1$, this simplifies to:\n$$\nv_{x1}(x,t) = \\frac{1}{Z_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\nFor medium $2$:\n$$\nv_{x2}(x,t) = \\frac{1}{i\\omega\\rho_2} \\frac{\\partial}{\\partial x} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t} = \\frac{k_2}{\\omega\\rho_2} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t}\n$$\nUsing $k_2 = \\omega/c_2$ and $Z_2 = \\rho_2 c_2$, this simplifies to:\n$$\nv_{x2}(x,t) = \\frac{1}{Z_2} P_T e^{ik_2 x} e^{-i\\omega t}\n$$\nAt the interface $x=0$, the physical boundary conditions require the continuity of pressure and the continuity of the normal component of particle velocity.\n$1$. $p_1(0,t) = p_2(0,t)$\n$2$. $v_{x1}(0,t) = v_{x2}(0,t)$\n\nApplying the first boundary condition at $x=0$:\n$$\nP_I e^{0} + P_R e^{0} = P_T e^{0} \\implies P_I + P_R = P_T\n$$\nApplying the second boundary condition at $x=0$:\n$$\n\\frac{1}{Z_1} \\left( P_I e^{0} - P_R e^{0} \\right) = \\frac{1}{Z_2} P_T e^{0} \\implies \\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2} P_T\n$$\nWe now have a system of two linear equations. We solve for the amplitude reflection coefficient $R = P_R/P_I$ and the amplitude transmission coefficient $T = P_T/P_I$.\nSubstitute $P_T = P_I + P_R$ into the second equation:\n$$\n\\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2}(P_I + P_R)\n$$\nMultiply by $Z_1 Z_2$ to clear the denominators:\n$$\nZ_2(P_I - P_R) = Z_1(P_I + P_R)\n$$\n$$\nZ_2 P_I - Z_2 P_R = Z_1 P_I + Z_1 P_R\n$$\nGroup terms with $P_I$ and $P_R$:\n$$\nP_I(Z_2 - Z_1) = P_R(Z_1 + Z_2)\n$$\nSolving for the reflection coefficient $R = P_R/P_I$:\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2}\n$$\nTo find the transmission coefficient $T = P_T/P_I$, we use the relation $P_T = P_I + P_R$. Dividing by $P_I$ gives $T = 1 + R$:\n$$\nT = 1 + \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{(Z_1 + Z_2) + (Z_2 - Z_1)}{Z_1 + Z_2} = \\frac{2 Z_2}{Z_1 + Z_2}\n$$\nNow, we evaluate these expressions for the given material properties:\n$\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$, $c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$\n$\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$, $c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$\n\nFirst, calculate the acoustic impedances $Z_1$ and $Z_2$:\n$$\nZ_1 = \\rho_1 c_1 = (2900)(6000) = 17,400,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 1.74 \\times 10^7\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\n$$\nZ_2 = \\rho_2 c_2 = (1800)(2000) = 3,600,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 3.6 \\times 10^6\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\nNow, calculate $R$ and $T$:\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{3.6 \\times 10^6 - 17.4 \\times 10^6}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{-13.8 \\times 10^6}{21.0 \\times 10^6} = -\\frac{13.8}{21.0} \\approx -0.6571428...\n$$\n$$\nT = \\frac{2 Z_2}{Z_1 + Z_2} = \\frac{2 \\times (3.6 \\times 10^6)}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{7.2 \\times 10^6}{21.0 \\times 10^6} = \\frac{7.2}{21.0} \\approx 0.3428571...\n$$\nRounding to four significant figures, we get $R = -0.6571$ and $T = 0.3429$.\n\nFinally, we interpret the sign of $R$ for the case $Z_2 < Z_1$, which holds for the given numerical values. The reflection coefficient $R = P_R/P_I$ is the ratio of complex pressure amplitudes. A negative real value for $R$ signifies a phase shift of $\\pi$ radians ($180^\\circ$) between the reflected pressure wave and the incident pressure wave at the boundary, because $P_R = R P_I = -|R| P_I$. In the complex plane, multiplication by $-1$ is equivalent to a rotation by $\\pi$. Thus, when an acoustic wave reflects off an interface with a medium of lower acoustic impedance, the reflected pressure wave undergoes a phase reversal. This is analogous to a mechanical wave on a string reflecting from a free end.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.6571 & 0.3429\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Real geophysical settings are rarely a single interface; instead, they are composed of complex sequences of layers. This practice moves from the single-interface concept to the more realistic problem of modeling a stack of layers, a foundational task in generating synthetic seismograms. You will derive and implement two powerful and classic computational methods—the transfer-operator (propagator matrix) method and the recursive input-impedance method—to calculate the total reflectivity of the stack, providing a crucial lesson in algorithm design, numerical stability, and the importance of cross-validation in scientific computing .",
            "id": "3613499",
            "problem": "Consider one-dimensional time-harmonic linear acoustics at normal incidence in a horizontally layered medium. Let the time dependence be $e^{i \\omega t}$, where $\\omega = 2 \\pi f$ and $f$ is the frequency in $\\mathrm{Hz}$. Each homogeneous layer $i$ is characterized by density $\\rho_i$ in $\\mathrm{kg/m^3}$, compressional wave speed $c_i$ in $\\mathrm{m/s}$, thickness $d_i$ in $\\mathrm{m}$, acoustic impedance $Z_i = \\rho_i c_i$ in $\\mathrm{Pa \\cdot s/m}$, and wavenumber $k_i = \\omega / c_i$ in $\\mathrm{rad/m}$. The stack is bounded above by a semi-infinite incident medium with density $\\rho_0$ in $\\mathrm{kg/m^3}$ and wave speed $c_0$ in $\\mathrm{m/s}$ (so impedance $Z_0 = \\rho_0 c_0$), and bounded below by a semi-infinite backing half-space with density $\\rho_b$ in $\\mathrm{kg/m^3}$ and wave speed $c_b$ in $\\mathrm{m/s}$ (so impedance $Z_b = \\rho_b c_b$). Assume lossless media and plane-wave normal incidence.\n\nStarting only from the linearized momentum and continuity equations of acoustics and the definition of acoustic impedance, you must:\n\n- Derive a layer-propagation operator that maps the complex acoustic pressure and normal particle velocity at the bottom of a layer to those at the top. Use this to construct a total propagation operator for an entire stack of layers between the backing and the top.\n- Impose radiation into the backing half-space at the bottom and an incident plus reflected plane wave in the top half-space at the top to obtain the complex reflection coefficient $r$ at the top medium.\n- Independently derive a recursion for the input impedance looking into the stack from the top by successively embedding each layer starting from the backing, and then obtain the same complex reflection coefficient $r$ from the input impedance.\n- Ensure consistent phasor sign conventions throughout and address numerical stability in the presence of large phase thickness $k_i d_i$.\n\nThen, implement a program that computes the absolute discrepancy between the complex reflection coefficient obtained by the transfer-operator method and by the recursive input-impedance method, for the following test suite. All physical units must be used exactly as specified above; angles are not used because the problem is at normal incidence. For each case, report the discrepancy as a dimensionless float value (the absolute value of the difference of the complex reflection coefficients). Your program must output a single line that is a comma-separated list of these floats enclosed in square brackets.\n\nTest Suite (each case specifies $(\\rho_0, c_0)$ for the top, a list of layers $(\\rho_i, c_i, d_i)$, $(\\rho_b, c_b)$ for the bottom, and frequency $f$):\n\n1. Happy path, two contrasting layers:\n   - Top: $\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$.\n   - Layers: $(\\rho_1 = 1800\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 50\\,\\mathrm{m})$, $(\\rho_2 = 2700\\,\\mathrm{kg/m^3}, c_2 = 5000\\,\\mathrm{m/s}, d_2 = 200\\,\\mathrm{m})$.\n   - Backing: $\\rho_b = 3300\\,\\mathrm{kg/m^3}$, $c_b = 8000\\,\\mathrm{m/s}$.\n   - Frequency: $f = 10\\,\\mathrm{Hz}$.\n\n2. Boundary case with a zero-thickness layer:\n   - Top: $\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$.\n   - Layers: $(\\rho_1 = 1800\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 0\\,\\mathrm{m})$, $(\\rho_2 = 2700\\,\\mathrm{kg/m^3}, c_2 = 5000\\,\\mathrm{m/s}, d_2 = 150\\,\\mathrm{m})$.\n   - Backing: $\\rho_b = 3000\\,\\mathrm{kg/m^3}$, $c_b = 6000\\,\\mathrm{m/s}$.\n   - Frequency: $f = 25\\,\\mathrm{Hz}$.\n\n3. High-frequency thick-layer stability test:\n   - Top: $\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$.\n   - Layers: $(\\rho_1 = 2200\\,\\mathrm{kg/m^3}, c_1 = 2500\\,\\mathrm{m/s}, d_1 = 1000\\,\\mathrm{m})$, $(\\rho_2 = 2600\\,\\mathrm{kg/m^3}, c_2 = 4500\\,\\mathrm{m/s}, d_2 = 500\\,\\mathrm{m})$.\n   - Backing: $\\rho_b = 3200\\,\\mathrm{kg/m^3}$, $c_b = 7000\\,\\mathrm{m/s}$.\n   - Frequency: $f = 200\\,\\mathrm{Hz}$.\n\n4. Full impedance matching throughout (no reflection expected):\n   - Top: $\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$.\n   - Layers: $(\\rho_1 = 750\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 300\\,\\mathrm{m})$, $(\\rho_2 = 500\\,\\mathrm{kg/m^3}, c_2 = 3000\\,\\mathrm{m/s}, d_2 = 500\\,\\mathrm{m})$; note $Z_1 = \\rho_1 c_1 = 1.5 \\times 10^6\\,\\mathrm{Pa \\cdot s/m}$ and $Z_2 = \\rho_2 c_2 = 1.5 \\times 10^6\\,\\mathrm{Pa \\cdot s/m}$, matching $Z_0$ and $Z_b$.\n   - Backing: $\\rho_b = 1000\\,\\mathrm{kg/m^3}$, $c_b = 1500\\,\\mathrm{m/s}$.\n   - Frequency: $f = 50\\,\\mathrm{Hz}$.\n\n5. Strong reflector via low-impedance thin layer:\n   - Top: $\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$.\n   - Layers: $(\\rho_1 = 200\\,\\mathrm{kg/m^3}, c_1 = 600\\,\\mathrm{m/s}, d_1 = 10\\,\\mathrm{m})$, $(\\rho_2 = 2500\\,\\mathrm{kg/m^3}, c_2 = 4000\\,\\mathrm{m/s}, d_2 = 300\\,\\mathrm{m})$.\n   - Backing: $\\rho_b = 2700\\,\\mathrm{kg/m^3}$, $c_b = 6000\\,\\mathrm{m/s}$.\n   - Frequency: $f = 30\\,\\mathrm{Hz}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\texttt{[x_1,x_2,x_3,x_4,x_5]}$), where $x_j$ is the absolute discrepancy between the two computed complex reflection coefficients for test case $j$. All outputs are dimensionless floats rounded by the default numeric formatting of the programming language.",
            "solution": "The problem requires the derivation and implementation of two distinct methods for calculating the plane-wave reflection coefficient at normal incidence for a stack of homogeneous, lossless acoustic layers. The two methods, the transfer-operator (propagator matrix) method and the recursive input-impedance method, must be derived from first principles and their results compared for a given test suite. The time-harmonic dependence is given as $e^{i \\omega t}$.\n\nLet the spatial coordinate $z$ be positive downwards, with $z=0$ at the interface between the top semi-infinite medium (medium $0$) and the first layer of the stack. Each layer $j$ (for $j=1, \\dots, N$) has thickness $d_j$, density $\\rho_j$, and compressional wave speed $c_j$. The derived properties are the acoustic impedance $Z_j = \\rho_j c_j$, angular frequency $\\omega = 2\\pi f$, and wavenumber $k_j = \\omega/c_j$.\n\nThe fundamental equations for one-dimensional linear acoustics are the momentum equation and the continuity equation. For a time dependence of $e^{i \\omega t}$, they take the form:\n$$ i\\omega \\rho v_z = -\\frac{\\partial p}{\\partial z} \\quad \\text{(Momentum)} $$\n$$ i\\omega p = -K \\frac{\\partial v_z}{\\partial z} \\quad \\text{(Continuity)} $$\nwhere $p$ is the complex acoustic pressure, $v_z$ is the complex normal particle velocity, and $K = \\rho c^2$ is the bulk modulus.\n\nWithin a single homogeneous layer, the general solution for pressure is a superposition of downgoing and upgoing plane waves:\n$$ p(z) = A e^{-ik(z-z_0)} + B e^{ik(z-z_0)} $$\nwhere $z_0$ is the coordinate of the top of the layer. Using the momentum equation, the corresponding particle velocity is:\n$$ v_z(z) = \\frac{1}{Z} \\left( A e^{-ik(z-z_0)} - B e^{ik(z-z_0)} \\right) $$\n\n### Method 1: Transfer-Operator (Propagator Matrix) Method\n\nThis method relates the state vector of pressure and velocity, $S(z) = [p(z), v_z(z)]^T$, at the top and bottom of each layer. Let a layer $j$ extend from $z_{top}$ to $z_{bottom} = z_{top} + d_j$. We seek a matrix $M_j$ such that $S(z_{top}) = M_j S(z_{bottom})$.\n\nAt the top of the layer ($z=z_{top}$), the fields are:\n$$ p_{top} = A + B $$\n$$ v_{z,top} = \\frac{1}{Z_j}(A - B) $$\n\nAt the bottom of the layer ($z=z_{bottom}$), the fields are:\n$$ p_{bot} = A e^{-ik_j d_j} + B e^{ik_j d_j} $$\n$$ v_{z,bot} = \\frac{1}{Z_j} \\left( A e^{-ik_j d_j} - B e^{ik_j d_j} \\right) $$\n\nWe solve the bottom equations for the wave amplitudes $A$ and $B$:\n$$ A e^{-ik_j d_j} = \\frac{1}{2}(p_{bot} + Z_j v_{z,bot}) \\implies A = \\frac{1}{2}(p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} $$\n$$ B e^{ik_j d_j} = \\frac{1}{2}(p_{bot} - Z_j v_{z,bot}) \\implies B = \\frac{1}{2}(p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} $$\n\nSubstituting these into the expressions for the fields at the top:\n$$ p_{top} = A+B = \\frac{1}{2} \\left[ (p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} + (p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} \\right] $$\n$$ p_{top} = p_{bot} \\left(\\frac{e^{ik_j d_j} + e^{-ik_j d_j}}{2}\\right) + Z_j v_{z,bot} \\left(\\frac{e^{ik_j d_j} - e^{-ik_j d_j}}{2}\\right) $$\n$$ p_{top} = p_{bot} \\cos(k_j d_j) + i Z_j v_{z,bot} \\sin(k_j d_j) $$\n\nSimilarly for the velocity:\n$$ v_{z,top} = \\frac{A-B}{Z_j} = \\frac{1}{2Z_j} \\left[ (p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} - (p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} \\right] $$\n$$ v_{z,top} = \\frac{p_{bot}}{Z_j} \\left(\\frac{e^{ik_j d_j} - e^{-ik_j d_j}}{2}\\right) + v_{z,bot} \\left(\\frac{e^{ik_j d_j} + e^{-ik_j d_j}}{2}\\right) $$\n$$ v_{z,top} = \\frac{i p_{bot}}{Z_j} \\sin(k_j d_j) + v_{z,bot} \\cos(k_j d_j) $$\n\nThese two equations can be written in matrix form, defining the single-layer propagator matrix $M_j$:\n$$ \\begin{pmatrix} p_{top} \\\\ v_{z,top} \\end{pmatrix} = \\begin{pmatrix} \\cos(k_j d_j) & iZ_j\\sin(k_j d_j) \\\\ \\frac{i}{Z_j}\\sin(k_j d_j) & \\cos(k_j d_j) \\end{pmatrix} \\begin{pmatrix} p_{bot} \\\\ v_{z,bot} \\end{pmatrix} = M_j \\begin{pmatrix} p_{bot} \\\\ v_{z,bot} \\end{pmatrix} $$\nFor a stack of $N$ layers, the state vector at the top of the stack (top of layer $1$) is related to the state vector at the bottom of the stack (bottom of layer $N$) by the product of the individual layer matrices:\n$$ S_{top\\_stack} = M_1 M_2 \\cdots M_N S_{bot\\_stack} = M_{total} S_{bot\\_stack} $$\nThe total propagator matrix is $M_{total} = \\prod_{j=1}^{N} M_j$.\n\nTo find the reflection coefficient, we apply boundary conditions. At the bottom of the stack, the field radiates into the backing half-space (medium $b$), so only a downgoing wave exists. This imposes the condition $p_{bot\\_stack} = Z_b v_{z,bot\\_stack}$. The state vector at the top is then:\n$$ \\begin{pmatrix} p_{top} \\\\ v_{z,top} \\end{pmatrix} = M_{total} \\begin{pmatrix} Z_b v_{z,bot\\_stack} \\\\ v_{z,bot\\_stack} \\end{pmatrix} = M_{total} \\begin{pmatrix} Z_b \\\\ 1 \\end{pmatrix} v_{z,bot\\_stack} $$\nWriting $M_{total} = \\begin{pmatrix} m_{11} & m_{12} \\\\ m_{21} & m_{22} \\end{pmatrix}$, we find the input impedance $Z_{in}$ of the stack:\n$$ Z_{in} = \\frac{p_{top}}{v_{z,top}} = \\frac{m_{11} Z_b + m_{12}}{m_{21} Z_b + m_{22}} $$\nAt the top of the stack, the field in the incident medium (medium $0$) consists of an incident wave of amplitude $A_i$ and a reflected wave of amplitude $A_r$. At $z=0$:\n$$ p_{top} = A_i + A_r $$\n$$ v_{z,top} = \\frac{A_i}{Z_0} - \\frac{A_r}{Z_0} $$\nThe reflection coefficient is $r = A_r/A_i$. The input impedance is also given by the ratio of these fields:\n$$ Z_{in} = \\frac{p_{top}}{v_{z,top}} = \\frac{A_i(1+r)}{A_i(1-r)/Z_0} = Z_0 \\frac{1+r}{1-r} $$\nSolving for $r$ gives the final expression:\n$$ r = \\frac{Z_{in} - Z_0}{Z_{in} + Z_0} $$\n\n### Method 2: Recursive Input-Impedance Method\n\nThis method computes the input impedance of the stack recursively, starting from the bottom. Let $Z_{in}^{(j)}$ be the input impedance at the top of layer $j$. The \"load\" for layer $j$ is the input impedance of the entire substructure below it, i.e., $Z_{in}^{(j+1)}$. The recursion starts with the base case: the load for the bottom-most layer ($N$) is the impedance of the backing half-space, so $Z_{in}^{(N+1)} = Z_b$.\n\nWe need a formula relating the input impedance $Z_{in}$ at the top of a layer (impedance $Z$, thickness $d$, wavenumber $k$) to the load impedance $Z_L$ at its bottom. From Method 1, we can write the input impedance $Z_{in} = p_{top}/v_{z,top}$ for a single layer terminating in a load where $p_{bot} = Z_L v_{z,bot}$:\n$$ p_{top} = p_{bot} \\cos(kd) + i Z v_{z,bot} \\sin(kd) = v_{z,bot} (Z_L \\cos(kd) + i Z \\sin(kd)) $$\n$$ v_{z,top} = \\frac{i p_{bot}}{Z} \\sin(kd) + v_{z,bot} \\cos(kd) = v_{z,bot} \\left(\\frac{i Z_L}{Z} \\sin(kd) + \\cos(kd)\\right) $$\nTaking the ratio gives the impedance transformation formula:\n$$ Z_{in} = \\frac{Z_L \\cos(kd) + i Z \\sin(kd)}{\\frac{i Z_L}{Z} \\sin(kd) + \\cos(kd)} = Z \\frac{Z_L \\cos(kd) + i Z \\sin(kd)}{Z \\cos(kd) + i Z_L \\sin(kd)} $$\nThis form is numerically stable, especially when compared to the equivalent formulation using $\\tan(kd)$, which can be singular if a layer's thickness is an odd multiple of a quarter-wavelength ($kd = (n+1/2)\\pi$).\n\nThe recursive algorithm is as follows:\n1. Initialize the load impedance with the backing impedance: $Z_{load} = Z_b$.\n2. Iterate upwards through the layers from $j = N$ down to $1$:\n   $$ Z_{load} \\leftarrow Z_j \\frac{Z_{load} \\cos(k_j d_j) + i Z_j \\sin(k_j d_j)}{Z_j \\cos(k_j d_j) + i Z_{load} \\sin(k_j d_j)} $$\n3. The final value of $Z_{load}$ after the loop is the input impedance $Z_{in}$ for the entire stack.\n4. The reflection coefficient $r$ is then computed as before:\n   $$ r = \\frac{Z_{in} - Z_0}{Z_{in} + Z_0} $$\n\n### Numerical Implementation and Comparison\n\nBoth methods are implemented in software to compute the complex reflection coefficient $r$. The transfer-operator method relies on matrix multiplication, which is straightforward but can accumulate numerical errors for a very large number of layers. The recursive impedance method is generally considered more stable as it avoids explicit matrix products. In the lossless case with moderate numbers of layers and phase thicknesses, both methods should produce results that agree to within machine precision. The problem asks to calculate the absolute discrepancy $|r_1 - r_2|$ where $r_1$ is from the transfer-operator method and $r_2$ is from the recursive-impedance method. For a correct implementation, this value should be close to zero. The use of complex arithmetic is essential. The `cos` and `sin` functions in the chosen programming environment handle large arguments correctly, mitigating the stability concerns for the high-frequency test case. A zero-thickness layer should correctly result in an identity operation: the propagator matrix becomes the identity matrix, and the impedance recursion returns the load impedance unchanged.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reflection coefficient problem using two methods\n    and computes the discrepancy for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"top\": (1000.0, 1500.0), # rho0, c0\n            \"layers\": [\n                (1800.0, 2000.0, 50.0), # rho1, c1, d1\n                (2700.0, 5000.0, 200.0),  # rho2, c2, d2\n            ],\n            \"backing\": (3300.0, 8000.0), # rho_b, c_b\n            \"freq\": 10.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (1800.0, 2000.0, 0.0), # Zero-thickness layer\n                (2700.0, 5000.0, 150.0),\n            ],\n            \"backing\": (3000.0, 6000.0),\n            \"freq\": 25.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (2200.0, 2500.0, 1000.0), # High-frequency, thick layers\n                (2600.0, 4500.0, 500.0),\n            ],\n            \"backing\": (3200.0, 7000.0),\n            \"freq\": 200.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (750.0, 2000.0, 300.0), # Impedance matching\n                (500.0, 3000.0, 500.0),\n            ],\n            \"backing\": (1000.0, 1500.0),\n            \"freq\": 50.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (200.0, 600.0, 10.0), # Low-impedance thin layer\n                (2500.0, 4000.0, 300.0),\n            ],\n            \"backing\": (2700.0, 6000.0),\n            \"freq\": 30.0,\n        },\n    ]\n\n    discrepancies = []\n\n    for case in test_cases:\n        r1 = calculate_r_transfer_matrix(case)\n        r2 = calculate_r_recursive_impedance(case)\n        discrepancy = np.abs(r1 - r2)\n        discrepancies.append(discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, discrepancies))}]\")\n\ndef calculate_r_transfer_matrix(params):\n    \"\"\"\n    Calculates the reflection coefficient using the transfer-operator matrix method.\n    \"\"\"\n    rho0, c0 = params[\"top\"]\n    layers_params = params[\"layers\"]\n    rho_b, c_b = params[\"backing\"]\n    freq = params[\"freq\"]\n\n    Z0 = rho0 * c0\n    Z_b = rho_b * c_b\n    omega = 2.0 * np.pi * freq\n\n    total_matrix = np.identity(2, dtype=complex)\n\n    for rho_j, c_j, d_j in layers_params:\n        if d_j == 0:\n            # A zero-thickness layer is an identity operator\n            layer_matrix = np.identity(2, dtype=complex)\n        else:\n            Z_j = rho_j * c_j\n            k_j = omega / c_j\n            kd = k_j * d_j\n            cos_kd = np.cos(kd)\n            sin_kd = np.sin(kd)\n\n            layer_matrix = np.array([\n                [cos_kd, 1j * Z_j * sin_kd],\n                [1j / Z_j * sin_kd, cos_kd]\n            ], dtype=complex)\n        \n        total_matrix = total_matrix @ layer_matrix\n\n    m11, m12 = total_matrix[0, 0], total_matrix[0, 1]\n    m21, m22 = total_matrix[1, 0], total_matrix[1, 1]\n\n    # Check for division by zero, although unlikely in physical scenarios\n    denominator = m21 * Z_b + m22\n    if np.abs(denominator) < 1e-15:\n        # This case suggests infinite input impedance, handle as needed.\n        # For simplicity, we can assume it's very large.\n        Z_in = np.inf\n    else:\n        Z_in = (m11 * Z_b + m12) / denominator\n\n    if np.isinf(Z_in):\n        # r = (inf - Z0)/(inf + Z0) -> 1\n        r = 1.0 + 0.0j\n    else:\n        r = (Z_in - Z0) / (Z_in + Z0)\n\n    return r\n\ndef calculate_r_recursive_impedance(params):\n    \"\"\"\n    Calculates the reflection coefficient using the recursive input-impedance method.\n    \"\"\"\n    rho0, c0 = params[\"top\"]\n    layers_params = params[\"layers\"]\n    rho_b, c_b = params[\"backing\"]\n    freq = params[\"freq\"]\n\n    Z0 = rho0 * c0\n    Z_b = rho_b * c_b\n    omega = 2.0 * np.pi * freq\n\n    # Start with the impedance of the backing half-space\n    Z_load = complex(Z_b)\n\n    # Iterate upwards from the bottom layer\n    for rho_j, c_j, d_j in reversed(layers_params):\n        if d_j == 0:\n            # A zero-thickness layer does not change the impedance\n            continue\n\n        Z_j = rho_j * c_j\n        k_j = omega / c_j\n        kd = k_j * d_j\n\n        cos_kd = np.cos(kd)\n        sin_kd = np.sin(kd)\n        \n        # Use the numerically stable formula with cos and sin\n        numerator = Z_load * cos_kd + 1j * Z_j * sin_kd\n        denominator = Z_j * cos_kd + 1j * Z_load * sin_kd\n\n        if np.abs(denominator) < 1e-15:\n            # This can happen at resonance, e.g., quarter-wave transformer with Z_load=0\n            # resulting in Z_in -> infinity\n            Z_load = np.inf\n        else:\n            Z_load = Z_j * numerator / denominator\n\n    Z_in = Z_load\n    \n    if np.isinf(Z_in):\n        # r = (inf - Z0)/(inf + Z0) -> 1\n        r = 1.0 + 0.0j\n    else:\n        r = (Z_in - Z0) / (Z_in + Z0)\n    \n    return r\n\nsolve()\n```"
        },
        {
            "introduction": "While the acoustic approximation is useful, a complete physical description requires us to consider elastic effects, including the conversion of energy between compressional (P) and shear (SV) waves. This advanced practice challenges you to implement a solver for the full Zoeppritz equations, which govern P-SV reflection and transmission at an elastic interface. A key component of this exercise is developing a numerically stable code that correctly handles post-critical phenomena, where transmitted waves become evanescent and require the use of complex arithmetic and careful branch-cut selection—an essential skill for quantitative interpretation techniques like Amplitude-Versus-Offset (AVO) analysis .",
            "id": "3613464",
            "problem": "You are tasked with building a complete, runnable program that computes the complex amplitude reflection and transmission coefficients for plane-wave P-SV coupling at a planar interface between two homogeneous, isotropic, linear-elastic half-spaces using the full Zoeppritz equations. The solver must be stable when crossing the transmitted P-wave critical angle, where the transmitted angle becomes complex because $\\sin\\theta_t>1$. You must implement a mathematically principled continuation strategy through this regime that respects the physical outgoing-wave condition, and you must test the numerical stability and branch choices for complex transmitted angles. Angles must be specified in radians. All physical quantities must use the International System of Units.\n\nFundamental base to use:\n- Linear elasticity for isotropic media with Lamé parameters $\\lambda$ and $\\mu$, mass density $\\rho$, compressional-wave speed $\\alpha$, and shear-wave speed $\\beta$, related by $\\mu=\\rho\\beta^2$ and $\\lambda=\\rho\\alpha^2-2\\mu$.\n- Plane-wave kinematics with horizontal slowness $p$ and vertical slowness $q$, where for a wave of speed $v$,\n$$\np=\\frac{\\sin\\theta}{\\alpha_1}\\quad\\text{for an incident P-wave at angle }\\theta\\text{ in the top medium},\n$$\nand\n$$\nq(v,p)=\\sqrt{\\frac{1}{v^2}-p^2},\n$$\nwith the square root taken in the complex plane so that for $p>1/v$ (evanescent regime) the branch yields $q$ with positive imaginary part for downgoing waves. The vertical coordinate increases downward, the interface is at $z=0$, and the plane-wave phase is $e^{i\\omega(px+szqz)}$ with $s=+1$ for downgoing and $s=-1$ for upgoing constituents.\n\nYou must derive and implement the boundary conditions at the interface based on continuity of displacement components $u_x$, $u_z$ and continuity of traction components $\\sigma_{xz}$, $\\sigma_{zz}$. For two half-spaces labeled $1$ (top) and $2$ (bottom), for an incident P-wave of unit potential amplitude in medium $1$, define the unknown complex amplitude coefficients:\n- $R_{PP}$: upgoing reflected P-wave in medium $1$,\n- $R_{PS}$: upgoing reflected SV-wave in medium $1$,\n- $T_{PP}$: downgoing transmitted P-wave in medium $2$,\n- $T_{PS}$: downgoing transmitted SV-wave in medium $2$.\n\nUsing scalar potentials $\\phi$ for P and $\\psi$ for SV, the plane-wave displacement and traction contributions for a constituent with sign $s\\in\\{+1,-1\\}$ are\n$$\nu_x = i\\omega\\left(p\\,\\phi - s\\,q\\,\\psi\\right),\\quad\nu_z = i\\omega\\left(s\\,q\\,\\phi + p\\,\\psi\\right),\n$$\n$$\n\\sigma_{xz} = -\\mu\\,\\omega^2\\left(2p\\,s\\,q\\,\\phi + \\left(p^2-(s\\,q)^2\\right)\\psi\\right),\\quad\n\\sigma_{zz} = -\\omega^2\\left(\\left((\\lambda+2\\mu)(s\\,q)^2+\\lambda p^2\\right)\\phi + 2\\mu p\\,s\\,q\\,\\psi\\right).\n$$\nBy superposition of the incident and scattered constituents and enforcing boundary conditions at $z=0$, you must form and solve a $4\\times 4$ complex linear system for $\\left[R_{PP},R_{PS},T_{PP},T_{PS}\\right]^T$. Express the system using the horizontal slowness $p$, vertical slownesses $q_{1P},q_{1S},q_{2P},q_{2S}$, Lamé parameters $(\\lambda_1,\\mu_1)$ and $(\\lambda_2,\\mu_2)$, and densities $(\\rho_1,\\rho_2)$. The four scalar equations to assemble are presented here in a standard form where all unknown scattered wave amplitudes are on the left-hand side and the known incident wave terms are on the right-hand side:\n1. Continuity of $u_x$:\n$$\np R_{PP} + q_{1S} R_{PS} - p T_{PP} + q_{2S} T_{PS} = -p\n$$\n2. Continuity of $u_z$:\n$$\n-q_{1P} R_{PP} + p R_{PS} - q_{2P} T_{PP} - p T_{PS} = -q_{1P}\n$$\n3. Continuity of $\\sigma_{xz}$:\n$$\n2\\mu_1 p q_{1P} R_{PP} - \\mu_1(p^2-q_{1S}^2)R_{PS} + 2\\mu_2 p q_{2P} T_{PP} + \\mu_2(p^2-q_{2S}^2)T_{PS} = 2\\mu_1 p q_{1P}\n$$\n4. Continuity of $\\sigma_{zz}$:\n$$\n-((\\lambda_1+2\\mu_1)q_{1P}^2 + \\lambda_1 p^2) R_{PP} + 2 \\mu_1 p q_{1S} R_{PS} + ((\\lambda_2+2\\mu_2)q_{2P}^2 + \\lambda_2 p^2) T_{PP} + 2 \\mu_2 p q_{2S} T_{PS} = (\\lambda_1+2\\mu_1)q_{1P}^2 + \\lambda_1 p^2\n$$\n\nAlgorithmic requirements:\n- Use complex arithmetic throughout so that $q(v,p)$ is robust across the critical angle.\n- Implement a branch-selection strategy for $q(v,p)$ that yields $\\operatorname{Im}(q)\\ge 0$ in the evanescent regime, ensuring physically acceptable downgoing decay in medium $2$ and consistent upgoing behavior in medium $1$ via the sign $s$ in the formulas.\n- Solve the $4\\times 4$ system with a numerically stable method. If the matrix is ill-conditioned near the critical angle, use a least-squares fallback.\n\nUnits and angle conventions:\n- $\\alpha$, $\\beta$ in $\\text{m/s}$,\n- $\\rho$ in $\\text{kg/m}^3$,\n- angles in radians,\n- the returned coefficients are dimensionless complex amplitudes.\n\nTest suite:\nYour program must evaluate the solver for the following six parameter sets $(\\alpha_1,\\beta_1,\\rho_1,\\alpha_2,\\beta_2,\\rho_2,\\theta_1)$, where $\\theta_1$ is the incident P-wave angle in radians in medium $1$.\n1. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.8)$: subcritical reference.\n2. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.985)$: near transmitted P critical, slightly below.\n3. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.995)$: just above transmitted P critical (evanescent $q_{2P}$).\n4. $(3000,\\,1500,\\,2200,\\,3000,\\,1500,\\,2200,\\,0.5)$: identical media sanity check.\n5. $(2000,\\,1000,\\,2000,\\,4000,\\,2200,\\,2800,\\,1.2)$: strong contrast, high angle, supercritical in medium $2$ for P.\n6. $(2500,\\,1400,\\,2100,\\,3200,\\,1800,\\,2600,\\,1.3)$: high angle across moderate contrast.\n\nFinal output specification:\n- For each test case, return the list $[ \\Re(R_{PP}), \\Im(R_{PP}), \\Re(R_{PS}), \\Im(R_{PS}), \\Re(T_{PP}), \\Im(T_{PP}), \\Re(T_{PS}), \\Im(T_{PS}) ]$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list of these lists enclosed in square brackets. For example: `[ [a1,a2,...,a8], [b1,b2,...,b8], ... ]`.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It presents a well-posed, scientifically grounded problem in computational geophysics, based on the established principles of linear elastodynamics. The provided equations, definitions, and parameters are internally consistent and allow for the formulation and solution of a complete physical problem.\n\nThe task is to compute the complex reflection and transmission coefficients for a plane P-wave impinging on a planar boundary between two distinct elastic media. This is governed by the Zoeppritz equations, which arise from enforcing boundary conditions on displacement and traction at the interface. The problem is formulated for P-SV coupled waves, requiring the solution of a $4 \\times 4$ linear system for the four unknown wave amplitudes: reflected P ($R_{PP}$), reflected SV ($R_{PS}$), transmitted P ($T_{PP}$), and transmitted SV ($T_{PS}$).\n\nThe solution proceeds through the following steps:\n\n**1. Kinematic Parameters**\nThe kinematics of all plane waves are linked by Snell's law, which states that the horizontal slowness, $p$, is conserved across the interface. For an incident P-wave in medium $1$ with velocity $\\alpha_1$ at an angle $\\theta_1$ from the normal, the horizontal slowness is:\n$$\np = \\frac{\\sin\\theta_1}{\\alpha_1}\n$$\nThe vertical slowness, $q$, for any wave (P or SV) with velocity $v$ is dependent on $p$:\n$$\nq(v, p) = \\sqrt{\\frac{1}{v^2} - p^2}\n$$\nTo handle post-critical incidence, where $p > 1/v$, the term inside the square root becomes negative, and $q$ becomes imaginary. The calculation must be performed in the complex plane. The physical requirement for a stable solution is that evanescent waves (imaginary $q$) must decay away from the interface. Given the coordinate system where $z$ increases downwards, downgoing transmitted waves in medium $2$ ($z > 0$) must decay for increasing $z$, and upgoing reflected waves in medium $1$ ($z < 0$) must decay for decreasing $z$. Both conditions are satisfied by choosing the branch of the complex square root such that $\\operatorname{Im}(q) \\ge 0$. Standard numerical libraries for complex arithmetic, such as NumPy, adhere to this convention for the principal root. We thus define the four required vertical slownesses:\n- Incident/Reflected P-wave in medium 1: $q_{1P} = \\sqrt{1/\\alpha_1^2 - p^2 + 0j}$\n- Reflected SV-wave in medium 1: $q_{1S} = \\sqrt{1/\\beta_1^2 - p^2 + 0j}$\n- Transmitted P-wave in medium 2: $q_{2P} = \\sqrt{1/\\alpha_2^2 - p^2 + 0j}$\n- Transmitted SV-wave in medium 2: $q_{2S} = \\sqrt{1/\\beta_2^2 - p^2 + 0j}$\n\n**2. Formulation of the Linear System**\nThe four boundary conditions (continuity of horizontal displacement $u_x$, vertical displacement $u_z$, shear traction $\\sigma_{xz}$, and normal traction $\\sigma_{zz}$) yield a system of four linear equations. Let the vector of unknown complex amplitudes be $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$. The system can be written in matrix form as $A\\mathbf{x} = \\mathbf{b}$. By rearranging the four equations provided in the problem statement, we identify the components of the matrix $A$ and the vector $\\mathbf{b}$.\n\nFrom continuity of $u_x$:\n$$ p R_{PP} + q_{1S} R_{PS} - p T_{PP} + q_{2S} T_{PS} = -p $$\nFrom continuity of $u_z$:\n$$ -q_{1P} R_{PP} + p R_{PS} - q_{2P} T_{PP} - p T_{PS} = -q_{1P} $$\nFrom continuity of $\\sigma_{xz}$:\n$$ (2\\mu_1 p q_{1P}) R_{PP} - \\mu_1(p^2-q_{1S}^2) R_{PS} + (2\\mu_2 p q_{2P}) T_{PP} + \\mu_2(p^2-q_{2S}^2) T_{PS} = 2\\mu_1 p q_{1P} $$\nFrom continuity of $\\sigma_{zz}$, after rearrangement and simplification as detailed below:\n$$ -C_1 R_{PP} + (2\\mu_1 p q_{1S}) R_{PS} + C_2 T_{PP} + (2\\mu_2 p q_{2S}) T_{PS} = C_1 $$\nwhere $C_1 = \\rho_1(1-2\\beta_1^2 p^2)$ and $C_2 = \\rho_2(1-2\\beta_2^2 p^2)$. This simplification arises from expressing the Lamé parameter $\\lambda$ in terms of density $\\rho$ and wave speeds $\\alpha, \\beta$, i.e., $\\lambda = \\rho(\\alpha^2 - 2\\beta^2)$, and using the identity $p^2+q_P^2 = 1/\\alpha^2$.\n\nThe resulting $4 \\times 4$ complex matrix $A$ is:\n$$\nA = \\begin{pmatrix}\np & q_{1S} & -p & q_{2S} \\\\\n-q_{1P} & p & -q_{2P} & -p \\\\\n2\\mu_1 p q_{1P} & -\\mu_1(p^2-q_{1S}^2) & 2\\mu_2 p q_{2P} & \\mu_2(p^2-q_{2S}^2) \\\\\n-C_1 & 2\\mu_1 p q_{1S} & C_2 & 2\\mu_2 p q_{2S}\n\\end{pmatrix}\n$$\nAnd the complex vector $\\mathbf{b}$ is:\n$$\n\\mathbf{b} = \\begin{pmatrix} -p \\\\ -q_{1P} \\\\ 2\\mu_1 p q_{1P} \\\\ C_1 \\end{pmatrix}\n$$\nHere, the shear moduli are $\\mu_1 = \\rho_1\\beta_1^2$ and $\\mu_2 = \\rho_2\\beta_2^2$.\n\n**3. Algorithmic Solution**\nThe algorithm proceeds as follows for each test case:\n1. Given the material properties $(\\alpha_1, \\beta_1, \\rho_1, \\alpha_2, \\beta_2, \\rho_2)$ and the incident angle $\\theta_1$.\n2. Calculate the horizontal slowness $p$.\n3. Calculate the four complex vertical slownesses $q_{1P}, q_{1S}, q_{2P}, q_{2S}$.\n4. Calculate the necessary intermediate terms, such as $\\mu_1, \\mu_2, C_1, C_2$.\n5. Construct the complex matrix $A$ and vector $\\mathbf{b}$ as defined above.\n6. Solve the linear system $A\\mathbf{x} = \\mathbf{b}$ for the vector of coefficients $\\mathbf{x}$. A standard linear solver, such as that provided by `numpy.linalg.solve`, is sufficient and numerically stable for non-singular cases. The problem's mention of a least-squares fallback is a valid consideration for a general-purpose robust implementation, but direct solution is appropriate here.\n7. The resulting vector $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$ contains the desired complex coefficients.\n8. For final output, the real and imaginary parts of each coefficient are extracted and formatted as specified. The special case of identical media serves as a sanity check, for which the solution must be $\\mathbf{x}=[0,0,1,0]^\\top$, corresponding to perfect transmission and no reflection.\n\nThis procedure correctly and robustly implements the Zoeppritz equations, respecting the physics of wave propagation, including the behavior at and beyond critical angles.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_zoeppritz(alpha1, beta1, rho1, alpha2, beta2, rho2, theta1_rad):\n    \"\"\"\n    Computes P-SV reflection/transmission coefficients using the Zoeppritz equations.\n\n    The implementation solves the 4x4 linear system derived from boundary conditions\n    at the interface between two elastic half-spaces. Complex arithmetic is used\n    throughout to handle post-critical angle scenarios.\n\n    Args:\n        alpha1 (float): P-wave speed in medium 1 (m/s).\n        beta1 (float): S-wave speed in medium 1 (m/s).\n        rho1 (float): Density of medium 1 (kg/m^3).\n        alpha2 (float): P-wave speed in medium 2 (m/s).\n        beta2 (float): S-wave speed in medium 2 (m/s).\n        rho2 (float): Density of medium 2 (kg/m^3).\n        theta1_rad (float): Incident P-wave angle in medium 1 (radians).\n\n    Returns:\n        list: A list of 8 floats representing the real and imaginary parts of\n              the four complex coefficients [R_PP, R_PS, T_PP, T_PS].\n    \"\"\"\n    # 1. Calculate slowness and other parameters\n    # For theta1_rad approaching pi/2, p can be very close to 1/alpha1.\n    # A small tolerance may be needed for numerical stability if grazing angle is allowed.\n    # Here we assume test cases are not at exactly pi/2.\n    if np.isclose(theta1_rad, np.pi/2):\n        p = 1.0 / alpha1\n    else:\n        p = np.sin(theta1_rad) / alpha1\n\n    # 2. Calculate vertical slownesses\n    # Using complex numbers from the start ensures correct branch cuts for evanescent waves.\n    # The condition Im(q) >= 0 is handled correctly by np.sqrt for a complex argument.\n    q_alpha1 = np.sqrt(1/alpha1**2 - p**2 + 0j)\n    q_beta1 = np.sqrt(1/beta1**2 - p**2 + 0j)\n    q_alpha2 = np.sqrt(1/alpha2**2 - p**2 + 0j)\n    q_beta2 = np.sqrt(1/beta2**2 - p**2 + 0j)\n\n    # 3. Assemble the Zoeppritz matrix A and vector b\n    # These are derived directly from the four boundary condition equations provided\n    # in the problem statement.\n    # The unknown vector is x = [R_PP, R_PS, T_PP, T_PS]^T\n    \n    A = np.zeros((4, 4), dtype=np.complex128)\n    b = np.zeros(4, dtype=np.complex128)\n    \n    mu1 = rho1 * beta1**2\n    mu2 = rho2 * beta2**2\n\n    # Row 1: Continuity of horizontal displacement u_x\n    A[0, 0] = p\n    A[0, 1] = q_beta1\n    A[0, 2] = -p\n    A[0, 3] = q_beta2\n    b[0] = -p\n\n    # Row 2: Continuity of vertical displacement u_z\n    A[1, 0] = -q_alpha1\n    A[1, 1] = p\n    A[1, 2] = -q_alpha2\n    A[1, 3] = -p\n    b[1] = -q_alpha1\n\n    # Row 3: Continuity of shear traction sigma_xz\n    A[2, 0] = 2 * mu1 * p * q_alpha1\n    A[2, 1] = -mu1 * (p**2 - q_beta1**2)\n    A[2, 2] = 2 * mu2 * p * q_alpha2\n    A[2, 3] = mu2 * (p**2 - q_beta2**2)\n    b[2] = 2 * mu1 * p * q_alpha1\n\n    # Row 4: Continuity of normal traction sigma_zz\n    # Using the simplified expressions C1 and C2 as derived in the solution description.\n    C1 = rho1 * (1 - 2 * beta1**2 * p**2)\n    C2 = rho2 * (1 - 2 * beta2**2 * p**2)\n    A[3, 0] = -C1\n    A[3, 1] = 2 * mu1 * p * q_beta1\n    A[3, 2] = C2\n    A[3, 3] = 2 * mu2 * p * q_beta2\n    b[3] = C1\n    \n    # 4. Solve the linear system\n    try:\n        coeffs = np.linalg.solve(A, b)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares for ill-conditioned matrices (e.g., at critical angles)\n        coeffs, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n\n    # 5. Format output\n    # Flatten the complex coefficients into a list of real and imaginary parts\n    # [Re(R_PP), Im(R_PP), Re(R_PS), Im(R_PS), Re(T_PP), Im(T_PP), Re(T_PS), Im(T_PS)]\n    result = [\n        coeffs[0].real, coeffs[0].imag,\n        coeffs[1].real, coeffs[1].imag,\n        coeffs[2].real, coeffs[2].imag,\n        coeffs[3].real, coeffs[3].imag,\n    ]\n    return result\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.8),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.985),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.995),\n        (3000, 1500, 2200, 3000, 1500, 2200, 0.5),\n        (2000, 1000, 2000, 4000, 2200, 2800, 1.2),\n        (2500, 1400, 2100, 3200, 1800, 2600, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the coefficients for one case\n        coefficients = solve_zoeppritz(*case)\n        results.append(coefficients)\n\n    # Format the final output string exactly as required.\n    # e.g., [[a1,a2,...,a8],[b1,b2,...,b8],...]\n    # No spaces after commas inside the inner lists.\n    inner_parts = [f\"[{','.join(f'{x:.17g}' for x in r)}]\" for r in results]\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}