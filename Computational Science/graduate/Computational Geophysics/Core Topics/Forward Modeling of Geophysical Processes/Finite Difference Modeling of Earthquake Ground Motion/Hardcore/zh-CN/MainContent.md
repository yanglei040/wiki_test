## 引言
预测强地震动是[地震工程](@entry_id:748777)和灾害评估中的核心挑战。为了实现这一目标，我们需要能够精确模拟[地震波](@entry_id:164985)从震源到地表的完整传播过程。有限差分法（FDM）作为一种强大而灵活的数值工具，能够处理复杂的地下介质结构，因此在[计算地震学](@entry_id:747635)中得到了广泛应用。然而，将描述波传播的连续物理方程转化为一个稳定、精确且高效的计算机代码，涉及到一系列复杂的理论与技术挑战，这也是本文旨在解决的知识鸿沟。

通过本文的学习，您将系统地掌握地震动[有限差分](@entry_id:167874)模拟的完[整流](@entry_id:197363)程。我们首先在“原理与机制”一章中，深入剖析控制[弹性波传播](@entry_id:201422)的物理方程，并详细介绍如何通过[空间离散化](@entry_id:172158)（特别是[交错网格](@entry_id:147661)技术）和[时间积分](@entry_id:267413)将其转化为[数值算法](@entry_id:752770)，同时探讨数值稳定性和精度的关键问题。接着，在“应用与交叉学科联系”一章中，我们将理论应用于更真实的场景，探讨如何模拟具有地形、[粘弹性](@entry_id:148045)和各向异性等复杂特征的地球介质，并展示该技术如何与高性能计算等领域紧密结合。最后，“动手实践”部分将提供具体的编程练习，帮助您巩固对数值频散、稳定性等核心概念的理解，将理论知识转化为实践能力。

## 原理与机制

本章在前一章介绍性概述的基础上，深入探讨了利用[有限差分](@entry_id:167874)方法进行[地震地面运动](@entry_id:748778)模拟的根本原理与核心机制。我们将从控制[弹性波传播](@entry_id:201422)的物理方程出发，系统地建立一个将连续介质物理问题转化为离散数值模型进行求解的完整框架。这一过程涵盖了震源的数学表征、空间与时间上的[离散化方法](@entry_id:272547)、数值稳定性与精度的保证，以及计算区域中物理与人工边界的处理。

### [弹性动力学](@entry_id:175818)控制方程

地震波在地球介质中的传播，本质上遵循弹性介质中的动力学规律。对这些规律的数学描述构成了我们[数值模拟](@entry_id:137087)的起点。

描述弹性介质中波动的方程可以有多种形式，其中最经典的是基于位移场的[二阶偏微分方程](@entry_id:175326)组。该[方程组](@entry_id:193238)直接源于[牛顿第二定律](@entry_id:274217)（以[柯西动量方程](@entry_id:187010)的形式）与[广义胡克定律](@entry_id:203555)的结合。对于均匀各向同性介质，位移向量 $\mathbf{u}(\mathbf{x}, t)$ 满足**[纳维-柯西方程](@entry_id:189211) (Navier-Cauchy equation)**：

$$
\rho\,\frac{\partial^2 \mathbf{u}}{\partial t^2} \;=\; (\lambda+2\mu)\,\nabla(\nabla\cdot\mathbf{u}) \;-\; \mu\,\nabla\times(\nabla\times\mathbf{u}) \;+\; \mathbf{f}
$$

其中，$\rho$ 是介质密度，$\lambda$ 和 $\mu$ 是**拉梅参数 (Lamé parameters)**，$\mathbf{f}$ 是单位体积的体力密度。这个[方程组](@entry_id:193238)优雅地将[P波](@entry_id:178440)（压缩，由 $\nabla(\nabla\cdot\mathbf{u})$ 项主导）和[S波](@entry_id:174890)（剪切，由 $\nabla\times(\nabla\times\mathbf{u})$ 项主导）的运动[解耦](@entry_id:637294)开来。然而，尽管其形式简洁且未知量较少（仅3个位移分量），但在[有限差分](@entry_id:167874)模拟中，尤其是在处理[非均匀介质](@entry_id:750241)时，它存在一些不便。例如，方程中包含二阶空间导数，且在介质参数 $\lambda(\mathbf{x})$ 和 $\mu(\mathbf{x})$ 随空间变化时，其展开形式会变得非常复杂。

为了更便于数值处理，我们通常采用一个等价的一阶[方程组](@entry_id:193238)形式，即**速度-应力[方程组](@entry_id:193238) (velocity-stress formulation)**。该系统将问题分解为两个耦合的[一阶偏微分方程](@entry_id:178306)。第一个方程是**[动量守恒](@entry_id:149964)定律**，它将[质点](@entry_id:186768)加速度与应力[张量的散度](@entry_id:191736)联系起来：

$$
\rho\,\frac{\partial v_i}{\partial t} \;=\; \frac{\partial \sigma_{ij}}{\partial x_j} \;+\; f_i
$$

这里，$v_i(\mathbf{x}, t)$ 是[质点](@entry_id:186768)速度分量（即 $v_i = \partial u_i / \partial t$），$\sigma_{ij}(\mathbf{x}, t)$ 是**柯西应力张量 (Cauchy stress tensor)**，$f_i$ 是[体力](@entry_id:174230)。方程中使用了爱因斯坦求和约定。

第二个方程来源于**本构关系**（胡克定律）的时间导数形式。对于[各向同性线弹性](@entry_id:185899)介质，应力率与[速度梯度](@entry_id:261686)之间存在如下关系：

$$
\frac{\partial \sigma_{ij}}{\partial t} \;=\; \lambda\,\delta_{ij}\,\frac{\partial v_k}{\partial x_k} \;+\; \mu\left(\frac{\partial v_i}{\partial x_j} \;+\; \frac{\partial v_j}{\partial x_i}\right)
$$

其中 $\delta_{ij}$ 是克罗内克符号。这两个方程共同构成了一个包含9个未知数（3个速度分量和6个独立的对称应力分量 $\sigma_{ij} = \sigma_{ji}$）的[一阶偏微分方程](@entry_id:178306)组。

这种一阶形式对[有限差分法](@entry_id:147158)尤为有利 。首先，它只涉及一阶空间和时间导数，这使得离散化更为直接和准确。其次，介质的非均匀性（即 $\rho(\mathbf{x})$, $\lambda(\mathbf{x})$, $\mu(\mathbf{x})$）可以自然地包含在方程中，而无需处理复杂的[高阶导数](@entry_id:140882)[交叉](@entry_id:147634)项。此外，应力分量作为基本变量，使得施加应力边界条件（如地表的自由表面）变得非常方便。因此，速度-应力[方程组](@entry_id:193238)是现代[计算地震学](@entry_id:747635)中有限差分模拟的首选控制方程。

### 震源的表征

为了模拟地震，我们必须在[弹性动力学](@entry_id:175818)方程中引入一个能够代表断层破裂过程的[源项](@entry_id:269111)。一个关键的物理约束是，地震是地球内部的[位错](@entry_id:157482)过程，它在一个包围震源的任意控制体积上不产生净外力或净外力矩。

一个简单的点状[体力](@entry_id:174230)源，形如 $f_i(\mathbf{x},t)=F_i(t)\,\delta(\mathbf{x}-\mathbf{x}_0)$（其中 $\delta$ 是狄拉克函数），代表一个作用在单点的力。对该力在一个包含 $\mathbf{x}_0$ 的体积上积分，会得到一个非零的[净力](@entry_id:163825) $F_i(t)$。这与地震的物理实际不符，因此不能用来准确模拟地震源 。

正确的表征方法是使用**矩张量 (moment tensor)**。矩张量源可以被视为一个等效的体力，其形式为力的偶对或更复杂的力多极子。在数学上，一个矩张量源 $M_{ij}(t)$ 可以通过向本构应力中添加一个非均匀应力项 $s_{ij}(\mathbf{x},t)=M_{ij}(t)\,\delta(\mathbf{x}-\mathbf{x}_0)$ 来引入。此时，[动量方程](@entry_id:197225)变为：

$$
\rho\,\ddot{u}_i = (\sigma_{ij} + s_{ij})_{,j} = \sigma_{ij,j} + M_{ij,j}(t)\,\delta(\mathbf{x}-\mathbf{x}_0)
$$

这里的等效体力为 $f_i^{\text{eq}} = \partial_j (M_{ij}(t)\,\delta(\mathbf{x}-\mathbf{x}_0))$。这个[体力](@entry_id:174230)是一个场的散度，根据散度定理，它在任何包围源点的体积上的积分都为零，因此满足**零[净力](@entry_id:163825)**条件。进一步可以证明，如果矩张量 $M_{ij}$ 是对称的（$M_{ij}=M_{ji}$），那么它所产生的[净力矩](@entry_id:166772)也为零 。这恰好与地震是由剪切[位错](@entry_id:157482)产生、[角动量守恒](@entry_id:156798)的物理本质相符。

在有限差分网格上实现矩张量源时，通常通过在相邻的网格单元或面上施加大小相等、方向相反的应力扰动来实现。这种离散方法天然地保持了零净力的特性，避免了向数值系统中引入非物理的动量 。

### [空间离散化](@entry_id:172158)：[有限差分法](@entry_id:147158)

有限差分法的核心思想是用定义在离散网格点上的函数值的[差商](@entry_id:136462)来近似[连续函数](@entry_id:137361)的导数。为了达到足够的精度，我们通常使用高阶差分格式。

考虑一个光滑的一维函数 $u(x)$，我们希望在一个均匀网格上近似其[一阶导数](@entry_id:749425) $\partial u/\partial x$。一个具有 $2p$ 阶精度的[中心差分格式](@entry_id:747203)，可以使用目标点两侧各 $p$ 个点来构造。其一般形式为：

$$
\frac{\partial u}{\partial x}\bigg|_{x_i} \approx \frac{1}{h} \sum_{j=1}^{p} a_j \left[ u(x_i + jh) - u(x_i - jh) \right]
$$

其中 $h$ 是网格间距。通过对 $u(x_i \pm jh)$ 进行泰勒级数展开，我们可以确定系数 $a_j$ 所需满足的条件以及格式的截断误差。展开后发现，由于格式的反对称性，所有偶数阶导数项都自动抵消了。为了使该格式能够近似[一阶导数](@entry_id:749425)，并消除直到 $h^{2p-2}$ 阶的误差项，系数必须满足以下线性方程组 ：

$$
\sum_{j=1}^{p} a_j j = \frac{1}{2}
$$
$$
\sum_{j=1}^{p} a_j j^m = 0 \quad \text{for all odd } m \in \{3, 5, \dots, 2p-1\}
$$

满足这些条件后，该格式的**[截断误差](@entry_id:140949) (truncation error)** 的[主导项](@entry_id:167418)为：

$$
E(h) = 2h^{2p} \left( \sum_{j=1}^{p} a_j j^{2p+1} \right) \frac{u^{(2p+1)}(x_i)}{(2p+1)!} + \mathcal{O}(h^{2p+2})
$$

这个结果表明，通过选择合适的系数，我们可以系统地构建任意偶数阶精度的[导数近似](@entry_id:142976)。

#### [交错网格](@entry_id:147661)

在速度-应力[方程组](@entry_id:193238)的离散化中，变量在网格上的布局至关重要。如果将所有速度和应力分量都定义在同一个网格点上（称为**[同位网格](@entry_id:175200) (collocated grid)**），计算空间导数时会遇到问题。例如，计算 $\partial \sigma_{xx} / \partial x$ 需要一个跨越两个网格单元的差分格式（如 $( \sigma_{i+1} - \sigma_{i-1} ) / (2h)$），这种格式会产生[数值不稳定性](@entry_id:137058)，即所谓的**[棋盘效应](@entry_id:635672) (checkerboarding)**。

为了克服这个问题，我们采用**[交错网格](@entry_id:147661) (staggered grid)**。在这种布局中，不同的变量被定义在网格单元的不同位置（如体心、面心、棱心）。对于三维[弹性动力学](@entry_id:175818)方程，一个经典且高效的布局是 Virieux (1986) 提出的[交错网格](@entry_id:147661)方案 。其布局如下：
*   **法向应力** ($\sigma_{xx}, \sigma_{yy}, \sigma_{zz}$) 定义在网格单元的**体心** $(i, j, k)$。
*   **速度分量** ($v_x, v_y, v_z$) 定义在对应方向的**面心**上。例如，$v_x$ 定义在 $(i+1/2, j, k)$，$v_y$ 定义在 $(i, j+1/2, k)$，而 $v_z$ 定义在 $(i, j, k+1/2)$。
*   **[剪切应力](@entry_id:137139)** ($\sigma_{xy}, \sigma_{xz}, \sigma_{yz}$) 定义在相应平面的**棱心**上。例如，$\sigma_{xy}$ 定义在 $(i+1/2, j+1/2, k)$。

让我们以更新 $v_x$ 的方程为例，看看这种布局的巧妙之处：
$\rho \partial_t v_x = \partial_x \sigma_{xx} + \partial_y \sigma_{xy} + \partial_z \sigma_{xz}$。
$v_x$ 定义在 $(i+1/2, j, k)$。
1.  计算 $\partial_x \sigma_{xx}$：$\sigma_{xx}$ 定义在它两侧的体心 $(i+1, j, k)$ 和 $(i, j, k)$。因此，其差分天然地中心化在 $v_x$ 的位置：$(\sigma_{xx}|_{i+1,j,k} - \sigma_{xx}|_{i,j,k})/\Delta x$。
2.  计算 $\partial_y \sigma_{xy}$：$\sigma_{xy}$ 定义在它上下两侧的棱心 $(i+1/2, j+1/2, k)$ 和 $(i+1/2, j-1/2, k)$。其差分也天然地中心化在 $v_x$ 的位置：$(\sigma_{xy}|_{i+1/2,j+1/2,k} - \sigma_{xy}|_{i+1/2,j-1/2,k})/\Delta y$。
3.  计算 $\partial_z \sigma_{xz}$：同理，其差分也是中心化的。

可以验证，对于所有速度和应力分量的[更新方程](@entry_id:264802)，[交错网格](@entry_id:147661)都能确保所有空间导数的[有限差分近似](@entry_id:749375)都是最紧凑的[二阶中心差分](@entry_id:170774)。这种布局不仅避免了[棋盘效应](@entry_id:635672)，还提高了[数值精度](@entry_id:173145)。

### [时间离散化](@entry_id:169380)：[时间步进格式](@entry_id:755998)

[空间离散化](@entry_id:172158)后，原来的[偏微分方程组](@entry_id:172573)（PDEs）转化为一个非常庞大的[常微分方程组](@entry_id:266774)（ODEs），其形式可写为 $\partial_t \mathbf{q} = \mathbf{L}\mathbf{q}$，其中 $\mathbf{q}$ 是包含所有网格点上速度和应力值的状态向量，$\mathbf{L}$ 是包含空间差分算子的[大型稀疏矩阵](@entry_id:144372)。对于无损弹性介质，$\mathbf{L}$ 是一个反[对称算子](@entry_id:272489)，其[特征值](@entry_id:154894)是纯虚数。下一步是选择一个合适的[数值格式](@entry_id:752822)来对时间进行积分。

一个常用且高效的格式是二阶**[蛙跳格式](@entry_id:163462) (leapfrog scheme)**。它通过中心差分来近似时间导数，其更新形式为：

$$
\mathbf{q}^{n+1} = \mathbf{q}^{n-1} + 2\,\Delta t\,\mathbf{L}\,\mathbf{q}^n
$$

其中 $\Delta t$ 是时间步长，$n$ 是时间步的索引。[蛙跳格式](@entry_id:163462)的优点是计算效率高，且对于无损[波动方程](@entry_id:139839)是**非耗散 (non-dissipative)** 的，即在稳定范围内，它不会人为地衰减波的振幅。其[放大因子](@entry_id:144315)的模长为1。然而，它的时间精度是二阶的，并且有严格的稳定性限制 。

为了追求更高的精度，可以使用**[龙格-库塔方法](@entry_id:144251) ([Runge-Kutta](@entry_id:140452) methods)**。经典的四阶四级[龙格-库塔](@entry_id:140452)格式（RK4）通过在每个时间步内进行四次“试探性”的计算来达到四阶时间精度。对于 $\partial_t \mathbf{q} = \mathbf{L}\mathbf{q}$，其更新过程如下：

$$
\mathbf{k}_1=\mathbf{L}\,\mathbf{q}^n, \quad
\mathbf{k}_2=\mathbf{L}\! \left(\mathbf{q}^n+\frac{\Delta t}{2}\,\mathbf{k}_1\right), \quad
\mathbf{k}_3=\mathbf{L}\! \left(\mathbf{q}^n+\frac{\Delta t}{2}\,\mathbf{k}_2\right), \quad
\mathbf{k}_4=\mathbf{L}\! \left(\mathbf{q}^n+\Delta t\,\mathbf{k}_3\right)
$$
$$
\mathbf{q}^{n+1}=\mathbf{q}^n+\frac{\Delta t}{6}\Big(\mathbf{k}_1+2\,\mathbf{k}_2+2\,\mathbf{k}_3+\mathbf{k}_4\Big)
$$

RK4的[相位误差](@entry_id:162993)远小于同等时间步长的[蛙跳格式](@entry_id:163462)。然而，它有一个重要的特性：对于无损波动方程，RK4是**弱耗散的 (weakly dissipative)**，即数值波的振幅会随着时间非常缓慢地衰减。此外，RK4每步需要计算四次空间算子 $\mathbf{L}$，计算成本远高于[蛙跳格式](@entry_id:163462)。不过，RK4的稳定性区域比[蛙跳格式](@entry_id:163462)更大，允许使用更大的时间步长 。例如，对于纯虚数[特征值](@entry_id:154894)，RK4允许的无量纲时间步长 $| \omega_{d,\max} | \,\Delta t$ 的上限约为 $2\sqrt{2}$，而[蛙跳格式](@entry_id:163462)的上限仅为 $1$。

### 精度与稳定性

成功的[有限差分](@entry_id:167874)模拟必须同时保证精度和稳定性。精度关心的是数值解与真实解的接近程度，而稳定性则要求任何初始误差都不会在计算过程中被无限放大。

#### 数值频散

**数值频散 (Numerical dispersion)** 是离散化引入的一种非物理效应，即数值波的相速度会依赖于其频率（或[波数](@entry_id:172452)），即使在物理上非频散的介质中也是如此。这会导致波形在传播过程中失真，不同频率的成分以不同的速度传播而分离开。对于前面提到的[二阶中心差分](@entry_id:170774)格式，高频波（波长接近网格尺寸）的[传播速度](@entry_id:189384)会显著慢于真实速度。数值频散的大小取决于[无量纲参数](@entry_id:169335) $kh$（波数与网格尺寸之积）和**库朗数 (Courant number)** $S = c \Delta t / h$。

这种数值频散必须与**物理频散 (physical dispersion)** 严格区分开。物理频散是介质本身的固有属性，常见于粘弹性介质。在这种介质中，存在能量耗散（衰减），其物性参数（如弹性模量）是频率的复函数。根据**克拉默-克若尼关系 (Kramers-Kronig relations)**，衰减的存在必然导致相速度随频率变化。物理频散是我们需要[精确模拟](@entry_id:749142)的真实物理现象，而数值频散是需要尽可能抑制的数值误差 。

为了控制数值频散，一个关键的实践准则是保证用足够多的网格点来采样最短的波长。我们定义一个无量纲分辨率要求 $N_\lambda$，即每个最[小波](@entry_id:636492)长内至少包含的点数。对于给定的[最大模](@entry_id:195246)拟频率 $f_{\max}$ 和介质中的最[小波](@entry_id:636492)速 $v_{\min}$，对应的最[小波](@entry_id:636492)长为 $\lambda_{\min} = v_{\min} / f_{\max}$。为了满足分辨率要求，网格尺寸 $h$ 必须满足 ：

$$
h \le \frac{\lambda_{\min}}{N_\lambda} = \frac{v_{\min}}{f_{\max} N_\lambda}
$$

通常，$N_\lambda$ 的取值在5到10之间，具体取决于所需的精度和差分格式的阶数。

#### [Courant-Friedrichs-Lewy](@entry_id:175598) (CFL) 稳定性条件

对于[显式时间积分](@entry_id:165797)格式，时间步长 $\Delta t$ 不能任意取大，它受到**[CFL稳定性条件](@entry_id:747253)**的限制。该条件背后的物理直觉是，在一个时间步内，信息（即波）传播的距离不能超过一个网格单元的尺寸。

我们可以通过**[冯·诺依曼稳定性分析](@entry_id:145718) (von Neumann stability analysis)** 来精确推导这一条件。以二维[声波方程](@entry_id:746230)的二阶[蛙跳格式](@entry_id:163462)为例，其稳定性条件为 ：

$$
\sigma = \frac{c \, \Delta t}{h} \le \frac{1}{\sqrt{2}}
$$

其中 $\sigma$ 是库朗数。在[非均匀介质](@entry_id:750241)中，必须使用模型中的最大波速 $c_{\max}$ 来确定全局的最大允许时间步长 $\Delta t_{\max}$：

$$
\Delta t \le \Delta t_{\max} = \frac{h}{c_{\max} \sqrt{d}}
$$

其中 $d$ 是空间维度（在三维情况下为 $\sqrt{3}$）。

在实际的大规模模拟中，从业者通常会选择一个比理论最大值 $\Delta t_{\max}$ 更小的时间步，例如取其 $70\%$ 到 $90\%$。这是因为理论分析是在理想条件下（均匀介质、周期边界）得出的。真实模拟中存在的[复杂介质](@entry_id:164088)界面、人工[吸收边界](@entry_id:201489)等因素都可能使稳定性条件变得更苛刻。同时，减小时间步长（即减小库朗数）也能有效降低数值频散，提高模拟的整体精度 。

### 计算域的边界条件

有限差分模拟只能在有限的计算区域内进行，因此必须妥善处理区域的边界。

#### 物理自由表面

地球的表面是一个与空气接触的**自由表面 (free surface)**。由于空气的密度和刚度远小于岩石和土壤，地震波引起的空气动力学应力可以忽略不计。根据界面两侧牵[引力](@entry_id:175476)连续的原则 $t_i^{\text{solid}} = t_i^{\text{air}}$，我们可以近似认为地表的动态牵[引力](@entry_id:175476)为零 。

牵[引力](@entry_id:175476)矢量 $t_i$ 由[应力张量](@entry_id:148973)和表面法向矢量 $n_j$ 给出：$t_i = \sigma_{ij}n_j$。对于位于 $z=0$ 的水平地表，其法向为 $(0,0,1)$。因此，自由表面条件转化为三个应力分量为零：

$$
\sigma_{xz}(x,y,z=0,t) = 0
$$
$$
\sigma_{yz}(x,y,z=0,t) = 0
$$
$$
\sigma_{zz}(x,y,z=0,t) = 0
$$

这些条件表明，在地表，所有与表面垂直的平面上的剪切应力和[法向应力](@entry_id:260622)都必须为零。在有限差分实现中，这些条件通过在虚拟网格点上设置应力值来近似满足。

#### 人工[吸收边界](@entry_id:201489)

计算区域的侧面和底面是人为截断的，并非物理边界。如果不加处理，传播到这些边界的波会发生非物理的反射，污染整个计算结果。为了模拟波传播到无穷远处，必须在这些人工边界上设置**[吸收边界条件](@entry_id:164672) (absorbing boundary conditions)**。

一个简单的方法是**海绵层 (sponge layer)**。它在边界附近区域的[动量方程](@entry_id:197225)中增加一个与速度成正比的阻尼项，强度随深入边界而增加。这种方法能衰减波的能量，但其缺点是，阻尼项的引入改变了介质的[波阻抗](@entry_id:276571)，会在海绵层与内部物理域的交界处产生新的反射 。

一个更先进和高效的方法是**完全匹配层 (Perfectly Matched Layer, PML)**。PML的设计思想是构造一个在理论上对所有[入射角](@entry_id:192705)和频率的波都完全无反射的吸收层。这是通过在[频域](@entry_id:160070)中对空间坐标进行复数延拓（complex coordinate stretching）来实现的。例如，将导数算子 $\partial_x$ 替换为 $(1 + i\sigma(x)/\omega)^{-1}\partial_x$。这种变换构造了一个特殊的[各向异性介质](@entry_id:187796)，其[波阻抗](@entry_id:276571)在与物理域的交界处完美匹配，从而消除了反射。进入PML的波，其振幅会随着传播距离指数衰减 。

在[时域有限差分](@entry_id:141865)中实现PML比较复杂，因为它涉及到[频域](@entry_id:160070)中的 $1/\omega$ 项，对应于时域中的积分运算。这通常通过引入辅助记忆变量（如[卷积PML](@entry_id:747866)，CPML）或分裂场变量来实现。尽管离散化会破坏PML的“完美”无反射特性，但其吸收效果远优于简单的海绵层，是当前[地震波模拟](@entry_id:754654)中的标准做法 。