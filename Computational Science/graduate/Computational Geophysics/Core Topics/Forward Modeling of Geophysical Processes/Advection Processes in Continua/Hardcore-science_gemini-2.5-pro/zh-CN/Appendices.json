{
    "hands_on_practices": [
        {
            "introduction": "在连续介质物理学中，守恒定律是描述系统性质如何随时间演变的基础。对于输运过程，控制方程可以有多种形式，其中平流形式和守恒形式最为关键。本练习旨在通过推导和计算，帮助您深入理解这两种形式之间的联系，以及如何利用基于控制体的积分平衡来量化一个量的总变化率，这正是有限体积法的核心思想。",
            "id": "3574946",
            "problem": "考虑一个二维空间中的可压缩连续体，其速度场为 $\\mathbf{u}(\\mathbf{x},t) = (u_x,u_y) = (\\alpha x, \\beta y)$，其中 $\\alpha$ 和 $\\beta$ 是实常数，且 $\\alpha + \\beta \\neq 0$。设质量密度为 $\\rho(\\mathbf{x},t)$，$\\phi(\\mathbf{x},t)$ 为一个物质守恒的标量属性（例如，单位质量的被动示踪剂），因此其物质导数满足 $D\\phi/Dt = 0$。假设质量连续性方程成立：$\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$。在时间 $t=0$ 时，密度在空间上是均匀的，其值为 $\\rho_0  0$。\n\n(a) 仅从连续性方程和物质导数的定义 $D(\\cdot)/Dt = \\partial_t(\\cdot) + \\mathbf{u} \\cdot \\nabla(\\cdot)$ 出发，推导广延量 $\\rho \\phi$ 的输运方程的守恒（通量-散度）形式。\n\n(b) 使用(a)部分得到的守恒形式，写出在一个固定的矩形控制体积 $V = [0,L_x] \\times [0,L_y]$（位于 $x$-$y$ 平面内，并沿 $z$ 方向均匀拉伸至厚度 $W$）上的相应积分平衡。明确说明边界 $\\partial V$ 上的通量项，并指明单位法线的方向约定。\n\n(c) 对于给定数据 $L_x = 1\\,\\mathrm{m}$，$L_y = 2\\,\\mathrm{m}$，$W = 1\\,\\mathrm{m}$，$\\alpha = 1\\,\\mathrm{s}^{-1}$，$\\beta = -\\tfrac{1}{2}\\,\\mathrm{s}^{-1}$，$\\rho_0 = 1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，以及 $\\phi(x,y,0) = (x/L_x)^2 + \\gamma (y/L_y)$ (其中 $\\gamma = 3$，无量纲)，计算在时间 $t=0$ 时总广延量 $\\int_V \\rho \\phi \\,\\mathrm{d}V$ 的瞬时变化率。将最终速率以 $\\mathrm{kg}\\,\\mathrm{s}^{-1}$ 表示，并四舍五入到四位有效数字。",
            "solution": "我们从基本陈述开始：质量连续性方程 $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$ 和物质导数的定义 $D(\\cdot)/Dt = \\partial_t(\\cdot) + \\mathbf{u} \\cdot \\nabla(\\cdot)$。标量 $\\phi$ 是物质守恒的，因此 $D\\phi/Dt = 0$。\n\n(a) 为了获得广延量 $\\rho \\phi$ 的守恒形式，我们计算\n$$\n\\partial_t(\\rho \\phi) + \\nabla \\cdot (\\rho \\phi \\mathbf{u}).\n$$\n使用乘法法则，\n$$\n\\partial_t(\\rho \\phi) = \\phi \\,\\partial_t \\rho + \\rho \\,\\partial_t \\phi,\n$$\n以及标量 $f$ 和矢量 $\\mathbf{u}$ 的输运散度恒等式，\n$$\n\\nabla \\cdot (f \\mathbf{u}) = f \\,\\nabla \\cdot \\mathbf{u} + \\mathbf{u} \\cdot \\nabla f.\n$$\n令 $f = \\rho \\phi$，我们写出\n$$\n\\nabla \\cdot (\\rho \\phi \\mathbf{u}) = \\phi \\,\\nabla \\cdot (\\rho \\mathbf{u}) + \\rho \\,\\mathbf{u} \\cdot \\nabla \\phi.\n$$\n因此，\n\\begin{align*}\n\\partial_t(\\rho \\phi) + \\nabla \\cdot (\\rho \\phi \\mathbf{u})\n= \\phi \\,\\partial_t \\rho + \\rho \\,\\partial_t \\phi + \\phi \\,\\nabla \\cdot (\\rho \\mathbf{u}) + \\rho \\,\\mathbf{u} \\cdot \\nabla \\phi \\\\\n= \\phi \\big(\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u})\\big) + \\rho \\big(\\partial_t \\phi + \\mathbf{u} \\cdot \\nabla \\phi\\big).\n\\end{align*}\n应用连续性方程 $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$ 和物质守恒条件 $D\\phi/Dt = \\partial_t \\phi + \\mathbf{u} \\cdot \\nabla \\phi = 0$，我们得到守恒形式\n$$\n\\partial_t(\\rho \\phi) + \\nabla \\cdot (\\rho \\phi \\mathbf{u}) = 0.\n$$\n\n(b) 该守恒型偏微分方程意味着在一个固定的控制体积 $V$（具有向外的单位法线 $\\mathbf{n}$）上存在一个积分平衡：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_V \\rho \\phi \\,\\mathrm{d}V + \\int_{\\partial V} \\rho \\phi \\,\\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S = 0.\n$$\n在这里，$\\mathbf{n}$ 是矩形棱柱体 $V = [0,L_x] \\times [0,L_y] \\times [0,W]$ 每个面上的向外法线。由于速度场没有 $z$ 分量且在 $z$ 方向上是均匀的，只有四个侧面（其向外法线为 $\\pm \\hat{\\mathbf{i}}$ 和 $\\pm \\hat{\\mathbf{j}}$）对通量有贡献。顶部和底部的面（法线为 $\\pm \\hat{\\mathbf{k}}$）的通量贡献为零，因为 $\\mathbf{u} \\cdot \\hat{\\mathbf{k}} = 0$。\n\n(c) 我们根据给定数据计算 $t=0$ 时的瞬时变化率。在 $t=0$ 时，密度是均匀的：$\\rho(\\mathbf{x},0) = \\rho_0$，标量为 $\\phi(x,y,0) = (x/L_x)^2 + \\gamma (y/L_y)$。积分平衡得出\n$$\n\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_V \\rho \\phi \\,\\mathrm{d}V \\right|_{t=0}\n= - \\int_{\\partial V} \\rho \\phi \\,\\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S \\Big|_{t=0}.\n$$\n由于 $\\rho_0$ 均匀且几何形状是厚度为 $W$ 的矩形棱柱体，边界积分简化为四个侧面上的总和：\n\\begin{align*}\n\\int_{\\partial V} \\rho \\phi \\,\\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S\n= \\rho_0 \\Bigg[\n\\int_{y=0}^{L_y} \\int_{z=0}^{W} \\phi(L_x,y,0)\\, (\\alpha L_x)\\, \\mathrm{d}z\\,\\mathrm{d}y \\\\\n\\quad + \\int_{x=0}^{L_x} \\int_{z=0}^{W} \\phi(x,L_y,0)\\, (\\beta L_y)\\, \\mathrm{d}z\\,\\mathrm{d}x \\\\\n\\quad + \\int_{y=0}^{L_y} \\int_{z=0}^{W} \\phi(0,y,0)\\, (-\\alpha \\cdot 0)\\, \\mathrm{d}z\\,\\mathrm{d}y \\\\\n\\quad + \\int_{x=0}^{L_x} \\int_{z=0}^{W} \\phi(x,0,0)\\, (-\\beta \\cdot 0)\\, \\mathrm{d}z\\,\\mathrm{d}x\n\\Bigg].\n\\end{align*}\n后两个积分为零，因为 $u_x(0,y) = \\alpha \\cdot 0 = 0$ 且 $u_y(x,0) = \\beta \\cdot 0 = 0$。计算剩余的贡献，\n\\begin{align*}\n\\int_{y=0}^{L_y} \\phi(L_x,y,0)\\, \\mathrm{d}y\n= \\int_{0}^{L_y} \\left( (L_x/L_x)^2 + \\gamma \\frac{y}{L_y} \\right) \\mathrm{d}y\n= \\int_{0}^{L_y} \\left( 1 + \\gamma \\frac{y}{L_y} \\right) \\mathrm{d}y \\\\\n= L_y \\left(1 + \\frac{\\gamma}{2}\\right),\n\\\\\n\\int_{x=0}^{L_x} \\phi(x,L_y,0)\\, \\mathrm{d}x\n= \\int_{0}^{L_x} \\left( \\left(\\frac{x}{L_x}\\right)^2 + \\gamma \\right) \\mathrm{d}x\n= \\left[\\frac{x^3}{3 L_x^2}\\right]_{0}^{L_x} + \\gamma L_x\n= \\frac{L_x}{3} + \\gamma L_x.\n\\end{align*}\n因此，\n\\begin{align*}\n\\int_{\\partial V} \\rho \\phi \\,\\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S\n= \\rho_0 \\left[ (\\alpha L_x) \\, W \\, L_y \\left(1 + \\frac{\\gamma}{2}\\right) + (\\beta L_y) \\, W \\left( \\frac{L_x}{3} + \\gamma L_x \\right) \\right] \\\\\n= \\rho_0 \\, W \\, L_x \\, L_y \\left[ \\alpha \\left(1 + \\frac{\\gamma}{2}\\right) + \\beta \\left( \\frac{1}{3} + \\gamma \\right) \\right].\n\\end{align*}\n于是，\n$$\n\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_V \\rho \\phi \\,\\mathrm{d}V \\right|_{t=0}\n= - \\rho_0 \\, W \\, L_x \\, L_y \\left[ \\alpha \\left(1 + \\frac{\\gamma}{2}\\right) + \\beta \\left( \\frac{1}{3} + \\gamma \\right) \\right].\n$$\n代入给定值 $L_x = 1\\,\\mathrm{m}$，$L_y = 2\\,\\mathrm{m}$，$W = 1\\,\\mathrm{m}$，$\\alpha = 1\\,\\mathrm{s}^{-1}$，$\\beta = -\\tfrac{1}{2}\\,\\mathrm{s}^{-1}$，$\\rho_0 = 1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，以及 $\\gamma = 3$：\n\\begin{align*}\n\\left[ \\alpha \\left(1 + \\frac{\\gamma}{2}\\right) + \\beta \\left( \\frac{1}{3} + \\gamma \\right) \\right]\n= 1 \\left(1 + \\frac{3}{2}\\right) + \\left(-\\frac{1}{2}\\right) \\left( \\frac{1}{3} + 3 \\right) \\\\\n= \\frac{5}{2} - \\frac{1}{2} \\cdot \\frac{10}{3}\n= \\frac{5}{2} - \\frac{5}{3}\n= \\frac{15 - 10}{6}\n= \\frac{5}{6}.\n\\end{align*}\n因此，\n\\begin{align*}\n\\left.\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_V \\rho \\phi \\,\\mathrm{d}V \\right|_{t=0}\n= - \\rho_0 \\, W \\, L_x \\, L_y \\cdot \\frac{5}{6}\n= - 1000 \\cdot 1 \\cdot 1 \\cdot 2 \\cdot \\frac{5}{6} \\\\\n= - \\frac{10000}{6}\n= - \\frac{5000}{3} \\,\\mathrm{kg}\\,\\mathrm{s}^{-1}.\n\\end{align*}\n数值上，这大约是 $-1.666\\overline{6} \\times 10^{3}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$。四舍五入到四位有效数字并以 $\\mathrm{kg}\\,\\mathrm{s}^{-1}$ 表示，得到 $-1.667 \\times 10^{3}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$。\n\n此计算验证了由守恒形式所蕴含的积分平衡，并为给定的控制体积和场提供了所要求的瞬时变化率。",
            "answer": "$$\\boxed{-1.667 \\times 10^{3}}$$"
        },
        {
            "introduction": "将连续的偏微分方程转化为离散的代数方程是计算建模的核心，但这一过程也引入了新的约束。其中最著名的便是Courant-Friedrichs-Lewy (CFL) 条件，它严格地将时间步长、网格间距和物理速度联系在一起，决定了显式数值格式的稳定性。通过这个练习，您将从第一性原理出发，为二维平流问题推导CFL条件，并分析不同维度处理方式（分裂与非分裂格式）对稳定性约束的影响，从而掌握保证数值模拟稳定性的关键。",
            "id": "3574958",
            "problem": "考虑一个被动标量场 $q(x,y,t)$ 的二维平流，其由守恒律 $\\partial_{t} q + \\nabla \\cdot (\\boldsymbol{u} q) = 0$ 和一个空间均匀的速度场 $\\boldsymbol{u} = (u,v)$ 控制。计算域通过均匀笛卡尔网格进行离散化，其在 $x$ 方向的间距为 $\\Delta x$，在 $y$ 方向的间距为 $\\Delta y$。空间离散化采用显式、非分裂的一阶迎风有限体积格式，并使用显式前向欧拉步在时间上推进。速度大小为 $|\\boldsymbol{u}| = V$，其方向与 $x$ 轴正向成 $\\theta$ 角，因此 $u = V \\cos(\\theta)$ 且 $v = V \\sin(\\theta)$。\n\n从单调显式格式的守恒性和稳定性的第一性原理出发，推导在这种非分裂更新下，能确保离散 $L^{\\infty}$ 范数不增，并保持 $q$ 的离散极值原理的最大稳定时间步长。然后，对于一个计算地球物理示踪剂输运应用中的以下科学真实参数集，计算此最大稳定时间步长：$\\Delta x = 50\\,\\mathrm{m}$，$\\Delta y = 200\\,\\mathrm{m}$，$V = 1.8\\,\\mathrm{m/s}$，以及 $\\theta = \\pi/3$ 弧度。\n\n最后，通过将您推导的非分裂稳定性约束与维度分裂的一阶迎风更新（该更新在一个时长为 $\\Delta t$ 的时间步内依次应用 $x$ 方向平流和 $y$ 方向平流）的约束进行比较，评估多维 Courant–Friedrichs–Lewy (CFL) 约束的影响。请根据显式更新的结构，解释哪个约束更严格及其原因。\n\n仅报告非分裂格式的最大稳定时间步长，四舍五入到四位有效数字，并以秒为单位表示。",
            "solution": "问题陈述已通过验证，被确定为一个有效的、适定的计算科学问题。它具有科学依据，是客观的，并包含进行唯一求解所需的所有必要信息。\n\n被动标量场 $q(x,y,t)$ 平流的控制方程是守恒律：\n$$ \\partial_{t} q + \\nabla \\cdot (\\boldsymbol{u} q) = 0 $$\n鉴于速度场 $\\boldsymbol{u} = (u,v)$ 是空间均匀的，该方程简化为：\n$$ \\partial_{t} q + \\boldsymbol{u} \\cdot \\nabla q = 0 $$\n为推导有限体积格式，我们将守恒律在一个面积为 $\\Delta x \\Delta y$、中心位于 $(x_i, y_j)$ 的计算单元 $\\Omega_{i,j}$ 上进行积分。\n$$ \\iint_{\\Omega_{i,j}} \\partial_{t} q \\,dA + \\iint_{\\Omega_{i,j}} \\nabla \\cdot (\\boldsymbol{u} q) \\,dA = 0 $$\n对第二项使用散度定理，我们将面积分转换为沿单元边界 $\\partial\\Omega_{i,j}$ 的线积分：\n$$ \\frac{d}{dt} \\iint_{\\Omega_{i,j}} q \\,dA + \\oint_{\\partial\\Omega_{i,j}} (\\boldsymbol{u} q) \\cdot \\boldsymbol{n} \\,ds = 0 $$\n令 $q_{i,j}(t)$ 代表单元平均值，$q_{i,j} \\approx \\frac{1}{\\Delta x \\Delta y} \\iint_{\\Omega_{i,j}} q \\,dA$。方程变为：\n$$ \\Delta x \\Delta y \\frac{dq_{i,j}}{dt} + (\\text{Flux}_{east} - \\text{Flux}_{west}) + (\\text{Flux}_{north} - \\text{Flux}_{south}) = 0 $$\n通过单元面的通量近似如下：\n$$ \\text{Flux}_{east} \\approx (u q_{i+1/2,j}) \\Delta y $$\n$$ \\text{Flux}_{west} \\approx (u q_{i-1/2,j}) \\Delta y $$\n$$ \\text{Flux}_{north} \\approx (v q_{i,j+1/2}) \\Delta x $$\n$$ \\text{Flux}_{south} \\approx (v q_{i,j-1/2}) \\Delta x $$\n其中 $q_{i \\pm 1/2, j}$ 和 $q_{i, j \\pm 1/2}$ 是单元面上的标量值。半离散方程为：\n$$ \\frac{dq_{i,j}}{dt} = - \\frac{u q_{i+1/2,j} - u q_{i-1/2,j}}{\\Delta x} - \\frac{v q_{i,j+1/2} - v q_{i,j-1/2}}{\\Delta y} $$\n对于一阶迎风格式，单元面上的值取自迎风单元。这可以使用速度的正部和负部来一般性地表示。在面 $i+1/2$ 处 $x$ 方向的数值通量为 $F_{i+1/2} = u^{+} q_{i,j} + u^{-} q_{i+1,j}$，其中 $u^{+} = \\max(u,0)$ 且 $u^{-} = \\min(u,0)$。这等价于 $F_{i+1/2} = \\frac{u+|u|}{2}q_{i,j} + \\frac{u-|u|}{2}q_{i+1,j}$。\n$x$ 方向的净通量散度近似为：\n$$ \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} = \\frac{1}{\\Delta x} \\left[ (u^{+}q_{i,j} + u^{-}q_{i+1,j}) - (u^{+}q_{i-1,j} + u^{-}q_{i,j}) \\right] $$\n对于 $y$ 方向也类似。半离散方程变为：\n$$ \\frac{dq_{i,j}}{dt} = - \\frac{1}{\\Delta x} \\left[ u^{+}(q_{i,j} - q_{i-1,j}) + u^{-}(q_{i+1,j} - q_{i,j}) \\right] - \\frac{1}{\\Delta y} \\left[ v^{+}(q_{i,j} - q_{i,j-1}) + v^{-}(q_{i,j+1} - q_{i,j}) \\right] $$\n应用前向欧拉时间步, $\\frac{q^{n+1}_{i,j} - q^n_{i,j}}{\\Delta t} = (\\dots)^n$：\n$$ q^{n+1}_{i,j} = q^n_{i,j} - \\frac{\\Delta t}{\\Delta x} \\left[ u^{+}(q^n_{i,j} - q^n_{i-1,j}) + u^{-}(q^n_{i+1,j} - q^n_{i,j}) \\right] - \\frac{\\Delta t}{\\Delta y} \\left[ v^{+}(q^n_{i,j} - q^n_{i,j-1}) + v^{-}(q^n_{i,j+1} - q^n_{i,j}) \\right] $$\n我们按时间层 $n$ 的空间索引对各项进行分组：\n$$ q^{n+1}_{i,j} = \\left( 1 - \\frac{\\Delta t}{\\Delta x}(u^{+} - u^{-}) - \\frac{\\Delta t}{\\Delta y}(v^{+} - v^{-}) \\right)q^n_{i,j} + \\frac{\\Delta t}{\\Delta x} u^{+} q^n_{i-1,j} - \\frac{\\Delta t}{\\Delta x} u^{-} q^n_{i+1,j} + \\frac{\\Delta t}{\\Delta y} v^{+} q^n_{i,j-1} - \\frac{\\Delta t}{\\Delta y} v^{-} q^n_{i,j+1} $$\n注意到 $u^{+} - u^{-} = |u|$ 且 $v^{+} - v^{-} = |v|$，更新方程简化为：\n$$ q^{n+1}_{i,j} = \\left( 1 - \\frac{|u|\\Delta t}{\\Delta x} - \\frac{|v|\\Delta t}{\\Delta y} \\right)q^n_{i,j} + \\frac{|u|\\Delta t}{\\Delta x} q^n_{upwind,x} + \\frac{|v|\\Delta t}{\\Delta y} q^n_{upwind,y} $$\n其中 $q^n_{upwind,x}$ 是 $x$ 方向的迎风值（$q^n_{i-1,j}$ 或 $q^n_{i+1,j}$），而 $q^n_{upwind,y}$ 是 $y$ 方向的迎风值。\n\n为使格式满足离散极值原理并具有不增的 $L^{\\infty}$ 范数，新值 $q^{n+1}_{i,j}$ 必须是旧值的凸组合。这要求模板中的所有系数都为非负。\n迎风单元的系数为 $\\frac{\\Delta t}{\\Delta x}u^{+}$、$-\\frac{\\Delta t}{\\Delta x}u^{-}$、$\\frac{\\Delta t}{\\Delta y}v^{+}$ 和 $-\\frac{\\Delta t}{\\Delta y}v^{-}$。对于任何 $u,v$，这些系数本质上都是非负的。\n关键条件来自于 $q^n_{i,j}$ 的系数：\n$$ 1 - \\frac{|u|\\Delta t}{\\Delta x} - \\frac{|v|\\Delta t}{\\Delta y} \\ge 0 $$\n这给出了非分裂、一阶迎风格式的 Courant-Friedrichs-Lewy (CFL) 稳定性约束：\n$$ \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} \\right) \\le 1 $$\n因此，最大稳定时间步长 $\\Delta t_{max}$ 为：\n$$ \\Delta t_{max} = \\frac{1}{\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y}} $$\n现在我们对给定的参数计算这个值：$\\Delta x = 50\\,\\mathrm{m}$，$\\Delta y = 200\\,\\mathrm{m}$，$V = 1.8\\,\\mathrm{m/s}$，以及 $\\theta = \\pi/3$ 弧度。\n速度分量为：\n$$ |u| = |V \\cos(\\theta)| = |1.8 \\cos(\\pi/3)| = |1.8 \\times 0.5| = 0.9\\,\\mathrm{m/s} $$\n$$ |v| = |V \\sin(\\theta)| = |1.8 \\sin(\\pi/3)| = |1.8 \\times \\frac{\\sqrt{3}}{2}| = 0.9\\sqrt{3}\\,\\mathrm{m/s} \\approx 1.5588457\\,\\mathrm{m/s} $$\n将这些值代入 $\\Delta t_{max}$ 的表达式中：\n$$ \\Delta t_{max} = \\frac{1}{\\frac{0.9}{50} + \\frac{0.9\\sqrt{3}}{200}} = \\frac{1}{0.018 + \\frac{1.5588457}{200}} $$\n$$ \\Delta t_{max} = \\frac{1}{0.018 + 0.0077942286} = \\frac{1}{0.0257942286} \\approx 38.7683\\,\\mathrm{s} $$\n四舍五入到四位有效数字，最大稳定时间步长为 $38.77\\,\\mathrm{s}$。\n\n为了进行比较，我们考虑一个维度分裂格式。这涉及两个顺序步骤：\n1. $x$ 方向的平流：$q^* = \\mathcal{L}_x(\\Delta t) q^n$。此步的稳定性条件是 $\\frac{|u|\\Delta t}{\\Delta x} \\le 1$。\n2. $y$ 方向的平流：$q^{n+1} = \\mathcal{L}_y(\\Delta t) q^*$。此步的稳定性条件是 $\\frac{|v|\\Delta t}{\\Delta y} \\le 1$。\n为使组合的分裂格式稳定，两个单独的步骤都必须稳定。这要求 $\\Delta t$ 同时满足两个约束：\n$$ \\Delta t \\le \\frac{\\Delta x}{|u|} \\quad \\text{and} \\quad \\Delta t \\le \\frac{\\Delta y}{|v|} $$\n这等效于关于最大时间步长的单个条件：\n$$ \\Delta t_{split, max} = \\min\\left(\\frac{\\Delta x}{|u|}, \\frac{\\Delta y}{|v|}\\right) $$\n我们来比较这两个约束。令 $C_x = \\frac{|u|\\Delta t}{\\Delta x}$ 和 $C_y = \\frac{|v|\\Delta t}{\\Delta y}$。\n- 非分裂约束：$C_x + C_y \\le 1$。\n- 分裂约束：$\\max(C_x, C_y) \\le 1$。\n由于 $C_x \\ge 0$ 且 $C_y \\ge 0$，条件 $C_x + C_y \\le 1$ 意味着 $C_x \\le 1$ 和 $C_y \\le 1$ 两者都成立。因此，任何对于非分裂格式稳定的 $\\Delta t$ 对于分裂格式也是稳定的。然而，反之则不成立。例如，如果 $C_x = 0.7$ 且 $C_y = 0.7$，分裂格式的约束 $\\max(0.7, 0.7) \\le 1$ 是满足的，但非分裂格式的约束 $0.7+0.7 = 1.4  1$ 被违反。\n因此，**非分裂稳定性约束比分裂格式的约束更严格**。\n其原因是，非分裂更新在单个阶段内同时考虑了量 $q$ 从一个单元 $(i,j)$ 向所有方向的总流出。稳定性条件 $1 - (C_x + C_y) \\ge 0$ 确保在一个时间步内离开该单元的 $q$ 的量不超过该单元中初始存在的 $q$ 的量。分裂格式将这两个流出解耦到独立的子步骤中，从而导致一个更宽松，且通常更理想的稳定性限制。\n对于给定的参数：\n$$ \\Delta t_{split, max} = \\min\\left(\\frac{50}{0.9}, \\frac{200}{0.9\\sqrt{3}}\\right) = \\min(55.55\\dots, 128.3\\dots) = 55.56\\,\\mathrm{s} $$\n如所示，$\\Delta t_{unsplit, max} (38.77\\,\\mathrm{s})$ 确实小于 $\\Delta t_{split, max} (55.56\\,\\mathrm{s})$。",
            "answer": "$$\n\\boxed{38.77}\n$$"
        },
        {
            "introduction": "一阶迎风等简单格式虽然稳健且能保证物理量的正定性，但其数值耗散过大。高阶格式能有效减少耗散，却可能在不连续或尖锐梯度附近引入非物理的振荡和负值（下冲）。本项高级实践将引导您实现一个高阶MUSCL格式，并通过应用斜率限制器来抑制这些非物理效应，从而在保持高精度的同时强制满足物理约束。这个练习揭示了现代计算流体力学中平衡精度与物理真实性的核心技术。",
            "id": "3574981",
            "problem": "考虑一个标量浓度场 $\\,\\phi(x,t)\\,$ 的一维线性反应平流方程的守恒形式，\n$$\n\\partial_t \\phi + u\\,\\partial_x \\phi \\;=\\; -\\,k\\,\\phi,\n$$\n其中 $\\,u\\,$ 是一个以 $\\mathrm{m/s}$ 为单位的恒定平流速度，$\\,k \\ge 0\\,$ 是一个以 $\\mathrm{s^{-1}}$ 为单位的恒定一阶反应系数，$\\,\\phi\\,$ 是无量纲的。空间域在区间 $[0,L]$ 上是周期的，其中 $L$ 的单位是 $\\mathrm{m}$。假设初始条件是一个基线值加上一个局部顶帽异常，\n$$\n\\phi(x,0) \\;=\\; \\phi_{\\min} \\;+\\; A \\,\\mathbf{1}_{[x_c - w/2,\\, x_c + w/2]}(x),\n$$\n其中 $\\,\\phi_{\\min} \\in [0,1]\\,$, $\\,A \\in [0,1]\\,$, $\\,x_c \\in [0,L]\\,$ 是异常中心，$\\,w \\in (0,L)\\,$ 是异常宽度，并且 $\\,\\mathbf{1}_E$ 表示集合 E 的指示函数（带周期性环绕）。对于 $\\,k \\ge 0\\,$，其精确连续解满足连续最小值原理：如果对所有 $\\,x\\,$ 都有 $\\,\\phi(x,0) \\ge 0\\,$，则对所有 $\\,x,t\\,$ 都有 $\\,\\phi(x,t) \\ge 0\\,$；此外，最小值最多按指数衰减，即 $\\,\\inf_x \\phi(x,t) \\ge e^{-k t} \\inf_x \\phi(x,0)\\,$。\n\n你的任务是构建一个完整、可运行的程序，该程序：\n- 在具有周期性边界条件的 $\\,N\\,$ 个单元的均匀网格上实现有限体积更新，以将 $\\,\\phi\\,$ 推进时间步长 $\\,\\Delta t\\,$，其中 $\\,\\Delta x = L/N\\,$，库朗数为 $\\,\\nu = u \\Delta t / \\Delta x\\,$。\n- 对于平流项，实现一阶迎风 Godunov 格式和带有 Hancock 预测步及可选斜率限制器的二阶守恒律单调上游中心格式 (MUSCL)。定义斜率比\n$$\nr_i \\;=\\; \\frac{\\Delta_{i-1/2}}{\\Delta_{i+1/2} + \\epsilon}, \\quad \\Delta_{i+1/2} = \\phi_{i+1} - \\phi_i,\n$$\n其中有一个小的 $\\,\\epsilon  0\\,$ 以避免除以零。令受限斜率为 $\\,s_i = \\varphi(r_i)\\,\\Delta_{i+1/2}\\,$，其中限制器 $\\,\\varphi(r)\\,$ 是以下之一：\n- Minmod: $\\,\\varphi_{\\mathrm{mm}}(r) = \\max\\left(0, \\min(1, r)\\right)$.\n- Monotonized Central (MC): $\\,\\varphi_{\\mathrm{mc}}(r) = \\max\\left(0, \\min\\left(\\tfrac{1+r}{2}, 2, 2r\\right)\\right)$.\n- Superbee: $\\,\\varphi_{\\mathrm{sb}}(r) = \\max\\left(0, \\min(2r,1), \\min(r,2)\\right)$.\n- Unlimited: $\\,\\varphi_{\\mathrm{unl}}(r) = 1$.\n使用 MUSCL-Hancock 半步演化来形成左右界面状态和一个迎风数值通量。对于所有测试，假设 $\\,u0\\,$。\n- 对于反应项，在平流子步之后（Godunov 分裂）应用两种时间积分器：\n  1. 精确更新：$\\,\\phi^{n+1} = e^{-k \\Delta t}\\,\\phi^{n+1,\\mathrm{adv}}\\,$.\n  2. 前向欧拉法：$\\,\\phi^{n+1} = \\phi^{n+1,\\mathrm{adv}} - k \\Delta t\\,\\phi^{n+1,\\mathrm{adv}} = (1 - k \\Delta t)\\,\\phi^{n+1,\\mathrm{adv}}\\,$.\n- 使用以下离散最小值原理来评估格式：对于一个具有基线值 $\\,\\phi_{\\min}\\,$ 的非负初始条件，任何可以表示为相邻单元平均值的凸组合、并随后进行精确反应更新的更新步骤，都必须满足\n$$\n\\min_i \\phi_i^{n} \\;\\ge\\; e^{-k\\,t^n}\\,\\phi_{\\min},\n$$\n前提是 $\\,\\nu \\in [0,1]\\,$ 且斜率限制器是总变差递减 (TVD) 的，特别是 minmod、MC 或 superbee。\n\n从基本定义出发，证明：\n- 如果每个时间步的平流更新可以写成系数非负且总和为 $\\,1\\,$ 的相邻单元平均值的凸组合，并且 $\\,\\nu \\in [0,1]\\,$，那么 MUSCL 平流子步满足离散最小值原理。证明将此与精确反应更新相结合，在每个时间步都保持下界 $\\,e^{-k \\Delta t} \\min_i \\phi_i\\,$，因此对于所有 $\\,n\\,$ 都有 $\\,\\min_i \\phi_i^n \\ge e^{-k t^n}\\phi_{\\min}\\,$。\n- 指出并证明在陡峭锋面处可能出现负值下冲的条件：（i）使用无限制斜率 $\\,\\varphi_{\\mathrm{unl}}(r)=1\\,$，这违反了 TVD 约束并产生色散振荡；（ii）取 $\\,\\nu  1\\,$，即使对于迎风型通量也会破坏单调性；（iii）使用前向欧拉反应更新且 $\\,k \\Delta t  1\\,$，这使得反应乘子为负。\n\n你的程序必须模拟以下五个测试用例，并为每个用例报告两个布尔值：\n- 第一个布尔值表示离散最小值原理在最终时刻是否成立，即是否满足 $\\,\\min_i \\phi_i(T) \\ge e^{-k T}\\,\\phi_{\\min} - \\tau\\,$，容差 $\\,\\tau = 10^{-12}\\,$。\n- 第二个布尔值表示是否发生了负值下冲，即是否满足 $\\,\\min_i \\phi_i(T)  -\\tau\\,$。\n\n所有测试均使用周期性域 $[0,L]$，其中 $\\,L = 1\\,\\mathrm{m}\\,$，一个宽度为 $\\,w = 0.2\\,\\mathrm{m}\\,$、中心在 $\\,x_c = 0.3\\,\\mathrm{m}\\,$ 的方形异常，以及 $\\,u = 1\\,\\mathrm{m/s}\\,$。取 $\\,N = 400\\,$ 个网格单元。库朗数为 $\\,\\nu = u \\Delta t / \\Delta x\\,$，其中 $\\,\\Delta x = L/N\\,$ 且 $\\,\\Delta t = \\nu\\,\\Delta x/u\\,$。最终时间 $\\,T\\,$ 是一个指定值或一个时间步，具体如下所述。\n\n- 测试 1 (理想情况, TVD): MUSCL 格式，使用 minmod 限制器，精确反应更新，$\\,\\nu = 0.8\\,$，$\\,k = 2\\,\\mathrm{s^{-1}}\\,$，$\\,\\phi_{\\min} = 0.1\\,$，$\\,A = 0.9\\,$，最终时间 $\\,T = 0.4\\,\\mathrm{s}\\,$。\n- 测试 2 (陡峭锋面振荡): MUSCL 格式，使用无限制斜率，精确反应更新，$\\,\\nu = 0.9\\,$，$\\,k = 1\\,\\mathrm{s^{-1}}\\,$，$\\,\\phi_{\\min} = 0.0\\,$，$\\,A = 1.0\\,$，最终时间 $\\,T = 0.2\\,\\mathrm{s}\\,$。\n- 测试 3 (一阶单调): 迎风 Godunov (一阶) 格式，精确反应更新，$\\,\\nu = 0.95\\,$，$\\,k = 2\\,\\mathrm{s^{-1}}\\,$，$\\,\\phi_{\\min} = 0.1\\,$，$\\,A = 0.9\\,$，最终时间 $\\,T = 0.4\\,\\mathrm{s}\\,$。\n- 测试 4 (仅反应项失效): 迎风 Godunov (一阶) 格式，前向欧拉反应更新，$\\,\\nu = 0.9\\,$，$\\,k = 600\\,\\mathrm{s^{-1}}\\,$，$\\,\\phi_{\\min} = 0.1\\,$，$\\,A = 0.9\\,$，最终时间 $\\,T = \\Delta t\\,$ (一个时间步)。\n- 测试 5 (激进 TVD): MUSCL 格式，使用 superbee 限制器，精确反应更新，$\\,\\nu = 0.95\\,$，$\\,k = 2\\,\\mathrm{s^{-1}}\\,$，$\\,\\phi_{\\min} = 0.1\\,$，$\\,A = 0.9\\,$，最终时间 $\\,T = 0.4\\,\\mathrm{s}\\,$。\n\n你的程序应生成单行输出，其中包含十个布尔值（从测试 1 到测试 5，每个测试两个），形式为用方括号括起来的逗号分隔列表，例如 $[\\text{True},\\text{False},\\dots]$。不应打印任何其他输出。所有角度（如有）必须以弧度为单位；所有物理单位均已在上方指定。报告的布尔值是无量纲的。",
            "solution": "用户提供了一个关于一维线性反应平流方程数值解的问题。该问题要求对某些数值性质进行理论证明，并实现一个程序通过一系列测试来验证这些性质。该问题在科学上是合理的、适定的，并包含了求解所需的所有必要信息。\n\n### **理论分析**\n\n控制偏微分方程 (PDE) 是线性反应平流方程：\n$$\n\\partial_t \\phi + u\\,\\partial_x \\phi = -k\\,\\phi\n$$\n其中 $\\phi(x,t)$ 是标量浓度，$u$ 是恒定的正平流速度 ($u>0$)，$k \\ge 0$ 是恒定的反应速率。问题在周期域 $[0, L]$ 上求解。我们将空间离散为 $N$ 个大小为 $\\Delta x = L/N$ 的单元，将时间离散为步长为 $\\Delta t$ 的时间步。库朗数为 $\\nu = u\\Delta t / \\Delta x$。\n\n数值解通过 Godunov 分裂法获得，其中平流和反应过程在独立的子步骤中处理：\n$$\n\\phi^* = \\mathcal{A}(\\phi^n) \\quad (\\text{平流步})\n$$\n$$\n\\phi^{n+1} = \\mathcal{R}(\\phi^*) \\quad (\\text{反应步})\n$$\n其中 $\\mathcal{A}$ 是平流算子，$\\mathcal{R}$ 是反应算子。\n\n#### **1. 离散最小值原理的证明**\n\n问题要求证明，对于一个最小值为 $\\phi_{\\min}$ 的非负初始条件，带有 TVD 限制器的组合 MUSCL-Hancock 格式和精确反应更新满足离散最小值原理：\n$$\n\\min_i \\phi_i^n \\ge e^{-k t^n} \\phi_{\\min}\n$$\n该证明包括两个部分：分析平流子步，然后分析反应子步。\n\n**第1部分：使用 MUSCL-Hancock 的平流子步**\n\n平流方程 $\\partial_t \\phi + \\partial_x (u\\phi) = 0$ 的有限体积更新为：\n$$\n\\phi_i^* = \\phi_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中 $F_{i+1/2}$ 是单元 $i$ 和 $i+1$ 之间界面 $x_{i+1/2}$ 处的数值通量。\n\n对于 $u>0$ 的 MUSCL-Hancock 格式，通量由左侧单元 ($i$) 演化而来的状态决定。首先，在每个单元 $i$ 中进行分段线性重构：\n$$\n\\phi_i(x) = \\phi_i^n + \\frac{s_i}{\\Delta x}(x-x_i)\n$$\n其中 $s_i$ 是一个受限斜率。单元 $i$ 右边界的值为 $\\phi_{i,R} = \\phi_i^n + s_i/2$。在 Hancock 预测步中，该值在 $\\Delta t/2$ 时间内演化到界面 $x_{i+1/2}$：\n$$\n\\phi_{i,R}^{n+1/2} = \\phi_i^n + \\frac{s_i}{2} - \\frac{u\\Delta t}{2\\Delta x}s_i = \\phi_i^n + \\frac{s_i}{2}(1-\\nu)\n$$\n界面 $x_{i+1/2}$ 处的迎风通量为 $F_{i+1/2} = u\\,\\phi_{i,R}^{n+1/2}$。单元 $i$ 的更新变为：\n$$\n\\phi_i^* = \\phi_i^n - \\frac{\\Delta t}{\\Delta x} \\left( u\\,\\phi_{i,R}^{n+1/2} - u\\,\\phi_{i-1,R}^{n+1/2} \\right) = \\phi_i^n - \\nu \\left( \\phi_{i,R}^{n+1/2} - \\phi_{i-1,R}^{n+1/2} \\right)\n$$\n线性平流格式的一个基本结果是，如果该格式是总变差递减 (TVD) 的，并且库朗数 $\\nu$ 在一个特定范围内（对于基于迎风的格式，通常是 $\\nu \\in [0,1]$），则更新可以表示为前一时间步相邻单元平均值的凸组合。也就是说，\n$$\n\\phi_i^* = \\sum_j C_{ij} \\phi_j^n \\quad \\text{其中} \\quad C_{ij} \\ge 0 \\quad \\text{且} \\quad \\sum_j C_{ij} = 1\n$$\n所提供的 TVD 斜率限制器（minmod、MC、superbee）被专门设计来确保在 $\\nu \\in [0,1]$ 的条件下此性质成立。\n鉴于更新是凸组合，该格式必须满足离散最小值原理。设 $\\phi_{\\min}^n = \\min_j \\phi_j^n$。则：\n$$\n\\phi_i^* = \\sum_j C_{ij} \\phi_j^n \\ge \\sum_j C_{ij} (\\min_k \\phi_k^n) = \\phi_{\\min}^n \\sum_j C_{ij} = \\phi_{\\min}^n\n$$\n由于这对所有 $i$ 都成立，我们有 $\\min_i \\phi_i^* \\ge \\min_j \\phi_j^n$。平流子步不会产生新的最小值。\n\n**第2部分：使用精确积分器的反应子步**\n\n反应子步在时间步长 $\\Delta t$ 上应用常微分方程 (ODE) $\\frac{d\\phi}{dt} = -k\\phi$ 的精确解。更新为：\n$$\n\\phi_i^{n+1} = \\phi_i^* \\, e^{-k \\Delta t}\n$$\n由于 $k \\ge 0$ 且 $\\Delta t \\ge 0$，因子 $e^{-k \\Delta t}$ 在范围 $(0, 1]$ 内。将此更新应用于平流步骤的结果：\n$$\n\\min_i \\phi_i^{n+1} = \\min_i \\left( \\phi_i^* \\, e^{-k \\Delta t} \\right) = e^{-k \\Delta t} \\min_i \\phi_i^*\n$$\n将其与平流步骤的结果（$\\min_i \\phi_i^* \\ge \\min_i \\phi_i^n$）相结合：\n$$\n\\min_i \\phi_i^{n+1} \\ge e^{-k \\Delta t} \\min_i \\phi_i^n\n$$\n这建立了递归关系。给定 $\\min_i \\phi_i^0 = \\phi_{\\min}$，我们可以通过归纳法证明：\n$$\n\\min_i \\phi_i^n \\ge e^{-k n \\Delta t} \\min_i \\phi_i^0 = e^{-k t^n} \\phi_{\\min}\n$$\n证明至此完成。在指定条件下（$\\nu \\in [0,1]$，TVD 限制器），组合格式满足离散最小值原理。一阶迎风格式在 $\\nu \\in [0,1]$ 时也是 TVD 的，因此也满足相同的原理。\n\n#### **2. 产生负值下冲的条件**\n\n问题要求指出并证明从一个初始非负场中可以产生负值（下冲）的条件。\n\n**(i) 无限制斜率限制器 ($\\varphi_{\\mathrm{unl}}(r)=1$)**：使用无限制的斜率，例如在 Lax-Wendroff 或 Beam-Warming 格式中，会使格式变为非 TVD。这些格式在空间和时间上是二阶准确的，但已知会在陡峭梯度或间断附近引入虚假振荡（吉布斯现象）。更新不再能写成凸组合。例如，对于一个基于前差斜率 $s_i = \\phi_{i+1}^n - \\phi_i^n$ 的 MUSCL-Hancock 格式，其更新 stencil 中的某些系数可能为负，这取决于 $\\nu$。这破坏了单调性，并允许格式从正数据中产生新的极值，包括负值下冲。\n\n**(ii) 库朗数大于一 ($\\nu > 1$)**：条件 $\\nu \\le 1$ 是 Courant-Friedrichs-Lewy (CFL) 条件，是显式平流格式的必要稳定性判据。它指出数值依赖域必须包含物理依赖域。对于 $\\nu > 1$，信息在数值上传播得比其物理速度慢。考虑一阶迎风格式：$\\phi_i^{n+1} = (1-\\nu)\\phi_i^n + \\nu\\phi_{i-1}^n$。如果 $\\nu > 1$，系数 $(1-\\nu)$ 为负。如果我们有一个阶跃剖面，其中 $\\phi_{i-1}^n=0$ 且 $\\phi_i^n=1$，则新值将为 $\\phi_i^{n+1} = 1-\\nu  0$。从而产生负值下冲。这种不稳定性在高阶格式中也会发生。\n\n**(iii) 使用前向欧拉反应且 $k \\Delta t > 1$**：反应项的前向欧拉更新为 $\\phi_i^{n+1} = \\phi_i^* - k \\Delta t \\, \\phi_i^* = (1 - k \\Delta t)\\phi_i^*$。为了使此格式保持正性，乘法因子必须非负，这要求 $1 - k \\Delta t \\ge 0$，即 $k \\Delta t \\le 1$。如果 $k \\Delta t > 1$，因子 $(1 - k \\Delta t)$ 为负。如果平流后状态 $\\phi_i^*$ 为正，则反应后状态 $\\phi_i^{n+1}$ 将变为负。这是对 $k$ 值很大的刚性常微分方程进行显式时间积分时的一个常见问题。\n\n### **数值实现**\n\n该程序实现了所描述的有限体积框架。平流项由一阶迎风 Godunov 格式或二阶 MUSCL-Hancock 格式处理。MUSCL 斜率限制器（Minmod、MC、Superbee 和 Unlimited）作为斜率比 $r_i$ 的函数来实现。反应项使用精确指数更新或显式前向欧拉方法进行积分。主循环遍历五个测试用例，运行每个模拟并在最终时刻评估两个指定的布尔条件：是否遵守离散最小值原理以及是否发生负值下冲。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Test 1: Happy path, TVD\n        {'scheme': 'muscl', 'limiter': 'minmod', 'reaction': 'exact', 'nu': 0.8, 'k': 2.0, 'phi_min': 0.1, 'A': 0.9, 'T': 0.4},\n        # Test 2: Sharp-front oscillations\n        {'scheme': 'muscl', 'limiter': 'unlimited', 'reaction': 'exact', 'nu': 0.9, 'k': 1.0, 'phi_min': 0.0, 'A': 1.0, 'T': 0.2},\n        # Test 3: First-order monotone\n        {'scheme': 'upwind', 'reaction': 'exact', 'nu': 0.95, 'k': 2.0, 'phi_min': 0.1, 'A': 0.9, 'T': 0.4},\n        # Test 4: Reaction-only failure\n        {'scheme': 'upwind', 'reaction': 'forward_euler', 'nu': 0.9, 'k': 600.0, 'phi_min': 0.1, 'A': 0.9, 'T': 'dt'},\n        # Test 5: Aggressive TVD\n        {'scheme': 'muscl', 'limiter': 'superbee', 'reaction': 'exact', 'nu': 0.95, 'k': 2.0, 'phi_min': 0.1, 'A': 0.9, 'T': 0.4},\n    ]\n\n    # Common parameters for all tests\n    base_params = {\n        'L': 1.0, 'w': 0.2, 'xc': 0.3, 'u': 1.0, 'N': 400\n    }\n\n    results = []\n    for case in test_cases:\n        params = {**base_params, **case}\n        min_principle_holds, undershoot_occurred = run_simulation(params)\n        results.extend([min_principle_holds, undershoot_occurred])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(params):\n    \"\"\"\n    Runs a single simulation case.\n    \"\"\"\n    # Unpack parameters\n    N = params['N']\n    L = params['L']\n    u = params['u']\n    k = params['k']\n    phi_min = params['phi_min']\n    A = params['A']\n    xc = params['xc']\n    w = params['w']\n    T = params['T']\n    nu = params['nu']\n    scheme = params['scheme']\n    reaction = params['reaction']\n    limiter_name = params.get('limiter', 'none')\n    \n    # Grid and time step\n    dx = L / N\n    # Handle the 'dt' case for final time T\n    if T == 'dt':\n        dt = nu * dx / u\n        T_final = dt\n        num_steps = 1\n    else:\n        dt = nu * dx / u\n        T_final = float(T)\n        num_steps = math.ceil(T_final / dt)\n        dt = T_final / num_steps\n    \n    # Small number to prevent division by zero in slope ratio\n    epsilon = 1e-20\n    # Tolerance for checks\n    tau = 1e-12\n\n    # Initial condition: baseline + top-hat anomaly\n    x = (np.arange(N) + 0.5) * dx\n    phi = np.full(N, phi_min)\n    left_edge = xc - w / 2\n    right_edge = xc + w / 2\n    phi[np.where((x >= left_edge)  (x = right_edge))] += A\n    \n    # Define slope limiter functions\n    def minmod_limiter(r):\n        return np.maximum(0., np.minimum(1., r))\n\n    def mc_limiter(r):\n        return np.maximum(0., np.minimum.reduce([(1. + r) / 2., 2. * np.ones_like(r), 2. * r]))\n\n    def superbee_limiter(r):\n        # Implementation of max(0, min(2r, 1), min(r, 2))\n        return np.maximum.reduce([np.zeros_like(r), np.minimum(2. * r, 1.), np.minimum(r, 2.)])\n\n    def unlimited_limiter(r):\n        return np.ones_like(r)\n\n    limiters = {\n        'minmod': minmod_limiter,\n        'mc': mc_limiter,\n        'superbee': superbee_limiter,\n        'unlimited': unlimited_limiter\n    }\n    limiter_func = limiters.get(limiter_name)\n\n    # Time integration loop\n    for _ in range(num_steps):\n        # Advection substep\n        if scheme == 'upwind':\n            phi_rolled = np.roll(phi, 1)\n            phi = phi - nu * (phi - phi_rolled)\n        elif scheme == 'muscl':\n            # 1. Calculate cell-to-cell differences for slope ratio\n            phi_prev = np.roll(phi, 1)\n            phi_next = np.roll(phi, -1)\n            delta_up = phi - phi_prev    # Corresponds to phi_i - phi_{i-1}\n            delta_down = phi_next - phi  # Corresponds to phi_{i+1} - phi_i\n            \n            # 2. Compute slope ratio and apply limiter\n            r = delta_up / (delta_down + epsilon)\n            phi_r = limiter_func(r)\n            s = phi_r * delta_down  # Limited slope\n            \n            # 3. MUSCL-Hancock reconstruction and half-step evolution (u>0)\n            # This gives the value at the left of the interface x_{i+1/2}\n            phi_interface_L = phi + 0.5 * (1. - nu) * s\n            \n            # 4. Compute fluxes and update\n            # Flux at i+1/2 is u * phi_interface_L at i\n            # Flux at i-1/2 is u * phi_interface_L at i-1\n            flux_right = u * phi_interface_L\n            flux_left = np.roll(flux_right, 1)\n            phi = phi - (dt / dx) * (flux_right - flux_left)\n        \n        # Reaction substep\n        if reaction == 'exact':\n            phi *= np.exp(-k * dt)\n        elif reaction == 'forward_euler':\n            phi *= (1.0 - k * dt)\n\n    # Final checks after simulation\n    final_min = np.min(phi)\n    \n    # Boolean 1: Check if the discrete minimum principle holds a non-negative IC\n    expected_min = np.exp(-k * T_final) * phi_min\n    min_principle_holds = final_min >= expected_min - tau\n\n    # Boolean 2: Check if a negative undershoot occurred\n    undershoot_occurred = final_min  -tau\n    \n    return min_principle_holds, undershoot_occurred\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}