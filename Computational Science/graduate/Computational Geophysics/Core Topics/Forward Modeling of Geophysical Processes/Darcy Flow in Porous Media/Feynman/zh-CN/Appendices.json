{
    "hands_on_practices": [
        {
            "introduction": "我们的第一个练习回归本源，通过求解一个理想化的一维稳态流动问题，来巩固质量守恒定律和达西定律的联合应用。这项基础性练习旨在揭示控制方程的推导过程，并导出线性水头分布和恒定通量的直观物理解。",
            "id": "3583139",
            "problem": "一个饱和、均质、各向同性的多孔层占据了一个与坐标 $x$ 对齐的一维域，区间为 $[0,L]$，$L>0$。流体不可压缩，固体骨架为刚性，孔隙度 $n$ 在空间和时间上是恒定的。没有内部源或汇。边界处的水头 $h(x)$ 是给定的：$h(0)=h_{0}$ 和 $h(L)=h_{L}$，其中 $h_{0}$ 和 $h_{L}$ 是常数。仅使用局部质量守恒定律、适用于多孔介质中蠕流的本构关系以及水头的定义，推导控制性边值问题，并求解在 $[0,L]$ 上的稳态水头 $h(x)$。然后计算恒定的比流量（达西通量）$q$ 和渗流（孔隙）速度 $v_{s}$。\n\n以 $x$、$L$、$h_{0}$、$h_{L}$、$K$ 和 $n$ 的闭式解析表达式形式提供最终结果。将最终答案以包含三个条目 $\\big(h(x),\\,q,\\,v_{s}\\big)$ 的单行矩阵形式报告。无需进行数值计算或四舍五入。最终答案中不包括单位。",
            "solution": "该问题要求推导稳态一维达西流的控制性边值问题，并求解水头 $h(x)$、比流量 $q$ 和渗流速度 $v_s$。推导从第一性原理出发。\n\n首先，我们应用局部质量守恒原理。对于具有刚性固体骨架（孔隙度 $n$ 恒定）和不可压缩流体（密度 $\\rho$ 恒定）的饱和多孔介质，在没有源或汇的情况下，稳态质量守恒方程由下式给出：\n$$\n\\nabla \\cdot (\\rho \\vec{q}) = 0\n$$\n其中 $\\vec{q}$ 是比流量矢量。由于流体密度 $\\rho$ 是恒定的，该方程简化为：\n$$\n\\nabla \\cdot \\vec{q} = 0\n$$\n对于与 $x$ 轴对齐的一维域，其中流动仅发生在 $x$ 方向上，比流量矢量为 $\\vec{q} = q\\hat{i}$，其中 $\\hat{i}$ 是 $x$ 方向的单位矢量。散度算子简化为 $\\nabla \\cdot \\vec{q} = \\frac{dq}{dx}$。因此，质量守恒方程变为：\n$$\n\\frac{dq}{dx} = 0\n$$\n该常微分方程意味着在域 $[0, L]$ 内的所有 $x$ 处，比流量 $q$ 是一个常数。\n\n其次，我们引入多孔介质中蠕流的本构关系，即达西定律。对于均质和各向同性的介质，一维达西定律为：\n$$\nq = -K \\frac{dh}{dx}\n$$\n其中 $K$ 是水力传导系数，对于均质介质而言是一个常数，而 $h(x)$ 是水头。\n\n第三，我们结合守恒定律和本构关系来推导水头的控制方程。将达西定律中的 $q$ 表达式代入守恒方程，得到：\n$$\n\\frac{d}{dx}\\left(-K \\frac{dh}{dx}\\right) = 0\n$$\n因为水力传导系数 $K$ 是常数，所以可以将其从导数中提出：\n$$\n-K \\frac{d^2h}{dx^2} = 0\n$$\n由于 $K$ 是一个正常数（介质必须是可渗透的才能有流动），我们可以除以 $-K$，从而得到水头 $h(x)$ 的控制性微分方程：\n$$\n\\frac{d^2h}{dx^2} = 0\n$$\n完整的边值问题（BVP）由该微分方程和问题陈述中给出的边界条件组成：\n$$\n\\begin{cases}\n\\frac{d^2h}{dx^2} = 0,  \\text{for } x \\in (0, L) \\\\\nh(0) = h_0 \\\\\nh(L) = h_L\n\\end{cases}\n$$\n为了求解此BVP，我们将控制方程对 $x$ 积分两次。第一次积分得到：\n$$\n\\frac{dh}{dx} = C_1\n$$\n其中 $C_1$ 是一个积分常数。第二次积分给出水头的通解：\n$$\nh(x) = C_1 x + C_2\n$$\n其中 $C_2$ 是第二个积分常数。这些常数通过应用边界条件来确定。\n使用在 $x=0$ 处的条件：\n$$\nh(0) = C_1(0) + C_2 = h_0 \\implies C_2 = h_0\n$$\n解变为 $h(x) = C_1 x + h_0$。现在，应用在 $x=L$ 处的条件：\n$$\nh(L) = C_1 L + h_0 = h_L\n$$\n求解 $C_1$：\n$$\nC_1 L = h_L - h_0 \\implies C_1 = \\frac{h_L - h_0}{L}\n$$\n将 $C_1$ 和 $C_2$ 的表达式代回通解中，我们得到水头分布的最终表达式：\n$$\nh(x) = \\left(\\frac{h_L - h_0}{L}\\right)x + h_0\n$$\n这可以重新整理为 $h(x) = h_0 + (h_L - h_0)\\frac{x}{L}$。\n\n接下来，我们使用达西定律和水头梯度的结果 $\\frac{dh}{dx} = C_1$ 来计算恒定的比流量 $q$：\n$$\nq = -K \\frac{dh}{dx} = -K C_1 = -K\\left(\\frac{h_L - h_0}{L}\\right)\n$$\n通过将负号分解到括号中，该表达式可以更直观地写成：\n$$\nq = K\\frac{h_0 - h_L}{L}\n$$\n这表明，当 $h_0 > h_L$ 时，流动方向为正 $x$ 方向（$q > 0$），这在物理上是正确的。\n\n最后，我们确定渗流速度 $v_s$。渗流速度是孔隙空间内的平均流体速度，它通过杜皮-福希海默关系 $q = n v_s$ 与比流量 $q$ 和孔隙度 $n$ 相关。因此：\n$$\nv_s = \\frac{q}{n}\n$$\n代入 $q$ 的表达式，我们得到：\n$$\nv_s = \\frac{1}{n}\\left(K\\frac{h_0 - h_L}{L}\\right) = \\frac{K}{n}\\frac{h_0 - h_L}{L}\n$$\n三个所需的量是 $h(x)$、$q$ 和 $v_s$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nh_0 + (h_L - h_0)\\frac{x}{L}  K\\frac{h_0 - h_L}{L}  \\frac{K}{n}\\frac{h_0 - h_L}{L}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了宏观流动方程后，我们进一步探究渗透率这一关键参数的物理内涵。这项练习将引导您推导经典的 Kozeny-Carman 模型，该模型建立了宏观渗透率与孔隙介质的微观结构（如颗粒直径和孔隙度）之间的联系。通过这项实践，您不仅能深入理解渗透率的物理来源，还将学习如何进行参数敏感性分析，这是评估模型不确定性的重要技能。",
            "id": "3583111",
            "problem": "一个由特征直径为 $d$、孔隙度为 $\\phi$ 的单分散颗粒组成的饱和、各向同性、均质粒状介质，在宏观均匀压力梯度下，承受着稳定、单相、不可压缩的流动。假设 (i) 宏观通量遵循达西定律，(ii) 在孔隙空间内，流动为层流且充分发展，(iii) 微观结构可理想化为一束曲折的毛细管，其有效水力半径与一个特征水力长度成正比，该特征水力长度可用孔隙体积和湿润表面积表示，以及 (iv) 单位总体积的比表面积满足 $S_{v} \\propto (1-\\phi)/d$，其中所有几何比例常数和曲折度都被归入一个单一的未知无量纲形状因子 $C$。\n\n仅从上述假设和基本定律及定义出发，推导出一个依赖于 $d$、$\\phi$ 和 $C$ 的解析渗透率模型 $k(d,\\phi;C)$。然后，使用您推导的模型，在以下基准状态下，评估渗透率并量化 $k$ 对 $d$ 和 $\\phi$ 的局部参数敏感性：\n$$\nd = 2.8 \\times 10^{-4} \\ \\text{m}, \\quad \\phi = 0.27, \\quad C = 180.\n$$\n定义对数（弹性）敏感性\n$$\nE_{d} \\equiv \\frac{\\partial \\ln k}{\\partial \\ln d}, \n\\qquad\nE_{\\phi} \\equiv \\frac{\\partial \\ln k}{\\partial \\ln \\phi},\n$$\n并在基准状态下计算 $E_{d}$ 和 $E_{\\phi}$。将最终答案的每个分量四舍五入至四位有效数字。渗透率以平方米为单位表示。\n\n根据上述四舍五入和单位要求，以行矩阵 $\\big[k, \\, E_{d}, \\, E_{\\phi}\\big]$ 的形式报告您的最终答案。",
            "solution": "**渗透率模型的推导**\n\n该推导通过将宏观的达西定律与孔隙空间内的微观流动联系起来进行。\n根据假设 (i)，宏观流动由达西定律控制，对于一维流动，可以用达西通量 $q$ 的大小表示为：\n$$q = -\\frac{k}{\\mu} \\frac{dP}{dx}$$\n其中 $k$ 是固有渗透率，$\\mu$ 是流体的动力黏度，$\\frac{dP}{dx}$ 是宏观压力梯度。\n\n根据假设 (ii)，孔隙通道内的流动是层流。对于通过非圆形管道的流动，一个泊肃叶型方程将孔隙内的平均速度 $v_p$ 与沿曲折流道的压力梯度 $\\frac{dP}{dl}$ 联系起来：\n$$v_p = -\\frac{k_0 R_h^2}{\\mu} \\frac{dP}{dl}$$\n这里，$R_h$ 是孔隙通道的水力半径，$k_0$ 是一个无量纲的孔隙形状因子。\n\n宏观压力梯度通过曲折度 $\\tau = L_e/L \\ge 1$ 与沿长度为 $L_e$ 的曲折路径在直线宏观距离 $L$ 上的微观梯度相关。因此，$\\frac{dP}{dl} = \\frac{1}{\\tau}\\frac{dP}{dx}$。现在可以用宏观压力梯度来表示平均孔隙速度：\n$$v_p = -\\frac{k_0 R_h^2}{\\tau \\mu} \\frac{dP}{dx}$$\n达西通量 $q$（也称为表观速度）通过杜皮特-福希海默关系与平均孔隙速度 $v_p$ 相关。实际流道是曲折的，可供流动的横截面积仅为总体积的一小部分 $\\phi$。渗流速度 $v_s$ 是沿宏观压力梯度方向的平均速度，即 $v_s = v_p / \\tau$。因此达西通量为 $q = \\phi v_s = \\phi v_p / \\tau$。代入 $v_p$ 的表达式：\n$$q = \\frac{\\phi}{\\tau} \\left( -\\frac{k_0 R_h^2}{\\tau \\mu} \\frac{dP}{dx} \\right) = -\\frac{k_0 \\phi R_h^2}{\\tau^2 \\mu} \\frac{dP}{dx}$$\n将此结果与达西定律进行比较，我们确定渗透率 $k$ 为：\n$$k = \\frac{k_0 \\phi R_h^2}{\\tau^2}$$\n根据假设 (iii)，水力半径 $R_h$ 定义为孔隙体积与颗粒总湿润表面积之比。对于多孔介质的总体积 $V_b$，孔隙体积为 $V_p = \\phi V_b$。湿润表面积为 $S_w = S_v V_b$，其中 $S_v$ 是单位总体积的比表面积。因此：\n$$R_h = \\frac{V_p}{S_w} = \\frac{\\phi V_b}{S_v V_b} = \\frac{\\phi}{S_v}$$\n根据假设 (iv)，比表面积 $S_v$ 满足 $S_v \\propto (1-\\phi)/d$。我们可以用一个比例常数 $c_{geom}$ 将其写为：$S_v = c_{geom} \\frac{1-\\phi}{d}$。将此代入 $R_h$ 的表达式中：\n$$R_h = \\frac{\\phi}{c_{geom} \\frac{1-\\phi}{d}} = \\frac{1}{c_{geom}} \\frac{\\phi d}{1-\\phi}$$\n现在，将 $R_h$ 的这个表达式代回渗透率 $k$ 的方程中：\n$$k = \\frac{k_0 \\phi}{\\tau^2} \\left( \\frac{1}{c_{geom}} \\frac{\\phi d}{1-\\phi} \\right)^2 = \\frac{k_0}{c_{geom}^2 \\tau^2} d^2 \\frac{\\phi^3}{(1-\\phi)^2}$$\n根据假设 (iv)，所有无量纲的几何常数（$k_0$, $c_{geom}$）和曲折度因子（$\\tau^2$）都归入一个单一的无量纲形状因子 $C$ 中。根据推导的形式，这个 C 是 $C = \\frac{c_{geom}^2 \\tau^2}{k_0}$。这导出了最终的渗透率模型：\n$$k(d,\\phi;C) = \\frac{1}{C} d^2 \\frac{\\phi^3}{(1-\\phi)^2}$$\n这就是科泽尼-卡门方程。\n\n**基准状态下渗透率的评估**\n\n基准状态由 $d = 2.8 \\times 10^{-4} \\ \\text{m}$，$\\phi = 0.27$ 和 $C = 180$ 给出。\n将这些值代入推导的模型中：\n$$k = \\frac{1}{180} (2.8 \\times 10^{-4})^2 \\frac{(0.27)^3}{(1-0.27)^2}$$\n$$k = \\frac{7.84 \\times 10^{-8}}{180} \\frac{0.019683}{(0.73)^2}$$\n$$k = \\frac{7.84 \\times 10^{-8}}{180} \\frac{0.019683}{0.5329}$$\n$$k \\approx (4.3555... \\times 10^{-10}) \\times (0.0369356...)$$\n$$k \\approx 1.60873 \\times 10^{-11} \\ \\text{m}^2$$\n四舍五入到四位有效数字，渗透率为 $k = 1.609 \\times 10^{-11} \\ \\text{m}^2$。\n\n**参数敏感性的评估**\n\n敏感性定义为 $E_{d} = \\frac{\\partial \\ln k}{\\partial \\ln d}$ 和 $E_{\\phi} = \\frac{\\partial \\ln k}{\\partial \\ln \\phi}$。\n首先，我们求渗透率模型的自然对数：\n$$\\ln k = \\ln\\left(\\frac{1}{C} d^2 \\frac{\\phi^3}{(1-\\phi)^2}\\right) = -\\ln C + 2\\ln d + 3\\ln\\phi - 2\\ln(1-\\phi)$$\n为了求得对颗粒直径 $d$ 的敏感性，我们将 $\\ln k$ 对 $\\ln d$ 求导：\n$$E_{d} = \\frac{\\partial}{\\partial \\ln d} \\left( -\\ln C + 2\\ln d + 3\\ln\\phi - 2\\ln(1-\\phi) \\right)$$\n由于在此偏导数中 $C$ 和 $\\phi$ 保持不变，我们得到：\n$$E_{d} = 2$$\n这个敏感性是一个常数，不依赖于基准状态的值。为保持报告一致性，我们将其写为 $2.000$。\n\n为了求得对孔隙度 $\\phi$ 的敏感性，我们将 $\\ln k$ 对 $\\ln \\phi$ 求导。使用链式法则，$\\frac{\\partial f}{\\partial \\ln x} = x \\frac{\\partial f}{\\partial x}$：\n$$E_{\\phi} = \\frac{\\partial \\ln k}{\\partial \\ln \\phi} = \\phi \\frac{\\partial \\ln k}{\\partial \\phi}$$\n$$E_{\\phi} = \\phi \\frac{\\partial}{\\partial \\phi} \\left( -\\ln C + 2\\ln d + 3\\ln\\phi - 2\\ln(1-\\phi) \\right)$$\n$$E_{\\phi} = \\phi \\left( \\frac{3}{\\phi} - \\frac{2}{1-\\phi}(-1) \\right) = \\phi \\left( \\frac{3}{\\phi} + \\frac{2}{1-\\phi} \\right)$$\n$$E_{\\phi} = 3 + \\frac{2\\phi}{1-\\phi}$$\n现在，我们在基准状态孔隙度 $\\phi = 0.27$ 处计算此表达式的值：\n$$E_{\\phi} = 3 + \\frac{2(0.27)}{1-0.27} = 3 + \\frac{0.54}{0.73}$$\n$$E_{\\phi} \\approx 3 + 0.739726... = 3.739726...$$\n四舍五入到四位有效数字，对孔隙度的敏感性为 $E_{\\phi} = 3.740$。\n\n**最终组合答案**\n计算出的值为：\n- 渗透率 $k \\approx 1.609 \\times 10^{-11} \\ \\text{m}^2$。\n- 对直径的敏感性 $E_d = 2.000$。\n- 对孔隙度的敏感性 $E_\\phi \\approx 3.740$。\n按要求将这些值组合成一个行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.609 \\times 10^{-11}  2.000  3.740\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "真实的地下介质往往是复杂和非均质的，解析方法通常难以适用。最后的这项综合性练习将引导您进入计算地球物理学的核心，即构建一个能够处理非均质和各向异性介质的二维数值求解器。您将从基本原理出发，推导并实现一个基于单元中心的有限体积法 (FVM)，从而将理论知识转化为解决实际问题的强大计算工具。",
            "id": "3583087",
            "problem": "您的任务是构建一个完整的、以单元中心为基础的有限体积法（FVM）离散化，使用两点通量近似（TPFA）来模拟二维矩形多孔介质中具有非均质、空间变化的渗透率张量的稳态、不可压缩、单相达西流。该区域为一个宽为 $L_x$、高为 $L_y$ 的矩形，被划分为一个由 $N_x \\times N_y$ 个矩形控制体积（单元）组成的均匀笛卡尔网格，每个单元的尺寸为 $\\Delta x = L_x / N_x$ 和 $\\Delta y = L_y / N_y$。该多孔介质的特征是每个单元具有一个各向异性但轴对齐的渗透率张量 $\\mathbf{K} = \\mathrm{diag}(k_x, k_y)$，其中 $k_x$ 和 $k_y$ 可能因单元而异（非均质）。流体的动力粘度为 $\\mu$。左边界（$x = 0$）和右边界（$x = L_x$）分别设定了狄利克雷（Dirichlet）压力 $p_\\mathrm{left}$ 和 $p_\\mathrm{right}$。顶部和底部边界（$y = 0$ 和 $y = L_y$）是无流动（齐次诺伊曼/Neumann）边界。假设平面外方向上的厚度为单位1，因此面面积等于边长乘以1。\n\n您的构建必须从基本原理开始，具体包括：\n- 达西定律的定义，它通过 $\\mathbf{q} = - \\dfrac{\\mathbf{K}}{\\mu} \\nabla p$ 将体积通量矢量 $\\mathbf{q}$ 与压力梯度关联起来。\n- 稳态无源情况下的局部质量守恒，$\\nabla \\cdot \\mathbf{q} = 0$。\n\n从这些原理出发，通过在每个控制体积上积分守恒定律，并使用散度定理将净流出量表示为面通量，从而推导出一个以单元为中心的FVM离散化。然后，采用两点通量近似（TPFA）来近似每个面上的通量，仅使用相邻两个单元的压力（或狄利克雷边界的边界压力），并定义强制跨面局部质量守恒的导水系数。您的推导必须解决：\n- 如何从非均质的 $\\mathbf{K}$ 中获得轴对齐面的法向有效渗透率，以及如何使用一致的平均技术组合两个相邻单元的属性。\n- 如何定义内部面和边界面上的导水系数，明确考虑几何形状（面面积和中心到面的距离）和粘度。\n- 代数系统如何反映每个单元的局部质量守恒，以及TPFA如何确保内部面上的通量连续性。\n\n单位要求：\n- 压力必须以帕斯卡（$\\mathrm{Pa}$）为单位。\n- 动力粘度必须以帕斯卡秒（$\\mathrm{Pa}\\cdot\\mathrm{s}$）为单位。\n- 渗透率分量 $k_x$ 和 $k_y$ 必须以平方米（$\\mathrm{m}^2$）为单位。\n- 几何长度 $L_x$、$L_y$、$\\Delta x$、$\\Delta y$ 必须以米（$\\mathrm{m}$）为单位。\n- 跨面的体积通量必须以立方米每秒（$\\mathrm{m}^3/\\mathrm{s}$）为单位。\n\n将离散化算法实现为一个完整、可运行的程序。组装并求解得到的线性系统以获得单元中心的压力，然后计算每个单元的局部质量平衡残差，该残差定义为单元所有面上的出向TPFA通量之和减去狄利克雷边界压力贡献的右端项。对于每个测试案例，报告所有单元中的最大绝对残差。最终残差以 $\\mathrm{m}^3/\\mathrm{s}$ 表示。\n\n设计一个包含以下四个测试案例的测试套件，所有案例均满足 $L_x = N_x \\Delta x$ 和 $L_y = N_y \\Delta y$，单位厚度等于 $1$：\n1.  一般情况：$N_x = 10$, $N_y = 10$, $\\Delta x = 1\\,\\mathrm{m}$, $\\Delta y = 1\\,\\mathrm{m}$, $\\mu = 1\\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$，均匀各向同性渗透率 $k_x = k_y = 1\\times 10^{-12}\\,\\mathrm{m}^2$, $p_\\mathrm{left} = 2\\times 10^{5}\\,\\mathrm{Pa}$, $p_\\mathrm{right} = 1\\times 10^{5}\\,\\mathrm{Pa}$。\n2.  强非均质性情况（阶跃变化）：$N_x = 10$, $N_y = 10$, $\\Delta x = 1\\,\\mathrm{m}$, $\\Delta y = 1\\,\\mathrm{m}$, $\\mu = 1\\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$。对于x方向的面，$i \\leq 4$（左半部分）的单元上 $k_x = 1\\times 10^{-12}\\,\\mathrm{m}^2$，$i \\geq 5$（右半部分）的单元上 $k_x = 1\\times 10^{-13}\\,\\mathrm{m}^2$。对于y方向的面，每个单元设置 $k_y = k_x$。边界压力 $p_\\mathrm{left} = 2\\times 10^{5}\\,\\mathrm{Pa}$, $p_\\mathrm{right} = 1\\times 10^{5}\\,\\mathrm{Pa}$。\n3.  强各向异性情况：$N_x = 10$, $N_y = 10$, $\\Delta x = 1\\,\\mathrm{m}$, $\\Delta y = 1\\,\\mathrm{m}$, $\\mu = 1\\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$，所有单元上均匀地 $k_x = 1\\times 10^{-11}\\,\\mathrm{m}^2$ 和 $k_y = 1\\times 10^{-13}\\,\\mathrm{m}^2$。边界压力 $p_\\mathrm{left} = 2\\times 10^{5}\\,\\mathrm{Pa}$, $p_\\mathrm{right} = 1\\times 10^{5}\\,\\mathrm{Pa}$。\n4.  高对比度障碍物情况：$N_x = 10$, $N_y = 10$, $\\Delta x = 1\\,\\mathrm{m}$, $\\Delta y = 1\\,\\mathrm{m}$, $\\mu = 1\\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$，背景渗透率 $k_x = k_y = 1\\times 10^{-12}\\,\\mathrm{m}^2$，除了一个中心块区域，其单元索引为 $i \\in \\{3,4,5,6\\}$ 和 $j \\in \\{3,4,5,6\\}$，其中 $k_x = k_y = 1\\times 10^{-16}\\,\\mathrm{m}^2$。边界压力 $p_\\mathrm{left} = 2\\times 10^{5}\\,\\mathrm{Pa}$, $p_\\mathrm{right} = 1\\times 10^{5}\\,\\mathrm{Pa}$。\n\n您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，`[r1,r2,r3,r4]`），其中每个 $r_i$ 是测试案例 $i$ 的最大绝对局部质量残差，单位为 $\\mathrm{m}^3/\\mathrm{s}$，表示为浮点数。\n\n您推导中的所有数学描述元素必须遵守以下科学和格式约束：\n- 从所述的基本原理开始，并从第一性原理构建离散化方案。\n- 不要提供捷径公式作为提示；推导必须从原理到离散格式逻辑地进行。\n- 在整个过程中确保科学真实性和单位一致性。\n- 每个数学实体——符号、变量、函数、算子和数字——必须用 LaTeX 书写，内联数学使用 $...$，显示数学使用 $$...$$。\n- 首次使用时定义缩略语，如有限体积法（FVM）和两点通量近似（TPFA）。",
            "solution": "### 单元中心有限体积法的推导\n\n该问题涉及稳态、不可压缩、单相流体在多孔介质中的流动。控制方程是达西定律和质量守恒方程。\n\n1.  **基本原理**\n\n    体积通量矢量 $\\mathbf{q}$（单位为 $\\mathrm{m}^3/\\mathrm{s}$ 每 $\\mathrm{m}^2$，或 $\\mathrm{m}/\\mathrm{s}$）由达西定律给出：\n    $$\n    \\mathbf{q} = - \\frac{\\mathbf{K}}{\\mu} \\nabla p\n    $$\n    其中 $p$ 是流体压力（单位 $\\mathrm{Pa}$），$\\mu$ 是动力粘度（单位 $\\mathrm{Pa}\\cdot\\mathrm{s}$），$\\mathbf{K}$ 是渗透率张量（单位 $\\mathrm{m}^2$）。对于此问题，该张量是对角的，并与笛卡尔坐标轴对齐：$\\mathbf{K} = \\mathrm{diag}(k_x, k_y)$。\n\n    对于没有源或汇的稳态流，质量守恒原理表示为：\n    $$\n    \\nabla \\cdot \\mathbf{q} = 0\n    $$\n    将达西定律代入守恒方程，得到控制压力的椭圆型偏微分方程：\n    $$\n    \\nabla \\cdot \\left( - \\frac{\\mathbf{K}}{\\mu} \\nabla p \\right) = 0\n    $$\n\n2.  **积分形式与离散化**\n\n    有限体积法（FVM）首先将守恒定律在一个控制体积 $V_{i,j}$（对应单个网格单元）上积分。我们使用一个二维笛卡尔网格，其中单元 $(i,j)$ 的中心位于 $(x_i, y_j)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 和 $j \\in \\{0, \\dots, N_y-1\\}$。单元的尺寸为 $\\Delta x \\times \\Delta y$。\n    $$\n    \\int_{V_{i,j}} \\nabla \\cdot \\mathbf{q} \\, dV = 0\n    $$\n    应用散度定理，我们将体积分转换为控制体积边界 $\\partial V_{i,j}$ 上的面积分：\n    $$\n    \\int_{\\partial V_{i,j}} \\mathbf{q} \\cdot \\mathbf{n} \\, dS = 0\n    $$\n    其中 $\\mathbf{n}$ 是指向单元表面外部的单位法向量。\n\n    面积分被离散为跨越矩形单元四个面（东、西、南、北）的总通量之和。设 $Q_f$ 为跨越面 $f$ 的总向外体积通量（$\\mathrm{m}^3/\\mathrm{s}$）。单元 $(i,j)$ 的方程变为：\n    $$\n    Q_{E} + Q_{W} + Q_{N} + Q_{S} = 0\n    $$\n    例如，$Q_{E}$ 是流出东面的通量，该面位于 $x_{i+1/2} = x_i + \\Delta x/2$。假设单位厚度（$1 \\, \\mathrm{m}$），该面的面积为 $A_E = \\Delta y \\cdot 1$。总通量近似为面法向通量分量乘以面面积：\n    $$\n    Q_E = A_E (\\mathbf{q} \\cdot \\mathbf{n})_E = \\Delta y \\, (q_x)_{i+1/2, j}\n    $$\n    类似地，$Q_W = -\\Delta y \\, (q_x)_{i-1/2, j}$，$Q_N = \\Delta x \\, (q_y)_{i, j+1/2}$，$Q_S = -\\Delta x \\, (q_y)_{i, j-1/2}$。西面和南面的负号是因为向外的法向量指向负坐标方向。守恒方程则为：\n    $$\n    \\Delta y (q_x)_{i+1/2, j} - \\Delta y (q_x)_{i-1/2, j} + \\Delta x (q_y)_{i, j+1/2} - \\Delta x (q_y)_{i, j-1/2} = 0\n    $$\n\n3.  **两点通量近似（TPFA）**\n\n    TPFA仅使用共享面的两个单元的压力来近似面法向通量。对于单元 $(i,j)$ 和 $(i+1,j)$ 之间的东面，通量的 $x$ 分量为 $q_x = -(k_x/\\mu)(\\partial p / \\partial x)$。我们使用单元中心之间的有限差分来近似压力梯度：\n    $$\n    (q_x)_{i+1/2, j} \\approx - \\left( \\frac{k_x}{\\mu} \\right)_{i+1/2, j} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}\n    $$\n    项 $p_{i,j}$ 代表单元 $(i,j)$ 中心的压力。问题是如何从以单元为中心的渗透率 $k_{x,i,j}$ 和 $k_{x,i+1,j}$ 计算面渗透率 $(k_x)_{i+1/2, j}$。为确保通量连续性，对于单元中心之间的一维流动，调和平均是正确的选择。保持通量守恒的界面有效渗透率为：\n    $$\n    (k_x)_{i+1/2, j} = \\frac{2 \\, k_{x,i,j} \\, k_{x,i+1,j}}{k_{x,i,j} + k_{x,i+1,j}}\n    $$\n    我们定义一个称为**导水系数**的属性 $T$，它结合了几何、渗透率和粘度。跨越东面的总向外通量为：\n    $$\n    Q_E = \\underbrace{\\left( \\frac{A_E (k_x)_{i+1/2, j}}{\\mu \\Delta x} \\right)}_{T_{i+1/2, j}} (p_{i,j} - p_{i+1,j}) = T_{i+1/2, j} (p_{i,j} - p_{i+1,j})\n    $$\n    $x$ 方向内部面的导水系数为：\n    $$\n    T_{i+1/2, j} = \\frac{\\Delta y}{\\mu \\Delta x} \\frac{2 \\, k_{x,i,j} \\, k_{x,i+1,j}}{k_{x,i,j} + k_{x,i+1,j}}\n    $$\n    类似地，对于 $y$ 方向的内部面：\n    $$\n    T_{i, j+1/2} = \\frac{\\Delta x}{\\mu \\Delta y} \\frac{2 \\, k_{y,i,j} \\, k_{y,i,j+1}}{k_{y,i,j} + k_{y,i,j+1}}\n    $$\n\n4.  **边界条件处理**\n\n    -   **无流动（诺伊曼/Neumann）边界**：在顶部（$y=L_y$，单元 $j=N_y-1$）和底部（$y=0$，单元 $j=0$）边界，通量为零。这通过将这些边界面上的导水系数设为零来实现。例如，对于单元 $(i,0)$，$T_{i,-1/2} = 0$。\n\n    -   **指定压力（狄利克雷/Dirichlet）边界**：在左（$x=0$）和右（$x=L_x$）边界，压力是已知的。对于左边界上的单元 $(0,j)$，其西面 $x_{-1/2}$ 上的通量取决于边界压力 $p_\\mathrm{left}$。从单元中心到边界的距离是 $\\Delta x/2$。通量近似为：\n    $$\n    (q_x)_{-1/2, j} \\approx - \\frac{k_{x,0,j}}{\\mu} \\frac{p_{0,j} - p_\\mathrm{left}}{\\Delta x/2}\n    $$\n    注意我们只使用单元本身的渗透率 $k_{x,0,j}$。总向外通量为 $Q_W = T_{-1/2,j}(p_{0,j} - p_\\mathrm{left})$，边界导水系数定义为：\n    $$\n    T_{-1/2, j} = \\frac{A_W k_{x,0,j}}{\\mu (\\Delta x/2)} = \\frac{2 \\Delta y \\, k_{x,0,j}}{\\mu \\Delta x}\n    $$\n    类似地，对于右边界上的单元 $(N_x-1,j)$，导水系数为 $T_{N_x-1/2, j} = \\frac{2 \\Delta y \\, k_{x,N_x-1,j}}{\\mu \\Delta x}$，其通量贡献涉及 $p_\\mathrm{right}$。\n\n5.  **线性系统组装**\n\n    一个内部单元 $(i,j)$ 的质量平衡方程为：\n    $$\n    T_{i+1/2, j}(p_{i,j} - p_{i+1,j}) + T_{i-1/2, j}(p_{i,j} - p_{i-1,j}) + T_{i,j+1/2}(p_{i,j} - p_{i,j+1}) + T_{i,j-1/2}(p_{i,j} - p_{i,j-1}) = 0\n    $$\n    这可以重新排列，形成一个关于未知压力 $p_{i,j}$ 的线性方程：\n    $$\n    (\\sum_{f} T_f) p_{i,j} - \\sum_{f} T_f p_{\\text{neighbor}} = 0\n    $$\n    其中求和是对四个面进行的。对于边界单元，涉及已知边界压力的项被移到右侧（RHS）。例如，对于单元 $(0,j)$：\n    $$\n    (T_{1/2,j} + T_{-1/2,j} + \\dots) p_{0,j} - T_{1/2,j}p_{1,j} - \\dots = T_{-1/2,j} p_\\mathrm{left}\n    $$\n    通过对网格中的每个单元应用此方程，我们为 $N$ 个未知单元压力构建了一个包含 $N = N_x \\times N_y$ 个线性方程的系统。该系统可以写成矩阵形式 $\\mathbf{A}\\mathbf{p} = \\mathbf{b}$，其中 $\\mathbf{p}$ 是未知单元压力的向量，$\\mathbf{A}$ 是一个稀疏、对称正定的系数矩阵，$\\mathbf{b}$ 是包含狄利克雷边界贡献的源向量。当使用自然的行优先或列优先单元排序时，矩阵 $\\mathbf{A}$ 是五对角的。\n\n6.  **质量平衡残差计算**\n\n    在求解系统 $\\mathbf{A}\\mathbf{p} = \\mathbf{b}$ 得到解向量 $\\mathbf{p}_{\\text{sol}}$ 后，我们可以通过计算每个单元的局部质量平衡残差来验证解的质量。单元 $k$ 的离散守恒定律是 $(\\mathbf{A}\\mathbf{p})_k = b_k$。残差是数值解未能满足此方程的量，定义为 $r_k = (\\mathbf{A}\\mathbf{p}_{\\text{sol}})_k - b_k$。在物理上，这对应于基于计算出的压力场流入/流出单元的净质量流量减去任何显式源项。对于精确解，此残差应为零。由于有限精度算术，它将是一个很小的数。最大绝对残差 $\\max_k |r_k|$ 是衡量数值解整体一致性的一个指标。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csr_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_darcy_flow(\n    Nx, Ny, dx, dy, mu, kx, ky, p_left, p_right\n):\n    \"\"\"\n    Solves the 2D steady-state Darcy flow equation using a cell-centered\n    Finite Volume Method with a Two-Point Flux Approximation.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        dx (float): Cell width in meters.\n        dy (float): Cell height in meters.\n        mu (float): Fluid viscosity in Pa.s.\n        kx (np.ndarray): Permeability in x-direction (m^2), shape (Ny, Nx).\n        ky (np.ndarray): Permeability in y-direction (m^2), shape (Ny, Nx).\n        p_left (float): Dirichlet boundary pressure at x=0 (Pa).\n        p_right (float): Dirichlet boundary pressure at x=Lx (Pa).\n\n    Returns:\n        float: Maximum absolute mass balance residual (m^3/s).\n    \"\"\"\n    N_cells = Nx * Ny\n    A = lil_matrix((N_cells, N_cells), dtype=np.float64)\n    b = np.zeros(N_cells, dtype=np.float64)\n\n    for j in range(Ny):\n        for i in range(Nx):\n            k = i + j * Nx\n\n            # West face\n            if i > 0:\n                k_west = i - 1 + j * Nx\n                # Harmonic mean for interior face permeability\n                kx_w_eff = 2 * kx[j, i] * kx[j, i - 1] / (kx[j, i] + kx[j, i - 1])\n                T_W = kx_w_eff * dy / (mu * dx)\n                A[k, k] += T_W\n                A[k, k_west] -= T_W\n            else:\n                # Dirichlet boundary at x=0\n                T_W_bnd = (kx[j, i] * dy) / (mu * (dx / 2.0))\n                A[k, k] += T_W_bnd\n                b[k] += T_W_bnd * p_left\n\n            # East face\n            if i  Nx - 1:\n                k_east = i + 1 + j * Nx\n                # Harmonic mean for interior face permeability\n                kx_e_eff = 2 * kx[j, i] * kx[j, i + 1] / (kx[j, i] + kx[j, i + 1])\n                T_E = kx_e_eff * dy / (mu * dx)\n                A[k, k] += T_E\n                A[k, k_east] -= T_E\n            else:\n                # Dirichlet boundary at x=Lx\n                T_E_bnd = (kx[j, i] * dy) / (mu * (dx / 2.0))\n                A[k, k] += T_E_bnd\n                b[k] += T_E_bnd * p_right\n\n            # South face\n            if j > 0:\n                k_south = i + (j - 1) * Nx\n                # Harmonic mean for interior face permeability\n                ky_s_eff = 2 * ky[j, i] * ky[j - 1, i] / (ky[j, i] + ky[j - 1, i])\n                T_S = ky_s_eff * dx / (mu * dy)\n                A[k, k] += T_S\n                A[k, k_south] -= T_S\n            else:\n                # No-flow boundary at y=0, transmissibility is 0\n                pass\n\n            # North face\n            if j  Ny - 1:\n                k_north = i + (j + 1) * Nx\n                # Harmonic mean for interior face permeability\n                ky_n_eff = 2 * ky[j, i] * ky[j + 1, i] / (ky[j, i] + ky[j + 1, i])\n                T_N = ky_n_eff * dx / (mu * dy)\n                A[k, k] += T_N\n                A[k, k_north] -= T_N\n            else:\n                # No-flow boundary at y=Ly, transmissibility is 0\n                pass\n\n    A_csr = A.tocsr()\n    p_sol = spsolve(A_csr, b)\n\n    residual_vector = A_csr @ p_sol - b\n    max_abs_residual = np.max(np.abs(residual_vector))\n\n    return max_abs_residual\n\ndef solve():\n    # Define common parameters\n    Nx = 10\n    Ny = 10\n    dx = 1.0\n    dy = 1.0\n    mu = 1e-3\n    p_left = 2e5\n    p_right = 1e5\n\n    # Define test cases\n    test_cases = []\n\n    # Case 1: General case (uniform, isotropic)\n    kx1 = np.full((Ny, Nx), 1e-12)\n    ky1 = np.full((Ny, Nx), 1e-12)\n    test_cases.append(\n        {\"Nx\": Nx, \"Ny\": Ny, \"dx\": dx, \"dy\": dy, \"mu\": mu, \"kx\": kx1, \"ky\": ky1, \"p_left\": p_left, \"p_right\": p_right}\n    )\n\n    # Case 2: Strong heterogeneity (step change)\n    kx2 = np.full((Ny, Nx), 1.0) # Placeholder\n    kx2[:, 0:5] = 1e-12  # i = 4 (cols 0, 1, 2, 3, 4)\n    kx2[:, 5:10] = 1e-13 # i >= 5 (cols 5, 6, 7, 8, 9)\n    ky2 = np.copy(kx2)\n    test_cases.append(\n        {\"Nx\": Nx, \"Ny\": Ny, \"dx\": dx, \"dy\": dy, \"mu\": mu, \"kx\": kx2, \"ky\": ky2, \"p_left\": p_left, \"p_right\": p_right}\n    )\n\n    # Case 3: Strong anisotropy\n    kx3 = np.full((Ny, Nx), 1e-11)\n    ky3 = np.full((Ny, Nx), 1e-13)\n    test_cases.append(\n        {\"Nx\": Nx, \"Ny\": Ny, \"dx\": dx, \"dy\": dy, \"mu\": mu, \"kx\": kx3, \"ky\": ky3, \"p_left\": p_left, \"p_right\": p_right}\n    )\n\n    # Case 4: High-contrast barrier\n    kx4 = np.full((Ny, Nx), 1e-12)\n    ky4 = np.full((Ny, Nx), 1e-12)\n    # i in {3,4,5,6} -> cols 3,4,5,6\n    # j in {3,4,5,6} -> rows 3,4,5,6\n    # numpy slice is [3:7] for indices 3, 4, 5, 6\n    kx4[3:7, 3:7] = 1e-16\n    ky4[3:7, 3:7] = 1e-16\n    test_cases.append(\n        {\"Nx\": Nx, \"Ny\": Ny, \"dx\": dx, \"dy\": dy, \"mu\": mu, \"kx\": kx4, \"ky\": ky4, \"p_left\": p_left, \"p_right\": p_right}\n    )\n    \n    results = []\n    for case_params in test_cases:\n        result = solve_darcy_flow(**case_params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}