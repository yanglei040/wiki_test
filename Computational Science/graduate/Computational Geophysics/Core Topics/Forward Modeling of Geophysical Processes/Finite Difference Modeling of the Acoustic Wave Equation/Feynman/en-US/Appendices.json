{
    "hands_on_practices": [
        {
            "introduction": "Before we can trust the results of a numerical simulation, we must first ensure it is stable. An unstable scheme will produce solutions that grow without bound, rendering the simulation useless. This exercise introduces the von Neumann stability analysis, a cornerstone technique for understanding how errors propagate in a finite difference scheme, leading to the celebrated Courant–Friedrichs–Lewy (CFL) condition that governs the choice of time step .",
            "id": "3592805",
            "problem": "Consider the one-dimensional acoustic wave equation for a scalar field $u(x,t)$ under constant density and constant wavespeed $c$, given by $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$. Let the spatial domain be discretized on a uniform grid $x_{i} = i\\,\\Delta x$ and time be discretized as $t^{n} = n\\,\\Delta t$, where $i$ and $n$ are integers, and $\\Delta x$ and $\\Delta t$ are positive constants. Using second-order centered finite differences in both time and space to construct an explicit update scheme at each interior grid point, perform a von Neumann (Fourier) stability analysis under periodic boundary conditions to determine the condition under which all Fourier modes remain bounded in time. Define the Courant number $\\lambda = \\dfrac{c\\,\\Delta t}{\\Delta x}$ and derive the Courant–Friedrichs–Lewy (CFL) condition of the form $c\\,\\Delta t / \\Delta x \\le \\lambda_{\\max}$. Compute the exact value of $\\lambda_{\\max}$. Express your final answer as a single real number. No rounding is required and no units should be included in the final answer.",
            "solution": "The problem statement is valid. It is a standard, well-posed problem in computational physics that is scientifically grounded, objective, and contains all necessary information for a unique solution.\n\nThe one-dimensional acoustic wave equation is given by:\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwhere $u(x,t)$ is the scalar field, and $c$ is the constant wavespeed.\n\nWe discretize the domain with a uniform grid, such that $x_i = i\\,\\Delta x$ and $t^n = n\\,\\Delta t$. The numerical approximation of $u(x_i, t^n)$ is denoted by $u_i^n$. We use second-order centered finite differences to approximate the partial derivatives.\n\nThe second partial derivative with respect to time, $u_{tt}$, at $(x_i, t^n)$ is approximated as:\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\nThe second partial derivative with respect to space, $u_{xx}$, at $(x_i, t^n)$ is approximated as:\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\nSubstituting these approximations into the wave equation gives the finite difference equation:\n$$\n\\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\nTo create an explicit update scheme, we solve for $u_i^{n+1}$:\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\frac{c^2 (\\Delta t)^2}{(\\Delta x)^2} (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\nWe introduce the Courant number, $\\lambda = \\frac{c\\,\\Delta t}{\\Delta x}$. The equation becomes:\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\lambda^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\nFor the von Neumann stability analysis, we consider a single Fourier mode solution of the form:\n$$\nu_i^n = \\xi^n e^{j k x_i} = \\xi^n e^{j k i \\Delta x}\n$$\nwhere $k$ is the wavenumber, $j = \\sqrt{-1}$, and $\\xi = \\xi(k)$ is the amplification factor. For the scheme to be stable, the magnitude of the amplification factor must satisfy $|\\xi| \\le 1$ for all possible wavenumbers $k$.\n\nSubstituting the Fourier mode into the finite difference scheme:\n$$\n\\xi^{n+1} e^{j k i \\Delta x} = 2\\xi^n e^{j k i \\Delta x} - \\xi^{n-1} e^{j k i \\Delta x} + \\lambda^2 \\left( \\xi^n e^{j k (i+1) \\Delta x} - 2\\xi^n e^{j k i \\Delta x} + \\xi^n e^{j k (i-1) \\Delta x} \\right)\n$$\nDividing the entire equation by the common factor $\\xi^{n-1} e^{j k i \\Delta x}$ yields:\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\left( \\xi e^{j k \\Delta x} - 2\\xi + \\xi e^{-j k \\Delta x} \\right)\n$$\nWe can factor out $\\xi$ on the right-hand side and use Euler's formula, $e^{j\\theta} + e^{-j\\theta} = 2\\cos(\\theta)$, with $\\theta = k\\Delta x$:\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (e^{j k \\Delta x} + e^{-j k \\Delta x} - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (2\\cos(k\\Delta x) - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 - 2\\lambda^2 \\xi (1 - \\cos(k\\Delta x))\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\n\\xi^2 = 2\\xi - 1 - 4\\lambda^2 \\xi \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\n$$\nRearranging this into a standard quadratic equation for $\\xi$:\n$$\n\\xi^2 - \\left( 2 - 4\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right)\\xi + 1 = 0\n$$\nThis is a quadratic equation of the form $a\\xi^2 + b\\xi + c = 0$, where $a=1$, $b = -2P$, and $c=1$, with $P = 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$. The roots are given by the quadratic formula:\n$$\n\\xi = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} = P \\pm \\sqrt{P^2 - 1}\n$$\nFor the solution to remain bounded, we require $|\\xi| \\le 1$.\nLet's analyze the roots based on the value of $P$:\n1. If $P^2 > 1$ (i.e., $|P| > 1$), the term $\\sqrt{P^2-1}$ is real and positive. One of the roots will have a magnitude greater than $1$. For example, if $P > 1$, then $\\xi_+ = P + \\sqrt{P^2-1} > 1$. If $P < -1$, then $\\xi_- = P - \\sqrt{P^2-1} < -1$, so $|\\xi_-| > 1$. In both cases, the scheme is unstable.\n2. If $P^2 \\le 1$ (i.e., $|P| \\le 1$), the term $P^2-1$ is non-positive. The roots are $\\xi = P \\pm j\\sqrt{1-P^2}$. The magnitude of these complex roots is:\n$$\n|\\xi| = \\sqrt{P^2 + \\left(\\sqrt{1-P^2}\\right)^2} = \\sqrt{P^2 + 1 - P^2} = \\sqrt{1} = 1\n$$\nIn this case, the amplitude of the Fourier modes is conserved, and the scheme is stable. The boundary case $P^2=1$ gives a single real root $\\xi=P$ with $|\\xi|=1$, which is also stable.\n\nThus, the condition for stability for all wavenumbers $k$ is $|P| \\le 1$:\n$$\n\\left| 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right| \\le 1\n$$\nThis inequality can be written as:\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\nLet's analyze the two parts of the inequality. The right-hand side is:\n$$\n1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 0\n$$\nSince $\\lambda^2 \\ge 0$ and $\\sin^2(\\cdot) \\ge 0$, this part is always satisfied.\nThe left-hand side gives the definitive stability constraint:\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 2\n$$\n$$\n\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\nThis condition must hold for all wavenumbers $k$. To ensure this, we must consider the \"worst-case\" scenario, which corresponds to the value of $k$ that maximizes the term $\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$. The maximum value of $\\sin^2(\\cdot)$ is $1$. This occurs for the highest frequency mode that can be represented on the grid, $k = \\pi / \\Delta x$, which makes the argument of the sine $\\pi/2$.\nEnforcing the condition for this worst case gives:\n$$\n\\lambda^2 \\cdot \\max_{k}\\left[\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\\right] \\le 1 \\implies \\lambda^2 \\cdot 1 \\le 1\n$$\n$$\n\\lambda^2 \\le 1\n$$\nSince the Courant number $\\lambda = \\frac{c\\Delta t}{\\Delta x}$ is defined with positive constants $\\Delta t$ and $\\Delta x$, and the wavespeed $c$ is also positive, $\\lambda$ is a non-negative quantity. Therefore, the stability condition simplifies to:\n$$\n0 \\le \\lambda \\le 1\n$$\nThe problem asks for the Courant–Friedrichs–Lewy (CFL) condition in the form $\\frac{c\\,\\Delta t}{\\Delta x} \\le \\lambda_{\\max}$. This corresponds to $\\lambda \\le \\lambda_{\\max}$, so we can identify $\\lambda_{\\max}$ as the upper bound of the stable range.\n$$\n\\lambda_{\\max} = 1\n$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "A stable simulation is a necessary, but not sufficient, condition for a useful one; it must also be accurate. In wave propagation, a primary source of error is numerical dispersion, where the discretized grid causes waves of different frequencies to travel at different speeds, distorting the waveform. This practice delves into dispersion analysis, allowing you to derive an analytical expression for the numerical phase velocity and understand how it deviates from the true physical velocity as a function of wavenumber and the CFL number .",
            "id": "3592755",
            "problem": "Consider the one-dimensional ($1$D) constant-density acoustic wave equation $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$ on an infinite line, where $u(x,t)$ is acoustic pressure and $c$ is the true wave speed. Discretize the equation using uniform spatial grid points $x_{j} = j \\Delta x$ with spacing $\\Delta x$, and uniform time levels $t_{n} = n \\Delta t$ with time step $\\Delta t$. Use the second-order centered finite-difference approximation in both space and time to obtain a linear explicit update equation relating $u^{n+1}_{j}$, $u^{n}_{j}$, and $u^{n-1}_{j}$ with $u^{n}_{j+1}$ and $u^{n}_{j-1}$. Starting from this discrete update equation and treating the grid as infinite, analyze the dispersion of discrete Fourier modes by assuming solutions of the form $u^{n}_{j} = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$, where $k$ is the Fourier wavenumber, $\\omega$ is the discrete angular frequency, and $A$ is a constant amplitude. Derive the discrete dispersion relation $\\omega(k)$ and then the numerical phase velocity $v_{p}(\\omega) = \\omega/k$. Define the Courant–Friedrichs–Lewy (CFL) number $\\sigma = c \\Delta t / \\Delta x$ and the dimensionless wavenumber $\\kappa = k \\Delta x$. Express your final answer as a single closed-form analytic expression for the ratio $v_{p}(\\omega)/c$ solely in terms of $\\sigma$ and $\\kappa$. No numerical evaluation is required, and no rounding is needed. The final answer must be an analytic expression.",
            "solution": "The problem requires the derivation of the numerical phase velocity for a finite-difference scheme applied to the one-dimensional acoustic wave equation. The process begins with the validation of the problem statement.\n\n### Step 1: Extract Givens\n- **Governing Equation:** The $1$D constant-density acoustic wave equation is $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$.\n- **Domain:** Infinite line.\n- **Variables:** $u(x,t)$ is the acoustic pressure, $c$ is the true wave speed.\n- **Discretization:**\n    - Spatial grid: $x_{j} = j \\Delta x$ with uniform spacing $\\Delta x$.\n    - Temporal grid: $t_{n} = n \\Delta t$ with uniform time step $\\Delta t$.\n- **Numerical Scheme:** Second-order centered finite-difference approximation in both space and time.\n- **Analysis Form:** A discrete Fourier mode solution is assumed: $u^{n}_{j} = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$, where $k$ is the wavenumber, $\\omega$ is the discrete angular frequency, and $A$ is a constant amplitude.\n- **Required Derivations:**\n    1. The discrete update equation.\n    2. The discrete dispersion relation $\\omega(k)$.\n    3. The numerical phase velocity $v_{p}(\\omega) = \\omega/k$.\n- **Parameter Definitions:**\n    - Courant–Friedrichs–Lewy (CFL) number: $\\sigma = c \\Delta t / \\Delta x$.\n    - Dimensionless wavenumber: $\\kappa = k \\Delta x$.\n- **Final Output:** An analytic expression for the ratio $v_{p}(\\omega)/c$ in terms of $\\sigma$ and $\\kappa$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as it deals with the standard analysis of a numerical method (finite differences) for a fundamental physical model (the wave equation). This is a classic topic in computational physics and geophysics. The problem is well-posed, with all necessary information provided for a unique analytical derivation. The terminology is precise and objective. There are no scientific or factual errors, no contradictions, and the setup is complete. The problem is a non-trivial exercise in applied mathematics and does not suffer from any of the flaws listed in the validation criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation\nThe governing partial differential equation is the $1$D acoustic wave equation:\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\nWe discretize this equation on a grid where $u(x_j, t_n)$ is approximated by $u^n_j$. The second-order centered finite-difference approximations for the second partial derivatives are:\n$$\n\\frac{\\partial^2 u}{\\partial t^2} \\bigg|_{j,n} \\approx \\frac{u^{n+1}_j - 2u^n_j + u^{n-1}_j}{(\\Delta t)^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{j,n} \\approx \\frac{u^n_{j+1} - 2u^n_j + u^n_{j-1}}{(\\Delta x)^2}\n$$\nSubstituting these approximations into the wave equation gives the discrete form:\n$$\n\\frac{u^{n+1}_j - 2u^n_j + u^{n-1}_j}{(\\Delta t)^2} = c^2 \\frac{u^n_{j+1} - 2u^n_j + u^n_{j-1}}{(\\Delta x)^2}\n$$\nRearranging to obtain the explicit update equation for $u^{n+1}_j$:\n$$\nu^{n+1}_j = 2u^n_j - u^{n-1}_j + \\left(\\frac{c \\Delta t}{\\Delta x}\\right)^2 (u^n_{j+1} - 2u^n_j + u^n_{j-1})\n$$\nUsing the definition of the CFL number, $\\sigma = c \\Delta t / \\Delta x$, the equation becomes:\n$$\nu^{n+1}_j = 2u^n_j - u^{n-1}_j + \\sigma^2 (u^n_{j+1} - 2u^n_j + u^n_{j-1})\n$$\nTo perform the dispersion analysis, we substitute the given Fourier mode solution, $u^{n}_{j} = A \\exp\\!\\big(i \\big(k x_j - \\omega t_n\\big)\\big) = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$, into the discrete equation. The relationships between the grid point values are:\n$$\nu^{n+1}_j = u^n_j \\exp(-i \\omega \\Delta t)\n$$\n$$\nu^{n-1}_j = u^n_j \\exp(i \\omega \\Delta t)\n$$\n$$\nu^n_{j+1} = u^n_j \\exp(i k \\Delta x)\n$$\n$$\nu^n_{j-1} = u^n_j \\exp(-i k \\Delta x)\n$$\nSubstituting these into the first form of the discrete equation and dividing by the common non-zero factor $u^n_j$ yields:\n$$\n\\frac{\\exp(-i \\omega \\Delta t) - 2 + \\exp(i \\omega \\Delta t)}{(\\Delta t)^2} = c^2 \\frac{\\exp(i k \\Delta x) - 2 + \\exp(-i k \\Delta x)}{(\\Delta x)^2}\n$$\nUsing the identity $2\\cos\\theta - 2 = -4\\sin^2(\\theta/2)$, derived from Euler's formula and the half-angle identity, we can simplify both sides of the equation:\n$$\n\\frac{-4\\sin^2(\\frac{\\omega \\Delta t}{2})}{(\\Delta t)^2} = c^2 \\frac{-4\\sin^2(\\frac{k \\Delta x}{2})}{(\\Delta x)^2}\n$$\nSimplifying this expression gives:\n$$\n\\frac{\\sin^2(\\frac{\\omega \\Delta t}{2})}{(\\Delta t)^2} = c^2 \\frac{\\sin^2(\\frac{k \\Delta x}{2})}{(\\Delta x)^2}\n$$\nTaking the positive square root of both sides (corresponding to a forward-propagating wave) yields the discrete dispersion relation:\n$$\n\\frac{\\sin(\\frac{\\omega \\Delta t}{2})}{\\Delta t} = \\frac{c}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nThis can be rewritten as:\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nWe now introduce the dimensionless parameters $\\sigma = c \\Delta t / \\Delta x$ and $\\kappa = k \\Delta x$. The dispersion relation becomes:\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\n$$\nFrom this, we solve for the discrete angular frequency $\\omega$:\n$$\n\\frac{\\omega \\Delta t}{2} = \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\implies \\omega = \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\nThe numerical phase velocity is defined as $v_p = \\omega/k$. Substituting the expression for $\\omega$:\n$$\nv_p = \\frac{1}{k} \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\nTo express this in the required final form, we substitute $k = \\kappa / \\Delta x$:\n$$\nv_p = \\frac{\\Delta x}{\\kappa} \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) = \\frac{2 \\Delta x}{\\kappa \\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\nFinally, we compute the ratio of the numerical phase velocity to the true wave speed, $v_p/c$:\n$$\n\\frac{v_p}{c} = \\frac{1}{c} \\left(\\frac{2 \\Delta x}{\\kappa \\Delta t}\\right) \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) = \\left(\\frac{\\Delta x}{c \\Delta t}\\right) \\frac{2}{\\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\nSince $\\sigma = c \\Delta t / \\Delta x$, we have $1/\\sigma = \\Delta x / (c \\Delta t)$. Substituting this into the equation provides the final expression solely in terms of $\\sigma$ and $\\kappa$:\n$$\n\\frac{v_p}{c} = \\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\nThis expression represents the ratio of the speed at which a single Fourier component propagates in the discrete grid to the true physical wave speed. This phenomenon, where the propagation speed depends on the wavenumber, is known as numerical dispersion. For the solution to be real-valued, the argument of the $\\arcsin$ function must be less than or equal to $1$ in magnitude. Since the maximum value of $|\\sin(\\kappa/2)|$ is $1$, this imposes the condition $|\\sigma| \\le 1$, which is the well-known CFL stability condition for this explicit scheme.",
            "answer": "$$\\boxed{\\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)}$$"
        },
        {
            "introduction": "Moving from one-dimensional analysis to two-dimensional implementation, we can test how well our numerical models uphold fundamental physical laws, such as the principle of reciprocity. This hands-on coding exercise challenges you to verify that swapping the source and receiver locations yields the same recording, a direct consequence of the underlying operator's self-adjointness. You will explore how this property holds for symmetric stencils and how it is broken by non-symmetric operators or the introduction of practical, non-conservative elements like absorbing boundary layers .",
            "id": "3592795",
            "problem": "Consider the two-dimensional acoustic wave equation for pressure $p(\\mathbf{x},t)$ in a homogeneous medium with constant wave speed $c$,\n$$\n\\frac{\\partial^2 p(\\mathbf{x},t)}{\\partial t^2} - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s),\n$$\nwhere $\\mathbf{x} = (x,y)$ denotes position, $t$ denotes time, $c$ denotes wave speed, $\\nabla^2$ denotes the Laplacian operator in space, $s(t)$ denotes a temporally compact source wavelet, and $\\delta(\\cdot)$ denotes the Dirac delta distribution. Under suitable boundary conditions and for linear, time-invariant, self-adjoint spatial operators, the Green's function $G(\\mathbf{x}_s,\\mathbf{x}_r,t)$, defined as the pressure recorded at receiver location $\\mathbf{x}_r$ due to an impulsive source at $\\mathbf{x}_s$, is symmetric with respect to source and receiver exchange,\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t).\n$$\nThis property is known as reciprocity. In computational geophysics, finite difference discretization of the acoustic wave equation must preserve operator symmetry to maintain discrete reciprocity. Non-symmetric stencils and damping layers, such as those used in Perfectly Matched Layer (PML) boundary treatments, can violate reciprocity because they render the discrete operator non-self-adjoint.\n\nStarting only from the acoustic wave equation, the definition of reciprocity, and the concept of self-adjointness, derive how discrete reciprocity is expected to hold when using symmetric central differences under reflecting boundaries, and explain how it can be violated when using non-symmetric stencils or spatially varying first-order damping terms that approximate PML behavior. Then, implement a two-dimensional finite difference time-domain solver for the acoustic wave equation to empirically test discrete reciprocity in three cases:\n- Case A: Symmetric central-difference Laplacian without damping.\n- Case B: Non-symmetric forward-difference Laplacian without damping.\n- Case C: Symmetric central-difference Laplacian with a boundary damping layer (a PML-like sponge) implemented as an additional term $+\\sigma(\\mathbf{x})\\,\\partial_t p$ in the equation.\n\nUse the following scientifically self-consistent parameters and units:\n- Grid size: $N_x = 64$, $N_y = 64$ spatial samples.\n- Spatial sampling: $\\Delta x = 10\\,\\mathrm{m}$, $\\Delta y = 10\\,\\mathrm{m}$.\n- Constant wave speed: $c = 1500\\,\\mathrm{m/s}$.\n- Time step: $\\Delta t = 0.45\\,\\Delta x/(c\\sqrt{2})\\,\\mathrm{s}$.\n- Number of time steps: $N_t = 400$.\n- Source wavelet: Ricker wavelet with peak frequency $f_0 = 5\\,\\mathrm{Hz}$ and peak time $t_0 = 1.5/f_0\\,\\mathrm{s}$,\n$$\ns(t) = \\left(1 - 2\\pi^2 f_0^2 (t-t_0)^2\\right)\\,\\exp\\left(-\\pi^2 f_0^2 (t-t_0)^2\\right).\n$$\n- Boundary condition for non-damped cases: homogeneous Dirichlet boundaries implemented by setting $p=0$ at the domain edges after each update.\n- Boundary damping for Case C: sponge profile of thickness $N_{\\mathrm{pml}} = 12$ grid points with\n$$\n\\sigma(\\mathbf{x}) = \\begin{cases}\n\\sigma_{\\max}\\left(1 - \\frac{d(\\mathbf{x})}{N_{\\mathrm{pml}}}\\right)^2 & \\text{if } d(\\mathbf{x}) < N_{\\mathrm{pml}}, \\\\\n0 & \\text{otherwise},\n\\end{cases}\n$$\nwhere $d(\\mathbf{x})$ is the minimum distance in grid points from $\\mathbf{x}$ to any domain boundary, and $\\sigma_{\\max} = 50\\,\\mathrm{s}^{-1}$.\n- Source and receiver index pairs given in grid indices $(i,j)$ with $i\\in\\{0,\\dots,N_x-1\\}$, $j\\in\\{0,\\dots,N_y-1\\}$:\n    - Case A: $\\mathbf{x}_s = (32,20)$, $\\mathbf{x}_r = (42,44)$.\n    - Case B: $\\mathbf{x}_s = (32,20)$, $\\mathbf{x}_r = (42,44)$.\n    - Case C: $\\mathbf{x}_s = (14,14)$, $\\mathbf{x}_r = (50,40)$.\n\nImplement the discrete time stepping using the second-order leapfrog method for time and the specified spatial stencil for each case. For Case C, discretize the damping term $+\\sigma(\\mathbf{x})\\,\\partial_t p$ using a first-order backward difference in time at each grid point to obtain a fully explicit update.\n\nFor each case, compute the two receiver time series $g_A[n]$ and $g_B[n]$ with $n\\in\\{0,\\dots,N_t-1\\}$, corresponding to the pressure recorded at $\\mathbf{x}_r$ when sourcing at $\\mathbf{x}_s$, and the pressure recorded at $\\mathbf{x}_s$ when sourcing at $\\mathbf{x}_r$, respectively. Quantify reciprocity through the normalized residual\n$$\n\\rho = \\frac{\\left\\|\\mathbf{g}_A - \\mathbf{g}_B\\right\\|_2}{\\max\\left(\\left\\|\\mathbf{g}_A\\right\\|_2,\\,\\left\\|\\mathbf{g}_B\\right\\|_2\\right)},\n$$\nwhich is dimensionless. Report one $\\rho$ value per case.\n\nYour program should produce a single line of output containing the three residuals as a comma-separated list enclosed in square brackets, with no spaces, in dimensionless units. For example, the format must be exactly like $[\\rho_A,\\rho_B,\\rho_C]$. The output type must be a list of three floats. The test suite is the three cases specified above, which together test the happy path (Case A, symmetric stencil and no damping), a significant edge case (Case B, non-symmetric stencil violating self-adjointness), and boundary damping effects (Case C, PML-like $\\sigma(\\mathbf{x})$ layer breaking reciprocity via non-self-adjointness). No user input is allowed; all parameters are fixed as provided.",
            "solution": "The problem requires a theoretical derivation concerning discrete reciprocity in finite-difference schemes for the acoustic wave equation, followed by a numerical implementation to verify the derived principles.\n\nThe two-dimensional acoustic wave equation for pressure $p(\\mathbf{x},t)$ in a homogeneous medium is given by:\n$$\n\\frac{\\partial^2 p(\\mathbf{x},t)}{\\partial t^2} - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\nHere, the first term is the second partial derivative with respect to time $t$, $c$ is the constant wave speed, $\\nabla^2$ is the spatial Laplacian operator, $s(t)$ is the source time function, and $\\delta(\\mathbf{x}-\\mathbf{x}_s)$ represents a point source at location $\\mathbf{x}_s$.\n\nReciprocity is the principle that the recorded wavefield at a receiver location $\\mathbf{x}_r$ due to a source at $\\mathbf{x}_s$ is identical to the wavefield recorded at $\\mathbf{x}_s$ due to a source at $\\mathbf{x}_r$. In the context of the Green's function $G(\\mathbf{x}_s, \\mathbf{x}_r, t)$, this is expressed as:\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t)\n$$\nThis property arises from the self-adjointness of the spatial operator (here, $-c^2\\nabla^2$) and the time-reversal symmetry of the wave equation. When we discretize the equation, these properties must be preserved in the discrete operators to maintain discrete reciprocity.\n\nLet the pressure field be discretized on a grid as $p_{i,j}^n \\approx p(i\\Delta x, j\\Delta y, n\\Delta t)$. A general explicit finite-difference scheme can be written in matrix-vector form. Let $\\mathbf{p}^n$ be a vector containing the pressure values at all grid points at time step $n$. The standard second-order leapfrog discretization in time is:\n$$\n\\frac{\\mathbf{p}^{n+1} - 2\\mathbf{p}^n + \\mathbf{p}^{n-1}}{\\Delta t^2} - c^2 \\mathbf{L} \\mathbf{p}^n = \\mathbf{s}^n\n$$\nwhere $\\mathbf{L}$ is the matrix representing the discrete Laplacian operator and $\\mathbf{s}^n$ is the discrete source vector. Rearranging for the time-stepping update gives:\n$$\n\\mathbf{p}^{n+1} = 2\\mathbf{p}^n - \\mathbf{p}^{n-1} + c^2 \\Delta t^2 \\mathbf{L} \\mathbf{p}^n + \\Delta t^2 \\mathbf{s}^n\n$$\nDiscrete reciprocity holds if and only if the discrete spatial operator, represented by the matrix $\\mathbf{L}$, is symmetric, i.e., $\\mathbf{L} = \\mathbf{L}^T$. This is the discrete analogue of the self-adjoint property.\n\nLet's analyze the three cases presented in the problem.\n\nCase A: Symmetric Central-Difference Laplacian\nThe second-order central-difference approximation for the Laplacian at grid point $(i,j)$ is:\n$$\n(\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\\Delta y^2}\n$$\nWhen assembling the matrix $\\mathbf{L}$ from this stencil, the entry $L_{uv}$ representing the contribution of grid point $v$ to the Laplacian at grid point $u$ is non-zero only if $u$ and $v$ are neighbors. Due to the stencil's symmetry, the contribution of point $j$ to the equation for point $i$ is identical to the contribution of point $i$ to the equation for point $j$. For instance, for two horizontally adjacent points $u=(i,j)$ and $v=(i+1,j)$, the coefficient in the row for $u$ corresponding to the column for $v$ is $1/\\Delta x^2$, and the coefficient in the row for $v$ corresponding to the column for $u$ is also $1/\\Delta x^2$. This ensures that the matrix $\\mathbf{L}$ is symmetric. The homogeneous Dirichlet boundary conditions, implemented by forcing pressure to zero at the boundaries, also respect this symmetry. Therefore, the discrete operator is self-adjoint, and we expect discrete reciprocity to hold to within machine precision. The reciprocity residual $\\rho$ should be close to zero.\n\nCase B: Non-Symmetric Forward-Difference Laplacian\nA non-symmetric approximation for the Laplacian can be constructed by applying a forward difference operator twice. The forward-difference approximation for the second derivative in $x$ is:\n$$\n(\\partial_{xx} p)_{i,j} \\approx \\frac{p_{i+2,j} - 2p_{i+1,j} + p_{i,j}}{\\Delta x^2}\n$$\nThe resulting discrete Laplacian operator $\\mathbf{L}$ is no longer symmetric. The equation for $p_{i,j}$ depends on values at $p_{i,j}$, $p_{i+1,j}$, and $p_{i+2,j}$. In the matrix $\\mathbf{L}$, the row corresponding to point $(i,j)$ will have non-zero entries for columns corresponding to points $(i,j)$, $(i+1,j)$, and $(i+2,j)$. However, the row for point $(i+1,j)$ will not contain a corresponding contribution from point $(i,j)$ in the same manner. The resulting matrix is non-symmetric ($\\mathbf{L} \\neq \\mathbf{L}^T$), typically being a banded matrix with non-zero entries on diagonals other than those symmetric about the main diagonal. This breaks the self-adjointness of the discrete operator, and thus, discrete reciprocity is expected to be violated. The residual $\\rho$ should be significantly greater than zero.\n\nCase C: Symmetric Laplacian with Damping\nThe wave equation is modified with a first-order damping term:\n$$\n\\frac{\\partial^2 p}{\\partial t^2} + \\sigma(\\mathbf{x})\\,\\partial_t p - c^2 \\nabla^2 p = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\nThis term is intended to absorb outgoing waves at the boundary, mimicking a Perfectly Matched Layer (PML). We use a symmetric stencil for $\\nabla^2 p$, but the new term $\\sigma(\\mathbf{x})\\,\\partial_t p$ breaks the overall operator symmetry. Discretizing this term with a first-order backward difference, $\\partial_t p \\approx (p^n - p^{n-1})/\\Delta t$, maintains an explicit update scheme. The full discrete equation for point $(i,j)$ is:\n$$\n\\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2} + \\sigma_{i,j} \\frac{p_{i,j}^n - p_{i,j}^{n-1}}{\\Delta t} - c^2 (\\nabla^2 p^n)_{i,j} = s_{i,j}^n\n$$\nSolving for $p_{i,j}^{n+1}$:\n$$\np_{i,j}^{n+1} = (2 - \\sigma_{i,j}\\Delta t) p_{i,j}^n - (1 - \\sigma_{i,j}\\Delta t) p_{i,j}^{n-1} + c^2 \\Delta t^2 (\\nabla^2 p^n)_{i,j} + \\Delta t^2 s_{i,j}^n\n$$\nThe damping term introduces dissipation, which breaks the time-reversal symmetry of the system. A system with dissipation is non-conservative. This loss of time-reversal symmetry is fundamentally linked to the loss of self-adjointness. The operator governing the evolution is no longer self-adjoint, even if the spatial Laplacian part $\\mathbf{L}$ is symmetric. Consequently, reciprocity is violated. The violation will be most pronounced for wave paths that interact with the damping layer where $\\sigma(\\mathbf{x}) > 0$. We expect the residual $\\rho$ to be substantially non-zero.\n\nThe numerical implementation below will compute the reciprocity residual $\\rho$ for these three cases to confirm these theoretical expectations.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 2D acoustic wave equation using finite differences to test\n    the principle of discrete reciprocity under three different conditions.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    Nx = 64  # Grid points in x\n    Ny = 64  # Grid points in y\n    dx = 10.0  # Spatial step in x (m)\n    dy = 10.0  # Spatial step in y (m)\n    c = 1500.0  # Wave speed (m/s)\n    Nt = 400  # Number of time steps\n    f0 = 5.0  # Peak frequency of Ricker wavelet (Hz)\n    Npml = 12 # Thickness of sponge layer (grid points)\n    sigma_max = 50.0 # Maximum damping coefficient (s^-1)\n\n    # Stability condition (CFL)\n    # dt <= dx / (c * sqrt(2)) for dx=dy\n    # A factor of 0.45 is used, well within the stable limit of 1.\n    dt = 0.45 * dx / (c * np.sqrt(2))\n\n    t0 = 1.5 / f0  # Peak time of Ricker wavelet\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Symmetric stencil, no damping\n        ('A', (32, 20), (42, 44)),\n        # Case B: Non-symmetric stencil, no damping\n        ('B', (32, 20), (42, 44)),\n        # Case C: Symmetric stencil, damping\n        ('C', (14, 14), (50, 40)),\n    ]\n\n    # --- Helper Functions ---\n    def ricker_wavelet(t, f0, t0):\n        \"\"\"Generates a Ricker wavelet.\"\"\"\n        arg = (np.pi * f0 * (t - t0))**2\n        return (1.0 - 2.0 * arg) * np.exp(-arg)\n\n    # Pre-calculate source time series\n    time_vec = np.arange(Nt) * dt\n    source_ts = ricker_wavelet(time_vec, f0, t0)\n    \n    # Pre-calculate damping profile for Case C\n    sigma = np.zeros((Nx, Ny), dtype=np.float64)\n    xx, yy = np.meshgrid(np.arange(Nx), np.arange(Ny), indexing='ij')\n    dist_to_left = xx\n    dist_to_right = Nx - 1 - xx\n    dist_to_top = yy\n    dist_to_bottom = Ny - 1 - yy\n    d = np.minimum.reduce([dist_to_left, dist_to_right, dist_to_top, dist_to_bottom])\n    pml_zone = d < Npml\n    sigma[pml_zone] = sigma_max * (1 - d[pml_zone] / Npml)**2\n\n    def run_simulation(src_pos, rec_pos, case_type):\n        \"\"\"\n        Runs a single FDTD simulation for a given setup.\n        \"\"\"\n        p_prev = np.zeros((Nx, Ny), dtype=np.float64)\n        p_now = np.zeros((Nx, Ny), dtype=np.float64)\n        p_next = np.zeros((Nx, Ny), dtype=np.float64)\n        \n        seismogram = np.zeros(Nt, dtype=np.float64)\n        \n        src_ix, src_iy = src_pos\n        rec_ix, rec_iy = rec_pos\n\n        # Source scaling to approximate Dirac delta\n        source_amp_scaled = source_ts / (dx * dy)\n\n        # Time-stepping loop\n        for n in range(Nt):\n            # Record pressure at receiver\n            seismogram[n] = p_now[rec_ix, rec_iy]\n            \n            # --- Calculate Laplacian ---\n            lap_p = np.zeros_like(p_now)\n            if case_type == 'A' or case_type == 'C':\n                # 5-point symmetric central-difference stencil\n                p_ip1 = p_now[2:, 1:-1]\n                p_im1 = p_now[0:-2, 1:-1]\n                p_jp1 = p_now[1:-1, 2:]\n                p_jm1 = p_now[1:-1, 0:-2]\n                p_cen = p_now[1:-1, 1:-1]\n                lap_p[1:-1, 1:-1] = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4 * p_cen) / dx**2\n            \n            elif case_type == 'B':\n                # Non-symmetric forward-difference second derivative\n                lap_p_x = np.zeros_like(p_now)\n                lap_p_y = np.zeros_like(p_now)\n                \n                # Use p(i+2)-2p(i+1)+p(i) stencil\n                lap_p_x[0:Nx-2, :] = (p_now[2:Nx, :] - 2 * p_now[1:Nx-1, :] + p_now[0:Nx-2, :]) / dx**2\n                lap_p_y[:, 0:Ny-2] = (p_now[:, 2:Ny] - 2 * p_now[:, 1:Ny-1] + p_now[:, 0:Ny-2]) / dy**2\n                lap_p = lap_p_x + lap_p_y\n\n            # --- Time update ---\n            c_eff = c * dt\n            if case_type == 'C':\n                # Update with damping\n                p_next = (2.0 - sigma * dt) * p_now - (1.0 - sigma * dt) * p_prev + c_eff**2 * lap_p\n            else:\n                # Standard leapfrog update\n                p_next = 2.0 * p_now - p_prev + c_eff**2 * lap_p\n            \n            # --- Add source ---\n            p_next[src_ix, src_iy] += source_amp_scaled[n] * dt**2\n            \n            # --- Apply boundary conditions ---\n            if case_type == 'A' or case_type == 'B':\n                # Homogeneous Dirichlet BC\n                p_next[0, :] = 0.0\n                p_next[-1, :] = 0.0\n                p_next[:, 0] = 0.0\n                p_next[:, -1] = 0.0\n            \n            # --- Update pressure fields ---\n            p_prev, p_now = p_now, p_next\n            \n        return seismogram\n\n    results = []\n    for case, src_pos, rec_pos in test_cases:\n        # Run simulation for (source, receiver)\n        g_A = run_simulation(src_pos, rec_pos, case)\n        \n        # Run simulation for (receiver, source)\n        g_B = run_simulation(rec_pos, src_pos, case)\n        \n        # Calculate normalized residual\n        norm_g_A = np.linalg.norm(g_A)\n        norm_g_B = np.linalg.norm(g_B)\n        norm_diff = np.linalg.norm(g_A - g_B)\n        \n        if max(norm_g_A, norm_g_B) == 0:\n            rho = 0.0\n        else:\n            rho = norm_diff / max(norm_g_A, norm_g_B)\n        \n        results.append(rho)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}