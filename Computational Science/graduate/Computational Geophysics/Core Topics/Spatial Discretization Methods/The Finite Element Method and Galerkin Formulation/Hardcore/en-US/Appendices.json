{
    "hands_on_practices": [
        {
            "introduction": "To master the finite element method, there is no substitute for building a system from the ground up. This first exercise guides you through the entire process for the canonical one-dimensional diffusion equation, a fundamental model in many geophysical contexts. By deriving the weak form, constructing element stiffness matrices, and assembling them into a global system, you will gain a concrete understanding of how a differential equation is transformed into a solvable algebraic problem .",
            "id": "3616475",
            "problem": "Consider the one-dimensional ($1$-D) steady diffusion operator used in computational geophysics, governed on the interval $[0,L]$ by the strong form partial differential equation (PDE)\n$$\n-\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)=f(x),\n$$\nwhere $a>0$ is a constant material property and $f(x)$ is a prescribed source term. Impose homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(L)=0$. Discretize the domain with the finite element method (FEM) using the standard Galerkin formulation (trial and test spaces identical) and continuous, piecewise-linear shape functions over a mesh of $3$ elements with nodal coordinates $x_0=0$, $x_1=h_1$, $x_2=h_1+h_2$, $x_3=h_1+h_2+h_3=L$, where $h_1>0$, $h_2>0$, and $h_3>0$ are the element lengths.\n\nStarting from the strong form, derive the corresponding weak form and the element stiffness matrix for a single linear element with constant $a$. Then assemble the global stiffness matrix for the full $3$-element mesh before applying boundary conditions, clearly identifying its banded (tridiagonal) structure that arises from the locality of the basis functions. Next, enforce the homogeneous Dirichlet boundary conditions by eliminating the rows and columns associated with the boundary nodes at $x_0$ and $x_3$ to obtain the reduced global system for the interior degrees of freedom.\n\nReport, as your final answer, the exact analytic expression for the determinant of the reduced global stiffness matrix in terms of $a$, $h_1$, $h_2$, and $h_3$. Express the final answer as a symbolic expression. Do not include units. No rounding is required.",
            "solution": "The starting point is the strong form PDE\n$$\n-\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)=f(x)\\quad\\text{on}\\quad [0,L],\n$$\nwith homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(L)=0$. To obtain the weak form, choose a test function $v(x)$ from the same space as the trial function (Galerkin choice), with $v(0)=0$ and $v(L)=0$. Multiply the strong form by $v$ and integrate over $[0,L]$:\n$$\n\\int_{0}^{L} -\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)\\,v\\,dx=\\int_{0}^{L} f\\,v\\,dx.\n$$\nUsing integration by parts on the left-hand side and the boundary conditions $u(0)=0$, $u(L)=0$, $v(0)=0$, and $v(L)=0$, we obtain\n$$\n\\int_{0}^{L} a\\,\\frac{du}{dx}\\,\\frac{dv}{dx}\\,dx=\\int_{0}^{L} f\\,v\\,dx.\n$$\nThis is the weak form: find $u$ in the appropriate Sobolev space with essential boundary conditions such that\n$$\n\\int_{0}^{L} a\\,u'(x)\\,v'(x)\\,dx=\\int_{0}^{L} f(x)\\,v(x)\\,dx\n$$\nfor all admissible $v$.\n\nDiscretize the domain into $3$ elements with nodes at $x_0=0$, $x_1=h_1$, $x_2=h_1+h_2$, and $x_3=h_1+h_2+h_3=L$. Approximate $u(x)$ as\n$$\nu(x)\\approx \\sum_{i=0}^{3} U_i\\,N_i(x),\n$$\nwhere $N_i(x)$ are the standard continuous, piecewise-linear shape functions associated with nodes $x_i$ and $U_i$ are the nodal values. In one dimension with linear elements, the element stiffness matrix over an element $e=[x_i,x_{i+1}]$ of length $h_e=x_{i+1}-x_i$ follows from\n$$\n\\mathbf{k}^{(e)}=\\int_{x_i}^{x_{i+1}} a\\,\\mathbf{B}^\\top \\mathbf{B}\\,dx,\n$$\nwhere $\\mathbf{B}=[N_1'(x),\\,N_2'(x)]$ collects the derivatives of the local element shape functions. On a linear element, $N_1'(x)=-\\frac{1}{h_e}$ and $N_2'(x)=\\frac{1}{h_e}$, both constants over $e$. Therefore,\n$$\n\\mathbf{B}^\\top \\mathbf{B}=\n\\begin{pmatrix}\n\\left(-\\frac{1}{h_e}\\right)^2 & -\\frac{1}{h_e}\\cdot \\frac{1}{h_e} \\\\\n-\\frac{1}{h_e}\\cdot \\frac{1}{h_e} & \\left(\\frac{1}{h_e}\\right)^2\n\\end{pmatrix}\n=\\frac{1}{h_e^2}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}.\n$$\nIntegrating over the element length,\n$$\n\\mathbf{k}^{(e)}=\\int_{x_i}^{x_{i+1}} a\\,\\frac{1}{h_e^2}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix} dx\n= a\\,\\frac{1}{h_e}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}.\n$$\nHence, for each element $e$ with length $h_e$, the element stiffness matrix is\n$$\n\\mathbf{k}^{(e)}= \\frac{a}{h_e}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}.\n$$\n\nWe now assemble the global stiffness matrix $\\mathbf{K}$ of size $4\\times 4$ associated with the $4$ nodal degrees of freedom $\\{U_0,U_1,U_2,U_3\\}$. Denote the three elements by $e_1=[x_0,x_1]$ with length $h_1$, $e_2=[x_1,x_2]$ with length $h_2$, and $e_3=[x_2,x_3]$ with length $h_3$. The element contributions in the global $(0,1,2,3)$ ordering are:\n$$\n\\mathbf{k}^{(e_1)}=\\frac{a}{h_1}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}\n\\quad\\text{on the global indices}\\quad (0,1),\n$$\n$$\n\\mathbf{k}^{(e_2)}=\\frac{a}{h_2}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}\n\\quad\\text{on the global indices}\\quad (1,2),\n$$\n$$\n\\mathbf{k}^{(e_3)}=\\frac{a}{h_3}\n\\begin{pmatrix}\n1 & -1 \\\\ -1 & 1\n\\end{pmatrix}\n\\quad\\text{on the global indices}\\quad (2,3).\n$$\nSumming these contributions yields the assembled global stiffness matrix\n$$\n\\mathbf{K}=\n\\begin{pmatrix}\n\\frac{a}{h_1} & -\\frac{a}{h_1} & 0 & 0 \\\\\n-\\frac{a}{h_1} & \\frac{a}{h_1}+\\frac{a}{h_2} & -\\frac{a}{h_2} & 0 \\\\\n0 & -\\frac{a}{h_2} & \\frac{a}{h_2}+\\frac{a}{h_3} & -\\frac{a}{h_3} \\\\\n0 & 0 & -\\frac{a}{h_3} & \\frac{a}{h_3}\n\\end{pmatrix}.\n$$\nThis matrix is symmetric and tridiagonal, illustrating a banded structure with half-bandwidth equal to $1$, which is characteristic of one-dimensional ($1$-D) problems with nearest-neighbor coupling under linear shape functions.\n\nWe now impose the homogeneous Dirichlet boundary conditions $U_0=0$ and $U_3=0$ by eliminating the associated rows and columns, leaving the reduced system for the interior degrees of freedom $\\{U_1,U_2\\}$. The reduced global stiffness matrix $\\mathbf{K}_{\\text{r}}$ is the $2\\times 2$ principal submatrix\n$$\n\\mathbf{K}_{\\text{r}}=\n\\begin{pmatrix}\n\\frac{a}{h_1}+\\frac{a}{h_2} & -\\frac{a}{h_2} \\\\\n-\\frac{a}{h_2} & \\frac{a}{h_2}+\\frac{a}{h_3}\n\\end{pmatrix}\n= a\\begin{pmatrix}\n\\frac{1}{h_1}+\\frac{1}{h_2} & -\\frac{1}{h_2} \\\\\n-\\frac{1}{h_2} & \\frac{1}{h_2}+\\frac{1}{h_3}\n\\end{pmatrix}.\n$$\nThe determinant of $\\mathbf{K}_{\\text{r}}$ is\n$$\n\\det(\\mathbf{K}_{\\text{r}})=\\left(\\frac{a}{h_1}+\\frac{a}{h_2}\\right)\\left(\\frac{a}{h_2}+\\frac{a}{h_3}\\right)-\\left(-\\frac{a}{h_2}\\right)^2\n= a^2\\left[\\left(\\frac{1}{h_1}+\\frac{1}{h_2}\\right)\\left(\\frac{1}{h_2}+\\frac{1}{h_3}\\right)-\\left(\\frac{1}{h_2}\\right)^2\\right].\n$$\nExpanding and simplifying the bracketed expression,\n$$\n\\left(\\frac{1}{h_1}+\\frac{1}{h_2}\\right)\\left(\\frac{1}{h_2}+\\frac{1}{h_3}\\right)-\\left(\\frac{1}{h_2}\\right)^2\n= \\left(\\frac{1}{h_1 h_2} + \\frac{1}{h_1 h_3} + \\frac{1}{h_2^2} + \\frac{1}{h_2 h_3}\\right) - \\frac{1}{h_2^2} = \\frac{1}{h_1 h_2}+\\frac{1}{h_1 h_3}+\\frac{1}{h_2 h_3}.\n$$\nEquivalently, with a common denominator $h_1 h_2 h_3$, this can be written as\n$$\n\\frac{h_3+h_2+h_1}{h_1 h_2 h_3}.\n$$\nTherefore,\n$$\n\\det(\\mathbf{K}_{\\text{r}})=a^2\\,\\frac{h_1+h_2+h_3}{h_1 h_2 h_3}.\n$$\nThis is the exact analytic expression for the determinant of the reduced global stiffness matrix, obtained from first principles via the Galerkin finite element method and explicit assembly on the given three-element mesh.",
            "answer": "$$\\boxed{a^{2}\\,\\frac{h_{1}+h_{2}+h_{3}}{h_{1} h_{2} h_{3}}}$$"
        },
        {
            "introduction": "Building on the one-dimensional foundation, we now advance to a more realistic scenario in solid earth geophysics: the elastic deformation of a two-dimensional, layered medium. This practice introduces the complexities of vector-valued fields and material heterogeneity. You will construct the essential strain-displacement matrix, $\\boldsymbol{B}$, for triangular elements and assemble a global system that accounts for varying material properties, a common situation when modeling Earth's subsurface .",
            "id": "3616479",
            "problem": "Consider small-strain, linear, isotropic elasticity in plane strain for a two-dimensional layered medium. The Finite Element Method (FEM) with the Galerkin formulation is to be applied using linear triangular elements. The bottom layer occupies the region $y \\in [0, 0.5]$ and is characterized by Lamé parameters $(\\lambda_{1}, \\mu_{1})$. The top layer occupies the region $y \\in (0.5, 1]$ with Lamé parameters $(\\lambda_{2}, \\mu_{2})$. Assume unit out-of-plane thickness.\n\nThe domain is the unit square $\\Omega = [0,1] \\times [0,1]$ partitioned into four linear triangular elements with global node coordinates\n- Node $1$: $(0,0)$,\n- Node $2$: $(1,0)$,\n- Node $3$: $(0,0.5)$,\n- Node $4$: $(1,0.5)$,\n- Node $5$: $(0,1)$,\n- Node $6$: $(1,1)$,\nand elements\n- Element $E_{1}$: nodes $(1,2,3)$ in the bottom layer,\n- Element $E_{2}$: nodes $(2,4,3)$ in the bottom layer,\n- Element $E_{3}$: nodes $(3,4,5)$ in the top layer,\n- Element $E_{4}$: nodes $(4,6,5)$ in the top layer.\n\nAdopt the standard plane strain setting with the symmetric gradient strain measure $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\begin{pmatrix}\\partial u_{x}/\\partial x \\\\ \\partial u_{y}/\\partial y \\\\ \\partial u_{x}/\\partial y + \\partial u_{y}/\\partial x \\end{pmatrix}$ and linear elastic constitutive relation $\\boldsymbol{\\sigma} = \\boldsymbol{C} \\, \\boldsymbol{\\varepsilon}$, where for each layer the elasticity tensor is defined by the Lamé parameters $(\\lambda,\\mu)$ as\n$$\n\\boldsymbol{C} = \\begin{pmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{pmatrix}.\n$$\n\nTasks:\n1. For a single linear triangular element with nodal coordinates $(x_{i},y_{i})$, derive the constant strain-displacement matrix $\\boldsymbol{B}$ from first principles and write the element stiffness matrix as $\\boldsymbol{K}^{(e)} = \\int_{\\Omega_{e}} \\boldsymbol{B}^{\\top} \\boldsymbol{C} \\, \\boldsymbol{B} \\, \\mathrm{d}\\Omega$. Then, explicitly compute $\\boldsymbol{B}$ and $\\boldsymbol{K}^{(e)}$ for element $E_{1}$ using $(\\lambda_{1},\\mu_{1})$.\n2. Assemble the global stiffness matrix $\\boldsymbol{K}$ for the entire mesh by appropriate placement and summation of the element stiffness contributions from $E_{1}, E_{2}$ (with $(\\lambda_{1},\\mu_{1})$) and $E_{3}, E_{4}$ (with $(\\lambda_{2},\\mu_{2})$).\n3. Impose essential (Dirichlet) boundary conditions by constraining all displacement components on the bottom edge $y=0$ to zero, i.e., $u_{x} = 0$ and $u_{y} = 0$ at nodes $1$ and $2$, and additionally constrain $u_{x} = 0$ at node $5$ to eliminate any residual rigid body motion in the horizontal direction. Let $\\boldsymbol{K}_{\\text{red}}$ denote the reduced global stiffness matrix after applying these constraints.\n4. Define a test discrete displacement vector $\\boldsymbol{v}$ consistent with the continuous field $u_{x}(x,y) = 0$, $u_{y}(x,y) = y$ at the free nodes of the mesh, i.e., set each free nodal displacement component equal to the value of the field at that node (and zero at constrained nodes). Using the energy identity associated with the Galerkin bilinear form, compute the scalar quantity $s = \\boldsymbol{v}^{\\top} \\boldsymbol{K}_{\\text{red}} \\boldsymbol{v}$ symbolically in terms of $(\\lambda_{1},\\mu_{1},\\lambda_{2},\\mu_{2})$.\n\nProvide your final answer as a single closed-form analytic expression for $s$. No numerical rounding is required. No physical units are to be included in the final expression.",
            "solution": "The solution proceeds by following the sequence of tasks outlined in the problem statement, leveraging standard FEM theory and an efficient computational path for the final result.\n\n**Part 1: Element Stiffness Matrix Formulation**\n\nFor a linear triangular element (Constant Strain Triangle, CST), the displacement field $\\boldsymbol{u}(x,y)$ is interpolated from the nodal displacements $\\boldsymbol{d}^{(e)} = [u_{x1}, u_{y1}, u_{x2}, u_{y2}, u_{x3}, u_{y3}]^{\\top}$ using linear shape functions $N_i(x,y)$:\n$$ \\boldsymbol{u}(x,y) = \\sum_{i=1}^{3} N_i(x,y) \\boldsymbol{u}_i $$\nThe shape function for node $i$ with coordinates $(x_i, y_i)$ is given by $N_i = \\frac{1}{2A}(a_i + b_i x + c_i y)$, where $A$ is the area of the element and the coefficients are $b_i = y_j - y_k$ and $c_i = x_k - x_j$ for a counter-clockwise ordering of nodes $(i, j, k)$.\n\nThe strain vector $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\top}$ is derived by applying the symmetric gradient operator to the displacement field, which results in the algebraic relation $\\boldsymbol{\\varepsilon} = \\boldsymbol{B} \\boldsymbol{d}^{(e)}$. The strain-displacement matrix $\\boldsymbol{B}$ for a CST element is constant and given by:\n$$ \\boldsymbol{B} = \\frac{1}{2A} \\begin{pmatrix} b_1 & 0 & b_2 & 0 & b_3 & 0 \\\\ 0 & c_1 & 0 & c_2 & 0 & c_3 \\\\ c_1 & b_1 & c_2 & b_2 & c_3 & b_3 \\end{pmatrix} $$\n\nThe element stiffness matrix $\\boldsymbol{K}^{(e)}$ is defined by the integral $\\boldsymbol{K}^{(e)} = \\int_{\\Omega_{e}} \\boldsymbol{B}^{\\top} \\boldsymbol{C} \\boldsymbol{B} \\mathrm{d}\\Omega$. Since $\\boldsymbol{B}$ and $\\boldsymbol{C}$ are constant within the element, this simplifies to $\\boldsymbol{K}^{(e)} = A \\boldsymbol{B}^{\\top} \\boldsymbol{C} \\boldsymbol{B}$.\n\n**Part 2 & 3: Global Assembly and Boundary Conditions**\n\nThe global stiffness matrix $\\boldsymbol{K}$ is a $12 \\times 12$ matrix (6 nodes, 2 DOFs/node) formed by assembling the stiffness matrices from the four elements according to their nodal connectivity. After calculating the full $\\boldsymbol{K}$, the rows and columns corresponding to constrained DOFs are removed to obtain $\\boldsymbol{K}_{\\text{red}}$.\n\n**Part 4: Energy Calculation**\n\nA more direct method to compute $s = \\boldsymbol{v}^{\\top} \\boldsymbol{K}_{\\text{red}} \\boldsymbol{v}$ is to use the energy identity $s = \\boldsymbol{d}^{\\top} \\boldsymbol{K} \\boldsymbol{d}$, where $\\boldsymbol{d}$ is the global displacement vector. The constrained components of $\\boldsymbol{d}$ are zero, so they do not affect the result. The total energy can be calculated by summing the energy contributions from each element:\n$$ s = \\boldsymbol{d}^{\\top} \\boldsymbol{K} \\boldsymbol{d} = \\sum_{e=1}^{4} (\\boldsymbol{d}^{(e)})^{\\top} \\boldsymbol{K}^{(e)} \\boldsymbol{d}^{(e)} $$\nwhere $\\boldsymbol{d}^{(e)}$ are the nodal displacements for element $e$. Substituting the expression for $\\boldsymbol{K}^{(e)}$:\n$$ s = \\sum_{e=1}^{4} A_e (\\boldsymbol{B}_e \\boldsymbol{d}^{(e)})^{\\top} \\boldsymbol{C}_e (\\boldsymbol{B}_e \\boldsymbol{d}^{(e)}) = \\sum_{e=1}^{4} A_e (\\boldsymbol{\\varepsilon}^{(e)})^{\\top} \\boldsymbol{C}_e \\boldsymbol{\\varepsilon}^{(e)} $$\nHere, $\\boldsymbol{\\varepsilon}^{(e)} = \\boldsymbol{B}_e \\boldsymbol{d}^{(e)}$ is the constant strain within element $e$.\n\nFirst, we construct the global displacement vector $\\boldsymbol{d}$ from the problem specification.\n- Constrained nodes: $u_{x1}=0, u_{y1}=0, u_{x2}=0, u_{y2}=0, u_{x5}=0$.\n- Free nodes evaluated at field $u_x=0, u_y=y$:\n  - $N_3(0,0.5) \\implies u_{x3}=0, u_{y3}=0.5$\n  - $N_4(1,0.5) \\implies u_{x4}=0, u_{y4}=0.5$\n  - $N_5(0,1) \\implies u_{y5}=1$ (since $u_{x5}$ is constrained)\n  - $N_6(1,1) \\implies u_{x6}=0, u_{y6}=1$\nThe full global displacement vector $\\boldsymbol{d} = [u_{x1}, u_{y1}, u_{x2}, u_{y2}, \\dots, u_{x6}, u_{y6}]^{\\top}$ is:\n$$ \\boldsymbol{d} = [0, 0, 0, 0, 0, 0.5, 0, 0.5, 0, 1, 0, 1]^{\\top} $$\n\nNext, we compute the strain $\\boldsymbol{\\varepsilon}^{(e)}$ for each element. The prescribed displacement field $u_x=0, u_y=y$ corresponds to a state of uniform uniaxial strain: $\\varepsilon_{yy} = \\partial u_y / \\partial y = 1$, while $\\varepsilon_{xx} = 0$ and $\\gamma_{xy} = 0$. Since this displacement field is linear and we are using linear finite elements, the discrete strain field will exactly reproduce this constant strain state within every element. Therefore, for all four elements, the strain vector is constant:\n$$ \\boldsymbol{\\varepsilon}^{(e)} = \\boldsymbol{\\varepsilon}_0 = [0, 1, 0]^{\\top} \\quad \\text{for all } e \\in \\{1,2,3,4\\}. $$\n\nThe total energy quantity $s$ is the sum of the strain energies in each element.\n$$ s = \\sum_{e=1}^{4} A_e \\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}_e\\boldsymbol{\\varepsilon}_0 $$\nThe elements $E_1$ and $E_2$ are in the bottom layer with material properties $\\boldsymbol{C}_1$ and have a combined area of $A_{bottom} = A_1+A_2 = 0.25+0.25 = 0.5$. The elements $E_3$ and $E_4$ are in the top layer with properties $\\boldsymbol{C}_2$ and have a combined area of $A_{top} = A_3+A_4 = 0.25+0.25 = 0.5$.\nSo, the total energy is:\n$$ s = A_{bottom} \\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}_1\\boldsymbol{\\varepsilon}_0 + A_{top} \\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}_2\\boldsymbol{\\varepsilon}_0 $$\nWe compute the quadratic form $\\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}\\boldsymbol{\\varepsilon}_0$:\n$$ \\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}\\boldsymbol{\\varepsilon}_0 = \\begin{pmatrix} 0 & 1 & 0 \\end{pmatrix} \\begin{pmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\lambda & \\lambda + 2\\mu & 0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\lambda + 2\\mu $$\nApplying this for each layer:\n$$ s = \\frac{1}{2}(\\lambda_1 + 2\\mu_1) + \\frac{1}{2}(\\lambda_2 + 2\\mu_2) $$\nThis expression represents the final answer.",
            "answer": "$$\n\\boxed{\\frac{1}{2}(\\lambda_1 + 2\\mu_1 + \\lambda_2 + 2\\mu_2)}\n$$"
        },
        {
            "introduction": "Our final practice tackles a multi-physics problem central to geodynamics: the viscous flow of an incompressible fluid, governed by the Stokes equations. This exercise introduces the concept of mixed finite element methods and the resulting saddle-point structure of the linear system. By assembling and analyzing this system, you will confront the critical issues of element stability and the specialized numerical solvers required for the symmetric indefinite matrices that arise from such coupled problems .",
            "id": "3616527",
            "problem": "Consider the incompressible Stokes equations for a viscous, incompressible fluid under a constant body force derived from density times gravity, posed on a bounded, simply connected domain in two spatial dimensions. The governing equations are the conservation of linear momentum and mass, respectively,\n$$\n-\\nabla \\cdot \\left( \\mu \\nabla \\mathbf{u} \\right) + \\nabla p = \\rho \\mathbf{g}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwhere $\\mathbf{u}$ is the velocity vector field, $p$ is the pressure, $\\mu$ is the dynamic viscosity, $\\rho$ is the mass density, and $\\mathbf{g}$ is the gravitational acceleration vector. Assume $\\mu$ and $\\rho$ are constants on each element. Adopt the standard Galerkin method with the trial and test spaces for velocity and pressure chosen as continuous, piecewise linear functions on triangles for both velocity components and pressure. Use homogeneous Dirichlet boundary conditions for velocity on a specified subset of boundary nodes as detailed below. For the sake of this problem, work with the bilinear and linear forms\n$$\na(\\mathbf{u}, \\mathbf{v}) = \\int_{\\Omega} \\mu \\, \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, d\\Omega,\\quad\nb(\\mathbf{v}, q) = -\\int_{\\Omega} q \\, \\nabla \\cdot \\mathbf{v} \\, d\\Omega,\\quad\n\\ell(\\mathbf{v}) = \\int_{\\Omega} \\rho \\mathbf{g} \\cdot \\mathbf{v} \\, d\\Omega,\n$$\nwhich produce the symmetric saddle-point linear system upon finite element discretization.\n\nMesh, finite element spaces, and boundary conditions:\n- Let the domain be the unit square with vertices at $(0,0)$, $(1,0)$, $(1,1)$, $(0,1)$, and include the interior node at $(0.5,0.5)$. Let there be $5$ nodes in total, indexed as $0:(0,0)$, $1:(1,0)$, $2:(1,1)$, $3:(0,1)$, $4:(0.5,0.5)$.\n- Triangulate the square into $4$ triangles with connectivity $T_0=(0,1,4)$, $T_1=(1,2,4)$, $T_2=(2,3,4)$, $T_3=(3,0,4)$, each ordered counterclockwise.\n- Use continuous, piecewise linear basis functions on triangles for each velocity component and for pressure. Denote the nodal scalar shape functions by $N_a$, $a \\in \\{0,1,2,3,4\\}$ on the global mesh, and by their restrictions to each triangle for element computations. For a single triangle with vertex coordinates $(x_i,y_i)$, $i \\in \\{1,2,3\\}$, the area is\n$$\nA_T = \\frac{1}{2} \\det \\begin{pmatrix} x_2-x_1 & x_3 - x_1 \\\\ y_2 - y_1 & y_3 - y_1 \\end{pmatrix},\n$$\nand the gradients of the local shape functions are constant on the triangle and given by\n$$\n\\nabla N_1 = \\frac{1}{2 A_T} \\begin{pmatrix} y_2 - y_3 \\\\ x_3 - x_2 \\end{pmatrix},\\quad\n\\nabla N_2 = \\frac{1}{2 A_T} \\begin{pmatrix} y_3 - y_1 \\\\ x_1 - x_3 \\end{pmatrix},\\quad\n\\nabla N_3 = \\frac{1}{2 A_T} \\begin{pmatrix} y_1 - y_2 \\\\ x_2 - x_1 \\end{pmatrix}.\n$$\n- Impose homogeneous Dirichlet boundary conditions (zero velocity) at the boundary nodes with indices $0$, $2$, and $3$. Leave the boundary node with index $1$ and the interior node with index $4$ as free (unknown) velocity degrees of freedom. Anchor the pressure by prescribing $p=0$ at node $0$ to remove the pressure nullspace, and keep pressure unknowns at nodes $1$, $2$, $3$, and $4$.\n\nElement and global assembly:\n- For each triangle $T$ with local node indices $a,b \\in \\{1,2,3\\}$ (mapped to global node indices), use the following definitions derived from the Galerkin formulation and the choice of basis functions:\n    - The scalar stiffness entry for the Laplacian-like term on $T$ is\n    $$\n    k_{ab}^{(T)} = \\mu \\int_T \\nabla N_a \\cdot \\nabla N_b \\, d\\Omega = \\mu \\, A_T \\, \\left( \\nabla N_a \\cdot \\nabla N_b \\right),\n    $$\n    and the $2 \\times 2$ contribution for vector velocity is block diagonal with $k_{ab}^{(T)}$ applied to each velocity component.\n    - The divergence-pressure coupling on $T$ has entries\n    $$\n    B_{j,(a,x)}^{(T)} = - \\int_T N_j \\, \\frac{\\partial N_a}{\\partial x} \\, d\\Omega = - \\left(\\frac{\\partial N_a}{\\partial x}\\right) \\int_T N_j \\, d\\Omega,\\quad\n    B_{j,(a,y)}^{(T)} = - \\int_T N_j \\, \\frac{\\partial N_a}{\\partial y} \\, d\\Omega = - \\left(\\frac{\\partial N_a}{\\partial y}\\right) \\int_T N_j \\, d\\Omega,\n    $$\n    where $j$ runs over the pressure nodes local to $T$ and $(a,x)$ denotes the local velocity degree of freedom associated with the $x$-component at node $a$, and similarly for $(a,y)$.\n    - The element body force load vector entries for velocity are\n    $$\n    f_{(a,x)}^{(T)} = \\int_T \\rho g_x \\, N_a \\, d\\Omega = \\rho g_x \\int_T N_a \\, d\\Omega,\\quad\n    f_{(a,y)}^{(T)} = \\int_T \\rho g_y \\, N_a \\, d\\Omega = \\rho g_y \\int_T N_a \\, d\\Omega.\n    $$\n    Because $N_a$ is linear and $\\rho \\mathbf{g}$ is constant, $\\int_T N_a \\, d\\Omega = A_T / 3$.\n- Assemble the global matrices $\\mathbf{A}$ (velocity-velocity), $\\mathbf{B}$ (pressure-velocity), and the global velocity load vector $\\mathbf{F}$ by summing the contributions from each triangle using standard finite element assembly. Then enforce the essential boundary conditions by restricting to the unknown velocity degrees of freedom at nodes $1$ and $4$, and anchor the pressure by removing the pressure degree of freedom at node $0$. Denote the resulting reduced blocks as $\\mathbf{A}_{uu}$, $\\mathbf{B}_{pu}$, and the reduced velocity right-hand side vector $\\mathbf{F}_u$.\n- Form the coupled reduced saddle-point system\n$$\n\\mathbf{K} = \\begin{pmatrix}\n\\mathbf{A}_{uu} & \\mathbf{B}_{pu}^T \\\\\n\\mathbf{B}_{pu} & \\mathbf{0}\n\\end{pmatrix},\\quad\n\\mathbf{r} = \\begin{pmatrix}\n\\mathbf{F}_u \\\\\n\\mathbf{0}\n\\end{pmatrix}.\n$$\n\nTasks:\n1. For each triangle, compute the element body force vector from $\\rho \\mathbf{g}$ as described, assemble it into the global velocity load vector, and reduce it according to the essential boundary conditions. Report the Euclidean norm of the reduced velocity load vector $\\|\\mathbf{F}_u\\|_2$. Express this norm in Newtons in the sense that the units of $\\rho$ are kilograms per cubic meter, the units of $\\mathbf{g}$ are meters per second squared, the units of lengths are meters, and the integrals are over areas in square meters. Report the norm rounded to six decimal places.\n2. Assemble the reduced coupled system matrix $\\mathbf{K}$ and determine its inertia, defined as the ordered triple $(n_+, n_0, n_-)$ of the number of strictly positive, numerically zero, and strictly negative eigenvalues of $\\mathbf{K}$, respectively. Use a symmetric eigenvalue routine and count an eigenvalue as numerically zero if its magnitude is less than or equal to $\\tau = 10^{-10} \\max(1,\\max_i |\\lambda_i|)$, where $\\lambda_i$ are the eigenvalues of $\\mathbf{K}$.\n3. Based on the form of $\\mathbf{K}$, discuss appropriate linear solver choices for such indefinite systems and the rationale for these choices.\n\nUse the following test suite of parameter sets $(\\mu, \\rho, g_x, g_y)$:\n- Test $1$: $\\mu = 50$ in pascal-second, $\\rho = 3300$ in kilograms per cubic meter, $g_x = 0$ in meters per second squared, $g_y = -9.81$ in meters per second squared.\n- Test $2$: $\\mu = 50$ in pascal-second, $\\rho = 0$ in kilograms per cubic meter, $g_x = 0$ in meters per second squared, $g_y = -9.81$ in meters per second squared.\n- Test $3$: $\\mu = 5$ in pascal-second, $\\rho = 2500$ in kilograms per cubic meter, $g_x = 3.0$ in meters per second squared, $g_y = -4.0$ in meters per second squared.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test in the order given, output the four values $[\\|\\mathbf{F}_u\\|_2, n_+, n_0, n_-]$ with the norm rounded to six decimal places, then concatenate these quadruples for all tests into a single flat list. For example, the overall format is\n$$\n[\\text{norm}_1, n_{+,1}, n_{0,1}, n_{-,1}, \\text{norm}_2, n_{+,2}, n_{0,2}, n_{-,2}, \\text{norm}_3, n_{+,3}, n_{0,3}, n_{-,3}].\n$$\nAll angles, if any, are to be given in radians; there are no angles in this problem. All norms must be in Newtons, as described, rounded to six decimal places. All eigenvalue counts must be integers.",
            "solution": "This problem requires the assembly and analysis of the saddle-point linear system arising from a P1-P1 finite element discretization of the Stokes equations on a given mesh. The system is of the form:\n$$\n\\mathbf{K} \\begin{pmatrix} \\mathbf{u} \\\\ \\mathbf{p} \\end{pmatrix} = \\begin{pmatrix}\n\\mathbf{A}_{uu} & \\mathbf{B}_{pu}^T \\\\\n\\mathbf{B}_{pu} & \\mathbf{0}\n\\end{pmatrix} \\begin{pmatrix} \\mathbf{u} \\\\ \\mathbf{p} \\end{pmatrix} = \\begin{pmatrix}\n\\mathbf{F}_u \\\\\n\\mathbf{0}\n\\end{pmatrix}\n$$\nHere, $\\mathbf{u}$ and $\\mathbf{p}$ are vectors of unknown nodal velocity and pressure degrees of freedom (DOFs), respectively. $\\mathbf{A}_{uu}$ is the velocity stiffness matrix, $\\mathbf{B}_{pu}$ is the divergence-pressure coupling matrix, and $\\mathbf{F}_u$ is the body force vector, all reduced to the set of free DOFs.\n\nThe solution proceeds as follows:\n1.  **Define Mesh and DOFs**: The node coordinates and element connectivity are defined as specified. The global velocity DOFs are indexed as $(u_{0x}, u_{0y}, u_{1x}, u_{1y}, \\dots, u_{4x}, u_{4y})$, for a total of $10$. The pressure DOFs are indexed $(p_0, \\dots, p_4)$, for a total of $5$. Based on the boundary conditions, the free velocity DOFs correspond to nodes $1$ and $4$, giving $4$ free velocity unknowns. The free pressure DOFs correspond to nodes $1$, $2$, $3$, and $4$, giving $4$ free pressure unknowns. The reduced system matrix $\\mathbf{K}$ is therefore an $8 \\times 8$ matrix.\n\n2.  **Element-wise Computations**: For each of the four triangles in the mesh, we compute its area $A_T$, the constant gradients of the local linear basis functions $\\nabla N_a$, and the corresponding element matrices and vectors using the provided formulas.\n\n3.  **Global Assembly and Reduction**: The element matrices and vectors are assembled into global matrices $\\mathbf{A}$ ($10 \\times 10$), $\\mathbf{B}$ ($5 \\times 10$), and a global force vector $\\mathbf{F}$ ($10 \\times 1$). Subsequently, these are reduced by extracting the rows and columns corresponding to the free DOFs, yielding $\\mathbf{A}_{uu}$ ($4 \\times 4$), $\\mathbf{B}_{pu}$ ($4 \\times 4$), and $\\mathbf{F}_u$ ($4 \\times 1$).\n\n4.  **Task 1: Compute Force Vector Norm**: The Euclidean norm $\\|\\mathbf{F}_u\\|_2$ is computed for each parameter set. Assuming unit out-of-plane thickness, all quantities in SI units result in a force in Newtons.\n\n5.  **Task 2: Compute Matrix Inertia**: The reduced system matrix $\\mathbf{K}$ ($8 \\times 8$) is formed. Since $\\mathbf{K}$ is symmetric, its eigenvalues are real. We compute them using a standard symmetric eigensolver. The inertia $(n_+, n_0, n_-)$ is found by counting the number of eigenvalues that are positive, zero, or negative, subject to the specified numerical tolerance. The instability of the P1-P1 element pair on this mesh manifests as a rank-deficient $\\mathbf{B}_{pu}$ matrix, which in turn leads to a non-trivial nullspace for $\\mathbf{K}$ and thus $n_0 > 0$. The inertia is expected to be $(4, 1, 3)$, reflecting $4$ positive eigenvalues from the positive-definite $\\mathbf{A}_{uu}$ block, $1$ zero eigenvalue from the nullspace of $\\mathbf{B}_{pu}^T$, and $3$ negative eigenvalues corresponding to the rank of $\\mathbf{B}_{pu}$. This inertia is a structural property of the discretization and does not change with the physical parameters.\n\n6.  **Task 3: Discussion of Linear Solvers**: The resulting matrix $\\mathbf{K}$ is symmetric but indefinite, which restricts the choice of efficient linear solvers. For small problems, a direct solver using a symmetric indefinite factorization (e.g., LDL$^T$ with pivoting) is effective. For large-scale problems, iterative Krylov subspace methods such as MINRES or GMRES are necessary. These methods require effective preconditioning to converge efficiently. Block-structured preconditioners that approximate the inverse of $\\mathbf{K}$ using approximations of its constituent blocks ($\\mathbf{A}_{uu}$, $\\mathbf{B}_{pu}$) and the Schur complement $S = -\\mathbf{B}_{pu} \\mathbf{A}_{uu}^{-1} \\mathbf{B}_{pu}^T$ are a common and powerful strategy.\n\nThe final numerical answer is generated by implementing steps 1-5 for each test case.",
            "answer": "[5400.187500,4,1,3,0.000000,4,1,3,2778.079218,4,1,3]"
        }
    ]
}