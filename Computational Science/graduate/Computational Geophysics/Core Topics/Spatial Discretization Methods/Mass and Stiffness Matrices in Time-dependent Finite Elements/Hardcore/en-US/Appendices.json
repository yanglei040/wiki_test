{
    "hands_on_practices": [
        {
            "introduction": "Mastering the finite element method begins with the fundamentals of deriving element matrices. This practice guides you through the construction of the stiffness matrix and two common forms of the mass matrix—consistent and lumped—for a simple 1D element . By performing a dispersion analysis, you will uncover the profound impact this choice has on the spectral properties of the discretized system and, consequently, on the maximum stable time step for explicit dynamics.",
            "id": "3609807",
            "problem": "Consider axial wave propagation in a homogeneous, isotropic, slender geophysical bar with uniform cross-sectional area $A$, Young's modulus $E$, material density $\\rho$, and total length $L$. The axial displacement field $u(x,t)$ satisfies the one-dimensional ($1\\mathrm{D}$) linear momentum balance (the axial wave equation) in the absence of body forces: $\\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} = 0$. Discretize the spatial domain into $N$ uniform linear finite elements of length $h = L/N$ using the Finite Element Method (FEM), with standard linear shape functions over each element. \n\n(a) Starting from the Galerkin weak form and the definitions of the element matrices, derive the element stiffness matrix $K_{e}$ and the element consistent mass matrix $M_{e}^{\\mathrm{cons}}$ for a single linear element of length $h$. Then, derive the element lumped mass matrix $M_{e}^{\\mathrm{lump}}$ by performing a diagonal mass lumping that preserves the total element mass.\n\n(b) Assume a uniform infinite mesh (or, equivalently, a periodic domain with $N \\gg 1$ and periodic boundary conditions) so that the assembled operators are shift-invariant at interior nodes. Assemble the element contributions to obtain the global semi-discrete equation $M \\ddot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$, and perform a discrete Fourier analysis by considering modal solutions of the form $u_{j}(t) = U \\exp(i j \\theta) \\, q(t)$, where $j$ is the node index, $\\theta \\in [0,\\pi]$ is the nondimensional wavenumber, and $q(t)$ is the modal amplitude. Derive the dispersion relations $\\omega^{2}(\\theta)$ for both the consistent and lumped mass formulations, where $\\omega^{2}(\\theta)$ are the generalized eigenvalues of $K \\phi = \\omega^{2} M \\phi$ parameterized by $\\theta$.\n\n(c) Consider explicit time integration of the semi-discrete system using the Central Difference Method (CDM), which is a second-order accurate explicit scheme for $M \\ddot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$. Using linear stability analysis of the scalar update equation for a single mode with frequency $\\omega$, derive the stability condition on the time step $\\Delta t$ in terms of the maximum modal frequency $\\omega_{\\max}$ of the semi-discrete operator. Then, using the dispersion relations found in part (b), determine $\\omega_{\\max}$ for both consistent and lumped mass matrices and compute the ratio of the maximum stable time steps,\n$$\n\\frac{\\Delta t_{\\max}^{\\mathrm{lump}}}{\\Delta t_{\\max}^{\\mathrm{cons}}}.\n$$\n\nExpress your final answer as a single exact value. No unit is required. No rounding is required. Define any acronyms at first use, such as Finite Element Method (FEM) and Central Difference Method (CDM).",
            "solution": "The user has provided a valid, well-posed problem statement from the field of computational mechanics. We proceed with a complete solution.\n\nThe governing equation for axial wave propagation in a one-dimensional ($1\\mathrm{D}$) bar is given as:\n$$\n\\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} = 0\n$$\nwhere $u(x,t)$ is the axial displacement, $\\rho$ is the material density, $A$ is the cross-sectional area, and $E$ is Young's modulus.\n\n(a) Derivation of element matrices\n\nWe begin by establishing the Galerkin weak form of the governing equation. Multiplying by a test function $w(x)$ and integrating over the spatial domain $[0, L]$ yields:\n$$\n\\int_{0}^{L} w \\left( \\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} \\right) dx = 0\n$$\nApplying integration by parts to the second term gives:\n$$\n\\int_{0}^{L} \\rho A w \\frac{\\partial^{2}u}{\\partial t^{2}} \\, dx + \\int_{0}^{L} E A \\frac{\\partial w}{\\partial x} \\frac{\\partial u}{\\partial x} \\, dx - \\left[ w E A \\frac{\\partial u}{\\partial x} \\right]_{0}^{L} = 0\n$$\nThe boundary term is handled by the boundary conditions. For the derivation of element matrices, we consider a single generic element $\\Omega_e = [x_1, x_2]$ of length $h = x_2 - x_1$.\n\nWithin this element, the displacement field $u(x,t)$ is approximated using the Finite Element Method (FEM). For a linear element, we use linear shape functions $N_1(x)$ and $N_2(x)$:\n$$\nu(x,t) \\approx u_h(x,t) = N_1(x) u_1(t) + N_2(x) u_2(t) = \\mathbf{N}(x) \\mathbf{u}_e(t)\n$$\nwhere $\\mathbf{u}_e(t) = [u_1(t), u_2(t)]^T$ are the nodal displacements. The test function $w(x)$ is chosen from the same space of functions, $w(x) = \\mathbf{N}(x) \\mathbf{c}_e$, where $\\mathbf{c}_e$ is a vector of arbitrary constants.\n\nIn a local coordinate system $\\xi = (x-x_1)/h \\in [0, 1]$, the linear shape functions and their derivatives with respect to $x$ are:\n$$\nN_1(\\xi) = 1-\\xi, \\quad N_2(\\xi) = \\xi\n$$\n$$\n\\frac{dN_1}{dx} = \\frac{dN_1}{d\\xi}\\frac{d\\xi}{dx} = (-1)\\frac{1}{h}, \\quad \\frac{dN_2}{dx} = \\frac{dN_2}{d\\xi}\\frac{d\\xi}{dx} = (1)\\frac{1}{h}\n$$\nSo the matrix of shape function derivatives is $\\mathbf{N}'(x) = \\frac{1}{h} \\begin{pmatrix} -1 & 1 \\end{pmatrix}$.\n\nSubstituting the FEM approximation into the weak form for a single element gives:\n$$\n\\mathbf{c}_e^T \\left( \\int_{\\Omega_e} \\rho A \\mathbf{N}^T \\mathbf{N} \\, dx \\right) \\ddot{\\mathbf{u}}_e(t) + \\mathbf{c}_e^T \\left( \\int_{\\Omega_e} E A (\\mathbf{N}')^T \\mathbf{N}' \\, dx \\right) \\mathbf{u}_e(t) = \\mathbf{0}\n$$\nSince this must hold for any $\\mathbf{c}_e$, we obtain the element-level equation of motion, $M_e \\ddot{\\mathbf{u}}_e + K_e \\mathbf{u}_e = \\mathbf{0}$, where $K_e$ is the element stiffness matrix and $M_e$ is the element mass matrix.\n\nThe element stiffness matrix $K_e$ is:\n$$\nK_e = \\int_{0}^{h} E A (\\mathbf{N}')^T \\mathbf{N}' \\, dx = E A \\int_{0}^{h} \\begin{pmatrix} (-1/h)^2 & (-1/h)(1/h) \\\\ (1/h)(-1/h) & (1/h)^2 \\end{pmatrix} dx = \\frac{EA}{h^2} \\int_{0}^{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} dx\n$$\n$$\nK_e = \\frac{EA}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n$$\n\nThe element consistent mass matrix $M_e^{\\mathrm{cons}}$ is:\n$$\nM_e^{\\mathrm{cons}} = \\int_{0}^{h} \\rho A \\mathbf{N}^T \\mathbf{N} \\, dx = \\rho A \\int_{0}^{1} \\begin{pmatrix} (1-\\xi)^2 & \\xi(1-\\xi) \\\\ \\xi(1-\\xi) & \\xi^2 \\end{pmatrix} h \\, d\\xi\n$$\nEvaluating the integrals:\n$\\int_{0}^{1} (1-\\xi)^2 d\\xi = 1/3$, $\\int_{0}^{1} \\xi^2 d\\xi = 1/3$, $\\int_{0}^{1} \\xi(1-\\xi) d\\xi = 1/6$.\n$$\nM_e^{\\mathrm{cons}} = \\rho A h \\begin{pmatrix} 1/3 & 1/6 \\\\ 1/6 & 1/3 \\end{pmatrix} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\n\nTo obtain the element lumped mass matrix $M_e^{\\mathrm{lump}}$, we perform row-sum lumping, which places the sum of each row's entries onto the diagonal, ensuring preservation of the total element mass ($\\rho A h$).\nSum of row $1$: $\\frac{\\rho A h}{6}(2+1) = \\frac{\\rho A h}{2}$.\nSum of row $2$: $\\frac{\\rho A h}{6}(1+2) = \\frac{\\rho A h}{2}$.\n$$\nM_e^{\\mathrm{lump}} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\n\n(b) Dispersion Relations\n\nFor an infinite or periodic mesh, we can write the equation of motion for a generic interior node $j$ by assembling contributions from the adjacent elements $(j-1, j)$ and $(j, j+1)$.\n\nStiffness contribution at node $j$:\nFrom element $(j - 1, j)$: $(\\frac{EA}{h}) (-u_{j-1} + u_j)$\nFrom element $(j, j + 1)$: $(\\frac{EA}{h}) (u_j - u_{j+1})$\nTotal for node $j$: $(K\\mathbf{u})_j = \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1})$.\n\nConsistent mass contribution at node $j$:\nFrom element $(j - 1, j)$: $\\frac{\\rho A h}{6}(u_{j-1} + 2u_j)$\nFrom element $(j, j + 1)$: $\\frac{\\rho A h}{6}(2u_j + u_{j+1})$\nTotal for node $j$: $(M^{\\mathrm{cons}}\\ddot{\\mathbf{u}})_j = \\frac{\\rho A h}{6}( \\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1})$.\n\nLumped mass contribution at node $j$:\nThe global lumped mass matrix is diagonal, with each diagonal entry being the sum of contributions from adjacent elements. $(M^{\\mathrm{lump}})_{jj} = \\frac{\\rho A h}{2} + \\frac{\\rho A h}{2} = \\rho A h$.\nTotal for node $j$: $(M^{\\mathrm{lump}}\\ddot{\\mathbf{u}})_j = \\rho A h \\ddot{u}_j$.\n\nWe consider modal solutions of the form $u_j(t) = U \\exp(i(j\\theta - \\omega t))$, which implies $\\ddot{u}_j(t) = -\\omega^2 u_j(t)$ and $u_{j \\pm 1} = u_j \\exp(\\pm i\\theta)$. We substitute these into the assembled nodal equations.\n\nFor the consistent mass formulation:\n$M^{\\mathrm{cons}}\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$ becomes at node $j$:\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(u_{j-1} + 4u_j + u_{j+1}) + \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\nDividing by $u_j$ and substituting the exponential relation:\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(\\exp(-i\\theta) + 4 + \\exp(i\\theta)) + \\frac{EA}{h}(-\\exp(-i\\theta) + 2 - \\exp(i\\theta)) = 0\n$$\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(4 + 2\\cos\\theta) + \\frac{EA}{h}(2 - 2\\cos\\theta) = 0\n$$\nDefining the wave speed $c = \\sqrt{E/\\rho}$:\n$$\n\\omega_{\\mathrm{cons}}^2(\\theta) = \\frac{EA}{\\rho A h^2} \\frac{2(1 - \\cos\\theta)}{(4 + 2\\cos\\theta)/6} = \\frac{c^2}{h^2} \\frac{6(1-\\cos\\theta)}{2+\\cos\\theta}\n$$\n\nFor the lumped mass formulation:\n$M^{\\mathrm{lump}}\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$ becomes at node $j$:\n$$\n-\\omega_{\\mathrm{lump}}^2 (\\rho A h u_j) + \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n$$\n-\\omega_{\\mathrm{lump}}^2 \\rho A h + \\frac{EA}{h}(-\\exp(-i\\theta) + 2 - \\exp(i\\theta)) = 0\n$$\n$$\n-\\omega_{\\mathrm{lump}}^2 \\rho A h + \\frac{EA}{h}(2 - 2\\cos\\theta) = 0\n$$\n$$\n\\omega_{\\mathrm{lump}}^2(\\theta) = \\frac{EA}{\\rho A h^2} 2(1-\\cos\\theta) = \\frac{2c^2}{h^2}(1-\\cos\\theta) = \\frac{4c^2}{h^2}\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n\n(c) Stability Analysis and Ratio of Time Steps\n\nThe Central Difference Method (CDM) is used for time integration. For a single mode with frequency $\\omega$, the governing equation is $\\ddot{q} + \\omega^2 q = 0$. The CDM discretization is:\n$$\n\\frac{q^{n+1} - 2q^n + q^{n-1}}{(\\Delta t)^2} + \\omega^2 q^n = 0\n$$\nSeeking a solution $q^n = \\lambda^n$ yields the characteristic equation for the amplification factor $\\lambda$:\n$$\n\\lambda^2 - (2 - (\\omega \\Delta t)^2)\\lambda + 1 = 0\n$$\nFor stability, all roots must satisfy $|\\lambda| \\le 1$. This leads to the well-known stability condition for CDM:\n$$\n|\\omega \\Delta t| \\le 2\n$$\nFor the full system to be stable, the time step $\\Delta t$ must be limited by the maximum frequency in the system, $\\omega_{\\max}$:\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}} \\quad \\implies \\quad \\Delta t_{\\max} = \\frac{2}{\\omega_{\\max}}\n$$\nWe find $\\omega_{\\max}$ by maximizing $\\omega(\\theta)$ over the non-dimensional wavenumber range $\\theta \\in [0, \\pi]$.\n\nFor consistent mass, the function $\\omega_{\\mathrm{cons}}^2(\\theta) = \\frac{c^2}{h^2} \\frac{6(1-\\cos\\theta)}{2+\\cos\\theta}$ is monotonically increasing for $\\theta \\in [0, \\pi]$. The maximum occurs at $\\theta = \\pi$, where $\\cos\\pi = -1$.\n$$\n(\\omega_{\\mathrm{cons, max}})^2 = \\omega_{\\mathrm{cons}}^2(\\pi) = \\frac{c^2}{h^2} \\frac{6(1 - (-1))}{2 + (-1)} = \\frac{12c^2}{h^2}\n$$\n$$\n\\omega_{\\mathrm{cons, max}} = \\frac{c}{h}\\sqrt{12} = \\frac{2\\sqrt{3}c}{h}\n$$\nThe maximum stable time step is $\\Delta t_{\\max}^{\\mathrm{cons}} = \\frac{2}{\\omega_{\\mathrm{cons, max}}} = \\frac{2}{2\\sqrt{3}c/h} = \\frac{h}{\\sqrt{3}c}$.\n\nFor lumped mass, the function $\\omega_{\\mathrm{lump}}^2(\\theta) = \\frac{4c^2}{h^2}\\sin^2(\\theta/2)$ is also monotonically increasing for $\\theta \\in [0, \\pi]$. The maximum occurs at $\\theta = \\pi$.\n$$\n(\\omega_{\\mathrm{lump, max}})^2 = \\omega_{\\mathrm{lump}}^2(\\pi) = \\frac{4c^2}{h^2}\\sin^2\\left(\\frac{\\pi}{2}\\right) = \\frac{4c^2}{h^2}\n$$\n$$\n\\omega_{\\mathrm{lump, max}} = \\frac{2c}{h}\n$$\nThe maximum stable time step is $\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{2}{\\omega_{\\mathrm{lump, max}}} = \\frac{2}{2c/h} = \\frac{h}{c}$.\n\nFinally, we compute the ratio of the maximum stable time steps:\n$$\n\\frac{\\Delta t_{\\max}^{\\mathrm{lump}}}{\\Delta t_{\\max}^{\\mathrm{cons}}} = \\frac{h/c}{h/(\\sqrt{3}c)} = \\sqrt{3}\n$$",
            "answer": "$$\\boxed{\\sqrt{3}}$$"
        },
        {
            "introduction": "In the pursuit of computational efficiency, numerical shortcuts like reduced integration are common, but they can introduce pathologies. This exercise explores a classic problem: the emergence of unresisted, zero-energy 'hourglass' modes that render a simulation unstable . You will first prove analytically why the reduced-integration mass matrix becomes rank-deficient, and then implement and test practical stabilization strategies to restore the matrix to full rank and ensure a physically meaningful solution.",
            "id": "3609811",
            "problem": "Consider the semi-discrete formulation arising from a time-dependent scalar wave equation used in Computational Geophysics, discretized by the Finite Element Method (FEM). The spatial domain is partitioned into tetrahedral elements, and linear Lagrange shape functions are used. The element mass matrix on a tetrahedron is defined by the element-wise bilinear form based on mass density. Starting from the weak form of momentum balance for a scalar field, the element mass matrix entries are integrals of the product of shape functions times density over the element volume.\n\nYour tasks:\n\n1) Starting strictly from first principles, and without invoking any pre-derived finite element mass formulas, show that for a linear tetrahedral element, if reduced integration is used with a single quadrature point located at the centroid, the resulting element mass matrix is rank-deficient for any non-degenerate element. Your derivation must:\n- Begin with the definition of the element mass bilinear form $m(u,v) = \\int_{T} \\rho \\, u \\, v \\, \\mathrm{d}V$, where $T$ is a tetrahedron and $\\rho$ is constant over $T$.\n- Use only the facts that the linear Lagrange shape functions $\\{N_i\\}_{i=1}^{4}$ on a tetrahedron satisfy $\\sum_{i=1}^{4} N_i = 1$, that each $N_i$ is affine, and that at the centroid of the tetrahedron the barycentric coordinates are each equal to $1/4$.\n- Conclude the algebraic structure of the reduced-integration mass matrix and its eigenstructure.\n\n2) Propose and mathematically justify two independent stabilization strategies that convert the rank-deficient reduced-integration mass matrix into a symmetric positive definite matrix while preserving the total element mass. Each strategy must be defined in terms of the reduced-integration matrix and elementary algebraic operators. For each strategy, provide a proof sketch that:\n- The modified matrix is symmetric positive definite for any nonzero element volume.\n- The vector of ones is an eigenvector associated with the same eigenvalue as in the reduced-integration matrix, hence total element mass is preserved.\n\n3) Implement an algorithm that, for a given tetrahedron specified by its vertex coordinates $\\mathbf{x}_1,\\mathbf{x}_2,\\mathbf{x}_3,\\mathbf{x}_4 \\in \\mathbb{R}^3$, computes:\n- The element volume $V = \\frac{1}{6} \\left| \\det\\left([\\mathbf{x}_2-\\mathbf{x}_1,\\mathbf{x}_3-\\mathbf{x}_1,\\mathbf{x}_4-\\mathbf{x}_1]\\right) \\right|$.\n- The reduced-integration mass matrix $M^{\\mathrm{red}}$ for linear tetrahedral shape functions with constant density $\\rho$.\n- The lumped mass matrix $M^{\\mathrm{lump}}$ obtained by row-sum lumping of $M^{\\mathrm{red}}$.\n- The blended stabilization $M_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}$ for a user-specified $\\gamma \\in (0,1]$.\n- The projection-based hourglass stabilization $M_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P$, where $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$, $\\mathbf{1} = [1,1,1,1]^{\\mathsf{T}}$, $I$ is the $4\\times 4$ identity, and $\\beta > 0$.\n- The smallest eigenvalue of each of $M^{\\mathrm{red}}$, $M_{\\gamma}$, and $M_{\\beta}$.\n- A boolean indicator of singularity of $M^{\\mathrm{red}}$ based on whether its smallest eigenvalue is less than or equal to a tolerance $\\tau$.\n\nAssume dimensionless units: set mass density $\\rho = 1$ and take all coordinates dimensionless. Angles do not appear.\n\nTest Suite:\nUse the following four tetrahedra and stabilization parameters. For each case, set $\\rho = 1$, blending parameter $\\gamma = 0.1$, and projection parameter $\\beta = 0.05$. The singularity tolerance is $\\tau = 10^{-14}$.\n\n- Case A (well-shaped, \"happy path\"): $\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(0,0,1)$.\n- Case B (sliver, moderately near-coplanar): $\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(10^{-6},10^{-6},10^{-6})$.\n- Case C (extreme sliver): $\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(10^{-12},10^{-12},10^{-12})$.\n- Case D (degenerate boundary, coplanar): $\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(0,0,0)$.\n\nRequired Outputs:\nFor each case, compute and report the list $[\\mathrm{isSingular}, \\lambda_{\\min}(M^{\\mathrm{red}}), \\lambda_{\\min}(M_{\\gamma}), \\lambda_{\\min}(M_{\\beta})]$, where $\\mathrm{isSingular}$ is $1$ if $\\lambda_{\\min}(M^{\\mathrm{red}}) \\le \\tau$ and $0$ otherwise. Your program should produce a single line of output containing the results for the four cases as a comma-separated list of these lists, enclosed in square brackets (e.g., $[[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot]]$).\n\nScientific and numerical requirements:\n- All reasoning must be consistent with the weak form of balance of linear momentum and standard FEM definitions.\n- Your algorithm should use symmetric eigensolvers for the $4 \\times 4$ matrices.\n- The design must cover both well-shaped and nearly degenerate tetrahedra, and explicitly include the exactly degenerate boundary case to demonstrate failure modes.\n\nAll answers are dimensionless and should be provided as floats and integers as specified. No other units or angle specifications are required. The final printed line must be exactly the list format described above, with no extra text.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and complete. It addresses a standard topic in computational methods for partial differential equations, specifically the properties and stabilization of mass matrices in the Finite Element Method (FEM). All givens are consistent and sufficient for a unique solution.\n\nThe solution is presented in three parts, corresponding to the tasks in the problem statement.\n\n### Part 1: Rank-Deficiency of the Reduced-Integration Mass Matrix\n\nThe element mass matrix for a scalar field $u$ on a tetrahedral element $T$ is derived from the weak form of the underlying physical principle (e.g., momentum balance). The entries of the mass matrix, $M_{ij}$, are given by the bilinear form involving the finite element basis functions, $\\{N_i\\}_{i=1}^4$. For a constant mass density $\\rho$ over the element, this is:\n$$\nM_{ij} = \\int_T \\rho N_i(\\mathbf{x}) N_j(\\mathbf{x}) \\, \\mathrm{d}V\n$$\nwhere $N_i$ and $N_j$ are the linear Lagrange shape functions corresponding to nodes $i$ and $j$ of the tetrahedron.\n\nThe problem requires using reduced integration with a single quadrature point at the element centroid, $\\mathbf{x}_c$. This approximates the integral over the element volume $V$ as:\n$$\n\\int_T f(\\mathbf{x}) \\, \\mathrm{d}V \\approx V \\cdot f(\\mathbf{x}_c)\n$$\nApplying this numerical quadrature rule to the mass matrix integral, we obtain the reduced-integration mass matrix, $M^{\\mathrm{red}}$:\n$$\nM^{\\mathrm{red}}_{ij} = \\rho V N_i(\\mathbf{x}_c) N_j(\\mathbf{x}_c)\n$$\nA fundamental property of linear Lagrange shape functions on a simplex (like a tetrahedron) is that they are identical to the barycentric coordinates. The centroid of a tetrahedron is the point where the barycentric coordinates are all equal. For a tetrahedron with $4$ vertices, the barycentric coordinates at the centroid are $(\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4})$. Therefore, the value of each shape function at the centroid is:\n$$\nN_i(\\mathbf{x}_c) = \\frac{1}{4} \\quad \\text{for } i=1, 2, 3, 4\n$$\nSubstituting this into the expression for $M^{\\mathrm{red}}_{ij}$:\n$$\nM^{\\mathrm{red}}_{ij} = \\rho V \\left(\\frac{1}{4}\\right) \\left(\\frac{1}{4}\\right) = \\frac{\\rho V}{16}\n$$\nThis result is a constant for all entries $(i,j)$ of the matrix. The matrix $M^{\\mathrm{red}}$ can thus be written in algebraic form. Let $\\mathbf{1}$ be the $4 \\times 1$ column vector of ones, i.e., $\\mathbf{1} = [1, 1, 1, 1]^{\\mathsf{T}}$. Then $M^{\\mathrm{red}}$ is:\n$$\nM^{\\mathrm{red}} = \\frac{\\rho V}{16}\n\\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n= \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}}\n$$\nThis is an outer product of the vector $\\mathbf{1}$ with itself, scaled by a constant. For any non-zero vector $\\mathbf{v}$, a matrix of the form $\\mathbf{v}\\mathbf{v}^{\\mathsf{T}}$ has a rank of $1$. The column space is spanned by the vector $\\mathbf{v}$ itself. Since $M^{\\mathrm{red}}$ is a $4 \\times 4$ matrix with rank $1$ (assuming a non-degenerate element where $V>0$), its nullity (the dimension of its null space) is $4-1=3$. A matrix with a non-trivial null space is, by definition, singular or rank-deficient.\n\nTo determine the eigenstructure, we find the eigenvalues and eigenvectors.\n1.  Consider the eigenvector $\\mathbf{1}$:\n    $$\n    M^{\\mathrm{red}} \\mathbf{1} = \\left( \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}} \\right) \\mathbf{1} = \\frac{\\rho V}{16} \\mathbf{1} (\\mathbf{1}^{\\mathsf{T}}\\mathbf{1}) = \\frac{\\rho V}{16} \\mathbf{1} (4) = \\frac{\\rho V}{4} \\mathbf{1}\n    $$\n    Thus, $\\mathbf{1}$ is an eigenvector with a corresponding non-zero eigenvalue $\\lambda_1 = \\frac{\\rho V}{4}$. This eigenvalue represents the total mass of the element, $\\rho V$, distributed among the nodes (since $\\sum_{i,j} M^{\\mathrm{red}}_{ij} = 16 \\times \\frac{\\rho V}{16} = \\rho V$).\n\n2.  Consider any vector $\\mathbf{v}$ that is orthogonal to $\\mathbf{1}$, i.e., $\\mathbf{1}^{\\mathsf{T}}\\mathbf{v} = \\sum_{i=1}^4 v_i = 0$.\n    $$\n    M^{\\mathrm{red}} \\mathbf{v} = \\left( \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}} \\right) \\mathbf{v} = \\frac{\\rho V}{16} \\mathbf{1} (\\mathbf{1}^{\\mathsf{T}}\\mathbf{v}) = \\frac{\\rho V}{16} \\mathbf{1} (0) = \\mathbf{0} = 0 \\cdot \\mathbf{v}\n    $$\n    Any such vector $\\mathbf{v}$ is an eigenvector with an eigenvalue of $0$. The space of vectors orthogonal to $\\mathbf{1}$ in $\\mathbb{R}^4$ is a $3$-dimensional subspace. This is the null space of $M^{\\mathrm{red}}$. These zero-eigenvalue modes are often called \"hourglass modes\" or \"spurious zero-energy modes\" and can cause catastrophic instabilities in numerical simulations.\n\nIn summary, for any non-degenerate tetrahedron ($V>0$), the reduced-integration mass matrix $M^{\\mathrm{red}}$ has one eigenvalue $\\lambda_1 = \\frac{\\rho V}{4}$ and three zero eigenvalues ($\\lambda_2 = \\lambda_3 = \\lambda_4 = 0$). The existence of zero eigenvalues confirms it is rank-deficient.\n\n### Part 2: Stabilization Strategies\n\nThe goal is to modify $M^{\\mathrm{red}}$ to create a symmetric positive definite (SPD) matrix, which has only positive eigenvalues, while preserving the total element mass. This is equivalent to ensuring the modified matrix, $M_{\\mathrm{stab}}$, satisfies $M_{\\mathrm{stab}}\\mathbf{1} = \\lambda_1 \\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1}$.\n\n#### Strategy 1: Blended Stabilization\n\nDefine the modified matrix $M_{\\gamma}$ as a blend of the reduced-integration matrix $M^{\\mathrm{red}}$ and the lumped mass matrix $M^{\\mathrm{lump}}$, for some parameter $\\gamma \\in (0,1]$:\n$$\nM_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}\n$$\nThe lumped matrix $M^{\\mathrm{lump}}$ is a diagonal matrix where each diagonal entry is the sum of the corresponding row of the original matrix. For $M^{\\mathrm{red}}$, the sum of each row is $\\sum_{j=1}^4 M^{\\mathrm{red}}_{ij} = \\sum_{j=1}^4 \\frac{\\rho V}{16} = 4 \\frac{\\rho V}{16} = \\frac{\\rho V}{4}$. Thus,\n$$\nM^{\\mathrm{lump}} = \\text{diag}\\left(\\frac{\\rho V}{4}, \\frac{\\rho V}{4}, \\frac{\\rho V}{4}, \\frac{\\rho V}{4}\\right) = \\frac{\\rho V}{4} I\n$$\nwhere $I$ is the $4 \\times 4$ identity matrix.\n\n**Proof Sketch:**\n1.  **Symmetry**: $M^{\\mathrm{red}}$ and $M^{\\mathrm{lump}}$ are symmetric, so their linear combination $M_{\\gamma}$ is also symmetric.\n2.  **Mass Preservation**: We test the action of $M_{\\gamma}$ on the vector $\\mathbf{1}$:\n    $$\n    M_{\\gamma}\\mathbf{1} = \\left( (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}} \\right)\\mathbf{1} = (1-\\gamma)M^{\\mathrm{red}}\\mathbf{1} + \\gamma M^{\\mathrm{lump}}\\mathbf{1} \\\\\n    = (1-\\gamma)\\left(\\frac{\\rho V}{4}\\mathbf{1}\\right) + \\gamma\\left(\\frac{\\rho V}{4}I\\right)\\mathbf{1} = (1-\\gamma)\\frac{\\rho V}{4}\\mathbf{1} + \\gamma\\frac{\\rho V}{4}\\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1}\n    $$\n    The eigenvector $\\mathbf{1}$ and its eigenvalue $\\frac{\\rho V}{4}$ are preserved.\n\n3.  **Positive Definiteness**: We check the eigenvalues of $M_{\\gamma}$. We already have one eigenvalue, $\\lambda_1 = \\frac{\\rho V}{4} > 0$ for $V>0$. For the other three, consider any vector $\\mathbf{v}$ orthogonal to $\\mathbf{1}$:\n    $$\n    M_{\\gamma}\\mathbf{v} = (1-\\gamma)M^{\\mathrm{red}}\\mathbf{v} + \\gamma M^{\\mathrm{lump}}\\mathbf{v} = (1-\\gamma)\\mathbf{0} + \\gamma \\left(\\frac{\\rho V}{4}I\\right)\\mathbf{v} = \\left(\\gamma\\frac{\\rho V}{4}\\right)\\mathbf{v}\n    $$\n    The other three eigenvalues are all $\\lambda_{2,3,4} = \\gamma\\frac{\\rho V}{4}$. Since $\\gamma \\in (0,1]$ and $V>0$, these eigenvalues are strictly positive. All eigenvalues of $M_{\\gamma}$ are positive, so it is SPD.\n\n#### Strategy 2: Projection-Based Hourglass Stabilization\n\nDefine the modified matrix $M_{\\beta}$ by adding a term that penalizes the hourglass modes, for some parameter $\\beta > 0$:\n$$\nM_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P\n$$\nwhere $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$ is the projection matrix onto the subspace orthogonal to $\\mathbf{1}$.\n\n**Proof Sketch:**\n1.  **Symmetry**: $M^{\\mathrm{red}}$ is symmetric. $P$ is also symmetric since $(I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}})^{\\mathsf{T}} = I^{\\mathsf{T}} - \\frac{1}{4}(\\mathbf{1}\\mathbf{1}^{\\mathsf{T}})^{\\mathsf{T}} = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}} = P$. Thus, $M_{\\beta}$ is symmetric.\n2.  **Mass Preservation**: We test the action of $M_{\\beta}$ on the vector $\\mathbf{1}$. We first note the action of the projector $P$ on $\\mathbf{1}$:\n    $$\n    P\\mathbf{1} = \\left(I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}\\right)\\mathbf{1} = \\mathbf{1} - \\frac{1}{4}\\mathbf{1}(\\mathbf{1}^{\\mathsf{T}}\\mathbf{1}) = \\mathbf{1} - \\frac{1}{4}\\mathbf{1}(4) = \\mathbf{0}\n    $$\n    Then,\n    $$\n    M_{\\beta}\\mathbf{1} = M^{\\mathrm{red}}\\mathbf{1} + \\beta \\rho V P\\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1} + \\beta \\rho V (\\mathbf{0}) = \\frac{\\rho V}{4}\\mathbf{1}\n    $$\n    The eigenvector $\\mathbf{1}$ and its eigenvalue $\\frac{\\rho V}{4}$ are preserved.\n\n3.  **Positive Definiteness**: We check the eigenvalues. $\\lambda_1 = \\frac{\\rho V}{4} > 0$. For the other three, consider any vector $\\mathbf{v}$ orthogonal to $\\mathbf{1}$. The projector $P$ acts as the identity on such vectors: $P\\mathbf{v} = \\mathbf{v}$.\n    $$\n    M_{\\beta}\\mathbf{v} = M^{\\mathrm{red}}\\mathbf{v} + \\beta \\rho V P\\mathbf{v} = \\mathbf{0} + \\beta \\rho V \\mathbf{v} = (\\beta \\rho V)\\mathbf{v}\n    $$\n    The other three eigenvalues are $\\lambda_{2,3,4} = \\beta \\rho V$. Since $\\beta>0$ and $V>0$, these eigenvalues are strictly positive. All eigenvalues of $M_{\\beta}$ are positive, so it is SPD.\n\n### Part 3: Algorithmic Implementation\n\nThe implementation involves the following steps for each test case:\n1.  Define the four vertex coordinate vectors $\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4$.\n2.  Calculate the element volume $V$. Form a $3 \\times 3$ matrix from the vectors spanning the tetrahedron edges from a common vertex, e.g., $A = [\\mathbf{x}_2-\\mathbf{x}_1, \\mathbf{x}_3-\\mathbf{x}_1, \\mathbf{x}_4-\\mathbf{x}_1]^{\\mathsf{T}}$, and compute $V = \\frac{1}{6} |\\det(A)|$.\n3.  Set the constants $\\rho=1, \\gamma=0.1, \\beta=0.05, \\tau = 10^{-14}$.\n4.  Construct the matrix $M^{\\mathrm{red}} = \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$.\n5.  Construct the matrix $M^{\\mathrm{lump}} = \\frac{\\rho V}{4} I$.\n6.  Construct the blended stabilized matrix $M_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}$.\n7.  Construct the projection matrix $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$.\n8.  Construct the projection-stabilized matrix $M_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P$.\n9.  For each of the three matrices $M^{\\mathrm{red}}, M_{\\gamma}, M_{\\beta}$, compute the eigenvalues using a symmetric eigensolver. The smallest eigenvalue, $\\lambda_{\\min}$, is the first element of the sorted list of eigenvalues.\n10. Determine the singularity indicator for $M^{\\mathrm{red}}$: $\\mathrm{isSingular} = 1$ if $\\lambda_{\\min}(M^{\\mathrm{red}}) \\le \\tau$, and $0$ otherwise.\n11. Collect the four results $[\\mathrm{isSingular}, \\lambda_{\\min}(M^{\\mathrm{red}}), \\lambda_{\\min}(M_{\\gamma}), \\lambda_{\\min}(M_{\\beta})]$ into a list for each test case.\n12. Format the final output as a comma-separated list of these lists.\nThis procedure will be implemented in Python using the `numpy` library.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and analyzes mass matrices for tetrahedral finite elements.\n    \"\"\"\n    \n    # Define test cases and parameters\n    test_cases = {\n        \"A\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([0, 0, 1]),\n        },\n        \"B\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([1e-6, 1e-6, 1e-6]),\n        },\n        \"C\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([1e-12, 1e-12, 1e-12]),\n        },\n        \"D\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([0, 0, 0]),\n        },\n    }\n\n    # Parameters\n    rho = 1.0\n    gamma = 0.1\n    beta = 0.05\n    tau = 1e-14\n\n    all_results = []\n    \n    for case_name, coords in test_cases.items():\n        x1, x2, x3, x4 = coords[\"x1\"], coords[\"x2\"], coords[\"x3\"], coords[\"x4\"]\n\n        # 1. Compute element volume V\n        # The volume is 1/6 of the scalar triple product of the edge vectors.\n        # This is equivalent to 1/6 of the absolute value of the determinant of\n        # the matrix formed by the edge vectors.\n        mat = np.array([\n            x2 - x1,\n            x3 - x1,\n            x4 - x1\n        ])\n        V = 1.0 / 6.0 * np.abs(np.linalg.det(mat))\n\n        # Basic algebraic entities\n        ones_vec = np.ones(4)\n        ones_mat = np.outer(ones_vec, ones_vec) # This is 1 * 1^T\n        identity = np.eye(4)\n\n        # 2. Compute reduced-integration mass matrix M^red\n        # M_red = (rho * V / 16) * 1 * 1^T\n        m_red = (rho * V / 16.0) * ones_mat\n        \n        # 3. Compute lumped mass matrix M^lump\n        # M_lump = (rho * V / 4) * I\n        m_lump = (rho * V / 4.0) * identity\n        \n        # 4. Compute blended stabilization M_gamma\n        # M_gamma = (1-gamma) * M_red + gamma * M_lump\n        m_gamma = (1.0 - gamma) * m_red + gamma * m_lump\n        \n        # 5. Compute projection-based hourglass stabilization M_beta\n        # P = I - (1/4) * 1 * 1^T\n        proj_P = identity - 0.25 * ones_mat\n        # M_beta = M_red + beta * rho * V * P\n        m_beta = m_red + beta * rho * V * proj_P\n\n        # 6. Compute smallest eigenvalue of each matrix\n        # np.linalg.eigvalsh is used for symmetric matrices and returns sorted eigenvalues\n        lambda_min_red = np.linalg.eigvalsh(m_red)[0]\n        lambda_min_gamma = np.linalg.eigvalsh(m_gamma)[0]\n        lambda_min_beta = np.linalg.eigvalsh(m_beta)[0]\n        \n        # 7. Determine singularity of M_red\n        is_singular = 1 if lambda_min_red = tau else 0\n        \n        # Append results for the current case\n        case_results = [\n            is_singular,\n            lambda_min_red,\n            lambda_min_gamma,\n            lambda_min_beta\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as specified\n    formatted_sublists = [\n        f\"[{res[0]},{res[1]},{res[2]},{res[3]}]\" for res in all_results\n    ]\n    final_output = f\"[{','.join(formatted_sublists)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond their role in forming the global system of equations, element matrices are powerful diagnostic tools. This practice demonstrates how to use the local stiffness and mass matrices to construct an energy-based Rayleigh quotient, which serves as an estimate for the locally resolved frequency . This leads to a dimensionless indicator that can assess solution quality on-the-fly, forming the basis for advanced adaptive mesh refinement (AMR) strategies that dynamically focus computational effort.",
            "id": "3609762",
            "problem": "You are given the one-dimensional elastic wave Partial Differential Equation (PDE) for longitudinal motion in a bar, expressed as the conservation of linear momentum under small-strain, linear elasticity assumptions: for displacement field $u(x,t)$, density $\\rho(x)$, and Young’s modulus $E(x)$,\n$$\n\\rho(x)\\,\\frac{\\partial^2 u}{\\partial t^2}(x,t) - \\frac{\\partial}{\\partial x}\\left(E(x)\\,\\frac{\\partial u}{\\partial x}(x,t)\\right) = 0,\\quad x\\in \\Omega\\subset \\mathbb{R},\\ t\\ge 0.\n$$\nConsider a standard Galerkin Finite Element (FE) discretization on a mesh of linear, two-node elements with constant cross-sectional area $A$ and piecewise constant material properties per element. For a single element $e$ of length $h_e$, with nodal displacement vector $u_e \\in \\mathbb{R}^2$, define the element stiffness matrix $K_e$ and the element mass matrix $M_e$ using the linear shape functions $N_1(\\xi) = 1-\\xi$ and $N_2(\\xi)=\\xi$ on the reference interval $\\xi\\in[0,1]$ mapped to the physical element. The local strain-displacement matrix is $B = \\begin{bmatrix} \\frac{dN_1}{dx}  \\frac{dN_2}{dx}\\end{bmatrix}$ and the shape function vector is $N = \\begin{bmatrix}N_1  N_2\\end{bmatrix}$. The element matrices are obtained from the weak form by\n$$\nK_e = \\int_{x_e}^{x_{e+1}} E_e A\\, B^\\top B\\, dx,\\qquad M_e = \\int_{x_e}^{x_{e+1}} \\rho_e A\\, N^\\top N\\, dx,\n$$\nwhere $E_e$ and $\\rho_e$ denote the constant values on element $e$.\n\nDefine an energy-based frequency indicator on each element via the element Rayleigh quotient\n$$\nR_e = \\frac{u_e^\\top K_e\\, u_e}{u_e^\\top M_e\\, u_e}.\n$$\nAssuming local wave speed $c_e = \\sqrt{E_e/\\rho_e}$, interpret $\\sqrt{R_e}$ as an approximation to a localized angular frequency and use it to form a dimensionless resolution indicator\n$$\nq_e = \\frac{\\sqrt{R_e}\\, h_e}{\\pi\\, c_e},\n$$\nwhich compares the element size $h_e$ to the local half-wavelength. Values $q_e \\ll 1$ indicate low-frequency content relative to the mesh, $q_e \\approx 1$ indicates marginal resolution (element size comparable to half-wavelength), and $q_e \\gg 1$ indicates under-resolution that would benefit from refinement.\n\nTasks:\n- Starting from the weak form and the definitions above, derive $K_e$ and $M_e$ for a two-node linear element and provide their explicit forms in terms of $E_e$, $\\rho_e$, $A$, and $h_e$.\n- Using these element matrices, compute $R_e$ and $q_e$ for each element of a given mesh and nodal displacement snapshot $u(x)$.\n- For elements where the denominator $u_e^\\top M_e u_e$ is numerically negligible (e.g., below a tolerance), define $R_e=0$ and hence $q_e=0$ to avoid division by zero.\n\nYour program must implement the above indicator and evaluate it for the following test suite. All quantities with physical dimensions use International System of Units (SI): length in meters, time in seconds, mass in kilograms, Young’s modulus in Pascals, density in kilograms per cubic meter, area in square meters. The indicator $q_e$ is dimensionless and must be reported as a floating-point number.\n\nTest suite:\n- Case $1$ (uniform mesh, low frequency):\n  - Nodes: $x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$.\n  - Material: $E=9.0\\times 10^{9}$, $\\rho=2500$, $A=1.0$.\n  - Displacement snapshot: $u(x)=\\sin(\\pi x)$ for $x$ in meters.\n- Case $2$ (uniform mesh, borderline frequency):\n  - Nodes: $x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$.\n  - Material: $E=9.0\\times 10^{9}$, $\\rho=2500$, $A=1.0$.\n  - Displacement snapshot: $u(x)=\\sin(4\\pi x)$.\n- Case $3$ (uniform mesh, high frequency):\n  - Nodes: $x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$.\n  - Material: $E=9.0\\times 10^{9}$, $\\rho=2500$, $A=1.0$.\n  - Displacement snapshot: $u(x)=\\sin(10\\pi x)$.\n- Case $4$ (nonuniform mesh, variable material):\n  - Nodes: $x=\\{0.0,\\ 0.1,\\ 0.3,\\ 0.6,\\ 1.0\\}$.\n  - Per-element properties on elements $e=1,2,3,4$: $E_e=\\{1.0\\times 10^{10},\\ 8.0\\times 10^{9},\\ 5.0\\times 10^{9},\\ 1.2\\times 10^{10}\\}$, $\\rho_e=\\{2600,\\ 2400,\\ 2200,\\ 2800\\}$, $A=1.0$.\n  - Displacement snapshot: $u(x)=\\sin(6\\pi x)$.\n- Case $5$ (zero field edge case):\n  - Nodes: $x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$.\n  - Material: $E=9.0\\times 10^{9}$, $\\rho=2500$, $A=1.0$.\n  - Displacement snapshot: $u(x)\\equiv 0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of five bracketed lists, one per case, each inner list containing the per-element values of $q_e$ in element order from left to right, rounded to six decimal places, all enclosed in a single pair of square brackets. For example, an output with two cases of two elements each would look like $[[0.123456,0.234567],[0.345678,0.456789]]$.",
            "solution": "The problem statement has been validated and found to be scientifically grounded, well-posed, and objective. It provides a complete and consistent setup for deriving and implementing a finite element-based resolution indicator for the 1D elastic wave equation. All necessary data, definitions, and boundary conditions for the specified test cases are provided. I will now proceed with the solution.\n\nThe solution requires two main steps: first, the analytical derivation of the element matrices and the resulting resolution indicator, and second, the numerical implementation and evaluation for the given test cases.\n\n### Derivation of Element Matrices and Resolution Indicator\n\nThe derivation begins from the provided integral forms for the element stiffness matrix $K_e$ and mass matrix $M_e$ for a two-node linear element of length $h_e$. The element spans from physical coordinate $x_1$ to $x_2=x_1+h_e$. We use a linear map from a reference coordinate $\\xi \\in [0,1]$ to the physical coordinate $x \\in [x_1, x_2]$, given by $x(\\xi) = x_1 + h_e\\xi$. The differential is $dx = h_e d\\xi$.\n\nThe linear shape functions on the reference element are $N_1(\\xi) = 1-\\xi$ and $N_2(\\xi) = \\xi$. Their derivatives with respect to the physical coordinate $x$ are found using the chain rule:\n$$\n\\frac{dN}{dx} = \\frac{dN}{d\\xi}\\frac{d\\xi}{dx} = \\frac{1}{h_e}\\frac{dN}{d\\xi}\n$$\nThis gives $\\frac{dN_1}{dx} = -1/h_e$ and $\\frac{dN_2}{dx} = 1/h_e$. The strain-displacement matrix $B_e$ is therefore constant within the element:\n$$\nB_e = \\begin{bmatrix} \\frac{dN_1}{dx}  \\frac{dN_2}{dx} \\end{bmatrix} = \\frac{1}{h_e} \\begin{bmatrix} -1  1 \\end{bmatrix}\n$$\n\n**1. Element Stiffness Matrix $K_e$**\n\nThe stiffness matrix is defined as $K_e = \\int_{x_1}^{x_2} E_e A\\, B_e^\\top B_e\\, dx$. Since $E_e$, $A$, and $B_e$ are constant over the element, the integral simplifies:\n$$\nB_e^\\top B_e = \\left(\\frac{1}{h_e}\\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}\\right) \\left(\\frac{1}{h_e}\\begin{bmatrix} -1  1 \\end{bmatrix}\\right) = \\frac{1}{h_e^2}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n$$\nK_e = E_e A\\, (B_e^\\top B_e) \\int_{x_1}^{x_2} dx = E_e A \\left(\\frac{1}{h_e^2}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\\right) h_e\n$$\nThus, the explicit form of the element stiffness matrix is:\n$$\nK_e = \\frac{E_e A}{h_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n\n**2. Element Mass Matrix $M_e$**\n\nThe consistent mass matrix is defined as $M_e = \\int_{x_1}^{x_2} \\rho_e A\\, N^\\top N\\, dx$. The matrix of shape functions $N = \\begin{bmatrix} N_1  N_2 \\end{bmatrix}$ is not constant. We perform the integration on the reference element:\n$$\nM_e = \\rho_e A \\int_0^1 N(\\xi)^\\top N(\\xi) \\, h_e d\\xi = \\rho_e A h_e \\int_0^1 \\begin{bmatrix} N_1^2  N_1 N_2 \\\\ N_1 N_2  N_2^2 \\end{bmatrix} d\\xi\n$$\nSubstituting $N_1=1-\\xi$ and $N_2=\\xi$, we evaluate the required integrals:\n$$\n\\int_0^1 N_1^2 d\\xi = \\int_0^1 (1-\\xi)^2 d\\xi = \\frac{1}{3}\n$$\n$$\n\\int_0^1 N_2^2 d\\xi = \\int_0^1 \\xi^2 d\\xi = \\frac{1}{3}\n$$\n$$\n\\int_0^1 N_1 N_2 d\\xi = \\int_0^1 \\xi(1-\\xi) d\\xi = \\frac{1}{6}\n$$\nSubstituting these results back into the matrix integral:\n$$\nM_e = \\rho_e A h_e \\begin{bmatrix} 1/3  1/6 \\\\ 1/6  1/3 \\end{bmatrix} = \\frac{\\rho_e A h_e}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix}\n$$\nThis is the explicit form of the element consistent mass matrix.\n\n**3. Resolution Indicator $q_e$**\n\nThe indicator $q_e$ is built from the element Rayleigh quotient $R_e = \\frac{u_e^\\top K_e u_e}{u_e^\\top M_e u_e}$, where $u_e=\\begin{bmatrix} u_1  u_2 \\end{bmatrix}^\\top$ is the element nodal displacement vector. Let's evaluate the quadratic forms in the numerator and denominator:\n$$\nu_e^\\top K_e u_e = \\frac{E_e A}{h_e} \\begin{bmatrix} u_1  u_2 \\end{bmatrix} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} \\begin{bmatrix} u_1 \\\\ u_2 \\end{bmatrix} = \\frac{E_e A}{h_e} (u_1 - u_2)^2\n$$\n$$\nu_e^\\top M_e u_e = \\frac{\\rho_e A h_e}{6} \\begin{bmatrix} u_1  u_2 \\end{bmatrix} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix} \\begin{bmatrix} u_1 \\\\ u_2 \\end{bmatrix} = \\frac{\\rho_e A h_e}{6} (2u_1^2 + 2u_1u_2 + 2u_2^2) = \\frac{\\rho_e A h_e}{3} (u_1^2 + u_1u_2 + u_2^2)\n$$\nThe Rayleigh quotient is then:\n$$\nR_e = \\frac{\\frac{E_e A}{h_e} (u_1 - u_2)^2}{\\frac{\\rho_e A h_e}{3} (u_1^2 + u_1u_2 + u_2^2)} = \\frac{3 E_e}{\\rho_e h_e^2} \\frac{(u_1 - u_2)^2}{u_1^2 + u_1u_2 + u_2^2}\n$$\nThe resolution indicator is defined as $q_e = \\frac{\\sqrt{R_e}\\, h_e}{\\pi\\, c_e}$, with local wave speed $c_e = \\sqrt{E_e/\\rho_e}$. Substituting the expression for $R_e$:\n$$\nq_e = \\frac{h_e}{\\pi \\sqrt{E_e/\\rho_e}} \\sqrt{\\frac{3 E_e}{\\rho_e h_e^2} \\frac{(u_1 - u_2)^2}{u_1^2 + u_1u_2 + u_2^2}}\n$$\nWe can simplify this expression by combining terms:\n$$\nq_e = \\frac{h_e}{\\pi} \\sqrt{\\frac{\\rho_e}{E_e}} \\frac{\\sqrt{3}\\sqrt{E_e/\\rho_e}}{h_e} \\frac{|u_1 - u_2|}{\\sqrt{u_1^2 + u_1u_2 + u_2^2}}\n$$\nRemarkably, the material properties ($E_e, \\rho_e$) and element size ($h_e$) cancel out perfectly:\n$$\nq_e = \\frac{\\sqrt{3}}{\\pi} \\frac{|u_1 - u_2|}{\\sqrt{u_1^2 + u_1u_2 + u_2^2}}\n$$\nThis simplified formula is exact and will be used for computations. It is numerically advantageous as it avoids operations with potentially very large or small physical constants.\n\nThe problem states that if the denominator $u_e^\\top M_e u_e$ is negligible, $q_e$ should be $0$. The denominator is proportional to $u_1^2 + u_1u_2 + u_2^2$, which is a positive definite quadratic form. It is zero if and only if $u_1=0$ and $u_2=0$. Therefore, we will set $q_e=0$ if $u_1^2 + u_1u_2 + u_2^2$ is below a small numerical tolerance, which covers the cases where both nodal displacements are zero (e.g., Cases 2 and 5) or numerically very close to zero.\n\n### Algorithm Implementation\nThe algorithm proceeds by iterating through each test case. For each case, it iterates through the elements defined by the nodal coordinates. In each element, it evaluates the given displacement function $u(x)$ at the two nodes to get $u_1$ and $u_2$. It then applies the simplified formula for $q_e$, checking for the near-zero denominator case. The calculated $q_e$ values for each case are collected and formatted into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless resolution indicator q_e for a series of test cases\n    related to the 1D elastic wave equation discretized with linear finite elements.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case 1 (uniform mesh, low frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(np.pi * x),\n        },\n        {\n            \"name\": \"Case 2 (uniform mesh, borderline frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(4 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 3 (uniform mesh, high frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(10 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 4 (nonuniform mesh, variable material)\",\n            \"nodes\": [0.0, 0.1, 0.3, 0.6, 1.0],\n            \"u_func\": lambda x: np.sin(6 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 5 (zero field edge case)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: 0.0,\n        },\n    ]\n\n    all_results = []\n    \n    # Pre-calculate constant factor sqrt(3)/pi\n    sqrt3_over_pi = np.sqrt(3) / np.pi\n    \n    # Define a tolerance for the denominator check\n    tolerance = 1e-15\n\n    for case in test_cases:\n        nodes = case[\"nodes\"]\n        u_func = case[\"u_func\"]\n        \n        q_values_for_case = []\n        for i in range(len(nodes) - 1):\n            x1, x2 = nodes[i], nodes[i+1]\n            u1, u2 = u_func(x1), u_func(x2)\n            \n            # The simplified formula for q_e is:\n            # q_e = (sqrt(3)/pi) * |u1 - u2| / sqrt(u1^2 + u1*u2 + u2^2)\n\n            denom_q_val = u1**2 + u1*u2 + u2**2\n\n            if abs(denom_q_val)  tolerance:\n                # Denominator is negligible, set q_e to 0 as per problem description.\n                # This occurs when u1 and u2 are both zero (or numerically close).\n                q_e = 0.0\n            else:\n                num_q_val = abs(u1 - u2)\n                q_e = sqrt3_over_pi * num_q_val / np.sqrt(denom_q_val)\n            \n            q_values_for_case.append(q_e)\n        \n        all_results.append(q_values_for_case)\n\n    # Format the final output string according to the specification\n    inner_lists_str = []\n    for case_results in all_results:\n        # Format each float to 6 decimal places\n        formatted_values = [f\"{val:.6f}\" for val in case_results]\n        inner_lists_str.append(f\"[{','.join(formatted_values)}]\")\n    \n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}