{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握CFL条件，最有效的方法之一就是亲手从头推导它。这个练习将指导你对一个基本但极其重要的模型——线性平流方程——进行冯·诺依曼稳定性分析。通过为Lax-Friedrichs格式推导CFL条件，你不仅能理解稳定性的数学根源，还能体会到数值耗散是如何影响稳定性的。",
            "id": "3518916",
            "problem": "在采用算子分裂的多物理场耦合模拟中，一个平流子步由线性平流方程 $u_{t} + a\\,u_{x} = 0$ 建模。该方程具有恒定波速 $a \\in \\mathbb{R}$，定义在具有空间步长 $\\Delta x$ 和时间步长 $\\Delta t$ 的均匀网格上。考虑一个采用前向欧拉时间步进和Lax-Friedrichs数值通量的全离散有限体积法。从守恒律形式出发，并调用数值通量的一致性和守恒性定义，构建与Lax-Friedrichs通量\n$$\nF_{j+\\frac{1}{2}} = \\frac{1}{2}\\big(f(u_{j}) + f(u_{j+1})\\big) - \\frac{\\alpha}{2}\\,\\big(u_{j+1} - u_{j}\\big),\n$$\n相关的全离散更新格式，其中 $f(u) = a\\,u$，并且通过量纲分析以及要求该格式在零平流极限下简化为凸平均，经典Lax-Friedrichs耗散系数被选为 $\\alpha = \\frac{\\Delta x}{\\Delta t}$。进行von Neumann傅里叶稳定性分析，以推导Courant-Friedrichs-Lewy (CFL) 条件。该条件定义为比率 $\\frac{|a|\\,\\Delta t}{\\Delta x}$ 的必要界限，以确保对所有傅里叶模式，放大因子的模不超过1。根据此条件，确定最大稳定时间步长 $\\Delta t_{\\max}$，表示为关于 $a$ 和 $\\Delta x$ 的解析表达式。将最终答案表示为关于 $a$ 和 $\\Delta x$ 的封闭形式表达式。",
            "solution": "问题陈述经评估有效，因为它在科学上基于偏微分方程数值分析的原理，是适定的（well-posed），具有足够的信息以获得唯一解，并以客观、正式的语言表述。因此，我们可以继续进行求解。\n\n问题要求推导特定数值格式的Courant-Friedrichs-Lewy (CFL) 条件以及由此产生的最大稳定时间步长。该过程涉及三个主要步骤：构建全离散数值格式，执行von Neumann稳定性分析以找到放大因子，以及从此因子的模推导稳定性条件。\n\n首先，我们构建全离散更新方程。控制偏微分方程是线性平流方程，它是一种守恒律的形式，$u_t + (au)_x = 0$。对于有限体积法，单元 $j$ 的半离散形式是通过在宽度为 $\\Delta x = x_{j+1/2} - x_{j-1/2}$ 的单元体积 $[x_{j-1/2}, x_{j+1/2}]$ 上对偏微分方程进行积分得到的。这得到：\n$$\n\\frac{d u_j}{dt} + \\frac{1}{\\Delta x} \\left( F_{j+1/2} - F_{j-1/2} \\right) = 0\n$$\n其中 $u_j$ 是单元 $j$ 中解的单元平均值，$F_{j \\pm 1/2}$ 是单元界面处的数值通量。\n\n应用前向欧拉方法进行时间积分，我们将时间导数离散化为 $\\frac{du_j}{dt} \\approx \\frac{u_j^{n+1} - u_j^n}{\\Delta t}$，其中上标 $n$ 表示时间层。全离散格式为：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = - \\frac{1}{\\Delta x} \\left( F_{j+1/2}^n - F_{j-1/2}^n \\right)\n$$\n为 $u_j^{n+1}$ 重新整理，得到更新公式：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2}^n - F_{j-1/2}^n \\right)\n$$\n问题指定了Lax-Friedrichs数值通量：\n$$\nF_{j+\\frac{1}{2}} = \\frac{1}{2}\\big(f(u_{j}) + f(u_{j+1})\\big) - \\frac{\\alpha}{2}\\,\\big(u_{j+1} - u_{j}\\big)\n$$\n其中物理通量为 $f(u) = a u$，耗散系数为 $\\alpha = \\frac{\\Delta x}{\\Delta t}$。将这些代入通量定义，我们得到在时间层 $n$ 时界面 $j+1/2$ 处的通量：\n$$\nF_{j+1/2}^n = \\frac{1}{2}\\left(a u_j^n + a u_{j+1}^n\\right) - \\frac{1}{2}\\frac{\\Delta x}{\\Delta t}\\left(u_{j+1}^n - u_j^n\\right)\n$$\n类似地，界面 $j-1/2$ 处的通量为：\n$$\nF_{j-1/2}^n = \\frac{1}{2}\\left(a u_{j-1}^n + a u_j^n\\right) - \\frac{1}{2}\\frac{\\Delta x}{\\Delta t}\\left(u_j^n - u_{j-1}^n\\right)\n$$\n我们现在计算更新公式中所需的通量差：\n$$\nF_{j+1/2}^n - F_{j-1/2}^n = \\left[ \\frac{a}{2}(u_j^n + u_{j+1}^n) - \\frac{\\Delta x}{2\\Delta t}(u_{j+1}^n - u_j^n) \\right] - \\left[ \\frac{a}{2}(u_{j-1}^n + u_j^n) - \\frac{\\Delta x}{2\\Delta t}(u_j^n - u_{j-1}^n) \\right]\n$$\n$$\nF_{j+1/2}^n - F_{j-1/2}^n = \\frac{a}{2}(u_{j+1}^n - u_{j-1}^n) - \\frac{\\Delta x}{2\\Delta t}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\n将这个差值代回 $u_j^{n+1}$ 的更新公式：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left[ \\frac{a}{2}(u_{j+1}^n - u_{j-1}^n) - \\frac{\\Delta x}{2\\Delta t}(u_{j+1}^n - 2u_j^n + u_{j-1}^n) \\right]\n$$\n$$\nu_j^{n+1} = u_j^n - \\frac{a \\Delta t}{2\\Delta x}(u_{j+1}^n - u_{j-1}^n) + \\frac{1}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\n令Courant数为 $\\nu = \\frac{a \\Delta t}{\\Delta x}$。方程变为：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{1}{2}u_{j+1}^n - u_j^n + \\frac{1}{2}u_{j-1}^n\n$$\n合并关于空间索引 $j-1$、$j$ 和 $j+1$ 的项：\n$$\nu_j^{n+1} = (u_j^n - u_j^n) + \\left(\\frac{1}{2} - \\frac{\\nu}{2}\\right) u_{j+1}^n + \\left(\\frac{1}{2} + \\frac{\\nu}{2}\\right) u_{j-1}^n\n$$\n$$\nu_j^{n+1} = \\frac{1-\\nu}{2} u_{j+1}^n + \\frac{1+\\nu}{2} u_{j-1}^n\n$$\n这就是全离散更新格式，它等同于经典的Lax方法。\n\n其次，我们进行von Neumann稳定性分析。我们寻求傅里叶模式解，其形式为 $u_j^n = \\hat{u}^n(k) \\exp(i k x_j)$，其中 $x_j = j \\Delta x$，$k$ 是波数，$i = \\sqrt{-1}$。将此代入离散格式：\n$$\n\\hat{u}^{n+1} \\exp(i k j \\Delta x) = \\frac{1-\\nu}{2} \\hat{u}^n \\exp(i k (j+1) \\Delta x) + \\frac{1+\\nu}{2} \\hat{u}^n \\exp(i k (j-1) \\Delta x)\n$$\n放大因子定义为 $G(k) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^n}$。除以 $\\hat{u}^n \\exp(i k j \\Delta x)$：\n$$\nG(k) = \\frac{1-\\nu}{2} \\exp(i k \\Delta x) + \\frac{1+\\nu}{2} \\exp(-i k \\Delta x)\n$$\n使用欧拉公式 $\\exp(\\pm i \\theta) = \\cos(\\theta) \\pm i\\sin(\\theta)$，其中 $\\theta = k \\Delta x$：\n$$\nG(k) = \\frac{1-\\nu}{2} \\left(\\cos(k\\Delta x) + i\\sin(k\\Delta x)\\right) + \\frac{1+\\nu}{2} \\left(\\cos(k\\Delta x) - i\\sin(k\\Delta x)\\right)\n$$\n我们对实部和虚部进行分组：\n$$\nG(k) = \\left(\\frac{1-\\nu}{2} + \\frac{1+\\nu}{2}\\right) \\cos(k\\Delta x) + i \\left(\\frac{1-\\nu}{2} - \\frac{1+\\nu}{2}\\right) \\sin(k\\Delta x)\n$$\n$$\nG(k) = \\frac{2}{2} \\cos(k\\Delta x) + i \\left(\\frac{-2\\nu}{2}\\right) \\sin(k\\Delta x)\n$$\n$$\nG(k) = \\cos(k\\Delta x) - i\\nu\\sin(k\\Delta x)\n$$\n为使格式稳定，对所有可能的波数 $k$，放大因子的模都不能超过 $1$，即 $|G(k)| \\le 1$。我们计算模的平方：\n$$\n|G(k)|^2 = (\\text{Re}[G(k)])^2 + (\\text{Im}[G(k)])^2 = \\cos^2(k\\Delta x) + (-\\nu\\sin(k\\Delta x))^2\n$$\n$$\n|G(k)|^2 = \\cos^2(k\\Delta x) + \\nu^2\\sin^2(k\\Delta x)\n$$\n稳定性条件是 $|G(k)|^2 \\le 1$：\n$$\n\\cos^2(k\\Delta x) + \\nu^2\\sin^2(k\\Delta x) \\le 1\n$$\n使用三角恒等式 $\\cos^2(\\theta) = 1 - \\sin^2(\\theta)$：\n$$\n1 - \\sin^2(k\\Delta x) + \\nu^2\\sin^2(k\\Delta x) \\le 1\n$$\n$$\n(\\nu^2 - 1)\\sin^2(k\\Delta x) \\le 0\n$$\n由于对于所有 $k\\Delta x$ 的实数值，$\\sin^2(k\\Delta x) \\ge 0$，因此该不等式成立的充分必要条件是系数 $(\\nu^2 - 1)$ 为非正数：\n$$\n\\nu^2 - 1 \\le 0 \\implies \\nu^2 \\le 1\n$$\n取平方根得到此格式的CFL条件：\n$$\n|\\nu| \\le 1\n$$\n\n第三，我们确定最大稳定时间步长 $\\Delta t_{\\max}$。我们将Courant数 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 的定义代入稳定性条件：\n$$\n\\left|\\frac{a \\Delta t}{\\Delta x}\\right| \\le 1\n$$\n由于 $\\Delta t$ 和 $\\Delta x$ 是正物理量，我们可以写成：\n$$\n\\frac{|a|\\Delta t}{\\Delta x} \\le 1\n$$\n必须满足此不等式，模拟才能保持稳定。当等式成立时，可以找到最大允许时间步长 $\\Delta t_{\\max}$。假设波速非零，$a \\neq 0$：\n$$\n\\frac{|a|\\Delta t_{\\max}}{\\Delta x} = 1\n$$\n求解 $\\Delta t_{\\max}$ 得到最终表达式：\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{|a|}\n$$\n这就是所要求的最大稳定时间步长的解析表达式。在 $a=0$ 的退化情况下，CFL条件 $|\\nu| \\le 1$ 变为 $0 \\le 1$，这总是成立的，意味着无条件稳定且没有有限的最大时间步长。当 $|a| \\to 0$ 时，推导出的 $\\Delta t_{\\max}$ 表达式变为奇异的，这正确地捕捉了这种情况。",
            "answer": "$$\n\\boxed{\\frac{\\Delta x}{|a|}}\n$$"
        },
        {
            "introduction": "满足CFL条件可以确保你的模拟不会因为时间步长过大而崩溃，但这是否意味着结果就准确无误呢？这个练习探讨了稳定性和精度之间微妙但至关重要的区别，特别是数值色散现象。通过分析时域有限差分（FDTD）方法，你将发现为什么即使时间步长远小于CFL极限，粗糙的空间网格仍然会导致严重的相位误差。",
            "id": "3296718",
            "problem": "考虑应用于均匀介质中的无损耗麦克斯韦方程组的一维时域有限差分 (FDTD) Yee 格式。该介质的介电常数为 $ \\varepsilon $，磁导率为 $ \\mu $，波速为 $ c = 1/\\sqrt{\\mu \\varepsilon} $。计算网格的空间步长为 $ \\Delta x $，时间步长为 $ \\Delta t $，Courant 数为 $ S = c \\Delta t / \\Delta x $。假设采用标准 Yee 交错网格：电场 $ E $ 在整数空间索引和半整数时间索引处采样，而磁场 $ H $ 在半整数空间索引和整数时间索引处采样。一个波数为 $ k $、角频率为 $ \\omega $ 的单色平面波被引入。\n\n从 Yee 网格上的离散麦克斯韦更新方程和一个平面波拟设出发，分析数值色散和 Courant-Friedrichs-Lewy (CFL) 条件。根据您的分析，选择所有关于当 $ \\Delta t $ 减小但 $ \\Delta x $ 保持粗糙时，CFL 界限、稳定性和色散之间关系的正确陈述。\n\nA. 如果时间步长以严格不等式 $ S  1 $ 满足 Courant-Friedrichs-Lewy (CFL) 条件，那么对于所有可分辨的波数 $ k $，数值相速度都等于物理波速 $ c $。\n\nB. 对于固定的空间步长 $ \\Delta x $，当 $ \\Delta t \\to 0 $ (因此 $ S \\to 0 $) 时，数值相速度 $ v_p^{\\mathrm{num}} = \\omega/k $ 趋向于 $ \\left( \\dfrac{2c}{k \\Delta x} \\right) \\sin \\left( \\dfrac{k \\Delta x}{2} \\right) $，这个值与 $ c $ 不同，除非 $ k \\Delta x \\ll 1 $。\n\nC. 将 $ \\Delta t $ 设置得远小于 Courant-Friedrichs-Lewy (CFL) 条件所要求的值可以消除数值不稳定性，但无法消除由分辨率不足的波长（即大的 $ k \\Delta x $）引起的色散。\n\nD. 如果网格粗糙到 $ \\lambda / \\Delta x \\approx 6 $（即 $ k \\Delta x = 2\\pi/6 $），那么即使 $ S \\ll 1 $，也应该预料到在传播多个波长后会产生显著的相位误差累积。\n\nE. 对于一维 Yee 格式，通过选择 $ S  1 $ 来违反 Courant-Friedrichs-Lewy (CFL) 条件，可以在保持稳定性的同时减少数值色散。\n\n选择所有适用项。",
            "solution": "在尝试求解之前，必须首先对问题陈述的科学合理性、自洽性和清晰度进行验证。\n\n### 步骤 1：提取已知条件\n- **系统：** 一维时域有限差分 (FDTD) Yee 格式。\n- **介质：** 无损耗、均匀，介电常数为 $ \\varepsilon $，磁导率为 $ \\mu $。\n- **波速：** $ c = 1/\\sqrt{\\mu \\varepsilon} $。\n- **离散化：** 空间步长 $ \\Delta x $，时间步长 $ \\Delta t $。\n- **Courant 数：** $ S = c \\Delta t / \\Delta x $。\n- **Yee 交错网格：** 电场 $ E $ 在整数空间索引和半整数时间索引处采样。磁场 $ H $ 在半整数空间索引和整数时间索引处采样。\n- **激励：** 波数为 $ k $、角频率为 $ \\omega $ 的单色平面波。\n- **任务：** 分析 CFL 条件、稳定性和数值色散之间的关系，特别是当 $ \\Delta t $ 减小而 $ \\Delta x $ 保持粗糙时。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题描述了计算电磁学中的一个标准、典型的案例：一维 FDTD Yee 格式的分析。\n- **科学依据：** 该问题基于麦克斯韦方程组及其标准的有限差分近似（Yee 格式）。数值色散、稳定性、Courant 数和 CFL 条件等概念都是基础性的，并且在该背景下陈述正确。\n- **适定性：** 问题提供了推导数值色散关系所需的所有信息，从而可以严格分析其稳定性和准确性。问题清晰，并能导出一组唯一的正确结论。\n- **客观性：** 语言技术性强、精确，没有任何主观或模糊的术语。\n\n所有验证标准均已满足。该问题是偏微分方程数值分析中的一个标准教科书练习题。\n\n### 步骤 3：结论和行动\n问题陈述是**有效的**。现在将进行完整的推导和分析。\n\n### 基于原理的推导\n\n无损耗介质中横电磁 (TEM) 波的一维麦克斯韦方程组为：\n$$\n\\frac{\\partial E_z}{\\partial x} = -\\mu \\frac{\\partial H_y}{\\partial t}\n$$\n$$\n\\frac{\\partial H_y}{\\partial x} = -\\varepsilon \\frac{\\partial E_z}{\\partial t}\n$$\n我们简化符号为 $ E \\equiv E_z $ 和 $ H \\equiv H_y $。应用指定的 Yee 交错网格，场被离散化为 $ E(i\\Delta x, (n+1/2)\\Delta t) \\equiv E_i^{n+1/2} $ 和 $ H((i+1/2)\\Delta x, n\\Delta t) \\equiv H_{i+1/2}^n $。蛙跳式有限差分更新方程为：\n$$\n\\frac{E_i^{n+1/2} - E_i^{n-1/2}}{\\Delta t} = -\\frac{1}{\\varepsilon} \\frac{H_{i+1/2}^n - H_{i-1/2}^n}{\\Delta x}\n$$\n$$\n\\frac{H_{i+1/2}^{n+1} - H_{i+1/2}^n}{\\Delta t} = -\\frac{1}{\\mu} \\frac{E_{i+1}^{n+1/2} - E_i^{n+1/2}}{\\Delta x}\n$$\n我们假设一个数值平面波解（拟设）的形式为：\n$$\nE_i^{n+1/2} = E_0 e^{j(\\omega(n+1/2)\\Delta t - ki\\Delta x)}\n$$\n$$\nH_{i+1/2}^n = H_0 e^{j(\\omega n\\Delta t - k(i+1/2)\\Delta x)}\n$$\n其中 $ j = \\sqrt{-1} $，$ k $ 是数值波数，$ \\omega $ 是数值角频率。将此拟设代入更新方程：\n\n对于 $ E $ 场更新：\n$$\nE_0 \\frac{e^{j\\omega(n+1/2)\\Delta t} - e^{j\\omega(n-1/2)\\Delta t}}{\\Delta t} e^{-jki\\Delta x} = -\\frac{1}{\\varepsilon} \\frac{e^{j\\omega n\\Delta t}(e^{-jk(i+1/2)\\Delta x} - e^{-jk(i-1/2)\\Delta x})}{\\Delta x} H_0\n$$\n提取公因式 $ e^{j(\\omega n\\Delta t - ki\\Delta x)} $ 后：\n$$\nE_0 \\frac{e^{j\\omega\\Delta t/2} - e^{-j\\omega\\Delta t/2}}{\\Delta t} = -\\frac{H_0}{\\varepsilon\\Delta x} (e^{-jk\\Delta x/2} - e^{jk\\Delta x/2})\n$$\n使用欧拉公式 $ \\sin(x) = (e^{jx} - e^{-jx})/(2j) $：\n$$\nE_0 \\frac{2j\\sin(\\omega\\Delta t/2)}{\\Delta t} = -\\frac{H_0}{\\varepsilon\\Delta x}(-2j\\sin(k\\Delta x/2))\n$$\n$$\n(1) \\quad E_0 \\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t} = \\frac{H_0}{\\varepsilon\\Delta x}\\sin(k\\Delta x/2)\n$$\n对 $ H $ 场更新方程进行类似的代入可得：\n$$\n(2) \\quad H_0 \\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t} = \\frac{E_0}{\\mu\\Delta x}\\sin(k\\Delta x/2)\n$$\n将方程 (1) 和 (2) 相乘得到：\n$$\n(E_0 H_0) \\left(\\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t}\\right)^2 = \\frac{E_0 H_0}{\\mu\\varepsilon(\\Delta x)^2} \\sin^2(k\\Delta x/2)\n$$\n假设 $ E_0, H_0 \\neq 0 $ 并代入 $ c^2 = 1/(\\mu\\varepsilon) $：\n$$\n\\left(\\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t}\\right)^2 = \\frac{c^2}{(\\Delta x)^2} \\sin^2(k\\Delta x/2)\n$$\n对于前向传播的波，取正平方根：\n$$\n\\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t} = \\frac{c}{\\Delta x} \\sin(k\\Delta x/2)\n$$\n引入 Courant 数 $ S = c\\Delta t/\\Delta x $，我们得到一维 Yee 格式的数值色散关系：\n$$\n\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = S \\cdot \\sin\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n\n**稳定性分析 (CFL 条件)：**\n为了使解稳定（不增长），数值频率 $ \\omega $ 必须是纯实数。这要求用于求解 $ \\omega $ 的反正弦函数的参数为实数，且其绝对值不大于 1。\n$$\n\\left| S \\cdot \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\right| \\le 1\n$$\n由于 $ |\\sin(k\\Delta x/2)| $ 的最大值为 $ 1 $（对于网格上可分辨的最高空间频率，$ k\\Delta x = \\pi $），稳定性条件变为：\n$$\n|S| \\le 1 \\implies \\frac{c\\Delta t}{\\Delta x} \\le 1\n$$\n这就是 Courant-Friedrichs-Lewy (CFL) 条件。如果 $ S  1 $，$ \\omega $ 将变为具有负虚部的复数，导致场的指数增长，即数值不稳定性。\n\n**色散分析：**\n数值相速度为 $ v_p^{\\mathrm{num}} = \\omega/k $。物理相速度为 $ c $。当 $ v_p^{\\mathrm{num}} \\neq c $ 时，发生数值色散。\n从色散关系可知：\n$$\nv_p^{\\mathrm{num}} = \\frac{\\omega}{k} = \\frac{2}{k\\Delta t} \\arcsin\\left( S \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\right)\n$$\n该速度通常是 $ k $、$ \\Delta x $ 和 $ S $ 的函数，表明存在数值色散。一个重要的特例是一维情况下的“神奇时间步长”，即 $ S=1 $。在这种情况下，色散关系简化为 $ \\sin(\\omega\\Delta t/2) = \\sin(k\\Delta x/2) $。由于 $ S=1 \\implies \\Delta t = \\Delta x/c $，我们有 $ \\sin(\\omega \\Delta x / (2c)) = \\sin(k\\Delta x/2) $。对于参数小于 $ \\pi $ 的可分辨波，这意味着 $ \\omega\\Delta x/(2c) = k\\Delta x/2 $，简化后得到 $ \\omega = ck $。因此，当 $ S=1 $ 时，$ v_p^{\\mathrm{num}} = c $，该格式是无色散的。\n\n### 逐项分析\n\n**A. 如果时间步长以严格不等式 $ S  1 $ 满足 Courant-Friedrichs-Lewy (CFL) 条件，那么对于所有可分辨的波数 $ k $，数值相速度都等于物理波速 $ c $。**\n上述分析表明，无色散条件是 $ S=1 $。对于任何 $ S  1 $，数值色散关系为 $ \\sin(\\omega\\Delta t/2) = S \\sin(k\\Delta x/2) $。这不能简化为 $ \\omega=ck $。例如，在低频极限下（$ k\\Delta x \\to 0 $ 且 $ \\omega\\Delta t \\to 0 $），我们可以使用近似 $ \\sin(x) \\approx x $，得到 $ \\omega\\Delta t/2 \\approx S(k\\Delta x/2) \\implies \\omega/k \\approx S c  c $。如果 $ S  1 $，在整个波数谱上，相速度不等于 $ c $。\n**结论：错误**\n\n**B. 对于固定的空间步长 $ \\Delta x $，当 $ \\Delta t \\to 0 $ (因此 $ S \\to 0 $) 时，数值相速度 $ v_p^{\\mathrm{num}} = \\omega/k $ 趋向于 $ \\left( \\dfrac{2c}{k \\Delta x} \\right) \\sin \\left( \\dfrac{k \\Delta x}{2} \\right) $，这个值与 $ c $ 不同，除非 $ k \\Delta x \\ll 1 $。**\n从色散关系 $ \\sin(\\omega\\Delta t/2) = S \\sin(k\\Delta x/2) $ 出发。\n当 $ \\Delta t \\to 0 $ 时，$ S \\to 0 $。左侧的 $ \\sin(\\omega\\Delta t/2) $ 也必须趋于零，这意味着 $ \\omega\\Delta t \\to 0 $。因此我们可以近似为 $ \\sin(\\omega\\Delta t/2) \\approx \\omega\\Delta t/2 $。\n关系变为 $ \\omega\\Delta t/2 \\approx S \\sin(k\\Delta x/2) = (c\\Delta t/\\Delta x) \\sin(k\\Delta x/2) $。\n两边除以 $ \\Delta t/2 $ 得到 $ \\omega \\approx (2c/\\Delta x) \\sin(k\\Delta x/2) $。\n数值相速度则为 $ v_p^{\\mathrm{num}} = \\omega/k \\approx \\dfrac{1}{k} \\dfrac{2c}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right) = c \\dfrac{\\sin(k\\Delta x/2)}{k\\Delta x/2} $。\n选项中的表达式为 $ \\left( \\dfrac{2c}{k \\Delta x} \\right) \\sin \\left( \\dfrac{k \\Delta x}{2} \\right) $，与我们推导的结果相符。这个速度表达式仅代表空间离散化本身带来的色散，它仅在 $ k\\Delta x \\to 0 $ 的极限下等于 $ c $，此时 $ \\sin(u)/u \\to 1 $。对于任何有限的 $ k\\Delta x $，它都小于 $ c $。\n**结论：正确**\n\n**C. 将 $ \\Delta t $ 设置得远小于 Courant-Friedrichs-Lewy (CFL) 条件所要求的值可以消除数值不稳定性，但无法消除由分辨率不足的波长（即大的 $ k \\Delta x $）引起的色散。**\n将 $ \\Delta t $ 设置得远小于要求意味着 $ S = c\\Delta t/\\Delta x \\ll 1 $。这严格满足稳定性条件 $ S \\le 1 $，因此格式是稳定的。这就“消除了数值不稳定性”。\n陈述的第二部分涉及色散。如选项 B 的分析所示，在 $ \\Delta t \\to 0 $ ($ S \\to 0 $) 的极限下，数值相速度完全由空间离散化决定：$ v_p^{\\mathrm{num}} \\approx c \\cdot \\sin(k\\Delta x/2)/(k\\Delta x/2) $。如果网格是粗糙的，一个给定的物理波长将对应于一个大的 $ k\\Delta x $ 值。例如，如果每个波长只有 4 个单元，则 $ \\lambda = 4\\Delta x $，所以 $ k\\Delta x = (2\\pi/\\lambda)\\Delta x = 2\\pi/4 = \\pi/2 $。速度将为 $ v_p^{\\mathrm{num}} \\approx c \\cdot \\sin(\\pi/4)/(\\pi/4) \\approx 0.9 c $。这个误差纯粹是由空间网格分辨率（粗糙的 $\\Delta x$）造成的，并不能通过减小时间步长来消除。\n**结论：正确**\n\n**D. 如果网格粗糙到 $ \\lambda / \\Delta x \\approx 6 $（即 $ k \\Delta x = 2\\pi/6 $），那么即使 $ S \\ll 1 $，也应该预料到在传播多个波长后会产生显著的相位误差累积。**\n这是对 B 和 C 中原理的定量应用。如果 $ \\lambda/\\Delta x = 6 $，那么 $ k\\Delta x = 2\\pi/6 = \\pi/3 $。$ S \\ll 1 $ 的条件意味着我们处于空间色散占主导地位的区域。\n相对相速度为 $ v_p^{\\mathrm{num}}/c \\approx \\sin(k\\Delta x/2)/(k\\Delta x/2) = \\sin(\\pi/6)/(\\pi/6) = (1/2)/(\\pi/6) = 3/\\pi \\approx 0.955 $。\n这是一个大约 $ 4.5\\% $ 的速度误差。在距离 $ L $ 上累积的相位误差是 $ \\Delta\\Phi = (k_{\\mathrm{num}} - k)L = (\\omega/v_p^{\\mathrm{num}} - \\omega/c)L = k(c/v_p^{\\mathrm{num}} - 1)L $。\n在一个波长上传播后，$ L = \\lambda = 2\\pi/k $，相位误差为 $ \\Delta\\Phi_\\lambda = k(c/v_p^{\\mathrm{num}} - 1)\\lambda = 2\\pi(c/v_p^{\\mathrm{num}} - 1) \\approx 2\\pi(\\pi/3 - 1) \\approx 2\\pi(1.047 - 1) \\approx 0.297 $ 弧度。\n在 $ N $ 个波长上传播后，总相位误差为 $ N \\times \\Delta\\Phi_\\lambda $。例如 $ N=20 $，误差为 $ 20 \\times 0.297 \\approx 5.94 $ 弧度，这几乎是一个完整的周期 $ 2\\pi \\approx 6.28 $ 弧度。这是一个会破坏模拟中相位信息的显著误差。对于高精度模拟，每个波长使用约 6 个点确实被认为是粗糙的。\n**结论：正确**\n\n**E. 对于一维 Yee 格式，通过选择 $ S  1 $ 来违反 Courant-Friedrichs-Lewy (CFL) 条件，可以在保持稳定性的同时减少数值色散。**\n稳定性条件的推导表明，如果 $ S  1 $，总会存在一个波数带 $ k $，对于这个带内的波数 $ |S \\sin(k\\Delta x/2)|  1 $。对于这些波数，数值频率 $ \\omega $ 会获得一个负虚部，导致解随时间非物理地指数增长。对于 $ S  1 $，该格式是无条件不稳定的。关于可以保持稳定性的陈述是错误的。因此，在这种情况下，任何关于减少色散的讨论都没有意义。\n**结论：错误**",
            "answer": "$$\\boxed{BCD}$$"
        },
        {
            "introduction": "在真实的地球物理模拟中，我们处理的是复杂的、多维的、非均匀的网格，并且物理参数（如波速）在空间上是变化的。这个练习要求你将CFL理论转化为一个强大的算法，用于计算全局稳定的时间步长。你需要设计一个能够扫描所有网格单元，处理局部变化的特征速度和网格间距，并考虑零速度等边缘情况的动态时间步进策略。",
            "id": "3615177",
            "problem": "您的任务是推导、实现并测试一个算法，用于计算计算地球物理学中使用的线性双曲守恒律显式时间积分的全局稳定时间步长，该算法需符合被称为Courant–Friedrichs–Lewy (CFL) 条件的稳定性要求。计算必须基于扫描每个单元的局部最大特征速度和网格间距，并应用一个安全系数，同时随着场量随时间演化动态更新全局时间步长。\n\n起点和假设：考虑$D$维空间中的线性双曲系统，\n$$\n\\frac{\\partial \\mathbf{q}}{\\partial t} + \\sum_{d=1}^{D} \\mathbf{A}_d(\\mathbf{x}) \\frac{\\partial \\mathbf{q}}{\\partial x_d} = \\mathbf{0},\n$$\n其中$\\mathbf{q}(\\mathbf{x},t)$是守恒变量的向量，$\\mathbf{A}_d(\\mathbf{x})$是空间变化的通量雅可比矩阵。在一个直角网格中，对于每个单元$i$，设方向$d$上的网格间距为$h_{i,d}  0$，并在时间索引$t$时，方向$d$上的局部最大特征速度大小为$s_{t,i,d} \\ge 0$（即在时间$t$于单元$i$中计算的$\\mathbf{A}_d$的最大特征值绝对值）。假设一个显式的、单调的有限体积法，其数值通量与局部特征速度一致。您必须基于经过充分检验的事实：对于此类显式方法，稳定性要求方向Courant数的某个适当线性组合受一个量级为1的常数限制，并且时间步长$\\Delta t$必须遵守由最严格的单元所施加的全局限制。\n\n您的任务：\n- 从上述基本定义和原理出发，进行第一性原理的稳定性分析论证，以获得一个约束$\\Delta t$的必要稳定性条件，该条件用局部量$s_{t,i,d}$和$h_{i,d}$以及一个用户选择的安全系数$\\sigma$（其中$0  \\sigma  1$）表示。此论证不得依赖于预先给出的简化公式；必须从双曲系统的显式格式的性质以及其Courant数保持在稳定性限制内的要求来解释和推导。\n- 设计一个算法，在每个时间索引$t$，该算法扫描所有单元$i$和所有方向$d$，结合局部特征速度$s_{t,i,d}$和网格间距$h_{i,d}$来确定一个单一的全局$\\Delta t_t$，该$\\Delta t_t$满足推导出的稳定性条件并包含安全系数$\\sigma$，同时包含一个允许的最大时间步长上限$\\Delta t_{\\mathrm{cap}}$以确保数值计算的实用性。该算法必须处理边界情况，例如某些或所有方向上$s_{t,i,d} = 0$的单元，以及所有单元同时具有零特征速度的情况。\n- 将该算法实现为一个完整的、可运行的程序。对于下面提供的每个测试用例，该程序处理一系列时间步$t = 0,1,2,\\dots$，使用给定的$s_{t,i,d}$和$h_{i,d}$数组，计算全局时间步长的动态序列$\\Delta t_t$，并返回该测试用例最后一个时间索引处的值。\n- 单位：所有间距$h_{i,d}$的单位为米 (m)，所有特征速度$s_{t,i,d}$的单位为米/秒 (m/s)，$\\Delta t$必须以秒 (s) 为单位表示。您的程序必须以秒为单位打印最终结果。\n- 输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔的结果列表，每个浮点数格式化为恰好$6$位小数（例如，$\\left[0.012345,0.100000\\right]$）。\n\n测试套件规范（数组按时间主序，然后单元主序，最后维度主序排列；即，$s_{t,i,d}$作为一个三维数组提供，顺序为$t$、$i$、$d$）：\n\n- 测试用例1（一维，均匀网格，动态速度，理想情况）：\n  - 维度$D = 1$，单元数$N = 5$，时间步数$T = 3$。\n  - 对于所有单元$i \\in \\{0,1,2,3,4\\}$，间距$h_{i,1} = 10$米。\n  - 安全系数$\\sigma = 0.9$，上限$\\Delta t_{\\mathrm{cap}} = 1.0$秒。\n  - 速度 (m/s)：\n    - $t = 0$: $\\left[50,40,60,55,45\\right]$，\n    - $t = 1$: $\\left[70,30,65,40,50\\right]$，\n    - $t = 2$: $\\left[80,90,85,75,65\\right]$。\n  - 要求结果：程序必须返回最后计算出的$\\Delta t$（单位：秒）。\n\n- 测试用例2（二维，各向异性间距，动态速度）：\n  - 维度$D = 2$，单元数$N = 3$，时间步数$T = 2$。\n  - 间距 (m)：\n    - 单元 $0$: $\\left(h_{0,1},h_{0,2}\\right) = \\left(20,10\\right)$，\n    - 单元 $1$: $\\left(h_{1,1},h_{1,2}\\right) = \\left(25,15\\right)$，\n    - 单元 $2$: $\\left(h_{2,1},h_{2,2}\\right) = \\left(15,15\\right)$。\n  - 安全系数$\\sigma = 0.8$，上限$\\Delta t_{\\mathrm{cap}} = 0.5$秒。\n  - 速度 (m/s)：\n    - $t = 0$: 单元$0$到$2$分别为$\\left(30,20\\right)$, $\\left(40,10\\right)$, $\\left(35,35\\right)$，\n    - $t = 1$: 单元$0$到$2$分别为$\\left(25,25\\right)$, $\\left(45,5\\right)$, $\\left(30,40\\right)$。\n  - 要求结果：程序必须返回最后计算出的$\\Delta t$（单位：秒）。\n\n- 测试用例3（三维，包含零速度，上限约束的边界情况）：\n  - 维度$D = 3$，单元数$N = 2$，时间步数$T = 2$。\n  - 间距 (m)：所有单元均为$\\left(10,10,10\\right)$。\n  - 安全系数$\\sigma = 0.7$，上限$\\Delta t_{\\mathrm{cap}} = 0.05$秒。\n  - 速度 (m/s)：\n    - $t = 0$: 单元$0$和$1$分别为$\\left(0,0,0\\right)$和$\\left(5,5,5\\right)$，\n    - $t = 1$: 单元$0$和$1$分别为$\\left(1,0,0\\right)$和$\\left(0,0,0\\right)$。\n  - 要求结果：程序必须返回最后计算出的$\\Delta t$（单位：秒）。\n\n- 测试用例4（二维，最终时刻所有速度变为零，静止边界情况）：\n  - 维度$D = 2$，单元数$N = 4$，时间步数$T = 3$。\n  - 间距 (m)：\n    - 单元 $0$: $\\left(50,50\\right)$，\n    - 单元 $1$: $\\left(20,30\\right)$，\n    - 单元 $2$: $\\left(40,25\\right)$，\n    - 单元 $3$: $\\left(30,45\\right)$。\n  - 安全系数$\\sigma = 0.95$，上限$\\Delta t_{\\mathrm{cap}} = 1.0$秒。\n  - 速度 (m/s)：\n    - $t = 0$: 单元$0$到$3$分别为$\\left(10,5\\right)$, $\\left(15,10\\right)$, $\\left(8,12\\right)$, $\\left(10,9\\right)$，\n    - $t = 1$: 单元$0$到$3$分别为$\\left(20,10\\right)$, $\\left(30,20\\right)$, $\\left(16,24\\right)$, $\\left(15,18\\right)$，\n    - $t = 2$: 单元$0$到$3$分别为$\\left(0,0\\right)$, $\\left(0,0\\right)$, $\\left(0,0\\right)$, $\\left(0,0\\right)$。\n  - 要求结果：程序必须返回最后计算出的$\\Delta t$（单位：秒）。\n\n您的程序必须独立计算每个测试用例，从每个用例的最后一个时间索引收集最终的$\\Delta t$（单位：秒），并打印一行包含这四个结果的逗号分隔列表，列表用方括号括起来，每个数字格式化为恰好$6$位小数。",
            "solution": "该问题要求推导并实现一个算法，用于计算线性双曲系统数值积分的全局稳定时间步长$\\Delta t$。这将通过遵守Courant–Friedrichs–Lewy (CFL) 条件来完成。该过程包括两个主要阶段：首先，对直角网格上的多维系统的局部稳定性约束进行第一性原理推导；其次，设计一个鲁棒的算法来计算一个单一的全局时间步长，该步长满足计算域中所有单元的这一约束，包含一个安全系数，并遵守最大时间步长上限。\n\n### 第一性原理稳定性分析\n\n控制偏微分方程 (PDE) 是一个$D$维线性双曲系统：\n$$\n\\frac{\\partial \\mathbf{q}}{\\partial t} + \\sum_{d=1}^{D} \\mathbf{A}_d(\\mathbf{x}) \\frac{\\partial \\mathbf{q}}{\\partial x_d} = \\mathbf{0}\n$$\nCFL条件是双曲偏微分方程显式时间积分格式稳定性的一个必要条件。它源于这样一个原理：时空某一点解的数值依赖域必须包含该偏微分方程的物理依赖域。\n\n对于一个显式有限体积法或有限差分格式，在时间$t+\\Delta t$时单元$i$中的更新值是使用时间$t$时一个有限邻域内的单元信息计算得到的。我们首先考虑一维情况（$D=1$）。偏微分方程简化为$\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A}_1 \\frac{\\partial \\mathbf{q}}{\\partial x_1} = \\mathbf{0}$。信息以特征速度传播，这些速度是$\\mathbf{A}_1$的特征值。最大传播速度是$s_{t,i,1}$。在一个时间间隔$\\Delta t$内，一道波可以传播的最大物理距离为$s_{t,i,1} \\Delta t$。一个简单的显式数值格式通常使用相邻单元的信息。为保证稳定性，数值格式必须能够“捕捉”到移动最快的物理信息。这意味着一道波在一个时间步内传播的距离必须小于数值模板所覆盖的距离。对于一个在网格间距为$h_{i,1}$的网格上使用最近邻信息的格式，这要求$s_{t,i,1} \\Delta t \\le C_{max} h_{i,1}$，其中$C_{max}$是一个依赖于格式的常数，通常量级为1。这可以改写为Courant数$C_r = \\frac{s_{t,i,1} \\Delta t}{h_{i,1}}$的形式，条件为$C_r \\le C_{max}$。为简单起见且不失一般性，我们可以设$C_{max}=1$，因为任何其他值都可以被吸收到安全系数$\\sigma$中。这得出了单元$i$的局部时间步长约束：\n$$\n\\Delta t \\le \\frac{h_{i,1}}{s_{t,i,1}}\n$$\n这里假设$s_{t,i,1}  0$。如果$s_{t,i,1} = 0$，则该单元对$\\Delta t$没有约束。\n\n现在，我们将其推广到$D$个空间维度，在单元尺寸为$h_{i,1}, h_{i,2}, \\dots, h_{i,D}$的直角网格上。问题陈述中提到了“方向Courant数的某个适当线性组合”。对于结构化网格上的许多显式格式（例如，使用算子分裂或多维迎风格式），稳定性约束由所有方向上波传播的综合效应决定。速度为$s_{t,i,d}$的波穿过方向$d$上的单元所需的时间是$\\tau_{i,d} = h_{i,d} / s_{t,i,d}$。该方向上信息穿过单元的传递速率是其倒数，$1/\\tau_{i,d} = s_{t,i,d} / h_{i,d}$。离开该单元的总信息传递速率是每个维度中速率的总和。时间步长$\\Delta t$必须小于由该总速率定义的特征时间尺度。这引出了单元$i$的多维CFL条件：\n$$\n\\Delta t \\left( \\sum_{d=1}^{D} \\frac{s_{t,i,d}}{h_{i,d}} \\right) \\le C_{max}\n$$\n再次设$C_{max}=1$，我们得到基于时间$t$时单元$i$属性的时间步长$\\Delta t$的约束条件：\n$$\n\\Delta t_{t,i} \\le \\frac{1}{\\sum_{d=1}^{D} \\frac{s_{t,i,d}}{h_{i,d}}}\n$$\n该公式给出了单元$i$允许的最大局部时间步长。如果分母中的和为零（即所有$s_{t,i,d}=0$），则局部时间步长约束是无限的，意味着该单元不施加稳定性限制。\n\n### 全局时间步长计算的算法设计\n\n由于一个显式方法使用单一的、全局的时间步长$\\Delta t_t$来将整个计算域从时间$t$推进到$t+\\Delta t_t$，这个全局步长必须同时满足每个单元中的稳定性条件。因此，$\\Delta t_t$不得大于所有局部最大稳定时间步长的最小值。\n\n在给定时间索引$t$计算全局时间步长$\\Delta t_t$的算法如下：\n\n1.  **计算局部约束**：对于域中的每个单元$i$（从$i=0$到$N-1$）：\n    a. 计算特征速度与间距之比的和：\n    $$\n    C_i = \\sum_{d=1}^{D} \\frac{s_{t,i,d}}{h_{i,d}}\n    $$\n    b. 确定最大局部稳定时间步长$\\Delta t_{t,i}$。\n       - 如果$C_i > 0$，则$\\Delta t_{t,i} = 1/C_i$。\n       - 如果$C_i = 0$（当且仅当对于所有$d=1, \\dots, D$都有$s_{t,i,d} = 0$时发生，因为$h_{i,d}>0$），该单元是局部静止的。它对时间步长不施加上限。我们可以将其表示为$\\Delta t_{t,i} = \\infty$。\n\n2.  **寻找全局稳定性极限**：通过寻找所有局部时间步长的最小值来确定整个网格上最严格的约束：\n    $$\n    \\Delta t_{stable} = \\min_{i \\in \\{0, \\dots, N-1\\}} \\{ \\Delta t_{t,i} \\}\n    $$\n    - 如果所有单元的速度都为零（所有$s_{t,i,d}=0$），则所有$\\Delta t_{t,i} = \\infty$，因此$\\Delta t_{stable} = \\infty$。这对应于系统的完全静止状态。\n\n3.  **应用安全系数**：应用用户提供的安全系数$\\sigma$（其中$0  \\sigma  1$）来减小时间步长，为防止由离散误差或本线性分析未考虑的非线性效应引起的数值不稳定性提供安全余量。\n    $$\n    \\Delta t_{safe} = \\sigma \\cdot \\Delta t_{stable}\n    $$\n    请注意，如果$\\Delta t_{stable} = \\infty$，则$\\Delta t_{safe} = \\infty$。\n\n4.  **强制执行时间步长上限**：最终的时间步长$\\Delta t_t$是应用安全系数后的稳定步长和用户定义的最大时间步长上限$\\Delta t_{\\mathrm{cap}}$中较小的一个。这个上限可以防止时间步长变得过大，出于精度原因，或者如果系统预期会再次变为动态，这可能是不希望看到的。\n    $$\n    \\Delta t_t = \\min(\\Delta t_{safe}, \\Delta t_{\\mathrm{cap}})\n    $$\n    这一步对于处理完全静止系统的情况至关重要，在这种情况下$\\Delta t_{safe}$将是无限的。此时，算法正确地得出$\\Delta t_t = \\Delta t_{\\mathrm{cap}}$。\n\n最后的任务是实现这个算法，为每个测试用例计算时间步长序列，并报告在最后一个时间索引处的值。由于$\\Delta t_t$的计算仅依赖于同一时间索引$t$下的速度$s_{t,i,d}$，我们只需对每个测试用例中最后一个指定的时间索引进行计算，即可获得所需的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by processing each test case to find the final stable time step.\n    \"\"\"\n    \n    # Test case 1: 1D, uniform grid, dynamic speeds\n    test_case_1 = {\n        \"h\": np.full((5, 1), 10.0),\n        \"s\": np.array([\n            [[50.0], [40.0], [60.0], [55.0], [45.0]],\n            [[70.0], [30.0], [65.0], [40.0], [50.0]],\n            [[80.0], [90.0], [85.0], [75.0], [65.0]],\n        ]),\n        \"sigma\": 0.9,\n        \"dt_cap\": 1.0,\n    }\n\n    # Test case 2: 2D, anisotropic spacings, dynamic speeds\n    test_case_2 = {\n        \"h\": np.array([\n            [20.0, 10.0],\n            [25.0, 15.0],\n            [15.0, 15.0]\n        ]),\n        \"s\": np.array([\n            [[30.0, 20.0], [40.0, 10.0], [35.0, 35.0]],\n            [[25.0, 25.0], [45.0, 5.0],  [30.0, 40.0]],\n        ]),\n        \"sigma\": 0.8,\n        \"dt_cap\": 0.5,\n    }\n\n    # Test case 3: 3D, zero speeds, binding cap\n    test_case_3 = {\n        \"h\": np.full((2, 3), 10.0),\n        \"s\": np.array([\n            [[0.0, 0.0, 0.0], [5.0, 5.0, 5.0]],\n            [[1.0, 0.0, 0.0], [0.0, 0.0, 0.0]],\n        ]),\n        \"sigma\": 0.7,\n        \"dt_cap\": 0.05,\n    }\n\n    # Test case 4: 2D, all speeds become zero\n    test_case_4 = {\n        \"h\": np.array([\n            [50.0, 50.0],\n            [20.0, 30.0],\n            [40.0, 25.0],\n            [30.0, 45.0]\n        ]),\n        \"s\": np.array([\n            [[10.0, 5.0], [15.0, 10.0], [8.0, 12.0], [10.0, 9.0]],\n            [[20.0, 10.0], [30.0, 20.0], [16.0, 24.0], [15.0, 18.0]],\n            [[0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0]],\n        ]),\n        \"sigma\": 0.95,\n        \"dt_cap\": 1.0,\n    }\n\n    test_cases = [test_case_1, test_case_2, test_case_3, test_case_4]\n    results = []\n\n    def compute_final_dt(h, s, sigma, dt_cap):\n        \"\"\"\n        Computes the stable time step for the last time index provided.\n        \n        Args:\n            h (np.ndarray): Grid spacings, shape (N, D).\n            s (np.ndarray): Characteristic speeds, shape (T, N, D).\n            sigma (float): Safety factor.\n            dt_cap (float): Maximum allowable time step.\n            \n        Returns:\n            float: The computed final time step.\n        \"\"\"\n        # We only need the state at the last time index for the final result.\n        s_last = s[-1, :, :]  # Speeds at the last time step, shape (N, D)\n        \n        # Calculate the sum of speed/spacing ratios for each cell.\n        # This is the term inside the parenthesis in the CFL condition denominator.\n        # Ratios are calculated element-wise for each cell and dimension.\n        # A small epsilon is added to the denominator h to avoid division by zero\n        # in hypothetical cases, though the problem states h > 0.\n        ratios = s_last / (h + 1e-30) \n        \n        # Sum over the spatial dimensions (axis=1) to get the local inverse time scale for each cell.\n        # `inv_dt_local` has shape (N,).\n        inv_dt_local = np.sum(ratios, axis=1)\n\n        # Calculate local stable time steps.\n        # Where inv_dt_local is 0, the local stable time step is infinite.\n        # `np.divide` with the `where` argument handles this robustly.\n        dt_local = np.full_like(inv_dt_local, np.inf)\n        # Create a mask for non-zero entries to avoid division by zero.\n        nonzero_mask = inv_dt_local > 0\n        dt_local[nonzero_mask] = 1.0 / inv_dt_local[nonzero_mask]\n        \n        # The global stable time step is the minimum of all local time steps.\n        dt_stable = np.min(dt_local)\n        \n        # Apply the safety factor.\n        dt_safe = sigma * dt_stable\n        \n        # Enforce the maximum time step cap. np.min handles infinite values correctly.\n        final_dt = np.min([dt_safe, dt_cap])\n        \n        return final_dt\n\n    for case in test_cases:\n        result = compute_final_dt(case[\"h\"], case[\"s\"], case[\"sigma\"], case[\"dt_cap\"])\n        results.append(result)\n\n    # Format the results to exactly 6 decimal places and print.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}