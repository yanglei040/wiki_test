{
    "hands_on_practices": [
        {
            "introduction": "A numerical simulation is only useful if it is stable. For explicit time-stepping schemes, this means that the time step $\\Delta t$ must be chosen small enough relative to the grid spacing $h$ to prevent errors from growing unboundedly. This exercise walks you through the cornerstone of stability analysis—the von Neumann method—to derive the famous Courant-Friedrichs-Lewy (CFL) condition for a 2D staggered-grid acoustic scheme . Mastering this analysis is a fundamental skill for any computational scientist, providing deep insight into how numerical schemes propagate waves.",
            "id": "3615279",
            "problem": "Consider the constant-coefficient acoustic system in two spatial dimensions,\n$$\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\kappa\\, \\nabla \\cdot \\boldsymbol{v}, \n\\qquad\n\\rho\\,\\frac{\\partial \\boldsymbol{v}}{\\partial t} \\;=\\; -\\nabla p,\n$$\nwhere $p$ is pressure, $\\boldsymbol{v}=(v_{x},v_{y})$ is particle velocity, $\\rho$ is density, and $\\kappa$ is bulk modulus, with wave speed $c=\\sqrt{\\kappa/\\rho}$. Discretize space on a uniform square grid of spacing $h$ using a standard staggered-grid arrangement: $p$ at cell centers $(i h,j h)$, $v_{x}$ at $( (i+\\tfrac{1}{2}) h, j h)$, and $v_{y}$ at $( i h, (j+\\tfrac{1}{2}) h)$. Discretize time with a leapfrog staggering: $p$ at integer times $t^{n}=n\\,\\Delta t$ and velocities at half-integer times $t^{n+\\tfrac{1}{2}}=(n+\\tfrac{1}{2})\\,\\Delta t$. Use second-order centered finite differences for spatial gradients and divergence:\n$$\nD_{x} p\\big|_{i+\\tfrac{1}{2},j} \\;=\\; \\frac{p_{i+1,j}-p_{i,j}}{h}, \n\\qquad\nD_{y} p\\big|_{i,j+\\tfrac{1}{2}} \\;=\\; \\frac{p_{i,j+1}-p_{i,j}}{h},\n$$\n$$\nD_{x}^{*} v_{x}\\big|_{i,j} \\;=\\; \\frac{v_{x,i+\\tfrac{1}{2},j}-v_{x,i-\\tfrac{1}{2},j}}{h}, \n\\qquad\nD_{y}^{*} v_{y}\\big|_{i,j} \\;=\\; \\frac{v_{y,i,j+\\tfrac{1}{2}}-v_{y,i,j-\\tfrac{1}{2}}}{h}.\n$$\nThe time-stepping scheme is\n$$\nv_{x}^{n+\\tfrac{1}{2}} \\;=\\; v_{x}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{x} p^{n}, \n\\qquad\nv_{y}^{n+\\tfrac{1}{2}} \\;=\\; v_{y}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{y} p^{n},\n$$\n$$\np^{n+1} \\;=\\; p^{n} \\;-\\; \\kappa\\, \\Delta t \\left( D_{x}^{*} v_{x}^{n+\\tfrac{1}{2}} + D_{y}^{*} v_{y}^{n+\\tfrac{1}{2}} \\right).\n$$\nPerform a von Neumann (Fourier) stability analysis by inserting plane-wave solutions of the form $\\exp\\!\\big(i(k_{x} i h + k_{y} j h)\\big)$ in space and $\\exp\\!\\big(i\\omega n \\Delta t\\big)$ in time, assuming periodicity. Derive the Courant-Friedrichs-Lewy (CFL) condition $C=\\dfrac{c_{\\max}\\,\\Delta t}{h} \\le C_{\\text{crit}}$ that guarantees stability for all spatial wavenumbers, and compute $C_{\\text{crit}}$ explicitly for the above second-order spatial differences on the staggered grid. Express the final value of $C_{\\text{crit}}$ as an exact real number with no units.",
            "solution": "The problem statement is a standard exercise in the numerical analysis of finite-difference schemes for wave propagation and is valid. It is scientifically grounded, well-posed, and objective, providing all necessary information to derive the stability condition.\n\nWe begin the von Neumann stability analysis for the given second-order staggered-grid finite-difference scheme. The scheme discretizes the 2D acoustic wave equations:\n$$\n\\frac{\\partial p}{\\partial t} = -\\kappa \\left( \\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y} \\right)\n$$\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}, \\qquad \\rho \\frac{\\partial v_y}{\\partial t} = -\\frac{\\partial p}{\\partial y}\n$$\nThe analysis involves substituting plane-wave solutions (Fourier modes) into the discretized equations and determining the conditions under which these modes do not grow in amplitude over time.\n\nWe assume periodic plane-wave solutions for the pressure $p$ and velocity components $v_x, v_y$ on the staggered grid. The ansatz for each variable is defined at its respective grid location and time level:\n$$\np_{i,j}^{n} = \\hat{p}(t^n) \\, \\exp\\big( i(k_x i h + k_y j h) \\big)\n$$\n$$\nv_{x, i+\\frac{1}{2}, j}^{n \\pm \\frac{1}{2}} = \\hat{v}_x(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x (i+\\tfrac{1}{2}) h + k_y j h) \\big)\n$$\n$$\nv_{y, i, j+\\frac{1}{2}}^{n \\pm \\frac{1}{2}} = \\hat{v}_y(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x i h + k_y (j+\\tfrac{1}{2}) h) \\big)\n$$\nwhere $\\hat{p}$, $\\hat{v}_x$, and $\\hat{v}_y$ are the time-dependent Fourier amplitudes, $k_x$ and $k_y$ are the spatial wavenumbers, and $i, j, n$ are integer indices for space and time.\n\nNext, we transform the finite-difference operators into their Fourier space representations. For the gradient operator $D_x$ acting on $p$ at location $(i+\\frac{1}{2},j)$:\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{p_{i+1,j}^n - p_{i,j}^n}{h} = \\frac{\\hat{p}^n}{h} \\left[ \\exp\\big(i(k_x(i+1)h + k_y j h)\\big) - \\exp\\big(i(k_x i h + k_y j h)\\big) \\right]\n$$\nFactoring out the plane-wave term at the target location $(i+\\frac{1}{2},j)$ gives:\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{\\hat{p}^n}{h} \\exp\\big(i(k_x(i+\\tfrac{1}{2})h + k_y j h)\\big) \\left[ \\exp\\big(i\\frac{k_x h}{2}\\big) - \\exp\\big(-i\\frac{k_x h}{2}\\big) \\right] = \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\exp(\\dots)\n$$\nSimilarly, for the other operators:\n$$\nD_y p_{i,j+\\frac{1}{2}}^n \\rightarrow \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\n$$\nD_x^* v_{x,i,j}^{n+\\frac{1}{2}} = \\frac{v_{x,i+\\frac{1}{2},j}^{n+\\frac{1}{2}} - v_{x,i-\\frac{1}{2},j}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_x^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right)\n$$\n$$\nD_y^* v_{y,i,j}^{n+\\frac{1}{2}} = \\frac{v_{y,i,j+\\frac{1}{2}}^{n+\\frac{1}{2}} - v_{y,i,j-\\frac{1}{2}}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_y^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\nSubstituting these into the time-stepping scheme yields a system for the Fourier amplitudes:\n$$\n\\hat{v}_x^{n+\\frac{1}{2}} = \\hat{v}_x^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{v}_y^{n+\\frac{1}{2}} = \\hat{v}_y^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} = \\hat{p}^n - \\kappa \\Delta t \\left[ \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{v}_x^{n+\\frac{1}{2}} + \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\nTo obtain a single recurrence relation for pressure, we first express the pressure update at two consecutive time steps:\n$$\n\\hat{p}^{n+1} - \\hat{p}^n = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n+\\frac{1}{2}} + \\dots \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\n$$\n\\hat{p}^n - \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n-\\frac{1}{2}} + \\dots \\hat{v}_y^{n-\\frac{1}{2}} \\right]\n$$\nSubtracting the second equation from the first gives the centered second-order time derivative for pressure:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) (\\hat{v}_x^{n+\\frac{1}{2}}-\\hat{v}_x^{n-\\frac{1}{2}}) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) (\\hat{v}_y^{n+\\frac{1}{2}}-\\hat{v}_y^{n-\\frac{1}{2}}) \\right]\n$$\nWe substitute the expressions for $(\\hat{v}^{n+\\frac{1}{2}}-\\hat{v}^{n-\\frac{1}{2}})$ from the velocity update equations:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\hat{p}^n\\right) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\hat{p}^n\\right) \\right]\n$$\nSimplifying this expression, we use $i^2 = -1$ and the definition of wave speed $c^2=\\kappa/\\rho$:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -\\frac{\\kappa \\Delta t^2}{\\rho} \\frac{4}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\nLet the amplification factor be $g$, such that $\\hat{p}^n = g^n \\hat{p}^0$. Substituting this gives a quadratic characteristic equation for $g$:\n$$\ng^2 - 2g + 1 = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] g\n$$\n$$\ng^2 - \\left(2 - A\\right)g + 1 = 0\n$$\nwhere the term $A$ is defined as:\n$$\nA = 4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right]\n$$\nFor a leapfrog scheme, the stability condition $|g| \\le 1$ requires the roots of this quadratic equation to lie on the unit circle in the complex plane, which means $|g|=1$. This occurs if the discriminant of the quadratic is non-positive:\n$$\n(2-A)^2 - 4 \\le 0 \\implies (2-A)^2 \\le 4\n$$\nTaking the square root gives $-2 \\le 2-A \\le 2$. This implies two conditions:\n1. $2-A \\le 2 \\implies A \\ge 0$. This is always satisfied since $A$ is a sum of squares.\n2. $2-A \\ge -2 \\implies 4 \\ge A$. This is the stability constraint.\n\nSubstituting the expression for $A$ into the stability constraint:\n$$\n4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 4\n$$\n$$\n\\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 1\n$$\nThis condition must hold for all possible wavenumbers $k_x$ and $k_y$. To find the most restrictive condition (the Courant-Friedrichs-Lewy condition), we must maximize the term in the square brackets. The maximum value of $\\sin^2(\\theta)$ is $1$. This occurs for the highest frequency modes resolvable by the grid, where $k_x h = \\pi$ and $k_y h = \\pi$.\n$$\n\\max_{k_x, k_y} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] = \\sin^2\\left(\\frac{\\pi}{2}\\right) + \\sin^2\\left(\\frac{\\pi}{2}\\right) = 1^2 + 1^2 = 2\n$$\nSubstituting this maximum value into the inequality gives the stability limit:\n$$\n\\frac{c^2 \\Delta t^2}{h^2} (2) \\le 1 \\implies \\left(\\frac{c \\Delta t}{h}\\right)^2 \\le \\frac{1}{2}\n$$\nTaking the square root of both sides, we obtain the CFL condition for the 2D scheme:\n$$\n\\frac{c \\Delta t}{h} \\le \\frac{1}{\\sqrt{2}}\n$$\nThe problem statement defines the Courant number as $C = \\frac{c_{\\max}\\,\\Delta t}{h}$. In this constant-coefficient case, $c_{\\max} = c$. The critical Courant number $C_{\\text{crit}}$ is the maximum value for which the scheme is stable. Therefore:\n$$\nC_{\\text{crit}} = \\frac{1}{\\sqrt{2}}\n$$",
            "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}}}$$"
        },
        {
            "introduction": "Real-world geophysical media are not uniform; they are characterized by sharp interfaces separating different materials, such as rock layers or fluid contacts. This practice addresses the critical question of how to represent a discontinuous material property, like density $\\rho$, on a staggered grid where velocity and pressure are not collocated . By deriving the correct averaging scheme from a finite-volume argument, you will learn why a seemingly simple choice, like arithmetic vs. harmonic averaging, has profound consequences for the physical accuracy of the simulation.",
            "id": "3615311",
            "problem": "Consider the one-dimensional, linearized acoustic equations for a heterogeneous fluid with piecewise-constant base density $\\rho(x)$ and bulk modulus $K(x)$,\n$$\n\\rho(x)\\,\\frac{\\partial v}{\\partial t} \\;=\\; -\\,\\frac{\\partial p}{\\partial x}, \n\\qquad\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\,K(x)\\,\\frac{\\partial v}{\\partial x},\n$$\nposed on a uniform grid of spacing $\\Delta x$ with a standard staggered arrangement: pressure $p_i(t)$ at cell centers $x_i$ and velocity $v_{i+\\tfrac{1}{2}}(t)$ at faces $x_{i+\\tfrac{1}{2}}$. Suppose $\\rho(x)$ has a jump discontinuity across an interface exactly located at the face $x_{i+\\tfrac{1}{2}}$, with left and right limiting values $\\rho_L$ and $\\rho_R$, respectively. You are to determine the consistent coefficient to use at the staggered face when updating $v_{i+\\tfrac{1}{2}}$ in a finite-volume semi-discretization.\n\nStarting from the momentum balance written in integral form over the dual control volume attached to the face $x_{i+\\tfrac{1}{2}}$, namely the union of the two half-cells $[x_i,x_{i+\\tfrac{1}{2}}]$ and $[x_{i+\\tfrac{1}{2}},x_{i+1}]$ of total length $\\Delta x$, derive the appropriate face coefficient that multiplies the discrete pressure difference when updating $v_{i+\\tfrac{1}{2}}$. Your choice must satisfy all of the following requirements:\n- It follows from the control-volume (finite-volume) statement of momentum, with $v_{i+\\tfrac{1}{2}}$ interpreted as a piecewise-constant velocity over the dual control volume.\n- It yields the correct limiting behavior as $\\rho_L \\to \\infty$ or $\\rho_R \\to \\infty$ (the face velocity should have zero acceleration in the rigid-limit on either side).\n- It is consistent with second-order accuracy on smooth $\\rho(x)$ under the given staggered discretization.\n\nWhich of the following prescriptions for the face coefficient is consistent with these requirements when used in the semi-discrete update\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\Big(\\text{face coefficient at }x_{i+\\tfrac{1}{2}}\\Big)\\,\\frac{p_{i+1}-p_i}{\\Delta x}\\,?\n$$\n\nA. Use the arithmetic average of density at the face in the sense $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{\\rho_L+\\rho_R}{2}$ and set the face coefficient to $1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}.$\n\nB. Use the harmonic average of density at the face in the sense $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{2}{\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R}}$ and set the face coefficient to $1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}.$\n\nC. Use the arithmetic average of inverse density at the face in the sense $\\left(\\dfrac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{1}{2}\\left(\\dfrac{1}{\\rho_L}+\\dfrac{1}{\\rho_R}\\right),$ and set the face coefficient directly to $\\left(1/\\rho\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}.$\n\nD. Use an upwind selection of density at the face, i.e., choose $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_L$ if $p_{i+1}-p_i>0$ and $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_R$ otherwise, and set the face coefficient to $1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}.$\n\nE. Both B and C are equivalent and satisfy the stated requirements because they represent the same physical averaging in different algebraic forms.\n\nSelect the single best answer.",
            "solution": "We begin from the integral form of the linear momentum equation for the dual control volume attached to the velocity degree of freedom at $x_{i+\\tfrac{1}{2}}$. Let $V_{i+\\tfrac{1}{2}}$ denote the one-dimensional control volume $[x_i,x_{i+1}]$ of length $\\Delta x$ (in multiple dimensions, this would be the face-centered hexahedron; the one-dimensional derivation captures the essential point). The momentum balance states\n$$\n\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\frac{\\partial v}{\\partial t}(x,t)\\,\\mathrm{d}x \\;=\\; - \\int_{x_i}^{x_{i+1}} \\frac{\\partial p}{\\partial x}(x,t)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}(t)-p_i(t)\\Big).\n$$\nOn the staggered grid, $v_{i+\\tfrac{1}{2}}(t)$ represents the average velocity over the dual control volume. Under the standard finite-volume assumption that $v$ is piecewise constant on $V_{i+\\tfrac{1}{2}}$, we can factor $\\partial v/\\partial t$ outside the left integral:\n$$\n\\left(\\frac{\\partial v_{i+\\tfrac{1}{2}}}{\\partial t}\\right)\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}-p_i\\Big).\n$$\nDefine the effective face mass (per unit area in higher dimensions) as the volume average\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x.\n$$\nThen the semi-discrete velocity update induced by the finite-volume momentum balance is\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}}\\,\\frac{p_{i+1}-p_i}{\\Delta x}.\n$$\nWhen the interface lies at $x_{i+\\tfrac{1}{2}}$ with piecewise-constant $\\rho(x)$ taking values $\\rho_L$ on $[x_i,x_{i+\\tfrac{1}{2}})$ and $\\rho_R$ on $(x_{i+\\tfrac{1}{2}},x_{i+1}]$, the volume average over the two half-cells gives\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\left(\\int_{x_i}^{x_{i+\\tfrac{1}{2}}} \\rho_L\\,\\mathrm{d}x + \\int_{x_{i+\\tfrac{1}{2}}}^{x_{i+1}} \\rho_R\\,\\mathrm{d}x\\right) \\;=\\; \\frac{\\rho_L+\\rho_R}{2}.\n$$\nThus the consistent face coefficient in the velocity update is\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R}.\n$$\n\nWe now verify the stated requirements.\n\nRequirement based on the control-volume momentum balance. The derivation above follows directly from the integral statement over the dual control volume and therefore enforces that the discrete pressure work $\\big(p_{i+1}-p_i\\big)v_{i+\\tfrac{1}{2}}$ equals the rate of change of the kinetic energy associated with the face degree of freedom with mass $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}.$ This is the standard finite-volume consistency.\n\nRigid-limit test. Consider the limit $\\rho_L \\to \\infty$ with $\\rho_R$ fixed. Physically, the face velocity represents the motion of two half-masses attached to the same degree of freedom; as one half-mass becomes infinitely heavy, the acceleration of the shared velocity should vanish: $\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0$. With the finite-volume choice,\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R} \\;\\longrightarrow\\; 0 \\quad \\text{as} \\quad \\rho_L \\to \\infty,\n$$\nso $\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0$ as required. The same conclusion holds for $\\rho_R \\to \\infty$ by symmetry.\n\nSecond-order accuracy on smooth coefficients. If $\\rho(x)$ is smooth, then the midpoint rule yields that the control-volume average over $[x_i,x_{i+1}]$ is a second-order accurate approximation to $\\rho(x_{i+\\tfrac{1}{2}})$. Thus $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2$ is a second-order accurate face value on a uniform grid when $\\rho_L=\\rho(x_{i+\\tfrac{1}{2}}-\\tfrac{\\Delta x}{2})$ and $\\rho_R=\\rho(x_{i+\\tfrac{1}{2}}+\\tfrac{\\Delta x}{2})$.\n\nWe now evaluate each option.\n\nOption A. This prescribes $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2$, i.e., the control-volume (arithmetic) average of density across the two half-cells, and sets the face coefficient to its reciprocal. This matches the finite-volume derivation exactly. In the rigid-limit $\\rho_L\\to\\infty$, the coefficient $2/(\\rho_L+\\rho_R)\\to 0$, so the acceleration vanishes as required. For smooth $\\rho(x)$, the arithmetic average across the symmetric stencil is second-order accurate for the face value. Verdict: Correct.\n\nOption B. This prescribes the harmonic average density $\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=2/(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})$ and uses its reciprocal as the face coefficient, i.e., $(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})$. While harmonic averaging is appropriate for diffusive fluxes of the form $\\partial_x\\!\\big(a\\,\\partial_x u\\big)$ to enforce flux continuity with discontinuous coefficients, here the coefficient multiplies the time derivative when written as $\\rho\\,\\partial_t v=-\\partial_x p$. In the rigid-limit $\\rho_L\\to\\infty$, this choice yields $(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to (\\tfrac{1}{2})(0+\\tfrac{1}{\\rho_R})=\\tfrac{1}{2\\rho_R}$, a nonzero acceleration, which contradicts the correct physical limit. It also does not follow from the control-volume momentum balance. Verdict: Incorrect.\n\nOption C. This prescribes the arithmetic average of inverse density directly as the face coefficient, $(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})$. This is algebraically identical to the reciprocal of the harmonic average density in Option B, and therefore shares the same deficiencies. In the rigid-limit $\\rho_L\\to\\infty$, it again yields $(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to \\tfrac{1}{2\\rho_R}$, implying a nonzero acceleration, violating the rigid-limit requirement. It also does not follow from the control-volume momentum balance, which averages $\\rho$ rather than $1/\\rho$ for the mass. Verdict: Incorrect.\n\nOption D. This proposes upwinding $\\rho$ based on the sign of $p_{i+1}-p_i$. The linearized acoustics system is non-dissipative and the face coefficient is a material property independent of wave direction; introducing upwinding at this location breaks the symmetry required for discrete energy conservation and gives incorrect behavior in symmetric configurations. In particular, consider $\\rho_L \\neq \\rho_R$ with $p_{i+1}-p_i=0$; then the selection is undefined by the stated rule. Moreover, in the rigid-limit $\\rho_L\\to\\infty$, if the rule selects the finite side, it fails to produce zero acceleration. This option is also not derivable from the control-volume momentum balance. Verdict: Incorrect.\n\nOption E. Options B and C are indeed algebraically equivalent, but, as shown above, they do not satisfy the rigid-limit requirement and do not emerge from the finite-volume momentum balance. Therefore, they are not correct, either individually or jointly. Verdict: Incorrect.\n\nTherefore, the only option satisfying all stated requirements is the arithmetic average of density over the dual control volume, used via its reciprocal as the face coefficient in the velocity update, i.e., Option A.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "High-order accuracy in the interior of a computational domain is lost if boundaries are not handled with equal care. Since centered stencils cannot be applied at the domain edges, we must design special one-sided closures that maintain the scheme's overall order of accuracy . This exercise guides you through the process of constructing such a boundary stencil using Taylor series expansions, a vital technique for preventing numerical artifacts and ensuring the fidelity of your wave simulations.",
            "id": "3615321",
            "problem": "Consider the one-dimensional linear acoustic wave system in a homogeneous, isotropic medium with bulk modulus $K$ and density $\\rho$,\n$$\n\\frac{\\partial p}{\\partial t} = -K \\frac{\\partial u}{\\partial x}, \\qquad \\frac{\\partial u}{\\partial t} = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x},\n$$\ndiscretized on a uniform staggered grid with spatial step $h>0$ on the interval $[0,L]$. The pressure $p$ is defined at integer grid points $x_i = i h$ and the particle velocity $u$ is defined at half-grid points $x_{i+\\frac{1}{2}} = \\left(i+\\frac{1}{2}\\right) h$. In the interior, spatial derivatives are approximated by centered, antisymmetric, fourth-order accurate finite-difference stencils on the staggered grid. At the left boundary $x=0$, to preserve the scheme’s global fourth-order accuracy and avoid spurious boundary-supported modes when coupling the staggered fields, you must construct a one-sided closure for the derivative $\\frac{\\partial u}{\\partial x}(0)$ using only the five nearest half-grid velocity values $u\\!\\left(\\frac{h}{2}\\right)$, $u\\!\\left(\\frac{3h}{2}\\right)$, $u\\!\\left(\\frac{5h}{2}\\right)$, $u\\!\\left(\\frac{7h}{2}\\right)$, and $u\\!\\left(\\frac{9h}{2}\\right)$. \n\nStarting from well-tested expansions of smooth functions and the requirement that the boundary closure’s truncation error matches the interior scheme’s formal order, derive the one-sided coefficients $b_0$, $b_1$, $b_2$, $b_3$, $b_4$ such that the approximation\n$$\n\\frac{\\partial u}{\\partial x}(0) \\approx \\frac{1}{h}\\sum_{k=0}^{4} b_k\\, u\\!\\left(\\left(k+\\frac{1}{2}\\right)h\\right)\n$$\nis fourth-order accurate in $h$ and consistent with the interior staggered-grid discretization. Provide the exact coefficients as rational numbers. Express your final answer as a single row matrix containing $(b_0, b_1, b_2, b_3, b_4)$ with no units. No rounding is required.",
            "solution": "The problem requires the derivation of coefficients for a one-sided, fourth-order accurate finite-difference approximation for the first derivative $\\frac{\\partial u}{\\partial x}$ at a boundary point $x=0$. The approximation uses values of the function $u(x)$ at staggered grid points $x_{k+1/2} = (k+1/2)h$ for $k=0, 1, 2, 3, 4$.\n\nThe form of the approximation is given as:\n$$\n\\frac{\\partial u}{\\partial x}(0) \\approx \\frac{1}{h}\\sum_{k=0}^{4} b_k\\, u\\!\\left(\\left(k+\\frac{1}{2}\\right)h\\right)\n$$\nTo determine the coefficients $b_k$, we require that this approximation be fourth-order accurate. This means that if we replace $u(x)$ with its Taylor series expansion around $x=0$, the resulting expression must match the Taylor series of $\\frac{\\partial u}{\\partial x}(0)$ up to terms of order $h^4$. The Taylor expansion of a sufficiently smooth function $u(x)$ around $x=0$ is:\n$$\nu(x) = u(0) + x \\frac{\\partial u}{\\partial x}(0) + \\frac{x^2}{2!} \\frac{\\partial^2 u}{\\partial x^2}(0) + \\frac{x^3}{3!} \\frac{\\partial^3 u}{\\partial x^3}(0) + \\dots = \\sum_{j=0}^{\\infty} \\frac{u^{(j)}(0)}{j!} x^j\n$$\nLet's substitute $x = x_{k+1/2} = (k+1/2)h$ into the expansion:\n$$\nu\\!\\left(\\left(k+\\frac{1}{2}\\right)h\\right) = \\sum_{j=0}^{\\infty} \\frac{u^{(j)}(0)}{j!} \\left(\\left(k+\\frac{1}{2}\\right)h\\right)^j\n$$\nPlugging this into the finite-difference formula gives:\n$$\n\\frac{1}{h}\\sum_{k=0}^{4} b_k \\left( \\sum_{j=0}^{\\infty} \\frac{u^{(j)}(0)}{j!} \\left(\\left(k+\\frac{1}{2}\\right)h\\right)^j \\right)\n$$\nBy swapping the order of summation, we can group terms by derivatives of $u(x)$ at $x=0$:\n$$\n\\sum_{j=0}^{\\infty} \\frac{u^{(j)}(0)}{j!} h^{j-1} \\left( \\sum_{k=0}^{4} b_k \\left(k+\\frac{1}{2}\\right)^j \\right)\n$$\nLet $\\xi_k = k+\\frac{1}{2}$. The expression becomes:\n$$\n\\left(\\sum_{k=0}^{4} b_k \\xi_k^0\\right) \\frac{u^{(0)}(0)}{0! h} + \\left(\\sum_{k=0}^{4} b_k \\xi_k^1\\right) \\frac{u^{(1)}(0)}{1!} + \\left(\\sum_{k=0}^{4} b_k \\xi_k^2\\right) \\frac{u^{(2)}(0) h}{2!} + \\dots + \\left(\\sum_{k=0}^{4} b_k \\xi_k^m\\right) \\frac{u^{(m)}(0) h^{m-1}}{m!} + \\dots\n$$\nWe want this expression to be an approximation of $u^{(1)}(0)$ with a truncation error of order $O(h^4)$. This requires that the coefficients of $u^{(j)}(0)$ match those in the expression for $u^{(1)}(0)$ for as many terms as possible.\n\\begin{itemize}\n    \\item The coefficient of $u^{(0)}(0)$ must be zero. This gives the condition on the $h^{-1}$ term: $\\sum_{k=0}^{4} b_k \\xi_k^0 = 0$.\n    \\item The coefficient of $u^{(1)}(0)$ must be one. This gives the condition on the $h^0$ term: $\\sum_{k=0}^{4} b_k \\xi_k^1 = 1$.\n    \\item The coefficient of $u^{(2)}(0)$ must be zero. This gives the condition on the $h^1$ term: $\\sum_{k=0}^{4} b_k \\xi_k^2 = 0$.\n    \\item The coefficient of $u^{(3)}(0)$ must be zero. This gives the condition on the $h^2$ term: $\\sum_{k=0}^{4} b_k \\xi_k^3 = 0$.\n    \\item The coefficient of $u^{(4)}(0)$ must be zero. This gives the condition on the $h^3$ term: $\\sum_{k=0}^{4} b_k \\xi_k^4 = 0$.\n\\end{itemize}\nThe leading error term will involve $u^{(5)}(0)$ and be proportional to $h^4$, thus ensuring a fourth-order accurate scheme. This gives a system of five linear equations for the five unknown coefficients $b_0, b_1, b_2, b_3, b_4$:\n$$\n\\sum_{k=0}^{4} b_k \\xi_k^j = \\delta_{j1} \\quad \\text{for } j=0, 1, 2, 3, 4\n$$\nwhere $\\xi_k = k+\\frac{1}{2}$ are the normalized grid locations $\\{1/2, 3/2, 5/2, 7/2, 9/2\\}$, and $\\delta_{j1}$ is the Kronecker delta.\n\nThis system can be solved directly. Another systematic method is to use Lagrange interpolation. Consider a polynomial $P(x)$ of degree at most $4$ that interpolates the function $u(x)$ at the stencil points $x_k = \\xi_k h$. The derivative of this polynomial at $x=0$, $P'(0)$, serves as an approximation to $u'(0)$. The interpolating polynomial is $P(y) = \\sum_{k=0}^{4} u(x_k) \\mathcal{L}_k(y)$, where $\\mathcal{L}_k(y)$ are the Lagrange basis polynomials for the points $x_k$. The derivative is $P'(y) = \\sum_{k=0}^{4} u(x_k) \\mathcal{L}'_k(y)$. Evaluating at $y=0$, we get $u'(0) \\approx P'(0) = \\sum_{k=0}^{4} u(x_k) \\mathcal{L}'_k(0)$. Comparing this to the desired form $\\frac{1}{h} \\sum b_k u(x_k)$, we find $b_k = h \\mathcal{L}'_k(0)$.\nLet's define the Lagrange basis polynomials $L_k(z)$ for the normalized nodes $\\xi_k$:\n$$\nL_k(z) = \\prod_{j=0, j\\neq k}^{4} \\frac{z-\\xi_j}{\\xi_k-\\xi_j}\n$$\nWith the change of variables $y=zh$, we have $\\mathcal{L}_k(y) = L_k(y/h)$, so $\\mathcal{L}'_k(y) = \\frac{1}{h}L'_k(y/h)$. Evaluating at $y=0$ gives $\\mathcal{L}'_k(0) = \\frac{1}{h}L'_k(0)$. Thus, the coefficients are exactly $b_k = h(\\frac{1}{h}L'_k(0)) = L'_k(0)$.\n\nThe coefficients are $b_k = L'_k(0)$. The derivative of a Lagrange polynomial at a point $z$ is $L'_k(z) = \\frac{1}{\\prod_{j \\neq k}(\\xi_k-\\xi_j)} \\sum_{m \\neq k} \\prod_{j \\neq k,m} (z-\\xi_j)$. At $z=0$, this gives:\n$$\nb_k = L'_k(0) = \\frac{\\sum_{m \\neq k} \\prod_{j \\neq k,m} (-\\xi_j)}{\\prod_{j \\neq k} (\\xi_k - \\xi_j)}\n$$\nThe nodes are $\\xi_k = \\{1/2, 3/2, 5/2, 7/2, 9/2\\}$. The denominator is $\\prod_{j \\neq k} (k-j) = k!(-1)^{4-k}(4-k)!$. The numerator is $-e_{3}(S_k)$, where $S_k = \\{\\xi_0, ..., \\xi_4\\} \\setminus \\{\\xi_k\\}$, and $e_3$ is the elementary symmetric polynomial of degree $3$.\n\nFor $k=0$: $\\xi_0=1/2$. Denominator is $0!(-1)^4 4! = 24$. Numerator is $-\\left( \\frac{3}{2}\\frac{5}{2}\\frac{7}{2} + \\frac{3}{2}\\frac{5}{2}\\frac{9}{2} + \\frac{3}{2}\\frac{7}{2}\\frac{9}{2} + \\frac{5}{2}\\frac{7}{2}\\frac{9}{2} \\right) = -\\frac{105+135+189+315}{8} = -\\frac{744}{8} = -93$.\n$b_0 = -93/24 = -31/8$.\n\nFor $k=1$: $\\xi_1=3/2$. Denominator is $1!(-1)^3 3! = -6$. Numerator is $-\\left( \\frac{1}{2}\\frac{5}{2}\\frac{7}{2} + \\frac{1}{2}\\frac{5}{2}\\frac{9}{2} + \\frac{1}{2}\\frac{7}{2}\\frac{9}{2} + \\frac{5}{2}\\frac{7}{2}\\frac{9}{2} \\right) = -\\frac{35+45+63+315}{8} = -\\frac{458}{8} = -229/4$.\n$b_1 = (-229/4)/(-6) = 229/24$.\n\nFor $k=2$: $\\xi_2=5/2$. Denominator is $2!(-1)^2 2! = 4$. Numerator is $-\\left( \\frac{1}{2}\\frac{3}{2}\\frac{7}{2} + \\frac{1}{2}\\frac{3}{2}\\frac{9}{2} + \\frac{1}{2}\\frac{7}{2}\\frac{9}{2} + \\frac{3}{2}\\frac{7}{2}\\frac{9}{2} \\right) = -\\frac{21+27+63+189}{8} = -\\frac{300}{8} = -75/2$.\n$b_2 = (-75/2)/4 = -75/8$.\n\nFor $k=3$: $\\xi_3=7/2$. Denominator is $3!(-1)^1 1! = -6$. Numerator is $-\\left( \\frac{1}{2}\\frac{3}{2}\\frac{5}{2} + \\frac{1}{2}\\frac{3}{2}\\frac{9}{2} + \\frac{1}{2}\\frac{5}{2}\\frac{9}{2} + \\frac{3}{2}\\frac{5}{2}\\frac{9}{2} \\right) = -\\frac{15+27+45+135}{8} = -\\frac{222}{8} = -111/4$.\n$b_3 = (-111/4)/(-6) = 111/24 = 37/8$.\n\nFor $k=4$: $\\xi_4=9/2$. Denominator is $4!(-1)^0 0! = 24$. Numerator is $-\\left( \\frac{1}{2}\\frac{3}{2}\\frac{5}{2} + \\frac{1}{2}\\frac{3}{2}\\frac{7}{2} + \\frac{1}{2}\\frac{5}{2}\\frac{7}{2} + \\frac{3}{2}\\frac{5}{2}\\frac{7}{2} \\right) = -\\frac{15+21+35+105}{8} = -\\frac{176}{8} = -22$.\n$b_4 = -22/24 = -11/12$.\n\nThe derived coefficients are:\n$b_0 = -31/8$\n$b_1 = 229/24$\n$b_2 = -75/8$\n$b_3 = 37/8$\n$b_4 = -11/12$\nAs a final check we can verify $\\sum b_k = -31/8 + 229/24 - 75/8 + 37/8 - 11/12 = \\frac{-93+229-225+111-22}{24} = \\frac{340-340}{24} = 0$, which is correct.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{31}{8} & \\frac{229}{24} & -\\frac{75}{8} & \\frac{37}{8} & -\\frac{11}{12}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}