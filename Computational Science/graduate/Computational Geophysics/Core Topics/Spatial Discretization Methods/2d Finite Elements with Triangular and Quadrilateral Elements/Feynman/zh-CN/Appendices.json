{
    "hands_on_practices": [
        {
            "introduction": "从简单的理想参考单元到现实世界中的复杂物理单元的转换，是等参有限元方法的基础。雅可比行列式量化了这种几何变换，是检验单元质量的关键指标，因为扭曲的网格可能导致严重的数值误差。本练习  提供了计算一个扭曲四边形单元雅可比行列式的动手实践，让学生直观地理解单元形状如何影响数值模型的稳定性。",
            "id": "3572383",
            "problem": "考虑一个二维等参双线性四边形有限元，它在有限元法 (FEM) 中用于离散化计算地球物理学中的非均质电导率场。该物理单元由其四个角节点定义，这些节点使用双线性等参公式 $x(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,x_{i}$ 和 $y(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,y_{i}$ 从参考正方形 $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ 映射而来，其中 $N_{i}(\\xi,\\eta)$ 是标准双线性形函数，映射的雅可比矩阵 $\\mathbf{J}(\\xi,\\eta)$ 定义为 $$\\mathbf{J}(\\xi,\\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$$。节点排序如下：节点1对应 $(\\xi,\\eta) = (-1,-1)$，节点2对应 $(\\xi,\\eta) = (1,-1)$，节点3对应 $(\\xi,\\eta) = (1,1)$，节点4对应 $(\\xi,\\eta) = (-1,1)$。四个节点的物理坐标（单位：千米）为：\n- 节点1： $(x_{1},y_{1}) = (0,\\,0)$,\n- 节点2： $(x_{2},y_{2}) = (2.0,\\,0.1)$,\n- 节点3： $(x_{3},y_{3}) = (2.2,\\,1.9)$,\n- 节点4： $(x_{4},y_{4}) = (0.1,\\,2.0)$。\n\n该单元是凸的，但高度扭曲。\n\n从等参映射和雅可比矩阵的定义出发，计算在位于 $(\\xi,\\eta) = (\\pm \\frac{1}{\\sqrt{3}},\\,\\pm \\frac{1}{\\sqrt{3}})$ 的四个正方形上的两点Gauss–Legendre求积点处的行列式 $\\det\\mathbf{J}(\\xi,\\eta)$。基于这些值，评估此单元因近奇异映射而产生的数值不稳定性风险。\n\n报告四个Gauss点上 $\\det\\mathbf{J}(\\xi,\\eta)$ 的最小值作为最终结果。将答案四舍五入到四位有效数字。以平方千米为单位表示您的答案。",
            "solution": "四节点四边形的等参双线性映射使用标准双线性形函数\n$$\nN_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\n$$\n$$\nN_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta),\n$$\n使得物理位置为\n$$\nx(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,x_{i},\\qquad\ny(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,y_{i}.\n$$\n雅可比矩阵 $\\mathbf{J}(\\xi,\\eta)$ 由链式法则得出：\n$$\n\\mathbf{J}(\\xi,\\eta) = \n\\begin{pmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\xi}x_{i}  \\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\eta}x_{i} \\\\\n\\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\xi}y_{i}  \\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\eta}y_{i}\n\\end{pmatrix}.\n$$\n形函数的导数为\n$$\n\\frac{\\partial N_{1}}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta),\\quad\n\\frac{\\partial N_{2}}{\\partial \\xi} = \\frac{1}{4}(1-\\eta),\\quad\n\\frac{\\partial N_{3}}{\\partial \\xi} = \\frac{1}{4}(1+\\eta),\\quad\n\\frac{\\partial N_{4}}{\\partial \\xi} = -\\frac{1}{4}(1+\\eta),\n$$\n$$\n\\frac{\\partial N_{1}}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi),\\quad\n\\frac{\\partial N_{2}}{\\partial \\eta} = -\\frac{1}{4}(1+\\xi),\\quad\n\\frac{\\partial N_{3}}{\\partial \\eta} = \\frac{1}{4}(1+\\xi),\\quad\n\\frac{\\partial N_{4}}{\\partial \\eta} = \\frac{1}{4}(1-\\xi).\n$$\n使用节点坐标 $(x_{1},y_{1}) = (0,\\,0)$，$(x_{2},y_{2}) = (2.0,\\,0.1)$，$(x_{3},y_{3}) = (2.2,\\,1.9)$，$(x_{4},y_{4}) = (0.1,\\,2.0)$，我们可以紧凑地写出\n$$\n\\frac{\\partial x}{\\partial \\xi}(\\eta) = \\frac{(1-\\eta)\\,x_{2} + (1+\\eta)\\,x_{3} - (1+\\eta)\\,x_{4}}{4},\\qquad\n\\frac{\\partial y}{\\partial \\xi}(\\eta) = \\frac{(1-\\eta)\\,y_{2} + (1+\\eta)\\,y_{3} - (1+\\eta)\\,y_{4}}{4},\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(\\xi) = \\frac{-(1+\\xi)\\,x_{2} + (1+\\xi)\\,x_{3} + (1-\\xi)\\,x_{4}}{4},\\qquad\n\\frac{\\partial y}{\\partial \\eta}(\\xi) = \\frac{-(1+\\xi)\\,y_{2} + (1+\\xi)\\,y_{3} + (1-\\xi)\\,y_{4}}{4}.\n$$\n$[-1,1]$ 上的两点Gauss–Legendre求积点位于 $\\xi = \\pm r$ 和 $\\eta = \\pm r$，其中\n$$\nr = \\frac{1}{\\sqrt{3}} \\approx 0.577350269.\n$$\n我们计算这四个点上的 $\\det\\mathbf{J}(\\xi,\\eta) = \\left(\\frac{\\partial x}{\\partial \\xi}\\right)\\left(\\frac{\\partial y}{\\partial \\eta}\\right) - \\left(\\frac{\\partial x}{\\partial \\eta}\\right)\\left(\\frac{\\partial y}{\\partial \\xi}\\right)$。\n\n首先，对于 $(\\xi,\\eta) = (r,r)$，使用 $(1-\\eta) = 1-r \\approx 0.422649731$，$(1+\\eta) = 1+r \\approx 1.577350269$，以及类似的 $(1\\pm\\xi)$：\n$$\n\\frac{\\partial x}{\\partial \\xi}(r) = \\frac{0.422649731\\cdot 2.0 + 1.577350269\\cdot 2.2 - 1.577350269\\cdot 0.1}{4} \\approx 1.0394337568,\n$$\n$$\n\\frac{\\partial y}{\\partial \\xi}(r) = \\frac{0.422649731\\cdot 0.1 + 1.577350269\\cdot 1.9 - 1.577350269\\cdot 2.0}{4} \\approx -0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(r) = \\frac{-1.577350269\\cdot 2.0 + 1.577350269\\cdot 2.2 + 0.422649731\\cdot 0.1}{4} \\approx 0.089433756775,\n$$\n$$\n\\frac{\\partial y}{\\partial \\eta}(r) = \\frac{-1.577350269\\cdot 0.1 + 1.577350269\\cdot 1.9 + 0.422649731\\cdot 2.0}{4} \\approx 0.92113248655.\n$$\n因此，\n$$\n\\det\\mathbf{J}(r,r) \\approx 1.0394337568\\cdot 0.92113248655 - 0.089433756775\\cdot(-0.02886751345) \\approx 0.96003799.\n$$\n\n其次，对于 $(\\xi,\\eta) = (-r,r)$，$(1+\\xi) = 1-r \\approx 0.422649731$，$(1-\\xi) = 1+r \\approx 1.577350269$，而 $(1\\pm\\eta)$ 与之前相同：\n$$\n\\frac{\\partial x}{\\partial \\xi}(r) \\approx 1.0394337568,\\quad \\frac{\\partial y}{\\partial \\xi}(r) \\approx -0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(-r) = \\frac{-0.422649731\\cdot 2.0 + 0.422649731\\cdot 2.2 + 1.577350269\\cdot 0.1}{4} \\approx 0.060566243275,\n$$\n$$\n\\frac{\\partial y}{\\partial \\eta}(-r) = \\frac{-0.422649731\\cdot 0.1 + 0.422649731\\cdot 1.9 + 1.577350269\\cdot 2.0}{4} \\approx 0.9788675135,\n$$\n和\n$$\n\\det\\mathbf{J}(-r,r) \\approx 1.0394337568\\cdot 0.9788675135 - 0.060566243275\\cdot(-0.02886751345) \\approx 1.019216337.\n$$\n\n第三，对于 $(\\xi,\\eta) = (r,-r)$，$(1-\\eta) = 1+r \\approx 1.577350269$，$(1+\\eta) = 1-r \\approx 0.422649731$：\n$$\n\\frac{\\partial x}{\\partial \\xi}(-r) = \\frac{1.577350269\\cdot 2.0 + 0.422649731\\cdot 2.2 - 0.422649731\\cdot 0.1}{4} \\approx 1.010566243275,\n$$\n$$\n\\frac{\\partial y}{\\partial \\xi}(-r) = \\frac{1.577350269\\cdot 0.1 + 0.422649731\\cdot 1.9 - 0.422649731\\cdot 2.0}{4} \\approx 0.02886751345,\n$$\n且 $(1\\pm\\xi)$ 与第一种情况相同：\n$$\n\\frac{\\partial x}{\\partial \\eta}(r) \\approx 0.089433756775,\\qquad\n\\frac{\\partial y}{\\partial \\eta}(r) \\approx 0.92113248655,\n$$\n得出\n$$\n\\det\\mathbf{J}(r,-r) \\approx 1.010566243275\\cdot 0.92113248655 - 0.089433756775\\cdot 0.02886751345 \\approx 0.928283607.\n$$\n\n第四，对于 $(\\xi,\\eta) = (-r,-r)$：\n$$\n\\frac{\\partial x}{\\partial \\xi}(-r) \\approx 1.010566243275,\\quad \\frac{\\partial y}{\\partial \\xi}(-r) \\approx 0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(-r) \\approx 0.060566243275,\\quad \\frac{\\partial y}{\\partial \\eta}(-r) \\approx 0.9788675135,\n$$\n和\n$$\n\\det\\mathbf{J}(-r,-r) \\approx 1.010566243275\\cdot 0.9788675135 - 0.060566243275\\cdot 0.02886751345 \\approx 0.987461796.\n$$\n\n综合这些结果，四个Gauss点处的雅可比行列式（单位：平方千米）近似为：\n$$\n\\det\\mathbf{J}(r,r) \\approx 0.96003799,\\quad\n\\det\\mathbf{J}(-r,r) \\approx 1.019216337,\\quad\n\\det\\mathbf{J}(r,-r) \\approx 0.928283607,\\quad\n\\det\\mathbf{J}(-r,-r) \\approx 0.987461796.\n$$\n最小值为\n$$\n\\min\\{\\det\\mathbf{J}\\} \\approx 0.928283607.\n$$\n\n关于数值稳定性，当 $\\det\\mathbf{J}(\\xi,\\eta)$ 在单元内接近零或改变符号时，等参映射会变得近奇异，这会导致大的插值梯度和病态的刚度矩阵。在此，所有行列式都保持为正且量级相当；最小值与最大值的比值 $0.928283607 / 1.019216337 \\approx 0.911$，表明存在中等程度的扭曲但非近奇异。因此，对于该单元，由近奇异映射引起的数值不稳定性风险很低。\n\n将最小行列式四舍五入到四位有效数字，并按要求以平方千米为单位表示，得到\n$$\n0.9283.\n$$",
            "answer": "$$\\boxed{0.9283}$$"
        },
        {
            "introduction": "对于许多物理问题（如热扩散和弹性变形），构建单元刚度矩阵是有限元分析的基石。此过程涉及对形函数导数和材料属性进行积分，而复杂的几何形状和各向异性材料使这项任务变得复杂。本练习  概述了在等参四边形单元上计算各向异性介质刚度矩阵的完整数值流程，从而巩固了对几何映射、弱形式和数值积分之间联系的理解。",
            "id": "3572415",
            "problem": "考虑一个在计算地球物理学中典型的非均匀各向异性介质中的二维稳态扩散问题：在域 $\\Omega \\subset \\mathbb{R}^2$ 上求解 $u(\\mathbf{x})$，使得 $-\\nabla \\cdot (\\mathbf{K}(\\mathbf{x}) \\nabla u) = f$ 成立，并满足适当的边界条件，其中 $\\mathbf{K}(\\mathbf{x})$ 是一个空间变化的对称正定 (SPD) 传导率张量。在有限元法 (FEM) 中，单个四边形单元上的单元刚度矩阵对离散化该方程弱形式的全局系统有贡献。\n\n关注一个单一的等参双线性四边形单元 ($Q_1$)，其节点位于物理坐标 $\\{\\mathbf{x}_a\\}_{a=1}^4$，相应的双线性形函数 $\\{N_a(\\xi,\\eta)\\}_{a=1}^4$ 定义在局部坐标为 $(\\xi,\\eta)$ 的参考正方形 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 上。等参映射定义为 $\\mathbf{x}(\\xi,\\eta) = \\sum_{a=1}^4 N_a(\\xi,\\eta)\\,\\mathbf{x}_a$。该映射的雅可比矩阵为 $\\mathbf{J}(\\xi,\\eta) = \\dfrac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)}$，链式法则通过 $\\nabla N_a = \\mathbf{J}^{-T} \\,\\hat{\\nabla} N_a$ 将形函数的物理梯度与参考梯度关联起来，其中 $\\hat{\\nabla}$ 表示关于 $(\\xi,\\eta)$ 的梯度。\n\n您需要选择一个选项，该选项为这个 $\\mathbf{K}(\\mathbf{x})$ 空间变化且各向异性的 $Q_1$ 单元正确地建立了 $4\\times 4$ 单元刚度矩阵的积分表达式，并正确陈述了一个数值上合理的计算过程，该过程使用 $\\hat{\\Omega}$ 上适当的张量积高斯-勒让德求积法来评估该表达式。\n\n哪个选项给出了正确的表达式和计算步骤？\n\nA. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\det\\mathbf{J}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$，其中 $\\nabla N_i = \\mathbf{J}^{-T}\\hat{\\nabla}N_i$ 且 $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$。过程：选择阶数至少为 $2\\times 2$ 的张量积高斯-勒让德点 $\\{(\\xi_g,\\eta_g),w_g^\\xi,w_g^\\eta\\}$ （如果 $\\mathbf{K}$ 变化剧烈，则增加阶数），对每个点计算 $\\hat{\\nabla}N_i(\\xi_g,\\eta_g)$、$\\mathbf{J}(\\xi_g,\\eta_g)$、$\\det\\mathbf{J}(\\xi_g,\\eta_g)$、$\\nabla N_i(\\xi_g,\\eta_g)$，求值 $\\mathbf{K}\\big(\\mathbf{x}(\\xi_g,\\eta_g)\\big)$，构造 $\\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j$，并在所有点上累加 $k_{ij}^e \\mathrel{+}= \\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j\\,\\det\\mathbf{J}\\,w_g^\\xi w_g^\\eta$。\n\nB. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}_c\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$，其中 $\\mathbf{x}_c$ 是单元中心。过程：使用位于 $(\\xi,\\eta)=(0,0)$ 的单个高斯点，权重为 $4$，在 $\\mathbf{x}_c$ 处计算 $\\mathbf{K}$，并计算 $k_{ij}^e = 4\\,\\big(\\hat{\\nabla} N_i(0,0)\\big)^{T}\\,\\mathbf{K}(\\mathbf{x}_c)\\,\\hat{\\nabla} N_j(0,0)$。\n\nC. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$，其中 $\\nabla N_i = \\mathbf{J}^{T}\\hat{\\nabla}N_i$ 且 $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$。过程：选择 $2\\times 2$ 高斯-勒让德点，仅在 $(\\xi,\\eta)=(0,0)$ 处计算一次 $\\mathbf{J}$ 并在所有点上重复使用，在每个映射点上计算 $\\mathbf{K}$，并不带 $\\det\\mathbf{J}$ 因子累加 $k_{ij}^e$。\n\nD. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\big(\\mathbf{J}^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\mathbf{J}\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。过程：为提高效率，使用 $1\\times 1$ 阶的张量积高斯-勒让德求积法，在单个高斯点上计算 $\\mathbf{J}$ 和 $\\mathbf{K}$，构造上面的内积，并与求积权重相加；不需要行列式项，因为变换已嵌入在 $\\mathbf{J}^{T}\\mathbf{K}\\mathbf{J}$ 中。\n\n选择正确的选项。",
            "solution": "### 问题验证\n\n#### 步骤1：提取已知信息\n\n问题陈述提供了以下信息：\n1.  **控制方程**：二维稳态扩散方程，在非均匀各向异性介质中为 $-\\nabla \\cdot (\\mathbf{K}(\\mathbf{x}) \\nabla u) = f$。\n2.  **域**：问题定义在域 $\\Omega \\subset \\mathbb{R}^2$ 上。\n3.  **传导率张量**：$\\mathbf{K}(\\mathbf{x})$ 是一个空间变化的对称正定 (SPD) 张量。\n4.  **离散化方法**：使用有限元法 (FEM)。\n5.  **单元类型**：考虑单个等参双线性四边形单元 ($Q_1$)。\n6.  **节点坐标**：单元节点位于物理坐标 $\\{\\mathbf{x}_a\\}_{a=1}^4$。\n7.  **形函数**：双线性形函数 $\\{N_a(\\xi,\\eta)\\}_{a=1}^4$ 定义在参考正方形 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 上，局部坐标为 $(\\xi,\\eta)$。\n8.  **等参映射**：从参考坐标到物理坐标的映射为 $\\mathbf{x}(\\xi,\\eta) = \\sum_{a=1}^4 N_a(\\xi,\\eta)\\,\\mathbf{x}_a$。\n9.  **雅可比矩阵**：映射的雅可比矩阵为 $\\mathbf{J}(\\xi,\\eta) = \\dfrac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)}$。\n10. **梯度的链式法则**：形函数的物理梯度 ($\\nabla$) 和参考梯度 ($\\hat{\\nabla}$) 之间的关系由 $\\nabla N_a = \\mathbf{J}^{-T} \\,\\hat{\\nabla} N_a$ 给出。\n\n#### 步骤2：使用提取的已知信息进行验证\n\n问题陈述描述了有限元法在二阶椭圆型偏微分方程上的一个标准应用。\n-   **科学上成立**：该问题根植于连续介质力学（扩散）和数值分析（FEM）的基本原理。该控制方程是热传导、多孔介质中的流体流动以及静电学的标准模型。等参四边形单元的使用是有限元文献中的一个经典课题。所有要素在科学上都是合理的。\n-   **适定的**：该问题要求给出单元刚度矩阵的正确表达式和计算过程。在有限元理论的背景下，这是一个明确定义的问题。给定输入，存在唯一且正确的表达式。\n-   **客观性**：语言精确、数学化，没有任何主观或模糊的术语。所有术语（$\\mathbf{K}$、$Q_1$ 单元、等参映射、雅可比矩阵）都是该领域的标准术语。\n-   **完整性**：问题提供了推导单元刚度矩阵所需的所有必要信息。$\\mathbf{K}$ 的性质、单元类型、映射以及梯度之间的关系都已指定。\n\n问题陈述没有违反任何无效标准。它是计算科学与工程领域一个形式良好、标准的问题。\n\n#### 步骤3：结论与行动\n\n问题陈述是**有效的**。开始解答。\n\n### 单元刚度矩阵的推导\n\n解答从控制偏微分方程 $-\\nabla \\cdot (\\mathbf{K} \\nabla u) = f$ 的弱形式开始。为了找到弱形式，我们乘以一个合适的测试函数 $v$（与 $u$ 来自同一空间）并在域 $\\Omega$ 上积分。\n\n$$ -\\int_{\\Omega} v \\, \\nabla \\cdot (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} v f \\, \\mathrm{d}\\mathbf{x} $$\n\n对左侧应用格林第一恒等式（多维分部积分）：\n\n$$ \\int_{\\Omega} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} - \\int_{\\partial \\Omega} v (\\mathbf{K} \\nabla u) \\cdot \\mathbf{n} \\, \\mathrm{d}s = \\int_{\\Omega} v f \\, \\mathrm{d}\\mathbf{x} $$\n\n这里，$\\mathbf{n}$ 是边界 $\\partial \\Omega$ 上的外单位法向量。边界积分项通过应用边界条件来处理。单元刚度矩阵源于左侧的双线性形式，$a(v,u) = \\int_{\\Omega} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x}$。\n\n在有限元法中，域 $\\Omega$ 被划分为单元 $\\Omega_e$。总积分是每个单元上积分的总和：\n\n$$ a(v,u) = \\sum_e \\int_{\\Omega_e} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} $$\n\n在单个单元 $\\Omega_e$ 内，解 $u$ 和测试函数 $v$ 使用形函数 $N_a$ 进行近似：\n$u^e(\\mathbf{x}) = \\sum_{j=1}^4 u_j N_j(\\mathbf{x})$ 和 $v^e(\\mathbf{x}) = \\sum_{i=1}^4 v_i N_i(\\mathbf{x})$，其中 $u_j$ 和 $v_i$ 是节点值。\n\n将这些近似值代入单个单元上的积分中：\n\n$$ a^e(v^e, u^e) = \\int_{\\Omega_e} \\left(\\nabla \\sum_{i=1}^4 v_i N_i\\right)^T \\mathbf{K} \\left(\\nabla \\sum_{j=1}^4 u_j N_j\\right) \\, \\mathrm{d}\\mathbf{x} $$\n$$ = \\sum_{i=1}^4 \\sum_{j=1}^4 v_i u_j \\int_{\\Omega_e} (\\nabla N_i)^T \\mathbf{K} (\\nabla N_j) \\, \\mathrm{d}\\mathbf{x} $$\n\n$4 \\times 4$ 单元刚度矩阵的第 $(i,j)$ 个条目，记为 $k_{ij}^e$，是该积分项：\n\n$$ k_{ij}^e = \\int_{\\Omega_e} (\\nabla N_i)^T \\mathbf{K}(\\mathbf{x}) (\\nabla N_j) \\, \\mathrm{d}\\mathbf{x} $$\n\n该积分是在物理单元域 $\\Omega_e$ 上进行的。为了计算，必须将其变换到参考正方形 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 上。这需要变量替换，$\\mathbf{x} \\to (\\xi, \\eta)$。微分面积元变换为 $\\mathrm{d}\\mathbf{x} = \\det(\\mathbf{J}) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$。物理梯度 $\\nabla N_a$ 是参考梯度 $\\hat{\\nabla} N_a$ 的函数，通过所述的链式法则：$\\nabla N_a = \\mathbf{J}^{-T} \\hat{\\nabla} N_a$。\n\n将这些变换代入 $k_{ij}^e$ 的表达式中：\n\n$$ k_{ij}^e = \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\Big(\\nabla N_i\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\Big)^T \\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big) \\Big(\\nabla N_j\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\Big) \\det\\mathbf{J}(\\xi,\\eta) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta $$\n\n这是单元刚度矩阵条目的基本表达式，在参考单元上积分。为了进行数值评估，该积分使用数值求积法进行近似，对于这种几何形状，通常使用高斯-勒让德求积法。\n\n被积函数为 $I(\\xi, \\eta) = (\\nabla N_i)^T \\mathbf{K} (\\nabla N_j) \\det(\\mathbf{J})$。对于一般的非平行四边形四边形，雅可比矩阵 $\\mathbf{J}$ 是 $(\\xi, \\eta)$ 的函数。其分量在 $\\xi$ 和 $\\eta$ 中是线性的。因此，$\\det(\\mathbf{J})$ 是一个最高为2次的多项式。物理梯度是 $\\nabla N_i = \\mathbf{J}^{-T} \\hat{\\nabla} N_i$，其分量是 $(\\xi, \\eta)$ 的有理函数（多项式除以 $\\det(\\mathbf{J})$）。此外，传导率张量 $\\mathbf{K}(\\mathbf{x}(\\xi, \\eta))$ 也是 $(\\xi, \\eta)$ 的函数。因此，被积函数通常是一个复杂的有理函数，而不是一个简单的多项式。\n数值求积是通过将在高斯点集 $\\{(\\xi_g, \\eta_g)\\}$ 上计算的被积函数值乘以相应的权重 $w_g$ 进行求和来执行的：\n\n$$ k_{ij}^e \\approx \\sum_g \\Big[ \\Big(\\nabla N_i\\Big)^T \\mathbf{K} \\Big(\\nabla N_j\\Big) \\det(\\mathbf{J}) \\Big]_{(\\xi_g, \\eta_g)} w_g $$\n\n对于张量积点网格，$w_g = w_g^\\xi w_g^\\eta$。\n\n### 逐项分析\n\n**A. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\det\\mathbf{J}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$，其中 $\\nabla N_i = \\mathbf{J}^{-T}\\hat{\\nabla}N_i$ 且 $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$。过程：选择阶数至少为 $2\\times 2$ 的张量积高斯-勒让德点 $\\{(\\xi_g,\\eta_g),w_g^\\xi,w_g^\\eta\\}$ （如果 $\\mathbf{K}$ 变化剧烈，则增加阶数），对每个点计算 $\\hat{\\nabla}N_i(\\xi_g,\\eta_g)$、$\\mathbf{J}(\\xi_g,\\eta_g)$、$\\det\\mathbf{J}(\\xi_g,\\eta_g)$、$\\nabla N_i(\\xi_g,\\eta_g)$，求值 $\\mathbf{K}\\big(\\mathbf{x}(\\xi_g,\\eta_g)\\big)$，构造 $\\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j$，并在所有点上累加 $k_{ij}^e \\mathrel{+}= \\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j\\,\\det\\mathbf{J}\\,w_g^\\xi w_g^\\eta$。**\n\n-   **积分表达式**：$k_{ij}^e$ 的公式与变换变量到参考单元后正确推导出的表达式完全匹配。\n-   **定义**：为 $\\nabla N_i$ 和等参映射提供的定义是正确的。\n-   **过程**：所描述的计算过程是标准且正确的算法。它正确地指出，所有依赖于 $(\\xi, \\eta)$ 的量（即 $\\hat{\\nabla}N_i$、$\\mathbf{J}$、$\\det\\mathbf{J}$、$\\mathbf{K}$）都必须在每个高斯点上计算。使用 $2 \\times 2$ 高斯求积法则是双线性四边形的标准做法，因为它能精确积分平行四边形的质量矩阵并通过了分片检验，从而保证了收敛性。对于扭曲单元或变化剧烈的 $\\mathbf{K}$，建议增加阶数以保持精度，这是一种合理的数值实践。累加步骤的表述也是正确的。\n\n该选项完全正确。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在模拟波传播时，一个关键挑战是控制数值频散，这是一种计算出的波速错误地依赖于波长和相对于网格的传播方向的人为现象。本练习  通过一个数值实验，深入比较了线性三角形（$P_1$）和双线性四边形（$Q_1$）单元的性能，计算并比较了它们的频散误差。通过组装刚度矩阵和质量矩阵并应用布洛赫-弗洛凯（Bloch-Floquet）分析，您将更深入地理解单元选择如何影响地球物理波模拟的保真度。",
            "id": "3572395",
            "problem": "考虑一个具有恒定各向异性剪切刚度的二维反平面剪切（平面外）弹性波方程，这是计算地球物理学中用于弹性剪切水平波传播的标准标量代理模型。设 $u(x,y,t)$ 为均匀介质中的平面外位移，该介质的密度为 $\\rho0$，各向异性张量 $\\mathbf{A}\\in\\mathbb{R}^{2\\times 2}$ 为对称正定张量。控制方程为\n$$\n\\rho\\,\\partial_{tt} u \\;=\\; \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)\\,,\n$$\n其中 $\\mathbf{A}=\\begin{bmatrix} a_{11}  a_{12} \\\\ a_{12}  a_{22}\\end{bmatrix}$ 为常数。对于形式为 $u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$ 的平面波，其波矢为 $\\mathbf{k}=k\\,\\mathbf{n}(\\theta)$，其中 $\\mathbf{n}(\\theta)=[\\cos\\theta,\\sin\\theta]^T$，$\\theta$ 是以弧度为单位的传播方向，根据第一性原理可以导出精确色散关系为\n$$\n\\omega^2 \\;=\\; \\frac{k^2}{\\rho}\\;\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)\\,,\n$$\n精确相速度为 $c(\\theta)=\\omega/k=\\sqrt{\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)/\\rho}$。\n\n我们旨在比较两种标准的二维有限元离散化方法在单位正方形周期晶胞 $\\Omega=[0,1]\\times[0,1]$ 上的数值色散（方向相速度）：\n- 在由沿对角线分割单位正方形的两个三角形组成的网格上使用线性三角形单元（$P_1$），节点位于 $(0,0)$、$(1,0)$、$(1,1)$ 和 $(0,1)$。\n- 在具有相同四个角节点的单位正方形上使用双线性四边形单元（$Q_1$）。\n\n设晶胞尺寸 $h=1$。使用标准的 Galerkin 方法和一致质量矩阵。对于 $P_1$ 单元，使用线性三角形的精确解析单元矩阵。对于 $Q_1$ 单元，在参考正方形上使用精确的 $2\\times 2$ Gauss 求积来组装单元矩阵。为每种单元类型在周期晶胞上组装全局 $4\\times 4$ 刚度矩阵 $\\mathbf{K}$ 和质量矩阵 $\\mathbf{M}$。\n\n在单位晶胞上施加具有准周期边界条件的 Bloch 周期性：如果 $\\boldsymbol{\\xi}=k\\,\\mathbf{n}(\\theta)$ 是无量纲波矢（$h=1$），则周期映像处的节点值相差一个相位因子 $\\exp(i\\,\\boldsymbol{\\xi}\\cdot\\mathbf{T})$，其中 $\\mathbf{T}$ 是晶格平移。对于按 $\\{(0,0),(1,0),(1,1),(0,1)\\}$ 顺序排列的四个节点，将四个节点未知数映射到单个复振幅的 Bloch 振幅矢量为\n$$\n\\mathbf{v}(\\boldsymbol{\\xi}) \\;=\\; \\begin{bmatrix}1 \\\\ e^{i\\,\\xi_x} \\\\ e^{i\\,(\\xi_x+\\xi_y)} \\\\ e^{i\\,\\xi_y}\\end{bmatrix}\\,,\n$$\n其中 $\\boldsymbol{\\xi}=[\\xi_x,\\xi_y]^T=[k\\cos\\theta,\\,k\\sin\\theta]^T$。半离散色散关系由广义 Rayleigh 商得出\n$$\n\\omega_h^2(\\boldsymbol{\\xi}) \\;=\\; \\frac{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})}{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi})}\\,,\n$$\n其中 $^{\\ast}$ 表示复共轭转置。\n\n在固定 $k$ 和方向 $\\theta$ 下，数值相速度定义为 $c_h(\\theta;k)=\\omega_h(\\boldsymbol{\\xi})/k$。或者，在固定角频率 $\\omega$ 和方向 $\\theta$ 下，通过求解 $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$ 隐式定义数值波数 $k_h(\\theta;\\omega)$。给定某个参考波数大小 $k_0$ 下的精确目标角频率 $\\omega=c(\\theta)\\,k_0$，一个关键的误差度量是在固定 $\\omega$ 下的相对相速度误差：\n$$\n\\varepsilon(\\theta;k_0) \\;=\\; \\frac{c_h(\\theta;\\omega)-c(\\theta)}{c(\\theta)} \\;=\\; \\frac{k_0}{k_h(\\theta;\\omega)}-1\\,.\n$$\n\n您的任务是：\n1) 从控制方程和平面波拟设出发，推导精确色散关系和作为方向 $\\theta$ 与各向异性张量 $\\mathbf{A}$ 的函数的相速度 $c(\\theta)$。\n2) 推导单位晶胞上 $P_1$ 和 $Q_1$ 单元的有限元半离散形式，用单元贡献表示全局矩阵 $\\mathbf{K}$ 和 $\\mathbf{M}$。清楚地说明 Bloch 周期性如何将问题简化为上面给出的 Rayleigh 商。\n3) 使用推导出的公式，实现一个程序，对于给定的对称正定 $\\mathbf{A}$ 和密度 $\\rho$，为每个单元族计算方向数值波数 $k_h(\\theta;\\omega)$，该波数是方程 $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$（其中 $\\omega=c(\\theta)\\,k_0$）的解，并评估在均匀间隔角度上采样的相对误差 $\\varepsilon(\\theta;k_0)$ 在 $\\theta\\in[0,2\\pi)$ 上的最大绝对值。\n\n科学和数值要求：\n- 使用 $h=1$ 和无量纲单位；角度 $\\theta$ 以弧度为单位。\n- 对 $P_1$ 和 $Q_1$ 单元均使用一致质量矩阵。\n- 对于 $Q_1$，使用精确的 $2\\times 2$ Gauss 求积来组装单元矩阵。\n- 对于 $P_1$，使用线性三角形的精确解析表达式。\n- 使用如上所述的 Bloch 振幅矢量 $\\mathbf{v}(\\boldsymbol{\\xi})$。\n- 对于每个 $\\theta$，通过在 $k\\in(0,\\pi)$ 上使用稳健的区间法求解标量非线性方程 $\\omega_h\\big(k\\,\\mathbf{n}(\\theta)\\big)=\\omega$ 来计算 $k_h(\\theta;\\omega)$。\n- 以 $N_\\theta=16$ 个方向均匀采样 $\\theta$：$\\theta_m=2\\pi m/N_\\theta$，其中 $m=0,1,\\dots,15$。\n\n测试套件和要求输出：\n对以下三个测试用例中的每一个，评估在 16 个方向上的最大绝对相对相速度误差。在所有情况下，均使用 $\\rho=1$ 和相同的各向异性张量 $\\mathbf{A}=\\begin{bmatrix}4  1 \\\\ 1  2\\end{bmatrix}$。对于每个测试用例 $j$，按如下方式定义 $k_0^{(j)}$：\n- 测试 1（理想路径）：$k_0^{(1)}=\\pi/12$。\n- 测试 2（中等波数）：$k_0^{(2)}=\\pi/6$。\n- 测试 3（更靠近布里渊区边界）：$k_0^{(3)}=\\pi/3$。\n\n对于每个测试用例，计算两个浮点数结果：\n- $E_{P_1}^{(j)}=\\max_{m}|\\varepsilon_{P_1}(\\theta_m;k_0^{(j)})|$,\n- $E_{Q_1}^{(j)}=\\max_{m}|\\varepsilon_{Q_1}(\\theta_m;k_0^{(j)})|$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表，按顺序包含六个浮点数\n$$\n\\big[E_{P_1}^{(1)},\\;E_{Q_1}^{(1)},\\;E_{P_1}^{(2)},\\;E_{Q_1}^{(2)},\\;E_{P_1}^{(3)},\\;E_{Q_1}^{(3)}\\big]\\,.\n$$\n所有六个数字都是无量纲的。不应打印任何额外的文本或格式。",
            "solution": "该问题要求首先进行验证，然后提供一个全面的解决方案，以分析二维反平面剪切波方程的有限元方法的数值色散。\n\n### 问题验证\n**步骤 1：提取的已知条件**\n-   **控制方程**：$\\rho\\,\\partial_{tt} u \\;=\\; \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)$\n-   **参数**：密度 $\\rho0$，恒定对称正定各向异性张量 $\\mathbf{A}=\\begin{bmatrix} a_{11}  a_{12} \\\\ a_{12}  a_{22}\\end{bmatrix}$。\n-   **平面波**：$u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$，其中 $\\mathbf{k}=k\\,\\mathbf{n}(\\theta)$ 且 $\\mathbf{n}(\\theta)=[\\cos\\theta,\\sin\\theta]^T$。\n-   **精确色散关系**：$\\omega^2 = \\frac{k^2}{\\rho}\\;\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)$。\n-   **精确相速度**：$c(\\theta)=\\sqrt{\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)/\\rho}$。\n-   **离散化域**：单位正方形周期晶胞 $\\Omega=[0,1]\\times [0,1]$，晶胞尺寸 $h=1$。\n-   **单元类型**：线性三角形（$P_1$）和双线性四边形（$Q_1$）。节点位于 $(0,0), (1,0), (1,1), (0,1)$。$P_1$ 网格沿从 $(0,0)$ 到 $(1,1)$ 的对角线分割正方形。\n-   **数值方法**：Galerkin 方法，使用一致质量矩阵。$Q_1$ 矩阵使用 $2\\times 2$ Gauss 求积组装。$P_1$ 矩阵来自精确解析公式。\n-   **周期性**：Bloch 周期性，节点 $\\{(0,0),(1,0),(1,1),(0,1)\\}$ 的 Bloch 振幅矢量为 $\\mathbf{v}(\\boldsymbol{\\xi}) = [1, e^{i\\,\\xi_x}, e^{i\\,(\\xi_x+\\xi_y)}, e^{i\\,\\xi_y}]^T$，其中 $\\boldsymbol{\\xi}=k\\,\\mathbf{n}(\\theta)$。\n-   **半离散色散**：$\\omega_h^2(\\boldsymbol{\\xi}) = (\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})) / (\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi}))$。\n-   **误差度量**：相对相速度误差 $\\varepsilon(\\theta;k_0) = k_0/k_h(\\theta;\\omega)-1$，其中 $k_h$ 求解 $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$，目标频率为 $\\omega=c(\\theta)\\,k_0$。\n-   **数值评估**：使用稳健的区间法在 $(0,\\pi)$ 内求解 $k_h$。采样 $N_\\theta=16$ 个方向 $\\theta_m=2\\pi m/N_\\theta$。\n-   **测试套件**：$\\rho=1$, $\\mathbf{A}=\\begin{bmatrix}4  1 \\\\ 1  2\\end{bmatrix}$。三个测试用例，$k_0$ 分别为 $\\pi/12, \\pi/6, \\pi/3$。\n-   **输出**：每个测试用例和单元类型的最大绝对误差，共 6 个值。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，描述了一个标准的物理模型（各向异性波传播）及其使用标准数值方法（有限元法）的分析。数值色散、Bloch-Floquet 理论和误差分析等概念都已非常成熟。所提供的各向异性张量 $\\mathbf{A}$ 是对称的，由于其行列式为 $4\\times 2 - 1^2 = 7  0$ 且其一阶主子式为 $4  0$，因此它如物理上所要求的是正定的。该问题是适定的，提供了所有必要的定义、参数和步骤，以得到一个唯一的、可计算的结果。语言客观且无歧义。该问题不违反任何无效标准。\n\n**步骤 3：结论与行动**\n该问题有效。下面是一个完整的解决方案。\n\n---\n\n### 基于原理的解决方案\n\n解决方案按要求分为三个部分呈现：精确色散关系的推导、有限元半离散形式的推导以及数值实现的纲要。\n\n**1. 精确色散关系**\n\n控制偏微分方程为 $\\rho\\,\\partial_{tt} u = \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)$。我们代入平面波拟设 $u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$。\n时间和空间导数为：\n-   $\\partial_{tt} u = (-i\\omega)^2 u = -\\omega^2 u$\n-   $\\nabla u = i\\mathbf{k} u$\n-   $\\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big) = \\nabla\\cdot\\big(i\\mathbf{A}\\mathbf{k} u\\big) = (i\\mathbf{k})\\cdot(i\\mathbf{A}\\mathbf{k} u) = -\\big(\\mathbf{k}^T\\mathbf{A}\\mathbf{k}\\big) u$，因为 $\\mathbf{A}$ 是常数。\n\n将这些代入控制方程得到：\n$$\n\\rho(-\\omega^2 u) = -(\\mathbf{k}^T\\mathbf{A}\\mathbf{k}) u\n$$\n对于非平凡解（$u \\neq 0$），我们得到色散关系：\n$$\n\\rho\\omega^2 = \\mathbf{k}^T\\mathbf{A}\\mathbf{k}\n$$\n使用波矢 $\\mathbf{k} = k\\,\\mathbf{n}(\\theta)$，这变为 $\\rho\\omega^2 = k^2\\,\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta)$。因此，相速度 $c(\\theta) = \\omega/k$（对于 $\\omega, k  0$）为：\n$$\nc(\\theta) = \\sqrt{\\frac{\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta)}{\\rho}}\n$$\n使用 $\\mathbf{n}(\\theta)=[\\cos\\theta, \\sin\\theta]^T$ 和 $\\mathbf{A}=\\begin{bmatrix} a_{11}  a_{12} \\\\ a_{12}  a_{22}\\end{bmatrix}$ 展开二次型：\n$$\n\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta) = a_{11}\\cos^2\\theta + 2a_{12}\\cos\\theta\\sin\\theta + a_{22}\\sin^2\\theta\n$$\n这完成了精确相速度的推导。\n\n**2. 有限元半离散形式**\n\n在域 $\\Omega$ 上，控制方程的弱形式通过乘以一个测试函数 $v$ 并积分得到，结果为 $\\mathbf{M}\\ddot{\\mathbf{u}} + \\mathbf{K}\\mathbf{u} = \\mathbf{0}$，其中节点矢量 $\\mathbf{u}(t)$ 和 $\\ddot{\\mathbf{u}}(t)$ 分别包含自由度和它们的加速度。全局质量矩阵 $\\mathbf{M}$ 和刚度矩阵 $\\mathbf{K}$ 由下式给出：\n$$\nM_{ij} = \\int_\\Omega \\rho N_i N_j \\, d\\Omega, \\quad K_{ij} = \\int_\\Omega (\\nabla N_i)^T \\mathbf{A} (\\nabla N_j) \\, d\\Omega\n$$\n其中 $N_i$ 是全局形函数。这些矩阵由单元级的贡献组装而成。\n\n**$P_1$ 三角形单元：**\n单位正方形被划分为两个三角形，T1（节点 1,2,3，位于 $(0,0), (1,0), (1,1)$）和 T2（节点 1,3,4，位于 $(0,0), (1,1), (0,1)$）。每个三角形的面积为 $A = 1/2$。对于线性三角形，形函数的梯度是恒定的。\n\n对于顶点为 $(0,0), (1,0), (1,1)$ 的 T1，形函数梯度矩阵为 $\\mathbf{B}^1 = [\\nabla N^1_1, \\nabla N^1_2, \\nabla N^1_3] = \\begin{bmatrix} -1  1  0 \\\\ 0  -1  1 \\end{bmatrix}$。单元刚度矩阵为 $K^1 = A \\cdot (\\mathbf{B}^1)^T \\mathbf{A} \\mathbf{B}^1$：\n$$\nK^1 = \\frac{1}{2} \\begin{bmatrix} a_{11}  -a_{11}+a_{12}  -a_{12} \\\\ -a_{11}+a_{12}  a_{11}-2a_{12}+a_{22}  a_{12}-a_{22} \\\\ -a_{12}  a_{12}-a_{22}  a_{22} \\end{bmatrix}\n$$\n对于顶点为 $(0,0), (1,1), (0,1)$ 的 T2，其局部节点映射到全局节点 1,3,4 的梯度矩阵为 $\\mathbf{B}^2 = [\\nabla N^2_1, \\nabla N^2_3, \\nabla N^2_4] = \\begin{bmatrix} 0  1  -1 \\\\ -1  0  1 \\end{bmatrix}$。单元刚度矩阵为 $K^2 = A \\cdot (\\mathbf{B}^2)^T \\mathbf{A} \\mathbf{B}^2$：\n$$\nK^2 = \\frac{1}{2} \\begin{bmatrix} a_{22}  -a_{12}  a_{12}-a_{22} \\\\ -a_{12}  a_{11}  -a_{11}+a_{12} \\\\ a_{12}-a_{22}  -a_{11}+a_{12}  a_{11}-2a_{12}+a_{22} \\end{bmatrix}\n$$\n线性三角形的一致单元质量矩阵为 $M^e = \\frac{\\rho A}{12} \\begin{bmatrix} 2  1  1 \\\\ 1  2  1 \\\\ 1  1  2 \\end{bmatrix} = \\frac{\\rho}{24} \\begin{bmatrix} 2  1  1 \\\\ 1  2  1 \\\\ 1  1  2 \\end{bmatrix}$。\n\n$4\\times 4$ 的全局矩阵 $\\mathbf{K}_P$ 和 $\\mathbf{M}_P$ 通过组装来自 $K^1, M^1$（作用于节点 1,2,3）和 $K^2, M^2$（作用于节点 1,3,4）的贡献而形成。\n\n**$Q_1$ 四边形单元：**\n单位正方形是一个单一的 $Q_1$ 单元，节点 1,2,3,4 位于 $(0,0), (1,0), (1,1), (0,1)$。形函数为 $N_1=(1-x)(1-y)$，$N_2=x(1-y)$，$N_3=xy$，$N_4=(1-x)y$。单元矩阵 $\\mathbf{K}_Q$ 和 $\\mathbf{M}_Q$ 通过在单元域 $[0,1]\\times[0,1]$ 上进行数值求积来计算。按规定，我们使用 $2\\times 2$ 张量积 Gauss-Legendre 求积法则，这对这些双线性单元是精确的。\n$$\n\\mathbf{K}_Q = \\sum_{q=1}^4 w_q (\\mathbf{B}(\\mathbf{x}_q))^T \\mathbf{A} \\mathbf{B}(\\mathbf{x}_q), \\quad \\mathbf{M}_Q = \\rho \\sum_{q=1}^4 w_q \\mathbf{N}(\\mathbf{x}_q)^T \\mathbf{N}(\\mathbf{x}_q)\n$$\n其中 $\\mathbf{x}_q, w_q$ 是求积点和权重，$\\mathbf{N}$ 是形函数矢量，$\\mathbf{B}=[\\nabla N_1, \\dots, \\nabla N_4]$ 是形函数梯度矩阵。\n\n**Bloch 周期性与数值色散：**\n假设节点值的谐波解为 $\\mathbf{u}(t) = \\mathbf{U} e^{-i\\omega_h t}$，我们得到一个广义特征值问题 $\\mathbf{K}\\mathbf{U} = \\omega_h^2\\mathbf{M}\\mathbf{U}$。Bloch-Floquet 定理规定，对于周期结构，解必须是 $\\mathbf{U} \\propto \\mathbf{v}(\\boldsymbol{\\xi})$ 的形式，其中 $\\mathbf{v}(\\boldsymbol{\\xi})$ 是问题中指定的 Bloch 振幅矢量。将此代入特征值问题并构造 Rayleigh 商，得到标量数值色散关系：\n$$\n\\omega_h^2(\\boldsymbol{\\xi}) = \\frac{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})}{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi})}\n$$\n\n**3. 数值误差分析**\n\n最后的任务是计算最大相对相速度误差。对于 $N_\\theta=16$ 个传播方向 $\\theta_m$ 中的每一个，以及由 $k_0$ 定义的每个测试用例，我们执行以下步骤：\n1.  计算精确相速度 $c(\\theta_m)$ 和目标角频率 $\\omega = c(\\theta_m) k_0$。\n2.  定义一个残差函数 $f(k) = \\omega_h^2(k\\mathbf{n}(\\theta_m)) - \\omega^2$。\n3.  使用区间求根器（例如 Brent 方法）在区间 $(0, \\pi)$ 上求解标量非线性方程 $f(k) = 0$，得到数值波数 $k_h(\\theta_m; \\omega)$。该区间是合适的，因为 $\\omega_h(k=0)=0$（确保对于 $k_00$ 时 $f(0)  0$），而 $k=\\pi$ 对应于尺寸为 $h=1$ 的网格的奈奎斯特波数。\n4.  计算相对误差 $\\varepsilon(\\theta_m;k_0) = k_0/k_h - 1$。\n5.  对于给定的单元类型和 $k_0$，最终结果是这些误差在所有 $m=0, \\dots, 15$ 上的绝对值的最大值。对 $P_1$ 和 $Q_1$ 单元在所有三个测试用例中重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef get_p1_matrices(a11, a12, a22, rho):\n    \"\"\"\n    Computes the global stiffness and mass matrices for P1 triangular elements\n    on a unit square split along the main diagonal.\n    \"\"\"\n    # Stiffness matrix for triangle 1 (nodes 1,2,3)\n    K1 = 0.5 * np.array([\n        [a11, -a11 + a12, -a12],\n        [-a11 + a12, a11 - 2 * a12 + a22, a12 - a22],\n        [-a12, a12 - a22, a22]\n    ])\n    \n    # Stiffness matrix for triangle 2 (nodes 1,3,4)\n    # Local node order maps to global 1,3,4\n    K2 = 0.5 * np.array([\n        [a22, -a12, a12 - a22],\n        [-a12, a11, -a11 + a12],\n        [a12 - a22, -a11 + a12, a11 - 2 * a12 + a22]\n    ])\n    \n    K_P = np.zeros((4, 4))\n    # Python indices for nodes are 0,1,2,3.\n    # T1 nodes (1,2,3) - indices (0,1,2)\n    K_P[np.ix_([0, 1, 2], [0, 1, 2])] += K1\n    # T2 nodes (1,3,4) - indices (0,2,3)\n    K_P[np.ix_([0, 2, 3], [0, 2, 3])] += K2\n    \n    # Consistent mass matrix for a linear triangle (Area=0.5)\n    M_elem = (rho * 0.5 / 12.0) * np.array([\n        [2, 1, 1],\n        [1, 2, 1],\n        [1, 1, 2]\n    ])\n    \n    M_P = np.zeros((4, 4))\n    # Assemble mass matrices for T1 and T2\n    M_P[np.ix_([0, 1, 2], [0, 1, 2])] += M_elem\n    M_P[np.ix_([0, 2, 3], [0, 2, 3])] += M_elem\n    \n    return K_P, M_P\n\ndef get_q1_matrices(A, rho):\n    \"\"\"\n    Computes the stiffness and mass matrices for a Q1 bilinear quadrilateral\n    element on the unit square using 2x2 Gauss quadrature.\n    \"\"\"\n    # Gauss points and weights for the interval [0,1]\n    gp = 0.5 * (1.0 - 1.0 / np.sqrt(3)), 0.5 * (1.0 + 1.0 / np.sqrt(3))\n    w = 0.5, 0.5\n    \n    K_Q = np.zeros((4, 4))\n    M_Q = np.zeros((4, 4))\n    \n    # 2x2 quadrature loop\n    for i in range(2):\n        for j in range(2):\n            x, y = gp[i], gp[j]\n            weight = w[i] * w[j]\n            \n            # Shape functions N at (x,y)\n            N = np.array([(1-x)*(1-y), x*(1-y), x*y, (1-x)*y])\n            \n            # Gradients of shape functions dN/dx and dN/dy\n            dN_dx = np.array([-(1-y), 1-y, y, -y])\n            dN_dy = np.array([-(1-x), -x, x, 1-x])\n            \n            B = np.vstack((dN_dx, dN_dy))  # Gradient matrix B (2x4)\n            \n            K_Q += weight * B.T @ A @ B\n            M_Q += rho * weight * np.outer(N, N)\n            \n    return K_Q, M_Q\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases_k0 = [np.pi / 12.0, np.pi / 6.0, np.pi / 3.0]\n\n    # Problem constants\n    RHO = 1.0\n    A_TENSOR = np.array([[4.0, 1.0], [1.0, 2.0]])\n    N_THETA = 16\n    \n    # Pre-compute FE matrices\n    a11, a12, a22 = A_TENSOR[0, 0], A_TENSOR[0, 1], A_TENSOR[1, 1]\n    K_p1, M_p1 = get_p1_matrices(a11, a12, a22, RHO)\n    K_q1, M_q1 = get_q1_matrices(A_TENSOR, RHO)\n    \n    matrices = {'P1': (K_p1, M_p1), 'Q1': (K_q1, M_q1)}\n    \n    all_results = []\n    \n    for k0 in test_cases_k0:\n        for elem_type in ['P1', 'Q1']:\n            K, M = matrices[elem_type]\n            max_abs_error = 0.0\n            \n            angles = np.linspace(0, 2 * np.pi, N_THETA, endpoint=False)\n            \n            for theta in angles:\n                n_vec = np.array([np.cos(theta), np.sin(theta)])\n                \n                # Exact phase velocity and target frequency\n                c_sq_exact = (n_vec.T @ A_TENSOR @ n_vec) / RHO\n                c_exact = np.sqrt(c_sq_exact)\n                omega_sq_target = c_sq_exact * k0**2\n                \n                def omega_h_sq(k, n, K_mat, M_mat):\n                    if k  1e-12: return 0.0\n                    xi = k * n\n                    v = np.array([1, \n                                  np.exp(1j * xi[0]), \n                                  np.exp(1j * (xi[0] + xi[1])),\n                                  np.exp(1j * xi[1])])\n                    \n                    num = (v.conj().T @ K_mat @ v).real\n                    den = (v.conj().T @ M_mat @ v).real\n                    return num / den if den != 0 else 0.0\n\n                def residual(k):\n                    return omega_h_sq(k, n_vec, K, M) - omega_sq_target\n                \n                try:\n                    # Solve for numerical wavenumber k_h\n                    k_h = brentq(residual, 1e-9, np.pi)\n                    # Calculate relative phase velocity error\n                    error = (k0 / k_h) - 1.0\n                    if abs(error)  max_abs_error:\n                        max_abs_error = abs(error)\n                except ValueError:\n                    # This case should not occur for the given problem parameters.\n                    # It would indicate that the root is not bracketed in (0, pi).\n                    max_abs_error = np.nan\n\n            all_results.append(max_abs_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}