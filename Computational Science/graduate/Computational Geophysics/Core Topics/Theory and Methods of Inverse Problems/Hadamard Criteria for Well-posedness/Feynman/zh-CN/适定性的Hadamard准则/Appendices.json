{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将从定量的角度审视哈达玛适定性定义中的稳定性准则。通过分析一个带有加性噪声的线性反演问题，你将推导出正演算子的奇异值如何控制测量误差的放大。这个练习  揭示了为什么具有小奇异值的问题被认为是病态的，因为即使数据中存在少量噪声，也可能导致重建模型中出现巨大的误差。",
            "id": "3602516",
            "problem": "在一个源于计算地球物理学的线性反演问题中，考虑一个紧致正演算子，其在有限维中由一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 表示。该算子通过 $d = A x$ 将模型向量 $x \\in \\mathbb{R}^{n}$ 映射到数据 $d \\in \\mathbb{R}^{m}$。Moore–Penrose 伪逆 $A^{\\dagger} \\in \\mathbb{R}^{n \\times m}$ 用于通过 $x_{\\text{rec}} = A^{\\dagger} d$ 从含噪数据中重构模型。当测量噪声是加性的，即 $d = A x + \\eta$ 时，重构误差为 $e = x_{\\text{rec}} - x = A^{\\dagger} \\eta$。假设噪声 $\\eta \\in \\mathbb{R}^{m}$ 是零均值加性高斯白噪声（AWGN），其协方差为 $\\mathbb{E}[\\eta \\eta^{\\top}] = \\sigma_{\\eta}^{2} I_{m}$，其中 $I_{m}$ 是 $m \\times m$ 单位矩阵，$\\sigma_{\\eta}^{2} > 0$ 是噪声方差。将因子分解 $A = U \\Sigma V^{\\top}$ 记为奇异值分解（SVD），其中 $U \\in \\mathbb{R}^{m \\times m}$ 和 $V \\in \\mathbb{R}^{n \\times n}$ 是正交矩阵，$\\Sigma \\in \\mathbb{R}^{m \\times n}$ 的对角线上包含奇异值。设非零奇异值为 $\\{\\sigma_{k}\\}_{k=1}^{r}$，其中 $r = \\operatorname{rank}(A)$。\n\n从 Hadamard 适定性准则（存在性、唯一性和对数据的连续依赖性）的定义出发，解释 $A$ 的小奇异值如何通过重构 $A^{\\dagger} \\eta$ 中的噪声放大来影响连续依赖性准则。仅使用正交投影算子的基本性质、奇异值分解和 AWGN 的二阶矩特征，推导期望平方重构误差 $\\mathbb{E}\\|A^{\\dagger} \\eta\\|^{2}$ 关于 $\\{\\sigma_{k}\\}_{k=1}^{r}$ 和 $\\sigma_{\\eta}^{2}$ 的显式表达式。你的最终答案必须是单一的闭式解析表达式。不包含单位。无需四舍五入。",
            "solution": "问题要求解释在线性反演问题中，矩阵 $A$ 的小奇异值如何影响解的稳定性（根据 Hadamard 的适定性准则定义）。然后，它要求推导由加性噪声引起的期望平方重构误差的显式表达式。\n\n如果一个问题满足以下三个准则，则称其在 Hadamard 意义下是适定的：\n$1$. **存在性**：对于任何可接受的数据，都存在解。\n$2$. **唯一性**：解是唯一的。\n$3$. **稳定性**：解连续地依赖于数据。这意味着数据的微小变化应只导致解的微小变化。\n\n在给定的线性反演问题背景下，数据是向量 $d \\in \\mathbb{R}^{m}$，解是重构的模型向量 $x_{\\text{rec}} \\in \\mathbb{R}^{n}$。重构是通过应用 Moore-Penrose 伪逆算子给出的，$x_{\\text{rec}} = A^{\\dagger} d$。当数据被加性噪声 $\\eta$ 污染，使得 $d = Ax + \\eta$ 时，重构的模型为 $x_{\\text{rec}} = A^{\\dagger}(Ax + \\eta)$。真实模型是 $x$。部分重构误差是由噪声引起的，由 $e_{\\eta} = A^{\\dagger}\\eta$ 给出。稳定性准则关注此误差的大小 $\\|e_{\\eta}\\|$ 与数据扰动大小 $\\|\\eta\\|$ 的关系。对于一个稳定问题，一个“小”的 $\\|\\eta\\|$ 应保证一个“小”的 $\\|e_{\\eta}\\|$。\n\n矩阵 $A$ 的奇异值分解（SVD）为 $A = U \\Sigma V^{\\top}$。Moore-Penrose 伪逆则由 $A^{\\dagger} = V \\Sigma^{\\dagger} U^{\\top}$ 给出。$A^{\\dagger}$ 的奇异值是 $A$ 的非零奇异值的倒数。具体来说，如果 $\\{\\sigma_k\\}_{k=1}^{r}$ 是 $A$ 的非零奇异值，那么 $\\{1/\\sigma_k\\}_{k=1}^{r}$ 就是 $A^{\\dagger}$ 的非零奇异值。如果 $A$ 有一个或多个非常小的奇异值（$\\sigma_k \\approx 0$），那么 $A^{\\dagger}$ 将有相应的非常大的奇异值（$1/\\sigma_k \\gg 1$）。这意味着 $A^{\\dagger}$ 可以极大地放大其作用的任何向量的某些分量。在我们的例子中，噪声向量 $\\eta$ 被放大了。如果噪声具有与 $A^{\\dagger}$ 的大奇异值对应的奇异向量对齐的分量，那么即使总噪声幅度 $\\|\\eta\\|$ 很小，重构误差 $e_{\\eta}$ 也可能非常大。这种现象表明违反了稳定性准则，是不适定问题的特征。\n\n我们可以通过计算重构误差的期望平方欧几里得范数 $\\mathbb{E}\\|A^{\\dagger} \\eta\\|^{2}$ 来量化这种噪声放大。\n\n误差的平方范数由 $\\|A^{\\dagger} \\eta\\|^{2}$ 给出。我们代入伪逆的 SVD：\n$$ \\|A^{\\dagger} \\eta\\|^{2} = \\|V \\Sigma^{\\dagger} U^{\\top} \\eta\\|^{2} $$\n由于 $V \\in \\mathbb{R}^{n \\times n}$ 是一个正交矩阵，它代表一个等距变换，意味着它保持其所乘任何向量的欧几里得范数不变。也就是说，对于任何向量 $z \\in \\mathbb{R}^n$，我们有 $\\|Vz\\|^2 = (Vz)^{\\top}(Vz) = z^{\\top}V^{\\top}Vz = z^{\\top}I_n z = \\|z\\|^2$。应用此性质，我们得到：\n$$ \\|A^{\\dagger} \\eta\\|^{2} = \\|\\Sigma^{\\dagger} U^{\\top} \\eta\\|^{2} $$\n让我们定义一个变换后的噪声向量 $\\eta' \\in \\mathbb{R}^{m}$ 为 $\\eta' = U^{\\top} \\eta$。由于 $U \\in \\mathbb{R}^{m \\times m}$ 也是正交的，这个变换是噪声向量 $\\eta$ 的一个旋转。我们可以确定 $\\eta'$ 的统计特性。均值为 $\\mathbb{E}[\\eta'] = \\mathbb{E}[U^{\\top}\\eta] = U^{\\top}\\mathbb{E}[\\eta] = U^{\\top}0 = 0$。$\\eta'$ 的协方差矩阵是：\n$$ \\mathbb{E}[\\eta' (\\eta')^{\\top}] = \\mathbb{E}[(U^{\\top}\\eta)(U^{\\top}\\eta)^{\\top}] = \\mathbb{E}[U^{\\top}\\eta \\eta^{\\top}U] = U^{\\top}\\mathbb{E}[\\eta \\eta^{\\top}]U $$\n使用给定的噪声协方差 $\\mathbb{E}[\\eta \\eta^{\\top}] = \\sigma_{\\eta}^{2} I_{m}$，我们有：\n$$ \\mathbb{E}[\\eta' (\\eta')^{\\top}] = U^{\\top}(\\sigma_{\\eta}^{2} I_{m})U = \\sigma_{\\eta}^{2} U^{\\top}U = \\sigma_{\\eta}^{2} I_{m} $$\n这表明变换后的噪声向量 $\\eta'$ 具有与原始噪声 $\\eta$ 相同的统计特性：其分量不相关，均值为零，且每个分量的方差为 $\\sigma_{\\eta}^{2}$。具体来说，对于任何分量 $k$，$\\mathbb{E}[(\\eta'_{k})^{2}] = \\sigma_{\\eta}^{2}$。\n\n现在我们可以用 $\\eta'$ 来表示误差的平方范数：\n$$ \\|A^{\\dagger} \\eta\\|^{2} = \\|\\Sigma^{\\dagger} \\eta'\\|^{2} $$\n矩阵 $\\Sigma^{\\dagger} \\in \\mathbb{R}^{n \\times m}$ 的非零项位于主对角线上，即对于 $k=1, \\dots, r$，有 $(\\Sigma^{\\dagger})_{kk} = 1/\\sigma_k$，其中 $r=\\operatorname{rank}(A)$。让我们写出平方范数：\n$$ \\|\\Sigma^{\\dagger} \\eta'\\|^{2} = \\sum_{i=1}^{n} \\left( (\\Sigma^{\\dagger} \\eta')_i \\right)^2 = \\sum_{i=1}^{n} \\left( \\sum_{j=1}^{m} (\\Sigma^{\\dagger})_{ij} \\eta'_{j} \\right)^2 $$\n由于 $\\Sigma^{\\dagger}$ 的结构，向量 $\\Sigma^{\\dagger}\\eta'$ 的第 $i$ 个分量是 $(\\Sigma^{\\dagger}\\eta')_i = (1/\\sigma_i)\\eta'_i$（对于 $i \\le r$），以及 0（对于 $i > r$）。因此，求和变为：\n$$ \\|\\Sigma^{\\dagger} \\eta'\\|^{2} = \\sum_{k=1}^{r} \\left( \\frac{1}{\\sigma_k} \\eta'_{k} \\right)^2 = \\sum_{k=1}^{r} \\frac{1}{\\sigma_k^2} (\\eta'_{k})^2 $$\n现在我们对这个表达式取期望。根据期望的线性性质：\n$$ \\mathbb{E}\\|A^{\\dagger} \\eta\\|^{2} = \\mathbb{E}\\left[ \\sum_{k=1}^{r} \\frac{1}{\\sigma_k^2} (\\eta'_{k})^2 \\right] = \\sum_{k=1}^{r} \\frac{1}{\\sigma_k^2} \\mathbb{E}[(\\eta'_{k})^2] $$\n正如我们所确定的，变换后噪声的每个分量的方差是 $\\mathbb{E}[(\\eta'_{k})^2] = \\sigma_{\\eta}^{2}$。将此代入求和中：\n$$ \\mathbb{E}\\|A^{\\dagger} \\eta\\|^{2} = \\sum_{k=1}^{r} \\frac{1}{\\sigma_k^2} \\sigma_{\\eta}^{2} $$\n这就得出了期望平方重构误差的最终表达式：\n$$ \\mathbb{E}\\|A^{\\dagger} \\eta\\|^{2} = \\sigma_{\\eta}^{2} \\sum_{k=1}^{r} \\frac{1}{\\sigma_k^2} $$\n这个结果定量地证实了期望误差与噪声方差 $\\sigma_{\\eta}^2$ 成正比，并与 $A$ 的非零奇异值倒数的平方和成正比。小的奇异值 $\\sigma_k$ 会导致求和中的项 $1/\\sigma_k^2$ 很大，从而引起大的期望误差，这证明了反演的不稳定性。",
            "answer": "$$\\boxed{\\sigma_{\\eta}^{2} \\sum_{k=1}^{r} \\frac{1}{\\sigma_{k}^{2}}}$$"
        },
        {
            "introduction": "在噪声的统计视角之外，本练习将探讨不稳定性在确定性下的最坏情况。你将构造一个特定的数据扰动来最大化解的误差，从而直观地将系统的最大不稳定性与算子的最小奇异值联系起来。这个练习  将逆算子范数这一抽象概念变得更加具体，并揭示了数据空间中对扰动最为敏感的方向。",
            "id": "3602542",
            "problem": "在线性化地震走时层析成像的背景下，考虑一个离散化的、满秩的线性正演算子 $A \\in \\mathbb{R}^{N \\times N}$，它通过 $f = A m$ 将模型扰动 $m \\in \\mathbb{R}^{N}$ 映射到数据扰动 $f \\in \\mathbb{R}^{N}$。假设反演通过应用 $A^{-1}$ 从 $f$ 中恢复 $m$，因此对于一个微小的数据扰动 $\\delta f$，所诱导的模型扰动为 $\\delta m = A^{-1} \\delta f$。设 $A$ 具有奇异值分解（SVD）形式 $A = U \\Sigma V^{\\top}$，其中 $U, V \\in \\mathbb{R}^{N \\times N}$ 是正交矩阵，且 $\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\sigma_{2}, \\dots, \\sigma_{N})$，满足 $\\sigma_{1} \\geq \\sigma_{2} \\geq \\dots \\geq \\sigma_{N} > 0$。假设数据空间和模型空间均使用欧几里得范数 $\\|\\cdot\\|_{2}$。\n\n从基本原理出发，并仅使用核心定义，设计一个具有固定非零范数 $0 < \\|\\delta f\\|_{2} < \\infty$ 的最坏情况数据扰动 $\\delta f$，使得诱导的模型扰动 $\\delta m = A^{-1} \\delta f$ 与右奇异向量 $v_{N}$ 对齐，并且放大率\n$$\n\\frac{\\|A^{-1} \\delta f\\|_{2}}{\\|\\delta f\\|_{2}}\n$$\n在所有可能的数据扰动 $\\delta f \\neq 0$ 上达到最大值。然后，通过明确地用最小奇异值 $\\sigma_{N}$ 表示所得的最大放大因子，来量化反演的不稳定性。请将您的最终答案表示为单个闭式解析表达式。无需四舍五入，也无需使用物理单位。",
            "solution": "映射 $A : \\mathbb{R}^{N} \\to \\mathbb{R}^{N}$ 是线性的且可逆，根据奇异值分解（SVD），我们有 $A = U \\Sigma V^{\\top}$，其中 $U$ 和 $V$ 是正交矩阵，$\\Sigma = \\operatorname{diag}(\\sigma_{1}, \\dots, \\sigma_{N})$，且 $\\sigma_{1} \\geq \\dots \\geq \\sigma_{N} > 0$。其逆矩阵存在，并由下式给出\n$$\nA^{-1} = V \\Sigma^{-1} U^{\\top},\n$$\n其中 $\\Sigma^{-1} = \\operatorname{diag}(\\sigma_{1}^{-1}, \\dots, \\sigma_{N}^{-1})$。\n\n我们寻求在 $\\delta f \\neq 0$ 的条件下最大化比率\n$$\n\\mathcal{R}(\\delta f) = \\frac{\\|A^{-1} \\delta f\\|_{2}}{\\|\\delta f\\|_{2}}\n$$\n同时满足诱导模型扰动与 $v_{N}$ 对齐的要求。对齐条件 $\\delta m = A^{-1} \\delta f \\parallel v_{N}$ 意味着 $A^{-1} \\delta f$ 必须与 $v_{N}$ 成比例。在由 $U$ 的列向量构成的标准正交基中分解 $\\delta f$，可写为\n$$\n\\delta f = \\sum_{i=1}^{N} \\alpha_{i} u_{i},\n$$\n其中 $u_{i}$ 表示 $U$ 的第 $i$ 列，$\\alpha_{i} \\in \\mathbb{R}$。应用 $A^{-1}$，\n$$\nA^{-1} \\delta f = V \\Sigma^{-1} U^{\\top} \\left( \\sum_{i=1}^{N} \\alpha_{i} u_{i} \\right)\n= V \\Sigma^{-1} \\left( \\sum_{i=1}^{N} \\alpha_{i} e_{i} \\right)\n= \\sum_{i=1}^{N} \\alpha_{i} \\sigma_{i}^{-1} v_{i},\n$$\n其中 $e_{i}$ 是第 $i$ 个标准基向量，$v_{i}$ 是 $V$ 的第 $i$ 列。\n\n为了使 $A^{-1} \\delta f$ 与 $v_{N}$ 对齐，其在 $v_{i}$ ($i \\neq N$) 方向上的所有分量都必须为零，这要求对 $i \\neq N$ 有 $\\alpha_{i} = 0$。因此，唯一能产生 $\\delta m \\parallel v_{N}$ 的可采纳的 $\\delta f$ 形式为\n$$\n\\delta f = \\alpha_{N} u_{N}, \\quad \\alpha_{N} \\neq 0.\n$$\n在此选择下，\n$$\nA^{-1} \\delta f = \\alpha_{N} \\sigma_{N}^{-1} v_{N}.\n$$\n因此，\n$$\n\\|A^{-1} \\delta f\\|_{2} = |\\alpha_{N}| \\sigma_{N}^{-1}, \\quad \\|\\delta f\\|_{2} = |\\alpha_{N}|.\n$$\n放大率简化为\n$$\n\\mathcal{R}(\\delta f) = \\frac{|\\alpha_{N}| \\sigma_{N}^{-1}}{|\\alpha_{N}|} = \\sigma_{N}^{-1}.\n$$\n\n为确认最大性，考虑任意非零的 $\\delta f = \\sum_{i=1}^{N} \\alpha_{i} u_{i}$。那么\n$$\n\\|A^{-1} \\delta f\\|_{2}^{2} = \\left\\| \\sum_{i=1}^{N} \\alpha_{i} \\sigma_{i}^{-1} v_{i} \\right\\|_{2}^{2}\n= \\sum_{i=1}^{N} \\alpha_{i}^{2} \\sigma_{i}^{-2},\n$$\n根据 $v_{i}$ 的标准正交性。同样，\n$$\n\\|\\delta f\\|_{2}^{2} = \\left\\| \\sum_{i=1}^{N} \\alpha_{i} u_{i} \\right\\|_{2}^{2} = \\sum_{i=1}^{N} \\alpha_{i}^{2},\n$$\n根据 $u_{i}$ 的标准正交性。因此\n$$\n\\mathcal{R}(\\delta f)^{2} = \\frac{\\sum_{i=1}^{N} \\alpha_{i}^{2} \\sigma_{i}^{-2}}{\\sum_{i=1}^{N} \\alpha_{i}^{2}}\n\\leq \\max_{1 \\leq i \\leq N} \\sigma_{i}^{-2} = \\sigma_{N}^{-2},\n$$\n等号成立当且仅当所有权重都集中在最小奇异值上，即对 $i \\neq N$ 有 $\\alpha_{i} = 0$。这证明了在所有非零 $\\delta f$ 上的最大放大率等于 $\\sigma_{N}^{-1}$，并且通过选择\n$$\n\\delta f \\parallel u_{N} \\quad \\text{使得} \\quad A^{-1} \\delta f \\parallel v_{N}\n$$\n来达到此最大值。\n\n根据 Hadamard 的适定性准则，对数据的连续依赖性要求逆映射是有界的。$A^{-1}$ 在欧几里得范数下的算子范数为\n$$\n\\|A^{-1}\\|_{2} = \\sup_{\\delta f \\neq 0} \\frac{\\|A^{-1} \\delta f\\|_{2}}{\\|\\delta f\\|_{2}} = \\sigma_{N}^{-1}.\n$$\n如果 $\\sigma_{N}$ 很小，那么不稳定性 $\\sigma_{N}^{-1}$ 就会很大，这表明缺乏对数据的连续依赖性，因此即使在无噪声、满秩的情况下存在性和唯一性都成立，该反演问题在 Hadamard 意义下也是不适定的。",
            "answer": "$$\\boxed{\\sigma_{N}^{-1}}$$"
        },
        {
            "introduction": "最后的练习将从理论分析过渡到地球物理实验设计的实际应用。你将编写一个程序，通过选择接收器的位置来优化地震层析成像勘探，以最大化正演算子的最小奇异值，从而改善问题的稳定性。这个动手实践问题  展示了适定性原则如何直接指导实验设计，以确保获得稳健可靠的结果。",
            "id": "3602530",
            "problem": "您将实现并运行一个完整的程序，该程序针对一组直线射线地震层析成像实验，设计最佳接收器布局以最大化正演算子的最小奇异值，并利用该值根据 Hadamard 的适定性准则评估稳定性。背景设定为线性化的、二维的、单元内慢度恒定、直线射线走时层析成像。您的任务必须从第一性原理出发完成，不得依赖任何预先指定的捷径公式。\n\n基本原理如下。在一个以米为单位的二维矩形域 $[0,1]\\times[0,1]$ 中，该域被离散化为一个由 $N_x\\times N_y$ 个矩形单元组成的均匀网格。假设每个单元内的波速慢度恒定，并将单元慢度向量表示为 $m\\in\\mathbb{R}^{N_x N_y}$。对于严格位于域内部的任何震源位置 $s\\in\\mathbb{R}^2$ 和接收器位置 $r\\in\\mathbb{R}^2$，初至直线射线走时 $t$ 满足线积分恒等式 $t=\\int_{\\text{ray}(s,r)} u(\\mathbf{x})\\,\\mathrm{d}\\ell$，其中 $u(\\mathbf{x})$ 是慢度，$\\mathrm{d}\\ell$ 是微分弧长元。在均匀单元离散化下，这简化为一个线性映射 $t = G m$，其中 $G\\in\\mathbb{R}^{M\\times N}$，$M$ 是震源-接收器射线的数量，$N=N_xN_y$，并且 $G$ 的每一行包含从震源到接收器的直线段沿线在每个单元内部的路径长度序列。$G$ 的奇异值分解 (SVD) 产生奇异值 $\\sigma_1\\ge \\sigma_2\\ge \\cdots \\ge \\sigma_{\\min(M,N)}\\ge 0$。在线性设定中，Hadamard 的适定性准则包括解的存在性、唯一性和连续依赖性。假设数据无噪声且一致，存在性得到保证。$m$ 的唯一性等价于 $G$ 具有列满秩（即，当 $M\\ge N$ 时 $\\sigma_{\\min}>0$），而关于 $\\ell_2$ 范数的连续依赖性等价于逆存在有限的 Lipschitz 界，该界由 $\\sigma_{\\min}$ 通过不等式 $\\|m\\|_2 \\le \\sigma_{\\min}^{-1}\\|Gm\\|_2$ 控制（当 $M\\ge N$ 且 $\\sigma_{\\min}>0$ 时）。\n\n您必须：\n- 对于每条射线，通过计算震源和接收器之间的直线段与每个网格单元相交的精确长度来构建 $G$。仅使用几何线-网格相交和弧长计算，不使用任何捷径。\n- 从一组有限的候选接收器位置中，精确选择 $R$ 个接收器，以最大化由固定震源和所选接收器生成的所有射线所构成的矩阵 $G$ 的 $\\sigma_{\\min}$。\n- 对于唯一性和稳定性评估，将 $M<N$ 的情况视为本质上不稳定的，其最小奇异值为0。",
            "solution": "用户的请求是地球物理学领域（特别是地震层析成像）中一个定义明确的计算问题。该问题有科学依据，经过形式化指定，并要求从第一性原理构建解决方案。因此，它被认为是**有效的**。\n\n该任务涉及三个主要部分：(1) 通过组合优化寻找最佳接收器布局，(2) 根据基本几何原理为每种布局构建正演算子矩阵 G，以及 (3) 在 Hadamard 适定性准则的背景下，使用奇异值分解 (SVD) 对所得线性系统进行稳定性分析。\n\n### 方法论\n\n**1. 最佳接收器布局：组合搜索**\n\n对于每个测试案例，都提供了一组候选接收器位置，必须从中选择特定数量 $R$ 个。目标是选择 $R$ 个接收器的子集，以最大化最终生成的正演矩阵 $G$ 的最小奇异值 $\\sigma_{\\min}$。由于候选位置的数量和要选择的数量都很小，这个优化问题可以通过穷举搜索来解决。我们使用 `itertools.combinations` 函数从候选集合中生成所有可能的 $R$ 个接收器的组合。对于每种组合，我们构建相应的矩阵 $G$ 并计算其 $\\sigma_{\\min}$。产生最大 $\\sigma_{\\min}$ 的组合即为最优组合，其关联值表示为 $\\sigma_{\\min}^{\\star}$。\n\n**2. 正演算子构建：射线-网格相交**\n\n问题的核心是构建矩阵 $G \\in \\mathbb{R}^{M \\times N}$，其中 $M$ 是射线数量，$N = N_x N_y$ 是模型参数（单元）的数量。每个条目 $G_{ij}$ 代表第 $i$ 条射线在第 $j$ 个网格单元内的路径长度。\n\n为了从第一性原理计算这些长度，我们实现了一个基于 Amanatides 和 Woo 算法原理的射线追踪算法，这是一种数字微分分析器 (DDA)。对于由震源点 $s = (x_1, y_1)$ 和接收点 $r = (x_2, y_2)$ 定义的每条射线：\n\n- 射线通过参数化形式表示为 $\\mathbf{p}(t) = s + t(r-s)$，其中 $t \\in [0, 1]$。\n- 该算法迭代地穿过射线所相交的网格单元。它从包含震源 $s$ 的单元开始。\n- 在每一步中，它计算射线与当前单元边界相交处的参数值 $t_{cross}$。算法会找出大于当前参数值 $t_{current}$ 的最小 $t_{cross}$。这个 $t_{cross}$ 标记了离开当前单元的出射点。\n- 当前单元内的路径长度由 $L \\cdot (t_{exit} - t_{current})$ 给出，其中 $L$ 是射线的总长度，$t_{exit} = \\min(t_{cross}, 1.0)$ 用于处理射线在单元内终止的情况。\n- 然后，算法将当前单元索引更新，并将 $t_{current}$ 更新为 $t_{exit}$，并重复此过程，直到到达射线末端（即 $t_{current} = 1.0$）。\n- 计算出的长度存储在对应 $G$ 矩阵一行的向量中。单元索引被指定为行主序，其中 `x` 是第一个索引，因此 `cell_index = ix * Ny + iy`，其中 `(ix, iy)` 是从零开始的网格坐标。\n\n**3. 通过奇异值分解 (SVD) 进行稳定性分析**\n\nHadamard 的适定问题准则要求解的存在性、唯一性和稳定性（解对数据的连续依赖性）。在我们的线性反演问题 $Gm = t$ 中：\n- **存在性**被假定。\n- **唯一性**：模型 $m$ 的唯一性要求 $G$ 的零空间是平凡的。当且仅当 $G$ 不具有列满秩时，存在非平凡零空间。如果射线数量 $M$ 小于模型参数数量 $N$，则系统是欠定的，必定存在非平凡零空间。在这种情况下 ($M<N$)，我们认为该问题在本质上是不稳定的（因此也没有唯一解），并将 $\\sigma_{\\min}$ 有效地视为零。\n- **稳定性**：对于 $M \\ge N$ 的情况，稳定性由最小非零奇异值 $\\sigma_{\\min}$ 控制。如果 $\\sigma_{\\min} > 0$，则逆是有界的，问题是稳定的。$\\sigma_{\\min}$ 的值量化了稳定性：值越大，问题越稳定（即对数据噪声的敏感性越低）。如果 $\\sigma_{\\min}$ 严格为零（或在数值上非常接近零），则 $G$ 是奇异的（或病态的），问题是不稳定的。\n\n因此，我们的程序将 $M < N$ 的情况识别为不稳定的。对于 $M \\ge N$ 的情况，我们计算 $\\sigma_{\\min}$，并通过检查它是否明显大于零来评估稳定性。最大化 $\\sigma_{\\min}$ 的目标直接对应于寻找最稳定的实验设计。",
            "answer": "```python\nimport numpy as np\nfrom itertools import combinations\n\ndef get_ray_path_lengths(start_pos, end_pos, grid_dims, domain_dims=(0.0, 1.0, 0.0, 1.0)):\n    \"\"\"\n    Computes the lengths of a straight ray's path through each cell of a 2D grid.\n    This implementation uses a 2D DDA-like algorithm (Amanatides  Woo style).\n    This function adheres to the \"first principles\" requirement.\n\n    Args:\n        start_pos (tuple): (x, y) coordinates of the ray's start point.\n        end_pos (tuple): (x, y) coordinates of the ray's end point.\n        grid_dims (tuple): (Nx, Ny), number of cells in x and y directions.\n        domain_dims (tuple): (x_min, x_max, y_min, y_max) of the domain.\n\n    Returns:\n        numpy.ndarray: A 1D array of size Nx*Ny with path lengths in each cell.\n                       Cell indexing is row-major, with x as the first index:\n                       cell_index = ix * Ny + iy.\n    \"\"\"\n    x_min, x_max, y_min, y_max = domain_dims\n    nx, ny = grid_dims\n    x1, y1 = start_pos\n    x2, y2 = end_pos\n\n    dx = (x_max - x_min) / nx\n    dy = (y_max - y_min) / ny\n    \n    path_lengths = np.zeros(nx * ny)\n\n    vx = x2 - x1\n    vy = y2 - y1\n    \n    ray_length = np.sqrt(vx**2 + vy**2)\n    if ray_length == 0:\n        return path_lengths\n\n    # Initial cell index. Clamp to be within the grid.\n    ix = int((x1 - x_min) / dx)\n    iy = int((y1 - y_min) / dy)\n    if ix >= nx: ix = nx - 1\n    if iy >= ny: iy = ny - 1\n\n    step_x = 1 if vx > 0 else -1 if vx < 0 else 0\n    step_y = 1 if vy > 0 else -1 if vy < 0 else 0\n\n    # Parametric distance to next grid line\n    if vx != 0:\n        next_vert_boundary = x_min + (ix + (1 if step_x > 0 else 0)) * dx\n        t_max_x = (next_vert_boundary - x1) / vx\n        t_delta_x = dx / abs(vx)\n    else:\n        t_max_x = np.inf\n        t_delta_x = np.inf\n\n    if vy != 0:\n        next_horz_boundary = y_min + (iy + (1 if step_y > 0 else 0)) * dy\n        t_max_y = (next_horz_boundary - y1) / vy\n        t_delta_y = dy / abs(vy)\n    else:\n        t_max_y = np.inf\n        t_delta_y = np.inf\n\n    t_current = 0.0\n    while t_current < 1.0:\n        cell_index = ix * ny + iy\n        \n        if not (0 <= ix < nx and 0 <= iy < ny):\n            break\n\n        t_exit = min(t_max_x, t_max_y, 1.0)\n        \n        segment_len = ray_length * (t_exit - t_current)\n        path_lengths[cell_index] += segment_len\n        \n        t_current = t_exit\n        \n        if t_current >= 1.0:\n            break\n\n        # Move to the next cell. A small epsilon prevents floating point errors\n        # at corners, ensuring consistent diagonal steps.\n        if t_max_x < t_max_y - 1e-12:\n            ix += step_x\n            t_max_x += t_delta_x\n        elif t_max_y < t_max_x - 1e-12:\n            iy += step_y\n            t_max_y += t_delta_y\n        else:\n            ix += step_x\n            iy += step_y\n            t_max_x += t_delta_x\n            t_max_y += t_delta_y\n\n    return path_lengths\n\ndef analyze_geometry(grid_dims, sources, receiver_candidates, R_chosen):\n    \"\"\"\n    Finds the optimal receiver layout to maximize the minimum singular value.\n    \"\"\"\n    nx, ny = grid_dims\n    N = nx * ny\n    S = len(sources)\n    M = S * R_chosen\n    \n    epsilon = 1e-9\n\n    if M < N:\n        return 0.0, 0\n\n    max_sigma_min = -1.0\n    \n    receiver_combinations = combinations(receiver_candidates, R_chosen)\n\n    for rec_set in receiver_combinations:\n        G = np.zeros((M, N))\n        ray_idx = 0\n        for source in sources:\n            for receiver in rec_set:\n                G[ray_idx, :] = get_ray_path_lengths(source, receiver, grid_dims)\n                ray_idx += 1\n        \n        _, s, _ = np.linalg.svd(G, full_matrices=False)\n        sigma_min = s[-1] if len(s) > 0 else 0.0\n\n        if sigma_min > max_sigma_min:\n            max_sigma_min = sigma_min\n\n    is_stable = 1 if M >= N and max_sigma_min > epsilon else 0\n    \n    return max_sigma_min, is_stable\n\ndef solve():\n    test_cases = [\n        {\n            \"id\": 1,\n            \"grid\": (2, 2),\n            \"sources\": [(0.05, 0.05), (0.05, 0.95)],\n            \"candidates\": [(0.95,0.10), (0.95,0.28), (0.95,0.46), (0.95,0.64), (0.95,0.82), (0.95,0.90)],\n            \"R\": 4\n        },\n        {\n            \"id\": 2,\n            \"grid\": (3, 3),\n            \"sources\": [(0.05, 0.05), (0.05, 0.95)],\n            \"candidates\": [(0.95,0.20), (0.95,0.50), (0.95,0.80), (0.80,0.95), (0.80,0.05)],\n            \"R\": 3\n        },\n        {\n            \"id\": 3,\n            \"grid\": (2, 2),\n            \"sources\": [(0.10, 0.25), (0.10, 0.75)],\n            \"candidates\": [(0.49,0.20), (0.49,0.40), (0.49,0.60), (0.49,0.80), (0.49,0.50)],\n            \"R\": 4\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_min_star, b = analyze_geometry(\n            grid_dims=case[\"grid\"],\n            sources=case[\"sources\"],\n            receiver_candidates=case[\"candidates\"],\n            R_chosen=case[\"R\"]\n        )\n        \n        results.append(f\"{sigma_min_star:.6f}\")\n        results.append(str(b))\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}