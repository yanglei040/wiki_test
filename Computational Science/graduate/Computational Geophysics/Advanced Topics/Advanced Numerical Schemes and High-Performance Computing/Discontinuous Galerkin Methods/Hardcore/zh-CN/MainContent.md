## 引言
间断 Galerkin (DG) 方法是现代计算科学与工程领域中一种功能强大且用途广泛的数值技术，尤其在求解涉及复杂物理现象和几何结构的[偏微分方程](@entry_id:141332)方面展现出巨大潜力。在[计算地球物理学](@entry_id:747618)中，由于需要精确模拟波在[非均匀介质](@entry_id:750241)中的传播、处理复杂的地质构造以及应对大规模计算的挑战，传统数值方法（如连续有限元法）在[网格生成](@entry_id:149105)、[并行效率](@entry_id:637464)和边界条件处理等方面常遇到瓶颈。DG 方法通过其独特的数学框架，为解决这些难题提供了一套优雅而高效的方案。

本文旨在系统地介绍间断 Galerkin 方法，带领读者从基本原理深入到前沿应用。通过学习，您将理解 DG 方法如何突破传统方法的限制，并掌握其在解决实际地球物理问题中的核心思想。文章将分为三个主要部分展开：

在 **原理与机制** 一章中，我们将深入其数学核心，从其标志性的“[破碎函数空间](@entry_id:746988)”出发，推导其离散格式，并剖析“[数值通量](@entry_id:752791)”这一关键构件在保证稳定性和精度中的核心作用。

随后的 **应用与跨学科联系** 一章将理论与实践相结合，展示 DG 方法如何用于模拟复杂的物理过程，如[弹性波](@entry_id:196203)在[非均匀介质](@entry_id:750241)中的传播、粘弹性效应，以及如何利用其几何灵活性处理地质断层和全球尺度的[曲线坐标](@entry_id:178535)问题，并探讨其与高性能计算和反演工作流的集成。

最后，在 **动手实践** 部分，通过一系列引导性问题，您将有机会亲手计算[数值通量](@entry_id:752791)、构建质量矩阵并应用[斜率限制器](@entry_id:638003)，从而将理论知识转化为具体的计算技能。

现在，让我们首先进入第一章，探索间断 Galerkin 方法的原理与机制。

## 原理与机制

本章将深入探讨间断 Galerkin (DG) 方法的核心原理与内在机制。在前一章介绍其背景与动机之后，我们现在将系统地构建该方法的数学框架，解释其为何在[计算地球物理学](@entry_id:747618)等领域的复杂问题中表现出色。我们将从其独特的[函数空间](@entry_id:143478)选择出发，推导其公式，剖析数值通量的关键作用，并最终将其应用范围拓展至不同类型的[偏微分方程](@entry_id:141332)和实际的计算挑战中。

### 核心原理：[破碎函数空间](@entry_id:746988)

传统（连续）有限元方法 (CG) 的一个标志性特征是，其[试探函数](@entry_id:756165)与[检验函数](@entry_id:166589)空间是定义在整个计算域 $\Omega$ 上的 Sobolev 空间 $H^1(\Omega)$ 的[子空间](@entry_id:150286)。这意味着这些函数在单元边界上必须是连续的。这确保了[全局解](@entry_id:180992)的连续性，但在处理某些问题时也带来了限制，例如要求网格必须是协调的，以及在并行计算中增加了单元间的依赖性。

间断 Galerkin 方法的根本性突破在于其[函数空间](@entry_id:143478)的选择。DG 方法在**破碎 Sobolev 空间 (broken Sobolev space)** 中寻找近似解，该空间定义在网格 $\mathcal{T}_h$ 之上：
$$
H^1(\mathcal{T}_h) \equiv \{ v \in L^2(\Omega) : v|_K \in H^1(K) \text{ for each } K \in \mathcal{T}_h \}
$$
其中 $K$ 是网格 $\mathcal{T}_h$ 中的任意一个单元。这个定义意味着，函数在每个单元内部具备良好的光滑性（即，函数本身及其一阶导数在 $L^2$ 意义下存在），但**不必在单元边界上保持连续**。

这一选择带来了深远的影响。由于函数在单元间可能是间断的，一个内部界面（或称“面”）$F$（由两个相邻单元 $K^+$ 和 $K^-$ 共享）上的函数值不再是唯一的。根据[迹定理](@entry_id:203967) (trace theorem)，对于任意函数 $v_h \in H^1(\mathcal{T}_h)$，它在界面 $F$ 上存在两个**迹 (traces)**：一个是从 $K^+$ 逼近界面得到的 $v_h^+$，另一个是从 $K^-$ 逼近界面得到的 $v_h^-$。这种双值特性是 DG 方法的核心，也是其灵活性与复杂性的来源 。

为了处理这种间断性，我们需要引入一套新的记号。对于一个内部界面 $F$，我们定义**平均 (average)** 和**跳跃 (jump)** 算子。对于标量函数 $u$ 和向量函数 $\mathbf{q}$，它们的定义如下（[法向量](@entry_id:264185) $\mathbf{n}$ 约定从 $K^+$ 指向 $K^-$，因此 $\mathbf{n}^+=\mathbf{n}$ 且 $\mathbf{n}^-=-\mathbf{n}$）：
$$
\{\!\{ u \}\!\} = \frac{1}{2}(u^+ + u^-) \qquad [[\! u ]\!] = u^+ - u^-
$$
$$
\{\!\{ \mathbf{q} \}\!\} = \frac{1}{2}(\mathbf{q}^+ + \mathbf{q}^-) \qquad [[\! \mathbf{q} ]\!] = \mathbf{q}^+ \cdot \mathbf{n}^+ + \mathbf{q}^- \cdot \mathbf{n}^-
$$
通过对这些跳跃项的控制，DG 方法实现了单元间的耦合与信息的传递。

### DG 列式：从局部到全局的数值通量耦合

理解了[破碎函数空间](@entry_id:746988)后，我们来构建 DG 方法的离散格式。我们将以一个一维线性[平流方程](@entry_id:144869)为例，这个方程是模拟地球物理中波动传输等现象的原型问题 ：
$$
\frac{\partial u}{\partial t} + a \frac{\partial u}{\partial x} = 0, \quad a > 0
$$
我们希望在一个单元 $K_i = (x_{i-\frac{1}{2}}, x_{i+\frac{1}{2}})$ 上寻找近似解 $u_h$。

**第一步：单元内分部积分**

与 CG 方法将控制方程与检验函数 $v_h$ 在整个区域 $\Omega$ 上做[内积](@entry_id:158127)不同，DG 方法在每个单元 $K_i$ 上独立进行。
$$
\int_{K_i} \left( \frac{\partial u_h}{\partial t} + a \frac{\partial u_h}{\partial x} \right) v_h \, dx = 0
$$
对包含空间导数的第二项进行[分部积分](@entry_id:136350)：
$$
\int_{K_i} a \frac{\partial u_h}{\partial x} v_h \, dx = [a u_h v_h]_{x_{i-\frac{1}{2}}}^{x_{i+\frac{1}{2}}} - \int_{K_i} a u_h \frac{\partial v_h}{\partial x} \, dx
$$
代入原式，我们得到单元内的[弱形式](@entry_id:142897)（其中 $u_h^-$ 和 $v_h^-$ 代表从单元 $K_i$ 内部逼近边界的迹）：
$$
\int_{K_i} \frac{\partial u_h}{\partial t} v_h \, dx - \int_{K_i} a u_h \frac{\partial v_h}{\partial x} \, dx + a u_h^-(x_{i+\frac{1}{2}})v_h^-(x_{i+\frac{1}{2}}) - a u_h^-(x_{i-\frac{1}{2}})v_h^-(x_{i-\frac{1}{2}}) = 0
$$

**第二步：引入数值通量**

此时，每个单元的方程都包含其边界上的通量项 $a u_h$。由于 $u_h$ 在单元边界上是双值的，我们不能简单地将相邻单元的边界项消去。为了在单元间建立物理上和数学上都合理的耦合，DG 方法引入了其核心构件：**[数值通量](@entry_id:752791) (numerical flux)**，记作 $\widehat{a u_h}$。

数值通量是一个在单元界面上唯一定义的函数，它依赖于界面两侧的状态，即 $\widehat{a u_h} = \widehat{F}(u_h^-, u_h^+)$。它的作用是模拟跨越间断界面的真实物理通量。用[数值通量](@entry_id:752791)替代[弱形式](@entry_id:142897)中的物理通量项，我们得到：
$$
\int_{K_i} \frac{\partial u_h}{\partial t} v_h \, dx - \int_{K_i} a u_h \frac{\partial v_h}{\partial x} \, dx + \widehat{a u_h}|_{x_{i+\frac{1}{2}}} v_h^-(x_{i+\frac{1}{2}}) - \widehat{a u_h}|_{x_{i-\frac{1}{2}}} v_h^-(x_{i-\frac{1}{2}}) = 0
$$
对于[平流](@entry_id:270026)速度 $a>0$ 的情况，信息从左向右传播。一个自然的选择是**[迎风通量](@entry_id:143931) (upwind flux)**，它在界面处选择上游状态：
$$
\widehat{a u_h}|_{x_{i+\frac{1}{2}}} = a u_h(x_{i+\frac{1}{2}}^-)
$$

**第三步：组装全局格式**

将所有单元的弱形式相加，即可得到全局的[半离散格式](@entry_id:165671)。对于内部界面 $x_{j+\frac{1}{2}}$，它既是单元 $K_j$ 的右边界，也是单元 $K_{j+1}$ 的左边界。来自 $K_j$ 的贡献是 $+\widehat{a u_h} v_h^-(x_{j+\frac{1}{2}})$，来自 $K_{j+1}$ 的贡献是 $-\widehat{a u_h} v_h^+(x_{j+\frac{1}{2}})$。两者合并，在每个内部界面上的总贡献为 $\widehat{a u_h} (v_h^- - v_h^+) = -\widehat{a u_h} (v_h^+ - v_h^-) = -\widehat{a u_h} [[\! v_h ]\!]$。最终，包含边界条件在内的全局残差形式得以建立 。

这个过程清晰地展示了 DG 方法的哲学：在单元内部，我们使用标准的 PDE 理论（如[分部积分](@entry_id:136350)）；在单元之间，我们通过精心设计的[数值通量](@entry_id:752791)来“缝合”间断的解，从而恢复全局的物理联系。

### 数值通量的作用：稳定性与精度

数值通量的选择是 DG 方法的灵魂，它直接决定了最终数值格式的稳定性、[耗散性](@entry_id:162959)、[色散](@entry_id:263750)性以及处理复杂物理现象（如激波、界面反射）的能力。

#### 稳定性和耗散

我们以一维[平流方程](@entry_id:144869)为例，考察不同通量对能量 $E(t) = \frac{1}{2} \sum_K \int_K u_h^2 \, dx$ 演化的影响 。可以证明，能量的变化率完全由界面上的通量贡献决定，其形式为：
$$
\frac{dE}{dt} = \sum_{\text{interfaces}} \int_F (\widehat{au} - a\{\!\{u\}\!\}) [[\!u]\!] \, dS
$$

*   **[中心通量](@entry_id:747204) (Central Flux)**：$\widehat{au} = a\{\!\{u\}\!\}$。代入上式，我们得到 $\frac{dE}{dt} = 0$。这意味着[中心通量](@entry_id:747204)是[能量守恒](@entry_id:140514)的。然而，这种守恒性是有代价的。对于平流问题，使用[中心通量](@entry_id:747204)的 DG 格式其空间离散算子的[特征值](@entry_id:154894)是纯虚数。这导致数值解中未被解析的高频伪影（源于多项式表示的混淆误差）无法被耗散，最终会污染整个解，导致计算不稳定 。

*   **[迎风通量](@entry_id:143931) (Upwind Flux)**：如前所述，对于 $a>0$，$\widehat{au} = au^- = a(\{\!\{u\}\!\} - \frac{1}{2}[[\!u]\!])$。代入能量[演化方程](@entry_id:268137)，得到 $\frac{dE}{dt} = \sum_{\text{interfaces}} \int_F -\frac{a}{2} [[\!u]\!]^2 \, dS \le 0$。这表明[迎风通量](@entry_id:143931)是能量耗散的：只要解在界面上存在跳跃（即 $[[\!u]\!] \neq 0$），能量就会减少。这种耗散机制能够有效地抑制高频[振荡](@entry_id:267781)，从而保证格式的稳定性。从[特征值](@entry_id:154894)角度看，[迎风通量](@entry_id:143931)为离散算子的[特征值](@entry_id:154894)增加了负实部，将其从[虚轴](@entry_id:262618)移动到左半复平面 。

一个有趣且重要的结论是，尽管[迎风格式](@entry_id:756374)更稳定，但它的离散算子通常比中心格式具有更大的[谱半径](@entry_id:138984)（[绝对值](@entry_id:147688)最大的[特征值](@entry_id:154894)）。根据[显式时间积分](@entry_id:165797)格式（如[龙格-库塔法](@entry_id:140014)）的 CFL 条件 $\Delta t \le C / \rho(\mathbf{L}_h)$，这意味着使用[迎风通量](@entry_id:143931)反而需要更小的[稳定时间步长](@entry_id:755325) 。稳定性是通过耗散换来的，而这又对[计算效率](@entry_id:270255)提出了更高的要求。

#### 复杂系统与物理精度

在地球物理学中，我们常常面对的是复杂的[波动方程](@entry_id:139839)系统，例如[各向异性弹性](@entry_id:186771)波方程。在这种情况下，数值通量的选择变得更加关键 。

*   **Lax-Friedrichs 型通量**：这是[迎风](@entry_id:756372)思想的一种推广，它在[中心通量](@entry_id:747204)的基础上增加一个与解的跳跃成正比的惩罚项。这个惩罚项的系数与界面处的最大特征波速（物理信号传播速度）相关。它能保证[能量稳定性](@entry_id:748991)，对于存在高阻抗差界面的问题尤其鲁棒，但其耗散较大，可能会过度抹平物理波形。

*   **黎曼通量 (Riemann-based Flux)**：这是物理上最精确的通量。它通过求解界面处的一个局部一维黎曼问题来得到。黎曼问题的解给出了波如何在该材料[间断面](@entry_id:180188)上传播、反射和透射的精确信息。因此，黎曼通量能够最小化由数值格式本身引起的虚假界面反射，其误差主要来源于单元内部的[多项式逼近](@entry_id:137391)误差。对于需要精确模拟介质突变界面（如地层界面）处波现象的地球物理应用，黎曼通量是首选。然而，其代价是需要进行[特征分解](@entry_id:181333)，计算上比简单通量更为昂贵。

### 拓展至二阶方程：对称内罚法 (SIPG)

DG 方法不仅适用于一阶[双曲系统](@entry_id:260647)，通过适当改造，也能高效地求解二阶椭圆或抛物方程，如[稳态热传导](@entry_id:177666)或地下水流动模型 ：
$$
- \nabla \cdot (\kappa(\mathbf{x}) \nabla u(\mathbf{x})) = f(\mathbf{x})
$$
对于这类问题，一个流行的方法是**[对称内部罚](@entry_id:755719) Galerkin 方法 (Symmetric Interior Penalty Galerkin, SIPG)**。其[弱形式](@entry_id:142897)包含三个关键部分：

1.  **一致性项 (Consistency terms)**：这些项源于[分部积分](@entry_id:136350)，确保如果真解足够光滑，它也会满足这个离散格式。
2.  **对称项 (Symmetry term)**：为了保证最终的刚度矩阵是对称的，需要额外添加一个与检验函数梯度相关的项。
3.  **罚项 (Penalty term)**：这是 SIPG 的核心。它是一个正比于解在界面上跳跃的平方的项，形如 $\int_F \sigma [[\! u_h ]\!] \cdot [[\! v_h ]\!] \, ds$。罚参数 $\sigma$ 必须足够大，以“惩罚”解的间断，从而保证离散系统的正定性（即稳定性）。罚参数的选取与单元尺寸 $h$、多项式次数 $p$ 和[扩散](@entry_id:141445)系数 $\kappa$ 相关，通常 $\sigma \sim \kappa p^2 / h$。

#### 边界条件的弱施加

DG 的一个巨大优势是其施加边界条件的灵活性。所有边界条件都可以通过在边界上定义合适的[数值通量](@entry_id:752791)来**弱施加 (weakly imposed)**。

*   **Neumann 边界条件**：例如 $\kappa \nabla u \cdot \mathbf{n} = g_N$。这被称为“自然”边界条件，因为通量值是已知的。我们只需在边界积分中，直接用给定的数据 $g_N$ 替换掉通量项即可。

*   **Dirichlet 边界条件**：例如 $u = g_D$。这类“本质”边界条件在 DG 中通过一种称为 **Nitsche 方法**的技术来施加。其形式与 SIPG 的内部界面格式非常相似，也包含一致性、对称性和罚项。最终的边界项不仅将数据 $g_D$ 引入方程，还通过一个罚项 $\int_{\Gamma_D} \frac{\eta \kappa}{h} (u_h - g_D) v_h \, ds$ 来确保解 $u_h$ 在边界上被“拉向”给定值 $g_D$，从而保证了整个系统的稳定性 。

### 实践考量与高等论题

#### [基函数](@entry_id:170178)与数值积分

在每个单元内部，间断解 $u_h$ 由一组[基函数](@entry_id:170178)展开。常见的选择包括：
*   **[模态基](@entry_id:752055) (Modal basis)**：如正交的 Legendre 多项式。这种[基函数](@entry_id:170178)具有良好的数学性质，例如[对角化](@entry_id:147016)的质量矩阵，但在处理[非线性](@entry_id:637147)项时稍显不便。
*   **[节点基](@entry_id:752522) (Nodal basis)**：如定义在一组节点（例如 Gauss-Lobatto 点）上的 Lagrange 多项式。这种[基函数](@entry_id:170178)更直观，其自由度就是函数在节点上的值。

不同[基函数](@entry_id:170178)之间可以通过 Vandermonde 矩阵进行转换 。无论选择何种[基函数](@entry_id:170178)，DG 格式中的所有积分（如质量矩阵 $\int_K \phi_i \phi_j dx$ 和刚度矩阵 $\int_K \nabla\phi_i \cdot \nabla\phi_j dx$）在实践中都是通过**[数值积分](@entry_id:136578) (quadrature)** 来计算的。

[数值积分](@entry_id:136578)的精度至关重要。一个阶数为 $q$ 的积分法则可以精确计算所有次数不高于 $q$ 的多项式的积分。为了不引入额外的[积分误差](@entry_id:171351)，积分法则的阶数必须足够高。例如，对于次数为 $p$ 的[基函数](@entry_id:170178)，[刚度矩阵](@entry_id:178659)的被积函数 $\nabla\phi_i \cdot \nabla\phi_j$ 的次数最高为 $(p-1) + (p-1) = 2p-2$。因此，至少需要一个能精确积分 $2p-2$ 次多项式的积分法则 。而质量矩阵的被积函数 $\phi_i \phi_j$ 次数最高可达 $2p$，需要更高阶的积分法则。

#### 强形式、弱形式与[分部求和](@entry_id:185335)

在文献中，DG 的空间离散算子有两种看似不同但密切相关的代数形式：**[弱形式](@entry_id:142897) (weak form)** 和 **强形式 (strong form)** [@problem_id:3584991, @problem_id:3584947]。我们之[前推](@entry_id:158718)导的，将[微分算子](@entry_id:140145)转移到检验函数上的，是[弱形式](@entry_id:142897)。强形式则不转移微分算子，而是直接离散 $\nabla \cdot \mathbf{F}(\mathbf{q}^h)$。

这两种形式在代数上是否等价，取决于离散算子是否满足一个被称为**[分部求和](@entry_id:185335) (Summation-By-Parts, SBP)** 的性质。SBP 是连续世界中[分部积分法](@entry_id:136350)则在离散矩阵层面的直接模拟。

*   在**仿射网格 (affine meshes)** 上，如果使用**精确的数值积分**，那么离散的微分算子和[内积](@entry_id:158127)矩阵会自动满足 SBP 性质，此时强弱形式完[全等](@entry_id:273198)价。

*   然而，当出现以下情况时，等价性会被破坏 ：
    *   **欠积分 (Underintegration)**：即数值积分的精度不足以精确计算所有体积或[面积分](@entry_id:275394)。
    *   **可变系数**：当材料参数（如 $\rho, \lambda, \mu$）在单元内是变化的函数而非多项式时。
    *   **弯曲网格 (Curvilinear meshes)**：[几何映射](@entry_id:749852)引入的非多项式度量项（来自[雅可比矩阵](@entry_id:264467)的逆）会导致“度量混淆”误差。

在这些更普遍的情况下，强弱形式不再等价，它们的稳定性性质也可能出现差异。这种差异可能导致离散[能量不守恒](@entry_id:276143)甚至增长，从而引发不稳定性。为了克服这一挑战，研究者发展了特殊的 SBP-DG 方法，它们通过构造特殊的离散算子来在代数层面强制恢复守恒性。

#### [非线性](@entry_id:637147)问题与解的稳定化：限制器

对于包含激波或尖锐梯度的[非线性](@entry_id:637147)双曲问题，高阶 DG 方法和其它高阶方法一样，会在间断附近产生非物理的[振荡](@entry_id:267781)（[吉布斯现象](@entry_id:138701)）。为了抑制这些[振荡](@entry_id:267781)，需要引入**限制器 (limiters)**。

限制器的目标是在保持解的[单调性](@entry_id:143760)的同时，尽可能不损害光滑区域的[高阶精度](@entry_id:750325)。一个朴素的 TVD (Total Variation Diminishing) 限制器会强制单元边界的解值不超过相邻单元的平均值。但这会导致一个严重问题：在光滑的极值点（如波峰），它会错误地将解“削平”，使精度降为一阶。

为了解决这个问题，**TVB (Total Variation Bounded) 限制器**被提出 。TVB 限制器是一个双重机制：

1.  **问题单元检测**：首先，它会判断一个单元是否“有问题”。这个判断基于解在单元边界的外插值与其单元平均值的偏差。在光滑极值点，这个偏差是 $O(h^2)$；而在间断或高梯度区，这个偏差是 $O(h)$ 或 $O(1)$。TVB 准则正是利用这个阶数的差异：如果偏差小于某个阈值 $Mh^2$（$M$ 为可调参数），则认为该单元位于光滑[极值](@entry_id:145933)区，**不进行限制**。

2.  **[斜率限制](@entry_id:754953)**：如果一个单元被判定为“有问题”，则对其多项式解的斜率（或更高阶系数）应用一个传统的限制器（如 `minmod` 限制器），以抑制[振荡](@entry_id:267781)。

通过这种方式，TVB 限制器能够“智能地”在需要的地方施加耗散，同时保护光滑区域的解，从而在[复杂流动](@entry_id:747569)模拟中实现了鲁棒性与高精度的统一。