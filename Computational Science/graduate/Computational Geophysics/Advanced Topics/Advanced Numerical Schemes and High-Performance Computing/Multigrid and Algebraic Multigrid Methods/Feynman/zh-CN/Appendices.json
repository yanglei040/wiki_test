{
    "hands_on_practices": [
        {
            "introduction": "理论是指导，但实践是检验。要评估一个代数多重网格（AMG）求解器的效率，首先需要量化其计算成本。本练习  提供了一个具体场景，指导你如何将V循环中的每个组件（如平滑、限制、延拓和粗网格求解）分解为“工作单元”，从而精确计算单次迭代的总成本并预测求解时间。这个练习将帮助你建立起从算法组件到实际性能的直观联系。",
            "id": "3611397",
            "problem": "一个地球物理反演问题主要涉及重复求解一个椭圆线性系统，该系统源于一个模拟地下电导率的三维扩散模型。该线性系统在一个非结构化网格上进行离散化，求解器采用代数多重网格（AMG）方法，每次外层迭代使用一个V-循环。目标是估算每个V-循环的计算功（以功单位计）以及将残差范数减小一个指定因子所需的总挂钟时间。\n\n采用以下定义和数据：\n- 单个功单位（WU）定义为在最细层上与算子进行一次稀疏矩阵向量乘积（SpMV）的成本。如果某操作等效于在层 $\\ell$ 上的SpMV，其成本（以WU计）将按非零元比率 $\\mathrm{NZ}_{\\ell}/\\mathrm{NZ}_{0}$进行缩放，其中$\\mathrm{NZ}_{\\ell}$是层 $\\ell$ 上算子的非零元数量，$\\mathrm{NZ}_{0}$是最细层上算子的非零元数量。\n- 多重网格层次结构有四个层级，$\\ell=0,1,2,3$，其中最细层为 $\\ell=0$，最粗层为 $\\ell=3$。每层的非零元数量为：$\\mathrm{NZ}_{0}=3.2\\times 10^{8}$，$\\mathrm{NZ}_{1}=7.9\\times 10^{7}$，$\\mathrm{NZ}_{2}=1.9\\times 10^{7}$，$\\mathrm{NZ}_{3}=4.7\\times 10^{6}$。\n- 在每个非最粗层（$\\ell=0,1,2$），平滑器为阻尼雅可比方法，有 $\\nu_{1}=2$ 次前平滑扫描和 $\\nu_{2}=2$ 次后平滑扫描。在层 $\\ell$ 上，一次平滑扫描的成本为 $\\beta\\,(\\mathrm{NZ}_{\\ell}/\\mathrm{NZ}_{0})$ WU，其中 $\\beta=1.1$。\n- 在每个非最粗层，每次访问会形成一个残差，成本为 $\\delta\\,(\\mathrm{NZ}_{\\ell}/\\mathrm{NZ}_{0})$ WU，其中 $\\delta=1.0$。\n- 限制和延长的成本分别为 $\\tau_{R}\\,(\\mathrm{NZ}_{\\ell}/\\mathrm{NZ}_{0})$ WU 和 $\\tau_{P}\\,(\\mathrm{NZ}_{\\ell}/\\mathrm{NZ}_{0})$ WU，其中 $\\tau_{R}=\\tau_{P}=0.25$。\n- 在最粗层 $\\ell=3$ 上的求解使用 $m_{c}=30$ 次平滑扫描，每次扫描的成本模型与之前相同，为 $\\beta\\,(\\mathrm{NZ}_{3}/\\mathrm{NZ}_{0})$ WU。\n- 在最细层上进行一次SpMV的挂钟时间为 $t_{\\mathrm{spmv}}=0.015$ 秒/WU。\n\n假设采用经典的双网格误差传播解释：粗网格校正理想地移除了低频误差模式，而阻尼雅可比平滑器则衰减了高频误差模式。在最细层上测得的每次扫描的高频平滑因子为 $\\mu_{h}=0.45$。在估算每个V-循环的收敛因子时，将此 $\\mu_{h}$ 视为各层的代表值。忽略启动瞬态，并假设从第一个循环开始即为渐进行为。\n\n任务：\n1. 仅使用上述数据和定义，计算一个V-循环的总功（以WU为单位）。\n2. 根据一个完整的V-循环通过累积平滑效应将高频误差模式减小一个特定因子的解释，预测将残差范数减小 $10^{-8}$ 倍所需的V-循环次数，然后预测求解所需的总挂钟时间。\n\n将每个V-循环的功和预测的总求解时间均四舍五入至四位有效数字。时间以秒为单位表示。",
            "solution": "问题陈述经过严格验证，确认有效。它在科学上基于数值线性代数和计算科学的原理，特别是关于代数多重网格（AMG）方法的分析。该问题是适定的，为获得唯一解提供了所有必要的数据和定义。其语言客观而精确。\n\n根据要求，解答分为两部分：计算每个V-循环的功，以及预测总求解时间。\n\n### 第1部分：每个V-循环的计算功\n\n一个V-循环的总功 $W_V$ 是在多重网格层次结构的每一层上所执行功的总和。该层次结构由四个层级组成，$\\ell=0, 1, 2, 3$，从最细层到最粗层。一个标准的V-循环过程如下：\n1.  在每个非最粗层 $\\ell$ 上，从最细到最粗（$\\ell=0, 1, 2$），执行 $\\nu_1$ 次前平滑扫描，计算一个残差，并将残差限制到下一个更粗的层级 $\\ell+1$。\n2.  在最粗层（$\\ell=3$），求解系统（在本例中，通过应用 $m_c$ 次平滑扫描）。\n3.  在每个非最粗层 $\\ell$ 上，从最粗到最细（$\\ell=2, 1, 0$），从下一个更粗的层级 $\\ell+1$ 延长校正量，将其加到解上，并执行 $\\nu_2$ 次后平滑扫描。\n\n每个操作的成本以功单位（WU）给出，并根据当前层级 $\\mathrm{NZ}_{\\ell}$ 的非零元数量与最细层级 $\\mathrm{NZ}_{0}$ 的非零元数量之比进行缩放。我们将此比率定义为 $r_{\\ell} = \\frac{\\mathrm{NZ}_{\\ell}}{\\mathrm{NZ}_{0}}$。\n\n在非最粗层 $\\ell \\in \\{0, 1, 2\\}$ 上，每个组件的功为：\n- 前平滑：$\\nu_{1}$ 次扫描，每次成本为 $\\beta r_{\\ell}$ WU。总计：$\\nu_{1}\\beta r_{\\ell}$。\n- 残差计算：$\\delta r_{\\ell}$ WU。\n- 限制到层 $\\ell+1$：$\\tau_{R} r_{\\ell}$ WU。\n- 从层 $\\ell+1$ 延长：$\\tau_{P} r_{\\ell}$ WU。\n- 后平滑：$\\nu_{2}$ 次扫描，每次成本为 $\\beta r_{\\ell}$ WU。总计：$\\nu_{2}\\beta r_{\\ell}$。\n\n在最粗层 $\\ell=3$ 上的功用于求解：\n- 粗网格求解：$m_c$ 次平滑扫描，每次成本为 $\\beta r_{3}$ WU。总计：$m_{c}\\beta r_{3}$。\n\n将所有层级的功相加，得到一个V-循环的总功 $W_V$：\n$$W_V = \\sum_{\\ell=0}^{2} (\\nu_{1}\\beta r_{\\ell} + \\delta r_{\\ell} + \\tau_{R} r_{\\ell}) + m_{c}\\beta r_{3} + \\sum_{\\ell=0}^{2} (\\tau_{P} r_{\\ell} + \\nu_{2}\\beta r_{\\ell})$$\n我们可以合并非最粗层的项：\n$$W_V = \\sum_{\\ell=0}^{2} [(\\nu_{1} + \\nu_{2})\\beta + \\delta + \\tau_{R} + \\tau_{P}] r_{\\ell} + m_{c}\\beta r_{3}$$\n\n首先，我们计算非零元比率 $r_{\\ell}$：\n- $r_{0} = \\frac{\\mathrm{NZ}_{0}}{\\mathrm{NZ}_{0}} = \\frac{3.2\\times 10^{8}}{3.2\\times 10^{8}} = 1$\n- $r_{1} = \\frac{\\mathrm{NZ}_{1}}{\\mathrm{NZ}_{0}} = \\frac{7.9\\times 10^{7}}{3.2\\times 10^{8}} = \\frac{7.9}{32} = 0.246875$\n- $r_{2} = \\frac{\\mathrm{NZ}_{2}}{\\mathrm{NZ}_{0}} = \\frac{1.9\\times 10^{7}}{3.2\\times 10^{8}} = \\frac{1.9}{32} = 0.059375$\n- $r_{3} = \\frac{\\mathrm{NZ}_{3}}{\\mathrm{NZ}_{0}} = \\frac{4.7\\times 10^{6}}{3.2\\times 10^{8}} = \\frac{4.7}{320} = 0.0146875$\n\n接下来，我们将给定的常数代入公式：\n- $\\nu_{1}=2$, $\\nu_{2}=2$\n- $\\beta=1.1$\n- $\\delta=1.0$\n- $\\tau_{R}=0.25$, $\\tau_{P}=0.25$\n- $m_{c}=30$\n\n求和项的系数为：\n$$(\\nu_{1} + \\nu_{2})\\beta + \\delta + \\tau_{R} + \\tau_{P} = (2+2)(1.1) + 1.0 + 0.25 + 0.25 = 4(1.1) + 1.5 = 4.4 + 1.5 = 5.9$$\n粗网格项的系数为：\n$$m_{c}\\beta = 30 \\times 1.1 = 33$$\n$W_V$ 的公式变为：\n$$W_V = 5.9 \\sum_{\\ell=0}^{2} r_{\\ell} + 33 r_{3}$$\n现在，我们计算这个和：\n$$\\sum_{\\ell=0}^{2} r_{\\ell} = r_{0} + r_{1} + r_{2} = 1 + 0.246875 + 0.059375 = 1.30625$$\n将此结果代回 $W_V$ 的表达式中：\n$$W_V = 5.9 \\times 1.30625 + 33 \\times 0.0146875$$\n$$W_V = 7.706875 + 0.4846875 = 8.1915625$$\n四舍五入至四位有效数字，每个V-循环的功为 $W_V \\approx 8.192$ WU。\n\n### 第2部分：求解时间\n\n为了预测求解时间，我们首先需要估算V-循环的收敛因子 $\\rho_V$。问题指明，粗网格校正理想地处理了低频误差，因此V-循环的收敛性由平滑器对高频误差的有效性决定。在一个V-循环中，任何单层上的平滑扫描总次数为 $\\nu_{1} + \\nu_{2}$。每次扫描的高频平滑因子为 $\\mu_{h}=0.45$，因此每个V-循环中高频误差的累积减少量为：\n$$\\rho_V \\approx (\\mu_{h})^{\\nu_{1}+\\nu_{2}} = (0.45)^{2+2} = (0.45)^{4} = 0.04100625$$\n\n接下来，我们确定将残差范数减小 $10^{-8}$ 倍所需的V-循环次数 $k$。我们在不等式中求解 $k$：\n$$(\\rho_V)^{k} \\le 10^{-8}$$\n对两边取自然对数：\n$$k \\ln(\\rho_V) \\le \\ln(10^{-8}) = -8 \\ln(10)$$\n由于 $\\rho_V  1$，其对数为负。除以 $\\ln(\\rho_V)$ 会使不等号反向：\n$$k \\ge \\frac{-8 \\ln(10)}{\\ln(\\rho_V)}$$\n$$k \\ge \\frac{-8 \\ln(10)}{\\ln(0.04100625)} \\approx \\frac{-8 \\times 2.302585}{-3.194001} \\approx \\frac{-18.42068}{-3.194001} \\approx 5.76727$$\n由于循环次数必须是整数，我们取该值的天花板函数：\n$$k = \\lceil 5.76727 \\rceil = 6$$\n因此，需要 6 个V-循环。\n\n最后，总挂钟时间 $T_{\\text{total}}$ 是循环次数、每个循环的功以及每个功单位的时间的乘积。\n$$T_{\\text{total}} = k \\times W_V \\times t_{\\mathrm{spmv}}$$\n为保证精度，使用未四舍五入的 $W_V$ 值，并已知 $t_{\\mathrm{spmv}}=0.015$ 秒/WU：\n$$T_{\\text{total}} = 6 \\times 8.1915625 \\, \\text{WU} \\times 0.015 \\, \\frac{\\text{s}}{\\text{WU}}$$\n$$T_{\\text{total}} = 0.737240625 \\, \\text{s}$$\n四舍五入至四位有效数字，总求解时间为 $T_{\\text{total}} \\approx 0.7372$ 秒。",
            "answer": "$$\\boxed{\\begin{pmatrix} 8.192  0.7372 \\end{pmatrix}}$$"
        },
        {
            "introduction": "多重网格方法的快速收敛性是其核心优势，但这需要严格的数学分析来证明和理解。本练习  深入探讨了收敛性分析的核心，要求你在由系统矩阵 $A$ 诱导的能量范数 ($A$-norm) 下计算误差传递算子的范数。通过这个推导和计算，你将理解为什么能量范数是分析对称正定问题的自然选择，以及理论收敛因子与实际观测到的残差下降之间有何关联。",
            "id": "3611389",
            "problem": "考虑在计算地球物理学中，由一个离散化的非均匀扩散问题产生的对称正定（SPD）线性系统。该系统使用代数多重网格（AMG）中的两网格循环进行求解。假设细网格算子是SPD的，并且粗网格算子和网格间转移算子的构造使得最终的两网格误差传播算子是线性的。设粗层能量算子为\n$$\nA \\;=\\; \\begin{pmatrix}\n2  0.6 \\\\\n0.6  1\n\\end{pmatrix},\n$$\n设测量的两网格误差传播算子（包括一次对称Gauss-Seidel前松弛、一次后松弛和一次精确粗网格校正）为\n$$\nE \\;=\\; \\begin{pmatrix}\n0.3  -0.1 \\\\\n0  0.25\n\\end{pmatrix}.\n$$\n在整个问题中，使用由 $A$ 诱导的能量范数，定义为 $\\|x\\|_{A} = \\sqrt{x^{\\top} A x}$，以及相应的诱导算子范数 $\\|E\\|_{A} = \\sup_{x \\neq 0} \\frac{\\|E x\\|_{A}}{\\|x\\|_{A}}$。残差为 $r = f - A u$，对于精确的右端项 $f$ 和当前迭代解 $u$，误差为 $e = u^\\star - u$，其中 $u^\\star$ 是精确解，因此 $r = A e$。\n\n仅使用SPD算子和诱导范数的基本定义和性质：\n- 推导一个能从 $A$ 和 $E$ 计算渐近收敛率 $\\rho = \\|E\\|_{A}$ 的表达式。\n- 对给定的 $A$ 和 $E$ 进行数值计算，求出 $\\rho$。\n- 已知在 $A^{-1}$ 范数 $\\|r\\|_{A^{-1}} = \\sqrt{r^{\\top} A^{-1} r}$ 下测得的每个两网格循环的残差缩减因子为 $0.312$，利用 $A$ 范数下的误差缩减与 $A^{-1}$ 范数下的残差缩减之间的关系，计算绝对差异\n$$\nd = |\\rho - 0.312|.\n$$\n\n将 $d$ 的最终数值答案四舍五入至四位有效数字。答案无需物理单位。",
            "solution": "首先验证问题，以确保其在科学上是合理的、适定的和自洽的。\n\n**步骤1：提取已知条件**\n- 粗层能量算子为 $A = \\begin{pmatrix} 2  0.6 \\\\ 0.6  1 \\end{pmatrix}$。\n- 两网格误差传播算子为 $E = \\begin{pmatrix} 0.3  -0.1 \\\\ 0  0.25 \\end{pmatrix}$。\n- 算子 $A$ 被说明为对称正定（SPD）。\n- 能量范数定义为 $\\|x\\|_{A} = \\sqrt{x^{\\top} A x}$。\n- 诱导算子范数是 $\\|E\\|_{A} = \\sup_{x \\neq 0} \\frac{\\|E x\\|_{A}}{\\|x\\|_{A}}$。\n- 渐近收敛率是 $\\rho = \\|E\\|_{A}$。\n- 残差 $r$ 与误差 $e$ 之间的关系是 $r = A e$。\n- $A^{-1}$ 范数定义为 $\\|r\\|_{A^{-1}} = \\sqrt{r^{\\top} A^{-1} r}$。\n- 在 $A^{-1}$ 范数下观测到的残差缩减因子给出的数值为 $0.312$。\n- 任务是计算绝对差异 $d = |\\rho - 0.312|$。\n\n**步骤2：使用提取的已知条件进行验证**\n问题是良定义的，并且在数值线性代数和多重网格方法的标准框架内操作。矩阵 $A$ 是对称的。其顺序主子式为 $2  0$ 和 $\\det(A) = (2)(1) - (0.6)(0.6) = 2 - 0.36 = 1.64  0$。因此，$A$ 确实是对称正定的，这确保了 $\\| \\cdot \\|_{A}$ 是一个有效的向量范数，且问题在数学上是合理的。给定的算子和定义都是标准的。问题是自洽且一致的。\n\n**结论**\n问题是有效的。我们继续进行求解。\n\n**第1部分：收敛率 $\\rho = \\|E\\|_{A}$ 的表达式推导**\n\n渐近收敛率由 $\\rho = \\|E\\|_{A}$ 给出。为了推导一个可计算的表达式，我们从诱导算子范数的定义开始：\n$$\n\\rho^2 = \\|E\\|_{A}^2 = \\sup_{x \\neq 0} \\frac{\\|E x\\|_{A}^2}{\\|x\\|_{A}^2}\n$$\n使用能量范数的定义 $\\|v\\|_{A}^2 = v^{\\top} A v$，我们可以写出：\n$$\n\\rho^2 = \\sup_{x \\neq 0} \\frac{(E x)^{\\top} A (E x)}{x^{\\top} A x} = \\sup_{x \\neq 0} \\frac{x^{\\top} E^{\\top} A E x}{x^{\\top} A x}\n$$\n这个表达式是矩阵束 $(E^{\\top} A E, A)$ 的瑞利商的最大值。这个最大值是广义特征值问题 $E^{\\top} A E x = \\lambda A x$ 的最大特征值 $\\lambda_{\\max}$。由于 $A$ 是SPD的，它是可逆的。我们可以通过左乘 $A^{-1}$ 将其转换为标准特征值问题：\n$$\n(A^{-1} E^{\\top} A E) x = \\lambda x\n$$\n因此，$\\rho^2$ 是矩阵 $M = A^{-1} E^{\\top} A E$ 的最大特征值。收敛率的表达式为：\n$$\n\\rho = \\sqrt{\\lambda_{\\max}(A^{-1} E^{\\top} A E)}\n$$\n\n**第2部分：$\\rho$ 的数值计算**\n\n我们现在将使用给定的矩阵 $A$ 和 $E$ 来计算 $\\rho$。\n首先，我们求 $A$ 的逆。行列式为 $\\det(A) = 1.64$。\n$$\nA^{-1} = \\frac{1}{1.64} \\begin{pmatrix} 1  -0.6 \\\\ -0.6  2 \\end{pmatrix}\n$$\n接下来，我们计算乘积 $B = E^{\\top} A E$。$E$ 的转置是 $E^{\\top} = \\begin{pmatrix} 0.3  0 \\\\ -0.1  0.25 \\end{pmatrix}$。\n$$\nA E = \\begin{pmatrix} 2  0.6 \\\\ 0.6  1 \\end{pmatrix} \\begin{pmatrix} 0.3  -0.1 \\\\ 0  0.25 \\end{pmatrix} = \\begin{pmatrix} (2)(0.3)+(0.6)(0)  (2)(-0.1)+(0.6)(0.25) \\\\ (0.6)(0.3)+(1)(0)  (0.6)(-0.1)+(1)(0.25) \\end{pmatrix} = \\begin{pmatrix} 0.6  -0.05 \\\\ 0.18  0.19 \\end{pmatrix}\n$$\n$$\nB = E^{\\top}(A E) = \\begin{pmatrix} 0.3  0 \\\\ -0.1  0.25 \\end{pmatrix} \\begin{pmatrix} 0.6  -0.05 \\\\ 0.18  0.19 \\end{pmatrix} = \\begin{pmatrix} (0.3)(0.6)  (0.3)(-0.05) \\\\ (-0.1)(0.6)+(0.25)(0.18)  (-0.1)(-0.05)+(0.25)(0.19) \\end{pmatrix}\n$$\n$$\nB = \\begin{pmatrix} 0.18  -0.015 \\\\ -0.06+0.045  0.005+0.0475 \\end{pmatrix} = \\begin{pmatrix} 0.18  -0.015 \\\\ -0.015  0.0525 \\end{pmatrix}\n$$\n现在，我们计算矩阵 $M = A^{-1} B$：\n$$\nM = \\frac{1}{1.64} \\begin{pmatrix} 1  -0.6 \\\\ -0.6  2 \\end{pmatrix} \\begin{pmatrix} 0.18  -0.015 \\\\ -0.015  0.0525 \\end{pmatrix} = \\frac{1}{1.64} \\begin{pmatrix} 0.18+0.009  -0.015-0.0315 \\\\ -0.108-0.03  0.009+0.105 \\end{pmatrix}\n$$\n$$\nM = \\frac{1}{1.64} \\begin{pmatrix} 0.189  -0.0465 \\\\ -0.138  0.114 \\end{pmatrix}\n$$\n为了求 $M$ 的特征值，我们求解特征方程 $\\det(M-\\lambda I)=0$。令 $M' = 1.64 M$，其特征值为 $\\lambda'$。则 $\\lambda = \\lambda'/1.64$。\n$$\n\\det(M' - \\lambda' I) = \\det \\begin{pmatrix} 0.189 - \\lambda'  -0.0465 \\\\ -0.138  0.114 - \\lambda' \\end{pmatrix} = 0\n$$\n$$\n(\\lambda')^2 - \\text{tr}(M')\\lambda' + \\det(M') = 0\n$$\n$$\n(\\lambda')^2 - (0.189+0.114)\\lambda' + (0.189)(0.114) - (-0.0465)(-0.138) = 0\n$$\n$$\n(\\lambda')^2 - 0.303\\lambda' + 0.015129 = 0\n$$\n最大根是：\n$$\n\\lambda'_{\\max} = \\frac{0.303 + \\sqrt{(-0.303)^2 - 4(1)(0.015129)}}{2} = \\frac{0.303 + \\sqrt{0.031293}}{2} \\approx 0.2399491\n$$\n$M$ 的最大特征值是 $\\lambda_{\\max}(M) = \\lambda'_{\\max}/1.64$：\n$$\n\\lambda_{\\max}(M) \\approx \\frac{0.2399491}{1.64} \\approx 0.1463104\n$$\n收敛率是 $\\rho = \\sqrt{\\lambda_{\\max}(M)}$：\n$$\n\\rho \\approx \\sqrt{0.1463104} \\approx 0.3825055\n$$\n\n**第3部分：绝对差异 $d$ 的计算**\n\n问题要求使用 $A$ 范数下的误差缩减与 $A^{-1}$ 范数下的残差缩减之间的关系。让我们来建立这个关系。第 $k$ 次迭代的误差 $e_k$ 按 $e_{k+1} = E e_k$ 演化。残差 $r_k$ 由 $r_k = A e_k$ 给出。因此，残差的传播是：\n$$\nr_{k+1} = A e_{k+1} = A (E e_k) = A E (A^{-1} r_k) = (A E A^{-1}) r_k\n$$\n残差缩减因子是在 $A^{-1}$ 范数下测量的残差传播算子 $E_r = A E A^{-1}$ 的范数。\n$$\n\\|E_r\\|_{A^{-1}}^2 = \\|A E A^{-1}\\|_{A^{-1}}^2 = \\sup_{r \\neq 0} \\frac{\\|(A E A^{-1}) r\\|_{A^{-1}}^2}{\\|r\\|_{A^{-1}}^2} = \\sup_{r \\neq 0} \\frac{((A E A^{-1}) r)^{\\top} A^{-1} ((A E A^{-1}) r)}{r^{\\top} A^{-1} r}\n$$\n使用 $(X Y Z)^{\\top} = Z^{\\top} Y^{\\top} X^{\\top}$，以及 $A$ 的对称性（这意味着 $A^{-1}$ 也是对称的）：\n$$\n\\|E_r\\|_{A^{-1}}^2 = \\sup_{r \\neq 0} \\frac{r^{\\top} (A^{-1})^{\\top} E^{\\top} A^{\\top} A^{-1} A E A^{-1} r}{r^{\\top} A^{-1} r} = \\sup_{r \\neq 0} \\frac{r^{\\top} A^{-1} E^{\\top} A E A^{-1} r}{r^{\\top} A^{-1} r}\n$$\n让我们做替换 $x = A^{-1} r$，这意味着 $r = A x$。\n$$\n\\|E_r\\|_{A^{-1}}^2 = \\sup_{x \\neq 0} \\frac{(A x)^{\\top} A^{-1} E^{\\top} A E A^{-1} (A x)}{(A x)^{\\top} A^{-1} (A x)} = \\sup_{x \\neq 0} \\frac{x^{\\top} A^{\\top} A^{-1} E^{\\top} A E x}{x^{\\top} A^{\\top} A^{-1} A x} = \\sup_{x \\neq 0} \\frac{x^{\\top} E^{\\top} A E x}{x^{\\top} A x}\n$$\n最终的表达式恰好是 $\\|E\\|_{A}^2$ 的定义。因此，该关系是一个等式：\n$$\n\\|A E A^{-1}\\|_{A^{-1}} = \\|E\\|_{A} = \\rho\n$$\n理论上预测的 $A^{-1}$ 范数下的残差缩减因子与 $A$ 范数下的误差收敛因子是相同的。问题提供了一个观测到的残差缩减值 $0.312$，我们将其与我们计算出的理论值 $\\rho$ 进行比较。差异 $d$ 是：\n$$\nd = |\\rho - 0.312| \\approx |0.3825055 - 0.312| = 0.0705055\n$$\n四舍五入到四位有效数字，我们得到：\n$$\nd \\approx 0.07051\n$$",
            "answer": "$$\n\\boxed{0.07051}\n$$"
        },
        {
            "introduction": "一个稳健的AMG求解器必须能够处理各种具有挑战性的问题，包括由物理守恒律产生的奇异系统。本练习  是一个编程实践，旨在验证AMG方法的一个关键特性：零空间保持。你将为一个具有多个孤立连通分支（代表物理上的零空间）的诺伊曼问题构建图拉普拉斯算子，并实现一个简单的光滑聚合AMG设置，以编程方式验证粗网格算子是否正确地继承了细网格的零空间维度，从而保证了算法的稳定性。",
            "id": "3611418",
            "problem": "考虑在具有孤立孔隙簇和纯 Neumann（零通量）边界条件的孔隙网络图上的离散扩散，这是计算地球物理学中的一个典型场景。其离散算子是图拉普拉斯算子，它在每个节点上强制通量守恒。在不连通图上施加纯 Neumann 边界条件时，拉普拉斯算子的零空间由每个连通分量上的分段常数向量张成。这导致预期的零空间维度等于不连通分量的数量。代数多重网格（AMG）方法必须保持这个零空间，以避免在粗糙层级上引入伪奇异点。\n\n将使用的基本依据和定义：\n- 图的离散守恒定律意味着离开一个节点的通量之和为零，这产生一个行和为零的图拉普拉斯矩阵 $A \\in \\mathbb{R}^{N \\times N}$：对每一行 $i$，$\\sum_{j=1}^{N} A_{ij} = 0$。\n- 图拉普拉斯算子定义为 $A = D - W$，其中 $W$ 是邻接（或权重）矩阵，$D$ 是对角度矩阵，其元素为 $D_{ii} = \\sum_{j=1}^{N} W_{ij}$。\n- 在此离散设置中，纯 Neumann 边界条件意味着每个连通分量上的常数向量都位于 $A$ 的零空间中，因此零空间维度等于连通分量的数量。\n- 通过光滑聚合的代数多重网格（AMG）粗化方法，从近似零空间向量和聚合构建一个延拓算子 $P \\in \\mathbb{R}^{N \\times n_c}$（其中 $n_c$ 是粗糙未知量），并形成一个粗糙算子 $A_c = P^{\\top} A P$。光滑聚合采用 Jacobi 型光滑器 $S = I - \\omega D^{-1} A$ 应用于试探性延拓列，其中 $I$ 是单位矩阵，$\\omega \\in (0,2)$ 是一个松弛参数，$D^{-1}$ 是对角度矩阵的逆（约定对应于零对角线元素的项被视为零）。\n- 目标是验证细层级零空间维度等于连通分量的数量，并且粗层级零空间维度等于聚合的数量，从而证明 AMG 能够保持零空间，并避免在由 Neumann 边界条件产生的预期零空间之外创建奇异的粗糙算子。\n\n你的任务是编写一个完整的程序，该程序：\n1. 构建具有不连通分量的玩具孔隙网络图。对于每个测试用例，使用单位边权重和纯 Neumann 边界条件（即，不进行修改以强制执行 Dirichlet 条件）来组装对称图拉普拉斯算子 $A$。\n2. 定义与不连通分量相等的聚合。对于每个聚合，形成一个等于该分量的分段常数近似零空间向量的试探性延拓列，对每个试探性列应用带有固定松弛参数 $\\omega$ 的 Jacobi 光滑器 $S = I - \\omega D^{-1} A$，并将所得列归一化为单位欧几里得范数。通过堆叠这些经过光滑化和归一化的列来组装延拓算子 $P$。\n3. 形成粗糙算子 $A_c = P^{\\top} A P$。\n4. 使用特征值分析计算 $A$ 和 $A_c$ 的零空间维度，将小于或等于一个小的非负容差 $\\tau$ 的特征值计为零。在所有测试中使用固定的容差 $\\tau$。\n5. 对于每个测试用例，返回一个布尔值列表 $[\\text{fine\\_ok}, \\text{coarse\\_ok}]$，其中如果 $A$ 的零空间维度等于不连通分量的数量，则 $\\text{fine\\_ok}$ 为真；如果 $A_c$ 的零空间维度等于聚合的数量（此处聚合数量被设置为等于不连通分量的数量），则 $\\text{coarse\\_ok}$ 为真。\n\n使用以下测试套件，其中每个簇由节点数和单位权重的无向边列表指定：\n- 测试用例 1（正常路径）：三个不连通的簇。\n  - 簇 1：4 个节点，边为 $(0,1)$, $(1,2)$, $(2,3)$。\n  - 簇 2：5 个节点，边为 $(0,1)$, $(1,2)$, $(2,3)$, $(3,4)$。\n  - 簇 3：3 个节点，边为 $(0,1)$, $(1,2)$。\n- 测试用例 2（边界条件）：一个孤立节点（一个簇，含 1 个节点，无边）。\n- 测试用例 3（具有不同连通性的边缘情况）：两个不连通的簇。\n  - 簇 1：3 个节点，边为 $(0,1)$, $(1,2)$。\n  - 簇 2：3 个节点形成一个三角形，边为 $(0,1)$, $(1,2)$, $(2,0)$。\n\n数值规格：\n- 在 Jacobi 光滑器 $S = I - \\omega D^{-1} A$ 中使用 $\\omega = 0.8$。\n- 使用 $\\tau = 10^{-10}$ 进行基于特征值的零空间检测。\n- 所有角度（如果使用）必须以弧度为单位。此任务不需要物理单位。\n- 所有数组均为纯数学形式；输出中没有物理单位。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身也是一个用方括号括起来的逗号分隔列表。例如，输出应类似于 $[[\\text{True},\\text{True}],[\\text{True},\\text{False}],\\ldots]$，该行中任何地方都没有空格。\n\n您的程序必须是自包含的，对三个指定的测试用例执行上述步骤，并以所描述的精确格式输出布尔结果。",
            "solution": "该问题要求验证代数多重网格（AMG）方法在应用于具有多个零空间向量的问题时的基本性质，例如在不连通域上具有纯 Neumann 边界条件的扩散问题。具体来说，我们必须确认光滑聚合 AMG 方法能正确保持离散算子的零空间，确保粗网格问题是适定的，并且不会引入伪奇异点。验证过程包括：构建细网格算子，应用 AMG 设置过程的一个步骤以获得粗网格算子，然后将两个算子的零空间维度与其理论预期值进行比较。\n\n首先，我们为每个测试用例建立孔隙网络图模型。一个包含 $N$ 个总节点的图由一个对称权重矩阵 $W \\in \\mathbb{R}^{N \\times N}$ 表示，其中 $W_{ij} = W_{ji}$ 是节点 $i$ 和 $j$ 之间边的权重（此处所有权重均为 1），如果不存在边，则 $W_{ij} = 0$。然后，图拉普拉斯算子 $A \\in \\mathbb{R}^{N \\times N}$ 被构造为 $A = D - W$。这里，$D$ 是对角度矩阵，其元素为 $D_{ii} = \\sum_{j=1}^{N} W_{ij}$，表示连接到节点 $i$ 的边的权重之和。这种构造确保了 $A$ 的行和为零，即对于所有 $i$，都有 $\\sum_{j=1}^{N} A_{ij} = 0$。在纯 Neumann（零通量）边界条件下，该性质是守恒定律（例如，质量守恒或能量守恒）的离散模拟。\n\n对于一个有 $k$ 个连通分量的不连通图，其对应的拉普拉斯算子 $A$ 的零空间维度为 $k$。该零空间的基向量是分段常数向量，即在一个连通分量上为常数而在其他地方为零的向量。我们的第一个验证步骤，即得到布尔值 $\\text{fine\\_ok}$，是数值计算细网格算子 $A$ 的零空间维度，并检查它是否等于测试用例中给出的不连通分量的数量。零空间维度通过计算 $A$ 的特征值中为零的数量来确定，这在数值容差 $\\tau = 10^{-10}$ 内进行。我们使用特征值的绝对值进行此检查，即 $|\\lambda| \\le \\tau$。\n\n接下来，我们利用光滑聚合的原理构造粗网格算子 $A_c$。AMG 的核心思想是在更粗的网格上表示收敛缓慢（光滑）的误差分量。对于 Neumann 问题，最光滑的分量就是零空间向量本身。AMG 必须在粗糙表示中保持这些向量才能有效。\n\n1.  **聚合**：我们将聚合定义为图的连通分量。因此，聚合的数量 $n_c$ 等于连通分量的数量 $k$。\n\n2.  **试探性延拓**：对于 $n_c$ 个聚合中的每一个，我们都形成一个试探性延拓向量。这个向量是该聚合的特征向量——对于该聚合内的所有节点，其值为 1，对于该聚合外的所有节点，其值为 0。这些向量构成了细网格零空间的基。\n\n3.  **光滑化**：然后对每个试探性延拓向量进行光滑处理。指定的光滑器是 Jacobi 型光滑器，由算子 $S = I - \\omega D^{-1} A$ 定义，其中 $I$ 是单位矩阵，$\\omega = 0.8$ 是松弛参数，$D^{-1}$ 是 $D$ 对角线元素的逆。对于任何 $D_{ii} = 0$ 的孤立节点 $i$，对应的项 $(D^{-1})_{ii}$ 取为 0。该光滑器的一个关键性质是它不会改变 $A$ 的零空间中的向量。如果 $\\mathbf{v}$ 是一个零空间向量，那么 $A\\mathbf{v} = \\mathbf{0}$。应用光滑器得到 $S\\mathbf{v} = (I - \\omega D^{-1} A)\\mathbf{v} = I\\mathbf{v} - \\omega D^{-1}(A\\mathbf{v}) = \\mathbf{v} - \\mathbf{0} = \\mathbf{v}$。由于我们的试探性延拓算子正是零空间向量，因此光滑步骤不会改变它们。\n\n4.  **延拓算子 $P$**：延拓算子 $P \\in \\mathbb{R}^{N \\times n_c}$ 的列是通过取每个（未改变的）试探性向量并将其归一化为单位欧几里得范数而形成的。\n\n最后，使用伽辽金（Galerkin）投影形成粗网格算子 $A_c \\in \\mathbb{R}^{n_c \\times n_c}$：$A_c = P^{\\top} A P$。由于 $P$ 的列（表示为 $\\mathbf{p}_j$）是细网格零空间向量的线性组合，对于每个列 $j = 1, \\dots, n_c$，我们有 $A\\mathbf{p}_j = \\mathbf{0}$。因此，粗网格算子的每个元素都应为零：$(A_c)_{ij} = \\mathbf{p}_i^{\\top} A \\mathbf{p}_j = \\mathbf{p}_i^{\\top} (\\mathbf{0}) = 0$。因此，$A_c$ 应该是大小为 $n_c \\times n_c$ 的零矩阵。零矩阵的零空间是整个空间，所以其维度是 $n_c$。第二个验证步骤，即得到 $\\text{coarse\\_ok}$，是计算 $A_c$ 的零空间维度（通过在容差 $\\tau$ 内计算其零特征值的数量），并检查它是否等于聚合的数量 $n_c$。\n\n以下程序为三个指定的测试用例实现了这整个过程。它构建矩阵 $A$ 和 $P$，计算 $A_c$，并执行特征值分析以确定用于验证的零空间维度。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the AMG nullspace preservation test for all cases.\n    \"\"\"\n\n    # Numerical specifications from the problem statement\n    omega = 0.8\n    tau = 1e-10\n\n    # Test case definitions\n    test_cases = [\n        # Test case 1: three disconnected clusters\n        [\n            {'nodes': 4, 'edges': [(0, 1), (1, 2), (2, 3)]},\n            {'nodes': 5, 'edges': [(0, 1), (1, 2), (2, 3), (3, 4)]},\n            {'nodes': 3, 'edges': [(0, 1), (1, 2)]},\n        ],\n        # Test case 2: a single isolated node\n        [\n            {'nodes': 1, 'edges': []},\n        ],\n        # Test case 3: two disconnected clusters with varied connectivity\n        [\n            {'nodes': 3, 'edges': [(0, 1), (1, 2)]},\n            {'nodes': 3, 'edges': [(0, 1), (1, 2), (2, 0)]},\n        ],\n    ]\n\n    all_results = []\n    for clusters in test_cases:\n        num_clusters = len(clusters)\n        \n        # Determine total number of nodes and build node offset map\n        total_nodes = sum(c['nodes'] for c in clusters)\n        node_offsets = np.cumsum([0] + [c['nodes'] for c in clusters[:-1]])\n        \n        # 1. Construct the symmetric graph Laplacian A\n        W = np.zeros((total_nodes, total_nodes))\n        for i, cluster in enumerate(clusters):\n            offset = node_offsets[i]\n            for u, v in cluster['edges']:\n                # Use unit edge weights\n                W[offset + u, offset + v] = 1.0\n                W[offset + v, offset + u] = 1.0\n        \n        d_diag = np.sum(W, axis=1)\n        D = np.diag(d_diag)\n        A = D - W\n        \n        # 4. Compute the nullspace dimension of A\n        eigvals_A = np.linalg.eigh(A)[0]\n        dim_null_A = np.sum(np.abs(eigvals_A) = tau)\n        \n        fine_ok = (dim_null_A == num_clusters)\n        \n        # 2. Define aggregates and construct prolongation operator P\n        # Aggregates are the disconnected components\n        num_aggregates = num_clusters\n        \n        # Construct the Jacobi smoother S = I - omega * D_inv * A\n        d_inv_diag = np.zeros(total_nodes)\n        non_zero_diag = d_diag > 0\n        d_inv_diag[non_zero_diag] = 1.0 / d_diag[non_zero_diag]\n        D_inv = np.diag(d_inv_diag)\n        S = np.identity(total_nodes) - omega * (D_inv @ A)\n        \n        p_cols = []\n        for i in range(num_clusters):\n            # Form tentative prolongation column (piecewise constant vector)\n            p_tentative = np.zeros(total_nodes)\n            offset = node_offsets[i]\n            num_cluster_nodes = clusters[i]['nodes']\n            p_tentative[offset : offset + num_cluster_nodes] = 1.0\n            \n            # Apply smoother\n            p_smoothed = S @ p_tentative\n            \n            # Normalize the resulting column\n            norm = np.linalg.norm(p_smoothed)\n            if norm > 1e-15: # Avoid division by zero\n                p_col = p_smoothed / norm\n            else:\n                p_col = p_smoothed\n                \n            p_cols.append(p_col)\n            \n        P = np.column_stack(p_cols)\n        \n        # 3. Form the coarse operator Ac\n        Ac = P.T @ A @ P\n        \n        # 4. Compute the nullspace dimension of Ac\n        eigvals_Ac = np.linalg.eigh(Ac)[0]\n        dim_null_Ac = np.sum(np.abs(eigvals_Ac) = tau)\n        \n        coarse_ok = (dim_null_Ac == num_aggregates)\n        \n        # 5. Store the boolean results for the current test case\n        all_results.append([fine_ok, coarse_ok])\n\n    # Format the final output string as specified: [[...],[...],...]\n    case_strs = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(case_strs)}]\")\n\nsolve()\n```"
        }
    ]
}