{
    "hands_on_practices": [
        {
            "introduction": "各向异性介质的一个显著特征是，波的偏振方向通常不与相传播方向完全平行或垂直。本练习将指导您直接从克里斯托夫（Christoffel）方程计算准压缩波（$qP$）和准剪切波（$qSV$）的偏振矢量。通过计算倾斜角，您将具体理解为何这些模式被称为“准波”，以及此现象如何随传播方向和各向异性强度而变化。",
            "id": "3575984",
            "problem": "您需要实现一个完整的、自包含的程序。对于具有垂直对称轴的横向各向同性弹性介质（垂直横向各向同性，VTI），该程序需要从第一性原理出发，计算准压缩波（qP）和准纵向剪切波（qSV）的偏振矢量，并报告这些偏振相对于相法线倾斜的角度（作为极角的函数）。您的推导和实现必须从线性弹性动力学方程和线性弹性本构关系开始，经过平面波拟设和 Christoffel 公式，而不能调用任何为各向异性波预先打包的快捷公式。该计算方法必须是通用的，并且必须通过求解为指定对称性和传播方向构建的 Christoffel 矩阵的特征矢量来确定偏振。模式的分类必须通过符合逻辑的、基于物理的标准来完成，而不是通过假设类似各向同性的排序。\n\n基本原理：\n- 以索引符号表示的线性弹性动力学和胡克定律 (Hooke's law)：弹性介质中小变形的线性动量平衡由 $c_{ijkl} \\, \\partial_j \\partial_l u_k = \\rho \\, \\partial_t^2 u_i$ 给出，其中 $u_i$ 是位移，$\\rho$ 是质量密度，$c_{ijkl}$ 是具有适用于线性弹性的次要和主要对称性的四阶刚度张量。\n- 平面波拟设：寻找形式为 $u_i(\\mathbf{x},t) = A_i \\exp\\left(i \\omega \\left(t - \\mathbf{n} \\cdot \\mathbf{x} / v\\right)\\right)$ 的解，其中 $\\omega$ 是角频率，$v$ 是相速度，$\\mathbf{n}$ 是单位相法线（波前法线的方向）。\n- Christoffel 公式：代入平面波拟设可得到特征问题 $\\Gamma_{ik} A_k = \\rho v^2 A_i$，其中 Christoffel 矩阵为 $\\Gamma_{ik} = c_{ijkl} n_j n_l$。\n\n设置和约束：\n- 对称类别是垂直横向各向同性 (VTI)，其对称轴与 $z$ 轴对齐。使用 Voigt 记法，通过独立分量 $\\{c_{11}, c_{33}, c_{44}, c_{66}, c_{13}\\}$ 对刚度张量进行参数化，并强制执行 VTI 恒等式 $c_{66} = \\left(c_{11} - c_{12}\\right)/2$，由此可确定 $c_{12} = c_{11} - 2 c_{66}$。\n- 由于轴对称性，考虑传播被限制在 $x$–$z$ 平面内，单位相法线 $\\mathbf{n}$ 由从 $z$ 轴（对称轴）测量的极角 $\\theta$ 参数化。使用 $\\mathbf{n}(\\theta) = \\left(\\sin \\theta, 0, \\cos \\theta\\right)$。\n- 对于每个传播方向，使用上述定义从第一性原理出发构建 Christoffel 矩阵，并求解得到的 $3 \\times 3$ 特征问题，以获得三种波模式及其偏振矢量。在这些模式中，将偏振的 $y$ 分量绝对值最大的模式识别为 SH 模式；其余两种模式为 qP 和 qSV。在这剩下的两种模式中，将其偏振与相法线 $\\mathbf{n}$ 的内积绝对值最大的模式识别为 qP 模式；另一个则为 qSV 模式。\n- 对于每个感兴趣的模式（qP 和 qSV），将相对于相法线的倾斜角 $\\alpha$ 定义为单位偏振矢量 $\\hat{\\mathbf{a}}$ 与 $\\mathbf{n}$ 之间在 $[0, \\pi/2]$ 区间内的锐角，由 $\\alpha = \\arccos\\left(\\left| \\hat{\\mathbf{a}} \\cdot \\mathbf{n} \\right|\\right)$ 给出，其中 $\\hat{\\mathbf{a}}$ 是单位偏振矢量。以度为单位报告倾斜角。\n\n角度单位和物理单位：\n- 角度 $\\theta$ 以度为单位指定，并且所有倾斜角都必须以度为单位报告。\n- 刚度 $c_{ij}$ 的单位是帕斯卡 (Pa)，密度 $\\rho$ 的单位是千克每立方米 (kg/m$^3$)。程序不会直接输出速度，但物理量在量纲上必须保持一致。\n\n测试套件：\n对于每个测试用例，计算极角 $\\theta \\in \\{0^\\circ, 30^\\circ, 60^\\circ, 90^\\circ\\}$ 时的 qP 和 qSV 倾斜角。\n\n- 测试用例 1（嵌入 VTI 形式的各向同性参考）：\n  - $\\rho = 2500 \\ \\text{kg/m}^3$\n  - $c_{11} = 80 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 80 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 30 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 30 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 20 \\times 10^9 \\ \\text{Pa}$\n  - 这对应于拉梅参数 (Lamé parameters) $\\lambda = 20 \\times 10^9 \\ \\text{Pa}$ 和 $\\mu = 30 \\times 10^9 \\ \\text{Pa}$。\n\n- 测试用例 2（弱 VTI）：\n  - $\\rho = 2400 \\ \\text{kg/m}^3$\n  - $c_{11} = 60 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 55 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 20 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 25 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 18 \\times 10^9 \\ \\text{Pa}$\n  - 强制执行 $c_{12} = c_{11} - 2 c_{66} = 10 \\times 10^9 \\ \\text{Pa}$。\n\n- 测试用例 3（强 VTI）：\n  - $\\rho = 2700 \\ \\text{kg/m}^3$\n  - $c_{11} = 100 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 50 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 15 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 35 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 12 \\times 10^9 \\ \\text{Pa}$\n  - 强制执行 $c_{12} = c_{11} - 2 c_{66} = 30 \\times 10^9 \\ \\text{Pa}$。\n\n所需输出：\n- 对于每个测试用例，输出两个浮点数列表（以度为单位），每个列表长度为 4，分别对应于 $\\theta = [0, 30, 60, 90]$ 度，并四舍五入到六位小数：\n  1. qP 倾斜角列表。\n  2. qSV 倾斜角列表。\n- 将所有测试用例的结果汇总到一个长度为 3 的顶层列表中，其中每个元素是上述描述的列表对。\n- 最终输出格式：您的程序应生成一行包含嵌套列表的输出，不含空格，使用逗号分隔值和方括号。例如，整体结构必须如下所示：`[[[qP_case1],[qSV_case1]],[[qP_case2],[qSV_case2]],[[qP_case3],[qSV_case3]]]`，其中每个括号块包含针对指定角度的四个四舍五入后的浮点数。\n\n约束和说明：\n- 程序必须是独立的，且不得需要任何外部输入；它必须计算并以单行形式打印出三个测试用例的指定嵌套列表。\n- 程序必须严格通过求解每个方向的 Christoffel 特征问题并按指定方式对模式进行分类来计算偏振和倾斜。\n- 所有提供和报告的角度都必须以度为单位。所有报告的浮点数必须四舍五入到六位小数。",
            "solution": "该问题要求在具有垂直对称轴的横向各向同性介质（VTI）中，计算准压缩波（qP）和准纵向剪切波（qSV）的偏振倾斜角。计算必须从线性弹性的第一性原理开始，并针对多个传播方向和多组弹性参数进行。\n\n### 基于原理的推导和算法设计\n\n**1. 弹性动力学波动方程与平面波拟设**\n\n连续介质中小振幅弹性波的基本控制方程是线性弹性动力学方程，它代表了线性动量的平衡。以索引符号表示，其形式为：\n$$\n\\partial_j \\sigma_{ij} = \\rho \\, \\partial_t^2 u_i\n$$\n其中 $\\sigma_{ij}$ 是二阶应力张量，$u_i$ 是位移矢量，$\\rho$ 是质量密度，$t$ 是时间，$\\partial_j$ 表示对空间坐标 $x_j$ 的偏导数。这里隐含了对重复指标求和的约定。\n\n应力张量通过线性弹性的本构关系，即胡克定律（Hooke's Law），与应变张量 $\\epsilon_{kl} = \\frac{1}{2}(\\partial_l u_k + \\partial_k u_l)$ 相关联：\n$$\n\\sigma_{ij} = c_{ijkl} \\epsilon_{kl}\n$$\n此处，$c_{ijkl}$ 是四阶刚度张量，它表征了介质的弹性特性。将本构关系代入弹性动力学方程得到：\n$$\nc_{ijkl} \\, \\partial_j \\partial_l u_k = \\rho \\, \\partial_t^2 u_i\n$$\n\n我们寻找平面波解，它描述的是具有平面波前的波。一个平面波解通过以下拟设来表示：\n$$\nu_i(\\mathbf{x},t) = A_i \\exp\\left(i \\omega \\left(t - \\frac{\\mathbf{n} \\cdot \\mathbf{x}}{v}\\right)\\right)\n$$\n其中 $A_i$ 是定义质点运动方向的恒定偏振矢量，$\\omega$ 是角频率，$\\mathbf{n}$ 是垂直于波前（即相法线）的单位矢量，$v$ 是相速度，而 $i = \\sqrt{-1}$。\n\n**2. Christoffel 公式**\n\n将平面波拟设代入弹性动力学方程涉及对指数函数求导：\n- $\\partial_l u_k = \\left(-\\frac{i\\omega}{v} n_l\\right) u_k$\n- $\\partial_j \\partial_l u_k = \\left(-\\frac{i\\omega}{v} n_j\\right) \\left(-\\frac{i\\omega}{v} n_l\\right) u_k = -\\frac{\\omega^2}{v^2} n_j n_l u_k$\n- $\\partial_t^2 u_i = (i\\omega)^2 u_i = -\\omega^2 u_i$\n\n将这些导数代入弹性动力学方程可得：\n$$\nc_{ijkl} \\left(-\\frac{\\omega^2}{v^2} n_j n_l\\right) A_k \\exp(\\dots) = \\rho \\left(-\\omega^2\\right) A_i \\exp(\\dots)\n$$\n消去公因子 $-\\omega^2 \\exp(\\dots)$ 并重新整理，我们得到 Christoffel 方程，这是一个代数特征值问题：\n$$\n(c_{ijkl} n_j n_l) A_k = \\rho v^2 A_i\n$$\n这可以紧凑地写成：\n$$\n\\Gamma_{ik} A_k = \\lambda A_i\n$$\n其中 $\\Gamma_{ik} = c_{ijkl} n_j n_l$ 是 Christoffel 矩阵（或声学张量），特征值为 $\\lambda = \\rho v^2$。对于任意给定的传播方向 $\\mathbf{n}$，这个 $3 \\times 3$ 系统会产生三个特征值和三个对应的特征矢量。特征矢量 $A_i$ 是偏振矢量，而特征值决定了三种可能波模式的相速度。\n\n**3. VTI 对称性与 Christoffel 矩阵构建**\n\n问题指定了一个 VTI 介质，其对称轴与 $z$ 轴 ($x_3$) 对齐。这种介质的刚度张量，用 $6 \\times 6$ Voigt 矩阵记法表示为：\n$$\nC = \\begin{pmatrix}\nc_{11} & c_{12} & c_{13} & 0 & 0 & 0 \\\\\nc_{12} & c_{11} & c_{13} & 0 & 0 & 0 \\\\\nc_{13} & c_{13} & c_{33} & 0 & 0 & 0 \\\\\n0 & 0 & 0 & c_{44} & 0 & 0 \\\\\n0 & 0 & 0 & 0 & c_{44} & 0 \\\\\n0 & 0 & 0 & 0 & 0 & c_{66}\n\\end{pmatrix}\n$$\n并带有 VTI 特有的约束条件 $c_{12} = c_{11} - 2c_{66}$。\n\n由于轴对称性，波的性质仅取决于相法线 $\\mathbf{n}$ 与对称轴（$z$ 轴）之间的极角 $\\theta$。因此，我们可以在不失一般性的情况下，将分析限制在 $x-z$ 平面内的传播。此时相法线矢量为 $\\mathbf{n} = (\\sin\\theta, 0, \\cos\\theta)$。\n\n将 VTI 刚度分量和 $n_x=\\sin\\theta, n_y=0, n_z=\\cos\\theta$ 代入 $\\Gamma_{ik}$ 的通用表达式，可得到此情况下的特定 Christoffel 矩阵：\n$$\n\\Gamma = \\begin{pmatrix}\nc_{11} \\sin^2\\theta + c_{44} \\cos^2\\theta & 0 & (c_{13}+c_{44}) \\sin\\theta \\cos\\theta \\\\\n0 & c_{66} \\sin^2\\theta + c_{44} \\cos^2\\theta & 0 \\\\\n(c_{13}+c_{44}) \\sin\\theta \\cos\\theta & 0 & c_{44} \\sin^2\\theta + c_{33} \\cos^2\\theta\n\\end{pmatrix}\n$$\n该矩阵是块对角矩阵。矩阵的 (2,2) 元素（从块结构上看）对应纯粹在 $y$ 方向上的运动，与 $x-z$ 平面内的运动解耦。这对应于水平剪切波（SH 波）。剩下的 $2 \\times 2$ 子矩阵控制着耦合的准压缩波（qP）和准纵向剪切波（qSV），它们的偏振位于 $x-z$ 平面内。\n\n**4. 模式分类与倾斜角计算**\n\n对于每个传播方向 $\\theta$，算法如下：\n1.  **构建 $\\Gamma(\\theta)$**：使用给定的弹性参数和角度 $\\theta$。\n2.  **求解特征问题**：求解特征值问题 $\\Gamma \\mathbf{A} = \\lambda \\mathbf{A}$。由于 $\\Gamma$ 是一个实对称矩阵，这会产生三个实特征值和一组三个相互正交的特征矢量。我们使用一个数值库函数 (`numpy.linalg.eigh`) 来获取特征值和相应的归一化特征矢量。\n3.  **识别 SH 模式**：SH 模式的特点是其偏振垂直于 $x-z$ 平面。其特征矢量形式为 $(0, c, 0)$，其中 $c$ 是归一化常数。我们通过找到其 $y$ 分量绝对值最大的特征矢量来识别 SH 模式。\n4.  **识别 qP 和 qSV 模式**：剩下的两个特征矢量对应于 qP 和 qSV 模式。qP 模式是“准纵向的”，意味着其偏振矢量比 qSV 模式更接近于与相法线 $\\mathbf{n}$ 对齐。qSV 模式是“准横向的”，其偏振更趋向于垂直于 $\\mathbf{n}$。我们通过计算每个偏振矢量与 $\\mathbf{n}$ 之间点积的绝对值来形式化这一标准。点积绝对值较大的模式被分类为 qP，另一个则为 qSV。\n5.  **计算倾斜角**：倾斜角 $\\alpha$ 是模式偏振矢量 $\\hat{\\mathbf{a}}$ 与相法线 $\\mathbf{n}$ 之间的锐角。它使用公式：\n    $$\n    \\alpha = \\arccos(|\\hat{\\mathbf{a}} \\cdot \\mathbf{n}|)\n    $$\n    进行计算。`arccos` 的结果以弧度为单位，必须转换为度才能用于最终输出。对于 qP 和 qSV 模式，由于它们的偏振矢量相互正交且与 $\\mathbf{n}$ 位于同一平面内，它们的倾斜角满足关系 $\\alpha_{\\text{qP}} + \\alpha_{\\text{qSV}} = 90^\\circ$。这是一个有价值的一致性检查。对于沿对称轴（$\\theta = 0^\\circ$ 和 $\\theta = 90^\\circ$）的传播，波是纯模式（P、SV、SH），导致 qP 的倾斜角为 $0^\\circ$，qSV 的倾斜角为 $90^\\circ$。各向同性介质（测试用例 1）也表现出纯模式，这意味着这些倾斜角应该对所有传播方向都成立。\n\n这个基于第一性原理的详细程序被实施于每个测试用例，以计算所需的倾斜角。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation for all test cases and print the final result.\n    \"\"\"\n    \n    # Test cases defined as (density, c11, c33, c44, c66, c13).\n    # Stiffnesses are in GPa; they will be scaled by 1e9 in the calculation function.\n    test_cases = [\n        # Test Case 1 (Isotropic reference)\n        (2500, 80e9, 80e9, 30e9, 30e9, 20e9),\n        # Test Case 2 (Weak VTI)\n        (2400, 60e9, 55e9, 20e9, 25e9, 18e9),\n        # Test Case 3 (Strong VTI)\n        (2700, 100e9, 50e9, 15e9, 35e9, 12e9),\n    ]\n\n    angles_deg = [0.0, 30.0, 60.0, 90.0]\n    \n    all_results = []\n    for params in test_cases:\n        qp_tilts, qsv_tilts = compute_tilts(params, angles_deg)\n        all_results.append((qp_tilts, qsv_tilts))\n\n    # Format the final output string to match the exact requirement:\n    # [[[qP_case1],[qSV_case1]],[[qP_case2],[qSV_case2]],[[qP_case3],[qSV_case3]]]\n    # with no spaces and 6 decimal places for each number.\n    case_strings = []\n    for qp_tilts, qsv_tilts in all_results:\n        # Format lists of floats to strings with 6 decimal places\n        qp_str = '[' + ','.join(f'{x:.6f}' for x in qp_tilts) + ']'\n        qsv_str = '[' + ','.join(f'{x:.6f}' for x in qsv_tilts) + ']'\n        case_strings.append(f'[{qp_str},{qsv_str}]')\n    \n    final_output = '[' + ','.join(case_strings) + ']'\n    print(final_output)\n\ndef compute_tilts(params, angles_deg):\n    \"\"\"\n    Computes qP and qSV tilt angles for a given VTI medium and a list of propagation angles.\n\n    Args:\n        params (tuple): A tuple containing material properties (rho, c11, c33, c44, c66, c13).\n        angles_deg (list): A list of polar angles in degrees.\n\n    Returns:\n        tuple: A tuple of two lists: (qP_tilt_angles, qSV_tilt_angles) in degrees.\n    \"\"\"\n    _rho, c11, c33, c44, c66, c13 = params\n    \n    qp_tilts_deg = []\n    qsv_tilts_deg = []\n\n    for theta_deg in angles_deg:\n        theta_rad = np.radians(theta_deg)\n        s = np.sin(theta_rad)\n        c = np.cos(theta_rad)\n        \n        # Phase normal vector n\n        n = np.array([s, 0, c])\n\n        # Construct the 3x3 Christoffel matrix Gamma for VTI media\n        Gamma = np.zeros((3, 3))\n        Gamma[0, 0] = c11 * s**2 + c44 * c**2\n        Gamma[1, 1] = c66 * s**2 + c44 * c**2\n        Gamma[2, 2] = c44 * s**2 + c33 * c**2\n        Gamma[0, 2] = (c13 + c44) * s * c\n        Gamma[2, 0] = Gamma[0, 2]\n        \n        # Solve the eigenproblem for the symmetric Christoffel matrix\n        # eigvecs[:, i] is the normalized eigenvector corresponding to eigvals[i]\n        _eigvals, eigvecs = np.linalg.eigh(Gamma)\n\n        # Classify modes\n        pol_vectors = [eigvecs[:, i] for i in range(3)]\n        \n        # 1. Identify SH mode (polarization with largest y-component)\n        sh_idx = np.argmax(np.abs(eigvecs[1, :]))\n\n        # 2. Identify qP and qSV modes from the remaining two\n        p_sv_indices = [i for i in range(3) if i != sh_idx]\n        \n        vec1 = pol_vectors[p_sv_indices[0]]\n        vec2 = pol_vectors[p_sv_indices[1]]\n        \n        dot_prod1 = np.abs(np.dot(vec1, n))\n        dot_prod2 = np.abs(np.dot(vec2, n))\n        \n        if dot_prod1 > dot_prod2:\n            # vec1 is qP, vec2 is qSV\n            cos_alpha_qp = dot_prod1\n            cos_alpha_qsv = dot_prod2\n        else:\n            # vec2 is qP, vec1 is qSV\n            cos_alpha_qp = dot_prod2\n            cos_alpha_qsv = dot_prod1\n            \n        # 3. Calculate tilt angles in degrees\n        # np.arccos can receive values slightly > 1.0 due to float precision, so we clip.\n        alpha_qp_rad = np.arccos(np.clip(cos_alpha_qp, -1.0, 1.0))\n        alpha_qsv_rad = np.arccos(np.clip(cos_alpha_qsv, -1.0, 1.0))\n        \n        qp_tilts_deg.append(np.degrees(alpha_qp_rad))\n        qsv_tilts_deg.append(np.degrees(alpha_qsv_rad))\n        \n    return qp_tilts_deg, qsv_tilts_deg\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "各向异性介质中随方向变化的相速度，导致其传播时间与各向同性模型相比有显著差异。本练习要求您通过计算$qP$波在分层VTI和HTI介质中沿给定路径的传播时间来量化这种效应。通过将您的计算结果与简单的各向同性假设进行比较，您将体会到在地震速度分析和成像中考虑各向异性的关键重要性。",
            "id": "3576014",
            "problem": "您的任务是推导并实现一种计算方法，用以评估水平分层、横向各向同性介质中的准纵波 (qP) 走时。该介质具有垂直对称轴（垂直横向各向同性，VTI），并在一个指定情况下具有水平对称轴（水平横向各向同性，HTI）。目标是沿着固定的源-检直线路径对各向异性程函方程进行积分，并将所得的 qP 走时与各向同性预测值进行比较，以量化由各向异性引起的走时差异。\n\n从以下基本原理出发：\n- 弹性各向异性介质中的平面波传播由克里斯托夫方程 (Christoffel equation) 控制。对于 $x\\!-\\!z$ 平面内给定的传播方向（单位法向分量为 $n_x$ 和 $n_z$），该方程通过克里斯托夫矩阵的特征值问题，得到与模式相关的相速度。准纵波 (qP) 模式对应于最大的特征值。\n- 沿指定路径的走时程函积分为 $T = \\int s(\\theta)\\,\\mathrm{d}\\ell$，其中 $\\mathrm{d}\\ell$ 为微分弧长，$s(\\theta)$ 是与方向相关的相慢度 $s(\\theta) = 1/v_{\\text{phase}}(\\theta)$，而 $\\theta$ 是传播方向与介质对称轴之间的夹角。\n- 对于穿过水平分层介质的直线路径，若总接收器深度为 $Z_R$，水平偏移为 $X$，则路径方向单位向量为 $d = \\left(\\frac{X}{\\sqrt{X^2 + Z_R^2}},\\,\\frac{Z_R}{\\sqrt{X^2 + Z_R^2}}\\right)$。因此，在厚度为 $h_i$ 的第 $i$ 层内的路径长度是 $\\ell_i = h_i/d_z$，其中 $d_z$ 是 $d$ 的垂直分量。各向异性走时则为 $T_{\\text{aniso}} = \\sum_i \\ell_i\\,s_i(\\theta_i)$，而各向同性预测使用 $s_i^{\\text{iso}} = 1/\\alpha_{0,i}$，其中 $\\alpha_{0,i}$ 是第 $i$ 层的垂直P波速度，由此得到 $T_{\\text{iso}}=\\sum_i \\ell_i\\,s_i^{\\text{iso}}$。\n\n使用以下基于横向各向同性介质的 Thomsen 参数的广泛接受的参数化方法：\n- 设 $\\alpha_0$ 为垂直P波速度，$\\beta_0$ 为垂直S波速度，$\\epsilon$ 和 $\\delta$ 为 Thomsen 各向异性参数，$\\rho$ 为密度。定义用于克里斯托夫公式的类刚度量（已按质量密度缩放）：\n  $$C = \\rho\\,\\alpha_0^2,\\quad L = \\rho\\,\\beta_0^2,\\quad A = \\rho\\,\\alpha_0^2\\,(1 + 2\\epsilon),$$\n  并根据 $\\delta$ 确定 $F$：\n  $$\\delta = \\frac{(F+L)^2 - (C - L)^2}{2\\,C\\,(C - L)}\\quad\\Rightarrow\\quad F = -L + \\sqrt{(C - L)^2 + 2\\,\\delta\\,C\\,(C - L)}.$$\n这些关系参数化了 $x\\!-\\!z$ 平面中的横向各向同性 (TI) 介质。对于 VTI 层（对称轴沿 $z$ 轴），传播方向角 $\\theta$ 是与 $z$ 轴的夹角；对于 HTI 层（对称轴沿 $x$ 轴），$\\theta$ 是与 $x$ 轴的夹角。\n\n您的实现应做到：\n1. 对于每一层，通过求解适用于该对称轴方向（VTI 或 HTI）的克里斯托夫特征值问题，来计算在 $x\\!-\\!z$ 平面内传播的 qP 相速度 $v_{\\text{phase}}(\\theta)$。计算时使用定义的量 $A, C, L, F$ 和密度 $\\rho$。\n2. 通过对各层的 $s_i(\\theta_i)\\,\\ell_i$ 求和，计算沿固定直线路径的各向异性走时 $T_{\\text{aniso}}$，其中 $\\ell_i = h_i/d_z$ 且 $s_i(\\theta_i) = 1/v_{\\text{phase},i}(\\theta_i)$。\n3. 使用 $s_i^{\\text{iso}} = 1/\\alpha_{0,i}$，沿同一路径计算各向同性走时 $T_{\\text{iso}}$。\n4. 输出由各向异性引起的走时差异 $\\Delta T = T_{\\text{aniso}} - T_{\\text{iso}}$。\n\n使用以下测试套件，其中所有距离单位为米，速度单位为米/秒，密度单位为千克/立方米，角度单位为弧度，走时单位为秒：\n- 测试 1（单个 VTI 层，中等各向异性，倾斜路径）：\n  - 层：一个 VTI 层，$h_1 = 1000, \\rho_1 = 2500, \\alpha_{0,1} = 3000, \\beta_{0,1} = 1500, \\epsilon_1 = 0.20, \\delta_1 = 0.10$。\n  - 几何：$X = 1000, Z_R = h_1$。\n- 测试 2（两个 VTI 层，小偏移，中度各向异性）：\n  - 层： \n    - 第 1 层 (VTI)：$h_1 = 800, \\rho_1 = 2400, \\alpha_{0,1} = 3200, \\beta_{0,1} = 1600, \\epsilon_1 = 0.15, \\delta_1 = 0.05$。\n    - 第 2 层 (VTI)：$h_2 = 1200, \\rho_2 = 2500, \\alpha_{0,2} = 3400, \\beta_{0,2} = 1700, \\epsilon_2 = 0.10, \\delta_2 = 0.02$。\n  - 几何：$X = 500, Z_R = h_1 + h_2$。\n- 测试 3（近各向同性的 VTI，倾斜路径；边界检查）：\n  - 层：一个 VTI 层，$h_1 = 1500, \\rho_1 = 2500, \\alpha_{0,1} = 3000, \\beta_{0,1} = 1500, \\epsilon_1 = 0.00, \\delta_1 = 0.00$。\n  - 几何：$X = 1500, Z_R = h_1$。\n- 测试 4（混合方向：VTI 叠于 HTI 之上，倾斜路径）：\n  - 层：\n    - 第 1 层 (VTI)：$h_1 = 800, \\rho_1 = 2600, \\alpha_{0,1} = 3300, \\beta_{0,1} = 1800, \\epsilon_1 = 0.25, \\delta_1 = 0.05$。\n    - 第 2 层 (HTI)：$h_2 = 1200, \\rho_2 = 2500, \\alpha_{0,2} = 3200, \\beta_{0,2} = 1700, \\epsilon_2 = 0.20, \\delta_2 = 0.10$。\n  - 几何：$X = 2000, Z_R = h_1 + h_2$。\n- 测试 5（VTI，垂直路径；边界检查）：\n  - 层：\n    - 第 1 层 (VTI)：$h_1 = 600, \\rho_1 = 2500, \\alpha_{0,1} = 3100, \\beta_{0,1} = 1600, \\epsilon_1 = 0.12, \\delta_1 = 0.04$。\n    - 第 2 层 (VTI)：$h_2 = 900, \\rho_2 = 2550, \\alpha_{0,2} = 3200, \\beta_{0,2} = 1650, \\epsilon_2 = 0.10, \\delta_2 = 0.05$。\n    - 第 3 层 (VTI)：$h_3 = 500, \\rho_3 = 2600, \\alpha_{0,3} = 3300, \\beta_{0,3} = 1700, \\epsilon_3 = 0.08, \\delta_3 = 0.03$。\n  - 几何：$X = 0, Z_R = h_1 + h_2 + h_3$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表。每个条目是对应测试用例的走时差异 $\\Delta T$，四舍五入到秒的六位小数。例如，输出格式必须类似于 $[\\Delta T_1,\\Delta T_2,\\dots]$，其中每个 $\\Delta T_i$ 都是以秒为单位的小数。",
            "solution": "该问题已经过验证，并被确定为有效。它在科学上基于各向异性介质中弹性波传播的原理，在数学上是适定的，并提供了一套完整且一致的参数和目标。核心任务是计算准P波 (qP) 在各向异性模型及其各向同性参考模型中，沿着穿过多层介质的指定直线路径传播时的走时差异。这需要推导和求解横向各向同性 (TI) 介质的克里斯托夫方程。\n\n求解过程如下：首先，我们建立理论框架。波沿路径 $\\mathcal{L}$ 的走时 $T$ 由程函积分给出：\n$$T = \\int_{\\mathcal{L}} s(\\mathbf{x}, \\mathbf{n}) \\, \\mathrm{d}\\ell$$\n其中 $s$ 是相慢度，即相速度 $v_{\\text{phase}}$ 的倒数，$\\mathrm{d}\\ell$ 是微分弧长。慢度取决于位置 $\\mathbf{x}$ 和传播方向 $\\mathbf{n}$。该问题通过假设水平分层介质和从源点 $(0, 0)$ 到接收点 $(X, Z_R)$ 的固定直线路径简化了这一过程。在每个层 $i$ 内，材料属性是恒定的。整个路径上的传播方向是一致的。单位方向向量 $\\mathbf{d}$ 是：\n$$ \\mathbf{d} = (d_x, d_z) = \\left( \\frac{X}{\\sqrt{X^2 + Z_R^2}}, \\frac{Z_R}{\\sqrt{X^2 + Z_R^2}} \\right) $$\n在厚度为 $h_i$ 的层 $i$ 内的路径长度为 $\\ell_i = h_i / d_z$。总走时是各层的总和：\n$$ T = \\sum_{i} \\ell_i s_i(\\mathbf{d}) = \\sum_{i} \\frac{h_i}{d_z} \\frac{1}{v_{\\text{phase}, i}(\\mathbf{d})} $$\n\n问题的核心是确定每一层的 qP 波相速度 $v_{\\text{phase}, i}$。这个速度是通过求解克里斯托夫矩阵 $\\mathbf{\\Gamma}$ 的特征值问题得到的：\n$$ (\\mathbf{\\Gamma} - \\lambda \\mathbf{I})\\mathbf{u} = \\mathbf{0} \\quad \\text{with} \\quad \\lambda = \\rho v_{\\text{phase}}^2 $$\n其中 $\\rho$ 是密度，$\\mathbf{u}$ 是偏振矢量，$\\mathbf{I}$ 是单位矩阵。对于对称轴与 $z$ 坐标轴对齐的 TI 介质 (VTI)，且对于在 $x$-$z$ 平面内传播、方向向量为 $\\mathbf{n} = (\\sin\\theta, 0, \\cos\\theta)$ 的波，其中 $\\theta$ 是相对于对称轴（$z$ 轴）的相角，克里斯托夫矩阵由下式给出：\n$$ \\mathbf{\\Gamma} = \\begin{pmatrix} C_{11}n_x^2 + C_{55}n_z^2 & 0 & (C_{13}+C_{55})n_x n_z \\\\ 0 & C_{66}n_x^2+C_{55}n_z^2 & 0 \\\\ (C_{13}+C_{55})n_x n_z & 0 & C_{55}n_x^2 + C_{33}n_z^2 \\end{pmatrix} $$\n问题提供了一个基于 Thomsen 参数 $\\epsilon$ 和 $\\delta$，以及垂直 P 波和 S 波速度 $\\alpha_0$ 和 $\\beta_0$ 的参数化方案。弹性刚度常数 $C_{ij}$与提供的量 $A, C, L, F$ 的关系如下：$A = C_{11}$, $C = C_{33}$, $L = C_{55}$ 以及 $F = C_{13}$。问题使用了质量密度缩放版本，这对于公式 $\\lambda = \\rho v^2$ 是正确的。问题不需要 $C_{66}$ 或 $C_{12}$，因为 SH 波模式（(2,2) 元素）是解耦的，我们不关心。\n\n剩余的 $2 \\times 2$ 子矩阵控制着耦合的 qP 波和准 SV (qSV) 波。其特征值 $\\lambda = \\rho v^2$ 通过求解特征方程找到。各分量为：\n$$ \\Gamma_{11} = A\\sin^2\\theta + L\\cos^2\\theta $$\n$$ \\Gamma_{33} = L\\sin^2\\theta + C\\cos^2\\theta $$\n$$ \\Gamma_{13} = (F+L)\\sin\\theta\\cos\\theta $$\n两个特征值由下式给出：\n$$ \\lambda_{\\text{qP,qSV}} = \\frac{1}{2} \\left[ (\\Gamma_{11} + \\Gamma_{33}) \\pm \\sqrt{(\\Gamma_{11} - \\Gamma_{33})^2 + 4\\Gamma_{13}^2} \\right] $$\nqP 波对应于较大的速度，因此对应于较大的特征值，通过取正号获得。\n$$ \\lambda_{\\text{qP}} = \\frac{1}{2} \\left[ (\\Gamma_{11} + \\Gamma_{33}) + \\sqrt{(\\Gamma_{11} - \\Gamma_{33})^2 + 4\\Gamma_{13}^2} \\right] $$\nqP 相速度则为 $v_{\\text{qP}}(\\theta) = \\sqrt{\\lambda_{\\text{qP}}/\\rho}$。\n\n对于每一层 $i$，我们执行以下步骤：\n1.  计算恒定的路径方向向量分量 $d_x$ 和 $d_z$。\n2.  确定相角 $\\theta_i$。问题指定了两种方向：\n    -   **VTI（垂直横向各向同性）**：对称轴是垂直的（$z$ 轴）。角度 $\\theta_i$ 是传播方向 $\\mathbf{d}$ 和 $z$ 轴之间的夹角。因此，$\\cos\\theta_i = d_z$ 且 $\\sin\\theta_i = d_x$。\n    -   **HTI（水平横向各向同性）**：对称轴是水平的（$x$ 轴）。角度 $\\theta_i$ 是 $\\mathbf{d}$ 和 $x$ 轴之间的夹角。因此，$\\cos\\theta_i = d_x$ 且 $\\sin\\theta_i = d_z$。\n3.  根据给定的 Thomsen 参数（$\\alpha_{0,i}, \\beta_{0,i}, \\epsilon_i, \\delta_i$）和密度 $\\rho_i$ 计算类刚度量 $C_i, L_i, A_i, F_i$。\n    $$ C_i = \\rho_i \\alpha_{0,i}^2 $$\n    $$ L_i = \\rho_i \\beta_{0,i}^2 $$\n    $$ A_i = \\rho_i \\alpha_{0,i}^2 (1 + 2\\epsilon_i) $$\n    $$ F_i = -L_i + \\sqrt{(C_i - L_i)^2 + 2\\delta_i C_i (C_i - L_i)} $$\n4.  将这些代入 $\\Gamma_{11}, \\Gamma_{33}, \\Gamma_{13}$ 的表达式中，以找到 $\\lambda_{\\text{qP},i}$。\n5.  计算 qP 相速度 $v_{\\text{qP},i} = \\sqrt{\\lambda_{\\text{qP},i}/\\rho_i}$。\n6.  层内路径长度为 $\\ell_i = h_i/d_z$。注意，对于垂直路径 ($X=0$)，$d_z=1$ 且 $\\ell_i = h_i$。在这种情况下，对于 VTI 层，$\\theta_i=0$，这导致 $v_{\\text{qP},i}=\\alpha_{0,i}$ 并且 $\\Delta T = 0$，与预期相符。\n7.  该层的各向异性走时为 $T_{\\text{aniso},i} = \\ell_i / v_{\\text{qP},i}$。\n8.  该层的各向同性走时为 $T_{\\text{iso},i} = \\ell_i / \\alpha_{0,i}$。\n\n对总时间 $T_{\\text{aniso}} = \\sum_i T_{\\text{aniso},i}$ 和 $T_{\\text{iso}} = \\sum_i T_{\\text{iso},i}$ 进行求和，并为每个测试用例计算差异 $\\Delta T = T_{\\text{aniso}} - T_{\\text{iso}}$。\n\n提供的用于检查的特殊情况是：\n-   **测试 3（各向同性极限）**：当 $\\epsilon_1=0.00$ 且 $\\delta_1=0.00$ 时，我们必须有 $A_1=C_1$ 和 $F_1=C_1-2L_1$。这导致 $\\lambda_{\\text{qP},1}=C_1$，意味着对于所有角度，$v_{\\text{qP},1}=\\alpha_{0,1}$。因此，$T_{\\text{aniso}} = T_{\\text{iso}}$ 且 $\\Delta T$ 必须为 $0$。\n-   **测试 5（垂直入射）**：当 $X=0$ 时，路径是垂直的。对于 VTI 层，传播沿对称轴进行 ($\\theta=0$)。这得到 $v_{\\text{qP},i}=\\alpha_{0,i}$，因此同样地，$T_{\\text{aniso}} = T_{\\text{iso}}$ 且 $\\Delta T$ 必须为 $0$。\n\n这些检查证实了公式及其实现的正确性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the travel time difference between anisotropic and isotropic models\n    for qP-waves along a straight path in layered VTI/HTI media.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Structure: (geometry, layers_data)\n    # geometry: (X, Z_R)\n    # layers_data: list of (h, rho, alpha0, beta0, epsilon, delta, type_str)\n    test_cases = [\n        # Test 1\n        (\n            {\"X\": 1000, \"Z_R\": 1000},\n            [\n                {\"h\": 1000, \"rho\": 2500, \"alpha0\": 3000, \"beta0\": 1500, \"epsilon\": 0.20, \"delta\": 0.10, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 2\n        (\n            {\"X\": 500, \"Z_R\": 2000},\n            [\n                {\"h\": 800,  \"rho\": 2400, \"alpha0\": 3200, \"beta0\": 1600, \"epsilon\": 0.15, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 1200, \"rho\": 2500, \"alpha0\": 3400, \"beta0\": 1700, \"epsilon\": 0.10, \"delta\": 0.02, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 3\n        (\n            {\"X\": 1500, \"Z_R\": 1500},\n            [\n                {\"h\": 1500, \"rho\": 2500, \"alpha0\": 3000, \"beta0\": 1500, \"epsilon\": 0.00, \"delta\": 0.00, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 4\n        (\n            {\"X\": 2000, \"Z_R\": 2000},\n            [\n                {\"h\": 800,  \"rho\": 2600, \"alpha0\": 3300, \"beta0\": 1800, \"epsilon\": 0.25, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 1200, \"rho\": 2500, \"alpha0\": 3200, \"beta0\": 1700, \"epsilon\": 0.20, \"delta\": 0.10, \"type\": \"HTI\"}\n            ]\n        ),\n        # Test 5\n         (\n            {\"X\": 0, \"Z_R\": 2000},\n            [\n                {\"h\": 600, \"rho\": 2500, \"alpha0\": 3100, \"beta0\": 1600, \"epsilon\": 0.12, \"delta\": 0.04, \"type\": \"VTI\"},\n                {\"h\": 900, \"rho\": 2550, \"alpha0\": 3200, \"beta0\": 1650, \"epsilon\": 0.10, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 500, \"rho\": 2600, \"alpha0\": 3300, \"beta0\": 1700, \"epsilon\": 0.08, \"delta\": 0.03, \"type\": \"VTI\"}\n            ]\n        )\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        geometry, layers_data = case\n        X, Z_R = geometry[\"X\"], geometry[\"Z_R\"]\n\n        if X == 0 and Z_R == 0:\n            results.append(0.0)\n            continue\n        \n        path_length_total = np.sqrt(X**2 + Z_R**2)\n        \n        # Handle vertical path as a special case to avoid division by zero if X is used.\n        if path_length_total == 0:\n            results.append(0.0)\n            continue\n\n        d_x = X / path_length_total\n        d_z = Z_R / path_length_total\n\n        total_t_aniso = 0.0\n        total_t_iso = 0.0\n        \n        # For vertical path, dz=1, path_length_in_layer = h.\n        # For horizontal path, this model is ill-defined (h/dz -> inf).\n        # We assume Z_R > 0 for all cases as per problem description.\n        if d_z == 0:\n            # This case is not in the test suite, but would be a singularity.\n            # We can skip or raise an error. Here we assume non-horizontal paths.\n            results.append(np.nan) # Or handle as per a more detailed spec.\n            continue\n            \n        for layer in layers_data:\n            h = layer[\"h\"]\n            rho = layer[\"rho\"]\n            alpha0 = layer[\"alpha0\"]\n            beta0 = layer[\"beta0\"]\n            epsilon = layer[\"epsilon\"]\n            delta = layer[\"delta\"]\n            orientation = layer[\"type\"]\n\n            path_length_in_layer = h / d_z\n\n            # Isotropic Travel Time Contribution\n            total_t_iso += path_length_in_layer / alpha0\n\n            # Anisotropic Travel Time Contribution\n            if orientation == \"VTI\":  # Symmetry axis is z\n                cos_theta = d_z\n                sin_theta = d_x\n            elif orientation == \"HTI\":  # Symmetry axis is x\n                cos_theta = d_x\n                sin_theta = d_z\n            else:\n                raise ValueError(f\"Unknown orientation: {orientation}\")\n\n            # Calculate stiffness-like quantities\n            C = rho * alpha0**2\n            L = rho * beta0**2\n            A = rho * alpha0**2 * (1 + 2 * epsilon)\n            \n            F_term_sqrt = (C - L)**2 + 2 * delta * C * (C - L)\n            if F_term_sqrt  0:\n                raise ValueError(\"Unphysical parameters: negative term in F calculation.\")\n            F = -L + np.sqrt(F_term_sqrt)\n\n            # Christoffel matrix components for qP-qSV\n            sin2_theta = sin_theta**2\n            cos2_theta = cos_theta**2\n\n            gamma_11 = A * sin2_theta + L * cos2_theta\n            gamma_33 = L * sin2_theta + C * cos2_theta\n            gamma_13 = (F + L) * sin_theta * cos_theta\n            \n            # Solve for qP eigenvalue\n            term1 = gamma_11 + gamma_33\n            sqrt_term = np.sqrt((gamma_11 - gamma_33)**2 + 4 * gamma_13**2)\n            \n            lambda_qp = 0.5 * (term1 + sqrt_term)\n            \n            # Calculate qP phase velocity\n            v_qp = np.sqrt(lambda_qp / rho)\n\n            total_t_aniso += path_length_in_layer / v_qp\n\n        delta_T = total_t_aniso - total_t_iso\n        results.append(delta_T)\n\n    # Format output as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "为了模拟波传播的完整动力学过程，我们必须将控制物理定律转化为适合计算机处理的形式。最后的这个练习专注于推导弹性波方程的一阶速度-应力形式，这是许多高级时域有限差分（FDTD）方法的基础。您将在交错网格上对这些方程进行离散化，从而清晰地看到各向异性刚度系数如何直接进入数值更新格式。",
            "id": "3575981",
            "problem": "要求您推导并离散化在具有垂直横向各向同性（VTI）特性的介质中弹性波传播的一阶速度-应力公式，然后实现一个小型计算实验，以数值方式演示刚度各向异性如何进入交错网格上的更新方程。请从连续介质力学和线性弹性的基本定律开始，并推导出一个适用于有限差分的算法描述。\n\n使用的基本基础包括线性动量平衡和横向各向同性介质（对称轴垂直对齐）的线性弹性本构关系（胡克定律）。在一个二维 $x$–$z$ 平面上，考虑平面内准压缩波和准垂直剪切波（P–SV）系统。未知量为质点速度 $v_x(x,z,t)$ 和 $v_z(x,z,t)$ 以及柯西应力分量 $\\sigma_{xx}(x,z,t)$、$\\sigma_{zz}(x,z,t)$ 和 $\\sigma_{xz}(x,z,t)$。密度为 $\\rho(x,z)$，刚度为 $c_{11}(x,z)$、$c_{33}(x,z)$、$c_{13}(x,z)$、$c_{44}(x,z)$ 和 $c_{66}(x,z)$，其中垂直横向各向同性（VTI）的简化意味着围绕垂直轴的旋转不变性。您必须推导出一个一阶系统，该系统将应力时间变化率与速度梯度耦合，并将速度时间变化率与应力梯度耦合，同时明确指出各向异性是如何通过这些刚度参数进入方程的。\n\n然后，您必须指定在 Virieux 类型的交错网格上的有限差分离散化方法，其中质点速度位于网格单元面，正应力位于网格单元中心；剪应力位于网格单元角点。在两个方向上都使用二阶中心差分和周期性边界条件，以避免边界复杂性。您的离散化必须明确说明 $c_{11}$、$c_{33}$、$c_{13}$ 和 $c_{44}$ 是如何对离散更新方程中相应的空间导数进行加权的。\n\n在给出您的推导和离散化之后，实现一个程序，对下面列出的每个测试案例执行以下两个任务：\n\n1. 使用专门针对主轴（即水平（$x$方向）和垂直（$z$方向）传播）的连续 Christoffel 分析，计算沿主对称方向的准压缩波相速度。报告 $v_{\\mathrm{P},x} = \\sqrt{c_{11}/\\rho}$ 和 $v_{\\mathrm{P},z} = \\sqrt{c_{33}/\\rho}$，单位为米/秒（m/s），以及它们的比值 $r = v_{\\mathrm{P},x}/v_{\\mathrm{P},z}$（无量纲）。\n\n2. 构建一个小型均匀网格、周期性、交错网格布局，其中 $N_x = 6$，$N_z = 6$，网格间距 $\\Delta x = \\Delta z = 10$ 米，并定义面心质点速度场\n$$\nv_x\\big((i+\\tfrac{1}{2})\\Delta x,\\, j\\Delta z\\big) = \\sin(k_x x)\\,\\cos(k_z z),\\quad\nv_z\\big(i\\Delta x,\\, (j+\\tfrac{1}{2})\\Delta z\\big) = \\cos(k_x x)\\,\\sin(k_z z),\n$$\n其中 $k_x = \\frac{2\\pi}{L_x}$，$k_z = \\frac{2\\pi}{L_z}$，$L_x = N_x \\Delta x$，$L_z = N_z \\Delta z$。使用您的离散交错网格公式，计算中心网格单元 $(i_0,j_0) = (3,3)$ 处的应力率 $\\partial_t \\sigma_{xx}$、$\\partial_t \\sigma_{zz}$，以及中心剪切节点 $(i_0+\\tfrac{1}{2}, j_0+\\tfrac{1}{2}) = (3.5,3.5)$ 处的应力率 $\\partial_t \\sigma_{xz}$。根据这些值，报告其幅值\n$$\nM = \\sqrt{\\big(\\partial_t \\sigma_{xx}\\big)^2 + \\big(\\partial_t \\sigma_{zz}\\big)^2 + \\big(\\partial_t \\sigma_{xz}\\big)^2}\n$$\n单位为帕斯卡/秒（Pa/s）。在构建有限差分时，在两个方向上严格使用周期性索引。\n\n测试套件（所有刚度单位为帕斯卡，密度单位为千克/立方米）：\n\n- 案例 A（各向同性基准）：$c_{11} = c_{33} = \\lambda + 2\\mu$，$c_{13} = \\lambda$，$c_{44} = \\mu$，$c_{66} = \\mu$，其中 $\\lambda = 10\\times 10^9$，$\\mu = 5\\times 10^9$，$\\rho = 2200$。\n- 案例 B（VTI，水平方向更快）：$c_{11} = 24\\times 10^9$，$c_{33} = 18\\times 10^9$，$c_{13} = 8\\times 10^9$，$c_{44} = 6\\times 10^9$，$c_{66} = 7\\times 10^9$，$\\rho = 2200$。\n- 案例 C（VTI，垂直方向更快）：$c_{11} = 18\\times 10^9$，$c_{33} = 24\\times 10^9$，$c_{13} = 8\\times 10^9$，$c_{44} = 6\\times 10^9$，$c_{66} = 7\\times 10^9$，$\\rho = 2200$。\n- 案例 D（不同密度的各向同性）：$c_{11} = c_{33} = 20\\times 10^9$，$c_{13} = 10\\times 10^9$，$c_{44} = 5\\times 10^9$，$c_{66} = 5\\times 10^9$，$\\rho = 2600$。\n\n您的程序应生成一行输出，包含用方括号括起来的逗号分隔的结果列表。对于每个案例，按此顺序输出四个浮点数：$v_{\\mathrm{P},x}$（m/s），$v_{\\mathrm{P},z}$（m/s），比值 $r$（无量纲），和 $M$（Pa/s）。将所有测试案例的结果连接成一个扁平列表。所有浮点输出均表示为六位小数。例如，输出格式应如下所示：\n$$\n[\\text{caseA\\_vPx},\\text{caseA\\_vPz},\\text{caseA\\_r},\\text{caseA\\_M},\\text{caseB\\_vPx},\\ldots]\n$$\n\n程序不应读取任何外部输入，也不允许访问外部文件或网络。在整个过程中，请统一使用米、秒、千克和帕斯卡作为单位。",
            "solution": "该问题是有效的。它在科学上基于连续介质力学和计算地球物理学的原理，是适定的，有足够的信息得到唯一解，并且陈述客观。\n\n### 第一部分：一阶速度-应力系统的推导\n\n推导从连续介质力学的两个基本原理开始：线性动量平衡和线性弹性材料的本构定律。\n\n**1. 线性动量平衡（柯西运动方程）**\n在没有体力的情况下，线性动量平衡表明，质量密度 $\\rho$ 与质点加速度的乘积等于柯西应力张量 $\\boldsymbol{\\sigma}$ 的散度。\n$$\n\\rho \\frac{\\partial v_i}{\\partial t} = \\frac{\\partial \\sigma_{ij}}{\\partial x_j}\n$$\n其中 $v_i$ 是质点速度向量的分量，$t$ 是时间，$x_j$ 是空间坐标。我们对重复的索引采用爱因斯坦求和约定。\n\n对于 $x$-$z$ 平面（分别由索引 $1$ 和 $3$ 表示）中的二维 P-SV 系统，相关的速度分量是 $v_x$ 和 $v_z$，相关的应力分量是 $\\sigma_{xx}$、$\\sigma_{zz}$ 和 $\\sigma_{xz}$。运动方程展开为：\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = \\frac{\\partial \\sigma_{xx}}{\\partial x} + \\frac{\\partial \\sigma_{xz}}{\\partial z} \\quad (1)\n$$\n$$\n\\rho \\frac{\\partial v_z}{\\partial t} = \\frac{\\partial \\sigma_{xz}}{\\partial x} + \\frac{\\partial \\sigma_{zz}}{\\partial z} \\quad (2)\n$$\n这两个方程将质点速度的时间变化率与应力分量的空间梯度联系起来。\n\n**2. 本构关系（VTI介质的胡克定律）**\n本构关系将应力张量与应变张量联系起来。对于线性弹性介质，胡克定律表述为 $\\sigma_{ij} = C_{ijkl} \\epsilon_{kl}$，其中 $\\mathbf{C}$ 是四阶弹性张量，$\\boldsymbol{\\epsilon}$ 是小应变张量，$\\epsilon_{kl} = \\frac{1}{2}(\\partial u_k/\\partial x_l + \\partial u_l/\\partial x_k)$。其时间导数形式将应力率与应变率张量 $\\dot{\\boldsymbol{\\epsilon}}$ 联系起来：\n$$\n\\frac{\\partial \\sigma_{ij}}{\\partial t} = C_{ijkl} \\dot{\\epsilon}_{kl}\n$$\n应变率张量的分量通过 $\\dot{\\epsilon}_{kl} = \\frac{1}{2}\\left(\\frac{\\partial v_k}{\\partial x_l} + \\frac{\\partial v_l}{\\partial x_k}\\right)$ 与速度梯度相关。\n\n对于垂直横向各向同性（VTI）介质，对称轴是垂直的（$z$轴）。弹性张量只有五个独立分量，用 Voigt 标记法表示为 $c_{11}$、$c_{33}$、$c_{13}$、$c_{44}$ 和 $c_{66}$。在 $x$-$z$ 平面中的二维 P-SV 系统的应力-应变率关系为：\n$$\n\\begin{pmatrix} \\dot{\\sigma}_{xx} \\\\ \\dot{\\sigma}_{zz} \\\\ \\dot{\\sigma}_{xz} \\end{pmatrix} = \\begin{pmatrix} c_{11}  c_{13}  0 \\\\ c_{13}  c_{33}  0 \\\\ 0  0  c_{44} \\end{pmatrix} \\begin{pmatrix} \\dot{\\epsilon}_{xx} \\\\ \\dot{\\epsilon}_{zz} \\\\ 2\\dot{\\epsilon}_{xz} \\end{pmatrix}\n$$\n将应变率替换为速度梯度（$\\dot{\\epsilon}_{xx} = \\partial v_x/\\partial x$，$\\dot{\\epsilon}_{zz} = \\partial v_z/\\partial z$ 和 $2\\dot{\\epsilon}_{xz} = \\partial v_x/\\partial z + \\partial v_z/\\partial x$），我们得到所需的一阶应力率方程：\n$$\n\\frac{\\partial \\sigma_{xx}}{\\partial t} = c_{11} \\frac{\\partial v_x}{\\partial x} + c_{13} \\frac{\\partial v_z}{\\partial z} \\quad (3)\n$$\n$$\n\\frac{\\partial \\sigma_{zz}}{\\partial t} = c_{13} \\frac{\\partial v_x}{\\partial x} + c_{33} \\frac{\\partial v_z}{\\partial z} \\quad (4)\n$$\n$$\n\\frac{\\partial \\sigma_{xz}}{\\partial t} = c_{44} \\left( \\frac{\\partial v_x}{\\partial z} + \\frac{\\partial v_z}{\\partial x} \\right) \\quad (5)\n$$\n刚度参数 $c_{66}$ 与 SH 波有关，不会出现在二维 P-SV 系统中。\n\n**一阶系统总结**\n方程 $(1)$-$(5)$ 构成了 VTI 介质中 P-SV 波的一阶速度-应力系统。各向异性由不同的刚度系数 $c_{11}$、$c_{33}$、$c_{13}$ 和 $c_{44}$ 明确表示。在各向同性介质中，这些系数通过两个拉梅参数 $\\lambda$ 和 $\\mu$ 关联，即 $c_{11}=c_{33}=\\lambda+2\\mu$，$c_{13}=\\lambda$ 和 $c_{44}=\\mu$。与这些等价关系的偏离程度量化了各向异性的程度。\n\n### 第二部分：交错网格上的有限差分离散化\n\n我们在 Virieux 类型的交错网格上对系统进行离散化。空间域被离散为大小为 $\\Delta x \\times \\Delta z$ 的单元。网格点由 $(i,j)$ 索引，对应于物理坐标 $(i\\Delta x, j\\Delta z)$。场分量的位置如下：\n- 正应力 $\\sigma_{xx}, \\sigma_{zz}$ 位于网格单元中心：$(i, j)$\n- 水平速度 $v_x$ 位于垂直网格单元面：$(i+1/2, j)$\n- 垂直速度 $v_z$ 位于水平网格单元面：$(i, j+1/2)$\n- 剪应力 $\\sigma_{xz}$ 位于网格单元角点/节点：$(i+1/2, j+1/2)$\n\n使用二阶中心有限差分，所需位置的空间导数近似如下。设 $f_{i,j}$ 表示函数 $f$ 在网格位置 $(i,j)$ 的值。\n\n**应力率方程的离散化：**\n应力率方程需要速度梯度。\n导数 $\\partial v_x/\\partial x$ 和 $\\partial v_z/\\partial z$ 在网格单元中心 $(i,j)$ 处计算：\n$$\n\\left(\\frac{\\partial v_x}{\\partial x}\\right)_{i,j} \\approx \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial v_z}{\\partial z}\\right)_{i,j} \\approx \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z}\n$$\n导数 $\\partial v_x/\\partial z$ 和 $\\partial v_z/\\partial x$ 在剪切节点 $(i+1/2, j+1/2)$ 处计算：\n$$\n\\left(\\frac{\\partial v_x}{\\partial z}\\right)_{i+1/2,j+1/2} \\approx \\frac{v_{x, i+1/2, j+1} - v_{x, i+1/2, j}}{\\Delta z}\n$$\n$$\n\\left(\\frac{\\partial v_z}{\\partial x}\\right)_{i+1/2,j+1/2} \\approx \\frac{v_{z, i+1, j+1/2} - v_{z, i, j+1/2}}{\\Delta x}\n$$\n将这些代入方程 $(3)$-$(5)$，得到应力率的离散更新法则。为了数值实验的目的，我们写出特定时间实例的表达式：\n$$\n\\left(\\frac{\\partial \\sigma_{xx}}{\\partial t}\\right)_{i,j} = c_{11} \\left( \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x} \\right) + c_{13} \\left( \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z} \\right)\n$$\n$$\n\\left(\\frac{\\partial \\sigma_{zz}}{\\partial t}\\right)_{i,j} = c_{13} \\left( \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x} \\right) + c_{33} \\left( \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z} \\right)\n$$\n$$\n\\left(\\frac{\\partial \\sigma_{xz}}{\\partial t}\\right)_{i+1/2,j+1/2} = c_{44} \\left( \\frac{v_{x, i+1/2, j+1} - v_{x, i+1/2, j}}{\\Delta z} + \\frac{v_{z, i+1, j+1/2} - v_{z, i, j+1/2}}{\\Delta x} \\right)\n$$\n这些表达式明确显示了刚度参数 $c_{11}$、$c_{33}$、$c_{13}$ 和 $c_{44}$ 如何对离散速度梯度进行加权以确定瞬时应力率，从而演示了材料各向异性如何进入数值模板。该问题指定了周期性边界条件，这意味着数组索引必须围绕网格维度进行环绕（例如，对于 $i=0$ 的索引 $i-1$ 变为 $N_x-1$）。\n\n速度更新方程的离散化遵循类似的过程，需要在速度位置上计算应力分量的导数，但对于此问题的数值部分没有明确要求。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geophysics problem for VTI media.\n    The function iterates through four test cases, calculating phase speeds and a\n    numerical stress-rate magnitude for each.\n    \"\"\"\n    \n    # Test suite definition\n    test_cases = [\n        # Case A (isotropic baseline)\n        {'name': 'A', 'c11': (10e9 + 2*5e9), 'c33': (10e9 + 2*5e9), 'c13': 10e9, 'c44': 5e9, 'rho': 2200.0},\n        # Case B (VTI, horizontal faster)\n        {'name': 'B', 'c11': 24e9, 'c33': 18e9, 'c13': 8e9, 'c44': 6e9, 'rho': 2200.0},\n        # Case C (VTI, vertical faster)\n        {'name': 'C', 'c11': 18e9, 'c33': 24e9, 'c13': 8e9, 'c44': 6e9, 'rho': 2200.0},\n        # Case D (isotropic with different density)\n        {'name': 'D', 'c11': 20e9, 'c33': 20e9, 'c13': 10e9, 'c44': 5e9, 'rho': 2600.0}\n    ]\n\n    all_results = []\n\n    # Grid and initial field parameters\n    Nx = 6\n    Nz = 6\n    dx = 10.0\n    dz = 10.0\n    Lx = Nx * dx\n    Lz = Nz * dz\n    kx = 2 * np.pi / Lx\n    kz = 2 * np.pi / Lz\n\n    # Evaluation point indices\n    i0, j0 = 3, 3\n\n    for case in test_cases:\n        c11 = case['c11']\n        c33 = case['c33']\n        c13 = case['c13']\n        c44 = case['c44']\n        rho = case['rho']\n\n        # Task 1: Compute phase speeds and their ratio\n        v_px = np.sqrt(c11 / rho)\n        v_pz = np.sqrt(c33 / rho)\n        ratio_r = v_px / v_pz\n        \n        # Task 2: Compute stress rate magnitude M\n        \n        # Define velocity functions based on the analytical expressions\n        # v_x at (i+1/2)dx, jdz\n        def get_vx(i_half, j):\n            x = i_half * dx\n            z = j * dz\n            return np.sin(kx * x) * np.cos(kz * z)\n\n        # v_z at idx, (j+1/2)dz\n        def get_vz(i, j_half):\n            x = i * dx\n            z = j_half * dz\n            return np.cos(kx * x) * np.sin(kz * z)\n\n        # Compute velocity gradients using second-order central differences\n        \n        # Gradients for normal stresses at cell center (i0, j0)\n        # Note: Periodic BC are naturally handled by the analytical sin/cos functions.\n        # No explicit modulo arithmetic is needed as we are not iterating a simulation.\n\n        # v_x at (i0 +/- 1/2, j0)\n        vx_p_half_i = get_vx(i0 + 0.5, j0)\n        vx_m_half_i = get_vx(i0 - 0.5, j0)\n        \n        # v_z at (i0, j0 +/- 1/2)\n        vz_p_half_j = get_vz(i0, j0 + 0.5)\n        vz_m_half_j = get_vz(i0, j0 - 0.5)\n\n        dvx_dx = (vx_p_half_i - vx_m_half_i) / dx\n        dvz_dz = (vz_p_half_j - vz_m_half_j) / dz\n\n        # Gradients for shear stress at node (i0+1/2, j0+1/2)\n        \n        # v_x at (i0+1/2, j0+1) and (i0+1/2, j0)\n        vx_p1_j = get_vx(i0 + 0.5, j0 + 1)\n        vx_j = get_vx(i0 + 0.5, j0)\n        \n        # v_z at (i0+1, j0+1/2) and (i0, j0+1/2)\n        vz_p1_i = get_vz(i0 + 1, j0 + 0.5)\n        vz_i = get_vz(i0, j0 + 0.5)\n\n        dvx_dz = (vx_p1_j - vx_j) / dz\n        dvz_dx = (vz_p1_i - vz_i) / dx\n\n        # Compute stress rates using the constitutive relations\n        dt_sigma_xx = c11 * dvx_dx + c13 * dvz_dz\n        dt_sigma_zz = c13 * dvx_dx + c33 * dvz_dz\n        dt_sigma_xz = c44 * (dvx_dz + dvz_dx)\n        \n        # Compute the magnitude M\n        M = np.sqrt(dt_sigma_xx**2 + dt_sigma_zz**2 + dt_sigma_xz**2)\n        \n        # Append results for this case\n        all_results.extend([v_px, v_pz, ratio_r, M])\n\n    # Format and print the final output string\n    formatted_results = [f'{r:.6f}' for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}