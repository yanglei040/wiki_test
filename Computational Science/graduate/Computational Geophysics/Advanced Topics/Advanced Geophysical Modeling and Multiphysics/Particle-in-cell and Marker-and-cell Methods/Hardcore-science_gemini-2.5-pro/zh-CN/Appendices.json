{
    "hands_on_practices": [
        {
            "introduction": "任何PIC/MAC模拟的准确性从根本上取决于单个粒子如何被速度场精确地移动，即平流。这个计算练习直接比较了几种流行的平流方案，从标准的龙格-库塔方法到保持结构的辛积分器。通过实现这些方法并根据精确的解析解来衡量它们的误差，您将对准确性、计算成本和长期稳定性之间的关键权衡获得实践性的见解 。",
            "id": "3612605",
            "problem": "考虑在网格粒子法（Particle-In-Cell, PIC）和标记与网格法（Marker-And-Cell, MAC）中使用的二维粒子平流问题。粒子位置 $\\mathbf{x}_p(t) \\in \\mathbb{R}^2$ 的演化遵循特征常微分方程 $d\\mathbf{x}_p/dt = \\mathbf{u}(\\mathbf{x}_p,t)$，其中 $\\mathbf{u}(\\mathbf{x},t)$ 是一个给定的、随时间变化的、无散速度场。从微分方程 $d\\mathbf{x}/dt = \\mathbf{u}(\\mathbf{x},t)$ 和由 $\\mathbf{u}$ 生成的流映射的定义出发，您的任务是在以下具有科学依据的设定下，实现并比较四种粒子平流积分器——显式二阶 Runge–Kutta (RK2)、显式四阶 Runge–Kutta (RK4)、一种双时间层半拉格朗日更新方法以及辛欧拉格式。\n\n定义速度场为\n$$\n\\mathbf{u}(\\mathbf{x},t) = \\left(\\omega(t) y,\\,-\\omega(t) x\\right),\n$$\n其中\n$$\n\\omega(t) = \\omega_0 + \\omega_a \\cos(\\beta t),\n$$\n此处 $x$ 和 $y$ 表示 $\\mathbf{x}$ 的分量，$\\omega_0$、$\\omega_a$、$\\beta$ 是常数。该速度场对应于一个角速度随时间变化的不可压缩平面旋转，可被解释为一个非自治哈密顿系统，其哈密顿量为 $H(\\mathbf{x},t) = \\tfrac{1}{2}\\,\\omega(t)\\,(x^2 + y^2)$。\n\n从第一性原理出发：\n- 控制定律为 $d\\mathbf{x}/dt = \\mathbf{u}(\\mathbf{x},t)$。\n- 对于该速度场 $\\mathbf{u}$，其精确轨迹 $\\mathbf{x}^\\star(t)$ 可以从旋转生成元的矩阵指数推导得出。如果 $\\theta(t) = \\int_{0}^{t} \\omega(s)\\,ds$，那么 $\\mathbf{x}^\\star(t) = \\mathbf{R}(\\theta(t))\\,\\mathbf{x}_0$，其中\n$$\n\\mathbf{R}(\\theta) = \n\\begin{pmatrix}\n\\cos \\theta  \\sin \\theta \\\\\n-\\sin \\theta  \\cos \\theta\n\\end{pmatrix}.\n$$\n角度 $\\theta(t)$ 必须以弧度计算。\n\n为粒子轨迹实现四种时间步进积分器，均使用恒定时间步长 $\\Delta t$：\n- RK2 (显式中点法)：每步在时间 $t$ 和 $t+\\Delta t/2$ 对 $\\mathbf{u}(\\cdot,\\cdot)$ 进行两次求值来推进 $\\mathbf{x}$；\n- RK4 (经典四阶法)：每步在时间 $t$、$t+\\Delta t/2$、$t+\\Delta t/2$ 和 $t+\\Delta t$ 对 $\\mathbf{u}(\\cdot,\\cdot)$ 进行四次求值来推进 $\\mathbf{x}$；\n- 双时间层半拉格朗日更新：计算一个临时位置 $\\tilde{\\mathbf{x}} = \\mathbf{x}^{n} + \\Delta t\\,\\mathbf{u}(\\mathbf{x}^{n},t^{n})$，然后设置 $\\mathbf{x}^{n+1} = \\mathbf{x}^{n} + \\Delta t\\,\\mathbf{u}(\\tilde{\\mathbf{x}},t^{n+1})$（每步对 $\\mathbf{u}$ 进行两次求值）；\n- 辛欧拉法 (适用于此哈密顿系统的正则变体)：使用 $\\omega^n = \\omega(t^n)$，更新 $y^{n+1} = y^n - \\Delta t\\,\\omega^n\\,x^n$，然后更新 $x^{n+1} = x^n + \\Delta t\\,\\omega^n\\,y^{n+1}$（每步通过 $\\omega^n$ 对速度场进行一次有效求值）。\n\n对于每个积分器和每个测试用例，使用 $\\mathbf{x}_p(0) = \\mathbf{x}_0$ 和整数 $N$ 模拟到最终时间 $t_N = N \\Delta t$。量化以下指标：\n- 在 $t_N$ 时的轨迹误差，定义为欧几里得范数 $ \\|\\mathbf{x}_p(t_N) - \\mathbf{x}^\\star(t_N)\\|$，单位为米，四舍五入到六位小数。\n- 计算成本，定义为积分器在所有步骤中使用的速度场 $\\mathbf{u}(\\mathbf{x},t)$ 的总求值次数，以整数计数报告。\n\n使用以下参数值的测试套件，这些参数值被选择用于检验不同的精度和稳定性区间：\n- 用例 A (理想路径)：$\\mathbf{x}_0 = (1.0\\,\\text{m},\\,0.0\\,\\text{m})$，$\\omega_0 = 1.0\\,\\text{rad/s}$，$\\omega_a = 0.5\\,\\text{rad/s}$，$\\beta = 2.0\\,\\text{rad/s}$，$T = 1.0\\,\\text{s}$，$\\Delta t = 0.05\\,\\text{s}$。\n- 用例 B (小步长，接近渐近区间)：$\\mathbf{x}_0 = (1.0\\,\\text{m},\\,0.0\\,\\text{m})$，$\\omega_0 = 1.0\\,\\text{rad/s}$，$\\omega_a = 0.5\\,\\text{rad/s}$，$\\beta = 2.0\\,\\text{rad/s}$，$T = 1.0\\,\\text{s}$，$\\Delta t = 0.005\\,\\text{s}$。\n- 用例 C (大步长，压力测试)：$\\mathbf{x}_0 = (1.0\\,\\text{m},\\,0.0\\,\\text{m})$，$\\omega_0 = 1.0\\,\\text{rad/s}$，$\\omega_a = 0.5\\,\\text{rad/s}$，$\\beta = 2.0\\,\\text{rad/s}$，$T = 1.0\\,\\text{s}$，$\\Delta t = 0.2\\,\\text{s}$。\n\n所有角度必须以弧度为单位，所有时间以秒为单位，速度以米/秒为单位，位置以米为单位。确保在每个用例中 $N = T/\\Delta t$ 都是整数，从而使 $t_N = T$。\n\n您的程序应生成单行输出，其中包含整个测试套件的聚合结果，形式为每个用例结果列表组成的列表。对于每个用例，结果列表必须按 $[\\text{err}_{\\text{RK2}}, \\text{err}_{\\text{RK4}}, \\text{err}_{\\text{SL}}, \\text{err}_{\\text{SYM}}, \\text{cost}_{\\text{RK2}}, \\text{cost}_{\\text{RK4}}, \\text{cost}_{\\text{SL}}, \\text{cost}_{\\text{SYM}}]$ 的顺序排列，其中误差是四舍五入到六位小数的浮点数（单位为米），成本是整数（求值次数）。例如，输出格式必须如下\n$$\n[[e_1^{\\text{RK2}}, e_1^{\\text{RK4}}, e_1^{\\text{SL}}, e_1^{\\text{SYM}}, c_1^{\\text{RK2}}, c_1^{\\text{RK4}}, c_1^{\\text{SL}}, c_1^{\\text{SYM}}],\\,[e_2^{\\text{RK2}}, \\dots],\\,[e_3^{\\text{RK2}}, \\dots]]\n$$\n以单行打印，不含任何额外文本。",
            "solution": "用户提供了一个问题，要求为一个时变速度场中的粒子平流问题实现并比较四种不同的数值积分器。\n\n### 步骤 1：问题验证\n\n**已知条件提取：**\n-   **常微分方程 (ODE):** $d\\mathbf{x}_p/dt = \\mathbf{u}(\\mathbf{x}_p,t)$，其中粒子位置为 $\\mathbf{x}_p(t) = (x(t), y(t)) \\in \\mathbb{R}^2$。\n-   **速度场：** $\\mathbf{u}(\\mathbf{x},t) = \\left(\\omega(t) y,\\,-\\omega(t) x\\right)$。这是一个无散场，$\\nabla \\cdot \\mathbf{u} = 0$。\n-   **角速度函数：** $\\omega(t) = \\omega_0 + \\omega_a \\cos(\\beta t)$，其中 $\\omega_0$, $\\omega_a$, $\\beta$ 是常数。\n-   **哈密顿量：** 该系统被描述为哈密顿系统，其哈密顿量为 $H(\\mathbf{x},t) = \\tfrac{1}{2}\\,\\omega(t)\\,(x^2 + y^2)$。\n-   **精确解析解：** 轨迹由 $\\mathbf{x}^\\star(t) = \\mathbf{R}(\\theta(t))\\,\\mathbf{x}_0$ 给出，其中旋转角为 $\\theta(t) = \\int_{0}^{t} \\omega(s)\\,ds$，旋转矩阵为 $\\mathbf{R}(\\theta) = \\begin{pmatrix} \\cos \\theta  \\sin \\theta \\\\ -\\sin \\theta  \\cos \\theta \\end{pmatrix}$。\n-   **数值积分器：**\n    1.  **RK2 (中点法):** 每步两次 $\\mathbf{u}$ 求值。\n    2.  **RK4 (经典法):** 每步四次 $\\mathbf{u}$ 求值。\n    3.  **半拉格朗日 (SL):** $\\tilde{\\mathbf{x}} = \\mathbf{x}^{n} + \\Delta t\\,\\mathbf{u}(\\mathbf{x}^{n},t^{n})$ 然后 $\\mathbf{x}^{n+1} = \\mathbf{x}^{n} + \\Delta t\\,\\mathbf{u}(\\tilde{\\mathbf{x}},t^{n+1})$。此方法每步使用两次 $\\mathbf{u}$ 求值。\n    4.  **辛欧拉法 (SYM):** 先计算 $y^{n+1} = y^n - \\Delta t\\,\\omega(t^n)\\,x^n$，然后计算 $x^{n+1} = x^n + \\Delta t\\,\\omega(t^n)\\,y^{n+1}$。此方法每步对速度场结构进行一次有效求值。\n-   **模拟参数：** 恒定时间步长 $\\Delta t$，初始位置 $\\mathbf{x}_0$，最终时间 $T$。步数为 $N = T/\\Delta t$，为一个整数。\n-   **衡量指标：**\n    1.  **误差：** 数值计算的最终位置与精确最终位置之差的欧几里得范数 $\\|\\mathbf{x}_p(T) - \\mathbf{x}^\\star(T)\\|$，四舍五入到六位小数。\n    2.  **成本：** 速度场函数 $\\mathbf{u}(\\mathbf{x},t)$ 的总求值次数。\n-   **测试套件：**\n    -   **用例 A:** $\\mathbf{x}_0 = (1.0, 0.0)$, $\\omega_0 = 1.0$, $\\omega_a = 0.5$, $\\beta = 2.0$, $T = 1.0$, $\\Delta t = 0.05$。\n    -   **用例 B:** $\\mathbf{x}_0 = (1.0, 0.0)$, $\\omega_0 = 1.0$, $\\omega_a = 0.5$, $\\beta = 2.0$, $T = 1.0$, $\\Delta t = 0.005$。\n    -   **用例 C:** $\\mathbf{x}_0 = (1.0, 0.0)$, $\\omega_0 = 1.0$, $\\omega_a = 0.5$, $\\beta = 2.0$, $T = 1.0$, $\\Delta t = 0.2$。\n\n**验证评估：**\n该问题具有科学依据，根植于经典力学和数值分析。它是一个适定问题，具有明确定义的 ODE 系统、用于验证的已知解析解以及待实现数值方法的具体定义。所有必要的参数和条件都已提供，使得问题自洽且无歧义。所选参数在物理上是合理的，并为在不同步长下测试积分器性能提供了有意义的检验。该问题不违反任何科学原理，是可形式化的，并且与物理学和地球物理学中的计算方法直接相关。\n\n**结论：** 问题有效。\n\n### 步骤 2：求解推导与实现策略\n\n任务是实现四种指定的时间步进格式来积分粒子的运动方程，并将其精度和计算成本与精确解进行比较。\n\n**1. 精确解：**\n在时间 $t$ 的总旋转角是角速度的积分：\n$$\n\\theta(t) = \\int_0^t \\omega(s) ds = \\int_0^t (\\omega_0 + \\omega_a \\cos(\\beta s)) ds = \\left[ \\omega_0 s + \\frac{\\omega_a}{\\beta} \\sin(\\beta s) \\right]_0^t = \\omega_0 t + \\frac{\\omega_a}{\\beta} \\sin(\\beta t)\n$$\n对于初始位置 $\\mathbf{x}_0 = (x_0, y_0)$，在时间 $t$ 的精确位置是通过按角度 $\\theta(t)$ 进行顺时针旋转得到的：\n$$\n\\mathbf{x}^\\star(t) = \\mathbf{R}(\\theta(t)) \\mathbf{x}_0\n$$\n$$\n\\begin{pmatrix} x^\\star(t) \\\\ y^\\star(t) \\end{pmatrix} = \\begin{pmatrix} \\cos(\\theta(t))  \\sin(\\theta(t)) \\\\ -\\sin(\\theta(t))  \\cos(\\theta(t)) \\end{pmatrix} \\begin{pmatrix} x_0 \\\\ y_0 \\end{pmatrix}\n$$\n这得到：\n$$\nx^\\star(t) = x_0 \\cos(\\theta(t)) + y_0 \\sin(\\theta(t))\n$$\n$$\ny^\\star(t) = -x_0 \\sin(\\theta(t)) + y_0 \\cos(\\theta(t))\n$$\n\n**2. 数值积分器：**\n设 $\\mathbf{x}^n$ 为在时间 $t^n = n \\Delta t$ 时 $\\mathbf{x}(t^n)$ 的数值近似。速度场为 $\\mathbf{u}(\\mathbf{x}, t) = (\\omega(t)y, -\\omega(t)x)$。\n\n**a) RK2 (显式中点法):** 这是一种二阶 Runge-Kutta 方法。\n$$\n\\mathbf{k}_1 = \\Delta t \\cdot \\mathbf{u}(\\mathbf{x}^n, t^n)\n$$\n$$\n\\mathbf{x}^{n+1} = \\mathbf{x}^n + \\Delta t \\cdot \\mathbf{u}\\left(\\mathbf{x}^n + \\frac{\\mathbf{k}_1}{2}, t^n + \\frac{\\Delta t}{2}\\right)\n$$\n每步成本：2 次 $\\mathbf{u}$ 求值。\n\n**b) RK4 (经典四阶法):**\n$$\n\\mathbf{k}_1 = \\Delta t \\cdot \\mathbf{u}(\\mathbf{x}^n, t^n)\n$$\n$$\n\\mathbf{k}_2 = \\Delta t \\cdot \\mathbf{u}\\left(\\mathbf{x}^n + \\frac{\\mathbf{k}_1}{2}, t^n + \\frac{\\Delta t}{2}\\right)\n$$\n$$\n\\mathbf{k}_3 = \\Delta t \\cdot \\mathbf{u}\\left(\\mathbf{x}^n + \\frac{\\mathbf{k}_2}{2}, t^n + \\frac{\\Delta t}{2}\\right)\n$$\n$$\n\\mathbf{k}_4 = \\Delta t \\cdot \\mathbf{u}(\\mathbf{x}^n + \\mathbf{k}_3, t^n + \\Delta t)\n$$\n$$\n\\mathbf{x}^{n+1} = \\mathbf{x}^n + \\frac{1}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\n每步成本：4 次 $\\mathbf{u}$ 求值。\n\n**c) 半拉格朗日 (SL) 双时间层更新:** 如问题中所定义。\n$$\n\\tilde{\\mathbf{x}} = \\mathbf{x}^n + \\Delta t \\cdot \\mathbf{u}(\\mathbf{x}^n, t^n)\n$$\n$$\n\\mathbf{x}^{n+1} = \\mathbf{x}^n + \\Delta t \\cdot \\mathbf{u}(\\tilde{\\mathbf{x}}, t^{n+1})\n$$\n每步成本：2 次 $\\mathbf{u}$ 求值。\n\n**d) 辛欧拉法 (SYM):** 此格式是为给定的哈密顿系统量身定制的。\n使用 $\\omega^n = \\omega(t^n)$，$x^n$ 和 $y^n$:\n$$\ny^{n+1} = y^n - \\Delta t \\cdot \\omega^n \\cdot x^n\n$$\n$$\nx^{n+1} = x^n + \\Delta t \\cdot \\omega^n \\cdot y^{n+1}\n$$\n注意在更新 $x^{n+1}$ 时使用了新计算出的 $y^{n+1}$。每步成本：1 次 $\\omega(t)$ 求值，解释为对速度场结构的一次有效求值。\n\n**3. 实现计划：**\n将开发一个 Python 程序来执行每个用例的模拟。\n-   一个主函数将循环遍历三个测试用例。\n-   对每个用例，它将：设置物理和数值参数、计算步数、计算精确的最终位置、调用独立的函数为四种积分器中的每一种运行模拟。每个积分器函数将循环 $N$ 次，在每一步更新粒子位置并计算成本。它将返回最终位置和总成本。计算欧几里得误差。\n-   每个用例的最终结果（误差和成本）将被收集并格式化为指定的列表的列表结构以供打印。所有数值计算将使用浮点运算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares four particle advection integrators (RK2, RK4, SL, SYM)\n    for a time-dependent rotational velocity field.\n    \"\"\"\n\n    test_cases = [\n        # Case A (happy path)\n        {'x0': np.array([1.0, 0.0]), 'w0': 1.0, 'wa': 0.5, 'beta': 2.0, 'T': 1.0, 'dt': 0.05},\n        # Case B (small step, near asymptotic regime)\n        {'x0': np.array([1.0, 0.0]), 'w0': 1.0, 'wa': 0.5, 'beta': 2.0, 'T': 1.0, 'dt': 0.005},\n        # Case C (large step, stress test)\n        {'x0': np.array([1.0, 0.0]), 'w0': 1.0, 'wa': 0.5, 'beta': 2.0, 'T': 1.0, 'dt': 0.2},\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        x0, w0, wa, beta, T, dt = case['x0'], case['w0'], case['wa'], case['beta'], case['T'], case['dt']\n        \n        # The number of steps N must be an integer.\n        N = int(round(T / dt))\n\n        def omega(t):\n            return w0 + wa * np.cos(beta * t)\n\n        def u_field(x, t):\n            # x is a numpy array [x, y]\n            return np.array([omega(t) * x[1], -omega(t) * x[0]])\n\n        # --- Exact Solution ---\n        theta_T = w0 * T + (wa / beta) * np.sin(beta * T)\n        rot_matrix = np.array([\n            [np.cos(theta_T), np.sin(theta_T)],\n            [-np.sin(theta_T), np.cos(theta_T)]\n        ])\n        x_exact = rot_matrix @ x0\n\n        # --- Integrators ---\n\n        # 1. RK2 (Explicit Midpoint)\n        def run_rk2():\n            x = np.copy(x0)\n            cost = 0\n            for n in range(N):\n                t = n * dt\n                k1 = dt * u_field(x, t)\n                cost += 1\n                x_mid = x + k1 / 2.0\n                t_mid = t + dt / 2.0\n                k2 = dt * u_field(x_mid, t_mid)\n                cost += 1\n                x += k2\n            return x, cost\n\n        # 2. RK4 (Classical)\n        def run_rk4():\n            x = np.copy(x0)\n            cost = 0\n            for n in range(N):\n                t = n * dt\n                k1 = dt * u_field(x, t)\n                cost += 1\n                k2 = dt * u_field(x + k1 / 2.0, t + dt / 2.0)\n                cost += 1\n                k3 = dt * u_field(x + k2 / 2.0, t + dt / 2.0)\n                cost += 1\n                k4 = dt * u_field(x + k3, t + dt)\n                cost += 1\n                x += (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n            return x, cost\n\n        # 3. Semi-Lagrangian\n        def run_sl():\n            x = np.copy(x0)\n            cost = 0\n            for n in range(N):\n                t_n = n * dt\n                t_np1 = (n + 1) * dt\n                u1 = u_field(x, t_n)\n                cost += 1\n                x_tilde = x + dt * u1\n                u2 = u_field(x_tilde, t_np1)\n                cost += 1\n                x += dt * u2\n            return x, cost\n\n        # 4. Symplectic Euler\n        def run_sym():\n            x_val, y_val = x0[0], x0[1]\n            cost = 0\n            for n in range(N):\n                t = n * dt\n                w_n = omega(t)\n                cost += 1 # 1 effective evaluation of u-field structure\n                \n                # y^{n+1} = y^n - dt * w^n * x^n\n                y_val_new = y_val - dt * w_n * x_val\n                # x^{n+1} = x^n + dt * w^n * y^{n+1}\n                x_val_new = x_val + dt * w_n * y_val_new\n                \n                x_val, y_val = x_val_new, y_val_new\n            return np.array([x_val, y_val]), cost\n\n        # --- Run simulations and collect results ---\n        x_rk2, cost_rk2 = run_rk2()\n        err_rk2 = np.linalg.norm(x_rk2 - x_exact)\n\n        x_rk4, cost_rk4 = run_rk4()\n        err_rk4 = np.linalg.norm(x_rk4 - x_exact)\n\n        x_sl, cost_sl = run_sl()\n        err_sl = np.linalg.norm(x_sl - x_exact)\n\n        x_sym, cost_sym = run_sym()\n        err_sym = np.linalg.norm(x_sym - x_exact)\n        \n        case_results = [\n            round(err_rk2, 6),\n            round(err_rk4, 6),\n            round(err_sl, 6),\n            round(err_sym, 6),\n            cost_rk2,\n            cost_rk4,\n            cost_sl,\n            cost_sym\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string\n    result_strings = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在PIC/MAC方法中，像粘度这样的物理属性由粒子携带，但在求解控制性连续介质方程时，这些属性需要在欧拉网格上使用。本练习探讨了一个关键问题：如何确定具有不同属性的两个网格单元之间界面的有效粘度。通过从通量连续性的第一性原理推导正确的平均方案，您将理解为什么简单的算术平均可能导致非物理结果，以及为什么谐波平均对于精确模拟非均质材料至关重要 。",
            "id": "3612571",
            "problem": "需要在一個交錯的标记-单元（MAC）网格上计算非均匀粘性柱中的蠕变剪切流，其中速度位于面心，压力位于单元中心。单元中心的粘度值是通过在每个控制体积内进行单元内颗粒（PIC）标记采样获得的。考虑两个相邻的控制体积，它们在位置 $x_{f}$ 处共享一个公共垂直面，其中心分别位于 $x_{L}$ 和 $x_{R}$，到该面的距离表示为 $\\Delta x_{L} = x_{f} - x_{L}$ 和 $\\Delta x_{R} = x_{R} - x_{f}$。从标记推断出的单元中心粘度为 $\\eta_{L}$ 和 $\\eta_{R}$，并假定在每个控制体积内是分段常数。用法向速度 $u(x)$ 表示，其值为 $u_{L} = u(x_{L})$ 和 $u_{R} = u(x_{R})$。在没有体积力和压力梯度的情况下，一维稳态斯托克斯（Stokes）动量平衡简化为粘性剪切通量在空间上是恒定的。\n\n在有限体积离散化中，我们寻求一个有效的面心粘度 $\\eta_{f}$，使得根据跨越距离 $\\Delta x_{L} + \\Delta x_{R}$ 的 $u_{L}$ 和 $u_{R}$ 之间的两点差构建的离散粘性通量，与由分段常数粘度分布产生的精确恒定粘性通量相匹配。从斯托克斯流中粘性剪切应力的定义和通量连续性的要求出发，根据第一性原理推导出一个关于 $\\eta_{L}$、$\\eta_{R}$、$\\Delta x_{L}$ 和 $\\Delta x_{R}$ 的 $\\eta_{f}$ 的封闭形式表达式，该表达式能保证对于任意正的 $\\eta_{L}$、$\\eta_{R}$ 和非均匀的 $\\Delta x_{L}$、$\\Delta x_{R}$，跨越面的粘性通量是连续的。然后，简要解释为什么在这种情况下，$\\eta_{L}$ 和 $\\eta_{R}$ 的算术平均值通常无法保持通量的连续性。\n\n将你的最终答案报告为 $\\eta_{f}$ 关于 $\\eta_{L}$、$\\eta_{R}$、$\\Delta x_{L}$ 和 $\\Delta x_{R}$ 的单个显式表达式。不需要进行数值计算，也不需要四舍五入。在最终答案中不要包含单位。",
            "solution": "用户提交了一个问题以进行验证和求解。\n\n### 步骤1：提取已知条件\n- **流动类型：** 非均匀粘性柱中的蠕变剪切流。\n- **数值方案：** 标记-单元（MAC）交错网格。\n- **变量位置：** 面心速度，单元中心压力。\n- **粘度：** 单元中心值 $\\eta_{L}$ 和 $\\eta_{R}$，通过单元内颗粒（PIC）采样获得，假定在每个控制体积内是分段常数。\n- **几何结构：** 两个相邻的控制体积，中心位于 $x_{L}$ 和 $x_{R}$，在 $x_{f}$ 处共享一个垂直面。\n- **网格间距：** 非均匀距离，定义为 $\\Delta x_{L} = x_{f} - x_{L}$ 和 $\\Delta x_{R} = x_{R} - x_{f}$。\n- **速度：** 法向速度函数 $u(x)$，其单元中心值为 $u_{L} = u(x_{L})$ 和 $u_{R} = u(x_{R})$。\n- **控制物理：** 在没有体积力和压力梯度的情况下的一维稳态斯托克斯动量平衡。这简化为粘性剪切通量（应力）在空间上是恒定的条件。\n- **目标：** 推导有效面心粘度 $\\eta_{f}$ 的封闭形式表达式。\n- **约束条件：** 离散粘性通量（定义为 $\\eta_{f}$ 乘以两点速度差商）必须与从分段常数粘度分布推导出的精确恒定粘性通量相匹配。\n- **次要目标：** 解释为什么 $\\eta_{L}$ 和 $\\eta_{R}$ 的算术平均值通常不正确。\n\n### 步骤2：使用提取的已知条件进行验证\n根据指定标准对问题进行评估：\n- **科学基础：** 该问题牢固地植根于连续介质力学（斯托克斯流）和计算流体动力学标准数值方法（有限体积、MAC网格、PIC方法）的原理。将物理问题简化为一维恒定剪切应力是离散化粘性项的一个有效且标准的起点。所有概念都是该领域的标准概念。\n- **适定性：** 该问题是适定的。它提供了清晰的物理约束（通量连续性）和明确的数学结构（分段常数属性、有限体积离散化），可以从中推导出有效粘度 $\\eta_f$ 的唯一表达式。\n- **客观性：** 语言技术性强、精确，没有任何主观性或模糊性。\n\n该问题不存在任何列出的缺陷。它不是科学上不合理的、不可形式化的、不完整的、不切实际的、不适定的或微不足道的。它代表了在粘性流数值模型中处理材料非均匀性的一个基本推导。\n\n### 步骤3：结论和行动\n问题是**有效的**。将提供解答。\n\n### 解答推导\n该问题要求推导一个有效的面心粘度 $\\eta_{f}$，以确保数值方案在材料界面上保持通量的物理连续性。\n\n控制物理是在没有压力梯度或体积力情况下的的一维稳态斯托克斯动量方程，其由应力张量的散度为零给出。在一维情况下，对于剪切流，这简化为：\n$$\n\\frac{d\\tau}{dx} = 0\n$$\n其中 $\\tau$ 是粘性剪切应力。这意味着剪切应力 $\\tau$ 在整个域内必须是恒定的。我们将此恒定应力表示为 $\\tau_c$。牛顿流体的本构关系将剪切应力定义为：\n$$\n\\tau(x) = \\eta(x) \\frac{du}{dx}\n$$\n其中 $\\eta(x)$ 是动力粘度， $u(x)$ 是速度。\n\n由于 $\\tau(x) = \\tau_c$，我们可以将速度梯度写为：\n$$\n\\frac{du}{dx} = \\frac{\\tau_c}{\\eta(x)}\n$$\n问题陈述粘度是分段常数：对于 $x \\in [x_L, x_f]$，$\\eta(x) = \\eta_L$；对于 $x \\in [x_f, x_R]$，$\\eta(x) = \\eta_R$。我们可以在连接单元中心到公共面的两个线段上对速度梯度方程进行积分。\n\n首先，我们从左侧单元中心 $x_L$ 积分到面 $x_f$：\n$$\n\\int_{u(x_L)}^{u(x_f)} du = \\int_{x_L}^{x_f} \\frac{\\tau_c}{\\eta_L} dx\n$$\n$$\nu(x_f) - u_L = \\frac{\\tau_c}{\\eta_L} (x_f - x_L) = \\frac{\\tau_c \\Delta x_L}{\\eta_L}\n$$\n\n接着，我们从面 $x_f$ 积分到右侧单元中心 $x_R$：\n$$\n\\int_{u(x_f)}^{u(x_R)} du = \\int_{x_f}^{x_R} \\frac{\\tau_c}{\\eta_R} dx\n$$\n$$\nu_R - u(x_f) = \\frac{\\tau_c}{\\eta_R} (x_R - x_f) = \\frac{\\tau_c \\Delta x_R}{\\eta_R}\n$$\n\n在单元中心速度的公式中，面速度 $u(x_f)$ 不是一个显式变量。我们可以通过将上述两个方程相加来消除它：\n$$\n(u_R - u(x_f)) + (u(x_f) - u_L) = \\frac{\\tau_c \\Delta x_R}{\\eta_R} + \\frac{\\tau_c \\Delta x_L}{\\eta_L}\n$$\n$$\nu_R - u_L = \\tau_c \\left( \\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R} \\right)\n$$\n这使我们能够用已知的单元中心速度 $u_L$ 和 $u_R$以及给定的属性来表示精确、恒定的物理通量 $\\tau_c$：\n$$\n\\tau_c = \\frac{u_R - u_L}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\n这就是离散公式必须匹配的“精确恒定粘性通量”。\n\n现在，我们考虑在面 $x_f$ 处的通量的有限体积离散化。这个离散通量，我们表示为 $\\tau_f$，是使用一个有效的面心粘度 $\\eta_f$ 和一个基于两个单元中心值 $u_L$ 和 $u_R$ 的速度梯度的有限差分近似来构建的。这些点之间的总距离是 $x_R - x_L = (x_R - x_f) + (x_f - x_L) = \\Delta x_R + \\Delta x_L$。因此，离散通量定义为：\n$$\n\\tau_f = \\eta_f \\left( \\frac{u_R - u_L}{x_R - x_L} \\right) = \\eta_f \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R}\n$$\n为确保数值方案在物理上是一致的，我们强制执行离散通量等于精确通量的条件，即 $\\tau_f = \\tau_c$：\n$$\n\\eta_f \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R} = \\frac{u_R - u_L}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\n假设在非静态情况下 $u_R \\neq u_L$，我们可以从两边消去 $(u_R - u_L)$ 项：\n$$\n\\frac{\\eta_f}{\\Delta x_L + \\Delta x_R} = \\frac{1}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\n求解有效面心粘度 $\\eta_f$：\n$$\n\\eta_f = (\\Delta x_L + \\Delta x_R) \\left( \\frac{1}{\\frac{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L}{\\eta_L \\eta_R}} \\right)\n$$\n$$\n\\eta_f = (\\Delta x_L + \\Delta x_R) \\left( \\frac{\\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L} \\right)\n$$\n这可以写成最终的封闭形式表达式：\n$$\n\\eta_f = \\frac{(\\Delta x_L + \\Delta x_R) \\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L}\n$$\n这个表达式代表了两个单元中心粘度的距离加权调和平均值。\n\n最后，我们简要解释为什么简单的算术平均通常会失败。算术平均值（可能按距离加权）将是 $\\eta_{a} = \\frac{\\Delta x_L \\eta_L + \\Delta x_R \\eta_R}{\\Delta x_L + \\Delta x_R}$。在离散通量公式中使用此粘度将得到 $\\tau_a = \\eta_a \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R} = \\frac{\\Delta x_L \\eta_L + \\Delta x_R \\eta_R}{\\Delta x_L + \\Delta x_R} \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R}$。除非 $\\eta_L = \\eta_R$，否则此通量 $\\tau_a$ 不等于精确通量 $\\tau_c$。其物理原因是两个层的流动阻力是串联的。在一个电学类比中，如果速度是电势，应力是电流，而 $\\frac{\\Delta x}{\\eta}$ 是电阻，那么总电阻是个体电阻之和：$R_{total} = R_L + R_R = \\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}$。推导出的有效粘度正确地反映了这种串联求和。粘度的算术平均值类似于对电导率（电阻率的倒数）求平均，这适用于并联流动配置，而不适用于问题中描述的串联配置。因此，算术平均违反了恒定通量的物理约束。",
            "answer": "$$ \\boxed{ \\frac{(\\Delta x_L + \\Delta x_R)\\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L} } $$"
        },
        {
            "introduction": "一个稳定的混合模拟需要一个时间步长 $\\Delta t$，该步长需同时满足其拉格朗日和欧拉分量的限制。本练习将引导您推导出一个耦合系统的保守时间步长，在该系统中，粒子在一个传播波的介质中平流。您将结合著名的Courant-Friedrichs-Lewy (CFL)稳定性条件（适用于基于网格的波解算器）与一个关于粒子运动的实际约束，以找到确保整个模拟稳定性的统一时间步长 。",
            "id": "3612596",
            "problem": "考虑一个均匀交错网格上的一维显式弹声场求解器，它与用于材料标记点的质点网格法(PIC)粒子更新耦合。这在计算地球物理学中很常见，当使用质点网格法(PIC)和标记网格法(MAC)策略在演化的波场中对流属性时。在足够小的空间邻域内，介质是线性的、均匀的和各向同性的，其质量密度为 $\\rho$，体积模量为 $K$。最大特征波速为 $c = \\sqrt{K/\\rho}$，网格间距为 $\\Delta x$。场求解器在交错网格上使用空间中心、时间中心（蛙跳格式）的显式方法来推进一阶声学变量（压力和速度）。粒子使用插值得到的速度场，通过一阶显式更新进行推进。\n\n从一阶声学系统、特征速度的定义以及显式交错网格蛙跳格式更新出发，推导时间步长 $\\Delta t$ 的一个保守上限，该上限需同时满足以下两个条件：\n- 对于网格所能容纳的所有空间傅里叶模式，显式场更新是稳定的，并且\n- 满足粒子穿越约束，即在单个时间步内，没有粒子穿越超过一个网格单元。\n\n您的答案必须是仅用 $c$ 和 $\\Delta x$ 表示的单个闭式解析表达式。时间步长以秒为单位表示。无需进行数值计算。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、是适定的且客观的。它描述了计算物理学中一个涉及耦合数值格式稳定性的标准问题。所有变量和条件都已明确定义。\n\n任务是为耦合的质点网格法(PIC)和有限差分场求解器系统推导时间步长 $\\Delta t$ 的保守上限。这需要同时满足两个独立的条件：显式场求解器的稳定性和粒子穿越约束。最终表达式必须用特征波速 $c$ 和网格间距 $\\Delta x$ 表示。\n\n让我们分别推导每个约束的条件。\n\n**1. 显式场更新稳定性 (CFL 条件)**\n\n控制方程为一阶一维线性声学系统：\n$$\n\\frac{\\partial p}{\\partial t} + K \\frac{\\partial v_x}{\\partial x} = 0\n$$\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0\n$$\n其中 $p$ 是声压，$v_x$ 是 $x$ 方向的质点速度，$\\rho$ 是质量密度，$K$ 是体积模量。特征波速由 $c = \\sqrt{K/\\rho}$ 给出。\n\n该数值方法是在交错网格上采用空间中心、时间中心（蛙跳格式）的显式格式。设压力 $p$ 定义在网格节点 $x_j = j \\Delta x$ 和整数时间步 $t^n = n \\Delta t$ 上。设速度 $v_x$ 定义在交错节点 $x_{j+1/2} = (j+1/2) \\Delta x$ 和半整数时间步 $t^{n+1/2} = (n+1/2) \\Delta t$ 上。该系统的有限差分近似为：\n$$\n\\frac{p_j^{n+1} - p_j^n}{\\Delta t} = -K \\frac{v_{x, j+1/2}^{n+1/2} - v_{x, j-1/2}^{n+1/2}}{\\Delta x}\n$$\n$$\n\\rho \\frac{v_{x, j+1/2}^{n+1/2} - v_{x, j+1/2}^{n-1/2}}{\\Delta t} = - \\frac{p_{j+1}^{n} - p_j^n}{\\Delta x}\n$$\n为了分析稳定性，我们进行 von Neumann 稳定性分析。我们寻找形式为 $p_j^n = \\hat{p}(k) G^n \\exp(i k x_j)$ 和 $v_{x, j+1/2}^{n \\pm 1/2} = \\hat{v}_x(k) G^{n \\pm 1/2} \\exp(i k x_{j+1/2})$ 的解，其中 $G$ 是增长因子，$k$ 是波数。将这些代入有限差分方程并简化，得到该格式的数值色散关系：\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\pm \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n其中 $\\omega$ 是角频率，使得 $G = \\exp(-i \\omega \\Delta t)$。为使格式稳定，增长因子 $G$ 的模必须满足 $|G| \\le 1$。这要求 $\\omega$ 为实数。为使 $\\omega$ 为实数，用于求解 $\\omega$ 的反正弦函数（arcsin）的自变量必须为实数，且其模小于或等于 1：\n$$\n\\left| \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\right| \\le 1\n$$\n该不等式必须对网格所能容纳的所有空间傅里叶模式 $k$ 成立。最严格的情况（即对 $\\Delta t$ 施加最紧约束的情况）发生在使 $|\\sin(k \\Delta x / 2)|$ 项最大化的模式下。该项的最大值为 1，出现在奈奎斯特波数 $k_{max} = \\pi / \\Delta x$ 处。\n代入此最坏情况的值，稳定性条件变为：\n$$\n\\frac{c \\Delta t}{\\Delta x} \\le 1\n$$\n这就得到了对时间步长的第一个约束，即著名的 Courant-Friedrichs-Lewy (CFL) 条件：\n$$\n\\Delta t \\le \\frac{\\Delta x}{c}\n$$\n\n**2. 粒子穿越约束**\n\n第二个约束是在单个时间步内，任何粒子都不应穿越超过一个网格单元。粒子使用一阶显式更新进行对流：\n$$\nx_p(t + \\Delta t) = x_p(t) + v_p(t) \\Delta t\n$$\n其中 $x_p$ 是粒子的位置，$v_p$ 是其速度，通过从网格插值速度场 $v_x$ 得到。\n一个粒子在单个时间步内的位移是 $|v_p(t)| \\Delta t$。该约束要求此位移小于或等于网格单元宽度 $\\Delta x$：\n$$\n|v_p(t)| \\Delta t \\le \\Delta x\n$$\n为确保此条件对所有粒子在所有时间都成立，我们必须考虑模拟中可能的最大粒子速度 $\\max(|v_x|)$：\n$$\n\\Delta t \\le \\frac{\\Delta x}{\\max(|v_x|)}\n$$\n\n**3. 组合的保守上限**\n\n时间步长 $\\Delta t$ 必须同时满足这两个约束。因此，它必须小于或等于两个推导出的上限中的最小值：\n$$\n\\Delta t \\le \\min\\left( \\frac{\\Delta x}{c}, \\frac{\\Delta x}{\\max(|v_x|)} \\right)\n$$\n为了确定一个仅用 $c$ 和 $\\Delta x$ 表示的单个解析表达式，我们必须评估 $c$ 与 $\\max(|v_x|)$ 之间的关系。问题陈述求解器是用于“线性、均匀、各向同性”的弹声场。线性声学理论的一个基本原则是，质点（或材料）的速度远小于波的传播速度。也就是说，所模拟的物理机制满足：\n$$\n\\max(|v_x|) \\ll c\n$$\n这个不等式对两个稳定性边界有直接影响。如果 $\\max(|v_x|) \\ll c$，那么 $\\frac{1}{\\max(|v_x|)} \\gg \\frac{1}{c}$。这意味着：\n$$\n\\frac{\\Delta x}{\\max(|v_x|)} \\gg \\frac{\\Delta x}{c}\n$$\n因此，粒子穿越约束比场求解器（CFL）约束的限制性要弱得多。为了同时满足这两个条件，我们必须遵守两者中更严格的那个。因此，两个上限中的最小值就是 CFL 条件。\n\n因此，同时满足这两个条件的时间步长 $\\Delta t$ 的保守上限由场更新稳定性决定：\n$$\n\\Delta t \\le \\frac{\\Delta x}{c}\n$$\n$\\Delta t$ 的最大允许值就是这个上限。",
            "answer": "$$\\boxed{\\frac{\\Delta x}{c}}$$"
        }
    ]
}