{
    "hands_on_practices": [
        {
            "introduction": "在着手构建复杂数值模型之前，通过分析控制方程来把握核心物理机制至关重要。无量纲化是一种揭示主导系统行为的关键无量纲参数的强大技术。本练习将引导你从旋转磁流体动力学方程出发，推导出发电机模型中的关键无量纲数，并利用它们来识别和区分不同的动力学机制，例如地转平衡或磁地转平衡。",
            "id": "3608743",
            "problem": "您的任务是推导并在程序中评估在Boussinesq近似下，球壳中不可压缩、旋转磁流体地球动力学方程中出现的无量纲群。从基本守恒定律和定义开始，并设计一个计算，为多个参数集生成诊断性的无量纲数和区系分类。\n\n给定旋转球壳内密度恒定的不可压缩导电液体的以下有量纲控制方程：\n\n- 动量守恒（在以角频率 $\\Omega$ 绕固定轴旋转的参考系中）：\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u},\n$$\n其中 $\\rho$ 是密度，$\\mathbf{u}$ 是速度， $t$ 是时间，$\\boldsymbol{\\Omega}$ 是大小为 $\\Omega$ 的旋转矢量，$p$ 是压力，$\\alpha$ 是热膨胀系数，$g$ 是重力加速度大小，$T'$ 是温度扰动，$\\hat{\\mathbf{r}}$ 是径向单位矢量，$\\mu_0$ 是自由空间磁导率，$\\mathbf{B}$ 是磁通量密度，$\\nu$ 是运动粘度。\n\n- 感应方程：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B},\n$$\n其中 $\\eta$ 是磁扩散率。\n\n- 扰动温度的热方程（线性化Boussinesq形式）：\n$$\n\\frac{\\partial T'}{\\partial t} + \\mathbf{u}\\cdot \\nabla T' + u_r \\frac{\\mathrm{d} \\bar{T}}{\\mathrm{d} r} = \\kappa \\nabla^2 T',\n$$\n其中 $\\kappa$ 是热扩散率，$\\bar{T}$ 是平均背景温度，$u_r$ 是径向速度。假设球壳厚度上存在固定的温差 $\\Delta T$。\n\n- 无散度约束：\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\\quad \\nabla\\cdot \\mathbf{B} = 0.\n$$\n\n使用球壳厚度作为特征长度尺度 $L$，一个特征速度 $U$，旋转时间尺度 $1/\\Omega$，磁场尺度 $B_0$，以及温度尺度 $\\Delta T$ 对这些方程进行无量纲化。从第一性原理仔细识别每个出现的无量纲群。需要表达并计算的预期无量纲群是：\n- Ekman数 $\\mathrm{E}$,\n- 磁Prandtl数 $\\mathrm{Pm}$,\n- Rayleigh数 $\\mathrm{Ra}$,\n- Rossby数 $\\mathrm{Ro}$,\n- 磁Reynolds数 $\\mathrm{Rm}$,\n- Elsasser数 $\\Lambda$.\n\n所有量和参数都用国际单位制（SI）表示：米、千克、秒、开尔文、特斯拉。您的最终程序必须使用您推导的定义为每个测试案例计算这六个无量纲数，并使用以下逻辑对主导力平衡区系进行分类：\n- 惯性主导（代码 $2$）：如果 $\\mathrm{Ro} \\geq 1$。\n- 磁地转（代码 $1$）：如果 $\\mathrm{Ro} < 0.1$，$\\mathrm{E} < 10^{-4}$，并且 $0.1 \\le \\Lambda \\le 10$。\n- 地转（代码 $0$）：如果 $\\mathrm{Ro} < 0.1$，$\\mathrm{E} < 10^{-4}$，并且 $\\Lambda < 0.1$。\n如果一个案例不满足上述任何条件，您可以假设它是过渡性的；但是，所提供的测试套件经过选择，以避免过渡性分类。\n\n设计参数扫描，以强调单个目标无量纲群的变化，同时受制于定义中固有的不可避免的代数耦合。使用以下参数集（测试套件），每个都以元组形式提供\n$$\n(L,\\ \\rho,\\ \\Omega,\\ \\nu,\\ \\eta,\\ \\kappa,\\ \\alpha,\\ g,\\ \\Delta T,\\ U,\\ B_0),\n$$\n单位为SI单位：\n- 案例 $1$ （地转基线）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 $2$ （通过增加 $\\Lambda$ 实现磁地转）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 2\\times 10^{-3})$。\n- 案例 $3$ （通过慢速旋转增加 $\\mathrm{Ro}$ 实现惯性主导）：$(1\\times 10^{5},\\ 7\\times 10^{3},\\ 1\\times 10^{-6},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-1},\\ 1\\times 10^{-4})$。\n- 案例 $4$ （通过增加 $\\nu$ 实现Ekman扫描）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-3},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 $5$ （通过减少 $\\eta$ 实现磁Prandtl扫描）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-2},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n- 案例 $6$ （通过 $B_0 = 0$ 实现零Elsasser数）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 0)$。\n- 案例 $7$ （通过大的 $\\eta$ 实现低磁Reynolds数）：$(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8,\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$。\n\n您的程序必须为每个案例计算六个无量纲数和区系代码，然后输出一个表示包含七个子列表的列表的单行字符串。每个子列表必须包含六个数后跟整数区系代码，顺序如下\n$$\n[\\mathrm{E},\\ \\mathrm{Pm},\\ \\mathrm{Ra},\\ \\mathrm{Ro},\\ \\mathrm{Rm},\\ \\Lambda,\\ \\text{code}],\n$$\n每个浮点值都需精确到六位有效数字。输出不得包含空格。例如，一个有效的整体输出格式是\n$$\n[[x_{11},x_{12},\\dots,x_{17}],[x_{21},x_{22},\\dots,x_{27}],\\dots,[x_{71},x_{72},\\dots,x_{77}]].\n$$\n\n所有输出都是无单位的。如果使用了角度，必须以弧度为单位；但是，所需输出中没有角度。\n\n您的实现必须是一个完整的、可运行的程序，仅使用指定的库，并以指定格式精确打印一行。",
            "solution": "该问题要求推导和计算地球动力学模型中磁流体动力学（MHD）的六个关键无量纲数，然后对动力学区系进行分类。此过程首先将旋转参考系中、Boussinesq近似下的不可压缩导电液体的控制方程进行无量纲化。\n\n提供了动量、磁场（感应）和温度的控制方程，以及无散度约束。我们将使用提供的特征尺度对这些方程进行无量纲化：\n- 长度：$L$（球壳厚度）\n- 速度：$U$（特征速度）\n- 时间：$1/\\Omega$（旋转速率的倒数）\n- 磁场：$B_0$（特征场强）\n- 温度扰动：$\\Delta T$（特征温差）\n\n我们定义无量纲变量（用帽子符号表示）如下：\n$$ \\hat{\\mathbf{r}} = \\frac{\\mathbf{r}}{L}, \\quad \\hat{t} = t\\Omega, \\quad \\hat{\\mathbf{u}} = \\frac{\\mathbf{u}}{U}, \\quad \\hat{\\mathbf{B}} = \\frac{\\mathbf{B}}{B_0}, \\quad \\hat{T'} = \\frac{T'}{\\Delta T} $$\n空间导数算子的尺度为 $\\nabla = \\frac{1}{L}\\hat{\\nabla}$。压力基于地转平衡进行尺度化，其中压力梯度与科里奥利力平衡：$p_0 = \\rho_0 \\Omega U L$。因此，$\\hat{p} = p/p_0$。\n\n**1. 动量方程的无量纲化**\n\n有量纲的动量方程为：\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u}\n$$\n代入尺度化变量及其对应的有量纲尺度：\n$$\n\\rho\\left(U\\Omega \\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\frac{U^2}{L} \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2\\Omega U (\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\\right)\n= - \\frac{\\rho \\Omega U L}{L} \\hat{\\nabla} \\hat{p} + \\rho \\alpha g \\Delta T \\hat{T'} \\,\\hat{\\mathbf{r}} + \\frac{B_0^2}{\\mu_0 L}(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\frac{\\rho \\nu U}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\n我们将方程中所有项除以科里奥利力尺度的大小 $\\rho \\Omega U$ 进行归一化：\n$$\n\\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2(\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\n= - \\hat{\\nabla} \\hat{p} + \\left(\\frac{\\alpha g \\Delta T}{\\Omega U}\\right) \\hat{T'} \\hat{\\mathbf{r}} + \\left(\\frac{B_0^2}{\\mu_0 \\rho \\Omega U L}\\right)(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\left(\\frac{\\nu}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\n从各项的系数中，我们直接识别出两个无量纲数：\n- **Rossby数**，$\\mathrm{Ro}$，是惯性项的系数，代表惯性力与科里奥利力之比：$\\mathrm{Ro} = \\frac{U}{\\Omega L}$。\n- **Ekman数**，$\\mathrm{E}$，是粘性项的系数，代表粘性力与科里奥利力之比：$\\mathrm{E} = \\frac{\\nu}{\\Omega L^2}$。\n\n**2. 感应方程的无量纲化**\n\n有量纲的感应方程为：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\n$$\n代入尺度化变量：\n$$\nB_0 \\Omega \\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\frac{U B_0}{L} \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\frac{\\eta B_0}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\n除以 $B_0 \\Omega$：\n$$\n\\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\left(\\frac{\\eta}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\n感应项的系数是Rossby数，$\\mathrm{Ro}$。磁扩散项的系数 $\\frac{\\eta}{\\Omega L^2}$ 可以与其他数相关联。通过引入**磁Reynolds数**，$\\mathrm{Rm} = \\frac{UL}{\\eta}$，它衡量磁场平流与磁扩散之比，我们可以将该系数写为 $\\frac{\\eta}{UL} \\frac{U}{\\Omega L} = \\frac{\\mathrm{Ro}}{\\mathrm{Rm}}$。\n\n**3. 所需无量纲群的定义**\n\n基于上述推导和标准物理定义，我们确定六个所需数的公式。\n\n- **Ekman数, E**: 粘性力与科里奥利力之比。\n$$ \\mathrm{E} = \\frac{\\nu}{\\Omega L^2} $$\n- **磁Prandtl数, Pm**: 运动粘度（动量扩散率）与磁扩散率之比。它是一种流体属性，不是通过对单个方程进行尺度分析得出的，而是通过比较动量和感应方程中各自的扩散项得出的。\n$$ \\mathrm{Pm} = \\frac{\\nu}{\\eta} $$\n- **Rayleigh数, Ra**: 代表浮力驱动力与耗散力（粘性和热）之比。其标准定义，在量纲上是一致的，为：\n$$ \\mathrm{Ra} = \\frac{\\alpha g \\Delta T L^3}{\\nu \\kappa} $$\n- **Rossby数, Ro**: 惯性力与科里奥利力之比。\n$$ \\mathrm{Ro} = \\frac{U}{\\Omega L} $$\n- **磁Reynolds数, Rm**: 磁场平流与磁扩散之比。\n$$ \\mathrm{Rm} = \\frac{UL}{\\eta} $$\n- **Elsasser数, $\\Lambda$**: 洛伦兹力与科里奥利力之比。在地球动力学理论中的标准定义，我们将使用它，包含了磁扩散率。自由空间磁导率 $\\mu_0$ 取值为 $4\\pi\\times 10^{-7} \\, \\mathrm{H/m}$。\n$$ \\Lambda = \\frac{B_0^2}{\\rho \\mu_0 \\eta \\Omega} $$\n\n这些公式被用来计算每个参数集的无量纲数。然后根据提供的 $\\mathrm{Ro}$、$\\mathrm{E}$ 和 $\\Lambda$ 的阈值对动力学区系进行分类。\n- **惯性主导 (代码 $2$)**: $\\mathrm{Ro} \\ge 1$。\n- **磁地转 (代码 $1$)**: $\\mathrm{Ro}  0.1$, $\\mathrm{E}  10^{-4}$，且 $0.1 \\le \\Lambda \\le 10$。\n- **地转 (代码 $0$)**: $\\mathrm{Ro}  0.1$, $\\mathrm{E}  10^{-4}$，且 $\\Lambda  0.1$。\n\n算法将遍历每个测试案例，应用这些定义，确定区系代码，并将输出格式化为表示列表的列表的单行字符串，每个浮点数都以科学记数法格式化为六位有效数字。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes non-dimensional groups for magnetohydrodynamic \n    geodynamo equations and classifies the dynamical regime.\n    \"\"\"\n    \n    # Fundamental constant: magnetic permeability of free space (H/m)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Each test case is a tuple:\n    # (L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0)\n    test_cases = [\n        # Case 1 (geostrophic baseline)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 2 (magnetostrophic via Lambda increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 2e-3),\n        # Case 3 (inertia-dominated via Ro increase)\n        (1e5, 7e3, 1e-6, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-1, 1e-4),\n        # Case 4 (Ekman sweep via nu increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-3, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 5 (magnetic Prandtl sweep via eta decrease)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-2, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 6 (zero Elsasser via B0 = 0)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 0),\n        # Case 7 (low magnetic Reynolds via large eta)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8.0, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0 = case\n\n        # Compute the six non-dimensional numbers\n        E = nu / (Omega * L**2)\n        Pm = nu / eta\n        Ra = (alpha * g * DeltaT * L**3) / (nu * kappa)\n        Ro = U / (Omega * L)\n        Rm = (U * L) / eta\n        \n        # Handle B0=0 case for Lambda to avoid division by zero if rho, eta or Omega is zero (not in tests)\n        if B0 == 0:\n            Lambda = 0.0\n        else:\n            Lambda = B0**2 / (rho * MU_0 * eta * Omega)\n\n        # Classify the regime\n        code = -1 # Default/transitional, though problem states this won't happen\n        if Ro >= 1:\n            code = 2  # Inertia-dominated\n        elif Ro  0.1 and E  1e-4 and 0.1 = Lambda = 10:\n            code = 1  # Magnetostrophic\n        elif Ro  0.1 and E  1e-4 and Lambda  0.1:\n            code = 0  # Geostrophic\n\n        # Store results for this case\n        case_results = [E, Pm, Ra, Ro, Rm, Lambda, code]\n        all_results.append(case_results)\n\n    # Format the final output string\n    # Each float must be rendered to exactly six significant figures in scientific notation.\n    # The integer code is rendered as is.\n    output_sublists = []\n    for result_set in all_results:\n        formatted_floats = [f\"{v:.5e}\" for v in result_set[:6]]\n        code_str = str(result_set[6])\n        sublist_str = f\"[{','.join(formatted_floats + [code_str])}]\"\n        output_sublists.append(sublist_str)\n        \n    final_output_str = f\"[{','.join(output_sublists)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "从理解物理机制过渡到数值实现，伪谱方法因其高精度特性而成为地球发电机建模的主流选择。本练习聚焦于该方法的核心技术：如何使用球谐函数和切比雪夫多项式来表示物理场。更关键的是，它将阐明如何通过采用“3/2规则”等去混淆技术，在计算非线性项（如平流项 $\\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u}$）时避免引入数值误差（混淆效应），从而确保计算的准确性。",
            "id": "3608669",
            "problem": "考虑一个内半径为 $r_i$、外半径为 $r_o$ 的旋转球壳，其中磁流体动力学 (MHD) 控制着导电流体的动力学过程。在角速度为 $\\boldsymbol{\\Omega}$ 的旋转参考系中，Boussinesq 近似下的不可压缩 MHD 方程，其无量纲形式为：\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u} + 2 \\boldsymbol{\\Omega} \\times \\boldsymbol{u} = -\\nabla p + \\frac{1}{\\mathrm{Re}} \\nabla^2 \\boldsymbol{u} + \\frac{1}{\\mathrm{Pm}\\,\\mathrm{Re}} \\left( \\nabla \\times \\boldsymbol{B} \\right) \\times \\boldsymbol{B} + \\boldsymbol{F},\n$$\n$$\n\\frac{\\partial \\boldsymbol{B}}{\\partial t} = \\nabla \\times \\left( \\boldsymbol{u} \\times \\boldsymbol{B} \\right) + \\frac{1}{\\mathrm{Pm}} \\nabla^2 \\boldsymbol{B},\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0,\\quad \\nabla \\cdot \\boldsymbol{B} = 0,\n$$\n其中 $\\boldsymbol{u}$ 是速度，$\\boldsymbol{B}$ 是磁场，$p$ 是压力，$\\boldsymbol{F}$ 是代表浮力和其他效应的体力，$\\mathrm{Re}$ 和 $\\mathrm{Pm}$ 分别是雷诺数和磁普朗特数。在用于地球发电机模拟的计算地球物理学中，通常采用伪谱方法，其中角向依赖性由球谐函数表示，径向依赖性由 Chebyshev 多项式表示。\n\n设 $f(r,\\theta,\\phi)$ 是一个标量场，代表 $\\boldsymbol{u}$ 或 $\\boldsymbol{B}$ 的极向或环向势的一个分量，该标量场将由球谐函数 $Y_\\ell^m(\\theta,\\phi)$（用于角变量）和 Chebyshev 多项式 $T_n(x)$（用于由下式定义的映射径向坐标 $x \\in [-1,1]$）的截断级数来近似：\n$$\nx(r) = \\frac{2\\,r - (r_i + r_o)}{r_o - r_i}.\n$$\n假设 $Y_\\ell^m(\\theta,\\phi)$ 是在单位球面上具有标准归一化的标准正交面球谐函数，\n$$\n\\int_{0}^{2\\pi} \\int_{0}^{\\pi} Y_\\ell^m(\\theta,\\phi)\\, Y_{\\ell'}^{m'}(\\theta,\\phi)^{*}\\, \\sin\\theta\\, d\\theta\\, d\\phi = \\delta_{\\ell\\ell'}\\, \\delta_{mm'},\n$$\n并且 $T_n(x)$ 是在 $[-1,1]$ 上带权重 $(1-x^2)^{-1/2}$ 正交的第一类 Chebyshev 多项式，\n$$\n\\int_{-1}^{1} T_n(x)\\, T_{n'}(x)\\, \\frac{dx}{\\sqrt{1-x^2}} = \\begin{cases}\n0,  n \\ne n',\\\\\n\\pi,  n=n'=0,\\\\\n\\frac{\\pi}{2},  n=n'\\ge 1.\n\\end{cases}\n$$\n\n你的任务是概述一个使用球谐函数处理角向依赖性、使用径向 Chebyshev 多项式处理径向依赖性的伪谱方法，并推导连接 $f$ 在合适的张量积配置网格 $\\{r_j,\\theta_k,\\phi_h\\}$ 上的节点值与其谱系数 $\\{\\hat{f}_{\\ell m n}\\}$ 之间的正变换和逆变换关系。然后，基于多项式与谐波乘积带宽的第一性原理，推导并陈述所需的去混叠规则，以确保任何二次非线性项（例如 $\\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u}$ 和 $\\left(\\nabla \\times \\boldsymbol{B}\\right)\\times \\boldsymbol{B}$）在通过伪谱方法（即变换到物理空间、逐点相乘、再变换回来）计算时，能够实现无混叠计算。\n\n具体而言，从 $Y_\\ell^m(\\theta,\\phi)$ 和 $T_n(x)$ 的正交性以及控制基函数乘积的恒等式（例如，两个球谐函数的乘积可以展开为阶数最高达到原始阶数之和的球谐函数，以及 $T_p(x)\\, T_q(x)$ 包含最高阶为 $p+q$ 的 Chebyshev 分量）出发，推导：\n\n1. 将 $f(r_j,\\theta_k,\\phi_h)$ 映射到 $\\hat{f}_{\\ell m n}$ 的离散正变换，使用适当的 $\\theta$ 和 $x$ 的求积权重，以及与快速傅里叶变换(FFT)一致的 $\\phi$ 的梯形法则，并指定表示一个带限场（其最大径向多项式阶数为 $n_{\\max}$，球谐函数阶为 $\\ell_{\\max}$，方位阶为 $m_{\\max}$）所需的最小配置节点数 $(N_r+1)\\times N_\\theta \\times N_\\phi$。\n\n2. 从 $\\hat{f}_{\\ell m n}$ 重构 $f(r_j,\\theta_k,\\phi_h)$ 的逆变换。\n\n3. 一个严格的去混叠策略，确保通过物理空间中的逐点相乘计算的任何二次非线性项不会因混叠而污染保留的谱系数，明确处理方位角方向 $\\phi$、余纬方向 $\\theta$ 和径向坐标 $r$。\n\n下面哪个选项正确地指定了变换关系和一个与伪谱球谐/Chebyshev 方法一致的无混叠非线性计算策略？\n\nA. 在 $\\theta$ 和 $\\phi$ 中使用等距节点，在 $x$ 中使用 Gauss-Lobatto 节点。通过对 $Y_\\ell^m(\\theta_k,\\phi_h)^{*}\\, T_n(x_j)$ 进行无权求和来计算正变换，并通过相应的合成来进行逆变换。通过在谱空间中对模态系数进行卷积来计算非线性项，无需填充或截断，因为正交性确保了没有混叠。\n\nB. 在 $\\phi$ 方向上使用均匀网格（$N_\\phi \\ge 2 m_{\\max}+1$）和快速傅里叶变换 (FFT)，在 $\\theta$ 方向上使用 Gauss-Legendre 求积（$N_\\theta \\ge \\ell_{\\max}+1$）来计算阶为 $\\ell$、次为 $m$ 的缔合勒让德变换，在 $x$ 方向上使用 Gauss-Lobatto 节点和离散余弦变换来处理 $(N_r+1)$ 个节点上最高阶为 $n_{\\max}$ 的 Chebyshev 多项式。正变换对内积使用求积权重 $w_k^{(\\theta)}$ 和 $w_j^{(x)}$，逆变换是相应的合成求和。通过将谱系数补零到每个坐标 $(m,\\ell,n)$ 中 $(3/2)$ 倍的更大带限，变换到相应更稠密的 $(3/2)$ 倍物理网格，逐点相乘，变换回来，并截断到原始的 $(m_{\\max},\\ell_{\\max},n_{\\max})$ 来计算二次非线性项；这消除了所有三个方向上的混叠。\n\nC. 使用与选项 B 中相同的变换，但为了去混叠，仅在原始网格上计算非线性乘积后，对谱系数 $(m,\\ell,n)$ 应用 $(2/3)$ 截断，因为最后移除最高的三分之一模态足以防止混叠污染保留的频带。\n\nD. 使用与选项 B 中相同的 $\\phi$ 方向的 FFT 和 $(\\theta,x)$ 方向的 Gauss-Legendre 及 Gauss-Lobatto 方法，但为了去混叠，仅在方位角方向 $m$ 上进行 $(3/2)$ 填充，在 $\\ell$ 或 $n$ 方向上不进行填充或截断。$\\theta$ 方向的球谐函数正交性和 $x$ 方向的多项式递推确保了仅方位角填充就能全局消除混叠。\n\nE. 使用选项 B 中的变换，但为了避免混叠，通过使用 Gaunt 积分和 Wigner-3j 符号（用于球谐函数）以及 Chebyshev 乘积恒等式进行精确的模态卷积，完全在谱空间中计算非线性项；由于这是精确的，因此在伪谱框架中不需要填充或截断。",
            "solution": "我们从球谐函数和 Chebyshev 多项式的正交性出发，构建带限场的谱表示。设标量场展开为\n$$\nf(r,\\theta,\\phi) = \\sum_{\\ell=0}^{\\ell_{\\max}} \\sum_{m=-\\ell}^{\\ell} \\sum_{n=0}^{n_{\\max}} \\hat{f}_{\\ell m n}\\, T_n\\!\\left( x(r) \\right)\\, Y_\\ell^m(\\theta,\\phi),\n$$\n其中 $x(r) \\in [-1,1]$ 由 $x(r) = \\left(2r - (r_i + r_o)\\right)/(r_o - r_i)$ 给出，这样径向坐标就仿射映射到 Chebyshev 域。我们选择一个张量网格：\n$$\n\\phi_h = \\frac{2\\pi h}{N_\\phi},\\quad h = 0,1,\\dots,N_\\phi-1,\n$$\n$$\n\\mu_k = \\cos\\theta_k,\\quad \\theta_k \\in (0,\\pi),\\quad k=1,\\dots,N_\\theta,\n$$\n其中 $\\{\\mu_k\\}$ 和 $\\{w_k^{(\\theta)}\\}$ 是用于在 $[-1,1]$ 上积分的 Gauss-Legendre 节点和权重，以及\n$$\nx_j = \\cos\\left( \\frac{\\pi j}{N_r} \\right),\\quad j=0,1,\\dots,N_r,\n$$\n及其相关的用于 Chebyshev 内积的 Gauss-Lobatto 权重 $\\{w_j^{(x)}\\}$。为确保带限场的变换是精确的，选择的最小点数应使离散变换精确：$N_\\phi \\ge 2 m_{\\max}+1$，$N_\\theta \\ge \\ell_{\\max}+1$ 和 $N_r+1 \\ge n_{\\max}+1$。\n\n正变换。利用球谐函数 $Y_\\ell^m(\\theta,\\phi)$ 在球面上的标准正交性以及带权重 $(1-x^2)^{-1/2}$ 的 Chebyshev 内积，连续正变换系数为\n$$\n\\hat{f}_{\\ell m n} = \\left( \\int_{r_i}^{r_o} \\int_{0}^{2\\pi} \\int_{0}^{\\pi} f(r,\\theta,\\phi)\\, T_n\\!\\left( x(r) \\right)\\, Y_\\ell^m(\\theta,\\phi)^{*}\\, \\sin\\theta\\, d\\theta\\, d\\phi\\, \\frac{dr}{J(r)} \\right) \\cdot C_n,\n$$\n其中 $J(r) = \\left( r_o - r_i \\right)/2$ 是从 $x$ 到 $r$ 的仿射映射的雅可比行列式，$C_n$ 是 Chebyshev 内积的归一化因子，它考虑了权重 $(1-x^2)^{-1/2}$ 以及从 $dr$ 到 $dx$ 的映射。在配置伪谱方法中，对于带限函数，这些积分通过在 $\\theta$ 方向使用高斯求积、在 $x$ 方向使用 Gauss-Lobatto 求积，以及在 $\\phi$ 方向使用与快速傅里叶变换 (FFT) 一致的梯形法则来精确计算：\n$$\n\\hat{f}_{\\ell m n} = \\sum_{j=0}^{N_r} \\sum_{k=1}^{N_\\theta} \\sum_{h=0}^{N_\\phi-1} w_j^{(x)}\\, w_k^{(\\theta)}\\, w_h^{(\\phi)}\\, f\\!\\left( r_j,\\theta_k,\\phi_h \\right)\\, T_n\\!\\left( x_j \\right)\\, Y_\\ell^m(\\theta_k,\\phi_h)^{*},\n$$\n其中 $w_h^{(\\phi)} = 2\\pi/N_\\phi$，$w_j^{(x)}$ 反映了由映射雅可比行列式重新缩放的 Chebyshev Gauss-Lobatto 权重；$w_k^{(\\theta)}$ 是 Gauss-Legendre 权重，因子 $\\sin\\theta$ 通过勒让德求积的变量替换 $\\mu = \\cos\\theta$ 被吸收。在实际算法中，这个三重求和被分解如下：首先在 $\\phi$ 方向进行 FFT，以获得每个 $(r_j,\\theta_k)$ 的方位傅里叶系数，\n$$\n\\tilde{f}_{jkm} = \\sum_{h=0}^{N_\\phi-1} f\\!\\left( r_j,\\theta_k,\\phi_h \\right)\\, e^{- i m \\phi_h},\n$$\n然后对每个 $(r_j,m)$，在 $\\theta$ 方向使用 Gauss-Legendre 节点和权重进行缔合勒让德变换，得到 $g_{j,\\ell m}$，\n$$\ng_{j,\\ell m} = \\sum_{k=1}^{N_\\theta} w_k^{(\\theta)}\\, \\tilde{f}_{jkm}\\, \\mathcal{N}_{\\ell m}\\, P_\\ell^m\\!\\left( \\cos\\theta_k \\right),\n$$\n其中 $\\mathcal{N}_{\\ell m}$ 是连接 $Y_\\ell^m$ 与 $P_\\ell^m$ 乘以方位因子 $e^{i m \\phi}$ 的球谐函数归一化常数。最后，在 $x$ 方向进行离散余弦变换（它使 Chebyshev 内积对角化）得到\n$$\n\\hat{f}_{\\ell m n} = \\sum_{j=0}^{N_r} w_j^{(x)}\\, g_{j,\\ell m}\\, T_n\\!\\left( x_j \\right)\\, \\tilde{C}_n,\n$$\n其中 $\\tilde{C}_n$ 是与 Chebyshev 正交性（对于如上所述的 $n=0$ 和 $n\\ge 1$）一致的离散归一化因子。\n\n逆变换。逆向合成利用基的完备性，从谱系数重构配置网格上的场值：\n$$\nf\\!\\left( r_j,\\theta_k,\\phi_h \\right) = \\sum_{\\ell=0}^{\\ell_{\\max}} \\sum_{m=-\\ell}^{\\ell} \\sum_{n=0}^{n_{\\max}} \\hat{f}_{\\ell m n}\\, T_n\\!\\left( x_j \\right)\\, Y_\\ell^m(\\theta_k,\\phi_h).\n$$\n在数值上，这是通过对每个 $(\\ell,m)$ 求和径向 Chebyshev 多项式来形成 $q_{j,\\ell m}$ 来执行的，\n$$\nq_{j,\\ell m} = \\sum_{n=0}^{n_{\\max}} \\hat{f}_{\\ell m n}\\, T_n\\!\\left( x_j \\right),\n$$\n然后通过缔合勒让德函数和 $\\phi$ 方向的逆 FFT 来合成球谐函数：\n$$\nf\\!\\left( r_j,\\theta_k,\\phi_h \\right) = \\sum_{\\ell=0}^{\\ell_{\\max}} \\sum_{m=-\\ell}^{\\ell} q_{j,\\ell m}\\, \\mathcal{N}_{\\ell m}\\, P_\\ell^m\\!\\left( \\cos\\theta_k \\right)\\, e^{i m \\phi_h}.\n$$\n\n二次非线性的去混叠。两个带限函数的乘积会增加带宽。对于球谐函数，两个谐波的乘积满足\n$$\nY_{\\ell_1}^{m_1}\\, Y_{\\ell_2}^{m_2} = \\sum_{\\ell=|\\ell_1-\\ell_2|}^{\\ell_1+\\ell_2} \\sum_{m=m_1+m_2} C_{\\ell_1 m_1, \\ell_2 m_2}^{\\ell m}\\, Y_\\ell^m,\n$$\n其中耦合系数 $C_{\\ell_1 m_1, \\ell_2 m_2}^{\\ell m}$ 涉及 Gaunt 积分或 Wigner-3j 符号；因此，结果的阶数可以达到 $\\ell_1+\\ell_2$，方位阶可以达到 $m_1+m_2$。对于 Chebyshev 多项式，乘积恒等式\n$$\nT_p(x)\\, T_q(x) = \\frac{1}{2}\\left( T_{p+q}(x) + T_{|p-q|}(x) \\right)\n$$\n显示乘积产生的最高阶为 $p+q$。因此，如果原始截断为 $(\\ell_{\\max}, m_{\\max}, n_{\\max})$，那么任何二次非线性原则上都可以生成高达 $(2\\ell_{\\max}, 2 m_{\\max}, 2 n_{\\max})$ 的内容。在伪谱方法中，非线性项是在物理空间的配置网格上，由从截断谱合成的场值计算得出，然后变换回去。如果不进行去混叠，未解析的高阶内容会折叠（混叠）到低阶模态中。\n\n为防止混叠，可以使用物理空间中的填充，这等同于推广到每个坐标的 Orszag $(3/2)$ 法则。策略是：\n1. 在合成物理场之前，将谱系数在每个索引上补零至更大的带限：\n$$\nm_{\\mathrm{pad}} = \\left\\lfloor \\frac{3}{2}\\, m_{\\max} \\right\\rfloor,\\quad \\ell_{\\mathrm{pad}} = \\left\\lfloor \\frac{3}{2}\\, \\ell_{\\max} \\right\\rfloor,\\quad n_{\\mathrm{pad}} = \\left\\lfloor \\frac{3}{2}\\, n_{\\max} \\right\\rfloor.\n$$\n2. 相应地选择配置网格大小：\n$$\nN_\\phi^{\\mathrm{pad}} \\ge 2 m_{\\mathrm{pad}} + 1,\\quad N_\\theta^{\\mathrm{pad}} \\ge \\ell_{\\mathrm{pad}} + 1,\\quad N_r^{\\mathrm{pad}} + 1 \\ge n_{\\mathrm{pad}} + 1.\n$$\n3. 在更稠密的网格上合成填充后的物理场，逐点计算二次乘积，然后变换回填充后的谱空间。\n4. 将结果截断到原始带限 $(\\ell_{\\max}, m_{\\max}, n_{\\max})$。\n\n$(3/2)$ 填充确保由二次乘积产生的最大带宽（可能达到原始最大值的两倍左右）在映射回离散网格时不会混叠到原始保留范围内。在方位角方向，这与经典的傅里叶 $(3/2)$ 法则相同，其中将网格点数增加到 $N_\\phi^{\\mathrm{pad}} \\approx \\frac{3}{2}\\, N_\\phi$ 可以防止卷积环绕污染低于 $m_{\\max}$ 的模态。在余纬和径向方向，类似地填充阶数限制和相应的求积方法，可确保高阶内容得到表示而不会发生折叠。另一种方法是，使用 Gaunt 积分进行精确的谱空间卷积可以避免混叠，但这偏离了伪谱方法的范式，会带来显著更高的计算复杂度和预计算成本。\n\n逐个选项分析：\n\nA. 该选项建议在 $\\theta$ 方向使用等距节点，而没有适当的 Gauss-Legendre 求积，并对正变换使用对 $Y_\\ell^m$ 和 $T_n$ 的无权求和。没有正确的求积权重，离散变换不能实现与正交性一致的内积，并且没有定制权重的等距 $\\theta$ 采样通常不能为带限场产生精确的球谐变换。更关键的是，它断言谱空间卷积无需填充或截断是无混叠的，因为正交性。在截断基中，卷积会生成超出截断范围的内容，将其映射到有限网格上而没有填充会导致混叠到低阶模态。因此，这是不正确的。\n\nB. 该选项指定了标准的伪谱变换：在均匀网格上使用 FFT（$\\phi$ 方向，$N_\\phi \\ge 2 m_{\\max}+1$），使用 Gauss-Legendre 求积进行缔合勒让德变换（$N_\\theta \\ge \\ell_{\\max}+1$），在 $x$ 方向使用 Gauss-Lobatto 节点和离散余弦变换处理最高阶为 $n_{\\max}$ 的 Chebyshev 多项式（在 $(N_r+1)$ 个节点上）。正变换使用正确的求积权重，逆变换是相应的合成。对于非线性项，它规定将每个坐标的带限补零至 $(3/2)$，在相应更稠密的网格上合成，相乘，变换回来，并截断。这将 Orszag $(3/2)$ 法则推广到球谐和 Chebyshev 展开，并消除了所有三个方向上二次乘积的混叠。因此，这是正确的。\n\nC. 该选项仅在原始网格上计算非线性乘积后应用 $(2/3)$ 截断。乘法后的滤波无法消除在分辨率不足的网格上进行逐点乘积时已经发生的混叠；高波数内容在事后截断之前已经折叠到低阶模态中，污染了保留的谱。在非线性计算之前应用或与填充结合使用时，$(2/3)$ 截断可以作为一种去混叠策略，但仅在事后在原始网格上应用是不够的。因此，这是不正确的。\n\nD. 仅在方位角方向 $m$ 进行填充不能解决由纬度变换中增加的 $\\ell$ 阶或径向 Chebyshev 展开中更高的 $n$ 阶引起的混叠。二次乘积也会增加 $\\theta$ 和 $x$ 的阶数，因此在这些坐标中省略填充或截断会使保留的系数中存在混叠。因此，这是不正确的。\n\nE. 使用 Gaunt 积分和 Chebyshev 乘积关系进行精确的谱空间卷积，原则上可以通过计算精确的模态耦合然后截断结果来避免混叠。然而，题目要求一种伪谱方法，其中非线性项是通过在物理空间中逐点相乘然后变换来计算的；此选项提出了一种不同的、完全谱的方法，并断言在伪谱框架中不需要填充或截断，这是错误的。此外，精确的模态卷积通常成本要高得多，并且不属于所要求的伪谱策略的一部分。因此，这是不正确的。\n\n因此，唯一正确指定了变换关系和二次非线性项的无混叠伪谱计算策略的选项是 B。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "最后，我们来应对时间积分的挑战。地球发电机模型包含发生在迥异时间尺度上的多种物理过程（例如，缓慢的对流与快速的惯性波或阿尔芬波），这导致了所谓的“刚性”方程组。本练习将探讨如何设计一种隐式-显式（IMEX）时间积分格式，通过对快波相关的线性项进行隐式处理来保证稳定性，同时对非线性平流项进行显式处理以维持计算效率，这正是处理此类刚性问题的标准方法。",
            "id": "3608672",
            "problem": "要求您设计并评估一个一阶隐式-显式（IMEX）时间积分器，该积分器用于一个简化的磁流体动力学地球发电机模型，通过隐式处理线性波动力学，同时显式处理非线性平流，来稳定快速的阿尔芬波和惯性波。从关于均匀磁场的线性化、不可压缩、旋转的磁流体动力学（MHD）方程出发，在傅里叶空间中，针对与旋转和磁场轴对齐的单个波矢量建立模型。从第一性原理出发，为跨参数体系的显式Courant-Friedrichs-Lewy（CFL）限制建立性能模型，并基于最快的线性波量化一个受精度限制的时间步长。\n\n基本基础和模型规范：\n- 从具有均匀背景磁场的不可压缩、旋转的MHD方程开始。动量方程为\n$$\n\\rho \\, \\frac{\\partial \\mathbf{v}}{\\partial t} = - \\nabla p - 2 \\rho \\, \\mathbf{\\Omega} \\times \\mathbf{v} + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{b}) \\times \\mathbf{B}_0 + \\rho \\, \\nu \\nabla^2 \\mathbf{v},\n$$\n感应方程为\n$$\n\\frac{\\partial \\mathbf{b}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}_0) + \\eta \\nabla^2 \\mathbf{b},\n$$\n其中 $\\,\\mathbf{v}\\,$ 是速度，$\\,\\mathbf{b}\\,$ 是磁场扰动，$\\,p\\,$ 是压力，$\\,\\rho\\,$ 是密度，$\\,\\nu\\,$ 是运动粘度，$\\,\\eta\\,$ 是磁扩散率，$\\,\\mu_0\\,$ 是自由空间磁导率，$\\,\\mathbf{\\Omega}\\,$ 是旋转矢量。假设 $\\,\\nabla \\cdot \\mathbf{v} = 0\\,$ 和 $\\,\\nabla \\cdot \\mathbf{b} = 0\\,$.\n\n- 考虑单个傅里叶模式，其波矢量 $\\,\\mathbf{k} = k \\, \\hat{\\mathbf{z}}\\,$ 与均匀背景磁场 $\\,\\mathbf{B}_0 = B_0 \\, \\hat{\\mathbf{z}}\\,$ 和旋转 $\\,\\mathbf{\\Omega} = \\Omega \\, \\hat{\\mathbf{z}}\\,$ 对齐。对于垂直于 $\\,\\hat{\\mathbf{z}}\\,$ 的扰动，在傅里叶空间中，关于 $\\,x\\,$ 和 $\\,y\\,$ 分量的线性化系统为\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x, \\quad\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y,\n$$\n$$\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x, \\quad\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y.\n$$\n定义状态向量 $\\,\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top\\,$，并将系统写为 $\\,\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U} + \\mathbf{N}(\\mathbf{U})\\,$，其中 $\\,\\mathbf{L}\\,$ 是包含科里奥利项、阿尔芬项和扩散项的线性算子。在单模截断中，显式平流项 $\\,\\mathbf{N}(\\mathbf{U})\\,$ 不会对相同的傅里叶模式产生贡献；为了稳定性建模的目的，您可以设置 $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$，同时仍然使用速度幅值施加显式CFL约束。\n\n- 实现一阶IMEX欧拉格式：\n$$\n\\mathbf{U}^{n+1} = \\left( \\mathbf{I} - \\Delta t \\, \\mathbf{L} \\right)^{-1} \\left[ \\mathbf{U}^{n} + \\Delta t \\, \\mathbf{N}(\\mathbf{U}^{n}) \\right],\n$$\n根据上述理由，设 $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$。隐式处理 $\\,\\mathbf{L}\\,$ 可以稳定快速的惯性波和阿尔芬波。\n\n性能模型：\n- 定义显式平流CFL时间步长为\n$$\n\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)},\n$$\n其中 $\\,C_{\\text{cfl}} \\in (0,1)\\,$ 是库朗数，$\\,\\Delta x\\,$ 是网格间距。\n\n- 定义一个基于最快线性波（忽略扩散）的面向精度的时间步长为\n$$\n\\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}},\n$$\n其中 $\\,C_{\\text{acc}} \\in (0,1)\\,$ 是一个精度因子，$\\,\\omega_{\\max}\\,$ 是通过将 $\\,\\mathbf{L}\\,$ 中的扩散项设置为零得到的无扩散线性算子 $\\,\\mathbf{L}_0\\,$ 的特征值的虚部的最大绝对值。最快的波包括频率为 $\\,\\omega_A = k v_A\\,$ 的阿尔芬波，其中 $\\,v_A = B_0/\\sqrt{\\mu_0 \\rho}\\,$，以及在假设的对齐情况下频率为 $\\,\\omega_I = 2 \\Omega\\,$ 的惯性波。\n\n- 选择模型时间步长 $\\,\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\\,$. 为了使用IMEX欧拉格式进行稳定性验证，计算放大矩阵 $\\,\\mathbf{G} = \\left( \\mathbf{I} - \\Delta t_{\\text{model}} \\, \\mathbf{L} \\right)^{-1}\\,$ 及其谱半径。此外，计算总能量\n$$\nE = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right),\n$$\n在一个IMEX步骤之前和之后，并使用 $\\,E^{n+1} \\le E^n\\,$ 作为对此隐式格式单调阻尼的实际检查。\n\n数值单位：\n- 使用 $\\,\\rho\\,$ 单位为 $\\mathrm{kg/m^3}$，$\\,B_0\\,$ 单位为 $\\mathrm{T}$，$\\,\\Omega\\,$ 单位为 $\\mathrm{s^{-1}}$，$\\,k\\,$ 单位为 $\\mathrm{m^{-1}}$，$\\,\\nu\\,$ 和 $\\,\\eta\\,$ 单位为 $\\mathrm{m^2/s}$，$\\,\\Delta x\\,$ 单位为 $\\mathrm{m}$，速度单位为 $\\mathrm{m/s}$。所有时间步长以秒为单位报告。\n\n测试套件：\n使用以下四种参数体系实现上述内容，使用 $\\,\\mu_0 = 4 \\pi \\times 10^{-7}\\,$ H/m，$\\,C_{\\text{cfl}} = 0.5\\,$，$\\,C_{\\text{acc}} = 0.2\\,$，以及初始状态 $\\,v_x(0) = U_0\\,$, $\\,v_y(0) = 0.4 U_0\\,$, $\\,b_x(0) = 0\\,$, $\\,b_y(0) = 0\\,$：\n\n- 案例 $\\,1\\,$ (平流限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 案例 $\\,2\\,$ (阿尔芬波精度限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-1}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 案例 $\\,3\\,$ (惯性波精度限制)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 50\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- 案例 $\\,4\\,$ (弱平流、长波)：$\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-2}\\,$, $\\,\\Omega = 10^{-4}\\,$, $\\,k = 1\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 10^{-3}\\,$.\n\n要求输出及格式：\n- 对于每个案例，计算并返回列表 $\\, [\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}] \\,$，其中前三项是浮点数，单位为秒，四舍五入到六位小数，最后一项是一个布尔值，表示 $\\,\\mathbf{G}\\,$ 的谱半径是否最多为 $\\,1\\,$ 且一步后 $\\,E^{n+1} \\le E^n\\,$ 是否成立。您的程序应生成一行输出，其中包含这些四元素列表的逗号分隔列表，并用方括号括起来（例如，$\\,[[0.05,0.00448,0.00448,True],\\ldots]\\,$）。",
            "solution": "该问题要求分析一个用于简化磁流体动力学（MHD）地球发电机模型的一阶隐式-显式（IMEX）时间积分格式。该分析涉及推导时间步长约束，为单个傅里叶模式实现数值格式，并在不同物理体系下验证其稳定性。\n\n### **问题验证**\n\n该问题在科学和数学上是适定的。控制方程是标准的、线性化的、不可压缩的、旋转的MHD方程。将其简化为与旋转矢量和背景磁场对齐的单个傅里叶模式，是研究基本波动力学（阿尔芬波和惯性波）的一种常见且有效的分析方法。IMEX欧拉格式是一种标准的数值方法，其在此处的应用被明确定义。所有必要的参数、常数和初始条件都已提供。分析任务，包括计算时间步长限制和通过谱半径和能量演化进行稳定性验证，是计算物理学中的标准程序。因此，该问题是有效的，并且可以构建一个解。\n\n### **理论构建**\n\n该方程组控制状态向量 $\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top$ 的演化，该向量表示横向速度和磁场扰动的复傅里叶振幅。其演化由 $\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U}$ 描述，在此单模线性分析中，非线性平流项 $\\mathbf{N}(\\mathbf{U})$ 被忽略。\n\n根据所提供的方程：\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x \\\\\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y \\\\\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x \\\\\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y\n$$\n\n线性算子 $\\mathbf{L}$ 是一个 $4 \\times 4$ 的复矩阵：\n$$\n\\mathbf{L} = \\begin{pmatrix}\n-\\nu k^2   2\\Omega   i \\frac{k B_0}{\\mu_0 \\rho}   0 \\\\\n-2\\Omega   -\\nu k^2   0   i \\frac{k B_0}{\\mu_0 \\rho} \\\\\ni k B_0   0   -\\eta k^2   0 \\\\\n0   i k B_0   0   -\\eta k^2\n\\end{pmatrix}\n$$\n\n### **时间步长计算**\n\n模型时间步长 $\\Delta t_{\\text{model}}$ 由两个约束决定：一个是对流CFL条件，另一个是基于线性波频率的精度条件。\n\n1.  **对流时间步长, $\\Delta t_{\\text{adv}}$**：这是一个显式CFL类型的约束，与平流的显式处理相关。尽管在我们的线性模型中 $\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}$，我们为性能建模计算此值。\n    $$\n    \\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)}\n    $$\n    给定 $C_{\\text{cfl}} = 0.5$ 和初始速度 $v_x(0) = U_0$ 及 $v_y(0) = 0.4 U_0$，这变为 $\\Delta t_{\\text{adv}} = 0.5 \\frac{\\Delta x}{U_0}$。\n\n2.  **精度时间步长, $\\Delta t_{\\text{acc}}$**：此步长确保最快的线性波在时间上得到解析。其定义为：\n    $$\n    \\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}}\n    $$\n    这里，$C_{\\text{acc}} = 0.2$，$\\omega_{\\max}$ 是无耗散线性算子 $\\mathbf{L}_0$（其中 $\\nu = 0$ 且 $\\eta = 0$）的特征值的虚部的最大绝对频率。\n\n为了找到 $\\omega_{\\max}$，我们求解无耗散线性算子 $\\mathbf{L}_0$（即 $\\nu = 0, \\eta = 0$）的特征值问题 $\\mathbf{L}_0 \\mathbf{U} = i\\omega \\mathbf{U}$。这会得到一个关于频率 $\\omega$ 的色散关系：$(\\omega^2 - \\omega_A^2)^2 = 4\\Omega^2\\omega^2$，其中 $\\omega_A = k v_A = k B_0 / \\sqrt{\\mu_0 \\rho}$ 是阿尔芬频率。该方程的四个实数解为 $\\omega = \\pm\\Omega \\pm \\sqrt{\\Omega^2+\\omega_A^2}$。因此，最大绝对频率为：\n$$\n\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}\n$$\n\n3.  **模型时间步长, $\\Delta t_{\\text{model}}$**：用于积分的最终时间步长是这两个约束的最小值：\n    $$\n    \\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\n    $$\n\n### **数值格式与稳定性分析**\n\n对于线性系统，$\\mathbf{N}(\\mathbf{U})=\\mathbf{0}$ 的一阶IMEX欧拉格式简化为一阶隐式欧拉（或后向欧拉）格式：\n$$\n\\mathbf{U}^{n+1} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1} \\mathbf{U}^{n}\n$$\n该格式的稳定性通过两个标准进行评估：\n\n1.  **谱半径**：放大矩阵是 $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$。如果谱半径 $\\rho(\\mathbf{G}) = \\max_i |\\lambda_i(\\mathbf{G})| \\le 1$，则该格式是数值稳定的。由于物理系统是耗散的（$\\mathbf{L}$ 的特征值具有非正实部），且隐式欧拉格式是A稳定的，我们预期对于任何 $\\Delta t > 0$，都有 $\\rho(\\mathbf{G}) \\le 1$。\n\n2.  **能量演化**：该模式单位体积的总能量为：\n    $$\n    E = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right)\n    $$\n    对于用稳定隐式格式积分的耗散系统，能量不应增长。我们检查在一个时间步后是否有 $E^{n+1} \\le E^n$。\n\n如果 $\\rho(\\mathbf{G}) \\le 1$ 和 $E^{n+1} \\le E^n$ 两个条件都成立，则一个案例被认为是‘稳定的’。\n\n### **测试案例的算法与实现**\n\n对于四个测试案例中的每一个，执行以下步骤：\n1.  定义所有物理和数值参数：$\\rho$, $B_0$, $\\Omega$, $k$, $\\nu$, $\\eta$, $\\Delta x$, $U_0$, $\\mu_0$, $C_{\\text{cfl}}$, $C_{\\text{acc}}$。\n2.  计算 $\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\Delta x / U_0$。\n3.  计算阿尔芬频率 $\\omega_A = k B_0 / \\sqrt{\\mu_0 \\rho}$。\n4.  计算最大波频率 $\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}$。\n5.  计算 $\\Delta t_{\\text{acc}} = C_{\\text{acc}} / \\omega_{\\max}$。\n6.  设置 $\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})$。\n7.  使用案例参数构建 $4 \\times 4$ 复矩阵 $\\mathbf{L}$。\n8.  计算放大矩阵 $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$。\n9.  计算 $\\mathbf{G}$ 的特征值并找到谱半径 $\\rho(\\mathbf{G})$。\n10. 设置初始状态向量 $\\mathbf{U}^0 = [U_0, 0.4 U_0, 0, 0]^\\top$。\n11. 计算一步之后的状态：$\\mathbf{U}^1 = \\mathbf{G} \\mathbf{U}^0$。\n12. 从 $\\mathbf{U}^0$ 计算初始能量 $E^0$，从 $\\mathbf{U}^1$ 计算最终能量 $E^1$。\n13. 基于 $\\rho(\\mathbf{G}) \\le 1$ 和 $E^1 \\le E^0$ 确定稳定性标志。\n14. 存储列表 $[\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}]$，其中浮点数值四舍五入到六位小数。\n\n对所有四个案例重复此过程以生成最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the IMEX geodynamo model problem for the given test cases.\n    \"\"\"\n    \n    # Define physical and numerical constants\n    MU_0 = 4 * np.pi * 1e-7  # H/m\n    C_CFL = 0.5\n    C_ACC = 0.2\n    \n    # (rho, B0, Omega, k, nu, eta, dx, U0)\n    test_cases = [\n        # Case 1 (advection-limited)\n        (1e4, 5e-3, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 2 (Alfvén accuracy-limited)\n        (1e4, 5e-1, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 3 (inertial accuracy-limited)\n        (1e4, 5e-3, 50, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 4 (weak advection, long waves)\n        (1e4, 5e-2, 1e-4, 1, 1e-6, 1, 0.1, 1e-3),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        rho, B0, Omega, k, nu, eta, dx, U0 = case\n\n        # Initial state\n        u0_vec = np.array([U0, 0.4 * U0, 0, 0], dtype=np.complex128)\n\n        # 1. Calculate advective time step\n        max_v = max(np.abs(u0_vec[0]), np.abs(u0_vec[1]))\n        dt_adv = C_CFL * dx / max_v\n\n        # 2. Calculate accuracy time step\n        omega_A = k * B0 / np.sqrt(MU_0 * rho)\n        omega_max = Omega + np.sqrt(Omega**2 + omega_A**2)\n        dt_acc = C_ACC / omega_max\n\n        # 3. Determine model time step\n        dt_model = min(dt_adv, dt_acc)\n\n        # 4. Construct linear operator L\n        L = np.zeros((4, 4), dtype=np.complex128)\n        \n        # Diagonal terms\n        L[0, 0] = -nu * k**2\n        L[1, 1] = -nu * k**2\n        L[2, 2] = -eta * k**2\n        L[3, 3] = -eta * k**2\n        \n        # Coriolis terms\n        L[0, 1] = 2 * Omega\n        L[1, 0] = -2 * Omega\n        \n        # Lorentz force terms\n        L[0, 2] = 1j * k * B0 / (MU_0 * rho)\n        L[1, 3] = 1j * k * B0 / (MU_0 * rho)\n        \n        # Induction terms\n        L[2, 0] = 1j * k * B0\n        L[3, 1] = 1j * k * B0\n\n        # 5. Stability Analysis\n        I = np.identity(4)\n        G = np.linalg.inv(I - dt_model * L)\n        \n        # Spectral radius check\n        eigenvalues_G = np.linalg.eigvals(G)\n        spectral_radius = np.max(np.abs(eigenvalues_G))\n        stable_spectral = spectral_radius = 1.0 + 1e-9\n\n        # Energy check\n        def calculate_energy(U):\n            vx, vy, bx, by = U\n            kinetic_energy = 0.5 * rho * (np.abs(vx)**2 + np.abs(vy)**2)\n            magnetic_energy = 0.5 / MU_0 * (np.abs(bx)**2 + np.abs(by)**2)\n            return kinetic_energy + magnetic_energy\n\n        energy_0 = calculate_energy(u0_vec)\n        u1_vec = G @ u0_vec\n        energy_1 = calculate_energy(u1_vec)\n        stable_energy = energy_1 = energy_0 + 1e-9\n\n        is_stable = stable_spectral and stable_energy\n        \n        result = [dt_adv, dt_acc, dt_model, is_stable]\n        all_results.append(result)\n\n    # Format output string\n    str_results = []\n    for r in all_results:\n        # Format floats to 6 decimal places, boolean as is\n        s = f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{str(r[3])}]\"\n        str_results.append(s)\n        \n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```"
        }
    ]
}