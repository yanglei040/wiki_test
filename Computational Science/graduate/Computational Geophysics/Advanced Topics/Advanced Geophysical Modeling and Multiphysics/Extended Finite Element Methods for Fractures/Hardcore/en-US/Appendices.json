{
    "hands_on_practices": [
        {
            "introduction": "The power of XFEM hinges on accurately describing the fracture's geometry independent of the mesh. This practice delves into the computational engine that makes this possible using level sets. You will implement the core algorithms to determine how a crack intersects an element, locate the critical crack-tip position, and establish a local coordinate system—all essential prerequisites for applying enrichment and evaluating fracture integrals. ",
            "id": "3590698",
            "problem": "You are given a four-node ($4$-node) isoparametric quadrilateral element with nodes ordered counter-clockwise as $\\{0,1,2,3\\}$. The geometry is specified by nodal coordinates $\\{\\boldsymbol{x}_i\\}_{i=0}^3$, with $\\boldsymbol{x}_i = (x_i,y_i)$ in meters. At each node, two level-set fields are provided: $\\phi_i$ and $\\psi_i$. In the context of the Extended Finite Element Method (XFEM), assume $\\phi(\\boldsymbol{x})$ and $\\psi(\\boldsymbol{x})$ are the isoparametric bilinear interpolants of $\\{\\phi_i\\}$ and $\\{\\psi_i\\}$, respectively, and that they represent, near a straight crack, signed distances along the local crack-normal and crack-tangent directions. The crack set is defined by the curve $\\Gamma_c := \\{\\boldsymbol{x} \\, | \\, \\phi(\\boldsymbol{x}) = 0, \\, \\psi(\\boldsymbol{x}) \\le 0\\}$, where the inequality selects the portion of the zero-level set lying behind or at the crack tip. The crack tip is the unique point (possibly outside the element) satisfying the system $\\phi(\\boldsymbol{x})=0$ and $\\psi(\\boldsymbol{x})=0$.\n\nYour task is to derive from first principles and implement a complete procedure that, for each test case below, performs the following:\n\n1) Crack-edge intersections. Treat each element edge as the linear segment between its two nodes. Using only the nodal values of $\\phi$ on that edge and the assumption that $\\phi$ varies linearly along the edge, determine whether the curve $\\{\\phi=0\\}$ intersects the edge in its open or closed interval. If so, locate the unique intersection point on that edge. At any such candidate intersection point, evaluate $\\psi$ along the same edge by linear interpolation of the nodal $\\psi$ values at the two edge endpoints, and retain the intersection if and only if $\\psi \\le 0$. The result is a set of $m \\in \\{0,1,2\\}$ retained intersection points on the boundary of the element. If a node has $\\phi=0$, treat the node as a valid intersection candidate; if it lies on two edges, do not duplicate the point. Process edges in the order $(0,1)$, $(1,2)$, $(2,3)$, $(3,0)$, and report retained intersections in that same order.\n\n2) Crack-tip location. Model $\\phi(\\boldsymbol{\\xi})$ and $\\psi(\\boldsymbol{\\xi})$ inside the element using isoparametric bilinear interpolation over the standard parent coordinates $\\boldsymbol{\\xi}=(\\xi,\\eta)\\in[-1,1]^2$, and solve the nonlinear system\n$$\n\\phi(\\xi,\\eta) = 0, \\qquad \\psi(\\xi,\\eta)=0\n$$\nfor $(\\xi,\\eta)$ using a Newton iteration starting from $(\\xi,\\eta)=(0,0)$. Map $(\\xi,\\eta)$ to the physical tip position $\\boldsymbol{x}_{\\mathrm{tip}}$ using the same isoparametric mapping defined by the nodal coordinates.\n\n3) Local crack-tip frame and polar coordinates. Compute the gradients $\\nabla \\phi$ and $\\nabla \\psi$ at $\\boldsymbol{x}_{\\mathrm{tip}}$ in physical coordinates via the chain rule through the isoparametric mapping. Define the orthonormal local basis as $\\hat{\\boldsymbol{t}} := \\nabla \\psi / \\|\\nabla \\psi\\|$ (local crack-tangent direction) and $\\hat{\\boldsymbol{n}} := \\nabla \\phi / \\|\\nabla \\phi\\|$ (local crack-normal direction). For each Gauss point $\\boldsymbol{x}_{gp}$, form $\\Delta \\boldsymbol{x} := \\boldsymbol{x}_{gp} - \\boldsymbol{x}_{\\mathrm{tip}}$, compute the local components $x_{\\mathrm{loc}} := \\hat{\\boldsymbol{t}}\\cdot \\Delta\\boldsymbol{x}$ and $y_{\\mathrm{loc}} := \\hat{\\boldsymbol{n}}\\cdot \\Delta\\boldsymbol{x}$, and then the polar coordinates\n$$\nr := \\sqrt{x_{\\mathrm{loc}}^2 + y_{\\mathrm{loc}}^2}, \\qquad \\theta := \\operatorname{atan2}(y_{\\mathrm{loc}}, x_{\\mathrm{loc}}).\n$$\nHere $r$ must be reported in meters and $\\theta$ in radians.\n\nUse the standard two-point tensor-product Gauss quadrature in the parent coordinates with abscissae $\\pm 1/\\sqrt{3}$ (no need to use weights). The parent Gauss points are $(\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$. Map each to physical space with the isoparametric bilinear mapping.\n\nNumerical details and conventions:\n- Treat any comparison to zero with a strict numerical tolerance of $10^{-12}$.\n- When retaining intersection points, apply the condition $\\psi \\le 0$ using the same tolerance.\n- If $m=1$, you must still output space for two intersection points: use the placeholder value $-9999.0$ meters for the missing point. If $m=0$, both reported intersection points must be the placeholder.\n- Report all floating-point outputs rounded to exactly six decimal places. Angles must be in radians. Coordinates and distances must be in meters.\n- The element edges must be processed and reported in the order $(0,1)$, $(1,2), (2,3), (3,0)$).\n\nTest suite. For each test, you are provided with $\\{\\boldsymbol{x}_i\\}_{i=0}^3$ in meters and the nodal arrays $\\{\\phi_i\\}_{i=0}^3$ and $\\{\\psi_i\\}_{i=0}^3$:\n\n- Test A (tip inside, one retained boundary intersection):\n  - $\\boldsymbol{x}_0=(0,0)$, $\\boldsymbol{x}_1=(1,0)$, $\\boldsymbol{x}_2=(1,1)$, $\\boldsymbol{x}_3=(0,1)$.\n  - $\\phi = [-0.5,-0.5,0.5,0.5]$.\n  - $\\psi = [-0.25,0.75,0.75,-0.25]$.\n\n- Test B (fully cut element, two retained intersections):\n  - $\\boldsymbol{x}_0=(0,0)$, $\\boldsymbol{x}_1=(1,0)$, $\\boldsymbol{x}_2=(1,1)$, $\\boldsymbol{x}_3=(0,1)$.\n  - $\\phi = [-0.5,-0.5,0.5,0.5]$.\n  - $\\psi = [-2.0,-1.0,-1.0,-2.0]$.\n\n- Test C (oblique tip inside, one retained boundary intersection):\n  - $\\boldsymbol{x}_0=(0,0)$, $\\boldsymbol{x}_1=(1,0)$, $\\boldsymbol{x}_2=(1,1)$, $\\boldsymbol{x}_3=(0,1)$.\n  - $\\phi \\approx [-0.219615242271,-0.719615242271,0.146410161514,0.646410161514]$.\n  - $\\psi \\approx [-0.819615242271,0.046410161514,0.546410161514,-0.319615242271]$.\n\n- Test D (borderline inclusion with $\\psi=0$ at one intersection):\n  - $\\boldsymbol{x}_0=(0,0)$, $\\boldsymbol{x}_1=(1,0)$, $\\boldsymbol{x}_2=(1,1)$, $\\boldsymbol{x}_3=(0,1)$.\n  - $\\phi = [-0.5,-0.5,0.5,0.5]$.\n  - $\\psi = [-1.0,0.0,0.0,-1.0]$.\n\nYour program must produce a single line of output containing the results for Tests A–D as a comma-separated list of lists enclosed in square brackets, without spaces, in the order [A,B,C,D]. The result for each test is itself a list containing:\n- the integer $m$,\n- the coordinates of up to two retained boundary intersection points in meters in the order found, as $(x_1,y_1,x_2,y_2)$ using $-9999.0$ where required,\n- followed by the local polar coordinates at the four Gauss points in the fixed order $(\\xi,\\eta) = (-g,-g),(+g,-g),(+g,+g),(-g,+g)$ with $g=1/\\sqrt{3}$, as $(r_1,\\theta_1,r_2,\\theta_2,r_3,\\theta_3,r_4,\\theta_4)$.\n\nThus each test produces a list of length $13$: $[m,x_1,y_1,x_2,y_2,r_1,\\theta_1,r_2,\\theta_2,r_3,\\theta_3,r_4,\\theta_4]$, and the final output must be a single line of the form:\n$[[\\dots],[\\dots],[\\dots],[\\dots]]$\nwith no spaces and all floating-point numbers rounded to six decimal places, angles in radians, and lengths in meters.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of the Extended Finite Element Method (XFEM), well-posed with a clear and complete set of specifications, and objective in its formulation. It presents a standard, albeit detailed, computational task in fracture mechanics without any discernible flaws in its logic, physics, or mathematical setup.\n\nThe solution is derived from the foundational principles of isoparametric finite element formulation and level-set methods for geometry description. The overall procedure is divided into three distinct but interconnected tasks: locating crack intersections with the element boundary, determining the precise location of the crack tip, and establishing a local coordinate system at the tip to characterize the stress field vicinity.\n\nA four-node quadrilateral element is defined in a two-dimensional physical space with coordinates $\\boldsymbol{x}=(x,y)$. The element geometry is mapped from a standard parent element, a square defined by parent coordinates $\\boldsymbol{\\xi}=(\\xi,\\eta) \\in [-1,1]^2$. This mapping is achieved using isoparametric bilinear shape functions $N_i(\\xi, \\eta)$, for nodes $i=0,1,2,3$:\n$$\n\\boldsymbol{x}(\\xi, \\eta) = \\sum_{i=0}^{3} N_i(\\xi, \\eta) \\boldsymbol{x}_i\n$$\nwhere $\\boldsymbol{x}_i$ are the nodal coordinates. The shape functions are given by:\n$N_0(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$\n$N_1(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$\n$N_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$\n$N_3(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$\n\nScalar fields within the element, such as the level-set functions $\\phi$ and $\\psi$, are interpolated from their nodal values $\\{\\phi_i\\}$ and $\\{\\psi_i\\}$ using the same shape functions:\n$$\n\\phi(\\xi, \\eta) = \\sum_{i=0}^{3} N_i(\\xi, \\eta) \\phi_i, \\qquad \\psi(\\xi, \\eta) = \\sum_{i=0}^{3} N_i(\\xi, \\eta) \\psi_i\n$$\n\nThe crack is implicitly defined by these two level-set functions. The set of points constituting the crack curve $\\Gamma_c$ are those where the crack-normal level set $\\phi$ is zero, and the crack-tangent level set $\\psi$ is non-positive: $\\Gamma_c = \\{\\boldsymbol{x} \\, | \\, \\phi(\\boldsymbol{x}) = 0, \\, \\psi(\\boldsymbol{x}) \\le 0\\}$. The condition on $\\psi$ determines the extent of the crack, with the crack tip being the unique point where both fields are zero: $\\phi(\\boldsymbol{x}_{\\text{tip}})=0$ and $\\psi(\\boldsymbol{x}_{\\text{tip}})=0$.\n\n1) Crack-Edge Intersections:\nTo find where the crack intersects the element's boundary, we analyze each of its four edges. For an edge connecting nodes $i$ and $j$, we assume the level-set functions vary linearly. An intersection exists if the nodal values $\\phi_i$ and $\\phi_j$ have opposite signs or if one is zero, i.e., $\\phi_i \\phi_j \\le 0$. The position of the intersection point along the edge can be found via linear interpolation. Let $\\alpha \\in [0,1]$ be the interpolation parameter. The condition $\\phi=0$ at the intersection point yields:\n$$\n\\phi_{\\text{int}} = (1-\\alpha)\\phi_i + \\alpha\\phi_j = 0 \\implies \\alpha = \\frac{\\phi_i}{\\phi_i - \\phi_j}\n$$\nThis is valid for $\\phi_i \\neq \\phi_j$. If $\\phi_i = \\phi_j$, there is no intersection within the open segment. If a node itself lies on the crack locus (e.g., $|\\phi_i|  \\epsilon$ for a small tolerance $\\epsilon$), it is a candidate intersection point corresponding to $\\alpha=0$. The physical coordinates of the intersection point $\\boldsymbol{x}_{\\text{int}}$ are then:\n$$\n\\boldsymbol{x}_{\\text{int}} = (1-\\alpha)\\boldsymbol{x}_i + \\alpha\\boldsymbol{x}_j\n$$\nTo determine if this point is part of the crack $\\Gamma_c$, we evaluate $\\psi$ at this location using the same linear interpolation:\n$$\n\\psi_{\\text{int}} = (1-\\alpha)\\psi_i + \\alpha\\psi_j\n$$\nThe intersection point is retained if and only if $\\psi_{\\text{int}} \\le \\epsilon$. This procedure is repeated for all four edges in the specified order: $(0,1), (1,2), (2,3), (3,0)$. A list of retained intersection points is compiled, and a de-duplication step is performed for nodes that are shared by two edges to ensure each unique point is reported only once, preserving the order of discovery. The final result is a set of $m \\in \\{0, 1, 2\\}$ points.\n\n2) Crack-Tip Location:\nThe crack tip is the point $(\\xi_{\\text{tip}}, \\eta_{\\text{tip}})$ in the parent domain that simultaneously solves the nonlinear system:\n$$\n\\boldsymbol{F}(\\xi, \\eta) = \\begin{pmatrix} \\phi(\\xi, \\eta) \\\\ \\psi(\\xi, \\eta) \\end{pmatrix} = \\begin{pmatrix} \\sum_i N_i(\\xi, \\eta) \\phi_i \\\\ \\sum_i N_i(\\xi, \\eta) \\psi_i \\end{pmatrix} = \\boldsymbol{0}\n$$\nThis system is solved using the Newton-Raphson method. Starting with an initial guess $(\\xi_0, \\eta_0) = (0,0)$, successive approximations are found by the iterative update rule:\n$$\n\\begin{pmatrix} \\xi_{k+1} \\\\ \\eta_{k+1} \\end{pmatrix} = \\begin{pmatrix} \\xi_k \\\\ \\eta_k \\end{pmatrix} - \\boldsymbol{J}_{\\boldsymbol{F}}^{-1}(\\xi_k, \\eta_k) \\boldsymbol{F}(\\xi_k, \\eta_k)\n$$\nwhere $\\boldsymbol{J}_{\\boldsymbol{F}}$ is the Jacobian matrix of $\\boldsymbol{F}$ with respect to $(\\xi, \\eta)$:\n$$\n\\boldsymbol{J}_{\\boldsymbol{F}} = \\begin{pmatrix} \\frac{\\partial \\phi}{\\partial \\xi}  \\frac{\\partial \\phi}{\\partial \\eta} \\\\ \\frac{\\partial \\psi}{\\partial \\xi}  \\frac{\\partial \\psi}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\sum_i \\frac{\\partial N_i}{\\partial \\xi} \\phi_i  \\sum_i \\frac{\\partial N_i}{\\partial \\eta} \\phi_i \\\\ \\sum_i \\frac{\\partial N_i}{\\partial \\xi} \\psi_i  \\sum_i \\frac{\\partial N_i}{\\partial \\eta} \\psi_i \\end{pmatrix}\n$$\nThe derivatives of the shape functions are computed analytically. The iteration continues for a fixed number of steps until convergence to $(\\xi_{\\text{tip}}, \\eta_{\\text{tip}})$ is achieved. The physical location of the crack tip, $\\boldsymbol{x}_{\\text{tip}}$, is then found by applying the isoparametric mapping: $\\boldsymbol{x}_{\\text{tip}} = \\boldsymbol{x}(\\xi_{\\text{tip}}, \\eta_{\\text{tip}})$.\n\n3) Local Crack-Tip Frame and Polar Coordinates:\nA local coordinate system at the crack tip is essential for analyzing the surrounding field. This system is defined by two orthonormal basis vectors: $\\hat{\\boldsymbol{t}}$, tangent to the crack, and $\\hat{\\boldsymbol{n}}$, normal to the crack. These are determined from the gradients of the level-set functions at the tip:\n$$\n\\hat{\\boldsymbol{t}} = \\frac{\\nabla \\psi}{\\|\\nabla \\psi\\|}, \\qquad \\hat{\\boldsymbol{n}} = \\frac{\\nabla \\phi}{\\|\\nabla \\phi\\|}\n$$\nThe gradients $\\nabla\\phi = (\\frac{\\partial\\phi}{\\partial x}, \\frac{\\partial\\phi}{\\partial y})$ and $\\nabla\\psi$ must be computed in physical coordinates. This requires transforming the gradients from the parent domain using the chain rule:\n$$\n\\begin{pmatrix} \\frac{\\partial f}{\\partial x} \\\\ \\frac{\\partial f}{\\partial y} \\end{pmatrix} = \\boldsymbol{J}_{\\text{map}}^{-T} \\begin{pmatrix} \\frac{\\partial f}{\\partial \\xi} \\\\ \\frac{\\partial f}{\\partial \\eta} \\end{pmatrix}\n$$\nwhere $f$ is either $\\phi$ or $\\psi$, and $\\boldsymbol{J}_{\\text{map}}$ is the Jacobian of the coordinate mapping $\\boldsymbol{x}(\\xi, \\eta)$, evaluated at $(\\xi_{\\text{tip}}, \\eta_{\\text{tip}})$:\n$$\n\\boldsymbol{J}_{\\text{map}} = \\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\sum_i \\frac{\\partial N_i}{\\partial \\xi} x_i  \\sum_i \\frac{\\partial N_i}{\\partial \\eta} x_i \\\\ \\sum_i \\frac{\\partial N_i}{\\partial \\xi} y_i  \\sum_i \\frac{\\partial N_i}{\\partial \\eta} y_i \\end{pmatrix}\n$$\nWith the local basis $(\\hat{\\boldsymbol{t}}, \\hat{\\boldsymbol{n}})$ established, we can find the local coordinates of any point, such as a Gauss quadrature point $\\boldsymbol{x}_{\\text{gp}}$. First, the Gauss point's parent coordinates $(\\xi_{\\text{gp}},\\eta_{\\text{gp}})$ are mapped to physical space. Then, the vector from the tip to the Gauss point, $\\Delta \\boldsymbol{x} = \\boldsymbol{x}_{\\text{gp}} - \\boldsymbol{x}_{\\text{tip}}$, is projected onto the local basis:\n$$\nx_{\\text{loc}} = \\Delta \\boldsymbol{x} \\cdot \\hat{\\boldsymbol{t}}, \\qquad y_{\\text{loc}} = \\Delta \\boldsymbol{x} \\cdot \\hat{\\boldsymbol{n}}\n$$\nFinally, these local Cartesian coordinates are converted to polar coordinates $(r, \\theta)$:\n$$\nr = \\sqrt{x_{\\text{loc}}^2 + y_{\\text{loc}}^2}, \\qquad \\theta = \\operatorname{atan2}(y_{\\text{loc}}, x_{\\text{loc}})\n$$\nThis procedure is performed for the four specified Gauss points.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the XFEM crack problem for a 4-node quadrilateral element\n    for a suite of test cases.\n    \"\"\"\n\n    # Helper functions for isoparametric calculations\n    def shape_functions(xi, eta):\n        N = 0.25 * np.array([\n            (1.0 - xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 + eta),\n            (1.0 - xi) * (1.0 + eta)\n        ])\n        return N\n\n    def shape_derivatives(xi, eta):\n        dNdxi = 0.25 * np.array([\n            -(1.0 - eta),\n             (1.0 - eta),\n             (1.0 + eta),\n            -(1.0 + eta)\n        ])\n        dNdeta = 0.25 * np.array([\n            -(1.0 - xi),\n            -(1.0 + xi),\n             (1.0 + xi),\n             (1.0 - xi)\n        ])\n        return dNdxi, dNdeta\n\n    # Test cases definition\n    test_cases = [\n        {\n            \"coords\": np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n            \"phi\": np.array([-0.5, -0.5, 0.5, 0.5]),\n            \"psi\": np.array([-0.25, 0.75, 0.75, -0.25])\n        },\n        {\n            \"coords\": np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n            \"phi\": np.array([-0.5, -0.5, 0.5, 0.5]),\n            \"psi\": np.array([-2.0, -1.0, -1.0, -2.0])\n        },\n        {\n            \"coords\": np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n            \"phi\": np.array([-0.219615242271, -0.719615242271, 0.146410161514, 0.646410161514]),\n            \"psi\": np.array([-0.819615242271, 0.046410161514, 0.546410161514, -0.319615242271])\n        },\n        {\n            \"coords\": np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n            \"phi\": np.array([-0.5, -0.5, 0.5, 0.5]),\n            \"psi\": np.array([-1.0, 0.0, 0.0, -1.0])\n        },\n    ]\n\n    results = []\n    tol = 1e-12\n\n    for case in test_cases:\n        coords = case[\"coords\"]\n        phi_vals = case[\"phi\"]\n        psi_vals = case[\"psi\"]\n        \n        # --- 1) Crack-edge intersections ---\n        raw_intersections = []\n        edges = [(0, 1), (1, 2), (2, 3), (3, 0)]\n        for i, j in edges:\n            phi_i, phi_j = phi_vals[i], phi_vals[j]\n            if phi_i * phi_j = tol * tol:\n                if abs(phi_i - phi_j)  tol:\n                    # This case implies phi is constant and near zero on the edge.\n                    # The problem setup implies unique intersections, so we ignore this edge case.\n                    # Or check individual nodes.\n                    if abs(phi_i)  tol:\n                        raw_intersections.append((i, 0.0))\n                    continue\n\n                alpha = phi_i / (phi_i - phi_j)\n                if 0.0 = alpha = 1.0:\n                    psi_i, psi_j = psi_vals[i], psi_vals[j]\n                    psi_int = (1.0 - alpha) * psi_i + alpha * psi_j\n                    if psi_int = tol:\n                        x_i, x_j = coords[i], coords[j]\n                        x_int = (1.0 - alpha) * x_i + alpha * x_j\n                        raw_intersections.append(x_int)\n        \n        # De-duplicate while preserving order\n        intersections = []\n        for p in raw_intersections:\n            is_duplicate = any(np.linalg.norm(p - up)  tol for up in intersections)\n            if not is_duplicate:\n                intersections.append(p)\n        \n        m = len(intersections)\n        intersections_coords = np.full((2, 2), -9999.0)\n        if m  0:\n            intersections_coords[:m, :] = np.array(intersections)\n\n        # --- 2) Crack-tip location ---\n        xi, eta = 0.0, 0.0\n        for _ in range(10): # Newton-Raphson iterations\n            N = shape_functions(xi, eta)\n            dNdxi, dNdeta = shape_derivatives(xi, eta)\n            \n            F = np.array([N @ phi_vals, N @ psi_vals])\n            \n            J_F = np.array([\n                [dNdxi @ phi_vals, dNdeta @ phi_vals],\n                [dNdxi @ psi_vals, dNdeta @ psi_vals]\n            ])\n            \n            delta = np.linalg.solve(J_F, -F)\n            xi += delta[0]\n            eta += delta[1]\n        \n        tip_xi_eta = np.array([xi, eta])\n        x_tip = shape_functions(xi, eta) @ coords\n\n        # --- 3) Local crack-tip frame and polar coordinates ---\n        dNdxi_tip, dNdeta_tip = shape_derivatives(tip_xi_eta[0], tip_xi_eta[1])\n        \n        J_map = np.array([\n            [dNdxi_tip @ coords[:, 0], dNdeta_tip @ coords[:, 0]],\n            [dNdxi_tip @ coords[:, 1], dNdeta_tip @ coords[:, 1]]\n        ])\n        \n        grad_phi_parent = np.array([dNdxi_tip @ phi_vals, dNdeta_tip @ phi_vals])\n        grad_psi_parent = np.array([dNdxi_tip @ psi_vals, dNdeta_tip @ psi_vals])\n        \n        # Using J_inv.T instead of J.T_inv\n        # grad_phys = J_inv.T @ grad_parent\n        J_map_inv_T = np.linalg.inv(J_map).T\n        \n        grad_phi_phys = J_map_inv_T @ grad_phi_parent\n        grad_psi_phys = J_map_inv_T @ grad_psi_parent\n        \n        n_hat = grad_phi_phys / np.linalg.norm(grad_phi_phys)\n        t_hat = grad_psi_phys / np.linalg.norm(grad_psi_phys)\n        \n        g = 1.0 / np.sqrt(3.0)\n        gauss_points_parent = [(-g, -g), (g, -g), (g, g), (-g, g)]\n        \n        polar_coords = []\n        for xi_gp, eta_gp in gauss_points_parent:\n            x_gp = shape_functions(xi_gp, eta_gp) @ coords\n            delta_x = x_gp - x_tip\n            \n            x_loc = np.dot(delta_x, t_hat)\n            y_loc = np.dot(delta_x, n_hat)\n            \n            r = np.hypot(x_loc, y_loc)\n            theta = np.arctan2(y_loc, x_loc)\n            polar_coords.extend([r, theta])\n\n        # Assemble final result for the current case\n        case_result = [m] + list(intersections_coords.flatten()) + polar_coords\n        results.append(case_result)\n\n    # Format the final output string\n    output_parts = []\n    for res_list in results:\n        items = [str(res_list[0])]\n        for val in res_list[1:]:\n             items.append(f\"{val:.6f}\")\n        output_parts.append(\"[\" + \",\".join(items) + \"]\")\n    final_str = \"[\" + \",\".join(output_parts) + \"]\"\n    print(final_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Once a crack's path through an element is known, the weak form of the governing equations requires evaluating integrals over this internal boundary. This exercise demonstrates the fundamental procedure for this task: transforming a line integral on a physical crack segment to a standard reference domain suitable for numerical quadrature. Mastering this mapping is crucial for applying traction boundary conditions or cohesive laws on the fracture. ",
            "id": "3590767",
            "problem": "In two-dimensional small-strain linear elasticity, consider the internal traction work term that appears in the weak form when imposing Neumann boundary conditions on the faces of a fracture represented with the Extended Finite Element Method (XFEM). For an element cut by a straight crack face, the contribution from the segment of the crack face traversing a single cut element is expressed as a one-dimensional line integral of the form\n$$\n\\int_{\\Gamma_{c}^{e}} \\boldsymbol{N}^{\\top}(\\boldsymbol{x})\\,\\boldsymbol{t}(\\boldsymbol{x})\\,\\mathrm{d}\\Gamma,\n$$\nwhere $\\Gamma_{c}^{e}$ is the portion of the crack face inside the element, $\\boldsymbol{N}$ is the matrix of finite element shape functions evaluated at the integration point, and $\\boldsymbol{t}$ is the traction vector.\n\nAssume a bilinear quadrilateral finite element whose physical-space nodal coordinates (in meters) are $\\boldsymbol{x}_{1}=(0,0)$, $\\boldsymbol{x}_{2}=(2,0)$, $\\boldsymbol{x}_{3}=(2,1)$, and $\\boldsymbol{x}_{4}=(0,1)$. The straight crack face intersects this element at the two physical-space points $\\boldsymbol{P}_{a}=(0.5,\\,0.2)$ and $\\boldsymbol{P}_{b}=(1.5,\\,0.8)$, so that $\\Gamma_{c}^{e}$ is the straight segment joining $\\boldsymbol{P}_{a}$ and $\\boldsymbol{P}_{b}$.\n\nStarting from the definition of a line integral and a one-dimensional isoparametric mapping that parametrizes the segment $\\Gamma_{c}^{e}$ with a single parameter $\\eta\\in[-1,1]$, derive the one-dimensional mapping Jacobian $J(\\eta)=\\left\\|\\frac{\\mathrm{d}\\boldsymbol{x}}{\\mathrm{d}\\eta}\\right\\|$ for this segment and determine the transformed quadrature weights for a two-point Gauss–Legendre rule on $[-1,1]$ to integrate the traction term along $\\Gamma_{c}^{e}$. You may take as known the two-point Gauss–Legendre abscissae and weights on $[-1,1]$.\n\nReport the Jacobian $J$ and the two physical-space quadrature weights as numerical values in meters, and round your answer to four significant figures. Express the final numerical values in meters.",
            "solution": "The weak form contribution of a traction applied along an internal crack face segment $\\Gamma_{c}^{e}$ inside a cut element is given by the one-dimensional line integral\n$$\n\\int_{\\Gamma_{c}^{e}} \\boldsymbol{N}^{\\top}(\\boldsymbol{x})\\,\\boldsymbol{t}(\\boldsymbol{x})\\,\\mathrm{d}\\Gamma,\n$$\nwhere the geometric measure $\\mathrm{d}\\Gamma$ is the line element along the crack segment. To evaluate this integral numerically, we parameterize the straight segment between $\\boldsymbol{P}_{a}$ and $\\boldsymbol{P}_{b}$ using an isoparametric affine mapping from a reference coordinate $\\eta\\in[-1,1]$ to the physical coordinates $\\boldsymbol{x}(\\eta)$:\n$$\n\\boldsymbol{x}(\\eta) \\;=\\; \\frac{1-\\eta}{2}\\,\\boldsymbol{P}_{a} \\;+\\; \\frac{1+\\eta}{2}\\,\\boldsymbol{P}_{b}.\n$$\nThis mapping satisfies $\\boldsymbol{x}(-1)=\\boldsymbol{P}_{a}$ and $\\boldsymbol{x}(+1)=\\boldsymbol{P}_{b}$. The line element transforms according to\n$$\n\\mathrm{d}\\Gamma \\;=\\; \\left\\| \\frac{\\mathrm{d}\\boldsymbol{x}}{\\mathrm{d}\\eta} \\right\\| \\,\\mathrm{d}\\eta \\;\\equiv\\; J(\\eta)\\,\\mathrm{d}\\eta.\n$$\nDifferentiating $\\boldsymbol{x}(\\eta)$ with respect to $\\eta$ gives\n$$\n\\frac{\\mathrm{d}\\boldsymbol{x}}{\\mathrm{d}\\eta} \\;=\\; -\\frac{1}{2}\\,\\boldsymbol{P}_{a} \\;+\\; \\frac{1}{2}\\,\\boldsymbol{P}_{b} \\;=\\; \\frac{1}{2}\\left(\\boldsymbol{P}_{b}-\\boldsymbol{P}_{a}\\right).\n$$\nTherefore, the Jacobian is constant along the segment:\n$$\nJ(\\eta) \\;=\\; \\left\\| \\frac{1}{2}\\left(\\boldsymbol{P}_{b}-\\boldsymbol{P}_{a}\\right) \\right\\| \\;=\\; \\frac{1}{2}\\,\\left\\|\\boldsymbol{P}_{b}-\\boldsymbol{P}_{a}\\right\\|.\n$$\nDefine the segment vector and its length:\n$$\n\\Delta \\boldsymbol{P} \\;=\\; \\boldsymbol{P}_{b}-\\boldsymbol{P}_{a}, \\qquad L \\;=\\; \\|\\Delta \\boldsymbol{P}\\|.\n$$\nThen\n$$\nJ(\\eta) \\;=\\; \\frac{L}{2}.\n$$\nWith the given points $\\boldsymbol{P}_{a}=(0.5,\\,0.2)$ and $\\boldsymbol{P}_{b}=(1.5,\\,0.8)$ (units in meters), we compute\n$$\n\\Delta \\boldsymbol{P} \\;=\\; \\begin{pmatrix} 1.5-0.5 \\\\ 0.8-0.2 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 1.0 \\\\ 0.6 \\end{pmatrix},\n$$\nand hence\n$$\nL \\;=\\; \\sqrt{(1.0)^{2} + (0.6)^{2}} \\;=\\; \\sqrt{1.36}.\n$$\nThus,\n$$\nJ \\;=\\; \\frac{L}{2} \\;=\\; \\frac{\\sqrt{1.36}}{2}.\n$$\nFor numerical integration using the two-point Gauss–Legendre rule on $[-1,1]$, the reference abscissae are $\\eta_{1}=-\\frac{1}{\\sqrt{3}}$ and $\\eta_{2}=+\\frac{1}{\\sqrt{3}}$, with reference weights $w_{1}=w_{2}=1$. The transformed physical-space quadrature for a line integral is\n$$\n\\int_{-1}^{1} f(\\eta)\\,J\\,\\mathrm{d}\\eta \\;\\approx\\; \\sum_{i=1}^{2} w_{i}\\,J\\,f(\\eta_{i}),\n$$\nso the physical-space weights are\n$$\nw_{i}^{\\text{phys}} \\;=\\; w_{i}\\,J \\;=\\; J, \\qquad i=1,2.\n$$\nNumerically, using $L=\\sqrt{1.36}$,\n$$\nL \\;=\\; \\sqrt{1.36} \\;\\approx\\; 1.166190378\\ldots, \\qquad J \\;=\\; \\frac{L}{2} \\;\\approx\\; 0.583095189\\ldots\n$$\nRounded to four significant figures (and expressed in meters as requested), we obtain\n$$\nJ \\;\\approx\\; 0.5831, \\qquad w_{1}^{\\text{phys}} \\;\\approx\\; 0.5831, \\qquad w_{2}^{\\text{phys}} \\;\\approx\\; 0.5831.\n$$\nThese values are the constant Jacobian for the straight segment mapping and the two identical transformed Gauss–Legendre weights for integrating along the crack face segment inside the cut element.",
            "answer": "$$\\boxed{\\begin{pmatrix}0.5831  0.5831  0.5831\\end{pmatrix}}$$"
        },
        {
            "introduction": "While XFEM offers great geometric flexibility, it can introduce unique numerical challenges, particularly in dynamic simulations. This exercise explores one of the most significant: the \"small cut cell problem\" that arises in explicit time integration. You will derive how the small sub-elements, created when a crack grazes a mesh line, can severely restrict the stable time step, $\\Delta t_{\\mathrm{crit}}$, a critical consideration for computational efficiency in modeling dynamic fracture propagation. ",
            "id": "3590742",
            "problem": "Consider small-strain, linear, plane-strain elastodynamics in a homogeneous, isotropic rock with density $\\,\\rho\\,$, Young’s modulus $\\,E\\,$, and Poisson’s ratio $\\,\\nu\\,$. A fracture is represented using the Extended Finite Element Method (XFEM), which enriches the displacement approximation in elements cut by the discontinuity. Numerical integration in the cut elements is performed by sub-triangulating the cut polygon into integration subcells. In an explicit central-difference time integration with diagonal (lumped) mass, the Courant–Friedrichs–Lewy (CFL) condition constrains the stable time step by the highest discrete wave frequency supported by the mesh. In an enriched element intersected by the fracture, one integration subcell is a thin sliver with its smallest dimension equal to $\\,\\ell_{\\min}\\,$. Assume:\n- The enriched approximation does not alter the continuum wave speeds but can create arbitrarily small integration subcells.\n- The most restrictive discrete mode is localized along the direction of the sliver’s smallest dimension $\\,\\ell_{\\min}\\,$, which governs the largest eigenfrequency of the semi-discrete system near the cut.\n- The explicit scheme uses consistent linear elasticity with Lamé parameters $\\,\\lambda\\,$ and $\\,\\mu\\,$, and mass lumping consistent with the underlying linear finite element.\n\nStarting from the equations of motion $\\,\\rho\\,\\ddot{\\boldsymbol{u}}=\\nabla\\cdot\\boldsymbol{\\sigma}\\,$ with $\\,\\boldsymbol{\\sigma}=\\lambda\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon})\\boldsymbol{I}+2\\mu\\,\\boldsymbol{\\varepsilon}\\,$ and the definitions of compressional and shear wave speeds in plane strain, derive an analytic upper bound for the stable explicit time step $\\,\\Delta t_{\\mathrm{crit}}\\,$ in terms of the smallest cut subcell size $\\,\\ell_{\\min}\\,$ and the material parameters. Your derivation must begin from these field equations and proceed by an energy or dispersion-based argument that relates the largest eigenfrequency to the smallest representable wavelength over the sliver, modeled as a one-dimensional mass–spring chain surrogate along $\\,\\ell_{\\min}\\,$. Then evaluate your bound numerically for the following material and geometric data:\n- $\\,E=40\\,\\mathrm{GPa}\\,$,\n- $\\,\\nu=0.25\\,$,\n- $\\,\\rho=2600\\,\\mathrm{kg/m^{3}}\\,$,\n- $\\,\\ell_{\\min}=0.50\\,\\mathrm{mm}\\,$.\n\nExpress the final time step in microseconds and round your answer to four significant figures. The final answer must be a single real-valued number.",
            "solution": "The solution involves three main steps: first, determining the fastest wave propagation speed in the material under plane strain conditions; second, analyzing the discrete system to find its highest natural frequency; and third, applying the stability condition for the explicit time integration scheme to relate the critical time step to this frequency and the smallest element dimension.\n\n### 1. Wave Speeds in a Plane Strain Elastic Medium\nThe governing equation for linear elastodynamics is the Navier-Cauchy equation, derived by substituting the constitutive and kinematic relations into the balance of linear momentum:\n$$ \\rho\\,\\ddot{\\boldsymbol{u}} = (\\lambda + \\mu) \\nabla(\\nabla \\cdot \\boldsymbol{u}) + \\mu \\nabla^2 \\boldsymbol{u} $$\nThis equation supports two types of body waves: compressional (P-waves) and shear (S-waves). The fastest of these, the P-wave, travels at a speed $v_p$ given by:\n$$ v_p = \\sqrt{\\frac{\\lambda + 2\\mu}{\\rho}} $$\nThis is the maximum speed of signal propagation within the medium and thus governs the stability of explicit time integration schemes. The problem is specified in plane strain, and the material properties are given as Young's modulus $E$ and Poisson's ratio $\\nu$. We must relate the Lamé parameters $\\lambda$ and $\\mu$ to $E$ and $\\nu$ for plane strain. The relationships are:\n$$ \\mu = \\frac{E}{2(1+\\nu)} $$\n$$ \\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} $$\nThe plane strain P-wave modulus, $M = \\lambda + 2\\mu$, is then:\n$$ M = \\lambda + 2\\mu = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} + 2 \\left( \\frac{E}{2(1+\\nu)} \\right) = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} + \\frac{E}{1+\\nu} $$\n$$ M = \\frac{E}{1+\\nu} \\left( \\frac{\\nu}{1-2\\nu} + 1 \\right) = \\frac{E}{1+\\nu} \\left( \\frac{\\nu + 1 - 2\\nu}{1-2\\nu} \\right) = \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} $$\nTherefore, the P-wave speed is:\n$$ v_p = \\sqrt{\\frac{E(1-\\nu)}{\\rho(1+\\nu)(1-2\\nu)}} $$\n\n### 2. Dispersion Analysis of a Discrete System\nAs per the problem's directive, we model the dynamics along the sliver's smallest dimension $\\ell_{\\min}$ as a one-dimensional chain of masses and springs. We consider a uniform discretization with element length $\\ell$. For a linear finite element with lumped mass, the semi-discrete equation of motion for an internal node $j$ is:\n$$ m_j \\ddot{u}_j = k(u_{j-1} - u_j) + k(u_{j+1} - u_j) $$\nwhere $m_j = \\rho A \\ell$ is the lumped mass (with $A$ being a fictitious cross-sectional area), and $k = E'A/\\ell$ is the stiffness of an element, where $E'$ is the relevant 1D elastic modulus.\n$$ (\\rho A \\ell) \\ddot{u}_j = \\frac{E'A}{\\ell} (u_{j-1} - 2u_j + u_{j+1}) $$\n$$ \\ddot{u}_j = \\frac{E'}{\\rho \\ell^2} (u_{j-1} - 2u_j + u_{j+1}) $$\nWe seek a harmonic solution (an eigenmode) of the form $u_j(t) = \\hat{u} \\exp(i(\\kappa j\\ell - \\omega t))$, where $\\kappa$ is the wavenumber and $\\omega$ is the angular frequency. Substituting this into the equation of motion yields the dispersion relation for the discrete system:\n$$ -\\omega^2 = \\frac{E'}{\\rho \\ell^2} (e^{-i\\kappa\\ell} - 2 + e^{i\\kappa\\ell}) = \\frac{E'}{\\rho \\ell^2} (2\\cos(\\kappa\\ell) - 2) = -\\frac{4E'}{\\rho \\ell^2} \\sin^2\\left(\\frac{\\kappa\\ell}{2}\\right) $$\n$$ \\omega^2 = \\frac{4E'}{\\rho \\ell^2} \\sin^2\\left(\\frac{\\kappa\\ell}{2}\\right) $$\nThe highest frequency, $\\omega_{\\max}$, supported by the grid occurs for the shortest representable wavelength, $\\lambda_{\\text{grid}} = 2\\ell$. This corresponds to a wavenumber $\\kappa_{\\max} = 2\\pi/\\lambda_{\\text{grid}} = \\pi/\\ell$. At this wavenumber:\n$$ \\omega_{\\max}^2 = \\frac{4E'}{\\rho \\ell^2} \\sin^2\\left(\\frac{(\\pi/\\ell)\\ell}{2}\\right) = \\frac{4E'}{\\rho \\ell^2} $$\n$$ \\omega_{\\max} = \\frac{2}{\\ell} \\sqrt{\\frac{E'}{\\rho}} = \\frac{2c}{\\ell} $$\nwhere $c=\\sqrt{E'/\\rho}$ is the continuum wave speed.\n\n### 3. Stability of the Explicit Central-Difference Scheme\nThe explicit central-difference time integration scheme is stable if and only if the time step $\\Delta t$ satisfies the condition:\n$$ \\Delta t \\le \\frac{2}{\\omega_{\\max}} $$\nSubstituting our expression for $\\omega_{\\max}$:\n$$ \\Delta t \\le \\frac{2}{2c/\\ell} = \\frac{\\ell}{c} $$\n\n### 4. Application to the XFEM Sliver Element\nAccording to the problem statement, the stability is governed by the sliver subcell. The characteristic length $\\ell$ is therefore the sliver's smallest dimension, $\\ell_{\\min}$. The wave speed $c$ must be the fastest wave speed in the material, which is the P-wave speed, $v_p$. The 1D modulus $E'$ in the surrogate model is thus replaced by the plane strain P-wave modulus $M = \\lambda + 2\\mu$.\nSo, the critical time step upper bound is:\n$$ \\Delta t_{\\mathrm{crit}} = \\frac{\\ell_{\\min}}{v_p} $$\nSubstituting the expression for $v_p$ derived in Part 1, we obtain the final analytical expression for the upper bound:\n$$ \\Delta t_{\\mathrm{crit}} = \\ell_{\\min} \\sqrt{\\frac{\\rho(1+\\nu)(1-2\\nu)}{E(1-\\nu)}} $$\n\n### Numerical Evaluation\nWe now substitute the given numerical values into the derived formula.\n-   $E = 40\\,\\mathrm{GPa} = 40 \\times 10^9\\,\\mathrm{Pa}$\n-   $\\nu = 0.25$\n-   $\\rho = 2600\\,\\mathrm{kg/m^{3}}$\n-   $\\ell_{\\min} = 0.50\\,\\mathrm{mm} = 0.50 \\times 10^{-3}\\,\\mathrm{m}$\n\nFirst, we calculate the P-wave speed, $v_p$:\n$$ v_p = \\sqrt{\\frac{(40 \\times 10^9\\,\\mathrm{Pa})(1-0.25)}{(2600\\,\\mathrm{kg/m^3})(1+0.25)(1-2 \\times 0.25)}} $$\n$$ v_p = \\sqrt{\\frac{(40 \\times 10^9)(0.75)}{(2600)(1.25)(0.5)}} = \\sqrt{\\frac{30 \\times 10^9}{1625}}\\,\\mathrm{m/s} $$\n$$ v_p = \\sqrt{18461538.46...}\\,\\mathrm{m/s} \\approx 4296.6892\\,\\mathrm{m/s} $$\n\nNext, we calculate the critical time step, $\\Delta t_{\\mathrm{crit}}$:\n$$ \\Delta t_{\\mathrm{crit}} = \\frac{\\ell_{\\min}}{v_p} = \\frac{0.50 \\times 10^{-3}\\,\\mathrm{m}}{4296.6892\\,\\mathrm{m/s}} $$\n$$ \\Delta t_{\\mathrm{crit}} \\approx 1.16368 \\times 10^{-7}\\,\\mathrm{s} $$\n\nFinally, we convert the result to microseconds ($1\\,\\mu\\mathrm{s} = 10^{-6}\\,\\mathrm{s}$) and round to four significant figures as required:\n$$ \\Delta t_{\\mathrm{crit}} = (1.16368 \\times 10^{-7}\\,\\mathrm{s}) \\times \\left(\\frac{1\\,\\mu\\mathrm{s}}{10^{-6}\\,\\mathrm{s}}\\right) = 0.116368\\,\\mu\\mathrm{s} $$\n$$ \\Delta t_{\\mathrm{crit}} \\approx 0.1164\\,\\mu\\mathrm{s} $$",
            "answer": "$$\\boxed{0.1164}$$"
        }
    ]
}