{
    "hands_on_practices": [
        {
            "introduction": "Before building complex numerical models, it is essential to understand the fundamental parameters that control the dynamics of mantle convection. The vigor of convection is characterized by non-dimensional numbers that relate the driving buoyancy forces to the dissipative effects of viscosity and thermal diffusion. This foundational exercise guides you through a first-principles derivation of the Rayleigh numbers for both basal and internal heating, providing a quantitative grasp of the primary forces at play in a convecting planetary mantle .",
            "id": "3609282",
            "problem": "Consider Boussinesq thermal convection of an incompressible mantle in a three-dimensional spherical shell with inner radius $r_{\\mathrm{i}}$ and outer radius $r_{\\mathrm{o}}$. The viscosity is strongly temperature dependent, but for nondimensionalization one uses a reference dynamic viscosity $\\eta_{0}$ defined at a specified reference state. Let the material properties be radially uniform and constant except for viscosity: density $\\rho$, thermal expansivity $\\alpha$, thermal conductivity $k$, thermal diffusivity $\\kappa$, and gravitational acceleration $g$. Assume constant gravity $g$ and constant material properties for the purposes of defining control parameters. The shell thickness is $D=r_{\\mathrm{o}}-r_{\\mathrm{i}}$. Two sources of thermal buoyancy are present: a basal temperature contrast $\\Delta T_{b}$ between the bottom and top boundaries, and uniform internal radiogenic heating characterized by a mass-specific heating rate $H$ (in $\\mathrm{W\\,kg^{-1}}$), so that the volumetric heating rate is $\\dot{q}=\\rho H$ (in $\\mathrm{W\\,m^{-3}}$). \n\nStarting from the dimensional Boussinesq Stokes and energy equations, and using the thermal diffusion time scale $D^{2}/\\kappa$, the length scale $D$, the velocity scale $\\kappa/D$, and temperature scales appropriate to each forcing, derive from first principles the dimensionless control parameters that multiply the buoyancy term in the nondimensional momentum equation:\n- the classical Rayleigh number $Ra$ associated with a prescribed basal temperature contrast $\\Delta T_{b}$, and \n- the internally heated Rayleigh number $Ra_{H}$ associated with uniform volumetric heating $\\dot{q}$.\n\nThen, using the Earth-like parameter values\n- $r_{\\mathrm{o}}=6.371\\times 10^{6}\\ \\mathrm{m}$, $r_{\\mathrm{i}}=3.480\\times 10^{6}\\ \\mathrm{m}$,\n- $\\rho=3300\\ \\mathrm{kg\\,m^{-3}}$, $\\alpha=3.0\\times 10^{-5}\\ \\mathrm{K^{-1}}$, $g=9.81\\ \\mathrm{m\\,s^{-2}}$,\n- $\\kappa=1.0\\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$, $k=4.0\\ \\mathrm{W\\,m^{-1}\\,K^{-1}}$,\n- $\\eta_{0}=1.0\\times 10^{21}\\ \\mathrm{Pa\\,s}$,\n- $\\Delta T_{b}=2500\\ \\mathrm{K}$, and $H=5.0\\times 10^{-12}\\ \\mathrm{W\\,kg^{-1}}$,\n\nevaluate the two Rayleigh numbers. Express both answers as dimensionless quantities and round to four significant figures. Your final answer should report $(Ra,\\ Ra_{H})$ in that order as a single row using the format specified for multiple numerical answers.",
            "solution": "The problem is first validated and found to be scientifically sound, well-posed, and complete. We can therefore proceed with the derivation and calculation.\n\nThe derivation of the dimensionless Rayleigh numbers begins with the governing equations for Boussinesq thermal convection of an incompressible fluid. The relevant dimensional equations are the Stokes equation (conservation of momentum for slow, viscous flow), the continuity equation (conservation of mass), and the thermal energy equation (conservation of energy).\n\nThe Stokes equation, including the buoyancy force term under the Boussinesq approximation, is:\n$$ \\nabla \\cdot \\boldsymbol{\\tau} - \\nabla P' + \\mathbf{f}_b = \\mathbf{0} $$\nwhere $\\boldsymbol{\\tau}$ is the deviatoric stress tensor, which for a Newtonian fluid with reference viscosity $\\eta_0$ is $\\boldsymbol{\\tau} = \\eta_0(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$. $P'$ is the dynamic pressure, and $\\mathbf{f}_b$ is the buoyancy force. The buoyancy force is given by $\\mathbf{f}_b = \\Delta \\rho \\mathbf{g} = -\\rho \\alpha (T-T_{ref}) \\mathbf{g}$, where $\\rho$ is the reference density, $\\alpha$ is the thermal expansivity, $T$ is temperature, $T_{ref}$ is a reference temperature, and $\\mathbf{g}$ is the gravitational acceleration vector. Assuming gravity acts radially inward ($\\mathbf{g} = -g\\hat{\\mathbf{r}}$), the buoyancy force term becomes $\\rho \\alpha (T-T_{ref}) g \\hat{\\mathbf{r}}$.\n\nThe continuity equation for an incompressible fluid is:\n$$ \\nabla \\cdot \\mathbf{u} = 0 $$\nwhere $\\mathbf{u}$ is the velocity vector.\n\nThe thermal energy equation with internal heating is:\n$$ \\rho c_p \\left( \\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T \\right) = k \\nabla^2 T + \\dot{q} $$\nwhere $c_p$ is the specific heat capacity at constant pressure, $k$ is the thermal conductivity, and $\\dot{q} = \\rho H$ is the volumetric heating rate.\n\nNext, we introduce dimensionless variables (denoted with a prime) based on the specified scales:\n- Position: $\\mathbf{r}' = \\mathbf{r} / D$\n- Time: $t' = t / (D^2/\\kappa)$\n- Velocity: $\\mathbf{u}' = \\mathbf{u} / (\\kappa/D)$\n- Temperature: $T = T_{ref} + \\Delta T_{scale} \\theta$, where $\\Delta T_{scale}$ is a characteristic temperature scale and $\\theta$ is the dimensionless temperature.\n- Pressure: The natural scale for dynamic pressure is the viscous stress scale, so we define $P' = (\\eta_0 \\kappa / D^2) p'$.\n\nSubstituting these into the Stokes equation and multiplying by $D^3 / (\\eta_0 \\kappa)$ yields the dimensionless momentum equation:\n$$ \\nabla' \\cdot (\\nabla'\\mathbf{u}' + (\\nabla'\\mathbf{u}')^T) - \\nabla' p' + \\left( \\frac{\\rho \\alpha g D^3 \\Delta T_{scale}}{\\eta_0 \\kappa} \\right) \\theta \\hat{\\mathbf{r}} = \\mathbf{0} $$\nThe dimensionless group multiplying the buoyancy term is the generalized Rayleigh number for a chosen temperature scale $\\Delta T_{scale}$.\n\nNow we nondimensionalize the energy equation. Starting with $\\rho c_p (\\dots) = k \\nabla^2 T + \\rho H$ and substituting the dimensionless variables, we get:\n$$ \\frac{\\rho c_p \\kappa \\Delta T_{scale}}{D^2} \\left( \\frac{\\partial \\theta}{\\partial t'} + (\\mathbf{u}' \\cdot \\nabla') \\theta \\right) = \\frac{k \\Delta T_{scale}}{D^2} \\nabla'^2 \\theta + \\rho H $$\nUsing $\\kappa = k/(\\rho c_p)$, the left-hand side factor becomes $k \\Delta T_{scale} / D^2$. Dividing the entire equation by this factor gives:\n$$ \\frac{\\partial \\theta}{\\partial t'} + (\\mathbf{u}' \\cdot \\nabla') \\theta = \\nabla'^2\\theta + \\frac{\\rho H D^2}{k \\Delta T_{scale}} $$\n\nThe problem requires deriving the two Rayleigh numbers by considering each heating mode separately.\n\nCase 1: Basal heating ($Ra$)\nFor convection driven by a prescribed basal temperature contrast $\\Delta T_b$, we set the internal heating $H=0$. The natural choice for the temperature scale is the imposed contrast itself: $\\Delta T_{scale} = \\Delta T_b$. Substituting this into the dimensionless coefficient of the buoyancy term gives the classical Rayleigh number, $Ra$:\n$$ Ra = \\frac{\\rho \\alpha g \\Delta T_b D^3}{\\eta_0 \\kappa} $$\n\nCase 2: Internal heating ($Ra_H$)\nFor convection driven solely by uniform internal heating $H$, there is no externally imposed temperature contrast. The temperature scale must be intrinsic to the system. From the dimensionless energy equation, the term $\\frac{\\rho H D^2}{k \\Delta T_{scale}}$ represents the dimensionless strength of the internal heating. For a proper scaling, this driving term should be of order unity. Therefore, we set it to $1$ to define the intrinsic temperature scale for internal heating, $\\Delta T_H$:\n$$ \\Delta T_H = \\frac{\\rho H D^2}{k} $$\nSubstituting this scale $\\Delta T_{scale} = \\Delta T_H$ into the generalized Rayleigh number expression yields the internally heated Rayleigh number, $Ra_H$:\n$$ Ra_H = \\frac{\\rho \\alpha g D^3}{\\eta_0 \\kappa} \\left( \\frac{\\rho H D^2}{k} \\right) = \\frac{\\rho^2 \\alpha g H D^5}{\\eta_0 \\kappa k} $$\n\nNow, we evaluate these two Rayleigh numbers using the provided Earth-like parameters:\n- $r_{\\mathrm{o}} = 6.371 \\times 10^{6}\\ \\mathrm{m}$\n- $r_{\\mathrm{i}} = 3.480 \\times 10^{6}\\ \\mathrm{m}$\n- $\\rho = 3300\\ \\mathrm{kg\\,m^{-3}}$\n- $\\alpha = 3.0 \\times 10^{-5}\\ \\mathrm{K^{-1}}$\n- $g = 9.81\\ \\mathrm{m\\,s^{-2}}$\n- $\\kappa = 1.0 \\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$\n- $k = 4.0\\ \\mathrm{W\\,m^{-1}\\,K^{-1}}$\n- $\\eta_{0} = 1.0 \\times 10^{21}\\ \\mathrm{Pa\\,s}$\n- $\\Delta T_{b} = 2500\\ \\mathrm{K}$\n- $H = 5.0 \\times 10^{-12}\\ \\mathrm{W\\,kg^{-1}}$\n\nFirst, calculate the shell thickness $D$:\n$$ D = r_o - r_i = (6.371 - 3.480) \\times 10^{6}\\ \\mathrm{m} = 2.891 \\times 10^{6}\\ \\mathrm{m} $$\n\nCalculation of $Ra$:\n$$ Ra = \\frac{\\rho \\alpha g \\Delta T_b D^3}{\\eta_0 \\kappa} $$\n$$ Ra = \\frac{(3300) \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (2500) \\cdot (2.891 \\times 10^{6})^{3}}{(1.0 \\times 10^{21}) \\cdot (1.0 \\times 10^{-6})} $$\n$$ Ra = \\frac{(2427.975) \\cdot (2.41654 \\times 10^{19})}{1.0 \\times 10^{15}} = \\frac{5.86718 \\times 10^{22}}{1.0 \\times 10^{15}} = 5.86718 \\times 10^{7} $$\nRounding to four significant figures, $Ra = 5.867 \\times 10^{7}$.\n\nCalculation of $Ra_H$:\n$$ Ra_H = \\frac{\\rho^2 \\alpha g H D^5}{\\eta_0 \\kappa k} $$\n$$ Ra_H = \\frac{(3300)^2 \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (5.0 \\times 10^{-12}) \\cdot (2.891 \\times 10^{6})^{5}}{(1.0 \\times 10^{21}) \\cdot (1.0 \\times 10^{-6}) \\cdot (4.0)} $$\n$$ Ra_H = \\frac{(1.089 \\times 10^{7}) \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (5.0 \\times 10^{-12}) \\cdot (2.01894 \\times 10^{32})}{4.0 \\times 10^{15}} $$\n$$ Ra_H = \\frac{(1.6033 \\times 10^{-8}) \\cdot (2.01894 \\times 10^{32})}{4.0 \\times 10^{15}} = \\frac{3.23588 \\times 10^{24}}{4.0 \\times 10^{15}} = 8.0897 \\times 10^{8} $$\nRounding to four significant figures, $Ra_H = 8.090 \\times 10^{8}$.\n\nThe evaluated Rayleigh numbers are $(Ra, Ra_H) = (5.867 \\times 10^7, 8.090 \\times 10^8)$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 5.867 \\times 10^{7} & 8.090 \\times 10^{8} \\end{pmatrix}}$$"
        },
        {
            "introduction": "Mantle convection is the engine driving plate tectonics, but what determines whether a planet develops mobile plates like Earth or a stagnant, single-plate lid? This outcome hinges on the competition between the driving stresses generated by mantle flow and the resisting strength of the planet's cold, stiff outer layer, the lithosphere. Through scaling analysis, this practice demonstrates how to estimate these competing forces and formulate a dimensionless parameter that helps predict a planet's tectonic regime .",
            "id": "3609252",
            "problem": "Consider whole-mantle convection in a three-dimensional spherical shell with inner radius fixed and outer radius corresponding to the planetary surface. Assume an incompressible, infinite Prandtl number, Boussinesq fluid with temperature-dependent viscosity. Let the reference density be $\\rho_{0}$, the coefficient of thermal expansivity be $\\alpha$, the gravitational acceleration be $g$, and the total superadiabatic temperature drop across the convecting shell be $\\Delta T$. The shell thickness is $d$. Viscosity varies strongly with temperature, but you may take the leading-order convective driving stress to be set by the depth-integrated buoyancy force. The lithosphere is assumed to yield by a frictional-plastic (Byerlee-type) criterion with depth-dependent yield stress $\\sigma_{y}(z)=C_{0}+f\\,\\rho_{\\ell}\\,g\\,z$, where $C_{0}$ is the cohesion, $f$ is an effective friction coefficient, $\\rho_{\\ell}$ is the lithospheric density, and $z$ is depth.\n\nStarting from the steady Stokes momentum balance in the Boussinesq approximation for an incompressible fluid, and using an order-of-magnitude scaling based on the depth-integrated buoyancy force, derive an estimate for the characteristic convective stress scale $\\sigma_{c}$ and then form the nondimensional mobility measure $\\Lambda=\\sigma_{c}/\\sigma_{y}$ evaluated at a characteristic brittle-plastic depth $z=z_{b}$. You may assume that the dominant geometric length scale entering the buoyancy integration is $d$ and that spherical curvature does not alter the leading-order scaling of the radial stress.\n\nUse the following Earth-like parameter values: $\\rho_{0}=3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $\\alpha=2.5\\times 10^{-5}\\,\\mathrm{K}^{-1}$, $\\Delta T=2500\\,\\mathrm{K}$, $g=9.8\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, $d=2.8\\times 10^{6}\\,\\mathrm{m}$, $C_{0}=2.0\\times 10^{7}\\,\\mathrm{Pa}$, $f=0.60$, $\\rho_{\\ell}=3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, and $z_{b}=5.0\\times 10^{4}\\,\\mathrm{m}$. Compute the numerical value of $\\Lambda$ as a pure number and round your final answer to three significant figures. Do not include units in your final answer.",
            "solution": "The problem is evaluated to be valid. It is scientifically grounded in the principles of continuum mechanics and geophysics, specifically mantle convection and lithospheric rheology. The problem is well-posed, providing all necessary parameters and a clear objective for a scaling analysis. The language is objective and the given data are physically consistent and realistic for an Earth-like planet.\n\nThe task is to derive an estimate for the characteristic convective stress scale, $\\sigma_{c}$, and use it to compute the nondimensional mobility measure $\\Lambda$, defined as the ratio of $\\sigma_{c}$ to the lithospheric yield stress $\\sigma_{y}$ at a characteristic depth $z_{b}$.\n\nWe begin with the momentum balance for an incompressible, infinite Prandtl number, Boussinesq fluid, which is the steady Stokes equation:\n$$ -\\nabla p + \\nabla \\cdot \\boldsymbol{\\tau} + \\mathbf{F}_{b} = \\mathbf{0} $$\nHere, $p$ is the dynamic pressure, $\\boldsymbol{\\tau}$ is the deviatoric stress tensor, and $\\mathbf{F}_{b}$ is the buoyancy force per unit volume. The buoyancy force arises from temperature-induced density variations and is given by:\n$$ \\mathbf{F}_{b} = \\delta \\rho \\, \\mathbf{g} $$\nIn the Boussinesq approximation, the density anomaly $\\delta \\rho$ is related to the temperature anomaly $\\delta T$ through the coefficient of thermal expansivity $\\alpha$: $\\delta \\rho = -\\rho_{0} \\alpha \\, \\delta T$, where $\\rho_{0}$ is the reference density. The magnitude of the buoyancy force per unit volume is $|\\mathbf{F}_{b}| = \\rho_{0} \\alpha g |\\delta T|$.\n\nThe problem states that the leading-order convective driving stress, $\\sigma_{c}$, is set by the depth-integrated buoyancy force. This quantity represents the total buoyancy force acting on a vertical column of fluid, per unit area, and thus has units of stress. We can estimate its scale by integrating the characteristic buoyancy force per unit volume over the thickness of the convecting shell, $d$. The characteristic temperature anomaly $|\\delta T|$ across the shell is the superadiabatic temperature drop, $\\Delta T$.\n$$ \\sigma_{c} \\sim \\int_{0}^{d} (\\rho_{0} \\alpha g \\Delta T) \\, dz $$\nSince the integrand is constant in this scaling argument, the integral evaluates to:\n$$ \\sigma_{c} = \\rho_{0} \\alpha g \\Delta T d $$\nThis expression represents the characteristic driving stress of mantle convection.\n\nNext, we evaluate the yield stress of the lithosphere, $\\sigma_{y}$. The problem provides a depth-dependent, frictional-plastic (Byerlee-type) criterion:\n$$ \\sigma_{y}(z) = C_{0} + f\\,\\rho_{\\ell}\\,g\\,z $$\nwhere $C_{0}$ is the cohesion, $f$ is the effective friction coefficient, $\\rho_{\\ell}$ is the lithospheric density, and $z$ is the depth. We need to evaluate this yield stress at the characteristic brittle-plastic depth, $z = z_{b}$.\n$$ \\sigma_{y}(z_{b}) = C_{0} + f\\,\\rho_{\\ell}\\,g\\,z_{b} $$\n\nThe nondimensional mobility measure, $\\Lambda$, is the ratio of the convective driving stress to the lithospheric resisting strength:\n$$ \\Lambda = \\frac{\\sigma_{c}}{\\sigma_{y}(z_{b})} = \\frac{\\rho_{0} \\alpha g \\Delta T d}{C_{0} + f\\,\\rho_{\\ell}\\,g\\,z_{b}} $$\n\nWe now substitute the given Earth-like parameter values:\n- $\\rho_{0} = 3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $\\alpha = 2.5 \\times 10^{-5}\\,\\mathrm{K}^{-1}$\n- $g = 9.8\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$\n- $\\Delta T = 2500\\,\\mathrm{K}$\n- $d = 2.8 \\times 10^{6}\\,\\mathrm{m}$\n- $C_{0} = 2.0 \\times 10^{7}\\,\\mathrm{Pa}$\n- $f = 0.60$\n- $\\rho_{\\ell} = 3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $z_{b} = 5.0 \\times 10^{4}\\,\\mathrm{m}$\n\nFirst, we compute the numerator, $\\sigma_{c}$:\n$$ \\sigma_{c} = (3300) \\times (2.5 \\times 10^{-5}) \\times (9.8) \\times (2500) \\times (2.8 \\times 10^{6}) \\, \\mathrm{Pa} $$\n$$ \\sigma_{c} = 5.6595 \\times 10^{9} \\, \\mathrm{Pa} $$\n\nNext, we compute the denominator, $\\sigma_{y}(z_{b})$:\n$$ \\sigma_{y}(z_{b}) = (2.0 \\times 10^{7}) + (0.60) \\times (3300) \\times (9.8) \\times (5.0 \\times 10^{4}) \\, \\mathrm{Pa} $$\nThe second term (frictional resistance) is:\n$$ f\\,\\rho_{\\ell}\\,g\\,z_{b} = 9.702 \\times 10^{8} \\, \\mathrm{Pa} $$\nSo, the total yield stress is:\n$$ \\sigma_{y}(z_{b}) = (2.0 \\times 10^{7}) + (9.702 \\times 10^{8}) \\, \\mathrm{Pa} = 9.902 \\times 10^{8} \\, \\mathrm{Pa} $$\n\nFinally, we compute the ratio $\\Lambda$:\n$$ \\Lambda = \\frac{5.6595 \\times 10^{9}}{9.902 \\times 10^{8}} = \\frac{56.595 \\times 10^{8}}{9.902 \\times 10^{8}} \\approx 5.7155 $$\n\nThe problem requires the answer to be rounded to three significant figures.\n$$ \\Lambda \\approx 5.72 $$\nThis value is a nondimensional measure comparing the force driving plate tectonics to the force resisting it within the brittle part of the lithosphere.",
            "answer": "$$\\boxed{5.72}$$"
        },
        {
            "introduction": "The complex equations governing mantle flow are solved with sophisticated numerical codes, but how can we trust that the code correctly implements the physics? The Method of Manufactured Solutions (MMS) is a powerful verification technique where an exact analytical solution is prescribed, allowing us to test if the code reproduces it to machine precision. This hands-on coding practice challenges you to implement an MMS benchmark for the incompressibility constraint, verifying a critical component of any Stokes flow solver and building confidence in your numerical tools .",
            "id": "3609253",
            "problem": "Consider a three-dimensional spherical shell domain with inner radius $r_{\\mathrm{i}}$ and outer radius $r_{\\mathrm{o}}$. The steady Stokes system for an incompressible fluid with spatially variable viscosity $\\eta(\\theta,\\phi)$ in spherical coordinates $(r,\\theta,\\phi)$ consists of the momentum balance and the incompressibility constraint, respectively,\n$$\n-\\nabla p + \\nabla\\cdot\\left(2\\,\\eta(\\theta,\\phi)\\,\\boldsymbol{\\varepsilon}(\\mathbf{u})\\right) + \\mathbf{f} = \\mathbf{0}, \\quad \\nabla\\cdot\\mathbf{u} = 0,\n$$\nwhere $p$ is pressure, $\\mathbf{u} = (u_r, u_\\theta, u_\\phi)$ is velocity, $\\mathbf{f}$ is a body force, and $\\boldsymbol{\\varepsilon}(\\mathbf{u})$ is the symmetric strain-rate tensor. In the method of manufactured solutions (MMS), one prescribes smooth fields $(\\mathbf{u},p,\\eta)$ and derives a corresponding body force $\\mathbf{f}$ so that $(\\mathbf{u},p,\\eta,\\mathbf{f})$ satisfy the above equations exactly. A robust manufactured solution for incompressible flow can be constructed by defining $\\mathbf{u}$ as the curl of a vector potential, which guarantees $\\nabla\\cdot\\mathbf{u}=0$ in a coordinate-invariant manner.\n\nYour task is to implement a benchmark program that verifies the incompressibility constraint to machine precision for a family of manufactured velocity fields on spherical shells with laterally varying viscosity. Specifically:\n\n1. Define the velocity field $\\mathbf{u}$ as the toroidal field generated by a scalar toroidal potential $T(r,\\theta,\\phi)$ via the vector potential $\\mathbf{A} = T(r,\\theta,\\phi)\\,\\hat{\\mathbf{e}}_r$ and $\\mathbf{u} = \\nabla\\times\\mathbf{A}$. In spherical components, this implies $u_r = 0$, $u_\\theta = \\frac{1}{r\\sin\\theta}\\,\\frac{\\partial T}{\\partial \\phi}$, and $u_\\phi = -\\frac{1}{r}\\,\\frac{\\partial T}{\\partial \\theta}$. Angles must be interpreted in radians.\n\n2. Compute the divergence $\\nabla\\cdot\\mathbf{u}$ using the spherical-coordinate formula\n$$\n\\nabla\\cdot\\mathbf{u} = \\frac{1}{r^2}\\frac{\\partial (r^2 u_r)}{\\partial r} + \\frac{1}{r\\sin\\theta}\\frac{\\partial}{\\partial\\theta}\\left(u_\\theta \\sin\\theta\\right) + \\frac{1}{r\\sin\\theta}\\frac{\\partial u_\\phi}{\\partial \\phi}.\n$$\nUse analytic expressions for all derivatives of $T$ with respect to $\\theta$ and $\\phi$ so that the discrete evaluation is limited only by round-off.\n\n3. For completeness of the manufactured benchmark, define a laterally varying viscosity $\\eta(\\theta,\\phi)$ that is strictly positive everywhere on the sphere for each test case, although the incompressibility verification depends only on $\\mathbf{u}$. All variables are to be treated as dimensionless for this task.\n\n4. For each test case below, discretize the spherical shell on a tensor-product grid: $r$ is uniformly sampled on $[r_{\\mathrm{i}}, r_{\\mathrm{o}}]$ with $N_r$ points; $\\theta$ is sampled on the open interval $(0,\\pi)$ with $N_\\theta$ points that exclude the endpoints to avoid coordinate singularities; and $\\phi$ is uniformly sampled on $[0,2\\pi)$ with $N_\\phi$ points and periodicity enforced by excluding the endpoint. Angles must be in radians. The program must compute the maximum absolute value of the divergence over all grid points,\n$$\n\\max_{r,\\theta,\\phi} \\left| \\nabla\\cdot\\mathbf{u}(r,\\theta,\\phi) \\right|,\n$$\nfor each test case.\n\n5. Test suite. Implement the following four test cases, each with specified spherical shell radii, grid sizes, toroidal potential $T(r,\\theta,\\phi)$, and variable viscosity $\\eta(\\theta,\\phi)$:\n- Case $1$: $r_{\\mathrm{i}} = 1.0$, $r_{\\mathrm{o}} = 2.0$, $N_r = 16$, $N_\\theta = 17$, $N_\\phi = 18$,\n  $$\n  T(r,\\theta,\\phi) = r^2 \\sin\\theta \\cos\\phi,\n  $$\n  $$\n  \\eta(\\theta,\\phi) = 1 + 0.5\\cos\\theta\\cos\\phi + 0.3\\sin\\theta\\sin(2\\phi).\n  $$\n- Case $2$: $r_{\\mathrm{i}} = 0.7$, $r_{\\mathrm{o}} = 1.3$, $N_r = 12$, $N_\\theta = 19$, $N_\\phi = 20$,\n  $$\n  T(r,\\theta,\\phi) = r^3 \\sin(2\\theta)\\cos(3\\phi),\n  $$\n  $$\n  \\eta(\\theta,\\phi) = 1 + 0.99\\,\\sin\\theta\\cos\\phi.\n  $$\n- Case $3$: $r_{\\mathrm{i}} = 1.0$, $r_{\\mathrm{o}} = 1.5$, $N_r = 10$, $N_\\theta = 25$, $N_\\phi = 16$,\n  $$\n  T(r,\\theta,\\phi) = r \\sin\\theta,\n  $$\n  $$\n  \\eta(\\theta,\\phi) = 1 + 0.8\\cos(2\\theta).\n  $$\n- Case $4$: $r_{\\mathrm{i}} = 0.5$, $r_{\\mathrm{o}} = 1.5$, $N_r = 14$, $N_\\theta = 23$, $N_\\phi = 21$,\n  $$\n  T(r,\\theta,\\phi) = r^{2.5}\\left[\\sin(3\\theta) + 0.5\\,\\sin\\theta\\cos(2\\phi)\\right],\n  $$\n  $$\n  \\eta(\\theta,\\phi) = 1 + 0.6\\cos\\theta + 0.2\\cos(4\\phi)\\sin^2\\theta.\n  $$\n\n6. Output specification. Your program must produce a single line of output containing the maximum absolute divergence values for the four cases in the order listed, formatted as a comma-separated list enclosed in square brackets. Each floating value must be expressed in scientific notation with exactly $6$ significant digits. For example, the output format must be like $[a_1,a_2,a_3,a_4]$ where each $a_i$ is a float string such as $1.234560\\text{e-}15$.\n\nAngles must be in radians and there are no physical units to report. The final outputs must be floating-point numbers as defined and formatted above.",
            "solution": "The goal of this exercise is to numerically verify the incompressibility condition, $\\nabla\\cdot\\mathbf{u}=0$, for a specific family of manufactured velocity fields. The velocity field $\\mathbf{u}$ is constructed as a purely toroidal field derived from a scalar potential $T(r,\\theta,\\phi)$. This is achieved by defining $\\mathbf{u}$ as the curl of a vector potential $\\mathbf{A} = T\\hat{\\mathbf{e}}_r$. A fundamental theorem of vector calculus, the divergence of a curl is always zero ($\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$), guarantees that any velocity field constructed in this manner is analytically divergence-free. The task is to show that this analytical truth holds when evaluated numerically using the provided formulas.\n\nWe start with the spherical coordinate components of the velocity field given in the problem statement:\n$$\nu_r = 0, \\quad u_\\theta = \\frac{1}{r\\sin\\theta}\\,\\frac{\\partial T}{\\partial \\phi}, \\quad u_\\phi = -\\frac{1}{r}\\,\\frac{\\partial T}{\\partial \\theta}.\n$$\nNext, we substitute these components into the formula for the divergence of a vector field in spherical coordinates:\n$$\n\\nabla\\cdot\\mathbf{u} = \\frac{1}{r^2}\\frac{\\partial (r^2 u_r)}{\\partial r} + \\frac{1}{r\\sin\\theta}\\frac{\\partial}{\\partial\\theta}\\left(u_\\theta \\sin\\theta\\right) + \\frac{1}{r\\sin\\theta}\\frac{\\partial u_\\phi}{\\partial \\phi}.\n$$\nLet's evaluate each term:\n1.  Since $u_r = 0$, the first term, $\\frac{1}{r^2}\\frac{\\partial (r^2 u_r)}{\\partial r}$, is identically zero.\n2.  For the second term, we substitute the expression for $u_\\theta$:\n    $$\n    \\frac{1}{r\\sin\\theta}\\frac{\\partial}{\\partial\\theta}\\left(\\left(\\frac{1}{r\\sin\\theta}\\,\\frac{\\partial T}{\\partial \\phi}\\right) \\sin\\theta\\right) = \\frac{1}{r\\sin\\theta}\\frac{\\partial}{\\partial\\theta}\\left(\\frac{1}{r}\\,\\frac{\\partial T}{\\partial \\phi}\\right) = \\frac{1}{r^2\\sin\\theta}\\frac{\\partial^2 T}{\\partial\\theta\\partial\\phi}.\n    $$\n3.  For the third term, we substitute the expression for $u_\\phi$:\n    $$\n    \\frac{1}{r\\sin\\theta}\\frac{\\partial}{\\partial \\phi}\\left(-\\frac{1}{r}\\,\\frac{\\partial T}{\\partial \\theta}\\right) = -\\frac{1}{r^2\\sin\\theta}\\frac{\\partial^2 T}{\\partial\\phi\\partial\\theta}.\n    $$\n\nCombining these terms gives the full analytical expression for the divergence:\n$$\n\\nabla\\cdot\\mathbf{u} = \\frac{1}{r^2\\sin\\theta}\\frac{\\partial^2 T}{\\partial\\theta\\partial\\phi} - \\frac{1}{r^2\\sin\\theta}\\frac{\\partial^2 T}{\\partial\\phi\\partial\\theta} = \\frac{1}{r^2\\sin\\theta}\\left( \\frac{\\partial^2 T}{\\partial\\theta\\partial\\phi} - \\frac{\\partial^2 T}{\\partial\\phi\\partial\\theta} \\right).\n$$\nThe scalar potentials $T(r,\\theta,\\phi)$ given in all test cases are smooth, infinitely differentiable functions. According to Clairaut's theorem on the equality of mixed partial derivatives, for any such function, the order of differentiation does not matter:\n$$\n\\frac{\\partial^2 T}{\\partial\\theta\\partial\\phi} = \\frac{\\partial^2 T}{\\partial\\phi\\partial\\theta}.\n$$\nTherefore, the term in parentheses is analytically zero. This means that $\\nabla\\cdot\\mathbf{u}$ is identically zero at every point in the domain where it is defined (i.e., for $r>0$ and $\\sin\\theta \\neq 0$).\n\nWhen implementing this verification numerically, the key is to use the *analytical* expressions for the mixed partial derivatives, as specified in the problem. Since the analytical expressions for $\\frac{\\partial^2 T}{\\partial\\theta\\partial\\phi}$ and $\\frac{\\partial^2 T}{\\partial\\phi\\partial\\theta}$ are identical, a computer program evaluating them will produce bit-for-bit identical floating-point numbers. The subtraction of these two identical numbers will result in exactly $0.0$, not a small number on the order of machine precision due to round-off error. Consequently, the maximum absolute value of the divergence computed over the entire grid must be exactly zero. The provided code in the answer implements this logic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum absolute divergence of manufactured velocity fields\n    on a spherical shell grid for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'ri': 1.0, 'ro': 2.0, 'Nr': 16, 'Ntheta': 17, 'Nphi': 18, 'case_id': 1},\n        {'ri': 0.7, 'ro': 1.3, 'Nr': 12, 'Ntheta': 19, 'Nphi': 20, 'case_id': 2},\n        {'ri': 1.0, 'ro': 1.5, 'Nr': 10, 'Ntheta': 25, 'Nphi': 16, 'case_id': 3},\n        {'ri': 0.5, 'ro': 1.5, 'Nr': 14, 'Ntheta': 23, 'Nphi': 21, 'case_id': 4},\n    ]\n\n    results = []\n    for case in test_cases:\n        ri, ro = case['ri'], case['ro']\n        Nr, Ntheta, Nphi = case['Nr'], case['Ntheta'], case['Nphi']\n\n        # Discretize the domain according to the problem specification.\n        r = np.linspace(ri, ro, Nr)\n        \n        # Sample theta on the open interval (0, pi) to avoid singularities at the poles.\n        theta = np.linspace(0, np.pi, Ntheta + 2)[1:-1]\n        \n        # Sample phi on the periodic interval [0, 2*pi).\n        phi = np.linspace(0, 2 * np.pi, Nphi, endpoint=False)\n        \n        # Create a meshgrid for vectorized computation. Indexing 'ij' ensures that\n        # the shape of the grid arrays corresponds to (Nr, Ntheta, Nphi).\n        R, THETA, PHI = np.meshgrid(r, theta, phi, indexing='ij')\n\n        # Analytically, the divergence is (d2T_dthdph - d2T_dphdth) / (r^2 * sin(theta)).\n        # We compute the symbolic mixed partial derivatives for each case.\n        \n        d2T_dthdph = 0.0\n        d2T_dphdth = 0.0\n\n        if case['case_id'] == 1:\n            # T = r^2 * sin(theta) * cos(phi)\n            # d/dth (d/dphi T) = -r^2 * cos(theta) * sin(phi)\n            # d/dphi (d/dth T) = -r^2 * cos(theta) * sin(phi)\n            expr = -R**2 * np.cos(THETA) * np.sin(PHI)\n            d2T_dthdph = expr\n            d2T_dphdth = expr\n\n        elif case['case_id'] == 2:\n            # T = r^3 * sin(2*theta) * cos(3*phi)\n            # d/dth (d/dphi T) = -6*r^3 * cos(2*theta) * sin(3*phi)\n            # d/dphi (d/dth T) = -6*r^3 * cos(2*theta) * sin(3*phi)\n            expr = -6 * R**3 * np.cos(2*THETA) * np.sin(3*PHI)\n            d2T_dthdph = expr\n            d2T_dphdth = expr\n        \n        elif case['case_id'] == 3:\n            # T = r * sin(theta) is independent of phi.\n            # Mixed partial derivatives are zero.\n            zeros = np.zeros_like(R)\n            d2T_dthdph = zeros\n            d2T_dphdth = zeros\n\n        elif case['case_id'] == 4:\n            # T = r^2.5 * (sin(3*theta) + 0.5*sin(theta)*cos(2*phi))\n            # d/dth (d/dphi T) = -r^2.5 * cos(theta) * sin(2*phi)\n            # d/dphi (d/dth T) = -r^2.5 * cos(theta) * sin(2*phi)\n            expr = -R**2.5 * np.cos(THETA) * np.sin(2*PHI)\n            d2T_dthdph = expr\n            d2T_dphdth = expr\n\n        # The numerator is the difference of two numerically identical arrays,\n        # which results in an array of exact floating-point zeros.\n        numerator = d2T_dthdph - d2T_dphdth\n        \n        # The denominator is non-zero because r_i > 0 and theta is in (0, pi).\n        denominator = R**2 * np.sin(THETA)\n        \n        # The divergence is identically zero at all grid points.\n        divergence_field = numerator / denominator\n        \n        max_abs_divergence = np.max(np.abs(divergence_field))\n        \n        # Format the result to scientific notation with 6 significant digits.\n        results.append(\"{:.6e}\".format(max_abs_divergence))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}