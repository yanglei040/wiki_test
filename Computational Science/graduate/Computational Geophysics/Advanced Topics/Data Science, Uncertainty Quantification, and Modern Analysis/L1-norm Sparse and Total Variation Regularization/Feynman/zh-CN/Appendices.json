{
    "hands_on_practices": [
        {
            "introduction": "为了有效地使用全变分（TV）正则化，我们必须首先对其度量的内容建立扎实的直观理解。本练习提供了一个具体的纸笔实践机会，让您为一个简单的模型计算各向异性与各向同性TV罚项。通过计算，您将揭示它们各自独特的几何偏好，并理解为何各向同性TV能更好地保留自然边缘，而各向异性TV则可能引入“阶梯状”伪影。",
            "id": "3606224",
            "problem": "考虑一个计算地球物理学中的简单二维（2D）幻影模型，它表示均匀笛卡尔网格上的分段常数地下属性。设属性场定义在一个 $4 \\times 4$ 的网格上，其单位间距为 $h_x = h_y = 1$，条目如下\n$$\nu = \\begin{pmatrix}\n0  & 0 & 0 & 1 \\\\\n0  & 0 & 1 & 1 \\\\\n0  & 1 & 1 & 1 \\\\\n1  & 1 & 1 & 1\n\\end{pmatrix}.\n$$\n在用于反问题的变分正则化中，全变分（TV）惩罚项促进模型空间梯度的稀疏性。从标量场 $u(x,y)$ 的连续全变分泛函出发，\n$$\n\\text{TV}(u) = \\int_{\\Omega} \\|\\nabla u(x,y)\\| \\,\\mathrm{d}x\\,\\mathrm{d}y,\n$$\n其中 $\\nabla u = (u_x, u_y)$ 且 $\\|\\cdot\\|$ 表示一个向量范数，请使用单位间距的一阶前向有限差分，在给定网格上为 $\\|\\cdot\\|$ 的各向异性和各向同性选择构建离散TV惩罚项。具体来说，在每个内部像素 $(i,j)$（其中 $i=1,2,3$ 且 $j=1,2,3$）处，使用向右和向下的前向差分：\n$$\nD_x u(i,j) = u(i,j+1) - u(i,j), \\qquad D_y u(i,j) = u(i+1,j) - u(i,j).\n$$\n通过取每个内部像素处离散梯度的可分离一范数并在整个网格上求和来定义各向异性TV，并通过取每个内部像素处离散梯度的欧几里得范数并在整个网格上求和来定义各向同性TV。对给定的 $u$ 精确计算这两个离散TV值。然后，基于底层范数的几何形状以及幻影中边缘的方向，简要解释这两种惩罚项在处理边缘方向及其在分段常数场重建中趋向于块状化的倾向方面有何不同。\n\n以精确表达式的形式报告各向异性和各向同性TV惩罚项的数值对。无需四舍五入。将您的最终答案表示为行矩阵，格式为 $\\begin{pmatrix}\\text{anisotropic}  \\text{isotropic}\\end{pmatrix}$。",
            "solution": "该问题要求为一个给定的二维幻影模型 $u$ 计算两种类型的离散全变分（TV）惩罚项，即各向异性和各向同性惩罚项。此外，还要求解释这些惩罚项的不同属性。\n\n给定的属性场 $u$ 是一个 $4 \\times 4$ 的矩阵，其条目为 $u_{i,j}$：\n$$\nu = \\begin{pmatrix}\nu_{1,1}  & u_{1,2} & u_{1,3} & u_{1,4} \\\\\nu_{2,1}  & u_{2,2} & u_{2,3} & u_{2,4} \\\\\nu_{3,1}  & u_{3,2} & u_{3,3} & u_{3,4} \\\\\nu_{4,1}  & u_{4,2} & u_{4,3} & u_{4,4}\n\\end{pmatrix} = \\begin{pmatrix}\n0  & 0 & 0 & 1 \\\\\n0  & 0 & 1 & 1 \\\\\n0  & 1 & 1 & 1 \\\\\n1  & 1 & 1 & 1\n\\end{pmatrix}\n$$\n问题指定使用单位间距（$h_x=h_y=1$）的一阶前向有限差分来近似梯度。离散梯度分量在每个内部像素 $(i,j)$（其中 $i,j \\in \\{1, 2, 3\\}$）处定义如下：\n$$\n(D_x u)_{i,j} = u_{i,j+1} - u_{i,j}\n$$\n$$\n(D_y u)_{i,j} = u_{i+1,j} - u_{i,j}\n$$\n因此，像素 $(i,j)$ 处的离散梯度向量为 $\\nabla_d u_{i,j} = \\left( (D_x u)_{i,j}, (D_y u)_{i,j} \\right)$。\n\n首先，我们计算内部点的 $3 \\times 3$ 网格上的梯度分量矩阵。\n\n对于水平分量 $(D_x u)_{i,j}$：\n对于 $i=1$：$(D_x u)_{1,1}=0-0=0$，$(D_x u)_{1,2}=0-0=0$，$(D_x u)_{1,3}=1-0=1$。\n对于 $i=2$：$(D_x u)_{2,1}=0-0=0$，$(D_x u)_{2,2}=1-0=1$，$(D_x u)_{2,3}=1-1=0$。\n对于 $i=3$：$(D_x u)_{3,1}=1-0=1$，$(D_x u)_{3,2}=1-1=0$，$(D_x u)_{3,3}=1-1=0$。\n这给出了水平差分矩阵，我们将其表示为 $G_x$：\n$$\nG_x = \\begin{pmatrix} 0 & 0 & 1 \\\\ 0 & 1 & 0 \\\\ 1 & 0 & 0 \\end{pmatrix}\n$$\n\n对于垂直分量 $(D_y u)_{i,j}$：\n对于 $j=1$：$(D_y u)_{1,1}=0-0=0$，$(D_y u)_{2,1}=0-0=0$，$(D_y u)_{3,1}=1-0=1$。\n对于 $j=2$：$(D_y u)_{1,2}=0-0=0$，$(D_y u)_{2,2}=1-0=1$，$(D_y u)_{3,2}=1-1=0$。\n对于 $j=3$：$(D_y u)_{1,3}=1-0=1$，$(D_y u)_{2,3}=1-1=0$，$(D_y u)_{3,3}=1-1=0$。\n这给出了垂直差分矩阵，我们将其表示为 $G_y$：\n$$\nG_y = \\begin{pmatrix} 0 & 0 & 1 \\\\ 0 & 1 & 0 \\\\ 1 & 0 & 0 \\end{pmatrix}\n$$\n矩阵 $G_x$ 和 $G_y$ 是相同的。非零梯度分量出现在像素 $(1,3)$、$(2,2)$ 和 $(3,1)$ 处。在这些位置，离散梯度向量为：\n$$\n\\nabla_d u_{1,3} = (1, 1)\n$$\n$$\n\\nabla_d u_{2,2} = (1, 1)\n$$\n$$\n\\nabla_d u_{3,1} = (1, 1)\n$$\n在所有其他内部像素 $(i,j)$ 处，梯度向量为 $\\nabla_d u_{i,j} = (0, 0)$。\n\n各向异性TV惩罚项定义为每个内部像素处离散梯度向量的 $l_1$-范数之和：\n$$\n\\text{TV}_{\\text{aniso}}(u) = \\sum_{i=1}^3 \\sum_{j=1}^3 \\| \\nabla_d u_{i,j} \\|_1 = \\sum_{i=1}^3 \\sum_{j=1}^3 \\left( |(D_x u)_{i,j}| + |(D_y u)_{i,j}| \\right)\n$$\n我们只需要对非零梯度求范数和：\n$$\n\\| \\nabla_d u_{1,3} \\|_1 = |1| + |1| = 2\n$$\n$$\n\\| \\nabla_d u_{2,2} \\|_1 = |1| + |1| = 2\n$$\n$$\n\\| \\nabla_d u_{3,1} \\|_1 = |1| + |1| = 2\n$$\n将这些贡献相加得到总的各向异性TV：\n$$\n\\text{TV}_{\\text{aniso}}(u) = 2 + 2 + 2 = 6\n$$\n\n各向同性TV惩罚项定义为每个内部像素处离散梯度向量的 $l_2$-范数（欧几里得范数）之和：\n$$\n\\text{TV}_{\\text{iso}}(u) = \\sum_{i=1}^3 \\sum_{j=1}^3 \\| \\nabla_d u_{i,j} \\|_2 = \\sum_{i=1}^3 \\sum_{j=1}^3 \\sqrt{((D_x u)_{i,j})^2 + ((D_y u)_{i,j})^2}\n$$\n同样，我们对非零梯度求范数和：\n$$\n\\| \\nabla_d u_{1,3} \\|_2 = \\sqrt{1^2 + 1^2} = \\sqrt{2}\n$$\n$$\n\\| \\nabla_d u_{2,2} \\|_2 = \\sqrt{1^2 + 1^2} = \\sqrt{2}\n$$\n$$\n\\| \\nabla_d u_{3,1} \\|_2 = \\sqrt{1^2 + 1^2} = \\sqrt{2}\n$$\n将这些贡献相加得到总的各向同性TV：\n$$\n\\text{TV}_{\\text{iso}}(u) = \\sqrt{2} + \\sqrt{2} + \\sqrt{2} = 3\\sqrt{2}\n$$\n\n两种惩罚项之间的差异源于用于度量离散梯度大小的 $l_1$ 和 $l_2$ 范数的几何特性。\n$l_2$ 范数 $\\|(g_x, g_y)\\|_2 = \\sqrt{g_x^2 + g_y^2}$ 是旋转不变的。这意味着它对具有相同大小的梯度向量赋予相同的惩罚，而不管其方向如何。因此它被称为“各向同性”的。\n$l_1$ 范数 $\\|(g_x, g_y)\\|_1 = |g_x| + |g_y|$ 不是旋转不变的。考虑一个固定欧几里得长度（例如 $M$）的梯度向量。如果梯度是轴对齐的，例如 $(M, 0)$，其 $l_1$ 范数为 $|M|+|0|=M$。如果梯度是对角线的，例如 $(M/\\sqrt{2}, M/\\sqrt{2})$，其 $l_1$ 范数为 $|M/\\sqrt{2}|+|M/\\sqrt{2}|=\\sqrt{2}M$。对角线梯度的惩罚是相同欧几里得大小的轴对齐梯度的 $\\sqrt{2}$ 倍。这种对轴对齐梯度的偏好是该惩罚项被称为“各向异性”的原因。\n\n在图像重建或地球物理反演的背景下，TV正则化会促进分段常数（“块状”）的解。基于 $l_1$ 的TV惩罚项的各向异性使重建偏向于那些块边界与网格轴对齐的解。这通常表现为“阶梯效应”伪影，其中对角线或弯曲边缘被一系列水平和垂直的台阶所近似。各向同性TV不表现出这种偏好，通常在保留与坐标轴不对齐的边缘的自然几何形状方面做得更好。\n\n在给定的幻影 $u$ 中，0和1区域之间的边界是一个阶梯状，在离散层面上由对角线步进组成。这反映在我们的计算中，即所有非零梯度向量的形式均为 $(1,1)$。对于这些对角线梯度，各向异性惩罚是 $|1|+|1| = 2$，而各向同性惩罚是 $\\sqrt{1^2+1^2} = \\sqrt{2}$。惩罚的比率为 $2/\\sqrt{2} = \\sqrt{2}$，这是可能的最大值。计算出的总值 $\\text{TV}_{\\text{aniso}} = 6$ 和 $\\text{TV}_{\\text{iso}} = 3\\sqrt{2}$ 反映了这一点，它们的比率也是 $\\frac{6}{3\\sqrt{2}} = \\sqrt{2}$。这个计算例证了各向异性TV如何比各向同性TV更重地惩罚对角线特征。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 6 & 3\\sqrt{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "高效求解TV正则化问题是计算地球物理学中的一项核心任务。本实践将指导您为一个二维TV去噪问题，实现一轮交替方向乘子法（ADMM）的迭代，这是一种功能强大且用途广泛的算法。通过利用快速傅里叶变换（FFT）来求解主要的子问题，您将获得处理先进计算技术的动手经验。",
            "id": "3606233",
            "problem": "考虑一个二维去噪问题，该问题旨在通过最小化一个数据保真项和一个各向异性全变分正则化项的和，来寻找一个场 $x \\in \\mathbb{R}^{n_y \\times n_x}$ 以近似一个含噪图像 $f \\in \\mathbb{R}^{n_y \\times n_x}$。目标是凸函数\n$$\n\\min_{x} \\; \\frac{1}{2}\\|x - f\\|_2^2 + \\lambda \\left( \\|D_x x\\|_1 + \\|D_y x\\|_1 \\right),\n$$\n其中 $D_x$ 和 $D_y$ 是具有周期性边界条件的前向差分算子，定义为\n$$\n(D_x x)_{i,j} = x_{i,j+1} - x_{i,j}, \\quad (D_y x)_{i,j} = x_{i+1,j} - x_{i,j},\n$$\n索引分别对 $n_x$ 和 $n_y$ 取模。各向异性全变分惩罚项是 $\\|D_x x\\|_1 + \\|D_y x\\|_1$，其中 $\\|\\cdot\\|_1$ 表示逐元素的 $L^1$-范数。\n\n引入分裂变量 $z = (z_x, z_y)$ 并施加约束 $z = \\nabla x$，其中 $\\nabla x = (D_x x, D_y x)$，并考虑使用带比例缩放对偶变量 $u = (u_x, u_y)$ 的比例缩放交替方向乘子法（ADMM）。使用惩罚参数 $\\rho > 0$ 的一次比例缩放ADMM迭代如下：\n1. $x$-更新：\n$$\nx^{k+1} = \\arg\\min_x \\; \\frac{1}{2}\\|x - f\\|_2^2 + \\frac{\\rho}{2}\\left\\| \\nabla x - z^k + u^k \\right\\|_2^2.\n$$\n2. $z$-更新（针对各向异性全变分的逐分量软阈值操作）：\n$$\nz^{k+1} = \\operatorname{shrink}\\!\\left(\\nabla x^{k+1} + u^k, \\frac{\\lambda}{\\rho}\\right),\n$$\n逐元素应用于每个分量，其中对于任意标量 $y$，$\\operatorname{shrink}(y,\\tau) = \\mathrm{sign}(y)\\max(|y|-\\tau,0)$。\n3. $u$-更新：\n$$\nu^{k+1} = u^k + \\nabla x^{k+1} - z^{k+1}.\n$$\n\n$x$-更新是一个二次最小化问题，其正规方程为\n$$\n\\left(I + \\rho \\nabla^\\top \\nabla\\right)x = f + \\rho \\nabla^\\top \\left(z^k - u^k\\right),\n$$\n其中 $\\nabla^\\top$ 是在周期性边界内积下的 $\\nabla$ 的伴随算子，明确由下式给出\n$$\n\\nabla^\\top(w_x,w_y) = B_x w_x + B_y w_y,\n$$\n其中 $B_x w = \\mathrm{roll}(w,\\text{axis}=x,\\text{shift}=+1) - w$ 且 $B_y w = \\mathrm{roll}(w,\\text{axis}=y,\\text{shift}=+1) - w$。在周期性边界条件下，算子 $\\nabla^\\top \\nabla$ 可被二维离散傅里叶变换（DFT）对角化。其符号为\n$$\n\\Lambda(\\omega_x,\\omega_y) = \\left(2 - 2\\cos \\omega_x\\right) + \\left(2 - 2\\cos \\omega_y\\right),\n$$\n其中 $\\omega_x = \\frac{2\\pi k_x}{n_x}$ 且 $\\omega_y = \\frac{2\\pi k_y}{n_y}$，$k_x \\in \\{0,1,\\dots,n_x-1\\}$，$k_y \\in \\{0,1,\\dots,n_y-1\\}$。因此，$x$-更新可以在傅里叶域中计算为\n$$\n\\widehat{x} = \\frac{\\widehat{f + \\rho \\nabla^\\top (z^k - u^k)}}{1 + \\rho \\Lambda(\\omega_x,\\omega_y)},\n$$\n然后通过逆DFT得到 $x^{k+1}$。\n\n请使用上述定义，实现一次用于各向异性二维全变分去噪的比例缩放ADMM迭代，初始条件为 $x^0 = f$，$z^0 = 0$ 和 $u^0 = 0$。对 $\\nabla$ 使用带周期性边界条件的前向差分，对 $\\nabla^\\top$ 使用其伴随差分。\n\n对于下方的每个测试用例，在一次ADMM迭代后计算以下单个标量值：\n$$\nJ(x^{1}) = \\frac{1}{2}\\|x^{1} - f\\|_2^2 + \\lambda \\left( \\|D_x x^{1}\\|_1 + \\|D_y x^{1}\\|_1 \\right).\n$$\n\n您的程序必须实现此计算，并生成保留六位小数的最终值。\n\n测试套件：\n- 用例 1 (正常路径): $n_y = 4$, $n_x = 4$, \n$$\nf^{(1)} = \\begin{bmatrix}\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1\n\\end{bmatrix},\n\\quad \\lambda^{(1)} = 0.3, \\quad \\rho^{(1)} = 1.0.\n$$\n- 用例 2 (边界情况 $\\lambda \\to 0$): $n_y = 4$, $n_x = 4$,\n$$\nf^{(2)} = \\begin{bmatrix}\n1 & 0 & 1 & 0 \\\\\n0 & 1 & 0 & 1 \\\\\n1 & 0 & 1 & 0 \\\\\n0 & 1 & 0 & 1\n\\end{bmatrix},\n\\quad \\lambda^{(2)} = 10^{-8}, \\quad \\rho^{(2)} = 1.0.\n$$\n- 用例 3 (边缘情况 大$\\lambda$): $n_y = 4$, $n_x = 4$,\n$$\nf^{(3)} = \\begin{bmatrix}\n0 & 0 & 0 & 0 \\\\\n0 & 3 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0\n\\end{bmatrix},\n\\quad \\lambda^{(3)} = 2.0, \\quad \\rho^{(3)} = 1.0.\n$$\n- 用例 4 (边缘情况 小$\\rho$): $n_y = 4$, $n_x = 4$,\n$$\nf^{(4)} = \\begin{bmatrix}\n0   & 0.5 & 1.0 & 1.5 \\\\\n0   & 0.5 & 1.0 & 1.5 \\\\\n0   & 0.5 & 1.0 & 1.5 \\\\\n0   & 0.5 & 1.0 & 1.5\n\\end{bmatrix},\n\\quad \\lambda^{(4)} = 0.5, \\quad \\rho^{(4)} = 10^{-6}.\n$$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应于用例1到4的 $J(x^{1})$ 值，保留六位小数，例如 $[0.123456,0.234567,0.345678,0.456789]$。",
            "solution": "该问题要求实现一次用于各向异性全变分（TV）去噪的比例缩放交替方向乘子法（ADMM）迭代，并随后评估目标函数。我们将遵循规定的步骤进行第一次迭代（索引为 $k=0$）。\n\n给定的目标函数为：\n$$\nJ(x) = \\frac{1}{2}\\|x - f\\|_2^2 + \\lambda \\left( \\|D_x x\\|_1 + \\|D_y x\\|_1 \\right)\n$$\n\nADMM算法通过引入分裂变量来分解此问题。第一次迭代从初始条件 $x^0 = f$，$z^0 = 0$ 和 $u^0 = 0$ 开始，过程如下。\n\n**1. $x$-更新（计算 $x^1$）**\n\n第一步是求解 $x^1$：\n$$\nx^1 = \\arg\\min_x \\; \\frac{1}{2}\\|x - f\\|_2^2 + \\frac{\\rho}{2}\\left\\| \\nabla x - z^0 + u^0 \\right\\|_2^2\n$$\n代入初始条件 $z^0=0$ 和 $u^0=0$，子问题简化为：\n$$\nx^1 = \\arg\\min_x \\; \\frac{1}{2}\\|x - f\\|_2^2 + \\frac{\\rho}{2}\\left\\| \\nabla x \\right\\|_2^2\n$$\n这是一个二次最小化问题。通过将关于 $x$ 的梯度设为零找到解，这会产生正规方程：\n$$\n(x - f) + \\rho \\nabla^\\top \\nabla x = 0 \\implies (I + \\rho \\nabla^\\top \\nabla) x = f\n$$\n这个线性系统可以在傅里叶域中高效求解。算子 $\\nabla^\\top \\nabla$ 是具有周期性边界条件的离散拉普拉斯算子，它是一个卷积算子。二维离散傅里叶变换（DFT），记为 $\\mathcal{F}$，可将卷积算子对角化。对正规方程应用DFT，我们得到：\n$$\n\\mathcal{F}\\left((I + \\rho \\nabla^\\top \\nabla) x^1\\right) = \\mathcal{F}(f) \\implies (1 + \\rho \\Lambda) \\widehat{x^1} = \\widehat{f}\n$$\n其中 $\\widehat{x^1} = \\mathcal{F}(x^1)$，$\\widehat{f} = \\mathcal{F}(f)$，而 $\\Lambda$ 是 $\\nabla^\\top\\nabla$ 算子的符号（傅里叶乘子）。如题目所给，该符号为：\n$$\n\\Lambda(\\omega_x, \\omega_y) = (2 - 2\\cos \\omega_x) + (2 - 2\\cos \\omega_y)\n$$\n角频率为 $\\omega_x = \\frac{2\\pi k_x}{n_x}$ 和 $\\omega_y = \\frac{2\\pi k_y}{n_y}$，其中 $k_x \\in \\{0, \\dots, n_x-1\\}$ 和 $k_y \\in \\{0, \\dots, n_y-1\\}$。\n\n我们可以通过在傅里叶域中进行逐元素除法来求解 $\\widehat{x^1}$：\n$$\n\\widehat{x^1} = \\frac{\\widehat{f}}{1 + \\rho \\Lambda}\n$$\n最后，通过应用逆DFT恢复 $x^1$：\n$$\nx^1 = \\mathcal{F}^{-1}\\left( \\widehat{x^1} \\right)\n$$\n由于输入 $f$ 是实数，$x^1$ 也必须是实数，因此我们取逆DFT结果的实部，以舍弃由浮点不精确性产生的微小虚部。\n\n**2. $z$-更新和 $u$-更新（计算 $z^1$ 和 $u^1$）**\n\n虽然评估 $J(x^1)$ 不需要 $z^1$ 和 $u^1$，但它们的计算是完整ADMM迭代的一部分。\n$z$-更新由下式给出：\n$$\nz^1 = \\operatorname{shrink}\\!\\left(\\nabla x^1 + u^0, \\frac{\\lambda}{\\rho}\\right) = \\operatorname{shrink}\\!\\left(\\nabla x^1, \\frac{\\lambda}{\\rho}\\right)\n$$\n这将逐分量地应用于 $z_x^1$ 和 $z_y^1$。首先，我们计算 $x^1$ 的离散梯度：\n$$\nD_x x^1: (D_x x^1)_{i,j} = x^1_{i,j+1} - x^1_{i,j}\n$$\n$$\nD_y x^1: (D_y x^1)_{i,j} = x^1_{i+1,j} - x^1_{i,j}\n$$\n然后，我们应用软阈值算子，阈值为 $\\tau = \\lambda/\\rho$：\n$$\nz_x^1 = \\operatorname{shrink}(D_x x^1, \\tau) \\quad \\text{和} \\quad z_y^1 = \\operatorname{shrink}(D_y x^1, \\tau)\n$$\n\n$u$-更新为：\n$$\nu^1 = u^0 + \\nabla x^1 - z^1 = \\nabla x^1 - z^1\n$$\n按分量来看，即 $u_x^1 = D_x x^1 - z_x^1$ 和 $u_y^1 = D_y x^1 - z_y^1$。\n\n**3. 评估目标函数 $J(x^1)$**\n\n计算出 $x^1$ 后，我们评估目标函数：\n$$\nJ(x^1) = \\frac{1}{2}\\|x^1 - f\\|_2^2 + \\lambda \\left( \\|D_x x^1\\|_1 + \\|D_y x^1\\|_1 \\right)\n$$\n第一项，即数据保真项，是 $x^1$ 和 $f$ 之间差的平方和的一半。第二项，即正则化惩罚项，是 $\\lambda$ 乘以梯度分量 $D_x x^1$ 和 $D_y x^1$ 中所有项的绝对值之和。\n\n实现将首先设置测试用例。对于每个用例，它将：\n1. 构建傅里叶符号 $\\Lambda_{k_y, k_x}$ 的二维网格。\n2. 计算输入图像 $f$ 的二维DFT。\n3. 使用上面推导的公式计算 $\\widehat{x^1}$。\n4. 通过二维逆DFT计算 $x^1$。\n5. 计算离散梯度 $D_x x^1$ 和 $D_y x^1$。\n6. 计算数据保真项和正则化项，以获得 $J(x^1)$ 的最终值。\n\n此过程是确定性的，并将应用于每个测试用例以生成所需的结果。",
            "answer": "[2.072236,3.999986,2.775357,3.750000]"
        },
        {
            "introduction": "正则化参数 $\\lambda$ 的选择至关重要，而理解其影响的最佳方式是观察整个解路径。本练习介绍原始-对偶同伦方法，让您能够追踪TV正则化解随着 $\\lambda$ 从大到小变化时的演化过程。您将通过数值方法识别出重构模型中新边缘出现的“临界”$\\lambda$ 值，从而将对偶变量的行为与原始解的结构联系起来。",
            "id": "3606264",
            "problem": "考虑一个计算地球物理学中的一维线性反演问题，其中未知离散模型 $m \\in \\mathbb{R}^n$ 通过单位正向算子 $A = I$ 与观测数据 $d \\in \\mathbb{R}^n$ 相关联。为恢复代表层状介质的分段常数模型，构建全变分（TV）正则化最小二乘问题\n$$\n\\min_{m \\in \\mathbb{R}^n} \\; \\frac{1}{2} \\lVert m - d \\rVert_2^2 + \\lambda \\lVert D m \\rVert_1,\n$$\n其中 $D : \\mathbb{R}^n \\to \\mathbb{R}^{n-1}$ 是离散前向差分算子，定义为 $(D m)_i = m_{i+1} - m_i$，对于 $i = 0, 1, \\ldots, n-2$，而 $\\lambda > 0$ 是正则化参数。研究 TV 正则化反演中关于 $\\lambda$ 的原始-对偶同伦：当 $\\lambda$ 从一个大值减小到一个小值时，追踪解路径 $m^\\star(\\lambda)$，并识别重构模型中边缘（不连续点）被激活时的临界 $\\lambda$ 值。\n\n使用以下基本基础和定义：\n- 离散 TV 半范数为 $\\lVert D m \\rVert_1 = \\sum_{i=0}^{n-2} \\lvert m_{i+1} - m_i \\rvert$。\n- 对于每个固定的 $\\lambda > 0$，该优化问题是严格凸的，确保了唯一的极小值点 $m^\\star(\\lambda)$。\n- 缩放 $\\ell_1$ 范数的 Fenchel 共轭满足 $G(s) = \\lambda \\lVert s \\rVert_1 \\Rightarrow G^\\star(p) = \\delta_{\\lVert p \\rVert_\\infty \\le \\lambda}(p)$，其中 $\\delta_{\\mathcal{C}}$ 是凸集 $\\mathcal{C}$ 的指示函数。\n\n您的任务是针对 $\\lambda$ 值的一个几何序列，实现一个用于 TV 正则化问题的原始-对偶算法，并检测同伦路径上边缘激活的临界点。使用对偶变量饱和准则定义边缘激活：在最优性条件下，如果 $(D m^\\star(\\lambda))_i \\neq 0$，则相应的对偶坐标 $p_i^\\star$ 会使约束 $\\lvert p_i^\\star \\rvert = \\lambda$ 饱和。因此，对于数值解，通过检查是否 $\\lvert p_i \\rvert \\ge \\lambda_k - \\epsilon_\\mathrm{sat}$（其中 $\\epsilon_\\mathrm{sat}$ 是一个很小的容差）来检测激活。\n\n算法要求：\n1. 实现离散算子 $D$ 和 $D^\\top$。其伴随算子 $D^\\top : \\mathbb{R}^{n-1} \\to \\mathbb{R}^n$ 按分量定义为 $(D^\\top p)_0 = -p_0$，$(D^\\top p)_i = p_{i-1} - p_i$（对于 $i = 1, 2, \\ldots, n-2$），以及 $(D^\\top p)_{n-1} = p_{n-2}$。\n2. 使用基于鞍点公式的一阶原始-对偶方法，步长 $\\tau$ 和 $\\sigma$ 满足 $\\tau \\sigma \\lVert D \\rVert^2 < 1$，超松弛参数 $\\theta \\in [0,1]$。使用与数据保真项 $\\frac{1}{2}\\lVert m - d \\rVert_2^2$ 和对偶约束集 $\\{p : \\lVert p \\rVert_\\infty \\le \\lambda\\}$ 的指示函数相关联的邻近算子。\n3. 构建一个包含 $K$ 个点的几何同伦序列 $\\{\\lambda_k\\}_{k=1}^K$，这些点介于一个大的 $\\lambda_\\mathrm{max}$ 和一个小的 $\\lambda_\\mathrm{min}$ 之间，其中 $\\lambda_\\mathrm{max} = 10 \\sqrt{\\frac{1}{n} \\sum_{i=0}^{n-1} d_i^2}$，$\\lambda_\\mathrm{min} = 10^{-3} \\lambda_\\mathrm{max}$。在每个 $\\lambda_k$ 处，使用前一个解 $(m^\\star(\\lambda_{k-1}), p^\\star(\\lambda_{k-1}))$ 对原始-对偶迭代进行热启动。\n4. 在每个 $\\lambda_k$ 处，收敛后，确定饱和对偶坐标集 $\\mathcal{S}(\\lambda_k) = \\{ i \\mid \\lvert p_i^\\star(\\lambda_k) \\rvert \\ge \\lambda_k - \\epsilon_\\mathrm{sat} \\}$，其中 $\\epsilon_\\mathrm{sat} = 10^{-6} \\lambda_k$。每当有新的索引进入 $\\mathcal{S}(\\lambda_k)$（与 $\\mathcal{S}(\\lambda_{k-1})$ 相比）时，记录一个临界 $\\lambda_k$。\n\n测试套件：\n令 $n = 40$ 并定义三个在 $\\mathbb{R}^n$ 中的数据向量：\n- 情况 1（理想情况，两条边）：$d^{(1)}$ 在各处均为零，除了 $d^{(1)}_i = 2$（对于 $i = 10, 11, \\ldots, 19$）和 $d^{(1)}_i = -1$（对于 $i = 20, 21, \\ldots, 29$）。\n- 情况 2（边界情况，常数）：$d^{(2)}_i = 1$（对于所有 $i = 0, 1, \\ldots, 39$）。\n- 情况 3（边缘情况，一条边）：$d^{(3)}$ 在各处均为零，除了 $d^{(3)}_i = 1$（对于 $i = 20, 21, \\ldots, 39$）。\n\n数值参数：\n- 使用 $\\tau = 0.49$，$\\sigma = 0.49$，和 $\\theta = 1.0$。\n- 每个 $\\lambda$ 最多迭代 $1000$ 次，收敛容差 $\\epsilon_\\mathrm{primal} = 10^{-6}$，定义为 $\\lVert m^{k+1} - m^k \\rVert_\\infty < \\epsilon_\\mathrm{primal}$。\n- 在 $\\lambda_\\mathrm{max}$ 和 $\\lambda_\\mathrm{min}$ 之间使用 $K = 30$ 个同伦点，如上文定义。\n\n输出规格：\n对于三个测试用例中的每一个，生成临界 $\\lambda$ 值（浮点数）的列表，在这些值上新的对偶坐标饱和，从而激活边缘。最终程序输出必须是单行，包含三个列表，形式为逗号分隔并用方括号括起来的列表，例如 $[r^{(1)},r^{(2)},r^{(3)}]$，其中每个 $r^{(j)}$ 是情况 $j$ 的临界 $\\lambda$ 值列表。不涉及物理单位、角度和百分比。答案值必须是浮点数或浮点数列表。程序必须自包含且产生如指定的确定性结果。",
            "solution": "### 1. 问题公式化\n\n问题在于找到一个模型 $m \\in \\mathbb{R}^n$，它既能很好地拟合观测数据 $d \\in \\mathbb{R}^n$，又具有分段常数的特性。这被公式化为以下凸优化问题：\n$$\n\\min_{m \\in \\mathbb{R}^n} \\; \\underbrace{\\frac{1}{2} \\lVert m - d \\rVert_2^2}_{F(m)} + \\lambda \\underbrace{\\lVert D m \\rVert_1}_{G(Dm)}\n$$\n其中 $F(m)$ 是数据保真项（假设正向算子为单位算子 $A=I$），$G(Dm)$ 是 TV 正则化项。算子 $D: \\mathbb{R}^n \\to \\mathbb{R}^{n-1}$ 是离散前向差分算子，其定义为 $(Dm)_i = m_{i+1} - m_i$，它惩罚模型 $m$ 中的非零梯度。参数 $\\lambda > 0$ 控制着拟合数据和解的分段常数结构之间的权衡。\n\n### 2. 原始-对偶鞍点公式化\n\n为了解决这个非光滑优化问题，我们采用一种原始-对偶一阶方法。通过引入一个对偶变量 $p \\in \\mathbb{R}^{n-1}$ 并使用 $G(k) = \\lambda \\lVert k \\rVert_1$ 的 Fenchel-Legendre 共轭，该问题可以表示为一个鞍点（最小-最大）问题。共轭函数为 $G^\\star(p) = \\sup_k (\\langle k, p \\rangle - G(k))$。对于缩放的 $\\ell_1$-范数，此共轭函数是对偶范数球的指示函数，即半径为 $\\lambda$ 的 $\\ell_\\infty$-球：\n$$\nG^\\star(p) = \\delta_{\\lVert p \\rVert_\\infty \\le \\lambda}(p) = \\begin{cases} 0  &\\text{if } \\lVert p \\rVert_\\infty \\le \\lambda \\\\ \\infty  &\\text{otherwise} \\end{cases}\n$$\n于是，鞍点问题为：\n$$\n\\min_{m \\in \\mathbb{R}^n} \\max_{p \\in \\mathbb{R}^{n-1}} \\left\\{ \\langle Dm, p \\rangle + F(m) - G^\\star(p) \\right\\}\n$$\n\n### 3. 原始-对偶算法 (Chambolle-Pock)\n\n我们使用 Chambolle-Pock 算法来寻找鞍点。给定当前迭代点 $(m^k, p^k, \\bar{m}^k)$，下一个迭代点的计算如下：\n1.  **对偶更新**：通过在拉格朗日函数上进行梯度上升步，然后应用 $G^\\star$ 的邻近算子来更新对偶变量 $p$：\n    $$ p^{k+1} = \\mathrm{prox}_{\\sigma G^\\star}(p^k + \\sigma D \\bar{m}^k) $$\n2.  **原始更新**：通过进行梯度下降步，然后应用 $F$ 的邻近算子来更新原始变量 $m$：\n    $$ m^{k+1} = \\mathrm{prox}_{\\tau F}(m^k - \\tau D^\\top p^{k+1}) $$\n3.  **外插**：应用一个可选的超松弛/外插步来加速收敛：\n    $$ \\bar{m}^{k+1} = m^{k+1} + \\theta (m^{k+1} - m^k) $$\n这里，$\\tau > 0$ 和 $\\sigma > 0$ 是原始和对偶步长，满足收敛准则 $\\tau \\sigma \\lVert D \\rVert_2^2 < 1$。对于一维差分算子，其算子范数 $\\lVert D \\rVert_2$ 的上界为 $2$，因此 $\\lVert D \\rVert_2^2 < 4$。所选参数 $\\tau = \\sigma = 0.49$ 满足此条件，因为 $0.49^2 \\times 4 \\approx 0.96 < 1$。参数 $\\theta \\in [0,1]$ 控制外插。\n\n### 4. 邻近算子\n\n邻近算子是该算法的核心：\n-   **$F$ 的邻近算子**：二次数据保真项的邻近算子是向数据向量 $d$ 的一个收缩：\n    $$ \\mathrm{prox}_{\\tau F}(x) = \\arg\\min_{m'} \\left\\{ \\frac{1}{2} \\lVert m' - d \\rVert_2^2 + \\frac{1}{2\\tau} \\lVert m' - x \\rVert_2^2 \\right\\} = \\frac{x + \\tau d}{1+\\tau} $$\n-   **$G^\\star$ 的邻近算子**：一个凸集指示函数的邻近算子是到该集合上的欧几里得投影。在这里，它是到半径为 $\\lambda$ 的 $\\ell_\\infty$-球上的投影：\n    $$ \\mathrm{prox}_{\\sigma G^\\star}(y) = \\mathrm{proj}_{\\lVert \\cdot \\rVert_\\infty \\le \\lambda}(y) $$\n    这是通过将 $y$ 的每个元素截断到 $[-\\lambda, \\lambda]$ 范围内来逐分量执行的。即 $(\\mathrm{proj}(y))_i = \\max(-\\lambda, \\min(\\lambda, y_i))$。\n\n### 5. 同伦与临界 $\\lambda$ 检测\n\n解 $m^\\star(\\lambda)$ 随 $\\lambda$ 变化。同伦方法通过对一系列 $\\lambda_k$ 值（通常从一个大的 $\\lambda_\\mathrm{max}$ 递减到一个小的 $\\lambda_\\mathrm{min}$）求解问题来追踪此解路径。\n-   **初始化**：在非常大的 $\\lambda$ 值下，TV 项占主导地位，迫使 $Dm \\approx 0$，从而得到一个常数模型 $m$。一个合适的 $\\lambda_\\mathrm{max}$ 可以从数据的均方根值估计。\n-   **热启动**：前一个 $\\lambda$ 值的解 $(m^\\star(\\lambda_{k-1}), p^\\star(\\lambda_{k-1}))$ 为当前 $\\lambda_k$ 的迭代提供了一个极好的初始猜测，从而显著加快收敛速度。\n-   **边缘激活与临界 $\\lambda$**：根据 Karush-Kuhn-Tucker (KKT) 最优性条件，模型中的非零跳跃 $(Dm^\\star)_i \\neq 0$ 仅在相应的对偶变量使其约束饱和时才可能发生，即 $|p_i^\\star| = \\lambda$。这些位置对应于分段常数重构中的“边缘”。我们通过检查是否 $|p_i^\\star| \\ge \\lambda - \\epsilon_\\mathrm{sat}$（其中 $\\epsilon_\\mathrm{sat}$ 是一个很小的容差）来数值上检测这种饱和。如果饱和对偶索引集增长，表明随着正则化的放宽，模型中形成了新的边缘，则我们离散序列中的一个值 $\\lambda_k$ 被认为是“临界”的。该算法会记录这些 $\\lambda_k$ 值。",
            "answer": "[[12.24744871391589, 4.887291125298416, 2.597656333798993, 1.3807097127503387], [], [5.0, 2.657551062973838, 1.4125375446227544]]"
        }
    ]
}