{
    "hands_on_practices": [
        {
            "introduction": "在地球动力学中，许多振动系统（如地球的自由振荡）可以近似为线性振子，但微弱的非线性效应会随时间累积，导致简单的微扰解失效。此练习将引导您使用 Lindstedt–Poincaré (LP) 方法，这是一种强大的微扰技术，通过同时展开解和频率来消除导致解长期发散的“长期项”。通过这个练习 ，您将亲手推导出一个对弱非线性振子长期行为一致有效 (uniformly valid) 的近似解，这是处理非线性动力学问题的核心技能。",
            "id": "3576366",
            "problem": "在计算地震学和全球地球动力学中，均匀弹性体的单一简正模所对应的位移，在主导阶上可以被建模为一个角频率为 $\\omega_{0}$ 的线性振子。弱几何或材料非线性会引入小的修正，这些修正可以在运动方程中用一个三次项来表示。考虑弱非线性振子\n$$\n\\ddot{q}(t) + \\omega_{0}^{2}\\,q(t) + \\epsilon\\,\\alpha\\,q^{3}(t) = 0,\n$$\n其中 $q(t)$ 是模态坐标，$\\omega_{0} > 0$ 是未扰动模态的线性角频率，$\\alpha$ 是一个表征三次非线性强度和符号的实常数，而 $0  \\epsilon \\ll 1$ 是一个衡量非线性弱度的无量纲小参数。假设该模态从静止状态被激发，初始条件为 $q(0) = A$ 和 $\\dot{q}(0) = 0$，其中 $A > 0$ 是初始位移振幅。\n\n对 $q(t)$ 按 $\\epsilon$ 进行的朴素正则微扰展开会因强迫项与线性频率下的齐次解之间的近共振而产生长期增长，使得该近似在长时间下非一致有效。为了获得一个一致有效的近似，应用 Lindstedt–Poincaré (LP) 方法（首次出现时定义缩写 Lindstedt–Poincaré (LP)），通过引入一个拉伸时间变量和频率修正，使得主导阶振荡保持周期性，并且所有长期项在 $\\mathcal{O}(\\epsilon)$ 阶被消除。\n\n从给定的运动方程和 LP 方法出发，推导为消除 $\\mathcal{O}(\\epsilon)$ 阶问题中的长期项所需的一阶频率修正 $\\omega_{1}$。你的推导过程必须明确展示时间的重新标度、解和频率的展开，以及强制消除共振强迫项的可解性条件。将你的最终答案表示为关于 $\\omega_{0}$、$\\alpha$ 和 $A$ 的 $\\omega_{1}$ 的单一符号表达式。不需要进行数值计算，也不需要单位。修正后的一阶角频率为 $\\omega = \\omega_{0} + \\epsilon\\,\\omega_{1}$；然而，只需报告频率修正项 $\\omega_{1}$。",
            "solution": "该问题要求使用 Lindstedt–Poincaré (LP) 方法推导一个弱非线性振子的一阶频率修正。控制运动方程是无阻尼的 Duffing 方程：\n$$\n\\ddot{q}(t) + \\omega_{0}^{2}\\,q(t) + \\epsilon\\,\\alpha\\,q^{3}(t) = 0,\n$$\n初始条件为 $q(0) = A$ 和 $\\dot{q}(0) = 0$。参数 $\\omega_{0}$、$\\alpha$ 和 $A$ 是正常数，且 $0  \\epsilon \\ll 1$ 是一个小参数。\n\nLindstedt–Poincaré (LP) 方法的核心思想是通过引入一个新的拉伸时间变量 $\\tau$，并将解 $q$ 和频率 $\\omega$ 都展开为小参数 $\\epsilon$ 的幂级数，来寻求一个周期解。此过程旨在消除在直接的正则微扰展开中出现的长期项（随时间无界增长的项），从而确保近似解在所有时间上的一致有效性。\n\n首先，我们引入拉伸时间变量 $\\tau$：\n$$\n\\tau = \\omega t\n$$\n其中 $\\omega$ 是振荡的修正角频率，我们假设它依赖于 $\\epsilon$。使用链式法则，我们将对 $t$ 的时间导数转换为对 $\\tau$ 的导数：\n$$\n\\frac{d}{dt} = \\frac{d\\tau}{dt}\\frac{d}{d\\tau} = \\omega \\frac{d}{d\\tau}\n$$\n$$\n\\frac{d^2}{dt^2} = \\frac{d}{dt}\\left(\\omega \\frac{d}{d\\tau}\\right) = \\omega^2 \\frac{d^2}{d\\tau^2}\n$$\n将这些代入原始微分方程得到：\n$$\n\\omega^2 q''(\\tau) + \\omega_{0}^{2} q(\\tau) + \\epsilon \\alpha q^{3}(\\tau) = 0\n$$\n其中撇号表示对 $\\tau$ 的微分。\n\n接下来，我们将解 $q(\\tau)$ 和频率 $\\omega$ 都展开为 $\\epsilon$ 的幂级数：\n$$\nq(\\tau) = q_{0}(\\tau) + \\epsilon q_{1}(\\tau) + \\epsilon^2 q_{2}(\\tau) + \\dots\n$$\n$$\n\\omega = \\omega_{0} + \\epsilon \\omega_{1} + \\epsilon^2 \\omega_{2} + \\dots\n$$\n对于 $\\omega^2$ 项，我们需要其展开到 $\\mathcal{O}(\\epsilon)$ 阶：\n$$\n\\omega^2 = (\\omega_{0} + \\epsilon \\omega_{1} + \\dots)^2 = \\omega_{0}^2 + 2\\epsilon\\omega_{0}\\omega_{1} + \\mathcal{O}(\\epsilon^2)\n$$\n将这些展开式代入变换后的微分方程：\n$$\n(\\omega_{0}^2 + 2\\epsilon\\omega_{0}\\omega_{1} + \\dots)(q_{0}'' + \\epsilon q_{1}'' + \\dots) + \\omega_{0}^2 (q_{0} + \\epsilon q_{1} + \\dots) + \\epsilon\\alpha(q_{0} + \\epsilon q_{1} + \\dots)^3 = 0\n$$\n我们展开三次项：$(q_{0} + \\epsilon q_{1} + \\dots)^3 = q_{0}^3 + 3\\epsilon q_{0}^2 q_{1} + \\mathcal{O}(\\epsilon^2)$。为了找到 $\\mathcal{O}(\\epsilon)$ 阶方程，我们只需要主导项 $q_0^3$。代入此项并按 $\\epsilon$ 的幂次收集各项：\n$$\n(\\omega_{0}^2 q_{0}'' + \\omega_{0}^2 q_{0}) + \\epsilon(\\omega_{0}^2 q_{1}'' + \\omega_{0}^2 q_{1} + 2\\omega_{0}\\omega_{1} q_{0}'' + \\alpha q_{0}^3) + \\mathcal{O}(\\epsilon^2) = 0\n$$\n这个方程必须对所有小的 $\\epsilon$ 都成立，所以我们可以将 $\\epsilon$ 的每个幂次的系数设为零。\n\n在 $\\mathcal{O}(\\epsilon^0)$ 阶：\n$$\n\\omega_{0}^2 q_{0}'' + \\omega_{0}^2 q_{0} = 0 \\implies q_{0}'' + q_{0} = 0\n$$\n通解为 $q_{0}(\\tau) = C_0 \\cos(\\tau) + D_0 \\sin(\\tau)$。\n\n在 $\\mathcal{O}(\\epsilon^1)$ 阶：\n$$\n\\omega_{0}^2 q_{1}'' + \\omega_{0}^2 q_{1} = -2\\omega_{0}\\omega_{1} q_{0}'' - \\alpha q_{0}^3\n$$\n可以重写为：\n$$\nq_{1}'' + q_{1} = -\\frac{2\\omega_{1}}{\\omega_{0}} q_{0}'' - \\frac{\\alpha}{\\omega_{0}^2} q_{0}^3\n$$\n\n现在我们必须变换初始条件。在 $t=0$ 时，我们有 $\\tau=0$。\n条件 $q(0)=A$ 变为：\n$q(0) = q_{0}(0) + \\epsilon q_{1}(0) + \\dots = A$。\n这意味着 $q_{0}(0) = A$ 和 $q_{1}(0) = 0$, $q_{2}(0) = 0$ 等。\n\n条件 $\\dot{q}(0)=0$ 变为：\n$\\dot{q}(t) = \\omega \\frac{dq}{d\\tau} = (\\omega_{0} + \\epsilon\\omega_{1} + \\dots)(q_{0}'(\\tau) + \\epsilon q_{1}'(\\tau) + \\dots)$。\n在 $t=0$ ($\\tau=0$) 时：\n$\\dot{q}(0) = (\\omega_{0} + \\epsilon\\omega_{1} + \\dots)(q_{0}'(0) + \\epsilon q_{1}'(0) + \\dots) = 0$。\n由于 $\\omega_{0} \\neq 0$，这要求整个第二个括号为零。将其展开并令 $\\epsilon$ 的各幂次项为零，得到 $q_{0}'(0) = 0$, $q_{1}'(0) = 0$ 等。\n\n将这些初始条件应用于 $\\mathcal{O}(\\epsilon^0)$ 阶的解：\n$q_{0}(0) = C_0 \\cos(0) + D_0 \\sin(0) = C_0 = A$。\n$q_{0}'(0) = -C_0 \\sin(0) + D_0 \\cos(0) = D_0 = 0$。\n所以，主导阶解是：\n$$\nq_{0}(\\tau) = A \\cos(\\tau)\n$$\n从 $\\mathcal{O}(\\epsilon^0)$ 阶微分方程，我们也有 $q_{0}'' = -q_{0} = -A \\cos(\\tau)$。\n\n现在，我们将 $q_{0}$ 和 $q_{0}''$ 代入 $\\mathcal{O}(\\epsilon^1)$ 阶方程的右手边 (RHS)：\n$$\nq_{1}'' + q_{1} = -\\frac{2\\omega_{1}}{\\omega_{0}}(-A\\cos(\\tau)) - \\frac{\\alpha}{\\omega_{0}^2}(A\\cos(\\tau))^3\n$$\n$$\nq_{1}'' + q_{1} = \\frac{2A\\omega_{1}}{\\omega_{0}}\\cos(\\tau) - \\frac{\\alpha A^3}{\\omega_{0}^2}\\cos^3(\\tau)\n$$\nRHS 上的 $\\cos(\\tau)$ 项是一个共振强迫项，因为它与齐次方程 $q_{1}'' + q_{1} = 0$ 的一个解相匹配。这样的项会导致 $q_{1}$ 的解随 $\\tau$ 线性增长（一个长期项），形式为 $\\tau \\sin(\\tau)$。为确保解保持周期性（并因此一致有效），我们必须消除所有共振强迫项。\n\n为此，我们使用三角恒等式 $\\cos(3x) = 4\\cos^3(x) - 3\\cos(x)$，它给出 $\\cos^3(x) = \\frac{1}{4}(\\cos(3x) + 3\\cos(x))$。将此代入 RHS：\n$$\nRHS = \\frac{2A\\omega_{1}}{\\omega_{0}}\\cos(\\tau) - \\frac{\\alpha A^3}{\\omega_{0}^2}\\left(\\frac{1}{4}\\cos(3\\tau) + \\frac{3}{4}\\cos(\\tau)\\right)\n$$\n$$\nRHS = \\left(\\frac{2A\\omega_{1}}{\\omega_{0}} - \\frac{3\\alpha A^3}{4\\omega_{0}^2}\\right)\\cos(\\tau) - \\frac{\\alpha A^3}{4\\omega_{0}^2}\\cos(3\\tau)\n$$\nLP 方法的可解性条件要求共振项 $\\cos(\\tau)$ 的系数必须为零。\n$$\n\\frac{2A\\omega_{1}}{\\omega_{0}} - \\frac{3\\alpha A^3}{4\\omega_{0}^2} = 0\n$$\n我们解此方程求 $\\omega_{1}$。由于 $A > 0$ 且 $\\omega_0 > 0$，我们可以重排和简化：\n$$\n\\frac{2A\\omega_{1}}{\\omega_{0}} = \\frac{3\\alpha A^3}{4\\omega_{0}^2}\n$$\n$$\n\\omega_{1} = \\left(\\frac{3\\alpha A^3}{4\\omega_{0}^2}\\right) \\left(\\frac{\\omega_{0}}{2A}\\right)\n$$\n$$\n\\omega_{1} = \\frac{3\\alpha A^2}{8\\omega_{0}}\n$$\n这个表达式提供了为从解中消除长期项所需的频率一阶修正，从而得到一个一致有效的渐近近似。一阶修正后的频率为 $\\omega \\approx \\omega_{0} + \\epsilon \\frac{3\\alpha A^2}{8\\omega_{0}}$。",
            "answer": "$$\n\\boxed{\\frac{3 \\alpha A^{2}}{8 \\omega_{0}}}\n$$"
        },
        {
            "introduction": "在地震数据处理中，动校正速度 (Normal Moveout, NMO, velocity) 是用于校正反射地震数据、从而准确成像地下结构的关键参数。当地下反射界面存在倾角时，NMO 速度会发生变化，而微扰法为估算这种变化提供了一种有效途径。本练习  要求您首先推导出一个关于小倾角 $\\epsilon$ 的 NMO 速度的二阶微扰公式，然后通过编写代码将其与精确的射线追踪结果进行比较。这个实践结合了理论推导和计算验证，完美诠释了计算地球物理学家如何建立和检验近似模型。",
            "id": "3576297",
            "problem": "考虑一个二维各向同性声学地球模型，其自由表面位于深度坐标 $z = 0$ 处，且深度正方向朝下。模型中存在一个单个平面反射层，其相对于水平方向有一个微小的构造倾角 $\\theta$，参数化为 $\\epsilon = \\tan \\theta$，其中 $\\epsilon \\ll 1$。介质中的波速 $v$ 在每层内是常数，对于本问题，你可以将单一均匀层的特殊情况作为标准验证模型来处理。我们关心的量是动校正 (NMO) 速度，记为 $V_{\\mathrm{NMO}}(\\epsilon)$，它由零炮检距 $x$ 附近的双程反射旅行时 $t(x)$ 的二次时差项系数定义，通过局部双曲线近似：\n$$\nt^2(x) = t_0^2 + \\frac{x^2}{V_{\\mathrm{NMO}}^2} + \\mathcal{O}(x^4),\n$$\n其中 $t_0$ 是零炮检距双程旅行时，$x$ 是沿水平 $x$ 轴的炮检距。在具有水平反射层的水平层状各向同性介质中，零倾角动校正速度是众所周知的均方根 (RMS) 速度\n$$\nV_{\\mathrm{RMS}}^2(t_0) = \\frac{1}{t_0} \\int_{0}^{t_0} v^2\\big(t'\\big)\\, \\mathrm{d}t',\n$$\n对于厚度为 $z_0$、速度为 $v$ 的单一均匀层，该式简化为 $V_{\\mathrm{RMS}} = v$ 和 $t_0 = 2 z_0 / v$。对于有微小倾角的平面反射层，倾角会修正 NMO 速度。\n\n你的任务如下：\n\n- 从 Fermat 原理和各向同性程函方程框架出发，结合水平层状介质中 RMS 速度的定义，推导出 NMO 速度 $V_{\\mathrm{NMO}}(\\epsilon)$ 在 $\\epsilon = 0$ 附近的微扰展开式，直到并包括 $\\epsilon$ 的二阶项，假设 $\\epsilon = \\tan \\theta \\ll 1$。用 $V_{\\mathrm{RMS}}$ 和 $\\epsilon$ 明确地写出你的最终展开式，并通过对称性论证为何 $\\epsilon$ 的线性项会消失。\n- 在倾斜平面反射层之上的单一均匀层这一特殊情况下，使用合成射线追踪实现一个计算验证：\n  - 使用均匀各向同性介质中精确的虚源法旅行时：从位于 $(-x/2, 0)$ 的震源到位于 $(+x/2, 0)$ 的检波器，在平面 $z = z_0 + \\epsilon x$ 上反射的双程旅行时等于\n    $$\n    t(x) = \\frac{\\cos \\theta}{v} \\sqrt{x^2 + \\big(2 z_0\\big)^2}, \\quad \\text{with } \\theta = \\arctan \\epsilon.\n    $$\n  - 通过在 $x=0$ 附近对二次项系数进行最小二乘拟合，从“射线追踪”得到的 $t(x)$ 中数值上估计 $V_{\\mathrm{NMO}}$；等价地，对小的 $|x|$，将 $t^2(x) - t_0^2$ 对 $x^2$ 进行回归分析，并取 $V_{\\mathrm{NMO}} = 1/\\sqrt{\\text{斜率}}$。\n  - 将你推导出的微扰 $V_{\\mathrm{NMO}}(\\epsilon)$ 与射线追踪的估计值进行比较，并报告绝对相对误差，其定义为 $\\big|V_{\\mathrm{pert}} - V_{\\mathrm{rt}}\\big| / V_{\\mathrm{rt}}$，以无量纲小数的形式。\n\n物理单位和约定：\n\n- 所有速度使用米/秒 ($\\mathrm{m/s}$)。\n- 深度和炮检距使用米 ($\\mathrm{m}$)。\n- 所有角度使用弧度。\n- 参数 $\\epsilon$ 是无量纲的。\n\n你的程序必须硬编码并评估以下测试套件，该套件涵盖了零倾角边界、弱倾角区域和逐渐增强的倾角，所有情况都在单一均匀层介质中，其中 $V_{\\mathrm{RMS}} = v$ 且虚源法旅行时是精确的：\n\n- 测试 1：$(v, z_0, \\epsilon) = (2000\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0)$。\n- 测试 2：$(v, z_0, \\epsilon) = (2500\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0.05)$。\n- 测试 3：$(v, z_0, \\epsilon) = (2500\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0.3)$。\n- 测试 4：$(v, z_0, \\epsilon) = (3000\\,\\mathrm{m/s}, 3000\\,\\mathrm{m}, 0.6)$。\n\n对于每个测试中的回归分析，使用一组关于零对称的小炮检距（例如 $x \\in \\{-x_{\\max}, \\ldots, -\\Delta x, 0, \\Delta x, \\ldots, x_{\\max}\\}$，其中 $x_{\\max}$ 的选择应使得 $x_{\\max} \\ll 2 z_0$）。每个测试用例的结果是一个浮点数形式的绝对相对误差。\n\n最终输出格式：\n\n- 你的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，例如 $[r_1,r_2,r_3,r_4]$，其中 $r_k$ 表示测试 $k$ 的绝对相对误差（以小数表示）。",
            "solution": "我们从第一性原理出发。在各向同性声学介质中，几何射线满足 Fermat 原理：实际的反射路径使得双程旅行时 $t$ 相对于路径的微扰是稳定的。在具有水平反射层的水平层状各向同性介质中，零炮检距 $x$ 附近的共中心点旅行时 $t(x)$ 允许一个双曲线展开\n$$\nt^2(x) = t_0^2 + \\frac{x^2}{V_{\\mathrm{NMO}}^2} + \\mathcal{O}(x^4),\n$$\n其中 $t_0$ 是双程零炮检距时间，$V_{\\mathrm{NMO}}$ 是动校正速度。系数 $1/V_{\\mathrm{NMO}}^2$ 由 $t^2$ 在 $x = 0$ 处的二阶导数确定。在水平层状各向同性介质中，这个系数等于均方根 (RMS) 速度平方的倒数，\n$$\n\\frac{1}{V_{\\mathrm{NMO}}^2(0)} = \\frac{1}{V_{\\mathrm{RMS}}^2(t_0)}, \\qquad V_{\\mathrm{RMS}}^2(t_0) = \\frac{1}{t_0} \\int_{0}^{t_0} v^2\\big(t'\\big)\\, \\mathrm{d}t'.\n$$\n这是一个经过充分检验的结果，它源于对双平方根（单程）方程的线性化，或者等价地，源于层状各向同性介质中的动力学射线追踪分析。对于速度为 $v$、反射层深度为 $z_0$ 的单一均匀层，我们有 $V_{\\mathrm{RMS}} = v$ 和 $t_0 = 2 z_0 / v$。\n\n现在我们引入一个微小的构造倾角。考虑一个以倾角 $\\theta$ 偏离水平方向的平面反射层；我们令 $\\epsilon = \\tan \\theta$，其中 $\\epsilon \\ll 1$。在各向同性介质中，镜面反射的几何关系意味着零炮检距射线垂直于反射层。在零炮检距附近，时差由 $t^2(x)$ 的曲率决定，而该曲率取决于水平炮检距 $x$ 如何投影到垂直于反射层的方向上。因为反射层倾斜了 $\\theta$ 角，水平炮检距 $x$ 以因子 $\\cos \\theta$ 投影到反射层的法线方向上，且每单位 $x$ 的有效路径长度变化减少了 $\\cos \\theta$。因此，$t^2(x)$ 中乘以 $x^2$ 的系数被乘以 $\\cos^2 \\theta$，这反过来又使得 NMO 速度被 $\\cos \\theta$ 除：\n$$\n\\frac{1}{V_{\\mathrm{NMO}}^2(\\theta)} = \\frac{\\cos^2 \\theta}{V_{\\mathrm{RMS}}^2}, \\qquad \\Rightarrow \\qquad V_{\\mathrm{NMO}}(\\theta) = \\frac{V_{\\mathrm{RMS}}}{\\cos \\theta}.\n$$\n这个结果在单一均匀层中是精确的，并且当用计算至反射层的 $V_{\\mathrm{RMS}}$ 表示时，对于水平层状各向同性上覆层之下的倾斜平面反射层，它作为正确的二阶（炮检距）时差公式是成立的。\n\n在小参数 $\\epsilon = \\tan \\theta$ 中的微扰展开使用了恒等式 $\\cos \\theta = 1/\\sqrt{1 + \\tan^2 \\theta} = 1/\\sqrt{1 + \\epsilon^2}$。因此，\n$$\n\\frac{1}{\\cos \\theta} = \\sqrt{1 + \\epsilon^2} = 1 + \\frac{1}{2}\\epsilon^2 - \\frac{1}{8}\\epsilon^4 + \\mathcal{O}(\\epsilon^6).\n$$\n到 $\\epsilon$ 的二阶，我们得到\n$$\nV_{\\mathrm{NMO}}(\\epsilon) = V_{\\mathrm{RMS}} \\left(1 + \\frac{1}{2}\\epsilon^2\\right) + \\mathcal{O}(\\epsilon^4).\n$$\n不存在 $\\epsilon$ 的线性项，因为问题在反转倾角方向（$\\theta \\to -\\theta$）时是不变的，这使得 $V_{\\mathrm{NMO}}$ 保持不变；因此 $V_{\\mathrm{NMO}}$ 必须是 $\\theta$ 的偶函数，从而也是 $\\epsilon$ 的偶函数。\n\n为了验证，我们使用均匀单层情况，其中 $V_{\\mathrm{RMS}} = v$ 且倾斜平面的精确旅行时可从虚源法获得。如果平面反射层为 $z = z_0 + \\epsilon x$，则单位法向量为 $\\mathbf{n} = (-\\sin \\theta, \\cos \\theta)$，将检波器关于该平面作镜像可将问题简化为一条直线路径。作为炮检距 $x$ 函数的精确双程旅行时为\n$$\nt(x) = \\frac{\\cos \\theta}{v} \\sqrt{x^2 + \\big(2 z_0\\big)^2}, \\qquad \\theta = \\arctan \\epsilon.\n$$\n因此，\n$$\nt^2(x) = \\left(\\frac{2 z_0 \\cos \\theta}{v}\\right)^2 + \\left(\\frac{\\cos \\theta}{v}\\right)^2 x^2,\n$$\n该式是关于 $x$ 的双曲线，其精确动校正速度为 $V_{\\mathrm{NMO}}^{\\mathrm{exact}} = v/\\cos \\theta$。二阶微扰公式为\n$$\nV_{\\mathrm{NMO}}^{\\mathrm{pert}}(\\epsilon) = v \\left(1 + \\frac{1}{2}\\epsilon^2\\right).\n$$\n我们通过对小炮检距 $|x| \\le x_{\\max}$（其中 $x_{\\max} \\ll 2 z_0$）下 $t^2(x) - t_0^2$ 对 $x^2$ 的斜率进行最小二乘拟合，从合成的“射线追踪”旅行时中数值上估计 $V_{\\mathrm{NMO}}^{\\mathrm{rt}}$。绝对相对误差为\n$$\n\\mathrm{err} = \\frac{\\left|V_{\\mathrm{NMO}}^{\\mathrm{pert}} - V_{\\mathrm{NMO}}^{\\mathrm{rt}}\\right|}{V_{\\mathrm{NMO}}^{\\mathrm{rt}}}.\n$$\n\n我们将此应用于指定的测试套件：\n- 测试 1：$(v, z_0, \\epsilon) = (2000\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0)$。此处 $\\theta = 0$，$V_{\\mathrm{NMO}}^{\\mathrm{exact}} = v = 2000\\,\\mathrm{m/s}$，且 $V_{\\mathrm{NMO}}^{\\mathrm{pert}} = v$，给出 $\\mathrm{err} \\approx 0$（在数值回归误差范围内）。\n- 测试 2：$(v, z_0, \\epsilon) = (2500\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0.05)$。此处 $\\theta = \\arctan 0.05$，所以 $V_{\\mathrm{NMO}}^{\\mathrm{exact}} = v/\\cos \\theta \\approx v \\sqrt{1 + \\epsilon^2} \\approx v (1 + \\epsilon^2/2)$。微扰预测是二阶准确的；对于这个 $\\epsilon$，回归分析应产生可忽略的误差。\n- 测试 3：$(v, z_0, \\epsilon) = (2500\\,\\mathrm{m/s}, 1500\\,\\mathrm{m}, 0.3)$。此处 $\\sqrt{1 + \\epsilon^2}$ 与 $1 + \\epsilon^2/2$ 之间的差异是 $\\mathcal{O}(\\epsilon^4)$，因此预计会有一个虽小但可察觉的误差。\n- 测试 4：$(v, z_0, \\epsilon) = (3000\\,\\mathrm{m/s}, 3000\\,\\mathrm{m}, 0.6)$。这是一个更强的倾角，因此在 $\\mathcal{O}(\\epsilon^2)$ 处的截断会引起更大的偏差。\n\n程序构建对称的炮检距样本，计算精确的 $t(x)$，通过回归二次曲率得到 $V_{\\mathrm{NMO}}^{\\mathrm{rt}}$，使用二阶公式计算 $V_{\\mathrm{NMO}}^{\\mathrm{pert}}$，并按要求在单行上打印绝对相对误差列表 $[\\mathrm{err}_1,\\mathrm{err}_2,\\mathrm{err}_3,\\mathrm{err}_4]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef perturbative_vnmo(v_rms: float, epsilon: float) - float:\n    \"\"\"\n    Second-order perturbative NMO velocity:\n    V_NMO(eps) = V_RMS * (1 + 0.5 * eps^2) + O(eps^4)\n    For a single homogeneous layer, V_RMS = v.\n    \"\"\"\n    return v_rms * (1.0 + 0.5 * epsilon**2)\n\n\ndef exact_traveltime_homogeneous(v: float, z0: float, epsilon: float, x: np.ndarray) - np.ndarray:\n    \"\"\"\n    Exact two-way traveltime t(x) for a homogeneous isotropic medium with\n    a planar reflector z = z0 + epsilon * x. Uses the image method:\n    t(x) = (cos(theta)/v) * sqrt( x^2 + (2 z0)^2 ), with theta = arctan(epsilon).\n    \"\"\"\n    theta = np.arctan(epsilon)\n    cos_theta = np.cos(theta)\n    return (cos_theta / v) * np.sqrt(x**2 + (2.0 * z0)**2)\n\n\ndef estimate_vnmo_by_regression(t_of_x: np.ndarray, x: np.ndarray) - float:\n    \"\"\"\n    Estimate V_NMO from regression of t^2(x) - t0^2 versus x^2 near x=0.\n    Return V_NMO = 1 / sqrt(slope).\n    \"\"\"\n    # Compute t0 as t(x=0); assume x is symmetric and includes 0\n    # To be robust, take the mean of t at the smallest |x| samples around zero:\n    idx0 = np.argmin(np.abs(x))\n    t0 = t_of_x[idx0]\n    y = t_of_x**2 - t0**2\n    X = x**2\n\n    # Linear regression y = s * X (no intercept)\n    # Use least squares slope s = (X^T y) / (X^T X), excluding the x=0 point to avoid 0/0\n    mask = X > 0\n    Xm = X[mask]\n    ym = y[mask]\n    s_num = float(np.dot(Xm, ym))\n    s_den = float(np.dot(Xm, Xm))\n    if s_den == 0.0:\n        # Degenerate case: all offsets are zero\n        return np.inf\n    slope = s_num / s_den\n    if slope = 0.0:\n        # Numerical safety: slope should be positive\n        return np.inf\n    vnmo = 1.0 / np.sqrt(slope)\n    return vnmo\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (v [m/s], z0 [m], epsilon [dimensionless])\n    test_cases = [\n        (2000.0, 1500.0, 0.0),\n        (2500.0, 1500.0, 0.05),\n        (2500.0, 1500.0, 0.30),\n        (3000.0, 3000.0, 0.60),\n    ]\n\n    # Offset sampling parameters for regression:\n    # Ensure x_max  2*z0 for good local curvature estimation.\n    # Use a small step to have multiple samples.\n    results = []\n    for v, z0, eps in test_cases:\n        # Choose offset range relative to depth to satisfy small-offset assumption\n        x_max = min(200.0, 0.1 * (2.0 * z0))  # cap at 200 m or 10% of two-way depth\n        n_side = 10  # number of samples on each side (excluding zero)\n        xs_neg = -np.linspace(x_max, x_max / n_side, n_side)\n        xs_pos = np.linspace(x_max / n_side, x_max, n_side)\n        x = np.concatenate([xs_neg, np.array([0.0]), xs_pos])\n\n        # Exact traveltimes via image-method formula\n        t = exact_traveltime_homogeneous(v, z0, eps, x)\n\n        # Estimate V_NMO by regression (ray-trace-based estimate)\n        vnmo_rt = estimate_vnmo_by_regression(t, x)\n\n        # Perturbative V_NMO to second order, with V_RMS = v in a single homogeneous layer\n        vnmo_pert = perturbative_vnmo(v, eps)\n\n        # Absolute relative error\n        err = abs(vnmo_pert - vnmo_rt) / vnmo_rt\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(lambda r: f'{r:.8g}', results))}]\")\n\nsolve()\n```"
        }
    ]
}