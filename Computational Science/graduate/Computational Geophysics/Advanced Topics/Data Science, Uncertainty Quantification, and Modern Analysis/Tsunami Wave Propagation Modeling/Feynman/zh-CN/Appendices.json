{
    "hands_on_practices": [
        {
            "introduction": "任何数值模拟若要产生有意义的结果，首先必须保证其稳定性。本练习将介绍 Courant-Friedrichs-Lewy (CFL) 条件，这是海啸模型中显式时间积分格式的一个基本稳定性约束 。通过在一个水深和流速变化的海域上计算允许的最大时间步长 $\\Delta t$，您将亲身体验物理波速如何决定数值模拟参数的极限。",
            "id": "3618044",
            "problem": "考虑在一维大陆架到深海剖面上，由守恒形式的非线性浅水方程模拟的海啸波传播，水平坐标为 $x \\in [0,L]$，网格间距为常数 $\\Delta x$。区域长度为 $L = 2.0 \\times 10^{5}\\,\\mathrm{m}$，网格间距为 $\\Delta x = 2.0 \\times 10^{3}\\,\\mathrm{m}$。重力加速度为 $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。静水深度从大陆架到深海线性变化，关系式为 $h(x) = h_{0} + \\alpha x$，其中 $h_{0} = 50\\,\\mathrm{m}$ 且 $\\alpha = \\dfrac{4000 - 50}{L}\\,\\mathrm{m}\\,\\mathrm{m}^{-1}$。存在背景流，$u(x) = u_{0} + \\beta x$，其中 $u_{0} = 0.2\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 且 $\\beta = \\dfrac{1.0 - 0.2}{L}\\,\\mathrm{(m\\,s^{-1})\\,m^{-1}}$，因此 $u(L) = 1.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。假设采用显式守恒有限体积法离散化，使用单步时间积分器，且数值通量与控制方程的特征信号速度相一致。此类显式格式的稳定性由 Courant–Friedrichs–Lewy (CFL) 条件控制，选定的 CFL 数为 $C = 0.45$。\n\n从控制方程和特征波传播速度的定义出发，推导该模型中由 CFL 准则所确定的局部稳定性限制时间步长 $\\Delta t(x)$。然后，分析 $\\Delta t(x)$ 在空间非均匀域上的变化情况，并确定整个模拟必须使用的全局稳定时间步长 $\\Delta t^{\\ast} = \\min_{x \\in [0,L]} \\Delta t(x)$。将 $\\Delta t^{\\ast}$ 的最终数值以秒为单位表示，并将答案四舍五入到四位有效数字。",
            "solution": "合适的起点是使用守恒变量表示的一维非线性浅水方程组。记守恒状态向量为 $\\boldsymbol{q} = \\begin{pmatrix} h \\\\ m \\end{pmatrix}$，其中 $h$ 是流体深度，$m = h u$ 是深度积分动量。通量向量为 $\\boldsymbol{f}(\\boldsymbol{q}) = \\begin{pmatrix} m \\\\ \\dfrac{m^{2}}{h} + \\dfrac{1}{2} g h^{2} \\end{pmatrix}$。守恒定律写作\n$$\n\\partial_{t} \\boldsymbol{q} + \\partial_{x} \\boldsymbol{f}(\\boldsymbol{q}) = \\boldsymbol{0}.\n$$\n围绕局部状态 $(h,u)$ 进行线性化，得到通量雅可比矩阵 $\\boldsymbol{A} = \\dfrac{\\partial \\boldsymbol{f}}{\\partial \\boldsymbol{q}}$，其特征值是该系统的特征速度。一个标准的计算给出\n$$\n\\lambda_{\\pm} = u \\pm \\sqrt{g h}.\n$$\n这些是相对于地面的非线性浅水重力波的传播速度。对于使用单步时间积分器的显式守恒有限体积法，Courant–Friedrichs–Lewy (CFL) 条件规定，时间步长必须足够小，以使最快的特征波在一个步长内移动的距离不超过一个单元格的 $C$ 倍。在均匀网格间距 $\\Delta x$ 的情况下，这意味着局部约束为\n$$\n\\Delta t(x) \\leq C \\,\\frac{\\Delta x}{\\max\\{|\\lambda_{+}(x)|,\\,|\\lambda_{-}(x)|\\}}.\n$$\n由于当 $h(x) > 0$ 时有 $\\sqrt{g h(x)} \\geq 0$，且两个特征值关于 $u(x)$ 对称，因此可以得出\n$$\n\\max\\{|\\lambda_{+}(x)|,\\,|\\lambda_{-}(x)|\\} = |u(x)| + \\sqrt{g\\,h(x)}.\n$$\n因此，局部稳定性限制的时间步长为\n$$\n\\Delta t(x) = C \\,\\frac{\\Delta x}{\\,|u(x)| + \\sqrt{g\\,h(x)}\\,}.\n$$\n\n给定 $h(x) = h_{0} + \\alpha x$，其中 $h_{0} = 50\\,\\mathrm{m}$ 且 $\\alpha = \\dfrac{4000 - 50}{L}$；以及 $u(x) = u_{0} + \\beta x$，其中 $u_{0} = 0.2\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ 且 $\\beta = \\dfrac{1.0 - 0.2}{L}\\,\\mathrm{(m\\,s^{-1})\\,m^{-1}}$。区域长度为 $L = 2.0 \\times 10^{5}\\,\\mathrm{m}$，网格间距为 $\\Delta x = 2.0 \\times 10^{3}\\,\\mathrm{m}$，且 $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。CFL 数为 $C = 0.45$。\n\n首先，计算 $\\alpha$ 和 $\\beta$：\n$$\n\\alpha = \\frac{4000 - 50}{2.0 \\times 10^{5}} = \\frac{3950}{2.0 \\times 10^{5}} = 1.975 \\times 10^{-2}\\,\\mathrm{m}\\,\\mathrm{m}^{-1},\n$$\n$$\n\\beta = \\frac{1.0 - 0.2}{2.0 \\times 10^{5}} = \\frac{0.8}{2.0 \\times 10^{5}} = 4.0 \\times 10^{-6}\\,\\mathrm{(m\\,s^{-1})\\,m^{-1}}.\n$$\n因此，$h(x)$ 和 $u(x)$ 随 $x$ 线性增加。由于对于给定的正值，$\\sqrt{g h(x)}$ 是 $h(x)$ 的单调递增函数，而 $|u(x)|$ 是 $u(x)$ 的单调递增函数，所以分母 $|u(x)| + \\sqrt{g h(x)}$ 随 $x$ 增加，使得 $\\Delta t(x)$ 是 $x$ 的单调递减函数。因此，$\\Delta t(x)$ 的全局最小值出现在右边界 $x = L$ 处。\n\n计算 $x=L$ 处的量：\n$$\nh(L) = h_{0} + \\alpha L = 50 + 1.975 \\times 10^{-2} \\times 2.0 \\times 10^{5} = 50 + 3950 = 4000\\,\\mathrm{m},\n$$\n$$\nu(L) = u_{0} + \\beta L = 0.2 + 4.0 \\times 10^{-6} \\times 2.0 \\times 10^{5} = 0.2 + 0.8 = 1.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\n计算 $x=L$ 处的重力波速度：\n$$\nc(L) = \\sqrt{g\\,h(L)} = \\sqrt{9.81 \\times 4000} = \\sqrt{39240}.\n$$\n高精度计算给出\n$$\n\\sqrt{39240} \\approx 198.09089\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\n因此，最大局部特征速度为\n$$\ns_{\\max}(L) = |u(L)| + c(L) \\approx 1.0 + 198.09089 = 199.09089\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\n那么，全局稳定时间步长为\n$$\n\\Delta t^{\\ast} = C \\,\\frac{\\Delta x}{s_{\\max}(L)} \\approx 0.45 \\times \\frac{2.0 \\times 10^{3}}{199.09089}\\,\\mathrm{s}.\n$$\n计算商值：\n$$\n\\frac{2.0 \\times 10^{3}}{199.09089} \\approx 10.04566\\,\\mathrm{s},\n$$\n所以\n$$\n\\Delta t^{\\ast} \\approx 0.45 \\times 10.04566 \\approx 4.52055\\,\\mathrm{s}.\n$$\n四舍五入到四位有效数字并以秒为单位表示，全局时间步长为\n$$\n\\Delta t^{\\ast} \\approx 4.521\\,\\mathrm{s}.\n$$\n\n就区域内的变化而言，局部时间步长 $\\Delta t(x) = C \\,\\dfrac{\\Delta x}{\\,|u(x)| + \\sqrt{g\\,h(x)}\\,}$ 随 $x$ 减小，因为 $h(x)$ 和 $u(x)$ 都是线性增加的。在大陆架附近（$x \\approx 0$），较小的水深导致较小的重力波速度，从而得到较大的 $\\Delta t(x)$；而在深海方向（$x \\approx L$），大得多的水深产生显著更大的 $\\sqrt{g h}$，从而减小了 $\\Delta t(x)$。因此，最严格的时间步长出现在区域中最深、流速最快的部分，这与上述的单调性分析一致。",
            "answer": "$$\\boxed{4.521}$$"
        },
        {
            "introduction": "一个稳定的模拟不一定就是正确的；代码中的错误可能导致程序稳定地收敛到一个错误的解。本练习将介绍“制造解方法”(Method of Manufactured Solutions, MMS)，这是一种用于代码验证的强大而严谨的技术 。通过为变量（如表面高程 $\\eta$ 和速度 $u$）构建一个预设的“制造”解并反算出相应的源项，您可以系统地检验您的数值实现是否达到了其设计的精度阶数，这是开发可靠科学软件的一项关键技能。",
            "id": "3618014",
            "problem": "考虑用于模拟恒定水深静止状态下海啸波传播的一维线性化深度平均浅水方程。设空间域为 $x \\in [0,L]$，具有周期性边界条件，时间域为 $t \\in [0,T]$。未知量是自由表面高程 $\\eta(x,t)$（单位：米）和深度平均水平速度 $u(x,t)$（单位：米/秒）。控制方程为\n$$\n\\eta_t + h_0 u_x = S_\\eta(x,t), \\qquad u_t + g \\eta_x = S_u(x,t),\n$$\n其中 $h_0$ 是恒定的静水深度（单位：米），$g$ 是重力加速度（单位：米/平方秒），$S_\\eta,S_u$ 是外部规定的源项。该域在 $x$ 方向上是周期的。\n\n使用人造解方法来验证数值实现的理论时空精度阶。具体来说，您必须：\n- 从深度平均层中的质量和动量守恒出发，在恒定深度和静止状态下进行线性化，从而得到上述系统。这是您唯一可以假设的出发点。\n- 选择光滑、空间周期性的人造场 $\\eta(x,t)$ 和 $u(x,t)$，并解析地推导出源项 $S_\\eta(x,t)$ 和 $S_u(x,t)$，使得所选的 $\\eta(x,t)$ 和 $u(x,t)$ 对所有 $x,t$ 都满足该强迫系统。\n- 实现一个求解器，该求解器在空间上使用二阶精确的中心有限差分，在时间上使用二阶强保稳龙格－库塔（SSP-RK2）方法。使用周期性边界条件。为保证稳定性，根据线性波速 $c=\\sqrt{g h_0}$ 使用 Courant–Friedrichs–Lewy 条件来计算时间步长：选择 $\\Delta t = \\text{CFL}\\, \\Delta x/c$，并通过使用整数步数进行调整，以确保在最终时刻 $T$ 恰好结束。\n- 作为一种替代的时间精度验证方法，使用快速傅里叶变换实现一个谱导数算子，从而使空间离散误差可以忽略不计。\n- 作为一种替代的空间精度验证方法，在时间上实现一个经典的四阶龙格－库塔（RK4）方法，并使 $\\Delta t$ 与 $\\Delta x$ 成比例，从而使时间误差与二阶空间误差相比可以忽略不计。\n\n人造解。您必须在长度为 $L$ 的周期域上使用以下光滑人造解：\n$$\n\\phi(x,t) = \\kappa x - \\omega t, \\qquad \\psi(x,t) = 2\\kappa x + \\omega t,\n$$\n$$\n\\eta(x,t) = A \\cos(\\phi(x,t)) + B \\sin(\\psi(x,t)), \\qquad u(x,t) = C \\sin(\\phi(x,t)) + D \\cos(\\psi(x,t)),\n$$\n其中 $A,B$ 的单位为米，$C,D$ 的单位为米/秒，$\\kappa = 2\\pi m/L$（$m$ 为整数波数），$\\omega$ 是角频率，单位为弧度/秒。根据控制方程和这些定义，仅使用微分和代数，以闭合形式解析推导出 $S_\\eta(x,t)$ 和 $S_u(x,t)$。\n\n数值方法。您的实现必须：\n- 将 $x$ 均匀离散为 $N$ 个点，$\\Delta x = L/N$，并采用周期性边界条件。\n- 对于组合时空测试，使用二阶中心差分计算 $f_x$：$f_x[i] \\approx \\left(f[i+1]-f[i-1]\\right)/(2\\Delta x)$。\n- 对于时间阶测试，使用谱导数 $f_x = \\mathcal{F}^{-1}\\{ i k \\,\\mathcal{F}\\{f\\}\\}$（其中 $k$ 是与周期域匹配的傅里叶波数）。\n- 对于组合测试和时间测试，使用 SSP-RK2 进行时间推进；对于纯空间阶测试，使用经典的四阶龙格－库塔方法，并设置 $\\Delta t = C_t \\Delta x/c$（$C_t$ 为常数）。\n\n验证方案。对于每个测试，计算最终时刻 $t=T$ 的相对均方根误差：\n$$\nE = \\frac{\\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[\\left(\\eta_i^{\\text{num}}-\\eta(x_i,T)\\right)^2 + \\left(u_i^{\\text{num}}-u(x_i,T)\\right)^2\\right]}}{\\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[\\eta(x_i,T)^2 + u(x_i,T)^2\\right]}}.\n$$\n使用二倍因子变化的细化研究来估计观测到的收敛阶，如下所示。给定使用分辨率 $(\\Delta x_1,\\Delta t_1)$ 和 $(\\Delta x_2,\\Delta t_2)$（其中 $\\Delta x_2 = \\Delta x_1/2$ 且 $\\Delta t_2 = \\Delta t_1/2$，或对于时间测试仅将 $\\Delta t$ 减半）计算出的误差 $E_1$ 和 $E_2$，计算观测阶\n$$\np = \\log_2\\left(\\frac{E_1}{E_2}\\right).\n$$\n\n物理常数和参数。使用 $g = 9.81$ 米/平方秒，$h_0 = 4000$ 米，$L = 100000$ 米，$m = 3$，$A = 0.5$ 米，$B = 0.3$ 米，$C = 0.2$ 米/秒，$D = 0.15$ 米/秒，以及 $\\omega = 0.01$ 弧度/秒。初始条件必须根据 $t=0$ 时的人造解设置，并且源项必须在所选龙格－库塔方法的每个阶段进行时间上的一致性评估。\n\n测试套件。运行以下三个验证测试：\n- 测试 $1$（使用 SSP-RK2 和二阶中心差分的组合时空阶）：使用 $N \\in \\{64, 128, 256\\}$，$\\text{CFL} = 0.2$，$T = 100$ 秒。使用两个最精细的网格 $N=128$ 和 $N=256$ 估计并报告 $p_{\\text{combined}}$。\n- 测试 $2$（使用 SSP-RK2 和谱导数的时间阶）：使用 $N = 256$，$T = 100$ 秒，以及两个时间步数 $M \\in \\{250, 500\\}$，使得 $\\Delta t = T/M$ 且 $\\Delta t_2 = \\Delta t_1/2$；估计并报告 $p_{\\text{time}}$。\n- 测试 $3$（使用二阶中心差分和 RK4 时间积分的空间阶）：使用 $N \\in \\{64, 128, 256\\}$，$T = 100$ 秒，以及 $\\Delta t = C_t \\Delta x/c$（其中 $C_t = 0.1$）；使用两个最精细的网格估计并报告 $p_{\\text{space}}$。\n\n最终输出格式。您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果，顺序为 $[p_{\\text{combined}},p_{\\text{time}},p_{\\text{space}}]$。每个值必须是四舍五入到三位小数的浮点数，不带任何附加文本。三角函数中使用的所有角度均为弧度。所有长度必须以米为单位，时间以秒为单位。将最终输出表示为四舍五入到三位小数的无量纲收敛阶。确保程序完全自包含，无需任何输入。",
            "solution": "该问题为线性化浅水方程数值格式的验证研究提供了一个完整且适定的描述。它在科学上是合理的，包含了所有必要的参数，并概述了基于人造解方法的清晰流程。因此，该问题被认为是有效的。\n\n求解过程包括三个主要阶段：\n1.  为实现人造解方法而进行的源项解析推导。\n2.  数值求解器的实现，包括空间离散化和时间积分格式。\n3.  执行指定的数值实验以测量收敛阶。\n\n### 1. 源项的解析推导\n\n控制方程是在周期域 $x \\in [0,L]$ 上的一维线性化浅水方程：\n$$\n\\eta_t + h_0 u_x = S_\\eta(x,t)\n$$\n$$\nu_t + g \\eta_x = S_u(x,t)\n$$\n这里，$\\eta(x,t)$ 是自由表面高程，$u(x,t)$ 是深度平均速度，$h_0$ 是恒定水深，$g$ 是重力加速度，$S_\\eta, S_u$ 是待定的源项。\n\n问题指定了以下人造解：\n$$\n\\eta(x,t) = A \\cos(\\kappa x - \\omega t) + B \\sin(2\\kappa x + \\omega t)\n$$\n$$\nu(x,t) = C \\sin(\\kappa x - \\omega t) + D \\cos(2\\kappa x + \\omega t)\n$$\n其中 $\\phi(x,t) = \\kappa x - \\omega t$ 和 $\\psi(x,t) = 2\\kappa x + \\omega t$。为了找到使这些表达式成为精确解的源项 $S_\\eta$ 和 $S_u$，我们首先计算 $\\eta$ 和 $u$ 所需的偏导数。\n\n关于时间 $t$ 的偏导数是：\n$$\n\\eta_t = \\frac{\\partial}{\\partial t} [A \\cos(\\phi) + B \\sin(\\psi)] = A(-\\sin(\\phi))(-\\omega) + B(\\cos(\\psi))(\\omega) = A\\omega \\sin(\\phi) + B\\omega \\cos(\\psi)\n$$\n$$\nu_t = \\frac{\\partial}{\\partial t} [C \\sin(\\phi) + D \\cos(\\psi)] = C(\\cos(\\phi))(-\\omega) + D(-\\sin(\\psi))(\\omega) = -C\\omega \\cos(\\phi) - D\\omega \\sin(\\psi)\n$$\n\n关于空间 $x$ 的偏导数是：\n$$\n\\eta_x = \\frac{\\partial}{\\partial x} [A \\cos(\\phi) + B \\sin(\\psi)] = A(-\\sin(\\phi))(\\kappa) + B(\\cos(\\psi))(2\\kappa) = -A\\kappa \\sin(\\phi) + 2B\\kappa \\cos(\\psi)\n$$\n$$\nu_x = \\frac{\\partial}{\\partial x} [C \\sin(\\phi) + D \\cos(\\psi)] = C(\\cos(\\phi))(\\kappa) + D(-\\sin(\\psi))(2\\kappa) = C\\kappa \\cos(\\phi) - 2D\\kappa \\sin(\\psi)\n$$\n\n将这些导数代入控制方程，可以求解源项：\n$$\nS_\\eta(x,t) = \\eta_t + h_0 u_x = (A\\omega \\sin(\\phi) + B\\omega \\cos(\\psi)) + h_0(C\\kappa \\cos(\\phi) - 2D\\kappa \\sin(\\psi))\n$$\n$$\nS_u(x,t) = u_t + g \\eta_x = (-C\\omega \\cos(\\phi) - D\\omega \\sin(\\psi)) + g(-A\\kappa \\sin(\\phi) + 2B\\kappa \\cos(\\psi))\n$$\n整理这些表达式，得到将在数值代码中实现的源项的最终解析形式：\n$$\nS_\\eta(x,t) = A\\omega \\sin(\\kappa x - \\omega t) + h_0 C\\kappa \\cos(\\kappa x - \\omega t) + B\\omega \\cos(2\\kappa x + \\omega t) - 2h_0 D\\kappa \\sin(2\\kappa x + \\omega t)\n$$\n$$\nS_u(x,t) = -gA\\kappa \\sin(\\kappa x - \\omega t) - C\\omega \\cos(\\kappa x - \\omega t) + 2gB\\kappa \\cos(2\\kappa x + \\omega t) - D\\omega \\sin(2\\kappa x + \\omega t)\n$$\n\n### 2. 数值离散\n\n空间域 $x \\in [0,L]$ 被离散为 $N$ 个点 $x_i = i\\Delta x$，$i=0, 1, ..., N-1$，网格间距为 $\\Delta x = L/N$。在任何时刻 $t$，系统的状态由向量 $\\mathbf{U}(t) = [\\eta_0, \\dots, \\eta_{N-1}, u_0, \\dots, u_{N-1}]^T$ 表示。控制方程被重写为常微分方程组（ODEs）：\n$$\n\\frac{d\\mathbf{U}}{dt} = \\mathbf{F}(t, \\mathbf{U}) = \\begin{pmatrix} -h_0 (\\boldsymbol{\\eta}_d)_x + \\mathbf{S}_\\eta(t) \\\\ -g (\\boldsymbol{u}_d)_x + \\mathbf{S}_u(t) \\end{pmatrix}\n$$\n其中 $(\\cdot)_x$ 表示空间导数算子，$\\mathbf{S}_\\eta, \\mathbf{S}_u$ 是在网格点上计算的源项。需要两种不同的空间导数算子。\n\n**二阶中心差分**：对于网格上的周期函数 $f$，在点 $x_i$ 处的导数近似为：\n$$\nf_x(x_i) \\approx \\frac{f_{i+1} - f_{i-1}}{2\\Delta x}\n$$\n其中索引对 $N$ 取模以强制周期性。该方法的精度为二阶，即误差为 $O(\\Delta x^2)$。\n\n**谱导数**：为了实现高空间精度，采用基于快速傅里叶变换（FFT）的谱方法。导数在傅里叶空间中计算：\n$$\nf_x(x) = \\mathcal{F}^{-1}\\{ i k \\,\\mathcal{F}\\{f(x)\\}\\}\n$$\n其中 $\\mathcal{F}$ 是 FFT，$\\mathcal{F}^{-1}$ 是逆 FFT，$i = \\sqrt{-1}$，$k$ 是与离散域对应的波数向量。对于光滑函数，该方法是谱精确的，意味着其误差比 $\\Delta x$ 的任何幂次下降得都快。\n\n### 3. 时间积分\n\n该常微分方程组使用两种指定的龙格－库塔方法之一在时间上进行推进。\n\n**SSP-RK2**：二阶强保稳龙格－库塔方法（也称为 Heun 方法）用于组合时空测试和纯时间测试。对于一个常微分方程 $y' = f(t,y)$，从 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的一个时间步长为：\n1. $\\mathbf{U}^{(1)} = \\mathbf{U}_n + \\Delta t \\mathbf{F}(t_n, \\mathbf{U}_n)$\n2. $\\mathbf{U}_{n+1} = \\frac{1}{2}\\mathbf{U}_n + \\frac{1}{2}(\\mathbf{U}^{(1)} + \\Delta t \\mathbf{F}(t_{n+1}, \\mathbf{U}^{(1)}))$\n该方法在时间上是二阶精确的，误差为 $O(\\Delta t^2)$。\n\n**RK4**：经典的四阶龙格－库塔方法用于空间精度测试，以确保时间误差与二阶空间误差相比可以忽略不计。对于 $y' = f(t,y)$，一个步长为：\n1. $k_1 = \\mathbf{F}(t_n, \\mathbf{U}_n)$\n2. $k_2 = \\mathbf{F}(t_n + \\Delta t/2, \\mathbf{U}_n + \\Delta t/2 \\cdot k_1)$\n3. $k_3 = \\mathbf{F}(t_n + \\Delta t/2, \\mathbf{U}_n + \\Delta t/2 \\cdot k_2)$\n4. $k_4 = \\mathbf{F}(t_n + \\Delta t, \\mathbf{U}_n + \\Delta t \\cdot k_3)$\n5. $\\mathbf{U}_{n+1} = \\mathbf{U}_n + \\frac{\\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4)$\n该方法的时间误差为 $O(\\Delta t^4)$。\n\n### 4. 验证方案\n\n对于每个测试，数值模拟使用 $t=0$ 时的人造解进行初始化，并运行到最终时刻 $T$。误差使用相对均方根范数计算：\n$$\nE = \\frac{\\sqrt{\\sum_{i=0}^{N-1}\\left[(\\eta_i^{\\text{num}}-\\eta(x_i,T))^2 + (u_i^{\\text{num}}-u(x_i,T))^2\\right]}}{\\sqrt{\\sum_{i=0}^{N-1}\\left[\\eta(x_i,T)^2 + u(x_i,T)^2\\right]}}\n$$\n观测到的收敛阶 $p$ 是根据对应于两种不同分辨率（例如 $\\Delta x_1$ 和 $\\Delta x_2 = \\Delta x_1/2$）的误差 $E_1$ 和 $E_2$ 使用以下公式估算的：\n$$\np = \\log_2\\left(\\frac{E_1}{E_2}\\right)\n$$\n\n三个必需的测试是：\n-   **测试 1（组合时空阶）**：使用二阶中心差分格式和 SSP-RK$2$ 时间积分器。时间步长 $\\Delta t$ 通过一个固定的 CFL 数与网格间距 $\\Delta x$ 耦合。由于空间和时间方法都是二阶的，预期的收敛阶为 $p_{\\text{combined}} \\approx 2$。\n-   **测试 2（时间阶）**：使用高精度的谱导数以使空间离散误差可以忽略不计。时间上使用 SSP-RK$2$ 推进。该测试在固定的空间网格上使用两种不同的时间步长运行。预期的收敛阶为 $p_{\\text{time}} \\approx 2$，与 SSP-RK$2$ 积分器的阶数相匹配。\n-   **测试 3（空间阶）**：使用二阶中心差分格式和高阶 RK$4$ 时间积分器。时间步长选择为与 $\\Delta x$ 成正比，使得四阶时间误差 $O(\\Delta t^4) \\propto O(\\Delta x^4)$ 远小于二阶空间误差 $O(\\Delta x^2)$。预期的收敛阶为 $p_{\\text{space}} \\approx 2$，与中心差分格式的阶数相匹配。",
            "answer": "[1.996,1.999,1.996]"
        },
        {
            "introduction": "在验证了代码的正确性之后，下一个挑战是评估其底层物理模型在多大程度上能代表真实情况。本练习旨在探讨模型偏差和“反演犯罪”(inverse crime)等高级概念 。您将使用一个物理上更完备的模型（例如Boussinesq模型）生成合成的表面高程数据 $\\eta_{\\text{true}}$，然后使用一个更简单的模型（例如浅水方程 SWE）对这些数据进行反演，并量化两者间不可避免的失配。这个过程将揭示代码错误与模型内在局限性之间的关键区别，这在真实世界的源反演和数据同化中是至关重要的考量。",
            "id": "3618072",
            "problem": "您的任务是设计并实现一个程序，通过避免“反演犯罪”（inverse crime）来量化海啸波传播中的建模偏差。具体来说，您必须使用弱色散的Boussinesq模型生成合成的海面高程数据，并使用线性化浅水方程（SWE）反演初始海面位移，然后计算跨多个观测站的总失配范数。\n\n该问题的基本原理如下。对于恒定深度下的线性长波，线性化浅水方程（SWE）可简化为自由面高程$\\,\\eta(x,t)\\,$的一维波动方程：\n$$\n\\eta_{tt}(x,t) \\;=\\; c^2\\,\\eta_{xx}(x,t),\n$$\n其中 $c = \\sqrt{g h}$ 是非色散相速度，$g$ 是重力加速度，$h$ 是均匀水深。对于周期性域和零初始速度，所有空间傅里叶模式的演化如下：\n$$\n\\eta_k(x,t) \\;=\\; \\left[A_k \\cos(k x) + B_k \\sin(k x)\\right] \\cos\\!\\left(c\\,|k|\\,t\\right),\n$$\n其中 $A_k$ 和 $B_k$ 是初始位移 $\\eta_0(x) = \\eta(x,0)$ 的傅里叶余弦和正弦系数，$k$ 是角波数。\n\n对于弱色散的Boussinesq模型，一个常用的线性色散关系通过降低较高波数的角频率来修正SWE。在本问题中，Boussinesq角频率定义为：\n$$\n\\omega_{\\mathrm{B}}^2(k) \\;=\\; \\frac{g h\\,k^2}{1 + \\frac{1}{3} h^2 k^2},\n$$\n这意味着\n$$\n\\omega_{\\mathrm{B}}(k) \\;=\\; \\frac{c\\,|k|}{\\sqrt{1 + \\frac{1}{3} h^2 k^2}}.\n$$\n在零初始速度下，Boussinesq模型的时间演化为：\n$$\n\\eta^{\\mathrm{true}}(x,t) \\;=\\; \\sum_{k} \\hat{\\eta}_0(k)\\,\\cos\\!\\left(\\omega_{\\mathrm{B}}(k)\\,t\\right)\\,e^{i k x},\n$$\n其中 $\\hat{\\eta}_0(k)$ 是周期性域中真实初始位移 $\\eta_0(x)$ 的复傅里叶系数。\n\n您的程序必须按以下步骤进行：\n\n1. 域和初始条件。\n   - 考虑一个长度为 $L$ 的一维周期性域，用 $N$ 个均匀间隔的点进行离散。使用由离散傅里叶变换约定给出的整数 $n$ 对应的角波数 $k_n = 2\\pi n/L$。\n   - 构建一个物理上合理的初始海面位移 $\\eta_0(x)$，作为两个高斯包的叠加：\n     $$\n     \\eta_0(x) \\;=\\; A_1 \\exp\\!\\left(-\\frac{(x-x_1)^2}{2\\,\\sigma_1^2}\\right) \\;+\\; A_2 \\exp\\!\\left(-\\frac{(x-x_2)^2}{2\\,\\sigma_2^2}\\right),\n     $$\n     其中 $A_1$ 和 $A_2$ 是振幅（单位：米），$x_1$ 和 $x_2$ 是中心位置（单位：米），$\\sigma_1$ 和 $\\sigma_2$ 是标准差（单位：米）。\n\n2. 使用Boussinesq模型生成数据。\n   - 定义 $S$ 个与网格点对齐的观测站位置 $\\{x_s\\}_{s=1}^S$ 和一个时间步长为 $\\Delta t$ 的均匀时间网格 $\\{t_n\\}_{n=0}^{M-1}$。\n   - 通过使用上述给出的Boussinesq色散关系演化初始条件，在观测站生成合成的“真实”海面高程时间序列 $\\eta^{\\mathrm{true}}(x_s,t_n)$。使用离散傅里叶变换来实现随时间变化的周期性谱演化。\n\n3. 使用浅水方程（SWE）进行反演。\n   - 反演合成数据，以使用线性化SWE模型估计一个带限的初始位移。将估计的初始位移参数化为一个截断至波数指数 $K_{\\max}$ 的实傅里叶级数：\n     $$\n     \\eta_0^{\\mathrm{inv}}(x) \\;=\\; a_0 \\;+\\; \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\!\\left(\\frac{2\\pi k}{L} x\\right) + b_k \\sin\\!\\left(\\frac{2\\pi k}{L} x\\right)\\right],\n     $$\n     其中 $\\{a_0, a_k, b_k\\}$ 是未知的实系数。\n   - 在SWE模型和零初始速度下，预测的观测站时间序列为：\n     $$\n     \\eta^{\\mathrm{SWE}}(x_s,t_n) \\;=\\; a_0 \\;+\\; \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\!\\left(\\frac{2\\pi k}{L} x_s\\right) + b_k \\sin\\!\\left(\\frac{2\\pi k}{L} x_s\\right)\\right] \\cos\\!\\left(c\\,\\frac{2\\pi k}{L}\\,t_n\\right).\n     $$\n   - 将所有观测站-时间对收集到一个线性最小二乘系统中，并求解系数 $\\{a_0, a_k, b_k\\}$，以最小化 $\\eta^{\\mathrm{SWE}}(x_s,t_n)$ 和 $\\eta^{\\mathrm{true}}(x_s,t_n)$ 之间的平方差之和。\n\n4. 偏差量化。\n   - 将跨观测站和时间的总体偏差范数定义为均方根（RMS）差：\n     $$\n     \\|\\eta_{\\mathrm{true}} - \\eta_{\\mathrm{inv}}\\| \\;=\\; \\sqrt{\\frac{1}{S\\,M}\\sum_{s=1}^S \\sum_{n=0}^{M-1} \\left[\\eta^{\\mathrm{true}}(x_s,t_n) - \\eta^{\\mathrm{SWE}}(x_s,t_n)\\right]^2 }.\n     $$\n   - 以米为单位，将偏差范数表示为一个浮点数。\n\n您的程序应实现上述步骤，并为以下三个测试用例评估偏差范数。每个测试用例包含有物理意义的参数，这些参数改变了色散程度和反演子空间，以测试问题的不同方面。\n\n测试套件：\n- 情况1（基准，带宽充足）：\n  - $L = 200{,}000$ 米, $N = 1024$。\n  - $h = 4{,}000$ 米, $g = 9.81$ 米/秒^2。\n  - 初始条件：$A_1 = 1.0$ 米, $x_1 = 50{,}000$ 米, $\\sigma_1 = 5{,}000$ 米；$A_2 = 0.5$ 米, $x_2 = 150{,}000$ 米, $\\sigma_2 = 8{,}000$ 米。\n  - 观测站：$S = 5$ 个，位于 $x_s \\in \\{20{,}000, 60{,}000, 100{,}000, 140{,}000, 180{,}000\\}$ 米。\n  - 时间网格：$M = 256$, $\\Delta t = 2.0$ 秒。\n  - 截断：$K_{\\max} = 16$。\n\n- 情况2（参数不足的反演子空间）：\n  - 与情况1相同，除了 $K_{\\max} = 4$。\n\n- 情况3（更窄的源，更深的水，更多的样本）：\n  - $L = 200{,}000$ 米, $N = 2048$。\n  - $h = 6{,}000$ 米, $g = 9.81$ 米/秒^2。\n  - 初始条件：$A_1 = 1.0$ 米, $x_1 = 50{,}000$ 米, $\\sigma_1 = 2{,}000$ 米；$A_2 = 0.6$ 米, $x_2 = 150{,}000$ 米, $\\sigma_2 = 3{,}000$ 米。\n  - 观测站：$S = 6$ 个，位于 $x_s \\in \\{20{,}000, 50{,}000, 80{,}000, 110{,}000, 140{,}000, 170{,}000\\}$ 米。\n  - 时间网格：$M = 400$, $\\Delta t = 1.5$ 秒。\n  - 截断：$K_{\\max} = 24$。\n\n最终输出格式：\n- 您的程序应生成一行输出，包含三个偏差范数，均以米为单位，形式为用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3]”），每个结果表示为浮点数。不应打印任何额外文本。\n\n所有物理量必须使用其正确的国际单位制（SI单位）处理。三角函数中的所有角度均为弧度。偏差范数必须以米为单位报告。",
            "solution": "该问题要求量化在反演合成海啸数据时产生的建模偏差。数据是使用物理上更复杂、弱色散的Boussinesq模型生成的，而反演是使用更简单、非色散的线性化浅水方程（SWE）模型进行的。这个过程避免了“反演犯罪”（即使用相同的模型生成数据和进行反演），从而提供了一种衡量较简单反演模型固有系统误差（即偏差）的方法。解决方案是通过对每个测试用例执行一个四步过程来实现的。\n\n### 1. 合成数据生成：Boussinesq正演模型\n\n第一步是生成合成的“真实”海面高程数据 $\\eta^{\\mathrm{true}}(x, t)$。这是通过对给定的初始海面位移 $\\eta_0(x)$ 数值求解Boussinesq模型方程来实现的。\n\n问题定义在一个长度为 $L$ 的一维周期性域上，该域被离散为 $N$ 个网格点 $x_j = j L/N$，其中 $j = 0, 1, \\dots, N-1$。初始条件 $\\eta_0(x)$ 由两个高斯函数的叠加给出：\n$$\n\\eta_0(x) = A_1 \\exp\\left(-\\frac{(x-x_1)^2}{2\\sigma_1^2}\\right) + A_2 \\exp\\left(-\\frac{(x-x_2)^2}{2\\sigma_2^2}\\right)\n$$\n波场的演化在谱域中使用离散傅里叶变换（DFT）计算效率最高。首先，计算初始条件 $\\eta_0(x_j)$ 的复傅里叶系数 $\\hat{\\eta}_0(k_n)$：\n$$\n\\hat{\\eta}_0(k_n) = \\mathcal{F}[\\eta_0(x)]\n$$\n其中 $\\mathcal{F}$ 表示DFT，而 $k_n = 2\\pi n/L$ 是与离散网格对应的角波数。\n\nBoussinesq模型的特点是其色散关系，该关系将角频率 $\\omega_{\\mathrm{B}}$ 与波数 $k$ 联系起来：\n$$\n\\omega_{\\mathrm{B}}(k) = \\frac{c|k|}{\\sqrt{1 + \\frac{1}{3}h^2 k^2}}\n$$\n其中 $c = \\sqrt{gh}$ 是浅水波速，$g$ 是重力加速度，$h$ 是水深。对于零初始速度场，每个傅里叶模式随时间的演化为 $\\cos(\\omega_{\\mathrm{B}}(k)t)$。因此，在时间 $t$ 的傅里叶系数由以下公式给出：\n$$\n\\hat{\\eta}(k, t) = \\hat{\\eta}_0(k) \\cos(\\omega_{\\mathrm{B}}(k)t)\n$$\n然后通过应用逆DFT恢复物理空间中的海面高程 $\\eta(x, t)$：\n$$\n\\eta^{\\mathrm{true}}(x, t) = \\mathcal{F}^{-1}[\\hat{\\eta}(k, t)]\n$$\n此计算针对指定时间网格 $\\{t_n\\}_{n=0}^{M-1}$ 中的每个时间步 $t_n$ 执行。然后，在指定的观测站位置 $\\{x_s\\}_{s=1}^S$ 对所得波场进行采样，以生成合成时间序列数据，我们将其表示为长度为 $S \\times M$ 的数据向量 $\\mathbf{d}$。\n\n### 2. 初始条件反演：SWE反演模型\n\n第二步是使用生成的数据 $\\mathbf{d}$ 来推断初始海面位移，但这次使用更简单的线性化SWE模型。初始位移由一个具有 $1 + 2K_{\\max}$ 个未知系数的截断实傅里叶级数参数化，系数向量为 $\\mathbf{m} = [a_0, a_1, b_1, \\dots, a_{K_{\\max}}, b_{K_{\\max}}]^T$：\n$$\n\\eta_0^{\\mathrm{inv}}(x) = a_0 + \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\left(\\frac{2\\pi k}{L} x\\right) + b_k \\sin\\left(\\frac{2\\pi k}{L} x\\right)\\right]\n$$\n在SWE模型下，色散关系是非色散的：$\\omega_{\\mathrm{SWE}}(k) = c|k|$。参数化初始条件在观测站位置 $x_s$ 和时间 $t_n$ 的时间演化为：\n$$\n\\eta^{\\mathrm{SWE}}(x_s, t_n) = a_0 + \\sum_{j=1}^{K_{\\max}} \\left[ a_j \\cos\\left(k_j x_s\\right) + b_j \\sin\\left(k_j x_s\\right) \\right] \\cos\\left(c k_j t_n\\right)\n$$\n其中 $k_j = 2\\pi j/L$。该方程建立了所有观测站-时间对的预测数据 $\\mathbf{d}_{\\mathrm{pred}}$ 与未知模型系数 $\\mathbf{m}$ 之间的线性关系：\n$$\n\\mathbf{d}_{\\mathrm{pred}} = \\mathbf{G}\\mathbf{m}\n$$\n这里，$\\mathbf{G}$ 是大小为 $(S \\times M) \\times (1 + 2K_{\\max})$ 的设计矩阵（或正演算子）。$\\mathbf{G}$ 的每一行对应一个特定的观测站-时间对 $(x_s, t_n)$，其条目是在该对上评估的基函数。具体来说，对于对应于 $(x_s, t_n)$ 的行：\n- 第一列（对应系数 $a_0$）为 $1$。\n- 对于 $j=1, \\dots, K_{\\max}$，对应 $a_j$ 的列为 $\\cos(k_j x_s) \\cos(c k_j t_n)$。\n- 对于 $j=1, \\dots, K_{\\max}$，对应 $b_j$ 的列为 $\\sin(k_j x_s) \\cos(c k_j t_n)$。\n\n### 3. 求解线性系统\n\n反演问题在于找到最能拟合合成数据 $\\mathbf{d}$ 的模型向量 $\\mathbf{m}$。这被表述为一个线性最小二乘问题：\n$$\n\\min_{\\mathbf{m}} \\|\\mathbf{G}\\mathbf{m} - \\mathbf{d}\\|_2^2\n$$\n其中 $\\|\\cdot\\|_2$ 是欧几里得范数。对于给定的测试用例，系统是超定的（$S \\times M > 1 + 2K_{\\max}$），确保了稳定且唯一的解。解 $\\mathbf{m}_{\\mathrm{inv}}$ 使用标准的数值线性代数例程（如`numpy.linalg.lstsq`提供的例程）找到。\n\n### 4. 量化建模偏差\n\n建模偏差是“真实”数据与来自更简单模型的最佳拟合数据之间的差异。由反演系数预测的数据为 $\\mathbf{d}_{\\mathrm{inv}} = \\mathbf{G}\\mathbf{m}_{\\mathrm{inv}}$。失配由残差 $r_i = d_i - d_{\\mathrm{inv},i}$ 的均方根（RMS）量化：\n$$\n\\|\\eta_{\\mathrm{true}} - \\eta_{\\mathrm{inv}}\\| = \\sqrt{\\frac{1}{S M} \\sum_{i=1}^{S \\times M} (d_i - d_{\\mathrm{inv},i})^2}\n$$\n该量是残差平方均值的平方根。残差平方和 $\\sum r_i^2$ 是 `numpy.linalg.lstsq` 函数的直接输出，这使得能够高效地计算最终的偏差范数（以米为单位）。对提供的三个测试用例中的每一个都重复整个过程。",
            "answer": "[0.0008543781523455953,0.01083907799333333,0.003920392348589098]"
        }
    ]
}