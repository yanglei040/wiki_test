## 引言
[全波形反演](@entry_id:749622)（Full-Waveform Inversion, FWI）作为一种先进的[地震成像](@entry_id:273056)技术，旨在利用[地震波](@entry_id:164985)形中的全部信息（包括振幅与相位），以前所未有的分辨率构建高精度的地下介质模型。然而，其核心是一个涉及数百万甚至数十亿模型参数的大规模[非线性优化](@entry_id:143978)问题。这一挑战的核心难点在于如何高效地计算目标函数关于海量模型参数的梯度，传统方法（如有限差分）的计算成本高到无法接受。本文正是为了解决这一关键的知识缺口，系统性地阐述了基于伴随状态法（Adjoint-State Method）的FWI框架，这是实现FWI从理论走向现实应用的最重要基石。

通过本文的学习，您将深入理解伴随法FWI的完整工作流程。在“原理与机制”一章中，我们将从[波动方程](@entry_id:139839)的正演模拟出发，建立从模型到数据的映射，并详细推导伴随状态法如何通过一次额外的反向传播模拟来优雅且高效地获得梯度。随后，在“应用与交叉学科联系”一章中，我们将探讨如何将这一核心机制应用于处理真实世界的复杂情况，包括设计更鲁棒的目标函数以克服周波跳跃、扩展到粘声和各向异性等[复杂介质](@entry_id:164088)，以及与高性能计算和[不确定性量化](@entry_id:138597)等领域的深刻联系。最后，“动手实践”部分将提供具体的编程练习，帮助您验证和巩固关于[算法稳定性](@entry_id:147637)和实现正确性的关键概念。

## 原理与机制

[全波形反演](@entry_id:749622)（Full-Waveform Inversion, FWI）的核心是一个基于物理[波动方程](@entry_id:139839)的复杂[非线性优化](@entry_id:143978)问题。本章旨在深入剖析支撑FWI的数学物理原理与核心计算机制。我们将从正演模拟出发，构建从地下介质模型到地震数据的映射关系；随后，我们将探讨如何量化模拟数据与观测数据之间的差异，并分析其中最具挑战性的问题之一——周波跳跃；最后，我们将详细推导伴随状态法，揭示其高效计算梯度的内在机理，并讨论其物理诠释、离散实现、[正则化方法](@entry_id:150559)以及在不同计算域中的策略。

### 正演问题：波场模拟

正演模拟是FWI的基石，它通过数值求解波动方程来预测在给定地下介质模型中的波场传播过程。

#### [声波方程](@entry_id:746230)

在地球物理勘探中，[声波方程](@entry_id:746230)是描述压力波（[P波](@entry_id:178440)）在流体或类流体介质中传播的有效近似。其最简形式是常密度[声波方程](@entry_id:746230)。该方程可以从[流体动力学](@entry_id:136788)的第一性原理——连续介质的动量守恒定律和线性[本构关系](@entry_id:186508)——推导得出。假设介质密度 $\rho$ 为常数，且其为无粘、各向同性的流体，那么[质点](@entry_id:186768)位移 $\boldsymbol{\xi}$ 与压力扰动 $p$ 之间的关系可以线性化。通过消去[位移场](@entry_id:141476) $\boldsymbol{\xi}$，我们可以得到一个只包含压[力场](@entry_id:147325) $p(\mathbf{x},t)$ 或位移[势场](@entry_id:143025) $u(\mathbf{x},t)$ 的[二阶偏微分方程](@entry_id:175326) 。

若以 $u(\mathbf{x},t)$ 代表声学[标量场](@entry_id:151443)（如压力），$v(\mathbf{x})$ 代表压缩波速度，$s(\mathbf{x},t)$ 代表震[源项](@entry_id:269111)，该方程可写作：
$$
m(\mathbf{x})\frac{\partial^2 u(\mathbf{x},t)}{\partial t^2} - \nabla^2 u(\mathbf{x},t) = s(\mathbf{x},t)
$$
其中，$m(\mathbf{x}) = 1/v(\mathbf{x})^2$ 是空间变化的**平方慢度**（slowness-squared），它是FWI中常见的反演参数。在这个方程中：
-   $m(\mathbf{x})\partial_{tt} u$ 项代表介质的惯性响应，其大小由介质的压缩性（通过平方慢度 $m$ 体现）调节。它源于[牛顿第二定律](@entry_id:274217)中物质的加速度项。
-   $-\nabla^2 u$ 项（拉普拉斯算子）代表空间压力[梯度的散度](@entry_id:270716)，物理上对应于驱动波传播的恢复力。当波场在空间上出现弯曲（即 $\nabla^2 u \neq 0$）时，意味着存在压力不平衡，从而产生恢复力使质点运动。
-   $s(\mathbf{x},t)$ 项是震[源项](@entry_id:269111)，描述了在特定位置和时间注入或抽取声学能量的过程。

此常密度声波模型在许多场景下是有效的，尤其是在海洋地震勘探中。其核心假设是介质的密度变化远小于其[体积模量](@entry_id:160069)的变化，因此密度对散射的贡献可以忽略。然而，当密度与速度对波场有同等重要的影响时，需要采用更复杂的变密度[声波方程](@entry_id:746230) ：
$$
\frac{1}{\kappa(\mathbf{x})} \frac{\partial^2 p(\mathbf{x},t)}{\partial t^2} - \nabla \cdot \left( \frac{1}{\rho(\mathbf{x})} \nabla p(\mathbf{x},t) \right) = s(\mathbf{x},t)
$$
这里，$p$ 是压[力场](@entry_id:147325)，反演参数变为两个：[体积模量](@entry_id:160069) $\kappa(\mathbf{x})$ 和密度 $\rho(\mathbf{x})$。此时，[压缩波](@entry_id:747596)速度 $v$ 是一个导出量，$v(\mathbf{x}) = \sqrt{\kappa(\mathbf{x})/\rho(\mathbf{x})}$。该方程更准确地描述了波在密度变化的介质中的传播与散射。

#### 从模型到数据：正演算子

正演过程在数学上可以被抽象为一个算子，它将模型空间中的一个模型 $m$ 映射到数据空间中的一组模拟数据 $d_{\text{syn}}$。这一过程可分解为两个步骤 。

首先，对于给定的模型参数 $m$ 和震源 $f$，[波动方程](@entry_id:139839) $A(m)u = f$ 的解给出了在整个时空域内的波场 $u(\mathbf{x},t)$。这里，$A(m)$ 是波动方程的微分算子。假设问题是适定的（well-posed），那么存在一个解算子 $A(m)^{-1}$，它将震源映射到波场：
$$
u(m) = A(m)^{-1} f
$$
其次，地震检波器在特定的空间位置 $\mathbf{x}_i$ 记录波场的时间序列。这个测量过程可以用一个**检波器采样算子** $R$ 来描述。在连续介质的理想情况下，一个点检波器在 $\mathbf{x}_i$ 处的采样可以表示为狄拉克 $\delta$ 函数的作用：
$$
d_i(t) = u(\mathbf{x}_i, t) = \int_{\Omega} \delta(\mathbf{x} - \mathbf{x}_i) u(\mathbf{x}, t) d\mathbf{x}
$$
在[数值模拟](@entry_id:137087)中，网格是离散的。如果检波器恰好位于网格节点上，算子 $R$ 就是一个简单的拾取矩阵，从巨大的波场状态向量中选出对应节点的值。如果检波器位于网格之间， $R$ 则会执行一个插值操作，将邻近节点的值加权平均。无论哪种情况，$R$ 都是一个将整个波场向量映射到较小的数据向量的稀疏矩阵。

综上所述，从模型到数据的完整正演算子 $F$ 可以写成两个算子的复合：
$$
d_{\text{syn}} = F(m) = R \, u(m) = R \, A(m)^{-1} f
$$
这个表达式清晰地展示了FWI的核心[非线性](@entry_id:637147)所在：尽管波动方程 $A(m)u = f$ 对于固定的 $m$ 是关于 $u$ 的线性方程，但解 $u(m)$ 以及最终的数据 $d_{\text{syn}}$ 与模型参数 $m$ 之间存在着复杂的非线性关系。

### 反演问题：[目标函数](@entry_id:267263)的构建

反演的目标是找到一个能最好地解释观测数据的地下模型。为此，我们需要一个量化“最好”的标准，即目标函数（或称[代价函数](@entry_id:138681)、 misfit function）。

#### 衡量数据差异

最常用和最直观的目标函数是**最小二乘（least-squares）**或 $L_2$ 范数 misfit。它计算的是模拟数据 $d_{\text{syn}}(m)$ 与观测数据 $d_{\text{obs}}$ 之间差值的平方和：
$$
J(m) = \frac{1}{2} \| d_{\text{syn}}(m) - d_{\text{obs}} \|_2^2 = \frac{1}{2} \| R u(m) - d_{\text{obs}} \|_2^2
$$
这里的因子 $1/2$ 是为了方便求导。$L_2$ 范数 misfit 假设数据中的噪声服从独立同分布的高斯分布。在这种统计假设下，最小化 $L_2$ [范数等价](@entry_id:137561)于寻找最大似然估计模型。由于其简单性和与高斯噪声模型的深刻联系，它成为FWI的标准选择。

#### [局部极小值](@entry_id:143537)挑战：周波跳跃

尽管 $L_2$ 范数 misfit 很常用，但它存在一个致命的缺陷：其非[凸性](@entry_id:138568)导致的**周波跳跃（cycle skipping）**问题。当初始模型与真实模型相差较远时，模拟波形与观测波形之间的相位差可能超过半个周期。

为了直观理解这一点，我们可以考虑一个简化的单频情况 。假设模拟数据和观测数据振[幅相](@entry_id:269870)同，仅存在相位差 $\Delta\phi$。此时，$L_2$ 范数 misfit 正比于 $1 - \cos(\Delta\phi)$。该函数以 $2\pi$ 为周期，其[全局最小值](@entry_id:165977)在 $\Delta\phi = 0$ 处。然而，当初始相位差 $|\Delta\phi|$ 超过 $\pi$ 时，梯度下降等局部优化算法会被“误导”，走向距离更近的[局部极小值](@entry_id:143537)点（例如 $\Delta\phi = \pm 2\pi, \pm 4\pi, \dots$），而不是真正的[全局最小值](@entry_id:165977)。

这个 $|\Delta\phi|  \pi$ 的限制被称为“半波长准则”，它是FWI成功的关键。相位差 $\Delta\phi$ 与频率 $f$ 和走时差 $\Delta T$ 的关系为 $\Delta\phi = 2\pi f \Delta T$。因此，为了避免周波跳跃，我们必须确保：
1.  初始模型的走时误差 $\Delta T$ 足够小。
2.  从低频数据开始反演。因为频率 $f$ 越低，对走时误差 $\Delta T$ 的容忍度越大。

这引出了**频率续进（frequency continuation）**策略：从一个足够低的起始频率 $f_{\text{start}}$ 开始反演，确保初始模型满足半波长准则；然后逐步增加频率，利用前一低频反演得到的速度模型作为下一高频反演的初始模型，从而逐步提高分辨率。

#### 稳健的目标函数

为了缓解周波跳跃和处理非高斯噪声（如勘探数据中常见的异常强振幅干扰），研究人员提出了多种**稳健的目标函数** 。这些函数通过改变对数据残差 $r = d_{\text{syn}} - d_{\text{obs}}$ 的惩罚方式来降低大残差的影响。

-   **Huber 损失**：它是一个[混合函数](@entry_id:746864)。对于小于某个阈值 $\delta$ 的小残差，它采用平方（$L_2$）惩罚；对于大于 $\delta$ 的大残差，它采用线性（$L_1$）惩罚。这种方式既保留了 $L_2$ 对小噪声的平滑特性，又通过线性惩罚限制了大异常值（outliers）的影响。它适用于含有稀疏、强振幅异常值的数据。

-   **[学生t分布](@entry_id:267063)损失**：该[损失函数](@entry_id:634569)源于[学生t分布](@entry_id:267063)的[负对数似然](@entry_id:637801)。它的一个显著特点是，其对残差的[影响函数](@entry_id:168646)（即[损失函数](@entry_id:634569)对残差的导数）在残差趋于无穷大时反而趋于零。这意味着它会极度抑制巨大残差的贡献。在FWI中，由周波跳跃引起的残差通常非常大，[学生t分布](@entry_id:267063)损失能够有效地“忽略”这些被跳过的周期，使反演更专注于运动学（走时）信息的拟合，从而在早期阶段帮助避免陷入[局部极小值](@entry_id:143537)。

选择合适的目标函数对于FWI的成败至关重要，它直接决定了反演问题景观的形态以及对噪声和初始模型误差的敏感性。

### 核心机制：伴随状态法梯度计算

FWI是一个涉及数百万模型参数的[大规模优化](@entry_id:168142)问题。计算[目标函数](@entry_id:267263) $J(m)$ 关于每个模型参数 $m_i$ 的梯度 $\nabla_m J$ 是其中的关键，但也是巨大的计算挑战。如果采用[有限差分法](@entry_id:147158)，每次计算一个参数的梯度就需要一次完整的正演模拟，这对于百万量级的参数是不可接受的。**伴随状态法（Adjoint-State Method, ASM）**提供了一种极为高效的梯度计算方法，其计算成本约等于一次额外的正演模拟，与模型参数的数量无关。

#### 拉格朗日乘子法与伴随状态

伴随状态法的推导可以优雅地通过**[拉格朗日乘子法](@entry_id:176596)**完成 。我们将原始的[带约束优化](@entry_id:635027)问题（最小化 $J(m)$，约束条件为波动方程 $A(m)u=f$）转化为一个无约束的拉格朗日函数 $\mathcal{L}$ 的寻优问题。

以变密度[声波方程](@entry_id:746230)为例，拉格朗日函数定义为：
$$
\mathcal{L}(p, \lambda, \kappa, \rho) = J(p) + \int_{0}^{T} \int_{\Omega} \lambda \left[ \frac{1}{\kappa} \partial_{t}^{2} p - \nabla \cdot \left( \frac{1}{\rho} \nabla p \right) - s \right] d\mathbf{x} \, dt
$$
其中，$p$ 是正演波场（[状态变量](@entry_id:138790)），$\lambda(\mathbf{x},t)$ 是引入的**伴随波场**（或称[拉格朗日乘子](@entry_id:142696)），$\kappa$ 和 $\rho$ 是模型参数。

通过对 $\mathcal{L}$ 求变分并使其在最优解处为零，我们可以推导出三个关键方程：
1.  **状态方程（State Equation）**：$\delta\mathcal{L} / \delta\lambda = 0$ 给出了原始的[波动方程](@entry_id:139839)。
2.  **伴随方程（Adjoint Equation）**：$\delta\mathcal{L} / \delta p = 0$ 给出了一个用于求解伴随波场 $\lambda$ 的方程。这个方程的形式与原始波动方程非常相似，但有一些关键区别：
    -   它的**震源项**（称为**伴随震源**）是由数据残差 $d_{\text{syn}} - d_{\text{obs}}$ 决定的。具体来说，是将数据残差施加在检波器的位置上。
    -   它是一个**末值问题**，而不是[初值问题](@entry_id:144620)。伴随波场在最终时刻 $T$ 的值为零（$\lambda(T)=0, \partial_t\lambda(T)=0$），并从 $T$ **反向传播**到 $0$。

3.  **梯度表达式（Gradient Expression）**：当[状态方程](@entry_id:274378)和伴随方程都满足时，目标函数对模型参数的梯度可以直接通过对拉格朗日函数求偏导得到。例如，对体积模量 $\kappa$ 和密度 $\rho$ 的梯度分别为：
    $$
    g_\kappa(x) = \frac{\partial J}{\partial \kappa(x)} = - \frac{1}{\kappa^2(x)} \int_{0}^{T} \lambda(x,t) \, \partial_{t}^{2} p(x,t) \, dt
    $$
    $$
    g_\rho(x) = \frac{\partial J}{\partial \rho(x)} = - \frac{1}{\rho^2(x)} \int_{0}^{T} \nabla\lambda(x,t) \cdot \nabla p(x,t) \, dt
    $$

这个结果极为重要：梯度的计算被转化为正演波场 $p$ 和伴随波场 $\lambda$ 的**零延迟互相关**。整个计算流程如下：
1.  使用当前模型 $m_k$ 进行一次正演模拟，得到波场 $u_k$ 和模拟数据 $d_{\text{syn}}(m_k)$。
2.  计算数据残差 $d_{\text{syn}}(m_k) - d_{\text{obs}}$，并将其作为伴随震源。
3.  进行一次伴随模拟（在时间上反向求解伴随方程），得到伴随波场 $\lambda_k$。
4.  通过互相关正演波场和伴随波场，计算出梯度 $\nabla J(m_k)$。

整个过程的计算量主要由两次（一次正演，一次伴随）波动方程求解决定，与模型参数数量无关。

#### 物理诠释：散射与敏感度核

伴随法得到的梯度 $\nabla J(m)$ 在物理上有一个非常直观的解释，它被称为**敏感度核（sensitivity kernel）**。它表示了[目标函数](@entry_id:267263)对模型参数在空间中每一点的微小扰动的敏感度。

这个敏感度核与**玻恩（Born）近似**或**线性化散射**理论紧密相关 。当我们考虑真实模型 $m$ 是背景模型 $m_0$ 加上一个小的扰动 $\delta m$ 时（$m = m_0 + \delta m$），总波场 $u$ 可以近似为背景波场 $u_0$ 与一次散射波场 $\delta u_1$ 之和。一次散射波场 $\delta u_1$ 是由背景波场 $u_0$ 与模型扰动 $\delta m$ 相互作用产生的，可以看作是由一个**二次震源** $s_{\text{sec}} = -\delta m \, \partial_t^2 u_0$ 在背景介质 $m_0$ 中辐射产生的。

FWI的梯度计算过程，本质上就是这个一次散射问题的“逆过程”。
-   正演波场 $u$ 从震源传播到地下散射体。
-   伴随波场 $\lambda$ 从检波器（由数据残差驱动）[反向传播](@entry_id:199535)回地下散射体。
-   梯度，即敏感度核，是这两个波场在散射体位置相遇（互相关）的结果。它“照亮”了那些对当前数据残差贡献最大的区域。

因此，FWI的每一次迭代可以被看作是利用当前的模型和数据残差，通过一次线性化的反演（或称**[反投影](@entry_id:746638)**）来更新模型。由于每次更新只基于线性近似，FWI需要多次迭代，逐步逼近[非线性](@entry_id:637147)的真实解。

#### 互易性与伴随波场

伴随波场从检波器位置反向传播的特性，与物理学中的**互易性原理（reciprocity principle）**有深刻联系 。互易性原理指出，在某些物理系统中，交换震源和检波器的位置，记录到的信号保持不变。用[格林函数](@entry_id:147802) $G(\mathbf{x}, t; \mathbf{y})$（表示在 $\mathbf{y}$ 处的脉冲震源在 $\mathbf{x}$ 处引起的响应）来说，就是 $G(\mathbf{x}, t; \mathbf{y}) = G(\mathbf{y}, t; \mathbf{x})$。

互易性成立的条件是控制波场传播的[微分算子](@entry_id:140145) $\mathcal{L}$ 是**自伴的（self-adjoint）**。对于[波动方程](@entry_id:139839)，这要求介质是无损的（没有衰减），没有背景流，且描述介质属性的张量（如[弹性张量](@entry_id:170728)）具有特定的对称性。

当系统满足自伴性时，伴随算子 $\mathcal{L}^*$ 就等于其自身 $\mathcal{L}$。这意味着伴随波场 $\lambda$ 与正演波场 $u$ 遵循完全相同的物理传播规律。因此，将数据残差作为震源，在时间上反向求解伴随方程，就等效于让波从检波器位置“逆时传播”回地下。这种“逆时传播”的图像为伴随状态法提供了一个强大的物理直觉，并解释了为何梯度计算是两个波场的相遇。

### 实现与扩展

将连续介质中的理论转化为计算机上的算法，需要考虑离散化、稳定性和[计算效率](@entry_id:270255)等实际问题。

#### 从连续到离散：[离散伴随](@entry_id:748494)方法

在数值实现中，我们求解的是离散化的波动方程。例如，一个简单的[时间步进格式](@entry_id:755998)可以写成：
$$
\mathbf{u}_{n+1} = S(m)\mathbf{u}_n + B\mathbf{s}_n
$$
其中 $\mathbf{u}_n$ 是在第 $n$ 个时间步长的波场状态向量，$S$ 是传播算子矩阵，$\mathbf{s}_n$ 是离散震源， $B$ 是震源注入矩阵。

为了确保数值计算的梯度是[目标函数](@entry_id:267263)对离散模型参数的精确梯度，我们需要推导**[离散伴随](@entry_id:748494)方程**，而不是简单地离散化[连续伴随](@entry_id:747804)方程 。[离散伴随](@entry_id:748494)算子是离散正演算子的[转置](@entry_id:142115)（或[共轭转置](@entry_id:147909)）。对于上述[时间步进格式](@entry_id:755998)，对应的[离散伴随](@entry_id:748494)方程是：
$$
\mathbf{v}_n = S(m)^T \mathbf{v}_{n+1} + \boldsymbol{\delta}_n
$$
其中 $\mathbf{v}_n$ 是[离散伴随](@entry_id:748494)波场，$\boldsymbol{\delta}_n$ 是在检波器采样时刻注入的[离散伴随](@entry_id:748494)震源。

验证[离散伴随](@entry_id:748494)代码正确性的一个关键工具是**[点积](@entry_id:149019)测试（dot-product test）**。它基于这样一个数学恒等式：对于任意随机的离散模型扰动 $\delta m$ 和离散数据扰动 $\delta d$，必须有 $\langle F'(m) \delta m, \delta d \rangle = \langle \delta m, F'(m)^T \delta d \rangle$。其中 $F'(m)$ 是线性化的正演算子（Frechet导数），$F'(m)^T$ 是其[伴随算子](@entry_id:140236)。在代码中验证这个等式是否在[机器精度](@entry_id:756332)内成立，是保证梯度计算正确性的金标准。

#### 正则化：施加[先验信息](@entry_id:753750)

FWI是一个典型的**不适定（ill-posed）**反演问题，解可能不唯一或对数据噪声非常敏感。**正则化（Regularization）**是通过在目标函数中加入一个惩罚项来施加关于模型解的[先验信息](@entry_id:753750)，从而使问题适定化并改善解的质量。

一个常见的[正则化方法](@entry_id:150559)是**吉洪诺夫（Tikhonov）正则化**，它惩罚模型梯度的范数，以寻求空间上平滑的解 。修正后的目标函数为：
$$
J_{\alpha}(m) = J_{\text{misfit}}(m) + \frac{\alpha}{2} \int_{\Omega} \|\nabla m(\mathbf{x})\|_2^2 d\mathbf{x}
$$
其中 $\alpha$ 是控制正则化强度的超参数。利用[变分法](@entry_id:163656)，可以推导出这个正则化项对梯度的贡献是 $-\alpha \Delta m$，其中 $\Delta$ 是拉普拉斯算子。因此，总梯度变为：
$$
\nabla J_{\alpha}(m) = \nabla J_{\text{misfit}}(m) - \alpha \Delta m
$$
在梯度下降的每一步中，加上这一项相当于对模型进行了一步**[扩散](@entry_id:141445)（diffusion）**操作。在傅里叶域中，拉普拉斯算子对应于 $-|k|^2$（$k$ 是波数），所以正则化项在梯度更新中起到了一个**低通滤波器**的作用。它强烈地衰减模型中的高波数（高频）成分，从而抑制噪声和伪影，产生更平滑、更符合地质直觉的结果。

#### 时间域与频率域 FWI

求解[波动方程](@entry_id:139839)主要有两种计算策略：时间域（time domain）和频率域（frequency domain）。

-   **时间域FWI**：直接在时域上通过有限差分（FDTD）或有限元（FEM）等方法进行步进求解。这是最直接的方法。
-   **频率域FWI**：首先对[波动方程](@entry_id:139839)和数据进行[傅里叶变换](@entry_id:142120)，将时域的[偏微分方程](@entry_id:141332)转化为一系列关于不同频率 $\omega$ 的**亥姆霍兹方程（Helmholtz equation）** ：
    $$
    (-\omega^2 m(\mathbf{x}) - \nabla^2) \hat{u}(\mathbf{x}, \omega) = \hat{f}(\mathbf{x}, \omega)
    $$
    反演在选定的一组离散频率上独立进行。对应的伴随状态法和梯度计算也都在频率域完成。

这两种方法各有优劣：
-   **内存与计算**：时间域方法通常采用显式步进，内存需求较低（只需存储几个时间步的波场），但需要模拟很长的时间序列。频率域方法需要求解一个[大型稀疏线性系统](@entry_id:137968) $(-\omega^2 m - \nabla^2)\hat{u} = \hat{f}$，这通常通过直接法（如[LU分解](@entry_id:144767)）或[迭代法](@entry_id:194857)完成。直接法内存消耗巨大（因为[矩阵分解](@entry_id:139760)会产生大量填充），但一旦分解完成，对于多个震源的求解速度极快。迭代法则内存较省，但收敛性可能是个问题。
-   **多震源问题**：频率域方法在处理多震源数据时有天然优势。由于亥姆霍兹方程是线性的，多个震源的系统矩阵是相同的。因此，可以对矩阵进行一次（昂贵的）分解，然后用它高效地求解所有震源对应的波场。
-   **物理特性**：频率域方法可以自然地实现频率续进策略，并且更容易地模拟具有复杂频率依赖性的物理现象（如衰减）。

总结来说，时间域FWI在内存方面更具优势，实现相对直接；而频率域FWI在处理多震源问题和频率相关物理时更灵活高效，但需要解决大规模线性系统的求解问题。选择哪种方法取决于具体的勘探问题、计算资源和[算法设计](@entry_id:634229)的侧重点。