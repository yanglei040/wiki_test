{
    "hands_on_practices": [
        {
            "introduction": "Full-Waveform Inversion hinges on accurately simulating wave propagation, and the reliability of the entire inversion process depends on the fidelity of the underlying numerical solver. In this exercise, you will analyze the accuracy of a finite-difference scheme for the anisotropic acoustic wave equation, a common engine for FWI. By investigating numerical dispersion, you will derive the relationship between grid spacing, frequency, and phase-velocity error, a foundational skill for setting up any reliable wave-equation-based inversion. ",
            "id": "3611622",
            "problem": "Consider two-dimensional Vertical Transverse Isotropy (VTI) in the elliptical-anisotropy limit where the Thomsen parameters satisfy $\\delta = \\epsilon$. In this limit, the acoustic quasi-compressional (qP) wavefield $u(x,z,t)$ is governed by the constant-coefficient anisotropic acoustic wave equation\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} \\;=\\; v_{x}^{2}\\,\\frac{\\partial^{2} u}{\\partial x^{2}} \\;+\\; v_{z}^{2}\\,\\frac{\\partial^{2} u}{\\partial z^{2}},\n$$\nwhere $v_{z} = v_{P0}$ is the vertical phase velocity and $v_{x} = v_{P0}\\sqrt{1+2\\epsilon}$ is the horizontal phase velocity. This model is widely used to design wave-equation solvers for multiparameter and anisotropic Full-Waveform Inversion (FWI).\n\nYou discretize this equation on a uniform square grid with spacing $\\Delta x = \\Delta z = h$ and a uniform time step $\\Delta t$, using second-order centered finite differences in both time and space. Let the time step be chosen to saturate the Courant–Friedrichs–Lewy (CFL) stability limit for this scheme. You will:\n\n1. Derive the discrete dispersion relation by substituting a plane-wave ansatz $u = \\exp\\!\\big(i(k_{x} x + k_{z} z - \\omega t)\\big)$ into the finite-difference scheme. Express the result in terms of $r_{x} = v_{x}\\Delta t/h$, $r_{z} = v_{z}\\Delta t/h$, $\\kappa_{x} = k_{x} h/2$, and $\\kappa_{z} = k_{z} h/2$.\n\n2. Using a small-wavenumber expansion (i.e., $|\\kappa_{x}| \\ll 1$, $|\\kappa_{z}| \\ll 1$), obtain the leading-order expression for the relative phase-velocity error $e(\\theta)$, where the propagation angle $\\theta \\in [0,\\pi/2]$ (radians) is defined by $k_{x} = k\\cos\\theta$ and $k_{z} = k\\sin\\theta$, and $k = \\sqrt{k_{x}^{2}+k_{z}^{2}}$. Your expression must make explicit the dependence on $h$, the maximum angular frequency $\\omega_{\\max}$ (equivalently, maximum frequency $f_{\\max} = \\omega_{\\max}/(2\\pi)$), and the anisotropic velocities $v_{x}$ and $v_{z}$.\n\n3. Under the CFL-saturating choice of $\\Delta t$ for the second-order finite-difference scheme, determine the maximum allowable grid spacing $h$ that guarantees the worst-case relative phase-velocity error over all $\\theta \\in [0,\\pi/2]$ does not exceed a prescribed tolerance $\\tau$. Provide a closed-form formula for $h$ as a function of $f_{\\max}$, $v_{x}$, $v_{z}$, and $\\tau$.\n\nFinally, consider the design parameters\n- $v_{P0} = 2500$ m/s,\n- $\\epsilon = 0.2$ (hence $\\delta = \\epsilon$),\n- $f_{\\max} = 30$ Hz,\n- tolerance $\\tau = 0.01$,\nand compute the numerical value of the maximum admissible grid spacing $h$ in meters. Round your answer to four significant figures. Express the final $h$ in meters.",
            "solution": "We begin from the constant-coefficient anisotropic acoustic wave equation\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} \\;=\\; v_{x}^{2}\\,\\frac{\\partial^{2} u}{\\partial x^{2}} \\;+\\; v_{z}^{2}\\,\\frac{\\partial^{2} u}{\\partial z^{2}}.\n$$\nFor elliptical Vertical Transverse Isotropy (VTI) with $\\delta = \\epsilon$, the horizontal and vertical phase velocities satisfy $v_{x} = v_{P0}\\sqrt{1+2\\epsilon}$ and $v_{z} = v_{P0}$.\n\nWe discretize with second-order central differences in time and space on a uniform square grid $\\Delta x = \\Delta z = h$ and time step $\\Delta t$. The finite-difference (FD) scheme at grid point $(i,j)$ and time level $n$ is\n$$\n\\frac{u_{i,j}^{n+1} - 2 u_{i,j}^{n} + u_{i,j}^{n-1}}{\\Delta t^{2}}\n\\;=\\;\nv_{x}^{2}\\,\\frac{u_{i+1,j}^{n} - 2 u_{i,j}^{n} + u_{i-1,j}^{n}}{h^{2}}\n\\;+\\;\nv_{z}^{2}\\,\\frac{u_{i,j+1}^{n} - 2 u_{i,j}^{n} + u_{i,j-1}^{n}}{h^{2}}.\n$$\n\nDerivation of the discrete dispersion relation. Substitute a plane wave $u_{i,j}^{n} = \\exp\\!\\big(i(k_{x} i h + k_{z} j h - \\omega n \\Delta t)\\big)$ into the scheme. The standard algebra yields\n$$\n\\frac{\\exp(-i\\omega\\Delta t) - 2 + \\exp(i\\omega\\Delta t)}{\\Delta t^{2}}\n\\;=\\;\nv_{x}^{2}\\,\\frac{\\exp(i k_{x} h) - 2 + \\exp(-i k_{x} h)}{h^{2}}\n\\;+\\;\nv_{z}^{2}\\,\\frac{\\exp(i k_{z} h) - 2 + \\exp(-i k_{z} h)}{h^{2}}.\n$$\nUsing $\\exp(i\\phi) - 2 + \\exp(-i\\phi) = -4 \\sin^{2}(\\phi/2)$, we obtain\n$$\n\\frac{-4 \\sin^{2}(\\omega \\Delta t/2)}{\\Delta t^{2}}\n\\;=\\;\nv_{x}^{2}\\,\\frac{-4 \\sin^{2}(k_{x} h/2)}{h^{2}}\n\\;+\\;\nv_{z}^{2}\\,\\frac{-4 \\sin^{2}(k_{z} h/2)}{h^{2}}.\n$$\nCanceling the common factor $-4$ and defining $r_{x} = v_{x}\\Delta t/h$, $r_{z} = v_{z}\\Delta t/h$, $\\kappa_{x} = k_{x} h/2$, and $\\kappa_{z} = k_{z} h/2$, the discrete dispersion relation is\n$$\n\\sin^{2}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)\n\\;=\\;\nr_{x}^{2}\\,\\sin^{2}(\\kappa_{x})\n\\;+\\;\nr_{z}^{2}\\,\\sin^{2}(\\kappa_{z}).\n$$\n\nSmall-wavenumber expansion and phase-velocity error. For small $|\\kappa_{x}|,|\\kappa_{z}|$, use $\\sin(\\xi) = \\xi - \\xi^{3}/6 + \\mathcal{O}(\\xi^{5})$ to obtain\n$$\n\\sin^{2}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)\n=\n\\left(\\frac{\\omega \\Delta t}{2}\\right)^{2}\n- \\frac{1}{3}\\left(\\frac{\\omega \\Delta t}{2}\\right)^{4}\n+ \\mathcal{O}\\!\\left((\\omega \\Delta t)^{6}\\right),\n$$\n$$\n\\sin^{2}(\\kappa_{x})\n=\n\\kappa_{x}^{2} - \\frac{\\kappa_{x}^{4}}{3} + \\mathcal{O}(\\kappa_{x}^{6}),\n\\qquad\n\\sin^{2}(\\kappa_{z})\n=\n\\kappa_{z}^{2} - \\frac{\\kappa_{z}^{4}}{3} + \\mathcal{O}(\\kappa_{z}^{6}).\n$$\nLet $k = \\sqrt{k_{x}^{2} + k_{z}^{2}}$ and define the propagation angle $\\theta$ by $k_{x} = k \\cos\\theta$, $k_{z} = k \\sin\\theta$, with $\\theta \\in [0,\\pi/2]$. Define\n$$\nA(\\theta) = v_{x}^{2}\\cos^{2}\\theta + v_{z}^{2}\\sin^{2}\\theta,\n\\qquad\nB(\\theta) = v_{x}^{2}\\cos^{4}\\theta + v_{z}^{2}\\sin^{4}\\theta.\n$$\nMatching orders in the expanded dispersion relation gives the leading frequency correction\n$$\n\\omega^{2} = k^{2} A(\\theta) + \\delta(\\theta),\n\\qquad\n\\delta(\\theta) \\approx \\frac{\\Delta t^{2}}{12}\\,k^{4} A(\\theta)^{2} - \\frac{h^{2}}{12}\\,k^{4} B(\\theta),\n$$\nwhere we have neglected terms of higher than fourth order in $k$. The numerical phase velocity is $c_{\\mathrm{num}}(\\theta) = \\omega/k$. Expanding $\\omega = k \\sqrt{A + \\delta/k^{2}}$ to first order in $\\delta$ yields\n$$\nc_{\\mathrm{num}}(\\theta) \\approx \\sqrt{A(\\theta)}\\left[1 + \\frac{1}{2}\\frac{\\delta(\\theta)}{k^{2}A(\\theta)}\\right].\n$$\nHence the leading-order relative phase-velocity error $e(\\theta)$ is\n$$\ne(\\theta) \\equiv \\frac{c_{\\mathrm{num}}(\\theta) - \\sqrt{A(\\theta)}}{\\sqrt{A(\\theta)}}\n\\;\\approx\\;\n\\frac{1}{24}\\,k^{2}\\left[\\Delta t^{2} A(\\theta) - \\frac{h^{2} B(\\theta)}{A(\\theta)}\\right].\n$$\n\nCFL choice and worst-case error over angles. For the second-order scheme on a square grid, the Courant–Friedrichs–Lewy (CFL) stability limit is $r_{x}^{2} + r_{z}^{2} \\leq 1$, i.e.,\n$$\n\\frac{v_{x}^{2}\\Delta t^{2}}{h^{2}} + \\frac{v_{z}^{2}\\Delta t^{2}}{h^{2}} \\;\\leq\\; 1\n\\;\\;\\Rightarrow\\;\\;\n\\Delta t^{2} = \\frac{h^{2}}{v_{x}^{2} + v_{z}^{2}}\n$$\nwhen saturating the bound. Substituting this into the error expression gives\n$$\ne(\\theta) \\approx \\frac{1}{24}\\,k^{2} h^{2}\\left[\\frac{A(\\theta)}{v_{x}^{2} + v_{z}^{2}} - \\frac{B(\\theta)}{A(\\theta)}\\right].\n$$\nFor a given angular frequency $\\omega$ (or frequency $f$), the wavenumber is $k(\\theta) = \\omega/\\sqrt{A(\\theta)} = 2\\pi f/\\sqrt{A(\\theta)}$. Therefore,\n$$\ne(\\theta) \\approx \\frac{h^{2}}{24}\\left(\\frac{2\\pi f}{\\sqrt{A(\\theta)}}\\right)^{2}\n\\left[\\frac{A(\\theta)}{v_{x}^{2} + v_{z}^{2}} - \\frac{B(\\theta)}{A(\\theta)}\\right]\n=\n\\frac{h^{2}(2\\pi f)^{2}}{24}\\left[\\frac{1}{v_{x}^{2} + v_{z}^{2}} - \\frac{B(\\theta)}{A(\\theta)^{2}}\\right].\n$$\nDefine $S = v_{x}^{2} + v_{z}^{2}$ and\n$$\nQ(\\theta) = \\frac{B(\\theta)}{A(\\theta)^{2}}\n=\n\\frac{v_{x}^{2}\\cos^{4}\\theta + v_{z}^{2}\\sin^{4}\\theta}{\\big(v_{x}^{2}\\cos^{2}\\theta + v_{z}^{2}\\sin^{2}\\theta\\big)^{2}}.\n$$\nThen\n$$\ne(\\theta) \\approx \\frac{h^{2}(2\\pi f)^{2}}{24}\\,\\bigg[\\frac{1}{S} - Q(\\theta)\\bigg].\n$$\nTo guarantee $|e(\\theta)| \\le \\tau$ for all $\\theta \\in [0,\\pi/2]$ at $f = f_{\\max}$, we require\n$$\n\\frac{h^{2}(2\\pi f_{\\max})^{2}}{24}\\,\\sup_{\\theta \\in [0,\\pi/2]}\\bigg|\\,\\frac{1}{S} - Q(\\theta)\\,\\bigg| \\;\\le\\; \\tau.\n$$\nIt remains to compute $D \\equiv \\sup_{\\theta} |\\,1/S - Q(\\theta)\\,|$. Parameterize by $u = \\cos^{2}\\theta \\in [0,1]$, so\n$$\nA(u) = v_{x}^{2} u + v_{z}^{2} (1-u),\\qquad\nB(u) = v_{x}^{2} u^{2} + v_{z}^{2} (1-u)^{2},\\qquad\nQ(u) = \\frac{B(u)}{A(u)^{2}}.\n$$\nA straightforward derivative test shows that $Q(u)$ has a unique interior critical point at $u = 1/2$, with\n$$\nQ\\!\\left(\\tfrac{1}{2}\\right) = \\frac{1}{v_{x}^{2} + v_{z}^{2}} = \\frac{1}{S},\n$$\nand endpoint values $Q(0) = 1/v_{z}^{2}$ and $Q(1) = 1/v_{x}^{2}$. Therefore,\n$$\n\\inf_{\\theta} Q(\\theta) = \\frac{1}{S},\n\\qquad\n\\sup_{\\theta} Q(\\theta) = \\frac{1}{\\min(v_{x}^{2},v_{z}^{2})}.\n$$\nAssuming $v_{x} \\ge v_{z}$ (the typical case for positive $\\epsilon$), we have $\\sup_{\\theta} Q(\\theta) = 1/v_{z}^{2}$. Hence\n$$\n\\sup_{\\theta}\\bigg|\\,\\frac{1}{S} - Q(\\theta)\\,\\bigg|\n=\n\\max\\!\\left(\\frac{1}{S} - \\frac{1}{S},\\,\\frac{1}{v_{z}^{2}} - \\frac{1}{S}\\right)\n=\n\\frac{v_{x}^{2}}{v_{z}^{2}\\,S}.\n$$\nThus, the worst-case bound is attained at $\\theta = \\pi/2$ (vertical propagation), and the maximum admissible grid spacing satisfying $|e(\\theta)| \\le \\tau$ for all $\\theta$ is\n$$\nh_{\\max}\n=\n\\sqrt{\\frac{24\\,\\tau}{(2\\pi f_{\\max})^{2}}\\,\\frac{1}{D}}\n=\n\\sqrt{\\frac{24\\,\\tau}{(2\\pi f_{\\max})^{2}}\\,\\frac{v_{z}^{2}\\,S}{v_{x}^{2}}}\n=\n\\sqrt{\\frac{24\\,\\tau\\,v_{z}^{2}\\,(v_{x}^{2}+v_{z}^{2})}{(2\\pi f_{\\max})^{2}\\,v_{x}^{2}}}.\n$$\n\nNumerical evaluation. With the given values $v_{P0} = 2500$ m/s, $\\epsilon = 0.2$ (so $\\delta=\\epsilon$), we have\n$$\nv_{z} = v_{P0} = 2500,\\qquad\nv_{x} = v_{P0}\\sqrt{1+2\\epsilon} = 2500\\,\\sqrt{1.4},\n$$\nso\n$$\nv_{z}^{2} = 6.25\\times 10^{6},\\qquad\nv_{x}^{2} = 1.4\\,v_{z}^{2} = 8.75\\times 10^{6},\\qquad\nS = v_{x}^{2} + v_{z}^{2} = 1.5\\times 10^{7}.\n$$\nWith $f_{\\max} = 30$ and $\\tau = 0.01$, we obtain\n$$\nh_{\\max}\n=\n\\sqrt{\\frac{24\\,(0.01)\\,(6.25\\times 10^{6})\\,(1.5\\times 10^{7})}{\\big(2\\pi\\cdot 30\\big)^{2}\\,(8.75\\times 10^{6})}}\n=\n\\sqrt{\\frac{24\\,(0.01)\\,v_{z}^{2}\\,S}{(2\\pi f_{\\max})^{2}\\,v_{x}^{2}}}.\n$$\nCompute the dimensionless factor inside the square root:\n$$\n\\frac{24\\,(0.01)}{(2\\pi\\cdot 30)^{2}}\\cdot \\frac{v_{z}^{2}\\,S}{v_{x}^{2}}\n=\n\\frac{0.24}{3600\\pi^{2}}\\cdot \\frac{(6.25\\times 10^{6})(1.5\\times 10^{7})}{8.75\\times 10^{6}}\n=\n\\frac{0.24}{3600\\pi^{2}}\\cdot \\frac{9.375\\times 10^{13}}{8.75\\times 10^{6}}\n=\n\\frac{0.24}{3600\\pi^{2}}\\cdot 1.071428571\\times 10^{7}.\n$$\nEquivalently, using the compact expression derived earlier,\n$$\nh_{\\max}\n=\n\\sqrt{\\frac{24\\,\\tau}{(2\\pi f_{\\max})^{2}\\,D}}\n,\\quad\nD = \\frac{v_{x}^{2}}{v_{z}^{2}\\,S}\n=\n\\frac{8.75\\times 10^{6}}{(6.25\\times 10^{6})(1.5\\times 10^{7})}\n=\n9.333333333\\times 10^{-8}.\n$$\nThus\n$$\nh_{\\max} = \\sqrt{\\frac{0.24}{(2\\pi\\cdot 30)^{2}\\,(9.333333333\\times 10^{-8})}}\n=\n\\sqrt{\\frac{0.24}{3600\\pi^{2}\\cdot 9.333333333\\times 10^{-8}}}\n\\approx \\sqrt{72.372274}\n\\approx 8.507.\n$$\nRounding to four significant figures and expressing in meters, the maximum admissible grid spacing is $8.507$ m.",
            "answer": "$$\\boxed{8.507}$$"
        },
        {
            "introduction": "A central challenge in multiparameter FWI is non-uniqueness, where different combinations of physical parameters can produce similar seismic data. This practice provides a quantitative framework for analyzing this \"cross-talk\" between P-wave velocity ($v_{\\parallel}$) and the anisotropy axis tilt ($\\nu$). By deriving the sensitivity kernels and computing their alignment, you will gain insight into how the acquisition geometry controls our ability to uniquely resolve different earth properties, a key consideration in designing and interpreting inversion results. ",
            "id": "3611577",
            "problem": "Consider a two-dimensional tilted transversely isotropic medium with elliptical anisotropy such that the quasi-compressional phase slowness is ellipsoidal. Let the symmetry axis unit vector be $ \\mathbf{e}_{\\parallel}(\\nu) = (\\sin \\nu, \\cos \\nu) $ with tilt angle $ \\nu $ measured from the vertical axis, and let $ \\mathbf{e}_{\\perp}(\\nu) = (\\cos \\nu, -\\sin \\nu) $ be the unit vector perpendicular to $ \\mathbf{e}_{\\parallel} $. Define the phase slowness tensor\n$$\n\\mathbf{M}(\\nu) = a\\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top} + b\\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top},\n$$\nwith $ a = 1 / v_{\\perp}^{2} $ and $ b = 1 / v_{\\parallel}^{2} $, where $ v_{\\parallel} $ is the phase velocity along the symmetry axis and $ v_{\\perp} $ is the phase velocity in the perpendicular direction. For a receiver at azimuth $ \\psi $ (measured from the vertical axis) relative to the source at the origin and at fixed radius $ R $, assume straight-ray propagation with direction unit vector $ \\mathbf{n}(\\psi) = (\\sin \\psi, \\cos \\psi) $ and path length $ L = R $. The traveltime is\n$$\nT(\\psi) = L\\, s(\\psi), \\quad s(\\psi) = \\sqrt{ \\mathbf{n}(\\psi)^{\\top} \\mathbf{M}(\\nu) \\mathbf{n}(\\psi) }.\n$$\nAssume high-frequency conditions so that the complex phase is $ \\phi(\\psi) = \\omega T(\\psi) $ with angular frequency $ \\omega = 2 \\pi f $. Under small parameter perturbations, the linearized phase residual is\n$$\n\\delta \\phi(\\psi) \\approx \\omega\\, L \\left( \\frac{\\partial s}{\\partial v_{\\parallel}} \\delta v_{\\parallel} + \\frac{\\partial s}{\\partial \\nu} \\overline{\\delta \\nu} \\right),\n$$\nwhere $ \\overline{\\delta \\nu} $ denotes the path-average of the tilt perturbation $ \\delta \\nu(\\mathbf{x}) $ along the ray under the assumption that $ \\mathbf{M} $ is spatially homogeneous. Let $ v_{\\parallel} $ be the compressional velocity parameter to be inverted and $ \\nu(\\mathbf{x}) $ be a known field that may contain an error. The question is to examine how heterogeneity in $ \\nu(\\mathbf{x}) $ affects the uniqueness of recovering $ v_{\\parallel} $ from phase data, by quantifying when phase residuals caused by $ \\delta \\nu $ are systematically aligned with those caused by $ \\delta v_{\\parallel} $ across a receiver array.\n\nStarting from Fermat’s principle that traveltime is the path integral of slowness and the ellipsoidal slowness model above, derive expressions for the sensitivities $ \\partial s / \\partial v_{\\parallel} $ and $ \\partial s / \\partial \\nu $ as functions of $ \\mathbf{n}(\\psi) $, $ v_{\\parallel} $, $ v_{\\perp} $, and $ \\nu $. Use these to define, for an array of receivers with azimuths $ \\{ \\psi_i \\}_{i=1}^{N} $, the sensitivity vectors\n$$\n\\mathbf{g}_{v} = \\left[ \\frac{\\partial T(\\psi_i)}{\\partial v_{\\parallel}} \\right]_{i=1}^{N}, \\quad \\mathbf{g}_{\\nu} = \\left[ \\frac{\\partial T(\\psi_i)}{\\partial \\nu} \\cdot \\overline{\\delta \\nu} \\right]_{i=1}^{N}.\n$$\nDefine the alignment coefficient\n$$\n\\kappa = \\frac{ \\left| \\mathbf{g}_{\\nu} \\cdot \\mathbf{g}_{v} \\right| }{ \\| \\mathbf{g}_{\\nu} \\|_2 \\, \\| \\mathbf{g}_{v} \\|_2 },\n$$\nwith the convention that $ \\kappa = 0 $ if either vector is the zero vector. A value of $ \\kappa $ close to $ 1 $ indicates that phase residuals due to $ \\delta \\nu $ are likely to be misattributed to $ \\delta v_{\\parallel} $, compromising uniqueness. A value of $ \\kappa $ close to $ 0 $ indicates that the two effects are distinguishable.\n\nImplement a program that computes $\\kappa$ for the following test suite. In all cases, use degrees for all angular quantities in inputs, internally convert to radians, and assume receivers are uniformly sampled in azimuth over a specified aperture. Although $ f $ and $ R $ are physically needed for phases, they cancel in $ \\kappa $, so their numerical values do not affect $ \\kappa $. If a case specifies “zero-mean sinusoidal heterogeneity,” model $ \\delta \\nu(\\xi) = \\delta \\nu_0 \\sin(2 \\pi \\xi) $ along the ray parameter $ \\xi \\in [0,1] $, implying $ \\overline{\\delta \\nu} = 0 $.\n\nTest suite parameterization and cases:\n- Each case is a tuple $ (v_{\\parallel}\\,[\\mathrm{m/s}], v_{\\perp}\\,[\\mathrm{m/s}], \\nu_{\\mathrm{true}}\\,[\\mathrm{deg}], \\psi_{\\mathrm{center}}\\,[\\mathrm{deg}], \\Delta_{\\mathrm{half}}\\,[\\mathrm{deg}], N, \\mathrm{hetero}) $.\n- Receiver azimuths are $ \\psi_i $ uniformly spaced in $ [\\psi_{\\mathrm{center}} - \\Delta_{\\mathrm{half}}, \\, \\psi_{\\mathrm{center}} + \\Delta_{\\mathrm{half}}] $ for $ i = 1,\\dots,N $.\n\nProvide the following four cases:\n1. Case A (one-sided aperture, constant tilt error): $ (3000,\\, 3300,\\, 20,\\, 50,\\, 15,\\, 13,\\, \\text{\"constant\"}) $.\n2. Case B (symmetric aperture about the axis, constant tilt error): $ (3000,\\, 3300,\\, 0,\\, 0,\\, 20,\\, 21,\\, \\text{\"constant\"}) $.\n3. Case C (isotropic medium, constant tilt error): $ (3000,\\, 3000,\\, 20,\\, 50,\\, 15,\\, 13,\\, \\text{\"constant\"}) $.\n4. Case D (one-sided aperture, zero-mean sinusoidal tilt heterogeneity): $ (3000,\\, 3300,\\, 20,\\, 50,\\, 15,\\, 13,\\, \\text{\"zero-mean\"}) $.\n\nRequirements:\n- Derive $ \\partial s / \\partial v_{\\parallel} $ and $ \\partial s / \\partial \\nu $ from the definitions above; do not introduce any shortcut formulas beyond the stated ellipsoidal slowness model and basic calculus.\n- Implement the computation of $ \\kappa $ for each case using the specified receiver sampling.\n- Angle units for inputs are degrees; internally convert to radians.\n- The program must output a single line containing a list of the four $ \\kappa $ values as floating-point numbers, rounded to six decimal places, in the order of the cases above, formatted as $ [\\kappa_1,\\kappa_2,\\kappa_3,\\kappa_4] $.",
            "solution": "The problem requires us to quantify the trade-off, or cross-talk, between perturbations in the compressional velocity $v_{\\parallel}$ and the medium's tilt angle $\\nu$. This is done by calculating the alignment coefficient $\\kappa$ between their respective sensitivity vectors. A value of $\\kappa \\approx 1$ signifies a high degree of linear dependence between the two parameter effects on the data, making it difficult to uniquely distinguish them in an inversion. A value of $\\kappa \\approx 0$ implies the effects are orthogonal and thus easily distinguishable. The core of the task is to derive the sensitivity kernels, i.e., the partial derivatives of the phase slowness $s$ with respect to $v_{\\parallel}$ and $\\nu$.\n\n**1. Derivation of the Phase Slowness Expression**\n\nThe squared phase slowness is given by $s(\\psi)^2 = \\mathbf{n}(\\psi)^{\\top} \\mathbf{M}(\\nu) \\mathbf{n}(\\psi)$. We first simplify this expression.\nUsing the definition $\\mathbf{M}(\\nu) = a\\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top} + b\\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top}$, we have:\n$$\ns(\\psi)^2 = \\mathbf{n}^{\\top} (a \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top} + b \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top}) \\mathbf{n} = a (\\mathbf{n}^{\\top} \\mathbf{e}_{\\perp})(\\mathbf{e}_{\\perp}^{\\top} \\mathbf{n}) + b (\\mathbf{n}^{\\top} \\mathbf{e}_{\\parallel})(\\mathbf{e}_{\\parallel}^{\\top} \\mathbf{n}) = a (\\mathbf{n} \\cdot \\mathbf{e}_{\\perp})^2 + b (\\mathbf{n} \\cdot \\mathbf{e}_{\\parallel})^2\n$$\nThe dot products are:\n$$\n\\mathbf{n}(\\psi) \\cdot \\mathbf{e}_{\\parallel}(\\nu) = (\\sin \\psi, \\cos \\psi) \\cdot (\\sin \\nu, \\cos \\nu) = \\sin \\psi \\sin \\nu + \\cos \\psi \\cos \\nu = \\cos(\\psi - \\nu)\n$$\n$$\n\\mathbf{n}(\\psi) \\cdot \\mathbf{e}_{\\perp}(\\nu) = (\\sin \\psi, \\cos \\psi) \\cdot (\\cos \\nu, -\\sin \\nu) = \\sin \\psi \\cos \\nu - \\cos \\psi \\sin \\nu = \\sin(\\psi - \\nu)\n$$\nSubstituting these into the expression for $s(\\psi)^2$ yields a simplified form:\n$$\ns(\\psi)^2 = a \\sin^2(\\psi - \\nu) + b \\cos^2(\\psi - \\nu)\n$$\nwhere $a = 1/v_{\\perp}^2$ and $b = 1/v_{\\parallel}^2$.\n\n**2. Derivation of Sensitivity $\\partial s / \\partial v_{\\parallel}$**\n\nWe use the chain rule: $\\frac{\\partial s}{\\partial v_{\\parallel}} = \\frac{\\partial s}{\\partial b} \\frac{\\partial b}{\\partial v_{\\parallel}}$.\nFirst, we find $\\frac{\\partial b}{\\partial v_{\\parallel}}$:\n$$\nb = v_{\\parallel}^{-2} \\implies \\frac{\\partial b}{\\partial v_{\\parallel}} = -2 v_{\\parallel}^{-3}\n$$\nNext, we implicitly differentiate the expression for $s^2$ with respect to $b$:\n$$\n2s \\frac{\\partial s}{\\partial b} = \\cos^2(\\psi - \\nu) \\implies \\frac{\\partial s}{\\partial b} = \\frac{\\cos^2(\\psi - \\nu)}{2s}\n$$\nCombining these results gives the sensitivity to $v_{\\parallel}$:\n$$\n\\frac{\\partial s}{\\partial v_{\\parallel}} = \\left( \\frac{\\cos^2(\\psi - \\nu)}{2s} \\right) \\left( -2 v_{\\parallel}^{-3} \\right) = - \\frac{\\cos^2(\\psi - \\nu)}{s v_{\\parallel}^3}\n$$\n\n**3. Derivation of Sensitivity $\\partial s / \\partial \\nu$**\n\nWe differentiate $s^2$ with respect to $\\nu$:\n$$\n2s \\frac{\\partial s}{\\partial \\nu} = \\frac{\\partial}{\\partial \\nu} \\left[ a \\sin^2(\\psi - \\nu) + b \\cos^2(\\psi - \\nu) \\right]\n$$\nApplying the chain rule:\n$$\n2s \\frac{\\partial s}{\\partial \\nu} = a \\cdot 2\\sin(\\psi - \\nu)\\cos(\\psi - \\nu)(-1) + b \\cdot 2\\cos(\\psi - \\nu)(-\\sin(\\psi - \\nu))(-1)\n$$\n$$\n2s \\frac{\\partial s}{\\partial \\nu} = -a \\sin(2(\\psi - \\nu)) + b \\sin(2(\\psi - \\nu)) = (b-a) \\sin(2(\\psi - \\nu))\n$$\nSolving for $\\frac{\\partial s}{\\partial \\nu}$:\n$$\n\\frac{\\partial s}{\\partial \\nu} = \\frac{(b-a) \\sin(2(\\psi - \\nu))}{2s}\n$$\n\n**4. The Alignment Coefficient $\\kappa$**\n\nThe sensitivity vectors are defined for traveltime $T(\\psi) = L s(\\psi)$:\n$$\n\\mathbf{g}_{v} = \\left[ L \\frac{\\partial s(\\psi_i)}{\\partial v_{\\parallel}} \\right]_{i=1}^{N}, \\quad \\mathbf{g}_{\\nu} = \\left[ L \\frac{\\partial s(\\psi_i)}{\\partial \\nu} \\cdot \\overline{\\delta \\nu} \\right]_{i=1}^{N}\n$$\nThe alignment coefficient $\\kappa$ is the absolute value of the cosine of the angle between these two vectors. Any common scalar factors applied to all components of a vector do not change the vector's direction and thus cancel out in the calculation of $\\kappa$. Therefore, the factors $L$ and (for the \"constant\" case) $\\overline{\\delta\\nu}$ can be disregarded. We compute $\\kappa$ using vectors of the slowness sensitivities:\n$$\n\\mathbf{g}'_{v} = \\left[ \\frac{\\partial s(\\psi_i)}{\\partial v_{\\parallel}} \\right]_{i=1}^{N}, \\quad \\mathbf{g}'_{\\nu} = \\left[ \\frac{\\partial s(\\psi_i)}{\\partial \\nu} \\right]_{i=1}^{N}\n$$\n$$\n\\kappa = \\frac{ \\left| \\mathbf{g}'_{\\nu} \\cdot \\mathbf{g}'_{v} \\right| }{ \\| \\mathbf{g}'_{\\nu} \\|_2 \\, \\| \\mathbf{g}'_{v} \\|_2 }\n$$\n\n**5. Analysis of Special Cases**\n\nBefore numerical computation, we analyze the test cases.\n- **Case D (Zero-mean heterogeneity):** The problem states that for this model, $\\overline{\\delta\\nu} = 0$. This implies that the sensitivity vector $\\mathbf{g}_{\\nu}$ is the zero vector. By the given convention, $\\kappa = 0$.\n- **Case C (Isotropic medium):** In an isotropic medium, $v_{\\parallel} = v_{\\perp}$, which implies $b = a$. The sensitivity to tilt becomes $\\frac{\\partial s}{\\partial \\nu} = \\frac{(a-a) \\sin(2(\\psi - \\nu))}{2s} = 0$ for all $\\psi$. Thus, the sensitivity vector $\\mathbf{g}'_{\\nu}$ (and $\\mathbf{g}_{\\nu}$) is the zero vector, and $\\kappa = 0$.\n- **Case B (Symmetric aperture):** Here, $\\nu = 0^\\circ$ and the receiver azimuths $\\psi_i$ are sampled symmetrically about $0^\\circ$ (from $-20^\\circ$ to $20^\\circ$). Let's analyze the dot product $\\mathbf{g}'_v \\cdot \\mathbf{g}'_\\nu = \\sum_i \\frac{\\partial s(\\psi_i)}{\\partial v_\\parallel} \\frac{\\partial s(\\psi_i)}{\\partial \\nu}$.\nThe term $\\frac{\\partial s(\\psi_i)}{\\partial v_\\parallel}$ is proportional to $-\\frac{\\cos^2(\\psi_i)}{s(\\psi_i)}$. Both $\\cos^2(\\psi_i)$ and $s(\\psi_i)^2 = a \\sin^2(\\psi_i) + b \\cos^2(\\psi_i)$ are even functions of $\\psi_i$. Thus, $\\frac{\\partial s(\\psi_i)}{\\partial v_\\parallel}$ is an even function of $\\psi_i$.\nThe term $\\frac{\\partial s(\\psi_i)}{\\partial \\nu}$ is proportional to $\\frac{\\sin(2\\psi_i)}{s(\\psi_i)}$. Since $\\sin(2\\psi_i)$ is an odd function of $\\psi_i$ and $s(\\psi_i)$ is even, $\\frac{\\partial s(\\psi_i)}{\\partial \\nu}$ is an odd function of $\\psi_i$.\nThe dot product is a sum of the product of an even function and an odd function, which is an odd function, over a symmetric interval. This sum is zero. Therefore, for Case B, the dot product is zero, and $\\kappa = 0$.\n\n- **Case A (One-sided aperture):** The geometry is asymmetric, and the medium is anisotropic. No obvious symmetry leads to $\\kappa=0$. A full numerical calculation is required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem by computing the alignment coefficient\n    kappa for each test case.\n    \"\"\"\n\n    # Test suite parameterization:\n    # (v_parallel[m/s], v_perp[m/s], nu_true[deg], psi_center[deg], delta_half[deg], N, hetero_type)\n    test_cases = [\n        # Case A (one-sided aperture, constant tilt error)\n        (3000.0, 3300.0, 20.0, 50.0, 15.0, 13, \"constant\"),\n        # Case B (symmetric aperture about the axis, constant tilt error)\n        (3000.0, 3300.0, 0.0, 0.0, 20.0, 21, \"constant\"),\n        # Case C (isotropic medium, constant tilt error)\n        (3000.0, 3000.0, 20.0, 50.0, 15.0, 13, \"constant\"),\n        # Case D (one-sided aperture, zero-mean sinusoidal tilt heterogeneity)\n        (3000.0, 3300.0, 20.0, 50.0, 15.0, 13, \"zero-mean\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        kappa = compute_kappa(*case)\n        results.append(kappa)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{k:.6f}' for k in results)}]\")\n\n\ndef compute_kappa(v_para, v_perp, nu_deg, psi_center_deg, delta_half_deg, N, hetero_type):\n    \"\"\"\n    Computes the alignment coefficient kappa for a single test case.\n\n    Args:\n        v_para (float): Phase velocity along the symmetry axis [m/s].\n        v_perp (float): Phase velocity perpendicular to the symmetry axis [m/s].\n        nu_deg (float): Tilt angle of the symmetry axis from vertical [degrees].\n        psi_center_deg (float): Center of the receiver azimuth range [degrees].\n        delta_half_deg (float): Half-width of the receiver azimuth range [degrees].\n        N (int): Number of receivers.\n        hetero_type (str): Type of heterogeneity model (\"constant\" or \"zero-mean\").\n\n    Returns:\n        float: The calculated alignment coefficient kappa.\n    \"\"\"\n    # According to the problem definition, if the heterogeneity model is \"zero-mean\",\n    # the path-averaged tilt perturbation is zero, making the sensitivity vector g_nu\n    # a zero vector. By convention, kappa is then 0.\n    if hetero_type == \"zero-mean\":\n        return 0.0\n\n    # Convert angles from degrees to radians for trigonometric functions.\n    nu = np.deg2rad(nu_deg)\n    psi_center = np.deg2rad(psi_center_deg)\n    delta_half = np.deg2rad(delta_half_deg)\n\n    # Generate the array of receiver azimuths.\n    psi_array = np.linspace(psi_center - delta_half, psi_center + delta_half, N)\n\n    # Calculate slowness tensor coefficients.\n    a = 1.0 / v_perp**2\n    b = 1.0 / v_para**2\n\n    # If the medium is isotropic (v_para == v_perp), then a == b.\n    # The sensitivity to nu becomes zero, making g_nu a zero vector, so kappa is 0.\n    # This check handles Case C analytically.\n    if np.isclose(a, b):\n        return 0.0\n\n    g_v_components = []\n    g_nu_components = []\n\n    for psi in psi_array:\n        diff_angle = psi - nu\n        \n        # Calculate squared phase slowness s^2\n        s_squared = a * np.sin(diff_angle)**2 + b * np.cos(diff_angle)**2\n        s = np.sqrt(s_squared)\n\n        # Calculate sensitivity of slowness to v_parallel\n        # ds/dv_para = -cos^2(psi-nu) / (s * v_para^3)\n        ds_dv_para = - (np.cos(diff_angle)**2) / (s * v_para**3)\n\n        # Calculate sensitivity of slowness to nu\n        # ds/dnu = (b-a) * sin(2*(psi-nu)) / (2*s)\n        ds_dnu = (b - a) * np.sin(2 * diff_angle) / (2 * s)\n\n        g_v_components.append(ds_dv_para)\n        g_nu_components.append(ds_dnu)\n\n    # Form sensitivity vectors from their components.\n    g_v = np.array(g_v_components)\n    g_nu = np.array(g_nu_components)\n    \n    # Calculate norms of the sensitivity vectors.\n    norm_v = np.linalg.norm(g_v)\n    norm_nu = np.linalg.norm(g_nu)\n\n    # If either norm is zero (or close to it numerically), kappa is 0.\n    # This will naturally handle Case B (symmetry) and Case C (isotropy).\n    if np.isclose(norm_v, 0.0) or np.isclose(norm_nu, 0.0):\n        return 0.0\n\n    # Calculate the dot product of the vectors.\n    dot_product = np.dot(g_v, g_nu)\n\n    # Calculate kappa, the normalized absolute dot product (cosine similarity).\n    kappa = np.abs(dot_product) / (norm_v * norm_nu)\n    \n    return kappa\n\n# Execute the main function when the script is run.\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "The success of multiparameter FWI is not just about algorithms; it depends critically on the seismic data itself. This practice addresses the fundamental problem of acquisition design: how can we plan a survey to ensure the resulting data can resolve complex anisotropic parameters? You will search for the most efficient combination of measurement offsets and azimuths that yields a well-conditioned inverse problem, providing a hands-on understanding of how to proactively mitigate the parameter cross-talk issues that often plague advanced seismic imaging. ",
            "id": "3611578",
            "problem": "You are given a linearized acquisition design problem for Full Waveform Inversion (FWI) in an orthorhombic medium. The physical starting point is the first-order Born approximation for small contrasts across a planar interface, under which the scattered wavefield is linear in the model perturbations and the observed azimuthal Amplitude Versus Offset (AVO) reflectivity can be represented as a linear combination of azimuthal harmonics. Orthorhombic symmetry implies an azimuthal dependence of the plane-wave P-wave reflectivity that can be expressed as a truncated series in even azimuthal orders. In the small-contrast limit, and for moderate incidence angles, it is standard to adopt a separable representation of basis functions in incidence angle and azimuth. The goal is to determine the minimum azimuthal and offset coverage required to robustly recover an orthorhombic contrast parameter vector by ensuring the sensitivity matrix is invertible and well-conditioned.\n\nMathematical setup:\n- Let the incidence angle be denoted by $\\theta$ and the azimuth by $\\phi$.\n- Let the parameter vector $\\mathbf{c} \\in \\mathbb{R}^{m}$ represent linear combinations of stiffness contrasts that project onto a chosen basis of radiation patterns. The predicted linearized reflectivity sample at a particular pair $(\\theta,\\phi)$ is a linear function of $\\mathbf{c}$.\n- Define a set of $m$ basis functions $\\{b_{k}(\\theta,\\phi)\\}_{k=1}^{m}$. Each basis function is constructed as the product of an incidence-angle factor and an azimuthal harmonic:\n  $$ b_{k}(\\theta,\\phi) = \\left[\\sin(\\theta)\\right]^{p_k} \\cdot t_k\\big(n_k \\phi\\big), $$\n  where $p_k \\in \\{0,2,4\\}$ is an integer power, $n_k \\in \\{0,2,4\\}$ is an azimuthal harmonic order, and $t_k$ is one of $\\{\\cos, \\sin, 1\\}$ with the convention that $t_k(0) \\equiv 1$ for the constant azimuthal term.\n- Stack $N$ measurements taken at selected pairs $\\{(\\theta_i,\\phi_j)\\}$ into a data vector $\\mathbf{r} \\in \\mathbb{R}^{N}$ and construct the sensitivity (Jacobian) matrix $\\mathbf{A} \\in \\mathbb{R}^{N \\times m}$ with entries:\n  $$ A_{\\ell k} = b_{k}(\\theta_{\\ell}, \\phi_{\\ell}), \\quad \\ell=1,\\dots,N, \\ k=1,\\dots,m, $$\n  where each row corresponds to a unique acquisition pair.\n- Recoverability of $\\mathbf{c}$ requires that $\\mathbf{A}$ be full column rank. Robust recovery further requires the condition number $\\kappa(\\mathbf{A}) = \\sigma_{\\max} / \\sigma_{\\min}$, where $\\sigma_{\\max}$ and $\\sigma_{\\min}$ are the largest and smallest singular values of $\\mathbf{A}$, to be below a specified threshold $\\kappa_{\\max}$.\n\nTask:\n- For each test case below, you will be given:\n  1. A set of candidate azimuths $\\{\\phi\\}$ in degrees.\n  2. A set of candidate incidence angles $\\{\\theta\\}$ in degrees.\n  3. A basis specification, that is, the list of tuples $(p_k, n_k, t_k)$ that define $b_k(\\theta,\\phi)$.\n  4. A condition number threshold $\\kappa_{\\max}$.\n- Your program must search over all subsets of the candidate azimuths and candidate incidence angles to find the lexicographically minimal pair $(N_{\\phi}, N_{\\theta})$ (first minimize $N_{\\phi}$, then $N_{\\theta}$) such that there exists a choice of $N_{\\phi}$ distinct azimuths and $N_{\\theta}$ distinct incidence angles for which:\n  1. The resulting design matrix $\\mathbf{A}$ has full column rank $m$.\n  2. The condition number satisfies $\\kappa(\\mathbf{A}) \\le \\kappa_{\\max}$.\n  3. The total number of measurements $N = N_{\\phi} \\cdot N_{\\theta}$ is at least $m$.\n- If multiple subsets achieve the same minimal $(N_{\\phi}, N_{\\theta})$, choose the one with the smallest condition number.\n- If no feasible subsets exist, output the boolean value false for that test case.\n- Angles are provided in degrees; all trigonometric computations must be performed in radians. There are no physical units in the final answers beyond angles, and the final outputs are dimensionless.\n- Treat $\\mathbf{A}$ as full rank if the number of singular values greater than $\\tau$ equals $m$, where:\n  $$ \\tau = 10^{-10}. $$\n\nOutput format:\n- For each test case, output either the boolean false if infeasible, or a list $[N_{\\phi}, N_{\\theta}, \\kappa_{\\star}]$, where $\\kappa_{\\star}$ is the minimum condition number achieved among the minimal-coverage solutions, rounded to three decimal places.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets. For example, an output for three test cases might look like:\n  $$ [[3,2,12.345],[4,1,8.765],false] $$\n\nTest suite:\n- Test Case 1 (single angle-order group, five azimuthal harmonics):\n  - Basis terms $\\{(p_k, n_k, t_k)\\}_{k=1}^{5}$:\n    $$ \\{(2,0,\\mathrm{const}),\\ (2,2,\\mathrm{cos}),\\ (2,2,\\mathrm{sin}),\\ (2,4,\\mathrm{cos}),\\ (2,4,\\mathrm{sin})\\}. $$\n    This corresponds to $m=5$ unknowns.\n  - Candidate azimuths in degrees:\n    $$ \\{10, 40, 70, 100, 130, 160\\}. $$\n  - Candidate incidence angles in degrees:\n    $$ \\{15, 30, 45\\}. $$\n  - Threshold:\n    $$ \\kappa_{\\max} = 10^{3}. $$\n- Test Case 2 (two angle-order groups, four azimuthal harmonics):\n  - Basis terms $\\{(p_k, n_k, t_k)\\}_{k=1}^{8}$:\n    $$ \\{(2,0,\\mathrm{const}),\\ (2,2,\\mathrm{cos}),\\ (2,2,\\mathrm{sin}),\\ (2,4,\\mathrm{cos}),\\ (4,0,\\mathrm{const}),\\ (4,2,\\mathrm{cos}),\\ (4,2,\\mathrm{sin}),\\ (4,4,\\mathrm{cos})\\}. $$\n    This corresponds to $m=8$ unknowns.\n  - Candidate azimuths in degrees:\n    $$ \\{15, 45, 75, 105, 135, 165\\}. $$\n  - Candidate incidence angles in degrees:\n    $$ \\{10, 20, 30, 40\\}. $$\n  - Threshold:\n    $$ \\kappa_{\\max} = 5 \\times 10^{3}. $$\n- Test Case 3 (degenerate azimuth pool to test infeasibility):\n  - Basis terms identical to Test Case 2 (thus $m=8$ unknowns).\n  - Candidate azimuths in degrees:\n    $$ \\{0, 90, 180, 270\\}. $$\n  - Candidate incidence angles in degrees:\n    $$ \\{15, 35\\}. $$\n  - Threshold:\n    $$ \\kappa_{\\max} = 10^{3}. $$\n\nYour program must implement the above logic, perform all trigonometric computations in radians, and produce a single line with the outputs for the three test cases as a list of results in the format described earlier. No additional input should be read. The return types must be either booleans or lists of integers and a float as specified. The final output line should look like:\n- A single list with three elements, one per test case, where each element is either false or a three-element list with the minimal counts and the corresponding minimal condition number rounded to three decimals.",
            "solution": "The task is to solve a discrete optimization problem for experimental design. The goal is to find the minimum number of azimuths $N_{\\phi}$ and incidence angles $N_{\\theta}$ that ensure the parameter vector $\\mathbf{c}$ can be robustly determined. The robustness is quantified by the rank and condition number of the sensitivity matrix $\\mathbf{A}$.\n\n**Algorithmic Approach**\nThe problem requires finding the lexicographically minimal pair $(N_{\\phi}, N_{\\theta})$. This dictates a specific search order. We must iterate through possible values of $N_{\\phi}$ from $1$ up to the total number of candidate azimuths. For each $N_{\\phi}$, we iterate through possible values of $N_{\\theta}$ from $1$ up to the total number of candidate angles. The first pair $(N_{\\phi}, N_{\\theta})$ that yields a valid design is, by definition, the lexicographically minimal one.\n\nFor a fixed pair $(N_{\\phi}, N_{\\theta})$, we must check if there exists any combination of $N_{\\phi}$ azimuths from the candidate pool and $N_{\\theta}$ angles from the candidate pool that satisfies the given constraints. This involves the following steps:\n1.  Generate all combinations of $N_{\\phi}$ azimuths from the set of candidate azimuths.\n2.  Generate all combinations of $N_{\\theta}$ incidence angles from the set of candidate incidence angles.\n3.  For each pair of one azimuth subset and one angle subset, construct the sensitivity matrix $\\mathbf{A}$ and test its validity.\n\n**Matrix Construction**\nThe sensitivity matrix $\\mathbf{A}$ has dimensions $N \\times m$, where $N = N_{\\phi} \\cdot N_{\\theta}$ and $m$ is the number of basis functions. Each row of $\\mathbf{A}$ corresponds to a unique measurement pair $(\\theta_i, \\phi_j)$, where $\\theta_i$ is a selected incidence angle and $\\phi_j$ is a selected azimuth. Each column corresponds to a basis function $b_k(\\theta, \\phi)$. The entry at row $\\ell$ and column $k$ is $A_{\\ell k} = b_k(\\theta_{\\ell}, \\phi_{\\ell})$. The angles must be converted from degrees to radians for trigonometric computations.\nThe basis function $b_{k}(\\theta, \\phi) = [\\sin(\\theta)]^{p_k} \\cdot t_k(n_k \\phi)$ is implemented by mapping the textual identifier `const`, `cos`, or `sin` for $t_k$ to the appropriate numerical function: $f(\\alpha)=1$, $f(\\alpha)=\\cos(\\alpha)$, or $f(\\alpha)=\\sin(\\alpha)$, respectively.\n\n**Stability and Invertibility Analysis**\nThe recovery of the parameter vector $\\mathbf{c}$ from the data $\\mathbf{r}$ via the linear system $\\mathbf{A}\\mathbf{c} \\approx \\mathbf{r}$ is contingent on the properties of $\\mathbf{A}$.\n1.  **Full Column Rank**: The matrix $\\mathbf{A}$ must have a rank of $m$ for a unique solution to exist in the least-squares sense. We determine the numerical rank using Singular Value Decomposition (SVD). Let $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge \\sigma_m$ be the singular values of $\\mathbf{A}$. The rank is the count of singular values that are greater than the specified tolerance $\\tau = 10^{-10}$. If this count is $m$, the matrix is considered full rank. This requires $N = N_{\\phi} \\cdot N_{\\theta} \\ge m$.\n2.  **Condition Number**: A low condition number ensures that the solution is stable with respect to noise in the data. The condition number is $\\kappa(\\mathbf{A}) = \\sigma_1 / \\sigma_m$. For a valid design, we require $\\kappa(\\mathbf{A}) \\le \\kappa_{\\max}$.\n\n**Optimization and Final Selection**\nThe overall procedure is as follows:\n1.  Loop through $N_{\\phi}$ from $1$ to $|\\Phi_{cand}|$.\n2.  Inside, loop through $N_{\\theta}$ from $1$ to $|\\Theta_{cand}|$.\n3.  Skip pairs $(N_{\\phi}, N_{\\theta})$ where $N_{\\phi} \\cdot N_{\\theta} < m$.\n4.  For the current $(N_{\\phi}, N_{\\theta})$, initialize a minimum condition number for this size, $\\kappa_{min\\_size} = \\infty$.\n5.  Iterate through all combinations of $N_{\\phi}$ azimuths and $N_{\\theta}$ angles. For each combination:\n    a. Construct the matrix $\\mathbf{A}$.\n    b. Compute its SVD and check for full rank.\n    c. If it is full rank, compute the condition number $\\kappa$ and check if $\\kappa \\le \\kappa_{\\max}$.\n    d. If all conditions are met, update $\\kappa_{min\\_size} = \\min(\\kappa_{min\\_size}, \\kappa)$.\n6.  After checking all combinations for the current $(N_{\\phi}, N_{\\theta})$, if a valid design was found (i.e., $\\kappa_{min\\_size} < \\infty$), then $(N_{\\phi}, N_{\\theta})$ is the lexicographically minimal solution. The final result is $[N_{\\phi}, N_{\\theta}, \\kappa_{min\\_size}]$. The search for this test case terminates.\n7.  If the loops complete without finding any valid design, the problem is infeasible for the given candidates, and the result is `false`.\n\nThis structured search guarantees finding the optimal design according to the problem's criteria. For Test Case 3, a preliminary analysis reveals that the chosen azimuths $\\{0, 90, 180, 270\\}$ cause columns of the matrix $\\mathbf{A}$ to become linearly dependent (specifically, any basis term involving $\\sin(2\\phi)$ or $\\sin(4\\phi)$ will generate a zero column, and terms with $\\cos(4\\phi)$ will be identical to constant terms), making it impossible to achieve full rank $m=8$. Thus, it is expected to be infeasible.",
            "answer": "```python\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Main function to solve the acquisition design problem for all test cases.\n    \"\"\"\n    \n    # Define the trigonometric functions based on the string identifiers\n    trig_funcs = {\n        'const': lambda x: np.ones_like(x),\n        'cos': np.cos,\n        'sin': np.sin\n    }\n\n    # Rank determination threshold\n    RANK_TOLERANCE = 1e-10\n\n    test_cases = [\n        {\n            \"basis\": [(2, 0, 'const'), (2, 2, 'cos'), (2, 2, 'sin'), (2, 4, 'cos'), (2, 4, 'sin')],\n            \"phis_deg\": [10, 40, 70, 100, 130, 160],\n            \"thetas_deg\": [15, 30, 45],\n            \"kappa_max\": 1e3\n        },\n        {\n            \"basis\": [(2, 0, 'const'), (2, 2, 'cos'), (2, 2, 'sin'), (2, 4, 'cos'), \n                      (4, 0, 'const'), (4, 2, 'cos'), (4, 2, 'sin'), (4, 4, 'cos')],\n            \"phis_deg\": [15, 45, 75, 105, 135, 165],\n            \"thetas_deg\": [10, 20, 30, 40],\n            \"kappa_max\": 5e3\n        },\n        {\n            \"basis\": [(2, 0, 'const'), (2, 2, 'cos'), (2, 2, 'sin'), (2, 4, 'cos'), \n                      (4, 0, 'const'), (4, 2, 'cos'), (4, 2, 'sin'), (4, 4, 'cos')],\n            \"phis_deg\": [0, 90, 180, 270],\n            \"thetas_deg\": [15, 35],\n            \"kappa_max\": 1e3\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        basis_spec = case[\"basis\"]\n        candidate_phis_rad = np.deg2rad(case[\"phis_deg\"])\n        candidate_thetas_rad = np.deg2rad(case[\"thetas_deg\"])\n        kappa_max = case[\"kappa_max\"]\n        \n        m = len(basis_spec)\n        num_candidate_phis = len(candidate_phis_rad)\n        num_candidate_thetas = len(candidate_thetas_rad)\n\n        best_result_for_case = None\n        found_solution = False\n\n        for n_phi in range(1, num_candidate_phis + 1):\n            for n_theta in range(1, num_candidate_thetas + 1):\n                if n_phi * n_theta < m:\n                    continue\n\n                min_kappa_for_size = float('inf')\n                is_feasible_at_this_size = False\n\n                phi_subsets = itertools.combinations(candidate_phis_rad, n_phi)\n                for phi_subset in phi_subsets:\n                    theta_subsets = itertools.combinations(candidate_thetas_rad, n_theta)\n                    for theta_subset in theta_subsets:\n                        \n                        N = n_phi * n_theta\n                        A = np.zeros((N, m))\n                        \n                        measurement_pairs = list(itertools.product(theta_subset, phi_subset))\n\n                        for k, (p, n, t_str) in enumerate(basis_spec):\n                            t_func = trig_funcs[t_str]\n                            for i, (theta_val, phi_val) in enumerate(measurement_pairs):\n                                angle_factor = np.sin(theta_val)**p\n                                azim_factor = t_func(n * phi_val)\n                                A[i, k] = angle_factor * azim_factor\n                        \n                        try:\n                            s = np.linalg.svd(A, compute_uv=False)\n                        except np.linalg.LinAlgError:\n                            continue\n\n                        # Check for full rank\n                        rank = np.sum(s > RANK_TOLERANCE)\n                        if rank == m:\n                            # Check condition number\n                            # s is sorted, so s[m-1] is the smallest of the first m values.\n                            if s[m - 1] > 0:\n                                kappa = s[0] / s[m - 1]\n                                if kappa <= kappa_max:\n                                    is_feasible_at_this_size = True\n                                    if kappa < min_kappa_for_size:\n                                        min_kappa_for_size = kappa\n                \n                if is_feasible_at_this_size:\n                    best_result_for_case = [n_phi, n_theta, min_kappa_for_size]\n                    found_solution = True\n                    break # Minimal n_theta found\n            \n            if found_solution:\n                break # Minimal n_phi found\n\n        if best_result_for_case:\n            all_results.append(best_result_for_case)\n        else:\n            all_results.append(False)\n\n    # Format the final output string exactly as specified\n    formatted_items = []\n    for res in all_results:\n        if isinstance(res, list):\n            # Use f-string formatting to ensure three decimal places\n            formatted_items.append(f\"[{res[0]},{res[1]},{res[2]:.3f}]\")\n        else: # boolean False\n            formatted_items.append(\"false\")\n    \n    final_output = f\"[{','.join(formatted_items)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}