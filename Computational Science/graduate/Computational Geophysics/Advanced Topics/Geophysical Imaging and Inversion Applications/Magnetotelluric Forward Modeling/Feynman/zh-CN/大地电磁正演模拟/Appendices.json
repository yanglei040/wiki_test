{
    "hands_on_practices": [
        {
            "introduction": "电磁趋肤深度是大地电磁法最核心的概念，它决定了信号的穿透深度，从而决定了探测范围。本练习将通过从麦克斯韦方程组推导趋肤深度公式，并计算其在不同频率下的探测深度，来巩固这一基本原理。理解这种频率与深度的反比关系是设计任何大地电磁勘探和解释其结果的第一步。",
            "id": "3609004",
            "problem": "考虑一个一维平面波大地电磁（MT）正演模拟场景：一个占据 $z \\ge 0$ 区域的均匀导电半空间，其时谐源场随 $\\exp(i \\omega t)$ 变化，水平电场和磁场仅依赖于深度 $z$。从传导电流主导极限（即准静态近似）下的麦克斯韦方程组出发，假设 $\\sigma \\gg \\omega \\epsilon_0$，其中 $\\sigma$ 是电导率，$\\epsilon_0$ 是真空介电常数，$\\omega$ 是角频率。磁导率 $\\mu = \\mu_0$，其中 $\\mu_0 = 4 \\pi \\times 10^{-7} \\,\\mathrm{H/m}$。推导场在导电半空间中随深度变化的衰减规律，并得到用 $\\sigma$、$\\mu$ 和 $\\omega$ 表示的电磁趋肤深度 $\\delta$ 的表达式。\n\n使用推导出的表达式，计算在电导率 $\\sigma = 0.1 \\,\\mathrm{S/m}$、频率 $\\omega/2\\pi = f$ 分别为 $0.1$、$1$ 和 $10$ Hz 时的趋肤深度 $\\delta$。然后，根据地下电导率的主要灵敏度区间为 $[0.5 \\,\\delta, 2 \\,\\delta]$ 这一启发式规则，估算在每个频率下大地电磁法（MT）具有物理意义的灵敏度窗口。\n\n将所有数值四舍五入至三位有效数字。所有距离以千米（km）为单位表示。将最终答案以单行矩阵的形式报告，该矩阵包含九个条目，顺序为 [$ \\delta_{0.1} $, $ z_{\\min,0.1} $, $ z_{\\max,0.1} $, $ \\delta_{1} $, $ z_{\\min,1} $, $ z_{\\max,1} $, $ \\delta_{10} $, $ z_{\\min,10} $, $ z_{\\max,10} $]，其中 $\\delta_{f}$ 是频率 $f$ 处的趋肤深度，$z_{\\min,f}$ 和 $z_{\\max,f}$ 分别是频率 $f$ 处灵敏度窗口的相应下界和上界。",
            "solution": "本题要求在 大地电磁（MT）近似下，推导导电介质中的电磁趋肤深度，并随后对特定参数进行数值计算。\n\n首先，我们推导导体中电磁场的控制方程。我们从麦克斯韦方程组出发，考虑一个无自由电荷的线性、各向同性、均匀的导电介质。对于时间依赖关系为 $\\exp(i \\omega t)$ 的时谐场，法拉第定律和安培定律的相量形式为：\n$$\n\\nabla \\times \\mathbf{E} = -i \\omega \\mathbf{B}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\mathbf{J} + i \\omega \\mathbf{D}\n$$\n本构关系为 $\\mathbf{B} = \\mu \\mathbf{H}$、$\\mathbf{D} = \\epsilon \\mathbf{E}$，欧姆定律为 $\\mathbf{J} = \\sigma \\mathbf{E}$。题目指定介质的磁导率 $\\mu = \\mu_0$。安培定律变为：\n$$\n\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} + i \\omega \\epsilon \\mathbf{E} = (\\sigma + i \\omega \\epsilon) \\mathbf{E}\n$$\n题目陈述我们处于传导电流主导的极限，也称为准静态近似，其中 $\\sigma \\gg \\omega \\epsilon$。这使得我们可以忽略位移电流项 $i \\omega \\epsilon \\mathbf{E}$，因为它远小于传导电流项 $\\sigma \\mathbf{E}$。安培定律简化为：\n$$\n\\nabla \\times \\mathbf{H} \\approx \\sigma \\mathbf{E}\n$$\n为了得到电场的波动方程，我们对法拉第定律取旋度：\n$$\n\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla \\times (-i \\omega \\mathbf{B}) = -i \\omega \\mu_0 (\\nabla \\times \\mathbf{H})\n$$\n使用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ 并代入简化后的安培定律，我们得到：\n$$\n\\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E} = -i \\omega \\mu_0 \\sigma \\mathbf{E}\n$$\n在均匀导体中，电导率 $\\sigma$ 没有空间变化，因此假设不存在净电荷密度，高斯定律给出 $\\nabla \\cdot \\mathbf{E} = 0$。该方程简化为一个矢量亥姆霍兹型方程，在此背景下通常称为扩散方程：\n$$\n\\nabla^2 \\mathbf{E} = i \\omega \\mu_0 \\sigma \\mathbf{E}\n$$\n本题考虑的是一个平面波，其中场仅依赖于深度 $z$，导电介质占据 $z \\ge 0$ 的区域。对于一个水平电场分量，如 $E_x(z)$，拉普拉斯算子 $\\nabla^2$ 简化为关于 $z$ 的二阶导数 $\\frac{d^2}{dz^2}$。$E_x$ 的方程为：\n$$\n\\frac{d^2 E_x}{dz^2} = i \\omega \\mu_0 \\sigma E_x\n$$\n这是一个二阶线性常微分方程。我们可以将其写为 $\\frac{d^2 E_x}{dz^2} - k^2 E_x = 0$，其中 $k^2 = i \\omega \\mu_0 \\sigma$。其通解为 $E_x(z) = A \\exp(-kz) + B \\exp(kz)$。为了使场具有物理意义，其振幅在 $z \\to \\infty$ 时必须保持有界。这要求系数 $B$ 为 $0$。因此，解是一个向下传播的波：\n$$\nE_x(z) = E_x(0) \\exp(-kz)\n$$\n其中 $E_x(0)$ 是在表面 $z=0$ 处的场。复传播常数 $k$ 由下式给出：\n$$\nk = \\sqrt{i \\omega \\mu_0 \\sigma}\n$$\n为了理解衰减，我们将 $k$ 表示为其实部和虚部。我们使用恒等式 $\\sqrt{i} = \\frac{1+i}{\\sqrt{2}}$。\n$$\nk = \\sqrt{\\omega \\mu_0 \\sigma} \\cdot \\sqrt{i} = \\sqrt{\\omega \\mu_0 \\sigma} \\left( \\frac{1+i}{\\sqrt{2}} \\right) = \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}} + i \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\n$$\n将此代回 $E_x(z)$ 的解中：\n$$\nE_x(z) = E_x(0) \\exp\\left(-\\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right) \\exp\\left(-i \\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right)\n$$\n场的振幅为 $|E_x(z)| = |E_x(0)| \\exp\\left(-\\frac{z}{\\delta}\\right)$，其中项 $\\exp\\left(-\\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right)$ 描述了场随深度的指数衰减。电磁趋肤深度 $\\delta$ 定义为场振幅衰减至其表面值的 $1/e$ 时的深度。这发生在实指数的自变量为 $-1$ 时，即 $z \\cdot \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}} = 1$。因此，趋肤深度的表达式为：\n$$\n\\delta = \\frac{1}{\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}} = \\sqrt{\\frac{2}{\\omega \\mu_0 \\sigma}}\n$$\n考虑到角频率 $\\omega$ 和频率 $f$ 之间的关系为 $\\omega = 2 \\pi f$，该公式可以表示为：\n$$\n\\delta = \\sqrt{\\frac{2}{2 \\pi f \\mu_0 \\sigma}} = \\sqrt{\\frac{1}{\\pi f \\mu_0 \\sigma}}\n$$\n这就是所求的趋肤深度表达式。\n\n现在，我们计算具体数值。给定参数如下：\n$\\sigma = 0.1 \\,\\mathrm{S/m}$\n$\\mu_0 = 4 \\pi \\times 10^{-7} \\,\\mathrm{H/m}$\n频率 $f$ 分别为 $0.1 \\,\\mathrm{Hz}$、$1 \\,\\mathrm{Hz}$ 和 $10 \\,\\mathrm{Hz}$。\n\n我们先以米为单位计算 $\\delta$，然后转换为千米（$1\\,\\mathrm{km} = 1000\\,\\mathrm{m}$）。\n计算公式为 $\\delta = \\sqrt{\\frac{1}{\\pi f \\sigma \\mu_0}}$。\n$\\delta \\approx \\sqrt{\\frac{1}{\\pi f (0.1) (4\\pi \\times 10^{-7})}} = \\sqrt{\\frac{1}{0.4 \\pi^2 f \\times 10^{-7}}} = \\frac{1}{\\sqrt{f}}\\sqrt{\\frac{10^7}{0.4 \\pi^2}} \\approx \\frac{1591.55}{\\sqrt{f}} \\, \\mathrm{m}$。\n\n对于 $f = 0.1 \\,\\mathrm{Hz}$：\n$\\delta_{0.1} \\approx \\frac{1591.55}{\\sqrt{0.1}} \\approx 5032.9 \\,\\mathrm{m} \\approx 5.0329 \\,\\mathrm{km}$。\n四舍五入至三位有效数字，$\\delta_{0.1} = 5.03 \\,\\mathrm{km}$。\n灵敏度窗口为 $[0.5 \\delta_{0.1}, 2 \\delta_{0.1}]$：\n$z_{\\min,0.1} = 0.5 \\times 5.0329 \\,\\mathrm{km} \\approx 2.5165 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\min,0.1} = 2.52 \\,\\mathrm{km}$。\n$z_{\\max,0.1} = 2 \\times 5.0329 \\,\\mathrm{km} \\approx 10.0658 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\max,0.1} = 10.1 \\,\\mathrm{km}$。\n\n对于 $f = 1 \\,\\mathrm{Hz}$：\n$\\delta_{1} \\approx \\frac{1591.55}{\\sqrt{1}} \\approx 1591.55 \\,\\mathrm{m} \\approx 1.59155 \\,\\mathrm{km}$。\n四舍五入至三位有效数字，$\\delta_{1} = 1.59 \\,\\mathrm{km}$。\n灵敏度窗口为 $[0.5 \\delta_{1}, 2 \\delta_{1}]$：\n$z_{\\min,1} = 0.5 \\times 1.59155 \\,\\mathrm{km} \\approx 0.79578 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\min,1} = 0.796 \\,\\mathrm{km}$。\n$z_{\\max,1} = 2 \\times 1.59155 \\,\\mathrm{km} \\approx 3.1831 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\max,1} = 3.18 \\,\\mathrm{km}$。\n\n对于 $f = 10 \\,\\mathrm{Hz}$：\n$\\delta_{10} \\approx \\frac{1591.55}{\\sqrt{10}} \\approx 503.29 \\,\\mathrm{m} \\approx 0.50329 \\,\\mathrm{km}$。\n四舍五入至三位有效数字，$\\delta_{10} = 0.503 \\,\\mathrm{km}$。\n灵敏度窗口为 $[0.5 \\delta_{10}, 2 \\delta_{10}]$：\n$z_{\\min,10} = 0.5 \\times 0.50329 \\,\\mathrm{km} \\approx 0.25165 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\min,10} = 0.252 \\,\\mathrm{km}$。\n$z_{\\max,10} = 2 \\times 0.50329 \\,\\mathrm{km} \\approx 1.00658 \\,\\mathrm{km}$。四舍五入至三位有效数字，$z_{\\max,10} = 1.01 \\,\\mathrm{km}$。\n\n最终的九个值，按指定顺序排列如下：\n$\\delta_{0.1} = 5.03$, $z_{\\min,0.1} = 2.52$, $z_{\\max,0.1} = 10.1$\n$\\delta_{1} = 1.59$, $z_{\\min,1} = 0.796$, $z_{\\max,1} = 3.18$\n$\\delta_{10} = 0.503$, $z_{\\min,10} = 0.252$, $z_{\\max,10} = 1.01$\n所有数值的单位均为千米。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.03 & 2.52 & 10.1 & 1.59 & 0.796 & 3.18 & 0.503 & 0.252 & 1.01\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "尽管简单的一维模型存在解析解，但现实世界的地球物理学需要进行二维或三维的数值模拟。本练习通过解决有限域建模的两个基本问题，即基于趋肤深度设计足够精细的网格和实现吸收边界以模拟无限域，实现了从理论到计算的过渡。通过设计一个完美匹配层（Perfectly Matched Layer, PML）并量化其残余反射误差，您将对正演模型中计算精度与成本之间的权衡获得实践性的理解。",
            "id": "3608939",
            "problem": "本任务要求您从第一性原理出发，为大地电磁正演模拟设计一个三维计算网格和一个完美匹配层（PML）。大地电磁正演模拟由时谐场的麦克斯韦方程组控制。假设一个具有恒定电导率的均匀、各向同性半空间。您必须基于以下基本原理推导您的设计，并计算吸收边界对大地电磁阻抗的量化影响。\n\n基本原理：\n- 对于各向同性线性介质，频域中的麦克斯韦方程组为\n$$\\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = \\left(\\sigma + i \\omega \\epsilon\\right) \\mathbf{E},$$\n其中 $\\mathbf{E}$ 是电场，$\\mathbf{H}$ 是磁场，$\\omega$ 是角频率，$\\mu$ 是磁导率，$\\sigma$ 是电导率，$\\epsilon$ 是介电常数。\n- 对于均匀半空间，沿 $z$ 方向传播的平面波解具有一个复传播常数\n$$\\gamma = \\alpha + i \\beta = \\sqrt{i \\omega \\mu \\left(\\sigma + i \\omega \\epsilon\\right)},$$\n其中 $\\alpha$ 是衰减常数，$\\beta$ 是相位常数。振幅按 $e^{-\\alpha z}$ 衰减，相位按 $e^{i \\beta z}$ 前进。\n- 趋肤深度定义为\n$$\\delta = \\frac{1}{\\alpha},$$\n并且在以传导为主的区域（$\\sigma \\gg \\omega \\epsilon$），近似式\n$$\\delta \\approx \\sqrt{\\frac{2}{\\mu \\sigma \\omega}}$$\n成立。\n- 均匀半空间的大地电磁表面阻抗（切向电场与磁场之比）为\n$$Z_{\\text{exact}} = \\sqrt{\\frac{i \\omega \\mu}{\\sigma + i \\omega \\epsilon}}.$$\n\n吸收边界建模：\n- 为了截断计算域，您将附加一个厚度为 $L_{\\text{pml}}$ 的匹配吸收层（完美匹配层 (PML)）。假设 PML 与内部介质匹配以消除入口界面的反射，并且其有效电导率按比例因子 $s_{\\text{pml}} \\geq 1$ 缩放，即 $\\sigma_{\\text{pml}} = s_{\\text{pml}} \\sigma$，同时保持相同的 $\\mu$ 和 $\\epsilon$。PML 中的复传播常数为\n$$\\gamma_{\\text{pml}} = \\alpha_{\\text{pml}} + i \\beta_{\\text{pml}} = \\sqrt{i \\omega \\mu \\left(\\sigma_{\\text{pml}} + i \\omega \\epsilon\\right)}.$$\n- PML 的远端由一个硬边界终止，该边界会产生电场的反射，并伴有 $\\pi$ 弧度的相移（对于切向电场，表现为理想电导体行为）。波无反射地进入 PML，传播到硬终止端，反射，然后反向传播回来。往返振幅衰减因子为\n$$r = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}}.$$\n- 往返相位累积为\n$$\\theta = 2 \\beta_{\\text{pml}} L_{\\text{pml}} + \\pi.$$\n- 前向和后向平面波在观测点叠加。由于后向传播波的磁场相对于电场反号，由残余反射引起的表面扰动阻抗为\n$$Z_{\\text{num}} = Z_{\\text{exact}} \\, \\frac{1 + r e^{i \\theta}}{1 - r e^{i \\theta}}.$$\n\n设计要求：\n- 根据规则，使用内部介质在给定频率下的最小趋肤深度来设计网格间距 $h$。\n$$h = \\frac{\\delta_{\\text{base}}}{N}, \\quad \\delta_{\\text{base}} = \\frac{1}{\\alpha_{\\text{base}}}, \\quad \\alpha_{\\text{base}} = \\Re\\left(\\sqrt{i \\omega \\mu \\left(\\sigma + i \\omega \\epsilon\\right)}\\right),$$\n其中 $N$ 是一个指定每个趋肤深度分辨率的正整数。使用 $N = 10$。\n- 选择 PML 厚度 $L_{\\text{pml}}$ 以确保目标反射幅度严格小于 $1\\%$，即 $r \\leq 0.01$。将 $L_{\\text{pml}}$ 推导为 $\\alpha_{\\text{pml}}$ 和目标 $r$ 的函数。使用自然对数。在每个笛卡尔方向的两侧都放置 PML。您必须按如下方式计算每个方向上的总单元数\n$$N_x = \\left\\lceil \\frac{L_x}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil, \\quad N_y = \\left\\lceil \\frac{L_y}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil, \\quad N_z = \\left\\lceil \\frac{L_z}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil.$$\n\n量化影响：\n- 计算 $Z_{\\text{exact}}$ 和 $Z_{\\text{num}}$。报告相对幅度误差\n$$\\varepsilon_{\\text{mag}} = \\frac{\\left|\\,|Z_{\\text{num}}| - |Z_{\\text{exact}}|\\,\\right|}{|Z_{\\text{exact}}|},$$\n以及以弧度为单位的绝对相位误差\n$$\\varepsilon_{\\phi} = \\left| \\arg\\left(Z_{\\text{num}}\\right) - \\arg\\left(Z_{\\text{exact}}\\right) \\right|.$$\n\n单位和数值规范：\n- 所有长度必须以米为单位计算和报告。\n- 频率必须以赫兹为单位。\n- 角度必须以弧度为单位。\n- 使用 $\\mu = \\mu_0 = 4 \\pi \\times 10^{-7}$ 亨利/米 和 $\\epsilon = \\epsilon_0 = 8.854187817 \\times 10^{-12}$ 法拉/米。\n- 按规定将最终数值输出表示为浮点数或整数。\n- 网格间距 $h$ 和 PML 厚度 $L_{\\text{pml}}$ 必须以米为单位报告。\n\n测试套件：\n- 使用以下三个测试用例，每个用例由 $(f, \\sigma, L_x, L_y, L_z, s_{\\text{pml}}, r_{\\text{target}})$ 定义：\n    1. $(1.0, 0.1, 20000.0, 20000.0, 30000.0, 1.0, 0.01)$\n    2. $(10.0, 1.0, 10000.0, 10000.0, 15000.0, 2.0, 0.01)$\n    3. $(0.001, 0.01, 50000.0, 50000.0, 80000.0, 1.0, 0.01)$\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果本身必须是按以下顺序排列的列表：\n$$[h, L_{\\text{pml}}, N_x, N_y, N_z, \\Re(Z_{\\text{exact}}), \\Im(Z_{\\text{exact}}), \\Re(Z_{\\text{num}}), \\Im(Z_{\\text{num}}), \\varepsilon_{\\text{mag}}, \\varepsilon_{\\phi}].$$\n- 例如，最终打印的行必须看起来像一个包含三个带括号列表的单一带括号列表，其中包含数值条目，并且打印的列表中不显示单位。",
            "solution": "用户提供了一个科学上合理且定义明确的问题。任务是为大地电磁（MT）正演模拟设计一个计算网格和一个完美匹配层（PML），并量化由 PML 边界条件引入的数值误差。所提供的框架基于基础电磁理论。以下解决方案展示了所需参数的推导过程以及计算指定误差指标的程序。\n\n问题始于线性、各向同性介质在频域中的麦克斯韦方程组，其介电常数为 $\\epsilon$，磁导率为 $\\mu$，电导率为 $\\sigma$：\n$$ \\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = (\\sigma + i \\omega \\epsilon) \\mathbf{E} $$\n此处，$\\mathbf{E}$ 和 $\\mathbf{H}$ 分别是电场和磁场的复相量，$\\omega$ 是角频率。\n\n对于在均匀介质中沿 $z$ 方向传播的平面波，场的变化形式为 $e^{-\\gamma z}$，其中 $\\gamma$ 是复传播常数，由下式给出：\n$$ \\gamma = \\sqrt{i \\omega \\mu (\\sigma + i \\omega \\epsilon)} $$\n传播常数分解为其实部和虚部，$\\gamma = \\alpha + i\\beta$，其中 $\\alpha$ 是衰减常数，$\\beta$ 是相位常数。\n\n计算网格和 PML 的设计过程以及误差分析按以下步骤进行。\n\n**1. 网格间距设计**\n\n数值模拟的分辨率必须足以精确表示波现象。在大地电磁法（MT）中，这由趋肤深度 $\\delta$ 决定，即波振幅衰减到 $1/e$ 所经过的距离。它被定义为衰减常数的倒数。对于内部计算域（“基础”介质），衰减常数为：\n$$ \\alpha_{\\text{base}} = \\Re(\\gamma_{\\text{base}}) = \\Re\\left(\\sqrt{i \\omega \\mu (\\sigma + i \\omega \\epsilon)}\\right) $$\n相应的趋肤深度为：\n$$ \\delta_{\\text{base}} = \\frac{1}{\\alpha_{\\text{base}}} $$\n为确保对场的充分采样，网格间距 $h$ 被设置为该趋肤深度的一部分，由一个整数分辨率因子 $N$ 控制。问题指定 $N=10$，得出网格间距为：\n$$ h = \\frac{\\delta_{\\text{base}}}{N} $$\n\n**2. 完美匹配层 (PML) 设计**\n\n为了在有限的计算网格上模拟无限半空间，需要吸收边界条件来防止来自域边界的非物理反射。问题指定了一个简化的 PML 模型，其中该层与内部介质匹配（$\\mu$ 和 $\\epsilon$ 相同），但具有一个缩放的电导率 $\\sigma_{\\text{pml}} = s_{\\text{pml}} \\sigma$，其中 $s_{\\text{pml}} \\geq 1$。这增加了 PML 内部的衰减。\n\nPML 内部的传播常数为：\n$$ \\gamma_{\\text{pml}} = \\sqrt{i \\omega \\mu (\\sigma_{\\text{pml}} + i \\omega \\epsilon)} $$\nPML 中的衰减常数 $\\alpha_{\\text{pml}} = \\Re(\\gamma_{\\text{pml}})$ 决定了该层的吸收效率。PML 由一个理想电导体（PEC）边界终止，该边界反射入射波。波穿过厚度为 $L_{\\text{pml}}$ 的 PML，从 PEC 反射，然后再次穿过 PML 返回。波振幅的总往返衰减由因子 $r = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}}$ 给出。\n\n为了达到期望的吸收水平，我们要求此反射幅度 $r$ 小于或等于目标值 $r_{\\text{target}}$。为了找到所需的最小 PML 厚度，我们通过设置 $r = r_{\\text{target}}$ 来求解 $L_{\\text{pml}}$：\n$$ r_{\\text{target}} = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}} $$\n对两边取自然对数，得到：\n$$ \\ln(r_{\\text{target}}) = -2 \\alpha_{\\text{pml}} L_{\\text{pml}} $$\n$$ L_{\\text{pml}} = -\\frac{\\ln(r_{\\text{target}})}{2 \\alpha_{\\text{pml}}} $$\n由于 $r_{\\text{target}}  1$，$\\ln(r_{\\text{target}})$ 是负数，从而确保 $L_{\\text{pml}}$ 是正数。\n\n**3. 总网格尺寸**\n\n计算域由一个尺寸为 $L_x \\times L_y \\times L_z$ 的中心感兴趣区域组成，该区域在每个方向的两侧都被厚度为 $L_{\\text{pml}}$ 的 PML 包围。每个方向上的总单元数是通过将中心区域和两个 PML 区域的单元数相加来计算的。使用向上取整函数 $\\lceil \\cdot \\rceil$ 确保整个物理域被整数个单元覆盖：\n$$ N_x = \\left\\lceil \\frac{L_x}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil $$\n$$ N_y = \\left\\lceil \\frac{L_y}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil $$\n$$ N_z = \\left\\lceil \\frac{L_z}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil $$\n请注意，问题将 PML 应用于立方体域的所有六个面，包括顶部（$z=0$ 侧）和底部。\n\n**4. 阻抗与误差计算**\n\n在大地电磁法（MT）中，主要关注的量是表面阻抗 $Z$，即切向电场与切向磁场之比。对于均匀半空间，精确的解析卡尼亚阻抗（Cagniard impedance）为：\n$$ Z_{\\text{exact}} = \\sqrt{\\frac{i \\omega \\mu}{\\sigma + i \\omega \\epsilon}} $$\n具有不完美吸收边界的有限计算域会引入数值误差。来自 PML 硬壁终止端的残余反射波与前向波叠加。在表面的叠加产生了一个受扰动的数值阻抗 $Z_{\\text{num}}$。这种扰动是反射幅度 $r$ 和往返相位累积 $\\theta$ 的函数。相位累积包括传播路径和从 PEC 边界反射时的 $\\pi$ 弧度相移：\n$$ \\theta = 2 \\beta_{\\text{pml}} L_{\\text{pml}} + \\pi $$\n其中 $\\beta_{\\text{pml}} = \\Im(\\gamma_{\\text{pml}})$ 是 PML 中的相位常数。数值阻抗则由下式给出：\n$$ Z_{\\text{num}} = Z_{\\text{exact}} \\, \\frac{1 + r e^{i \\theta}}{1 - r e^{i \\theta}} $$\n其中我们使用 $r = r_{\\text{target}}$ 作为最坏情况下的反射幅度。\n\nPML 的影响通过相对幅度误差 $\\varepsilon_{\\text{mag}}$ 和绝对相位误差 $\\varepsilon_{\\phi}$ 比较 $Z_{\\text{num}}$ 与 $Z_{\\text{exact}}$ 来量化：\n$$ \\varepsilon_{\\text{mag}} = \\frac{\\left|\\,|Z_{\\text{num}}| - |Z_{\\text{exact}}|\\,\\right|}{|Z_{\\text{exact}}|} $$\n$$ \\varepsilon_{\\phi} = \\left| \\arg\\left(Z_{\\text{num}}\\right) - \\arg\\left(Z_{\\text{exact}}\\right) \\right| $$\n其中 $|z|$ 表示复数 $z$ 的幅度，$\\arg(z)$ 表示其相位角。\n\n**计算步骤总结**\n\n对于由 $(f, \\sigma, L_x, L_y, L_z, s_{\\text{pml}}, r_{\\text{target}})$ 定义的每个测试用例：\n1.  设置常数 $\\mu_0 = 4\\pi \\times 10^{-7}$ 和 $\\epsilon_0 = 8.854187817 \\times 10^{-12}$。\n2.  计算角频率 $\\omega = 2\\pi f$。\n3.  计算基础传播常数 $\\gamma_{\\text{base}}$ 和衰减常数 $\\alpha_{\\text{base}}$。\n4.  计算基础趋肤深度 $\\delta_{\\text{base}} = 1/\\alpha_{\\text{base}}$ 和网格间距 $h = \\delta_{\\text{base}}/10$。\n5.  确定 PML 电导率 $\\sigma_{\\text{pml}}$、传播常数 $\\gamma_{\\text{pml}}$ 和衰减常数 $\\alpha_{\\text{pml}}$。\n6.  使用 $r_{\\text{target}}$ 计算所需的 PML 厚度 $L_{\\text{pml}}$。\n7.  计算总单元数 $N_x$, $N_y$ 和 $N_z$。\n8.  计算精确阻抗 $Z_{\\text{exact}}$。\n9.  计算往返相移 $\\theta$ 并与 $r_{\\text{target}}$ 一起使用以求得数值阻抗 $Z_{\\text{num}}$。\n10. 确定误差 $\\varepsilon_{\\text{mag}}$ 和 $\\varepsilon_{\\phi}$。\n11. 整理 11 个所需的输出值：$h, L_{\\text{pml}}, N_x, N_y, N_z, \\Re(Z_{\\text{exact}}), \\Im(Z_{\\text{exact}}), \\Re(Z_{\\text{num}}), \\Im(Z_{\\text{num}}), \\varepsilon_{\\text{mag}}, \\varepsilon_{\\phi}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes mesh parameters, PML design, and resulting impedance errors for\n    magnetotelluric forward modeling based on the provided problem statement.\n    \"\"\"\n    # Physical constants\n    MU_0 = 4 * np.pi * 1e-7  # Magnetic permeability of free space (H/m)\n    EPS_0 = 8.854187817e-12 # Electric permittivity of free space (F/m)\n    \n    # Design parameters\n    N_RESOLUTION = 10 # Cells per skin depth\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (f, sigma, Lx, Ly, Lz, s_pml, r_target)\n    test_cases = [\n        (1.0, 0.1, 20000.0, 20000.0, 30000.0, 1.0, 0.01),\n        (10.0, 1.0, 10000.0, 10000.0, 15000.0, 2.0, 0.01),\n        (0.001, 0.01, 50000.0, 50000.0, 80000.0, 1.0, 0.01),\n    ]\n\n    results = []\n    for case in test_cases:\n        f, sigma, Lx, Ly, Lz, s_pml, r_target = case\n\n        # 1. Calculate base medium properties and mesh spacing\n        omega = 2 * np.pi * f\n        \n        # Propagation constant in the base medium\n        gamma_base_sq = 1j * omega * MU_0 * (sigma + 1j * omega * EPS_0)\n        gamma_base = np.sqrt(gamma_base_sq)\n        alpha_base = gamma_base.real\n        \n        # Skin depth and mesh spacing\n        delta_base = 1.0 / alpha_base\n        h = delta_base / N_RESOLUTION\n\n        # 2. Design the Perfectly Matched Layer (PML)\n        sigma_pml = s_pml * sigma\n        \n        # Propagation constant in the PML\n        gamma_pml_sq = 1j * omega * MU_0 * (sigma_pml + 1j * omega * EPS_0)\n        gamma_pml = np.sqrt(gamma_pml_sq)\n        alpha_pml = gamma_pml.real\n        beta_pml = gamma_pml.imag\n        \n        # Required PML thickness\n        L_pml = -np.log(r_target) / (2 * alpha_pml)\n\n        # 3. Calculate total number of cells\n        # The number of cells must be an integer.\n        Nx = int(np.ceil(Lx / h) + 2 * np.ceil(L_pml / h))\n        Ny = int(np.ceil(Ly / h) + 2 * np.ceil(L_pml / h))\n        Nz = int(np.ceil(Lz / h) + 2 * np.ceil(L_pml / h))\n        \n        # 4. Calculate impedances\n        # Exact impedance for the homogeneous half-space\n        Z_exact_sq = (1j * omega * MU_0) / (sigma + 1j * omega * EPS_0)\n        Z_exact = np.sqrt(Z_exact_sq)\n\n        # Numerical impedance considering the reflection from the PML boundary\n        r = r_target\n        theta = 2 * beta_pml * L_pml + np.pi\n        \n        # Correction factor due to reflection\n        correction_factor = (1 + r * np.exp(1j * theta)) / (1 - r * np.exp(1j * theta))\n        Z_num = Z_exact * correction_factor\n\n        # 5. Quantify the errors\n        # Relative magnitude error\n        eps_mag = np.abs(np.abs(Z_num) - np.abs(Z_exact)) / np.abs(Z_exact)\n        \n        # Absolute phase error in radians\n        eps_phi = np.abs(np.angle(Z_num) - np.angle(Z_exact))\n\n        # 6. Collate results in the required order\n        case_results = [\n            h, L_pml, Nx, Ny, Nz,\n            Z_exact.real, Z_exact.imag,\n            Z_num.real, Z_num.imag,\n            eps_mag, eps_phi\n        ]\n        results.append(case_results)\n\n    # Format the final output string exactly as required, creating a list of lists.\n    # e.g., [[...],[...],[...]]\n    outer_list_str = []\n    for res_list in results:\n        # Convert each float/int in the inner list to a string\n        inner_list_str_parts = [f\"{x:.12g}\" for x in res_list]\n        # Join them with commas and enclose in brackets\n        inner_list_str = \"[\" + \",\".join(inner_list_str_parts) + \"]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = \"[\" + \",\".join(outer_list_str) + \"]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "地质介质在所有尺度上都存在非均质性，但我们的数值模型分辨率却是有限的。本练习探讨了如何使用均匀化理论来表示次网格尺度的结构，从而为等效电导率以及可观测的阻抗提供边界。此外，通过计算阻抗对这些微观属性的灵敏度，您将迈出走向反演建模的关键第一步，反演的目标正是从地表测量中推断地球内部结构。",
            "id": "3608984",
            "problem": "您需要使用层状微观结构的均匀化方法，分析复大地电磁阻抗 $Z$ 对子网格电导率的灵敏度，并通过Voigt和Reuss平均计算等效阻抗的严格边界。物理背景为一维大地电磁学，其中包含水平层状微观结构，其特征厚度远小于电磁趋肤深度，因此均匀化方法适用。\n\n从线性、各向同性、导电介质中的频域麦克斯韦方程组和本构关系出发：\n- 法拉第定律：$\\nabla \\times \\mathbf{E} = - i \\omega \\mathbf{B}$，\n- 安培定律（准静态大地电磁学，忽略位移电流）：$\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$，\n- 本构关系：$\\mathbf{B} = \\mu_0 \\mathbf{H}$，$\\mathbf{J} = \\sigma \\mathbf{E}$，\n其中 $\\omega$ 是角频率，$\\sigma$ 是电导率，$\\mu_0$ 是真空磁导率，$\\mathbf{E}$ 是电场，$\\mathbf{H}$ 是磁场，$\\mathbf{B}$ 是磁通量密度。\n\n在一维随深度（坐标 $z$）变化、平面波激励和水平场（$\\mathbf{E} = E_x(z) \\hat{\\mathbf{x}}$，$\\mathbf{H} = H_y(z) \\hat{\\mathbf{y}}$）的条件下，推导均匀半空间的表面阻抗 $Z = E_x(0)/H_y(0)$，用 $\\omega$、$\\mu_0$ 和 $\\sigma$ 表示。解释 $\\mathbf{H}$ 的扩散方程如何导致复传播常数，进而得到复阻抗。\n\n现在考虑一个占据大尺度半空间的宏观单元内的子网格层状微观结构。设微观结构内有 $m$ 个层，每层都是各向同性的，其电导率为 $\\sigma_i$，体积分数为 $\\phi_i$，满足 $\\sum_{i=1}^{m} \\phi_i = 1$ 且 $\\sigma_i > 0$。对于水平层状微观结构，Voigt（并联）和Reuss（串联）均匀化方法为等效电导率提供了边界：\n- Voigt界（算术平均）：$\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i$，\n- Reuss界（调和平均）：$\\sigma_{\\mathrm{R}} = \\left(\\sum_{i=1}^{m} \\frac{\\phi_i}{\\sigma_i}\\right)^{-1}$。\n将这些等效电导率作为均匀半空间的替代，通过将 $\\sigma_{\\mathrm{V}}$ 和 $\\sigma_{\\mathrm{R}}$ 代入均匀半空间阻抗公式，为每个测试用例生成两个边界阻抗。\n\n将阻抗对子网格电导率的灵敏度定义为偏导数向量 $\\left(\\frac{\\partial Z}{\\partial \\sigma_1}, \\dots, \\frac{\\partial Z}{\\partial \\sigma_m}\\right)$。使用链式法则，即 $\\frac{\\partial Z}{\\partial \\sigma_i} = \\frac{\\partial Z}{\\partial \\sigma_{\\mathrm{eff}}} \\frac{\\partial \\sigma_{\\mathrm{eff}}}{\\partial \\sigma_i}$（其中 $\\sigma_{\\mathrm{eff}} \\in \\{\\sigma_{\\mathrm{V}}, \\sigma_{\\mathrm{R}}\\}$），推导在两种均匀化规则下 $\\frac{\\partial Z}{\\partial \\sigma_i}$ 的表达式。为报告一个标量度量，使用复灵敏度向量的欧几里得范数，定义为 $\\left\\|\\frac{\\partial Z}{\\partial \\boldsymbol{\\sigma}}\\right\\|_2 = \\sqrt{\\sum_{i=1}^{m} \\left|\\frac{\\partial Z}{\\partial \\sigma_i}\\right|^2}$。\n\n数值要求：\n- 使用 $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$。\n- 所有电导率 $\\sigma_i$ 的单位为 $\\mathrm{S/m}$。\n- 频率 $f$ 以 $\\mathrm{Hz}$ 为单位给出，并通过 $\\omega = 2 \\pi f$ 与角频率相关联。\n- 报告阻抗 $Z$，单位为 $\\mathrm{\\Omega}$，包括实部和虚部。\n- 报告灵敏度范数，单位为 $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$。\n- 角度（如有）必须以弧度为单位，但您无需报告任何角度。\n\n测试套件：\n您必须评估以下四个测试用例：\n1. 情况A（体积分数均衡，对比度适中）：$f = 0.1$，其中 $m = 2$，$\\boldsymbol{\\sigma} = [0.01, 1.0]$，$\\boldsymbol{\\phi} = [0.5, 0.5]$。\n2. 情况B（对比度范围宽，体积分数偏斜）：$f = 1.0$，其中 $m = 3$，$\\boldsymbol{\\sigma} = [0.001, 0.1, 10.0]$，$\\boldsymbol{\\phi} = [0.2, 0.3, 0.5]$。\n3. 情况C（低频，高阻组分占主导）：$f = 0.01$，其中 $m = 2$，$\\boldsymbol{\\sigma} = [0.01, 1.0]$，$\\boldsymbol{\\phi} = [0.9, 0.1]$。\n4. 情况D（高频，属性均等）：$f = 10.0$，其中 $m = 3$，$\\boldsymbol{\\sigma} = [0.05, 0.05, 0.05]$，$\\boldsymbol{\\phi} = [1/3, 1/3, 1/3]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个六元素列表 $[\\Re(Z_{\\mathrm{V}}), \\Im(Z_{\\mathrm{V}}), \\Re(Z_{\\mathrm{R}}), \\Im(Z_{\\mathrm{R}}), \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{V}}, \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{R}}]$。条目按照上面列出的测试用例的顺序排列。例如，总输出必须看起来像 $[[a_1,b_1,c_1,d_1,e_1,g_1],[a_2,b_2,c_2,d_2,e_2,g_2],[a_3,b_3,c_3,d_3,e_3,g_3],[a_4,b_4,c_4,d_4,e_4,g_4]]$，所有阻抗分量的单位为 $\\mathrm{\\Omega}$，灵敏度范数的单位为 $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$。",
            "solution": "我们从适用于大地电磁正演模拟的第一性原理出发。在频域中，控制关系是法拉第定律 $\\nabla \\times \\mathbf{E} = - i \\omega \\mathbf{B}$ 和准静态状态下的安培定律 $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$，以及本构关系 $\\mathbf{B} = \\mu_0 \\mathbf{H}$ 和欧姆定律 $\\mathbf{J} = \\sigma \\mathbf{E}$。对于随深度坐标 $z$ 的一维变化和水平极化场 $\\mathbf{E} = E_x(z) \\hat{\\mathbf{x}}$，$\\mathbf{H} = H_y(z) \\hat{\\mathbf{y}}$，这些方程简化为耦合常微分方程。\n\n根据安培定律，电场的 $x$ 分量与磁场的导数相关：$E_x = \\frac{1}{\\sigma} \\left(\\nabla \\times \\mathbf{H}\\right)_x = \\frac{1}{\\sigma} \\frac{\\partial H_y}{\\partial z}$。根据法拉第定律和 $\\mathbf{B} = \\mu_0 \\mathbf{H}$，电场的旋度满足 $\\left(\\nabla \\times \\mathbf{E}\\right)_y = - i \\omega \\mu_0 H_y$。将 $E_x$ 对 $z$ 求导并代入法拉第定律，得到磁场的扩散方程：\n$$\n\\frac{d^2 H_y}{d z^2} = i \\omega \\mu_0 \\sigma H_y.\n$$\n该线性方程具有指数解 $H_y(z) = H_0 \\exp(-k z)$，其中复传播常数 $k$ 满足 $k^2 = i \\omega \\mu_0 \\sigma$。为确保场在半空间中随深度衰减，我们选择实部为正的分支，得到 $k = (1 + i) \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}$。\n\n表面阻抗 $Z$ 定义为地表（$z = 0$）处水平电场与水平磁场的比值：\n$$\nZ = \\frac{E_x(0)}{H_y(0)}.\n$$\n使用 $E_x = \\frac{1}{\\sigma} \\frac{d H_y}{d z}$ 和指数解 $\\frac{d H_y}{d z} = - k H_y$，我们得到\n$$\nZ = - \\frac{k}{\\sigma}.\n$$\n代入前面选择的 $k$，得到典型的均匀半空间阻抗\n$$\nZ(\\sigma) = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma}},\n$$\n它完全由角频率 $\\omega$、真空磁导率 $\\mu_0$ 和电导率 $\\sigma$ 决定。其实部和虚部相等且为正，表示电场相对于磁场有 $45^\\circ$ 的相位超前。\n\n我们现在通过均匀化方法引入子网格层状微观结构。考虑 $m$ 个层，其电导率为 $\\sigma_i$，体积分数为 $\\phi_i$，满足 $\\sum_{i=1}^{m} \\phi_i = 1$ 且 $\\sigma_i > 0$。对于水平层状微观结构，Voigt和Reuss平均为等效电导率提供了两个经典的边界：\n- Voigt平均（并联排列，算术平均）：\n$$\n\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i.\n$$\n- Reuss平均（串联排列，调和平均）：\n$$\n\\sigma_{\\mathrm{R}} = \\left(\\sum_{i=1}^{m} \\frac{\\phi_i}{\\sigma_i}\\right)^{-1}.\n$$\n在均匀半空间阻抗表达式中使用这些等效电导率，得到两个边界阻抗：\n$$\nZ_{\\mathrm{V}} = Z(\\sigma_{\\mathrm{V}}), \\quad Z_{\\mathrm{R}} = Z(\\sigma_{\\mathrm{R}}).\n$$\n\n为分析对子网格电导率的灵敏度，将 $Z$ 对 $\\boldsymbol{\\sigma} = (\\sigma_1, \\dots, \\sigma_m)$ 的灵敏度向量定义为\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_1}, \\dots, \\frac{\\partial Z}{\\partial \\sigma_m}\\right).\n$$\n通过均匀化映射应用链式法则可得\n$$\n\\frac{\\partial Z}{\\partial \\sigma_i} = \\frac{\\partial Z}{\\partial \\sigma_{\\mathrm{eff}}} \\frac{\\partial \\sigma_{\\mathrm{eff}}}{\\partial \\sigma_i}, \\quad \\sigma_{\\mathrm{eff}} \\in \\{\\sigma_{\\mathrm{V}}, \\sigma_{\\mathrm{R}}\\}.\n$$\n均匀阻抗对电导率的导数可以直接从 $Z(\\sigma)$ 获得：\n$$\n\\frac{d Z}{d \\sigma} = \\frac{d}{d \\sigma} \\left[(1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2}} \\sigma^{-1/2} \\right] = - \\frac{1}{2} (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2}} \\sigma^{-3/2}.\n$$\n对于Voigt平均，由于 $\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i$，我们有\n$$\n\\frac{\\partial \\sigma_{\\mathrm{V}}}{\\partial \\sigma_i} = \\phi_i,\n$$\n因此\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_i}\\right)_{\\mathrm{V}} = \\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{V}}} \\phi_i.\n$$\n对于Reuss平均，令 $S = \\sum_{j=1}^{m} \\frac{\\phi_j}{\\sigma_j}$，则 $\\sigma_{\\mathrm{R}} = S^{-1}$。那么\n$$\n\\frac{\\partial \\sigma_{\\mathrm{R}}}{\\partial \\sigma_i} = - S^{-2} \\frac{\\partial S}{\\partial \\sigma_i} = - S^{-2} \\left( - \\frac{\\phi_i}{\\sigma_i^2} \\right) = \\frac{\\phi_i}{\\sigma_i^2} S^{-2} = \\phi_i \\frac{\\sigma_{\\mathrm{R}}^2}{\\sigma_i^2},\n$$\n因此\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_i}\\right)_{\\mathrm{R}} = \\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{R}}} \\phi_i \\frac{\\sigma_{\\mathrm{R}}^2}{\\sigma_i^2}.\n$$\n为报告标量灵敏度大小，我们使用复值灵敏度向量的欧几里得范数，\n$$\n\\left\\|\\frac{\\partial Z}{\\partial \\boldsymbol{\\sigma}}\\right\\|_2 = \\sqrt{\\sum_{i=1}^{m} \\left| \\frac{\\partial Z}{\\partial \\sigma_i} \\right|^2 },\n$$\n其单位为 $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$。\n\n每个测试用例的算法步骤：\n1. 根据给定的频率 $f$ 计算 $\\omega = 2 \\pi f$。\n2. 根据 $(\\sigma_i, \\phi_i)$ 计算 $\\sigma_{\\mathrm{V}}$ 和 $\\sigma_{\\mathrm{R}}$。\n3. 计算 $Z_{\\mathrm{V}} = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma_{\\mathrm{V}}}}$ 和 $Z_{\\mathrm{R}} = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma_{\\mathrm{R}}}}$。\n4. 计算 $\\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{V}}}$ 和 $\\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{R}}}$。\n5. 使用Voigt和Reuss的链式法则构建灵敏度向量，并计算其欧几里得范数。\n6. 按指定顺序为每个用例报告 $[ \\Re(Z_{\\mathrm{V}}), \\Im(Z_{\\mathrm{V}}), \\Re(Z_{\\mathrm{R}}), \\Im(Z_{\\mathrm{R}}), \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{V}}, \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{R}} ]$。\n\n科学真实性与边界情况：\n- 所有 $\\sigma_i$ 必须严格为正，以避免在Reuss平均中出现除以零的情况。\n- 体积分数之和必须为1；任何微小的数值偏差都应被校正或检查。\n- 层状微观结构的边界 $\\sigma_{\\mathrm{R}} \\le \\sigma_{\\mathrm{eff}} \\le \\sigma_{\\mathrm{V}}$ 会转化为 $|Z_{\\mathrm{V}}| \\le |Z_{\\mathrm{eff}}| \\le |Z_{\\mathrm{R}}|$，因为 $|Z| \\propto \\sigma^{-1/2}$，这提供了一个物理上一致的区间。\n\n单位：\n- $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$，\n- $\\omega$ 的单位是 $\\mathrm{rad/s}$，通过 $\\omega = 2 \\pi f$ 计算，其中 $f$ 的单位是 $\\mathrm{Hz}$，\n- $Z$ 的单位是 $\\mathrm{\\Omega}$，\n- 灵敏度范数的单位是 $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$。\n\n程序为指定的测试套件实现了这一过程，并按要求输出单行列表，其中包含每个用例的六元素结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nMU0 = 4.0 * np.pi * 1e-7  # H/m\n\ndef homogeneous_impedance(omega, sigma):\n    \"\"\"\n    Compute the homogeneous half-space magnetotelluric impedance:\n    Z(sigma) = (1 + i) * sqrt(omega * mu0 / (2 * sigma))\n    \"\"\"\n    return (1.0 + 1.0j) * np.sqrt((omega * MU0) / (2.0 * sigma))\n\ndef dZ_dsigma(omega, sigma):\n    \"\"\"\n    Derivative of Z with respect to sigma for the homogeneous half-space:\n    dZ/dsigma = - (1 + i) * 0.5 * sqrt(omega * mu0 / 2) * sigma^{-3/2}\n    \"\"\"\n    return -(1.0 + 1.0j) * 0.5 * np.sqrt(omega * MU0 / 2.0) * (sigma ** (-1.5))\n\ndef voigt_average(sigmas, phis):\n    return float(np.sum(np.array(phis) * np.array(sigmas)))\n\ndef reuss_average(sigmas, phis):\n    sigmas = np.array(sigmas, dtype=float)\n    phis = np.array(phis, dtype=float)\n    return float(1.0 / np.sum(phis / sigmas))\n\ndef sensitivity_norm_voigt(omega, sigmas, phis):\n    \"\"\"\n    Sensitivity vector under Voigt homogenization:\n    dZ/dsigma_i = (dZ/dsigma)|_{sigma_V} * phi_i\n    Return Euclidean norm of the complex sensitivity vector.\n    \"\"\"\n    sigma_V = voigt_average(sigmas, phis)\n    dZ = dZ_dsigma(omega, sigma_V)\n    sens = np.array(phis, dtype=float) * dZ  # complex vector\n    # Euclidean norm with complex magnitudes\n    return float(np.sqrt(np.sum(np.abs(sens) ** 2)))\n\ndef sensitivity_norm_reuss(omega, sigmas, phis):\n    \"\"\"\n    Sensitivity vector under Reuss homogenization:\n    dZ/dsigma_i = (dZ/dsigma)|_{sigma_R} * phi_i * (sigma_R^2 / sigma_i^2)\n    Return Euclidean norm of the complex sensitivity vector.\n    \"\"\"\n    sigmas = np.array(sigmas, dtype=float)\n    phis = np.array(phis, dtype=float)\n    sigma_R = reuss_average(sigmas, phis)\n    dZ = dZ_dsigma(omega, sigma_R)\n    weights = phis * (sigma_R ** 2) / (sigmas ** 2)\n    sens = weights * dZ  # complex vector\n    return float(np.sqrt(np.sum(np.abs(sens) ** 2)))\n\ndef compute_case(frequency_hz, sigmas, phis):\n    \"\"\"\n    Compute [Re(Z_V), Im(Z_V), Re(Z_R), Im(Z_R), ||sens_V||2, ||sens_R||2]\n    for a given test case.\n    \"\"\"\n    # Validate volume fractions sum\n    phis = np.array(phis, dtype=float)\n    sigmas = np.array(sigmas, dtype=float)\n    if not np.all(sigmas > 0.0):\n        raise ValueError(\"All conductivities must be strictly positive.\")\n    # Normalize fractions if small numerical drift\n    sphi = float(np.sum(phis))\n    if not np.isclose(sphi, 1.0):\n        phis = phis / sphi\n\n    omega = 2.0 * np.pi * float(frequency_hz)\n\n    sigma_V = voigt_average(sigmas, phis)\n    sigma_R = reuss_average(sigmas, phis)\n\n    Z_V = homogeneous_impedance(omega, sigma_V)\n    Z_R = homogeneous_impedance(omega, sigma_R)\n\n    sens_V = sensitivity_norm_voigt(omega, sigmas, phis)\n    sens_R = sensitivity_norm_reuss(omega, sigmas, phis)\n\n    return [float(np.real(Z_V)), float(np.imag(Z_V)),\n            float(np.real(Z_R)), float(np.imag(Z_R)),\n            sens_V, sens_R]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: f=0.1 Hz, m=2, sigmas=[0.01, 1.0], phis=[0.5, 0.5]\n        {\"f\": 0.1, \"sigmas\": [0.01, 1.0], \"phis\": [0.5, 0.5]},\n        # Case B: f=1.0 Hz, m=3, sigmas=[0.001, 0.1, 10.0], phis=[0.2, 0.3, 0.5]\n        {\"f\": 1.0, \"sigmas\": [0.001, 0.1, 10.0], \"phis\": [0.2, 0.3, 0.5]},\n        # Case C: f=0.01 Hz, m=2, sigmas=[0.01, 1.0], phis=[0.9, 0.1]\n        {\"f\": 0.01, \"sigmas\": [0.01, 1.0], \"phis\": [0.9, 0.1]},\n        # Case D: f=10.0 Hz, m=3, sigmas=[0.05, 0.05, 0.05], phis=[1/3, 1/3, 1/3]\n        {\"f\": 10.0, \"sigmas\": [0.05, 0.05, 0.05], \"phis\": [1.0/3.0, 1.0/3.0, 1.0/3.0]},\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_case(case[\"f\"], case[\"sigmas\"], case[\"phis\"])\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Print as nested lists with scientific notation for clarity.\n    def fmt_list(lst):\n        return \"[\" + \",\".join(f\"{x:.10e}\" for x in lst) + \"]\"\n    print(\"[\" + \",\".join(fmt_list(r) for r in results) + \"]\")\n\nsolve()\n```"
        }
    ]
}