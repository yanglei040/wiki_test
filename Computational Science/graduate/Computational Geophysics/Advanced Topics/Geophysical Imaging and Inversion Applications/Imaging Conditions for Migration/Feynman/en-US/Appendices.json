{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of migration is the imaging principle, which states that a reflector exists where the source and receiver wavefields are coherent in time and space. The zero-lag cross-correlation is the most direct mathematical implementation of this idea. This first exercise  explores the behavior of this fundamental imaging condition in a simplified but highly instructive monochromatic setting, allowing you to derive the precise relationship between image amplitude and the phase alignment of the interacting wavefields.",
            "id": "3603913",
            "problem": "In reverse time migration (RTM, Reverse Time Migration), a common imaging condition forms an image by the zero-lag cross-correlation of the source and receiver wavefields at each spatial location. Consider a monochromatic scenario at a fixed spatial point where the source wavefield and receiver wavefield are modeled as sinusoidal functions over a sufficiently long recording time covering many full periods. Specifically, let the source and receiver be given by\n$$\ns(\\mathbf{x},t)=A_{s}(\\mathbf{x})\\cos\\!\\big(\\omega t\\big),\\quad r(\\mathbf{x},t)=A_{r}(\\mathbf{x})\\cos\\!\\big(\\omega t+\\phi\\big),\n$$\nwhere $A_{s}(\\mathbf{x})$ and $A_{r}(\\mathbf{x})$ are real, slowly varying amplitudes relative to the oscillation period, $\\omega$ is a strictly positive angular frequency, and $\\phi$ is a constant phase difference that encodes kinematic mismatch between extrapolated source and receiver wavefields at the given location. Assume either a continuous-time acquisition over a finite window $[0,T]$ containing an integer number of periods, or an equivalent uniformly sampled discrete-time acquisition over many periods with sampling interval $\\Delta t$.\n\nDefine the zero-lag cross-correlation imaging condition at $\\mathbf{x}$ by\n$$\nI(\\mathbf{x})=\\int_{0}^{T}s(\\mathbf{x},t)\\,r(\\mathbf{x},t)\\,\\mathrm{d}t,\n$$\nor, in the discrete setting, the corresponding Riemann sum approximation over the recording interval. Compute $I(\\mathbf{x})$ up to a proportionality constant that may depend on the recording duration and sampling, and express your final answer as a closed-form analytic expression in terms of $A_{s}(\\mathbf{x})$, $A_{r}(\\mathbf{x})$, and $\\phi$. Then, briefly interpret how $I(\\mathbf{x})$ depends on the phase $\\phi$. Your final answer must be the requested analytic expression only, with no units and no additional commentary. Do not round; no numerical evaluation is required.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It provides a standard, simplified model to analyze the a fundamental concept in seismic imagingâ€”the zero-lag cross-correlation imaging condition in Reverse Time Migration (RTM). All necessary elements are provided for a unique solution.\n\nThe imaging condition, $I(\\mathbf{x})$, is defined by the zero-lag cross-correlation of the source wavefield, $s(\\mathbf{x},t)$, and the receiver wavefield, $r(\\mathbf{x},t)$, over a time interval $[0,T]$. At a fixed spatial point $\\mathbf{x}$, this is given by the integral:\n$$\nI(\\mathbf{x}) = \\int_{0}^{T} s(\\mathbf{x},t) \\, r(\\mathbf{x},t) \\, \\mathrm{d}t\n$$\nThe problem provides the monochromatic forms for the wavefields:\n$$\ns(\\mathbf{x},t) = A_{s}(\\mathbf{x})\\cos(\\omega t)\n$$\n$$\nr(\\mathbf{x},t) = A_{r}(\\mathbf{x})\\cos(\\omega t + \\phi)\n$$\nwhere $A_{s}(\\mathbf{x})$ and $A_{r}(\\mathbf{x})$ are the amplitudes, $\\omega$ is the angular frequency, and $\\phi$ is the phase difference. Substituting these expressions into the integral for $I(\\mathbf{x})$ yields:\n$$\nI(\\mathbf{x}) = \\int_{0}^{T} \\left[ A_{s}(\\mathbf{x})\\cos(\\omega t) \\right] \\left[ A_{r}(\\mathbf{x})\\cos(\\omega t + \\phi) \\right] \\mathrm{d}t\n$$\nThe amplitudes $A_{s}(\\mathbf{x})$ and $A_{r}(\\mathbf{x})$ are functions of the spatial coordinate $\\mathbf{x}$ only. Since the integration is with respect to time $t$, these amplitudes can be treated as constants and moved outside the integral:\n$$\nI(\\mathbf{x}) = A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x}) \\int_{0}^{T} \\cos(\\omega t) \\cos(\\omega t + \\phi) \\, \\mathrm{d}t\n$$\nTo evaluate the integral, we use the product-to-sum trigonometric identity $\\cos(A)\\cos(B) = \\frac{1}{2}[\\cos(A-B) + \\cos(A+B)]$. Let $A = \\omega t$ and $B = \\omega t + \\phi$. Then the integrand becomes:\n$$\n\\cos(\\omega t) \\cos(\\omega t + \\phi) = \\frac{1}{2} \\left[ \\cos(\\omega t - (\\omega t + \\phi)) + \\cos(\\omega t + (\\omega t + \\phi)) \\right]\n$$\n$$\n= \\frac{1}{2} \\left[ \\cos(-\\phi) + \\cos(2\\omega t + \\phi) \\right]\n$$\nSince the cosine function is even, $\\cos(-\\phi) = \\cos(\\phi)$. The integrand simplifies to:\n$$\n\\frac{1}{2} \\left[ \\cos(\\phi) + \\cos(2\\omega t + \\phi) \\right]\n$$\nNow, we substitute this back into the expression for $I(\\mathbf{x})$:\n$$\nI(\\mathbf{x}) = A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x}) \\int_{0}^{T} \\frac{1}{2} \\left[ \\cos(\\phi) + \\cos(2\\omega t + \\phi) \\right] \\mathrm{d}t\n$$\nWe can split this into two separate integrals:\n$$\nI(\\mathbf{x}) = \\frac{A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x})}{2} \\left[ \\int_{0}^{T} \\cos(\\phi) \\, \\mathrm{d}t + \\int_{0}^{T} \\cos(2\\omega t + \\phi) \\, \\mathrm{d}t \\right]\n$$\nThe first integral is straightforward, as $\\cos(\\phi)$ is a constant with respect to $t$:\n$$\n\\int_{0}^{T} \\cos(\\phi) \\, \\mathrm{d}t = \\cos(\\phi) [t]_{0}^{T} = T\\cos(\\phi)\n$$\nThe second integral is:\n$$\n\\int_{0}^{T} \\cos(2\\omega t + \\phi) \\, \\mathrm{d}t = \\left[ \\frac{\\sin(2\\omega t + \\phi)}{2\\omega} \\right]_{0}^{T} = \\frac{1}{2\\omega} \\left[ \\sin(2\\omega T + \\phi) - \\sin(\\phi) \\right]\n$$\nThe problem states that the integration interval $T$ contains an integer number of periods. The period of the wave is $T_{p} = \\frac{2\\pi}{\\omega}$. Therefore, $T = n T_{p} = n \\frac{2\\pi}{\\omega}$ for some integer $n \\ge 1$. We use this condition to simplify the result of the second integral. The term $2\\omega T$ becomes:\n$$\n2\\omega T = 2\\omega \\left( n \\frac{2\\pi}{\\omega} \\right) = 4n\\pi\n$$\nSince the sine function is $2\\pi$-periodic, $\\sin(4n\\pi + \\phi) = \\sin(\\phi)$. The second integral evaluates to zero:\n$$\n\\frac{1}{2\\omega} \\left[ \\sin(4n\\pi + \\phi) - \\sin(\\phi) \\right] = \\frac{1}{2\\omega} \\left[ \\sin(\\phi) - \\sin(\\phi) \\right] = 0\n$$\nThis result is a consequence of integrating a sinusoidal function over an integer number of its periods. The function $\\cos(2\\omega t + \\phi)$ has a period of $\\frac{2\\pi}{2\\omega} = \\frac{\\pi}{\\omega}$. Since $T = n \\frac{2\\pi}{\\omega}$, it contains $2n$ full periods of $\\cos(2\\omega t + \\phi)$, so its integral over $[0,T]$ is exactly zero.\n\nCombining the results, the expression for $I(\\mathbf{x})$ is:\n$$\nI(\\mathbf{x}) = \\frac{A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x})}{2} [T\\cos(\\phi) + 0] = \\frac{T}{2} A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x}) \\cos(\\phi)\n$$\nThe problem asks for the result up to a proportionality constant that may depend on the recording duration $T$. The term $\\frac{T}{2}$ is such a constant. Therefore, the imaging condition is proportional to the product of the amplitudes and the cosine of the phase difference:\n$$\nI(\\mathbf{x}) \\propto A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x}) \\cos(\\phi)\n$$\nThe analytic expression representing this relationship is $A_{s}(\\mathbf{x}) A_{r}(\\mathbf{x}) \\cos(\\phi)$.\n\nThe dependence of the image $I(\\mathbf{x})$ on the phase $\\phi$ is critical. The term $\\cos(\\phi)$ acts as a coherence factor. The image is maximized and positive when $\\phi = 2k\\pi$ for any integer $k$, which indicates that the source and receiver wavefields are perfectly in phase. In RTM, this corresponds to a high probability that $\\mathbf{x}$ is a point on a reflector, where the forward-propagated source field and the backward-propagated receiver field coincide in time. The image is zero when $\\phi = \\frac{\\pi}{2} + k\\pi$, meaning the fields are in quadrature (90 degrees out of phase) and their correlation over time is null. The image is maximized in magnitude but negative when $\\phi = \\pi + 2k\\pi$, where the fields are perfectly out of phase. The imaging condition thus selectively enhances locations where the wavefields interfere constructively.",
            "answer": "$$\n\\boxed{A_{s}(\\mathbf{x})A_{r}(\\mathbf{x})\\cos(\\phi)}\n$$"
        },
        {
            "introduction": "While the cross-correlation condition effectively images primary reflections, it is not foolproof; it can produce strong artifacts by correlating physically unrelated wave events. This practice  introduces a powerful method to enhance image quality by filtering contributions based on the direction of wave propagation. You will analyze and implement an imaging condition that uses the dot product of local wavenumber vectors, $\\mathbf{k}_s \\cdot \\mathbf{k}_r$, as a physical criterion to distinguish true reflections from spurious backscattered energy.",
            "id": "3603875",
            "problem": "You are given a two-dimensional constant-density acoustic medium with constant wavespeed $c$ and asked to design and evaluate an imaging condition for reverse-time migration that removes backscattered energy using a polarity test based on the dot product of local wavenumber vectors. Let the source wavefield be denoted by $u_s(\\mathbf{x},t)$ and the receiver wavefield be denoted by $u_r(\\mathbf{x},t)$. Consider the standard zero-lag cross-correlation imaging condition $I_0(\\mathbf{x})=\\int u_s(\\mathbf{x},t)\\,u_r(\\mathbf{x},t)\\,dt$ and the polarity-test filtered imaging condition\n$$\nI(\\mathbf{x})=\\int \\chi\\Big[(\\mathbf{k}_s(\\mathbf{x},t)\\cdot \\mathbf{k}_r(\\mathbf{x},t))>0\\Big]\\;u_s(\\mathbf{x},t)\\,u_r(\\mathbf{x},t)\\,dt,\n$$\nwhere $\\chi[\\cdot]$ is the indicator function that is $1$ if its argument is true and $0$ otherwise, and $\\mathbf{k}_s(\\mathbf{x},t)$ and $\\mathbf{k}_r(\\mathbf{x},t)$ are the local wavenumber vectors of the source and receiver wavefields, respectively, defined via the local phase gradients.\n\nAssume a homogeneous medium with a horizontal reflector at depth $z>0$ beneath the free surface at $z=0$, a point source located at surface coordinate $x=-H/2$, and a receiver located at surface coordinate $x=+H/2$, where $H\\ge 0$ is the source-receiver offset. Let the imaging point be at the specular reflection point $(x=0,z)$ under these assumptions. For each test case, assume that at the imaging point the source wavefield and the backpropagated receiver wavefield are narrowband, monochromatic signals with equal angular frequency $\\omega=2\\pi f$ and relative phase $\\phi$, that is,\n$$\nu_s(\\mathbf{x},t)=\\cos(\\omega t),\\qquad u_r(\\mathbf{x},t)=\\cos(\\omega t+\\phi),\n$$\nand that the imaging integral is evaluated over $N$ complete periods, that is, $t\\in[0,NT]$ with $T=2\\pi/\\omega$ and integer $N\\ge 1$. Angles must be measured in radians. Distances must be provided in meters. Frequency must be provided in Hertz. Time must be in seconds.\n\nYour tasks are:\n- Starting from the acoustic wave equation and the definition of the standard zero-lag imaging condition, justify the polarity-test filtered imaging condition as a backscatter suppression mechanism by comparing the local propagation directions encoded by $\\mathbf{k}_s(\\mathbf{x},t)$ and $\\mathbf{k}_r(\\mathbf{x},t)$.\n- For the homogeneous, horizontally layered geometry described, derive from first principles the unit direction vectors of $\\mathbf{k}_s$ and $\\mathbf{k}_r$ at the imaging point $(x=0,z)$ in terms of $z$ and $H$, and express their dot product in terms of $z$ and $H$.\n- Using the above, determine the condition on $z$ and $H$ for which $\\chi[(\\mathbf{k}_s\\cdot\\mathbf{k}_r)>0]$ equals $1$, and analyze the implications for shallow reflectors where $z$ is small relative to $H$.\n- For the monochromatic signals specified, evaluate the integral for $I(\\mathbf{x})$ over $N$ complete periods and report the normalized filtered imaging amplitude defined by\n$$\nA=\\frac{I(\\mathbf{x})}{(NT)/2},\n$$\nas a function of the polarity test and phase $\\phi$. Note that $A$ is dimensionless and depends only on the indicator outcome and $\\phi$ under the given assumptions.\n\nImplement a program that, for the following test suite, computes $A$ for each case as a single floating-point number:\n- Case $1$ (happy path, deep reflector): primary reflection geometry, $z=1000\\,\\text{m}$, $H=1000\\,\\text{m}$, $f=10\\,\\text{Hz}$, $N=10$, $\\phi=0\\,\\text{rad}$.\n- Case $2$ (shallow reflector, large offset): primary reflection geometry, $z=100\\,\\text{m}$, $H=1000\\,\\text{m}$, $f=10\\,\\text{Hz}$, $N=10$, $\\phi=0\\,\\text{rad}$.\n- Case $3$ (boundary condition): primary reflection geometry, $z=250\\,\\text{m}$, $H=500\\,\\text{m}$, $f=10\\,\\text{Hz}$, $N=10$, $\\phi=0\\,\\text{rad}$.\n- Case $4$ (zero-offset): primary reflection geometry, $z=500\\,\\text{m}$, $H=0\\,\\text{m}$, $f=10\\,\\text{Hz}$, $N=10$, $\\phi=0\\,\\text{rad}$.\n- Case $5$ (explicit backscatter rejection): non-specular, backscattered pair at the imaging point with opposite vertical polarities (model as $\\mathbf{k}_s$ vertically downgoing and $\\mathbf{k}_r$ vertically upgoing), $z=500\\,\\text{m}$, $H=500\\,\\text{m}$, $f=10\\,\\text{Hz}$, $N=10$, $\\phi=0\\,\\text{rad}$.\n- Case $6$ (phase sensitivity): same as Case $1$ but with $\\phi=\\pi\\,\\text{rad}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[a_1,a_2,\\dots]$), where each entry is the computed value of $A$ for the corresponding case in the order listed above. The values of $A$ must be reported as floating-point numbers (dimensionless). Angle inputs and outputs must use radians. Distances must be in meters. Frequency must be in Hertz. Time must be in seconds. No additional text should be printed.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of wave propagation and seismic imaging, is well-posed with all necessary information provided, and is expressed in objective, formal language. We may proceed with a complete solution.\n\nThe solution is presented in four parts, corresponding to the tasks outlined in the problem statement.\n\n### 1. Justification of the Polarity-Test Filter\n\nThe constant-density acoustic wave equation governs the propagation of the source wavefield, $u_s(\\mathbf{x},t)$, and the receiver wavefield, $u_r(\\mathbf{x},t)$. In a homogeneous medium, solutions can be represented as superpositions of plane waves of the form $\\exp[i(\\mathbf{k}\\cdot\\mathbf{x} - \\omega t)]$. The phase of such a wave is $\\Phi(\\mathbf{x},t) = \\mathbf{k}\\cdot\\mathbf{x} - \\omega t$. The local wavenumber vector $\\mathbf{k}$ is defined as the spatial gradient of the phase, $\\mathbf{k} = \\nabla\\Phi$, and it points in the direction of wave propagation. Its magnitude is related to the angular frequency $\\omega$ and the medium's wavespeed $c$ by the dispersion relation $|\\mathbf{k}| = \\omega/c$.\n\nThe fundamental principle of seismic imaging, often called the imaging principle, states that a reflector exists at a point in the subsurface where a downgoing wave is converted into an upgoing wave. Reverse-Time Migration (RTM) implements this principle by cross-correlating a forward-propagated source wavefield, $u_s$, with a time-reversed, backward-propagated receiver wavefield, $u_r$.\n\n- The source wavefield, $u_s(\\mathbf{x},t)$, propagates forward in time from the source. At a reflector, it is a downgoing wave (in a typical surface-based survey geometry). Its local wavenumber vector, $\\mathbf{k}_s$, will therefore have a component pointing in the direction of increasing depth.\n- The receiver wavefield, $u_r(\\mathbf{x},t)$, is recorded at the surface from waves that have reflected upwards. In RTM, this recorded field is used as a boundary condition and propagated backward in time. A physically upgoing wave propagated backward in time becomes a downgoing wave. Consequently, at the reflector, the back-propagated receiver wavefield is also a downgoing wave, and its local wavenumber vector, $\\mathbf{k}_r$, also points in the direction of increasing depth.\n\nFor a primary reflection, both $\\mathbf{k}_s$ and $\\mathbf{k}_r$ at the imaging point represent downgoing fields and thus point in similar directions (i.e., into the same general half-space). The angle between them is acute, which implies their dot product is positive: $\\mathbf{k}_s \\cdot \\mathbf{k}_r > 0$.\n\nConversely, migration artifacts can arise from the cross-correlation of waves that do not correspond to a primary reflection event at the imaging point. A common source of such artifacts is the correlation of a downgoing wave with an upgoing wave that happens to be crossing the same point at the same time. In this scenario, $\\mathbf{k}_s$ would point down, while a physically upgoing part of the wavefield would have its propagation vector pointing up. The RTM algorithm correlates $u_s$ with the time-reversed $u_r$, but the local propagation direction vector $\\mathbf{k}_r$ is typically computed from the time-reversed field in its own propagation timeline. If this corresponds to a physically upgoing wave, its direction vector will be opposite to that of the downgoing source wave. Thus, $\\mathbf{k}_s$ and $\\mathbf{k}_r$ would point in opposite directions, yielding a negative dot product: $\\mathbf{k}_s \\cdot \\mathbf{k}_r < 0$.\n\nThe indicator function $\\chi[(\\mathbf{k}_s \\cdot \\mathbf{k}_r) > 0]$ acts as a filter. It preserves the contribution to the image from wavefields that are propagating in similar directions (characteristic of a reflection) and suppresses the contribution from wavefields propagating in opposite directions (characteristic of a migration artifact). This method is a way of implementing an angle-domain imaging condition that effectively eliminates backscattered noise and other artifacts caused by spurious correlations.\n\n### 2. Derivation of Unit Direction Vectors and Their Dot Product\n\nThe geometry consists of a source at $\\mathbf{x}_s = (-H/2, 0)$, a receiver at $\\mathbf{x}_r = (H/2, 0)$, and an imaging point at $\\mathbf{x} = (0, z)$. The medium is homogeneous.\n\nThe source wavefield propagates from the source $\\mathbf{x}_s$ to the imaging point $\\mathbf{x}$. The direction of propagation is given by the vector $\\vec{v}_s = \\mathbf{x} - \\mathbf{x}_s = (0 - (-H/2), z - 0) = (H/2, z)$. The unit direction vector $\\hat{\\mathbf{k}}_s$ is:\n$$\n\\hat{\\mathbf{k}}_s = \\frac{\\vec{v}_s}{|\\vec{v}_s|} = \\frac{(H/2, z)}{\\sqrt{(H/2)^2 + z^2}}\n$$\nThe receiver wavefield is back-propagated from the receiver $\\mathbf{x}_r$ to the imaging point $\\mathbf{x}$. The direction of propagation for this back-propagated field is given by the vector $\\vec{v}_r = \\mathbf{x} - \\mathbf{x}_r = (0 - H/2, z - 0) = (-H/2, z)$. The unit direction vector $\\hat{\\mathbf{k}}_r$ is:\n$$\n\\hat{\\mathbf{k}}_r = \\frac{\\vec{v}_r}{|\\vec{v}_r|} = \\frac{(-H/2, z)}{\\sqrt{(-H/2)^2 + z^2}}\n$$\nThe dot product of these unit direction vectors is:\n$$\n\\hat{\\mathbf{k}}_s \\cdot \\hat{\\mathbf{k}}_r = \\frac{(H/2, z) \\cdot (-H/2, z)}{(\\sqrt{(H/2)^2 + z^2})^2} = \\frac{(H/2)(-H/2) + z \\cdot z}{(H/2)^2 + z^2} = \\frac{z^2 - H^2/4}{z^2 + H^2/4}\n$$\nThe local wavenumber vectors are $\\mathbf{k}_s = |\\mathbf{k}_s|\\hat{\\mathbf{k}}_s$ and $\\mathbf{k}_r = |\\mathbf{k}_r|\\hat{\\mathbf{k}}_r$. Since the wavefields are monochromatic with the same frequency $\\omega$ in a constant velocity $c$ medium, their wavenumber magnitudes are equal: $|\\mathbf{k}_s| = |\\mathbf{k}_r| = \\omega/c$.\nTherefore, their dot product is:\n$$\n\\mathbf{k}_s \\cdot \\mathbf{k}_r = \\left(\\frac{\\omega}{c}\\right)^2 (\\hat{\\mathbf{k}}_s \\cdot \\hat{\\mathbf{k}}_r) = \\left(\\frac{\\omega}{c}\\right)^2 \\frac{z^2 - H^2/4}{z^2 + H^2/4}\n$$\n\n### 3. Condition for Polarity Test and Implications\n\nThe polarity test condition is $(\\mathbf{k}_s \\cdot \\mathbf{k}_r) > 0$. From the expression derived above, the term $(\\omega/c)^2$ is strictly positive, and the denominator $(z^2 + H^2/4)$ is also strictly positive for any physical configuration ($z>0$). Thus, the sign of the dot product is determined solely by the numerator:\n$$\nz^2 - \\frac{H^2}{4} > 0\n$$\nThis inequality can be rearranged as $z^2 > H^2/4$. Since depth $z$ and offset $H$ are non-negative, this is equivalent to:\n$$\nz > \\frac{H}{2}\n$$\nThe indicator function $\\chi[(\\mathbf{k}_s\\cdot \\mathbf{k}_r)>0]$ is equal to $1$ if $z > H/2$ and $0$ otherwise.\n\nThis condition has significant implications for imaging, particularly for shallow reflectors. The reflection angle $\\theta$ at the imaging point with respect to the vertical is given by $\\tan(\\theta) = (H/2)/z$. The condition $z > H/2$ is equivalent to $(H/2)/z  1$, which implies $\\tan(\\theta)  1$, or $\\theta  \\pi/4$ ($45^\\circ$).\n\nFor shallow reflectors (small $z$) relative to the source-receiver offset (large $H$), it is possible that $z \\le H/2$. In this case, the reflection angle is large ($\\theta \\ge 45^\\circ$), the dot product becomes non-positive, and the indicator function evaluates to $0$. The polarity test acts as a high-angle filter, or \"mute,\" automatically zeroing out the contribution from wide-angle reflections. This helps to prevent imaging artifacts associated with turning waves and aliasing that are more prevalent at large angles, but it can also lead to a loss of image information in shallow sections with long-offset data.\n\n### 4. Evaluation of the Normalized Imaging Amplitude\n\nThe filtered imaging condition is given by:\n$$\nI(\\mathbf{x})=\\int_0^{NT} \\chi\\Big[(\\mathbf{k}_s(\\mathbf{x},t)\\cdot \\mathbf{k}_r(\\mathbf{x},t))>0\\Big]\\;u_s(\\mathbf{x},t)\\,u_r(\\mathbf{x},t)\\,dt\n$$\nFor a given imaging point geometry $(z, H)$, the value of the indicator function $\\chi$ is constant over the integration time. The wavefields are given as $u_s(\\mathbf{x},t)=\\cos(\\omega t)$ and $u_r(\\mathbf{x},t)=\\cos(\\omega t+\\phi)$.\n$$\nI(\\mathbf{x}) = \\chi \\int_0^{NT} \\cos(\\omega t) \\cos(\\omega t+\\phi) \\,dt\n$$\nUsing the product-to-sum trigonometric identity $\\cos A \\cos B = \\frac{1}{2}[\\cos(A-B) + \\cos(A+B)]$, the integrand becomes:\n$$\n\\cos(\\omega t) \\cos(\\omega t+\\phi) = \\frac{1}{2}[\\cos(-\\phi) + \\cos(2\\omega t + \\phi)] = \\frac{1}{2}[\\cos(\\phi) + \\cos(2\\omega t + \\phi)]\n$$\nThe integral is:\n$$\nI(\\mathbf{x}) = \\frac{\\chi}{2} \\int_0^{NT} [\\cos(\\phi) + \\cos(2\\omega t + \\phi)] \\,dt = \\frac{\\chi}{2} \\left[ t\\cos(\\phi) + \\frac{1}{2\\omega}\\sin(2\\omega t + \\phi) \\right]_0^{NT}\n$$\nEvaluating at the limits, noting that $T=2\\pi/\\omega$, so $\\omega T = 2\\pi$:\n$$\nI(\\mathbf{x}) = \\frac{\\chi}{2} \\left\\{ \\left( NT\\cos(\\phi) + \\frac{1}{2\\omega}\\sin(2\\omega NT + \\phi) \\right) - \\left( 0 + \\frac{1}{2\\omega}\\sin(\\phi) \\right) \\right\\}\n$$\nThe term $2\\omega NT = 2(2\\pi/T) NT = 4\\pi N$. Since $\\sin$ is $2\\pi$-periodic and $N$ is an integer, $\\sin(4\\pi N + \\phi) = \\sin(\\phi)$. The sine terms cancel out.\n$$\nI(\\mathbf{x}) = \\frac{\\chi}{2} (NT \\cos(\\phi)) = \\chi \\left( \\frac{NT}{2} \\right) \\cos(\\phi)\n$$\nThe normalized filtered imaging amplitude $A$ is defined as $A = I(\\mathbf{x}) / (NT/2)$.\n$$\nA = \\frac{\\chi \\left( \\frac{NT}{2} \\right) \\cos(\\phi)}{ \\frac{NT}{2} } = \\chi \\cos(\\phi)\n$$\nwhere $\\chi = 1$ if $z > H/2$ and $\\chi = 0$ if $z \\le H/2$ for primary reflections. For the explicitly defined backscatter case, the dot product is negative by definition, so $\\chi=0$. The computation of $A$ is independent of $f$ and $N$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized imaging amplitude A for a series of test cases\n    based on a polarity-filtered imaging condition in reverse-time migration.\n    \"\"\"\n\n    test_cases = [\n        # (z, H, phi, is_backscatter)\n        # Case 1: happy path, deep reflector\n        (1000.0, 1000.0, 0.0, False),\n        # Case 2: shallow reflector, large offset\n        (100.0, 1000.0, 0.0, False),\n        # Case 3: boundary condition\n        (250.0, 500.0, 0.0, False),\n        # Case 4: zero-offset\n        (500.0, 0.0, 0.0, False),\n        # Case 5: explicit backscatter rejection\n        # z, H values are for context; the backscatter flag dictates the result.\n        (500.0, 500.0, 0.0, True),\n        # Case 6: phase sensitivity\n        (1000.0, 1000.0, np.pi, False),\n    ]\n\n    results = []\n    for case in test_cases:\n        z, H, phi, is_backscatter = case\n        \n        # The indicator function chi determines if the imaging condition contributes.\n        # chi is 1 if (k_s . k_r) > 0, and 0 otherwise.\n        \n        chi = 0.0\n        if is_backscatter:\n            # For the backscatter case, k_s and k_r are defined to be in\n            # opposite directions, so their dot product is negative. \n            # The condition (k_s . k_r) > 0 is false.\n            chi = 0.0\n        else:\n            # For primary reflections, the condition (k_s . k_r) > 0 simplifies\n            # to the geometric condition z > H/2.\n            # The problem statement implies a strict inequality > 0.\n            if z > H / 2.0:\n                chi = 1.0\n            else:\n                chi = 0.0\n        \n        # The normalized amplitude A is given by A = chi * cos(phi).\n        # The parameters f (frequency) and N (number of periods) cancel out\n        # in the normalization.\n        A = chi * np.cos(phi)\n        results.append(A)\n\n    # Format the output as a comma-separated list in square brackets.\n    # Using 'g' format specifier to handle floating point representation neatly.\n    formatted_results = [f\"{r:.1f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In geologically complex media, physical phenomena such as anisotropy and attenuation can introduce significant phase distortions into the wavefields, degrading the quality of standard imaging conditions. This final practice  challenges you to build a more robust, adaptive imaging condition using concepts from advanced signal processing. By leveraging the analytic signal to extract instantaneous phase and amplitude, you will develop and test a condition that actively compensates for phase discrepancies, ensuring coherent imaging even when wavefields are severely distorted.",
            "id": "3603940",
            "problem": "You are given the computational geophysics context of imaging conditions for migration, where a subsurface image is formed by combining a source-propagated wavefield and a receiver-propagated wavefield at each candidate image location. Starting from the principle that migration relies on the coherence of the source and receiver wavefields, you must derive, implement, and test a phase-adaptive imaging condition that is robust to phase distortions caused by anisotropy and attenuation.\n\nFundamental base:\n- The standard cross-correlation imaging condition uses the source wavefield $u_s(t)$ and the receiver wavefield $u_r(t)$ at an image location and computes the image value by integrating their product over time, which captures coherent arrivals when the two wavefields are phase-aligned.\n- The analytic signal of a real-valued time series $u(t)$ is $a(t) = u(t) + i \\,\\mathcal{H}\\{u(t)\\}$, where $\\mathcal{H}\\{\\cdot\\}$ denotes the Hilbert transform. The instantaneous amplitude (envelope) is $|a(t)|$ and the instantaneous phase is $\\phi(t) = \\arg(a(t))$, both defined pointwise in time.\n- Numerical evaluation replaces continuous-time integrals with discrete-time summations multiplied by the sample interval $\\Delta t$.\n\nTasks:\n1. Derive, from the above base, an imaging condition that uses the instantaneous phase difference between the source and receiver wavefields to adaptively weight the contribution of each time sample, ensuring constructive accumulation when phases match and suppressing destructive interference when phases differ. Your derivation must explicitly use the concept of instantaneous phase and amplitude from the analytic signal and must be expressed as a discrete-time summation over $t$ with sample interval $\\Delta t$.\n2. Implement a synthetic test in which the source wavefield $u_s(t)$ at a single image location is modeled as a band-limited pulse given by a Gaussian-modulated cosine:\n   $$u_s(t) = \\exp\\!\\Big(-\\frac{(t - t_0)^2}{2\\sigma^2}\\Big)\\,\\cos\\!\\big(2\\pi f_0 (t - t_0)\\big),$$\n   where $t$ is time in seconds, $t_0$ is the pulse center in seconds, $\\sigma$ is the envelope width in seconds, and $f_0$ is the central frequency in Hertz.\n3. Construct the receiver wavefield $u_r(t)$ by applying controlled distortions to $u_s(t)$ that emulate anisotropy and attenuation:\n   - Anisotropy-induced phase warp: define a time remapping $t' = t + a\\,(t - t_0)^2$, where $a$ has units of $\\text{s}^{-1}$, and set $u_r(t) = u_s(t')$ using interpolation on the discrete grid. This mimics direction-dependent phase velocity variations.\n   - Attenuation and dispersion: in the frequency domain (via the Fast Fourier Transform (FFT)), apply an amplitude filter $A(f) = \\exp(-\\alpha |f|)$ and a dispersion phase filter $\\Psi(f) = \\exp\\!\\big(i\\,2\\pi \\kappa f^2\\big)$, where $f$ is frequency in Hertz, $\\alpha$ is a nonnegative attenuation parameter with units of $\\text{Hz}^{-1}$, and $\\kappa$ is a nonnegative dispersion parameter with units of $\\text{s}^2$. Transform back to the time domain to obtain the attenuated and dispersed $u_r(t)$.\n4. For each test case, compute two scalar image values at the single image location:\n   - The standard cross-correlation image:\n     $$I_{\\text{cc}} = \\sum_{n=0}^{N-1} u_s(t_n)\\,u_r(t_n)\\,\\Delta t,$$\n     where $t_n$ denotes the sampled times and $N$ is the number of samples.\n   - The phase-adaptive image, derived in Task 1, which must use the instantaneous phases and envelopes extracted via the Hilbert transform.\n5. Define and compute a dimensionless performance metric for each test case:\n   $$M = \\frac{|I_{\\text{adaptive}}|}{|I_{\\text{cc}}| + \\varepsilon},$$\n   where $I_{\\text{adaptive}}$ is your phase-adaptive image value, $I_{\\text{cc}}$ is the standard cross-correlation image value, and $\\varepsilon$ is a small positive constant to prevent division by zero. Angles must be in radians; time in seconds; frequency in Hertz; the final $M$ is unitless.\n6. Use the following fixed signal parameters for all test cases: total duration $T = 1.0$ seconds, sample interval $\\Delta t = 0.001$ seconds, pulse center $t_0 = 0.50$ seconds, envelope width $\\sigma = 0.05$ seconds, and central frequency $f_0 = 25$ Hertz.\n7. Evaluate the following test suite of distortion parameters $(a,\\alpha,\\kappa)$:\n   - Case 1 (baseline, happy path): $(a = 0.0\\,\\text{s}^{-1},\\;\\alpha = 0.0\\,\\text{Hz}^{-1},\\;\\kappa = 0.0\\,\\text{s}^2)$.\n   - Case 2 (anisotropy-only): $(a = 0.4\\,\\text{s}^{-1},\\;\\alpha = 0.0\\,\\text{Hz}^{-1},\\;\\kappa = 0.0\\,\\text{s}^2)$.\n   - Case 3 (attenuation and dispersion): $(a = 0.0\\,\\text{s}^{-1},\\;\\alpha = 0.008\\,\\text{Hz}^{-1},\\;\\kappa = 8\\times 10^{-7}\\,\\text{s}^2)$.\n   - Case 4 (combined distortions): $(a = 0.5\\,\\text{s}^{-1},\\;\\alpha = 0.010\\,\\text{Hz}^{-1},\\;\\kappa = 1.5\\times 10^{-6}\\,\\text{s}^2)$.\n8. Your program must:\n   - Compute $I_{\\text{cc}}$ and $I_{\\text{adaptive}}$ for each case.\n   - Compute the performance metric $M$ for each case, with $\\varepsilon$ chosen as a fixed small constant (e.g., $\\varepsilon = 10^{-12}$).\n   - Produce a single line of output containing the four performance metrics as a comma-separated list enclosed in square brackets, in the order of the cases above, rounded to six decimal places, for example, $[m_1,m_2,m_3,m_4]$.\n\nAngle unit requirement: all phases and trigonometric functions must use radians.\nTime and frequency units: time in seconds, frequency in Hertz.\nFinal output format requirement: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[m_1,m_2,m_3,m_4]$).",
            "solution": "The problem is valid. It is scientifically grounded in the principles of wave propagation and signal processing as applied to geophysical imaging, is well-posed with all necessary data and constraints provided, and is stated in objective, formalizable language.\n\nThe solution proceeds in two stages: first, the derivation of the phase-adaptive imaging condition, and second, the design of the numerical implementation for the specified test cases.\n\n**1. Derivation of the Phase-Adaptive Imaging Condition**\n\nThe fundamental principle of seismic migration is to form an image by quantifying the coherence between the forward-propagated source wavefield, $u_s(t)$, and the backward-propagated receiver wavefield, $u_r(t)$, at every point in the subsurface. The standard cross-correlation imaging condition, $I_{\\text{cc}}$, achieves this by integrating the product of the two real-valued wavefields:\n$I_{\\text{cc}} = \\int u_s(t) u_r(t) dt$\nThis integral is maximized when the two wavefields are perfectly in-phase and is degraded by any phase mismatch, which can be caused by physical effects like anisotropy or attenuation.\n\nTo derive a more robust condition, we represent the wavefields using analytic signals. The analytic signal of a real wavefield $u(t)$ is a complex-valued signal $a(t)$ given by:\n$a(t) = u(t) + i\\,\\mathcal{H}\\{u(t)\\}$\nwhere $\\mathcal{H}\\{\\cdot\\}$ is the Hilbert transform. This allows us to express $a(t)$ in polar form, separating its instantaneous amplitude (envelope) $A(t)$ and instantaneous phase $\\phi(t)$:\n$a(t) = A(t) e^{i\\phi(t)}$\nwhere $A(t) = |a(t)|$ and $\\phi(t) = \\arg(a(t))$.\n\nThe source and receiver wavefields can thus be written as:\n$a_s(t) = A_s(t) e^{i\\phi_s(t)}$\n$a_r(t) = A_r(t) e^{i\\phi_r(t)}$\nThe real wavefields are the real parts of these signals: $u_s(t) = \\Re\\{a_s(t)\\} = A_s(t)\\cos(\\phi_s(t))$ and $u_r(t) = \\Re\\{a_r(t)\\} = A_r(t)\\cos(\\phi_r(t))$.\n\nThe problem requires an imaging condition that adaptively weights contributions based on the instantaneous phase difference, $\\Delta\\phi(t) = \\phi_s(t) - \\phi_r(t)$. A natural choice for a weighting factor that captures phase coherence is $\\cos(\\Delta\\phi(t))$. This factor is $1$ for perfect phase alignment, $-1$ for anti-alignment (destructive interference), and $0$ for quadrature phase. By multiplying the product of the signal envelopes, $A_s(t)A_r(t)$, by this coherence factor, we form an integrand that directly measures phase-corrected coherence.\n\nThe resulting phase-adaptive imaging condition, $I_{\\text{adaptive}}$, is the integral of this quantity:\n$$I_{\\text{adaptive}} = \\int A_s(t) A_r(t) \\cos(\\phi_s(t) - \\phi_r(t)) dt$$\nThis formulation is equivalent to integrating the real part of the cross-correlation of the analytic signals, $\\int \\Re\\{a_s(t) a_r^*(t)\\} dt$, where $a_r^*(t)$ is the complex conjugate of $a_r(t)$. This is because $a_s(t) a_r^*(t) = A_s(t)A_r(t)e^{i(\\phi_s(t) - \\phi_r(t))}$. This form is robust because it combines the in-phase correlation ($u_s u_r$) with the quadrature-phase correlation ($\\mathcal{H}\\{u_s\\} \\mathcal{H}\\{u_r\\}$), thereby capturing coherent energy even if it has been shifted between the in-phase and quadrature components by propagation effects.\n\nFor numerical implementation, the integral is replaced by a discrete-time summation over $N$ samples with a time interval of $\\Delta t$. The derived imaging condition is:\n$$I_{\\text{adaptive}} = \\sum_{n=0}^{N-1} A_s(t_n) A_r(t_n) \\cos(\\phi_s(t_n) - \\phi_r(t_n)) \\Delta t$$\nwhere $t_n = n\\Delta t$, and the instantaneous amplitudes $A(t_n)$ and phases $\\phi(t_n)$ are extracted from the discrete analytic signals of $u_s(t_n)$ and $u_r(t_n)$.\n\n**2. Implementation Strategy**\n\nThe numerical solution follows a sequence of steps for each test case.\n\n**Signal Generation:**\n- A discrete time vector $t$ is created from $t=0$ to $T=1.0$ s with a sampling interval of $\\Delta t = 0.001$ s.\n- The source wavefield $u_s(t)$ is generated using the specified Gaussian-modulated cosine function with parameters $t_0=0.50$ s, $\\sigma=0.05$ s, and $f_0=25$ Hz.\n- The receiver wavefield $u_r(t)$ is synthesized by applying the specified distortions to $u_s(t)$. This is done sequentially: first, the anisotropy-induced time warp is applied, followed by the frequency-domain attenuation and dispersion filtering.\n  - **Anisotropy Warp**: For a non-zero parameter $a$, a warped time vector $t' = t + a(t - t_0)^2$ is computed. The warped signal is then constructed as $u_r(t) = u_s(t')$ using linear interpolation, as the points in $t'$ will generally not coincide with the original sample times.\n  - **Attenuation and Dispersion**: For non-zero parameters $\\alpha$ or $\\kappa$, the (potentially time-warped) signal is transformed to the frequency domain using the Fast Fourier Transform (FFT). A complex filter $H(f) = \\exp(-\\alpha |f|) \\exp(i 2\\pi \\kappa f^2)$ is constructed and multiplied with the signal's spectrum. An inverse FFT is then performed, and the real part is taken to obtain the final distorted time-domain signal $u_r(t)$.\n\n**Image Value Computation:**\n- The standard cross-correlation image value, $I_{\\text{cc}}$, is computed by the discrete summation: $I_{\\text{cc}} = \\sum u_s(t_n) u_r(t_n) \\Delta t$.\n- The phase-adaptive image value, $I_{\\text{adaptive}}$, is computed as follows:\n  1. The analytic signals $a_s(t_n)$ and $a_r(t_n)$ are computed from $u_s(t_n)$ and $u_r(t_n)$ using the Hilbert transform.\n  2. The instantaneous amplitudes $A_s(t_n)$ and $A_r(t_n)$ are found by taking the absolute value of the analytic signals.\n  3. The instantaneous phases $\\phi_s(t_n)$ and $\\phi_r(t_n)$ are found by taking the argument of the analytic signals. The `unwrap` function is applied to the phases to correct for $2\\pi$ discontinuities.\n  4. The derived formula for $I_{\\text{adaptive}}$ is then evaluated.\n\n**Performance Metric:**\n- For each test case, the dimensionless performance metric $M$ is computed as $M = |I_{\\text{adaptive}}| / (|I_{\\text{cc}}| + \\varepsilon)$, with the stabilization constant $\\varepsilon = 10^{-12}$.\n\nThis procedure is executed for each of the four test cases, and the resulting values of $M$ are collected for the final output. For the baseline case (Case $1$), where $u_r(t) = u_s(t)$, it is expected that $I_{\\text{cc}} \\approx \\frac{1}{2} I_{\\text{adaptive}}$, yielding $M \\approx 2$. For the distorted cases, $I_{\\text{cc}}$ is expected to degrade more significantly than $I_{\\text{adaptive}}$, leading to higher values of $M$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.signal import hilbert\nfrom scipy.fft import fft, ifft, fftfreq\n\ndef solve():\n    \"\"\"\n    Derives, implements, and tests a phase-adaptive imaging condition\n    for seismic migration against a standard cross-correlation condition.\n    \"\"\"\n    \n    # Task 6: Fixed signal parameters\n    T = 1.0  # Total duration in seconds\n    dt = 0.001  # Sample interval in seconds\n    t0 = 0.50  # Pulse center in seconds\n    sigma = 0.05  # Envelope width in seconds\n    f0 = 25.0  # Central frequency in Hertz\n    epsilon = 1e-12 # Stabilization constant\n    \n    # Time vector\n    n_samples = int(T / dt)\n    t = np.arange(n_samples) * dt\n\n    # Task 2: Generate the source wavefield u_s(t)\n    gauss_envelope = np.exp(-((t - t0)**2) / (2 * sigma**2))\n    u_s = gauss_envelope * np.cos(2 * np.pi * f0 * (t - t0))\n\n    # Task 7: Test suite of distortion parameters (a, alpha, kappa)\n    test_cases = [\n        # Case 1 (baseline, happy path)\n        (0.0, 0.0, 0.0),\n        # Case 2 (anisotropy-only)\n        (0.4, 0.0, 0.0),\n        # Case 3 (attenuation and dispersion)\n        (0.0, 0.008, 8e-7),\n        # Case 4 (combined distortions)\n        (0.5, 0.010, 1.5e-6),\n    ]\n\n    performance_metrics = []\n\n    for a, alpha, kappa in test_cases:\n        # Task 3: Construct the receiver wavefield u_r(t)\n        u_r_intermediate = u_s.copy()\n        \n        # Apply anisotropy-induced phase warp\n        if a != 0.0:\n            t_prime = t + a * (t - t0)**2\n            # Interpolate u_s at the warped time coordinates t'\n            # u_r(t) = u_s(t')\n            u_r_intermediate = np.interp(t_prime, t, u_s)\n        \n        u_r = u_r_intermediate\n\n        # Apply attenuation and dispersion in the frequency domain\n        if alpha != 0.0 or kappa != 0.0:\n            # FFT of the (potentially warped) signal\n            U_r_intermediate = fft(u_r_intermediate)\n            \n            # Frequency vector\n            f = fftfreq(n_samples, dt)\n            \n            # Amplitude and phase filters\n            A_f = np.exp(-alpha * np.abs(f))\n            Psi_f = np.exp(1j * 2 * np.pi * kappa * f**2)\n            \n            # Combine filters and apply\n            H_f = A_f * Psi_f\n            U_r = U_r_intermediate * H_f\n            \n            # Inverse FFT to get the final receiver wavefield\n            u_r = np.real(ifft(U_r))\n\n        # Task 4: Compute the two scalar image values\n        \n        # Standard cross-correlation image\n        I_cc = np.sum(u_s * u_r) * dt\n\n        # Phase-adaptive image\n        # Compute analytic signals using Hilbert transform\n        analytic_s = hilbert(u_s)\n        analytic_r = hilbert(u_r)\n\n        # Extract instantaneous amplitudes (envelopes)\n        A_s = np.abs(analytic_s)\n        A_r = np.abs(analytic_r)\n\n        # Extract instantaneous phases (unwrapped)\n        phi_s = np.unwrap(np.angle(analytic_s))\n        phi_r = np.unwrap(np.angle(analytic_r))\n        \n        # Compute the phase-adaptive integrand\n        integrand_adaptive = A_s * A_r * np.cos(phi_s - phi_r)\n        I_adaptive = np.sum(integrand_adaptive) * dt\n\n        # Task 5: Compute the performance metric\n        M = np.abs(I_adaptive) / (np.abs(I_cc) + epsilon)\n        performance_metrics.append(f\"{M:.6f}\")\n\n    # Task 8: Produce the final output in the specified format\n    print(f\"[{','.join(performance_metrics)}]\")\n\nsolve()\n```"
        }
    ]
}