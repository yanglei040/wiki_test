{
    "hands_on_practices": [
        {
            "introduction": "任何克希霍夫偏移应用的第一步都是确定一个合适的偏移孔径。这个选择直接影响到成像的精度、计算成本和伪影的产生，是一个关键的权衡过程。本实践将引导你基于菲涅尔带物理原理，并结合地层倾角和采集孔径等实际约束，建立一个量化选择偏移孔径的框架，从而让你掌握在实践中做出明智决策的核心技能 ()。",
            "id": "3605983",
            "problem": "设计并实现一个程序，从第一性原理出发，对柯西霍夫偏移中的偏移孔径半径选择进行形式化。您的程序必须能够操作化地选择一个孔径半径 $R(\\mathbf{x})$，该半径需与局部倾角约束和采集孔径相一致。当用户提议的孔径 $R_{\\text{user}}$ 相对于第一菲涅尔区过小或过大时，程序还必须能够评估成像假象。\n\n基本原理与推导目标：\n- 从均匀介质（传播速度 $v$ 为常数）中的标量波动方程、惠更斯-菲涅尔原理（次级子波的叠加）以及稳相法出发。使用稳相点周围走时的小角度展开来推导深度 $z$ 处的第一菲涅尔区半径，并将其与主波长 $\\lambda$ 联系起来。\n- 利用基本几何光学，通过爆炸反射体模型将局部最大允许倾角 $\\theta_{\\max}$ 与侧向偏移孔径联系起来，并利用采集半孔径 $A$（采集表面上可用的最大侧向范围）对孔径进行进一步约束。\n- 使用菲涅尔区半径来定义定量标准，以判断用户指定的孔径 $R_{\\text{user}}$ 何时过小或过大。具体而言，引入作用于第一菲涅尔半径的下乘子 $c_1$ 和上乘子 $c_2$ 来定义一个平衡区间。\n\n您必须实现以下定义和计算：\n1. 主波长：$\\lambda = v/f_0$，其中 $f_0$ 是主频。\n2. 深度处的第一菲涅尔半径（单程，爆炸反射体模型）：$r_F = \\sqrt{\\lambda z}$。\n3. 倾角限制的孔径半径：$R_{\\text{dip}} = z \\tan(\\theta_{\\max})$。\n4. 采集限制的半径：$R_{\\text{acq}} = A$。\n5. 目标菲涅尔引导半径：$R_{\\text{target}} = \\beta \\, r_F$，其中 $\\beta \\in \\mathbb{R}^+$ 被预先选择，严格位于 $c_1$ 和 $c_2$ 之间。\n6. 推荐孔径：$R_{\\text{rec}} = \\min\\{R_{\\text{dip}}, R_{\\text{acq}}, R_{\\text{target}}\\}$。\n7. 用户建议的孔径：$R_{\\text{user}} = \\gamma \\, r_F$，其中 $\\gamma \\in \\mathbb{R}^+$ 是给定的。\n8. 在 $R_{\\text{user}}$ 上评估的假象标准：\n   - 如果 $R_{\\text{user}}  c_1 \\, r_F$，则过小。\n   - 如果 $R_{\\text{user}} > c_2 \\, r_F$，则过大。\n   - 否则为平衡。\n\n使用固定常数 $c_1 = 1.0$，$c_2 = 2.0$ 和 $\\beta = 1.5$。角度必须以度为单位提供，并在计算中转换为弧度。所有距离必须以米表示，波速以米/秒表示，频率以赫兹表示，输入角度以度为单位，内部计算以弧度为单位。\n\n测试套件：\n提供以下测试用例，每个用例为一个元组 $(v, f_0, z, \\theta_{\\max}^{\\circ}, A, \\gamma)$，并使用指定的单位：\n- 用例 1：$(2500, 30, 1500, 35, 5000, 5.657)$。\n- 用例 2：$(2000, 60, 1000, 5, 1000, 0.548)$。\n- 用例 3：$(3000, 20, 3000, 60, 800, 1.044)$。\n- 用例 4：$(1800, 80, 300, 45, 200, 1.819)$。\n- 用例 5：$(2500, 10, 4000, 80, 10000, 5.000)$。\n- 用例 6：$(2200, 55, 1200, 25, 1500, 2.000)$。\n\n对于每个测试用例，您的程序必须计算：\n- 推荐孔径 $R_{\\text{rec}}$，单位为米。\n- 菲涅尔半径 $r_F$，单位为米。\n- 一个布尔标志，指示 $R_{\\text{user}}$ 相对于 $c_1 r_F$ 是否过小。\n- 一个布尔标志，指示 $R_{\\text{user}}$ 相对于 $c_2 r_F$ 是否过大。\n\n输出要求：\n- 将 $R_{\\text{rec}}$ 和 $r_F$ 以米为单位表示，并四舍五入到 $3$ 位小数。\n- 布尔标志必须是精确的 Python布尔值（$\\text{True}$ 或 $\\text{False}$）。\n- 您的程序应生成单行输出，其中包含所有测试用例的结果。结果是一个用方括号括起来的逗号分隔列表，其中每个元素是形如 $[R_{\\text{rec}}, r_F, \\text{too\\_small}, \\text{too\\_large}]$ 的列表，按上述顺序排列。输出字符串中不得有任何空格。例如：$[[r_{11},r_{12},b_{11},b_{12}],[r_{21},r_{22},b_{21},b_{22}],\\dots]$。\n\n科学真实性：\n- 假设介质为均匀各向同性。\n- 所有参数对于海上或陆地地震环境都是真实的。\n- 输入的角度单位是度；您的程序必须在内部将其转换为弧度以进行三角函数计算。\n\n您的实现必须是一个完整、可运行的程序。它不能要求任何用户输入或外部文件，并且必须是确定性的。",
            "solution": "在计算地球物理学中，选择合适的柯西霍夫偏移孔径问题是在成像精度、计算成本和假象压制之间取得平衡的典型范例。我们将首先对基本原理进行形式化，然后构建所需的计算程序。\n\n柯西霍夫偏移的理论基础是标量波动方程的积分解，它将地下目标点 $\\mathbf{x}$ 处的波场表示为采集表面 $S$ 上记录波场的叠加。该解是惠更斯-菲涅尔原理的数学体现，该原理指出，波前上的每一点都可视为次级球面子波的源。对于深度为 $z$ 的成像点 $\\mathbf{x}$，偏移积分可写作：\n$$\nI(\\mathbf{x}) = \\int_S w(\\mathbf{x}, \\mathbf{x_s}) U(\\mathbf{x_s}, t = \\tau(\\mathbf{x}, \\mathbf{x_s})) \\, dS\n$$\n其中 $U(\\mathbf{x_s}, t)$ 是在表面位置 $\\mathbf{x_s}$ 记录的波场，$\\tau(\\mathbf{x}, \\mathbf{x_s})$ 是从 $\\mathbf{x}$ 到 $\\mathbf{x_s}$ 的走时，$w(\\mathbf{x}, \\mathbf{x_s})$ 是一个考虑了几何扩散及其他因素的加权函数。该积分沿着由走时函数 $\\tau$ 定义的绕射双曲线对能量进行求和。\n\n稳相法提供了一个关键的见解：该积分的主要贡献来自积分函数相位为稳相的表面 $S$ 区域。相位与走时 $\\tau$ 成正比。稳相点对应于连接成像点 $\\mathbf{x}$ 与地表的几何射线路径。远离该稳相点的点的贡献相位变化迅速，并通过相消干涉相互抵消。这一观察结果为将积分域 $S$ 限制在稳相点周围的有限区域（即偏移孔径）提供了依据。该孔径的大小至关重要。\n\n确定该区域所需大小的一个标准方法是分析第一菲涅耳区。在该区域内，与稳相路径的路径长度差所导致的相移不超过 $\\pi$ 弧度，对应于半个主周期的时间差。来自该区域的所有贡献都发生相长干涉。\n\n为了形式化菲涅耳区半径，我们考虑一个速度为常数 $v$ 的均匀介质中的爆炸反射体模型。从深度为 $z$ 的成像点到距点 $(0,0,z)$ 侧向距离为 $r$ 的地表点的单程走时由下式给出：\n$$\n\\tau(r) = \\frac{\\sqrt{z^2 + r^2}}{v}\n$$\n到稳相点（正上方，$r=0$ 处）的走时是 $\\tau(0) = z/v$。对于相对于深度较小的侧向距离（$r \\ll z$），我们可以对 $\\tau(r)$ 进行泰勒展开：\n$$\n\\tau(r) = \\frac{z}{v} \\sqrt{1 + \\left(\\frac{r}{z}\\right)^2} \\approx \\frac{z}{v} \\left(1 + \\frac{1}{2}\\frac{r^2}{z^2}\\right) = \\tau(0) + \\frac{r^2}{2vz}\n$$\n走时差为 $\\Delta\\tau = \\tau(r) - \\tau(0) = r^2 / (2vz)$。第一菲涅耳区的边界由该走时差等于半个主周期（$\\Delta\\tau = T_0/2 = 1/(2f_0)$）的条件定义，其中 $f_0$ 是主频。将 $\\Delta\\tau$ 的两个表达式相等：\n$$\n\\frac{r^2}{2vz} = \\frac{1}{2f_0} \\implies r^2 = \\frac{vz}{f_0}\n$$\n使用主波长 $\\lambda = v/f_0$ 的定义，我们得到第一菲涅耳半径 $r_F$ 的表达式：\n$$\nr_F = \\sqrt{\\lambda z}\n$$\n该半径为偏移孔径提供了一个具有物理动机的尺度。然而，还必须考虑其他约束。\n\n偏移孔径必须足够大才能对倾斜反射体进行成像。根据几何光学，深度为 $z$、倾角为 $\\theta$ 的反射体段在地面上的反射点将有 $x = z \\tan(\\theta)$ 的侧向偏移。为了正确地对所有倾角达到最大预期倾角 $\\theta_{\\max}$ 的构造进行成像，孔径半径必须至少这么大。这导致了倾角限制的孔径半径：\n$$\nR_{\\text{dip}} = z \\tan(\\theta_{\\max})\n$$\n其中 $\\theta_{\\max}$ 在计算时必须转换为弧度。\n\n此外，孔径从根本上受限于地震勘探的物理范围。数据仅在距勘测线或区域中心一定最大侧向距离内可用。此最大可用半孔径表示为 $A$，从而得出采集限制的半径：\n$$\nR_{\\text{acq}} = A\n$$\n最后，我们将菲涅尔区的概念作为一个实践指南。虽然第一菲涅尔区是关键，但使用稍大的孔径可以改善求和结果。一个常见的启发式方法是使用菲涅尔半径的倍数。然而，过大的孔径在图像质量上的收益递减，同时显著增加计算成本，并可能累加不相干噪声。该问题使用乘子 $\\beta = 1.5$ 定义了一个目标菲涅尔引导半径，该乘子位于由乘子 $c_1 = 1.0$ 和 $c_2 = 2.0$ 定义的“平衡”区间内。这给出：\n$$\nR_{\\text{target}} = \\beta \\, r_F = 1.5 \\, r_F\n$$\n推荐的孔径 $R_{\\text{rec}}$ 必须同时满足所有三个约束。它不能大于采集所允许的范围（$R_{\\text{acq}}$），它应该足够大以对期望的倾角进行成像（$R_{\\text{dip}}$），并且它应该具有计算效率（$R_{\\text{target}}$）。因此，最佳选择是这些中最严格的一个：\n$$\nR_{\\text{rec}} = \\min\\{R_{\\text{dip}}, R_{\\text{acq}}, R_{\\text{target}}\\}\n$$\n该问题还要求评估用户建议的孔径 $R_{\\text{user}} = \\gamma \\, r_F$，其中 $\\gamma$ 是用户提供的因子。我们可以根据其与第一菲涅尔区的关系来评估该孔径。\n- 如果 $R_{\\text{user}}  c_1 \\, r_F$（即 $R_{\\text{user}}  r_F$），则孔径过小。它未能捕捉到第一菲涅尔区的全部相长干涉。这会导致侧向分辨率的损失、成像点的模糊，以及由于积分的突然截断而可能产生的假象。\n- 如果 $R_{\\text{user}} > c_2 \\, r_F$（即 $R_{\\text{user}} > 2 r_F$），则孔径过大。它对相位变化迅速的远场数据进行积分。这为微不足道的改进增加了显著的计算开销，并可能通过累加弱相干或不相干能量来增加偏移噪声。\n- 如果 $c_1 \\, r_F \\le R_{\\text{user}} \\le c_2 \\, r_F$，则认为孔径是“平衡的”。\n\n我们现在实施这些原则来处理给定的测试用例。对于每个元组 $(v, f_0, z, \\theta_{\\max}^{\\circ}, A, \\gamma)$，我们计算 $r_F$、$R_{\\text{rec}}$，并评估 $R_{\\text{user}}$ 的条件。所有以度为单位的角度输入必须首先转换为弧度。\n\n例如，对于用例1：$(v=2500, f_0=30, z=1500, \\theta_{\\max}^{\\circ}=35, A=5000, \\gamma=5.657)$。\n1.  波长：$\\lambda = v/f_0 = 2500 / 30 \\approx 83.333$ 米。\n2.  菲涅尔半径：$r_F = \\sqrt{\\lambda z} = \\sqrt{(2500/30) \\times 1500} = \\sqrt{125000} \\approx 353.553$ 米。\n3.  倾角限制的孔径：$R_{\\text{dip}} = z \\tan(\\theta_{\\max}) = 1500 \\times \\tan(35^{\\circ}) \\approx 1050.311$ 米。\n4.  采集限制的孔径：$R_{\\text{acq}} = 5000$ 米。\n5.  目标孔径：$R_{\\text{target}} = 1.5 \\times r_F \\approx 1.5 \\times 353.553 = 530.330$ 米。\n6.  推荐孔径：$R_{\\text{rec}} = \\min\\{1050.311, 5000, 530.330\\} = 530.330$ 米。\n7.  用户孔径评估：\n    - 用户半径：$R_{\\text{user}} = \\gamma \\times r_F = 5.657 \\times 353.553 \\approx 2000.009$ 米。\n    - 下界：$c_1 r_F = 1.0 \\times 353.553 = 353.553$ 米。\n    - 上界：$c_2 r_F = 2.0 \\times 353.553 = 707.107$ 米。\n    - $R_{\\text{user}}  c_1 r_F$ 是否成立？$2000.009  353.553$ 为 `False`。\n    - $R_{\\text{user}} > c_2 r_F$ 是否成立？$2000.009 > 707.107$ 为 `True`。\n最终的程序将系统地将此逻辑应用于所有测试用例，并按规定格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the recommended Kirchhoff migration aperture and evaluates a\n    user-proposed aperture based on geophysical principles and given parameters.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (v, f0, z, theta_max_deg, A, gamma)\n    test_cases = [\n        (2500, 30, 1500, 35, 5000, 5.657),  # Case 1\n        (2000, 60, 1000, 5, 1000, 0.548),   # Case 2\n        (3000, 20, 3000, 60, 800, 1.044),   # Case 3\n        (1800, 80, 300, 45, 200, 1.819),   # Case 4\n        (2500, 10, 4000, 80, 10000, 5.000), # Case 5\n        (2200, 55, 1200, 25, 1500, 2.000),  # Case 6\n    ]\n\n    # Fixed constants from the problem description\n    c1 = 1.0\n    c2 = 2.0\n    beta = 1.5\n\n    all_results = []\n    for case in test_cases:\n        v, f0, z, theta_max_deg, A, gamma = case\n\n        # 1. Dominant wavelength\n        # lambda = v / f0\n        # This is used directly in the r_F calculation.\n        \n        # 2. First Fresnel radius at depth\n        # r_F = sqrt(lambda * z) = sqrt((v/f0) * z)\n        r_F = np.sqrt((v / f0) * z)\n\n        # 3. Dip-limited aperture radius\n        # Convert theta_max from degrees to radians for trigonometric functions\n        theta_max_rad = np.deg2rad(theta_max_deg)\n        R_dip = z * np.tan(theta_max_rad)\n\n        # 4. Acquisition-limited radius\n        R_acq = float(A)\n\n        # 5. Target Fresnel-guided radius\n        R_target = beta * r_F\n\n        # 6. Recommended aperture\n        # R_rec = min(R_dip, R_acq, R_target)\n        R_rec = min(R_dip, R_acq, R_target)\n\n        # 7. User-proposed aperture\n        R_user = gamma * r_F\n\n        # 8. Artifact criteria evaluation\n        too_small = R_user  c1 * r_F\n        too_large = R_user  c2 * r_F\n        \n        # Store the results for this case.\n        # The values for R_rec and r_F are not rounded here,\n        # but will be formatted to 3 decimal places in the final print string.\n        all_results.append([R_rec, r_F, too_small, too_large])\n\n    # Format the final output string exactly as required,\n    # with no spaces and with floats formatted to 3 decimal places.\n    sub_list_strings = []\n    for R_rec, r_F, is_too_small, is_too_large in all_results:\n        # str(bool) correctly produces 'True' or 'False'.\n        # f-string formatting handles rounding to 3 decimal places.\n        sub_str = f\"[{R_rec:.3f},{r_F:.3f},{is_too_small},{is_too_large}]\"\n        sub_list_strings.append(sub_str)\n    \n    final_output_string = f\"[{','.join(sub_list_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "即使选定了最佳的偏移孔径，地震数据的离散采样特性仍然可能在偏移求和过程中引入伪影，这一现象被称为“算子混叠”。本实践将深入探究这一问题的根源，通过分析绕射双曲线（即偏移算子）的局部几何特征（如斜率和曲率），并将其与采样理论相结合。你将学习如何推导混叠发生的条件，并设计相应的抗混叠滤波器，这是确保获得清晰、高保真度偏移成像的关键一步 ()。",
            "id": "3606031",
            "problem": "考虑一个传播速度恒定的二维声学介质。某个深度处的脉冲点散射体会在接收域生成一族称为等时线的等时曲线。克希霍夫偏移通过沿等时线求和来形成图像。如果空间采样不满足局部同相轴倾角所要求的采样条件，稀疏的接收点采样会在求和过程中导致空间假频。本文的目标是通过将接收点间距与等时线的局部几何形状联系起来，分析稀疏接收排列中的假频问题，然后仅利用基本原理，在偏移前于时间-空间域设计一个倾角自适应的抗假频滤波器。\n\n推导的起点必须限于基本定律和核心定义：\n- 声学各向同性恒速介质中，从横向位置 $x=0$ 下方深度为 $z$ 的点绕射体出发的双程旅行时运动学由等时曲线 $t(x)$ 给出，该曲线由沿直线射线的双程旅行时定义，从而得到与路径长度成正比的等时线 $t(x)$。\n- 空间域的奈奎斯特-香农采样定理（NSST）指出，对于最大空间波数大小为 $k_{x,\\max}$ 的带限空间频率内容，以间距 $\\Delta x_r$ 进行的均匀采样必须满足 $k_{x,\\max} \\le \\pi / \\Delta x_r$ 以避免空间假频。\n- 记录数据中的局部平面波可以表示为具有相位 $\\phi(t,x) = \\omega t - k_x x$ 的函数，其中 $\\omega$ 是角频率， $k_x$ 是空间波数。沿着等相位轨迹，根据相位稳态的运动学要求，局部斜率 $p = \\mathrm{d}t/\\mathrm{d}x$ 将 $\\omega$ 和 $k_x$ 关联起来。\n\n任务：\n1. 推导局部斜率 $p(t,x) = \\mathrm{d}t/\\mathrm{d}x$ 与记录到的同相轴的空间波数 $k_x$ 之间的关系。利用此关系，对于给定的接收点间距 $\\Delta x_r$（单位：米），表示出避免空间假频所允许的最大时间频率 $f$（单位：赫兹）的条件。您的最终条件必须完全用 $\\Delta x_r$、局部斜率大小 $\\lvert p \\rvert$ 和 $f$ 来表示。\n2. 对于速度为 $v$（单位：米/秒）、深度为 $z$（单位：米）的恒速介质中的点绕射体，写出等时线 $t(x)$ 作为横向坐标 $x$（单位：米）的函数。根据 $t(x)$ 计算一阶导数 $p(x) = \\mathrm{d}t/\\mathrm{d}x$（单位：秒/米）和二阶导数 $\\kappa(x) = \\mathrm{d}^2 t/\\mathrm{d}x^2$（单位：秒/米平方）。证明在有限孔径 $x \\in [-X, X]$（其中 $X$ 单位为米）内，最大斜率 $p_{\\max}$ 出现在孔径边缘，最大曲率 $\\kappa_{\\max}$ 出现在顶点 $x=0$ 处。用 $v$、 $z$ 和 $X$ 表示 $p_{\\max}$ 和 $\\kappa_{\\max}$。\n3. 提出一种在偏移前应用于时间-空间域 $(t,x)$ 的倾角自适应抗假频低通滤波器，该滤波器根据局部斜率 $p$ 限制每个采样点的时间带宽。您的设计必须指定一个截止频率 $f_c(t,x)$（单位：赫兹），以确保满足空间采样要求。同时，根据时间采样间隔 $\\Delta t$（单位：秒）施加时间奈奎斯特限制。\n4. 通过比较相邻接收点之间的二阶时间变化与时间采样间隔，评估顶点附近由曲率引起的时间插值假频。使用曲率 $\\kappa_{\\max}$ 和间距 $\\Delta x_r$ 形成一个充分条件，确保相邻接收点之间的二阶旅行时偏移量保持在时间采样间隔 $\\Delta t$ 以下。\n\n实现：\n- 实现一个程序，对于每个测试用例，计算：\n  - 孔径上的最大斜率 $p_{\\max}$。\n  - 最大曲率 $\\kappa_{\\max}$。\n  - 倾角自适应截止频率 $f_c = \\min\\left(\\frac{1}{2\\Delta t}, \\frac{1}{2\\Delta x_r \\lvert p_{\\max} \\rvert}\\right)$（单位：赫兹）。\n  - 一个布尔值 $A_s$，表示在没有滤波的情况下，源的峰值频率 $f_s$（单位：赫兹）是否会引起空间假频，定义为 $A_s = \\bigl(f_s > \\frac{1}{2\\Delta x_r \\lvert p_{\\max} \\rvert}\\bigr)$。\n  - 一个布尔值 $A_t$，表示顶点附近存在时间插值假频的风险，定义为 $A_t = \\bigl(\\kappa_{\\max} \\Delta x_r^2 > \\Delta t\\bigr)$。\n- 将截止频率以赫兹表示，布尔值以基本类型表示。频率必须四舍五入到三位小数。距离单位必须为米，时间单位必须为秒。\n\n测试套件：\n对 $(v, z, \\Delta x_r, X, \\Delta t, f_s)$ 使用以下参数集，所有单位均为国际单位制：\n- 案例1（一般情况）： $(2500, 1500, 10, 1000, 0.002, 60)$。\n- 案例2（假频风险）： $(2000, 1000, 25, 2000, 0.004, 60)$。\n- 案例3（边界条件）： $(3000, 2000, 21.22, 2000, 0.002, 50)$。\n- 案例4（高曲率边缘）： $(2000, 200, 30, 500, 0.001, 80)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素对应一个测试用例，并且本身必须是一个包含三个元素的列表 $[f_c, A_s, A_t]$，其中 $f_c$ 是一个四舍五入到三位小数的浮点数（单位：赫兹），$A_s$ 是一个布尔值，$A_t$ 是一个布尔值。例如，输出必须类似于 $[[f_{c1}, A_{s1}, A_{t1}],[f_{c2}, A_{s2}, A_{t2}],\\dots]$。",
            "solution": "问题陈述经评估具有科学依据、提法恰当、客观且完整。它基于应用于地球物理成像的波传播和信号处理的既定原则。所有必要的参数和定义都已提供，可得出唯一且有意义的解。因此，我们可以着手进行推导和实现。\n\n解决方案分为四个部分，与问题中列出的任务相对应。\n\n**第1部分：空间抗假频条件的推导**\n\n局部平面波的时间频率和空间波数之间的关系是本分析的基础。记录数据中的局部平面波同相轴可由等相位轨迹描述。相位由 $\\phi(t,x) = \\omega t - k_x x$ 给出，其中 $\\omega = 2\\pi f$ 是角时间频率， $f$ 是以赫兹为单位的时间频率， $k_x$ 是空间波数。\n\n为了使相位沿着由旅行时曲线 $t(x)$ 定义的同相轴轨迹保持稳定，其全微分必须为零：\n$$ \\mathrm{d}\\phi = \\frac{\\partial\\phi}{\\partial t}\\mathrm{d}t + \\frac{\\partial\\phi}{\\partial x}\\mathrm{d}x = \\omega \\mathrm{d}t - k_x \\mathrm{d}x = 0 $$\n两边同除以 $\\mathrm{d}x$，我们得到同相轴的局部斜率 $p(x) = \\frac{\\mathrm{d}t}{\\mathrm{d}x}$ 与波参数之间的关系：\n$$ \\omega \\frac{\\mathrm{d}t}{\\mathrm{d}x} - k_x = 0 \\implies k_x = \\omega p(x) $$\n空间域的奈奎斯特-香农采样定理（NSST）规定，为避免假频，信号中存在的最高空间波数的幅值 $|k_x|_{\\max}$ 不得超过空间奈奎斯特波数。对于均匀的接收点间距 $\\Delta x_r$，采样波数为 $k_{s,x} = 2\\pi/\\Delta x_r$，奈奎斯特波数为 $k_{Nyq,x} = k_{s,x} / 2 = \\pi/\\Delta x_r$。因此，抗假频条件为：\n$$ |k_x| \\le \\frac{\\pi}{\\Delta x_r} $$\n代入 $k_x$ 的表达式：\n$$ |\\omega p(x)| \\le \\frac{\\pi}{\\Delta x_r} $$\n由于 $\\omega > 0$，我们有 $\\omega |p(x)| \\le \\frac{\\pi}{\\Delta x_r}$。用 $2\\pi f$ 替换 $\\omega$：\n$$ (2\\pi f) |p(x)| \\le \\frac{\\pi}{\\Delta x_r} $$\n对时间频率 $f$ 求解，我们得到在给定接收点间距 $\\Delta x_r$ 和局部斜率大小 $|p(x)|$ 的情况下，避免空间假频所允许的最大频率条件：\n$$ f \\le \\frac{1}{2 \\Delta x_r |p(x)|} $$\n\n**第2部分：点绕射体的运动学**\n\n在速度为 $v$ 的恒速介质中，对于位于位置 $x=0$ 下方深度 $z$ 处的点绕射体，零偏移距采集（即震源和接收点位于同一横向位置 $x$）的双程旅行时由总路径长度决定。从地表 $(x, 0)$ 到绕射体 $(0, -z)$ 再返回的路径长度为 $2 \\sqrt{x^2 + z^2}$。因此，旅行时 $t(x)$ 为：\n$$ t(x) = \\frac{2\\sqrt{x^2 + z^2}}{v} $$\n此方程描述了双曲绕射曲线，即等时线。\n\n一阶导数 $p(x) = \\mathrm{d}t/\\mathrm{d}x$ 表示局部斜率：\n$$ p(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( \\frac{2}{v} (x^2 + z^2)^{1/2} \\right) = \\frac{2}{v} \\cdot \\frac{1}{2} (x^2 + z^2)^{-1/2} (2x) = \\frac{2x}{v\\sqrt{x^2 + z^2}} $$\n斜率的大小 $|p(x)|$ 随着 $|x|$ 的增大而增大。因此，在有限孔径 $x \\in [-X, X]$ 上，最大斜率大小 $p_{\\max}$ 出现在孔径的边缘，即 $x=\\pm X$ 处：\n$$ p_{\\max} = |p(X)| = \\frac{2X}{v\\sqrt{X^2 + z^2}} $$\n二阶导数 $\\kappa(x) = \\mathrm{d}^2t/\\mathrm{d}x^2$ 表示等时线的曲率：\n$$ \\kappa(x) = \\frac{\\mathrm{d}p}{\\mathrm{d}x} = \\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( \\frac{2x}{v(x^2 + z^2)^{1/2}} \\right) = \\frac{2v\\sqrt{x^2+z^2} - 2x \\cdot \\frac{vx}{\\sqrt{x^2+z^2}}}{v^2(x^2+z^2)} = \\frac{2v(x^2+z^2) - 2vx^2}{v^2(x^2+z^2)^{3/2}} = \\frac{2vz^2}{v^2(x^2+z^2)^{3/2}} $$\n$$ \\kappa(x) = \\frac{2z^2}{v(x^2 + z^2)^{3/2}} $$\n曲率 $\\kappa(x)$ 是 $|x|$ 的递减函数。其最大值 $\\kappa_{\\max}$ 出现在双曲线的顶点，即 $x=0$ 处：\n$$ \\kappa_{\\max} = \\kappa(0) = \\frac{2z^2}{v(0 + z^2)^{3/2}} = \\frac{2z^2}{vz^3} = \\frac{2}{vz} $$\n\n**第3部分：倾角自适应抗假频滤波器设计**\n\n根据第1部分推导出的条件，可以通过确保每个道位置 $x$ 处的信号时间频率内容不超过由局部斜率 $|p(x)|$ 决定的最大值来防止空间假频。这表明需要一个倾角自适应的低通滤波器，其截止频率随空间位置而变化。\n\n在位置 $x$ 处防止空间假频所需的截止频率 $f_{aa}(x)$ 为：\n$$ f_{aa}(x) = \\frac{1}{2 \\Delta x_r |p(x)|} $$\n此外，任何数字信号都固有地受到时间采样的带宽限制。对于时间采样间隔 $\\Delta t$，时间奈奎斯特频率为 $f_{Nyq,t} = \\frac{1}{2\\Delta t}$。任何位置 $x$ 处的有效截止频率 $f_c(x)$ 必须同时满足这两个约束。因此，它是两者的最小值：\n$$ f_c(x) = \\min\\left(f_{Nyq,t}, f_{aa}(x)\\right) = \\min\\left(\\frac{1}{2\\Delta t}, \\frac{1}{2 \\Delta x_r |p(x)|}\\right) $$\n在实践中，局部斜率 $p(x)$ 是从数据中估计的。为了本问题的实现，通过使用最大斜率 $p_{\\max}$ 为整个孔径计算一个保守的截止频率。这确保了同相轴的任何部分都不会产生假频。\n$$ f_c = \\min\\left(\\frac{1}{2\\Delta t}, \\frac{1}{2\\Delta x_r p_{\\max}}\\right) $$\n\n**第4部分：时间插值假频**\n\n在克希霍夫偏移过程中，地震数据是沿着双曲算子的离散点进行求和的。如果双曲线弯曲得很厉害，相邻道上的采样点之间可能会有很大的时间步长，这种现象有时被称为“算子假频”或时间插值假频。这种情况在双曲线顶点附近最为严重，因为那里的曲率 $\\kappa$ 最大。\n\n我们可以通过检查旅行时函数 $t(x)$ 在顶点（$x=0$）处的二阶中心差分来量化此效应，该差分近似于二阶导数乘以采样间隔的平方。让我们考虑位于 $x=-\\Delta x_r$、 $x=0$ 和 $x=\\Delta x_r$ 的三个相邻接收点上的旅行时。\n$$ \\Delta^2 t_0 = t(\\Delta x_r) - 2t(0) + t(-\\Delta x_r) $$\n由于 $t(x)$ 是偶函数，所以 $t(-\\Delta x_r) = t(\\Delta x_r)$，因此：\n$$ \\Delta^2 t_0 = 2(t(\\Delta x_r) - t(0)) $$\n使用 $t(x)$ 在 $x=0$ 附近的二阶泰勒展开，其中 $p(0)=0$ 且 $\\kappa(0)=\\kappa_{\\max}$：\n$$ t(\\Delta x_r) \\approx t(0) + p(0)\\Delta x_r + \\frac{1}{2}\\kappa(0)(\\Delta x_r)^2 = t(0) + \\frac{1}{2}\\kappa_{\\max}(\\Delta x_r)^2 $$\n将此代入 $\\Delta^2 t_0$ 的表达式中：\n$$ \\Delta^2 t_0 \\approx 2\\left(\\frac{1}{2}\\kappa_{\\max}(\\Delta x_r)^2\\right) = \\kappa_{\\max}(\\Delta x_r)^2 $$\n这个量表示在两个道的间隔内旅行时的非线性变化。如果此变化超过时间采样间隔 $\\Delta t$，偏移算子的离散表示将成为连续双曲线的不良近似，可能导致伪影。因此，时间插值假频风险高的条件是：\n$$ \\kappa_{\\max} (\\Delta x_r)^2 > \\Delta t $$\n这就完成了实现所需的理论推导。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates aliasing parameters for Kirchhoff migration based on a series of test cases.\n    \"\"\"\n    # Test cases: (v, z, delta_xr, X, delta_t, f_s)\n    # v: velocity (m/s)\n    # z: depth (m)\n    # delta_xr: receiver spacing (m)\n    # X: half-aperture width (m)\n    # delta_t: time sampling interval (s)\n    # f_s: source peak frequency (Hz)\n    test_cases = [\n        (2500, 1500, 10, 1000, 0.002, 60),\n        (2000, 1000, 25, 2000, 0.004, 60),\n        (3000, 2000, 21.22, 2000, 0.002, 50),\n        (2000, 200, 30, 500, 0.001, 80),\n    ]\n\n    results = []\n    for case in test_cases:\n        v, z, dx_r, X, dt, f_s = case\n\n        # Task 2: Compute maximum slope and curvature\n        # Maximum slope p_max at the edge of the aperture\n        if (X**2 + z**2)  0:\n            p_max = (2 * X) / (v * np.sqrt(X**2 + z**2))\n        else:\n            p_max = 0.0\n\n        # Maximum curvature kappa_max at the apex\n        k_max = 2 / (v * z)\n\n        # Task 3: Compute dip-adaptive cutoff frequency\n        # Anti-aliasing frequency limit based on p_max\n        if dx_r  0 and p_max  0:\n            f_aa = 1 / (2 * dx_r * p_max)\n        else:\n            f_aa = float('inf')\n\n        # Temporal Nyquist frequency\n        f_nyq_t = 1 / (2 * dt)\n\n        # The effective cutoff frequency is the minimum of the two\n        f_c = min(f_nyq_t, f_aa)\n\n        # Task 4  Implementation: Compute aliasing booleans\n        # A_s: Spatial aliasing check for source frequency\n        A_s = f_s  f_aa\n\n        # A_t: Time-interpolation aliasing check\n        A_t = (k_max * dx_r**2)  dt\n        \n        # Round f_c to three decimal places as required\n        f_c_rounded = round(f_c, 3)\n\n        results.append([f_c_rounded, A_s, A_t])\n\n    # Format the final output string exactly as specified, without spaces\n    # Example: [[fc1,As1,At1],[fc2,As2,At2],...]\n    output_str_parts = []\n    for res in results:\n        # Manually format each inner list to avoid spaces introduced by str(list)\n        # f-string automatically calls repr() on booleans, yielding 'True'/'False'\n        part = f\"[{res[0]},{res[1]},{res[2]}]\"\n        output_str_parts.append(part)\n    \n    final_output = f\"[{','.join(output_str_parts)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "完成偏移处理后，我们如何客观地评估成像结果的质量？点扩散函数（PSF）是回答这个问题的核心工具，它描述了整个成像系统对一个理想点绕射体的响应。通过分析PSF的形状、方向和各向异性，我们可以揭示成像的分辨率极限和潜在的伪影。本实践将指导你计算和分析一个近似的PSF（通过计算正规算子或Hessian算子 $H=L^\\dagger L$ 的作用），让你直观地理解采集几何是如何最终决定地下图像的质量和可靠性的 ()。",
            "id": "3605972",
            "problem": "考虑在深度坐标 $y = 0$ 处具有自由表面和空间变化波速场 $v(\\mathbf{x})$ 的非均匀介质中的二维 (2D) 声波传播，其中 $\\mathbf{x} = (x,y)$。声压场 $p(\\mathbf{x}, t)$ 满足常密度声波方程\n$$\\frac{1}{v^2(\\mathbf{x})}\\frac{\\partial^2 p(\\mathbf{x}, t)}{\\partial t^2} - \\nabla^2 p(\\mathbf{x}, t) = s(\\mathbf{x}, t),$$\n其中 $s(\\mathbf{x}, t)$ 是一个震源项。在针对弱扰动的线性化 Born 近似下，记录的数据可以写为作用于反射率 $m(\\mathbf{x})$ 的一个线性算子。Kirchhoff 偏移算子是带有适当几何和带限加权的线性化正演算子的伴随算子。法算子（也称为 Hessian）是 $H = L^\\dagger L$，其中 $L$ 是正演算子，$L^\\dagger$ 是其伴随算子。\n\n您的任务如下，全部在高频（射线理论）范畴下，采用与平滑非均匀 $v(\\mathbf{x})$ 一致的直线射线近似：\n\n- 从声波方程和 Kirchhoff 积分表示出发，推导零偏移距采集（震源和接收器位于地表同一位置）下 Kirchhoff 偏移的伴随叠加解释。展示作用于 $\\mathbf{x}_0$ 处局部化反射率的 $H = L^\\dagger L$ 如何产生一个点扩散函数 (PSF) $\\mathrm{PSF}(\\mathbf{x}; \\mathbf{x}_0)$，该函数可以解释为由稳相走时拟合控制的、对采集孔径进行的带限求和。\n\n- 定义一个物理上合理且计算上可行的非均匀速度模型和采集几何，并指定一个带限时间选择核。然后，编写一个完整、可运行的程序，计算作用于 $\\mathbf{x}_0$ 处单位脉冲的法算子的近似值，即在 $\\mathbf{x}_0$ 周围的局部成像网格上计算 $\\mathrm{PSF}(\\mathbf{x}; \\mathbf{x}_0)$，并分析 PSF 各向异性作为局部反射层倾角和采集孔径的函数。\n\n使用以下科学上合理且自洽的规范：\n\n- 介质和速度：设 $v(\\mathbf{x}) = v_0 + \\gamma y$，其中 $v_0 = 2000$（单位 $\\mathrm{m/s}$），$\\gamma = 0.6$（单位 $\\mathrm{s}^{-1}$），因此 $v(\\mathbf{x})$ 随深度线性增加。\n\n- 采集：零偏移距震源位于自由表面 $y = 0$ 处，其横向位置 $x_s$ 在对称孔径 $[-A, A]$ 内均匀分布，间距 $\\Delta x_s = 25$（单位 $\\mathrm{m}$）。对于每个测试用例的孔径 $A$，使用此范围内的所有震源位置。\n\n- 成像点和网格：选择分析点 $\\mathbf{x}_0 = (0, 1000)$（单位 $\\mathrm{m}$）。在以 $\\mathbf{x}_0$ 为中心的局部成像网格上计算 PSF，该网格范围为 $[x_0 - L_x, x_0 + L_x] \\times [y_0 - L_y, y_0 + L_y]$，其中 $L_x = 200$（单位 $\\mathrm{m}$），$L_y = 200$（单位 $\\mathrm{m}$），均匀采样间隔 $\\Delta x = \\Delta y = 10$（单位 $\\mathrm{m}$）。\n\n- 走时：对于每个震源位置 $x_s$ 和网格点 $\\mathbf{x} = (x,y)$，使用中点近似沿线段进行直线射线积分来近似单程走时，\n$$\\tau(\\mathbf{x}; x_s) \\approx \\frac{L(\\mathbf{x}; x_s)}{\\bar{v}(\\mathbf{x})}, \\quad L(\\mathbf{x}; x_s) = \\sqrt{(x - x_s)^2 + y^2}, \\quad \\bar{v}(\\mathbf{x}) = v_0 + \\gamma \\frac{y}{2}.$$\n对于零偏移距偏移，使用双程时 $t(\\mathbf{x}; x_s) = 2 \\tau(\\mathbf{x}; x_s)$。\n\n- 带限时间选择核：使用高斯时间门来近似稳相点周围的带限匹配滤波。设主频为 $f_0 = 20$（单位 $\\mathrm{Hz}$），定义时间标准差 $\\sigma_t = 0.25 / f_0$（单位 $\\mathrm{s}$）。对于 $\\mathbf{x}_0$ 处的单位反射率，来自震源 $x_s$ 对 $\\mathbf{x}$ 处 PSF 的贡献由以下公式加权：\n$$w_t(\\mathbf{x}; x_s) = \\exp\\!\\left( - \\frac{(t(\\mathbf{x}; x_s) - t(\\mathbf{x}_0; x_s))^2}{2 \\sigma_t^2} \\right).$$\n\n- 几何振幅：包含一个简单的几何扩散因子 $w_g(\\mathbf{x}; x_s) = 1 / \\big(L(\\mathbf{x}; x_s) + \\epsilon\\big)$，其中正则化项 $\\epsilon = 1$（单位 $\\mathrm{m}$），并通过对所有孔径内的震源 $x_s$ 求和 $w_t(\\mathbf{x}; x_s) \\, w_g(\\mathbf{x}; x_s)$ 来形成 PSF。\n\n- PSF 各向异性分析：对于给定的局部倾角 $\\theta$（单位为度），根据局部网格上的 PSF 定义各向异性度量如下。使用 PSF 值作为非负权重，计算偏移量 $\\mathbf{r} = (x - x_0, y - y_0)$ 的加权协方差矩阵，\n$$\\Sigma = \\frac{\\sum_i w_i \\, (\\mathbf{r}_i - \\bar{\\mathbf{r}})(\\mathbf{r}_i - \\bar{\\mathbf{r}})^\\top}{\\sum_i w_i}, \\quad \\bar{\\mathbf{r}} = \\frac{\\sum_i w_i \\, \\mathbf{r}_i}{\\sum_i w_i}, \\quad w_i = \\mathrm{PSF}(\\mathbf{x}_i; \\mathbf{x}_0).$$\n设 $\\Sigma$ 的特征值为 $\\lambda_{\\max} \\ge \\lambda_{\\min} \\ge 0$，对应的单位特征向量为 $\\mathbf{e}_{\\max}$。定义各向异性比为标准差之比 $R = \\sqrt{\\lambda_{\\max}} / \\sqrt{\\lambda_{\\min}}$。定义 PSF 主轴方向角 $\\phi_{\\max}$（单位为度）为 $\\mathbf{e}_{\\max}$ 与水平方向（正 x 轴）的夹角，并定义其与局部倾斜方向角 $\\theta$（单位为度）的方向差异为最小无向角\n$$\\Delta \\phi = \\min\\!\\left( \\left| \\phi_{\\max} - \\theta \\right| , \\, 180 - \\left| \\phi_{\\max} - \\theta \\right| \\right) \\quad \\text{（单位为度）。}$$\n\n您的程序必须实现上述内容，并为下面列出的每个测试用例生成各向异性比 $R$（无量纲）和方向差异 $\\Delta \\phi$（单位为度）。\n\n测试套件：\n\n- 用例 1：倾角 $\\theta = 0$ 度，孔径半宽度 $A = 1000$ 米。\n\n- 用例 2：倾角 $\\theta = 60$ 度，孔径半宽度 $A = 1000$ 米。\n\n- 用例 3：倾角 $\\theta = 60$ 度，孔径半宽度 $A = 200$ 米。\n\n- 用例 4：倾角 $\\theta = 80$ 度，孔径半宽度 $A = 2000$ 米。\n\n- 用例 5：倾角 $\\theta = 0$ 度，孔径半宽度 $A = 50$ 米。\n\n最终输出格式：\n\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试用例的顺序列出结果。对于每个用例，附加各向异性比 $R$ 和方向差异 $\\Delta \\phi$，两者均为浮点数。例如，输出应类似于 $\\left[\\text{case1\\_R}, \\text{case1\\_DeltaPhi}, \\text{case2\\_R}, \\text{case2\\_DeltaPhi}, \\ldots \\right]$。\n\n所有距离单位必须是米（$\\mathrm{m}$），所有时间单位必须是秒（$\\mathrm{s}$），速度单位是米/秒（$\\mathrm{m/s}$），所有角度单位是度。程序必须是自包含的，并且不得读取任何输入或外部文件。法算子的计算必须反映指定的物理原理和近似，并且必须显式实现，不能使用黑箱偏移函数。",
            "solution": "问题被评估为有效。它基于波动理论和地震成像的原理，具有科学依据，所有必要的参数和方程都已定义，问题是适定的，并且在计算上是可行的。近似方法（如直线射线走时计算）的使用被明确说明为问题定义的一部分，不构成缺陷。\n\n按照要求，解决方案分两部分呈现：首先，对 Kirchhoff 偏移算子和产生的点扩散函数 (PSF) 进行理论推导，然后是计算和分析 PSF 的程序实现。\n\n### 第 1 部分：理论推导\n\n问题根植于非均匀介质中速度为 $v(\\mathbf{x})$ 的压力场 $p(\\mathbf{x}, t)$ 的常密度声波方程：\n$$ \\left( \\frac{1}{v^2(\\mathbf{x})} \\frac{\\partial^2}{\\partial t^2} - \\nabla^2 \\right) p(\\mathbf{x}, t) = s(\\mathbf{x}, t) $$\n其中 $\\mathbf{x} = (x, y)$ 是空间坐标，$t$ 是时间，$s(\\mathbf{x}, t)$ 是震源项。\n\n我们考虑一个背景速度模型 $v_b(\\mathbf{x})$ 和一个真实速度模型 $v(\\mathbf{x})$。地下反射率，或散射势，由模型扰动 $m(\\mathbf{x})$ 定义：\n$$ m(\\mathbf{x}) = \\frac{1}{v_b^2(\\mathbf{x})} - \\frac{1}{v^2(\\mathbf{x})} $$\n在一阶 Born 近似下，该近似对弱散射（$m(\\mathbf{x})$ 很小）有效，总波场 $p$ 被分解为背景场 $p_b$ 和散射场 $p_s$，其中 $p=p_b+p_s$。散射场与反射率模型 $m(\\mathbf{x})$ 线性相关。由于位于 $\\mathbf{x}_s$ 的震源在时间 $t=0$ 时以子波 $w(t)$ 激发，在接收点位置 $\\mathbf{x}_r$ 记录到的散射数据 $d$ 可以表示为作用在模型 $m(\\mathbf{x})$ 上的线性正演算子 $L$：\n$$ d(\\mathbf{x}_r, t; \\mathbf{x}_s) = (L m)(\\mathbf{x}_r, t; \\mathbf{x}_s) = \\int_V d\\mathbf{x} \\, m(\\mathbf{x}) \\left( \\frac{\\partial^2}{\\partial t^2} p_b(\\mathbf{x}, t; \\mathbf{x}_s) \\right) * G(\\mathbf{x}_r, t; \\mathbf{x}) $$\n这里，$p_b(\\mathbf{x}, t; \\mathbf{x}_s)$ 是由震源在点 $\\mathbf{x}$ 产生的背景波场，可近似为 $w(t) * G(\\mathbf{x}, t; \\mathbf{x}_s)$，$G$ 是背景介质的格林函数。星号 $*$ 表示时间褶积。在高频（射线理论）极限下，格林函数是一个被走时 $\\tau$ 延迟的脉冲，因此数据可以写成：\n$$ d(\\mathbf{x}_r, t; \\mathbf{x}_s) \\approx \\int_V d\\mathbf{x} \\, m(\\mathbf{x}) \\, A(\\mathbf{x}_s, \\mathbf{x}, \\mathbf{x}_r) \\, w''(t - \\tau(\\mathbf{x}_s, \\mathbf{x}) - \\tau(\\mathbf{x}, \\mathbf{x}_r)) $$\n其中 $A$ 包含几何扩散和其他振幅因子，$\\tau(\\mathbf{a}, \\mathbf{b})$ 是从 $\\mathbf{a}$ 到 $\\mathbf{b}$ 的单程走时。\n\nKirchhoff 偏移是从记录数据 $d$ 生成反射率图像 $m_{\\text{mig}}(\\mathbf{x})$ 的过程。它被形式化为应用于数据的伴随算子 $L^\\dagger$。伴随算子可以通过考察正演模拟积分来找到。对于每个成像点 $\\mathbf{x}$，偏移沿运动学走时曲面累加数据贡献。对于零偏移距采集几何，其中震源和接收器位于地表同一位置，$\\mathbf{x}_s = \\mathbf{x}_r = (x_s, 0)$，双程走时为 $t(\\mathbf{x}; x_s) = 2 \\tau((x_s, 0), \\mathbf{x})$。偏移算子 $L^\\dagger$ 变为对震源位置的加权叠加：\n$$ m_{\\text{mig}}(\\mathbf{x}) = (L^\\dagger d)(\\mathbf{x}) = \\int_{\\text{aperture}} dx_s \\, W(\\mathbf{x}; x_s) d(x_s, t = t(\\mathbf{x}; x_s)) $$\n这里，$W(\\mathbf{x}; x_s)$ 是一个包含几何扩散和其他因素的权重函数。这个积分代表了“伴随叠加”解释：对于每个成像点 $\\mathbf{x}$，我们计算其对于每个震源 $x_s$ 的期望双程走时 $t(\\mathbf{x}; x_s)$，在该时间点对 $x_s$ 处记录的数据道进行采样，并以适当的权重加到图像上。\n\n法算子，或 Hessian，$H = L^\\dagger L$，描述了正演模拟和偏移的综合效应。它在成像空间中充当模糊或分辨率算子。点扩散函数 (PSF) 是 Hessian 作用于一个理想化点绕射体的结果。设真实模型为在 $\\mathbf{x}_0$ 处的单位振幅点绕射体，即 $m(\\mathbf{x}) = \\delta(\\mathbf{x} - \\mathbf{x}_0)$。\n\n1.  **正演模拟 ($L$)**：我们首先通过将 $L$ 应用于 $m(\\mathbf{x})$ 来生成合成数据。数据积分简化为在 $\\mathbf{x} = \\mathbf{x}_0$ 处对核函数求值：\n    $$ d_{\\text{syn}}(x_s, t) = (L m)(x_s, t) \\approx A(\\mathbf{x}_0; x_s) \\, w''(t - t(\\mathbf{x}_0; x_s)) $$\n    这意味着每个震源 $x_s$ 记录的数据仅仅是（震源子波的二阶导数），由一个振幅 $A$ 缩放并延迟到绕射体的双程走时 $t(\\mathbf{x}_0; x_s)$。\n\n2.  **偏移 ($L^\\dagger$)**：接下来，我们将偏移算子 $L^\\dagger$ 应用于此合成数据 $d_{\\text{syn}}$ 以获得 PSF：\n    $$ \\mathrm{PSF}(\\mathbf{x}; \\mathbf{x}_0) = (L^\\dagger d_{\\text{syn}})(\\mathbf{x}) = \\int_{\\text{aperture}} dx_s \\, W(\\mathbf{x}; x_s) d_{\\text{syn}}(x_s, t = t(\\mathbf{x}; x_s)) $$\n    代入 $d_{\\text{syn}}$ 的表达式：\n    $$ \\mathrm{PSF}(\\mathbf{x}; \\mathbf{x}_0) \\approx \\int_{\\text{aperture}} dx_s \\, W(\\mathbf{x}; x_s) A(\\mathbf{x}_0; x_s) \\, w''(t(\\mathbf{x}; x_s) - t(\\mathbf{x}_0; x_s)) $$\n    此表达式表明，成像点 $\\mathbf{x}$ 处的 PSF 是通过对采集孔径内的所有震源 $x_s$ 的贡献求和而形成的。每个震源的贡献仅在走时差 $\\Delta t = t(\\mathbf{x}; x_s) - t(\\mathbf{x}_0; x_s)$ 很小，即在子波 $w''$ 的持续时间内才非零。$\\Delta t \\approx 0$ 的条件是控制相长干涉形成图像的稳相条件。这证明了将 PSF 解释为“由稳相走时拟合控制的、对采集孔径进行的带限求和”。\n\n问题的计算部分直接实现了这个最终积分的离散版本。$w''(t(\\mathbf{x}; x_s) - t(\\mathbf{x}_0; x_s))$ 项对应于带限时间选择核 $w_t(\\mathbf{x}; x_s)$，组合的振幅项 $W(\\mathbf{x}; x_s) A(\\mathbf{x}_0; x_s)$ 由几何扩散因子 $w_g(\\mathbf{x}; x_s)$ 近似。对 $x_s$ 的积分变成了对离散震源位置的求和。\n\n### 第 2 部分：计算分析\n\n提供的 Python 代码实现了计算和分析 PSF 的过程。\n\n- **设置**：它定义了所有物理和计算参数，包括速度模型 ($v_0, \\gamma$)、采集几何（$\\Delta x_s$，以及每个用例的孔径 $A$）、成像网格规范（$L_x, L_y, \\Delta x, \\Delta y$）和成像参数（$f_0, \\sigma_t, \\epsilon$）。\n\n- **PSF 计算**：对于每个测试用例，它遍历所有指定的震源位置 $x_s$。对于每个震源，它计算对整个成像网格上 PSF 的贡献。为提高效率，此计算已向量化。\n    - 使用指定的直线射线、中点速度近似计算到真实点绕射体 $\\mathbf{x}_0=(0, 1000)$ 和到网格上每个点 $\\mathbf{x}$ 的双程走时：$t(\\mathbf{x}; x_s) = 2 \\sqrt{(x-x_s)^2+y^2} / (v_0+\\gamma y/2)$。\n    - 为每个网格点计算时间选择权重 $w_t$（走时差的高斯函数）和几何扩散权重 $w_g$。\n    - 这些权重的乘积给出了来自震源 $x_s$ 的贡献，该贡献被累加到 `PSF` 数组中。\n\n- **各向异性分析**：在对所有震源的贡献求和后，对得到的 `PSF` 数组进行分析。\n    - `PSF` 值作为加权协方差分析中网格点相对于中心 $\\mathbf{x}_0$ 位置的权重。\n    - 计算空间偏移量的 $2 \\times 2$ 加权协方差矩阵 $\\Sigma$。$\\Sigma$ 的特征值 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 量化了 PSF 沿其主轴的方差（扩散）。相应的特征向量定义了这些轴的方向。\n    - 计算各向异性比 $R = \\sqrt{\\lambda_{\\max}/\\lambda_{\\min}}$。较大的 $R$ 值表示一个高度拉长的、各向异性的 PSF，对应于某个方向上的较差分辨率。\n    - 从对应于 $\\lambda_{\\max}$ 的特征向量计算主轴的方向角 $\\phi_{\\max}$。\n    - 最后，计算方向差异 $\\Delta\\phi$，即 PSF 主轴方向 $\\phi_{\\max}$ 与参考倾角 $\\theta$ 之间的最小无向角，这提供了一个衡量成像伪影如何与该倾角的地质特征对齐的度量。\n\n- **执行**：代码遍历提供的五个测试用例，为每个用例计算 $(R, \\Delta\\phi)$，并按指定格式打印收集到的结果。结果用数值表明了 PSF 各向异性和方向如何依赖于采集孔径和所分析的倾角。例如，较小的孔径通常会导致较大的各向异性比 R，表示分辨率较差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and analyzes the Point Spread Function (PSF) for Kirchhoff migration\n    under specified approximations for a series of test cases.\n    \"\"\"\n    \n    # ----------------------------------------------------------------------\n    # Define physical and computational constants from the problem statement\n    # ----------------------------------------------------------------------\n    \n    # Medium and velocity model\n    v0 = 2000.0  # Velocity at surface, in m/s\n    gamma = 0.6  # Velocity gradient, in s^-1\n    \n    # Acquisition parameters\n    dx_s = 25.0  # Source spacing, in m\n    \n    # Image point and grid\n    x0, y0 = 0.0, 1000.0  # Center of analysis, in m\n    Lx, Ly = 200.0, 200.0  # Half-widths of the local image grid, in m\n    dx, dy = 10.0, 10.0   # Grid sampling, in m\n    \n    # Imaging parameters\n    f0 = 20.0  # Dominant frequency, in Hz\n    sigma_t = 0.25 / f0  # Time standard deviation for Gaussian kernel, in s\n    epsilon = 1.0  # Regularizer for geometric spreading, in m\n    \n    # ----------------------------------------------------------------------\n    # Setup image grid\n    # ----------------------------------------------------------------------\n    x_coords = np.arange(x0 - Lx, x0 + Lx + dx, dx)\n    y_coords = np.arange(y0 - Ly, y0 + Ly + dy, dy)\n    xx, yy = np.meshgrid(x_coords, y_coords)\n    \n    # ----------------------------------------------------------------------\n    # Define test cases\n    # ----------------------------------------------------------------------\n    test_cases = [\n        # (Aperture half-width A [m], Dip angle theta [degrees])\n        (1000.0, 0.0),   # Case 1\n        (1000.0, 60.0),  # Case 2\n        (200.0, 60.0),   # Case 3\n        (2000.0, 80.0),  # Case 4\n        (50.0, 0.0)      # Case 5\n    ]\n    \n    results = []\n\n    # ----------------------------------------------------------------------\n    # Main loop over test cases\n    # ----------------------------------------------------------------------\n    for A, theta in test_cases:\n        \n        # 1. DEFINE SOURCE POSITIONS\n        source_pos = np.arange(-A, A + dx_s, dx_s)\n        \n        # 2. COMPUTE PSF\n        PSF = np.zeros_like(xx)\n        \n        # Pre-calculate velocity at grid depths\n        v_bar_grid = v0 + gamma * yy / 2.0\n        \n        for xs in source_pos:\n            # Traveltime to the true point diffractor x0\n            L0 = np.sqrt((x0 - xs)**2 + y0**2)\n            v_bar0 = v0 + gamma * y0 / 2.0\n            t0 = 2.0 * L0 / v_bar0\n            \n            # Traveltimes to all points on the image grid\n            L_grid = np.sqrt((xx - xs)**2 + yy**2)\n            t_grid = 2.0 * L_grid / v_bar_grid\n            \n            # Calculate weights\n            w_t = np.exp(-((t_grid - t0)**2) / (2.0 * sigma_t**2))\n            w_g = 1.0 / (L_grid + epsilon)\n            \n            # Accumulate PSF\n            PSF += w_t * w_g\n\n        # 3. ANALYZE PSF ANISOTROPY\n        \n        # Total weight\n        W_sum = np.sum(PSF)\n        \n        # If PSF is effectively zero everywhere, skip to avoid division by zero\n        if W_sum  1e-15:\n            results.extend([np.inf, 0.0])\n            continue\n            \n        # Weighted mean offset r_bar = (rx_bar, ry_bar)\n        rx_bar = np.sum(PSF * (xx - x0)) / W_sum\n        ry_bar = np.sum(PSF * (yy - y0)) / W_sum\n        \n        # Components of the weighted covariance matrix Sigma\n        dxx = xx - x0 - rx_bar\n        dyy = yy - y0 - ry_bar\n        \n        Sigma_xx = np.sum(PSF * dxx**2) / W_sum\n        Sigma_yy = np.sum(PSF * dyy**2) / W_sum\n        Sigma_xy = np.sum(PSF * dxx * dyy) / W_sum\n        \n        Sigma = np.array([[Sigma_xx, Sigma_xy], [Sigma_xy, Sigma_yy]])\n\n        # Eigen decomposition of the covariance matrix\n        eigvals, eigvecs = np.linalg.eig(Sigma)\n        \n        # Sort eigenvalues and eigenvectors\n        sort_indices = np.argsort(eigvals)\n        lambda_min = eigvals[sort_indices[0]]\n        lambda_max = eigvals[sort_indices[1]]\n        e_max = eigvecs[:, sort_indices[1]]\n        \n        # Calculate anisotropy ratio R\n        # Add a small value to lambda_min to prevent division by zero for nearly 1D PSF\n        if lambda_min  1e-15:\n            R = np.inf\n        else:\n            R = np.sqrt(lambda_max / lambda_min)\n        \n        # Calculate orientation of major axis, phi_max\n        phi_max_rad = np.arctan2(e_max[1], e_max[0])\n        phi_max_deg = np.rad2deg(phi_max_rad)\n\n        # Calculate orientation difference Delta_phi\n        # This correctly computes the minimal undirected angle between two lines\n        delta_phi_abs = np.abs(phi_max_deg - theta)\n        Delta_phi = np.min([delta_phi_abs, 180.0 - delta_phi_abs])\n        \n        results.extend([R, Delta_phi])\n\n    # ----------------------------------------------------------------------\n    # Final print statement in the exact required format\n    # ----------------------------------------------------------------------\n    print(f\"[{','.join(f'{val:.6f}' for val in results)}]\")\n\nsolve()\n```"
        }
    ]
}