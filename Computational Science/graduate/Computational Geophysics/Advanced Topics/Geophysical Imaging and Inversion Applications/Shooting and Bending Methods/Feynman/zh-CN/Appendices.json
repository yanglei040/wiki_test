{
    "hands_on_practices": [
        {
            "introduction": "将理论付诸实践的第一步是理解其数学核心。打靶法 (shooting method) 的本质是将一个两点边值问题（two-point boundary value problem）——即从已知源点出发击中已知接收点——转化为一个非线性求根问题。本练习将引导您在一个简单的均匀介质中，为打靶法构建残差函数 (residual function) 及其雅可比矩阵 (Jacobian matrix)，并动手执行一次牛顿法迭代 。这个过程将揭示打靶法是如何通过系统地调整初始参数（如出射角）来“瞄准”目标的。",
            "id": "3614395",
            "problem": "考虑在二维各向同性介质中的声线追踪。我们试图使用打靶法解决一个两点边值问题：选择一个初始参数向量 $\\boldsymbol{\\alpha}$，使得从源点位置 $\\mathbf{x}_{s} \\in \\mathbb{R}^{2}$ 发出的射线在到达时间 $T$ 到达接收点位置 $\\mathbf{x}_{r} \\in \\mathbb{R}^{2}$。定义残差函数 $\\mathbf{F}(\\boldsymbol{\\alpha})$ 为 $\\mathbf{F}(\\boldsymbol{\\alpha})=\\mathbf{x}(\\boldsymbol{\\alpha},T)-\\mathbf{x}_{r}$，其中 $\\mathbf{x}(\\boldsymbol{\\alpha},t)$ 是由 $\\boldsymbol{\\alpha}$ 参数化的射线常微分方程（ODE）的解，并演化到时间 $t$。\n\n1. 从恒定波速 $c_{0}>0$ 的均匀各向同性介质中射线的基本运动学描述（射线是速度为 $c_{0}$ 的直线）出发，当 $\\boldsymbol{\\alpha}=[\\theta,\\,T]^{\\top}$ 时，显式构造残差 $\\mathbf{F}(\\boldsymbol{\\alpha})$，其中 $\\theta$ 是从 $\\mathbf{x}_{s}$ 出发的出射角，$T$ 是走时。同时推导雅可比矩阵 $\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha})$。\n\n2. 讨论 $\\mathbf{F}$ 关于 $\\boldsymbol{\\alpha}$ 的可微性，并陈述为确保应用于 $\\mathbf{F}(\\boldsymbol{\\alpha})=\\mathbf{0}$ 的牛顿型求解器具有局部二次收敛性，介质和射线映射所需满足的条件。\n\n3. 对于 $c_{0}=3$（单位 $\\mathrm{km/s}$），$\\mathbf{x}_{s}=(0,0)$（单位 $\\mathrm{km}$），$\\mathbf{x}_{r}=(3,4)$（单位 $\\mathrm{km}$），以及初始猜测 $\\boldsymbol{\\alpha}_{0}=[\\theta_{0},\\,T_{0}]^{\\top}=\\left[\\frac{\\pi}{4},\\,1.5\\right]^{\\top}$ 的具体情况，执行一次牛顿迭代\n$$\n\\boldsymbol{\\alpha}_{1}=\\boldsymbol{\\alpha}_{0}-\\left(\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}_{0})\\right)^{-1}\\mathbf{F}(\\boldsymbol{\\alpha}_{0}).\n$$\n将 $\\boldsymbol{\\alpha}_{1}$ 以一个包含 $\\theta_{1}$（单位弧度）和 $T_{1}$（单位秒）的 $1\\times 2$ 行矩阵形式报告。以精确的封闭形式表达你的最终答案（不要进行数值舍入）。",
            "solution": "问题陈述已经过评估，被认为是有效的。它具有科学依据，是适定的、客观的，并包含推导唯一解所需的所有必要信息。\n\n### 第1部分：残差和雅可比矩阵的构造\n\n在一个二维、均匀、各向同性的介质中，波速为常数 $c_{0}$，从源点位置 $\\mathbf{x}_{s} = \\begin{pmatrix} x_s \\\\ z_s \\end{pmatrix}$ 出发，出射角为 $\\theta$ 的射线沿直线传播。速度矢量是恒定的，由 $\\mathbf{v} = \\begin{pmatrix} c_{0} \\cos\\theta \\\\ c_{0} \\sin\\theta \\end{pmatrix}$ 给出。因此，射线在时间 $t$ 的位置是\n$$\n\\mathbf{x}(t) = \\mathbf{x}_{s} + t\\mathbf{v} = \\begin{pmatrix} x_s + t c_{0} \\cos\\theta \\\\ z_s + t c_{0} \\sin\\theta \\end{pmatrix}.\n$$\n问题将参数向量定义为 $\\boldsymbol{\\alpha} = [\\theta, T]^{\\top}$。残差函数 $\\mathbf{F}(\\boldsymbol{\\alpha})$ 由射线在候选走时 $T$ 的终点与接收点位置 $\\mathbf{x}_{r} = \\begin{pmatrix} x_r \\\\ z_r \\end{pmatrix}$ 之间的失配给出。\n$$\n\\mathbf{F}(\\boldsymbol{\\alpha}) = \\mathbf{x}(\\boldsymbol{\\alpha}, T) - \\mathbf{x}_{r}\n$$\n在这里，位置函数 $\\mathbf{x}$ 依赖于 $\\boldsymbol{\\alpha}$ 中的 $\\theta$，并在时间 $T$（即 $\\boldsymbol{\\alpha}$ 的第二个分量）处求值。代入射线路径的表达式，我们得到残差的显式形式：\n$$\n\\mathbf{F}(\\theta, T) = \\begin{pmatrix} F_1(\\theta, T) \\\\ F_2(\\theta, T) \\end{pmatrix} = \\begin{pmatrix} x_s + T c_{0} \\cos\\theta - x_r \\\\ z_s + T c_{0} \\sin\\theta - z_r \\end{pmatrix}.\n$$\n雅可比矩阵 $\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha})$ 是一个 $2 \\times 2$ 矩阵，其元素是 $\\mathbf{F}$ 关于 $\\boldsymbol{\\alpha} = [\\theta, T]^{\\top}$ 各分量的偏导数：\n$$\n\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}) = J(\\theta, T) = \\begin{pmatrix} \\frac{\\partial F_1}{\\partial \\theta} & \\frac{\\partial F_1}{\\partial T} \\\\ \\frac{\\partial F_2}{\\partial \\theta} & \\frac{\\partial F_2}{\\partial T} \\end{pmatrix}.\n$$\n我们计算每个偏导数：\n$$\n\\frac{\\partial F_1}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (x_s + T c_{0} \\cos\\theta - x_r) = -T c_{0} \\sin\\theta\n$$\n$$\n\\frac{\\partial F_1}{\\partial T} = \\frac{\\partial}{\\partial T} (x_s + T c_{0} \\cos\\theta - x_r) = c_{0} \\cos\\theta\n$$\n$$\n\\frac{\\partial F_2}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (z_s + T c_{0} \\sin\\theta - z_r) = T c_{0} \\cos\\theta\n$$\n$$\n\\frac{\\partial F_2}{\\partial T} = \\frac{\\partial}{\\partial T} (z_s + T c_{0} \\sin\\theta - z_r) = c_{0} \\sin\\theta\n$$\n将这些分量组合起来，得到雅可比矩阵：\n$$\n\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}) = \\begin{pmatrix} -T c_{0} \\sin\\theta & c_{0} \\cos\\theta \\\\ T c_{0} \\cos\\theta & c_{0} \\sin\\theta \\end{pmatrix}.\n$$\n\n### 第2部分：可微性与收敛条件\n\n对于所描述的均匀介质，残差函数 $\\mathbf{F}(\\theta, T)$ 的分量是三角函数（$\\sin\\theta$, $\\cos\\theta$）和关于 $T$ 的线性函数的组合。这些函数在它们的整个定义域 $\\mathbb{R}^2$ 上是无限可微（$C^{\\infty}$）的。因此，$\\mathbf{F}$ 关于 $\\boldsymbol{\\alpha}$ 是任意阶连续可微的。\n\n如果在一个 $\\boldsymbol{\\alpha}^{*}$ 的邻域内满足以下条件，牛顿型求解器对 $\\mathbf{F}(\\boldsymbol{\\alpha})=\\mathbf{0}$ 的解 $\\boldsymbol{\\alpha}^{*}$ 的收敛通常是二次的：\n1.  函数 $\\mathbf{F}$ 是二次连续可微的（即 $C^2$）。\n2.  雅可比矩阵 $\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}^{*})$ 是非奇异的（即可逆的）。\n\n如前所述，对于均匀介质，$\\mathbf{F}$ 是 $C^{\\infty}$ 的，所以第一个条件得到满足。为了检验第二个条件，我们计算雅可比矩阵的行列式：\n$$\n\\det(\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha})) = (-T c_{0} \\sin\\theta) (c_{0} \\sin\\theta) - (c_{0} \\cos\\theta) (T c_{0} \\cos\\theta)\n$$\n$$\n= -T c_{0}^2 \\sin^2\\theta - T c_{0}^2 \\cos^2\\theta = -T c_{0}^2 (\\sin^2\\theta + \\cos^2\\theta) = -T c_{0}^2.\n$$\n雅可比矩阵可逆当且仅当其行列式非零。由于波速 $c_0 > 0$，我们有 $c_0^2 > 0$。因此，只要走时 $T \\neq 0$，雅可比矩阵就是非奇异的。对于任何源点和接收点不同（$\\mathbf{x}_s \\neq \\mathbf{x}_r$）的物理上有意义的问题，走时必须为正（$T>0$）。因此，对于均匀介质，雅可比矩阵在解处总是可逆的，牛顿法将表现出局部二次收敛性。\n\n对于一个速度 $c(\\mathbf{x})$ 随位置变化的一般非均匀、各向同性介质，射线路径 $\\mathbf{x}(\\boldsymbol{\\alpha}, t)$ 是一组常微分方程（射线方程）的解。射线路径关于初始条件（如 $\\theta$）的可微性取决于速度场 $c(\\mathbf{x})$ 的光滑度。为使 $\\mathbf{F}$ 是 $C^2$ 的，速度场 $c(\\mathbf{x})$ 必须足够光滑（例如，$C^3$）。此外，雅可比矩阵可逆的条件对应于几何条件，即接收点 $\\mathbf{x}_r$ 不位于从 $\\mathbf{x}_s$ 发出的射线族的一个焦散面上。在焦散面上，无限近的射线相交，导致射线映射出现奇点和雅可比矩阵奇异。\n\n### 第3部分：牛顿迭代\n\n我们被给予以下具体值：\n- 波速: $c_{0}=3$\n- 源点: $\\mathbf{x}_{s}=(0,0)$\n- 接收点: $\\mathbf{x}_{r}=(3,4)$\n- 初始猜测: $\\boldsymbol{\\alpha}_{0} = [\\theta_{0}, T_{0}]^{\\top} = \\left[\\frac{\\pi}{4}, 1.5\\right]^{\\top} = \\left[\\frac{\\pi}{4}, \\frac{3}{2}\\right]^{\\top}$\n\n牛顿迭代公式为 $\\boldsymbol{\\alpha}_{1} = \\boldsymbol{\\alpha}_{0} - (\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}_{0}))^{-1}\\mathbf{F}(\\boldsymbol{\\alpha}_{0})$。\n\n**第1步：计算 $\\mathbf{F}(\\boldsymbol{\\alpha}_{0})$**\n残差函数为：\n$$\n\\mathbf{F}(\\theta, T) = \\begin{pmatrix} 3T\\cos\\theta - 3 \\\\ 3T\\sin\\theta - 4 \\end{pmatrix}\n$$\n在 $\\boldsymbol{\\alpha}_{0}=\\left[\\frac{\\pi}{4}, \\frac{3}{2}\\right]^{\\top}$ 处，我们有 $\\cos(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$ 和 $\\sin(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$。\n$$\nF_1(\\boldsymbol{\\alpha}_{0}) = 3 \\left(\\frac{3}{2}\\right) \\cos\\left(\\frac{\\pi}{4}\\right) - 3 = \\frac{9}{2}\\frac{\\sqrt{2}}{2} - 3 = \\frac{9\\sqrt{2}}{4} - 3\n$$\n$$\nF_2(\\boldsymbol{\\alpha}_{0}) = 3 \\left(\\frac{3}{2}\\right) \\sin\\left(\\frac{\\pi}{4}\\right) - 4 = \\frac{9}{2}\\frac{\\sqrt{2}}{2} - 4 = \\frac{9\\sqrt{2}}{4} - 4\n$$\n所以，$\\mathbf{F}(\\boldsymbol{\\alpha}_{0}) = \\begin{pmatrix} \\frac{9\\sqrt{2}}{4} - 3 \\\\ \\frac{9\\sqrt{2}}{4} - 4 \\end{pmatrix}$。\n\n**第2步：计算雅可比矩阵 $\\nabla_{\\boldsymbol{\\alpha}}\\mathbf{F}(\\boldsymbol{\\alpha}_{0})$**\n雅可比矩阵为：\n$$\nJ(\\theta, T) = \\begin{pmatrix} -3T\\sin\\theta & 3\\cos\\theta \\\\ 3T\\cos\\theta & 3\\sin\\theta \\end{pmatrix}\n$$\n在 $\\boldsymbol{\\alpha}_{0}$ 处：\n$$\nJ(\\boldsymbol{\\alpha}_{0}) = \\begin{pmatrix} -3\\left(\\frac{3}{2}\\right)\\sin\\left(\\frac{\\pi}{4}\\right) & 3\\cos\\left(\\frac{\\pi}{4}\\right) \\\\ 3\\left(\\frac{3}{2}\\right)\\cos\\left(\\frac{\\pi}{4}\\right) & 3\\sin\\left(\\frac{\\pi}{4}\\right) \\end{pmatrix} = \\begin{pmatrix} -\\frac{9}{2}\\frac{\\sqrt{2}}{2} & 3\\frac{\\sqrt{2}}{2} \\\\ \\frac{9}{2}\\frac{\\sqrt{2}}{2} & 3\\frac{\\sqrt{2}}{2} \\end{pmatrix} = \\begin{pmatrix} -\\frac{9\\sqrt{2}}{4} & \\frac{3\\sqrt{2}}{2} \\\\ \\frac{9\\sqrt{2}}{4} & \\frac{3\\sqrt{2}}{2} \\end{pmatrix}.\n$$\n\n**第3步：对雅可比矩阵求逆**\n行列式为 $\\det(J(\\boldsymbol{\\alpha}_{0})) = -T_0 c_0^2 = -\\left(\\frac{3}{2}\\right)(3^2) = -\\frac{27}{2}$。\n逆矩阵为：\n$$\nJ^{-1} = \\frac{1}{-\\frac{27}{2}} \\begin{pmatrix} \\frac{3\\sqrt{2}}{2} & -\\frac{3\\sqrt{2}}{2} \\\\ -\\frac{9\\sqrt{2}}{4} & -\\frac{9\\sqrt{2}}{4} \\end{pmatrix} = -\\frac{2}{27} \\begin{pmatrix} \\frac{3\\sqrt{2}}{2} & -\\frac{3\\sqrt{2}}{2} \\\\ -\\frac{9\\sqrt{2}}{4} & -\\frac{9\\sqrt{2}}{4} \\end{pmatrix} = \\begin{pmatrix} -\\frac{\\sqrt{2}}{9} & \\frac{\\sqrt{2}}{9} \\\\ \\frac{\\sqrt{2}}{6} & \\frac{\\sqrt{2}}{6} \\end{pmatrix}.\n$$\n\n**第4步：计算更新量 $\\Delta \\boldsymbol{\\alpha}_{0} = J^{-1}\\mathbf{F}(\\boldsymbol{\\alpha}_{0})$**\n$$\n\\Delta \\boldsymbol{\\alpha}_{0} = \\begin{pmatrix} \\Delta\\theta_0 \\\\ \\Delta T_0 \\end{pmatrix} = \\begin{pmatrix} -\\frac{\\sqrt{2}}{9} & \\frac{\\sqrt{2}}{9} \\\\ \\frac{\\sqrt{2}}{6} & \\frac{\\sqrt{2}}{6} \\end{pmatrix} \\begin{pmatrix} \\frac{9\\sqrt{2}}{4} - 3 \\\\ \\frac{9\\sqrt{2}}{4} - 4 \\end{pmatrix}\n$$\n第一个分量：\n$$\n\\Delta\\theta_0 = -\\frac{\\sqrt{2}}{9}\\left(\\frac{9\\sqrt{2}}{4} - 3\\right) + \\frac{\\sqrt{2}}{9}\\left(\\frac{9\\sqrt{2}}{4} - 4\\right) = \\frac{\\sqrt{2}}{9}\\left[-\\left(\\frac{9\\sqrt{2}}{4} - 3\\right) + \\left(\\frac{9\\sqrt{2}}{4} - 4\\right)\\right] = \\frac{\\sqrt{2}}{9}(3-4) = -\\frac{\\sqrt{2}}{9}.\n$$\n第二个分量：\n$$\n\\Delta T_0 = \\frac{\\sqrt{2}}{6}\\left(\\frac{9\\sqrt{2}}{4} - 3\\right) + \\frac{\\sqrt{2}}{6}\\left(\\frac{9\\sqrt{2}}{4} - 4\\right) = \\frac{\\sqrt{2}}{6}\\left(2\\frac{9\\sqrt{2}}{4} - 7\\right) = \\frac{\\sqrt{2}}{6}\\left(\\frac{9\\sqrt{2}}{2} - 7\\right) = \\frac{9 \\cdot 2}{12} - \\frac{7\\sqrt{2}}{6} = \\frac{3}{2} - \\frac{7\\sqrt{2}}{6}.\n$$\n\n**第5步：计算新的估计值 $\\boldsymbol{\\alpha}_{1}$**\n$$\n\\boldsymbol{\\alpha}_{1} = \\boldsymbol{\\alpha}_{0} - \\Delta \\boldsymbol{\\alpha}_{0} = \\begin{pmatrix} \\theta_0 \\\\ T_0 \\end{pmatrix} - \\begin{pmatrix} \\Delta\\theta_0 \\\\ \\Delta T_0 \\end{pmatrix}\n$$\n$$\n\\theta_1 = \\theta_0 - \\Delta\\theta_0 = \\frac{\\pi}{4} - \\left(-\\frac{\\sqrt{2}}{9}\\right) = \\frac{\\pi}{4} + \\frac{\\sqrt{2}}{9}\n$$\n$$\nT_1 = T_0 - \\Delta T_0 = \\frac{3}{2} - \\left(\\frac{3}{2} - \\frac{7\\sqrt{2}}{6}\\right) = \\frac{7\\sqrt{2}}{6}\n$$\n一次牛顿迭代的结果是 $\\boldsymbol{\\alpha}_{1} = \\left[\\frac{\\pi}{4} + \\frac{\\sqrt{2}}{9}, \\frac{7\\sqrt{2}}{6}\\right]^{\\top}$。答案要求以 $1\\times 2$ 行矩阵的形式给出。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\pi}{4} + \\frac{\\sqrt{2}}{9} & \\frac{7\\sqrt{2}}{6} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "与打靶法迭代更新初始条件不同，弯曲法 (bending method) 从另一角度求解射线路径，它直接寻找满足费马原理 (Fermat's principle) 的平稳路径。本练习将带您体验弯曲法的核心思想，即路径优化。您将处理一个包含源点、接收点以及一个界面交互点的三节点射线路径，通过求解界面上满足切向相慢度连续（各向异性斯涅尔定律）的驻点，来确定最优的反射或折射点 。这个练习清晰地展示了弯曲法如何将物理约束直接融入路径求解过程。",
            "id": "3614355",
            "problem": "您必须实现一个完整的、可运行的程序，该程序使用在单个平直界面上的投影弯曲更新，计算分块均匀、椭圆各向异性介质中二维射线的平稳走时。程序必须从第一性原理出发：费马平稳走时原理和椭圆各向异性的频散关系。关键的界面约束是相慢度切向分量的连续性，以及满足界面两侧介质的频散关系。投影步骤必须通过将试探性更新步映射到由界面和各向异性斯涅尔条件定义的流形上，来强制执行这些约束。\n\n考虑一个二维设定，坐标为 $x = (x, y)$，一个位于 $y = 0$ 的平面界面，以及一条由三个节点 $(x_0, x_1, x_2)$ 表示的射线，其中 $x_0$ 是源点，$x_2$ 是接收点，$x_1$ 被约束在界面上。界面上方（$y > 0$）的介质是均匀的，具有一个恒定的正定 $2 \\times 2$ 矩阵 $C_1$；界面下方（$y < 0$）的介质是均匀的，具有一个恒定的正定 $2 \\times 2$ 矩阵 $C_2$。这些矩阵编码了椭圆各向异性，并由沿坐标轴的主相速度表示为\n$$\nC_i = \\mathrm{diag}(v_{x,i}^2, v_{y,i}^2), \\quad i \\in \\{1,2\\},\n$$\n其中 $v_{x,i}$ 和 $v_{y,i}$ 是单位为 $\\mathrm{m/s}$ 的严格正实数。相应的逆矩阵为\n$$\nW_i = C_i^{-1} = \\mathrm{diag}\\left(\\frac{1}{v_{x,i}^2}, \\frac{1}{v_{y,i}^2}\\right), \\quad i \\in \\{1,2\\}.\n$$\n在每个均匀区域中，相慢度矢量 $p$ 满足二次频散关系\n$$\np^\\top C_i \\, p = 1,\n$$\n并且在该区域中，对于位移为 $\\Delta x$ 的直线段，其走时泛函为椭圆长度\n$$\n\\tau(\\Delta x; W_i) = \\sqrt{\\Delta x^\\top W_i \\, \\Delta x}.\n$$\n根据费马原理，在固定端点 $(x_0,x_2)$ 和未知界面点 $x_1$ 之间的物理射线，对于限制在界面上的 $x_1$ 的变分是平稳的。在界面处，容许状态流形由以下约束定义：平行于界面的相慢度分量是连续的，并且频散关系在两侧都成立。令 $\\hat{t}$ 表示界面的单位切向量（对于位于 $y=0$ 的平直界面，选择 $\\hat{t} = (1,0)^\\top$）。令 $p_1$ 为上层介质中射线段的相慢度， $p_2$ 为下层介质中射线段（对于折射）或同一上层介质中（对于反射）的相慢度。流形约束为\n$$\n\\hat{t} \\cdot p_1 = \\hat{t} \\cdot p_2, \\quad p_1^\\top C_1 p_1 = 1, \\quad p_2^\\top C_2 p_2 = 1,\n$$\n其中 $x_1$ 被约束在 $y=0$。群速度由 $g_i = C_i p_i$ 给出，物理上容许的折射必须将能量带入透射介质。\n\n您的程序必须：\n- 用节点 $x_0, x_1, x_2$ 表示路径，并对 $x_1$ 的水平坐标执行弯曲更新，同时保持 $y_1 = 0$ 固定。\n- 实现一个投影更新：给定一个对 $x_1$ 的试探性改变，通过强制切向相慢度的连续性和两侧的频散关系，将其投影到由界面约束定义的流形上。该投影应通过数值求解满足切向慢度连续性的界面点 $x_1$（在 $y=0$ 上）来执行。频散关系必须通过更新所使用的 $p_i$ 的定义来遵守。\n- 一旦 $x_1$ 被投影到约束流形上，计算稳态总走时\n$$\nT(x_1) = \\tau(x_1 - x_0; W_1) + \\tau(x_2 - x_1; W_j),\n$$\n其中折射时 $j=2$，反射时 $j=1$。\n- 空间坐标使用米，速度使用米/秒。最终走时以秒为单位表示，四舍五入到小数点后六位。\n\n测试套件。实现并评估以下三种情况，按规定输出稳态走时。\n\n- 情况 A (界面折射):\n  - 上层介质 ($y > 0$): $v_{x,1} = 2200\\,\\mathrm{m/s}$, $v_{y,1} = 1600\\,\\mathrm{m/s}$.\n  - 下层介质 ($y < 0$): $v_{x,2} = 3200\\,\\mathrm{m/s}$, $v_{y,2} = 2400\\,\\mathrm{m/s}$.\n  - 源点: $x_0 = (-500\\,\\mathrm{m}, \\, 800\\,\\mathrm{m})$.\n  - 接收点: $x_2 = (600\\,\\mathrm{m}, \\, -900\\,\\mathrm{m})$.\n  - 模式: 折射。\n\n- 情况 B (界面反射):\n  - 上层介质 ($y > 0$)，用于两段射线: $v_{x,1} = 2500\\,\\mathrm{m/s}$, $v_{y,1} = 1800\\,\\mathrm{m/s}$.\n  - 源点: $x_0 = (-700\\,\\mathrm{m}, \\, 600\\,\\mathrm{m})$.\n  - 接收点: $x_2 = (500\\,\\mathrm{m}, \\, 400\\,\\mathrm{m})$.\n  - 模式: 反射。\n\n- 情况 C (浅入射角折射):\n  - 上层介质 ($y > 0$): $v_{x,1} = 2600\\,\\mathrm{m/s}$, $v_{y,1} = 1400\\,\\mathrm{m/s}$.\n  - 下层介质 ($y < 0$): $v_{x,2} = 2000\\,\\mathrm{m/s}$, $v_{y,2} = 3000\\,\\mathrm{m/s}$.\n  - 源点: $x_0 = (-100\\,\\mathrm{m}, \\, 50\\,\\mathrm{m})$.\n  - 接收点: $x_2 = (1000\\,\\mathrm{m}, \\, -1\\,\\mathrm{m})$.\n  - 模式: 折射。\n\n最终输出格式。您的程序应生成单行输出，其中包含三种情况的稳态走时，格式为方括号内用逗号分隔的列表，例如 $[t_A, t_B, t_C]$，其中每个条目都是一个以秒为单位的浮点数，四舍五入到小数点后六位。不允许有其他输出。",
            "solution": "该问题要求计算二维、分块均匀、椭圆各向异性介质中射线路径的平稳走时。一条射线路径由两条直线段组成，通过水平线 $y=0$ 上的一个界面点 $x_1 = (x_{1,x}, 0)$ 连接源点 $x_0 = (x_{0,x}, y_{0,y})$ 和接收点 $x_2 = (x_{2,x}, y_{2,y})$。任务是根据费马原理，找到界面点的特定水平坐标 $x_{1,x}$，使得总走时是平稳的。\n\n在具有各向异性矩阵 $W_i$ 的介质中，单个位移矢量为 $\\Delta x$ 的射线段的走时由椭圆长度给出：\n$$\n\\tau(\\Delta x; W_i) = \\sqrt{\\Delta x^\\top W_i \\Delta x}\n$$\n其中 $W_i = \\mathrm{diag}(1/v_{x,i}^2, 1/v_{y,i}^2)$。\n\n设唯一的变量参数是界面点的水平坐标，为方便起见，用 $x_1$ 表示 $x_{1,x}$。源点位于 $x_0 = (x_{0,x}, y_{0,y})$，其中 $y_{0,y} > 0$，接收点位于 $x_2 = (x_{2,x}, y_{2,y})$。第一段（源点到界面）的位移矢量是 $\\Delta x_1 = (x_1 - x_{0,x}, -y_{0,y})$。第二段（界面到接收点）的位移矢量是 $\\Delta x_2 = (x_{2,x} - x_1, y_{2,y})$。\n\n总走时 $T$ 是两段走时之和：\n$$\nT(x_1) = \\tau_1 + \\tau_j = \\sqrt{\\Delta x_1^\\top W_1 \\Delta x_1} + \\sqrt{\\Delta x_2^\\top W_j \\Delta x_2}\n$$\n其中，对于反射（第二段在介质1中），$j=1$；对于折射（第二段在介质2中），$j=2$。具体来说，即：\n$$\nT(x_1) = \\sqrt{\\frac{(x_1 - x_{0,x})^2}{v_{x,1}^2} + \\frac{y_{0,y}^2}{v_{y,1}^2}} + \\sqrt{\\frac{(x_{2,x} - x_1)^2}{v_{x,j}^2} + \\frac{y_{2,y}^2}{v_{y,j}^2}}\n$$\n\n根据费马原理，物理射线路径对应于走时函数的平稳点。由于 $x_1$ 是唯一的自由度，我们寻求满足 $\\frac{dT}{dx_1} = 0$ 的 $x_1$ 值。\n\n总走时关于 $x_1$ 的导数是：\n$$\n\\frac{dT}{dx_1} = \\frac{d\\tau_1}{dx_1} + \\frac{d\\tau_j}{dx_1}\n$$\n对于第一项，使用链式法则：\n$$\n\\frac{d\\tau_1}{dx_1} = \\frac{1}{2\\tau_1} \\frac{d}{dx_1}\\left(\\frac{(x_1 - x_{0,x})^2}{v_{x,1}^2} + \\frac{y_{0,y}^2}{v_{y,1}^2}\\right) = \\frac{1}{2\\tau_1} \\frac{2(x_1 - x_{0,x})}{v_{x,1}^2} = \\frac{x_1 - x_{0,x}}{\\tau_1 v_{x,1}^2}\n$$\n对于第二项：\n$$\n\\frac{d\\tau_j}{dx_1} = \\frac{1}{2\\tau_j} \\frac{d}{dx_1}\\left(\\frac{(x_{2,x} - x_1)^2}{v_{x,j}^2} + \\frac{y_{2,y}^2}{v_{y,j}^2}\\right) = \\frac{1}{2\\tau_j} \\frac{2(x_{2,x} - x_1)(-1)}{v_{x,j}^2} = -\\frac{x_{2,x} - x_1}{\\tau_j v_{x,j}^2}\n$$\n将总导数设为零，得到平稳性条件：\n$$\n\\frac{dT}{dx_1} = \\frac{x_1 - x_{0,x}}{\\tau_1 v_{x,1}^2} - \\frac{x_{2,x} - x_1}{\\tau_j v_{x,j}^2} = 0\n$$\n\n这个条件等价于切向相慢度的连续性，也就是此背景下的斯涅尔定律。对于位移为 $\\Delta x$ 的射线段，其相慢度矢量 $p$ 由 $p = (W \\Delta x) / \\tau$ 给出。\n第一段的相慢度切向分量是：\n$$\np_{1,x} = (\\hat{t} \\cdot p_1) = \\frac{1}{\\tau_1} \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\cdot \\left[ \\begin{pmatrix} 1/v_{x,1}^2 & 0 \\\\ 0 & 1/v_{y,1}^2 \\end{pmatrix} \\begin{pmatrix} x_1 - x_{0,x} \\\\ -y_{0,y} \\end{pmatrix} \\right] \\right) = \\frac{x_1 - x_{0,x}}{\\tau_1 v_{x,1}^2}\n$$\n对于第二段：\n$$\np_{j,x} = (\\hat{t} \\cdot p_j) = \\frac{1}{\\tau_j} \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\cdot \\left[ \\begin{pmatrix} 1/v_{x,j}^2 & 0 \\\\ 0 & 1/v_{y,j}^2 \\end{pmatrix} \\begin{pmatrix} x_{2,x} - x_1 \\\\ y_{2,y} \\end{pmatrix} \\right] \\right) = \\frac{x_{2,x} - x_1}{\\tau_j v_{x,j}^2}\n$$\n因此，条件 $\\frac{dT}{dx_1} = 0$ 与 $p_{1,x} = p_{j,x}$ 完全相同，这正是问题中指定的流形约束。因此，寻找平稳路径的问题简化为求解关于 $x_1$ 的非线性方程 $f(x_1) = p_{1,x}(x_1) - p_{j,x}(x_1) = 0$。\n\n这个方程可以数值求解。函数 $f(x_1)$ 是单调递增的，这保证了根的唯一性。一个稳健的求根算法，如 Brent-Dekker 方法（`scipy.optimize.brentq`）是合适的。需要一个有效的搜索区间（托架）$[a, b]$，使得 $f(a)$ 和 $f(b)$ 异号。区间 $[\\min(x_{0,x}, x_{2,x}), \\max(x_{0,x}, x_{2,x})]$ 提供了一个可靠的托架，因为最短时间路径必须在源点和接收点的x坐标之间穿过界面。\n\n计算流程如下：\n1.  对每种情况，定义介质属性 $(v_{x,1}, v_{y,1}, v_{x,j}, v_{y,j})$ 和几何结构 $(x_0, x_2)$。\n2.  定义函数 $f(x_1) = p_{1,x}(x_1) - p_{j,x}(x_1)$。\n3.  使用 `scipy.optimize.brentq` 在区间 $[\\min(x_{0,x}, x_{2,x}), \\max(x_{0,x}, x_{2,x})]$ 内找到 $f(x_1) = 0$ 的根 $x_1^*$。\n4.  将得到的平稳点 $x_1^*$ 代入总走时方程 $T(x_1)$，以求得平稳走时。\n5.  按要求格式化结果。\n这个过程直接在约束流形上找到点 $x_1$，并计算相应的平稳走时，满足了所有问题要求。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes stationary travel times for rays in elliptically anisotropic media.\n    \"\"\"\n\n    test_cases = [\n        # Case A (Refraction)\n        {\n            'v_x1': 2200.0, 'v_y1': 1600.0, 'v_x2': 3200.0, 'v_y2': 2400.0,\n            'x0': (-500.0, 800.0), 'x2': (600.0, -900.0), 'mode': 'refraction'\n        },\n        # Case B (Reflection)\n        {\n            'v_x1': 2500.0, 'v_y1': 1800.0, 'v_x2': None, 'v_y2': None,\n            'x0': (-700.0, 600.0), 'x2': (500.0, 400.0), 'mode': 'reflection'\n        },\n        # Case C (Refraction with shallow incidence)\n        {\n            'v_x1': 2600.0, 'v_y1': 1400.0, 'v_x2': 2000.0, 'v_y2': 3000.0,\n            'x0': (-100.0, 50.0), 'x2': (1000.0, -1.0), 'mode': 'refraction'\n        }\n    ]\n\n    def _travel_time(delta_x, v_x, v_y):\n        \"\"\"Calculates travel time for a single ray segment.\"\"\"\n        dx, dy = delta_x\n        tau_squared = (dx**2) / (v_x**2) + (dy**2) / (v_y**2)\n        return np.sqrt(tau_squared)\n\n    def _snell_law_residual(x1_coord, x0, x2, v_x1, v_y1, v_x_j, v_y_j):\n        \"\"\"\n        Calculates the residual of Snell's law (p1_x - p_j_x).\n        The root of this function gives the stationary point.\n        \"\"\"\n        x0_x, y0_y = x0\n        x2_x, y2_y = x2\n\n        # Segment 1: source to interface point\n        delta_x1 = np.array([x1_coord - x0_x, -y0_y])\n        tau1 = _travel_time(delta_x1, v_x1, v_y1)\n        if tau1 == 0: return np.inf\n        p1_x = (x1_coord - x0_x) / (v_x1**2 * tau1)\n\n        # Segment 2: interface point to receiver\n        delta_x2 = np.array([x2_x - x1_coord, y2_y])\n        tau_j = _travel_time(delta_x2, v_x_j, v_y_j)\n        if tau_j == 0: return np.inf\n        p_j_x = (x2_x - x1_coord) / (v_x_j**2 * tau_j)\n        \n        return p1_x - p_j_x\n\n    def solve_for_case(params):\n        \"\"\"\n        Solves for the stationary travel time for a single case.\n        \"\"\"\n        mode = params['mode']\n        x0 = params['x0']\n        x2 = params['x2']\n        v_x1, v_y1 = params['v_x1'], params['v_y1']\n        \n        if mode == 'refraction':\n            v_x_j, v_y_j = params['v_x2'], params['v_y2']\n        else:  # reflection\n            v_x_j, v_y_j = v_x1, v_y1\n\n        args_for_solver = (x0, x2, v_x1, v_y1, v_x_j, v_y_j)\n        \n        x0_x, x2_x = x0[0], x2[0]\n        bracket = sorted([x0_x, x2_x])\n\n        # Find the x-coordinate of the interface point that satisfies Snell's law\n        stationary_x1_coord = brentq(_snell_law_residual, bracket[0], bracket[1], args=args_for_solver)\n        \n        # Calculate total travel time using the found stationary point\n        delta_x1_final = np.array([stationary_x1_coord - x0[0], -x0[1]])\n        t1 = _travel_time(delta_x1_final, v_x1, v_y1)\n\n        delta_x2_final = np.array([x2[0] - stationary_x1_coord, x2[1]])\n        t_j = _travel_time(delta_x2_final, v_x_j, v_y_j)\n        \n        return t1 + t_j\n\n    results = []\n    for case in test_cases:\n        time = solve_for_case(case)\n        results.append(f\"{time:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}