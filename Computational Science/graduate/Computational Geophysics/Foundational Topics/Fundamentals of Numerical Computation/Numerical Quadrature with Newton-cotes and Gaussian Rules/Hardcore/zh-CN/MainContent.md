## 引言
在[计算地球物理学](@entry_id:747618)中，从[地震波模拟](@entry_id:754654)到重[力场](@entry_id:147325)反演，定积分的计算无处不在。然而，许多实际问题中的被积函数极为复杂，无法求得解析解，这构成了一个核心的计算挑战。数值求积，或称[数值积分](@entry_id:136578)，提供了一套强大的方法论，通过有限点上的函数值加权和来逼近积分值，从而解决了这一难题。本文旨在系统性地阐述数值求积的核心理论与实践，为研究生及科研人员提供一份全面的指南。

本文将分三个章节展开。首先，在“原理与机制”中，我们将深入探讨两类最主要的[数值求积](@entry_id:136578)方法——牛顿-柯特斯（Newton-Cotes）公式和高斯（Gaussian）求积。我们将从[代数精度](@entry_id:143382)的概念出发，推导[梯形法则](@entry_id:145375)和[辛普森法则](@entry_id:142987)，并揭示高阶[牛顿-柯特斯法则](@entry_id:171388)的[数值不稳定性](@entry_id:137058)。随后，我们将阐明[高斯求积](@entry_id:146011)如何通过优化[节点选择](@entry_id:637104)达到最高的代数精度，并介绍[复合求积法则](@entry_id:634240)、[误差分析](@entry_id:142477)以及处理不同积分类型的扩展高斯方法。

接着，在“应用与跨学科联系”一章中，我们将理论付诸实践，展示这些积分方法如何解决[地球物理学](@entry_id:147342)中的具体问题，如[位场](@entry_id:143025)模拟中的[奇异积分](@entry_id:167381)、[地震学](@entry_id:203510)中的[走时计算](@entry_id:756149)，以及反演问题中梯度计算的保真度。此外，我们还将探讨处理[高维积分](@entry_id:143557)、复杂几何以及无限积分域的高级策略，并揭示[数值积分](@entry_id:136578)在[气候科学](@entry_id:161057)、有限元分析等不同学科间的共通原理。

最后，通过“动手实践”环节，读者将有机会通过解决具体问题来巩固所学知识，例如推导坐标变换、分析积分法则的精度，以及从第一性原理构建专门的高斯求积法则。通过理论、应用与实践的结合，本文将帮助您精通数值求积，并将其有效地应用于您的研究与工程挑战中。

## 原理与机制

在[计算地球物理学](@entry_id:747618)的众多领域，从正演模拟到反演问题，我们经常需要计算形式为 $I[f] = \int_a^b f(x)dx$ 的定积分。这些积分可能代表沿射线路径的慢度积分、在重力和磁法建模中对[核函数](@entry_id:145324)加权的场积分，或是频率域中的谱分量积分。除了少数理想情况外，这些积分的被积函数 $f(x)$ 通常非常复杂，以至于无法找到其解析反导数。因此，我们必须依赖数值方法来近似其值。**[数值求积](@entry_id:136578)** (numerical quadrature) 正是为此而生的一套方法。本章将深入探讨[数值求积](@entry_id:136578)的基本原理和核心机制，重点介绍两类主要方法：牛顿-柯特斯（Newton-Cotes）公式和高斯（Gaussian）求积。

### 数值求积的基本概念

一个[数值求积](@entry_id:136578)法则旨在用一个被积函数在有限个点上函数值的加权和来逼近一个[定积分](@entry_id:147612)。具体来说，对于积分 $I[f] = \int_a^b f(x)dx$，其[数值求积](@entry_id:136578)近似形式为：

$Q[f] = \sum_{i=1}^{n} w_i f(x_i)$

其中，$x_i$ 是位于区间 $[a,b]$ 内的**节点** (nodes)，$w_i$ 是与每个节点相关联的**权重** (weights)。这些节点和权重共同定义了一个特定的求积法则。从数学上看，这个求积法则 $Q$ 是一个**线性泛函**，因为它满足 $Q[\alpha f + \beta g] = \alpha Q[f] + \beta Q[g]$，其中 $\alpha$ 和 $\beta$ 是标量。

为了评估一个求积法则的优劣，我们需要一个客观的衡量标准。在[数值分析](@entry_id:142637)中，最常用的标准是其**代数精度** (algebraic accuracy) 或**精确度阶** (degree of exactness)。一个[求积法则](@entry_id:753909)的精确度阶定义为该法则能够精确积分（即误差为零）的最高次多项式的次数。如果一个法则对所有次数不超过 $m$ 的多项式都能给出精确的积分值，但至少存在一个 $m+1$ 次多项式使其无法精确积分，那么该法则的[精确度](@entry_id:143382)阶就是 $m$。之所以选择多项式作为基准，是因为它们构成了[函数空间](@entry_id:143478)中一组结构良好、复杂度递增的层次，并且任何在积分区间上足够光滑的函数（如[泰勒展开](@entry_id:145057)所示）都可以由多项式很好地逼近。

### [牛顿-柯特斯公式](@entry_id:163513)：基于[等距节点](@entry_id:168260)的插值思想

牛顿-柯特斯方法是一族构造[求积法则](@entry_id:753909)的直观方法。其核心思想分为两步：
1.  在积分区间 $[a, b]$ 内选择一组等距[分布](@entry_id:182848)的节点。
2.  构造一个穿过这些节点上函数值的插值多项式 $p(x)$。
3.  将被积函数 $f(x)$ 的积分近似为该[插值多项式](@entry_id:750764) $p(x)$ 的积分，而 $p(x)$ 的积分是可以解析计算的。

具体而言，如果我们使用 $n$ 个节点构造一个 $n-1$ 次的[拉格朗日插值多项式](@entry_id:176861) $p_{n-1}(x) = \sum_{i=1}^{n} f(x_i) \ell_{i-1}(x)$，其中 $\ell_{i-1}(x)$ 是[拉格朗日基](@entry_id:751105)函数，那么[求积公式](@entry_id:753909)的权重就是这些[基函数](@entry_id:170178)的积分：$w_i = \int_a^b \ell_{i-1}(x) dx$。构造一个 $n$ 点的求积法则，我们至少可以期望它能精确积分所有次数不超过 $n-1$ 的多项式，因为对于这样的多项式，其自身就是其[插值多项式](@entry_id:750764)。

#### 通过[待定系数法](@entry_id:166225)推导

除了通过积分[拉格朗日多项式](@entry_id:142463)，我们还可以通过一种更基本的方法——**[待定系数法](@entry_id:166225)** (method of undetermined coefficients) 来推导[求积法则](@entry_id:753909)的权重。我们通过强制法则对一系列低次多项式（通常是单项式 $1, x, x^2, \dots$）精确成立，从而建立一个关于权重的线性方程组并求解。

**示例：[梯形法则](@entry_id:145375) ($n=2$)**

考虑最简单的闭合[牛顿-柯特斯法则](@entry_id:171388)，它使用区间的两个端点 $a$ 和 $b$ 作为节点。其形式为：
$\int_{a}^{b} f(x) dx \approx w_0 f(a) + w_1 f(b)$

我们有两个未知的权重 $w_0$ 和 $w_1$，因此我们可以通过强制该法则对次数为 $0$ 和 $1$ 的多项式精确来求解它们。

1.  令 $f(x) = x^0 = 1$。精确积分为 $\int_a^b 1 dx = b-a$。[求积公式](@entry_id:753909)给出 $w_0(1) + w_1(1) = w_0+w_1$。因此，我们得到第一个方程：$w_0 + w_1 = b-a$。

2.  令 $f(x) = x^1 = x$。精确积分为 $\int_a^b x dx = \frac{b^2-a^2}{2}$。[求积公式](@entry_id:753909)给出 $w_0 a + w_1 b$。因此，我们得到第二个方程：$aw_0 + bw_1 = \frac{b^2-a^2}{2}$。

解这个二元[线性方程组](@entry_id:148943)，可得 $w_0 = w_1 = \frac{b-a}{2}$。这就是众所周知的**[梯形法则](@entry_id:145375)** (Trapezoidal Rule)。

接下来，我们确定其精确度阶。我们已经使其对所有次数 $\le 1$ 的多项式精确。现在测试 $f(x) = x^2$。精确积分为 $\int_a^b x^2 dx = \frac{b^3-a^3}{3}$。梯形法则给出 $\frac{b-a}{2}(a^2+b^2)$。除非 $a=b$（这是一个退化的情况），这两个表达式通常不相等。因此，梯形法则不能精确积分二次多项式，其[精确度](@entry_id:143382)阶为 $1$。

**示例：辛普森法则 ($n=3$)**

现在考虑使用三个节点（两端点及中点）的闭合[牛顿-柯特斯法则](@entry_id:171388)，即**辛普森法则** (Simpson's Rule)。节点为 $x_0=a, x_1=\frac{a+b}{2}, x_2=b$。求积公式为：
$Q[f] = w_0 f(a) + w_1 f(\frac{a+b}{2}) + w_2 f(b)$

我们有三个未知权重，因此可以强制它对次数 $\le 2$ 的多项式精确。为简化代数运算，我们先在标准区间 $[-1, 1]$ 上推导，其节点为 $-1, 0, 1$。
令 $g(t)$ 为定义在 $[-1, 1]$ 上的函数，我们求解 $\int_{-1}^1 g(t) dt \approx \tilde{w}_0 g(-1) + \tilde{w}_1 g(0) + \tilde{w}_2 g(1)$。
1.  对于 $g(t)=1$: $\int_{-1}^1 1 dt = 2 \implies \tilde{w}_0 + \tilde{w}_1 + \tilde{w}_2 = 2$。
2.  对于 $g(t)=t$: $\int_{-1}^1 t dt = 0 \implies -\tilde{w}_0 + \tilde{w}_2 = 0 \implies \tilde{w}_0 = \tilde{w}_2$。
3.  对于 $g(t)=t^2$: $\int_{-1}^1 t^2 dt = \frac{2}{3} \implies \tilde{w}_0(-1)^2 + \tilde{w}_2(1)^2 = \frac{2}{3} \implies \tilde{w}_0 + \tilde{w}_2 = \frac{2}{3}$。

解此[方程组](@entry_id:193238)得：$\tilde{w}_0 = \tilde{w}_2 = \frac{1}{3}$，$\tilde{w}_1 = \frac{4}{3}$。
通过[线性变换](@entry_id:149133) $x(t) = \frac{b-a}{2}t + \frac{a+b}{2}$，我们可以将这些权重映射回区间 $[a,b]$，得到 $w_i = \frac{b-a}{2}\tilde{w}_i$。因此，[辛普森法则](@entry_id:142987)的权重为：
$w_0 = \frac{b-a}{6}, w_1 = \frac{2(b-a)}{3}, w_2 = \frac{b-a}{6}$。

现在检验其精确度阶。按构造，它对次数 $\le 2$ 的多项式是精确的。让我们测试 $f(x)=x^3$。一个惊人的结果出现了：辛普森法则对三次多项式也是精确的！例如，在 $[0,1]$ 上，$\int_0^1 x^3 dx = \frac{1}{4}$，而[辛普森法则](@entry_id:142987)给出 $\frac{1}{6}(0^3 + 4(\frac{1}{2})^3 + 1^3) = \frac{1}{6}(0 + \frac{4}{8} + 1) = \frac{1}{4}$。然而，对于 $x^4$，它就不再精确了。因此，[辛普森法则](@entry_id:142987)的精确度阶为 $3$。这种比预期高一阶的“额外”精度是所有具有奇数个节点的牛顿-柯特斯闭合公式的共同特征，源于节点[分布](@entry_id:182848)的对称性。

#### 高阶[牛顿-柯特斯法则](@entry_id:171388)的缺陷：不稳定性

既然增加节点可以提高精确度阶，一个自然的想法是使用非常高阶的[牛顿-柯特斯法则](@entry_id:171388)来获得高精度。然而，这是一个危险的陷阱。当在[等距节点](@entry_id:168260)上使用高次多项式插值时，会出现所谓的**龙格现象** (Runge's phenomenon)：[插值多项式](@entry_id:750764)在区间两端附近会产生剧烈的[振荡](@entry_id:267781)。

由于牛顿-柯特斯权重是[拉格朗日基](@entry_id:751105)函数的积分，这些剧烈的[振荡](@entry_id:267781)会导致某些权重变为负值。对于闭合[牛顿-柯特斯法则](@entry_id:171388)，当节点数 $n \ge 9$ 时（除了 $n=10$ 的特殊情况），就会出现负权重。

负权重的出现对[数值稳定性](@entry_id:146550)是灾难性的。考虑求积过程的敏感性，即函数值的微小扰动如何影响最终结果。一个求积泛函 $Q$ 的**算子范数**，定义在具有[上确界范数](@entry_id:145717)的连续函数空间上，为 $\Vert Q \Vert = \sum_{i=1}^{n} |w_i|$。这个范数可以看作是输入扰动的最大放大因子。如果所有权重都是正的，那么 $\sum |w_i| = \sum w_i = b-a$（因为任何[求积法则](@entry_id:753909)都应能精确积分常数函数 $f(x)=1$）。当出现负权重时，$\sum |w_i| > |\sum w_i| = b-a$。对于高阶[牛顿-柯特斯法则](@entry_id:171388)，这个求和 $\sum |w_i|$ 会随着 $n$ 指数级增长。这意味着，即使被积函数值的微小误差（例如来自物理测量的噪声或[浮点舍入](@entry_id:749455)误差）也可能被极大地放大，导致计算结果完全不可靠。因此，高阶[牛顿-柯特斯法则](@entry_id:171388)是**不稳定**的，在实践中应避免使用。

### [高斯求积](@entry_id:146011)：最优节点的选择

[牛顿-柯特斯法则](@entry_id:171388)的失败引导我们反思：为什么我们要坚持使用[等距节点](@entry_id:168260)？如果我们有自由选择 $n$ 个节点和 $n$ 个权重，总共 $2n$ 个自由度，我们是否能做得更好？高斯求积给出了肯定的回答。其核心思想是，通过优化地选择节点位置（而非预先固定它们），我们可以达到给定节点数下的最大可能精确度阶。

一个 $n$ 点的高斯求积法则可以达到惊人的 $2n-1$ 的[精确度](@entry_id:143382)阶。这是通过选择节点作为某一族**正交多项式** (orthogonal polynomials) 的根来实现的。

#### 通过[待定系数法](@entry_id:166225)推导

让我们通过[待定系数法](@entry_id:166225)来推导最简单的非平凡高斯法则：2点高斯-勒让德 (Gauss-Legendre) 法则，用于计算 $\int_{-1}^1 f(x)dx$。我们有四个未知数：$x_1, x_2, w_1, w_2$。为了确定它们，我们需要强制该法则对次数高达 $2(2)-1=3$ 的多项式精确。

$Q[f] = w_1 f(x_1) + w_2 f(x_2)$

1.  $f(x)=1$: $\int_{-1}^1 1 dx = 2 \implies w_1+w_2 = 2$。
2.  $f(x)=x$: $\int_{-1}^1 x dx = 0 \implies w_1 x_1 + w_2 x_2 = 0$。
3.  $f(x)=x^2$: $\int_{-1}^1 x^2 dx = \frac{2}{3} \implies w_1 x_1^2 + w_2 x_2^2 = \frac{2}{3}$。
4.  $f(x)=x^3$: $\int_{-1}^1 x^3 dx = 0 \implies w_1 x_1^3 + w_2 x_2^3 = 0$。

这是一个[非线性方程组](@entry_id:178110)。但我们可以利用对称性来简化它。由于积分区间和权重函数 $w(x)=1$ 都是关于[原点对称](@entry_id:172995)的，最优的节点和权重也应该是对称的，即 $x_1 = -x_2$ 且 $w_1 = w_2$。
- 从方程1，$2w_1=2 \implies w_1=w_2=1$。
- 方程2自动满足：$1(-x_2) + 1(x_2) = 0$。
- 将 $w_1=w_2=1$ 和 $x_1=-x_2$ 代入方程3：$1(-x_2)^2 + 1(x_2)^2 = 2x_2^2 = \frac{2}{3} \implies x_2^2 = \frac{1}{3}$。
- 因此，节点为 $x_2 = 1/\sqrt{3}$ 和 $x_1 = -1/\sqrt{3}$。
- 方程4也自动满足。

所以，2点[高斯-勒让德法则](@entry_id:636900)是：
节点：$x_{1,2} = \pm \frac{1}{\sqrt{3}} \approx \pm 0.57735$
权重：$w_{1,2} = 1$

通过构造，它对所有次数 $\le 3$ 的多项式都是精确的。例如，它能精确积分 $x^3$，但不能精确积分 $x^4$（$\int_{-1}^1 x^4 dx = 2/5$，而该法则给出 $(-1/\sqrt{3})^4 + (1/\sqrt{3})^4 = 1/9 + 1/9 = 2/9$）。其[精确度](@entry_id:143382)阶确实为3。

### 对比分析：牛顿-柯特斯 vs. [高斯求积](@entry_id:146011)

现在我们可以系统地对比这两种方法。

*   **节点位置**：[牛顿-柯特斯法则](@entry_id:171388)使用[等距节点](@entry_id:168260)，且闭合式包含端点。高斯法则的节点是不等距的，是相应正交多项式的根，并且总是严格位于积分区间的内部。

*   **[精确度](@entry_id:143382)阶**：对于 $n$ 个节点，[牛顿-柯特斯法则](@entry_id:171388)的[精确度](@entry_id:143382)阶大约为 $n$，而高斯法则的[精确度](@entry_id:143382)阶为 $2n-1$。这意味着[高斯求积](@entry_id:146011)用相同数量的函数求值可以精确积分更高次数的多项式，因此对于[光滑函数](@entry_id:267124)通常效率更高。

*   **权重与稳定性**：对于正的积分权重函数（例如标准积分中的 $w(x)=1$），[高斯求积法](@entry_id:146011)则的所有权重 $w_i$ 都是严格为正的。这保证了其算子范数 $\sum |w_i| = b-a$，使其成为一种数值稳定的方法。相比之下，高阶[牛顿-柯特斯法则](@entry_id:171388)会出现负权重，导致[算子范数](@entry_id:752960)急剧增大，从而数值不稳定。

从最优性角度看，[高斯求积](@entry_id:146011)满足**最大化代数精度**这一标准。然而，它并不一定满足其他[最优性准则](@entry_id:178183)，例如在某个函数空间范数下最小化[最坏情况误差](@entry_id:169595)。后者是一个更复杂的“最优恢复”问题，其解通常与高斯求积不同。

### 实际应用中的求积策略

在实际计算中，为了达到高精度，我们通常不使用单个高阶的[求积法则](@entry_id:753909)。相反，我们采用**[复合求积法则](@entry_id:634240)** (composite quadrature rule)。其思想很简单：将大的积分区间 $[a,b]$ 分割成 $N$ 个宽度为 $h=(b-a)/N$ 的小子区间（或称为“板”），然后在每个子区间上应用一个低阶的、稳定的[求积法则](@entry_id:753909)（如梯形法则、辛普森法则或低阶高斯法则），最后将所有子区间的结果相加。

#### 局部与[全局截断误差](@entry_id:143638)

在分析复合法则时，区分两种误差至关重要：
*   **[局部截断误差](@entry_id:147703)** (local truncation error) 是在一个单独的子区间上，精确积分与单板求积法则给出的近似值之间的差异。
*   **[全局截断误差](@entry_id:143638)** (global truncation error) 是在整个区间 $[a,b]$ 上，总的精确积分与[复合求积法则](@entry_id:634240)给出的总近似值之间的差异。它等于所有[局部截断误差](@entry_id:147703)之和。

这些误差通常用大O符号表示其随板宽 $h$ 减小而收敛的速度。$E(h) = O(h^p)$ 表示存在常数 $M>0$ 和 $h_0>0$，使得对于所有 $0  h \le h_0$，有 $|E(h)| \le M h^p$。

局部误差和[全局误差](@entry_id:147874)的阶数之间存在一个简单的关系。如果一个单板法则的[局部截断误差](@entry_id:147703)为 $O(h^{p+1})$，那么由它构成的复合法则的[全局截断误差](@entry_id:143638)将是 $O(h^p)$。这是因为全局误差是 $N=(b-a)/h$ 个局部误差的和，[误差累积](@entry_id:137710)效应导致阶数降低一阶。
*   **[复合辛普森法则](@entry_id:173111)**：其局部误差为 $O(h^5)$，因此全局误差为 $O(h^4)$。
*   **复合$n$点[高斯-勒让德法则](@entry_id:636900)**：其局部误差为 $O(h^{2n+1})$，因此全局误差为 $O(h^{2n})$。

这个结果再次凸显了高斯求积的威力：即使在复合规则的框架下，它也能提供比同等计算量的[牛顿-柯特斯法则](@entry_id:171388)更快的收敛速度。

#### 高斯节点的计算：[Golub-Welsch算法](@entry_id:749964)

[高斯求积](@entry_id:146011)的一个实际障碍是如何计算其节点和权重。直接求解高次正交多项式的根（例如用牛顿法）可能很困难且不稳定。现代计算方法是**[Golub-Welsch算法](@entry_id:749964)**。该算法利用了[正交多项式](@entry_id:146918)的[三项递推关系](@entry_id:176845)，构造了一个 $n \times n$ 的[对称三对角矩阵](@entry_id:755732)，称为**雅可比矩阵** (Jacobi matrix)。这个矩阵的[特征值](@entry_id:154894)恰好是 $n$ 个高斯节点，而相应归一化[特征向量](@entry_id:151813)的第一个分量的平方与高斯权重成正比。

将节点计算转化为一个[对称三对角矩阵](@entry_id:755732)的特征值问题是一个巨大成功，因为后者有非常稳定和高效的算法（如[QR算法](@entry_id:145597)或[分治算法](@entry_id:748615)），其计算成本为 $O(n^2)$。这比一般矩阵的 $O(n^3)$ [特征值计算](@entry_id:145559)要快得多，并且比从不确定的初始猜测开始的[寻根方法](@entry_id:145036)要稳健得多。

### 高斯求积的扩展

高斯求积的真正力量在于其通用性。通过选择不同的积分区间 $\Omega$ 和权重函数 $w(x)$，我们可以为不同类型的积分定制高效的求积法则。每一种选择都对应一族新的正交多项式和一套新的高斯节点与权重。

以下是三种最著名的高斯求积法则：
*   **高斯-勒让德 (Gauss-Legendre)**
    *   **形式**: $\int_{-1}^{1} f(x) dx$
    *   **权重函数**: $w(x)=1$
    *   **区间**: $\Omega = [-1, 1]$
    *   **应用**: 这是最通用的法则，适用于任何有限区间上的积分（通过线性变换）。例如，在计算角度相关的[反射系数](@entry_id:194350)时，对$[0, \pi/2]$上的[入射角](@entry_id:192705)积分，可以通过变量替换映射到$[-1,1]$上进行高效计算。

*   **高斯-拉盖尔 (Gauss-Laguerre)**
    *   **形式**: $\int_{0}^{\infty} e^{-x} f(x) dx$
    *   **权重函数**: $w(x)=e^{-x}$
    *   **区间**: $\Omega = [0, \infty)$
    *   **应用**: 适用于半无限区间上且被积函数包含指数衰减因子的积分。例如，在层状[介质电磁学](@entry_id:276901)或[声学](@entry_id:265335)中，由于衰减或垂直衰减，经常出现对波数 $k \in [0, \infty)$ 的积分，其形式包含 $e^{-ak}$ 因子。通过简单的变量缩放即可将其转化为标准的高斯-拉盖尔形式。

*   **高斯-埃尔米特 (Gauss-Hermite)**
    *   **形式**: $\int_{-\infty}^{\infty} e^{-x^2} f(x) dx$
    *   **权重函数**: $w(x)=e^{-x^2}$
    *   **区间**: $\Omega = (-\infty, \infty)$
    *   **应用**: 适用于全[实数轴](@entry_id:147286)上且被积函数包含高斯衰减因子的积分。例如，在高斯波束建模、[扩散](@entry_id:141445)问题的格林函数或对加了高斯窗的信号进行[傅里叶分析](@entry_id:137640)时，都会遇到这类积分。

通过明智地选择合适的求积法则，将积分问题中的“困难”部分（如无限区间或奇异权重函数）吸收到[求积法则](@entry_id:753909)本身，我们可以让剩下的被积函数 $f(x)$ 变得更平滑、更像多项式，从而用极少的函数求值次数实现极高的精度。这正是[高斯求积](@entry_id:146011)方法在科学与工程计算中经久不衰的魅力所在。