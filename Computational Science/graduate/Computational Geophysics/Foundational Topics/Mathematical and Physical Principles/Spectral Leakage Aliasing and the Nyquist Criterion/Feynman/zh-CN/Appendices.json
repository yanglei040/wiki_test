{
    "hands_on_practices": [
        {
            "introduction": "## 一维波场采样：混叠与分辨率\n\n本实践从最基本的一维空间采样入手，帮助你直观地理解两个核心概念。我们将通过一个思想实验，探讨当采样间隔 $\\Delta x$ 不满足奈奎斯特准则时，波场的高波数 $k$ 成分如何“折叠”成看似低波数的伪影，即空间混叠。同时，我们还将量化有限的观测孔径 $L$ 如何导致频谱泄漏，从而影响我们区分两个相近波速模式的能力。",
            "id": "3614874",
            "problem": "您将通过构建空间混叠下的折叠色散关系，并量化频率-波数分析中的谱泄漏，来分析薄弹性层中两种导波模式的空间采样。物理设置为一个一维线性接收器阵列，对在层中传播的两种平面波模式的叠加进行采样。在感兴趣的频带内，每种模式都被建模为非色散的，具有恒定的相速度。连续场是空间和时间复指数和的实部。任务是根据采样理论推导，间距违反奈奎斯特准则的空间采样如何折叠表观波数，并量化有限孔径加窗如何引入谱泄漏，从而模糊频率-波数空间中的波脊。\n\n假设以下基础理论：\n- 连续时间、连续空间的场是两种平面波模式的叠加，每种模式的形式为 $u_m(x,t) = \\Re\\{A_m \\exp(i(k_m x - \\omega t))\\}$，其中 $m \\in \\{A,B\\}$，角频率为 $\\omega$，波数为 $k_m$。\n- 对于本问题，模式是非色散的，相速度分别为 $v_A$ 和 $v_B$，因此在感兴趣的频带内，对于任何 $\\omega$，都有 $k_A = \\omega / v_A$ 和 $k_B = \\omega / v_B$。\n- 空间采样间距为 $\\Delta x$，产生的空间奈奎斯特波数值为 $k_N = \\pi / \\Delta x$。离散采样的空间谱等于连续谱在波数上每 $2\\pi/\\Delta x$ 复制一次。折叠（混叠）的波数必须映射到奈奎斯特区间 $[-k_N,k_N]$ 内。\n- 长度为 $L = N \\Delta x$ 的有限空间孔径（矩形窗）将场乘以一个窗函数，该窗函数的傅里叶变换与 $\\sin(k L/2)/(k/2)$ 成正比，产生具有特征主瓣（位于第一零点之间）和旁瓣的谱泄漏。主瓣的零点到零点宽度在波数上为 $4\\pi/L$，从峰值到第一零点的偏移为 $2\\pi/L$。\n\n为每个测试用例执行以下步骤：\n1. 使用 $k = \\omega / v$ 计算目标频率 $f_0$（单位为赫兹，因此 $\\omega_0 = 2\\pi f_0$）下的真实波数 $k_A$ 和 $k_B$。所有波数均以弧度/米表示。\n2. 将每个真实波数映射到由空间采样间距 $\\Delta x$ 所决定的奈奎斯特区间 $[-k_N,k_N]$ 内的折叠值。如果在折叠前 $|k| > k_N$，则声明该模式发生空间混叠。折叠值定义为等价类 $k + m \\cdot (2\\pi/\\Delta x)$（其中 $m$ 为整数）中位于 $[-k_N,k_N]$ 内的唯一代表。\n3. 将折叠域中两种模式的分离量化为 $\\Delta k_{\\mathrm{fold}} = |k_{A,\\mathrm{fold}} - k_{B,\\mathrm{fold}}|$。\n4. 通过类 Rayleigh 可分辨性准则量化矩形空间窗造成的谱泄漏模糊：如果在 $f_0$ 处，$\\Delta k_{\\mathrm{fold}} \\ge 2\\pi / L$，则声明这两种模式在波数上是空间可分辨的；否则，声明它们不可分辨。此外，将一种模式在另一模式位置处引起的泄漏幅度比量化为 $r$。\n$$r = \\left|\\frac{\\sin(\\Delta k_{\\mathrm{fold}} L / 2)}{\\Delta k_{\\mathrm{fold}} L / 2}\\right|$$\n（使用矩形窗的归一化 sinc 包络）。\n5. 为展示整个频带的混叠情况，仅对模式 B，在给定的频率网格上评估混叠条件，并计算有多少个网格频率发生混叠。使用网格 $f \\in \\{50, 100, 150, 200, 250, 300, 350, 400\\}$（单位均为赫兹），混叠的定义与步骤 2 中相同。将此计数报告为整数。\n6. 通过使用 $\\Delta t$ 和 $N_t$，确保时间采样不发生混叠，使得时间奈奎斯特频率 $f_{N,t} = 1/(2\\Delta t)$ 超过最大网格频率。在此任务中，您无需计算任何时间折叠；使用这些时间参数仅为保持科学真实性。\n\n对所有测试用例使用以下固定的物理参数：\n- 模式相速度：$v_A = 2000 \\ \\mathrm{m/s}$ 和 $v_B = 1200 \\ \\mathrm{m/s}$。\n- 目标频率：$f_0 = 200 \\ \\mathrm{Hz}$，因此 $\\omega_0 = 2\\pi f_0$。\n- 单位：距离单位为米，时间单位为秒，波数单位为弧度/米，角频率单位为弧度/秒。所有角度必须以弧度处理。\n\n使用以下四个测试用例的套件，涵盖一个标称情况、一个强混叠情况、一个奈奎斯特边界情况和一个泄漏主导情况：\n- 用例 1：$\\Delta x = 1.0$, $N = 64$, $\\Delta t = 0.001$, $N_t = 1024$。\n- 用例 2：$\\Delta x = 3.2$, $N = 32$, $\\Delta t = 0.001$, $N_t = 1024$。\n- 用例 3：$\\Delta x = 3.0$, $N = 32$, $\\Delta t = 0.001$, $N_t = 1024$。\n- 用例 4：$\\Delta x = 1.0$, $N = 8$, $\\Delta t = 0.001$, $N_t = 512$。\n\n对于每个用例，您的程序必须计算并按顺序返回一个包含以下条目的列表：\n- 在 $f_0$ 时的折叠波数 $k_{A,\\mathrm{fold}}$（浮点数，单位为弧度/米）。\n- 在 $f_0$ 时的折叠波数 $k_{B,\\mathrm{fold}}$（浮点数，单位为弧度/米）。\n- 由 $\\Delta k_{\\mathrm{fold}} \\ge 2\\pi/L$ 定义的在 $f_0$ 时的可分辨性标志（整数，$1$ 表示可分辨，$0$ 表示不可分辨）。\n- 任一模式在 $f_0$ 时的混叠标志（整数，如果 A 或 B 中任一模式发生混叠则为 $1$，否则为 $0$）。\n- 基于矩形窗的在 $f_0$ 时的泄漏幅度比 $r$（浮点数，无单位）。\n- 模式 B 在指定频率网格上的混叠计数（整数）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的各用例列表的列表，并用方括号括起来。浮点数必须四舍五入到 $6$ 位小数。例如，一个有效的输出应如下所示：“[[a,b,c,d,e,f],[...],[...],[...]]”，其中 $a,b,\\dots$ 是每个用例按指定顺序所请求的条目。",
            "solution": "用户提供的问题已经过严格验证，并被确定为 **有效**。它在科学上基于波传播和数字信号处理的原理，其定义和参数完整一致，问题阐述清晰，并以客观、正式的语言表达。该问题与计算地球物理学中的谱分析主题直接相关。满足了有效问题的所有条件。\n\n解决方案通过将已建立的采样理论和傅里叶分析原理应用于所提供的测试用例来展开。核心概念是波的运动学、空间混叠以及由有限孔径加窗引起的谱泄漏。\n\n首先，我们建立物理背景。传播场是两个非色散平面波的叠加。对于给定的角频率 $\\omega$，模式 A 和模式 B 的真实波数（表示为 $k_A$ 和 $k_B$）由线性色散关系 $k = \\omega/v$ 决定。相速度给定为 $v_A = 2000 \\ \\mathrm{m/s}$ 和 $v_B = 1200 \\ \\mathrm{m/s}$。对于目标频率 $f_0 = 200 \\ \\mathrm{Hz}$，角频率为 $\\omega_0 = 2\\pi f_0 = 400\\pi \\ \\mathrm{rad/s}$。\n因此，真实波数为：\n$$k_A = \\frac{\\omega_0}{v_A} = \\frac{400\\pi}{2000} = \\frac{\\pi}{5} \\ \\mathrm{rad/m} \\approx 0.628319 \\ \\mathrm{rad/m}$$\n$$k_B = \\frac{\\omega_0}{v_B} = \\frac{400\\pi}{1200} = \\frac{\\pi}{3} \\ \\mathrm{rad/m} \\approx 1.047198 \\ \\mathrm{rad/m}$$\n在目标频率 $f_0$ 下，这些值对所有测试用例都是恒定的。\n\n每个测试用例的后续计算取决于采样参数 $\\Delta x$ 和 $N$。\n\n1.  **空间采样、奈奎斯特准则和混叠**：\n    当连续空间信号以 $\\Delta x$ 的间隔进行采样时，得到的离散波数谱是周期性的，周期为 $k_S = 2\\pi/\\Delta x$。任何关于大小超过奈奎斯特波数 $k_N = \\pi/\\Delta x$ 的波数信息都会被“折叠”到主奈奎斯特区间 $[-k_N, k_N]$ 中。如果真实波数 $k$ 满足 $|k| > k_N$，则声明该模式发生空间混叠。\n    与真实波数 $k$ 对应的折叠波数 $k_{\\mathrm{fold}}$ 是区间 $[-k_N, k_N]$ 中的唯一值，满足 $k_{\\mathrm{fold}} = k + m \\cdot (2\\pi/\\Delta x)$（其中 $m$ 为某个整数）。一种计算上稳健的求 $k_{\\mathrm{fold}}$ 的方法是将空间相位 $k \\Delta x$ 映射到区间 $[-\\pi, \\pi]$，然后除以 $\\Delta x$。该操作等效于 $k_{\\mathrm{fold}} = \\frac{1}{\\Delta x} \\mathrm{atan2}(\\sin(k\\Delta x), \\cos(k\\Delta x))$。对于每个用例，我们根据 $\\Delta x$ 计算 $k_N$，然后确定 $k_{A,\\mathrm{fold}}$、$k_{B,\\mathrm{fold}}$ 以及在 $f_0 = 200 \\ \\mathrm{Hz}$ 时是否有任一模式发生混叠。\n\n2.  **谱泄漏和可分辨性**：\n    在长度为 $L=N\\Delta x$ 的有限空间孔径上观测波场，等效于将无限信号乘以一个矩形窗函数。在波数域中，这对应于将真实谱（在 $k_A$ 和 $k_B$ 处的一对狄拉克δ函数）与矩形窗的傅里叶变换进行卷积。窗函数的变换是一个 sinc 函数，由 $\\mathrm{sinc}(kL/2) = \\sin(k L/2)/(k L/2)$ 给出，并按 $L$ 缩放。这种卷积将尖锐的谱峰替换为 sinc 形的图案，这种效应称为谱泄漏。sinc 函数主瓣的零点到零点宽度为 $4\\pi/L$。\n    适用于此背景的 Rayleigh 可分辨性准则指出，如果两个谱峰的间距至少为主瓣宽度的一半（即从峰值到 sinc 函数第一个零点的距离），则它们是可分辨的。因此，如果两种模式在折叠域中的分离 $\\Delta k_{\\mathrm{fold}} = |k_{A,\\mathrm{fold}} - k_{B,\\mathrm{fold}}|$ 满足以下条件，则认为它们是可分辨的：\n    $$\\Delta k_{\\mathrm{fold}} \\ge \\frac{2\\pi}{L}$$\n    泄漏幅度比 $r$ 量化了一种模式的 sinc 函数在另一模式波数处的幅度。它由以下公式给出：\n    $$r = \\left|\\frac{\\sin(\\Delta k_{\\mathrm{fold}} L / 2)}{\\Delta k_{\\mathrm{fold}} L / 2}\\right|$$\n    如果 $\\Delta k_{\\mathrm{fold}} = 0$，该比值趋近其极限值 $1$。\n\n3.  **跨频带的混叠**：\n    混叠条件 $|k| > k_N$ 是频率相关的，因为 $k$ 本身与频率相关。对于模式 B，条件是 $k_B(f) > k_N$，这可以转换为 $(2\\pi f / v_B) > (\\pi / \\Delta x)$，或 $f > v_B/(2\\Delta x)$。我们对所提供网格 $f \\in \\{50, 100, \\dots, 400\\} \\ \\mathrm{Hz}$ 中的每个频率测试此不等式，并计算模式 B 发生混叠的频率数量。\n\n使用指定的参数为每个测试用例执行这些步骤。\n\n时间采样参数 $\\Delta t = 0.001 \\ \\mathrm{s}$ 产生的时间奈奎斯特频率为 $f_{N,t} = 1/(2\\Delta t) = 500 \\ \\mathrm{Hz}$。由于所考虑的最大频率是 $400 \\ \\mathrm{Hz}$，因此时间混叠不成问题，这证实了按要求设置的科学真实性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes spatial sampling of two guided-wave modes to quantify\n    aliasing and spectral leakage.\n    \"\"\"\n    # Fixed physical parameters\n    v_A = 2000.0  # m/s\n    v_B = 1200.0  # m/s\n    f0 = 200.0    # Hz\n    omega0 = 2 * np.pi * f0\n\n    # Frequency grid for aliasing count\n    freq_grid = np.arange(50, 401, 50)\n\n    # Test suite\n    test_cases = [\n        # (dx, N, dt, Nt)\n        (1.0, 64, 0.001, 1024),\n        (3.2, 32, 0.001, 1024),\n        (3.0, 32, 0.001, 1024),\n        (1.0, 8, 0.001, 512),\n    ]\n\n    all_results = []\n\n    # True wavenumbers at f0\n    k_A_true = omega0 / v_A\n    k_B_true = omega0 / v_B\n\n    for case in test_cases:\n        dx, N, _, _ = case\n\n        # --- Step 0: Setup for the current case ---\n        k_N = np.pi / dx\n        L = N * dx\n\n        # --- Step 1  2: True and folded wavenumbers, and aliasing flag at f0 ---\n\n        # A robust function to fold wavenumber k into [-k_N, k_N]\n        def fold_wavenumber(k, delta_x):\n            # The phase k*delta_x is wrapped to [-pi, pi], then scaled back.\n            return np.angle(np.exp(1j * k * delta_x)) / delta_x\n\n        k_A_fold = fold_wavenumber(k_A_true, dx)\n        k_B_fold = fold_wavenumber(k_B_true, dx)\n        \n        # Check for aliasing: |k| > k_N\n        is_A_aliased = np.abs(k_A_true) > k_N\n        is_B_aliased = np.abs(k_B_true) > k_N\n        aliased_flag = 1 if is_A_aliased or is_B_aliased else 0\n\n        # --- Step 3: Separation in folded domain ---\n        delta_k_fold = np.abs(k_A_fold - k_B_fold)\n\n        # --- Step 4: Resolvability and leakage ratio ---\n        # Rayleigh-like resolution criterion\n        k_res_limit = 2 * np.pi / L\n        resolvable_flag = 1 if delta_k_fold >= k_res_limit else 0\n\n        # Leakage amplitude ratio using the unnormalized sinc function\n        # formula: r = |sin(x)/x| where x = delta_k_fold * L / 2\n        # Use np.sinc(y) which is sin(pi*y)/(pi*y), so we set y = x/pi\n        x = delta_k_fold * L / 2.0\n        if np.isclose(x, 0.0):\n            leakage_ratio = 1.0\n        else:\n            # np.sinc computes sin(pi*y)/(pi*y). We want sin(x)/x.\n            # Let x = pi*y, so y = x/pi.\n            leakage_ratio = np.abs(np.sinc(x / np.pi))\n\n        # --- Step 5: Alias count for mode B across the frequency grid ---\n        alias_count = 0\n        for f in freq_grid:\n            omega = 2 * np.pi * f\n            k_B_freq = omega / v_B\n            if np.abs(k_B_freq) > k_N:\n                alias_count += 1\n        \n        # Assemble results for the current case\n        case_results = [\n            k_A_fold,\n            k_B_fold,\n            resolvable_flag,\n            aliased_flag,\n            leakage_ratio,\n            alias_count\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified\n    outer_list_str = []\n    for res_case in all_results:\n        inner_list_str = []\n        for item in res_case:\n            if isinstance(item, float):\n                inner_list_str.append(f\"{item:.6f}\")\n            else:\n                inner_list_str.append(str(item))\n        outer_list_str.append(f\"[{','.join(inner_list_str)}]\")\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "## 二维地震勘探设计：各向异性的奈奎斯特准则\n\n在一维的基础上，本实践将采样理论扩展到更符合实际的二维地震勘探场景。你将发现，对于常规的矩形观测网格，奈奎斯特准则具有各向异性，这意味着避免混叠的能力取决于波的传播方向。通过该练习，你将学会如何根据地下的最大倾角 $\\theta_{\\max}$ 来设计勘探参数（$\\Delta x$, $\\Delta y$），并探索如六边形网格等更高效的采样策略，以优化数据采集的成本与质量。",
            "id": "3614831",
            "problem": "给定一个源于正交测线三维采集的二维空间采样问题。假设在相速度为常数 $v$ 的均匀介质中，一个标量波场 $u(x,y,t)$ 是形式为 $u(x,y,t)=\\Re\\{\\exp(i(\\omega t - k_x x - k_y y))\\}$ 的平面波的叠加，其中 $\\omega$ 是角频率，$(k_x,k_y)$ 是空间角波数。采集在沿 $x$ 和 $y$ 方向间距分别为 $\\Delta x$ 和 $\\Delta y$ 的均匀矩形网格上对 $u$ 进行采样。采样定理指出，采样通过在倒易晶格节点处的平移来复制连续空间谱。对于矩形网格，倒易晶格平移发生在整数 $n_x,n_y$ 的 $(2\\pi n_x/\\Delta x,2\\pi n_y/\\Delta y)$ 处，基带 (奈奎斯特) 区域是矩形 $|k_x|\\le \\pi/\\Delta x$, $|k_y|\\le \\pi/\\Delta y$。空间域中的六边形 (三角形) 采样网格在空间波数域中有一个六边形基带，其内切圆的半径大于同等采样密度的矩形网格的内切圆半径。\n\n假设波场具有从垂直轴测量的最大倾角 $\\theta_{\\max}$，因此在频率 $f=\\omega/(2\\pi)$ 处的水平波数大小受 $k_h(f)=\\|\\,(k_x,k_y)\\,\\|_2 \\le (\\omega/v)\\sin\\theta_{\\max}=(2\\pi f/v)\\sin\\theta_{\\max}$ 的限制。如果在给定的频率 $f$ 下，水平波数大小的支撑集对于 $(k_x,k_y)$ 平面中的所有传播方向都不能完全落在基带内部，就会发生混叠。\n\n你的任务：\n\n- 仅从上文的定义出发，推导在 $(k_x,k_y)$ 平面中，用于矩形网格的二维奈奎斯特约束（用 $\\Delta x$ 和 $\\Delta y$ 表示）。然后，利用倾角界限，推导以下两种情况下的最大无混叠频率公式：\n  - 边限制条件，即圆 $k_h(f)=\\text{const}$ 首次接触奈奎斯特矩形的一条边，以及\n  - 角限制条件，即 $k_h(f)$ 到达矩形角点 $(\\pi/\\Delta x,\\pi/\\Delta y)$。\n  将这两个频率表示为 $v$, $\\theta_{\\max}$, $\\Delta x$ 和 $\\Delta y$ 的函数，并使用单位：$f$ 为 $\\mathrm{Hz}$，$v$ 为 $\\mathrm{m/s}$，$\\Delta x, \\Delta y$ 为 $\\mathrm{m}$。\n\n- 通过在角点方向放置一个单色平面波来模拟角限制频率下的一阶混叠副本，即水平波数向量 $k_0$ 的大小为 $r_{\\mathrm{corner}}=\\sqrt{(\\pi/\\Delta x)^2+(\\pi/\\Delta y)^2}$，角度为 $\\phi_{\\mathrm{corner}}=\\arctan2(\\pi/\\Delta y,\\pi/\\Delta x)$，因此 $k_0=(r_{\\mathrm{corner}}\\cos\\phi_{\\mathrm{corner}},r_{\\mathrm{corner}}\\sin\\phi_{\\mathrm{corner}})$。计算有多少个平移后的副本 $k_0-G$（其中 $G=(2\\pi n_x/\\Delta x,2\\pi n_y/\\Delta y)$，$n_x,n_y\\in\\{-1,0,1\\}$, $(n_x,n_y)\\neq(0,0)$）落在矩形基带 $|k_x|\\le \\pi/\\Delta x$, $|k_y|\\le \\pi/\\Delta y$ 的内部或边界上。\n\n- 对于一个与间距为 $\\Delta x, \\Delta y$ 的矩形网格具有相同采样密度 $\\rho$（单位面积采样点数，因此 $\\rho=1/(\\Delta x\\Delta y)$）的六边形采样网格，其基带的各向同性无混叠半径 $r_{\\mathrm{iso,hex}}$ 大于同等密度的方形矩形网格的半径。在相同的 $\\rho$ 下，计算方形矩形网格的各向同性奈奎斯特圆半径 $r_{\\mathrm{iso,rect(density)}}$ 和六边形网格的各向同性奈奎斯特圆半径 $r_{\\mathrm{iso,hex(density)}}$，以及改进因子 $r_{\\mathrm{iso,hex(density)}}/r_{\\mathrm{iso,rect(density)}}$。此外，通过将 $k_h(f_{\\max})$ 与 $r_{\\mathrm{iso,hex(density)}}$ 进行比较，测试在给定的 $f_{\\max}$ 和 $\\theta_{\\max}$ 下，同等密度的六边形网格是否无混叠。\n\n角度必须以弧度表示，所有最终的频率量必须以 $\\mathrm{Hz}$ 表示。\n\n程序要求：\n\n- 实现一个程序，为每个测试用例计算：\n  - 一个布尔值，指示在 $f_{\\max}$ 和 $\\theta_{\\max}$ 下矩形采样是否无混叠，\n  - 一个布尔值，指示在 $f_{\\max}$ 和 $\\theta_{\\max}$ 下同等密度的六边形采样是否无混叠，\n  - 以 $\\mathrm{Hz}$ 为单位的边限制最大无混叠频率，\n  - 以 $\\mathrm{Hz}$ 为单位的角限制最大无混叠频率，\n  - 在角限制水平波数下，落入基带内部或边界上的一阶混叠副本的整数数量，\n  - 改进因子 $r_{\\mathrm{iso,hex(density)}}/r_{\\mathrm{iso,rect(density)}}$，以浮点数表示。\n- 你的程序应生成单行输出，其中包含所有测试用例的汇总结果，形式为方括号括起来的逗号分隔列表，条目按测试用例排序，且每个测试用例内的结果按上述顺序列出。\n\n测试套件：\n\n- 测试用例 $1$：$\\Delta x=12.5\\,\\mathrm{m}$，$\\Delta y=25.0\\,\\mathrm{m}$，$v=2000.0\\,\\mathrm{m/s}$，$f_{\\max}=60.0\\,\\mathrm{Hz}$，$\\theta_{\\max}=0.610865238198\\,\\mathrm{rad}$ (弧度)。\n- 测试用例 $2$ (边界条件)：$\\Delta x=10.0\\,\\mathrm{m}$，$\\Delta y=10.0\\,\\mathrm{m}$，$v=1500.0\\,\\mathrm{m/s}$，$f_{\\max}=86.6025403784\\,\\mathrm{Hz}$，$\\theta_{\\max}=1.0471975512\\,\\mathrm{rad}$ (弧度)。\n- 测试用例 $3$ (强倾角，预期混叠)：$\\Delta x=25.0\\,\\mathrm{m}$，$\\Delta y=25.0\\,\\mathrm{m}$，$v=2500.0\\,\\mathrm{m/s}$，$f_{\\max}=100.0\\,\\mathrm{Hz}$，$\\theta_{\\max}=1.3962634016\\,\\mathrm{rad}$ (弧度)。",
            "solution": "该问题要求为地球物理数据采集推导与奈奎斯特相关的采样约束，并在一个程序中实现这些推导，以评估几个测试用例。分析将分三部分进行：首先，推导矩形采样网格的无混叠频率限制；其次，确定特定角点情况下的混叠副本数量；第三，比较矩形采样网格与六边形采样网格的效率。\n\n### 矩形网格的二维奈奎斯特约束\n\n标量波场 $u(x,y,t)$ 在间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀矩形网格上进行采样。根据 Nyquist-Shannon 采样定理，这种空间采样操作导致波场的连续空间谱 $U(k_x, k_y)$ 在倒易晶格的节点处被复制。对于矩形采样网格，这些副本以倒易晶格向量的整数倍为中心，即位于整数 $n_x, n_y$ 的 $(2\\pi n_x/\\Delta x, 2\\pi n_y/\\Delta y)$ 位置。\n\n为避免混叠，原始的、未复制的谱（基带谱）必须完全包含在第一布里渊区（也称为奈奎斯特区）内。对于矩形网格，该区域是波数域中的一个矩形，定义为：\n$$ |k_x| \\le k_{x,\\text{Ny}} = \\frac{\\pi}{\\Delta x} $$\n$$ |k_y| \\le k_{y,\\text{Ny}} = \\frac{\\pi}{\\Delta y} $$\n\n问题陈述，在给定的时间频率 $f$ 下，波场的能量包含在 $(k_x, k_y)$ 平面内的一个圆中。该圆的半径代表最大水平波数 $k_h(f)$，由色散关系和最大倾角 $\\theta_{\\max}$ 给出：\n$$ k_h(f) = \\sqrt{k_x^2 + k_y^2} \\le \\frac{\\omega}{v} \\sin\\theta_{\\max} = \\frac{2\\pi f}{v} \\sin\\theta_{\\max} $$\n其中 $v$ 是相速度。\n\n为使波场无混叠采样，此谱支撑集圆必须完全落在矩形奈奎斯特区内部。\n\n#### 边限制的最大无混叠频率\n\n将一个圆放入一个矩形内的最严格条件取决于矩形的较短边。奈奎斯特矩形的半宽为 $\\pi/\\Delta x$ 和 $\\pi/\\Delta y$。因此，最大内切圆的半径为 $\\min(\\pi/\\Delta x, \\pi/\\Delta y)$。此条件被称为“边限制”，因为该圆首先接触到对应于较大采样间隔的边（例如，如果 $\\Delta y > \\Delta x$，则矩形在 $k_y$ 方向上更窄，圆首先接触到 $k_y = \\pm \\pi/\\Delta y$ 的边）。\n\n为防止在所有可能的传播方向下（即对于各向同性谱）发生混叠，波数半径 $k_h(f)$ 不得大于此内切圆的半径：\n$$ k_h(f) \\le \\min\\left(\\frac{\\pi}{\\Delta x}, \\frac{\\pi}{\\Delta y}\\right) = \\frac{\\pi}{\\max(\\Delta x, \\Delta y)} $$\n代入 $k_h(f)$ 的表达式，我们可以解出最大无混叠频率 $f_{\\text{side-limited}}$：\n$$ \\frac{2\\pi f_{\\text{side-limited}}}{v} \\sin\\theta_{\\max} = \\frac{\\pi}{\\max(\\Delta x, \\Delta y)} $$\n$$ f_{\\text{side-limited}} = \\frac{v}{2 \\sin\\theta_{\\max} \\max(\\Delta x, \\Delta y)} $$\n\n#### 角限制的最大无混叠频率\n\n一个较不严格的条件允许圆形谱扩展，直到它接触到奈奎斯特矩形的角点。这定义了在基带内任何特定方向上可以无混叠表示的绝对最大波数大小。从原点到奈奎斯特矩形角点 $(\\pm\\pi/\\Delta x, \\pm\\pi/\\Delta y)$ 的距离由勾股定理给出：\n$$ r_{\\text{corner}} = \\sqrt{\\left(\\frac{\\pi}{\\Delta x}\\right)^2 + \\left(\\frac{\\pi}{\\Delta y}\\right)^2} = \\pi \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}} $$\n角限制频率 $f_{\\text{corner-limited}}$ 是谱圆半径等于此角点距离时的频率：\n$$ \\frac{2\\pi f_{\\text{corner-limited}}}{v} \\sin\\theta_{\\max} = r_{\\text{corner}} $$\n$$ f_{\\text{corner-limited}} = \\frac{v}{2\\pi \\sin\\theta_{\\max}} \\left(\\pi \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}}\\right) = \\frac{v}{2 \\sin\\theta_{\\max}} \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}} $$\n\n### 一阶混叠副本分析\n\n问题要求考虑一个单色平面波，其波数向量 $k_0$ 恰好位于奈奎斯特矩形的一个角点上，具体为 $k_0 = (\\pi/\\Delta x, \\pi/\\Delta y)$。我们需要计算八个最近邻的混叠副本中有多少个落在基带区域 $|k_x| \\le \\pi/\\Delta x, |k_y| \\le \\pi/\\Delta y$ 的内部或边界上。\n\n副本的位置由 $k' = k_0 - G$ 给出，其中 $G = (2\\pi n_x/\\Delta x, 2\\pi n_y/\\Delta y)$ 是指向复制谱中心的向量，且 $n_x, n_y \\in \\{-1, 0, 1\\}$ 并且 $(n_x, n_y) \\neq (0, 0)$。\n\n一个副本 $k' = (k'_x, k'_y)$ 位于：\n$$ k'_x = \\frac{\\pi}{\\Delta x} - \\frac{2\\pi n_x}{\\Delta x} = \\frac{\\pi}{\\Delta x}(1 - 2n_x) $$\n$$ k'_y = \\frac{\\pi}{\\Delta y} - \\frac{2\\pi n_y}{\\Delta y} = \\frac{\\pi}{\\Delta y}(1 - 2n_y) $$\n\n我们测试条件 $|k'_x| \\le \\pi/\\Delta x$ 和 $|k'_y| \\le \\pi/\\Delta y$：\n1.  对于 $k_x$ 分量：$|\\frac{\\pi}{\\Delta x}(1 - 2n_x)| \\le \\frac{\\pi}{\\Delta x} \\implies |1 - 2n_x| \\le 1$。\n    - 如果 $n_x = -1$，$|1 - 2(-1)| = |3| = 3$，不满足 $\\le 1$。\n    - 如果 $n_x = 0$，$|1 - 2(0)| = |1| = 1$，满足 $\\le 1$。\n    - 如果 $n_x = 1$，$|1 - 2(1)| = |-1| = 1$，满足 $\\le 1$。\n    因此，为使 $k_x$ 分量落在基带内，$n_x$ 必须为 $0$ 或 $1$。\n\n2.  对于 $k_y$ 分量：$|\\frac{\\pi}{\\Delta y}(1 - 2n_y)| \\le \\frac{\\pi}{\\Delta y} \\implies |1 - 2n_y| \\le 1$。\n    根据对称性，为使 $k_y$ 分量落在基带内，$n_y$ 必须为 $0$ 或 $1$。\n\n我们需要从集合 $\\{-1, 0, 1\\}^2 \\setminus \\{(0, 0)\\}$ 中找到满足 $n_x \\in \\{0, 1\\}$ 和 $n_y \\in \\{0, 1\\}$ 的数对 $(n_x, n_y)$。这些数对是：\n- $(0, 1)$\n- $(1, 0)$\n- $(1, 1)$\n\n这三个数对对应于落在基带边界上的副本。因此，恰好有 $3$ 个这样的一阶混叠副本。这个数量是一个常数，与 $\\Delta x$ 和 $\\Delta y$ 的具体值无关。\n\n### 与六边形采样的比较\n\n为了在不同采样几何形状之间进行公平比较，我们考虑具有相同采样密度 $\\rho$ 的网格。对于给定的矩形网格，$\\rho = 1/(\\Delta x \\Delta y)$。\n\n对于边长为 $\\Delta s$ 且密度相同的方形网格，我们有 $1/(\\Delta s)^2 = \\rho$，因此 $\\Delta s = 1/\\sqrt{\\rho} = \\sqrt{\\Delta x \\Delta y}$。奈奎斯特区是一个正方形，其最大内切圆（各向同性无混叠区域）的半径为：\n$$ r_{\\text{iso,rect(density)}} = \\frac{\\pi}{\\Delta s} = \\frac{\\pi}{\\sqrt{\\Delta x \\Delta y}} $$\n\n对于点间距为 $a$ 的正六边形网格，采样密度为 $\\rho = 2/(a^2 \\sqrt{3})$。令密度相等得到 $a^2 = 2/(\\rho\\sqrt{3}) = 2\\Delta x \\Delta y/\\sqrt{3}$。六边形网格的基带（第一布里渊区）是波数域中的一个六边形。其内切圆的半径代表了各向同性无混叠区域，为 $r_{\\text{iso,hex}} = 2\\pi/(a\\sqrt{3})$。代入 $a$：\n$$ r_{\\text{iso,hex(density)}} = \\frac{2\\pi}{\\sqrt{3}} \\sqrt{\\frac{\\sqrt{3}}{2\\Delta x \\Delta y}} = \\pi \\sqrt{\\frac{4\\sqrt{3}}{3 \\cdot 2\\Delta x \\Delta y}} = \\pi \\sqrt{\\frac{2\\sqrt{3}}{3\\Delta x \\Delta y}} $$\n（在相同密度下）六边形采样相对于方形采样的改进因子是它们各向同性奈奎斯特半径之比：\n$$ \\frac{r_{\\text{iso,hex(density)}}}{r_{\\text{iso,rect(density)}}} = \\frac{\\pi \\sqrt{\\frac{2\\sqrt{3}}{3\\Delta x \\Delta y}}}{\\frac{\\pi}{\\sqrt{\\Delta x \\Delta y}}} = \\sqrt{\\frac{2\\sqrt{3}}{3}} = \\sqrt{\\frac{2}{\\sqrt{3}}} \\approx 1.07457 $$\n这个恒定因子表示对于各向同性信号，在最大无混叠波数（以及频率）上大约有 $7.5\\%$ 的提升。\n\n为了测试在给定的 $f_{\\max}$ 和 $\\theta_{\\max}$ 下六边形采样是否无混叠，我们将信号的最大水平波数 $k_h(f_{\\max})$ 与六边形网格的各向同性奈奎斯特半径 $r_{\\text{iso,hex(density)}}$ 进行比较。无混叠的条件是 $k_h(f_{\\max}) \\le r_{\\text{iso,hex(density)}}$。\n\n### 算法总结\n\n对于每个测试用例 $(\\Delta x, \\Delta y, v, f_{\\max}, \\theta_{\\max})$：\n1.  计算信号的最大水平波数：$k_{h,\\max} = (2\\pi f_{\\max}/v)\\sin\\theta_{\\max}$。\n2.  **矩形无混叠检查**：确定是否 $k_{h,\\max} \\le \\min(\\pi/\\Delta x, \\pi/\\Delta y)$。这会产生一个布尔结果。\n3.  **六边形无混叠检查**：计算 $r_{\\text{iso,hex(density)}} = \\pi\\sqrt{2\\sqrt{3}/(3\\Delta x \\Delta y)}$ 并确定是否 $k_{h,\\max} \\le r_{\\text{iso,hex(density)}}$。这会产生一个布尔结果。\n4.  **边限制频率**：计算 $f_{\\text{side-limited}} = v / (2 \\sin\\theta_{\\max} \\max(\\Delta x, \\Delta y))$。\n5.  **角限制频率**：计算 $f_{\\text{corner-limited}} = (v / (2 \\sin\\theta_{\\max})) \\sqrt{1/(\\Delta x)^2 + 1/(\\Delta y)^2}$。\n6.  **混叠副本计数**：这是一个常数值 3。\n7.  **改进因子**：这是一个常数值 $\\sqrt{2/\\sqrt{3}}$。\n对每个测试用例，按要求计算并格式化这六个结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the spatial sampling problem for the given test cases.\n\n    For each test case, it computes:\n    1. A boolean indicating if rectangular sampling is alias-free.\n    2. A boolean indicating if hexagonal sampling of equal density is alias-free.\n    3. The side-limited maximum alias-free frequency (Hz).\n    4. The corner-limited maximum alias-free frequency (Hz).\n    5. The count of first-order alias replicas in a corner-case scenario.\n    6. The improvement factor of hexagonal over square-grid sampling.\n    \"\"\"\n    \n    # Test cases: (delta_x, delta_y, v, f_max, theta_max)\n    test_cases = [\n        # Test case 1\n        (12.5, 25.0, 2000.0, 60.0, 0.610865238198),\n        # Test case 2 (boundary condition)\n        (10.0, 10.0, 1500.0, 86.6025403784, 1.0471975512),\n        # Test case 3 (strong dip, aliasing expected)\n        (25.0, 25.0, 2500.0, 100.0, 1.3962634016),\n    ]\n\n    all_results = []\n    \n    # Pre-compute constant values\n    # Number of first-order alias replicas inside the baseband\n    # for a monochromatic wave at a Nyquist corner.\n    alias_replica_count = 3\n    \n    # Improvement factor of hexagonal vs. square lattice of same density.\n    # r_iso_hex / r_iso_rect = sqrt( (2*sqrt(3)/3) ) = sqrt(2/sqrt(3))\n    improvement_factor = np.sqrt(2 / np.sqrt(3))\n\n    for case in test_cases:\n        dx, dy, v, f_max, theta_max = case\n        \n        # Calculate the maximum horizontal wavenumber for the given signal parameters\n        sin_theta_max = np.sin(theta_max)\n        k_h_max = (2 * np.pi * f_max / v) * sin_theta_max\n\n        # 1. Check for aliasing with rectangular sampling\n        # Alias-free if spectral circle fits within the Nyquist rectangle,\n        # which means its radius must be smaller than the smallest half-dimension.\n        k_ny_rect_min = np.pi / max(dx, dy)\n        is_rect_alias_free = k_h_max = k_ny_rect_min\n        \n        # 2. Check for aliasing with hexagonal sampling of equal density\n        # Calculate the isotropic Nyquist radius for the equivalent hexagonal lattice\n        rho = 1.0 / (dx * dy)\n        # r_iso_hex^2 = (pi^2 * 2 * sqrt(3)) / (3 * dx * dy)\n        r_iso_hex_sq = (np.pi**2 * 2 * np.sqrt(3)) / (3 * dx * dy)\n        r_iso_hex = np.sqrt(r_iso_hex_sq)\n        is_hex_alias_free = k_h_max = r_iso_hex\n        \n        # 3. Calculate side-limited maximum alias-free frequency\n        # This corresponds to the isotropic alias-free condition for rectangular grid.\n        f_side_limited = v / (2 * sin_theta_max * max(dx, dy))\n        \n        # 4. Calculate corner-limited maximum alias-free frequency\n        # This corresponds to the wavenumber circle touching the Nyquist corners.\n        f_corner_limited = (v / (2 * sin_theta_max)) * np.sqrt(1/dx**2 + 1/dy**2)\n        \n        # 5. Alias replica count (constant derived in the solution)\n        # This is already pre-computed as alias_replica_count.\n        \n        # 6. Improvement factor (constant derived in the solution)\n        # This is already pre-computed as improvement_factor.\n        \n        # Aggregate results for this case\n        case_results = [\n            is_rect_alias_free,\n            is_hex_alias_free,\n            f_side_limited,\n            f_corner_limited,\n            alias_replica_count,\n            improvement_factor\n        ]\n        all_results.extend(case_results)\n\n    # Format output as a single comma-separated list string\n    # E.g., [True,True,69.738...,...,False,False,...]\n    # The default str() for booleans is 'True'/'False' with capitalization.\n    results_str = ','.join(map(str, all_results))\n    \n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "## 慢度空间中的台阵波束形成：利用锥削抑制泄漏\n\n本实践将前述概念应用于地球物理数据分析的核心技术——台阵波束形成。我们将视角从波数域 $(k_x, k_y)$ 转换到地震学中更常用的慢度（slowness）域 $\\mathbf{s}$，研究空间混叠如何导致对地震波到达方向和速度的误判。更重要的是，你将亲手实现一种抑制频谱泄漏的强大技术——锥削（tapering），并量化其在增强波束形成图像清晰度方面的显著效果。",
            "id": "3614871",
            "problem": "考虑一个窄带平面波场入射到二维空间中的一个离散地震台阵上。一个角频率为 $\\omega$、水平慢度矢量为 $\\mathbf{s} \\in \\mathbb{R}^2$ 的单频分量，在台站位置 $\\mathbf{x}_n \\in \\mathbb{R}^2$ 处产生复相量 $u_n(t) = A \\exp\\{i \\omega (t - \\mathbf{s} \\cdot \\mathbf{x}_n)\\}$，其中 $A$ 是复振幅，$t$ 是时间，$\\mathbf{s} \\cdot \\mathbf{x}_n$ 是以秒为单位的走时。对于试验慢度 $\\mathbf{s}'$ 和实数值的台站权重 $w_n$，台阵波束形成器形成复波束 $B(\\mathbf{s}') = \\sum_{n=1}^{N} w_n \\exp\\{-i \\omega (\\mathbf{s} - \\mathbf{s}') \\cdot \\mathbf{x}_n\\}$，以及相应的功率响应 $P(\\mathbf{s}') = |B(\\mathbf{s}')|^2$。数据以均匀采样间隔 $\\Delta t$（采样率 $f_s = 1/\\Delta t$）进行离散采样。根据离散傅里叶变换（DFT）的采样定理，离散时间处理将可分辨的角频率限制在 $|\\omega| \\le \\pi / \\Delta t$ 范围内，其中 DFT 表示离散傅里叶变换。\n\n任务1（从第一性原理推导）。从离散时间采样边界 $|\\omega| \\le \\pi / \\Delta t$ 和跨台站的平面波相位关系 $\\exp\\{-i \\omega \\mathbf{s} \\cdot \\mathbf{x}_n\\}$ 出发，推导出一个由地震台阵的空间采样所决定的、在慢度-频率联合平面 $(\\mathbf{s}, \\omega)$ 中的必要无混叠区域。仅使用台站集合 $\\{\\mathbf{x}_n\\}_{n=1}^N$ 的几何形状和基本的相位缠绕考量。将您的结果表示为关于 $(\\mathbf{s}, \\omega)$ 的一个显式条件，用台阵的最小台站间距 $d_{\\min}$ 来表达，其中 $d_{\\min} = \\min_{m \\ne n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$。您的推导必须证明所导出的条件为何足以防止平面波相位在台阵所有最近邻基线上发生空间混叠，并说明它如何与时间奈奎斯特边界相结合。\n\n任务2（模拟与量化）。实现一个程序，对下述每个测试案例，使用物理一致的单位执行以下所有操作：\n- 判断慢度-频率对 $(\\mathbf{s}, \\omega)$ 是否位于任务1中推导出的联合奈奎斯特区域内。将此报告为一个布尔型无混叠指示符。\n- 在一个均匀的慢度网格上，为试验慢度 $\\mathbf{s}'$ 计算两个波束功率图 $P_{\\mathrm{rect}}(\\mathbf{s}')$ 和 $P_{\\mathrm{taper}}(\\mathbf{s}')$，该网格覆盖慢度空间中的一个正方形区域。对所有台站使用矩形权重 $w_n = 1$ 和升余弦台站锥削 $w_n = \\tfrac{1}{2}\\left(1 + \\cos(\\pi r_n)\\right)$，其中 $r_n$ 是台站到台阵形心的归一化距离，$r_n = \\|\\mathbf{x}_n - \\bar{\\mathbf{x}}\\|_2 / R$，$\\bar{\\mathbf{x}} = \\tfrac{1}{N}\\sum_n \\mathbf{x}_n$，且 $R = \\max_n \\|\\mathbf{x}_n - \\bar{\\mathbf{x}}\\|_2$。该锥削在形心处为 $1$，在最远台站处为 $0$，其间为平滑的余弦滚降。\n- 将慢度空间中的频谱泄漏量化为总波束功率中，位于真实慢度的一个频率相关的“主瓣邻域”之外的功率所占的比例。将主瓣邻域定义为慢度空间中以真实慢度 $\\mathbf{s}$ 为中心、半径为 $r_0(\\omega) = \\pi / (2 \\omega L)$ 的闭圆盘 $\\mathcal{D}(\\mathbf{s}, r_0)$，其中 $L$ 是定义为最大基线长度 $L = \\max_{m,n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$ 的台阵孔径。对于一个离散网格 $\\{\\mathbf{s}'_g\\}$，将权重为 $w$ 的泄漏分数定义为\n$$\n\\mathcal{L}_w = 1 - \\frac{\\sum_{\\mathbf{s}'_g \\in \\mathcal{D}(\\mathbf{s}, r_0)} P_w(\\mathbf{s}'_g)}{\\sum_{\\mathbf{s}'_g} P_w(\\mathbf{s}'_g)}.\n$$\n为每个测试案例计算 $\\mathcal{L}_{\\mathrm{rect}}$ 和 $\\mathcal{L}_{\\mathrm{taper}}$。$\\mathcal{L}_w$ 越小表示泄漏越少。\n\n所有计算必须使用一致的单位：台站位置以米为单位，时间以秒为单位，角频率以弧度/秒为单位，慢度以秒/米为单位。下面的测试套件以秒/公里为单位指定慢度值；您必须在内部通过除以 $1000$ 将其转换为秒/米。计算中出现的角度必须以弧度为单位。最终答案是无量纲的布尔值和分数，因此无需打印单位。\n\n测试套件。实现下面列出的四个测试案例。在所有案例中，将慢度试验网格构建为笛卡尔积 $s_x' \\times s_y'$，其中 $s_x', s_y' \\in [-1.00, 1.00]$ 秒/公里，在一个步长为 $\\Delta s = 0.02$ 秒/公里的均匀网格上。在使用前，将此网格在内部转换为秒/米。对于每个案例，计算台阵几何参数、$\\omega = 2 \\pi f$、基于您推导的联合奈奎斯特条件的布尔型无混叠指示符，以及泄漏分数 $\\mathcal{L}_{\\mathrm{rect}}$ 和 $\\mathcal{L}_{\\mathrm{taper}}$。\n\n- 案例 A（一维均匀台阵，位于奈奎斯特区域内）：$N = 8$ 个台站，位置为 $\\mathbf{x}_n = \\big((n - \\tfrac{N-1}{2}) d, 0\\big)$，其中 $d = 1000\\,\\mathrm{m}$，$n \\in \\{0,1,2,3,4,5,6,7\\}$，采样率 $f_s = 20\\,\\mathrm{Hz}$，频率 $f = 1\\,\\mathrm{Hz}$，真实慢度 $\\mathbf{s} = (0.25, 0.00)$ 秒/公里。\n- 案例 B（一维均匀台阵，位于奈奎斯特边界）：与案例 A 相同的台阵和采样率，频率 $f = 1\\,\\mathrm{Hz}$，真实慢度 $\\mathbf{s} = (0.50, 0.00)$ 秒/公里。\n- 案例 C（一维均匀台阵，发生混叠）：与案例 A 相同的台阵，采样率 $f_s = 50\\,\\mathrm{Hz}$，频率 $f = 5\\,\\mathrm{Hz}$，真实慢度 $\\mathbf{s} = (0.80, 0.00)$ 秒/公里。\n- 案例 D（二维不规则台阵，位于奈奎斯特区域内）：$N = 10$ 个台站，位置（单位：米）为\n$\\{(-1000, 0), (0, 0), (1000, 0), (0, 1000), (-500, 500), (500, 500), (-500, -500), (500, -500), (0, -1000), (1000, 1000)\\}$，\n采样率 $f_s = 40\\,\\mathrm{Hz}$，频率 $f = 3\\,\\mathrm{Hz}$，真实慢度大小为 $0.30$ 秒/公里，角度为 $45^\\circ$，因此 $\\mathbf{s} = (0.30/\\sqrt{2}, 0.30/\\sqrt{2})$ 秒/公里。\n\n最终输出规范。您的程序应生成单行输出，其中包含按 A-D 顺序排列的案例结果，格式为逗号分隔的列表，并用方括号括起来。对于每个案例，按顺序报告三个值：无混叠布尔值、$\\mathcal{L}_{\\mathrm{rect}}$（浮点数）和 $\\mathcal{L}_{\\mathrm{taper}}$（浮点数）。因此，最终输出必须是一个包含 $12$ 个条目的扁平列表，格式为\n\"[b_A,L_rect_A,L_taper_A,b_B,L_rect_B,L_taper_B,b_C,L_rect_C,L_taper_C,b_D,L_rect_D,L_taper_D]\"。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确、内部一致，并且要求基于地球物理学中阵列信号处理的既定原则进行非平凡的推导和模拟。\n\n### 任务1：联合奈奎斯特区域的推导\n\n该问题要求基于地震台阵的空间采样，在联合慢度-频率平面 $(\\mathbf{s}, \\omega)$ 中推导出一个必要的无混叠条件。\n\n一个角频率为 $\\omega$、慢度矢量为 $\\mathbf{s}$ 的平面波，其相位随空间变化的规律为 $\\phi(\\mathbf{x}, t) = \\omega(t - \\mathbf{s} \\cdot \\mathbf{x})$。在固定时间 $t_0$，相位的空间部分为 $\\phi(\\mathbf{x}) = -\\omega \\mathbf{s} \\cdot \\mathbf{x} + \\text{const}$。矢量 $\\mathbf{k} = \\omega \\mathbf{s}$ 是波数矢量，它描述了相位的空间变化率。\n\n离散地震台阵在一组台站位置 $\\{\\mathbf{x}_n\\}$ 上对这个连续波场进行采样。如果波在采样点之间振荡过快，就会发生空间混叠，导致观测到的相位差出现模糊性。为避免混叠，任意两个采样点之间的相位差的绝对值不能超过 $\\pi$ 弧度。\n\n考虑位于位置 $\\mathbf{x}_m$ 和 $\\mathbf{x}_n$ 的两个台站 $m$ 和 $n$。连接它们的基线矢量是 $\\Delta \\mathbf{x}_{mn} = \\mathbf{x}_m - \\mathbf{x}_n$。到达这两个台站的平面波之间的相位差是：\n$$ \\Delta \\phi_{mn} = \\phi(\\mathbf{x}_m, t) - \\phi(\\mathbf{x}_n, t) = \\omega(t - \\mathbf{s} \\cdot \\mathbf{x}_m) - \\omega(t - \\mathbf{s} \\cdot \\mathbf{x}_n) = -\\omega \\mathbf{s} \\cdot (\\mathbf{x}_m - \\mathbf{x}_n) = -\\mathbf{k} \\cdot \\Delta \\mathbf{x}_{mn} $$\n为了无歧义地确定相位差，其绝对值必须在主值区间 $(-\\pi, \\pi]$ 内，即 $|\\Delta \\phi_{mn}| \\le \\pi$。\n$$ |\\omega \\mathbf{s} \\cdot \\Delta \\mathbf{x}_{mn}| \\le \\pi $$\n这个条件必须对台阵中的所有台站对都成立。然而，对波场属性（即对 $\\omega$ 和 $\\mathbf{s}$）最严格的约束来自于最短的基线。如果一个波可以被最邻近的台站无歧义地采样，它在更长的基线上仍可能发生混叠。空间奈奎斯特准则本质上是关于一个台阵能分辨的最高空间频率（波数），这由其最密集的采样决定，即最小台站间距 $d_{\\min} = \\min_{m \\ne n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$。\n\n为了推导出一个与波的到达方向无关的必要条件，我们必须考虑最坏情况。对于给定的慢度大小 $s = \\|\\mathbf{s}\\|_2$ 和给定的基线 $\\Delta \\mathbf{x}_{mn}$，当慢度矢量 $\\mathbf{s}$ 与基线矢量 $\\Delta \\mathbf{x}_{mn}$ 平行时，相位差的绝对值 $|\\omega \\mathbf{s} \\cdot \\Delta \\mathbf{x}_{mn}|$ 达到最大。在这种情况下，点积变为 $\\|\\mathbf{s}\\|_2 \\|\\Delta \\mathbf{x}_{mn}\\|_2 = s d_{mn}$。\n\n因此，对于任意波向，在长度为 $d_{mn}$ 的基线上避免混叠的条件是：\n$$ |\\omega| s d_{mn} \\le \\pi $$\n为确保台阵对*任何*波都不发生混叠，此条件必须对所有基线都成立。一个台阵被认为是无混叠的必要条件是，即使在最短基线 $d_{\\min}$ 上也必须避免混叠。如果这个条件被违反，那么就存在一个波（其慢度大小为 $s$，方向与最短基线对齐）将会发生空间混叠。因此，必要的空间奈奎斯特条件是：\n$$ |\\omega| s d_{\\min} \\le \\pi \\implies s \\le \\frac{\\pi}{|\\omega| d_{\\min}} $$\n由于 $\\omega = 2\\pi f$ 且我们考虑 $f > 0$，这等价于：\n$$ \\|\\mathbf{s}\\|_2 \\le \\frac{1}{2 f d_{\\min}} $$\n这个关于波的空间属性的条件类似于时间奈奎斯特准则，后者根据采样间隔 $\\Delta t = 1/f_s$ 来限制时间频率 $f$。问题陈述了角频率的时间采样边界为 $|\\omega| \\le \\pi/\\Delta t$，这等价于 $f \\le f_s/2$。\n\n因此，如果一对 $(\\mathbf{s}, \\omega)$ 同时满足时间和空间奈奎斯特准则，它就位于无混叠区域内：\n1.  **时间奈奎斯特条件**：$f \\le \\frac{f_s}{2}$\n2.  **空间奈奎斯特条件**：$\\|\\mathbf{s}\\|_2 \\le \\frac{1}{2 f d_{\\min}}$\n\n这两个不等式的组合定义了在 $(\\mathbf{s}, \\omega)$ 或 $(\\mathbf{s}, f)$ 域中的联合无混叠区域。\n\n### 任务2：模拟与量化\n\n下面的程序为每个测试案例实现了所需的计算。\n1.  **几何计算**：对于每个台阵，计算最小台站间距 $d_{\\min}$、最大孔径 $L$、形心 $\\bar{\\mathbf{x}}$ 以及距形心的最大距离 $R$。\n2.  **混叠检查**：验证给定的对 $(f, \\mathbf{s})$ 是否同时满足上述推导的时间和空间奈奎斯特条件。\n3.  **权重计算**：计算均匀（矩形）权重 $w_n=1$ 和升余弦锥削权重 $w_n = \\tfrac{1}{2}(1 + \\cos(\\pi r_n))$。\n4.  **波束功率计算**：在一个精细的试验慢度 $\\mathbf{s}'$ 网格上计算波束功率 $P(\\mathbf{s}') = |\\sum_{n=1}^{N} w_n \\exp\\{-i \\omega (\\mathbf{s} - \\mathbf{s}') \\cdot \\mathbf{x}_n\\}|^2$。这通过使用 NumPy 的广播功能高效完成。\n5.  **泄漏量化**：通过首先计算网格上功率的总和，然后计算以真实慢度 $\\mathbf{s}$ 为中心、半径为 $r_0 = \\pi / (2 \\omega L)$ 的圆盘内的功率总和，最后计算泄漏分数 $\\mathcal{L}_w = 1 - P_{\\text{in-lobe}} / P_{\\text{total}}$，来量化泄漏分数 $\\mathcal{L}_w$。\n6.  **输出生成**：收集所有四个案例的结果，并按规定格式化为单个输出字符串。\n\n该实现处理了所有单位转换，根据需要将慢度从秒/公里转换为秒/米，将频率从赫兹转换为弧度/秒。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the computational geophysics problem by performing derivation-based\n    validation and numerical simulation for four test cases.\n    \"\"\"\n\n    # --- Helper Functions ---\n\n    def analyze_case(stations, fs, f, s_true_skm):\n        \"\"\"\n        Processes a single test case.\n        \"\"\"\n        # --- 1. Unit Conversions and Initial Setup ---\n        N = stations.shape[0]\n        s_true_m = s_true_skm / 1000.0  # Convert s from s/km to s/m\n        omega = 2.0 * np.pi * f\n\n        # --- 2. Calculate Array Geometry ---\n        d_min = np.inf\n        L = 0.0\n        if N > 1:\n            indices = np.arange(N)\n            pair_indices = list(combinations(indices, 2))\n            i_indices = np.array([p[0] for p in pair_indices])\n            j_indices = np.array([p[1] for p in pair_indices])\n            baselines = stations[i_indices] - stations[j_indices]\n            dists = np.linalg.norm(baselines, axis=1)\n            d_min = np.min(dists)\n            L = np.max(dists)\n\n        centroid = np.mean(stations, axis=0)\n        radii = np.linalg.norm(stations - centroid, axis=1)\n        R = np.max(radii) if N > 0 else 0.0\n\n        # --- 3. Alias-Free Check ---\n        temporal_ok = f = fs / 2.0\n        s_true_mag_m = np.linalg.norm(s_true_m)\n        spatial_ok = True\n        if f > 0 and d_min > 0 and d_min != np.inf:\n            s_nyquist_mag = 1.0 / (2.0 * f * d_min)\n            spatial_ok = s_true_mag_m = s_nyquist_mag\n        \n        is_alias_free = temporal_ok and spatial_ok\n\n        # --- 4. Setup Slowness Grid for Beamforming ---\n        s_grid_1d_skm = np.linspace(-1.0, 1.0, 101)\n        s_grid_1d_m = s_grid_1d_skm / 1000.0\n        sx_prime_m, sy_prime_m = np.meshgrid(s_grid_1d_m, s_grid_1d_m, indexing='xy')\n        s_prime_grid_m = np.stack((sx_prime_m, sy_prime_m), axis=-1)\n\n        # --- 5. Compute Beam Power Maps ---\n        \n        def compute_beam_power(weights):\n            delta_s_grid = s_true_m - s_prime_grid_m # Shape (Gx, Gy, 2)\n            # einsum for batched dot product\n            # i,j are grid indices, k is spatial dim, n is station index\n            dot_products = np.einsum('ijk,nk->ijn', delta_s_grid, stations) # Shape (Gx, Gy, N)\n            \n            phasors = np.exp(-1j * omega * dot_products)\n            \n            # Weighted sum over stations\n            # weights shape (N,), needs to be broadcast for multiplication\n            beam = np.sum(weights[np.newaxis, np.newaxis, :] * phasors, axis=2) # Shape (Gx, Gy)\n            \n            power_map = np.abs(beam)**2\n            return power_map\n\n        # Rectangular weights\n        w_rect = np.ones(N)\n        power_rect = compute_beam_power(w_rect)\n\n        # Tapered weights\n        if R > 0:\n            r_n = radii / R\n        else: # Handle case of single station or all stations at centroid\n            r_n = np.zeros(N)\n        w_taper = 0.5 * (1.0 + np.cos(np.pi * r_n))\n        power_taper = compute_beam_power(w_taper)\n\n        # --- 6. Quantify Spectral Leakage ---\n        \n        def calculate_leakage(power_map):\n            if L == 0 or f == 0: return 0.0 # No meaningful aperture/frequency\n            \n            main_lobe_radius = np.pi / (2.0 * omega * L) # r0 = pi/(2*omega*L) = 1/(4*f*L)\n            \n            dist_from_true = np.linalg.norm(s_prime_grid_m - s_true_m, axis=-1)\n            in_lobe_mask = dist_from_true = main_lobe_radius\n            \n            power_in_lobe = np.sum(power_map[in_lobe_mask])\n            total_power = np.sum(power_map)\n            \n            if total_power == 0: return 0.0\n            \n            leakage_fraction = 1.0 - (power_in_lobe / total_power)\n            return leakage_fraction\n\n        L_rect = calculate_leakage(power_rect)\n        L_taper = calculate_leakage(power_taper)\n\n        return is_alias_free, L_rect, L_taper\n\n    # --- Test Case Definitions ---\n    \n    # Case A\n    N_A = 8\n    d_A = 1000.0\n    n_A = np.arange(N_A)\n    x_A = (n_A - (N_A - 1) / 2.0) * d_A\n    stations_A = np.stack([x_A, np.zeros(N_A)], axis=-1)\n    fs_A = 20.0\n    f_A = 1.0\n    s_true_A = np.array([0.25, 0.0])\n    \n    # Case B\n    stations_B = stations_A\n    fs_B = 20.0\n    f_B = 1.0\n    s_true_B = np.array([0.50, 0.0])\n\n    # Case C\n    stations_C = stations_A\n    fs_C = 50.0\n    f_C = 5.0\n    s_true_C = np.array([0.80, 0.0])\n\n    # Case D\n    stations_D = np.array([\n        [-1000., 0.], [0., 0.], [1000., 0.], [0., 1000.],\n        [-500., 500.], [500., 500.], [-500., -500.], [500., -500.],\n        [0., -1000.], [1000., 1000.]\n    ])\n    fs_D = 40.0\n    f_D = 3.0\n    s_mag_D_skm = 0.30\n    angle_D_rad = np.pi / 4.0\n    s_true_D = s_mag_D_skm * np.array([np.cos(angle_D_rad), np.sin(angle_D_rad)])\n\n    test_cases = [\n        (stations_A, fs_A, f_A, s_true_A),\n        (stations_B, fs_B, f_B, s_true_B),\n        (stations_C, fs_C, f_C, s_true_C),\n        (stations_D, fs_D, f_D, s_true_D),\n    ]\n\n    results = []\n    for case_params in test_cases:\n        b, L_rect, L_taper = analyze_case(*case_params)\n        results.extend([b, L_rect, L_taper])\n\n    # Final print statement in the exact required format.\n    # The str() on boolean gives 'True' or 'False' with capital first letter.\n    # The output format example [b_A, L_rect_A, ...] is symbolic.\n    # Default string conversion is the most reasonable interpretation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}