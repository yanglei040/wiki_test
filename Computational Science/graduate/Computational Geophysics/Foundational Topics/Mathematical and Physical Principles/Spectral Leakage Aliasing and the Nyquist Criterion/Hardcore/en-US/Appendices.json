{
    "hands_on_practices": [
        {
            "introduction": "Geophysical data analysis often involves distinguishing between different wave types propagating through a medium. However, our measurements are made with a finite number of sensors over a limited area, which introduces artifacts that can obscure the true wavefield. This first exercise provides a foundational look at two such critical artifacts: spectral leakage and aliasing. By simulating the sampling of two distinct guided-wave modes , you will directly quantify how sampling interval $\\Delta x$ can cause aliasing (folding of high wavenumbers) and how finite array length $L$ can cause spectral leakage (blurring), potentially making the modes unresolvable.",
            "id": "3614874",
            "problem": "You will analyze the spatial sampling of two guided-wave modes in a thin elastic layer by constructing their folded dispersion under spatial aliasing and quantifying spectral leakage in frequency-wavenumber analysis. The physical setup is a one-dimensional linear array of receivers sampling a superposition of two plane-wave modes that propagate in the layer. Each mode is modeled as nondispersive across the frequency band of interest, with a constant phase velocity. The continuous field is the real part of a sum of complex exponentials in space and time. The task is to reason from sampling theory to derive how spatial sampling with spacing that violates the Nyquist criterion folds the apparent wavenumbers and to quantify how finite-aperture windowing introduces spectral leakage that blurs ridges in frequency-wavenumber space.\n\nAssume the following foundations:\n- The continuous-time, continuous-space field is a superposition of two plane-wave modes, each of the form $u_m(x,t) = \\Re\\{A_m \\exp(i(k_m x - \\omega t))\\}$ for $m \\in \\{A,B\\}$ with angular frequency $\\omega$ and wavenumber $k_m$.\n- For this problem, the modes are nondispersive with phase velocities $v_A$ and $v_B$, so that $k_A = \\omega / v_A$ and $k_B = \\omega / v_B$ for any $\\omega$ in the band of interest.\n- Spatial sampling with spacing $\\Delta x$ yields a spatial Nyquist wavenumber $k_N = \\pi / \\Delta x$. The discretely sampled spatial spectrum equals the continuous spectrum replicated every $2\\pi/\\Delta x$ in wavenumber. Folded (aliased) wavenumbers must be mapped into the Nyquist interval $[-k_N,k_N]$.\n- A finite spatial aperture of length $L = N \\Delta x$ (rectangular window) multiplies the field by a window that has a Fourier transform proportional to $\\sin(k L/2)/(k/2)$, producing spectral leakage with a characteristic mainlobe between the first zeros and sidelobes. The mainlobe zero-to-zero width in wavenumber is $4\\pi/L$, and the offset to the first zero from the peak is $2\\pi/L$.\n\nImplement the following steps for each test case:\n1. Compute the true wavenumbers $k_A$ and $k_B$ at a target frequency $f_0$ (in hertz, so $\\omega_0 = 2\\pi f_0$), using $k = \\omega / v$. Express all wavenumbers in radians per meter.\n2. Map each true wavenumber to its folded value in the Nyquist interval $[-k_N,k_N]$ implied by spatial sampling with spacing $\\Delta x$. Declare a mode to be spatially aliased if $|k|  k_N$ before folding. The folded value is defined as the unique representative of the equivalence class $k + m \\cdot (2\\pi/\\Delta x)$ with integer $m$ that lies in $[-k_N,k_N]$.\n3. Quantify the separation between the two modes in the folded domain as $\\Delta k_{\\mathrm{fold}} = |k_{A,\\mathrm{fold}} - k_{B,\\mathrm{fold}}|$.\n4. Quantify the spectral leakage blur from the rectangular spatial window by the Rayleigh-like resolvability criterion: declare the two modes spatially resolvable in wavenumber at $f_0$ if $\\Delta k_{\\mathrm{fold}} \\ge 2\\pi / L$; otherwise, declare them unresolvable. Additionally, quantify the leakage amplitude ratio at the location of one mode due to the other as $r = \\left|\\frac{\\sin(\\Delta k_{\\mathrm{fold}} L / 2)}{\\Delta k_{\\mathrm{fold}} L / 2}\\right|$ (use the normalized sinc envelope of the rectangular window).\n5. To demonstrate aliasing across a band, for mode $B$ only, evaluate the aliasing condition across a frequency grid and count how many grid frequencies are aliased. Use the grid $f \\in \\{50, 100, 150, 200, 250, 300, 350, 400\\}$ (all in hertz), with the same definition of aliasing as in step $2$. Report this count as an integer.\n6. Ensure temporal sampling does not alias by using $\\Delta t$ and $N_t$ for which the temporal Nyquist frequency $f_{N,t} = 1/(2\\Delta t)$ exceeds the maximum grid frequency. You do not need to compute any temporal folding in this task; use these temporal parameters only to maintain scientific realism.\n\nUse the following fixed physical parameters for all test cases:\n- Mode phase velocities: $v_A = 2000 \\ \\mathrm{m/s}$ and $v_B = 1200 \\ \\mathrm{m/s}$.\n- Target frequency: $f_0 = 200 \\ \\mathrm{Hz}$, so $\\omega_0 = 2\\pi f_0$.\n- Units: distances in meters, times in seconds, wavenumbers in radians per meter, and angular frequencies in radians per second. All angles must be treated in radians.\n\nUse the following test suite of four cases, covering a nominal case, a strong aliasing case, a Nyquist-boundary case, and a leakage-dominated case:\n- Case $1$: $\\Delta x = 1.0$, $N = 64$, $\\Delta t = 0.001$, $N_t = 1024$.\n- Case $2$: $\\Delta x = 3.2$, $N = 32$, $\\Delta t = 0.001$, $N_t = 1024$.\n- Case $3$: $\\Delta x = 3.0$, $N = 32$, $\\Delta t = 0.001$, $N_t = 1024$.\n- Case $4$: $\\Delta x = 1.0$, $N = 8$, $\\Delta t = 0.001$, $N_t = 512$.\n\nFor each case, your program must compute and return a list with the following entries in order:\n- The folded wavenumber $k_{A,\\mathrm{fold}}$ at $f_0$ (float, in radians per meter).\n- The folded wavenumber $k_{B,\\mathrm{fold}}$ at $f_0$ (float, in radians per meter).\n- The resolvability flag at $f_0$ defined by $\\Delta k_{\\mathrm{fold}} \\ge 2\\pi/L$ (integer $1$ for resolvable, $0$ for unresolvable).\n- The aliasing flag at $f_0$ for either mode (integer $1$ if any of $A$ or $B$ is aliased, $0$ otherwise).\n- The leakage amplitude ratio $r$ at $f_0$ based on the rectangular window (float, unitless).\n- The alias count for mode $B$ across the specified frequency grid (integer).\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of per-case lists, enclosed in square brackets. Floats must be rounded to $6$ decimal places. For example, a valid output would look like: \"[[a,b,c,d,e,f],[...],[...],[...]]\" where $a,b,\\dots$ are the requested entries for each case in the specified order.",
            "solution": "The user-provided problem has been rigorously validated and is determined to be **valid**. It is scientifically grounded in the principles of wave propagation and digital signal processing, is well-posed with a complete and consistent set of definitions and parameters, and is expressed in objective, formal language. The problem is directly relevant to the topic of spectral analysis in computational geophysics. All conditions for a valid problem are met.\n\nThe solution proceeds by applying established principles of sampling theory and Fourier analysis to the provided test cases. The core concepts are wave kinematics, spatial aliasing, and spectral leakage due to finite-aperture windowing.\n\nFirst, we establish the physical context. The propagating field is a superposition of two nondispersive plane waves. For a given angular frequency $\\omega$, the true wavenumbers of mode $A$ and mode $B$, denoted $k_A$ and $k_B$, are determined by the linear dispersion relation $k = \\omega/v$. The phase velocities are given as $v_A = 2000 \\ \\mathrm{m/s}$ and $v_B = 1200 \\ \\mathrm{m/s}$. For the target frequency $f_0 = 200 \\ \\mathrm{Hz}$, the angular frequency is $\\omega_0 = 2\\pi f_0 = 400\\pi \\ \\mathrm{rad/s}$.\nThe true wavenumbers are thus:\n$$k_A = \\frac{\\omega_0}{v_A} = \\frac{400\\pi}{2000} = \\frac{\\pi}{5} \\ \\mathrm{rad/m} \\approx 0.628319 \\ \\mathrm{rad/m}$$\n$$k_B = \\frac{\\omega_0}{v_B} = \\frac{400\\pi}{1200} = \\frac{\\pi}{3} \\ \\mathrm{rad/m} \\approx 1.047198 \\ \\mathrm{rad/m}$$\nThese values are constant for all test cases at the target frequency $f_0$.\n\nThe subsequent calculations for each test case depend on the sampling parameters $\\Delta x$ and $N$.\n\n1.  **Spatial Sampling, the Nyquist Criterion, and Aliasing**:\n    When a continuous spatial signal is sampled at intervals of $\\Delta x$, the resulting discrete-wavenumber spectrum is periodic with a period of $k_S = 2\\pi/\\Delta x$. Any information about wavenumbers with magnitude greater than the Nyquist wavenumber, $k_N = \\pi/\\Delta x$, is \"folded\" into the principal Nyquist interval $[-k_N, k_N]$. A mode with true wavenumber $k$ is declared spatially aliased if $|k|  k_N$.\n    The folded wavenumber, $k_{\\mathrm{fold}}$, corresponding to a true wavenumber $k$, is the unique value in the interval $[-k_N, k_N]$ such that $k_{\\mathrm{fold}} = k + m \\cdot (2\\pi/\\Delta x)$ for some integer $m$. A computationally robust method to find $k_{\\mathrm{fold}}$ is to map the spatial phase $k \\Delta x$ to the interval $[-\\pi, \\pi]$ and then divide by $\\Delta x$. This operation is equivalent to $k_{\\mathrm{fold}} = \\frac{1}{\\Delta x} \\mathrm{atan2}(\\sin(k\\Delta x), \\cos(k\\Delta x))$. For each case, we compute $k_N$ from $\\Delta x$ and then determine $k_{A,\\mathrm{fold}}$, $k_{B,\\mathrm{fold}}$, and whether either mode is aliased at $f_0 = 200 \\ \\mathrm{Hz}$.\n\n2.  **Spectral Leakage and Resolvability**:\n    Observing the wavefield over a finite spatial aperture of length $L=N\\Delta x$ is equivalent to multiplying the infinite signal by a rectangular window function. In the wavenumber domain, this corresponds to convolving the true spectrum (a pair of Dirac delta functions at $k_A$ and $k_B$) with the Fourier transform of the rectangular window. The window's transform is a sinc function, given by $\\mathrm{sinc}(kL/2) = \\sin(k L/2)/(k L/2)$, scaled by $L$. This convolution replaces the sharp spectral peaks with sinc-shaped patterns, an effect known as spectral leakage. The mainlobe of the sinc function has a zero-to-zero width of $4\\pi/L$.\n    The Rayleigh criterion for resolvability, adapted for this context, states that two spectral peaks are resolvable if their separation is at least half the mainlobe width, which is the distance from the peak to the first zero of the sinc function. Thus, the two modes are considered resolvable if their separation in the folded domain, $\\Delta k_{\\mathrm{fold}} = |k_{A,\\mathrm{fold}} - k_{B,\\mathrm{fold}}|$, satisfies the condition:\n    $$\\Delta k_{\\mathrm{fold}} \\ge \\frac{2\\pi}{L}$$\n    The leakage amplitude ratio, $r$, quantifies the amplitude of the sinc function from one mode at the wavenumber of the other. It is given by:\n    $$r = \\left|\\frac{\\sin(\\Delta k_{\\mathrm{fold}} L / 2)}{\\Delta k_{\\mathrm{fold}} L / 2}\\right|$$\n    If $\\Delta k_{\\mathrm{fold}} = 0$, the ratio approaches its limit of $1$.\n\n3.  **Aliasing Across a Frequency Band**:\n    The aliasing condition, $|k|  k_N$, is frequency-dependent because $k$ itself is frequency-dependent. For mode $B$, the condition is $k_B(f)  k_N$, which translates to $(2\\pi f / v_B)  (\\pi / \\Delta x)$, or $f  v_B/(2\\Delta x)$. We test this inequality for each frequency in the provided grid $f \\in \\{50, 100, \\dots, 400\\} \\ \\mathrm{Hz}$ and count the number of frequencies for which mode $B$ is aliased.\n\nThese steps are executed for each test case using the specified parameters.\n\nThe temporal sampling parameter, $\\Delta t = 0.001 \\ \\mathrm{s}$, yields a temporal Nyquist frequency of $f_{N,t} = 1/(2\\Delta t) = 500 \\ \\mathrm{Hz}$. Since the maximum frequency considered is $400 \\ \\mathrm{Hz}$, temporal aliasing is not a concern, confirming the scientific realism of the setup as requested.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes spatial sampling of two guided-wave modes to quantify\n    aliasing and spectral leakage.\n    \"\"\"\n    # Fixed physical parameters\n    v_A = 2000.0  # m/s\n    v_B = 1200.0  # m/s\n    f0 = 200.0    # Hz\n    omega0 = 2 * np.pi * f0\n\n    # Frequency grid for aliasing count\n    freq_grid = np.arange(50, 401, 50)\n\n    # Test suite\n    test_cases = [\n        # (dx, N, dt, Nt)\n        (1.0, 64, 0.001, 1024),\n        (3.2, 32, 0.001, 1024),\n        (3.0, 32, 0.001, 1024),\n        (1.0, 8, 0.001, 512),\n    ]\n\n    all_results = []\n\n    # True wavenumbers at f0\n    k_A_true = omega0 / v_A\n    k_B_true = omega0 / v_B\n\n    for case in test_cases:\n        dx, N, _, _ = case\n\n        # --- Step 0: Setup for the current case ---\n        k_N = np.pi / dx\n        L = N * dx\n\n        # --- Step 1  2: True and folded wavenumbers, and aliasing flag at f0 ---\n\n        # A robust function to fold wavenumber k into [-k_N, k_N]\n        def fold_wavenumber(k, delta_x):\n            # The phase k*delta_x is wrapped to [-pi, pi], then scaled back.\n            return np.angle(np.exp(1j * k * delta_x)) / delta_x\n\n        k_A_fold = fold_wavenumber(k_A_true, dx)\n        k_B_fold = fold_wavenumber(k_B_true, dx)\n        \n        # Check for aliasing: |k|  k_N\n        is_A_aliased = np.abs(k_A_true)  k_N\n        is_B_aliased = np.abs(k_B_true)  k_N\n        aliased_flag = 1 if is_A_aliased or is_B_aliased else 0\n\n        # --- Step 3: Separation in folded domain ---\n        delta_k_fold = np.abs(k_A_fold - k_B_fold)\n\n        # --- Step 4: Resolvability and leakage ratio ---\n        # Rayleigh-like resolution criterion\n        k_res_limit = 2 * np.pi / L\n        resolvable_flag = 1 if delta_k_fold = k_res_limit else 0\n\n        # Leakage amplitude ratio using the unnormalized sinc function\n        # formula: r = |sin(x)/x| where x = delta_k_fold * L / 2\n        # Use np.sinc(y) which is sin(pi*y)/(pi*y), so we set y = x/pi\n        x = delta_k_fold * L / 2.0\n        if np.isclose(x, 0.0):\n            leakage_ratio = 1.0\n        else:\n            # np.sinc computes sin(pi*y)/(pi*y). We want sin(x)/x.\n            # Let x = pi*y, so y = x/pi.\n            leakage_ratio = np.abs(np.sinc(x / np.pi))\n\n        # --- Step 5: Alias count for mode B across the frequency grid ---\n        alias_count = 0\n        for f in freq_grid:\n            omega = 2 * np.pi * f\n            k_B_freq = omega / v_B\n            if np.abs(k_B_freq)  k_N:\n                alias_count += 1\n        \n        # Assemble results for the current case\n        case_results = [\n            k_A_fold,\n            k_B_fold,\n            resolvable_flag,\n            aliased_flag,\n            leakage_ratio,\n            alias_count\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified\n    outer_list_str = []\n    for res_case in all_results:\n        inner_list_str = []\n        for item in res_case:\n            if isinstance(item, float):\n                inner_list_str.append(f\"{item:.6f}\")\n            else:\n                inner_list_str.append(str(item))\n        outer_list_str.append(f\"[{','.join(inner_list_str)}]\")\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the one-dimensional case, we now extend our analysis to the two-dimensional grids typical of 3D seismic surveys. In 2D, the Nyquist criterion is no longer a single number but a region in the wavenumber plane, and aliasing depends on both the sampling grid and the direction of wave propagation. This practice challenges you to derive the alias-free conditions for a standard rectangular acquisition grid by considering the maximum dip angle $\\theta_{\\max}$ of expected signals . You will also explore how non-isotropic aliasing behavior arises and investigate more efficient sampling strategies, such as hexagonal grids, that can improve data quality for the same number of sensors.",
            "id": "3614831",
            "problem": "You are given a two-dimensional spatial sampling problem motivated by three-dimensional acquisition with orthogonal survey lines. A scalar wavefield $u(x,y,t)$ in a homogeneous medium of constant phase velocity $v$ is assumed to be a superposition of plane waves of the form $u(x,y,t)=\\Re\\{\\exp(i(\\omega t - k_x x - k_y y))\\}$, where $\\omega$ is angular frequency and $(k_x,k_y)$ are spatial angular wavenumbers. The acquisition samples $u$ on a uniform rectangular lattice with spacings $\\Delta x$ and $\\Delta y$ along $x$ and $y$, respectively. The sampling theorem states that sampling replicates the continuous spatial spectrum by shifts at the nodes of the reciprocal lattice. For a rectangular lattice, the reciprocal lattice shifts occur at $(2\\pi n_x/\\Delta x,2\\pi n_y/\\Delta y)$ for integers $n_x,n_y$, and the baseband (Nyquist) region is the rectangle $|k_x|\\le \\pi/\\Delta x$, $|k_y|\\le \\pi/\\Delta y$. A hexagonal (triangular) sampling lattice in the spatial domain has a hexagonal baseband in the spatial wavenumber domain whose inscribed circle has a larger radius than that of a rectangular lattice of equal sampling density.\n\nAssume the wavefield has a maximum dip $\\theta_{\\max}$ measured from the vertical axis so that the horizontal wavenumber magnitude at frequency $f=\\omega/(2\\pi)$ is bounded by $k_h(f)=\\|\\,(k_x,k_y)\\,\\|_2 \\le (\\omega/v)\\sin\\theta_{\\max}=(2\\pi f/v)\\sin\\theta_{\\max}$. Aliasing occurs if the support of the horizontal wavenumber magnitudes at a given $f$ does not fit inside the baseband for all propagation directions in the $(k_x,k_y)$-plane.\n\nYour tasks:\n\n- Starting only from the definitions in the paragraph above, derive the two-dimensional Nyquist constraints in the $(k_x,k_y)$-plane for a rectangular lattice in terms of $\\Delta x$ and $\\Delta y$. Then, using the dip bound, derive formulas for the maximum alias-free frequency along:\n  - the side-limited condition where the circle $k_h(f)=\\text{const}$ first touches a side of the Nyquist rectangle, and\n  - the corner-limited condition where $k_h(f)$ reaches the rectangle corner at $(\\pi/\\Delta x,\\pi/\\Delta y)$.\n  Express both frequencies as functions of $v$, $\\theta_{\\max}$, $\\Delta x$, and $\\Delta y$, and use $f$ in $\\mathrm{Hz}$, $v$ in $\\mathrm{m/s}$, and $\\Delta x,\\Delta y$ in $\\mathrm{m}$.\n\n- Simulate first-order alias replicas at the corner-limited frequency by placing a monochromatic plane wave with horizontal wavenumber vector $k_0$ at the corner direction, i.e., $k_0$ has magnitude $r_{\\mathrm{corner}}=\\sqrt{(\\pi/\\Delta x)^2+(\\pi/\\Delta y)^2}$ and angle $\\phi_{\\mathrm{corner}}=\\arctan2(\\pi/\\Delta y,\\pi/\\Delta x)$ so that $k_0=(r_{\\mathrm{corner}}\\cos\\phi_{\\mathrm{corner}},r_{\\mathrm{corner}}\\sin\\phi_{\\mathrm{corner}})$. Count how many shifted replicas $k_0-G$ with $G=(2\\pi n_x/\\Delta x,2\\pi n_y/\\Delta y)$ for $n_x,n_y\\in\\{-1,0,1\\}$, $(n_x,n_y)\\neq(0,0)$ fall inside or on the boundary of the rectangular baseband $|k_x|\\le \\pi/\\Delta x$, $|k_y|\\le \\pi/\\Delta y$.\n\n- For a hexagonal sampling lattice of equal sampling density $\\rho$ (samples per unit area) to a rectangular lattice with spacings $\\Delta x,\\Delta y$ (so $\\rho=1/(\\Delta x\\Delta y)$), the isotropic alias-free radius $r_{\\mathrm{iso,hex}}$ of the baseband is larger than that of a square rectangular lattice of the same density. Under the same $\\rho$, compute the isotropic Nyquist circle radius for the square rectangular lattice, $r_{\\mathrm{iso,rect(density)}}$, and for the hexagonal lattice, $r_{\\mathrm{iso,hex(density)}}$, and the improvement factor $r_{\\mathrm{iso,hex(density)}}/r_{\\mathrm{iso,rect(density)}}$. Additionally, test whether the hexagonal lattice at equal density would be alias-free at the supplied $f_{\\max}$ and $\\theta_{\\max}$ by comparing $k_h(f_{\\max})$ to $r_{\\mathrm{iso,hex(density)}}$.\n\nAngle must be expressed in radians, and all final frequency quantities must be expressed in $\\mathrm{Hz}$.\n\nProgram requirements:\n\n- Implement a program that, for each test case, computes:\n  - a boolean indicating whether rectangular sampling is alias-free at $f_{\\max}$ and $\\theta_{\\max}$,\n  - a boolean indicating whether hexagonal sampling of equal density would be alias-free at $f_{\\max}$ and $\\theta_{\\max}$,\n  - the side-limited maximum alias-free frequency in $\\mathrm{Hz}$,\n  - the corner-limited maximum alias-free frequency in $\\mathrm{Hz}$,\n  - the integer count of first-order alias replicas that fall inside or on the baseband at the corner-limited horizontal wavenumber,\n  - the improvement factor $r_{\\mathrm{iso,hex(density)}}/r_{\\mathrm{iso,rect(density)}}$ as a float.\n- Your program should produce a single line of output containing the results aggregated for all test cases as a comma-separated list enclosed in square brackets, with entries ordered by test case, and within each test case in the order listed above.\n\nTest suite:\n\n- Test case $1$: $\\Delta x=12.5\\,\\mathrm{m}$, $\\Delta y=25.0\\,\\mathrm{m}$, $v=2000.0\\,\\mathrm{m/s}$, $f_{\\max}=60.0\\,\\mathrm{Hz}$, $\\theta_{\\max}=0.610865238198\\,\\mathrm{rad}$.\n- Test case $2$ (boundary condition): $\\Delta x=10.0\\,\\mathrm{m}$, $\\Delta y=10.0\\,\\mathrm{m}$, $v=1500.0\\,\\mathrm{m/s}$, $f_{\\max}=86.6025403784\\,\\mathrm{Hz}$, $\\theta_{\\max}=1.0471975512\\,\\mathrm{rad}$.\n- Test case $3$ (strong dip, aliasing expected): $\\Delta x=25.0\\,\\mathrm{m}$, $\\Delta y=25.0\\,\\mathrm{m}$, $v=2500.0\\,\\mathrm{m/s}$, $f_{\\max}=100.0\\,\\mathrm{Hz}$, $\\theta_{\\max}=1.3962634016\\,\\mathrm{rad}$.",
            "solution": "The problem requires the derivation of Nyquist-related sampling constraints for geophysical data acquisition and the implementation of these derivations in a program to evaluate several test cases. The analysis will proceed in three parts: first, deriving the alias-free frequency limits for a rectangular sampling lattice; second, determining the number of aliased replicas for a specific corner-case scenario; and third, comparing the efficiency of rectangular versus hexagonal sampling lattices.\n\n### Two-Dimensional Nyquist Constraints for a Rectangular Lattice\n\nA scalar wavefield, $u(x,y,t)$, is sampled on a uniform rectangular grid with spacings $\\Delta x$ and $\\Delta y$. According to the Nyquist-Shannon sampling theorem, this spatial sampling operation causes the continuous spatial spectrum of the wavefield, $U(k_x, k_y)$, to be replicated at the nodes of the reciprocal lattice. For a rectangular sampling grid, these replicas are centered at integer multiples of the reciprocal lattice vectors, i.e., at locations $(2\\pi n_x/\\Delta x, 2\\pi n_y/\\Delta y)$ for integers $n_x, n_y$.\n\nTo avoid aliasing, the original, un-replicated spectrum (the baseband spectrum) must be entirely contained within the first Brillouin zone, also known as the Nyquist zone. For a rectangular lattice, this zone is a rectangle in the wavenumber domain defined by:\n$$ |k_x| \\le k_{x,\\text{Ny}} = \\frac{\\pi}{\\Delta x} $$\n$$ |k_y| \\le k_{y,\\text{Ny}} = \\frac{\\pi}{\\Delta y} $$\n\nThe problem states that the wavefield's energy at a given temporal frequency $f$ is contained within a circle in the $(k_x, k_y)$-plane. The radius of this circle represents the maximum horizontal wavenumber, $k_h(f)$, and is given by the dispersion relation and the maximum dip angle $\\theta_{\\max}$:\n$$ k_h(f) = \\sqrt{k_x^2 + k_y^2} \\le \\frac{\\omega}{v} \\sin\\theta_{\\max} = \\frac{2\\pi f}{v} \\sin\\theta_{\\max} $$\nwhere $v$ is the phase velocity.\n\nFor the wavefield to be sampled without aliasing, this circle of spectral support must fit entirely inside the rectangular Nyquist zone.\n\n#### Side-Limited Maximum Alias-Free Frequency\n\nThe most restrictive condition for fitting a circle inside a rectangle is determined by the rectangle's shorter side. The half-widths of the Nyquist rectangle are $\\pi/\\Delta x$ and $\\pi/\\Delta y$. The radius of the largest inscribed circle is therefore $\\min(\\pi/\\Delta x, \\pi/\\Delta y)$. This condition is termed \"side-limited\" because the circle first touches the sides corresponding to the larger sampling interval (e.g., if $\\Delta y  \\Delta x$, the rectangle is narrower in the $k_y$ direction, and the circle first touches the sides at $k_y = \\pm \\pi/\\Delta y$).\n\nTo prevent aliasing under all possible propagation directions (i.e., for an isotropic spectrum), the wavenumber radius $k_h(f)$ must be no larger than this inscribed circle's radius:\n$$ k_h(f) \\le \\min\\left(\\frac{\\pi}{\\Delta x}, \\frac{\\pi}{\\Delta y}\\right) = \\frac{\\pi}{\\max(\\Delta x, \\Delta y)} $$\nSubstituting the expression for $k_h(f)$, we can solve for the maximum alias-free frequency, $f_{\\text{side-limited}}$:\n$$ \\frac{2\\pi f_{\\text{side-limited}}}{v} \\sin\\theta_{\\max} = \\frac{\\pi}{\\max(\\Delta x, \\Delta y)} $$\n$$ f_{\\text{side-limited}} = \\frac{v}{2 \\sin\\theta_{\\max} \\max(\\Delta x, \\Delta y)} $$\n\n#### Corner-Limited Maximum Alias-Free Frequency\n\nA less strict condition allows the circular spectrum to expand until it touches the corners of the Nyquist rectangle. This defines the absolute maximum wavenumber magnitude that can be represented without aliasing for any specific direction within the baseband. The distance from the origin to a corner of the Nyquist rectangle $(\\pm\\pi/\\Delta x, \\pm\\pi/\\Delta y)$ is given by the Pythagorean theorem:\n$$ r_{\\text{corner}} = \\sqrt{\\left(\\frac{\\pi}{\\Delta x}\\right)^2 + \\left(\\frac{\\pi}{\\Delta y}\\right)^2} = \\pi \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}} $$\nThe corner-limited frequency, $f_{\\text{corner-limited}}$, is the frequency at which the spectral circle's radius equals this corner distance:\n$$ \\frac{2\\pi f_{\\text{corner-limited}}}{v} \\sin\\theta_{\\max} = r_{\\text{corner}} $$\n$$ f_{\\text{corner-limited}} = \\frac{v}{2\\pi \\sin\\theta_{\\max}} \\left(\\pi \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}}\\right) = \\frac{v}{2 \\sin\\theta_{\\max}} \\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}} $$\n\n### Analysis of First-Order Alias Replicas\n\nThe problem asks to consider a monochromatic plane wave whose wavenumber vector $k_0$ lies exactly at a corner of the Nyquist rectangle, specifically $k_0 = (\\pi/\\Delta x, \\pi/\\Delta y)$. We are to count how many of the eight nearest-neighbor alias replicas fall within or on the boundary of the baseband region $|k_x| \\le \\pi/\\Delta x, |k_y| \\le \\pi/\\Delta y$.\n\nThe locations of the replicas are given by $k' = k_0 - G$, where $G = (2\\pi n_x/\\Delta x, 2\\pi n_y/\\Delta y)$ are the vectors to the centers of the replicated spectra, with $n_x, n_y \\in \\{-1, 0, 1\\}$ and $(n_x, n_y) \\neq (0, 0)$.\n\nA replica $k' = (k'_x, k'_y)$ is located at:\n$$ k'_x = \\frac{\\pi}{\\Delta x} - \\frac{2\\pi n_x}{\\Delta x} = \\frac{\\pi}{\\Delta x}(1 - 2n_x) $$\n$$ k'_y = \\frac{\\pi}{\\Delta y} - \\frac{2\\pi n_y}{\\Delta y} = \\frac{\\pi}{\\Delta y}(1 - 2n_y) $$\n\nWe test the condition $|k'_x| \\le \\pi/\\Delta x$ and $|k'_y| \\le \\pi/\\Delta y$:\n1.  For the $k_x$ component: $|\\frac{\\pi}{\\Delta x}(1 - 2n_x)| \\le \\frac{\\pi}{\\Delta x} \\implies |1 - 2n_x| \\le 1$.\n    - If $n_x = -1$, $|1 - 2(-1)| = |3| = 3$, which is not $\\le 1$.\n    - If $n_x = 0$, $|1 - 2(0)| = |1| = 1$, which is $\\le 1$.\n    - If $n_x = 1$, $|1 - 2(1)| = |-1| = 1$, which is $\\le 1$.\n    Thus, for the $k_x$ component to be within the baseband, $n_x$ must be $0$ or $1$.\n\n2.  For the $k_y$ component: $|\\frac{\\pi}{\\Delta y}(1 - 2n_y)| \\le \\frac{\\pi}{\\Delta y} \\implies |1 - 2n_y| \\le 1$.\n    By symmetry, for the $k_y$ component to be within the baseband, $n_y$ must be $0$ or $1$.\n\nWe need to find the pairs $(n_x, n_y)$ from the set $\\{-1, 0, 1\\}^2 \\setminus \\{(0, 0)\\}$ that satisfy $n_x \\in \\{0, 1\\}$ and $n_y \\in \\{0, 1\\}$. The pairs are:\n- $(0, 1)$\n- $(1, 0)$\n- $(1, 1)$\n\nThese three pairs correspond to replicas that land on the boundaries of the baseband. Therefore, there are exactly $3$ such first-order alias replicas. This count is a constant, independent of the specific values of $\\Delta x$ and $\\Delta y$.\n\n### Comparison with Hexagonal Sampling\n\nFor a fair comparison between sampling geometries, we consider lattices with equal sampling density, $\\rho$. For the given rectangular lattice, $\\rho = 1/(\\Delta x \\Delta y)$.\n\nFor a square lattice with side length $\\Delta s$ and the same density, we have $1/(\\Delta s)^2 = \\rho$, so $\\Delta s = 1/\\sqrt{\\rho} = \\sqrt{\\Delta x \\Delta y}$. The Nyquist zone is a square, and its largest inscribed circle (the isotropic alias-free region) has a radius:\n$$ r_{\\text{iso,rect(density)}} = \\frac{\\pi}{\\Delta s} = \\frac{\\pi}{\\sqrt{\\Delta x \\Delta y}} $$\n\nFor a regular hexagonal lattice with spacing $a$ between points, the sampling density is $\\rho = 2/(a^2 \\sqrt{3})$. Equating densities gives $a^2 = 2/(\\rho\\sqrt{3}) = 2\\Delta x \\Delta y/\\sqrt{3}$. The baseband (first Brillouin zone) of a hexagonal lattice is a hexagon in the wavenumber domain. The radius of its inscribed circle, which represents the isotropic alias-free region, is $r_{\\text{iso,hex}} = 2\\pi/(a\\sqrt{3})$. Substituting $a$:\n$$ r_{\\text{iso,hex(density)}} = \\frac{2\\pi}{\\sqrt{3}} \\sqrt{\\frac{\\sqrt{3}}{2\\Delta x \\Delta y}} = \\pi \\sqrt{\\frac{4\\sqrt{3}}{3 \\cdot 2\\Delta x \\Delta y}} = \\pi \\sqrt{\\frac{2\\sqrt{3}}{3\\Delta x \\Delta y}} $$\nThe improvement factor of hexagonal over square sampling (at equal density) is the ratio of their isotropic Nyquist radii:\n$$ \\frac{r_{\\text{iso,hex(density)}}}{r_{\\text{iso,rect(density)}}} = \\frac{\\pi \\sqrt{\\frac{2\\sqrt{3}}{3\\Delta x \\Delta y}}}{\\frac{\\pi}{\\sqrt{\\Delta x \\Delta y}}} = \\sqrt{\\frac{2\\sqrt{3}}{3}} = \\sqrt{\\frac{2}{\\sqrt{3}}} \\approx 1.07457 $$\nThis constant factor represents an approximate $7.5\\%$ increase in the maximum alias-free wavenumber (and thus frequency) for isotropic signals.\n\nTo test whether hexagonal sampling is alias-free for a given $f_{\\max}$ and $\\theta_{\\max}$, we compare the signal's maximum horizontal wavenumber $k_h(f_{\\max})$ with the hexagonal lattice's isotropic Nyquist radius $r_{\\text{iso,hex(density)}}$. The condition for being alias-free is $k_h(f_{\\max}) \\le r_{\\text{iso,hex(density)}}$.\n\n### Algorithm Summary\n\nFor each test case $(\\Delta x, \\Delta y, v, f_{\\max}, \\theta_{\\max})$:\n1.  Calculate the maximum horizontal wavenumber of the signal: $k_{h,\\max} = (2\\pi f_{\\max}/v)\\sin\\theta_{\\max}$.\n2.  **Rectangular alias-free check**: Determine if $k_{h,\\max} \\le \\min(\\pi/\\Delta x, \\pi/\\Delta y)$. This yields a boolean result.\n3.  **Hexagonal alias-free check**: Calculate $r_{\\text{iso,hex(density)}} = \\pi\\sqrt{2\\sqrt{3}/(3\\Delta x \\Delta y)}$ and determine if $k_{h,\\max} \\le r_{\\text{iso,hex(density)}}$. This yields a boolean result.\n4.  **Side-limited frequency**: Calculate $f_{\\text{side-limited}} = v / (2 \\sin\\theta_{\\max} \\max(\\Delta x, \\Delta y))$.\n5.  **Corner-limited frequency**: Calculate $f_{\\text{corner-limited}} = (v / (2 \\sin\\theta_{\\max})) \\sqrt{1/(\\Delta x)^2 + 1/(\\Delta y)^2}$.\n6.  **Alias replica count**: This is a constant value of $3$.\n7.  **Improvement factor**: This is a constant value of $\\sqrt{2/\\sqrt{3}}$.\nThese six results are computed and formatted for each test case as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the spatial sampling problem for the given test cases.\n\n    For each test case, it computes:\n    1. A boolean indicating if rectangular sampling is alias-free.\n    2. A boolean indicating if hexagonal sampling of equal density is alias-free.\n    3. The side-limited maximum alias-free frequency (Hz).\n    4. The corner-limited maximum alias-free frequency (Hz).\n    5. The count of first-order alias replicas in a corner-case scenario.\n    6. The improvement factor of hexagonal over square-grid sampling.\n    \"\"\"\n    \n    # Test cases: (delta_x, delta_y, v, f_max, theta_max)\n    test_cases = [\n        # Test case 1\n        (12.5, 25.0, 2000.0, 60.0, 0.610865238198),\n        # Test case 2 (boundary condition)\n        (10.0, 10.0, 1500.0, 86.6025403784, 1.0471975512),\n        # Test case 3 (strong dip, aliasing expected)\n        (25.0, 25.0, 2500.0, 100.0, 1.3962634016),\n    ]\n\n    all_results = []\n    \n    # Pre-compute constant values\n    # Number of first-order alias replicas inside the baseband\n    # for a monochromatic wave at a Nyquist corner.\n    alias_replica_count = 3\n    \n    # Improvement factor of hexagonal vs. square lattice of same density.\n    # r_iso_hex / r_iso_rect = sqrt( (2*sqrt(3)/3) ) = sqrt(2/sqrt(3))\n    improvement_factor = np.sqrt(2 / np.sqrt(3))\n\n    for case in test_cases:\n        dx, dy, v, f_max, theta_max = case\n        \n        # Calculate the maximum horizontal wavenumber for the given signal parameters\n        sin_theta_max = np.sin(theta_max)\n        k_h_max = (2 * np.pi * f_max / v) * sin_theta_max\n\n        # 1. Check for aliasing with rectangular sampling\n        # Alias-free if spectral circle fits within the Nyquist rectangle,\n        # which means its radius must be smaller than the smallest half-dimension.\n        k_ny_rect_min = np.pi / max(dx, dy)\n        is_rect_alias_free = k_h_max = k_ny_rect_min\n        \n        # 2. Check for aliasing with hexagonal sampling of equal density\n        # Calculate the isotropic Nyquist radius for the equivalent hexagonal lattice\n        rho = 1.0 / (dx * dy)\n        # r_iso_hex^2 = (pi^2 * 2 * sqrt(3)) / (3 * dx * dy)\n        r_iso_hex_sq = (np.pi**2 * 2 * np.sqrt(3)) / (3 * dx * dy)\n        r_iso_hex = np.sqrt(r_iso_hex_sq)\n        is_hex_alias_free = k_h_max = r_iso_hex\n        \n        # 3. Calculate side-limited maximum alias-free frequency\n        # This corresponds to the isotropic alias-free condition for rectangular grid.\n        f_side_limited = v / (2 * sin_theta_max * max(dx, dy))\n        \n        # 4. Calculate corner-limited maximum alias-free frequency\n        # This corresponds to the wavenumber circle touching the Nyquist corners.\n        f_corner_limited = (v / (2 * sin_theta_max)) * np.sqrt(1/dx**2 + 1/dy**2)\n        \n        # 5. Alias replica count (constant derived in the solution)\n        # This is already pre-computed as alias_replica_count.\n        \n        # 6. Improvement factor (constant derived in the solution)\n        # This is already pre-computed as improvement_factor.\n        \n        # Aggregate results for this case\n        case_results = [\n            is_rect_alias_free,\n            is_hex_alias_free,\n            f_side_limited,\n            f_corner_limited,\n            alias_replica_count,\n            improvement_factor\n        ]\n        all_results.extend(case_results)\n\n    # Format output as a single comma-separated list string\n    # E.g., [True,True,69.738...,...,False,False,...]\n    # The default str() for booleans is 'True'/'False' with capitalization.\n    results_str = ','.join(map(str, all_results))\n    \n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Our focus now shifts from acquisition design to a core data processing technique: array beamforming. This method allows us to scan for signals arriving from different directions and with different speeds by analyzing the phase delays across an array of sensors. This final exercise translates the concepts of aliasing and leakage into the slowness domain $(\\mathbf{s}, \\omega)$, which is natural for beamforming analysis . You will derive the aliasing conditions for an arbitrary array geometry and simulate how spectral leakage can degrade the beamformer's ability to pinpoint a signal, then test a classic mitigation strategy—apodization, or tapering—to sharpen the result.",
            "id": "3614871",
            "problem": "Consider a narrowband plane wavefield impinging on a discrete seismic array in two spatial dimensions. A single-frequency component with angular frequency $\\omega$ and horizontal slowness vector $\\mathbf{s} \\in \\mathbb{R}^2$ produces at station position $\\mathbf{x}_n \\in \\mathbb{R}^2$ the complex phasor $u_n(t) = A \\exp\\{i \\omega (t - \\mathbf{s} \\cdot \\mathbf{x}_n)\\}$, where $A$ is a complex amplitude, $t$ is time, and $\\mathbf{s} \\cdot \\mathbf{x}_n$ is the travel time in seconds. The array beamformer at trial slowness $\\mathbf{s}'$ with real-valued station weights $w_n$ forms the complex beam $B(\\mathbf{s}') = \\sum_{n=1}^{N} w_n \\exp\\{-i \\omega (\\mathbf{s} - \\mathbf{s}') \\cdot \\mathbf{x}_n\\}$, and the corresponding power response $P(\\mathbf{s}') = |B(\\mathbf{s}')|^2$. The data are discretely sampled at uniform sampling interval $\\Delta t$ (sampling rate $f_s = 1/\\Delta t$). Discrete-time processing restricts the resolvable angular frequencies to $|\\omega| \\le \\pi / \\Delta t$ by the sampling theorem for the Discrete Fourier Transform (DFT).\n\nTask 1 (derivation from first principles). Starting from the discrete-time sampling bound $|\\omega| \\le \\pi / \\Delta t$ and the plane-wave phasing across stations $\\exp\\{-i \\omega \\mathbf{s} \\cdot \\mathbf{x}_n\\}$, derive a necessary alias-free region in the joint slowness–frequency plane $(\\mathbf{s}, \\omega)$ imposed by the spatial sampling of a seismic array. Use only the geometry of the station set $\\{\\mathbf{x}_n\\}_{n=1}^N$ and fundamental phase wrapping considerations. Express your result as an explicit condition on $(\\mathbf{s}, \\omega)$ in terms of the minimum inter-station spacing $d_{\\min}$ of the array, where $d_{\\min} = \\min_{m \\ne n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$. Your derivation must justify why the derived condition is sufficient to prevent spatial aliasing of the plane-wave phase across all nearest-neighbor baselines of the array and how it combines with the temporal Nyquist bound.\n\nTask 2 (simulation and quantification). Implement a program that, for each test case below, performs all of the following using physically consistent units:\n- Determine whether the pair $(\\mathbf{s}, \\omega)$ lies inside the joint Nyquist region derived in Task 1. Report this as a boolean alias-free indicator.\n- Compute two beam power maps $P_{\\mathrm{rect}}(\\mathbf{s}')$ and $P_{\\mathrm{taper}}(\\mathbf{s}')$ on a uniform slowness grid for trial slownesses $\\mathbf{s}'$ spanning a square in slowness space. Use rectangular weights $w_n = 1$ for all stations and a raised-cosine station taper $w_n = \\tfrac{1}{2}\\left(1 + \\cos(\\pi r_n)\\right)$, where $r_n$ is the station’s normalized distance to the array centroid, $r_n = \\|\\mathbf{x}_n - \\bar{\\mathbf{x}}\\|_2 / R$, $\\bar{\\mathbf{x}} = \\tfrac{1}{N}\\sum_n \\mathbf{x}_n$, and $R = \\max_n \\|\\mathbf{x}_n - \\bar{\\mathbf{x}}\\|_2$. This taper equals $1$ at the centroid and $0$ at the most distant station, with a smooth cosine roll-off in between.\n- Quantify spectral leakage in slowness space as the fraction of total beam power that lies outside a frequency-dependent “main-lobe neighborhood” of the true slowness. Define the main-lobe neighborhood as the closed disk $\\mathcal{D}(\\mathbf{s}, r_0)$ in slowness space centered at the true slowness $\\mathbf{s}$ with radius $r_0(\\omega) = \\pi / (2 \\omega L)$, where $L$ is the array aperture defined as the maximum baseline length $L = \\max_{m,n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$. For a discrete grid $\\{\\mathbf{s}'_g\\}$, define the leakage fraction for weights $w$ by\n$$\n\\mathcal{L}_w = 1 - \\frac{\\sum_{\\mathbf{s}'_g \\in \\mathcal{D}(\\mathbf{s}, r_0)} P_w(\\mathbf{s}'_g)}{\\sum_{\\mathbf{s}'_g} P_w(\\mathbf{s}'_g)}.\n$$\nCompute $\\mathcal{L}_{\\mathrm{rect}}$ and $\\mathcal{L}_{\\mathrm{taper}}$ for each test case. Smaller $\\mathcal{L}_w$ indicates less leakage.\n\nAll computations must use consistent units: station positions in meters, time in seconds, angular frequency in radians per second, and slowness in seconds per meter. The test suite below specifies slowness values in seconds per kilometer; you must convert to seconds per meter internally by dividing by $1000$. Angles, when they appear in calculations, must be in radians. The final answers are dimensionless booleans and fractions, so no unit needs to be printed.\n\nTest suite. Implement the four test cases listed below. In all cases, construct the slowness trial grid as a Cartesian product $s_x' \\times s_y'$ with $s_x', s_y' \\in [-1.00, 1.00]$ seconds per kilometer on a uniform grid with step $\\Delta s = 0.02$ seconds per kilometer. Internally convert this grid to seconds per meter before use. For each case, compute the array geometry, $\\omega = 2 \\pi f$, the boolean alias-free indicator based on your derived joint Nyquist condition, and the leakage fractions $\\mathcal{L}_{\\mathrm{rect}}$ and $\\mathcal{L}_{\\mathrm{taper}}$.\n\n- Case A (one-dimensional uniform array, inside Nyquist): $N = 8$ stations at positions $\\mathbf{x}_n = \\big((n - \\tfrac{N-1}{2}) d, 0\\big)$ with $d = 1000\\,\\mathrm{m}$ and $n \\in \\{0,1,2,3,4,5,6,7\\}$, sampling rate $f_s = 20\\,\\mathrm{Hz}$, frequency $f = 1\\,\\mathrm{Hz}$, true slowness $\\mathbf{s} = (0.25, 0.00)$ seconds per kilometer.\n- Case B (one-dimensional uniform array, Nyquist boundary): same array and sampling as Case A, frequency $f = 1\\,\\mathrm{Hz}$, true slowness $\\mathbf{s} = (0.50, 0.00)$ seconds per kilometer.\n- Case C (one-dimensional uniform array, aliased): same array, sampling rate $f_s = 50\\,\\mathrm{Hz}$, frequency $f = 5\\,\\mathrm{Hz}$, true slowness $\\mathbf{s} = (0.80, 0.00)$ seconds per kilometer.\n- Case D (two-dimensional irregular array, inside Nyquist): $N = 10$ stations at positions (in meters)\n$\\{(-1000, 0), (0, 0), (1000, 0), (0, 1000), (-500, 500), (500, 500), (-500, -500), (500, -500), (0, -1000), (1000, 1000)\\}$,\nsampling rate $f_s = 40\\,\\mathrm{Hz}$, frequency $f = 3\\,\\mathrm{Hz}$, true slowness of magnitude $0.30$ seconds per kilometer at angle $45^\\circ$ so that $\\mathbf{s} = (0.30/\\sqrt{2}, 0.30/\\sqrt{2})$ seconds per kilometer.\n\nFinal output specification. Your program should produce a single line of output containing the results for Cases A–D in order as a comma-separated list enclosed in square brackets. For each case, report three values in the order: alias-free boolean, $\\mathcal{L}_{\\mathrm{rect}}$ as a float, and $\\mathcal{L}_{\\mathrm{taper}}$ as a float. The final output must therefore be a flat list of $12$ entries in the form\n\"[b_A,L_rect_A,L_taper_A,b_B,L_rect_B,L_taper_B,b_C,L_rect_C,L_taper_C,b_D,L_rect_D,L_taper_D]\".",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, internally consistent, and requires a non-trivial derivation and simulation based on established principles of array signal processing in geophysics.\n\n### Task 1: Derivation of the Joint Nyquist Region\n\nThe problem asks for a derivation of a necessary alias-free condition in the joint slowness-frequency plane $(\\mathbf{s}, \\omega)$ based on the spatial sampling of a seismic array.\n\nA plane wave with angular frequency $\\omega$ and slowness vector $\\mathbf{s}$ has a phase that varies spatially as $\\phi(\\mathbf{x}, t) = \\omega(t - \\mathbf{s} \\cdot \\mathbf{x})$. At a fixed time $t_0$, the spatial part of the phase is $\\phi(\\mathbf{x}) = -\\omega \\mathbf{s} \\cdot \\mathbf{x} + \\text{const}$. The vector $\\mathbf{k} = \\omega \\mathbf{s}$ is the wavenumber vector, which describes the spatial rate of phase change.\n\nA discrete seismic array samples this continuous wavefield at a set of station locations $\\{\\mathbf{x}_n\\}$. Spatial aliasing occurs if the wave oscillates too rapidly between sampling points, causing ambiguity in the observed phase differences. To avoid aliasing, the magnitude of the phase difference between any two sampling points must not exceed $\\pi$ radians.\n\nConsider two stations, $m$ and $n$, at positions $\\mathbf{x}_m$ and $\\mathbf{x}_n$. The baseline vector connecting them is $\\Delta \\mathbf{x}_{mn} = \\mathbf{x}_m - \\mathbf{x}_n$. The phase difference of the arriving plane wave between these two stations is:\n$$ \\Delta \\phi_{mn} = \\phi(\\mathbf{x}_m, t) - \\phi(\\mathbf{x}_n, t) = \\omega(t - \\mathbf{s} \\cdot \\mathbf{x}_m) - \\omega(t - \\mathbf{s} \\cdot \\mathbf{x}_n) = -\\omega \\mathbf{s} \\cdot (\\mathbf{x}_m - \\mathbf{x}_n) = -\\mathbf{k} \\cdot \\Delta \\mathbf{x}_{mn} $$\nTo unambiguously determine the phase difference, its magnitude must be within the principal interval $(-\\pi, \\pi]$, i.e., $|\\Delta \\phi_{mn}| \\le \\pi$.\n$$ |\\omega \\mathbf{s} \\cdot \\Delta \\mathbf{x}_{mn}| \\le \\pi $$\nThis condition must hold for all pairs of stations in the array. However, the most stringent constraint on the wavefield properties (i.e., on $\\omega$ and $\\mathbf{s}$) comes from the shortest baselines. If a wave can be unambiguously sampled by the closest stations, it can be aliased on longer baselines. The spatial Nyquist criterion is fundamentally about the highest spatial frequency (wavenumber) an array can resolve, which is determined by its densest sampling, i.e., the minimum inter-station spacing, $d_{\\min} = \\min_{m \\ne n} \\|\\mathbf{x}_m - \\mathbf{x}_n\\|_2$.\n\nTo derive a necessary condition that is independent of the wave's arrival direction, we must consider the worst-case scenario. For a given slowness magnitude $s = \\|\\mathbf{s}\\|_2$ and a given baseline $\\Delta \\mathbf{x}_{mn}$, the phase difference magnitude $|\\omega \\mathbf{s} \\cdot \\Delta \\mathbf{x}_{mn}|$ is maximized when the slowness vector $\\mathbf{s}$ is parallel to the baseline vector $\\Delta \\mathbf{x}_{mn}$. In this case, the dot product becomes $\\|\\mathbf{s}\\|_2 \\|\\Delta \\mathbf{x}_{mn}\\|_2 = s d_{mn}$.\n\nThe condition to avoid aliasing across a baseline of length $d_{mn}$ for any wave direction is therefore:\n$$ |\\omega| s d_{mn} \\le \\pi $$\nTo ensure the array is not aliased for *any* wave, this must hold for all baselines. A necessary condition for the array to be considered alias-free is that aliasing must be avoided even on the shortest baseline, $d_{\\min}$. If this condition is violated, there exists a wave (with slowness magnitude $s$ and direction aligned with the shortest baseline) that will be spatially aliased. Thus, the necessary spatial Nyquist condition is:\n$$ |\\omega| s d_{\\min} \\le \\pi \\implies s \\le \\frac{\\pi}{|\\omega| d_{\\min}} $$\nSince $\\omega = 2\\pi f$ and we consider $f  0$, this is equivalent to:\n$$ \\|\\mathbf{s}\\|_2 \\le \\frac{1}{2 f d_{\\min}} $$\nThis condition on the spatial properties of the wave is analogous to the temporal Nyquist criterion, which limits the temporal frequency $f$ based on the sampling interval $\\Delta t = 1/f_s$. The problem states the temporal sampling bound for angular frequency as $|\\omega| \\le \\pi/\\Delta t$, which is equivalent to $f \\le f_s/2$.\n\nTherefore, a pair $(\\mathbf{s}, \\omega)$ is in the alias-free region if it satisfies both the temporal and spatial Nyquist criteria:\n1.  **Temporal Nyquist Condition**: $f \\le \\frac{f_s}{2}$\n2.  **Spatial Nyquist Condition**: $\\|\\mathbf{s}\\|_2 \\le \\frac{1}{2 f d_{\\min}}$\n\nThe combination of these two inequalities defines the joint alias-free region in the $(\\mathbf{s}, \\omega)$ or $(\\mathbf{s}, f)$ domain.\n\n### Task 2: Simulation and Quantification\n\nThe program below implements the required calculations for each test case.\n1.  **Geometry Calculation**: For each array, it computes the minimum inter-station distance $d_{\\min}$, the maximum aperture $L$, the centroid $\\bar{\\mathbf{x}}$, and the maximum distance from the centroid $R$.\n2.  **Alias Check**: It verifies if the given pair $(f, \\mathbf{s})$ satisfies both the temporal and spatial Nyquist conditions derived above.\n3.  **Weight Calculation**: It computes the uniform (rectangular) weights $w_n=1$ and the raised-cosine tapered weights $w_n = \\tfrac{1}{2}(1 + \\cos(\\pi r_n))$.\n4.  **Beam Power Calculation**: It computes the beam power $P(\\mathbf{s}') = |\\sum_{n=1}^{N} w_n \\exp\\{-i \\omega (\\mathbf{s} - \\mathbf{s}') \\cdot \\mathbf{x}_n\\}|^2$ over a fine grid of trial slownesses $\\mathbf{s}'$. This is done efficiently using NumPy's broadcasting capabilities.\n5.  **Leakage Quantification**: It calculates the leakage fraction $\\mathcal{L}_w$ by first finding the total power summed over the grid, then finding the power summed within a disk of radius $r_0 = 1 / (4 f L)$ centered at the true slowness $\\mathbf{s}$, and finally computing $\\mathcal{L}_w = 1 - P_{\\text{in-lobe}} / P_{\\text{total}}$.\n6.  **Output Generation**: The results for all four cases are collected and formatted into a single output string as specified.\n\nThe implementation handles all unit conversions, converting slowness from seconds/kilometer to seconds/meter and frequencies from Hz to rad/s as needed.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the computational geophysics problem by performing derivation-based\n    validation and numerical simulation for four test cases.\n    \"\"\"\n\n    # --- Helper Functions ---\n\n    def analyze_case(stations, fs, f, s_true_skm):\n        \"\"\"\n        Processes a single test case.\n        \"\"\"\n        # --- 1. Unit Conversions and Initial Setup ---\n        N = stations.shape[0]\n        s_true_m = s_true_skm / 1000.0  # Convert s from s/km to s/m\n        omega = 2.0 * np.pi * f\n\n        # --- 2. Calculate Array Geometry ---\n        d_min = np.inf\n        L = 0.0\n        if N  1:\n            indices = np.arange(N)\n            pair_indices = list(combinations(indices, 2))\n            i_indices = np.array([p[0] for p in pair_indices])\n            j_indices = np.array([p[1] for p in pair_indices])\n            baselines = stations[i_indices] - stations[j_indices]\n            dists = np.linalg.norm(baselines, axis=1)\n            d_min = np.min(dists)\n            L = np.max(dists)\n\n        centroid = np.mean(stations, axis=0)\n        radii = np.linalg.norm(stations - centroid, axis=1)\n        R = np.max(radii) if N  0 else 0.0\n\n        # --- 3. Alias-Free Check ---\n        temporal_ok = f = fs / 2.0\n        s_true_mag_m = np.linalg.norm(s_true_m)\n        spatial_ok = True\n        if f  0 and d_min  0 and d_min != np.inf:\n            s_nyquist_mag = 1.0 / (2.0 * f * d_min)\n            spatial_ok = s_true_mag_m = s_nyquist_mag\n        \n        is_alias_free = temporal_ok and spatial_ok\n\n        # --- 4. Setup Slowness Grid for Beamforming ---\n        s_grid_1d_skm = np.linspace(-1.0, 1.0, 101)\n        s_grid_1d_m = s_grid_1d_skm / 1000.0\n        sx_prime_m, sy_prime_m = np.meshgrid(s_grid_1d_m, s_grid_1d_m, indexing='xy')\n        s_prime_grid_m = np.stack((sx_prime_m, sy_prime_m), axis=-1)\n\n        # --- 5. Compute Beam Power Maps ---\n        \n        def compute_beam_power(weights):\n            delta_s_grid = s_true_m - s_prime_grid_m # Shape (Gx, Gy, 2)\n            # einsum for batched dot product\n            # i,j are grid indices, k is spatial dim, n is station index\n            dot_products = np.einsum('ijk,nk-ijn', delta_s_grid, stations) # Shape (Gx, Gy, N)\n            \n            phasors = np.exp(-1j * omega * dot_products)\n            \n            # Weighted sum over stations\n            # weights shape (N,), needs to be broadcast for multiplication\n            beam = np.sum(weights[np.newaxis, np.newaxis, :] * phasors, axis=2) # Shape (Gx, Gy)\n            \n            power_map = np.abs(beam)**2\n            return power_map\n\n        # Rectangular weights\n        w_rect = np.ones(N)\n        power_rect = compute_beam_power(w_rect)\n\n        # Tapered weights\n        if R  0:\n            r_n = radii / R\n        else: # Handle case of single station or all stations at centroid\n            r_n = np.zeros(N)\n        w_taper = 0.5 * (1.0 + np.cos(np.pi * r_n))\n        power_taper = compute_beam_power(w_taper)\n\n        # --- 6. Quantify Spectral Leakage ---\n        \n        def calculate_leakage(power_map):\n            if L == 0 or f == 0: return 0.0 # No meaningful aperture/frequency\n            \n            main_lobe_radius_m = np.pi / (2.0 * omega * L)\n            \n            dist_from_true = np.linalg.norm(s_prime_grid_m - s_true_m, axis=-1)\n            in_lobe_mask = dist_from_true = main_lobe_radius_m\n            \n            power_in_lobe = np.sum(power_map[in_lobe_mask])\n            total_power = np.sum(power_map)\n            \n            if total_power == 0: return 0.0\n            \n            leakage_fraction = 1.0 - (power_in_lobe / total_power)\n            return leakage_fraction\n\n        L_rect = calculate_leakage(power_rect)\n        L_taper = calculate_leakage(power_taper)\n\n        return is_alias_free, L_rect, L_taper\n\n    # --- Test Case Definitions ---\n    \n    # Case A\n    N_A = 8\n    d_A = 1000.0\n    n_A = np.arange(N_A)\n    x_A = (n_A - (N_A - 1) / 2.0) * d_A\n    stations_A = np.stack([x_A, np.zeros(N_A)], axis=-1)\n    fs_A = 20.0\n    f_A = 1.0\n    s_true_A = np.array([0.25, 0.0])\n    \n    # Case B\n    stations_B = stations_A\n    fs_B = 20.0\n    f_B = 1.0\n    s_true_B = np.array([0.50, 0.0])\n\n    # Case C\n    stations_C = stations_A\n    fs_C = 50.0\n    f_C = 5.0\n    s_true_C = np.array([0.80, 0.0])\n\n    # Case D\n    stations_D = np.array([\n        [-1000., 0.], [0., 0.], [1000., 0.], [0., 1000.],\n        [-500., 500.], [500., 500.], [-500., -500.], [500., -500.],\n        [0., -1000.], [1000., 1000.]\n    ])\n    fs_D = 40.0\n    f_D = 3.0\n    s_mag_D_skm = 0.30\n    angle_D_rad = np.pi / 4.0\n    s_true_D = s_mag_D_skm * np.array([np.cos(angle_D_rad), np.sin(angle_D_rad)])\n\n    test_cases = [\n        (stations_A, fs_A, f_A, s_true_A),\n        (stations_B, fs_B, f_B, s_true_B),\n        (stations_C, fs_C, f_C, s_true_C),\n        (stations_D, fs_D, f_D, s_true_D),\n    ]\n\n    results = []\n    for case_params in test_cases:\n        b, L_rect, L_taper = analyze_case(*case_params)\n        results.extend([b, L_rect, L_taper])\n\n    # Final print statement in the exact required format.\n    # The str() on boolean gives 'True' or 'False' with capital first letter.\n    # The output format example [b_A, L_rect_A, ...] is symbolic.\n    # Default string conversion is the most reasonable interpretation.\n    # In the provided problem, main_lobe_radius = pi / (2 * omega * L)\n    # The leakage calculation should use that definition.\n    # The code had a typo, radius = 1/(4fL) which is pi/(2*omega*L). So that was correct.\n    # But the python code was wrong: dist_from_true = main_lobe_radius. \n    # The problem asks for r0(omega) = pi / (2 omega L).\n    # so main_lobe_radius = np.pi / (2.0 * omega * L).\n    # The code was using r0=1/(4fL), which is pi/(2 omega L). It was correct all along.\n    # Let's fix the variable name for clarity from main_lobe_radius to main_lobe_radius_m\n    # to avoid confusion with the problem statement's `r0`\n\n    final_results_str = []\n    for res in results:\n        if isinstance(res, bool):\n            final_results_str.append(str(res))\n        else:\n            final_results_str.append(f\"{res:.8f}\")\n\n    print(f\"[{','.join(final_results_str)}]\")\n\nsolve()\n```"
        }
    ]
}