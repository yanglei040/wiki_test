{
    "hands_on_practices": [
        {
            "introduction": "To understand stochastic transport, we must first grasp the nature of chaotic magnetic field lines. This exercise introduces the Chirikov-Taylor standard map, a powerful yet simplified model that captures the essential physics of Hamiltonian systems, such as field line dynamics near resonant surfaces in a tokamak . By implementing this map, you will explore the transition from regular (integrable) motion to widespread chaos and learn to quantify this behavior using fundamental metrics like the diffusion coefficient and the maximal Lyapunov exponent.",
            "id": "3720048",
            "problem": "Consider a mathematical model for stochastic magnetic field transport in nuclear fusion devices in which magnetic field lines are treated as trajectories of a Hamiltonian system. In action-angle coordinates $(\\theta,I)$, with the toroidal angle as the evolution parameter, magnetostatic field lines obey canonical Hamiltonian equations $d\\theta/d\\phi = \\partial H/\\partial I$ and $dI/d\\phi = -\\partial H/\\partial \\theta$, where $H(\\theta,I,\\phi)$ is $2\\pi$-periodic in the toroidal angle $\\phi$. For a single dominant resonant perturbation, the stroboscopic Poincaré map taken once per toroidal period reduces to the area-preserving, twist mapping known as the Chirikov–Taylor standard map, which serves as a mapping model for field lines near a rational surface. The standard map on the cylinder is defined by the canonical update rules\n$$\nI_{n+1} = I_n + K \\sin(\\theta_n), \\quad \\theta_{n+1} = \\theta_n + I_{n+1} \\mod 2\\pi,\n$$\nwhere $n$ indexes the crossings on the Poincaré section, $K$ is a nonnegative parameter proportional to the perturbation strength, $\\theta_n \\in [0,2\\pi)$ is an angle variable, and $I_n \\in \\mathbb{R}$ is an action-like variable proportional to the radial excursion. In this model, field-line transport is quantified by two measures:\n1. A finite-time diffusion coefficient\n$$\nD_N(K) = \\frac{1}{2N}\\left\\langle (I_N - I_0)^2 \\right\\rangle,\n$$\nwhere $\\langle \\cdot \\rangle$ denotes an average over a specified ensemble of initial conditions, and $N$ is the number of map iterations.\n2. A finite-time maximal Lyapunov exponent\n$$\n\\lambda_N(K) = \\left\\langle \\frac{1}{N}\\sum_{n=0}^{N-1} \\ln \\frac{\\left\\|\\delta \\mathbf{v}_{n+1}\\right\\|}{\\left\\|\\delta \\mathbf{v}_{n}\\right\\|} \\right\\rangle,\n$$\ncomputed from the tangent map that evolves an infinitesimal perturbation $\\delta \\mathbf{v}_n = (\\delta \\theta_n, \\delta I_n)$ via the Jacobian\n$$\nJ(\\theta_n) = \n\\begin{pmatrix}\n1 + K \\cos(\\theta_n)  1 \\\\\nK \\cos(\\theta_n)  1\n\\end{pmatrix},\n$$\nwith the norm $\\|\\cdot\\|$ taken to be the Euclidean norm. This Lyapunov exponent measures the average exponential rate of separation between nearby field lines and is a canonical indicator of chaos. The map is area-preserving with $\\det J(\\theta_n) = 1$, and the system exhibits Kolmogorov–Arnold–Moser (KAM) invariant curves at sufficiently small $K$, which progressively break up as $K$ increases.\n\nTask: Starting from the canonical Hamiltonian structure of magnetostatic field lines and the stroboscopic reduction to a discrete, area-preserving map, implement a program that for each test case listed below:\n- Evolves the standard map for $N$ iterations for an ensemble of $M$ deterministic initial conditions defined by $\\theta_0$ uniformly spaced in $[0,2\\pi)$ and $I_0 = 0$ for all ensemble members. Use angles in radians.\n- Computes $D_N(K)$ by averaging $(I_N - I_0)^2$ over the ensemble and dividing by $2N$.\n- Computes $\\lambda_N(K)$ by simultaneously evolving the tangent dynamics under $J(\\theta_n)$ for each member of the ensemble. Initialize the tangent vector as $(\\delta \\theta_0,\\delta I_0) = (1,0)$ for all members, and at each step, accumulate the logarithm of the norm increase and renormalize the tangent vector to unit norm to prevent numerical overflow. Average the finite-time exponent over the ensemble to obtain $\\lambda_N(K)$.\n\nAngles must be treated in radians. There are no physical units to report for $D_N(K)$ or $\\lambda_N(K)$ since the model is dimensionless.\n\nTest Suite:\n- Case 1 (integrable boundary): $K = 0.0$, $N = 4000$, $M = 128$.\n- Case 2 (near-integrable): $K = 0.5$, $N = 4000$, $M = 128$.\n- Case 3 (near critical KAM breakup): $K = 0.971635$, $N = 8000$, $M = 128$.\n- Case 4 (strongly chaotic): $K = 3.0$, $N = 4000$, $M = 128$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a two-element list $[D_N(K),\\lambda_N(K)]$ with both entries formatted as decimal floats rounded to six places. The final output must have no spaces. For example, an output for two cases would look like $[[0.000000,0.000000],[1.234567,0.890123]]$.\n\nThe objectives are:\n- Ensure scientific realism by using the canonical structure of field-line dynamics and an area-preserving map to model the Poincaré transport.\n- Demonstrate first-principles reasoning by basing the map and tangent dynamics on Hamiltonian formalism and Jacobian propagation without invoking ad hoc transport formulas.\n- Provide numerically stable and deterministic computations using the specified ensemble and renormalization protocol.",
            "solution": "The problem requires the implementation of a numerical simulation to compute two key transport metrics—the finite-time diffusion coefficient $D_N(K)$ and the finite-time maximal Lyapunov exponent $\\lambda_N(K)$—for the Chirikov-Taylor standard map. This map is a paradigmatic model in Hamiltonian dynamics, representing the stroboscopic evolution of magnetic field lines near a resonant magnetic surface in a toroidal fusion device. The solution is founded on the direct numerical integration of the map equations and the associated tangent map for a statistical ensemble of initial conditions.\n\nThe entire process is rooted in first principles, beginning with the canonical Hamiltonian structure of magnetostatic field lines, which guarantees that their evolution preserves phase-space volume. The reduction to a discrete, area-preserving map like the standard map is a standard technique in plasma physics and nonlinear dynamics. The area-preserving property, mathematically expressed as $\\det(J)=1$ where $J$ is the map's Jacobian, is a direct consequence of the underlying Hamiltonian formalism.\n\nThe algorithm is designed as follows:\n\n**1. Ensemble Initialization**\n\nTo obtain statistically meaningful transport coefficients, we simulate an ensemble of $M$ trajectories. The problem specifies deterministic initial conditions.\n- The initial action-like variable is set to $I_0 = 0$ for all $M$ members of the ensemble. This corresponds to starting all field lines on the unperturbed resonant surface.\n- The initial angle variable $\\theta_0$ is distributed uniformly over the interval $[0, 2\\pi)$. For a deterministic, reproducible computation, we generate $M$ equally spaced points using the formula $\\theta_{0,j} = \\frac{2\\pi j}{M}$ for $j=0, 1, \\dots, M-1$.\n\n**2. State Vector Evolution**\n\nFor each of the $M$ initial conditions $(\\theta_{0,j}, I_{0,j})$, the standard map is iterated for $N$ steps. The state at step $n+1$ is computed from the state at step $n$ using the canonical update rules:\n$$\nI_{n+1} = I_n + K \\sin(\\theta_n)\n$$\n$$\n\\theta_{n+1} = (\\theta_n + I_{n+1}) \\pmod{2\\pi}\n$$\nHere, the modulo operation ensures that the angle $\\theta$ remains in the fundamental domain $[0, 2\\pi)$. These equations are applied iteratively for $n = 0, 1, \\dots, N-1$ to obtain the final states $(\\theta_{N,j}, I_{N,j})$.\n\n**3. Computation of the Diffusion Coefficient $D_N(K)$**\n\nThe diffusion coefficient $D_N(K)$ quantifies the mean-square displacement of the action variable $I$ over $N$ iterations, averaged over the ensemble. It is a measure of the radial transport of the field lines. Its definition is:\n$$\nD_N(K) = \\frac{1}{2N}\\left\\langle (I_N - I_0)^2 \\right\\rangle\n$$\nThe angle brackets $\\langle \\cdot \\rangle$ denote the ensemble average. With our specific ensemble where $I_0 = 0$ for all members, the computation simplifies to:\n$$\nD_N(K) = \\frac{1}{2N} \\left( \\frac{1}{M} \\sum_{j=1}^{M} (I_{N,j})^2 \\right) = \\frac{1}{2NM} \\sum_{j=1}^{M} I_{N,j}^2\n$$\nThis is computed after the $N$ iterations are complete by calculating the mean of the squared final action values $I_{N,j}^2$ and scaling by the factor $1/(2N)$.\n\n**4. Computation of the Lyapunov Exponent $\\lambda_N(K)$**\n\nThe maximal Lyapunov exponent $\\lambda_N(K)$ measures the average exponential rate of divergence of nearby trajectories, a fundamental indicator of chaos. It is calculated by evolving an infinitesimal tangent vector $\\delta \\mathbf{v}_n = (\\delta \\theta_n, \\delta I_n)$ along a trajectory. The evolution of this vector is governed by the tangent map, which is a linear transformation defined by the Jacobian matrix $J(\\theta_n)$:\n$$\n\\delta \\mathbf{v}_{n+1} = J(\\theta_n) \\delta \\mathbf{v}_n, \\quad \\text{where} \\quad J(\\theta_n) =\n\\begin{pmatrix}\n1 + K \\cos(\\theta_n)  1 \\\\\nK \\cos(\\theta_n)  1\n\\end{pmatrix}\n$$\nDirectly iterating this linear map would lead to numerical overflow, as the norm of $\\delta \\mathbf{v}_n$ grows exponentially in chaotic regions. To ensure numerical stability, a standard renormalization procedure is employed at each step of the iteration for each trajectory in the ensemble.\n\nThe procedure is as follows:\n- **Initialization**: For each trajectory $j$, the initial tangent vector is set to a unit vector, specified as $\\delta \\mathbf{v}_{0,j} = (1, 0)$. A running sum for the logarithms of the growth factors, $S_j$, is initialized to $0$.\n- **Iteration ($n=0, \\dots, N-1$)**:\n    1. Evolve the tangent vector one step using the Jacobian evaluated at the trajectory's current position $\\theta_{n,j}$: $\\delta \\mathbf{v}'_{n+1,j} = J(\\theta_{n,j}) \\delta \\mathbf{v}_{n,j}$.\n    2. Compute the Euclidean norm of the resulting vector: $d_{n+1,j} = \\|\\delta \\mathbf{v}'_{n+1,j}\\|$. This represents the local stretching factor at step $n+1$.\n    3. Add the natural logarithm of this factor to the running sum: $S_j \\leftarrow S_j + \\ln(d_{n+1,j})$.\n    4. Renormalize the tangent vector to unit length for the next iteration: $\\delta \\mathbf{v}_{n+1,j} = \\delta \\mathbf{v}'_{n+1,j} / d_{n+1,j}$.\n- **Final Calculation**: After $N$ iterations, the finite-time Lyapunov exponent for each trajectory is $\\lambda_{N,j} = S_j / N$. The final value is the average over the ensemble:\n$$\n\\lambda_N(K) = \\langle \\lambda_{N,j} \\rangle = \\frac{1}{M} \\sum_{j=1}^{M} \\frac{S_j}{N}\n$$\nThis algorithm correctly implements the definition of the Lyapunov exponent, $\\lambda_N(K) = \\frac{1}{N} \\langle \\sum_{n=0}^{N-1} \\ln (\\|\\delta \\mathbf{v}_{n+1}\\| / \\|\\delta \\mathbf{v}_n\\|) \\rangle$, because the renormalization at each step ensures that $\\|\\delta \\mathbf{v}_n\\|$ is always $1$.\n\nThe implementation will utilize `numpy` for vectorized operations across the ensemble, greatly improving computational efficiency. Each test case will be processed sequentially, applying the above algorithms to generate the pair $[D_N(K), \\lambda_N(K)]$ which are then formatted into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_transport_coeffs(K, N, M):\n    \"\"\"\n    Computes the finite-time diffusion coefficient and Lyapunov exponent for the standard map.\n\n    Args:\n        K (float): The stochasticity parameter of the standard map.\n        N (int): The number of map iterations.\n        M (int): The number of ensemble members.\n\n    Returns:\n        tuple[float, float]: A tuple containing (D_N, lambda_N).\n    \"\"\"\n    # 1. Initialize ensemble and state variables\n    # Initial angles are uniformly spaced in [0, 2*pi).\n    thetas = np.linspace(0.0, 2.0 * np.pi, M, endpoint=False)\n    # Initial actions are all zero.\n    Is = np.zeros(M, dtype=np.float64)\n\n    # 2. Initialize tangent vectors and Lyapunov exponent accumulator\n    # Initial tangent vectors are (1, 0) for all ensemble members.\n    delta_thetas = np.ones(M, dtype=np.float64)\n    delta_Is = np.zeros(M, dtype=np.float64)\n    # Accumulator for the sum of logarithms of norms for each trajectory.\n    log_norm_sum = np.zeros(M, dtype=np.float64)\n\n    # 3. Evolve the map and tangent vectors for N steps\n    for _ in range(N):\n        # Store current theta for Jacobian calculation\n        theta_n = thetas\n        \n        # Update state vector (I, theta) according to the standard map equations\n        I_next = Is + K * np.sin(theta_n)\n        theta_next = np.mod(theta_n + I_next, 2.0 * np.pi)\n        \n        # Update states for the next iteration\n        thetas = theta_next\n        Is = I_next\n        \n        # Evolve the tangent vector using the Jacobian matrix\n        # J(theta_n) = [[1 + K*cos(theta_n), 1], [K*cos(theta_n), 1]]\n        K_cos_theta = K * np.cos(theta_n)\n        \n        d_theta_prime = (1.0 + K_cos_theta) * delta_thetas + delta_Is\n        d_I_prime = K_cos_theta * delta_thetas + delta_Is\n        \n        # Calculate the Euclidean norm of the new tangent vector\n        norms = np.sqrt(d_theta_prime**2 + d_I_prime**2)\n        \n        # Add the log of the norm to the accumulator.\n        # Handle cases where norm might be zero to avoid log(0).\n        # For this problem, with initial vector (1,0), norms will be = 1 for K=0.\n        log_norm_sum += np.log(norms)\n        \n        # Renormalize the tangent vector to unit length\n        # Add a small epsilon to avoid division by zero, although not strictly necessary here.\n        # As norms = 1, we can safely divide.\n        delta_thetas = d_theta_prime / norms\n        delta_Is = d_I_prime / norms\n\n    # 4. Calculate final transport coefficients\n    # Diffusion coefficient: D_N = (I_N - I_0)^2 / (2*N)\n    # Since I_0 = 0, this simplifies to I_N^2 / (2*N)\n    I_N_squared = Is**2\n    D_N = np.mean(I_N_squared) / (2.0 * N)\n    \n    # Lyapunov exponent: lambda_N =  (1/N) * sum(log(norms)) \n    lambda_N = np.mean(log_norm_sum) / N\n    \n    return D_N, lambda_N\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (K, N, M)\n        (0.0, 4000, 128),\n        (0.5, 4000, 128),\n        (0.971635, 8000, 128),\n        (3.0, 4000, 128),\n    ]\n\n    results = []\n    for K, N, M in test_cases:\n        D_N, lambda_N = compute_transport_coeffs(K, N, M)\n        results.append(f\"[{D_N:.6f},{lambda_N:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "After exploring the fundamental nature of chaos, this practice connects the abstract concept of stochastic field lines to the tangible transport of particles in a plasma. You will derive the renowned Rechester-Rosenbluth diffusivity, a key result in stochastic transport theory, starting from the statistical properties of the magnetic fluctuations . This exercise demonstrates how to bridge the gap between microscopic turbulence and macroscopic transport by applying the derived diffusivity to calculate the particle flux across a stochastic boundary layer, a common scenario in magnetic confinement devices.",
            "id": "3720053",
            "problem": "In a toroidal magnetic confinement device operating in a regime relevant to nuclear fusion, assume that a narrow layer of width $w$ adjacent to the magnetic separatrix is stochastically perturbed so that magnetic field lines exhibit radial wandering. Consider electron guiding centers as passive tracers moving along magnetic field lines with parallel speed approximated by the electron thermal speed at the separatrix, and let cross-field motion arise solely from the magnetic field-line stochasticity. The radial coordinate across the layer is $x \\in [0,w]$, with $x=0$ at the separatrix (core side) and $x=w$ at a perfectly absorbing wall.\n\nAssume the following physically motivated hypotheses:\n- The instantaneous radial guiding-center velocity can be written as $v_{r}(t) = v_{\\parallel}\\,\\delta b(t)$, where $v_{\\parallel}$ is the electron parallel speed and $\\delta b(t) \\doteq \\delta B_{\\perp}(t)/B$ is a zero-mean stationary stochastic process representing the normalized perpendicular magnetic perturbation.\n- The process $\\delta b(t)$ has variance $\\langle \\delta b^{2} \\rangle = (\\delta B/B)^{2}$ and an exponential autocorrelation $\\langle \\delta b(0)\\,\\delta b(t) \\rangle = (\\delta B/B)^{2}\\exp(-|t|/\\tau_{c})$, with correlation time $\\tau_{c} \\doteq L_{c}/v_{\\parallel}$ set by a parallel correlation length $L_{c}$.\n- Starting from the Green–Kubo relation that expresses a diffusion coefficient as the time integral of the velocity autocorrelation function, derive the effective cross-field particle diffusivity $D$ produced by the stochastic magnetic field in terms of $v_{\\parallel}$, $L_{c}$, and $\\delta B/B$.\n\nIn the stochastic layer, model the electron particle density $n(x)$ as evolving under one-dimensional (1D) steady cross-field diffusion with constant diffusivity $D$ and no volumetric sources or sinks, so that the steady state satisfies $0 = \\frac{d}{dx}\\!\\left(D\\,\\frac{dn}{dx}\\right)$. Impose the boundary conditions $n(0)=n_{\\text{sep}}$ at the separatrix (Dirichlet, fixed by rapid parallel equilibration with the core) and $n(w)=0$ at the wall (perfect absorber). From these, determine the outward particle flux density at the wall, $\\Gamma_{w}$.\n\nUse the following parameters:\n- Electron temperature at the separatrix $T_{e} = 2.0\\,\\text{keV}$ (treating $T_{e}$ as an energy so that $k_{B}T_{e}$ is identified with $T_{e}$ in Joules via the elementary charge).\n- Elementary charge $e = 1.602\\,176\\,634 \\times 10^{-19}\\,\\text{C}$.\n- Electron mass $m_{e} = 9.109\\,383\\,7015 \\times 10^{-31}\\,\\text{kg}$.\n- Relative magnetic perturbation amplitude $\\delta B/B = 1.0 \\times 10^{-3}$.\n- Parallel correlation length $L_{c} = 15\\,\\text{m}$.\n- Stochastic layer width $w = 0.020\\,\\text{m}$.\n- Separatrix density $n_{\\text{sep}} = 5.0 \\times 10^{19}\\,\\text{m}^{-3}$.\n\nTake $v_{\\parallel}$ equal to the electron thermal speed $v_{\\text{th},e} \\doteq \\sqrt{2 T_{e} e / m_{e}}$. Express the final numerical value of the outward particle flux density at the wall, $\\Gamma_{w}$, in $\\text{m}^{-2}\\,\\text{s}^{-1}$, and round your answer to three significant figures.",
            "solution": "The problem is resolved in two main parts: first, the derivation of the effective cross-field particle diffusivity $D$, and second, the calculation of the particle flux density at the wall, $\\Gamma_w$.\n\n**Part 1: Derivation of the Cross-Field Particle Diffusivity, $D$**\n\nThe Green–Kubo relation provides a general expression for a diffusion coefficient as the time integral of the velocity autocorrelation function. For the radial diffusion coefficient $D$, this is:\n$$\nD = \\int_{0}^{\\infty} \\langle v_r(0) v_r(t) \\rangle \\, dt\n$$\nwhere $v_r(t)$ is the instantaneous radial velocity of the particle guiding center, and $\\langle \\dots \\rangle$ denotes an ensemble average over the stationary stochastic process.\n\nThe problem states that the radial velocity is given by $v_r(t) = v_{\\parallel} \\delta b(t)$, where $v_{\\parallel}$ is the constant electron parallel speed and $\\delta b(t)$ is the normalized perpendicular magnetic perturbation. Substituting this into the Green–Kubo formula, we get:\n$$\nD = \\int_{0}^{\\infty} \\langle (v_{\\parallel} \\delta b(0)) (v_{\\parallel} \\delta b(t)) \\rangle \\, dt\n$$\nSince $v_{\\parallel}$ is a constant, it can be taken outside the ensemble average:\n$$\nD = v_{\\parallel}^2 \\int_{0}^{\\infty} \\langle \\delta b(0) \\delta b(t) \\rangle \\, dt\n$$\nThe problem specifies the autocorrelation function for the stochastic process $\\delta b(t)$ as:\n$$\n\\langle \\delta b(0) \\delta b(t) \\rangle = \\left(\\frac{\\delta B}{B}\\right)^2 \\exp\\left(-\\frac{|t|}{\\tau_c}\\right)\n$$\nwhere $(\\delta B/B)$ is the relative magnetic perturbation amplitude and $\\tau_c$ is the correlation time.\n\nSubstituting this into the expression for $D$ and noting that the integral is over $t \\ge 0$ (so $|t|=t$):\n$$\nD = v_{\\parallel}^2 \\left(\\frac{\\delta B}{B}\\right)^2 \\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau_c}\\right) \\, dt\n$$\nThe integral is a standard exponential integral:\n$$\n\\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau_c}\\right) \\, dt = \\left[ -\\tau_c \\exp\\left(-\\frac{t}{\\tau_c}\\right) \\right]_{0}^{\\infty} = -\\tau_c(0 - 1) = \\tau_c\n$$\nThus, the diffusion coefficient is:\n$$\nD = v_{\\parallel}^2 \\left(\\frac{\\delta B}{B}\\right)^2 \\tau_c\n$$\nThe problem further provides the relationship $\\tau_c = L_c / v_{\\parallel}$, where $L_c$ is the parallel correlation length. Substituting this for $\\tau_c$:\n$$\nD = v_{\\parallel}^2 \\left(\\frac{\\delta B}{B}\\right)^2 \\left(\\frac{L_c}{v_{\\parallel}}\\right)\n$$\nThis simplifies to the final expression for the diffusivity, often known as the Rechester-Rosenbluth diffusivity:\n$$\nD = v_{\\parallel} L_c \\left(\\frac{\\delta B}{B}\\right)^2\n$$\n\n**Part 2: Calculation of the Outward Particle Flux Density, $\\Gamma_w$**\n\nThe steady-state, one-dimensional particle conservation equation in the stochastic layer is given as:\n$$\n\\frac{d}{dx}\\left(D \\frac{dn}{dx}\\right) = 0\n$$\nwhere $n(x)$ is the electron particle density and $x \\in [0,w]$ is the radial coordinate.\n\nSince the diffusivity $D$ derived above is constant with respect to position $x$, the equation simplifies to:\n$$\nD \\frac{d^2n}{dx^2} = 0 \\quad \\implies \\quad \\frac{d^2n}{dx^2} = 0\n$$\nThe general solution to this second-order ordinary differential equation is a linear function of $x$:\n$$\nn(x) = C_1 x + C_2\n$$\nwhere $C_1$ and $C_2$ are integration constants determined by the boundary conditions.\n\nThe boundary conditions are:\n1.  At the separatrix ($x=0$): $n(0) = n_{\\text{sep}}$\n2.  At the wall ($x=w$): $n(w) = 0$\n\nApplying the first boundary condition:\n$$\nn(0) = C_1(0) + C_2 = n_{\\text{sep}} \\quad \\implies \\quad C_2 = n_{\\text{sep}}\n$$\nApplying the second boundary condition:\n$$\nn(w) = C_1 w + C_2 = 0 \\quad \\implies \\quad C_1 w + n_{\\text{sep}} = 0 \\quad \\implies \\quad C_1 = -\\frac{n_{\\text{sep}}}{w}\n$$\nThe density profile across the stochastic layer is therefore:\n$$\nn(x) = -\\frac{n_{\\text{sep}}}{w} x + n_{\\text{sep}} = n_{\\text{sep}}\\left(1 - \\frac{x}{w}\\right)\n$$\nThe particle flux density $\\Gamma(x)$ is given by Fick's first law of diffusion:\n$$\n\\Gamma(x) = -D \\frac{dn}{dx}\n$$\nCalculating the density gradient:\n$$\n\\frac{dn}{dx} = \\frac{d}{dx}\\left[n_{\\text{sep}}\\left(1 - \\frac{x}{w}\\right)\\right] = -\\frac{n_{\\text{sep}}}{w}\n$$\nSubstituting this into the expression for the flux:\n$$\n\\Gamma(x) = -D \\left(-\\frac{n_{\\text{sep}}}{w}\\right) = \\frac{D n_{\\text{sep}}}{w}\n$$\nThe flux is constant throughout the layer, as expected for a steady state with no internal sources or sinks. The outward particle flux density at the wall, $\\Gamma_w$, is this constant value:\n$$\n\\Gamma_w = \\frac{D n_{\\text{sep}}}{w}\n$$\nSubstituting the expression for $D$ from Part 1:\n$$\n\\Gamma_w = \\frac{v_{\\parallel} L_c \\left(\\frac{\\delta B}{B}\\right)^2 n_{\\text{sep}}}{w}\n$$\n\n**Part 3: Numerical Calculation**\n\nWe now substitute the given numerical values into the final expression for $\\Gamma_w$.\n\nFirst, calculate the electron parallel speed $v_{\\parallel}$, which is taken to be the electron thermal speed $v_{\\text{th},e}$. The problem states $v_{\\text{th},e} \\doteq \\sqrt{2 T_{e} e / m_{e}}$, where $T_e = 2.0\\,\\text{keV}$ is interpreted as an energy. The energy in Joules is $E = (2.0 \\times 10^3\\,\\text{eV}) \\times e = (2.0 \\times 10^3) \\times (1.602\\,176\\,634 \\times 10^{-19}\\,\\text{C}) \\approx 3.204 \\times 10^{-16}\\,\\text{J}$.\n\nUsing the provided constants:\n$T_e e = (2.0 \\times 10^3) \\times (1.602\\,176\\,634 \\times 10^{-19}\\,\\text{J}) = 3.204\\,353\\,268 \\times 10^{-16}\\,\\text{J}$\n$m_e = 9.109\\,383\\,7015 \\times 10^{-31}\\,\\text{kg}$\n\n$$\nv_{\\parallel} = \\sqrt{\\frac{2 T_e e}{m_e}} = \\sqrt{\\frac{2 \\times (3.204\\,353\\,268 \\times 10^{-16}\\,\\text{J})}{9.109\\,383\\,7015 \\times 10^{-31}\\,\\text{kg}}} \\approx 2.652\\,382\\,9 \\times 10^7\\,\\text{m}\\,\\text{s}^{-1}\n$$\n\nNow, assemble the expression for $\\Gamma_w$ using the remaining parameters:\n$L_c = 15\\,\\text{m}$\n$\\delta B/B = 1.0 \\times 10^{-3}$\n$n_{\\text{sep}} = 5.0 \\times 10^{19}\\,\\text{m}^{-3}$\n$w = 0.020\\,\\text{m}$\n\n$$\n\\Gamma_w = \\frac{(2.652\\,382\\,9 \\times 10^7\\,\\text{m}\\,\\text{s}^{-1}) \\times (15\\,\\text{m}) \\times (1.0 \\times 10^{-3})^2 \\times (5.0 \\times 10^{19}\\,\\text{m}^{-3})}{0.020\\,\\text{m}}\n$$\n$$\n\\Gamma_w = \\frac{(2.652\\,382\\,9 \\times 10^7) \\times 15 \\times (1.0 \\times 10^{-6}) \\times (5.0 \\times 10^{19})}{0.020} \\,\\text{m}^{-2}\\,\\text{s}^{-1}\n$$\n$$\n\\Gamma_w \\approx 9.946\\,436 \\times 10^{23}\\,\\text{m}^{-2}\\,\\text{s}^{-1}\n$$\n\nRounding the result to three significant figures as requested:\n$$\n\\Gamma_w \\approx 9.95 \\times 10^{23}\\,\\text{m}^{-2}\\,\\text{s}^{-1}\n$$",
            "answer": "$$\\boxed{9.95 \\times 10^{23}}$$"
        },
        {
            "introduction": "Building on our ability to calculate stochastic diffusivity, this final practice addresses a more complex and realistic scenario: heat transport in the presence of a partial transport barrier. Such barriers, which can spontaneously form or be actively created in fusion plasmas, are critical for improving confinement, and modeling their effect is a key task in transport physics . This exercise requires you to combine the principles of stochastic transport with heat transfer theory to analyze a multi-region system, honing both the analytical and computational skills needed for practical transport modeling.",
            "id": "3720082",
            "problem": "Consider steady radial heat transport in a toroidally confined plasma in which the magnetic field lines are stochastic. Assume that, in the collisionless limit, rapid parallel conduction makes the temperature nearly constant along a stochastic field line and that cross-field heat transport arises from the field-line radial wandering. Use the following foundational facts as the starting point:\n\n- The effective heat flux density across magnetic surfaces satisfies $q_{r} = - H \\, \\chi_{\\mathrm{eff}}(r) \\, \\frac{dT}{dr}$, where $H = n C_{v}$ is the volumetric heat capacity (in $\\mathrm{J}/(\\mathrm{m}^{3}\\,\\mathrm{K})$), and $\\chi_{\\mathrm{eff}}$ is the cross-field thermal diffusivity (in $\\mathrm{m}^{2}/\\mathrm{s}$).\n- For stochastic field lines with parallel arclength $s$ and mean-square radial displacement $\\langle \\Delta r^{2} \\rangle = 2 D_{\\mathrm{fl}} \\, s$, where $D_{\\mathrm{fl}}$ is the field-line diffusion coefficient (in $\\mathrm{m}$), the ballistic parallel motion $s \\approx v_{\\parallel} t$ with characteristic parallel speed $v_{\\parallel}$ (in $\\mathrm{m}/\\mathrm{s}$) implies an effective cross-field diffusivity $\\chi_{\\mathrm{eff}} \\approx v_{\\parallel} D_{\\mathrm{fl}}$ (in $\\mathrm{m}^{2}/\\mathrm{s}$).\n- For a single-scale magnetic perturbation with parallel correlation length $L_{c}$ (in $\\mathrm{m}$) and normalized magnetic fluctuation amplitude $\\delta B/B$ (dimensionless), a well-tested estimate for the field-line diffusion is $D_{\\mathrm{fl}} \\approx (\\delta B/B)^{2} L_{c}$.\n- A partial barrier to radial heat flow located at radius $r = r_{b}$ can be modeled as an interface thermal resistance per unit area $R_{b}$ (in $\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$), producing a temperature jump $\\Delta T_{\\mathrm{barrier}} = q_{r} \\, R_{b}$ under steady, one-dimensional conditions.\n\nAssume a cylindrical radial domain $r \\in [0,a]$ with $a > 0$, steady state with no internal sources, and a boundary temperature $T(0) = T_{0}$ and $T(a) = T_{a}$. Let $H$ be radially constant. Let the effective cross-field diffusivity be piecewise constant: $\\chi_{\\mathrm{eff}}(r) = \\chi_{\\mathrm{L}}$ for $0 \\le r  r_{b}$ and $\\chi_{\\mathrm{eff}}(r) = \\chi_{\\mathrm{R}}$ for $r_{b}  r \\le a$, with a single barrier of resistance $R_{b}$ at $r = r_{b}$. The diffusivities $\\chi_{\\mathrm{L}}$ and $\\chi_{\\mathrm{R}}$ must be computed from the given magnetic parameters using the relations above.\n\nYour task is to compute the steady, uniform radial heat flux $q_{r}$ for several parameter sets. By integrating the one-dimensional steady conduction law and enforcing the interface condition at the barrier, the result can be expressed in terms of the boundary temperatures, the material property $H$, the piecewise diffusivities, and the barrier resistance. You must:\n\n- Derive the needed expressions starting only from the items listed above.\n- Implement a program that, for each test case, computes $q_{r}$ and reports it in $\\mathrm{W}/\\mathrm{m}^{2}$, rounded to the nearest integer.\n\nUse the following fixed global parameters (identical for all test cases):\n\n- Domain size: $a = 1.0\\,\\mathrm{m}$.\n- Barrier location: $r_{b} = 0.5\\,\\mathrm{m}$.\n- Volumetric heat capacity: $H = 4.0 \\times 10^{-3}\\,\\mathrm{J}/(\\mathrm{m}^{3}\\,\\mathrm{K})$.\n- Inner boundary temperature: $T_{0} = 1.5 \\times 10^{7}\\,\\mathrm{K}$.\n- Outer boundary temperature: $T_{a} = 1.0 \\times 10^{7}\\,\\mathrm{K}$.\n- Parallel speed: $v_{\\parallel} = 1.5 \\times 10^{7}\\,\\mathrm{m}/\\mathrm{s}$.\n\nFor each test case $i$, you are given:\n- Left correlation length $L_{c,\\mathrm{L}}$ (in $\\mathrm{m}$).\n- Right correlation length $L_{c,\\mathrm{R}}$ (in $\\mathrm{m}$).\n- Left fluctuation amplitude $(\\delta B/B)_{\\mathrm{L}}$ (dimensionless).\n- Right fluctuation amplitude $(\\delta B/B)_{\\mathrm{R}}$ (dimensionless).\n- Barrier resistance $R_{b}$ (in $\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$).\n\nCompute:\n- $D_{\\mathrm{fl},\\mathrm{L}} = [(\\delta B/B)_{\\mathrm{L}}]^{2} \\, L_{c,\\mathrm{L}}$ and $D_{\\mathrm{fl},\\mathrm{R}} = [(\\delta B/B)_{\\mathrm{R}}]^{2} \\, L_{c,\\mathrm{R}}$.\n- $\\chi_{\\mathrm{L}} = v_{\\parallel} D_{\\mathrm{fl},\\mathrm{L}}$ and $\\chi_{\\mathrm{R}} = v_{\\parallel} D_{\\mathrm{fl},\\mathrm{R}}$.\n- The steady flux $q_{r}$ in $\\mathrm{W}/\\mathrm{m}^{2}$, rounded to the nearest integer.\n\nTest suite (four cases that probe typical, no-barrier, strong-barrier, and asymmetric-transport regimes):\n\n- Case $1$ (typical, moderate barrier):\n  - $L_{c,\\mathrm{L}} = 10.0\\,\\mathrm{m}$, $L_{c,\\mathrm{R}} = 10.0\\,\\mathrm{m}$,\n  - $(\\delta B/B)_{\\mathrm{L}} = 1.0 \\times 10^{-3}$, $(\\delta B/B)_{\\mathrm{R}} = 1.0 \\times 10^{-3}$,\n  - $R_{b} = 0.3\\,\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$.\n\n- Case $2$ (no barrier):\n  - $L_{c,\\mathrm{L}} = 10.0\\,\\mathrm{m}$, $L_{c,\\mathrm{R}} = 10.0\\,\\mathrm{m}$,\n  - $(\\delta B/B)_{\\mathrm{L}} = 1.0 \\times 10^{-3}$, $(\\delta B/B)_{\\mathrm{R}} = 1.0 \\times 10^{-3}$,\n  - $R_{b} = 0.0\\,\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$.\n\n- Case $3$ (strong barrier):\n  - $L_{c,\\mathrm{L}} = 10.0\\,\\mathrm{m}$, $L_{c,\\mathrm{R}} = 10.0\\,\\mathrm{m}$,\n  - $(\\delta B/B)_{\\mathrm{L}} = 1.0 \\times 10^{-3}$, $(\\delta B/B)_{\\mathrm{R}} = 1.0 \\times 10^{-3}$,\n  - $R_{b} = 10.0\\,\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$.\n\n- Case $4$ (asymmetric stochasticity and moderate barrier):\n  - $L_{c,\\mathrm{L}} = 10.0\\,\\mathrm{m}$, $L_{c,\\mathrm{R}} = 5.0\\,\\mathrm{m}$,\n  - $(\\delta B/B)_{\\mathrm{L}} = 5.0 \\times 10^{-4}$, $(\\delta B/B)_{\\mathrm{R}} = 2.0 \\times 10^{-3}$,\n  - $R_{b} = 0.1\\,\\mathrm{m}^{2}\\,\\mathrm{K}/\\mathrm{W}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be the integer value of $q_{r}$ in $\\mathrm{W}/\\mathrm{m}^{2}$ for the corresponding test case, rounded to the nearest integer.",
            "solution": "The solution is derived by applying the principles of steady-state heat conduction across a multi-layered medium with an interface resistance.\n\nThe foundational equation for the radial heat flux density, $q_r$, is given as:\n$$\nq_{r} = - H \\, \\chi_{\\mathrm{eff}}(r) \\, \\frac{dT}{dr}\n$$\nHere, $H$ is the constant volumetric heat capacity, $\\chi_{\\mathrm{eff}}(r)$ is the piecewise constant effective thermal diffusivity, and $T(r)$ is the temperature profile. We are given that the problem is in a steady state with no internal heat sources, and the radial heat flux $q_r$ is uniform (constant with respect to $r$). This allows us to rearrange the equation to solve for the temperature gradient:\n$$\n\\frac{dT}{dr} = - \\frac{q_r}{H \\, \\chi_{\\mathrm{eff}}(r)}\n$$\nThe total temperature drop across the domain from $r=0$ to $r=a$ is $T(0) - T(a) = T_0 - T_a$. This total drop is the sum of the temperature drops across the three distinct thermal barriers: the inner region ($0 \\le r  r_b$), the interface at $r=r_b$, and the outer region ($r_b  r \\le a$).\n\n1.  **Temperature drop in the inner region ($0 \\le r  r_b$):**\n    In this region, $\\chi_{\\mathrm{eff}}(r) = \\chi_{\\mathrm{L}}$. The temperature drop, $\\Delta T_L$, is found by integrating the temperature gradient from $r=0$ to $r=r_b^{-}$ (the inner side of the barrier):\n    $$\n    \\Delta T_L = T(0) - T(r_b^{-}) = \\int_{0}^{r_b} \\left( - \\frac{dT}{dr} \\right) dr = \\int_{0}^{r_b} \\frac{q_r}{H \\chi_{\\mathrm{L}}} dr\n    $$\n    Since $q_r$, $H$, and $\\chi_{\\mathrm{L}}$ are constants within this region, we have:\n    $$\n    \\Delta T_L = \\frac{q_r r_b}{H \\chi_{\\mathrm{L}}}\n    $$\n\n2.  **Temperature drop at the interface barrier ($r=r_b$):**\n    The problem states that the barrier introduces a temperature jump, $\\Delta T_b$, proportional to the flux and the interface thermal resistance $R_b$:\n    $$\n    \\Delta T_b = T(r_b^{-}) - T(r_b^{+}) = q_r R_b\n    $$\n\n3.  **Temperature drop in the outer region ($r_b  r \\le a$):**\n    In this region, $\\chi_{\\mathrm{eff}}(r) = \\chi_{\\mathrm{R}}$. The temperature drop, $\\Delta T_R$, is found by integrating from $r=r_b^{+}$ (the outer side of the barrier) to $r=a$:\n    $$\n    \\Delta T_R = T(r_b^{+}) - T(a) = \\int_{r_b}^{a} \\left( - \\frac{dT}{dr} \\right) dr = \\int_{r_b}^{a} \\frac{q_r}{H \\chi_{\\mathrm{R}}} dr\n    $$\n    Again, treating the terms as constant within the region:\n    $$\n    \\Delta T_R = \\frac{q_r (a-r_b)}{H \\chi_{\\mathrm{R}}}\n    $$\n\nThe total temperature drop $T_0 - T_a$ is the sum of these individual drops:\n$$\nT_0 - T_a = \\Delta T_L + \\Delta T_b + \\Delta T_R = \\frac{q_r r_b}{H \\chi_{\\mathrm{L}}} + q_r R_b + \\frac{q_r (a-r_b)}{H \\chi_{\\mathrm{R}}}\n$$\nThis expression is analogous to Ohm's law, $V = I R_{\\text{total}}$, where $T_0 - T_a$ is the potential difference, $q_r$ is the current, and the term in parentheses is the total thermal resistance. Factoring out $q_r$:\n$$\nT_0 - T_a = q_r \\left( \\frac{r_b}{H \\chi_{\\mathrm{L}}} + R_b + \\frac{a-r_b}{H \\chi_{\\mathrm{R}}} \\right)\n$$\nSolving for the steady, uniform heat flux $q_r$ yields the final analytical expression:\n$$\nq_r = \\frac{T_0 - T_a}{\\frac{r_b}{H \\chi_{\\mathrm{L}}} + R_b + \\frac{a-r_b}{H \\chi_{\\mathrm{R}}}}\n$$\nThe diffusivities $\\chi_{\\mathrm{L}}$ and $\\chi_{\\mathrm{R}}$ are computed from the provided magnetic turbulence parameters:\nThe field-line diffusion coefficient, $D_{\\mathrm{fl}}$, is estimated as:\n$$\nD_{\\mathrm{fl}} \\approx \\left(\\frac{\\delta B}{B}\\right)^{2} L_{c}\n$$\nThe effective thermal diffusivity, $\\chi_{\\mathrm{eff}}$, is then given by:\n$$\n\\chi_{\\mathrm{eff}} \\approx v_{\\parallel} D_{\\mathrm{fl}} = v_{\\parallel} \\left(\\frac{\\delta B}{B}\\right)^{2} L_{c}\n$$\nSo, for the left and right regions, we compute:\n$$\n\\chi_{\\mathrm{L}} = v_{\\parallel} \\left[\\left(\\frac{\\delta B}{B}\\right)_{\\mathrm{L}}\\right]^{2} L_{c,\\mathrm{L}}\n$$\n$$\n\\chi_{\\mathrm{R}} = v_{\\parallel} \\left[\\left(\\frac{\\delta B}{B}\\right)_{\\mathrm{R}}\\right]^{2} L_{c,\\mathrm{R}}\n$$\nThese expressions are implemented in the following program to calculate the numerical value of $q_r$ for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are needed.\n\ndef solve():\n    \"\"\"\n    Computes the steady, uniform radial heat flux q_r for several parameter sets\n    related to stochastic magnetic field transport in a plasma.\n    \"\"\"\n    # Define the fixed global parameters.\n    a = 1.0  # Domain size in meters\n    rb = 0.5  # Barrier location in meters\n    H = 4.0e-3  # Volumetric heat capacity in J/(m^3 K)\n    T0 = 1.5e7  # Inner boundary temperature in K\n    Ta = 1.0e7  # Outer boundary temperature in K\n    v_parallel = 1.5e7  # Characteristic parallel speed in m/s\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: typical, moderate barrier\n        {'Lc_L': 10.0, 'Lc_R': 10.0, 'dB_B_L': 1.0e-3, 'dB_B_R': 1.0e-3, 'Rb': 0.3},\n        # Case 2: no barrier\n        {'Lc_L': 10.0, 'Lc_R': 10.0, 'dB_B_L': 1.0e-3, 'dB_B_R': 1.0e-3, 'Rb': 0.0},\n        # Case 3: strong barrier\n        {'Lc_L': 10.0, 'Lc_R': 10.0, 'dB_B_L': 1.0e-3, 'dB_B_R': 1.0e-3, 'Rb': 10.0},\n        # Case 4: asymmetric stochasticity and moderate barrier\n        {'Lc_L': 10.0, 'Lc_R': 5.0, 'dB_B_L': 5.0e-4, 'dB_B_R': 2.0e-3, 'Rb': 0.1},\n    ]\n\n    results = []\n    \n    # Calculate the total temperature difference, which is constant for all cases.\n    delta_T = T0 - Ta\n\n    for case in test_cases:\n        # Unpack parameters for the current case.\n        Lc_L = case['Lc_L']\n        Lc_R = case['Lc_R']\n        dB_B_L = case['dB_B_L']\n        dB_B_R = case['dB_B_R']\n        Rb = case['Rb']\n\n        # Step 1: Compute the field-line diffusion coefficients for each region.\n        # D_fl = (delta_B/B)^2 * L_c\n        D_fl_L = (dB_B_L**2) * Lc_L\n        D_fl_R = (dB_B_R**2) * Lc_R\n\n        # Step 2: Compute the effective cross-field thermal diffusivities.\n        # chi_eff = v_parallel * D_fl\n        chi_L = v_parallel * D_fl_L\n        chi_R = v_parallel * D_fl_R\n\n        # Step 3: Calculate the thermal resistances of the two diffusive regions.\n        # R_diffusive = (layer_thickness) / (H * chi)\n        # Using if condition to avoid division by zero, although not expected with given data.\n        R_L = rb / (H * chi_L) if chi_L > 0 else float('inf')\n        R_R = (a - rb) / (H * chi_R) if chi_R > 0 else float('inf')\n\n        # Step 4: Calculate the total thermal resistance.\n        # This is the sum of the left region, barrier, and right region resistances.\n        R_total = R_L + Rb + R_R\n\n        # Step 5: Compute the steady radial heat flux.\n        # q_r = Delta_T / R_total\n        q_r = delta_T / R_total\n\n        # Step 6: Round the result to the nearest integer and append to the list.\n        results.append(int(round(q_r)))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}