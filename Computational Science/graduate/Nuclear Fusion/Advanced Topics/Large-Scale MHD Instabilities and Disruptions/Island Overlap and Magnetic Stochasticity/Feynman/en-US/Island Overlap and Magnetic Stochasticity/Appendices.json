{
    "hands_on_practices": [
        {
            "introduction": "The landscape of a toroidally confined plasma is defined by its magnetic flux surfaces. This exercise delves into how the radial profile of the safety factor, specifically its gradient or \"magnetic shear,\" determines the fundamental spacing between neighboring resonant surfaces where magnetic islands can form. Understanding this relationship is the first step in predicting whether these islands are isolated or are close enough to interact and cause chaos .",
            "id": "3705821",
            "problem": "Consider a large-aspect-ratio, axisymmetric toroidal plasma with nested flux surfaces characterized by the safety factor profile $q(r)$, where $r$ is a minor-radius-like flux surface label. Rational surfaces occur where $q(r)=m/n$ for coprime integers $m$ and $n$. Magnetic shear is defined as $s_{\\hat{q}}(r)=\\frac{d\\ln q}{d\\ln r}$. In the context of island overlap and the onset of magnetic stochasticity, the radial spacing of nearby rational surfaces controls how easily magnetic islands can overlap. Using only the fundamental definitions of safety factor, rational surfaces, and magnetic shear, derive an analytic expression for the local radial spacing $\\Delta r$ between the adjacent rational surfaces $q(r)=m/n$ and $q(r)=(m+1)/n$. Express your final answer in meters, in closed form, evaluated at the location $r_{m/n}$ where $q(r_{m/n})=m/n$, and write it in terms of $r_{m/n}$, $m$, and $s_{\\hat{q}}(r_{m/n})$. No numerical evaluation is required, and no approximations beyond local smoothness and differentiability of $q(r)$ should be invoked. The final answer must be a single closed-form analytic expression.",
            "solution": "The objective is to derive an analytic expression for the local radial spacing, $\\Delta r$, between two adjacent rational magnetic surfaces defined by the safety factors $q = m/n$ and $q = (m+1)/n$. The final expression must be evaluated at the radial location of the $q=m/n$ surface and be given in terms of the radius $r_{m/n}$, the poloidal mode number $m$, and the magnetic shear $s_{\\hat{q}}(r_{m/n})$.\n\nLet the radial locations of the two specified rational surfaces be denoted by $r_1$ and $r_2$.\nBy definition, the safety factor at these surfaces is:\n$q(r_1) = \\frac{m}{n}$\n$q(r_2) = \\frac{m+1}{n}$\n\nWe define the radial location of the inner surface as $r_{m/n}$, such that $r_1 = r_{m/n}$. The radial location of the adjacent outer surface (assuming a monotonically increasing $q$-profile) is $r_2$. The radial spacing is then $\\Delta r = r_2 - r_1$.\n\nThe change in the safety factor between these two surfaces is:\n$$\n\\Delta q = q(r_2) - q(r_1) = \\frac{m+1}{n} - \\frac{m}{n} = \\frac{1}{n}\n$$\n\nThe problem states that we are interested in the *local* radial spacing, and we assume the safety factor profile $q(r)$ is a smooth and differentiable function of the minor radius $r$. For a small separation $\\Delta r$, the change $\\Delta q$ can be related to $\\Delta r$ using a first-order Taylor expansion of $q(r)$ around the point $r_1$:\n$$\nq(r_2) = q(r_1 + \\Delta r) \\approx q(r_1) + \\left. \\frac{dq}{dr} \\right|_{r=r_1} \\Delta r\n$$\nRearranging this approximation gives:\n$$\n\\Delta q = q(r_2) - q(r_1) \\approx \\left. \\frac{dq}{dr} \\right|_{r=r_1} \\Delta r\n$$\nFrom this, we can express the radial spacing $\\Delta r$ as:\n$$\n\\Delta r \\approx \\frac{\\Delta q}{\\left. \\frac{dq}{dr} \\right|_{r=r_1}}\n$$\n\nTo proceed, we must express the derivative $\\frac{dq}{dr}$ in terms of the provided definition of magnetic shear, $s_{\\hat{q}}(r)$. The magnetic shear is defined as the logarithmic derivative of $q$ with respect to $r$:\n$$\ns_{\\hat{q}}(r) = \\frac{d\\ln q}{d\\ln r}\n$$\nUsing the chain rule for derivatives, we can expand this definition:\n$$\ns_{\\hat{q}}(r) = \\frac{\\frac{1}{q(r)} \\frac{dq(r)}{dr}}{\\frac{1}{r}} = \\frac{r}{q(r)} \\frac{dq(r)}{dr}\n$$\nWe can now solve this equation for the derivative $\\frac{dq}{dr}$:\n$$\n\\frac{dq}{dr} = s_{\\hat{q}}(r) \\frac{q(r)}{r}\n$$\n\nNow, we substitute this expression for the derivative back into our equation for $\\Delta r$:\n$$\n\\Delta r \\approx \\frac{\\Delta q}{s_{\\hat{q}}(r_1) \\frac{q(r_1)}{r_1}}\n$$\nThe problem requires the expression to be evaluated at the location $r_{m/n}$, which corresponds to our defined radius $r_1$. At this location, we have:\n- $r_1 = r_{m/n}$\n- $q(r_1) = \\frac{m}{n}$\n- $\\Delta q = \\frac{1}{n}$\n- $s_{\\hat{q}}(r_1) = s_{\\hat{q}}(r_{m/n})$\n\nSubstituting these specific values into the expression for $\\Delta r$:\n$$\n\\Delta r \\approx \\frac{\\frac{1}{n}}{s_{\\hat{q}}(r_{m/n}) \\frac{m/n}{r_{m/n}}}\n$$\n\nWe now simplify this algebraic expression. The term $1/n$ appears in both the numerator and the denominator, allowing for cancellation:\n$$\n\\Delta r \\approx \\frac{1}{n} \\cdot \\frac{r_{m/n}}{s_{\\hat{q}}(r_{m/n}) (m/n)} = \\frac{1}{n} \\cdot \\frac{n \\cdot r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}\n$$\n$$\n\\Delta r = \\frac{r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}\n$$\nThis is the final analytical expression for the radial spacing $\\Delta r$ between the $q=m/n$ and $q=(m+1)/n$ surfaces. It is given in terms of the local radius $r_{m/n}$, the poloidal mode number $m$, and the local magnetic shear $s_{\\hat{q}}(r_{m/n})$, as required. Since $r_{m/n}$ has units of meters and both $m$ and $s_{\\hat{q}}$ are dimensionless quantities, the resulting $\\Delta r$ correctly has units of meters. The sign of $\\Delta r$ is determined by the sign of the magnetic shear; for a standard positive shear profile ($s_{\\hat{q}} > 0$), $q$ increases with $r$, and $\\Delta r$ is positive, as expected.",
            "answer": "$$\n\\boxed{\\frac{r_{m/n}}{m \\cdot s_{\\hat{q}}(r_{m/n})}}\n$$"
        },
        {
            "introduction": "While the Hamiltonian framework provides an elegant description of island width in terms of magnetic flux, $\\Delta\\psi$, experimental measurements are made in physical space. This essential practice demonstrates how to translate the abstract, coordinate-independent flux width into a tangible radial width, $\\Delta r$. Mastering this conversion is crucial for comparing theoretical predictions with diagnostic data from real fusion devices .",
            "id": "3705784",
            "problem": "Consider a large–aspect-ratio, circular cross-section tokamak with major radius $R_0$ and minor radius $a$. Let the toroidal magnetic field be approximately constant in radius near a rational surface $r=r_s$, with $B_{\\phi}(r_s)$, and let the safety factor $q(r)$ satisfy $q(r_s)=m/n$ at the rational surface of an $m/n$ magnetic island. Define the poloidal magnetic flux coordinate $\\psi(r)$ such that $2\\pi \\psi(r)$ equals the total poloidal magnetic flux enclosed by the magnetic surface labeled by the minor radius $r$. A saturated magnetic island has a half-width $\\Delta \\psi$ specified in the poloidal-flux coordinate.\n\nUsing only fundamental geometric definitions of the poloidal flux and the safety factor in a circular, axisymmetric tokamak, derive the expression for the radial half-width $\\Delta r$ of the island in terms of $\\Delta \\psi$, $q(r_s)$, $r_s$, and $B_{\\phi}(r_s)$. Evaluate $\\Delta r$ numerically for the following parameters:\n- $R_0 = 3.0\\,\\text{m}$,\n- $r_s = 0.40\\,\\text{m}$,\n- $B_{\\phi}(r_s) = 5.3\\,\\text{T}$,\n- $q(r_s) = 2.5$,\n- $\\Delta \\psi = 2.2\\times 10^{-2}\\,\\text{Wb}$.\n\nThen, explain how the island width depends on the choice of radial coordinate $x$ when $x$ is a monotonic function of $\\psi$, and provide the general transformation rule relating $\\Delta x$ to $\\Delta \\psi$. Your numerical answer must be the value of $\\Delta r$ and must be expressed in meters. Round your numerical answer to four significant figures.",
            "solution": "The problem asks for the derivation of the radial half-width $\\Delta r$ of a magnetic island, its numerical evaluation, and an explanation of how the island width depends on the chosen radial coordinate.\n\nFirst, we derive the relationship between the radial half-width $\\Delta r$ and the half-width in the poloidal flux coordinate, $\\Delta \\psi$. The derivation begins with the fundamental definition of the safety factor, $q$, in terms of magnetic fluxes. The safety factor is the ratio of the differential change in toroidal magnetic flux, $d\\Phi$, to the differential change in poloidal magnetic flux, $d\\Psi_p$.\n$$q = \\frac{d\\Phi}{d\\Psi_p}$$\nThe problem states that the poloidal magnetic flux is given by $2\\pi\\psi(r)$, so we have $\\Psi_p = 2\\pi\\psi$. Substituting this into the definition of $q$ yields:\n$$q = \\frac{d\\Phi}{d(2\\pi\\psi)} = \\frac{1}{2\\pi} \\frac{d\\Phi}{d\\psi}$$\nTo proceed, we need expressions for the fluxes. For a large–aspect-ratio, circular cross-section tokamak, the toroidal magnetic flux $\\Phi$ enclosed within a minor radius $r$ can be approximated by integrating the toroidal magnetic field $B_{\\phi}$ over the circular area $\\pi r^2$. The problem states that $B_{\\phi}$ is approximately constant near the rational surface $r_s$. We can thus write:\n$$\\Phi(r) \\approx \\pi r^2 B_{\\phi}(r)$$\nThe derivative of the toroidal flux with respect to the minor radius $r$ is:\n$$\\frac{d\\Phi}{dr} = 2\\pi r B_{\\phi}(r)$$\nUsing the chain rule, we can relate the derivative with respect to $\\psi$ to the derivative with respect to $r$:\n$$\\frac{d\\Phi}{d\\psi} = \\frac{d\\Phi}{dr} \\frac{dr}{d\\psi} = \\left(2\\pi r B_{\\phi}(r)\\right) \\frac{dr}{d\\psi}$$\nSubstituting this back into the expression for $q$:\n$$q(r) = \\frac{1}{2\\pi} \\left(2\\pi r B_{\\phi}(r) \\frac{dr}{d\\psi}\\right) = r B_{\\phi}(r) \\frac{dr}{d\\psi}$$\nThis equation provides the crucial relationship between the radial coordinate $r$ and the flux coordinate $\\psi$. We can rearrange it to express the derivative of $\\psi$ with respect to $r$:\n$$\\frac{d\\psi}{dr} = \\frac{r B_{\\phi}(r)}{q(r)}$$\nA magnetic island is a small structure localized around a rational surface $r_s$. For a small island half-width, we can use a linear approximation to relate the change in radius, $\\Delta r$, to the corresponding change in the flux coordinate, $\\Delta \\psi$.\n$$\\Delta \\psi \\approx \\frac{d\\psi}{dr}\\bigg|_{r=r_s} \\Delta r$$\nSubstituting our expression for the derivative evaluated at the rational surface $r=r_s$:\n$$\\Delta \\psi \\approx \\left(\\frac{r_s B_{\\phi}(r_s)}{q(r_s)}\\right) \\Delta r$$\nSolving for the radial half-width $\\Delta r$, we obtain the desired expression:\n$$\\Delta r \\approx \\frac{q(r_s) \\Delta \\psi}{r_s B_{\\phi}(r_s)}$$\nNext, we evaluate $\\Delta r$ numerically using the provided parameters:\n- $q(r_s) = 2.5$\n- $\\Delta \\psi = 2.2 \\times 10^{-2}\\,\\text{Wb}$\n- $r_s = 0.40\\,\\text{m}$\n- $B_{\\phi}(r_s) = 5.3\\,\\text{T}$\n\nPlugging these values into the derived formula:\n$$\\Delta r = \\frac{(2.5) \\times (2.2 \\times 10^{-2}\\,\\text{Wb})}{(0.40\\,\\text{m}) \\times (5.3\\,\\text{T})}$$\n$$\\Delta r = \\frac{5.5 \\times 10^{-2}\\,\\text{Wb}}{2.12\\,\\text{T}\\cdot\\text{m}}$$\nThe units are consistent, as $1\\,\\text{Wb} = 1\\,\\text{T}\\cdot\\text{m}^2$.\n$$\\Delta r = \\frac{5.5 \\times 10^{-2}}{2.12}\\,\\text{m} \\approx 0.025943396\\,\\text{m}$$\nRounding the result to four significant figures as requested:\n$$\\Delta r \\approx 0.02594\\,\\text{m}$$\n\nFinally, we address the dependence of the island width on the choice of radial coordinate. The fundamental, coordinate-independent measure of an island's size is its half-width in magnetic flux, $\\Delta \\psi$ (or, more precisely, the reconnected flux). Any other radial coordinate, let's call it $x$, is a monotonic function of the poloidal flux, so we can write $x = x(\\psi)$. The width of the island expressed in the coordinate $x$, denoted $\\Delta x$, represents the change in $x$ from the island's O-point to its separatrix. For a small island, this change can be related to $\\Delta \\psi$ through a first-order Taylor expansion:\n$$\\Delta x \\approx \\frac{dx}{d\\psi}\\bigg|_{\\psi=\\psi_s} \\Delta \\psi$$\nwhere $\\psi_s$ is the value of the flux coordinate at the rational surface. This is the general transformation rule.\n\nThis rule shows that the island width is not an invariant spatial quantity; its numerical value depends directly on the definition of the radial coordinate used for the measurement. The term $\\frac{dx}{d\\psi}$ acts as a \"metric\" that converts the flux width into a spatial width in the chosen coordinate system. For the radial coordinate $x=r$, we found $\\frac{dr}{d\\psi} = \\frac{q}{rB_{\\phi}}$, which recovers our initial formula. If we had chosen a different coordinate, such as the normalized toroidal flux $\\rho = \\sqrt{\\Phi/\\Phi_a}$ (where $\\Phi_a$ is the total toroidal flux), the expression for the island width $\\Delta \\rho$ would be different, determined by the derivative $\\frac{d\\rho}{d\\psi}$ at the rational surface.",
            "answer": "$$\\boxed{0.02594}$$"
        },
        {
            "introduction": "Having established the concepts of island width and spacing, we can now witness the emergence of chaos firsthand. This hands-on numerical exercise employs a two-resonance twist map, a powerful discrete model for Hamiltonian dynamics, to directly test the Chirikov island overlap criterion. You will implement the map, calculate the theoretical threshold for chaos, and then use numerical diagnostics like the Lyapunov exponent to observe the transition to a stochastic magnetic field .",
            "id": "3705723",
            "problem": "Consider a two-resonance, area-preserving twist map that models magnetic field line dynamics in toroidal magnetic confinement for nuclear fusion, written in angle-action variables $(\\theta,I)$ with $\\theta \\in [0,2\\pi)$ (in radians) and $I \\in \\mathbb{R}$. The map is defined by\n$$\nI_{n+1} = I_n + K_1 \\sin(m_1 \\theta_n) + K_2 \\sin(m_2 \\theta_n), \\quad \\theta_{n+1} = \\theta_n + I_{n+1} \\pmod{2\\pi},\n$$\nwhere $K_1$, $K_2$ are perturbation amplitudes and $m_1$, $m_2$ are positive integers representing the harmonic mode numbers of two resonant perturbations. This is a canonical, discrete-time approximation of a near-integrable Hamiltonian system with a twist (frequency) $\\omega(I) = I$, which captures magnetic island chains and the onset of magnetic stochasticity via island overlap.\n\nStarting from first principles, use the following foundational basis:\n- The definition of a twist map with $\\omega(I) = I$ and the resonance condition that a harmonic $m$ is resonant when the rotation per iteration $I$ satisfies $m I \\approx 2\\pi q$ for integer $q$.\n- The local pendulum approximation near a resonance to estimate resonance widths in $I$.\n- The Chirikov overlap criterion, which predicts the onset of widespread stochasticity when the sum of resonance half-widths exceeds the distance in action between resonance centers.\n\nYour tasks are:\n- Derive an expression for the primary resonance centers $I_{\\mathrm{res},j}$ (choose $q=1$) for the two harmonics $m_1$ and $m_2$, and a computable expression for the action-space separation $\\Delta I_{\\mathrm{res}} = |I_{\\mathrm{res},1} - I_{\\mathrm{res},2}|$.\n- Using the pendulum approximation near each resonance and the twist $\\frac{d\\omega}{dI} = 1$, derive a computable expression for each resonance half-width $w_j$ in action space in terms of $K_j$ and $m_j$.\n- Define the Chirikov overlap parameter\n$$\nS = \\frac{w_1 + w_2}{\\Delta I_{\\mathrm{res}}}.\n$$\nNumerically evaluate $S$ for given $(K_1,m_1,K_2,m_2)$, and compare to iterated-map diagnostics of stochastic layer formation.\n\nTo compare to iterated-map results, implement the map above and compute two numerical diagnostics over $N$ iterations:\n- A finite-time largest Lyapunov exponent $\\lambda$ estimated from the tangent map linearization (rescaling a tangent vector at each iteration and averaging the logarithmic growth).\n- The standard deviation of the action variable $I$ over the post-transient portion of the orbit (discarding an initial transient).\n\nDeclare “stochastic layer formation” as a boolean when either the finite-time largest Lyapunov exponent exceeds a small positive threshold or the standard deviation of $I$ exceeds a fraction of the resonance separation:\n- Use $\\lambda_{\\mathrm{thr}} = 0.01$ and $\\sigma_{\\mathrm{thr}} = 0.30 \\, \\Delta I_{\\mathrm{res}}$.\n- Sample initial angles $\\theta_0 \\in \\{0.1,1.0,2.0,3.0\\}$ (in radians). For each test case, initialize the action at the midpoint of the two resonance centers,\n$$\nI_0 = \\frac{I_{\\mathrm{res},1} + I_{\\mathrm{res},2}}{2} = \\pi \\left(\\frac{1}{m_1} + \\frac{1}{m_2}\\right),\n$$\nand take the maximum Lyapunov exponent and maximum $I$ standard deviation over the sampled $\\theta_0$ as the representative diagnostics for that case.\n\nAngles must be treated in radians. No other physical units are required.\n\nImplement the above and solve the following test suite of parameter sets, where all $m_j$ are integers and all $K_j$ are nonnegative real numbers:\n- Test $1$: $(m_1,m_2,K_1,K_2,N) = (3,5,0.05,0.05,40000)$.\n- Test $2$: $(m_1,m_2,K_1,K_2,N) = (3,5,0.30,0.30,40000)$.\n- Test $3$: $(m_1,m_2,K_1,K_2,N) = (2,7,0.30,0.30,40000)$.\n- Test $4$: $(m_1,m_2,K_1,K_2,N) = (3,4,0.06,0.06,40000)$.\n\nFor each test, output a pair consisting of the Chirikov parameter $S$ rounded to three decimal places and the boolean indicating whether a stochastic layer is detected by the iterated-map diagnostics as defined above.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the pair for one test in the same order as listed:\n$$\n\\big[ [S_1,\\text{bool}_1],[S_2,\\text{bool}_2],[S_3,\\text{bool}_3],[S_4,\\text{bool}_4] \\big].\n$$",
            "solution": "The solution involves deriving the Chirikov parameter $S$ and comparing its value to numerical diagnostics of chaos.\n\n**Resonance Centers and Separation**\nThe map's frequency is $\\omega(I) = I$. A primary resonance ($q=1$) for a harmonic mode $m_j$ occurs when $m_j I = 2\\pi$, giving the resonance location:\n$$I_{\\mathrm{res},j} = \\frac{2\\pi}{m_j}$$\nThe separation between the two resonance centers is:\n$$\\Delta I_{\\mathrm{res}} = |I_{\\mathrm{res},1} - I_{\\mathrm{res},2}| = 2\\pi \\left| \\frac{1}{m_1} - \\frac{1}{m_2} \\right|$$\n\n**Resonance Half-Width**\nUsing the pendulum approximation for an isolated resonance, the half-width of the island separatrix in action space, $w_j$, is given by:\n$$w_j = 2\\sqrt{\\frac{K_j}{m_j}}$$\n\n**Chirikov Overlap Parameter**\nThe Chirikov parameter $S$ is the ratio of the sum of adjacent island half-widths to their separation. Widespread chaos is predicted when $S \\gtrsim 1$.\n$$S = \\frac{w_1 + w_2}{\\Delta I_{\\mathrm{res}}} = \\frac{\\sqrt{K_1/m_1} + \\sqrt{K_2/m_2}}{\\pi |1/m_1 - 1/m_2|}$$\n\n**Numerical Diagnostics and Evaluation**\nThe map is iterated numerically for each test case. Orbits are started at the action midpoint $I_0$ for several initial angles $\\theta_0$. Two diagnostics are computed:\n1.  The finite-time largest Lyapunov exponent ($\\lambda$) is calculated from the tangent map. Chaos is indicated if $\\lambda > 0.01$.\n2.  The standard deviation of the action ($\\sigma_I$) is calculated over the latter part of the orbit. Chaos is indicated if $\\sigma_I > 0.30 \\Delta I_{\\mathrm{res}}$.\nA stochastic layer is considered formed if either condition is met for any of the initial conditions. The value of $S$ is computed for each test case and paired with the boolean result from the numerical diagnostics.",
            "answer": "$$\n\\boxed{[[0.547, \\text{false}], [1.341, \\text{true}], [0.530, \\text{false}], [1.008, \\text{true}]]}\n$$"
        }
    ]
}