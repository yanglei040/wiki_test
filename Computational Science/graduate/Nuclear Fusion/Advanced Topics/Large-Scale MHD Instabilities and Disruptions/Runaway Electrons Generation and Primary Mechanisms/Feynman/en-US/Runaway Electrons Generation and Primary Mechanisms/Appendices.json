{
    "hands_on_practices": [
        {
            "introduction": "Understanding the genesis of runaway electrons begins with a precise definition of the \"point of no return\" in momentum space. This exercise guides you through deriving the separatrix, the critical boundary separating electrons that are slowed down by collisions from those that are destined for continuous acceleration by the electric field . By analyzing the balance of forces in the relativistic regime, you will develop a foundational understanding of how an electron's energy and its direction of motion relative to the electric field determine its fate.",
            "id": "3717540",
            "problem": "Consider a uniform magnetized plasma with a constant electric field $E$ directed parallel to the magnetic field. An electron with momentum $\\mathbf{p}$ makes a pitch angle $\\theta$ with respect to the magnetic field, with pitch-angle cosine $\\xi \\equiv \\cos\\theta = p_{\\parallel}/p$. Introduce the normalized momentum $y \\equiv p/(m_{e} c)$ and the associated Lorentz factor $\\gamma = \\sqrt{1 + y^{2}}$, where $m_{e}$ is the electron mass and $c$ is the speed of light. In the guiding-center approximation, the electric field does work only through its component parallel to the magnetic field, while Coulomb collisions exert a drag force $\\mathbf{F}_{c}$ opposing the electron velocity, whose magnitude $F_{c}(y)$ depends on $y$.\n\nDefine the critical electric field $E_{c}$ by the well-tested cold-plasma high-energy balance condition\n$$\n\\lim_{y \\to \\infty} F_{c}(y) = e\\,E_{c}, \\quad \\text{with} \\quad E_{c} = \\frac{n_{e} e^{3} \\ln\\Lambda}{4 \\pi \\epsilon_{0}^{2} m_{e} c^{2}},\n$$\nwhere $n_{e}$ is the electron density, $e$ is the elementary charge, $\\epsilon_{0}$ is the vacuum permittivity, and $\\ln\\Lambda$ is the Coulomb logarithm. Let the dimensionless electric field be $\\mathcal{E} \\equiv E/E_{c}$, and introduce the dimensionless collisional drag $\\phi(y) \\equiv F_{c}(y)/(e E_{c})$, so that $\\phi(y) \\to 1$ as $y \\to \\infty$.\n\nThe separatrix in momentum space between net acceleration toward higher momentum (runaway) and net deceleration (slowing down) is defined by the condition that the net drift of the momentum magnitude vanishes, i.e., the component of electric acceleration along $\\mathbf{p}$ is exactly balanced by the collisional drag. Starting from fundamental force balance and kinematics, express the separatrix condition as an explicit relation between $\\xi$ and $y$, written in terms of $\\phi(y)$ and $\\mathcal{E}$. Then, analyze the ultra-relativistic limit $y \\gg 1$ and obtain the limiting value of the separatrix pitch-angle cosine $\\xi_{s,\\infty}$ as a closed-form expression in terms of $\\mathcal{E}$.\n\nYour final answer must be the single symbolic expression for $\\xi_{s,\\infty}$ in terms of $\\mathcal{E}$. No numerical evaluation is required, and no units are needed in the final answer.",
            "solution": "The problem requires the derivation of the separatrix condition in momentum space for runaway electrons and its ultra-relativistic limit. The validation process confirms that the problem statement is scientifically grounded, well-posed, and objective. It is a standard theoretical problem in plasma physics.\n\nFirst, we determine the rate of change of the magnitude of the electron's momentum, $p \\equiv |\\mathbf{p}|$. The time derivative of the momentum magnitude is the projection of the net force vector, $\\mathbf{F}_{\\text{net}}$, onto the direction of the momentum vector, $\\hat{\\mathbf{p}} = \\mathbf{p}/p$.\n$$\n\\frac{dp}{dt} = \\mathbf{F}_{\\text{net}} \\cdot \\hat{\\mathbf{p}}\n$$\nThe net force acting on the electron is the sum of the electric force, $\\mathbf{F}_{E}$, and the collisional drag force, $\\mathbf{F}_{c}$.\n$$\n\\mathbf{F}_{\\text{net}} = \\mathbf{F}_{E} + \\mathbf{F}_{c}\n$$\nThe electric field, $\\mathbf{E}$, is directed parallel to the magnetic field. Let $\\hat{\\mathbf{b}}$ be the unit vector in this direction. The electric force on an electron (charge $-e$) is $\\mathbf{F}_{E, \\text{raw}} = -e\\mathbf{E} = -e E \\hat{\\mathbf{b}}$. However, the problem formulation is concerned with electron acceleration, and the standard convention in runaway electron theory defines the force from the electric field in the direction of acceleration as $eE$. We adopt this convention, which implies the accelerating force is $\\mathbf{F}_{E} = eE\\hat{\\mathbf{b}}$.\n\nThe collisional drag force, $\\mathbf{F}_{c}$, opposes the electron's motion. As the momentum vector $\\mathbf{p}$ is parallel to the velocity vector $\\mathbf{v}$ in relativistic dynamics, the drag force is anti-parallel to $\\mathbf{p}$.\n$$\n\\mathbf{F}_{c} = -F_{c}(y) \\hat{\\mathbf{p}}\n$$\nwhere $F_{c}(y)$ is the magnitude of the drag force, a function of the normalized momentum $y$.\n\nThe net force is therefore:\n$$\n\\mathbf{F}_{\\text{net}} = eE\\hat{\\mathbf{b}} - F_{c}(y)\\hat{\\mathbf{p}}\n$$\nNow, we can compute the rate of change of the momentum magnitude:\n$$\n\\frac{dp}{dt} = \\left( eE\\hat{\\mathbf{b}} - F_{c}(y)\\hat{\\mathbf{p}} \\right) \\cdot \\hat{\\mathbf{p}} = eE(\\hat{\\mathbf{b}} \\cdot \\hat{\\mathbf{p}}) - F_{c}(y)(\\hat{\\mathbf{p}} \\cdot \\hat{\\mathbf{p}})\n$$\nThe dot product $\\hat{\\mathbf{p}} \\cdot \\hat{\\mathbf{p}}$ is equal to $1$. The dot product $\\hat{\\mathbf{b}} \\cdot \\hat{\\mathbf{p}}$ is the cosine of the angle between the magnetic field direction and the momentum direction, which is precisely the definition of the pitch-angle cosine, $\\xi$.\n$$\n\\hat{\\mathbf{b}} \\cdot \\hat{\\mathbf{p}} = \\xi\n$$\nSubstituting these into the equation for $dp/dt$ yields:\n$$\n\\frac{dp}{dt} = eE\\xi - F_{c}(y)\n$$\nThe separatrix in momentum space is defined by the condition that the net drift of the momentum magnitude vanishes, i.e., $dp/dt = 0$. Let $\\xi_{s}$ denote the pitch-angle cosine on the separatrix.\n$$\neE\\xi_{s} - F_{c}(y) = 0\n$$\nThis gives the separatrix condition as:\n$$\n\\xi_{s} = \\frac{F_{c}(y)}{eE}\n$$\nThe problem asks for this relation to be expressed in terms of the dimensionless electric field, $\\mathcal{E} \\equiv E/E_{c}$, and the dimensionless collisional drag, $\\phi(y) \\equiv F_{c}(y)/(e E_{c})$. We can rewrite $F_{c}(y)$ and $E$ using these definitions:\n$$\nF_{c}(y) = \\phi(y) e E_{c}\n$$\n$$\nE = \\mathcal{E} E_{c}\n$$\nSubstituting these expressions into the equation for $\\xi_{s}$:\n$$\n\\xi_{s} = \\frac{\\phi(y) e E_{c}}{e (\\mathcal{E} E_{c})} = \\frac{\\phi(y)}{\\mathcal{E}}\n$$\nThis is the required explicit relation defining the separatrix, connecting the pitch-angle cosine $\\xi_s$ to the momentum magnitude $y$ (via the function $\\phi(y)$) and the normalized electric field $\\mathcal{E}$.\n\nNext, we analyze the ultra-relativistic limit, where $y \\gg 1$. This corresponds to taking the limit as $y \\to \\infty$. We seek the limiting value of the separatrix pitch-angle cosine, $\\xi_{s,\\infty}$.\n$$\n\\xi_{s,\\infty} = \\lim_{y \\to \\infty} \\xi_{s}(y) = \\lim_{y \\to \\infty} \\left( \\frac{\\phi(y)}{\\mathcal{E}} \\right)\n$$\nSince $\\mathcal{E}$ is a constant parameter, it can be factored out of the limit:\n$$\n\\xi_{s,\\infty} = \\frac{1}{\\mathcal{E}} \\lim_{y \\to \\infty} \\phi(y)\n$$\nThe problem statement provides the high-energy limit of the dimensionless drag function:\n$$\n\\lim_{y \\to \\infty} \\phi(y) = 1\n$$\nSubstituting this value into our expression for $\\xi_{s,\\infty}$:\n$$\n\\xi_{s,\\infty} = \\frac{1}{\\mathcal{E}} \\cdot 1 = \\frac{1}{\\mathcal{E}}\n$$\nThis is the closed-form expression for the limiting value of the separatrix pitch-angle cosine in terms of $\\mathcal{E}$. For a physically meaningful separatrix to exist in this limit (i.e., for $0  \\xi_{s,\\infty} \\le 1$), the normalized electric field must satisfy $\\mathcal{E} \\ge 1$. This corresponds to the condition that the applied electric field must exceed the critical field defined by the high-energy collisional drag.",
            "answer": "$$\n\\boxed{\\frac{1}{\\mathcal{E}}}\n$$"
        },
        {
            "introduction": "While the fate of a single electron is determined by the local forces, the formation of a dangerous runaway beam in a tokamak depends on the collective behavior of the entire population. This practical exercise models the competition between the exponential growth of the runaway population via the avalanche mechanism and their loss due to spatial diffusion across the magnetic field . By solving a reaction-diffusion equation in a simplified cylindrical geometry, you will calculate the critical level of turbulent transport required to suppress the formation of a runaway beam, connecting microscopic physics to macroscopic confinement.",
            "id": "3717558",
            "problem": "A large-aspect-ratio, axisymmetric plasma column of circular cross-section and minor radius $a$ undergoes a disruption-driven thermal quench that produces a uniform toroidal electric field. In the post-quench phase, the runaway electron number density $n_{\\mathrm{RE}}(r,t)$ evolves under the competition of avalanche multiplication and cross-field turbulent diffusion. Assume the following:\n\n- The avalanche source is spatially uniform with a constant exponential growth rate $\\Gamma_{\\mathrm{av}}$ such that, in the absence of losses, $n_{\\mathrm{RE}} \\propto \\exp(\\Gamma_{\\mathrm{av}} t)$.\n- Cross-field transport can be modeled as ordinary diffusion with a constant, spatially uniform diffusion coefficient $D$, and radial diffusive flux given by Fick’s law.\n- The plasma occupies a cylindrical domain $0 \\le r \\le a$ with an absorbing boundary for runaway electrons at $r=a$ (idealized perfectly conducting wall), and regularity at $r=0$.\n- The runaway electron population remains sufficiently dilute that it does not modify the background fields (linear regime).\n\nStarting from the particle continuity equation and Fick’s law, derive the condition on $D$ that prevents the formation of a confined runaway beam, interpreted as the requirement that the dominant spatial mode of $n_{\\mathrm{RE}}$ does not grow in time. Use the fact that the slowest decaying eigenmode of the Laplacian in a cylinder with Dirichlet boundary condition at $r=a$ has radial structure given by the Bessel function $J_0$ and satisfies $J_0(k a)=0$, with the smallest positive root $k a = j_{0,1}$, where $j_{0,1} \\approx 2.404825558$.\n\nFor a device with minor radius $a = 0.60\\,\\mathrm{m}$ and an inferred post-quench avalanche growth rate $\\Gamma_{\\mathrm{av}} = 3.20 \\times 10^{2}\\,\\mathrm{s^{-1}}$, compute the minimal diffusion coefficient $D_{\\mathrm{crit}}$ that marginally suppresses net growth of the dominant mode. Round your answer to four significant figures and express it in $\\mathrm{m^{2}\\,s^{-1}}$.",
            "solution": "## PROBLEM VALIDATION\n\n### Step 1: Extract Givens\n- Geometry: Large-aspect-ratio, axisymmetric plasma column of circular cross-section.\n- Minor radius: $a$.\n- Toroidal electric field: Uniform, from a disruption-driven thermal quench.\n- Runaway electron number density: $n_{\\mathrm{RE}}(r,t)$.\n- Avalanche source: Spatially uniform, constant exponential growth rate $\\Gamma_{\\mathrm{av}}$. In the absence of losses, $n_{\\mathrm{RE}} \\propto \\exp(\\Gamma_{\\mathrm{av}} t)$.\n- Transport model: Cross-field ordinary diffusion with constant, spatially uniform diffusion coefficient $D$.\n- Radial diffusive flux: Fick's law.\n- Domain: Cylindrical, $0 \\le r \\le a$.\n- Boundary conditions:\n    - Absorbing boundary at $r=a$: $n_{\\mathrm{RE}}(a,t) = 0$.\n    - Regularity at $r=0$.\n- Regime: Linear, runaway population does not modify background fields.\n- Goal: Derive the condition on $D$ to prevent the growth of the dominant spatial mode of $n_{\\mathrm{RE}}$.\n- Mathematical fact provided: The slowest decaying eigenmode of the Laplacian in a cylinder with a Dirichlet boundary condition at $r=a$ has radial structure $J_0(kr)$ where $J_0(ka)=0$, and the smallest positive root is $ka = j_{0,1} \\approx 2.404825558$.\n- Numerical Values:\n    - $a = 0.60\\,\\mathrm{m}$\n    - $\\Gamma_{\\mathrm{av}} = 3.20 \\times 10^{2}\\,\\mathrm{s^{-1}}$\n    - $j_{0,1} \\approx 2.404825558$\n- Required Output: Minimal diffusion coefficient $D_{\\mathrm{crit}}$ in $\\mathrm{m^{2}\\,s^{-1}}$, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. The physical model is a reaction-diffusion equation, which is a standard and well-established framework for describing the evolution of particle densities under the influence of local sources (reaction) and spatial transport (diffusion). This model is commonly used in plasma physics to study runaway electron dynamics in tokamaks. The assumptions of a uniform avalanche rate $\\Gamma_{\\mathrm{av}}$ and diffusion coefficient $D$ in a simplified cylindrical geometry are standard approximations for creating a tractable analytical model.\n\nThe problem is well-posed. It provides a clearly defined partial differential equation, domain, and boundary conditions. The goal is to find a stability threshold for the system's dominant eigenmode, which is a standard procedure in the analysis of linear PDEs. All necessary parameters and constants are provided.\n\nThe problem is objective. The language is precise and free of subjective or opinion-based statements. The values given are physically plausible for a medium-sized tokamak post-disruption.\n\nThe problem is formalizable and relevant to the specified topic of runaway electron generation. It does not contain any of the invalidating flaws listed in the instructions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n## SOLUTION\n\nThe evolution of the runaway electron number density, $n_{\\mathrm{RE}}(r,t)$, is governed by the particle continuity equation:\n$$ \\frac{\\partial n_{\\mathrm{RE}}}{\\partial t} + \\nabla \\cdot \\mathbf{\\Gamma} = S $$\nwhere $S$ is the source term and $\\mathbf{\\Gamma}$ is the particle flux.\n\nThe source term is due to avalanche multiplication, which is given as a process with a constant exponential growth rate $\\Gamma_{\\mathrm{av}}$. This implies the source is proportional to the local density:\n$$ S = \\Gamma_{\\mathrm{av}} n_{\\mathrm{RE}}(r,t) $$\n\nThe particle flux, $\\mathbf{\\Gamma}$, is due to cross-field turbulent diffusion and is described by Fick's law with a constant diffusion coefficient $D$:\n$$ \\mathbf{\\Gamma} = -D \\nabla n_{\\mathrm{RE}}(r,t) $$\n\nSubstituting the source and flux into the continuity equation, we get the governing partial differential equation (PDE) for the runaway electron density:\n$$ \\frac{\\partial n_{\\mathrm{RE}}}{\\partial t} + \\nabla \\cdot (-D \\nabla n_{\\mathrm{RE}}) = \\Gamma_{\\mathrm{av}} n_{\\mathrm{RE}} $$\nSince $D$ is constant, this simplifies to a reaction-diffusion equation:\n$$ \\frac{\\partial n_{\\mathrm{RE}}}{\\partial t} = D \\nabla^2 n_{\\mathrm{RE}} + \\Gamma_{\\mathrm{av}} n_{\\mathrm{RE}} $$\n\nFor an axisymmetric system with properties uniform along the cylinder axis, the Laplacian operator $\\nabla^2$ in cylindrical coordinates $(r, \\phi, z)$ depends only on the radial coordinate $r$:\n$$ \\nabla^2 = \\frac{1}{r} \\frac{\\partial}{\\partial r} \\left(r \\frac{\\partial}{\\partial r}\\right) $$\nThe PDE becomes:\n$$ \\frac{\\partial n_{\\mathrm{RE}}(r,t)}{\\partial t} = D \\left[ \\frac{1}{r} \\frac{\\partial}{\\partial r} \\left( r \\frac{\\partial n_{\\mathrm{RE}}(r,t)}{\\partial r} \\right) \\right] + \\Gamma_{\\mathrm{av}} n_{\\mathrm{RE}}(r,t) $$\n\nWe solve this linear PDE using the method of separation of variables. Let $n_{\\mathrm{RE}}(r,t) = R(r)T(t)$. Substituting this into the PDE yields:\n$$ R(r) \\frac{dT(t)}{dt} = D T(t) \\left[ \\frac{1}{r} \\frac{d}{dr} \\left( r \\frac{dR(r)}{dr} \\right) \\right] + \\Gamma_{\\mathrm{av}} R(r) T(t) $$\nDividing by $n_{\\mathrm{RE}}(r,t) = R(r)T(t)$ separates the variables:\n$$ \\frac{1}{T(t)}\\frac{dT(t)}{dt} = \\frac{D}{R(r)} \\left[ \\frac{1}{r} \\frac{d}{dr} \\left( r \\frac{dR(r)}{dr} \\right) \\right] + \\Gamma_{\\mathrm{av}} $$\nSince the left side depends only on $t$ and the right side depends only on $r$, both must be equal to a constant, which we denote as $\\gamma$. This constant $\\gamma$ represents the net growth rate of the mode.\n\nThe temporal equation is:\n$$ \\frac{1}{T(t)}\\frac{dT(t)}{dt} = \\gamma \\implies T(t) = T(0) \\exp(\\gamma t) $$\n\nThe spatial equation is:\n$$ \\frac{D}{R(r)} \\left[ \\frac{1}{r} \\frac{d}{dr} \\left( r \\frac{dR(r)}{dr} \\right) \\right] + \\Gamma_{\\mathrm{av}} = \\gamma $$\nRearranging this gives a standard Sturm-Liouville problem:\n$$ \\frac{1}{r} \\frac{d}{dr} \\left( r \\frac{dR}{dr} \\right) + \\frac{\\Gamma_{\\mathrm{av}} - \\gamma}{D} R = 0 $$\nLet's define a constant $k^2 = \\frac{\\Gamma_{\\mathrm{av}} - \\gamma}{D}$. The spatial equation becomes:\n$$ \\frac{d^2 R}{dr^2} + \\frac{1}{r} \\frac{dR}{dr} + k^2 R = 0 $$\nThis is Bessel's differential equation of order $0$. The general solution is a linear combination of the Bessel function of the first kind, $J_0(kr)$, and the Bessel function of the second kind, $Y_0(kr)$.\n\nWe apply the boundary conditions to find the physically acceptable solutions.\n$1$. The regularity condition at the center of the plasma, $r=0$, requires the solution to be finite. Since $Y_0(x) \\to -\\infty$ as $x \\to 0$, its coefficient must be zero. Thus, the radial solution must be of the form:\n$$ R(r) = C J_0(kr) $$\nwhere $C$ is a constant.\n$2$. The absorbing boundary condition at the edge of the plasma, $r=a$, requires $n_{\\mathrm{RE}}(a,t) = 0$, which implies $R(a)=0$. For a non-trivial solution ($C \\neq 0$), this means:\n$$ J_0(ka) = 0 $$\nThis condition quantizes the possible values of $k$. The allowed values, denoted $k_n$, are determined by the positive roots of the $J_0$ Bessel function, denoted $j_{0,n}$.\n$$ k_n a = j_{0,n} \\implies k_n = \\frac{j_{0,n}}{a} \\quad \\text{for } n = 1, 2, 3, \\ldots $$\n\nEach value $k_n$ corresponds to a spatial eigenmode $R_n(r) = C_n J_0(k_n r)$ with an associated growth rate $\\gamma_n$. From the definition of $k^2$, we can solve for $\\gamma_n$:\n$$ k_n^2 = \\frac{\\Gamma_{\\mathrm{av}} - \\gamma_n}{D} \\implies \\gamma_n = \\Gamma_{\\mathrm{av}} - D k_n^2 $$\nSubstituting the expression for $k_n$:\n$$ \\gamma_n = \\Gamma_{\\mathrm{av}} - D \\left(\\frac{j_{0,n}}{a}\\right)^2 $$\n\nThe full solution is a superposition of all these eigenmodes:\n$$ n_{\\mathrm{RE}}(r,t) = \\sum_{n=1}^{\\infty} C_n J_0\\left(\\frac{j_{0,n} r}{a}\\right) \\exp(\\gamma_n t) $$\nThe long-term behavior of the solution is dominated by the mode with the largest (least negative) growth rate $\\gamma_n$. The roots $j_{0,n}$ form an increasing sequence: $j_{0,1}  j_{0,2}  j_{0,3}  \\ldots$. The growth rate $\\gamma_n$ is a decreasing function of $j_{0,n}$. Therefore, the largest growth rate corresponds to the smallest root, $j_{0,1}$. This is the \"dominant spatial mode\" mentioned in the problem. Its growth rate is:\n$$ \\gamma_1 = \\Gamma_{\\mathrm{av}} - D \\left(\\frac{j_{0,1}}{a}\\right)^2 $$\n\nTo prevent the formation of a confined runaway beam, the net growth of this dominant mode must be suppressed, meaning its population should not grow in time. This requires its growth rate to be non-positive:\n$$ \\gamma_1 \\le 0 $$\n$$ \\Gamma_{\\mathrm{av}} - D \\left(\\frac{j_{0,1}}{a}\\right)^2 \\le 0 $$\nSolving for the diffusion coefficient $D$ gives the condition for suppression:\n$$ D \\ge \\Gamma_{\\mathrm{av}} \\left(\\frac{a}{j_{0,1}}\\right)^2 $$\n\nThe minimal diffusion coefficient, $D_{\\mathrm{crit}}$, that marginally suppresses the growth corresponds to the equality, where the growth rate of the dominant mode is exactly zero ($\\gamma_1=0$):\n$$ D_{\\mathrm{crit}} = \\Gamma_{\\mathrm{av}} \\left(\\frac{a}{j_{0,1}}\\right)^2 $$\n\nNow, we substitute the provided numerical values:\n$a = 0.60\\,\\mathrm{m}$\n$\\Gamma_{\\mathrm{av}} = 3.20 \\times 10^{2}\\,\\mathrm{s^{-1}}$\n$j_{0,1} = 2.404825558$\n\n$$ D_{\\mathrm{crit}} = (3.20 \\times 10^{2}\\,\\mathrm{s}^{-1}) \\left(\\frac{0.60\\,\\mathrm{m}}{2.404825558}\\right)^2 $$\n$$ D_{\\mathrm{crit}} \\approx (3.20 \\times 10^{2}) \\times (0.24949503)^2 \\,\\mathrm{m^2\\,s^{-1}} $$\n$$ D_{\\mathrm{crit}} \\approx (3.20 \\times 10^{2}) \\times (0.062247766) \\,\\mathrm{m^2\\,s^{-1}} $$\n$$ D_{\\mathrm{crit}} \\approx 19.919285 \\,\\mathrm{m^2\\,s^{-1}} $$\n\nRounding the result to four significant figures as required:\n$$ D_{\\mathrm{crit}} = 19.92\\,\\mathrm{m^2\\,s^{-1}} $$",
            "answer": "$$\n\\boxed{19.92}\n$$"
        },
        {
            "introduction": "A complete picture of runaway dynamics requires acknowledging that a growing runaway population is not a passive element; its current significantly alters the plasma's electromagnetic environment. This advanced practice challenges you to implement a self-consistent numerical model that couples the evolution of the runaway current to the plasma's overall circuit dynamics during a disruption . By building this tool, you will gain hands-on experience with the feedback loops that govern runaway generation and current conversion, a skill central to the predictive modeling of tokamak behavior.",
            "id": "3717577",
            "problem": "You must design and implement a self-consistent time-integration scheme that couples a reduced kinetic model of runaway-electron current to a lumped-element inductance–resistance ($L\\!-\\!R$) circuit model of the plasma to compute the parallel electric field $E_{\\parallel}(t)$ during a disruption-like transient. The modeling must be built from the following fundamental base without invoking any shortcut formulas that presuppose the desired result.\n\nFundamental base and definitions:\n- Maxwell–Faraday law (integral form): the line integral of the electric field $E_{\\parallel}$ around the plasma loop relates to the rate of change of magnetic flux and any applied transformer drive. In a lumped-element representation, this motivates the standard $L\\!-\\!R$ circuit equation for the total plasma current $I_{\\mathrm{tot}}(t)$ when represented by a self-inductance $L$ and a time-dependent effective thermal resistance $R_{\\mathrm{th}}(t)$.\n- Total plasma current decomposition: $I_{\\mathrm{tot}}(t) = I_{\\mathrm{th}}(t) + I_{\\mathrm{re}}(t)$, where $I_{\\mathrm{th}}(t)$ is the collisional thermal-electron current and $I_{\\mathrm{re}}(t)$ is the runaway-electron current.\n- Circuit dynamics with transformer drive $V_{\\mathrm{tr}}(t)$:\n  $$ L \\, \\frac{d I_{\\mathrm{tot}}}{d t} + R_{\\mathrm{th}}(t) \\, I_{\\mathrm{th}}(t) = V_{\\mathrm{tr}}(t). $$\n- Definition of the parallel electric field felt by the bulk (collisional) electrons:\n  $$ E_{\\parallel}(t) = \\frac{R_{\\mathrm{th}}(t)}{\\ell} \\, I_{\\mathrm{th}}(t), $$\n  where $\\ell$ is the effective toroidal loop length over which the parallel field is taken, assumed spatially uniform for this zero-dimensional model.\n- Reduced kinetic runaway-electron current model (zeroth-moment closure of a Fokker–Planck picture): the runaway-electron current evolves according to a source–growth model driven by the parallel electric field,\n  $$ \\frac{d I_{\\mathrm{re}}}{d t} = \\gamma_{\\mathrm{ava}}\\!\\left(E_{\\parallel}\\right) \\, I_{\\mathrm{re}} + S_{\\mathrm{pri}}\\!\\left(E_{\\parallel}\\right), $$\n  where the avalanche growth rate is modeled as\n  $$ \\gamma_{\\mathrm{ava}}(E_{\\parallel}) = \\frac{1}{\\tau_{\\mathrm{ava}}} \\max\\!\\left(0, \\frac{E_{\\parallel}}{E_{\\mathrm{c}}} - 1 \\right), $$\n  and the primary (seed) source is modeled as\n  $$ S_{\\mathrm{pri}}(E_{\\parallel}) = S_0 \\, \\max\\!\\left(0, \\frac{E_{\\parallel}}{E_{\\mathrm{c}}} - 1 \\right). $$\n  Here $E_{\\mathrm{c}}$ is the critical electric field and $\\tau_{\\mathrm{ava}}$ and $S_0$ are model parameters.\n\nDesign a numerically stable, self-consistent time-stepping scheme on $t \\in [0, T_{\\text{end}}]$ that simultaneously updates $I_{\\mathrm{re}}$, $I_{\\mathrm{tot}}$, and $E_{\\parallel}$. Your scheme must:\n- Use the circuit equation to implicitly update $I_{\\mathrm{tot}}$ at each step to avoid stiffness from the $L\\!-\\!R$ term, while using the most recent updated $I_{\\mathrm{re}}$ in that step.\n- Use the kinetic equations to update $I_{\\mathrm{re}}$ using the parallel field from the previous substep in the same time step to maintain causality and monotonic stability.\n- Close the system by computing $I_{\\mathrm{th}} = I_{\\mathrm{tot}} - I_{\\mathrm{re}}$, and then $E_{\\parallel} = \\left(R_{\\mathrm{th}}/\\ell\\right) I_{\\mathrm{th}}$ at each substep to feed back into the kinetics.\n\nA single time step from $t_n$ to $t_{n+1} = t_n + \\Delta t$ must therefore proceed in the order:\n1. Evaluate $E_{\\parallel}^{(n)} = \\left(R_{\\mathrm{th}}^{(n)}/\\ell \\right) \\left(I_{\\mathrm{tot}}^{(n)} - I_{\\mathrm{re}}^{(n)}\\right)$.\n2. Update $I_{\\mathrm{re}}$ explicitly with $E_{\\parallel}^{(n)}$:\n   $$ I_{\\mathrm{re}}^{(n+1)} = I_{\\mathrm{re}}^{(n)} + \\Delta t \\left[ \\gamma_{\\mathrm{ava}}\\!\\left(E_{\\parallel}^{(n)}\\right) I_{\\mathrm{re}}^{(n)} + S_{\\mathrm{pri}}\\!\\left(E_{\\parallel}^{(n)}\\right) \\right]. $$\n3. Update $I_{\\mathrm{tot}}$ implicitly using backward Euler on the circuit:\n   $$ I_{\\mathrm{tot}}^{(n+1)} = \\frac{ I_{\\mathrm{tot}}^{(n)} + \\frac{\\Delta t}{L} \\left( V_{\\mathrm{tr}}^{(n+1)} + R_{\\mathrm{th}}^{(n+1)} I_{\\mathrm{re}}^{(n+1)} \\right)}{ 1 + \\frac{\\Delta t}{L} R_{\\mathrm{th}}^{(n+1)} }. $$\n4. Compute $I_{\\mathrm{th}}^{(n+1)} = I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{re}}^{(n+1)}$ and $E_{\\parallel}^{(n+1)} = \\left(R_{\\mathrm{th}}^{(n+1)}/\\ell\\right) I_{\\mathrm{th}}^{(n+1)}$.\n\nAll physical quantities must be in the International System of Units. Angles do not appear. If any ratio is demanded that could be a percentage, express it in decimal form.\n\nImplement the above scheme as a complete, runnable program that computes the evolution for a specified finite set of test cases, each defined by parameters $\\{L, \\ell, R_{\\mathrm{th}}(t), V_{\\mathrm{tr}}(t), E_{\\mathrm{c}}, \\tau_{\\mathrm{ava}}, S_0, I_{\\mathrm{tot}}(0), I_{\\mathrm{re}}(0), T_{\\text{end}}, \\Delta t\\}$.\n\nTest suite to cover distinct behaviors:\n- Case A (sub-threshold decay, no avalanche): $L = 10^{-3}\\,\\mathrm{H}$, $\\ell = 2 \\pi \\times 3\\,\\mathrm{m}$, $R_{\\mathrm{th}}(t) = 10^{-5}\\,\\Omega$ for all $t$, $V_{\\mathrm{tr}}(t) = 0\\,\\mathrm{V}$, $E_{\\mathrm{c}} = 0.05\\,\\mathrm{V/m}$, $\\tau_{\\mathrm{ava}} = 0.01\\,\\mathrm{s}$, $S_0 = 100\\,\\mathrm{A/s}$, $I_{\\mathrm{tot}}(0) = 5 \\times 10^{4}\\,\\mathrm{A}$, $I_{\\mathrm{re}}(0) = 0\\,\\mathrm{A}$, $T_{\\text{end}} = 0.02\\,\\mathrm{s}$, $\\Delta t = 10^{-5}\\,\\mathrm{s}$.\n- Case B (slightly supercritical, weak avalanche): $L = 10^{-3}\\,\\mathrm{H}$, $\\ell = 2 \\pi \\times 3\\,\\mathrm{m}$, $R_{\\mathrm{th}}(t) = 10^{-5}\\,\\Omega$ for all $t$, $V_{\\mathrm{tr}}(t) = 0\\,\\mathrm{V}$, $E_{\\mathrm{c}} = 0.05\\,\\mathrm{V/m}$, $\\tau_{\\mathrm{ava}} = 0.01\\,\\mathrm{s}$, $S_0 = 200\\,\\mathrm{A/s}$, $I_{\\mathrm{tot}}(0) = 10^{5}\\,\\mathrm{A}$, $I_{\\mathrm{re}}(0) = 1\\,\\mathrm{A}$, $T_{\\text{end}} = 0.02\\,\\mathrm{s}$, $\\Delta t = 10^{-5}\\,\\mathrm{s}$.\n- Case C (thermal quench jump in resistance, strong avalanche): $L = 10^{-3}\\,\\mathrm{H}$, $\\ell = 2 \\pi \\times 3\\,\\mathrm{m}$, $R_{\\mathrm{th}}(t) = 10^{-5}\\,\\Omega$ for $t  10^{-3}\\,\\mathrm{s}$ and $R_{\\mathrm{th}}(t) = 5\\times 10^{-4}\\,\\Omega$ for $t \\ge 10^{-3}\\,\\mathrm{s}$, $V_{\\mathrm{tr}}(t) = 0\\,\\mathrm{V}$, $E_{\\mathrm{c}} = 0.05\\,\\mathrm{V/m}$, $\\tau_{\\mathrm{ava}} = 5\\times 10^{-3}\\,\\mathrm{s}$, $S_0 = 500\\,\\mathrm{A/s}$, $I_{\\mathrm{tot}}(0) = 8 \\times 10^{4}\\,\\mathrm{A}$, $I_{\\mathrm{re}}(0) = 0\\,\\mathrm{A}$, $T_{\\text{end}} = 0.005\\,\\mathrm{s}$, $\\Delta t = 10^{-6}\\,\\mathrm{s}$.\n\nRequired outputs:\n- For each case, at $t = T_{\\text{end}}$, report the triple $[E_{\\parallel}(T_{\\text{end}}), I_{\\mathrm{re}}(T_{\\text{end}}), I_{\\mathrm{tot}}(T_{\\text{end}})]$ where $E_{\\parallel}$ is expressed in $\\mathrm{V/m}$ and the currents in $\\mathrm{A}$.\n- Round $E_{\\parallel}(T_{\\text{end}})$ to six digits after the decimal point. Round $I_{\\mathrm{re}}(T_{\\text{end}})$ and $I_{\\mathrm{tot}}(T_{\\text{end}})$ to the nearest integer.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one triple per test case, for example: $[[e_1,i_{\\mathrm{re},1},i_{\\mathrm{tot},1}],[e_2,i_{\\mathrm{re},2},i_{\\mathrm{tot},2}],\\ldots]$, where each item is a number as specified above.",
            "solution": "The user requests the design and implementation of a time-integration scheme to model the evolution of runaway-electron current in a tokamak plasma during a disruption. The model couples a zero-dimensional kinetic description for the runaway current with a lumped-element $L-R$ circuit model for the total plasma current. The problem is well-posed, scientifically grounded in established plasma physics models, and provides all necessary parameters and a specific numerical algorithm to be implemented.\n\n**1. Physical and Mathematical Model**\n\nThe system's dynamics are governed by a set of coupled differential-algebraic equations.\n\n**a. Circuit Dynamics:**\nThe plasma is modeled as a toroidal conductor with self-inductance $L$ and a time-varying thermal resistance $R_{\\mathrm{th}}(t)$. The evolution of the total plasma current $I_{\\mathrm{tot}}(t)$ is described by the $L-R$ circuit equation, which is a consequence of the Maxwell-Faraday law of induction:\n$$\nL \\, \\frac{d I_{\\mathrm{tot}}}{d t} + R_{\\mathrm{th}}(t) \\, I_{\\mathrm{th}}(t) = V_{\\mathrm{tr}}(t)\n$$\nHere, $V_{\\mathrm{tr}}(t)$ is an externally applied voltage from the tokamak's central solenoid (transformer). The total current, $I_{\\mathrm{tot}}(t)$, is the sum of the current carried by the collisional thermal electrons, $I_{\\mathrm{th}}(t)$, and the current carried by the relativistic runaway electrons, $I_{\\mathrm{re}}(t)$:\n$$\nI_{\\mathrm{tot}}(t) = I_{\\mathrm{th}}(t) + I_{\\mathrm{re}}(t)\n$$\nThe parallel electric field, $E_{\\parallel}(t)$, which accelerates the electrons, is assumed to be spatially uniform and is related to the thermal current via Ohm's law:\n$$\nE_{\\parallel}(t) = \\frac{R_{\\mathrm{th}}(t)}{\\ell} \\, I_{\\mathrm{th}}(t)\n$$\nwhere $\\ell$ is the effective toroidal path length.\n\n**b. Runaway-Electron Kinetics:**\nThe runaway-electron current evolves according to a reduced kinetic model that accounts for two main generation mechanisms: primary (or Dreicer) generation and secondary (or avalanche) generation. The rate of change of the runaway current is given by:\n$$\n\\frac{d I_{\\mathrm{re}}}{d t} = \\gamma_{\\mathrm{ava}}\\!\\left(E_{\\parallel}\\right) \\, I_{\\mathrm{re}} + S_{\\mathrm{pri}}\\!\\left(E_{\\parallel}\\right)\n$$\nThis is the zeroth moment of the Fokker-Planck equation for runaway electrons. Both the avalanche growth rate, $\\gamma_{\\mathrm{ava}}$, and the primary source term, $S_{\\mathrm{pri}}$, are activated only when the parallel electric field $E_{\\parallel}$ exceeds a critical field $E_{\\mathrm{c}}$. The simplified models used are:\n$$\n\\gamma_{\\mathrm{ava}}(E_{\\parallel}) = \\frac{1}{\\tau_{\\mathrm{ava}}} \\max\\!\\left(0, \\frac{E_{\\parallel}}{E_{\\mathrm{c}}} - 1 \\right)\n$$\n$$\nS_{\\mathrm{pri}}(E_{\\parallel}) = S_0 \\, \\max\\!\\left(0, \\frac{E_{\\parallel}}{E_{\\mathrm{c}}} - 1 \\right)\n$$\nwhere $\\tau_{\\mathrm{ava}}$ is the characteristic avalanche timescale and $S_0$ is the primary source strength coefficient.\n\n**2. Numerical Integration Scheme**\n\nTo solve this system of coupled equations for the state variables $I_{\\mathrm{tot}}(t)$ and $I_{\\mathrm{re}}(t)$, we employ a semi-implicit time-stepping scheme. This approach is dictated by the problem statement and is suitable for handling the potential stiffness arising from a small $L/R_{\\mathrm{th}}$ time constant. The time domain $[0, T_{\\text{end}}]$ is discretized into steps of size $\\Delta t$. A single step from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ proceeds as follows, where a superscript $(n)$ denotes a quantity at time $t_n$:\n\n**Step 1: Evaluate state at $t_n$.**\nFirst, we compute the parallel electric field $E_{\\parallel}^{(n)}$ using the known values of the currents at the beginning of the time step:\n$$\nI_{\\mathrm{th}}^{(n)} = I_{\\mathrm{tot}}^{(n)} - I_{\\mathrm{re}}^{(n)}\n$$\n$$\nE_{\\parallel}^{(n)} = \\frac{R_{\\mathrm{th}}^{(n)}}{\\ell} \\, I_{\\mathrm{th}}^{(n)}\n$$\nwhere $R_{\\mathrm{th}}^{(n)} = R_{\\mathrm{th}}(t_n)$.\n\n**Step 2: Explicit update of runaway current.**\nThe runaway kinetic equation is integrated forward using an explicit (forward Euler) method. The source and growth rates are calculated using the electric field from the previous step, $E_{\\parallel}^{(n)}$, ensuring causality.\n$$\nI_{\\mathrm{re}}^{(n+1)} = I_{\\mathrm{re}}^{(n)} + \\Delta t \\left[ \\gamma_{\\mathrm{ava}}\\!\\left(E_{\\parallel}^{(n)}\\right) I_{\\mathrm{re}}^{(n)} + S_{\\mathrm{pri}}\\!\\left(E_{\\parallel}^{(n)}\\right) \\right]\n$$\nThis explicit treatment is stable provided $\\Delta t$ is sufficiently small compared to the physical timescales (e.g., $1/\\gamma_{\\mathrm{ava}}$).\n\n**Step 3: Implicit update of total current.**\nThe circuit equation is discretized using an implicit (backward Euler) method to ensure numerical stability for the potentially fast resistive decay. The equation is:\n$$\nL \\, \\frac{I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{tot}}^{(n)}}{\\Delta t} + R_{\\mathrm{th}}^{(n+1)} \\, I_{\\mathrm{th}}^{(n+1)} = V_{\\mathrm{tr}}^{(n+1)}\n$$\nSubstituting $I_{\\mathrm{th}}^{(n+1)} = I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{re}}^{(n+1)}$ and rearranging for $I_{\\mathrm{tot}}^{(n+1)}$ yields the update rule. Note that we use the just-computed value $I_{\\mathrm{re}}^{(n+1)}$ from Step 2.\n$$\nL \\, \\left(I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{tot}}^{(n)}\\right) + \\Delta t \\, R_{\\mathrm{th}}^{(n+1)} \\, \\left(I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{re}}^{(n+1)}\\right) = \\Delta t \\, V_{\\mathrm{tr}}^{(n+1)}\n$$\nSolving for $I_{\\mathrm{tot}}^{(n+1)}$ gives the prescribed formula:\n$$\nI_{\\mathrm{tot}}^{(n+1)} = \\frac{ I_{\\mathrm{tot}}^{(n)} + \\frac{\\Delta t}{L} \\left( V_{\\mathrm{tr}}^{(n+1)} + R_{\\mathrm{th}}^{(n+1)} I_{\\mathrm{re}}^{(n+1)} \\right)}{ 1 + \\frac{\\Delta t}{L} R_{\\mathrm{th}}^{(n+1)} }\n$$\nwhere $R_{\\mathrm{th}}^{(n+1)} = R_{\\mathrm{th}}(t_{n+1})$ and $V_{\\mathrm{tr}}^{(n+1)} = V_{\\mathrm{tr}}(t_{n+1})$.\n\n**Step 4: Close the system.**\nWith the updated currents $I_{\\mathrm{re}}^{(n+1)}$ and $I_{\\mathrm{tot}}^{(n+1)}$, the remaining quantities at $t_{n+1}$ can be found, preparing the state for the next time step.\n$$\nI_{\\mathrm{th}}^{(n+1)} = I_{\\mathrm{tot}}^{(n+1)} - I_{\\mathrm{re}}^{(n+1)}\n$$\n$$\nE_{\\parallel}^{(n+1)} = \\frac{R_{\\mathrm{th}}^{(n+1)}}{\\ell} \\, I_{\\mathrm{th}}^{(n+1)}\n$$\nThis sequence of operations is repeated for the required number of time steps until $t = T_{\\text{end}}$. The final values of $E_{\\parallel}$, $I_{\\mathrm{re}}$, and $I_{\\mathrm{tot}}$ are then reported.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the simulation for all test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            'name': 'A',\n            'params': {\n                'L': 1e-3,\n                'ell': 2 * np.pi * 3,\n                'R_th_func': lambda t: 1e-5,\n                'V_tr_func': lambda t: 0.0,\n                'Ec': 0.05,\n                'tau_ava': 0.01,\n                'S0': 100,\n                'I_tot_0': 5e4,\n                'I_re_0': 0.0,\n                'T_end': 0.02,\n                'dt': 1e-5,\n            }\n        },\n        {\n            'name': 'B',\n            'params': {\n                'L': 1e-3,\n                'ell': 2 * np.pi * 3,\n                'R_th_func': lambda t: 1e-5,\n                'V_tr_func': lambda t: 0.0,\n                'Ec': 0.05,\n                'tau_ava': 0.01,\n                'S0': 200,\n                'I_tot_0': 1e5,\n                'I_re_0': 1.0,\n                'T_end': 0.02,\n                'dt': 1e-5,\n            }\n        },\n        {\n            'name': 'C',\n            'params': {\n                'L': 1e-3,\n                'ell': 2 * np.pi * 3,\n                'R_th_func': lambda t: 1e-5 if t  1e-3 else 5e-4,\n                'V_tr_func': lambda t: 0.0,\n                'Ec': 0.05,\n                'tau_ava': 5e-3,\n                'S0': 500,\n                'I_tot_0': 8e4,\n                'I_re_0': 0.0,\n                'T_end': 0.005,\n                'dt': 1e-6,\n            }\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result_tuple = run_simulation(**case['params'])\n        results.append(result_tuple)\n\n    # Format the results for the final output string\n    output_parts = []\n    for E_p, I_re, I_tot in results:\n        e_str = f\"{E_p:.6f}\"\n        ire_str = str(int(round(I_re)))\n        itot_str = str(int(round(I_tot)))\n        output_parts.append(f\"[{e_str},{ire_str},{itot_str}]\")\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\n\ndef run_simulation(L, ell, R_th_func, V_tr_func, Ec, tau_ava, S0, I_tot_0, I_re_0, T_end, dt):\n    \"\"\"\n    Executes the time-integration for a single set of parameters.\n\n    Args:\n        L (float): Plasma inductance (H).\n        ell (float): Effective toroidal loop length (m).\n        R_th_func (callable): Function R_th(t) for thermal resistance (Ohm).\n        V_tr_func (callable): Function V_tr(t) for transformer voltage (V).\n        Ec (float): Critical electric field (V/m).\n        tau_ava (float): Avalanche timescale (s).\n        S0 (float): Primary runaway source coefficient (A/s).\n        I_tot_0 (float): Initial total current (A).\n        I_re_0 (float): Initial runaway current (A).\n        T_end (float): Simulation end time (s).\n        dt (float): Time step (s).\n\n    Returns:\n        tuple: A tuple containing (E_parallel, I_re, I_tot) at T_end.\n    \"\"\"\n    \n    num_steps = int(round(T_end / dt))\n    \n    # Initialize state variables\n    I_tot = I_tot_0\n    I_re = I_re_0\n\n    for n in range(num_steps):\n        t_n = n * dt\n\n        # Step 1: Evaluate E_parallel at t_n\n        R_th_n = R_th_func(t_n)\n        I_th_n = I_tot - I_re\n        E_parallel_n = (R_th_n / ell) * I_th_n\n\n        # Evaluate runaway source terms based on E_parallel_n\n        E_ratio_minus_1 = E_parallel_n / Ec - 1.0\n        if E_ratio_minus_1  0:\n            gamma_ava = (1.0 / tau_ava) * E_ratio_minus_1\n            S_pri = S0 * E_ratio_minus_1\n        else:\n            gamma_ava = 0.0\n            S_pri = 0.0\n\n        # Step 2: Update I_re to t_{n+1} using explicit Euler\n        I_re_np1 = I_re + dt * (gamma_ava * I_re + S_pri)\n        \n        # Step 3: Update I_tot to t_{n+1} using implicit Euler\n        t_np1 = (n + 1) * dt\n        V_tr_np1 = V_tr_func(t_np1)\n        R_th_np1 = R_th_func(t_np1)\n        \n        dt_over_L = dt / L\n        numerator = I_tot + dt_over_L * (V_tr_np1 + R_th_np1 * I_re_np1)\n        denominator = 1.0 + dt_over_L * R_th_np1\n        I_tot_np1 = numerator / denominator\n\n        # Update state for the next iteration\n        I_tot = I_tot_np1\n        I_re = I_re_np1\n\n    # After the loop, calculate the final E_parallel at T_end\n    t_final = num_steps * dt\n    R_th_final = R_th_func(t_final)\n    I_th_final = I_tot - I_re\n    E_parallel_final = (R_th_final / ell) * I_th_final\n\n    return E_parallel_final, I_re, I_tot\n\nsolve()\n```"
        }
    ]
}