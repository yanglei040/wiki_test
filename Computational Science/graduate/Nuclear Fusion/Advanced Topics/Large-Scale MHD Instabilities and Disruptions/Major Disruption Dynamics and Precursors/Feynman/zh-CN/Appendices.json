{
    "hands_on_practices": [
        {
            "introduction": "辐射坍塌是导致托卡马克等离子体主破裂的关键机制之一。当等离子体芯部由于杂质积累而导致辐射功率过高时，会引发灾难性的热失稳，导致等离子体温度骤降和约束的丧失。本练习旨在通过建立一个实际的能量平衡模型，来量化这种热坍塌的风险。通过亲手计算在给定杂质和等离子体参数下芯部的辐射功率，并确定导致热坍塌的临界温度范围，您将掌握预测和理解热不稳定性这一重要破裂前兆的核心技能 。",
            "id": "3708706",
            "problem": "一个程序必须根据能量平衡和碰撞辐射冷却的第一性原理，计算在环形磁约束装置中，核心杂质辐射是否能达到引发热坍塌的水平。考虑一个具有圆柱对称性、大半径为 $R_0$、小半径为 $a$ 的圆形截面环。在小半径 $r$ 处的薄环环形体积元为 $dV = 4 \\pi^2 R_0 r \\, dr$。目标是根据杂质辐射函数 $L_Z(T)$ 计算由指定杂质种类引起的核心辐射功率，并确定核心辐射超过输入加热功率指定比例的核心温度范围。\n\n使用以下物理基础：\n- 能量平衡为 $dW/dt = P_{\\text{in}} - P_{\\text{loss}}$，其中 $P_{\\text{loss}}$ 包括辐射。核心即将发生热坍塌的一个充分条件是 $P_{\\text{rad, core}} \\ge \\beta P_{\\text{in}}$，其中 $\\beta$ 是一个规定的分数，$P_{\\text{in}}$ 是总加热功率（假定为常数），$P_{\\text{rad, core}}$ 是杂质核心辐射功率。\n- 由杂质种类 $Z$ 引起的局部辐射功率密度为 $p_{\\text{rad}}(r) = n_e(r)\\, n_Z(r)\\, L_Z\\!\\left(T_e(r)\\right)$，其中 $n_e$ 是电子密度，$n_Z$ 是杂质密度，$L_Z(T)$ 是日冕平衡下的杂质辐射函数（冷却速率系数），单位为 $\\text{W}\\cdot\\text{m}^3$。\n- 核心区域定义为 $r \\in [0, r_c]$，其中 $r_c = \\gamma a$，$\\gamma$ 是小半径的一个给定分数。核心辐射功率为 $P_{\\text{rad, core}}(T_0) = \\displaystyle \\int_0^{r_c} n_e(r)\\, n_Z(r)\\, L_Z\\!\\left(T_e(r)\\right)\\, 4 \\pi^2 R_0 r \\, dr$，针对给定的中心温度 $T_0$ 进行计算。\n\n分布剖面和单位：\n- 电子密度剖面：$n_e(r) = n_0 \\left[1 - \\left(\\dfrac{r}{a}\\right)^2\\right]^{s_n}$，其中 $n_0$ 的单位是 $\\text{m}^{-3}$，$s_n \\ge 0$ 是无量纲的。\n- 杂质分数剖面：$f_Z(r) = f_{Z,\\text{edge}} + \\left(f_{Z,0} - f_{Z,\\text{edge}}\\right) \\left[1 - \\left(\\dfrac{r}{a}\\right)^{p_f}\\right]$，其中 $f_{Z,0}$ 和 $f_{Z,\\text{edge}}$ 是无量纲的；杂质密度为 $n_Z(r) = f_Z(r)\\, n_e(r)$。\n- 电子温度剖面：$T_e(r) = T_{\\text{edge}} + \\left(T_0 - T_{\\text{edge}}\\right) \\left[1 - \\left(\\dfrac{r}{a}\\right)^{\\alpha_T}\\right]$，其中 $T$ 的单位是 $\\text{keV}$。辐射函数 $L_Z$ 在 $T_e$ 处计算，通过 $T[\\text{eV}] = 1000\\, T[\\text{keV}]$ 转换为 $\\text{eV}$。\n- 坍塌判据：$P_{\\text{rad, core}}(T_0) \\ge \\beta P_{\\text{in}}$。\n- 要求输出单位：以 $\\text{keV}$ 报告 $T$ 值，以 $\\text{MW}$ 报告功率。\n\n要使用的杂质辐射函数 $L_Z(T)$（在 $T$ 以 $\\text{eV}$ 为单位时，合理的解析近似式，单位为 $\\text{W}\\cdot\\text{m}^3$）：\n- 氖 ($Z=\\text{Ne}$): $L_{\\text{Ne}}(T) = 3.0\\times 10^{-31} \\left(\\dfrac{T}{150.0}\\right)^{0.2} \\exp\\!\\left(-\\dfrac{T}{250.0}\\right) + 1.0\\times 10^{-32} \\left(\\dfrac{T}{1000.0}\\right)^{0.5} \\exp\\!\\left(-\\dfrac{T}{5000.0}\\right)$。\n- 氩 ($Z=\\text{Ar}$): $L_{\\text{Ar}}(T) = 1.5\\times 10^{-31} \\left(\\dfrac{T}{1500.0}\\right)^{0.4} \\exp\\!\\left(-\\dfrac{T}{2200.0}\\right) + 3.0\\times 10^{-32} \\left(\\dfrac{T}{6000.0}\\right)^{0.5} \\exp\\!\\left(-\\dfrac{T}{8000.0}\\right)$。\n\n算法任务：\n对于每个测试用例，在指定的区间 $[T_{\\min}, T_{\\max}]$ 上用 $N_T$ 个均匀间隔的样本扫描中心温度 $T_0$。对于每个 $T_0$，计算 $P_{\\text{rad, core}}(T_0)$；确定：\n- 在扫描中 $P_{\\text{rad, core}}$ 达到其最大值时的温度 $T_{\\text{pk}}$，以及相应的峰值核心辐射功率 $P_{\\text{pk}}$。\n- 坍塌判据成立的 $T_0$ 值区间，由扫描中满足 $P_{\\text{rad, core}}(T_0) \\ge \\beta P_{\\text{in}}$ 的最小和最大 $T_0$ 概括。如果没有 $T_0$ 满足该判据，则报告 $T_{\\min}^{\\text{collapse}} = 0.0$ 和 $T_{\\max}^{\\text{collapse}} = 0.0$。\n\n测试套件：\n提供以下四个测试用例，每个用例由一组参数元组 $(\\text{species}, R_0, a, n_0, s_n, f_{Z,0}, f_{Z,\\text{edge}}, p_f, T_{\\text{edge}}, \\alpha_T, \\gamma, P_{\\text{in}}, \\beta, T_{\\min}, T_{\\max}, N_T)$ 定义，单位如上所述：\n- 用例 1（理想路径，氖，中等尺寸装置和掺杂）：$(\\text{\"Ne\"},\\, 1.7,\\, 0.5,\\, 8.0\\times 10^{19},\\, 1.0,\\, 5.0\\times 10^{-3},\\, 2.0\\times 10^{-3},\\, 1.0,\\, 0.1,\\, 2.0,\\, 0.3,\\, 8.0\\times 10^{6},\\, 0.3,\\, 0.5,\\, 5.0,\\, 120)$。\n- 用例 2（高加热功率，氩，低掺杂，可能会坍塌）：$(\\text{\"Ar\"},\\, 1.7,\\, 0.5,\\, 8.0\\times 10^{19},\\, 1.0,\\, 1.0\\times 10^{-3},\\, 5.0\\times 10^{-4},\\, 1.0,\\, 0.5,\\, 2.0,\\, 0.3,\\, 2.5\\times 10^{7},\\, 0.3,\\, 1.0,\\, 10.0,\\, 120)$。\n- 用例 3（强氖掺杂，较低加热功率，易于坍塌）：$(\\text{\"Ne\"},\\, 1.7,\\, 0.5,\\, 8.0\\times 10^{19},\\, 1.0,\\, 1.0\\times 10^{-2},\\, 5.0\\times 10^{-3},\\, 1.0,\\, 0.1,\\, 2.0,\\, 0.3,\\, 6.0\\times 10^{6},\\, 0.3,\\, 0.3,\\, 3.0,\\, 120)$。\n- 用例 4（较小装置，氩，中等掺杂，适度加热）：$(\\text{\"Ar\"},\\, 1.0,\\, 0.4,\\, 6.0\\times 10^{19},\\, 1.0,\\, 3.0\\times 10^{-3},\\, 1.0\\times 10^{-3},\\, 1.0,\\, 0.2,\\, 2.0,\\, 0.3,\\, 5.0\\times 10^{6},\\, 0.3,\\, 0.5,\\, 5.0,\\, 120)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个由四个子列表组成的列表，每个测试用例一个子列表，每个子列表的形式为 $[T_{\\text{pk}}, P_{\\text{pk}}, T_{\\min}^{\\text{collapse}}, T_{\\max}^{\\text{collapse}}]$，其中 $T_{\\text{pk}}$、$T_{\\min}^{\\text{collapse}}$ 和 $T_{\\max}^{\\text{collapse}}$ 的单位是 $\\text{keV}$，$P_{\\text{pk}}$ 的单位是 $\\text{MW}$。该单行必须是一个用方括号括起来的逗号分隔列表，打印输出中的数值四舍五入到六位小数，例如 $[[0.750000,1.234567,0.300000,1.200000],[\\dots]]$。",
            "solution": "这个问题是有效的，因为它在科学上基于等离子体物理学的既定原理，在数学上是适定的，并提供了一套完整且一致的数据和定义。任务是计算环形聚变等离子体核心中杂质的辐射功率，并基于此辐射评估热坍塌的风险。\n\n问题的核心是计算等离子体核心内（定义为区域 $r \\in [0, r_c]$，其中 $r_c = \\gamma a$）由指定杂质种类产生的总辐射功率。总核心辐射功率 $P_{\\text{rad, core}}$，作为中心电子温度 $T_0$ 的函数，由局部辐射功率密度 $p_{\\text{rad}}(r)$ 的体积分给出。\n\n局部辐射功率密度由以下公式给出：\n$$p_{\\text{rad}}(r) = n_e(r) \\, n_Z(r) \\, L_Z(T_e(r))$$\n其中 $n_e(r)$ 是电子密度剖面，$n_Z(r)$ 是杂质密度剖面，$L_Z(T_e(r))$ 是在局部电子温度 $T_e(r)$ 下计算的杂质辐射函数（冷却速率系数）。对于 $L_Z$ 函数，温度单位必须是 $\\text{eV}$，而剖面是在 $\\text{keV}$ 中定义的，需要进行转换 $T[\\text{eV}] = 1000 \\cdot T[\\text{keV}]$。\n\n杂质密度 $n_Z(r)$ 通过杂质分数剖面 $f_Z(r)$ 与电子密度 $n_e(r)$ 相关：\n$$n_Z(r) = f_Z(r) \\, n_e(r)$$\n将此代入功率密度表达式得到：\n$$p_{\\text{rad}}(r) = n_e(r)^2 \\, f_Z(r) \\, L_Z(T_e(r))$$\n\n总功率通过在核心体积上对该功率密度进行积分得到。使用提供的薄环环形体积元 $dV = 4 \\pi^2 R_0 r \\, dr$，核心辐射功率的积分变为：\n$$P_{\\text{rad, core}}(T_0) = \\int_0^{r_c} p_{\\text{rad}}(r) \\, dV = \\int_0^{r_c} n_e(r)^2 \\, f_Z(r) \\, L_Z(T_e(r)) \\, 4 \\pi^2 R_0 r \\, dr$$\n\n电子密度 $n_e(r)$、杂质分数 $f_Z(r)$ 和电子温度 $T_e(r)$ 的剖面如下所示：\n1. 电子密度剖面：\n    $$n_e(r) = n_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2\\right]^{s_n}$$\n2. 杂质分数剖面：\n    $$f_Z(r) = f_{Z,\\text{edge}} + (f_{Z,0} - f_{Z,\\text{edge}}) \\left[1 - \\left(\\frac{r}{a}\\right)^{p_f}\\right]$$\n3. 电子温度剖面（依赖于中心温度 $T_0$）：\n    $$T_e(r) = T_{\\text{edge}} + (T_0 - T_{\\text{edge}}) \\left[1 - \\left(\\frac{r}{a}\\right)^{\\alpha_T}\\right]$$\n\n还提供了氖（$Z=\\text{Ne}$）和氩（$Z=\\text{Ar}$）的杂质辐射函数 $L_Z(T)$ 的解析形式，其中温度 $T$ 的单位是 $\\text{eV}$。\n\n由于被积函数的复杂性（它涉及径向相关项的幂和指数函数的乘积），$P_{\\text{rad, core}}(T_0)$ 积分的解析解是不可行的。因此，需要采用数值方法。\n\n算法步骤如下：\n1. 定义一组离散的中心温度 $T_0$ 进行评估，跨越区间 $[T_{\\min}, T_{\\max}]$，包含 $N_T$ 个点。这通过线性间距实现：$T_{0,i} = T_{\\min} + i \\cdot \\frac{T_{\\max} - T_{\\min}}{N_T - 1}$，其中 $i=0, 1, \\dots, N_T-1$。\n2. 对于扫描中的每个 $T_{0,i}$ 值：\n    a. 构建完整的被积函数 $I(r, T_{0,i}) = n_e(r)^2 \\, f_Z(r) \\, L_Z(1000 \\cdot T_e(r, T_{0,i})) \\, 4 \\pi^2 R_0 r$。\n    b. 对 $I(r, T_{0,i})$ 关于小半径 $r$ 从 $0$ 到核心半径 $r_c = \\gamma a$ 进行数值积分。一个稳健的数值求积方法，如 `scipy.integrate.quad` 提供的，适合此任务。如果所有输入参数都采用国际单位制（SI），则此积分的结果是 $P_{\\text{rad, core}}(T_{0,i})$，单位为瓦特。\n3. 在计算扫描中所有 $T_0$ 对应的 $P_{\\text{rad, core}}$ 值数组后，分析结果：\n    a. 找到核心辐射功率的最大值，$P_{\\text{pk}} = \\max(P_{\\text{rad, core}}(T_{0,i}))$。对应的中心温度是 $T_{\\text{pk}}$。功率单位必须从 W 转换为 MW（$1 \\, \\text{MW} = 10^6 \\, \\text{W}$）。\n    b. 确定热坍塌条件。如果 $P_{\\text{rad, core}}(T_0) \\ge \\beta P_{\\text{in}}$，则认为即将发生坍塌。阈值功率 $P_{\\text{threshold}} = \\beta P_{\\text{in}}$ 对于给定的测试用例是一个常数。\n    c. 识别扫描中满足此坍塌判据的所有温度 $T_0$。要求的输出是这些温度的最小值和最大值，记为 $T_{\\min}^{\\text{collapse}}$ 和 $T_{\\max}^{\\text{collapse}}$。如果扫描中没有温度满足条件，则两个值都报告为 $0.0 \\, \\text{keV}$。\n\n此过程系统地应用于问题陈述中提供的每个测试用例。最终输出是一个格式化的列表，总结了每个用例的结果（$T_{\\text{pk}}$，$P_{\\text{pk}}$，$T_{\\min}^{\\text{collapse}}$，$T_{\\max}^{\\text{collapse}}$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes core impurity radiation and assesses thermal collapse risk in a tokamak.\n    \"\"\"\n\n    # Test cases defined by the tuple:\n    # (species, R0, a, n0, sn, f_Z0, f_Z_edge, pf, T_edge, alpha_T, gamma, P_in, beta, T_min, T_max, N_T)\n    test_cases = [\n        (\"Ne\", 1.7, 0.5, 8.0e19, 1.0, 5.0e-3, 2.0e-3, 1.0, 0.1, 2.0, 0.3, 8.0e6, 0.3, 0.5, 5.0, 120),\n        (\"Ar\", 1.7, 0.5, 8.0e19, 1.0, 1.0e-3, 5.0e-4, 1.0, 0.5, 2.0, 0.3, 2.5e7, 0.3, 1.0, 10.0, 120),\n        (\"Ne\", 1.7, 0.5, 8.0e19, 1.0, 1.0e-2, 5.0e-3, 1.0, 0.1, 2.0, 0.3, 6.0e6, 0.3, 0.3, 3.0, 120),\n        (\"Ar\", 1.0, 0.4, 6.0e19, 1.0, 3.0e-3, 1.0e-3, 1.0, 0.2, 2.0, 0.3, 5.0e6, 0.3, 0.5, 5.0, 120),\n    ]\n\n    # Impurity radiation functions L_Z(T) in W.m^3, with T in eV.\n    def L_Ne(T_ev):\n        # A simple check to prevent math domain errors for T_ev = 0\n        if T_ev == 0:\n            return 0.0\n        term1 = 3.0e-31 * (T_ev / 150.0)**0.2 * np.exp(-T_ev / 250.0)\n        term2 = 1.0e-32 * (T_ev / 1000.0)**0.5 * np.exp(-T_ev / 5000.0)\n        return term1 + term2\n\n    def L_Ar(T_ev):\n        # A simple check to prevent math domain errors for T_ev = 0\n        if T_ev == 0:\n            return 0.0\n        term1 = 1.5e-31 * (T_ev / 1500.0)**0.4 * np.exp(-T_ev / 2200.0)\n        term2 = 3.0e-32 * (T_ev / 6000.0)**0.5 * np.exp(-T_ev / 8000.0)\n        return term1 + term2\n\n    L_Z_funcs = {\"Ne\": L_Ne, \"Ar\": L_Ar}\n    \n    all_results = []\n    \n    for case in test_cases:\n        species, R0, a, n0, sn, f_Z0, f_Z_edge, pf, T_edge, alpha_T, gamma, P_in, beta, T_min, T_max, N_T = case\n        \n        l_z_func = L_Z_funcs[species]\n        r_c = gamma * a\n        \n        # Define profile functions based on problem statement\n        def n_e(r):\n            return n0 * (1 - (r / a)**2)**sn\n\n        def f_z(r):\n            return f_Z_edge + (f_Z0 - f_Z_edge) * (1 - (r / a)**pf)\n\n        def T_e_kev(r, T0_kev):\n            return T_edge + (T0_kev - T_edge) * (1 - (r / a)**alpha_T)\n\n        # Define the integrand for numerical integration\n        def integrand(r, T0_kev):\n            t_e_val_kev = T_e_kev(r, T0_kev)\n            \n            # Radiation function expects temperature in eV\n            t_e_val_ev = 1000.0 * t_e_val_kev\n            \n            # The radiation functions L_Z are defined piecewise implicitly\n            if t_e_val_ev == 0:\n                l_z_val = 0.0\n            else:\n                l_z_val = l_z_func(t_e_val_ev)\n            \n            n_e_val = n_e(r)\n            f_z_val = f_z(r)\n            \n            # Power density p_rad = n_e^2 * f_Z * L_Z\n            p_rad = n_e_val**2 * f_z_val * l_z_val\n            \n            # Power in a volume element dV = 4 * pi^2 * R0 * r * dr\n            return p_rad * 4 * np.pi**2 * R0 * r\n\n        # Scan over the central temperature T0\n        T0_scan = np.linspace(T_min, T_max, N_T)\n        P_rad_core_scan = []\n\n        for T0 in T0_scan:\n            power_watts, _ = quad(integrand, 0, r_c, args=(T0,))\n            P_rad_core_scan.append(power_watts)\n        \n        P_rad_core_scan = np.array(P_rad_core_scan)\n        \n        # Analyze results\n        # Find peak radiated power and corresponding temperature\n        P_pk_watts = np.max(P_rad_core_scan)\n        P_pk_mw = P_pk_watts / 1e6\n        T_pk = T0_scan[np.argmax(P_rad_core_scan)]\n        \n        # Determine collapse interval\n        P_threshold_watts = beta * P_in\n        collapse_indices = np.where(P_rad_core_scan >= P_threshold_watts)[0]\n        \n        if len(collapse_indices) > 0:\n            T_min_collapse = T0_scan[collapse_indices[0]]\n            T_max_collapse = T0_scan[collapse_indices[-1]]\n        else:\n            T_min_collapse = 0.0\n            T_max_collapse = 0.0\n            \n        all_results.append([T_pk, P_pk_mw, T_min_collapse, T_max_collapse])\n\n    # Format output string\n    result_str = \",\".join(\n        f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{r[3]:.6f}]\" for r in all_results\n    )\n    \n    # Final print statement in the exact required format.\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "主破裂的发生通常涉及一系列不稳定性的链式反应，其中一种不稳定性会触发另一种更具破坏性的不稳定性。本练习探讨了一个经典的级联过程：由中心安全因子 $q$ 低于1驱动的锯齿振荡，如何为等离子体中更外围的新经典撕裂模 (Neoclassical Tearing Mode, NTM) 提供“种子”岛。通过构建一个简化模型来分析这种耦合机制，您可以评估一个相对温和的破裂前兆如何演变成一个可能导致主破裂的重大威胁 。这项练习对于理解不同磁流体不稳定性之间的相互作用以及破裂的非线性发展路径至关重要。",
            "id": "3708752",
            "problem": "考虑一个大环径比的圆截面托卡马克，其大半径为 $R$，小半径为 $a$，环向磁场 $B_t$ 恒定。测量的安全因子剖面在磁轴附近可以通过归一化小半径 $x = r/a$ 的多项式很好地拟合：\n$$\nq(r) = q_0 + c_2 x^2 + c_4 x^4,\n$$\n其中 $q_0$、$c_2$ 和 $c_4$ 为非负常数，且 $r \\in [0,a]$。磁剪切定义为\n$$\ns(r) = \\frac{r}{q(r)} \\frac{dq}{dr}.\n$$\n对于上述多项式模型，请用 $x$、$q_0$、$c_2$、$c_4$ 和 $a$ 明确地计算 $\\frac{dq}{dr}$ 和 $s(r)$。对于大环径比托卡马克，极向磁场可近似为\n$$\nB_\\theta(r) = \\frac{r B_t}{R q(r)}.\n$$\n\n我们希望在轴上安全因子略高于1时，评估由锯齿模触发的新经典撕裂模（NTM）种子形成的易感性。在一个简化解析预测模型中，我们定义以下步骤：\n\n1. 假设由于锯齿事件之间的慢速电流扩散，存在一个小的安全因子衰减量 $\\delta_q > 0$，并将预期的 $q=1$ 面半径 $r_1$ 定义为以下方程在 $[0,a]$ 区间内的解：\n$$\nq(r) - \\delta_q = 1.\n$$\n用 $x=r/a$ 表示，令 $y = x^2$。那么，当且仅当方程\n$$\nc_4 y^2 + c_2 y - D = 0, \\quad \\text{其中} \\quad D = 1 + \\delta_q - q_0,\n$$\n有一个满足 $0 \\le y \\le 1$ 的解 $y$ 时，$r_1$ 才存在。如果 $c_4 = 0$，方程简化为 $c_2 y - D = 0$。如果 $D \\le 0$ 或者计算出的 $y$ 不在 $[0,1]$ 区间内，那么在假设的衰减量下，不会形成预期的 $q=1$ 面。在这种情况下，将内扭曲模的边缘稳定性定义为稳定，即设置边缘稳定性指数为 $1$，种子磁岛宽度为 $0$。\n\n2. 如果 $r_1$ 存在，计算在 $r_1$ 处的磁剪切，\n$$\ns_1 = s(r_1),\n$$\n并使用全局极向场标度和核心区体积标度，定义 $q=1$ 核心区内的有效极向比压：\n$$\n\\beta_{p,\\mathrm{eff}} = \\left( \\frac{2 \\mu_0 p_0}{B_\\theta(a)^2} \\right) \\left( \\frac{r_1}{a} \\right)^2,\n$$\n其中 $\\mu_0$ 是真空磁导率，$p_0$ 是中心压强。使用一个受能量原理启发的简化模型，将内扭曲模边缘稳定性指数定义为\n$$\n\\mathcal{M} = 1 - \\frac{\\beta_{p,\\mathrm{eff}}}{\\frac{1}{2} s_1^2}.\n$$\n在这里，$\\mathcal{M} \\approx 0$ 表示临界稳定，$\\mathcal{M}  0$ 表示在假设的衰减量下不稳定，而 $\\mathcal{M} > 0$ 表示稳定。\n\n3. 对于 NTM 种子形成，关注 $m/n = 2/1$ 有理面（即 $q=2$ 面）。将 $r_s$ 定义为以下方程在 $[0,a]$ 区间内的任意解：\n$$\nq(r_s) = 2.\n$$\n用 $y = x^2$ 表示，即\n$$\nc_4 y^2 + c_2 y + (q_0 - 2) = 0,\n$$\n其中 $y \\in [0,1]$。如果不存在这样的 $r_s$，则将种子磁岛宽度设为 $0$。\n\n4. 如果 $r_1$ 和 $r_s$ 都存在，为 $q=2$ 面上由锯齿模种下的初始磁岛半宽度定义一个简化耦合模型：\n$$\nw_{\\mathrm{seed}} = C \\, \\frac{r_1^2}{R} \\, \\frac{B_\\theta(r_1)}{B_\\theta(r_s)} \\, \\frac{1}{\\sqrt{s(r_s)}},\n$$\n其中 $C$ 是一个无量纲耦合常数，设为 $C = 10$ 以表示在大环径比装置中，从核心区崩塌到外部有理面的有限 $m$ 模式耦合效率。该模型量纲一致，且种子尺寸与核心区位移标度 $r_1$、磁力线螺距比以及 $q=2$ 面上的局域磁剪切成比例。\n\n使用以上定义，实现一个程序，为每个测试用例计算：\n- 内扭曲模边缘稳定性指数 $\\mathcal{M}$（无量纲）。\n- 相关的 $q=2$ 面上的种子磁岛宽度 $w_{\\mathrm{seed}}$（单位：米）。\n\n以米为单位表示 $w_{\\mathrm{seed}}$，并将两个输出都四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是一个测试用例的结果对 $[\\mathcal{M}, w_{\\mathrm{seed}}]$。例如，输出格式必须是：\n$$\n[\\,[\\mathcal{M}_1, w_{\\mathrm{seed},1}], [\\mathcal{M}_2, w_{\\mathrm{seed},2}], \\dots ]\n$$\n\n测试套件：\n使用以下参数集，每组由 $(R, a, B_t, p_0, q_0, c_2, c_4, \\delta_q)$ 定义，其中 $R$ 的单位是米，$a$ 的单位是米，$B_t$ 的单位是特斯拉，$p_0$ 的单位是帕斯卡，$\\delta_q$ 是无量纲的：\n- 用例 1： $(3.0, 1.0, 5.0, 1.2 \\times 10^5, 1.03, 0.9, 0.4, 0.04)$\n- 用例 2： $(2.8, 0.9, 5.3, 1.8 \\times 10^5, 1.01, 1.1, 0.6, 0.02)$\n- 用例 3（在衰减量下没有 $q=1$ 交越）： $(3.2, 1.1, 4.8, 1.0 \\times 10^5, 1.10, 0.7, 0.3, 0.05)$\n- 用例 4（剖面中没有 $q=2$ 面）： $(2.7, 0.95, 5.5, 1.5 \\times 10^5, 1.02, 0.5, 0.1, 0.03)$\n\n您的程序必须：\n- 一致地实现上述简化模型。\n- 使用真空磁导率 $\\mu_0 = 4 \\pi \\times 10^{-7} \\, \\mathrm{N \\, A^{-2}}$。\n- 为每个用例返回 $[\\mathcal{M}, w_{\\mathrm{seed}}]$，四舍五入到六位小数。\n- 打印一行包含所有测试用例结果对的列表，格式与上述描述完全一致。",
            "solution": "在尝试解答之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n\n**常量和变量：**\n- 大半径：$R$ (m)\n- 小半径：$a$ (m)\n- 环向磁场：$B_t$ (T)\n- 中心压强：$p_0$ (Pa)\n- 轴上安全因子：$q_0$ (无量纲)\n- 安全因子剖面系数：$c_2, c_4$ (无量纲)\n- 安全因子衰减量：$\\delta_q$ (无量纲)\n- 归一化小半径：$x = r/a$，其中 $r \\in [0, a]$ 是小半径坐标。\n- 真空磁导率：$\\mu_0 = 4 \\pi \\times 10^{-7} \\, \\mathrm{N \\, A^{-2}}$\n- 无量纲耦合常数：$C=10$\n\n**模型定义：**\n1.  **安全因子剖面：** $q(r) = q_0 + c_2 x^2 + c_4 x^4$\n2.  **磁剪切：** $s(r) = \\frac{r}{q(r)} \\frac{dq}{dr}$\n3.  **极向磁场（大环径比）：** $B_\\theta(r) = \\frac{r B_t}{R q(r)}$\n4.  **预期的 $q=1$ 面半径 ($r_1$)：** 定义为 $q(r_1) - \\delta_q = 1$ 的解。这等效于求解 $c_4 y^2 + c_2 y - D = 0$ 以得到 $y = (r_1/a)^2$，其中 $D = 1 + \\delta_q - q_0$。\n    -   **条件：** 当且仅当在 $[0, 1]$ 范围内存在解 $y$ 时，才存在有效的 $r_1$。\n    -   **无 $r_1$ 的情况：** 如果 $D \\le 0$ 或计算出的 $y \\notin [0,1]$，则将边缘稳定性指数设为 $\\mathcal{M}=1$，种子磁岛宽度设为 $w_{\\mathrm{seed}}=0$。\n5.  **$r_1$ 处的磁剪切：** $s_1 = s(r_1)$\n6.  **有效极向比压：** $\\beta_{p,\\mathrm{eff}} = \\left( \\frac{2 \\mu_0 p_0}{B_\\theta(a)^2} \\right) \\left( \\frac{r_1}{a} \\right)^2$\n7.  **内扭曲模边缘稳定性指数：** $\\mathcal{M} = 1 - \\frac{\\beta_{p,\\mathrm{eff}}}{\\frac{1}{2} s_1^2}$\n8.  **$q=2$ 面半径 ($r_s$)：** 定义为 $q(r_s) = 2$ 在 $[0,a]$ 内的任意解。这等效于求解 $c_4 y^2 + c_2 y + (q_0 - 2) = 0$ 以得到 $y=(r_s/a)^2 \\in [0,1]$。\n    -   **无 $r_s$ 的情况：** 如果不存在这样的 $r_s$，则将 $w_{\\mathrm{seed}}$ 设为 $0$。\n9.  **种子磁岛宽度：** $w_{\\mathrm{seed}} = C \\, \\frac{r_1^2}{R} \\, \\frac{B_\\theta(r_1)}{B_\\theta(r_s)} \\, \\frac{1}{\\sqrt{s(r_s)}}$（如果 $r_1$ 和 $r_s$ 都存在）。\n\n**测试套件：**\n- 用例 1： $(R, a, B_t, p_0, q_0, c_2, c_4, \\delta_q) = (3.0, 1.0, 5.0, 1.2 \\times 10^5, 1.03, 0.9, 0.4, 0.04)$\n- 用例 2： $(2.8, 0.9, 5.3, 1.8 \\times 10^5, 1.01, 1.1, 0.6, 0.02)$\n- 用例 3： $(3.2, 1.1, 4.8, 1.0 \\times 10^5, 1.10, 0.7, 0.3, 0.05)$\n- 用例 4： $(2.7, 0.95, 5.5, 1.5 \\times 10^5, 1.02, 0.5, 0.1, 0.03)$\n\n**输出：**\n- 对于每个用例，计算内扭曲模边缘稳定性指数 $\\mathcal{M}$ 和种子磁岛宽度 $w_{\\mathrm{seed}}$（单位：米）。\n- 将两个输出都四舍五入到六位小数。\n- 最终输出为单行：`[[M1,w1],[M2,w2],...]`\n\n### 步骤 2：使用提取的已知条件进行验证\n\n1.  **科学上合理：** 该问题设置在托卡马克等离子体稳定性这一成熟的核聚变研究子领域背景下。所使用的概念——安全因子 ($q$)、磁剪切 ($s$)、极向比压 ($\\beta_p$)、新经典撕裂模 (NTM) 和锯齿模——都是标准概念。提供的方程构成了一个“简化解析预测模型”，这是物理学中一种常见的方法，用以通过简化但具有物理动机的公式来捕捉基本动力学。磁轴附近 $q(r)$ 的多项式形式以及 $B_\\theta(r)$ 的大环径比近似是标准教科书内容。$\\mathcal{M}$ 的模型被描述为“受能量原理启发的”，而 $w_{\\mathrm{seed}}$ 的模型包含了与核心区位移 ($r_1^2/R$)、磁力线螺距比 ($B_\\theta(r_1)/B_\\theta(r_s)$) 和局域磁剪切 ($s(r_s)$) 相关的物理上合理的标度关系。该问题在其作为简化模型的既定范围内是科学合理的。\n\n2.  **定义明确：** 问题陈述为计算输出提供了一个完整的、分步的算法。它明确定义了所有变量和关系。关键在于，它为处理所有意外情况（例如 $q=1$ 或 $q=2$ 面不存在）提供了清晰的指令。这些面的存在条件通过二次方程在特定物理域（$y \\in [0,1]$）内的可解性被明确定义。这种结构确保可以为任何有效的输入参数集计算出唯一且有意义的解。\n\n3.  **客观性：** 问题陈述使用了精确、量化和客观的语言。没有主观论断或观点。将模型定性为“简化解析预测模型”是一种客观描述。\n\n4.  **其他缺陷：** 问题是自洽的，提供了所有必要的数据和常数。测试用例中的参数对于托卡马克实验来说是物理上合理的。没有矛盾、循环论证或含糊之处。\n\n### 步骤 3：结论与行动\n\n问题陈述是 **有效的**。它科学上合理、定义明确、客观且完整。我现在将着手解决。\n\n### 解题推导与算法\n\n首先，我们推导计算所需的显式表达式。给定用 $x=r/a$ 表示的安全因子剖面：\n$$\nq(x) = q_0 + c_2 x^2 + c_4 x^4\n$$\n关于 $r$ 的导数通过链式法则求得，$\\frac{dq}{dr} = \\frac{dq}{dx} \\frac{dx}{dr}$：\n$$\n\\frac{dq}{dx} = 2 c_2 x + 4 c_4 x^3\n$$\n$$\n\\frac{dx}{dr} = \\frac{1}{a}\n$$\n因此，\n$$\n\\frac{dq}{dr} = \\frac{1}{a} (2 c_2 x + 4 c_4 x^3)\n$$\n磁剪切 $s(r)$ 随之表示为：\n$$\ns(r) = \\frac{r}{q(r)} \\frac{dq}{dr} = \\frac{ax}{q(x)} \\frac{1}{a}(2 c_2 x + 4 c_4 x^3) = \\frac{2 c_2 x^2 + 4 c_4 x^4}{q_0 + c_2 x^2 + c_4 x^4}\n$$\n每个测试用例的算法流程如下：\n\n1.  **初始化：** 将边缘稳定性指数 $\\mathcal{M}$ 设为 $1.0$，种子宽度 $w_{\\mathrm{seed}}$ 设为 $0.0$。这些是如果预期的 $q=1$ 面不形成时的默认值。\n\n2.  **寻找预期的 $q=1$ 面 ($r_1$)：**\n    a. 计算 $D = 1 + \\delta_q - q_0$。\n    b. 如果 $D \\le 0$，则 $q=1$ 面不形成。该用例的算法终止，保留默认输出。\n    c. 如果 $D > 0$，从方程 $c_4 y^2 + c_2 y - D = 0$ 求解 $y_1 = (r_1/a)^2$。由于 $c_2, c_4 \\ge 0$ 且我们需要一个物理可行解 $y_1 \\ge 0$，对于 $c_4 > 0$，正确的根是 $y_1 = \\frac{-c_2 + \\sqrt{c_2^2 + 4c_4 D}}{2c_4}$；对于 $c_4=0$，则是 $y_1 = D/c_2$。\n    d. 如果存在正解 $y_1$ 且 $y_1 \\in [0,1]$，则存在有效的 $r_1$。我们继续下一步。否则，我们保留默认输出。\n\n3.  **计算边缘稳定性指数 ($\\mathcal{M}$):**\n    a. $r_1$ 处的磁剪切为 $s_1 = s(r_1)$。使用 $x_1^2 = y_1$ 和 $q(r_1) = 1+\\delta_q$，磁剪切表达式简化为 $s_1 = \\frac{2c_2 y_1 + 4c_4 y_1^2}{1+\\delta_q}$。\n    b. 等离子体边界（$r=a$, $x=1$）处的安全因子是 $q(a) = q_0 + c_2 + c_4$。\n    c. 边界处的极向场是 $B_\\theta(a) = \\frac{a B_t}{R q(a)}$。\n    d. 有效极向比压是 $\\beta_{p,\\mathrm{eff}} = \\left( \\frac{2 \\mu_0 p_0}{B_\\theta(a)^2} \\right) y_1$。\n    e. 边缘稳定性指数是 $\\mathcal{M} = 1 - \\frac{\\beta_{p,\\mathrm{eff}}}{0.5 s_1^2}$。该值将覆盖默认的 $\\mathcal{M}=1.0$。\n\n4.  **寻找 $q=2$ 面 ($r_s$)：**\n    a. 从方程 $c_4 y^2 + c_2 y + (q_0 - 2) = 0$ 求解 $y_s = (r_s/a)^2$。为了存在物理可行解 ($y_s>0$)，必须有 $q_0-2  0$。对于 $c_4>0$，正确的根是 $y_s = \\frac{-c_2 + \\sqrt{c_2^2 - 4c_4(q_0-2)}}{2c_4}$；对于 $c_4=0$，则是 $y_s = (2-q_0)/c_2$。\n    b. 检查是否存在解且 $y_s \\in [0,1]$。如果不存在，则 $w_{\\mathrm{seed}}$ 保持为 $0.0$。\n\n5.  **计算种子磁岛宽度 ($w_{\\mathrm{seed}})$：**\n    a. 仅当找到了有效的 $r_1$ 和 $r_s$ 时才执行此步骤。\n    b. 极向场之比为 $\\frac{B_\\theta(r_1)}{B_\\theta(r_s)} = \\frac{r_1 q(r_s)}{r_s q(r_1)} = \\frac{a \\sqrt{y_1} \\cdot 2}{a \\sqrt{y_s} (1+\\delta_q)} = \\frac{2 \\sqrt{y_1}}{\\sqrt{y_s} (1+\\delta_q)}$。\n    c. $r_s$ 处的磁剪切是 $s(r_s) = \\frac{2c_2 y_s + 4c_4 y_s^2}{q(r_s)} = \\frac{2c_2 y_s + 4c_4 y_s^2}{2} = c_2 y_s + 2c_4 y_s^2$。\n    d. 种子宽度计算如下 $w_{\\mathrm{seed}} = C \\frac{r_1^2}{R} \\frac{B_\\theta(r_1)}{B_\\theta(r_s)} \\frac{1}{\\sqrt{s(r_s)}} = 10 \\frac{a^2 y_1}{R} \\frac{2\\sqrt{y_1}}{\\sqrt{y_s}(1+\\delta_q)} \\frac{1}{\\sqrt{c_2 y_s + 2c_4 y_s^2}}$。该值将覆盖默认的 $w_{\\mathrm{seed}}=0.0$。\n\n6.  **最终确定：** 计算出的 $\\mathcal{M}$ 和 $w_{\\mathrm{seed}}$ 值四舍五入到六位小数。\n\n对提供的每个测试用例都执行此程序。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the internal kink marginality and NTM seed island width\n    for a series of tokamak scenarios based on a reduced model.\n    \"\"\"\n    \n    # Magnetic permeability of free space (N/A^2 or H/m)\n    MU_0 = 4 * np.pi * 1e-7\n    \n    # Coupling constant from the model\n    C_COUPLING = 10.0\n\n    test_cases = [\n        # (R, a, B_t, p0, q0, c2, c4, delta_q)\n        (3.0, 1.0, 5.0, 1.2e5, 1.03, 0.9, 0.4, 0.04),\n        (2.8, 0.9, 5.3, 1.8e5, 1.01, 1.1, 0.6, 0.02),\n        (3.2, 1.1, 4.8, 1.0e5, 1.10, 0.7, 0.3, 0.05),\n        (2.7, 0.95, 5.5, 1.5e5, 1.02, 0.5, 0.1, 0.03),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        R, a, B_t, p0, q0, c2, c4, delta_q = case\n        \n        # Default values for a stable case or if no q=1 surface forms\n        M_index = 1.0\n        w_seed = 0.0\n\n        # --- Step 1  2: Find r1 and compute Marginality Index M ---\n        D = 1.0 + delta_q - q0\n        \n        r1_exists = False\n        y1 = -1.0 # Normalized radius squared (r1/a)^2\n\n        if D > 0:\n            if c4 == 0:\n                if c2 > 0:\n                    y1 = D / c2\n            else: # c4 > 0\n                discriminant = c2**2 + 4 * c4 * D\n                y1 = (-c2 + np.sqrt(discriminant)) / (2 * c4)\n            \n            if 0 = y1 = 1:\n                r1_exists = True\n\n        if r1_exists:\n            # Calculate Marginality Index M\n            q_at_r1 = 1.0 + delta_q\n            s1 = (2 * c2 * y1 + 4 * c4 * y1**2) / q_at_r1\n            \n            q_at_a = q0 + c2 + c4\n            B_theta_a = (a * B_t) / (R * q_at_a)\n            \n            beta_p_eff = (2 * MU_0 * p0 / (B_theta_a**2)) * y1\n            \n            # Avoid division by zero, although s1 > 0 if r1 is not on axis.\n            if s1 > 1e-9:\n                M_index = 1.0 - beta_p_eff / (0.5 * s1**2)\n\n            # --- Step 3  4: Find rs and compute seed island width w_seed ---\n            rs_exists = False\n            ys = -1.0 # Normalized radius squared (rs/a)^2\n            const_term = q0 - 2.0\n\n            if c4 == 0:\n                if c2 > 0 and const_term  0:\n                    ys = -const_term / c2\n            else: # c4 > 0\n                if const_term  0:\n                    discriminant = c2**2 - 4 * c4 * const_term\n                    if discriminant >= 0:\n                        ys = (-c2 + np.sqrt(discriminant)) / (2 * c4)\n\n            if 0 = ys = 1:\n                rs_exists = True\n\n            if rs_exists:\n                # Calculate shear at q=2 surface, s(rs)\n                # q(rs) = 2\n                s_at_rs = (2 * c2 * ys + 4 * c4 * ys**2) / 2.0\n                \n                if s_at_rs > 0:\n                    r1_sq = a**2 * y1\n                    \n                    # B_theta ratio term: B_theta(r1) / B_theta(rs)\n                    # = (r1 * q(rs)) / (rs * q(r1))\n                    # = (sqrt(y1)*a * 2) / (sqrt(ys)*a * (1+delta_q))\n                    B_theta_ratio = (2.0 * np.sqrt(y1)) / (np.sqrt(ys) * (1 + delta_q))\n                    \n                    w_seed = C_COUPLING * (r1_sq / R) * B_theta_ratio / np.sqrt(s_at_rs)\n\n        results.append([round(M_index, 6), round(w_seed, 6)])\n    \n    # Format the final output string exactly as required\n    inner_parts = [f\"[{m},{w}]\" for m, w in results]\n    print(f\"[{','.join(inner_parts)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在许多破裂事件中，磁岛的“模式锁定”是导致约束彻底丧失的最后阶段。一个正在旋转的大型磁不稳定性（如新经典撕裂模）会因与固有误差场及导电壁的相互作用而减速，最终停止旋转并“锁定”在特定相位上。本练习深入探讨了模式锁定背后的物理原理，通过分析电磁转矩的相互作用来阐明锁定过程。您将推导决定锁定发生的临界条件，并探索如何通过施加外部磁场来主动影响这一过程，这是发展主动破裂规避与控制策略的核心物理基础 。",
            "id": "3708780",
            "problem": "考虑一个大环径比托卡马克，在极向/环向模数 $m/n$ 处有一个单一共振面，该共振面与一个静态内禀误差场和一个单螺旋度外部共振磁扰动（Resonant Magnetic Perturbation, RMP）相互作用。设由内禀误差在有理面上感应出的复共振径向场为 $\\tilde{b}_{i} = b_{i} \\exp(i \\phi_{i})$，其中 $b_{i} > 0$ 且 $\\phi_{i}$ 为内禀场相位。外部RMP线圈产生一个真空场，其实振幅为 $b_{c} > 0$，线圈相位为 $\\phi_{c}$。共振面上的等离子体线性响应由一个复传递函数 $H(\\omega_{0}) = |H| \\exp(i \\phi_{H})$ 建模，该函数在锁定前旋转频率 $\\omega_{0}$ 处取值，因此RMP对共振场的贡献为 $\\tilde{b}_{\\mathrm{RMP}} = H(\\omega_{0})\\, b_{c} \\exp(i \\phi_{c})$。因此，表面上的总复共振场为 $\\tilde{b}_{r} = \\tilde{b}_{i} + \\tilde{b}_{\\mathrm{RMP}}$。\n\n设 $\\delta$ 表示撕裂层相对于某一固定参考系的螺旋相位，并假设撕裂层与共振场之间的电磁相互作用能可以写成 $U(\\delta) = -K\\, \\mathrm{Re}\\left\\{\\tilde{b}_{r} \\exp(-i \\delta)\\right\\}$，其中 $K$ 是一个由撕裂层几何形状和电流通道决定的正常数。相应地，作用在撕裂层上的电磁转矩为 $T_{\\mathrm{EM}}(\\delta) = -\\partial U/\\partial \\delta$。背景旋转由一个恒定的驱动转矩 $T_{\\mathrm{rot}} = D \\,\\omega_{0}$ 维持，其中 $D > 0$。如果电磁转矩在整个螺旋相位上的最大值能够平衡驱动转矩，即 $\\max_{\\delta} |T_{\\mathrm{EM}}(\\delta)| \\ge T_{\\mathrm{rot}}$，则会发生穿透与锁定。\n\n(a) 从第一性原理和以上定义出发，推导依赖于相位的电磁转矩 $T_{\\mathrm{EM}}(\\delta)$，用 $b_{i}$、$\\phi_{i}$、$b_{c}$、$\\phi_{c}$、$|H|$ 和 $\\phi_{H}$ 表示。\n\n(b) 通过施加锁定阈值条件 $\\max_{\\delta} |T_{\\mathrm{EM}}(\\delta)| = T_{\\mathrm{rot}}$，将临界线圈振幅 $b_{c,\\mathrm{crit}}(\\phi_{c})$ 表示为线圈相位 $\\phi_{c}$ 以及参数 $b_{i}$、$|H|$、$K$、$D$ 和 $\\omega_{0}$ 的函数。你可以定义 $B_{c} \\equiv T_{\\mathrm{rot}}/K$ 来简化符号。\n\n(c) 确定使 $b_{c,\\mathrm{crit}}(\\phi_{c})$ 最小化的线圈相位 $\\phi_{\\mathrm{opt}}$，并仅用 $\\phi_{i}$ 和 $\\phi_{H}$ 以弧度为单位给出一个关于 $\\phi_{\\mathrm{opt}}$ 的封闭形式表达式。你最终的方框答案必须只包含这个关于 $\\phi_{\\mathrm{opt}}$ 的表达式。",
            "solution": "问题陈述经评估有效。它在科学上基于应用于托卡马克等离子体的磁流体力学（MHD）原理，特别是磁岛锁定理论。该问题是良定的、客观的、自洽的，并且所有术语都有正式定义。问题从推导到优化逻辑地展开，并且在问题背景所暗示的合理物理推断下，存在一个唯一的、有意义的解。\n\n(a) 电磁转矩 $T_{\\mathrm{EM}}(\\delta)$ 的推导。\n\n电磁相互作用能由 $U(\\delta) = -K\\, \\mathrm{Re}\\left\\{\\tilde{b}_{r} \\exp(-i \\delta)\\right\\}$ 给出，其中 $K$ 是一个正常数，$\\tilde{b}_{r}$ 是总复共振场，$\\delta$ 是撕裂层的螺旋相位。\n\n相应地，作用在撕裂层上的电磁转矩定义为 $T_{\\mathrm{EM}}(\\delta) = -\\partial U/\\partial \\delta$。\n设 $\\tilde{b}_{r} = |\\tilde{b}_{r}| \\exp(i \\phi_{r})$，其中 $|\\tilde{b}_{r}|$ 和 $\\phi_{r}$ 分别是总共振场的振幅和相位。\n那么，能量可以写成：\n$$U(\\delta) = -K\\, \\mathrm{Re}\\left\\{|\\tilde{b}_{r}| \\exp(i \\phi_{r}) \\exp(-i \\delta)\\right\\} = -K |\\tilde{b}_{r}| \\mathrm{Re}\\left\\{\\exp(i (\\phi_{r} - \\delta))\\right\\}$$\n$$U(\\delta) = -K |\\tilde{b}_{r}| \\cos(\\phi_{r} - \\delta)$$\n对 $\\delta$ 求导以求得转矩：\n$$T_{\\mathrm{EM}}(\\delta) = -\\frac{\\partial}{\\partial \\delta} \\left[-K |\\tilde{b}_{r}| \\cos(\\phi_{r} - \\delta)\\right] = K |\\tilde{b}_{r}| \\frac{\\partial}{\\partial \\delta} \\cos(\\phi_{r} - \\delta)$$\n$$T_{\\mathrm{EM}}(\\delta) = K |\\tilde{b}_{r}| \\left[-\\sin(\\phi_{r} - \\delta) \\cdot (-1)\\right] = K |\\tilde{b}_{r}| \\sin(\\phi_{r} - \\delta)$$\n这可以用复指数的虚部来表示：\n$$T_{\\mathrm{EM}}(\\delta) = K |\\tilde{b}_{r}| \\mathrm{Im}\\left\\{\\exp(i(\\phi_{r} - \\delta))\\right\\} = K \\mathrm{Im}\\left\\{|\\tilde{b}_{r}|\\exp(i\\phi_{r}) \\exp(-i \\delta)\\right\\} = K \\mathrm{Im}\\left\\{\\tilde{b}_{r} \\exp(-i \\delta)\\right\\}$$\n现在，我们代入总场表达式 $\\tilde{b}_{r} = \\tilde{b}_{i} + \\tilde{b}_{\\mathrm{RMP}}$。\n内禀误差场为 $\\tilde{b}_{i} = b_{i} \\exp(i \\phi_{i})$。\nRMP的贡献为 $\\tilde{b}_{\\mathrm{RMP}} = H(\\omega_{0}) b_{c} \\exp(i \\phi_{c}) = |H| \\exp(i \\phi_{H}) b_{c} \\exp(i \\phi_{c}) = |H| b_{c} \\exp(i(\\phi_{c} + \\phi_{H}))$。\n所以，转矩变为：\n$$T_{\\mathrm{EM}}(\\delta) = K \\mathrm{Im}\\left\\{\\left(b_{i} \\exp(i \\phi_{i}) + |H| b_{c} \\exp(i(\\phi_{c} + \\phi_{H}))\\right) \\exp(-i \\delta)\\right\\}$$\n$$T_{\\mathrm{EM}}(\\delta) = K \\mathrm{Im}\\left\\{b_{i} \\exp(i(\\phi_{i} - \\delta)) + |H| b_{c} \\exp(i(\\phi_{c} + \\phi_{H} - \\delta))\\right\\}$$\n使用性质 $\\mathrm{Im}(z_1 + z_2) = \\mathrm{Im}(z_1) + \\mathrm{Im}(z_2)$，我们得到用给定参数表示的转矩最终表达式：\n$$T_{\\mathrm{EM}}(\\delta) = K \\left[b_{i} \\sin(\\phi_{i} - \\delta) + |H| b_{c} \\sin(\\phi_{c} + \\phi_{H} - \\delta)\\right]$$\n\n(b) 临界线圈振幅 $b_{c,\\mathrm{crit}}(\\phi_{c})$ 的推导。\n\n锁定阈值由条件 $\\max_{\\delta} |T_{\\mathrm{EM}}(\\delta)| = T_{\\mathrm{rot}}$ 给出。\n从中间表达式 $T_{\\mathrm{EM}}(\\delta) = K |\\tilde{b}_{r}| \\sin(\\phi_{r} - \\delta)$ 可知，当 $|\\sin(\\phi_{r} - \\delta)| = 1$ 时达到最大绝对值。因此：\n$$\\max_{\\delta} |T_{\\mathrm{EM}}(\\delta)| = K |\\tilde{b}_{r}|$$\n锁定条件变为 $K |\\tilde{b}_{r}| = T_{\\mathrm{rot}}$。使用给定的定义 $B_{c} \\equiv T_{\\mathrm{rot}}/K$，这可以简化为：\n$$|\\tilde{b}_{r}| = B_{c}$$\n我们需要解出线圈振幅 $b_{c}$。让我们来表示 $|\\tilde{b}_{r}|^2$：\n$$|\\tilde{b}_{r}|^2 = |\\tilde{b}_{i} + \\tilde{b}_{\\mathrm{RMP}}|^2 = (\\tilde{b}_{i} + \\tilde{b}_{\\mathrm{RMP}})(\\tilde{b}_{i}^* + \\tilde{b}_{\\mathrm{RMP}}^*)$$\n$$|\\tilde{b}_{r}|^2 = |\\tilde{b}_{i}|^2 + |\\tilde{b}_{\\mathrm{RMP}}|^2 + 2\\,\\mathrm{Re}\\{\\tilde{b}_{i} \\tilde{b}_{\\mathrm{RMP}}^*\\}$$\n代入定义：\n$|\\tilde{b}_{i}|^2 = b_{i}^2$\n$|\\tilde{b}_{\\mathrm{RMP}}|^2 = (|H| b_{c})^2$\n$\\tilde{b}_{i} \\tilde{b}_{\\mathrm{RMP}}^* = b_{i} \\exp(i\\phi_{i}) \\cdot |H| b_{c} \\exp(-i(\\phi_{c} + \\phi_{H})) = b_{i} |H| b_{c} \\exp(i(\\phi_{i} - \\phi_{c} - \\phi_{H}))$\n所以，$2\\,\\mathrm{Re}\\{\\tilde{b}_{i} \\tilde{b}_{\\mathrm{RMP}}^*\\} = 2 b_{i} |H| b_{c} \\cos(\\phi_{i} - \\phi_{H} - \\phi_{c})$。\n锁定条件 $|\\tilde{b}_{r}|^2 = B_{c}^2$ 产生了一个关于 $b_{c}$ 的二次方程：\n$$B_{c}^2 = b_{i}^2 + |H|^2 b_{c}^2 + 2 b_{i} |H| b_{c} \\cos(\\phi_{i} - \\phi_{H} - \\phi_{c})$$\n$$|H|^2 b_{c}^2 + \\left(2 b_{i} |H| \\cos(\\phi_{i} - \\phi_{H} - \\phi_{c})\\right) b_{c} + (b_{i}^2 - B_{c}^2) = 0$$\n用二次公式求解 $b_{c}$ 并要求 $b_{c} > 0$ 来选择正根：\n$$b_{c,\\mathrm{crit}}(\\phi_{c}) = \\frac{-2 b_{i} |H| \\cos(\\theta) + \\sqrt{(2 b_{i} |H| \\cos(\\theta))^2 - 4 |H|^2 (b_{i}^2 - B_{c}^2)}}{2|H|^2}$$\n其中 $\\theta = \\phi_{i} - \\phi_{H} - \\phi_{c}$。\n$$b_{c,\\mathrm{crit}}(\\phi_{c}) = \\frac{-b_{i} \\cos(\\theta) + \\sqrt{b_{i}^2 \\cos^2(\\theta) - (b_{i}^2 - B_{c}^2)}}{|H|}$$\n$$b_{c,\\mathrm{crit}}(\\phi_{c}) = \\frac{-b_{i} \\cos(\\phi_{i} - \\phi_{H} - \\phi_{c}) + \\sqrt{B_{c}^2 - b_{i}^2 \\sin^2(\\phi_{i} - \\phi_{H} - \\phi_{c})}}{|H|}$$\n\n(c) 最佳线圈相位 $\\phi_{\\mathrm{opt}}$ 的确定。\n\n目标是找到使所需线圈振幅 $b_{c,\\mathrm{crit}}$ 最小化的线圈相位 $\\phi_{c}$。这是一个几何优化问题。我们试图通过向内禀场 $\\tilde{b}_{i}$ 添加一个RMP感应场 $\\tilde{b}_{\\mathrm{RMP}}$，使得总共振场 $\\tilde{b}_{r}$ 的大小为 $B_{c}$，同时使用最小可能的RMP振幅，即最小化 $|\\tilde{b}_{\\mathrm{RMP}}|=|H| b_{c}$。\n矢量关系为 $\\tilde{b}_{\\mathrm{RMP}} = \\tilde{b}_{r} - \\tilde{b}_{i}$。我们想要最小化 $|\\tilde{b}_{\\mathrm{RMP}}|$。\n在这里，$\\tilde{b}_{i}$ 是复平面中的一个固定矢量，而 $\\tilde{b}_{r}$ 可以是任何其尖端位于以原点为中心、半径为 $B_{c}$ 的圆上的矢量。我们想找到这个圆上离矢量 $\\tilde{b}_{i}$ 尖端最近的点。\n点与圆之间的最小距离出现在连接该点与圆心的直线上。因此，$|\\tilde{b}_{r} - \\tilde{b}_{i}|$ 的最小值为 $||\\tilde{b}_{r}| - |\\tilde{b}_{i}|| = |B_{c} - b_{i}|$。\n当 $\\tilde{b}_{r}$ 和 $\\tilde{b}_{i}$ 共线时，达到这个最小值。所需的 $\\tilde{b}_{\\mathrm{RMP}}$ 矢量的相位决定了最佳线圈相位。\n\n问题陈述指出等离子体有一个锁定前旋转频率 $\\omega_{0}$。这意味着内禀误差场 $\\tilde{b}_{i}$ 本身不足以引起模式锁定。仅由内禀场产生的最大转矩是 $K|\\tilde{b}_{i}| = K b_{i}$。为使模式保持解锁状态，该转矩必须小于驱动转矩 $T_{\\mathrm{rot}}$。\n$$K b_{i}  T_{\\mathrm{rot}}$$\n使用定义 $B_{c} = T_{\\mathrm{rot}}/K$，这意味着：\n$$K b_{i}  K B_{c} \\implies b_{i}  B_{c}$$\n这个物理约束是至关重要的。由于 $b_{i}  B_{c}$，内禀场的幅值小于锁定的目标幅值。为了最小化所施加场的振幅 $|\\tilde{b}_{\\mathrm{RMP}}|$，我们必须施加一个“相长干涉”的场，即与内禀误差场对齐，以便最有效地增加总场幅值。\n所需的最小 $|\\tilde{b}_{\\mathrm{RMP}}|$ 是 $|B_{c} - b_{i}| = B_{c} - b_{i}$。这种情况发生在 $\\tilde{b}_{r}$ 和 $\\tilde{b}_{i}$ 共线且同向时。\n在这种最优情况下，$\\tilde{b}_{\\mathrm{RMP}} = \\tilde{b}_{r} - \\tilde{b}_{i}$ 的相位必须与 $\\tilde{b}_{i}$ 的相位相同。\n$$\\mathrm{phase}(\\tilde{b}_{\\mathrm{RMP}}) = \\mathrm{phase}(\\tilde{b}_{i})$$\nRMP贡献的相位由 $\\phi_{c} + \\phi_{H}$ 给出，内禀场的相位是 $\\phi_{i}$。对于最优设置，$\\phi_{c} = \\phi_{\\mathrm{opt}}$：\n$$\\phi_{\\mathrm{opt}} + \\phi_{H} = \\phi_{i}$$\n求解最佳线圈相位得到最终答案：\n$$\\phi_{\\mathrm{opt}} = \\phi_{i} - \\phi_{H}$$\n这对应于误差场放大，其中所施加RMP的相位被设置为匹配等离子体对内禀误差场本身放大响应的相位，从而增强它以跨过锁定阈值。",
            "answer": "$$\n\\boxed{\\phi_i - \\phi_H}\n$$"
        }
    ]
}