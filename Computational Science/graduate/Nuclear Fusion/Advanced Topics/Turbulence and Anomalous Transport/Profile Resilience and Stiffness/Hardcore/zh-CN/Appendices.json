{
    "hands_on_practices": [
        {
            "introduction": "为了开始我们的动手实践，我们将首先解决刚性输运模型如何塑造等离子体剖面的基本力学问题。这个练习  提供了一个简化但功能强大的模型，其中当温度梯度超过一个临界值时，热输运会急剧增加。通过解析推导稳态温度剖面，您将直接看到系统如何被划分为不同的输运区域，并从第一性原理层面理解剖面刚性如何导致剖面韧性。",
            "id": "3715651",
            "problem": "考虑一个磁约束聚变等离子体芯部的一维板模型，其中稳态温度剖面取决于一个表现出剖面刚性和恢复性的通量驱动输运定律。设向外的径向热通量用 $Q(r)$ 表示，局部刚性控制参数为梯度变量 $\\kappa(r)$，定义为 $\\kappa(r) = -\\frac{dT}{dr}$，因此较大的 $\\kappa(r)$ 对应更陡的温度梯度。假设板的范围是 $r \\in [0,a]$，具有固定的边界温度 $T(a) = T_a$ 和一个对称性条件，该条件将中心处的向外通量设为零，即 $Q(0) = 0$。\n\n对于体加热 $S(r)$，稳态能量平衡由能量守恒定律 $\\nabla \\cdot \\mathbf{q} = S(r)$ 给出，其中 $\\mathbf{q}$ 是热通量密度。在这个一维板模型中，该方程简化为 $\\frac{dQ}{dr} = S(r)$。加热源被指定为空间上均匀的，即 $S(r) = S_0$，其中 $S_0  0$。\n\n剖面刚性通过一个分段的通量-梯度关系引入：\n- 对于 $\\kappa  \\kappa_c$，输运是基线扩散性的，满足 $Q(\\kappa) = \\chi_0 \\kappa$。\n- 对于 $\\kappa \\ge \\kappa_c$，输运变得刚性，模型为 $Q(\\kappa) = \\chi_0 \\kappa + \\alpha (\\kappa - \\kappa_c)^n$。\n\n取指数 $n=2$，参数 $\\chi_0  0$，$\\alpha  0$ 且 $\\kappa_c  0$。假设 $\\chi_0 \\kappa_c  S_0 a$，以确保加热驱动足够强，使得在 $r \\in (0,a)$ 的某个位置超过阈值。\n\n从能量平衡和上述通量-梯度关系出发，推导稳态温度剖面，然后用 $T_a$、$a$、$S_0$、$\\chi_0$、$\\alpha$ 和 $\\kappa_c$ 表示中心温度 $T(0)$。将最终答案表示为单个闭式解析表达式。不要进行近似或四舍五入；不需要进行数值计算，也无需在最终表达式中报告单位。",
            "solution": "该问题被评估为有效。它在科学上基于热输运和能量守恒原理，在数学上是适定的，具有唯一解的充分条件，并且陈述客观。剖面刚性模型是等离子体物理学中使用的标准（尽管是简化的）表示方法。所有参数都定义清晰，约束条件自洽。\n\n出发点是一维板中的稳态能量平衡方程，形式为 $\\frac{dQ(r)}{dr} = S(r)$。体加热源 $S(r)$ 是均匀的，$S(r) = S_0$，其中 $S_0  0$。因此方程为：\n$$\n\\frac{dQ}{dr} = S_0\n$$\n对径向坐标 $r$ 积分，得到热通量剖面：\n$$\nQ(r) = S_0 r + C\n$$\n其中 $C$ 是积分常数。板中心的对称性条件 $Q(0) = 0$ 意味着 $C=0$。因此，热通量由下式给出：\n$$\nQ(r) = S_0 r\n$$\n问题定义了一个基于温度梯度 $\\kappa(r) = -\\frac{dT}{dr}$ 的分段通量-梯度关系。不同输运区之间的转换发生在一个临界梯度 $\\kappa_c$ 处。输运定律在此阈值处是连续的：\n- 对于 $\\kappa  \\kappa_c$：$Q(\\kappa) = \\chi_0 \\kappa$。\n- 对于 $\\kappa \\ge \\kappa_c$：$Q(\\kappa) = \\chi_0 \\kappa + \\alpha (\\kappa - \\kappa_c)^2$。\n\n在转换点 $\\kappa = \\kappa_c$ 处，通量为 $Q(\\kappa_c) = \\chi_0 \\kappa_c$。由于通量 $Q(r)$ 随 $r$ 增加，而梯度 $\\kappa(r)$ 是 $Q(r)$ 的单调递增函数，因此 $\\kappa(r)$ 也是 $r$ 的单调递增函数。等离子体在通量较低的中心附近处于基线输运区，在通量较高的较大半径处进入刚性输运区。转换发生在一个特定半径 $r_c$ 处，此处 $\\kappa(r_c) = \\kappa_c$。我们可以通过令通量表达式相等来求出 $r_c$：\n$$\nQ(r_c) = S_0 r_c = \\chi_0 \\kappa_c\n$$\n解出 $r_c$ 得：\n$$\nr_c = \\frac{\\chi_0 \\kappa_c}{S_0}\n$$\n问题给出的条件是 $\\chi_0 \\kappa_c  S_0 a$，这意味着 $r_c  a$。由于所有参数均为正，所以 $r_c  0$。这证实了转换发生在板的内部，从而定义了两个不同的区域：\n1.  内部区域（基线输运）：$0 \\le r \\le r_c$，其中 $\\kappa(r) \\le \\kappa_c$。\n2.  外部区域（刚性输运）：$r_c  r \\le a$，其中 $\\kappa(r)  \\kappa_c$。\n\n为了求中心温度 $T(0)$，我们对温度梯度 $\\kappa(r) = -\\frac{dT}{dr}$ 从边界 $r=a$ 到中心 $r=0$ 进行积分：\n$$\nT(0) - T(a) = \\int_{a}^{0} \\frac{dT}{dr} dr = \\int_{0}^{a} \\left(-\\frac{dT}{dr}\\right) dr = \\int_{0}^{a} \\kappa(r) dr\n$$\n$$\nT(0) = T_a + \\int_{0}^{a} \\kappa(r) dr\n$$\n该积分被分成两个区域进行：\n$$\nT(0) = T_a + \\int_{0}^{r_c} \\kappa(r) dr + \\int_{r_c}^{a} \\kappa(r) dr\n$$\n首先，我们通过反演通量-梯度关系来求出每个区域中的 $\\kappa(r)$。\n\n在内部区域 ($0 \\le r \\le r_c$)：\n$$\nQ(r) = \\chi_0 \\kappa(r) \\implies S_0 r = \\chi_0 \\kappa(r)\n$$\n$$\n\\kappa(r) = \\frac{S_0}{\\chi_0} r\n$$\n在该区域上的积分为：\n$$\n\\int_{0}^{r_c} \\frac{S_0}{\\chi_0} r \\, dr = \\frac{S_0}{2\\chi_0} [r^2]_0^{r_c} = \\frac{S_0}{2\\chi_0} r_c^2 = \\frac{S_0}{2\\chi_0} \\left( \\frac{\\chi_0 \\kappa_c}{S_0} \\right)^2 = \\frac{\\chi_0 \\kappa_c^2}{2S_0}\n$$\n在外部区域 ($r_c  r \\le a$)：\n$$\nQ(r) = S_0 r = \\chi_0 \\kappa(r) + \\alpha (\\kappa(r) - \\kappa_c)^2\n$$\n这是一个关于 $\\kappa(r)$ 的二次方程。令 $y = \\kappa(r) - \\kappa_c$。方程变为 $S_0 r = \\chi_0(y + \\kappa_c) + \\alpha y^2$，整理后得到：\n$$\n\\alpha y^2 + \\chi_0 y + (\\chi_0 \\kappa_c - S_0 r) = 0\n$$\n使用二次公式解出 $y$：\n$$\ny = \\frac{-\\chi_0 \\pm \\sqrt{\\chi_0^2 - 4\\alpha(\\chi_0 \\kappa_c - S_0 r)}}{2\\alpha}\n$$\n在该区域，$\\kappa(r)  \\kappa_c$，所以 $y  0$。对于 $rr_c$，我们有 $S_0 r  S_0 r_c = \\chi_0 \\kappa_c$，这意味着 $S_0 r - \\chi_0 \\kappa_c  0$。平方根内的项为 $\\chi_0^2 - 4\\alpha\\chi_0\\kappa_c + 4\\alpha S_0 r  \\chi_0^2$。因此 $\\sqrt{\\dots}  \\chi_0$，所以我们必须选择 `+` 号来确保 $y  0$。\n$$\n\\kappa(r) - \\kappa_c = \\frac{-\\chi_0 + \\sqrt{\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 r}}{2\\alpha}\n$$\n$$\n\\kappa(r) = \\kappa_c - \\frac{\\chi_0}{2\\alpha} + \\frac{1}{2\\alpha}\\sqrt{\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 r}\n$$\n现在我们计算这个外部区域上的积分：\n$$\n\\int_{r_c}^{a} \\kappa(r) dr = \\int_{r_c}^{a} \\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) dr + \\frac{1}{2\\alpha} \\int_{r_c}^{a} \\sqrt{\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 r} \\, dr\n$$\n第一部分是：\n$$\n\\left[ \\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) r \\right]_{r_c}^a = \\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) (a-r_c)\n$$\n对于积分的第二部分，设 $u = \\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 r$，则 $du = 4\\alpha S_0 dr$。\n$$\n\\frac{1}{2\\alpha} \\int \\sqrt{u} \\frac{du}{4\\alpha S_0} = \\frac{1}{8\\alpha^2 S_0} \\int u^{1/2} du = \\frac{1}{8\\alpha^2 S_0} \\frac{2}{3} u^{3/2} = \\frac{1}{12\\alpha^2 S_0} u^{3/2}\n$$\n计算从 $r_c$ 到 $a$ 的定积分：\n$$\n\\frac{1}{12\\alpha^2 S_0} \\left[ (\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 r)^{3/2} \\right]_{r_c}^a\n$$\n在 $r=r_c=\\frac{\\chi_0 \\kappa_c}{S_0}$ 处的下限值为：\n$$\n\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 \\left(\\frac{\\chi_0 \\kappa_c}{S_0}\\right) = \\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha\\chi_0 \\kappa_c = \\chi_0^2\n$$\n所以积分的第二部分是：\n$$\n\\frac{1}{12\\alpha^2 S_0} \\left[ (\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - (\\chi_0^2)^{3/2} \\right] = \\frac{(\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - \\chi_0^3}{12\\alpha^2 S_0}\n$$\n合并所有部分得到 $T(0)$：\n$$\nT(0) = T_a + \\frac{\\chi_0 \\kappa_c^2}{2S_0} + \\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) (a-r_c) + \\frac{(\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - \\chi_0^3}{12\\alpha^2 S_0}\n$$\n代入 $r_c = \\frac{\\chi_0 \\kappa_c}{S_0}$：\n$$\nT(0) = T_a + \\frac{\\chi_0 \\kappa_c^2}{2S_0} + \\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) \\left(a-\\frac{\\chi_0 \\kappa_c}{S_0}\\right) + \\frac{(\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - \\chi_0^3}{12\\alpha^2 S_0}\n$$\n展开乘积项：\n$$\n\\left( \\kappa_c - \\frac{\\chi_0}{2\\alpha} \\right) \\left(a-\\frac{\\chi_0 \\kappa_c}{S_0}\\right) = a\\kappa_c - \\frac{\\chi_0 \\kappa_c^2}{S_0} - \\frac{a\\chi_0}{2\\alpha} + \\frac{\\chi_0^2 \\kappa_c}{2\\alpha S_0}\n$$\n将此结果与内部区域的结果相加：\n$$\n\\frac{\\chi_0 \\kappa_c^2}{2S_0} + a\\kappa_c - \\frac{\\chi_0 \\kappa_c^2}{S_0} - \\frac{a\\chi_0}{2\\alpha} + \\frac{\\chi_0^2 \\kappa_c}{2\\alpha S_0} = a\\kappa_c - \\frac{a\\chi_0}{2\\alpha} - \\frac{\\chi_0 \\kappa_c^2}{2S_0} + \\frac{\\chi_0^2 \\kappa_c}{2\\alpha S_0}\n$$\n将所有项相加，得到中心温度的最终表达式：\n$$\nT(0) = T_a + a\\kappa_c - \\frac{a\\chi_0}{2\\alpha} - \\frac{\\chi_0 \\kappa_c^2}{2S_0} + \\frac{\\chi_0^2 \\kappa_c}{2\\alpha S_0} + \\frac{(\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - \\chi_0^3}{12\\alpha^2 S_0}\n$$\n这是完整且精确的解析解。",
            "answer": "$$\n\\boxed{T_a + a\\kappa_c - \\frac{a\\chi_0}{2\\alpha} - \\frac{\\chi_0 \\kappa_c^2}{2S_0} + \\frac{\\chi_0^2 \\kappa_c}{2\\alpha S_0} + \\frac{(\\chi_0^2 - 4\\alpha\\chi_0 \\kappa_c + 4\\alpha S_0 a)^{3/2} - \\chi_0^3}{12\\alpha^2 S_0}}\n$$"
        },
        {
            "introduction": "在解析基础上，下一个练习  提供了一个计算视角，以培养您对剖面韧性的直觉。您将为一个刚性输运系统实现一个简单的数值代理模型，并观察其在不同加热功率下的行为。这个练习通过展示核心区温度梯度如何保持几乎恒定，而边缘温度升高以适应增加的功率，生动地演示了“梯度钉扎”这一剖面刚性的标志性概念。",
            "id": "3715628",
            "problem": "考虑一个用于磁约束聚变等离子体中热输运的一维板状代理模型，旨在模拟通量驱动条件下芯部温度梯度的剖面弹性和刚度。空间坐标为 $x \\in [0,L]$，其中 $x=0$ 表示磁轴，$x=L$ 表示等离子体边界。稳态热平衡由守恒定律 $dq/dx = s(x)$ 定义，其中 $q(x)$ 是向外热通量（单位为 $\\mathrm{MW}/\\mathrm{m}^2$），$s(x)$ 是体积加热源密度（单位为 $\\mathrm{MW}/\\mathrm{m}^3$）。芯部温度剖面 $T(x)$（单位为 $\\mathrm{keV}$）是单调的，满足 $-dT/dx \\ge 0$。边界通过线性排热边界条件 $q(L) = h \\left(T(L) - T_\\mathrm{wall}\\right)$ 与一个热汇耦合，其中 $h$ 是边界排热系数（单位为 $\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})$），$T_\\mathrm{wall}$ 是参考壁的边界温度（单位为 $\\mathrm{keV}$）。\n\n为模拟湍流引起的刚度，采用一个分段线性的“临界梯度”代理模型来表示局域通量-梯度关系，该模型代表一旦超过临界梯度，强湍流输运便会开始。定义局域梯度大小 $g(x) = -dT/dx \\ge 0$（单位为 $\\mathrm{keV}/\\mathrm{m}$）。通量-梯度关系为\n$$\nq\\big(g(x)\\big) = \n\\begin{cases}\n\\kappa_\\mathrm{low}\\,g(x),  g(x) \\le g_c,\\\\\n\\kappa_\\mathrm{low}\\,g_c + \\kappa_\\mathrm{high}\\,\\big(g(x) - g_c\\big),  g(x)  g_c,\n\\end{cases}\n$$\n其中 $\\kappa_\\mathrm{low}$ 和 $\\kappa_\\mathrm{high}$ 分别是低输运和高输运系数（单位为 $\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})$），$g_c$ 是临界梯度（单位为 $\\mathrm{keV}/\\mathrm{m}$）。该代理模型强制了弹性：一旦 $g(x)$ 达到 $g_c$，热通量的进一步增加主要由大的 $\\kappa_\\mathrm{high}$ 承载，而不是通过 $g(x)$ 的进一步增加，从而将芯部梯度“钉扎”在 $g_c$ 附近。\n\n假设在 $x \\in [0,L]$ 上有一个均匀源 $s(x) = s_0$，其中 $s_0$ 为常数（单位为 $\\mathrm{MW}/\\mathrm{m}^3$）。在 $dq/dx = s_0$ 和对称性条件 $q(0)=0$ 下，通量为 $q(x) = s_0\\,x$，边界通量为 $q(L) = s_0\\,L$。根据边界条件，边界温度为 $T(L) = T_\\mathrm{wall} + q(L)/h$。通过从边界向内积分 $g(x)$ 来恢复温度剖面：\n$$\nT(x) = T(L) + \\int_x^L g(\\xi)\\,d\\xi.\n$$\n您的任务是实现这个代理模型，通过计算代表性芯部位置 $x_\\mathrm{core}$ 处的梯度和由此产生的边界温度，来证明在一系列 $s_0$ 递增的情况下，增加输入功率仅会改变边界温度，而芯部梯度则保持钉扎在 $g_c$ 附近。\n\n使用以下固定参数，这些参数对于一个代理模型是科学上合理的，并且在单位上是自洽的：\n- 区域长度 $L = 0.5\\,\\mathrm{m}$。\n- 边界排热系数 $h = 40\\,\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})$。\n- 参考壁的边界温度 $T_\\mathrm{wall} = 0.1\\,\\mathrm{keV}$。\n- 低输运系数 $\\kappa_\\mathrm{low} = 0.5\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})$。\n- 高输运系数 $\\kappa_\\mathrm{high} = 50\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})$。\n- 临界梯度 $g_c = 5.0\\,\\mathrm{keV}/\\mathrm{m}$。\n- 芯部评估点 $x_\\mathrm{core} = 0.25\\,\\mathrm{m}$。\n\n实现一个程序，为每个测试案例计算：\n- 芯部梯度大小 $g(x_\\mathrm{core})$，单位为 $\\mathrm{keV}/\\mathrm{m}$，四舍五入到3位小数。\n- 边界温度 $T(L)$，单位为 $\\mathrm{keV}$，四舍五入到3位小数。\n\n设计程序以评估以下源强度 $s_0$ 的测试套件：\n- 案例1：$s_0 = 2.0\\,\\mathrm{MW}/\\mathrm{m}^3$（在芯部评估点附近低于阈值）。\n- 案例2：$s_0 = 10.0\\,\\mathrm{MW}/\\mathrm{m}^3$（在阈值附近并略高于阈值）。\n- 案例3：$s_0 = 50.0\\,\\mathrm{MW}/\\mathrm{m}^3$（远高于阈值）。\n\n对于每个案例，计算 $q(x) = s_0\\,x$，反演通量-梯度关系以获得 $g(x_\\mathrm{core})$，计算 $q(L) = s_0\\,L$，然后计算 $T(L) = T_\\mathrm{wall} + q(L)/h$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个案例对应一个子列表，格式为 $[g(x_\\mathrm{core}),T(L)]$，例如 $[[g_1,T_1],[g_2,T_2],[g_3,T_3]]$。",
            "solution": "用户提供了一个有效的问题陈述。该问题在科学上基于一个简化但标准的等离子体热输运模型，问题设定良好且具有唯一解，并客观地定义了所有必要的参数。我现在将提供一个完整的解决方案。\n\n该问题要求我们为一个一维等离子体板状模型计算芯部温度梯度大小 $g(x_\\mathrm{core})$ 和边界温度 $T(L)$。该模型具有“刚性”输运特性，即当热导率超过临界温度梯度 $g_c$ 时会急剧增加。我们将针对三种不同水平的均匀加热源强度 $s_0$ 来评估这些量。\n\n分析从所提供的控制方程和参数开始。\n模型的固定参数如下：\n- 区域长度：$L = 0.5\\,\\mathrm{m}$\n- 边界排热系数：$h = 40\\,\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})$\n- 参考壁的边界温度：$T_\\mathrm{wall} = 0.1\\,\\mathrm{keV}$\n- 低输运系数：$\\kappa_\\mathrm{low} = 0.5\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})$\n- 高输运系数：$\\kappa_\\mathrm{high} = 50\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})$\n- 临界梯度：$g_c = 5.0\\,\\mathrm{keV}/\\mathrm{m}$\n- 芯部评估点：$x_\\mathrm{core} = 0.25\\,\\mathrm{m}$\n\n热源是均匀的，$s(x)=s_0$。对热平衡方程 $dq/dx = s_0$ 进行积分，并应用对称性条件 $q(0)=0$，得到热通量剖面：\n$$q(x) = s_0 x$$\n\n$s_0$ 的每个测试案例所需的计算如下：\n1.  边界温度 $T(L)$。\n2.  芯部梯度大小 $g(x_\\mathrm{core}) = -dT/dx|_{x=x_\\mathrm{core}}$。\n\n首先，我们建立边界温度 $T(L)$ 的公式。它由排热边界条件确定：\n$$q(L) = h \\left(T(L) - T_\\mathrm{wall}\\right)$$\n边界处的通量为 $q(L) = s_0 L$。将此代入边界条件并解出 $T(L)$：\n$$s_0 L = h \\left(T(L) - T_\\mathrm{wall}\\right)$$\n$$T(L) = T_\\mathrm{wall} + \\frac{s_0 L}{h}$$\n此方程允许对任何给定的 $s_0$ 直接计算 $T(L)$。\n\n其次，我们确定芯部梯度大小 $g(x_\\mathrm{core})$。这需要使用分段的通量-梯度关系：\n$$\nq(g) = \n\\begin{cases}\n\\kappa_\\mathrm{low}\\,g,  g \\le g_c, \\\\\n\\kappa_\\mathrm{low}\\,g_c + \\kappa_\\mathrm{high}\\,(g - g_c),  g  g_c.\n\\end{cases}\n$$\n为了从局域热通量 $q(x_\\mathrm{core}) = s_0 x_\\mathrm{core}$ 中求出梯度 $g(x_\\mathrm{core})$，我们必须反演这个关系，将 $g$ 表示为 $q$ 的函数。\n\n我们来求出对应于临界梯度 $g_c$ 的临界热通量 $q_c$。这是低输运区和高输运区之间过渡点的通量值：\n$$q_c = \\kappa_\\mathrm{low}\\,g_c$$\n对于给定的参数，$q_c = (0.5\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})) \\times (5.0\\,\\mathrm{keV}/\\mathrm{m}) = 2.5\\,\\mathrm{MW}/\\mathrm{m}^2$。\n\n现在我们可以写出反函数 $g(q)$：\n- 如果 $q \\le q_c$，我们处于低输运区。我们反演 $q = \\kappa_\\mathrm{low}\\,g$：\n$$g(q) = \\frac{q}{\\kappa_\\mathrm{low}}$$\n- 如果 $q  q_c$，我们处于高输运（刚性）区。我们反演 $q = \\kappa_\\mathrm{low}\\,g_c + \\kappa_\\mathrm{high}\\,(g - g_c)$：\n$$q - \\kappa_\\mathrm{low}\\,g_c = \\kappa_\\mathrm{high}\\,(g - g_c)$$\n$$\\frac{q - \\kappa_\\mathrm{low}\\,g_c}{\\kappa_\\mathrm{high}} = g - g_c$$\n$$g(q) = g_c + \\frac{q - \\kappa_\\mathrm{low}\\,g_c}{\\kappa_\\mathrm{high}}$$\n注意到 $\\kappa_\\mathrm{low}\\,g_c = q_c$，这可以简化为：\n$$g(q) = g_c + \\frac{q - q_c}{\\kappa_\\mathrm{high}}$$\n所以，完整的反演关系是：\n$$\ng(q) = \n\\begin{cases}\nq/\\kappa_\\mathrm{low},  q \\le q_c, \\\\\ng_c + (q - q_c)/\\kappa_\\mathrm{high},  q  q_c.\n\\end{cases}\n$$\n我们将把这些公式应用于三个测试案例。\n\n**案例1：$s_0 = 2.0\\,\\mathrm{MW}/\\mathrm{m}^3$**\n1.  计算热通量：\n    - 在芯部：$q(x_\\mathrm{core}) = s_0 x_\\mathrm{core} = (2.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.25\\,\\mathrm{m}) = 0.5\\,\\mathrm{MW}/\\mathrm{m}^2$。\n    - 在边界：$q(L) = s_0 L = (2.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.5\\,\\mathrm{m}) = 1.0\\,\\mathrm{MW}/\\mathrm{m}^2$。\n2.  计算边界温度 $T(L)$：\n    - $T(L) = T_\\mathrm{wall} + \\frac{q(L)}{h} = 0.1\\,\\mathrm{keV} + \\frac{1.0\\,\\mathrm{MW}/\\mathrm{m}^2}{40\\,\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})} = 0.1 + 0.025 = 0.125\\,\\mathrm{keV}$。\n3.  计算芯部梯度 $g(x_\\mathrm{core})$：\n    - 芯部通量为 $q(x_\\mathrm{core}) = 0.5\\,\\mathrm{MW}/\\mathrm{m}^2$，小于 $q_c = 2.5\\,\\mathrm{MW}/\\mathrm{m}^2$。我们使用低输运公式。\n    - $g(x_\\mathrm{core}) = \\frac{q(x_\\mathrm{core})}{\\kappa_\\mathrm{low}} = \\frac{0.5\\,\\mathrm{MW}/\\mathrm{m}^2}{0.5\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})} = 1.0\\,\\mathrm{keV}/\\mathrm{m}$。\n4.  案例1结果：$[g(x_\\mathrm{core}), T(L)] = [1.000\\,\\mathrm{keV}/\\mathrm{m}, 0.125\\,\\mathrm{keV}]$。\n\n**案例2：$s_0 = 10.0\\,\\mathrm{MW}/\\mathrm{m}^3$**\n1.  计算热通量：\n    - 在芯部：$q(x_\\mathrm{core}) = s_0 x_\\mathrm{core} = (10.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.25\\,\\mathrm{m}) = 2.5\\,\\mathrm{MW}/\\mathrm{m}^2$。\n    - 在边界：$q(L) = s_0 L = (10.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.5\\,\\mathrm{m}) = 5.0\\,\\mathrm{MW}/\\mathrm{m}^2$。\n2.  计算边界温度 $T(L)$：\n    - $T(L) = T_\\mathrm{wall} + \\frac{q(L)}{h} = 0.1\\,\\mathrm{keV} + \\frac{5.0\\,\\mathrm{MW}/\\mathrm{m}^2}{40\\,\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})} = 0.1 + 0.125 = 0.225\\,\\mathrm{keV}$。\n3.  计算芯部梯度 $g(x_\\mathrm{core})$：\n    - 芯部通量为 $q(x_\\mathrm{core}) = 2.5\\,\\mathrm{MW}/\\mathrm{m}^2$，正好等于 $q_c$。我们处于阈值上。使用第一个公式：\n    - $g(x_\\mathrm{core}) = \\frac{q(x_\\mathrm{core})}{\\kappa_\\mathrm{low}} = \\frac{2.5\\,\\mathrm{MW}/\\mathrm{m}^2}{0.5\\,\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})} = 5.0\\,\\mathrm{keV}/\\mathrm{m}$，正好是 $g_c$。\n4.  案例2结果：$[g(x_\\mathrm{core}), T(L)] = [5.000\\,\\mathrm{keV}/\\mathrm{m}, 0.225\\,\\mathrm{keV}]$。\n\n**案例3：$s_0 = 50.0\\,\\mathrm{MW}/\\mathrm{m}^3$**\n1.  计算热通量：\n    - 在芯部：$q(x_\\mathrm{core}) = s_0 x_\\mathrm{core} = (50.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.25\\,\\mathrm{m}) = 12.5\\,\\mathrm{MW}/\\mathrm{m}^2$。\n    - 在边界：$q(L) = s_0 L = (50.0\\,\\mathrm{MW}/\\mathrm{m}^3) \\times (0.5\\,\\mathrm{m}) = 25.0\\,\\mathrm{MW}/\\mathrm{m}^2$。\n2.  计算边界温度 $T(L)$：\n    - $T(L) = T_\\mathrm{wall} + \\frac{q(L)}{h} = 0.1\\,\\mathrm{keV} + \\frac{25.0\\,\\mathrm{MW}/\\mathrm{m}^2}{40\\,\\mathrm{MW}/(\\mathrm{m}^2\\cdot\\mathrm{keV})} = 0.1 + 0.625 = 0.725\\,\\mathrm{keV}$。\n3.  计算芯部梯度 $g(x_\\mathrm{core})$：\n    - 芯部通量为 $q(x_\\mathrm{core}) = 12.5\\,\\mathrm{MW}/\\mathrm{m}^2$，大于 $q_c = 2.5\\,\\mathrm{MW}/\\mathrm{m}^2$。我们使用高输运公式。\n    - $g(x_\\mathrm{core}) = g_c + \\frac{q(x_\\mathrm{core}) - q_c}{\\kappa_\\mathrm{high}} = 5.0\\,\\mathrm{keV}/\\mathrm{m} + \\frac{12.5 - 2.5}{50} \\frac{\\mathrm{MW}/\\mathrm{m}^2}{\\mathrm{MW}/(\\mathrm{m}\\cdot\\mathrm{keV})} = 5.0 + \\frac{10.0}{50} = 5.0 + 0.2 = 5.2\\,\\mathrm{keV}/\\mathrm{m}$。\n4.  案例3结果：$[g(x_\\mathrm{core}), T(L)] = [5.200\\,\\mathrm{keV}/\\mathrm{m}, 0.725\\,\\mathrm{keV}]$。\n\n结果展示了剖面刚度现象。当加热功率 $s_0$ 从 $10.0$ 增加五倍到 $50.0\\,\\mathrm{MW}/\\mathrm{m}^3$ 时，芯部梯度 $g(x_\\mathrm{core})$ 仅少量增加，从 $5.000\\,\\mathrm{keV}/\\mathrm{m}$ 增加到 $5.200\\,\\mathrm{keV}/\\mathrm{m}$，保持“钉扎”在临界值 $g_c=5.0$ 附近。大部分增加的加热功率被边界温度 $T(L)$ 的大幅升高（从 $0.225\\,\\mathrm{keV}$ 到 $0.725\\,\\mathrm{keV}$）所容纳，而不是通过芯部温度剖面梯度的陡峭化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the core gradient and edge temperature for a stiff heat transport\n    model in a fusion plasma surrogate.\n    \"\"\"\n    # Fixed parameters\n    L = 0.5            # Domain length [m]\n    h = 40.0           # Edge exhaust coefficient [MW/(m^2*keV)]\n    T_wall = 0.1       # Wall-referenced edge temperature [keV]\n    kappa_low = 0.5    # Low transport coefficient [MW/(m*keV)]\n    kappa_high = 50.0  # High transport coefficient [MW/(m*keV)]\n    g_c = 5.0          # Critical gradient [keV/m]\n    x_core = 0.25      # Core evaluation point [m]\n\n    # Test cases for source strength\n    test_cases = [\n        2.0,   # s0 [MW/m^3] - Case 1\n        10.0,  # s0 [MW/m^3] - Case 2\n        50.0   # s0 [MW/m^3] - Case 3\n    ]\n\n    results = []\n\n    # Calculate the critical heat flux q_c\n    q_c = kappa_low * g_c\n\n    for s0 in test_cases:\n        # 1. Calculate heat flux at core and edge\n        q_at_core = s0 * x_core\n        q_at_L = s0 * L\n\n        # 2. Calculate edge temperature T(L)\n        T_L = T_wall + q_at_L / h\n\n        # 3. Calculate core gradient g(x_core)\n        if q_at_core = q_c:\n            # Low-transport regime\n            g_at_core = q_at_core / kappa_low\n        else:\n            # High-transport (stiff) regime\n            g_at_core = g_c + (q_at_core - q_c) / kappa_high\n\n        # 4. Round results to 3 decimal places\n        g_rounded = round(g_at_core, 3)\n        T_L_rounded = round(T_L, 3)\n        \n        results.append((g_rounded, T_L_rounded))\n\n    # 5. Format the output string as specified\n    sublist_strings = [f\"[{g:.3f},{T:.3f}]\" for g, T in results]\n    final_output = f\"[{','.join(sublist_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "我们最后的实践练习将理论模型与实验数据分析联系起来，这是现代聚变研究中的一项关键技能。在这个练习中 ，您将扮演一名实验分析师的角色，使用贝叶斯推断从合成的含噪声数据中估计刚性模型的参数。这项任务不仅介绍了用于模型拟合的强大统计技术，还迫使您面对参数可辨识性的关键问题——即判断一个实验是否有能力唯一地约束物理模型。",
            "id": "3715593",
            "problem": "考虑一个磁约束聚变等离子体中剖面韧性和刚性的简化一维输运表示，其中，稳态向外热通量通过一个基线扩散通道和一个当梯度超过临界阈值时的刚性增强项来响应局部归一化温度梯度。令实验索引为 $i$ 的标量可观测量为热通量 $ \\phi_i $，其模型为\n$$\n\\phi_i = D_0\\, g_i + K\\, \\max(0, g_i - g_c) + \\epsilon_i,\n$$\n其中 $ D_0 $ 是未知的基线扩散系数参数，$ K $ 是未知的刚性振幅参数，$ g_i $ 是实验 $ i $ 中施加的归一化温度梯度驱动（无量纲），$ g_c $ 是一个已知的临界梯度（无量纲），$ \\epsilon_i $ 是测量噪声。假设 $ \\epsilon_i $ 是独立同分布（IID）的零均值高斯噪声，其方差为 $ \\sigma^2 $，因此 $ \\epsilon_i \\sim \\mathcal{N}(0,\\sigma^2) $。\n\n在核聚变等离子体中，湍流表现出韧性，倾向于使剖面保持在临界稳定附近；增强项 $ K\\, \\max(0, g_i - g_c) $ 模拟了当梯度超过临界阈值 $ g_c $ 时增加热通量的输运刚性。这个程式化的模型与 Fick 定律的基线标度和临界梯度驱动的刚性增强相一致。\n\n给定一些合成数据集，其中 $ \\phi_i $ 是由已知的真实参数 $ (D_0^{\\star}, K^{\\star}) $、已知的 $ g_c $、指定的 $ g_i $ 和确定性的噪声实现生成的。将 $ \\phi_i $ 视为用于推斷的测量可观测量。对 $ D_0 $ 和 $ K $ 使用独立的伽马先验分布，并结合由噪声模型隐含的高斯似然，进行贝叶斯推断。具体来说，令\n- $ D_0 \\sim \\operatorname{Gamma}(k_D, \\theta_D) $，\n- $ K \\sim \\operatorname{Gamma}(k_K, \\theta_K) $，\n其中伽马分布的参数化为形状参数 $ k $ 和尺度参数 $ \\theta $。其概率密度函数 (PDF) 为 $ f(x; k, \\theta) = \\frac{1}{\\Gamma(k)\\,\\theta^k} x^{k-1} e^{-x/\\theta} $，对于 $ x0 $。\n\n从 Bayes 法则 $ p(D_0,K \\mid \\{\\phi_i\\}) \\propto p(\\{\\phi_i\\} \\mid D_0,K)\\, p(D_0)\\, p(K) $ 出发，在参数空间中使用均匀矩形网格来数值近似后验分布。根据后验分布，计算 $ D_0 $ 和 $ K $ 的边缘后验均值，以及每个参数的等尾 $ 0.95 $ 可信区间。然后，使用基于后验收缩和相关性的明确量化准则来评估可辨識性：\n- 从它们的伽马先验分布计算 $ D_0 $ 和 $ K $ 的先验 $ 0.95 $ 等尾区间宽度。\n- 从边缘后验分布计算后验 $ 0.95 $ 等尾区间宽度。\n- 定义收缩比 $ S_{D_0} = \\frac{w_{D_0,\\text{post}}}{w_{D_0,\\text{prior}}} $ 和 $ S_{K} = \\frac{w_{K,\\text{post}}}{w_{K,\\text{prior}}} $，其中 $ w $ 表示区间宽度。\n- 从归一化的联合后验分布计算 $ D_0 $ 和 $ K $ 之间的后验相关性为 $ \\rho = \\frac{\\operatorname{Cov}(D_0,K)}{\\sqrt{\\operatorname{Var}(D_0)\\operatorname{Var}(K)}} $。\n- 如果 $S_{D_0}  0.6$、$S_{K}  0.6$ 且 $|\\rho|  0.95$，则声明参数集是可辨識的。否则，声明其为不可辨識的。\n\n所有量都是无量纲的，因此不需要物理单位。不涉及角度。您的算法必须使用与矩形网格间距一致的数值积分在网格上实现后验分布的归一化，并且必须通过对另一个参数进行积分来计算边缘密度。可信区间必须是等尾的，总后验质量为 $ 0.95 $。\n\n使用以下合成案例测试套件。在每个案例中，$ \\phi_i $ 是根据给定的 $ \\eta_i $ 计算得出的，公式为 $ \\phi_i = D_0^{\\star} g_i + K^{\\star} \\max(0, g_i - g_c) + \\eta_i $，而后验分布则使用指定的高斯似然的 $ \\sigma $：\n- 案例 1（混合梯度，信息丰富）：\n  - $ g_c = 3.5 $，\n  - $ g_i $ 列表：$ [2.0, 3.0, 3.5, 3.8, 4.2, 4.8, 3.2, 5.0] $，\n  - 真实值 $ (D_0^{\\star}, K^{\\star}) = (1.5, 4.0) $，\n  - 噪声实现 $ \\eta_i $ 列表：$ [0.05, -0.02, 0.03, -0.04, 0.00, 0.01, -0.03, 0.02] $，\n  - 似然标准差 $ \\sigma = 0.05 $。\n- 案例 2（所有梯度均低于 $ g_c $，刚性未被激发）：\n  - $ g_c = 3.5 $，\n  - $ g_i $ 列表：$ [2.0, 2.5, 3.0, 3.2, 3.4] $，\n  - 真实值 $ (D_0^{\\star}, K^{\\star}) = (1.5, 4.0) $，\n  - 噪声实现 $ \\eta_i $ 列表：$ [0.04, -0.03, 0.05, -0.02, 0.01] $，\n  - 似然标准差 $ \\sigma = 0.05 $。\n- 案例 3（高噪声，刚性部分激发）：\n  - $ g_c = 3.5 $，\n  - $ g_i $ 列表：$ [4.0, 4.5, 5.0, 5.5, 6.0] $，\n  - 真实值 $ (D_0^{\\star}, K^{\\star}) = (1.5, 2.0) $，\n  - 噪声实现 $ \\eta_i $ 列表：$ [0.30, -0.25, 0.40, -0.35, 0.20] $，\n  - 似然标准差 $ \\sigma = 0.30 $。\n\n所有案例均使用相同的独立伽马先验分布：\n- $ D_0 $ 的先验分布：$ k_D = 3.0 $，$ \\theta_D = 0.8 $，\n- $ K $ 的先验分布：$ k_K = 3.0 $，$ \\theta_K = 1.5 $。\n\n所有案例均使用以下通用网格规格：\n- $ D_0 $ 网格范围从 $ 0.0 $到 $ 5.0 $（含两端），均匀步长为 $ 0.01 $，\n- $ K $ 网格范围从 $ 0.0 $ 到 $ 8.0 $（含两端），均匀步长为 $ 0.02 $。\n\n您的程序必须：\n- 对于每个案例，根据给定的 $ g_i $、$ g_c $、真实值 $ (D_0^{\\star}, K^{\\star}) $ 和 $ \\eta_i $ 生成 $ \\phi_i $。\n- 在矩形网格上计算归一化的联合后验分布。\n- 计算 $ D_0 $ 和 $ K $ 的边缘后验均值，以及每个参数的等尾 $ 0.95 $ 可信区间。\n- 计算 $ D_0 $ 和 $ K $ 的先验等尾 $ 0.95 $ 可信区间以及收缩比 $ S_{D_0} $ 和 $ S_{K} $。\n- 计算后验相关性 $ \\rho $。\n- 根据上述准则确定可辨识性布尔值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个含三个列表的列表，每个子列表对应一个案例，且每个子列表按以下顺序包含七个条目：$ D_0 $ 的后验均值、$ D_0 $ 的 $ 0.95 $ 可信区间的下界、$ D_0 $ 的 $ 0.95 $ 可信区间的上界、$ K $ 的后验均值、$ K $ 的 $ 0.95 $ 可信区间的下界、$ K $ 的 $ 0.95 $ 可信区间的上界，以及可辨识性布尔值。所有数值条目必须是十进制浮点数。例如，一个有效的输出形状是 $ [[d_1,\\ell_{d,1},u_{d,1},k_1,\\ell_{k,1},u_{k,1},b_1],[d_2,\\ell_{d,2},u_{d,2},k_2,\\ell_{k,2},u_{k,2},b_2],[d_3,\\ell_{d,3},u_{d,3},k_3,\\ell_{k,3},u_{k,3},b_3]] $。",
            "solution": "用户提供了一个关于聚变等离子体中热输运简化模型的定义明确的贝叶斯推断问题。该问题具有科学依据，数学上一致，并且所有必要的参数、数据和准则都已明确说明。因此，该问题被认为是有效的。\n\n解决方案通过对三个测试案例中的每一个实施指定的贝叶斯分析来进行。该方法的核心是在离散网格上计算参数 $D_0$（基线扩散系数）和 $K$（刚性振幅）的联合后验概率分布，然后从该后验分布中推导出各种统计量度。\n\n测量的热通量 $\\phi_i$ 的模型由下式给出：\n$$\n\\phi_i = D_0\\, g_i + K\\, \\max(0, g_i - g_c) + \\epsilon_i\n$$\n其中 $g_i$ 是温度梯度，$g_c$ 是临界梯度，$\\epsilon_i$ 是高斯噪声，$\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n根据贝叶斯定理，在给定数据 $\\{\\phi_i\\}$ 的条件下，参数 $(D_0, K)$ 的后验概率与似然和先验概率的乘积成正比：\n$$\np(D_0, K \\mid \\{\\phi_i\\}) \\propto p(\\{\\phi_i\\} \\mid D_0, K) \\, p(D_0, K)\n$$\n鉴于参数是先验独立的，有 $p(D_0, K) = p(D_0) p(K)$。\n\n1.  **先验分布**：\n    $D_0$ 和 $K$ 的先验分布被给定为伽马分布：\n    $$\n    D_0 \\sim \\operatorname{Gamma}(k_D, \\theta_D) \\quad \\text{with } k_D=3.0, \\theta_D=0.8\n    $$\n    $$\n    K \\sim \\operatorname{Gamma}(k_K, \\theta_K) \\quad \\text{with } k_K=3.0, \\theta_K=1.5\n    $$\n    形状参数为 $k$、尺度参数为 $\\theta$ 的伽马分布的概率密度函数 (PDF) 是 $f(x; k, \\theta) = \\frac{1}{\\Gamma(k)\\theta^k} x^{k-1} e^{-x/\\theta}$。由于网格包含 $D_0=0$ 和 $K=0$，我们注意到对于 $x \\le 0$，伽马 PDF 为零，这将正确地在这些边界上产生零的后验概率。\n\n2.  **似然函数**：\n    噪声 $\\epsilon_i$ 是来自 $\\mathcal{N}(0,\\sigma^2)$ 的独立同分布（IID）噪声。观测到整个数据集 $\\{\\phi_i\\}$ 的似然是每个单独观测概率的乘积：\n    $$\n    p(\\{\\phi_i\\} \\mid D_0, K) = \\prod_{i=1}^N \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left( -\\frac{(\\phi_i - \\mu_i(D_0, K))^2}{2\\sigma^2} \\right)\n    $$\n    其中 $\\mu_i(D_0, K) = D_0 g_i + K \\max(0, g_i - g_c)$。为保证数值稳定性，我们使用对数似然：\n    $$\n    \\ln p(\\{\\phi_i\\} \\mid D_0, K) = -\\frac{N}{2}\\ln(2\\pi\\sigma^2) - \\frac{1}{2\\sigma^2} \\sum_{i=1}^N (\\phi_i - \\mu_i(D_0, K))^2\n    $$\n\n3.  **后验的数值计算**：\n    我们按照规定将参数空间 $(D_0, K)$ 离散化为一个均匀矩形网格。\n    - $D_0 \\in [0.0, 5.0]$ 步长为 $\\Delta D_0 = 0.01$。\n    - $K \\in [0.0, 8.0]$ 步长为 $\\Delta K = 0.02$。\n    \n    在每个网格点 $(D_{0,j}, K_l)$ 上，我们计算未归一化的对数后验：\n    $$\n    \\ln P_{\\text{un}}(D_{0,j}, K_l) = \\ln p(\\{\\phi_i\\} \\mid D_{0,j}, K_l) + \\ln p(D_{0,j}) + \\ln p(K_l)\n    $$\n    然后，未归一化的后验是 $P_{\\text{un}}(D_{0,j}, K_l) = \\exp(\\ln P_{\\text{un}}(D_{0,j}, K_l))$。为避免数值下溢或上溢，我们使用 log-sum-exp技巧进行归一化。归一化常数（证据）通过网格上的黎曼和来近似：\n    $$\n    Z = \\iint P_{\\text{un}}(D_0, K) \\,dD_0 \\,dK \\approx \\sum_{j,l} P_{\\text{un}}(D_{0,j}, K_l) \\Delta D_0 \\Delta K\n    $$\n    网格上的归一化后验 PDF 为 $P_{\\text{norm}}(D_{0,j}, K_l) = P_{\\text{un}}(D_{0,j}, K_l) / Z$。\n\n4.  **后验统计**：\n    - **边缘分布**：通过对联合后验在另一参数的域上进行积分（求和）来计算边缘 PDF：\n      $$\n      p(D_{0,j} \\mid \\{\\phi_i\\}) = \\sum_l P_{\\text{norm}}(D_{0,j}, K_l) \\Delta K\n      $$\n      $$\n      p(K_l \\mid \\{\\phi_i\\}) = \\sum_j P_{\\text{norm}}(D_{0,j}, K_l) \\Delta D_0\n      $$\n    - **后验均值**：均值是从边缘分布计算出的期望值：\n      $$\n      E[D_0] = \\sum_j D_{0,j} \\, p(D_{0,j} \\mid \\{\\phi_i\\}) \\, \\Delta D_0\n      $$\n      $$\n      E[K] = \\sum_l K_l \\, p(K_l \\mid \\{\\phi_i\\}) \\, \\Delta K\n      $$\n    - **可信区间**：通过确定其边缘后验分布的 $0.025$ 和 $0.975$ 分位数来找到每个参数的等尾 $0.95$ 可信区间。这是通过首先从边缘 PDF 计算累积分布函数 (CDF)，然后使用线性插值找到对应于概率 $0.025$ 和 $0.975$ 的参数值来完成的。\n\n5.  **可辨识性分析**：\n    - **先验区间宽度**：使用理论伽马分布的反 CDF（百分点函数）计算伽马先验的 $0.95$ 等尾可信区间。\n    - **收缩比**：每个参数的收缩比是其后验可信区间宽度与先验可信区间宽度的比率：$S = w_{\\text{post}} / w_{\\text{prior}}$。\n    - **后验相关性**：相关系数 $\\rho$ 从归一化的联合后验计算得出：\n      $$\n      \\rho = \\frac{\\operatorname{Cov}(D_0, K)}{\\sqrt{\\operatorname{Var}(D_0)\\operatorname{Var}(K)}}\n      $$\n      其中方差和协方差是从后验分布中数值计算得出的，例如 $\\operatorname{Cov}(D_0,K) = E[D_0 K] - E[D_0]E[K]$。\n    - **准则**：如果 $S_{D_0}  0.6$，$S_{K}  0.6$ 且 $|\\rho|  0.95$，则参数集是‘可辨識的’。\n\n对于每个测试案例，我们首先使用提供的真实参数 $(D_0^{\\star}, K^{\\star})$ 和噪声实现 $\\eta_i$ 来生成合成数据 $\\phi_i$。然后，执行上述过程以计算所需的后验统计数据并确定可辨识性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import gamma\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Main function to run the Bayesian inference for all test cases.\n    \"\"\"\n    \n    # Define common priors and grid specifications for all cases.\n    priors = {\n        'D0': {'k': 3.0, 'theta': 0.8},\n        'K': {'k': 3.0, 'theta': 1.5}\n    }\n    \n    grid_spec = {\n        'D0': {'min': 0.0, 'max': 5.0, 'step': 0.01},\n        'K': {'min': 0.0, 'max': 8.0, 'step': 0.02}\n    }\n\n    # Define the test cases from the problem statement.\n    test_cases_data = [\n        # Case 1 (mixed gradients, informative)\n        {\n            \"g_c\": 3.5,\n            \"g_i\": [2.0, 3.0, 3.5, 3.8, 4.2, 4.8, 3.2, 5.0],\n            \"ground_truth\": (1.5, 4.0),\n            \"eta_i\": [0.05, -0.02, 0.03, -0.04, 0.00, 0.01, -0.03, 0.02],\n            \"sigma\": 0.05\n        },\n        # Case 2 (all gradients below gc, stiffness unexcited)\n        {\n            \"g_c\": 3.5,\n            \"g_i\": [2.0, 2.5, 3.0, 3.2, 3.4],\n            \"ground_truth\": (1.5, 4.0),\n            \"eta_i\": [0.04, -0.03, 0.05, -0.02, 0.01],\n            \"sigma\": 0.05\n        },\n        # Case 3 (high noise, stiffness partially excited)\n        {\n            \"g_c\": 3.5,\n            \"g_i\": [4.0, 4.5, 5.0, 5.5, 6.0],\n            \"ground_truth\": (1.5, 2.0),\n            \"eta_i\": [0.30, -0.25, 0.40, -0.35, 0.20],\n            \"sigma\": 0.30\n        }\n    ]\n\n    all_results = []\n    for case_data in test_cases_data:\n        result = process_case(case_data, priors, grid_spec)\n        all_results.append(result)\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([\n        \"[\" + \",\".join(map(str, res)) + \"]\" for res in all_results\n    ]) + \"]\"\n    \n    print(output_str)\n\n\ndef process_case(case_data, priors, grid_spec):\n    \"\"\"\n    Performs the full Bayesian analysis for a single case.\n    \"\"\"\n    g_c = case_data[\"g_c\"]\n    g_i = np.array(case_data[\"g_i\"])\n    D0_star, K_star = case_data[\"ground_truth\"]\n    eta_i = np.array(case_data[\"eta_i\"])\n    sigma_like = case_data[\"sigma\"]\n    \n    # 1. Generate observable data phi_i\n    phi_i = D0_star * g_i + K_star * np.maximum(0, g_i - g_c) + eta_i\n    \n    # 2. Setup grid\n    num_D0 = int(round((grid_spec['D0']['max'] - grid_spec['D0']['min']) / grid_spec['D0']['step'])) + 1\n    num_K = int(round((grid_spec['K']['max'] - grid_spec['K']['min']) / grid_spec['K']['step'])) + 1\n    D0_grid = np.linspace(grid_spec['D0']['min'], grid_spec['D0']['max'], num_D0)\n    K_grid = np.linspace(grid_spec['K']['min'], grid_spec['K']['max'], num_K)\n    dD0 = D0_grid[1] - D0_grid[0]\n    dK = K_grid[1] - K_grid[0]\n    \n    # 3. Calculate posterior on the grid\n    D0_mesh, K_mesh = np.meshgrid(D0_grid, K_grid, indexing='ij')\n    \n    # Log-prior. scipy.stats.gamma.logpdf handles x=0 correctly (returns -inf)\n    log_prior_D0 = gamma.logpdf(D0_mesh, a=priors['D0']['k'], scale=priors['D0']['theta'])\n    log_prior_K = gamma.logpdf(K_mesh, a=priors['K']['k'], scale=priors['K']['theta'])\n    log_prior = log_prior_D0 + log_prior_K\n    \n    # Log-likelihood using broadcasting\n    model_phi = (D0_mesh[..., np.newaxis] * g_i +\n                 K_mesh[..., np.newaxis] * np.maximum(0, g_i - g_c))\n    residuals = phi_i - model_phi\n    sum_sq_residuals = np.sum(residuals**2, axis=2)\n    log_likelihood = -0.5 * sum_sq_residuals / (sigma_like**2)\n    \n    # Unnormalized log posterior\n    log_posterior_un = log_prior + log_likelihood\n    \n    # 4. Normalize posterior\n    log_norm_const = logsumexp(log_posterior_un) + np.log(dD0 * dK)\n    log_posterior_norm = log_posterior_un - log_norm_const\n    posterior_norm = np.exp(log_posterior_norm)\n    \n    # 5. Calculate Marginals\n    marginal_D0_pdf = np.sum(posterior_norm, axis=1) * dK\n    marginal_K_pdf = np.sum(posterior_norm, axis=0) * dD0\n    \n    # 6. Calculate Posterior Means\n    mean_D0 = np.sum(D0_grid * marginal_D0_pdf) * dD0\n    mean_K = np.sum(K_grid * marginal_K_pdf) * dK\n    \n    # 7. Calculate Posterior Credible Intervals\n    cdf_D0 = np.cumsum(marginal_D0_pdf * dD0)\n    cdf_D0[-1] = 1.0  # Ensure CDF ends at 1 to handle potential float precision issues\n    lower_D0 = np.interp(0.025, cdf_D0, D0_grid)\n    upper_D0 = np.interp(0.975, cdf_D0, D0_grid)\n    \n    cdf_K = np.cumsum(marginal_K_pdf * dK)\n    cdf_K[-1] = 1.0\n    lower_K = np.interp(0.025, cdf_K, K_grid)\n    upper_K = np.interp(0.975, cdf_K, K_grid)\n    \n    # 8. Calculate Prior Credible Intervals and Shrinkage\n    prior_lower_D0 = gamma.ppf(0.025, a=priors['D0']['k'], scale=priors['D0']['theta'])\n    prior_upper_D0 = gamma.ppf(0.975, a=priors['D0']['k'], scale=priors['D0']['theta'])\n    prior_width_D0 = prior_upper_D0 - prior_lower_D0\n    post_width_D0 = upper_D0 - lower_D0\n    S_D0 = post_width_D0 / prior_width_D0 if prior_width_D0  0 else np.inf\n    \n    prior_lower_K = gamma.ppf(0.025, a=priors['K']['k'], scale=priors['K']['theta'])\n    prior_upper_K = gamma.ppf(0.975, a=priors['K']['k'], scale=priors['K']['theta'])\n    prior_width_K = prior_upper_K - prior_lower_K\n    post_width_K = upper_K - lower_K\n    S_K = post_width_K / prior_width_K if prior_width_K  0 else np.inf\n    \n    # 9. Calculate Posterior Correlation\n    mean_D0_sq = np.sum(D0_grid**2 * marginal_D0_pdf) * dD0\n    var_D0 = mean_D0_sq - mean_D0**2\n    mean_K_sq = np.sum(K_grid**2 * marginal_K_pdf) * dK\n    var_K = mean_K_sq - mean_K**2\n    \n    mean_D0K = np.sum(D0_mesh * K_mesh * posterior_norm) * dD0 * dK\n    cov_D0K = mean_D0K - mean_D0 * mean_K\n    \n    # Add epsilon to prevent division by zero for perfectly determined parameters (var=0)\n    rho = cov_D0K / (np.sqrt(var_D0 * var_K) + 1e-15)\n    \n    # 10. Determine Identifiability\n    identifiable = (S_D0  0.6) and (S_K  0.6) and (abs(rho)  0.95)\n    \n    return [\n        mean_D0, lower_D0, upper_D0,\n        mean_K, lower_K, upper_K,\n        identifiable\n    ]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}