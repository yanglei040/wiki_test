{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we first establish the fundamental link between a zonal potential and the generation of sheared flows. This exercise simplifies the complex geometry of a tokamak to a local cylindrical model, allowing you to focus on the core mechanism: how a radially varying, axisymmetric potential, $\\phi(r)$, gives rise to a radial electric field and a corresponding poloidally sheared $\\boldsymbol{E} \\times \\boldsymbol{B}$ flow . Mastering this basic calculation is the first step toward understanding how zonal flows can regulate plasma turbulence.",
            "id": "3725774",
            "problem": "Consider a large-aspect-ratio tokamak with concentric circular flux surfaces, where the magnetic field is dominated by the toroidal component so that $B \\approx B_{\\phi}$ and the local geometry may be treated as cylindrical with orthonormal basis $\\{\\hat{\\boldsymbol{e}}_{r}, \\hat{\\boldsymbol{e}}_{\\theta}, \\hat{\\boldsymbol{e}}_{\\phi}\\}$ forming a right-handed triad satisfying $\\hat{\\boldsymbol{e}}_{r} \\times \\hat{\\boldsymbol{e}}_{\\phi} = \\hat{\\boldsymbol{e}}_{\\theta}$. A zonal flow is generated by an axisymmetric electrostatic potential that depends only on the minor radius, given by $\\phi(r) = \\phi_{0} \\cos(k_{r} r)$, where $r$ is the minor radius, $\\phi_{0}$ is a constant amplitude, and $k_{r}$ is a real radial wavenumber. Starting from the fundamental definitions of the electrostatic field and the drift velocity of a magnetized charged fluid, and using only the large-aspect-ratio ordering $B \\approx B_{\\phi}$ with $B_{\\phi}$ radially uniform to leading order, derive the corresponding radial electric field $E_{r}(r)$ and the shear of the poloidal $\\boldsymbol{E} \\times \\boldsymbol{B}$ flow, $\\partial_{r} v_{E\\theta}(r)$, associated with this zonal potential. Treat all trigonometric functions in radian measure. Express $E_{r}$ in SI units of volts per meter and $\\partial_{r} v_{E\\theta}$ in SI units of inverse seconds. Provide your final result as a single closed-form analytic expression containing both quantities arranged as a two-entry row vector $\\big(E_{r}(r), \\partial_{r} v_{E\\theta}(r)\\big)$ in terms of $\\phi_{0}$, $k_{r}$, and $B_{\\phi}$. No numerical evaluation is required.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n**Problem Validation**\n\n**Step 1: Extracted Givens**\n- **System:** Large-aspect-ratio tokamak, concentric circular flux surfaces.\n- **Magnetic Field:** $B \\approx B_{\\phi}$.\n- **Geometry:** Local cylindrical with orthonormal basis $\\{\\hat{\\boldsymbol{e}}_{r}, \\hat{\\boldsymbol{e}}_{\\theta}, \\hat{\\boldsymbol{e}}_{\\phi}\\}$.\n- **Coordinate System Rule:** Right-handed triad with $\\hat{\\boldsymbol{e}}_{r} \\times \\hat{\\boldsymbol{e}}_{\\phi} = \\hat{\\boldsymbol{e}}_{\\theta}$.\n- **Electrostatic Potential:** $\\phi(r) = \\phi_{0} \\cos(k_{r} r)$, where $r$ is the minor radius.\n- **Parameters:** $\\phi_{0}$ is a constant amplitude, $k_{r}$ is a real radial wavenumber.\n- **Magnetic Field Uniformity:** $B_{\\phi}$ is radially uniform to leading order.\n- **Quantities to Derive:** Radial electric field $E_{r}(r)$ and the shear of the poloidal $\\boldsymbol{E} \\times \\boldsymbol{B}$ flow, $\\partial_{r} v_{E\\theta}(r)$.\n- **Final Result Format:** A two-entry row vector $\\left( E_{r}(r), \\partial_{r} v_{E\\theta}(r) \\right)$ in terms of $\\phi_{0}$, $k_{r}$, and $B_{\\phi}$.\n\n**Step 2: Validation Using Extracted Givens**\nThe problem is scientifically grounded, drawing upon fundamental principles of plasma physics including the definitions of the electrostatic field ($\\boldsymbol{E} = -\\nabla\\phi$) and the $\\boldsymbol{E} \\times \\boldsymbol{B}$ drift velocity. The approximations used, such as the large-aspect-ratio limit and a simplified cylindrical geometry, are standard and appropriate for an analytical treatment of zonal flows in tokamaks. The problem is well-posed, providing all necessary information, including an explicit (though not standard) definition of the coordinate system's handedness, which is self-consistent and mathematically valid. There are no contradictions, ambiguities, or subjective elements. The problem is a formalizable physics derivation.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe derivation proceeds in three steps: first, the calculation of the radial electric field from the given potential; second, the calculation of the poloidal $\\boldsymbol{E} \\times \\boldsymbol{B}$ drift velocity; and third, the calculation of the radial shear of this velocity.\n\n**1. Radial Electric Field, $E_{r}(r)$**\n\nThe electrostatic field $\\boldsymbol{E}$ is defined as the negative gradient of the electrostatic potential $\\phi$:\n$$\n\\boldsymbol{E} = -\\nabla \\phi\n$$\nGiven the cylindrical geometry and that the potential $\\phi(r)$ depends only on the minor radius $r$, the gradient operator simplifies to $\\nabla = \\hat{\\boldsymbol{e}}_{r} \\frac{\\partial}{\\partial r}$. The electric field is therefore purely radial:\n$$\n\\boldsymbol{E} = -\\hat{\\boldsymbol{e}}_{r} \\frac{\\partial}{\\partial r} \\phi(r)\n$$\nThe potential is given as $\\phi(r) = \\phi_{0} \\cos(k_{r} r)$. Taking the derivative with respect to $r$:\n$$\n\\frac{\\partial \\phi}{\\partial r} = \\frac{\\partial}{\\partial r} \\left( \\phi_{0} \\cos(k_{r} r) \\right) = \\phi_{0} (-\\sin(k_{r} r)) \\cdot k_{r} = -k_{r} \\phi_{0} \\sin(k_{r} r)\n$$\nSubstituting this result back into the expression for $\\boldsymbol{E}$:\n$$\n\\boldsymbol{E}(r) = - \\hat{\\boldsymbol{e}}_{r} \\left( -k_{r} \\phi_{0} \\sin(k_{r} r) \\right) = k_{r} \\phi_{0} \\sin(k_{r} r) \\hat{\\boldsymbol{e}}_{r}\n$$\nThe radial component of the electric field, $E_{r}(r)$, is therefore:\n$$\nE_{r}(r) = k_{r} \\phi_{0} \\sin(k_{r} r)\n$$\n\n**2. Poloidal $\\boldsymbol{E} \\times \\boldsymbol{B}$ Flow Velocity, $v_{E\\theta}(r)$**\n\nThe $\\boldsymbol{E} \\times \\boldsymbol{B}$ drift velocity, $\\boldsymbol{v}_{E}$, is defined as:\n$$\n\\boldsymbol{v}_{E} = \\frac{\\boldsymbol{E} \\times \\boldsymbol{B}}{B^{2}}\n$$\nThe problem specifies using the approximations $\\boldsymbol{B} \\approx B_{\\phi} \\hat{\\boldsymbol{e}}_{\\phi}$ and thereby $B^{2} \\approx B_{\\phi}^{2}$. Substituting the expressions for $\\boldsymbol{E}$ and $\\boldsymbol{B}$:\n$$\n\\boldsymbol{v}_{E}(r) \\approx \\frac{\\left( E_{r}(r) \\hat{\\boldsymbol{e}}_{r} \\right) \\times \\left( B_{\\phi} \\hat{\\boldsymbol{e}}_{\\phi} \\right)}{B_{\\phi}^{2}} = \\frac{E_{r}(r)}{B_{\\phi}} \\left( \\hat{\\boldsymbol{e}}_{r} \\times \\hat{\\boldsymbol{e}}_{\\phi} \\right)\n$$\nWe now use the explicitly stated coordinate system rule: $\\hat{\\boldsymbol{e}}_{r} \\times \\hat{\\boldsymbol{e}}_{\\phi} = \\hat{\\boldsymbol{e}}_{\\theta}$. This yields a purely poloidal flow:\n$$\n\\boldsymbol{v}_{E}(r) \\approx \\frac{E_{r}(r)}{B_{\\phi}} \\hat{\\boldsymbol{e}}_{\\theta}\n$$\nThe poloidal component of this velocity, $v_{E\\theta}(r)$, is:\n$$\nv_{E\\theta}(r) = \\frac{E_{r}(r)}{B_{\\phi}} = \\frac{k_{r} \\phi_{0} \\sin(k_{r} r)}{B_{\\phi}}\n$$\n\n**3. Poloidal Flow Shear, $\\partial_{r} v_{E\\theta}(r)$**\n\nThe shear of the poloidal flow is its radial derivative, $\\partial_{r} v_{E\\theta}(r)$. We differentiate the expression for $v_{E\\theta}(r)$ with respect to $r$. The parameters $\\phi_{0}$, $k_{r}$, and $B_{\\phi}$ are treated as constants for this differentiation, consistent with the problem statement that $B_{\\phi}$ is radially uniform to leading order.\n$$\n\\partial_{r} v_{E\\theta}(r) = \\frac{\\partial}{\\partial r} \\left( \\frac{k_{r} \\phi_{0} \\sin(k_{r} r)}{B_{\\phi}} \\right) = \\frac{k_{r} \\phi_{0}}{B_{\\phi}} \\frac{\\partial}{\\partial r} \\left( \\sin(k_{r} r) \\right)\n$$\nThe derivative of the sine function is:\n$$\n\\frac{\\partial}{\\partial r} \\left( \\sin(k_{r} r) \\right) = \\cos(k_{r} r) \\cdot k_{r} = k_{r} \\cos(k_{r} r)\n$$\nSubstituting this back, we find the flow shear:\n$$\n\\partial_{r} v_{E\\theta}(r) = \\frac{k_{r} \\phi_{0}}{B_{\\phi}} \\left( k_{r} \\cos(k_{r} r) \\right) = \\frac{k_{r}^{2} \\phi_{0} \\cos(k_{r} r)}{B_{\\phi}}\n$$\n\n**Final Result Assembly**\n\nThe two derived quantities are:\n$$\nE_{r}(r) = k_{r} \\phi_{0} \\sin(k_{r} r)\n$$\n$$\n\\partial_{r} v_{E\\theta}(r) = \\frac{k_{r}^{2} \\phi_{0} \\cos(k_{r} r)}{B_{\\phi}}\n$$\nThese are arranged into the requested two-entry row vector $\\left( E_{r}(r), \\partial_{r} v_{E\\theta}(r) \\right)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nk_{r} \\phi_{0} \\sin(k_{r} r)  \\frac{k_{r}^{2} \\phi_{0} \\cos(k_{r} r)}{B_{\\phi}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having established the basic principle in a simplified geometry, we now tackle the more realistic case of a toroidal plasma. The curvature and variation of the magnetic field in a tokamak introduce significant new effects that are absent in the cylindrical model. This practice challenges you to derive the poloidally varying $\\boldsymbol{E} \\times \\boldsymbol{B}$ flow that arises from a purely radial electric field and to calculate its flux-surface average, revealing a non-zero residual poloidal flow that depends on geometry . This calculation lies at the heart of understanding the 'geodesic' nature of the coupling that drives Geodesic Acoustic Modes (GAMs).",
            "id": "3725814",
            "problem": "Consider an axisymmetric, large-aspect-ratio tokamak of major radius $R_{0}$ and minor radius $r \\ll R_{0}$, with circular flux surfaces parameterized by the poloidal angle $\\theta$ so that the local major radius obeys $R(\\theta) = R_{0} + r \\cos\\theta$. Let the magnetic field be written as $\\mathbf{B} = B_{\\phi}(R)\\,\\mathbf{e}_{\\phi} + B_{\\theta}(r, \\theta)\\,\\mathbf{e}_{\\theta}$, where the toroidal component is $B_{\\phi}(R) = B_{0} R_{0}/R$ and the poloidal component is constrained by the safety factor $q$ through $q = r B_{\\phi}/(R B_{\\theta})$, implying $B_{\\theta}(r, \\theta) = r B_{\\phi}(R)/(q R)$. Assume $B_{\\phi} \\gg B_{\\theta}$ but retain the leading correction of $B_{\\theta}$ in the magnetic field magnitude.\n\nThe zonal potential is taken to depend only on the minor radius, $\\phi(r)$, generating a purely radial electric field $\\mathbf{E}(r) = -\\nabla \\phi(r) = -\\phi^{\\prime}(r)\\,\\mathbf{e}_{r}$. Starting from the electric-field cross magnetic-field drift, $\\mathbf{v}_{E} = \\frac{c}{B^{2}}\\,\\mathbf{E}\\times \\mathbf{B}$, where $c$ is the speed of light, derive from first principles the poloidal component of the $\\mathbf{E}\\times\\mathbf{B}$ drift, $v_{E\\theta}(r,\\theta)$, and then compute the flux-surface average $\\langle v_{E\\theta}(r)\\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} v_{E\\theta}(r,\\theta)\\,d\\theta$ to second order in the small parameter $\\varepsilon = r/R_{0}$, keeping terms up to $\\mathcal{O}(\\varepsilon^{2})$.\n\nLet the zonal potential be specified as $\\phi(r) = \\phi_{0}\\,\\exp\\!\\left(-\\frac{r^{2}}{\\sigma^{2}}\\right)$, where $\\phi_{0}$ and $\\sigma$ are positive constants, and assume the safety factor $q$ is constant on the flux surface. The context is zonal flows and their coupling to the Geodesic Acoustic Mode (GAM), where the poloidal $\\mathbf{E}\\times\\mathbf{B}$ flow generated by $\\phi(r)$ plays a central role.\n\nExpress your final result as a single closed-form analytic expression for the flux-surface averaged poloidal flow profile $\\langle v_{E\\theta}(r)\\rangle$ as a function of $r$, $q$, $R_{0}$, $B_{0}$, $c$, $\\phi_{0}$, and $\\sigma$, valid to $\\mathcal{O}((r/R_{0})^{2})$. Use centimeters per second for velocity. No numerical substitution is required. Do not provide intermediate results; present only the final expression. No rounding is needed, and no units should appear inside your final boxed expression.",
            "solution": "The user has asked for a step-by-step derivation of the flux-surface averaged poloidal $\\mathbf{E}\\times\\mathbf{B}$ drift in a large-aspect-ratio tokamak, valid to second order in the inverse aspect ratio $\\varepsilon = r/R_0$.\n\n### Step 1: Problem Validation\n\n**1.1. Extracted Givens:**\n-   **Geometry:** Axisymmetric, large-aspect-ratio tokamak. Major radius $R_{0}$, minor radius $r \\ll R_{0}$.\n-   **Coordinates:** Circular flux surfaces parameterized by poloidal angle $\\theta$. Local major radius $R(\\theta) = R_{0} + r \\cos\\theta$.\n-   **Magnetic Field:** $\\mathbf{B} = B_{\\phi}(R)\\,\\mathbf{e}_{\\phi} + B_{\\theta}(r, \\theta)\\,\\mathbf{e}_{\\theta}$.\n-   **Toroidal Field Component:** $B_{\\phi}(R) = B_{0} R_{0}/R$.\n-   **Poloidal Field Component:** $B_{\\theta}(r, \\theta) = r B_{\\phi}(R)/(q R)$, where $q$ is the safety factor, assumed constant on a flux surface.\n-   **Field Ordering:** $B_{\\phi} \\gg B_{\\theta}$.\n-   **Electric Field:** $\\mathbf{E}(r) = -\\nabla \\phi(r) = -\\phi^{\\prime}(r)\\,\\mathbf{e}_{r}$, derived from a purely radial potential $\\phi(r)$.\n-   **E-cross-B Drift:** $\\mathbf{v}_{E} = \\frac{c}{B^{2}}\\,\\mathbf{E}\\times \\mathbf{B}$, where $c$ is the speed of light.\n-   **Task:** Derive the poloidal component $v_{E\\theta}(r,\\theta)$ and compute its flux-surface average $\\langle v_{E\\theta}(r)\\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} v_{E\\theta}(r,\\theta)\\,d\\theta$.\n-   **Approximation:** The result must be accurate to second order in the small parameter $\\varepsilon = r/R_{0}$, i.e., including terms up to $\\mathcal{O}(\\varepsilon^{2})$.\n-   **Potential Profile:** $\\phi(r) = \\phi_{0}\\,\\exp\\!\\left(-\\frac{r^{2}}{\\sigma^{2}}\\right)$, with $\\phi_{0}, \\sigma$ being positive constants.\n\n**1.2. Validation:**\n-   **Scientifically Grounded:** The problem is a standard exercise in plasma physics, specifically in the study of transport and magnetohydrodynamic modes in tokamaks. The geometry, field definitions, and drift velocity formula are fundamental to the field.\n-   **Well-Posed:** The problem provides all necessary definitions and parameters. The request for a derivation to a specific order in a small parameter is a well-defined mathematical task leading to a unique solution.\n-   **Objective:** The problem is stated in precise, mathematical language, free from subjective or ambiguous terms.\n\n**1.3. Verdict:**\nThe problem is valid. It is a well-defined physics problem based on established principles. I will proceed with the solution.\n\n### Step 2: Derivation of the Flux-Surface Averaged Poloidal Drift\n\nThe goal is to compute $\\langle v_{E\\theta}(r) \\rangle$. We begin by calculating the $\\mathbf{E}\\times\\mathbf{B}$ drift vector. The electric and magnetic fields are given by:\n$$ \\mathbf{E} = -\\phi^{\\prime}(r)\\,\\mathbf{e}_{r} $$\n$$ \\mathbf{B} = B_{\\theta}(r, \\theta)\\,\\mathbf{e}_{\\theta} + B_{\\phi}(R)\\,\\mathbf{e}_{\\phi} $$\nThe cross product $\\mathbf{E}\\times\\mathbf{B}$ is:\n$$ \\mathbf{E}\\times\\mathbf{B} = \\left(-\\phi^{\\prime}(r)\\,\\mathbf{e}_{r}\\right) \\times \\left(B_{\\theta}\\,\\mathbf{e}_{\\theta} + B_{\\phi}\\,\\mathbf{e}_{\\phi}\\right) $$\nUsing the cross product rules for a right-handed toroidal coordinate system $(r, \\theta, \\phi)$, where $\\mathbf{e}_r \\times \\mathbf{e}_\\theta = \\mathbf{e}_\\phi$ and $\\mathbf{e}_r \\times \\mathbf{e}_\\phi = -\\mathbf{e}_\\theta$, we get:\n$$ \\mathbf{E}\\times\\mathbf{B} = -\\phi^{\\prime}(r) \\left( B_{\\theta} (\\mathbf{e}_{r}\\times\\mathbf{e}_{\\theta}) + B_{\\phi} (\\mathbf{e}_{r}\\times\\mathbf{e}_{\\phi}) \\right) = -\\phi^{\\prime}(r) \\left( B_{\\theta}\\,\\mathbf{e}_{\\phi} - B_{\\phi}\\,\\mathbf{e}_{\\theta} \\right) = \\phi^{\\prime}(r) B_{\\phi}\\,\\mathbf{e}_{\\theta} - \\phi^{\\prime}(r) B_{\\theta}\\,\\mathbf{e}_{\\phi} $$\nThe poloidal component of the $\\mathbf{E}\\times\\mathbf{B}$ drift velocity, $v_{E\\theta}$, is the component parallel to $\\mathbf{e}_{\\theta}$:\n$$ v_{E\\theta}(r, \\theta) = \\frac{c}{B^{2}} \\left( \\phi^{\\prime}(r) B_{\\phi}(R) \\right) $$\nTo evaluate this expression to $\\mathcal{O}(\\varepsilon^2)$, we must expand $B_{\\phi}$ and $B^2$ in powers of $\\varepsilon = r/R_0$.\n\nFirst, we expand the magnetic field components. The local major radius is $R = R_0 + r\\cos\\theta = R_0(1+\\varepsilon\\cos\\theta)$.\nThe toroidal field component is:\n$$ B_{\\phi} = \\frac{B_0 R_0}{R} = \\frac{B_0 R_0}{R_0(1+\\varepsilon\\cos\\theta)} = B_0 (1+\\varepsilon\\cos\\theta)^{-1} $$\nExpanding to second order in $\\varepsilon$:\n$$ B_{\\phi} \\approx B_0 \\left(1 - \\varepsilon\\cos\\theta + \\varepsilon^2\\cos^2\\theta\\right) $$\nThe magnitude squared of the magnetic field is $B^2 = B_\\phi^2 + B_\\theta^2$.\n$$ B_\\theta = \\frac{r B_\\phi}{q R} = \\frac{r}{q R_0(1+\\varepsilon\\cos\\theta)} \\left( \\frac{B_0 R_0}{R_0(1+\\varepsilon\\cos\\theta)} \\right) = \\frac{\\varepsilon B_0}{q(1+\\varepsilon\\cos\\theta)^2} $$\nSo, $B^2$ is:\n$$ B^2 = \\left( \\frac{B_0}{1+\\varepsilon\\cos\\theta} \\right)^2 + \\left( \\frac{\\varepsilon B_0}{q(1+\\varepsilon\\cos\\theta)^2} \\right)^2 = B_0^2 \\left( (1+\\varepsilon\\cos\\theta)^{-2} + \\frac{\\varepsilon^2}{q^2}(1+\\varepsilon\\cos\\theta)^{-4} \\right) $$\nWe expand each term to the required precision. Keeping terms up to $\\mathcal{O}(\\varepsilon^2)$:\n$$ (1+\\varepsilon\\cos\\theta)^{-2} \\approx 1 - 2\\varepsilon\\cos\\theta + 3\\varepsilon^2\\cos^2\\theta $$\n$$ (1+\\varepsilon\\cos\\theta)^{-4} \\approx 1 - 4\\varepsilon\\cos\\theta + \\dots \\approx 1 \\quad (\\text{since it is multiplied by } \\varepsilon^2) $$\nSubstituting these expansions into the expression for $B^2$:\n$$ B^2 \\approx B_0^2 \\left( (1 - 2\\varepsilon\\cos\\theta + 3\\varepsilon^2\\cos^2\\theta) + \\frac{\\varepsilon^2}{q^2} \\right) = B_0^2 \\left(1 - 2\\varepsilon\\cos\\theta + \\left(3\\cos^2\\theta + \\frac{1}{q^2}\\right)\\varepsilon^2\\right) $$\nNow we form the ratio $B_\\phi/B^2$:\n$$ \\frac{B_\\phi}{B^2} \\approx \\frac{B_0(1-\\varepsilon\\cos\\theta+\\varepsilon^2\\cos^2\\theta)}{B_0^2\\left(1 - 2\\varepsilon\\cos\\theta + \\left(3\\cos^2\\theta + \\frac{1}{q^2}\\right)\\varepsilon^2\\right)} = \\frac{1}{B_0} \\frac{1-\\varepsilon\\cos\\theta+\\varepsilon^2\\cos^2\\theta}{1 - \\left[2\\varepsilon\\cos\\theta - \\left(3\\cos^2\\theta + \\frac{1}{q^2}\\right)\\varepsilon^2\\right]} $$\nUsing the geometric series expansion $(1-x)^{-1} \\approx 1+x+x^2$ with $x = 2\\varepsilon\\cos\\theta - \\left(3\\cos^2\\theta + \\frac{1}{q^2}\\right)\\varepsilon^2$:\n$$ \\frac{B_\\phi}{B^2} \\approx \\frac{1}{B_0} (1-\\varepsilon\\cos\\theta+\\varepsilon^2\\cos^2\\theta) \\left(1 + \\left[2\\varepsilon\\cos\\theta - \\left(3\\cos^2\\theta + \\frac{1}{q^2}\\right)\\varepsilon^2\\right] + (2\\varepsilon\\cos\\theta)^2 \\right) $$\n$$ \\frac{B_\\phi}{B^2} \\approx \\frac{1}{B_0} (1-\\varepsilon\\cos\\theta+\\varepsilon^2\\cos^2\\theta) \\left(1 + 2\\varepsilon\\cos\\theta + \\left(-3\\cos^2\\theta - \\frac{1}{q^2} + 4\\cos^2\\theta\\right)\\varepsilon^2 \\right) $$\n$$ \\frac{B_\\phi}{B^2} \\approx \\frac{1}{B_0} (1-\\varepsilon\\cos\\theta+\\varepsilon^2\\cos^2\\theta) \\left(1 + 2\\varepsilon\\cos\\theta + \\left(\\cos^2\\theta - \\frac{1}{q^2}\\right)\\varepsilon^2 \\right) $$\nMultiplying these expressions and keeping terms up to $\\mathcal{O}(\\varepsilon^2)$:\n-   $\\mathcal{O}(1)$: $1 \\times 1 = 1$.\n-   $\\mathcal{O}(\\varepsilon)$: $1 \\times (2\\varepsilon\\cos\\theta) + (-\\varepsilon\\cos\\theta) \\times 1 = \\varepsilon\\cos\\theta$.\n-   $\\mathcal{O}(\\varepsilon^2)$: $1 \\times \\left(\\varepsilon^2(\\cos^2\\theta - 1/q^2)\\right) + (-\\varepsilon\\cos\\theta) \\times (2\\varepsilon\\cos\\theta) + (\\varepsilon^2\\cos^2\\theta) \\times 1 = (\\cos^2\\theta - 1/q^2 - 2\\cos^2\\theta + \\cos^2\\theta)\\varepsilon^2 = -\\frac{\\varepsilon^2}{q^2}$.\nSo, the final expansion for the ratio is:\n$$ \\frac{B_\\phi}{B^2} \\approx \\frac{1}{B_0} \\left( 1 + \\varepsilon\\cos\\theta - \\frac{\\varepsilon^2}{q^2} \\right) $$\nSubstituting this back into the expression for $v_{E\\theta}$:\n$$ v_{E\\theta}(r,\\theta) \\approx \\frac{c \\phi'(r)}{B_0} \\left( 1 + \\frac{r}{R_0}\\cos\\theta - \\frac{r^2}{R_0^2 q^2} \\right) $$\nNow we compute the flux-surface average as defined in the problem:\n$$ \\langle v_{E\\theta}(r)\\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} v_{E\\theta}(r,\\theta)\\,d\\theta = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} \\frac{c \\phi'(r)}{B_0} \\left( 1 + \\frac{r}{R_0}\\cos\\theta - \\frac{r^2}{R_0^2 q^2} \\right) d\\theta $$\nSince $\\phi'$, $c$, $B_0$, $r$, $R_0$, and $q$ are constant with respect to $\\theta$, we can pull them out of the integral:\n$$ \\langle v_{E\\theta}(r)\\rangle = \\frac{c \\phi'(r)}{B_0} \\left( \\frac{1}{2\\pi}\\int_{0}^{2\\pi} 1 \\,d\\theta + \\frac{r}{R_0}\\frac{1}{2\\pi}\\int_{0}^{2\\pi}\\cos\\theta \\,d\\theta - \\frac{r^2}{R_0^2 q^2}\\frac{1}{2\\pi}\\int_{0}^{2\\pi} 1 \\,d\\theta \\right) $$\nThe integrals are standard: $\\int_{0}^{2\\pi} 1 \\,d\\theta = 2\\pi$ and $\\int_{0}^{2\\pi}\\cos\\theta \\,d\\theta = 0$.\n$$ \\langle v_{E\\theta}(r)\\rangle = \\frac{c \\phi'(r)}{B_0} \\left( 1 + 0 - \\frac{r^2}{R_0^2 q^2} \\right) = \\frac{c \\phi'(r)}{B_0} \\left(1 - \\frac{r^2}{q^2 R_0^2} \\right) $$\nFinally, we substitute the specified potential profile $\\phi(r) = \\phi_0 \\exp(-r^2/\\sigma^2)$. The derivative is:\n$$ \\phi'(r) = \\frac{d}{dr}\\left(\\phi_0 \\exp\\left(-\\frac{r^2}{\\sigma^2}\\right)\\right) = \\phi_0 \\exp\\left(-\\frac{r^2}{\\sigma^2}\\right) \\left(-\\frac{2r}{\\sigma^2}\\right) = -\\frac{2r\\phi_0}{\\sigma^2}\\exp\\left(-\\frac{r^2}{\\sigma^2}\\right) $$\nInserting this derivative gives the final expression for the averaged poloidal flow:\n$$ \\langle v_{E\\theta}(r)\\rangle = \\frac{c}{B_0} \\left(-\\frac{2r\\phi_0}{\\sigma^2}\\exp\\left(-\\frac{r^2}{\\sigma^2}\\right)\\right) \\left(1 - \\frac{r^2}{q^2 R_0^2} \\right) $$\n$$ \\langle v_{E\\theta}(r)\\rangle = -\\frac{2c\\phi_0 r}{B_0 \\sigma^2} \\left(1 - \\frac{r^2}{q^2 R_0^2} \\right) \\exp\\left(-\\frac{r^2}{\\sigma^2}\\right) $$\nThis expression represents the residual zonal flow in the poloidal direction, which is a key component in the physics of transport barriers and GAMs. The calculation is performed in CGS units, as implied by the form of the $\\mathbf{E}\\times\\mathbf{B}$ drift, so the result for velocity is in cm/s.",
            "answer": "$$\n\\boxed{-\\frac{2c\\phi_{0}r}{B_{0}\\sigma^{2}} \\left(1 - \\frac{r^{2}}{q^{2}R_{0}^{2}}\\right) \\exp\\left(-\\frac{r^{2}}{\\sigma^{2}}\\right)}\n$$"
        },
        {
            "introduction": "Our final practice bridges the gap between analytical theory and computational verification, a critical skill in modern fusion research. After a zonal potential is introduced, plasma dynamics cause it to relax, but not completely to zero. This exercise guides you through the physics of the famous Rosenbluth-Hinton residual zonal flow, a long-lived flow that persists due to neoclassical polarization effects . By implementing the theoretical prediction and comparing it against a simplified relaxation model, you will gain insight into the long-term fate of zonal flows and the methods used to validate complex gyrokinetic simulation codes.",
            "id": "3725799",
            "problem": "Consider an axisymmetric tokamak plasma in the collisionless, electrostatic, long-wavelength limit with adiabatic electrons and large aspect ratio, in which the initial condition is a pure zonal potential. The goal is to specify verification tests for a gyrokinetic algorithm by computing the long-time residual level of the zonal component of the potential and comparing it to a theoretically derived prediction attributed to Rosenbluth and Hinton. Your task is to write a program that, for a set of safety factor and inverse aspect ratio values, computes the theoretically predicted residual fraction and numerically measures the residual fraction from a simplified geodesic acoustic mode relaxation model, then checks agreement within a specified tolerance.\n\nRequirements and assumptions are as follows:\n- Use the collisionless, electrostatic, axisymmetric tokamak limit where electrons respond adiabatically, ions are gyrokinetic, and the wavelength is sufficiently long that $k_r \\rho_i \\ll 1$. The initial condition is a purely zonal potential with no initial poloidal or toroidal mode coupling.\n- Normalize the potential as $e \\phi / T_i$ so that it is dimensionless, and normalize time to $R / c_s$ so that characteristic geodesic acoustic mode frequency is dimensionless. Angles in trigonometric functions must be in radians.\n- The long-time residual fraction $\\mathcal{R}(q,\\epsilon)$ is defined as $\\phi_\\infty / \\phi_0$, where $\\phi_0$ is the initial zonal potential amplitude and $\\phi_\\infty$ is the long-time limit of the potential after geodesic acoustic mode relaxation.\n- The theoretically predicted residual fraction must be obtained by a first-principles derivation using quasineutrality and neoclassical polarization in the large aspect ratio tokamak limit and must depend on the safety factor $q$ and inverse aspect ratio $\\epsilon$.\n- To emulate a measurement in a reduced model, represent the time evolution of the zonal potential by a damped geodesic acoustic mode relaxation of the form\n$$\n\\phi(t) = \\phi_\\infty + \\left(\\phi_0 - \\phi_\\infty\\right) \\exp\\left(-\\gamma t\\right) \\cos\\left(\\omega_G t\\right),\n$$\nwith a dimensionless damping rate $\\gamma$ and a dimensionless geodesic acoustic mode frequency $\\omega_G$; treat $\\gamma$ and $\\omega_G$ as constants independent of $q$ and $\\epsilon$ in this simplified large aspect ratio, isothermal limit. Use $\\omega_G = \\sqrt{11/4}$ (corresponding to ion-electron temperature ratio $\\tau = T_i/T_e = 1$ in the fluid limit) and choose a moderate damping $\\gamma$ so that the exponential term becomes negligible at long times. Measure the residual fraction by computing $\\phi(T)/\\phi_0$ for a large time $T$.\n- Specify a tolerance $\\delta$ for agreement between theory and measurement, and output a boolean that is $True$ if $|\\mathcal{R}_{\\mathrm{meas}} - \\mathcal{R}_{\\mathrm{theory}}| \\le \\delta$, and $False$ otherwise.\n\nTest suite:\n- Use the following set of test cases, each specified as a tuple $(q, \\epsilon, \\phi_0)$:\n    - Case A (happy path): $(q, \\epsilon, \\phi_0) = (2.0, 0.1, 1.0)$.\n    - Case B (lower safety factor): $(q, \\epsilon, \\phi_0) = (1.0, 0.1, 1.0)$.\n    - Case C (smaller inverse aspect ratio): $(q, \\epsilon, \\phi_0) = (2.0, 0.01, 1.0)$.\n    - Case D (larger inverse aspect ratio and higher $q$): $(q, \\epsilon, \\phi_0) = (2.5, 0.3, 0.5)$.\n    - Case E (very low $q$ and moderate $\\epsilon$): $(q, \\epsilon, \\phi_0) = (0.7, 0.2, 1.0)$.\n    - Case F (high $q$ and small $\\epsilon$): $(q, \\epsilon, \\phi_0) = (4.0, 0.05, 1.0)$.\n- Choose a numerical measurement time $T$ such that $\\exp(-\\gamma T)$ is numerically negligible, and set a tolerance $\\delta = 10^{-6}$.\n\nProgram output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry corresponds to one test case, in the same order as above, and is a boolean indicating whether the measured residual fraction agrees with the theoretically predicted residual fraction within the tolerance $\\delta$. For example, if all tests pass, the program should print a line of the form $[\\mathrm{True},\\mathrm{True},\\mathrm{True},\\mathrm{True},\\mathrm{True},\\mathrm{True}]$.\n\nNote: All computations are dimensionless by construction, so no physical units are required for the outputs. Angles in $\\cos(\\cdot)$ are in radians, and all numerical constants used in the simplified measurement model must be explicitly defined in your program.",
            "solution": "The problem requires the creation of a verification test for a gyrokinetic algorithm by comparing a theoretically derived long-time residual zonal potential with a numerically measured value from a simplified relaxation model. The comparison must be performed for several test cases defined by the safety factor $q$ and inverse aspect ratio $\\epsilon$.\n\nFirst, we must derive the theoretical prediction for the residual potential fraction, $\\mathcal{R}_{\\mathrm{theory}}(q,\\epsilon)$, which is attributed to Rosenbluth and Hinton. This derivation is rooted in the principles of quasineutrality and neoclassical polarization in a collisionless, large aspect ratio tokamak plasma.\n\nA zonal potential, being constant on a magnetic flux surface, is established as an initial condition $\\phi_0$. The plasma responds to shield this potential. On a very short timescale (of the order of an ion gyroperiod), the shielding is provided by the classical ion polarization drift. In the long-wavelength limit $k_\\perp \\rho_i \\ll 1$, where $k_\\perp$ is the perpendicular wavenumber and $\\rho_i$ is the ion gyroradius, the plasma exhibits a certain \"classical\" capacitance, $C_{cl}$. The charge density induced is related to the potential by this capacitance.\n\nOver a longer timescale, characteristic of ion transit or bounce motion, neoclassical effects become important. In an axisymmetric tokamak, charged particles are not perfectly confined to a single magnetic flux surface. Trapped particles, in particular, execute \"banana\" orbits that have a significant radial extent. The presence of a radial electric field (associated with the zonal potential) modifies these banana orbits, leading to an additional radial polarization of the plasma. This is the neoclassical polarization effect, which corresponds to an additional \"neoclassical\" capacitance, $C_{neo}$.\n\nThe total long-time capacitance of the plasma is $C_{total} = C_{cl} + C_{neo}$. By conservation of charge, the charge sourced by the initial potential must be the same as the charge held by the final state.\nInitially, at time $t=0^+$, only the rapid classical polarization responds:\n$Q = C_{cl} \\phi_0$.\nIn the long-time limit $t \\to \\infty$, the aperiodic zonal potential settles to a residual value $\\phi_\\infty$, and the system is shielded by the full (classical plus neoclassical) capacitance:\n$Q = (C_{cl} + C_{neo}) \\phi_\\infty$.\n\nEquating the expressions for the conserved charge $Q$ gives:\n$$C_{cl} \\phi_0 = (C_{cl} + C_{neo}) \\phi_\\infty$$\nThe residual fraction $\\mathcal{R}_{\\mathrm{theory}} = \\phi_\\infty / \\phi_0$ is therefore given by the ratio of capacitances:\n$$\\mathcal{R}_{\\mathrm{theory}} = \\frac{\\phi_\\infty}{\\phi_0} = \\frac{C_{cl}}{C_{cl} + C_{neo}} = \\frac{1}{1 + C_{neo}/C_{cl}}$$\nThe seminal work of Rosenbluth and Hinton provides the analytical expression for the ratio of neoclassical to classical polarization in the collisionless, large aspect ratio ($\\epsilon = r/R_0 \\ll 1$) limit:\n$$\\frac{C_{neo}}{C_{cl}} \\approx 1.6 \\frac{q^2}{\\sqrt{\\epsilon}}$$\nwhere $q$ is the safety factor and $\\epsilon$ is the inverse aspect ratio. The numerical factor $1.6$ is a widely used approximation. Substituting this into our expression for the residual fraction yields the theoretical formula to be implemented:\n$$\\mathcal{R}_{\\mathrm{theory}}(q, \\epsilon) = \\frac{1}{1 + 1.6 q^2 / \\sqrt{\\epsilon}}$$\nThis formula is valid for any positive values of $q$ and $\\epsilon$.\n\nNext, we analyze the simplified model provided for the time evolution of the zonal potential $\\phi(t)$, which is intended to emulate a numerical measurement. The model is given as:\n$$\\phi(t) = \\phi_\\infty + \\left(\\phi_0 - \\phi_\\infty\\right) \\exp\\left(-\\gamma t\\right) \\cos\\left(\\omega_G t\\right)$$\nHere, $\\phi_0$ is the initial potential, $\\phi_\\infty = \\mathcal{R}_{\\mathrm{theory}} \\phi_0$ is the asymptotic residual potential, $\\gamma$ is a damping rate, and $\\omega_G$ is the geodesic acoustic mode (GAM) frequency. The problem specifies the dimensionless GAM frequency as $\\omega_G = \\sqrt{11/4}$. The measured residual fraction, $\\mathcal{R}_{\\mathrm{meas}}$, is defined as $\\phi(T)/\\phi_0$ for a large but finite time $T$. Dividing the model equation by $\\phi_0$ yields:\n$$\\frac{\\phi(t)}{\\phi_0} = \\frac{\\phi_\\infty}{\\phi_0} + \\left(1 - \\frac{\\phi_\\infty}{\\phi_0}\\right) \\exp\\left(-\\gamma t\\right) \\cos\\left(\\omega_G t\\right)$$\nSubstituting $\\mathcal{R}_{\\mathrm{theory}} = \\phi_\\infty/\\phi_0$, the measured residual at time $T$ is:\n$$\\mathcal{R}_{\\mathrm{meas}} = \\mathcal{R}_{\\mathrm{theory}} + (1 - \\mathcal{R}_{\\mathrm{theory}}) \\exp(-\\gamma T) \\cos(\\omega_G T)$$\nThe verification test consists of checking if the \"measurement\" is close enough to the theoretical value, within a given tolerance $\\delta = 10^{-6}$:\n$$|\\mathcal{R}_{\\mathrm{meas}} - \\mathcal{R}_{\\mathrm{theory}}| \\le \\delta$$\nSubstituting the expression for $\\mathcal{R}_{\\mathrm{meas}}$, this condition becomes:\n$$|(\\mathcal{R}_{\\mathrm{theory}} + (1 - \\mathcal{R}_{\\mathrm{theory}}) e^{-\\gamma T} \\cos(\\omega_G T)) - \\mathcal{R}_{\\mathrm{theory}}| \\le \\delta$$\n$$|(1 - \\mathcal{R}_{\\mathrm{theory}}) e^{-\\gamma T} \\cos(\\omega_G T)| \\le \\delta$$\nThe term on the left represents the numerical error due to measuring at a finite time $T$. To ensure this condition is met for any test case, we must choose the numerical parameters $\\gamma$ and $T$ appropriately. We know that $|\\cos(\\omega_G T)| \\le 1$. The term $1 - \\mathcal{R}_{\\mathrm{theory}}$ is also bounded: since $\\mathcal{R}_{\\mathrm{theory}} = (1 + 1.6 q^2/\\sqrt{\\epsilon})^{-1}$, for positive $q$ and $\\epsilon$, we have $0  \\mathcal{R}_{\\mathrm{theory}} \\le 1$, which implies $0 \\le 1 - \\mathcal{R}_{\\mathrm{theory}}  1$. Therefore, the inequality is guaranteed to hold if we choose $T$ such that:\n$$e^{-\\gamma T}  \\delta$$\nThe problem suggests a \"moderate damping\" $\\gamma$. We choose $\\gamma=1.0$ as a representative value. With $\\delta=10^{-6}$, this requires:\n$$e^{-T}  10^{-6} \\implies -T  \\ln(10^{-6}) \\implies T  - \\ln(10^{-6}) \\approx 13.8155$$\nTo ensure a robust margin of safety against floating-point inaccuracies and the prefactors, we will select a significantly larger time, $T=40.0$. At this time, the exponential term $e^{-40} \\approx 4.2 \\times 10^{-18}$, which is far smaller than the tolerance $\\delta$. This guarantees that for all valid inputs, the measured value will agree with the theory to within the specified tolerance.\n\nThe algorithm for the program is as follows:\n1.  Define the physical and numerical constants: $\\omega_G = \\sqrt{11/4}$, $\\gamma=1.0$, $T=40.0$, and $\\delta=10^{-6}$.\n2.  For each test case $(q, \\epsilon, \\phi_0)$:\n    a. Calculate $\\mathcal{R}_{\\mathrm{theory}} = (1 + 1.6 q^2 / \\sqrt{\\epsilon})^{-1}$. The initial potential $\\phi_0$ is irrelevant for the residual fraction calculation.\n    b. Calculate $\\mathcal{R}_{\\mathrm{meas}} = \\mathcal{R}_{\\mathrm{theory}} + (1 - \\mathcal{R}_{\\mathrm{theory}}) \\exp(-\\gamma T) \\cos(\\omega_G T)$.\n    c. Evaluate the boolean condition $|\\mathcal{R}_{\\mathrm{meas}} - \\mathcal{R}_{\\mathrm{theory}}| \\le \\delta$.\n3.  Collect the boolean results for all test cases and print them in the specified format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the agreement between a theoretical Rosenbluth-Hinton residual\n    zonal potential and a measurement from a simplified relaxation model for a\n    set of test cases in tokamak plasma physics.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (q, epsilon, phi_0)\n    # q: safety factor\n    # epsilon: inverse aspect ratio\n    # phi_0: initial potential amplitude (note: does not affect the residual fraction)\n    test_cases = [\n        # Case A (happy path)\n        (2.0, 0.1, 1.0),\n        # Case B (lower safety factor)\n        (1.0, 0.1, 1.0),\n        # Case C (smaller inverse aspect ratio)\n        (2.0, 0.01, 1.0),\n        # Case D (larger inverse aspect ratio and higher q)\n        (2.5, 0.3, 0.5),\n        # Case E (very low q and moderate epsilon)\n        (0.7, 0.2, 1.0),\n        # Case F (high q and small epsilon)\n        (4.0, 0.05, 1.0),\n    ]\n\n    # Define numerical and physical constants as per the problem description.\n    # Dimensionless GAM frequency squared is 11/4.\n    omega_G = np.sqrt(11.0 / 4.0)\n    # Dimensionless damping rate for the simplified model (chosen as moderate).\n    gamma = 1.0\n    # Numerical measurement time, chosen to be large enough for convergence.\n    # We require exp(-gamma * T)  delta. T=40 is amply sufficient.\n    T = 40.0\n    # Tolerance for agreement check.\n    delta = 1e-6\n\n    results = []\n    for case in test_cases:\n        q, epsilon, _ = case\n\n        # 1. Calculate the theoretically predicted residual fraction (Rosenbluth-Hinton).\n        # R_theory = 1 / (1 + 1.6 * q^2 / sqrt(epsilon))\n        if epsilon = 0:\n            # Avoid division by zero or domain errors, handle as invalid case if needed.\n            # In this problem, all epsilon  0.\n            # For robustness, we could flag such a case, but it's not in the test suite.\n            # Let's assume epsilon  0 as per physics.\n            pass\n        \n        R_theory = 1.0 / (1.0 + 1.6 * q**2 / np.sqrt(epsilon))\n\n        # 2. Emulate the measurement of the residual fraction from the simplified model.\n        # R_meas(T) = R_theory + (1 - R_theory) * exp(-gamma*T) * cos(omega_G*T)\n        # This formula directly models the time evolution provided in the problem statement.\n        oscillatory_term = (1.0 - R_theory) * np.exp(-gamma * T) * np.cos(omega_G * T)\n        R_meas = R_theory + oscillatory_term\n\n        # 3. Check for agreement within the specified tolerance.\n        # The condition is |R_meas - R_theory| = delta.\n        # This simplifies to checking if the magnitude of the oscillatory term is within delta.\n        numerical_difference = np.abs(R_meas - R_theory)\n        is_agreed = numerical_difference = delta\n        \n        results.append(is_agreed)\n\n    # Final print statement in the exact required format.\n    # The output should be a list of booleans, e.g., [True,True,True,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}