{
    "hands_on_practices": [
        {
            "introduction": "安全因子 $q$ 是描述磁场线在磁面上螺距的关键参数，其径向分布对等离子体的宏观不稳定性至关重要。这个练习将带你从第一性原理出发，在一个简化的托卡马克模型中，根据给定的等离子体电流分布推导安全因子 $q$ 分布及其梯度（即磁剪切）。掌握这项基本技能对于理解托卡马克中的磁场位形和稳定性至关重要。",
            "id": "3708367",
            "problem": "在一个轴对称、大环径比的圆形托卡马克中，磁通量面是嵌套的，并由小半径 $r$（$0 \\le r \\le a$）标记，其中 $a$ 是等离子体小半径，$R_0$ 是几何大半径。环向磁场为 $B_{\\phi}(R) = B_0 R_0 / R$，其中 $B_0$ 是轴上环向场，$R$ 是柱坐标大半径。极向磁场由环向等离子体电流密度 $j_{\\phi}(r)$ 通过安培定律产生，因此 $B_{\\theta}(r) = \\mu_0 I_p(r)/(2\\pi r)$，其中 $I_p(r)$ 是半径为 $r$ 的圆所包含的电流。考虑一个物理上合理、中心峰化的环向电流密度分布 $j_{\\phi}(r) = j_0 \\left(1 - \\frac{r^2}{a^2}\\right)$，对于 $0 \\le r \\le a$，总等离子体电流为 $I_p \\equiv I_p(a)$。\n\n从托卡马克安全因子 $q(r)$（定义为一条磁力线每绕极向一圈所绕的环向圈数）的基本定义出发，并使用大环径比圆形磁通量面近似将 $q(r)$ 与磁通量面上的磁场分量联系起来，推导出一个用 $B_0$、$R_0$、$\\mu_0$、$I_p$、$a$ 和 $r$ 表示的 $q(r)$ 的闭合形式表达式。然后计算径向导数 $\\mathrm{d}q/\\mathrm{d}r$ 以评估磁剪切。在计算大环径比的 $q(r)$ 时，在给定的磁通量面上使用近似 $R \\approx R_0$。将 $q(r)$ 和 $\\mathrm{d}q/\\mathrm{d}r$ 的最终结果表示为闭合形式的符号表达式。不需要进行数值计算。",
            "solution": "该问题是有效的，因为它在科学上基于托卡马克等离子体物理，问题提法得当且客观。它提供了一套完整的定义和参数，用于推导安全因子 $q(r)$ 和磁剪切 $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$。\n\n安全因子 $q(r)$ 定义为一条磁力线每绕极向一圈所绕的环向圈数。对于具有圆形磁通量面的大环径比（$R_0 \\gg a$）托卡马克，磁力线的路径由微分方程 $\\frac{R \\mathrm{d}\\phi}{\\mathrm{d}l_{\\mathrm{pol}}} = \\frac{B_{\\phi}}{B_{\\theta}}$ 描述，其中 $\\mathrm{d}l_{\\mathrm{pol}}$ 是极向弧长元。对于小半径为 $r$ 的圆形磁通量面，$\\mathrm{d}l_{\\mathrm{pol}} = r \\mathrm{d}\\theta$。方程变为 $\\frac{R \\mathrm{d}\\phi}{r \\mathrm{d}\\theta} = \\frac{B_{\\phi}}{B_{\\theta}}$。重新整理得到磁力线的螺距 $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta} = \\frac{r B_{\\phi}}{R B_{\\theta}}$。安全因子 $q(r)$ 是这个螺距在磁通量面上的平均值。对于大环径比的圆形托卡马克，我们可以用几何大半径 $R_0$ 来近似磁通量面上的大半径 $R$，用轴上值 $B_0$ 来近似环向场 $B_{\\phi}$。这给出了标准公式：\n$$q(r) \\approx \\frac{r B_0}{R_0 B_{\\theta}(r)}$$\n为了求得 $q(r)$，我们必须首先确定由环向电流密度 $j_{\\phi}(r)$ 产生的极向磁场 $B_{\\theta}(r)$。问题给出了电流密度分布：\n$$j_{\\phi}(r) = j_0 \\left(1 - \\frac{r^2}{a^2}\\right)$$\n半径 $r$ 内包含的电流 $I_p(r)$ 通过对圆形截面积分 $j_{\\phi}(r)$ 得到：\n$$I_p(r) = \\int_0^r j_{\\phi}(r') 2\\pi r' \\mathrm{d}r' = \\int_0^r j_0 \\left(1 - \\frac{(r')^2}{a^2}\\right) 2\\pi r' \\mathrm{d}r'$$\n$$I_p(r) = 2\\pi j_0 \\int_0^r \\left(r' - \\frac{(r')^3}{a^2}\\right) \\mathrm{d}r' = 2\\pi j_0 \\left[ \\frac{(r')^2}{2} - \\frac{(r')^4}{4a^2} \\right]_0^r$$\n$$I_p(r) = 2\\pi j_0 \\left(\\frac{r^2}{2} - \\frac{r^4}{4a^2}\\right) = \\pi j_0 r^2 \\left(1 - \\frac{r^2}{2a^2}\\right)$$\n总等离子体电流 $I_p$ 是在等离子体边界 $r=a$ 处所包含的电流：\n$$I_p = I_p(a) = \\pi j_0 a^2 \\left(1 - \\frac{a^2}{2a^2}\\right) = \\pi j_0 a^2 \\left(1 - \\frac{1}{2}\\right) = \\frac{\\pi j_0 a^2}{2}$$\n我们可以用这个关系式来表示中心电流密度 $j_0$ 与总电流 $I_p$ 的关系：\n$$j_0 = \\frac{2 I_p}{\\pi a^2}$$\n将 $j_0$ 的这个表达式代回到 $I_p(r)$ 的方程中：\n$$I_p(r) = \\pi \\left(\\frac{2 I_p}{\\pi a^2}\\right) r^2 \\left(1 - \\frac{r^2}{2a^2}\\right) = \\frac{2I_p r^2}{a^2} \\left(\\frac{2a^2 - r^2}{2a^2}\\right) = \\frac{I_p r^2 (2a^2 - r^2)}{a^4}$$\n现在，我们使用安培定律来求极向磁场 $B_{\\theta}(r)$：\n$$B_{\\theta}(r) = \\frac{\\mu_0 I_p(r)}{2\\pi r} = \\frac{\\mu_0}{2\\pi r} \\left(\\frac{I_p r^2 (2a^2 - r^2)}{a^4}\\right) = \\frac{\\mu_0 I_p r (2a^2 - r^2)}{2\\pi a^4}$$\n有了 $B_{\\theta}(r)$ 的这个表达式，我们就可以求出安全因子 $q(r)$：\n$$q(r) = \\frac{r B_0}{R_0 B_{\\theta}(r)} = \\frac{r B_0}{R_0 \\left(\\frac{\\mu_0 I_p r (2a^2 - r^2)}{2\\pi a^4}\\right)}$$\n$$q(r) = \\frac{r B_0 \\cdot 2\\pi a^4}{R_0 \\mu_0 I_p r (2a^2 - r^2)} = \\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)}$$\n这就是用指定参数表示的 $q(r)$ 的闭合形式表达式。\n\n接下来，我们计算磁剪切，其定义为安全因子的径向导数 $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$。\n令 $C = \\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p}$。则 $q(r) = C (2a^2 - r^2)^{-1}$。我们使用链式法则进行微分：\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = \\frac{\\mathrm{d}}{\\mathrm{d}r} \\left[ C (2a^2 - r^2)^{-1} \\right] = C \\cdot (-1) (2a^2 - r^2)^{-2} \\cdot \\frac{\\mathrm{d}}{\\mathrm{d}r}(2a^2 - r^2)$$\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = -C (2a^2 - r^2)^{-2} (-2r) = \\frac{2Cr}{(2a^2 - r^2)^2}$$\n将常数 $C$ 的表达式代回方程中：\n$$\\frac{\\mathrm{d}q}{\\mathrm{d}r} = \\frac{2r}{(2a^2 - r^2)^2} \\left(\\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p}\\right) = \\frac{4\\pi a^4 r B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)^2}$$\n这是磁剪切 $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$ 的最终表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2\\pi a^4 B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)}  \\frac{4\\pi a^4 r B_0}{R_0 \\mu_0 I_p (2a^2 - r^2)^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "为了精确地分析等离子体中的输运和不稳定性，我们通常需要在与磁通量面自然对齐的坐标系（即“通量坐标系”）中进行研究。这个练习将让你计算坐标变换的雅可比行列式 $J$，这是在通量坐标系下所有物理方程中都会出现的关键几何因子。通过为一个模型托卡马克几何计算雅可比行列式，你将更深入地理解磁约束理论的数学框架。",
            "id": "3708333",
            "problem": "考虑一个轴对称环形等离子体，其具有由极向磁通量 $\\psi$ 标记的嵌套磁通量面。使用柱坐标 $(R,\\phi,Z)$，其标准正交基矢为 $\\boldsymbol{e}_R$、$\\boldsymbol{e}_\\phi$ 和 $\\boldsymbol{e}_Z$。极向角 $\\theta$ 和环向角 $\\phi$ 是每个磁通量面上的坐标，以弧度为单位。在一个具有圆形截面的大环径比位形中，一个次半径为 $r$ 的磁通量面嵌入柱坐标的表达式为\n$$\nR(\\theta,\\phi) = R_0 + r \\cos\\theta, \\quad Z(\\theta,\\phi) = r \\sin\\theta,\n$$\n其中 $R_0$ 是主半径（假设 $R_0 \\gg r$），磁通量标签满足 $\\psi = \\psi(r)$，且 $r$ 仅依赖于 $\\psi$。从曲线坐标几何的第一性原理和柱坐标中的标准矢量微积分出发，并且除了这些定义之外不援引任何专门的坐标系恒等式，将变换 $(\\psi,\\theta,\\phi) \\mapsto (R,\\phi,Z)$ 的逆雅可比行列式表示为\n$$\nJ^{-1} = \\nabla \\psi \\cdot \\left( \\nabla \\theta \\times \\nabla \\phi \\right),\n$$\n并计算在大环径比极限下，给定参数化嵌入的 $J^{-1}$，保留到 $r/R_0$ 的领头阶。您的最终答案必须是关于 $R_0$、$r$ 和 $\\frac{d\\psi}{dr}$ 的单个闭合形式解析表达式，并且在所述阶数上必须是精确的。不需要数值近似，最终方框内的表达式中不应包含任何单位。",
            "solution": "该问题要求计算从磁通量坐标 $(\\psi, \\theta, \\phi)$ 到柱坐标 $(R, \\phi, Z)$ 的坐标变换的逆雅可比行列式 $J^{-1}$。问题陈述将逆雅可比行列式定义为标量三重积 $J^{-1} = \\nabla \\psi \\cdot (\\nabla \\theta \\times \\nabla \\phi)$。计算需针对具有圆形截面的特定大环径比环形几何进行，并取至环径比参数 $r/R_0$ 的领头阶。\n\n首先，我们将建立给定的三维标量三重积与极向平面中的二维雅可比行列式之间的关系。该问题在标准柱坐标系 $(R, \\phi, Z)$ 中表述，其中基矢 $(\\boldsymbol{e}_R, \\boldsymbol{e}_\\phi, \\boldsymbol{e}_Z)$ 构成一个右手标准正交系。在这些坐标中，梯度算子由下式给出：\n$$\n\\nabla = \\boldsymbol{e}_R \\frac{\\partial}{\\partial R} + \\boldsymbol{e}_\\phi \\frac{1}{R} \\frac{\\partial}{\\partial \\phi} + \\boldsymbol{e}_Z \\frac{\\partial}{\\partial Z}\n$$\n由于假定的轴对称性，坐标 $\\psi$ 和 $\\theta$ 仅是 $R$ 和 $Z$ 的函数，即 $\\psi = \\psi(R,Z)$ 和 $\\theta = \\theta(R,Z)$。磁通量坐标系中的环向角 $\\phi$ 与柱坐标 $\\phi$ 相同。因此，磁通量坐标的梯度为：\n$$\n\\nabla \\psi = \\frac{\\partial \\psi}{\\partial R} \\boldsymbol{e}_R + \\frac{\\partial \\psi}{\\partial Z} \\boldsymbol{e}_Z\n$$\n$$\n\\nabla \\theta = \\frac{\\partial \\theta}{\\partial R} \\boldsymbol{e}_R + \\frac{\\partial \\theta}{\\partial Z} \\boldsymbol{e}_Z\n$$\n$$\n\\nabla \\phi = \\frac{1}{R} \\boldsymbol{e}_\\phi\n$$\n现在，我们计算叉积 $\\nabla \\theta \\times \\nabla \\phi$:\n$$\n\\nabla \\theta \\times \\nabla \\phi = \\left( \\frac{\\partial \\theta}{\\partial R} \\boldsymbol{e}_R + \\frac{\\partial \\theta}{\\partial Z} \\boldsymbol{e}_Z \\right) \\times \\left( \\frac{1}{R} \\boldsymbol{e}_\\phi \\right)\n$$\n使用右手系的矢量恒等式 $\\boldsymbol{e}_R \\times \\boldsymbol{e}_\\phi = \\boldsymbol{e}_Z$ 和 $\\boldsymbol{e}_Z \\times \\boldsymbol{e}_\\phi = -\\boldsymbol{e}_R$，我们得到：\n$$\n\\nabla \\theta \\times \\nabla \\phi = \\frac{1}{R} \\frac{\\partial \\theta}{\\partial R} (\\boldsymbol{e}_R \\times \\boldsymbol{e}_\\phi) + \\frac{1}{R} \\frac{\\partial \\theta}{\\partial Z} (\\boldsymbol{e}_Z \\times \\boldsymbol{e}_\\phi) = \\frac{1}{R} \\frac{\\partial \\theta}{\\partial R} \\boldsymbol{e}_Z - \\frac{1}{R} \\frac{\\partial \\theta}{\\partial Z} \\boldsymbol{e}_R\n$$\n接下来，我们计算与 $\\nabla \\psi$ 的点积：\n$$\nJ^{-1} = \\nabla \\psi \\cdot (\\nabla \\theta \\times \\nabla \\phi) = \\left( \\frac{\\partial \\psi}{\\partial R} \\boldsymbol{e}_R + \\frac{\\partial \\psi}{\\partial Z} \\boldsymbol{e}_Z \\right) \\cdot \\left( -\\frac{1}{R} \\frac{\\partial \\theta}{\\partial Z} \\boldsymbol{e}_R + \\frac{1}{R} \\frac{\\partial \\theta}{\\partial R} \\boldsymbol{e}_Z \\right)\n$$\n$$\nJ^{-1} = \\frac{1}{R} \\left( \\frac{\\partial \\psi}{\\partial Z} \\frac{\\partial \\theta}{\\partial R} - \\frac{\\partial \\psi}{\\partial R} \\frac{\\partial \\theta}{\\partial Z} \\right)\n$$\n括号中的项是从 $(R,Z)$ 到 $(\\psi,\\theta)$ 变换的雅可比矩阵的行列式，但是列进行了置换，即 $\\frac{\\partial(\\psi,\\theta)}{\\partial(Z,R)}$。这等于 $-\\frac{\\partial(\\psi,\\theta)}{\\partial(R,Z)}$。\n$$\n\\frac{\\partial(\\psi,\\theta)}{\\partial(R,Z)} = \\det \\begin{pmatrix} \\frac{\\partial \\psi}{\\partial R}  \\frac{\\partial \\psi}{\\partial Z} \\\\ \\frac{\\partial \\theta}{\\partial R}  \\frac{\\partial \\theta}{\\partial Z} \\end{pmatrix} = \\frac{\\partial \\psi}{\\partial R} \\frac{\\partial \\theta}{\\partial Z} - \\frac{\\partial \\psi}{\\partial Z} \\frac{\\partial \\theta}{\\partial R}\n$$\n所以，我们可以将逆雅可比行列式写为：\n$$\nJ^{-1} = -\\frac{1}{R} \\frac{\\partial(\\psi,\\theta)}{\\partial(R,Z)}\n$$\n逆变换 $(R,Z) \\to (\\psi,\\theta)$ 的雅可比行列式是正变换 $(\\psi,\\theta) \\to (R,Z)$ 的雅可比行列式的倒数。我们将后者表示为 $J_{2D}$：\n$$\nJ_{2D} = \\frac{\\partial(R,Z)}{\\partial(\\psi,\\theta)} = \\left( \\frac{\\partial(\\psi,\\theta)}{\\partial(R,Z)} \\right)^{-1}\n$$\n因此，$J^{-1} = -\\frac{1}{R J_{2D}}$。\n\n现在，我们使用给定的参数化嵌入来计算 $J_{2D}$。该嵌入以 $(r, \\theta)$ 给出，其中 $r$ 是小半径，且给定 $\\psi = \\psi(r)$。我们可以使用链式法则。变换是从 $(\\psi, \\theta)$到 $(R,Z)$。\n$$\nR(\\psi, \\theta) = R_0 + r(\\psi) \\cos\\theta\n$$\n$$\nZ(\\psi, \\theta) = r(\\psi) \\sin\\theta\n$$\n我们需要 $R$ 和 $Z$ 关于 $\\psi$ 和 $\\theta$ 的偏导数：\n$$\n\\frac{\\partial R}{\\partial \\psi} = \\frac{dr}{d\\psi} \\cos\\theta\n$$\n$$\n\\frac{\\partial R}{\\partial \\theta} = -r \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial \\psi} = \\frac{dr}{d\\psi} \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial \\theta} = r \\cos\\theta\n$$\n现在我们计算 $J_{2D}$ 的行列式：\n$$\nJ_{2D} = \\det \\begin{pmatrix} \\frac{\\partial R}{\\partial \\psi}  \\frac{\\partial R}{\\partial \\theta} \\\\ \\frac{\\partial Z}{\\partial \\psi}  \\frac{\\partial Z}{\\partial \\theta} \\end{pmatrix} = \\left(\\frac{dr}{d\\psi} \\cos\\theta\\right)(r \\cos\\theta) - (-r \\sin\\theta)\\left(\\frac{dr}{d\\psi} \\sin\\theta\\right)\n$$\n$$\nJ_{2D} = r \\frac{dr}{d\\psi} (\\cos^2\\theta + \\sin^2\\theta) = r \\frac{dr}{d\\psi}\n$$\n将此结果代回到我们关于 $J^{-1}$ 的表达式中：\n$$\nJ^{-1} = -\\frac{1}{R J_{2D}} = -\\frac{1}{R \\left(r \\frac{dr}{d\\psi}\\right)} = -\\frac{1}{rR} \\frac{d\\psi}{dr}\n$$\n对于给定的圆形磁通量面模型，这是逆雅可比行列式的精确表达式。主半径 $R$ 是磁通量面上位置的函数，$R = R_0 + r\\cos\\theta$。\n$$\nJ^{-1} = -\\frac{1}{r(R_0 + r\\cos\\theta)} \\frac{d\\psi}{dr}\n$$\n问题要求在大环径比极限 $R_0 \\gg r$ 下，计算此量到小参数 $r/R_0$ 的领头阶。我们可以从分母中提出因子 $R_0$：\n$$\nJ^{-1} = -\\frac{1}{r R_0 \\left(1 + \\frac{r}{R_0}\\cos\\theta\\right)} \\frac{d\\psi}{dr}\n$$\n对于 $r/R_0 \\ll 1$，我们可以使用泰勒级数展开项 $\\left(1 + \\frac{r}{R_0}\\cos\\theta\\right)^{-1}$：\n$$\n\\left(1 + \\frac{r}{R_0}\\cos\\theta\\right)^{-1} = 1 - \\frac{r}{R_0}\\cos\\theta + O\\left(\\left(\\frac{r}{R_0}\\right)^2\\right)\n$$\n领头阶项是 $r/R_0$ 的零阶项，即 $1$。因此，在领头阶上，逆雅可比行列式为：\n$$\nJ^{-1} \\approx -\\frac{1}{rR_0} \\frac{d\\psi}{dr}\n$$",
            "answer": "$$\n\\boxed{-\\frac{1}{r R_0} \\frac{d\\psi}{dr}}\n$$"
        },
        {
            "introduction": "旋转变换 $\\iota$（安全因子 $q$ 的倒数）的根本定义来自于磁场线在长距离上的轨迹。这项计算练习将挑战你直接实现这个定义，通过编写一个程序来追踪磁场线并计算其平均缠绕比。通过这个过程，你不仅能开发一个实用的分析工具，还能对这个关键参数及其数值计算方法获得直观的理解。",
            "id": "3708366",
            "problem": "您的任务是设计并实现一个磁力线追踪算法，用以计算环形约束装置中嵌套磁通量面上的旋转变换。运动的定义域是单个不变的磁通量面，由磁通坐标 $\\,\\psi\\,$ 标记，磁力线由几何角向角 $\\,\\theta\\,$ 和几何环向角 $\\,\\phi\\,$ 描述。旋转变换 $\\,\\iota(\\psi)\\,$ 定义为磁力线在该磁面上单位环向绕转的渐近平均角向绕转数。您应基于以下基本原理：磁力线是磁场 $\\,\\mathbf{B}\\,$ 的积分曲线，与 $\\,\\mathbf{B}\\,$ 相切，因此 $\\,d\\mathbf{x}/ds \\parallel \\mathbf{B}\\,$，并且在磁通量面 $\\,\\psi=\\mathrm{const}\\,$ 上，它们满足一个角度演化关系，该关系可写为关于 $\\,\\theta(\\phi)\\,$ 的常微分方程。旋转变换是长时间平均值\n$$\n\\iota(\\psi)\\equiv \\lim_{\\Delta \\phi \\to \\infty} \\frac{\\Delta \\theta}{\\Delta \\phi}\\,,\n$$\n其中 $\\,\\Delta \\theta\\,$ 和 $\\,\\Delta \\phi\\,$ 是沿该磁面上同一段磁力线的净角向角和环向角变化量。所有角度均须使用弧度。\n\n为了提供一个具体且可测试的环境，同时保持在第一性原理的推理范围内，我们考虑一个给定磁面上磁力线角度动力学的典范玩具模型：\n$$\n\\frac{d\\theta}{d\\phi} = \\iota_0 + \\varepsilon \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big)\\,,\n$$\n其中 $\\,\\iota_0\\,$ 是该磁面的真实旋转变换（在该磁面上的一个无量纲常数），$\\,\\varepsilon\\,$ 是一个小的无量纲振幅，捕捉了几何角度相对于直磁力线角的非直线特性，而 $\\,m,n\\,$ 是描述该磁面和磁场主要螺旋整形的整数。该模型遵守磁力线保持在 $\\,\\psi=\\mathrm{const}\\,$ 上，并且附加的角度依赖性是有界和周期性的。在此模型中，$\\,\\iota(\\psi)\\,$ 是沿磁力线 $\\,d\\theta/d\\phi\\,$ 的长时间平均值。\n\n您的任务是：\n- 从所提供的基本原理出发，推导出一个数值稳定的算法，通过在给定磁面上追踪磁力线并测量多次环向穿越的平均 $\\,\\Delta \\theta/\\Delta \\phi\\,$ 来估计 $\\,\\iota(\\psi)\\,$。您的推导必须基于原理，并且除了上述基本定义外，不能假设任何快捷公式。\n- 将该算法实现为一个程序，该程序在 $\\,N_{\\mathrm{tor}}\\,$ 次环向圈数内，即 $\\,\\phi \\in [0, 2\\pi N_{\\mathrm{tor}}]\\,$，对常微分方程 $\\,\\theta(\\phi)\\,$ 进行积分，初始条件为 $\\,\\theta(\\phi{=}0)=0\\,$。使用固定步长、数值稳定的方法。推荐的旋转变换估计量为\n$$\n\\widehat{\\iota} = \\frac{\\theta(2\\pi N_{\\mathrm{tor}})-\\theta(0)}{2\\pi N_{\\mathrm{tor}}}\\,,\n$$\n这直接实现了 $\\,\\iota(\\psi)\\,$ 作为长时间比率的定义。所有角度均须使用弧度。\n- 确保您的算法讨论了关于 $\\,\\phi\\,$ 的步长和环向圈数 $\\,N_{\\mathrm{tor}}\\,$ 的稳定性和收敛性，并在您的实现选择中反映这一点。\n\n您的算法的输入将是一组固定的测试用例，每个用例由参数 $\\,(\\iota_0, \\varepsilon, m, n, N_{\\mathrm{tor}})\\,$ 指定。初始条件始终为 $\\,\\theta(0)=0\\,$。对于每个测试用例，您的程序必须输出由您的算法计算出的单个估计浮点数 $\\,\\widehat{\\iota}\\,$。没有外部输入；所有参数都嵌入在您的程序中。\n\n测试套件：\n- 用例 $1$（基线，直磁力线极限）：$\\iota_0 = 2/3$, $\\varepsilon = 0$, $m=1$, $n=0$, $N_{\\mathrm{tor}}=10$。\n- 用例 $2$（非共振，具有小调制的无理数基线）：$\\iota_0 = \\sqrt{2}-1$, $\\varepsilon = 0.1$, $m=3$, $n=2$, $N_{\\mathrm{tor}}=50$。\n- 用例 $3$（非共振，中等调制）：$\\iota_0 = 3/5$, $\\varepsilon = 0.3$, $m=2$, $n=1$, $N_{\\mathrm{tor}}=40$。\n- 用例 $4$（近共振、易于锁定的几何构型）：$\\iota_0 = 1$, $\\varepsilon = 0.4$, $m=1$, $n=1$, $N_{\\mathrm{tor}}=60$。\n\n角度单位要求：所有角度 $\\,\\theta\\,$ 和 $\\,\\phi\\,$ 均为弧度。旋转变换 $\\,\\iota\\,$ 是无量纲的。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果顺序与测试套件相同，例如：\n$$\n[\\widehat{\\iota}_1,\\widehat{\\iota}_2,\\widehat{\\iota}_3,\\widehat{\\iota}_4]\\,.\n$$\n- 每个 $\\,\\widehat{\\iota}\\,$ 必须是浮点数。您可以四舍五入到合理的小数位数，但请确保这些值反映了向指定长时间平均值的收敛。",
            "solution": "该问题要求设计并实现一个算法来计算磁通量面上的旋转变换 $\\widehat{\\iota}$。解决方案源自所提供的基本原理。\n\n旋转变换 $\\iota(\\psi)$ 的定义是，沿位于恒定磁通量面 $\\psi$ 上的磁力线，角向角 $\\theta$ 相对于环向角 $\\phi$ 的渐近平均变化率。数学上，这由以下极限给出：\n$$\n\\iota(\\psi) \\equiv \\lim_{\\Delta \\phi \\to \\infty} \\frac{\\Delta \\theta}{\\Delta \\phi}\n$$\n其中 $\\Delta \\theta$ 和 $\\Delta \\phi$ 是净角向角和环向角位移。根据微积分基本定理，该极限可以重写为瞬时变化率 $d\\theta/d\\phi$ 的长时间平均值：\n$$\n\\iota(\\psi) = \\lim_{\\Delta\\phi \\to \\infty} \\frac{1}{\\Delta\\phi} \\int_{0}^{\\Delta\\phi} \\frac{d\\theta}{d\\phi'} d\\phi' = \\frac{\\theta(\\Delta\\phi) - \\theta(0)}{\\Delta\\phi}\n$$\n问题提供了一个通过一阶常微分方程（ODE）描述磁通量面上磁力线动力学的具体模型：\n$$\n\\frac{d\\theta}{d\\phi} = f(\\theta, \\phi) = \\iota_0 + \\varepsilon \\cos(m\\theta - n\\phi)\n$$\n并指定了初始条件 $\\theta(\\phi=0) = 0$。\n\n我们的任务是计算此极限的数值估计。问题通过将无限极限替换为在 $N_{\\mathrm{tor}}$ 次环向圈数上的大范围有限积分，来指定估计量 $\\widehat{\\iota}$。因此，总环向角变化量为 $\\Delta\\phi = 2\\pi N_{\\mathrm{tor}}$。旋转变换的估计量为：\n$$\n\\widehat{\\iota} = \\frac{\\theta(2\\pi N_{\\mathrm{tor}}) - \\theta(0)}{2\\pi N_{\\mathrm{tor}}}\n$$\n为了计算 $\\widehat{\\iota}$，我们必须首先求出在最终环向角 $\\phi_{final} = 2\\pi N_{\\mathrm{tor}}$ 处的角向角 $\\theta$ 的值。这需要求解由该常微分方程和初始条件 $\\theta(0)=0$ 定义的初值问题（IVP）。\n\n由于该常微分方程通常无法解析求解，因此需要使用数值积分方法。问题要求采用固定步长、数值稳定的方法。四阶龙格-库塔（RK4）方法是一个极佳的选择，它为此类问题提供了良好的准确性（全局误差与步长 $h$ 的四次方成正比）和稳定性平衡。\n\nRK4 算法通过将环向角 $\\phi$ 离散化为大小为 $h$ 的小步长来进行。设 $\\phi_i = i \\cdot h$ 且 $\\theta_i \\approx \\theta(\\phi_i)$。为了从 $\\theta_i$ 求得 $\\theta_{i+1}$，RK4 方法计算四个中间斜率：\n\\begin{align*}\nk_1 = h \\cdot f(\\theta_i, \\phi_i) \\\\\nk_2 = h \\cdot f(\\theta_i + k_1/2, \\phi_i + h/2) \\\\\nk_3 = h \\cdot f(\\theta_i + k_2/2, \\phi_i + h/2) \\\\\nk_4 = h \\cdot f(\\theta_i + k_3, \\phi_i + h)\n\\end{align*}\n然后，通过这些斜率的加权平均来找到下一个 $\\theta$ 值：\n$$\n\\theta_{i+1} = \\theta_i + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\n计算给定参数集 $(\\iota_0, \\varepsilon, m, n, N_{\\mathrm{tor}})$ 的 $\\widehat{\\iota}$ 的算法如下：\n1.  **初始化**：设置初始条件 $\\theta = 0$ 和 $\\phi = 0$。定义最终环向角 $\\phi_{final} = 2\\pi N_{\\mathrm{tor}}$。\n2.  **离散化**：选择一个足够小的步长 $h$ 以解析振荡项 $\\cos(m\\theta - n\\phi)$。一个稳健的方法是固定每环向圈的积分步数 $N_{steps\\_per\\_turn}$。例如，$N_{steps\\_per\\_turn} = 2000$ 这样的值可提供高精度。步长则为 $h = 2\\pi / N_{steps\\_per\\_turn}$，总步数为 $N_{total} = N_{\\mathrm{tor}} \\cdot N_{steps\\_per\\_turn}$。\n3.  **积分**：从 $(\\theta, \\phi) = (0, 0)$ 开始，迭代 $N_{total}$ 次。在每次迭代中，使用上述 RK4 公式更新 $\\theta$ 和 $\\phi$。即，从 $\\theta_i$ 计算 $\\theta_{i+1}$，并将 $\\phi_i$ 推进到 $\\phi_{i+1} = \\phi_i + h$。\n4.  **最终计算**：在最后一步之后，计算出的 $\\theta$ 值是 $\\theta(2\\pi N_{\\mathrm{tor}})$ 的一个近似值。使用此最终值计算估计量：\n    $$\n    \\widehat{\\iota} = \\frac{\\theta_{final} - 0}{\\phi_{final}} = \\frac{\\theta_{final}}{2\\pi N_{\\mathrm{tor}}}\n    $$\n此过程直接实现了旋转变换作为长时间平均的定义，该平均是在有限圈数上近似的，并使用标准的、高质量的数值方法来确保所需的准确性和稳定性。$\\widehat{\\iota}$ 收敛到一个稳定值既取决于圈数 $N_{\\mathrm{tor}}$（朝向渐近极限的物理收敛），也取决于每圈的步数（对于给定的 $N_{\\mathrm{tor}}$，向常微分方程真解的数值收敛）。问题中提供的参数，包括 $N_{\\mathrm{tor}}$，被用作问题规范的固定部分。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the rotational transform for a set of test cases by integrating\n    the field line equations using the 4th-order Runge-Kutta method.\n    \"\"\"\n\n    # Define the right-hand side of the ODE: d(theta)/d(phi) = f(theta, phi)\n    def f(theta, phi, iota0, epsilon, m, n):\n        \"\"\"\n        Calculates the rate of change of poloidal angle theta w.r.t. toroidal angle phi.\n        \"\"\"\n        return iota0 + epsilon * np.cos(m * theta - n * phi)\n\n    def calculate_iota_hat(iota0, epsilon, m, n, N_tor):\n        \"\"\"\n        Integrates the ODE for a given test case to find the estimated rotational transform.\n        \n        Args:\n            iota0 (float): Baseline rotational transform.\n            epsilon (float): Perturbation amplitude.\n            m (int): Poloidal mode number.\n            n (int): Toroidal mode number.\n            N_tor (int): Number of toroidal turns for integration.\n\n        Returns:\n            float: The estimated rotational transform iota_hat.\n        \"\"\"\n        # Initial conditions\n        theta_0 = 0.0\n        phi_0 = 0.0\n        \n        # Integration parameters\n        phi_final = 2.0 * np.pi * N_tor\n        \n        # Numerical stability and accuracy are ensured by using a sufficient number\n        # of steps per toroidal turn. 2000 steps provide good convergence.\n        N_steps_per_turn = 2000\n        N_total_steps = int(N_tor * N_steps_per_turn)\n        \n        # Fixed step size\n        h = (phi_final - phi_0) / N_total_steps\n        \n        # Integration loop using 4th-order Runge-Kutta (RK4)\n        theta = theta_0\n        phi = phi_0\n        \n        for _ in range(N_total_steps):\n            k1 = h * f(theta, phi, iota0, epsilon, m, n)\n            k2 = h * f(theta + 0.5 * k1, phi + 0.5 * h, iota0, epsilon, m, n)\n            k3 = h * f(theta + 0.5 * k2, phi + 0.5 * h, iota0, epsilon, m, n)\n            k4 = h * f(theta + k3, phi + h, iota0, epsilon, m, n)\n            \n            theta += (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n            phi += h\n        \n        # Final estimator for the rotational transform\n        iota_hat = (theta - theta_0) / phi_final\n        \n        return iota_hat\n\n    # Test suite as specified in the problem statement\n    test_cases = [\n        # Case 1: (iota0, epsilon, m, n, N_tor)\n        (2.0/3.0, 0.0, 1, 0, 10),\n        # Case 2\n        (np.sqrt(2.0) - 1.0, 0.1, 3, 2, 50),\n        # Case 3\n        (3.0/5.0, 0.3, 2, 1, 40),\n        # Case 4\n        (1.0, 0.4, 1, 1, 60),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_iota_hat(*case)\n        results.append(result)\n\n    # Format the final output string as a list of floats\n    # Rounded to 8 decimal places for consistent output\n    output_str = f\"[{','.join(f'{r:.8f}' for r in results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}