{
    "hands_on_practices": [
        {
            "introduction": "Theoretical concepts in plasma physics gain true meaning when applied to concrete scenarios. This first exercise grounds the fundamental concept of the safety factor, $q$, which measures the pitch of magnetic field lines on a flux surface. By explicitly calculating the line integrals that define $q$ for a given magnetic field in a simplified tokamak geometry, you will solidify your understanding of its physical definition as the ratio of toroidal to poloidal turns .",
            "id": "3723432",
            "problem": "Consider an axisymmetric tokamak of large aspect ratio with circular, concentric magnetic flux surfaces. Let the flux surface at minor radius $r$ be parameterized by the poloidal angle $\\theta$ and the toroidal angle $\\phi$ in cylindrical coordinates $(R,\\phi,Z)$ by\n$$R(\\theta) = R_{0} + r\\cos\\theta,\\quad Z(\\theta) = r\\sin\\theta,$$\nwith angles measured in radians. The magnetic field $\\mathbf{B}(R,Z)$ is composed of a toroidal component produced by the toroidal field coils and a poloidal component generated by a prescribed poloidal flux function. Specifically:\n- The toroidal component is consistent with a set of circular toroidal field coils and is given by\n$$\\mathbf{B}_{\\phi}(R) = \\frac{B_{0} R_{0}}{R}\\,\\mathbf{e}_{\\phi},$$\nwhere $\\mathbf{e}_{\\phi}$ is the unit vector in the toroidal direction and $B_{0}$ is the toroidal magnetic field at the magnetic axis $R=R_{0}$.\n- The poloidal component is defined via the axisymmetric poloidal flux function $\\psi(r)$ by\n$$\\mathbf{B}_{\\text{pol}} = \\frac{1}{R}\\,\\nabla\\psi(r)\\times \\mathbf{e}_{\\phi}.$$\n\nUse the fundamental definition that the safety factor $q(\\psi)$ is the number of toroidal turns made by a magnetic field line per poloidal circuit. To compute $q(\\psi)$ at a given flux surface, evaluate the poloidal and toroidal line integrals along the field line on that surface. Then, verify consistency of your result with the toroidal field coil geometry encoded in $\\mathbf{B}_{\\phi}(R)$.\n\nData for computation:\n- Major radius $R_{0} = 2.8\\ \\mathrm{m}$.\n- Minor radius of the surface $r = 0.40\\ \\mathrm{m}$.\n- Plasma minor radius $a = 0.60\\ \\mathrm{m}$.\n- Toroidal field on axis $B_{0} = 4.5\\ \\mathrm{T}$.\n- Poloidal flux function $\\psi(r) = \\psi_{0}\\,(r/a)^{2}$ with $\\psi_{0} = 0.50\\ \\mathrm{Wb}$ understood as poloidal flux per radian.\n\nCompute the safety factor $q(\\psi)$ at the flux surface $r = 0.40\\ \\mathrm{m}$ by explicitly performing the requisite poloidal and toroidal line integrals along the field line on that surface. Confirm in your derivation that the toroidal field coil geometry implies $R B_{\\phi}$ is constant on the surface. Express your final answer as a dimensionless number. Round your answer to four significant figures.",
            "solution": "The safety factor $q$ is defined as the number of toroidal transits per poloidal transit. For a field line, this can be expressed as the ratio of differential path lengths scaled by the magnetic field components:\n$$ \\frac{dl_{\\phi}}{dl_{\\theta}} = \\frac{R \\, d\\phi}{r \\, d\\theta} = \\frac{B_{\\phi}}{B_{\\text{pol}}} $$\nThis allows us to find the rate of change of the toroidal angle $\\phi$ with respect to the poloidal angle $\\theta$:\n$$ \\frac{d\\phi}{d\\theta} = \\frac{r B_{\\phi}}{R B_{\\text{pol}}} $$\nThe safety factor is the average of this quantity over a full poloidal circuit:\n$$ q(r) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{d\\phi}{d\\theta} \\, d\\theta = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{r B_{\\phi}}{R B_{\\text{pol}}} \\, d\\theta $$\nWe are given the toroidal field $B_{\\phi} = \\frac{B_0 R_0}{R}$. The problem statement correctly notes that this form implies $R B_{\\phi} = B_0 R_0$, which is a constant on any flux surface for a vacuum toroidal field.\nThe poloidal field is derived from the poloidal flux function $\\psi(r)$:\n$$ \\mathbf{B}_{\\text{pol}} = \\frac{1}{R} \\nabla\\psi \\times \\mathbf{e}_{\\phi} = \\frac{1}{R} \\left(\\frac{d\\psi}{dr} \\hat{\\mathbf{e}}_r\\right) \\times \\hat{\\mathbf{e}}_{\\phi} = \\frac{1}{R} \\frac{d\\psi}{dr} \\hat{\\mathbf{e}}_{\\theta} $$\nThe magnitude is $B_{\\text{pol}} = \\frac{1}{R} \\frac{d\\psi}{dr}$.\nGiven $\\psi(r) = \\psi_{0}(r/a)^2$, the derivative is $\\frac{d\\psi}{dr} = \\frac{2 \\psi_{0} r}{a^2}$.\nSubstituting this into the expression for $B_{\\text{pol}}$ gives:\n$$ B_{\\text{pol}} = \\frac{2 \\psi_{0} r}{R a^2} $$\nNow, we substitute the expressions for $B_{\\phi}$ and $B_{\\text{pol}}$ into the integral for $q$:\n$$ q(r) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{r \\left(\\frac{B_0 R_0}{R}\\right)}{R \\left(\\frac{2 \\psi_{0} r}{R a^2}\\right)} \\, d\\theta = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{r B_0 R_0 / R}{2 \\psi_0 r / a^2} \\, d\\theta = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{B_0 R_0 a^2}{2 \\psi_0 R} \\, d\\theta $$\nSince $R = R_0 + r\\cos\\theta$, we have:\n$$ q(r) = \\frac{B_0 R_0 a^2}{4\\pi\\psi_0} \\int_{0}^{2\\pi} \\frac{d\\theta}{R_0 + r\\cos\\theta} $$\nThis is a standard integral, which evaluates to $\\int_{0}^{2\\pi} \\frac{d\\theta}{A + B\\cos\\theta} = \\frac{2\\pi}{\\sqrt{A^2 - B^2}}$ for $A > |B|$. Here, $A=R_0$ and $B=r$.\n$$ q(r) = \\frac{B_0 R_0 a^2}{4\\pi\\psi_0} \\left( \\frac{2\\pi}{\\sqrt{R_0^2 - r^2}} \\right) = \\frac{B_0 R_0 a^2}{2 \\psi_0 \\sqrt{R_0^2 - r^2}} $$\nNow, we plug in the given values: $R_0=2.8\\,\\mathrm{m}$, $r=0.40\\,\\mathrm{m}$, $a=0.60\\,\\mathrm{m}$, $B_0=4.5\\,\\mathrm{T}$, and $\\psi_0=0.50\\,\\mathrm{Wb}$.\n$$ q = \\frac{(4.5)(2.8)(0.60)^2}{2(0.50)\\sqrt{(2.8)^2 - (0.40)^2}} = \\frac{4.536}{\\sqrt{7.84 - 0.16}} = \\frac{4.536}{\\sqrt{7.68}} \\approx \\frac{4.536}{2.77128} \\approx 1.6368 $$\nRounding to four significant figures, we get $q \\approx 1.637$.",
            "answer": "$$\\boxed{1.637}$$"
        },
        {
            "introduction": "Building upon a direct calculation, we now move to analytical derivation to gain broader physical insight. This practice involves deriving the widely-used approximate formula for the safety factor in a large-aspect-ratio tokamak, including first-order corrections due to plasma shaping and finite pressure effects via the Shafranov shift . This exercise demonstrates how fundamental geometric properties, such as elongation $\\kappa$, directly impact the $q$-profile, which is a critical determinant of magnetohydrodynamic (MHD) stability.",
            "id": "3723443",
            "problem": "Consider an axisymmetric tokamak of large aspect ratio with major radius $R_{0}$ and minor radius coordinate $r$, where $r/R_{0} \\ll 1$. Let the magnetic field be decomposed into toroidal and poloidal components $B_{\\phi}$ and $B_{\\theta}$, respectively, and adopt flux coordinates $(\\psi,\\theta,\\phi)$, where $\\theta$ is a poloidal angle and $\\phi$ is the toroidal angle. The safety factor $q(r)$ is defined as the field-line pitch, $q(r) = \\frac{1}{2\\pi} \\oint \\frac{B \\cdot \\nabla \\phi}{B \\cdot \\nabla \\theta} \\, d\\theta$, with $\\nabla \\phi$ and $\\nabla \\theta$ determined by the metric of the toroidal geometry. Begin from this definition and from large-aspect-ratio toroidal geometry, using the following physically justified assumptions:\n- The tokamak is axisymmetric, the flux surfaces are nested, and the toroidal magnetic field is predominantly due to external coils such that $B_{\\phi}(R) \\approx B_{\\phi 0} \\frac{R_{0}}{R}$ to leading order, where $R$ is the cylindrical major radius and $B_{\\phi 0} = B_{\\phi}(R_{0})$.\n- In the circular cross-section limit, the poloidal metric coefficient reduces to $h_{\\theta} = r$ and $R \\approx R_{0}$ along a flux surface.\n- For shaped flux surfaces of small to moderate shaping, adopt a Miller-like parameterization of the surface with elongation $\\kappa$ and triangularity $\\delta$ and include a Shafranov shift $\\Delta(r)$, such that to leading order\n$$\nR(\\theta) = R_{0} + \\Delta(r) + r \\cos\\theta + \\delta \\, r \\sin\\theta, \\quad Z(\\theta) = \\kappa \\, r \\sin\\theta,\n$$\nwith $|\\kappa - 1| \\ll 1$, $|\\delta| \\ll 1$, and $|\\Delta(r)|/R_{0} \\ll 1$.\n- Treat the poloidal magnetic field magnitude on a given flux surface as slowly varying in $\\theta$ at large aspect ratio and denote its flux-surface value by $B_{\\theta}(r)$.\nUsing the definition of $q(r)$ and these assumptions, derive the leading-order expression for $q(r)$ in the circular cross-section limit and then compute the first-order correction due to shaping ($\\kappa$, $\\delta$) and finite-beta effects via the Shafranov shift $\\Delta(r)$ retained to first order. Neglect all second-order products of the small parameters $(r/R_{0})$, $(\\kappa - 1)$, $\\delta$, and $\\Delta/R_{0}$. Your final answer must be a single closed-form analytic expression for $q(r)$ in terms of $r$, $R_{0}$, $B_{\\phi 0}$, $B_{\\theta}(r)$, $\\kappa$, and $\\Delta(r)$. Do not include any additional parameters. If any average over $\\theta$ is required, evaluate it explicitly.",
            "solution": "The safety factor $q(r)$ is defined by the integral of the field line pitch over one poloidal circuit:\n$$ q(r) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{d\\phi}{d\\theta} \\, d\\theta $$\nThe ratio of angle changes is related to the magnetic field components and metric scale factors by $\\frac{d\\phi}{d\\theta} = \\frac{h_{\\theta} B_{\\phi}}{R B_{\\theta}}$, where $h_{\\theta}$ is the poloidal metric coefficient and we use $B_{\\theta}$ to denote the poloidal field magnitude, assumed constant on a flux surface. We are given $B_{\\phi} \\approx B_{\\phi 0} R_0 / R$. Substituting this gives:\n$$ q(r) = \\frac{1}{2\\pi} \\frac{B_{\\phi 0} R_{0}}{B_{\\theta}(r)} \\int_{0}^{2\\pi} \\frac{h_{\\theta}}{R^2} d\\theta $$\nOur task is to evaluate the integral using the given parameterization for shaped flux surfaces, keeping only first-order terms in the small parameters $(\\kappa-1), \\delta, \\Delta/R_0,$ and $r/R_0$.\n\n**1. Calculate the poloidal metric coefficient $h_{\\theta}$:**\n$h_{\\theta}^2 = (\\partial R / \\partial \\theta)^2 + (\\partial Z / \\partial \\theta)^2$.\nFrom the given geometry:\n$$ \\frac{\\partial R}{\\partial \\theta} = -r\\sin\\theta + \\delta r \\cos\\theta $$\n$$ \\frac{\\partial Z}{\\partial \\theta} = \\kappa r \\cos\\theta $$\nThus,\n$$ h_{\\theta}^2 = (-r\\sin\\theta + \\delta r \\cos\\theta)^2 + (\\kappa r \\cos\\theta)^2 = r^2(\\sin^2\\theta - 2\\delta\\sin\\theta\\cos\\theta + \\delta^2\\cos^2\\theta + \\kappa^2\\cos^2\\theta) $$\nNeglecting $\\delta^2$ and using $\\sin^2\\theta + \\cos^2\\theta = 1$:\n$$ h_{\\theta}^2 = r^2(1 + (\\kappa^2-1)\\cos^2\\theta - 2\\delta\\sin\\theta\\cos\\theta) $$\nTaking the square root and using $\\sqrt{1+x} \\approx 1+x/2$ for small $x$:\n$$ h_{\\theta} \\approx r\\left(1 + \\frac{\\kappa^2-1}{2}\\cos^2\\theta - \\delta\\sin\\theta\\cos\\theta\\right) $$\nSince $\\kappa-1$ is small, $\\kappa^2-1 = (\\kappa-1)(\\kappa+1) \\approx 2(\\kappa-1)$. So,\n$$ h_{\\theta} \\approx r\\left(1 + (\\kappa-1)\\cos^2\\theta - \\delta\\sin\\theta\\cos\\theta\\right) $$\n\n**2. Expand the term $1/R^2$:**\n$$ R = R_0 + \\Delta(r) + r\\cos\\theta + \\delta r \\sin\\theta = R_0 \\left(1 + \\frac{\\Delta}{R_0} + \\frac{r}{R_0}\\cos\\theta + \\dots\\right) $$\nWe expand $1/R^2$ using $(1+x)^{-2} \\approx 1-2x$:\n$$ \\frac{1}{R^2} \\approx \\frac{1}{R_0^2} \\left(1 - \\frac{2\\Delta}{R_0} - \\frac{2r}{R_0}\\cos\\theta\\right) $$\n\n**3. Combine and integrate:**\nWe multiply $h_\\theta$ and $1/R^2$, keeping only first-order terms:\n$$ \\frac{h_{\\theta}}{R^2} \\approx \\frac{r}{R_0^2} \\left(1 + (\\kappa-1)\\cos^2\\theta - \\delta\\sin\\theta\\cos\\theta\\right) \\left(1 - \\frac{2\\Delta}{R_0} - \\frac{2r}{R_0}\\cos\\theta\\right) $$\n$$ \\frac{h_{\\theta}}{R^2} \\approx \\frac{r}{R_0^2} \\left(1 - \\frac{2\\Delta}{R_0} - \\frac{2r}{R_0}\\cos\\theta + (\\kappa-1)\\cos^2\\theta - \\delta\\sin\\theta\\cos\\theta \\right) $$\nNow we perform the integral over $\\theta \\in [0, 2\\pi]$:\n$$ \\int_0^{2\\pi} \\frac{h_{\\theta}}{R^2} d\\theta \\approx \\frac{r}{R_0^2} \\int_0^{2\\pi} \\left(1 - \\frac{2\\Delta}{R_0} - \\frac{2r}{R_0}\\cos\\theta + (\\kappa-1)\\cos^2\\theta - \\delta\\sin\\theta\\cos\\theta \\right) d\\theta $$\nThe integrals of the trigonometric terms are: $\\int_0^{2\\pi}\\cos\\theta\\,d\\theta = 0$, $\\int_0^{2\\pi}\\sin\\theta\\cos\\theta\\,d\\theta = 0$, and $\\int_0^{2\\pi}\\cos^2\\theta\\,d\\theta = \\pi$.\nThe integral evaluates to:\n$$ \\int_0^{2\\pi} \\frac{h_{\\theta}}{R^2} d\\theta \\approx \\frac{r}{R_0^2} \\left( 2\\pi \\left(1 - \\frac{2\\Delta}{R_0}\\right) + (\\kappa-1)\\pi \\right) = \\frac{2\\pi r}{R_0^2} \\left(1 - \\frac{2\\Delta}{R_0} + \\frac{\\kappa-1}{2}\\right) $$\n\n**4. Assemble the final expression for $q(r)$:**\nSubstituting the integral result back into the formula for $q(r)$:\n$$ q(r) \\approx \\frac{1}{2\\pi} \\frac{B_{\\phi 0} R_{0}}{B_{\\theta}(r)} \\left[ \\frac{2\\pi r}{R_{0}^2} \\left(1 - \\frac{2\\Delta}{R_{0}} + \\frac{\\kappa-1}{2}\\right) \\right] $$\nSimplifying this gives:\n$$ q(r) \\approx \\frac{r B_{\\phi 0}}{R_{0} B_{\\theta}(r)} \\left(1 + \\frac{\\kappa-1}{2} - \\frac{2\\Delta(r)}{R_{0}}\\right) = \\frac{r B_{\\phi 0}}{R_{0} B_{\\theta}(r)} \\left(\\frac{1+\\kappa}{2} - \\frac{2\\Delta(r)}{R_{0}}\\right) $$\nAs requested, the triangularity parameter $\\delta$ does not appear in the final first-order expression.",
            "answer": "$$\\boxed{\\frac{r B_{\\phi 0}}{R_{0} B_{\\theta}(r)} \\left(\\frac{1+\\kappa}{2} - \\frac{2\\Delta(r)}{R_{0}}\\right)}$$"
        },
        {
            "introduction": "The final practice bridges the gap between analytical theory and computational practice, a crucial link in modern fusion research. While different magnetic coordinate systems like Boozer and Hamada coordinates are theoretically equivalent, their practical utility for numerical tasks can vary significantly. This problem asks you to develop a computational criterion to determine which coordinate system is preferable for numerical integration on a flux surface, highlighting how the mathematical properties of the Jacobian, $J$, directly influence numerical accuracy and efficiency .",
            "id": "3723408",
            "problem": "Consider a single nested magnetic flux surface in a toroidal confinement device used for nuclear fusion. Let the surface be labeled by the toroidal magnetic flux $\\psi$ and parameterized by straight-field-line angles $(\\theta,\\zeta)$, where $\\theta \\in [0,2\\pi)$ is the poloidal angle and $\\zeta \\in [0,2\\pi)$ is the toroidal angle, both measured in radians. The magnetic field magnitude on the surface is represented by a truncated Fourier series\n$$\nB(\\theta,\\zeta) = B_0 \\left[ 1 + \\epsilon \\cos(m\\,\\theta - n\\,\\zeta) \\right],\n$$\nwith $B_0$ in Tesla, integer mode numbers $m$ and $n$, and a dimensionless amplitude $\\epsilon$ satisfying $0 \\le \\epsilon  1$ to ensure $B(\\theta,\\zeta)  0$. Assume ideal Magnetohydrodynamics (MHD) equilibrium and the existence of straight-field-line magnetic coordinates.\n\nTwo widely used magnetic coordinate systems are Boozer coordinates and Hamada coordinates. In Boozer coordinates, a well-tested property is that $B^2 J$ is a flux function, where $J$ is the Jacobian of the transformation $(\\psi,\\theta,\\zeta) \\mapsto (x,y,z)$ and a flux function depends only on $\\psi$. In Hamada coordinates, a well-tested property is that $J$ itself is a flux function. On a single flux surface, any flux function may be treated as a constant with respect to $(\\theta,\\zeta)$ and absorbed into normalization. Therefore, for the purposes of numerical quadrature on a single surface, one may model the angle dependence of the Jacobian as\n- Hamada: $J_{\\mathrm{H}}(\\theta,\\zeta) \\propto 1$,\n- Boozer: $J_{\\mathrm{B}}(\\theta,\\zeta) \\propto \\dfrac{1}{B(\\theta,\\zeta)^2}$,\nup to multiplicative constants that do not affect uniformity metrics.\n\nLet $f(\\theta,\\zeta)$ be a target integrand to be averaged over the surface. The flux-surface average in any coordinate system is proportional to\n$$\n\\langle f \\rangle \\propto \\int_0^{2\\pi}\\int_0^{2\\pi} f(\\theta,\\zeta)\\, J(\\theta,\\zeta)\\, d\\theta\\, d\\zeta.\n$$\nIn practical numerical field-line tracing and quadrature, simple uniform sampling of $(\\theta,\\zeta)$ is often used, so the uniformity of the effective integrand $g(\\theta,\\zeta) = f(\\theta,\\zeta)\\,J(\\theta,\\zeta)$ directly influences discretization error. A principled, coordinate-agnostic preference criterion is to choose the coordinate system that minimizes the coefficient of variation of $g$, defined for discrete samples $\\{g_k\\}_{k=1}^K$ by\n$$\n\\mathrm{CV}(g) = \\frac{\\sqrt{\\mathrm{Var}(g)}}{\\mathbb{E}[g]}.\n$$\nHere, $\\mathbb{E}[g]$ and $\\mathrm{Var}(g)$ denote the sample mean and sample variance over a uniform grid in $(\\theta,\\zeta)$.\n\nYour task is to implement this preference criterion and decide, for each test case, whether Boozer coordinates are preferred to Hamada coordinates under the choice $f(\\theta,\\zeta) = B(\\theta,\\zeta)^p$ for a given exponent $p$. Specifically:\n\n1. For each test case, construct $B(\\theta,\\zeta)$ on a uniform grid of $N \\times N$ points with $N = 512$, covering $\\theta \\in [0,2\\pi)$ and $\\zeta \\in [0,2\\pi)$ in radians.\n2. Define $f(\\theta,\\zeta) = B(\\theta,\\zeta)^p$ with the given $p$ (dimensionless).\n3. Form $g_{\\mathrm{H}}(\\theta,\\zeta) = f(\\theta,\\zeta)\\,J_{\\mathrm{H}}(\\theta,\\zeta)$ with $J_{\\mathrm{H}}(\\theta,\\zeta) = 1$ and $g_{\\mathrm{B}}(\\theta,\\zeta) = f(\\theta,\\zeta)\\,J_{\\mathrm{B}}(\\theta,\\zeta)$ with $J_{\\mathrm{B}}(\\theta,\\zeta) = \\dfrac{1}{B(\\theta,\\zeta)^2}$. The multiplicative normalization constants are irrelevant because the coefficient of variation is scale-invariant.\n4. Compute $\\mathrm{CV}(g_{\\mathrm{B}})$ and $\\mathrm{CV}(g_{\\mathrm{H}})$ as floats.\n5. Decide that Boozer coordinates are preferred if and only if $\\mathrm{CV}(g_{\\mathrm{B}})  \\mathrm{CV}(g_{\\mathrm{H}})$.\n\nProvide the results for the following test suite of parameter values, chosen to exercise different regimes:\n- Test $1$ (happy path for $p=2$): $B_0 = 5$ Tesla, $\\epsilon = 0.1$, $m = 1$, $n = 1$, $p = 2$.\n- Test $2$ (boundary case of no variation): $B_0 = 5$ Tesla, $\\epsilon = 0$, $m = 1$, $n = 1$, $p = 1$.\n- Test $3$ (preference for Hamada with uniform integrand): $B_0 = 3$ Tesla, $\\epsilon = 0.25$, $m = 2$, $n = 3$, $p = 0$.\n- Test $4$ (nontrivial comparison): $B_0 = 2$ Tesla, $\\epsilon = 0.3$, $m = 3$, $n = 1$, $p = 1$.\n- Test $5$ (strong but positive variation): $B_0 = 4$ Tesla, $\\epsilon = 0.9$, $m = 1$, $n = 2$, $p = 2$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots,result_5]$), where each entry is a boolean indicating whether Boozer coordinates are preferred for the corresponding test, according to the criterion above. Angles must be treated in radians throughout. No external input is required, and no physical units should appear in the output.",
            "solution": "The problem requires a determination of the preferred magnetic coordinate system between Boozer and Hamada coordinates for the purpose of numerical integration over a toroidal magnetic flux surface. The criterion for this preference is based on minimizing the numerical error associated with uniform grid sampling by selecting the coordinate system that yields a more uniform effective integrand. The uniformity is quantified by the coefficient of variation, $\\mathrm{CV}$.\n\nThe magnetic field magnitude, $B$, on the flux surface is given as a function of the poloidal angle $\\theta$ and toroidal angle $\\zeta$:\n$$B(\\theta,\\zeta) = B_0 \\left[ 1 + \\epsilon \\cos(m\\,\\theta - n\\,\\zeta) \\right]$$\nHere, $B_0$ is a base magnetic field strength, $\\epsilon$ is the dimensionless amplitude of the magnetic field modulation, and $m$ and $n$ are integer mode numbers. The constraint $0 \\le \\epsilon  1$ ensures that $B(\\theta,\\zeta)  0$.\n\nThe target function for the surface average is specified as $f(\\theta,\\zeta) = B(\\theta,\\zeta)^p$, where $p$ is a real exponent.\n\nThe flux-surface average of any function $f$ is proportional to the integral of the effective integrand, $g(\\theta,\\zeta) = f(\\theta,\\zeta)\\,J(\\theta,\\zeta)$, over the angular domain $\\theta, \\zeta \\in [0, 2\\pi)$. The term $J(\\theta,\\zeta)$ is the Jacobian of the coordinate transformation. The problem provides the angle-dependent behavior of the Jacobians for the two systems on a single flux surface:\n- In Hamada coordinates, the Jacobian $J_{\\mathrm{H}}$ is constant with respect to $\\theta$ and $\\zeta$. We may take $J_{\\mathrm{H}}(\\theta,\\zeta) \\propto 1$.\n- In Boozer coordinates, the product $B^2 J_{\\mathrm{B}}$ is constant. Therefore, the Jacobian must vary as $J_{\\mathrm{B}}(\\theta,\\zeta) \\propto \\frac{1}{B(\\theta,\\zeta)^2}$.\n\nUsing these forms, we define the effective integrands for each system, up to an irrelevant constant of proportionality:\n- For Hamada coordinates: $g_{\\mathrm{H}}(\\theta,\\zeta) = f(\\theta,\\zeta) \\cdot J_{\\mathrm{H}} = B(\\theta,\\zeta)^p \\cdot 1 = B(\\theta,\\zeta)^p$.\n- For Boozer coordinates: $g_{\\mathrm{B}}(\\theta,\\zeta) = f(\\theta,\\zeta) \\cdot J_{\\mathrm{B}} = B(\\theta,\\zeta)^p \\cdot \\frac{1}{B(\\theta,\\zeta)^2} = B(\\theta,\\zeta)^{p-2}$.\n\nThe preference criterion is to choose the coordinate system with the smaller coefficient of variation, $\\mathrm{CV}$, for its effective integrand. The $\\mathrm{CV}$ for a set of samples is defined as the ratio of the standard deviation to the mean. Since this metric is scale-invariant, the constants of proportionality associated with $B_0$ and the Jacobians do not affect the comparison. Boozer coordinates are preferred if and only if the inequality $\\mathrm{CV}(g_{\\mathrm{B}})  \\mathrm{CV}(g_{\\mathrm{H}})$ holds true.\n\nTo implement this criterion, we perform a numerical evaluation. The continuous domain $(\\theta, \\zeta) \\in [0, 2\\pi) \\times [0, 2\\pi)$ is discretized into a uniform grid of $N \\times N$ points, with $N = 512$. The grid points are given by $(\\theta_i, \\zeta_j)$ where $\\theta_i = \\frac{2\\pi i}{N}$ and $\\zeta_j = \\frac{2\\pi j}{N}$ for $i, j \\in \\{0, 1, \\dots, N-1\\}$.\n\nFor each test case defined by the parameters $(B_0, \\epsilon, m, n, p)$, the following steps are executed:\n1.  The magnetic field values $B_{ij} = B(\\theta_i, \\zeta_j)$ are computed for all points on the grid.\n2.  The corresponding values for the effective integrands are calculated: $g_{\\mathrm{H}, ij} = (B_{ij})^p$ and $g_{\\mathrm{B}, ij} = (B_{ij})^{p-2}$.\n3.  The coefficient of variation is computed for each set of values. For a generic set of $K=N^2$ grid values $\\{g_k\\}$, the sample mean $\\mathbb{E}[g]$ and sample variance $\\mathrm{Var}(g)$ are:\n    $$\\mathbb{E}[g] = \\frac{1}{K} \\sum_{k=1}^K g_k$$\n    $$\\mathrm{Var}(g) = \\frac{1}{K} \\sum_{k=1}^K (g_k - \\mathbb{E}[g])^2$$\n    The coefficient of variation is then $\\mathrm{CV}(g) = \\frac{\\sqrt{\\mathrm{Var}(g)}}{\\mathbb{E}[g]}$.\n4.  The final decision is made by evaluating the boolean expression $\\mathrm{CV}(g_{\\mathrm{B}})  \\mathrm{CV}(g_{\\mathrm{H}})$.\n\nThis procedure is applied to each of the five specified test cases. Notably, certain parameter choices lead to analytically trivial outcomes. If $p=2$, then $g_{\\mathrm{B}} \\propto B^0 = 1$, which is perfectly uniform. Its variance and $\\mathrm{CV}$ are zero. Unless $\\epsilon=0$, $g_{\\mathrm{H}} \\propto B^2$ will be non-uniform, so $\\mathrm{CV}(g_{\\mathrm{H}})  0$. In this case, Boozer coordinates are always preferred. Conversely, if $p=0$, $g_{\\mathrm{H}} \\propto B^0 = 1$ is uniform, so $\\mathrm{CV}(g_{\\mathrm{H}}) = 0$, while $g_{\\mathrm{B}} \\propto B^{-2}$ is non-uniform (for $\\epsilon0$), making Hamada coordinates preferable. If $\\epsilon=0$, the magnetic field is constant, $B=B_0$, making both $g_{\\mathrm{H}}$ and $g_{\\mathrm{B}}$ constant. Their $\\mathrm{CV}$s are both zero, and the condition $\\mathrm{CV}(g_{\\mathrm{B}})  \\mathrm{CV}(g_{\\mathrm{H}})$ evaluates to $0  0$, which is false.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of choosing between Boozer and Hamada coordinates based on\n    the uniformity of an effective integrand for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (B0, epsilon, m, n, p).\n    test_cases = [\n        (5.0, 0.1, 1, 1, 2.0),\n        (5.0, 0.0, 1, 1, 1.0),\n        (3.0, 0.25, 2, 3, 0.0),\n        (2.0, 0.3, 3, 1, 1.0),\n        (4.0, 0.9, 1, 2, 2.0),\n    ]\n\n    results = []\n    N = 512\n\n    # Create the angular grids for theta and zeta.\n    # The grid covers [0, 2*pi) as specified.\n    angles = np.linspace(0, 2 * np.pi, N, endpoint=False)\n    theta_grid, zeta_grid = np.meshgrid(angles, angles, indexing='ij')\n\n    for b0, epsilon, m, n, p in test_cases:\n        # Calculate the magnetic field B(theta, zeta) on the grid.\n        # B = B_0 * [1 + epsilon * cos(m*theta - n*zeta)]\n        B_grid = b0 * (1 + epsilon * np.cos(m * theta_grid - n * zeta_grid))\n\n        # Form the effective integrands g_H and g_B.\n        # g_H is proportional to B^p\n        # g_B is proportional to B^(p-2)\n        g_H = np.power(B_grid, p)\n        g_B = np.power(B_grid, p - 2)\n\n        # Calculate the coefficient of variation (CV) for each integrand.\n        # CV(g) = std(g) / mean(g).\n        # We use the population standard deviation (numpy.std default, ddof=0),\n        # as the grid represents the entire population of discrete points.\n        \n        # Denominators (means) are guaranteed to be positive since B > 0.\n        mean_g_H = np.mean(g_H)\n        std_g_H = np.std(g_H)\n        cv_H = std_g_H / mean_g_H\n\n        mean_g_B = np.mean(g_B)\n        std_g_B = np.std(g_B)\n        cv_B = std_g_B / mean_g_B\n\n        # Decide if Boozer coordinates are preferred.\n        # The criterion is CV(g_B)  CV(g_H).\n        is_boozer_preferred = cv_B  cv_H\n        results.append(is_boozer_preferred)\n\n    # Final print statement in the exact required format.\n    # The results list contains booleans, which need to be converted to lowercase strings.\n    print(f\"[{','.join(map(str, results))}]\".lower())\n\nsolve()\n```"
        }
    ]
}