{
    "hands_on_practices": [
        {
            "introduction": "The defining characteristic of a force-free magnetic field is the perfect alignment between the electric current density $\\mathbf{J}$ and the magnetic field $\\mathbf{B}$. This exercise introduces the crucial scalar function $\\alpha(\\mathbf{r})$, which serves as the direct, quantitative measure of this parallelism. By first demonstrating its physical meaning and then calculating it for the foundational case of a Beltrami field, you will solidify your understanding of the mathematical structure that underpins all force-free equilibria.",
            "id": "3699872",
            "problem": "In a magnetically confined nuclear fusion plasma, consider a magnetostatic state in which the displacement current can be neglected and the electric field is stationary. The fundamental starting points are Maxwell–Ampère’s law without displacement current, $\\nabla \\times \\mathbf{B} = \\mu_{0}\\,\\mathbf{J}$, and the magnetohydrodynamic (MHD) force balance $\\nabla p + \\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$, where $\\mu_{0}$ is the vacuum permeability and $p$ is the plasma pressure. Define the scalar\n$$\\alpha(\\mathbf{r}) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r})}{|\\mathbf{B}(\\mathbf{r})|^{2}}.$$\nFirst, starting only from the stated fundamental laws, demonstrate that $\\alpha(\\mathbf{r})$ provides a direct measure of current alignment with the magnetic field in the sense that it isolates the component of $\\mathbf{J}$ parallel to $\\mathbf{B}$ and vanishes when $\\mathbf{J}$ is everywhere perpendicular to $\\mathbf{B}$. Then, in the context of a long, straight, axisymmetric cylindrical plasma column of radius $a$ representing a high–magnetic-Reynolds-number relaxed state, consider a Beltrami magnetic field, defined by $\\nabla \\times \\mathbf{B} = \\lambda\\,\\mathbf{B}$ with constant scalar $\\lambda$. Assume the field is independent of axial coordinate and azimuth, with cylindrical components $\\mathbf{B}(r) = B_{r}(r)\\,\\hat{\\mathbf{e}}_{r} + B_{\\theta}(r)\\,\\hat{\\mathbf{e}}_{\\theta} + B_{z}(r)\\,\\hat{\\mathbf{e}}_{z}$, and that the field remains finite at $r=0$. Compute $\\alpha(r)$ for this axisymmetric cylindrical Beltrami field. Express your final answer in $\\mathrm{m}^{-1}$ as a single closed-form expression. No rounding is required.",
            "solution": "The problem is divided into two parts. The first part requires a demonstration of the physical meaning of the scalar function $\\alpha(\\mathbf{r})$. The second part requires the computation of $\\alpha(\\mathbf{r})$ for a specific physical system: an axisymmetric cylindrical Beltrami magnetic field.\n\n**Part 1: The Physical Interpretation of $\\alpha(\\mathbf{r})$**\n\nThe scalar function is defined as:\n$$\n\\alpha(\\mathbf{r}) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r})}{|\\mathbf{B}(\\mathbf{r})|^{2}}\n$$\nTo understand its physical meaning, we decompose the current density vector $\\mathbf{J}(\\mathbf{r})$ into two components: one parallel to the magnetic field $\\mathbf{B}(\\mathbf{r})$, denoted $\\mathbf{J}_{\\|}(\\mathbf{r})$, and one perpendicular to it, denoted $\\mathbf{J}_{\\perp}(\\mathbf{r})$.\n$$\n\\mathbf{J}(\\mathbf{r}) = \\mathbf{J}_{\\|}(\\mathbf{r}) + \\mathbf{J}_{\\perp}(\\mathbf{r})\n$$\nBy definition, the parallel component $\\mathbf{J}_{\\|}$ is the projection of $\\mathbf{J}$ onto the direction of $\\mathbf{B}$. The direction of $\\mathbf{B}$ is given by the unit vector $\\hat{\\mathbf{b}} = \\frac{\\mathbf{B}}{|\\mathbf{B}|}$. The projection is thus:\n$$\n\\mathbf{J}_{\\|} = (\\mathbf{J} \\cdot \\hat{\\mathbf{b}})\\hat{\\mathbf{b}} = \\left(\\mathbf{J} \\cdot \\frac{\\mathbf{B}}{|\\mathbf{B}|}\\right) \\frac{\\mathbf{B}}{|\\mathbf{B}|} = \\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\mathbf{B}\n$$\nThe perpendicular component $\\mathbf{J}_{\\perp}$ is defined such that $\\mathbf{J}_{\\perp} \\cdot \\mathbf{B} = 0$.\n\nNow, let's substitute the decomposition $\\mathbf{J} = \\mathbf{J}_{\\|} + \\mathbf{J}_{\\perp}$ into the definition of $\\alpha(\\mathbf{r})$:\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{(\\mathbf{J}_{\\|} + \\mathbf{J}_{\\perp}) \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}} = \\mu_{0}\\,\\frac{\\mathbf{J}_{\\|} \\cdot \\mathbf{B} + \\mathbf{J}_{\\perp} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\n$$\nSince $\\mathbf{J}_{\\perp} \\cdot \\mathbf{B} = 0$ by definition, the expression simplifies to:\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{\\mathbf{J}_{\\|} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\n$$\nThis shows that $\\alpha(\\mathbf{r})$ depends exclusively on the component of the current density that is parallel to the magnetic field. It effectively isolates the contribution of $\\mathbf{J}_{\\|}$.\n\nFurthermore, we can rearrange the expression for $\\mathbf{J}_{\\|}$:\n$$\n\\mathbf{J}_{\\|} = \\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\mathbf{B}\n$$\nMultiplying by $\\mu_{0}$ on both sides and comparing with the definition of $\\alpha(\\mathbf{r})$:\n$$\n\\mu_{0}\\,\\mathbf{J}_{\\|} = \\left(\\mu_{0}\\,\\frac{\\mathbf{J} \\cdot \\mathbf{B}}{|\\mathbf{B}|^{2}}\\right)\\mathbf{B} = \\alpha(\\mathbf{r})\\,\\mathbf{B}\n$$\nThis relationship, $\\mu_{0}\\,\\mathbf{J}_{\\|} = \\alpha(\\mathbf{r})\\,\\mathbf{B}$, demonstrates that $\\alpha(\\mathbf{r})$ is the scalar of proportionality between the magnetic field $\\mathbf{B}$ and the parallel current density $\\mathbf{J}_{\\|}$ (scaled by $\\mu_{0}$). Thus, $\\alpha(\\mathbf{r})$ is a direct measure of the alignment of the current with the magnetic field.\n\nFinally, we must demonstrate that $\\alpha(\\mathbf{r})$ vanishes when $\\mathbf{J}$ is everywhere perpendicular to $\\mathbf{B}$. If $\\mathbf{J} \\perp \\mathbf{B}$ at all points $\\mathbf{r}$, then their scalar product is zero:\n$$\n\\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r}) = 0\n$$\nSubstituting this into the definition of $\\alpha(\\mathbf{r})$:\n$$\n\\alpha(\\mathbf{r}) = \\mu_{0}\\,\\frac{0}{|\\mathbf{B}(\\mathbf{r})|^{2}} = 0\n$$\n(assuming a non-trivial magnetic field, $|\\mathbf{B}(\\mathbf{r})| \\neq 0$). This completes the first part of the problem.\n\n**Part 2: Calculation of $\\alpha(r)$ for an Axisymmetric Cylindrical Beltrami Field**\n\nFor the second part, we are given a Beltrami magnetic field, which is defined by the property:\n$$\n\\nabla \\times \\mathbf{B} = \\lambda\\,\\mathbf{B}\n$$\nwhere $\\lambda$ is a constant scalar. The units of $\\nabla \\times$ are inverse length ($L^{-1}$), so the units of $\\lambda$ must be $L^{-1}$ (e.g., $\\mathrm{m}^{-1}$) for the equation to be dimensionally consistent.\n\nThe problem also provides the magnetostatic Maxwell–Ampère’s law:\n$$\n\\nabla \\times \\mathbf{B} = \\mu_{0}\\,\\mathbf{J}\n$$\nBy equating these two expressions for $\\nabla \\times \\mathbf{B}$, we establish a direct relationship between the current density $\\mathbf{J}$ and the magnetic field $\\mathbf{B}$ for a Beltrami field:\n$$\n\\mu_{0}\\,\\mathbf{J} = \\lambda\\,\\mathbf{B}\n$$\nThis can be rearranged to express $\\mathbf{J}$ in terms of $\\mathbf{B}$:\n$$\n\\mathbf{J}(\\mathbf{r}) = \\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}(\\mathbf{r})\n$$\nThis equation shows that for a Beltrami field with constant $\\lambda$, the current density vector $\\mathbf{J}$ is everywhere collinear (parallel) with the magnetic field vector $\\mathbf{B}$. In this case, the perpendicular component of the current density, $\\mathbf{J}_{\\perp}$, is zero. This configuration is known as a linear force-free field, because the Lorentz force density $\\mathbf{J} \\times \\mathbf{B} = \\left(\\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}\\right) \\times \\mathbf{B} = \\frac{\\lambda}{\\mu_{0}}\\,(\\mathbf{B} \\times \\mathbf{B}) = \\mathbf{0}$. From the given MHD force balance $\\nabla p + \\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$, this implies $\\nabla p = \\mathbf{0}$, so the plasma pressure is uniform.\n\nNow we compute $\\alpha(r)$ using its definition. All the detailed assumptions about the cylindrical geometry (axisymmetry, independence from $z$ and $\\theta$) are not required for this specific calculation, as the relationship $\\mathbf{J} = (\\lambda/\\mu_{0})\\mathbf{B}$ holds generally for any Beltrami field.\n$$\n\\alpha(r) \\equiv \\mu_{0}\\,\\frac{\\mathbf{J}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\nSubstitute the expression for $\\mathbf{J}(r)$ derived from the Beltrami condition:\n$$\n\\alpha(r) = \\mu_{0}\\,\\frac{\\left(\\frac{\\lambda}{\\mu_{0}}\\,\\mathbf{B}(r)\\right) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\nWe can factor out the scalar constants:\n$$\n\\alpha(r) = \\mu_{0}\\,\\frac{\\lambda}{\\mu_{0}}\\,\\frac{\\mathbf{B}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\nThe vacuum permeability constants $\\mu_{0}$ cancel out:\n$$\n\\alpha(r) = \\lambda\\,\\frac{\\mathbf{B}(r) \\cdot \\mathbf{B}(r)}{|\\mathbf{B}(r)|^{2}}\n$$\nThe scalar product of a vector with itself, $\\mathbf{B}(r) \\cdot \\mathbf{B}(r)$, is equal to the square of its magnitude, $|\\mathbf{B}(r)|^{2}$.\n$$\n\\alpha(r) = \\lambda\\,\\frac{|\\mathbf{B}(r)|^{2}}{|\\mathbf{B}(r)|^{2}}\n$$\nAssuming the magnetic field is non-zero, $|\\mathbf{B}(r)|^{2} \\neq 0$, which is physically necessary for magnetic confinement, we can cancel the term $|\\mathbf{B}(r)|^{2}$ from the numerator and denominator. This leaves:\n$$\n\\alpha(r) = \\lambda\n$$\nThe scalar function $\\alpha(r)$ is not a function of position $r$ but is equal to the constant scalar $\\lambda$ that defines the Beltrami field. The units of $\\lambda$ are $\\mathrm{m}^{-1}$, as required.",
            "answer": "$$\\boxed{\\lambda}$$"
        },
        {
            "introduction": "A magnetically confined plasma equilibrium is only viable if it is stable against disruptive instabilities. This practice connects the abstract structure of a force-free field to its stability against tearing modes, which are driven by resistivity and current gradients. You will see firsthand how the spatial profile of the force-free parameter, $\\alpha(r)$, determines the drive for these instabilities, revealing that the simplest constant-$\\alpha$ states are only marginally stable—a profound result for plasma confinement.",
            "id": "3699874",
            "problem": "Consider a large-aspect-ratio cylindrical fusion plasma of minor radius $a$ in a magnetostatic state with uniform pressure in which the magnetic field $\\boldsymbol{B}(r)$ is everywhere parallel to the electric current density $\\boldsymbol{J}(r)$ (a force-free alignment). Let the equilibrium satisfy Ampère's law and the force-free condition in the form $\\nabla \\times \\boldsymbol{B} = \\alpha(r)\\,\\boldsymbol{B}$ with $\\alpha(r)$ a scalar function of radius $r$. In resistive Magnetohydrodynamics (MHD), a tearing perturbation with wavevector $\\boldsymbol{k}$ resonates at the rational surface $r=r_s$ where $\\boldsymbol{k}\\cdot \\boldsymbol{B}(r_s)=0$, and the local current-gradient drive entering the inner-layer equation can be represented by the radial derivative of the field-line-averaged parallel current, specifically\n$$D \\equiv \\left.\\frac{d}{dr}\\left(\\frac{J_{\\parallel}}{B}\\right)\\right|_{r_s},$$\nwhere $J_{\\parallel} \\equiv \\boldsymbol{J}\\cdot \\boldsymbol{B}/|\\boldsymbol{B}|$ and $B \\equiv |\\boldsymbol{B}|$.\n\nStarting only from the statements of Ampère's law, the force-free alignment, and the definition of $D$, derive $D$ in terms of $\\alpha(r)$ at $r=r_s$. Then evaluate $D$ for the case of a constant-$\\alpha$ Beltrami equilibrium with $\\alpha(r)=\\alpha_0$, and report the dimensionless normalized resonant drive\n$$\\mathcal{R} \\equiv \\frac{\\mu_0}{\\alpha_0}\\,D.$$\nYour final answer must be a single real number. No units are required because $\\mathcal{R}$ is dimensionless. No rounding is required.",
            "solution": "The tearing mode drive is defined as:\n$$D \\equiv \\left.\\frac{d}{dr}\\left(\\frac{J_{\\parallel}}{B}\\right)\\right|_{r_s}$$\nwhere $J_{\\parallel}$ is the component of the electric current density $\\boldsymbol{J}$ parallel to the magnetic field $\\boldsymbol{B}$, and $B \\equiv |\\boldsymbol{B}|$. The definition of $J_{\\parallel}$ is given as:\n$$J_{\\parallel} \\equiv \\frac{\\boldsymbol{J}\\cdot\\boldsymbol{B}}{B}$$\nThe problem states that the plasma is in a magnetostatic equilibrium with uniform pressure. The MHD force balance equation is $\\boldsymbol{J} \\times \\boldsymbol{B} = \\nabla p$. Since the pressure is uniform, its gradient is zero, $\\nabla p = 0$, which leads to the force-free condition:\n$$\\boldsymbol{J} \\times \\boldsymbol{B} = 0$$\nThis equation implies that the current density vector $\\boldsymbol{J}$ is everywhere parallel to the magnetic field vector $\\boldsymbol{B}$.\n\nThe problem provides two fundamental equations governing the magnetic field and current density: Ampère's law and a specific form of the force-free condition.\nAmpère's law in magnetostatics is:\n$$\\nabla \\times \\boldsymbol{B} = \\mu_0 \\boldsymbol{J}$$\nwhere $\\mu_0$ is the vacuum permeability.\nThe given force-free condition is:\n$$\\nabla \\times \\boldsymbol{B} = \\alpha(r) \\boldsymbol{B}$$\nwhere $\\alpha(r)$ is a scalar function of the radius $r$.\n\nBy equating these two expressions for the curl of $\\boldsymbol{B}$, we establish a direct relationship between $\\boldsymbol{J}$ and $\\boldsymbol{B}$:\n$$\\mu_0 \\boldsymbol{J} = \\alpha(r) \\boldsymbol{B}$$\nThis can be rearranged to express $\\boldsymbol{J}$ in terms of $\\boldsymbol{B}$:\n$$\\boldsymbol{J} = \\frac{\\alpha(r)}{\\mu_0} \\boldsymbol{B}$$\nThis relation formally confirms that $\\boldsymbol{J}$ and $\\boldsymbol{B}$ are parallel, as required by the force-free condition.\n\nNow, we can find an expression for the parallel current $J_{\\parallel}$. Substituting the expression for $\\boldsymbol{J}$ into the definition of $J_{\\parallel}$:\n$$J_{\\parallel} = \\frac{\\left(\\frac{\\alpha(r)}{\\mu_0}\\boldsymbol{B}\\right) \\cdot \\boldsymbol{B}}{B} = \\frac{\\alpha(r)}{\\mu_0} \\frac{\\boldsymbol{B} \\cdot \\boldsymbol{B}}{B}$$\nUsing the identity $\\boldsymbol{B} \\cdot \\boldsymbol{B} = |\\boldsymbol{B}|^2 = B^2$, the expression for $J_{\\parallel}$ simplifies to:\n$$J_{\\parallel} = \\frac{\\alpha(r)}{\\mu_0} \\frac{B^2}{B} = \\frac{\\alpha(r)}{\\mu_0} B$$\nNext, we form the quantity $\\frac{J_{\\parallel}}{B}$ which appears in the definition of $D$:\n$$\\frac{J_{\\parallel}}{B} = \\frac{\\frac{\\alpha(r)}{\\mu_0} B}{B} = \\frac{\\alpha(r)}{\\mu_0}$$\nThis result shows that the ratio of the parallel current to the magnetic field strength is directly proportional to the function $\\alpha(r)$.\n\nWe can now compute the tearing drive $D$ by taking the radial derivative of this quantity and evaluating it at the resonant surface $r = r_s$:\n$$D = \\left.\\frac{d}{dr}\\left(\\frac{\\alpha(r)}{\\mu_0}\\right)\\right|_{r_s}$$\nSince $\\mu_0$ is a fundamental constant, it can be factored out of the derivative:\n$$D = \\frac{1}{\\mu_0} \\left.\\frac{d\\alpha}{dr}\\right|_{r_s}$$\nThis is the general expression for the tearing mode drive $D$ in a force-free equilibrium, which completes the first part of the problem.\n\nThe second part requires evaluating $D$ for a constant-$\\alpha$ Beltrami equilibrium, where $\\alpha(r) = \\alpha_0$ and $\\alpha_0$ is a constant. In this case, the derivative of $\\alpha(r)$ with respect to $r$ is identically zero:\n$$\\frac{d\\alpha}{dr} = \\frac{d}{dr}(\\alpha_0) = 0$$\nSubstituting this into our expression for $D$:\n$$D = \\frac{1}{\\mu_0} \\cdot 0 = 0$$\nThus, for a constant-$\\alpha$ force-free field, the current-gradient drive for the tearing mode is zero. This implies that such equilibria are marginally stable to tearing modes.\n\nThe final part of the problem is to calculate the dimensionless normalized resonant drive, $\\mathcal{R}$, defined as:\n$$\\mathcal{R} \\equiv \\frac{\\mu_0}{\\alpha_0} D$$\nThe problem specifies a Beltrami equilibrium, which implies $\\alpha_0 \\neq 0$, so the normalization is well-defined. Substituting our result $D=0$ into this definition:\n$$\\mathcal{R} = \\frac{\\mu_0}{\\alpha_0} (0) = 0$$\nThe final answer is a single real number.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Ideal, axisymmetric force-free fields possess perfectly nested magnetic surfaces that ensure confinement, but real fusion devices always contain small symmetry-breaking perturbations. This computational exercise challenges you to move from analytical theory to numerical simulation to explore the consequences of these imperfections. By tracing magnetic field lines in a perturbed equilibrium, you will witness the transition from orderly nested surfaces to the formation of magnetic islands and chaotic field line trajectories, providing direct insight into the mechanisms that can degrade confinement in practice.",
            "id": "3699924",
            "problem": "Consider a straight, periodic cylindrical model of a magnetically confined plasma column used to approximate a toroidal device in nuclear fusion. Assume a force-free magnetic field, defined by the condition that the magnetic force vanishes, namely $\\mathbf{J} \\times \\mathbf{B} = \\mathbf{0}$, where $\\mathbf{J}$ is the current density and $\\mathbf{B}$ is the magnetic field. Using Ampère’s law $\\mu_{0}\\mathbf{J} = \\nabla \\times \\mathbf{B}$ and the force-free condition, a standard model for the background field is a Beltrami field obeying $\\nabla \\times \\mathbf{B}_{0} = \\alpha \\mathbf{B}_{0}$ with constant $\\alpha$. In a cylindrical domain of radius $a$, an axisymmetric solution takes the well-tested form\n$\\mathbf{B}_{0}(r) = B_{0}\\,J_{1}(\\alpha r)\\,\\hat{\\boldsymbol{\\theta}} + B_{0}\\,J_{0}(\\alpha r)\\,\\hat{\\mathbf{z}}$,\nwhere $J_{0}$ and $J_{1}$ are Bessel functions of the first kind, $r$ is the radial coordinate, $\\hat{\\boldsymbol{\\theta}}$ is the poloidal unit vector, and $\\hat{\\mathbf{z}}$ is the axial unit vector. We assume $\\alpha a < 2.4048255577$ so that $J_{0}(\\alpha r) > 0$ on $[0,a]$, avoiding axial field reversal and singular field-line equations. Introduce a small, nonaxisymmetric, divergence-free perturbation using a flux function $\\psi(r,\\theta,z)$ in a straight cylinder with periodic axial length $L_{z}$:\n$\\psi(r,\\theta,z) = \\varepsilon\\,B_{0}\\,a^{2}\\,f(r)\\,\\cos\\big(m\\,\\theta - k\\,z\\big)$,\n$f(r) = \\left(\\frac{r}{a}\\right)^{m}\\exp\\!\\left(-\\left(\\frac{r}{a}\\right)^{2}\\right)$,\n$k = \\frac{2\\pi n}{L_{z}}$,\nwhere $\\varepsilon$ is a small amplitude, $m$ and $n$ are integers specifying the helical mode, and $k$ is the axial wavenumber. Define the perturbation via $\\mathbf{B}_{\\perp} = \\nabla\\psi \\times \\hat{\\mathbf{z}}$, so that the perturbed magnetic field is $\\mathbf{B} = \\mathbf{B}_{0} + \\mathbf{B}_{\\perp}$ with components\n$B_{r} = -\\frac{1}{r}\\frac{\\partial \\psi}{\\partial \\theta}$, $B_{\\theta} = \\frac{\\partial \\psi}{\\partial r} + B_{0}J_{1}(\\alpha r)$, $B_{z} = B_{0}J_{0}(\\alpha r)$.\nMagnetic field-lines are tangent to $\\mathbf{B}$ and satisfy\n$\\frac{d r}{d z} = \\frac{B_{r}}{B_{z}},\\quad \\frac{d \\theta}{d z} = \\frac{B_{\\theta}}{r\\,B_{z}}$,\nwith $z$ playing the role of the independent variable. The Poincaré map is defined by sampling at axial positions $z = \\ell\\,L_{z}$ for integers $\\ell$, analogous to toroidal transits in a torus. For sufficiently small $\\varepsilon$, Kolmogorov-Arnold-Moser (KAM) invariant tori can persist, but resonant $m/n$ surfaces and overlapping islands can produce chaotic field-line behavior. Such chaos can degrade confinement by causing radial wandering of field-lines to the wall at $r=a$.\n\nStarting only from the above fundamental laws and definitions, perform the following:\n\n- Derive the explicit expressions needed to integrate the field-line equations, stating clearly each quantity, including all required derivatives of $\\psi(r,\\theta,z)$.\n- Design an algorithm that, for given parameters and an initial point $(r_{0},\\theta_{0})$ at $z=0$, integrates the field-line equations over a given number of Poincaré periods $N_{\\text{per}}$, with time step $\\Delta z$ chosen to resolve the helical perturbation adequately. Use a fourth-order Runge–Kutta method with uniform step $\\Delta z$.\n- Quantify the sensitivity of field-lines to initial conditions by computing the Finite-Time Lyapunov Exponent (FTLE), defined here as\n$\\lambda = \\frac{1}{T}\\ln\\left(\\frac{d(T)}{d(0)}\\right)$,\nwhere $T = N_{\\text{surv}}\\,L_{z}$ is the total integration length until either $N_{\\text{per}}$ periods are completed or the field-line reaches $r \\ge a$ (loss), whichever occurs first, $d(0)$ is the initial infinitesimal separation between two nearby initial conditions, and $d(T)$ is the final separation measured on the last available Poincaré section. Use the metric on the Poincaré plane given by $d = \\sqrt{(\\Delta r)^{2} + (r_{\\text{avg}}\\Delta\\theta)^{2}}$, and measure the angle $\\theta$ in radians.\n- Define a confinement indicator as follows: return $1$ if the field-line remains within $r<a$ for all $N_{\\text{per}}$ Poincaré periods, and $0$ otherwise. Also return the number of full Poincaré periods $N_{\\text{surv}}$ survived before loss (or $N_{\\text{per}}$ if confined).\n\nPhysical and numerical units and requirements:\n- Use meters for all lengths, including $a$ and $L_{z}$; use Tesla for magnetic field magnitude $B_{0}$; use radians for angles; the FTLE $\\lambda$ must be reported in $\\text{m}^{-1}$.\n- Choose the parameters so that $\\alpha a < 2.4048$. The numerical step $\\Delta z$ must be small enough to resolve the highest axial variation scale, so that $\\Delta z \\le \\frac{L_{z}}{100\\,n}$.\n- The initial separation must be a pure angular offset $\\delta\\theta_{0}$ at fixed radius $r_{0}$, with $d(0) = r_{0}\\,|\\delta\\theta_{0}|$.\n\nTest suite:\nUse the following device and background parameters for all tests: $a = 0.2\\,\\text{m}$, $\\alpha = 8.0\\,\\text{m}^{-1}$, $B_{0} = 5.0\\,\\text{T}$, $L_{z} = 10.0\\,\\text{m}$, initial angular separation $\\delta\\theta_{0} = 10^{-6}\\,\\text{rad}$, and fourth-order Runge–Kutta with $\\Delta z = \\frac{L_{z}}{800}$.\n\nEvaluate the following $4$ test cases, each defined by $(\\varepsilon, m, n, r_{0}\\,[\\text{m}], \\theta_{0}\\,[\\text{rad}], N_{\\text{per}})$:\n\n- Case $1$: $(10^{-4},\\,2,\\,1,\\,0.02,\\,0.1,\\,80)$\n- Case $2$: $(5\\times 10^{-4},\\,2,\\,1,\\,0.10,\\,1.0,\\,80)$\n- Case $3$: $(2\\times 10^{-3},\\,2,\\,1,\\,0.16,\\,2.0,\\,80)$\n- Case $4$: $(8\\times 10^{-3},\\,2,\\,1,\\,0.18,\\,2.5,\\,80)$\n\nFor each case, compute and return a triplet $[\\lambda,\\,C,\\,N_{\\text{surv}}]$, where $\\lambda$ is the FTLE in $\\text{m}^{-1}$, $C \\in \\{0,1\\}$ is the confinement indicator, and $N_{\\text{surv}}$ is an integer. Round only the reported $\\lambda$ to at most six decimal places; report $C$ and $N_{\\text{surv}}$ as integers without rounding.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the string representation of one case’s triplet in square brackets. For example: $[\\,[\\lambda_{1},C_{1},N_{\\text{surv},1}],[\\lambda_{2},C_{2},N_{\\text{surv},2}],\\dots ]$. No other text should be printed.",
            "solution": "```python\nimport numpy as np\nfrom scipy.special import j0, j1\n\ndef solve():\n    \"\"\"\n    Main function to solve for all test cases and print the results.\n    \"\"\"\n    # Device and background parameters (constants for all tests)\n    A = 0.2  # m, radius\n    ALPHA = 8.0  # m^-1, Beltrami parameter\n    B0 = 5.0  # T, magnetic field magnitude (note: cancels out in ODEs)\n    LZ = 10.0  # m, axial periodic length\n    DTHETA0 = 1e-6  # rad, initial angular separation\n    DZ = LZ / 800.0 # m, integration step size\n\n    # Test cases: (epsilon, m, n, r0, theta0, N_per)\n    test_cases = [\n        (1e-4, 2, 1, 0.02, 0.1, 80),\n        (5e-4, 2, 1, 0.10, 1.0, 80),\n        (2e-3, 2, 1, 0.16, 2.0, 80),\n        (8e-3, 2, 1, 0.18, 2.5, 80),\n    ]\n\n    results = []\n    for case in test_cases:\n        eps, m, n, r0, theta0, n_per = case\n        result = compute_case(eps, m, n, r0, theta0, n_per, A, ALPHA, LZ, DTHETA0, DZ)\n        results.append(result)\n    \n    # Format the final output string as per requirements.\n    # Ex: [[lambda1,C1,Nsurv1],[lambda2,C2,Nsurv2]]\n    result_strings = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef odes(z, y, m, k, eps, a, alpha):\n    \"\"\"\n    Computes the derivatives dr/dz and dtheta/dz for two trajectories.\n    y = [r1, theta1, r2, theta2]\n    \"\"\"\n    r1, theta1, r2, theta2 = y\n    \n    a_sq = a * a\n    eps_a_sq = eps * a_sq\n    derivatives = np.zeros(4)\n\n    # Derivatives for trajectory 1\n    # Check for r=0 to avoid division by zero, although r0 > 0.\n    if r1 == 0:\n        dr1_dz, dtheta1_dz = 0.0, alpha / 2.0\n    else:\n        phi1 = m * theta1 - k * z\n        j0_r1 = j0(alpha * r1)\n        f_r1 = (r1 / a)**m * np.exp(-(r1 / a)**2)\n        \n        dr1_dz = (eps_a_sq * m / (r1 * j0_r1)) * f_r1 * np.sin(phi1)\n        \n        dtheta1_dz_pert = (eps_a_sq / (r1 * j0_r1)) * (m / r1 - 2 * r1 / a_sq) * f_r1 * np.cos(phi1)\n        dtheta1_dz_main = j1(alpha * r1) / (r1 * j0_r1)\n        dtheta1_dz = dtheta1_dz_main + dtheta1_dz_pert\n    derivatives[0], derivatives[1] = dr1_dz, dtheta1_dz\n\n    # Derivatives for trajectory 2\n    if r2 == 0:\n        dr2_dz, dtheta2_dz = 0.0, alpha / 2.0\n    else:\n        phi2 = m * theta2 - k * z\n        j0_r2 = j0(alpha * r2)\n        f_r2 = (r2 / a)**m * np.exp(-(r2 / a)**2)\n    \n        dr2_dz = (eps_a_sq * m / (r2 * j0_r2)) * f_r2 * np.sin(phi2)\n        \n        dtheta2_dz_pert = (eps_a_sq / (r2 * j0_r2)) * (m / r2 - 2 * r2 / a_sq) * f_r2 * np.cos(phi2)\n        dtheta2_dz_main = j1(alpha * r2) / (r2 * j0_r2)\n        dtheta2_dz = dtheta2_dz_main + dtheta2_dz_pert\n    derivatives[2], derivatives[3] = dr2_dz, dtheta2_dz\n        \n    return derivatives\n\ndef compute_case(eps, m, n, r0, theta0, n_per, a, alpha, lz, dtheta0, dz):\n    \"\"\"\n    Integrates field lines for a single test case and computes results.\n    \"\"\"\n    k = 2 * np.pi * n / lz\n\n    # Initial state vector [r1, theta1, r2, theta2]\n    y = np.array([r0, theta0, r0, theta0 + dtheta0], dtype=np.float64)\n    z = 0.0\n\n    d0 = r0 * dtheta0\n    \n    steps_per_period = int(round(lz / dz))\n    total_steps = n_per * steps_per_period\n\n    poincare_states = {0: y.copy()}\n    \n    is_lost = False\n    final_step = 0\n    \n    for i in range(total_steps):\n        # Fourth-Order Runge-Kutta step\n        k1 = odes(z, y, m, k, eps, a, alpha)\n        k2 = odes(z + 0.5 * dz, y + 0.5 * dz * k1, m, k, eps, a, alpha)\n        k3 = odes(z + 0.5 * dz, y + 0.5 * dz * k2, m, k, eps, a, alpha)\n        k4 = odes(z + dz, y + dz * k3, m, k, eps, a, alpha)\n        y += (dz / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n        z += dz\n        \n        # Check for loss condition on the primary trajectory\n        if y[0] >= a:\n            is_lost = True\n            final_step = i + 1\n            break\n            \n        # Store state at each Poincaré section crossing\n        if (i + 1) % steps_per_period == 0:\n            period_num = (i + 1) // steps_per_period\n            poincare_states[period_num] = y.copy()\n\n    if is_lost:\n        # Field line is lost. Confinement is 0.\n        C = 0\n        # N_surv is the number of full periods completed before loss.\n        # Loss occurred at step `final_step`. Survived up to step `final_step - 1`.\n        # z_survived = (final_step - 1) * dz.\n        n_surv = int(np.floor((final_step - 1) * dz / lz))\n    else:\n        # Field line survived for all periods.\n        C = 1\n        n_surv = n_per\n\n    # Calculate Finite-Time Lyapunov Exponent (FTLE)\n    T = n_surv * lz\n    \n    if T == 0:\n        # If lost before the first Poincaré section, time horizon is zero.\n        # FTLE is defined as 0 in this case.\n        ftle = 0.0\n    else:\n        last_state = poincare_states[n_surv]\n        r1_T, theta1_T, r2_T, theta2_T = last_state\n        \n        dr_T = r2_T - r1_T\n        dtheta_T = theta2_T - theta1_T\n        \n        # Normalize angle difference to (-pi, pi] to get shortest angle.\n        dtheta_T = (dtheta_T + np.pi) % (2 * np.pi) - np.pi\n        \n        r_avg_T = (r1_T + r2_T) / 2.0\n        \n        # Use the specified metric for separation distance.\n        dt_sq = dr_T**2 + (r_avg_T * dtheta_T)**2\n        dt = np.sqrt(dt_sq)\n        \n        if dt <= 0 or d0 <= 0:\n            ftle = 0.0\n        else:\n            ftle = (1.0 / T) * np.log(dt / d0)\n\n    return [round(ftle, 6), C, n_surv]\n\n# Execute the solver\nif __name__ == \"__main__\":\n    solve()\n\n```",
            "answer": "[[0.000192,1,80],[0.001614,1,80],[0.004117,1,80],[0.008906,0,15]]"
        }
    ]
}