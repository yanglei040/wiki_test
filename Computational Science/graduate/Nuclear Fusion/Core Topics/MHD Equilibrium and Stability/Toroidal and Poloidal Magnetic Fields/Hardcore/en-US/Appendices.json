{
    "hands_on_practices": [
        {
            "introduction": "The safety factor, $q$, is a dimensionless quantity that measures the pitch of magnetic field lines and is paramount for maintaining magnetohydrodynamic stability in a tokamak. This exercise grounds this crucial concept in fundamental principles by tasking you with deriving the on-axis safety factor, $q(0)$, from Ampère's law and the geometric definition of field line winding. By calculating the change in the toroidal magnetic field, $B_{\\phi}$, needed to keep $q(0)$ constant as the plasma current profile evolves, you will develop a quantitative understanding of the direct control relationship between the main magnetic fields and the plasma current distribution .",
            "id": "3723079",
            "problem": "A large-aspect-ratio, circular-cross-section tokamak of major radius $R_{0} = 3.0\\ \\mathrm{m}$ operates with a spatially uniform on-axis toroidal magnetic field $B_{\\phi}(0) = 5.3\\ \\mathrm{T}$. Assume the magnetic geometry is axisymmetric, the Shafranov shift is negligible, and the toroidal field is approximately constant on flux surfaces. The plasma current density near the magnetic axis is smooth and can be expanded as $j_{\\phi}(r) = j_{0} + \\mathcal{O}(r^{2})$ with initial on-axis value $j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$. Following a profile evolution event, the current profile peaks such that the on-axis current density increases to $j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$, while geometric assumptions remain valid.\n\nUsing only (i) the fundamental definition of the safety factor $q$ as the ratio of toroidal to poloidal field-line winding and (ii) Ampère’s law in the cylindrical approximation for the poloidal magnetic field near the axis, derive the on-axis safety factor $q(0)$ in terms of $B_{\\phi}(0)$, $R_{0}$, and $j_{0}$. Then determine the change in the on-axis toroidal magnetic field $\\Delta B_{\\phi}(0) \\equiv B_{\\phi}^{\\prime}(0) - B_{\\phi}(0)$ required to keep $q(0)$ constant when $j_{0}$ changes from $j_{0}$ to $j_{0}^{\\prime}$.\n\nExpress your final answer for $\\Delta B_{\\phi}(0)$ in $\\mathrm{T}$ and round to three significant figures.",
            "solution": "The problem statement is first validated for scientific soundness, self-consistency, and clarity.\n\n### Step 1: Extract Givens\n-   Tokamak geometry: large-aspect-ratio, circular-cross-section.\n-   Major radius: $R_{0} = 3.0\\ \\mathrm{m}$.\n-   Initial on-axis toroidal magnetic field: $B_{\\phi}(0) = 5.3\\ \\mathrm{T}$.\n-   Assumptions: axisymmetric geometry, negligible Shafranov shift, toroidal field $B_{\\phi}$ is approximately constant on flux surfaces.\n-   Initial current density profile near the magnetic axis ($r=0$): $j_{\\phi}(r) = j_{0} + \\mathcal{O}(r^{2})$.\n-   Initial on-axis current density: $j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$.\n-   Final on-axis current density: $j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$.\n-   Objective: First, derive the on-axis safety factor $q(0)$ in terms of $B_{\\phi}(0)$, $R_{0}$, and $j_{0}$. Second, determine the change in the on-axis toroidal magnetic field, $\\Delta B_{\\phi}(0) = B_{\\phi}^{\\prime}(0) - B_{\\phi}(0)$, required to keep $q(0)$ constant during the change from $j_{0}$ to $j_{0}^{\\prime}$.\n-   Required methods: (i) Fundamental definition of the safety factor $q$, and (ii) Ampère’s law in the cylindrical approximation.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the principles of Magnetohydrodynamics (MHD) as applied to tokamak fusion devices. The concepts of safety factor, toroidal and poloidal fields, and Ampère's law are standard in plasma physics. The provided numerical values for major radius, magnetic field, and current density are physically realistic for a large tokamak. The problem is well-posed, providing all necessary information and assumptions (e.g., large aspect ratio, cylindrical approximation near the axis) to derive a unique solution. The language is objective and unambiguous. The problem does not violate any of the specified invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of the On-Axis Safety Factor $q(0)$\nThe safety factor, $q$, quantifies the pitch of a magnetic field line on a magnetic flux surface. It is defined as the number of toroidal circuits a field line completes for every one poloidal circuit. In a toroidal coordinate system $(r, \\theta, \\phi)$, where $r$ is the minor radius, $\\theta$ is the poloidal angle, and $\\phi$ is the toroidal angle, the path of a magnetic field line is described by the differential equation:\n$$\n\\frac{dl_{\\phi}}{B_{\\phi}} = \\frac{dl_{\\theta}}{B_{\\theta}}\n$$\nwhere $dl_{\\phi}$ and $dl_{\\theta}$ are the differential arc lengths in the toroidal and poloidal directions, respectively, and $B_{\\phi}$ and $B_{\\theta}$ are the corresponding magnetic field components.\n\nFor a large-aspect-ratio ($R_0 \\gg r$) circular tokamak, we can use the cylindrical approximation. The major radius of a point on the flux surface is $R = R_0 + r\\cos\\theta \\approx R_0$. The arc lengths are given by $dl_{\\phi} = R d\\phi \\approx R_0 d\\phi$ and $dl_{\\theta} = r d\\theta$. Substituting these into the field line equation yields:\n$$\n\\frac{R_0 d\\phi}{B_{\\phi}} = \\frac{r d\\theta}{B_{\\theta}}\n$$\nThe safety factor $q(r)$ on the flux surface at minor radius $r$ is the ratio of the differential changes in the angles:\n$$\nq(r) = \\frac{d\\phi}{d\\theta} = \\frac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}\n$$\nWe need to evaluate this expression on the magnetic axis, i.e., in the limit $r \\to 0$. The problem states that the toroidal field is approximately constant on flux surfaces, so near the axis we can take $B_{\\phi}(r) \\approx B_{\\phi}(0)$. Thus, the on-axis safety factor is:\n$$\nq(0) = \\lim_{r \\to 0} q(r) = \\frac{B_{\\phi}(0)}{R_0} \\lim_{r \\to 0} \\left( \\frac{r}{B_{\\theta}(r)} \\right)\n$$\nTo evaluate the limit, we must determine the behavior of the poloidal magnetic field $B_{\\theta}(r)$ near the axis using Ampère's law, $\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{enc}$. We apply this law to a circular Amperian loop of radius $r$ centered on the magnetic axis. Due to axisymmetry, $B_{\\theta}$ is constant along this loop. The line integral is:\n$$\n\\oint \\mathbf{B} \\cdot d\\mathbf{l} = B_{\\theta}(r) (2\\pi r)\n$$\nThe enclosed current $I_{enc}$ is the integral of the toroidal current density $j_{\\phi}$ over the circular area enclosed by the loop. The problem gives the current density near the axis as $j_{\\phi}(r) = j_0 + \\mathcal{O}(r^2)$. For small $r$, we can approximate $j_{\\phi}(r) \\approx j_0$.\n$$\nI_{enc} = \\int_{0}^{r} j_{\\phi}(r') 2\\pi r' dr' \\approx \\int_{0}^{r} j_0 2\\pi r' dr' = j_0 \\pi r^2\n$$\nEquating the two parts of Ampère's law:\n$$\nB_{\\theta}(r) (2\\pi r) = \\mu_0 (j_0 \\pi r^2)\n$$\nSolving for $B_{\\theta}(r)$ gives its linear dependence on $r$ near the axis:\n$$\nB_{\\theta}(r) = \\frac{\\mu_0 j_0 r}{2}\n$$\nNow we can evaluate the limit for $q(0)$:\n$$\n\\lim_{r \\to 0} \\left( \\frac{r}{B_{\\theta}(r)} \\right) = \\lim_{r \\to 0} \\left( \\frac{r}{\\frac{\\mu_0 j_0 r}{2}} \\right) = \\frac{2}{\\mu_0 j_0}\n$$\nSubstituting this result into the expression for $q(0)$ yields the final derived formula:\n$$\nq(0) = \\frac{B_{\\phi}(0)}{R_0} \\left( \\frac{2}{\\mu_0 j_0} \\right) = \\frac{2 B_{\\phi}(0)}{\\mu_0 R_0 j_0}\n$$\nThis completes the first part of the problem.\n\n### Calculation of the Required Change in Toroidal Field\nThe problem states that the on-axis safety factor $q(0)$ is to be held constant while the on-axis current density changes from $j_0$ to $j_0'$. Let the initial state be $(B_{\\phi}(0), j_0)$ and the final state be $(B_{\\phi}'(0), j_0')$. The condition is $q_{initial}(0) = q_{final}(0)$. Using the derived formula:\n$$\n\\frac{2 B_{\\phi}(0)}{\\mu_0 R_0 j_0} = \\frac{2 B_{\\phi}'(0)}{\\mu_0 R_0 j_0'}\n$$\nThe constants $2$, $\\mu_0$, and $R_0$ cancel, leaving a direct proportionality between the on-axis toroidal field and the on-axis current density:\n$$\n\\frac{B_{\\phi}(0)}{j_0} = \\frac{B_{\\phi}'(0)}{j_0'}\n$$\nWe want to find the change $\\Delta B_{\\phi}(0) = B_{\\phi}'(0) - B_{\\phi}(0)$. First, we solve for the final toroidal field $B_{\\phi}'(0)$:\n$$\nB_{\\phi}'(0) = B_{\\phi}(0) \\frac{j_0'}{j_0}\n$$\nThen, the change is:\n$$\n\\Delta B_{\\phi}(0) = B_{\\phi}(0) \\frac{j_0'}{j_0} - B_{\\phi}(0) = B_{\\phi}(0) \\left( \\frac{j_0'}{j_0} - 1 \\right)\n$$\nNow, we substitute the given numerical values: $B_{\\phi}(0) = 5.3\\ \\mathrm{T}$, $j_{0} = 1.20 \\times 10^{6}\\ \\mathrm{A/m^{2}}$, and $j_{0}^{\\prime} = 1.44 \\times 10^{6}\\ \\mathrm{A/m^{2}}$.\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\left( \\frac{1.44 \\times 10^{6}}{1.20 \\times 10^{6}} - 1 \\right)\n$$\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\left( \\frac{1.44}{1.20} - 1 \\right) = 5.3 \\left( 1.2 - 1 \\right)\n$$\n$$\n\\Delta B_{\\phi}(0) = 5.3 \\times 0.2 = 1.06\\ \\mathrm{T}\n$$\nThe result $1.06$ is already expressed to three significant figures. Thus, the required increase in the on-axis toroidal magnetic field is $1.06\\ \\mathrm{T}$.",
            "answer": "$$\n\\boxed{1.06}\n$$"
        },
        {
            "introduction": "Effective management of heat and particle exhaust is a critical design driver for fusion reactors, leading to the development of advanced divertor configurations. This practice delves into the physics of the \"snowflake\" divertor, a configuration that promises enhanced heat flux spreading. Starting from the vacuum Grad-Shafranov equation, you will analytically derive the local conditions on the poloidal flux function, $\\psi$, that define a second-order magnetic null and prove how these conditions naturally produce the desired six-separatrix topology, bridging abstract field theory with innovative hardware solutions .",
            "id": "3723083",
            "problem": "Consider an axisymmetric tokamak divertor region with negligible local toroidal current density so that magnetostatic vacuum conditions apply. Let the magnetic field $\\mathbf{B}$ be represented in terms of the poloidal flux function $\\psi(R,Z)$ via $\\mathbf{B} = \\frac{1}{R}\\nabla \\psi \\times \\hat{\\mathbf{e}}_{\\phi} + B_{\\phi}\\hat{\\mathbf{e}}_{\\phi}$, and recall that Maxwell’s equations in the vacuum region reduce to $\\nabla \\cdot \\mathbf{B} = \\mathbf{0}$ and $\\nabla \\times \\mathbf{B} = \\mathbf{0}$, which imply for the axisymmetric poloidal flux that the vacuum Grad–Shafranov operator satisfies $\\Delta^{\\ast}\\psi = 0$, where $\\Delta^{\\ast}\\psi \\equiv R\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^{2}\\psi}{\\partial Z^{2}}$.\n\nLet $(R_{0},Z_{0})$ be a candidate divertor null point. Introduce local Cartesian coordinates $(x,y)$ by $x \\equiv R - R_{0}$ and $y \\equiv Z - Z_{0}$, and assume the local midplane symmetry $y \\mapsto -y$ about $Z=Z_{0}$ and a scale separation $|x|,|y| \\ll R_{0}$ so that the leading-order behavior of $\\psi$ is governed by a two-dimensional harmonic expansion subject to $\\Delta^{\\ast}\\psi = 0$.\n\nStarting from the above fundamental laws and definitions, perform the following tasks:\n\n1. Using a Taylor expansion of $\\psi(x,y)$ and the axisymmetric vacuum condition $\\Delta^{\\ast}\\psi = 0$, rigorously derive the local criteria that distinguish a standard magnetic X-point from a “snowflake” divertor null. In particular, show the necessary conditions on the gradient and Hessian of $\\psi$ at $(x,y)=(0,0)$ that result in a second-order null and explain, from first principles, why this causes the poloidal field-line geometry to exhibit six separatrices characteristic of a snowflake configuration.\n\n2. Suppose the total poloidal flux near $(x,y)=(0,0)$ can be written as a superposition of a baseline contribution (from all other coils and plasma currents) and two adjustable poloidal field coil circuits indexed by $k=1,2$:\n$$\n\\psi(x,y) = \\psi_{\\mathrm{bg}}(x,y) + \\sum_{k=1}^{2} \\psi_{k}(x,y), \\quad \\psi_{k} \\text{ linear in } I_{k},\n$$\nand, consistent with midplane symmetry and $\\Delta^{\\ast}\\psi = 0$, the leading terms of each contribution take the form\n$$\n\\psi_{\\mathrm{bg}}(x,y) = A\\,x + \\frac{B}{2}\\,(x^{2} - y^{2}) + \\text{higher-order terms},\n$$\n$$\n\\psi_{k}(x,y) = \\alpha_{k}\\,I_{k}\\,x + \\frac{\\beta_{k}}{2}\\,I_{k}\\,(x^{2} - y^{2}) + \\text{higher-order terms},\n$$\nwhere $A$ and $B$ are the baseline dipole and quadrupole coefficients evaluated at $(R_{0},Z_{0})$, and $\\alpha_{k}$, $\\beta_{k}$ are coil-to-flux response coefficients determined by the coil geometries and the vacuum field Green’s function. Using linear superposition and the criteria from part 1, derive the algebraic conditions on $I_{1}$ and $I_{2}$ necessary to achieve a second-order null at $(x,y)=(0,0)$.\n\n3. Solve the resulting system to obtain a closed-form analytic expression for the current ratio $I_{2}/I_{1}$ solely in terms of $A$, $B$, $\\alpha_{1}$, $\\alpha_{2}$, $\\beta_{1}$, and $\\beta_{2}$, under the assumption that a solution exists with nonzero currents and that the higher-order terms yield a nonvanishing third-order coefficient. Express your final answer as a single analytic expression. No numerical evaluation is required.\n\nYour final answer must be a single closed-form expression. No rounding is needed. The current ratio is dimensionless; do not include units in the final answer.",
            "solution": "The problem is subjected to validation and is found to be scientifically grounded, well-posed, objective, and internally consistent. It presents a standard, albeit advanced, problem in plasma physics and magnetohydrodynamics. No flaws were detected. We may therefore proceed with the solution.\n\nThe solution is presented in three parts, corresponding to the tasks outlined in the problem statement.\n\nFirst, we derive the local criteria for distinguishing between a standard magnetic X-point and a \"snowflake\" divertor null.\nA magnetic null point in the poloidal plane is a location where the poloidal magnetic field $\\mathbf{B}_p$ vanishes. The poloidal field is given by $\\mathbf{B}_p = \\frac{1}{R}\\nabla \\psi \\times \\hat{\\mathbf{e}}_{\\phi} = \\frac{1}{R}\\left(\\frac{\\partial \\psi}{\\partial Z}\\hat{\\mathbf{R}} - \\frac{\\partial \\psi}{\\partial R}\\hat{\\mathbf{Z}}\\right)$. In the local coordinates $x = R - R_0$ and $y = Z - Z_0$, this becomes $\\mathbf{B}_p = \\frac{1}{R_0+x}\\left(\\frac{\\partial \\psi}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial \\psi}{\\partial x}\\hat{\\mathbf{y}}\\right)$. For $\\mathbf{B}_p$ to be zero at the point $(R_0, Z_0)$, which corresponds to $(x,y)=(0,0)$, the gradient of the poloidal flux function must vanish: $\\nabla \\psi = \\mathbf{0}$ at $(0,0)$. This means $\\frac{\\partial \\psi}{\\partial x}\\big|_{(0,0)} = 0$ and $\\frac{\\partial \\psi}{\\partial y}\\big|_{(0,0)} = 0$.\n\nWe Taylor expand $\\psi(x,y)$ around the null point $(0,0)$. Setting the constant $\\psi(0,0)$ to $0$ for convenience (as it merely labels the flux surface), and applying the condition $\\nabla\\psi|_{(0,0)} = \\mathbf{0}$, the expansion begins at second order:\n$$\n\\psi(x,y) = \\frac{1}{2}\\left( \\psi_{xx}x^2 + 2\\psi_{xy}xy + \\psi_{yy}y^2 \\right) + \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xxy}x^2y + 3\\psi_{xyy}xy^2 + \\psi_{yyy}y^3 \\right) + \\dots\n$$\nwhere the subscripts denote partial derivatives evaluated at $(0,0)$.\n\nThe problem states a midplane symmetry $y \\mapsto -y$, which implies $\\psi(x,y) = \\psi(x,-y)$. For this symmetry to hold, all terms in the Taylor expansion with odd powers of $y$ must vanish. This requires $\\psi_y = 0$ (already established), $\\psi_{xy} = 0$, $\\psi_{xxy} = 0$, $\\psi_{yyy} = 0$, and so on. The expansion simplifies to:\n$$\n\\psi(x,y) = \\frac{1}{2}\\left( \\psi_{xx}x^2 + \\psi_{yy}y^2 \\right) + \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xyy}xy^2 \\right) + \\dots\n$$\nThe vacuum Grad-Shafranov equation, $\\Delta^{\\ast}\\psi = 0$, must be satisfied. In the local coordinates, the operator for $|x| \\ll R_0$ is approximately $\\Delta^{\\ast}\\psi \\approx \\frac{\\partial^2\\psi}{\\partial x^2} + \\frac{\\partial^2\\psi}{\\partial y^2} - \\frac{1}{R_0}\\frac{\\partial\\psi}{\\partial x}$. Evaluating this at the null point $(0,0)$, where $\\frac{\\partial\\psi}{\\partial x} = 0$, we find the condition $\\psi_{xx} + \\psi_{yy} = 0$, or $\\psi_{yy} = -\\psi_{xx}$.\n\nA standard X-point, or a first-order null, is characterized by $\\nabla\\psi|_{(0,0)} = \\mathbf{0}$ and a non-degenerate Hessian matrix of second derivatives, $\\mathbf{H}$. The Hessian at $(0,0)$ is $\\mathbf{H} = \\begin{pmatrix} \\psi_{xx}  \\psi_{xy} \\\\ \\psi_{xy}  \\psi_{yy} \\end{pmatrix} = \\begin{pmatrix} \\psi_{xx}  0 \\\\ 0  -\\psi_{xx} \\end{pmatrix}$. A non-degenerate Hessian means $\\det(\\mathbf{H}) = -\\psi_{xx}^2 \\neq 0$, which implies $\\psi_{xx} \\neq 0$. In this case, the local behavior of $\\psi$ is dominated by the quadratic terms:\n$$\n\\psi(x,y) \\approx \\frac{1}{2}\\psi_{xx}(x^2 - y^2)\n$$\nThe separatrices, defined by $\\psi(x,y) = 0$, are given by $x^2 - y^2 = 0$, which yields the two lines $y = \\pm x$. These two lines intersect at the origin, forming four distinct regions, characteristic of an X-point.\n\nA \"snowflake\" divertor null is a second-order null. This occurs when the conditions for a first-order null are met ($\\nabla\\psi|_{(0,0)} = \\mathbf{0}$) and, additionally, the Hessian matrix is the zero matrix: $\\mathbf{H} = \\mathbf{0}$. This means all second-order partial derivatives vanish at the null point: $\\psi_{xx} = \\psi_{yy} = \\psi_{xy} = 0$.\n\nFor a second-order null, the Taylor expansion begins at the third-order terms. Due to symmetry and the vacuum condition, the form is:\n$$\n\\psi(x,y) \\approx \\frac{1}{6}\\left( \\psi_{xxx}x^3 + 3\\psi_{xyy}xy^2 \\right)\n$$\nTo find the relationship between the third-order derivatives, we differentiate the vacuum Grad-Shafranov equation: $\\frac{\\partial}{\\partial x}(\\Delta^{\\ast}\\psi)|_{(0,0)} = 0$.\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{\\partial^2\\psi}{\\partial x^2} + \\frac{\\partial^2\\psi}{\\partial y^2} - \\frac{1}{R_0}\\frac{\\partial\\psi}{\\partial x}\\right)\\bigg|_{(0,0)} = \\left(\\psi_{xxx} + \\psi_{xyy} - \\frac{1}{R_0}\\psi_{xx}\\right)\\bigg|_{(0,0)} = 0\n$$\nSince $\\psi_{xx} = 0$ for a second-order null, we must have $\\psi_{xxx} + \\psi_{xyy} = 0$. Let us define a non-zero constant $C_3 = \\psi_{xyy}$ (the problem assumes a non-vanishing third-order coefficient). Then $\\psi_{xxx} = -C_3$. The flux function becomes:\n$$\n\\psi(x,y) \\approx \\frac{1}{6}(-C_3 x^3 + 3C_3 xy^2) = \\frac{C_3}{6}x(3y^2 - x^2)\n$$\nThe separatrix topology is found by setting $\\psi(x,y) = 0$, which gives $x(3y^2 - x^2) = 0$. The solutions define three lines intersecting at the origin: $x=0$, and $3y^2-x^2=0 \\implies y = \\pm \\frac{x}{\\sqrt{3}}$. These three lines are separated by angles of $60$ degrees, dividing the poloidal plane into six regions, which is the defining geometry of a snowflake divertor.\n\nIn summary, the criteria are:\n-   Standard X-point (1st-order null): $\\nabla\\psi=\\mathbf{0}$ and $\\mathbf{H} \\neq \\mathbf{0}$.\n-   Snowflake (2nd-order null): $\\nabla\\psi=\\mathbf{0}$ and $\\mathbf{H} = \\mathbf{0}$ (with non-vanishing third-order derivatives).\n\nNext, we derive the conditions on the coil currents $I_1$ and $I_2$ to achieve a second-order null. The total poloidal flux is given as a superposition:\n$$\n\\psi(x,y) = \\psi_{\\mathrm{bg}}(x,y) + \\psi_{1}(x,y) + \\psi_{2}(x,y)\n$$\nSubstituting the given forms:\n$$\n\\psi(x,y) = \\left( A\\,x + \\frac{B}{2}\\,(x^{2} - y^{2}) \\right) + \\left( \\alpha_{1}\\,I_{1}\\,x + \\frac{\\beta_{1}}{2}\\,I_{1}\\,(x^{2} - y^{2}) \\right) + \\left( \\alpha_{2}\\,I_{2}\\,x + \\frac{\\beta_{2}}{2}\\,I_{2}\\,(x^{2} - y^{2}) \\right) + \\dots\n$$\nCollecting terms by powers of $x$ and $y$:\n$$\n\\psi(x,y) = (A + \\alpha_{1}I_{1} + \\alpha_{2}I_{2})x + \\frac{1}{2}(B + \\beta_{1}I_{1} + \\beta_{2}I_{2})(x^2 - y^2) + \\dots\n$$\nTo create a second-order null at $(0,0)$, we must enforce the conditions $\\nabla\\psi=\\mathbf{0}$ and $\\mathbf{H}=\\mathbf{0}$ at this point.\nThe first derivative with respect to $x$ at $(0,0)$ is the coefficient of the linear term in $x$:\n$$\n\\frac{\\partial \\psi}{\\partial x}\\bigg|_{(0,0)} = A + \\alpha_{1}I_{1} + \\alpha_{2}I_{2}\n$$\nThe condition $\\frac{\\partial \\psi}{\\partial x} = 0$ gives our first equation:\n$$\nA + \\alpha_{1}I_{1} + \\alpha_{2}I_{2} = 0\n$$\nThe second derivative with respect to $x$ at $(0,0)$ is the coefficient of the $x^2$ term, multiplied by $2!/2$:\n$$\n\\frac{\\partial^2 \\psi}{\\partial x^2}\\bigg|_{(0,0)} = B + \\beta_{1}I_{1} + \\beta_{2}I_{2}\n$$\nThe condition $\\mathbf{H}=\\mathbf{0}$ requires $\\psi_{xx}=0$, which gives our second equation:\n$$\nB + \\beta_{1}I_{1} + \\beta_{2}I_{2} = 0\n$$\nThe other conditions ($\\psi_y=0$, $\\psi_{xy}=0$, $\\psi_{yy}=-\\psi_{xx}=0$) are automatically satisfied by the given form of the flux function, which adheres to the required symmetry and vacuum constraints. Thus, the algebraic conditions on $I_1$ and $I_2$ are the coupled linear system:\n$$\n\\alpha_{1}I_{1} + \\alpha_{2}I_{2} = -A\n$$\n$$\n\\beta_{1}I_{1} + \\beta_{2}I_{2} = -B\n$$\n\nFinally, we solve this system for the current ratio $I_2/I_1$. We can solve for $I_1$ and $I_2$ using Cramer's rule. The determinant of the coefficient matrix is $D = \\alpha_1\\beta_2 - \\alpha_2\\beta_1$.\nThe solution for $I_1$ is:\n$$\nI_{1} = \\frac{\\det\\begin{pmatrix} -A  \\alpha_2 \\\\ -B  \\beta_2 \\end{pmatrix}}{D} = \\frac{-A\\beta_2 - (-B\\alpha_2)}{D} = \\frac{B\\alpha_2 - A\\beta_2}{D}\n$$\nThe solution for $I_2$ is:\n$$\nI_{2} = \\frac{\\det\\begin{pmatrix} \\alpha_1  -A \\\\ \\beta_1  -B \\end{pmatrix}}{D} = \\frac{-B\\alpha_1 - (-A\\beta_1)}{D} = \\frac{A\\beta_1 - B\\alpha_1}{D}\n$$\nThe problem assumes a solution exists with nonzero currents, implying $D \\neq 0$, $I_1 \\neq 0$, and $I_2 \\neq 0$. The ratio $I_2/I_1$ is then:\n$$\n\\frac{I_2}{I_1} = \\frac{(A\\beta_1 - B\\alpha_1)/D}{(B\\alpha_2 - A\\beta_2)/D}\n$$\nThe determinant $D$ cancels, provided $D \\neq 0$, leaving:\n$$\n\\frac{I_2}{I_1} = \\frac{A\\beta_1 - B\\alpha_1}{B\\alpha_2 - A\\beta_2}\n$$\nThis expression provides the required current ratio in terms of the given background and coil response coefficients.",
            "answer": "$$\n\\boxed{\\frac{A \\beta_1 - B \\alpha_1}{B \\alpha_2 - A \\beta_2}}\n$$"
        },
        {
            "introduction": "The precise shape of the plasma boundary is not arbitrary; it is meticulously sculpted by external poloidal field (PF) coils. This computational exercise moves from analytical theory to engineering practice, challenging you to determine the coil currents required to produce a specific plasma shape. You will formulate this as a linear inverse problem, using the exact integral solution for the magnetic flux from circular filaments and solving for the currents using Tikhonov regularization—a standard technique for handling ill-conditioned systems. This practice provides direct experience in the computational design and sensitivity analysis of magnetic control systems, a core competency in modern fusion engineering .",
            "id": "3723089",
            "problem": "Consider an axisymmetric toroidal device for nuclear fusion in which shaping of the plasma boundary is achieved by external poloidal field (PF) coils. Work in vacuum magnetostatics and assume axisymmetry. Let the poloidal flux function be denoted by $\\psi(R,Z)$, where $R$ is the major radius and $Z$ is the vertical coordinate. The fundamental base for this problem is:\n- The magnetostatic Maxwell equations in vacuum, $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$ and $\\nabla \\cdot \\mathbf{B} = 0$, with $\\mathbf{J} = \\mathbf{0}$ in the plasma region (vacuum assumption), implying linear superposition of fields from external coils.\n- In axisymmetry, the magnetic vector potential has only a toroidal component $A_\\phi(R,Z)$ such that $\\psi(R,Z) = R A_\\phi(R,Z)$, and the contribution from a circular current loop of radius $a$ located at $(R=a, Z=Z_0)$ carrying current $I$ is given by the well-tested elliptic integral expression for the toroidal component of the magnetic vector potential,\n$$\nA_\\phi(R,Z) = \\frac{\\mu_0 I}{2\\pi} \\frac{1}{k} \\sqrt{\\frac{a}{R}} \\left[ \\left(2 - k^2\\right) K(k^2) - 2 E(k^2) \\right],\n$$\nwith modulus squared\n$$\nk^2 = \\frac{4 a R}{(a+R)^2 + (Z-Z_0)^2},\n$$\nand where $K(m)$ and $E(m)$ are the complete elliptic integrals of the first and second kind, respectively, with parameter $m = k^2$. All PF coils are modeled as such circular loops, so $\\psi(R,Z)$ is the linear superposition of their contributions, $\\psi(R,Z) = \\sum_{j=1}^{N_c} \\psi_j(R,Z)$ with $\\psi_j(R,Z) = R A_{\\phi,j}(R,Z)$.\n\nThe goal is to compute the PF coil currents required to realize a specified constant-$\\psi$ plasma boundary contour and to quantify sensitivity to coil placement. Formulate this as a linear inverse problem: choose $N_p$ points $(R_i, Z_i)$ on the desired boundary and enforce the constraint $\\psi(R_i, Z_i) \\approx \\psi_b$ for all $i \\in \\{1,\\dots,N_p\\}$, where $\\psi_b$ is a specified constant flux value. Construct the linear system\n$$\n\\mathbf{A} \\mathbf{I} \\approx \\mathbf{b},\n$$\nwhere $\\mathbf{A} \\in \\mathbb{R}^{N_p \\times N_c}$ has entries $A_{ij} = \\psi_j(R_i, Z_i)$ for unit current in coil $j$, $\\mathbf{I} \\in \\mathbb{R}^{N_c}$ is the vector of coil currents to be found, and $\\mathbf{b} \\in \\mathbb{R}^{N_p}$ has entries $b_i = \\psi_b$. Solve for $\\mathbf{I}$ using Tikhonov-regularized least squares:\n$$\n\\mathbf{I}^\\star = \\arg\\min_{\\mathbf{I}} \\left\\| \\mathbf{A} \\mathbf{I} - \\mathbf{b} \\right\\|_2^2 + \\lambda^2 \\left\\| \\mathbf{I} \\right\\|_2^2,\n$$\nwhose normal equations solution is\n$$\n\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}.\n$$\nQuantify sensitivity to coil placement via:\n- The $2$-norm condition number $\\kappa_2(\\mathbf{A}) = \\sigma_{\\max}(\\mathbf{A}) / \\sigma_{\\min}(\\mathbf{A})$, where $\\sigma_{\\max}$ and $\\sigma_{\\min}$ are the largest and smallest singular values of $\\mathbf{A}$.\n- A finite-difference sensitivity metric for uniform vertical perturbation $\\Delta Z$ of all coil centers: recompute $\\mathbf{I}^{\\star,\\mathrm{pert}}$ for coil locations $(R_j, Z_j + \\Delta Z)$ and report the dimensionless relative change\n$$\n\\delta = \\frac{\\left\\| \\mathbf{I}^{\\star,\\mathrm{pert}} - \\mathbf{I}^\\star \\right\\|_2}{\\left\\| \\mathbf{I}^\\star \\right\\|_2}.\n$$\n\nAll distances must be in meters, currents in Amperes, magnetic permeability $\\mu_0$ in Henrys per meter, and fluxes in Webers. Angles must be specified and used in radians.\n\nUse the following test suite. In each case, define an elongated plasma boundary with major radius $R_0$, minor radius $a_p$, elongation $\\kappa$, and sample $N_p = 8$ boundary points at angles $\\theta \\in \\{0, \\pi/4, \\pi/2, 3\\pi/4, \\pi, 5\\pi/4, 3\\pi/2, 7\\pi/4\\}$:\n$$\nR(\\theta) = R_0 + a_p \\cos\\theta, \\quad Z(\\theta) = \\kappa a_p \\sin\\theta.\n$$\nUse regularization parameter $\\lambda = 10^{-3}$ and perturbation $\\Delta Z = 0.01$.\n\n- Test Case 1 (well-posed shaping):\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$.\n  - PF coil set ($N_c = 4$): $(R_c,Z_c) \\in \\{(3.0, 1.6), (3.0, -1.6), (5.0, 0.0), (1.5, 0.0)\\}$.\n\n- Test Case 2 (nearly collinear coils, reduced controllability):\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$.\n  - PF coil set ($N_c = 3$): $(R_c,Z_c) \\in \\{(3.5, 0.0), (3.6, 0.0), (3.7, 0.0)\\}$.\n\n- Test Case 3 (coils placed far from plasma, weak coupling):\n  - $R_0 = 3.0$, $a_p = 1.0$, $\\kappa = 1.7$, $\\psi_b = 1.0$.\n  - PF coil set ($N_c = 4$): $(R_c,Z_c) \\in \\{(8.0, 3.5), (8.0, -3.5), (0.5, 3.5), (0.5, -3.5)\\}$.\n\nYour program must:\n- Implement the above physics model using the given $A_\\phi$ formula with complete elliptic integrals for a circular loop.\n- Build $\\mathbf{A}$ for each test case by superposition of $\\psi_j$ per unit current.\n- Solve for $\\mathbf{I}^\\star$ via the normal equations.\n- Compute $\\kappa_2(\\mathbf{A})$ via singular values.\n- Compute $\\delta$ via the specified $\\Delta Z$ perturbation.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a list of the form $[\\text{currents}, \\kappa_2, \\delta]$ where $\\text{currents}$ is a list of floating-point coil currents in Amperes. For example, the global output should look like $[[[I_1,\\dots,I_{N_c}],\\kappa_2,\\delta],[[\\dots],\\dots,\\dots],[[\\dots],\\dots,\\dots]]$ with no spaces. Express all currents in Amperes, flux in Webers, distances in meters, and angles in radians. The final currents and sensitivity metrics are floats or lists of floats as required by the test suite.",
            "solution": "The user-provided problem has been analyzed and is determined to be **valid**. It is a scientifically grounded, well-posed, and objective problem in computational plasma physics. All necessary data and definitions are provided, and the framework is consistent with established principles of electromagnetism and numerical analysis. I will now provide the full solution.\n\n### Principle-Based Solution Design\n\nThe problem requires calculating the currents in a set of poloidal field (PF) coils to shape a plasma boundary in an axisymmetric toroidal device, and subsequently analyzing the sensitivity of this solution. The solution is developed through the following steps, grounded in the principles of magnetostatics and linear algebra.\n\n#### 1. Physical Model: Poloidal Flux from Current Loops\n\nThe foundation of this problem is vacuum magnetostatics. In an axisymmetric system, the magnetic field $\\mathbf{B}$ can be derived from a single-component magnetic vector potential, $\\mathbf{A} = A_\\phi(R,Z) \\hat{\\phi}$, where $R$ is the major radius and $Z$ is the vertical coordinate. The magnetic field lines in the poloidal plane ($R,Z$-plane) lie on surfaces of constant poloidal flux, $\\psi$. The poloidal flux is related to the vector potential by $\\psi(R,Z) = R A_\\phi(R,Z)$.\n\nThe problem states that the plasma-facing coils are modeled as circular current loops. The contribution to the toroidal vector potential $A_\\phi$ at a point $(R,Z)$ from a single loop of radius $a$ located at $Z=Z_0$ on the axis of symmetry and carrying a current $I$ is given by:\n$$\nA_{\\phi,j}(R,Z) = \\frac{\\mu_0 I_j}{2\\pi} \\frac{1}{k_j} \\sqrt{\\frac{a_j}{R}} \\left[ \\left(2 - k_j^2\\right) K(k_j^2) - 2 E(k_j^2) \\right]\n$$\nHere, the subscript $j$ refers to the $j$-th coil, which has a radius $a_j = R_j$ (its own major radius) and is located at $(R_j, Z_j)$. The modulus squared, $k_j^2$, depends on the coil's and the target point's coordinates:\n$$\nk_j^2 = \\frac{4 a_j R}{(a_j+R)^2 + (Z-Z_j)^2}\n$$\n$K(m)$ and $E(m)$ are the complete elliptic integrals of the first and second kind with parameter $m=k^2$. The constant $\\mu_0$ is the permeability of free space.\n\nSince Maxwell's equations are linear in vacuum, the total poloidal flux from $N_c$ coils is the linear superposition of the flux from each coil:\n$$\n\\psi(R,Z) = \\sum_{j=1}^{N_c} \\psi_j(R,Z) = \\sum_{j=1}^{N_c} R A_{\\phi,j}(R,Z)\n$$\n\n#### 2. Mathematical Formulation: The Linear Inverse Problem\n\nThe goal is to find the coil currents $I_j$ such that the resulting poloidal flux $\\psi(R,Z)$ approximates a constant value $\\psi_b$ on a desired plasma boundary. This boundary is defined by a set of $N_p$ points $(R_i, Z_i)$. Evaluating the flux equation at each of these points yields a system of linear equations:\n$$\n\\sum_{j=1}^{N_c} \\psi_j(R_i, Z_i; I_j) \\approx \\psi_b \\quad \\text{for } i = 1, \\dots, N_p\n$$\nWe can separate the unknown current $I_j$ by defining the flux per unit Ampere from coil $j$ at point $i$ as $G_{ij} = \\psi_j(R_i, Z_i; I_j=1\\text{ A})$. The system then becomes:\n$$\n\\sum_{j=1}^{N_c} G_{ij} I_j \\approx \\psi_b \\quad \\text{for } i = 1, \\dots, N_p\n$$\nThis is a linear system of equations, which can be written in matrix form as:\n$$\n\\mathbf{A} \\mathbf{I} \\approx \\mathbf{b}\n$$\nwhere $\\mathbf{A}$ is the $N_p \\times N_c$ matrix with entries $A_{ij} = G_{ij}$, $\\mathbf{I}$ is the $N_c \\times 1$ vector of unknown currents, and $\\mathbf{b}$ is the $N_p \\times 1$ vector whose entries are all $\\psi_b$.\n\n#### 3. Computational Strategy: Tikhonov-Regularized Least Squares\n\nThe matrix $\\mathbf{A}$ can be ill-conditioned, meaning small changes in $\\mathbf{b}$ can lead to large changes in the solution $\\mathbf{I}$. This is common when coils are close together or far from the plasma. To find a stable and physically meaningful solution, we use Tikhonov regularization. We seek to minimize a cost function that penalizes both the solution error and the magnitude of the currents:\n$$\n\\mathbf{I}^\\star = \\arg\\min_{\\mathbf{I}} \\left\\| \\mathbf{A} \\mathbf{I} - \\mathbf{b} \\right\\|_2^2 + \\lambda^2 \\left\\| \\mathbf{I} \\right\\|_2^2\n$$\nwhere $\\lambda$ is the regularization parameter. The solution to this minimization problem is found by solving the associated normal equations:\n$$\n\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}\n$$\nwhere $\\mathbf{I}_{N_c}$ is the $N_c \\times N_c$ identity matrix. This linear system is well-conditioned for $\\lambda > 0$ and can be reliably solved for the optimal current vector $\\mathbf{I}^\\star$.\n\n#### 4. Sensitivity Analysis\n\nTo assess the quality and robustness of the coil configuration, two metrics are computed:\n- **Condition Number**: The $2$-norm condition number of the unregularized matrix $\\mathbf{A}$, $\\kappa_2(\\mathbf{A}) = \\sigma_{\\max}(\\mathbf{A}) / \\sigma_{\\min}(\\mathbf{A})$, measures the amplification of errors. A large $\\kappa_2$ indicates an ill-conditioned problem where the coil set has difficulty producing independent field shapes at the boundary. It is computed from the largest ($\\sigma_{\\max}$) and smallest ($\\sigma_{\\min}$) singular values of $\\mathbf{A}$.\n- **Perturbation Sensitivity ($\\delta$)**: A finite-difference approach is used to quantify the solution's sensitivity to coil placement errors. The coil positions are perturbed by a small vertical shift, $(R_j, Z_j) \\rightarrow (R_j, Z_j + \\Delta Z)$, a new matrix $\\mathbf{A}_{\\text{pert}}$ is computed, and a new current vector $\\mathbf{I}^{\\star,\\text{pert}}$ is found. The relative change in the solution vector is calculated as:\n$$\n\\delta = \\frac{\\left\\| \\mathbf{I}^{\\star,\\text{pert}} - \\mathbf{I}^\\star \\right\\|_2}{\\left\\| \\mathbf{I}^\\star \\right\\|_2}\n$$\n\n### Algorithmic Implementation\n\nThe solution is implemented by following these steps for each test case:\n1.  Set the physical and numerical constants: $\\mu_0$, $\\lambda = 10^{-3}$, $\\Delta Z = 0.01$. Define test case parameters: plasma shape ($R_0, a_p, \\kappa$), target flux $\\psi_b$, and coil locations.\n2.  Generate $N_p=8$ plasma boundary points $(R_i, Z_i)$ using the parametric equations $R(\\theta) = R_0 + a_p \\cos\\theta$ and $Z(\\theta) = \\kappa a_p \\sin\\theta$ for $\\theta \\in \\{0, \\frac{\\pi}{4}, \\dots, \\frac{7\\pi}{4}\\}$.\n3.  Implement a function to calculate the unit-current flux $\\psi_j(R, Z)$ from a single coil, using the provided formulas and `scipy.special` for elliptic integrals.\n4.  Construct the matrix $\\mathbf{A}$ by populating each element $A_{ij}$ with the flux at boundary point $i$ from coil $j$ carrying unit current.\n5.  Construct the target vector $\\mathbf{b}$ as a vector of size $N_p$ filled with the value $\\psi_b$.\n6.  Solve the regularized normal equations $\\left(\\mathbf{A}^\\top \\mathbf{A} + \\lambda^2 \\mathbf{I}_{N_c}\\right) \\mathbf{I}^\\star = \\mathbf{A}^\\top \\mathbf{b}$ to find the baseline current vector $\\mathbf{I}^\\star$.\n7.  Compute the singular values of $\\mathbf{A}$ and calculate the condition number $\\kappa_2(\\mathbf{A})$. If $\\sigma_{\\min}$ is numerically zero, the condition number is treated as infinite.\n8.  Perturb the vertical positions of all coils by $\\Delta Z$.\n9.  Re-compute the matrix $\\mathbf{A}_{\\text{pert}}$ and solve for the perturbed current vector $\\mathbf{I}^{\\star,\\text{pert}}$.\n10. Calculate the sensitivity metric $\\delta$.\n11. Collect the results for the test case: the list of currents $\\mathbf{I}^\\star$, the condition number $\\kappa_2$, and the sensitivity $\\delta$.\n12. Repeat for all test cases and format the collected results into a single-line string as specified. Non-finite floating-point results (e.g., infinity for a condition number) are replaced by the maximum representable `float64` value to ensure a valid numerical output string.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\nfrom scipy.constants import mu_0\nimport json\n\ndef _calculate_psi_unit_current(R_target, Z_target, R_coil, Z_coil):\n    \"\"\"\n    Calculates the poloidal flux at (R_target, Z_target) from a single coil\n    at (R_coil, Z_coil) with unit current (1 Ampere).\n    \n    Args:\n        R_target (float): Major radius of the target point.\n        Z_target (float): Vertical position of the target point.\n        R_coil (float): Major radius of the coil (which is also its radius 'a').\n        Z_coil (float): Vertical position of the coil.\n\n    Returns:\n        float: Poloidal flux psi in Webers for a 1 Ampere current.\n    \"\"\"\n    if R_target = 0 or R_coil = 0:\n        return 0.0\n\n    k2_num = 4.0 * R_coil * R_target\n    k2_den = (R_coil + R_target)**2 + (Z_target - Z_coil)**2\n\n    if k2_den == 0.0:\n        return np.inf  # Should not happen as points are distinct\n\n    k2 = k2_num / k2_den\n    \n    # Due to floating point issues, k2 can slightly exceed 1.\n    if k2  1.0:\n        k2 = 1.0\n    \n    if k2 == 1.0:\n        return np.inf\n\n    k = np.sqrt(k2)\n    K_m = ellipk(k2)\n    E_m = ellipe(k2)\n\n    # A_phi = (mu_0 * I) / (2 * pi) * (1/k) * sqrt(a/R) * [ (2-k^2)K(k^2) - 2E(k^2) ]\n    # with a = R_coil, R = R_target, I = 1.\n    term1 = (1.0 / k) * np.sqrt(R_coil / R_target)\n    term2 = (2.0 - k2) * K_m - 2.0 * E_m\n    \n    A_phi = (mu_0 / (2.0 * np.pi)) * term1 * term2\n    \n    psi = R_target * A_phi\n    return psi\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: well-posed shaping\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(3.0, 1.6), (3.0, -1.6), (5.0, 0.0), (1.5, 0.0)]\n        },\n        # Test Case 2: nearly collinear coils\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(3.5, 0.0), (3.6, 0.0), (3.7, 0.0)]\n        },\n        # Test Case 3: coils placed far from plasma\n        {\n            \"R0\": 3.0, \"ap\": 1.0, \"kappa\": 1.7, \"psi_b\": 1.0,\n            \"coils\": [(8.0, 3.5), (8.0, -3.5), (0.5, 3.5), (0.5, -3.5)]\n        }\n    ]\n\n    lambda_reg = 1.0e-3\n    delta_Z_pert = 0.01\n    Np = 8\n    \n    thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n    \n    all_results = []\n\n    for case in test_cases:\n        Nc = len(case['coils'])\n        R_pts = case['R0'] + case['ap'] * np.cos(thetas)\n        Z_pts = case['kappa'] * case['ap'] * np.sin(thetas)\n\n        def get_currents(coil_locations):\n            A = np.zeros((Np, Nc))\n            for i in range(Np):\n                for j in range(Nc):\n                    R_c, Z_c = coil_locations[j]\n                    A[i, j] = _calculate_psi_unit_current(R_pts[i], Z_pts[i], R_c, Z_c)\n            \n            b = np.full(Np, case['psi_b'])\n            \n            M = A.T @ A + lambda_reg**2 * np.eye(Nc)\n            v = A.T @ b\n            I_star = np.linalg.solve(M, v)\n            return A, I_star\n\n        # --- Base Calculation ---\n        A_base, I_star_base = get_currents(case['coils'])\n\n        # --- Sensitivity Metrics ---\n        # 1. Condition Number\n        singular_values = np.linalg.svd(A_base, compute_uv=False)\n        s_min = singular_values.min()\n        if s_min  np.finfo(float).eps * singular_values.max():\n             kappa_2 = np.inf\n        else:\n             kappa_2 = singular_values.max() / s_min\n\n        # 2. Perturbation Sensitivity\n        perturbed_coils = [(R_c, Z_c + delta_Z_pert) for R_c, Z_c in case['coils']]\n        _, I_star_pert = get_currents(perturbed_coils)\n\n        norm_I_base = np.linalg.norm(I_star_base)\n        if norm_I_base == 0:\n            delta = np.inf if np.linalg.norm(I_star_pert)  0 else 0.0\n        else:\n            delta = np.linalg.norm(I_star_pert - I_star_base) / norm_I_base\n        \n        all_results.append([I_star_base.tolist(), kappa_2, delta])\n\n    # --- Format Output ---\n    # Convert non-finite floats to max float value for valid JSON-like numeric output\n    max_float = np.finfo(np.float64).max\n    for i in range(len(all_results)):\n        if not np.isfinite(all_results[i][1]):\n            all_results[i][1] = max_float\n        if not np.isfinite(all_results[i][2]):\n            all_results[i][2] = max_float\n    \n    # Use json.dumps for robust, compact formatting without spaces.\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```"
        }
    ]
}