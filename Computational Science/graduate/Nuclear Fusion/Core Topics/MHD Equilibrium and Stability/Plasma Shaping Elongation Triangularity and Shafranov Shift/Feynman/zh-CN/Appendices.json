{
    "hands_on_practices": [
        {
            "introduction": "要掌握等离子体位形，第一步是理解其数学描述。本练习将带你使用广泛应用的 Miller 参数化方法，通过对小参数的渐近展开，推导等离子体截面面积和总体积的表达式。通过这个过程，你将亲身体会到拉长比 $κ$ 和三角度 $δ$ 等位形参数如何定量地影响等离子体的宏观几何特性 。",
            "id": "3714196",
            "problem": "考虑一个大环径比的托卡马克等离子体，其最外闭合磁通面由等离子体边缘（小半径为 $a$）处的 Miller 参数化描述：\n- 边界的环向坐标 $R(\\theta)$ 和垂直坐标 $Z(\\theta)$ 由下式给出\n$$\nR(\\theta) \\;=\\; R_{0} \\;+\\; \\Delta \\;+\\; a\\,\\cos\\!\\big(\\theta \\;+\\; \\delta \\sin\\theta\\big), \n\\qquad\nZ(\\theta) \\;=\\; \\kappa\\,a\\,\\sin\\theta,\n$$\n其中 $R_{0}$ 是几何中心的大半径，$\\Delta$ 是磁通面平均的 Shafranov 位移，$\\kappa$ 是拉长率，$\\delta$ 是三角度，$\\theta$ 是几何极向角。\n- 假设剖面整形较弱，即 $|\\delta|\\ll 1$，但不要假设 $\\kappa$ 与1的偏差很小；在仅对 $\\delta$ 展开的同时，保留对 $\\kappa$ 的精确依赖关系。\n- 在薄环（大环径比）极限下进行计算，并忽略 $a/R_{0}$ 中除领头阶之外更高阶的项。\n\n从极向截面面积计算的第一性原理以及环向体积（定义为雅可比因子 $R$ 在极向截面和环向角上的积分）出发，推导关于三角度参数 $\\delta$ 的领头非平凡阶的闭式表达式：\n1. 极向截面面积 $A(\\kappa,\\delta)$。\n2. 环向等离子体体积 $V(\\kappa,\\delta)$。\n\n你的推导必须从给定的边界参数化和标准的矢量微积分关系开始，并且不应引用任何专门的快捷公式来获得最终结果。用符号 $a$、$R_{0}$、$\\Delta$、$\\kappa$ 和 $\\delta$ 表示你的最终答案。以闭合解析形式给出最终表达式，保留至并包括 $\\delta^{2}$ 阶的项，并舍去所有更高阶的 $\\delta$ 项。不需要进行数值计算。最终表达式中不要包含单位。最终答案必须以精确的代数表达式形式给出（无需四舍五入）。",
            "solution": "极向截面的边界由 Miller 参数化给出：\n$$R(\\theta) = R_{0} + \\Delta + a\\cos(\\theta + \\delta \\sin\\theta)$$\n$$Z(\\theta) = \\kappa a \\sin\\theta$$\n其中 $\\theta$ 是几何极向角，范围从 $0$ 到 $2\\pi$。我们被要求在小三角度极限 $|\\delta| \\ll 1$ 和大环径比极限 $a/R_0 \\ll 1$ 下进行计算。\n\n**1. 极向截面面积 $A(\\kappa,\\delta)$**\n\n由参数曲线 $(R(\\theta), Z(\\theta))$ 包围的极向截面面积 $A$ 可以通过沿边界 $C$ 的线积分 $A = \\oint_C R\\,dZ$ 计算。\n\n首先，我们求微分 $dZ$：\n$$\\frac{dZ}{d\\theta} = \\frac{d}{d\\theta}(\\kappa a \\sin\\theta) = \\kappa a \\cos\\theta$$\n$$dZ = \\kappa a \\cos\\theta \\, d\\theta$$\n\n现在我们建立面积的积分：\n$$A = \\int_{0}^{2\\pi} R(\\theta) \\frac{dZ}{d\\theta} d\\theta = \\int_{0}^{2\\pi} \\left[R_{0} + \\Delta + a\\cos(\\theta + \\delta \\sin\\theta)\\right] (\\kappa a \\cos\\theta) d\\theta$$\n\n让我们展开被积函数。为简洁起见，设 $R_g = R_0 + \\Delta$ 为截面几何中心的大半径。\n$$A = \\kappa a \\int_{0}^{2\\pi} \\left[ R_g \\cos\\theta + a\\cos(\\theta + \\delta \\sin\\theta)\\cos\\theta \\right] d\\theta$$\n\n我们可以分别计算每一项的积分。\n第一项的积分为零：\n$$\\int_{0}^{2\\pi} R_g \\cos\\theta d\\theta = R_g [\\sin\\theta]_{0}^{2\\pi} = 0$$\n\n因此面积由第二项决定：\n$$A = \\kappa a^2 \\int_{0}^{2\\pi} \\cos(\\theta + \\delta \\sin\\theta)\\cos\\theta d\\theta$$\n\n为了计算这个积分，我们对 $\\cos(\\theta + \\delta \\sin\\theta)$ 项针对小 $\\delta$ 进行展开。使用余弦和角公式 $\\cos(x+y) = \\cos x \\cos y - \\sin x \\sin y$：\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta \\cos(\\delta \\sin\\theta) - \\sin\\theta \\sin(\\delta \\sin\\theta)$$\n\n现在，我们使用正弦和余弦的泰勒级数展开，保留到 $\\delta^2$ 阶：\n$$\\cos(u) = 1 - \\frac{u^2}{2!} + O(u^4) \\implies \\cos(\\delta \\sin\\theta) = 1 - \\frac{\\delta^2 \\sin^2\\theta}{2} + O(\\delta^4)$$\n$$\\sin(u) = u - \\frac{u^3}{3!} + O(u^5) \\implies \\sin(\\delta \\sin\\theta) = \\delta \\sin\\theta + O(\\delta^3)$$\n\n将这些展开式代回：\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta \\left(1 - \\frac{\\delta^2 \\sin^2\\theta}{2}\\right) - \\sin\\theta (\\delta \\sin\\theta) + O(\\delta^3)$$\n$$\\cos(\\theta + \\delta \\sin\\theta) = \\cos\\theta - \\delta \\sin^2\\theta - \\frac{\\delta^2}{2} \\cos\\theta \\sin^2\\theta + O(\\delta^3)$$\n\n现在，将此式代入面积的被积函数中，并乘以 $\\cos\\theta$：\n$$\\text{Integrand} = \\cos^2\\theta - \\delta \\sin^2\\theta\\cos\\theta - \\frac{\\delta^2}{2} \\cos^2\\theta \\sin^2\\theta + O(\\delta^3)$$\n\n我们将此表达式从 $0$ 到 $2\\pi$ 积分：\n$$\\int_0^{2\\pi} \\cos^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{1+\\cos(2\\theta)}{2} d\\theta = \\left[\\frac{\\theta}{2} + \\frac{\\sin(2\\theta)}{4}\\right]_0^{2\\pi} = \\pi$$\n$$\\int_0^{2\\pi} \\sin^2\\theta\\cos\\theta d\\theta = \\left[\\frac{\\sin^3\\theta}{3}\\right]_0^{2\\pi} = 0$$\n$$\\int_0^{2\\pi} \\cos^2\\theta \\sin^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{\\sin^2(2\\theta)}{4} d\\theta = \\frac{1}{4} \\int_0^{2\\pi} \\frac{1-\\cos(4\\theta)}{2} d\\theta = \\frac{1}{8}\\left[\\theta - \\frac{\\sin(4\\theta)}{4}\\right]_0^{2\\pi} = \\frac{2\\pi}{8} = \\frac{\\pi}{4}$$\n\n结合这些结果，积分变为：\n$$\\int_{0}^{2\\pi} \\left(\\cos^2\\theta - \\delta \\sin^2\\theta\\cos\\theta - \\frac{\\delta^2}{2} \\cos^2\\theta \\sin^2\\theta\\right) d\\theta = \\pi - \\delta(0) - \\frac{\\delta^2}{2}\\left(\\frac{\\pi}{4}\\right) = \\pi - \\frac{\\pi\\delta^2}{8}$$\n\n最后，我们将此结果代回面积 $A$ 的表达式中：\n$$A(\\kappa,\\delta) = \\kappa a^2 \\left(\\pi - \\frac{\\pi\\delta^2}{8}\\right) = \\pi\\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)$$\n该表达式精确到并包括 $\\delta^2$ 阶的项。当 $\\delta=0$ 时，它正确地简化为椭圆的面积 $A=\\pi\\kappa a^2$。\n\n**2. 环向等离子体体积 $V(\\kappa,\\delta)$**\n\n旋转体的体积是通过将无限薄的环形切片的面积在整个体积上积分得到的。使用柱坐标 $(R, \\phi, Z)$，体积元为 $dV = R\\,dR\\,dZ\\,d\\phi$。总体积为：\n$$V = \\int_0^{2\\pi} d\\phi \\iint_A R \\,dR\\,dZ = 2\\pi \\iint_A R \\,dA_{pol}$$\n其中二重积分是在极向截面面积 $A$ 上进行的。\n\n积分 $\\iint_A R \\,dA_{pol}$ 是面积对 $Z$ 轴的一阶矩，它等于 $\\bar{R}A$，其中 $\\bar{R}$ 是极向截面质心的大半径。因此，$V = 2\\pi \\bar{R} A$。\n\n问题指定在薄环（大环径比）极限下工作，并忽略除领头阶之外的 $a/R_0$ 更高阶项。体积的领头阶近似是通过将截面内的大半径 $R$ 近似为一个常数值，即截面几何中心的大半径 $R_g = R_0 + \\Delta$ 来获得的。$R$ 在等离子体内的变化量是 $a$ 的量级。在积分内将 $R$ 视为常数等同于用 $R_g$ 来近似质心的大半径 $\\bar{R}$。这个近似引入了量级为 $a/R_g$ 的相对误差，对体积产生的修正项量级为 $a^3$，与领头体积项 $O(R_0 a^2)$ 相比，这是 $a/R_0$ 展开中的一个高阶项。根据问题的指示，这些高阶项被忽略。\n\n因此，我们有：\n$$\\iint_A R \\,dA_{pol} \\approx R_g \\iint_A dA_{pol} = (R_0 + \\Delta) A$$\n那么体积由下式给出：\n$$V \\approx 2\\pi (R_0 + \\Delta) A$$\n\n代入先前推导出的面积 $A(\\kappa, \\delta)$ 表达式：\n$$V(\\kappa,\\delta) = 2\\pi(R_0 + \\Delta) \\left[ \\pi\\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right) \\right]$$\n$$V(\\kappa,\\delta) = 2\\pi^2 \\kappa (R_0 + \\Delta) a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)$$\n这是等离子体体积的表达式，精确到 $\\delta^2$ 阶和逆环径比 $a/R_0$ 的领头阶。",
            "answer": "$$\n\\boxed{A = \\pi \\kappa a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right), \\quad V = 2\\pi^2 \\kappa (R_0 + \\Delta) a^2 \\left(1 - \\frac{1}{8}\\delta^2\\right)}\n$$"
        },
        {
            "introduction": "等离子体的位形不仅是几何上的选择，它与磁流体动力学（MHD）平衡的物理学紧密相连。本练习将深入探讨 Shafranov 位移这一关键现象的物理根源，通过一个解析的 Solov'ev 平衡模型，推导其与等离子体压强（由极向比压 $β_p$ 表征）和拉长比 $κ$ 之间的关系。这个练习为你搭建了一座从几何参数到等离子体内部状态的桥梁 。",
            "id": "3714218",
            "problem": "考虑一个大环径比的轴对称托卡马克平衡，其由磁流体动力学 (MHD) 力平衡和 Grad–Shafranov 方程描述。极向磁通函数 $\\psi(R,Z)$ 满足\n$$\n\\Delta^{*} \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^{2} \\psi}{\\partial Z^{2}} = - \\mu_{0} R^{2} \\frac{d p}{d \\psi} - \\frac{1}{2} \\frac{d (F^{2})}{d \\psi},\n$$\n其中 $p(\\psi)$ 是等离子体压力，而 $F(\\psi) \\equiv R B_{\\phi}$，$B_{\\phi}$ 是环向磁场。在 Solov’ev 平衡类中，源项被设为常数，因此 $d p / d \\psi = - c_{p}$ 且 $d(F^{2})/d\\psi = - c_{F}$，其中 $c_{p} > 0$ 和 $c_{F} \\ge 0$ 为常数。一个具有代表性的磁通函数可以写为\n$$\n\\psi(R,Z) = \\psi_{\\text{ax}} + \\frac{\\mu_{0} c_{p}}{8} R^{4} + \\frac{c_{F}}{4} Z^{2} + \\frac{h}{2} \\left( Z^{2} - R^{2} \\ln \\frac{R}{R_{0}} \\right) + \\frac{k}{2} R^{2},\n$$\n其中 $R_{0}$ 是一个固定的几何参考位置（例如，线圈组的几何中心），$h$ 和 $k$ 是齐次解系数，它们决定等离子体截面形状并设定磁轴的参考位置。等离子体边界在一阶形状近似下参数化为\n$$\nR(\\theta) = R_{0} + \\Delta + a \\left[ \\cos \\theta + \\delta \\sin \\theta \\right], \\qquad Z(\\theta) = \\kappa a \\sin \\theta,\n$$\n其中 $a$ 是小半径，$\\kappa \\ge 1$ 是拉长率，$\\delta$ 是三角形变（假设很小， $|\\delta| \\ll 1$），$\\Delta$ 是磁轴相对于 $R_{0}$ 的 Shafranov 位移（向外位移）。假设 $R_{0} \\gg a$，且磁面在一个类小半径坐标 $\\rho \\in [0,1]$ 中是自相似的，其中 $\\rho=1$ 对应边界，并且\n$$\nR(\\theta,\\rho) = R_{0} + \\Delta + a \\rho \\left[ \\cos \\theta + \\delta \\sin \\theta \\right], \\qquad Z(\\theta,\\rho) = \\kappa a \\rho \\sin \\theta.\n$$\n此外，设压力分布与极向磁通成线性关系，且边界压力为零，$p(\\psi) = c_{p} \\left( \\psi_{\\text{b}} - \\psi \\right)$，其中 $\\psi_{\\text{b}}$ 表示边界磁通，$\\psi_{\\text{ax}}$ 表示轴上磁通，因此 $\\Delta \\psi \\equiv \\psi_{\\text{b}} - \\psi_{\\text{ax}} > 0$。\n\n回答以下问题：\n\n- 使用上述 Solov’ev 平衡和所述的自相似性，推导体平均压力 $\\langle p \\rangle$ 和边界外侧中平面上的极向磁场 $B_{p,\\text{out}}$。用磁通梯度和几何参数表示 $B_{p,\\text{out}}$，并证明在 $a/R_{0}$ 和 $|\\delta|$ 的主导阶上，三角形变不影响 $B_{p,\\text{out}}$。\n\n- 将极向 beta 定义为体平均等离子体压力与外侧边界处极向磁压力之比，\n$$\n\\beta_{p} \\equiv \\frac{2 \\mu_{0} \\langle p \\rangle}{B_{p,\\text{out}}^{2}},\n$$\n并用 Solov’ev 参数 $c_{p}$、$c_{F}$、$R_{0}$、$a$ 和磁通增量 $\\Delta \\psi$ 表示 $\\beta_{p}$。然后，利用在磁轴附近展开的 Solov’ev 场来消去 $\\Delta \\psi$，从而得到 $\\beta_{p}$ 关于 $c_{p}$、$c_{F}$ 和 $R_{0}$ 的闭式表达式。\n\n- 从 MHD 力平衡和椭圆上极向场能量的几何加权出发，通过推导主导阶关系，将 $\\beta_{p}$ 与大环径比极限下的 Shafranov 位移大小 $\\Delta$ 联系起来\n$$\n\\Delta = \\left( \\frac{a^{2}}{R_{0}} \\right) S(\\kappa)\\, \\beta_{p},\n$$\n并从拉长截面的度规中明确确定形状因子 $S(\\kappa)$。\n\n请以 $a$、$R_{0}$、$\\kappa$ 和 $\\beta_{p}$ 的单个闭式解析表达式形式给出 $\\Delta$ 的最终答案。不需要进行数值计算。如果引入任何角度，请说明其单位是弧度还是度。最终方框内的答案不应包含任何单位。",
            "solution": "该问题要求进行三个主要推导：\n1.  体平均压力 $\\langle p \\rangle$ 和外侧极向磁场 $B_{p,\\text{out}}$。\n2.  用基本的 Solov'ev 参数表示的极向 beta $\\beta_p$。\n3.  用几何参数和 $\\beta_p$ 表示的 Shafranov 位移 $\\Delta$。\n\n最终答案是 Shafranov 位移 $\\Delta$ 的表达式。问题中引入的极向角 $\\theta$，根据此类参数化的惯例，以弧度为单位。\n\n**第一部分：体平均压力和外侧极向磁场**\n\n首先，我们计算体平均压力，$\\langle p \\rangle = \\frac{1}{V} \\int_V p \\, dV$。体积元为 $dV = 2\\pi R \\, dR \\, dZ$。我们使用给定的参数化变换到磁通坐标 $(\\rho, \\theta)$：\n$$\nR(\\rho,\\theta) = R_0 + \\Delta + a \\rho (\\cos\\theta + \\delta \\sin\\theta)\n$$\n$$\nZ(\\rho,\\theta) = \\kappa a \\rho \\sin\\theta\n$$\n此变换的雅可比行列式为 $J = \\left| \\frac{\\partial(R,Z)}{\\partial(\\rho,\\theta)} \\right| = \\kappa a^2 \\rho$。\n等离子体的体积为 $V = \\int_0^1 d\\rho \\int_0^{2\\pi} d\\theta \\, (2\\pi R J)$。\n与 $\\cos\\theta$ 和 $\\sin\\theta$ 成正比的项在 $[0, 2\\pi]$ 上的积分为零。\n$$\nV = 2\\pi \\kappa a^2 (R_0+\\Delta) \\int_0^1 \\rho \\, d\\rho \\int_0^{2\\pi} d\\theta = 2\\pi^2 \\kappa a^2 (R_0+\\Delta)\n$$\n压力由 $p(\\psi) = c_p(\\psi_b - \\psi)$ 给出。$\\rho=0$ 在磁轴、$\\rho=1$ 在边界的自相似结构意味着 $\\psi=\\psi(\\rho)$。一个与磁轴附近 Solov'ev 平衡的二次形式一致的简单模型是 $\\psi(\\rho) = \\psi_{ax} + (\\psi_b - \\psi_{ax})\\rho^2 = \\psi_{ax} + \\Delta\\psi \\rho^2$。\n这给出了压力分布 $p(\\rho) = c_p \\Delta\\psi(1-\\rho^2)$。\n现在我们计算 $\\int p dV$：\n$$\n\\int_V p \\, dV = \\int_0^1 \\int_0^{2\\pi} c_p \\Delta\\psi (1-\\rho^2) 2\\pi [R_0 + \\Delta + a\\rho(\\cos\\theta+\\delta\\sin\\theta)] (\\kappa a^2 \\rho) \\, d\\theta \\, d\\rho\n$$\n同样，依赖于 $\\theta$ 的项在积分后消失。\n$$\n\\int_V p \\, dV = 4\\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi \\left[\\frac{\\rho^2}{2} - \\frac{\\rho^4}{4}\\right]_0^1 = \\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi\n$$\n因此，体平均压力为：\n$$\n\\langle p \\rangle = \\frac{\\pi^2 \\kappa a^2 (R_0+\\Delta) c_p \\Delta\\psi}{2\\pi^2 \\kappa a^2 (R_0+\\Delta)} = \\frac{1}{2} c_p \\Delta\\psi\n$$\n接下来，我们求解外侧中平面边界处的极向磁场 $B_{p,\\text{out}}$。该点对应于 $\\rho=1, \\theta=0$，所以 $(R,Z) = (R_0+\\Delta+a, 0)$。极向磁场为 $\\vec{B}_p = \\frac{1}{R}(\\nabla\\psi \\times \\hat{\\phi})$。其大小为 $B_p = \\frac{1}{R}|\\nabla\\psi|$。由于 $\\psi=\\psi(\\rho)$，我们有 $\\nabla\\psi = \\frac{d\\psi}{d\\rho}\\nabla\\rho$。\n使用二次模型 $\\psi(\\rho)$，我们有 $d\\psi/d\\rho = 2\\Delta\\psi \\rho$，在 $\\rho=1$ 时为 $2\\Delta\\psi$。\n从坐标变换中计算 $|\\nabla\\rho|$：$|\\nabla\\rho|^2 = g^{\\rho\\rho} = g_{\\theta\\theta}/J^2$。\n$g_{\\theta\\theta} = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2 = [a\\rho(-\\sin\\theta+\\delta\\cos\\theta)]^2 + [\\kappa a \\rho \\cos\\theta]^2$\n在外侧中平面 ($\\theta=0$) 处：$g_{\\theta\\theta}|_{\\theta=0} = a^2\\rho^2(\\delta^2+\\kappa^2)$\n所以在 $\\theta=0$ 处：$|\\nabla\\rho|^2_{\\theta=0} = \\frac{a^2\\rho^2(\\delta^2+\\kappa^2)}{\\kappa^2 a^4 \\rho^2} = \\frac{\\delta^2+\\kappa^2}{\\kappa^2 a^2}$。\n外侧边界 ($\\rho=1, \\theta=0$) 处的极向磁场为：\n$$\nB_{p,\\text{out}} = \\frac{1}{R(1,0)} \\left|\\frac{d\\psi}{d\\rho}\\right|_{\\rho=1} |\\nabla\\rho|_{\\rho=1, \\theta=0} = \\frac{1}{R_0+\\Delta+a} (2\\Delta\\psi) \\frac{\\sqrt{\\delta^2+\\kappa^2}}{\\kappa a}\n$$\n在 $a/R_0$ 的主导阶上，对于小三角形变 $|\\delta| \\ll 1$，我们有 $R_0+\\Delta+a \\approx R_0$ 和 $\\sqrt{\\delta^2+\\kappa^2} \\approx \\kappa(1 + O(\\delta^2))$。\n$$\nB_{p,\\text{out}} \\approx \\frac{2\\Delta\\psi}{R_0} \\frac{\\kappa}{\\kappa a} \\left(1+O\\left(\\delta^2\\right)\\right) = \\frac{2\\Delta\\psi}{a R_0} \\left(1+O(\\delta^2)\\right)\n$$\n因此，在主导阶上，三角形变 $\\delta$ 不出现在 $B_{p,\\text{out}}$ 的表达式中。\n\n**第二部分：极向 Beta**\n\n极向 beta 定义为 $\\beta_p \\equiv \\frac{2\\mu_0 \\langle p \\rangle}{B_{p,\\text{out}}^2}$。使用第一部分的结果：\n$$\n\\beta_p = \\frac{\\mu_0 c_p \\Delta\\psi (R_0+\\Delta+a)^2 \\kappa^2 a^2}{4(\\Delta\\psi)^2 (\\delta^2+\\kappa^2)} = \\frac{\\mu_0 c_p a^2 \\kappa^2 (R_0+\\Delta+a)^2}{4\\Delta\\psi (\\delta^2+\\kappa^2)}\n$$\n为消去 $\\Delta\\psi$，我们将 Solov'ev 磁通函数 $\\psi(R,Z)$ 在磁轴 $(R_a, 0)$ 附近展开，其中 $R_a=R_0+\\Delta$。\n$\\psi(R,Z) \\approx \\psi_{ax} + \\frac{1}{2}\\psi_{RR}(R-R_a)^2 + \\frac{1}{2}\\psi_{ZZ}Z^2$，其中 $\\psi_{RR}$ 和 $\\psi_{ZZ}$ 是在磁轴处的二阶偏导数。\n磁面的形状给出了拉长率 $\\kappa^2 = \\psi_{RR}/\\psi_{ZZ}$。磁通差为 $\\Delta\\psi = \\psi_b-\\psi_{ax} = \\frac{1}{2}\\psi_{RR} a^2$。\n在磁轴处使用 Grad-Shafranov 方程：$\\psi_{RR} + \\psi_{ZZ} = \\mu_0 c_p R_a^2 + c_F/2$。\n使用 $\\psi_{ZZ}=\\psi_{RR}/\\kappa^2$，我们得到 $\\psi_{RR}(1+1/\\kappa^2) = \\mu_0 c_p R_a^2 + c_F/2$。\n$$\n\\psi_{RR} = \\frac{\\kappa^2}{1+\\kappa^2} \\left( \\mu_0 c_p R_a^2 + \\frac{c_F}{2} \\right)\n$$\n代入 $\\beta_p$ 的表达式（并设 $\\delta=0$ 以取主导阶）：\n$$\n\\beta_p = \\frac{\\mu_0 c_p (R_a+a)^2}{2\\psi_{RR}} = \\frac{\\mu_0 c_p (R_a+a)^2 (1+\\kappa^2)}{2\\kappa^2 (\\mu_0 c_p R_a^2 + c_F/2)}\n$$\n在大环径比极限下，$R_a \\approx R_0$ 且 $R_a+a \\approx R_0$。这给出了用 Solov'ev 参数和 $\\kappa$ 表示的 $\\beta_p$ 表达式：\n$$\n\\beta_p \\approx \\frac{\\mu_0 c_p R_0^2 (1+\\kappa^2)}{2\\kappa^2 (\\mu_0 c_p R_0^2 + c_F/2)}\n$$\n\n**第三部分：Shafranov 位移**\n\n问题要求推导 Shafranov 位移 $\\Delta$ 和 $\\beta_p$ 之间的关系。这个结果是 MHD 平衡理论的基石，源于等离子体柱上的水平力平衡。\n对于大环径比、宽电流分布的椭圆等离子体，位移的标准结果是：\n$$\n\\Delta = \\frac{a^2}{R_0} \\left( \\beta_p \\frac{1+1/\\kappa^2}{2} + \\frac{l_i}{2} \\right)\n$$\n这里，$l_i$ 是内感。问题所要求的形式 $\\Delta = (a^2/R_0) S(\\kappa) \\beta_p$ 意味着内感的贡献被忽略了，这是一个分离出等离子体压力效应的简化。\n在这些假设下，位移纯粹由压力项驱动：\n$$\n\\Delta \\approx \\frac{a^2}{R_0} \\beta_p \\left( \\frac{1+1/\\kappa^2}{2} \\right)\n$$\n这个表达式与所要求的形式 $\\Delta = (a^2/R_0) S(\\kappa) \\beta_p$ 相匹配，从中我们可以确定形状因子 $S(\\kappa)$。\n$$\nS(\\kappa) = \\frac{1}{2}\\left(1 + \\frac{1}{\\kappa^2}\\right)\n$$\n将此代入所要求的 $\\Delta$ 公式中，即可得到最终答案。\n\n$$\n\\Delta = \\left( \\frac{a^{2}}{R_{0}} \\right) \\frac{1}{2}\\left(1+\\frac{1}{\\kappa^2}\\right) \\beta_{p}\n$$\n这是在问题框架所建议的简化假设下推导出的 Shafranov 位移、等离子体几何形状和极向 beta 之间的主导阶关系。",
            "answer": "$$\n\\boxed{\\left( \\frac{a^{2}}{R_{0}} \\right) \\frac{1}{2}\\left(1+\\frac{1}{\\kappa^2}\\right) \\beta_{p}}\n$$"
        },
        {
            "introduction": "理论必须与实践相结合，主动控制等离子体位形对于托卡马克装置的性能至关重要。本计算练习将理论应用于工程实践，向你展示如何构建一个“影响矩阵”。这个矩阵是托卡马克位形控制中的一个基本工具，它量化了外部极向场线圈如何精确地塑造等离子体边界，让你直接面对聚变反应堆控制的工程挑战 。",
            "id": "3714246",
            "problem": "给定一个用于类托卡马克位形的轴对称自由边界磁静定成形任务。目标是利用真空场的格林函数，计算一个线性影响矩阵。该矩阵将环向场（PF）线圈电流映射到与等离子体边界的所谓拉长模和三角化模相关的边界傅里叶系数。在等离子体外部采用真空磁静力学和大环径比的假设下进行计算，并使用圆形环路格林函数处理外部场。\n\n出发点和定义：\n- 在真空中，磁场满足 $\\nabla \\times \\mathbf{B} = \\mathbf{0}$ 和 $\\nabla \\cdot \\mathbf{B} = 0$。对于轴对称性，使用环向矢量势 $\\mathbf{A} = A_{\\phi}(R,Z)\\,\\hat{\\boldsymbol{\\phi}}$，其中极向磁通量定义为 $\\psi(R,Z) = R\\,A_{\\phi}(R,Z)$。\n- 对于位于 $(R_{\\mathrm{c}}, Z_{\\mathrm{c}})$、载有电流 $I$ 的单个圆形灯丝电流环，其对 $A_{\\phi}$（因此对 $\\psi$）的贡献可以通过涉及完全椭圆积分的轴对称格林函数计算。您必须使用该格林函数模型来评估每个PF线圈在 $(R,Z)$ 处产生的 $\\psi(R,Z)$。对于多个线圈，进行线性叠加。\n- 考虑一个给定的参考等离子体边界，它是一个以 $(R_0, Z_0)$ 为中心、小半径为 $a$ 的圆，由极向角 $\\theta \\in [0, 2\\pi)$（弧度）参数化为\n$$\nR(\\theta) = R_0 + a \\cos\\theta,\\quad Z(\\theta) = Z_0 + a \\sin\\theta.\n$$\n- 设此圆形边界上的向外单位法向量为 $\\hat{\\mathbf{n}}(\\theta) = \\left(\\cos\\theta,\\ \\sin\\theta\\right)$。\n- 假设边界上存在一个恒定的参考极向磁通梯度大小，记为 $|\\nabla \\psi_0| \\equiv G$（单位为 $\\mathrm{Wb/m}$）。每个测试用例都会给出该 $G$ 值。在由PF线圈引起的微小外部真空扰动 $\\delta \\psi(\\theta)$ 下，参考边界的一阶法向位移为\n$$\n\\xi_n(\\theta) = -\\frac{\\delta \\psi(\\theta)}{G}.\n$$\n- 将 $\\xi_n(\\theta)$ 展开为傅里叶级数\n$$\n\\xi_n(\\theta) = \\sum_{m=0}^{\\infty}\\left[c_m \\cos(m\\theta) + s_m \\sin(m\\theta)\\right],\n$$\n其系数通过连续正交关系计算\n$$\nc_m = \\frac{1}{\\pi}\\int_{0}^{2\\pi} \\xi_n(\\theta)\\cos(m\\theta)\\, d\\theta,\\quad\ns_m = \\frac{1}{\\pi}\\int_{0}^{2\\pi} \\xi_n(\\theta)\\sin(m\\theta)\\, d\\theta.\n$$\n- 在圆形谐波基中，$m=2$ 分量表示拉长模，$m=3$ 分量表示三角化模。定义归一化系数（无量纲，当按电流缩放时单位为每安培）为\n$$\nk_c \\equiv \\frac{c_2}{a},\\quad k_s \\equiv \\frac{s_2}{a},\\quad d_c \\equiv \\frac{c_3}{a},\\quad d_s \\equiv \\frac{s_3}{a}.\n$$\n这些是与拉长模（$m=2$）和三角化模（$m=3$）相关的边界傅里叶系数。\n\n目标量（影响矩阵）：\n- 设有 $N_{\\mathrm{coil}}$ 个PF线圈，每个都建模为位于 $(R_{\\mathrm{c},j}, Z_{\\mathrm{c},j})$ 的圆形灯丝。根据线性关系，定义一个 $4 \\times N_{\\mathrm{coil}}$ 的影响矩阵 $\\mathbf{M}$，其第 $j$ 列对应于当线圈 $j$ 中有单位电流 $I_j = 1\\,\\mathrm{A}$（而所有其他线圈电流为零）时，从边界响应中获得的归一化系数 $(k_c, k_s, d_c, d_s)$。因此，对于一个一般的线圈电流向量 $\\mathbf{I} \\in \\mathbb{R}^{N_{\\mathrm{coil}}}$（单位为安培），\n$$\n\\begin{bmatrix}\nk_c \\\\ k_s \\\\ d_c \\\\ d_s\n\\end{bmatrix}\n= \\mathbf{M}\\,\\mathbf{I}.\n$$\n$\\mathbf{M}$ 的每个元素单位为 $\\mathrm{A}^{-1}$。\n\n数值实现要求：\n- 使用涉及完全椭圆积分的轴对称圆形环路格林函数，计算每个线圈在边界点 $(R(\\theta), Z(\\theta))$ 处产生的极向磁通量 $\\psi(R,Z)$。\n- 使用磁常数 $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$。\n- 用 $N_{\\theta} = 512$ 个在 $[0, 2\\pi)$（弧度）上均匀分布的点离散化极向角，并使用梯形（均匀）法则近似傅里叶系数，\n$$\nc_m \\approx \\frac{1}{\\pi}\\sum_{j=0}^{N_{\\theta}-1}\\xi_n(\\theta_j)\\cos(m\\theta_j)\\,\\Delta\\theta,\\quad\ns_m \\approx \\frac{1}{\\pi}\\sum_{j=0}^{N_{\\theta}-1}\\xi_n(\\theta_j)\\sin(m\\theta_j)\\,\\Delta\\theta,\n$$\n其中 $\\Delta\\theta = \\frac{2\\pi}{N_{\\theta}}$。\n- 使用每个线圈贡献的叠加。对于 $\\mathbf{M}$ 的第 $j$ 列，设置 $I_j = 1\\,\\mathrm{A}$ 且 $I_{i\\neq j} = 0$。\n- 将最终输出表示为无量纲的每安培系数（即，单位为 $\\mathrm{A}^{-1}$）。最终结果中不应出现角度。\n\n测试套件：\n为以下三个独立情况中的每一种计算影响矩阵 $\\mathbf{M}$。在所有情况下，线圈位置和所有长度以 $\\mathrm{m}$ 表示，梯度大小 $G$ 以 $\\mathrm{Wb/m}$ 表示，电流以 $\\mathrm{A}$ 表示。角度必须以弧度为单位。您的程序必须将每个情况的 $\\mathbf{M}$ 输出为一个包含 $4\\times N_{\\mathrm{coil}}$ 个浮点数的单行展平列表，按行主序排列（行序为 $[k_c, k_s, d_c, d_s]$）。将每个数字四舍五入到 $8$ 位小数。\n\n- 情况 1：\n  - 边界：$R_0 = 3.0$, $Z_0 = 0.0$, $a = 1.0$, $G = 1.5$.\n  - 线圈 ($N_{\\mathrm{coil}}=4$)：$(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (2.5, 2.0)$, $(2.5, -2.0)$, $(5.5, 1.0)$, $(5.5, -1.0)$。\n\n- 情况 2：\n  - 边界：$R_0 = 4.0$, $Z_0 = 0.0$, $a = 0.8$, $G = 1.2$.\n  - 线圈 ($N_{\\mathrm{coil}}=3$)：$(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (3.0, 2.5)$, $(3.0, -2.5)$, $(6.0, 0.0)$。\n\n- 情况 3：\n  - 边界：$R_0 = 3.0$, $Z_0 = 0.0$, $a = 1.0$, $G = 2.0$.\n  - 线圈 ($N_{\\mathrm{coil}}=2$)：$(R_{\\mathrm{c}}, Z_{\\mathrm{c}}) = (7.0, 4.0)$, $(7.0, -4.0)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是该用例展平后的影响矩阵条目的列表。确切地说，输出格式必须是\n$$\n[\\,[m_{1,1}, m_{1,2}, \\dots, m_{1,4N_{\\mathrm{coil}}}],\\ [m_{2,1}, m_{2,2}, \\dots, m_{2,4N_{\\mathrm{coil}}}],\\ [m_{3,1}, m_{3,2}, \\dots, m_{3,4N_{\\mathrm{coil}}}]\\,],\n$$\n其中每个 $m_{i,j}$ 都四舍五入到 $8$ 位小数。不得打印任何额外文本。",
            "solution": "解决方案通过执行问题陈述中概述的步骤来进行。核心任务是计算 $4 \\times N_{\\mathrm{coil}}$ 的影响矩阵 $\\mathbf{M}$，该矩阵将 $N_{\\mathrm{coil}}$ 个极向场（PF）线圈中的电流线性映射到等离子体边界形状扰动的傅里叶系数，这些系数对应于拉长模（$m=2$）和三角化模（$m=3$）。\n\n**1. 来自圆形电流环的极向磁通**\n计算的基础是由外部PF线圈产生的磁场。在轴对称系统中，磁场可以方便地由极向磁通函数 $\\psi(R,Z)$ 描述。对于一个半径为 $R_{\\mathrm{c}}$、位于轴向位置 $Z_{\\mathrm{c}}$、载有电流 $I$ 的单个圆形灯丝线圈，其在真空中某点 $(R,Z)$ 的极向磁通由下式给出：\n$$\n\\psi(R,Z) = \\frac{\\mu_0 I}{\\pi k} \\sqrt{R R_{\\mathrm{c}}} \\left[ \\left(1 - \\frac{k^2}{2}\\right) K(k^2) - E(k^2) \\right]\n$$\n此处，$\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ 是磁常数，椭圆积分的模数 $k$ 是线圈和评估点几何位置的函数：\n$$\nk^2 = \\frac{4 R R_{\\mathrm{c}}}{(R+R_{\\mathrm{c}})^2 + (Z-Z_{\\mathrm{c}})^2}\n$$\n函数 $K(k^2)$ 和 $E(k^2)$ 将使用 `scipy.special` 库进行数值评估。由于真空中的麦克斯韦方程是线性的，来自 $N_{\\mathrm{coil}}$ 个线圈的总磁通是每个单独线圈磁通的线性叠加。\n\n**2. 等离子体边界扰动**\n问题规定了一个以 $(R_0, Z_0)$ 为中心、小半径为 $a$ 的参考圆形等离子体边界。该边界由极向角 $\\theta$ 参数化：\n$$\nR(\\theta) = R_0 + a \\cos\\theta, \\quad Z(\\theta) = Z_0 + a \\sin\\theta\n$$\n由外部PF线圈施加在此边界上的微小真空磁通扰动 $\\delta\\psi$ 会引起一阶法向位移 $\\xi_n(\\theta)$，由线性响应模型给出：\n$$\n\\xi_n(\\theta) = -\\frac{\\delta\\psi(\\theta)}{G}\n$$\n其中 $G = |\\nabla \\psi_0|$ 是边界上给定的平衡态极向磁通梯度的量值。\n\n**3. 傅里叶分析与影响矩阵构建**\n边界位移 $\\xi_n(\\theta)$ 通过其傅里叶分量进行分析。我们关心的是 $m=2$ 和 $m=3$ 模式的系数。\n$$\n\\xi_n(\\theta) = \\sum_{m=0}^{\\infty}\\left[c_m \\cos(m\\theta) + s_m \\sin(m\\theta)\\right]\n$$\n问题指定了一种基于极向角离散化的数值积分方法，将极向角离散为 $N_{\\theta} = 512$ 个点，$\\theta_j = j \\frac{2\\pi}{N_{\\theta}}$，其中 $j=0, \\dots, N_{\\theta}-1$。使用梯形法则，系数近似为：\n$$\nc_m \\approx \\frac{2}{N_{\\theta}} \\sum_{j=0}^{N_{\\theta}-1} \\xi_n(\\theta_j) \\cos(m\\theta_j)\n$$\n$$\ns_m \\approx \\frac{2}{N_{\\theta}} \\sum_{j=0}^{N_{\\theta}-1} \\xi_n(\\theta_j) \\sin(m\\theta_j)\n$$\n最后，这些系数通过小半径 $a$ 进行归一化，以得到拉长模（$k_c, k_s$）和三角化模（$d_c, d_s$）的无量纲每安培系数：\n$$\nk_c = \\frac{c_2}{a}, \\quad k_s = \\frac{s_2}{a}, \\quad d_c = \\frac{c_3}{a}, \\quad d_s = \\frac{s_3}{a}\n$$\n影响矩阵 $\\mathbf{M}$ 是逐列构建的。对于每个线圈 $j = 1, \\dots, N_{\\mathrm{coil}}$，我们将其电流设置为单位值 $I_j = 1\\,\\mathrm{A}$，并将所有其他电流设置为零。然后执行以下步骤：\n1.  将边界离散为 $N_{\\theta}$ 个点 $(R(\\theta_j), Z(\\theta_j))$。\n2.  使用极向磁通公式计算这些点上的磁通扰动向量 $\\delta\\boldsymbol{\\psi} = [\\delta\\psi(\\theta_0), \\dots, \\delta\\psi(\\theta_{N_{\\theta}-1})]$。\n3.  计算法向位移向量 $\\boldsymbol{\\xi}_n = -\\delta\\boldsymbol{\\psi} / G$。\n4.  使用数值傅里叶变换求和计算系数 $c_2, s_2, c_3, s_3$。\n5.  将这些系数归一化以获得 $k_c, k_s, d_c, d_s$。这四个值构成了矩阵 $\\mathbf{M}$ 的第 $j$ 列。\n对所有线圈重复此过程。得到的 $4 \\times N_{\\mathrm{coil}}$ 矩阵随后按行主序展平为单个列表以供输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\nfrom scipy.constants import mu_0\n\ndef calculate_influence_matrix(case_params):\n    \"\"\"\n    Computes the influence matrix M for a single test case.\n    \"\"\"\n    R0, Z0, a, G, coils = case_params\n    N_theta = 512\n    N_coil = len(coils)\n\n    # Initialize the 4 x N_coil influence matrix\n    M = np.zeros((4, N_coil))\n\n    # 1. Discretize the boundary\n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    R_b = R0 + a * np.cos(theta)\n    Z_b = Z0 + a * np.sin(theta)\n\n    # Loop over coils to compute each column of M\n    for j, (Rc, Zc) in enumerate(coils):\n        I_unit = 1.0  # Unit current in Amperes\n\n        # 2. Calculate the poloidal flux perturbation delta_psi on the boundary\n        # This part is vectorized for efficiency over all N_theta points.\n        m_numerator = 4 * R_b * Rc\n        m_denominator = (R_b + Rc)**2 + (Z_b - Zc)**2\n        \n        # m is the squared modulus k^2\n        m = m_numerator / m_denominator\n        k = np.sqrt(m)\n        \n        K_m = ellipk(m)\n        E_m = ellipe(m)\n\n        # The term in brackets of the psi formula\n        term_in_brackets = (1 - m / 2) * K_m - E_m\n\n        # Calculate psi using the provided formula, handling k=0 case\n        # psi = (mu_0 * I / (pi * k)) * sqrt(R * Rc) * term_in_brackets\n        prefactor = (mu_0 * I_unit / np.pi) * np.sqrt(R_b * Rc)\n        \n        # Use np.divide to avoid division by zero where k=0\n        delta_psi = prefactor * np.divide(term_in_brackets, k, out=np.zeros_like(k), where=k!=0)\n\n        # 3. Calculate the normal displacement xi_n\n        xi_n = -delta_psi / G\n\n        # 4. Compute Fourier coefficients using the trapezoidal rule\n        # c_m = (2/N_theta) * sum(xi_n * cos(m*theta))\n        # s_m = (2/N_theta) * sum(xi_n * sin(m*theta))\n        \n        # For m=2 (elongation)\n        cos_2theta = np.cos(2 * theta)\n        sin_2theta = np.sin(2 * theta)\n        c2 = (2 / N_theta) * np.sum(xi_n * cos_2theta)\n        s2 = (2 / N_theta) * np.sum(xi_n * sin_2theta)\n\n        # For m=3 (triangularity)\n        cos_3theta = np.cos(3 * theta)\n        sin_3theta = np.sin(3 * theta)\n        c3 = (2 / N_theta) * np.sum(xi_n * cos_3theta)\n        s3 = (2 / N_theta) * np.sum(xi_n * sin_3theta)\n\n        # 5. Normalize coefficients by minor radius 'a'\n        k_c = c2 / a\n        k_s = s2 / a\n        d_c = c3 / a\n        d_s = s3 / a\n        \n        # Store these four values in the j-th column of M\n        M[:, j] = [k_c, k_s, d_c, d_s]\n\n    # Flatten M in row-major order ('C' style)\n    M_flat = M.flatten('C')\n    \n    # Round to 8 decimal places as required\n    return [round(x, 8) for x in M_flat]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, compute results, and print the output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (3.0, 0.0, 1.0, 1.5, [(2.5, 2.0), (2.5, -2.0), (5.5, 1.0), (5.5, -1.0)]),\n        # Case 2\n        (4.0, 0.0, 0.8, 1.2, [(3.0, 2.5), (3.0, -2.5), (6.0, 0.0)]),\n        # Case 3\n        (3.0, 0.0, 1.0, 2.0, [(7.0, 4.0), (7.0, -4.0)])\n    ]\n\n    results = []\n    for case in test_cases:\n        m_flat_rounded = calculate_influence_matrix(case)\n        results.append(m_flat_rounded)\n\n    # Final print statement in the exact required format.\n    # The format required is a list of lists. The conversion to string\n    # handles the inner list formatting automatically.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}