{
    "hands_on_practices": [
        {
            "introduction": "在计算科学中，验证代码的正确性至关重要。本练习将引导您使用“制造解方法”（Method of Manufactured Solutions, MMS），这是一种强大的技术，用于测试数值求解器的实现是否正确以及是否达到了预期的收敛阶。您将为一个二维斯托克斯流问题构建一个解析基准 ，并编写程序来验证有限差分格式的离散无散性和动量平衡精度。",
            "id": "3517703",
            "problem": "考虑在单位正方形域 $\\Omega = (0,1)\\times(0,1)$ 上，二维空间中牛顿流体的不可压缩、稳态斯托克斯方程。其位置矢量为 $\\mathbf{x} = (x,y)$，速度场为 $\\mathbf{u}(\\mathbf{x}) = (u(\\mathbf{x}), v(\\mathbf{x}))$，压力场为 $p(\\mathbf{x})$，动力粘度为 $\\mu > 0$，体力为 $\\mathbf{f}(\\mathbf{x}) = (f_1(\\mathbf{x}), f_2(\\mathbf{x}))$，以及边界速度数据为 $\\mathbf{g}$：\n$$\n-\\mu \\nabla^2 \\mathbf{u} + \\nabla p = \\mathbf{f} \\quad \\text{in } \\Omega,\\qquad \\nabla \\cdot \\mathbf{u} = 0 \\quad \\text{in } \\Omega,\\qquad \\mathbf{u} = \\mathbf{g} \\quad \\text{on } \\partial\\Omega.\n$$\n该问题采用无量纲变量进行描述；无需物理单位。所有三角函数中的角度必须以弧度为单位。\n\n通过指定以下场，设计一个用于方腔内斯托克斯流的制造解析基准，该流场严格无散并满足均匀狄利克雷（无滑移）边界条件：\n$$\nu(x,y) = \\sin^2(\\pi x)\\,\\sin(2\\pi y),\\qquad v(x,y) = -\\sin(2\\pi x)\\,\\sin^2(\\pi y),\\qquad p(x,y) = \\cos(\\pi x)\\,\\cos(\\pi y),\n$$\n在 $\\Omega$ 上。定义 $\\mathbf{g} = \\mathbf{u}\\vert_{\\partial\\Omega}$，并通过将 $\\mathbf{u}$ 和 $p$ 代入斯托克斯动量平衡方程来计算体力 $\\mathbf{f}$。您制造的解必须用于在同位、结构化网格上数值验证离散不可压缩性和动量平衡。\n\n从不可压缩流动的标准质量和动量守恒定律出发，构建由您制造的场隐含的体力 $\\mathbf{f}$。然后，给定一个均匀网格，其在 $x$ 方向有 $N_x$ 个点，在 $y$ 方向有 $N_y$ 个点，间距分别为 $h_x = 1/(N_x-1)$ 和 $h_y = 1/(N_y-1)$，在内部点上使用二阶中心有限差分执行以下验证：\n- 计算离散散度\n$$\n(\\nabla_h\\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2 h_x} + \\frac{v_{i,j+1} - v_{i,j-1}}{2 h_y},\n$$\n并报告所有内部索引 $(i,j)$ 上的最大绝对值，该值量化了离散无散特性。\n- 使用制造的 $\\mathbf{f}$ 和 $p$ 计算离散动量残差\n$$\n\\mathbf{r}_{i,j} = \\begin{pmatrix}\n-\\mu \\left(\\frac{u_{i+1,j} - 2 u_{i,j} + u_{i-1,j}}{h_x^2} + \\frac{u_{i,j+1} - 2 u_{i,j} + u_{i,j-1}}{h_y^2}\\right) + \\frac{p_{i+1,j} - p_{i-1,j}}{2 h_x} - f_{1;i,j} \\\\\n-\\mu \\left(\\frac{v_{i+1,j} - 2 v_{i,j} + v_{i-1,j}}{h_x^2} + \\frac{v_{i,j+1} - 2 v_{i,j} + v_{i,j-1}}{h_y^2}\\right) + \\frac{p_{i,j+1} - p_{i,j-1}}{2 h_y} - f_{2;i,j}\n\\end{pmatrix},\n$$\n报告所有内部索引上欧几里得范数 $\\|\\mathbf{r}_{i,j}\\|_2$ 的最大值，该值量化了离散动量平衡的准确性。\n\n您必须实现一个程序，该程序：\n- 在网格节点 $(x_i, y_j)$ 上评估解析场 $u(x,y)$、$v(x,y)$ 和 $p(x,y)$，并通过根据斯托克斯动量平衡方程对制造解进行微分来计算解析体力 $\\mathbf{f}(x,y)$。\n- 对测试套件中的每个测试用例，在内部节点上计算上述两个验证指标。\n- 生成单行输出，将所有提供的测试用例的结果汇总到一个由方括号括起来的逗号分隔的浮点数列表中。对于每个测试用例，数字必须成对排列：首先是最大绝对离散散度，然后是离散动量残差的最大欧几里得范数。因此，最终的输出格式必须是\n$$\n[\\text{div}_{1},\\text{res}_{1},\\text{div}_{2},\\text{res}_{2},\\ldots,\\text{div}_{T},\\text{res}_{T}],\n$$\n其中 $T$ 是测试用例的数量。\n\n使用以下测试套件，该套件探测了离散化的不同方面：\n- 用例 1：$N_x = 16$， $N_y = 16$， $\\mu = 1$ (一般情况)。\n- 用例 2：$N_x = 32$， $N_y = 32$， $\\mu = 1$ (加密网格以测试误差衰减)。\n- 用例 3：$N_x = 8$， $N_y = 8$， $\\mu = 0.1$ (粘度较小的粗网格)。\n- 用例 4：$N_x = 64$， $N_y = 16$， $\\mu = 10$ (各向异性网格和大粘度)。\n- 用例 5：$N_x = 4$， $N_y = 4$， $\\mu = 1$ (边界受限的极粗内部网格)。\n\n所有计算都是无量纲的。角度必须以弧度为单位。对于每个测试用例，您的程序必须按规定输出两个浮点值。您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如， $[\\text{result}_1,\\text{result}_2,\\text{result}_3]$）。",
            "solution": "所提供的问题陈述是制造解方法（Method of Manufactured Solutions）中的一个有效练习，用于验证稳态、不可压缩斯托克斯方程的数值离散化。任务所需的所有组件都定义清晰、科学合理且数学上一致。\n\n该方法的核心是为主要场 $\\mathbf{u}(\\mathbf{x})$ 和 $p(\\mathbf{x})$ 定义一个解析解，并将其代入控制偏微分方程以计算相应的源项或体力项 $\\mathbf{f}(\\mathbf{x})$。这就创建了一个先验已知精确解的基准问题。\n\n制造的解场由下式给出：\n$$u(x,y) = \\sin^2(\\pi x)\\,\\sin(2\\pi y)$$\n$$v(x,y) = -\\sin(2\\pi x)\\,\\sin^2(\\pi y)$$\n$$p(x,y) = \\cos(\\pi x)\\,\\cos(\\pi y)$$\n在域 $\\Omega = (0,1)\\times(0,1)$ 上。\n\n首先，我们验证制造的速度场 $\\mathbf{u} = (u, v)$ 与问题的物理约束一致。\n不可压缩性约束 $\\nabla \\cdot \\mathbf{u} = 0$ 在解析上是满足的：\n$$\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\sin^2(\\pi x)\\,\\sin(2\\pi y) \\right) = 2\\pi\\sin(\\pi x)\\cos(\\pi x)\\sin(2\\pi y) = \\pi\\sin(2\\pi x)\\sin(2\\pi y)$$\n$$\\frac{\\partial v}{\\partial y} = \\frac{\\partial}{\\partial y} \\left( -\\sin(2\\pi x)\\,\\sin^2(\\pi y) \\right) = -2\\pi\\sin(2\\pi x)\\sin(\\pi y)\\cos(\\pi y) = -\\pi\\sin(2\\pi x)\\sin(2\\pi y)$$\n$$\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = \\pi\\sin(2\\pi x)\\sin(2\\pi y) - \\pi\\sin(2\\pi x)\\sin(2\\pi y) = 0$$\n均匀狄利克雷（无滑移）边界条件 $\\mathbf{u} = \\mathbf{0}$ on $\\partial\\Omega$ 也得到满足。对于边界 $\\partial\\Omega$ 上的任何点，要么 $x \\in \\{0, 1\\}$，要么 $y \\in \\{0, 1\\}$。\n对于 $u(x,y) = \\sin^2(\\pi x)\\sin(2\\pi y)$，如果 $x=0$ 或 $x=1$，则 $\\sin^2(\\pi x)=0$。如果 $y=0$ 或 $y=1$，则 $\\sin(2\\pi y)=0$。因此，在 $\\partial\\Omega$ 上 $u=0$。\n对于 $v(x,y) = -\\sin(2\\pi x)\\sin^2(\\pi y)$，如果 $x=0$ 或 $x=1$，则 $\\sin(2\\pi x)=0$。如果 $y=0$ 或 $y=1$，则 $\\sin^2(\\pi y)=0$。因此，在 $\\partial\\Omega$ 上 $v=0$。\n\n接下来，我们通过将制造的场代入斯托克斯动量方程 $\\mathbf{f} = -\\mu \\nabla^2 \\mathbf{u} + \\nabla p$ 来推导解析体力 $\\mathbf{f} = (f_1, f_2)$。这需要计算速度分量的拉普拉斯算子 $\\nabla^2 u$ 和 $\\nabla^2 v$，以及压力的梯度 $\\nabla p$。\n\n对于速度的 $u$ 分量：\n$$\\frac{\\partial^2 u}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left( \\pi\\sin(2\\pi x)\\sin(2\\pi y) \\right) = 2\\pi^2\\cos(2\\pi x)\\sin(2\\pi y)$$\n$$\\frac{\\partial^2 u}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left( 2\\pi\\sin^2(\\pi x)\\cos(2\\pi y) \\right) = -4\\pi^2\\sin^2(\\pi x)\\sin(2\\pi y)$$\n$$\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} = 2\\pi^2\\cos(2\\pi x)\\sin(2\\pi y) - 4\\pi^2\\sin^2(\\pi x)\\sin(2\\pi y)$$\n\n对于速度的 $v$ 分量：\n$$\\frac{\\partial^2 v}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left( -2\\pi\\cos(2\\pi x)\\sin^2(\\pi y) \\right) = 4\\pi^2\\sin(2\\pi x)\\sin^2(\\pi y)$$\n$$\\frac{\\partial^2 v}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left( -\\pi\\sin(2\\pi x)\\sin(2\\pi y) \\right) = -2\\pi^2\\sin(2\\pi x)\\cos(2\\pi y)$$\n$$\\nabla^2 v = \\frac{\\partial^2 v}{\\partial x^2} + \\frac{\\partial^2 v}{\\partial y^2} = 4\\pi^2\\sin(2\\pi x)\\sin^2(\\pi y) - 2\\pi^2\\sin(2\\pi x)\\cos(2\\pi y)$$\n\n对于压力场：\n$$\\frac{\\partial p}{\\partial x} = -\\pi\\sin(\\pi x)\\cos(\\pi y)$$\n$$\\frac{\\partial p}{\\partial y} = -\\pi\\cos(\\pi x)\\sin(\\pi y)$$\n\n将这些项组合起来，得到体力矢量 $\\mathbf{f}$ 的分量：\n$$f_1(x,y) = -\\mu \\nabla^2 u + \\frac{\\partial p}{\\partial x} = -\\mu\\left(2\\pi^2\\cos(2\\pi x)\\sin(2\\pi y) - 4\\pi^2\\sin^2(\\pi x)\\sin(2\\pi y)\\right) - \\pi\\sin(\\pi x)\\cos(\\pi y)$$\n$$f_2(x,y) = -\\mu \\nabla^2 v + \\frac{\\partial p}{\\partial y} = -\\mu\\left(4\\pi^2\\sin(2\\pi x)\\sin^2(\\pi y) - 2\\pi^2\\sin(2\\pi x)\\cos(2\\pi y)\\right) - \\pi\\cos(\\pi x)\\sin(\\pi y)$$\n\n数值验证过程如下：\n对于由 $(N_x, N_y, \\mu)$ 定义的每个测试用例，构建一个均匀网格。网格的节点坐标为 $(x_i, y_j) = (i h_x, j h_y)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_y-1\\}$，网格间距为 $h_x = 1/(N_x-1)$ 和 $h_y = 1/(N_y-1)$。\n在所有网格节点 $(x_i, y_j)$ 上评估解析场 $u, v, p$ 和推导出的体力分量 $f_1, f_2$，以获得离散场 $u_{i,j}, v_{i,j}, p_{i,j}, f_{1;i,j}$ 和 $f_{2;i,j}$。\n\n这两个验证指标在内部网格节点集合上计算，其中 $i \\in \\{1, \\dots, N_x-2\\}$ 且 $j \\in \\{1, \\dots, N_y-2\\}$。\n1. 离散散度 $(\\nabla_h\\cdot \\mathbf{u})_{i,j}$ 使用提供的二阶中心差分公式计算。计算此量在所有内部节点上的最大绝对值。该指标量化了离散速度场满足不可压缩性约束的程度。预期误差很小，当 $h_x, h_y \\to 0$ 时趋近于零。\n2. 离散动量残差 $\\mathbf{r}_{i,j}$ 使用用于拉普拉斯算子和梯度算子的二阶中心差分格式计算。该残差代表了离散化的截断误差，因为根据构造，解析解使得连续方程等于零。计算所有内部节点上欧几里得范数 $\\|\\mathbf{r}_{i,j}\\|_2$ 的最大值。该指标衡量了动量平衡离散化的准确性。由于差分格式是二阶的，预期该误差会以 $O(h_x^2 + h_y^2)$ 的速率衰减。\n\n该实现对问题陈述中指定的每个测试用例执行这些计算，并利用向量化数组操作以提高效率。最终输出是一个列表，其中包含每个案例的两个指标对。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Stokes manufactured solution problem for a given set of test cases.\n    \"\"\"\n\n    def u_analytic(X, Y):\n        \"\"\"Analytic solution for u-velocity.\"\"\"\n        return np.sin(np.pi * X)**2 * np.sin(2 * np.pi * Y)\n\n    def v_analytic(X, Y):\n        \"\"\"Analytic solution for v-velocity.\"\"\"\n        return -np.sin(2 * np.pi * X) * np.sin(np.pi * Y)**2\n    \n    def p_analytic(X, Y):\n        \"\"\"Analytic solution for pressure.\"\"\"\n        return np.cos(np.pi * X) * np.cos(np.pi * Y)\n\n    def f1_analytic(X, Y, mu):\n        \"\"\"Analytic forcing term f1 from the momentum equation.\"\"\"\n        pi = np.pi\n        term1 = -mu * (2*pi**2 * np.cos(2*pi*X) * np.sin(2*pi*Y) - 4*pi**2 * np.sin(pi*X)**2 * np.sin(2*pi*Y))\n        term2 = -pi * np.sin(pi*X) * np.cos(pi*Y)\n        return term1 + term2\n\n    def f2_analytic(X, Y, mu):\n        \"\"\"Analytic forcing term f2 from the momentum equation.\"\"\"\n        pi = np.pi\n        term1 = -mu * (4*pi**2 * np.sin(2*pi*X) * np.sin(pi*Y)**2 - 2*pi**2 * np.sin(2*pi*X) * np.cos(2*pi*Y))\n        term2 = -pi * np.cos(pi*X) * np.sin(pi*Y)\n        return term1 + term2\n\n    def compute_metrics(Nx, Ny, mu):\n        \"\"\"\n        Computes the discrete divergence and momentum residual metrics for a given grid and viscosity.\n        \"\"\"\n        if Nx  4 or Ny  4:\n            # The problem definition implies interior points exist. The smallest case is 4x4.\n            # An interior grid of (Nx-2)x(Ny-2) requires Nx,Ny>=3. The stencils need Nx,Ny>=3.\n            # For this problem, min(Nx,Ny)=4 guarantees an interior.\n            # A 2x2 interior grid for the 4x4 case.\n            # Slicing like u[2:, 1:-1] works as long as Nx>=3, Ny>=3.\n            pass\n\n        # Grid setup\n        hx = 1.0 / (Nx - 1)\n        hy = 1.0 / (Ny - 1)\n        x = np.linspace(0, 1, Nx)\n        y = np.linspace(0, 1, Ny)\n        X, Y = np.meshgrid(x, y, indexing='ij')\n\n        # Evaluate analytic fields on the grid\n        u = u_analytic(X, Y)\n        v = v_analytic(X, Y)\n        p = p_analytic(X, Y)\n        f1 = f1_analytic(X, Y, mu)\n        f2 = f2_analytic(X, Y, mu)\n        \n        # --- Metric 1: Discrete Divergence ---\n        # Slices correspond to interior points (i in 1..Nx-2, j in 1..Ny-2)\n        # and their neighbors needed for the stencils.\n        du_dx = (u[2:, 1:-1] - u[:-2, 1:-1]) / (2 * hx)\n        dv_dy = (v[1:-1, 2:] - v[1:-1, :-2]) / (2 * hy)\n        \n        div_h = du_dx + dv_dy\n        max_abs_div = np.max(np.abs(div_h))\n\n        # --- Metric 2: Discrete Momentum Residual ---\n        u_int = u[1:-1, 1:-1]\n        v_int = v[1:-1, 1:-1]\n        \n        # Laplacian calculation\n        lap_u = ((u[2:, 1:-1] - 2*u_int + u[:-2, 1:-1]) / hx**2 +\n                 (u[1:-1, 2:] - 2*u_int + u[1:-1, :-2]) / hy**2)\n        \n        lap_v = ((v[2:, 1:-1] - 2*v_int + v[:-2, 1:-1]) / hx**2 +\n                 (v[1:-1, 2:] - 2*v_int + v[1:-1, :-2]) / hy**2)\n\n        # Gradient of pressure calculation\n        grad_p_x = (p[2:, 1:-1] - p[:-2, 1:-1]) / (2 * hx)\n        grad_p_y = (p[1:-1, 2:] - p[1:-1, :-2]) / (2 * hy)\n\n        # Forcing on interior\n        f1_int = f1[1:-1, 1:-1]\n        f2_int = f2[1:-1, 1:-1]\n        \n        # Residual components\n        res_x = -mu * lap_u + grad_p_x - f1_int\n        res_y = -mu * lap_v + grad_p_y - f2_int\n        \n        # Euclidean norm of the residual\n        res_norm = np.sqrt(res_x**2 + res_y**2)\n        max_res_norm = np.max(res_norm)\n        \n        return max_abs_div, max_res_norm\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (16, 16, 1.0),\n        (32, 32, 1.0),\n        (8, 8, 0.1),\n        (64, 16, 10.0),\n        (4, 4, 1.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, mu = case\n        div_val, res_val = compute_metrics(Nx, Ny, mu)\n        results.append(div_val)\n        results.append(res_val)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个正确实现的求解器如果基于有缺陷的数值格式，仍可能产生非物理的结果。本练习将带您深入探讨同位网格（co-located grid）中常见的压力-速度解耦（“棋盘格”）问题，并运用离散傅里叶分析这一核心工具来诊断其根源 。通过分析和改进离散梯度算子，您将亲身体验如何从根本上确保数值解的物理真实性。",
            "id": "3354187",
            "problem": "考虑在两个方向上间距均为 $\\Delta$ 的无限、均匀笛卡尔网格上，采用同位网格有限体积（FV）法离散化的二维不可压缩流。设单元中心压力在整数索引 $(i,j) \\in \\mathbb{Z}^{2}$ 处表示为 $p_{i,j}$。在标准的同位网格有限体积法实践中，单元中心的离散压力梯度通过由相邻单元中心值的算术平均形成的面对中心压力的面法向差分进入动量方程。具体来说，将面对中心压力定义为\n$$\np_{i+\\frac{1}{2},j} \\equiv \\frac{1}{2}\\left(p_{i+1,j} + p_{i,j}\\right), \\qquad\np_{i,j+\\frac{1}{2}} \\equiv \\frac{1}{2}\\left(p_{i,j+1} + p_{i,j}\\right),\n$$\n并将单元中心压力梯度定义为\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} \\equiv \\frac{p_{i+\\frac{1}{2},j} - p_{i-\\frac{1}{2},j}}{\\Delta}, \\qquad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} \\equiv \\frac{p_{i,j+\\frac{1}{2}} - p_{i,j-\\frac{1}{2}}}{\\Delta}.\n$$\n您将分析此离散算子对傅里叶模式的作用，然后设计一种替代的离散梯度，以打破与压力-速度解耦（棋盘格现象）相关的病态抵消，同时在长波极限下避免过度耗散。\n\n1. 使用离散傅里叶分析，考虑一个压力模式\n$$\np_{i,j} = \\hat{p} \\exp\\!\\left(i k_{x} i \\Delta + i k_{y} j \\Delta\\right),\n$$\n其中 $\\hat{p} \\in \\mathbb{C}$ 且 $(k_{x},k_{y}) \\in \\mathbb{R}^{2}$ 为波数。推导上述离散 $x$-梯度算子的傅里叶符号（放大因子），并证明对于奈奎斯特棋盘格模式 $k_{x} = \\pi/\\Delta$ 和 $k_{y} = \\pi/\\Delta$，面法向壓力梯度恒为零。\n\n2. 为了在不采用交错网格的情况下打破这种抵消，提出了一个修正的离散 $x$-梯度算子，该算子使用一个小的无量纲权重 $\\alpha \\in \\mathbb{R}$ 来混合中心差分和向前差分，\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)^{(\\alpha)}_{i,j} \\equiv (1-\\alpha)\\,\\frac{p_{i+1,j} - p_{i-1,j}}{2\\,\\Delta} \\;+\\; \\alpha\\,\\frac{p_{i+1,j} - p_{i,j}}{\\Delta}.\n$$\n推导其对应的傅里叶符号，作为 $k_{x}$、$\\Delta$ 和 $\\alpha$ 的闭式函数。解析地证明该符号在 $(k_{x},k_{y})=(\\pi/\\Delta,\\pi/\\Delta)$ 處非零，並且对于小的 $k_{x}\\Delta$，主导耗散误差的尺度与 $\\alpha\\,k_{x}^{2}\\,\\Delta/2$ 相当，因此可以通过取足够小的 $\\alpha$ 使其变小。最后，将你所提出的混合 $x$-梯度算子的傅里叶符号的最终闭式表达式作为你的答案。\n\n您的最终答案必须是一个单一的解析表达式。不需要四舍五入，最终答案框中也不应包含任何单位。",
            "solution": "首先根据所需标准对问题进行验证。\n\n### 第 1 步：提取已知条件\n- **网格与变量**：二维（$2$D）不可压缩流，位于无限、均匀的笛卡尔网格上，两个方向上的间距均为 $\\Delta$。单元中心压力为 $p_{i,j}$，其中整数索引 $(i,j) \\in \\mathbb{Z}^{2}$。\n- **标准离散化**：\n  - 面对中心压力通过算术平均定义：\n    $$\n    p_{i+\\frac{1}{2},j} \\equiv \\frac{1}{2}\\left(p_{i+1,j} + p_{i,j}\\right)\n    $$\n    $$\n    p_{i,j+\\frac{1}{2}} \\equiv \\frac{1}{2}\\left(p_{i,j+1} + p_{i,j}\\right)\n    $$\n  - 单元中心压力梯度使用这些面对中心值定义：\n    $$\n    \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} \\equiv \\frac{p_{i+\\frac{1}{2},j} - p_{i-\\frac{1}{2},j}}{\\Delta}\n    $$\n    $$\n    \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} \\equiv \\frac{p_{i,j+\\frac{1}{2}} - p_{i,j-\\frac{1}{2}}}{\\Delta}\n    $$\n- **傅里叶模式**：考虑单个压力模式进行分析：\n  $$\n  p_{i,j} = \\hat{p} \\exp\\!\\left(i k_{x} i \\Delta + i k_{y} j \\Delta\\right)\n  $$\n  其中 $\\hat{p} \\in \\mathbb{C}$ 是振幅，$(k_{x}, k_{y}) \\in \\mathbb{R}^{2}$ 是波数。\n- **任务 1**：推导离散 $x$-梯度算子的傅里叶符号，并证明对于奈奎斯特棋盘格模式（$k_{x} = \\pi/\\Delta$，$k_{y} = \\pi/\\Delta$），面法向压力梯度消失。\n- **修正离散化**：\n  - 提出了一个混合的离散 $x$-梯度算子：\n    $$\n    \\left(\\frac{\\partial p}{\\partial x}\\right)^{(\\alpha)}_{i,j} \\equiv (1-\\alpha)\\,\\frac{p_{i+1,j} - p_{i-1,j}}{2\\,\\Delta} \\;+\\; \\alpha\\,\\frac{p_{i+1,j} - p_{i,j}}{\\Delta}\n    $$\n    使用无量纲权重 $\\alpha \\in \\mathbb{R}$。\n- **任务 2**：推导此修正算子的傅里叶符号。证明其在奈奎斯特模式下非零。证明对于小的 $k_{x}\\Delta$，主导耗散误差的尺度与 $\\alpha\\,k_{x}^{2}\\,\\Delta/2$ 相当。提供傅里叶符号的最终闭式表达式。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题是偏微分方程离散格式数值分析中的一个标准练习，特别是针对计算流体动力学（CFD）中使用的纳维-斯托克斯方程。所用的方法（有限体积法、离散傅里叶分析）和概念（压力-速度解耦、棋盘格现象、数值耗散）是该领域的基础。\n- **适定性**：问题陈述清晰，包含了推导所需解析表达式的所有必要定义和充分信息。任务规定明确。\n- **客观性**：问题使用形式化数学语言表述，不含任何主观或基于观点的陈述。\n\n### 第 3 步：结论与行动\n该问题是**有效的**。它具有科学合理性、适定性和客观性，并且与 CFD 中数值方法的分析直接相关。将提供完整的解答。\n\n### 解答\n\n**第 1 部分：标准离散梯度的分析**\n\n首先，我们通过代入面对中心压力的定义来确定离散 $x$-梯度算子的显式形式：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+\\frac{1}{2},j} - p_{i-\\frac{1}{2},j}}{\\Delta} = \\frac{1}{\\Delta} \\left[ \\frac{1}{2}(p_{i+1,j} + p_{i,j}) - \\frac{1}{2}(p_{i,j} + p_{i-1,j}) \\right] = \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta}\n$$\n这表明，标准的同位网格格式的压力梯度等效于单元中心上的一个简单中心差分。\n\n为了求得傅里葉符號，我们将此算子应用于给定的压力模式 $p_{i,j} = \\hat{p} \\exp(i k_{x} i \\Delta + i k_{y} j \\Delta)$。一个线性的、移位不变的离散算子作用于一个傅里叶模式时，其效果是给该模式乘以一个复数，即傅里叶符号，该符号依赖于波数。我们将离散算子记为 $\\mathcal{D}_x$，因此 $(\\frac{\\partial p}{\\partial x})_{i,j} = \\mathcal{D}_x[p_{i,j}]$。我们有：\n$$\n\\mathcal{D}_x[p_{i,j}] = \\frac{1}{2\\Delta} \\left[ \\hat{p} \\exp(i k_{x} (i+1) \\Delta + i k_{y} j \\Delta) - \\hat{p} \\exp(i k_{x} (i-1) \\Delta + i k_{y} j \\Delta) \\right]\n$$\n将原始模式 $p_{i,j}$ 提取出来，得到：\n$$\n\\mathcal{D}_x[p_{i,j}] = \\frac{1}{2\\Delta} \\left[ \\exp(i k_{x} \\Delta) - \\exp(-i k_{x} \\Delta) \\right] \\left( \\hat{p} \\exp(i k_{x} i \\Delta + i k_{y} j \\Delta) \\right)\n$$\n$$\n\\mathcal{D}_x[p_{i,j}] = \\frac{\\exp(i k_{x} \\Delta) - \\exp(-i k_{x} \\Delta)}{2\\Delta} p_{i,j}\n$$\n使用 Euler 公式 $\\sin(\\theta) = (\\exp(i\\theta) - \\exp(-i\\theta))/(2i)$，表达式简化为：\n$$\n\\mathcal{D}_x[p_{i,j}] = \\frac{2i\\sin(k_{x}\\Delta)}{2\\Delta} p_{i,j} = \\frac{i\\sin(k_{x}\\Delta)}{\\Delta} p_{i,j}\n$$\n离散 $x$-梯度算子的傅里叶符号，我们记为 $G_x(k_x)$，是乘法因子：\n$$\nG_x(k_x) = \\frac{i\\sin(k_{x}\\Delta)}{\\Delta}\n$$\n现在，我们在奈奎斯特波数 $k_{x} = \\pi/\\Delta$ 处评估此符号：\n$$\nG_x(\\pi/\\Delta) = \\frac{i\\sin((\\pi/\\Delta)\\Delta)}{\\Delta} = \\frac{i\\sin(\\pi)}{\\Delta} = 0\n$$\n根据对称性，$y$-梯度算子的符号为 $G_y(k_y) = i\\sin(k_{y}\\Delta)/\\Delta$，在 $k_y = \\pi/\\Delta$ 处也为零。当 $k_x = \\pi/\\Delta$ 和 $k_y=\\pi/\\Delta$ 时，压力场形式为 $p_{i,j} \\propto \\exp(i\\pi i + i\\pi j) = (-1)^{i+j}$，这是一个高频棋盘格模式。由于离散梯度算子作用于此模式时结果为零，因此它对此类压力场“视而不见”。这意味着棋盘格压力场可以存在于离散系统中，而不会对动量方程产生任何贡献，这就是压力-速度解耦的本质。\n\n**第 2 部分：修正离散梯度的分析**\n\n提出的修正算子是：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)^{(\\alpha)}_{i,j} = (1-\\alpha)\\,\\frac{p_{i+1,j} - p_{i-1,j}}{2\\,\\Delta} \\;+\\; \\alpha\\,\\frac{p_{i+1,j} - p_{i,j}}{\\Delta}\n$$\n这是中心差分算子和向前差分算子的线性组合。组合算子的傅里叶符号是各个独立算子符号的相同线性组合。我们已经有了中心差分部分的符号。对于向前差分部分 $\\mathcal{D}_x^{FD}[p_{i,j}] = (p_{i+1,j} - p_{i,j})/\\Delta$，我们有：\n$$\n\\mathcal{D}_x^{FD}[p_{i,j}] = \\frac{\\exp(i k_{x} \\Delta) - 1}{\\Delta} p_{i,j}\n$$\n所以其符号为 $(\\exp(i k_{x} \\Delta) - 1)/\\Delta$。\n\n因此，修正算子的傅里叶符号 $G_x^{(\\alpha)}(k_x)$ 是：\n$$\nG_x^{(\\alpha)}(k_x) = (1-\\alpha) \\left( \\frac{i\\sin(k_x\\Delta)}{\\Delta} \\right) + \\alpha \\left( \\frac{\\exp(i k_x \\Delta) - 1}{\\Delta} \\right)\n$$\n为了得到闭式表达式，我们使用 $\\exp(i k_x \\Delta) = \\cos(k_x \\Delta) + i\\sin(k_x \\Delta)$：\n$$\nG_x^{(\\alpha)}(k_x) = \\frac{1}{\\Delta} \\left[ (1-\\alpha)i\\sin(k_x\\Delta) + \\alpha(\\cos(k_x\\Delta) + i\\sin(k_x\\Delta) - 1) \\right]\n$$\n$$\nG_x^{(\\alpha)}(k_x) = \\frac{1}{\\Delta} \\left[ i\\sin(k_x\\Delta) - i\\alpha\\sin(k_x\\Delta) + \\alpha\\cos(k_x\\Delta) + i\\alpha\\sin(k_x\\Delta) - \\alpha \\right]\n$$\n$$\nG_x^{(\\alpha)}(k_x) = \\frac{1}{\\Delta} \\left[ \\alpha(\\cos(k_x\\Delta) - 1) + i\\sin(k_x\\Delta) \\right]\n$$\n这就是傅里叶符号的最终闭式表达式。\n\n接下来，我们证明该符号在奈奎斯特模式 $k_x = \\pi/\\Delta$ 处非零。\n$$\nG_x^{(\\alpha)}(\\pi/\\Delta) = \\frac{1}{\\Delta} \\left[ \\alpha(\\cos(\\pi) - 1) + i\\sin(\\pi) \\right] = \\frac{1}{\\Delta} \\left[ \\alpha(-1 - 1) + i(0) \\right] = -\\frac{2\\alpha}{\\Delta}\n$$\n对于任何 $\\alpha \\neq 0$，该值非零，这证实了修正格式成功地感应到了棋盘格模式并打破了解耦。\n\n最后，我们分析当 $k_x\\Delta$ 很小时的行为。精确算子 $\\partial/\\partial x$ 的符号是 $i k_x$。我们考察当 $\\theta = k_x\\Delta$ 很小时 $G_x^{(\\alpha)}(k_x)$ 的泰勒级数展开：\n$\\cos(\\theta) = 1 - \\frac{\\theta^2}{2!} + O(\\theta^4)$\n$\\sin(\\theta) = \\theta - \\frac{\\theta^3}{3!} + O(\\theta^5)$\n将这些代入符号表达式中：\n$$\nG_x^{(\\alpha)}(k_x) = \\frac{1}{\\Delta} \\left[ \\alpha\\left(\\left(1-\\frac{(k_x\\Delta)^2}{2}\\right) - 1\\right) + i\\left(k_x\\Delta - \\frac{(k_x\\Delta)^3}{6}\\right) + O((k_x\\Delta)^4) \\right]\n$$\n$$\nG_x^{(\\alpha)}(k_x) = \\frac{1}{\\Delta} \\left[ -\\frac{\\alpha(k_x\\Delta)^2}{2} + i k_x\\Delta - i\\frac{(k_x\\Delta)^3}{6} + O((k_x\\Delta)^4) \\right]\n$$\n$$\nG_x^{(\\alpha)}(k_x) = -\\frac{\\alpha k_x^2 \\Delta}{2} + i k_x - i\\frac{k_x^3 \\Delta^2}{6} + O(k_x^4\\Delta^3)\n$$\n误差为 $E(k_x) = G_x^{(\\alpha)}(k_x) - i k_x = -\\frac{\\alpha k_x^2 \\Delta}{2} - i\\frac{k_x^3 \\Delta^2}{6} + \\dots$。\n主导误差项的实部 $\\Re(E(k_x)) \\approx -\\frac{\\alpha k_x^2 \\Delta}{2}$ 对应于数值耗散。其量级与 $\\alpha k_x^2 \\Delta/2$ 相当，符合要求。这种耗散类似于在算子中增加一个与 $\\alpha \\frac{\\partial^2 p}{\\partial x^2}$ 成正比的项，这会抑制高频振荡并稳定格式，但代价是引入了一个二阶误差。参数 $\\alpha$ 允许控制所添加耗散的量。\n\n所要求的最终答案是所提出的混合算子的傅里叶符号的闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{1}{\\Delta} \\left[ \\alpha(\\cos(k_x\\Delta) - 1) + i\\sin(k_x\\Delta) \\right]}\n$$"
        },
        {
            "introduction": "真实世界的工程问题常常涉及多物理场耦合，例如流固耦合（FSI），其数值求解对计算效率提出了巨大挑战。本练习将引导您为这样一个复杂的整体耦合系统设计和验证一个分块预条件子，这是现代计算科学中的一项高级技能 。您将学习如何通过分析系统的分块雅可比矩阵、近似舒尔补以及进行谱分析，来构建一个可扩展且高效的求解策略。",
            "id": "3517726",
            "problem": "要求您为与线性弹性固体耦合的不可压缩流体的单体雅可比矩阵设计、分析和数值验证一个可扩展的预条件子。您的出发点必须是流体的线性动量守恒和不可压缩性约束，以及小应变体系下固体的线性动量平衡。您必须以分块形式表示耦合的离散雅可比矩阵，并使用分块因式分解论证来构建一个预条件子，该预条件子用谱等价近似替换精确的舒尔补。然后，您必须实现一个程序，该程序组装一个模型离散算子，并在一个小型测试套件上计算预处理后系统的极端广义特征值，以证明其谱等价性对于网格细化和参数变化是鲁棒的。\n\n该任务纯粹是数学和算法性质的。由于算子是无量纲的，最终答案中不需要物理单位。不使用角度。输出必须是数值型且有限的。\n\n该问题包括以下步骤。\n\n- 控制原理和分块形式：\n  1. 从牛顿流体的线性动量守恒和不可压缩性出发，流体速度矢量为 $u$，压力为 $p$，在对流项可忽略的稳态附近进行线性化，因此流体动量算子是粘度为 $\\mu$ 的扩散算子。将不可压缩性约束表述为 $\\nabla \\cdot u = 0$。对于固体，从具有拉梅参数 $\\lambda_{s}$ 和 $\\mu_{s}$ 以及位移矢量 $d$ 的小应变的线性动量平衡出发。\n  2. 考虑流体速度和固体位移之间的对称线性耦合，模拟运动学/Robin型界面条件。在雅可比矩阵中将此耦合表示为强度为 $\\gamma$ 的对称块 $C$。\n  3. 将耦合的单体雅可比矩阵组装成一个作用于未知量拼接向量 $[u; p; d]$ 上的 $3 \\times 3$ 分块矩阵：\n     $$\n     J \\;=\\;\n     \\begin{bmatrix}\n     A  B^{\\top}  C^{\\top} \\\\\n     B  0  0 \\\\\n     C  0  K\n     \\end{bmatrix},\n     $$\n     其中 $A$ 是离散流体动量算子，$B$ 是离散散度算子，$K$ 是离散线性弹性算子。\n\n- 要实现的离散化模型：\n  1. 设域为具有齐次狄利克雷边界条件的单位正方形。在具有 $N \\times N$ 个内部点、网格尺寸为 $h = 1/(N+1)$ 的相同笛卡尔网格上离散所有场。\n  2. 使用标准的5点模板和狄利克雷边界构建标量二维拉普拉斯算子 $L \\in \\mathbb{R}^{n \\times n}$，其中 $n = N^{2}$。构建中心离散一阶导数算子 $D_{x}, D_{y} \\in \\mathbb{R}^{n \\times n}$，在每个坐标方向的上对角线和下对角线上的模板系数为 $\\pm 1/(2h)$，并在网格外部施加齐次狄利克雷值，使得 $D_{x}$ 和 $D_{y}$ 经过适当的边界处理后是稀疏的。\n  3. 将流体动量块 $A \\in \\mathbb{R}^{2n \\times 2n}$ 构造为作用于速度两个分量上的矢量拉普拉斯算子 $A = \\mu \\,\\mathrm{blkdiag}(L, L)$。\n  4. 将离散散度 $B \\in \\mathbb{R}^{n \\times 2n}$ 构造为 $B = [\\, D_{x} \\;\\; D_{y} \\,]$。为消除压力零空间，消除一个压力自由度（例如，去掉 $B$ 的最后一行和压力质量的相应条目），使得简化后的 $B \\in \\mathbb{R}^{(n-1) \\times 2n}$ 是行满秩的。\n  5. 将小应变各向同性弹性的线性弹性块 $K \\in \\mathbb{R}^{2n \\times 2n}$ 构造为\n     $$\n     K \\;=\\; \\mu_{s} \\,\\mathrm{blkdiag}(L, L) \\;+\\; (\\lambda_{s}+\\mu_{s})\n     \\begin{bmatrix}\n     D_{x}^{\\top} D_{x}  D_{x}^{\\top} D_{y} \\\\\n     D_{y}^{\\top} D_{x}  D_{y}^{\\top} D_{y}\n     \\end{bmatrix}.\n     $$\n  6. 将耦合块 $C \\in \\mathbb{R}^{2n \\times 2n}$ 构造为 $C = \\gamma \\, I_{2n}$，其中 $I_{2n}$ 是 $2n \\times 2n$ 的单位矩阵。\n\n- 通过带舒尔补近似的分块因式分解进行预条件子设计：\n  1. 对 $J$ 使用分块高斯消去，精确的压力舒尔补为 $S_{p} = B A^{-1} B^{\\top}$。一个常用且可扩展的近似是缩放后的压力质量矩阵 $S_{p} \\approx \\widehat{S}_{p} = \\mu^{-1} M_{p}$，其中 $M_{p} \\in \\mathbb{R}^{(n-1) \\times (n-1)}$ 是简化后的压力质量矩阵。对于均匀网格，取 $M_{p} = h^{2} I_{n-1}$。\n  2. 定义分块对角预条件子\n     $$\n     P \\;=\\; \\mathrm{blkdiag}\\!\\left(\\, \\widehat{A},\\; \\widehat{S}_{p},\\; \\widehat{K} \\,\\right),\n     $$\n     其中 $\\widehat{A} = A$ 和 $\\widehat{K} = K$，以及 $\\widehat{S}_{p} = \\mu^{-1} M_{p}$。\n  3. 预处理算子是广义对称特征问题 $J x = \\lambda P x$，它与对称矩阵 $P^{-1/2} J P^{-1/2}$ 相似。谱等价意味着 $P^{-1/2} J P^{-1/2}$ 的谱包含在区间 $[-\\beta_{2}, -\\beta_{1}] \\cup [\\alpha_{1}, \\alpha_{2}]$ 的并集中，其中的常数与 $N$、$h$ 以及测试套件中的参数无关，前提是舒尔补近似与 $S_{p}$ 谱等价，且 $A$、$K$ 相对于其近似是良态的。\n\n- 您必须计算和报告的内容：\n  1. 对每个测试用例，计算两个标量：\n     - $J x = \\lambda P x$ 的最小模广义特征值 $\\min_{\\ell} |\\lambda_{\\ell}|$，通过使用位移反演（$\\sigma = 0$）计算 $k$ 个最接近零的特征值，并取其中的最小绝对值来估算，其中 $k=6$。\n     - 最大模广义特征值 $\\max_{\\ell} |\\lambda_{\\ell}|$，通过计算谱两端的 $k$ 个特征值（代数上最大的正值和最负的值），并取其中的最大绝对值来估算，其中 $k=6$。\n  2. 将每个标量四舍五入到三位小数。\n  3. 您的程序必须严格按照规定组装所有稀疏矩阵，并使用一个广义对称特征值求解器来计算所要求的量。\n\n- 测试套件：\n  1. 用例 1（理想路径）：$N = 8$，$\\mu = 1.0$，$\\mu_{s} = 1.0$，$\\lambda_{s} = 1.0$，$\\gamma = 1.0$。\n  2. 用例 2（网格可扩展性）：$N = 12$，$\\mu = 1.0$，$\\mu_{s} = 1.0$，$\\lambda_{s} = 1.0$，$\\gamma = 1.0$。\n  3. 用例 3（近不可压缩固体）：$N = 8$，$\\mu = 1.0$，$\\mu_{s} = 1.0$，$\\lambda_{s} = 1000.0$，$\\gamma = 1.0$。\n  4. 用例 4（强耦合）：$N = 8$，$\\mu = 1.0$，$\\mu_{s} = 1.0$，$\\lambda_{s} = 1.0$，$\\gamma = 50.0$。\n\n- 最终输出格式：\n  1. 您的程序必须生成单行输出，其中包含所有四个测试用例的结果列表（按顺序排列），每个结果是该用例的包含两个条目的列表 $[\\min |\\lambda|, \\max |\\lambda|]$。\n  2. 确切的输出格式要求是单行，包含一个用方括号括起来的、由逗号分隔的方括号对列表，例如：\n     $[[a_1, b_1], [a_2, b_2], [a_3, b_3], [a_4, b_4]]$,\n     其中每个 $a_{i}$ 和 $b_{i}$ 是四舍五入到三位小数的十进制数。\n\n您的程序必须是一个完整、可运行的脚本，它不需要任何输入，并严格按照指定格式打印一行输出。仅使用执行环境中指定的库和版本。",
            "solution": "该问题要求为单体流固耦合系统设计并数值验证一个分块对角预条件子。该过程涉及离散化控制偏微分方程，组装耦合的雅可比矩阵，基于分块因式分解论证构建预条件子，并通过计算预处理后系统的谱边界来数值测试其有效性。\n\n### 控制原理和分块算子形式\n\n该耦合系统结合了不可压缩流体和线性弹性固体。\n\n1.  **流体动力学**：流体由线性动量守恒和质量守恒控制。对于牛顿流体，在线性化并假设对流可忽略后，方程如下：\n    $$\n    -\\mu \\nabla^2 \\mathbf{u} + \\nabla p = \\mathbf{f}_f \\quad (\\text{动量})\n    $$\n    $$\n    \\nabla \\cdot \\mathbf{u} = 0 \\quad (\\text{不可压缩性})\n    $$\n    此处，$\\mathbf{u}$ 是流体速度矢量，$p$ 是压力，$\\mu$ 是动力粘度。\n\n2.  **固体力学**：固体由小应变体系下的线性动量平衡描述：\n    $$\n    -\\nabla \\cdot \\boldsymbol{\\sigma}_s(\\mathbf{d}) = \\mathbf{f}_s \\quad (\\text{动量})\n    $$\n    其中 $\\mathbf{d}$ 是位移矢量。对于各向同性线性弹性材料，柯西应力张量 $\\boldsymbol{\\sigma}_s$ 由 $\\boldsymbol{\\sigma}_s(\\mathbf{d}) = \\lambda_s (\\nabla \\cdot \\mathbf{d})I + 2\\mu_s \\boldsymbol{\\varepsilon}(\\mathbf{d})$ 给出，其中 $\\boldsymbol{\\varepsilon}(\\mathbf{d}) = \\frac{1}{2}(\\nabla \\mathbf{d} + (\\nabla \\mathbf{d})^\\top)$ 是小应变张量，$\\lambda_s, \\mu_s$ 是拉梅参数。\n\n通过离散化（例如，使用有限元或有限差分），该耦合的偏微分方程组产生一个线性方程组。该系统的雅可比矩阵作用于划分为 $[\\mathbf{u}; p; \\mathbf{d}]$ 的离散未知量向量上，可以写成对称的 $3 \\times 3$ 分块形式：\n$$\nJ \\;=\\;\n\\begin{bmatrix}\nA  B^{\\top}  C^{\\top} \\\\\nB  0  0 \\\\\nC  0  K\n\\end{bmatrix}\n$$\n-   $A$ 是离散流体动量算子，表示矢量拉普拉斯项 $-\\mu \\nabla^2(\\cdot)$。\n-   $B$ 是离散散度算子 $\\nabla \\cdot (\\cdot)$，其转置 $B^\\top$ 表示负压力梯度 $-\\nabla(\\cdot)$。\n-   $K$ 是离散线性弹性算子，表示 $-\\nabla \\cdot \\boldsymbol{\\sigma}_s(\\cdot)$。\n-   $C$ 和 $C^\\top$ 表示流体域和固体域之间的耦合。问题指定了一个简单的对称Robin型耦合。\n\n这种结构是一个鞍点系统，其病态性是众所周知的，尤其是在网格细化时。\n\n### 离散化模型\n\n该实现使用有限差分法，在单位正方形内的均匀 $N \\times N$ 笛卡尔内部点网格上进行。网格尺寸为 $h = 1/(N+1)$。所有场都在此网格上离散化。令 $n = N^2$ 为内部网格点的数量。\n\n-   **离散拉普拉斯算子 ($L$)**：负拉普拉斯算子 $-\\nabla^2$ 使用标准的5点模板进行离散化，得到一个稀疏矩阵 $L \\in \\mathbb{R}^{n \\times n}$。该矩阵按 $1/h^2$ 进行缩放，对角线元素为 $4/h^2$，对于相邻点，非对角线元素为 $-1/h^2$。\n-   **离散导数 ($D_x, D_y$)**：一阶空间导数 $\\partial_x$ 和 $\\partial_y$ 使用中心差分进行离散化，模板为 $\\pm 1/(2h)$。这得到稀疏矩阵 $D_x, D_y \\in \\mathbb{R}^{n \\times n}$。\n-   **分块算子**：\n    -   流体动量：$A = \\mu \\, \\mathrm{blkdiag}(L, L) \\in \\mathbb{R}^{2n \\times 2n}$。\n    -   散度：$B = [D_x, D_y] \\in \\mathbb{R}^{n \\times 2n}$。为确保 $B$ 行满秩（从而可以满足LBB条件），通过消除一个压力自由度来移除压力常数零空间。这是通过移除 $B$ 的最后一行来实现的，从而得到 $B \\in \\mathbb{R}^{(n-1) \\times 2n}$。\n    -   弹性：$K = \\mu_{s} \\,\\mathrm{blkdiag}(L, L) + (\\lambda_{s}+\\mu_{s}) \\begin{bmatrix} D_{x}^{\\top} D_{x}  D_{x}^{\\top} D_{y} \\\\ D_{y}^{\\top} D_{x}  D_{y}^{\\top} D_{y} \\end{bmatrix} \\in \\mathbb{R}^{2n \\times 2n}$。这种形式来自于对算子 $-\\nabla \\cdot \\boldsymbol{\\sigma}_s(\\cdot)$ 的离散化。\n    -   耦合：$C = \\gamma \\, I_{2n} \\in \\mathbb{R}^{2n \\times 2n}$，其中 $I_{2n}$ 是单位矩阵。\n\n### 通过分块因式分解设计预条件子\n\n$J$的条件数可以通过预处理来改善。鞍点系统的一个常用策略是使用 $J$ 的分块因式分解。$J$ 的一个分块LU分解是：\n$$\nJ = \\begin{bmatrix} I  0  0 \\\\ B A^{-1}  I  0 \\\\ C A^{-1}  0  I \\end{bmatrix}\n\\begin{bmatrix} A  B^\\top  C^\\top \\\\ 0  -S_p  -S_{pd} \\\\ 0  -S_{dp}  S_d \\end{bmatrix}\n$$\n其中 $S_p = B A^{-1} B^\\top$ 是压力舒尔补，其他项也涉及到 $A^{-1}$。对 $J$ 求逆需要对U因子的对角块求逆，这又涉及到对舒尔补 $S_p$ 求逆。由于 $A^{-1}$ 是稠密的且计算成本高昂，因此通常对 $S_p$ 进行近似。\n\nStokes问题的预处理理论表明，$S_p$ 与压力质量矩阵 $M_p$ 谱等价。对于我们的均匀网格，$M_p = h^2 I_{n-1}$。这导出了近似 $\\widehat{S}_p = \\mu^{-1} M_p = \\mu^{-1} h^2 I_{n-1}$。因子 $\\mu^{-1}$ 源于 $A$ 的缩放。\n\n这启发了一个简单的分块对角预条件子 $P$：\n$$\nP \\;=\\; \\mathrm{blkdiag}\\!\\left(\\, \\widehat{A},\\; \\widehat{S}_{p},\\; \\widehat{K} \\,\\right)\n$$\n问题指定对动量和弹性算子使用精确的块，因此 $\\widehat{A}=A$ 且 $\\widehat{K}=K$。完整的预条件子是：\n$$\nP \\;=\\; \\mathrm{blkdiag}\\!\\left(\\, A,\\; \\mu^{-1} h^2 I_{n-1},\\; K \\,\\right)\n$$\n\n### 数值验证\n\n为了验证预条件子，我们检查预处理算子 $P^{-1}J$ 的谱。如果 $P$ 是一个好的预条件子，$P^{-1}J$ 的特征值应该聚集在少数几个小区间内，有界且远离零，并且这些界限应与网格尺寸 $h$ 和问题参数无关。此性质被称为谱等价。\n\n我们求解广义对称特征值问题 $J\\mathbf{x} = \\lambda P\\mathbf{x}$。该问题的特征值 $\\lambda$ 与预处理矩阵 $P^{-1/2}JP^{-1/2}$（$P^{-1}J$ 的一种对称形式）的特征值相同。我们为一组测试用例计算这些特征值的最小和最大模 $\\min|\\lambda|$ 和 $\\max|\\lambda|$。如果这些值在整个测试套件中保持在一个窄范围内，则表明具有鲁棒性。\n\n特征值使用 `scipy.sparse.linalg.eigsh` 中实现的 Lanczos 算法计算。为了找到最小模特征值，我们使用位移反演模式，位移 $\\sigma=0$。为了找到最大模特征值，我们计算代数上最大和最小（最负）的特征值，并取它们绝对值的最大值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import kron, identity, diags, bmat, block_diag, csc_matrix\nfrom scipy.sparse.linalg import eigsh\n\ndef make_laplacian(N):\n    \"\"\"\n    Constructs the 2D discrete negative Laplacian operator (-nabla^2) on an N x N\n    grid with homogeneous Dirichlet boundary conditions.\n    \"\"\"\n    n = N * N\n    h = 1.0 / (N + 1)\n    \n    # 1D Laplacian\n    L1D = diags([-1, 2, -1], [-1, 0, 1], shape=(N, N))\n    \n    # 2D Laplacian using Kronecker products\n    I_N = identity(N)\n    L2D = kron(I_N, L1D) + kron(L1D, I_N)\n    \n    return L2D / (h**2)\n\ndef make_derivatives(N):\n    \"\"\"\n    Constructs the 2D discrete first-derivative operators (Dx, Dy) on an N x N\n    grid using centered differences.\n    \"\"\"\n    n = N * N\n    h = 1.0 / (N + 1)\n    \n    # 1D derivative operator\n    D1D = diags([-1, 1], [-1, 1], shape=(N, N)) / (2 * h)\n    \n    I_N = identity(N)\n    Dx = kron(D1D, I_N, format='csc')\n    Dy = kron(I_N, D1D, format='csc')\n    \n    return Dx, Dy\n\ndef assemble_system(N, mu, mu_s, lambda_s, gamma):\n    \"\"\"\n    Assembles the Jacobian matrix J and the preconditioner P.\n    \"\"\"\n    n = N * N\n    h = 1.0 / (N + 1)\n    \n    # Discrete operators\n    L = make_laplacian(N)\n    Dx, Dy = make_derivatives(N)\n    \n    # Block A (fluid momentum)\n    A = mu * block_diag([L, L], format='csc')\n    \n    # Block B (divergence)\n    B_full = bmat([[Dx, Dy]], format='csc')\n    B = B_full[:-1, :] # Remove last row to fix pressure null space\n    \n    # Block K (elasticity)\n    K11 = mu_s * L + (lambda_s + mu_s) * (Dx.T @ Dx)\n    K12 = (lambda_s + mu_s) * (Dx.T @ Dy)\n    K21 = (lambda_s + mu_s) * (Dy.T @ Dx)\n    K22 = mu_s * L + (lambda_s + mu_s) * (Dy.T @ Dy)\n    K = bmat([[K11, K12], [K21, K22]], format='csc')\n    \n    # Block C (coupling)\n    C = gamma * identity(2 * n, format='csc')\n    \n    # Assemble Jacobian J\n    n_u, n_d = 2 * n, 2 * n\n    n_p = n - 1\n    \n    Z_pp = csc_matrix((n_p, n_p))\n    Z_pd = csc_matrix((n_p, n_d))\n    Z_dp = csc_matrix((n_d, n_p))\n    \n    J = bmat([\n        [A, B.T, C.T],\n        [B, Z_pp, Z_pd],\n        [C, Z_dp, K]\n    ], format='csc')\n    \n    # Assemble Preconditioner P\n    A_hat = A\n    K_hat = K\n    Sp_hat = (1.0 / mu) * (h**2) * identity(n_p, format='csc')\n    \n    P = block_diag([A_hat, Sp_hat, K_hat], format='csc')\n    \n    return J, P\n\ndef compute_eigenvalues(J, P, k=6):\n    \"\"\"\n    Computes the extremal generalized eigenvalues of (J, P).\n    \"\"\"\n    # Smallest magnitude eigenvalues (shift-and-invert)\n    # sigma=0 may cause issues if J is singular, but we follow the prompt.\n    # eigsh uses a sparse LU factorization in this mode which is robust.\n    try:\n        # ArpackNoConvergence can happen, so we might need more iterations.\n        # tol=0 means machine precision. maxiter is a safeguard.\n        vals_small_mag = eigsh(J, k=k, M=P, sigma=0, which='LM', tol=0, maxiter=J.shape[0]*2)[0]\n        min_abs_lambda = np.min(np.abs(vals_small_mag))\n    except Exception as e:\n        print(f\"Warning: Smallest eigenvalue computation failed: {e}\")\n        min_abs_lambda = np.nan\n\n    # Largest magnitude eigenvalues\n    try:\n        vals_large_pos = eigsh(J, k=k, M=P, which='LA', tol=0, maxiter=J.shape[0]*2)[0]\n        vals_large_neg = eigsh(J, k=k, M=P, which='SA', tol=0, maxiter=J.shape[0]*2)[0]\n        max_abs_lambda = np.max([np.max(np.abs(vals_large_pos)), np.max(np.abs(vals_large_neg))])\n    except Exception as e:\n        print(f\"Warning: Largest eigenvalue computation failed: {e}\")\n        max_abs_lambda = np.nan\n        \n    return min_abs_lambda, max_abs_lambda\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, mu, mu_s, lambda_s, gamma)\n        (8, 1.0, 1.0, 1.0, 1.0),       # Case 1: happy path\n        (12, 1.0, 1.0, 1.0, 1.0),      # Case 2: mesh scalability\n        (8, 1.0, 1.0, 1000.0, 1.0),    # Case 3: nearly incompressible solid\n        (8, 1.0, 1.0, 1.0, 50.0),      # Case 4: strong coupling\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, mu, mu_s, lambda_s, gamma = case\n        J, P = assemble_system(N, mu, mu_s, lambda_s, gamma)\n        min_lambda, max_lambda = compute_eigenvalues(J, P, k=6)\n        all_results.append(f\"[{min_lambda:.3f},{max_lambda:.3f}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}