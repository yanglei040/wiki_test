{
    "hands_on_practices": [
        {
            "introduction": "本实践深入离散元方法 (DEM) 的核心：接触力的计算。精确地模拟颗粒间的相互作用，尤其是摩擦力，是建立一个稳健可靠的模拟的关键。本练习  将引导您实践一个基本算法——弹性预测、塑性修正方案——以根据库仑摩擦定律更新切向力。掌握这一过程对于构建物理上真实的离散元模型至关重要。",
            "id": "3504405",
            "problem": "一个由离散元法（DEM, Discrete Element Method）建模的单一球形颗粒与光滑的弹性连续介质边界接触。该接触的特征在于：一个从连续介质传递到颗粒的法向力 $\\|F_n\\|$，以及一个由刚度为 $k_t$ 的线性弹性切向弹簧捕捉的切向微滑移响应，直到由库仑摩擦定律控制的滑移条件将切向力的大小限制在 $\\mu \\|F_n\\|$ 以内。该颗粒在接触点还受到滚动阻力，建模为一个与法向力、有效接触半径 $R^\\ast$ 以及滚动旋转增量的大小 $\\|\\Delta \\theta_r\\|$ 成正比的扭矩，比例系数为 $k_r$。假设接触点位于边界的局部平坦部分，并且连续介质边界足够刚性，使得球体-平面接触的有效接触半径简化为颗粒半径。\n\n颗粒半径为 $R = 0.015$ $\\mathrm{m}$，当前法向力大小为 $\\|F_n\\| = 50$ $\\mathrm{N}$。摩擦系数为 $\\mu = 0.4$，切向刚度为 $k_t = 5.0 \\times 10^{5}$ $\\mathrm{N/m}$，滚动阻力系数为 $k_r = 0.05$。在接触点的局部切向平面内，上一步的切向力为 $F_t^{\\mathrm{old}} = (15,\\,0)$ $\\mathrm{N}$。在当前时间增量内，切向相对位移增量为 $\\Delta u_t = (2.0 \\times 10^{-5},\\,-1.0 \\times 10^{-5})$ $\\mathrm{m}$。滚动旋转增量的大小为 $\\|\\Delta \\theta_r\\| = 0.02$ $\\mathrm{rad}$。\n\n从接触力学和摩擦滑移的基本原理（切向弹簧的Hooke定律、Newton定律和Coulomb摩擦上限）出发，并对于球体-平面接触取 $R^\\ast = R$，确定：\n- 施加弹性增量并强制执行Coulomb上限后，更新后的切向力向量 $F_t$，以及\n- 滚动阻力扭矩 $M_r$。\n\n将 $F_t$ 的每个分量和扭矩 $M_r$ 四舍五入到四位有效数字。力以 $\\mathrm{N}$ 为单位，扭矩以 $\\mathrm{N \\cdot m}$ 为单位表示。将最终答案表示为一个行矩阵，其中包含 $F_t$ 的两个分量，后跟 $M_r$。角度必须以弧度处理。",
            "solution": "该问题要求在离散元法（DEM）框架内，计算颗粒-边界相互作用中更新后的切向接触力和滚动阻力扭矩。该问题提法明确且科学上合理，提供了所有必要的参数和清晰的物理模型描述。求解过程将分为两部分：首先是切向力，其次是滚动阻力扭矩。\n\n**第一部分：计算更新后的切向力 $F_t$**\n\n切向力的接触模型是一个带有由库仑摩擦定律控制的滑移条件的线性弹性弹簧。这是一个使用预测-校正方案求解的标准弹塑性模型。\n\n**步骤 1.1：弹性预测**\n\n首先，通过假设纯弹性增量来计算一个试探切向力 $F_t^{\\mathrm{trial}}$。根据Hooke定律，切向力增量 $\\Delta F_t$ 由切向刚度 $k_t$ 和切向相对位移增量 $\\Delta u_t$ 决定：\n$$\n\\Delta F_t = k_t \\Delta u_t\n$$\n给定值为 $k_t = 5.0 \\times 10^{5}$ $\\mathrm{N/m}$ 和 $\\Delta u_t = (2.0 \\times 10^{-5},\\,-1.0 \\times 10^{-5})$ $\\mathrm{m}$。\n$$\n\\Delta F_t = (5.0 \\times 10^{5}) \\begin{pmatrix} 2.0 \\times 10^{-5} \\\\ -1.0 \\times 10^{-5} \\end{pmatrix} = \\begin{pmatrix} (5.0 \\times 10^{5}) \\cdot (2.0 \\times 10^{-5}) \\\\ (5.0 \\times 10^{5}) \\cdot (-1.0 \\times 10^{-5}) \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ -5 \\end{pmatrix} \\, \\mathrm{N}\n$$\n试探切向力是上一个时间步的力 $F_t^{\\mathrm{old}}$ 与这个弹性增量之和：\n$$\nF_t^{\\mathrm{trial}} = F_t^{\\mathrm{old}} + \\Delta F_t\n$$\n已知 $F_t^{\\mathrm{old}} = (15,\\,0)$ $\\mathrm{N}$，试探力为：\n$$\nF_t^{\\mathrm{trial}} = \\begin{pmatrix} 15 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 10 \\\\ -5 \\end{pmatrix} = \\begin{pmatrix} 25 \\\\ -5 \\end{pmatrix} \\, \\mathrm{N}\n$$\n\n**步骤 1.2：检查滑移条件**\n\n接下来，必须将试探力的大小 $\\|F_t^{\\mathrm{trial}}\\|$ 与由库仑摩擦极限定义的最大允许切向力 $F_t^{\\mathrm{max}}$ 进行比较。摩擦极限与法向力的大小 $\\|F_n\\|$ 成正比，比例常数为摩擦系数 $\\mu$。\n$$\nF_t^{\\mathrm{max}} = \\mu \\|F_n\\|\n$$\n使用给定值 $\\mu = 0.4$ 和 $\\|F_n\\| = 50$ $\\mathrm{N}$：\n$$\nF_t^{\\mathrm{max}} = 0.4 \\times 50 = 20 \\, \\mathrm{N}\n$$\n试探力的大小为：\n$$\n\\|F_t^{\\mathrm{trial}}\\| = \\sqrt{(25)^2 + (-5)^2} = \\sqrt{625 + 25} = \\sqrt{650} \\, \\mathrm{N}\n$$\n数值上，$\\|F_t^{\\mathrm{trial}}\\| \\approx 25.495$ $\\mathrm{N}$。\n\n**步骤 1.3：校正（强制滑移）**\n\n我们将试探力的大小与摩擦极限进行比较：\n$$\n\\|F_t^{\\mathrm{trial}}\\| \\approx 25.495 \\, \\mathrm{N} > F_t^{\\mathrm{max}} = 20 \\, \\mathrm{N}\n$$\n由于试探力超过了摩擦极限，因此发生滑移。最终的切向力 $F_t$ 必须被投影回摩擦锥上。这意味着它的大小必须等于 $F_t^{\\mathrm{max}}$，且其方向必须与试探力的方向相同。\n$$\nF_t = F_t^{\\mathrm{max}} \\frac{F_t^{\\mathrm{trial}}}{\\|F_t^{\\mathrm{trial}}\\|}\n$$\n代入计算出的值：\n$$\nF_t = 20 \\cdot \\frac{\\begin{pmatrix} 25 \\\\ -5 \\end{pmatrix}}{\\sqrt{650}} = \\begin{pmatrix} \\frac{20 \\cdot 25}{\\sqrt{650}} \\\\ \\frac{20 \\cdot (-5)}{\\sqrt{650}} \\end{pmatrix} = \\begin{pmatrix} \\frac{500}{\\sqrt{650}} \\\\ \\frac{-100}{\\sqrt{650}} \\end{pmatrix} \\, \\mathrm{N}\n$$\n现在我们计算数值，并按题目要求将其四舍五入到四位有效数字。\n$$\nF_{t,x} = \\frac{500}{\\sqrt{650}} \\approx 19.61161 \\, \\mathrm{N} \\implies 19.61 \\, \\mathrm{N}\n$$\n$$\nF_{t,y} = \\frac{-100}{\\sqrt{650}} \\approx -3.92232 \\, \\mathrm{N} \\implies -3.922 \\, \\mathrm{N}\n$$\n因此，更新后的切向力向量为 $F_t = (19.61, -3.922)$ $\\mathrm{N}$。\n\n**第二部分：计算滚动阻力扭矩 $M_r$**\n\n问题将滚动阻力扭矩定义为与法向力 $\\|F_n\\|$、有效接触半径 $R^\\ast$、滚动旋转增量的大小 $\\|\\Delta \\theta_r\\|$ 以及滚动阻力系数 $k_r$ 成正比。问题明确指出取 $R^\\ast = R$。滚动阻力扭矩 $M_r$ 的大小的公式为：\n$$\nM_r = k_r \\|F_n\\| R^\\ast \\|\\Delta \\theta_r\\| = k_r \\|F_n\\| R \\|\\Delta \\theta_r\\|\n$$\n问题提供了以下值：\n$k_r = 0.05$\n$\\|F_n\\| = 50$ $\\mathrm{N}$\n$R = 0.015$ $\\mathrm{m}$\n$\\|\\Delta \\theta_r\\| = 0.02$ $\\mathrm{rad}$\n\n将这些值代入公式：\n$$\nM_r = (0.05) \\cdot (50) \\cdot (0.015) \\cdot (0.02) \\, \\mathrm{N \\cdot m}\n$$\n$$\nM_r = (2.5) \\cdot (0.015) \\cdot (0.02) = (0.0375) \\cdot (0.02) = 0.00075 \\, \\mathrm{N \\cdot m}\n$$\n四舍五入到四位有效数字：\n$$\nM_r = 0.0007500 \\, \\mathrm{N \\cdot m}\n$$\n最终结果，四舍五入到四位有效数字，是切向力向量的分量 $F_t = (19.61, -3.922)$ $\\mathrm{N}$ 和滚动阻力扭矩的大小 $M_r = 0.0007500$ $\\mathrm{N \\cdot m}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 19.61 & -3.922 & 0.0007500 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在将离散颗粒与连续介质耦合时，一个核心挑战是如何在界面上施加运动学约束，例如无滑移条件。存在多种数值策略，每种策略都有其优缺点。这个动手编程练习  要求您实现并比较两种主流方法：近似的罚函数法和精确的拉格朗日乘子法。通过量化每种方法产生的误差，您将对它们在模拟精度和计算成本之间的权衡有一个实际的理解。",
            "id": "3504386",
            "problem": "考虑一个离散元法（DEM）颗粒在界面处与一个连续流体控制体积在切向运动上耦合。颗粒的质量为 $m_p$，切向速度为 $u_\\text{DEM}(t)$，而流体单元的集总质量为 $m_f$，切向速度为 $u_f(t)$。作用在流体单元上的外部剪切力为 $f_s(t)$。界面牵引力以相反的方向作用于这两个子系统上。我们考虑两种施加运动学无滑移约束 $u_\\text{DEM}(t) = u_f(t)$ 的策略：罚函数法和拉格朗日乘子法。目标是量化连续性误差 $\\|u_\\text{DEM} - u_f\\|$ 作为罚参数 $\\gamma$ 和接触刚度 $k_n$ 的函数。\n\n从每个子系统的牛顿第二定律 $m\\,du/dt = \\sum F$ 出发。将物理切向界面牵引力建模为与滑移 $u_\\text{DEM} - u_f$ 成正比的线性粘性阻力，其系数为 $c_t$，该系数通过 $c_t = \\zeta \\sqrt{k_n m_p}$ 依赖于法向接触刚度 $k_n$，其中 $\\zeta$ 是一个无量纲比例常数。流体单元受到额外的体积粘性阻力，该阻力被建模为一个与 $u_f$ 方向相反、系数为 $b$ 的线性阻尼器。使用以下给定的参数和单位：\n- 颗粒质量 $m_p = 0.01$ kg。\n- 流体集总质量 $m_f = 0.02$ kg。\n- 体积流体阻尼 $b = 0.1$ kg/s。\n- 比例常数 $\\zeta = 0.2$。\n- 时间步长 $\\Delta t = 1\\times 10^{-4}$ s。\n- 总模拟时间 $T = 0.5$ s。\n- 外部剪切力 $f_s(t) = F_0 \\sin(2\\pi f t)$，其中 $F_0 = 0.01$ N 且 $f = 2$ Hz。\n\n对于罚函数法，用一个与滑移成正比、罚参数为 $\\gamma$（单位 kg/s）的数值罚牵引力来增强物理界面牵引力。对于时间步进，在区间 $[0,T]$ 上使用步长为 $\\Delta t$ 的后向（隐式）欧拉法：\n- 定义 $K = c_t + \\gamma$。\n- 通过求解将隐式欧拉法应用于牛顿第二定律得到的线性系统，将 $\\{u_\\text{DEM}^{n}, u_f^{n}\\}$ 演化为 $\\{u_\\text{DEM}^{n+1}, u_f^{n+1}\\}$。该系统中，界面牵引力为 $K(u_\\text{DEM}^{n+1} - u_f^{n+1})$，体积阻尼 $b$ 作用于 $u_f^{n+1}$，外部作用力为 $f_s(t^{n+1})$：\n  $$\\frac{m_p}{\\Delta t}\\left(u_\\text{DEM}^{n+1} - u_\\text{DEM}^{n}\\right) = -K\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right),$$\n  $$\\frac{m_f}{\\Delta t}\\left(u_f^{n+1} - u_f^{n}\\right) = f_s(t^{n+1}) - b\\,u_f^{n+1} + K\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right).$$\n- 在 $t=0$ s 时，初始化 $u_\\text{DEM}^{0} = 0$ m/s 和 $u_f^{0} = 0$ m/s。\n\n对于拉格朗日乘子法，在每个时间步精确施加约束 $u_\\text{DEM}^{n+1} = u_f^{n+1}$。这是通过一个代表界面牵引力的拉格朗日乘子实现的。通过施加运动学等式来消除乘子，得到公共速度 $u^{n+1}$ 的组合更新式：\n$$\\frac{m_p + m_f}{\\Delta t}\\left(u^{n+1} - u^{n}\\right) = f_s(t^{n+1}) - b\\,u^{n+1},$$\n其中 $u^{0} = 0$ m/s，此后 $u_\\text{DEM}^{n+1} = u_f^{n+1} = u^{n+1}$。\n\n将误差范数定义为在 $[0,T]$ 上的时间平均离散 $L^2$ 范数：\n$$\\|u_\\text{DEM} - u_f\\| = \\sqrt{\\frac{1}{T}\\sum_{n=0}^{N-1} \\Delta t \\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right)^2},$$\n并以米每秒（m/s）为单位报告该值。\n\n实现一个完整的程序，该程序：\n- 对每个测试用例，使用指定的隐式欧拉格式模拟耦合系统，该格式可用于罚函数法或拉格朗日乘子法。\n- 计算并返回每个测试用例的误差范数 $\\|u_\\text{DEM} - u_f\\|$，单位为 m/s。\n\n使用以下覆盖典型、边界和边缘情况的测试套件。每个用例是一个元组 $(\\text{method}, \\gamma, k_n)$，其中 $\\text{method}$ 是字符串 \"penalty\" 或 \"LM\"：\n1. $(\"penalty\", 0.0, 10^3)$\n2. $(\"penalty\", 10.0, 10^3)$\n3. $(\"penalty\", 10^3, 10^3)$\n4. $(\"penalty\", 10^2, 10^5)$\n5. $(\"penalty\", 10^2, 10^2)$\n6. $(\"LM\", 0.0, 10^3)$\n7. $(\"LM\", 10^2, 10^5)$\n\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\dots,r_7]$），其中每个 $r_i$ 是相应测试用例的误差范数 $\\|u_\\text{DEM} - u_f\\|$，单位为 m/s，并以完整的双精度浮点数计算。",
            "solution": "控制方程源于 DEM 颗粒和连续流体单元的牛顿第二定律 $m\\,du/dt = \\sum F$，其中界面牵引力大小相等、方向相反。界面无滑移条件 $u_\\text{DEM} = u_f$ 通过罚函数法或通过拉格朗日乘子法精确施加。负责切向动量交换的物理界面机制被建模为线性粘性牵引力，其系数为 $c_t$。为将此系数与机械接触属性联系起来，设定 $c_t = \\zeta \\sqrt{k_n m_p}$，其中 $k_n$ 是法向接触刚度，$\\zeta$ 是一个无量纲比例常数。其形式与瑞利型阻尼缩放一致，可得出单位 $[c_t] = \\text{kg/s}$，因为 $[k_n] = \\text{N/m} = \\text{kg}/\\text{s}^2$，因此 $\\sqrt{k_n m_p}$ 的单位是 $\\text{kg}/\\text{s}$。\n\n对于罚函数法，界面牵引力是物理贡献（系数为 $c_t$ 的粘性滑移阻尼）和数值罚贡献（与滑移成正比，参数为 $\\gamma$）的和。令 $K = c_t + \\gamma$。在从 $t^n$ 到 $t^{n+1} = t^n + \\Delta t$ 的单个时间步上应用后向（隐式）欧拉法，并用 $u_\\text{DEM}^{n}$ 和 $u_f^{n}$ 表示离散速度，可得：\n$$\\frac{m_p}{\\Delta t}\\left(u_\\text{DEM}^{n+1} - u_\\text{DEM}^{n}\\right) = -K\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right),$$\n$$\\frac{m_f}{\\Delta t}\\left(u_f^{n+1} - u_f^{n}\\right) = f_s(t^{n+1}) - b\\,u_f^{n+1} + K\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right).$$\n重新整理，得到一个关于 $\\left(u_\\text{DEM}^{n+1}, u_f^{n+1}\\right)$ 的 $2\\times 2$ 线性系统：\n$$\\left(\\frac{m_p}{\\Delta t} + K\\right)u_\\text{DEM}^{n+1} - K\\,u_f^{n+1} = \\frac{m_p}{\\Delta t}u_\\text{DEM}^{n},$$\n$$-K\\,u_\\text{DEM}^{n+1} + \\left(\\frac{m_f}{\\Delta t} + b + K\\right)u_f^{n+1} = f_s(t^{n+1}) + \\frac{m_f}{\\Delta t}u_f^{n}.$$\n对于正的 $m_p$、$m_f$、$b$ 和 $K$，该系统是唯一可解的，因为对于所选参数，系数矩阵是严格对角占优的，因此是非奇异的。从 $u_\\text{DEM}^0 = 0$ 和 $u_f^0 = 0$ 开始，我们进行时间步进直到 $t=T$。\n\n对于拉格朗日乘子法，约束 $u_\\text{DEM}^{n+1} = u_f^{n+1}$ 被精确施加。引入一个拉格朗日乘子 $\\lambda^{n+1}$ 来表示界面牵引力，离散隐式欧拉方程为：\n$$\\frac{m_p}{\\Delta t}\\left(u_\\text{DEM}^{n+1} - u_\\text{DEM}^{n}\\right) = -\\lambda^{n+1} - c_t\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right),$$\n$$\\frac{m_f}{\\Delta t}\\left(u_f^{n+1} - u_f^{n}\\right) = f_s(t^{n+1}) - b\\,u_f^{n+1} + \\lambda^{n+1} + c_t\\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right),$$\n$$u_\\text{DEM}^{n+1} - u_f^{n+1} = 0.$$\n在约束条件下，$c_t$ 项消失，并且可以通过将两个动量方程相加来消除拉格朗日乘子，从而为公共速度 $u^{n+1} = u_\\text{DEM}^{n+1} = u_f^{n+1}$ 得到一个单一的隐式欧拉更新式：\n$$\\frac{m_p + m_f}{\\Delta t}\\left(u^{n+1} - u^{n}\\right) = f_s(t^{n+1}) - b\\,u^{n+1},$$\n其中 $u^{0} = 0$。这个线性标量方程的解为\n$$u^{n+1} = \\frac{f_s(t^{n+1}) + \\frac{m_p + m_f}{\\Delta t}u^{n}}{\\frac{m_p + m_f}{\\Delta t} + b}.$$\n根据构造，对于拉格朗日乘子法，运动学差异 $u_\\text{DEM}^{n+1} - u_f^{n+1}$ 在每一步都精确为零，因此误差范数 $\\|u_\\text{DEM} - u_f\\|$ 在浮点运算精度内恒为零。\n\n误差范数定义为时间平均的离散 $L^2$ 范数，\n$$\\|u_\\text{DEM} - u_f\\| = \\sqrt{\\frac{1}{T}\\sum_{n=0}^{N-1} \\Delta t \\left(u_\\text{DEM}^{n+1} - u_f^{n+1}\\right)^2},$$\n其单位为米每秒（m/s），因为因子 $\\Delta t/T$ 是无量纲的。\n\n算法设计：\n1. 对于罚函数法，初始化 $u_\\text{DEM}^{0} = 0$ 和 $u_f^{0} = 0$；对于拉格朗日乘子法，初始化 $u^{0} = 0$。\n2. 对于每个时间步 $n = 0,\\dots,N-1$（其中 $N = T/\\Delta t$），计算 $t^{n+1} = (n+1)\\Delta t$ 和 $f_s(t^{n+1}) = F_0 \\sin(2\\pi f t^{n+1})$。\n3. 罚函数法：\n   - 计算 $c_t = \\zeta \\sqrt{k_n m_p}$ 和 $K = c_t + \\gamma$。\n   - 构建 $2\\times 2$ 系统并使用直接求解器求解 $\\left(u_\\text{DEM}^{n+1}, u_f^{n+1}\\right)$。\n4. 拉格朗日乘子法：\n   - 使用标量隐式欧拉公式更新公共速度 $u^{n+1}$，并设置 $u_\\text{DEM}^{n+1} = u_f^{n+1} = u^{n+1}$。\n5. 在每一步累加滑移的平方乘以 $\\Delta t$ 以形成误差度量的分子；除以 $T$ 并取平方根以获得 $\\|u_\\text{DEM} - u_f\\|$。\n6. 对于提供的测试套件，为每个元组 $(\\text{method}, \\gamma, k_n)$ 运行模拟，并将所得误差范数收集到一个列表中。\n\n科学真实性与耦合原理：\n- 使用牛顿第二定律确保了每个子系统的动量守恒。\n- 线性粘性切向牵引力 $c_t(u_\\text{DEM} - u_f)$ 捕捉了可归因于近接触阻尼的界面动量交换，并通过 $c_t = \\zeta \\sqrt{k_n m_p}$ 与 $k_n$ 缩放，以反映在更硬的法向接触下更强的相互作用。\n- 罚函数法通过在速度空间中增加数值刚度（通过 $\\gamma$）来近似无滑移约束，这会减少滑移，但除非 $\\gamma \\to \\infty$，否则无法使其恒为零。\n- 拉格朗日乘子法通过引入一个辅助变量来精确施加该约束，该变量调整界面牵引力以在每个时间层级上满足 $u_\\text{DEM} = u_f$，根据构造，产生零连续性误差。\n\n最终程序实现了这些步骤，使用指定的单位，并以单行输出所有测试用例的误差范数，单位为 m/s。",
            "answer": "```python\nimport numpy as np\n\ndef simulate_penalty(gamma, k_n, params):\n    # Unpack parameters\n    m_p = params[\"m_p\"]\n    m_f = params[\"m_f\"]\n    b = params[\"b\"]\n    zeta = params[\"zeta\"]\n    dt = params[\"dt\"]\n    T = params[\"T\"]\n    F0 = params[\"F0\"]\n    freq = params[\"freq\"]\n    N = int(np.round(T / dt))\n\n    # Interface viscous coefficient scaled by normal stiffness\n    c_t = zeta * np.sqrt(k_n * m_p)\n    K = c_t + gamma\n\n    # Initialize velocities\n    u_dem = 0.0\n    u_f = 0.0\n\n    # Accumulate squared slip for error norm\n    slip_accum = 0.0\n\n    # Precompute coefficients\n    a11 = m_p / dt + K\n    a12 = -K\n    # Fluid equation coefficients depend on b; recompute at each step only RHS\n    b11 = -K\n    b22 = m_f / dt + b + K\n\n    for n in range(N):\n        tnp1 = (n + 1) * dt\n        f_s = F0 * np.sin(2.0 * np.pi * freq * tnp1)\n\n        rhs1 = (m_p / dt) * u_dem\n        rhs2 = f_s + (m_f / dt) * u_f\n\n        # Solve 2x2 linear system:\n        # [a11 a12][u_dem^{n+1}] = [rhs1]\n        # [b11 b22][u_f^{n+1}]   = [rhs2]\n        # But note the coupling: second equation also has u_dem^{n+1} term (b11).\n        # Form matrix and right-hand side.\n        A = np.array([[a11, a12],\n                      [b11, b22]], dtype=float)\n        rhs = np.array([rhs1, rhs2], dtype=float)\n\n        sol = np.linalg.solve(A, rhs)\n        u_dem_new, u_f_new = sol[0], sol[1]\n\n        slip = u_dem_new - u_f_new\n        slip_accum += dt * (slip * slip)\n\n        u_dem = u_dem_new\n        u_f = u_f_new\n\n    error = np.sqrt(slip_accum / T)\n    return error\n\ndef simulate_lagrange_multiplier(k_n, params):\n    # Unpack parameters\n    m_p = params[\"m_p\"]\n    m_f = params[\"m_f\"]\n    b = params[\"b\"]\n    dt = params[\"dt\"]\n    T = params[\"T\"]\n    F0 = params[\"F0\"]\n    freq = params[\"freq\"]\n    N = int(np.round(T / dt))\n\n    # Initialize common velocity\n    u = 0.0\n\n    slip_accum = 0.0  # will remain zero by construction\n\n    # Coefficient for implicit Euler update\n    M_over_dt = (m_p + m_f) / dt\n    denom = M_over_dt + b\n\n    for n in range(N):\n        tnp1 = (n + 1) * dt\n        f_s = F0 * np.sin(2.0 * np.pi * freq * tnp1)\n        rhs = f_s + M_over_dt * u\n        u_new = rhs / denom\n        # Enforced equality\n        u_dem_new = u_new\n        u_f_new = u_new\n\n        slip = u_dem_new - u_f_new\n        slip_accum += dt * (slip * slip)\n\n        u = u_new\n\n    error = np.sqrt(slip_accum / T)\n    return error\n\ndef solve():\n    # Define global parameters\n    params = {\n        \"m_p\": 0.01,     # kg\n        \"m_f\": 0.02,     # kg\n        \"b\": 0.1,        # kg/s\n        \"zeta\": 0.2,     # dimensionless\n        \"dt\": 1e-4,      # s\n        \"T\": 0.5,        # s\n        \"F0\": 0.01,      # N\n        \"freq\": 2.0      # Hz\n    }\n\n    # Test suite: (method, gamma, k_n)\n    test_cases = [\n        (\"penalty\", 0.0, 1e3),    # boundary: no penalty\n        (\"penalty\", 10.0, 1e3),   # moderate penalty\n        (\"penalty\", 1e3, 1e3),    # very large penalty\n        (\"penalty\", 1e2, 1e5),    # strong contact stiffness\n        (\"penalty\", 1e2, 1e2),    # weak contact stiffness\n        (\"LM\", 0.0, 1e3),         # LM enforcement, k_n nominal\n        (\"LM\", 1e2, 1e5)          # LM enforcement, k_n varied\n    ]\n\n    results = []\n    for method, gamma, k_n in test_cases:\n        if method == \"penalty\":\n            err = simulate_penalty(gamma, k_n, params)\n        elif method == \"LM\":\n            # gamma not used in LM method\n            err = simulate_lagrange_multiplier(k_n, params)\n        else:\n            err = float('nan')\n        results.append(err)\n\n    # Print in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "一个物理上有效的模拟必须遵守基本的守恒定律，但数值耦合方案可能在不经意间违反这些定律。本实践  聚焦于一项关键的验证任务：检验一个 DEM-连续介质耦合系统的机械能平衡。通过实现一个能量收支检查程序，您将学会如何检测伪能的产生或耗散，这些问题通常由界面上不一致的运动学条件引起。这项技能对于确保任何多物理场模拟的可靠性和物理保真度都是不可或缺的。",
            "id": "3504358",
            "problem": "考虑一个耦合的离散元法 (DEM) – 连续介质系统。您的目标是实现一个程序，该程序针对一组给定的粒子状态、接触、外部载荷和界面牵引力，验证 DEM-连续介质界面上的机械能平衡，并检测伪能量的产生。在某一瞬间需要检查的能量平衡由能量守恒和牛顿定律导出，表述如下：DEM 机械能的时间导数（记为 $\\dot{E}$）必须满足\n$$\n\\dot{E} \\equiv \\frac{d}{dt}\\left(T + U\\right) = P_{\\text{int}} + P_{\\text{ext}} - D,\n$$\n其中 $T$ 是 DEM 粒子的动能，$U$ 是存储在 DEM 接触中的总弹性势能，$P_{\\text{int}}$ 是通过 DEM-连续介质界面的功率通量，$P_{\\text{ext}}$ 是作用在 DEM 粒子上的外力的功率，$D$ 是由于接触阻尼引起的能量耗散率。DEM-连续介质界面功率由作用在界面上的连续介质牵引力 $\\boldsymbol{t}$ 和界面上的连续介质速度 $\\boldsymbol{v}$ 定义，\n$$\nP_{\\text{int}} = \\int_{\\Gamma} \\boldsymbol{t} \\cdot \\boldsymbol{v} \\, d\\Gamma \\approx \\sum_{i \\in \\text{interface nodes}} \\boldsymbol{f}_i \\cdot \\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i),\n$$\n其中 $\\boldsymbol{f}_i$ 是施加在界面点 $\\boldsymbol{x}_i$ 处 DEM 粒子上的离散界面力，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i)$ 是这些点处的连续介质速度。外力功率为\n$$\nP_{\\text{ext}} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{f}_{\\text{ext},i},\n$$\n其中 $\\boldsymbol{v}_i$ 是 DEM 粒子速度，$\\boldsymbol{f}_{\\text{ext},i}$ 是如重力等外力。耗散功率通过接触上的线性黏壶来建模，\n$$\nD = \\sum_{j=1}^{M} c_j \\, \\dot{\\delta}_j^2,\n$$\n其中 $c_j$ 是阻尼系数，$\\dot{\\delta}_j$ 是接触 $j$ 的法向相对速度。机械能的时间导数将从第一性原理计算：\n$$\n\\dot{E} = \\frac{dT}{dt} + \\frac{dU}{dt} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{F}_{\\text{total},i} + \\sum_{j=1}^{M} k_j \\, \\delta_j \\, \\dot{\\delta}_j,\n$$\n其中 $\\boldsymbol{F}_{\\text{total},i} = \\boldsymbol{f}_{\\text{ext},i} + \\boldsymbol{f}_{\\text{int},i} + \\sum_{j \\in \\mathcal{C}(i)} \\boldsymbol{f}_{\\text{contact},ij}$，$\\boldsymbol{f}_{\\text{contact},ij}$ 是接触 $j$ 对粒子 $i$ 施加的接触力，其模型为\n$$\n\\boldsymbol{f}_{\\text{contact},ij} = -k_j \\, \\delta_j \\, \\boldsymbol{n}_j - c_j \\, \\dot{\\delta}_j \\, \\boldsymbol{n}_j,\n$$\n其中 $k_j$ 是法向刚度，$\\delta_j$ 是法向重叠量（伸展/压缩），$\\boldsymbol{n}_j$ 是接触 $j$ 的单位法向方向。接触运动学满足 $\\dot{\\delta}_j = \\boldsymbol{n}_j \\cdot (\\boldsymbol{v}_{p(j)} - \\boldsymbol{v}_{q(j)})$，其中 $p(j)$ 和 $q(j)$ 是构成接触 $j$ 的粒子索引。\n\n实现一个程序，对下面的每个测试用例，使用上述定义计算 $\\dot{E}$、$P_{\\text{int}}$、$P_{\\text{ext}}$ 和 $D$，并返回一个布尔值，指示是否满足\n$$\n\\left|\\dot{E} - \\left(P_{\\text{int}} + P_{\\text{ext}} - D\\right)\\right| \\le \\varepsilon,\n$$\n容差为 $\\varepsilon = 10^{-9}$。任何违反都表明在 DEM-连续介质界面上存在伪能量的产生或损失，这可归因于运动学不一致性（例如，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i) \\ne \\boldsymbol{v}_i$）。\n\n使用以下单位：质量（千克，$\\mathrm{kg}$），速度（米/秒，$\\mathrm{m/s}$），力（牛顿，$\\mathrm{N}$），刚度（牛顿/米，$\\mathrm{N/m}$），阻尼（牛顿·秒/米，$\\mathrm{N \\cdot s/m}$），能量（焦耳，$\\mathrm{J}$），功率（瓦特，$\\mathrm{W}$）。不使用角度。您的程序不得读取任何输入，并且必须嵌入以下测试套件：\n\n- 测试用例 1（正常路径：界面运动学一致，能量平衡成立）：\n    - 粒子数 $N = 3$，在二维空间中。\n    - 质量：粒子 $0$：$2.0$，粒子 $1$：$1.0$，粒子 $2$：$1.5$。\n    - 速度：$\\boldsymbol{v}_0 = (1.0, 0.5)$，$\\boldsymbol{v}_1 = (0.2, -0.1)$，$\\boldsymbol{v}_2 = (-0.3, 0.4)$。\n    - 外力（沿 $y$ 轴的重力，$g = -9.81$）：$\\boldsymbol{f}_{\\text{ext},0} = (0.0, -19.62)$，$\\boldsymbol{f}_{\\text{ext},1} = (0.0, -9.81)$，$\\boldsymbol{f}_{\\text{ext},2} = (0.0, -14.715)$。\n    - 界面力：$\\boldsymbol{f}_{\\text{int},0} = (5.0, -2.0)$，$\\boldsymbol{f}_{\\text{int},1} = (0.0, 0.0)$，$\\boldsymbol{f}_{\\text{int},2} = (0.0, 0.0)$。\n    - 界面处的连续介质速度：$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0) = (1.0, 0.5)$，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_1) = (0.2, -0.1)$，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_2) = (-0.3, 0.4)$。\n    - 接触：\n        - 接触 1：粒子 $(0,1)$，$\\boldsymbol{n}_1 = (1.0,0.0)$，刚度 $k_1 = 50.0$，阻尼 $c_1 = 1.0$，重叠量 $\\delta_1 = 0.1$，相对法向速度 $\\dot{\\delta}_1 = 0.8$。\n        - 接触 2：粒子 $(1,2)$，$\\boldsymbol{n}_2 = (0.0,1.0)$，刚度 $k_2 = 50.0$，阻尼 $c_2 = 1.0$，重叠量 $\\delta_2 = -0.05$，相对法向速度 $\\dot{\\delta}_2 = -0.5$。\n\n- 测试用例 2（伪能量产生：界面处连续介质速度不同）：\n    - 粒子、质量、速度、外力和界面力以及接触均与测试用例 1 相同。\n    - 粒子 $0$ 处的连续介质速度更改为 $\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0) = (1.5, 0.5)$；其他连续介质速度不变。\n\n- 测试用例 3（边界情况：全零）：\n    - 粒子数 $N = 2$，在二维空间中。\n    - 质量：粒子 $0$：$1.0$，粒子 $1$：$1.0$。\n    - 速度：$\\boldsymbol{v}_0 = (0.0, 0.0)$，$\\boldsymbol{v}_1 = (0.0, 0.0)$。\n    - 外力：$\\boldsymbol{f}_{\\text{ext},0} = (0.0, 0.0)$，$\\boldsymbol{f}_{\\text{ext},1} = (0.0, 0.0)$。\n    - 界面力：$\\boldsymbol{f}_{\\text{int},0} = (0.0, 0.0)$，$\\boldsymbol{f}_{\\text{int},1} = (0.0, 0.0)$。\n    - 界面处的连续介质速度：$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0) = (0.0, 0.0)$，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_1) = (0.0, 0.0)$。\n    - 接触：\n        - 接触 1：粒子 $(0,1)$，$\\boldsymbol{n}_1 = (1.0,0.0)$，刚度 $k_1 = 10.0$，阻尼 $c_1 = 2.0$，重叠量 $\\delta_1 = 0.0$，相对法向速度 $\\dot{\\delta}_1 = 0.0$。\n\n- 测试用例 4（边缘情况：高耗散接触，无刚度）：\n    - 粒子数 $N = 2$，在二维空间中。\n    - 质量：粒子 $0$：$1.0$，粒子 $1$：$2.0$。\n    - 速度：$\\boldsymbol{v}_0 = (1.0, 0.0)$，$\\boldsymbol{v}_1 = (-1.0, 0.0)$。\n    - 外力：$\\boldsymbol{f}_{\\text{ext},0} = (0.0, 0.0)$，$\\boldsymbol{f}_{\\text{ext},1} = (0.0, 0.0)$。\n    - 界面力：$\\boldsymbol{f}_{\\text{int},0} = (10.0, 0.0)$，$\\boldsymbol{f}_{\\text{int},1} = (0.0, 0.0)$。\n    - 界面处的连续介质速度：$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0) = (1.0, 0.0)$，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_1) = (-1.0, 0.0)$。\n    - 接触：\n        - 接触 1：粒子 $(0,1)$，$\\boldsymbol{n}_1 = (1.0,0.0)$，刚度 $k_1 = 0.0$，阻尼 $c_1 = 10.0$，重叠量 $\\delta_1 = 0.0$，相对法向速度 $\\dot{\\delta}_1 = 2.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\text{True},\\text{False},\\text{True},\\text{True}]$）。对于每个测试用例，如果平衡在容差范围内成立，则输出布尔值 $\\text{True}$，否则输出 $\\text{False}$。",
            "solution": "用户希望验证一个问题陈述，如果有效，则提供一个完整的解决方案，包括一个 Python 程序。\n\n### 问题验证\n\n**步骤 1：提取给定条件**\n\n问题提供了以下定义、方程和数据：\n\n- **能量平衡方程**：DEM 机械能的时间导数 $\\dot{E}$ 必须满足：\n$$\n\\dot{E} = P_{\\text{int}} + P_{\\text{ext}} - D\n$$\n- **能量/功率项的定义**：\n    - 机械能：$E = T + U$，其中 $T$ 是动能，$U$ 是弹性势能。\n    - 界面功率 ($P_{\\text{int}}$)：从连续介质到 DEM 系统的功率通量，近似为：\n    $$\n    P_{\\text{int}} \\approx \\sum_{i \\in \\text{interface nodes}} \\boldsymbol{f}_i \\cdot \\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i)\n    $$\n    其中 $\\boldsymbol{f}_i$ 是离散界面力，$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i)$ 是界面点处的连续介质速度。\n    - 外力功率 ($P_{\\text{ext}}$)：\n    $$\n    P_{\\text{ext}} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{f}_{\\text{ext},i}\n    $$\n    其中 $\\boldsymbol{v}_i$ 是粒子速度，$\\boldsymbol{f}_{\\text{ext},i}$ 是外力。\n    - 耗散功率 ($D$)：\n    $$\n    D = \\sum_{j=1}^{M} c_j \\, \\dot{\\delta}_j^2\n    $$\n    其中 $c_j$ 是阻尼系数，$\\dot{\\delta}_j$ 是接触 $j$ 的法向相对速度。\n- **从第一性原理计算 $\\dot{E}$**：\n    $$\n    \\dot{E} = \\frac{dT}{dt} + \\frac{dU}{dt} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{F}_{\\text{total},i} + \\sum_{j=1}^{M} k_j \\, \\delta_j \\, \\dot{\\delta}_j\n    $$\n- **力的定义**：\n    - 粒子 $i$ 上的总力：$\\boldsymbol{F}_{\\text{total},i} = \\boldsymbol{f}_{\\text{ext},i} + \\boldsymbol{f}_{\\text{int},i} + \\sum_{j \\in \\mathcal{C}(i)} \\boldsymbol{f}_{\\text{contact},ij}$\n    - 接触力模型：$\\boldsymbol{f}_{\\text{contact},ij} = -k_j \\, \\delta_j \\, \\boldsymbol{n}_j - c_j \\, \\dot{\\delta}_j \\, \\boldsymbol{n}_j$\n    - 接触运动学：$\\dot{\\delta}_j = \\boldsymbol{n}_j \\cdot (\\boldsymbol{v}_{p(j)} - \\boldsymbol{v}_{q(j)})$，其中 $p(j)$ 和 $q(j)$ 是接触 $j$ 中的粒子。\n- **验证条件**：\n    $$\n    \\left|\\dot{E} - \\left(P_{\\text{int}} + P_{\\text{ext}} - D\\right)\\right| \\le \\varepsilon\n    $$\n    容差为 $\\varepsilon = 10^{-9}$。\n- **测试用例**：\n    - **测试用例 1**：$N=3$，二维。质量：$m_0=2.0, m_1=1.0, m_2=1.5$。速度：$\\boldsymbol{v}_0=(1.0, 0.5), \\boldsymbol{v}_1=(0.2, -0.1), \\boldsymbol{v}_2=(-0.3, 0.4)$。外力：$\\boldsymbol{f}_{\\text{ext},0}=(0.0, -19.62), \\boldsymbol{f}_{\\text{ext},1}=(0.0, -9.81), \\boldsymbol{f}_{\\text{ext},2}=(0.0, -14.715)$。界面力：$\\boldsymbol{f}_{\\text{int},0}=(5.0, -2.0)$，其余为零。连续介质速度：$\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0)=(1.0, 0.5)$，等于粒子速度。接触：$(0,1)$，$\\boldsymbol{n}_1=(1,0), k_1=50, c_1=1, \\delta_1=0.1, \\dot{\\delta}_1=0.8$；以及 $(1,2)$，$\\boldsymbol{n}_2=(0,1), k_2=50, c_2=1, \\delta_2=-0.05, \\dot{\\delta}_2=-0.5$。\n    - **测试用例 2**：与用例 1 相同，但 $\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_0)=(1.5, 0.5)$。\n    - **测试用例 3**：$N=2$，二维。质量：$m_0=1.0, m_1=1.0$。所有其他量（速度、力、接触参数）均为零。\n    - **测试用例 4**：$N=2$，二维。质量：$m_0=1.0, m_1=2.0$。速度：$\\boldsymbol{v}_0=(1.0, 0.0), \\boldsymbol{v}_1=(-1.0, 0.0)$。外力：零。界面力：$\\boldsymbol{f}_{\\text{int},0}=(10.0, 0.0)$。连续介质速度等于粒子速度。接触：$(0,1)$，$\\boldsymbol{n}_1=(1,0), k_1=0.0, c_1=10.0, \\delta_1=0.0, \\dot{\\delta}_1=2.0$。\n\n**步骤 2：使用提取的给定条件进行验证**\n\n1.  **科学或事实上的不健全性**：该问题基于经典力学原理，特别是应用于离散粒子系统功能定理。功率、动能变化率、势能变化率和耗散的方程在离散元法 (DEM) 模拟领域是标准的。没有违反基本科学原理的地方。\n\n2.  **非形式化或不相关**：该问题高度形式化，并与指定的主题 *离散元法 (DEM) 及其与连续介质的耦合* 直接相关，这是多物理场模拟中的一个核心课题。\n\n3.  **不完整或矛盾的设置**：问题提供了执行每个测试用例所需计算的所有必要数据。有必要进行内部一致性检查。问题陈述以运动学方式定义了 $\\dot{\\delta}_j$，但也在测试用例中直接给出了其值。检查确认所提供的值与运动学一致。例如，在用例 1 中，对于粒子 0 和 1 之间的接触 1：$\\boldsymbol{n}_1 \\cdot (\\boldsymbol{v}_0 - \\boldsymbol{v}_1) = (1.0, 0.0) \\cdot ((1.0, 0.5) - (0.2, -0.1)) = (1.0, 0.0) \\cdot (0.8, 0.6) = 0.8$，这与给定的 $\\dot{\\delta}_1 = 0.8$ 相匹配。这种一致性在所有用例中都成立，从而验证了所提供的数据。在运动学一致的假设下，$\\dot{E}$ 的两个公式也是自洽的，因为它们的差值隔离了由于界面上运动学不匹配而产生的伪功率，而这正是我们感兴趣的量。\n\n4.  **不切实际或不可行**：物理参数和单位是标准且一致的。这些场景虽然经过简化，但代表了耦合 DEM-连续介质模拟中常见的条件。不存在物理上的不可能性。\n\n5.  **不适定或结构不良**：问题是适定的。对于每组输入，都可以计算出唯一的结果（一个布尔值）。术语精确无歧义。\n\n6.  **伪深刻、琐碎或同义反复**：问题并非琐碎。它需要仔细实现几个相互关联的物理公式，以正确计算所有能量和功率贡献。核心概念挑战是理解能量率的不同表述如何相互关联，并揭示像伪能量产生这样的数值伪影。\n\n7.  **超出科学可验证范围**：问题是一个计算验证任务，完全可以通过计算来验证。\n\n**步骤 3：结论和行动**\n\n问题是 **有效** 的。它在科学上是合理的、适定的，并且所有必要的数据和关系都已提供且内部一致。该任务是在数值模拟背景下验证基本守恒定律的一个清晰且相关的练习。将提供一个完整的、有理有据的解决方案。\n\n### 解决方案\n\n该问题要求验证耦合 DEM-连续介质系统中一组粒子的机械能平衡。能量平衡方程为 $\\dot{E} = P_{\\text{int}} + P_{\\text{ext}} - D$。任务的核心是独立计算左侧 (LHS) $\\dot{E}$ 和右侧 (RHS) $P_{\\text{int}} + P_{\\text{ext}} - D$，然后检查它们的差值是否在给定的容差 $\\varepsilon = 10^{-9}$ 内。差异表明能量守恒被违反，这通常是由于耦合方案中的不一致性造成的，问题将其建模为界面处粒子和连续介质速度之间的不匹配。\n\n解决每个测试用例的逻辑步骤如下：\n\n1.  **计算 RHS 的各项**：\n    - **外力功率 ($P_{\\text{ext}}$)**：这是外力对粒子做功的速率。通过将每个粒子的速度 $\\boldsymbol{v}_i$ 与作用在其上的外力 $\\boldsymbol{f}_{\\text{ext},i}$ 的点积求和来计算：\n      $$P_{\\text{ext}} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{f}_{\\text{ext},i}$$\n    - **界面功率 ($P_{\\text{int}}$)**：这是从连续介质传递给 DEM 粒子的功率。通过将每个粒子上的界面力 $\\boldsymbol{f}_{\\text{int},i}$ 与该粒子位置处的连续介质速度 $\\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i)$ 的点积求和来计算。\n      $$P_{\\text{int}} = \\sum_{i=1}^{N} \\boldsymbol{f}_{\\text{int},i} \\cdot \\boldsymbol{v}_{\\text{cont}}(\\boldsymbol{x}_i)$$\n      请注意，求和是针对所有粒子，但仅对于界面上的粒子，项才非零。\n    - **耗散功率 ($D$)**：这是由于接触中的粘性阻尼导致的能量损失率。通过对每个接触的贡献求和来计算，其中每个贡献是阻尼系数 $c_j$ 乘以法向相对速度 $\\dot{\\delta}_j$ 的平方。\n      $$D = \\sum_{j=1}^{M} c_j \\dot{\\delta}_j^2$$\n    - 然后将 RHS 组装为 $RHS = P_{\\text{int}} + P_{\\text{ext}} - D$。\n\n2.  **计算 LHS ($\\dot{E}$)**：\n    - 机械能的时间导数 $\\dot{E}$ 由动能变化率 $dT/dt$ 和势能变化率 $dU/dt$ 的和给出。\n      $$\\dot{E} = \\frac{dT}{dt} + \\frac{dU}{dt}$$\n    - **势能变化率 ($dU/dt$)**：对于线性弹簧系统，这由所有接触上的弹簧刚度 $k_j$、重叠量 $\\delta_j$ 和重叠变化率 $\\dot{\\delta}_j$ 的乘积之和给出。\n      $$\\frac{dU}{dt} = \\sum_{j=1}^{M} k_j \\delta_j \\dot{\\delta}_j$$\n    - **动能变化率 ($dT/dt$)**：根据功能定理，系统动能的变化率是作用在其上的总合力的功率。必须首先计算每个粒子上的总力 $\\boldsymbol{F}_{\\text{total},i}$。\n      $$\\boldsymbol{F}_{\\text{total},i} = \\boldsymbol{f}_{\\text{ext},i} + \\boldsymbol{f}_{\\text{int},i} + \\sum_{j \\in \\text{contacts of } i} \\boldsymbol{f}_{\\text{contact},ij}$$\n      对于法向为 $\\boldsymbol{n}_j$（通常指向从 $q(j)$ 到 $p(j)$）的粒子 $p(j)$ 和 $q(j)$ 之间的接触 $j$，接触力由线性弹簧-黏壶模型给出。施加在粒子 $p(j)$ 上的力为：\n      $$\\boldsymbol{f}_{\\text{contact},j} = -(k_j \\delta_j + c_j \\dot{\\delta}_j) \\boldsymbol{n}_j$$\n      根据牛顿第三定律，施加在粒子 $q(j)$ 上的力是 $-\\boldsymbol{f}_{\\text{contact},j}$。在求和所有外力、界面力和接触力以找到每个粒子上的总力 $\\boldsymbol{F}_{\\text{total},i}$ 后，动能的变化率为：\n      $$\\frac{dT}{dt} = \\sum_{i=1}^{N} \\boldsymbol{v}_i \\cdot \\boldsymbol{F}_{\\text{total},i}$$\n    - 然后将 LHS 组装为 $LHS = \\dot{E} = \\frac{dT}{dt} + \\frac{dU}{dt}$。\n\n3.  **验证**：最后一步是比较 LHS 和 RHS。如果绝对差小于或等于指定的容差 $\\varepsilon$，则认为能量平衡得到满足。\n    $$|\\text{LHS} - \\text{RHS}| \\le \\varepsilon$$\n    如果此条件成立，则测试用例的结果为 `True`，否则为 `False`。\n\n此过程将针对所提供的四个测试用例中的每一个进行实施。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef check_energy_balance(case_data):\n    \"\"\"\n    Computes and verifies the energy balance for a single DEM-continuum test case.\n\n    Args:\n        case_data (dict): A dictionary containing all parameters for the test case.\n\n    Returns:\n        bool: True if the energy balance holds within the tolerance, False otherwise.\n    \"\"\"\n    N = case_data[\"num_particles\"]\n    velocities = case_data[\"velocities\"]\n    f_ext = case_data[\"external_forces\"]\n    f_int = case_data[\"interface_forces\"]\n    v_cont = case_data[\"continuum_velocities\"]\n    contacts = case_data[\"contacts\"]\n    tolerance = 1e-9\n\n    # 1. Compute the RHS of the energy balance equation: P_int + P_ext - D\n\n    # External Power (P_ext)\n    P_ext = 0.0\n    for i in range(N):\n        P_ext += np.dot(velocities[i], f_ext[i])\n\n    # Interface Power (P_int)\n    P_int = 0.0\n    for i in range(N):\n        P_int += np.dot(f_int[i], v_cont[i])\n\n    # Dissipated Power (D)\n    D = 0.0\n    for contact in contacts:\n        c_j = contact[\"c\"]\n        ddot_delta_j = contact[\"ddot_delta\"]\n        D += c_j * ddot_delta_j**2\n\n    RHS = P_int + P_ext - D\n\n    # 2. Compute the LHS of the energy balance equation: E_dot = dT/dt + dU/dt\n\n    # Rate of change of potential energy (dU/dt)\n    dU_dt = 0.0\n    for contact in contacts:\n        k_j = contact[\"k\"]\n        delta_j = contact[\"delta\"]\n        ddot_delta_j = contact[\"ddot_delta\"]\n        dU_dt += k_j * delta_j * ddot_delta_j\n\n    # Total forces for dT/dt calculation\n    F_total = [np.copy(f_ext[i]) + np.copy(f_int[i]) for i in range(N)]\n    \n    for contact in contacts:\n        p, q = contact[\"particles\"]\n        k_j = contact[\"k\"]\n        c_j = contact[\"c\"]\n        delta_j = contact[\"delta\"]\n        ddot_delta_j = contact[\"ddot_delta\"]\n        n_j = contact[\"n\"]\n        \n        # Force on particle p from particle q\n        f_contact_on_p = -(k_j * delta_j + c_j * ddot_delta_j) * n_j\n        \n        F_total[p] += f_contact_on_p\n        F_total[q] -= f_contact_on_p # Newton's 3rd Law\n\n    # Rate of change of kinetic energy (dT/dt)\n    dT_dt = 0.0\n    for i in range(N):\n        dT_dt += np.dot(velocities[i], F_total[i])\n\n    LHS = dT_dt + dU_dt\n\n    # 3. Verification\n    residual = abs(LHS - RHS)\n    return residual = tolerance\n\ndef solve():\n    \"\"\"\n    Defines test cases and runs the energy balance check for each.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (happy path: interface kinematics consistent)\n        {\n            \"num_particles\": 3,\n            \"masses\": [2.0, 1.0, 1.5],\n            \"velocities\": [np.array([1.0, 0.5]), np.array([0.2, -0.1]), np.array([-0.3, 0.4])],\n            \"external_forces\": [np.array([0.0, -19.62]), np.array([0.0, -9.81]), np.array([0.0, -14.715])],\n            \"interface_forces\": [np.array([5.0, -2.0]), np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"continuum_velocities\": [np.array([1.0, 0.5]), np.array([0.2, -0.1]), np.array([-0.3, 0.4])],\n            \"contacts\": [\n                {\"particles\": (0, 1), \"n\": np.array([1.0, 0.0]), \"k\": 50.0, \"c\": 1.0, \"delta\": 0.1, \"ddot_delta\": 0.8},\n                {\"particles\": (1, 2), \"n\": np.array([0.0, 1.0]), \"k\": 50.0, \"c\": 1.0, \"delta\": -0.05, \"ddot_delta\": -0.5},\n            ],\n        },\n        # Test case 2 (spurious generation: continuum velocity differs)\n        {\n            \"num_particles\": 3,\n            \"masses\": [2.0, 1.0, 1.5],\n            \"velocities\": [np.array([1.0, 0.5]), np.array([0.2, -0.1]), np.array([-0.3, 0.4])],\n            \"external_forces\": [np.array([0.0, -19.62]), np.array([0.0, -9.81]), np.array([0.0, -14.715])],\n            \"interface_forces\": [np.array([5.0, -2.0]), np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"continuum_velocities\": [np.array([1.5, 0.5]), np.array([0.2, -0.1]), np.array([-0.3, 0.4])],\n            \"contacts\": [\n                {\"particles\": (0, 1), \"n\": np.array([1.0, 0.0]), \"k\": 50.0, \"c\": 1.0, \"delta\": 0.1, \"ddot_delta\": 0.8},\n                {\"particles\": (1, 2), \"n\": np.array([0.0, 1.0]), \"k\": 50.0, \"c\": 1.0, \"delta\": -0.05, \"ddot_delta\": -0.5},\n            ],\n        },\n        # Test case 3 (boundary case: all zeros)\n        {\n            \"num_particles\": 2,\n            \"masses\": [1.0, 1.0],\n            \"velocities\": [np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"external_forces\": [np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"interface_forces\": [np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"continuum_velocities\": [np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"contacts\": [\n                {\"particles\": (0, 1), \"n\": np.array([1.0, 0.0]), \"k\": 10.0, \"c\": 2.0, \"delta\": 0.0, \"ddot_delta\": 0.0},\n            ],\n        },\n        # Test case 4 (edge case: highly dissipative contact, no stiffness)\n        {\n            \"num_particles\": 2,\n            \"masses\": [1.0, 2.0],\n            \"velocities\": [np.array([1.0, 0.0]), np.array([-1.0, 0.0])],\n            \"external_forces\": [np.array([0.0, 0.0]), np.array([0.0, 0.0])],\n            \"interface_forces\": [np.array([10.0, 0.0]), np.array([0.0, 0.0])],\n            \"continuum_velocities\": [np.array([1.0, 0.0]), np.array([-1.0, 0.0])],\n            \"contacts\": [\n                {\"particles\": (0, 1), \"n\": np.array([1.0, 0.0]), \"k\": 0.0, \"c\": 10.0, \"delta\": 0.0, \"ddot_delta\": 2.0},\n            ],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = check_energy_balance(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}