{
    "hands_on_practices": [
        {
            "introduction": "波在介质中的传播是理解其力学行为的基础。在近场动力学等非局部理论中，波动行为与经典连续介质理论存在显著差异，尤其是在短波长下。本练习旨在通过推导一维杆中的色散关系，揭示近场动力学模型的内在尺度效应，并展示其如何在长波极限下回归到经典的波动方程 。",
            "id": "3520663",
            "problem": "考虑一个由近场动力学 (Peridynamics, PD) 描述的无限长一维均匀杆，其中近场动力学是一种非局部连续介质理论，在该理论中，物质点通过有限空间视域内的对偶键相互作用。假设一个基于键的线性弹性近场动力学模型，其均匀视域为 $\\delta$，对于长度为 $|\\xi|\\leq \\delta$ 的键，其微模量为常数 $c$，否则相互作用为零。设质量密度为 $\\rho$，并忽略外部体力。从牛顿第二定律和基于键的近场动力学小纵向位移运动方程出发，考虑形式为 $u(x,t)=U\\exp(i(k x - \\omega t))$ 的小振幅平面波解，其中波数 $k$ 为实数，角频率为 $\\omega$。推导 $\\omega^{2}(k)$ 关于 $c$, $\\rho$, $\\delta$ 和 $k$ 的精确色散关系的闭式解析表达式。然后，将您的结果按无量纲波数 $k\\delta$ 的幂次展开，以确定经典局部连续介质极限和相应的等效波速。用 $c$, $\\rho$, $\\delta$ 和 $k$ 表示 $\\omega^{2}(k)$ 的精确闭式表达式作为最终答案。无需进行数值计算，最终表达式中也不包含单位。",
            "solution": "推导始于将牛顿第二定律应用于位置为 $x$、质量密度为 $\\rho$ 的物质点，并结合基于键的线性近场动力学运动方程。在一维情况下，对于视域为 $\\delta$ 且 $|\\xi|\\leq \\delta$ 时微模量为常数 $c$ 的模型，其小纵向位移 $u(x,t)$ 的近场动力学运动方程为\n$$\n\\rho\\ddot{u}(x,t) = \\int_{-\\delta}^{\\delta} c\\big(u(x+\\xi,t)-u(x,t)\\big)\\,d\\xi,\n$$\n其中 $\\xi$ 表示一维中的相对位置向量，$\\ddot{u}$ 是 $u$ 的二阶时间导数。该形式是牛顿第二定律以及基于键的一维运动学近场动力学线性对偶力函数的直接结果。\n\n我们寻找形式为\n$$\nu(x,t) = U\\exp\\!\\big(i(kx-\\omega t)\\big),\n$$\n的平面波解，其中振幅为 $U$，波数为实数 $k$，角频率为 $\\omega$。将此试探解代入运动方程，等式左边变为\n$$\n\\rho\\ddot{u}(x,t) = \\rho(-\\omega^{2})U\\exp\\!\\big(i(kx-\\omega t)\\big).\n$$\n等式右边变为\n$$\n\\int_{-\\delta}^{\\delta} c\\big(U\\exp\\!\\big(i(k(x+\\xi)-\\omega t)\\big) - U\\exp\\!\\big(i(kx-\\omega t)\\big)\\big)\\,d\\xi\n= U\\exp\\!\\big(i(kx-\\omega t)\\big)\\int_{-\\delta}^{\\delta} c\\big(\\exp(i k \\xi)-1\\big)\\,d\\xi.\n$$\n消去公因子 $U\\exp\\!\\big(i(kx-\\omega t)\\big)$，得到隐式积分形式的色散关系：\n$$\n-\\rho\\omega^{2} = \\int_{-\\delta}^{\\delta} c\\big(\\exp(i k \\xi)-1\\big)\\,d\\xi.\n$$\n我们显式地计算该积分。$\\exp(i k \\xi)$ 在对称区间上的积分为\n$$\n\\int_{-\\delta}^{\\delta} \\exp(i k \\xi)\\,d\\xi = \\left.\\frac{\\exp(i k \\xi)}{i k}\\right|_{-\\delta}^{\\delta}\n= \\frac{\\exp(i k \\delta)-\\exp(-i k \\delta)}{i k}\n= \\frac{2\\sin(k\\delta)}{k}.\n$$\n$1$ 在同一区间上的积分为 $\\int_{-\\delta}^{\\delta} 1\\,d\\xi = 2\\delta$。因此，\n$$\n\\int_{-\\delta}^{\\delta} c\\big(\\exp(i k \\xi)-1\\big)\\,d\\xi\n= c\\left(\\frac{2\\sin(k\\delta)}{k} - 2\\delta\\right).\n$$\n色散关系变为\n$$\n-\\rho\\omega^{2} = c\\left(\\frac{2\\sin(k\\delta)}{k} - 2\\delta\\right),\n$$\n或等效地\n$$\n\\omega^{2}(k) = \\frac{2c}{\\rho}\\left(\\delta - \\frac{\\sin(k\\delta)}{k}\\right).\n$$\n这就是在具有恒定微模量和有限视域的无限长一维杆中，小振幅纵波的近场动力学色散关系的精确闭式解析表达式。\n\n为了与经典局部连续介质极限建立联系，我们使用泰勒级数对小无量纲波数 $k\\delta\\ll 1$ 的情况进行展开\n$$\n\\sin(k\\delta) = k\\delta - \\frac{(k\\delta)^{3}}{6} + \\frac{(k\\delta)^{5}}{120} - \\cdots.\n$$\n则\n$$\n\\delta - \\frac{\\sin(k\\delta)}{k}\n= \\delta - \\left(\\delta - \\frac{k^{2}\\delta^{3}}{6} + \\frac{k^{4}\\delta^{5}}{120} - \\cdots\\right)\n= \\frac{k^{2}\\delta^{3}}{6} - \\frac{k^{4}\\delta^{5}}{120} + \\cdots.\n$$\n因此，在主导阶上，\n$$\n\\omega^{2}(k) \\approx \\frac{2c}{\\rho}\\frac{k^{2}\\delta^{3}}{6}\n= \\left(\\frac{c\\delta^{3}}{3\\rho}\\right)k^{2}.\n$$\n在由 $\\rho\\ddot{u} = E\\partial^{2}u/\\partial x^{2}$ 控制的经典一维局部弹性连续介质中，平面波满足\n$$\n\\omega^{2}(k) = \\frac{E}{\\rho}k^{2}.\n$$\n匹配主导阶行为可确定，基于键的一维近场动力学模型的等效局部模量为 $E_{\\mathrm{eff}} = c\\delta^{3}/3$，等效波速的平方为 $E_{\\mathrm{eff}}/\\rho = c\\delta^{3}/(3\\rho)$。近场动力学色散关系中的高阶项引入了非局部色散，这使得在较大的 $k\\delta$ 时偏离局部理论，而小的 $k\\delta$ 极限再现了经典的线性色散 $\\omega\\propto k$。\n\n因此，所要求的精确色散关系的最终表达式为闭式形式\n$$\n\\omega^{2}(k) = \\frac{2c}{\\rho}\\left(\\delta - \\frac{\\sin(k\\delta)}{k}\\right).\n$$",
            "answer": "$$\\boxed{\\frac{2c}{\\rho}\\left(\\delta-\\frac{\\sin(k\\delta)}{k}\\right)}$$"
        },
        {
            "introduction": "为了使近场动力学模型能够准确预测真实材料的行为，必须建立其微观参数与宏观材料常数之间的联系，这个过程被称为“校准”。本练习将引导您通过能量等效原理，为一个特定的微模量函数确定其参数，从而使非局部模型在均匀变形下能够重现经典弹性理论的剪切响应 。这是将抽象的非局部模型应用于工程实践的关键一步。",
            "id": "3520735",
            "problem": "考虑一个三维空间中的均匀、微弹性、键基近场动力学固体，其有限相互作用域半径为 $\\delta$。两个材料点之间的参考键矢量为 $\\boldsymbol{\\xi}$，其长度为 $r=\\|\\boldsymbol{\\xi}\\|$。球对称的微模量（也称为核函数）由下式给出\n$$\nc(r)=\\begin{cases}\nc_0\\left(1-\\dfrac{r}{\\delta}\\right),  0\\le r\\le \\delta, \\\\\n0,  r>\\delta,\n\\end{cases}\n$$\n其中 $c_0$ 是一个待定常数。假设小变形和由无穷小应变张量 $\\boldsymbol{\\varepsilon}$ 表征的均匀变形。在键基微弹性模型中，键伸长定义为 $s=\\hat{\\boldsymbol{\\xi}}\\cdot \\boldsymbol{\\varepsilon}\\,\\hat{\\boldsymbol{\\xi}}$，其中 $\\hat{\\boldsymbol{\\xi}}=\\boldsymbol{\\xi}/\\|\\boldsymbol{\\xi}\\|$，某一点的近场动力学应变能密度为\n$$\nW_{\\mathrm{PD}}=\\dfrac{1}{4}\\int_{|\\boldsymbol{\\xi}|\\le \\delta} c(\\|\\boldsymbol{\\xi}\\|)\\,s^2\\,\\|\\boldsymbol{\\xi}\\|\\,\\mathrm{d}V',\n$$\n其中 $\\mathrm{d}V'$ 是点 $\\boldsymbol{x}'=\\boldsymbol{x}+\\boldsymbol{\\xi}$ 处的体积测度。对于 $x_1$–$x_2$ 平面内剪切参数为 $\\gamma$ 的均匀纯剪切变形，$\\boldsymbol{\\varepsilon}$ 的非零分量为 $\\varepsilon_{12}=\\varepsilon_{21}=\\gamma/2$。在经典线性弹性力学中，对于剪切模量为 $\\mu$ 的各向同性固体，这种纯剪切状态对应的应变能密度为\n$$\nW_{\\mathrm{cl}}=\\dfrac{1}{2}\\,\\mu\\,\\gamma^2.\n$$\n确定 $c_0$ 的值，将其表示为 $\\mu$ 和 $\\delta$ 的闭式解析表达式，使得对于此均匀纯剪切变形，近场动力学模型的应变能密度与经典响应一致，即 $W_{\\mathrm{PD}}=W_{\\mathrm{cl}}$。将您的最终答案表示为仅含 $\\mu$ 和 $\\delta$ 的单一解析表达式。最终表达式中不要包含单位。",
            "solution": "该问题要求为给定的近场动力学微模量函数确定常数 $c_0$。这通过将均匀纯剪切状态下的近场动力学应变能密度 $W_{\\mathrm{PD}}$ 与经典线性弹性应变能密度 $W_{\\mathrm{cl}}$ 相等来实现。此方法是一种标准的标定程序，确保非局部近场动力学模型在均匀变形下能够再现经典局部模型的行为。\n\n承受剪切参数为 $\\gamma$ 的纯剪切的各向同性固体的经典应变能密度由下式给出：\n$$\nW_{\\mathrm{cl}} = \\frac{1}{2} \\mu \\gamma^2\n$$\n其中 $\\mu$ 是剪切模量。\n\n近场动力学应变能密度由下列表达式给出：\n$$\nW_{\\mathrm{PD}} = \\frac{1}{4} \\int_{|\\boldsymbol{\\xi}| \\le \\delta} c(\\|\\boldsymbol{\\xi}\\|) s^2 \\|\\boldsymbol{\\xi}\\| \\, \\mathrm{d}V'\n$$\n我们必须首先为指定的变形计算键伸长 $s$。对于 $x_1$-$x_2$ 平面内的纯剪切，应变张量 $\\boldsymbol{\\varepsilon}$ 的非零分量为 $\\varepsilon_{12} = \\varepsilon_{21} = \\gamma/2$。所有其他分量均为零。键伸长 $s$ 定义为 $s = \\hat{\\boldsymbol{\\xi}} \\cdot \\boldsymbol{\\varepsilon} \\hat{\\boldsymbol{\\xi}}$，其中 $\\hat{\\boldsymbol{\\xi}} = \\boldsymbol{\\xi} / \\|\\boldsymbol{\\xi}\\| = (\\hat{\\xi}_1, \\hat{\\xi}_2, \\hat{\\xi}_3)^T$ 是沿键方向的单位矢量。\n\n我们来计算乘积 $\\boldsymbol{\\varepsilon} \\hat{\\boldsymbol{\\xi}}$：\n$$\n\\boldsymbol{\\varepsilon} \\hat{\\boldsymbol{\\xi}} = \\begin{pmatrix} 0  \\gamma/2  0 \\\\ \\gamma/2  0  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} \\hat{\\xi}_1 \\\\ \\hat{\\xi}_2 \\\\ \\hat{\\xi}_3 \\end{pmatrix} = \\begin{pmatrix} (\\gamma/2)\\hat{\\xi}_2 \\\\ (\\gamma/2)\\hat{\\xi}_1 \\\\ 0 \\end{pmatrix}\n$$\n现在，我们计算点积 $\\hat{\\boldsymbol{\\xi}} \\cdot (\\boldsymbol{\\varepsilon} \\hat{\\boldsymbol{\\xi}})$：\n$$\ns = \\hat{\\xi}_1 \\left(\\frac{\\gamma}{2}\\hat{\\xi}_2\\right) + \\hat{\\xi}_2 \\left(\\frac{\\gamma}{2}\\hat{\\xi}_1\\right) + \\hat{\\xi}_3(0) = \\gamma \\hat{\\xi}_1 \\hat{\\xi}_2\n$$\n因此，键伸长的平方为：\n$$\ns^2 = \\gamma^2 \\hat{\\xi}_1^2 \\hat{\\xi}_2^2\n$$\n现在我们将此结果和给定的微模量函数 $c(r)=c_0(1-r/\\delta)$ 代入 $W_{\\mathrm{PD}}$ 的表达式中。令 $r = \\|\\boldsymbol{\\xi}\\|$。积分是在一个半径为 $\\delta$ 的球体上进行的。\n$$\nW_{\\mathrm{PD}} = \\frac{1}{4} \\int_{|\\boldsymbol{\\xi}| \\le \\delta} c_0 \\left(1-\\frac{r}{\\delta}\\right) (\\gamma^2 \\hat{\\xi}_1^2 \\hat{\\xi}_2^2) r \\, \\mathrm{d}V'\n$$\n为了计算这个积分，我们转换到球坐标系。令 $\\boldsymbol{\\xi} = (r\\sin\\theta\\cos\\phi, r\\sin\\theta\\sin\\phi, r\\cos\\theta)$。单位矢量分量为 $\\hat{\\xi}_1 = \\sin\\theta\\cos\\phi$，$\\hat{\\xi}_2 = \\sin\\theta\\sin\\phi$，以及 $\\hat{\\xi}_3 = \\cos\\theta$。体积元为 $\\mathrm{d}V' = r^2 \\sin\\theta \\, \\mathrm{d}r \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$。积分限为 $r \\in [0, \\delta]$，$\\theta \\in [0, \\pi]$，以及 $\\phi \\in [0, 2\\pi]$。\n\n将这些代入 $W_{\\mathrm{PD}}$ 的积分中：\n$$\nW_{\\mathrm{PD}} = \\frac{1}{4} \\int_0^{2\\pi} \\int_0^{\\pi} \\int_0^{\\delta} c_0 \\left(1-\\frac{r}{\\delta}\\right) \\gamma^2 (\\sin\\theta\\cos\\phi)^2 (\\sin\\theta\\sin\\phi)^2 r (r^2 \\sin\\theta) \\, \\mathrm{d}r \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\n我们可以提出常数并将积分分离为径向和角向部分：\n$$\nW_{\\mathrm{PD}} = \\frac{c_0 \\gamma^2}{4} \\left[ \\int_0^{\\delta} r^3 \\left(1-\\frac{r}{\\delta}\\right) \\mathrm{d}r \\right] \\left[ \\int_0^{\\pi} \\sin^5\\theta \\, \\mathrm{d}\\theta \\right] \\left[ \\int_0^{2\\pi} \\cos^2\\phi \\sin^2\\phi \\, \\mathrm{d}\\phi \\right]\n$$\n我们来分别计算每个积分。\n\n径向积分 $I_r$：\n$$\nI_r = \\int_0^{\\delta} \\left(r^3 - \\frac{r^4}{\\delta}\\right) \\mathrm{d}r = \\left[ \\frac{r^4}{4} - \\frac{r^5}{5\\delta} \\right]_0^{\\delta} = \\frac{\\delta^4}{4} - \\frac{\\delta^5}{5\\delta} = \\frac{\\delta^4}{4} - \\frac{\\delta^4}{5} = \\frac{\\delta^4}{20}\n$$\n极角积分 $I_\\theta$：\n$$\nI_\\theta = \\int_0^{\\pi} \\sin^5\\theta \\, \\mathrm{d}\\theta = \\int_0^{\\pi} (\\sin^2\\theta)^2 \\sin\\theta \\, \\mathrm{d}\\theta = \\int_0^{\\pi} (1-\\cos^2\\theta)^2 \\sin\\theta \\, \\mathrm{d}\\theta\n$$\n使用换元法，$u = \\cos\\theta$，$\\mathrm{d}u = -\\sin\\theta \\, \\mathrm{d}\\theta$：\n$$\nI_\\theta = \\int_{1}^{-1} (1-u^2)^2 (-\\mathrm{d}u) = \\int_{-1}^{1} (1 - 2u^2 + u^4) \\mathrm{d}u = \\left[ u - \\frac{2u^3}{3} + \\frac{u^5}{5} \\right]_{-1}^{1} = 2 \\left(1 - \\frac{2}{3} + \\frac{1}{5}\\right) = 2 \\left(\\frac{15-10+3}{15}\\right) = \\frac{16}{15}\n$$\n方位角积分 $I_\\phi$：\n$$\nI_\\phi = \\int_0^{2\\pi} \\cos^2\\phi \\sin^2\\phi \\, \\mathrm{d}\\phi = \\int_0^{2\\pi} \\left(\\frac{\\sin(2\\phi)}{2}\\right)^2 \\mathrm{d}\\phi = \\frac{1}{4} \\int_0^{2\\pi} \\sin^2(2\\phi) \\, \\mathrm{d}\\phi\n$$\n使用恒等式 $\\sin^2(x) = \\frac{1 - \\cos(2x)}{2}$：\n$$\nI_\\phi = \\frac{1}{4} \\int_0^{2\\pi} \\frac{1 - \\cos(4\\phi)}{2} \\mathrm{d}\\phi = \\frac{1}{8} \\left[ \\phi - \\frac{\\sin(4\\phi)}{4} \\right]_0^{2\\pi} = \\frac{1}{8} (2\\pi) = \\frac{\\pi}{4}\n$$\n现在，我们组合 $W_{\\mathrm{PD}}$ 的表达式：\n$$\nW_{\\mathrm{PD}} = \\frac{c_0 \\gamma^2}{4} \\cdot I_r \\cdot I_\\theta \\cdot I_\\phi = \\frac{c_0 \\gamma^2}{4} \\left(\\frac{\\delta^4}{20}\\right) \\left(\\frac{16}{15}\\right) \\left(\\frac{\\pi}{4}\\right)\n$$\n$$\nW_{\\mathrm{PD}} = c_0 \\gamma^2 \\frac{16 \\pi \\delta^4}{4 \\cdot 20 \\cdot 15 \\cdot 4} = c_0 \\gamma^2 \\frac{16 \\pi \\delta^4}{4800} = c_0 \\gamma^2 \\frac{\\pi \\delta^4}{300}\n$$\n为了求出 $c_0$，我们令近场动力学和经典应变能密度相等，$W_{\\mathrm{PD}} = W_{\\mathrm{cl}}$：\n$$\nc_0 \\gamma^2 \\frac{\\pi \\delta^4}{300} = \\frac{1}{2} \\mu \\gamma^2\n$$\n由于等价关系必须对任意小的剪切都成立，$\\gamma^2$ 项从两边消去：\n$$\nc_0 \\frac{\\pi \\delta^4}{300} = \\frac{\\mu}{2}\n$$\n最后，我们解出 $c_0$：\n$$\nc_0 = \\frac{\\mu}{2} \\frac{300}{\\pi \\delta^4} = \\frac{150 \\mu}{\\pi \\delta^4}\n$$\n这就是所求的用剪切模量 $\\mu$ 和作用域半径 $\\delta$ 表示的 $c_0$ 的表达式。",
            "answer": "$$\\boxed{\\frac{150 \\mu}{\\pi \\delta^4}}$$"
        },
        {
            "introduction": "从理论到实践，计算实现是检验和应用非局部理论的核心环节。在基于“态”的近场动力学中，非局部变形梯度是一个核心概念，它将离散粒子的位移信息转化为连续的变形度量。本练习要求您从加权最小二乘法的基本原理出发，推导并实现非局部变形梯度的数值估计算法，为您提供将积分形式的理论转化为实用代码的宝贵经验 。",
            "id": "3520731",
            "problem": "要求您设计并实现一个程序，用于计算在受扰动的粒子集上采样的预设仿射位移场下，近场动力学和非局部连续介质理论意义上的非局部变形梯度，并量化由此产生的近似误差。该程序必须从第一性原理出发实现估计器，即作为一个线性映射对有限邻域（horizon）内相对变形的加权最小二乘最佳拟合。答案必须是可复现的，且不得需要任何外部输入。\n\n基本原理。从以下普遍接受的原则开始：\n- 物质点的变形映射在局部由一个仿射映射近似。给定一个正在运动的物体，设一个最初位于位置 $\\mathbf{x} \\in \\mathbb{R}^{2}$ 的物质点被映射到 $\\mathbf{y}(\\mathbf{x}) \\in \\mathbb{R}^{2}$。对于足够平滑的运动，在 $\\mathbf{x}_{0}$ 邻域内的最佳线性近似由变形梯度 $\\mathbf{F}(\\mathbf{x}_{0})$ 编码，在经典局部理论中其定义为 $\\mathbf{F}(\\mathbf{x}_{0}) = \\nabla \\mathbf{y}(\\mathbf{x}_{0})$。\n- 在非局部设定中，一个最佳拟合线性映射可以被确定为在有限 horizon 内一个加权最小二乘泛函的最小化子。具体来说，对于一个给定的具有紧支集或快速衰减支集的对称非负权重（核函数）$\\omega(r)$ 和一个 horizon 半径 $\\delta$，定义相对向量 $\\boldsymbol{\\xi} = \\mathbf{x} - \\mathbf{x}_{0}$ 和 $\\boldsymbol{\\eta} = \\mathbf{y}(\\mathbf{x}) - \\mathbf{y}(\\mathbf{x}_{0})$。考虑泛函\n$$\n\\mathcal{J}(\\mathbf{F}) = \\int_{\\|\\boldsymbol{\\xi}\\| \\le \\delta} \\omega\\!\\left(\\|\\boldsymbol{\\xi}\\|\\right)\\,\\left\\| \\mathbf{F}\\,\\boldsymbol{\\xi} - \\boldsymbol{\\eta} \\right\\|^{2}\\,\\mathrm{d}V,\n$$\n其最小化子提供了变形梯度的一个非局部估计 $\\widehat{\\mathbf{F}}(\\mathbf{x}_{0})$。该估计器基于线性回归和加权最小二乘（LS）的成熟关系。\n- 仿射位移场 $\\mathbf{u}(\\mathbf{x})$ 被规定为 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{A}\\,\\mathbf{x} + \\mathbf{b}$，其中 $\\mathbf{A} \\in \\mathbb{R}^{2 \\times 2}$ 为常数矩阵，$\\mathbf{b} \\in \\mathbb{R}^{2}$ 为常数向量。则运动为 $\\mathbf{y}(\\mathbf{x}) = \\mathbf{x} + \\mathbf{u}(\\mathbf{x}) = (\\mathbf{I} + \\mathbf{A})\\,\\mathbf{x} + \\mathbf{b}$，其中 $\\mathbf{I}$ 是单位矩阵。精确的变形梯度为 $\\mathbf{F}_{\\mathrm{exact}} = \\mathbf{I} + \\mathbf{A}$。\n- 积分的粒子离散化是在一个半边长为 $L$ 的正方形域内，在一个间距为 $h$ 的名义方形晶格上进行的，每个晶格点在每个坐标上都独立地受到均值为零、标准差为 $p\\,h$ 的独立高斯噪声的扰动。每个粒子被赋予相等的体积 $h^{2}$。\n\n任务。\n- 从泛函 $\\mathcal{J}(\\mathbf{F})$ 的一阶变分推导出非局部变形梯度估计器 $\\widehat{\\mathbf{F}}(\\mathbf{x}_{0})$ 的离散公式，用 horizon $\\delta$ 内邻居的加权和表示。您必须只使用上述原则；不要使用任何超出最小二乘最小化和基本微积分范畴的专门公式。\n- 实现一个程序，该程序：\n  - 在正方形域 $\\{ \\mathbf{x} \\in \\mathbb{R}^{2} : -L \\le x_{1} \\le L,\\,-L \\le x_{2} \\le L \\}$ 上以晶格间距 $h$ 生成粒子集，然后添加标准差为 $p\\,h$ 的高斯扰动。对每个测试用例使用一个带有固定种子的伪随机数生成器，以确保可复现性，具体如下所述。\n  - 在评估点 $\\mathbf{x}_{0}$，收集所有满足 $0  \\|\\boldsymbol{\\xi}\\| \\le \\delta$ 的邻居，其中 $\\boldsymbol{\\xi} = \\mathbf{x} - \\mathbf{x}_{0}$。\n  - 使用高斯核函数 $\\omega(r) = \\exp\\!\\left( - (r/\\delta)^{2} \\right)$。\n  - 使用您推导出的离散加权最小二乘估计器来计算 $\\widehat{\\mathbf{F}}(\\mathbf{x}_{0})$。如果离散法向矩阵是病态的或奇异的，使用 Tikhonov 正则化 $\\lambda\\mathbf{I}$，其中 $\\lambda > 0$ 应选择一个小的且量纲一致的值；报告您为 $\\lambda$ 选择的值及其原因，并一致地实现它。\n  - 计算相对 Frobenius 范数误差\n  $$\n  e = \\frac{\\left\\| \\widehat{\\mathbf{F}}(\\mathbf{x}_{0}) - \\mathbf{F}_{\\mathrm{exact}} \\right\\|_{F}}{\\left\\| \\mathbf{F}_{\\mathrm{exact}} \\right\\|_{F}}。\n  $$\n- 对于每个测试用例，输出必须是一个等于误差 $e$ 的浮点数，四舍五入到八位小数。\n\n测试套件。您的程序必须评估以下五个测试用例，并按照下面指定的格式将所有五个结果输出到一行。在所有情况下，单位纯粹是数学上的，无量纲。角度单位不适用。对于每个用例，列出 $(\\mathbf{A},\\mathbf{b},L,h,\\delta,p,\\mathbf{x}_{0},\\text{seed})$：\n- 用例 1：$\\mathbf{A} = \\begin{bmatrix} 0.1  0.2 \\\\ -0.05  0.15 \\end{bmatrix}$, $\\mathbf{b} = \\begin{bmatrix} 0.01 \\\\ -0.02 \\end{bmatrix}$, $L = 0.5$, $h = 0.05$, $\\delta = 0.2$, $p = 0.0$, $\\mathbf{x}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$, seed $= 1$。\n- 用例 2：与用例 1 相同的 $\\mathbf{A}$ 和 $\\mathbf{b}$，$L = 0.5$, $h = 0.05$, $\\delta = 0.2$, $p = 0.1$, $\\mathbf{x}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$, seed $= 2$。\n- 用例 3：与用例 1 相同的 $\\mathbf{A}$ 和 $\\mathbf{b}$，$L = 0.5$, $h = 0.05$, $\\delta = 0.12$, $p = 0.25$, $\\mathbf{x}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$, seed $= 3$。\n- 用例 4：$\\mathbf{A} = \\begin{bmatrix} 0.05  -0.3 \\\\ 0.3  -0.02 \\end{bmatrix}$, $\\mathbf{b} = \\begin{bmatrix} 0.03 \\\\ 0.02 \\end{bmatrix}$, $L = 0.5$, $h = 0.04$, $\\delta = 0.18$, $p = 0.15$, $\\mathbf{x}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$, seed $= 4$。\n- 用例 5：$\\mathbf{A} = \\begin{bmatrix} 0.12  0.0 \\\\ 0.0  -0.08 \\end{bmatrix}$, $\\mathbf{b} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$, $L = 0.4$, $h = 0.04$, $\\delta = 0.2$, $p = 0.05$, $\\mathbf{x}_{0} = \\begin{bmatrix} 0.35 \\\\ 0.0 \\end{bmatrix}$, seed $= 5$。\n\n最终输出格式。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，按用例 1 到 5 的顺序排列。每个误差必须以标准十进制表示法精确到小数点后八位。例如，三个假设结果的输出将写为 $[\\;0.00012345,0.00123456,0.01234567\\;]$。\n\n注意和约束。\n- 您不得使用任何外部输入。所有参数都嵌入在程序中。\n- 如果在任何测试用例中，horizon $\\delta$ 内没有邻居，则返回编程语言定义的“非数值”（Not-a-Number）。然而，根据以上参数，这种情况不应发生。\n- 在您的解决方案解释中报告并证明正则化参数 $\\lambda$ 的选择。实现的程序必须使用相同的选择。",
            "solution": "### 推导与算法设计\n\n非局部变形梯度 $\\widehat{\\mathbf{F}}$ 被定义为以下泛函的最小化子：\n$$\n\\mathcal{J}(\\mathbf{F}) = \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) \\left\\| \\mathbf{F}\\,\\boldsymbol{\\xi} - \\boldsymbol{\\eta} \\right\\|^{2}\\,\\mathrm{d}V\n$$\n其中 $\\mathcal{H}$ 是由 $\\|\\boldsymbol{\\xi}\\| \\le \\delta$ 定义的 $\\mathbf{x}_0$ 的邻域。达到最小值的必要条件是 $\\mathcal{J}$ 关于 $\\mathbf{F}$ 的一阶变分为零。范数内的项是一个向量，因此其范数的平方是 $(\\mathbf{F}\\boldsymbol{\\xi} - \\boldsymbol{\\eta}) \\cdot (\\mathbf{F}\\boldsymbol{\\xi} - \\boldsymbol{\\eta})$。这个范数平方关于张量 $\\mathbf{F}$ 的梯度是 $2(\\mathbf{F}\\boldsymbol{\\xi}-\\boldsymbol{\\eta})\\boldsymbol{\\xi}^T$。因此，将整个泛函的梯度设置为零张量，得到欧拉-拉格朗日方程：\n$$\n\\nabla_{\\mathbf{F}}\\mathcal{J} = \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) \\cdot 2 (\\widehat{\\mathbf{F}}\\boldsymbol{\\xi}-\\boldsymbol{\\eta})\\boldsymbol{\\xi}^T \\,\\mathrm{d}V = \\mathbf{0}\n$$\n展开各项并为 $\\widehat{\\mathbf{F}}$ 重新整理，得到法方程：\n$$\n\\widehat{\\mathbf{F}} \\left( \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) (\\boldsymbol{\\xi} \\otimes \\boldsymbol{\\xi}) \\,\\mathrm{d}V \\right) = \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) (\\boldsymbol{\\eta} \\otimes \\boldsymbol{\\xi}) \\,\\mathrm{d}V\n$$\n其中 $\\otimes$ 表示张量积（或对应列向量的外积）。我们定义形状张量 $\\mathbf{K}$ 和混合二元张量 $\\mathbf{M}$ 如下：\n$$\n\\mathbf{K} = \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) (\\boldsymbol{\\xi} \\otimes \\boldsymbol{\\xi}) \\,\\mathrm{d}V \\quad \\text{和} \\quad \\mathbf{M} = \\int_{\\mathcal{H}} \\omega(\\|\\boldsymbol{\\xi}\\|) (\\boldsymbol{\\eta} \\otimes \\boldsymbol{\\xi}) \\,\\mathrm{d}V\n$$\n法方程即为 $\\widehat{\\mathbf{F}} \\mathbf{K} = \\mathbf{M}$。如果 $\\mathbf{K}$ 是可逆的，则解为 $\\widehat{\\mathbf{F}} = \\mathbf{M} \\mathbf{K}^{-1}$。\n\n对于离散粒子系统，积分被替换为对评估点 $\\mathbf{x}_{0}$ 的 horizon $\\delta$ 内的邻居粒子 $j$ 的求和。每个粒子 $j$ 都有一个关联的体积（在二维中为面积）$V_j = h^2$。$\\mathbf{K}$ 和 $\\mathbf{M}$ 的离散形式是：\n$$\n\\mathbf{K} = \\sum_{j \\in \\mathcal{H}_{0}} \\omega(\\|\\boldsymbol{\\xi}_j\\|) (\\boldsymbol{\\xi}_j \\otimes \\boldsymbol{\\xi}_j) V_j \\quad \\text{和} \\quad \\mathbf{M} = \\sum_{j \\in \\mathcal{H}_{0}} \\omega(\\|\\boldsymbol{\\xi}_j\\|) (\\boldsymbol{\\eta}_j \\otimes \\boldsymbol{\\xi}_j) V_j\n$$\n其中 $\\boldsymbol{\\xi}_j = \\mathbf{x}_j - \\mathbf{x}_0$ 且 $\\boldsymbol{\\eta}_j = \\mathbf{y}(\\mathbf{x}_j) - \\mathbf{y}(\\mathbf{x}_0)$。求和是对邻居集合 $\\mathcal{H}_0 = \\{j \\mid 0  \\|\\mathbf{x}_j - \\mathbf{x}_0\\| \\le \\delta\\}$ 进行的。\n\n如果邻居粒子 $\\mathbf{x}_j$ 分布不佳（例如，共线或几乎共线），形状张量 $\\mathbf{K}$ 可能是奇异的或病态的。为确保解的稳定性，应用 Tikhonov 正则化，通过向 $\\mathbf{K}$ 添加一个小的项 $\\lambda \\mathbf{I}$，其中 $\\mathbf{I}$ 是单位张量。正则化后的系统是 $\\widehat{\\mathbf{F}} (\\mathbf{K} + \\lambda \\mathbf{I}) = \\mathbf{M}$，得到解：\n$$\n\\widehat{\\mathbf{F}} = \\mathbf{M} (\\mathbf{K} + \\lambda \\mathbf{I})^{-1}\n$$\n正则化参数 $\\lambda$ 必须与 $\\mathbf{K}$ 的条目在量纲上保持一致，在此二维分析中其单位为 $[L]^4$（来自 $\\boldsymbol{\\xi}\\boldsymbol{\\xi}^T$ 的 $[L]^2$ 和 $V_j$ 的 $[L]^2$）。一个稳健的 $\\lambda$ 选择是使其与 $\\mathbf{K}$ 对角线条目的平均量级成比例。我们选择 $\\lambda = \\epsilon_{reg} \\cdot \\frac{1}{2}\\mathrm{tr}(\\mathbf{K})$，其中 $\\epsilon_{reg} = 10^{-9}$ 是一个小的无量纲常数。这确保了正则化能够根据问题的特性（粒子间距和 horizon 大小）进行适当缩放，同时又足够小，不会对解产生过度偏倚。\n\n对于规定的仿射运动 $\\mathbf{y}(\\mathbf{x}) = (\\mathbf{I}+\\mathbf{A})\\mathbf{x} + \\mathbf{b} = \\mathbf{F}_{\\mathrm{exact}}\\mathbf{x} + \\mathbf{b}$，相对位移向量 $\\boldsymbol{\\eta}_j$ 是：\n$$\n\\boldsymbol{\\eta}_j = \\mathbf{y}(\\mathbf{x}_j) - \\mathbf{y}(\\mathbf{x}_0) = (\\mathbf{F}_{\\mathrm{exact}}\\mathbf{x}_j + \\mathbf{b}) - (\\mathbf{F}_{\\mathrm{exact}}\\mathbf{x}_0 + \\mathbf{b}) = \\mathbf{F}_{\\mathrm{exact}}(\\mathbf{x}_j - \\mathbf{x}_0) = \\mathbf{F}_{\\mathrm{exact}}\\boldsymbol{\\xi}_j\n$$\n将此代入 $\\mathbf{M}$ 的表达式中：\n$$\n\\mathbf{M} = \\sum_{j \\in \\mathcal{H}_{0}} \\omega_j (\\mathbf{F}_{\\mathrm{exact}}\\boldsymbol{\\xi}_j \\otimes \\boldsymbol{\\xi}_j) V_j = \\mathbf{F}_{\\mathrm{exact}} \\left( \\sum_{j \\in \\mathcal{H}_{0}} \\omega_j (\\boldsymbol{\\xi}_j \\otimes \\boldsymbol{\\xi}_j) V_j \\right) = \\mathbf{F}_{\\mathrm{exact}}\\mathbf{K}\n$$\n因此，在没有数值误差的情况下，估计器应该能精确地恢复变形梯度：$\\widehat{\\mathbf{F}} = (\\mathbf{F}_{\\mathrm{exact}}\\mathbf{K})\\mathbf{K}^{-1} = \\mathbf{F}_{\\mathrm{exact}}$。这个性质无论粒子位置如何（规则或受扰动）都成立。因此，计算出的误差 $e$ 将仅因浮点运算限制而非零，其大小将反映实现在不同粒子无序程度和邻域大小下的数值稳定性。\n\n算法流程如下：\n1.  对于每个测试用例，使用指定的参数和随机种子生成受扰动的粒子位置 $\\mathbf{x}_j$。\n2.  在评估点 $\\mathbf{x}_0$，识别 horizon $\\delta$ 内的所有邻居粒子。\n3.  通过对已识别的邻居求和，计算离散的形状张量 $\\mathbf{K}$ 和混合张量 $\\mathbf{M}$。\n4.  从 $\\mathbf{K}$ 的迹计算正则化参数 $\\lambda$。\n5.  求解正则化线性系统以得到估计的变形梯度 $\\widehat{\\mathbf{F}} = \\mathbf{M} (\\mathbf{K} + \\lambda \\mathbf{I})^{-1}$。\n6.  计算精确的变形梯度 $\\mathbf{F}_{\\mathrm{exact}} = \\mathbf{I} + \\mathbf{A}$。\n7.  使用 Frobenius 范数计算相对误差 $e$，并将其附加到结果列表中。\n8.  按规定格式化最终的误差列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: (A, b, L, h, delta, p, x0, seed) - No perturbation\n        {'A': np.array([[0.1, 0.2], [-0.05, 0.15]]), 'b': np.array([0.01, -0.02]),\n         'L': 0.5, 'h': 0.05, 'delta': 0.2, 'p': 0.0, 'x0': np.array([0.0, 0.0]), 'seed': 1},\n        # Case 2: Same as Case 1, but with perturbation\n        {'A': np.array([[0.1, 0.2], [-0.05, 0.15]]), 'b': np.array([0.01, -0.02]),\n         'L': 0.5, 'h': 0.05, 'delta': 0.2, 'p': 0.1, 'x0': np.array([0.0, 0.0]), 'seed': 2},\n        # Case 3: Smaller horizon, larger perturbation\n        {'A': np.array([[0.1, 0.2], [-0.05, 0.15]]), 'b': np.array([0.01, -0.02]),\n         'L': 0.5, 'h': 0.05, 'delta': 0.12, 'p': 0.25, 'x0': np.array([0.0, 0.0]), 'seed': 3},\n        # Case 4: Different material parameters and discretization\n        {'A': np.array([[0.05, -0.3], [0.3, -0.02]]), 'b': np.array([0.03, 0.02]),\n         'L': 0.5, 'h': 0.04, 'delta': 0.18, 'p': 0.15, 'x0': np.array([0.0, 0.0]), 'seed': 4},\n        # Case 5: Different material parameters, off-center evaluation point\n        {'A': np.array([[0.12, 0.0], [0.0, -0.08]]), 'b': np.array([0.0, 0.0]),\n         'L': 0.4, 'h': 0.04, 'delta': 0.2, 'p': 0.05, 'x0': np.array([0.35, 0.0]), 'seed': 5},\n    ]\n\n    results = []\n    for params in test_cases:\n        error = calculate_error_for_case(params)\n        results.append(f\"{error:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_error_for_case(params):\n    \"\"\"\n    Calculates the relative Frobenius norm error for a single test case.\n    \"\"\"\n    # Unpack parameters\n    A = params['A']\n    b = params['b']\n    L = params['L']\n    h = params['h']\n    delta = params['delta']\n    p = params['p']\n    x0 = params['x0']\n    seed = params['seed']\n    \n    # Initialize a pseudo-random number generator with a fixed seed for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # 1. Generate the particle set\n    # Create the nominal square lattice, ensuring endpoints are included.\n    grid_coords = np.arange(-L, L + h / 2, h)\n    xx, yy = np.meshgrid(grid_coords, grid_coords)\n    x_nominal = np.vstack([xx.ravel(), yy.ravel()]).T\n\n    # Add independent Gaussian perturbations to each coordinate.\n    perturbations = rng.normal(loc=0.0, scale=p * h, size=x_nominal.shape)\n    x_perturbed = x_nominal + perturbations\n    \n    # Each particle is assigned an equal volume V_p = h^2.\n    V_p = h**2\n\n    # 2. Identify neighbors of the evaluation point x0\n    neighbor_positions = []\n    for x_j in x_perturbed:\n        xi = x_j - x0\n        dist = np.linalg.norm(xi)\n        # Condition for neighbors: 0  ||xi|| = delta\n        if 0.0  dist = delta:\n            neighbor_positions.append(x_j)\n            \n    if not neighbor_positions:\n        return np.nan\n\n    neighbors = np.array(neighbor_positions)\n\n    # 3. Compute the discrete K (shape) and M (mixed) tensors.\n    K = np.zeros((2, 2))\n    M = np.zeros((2, 2))\n\n    # Define the affine motion for the evaluation point x0.\n    I = np.eye(2)\n    F_exact = I + A\n    y0 = F_exact @ x0 + b\n\n    # Gaussian weight kernel function.\n    def omega(r, delta_):\n        return np.exp(-(r / delta_)**2)\n\n    for x_j in neighbors:\n        # Relative position vector.\n        xi = x_j - x0\n        r = np.linalg.norm(xi)\n        w = omega(r, delta)\n\n        # Compute relative displacement vector eta.\n        y_j = F_exact @ x_j + b\n        eta = y_j - y0\n        \n        # Reshape for outer products.\n        xi_col = xi.reshape(2, 1)\n        eta_col = eta.reshape(2, 1)\n        \n        # Accumulate sums for K and M.\n        K += w * (xi_col @ xi_col.T) * V_p\n        M += w * (eta_col @ xi_col.T) * V_p\n        \n    # 4. Apply Tikhonov regularization and solve for the estimated deformation gradient F_hat.\n    # The regularization parameter lambda is chosen to be a small fraction of the\n    # average of the diagonal elements of K to ensure dimensional consistency and stability.\n    trace_K = np.trace(K)\n    epsilon_reg = 1e-9\n    lambda_reg = epsilon_reg * 0.5 * trace_K\n    \n    # Regularize the shape tensor K.\n    K_reg = K + lambda_reg * np.eye(2)\n    \n    # Solve for F_hat from F_hat * K_reg = M.\n    try:\n        F_hat = M @ np.linalg.inv(K_reg)\n    except np.linalg.LinAlgError:\n        # This is unlikely with regularization but is handled as a precaution.\n        return np.nan\n        \n    # 5. Compute the relative Frobenius norm error.\n    error = np.linalg.norm(F_hat - F_exact, 'fro') / np.linalg.norm(F_exact, 'fro')\n    \n    return error\n\n# Execute the solution process.\nsolve()\n```"
        }
    ]
}