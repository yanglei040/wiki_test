{
    "hands_on_practices": [
        {
            "introduction": "这项实践探讨了稳定化数值格式的基础概念——人工扩散。通过分析一个对流扩散方程的中心差分格式，您将推导为满足离散极值原理（一个防止非物理振荡的关键条件）所需的最小人工扩散量。该练习还要求您量化由该稳定化方法引入的主导阶误差，从而突显了在保证稳定性与维持精度之间的根本性权衡 。",
            "id": "3526604",
            "problem": "考虑一个多物理场耦合模拟中输运量的标量、稳态、一维平流扩散模型，该模型在一个均匀网格上由偏微分方程 $a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$ 控制，其中平流速度 $a \\in \\mathbb{R}$ 为常数，分子扩散系数 $\\kappa \\ge 0$，源项 $s(x)$ 为光滑函数。假设区域以均匀的网格间距 $h>0$ 进行离散化。对内部节点的一阶和二阶导数均使用中心有限差分近似，并通过人工扩散 $\\nu \\ge 0$ 来增强分子扩散，作用于节点值 $\\{u_{i}\\}$ 的离散算子通过将 $\\frac{d u}{d x}$ 替换为 $(u_{i+1}-u_{i-1})/(2h)$，将 $\\frac{d^{2} u}{d x^{2}}$ 替换为 $(u_{i+1}-2u_{i}+u_{i-1})/h^{2}$ 来得到，但在离散扩散项中使用总扩散 $\\kappa+\\nu$。\n\n从通用内部节点周围的泰勒级数截断误差展开出发，构建此离散格式的修正方程，并引用线性标量问题的标准离散极值原理（即系数矩阵为M矩阵，其内部节点的非对角元素非正，行和非负），推导：\n\n1. 为使中心差分格式对所有内部节点满足离散极值原理所需的最小人工扩散 $\\nu_{\\min}$，用 $a$、$\\kappa$ 和 $h$ 表示。\n\n2. 在修正方程中，由该稳定化方法引入的主阶误差项，表示为乘以 $\\frac{d^{2} u}{d x^{2}}$ 的单个系数 $C_{\\text{lead}}$。\n\n以包含 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$ 封闭形式的行矩阵形式提供您的最终答案。无需进行数值计算。如果引入任何中间符号，请在最终表达式中将其消去。最终答案中不要包含物理单位。不要做任何取舍；需要精确表达式。",
            "solution": "用户要求我分析一维稳态平流扩散方程的有限差分格式。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **控制方程**：$a \\, \\frac{d u}{d x} - \\kappa \\, \\frac{d^{2} u}{d x^{2}} = s(x)$\n-   **参数**：恒定平流速度 $a \\in \\mathbb{R}$，分子扩散系数 $\\kappa \\ge 0$，均匀网格间距 $h > 0$。\n-   **离散格式**：\n    -   $\\frac{d u}{d x}$ 项由中心差分 $\\frac{u_{i+1}-u_{i-1}}{2h}$ 近似。\n    -   $\\frac{d^{2} u}{d x^{2}}$ 项由中心差分 $\\frac{u_{i+1}-2u_{i}+u_{i-1}}{h^{2}}$ 近似。\n    -   分子扩散系数 $\\kappa$ 通过人工扩散 $\\nu \\ge 0$ 进行增强，导致离散扩散项中的总扩散为 $\\kappa+\\nu$。\n-   **条件**：离散格式必须满足离散极值原理 (DMP)。这被表述为等同于系数矩阵是M矩阵，要求内部节点的非对角元素非正，行和非负。\n-   **任务**：\n    1.  推导满足 DMP 所需的最小人工扩散 $\\nu_{\\min}$。\n    2.  推导稳定格式修正方程中与 $\\frac{d^{2} u}{d x^{2}}$ 成比例的主阶误差项系数 $C_{\\text{lead}}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学基础**：该问题是偏微分方程数值分析中的一个经典练习，特别是在计算流体力学领域。平流扩散方程、有限差分法、人工扩散、离散极值原理、M矩阵和修正方程分析都是标准的、成熟的概念。该问题在数学和计算科学方面有坚实的基础。\n-   **适定性**：该问题是适定的。它提供了一套明确的规则和一个具体的数学结构，从中可以推导出两个特定的量 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$。求解路径是唯一的且无歧义的。\n-   **客观性**：该问题以精确、客观的数学语言陈述。没有主观或基于意见的成分。\n\n**步骤 3：结论和行动**\n问题是有效的。它在科学上是合理的、适定的和客观的。我将继续进行求解。\n\n### 推导过程\n\n按要求，分析分两部分进行：首先，推导最小人工扩散 $\\nu_{\\min}$；其次，推导主阶误差系数 $C_{\\text{lead}}$。\n\n#### 第 1 部分：最小人工扩散 ($\\nu_{\\min}$) 的推导\n\n首先，我们在内部网格节点 $x_i$ 处构建离散方程。给定的偏微分方程是：\n$$a \\frac{d u}{d x} - \\kappa \\frac{d^{2} u}{d x^{2}} = s(x)$$\n应用指定的有限差分近似，并使用总扩散 $\\kappa + \\nu$，我们得到节点值 $u_i = u(x_i)$ 的离散方程：\n$$a \\left( \\frac{u_{i+1} - u_{i-1}}{2h} \\right) - (\\kappa + \\nu) \\left( \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} \\right) = s_i$$\n其中 $s_i = s(x_i)$。为了分析系数矩阵的性质，我们重新整理此方程，按 $u_{i-1}$、$u_i$ 和 $u_{i+1}$ 对各项进行分组：\n$$\\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i-1} + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) u_i + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) u_{i+1} = s_i$$\n这是一个形如 $A_{i,i-1}u_{i-1} + A_{i,i}u_i + A_{i,i+1}u_{i+1} = s_i$ 的方程，其中对应于节点 $i$ 的矩阵行的系数为：\n-   $u_{i-1}$ 的非对角系数：$A_{i,i-1} = -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n-   $u_{i}$ 的对角系数：$A_{i,i} = \\frac{2(\\kappa+\\nu)}{h^2}$\n-   $u_{i+1}$ 的非对角系数：$A_{i,i+1} = \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2}$\n\n问题陈述，如果系数矩阵是M矩阵，则满足离散极值原理 (DMP)。对于这个三对角系统，这对任何内部行 $i$ 的系数施加了以下条件：\n1.  非正的非对角元素：$A_{i,i-1} \\le 0$ 且 $A_{i,i+1} \\le 0$。\n2.  非负的行和：$A_{i,i-1} + A_{i,i} + A_{i,i+1} \\ge 0$。\n\n我们首先检查行和条件：\n$$A_{i,i-1} + A_{i,i} + A_{i,i+1} = \\left( -\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) + \\left( \\frac{2(\\kappa+\\nu)}{h^2} \\right) + \\left( \\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\right) = 0$$\n由于行和为 $0$，非负条件得到满足。\n\n现在，我们强制执行非正非对角条件：\n-   对于 $A_{i,i-1} \\le 0$：\n$$-\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies -\\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge -\\frac{ah}{2}$$\n-   对于 $A_{i,i+1} \\le 0$：\n$$\\frac{a}{2h} - \\frac{\\kappa+\\nu}{h^2} \\le 0 \\implies \\frac{a}{2h} \\le \\frac{\\kappa+\\nu}{h^2} \\implies \\kappa+\\nu \\ge \\frac{ah}{2}$$\n为了对任何 $a \\in \\mathbb{R}$ 同时满足这两个不等式，总扩散必须大于或等于两个右侧值中的最大值：\n$$\\kappa+\\nu \\ge \\max\\left(\\frac{ah}{2}, -\\frac{ah}{2}\\right)$$\n使用绝对值可以简化为：\n$$\\kappa+\\nu \\ge \\frac{|a|h}{2}$$\n从这个不等式中，我们可以确定所需的人工扩散 $\\nu$：\n$$\\nu \\ge \\frac{|a|h}{2} - \\kappa$$\n问题要求的是*最小*人工扩散 $\\nu_{\\min}$，并且给定条件为 $\\nu \\ge 0$。因此，$\\nu$ 的最小值必须是 $0$ 和 DMP 条件所要求的值中较大的那个。\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n这确保了在对扩散进行最小可能非负增加的情况下满足 DMP。\n\n#### 第 2 部分：主阶误差系数 ($C_{\\text{lead}}$) 的推导\n\n为了找到主误差项的系数，我们通过在点 $x_i$ 周围对离散算子进行泰勒级数展开来推导修正方程。令 $u$ 及其导数 $u'$，$u''$ 等表示在 $x_i$ 处的函数值。\n$u_{i\\pm1} = u(x_i \\pm h)$ 的泰勒展开式为：\n$$u_{i+1} = u + hu' + \\frac{h^2}{2}u'' + \\frac{h^3}{6}u''' + O(h^4)$$\n$$u_{i-1} = u - hu' + \\frac{h^2}{2}u'' - \\frac{h^3}{6}u''' + O(h^4)$$\n我们展开离散导数近似：\n-   平流项：\n$$\\frac{u_{i+1} - u_{i-1}}{2h} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\frac{h^3}{6}u'''+\\dots) - (u-hu'+\\frac{h^2}{2}u''-\\frac{h^3}{6}u'''+\\dots)}{2h} = \\frac{2hu' + \\frac{h^3}{3}u''' + \\dots}{2h} = u' + \\frac{h^2}{6}u''' + O(h^4)$$\n-   扩散项：\n$$\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = \\frac{(u+hu'+\\frac{h^2}{2}u''+\\dots) - 2u + (u-hu'+\\frac{h^2}{2}u''+\\dots)}{h^2} = \\frac{h^2u'' + \\frac{h^4}{12}u'''' + \\dots}{h^2} = u'' + \\frac{h^2}{12}u'''' + O(h^4)$$\n作用于精确解 $u$ 的离散算子 $L_h$ 是：\n$$L_h u = a\\left(u' + \\frac{h^2}{6}u''' + O(h^4)\\right) - (\\kappa+\\nu)\\left(u'' + \\frac{h^2}{12}u'''' + O(h^4)\\right)$$\n$$L_h u = a u' - (\\kappa+\\nu)u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\n原始连续算子是 $L u = a u' - \\kappa u''$。截断误差 $\\tau$ 是差值 $\\tau = L_h u - L u$：\n$$\\tau = (a u' - (\\kappa+\\nu)u'' + \\dots) - (a u' - \\kappa u'')$$\n$$\\tau = -\\nu u'' + \\frac{ah^2}{6}u''' - \\frac{(\\kappa+\\nu)h^2}{12}u'''' + \\dots$$\n问题要求的是与 $\\frac{d^{2} u}{d x^{2}}$（即 $u''$）成比例的主阶误差项的系数 $C_{\\text{lead}}$。主阶误差是 $\\tau$ 展开式中 $h$ 的最低次幂项。我们必须代入 $\\nu = \\nu_{\\min}$ 来分析稳定后的格式。\n$$\\nu_{\\min} = \\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n有两种情况：\n1.  **扩散主导情况**：$\\frac{|a|h}{2} \\le \\kappa$。此时，$\\nu_{\\min} = 0$。截断误差变为：\n    $$\\tau = \\frac{ah^2}{6}u''' - \\frac{\\kappa h^2}{12}u'''' + O(h^4)$$\n    主误差是 $O(h^2)$ 并且不包含 $u''$ 项。因此，主误差中 $u''$ 的系数是 $C_{\\text{lead}} = 0$。\n2.  **平流主导情况**：$\\frac{|a|h}{2} > \\kappa$。此时，$\\nu_{\\min} = \\frac{|a|h}{2} - \\kappa$。该值是 $O(h)$ 阶的。截断误差是：\n    $$\\tau = -\\left(\\frac{|a|h}{2} - \\kappa\\right)u'' + \\frac{ah^2}{6}u''' - \\dots$$\n    $-\\nu_{\\min}u''$ 项是 $O(h)$ 阶的，而下一项是 $O(h^2)$ 阶的。因此，$-\\nu_{\\min}u''$ 是主误差项。该项与 $u''$ 成比例，其系数为 $C_{\\text{lead}} = -\\nu_{\\min}$。\n\n结合两种情况，与 $u''$ 成比例的主阶误差项的系数由 $C_{\\text{lead}} = -\\nu_{\\min}$ 给出。\n$$C_{\\text{lead}} = -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)$$\n在扩散主导情况下，该表达式正确地计算为 $0$，在平流主导情况下，计算为 $-(\\frac{|a|h}{2} - \\kappa)$。\n\n最终答案是 $\\nu_{\\min}$ 和 $C_{\\text{lead}}$ 的表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right) & -\\max\\left(0, \\frac{|a|h}{2} - \\kappa\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然简单的人工扩散是有效的，但它通常会引入过度的耗散。流线迎风/彼得罗夫-伽辽金 (SUPG) 方法提供了一种更为精妙的途径，它主要沿流体流动方向引入稳定项。这个动手推导练习要求您为一个一维问题构建 SUPG 稳定化的单元刚度矩阵，从而让您直接洞察这种定向扩散机制是如何抑制对流占主导问题中的伪振荡的 。",
            "id": "3526619",
            "problem": "考虑一个标量场 $c(x)$ 在尺寸为 $h$ 的均匀线性 ($P_1$) 有限元网格上的稳态一维对流扩散方程，该方程具有常系数，\n$$-k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f,$$\n其中 $k > 0$ 是扩散率，$u \\in \\mathbb{R}$ 是恒定的对流速度，$f$ 是一个源项。设 $N_1(x)$ 和 $N_2(x)$ 是单个单元 $e = [x_1, x_2]$（其中 $x_2 - x_1 = h$）上通常的线性形函数，并假设 $f$ 足够正则，使得标准的弱形式适用。采用 Galerkin 弱形式，其中扩散项通过分部积分处理，而对流项保留其守恒的一阶导数形式。流线迎风 Petrov-Galerkin (SUPG) 稳定化弱形式通过增加一个流线项来增强检验函数 $w$，在每个单元上可写为\n$$\\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx,$$\n其中 $\\tau \\ge 0$ 是稳定化参数，撇号表示对 $x$ 的导数。对于 $P_1$ 单元，$c$ 的二阶导数在 $e$ 上几乎处处为零，因此 SUPG 项相应地得以简化。设单元佩克莱数为 $Pe_e = |u|\\,h/(2k)$。\n\n请从基本原理出发，推导将单元 $e$ 上 $c$ 的节点值关联起来的 $2 \\times 2$ SUPG 稳定化单元刚度矩阵 $K_e(\\tau)$。请清楚地说明您使用的任何中间积分恒等式，并用 $k$、$u$、$h$ 和 $\\tau$ 以闭合形式表示最终的矩阵。然后，使用您的闭合形式表达式，解析地展示当 $Pe_e$ 增大时，非对角线元素如何依赖于 $\\tau$ 来抑制伪振荡，并将 SUPG 的贡献解释为沿流线方向增加的有效扩散。\n\n您的最终答案必须是单元刚度矩阵 $K_e(\\tau)$ 关于 $k$、$u$、$h$ 和 $\\tau$ 的单一符号表达式。不需要进行数值计算或四舍五入。",
            "solution": "此问题已经过验证，被认为是科学可靠、适定、客观且内部一致的。它代表了计算流体力学和有限元分析领域的一个标准推导过程。\n\n我们从给定的一维稳态对流扩散方程开始：\n$$ -k\\,\\frac{d^2 c}{dx^2} + u\\,\\frac{d c}{dx} = f $$\n在长度为 $h=x_2-x_1$ 的单个单元 $e = [x_1, x_2]$ 上的流线迎风 Petrov-Galerkin (SUPG) 弱形式如下：\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u\\,w'\\,\\big(-k\\,c'' + u\\,c' - f\\big)\\,dx = \\int_{e} w\\,f\\,dx $$\n对于线性 ($P_1$) 有限元，标量场 $c(x)$ 在单元上的近似 $c^h(x)$ 是一个线性多项式。因此，其二阶导数 $c''$ 在单元上几乎处处为零。SUPG 弱形式简化为：\n$$ \\int_{e} k\\,w' c'\\,dx + \\int_{e} u\\,w\\,c'\\,dx + \\int_{e} \\tau\\,u^2\\,w' c'\\,dx - \\int_{e} \\tau\\,u\\,w' f\\,dx = \\int_{e} w\\,f\\,dx $$\n为了推导单元刚度矩阵 $K_e(\\tau)$，我们考虑左侧依赖于未知场 $c$ 的项。涉及源函数 $f$ 的项贡献于单元载荷向量，而非刚度矩阵。整理这些项后，对刚度矩阵的贡献来自于以下表达式：\n$$ \\int_{e} (k + \\tau u^2) w' c' \\,dx + \\int_{e} u\\,w c' \\,dx $$\n在单元 $e$ 上，场 $c(x)$ 被近似为 $c^h(x) = \\sum_{j=1}^{2} c_j N_j(x)$，其中 $c_1$ 和 $c_2$ 分别是 $x_1$ 和 $x_2$ 处的节点值，$N_1(x)$ 和 $N_2(x)$ 是线性拉格朗日基函数（形函数）。为了构建 $2 \\times 2$ 的刚度矩阵，我们依次选择每个基函数作为检验函数 $w$，即对 $i=1, 2$，有 $w(x) = N_i(x)$。\n单元刚度矩阵的第 $(i,j)$ 个元素 $K_{ij}$ 是第 $i$ 个方程（其中 $w=N_i$）中节点值 $c_j$ 的系数。因此，\n$$ K_{ij} = \\int_{e} (k + \\tau u^2) N_i'(x) N_j'(x) \\,dx + \\int_{e} u\\,N_i(x) N_j'(x) \\,dx $$\n单元 $e = [x_1, x_2]$ 上的线性形函数定义为：\n$$ N_1(x) = \\frac{x_2 - x}{h}, \\quad N_2(x) = \\frac{x - x_1}{h} $$\n它们关于 $x$ 的导数在单元上是常数：\n$$ N_1'(x) = -\\frac{1}{h}, \\quad N_2'(x) = \\frac{1}{h} $$\n我们现在计算刚度矩阵的两个部分：类扩散（对称）部分和对流（反对称）部分。\n\n首先，是类扩散项，它包括标准扩散和 SUPG 的贡献。我们将其矩阵表示为 $K^{\\text{diff\\_supg}}$。\n$$ K^{\\text{diff\\_supg}}_{ij} = \\int_{x_1}^{x_2} (k + \\tau u^2) N_i' N_j' \\,dx $$\n由于被积函数是常数，积分就是被积函数乘以单元长度 $h$。\n$$ K^{\\text{diff\\_supg}}_{11} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{12} = (k + \\tau u^2) \\left(-\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{21} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(-\\frac{1}{h}\\right) h = -\\frac{k + \\tau u^2}{h} $$\n$$ K^{\\text{diff\\_supg}}_{22} = (k + \\tau u^2) \\left(\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) h = \\frac{k + \\tau u^2}{h} $$\n这给出了矩阵：\n$$ K^{\\text{diff\\_supg}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\n其次，是对流项。我们将其矩阵表示为 $K^{\\text{adv}}$。\n$$ K^{\\text{adv}}_{ij} = \\int_{x_1}^{x_2} u\\,N_i(x) N_j'(x) \\,dx $$\n我们计算必要的积分：\n$$ \\int_{x_1}^{x_2} N_1(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x_2-x}{h} \\,dx = \\frac{h}{2} $$\n$$ \\int_{x_1}^{x_2} N_2(x) \\,dx = \\int_{x_1}^{x_2} \\frac{x-x_1}{h} \\,dx = \\frac{h}{2} $$\n现在我们可以计算 $K^{\\text{adv}}$ 的元素：\n$$ K^{\\text{adv}}_{11} = u \\int_{x_1}^{x_2} N_1(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{12} = u \\int_{x_1}^{x_2} N_1(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_1(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\n$$ K^{\\text{adv}}_{21} = u \\int_{x_1}^{x_2} N_2(x) N_1'(x) \\,dx = u \\left(-\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = -\\frac{u}{h} \\frac{h}{2} = -\\frac{u}{2} $$\n$$ K^{\\text{adv}}_{22} = u \\int_{x_1}^{x_2} N_2(x) N_2'(x) \\,dx = u \\left(\\frac{1}{h}\\right) \\int_{x_1}^{x_2} N_2(x) \\,dx = \\frac{u}{h} \\frac{h}{2} = \\frac{u}{2} $$\n这给出了矩阵：\n$$ K^{\\text{adv}} = \\frac{u}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} $$\n总的 SUPG 稳定化单元刚度矩阵 $K_e(\\tau)$ 是这两个矩阵的和：\n$$ K_e(\\tau) = K^{\\text{diff\\_supg}} + K^{\\text{adv}} = \\frac{k + \\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + \\frac{u}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} $$\n合并各项，得到该矩阵的最终闭合形式表达式：\n$$ K_e(\\tau) = \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2} & -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2} & \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} $$\n接下来，我们分析非对角线元素如何依赖于 $\\tau$ 来抑制振荡。在标准 Galerkin 方法（$\\tau=0$）中，当对流占主导地位时（即单元佩克莱数 $Pe_e = |u|h/(2k)$ 很大时），会出现伪振荡。这对应于全局刚度矩阵失去对角占优性。避免这些振荡的一个充分条件是组装后的矩阵是一个 M-矩阵，这要求（除其他条件外）非对角线元素为非正数。\n考虑 $u > 0$ 的情况。振荡的可能性来自于项 $K_{12} = -k/h + u/2$。如果 $u/2 > k/h$，或者 $uh/(2k) > 1$（即 $Pe_e > 1$），这一项就变为正数，违反了 M-矩阵的性质。SUPG 稳定化的元素是 $K_{12}(\\tau) = -k/h + u/2 - \\tau u^2/h$。增加的项 $-\\tau u^2/h$ 始终是非正的（因为 $\\tau \\ge 0$）。通过适当地选择 $\\tau$，这一项可以抵消对流带来的正贡献，确保 $K_{12}(\\tau) \\le 0$，从而抑制振荡。对于 $u < 0$ 和元素 $K_{21}(\\tau)$，也存在类似的论证。因此，$\\tau$ 项增加了目标稳定性。\n\n最后，我们解释 SUPG 的贡献。刚度矩阵是标准 Galerkin 对流扩散矩阵（当 $\\tau=0$ 时）与源自 SUPG 项的矩阵之和：\n$$ K^{\\text{SUPG}} = \\frac{\\tau u^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\n该矩阵与标准扩散矩阵 $\\frac{k}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$ 的形式完全相同。因此，SUPG 方法可以被解释为在物理扩散 $k$ 的基础上增加了一个大小为 $k_{\\text{art}} = \\tau u^2$ 的“人工”或“平衡”扩散，从而得到有效扩散 $k_{\\text{eff}} = k + k_{\\text{art}} = k + \\tau u^2$。在多维问题中，这种增加的扩散专门作用于流动方向（流线），而这正是数值不稳定的来源。在这个一维案例中，流线与 x 轴对齐，因此该方法只是简单地向模型中增加了扩散。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{k+\\tau u^2}{h} - \\frac{u}{2} & -\\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\\\ -\\frac{k+\\tau u^2}{h} - \\frac{u}{2} & \\frac{k+\\tau u^2}{h} + \\frac{u}{2} \\end{pmatrix} } $$"
        },
        {
            "introduction": "对于像伯格斯方程这样的非线性守恒律，稳定化技术不仅要保证数值稳定性，还必须遵循熵条件等内在的物理原理。这项高级实践将指导您实现熵粘度方法，这是一种现代技术，其中人工粘度由局部熵产生率动态确定。通过编写算法并进行模拟，您将数值验证系统总熵不增这一关键物理性质，从而将数值稳定化与基本物理学直接联系起来 。",
            "id": "3526624",
            "problem": "考虑一维粘性 Burgers 方程在周期性域上的守恒形式，使用无量纲变量，\n$$\nc_t + \\left(\\frac{c^2}{2}\\right)_x - \\epsilon\\,c_{xx} = 0,\n$$\n其中 $c(x,t)$ 是一个标量场，$\\epsilon > 0$ 是一个小的物理粘性，下标表示偏微分。在多物理场耦合模拟中对流主导问题的稳定化技术背景下，熵粘性方法引入了一个额外的、数据驱动的粘性场来正则化激波，同时在光滑区域保持精度。\n\n仅从与标量守恒律和凸熵函数相关的基本定律和核心定义出发，推导一个算法以：\n- 为粘性 Burgers 方程构造一个熵对 $(\\eta(c), q(c))$，\n- 获得一个逐点的熵残差 $R_\\eta(x,t)$，它量化了与光滑熵平衡的偏离，\n- 使用物理上合理的缩放从 $R_\\eta(x,t)$ 定义一个稳定化粘性场 $\\nu_E(x,t)$，\n- 使用一个考虑周期性边界条件的守恒显式有限差分格式，以总粘性 $\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$ 来演化该偏微分方程，\n- 并数值验证总熵 $E(t) = \\int_0^1 \\eta(c(x,t))\\,dx$ 在时间上是非增的。\n\n计算域为 $x \\in [0,1]$，带有周期性边界条件。使用类似激波的分段常数初始条件\n$$\nc(x,0) = \\begin{cases}\nc_L & \\text{if } x < x_s, \\\\\nc_R & \\text{if } x \\ge x_s,\n\\end{cases}\n$$\n其中 $c_L = 1$，$c_R = 0$，$x_s = 0.5$。所有量都是无量纲的。\n\n对于光滑解，离散化必须在空间上是二阶精确的，对于对流通量 $\\left(\\frac{c^2}{2}\\right)_x$ 是守恒的，并且必须将稳定化粘性 $\\nu_E(x,t)$ 与物理粘性 $\\epsilon$ 可加地合并。自适应地选择时间步长 $\\Delta t$ 以满足对流和扩散组合的标准显式稳定性约束，该约束用网格间距 $h$、最大特征速度和最大粘性表示。\n\n您的程序必须实现完整的算法，并为每个测试用例生成一个布尔值，指示数值计算的熵 $E(t)$ 是否在所有时间 $t \\in [0,T]$ 内在一个小的数值容差范围内是非增的。将所有测试用例的结果汇总到单行输出中，包含一个逗号分隔的 Python 风格列表。\n\n使用以下测试套件来评估在不同工况下的正确性和鲁棒性：\n- 测试用例 1（理想情况）：$N_x = 200$ 个空间点，最终时间 $T = 0.10$，物理粘性 $\\epsilon = 10^{-3}$，熵粘性系数 $C_e = 0.5$，最大粘性上限系数 $C_{\\max} = 0.5$，对流-扩散稳定性因子 $\\text{CFL} = 0.20$。\n- 测试用例 2（对流主导，物理粘性非常小）：$N_x = 200$, $T = 0.10$, $\\epsilon = 10^{-6}$, $C_e = 1.5$, $C_{\\max} = 0.7$, $\\text{CFL} = 0.20$。\n- 测试用例 3（粗网格边缘情况）：$N_x = 50$, $T = 0.05$, $\\epsilon = 10^{-6}$, $C_e = 1.0$, $C_{\\max} = 1.0$, $\\text{CFL} = 0.20$。\n\n在每种情况下，通过检查离散积分\n$$\nE^n \\approx h \\sum_{i=0}^{N_x-1} \\eta\\!\\left(c_i^n\\right)\n$$\n不随时间步索引 $n$ 增加，在一个小的数值容差范围内，来验证 $E(t)$ 的单调性。使用周期性边界条件，并确保算法在每个时间步从演化中的解计算稳定化粘性场 $\\nu_E(x,t)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，例如“[$r_1, r_2, r_3$]”，其中每个 $r_k$ 是测试用例 $k$ 的布尔值，指示该情况下 $E(t)$ 是否在时间上非增。",
            "solution": "该问题要求为一维粘性 Burgers 方程实现并验证一种熵粘性稳定化方法。解决方案涉及基于标量守恒律的基本原理推导并数值实现一个算法。\n\n**1. 熵对的构造**\n\n粘性 Burgers 方程是一个形式为 $\\partial_t c + \\partial_x f(c) = \\partial_x (\\epsilon \\partial_x c)$ 的标量守恒律，其对流通量为 $f(c) = c^2/2$。一个熵函数 $\\eta(c)$ 必须是守恒量 $c$ 的凸函数。相关的熵通量 $q(c)$ 由相容性关系 $q'(c) = \\eta'(c) f'(c)$ 定义。\n\n熵函数的一个标准选择是动能的类似物，$\\eta(c) = c^2/2$。该函数是凸的，因为它的二阶导数 $\\eta''(c) = 1$ 是正的。\n熵函数的导数是 $\\eta'(c) = c$。\n对流通量的导数是 $f'(c) = c$。\n\n将这些代入相容性关系得到：\n$$\nq'(c) = (c)(c) = c^2\n$$\n对该表达式关于 $c$ 积分，得到熵通量：\n$$\nq(c) = \\int c^2 dc = \\frac{c^3}{3}\n$$\n我们选择积分常数为零。因此，本问题使用的熵对是 $(\\eta(c), q(c)) = (c^2/2, c^3/3)$。\n\n**2. 数值算法设计**\n\n任务的核心是在均匀网格 $x_i = i h$（其中 $i = 0, \\ldots, N_x-1$ 且 $h = 1/N_x$）上使用自定义数值格式来演化偏微分方程。该格式必须是时间显式的，并能处理周期性边界条件。总粘性是数据驱动的，$\\nu_{\\text{tot}}(x,t) = \\epsilon + \\nu_E(x,t)$，其中 $\\nu_E$ 是在每个时间步计算的熵粘性。\n\n**2.1. 空间离散化**\n\n在网格点 $x_i$ 处的半离散方程是：\n$$\n\\frac{dc_i}{dt} = - \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i + \\left. \\frac{\\partial}{\\partial x}\\left(\\nu_{\\text{tot}} \\frac{\\partial c}{\\partial x}\\right) \\right|_i\n$$\n-   **对流项**：按照要求，我们对对流通量导数使用守恒的二阶中心差分格式：\n    $$\n    \\left. \\frac{\\partial f(c)}{\\partial x} \\right|_i \\approx \\frac{f(c_{i+1}) - f(c_{i-1})}{2h}\n    $$\n-   **扩散项**：对于可变系数的扩散项，采用标准的二阶守恒离散化。在交错网格点 $x_{i+1/2}$ 处的扩散通量近似为 $J_{i+1/2} \\approx \\frac{\\nu_{\\text{tot},i} + \\nu_{\\text{tot},i+1}}{2} \\frac{c_{i+1}-c_i}{h}$。该通量在网格点 $x_i$ 处的散度则为：\n    $$\n    \\left. \\frac{\\partial J}{\\partial x} \\right|_i \\approx \\frac{J_{i+1/2} - J_{i-1/2}}{h}\n    $$\n\n**2.2. 熵粘性计算**\n\n在每个时间步 $n$，给定解 $c^n$，计算熵粘性场 $\\nu_E^n$。\n\n-   **熵残差 ($R_\\eta$)**：残差衡量数值格式的非耗散部分对熵守恒方程 $\\eta_t + q_x = 0$ 的局部违背程度。我们近似 $\\eta_t \\approx \\eta'(c) c_t$ 并使用半离散无粘性常微分方程 $c_t \\approx -f(c)_x$，基于当前状态 $c^n$ 来定义残差：\n    $$\n    R_{\\eta,i} = \\left| \\eta'(c_i) \\left( -\\frac{f_{i+1} - f_{i-1}}{2h} \\right) + \\left( \\frac{q_{i+1} - q_{i-1}}{2h} \\right) \\right|\n    $$\n    其中 $f_i = f(c_i)$ 且 $q_i = q(c_i)$。\n\n-   **稳定化粘性 ($\\nu_E$)**：通过缩放残差来定义粘性。该缩放涉及网格间距的平方，并通过局部熵变化进行归一化，以确保正确的物理单位和局部化。\n    $$\n    \\nu_{E,i} = C_e h^2 \\frac{ |R_{\\eta,i}| }{ |\\eta_{i+1} - \\eta_i| + |\\eta_{i-1} - \\eta_i| + \\delta }\n    $$\n    其中 $C_e$ 是一个指定的系数，$\\delta$ 是一个小数字（例如 $10^{-12}$）以防止除以零。\n\n-   **粘性上限**：对 $\\nu_E$ 施加一个上限，以防止其变得过大，从而导致时间步长过小。该上限基于一个局部的类 CFL 条件：\n    $$\n    \\nu_{\\max, i} = C_{\\max} h |f'(c_i)| = C_{\\max} h |c_i|\n    $$\n    最终的熵粘性为 $\\nu_{E,i} \\leftarrow \\min(\\nu_{E,i}, \\nu_{\\max, i})$。\n\n**2.3. 时间演化与稳定性**\n\n-   **时间步进**：使用显式前向欧拉格式来推进解：\n    $$\n    c_i^{n+1} = c_i^n + \\Delta t \\cdot \\text{RHS}_i(c^n, \\nu_{\\text{tot}}^n)\n    $$\n-   **自适应时间步长 ($\\Delta t$)**：为确保显式格式的稳定性，时间步长 $\\Delta t$ 在每一步根据最大特征速度和最大总粘性计算：\n    $$\n    \\Delta t = \\text{CFL} \\cdot \\frac{h^2}{h \\max_j|c_j| + 2 \\max_j|\\nu_{\\text{tot},j}|}\n    $$\n    其中 `CFL` 是给定的对流-扩散稳定性因子。\n\n**3. 熵耗散的验证**\n\n主要目标是验证总离散熵 $E^n = h \\sum_{i=0}^{N_x-1} \\eta(c_i^n)$ 在时间上是非增的。这通过在每个时间步比较新计算的熵 $E^{n+1}$ 与前一个值 $E^n$ 来检查。由于浮点运算，检查放宽为 $E^{n+1} \\le E^n + \\tau$，其中 $\\tau$ 是一个小的数值容差。如果在模拟过程中的任何时刻违反了此条件，则认为该测试用例的熵不是非增的。\n\n这个完整的算法在最终程序中实现，以解决指定测试用例的问题。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D viscous Burgers' equation using the entropy viscosity method\n    and verifies the non-increasing nature of the total discrete entropy.\n    \"\"\"\n\n    test_cases = [\n        # (Nx, T, epsilon, Ce, Cmax, CFL)\n        (200, 0.10, 1e-3, 0.5, 0.5, 0.20),  # Test case 1\n        (200, 0.10, 1e-6, 1.5, 0.7, 0.20),  # Test case 2\n        (50, 0.05, 1e-6, 1.0, 1.0, 0.20),   # Test case 3\n    ]\n\n    results = []\n    for params in test_cases:\n        is_monotonic = run_simulation(*params)\n        results.append(is_monotonic)\n\n    # Format the final output as a Python-style list string\n    print(f\"[{','.join(map(str, [r for r in results]))}]\")\n\ndef run_simulation(Nx, T, epsilon, Ce, Cmax, CFL):\n    \"\"\"\n    Runs a single simulation case for the Burgers' equation.\n\n    Args:\n        Nx (int): Number of spatial points.\n        T (float): Final simulation time.\n        epsilon (float): Physical viscosity.\n        Ce (float): Entropy viscosity coefficient.\n        Cmax (float): Viscosity cap coefficient.\n        CFL (float): Advective-diffusive stability factor.\n\n    Returns:\n        bool: True if the total entropy is non-increasing, False otherwise.\n    \"\"\"\n    # Domain and Grid setup\n    x = np.linspace(0.0, 1.0, Nx, endpoint=False)\n    h = 1.0 / Nx\n\n    # Initial Condition\n    cL, cR, xs = 1.0, 0.0, 0.5\n    c = np.where(x < xs, cL, cR)\n\n    # Entropy-related functions\n    # f(c) = c^2 / 2\n    # eta(c) = c^2 / 2 (entropy)\n    # q(c) = c^3 / 3 (entropy flux)\n    # eta'(c) = c\n    f = lambda u: 0.5 * u**2\n    eta = lambda u: 0.5 * u**2\n    q = lambda u: (1.0/3.0) * u**3\n    eta_prime = lambda u: u\n\n    t = 0.0\n    is_non_increasing = True\n    \n    # Initial total entropy computation\n    # The integral is approximated by a sum using the rectangle rule\n    E_prev = h * np.sum(eta(c))\n    \n    # Numerical tolerance for entropy increase check\n    tolerance = 1e-12\n\n    # Main time loop\n    while t < T:\n        # --- 1. Compute Entropy Viscosity ---\n        \n        # Central difference for advective term (for residual calculation)\n        f_c = f(c)\n        adv_term_res = -(np.roll(f_c, -1) - np.roll(f_c, 1)) / (2.0 * h)\n        \n        # Entropy residual R_eta = | eta'(c)*(-f_x) + q_x |\n        q_c = q(c)\n        R_eta = np.abs(eta_prime(c) * adv_term_res + (np.roll(q_c, -1) - np.roll(q_c, 1)) / (2.0 * h))\n        \n        # Denominator for viscosity scaling\n        eta_c = eta(c)\n        denom = np.abs(np.roll(eta_c, -1) - eta_c) + np.abs(np.roll(eta_c, 1) - eta_c) + 1e-12\n        \n        # Entropy viscosity nu_E\n        nu_E = Ce * h**2 * R_eta / denom\n        \n        # Viscosity cap\n        nu_max = Cmax * h * np.abs(c)\n        nu_E = np.minimum(nu_E, nu_max)\n        \n        # Total viscosity\n        nu_tot = epsilon + nu_E\n\n        # --- 2. Calculate Adaptive Time Step ---\n        c_max_speed = np.max(np.abs(c))\n        nu_max_total = np.max(nu_tot)\n\n        dt = CFL * h**2 / (h * c_max_speed + 2.0 * nu_max_total + 1e-12)\n        \n        # Ensure the final time T is not overshot\n        if t + dt > T:\n            dt = T - t\n\n        # --- 3. Evolve the Solution ---\n        \n        # Advection term: central difference\n        adv_term = -(np.roll(f(c), -1) - np.roll(f(c), 1)) / (2.0 * h)\n\n        # Diffusion term: second-order conservative central difference for variable coefficient\n        # Flux at staggered points i+1/2\n        flux_stag_p_half = 0.5 * (np.roll(nu_tot, -1) + nu_tot) * (np.roll(c, -1) - c) / h\n        # Divergence of the flux\n        diff_term = (flux_stag_p_half - np.roll(flux_stag_p_half, 1)) / h\n        \n        # Right-hand side of the semi-discrete equation\n        rhs = adv_term + diff_term\n        \n        # Update solution using Forward Euler\n        c_new = c + dt * rhs\n        c = c_new\n\n        # --- 4. Verify Entropy ---\n        E_curr = h * np.sum(eta(c))\n        \n        if E_curr > E_prev + tolerance:\n            is_non_increasing = False\n            # Break early as the condition is violated\n            break\n            \n        E_prev = E_curr\n        t += dt\n\n    return is_non_increasing\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}