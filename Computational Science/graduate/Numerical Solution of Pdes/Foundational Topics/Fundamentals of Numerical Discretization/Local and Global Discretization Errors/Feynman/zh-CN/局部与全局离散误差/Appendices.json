{
    "hands_on_practices": [
        {
            "introduction": "要分析任何数值格式的准确性，第一步也是最关键的一步是量化其局部截断误差（LTE）。本练习将引导你完成一个基础但至关重要的推导：计算一维泊松方程中标准中心差分格式的局部截断误差 。通过应用泰勒级数展开，你将亲手揭示离散算子与它所近似的微分算子之间的差异，并确定误差的主阶项，这是理解格式收敛阶的基础。",
            "id": "3416695",
            "problem": "考虑在 $[0,1]$ 上的一维偏微分方程 (PDE) $-u''(x)=f(x)$，其狄利克雷边界条件为 $u(0)=\\alpha$ 和 $u(1)=\\beta$，其中 $u \\in C^{4}([0,1])$ 且 $f$ 是连续的。给定一个均匀网格 $x_{i}=ih$，其中 $i=0,1,\\dots,N$，$h=1/N$。定义内部节点处的离散算子为\n$$\nL_{h}u(x_{i}) \\equiv \\frac{-u(x_{i-1})+2u(x_{i})-u(x_{i+1})}{h^{2}}。\n$$\n内部网格点 $x_{i}$ 处的局部截断误差 (LTE) 定义为\n$$\n\\tau_{i}(h) \\equiv L_{h}u(x_{i})-f(x_{i})。\n$$\n仅使用 LTE 的定义和在 $u \\in C^{4}([0,1])$ 条件下有效的带有适当余项的泰勒定理，推导当 $h\\to 0$ 时 $\\tau_{i}(h)$ 的主阶项，并由此证明其关于 $h$ 的阶数。您的最终答案必须是内部节点 $x_i$ 处 $\\tau_{i}(h)$ 主项的单一闭式解析表达式。不需要进行数值计算，也不需要四舍五入。请用 $h$ 和在 $x_{i}$ 处求值的 $u$ 的导数来表示您的最终答案。",
            "solution": "首先验证问题，以确保其是自洽的、有科学依据且适定的。\n\n### 步骤 1：提取已知条件\n- **偏微分方程 (PDE)**：$-u''(x)=f(x)$，对于 $x \\in [0,1]$。\n- **边界条件**：$u(0)=\\alpha$ 和 $u(1)=\\beta$。\n- **光滑性**：解 $u$ 属于 $C^{4}([0,1])$ 类，且 $f$ 是一个连续函数。\n- **离散化**：均匀网格由 $x_{i}=ih$ 定义，其中 $i=0,1,\\dots,N$，步长为 $h=1/N$。\n- **离散算子**：在内部节点 $x_i$（$i=1, \\dots, N-1$）处，离散算子为 $L_{h}u(x_{i}) \\equiv \\frac{-u(x_{i-1})+2u(x_{i})-u(x_{i+1})}{h^{2}}$。\n- **局部截断误差 (LTE)**：在内部网格点 $x_i$ 处，LTE 定义为 $\\tau_{i}(h) \\equiv L_{h}u(x_{i})-f(x_{i})$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是微分方程数值分析中的一个标准练习，具体涉及有限差分近似的局部截断误差的推导。\n- **科学依据**：该问题基于微积分（泰勒定理）和数值方法的基本原理。$-u''$ 的有限差分近似是该领域的基石。所有方面在科学和数学上都是合理的。\n- **适定性**：问题陈述清晰，提供了所有必要的定义和条件。光滑性条件 $u \\in C^{4}([0,1])$ 正是进行所需阶数泰勒展开所必需的。目标明确，没有歧义。\n- **客观性**：该问题以精确、形式化的数学语言陈述，没有任何主观性或歧义。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。我们可以继续进行推导。\n\n### 局部截断误差的推导\n\n目标是求出内部节点 $x_i$ 处局部截断误差 $\\tau_{i}(h)$ 的主阶项。\nLTE 的定义为\n$$\n\\tau_{i}(h) \\equiv L_{h}u(x_{i})-f(x_{i})。\n$$\n问题指出，精确解 $u(x)$ 满足偏微分方程（在这种一维情况下，是常微分方程）$-u''(x)=f(x)$，对所有 $x \\in [0,1]$ 均成立。因此，在网格点 $x_i$ 处，我们有 $-u''(x_i)=f(x_i)$。将此代入 $\\tau_i(h)$ 的定义，得到：\n$$\n\\tau_{i}(h) = L_{h}u(x_{i}) - (-u''(x_i)) = L_{h}u(x_{i}) + u''(x_i)。\n$$\n现在，我们代入离散算子 $L_h u(x_i)$ 的定义：\n$$\n\\tau_{i}(h) = \\frac{-u(x_{i-1})+2u(x_{i})-u(x_{i+1})}{h^{2}} + u''(x_{i})。\n$$\n为分析此表达式，我们使用泰勒定理将项 $u(x_{i-1})$ 和 $u(x_{i+1})$ 在点 $x_i$ 附近展开。注意 $x_{i-1} = x_i - h$ 且 $x_{i+1} = x_i + h$。给定的条件 $u \\in C^{4}([0,1])$ 确保了 $u$ 的四阶导数是连续的，这使得泰勒展开到四阶项是有效的。\n\n$u(x_i+h)$ 在 $x_i$ 附近的泰勒展开为：\n$$\nu(x_{i+1}) = u(x_i+h) = u(x_i) + h u'(x_i) + \\frac{h^2}{2!} u''(x_i) + \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + o(h^4)。\n$$\n$u(x_i-h)$ 在 $x_i$ 附近的泰勒展开为：\n$$\nu(x_{i-1}) = u(x_i-h) = u(x_i) - h u'(x_i) + \\frac{h^2}{2!} u''(x_i) - \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + o(h^4)。\n$$\n现在，我们将这些展开式代入 $L_h u(x_i)$ 表达式的分子中：\n$$\n-u(x_{i-1})+2u(x_{i})-u(x_{i+1}) = -[u(x_i-h)] + 2u(x_i) - [u(x_i+h)]。\n$$\n让我们按照 $u$ 在 $x_i$ 处的导数阶数对各项进行分组：\n\\begin{align*}\n-u(x_{i-1})+2u(x_{i})-u(x_{i+1}) =  -\\left(u(x_i) - h u'(x_i) + \\frac{h^2}{2} u''(x_i) - \\frac{h^3}{6} u'''(x_i) + \\frac{h^4}{24} u^{(4)}(x_i) + o(h^4)\\right) \\\\\n + 2u(x_i) \\\\\n - \\left(u(x_i) + h u'(x_i) + \\frac{h^2}{2} u''(x_i) + \\frac{h^3}{6} u'''(x_i) + \\frac{h^4}{24} u^{(4)}(x_i) + o(h^4)\\right) \\\\\n=  (-1+2-1)u(x_i) + (h-h)u'(x_i) + \\left(-\\frac{h^2}{2} - \\frac{h^2}{2}\\right)u''(x_i) \\\\\n + \\left(\\frac{h^3}{6} - \\frac{h^3}{6}\\right)u'''(x_i) + \\left(-\\frac{h^4}{24} - \\frac{h^4}{24}\\right)u^{(4)}(x_i) + o(h^4) \\\\\n=  0 \\cdot u(x_i) + 0 \\cdot u'(x_i) - h^2 u''(x_i) + 0 \\cdot u'''(x_i) - \\frac{2h^4}{24} u^{(4)}(x_i) + o(h^4) \\\\\n=  -h^2 u''(x_i) - \\frac{h^4}{12} u^{(4)}(x_i) + o(h^4).\n\\end{align*}\n现在，将此结果代回 $\\tau_i(h)$ 的表达式中：\n$$\n\\tau_{i}(h) = \\frac{-h^2 u''(x_i) - \\frac{h^4}{12} u^{(4)}(x_i) + o(h^4)}{h^{2}} + u''(x_i)。\n$$\n将各项除以 $h^2$，我们得到：\n$$\n\\tau_{i}(h) = \\left(-u''(x_i) - \\frac{h^2}{12} u^{(4)}(x_i) + o(h^2)\\right) + u''(x_i)。\n$$\n$u''(x_i)$ 项相互抵消：\n$$\n\\tau_{i}(h) = - \\frac{h^2}{12} u^{(4)}(x_i) + o(h^2)。\n$$\n当 $h \\to 0$ 时，此表达式中的主导项是 $h$ 的最低次幂项。这就是主阶项。因此，局部截断误差 $\\tau_i(h)$ 的主阶项是 $-\\frac{h^2}{12} u^{(4)}(x_i)$。\n\n这个结果也证明了该有限差分格式的精度阶。由于局部截断误差 $\\tau_i(h)$ 与 $h^2$ 成正比，我们说该方法是 $\\mathcal{O}(h^2)$ 的，或称为二阶精度。这意味着，如果步长 $h$ 减小一半，局部误差预计将减小为原来的四分之一（即减小一个因子 $2^2=4$），前提是 $u^{(4)}(x_i)$ 不为零。\n最终答案是该主项的显式解析表达式。",
            "answer": "$$\n\\boxed{- \\frac{h^{2}}{12} u^{(4)}(x_{i})}\n$$"
        },
        {
            "introduction": "在均匀网格上取得的简洁结果并不总能推广到实际应用中更常见的非均匀网格。本练习  探讨了在非均匀网格上离散化二阶导数时局部截断误差的行为。你将发现，截断误差的表达式中出现了一个与网格间距变化率相关的低阶项，这揭示了要实现全局二阶收敛，仅有一致的局部二阶精度是不够的，还必须对网格的“光滑性”提出要求。",
            "id": "3416659",
            "problem": "考虑一维空间中的一个包含两个区间的非均匀网格，其节点为 $x_{i-1}$、$x_i$、$x_{i+1}$，局部左间距为 $h_i = x_i - x_{i-1}$，局部右间距为 $h_{i+1} = x_{i+1} - x_i$。令 $u : [0,1] \\to \\mathbb{R}$ 为一个足够光滑的函数。在 $x_i$ 处，二阶导数的标准三点非均匀有限差分近似使用相邻节点值的线性组合\n$$\nD^{2}u_i \\;=\\; \\frac{2}{h_i\\,h_{i+1}\\,(h_i + h_{i+1})}\\,\\Big( h_i\\,u_{i+1} \\;-\\; (h_i + h_{i+1})\\,u_i \\;+\\; h_{i+1}\\,u_{i-1} \\Big),\n$$\n其中 $u_j = u(x_j)$。\n\n任务 A：从 $x_i$ 点的泰勒定理出发，假设 $u$ 存在至少四阶连续导数，推导局部截断误差 $\\tau_i = D^{2}u_i - u''(x_i)$，结果需要包含与 $u^{(3)}(x_i)$ 和 $u^{(4)}(x_i)$ 成比例的项，并以 $h_i$、$h_{i+1}$、$u^{(3)}(x_i)$ 和 $u^{(4)}(x_i)$ 的闭式表达式给出。\n\n任务 B：考虑在 $[0,1]$ 上的一维椭圆边值问题 $-u''(x) = f(x)$，其边界条件为齐次狄利克雷边界条件 $u(0) = 0$ 和 $u(1) = 0$。该问题通过用 $D^{2}u_i$ 替换 $u''(x_i)$ 在内部节点进行离散化，并在端点施加边界条件。请说明为保证全局误差 $\\|u - u_h\\|_{\\infty}$ 在 $h_{\\max} \\to 0$ 时为 $\\mathcal{O}(h_{\\max}^{2})$，需要对网格和解的正则性施加的充分条件，其中 $h_{\\max} = \\max_j h_j$。在你的条件中，请明确指出局部对称性（即 $h_{i+1} - h_i$ 的行为）以及离散算子稳定性的作用。\n\n你的最终答案必须是任务 A 中得到的闭式解析表达式。无需进行四舍五入。",
            "solution": "所述问题是有限差分法数值分析中的一个标准练习。它具有科学依据、是适定的、客观且完整的。所有组成部分，包括有限差分公式、局部截断误差的概念以及边值问题的全局误差分析，都是该领域的基础。因此，该问题被认为是有效的，下面提供了完整的解答。\n\n解答分为两部分，分别对应任务 A 和任务 B。\n\n**任务 A：局部截断误差的推导**\n\n目标是求出局部截断误差 $\\tau_i = D^{2}u_i - u''(x_i)$，其中 $u''(x_i)$ 是函数 $u(x)$ 在节点 $x_i$ 处的精确二阶导数。给定的非均匀网格上二阶导数的三点有限差分近似为：\n$$\nD^{2}u_i = \\frac{2}{h_i h_{i+1} (h_i + h_{i+1})} \\left( h_i u_{i+1} - (h_i + h_{i+1})u_i + h_{i+1} u_{i-1} \\right)\n$$\n此处，$u_j = u(x_j)$，$h_i = x_i - x_{i-1} > 0$，以及 $h_{i+1} = x_{i+1} - x_i > 0$。\n\n我们已知函数 $u(x)$ 至少有四阶连续导数，即 $u \\in C^4([0,1])$。因此，我们可以使用泰勒定理将 $u_{i+1} = u(x_i + h_{i+1})$ 和 $u_{i-1} = u(x_i - h_i)$ 在 $x_i$ 点附近展开。我们展开到四阶项，更高阶的项用 $\\mathcal{O}(h^5)$ 表示。\n令 $u^{(k)}(x_i)$ 表示 $u$ 在 $x_i$ 处的 $k$ 阶导数。展开式为：\n$$\nu_{i+1} = u(x_i) + h_{i+1} u^{(1)}(x_i) + \\frac{h_{i+1}^2}{2} u^{(2)}(x_i) + \\frac{h_{i+1}^3}{6} u^{(3)}(x_i) + \\frac{h_{i+1}^4}{24} u^{(4)}(x_i) + \\mathcal{O}(h_{i+1}^5)\n$$\n$$\nu_{i-1} = u(x_i) - h_i u^{(1)}(x_i) + \\frac{h_i^2}{2} u^{(2)}(x_i) - \\frac{h_i^3}{6} u^{(3)}(x_i) + \\frac{h_i^4}{24} u^{(4)}(x_i) + \\mathcal{O}(h_i^5)\n$$\n让我们将这些展开式代入线性组合 $h_i u_{i+1} - (h_i + h_{i+1})u_i + h_{i+1} u_{i-1}$。我们按照 $u$ 在 $x_i$ 处的导数阶数对各项进行分组。\n\n$u(x_i)$ 的项：\n$$\nh_i u(x_i) - (h_i + h_{i+1}) u(x_i) + h_{i+1} u(x_i) = (h_i - h_i - h_{i+1} + h_{i+1}) u(x_i) = 0\n$$\n$u^{(1)}(x_i)$ 的项：\n$$\nh_i (h_{i+1} u^{(1)}(x_i)) + h_{i+1} (-h_i u^{(1)}(x_i)) = (h_i h_{i+1} - h_{i+1} h_i) u^{(1)}(x_i) = 0\n$$\n$u^{(2)}(x_i)$ 的项：\n$$\nh_i \\left(\\frac{h_{i+1}^2}{2} u^{(2)}(x_i)\\right) + h_{i+1} \\left(\\frac{h_i^2}{2} u^{(2)}(x_i)\\right) = \\left(\\frac{h_i h_{i+1}^2 + h_{i+1} h_i^2}{2}\\right) u^{(2)}(x_i) = \\frac{h_i h_{i+1}(h_{i+1} + h_i)}{2} u^{(2)}(x_i)\n$$\n$u^{(3)}(x_i)$ 的项：\n$$\nh_i \\left(\\frac{h_{i+1}^3}{6} u^{(3)}(x_i)\\right) + h_{i+1} \\left(-\\frac{h_i^3}{6} u^{(3)}(x_i)\\right) = \\left(\\frac{h_i h_{i+1}^3 - h_{i+1} h_i^3}{6}\\right) u^{(3)}(x_i) = \\frac{h_i h_{i+1}(h_{i+1}^2 - h_i^2)}{6} u^{(3)}(x_i)\n$$\n使用平方差公式 $h_{i+1}^2 - h_i^2 = (h_{i+1} - h_i)(h_{i+1} + h_i)$。该项变为：\n$$\n\\frac{h_i h_{i+1}(h_{i+1} - h_i)(h_{i+1} + h_i)}{6} u^{(3)}(x_i)\n$$\n$u^{(4)}(x_i)$ 的项：\n$$\nh_i \\left(\\frac{h_{i+1}^4}{24} u^{(4)}(x_i)\\right) + h_{i+1} \\left(\\frac{h_i^4}{24} u^{(4)}(x_i)\\right) = \\left(\\frac{h_i h_{i+1}^4 + h_{i+1} h_i^4}{24}\\right) u^{(4)}(x_i) = \\frac{h_i h_{i+1}(h_{i+1}^3 + h_i^3)}{24} u^{(4)}(x_i)\n$$\n使用立方和公式 $h_{i+1}^3 + h_i^3 = (h_{i+1} + h_i)(h_{i+1}^2 - h_i h_{i+1} + h_i^2)$。该项变为：\n$$\n\\frac{h_i h_{i+1}(h_{i+1} + h_i)(h_{i+1}^2 - h_i h_{i+1} + h_i^2)}{24} u^{(4)}(x_i)\n$$\n现在，我们组合这些项并乘以预因子 $\\frac{2}{h_i h_{i+1} (h_i + h_{i+1})}$，以获得 $D^{2}u_i$ 的表达式：\n\n$D^{2}u_i = \\frac{2}{h_i h_{i+1} (h_i + h_{i+1})} \\Big[$\n$\\frac{h_i h_{i+1}(h_{i+1} + h_i)}{2} u^{(2)}(x_i) +$\n$\\frac{h_i h_{i+1}(h_{i+1} - h_i)(h_{i+1} + h_i)}{6} u^{(3)}(x_i) +$\n$\\frac{h_i h_{i+1}(h_{i+1} + h_i)(h_{i+1}^2 - h_i h_{i+1} + h_i^2)}{24} u^{(4)}(x_i) + \\mathcal{O}(h^5) \\Big]$\n\n其中 $h = \\max(h_i, h_{i+1})$。\n乘开后，我们得到：\n$$\nD^{2}u_i = u^{(2)}(x_i) + \\frac{2}{6}(h_{i+1} - h_i) u^{(3)}(x_i) + \\frac{2}{24}(h_{i+1}^2 - h_i h_{i+1} + h_i^2) u^{(4)}(x_i) + \\mathcal{O}(h^3)\n$$\n$$\nD^{2}u_i = u^{(2)}(x_i) + \\frac{1}{3}(h_{i+1} - h_i) u^{(3)}(x_i) + \\frac{1}{12}(h_i^2 - h_i h_{i+1} + h_{i+1}^2) u^{(4)}(x_i) + \\mathcal{O}(h^3)\n$$\n局部截断误差 $\\tau_i$ 定义为 $\\tau_i = D^{2}u_i - u^{(2)}(x_i)$。因此，\n$$\n\\tau_i = \\frac{h_{i+1} - h_i}{3} u^{(3)}(x_i) + \\frac{h_i^2 - h_i h_{i+1} + h_{i+1}^2}{12} u^{(4)}(x_i) + \\mathcal{O}(h^3)\n$$\n这个截断误差的表达式，包含到与 $u^{(3)}(x_i)$ 和 $u^{(4)}(x_i)$ 成比例的项为止，即为所求。\n\n**任务 B：二阶全局误差的条件**\n\n我们考虑边值问题 $-u''(x) = f(x)$，其中 $x \\in [0,1]$ 且 $u(0)=0$ 和 $u(1)=0$。离散化过程用 $-D^2u_i$ 替换 $-u''(x_i)$，从而得到关于数值解向量 $u_h$ 的线性方程组 $A_h u_h = f$。精确解 $u$ 满足 $-D^2 u(x_i) = f(x_i) - \\tau_i$，其中 $\\tau_i$ 是任务 A 中推导的局部截断误差。因此，全局误差向量 $e = u - u_h$ 满足误差方程 $A_h e = \\tau$，其中 $\\tau$ 是局部截断误差组成的向量。\n\n在最大范数下的全局误差有界，即 $\\|e\\|_{\\infty} \\le \\|A_h^{-1}\\|_{\\infty} \\|\\tau\\|_{\\infty}$。为使全局误差达到二阶，即 $\\|e\\|_{\\infty} = \\mathcal{O}(h_{\\max}^2)$，我们需要两个主要条件：离散算子的稳定性和格式的二阶相容性。\n\n1.  **离散算子的稳定性：** 这要求逆矩阵的范数 $\\|A_h^{-1}\\|_{\\infty}$ 由一个与网格尺寸 $h_{\\max}$ 无关的常数界定。与非均匀网格上的算子 $-D^2$ 对应的矩阵 $A_h$ 是一个三对角矩阵。可以证明它是一个 M-矩阵，因此其逆矩阵的元素非负。对于此类矩阵，如果网格是拟一致的，则通常可以保证稳定性。拟一致性意味着存在一个常数 $\\sigma  0$，使得对于所有相邻区间，$1/\\sigma \\le h_{i+1}/h_i \\le \\sigma$。这个条件防止了非对角元素与对角元素相比变得过大，从而确保算子在 $h_{\\max} \\to 0$ 时保持良态。\n\n2.  **二阶相容性：** 这要求截断误差是二阶的，即 $\\|\\tau\\|_{\\infty} = \\mathcal{O}(h_{\\max}^2)$。根据任务 A，截断误差为\n    $$ \\tau_i = \\frac{h_{i+1} - h_i}{3} u^{(3)}(x_i) + \\frac{h_i^2 - h_i h_{i+1} + h_{i+1}^2}{12} u^{(4)}(x_i) + \\mathcal{O}(h_{\\max}^3) $$\n    第二项是 $\\mathcal{O}(h_{\\max}^2)$ 阶的。然而，第一项 $\\frac{1}{3}(h_{i+1} - h_i)u^{(3)}(x_i)$ 通常是 $\\mathcal{O}(h_{\\max})$ 阶的，这使得格式只有一阶精度。由项 $h_{i+1} - h_i$ 所描述的“局部对称性”在这里起着关键作用。为了使格式达到二阶相容，这个主误差项必须降至 $\\mathcal{O}(h_{\\max}^2)$。如果网格间距平滑变化，即对于某个常数 $C$ 和所有的 $i$ 满足条件 $|h_{i+1} - h_i| \\le C h_{\\max}^2$，就可以实现这一点。如果此条件成立，格式就变为二阶相容。均匀网格（$h_{i+1} = h_i$）是一个不言自明地满足此条件的特例。\n\n3.  **解的正则性：** 截断误差及其界的推导假设解 $u(x)$ 足够光滑。$\\tau_i$ 的表达式涉及 $u^{(3)}$ 和 $u^{(4)}$。为了使这些项在整个定义域 $[0,1]$ 上有良好定义且有界，我们要求 $u \\in C^4([0,1])$。根据微分方程 $-u''=f$，标准的椭圆正则性理论表明，如果源项 $f(x)$ 属于 $C^2([0,1])$，那么解 $u(x)$ 将属于 $C^4([0,1])$。\n\n总而言之，要实现 $\\|u - u_h\\|_{\\infty} = \\mathcal{O}(h_{\\max}^2)$ 的全局误差，充分条件如下：\n(a) 解具有足够的正则性，$u \\in C^4([0,1])$，如果 $f \\in C^2([0,1])$，则此条件可得到保证。\n(b) 离散算子是稳定的，这可以通过拟一致网格条件 $\\exists \\sigma: h_{i+1}/h_i \\le \\sigma$ 来保证。\n(c) 网格是平滑变化的，使得 $|h_{i+1} - h_i| = \\mathcal{O}(h_{\\max}^2)$。",
            "answer": "$$\\boxed{\\frac{h_{i+1} - h_i}{3} u^{(3)}(x_i) + \\frac{h_i^2 - h_i h_{i+1} + h_{i+1}^2}{12} u^{(4)}(x_i)}$$"
        },
        {
            "introduction": "理论分析的最终目的是指导实际计算。本练习  将理论付诸实践，要求你为一个具有挑战性的奇异摄动问题编写代码，该问题解中存在一个陡峭的边界层。你将设计并实现一种“层适应网格”来捕捉这一特征，并使用稳定的迎风格式进行离散化。此练习的核心任务是量化边界层区域内的局部截断误差与解在 $H^1$ 范数下的全局误差之间的关系，从而深刻理解在数值求解中，关键区域的局部精度如何直接影响解的整体质量。",
            "id": "3416719",
            "problem": "考虑在单位区间 $[0,1]$ 上的奇异摄动对流扩散边值问题，由常微分方程 $-\\varepsilon u''(x) + u'(x) = 0$ 和 Dirichlet 边界条件 $u(0) = 0, u(1) = 1$ 给出，其中 $\\varepsilon \\in (0,1]$ 是一个小的正参数。该问题的解存在一个边界层，其位置和宽度由扩散和对流之间的平衡决定。您的任务是设计由分级参数 $\\beta > 0$ 参数化的层适应网格，在得到的非均匀网格上用一个稳定格式离散化算子，并量化当 $\\varepsilon \\to 0$ 时，边界层区域中的最大局部截断误差相对于在 Sobolev 空间 $H^1$（其函数及一阶导数均平方可积的 Sobolev 空间）中度量的全局误差的尺度关系。\n\n使用以下基本定义和要求来构建您的推导和算法：\n\n- 网格设计：对于给定的正整数 $N$（区间数）和分级参数 $\\beta > 0$，通过 $x_i = 1 - \\left(1 - \\frac{i}{N}\\right)^\\beta$（$i=0,1,\\dots,N$）定义节点 $\\{x_i\\}_{i=0}^N$。网格宽度为 $h_i = x_i - x_{i-1}$（$i=1,\\dots,N$）。当 $\\beta > 1$ 时，该网格将节点聚集在 $x=1$ 附近；当 $\\beta = 1$ 时，网格是均匀的。\n\n- 离散格式：在非均匀网格上，使用一阶迎风后向差分 $D^{(1)} u_i = \\frac{u_i - u_{i-1}}{h_i}$ 在内节点 $x_i$ ($i=1,\\dots,N-1$) 处离散化 $u'(x)$，并使用非均匀网格上的标准三点二阶导数离散化 $u''(x)$：\n$$\nD^{(2)} u_i = \\frac{2}{h_i + h_{i+1}}\\left(\\frac{u_{i+1} - u_i}{h_{i+1}} - \\frac{u_i - u_{i-1}}{h_i}\\right), \\quad i=1,\\dots,N-1.\n$$\n离散算子为 $L_h u_i = -\\varepsilon D^{(2)} u_i + D^{(1)} u_i$。施加 Dirichlet 条件 $u_0 = 0$ 和 $u_N = 1$。\n\n- 局部截断误差：对于每个内节点 $x_i$，局部截断误差定义为将精确解 $u$ 代入离散算子 $L_h$：$\\tau_i = L_h u_i$。为了量化边界层的影响，将边界层区域定义为 $\\{x \\in [0,1]: x \\ge 1 - c\\varepsilon\\}$（其中 $c = 3$），并计算 $\\max_{i: x_i \\ge 1 - 3\\varepsilon} |\\tau_i|$。\n\n- $H^1$ 中的全局误差：设 $u_h$ 为离散解，其连续表示是网格上的分段线性插值。通过误差 $e = u - u_h$ 的 $H^1$ 半范数来度量全局误差，即\n$$\n\\|e\\|_{H^1} = \\left(\\int_0^1 |u'(x) - u_h'(x)|^2 \\, dx\\right)^{1/2}.\n$$\n此处 $u_h'(x)$ 是在每个区间 $[x_{i-1}, x_i]$ 上的恒定斜率，由 $\\frac{u_i - u_{i-1}}{h_i}$ 给出。\n\n- 推导的基本依据：从微分方程 $-\\varepsilon u'' + u' = 0$、局部截断误差（定义为精确解在离散算子中的残差）的定义以及 $H^1$ 半范数的定义出发。您可以使用已有的泰勒展开和迎风离散格式的稳定性性质，但不要假设任何预先推导的离散误差界；请从第一性原理推导尺度关系。\n\n实现一个程序，该程序：\n1. 为给定的 $(\\varepsilon, \\beta, N)$ 构建分级网格，\n2. 使用指定的离散格式组装并求解线性系统以获得离散解 $u_h$，\n3. 通过将精确解 $u$ 代入 $L_h$ 来计算边界层区域 $\\{x_i \\ge 1 - 3\\varepsilon\\}$ 内的最大绝对局部截断误差，\n4. 通过在每个区间上对导数差的平方进行积分，来计算全局 $H^1$ 半范数误差 $\\|e\\|_{H^1}$，\n5. 对于每个测试用例，返回比率 $R = \\|e\\|_{H^1} / \\left(\\max_{i: x_i \\ge 1 - 3\\varepsilon} |\\tau_i|\\right)$ 作为一个浮点数。\n\n您的程序必须使用从微分方程和边界条件获得的精确解来评估局部截断误差和 $H^1$ 误差。对于小的 $\\varepsilon$ 值，它必须是数值稳定的。\n\n测试套件：\n- 使用以下参数三元组 $(\\varepsilon, \\beta, N)$：\n  - $(0.1, 1, 200)$，\n  - $(0.1, 4, 200)$，\n  - $(0.05, 1, 300)$，\n  - $(0.05, 4, 300)$，\n  - $(0.02, 1, 600)$，\n  - $(0.02, 4, 300)$。\n这些测试用例涵盖了一般情况、强分级以及边界层更尖锐的较小 $\\varepsilon$ 值的情况。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5,r_6]$），其中每个 $r_k$ 是为上述第 $k$ 个测试用例计算的比率 $R$。",
            "solution": "该问题要求对一个奇异摄动对流扩散边值问题进行全面的分析和实现。这包括推导精确解，在层适应网格上使用指定格式建立离散系统，并计算两种不同的误差度量：边界层内的最大局部截断误差和全局 $H^1$ 半范数误差。最终目标是计算这两个误差量之比。\n\n首先，我们处理连续问题。控制常微分方程为：\n$$-\\varepsilon u''(x) + u'(x) = 0, \\quad x \\in (0,1)$$\n边界条件为 $u(0)=0$ 和 $u(1)=1$。这里，$\\varepsilon \\in (0,1]$ 是摄动参数。这是一个线性、二阶、常系数常微分方程。其特征方程为 $-\\varepsilon r^2 + r = 0$，解得根为 $r_1=0$ 和 $r_2=1/\\varepsilon$。因此，通解的形式为 $u(x) = C_1 e^{0 \\cdot x} + C_2 e^{x/\\varepsilon} = C_1 + C_2 e^{x/\\varepsilon}$。\n\n应用边界条件求待定常数 $C_1$ 和 $C_2$：\n$u(0) = 0 \\implies C_1 + C_2 = 0 \\implies C_1 = -C_2$。\n$u(1) = 1 \\implies C_1 + C_2 e^{1/\\varepsilon} = 1$。\n将第一个结果代入第二个，得到 $-C_2 + C_2 e^{1/\\varepsilon} = 1$，这意味着 $C_2(e^{1/\\varepsilon} - 1) = 1$。因此，$C_2 = (e^{1/\\varepsilon} - 1)^{-1}$ 且 $C_1 = -(e^{1/\\varepsilon} - 1)^{-1}$。\n\n精确解析解为：\n$$u(x) = \\frac{e^{x/\\varepsilon} - 1}{e^{1/\\varepsilon} - 1}$$\n对于较小的 $\\varepsilon$，该解的特征是在 $x=1$ 附近存在一个尖锐的边界层，函数值从接近 $0$ 迅速变化到 $1$。为避免在 $\\varepsilon$ 很小时计算该函数时出现数值溢出，我们可以将其重写为：\n$$u(x) = \\frac{e^{(x-1)/\\varepsilon} - e^{-1/\\varepsilon}}{1 - e^{-1/\\varepsilon}}$$\n求解误差分析所需的一阶和二阶导数如下：\n$$u'(x) = \\frac{1}{\\varepsilon} \\frac{e^{x/\\varepsilon}}{e^{1/\\varepsilon}-1} \\quad \\text{和} \\quad u''(x) = \\frac{1}{\\varepsilon^2} \\frac{e^{x/\\varepsilon}}{e^{1/\\varepsilon}-1}$$\n在边界层内部，这些导数的值非常大。\n\n接下来，我们定义数值格式。使用一个包含 $N+1$ 个节点 $\\{x_i\\}_{i=0}^N$ 的层适应网格对区域 $[0,1]$ 进行离散化，节点定义为：\n$$x_i = 1 - \\left(1 - \\frac{i}{N}\\right)^\\beta, \\quad i=0, 1, \\dots, N$$\n其中 $\\beta > 0$ 是一个分级参数。当 $\\beta > 1$ 时，该网格将节点集中在 $x=1$ 附近，这对于解析边界层是必要的。网格步长为 $h_i = x_i - x_{i-1}$（$i=1, \\dots, N$）。\n\n在每个内节点 $x_i$ ($i=1, \\dots, N-1$) 处，使用指定的有限差分算子离散化微分算子：\n$$L_h u_i = -\\varepsilon D^{(2)} u_i + D^{(1)} u_i = 0$$\n其中 $D^{(1)}$ 是一阶迎风差分，$D^{(2)}$ 是非均匀网格上二阶导数的中心差分：\n$$D^{(1)} u_i = \\frac{u_i - u_{i-1}}{h_i}$$\n$$D^{(2)} u_i = \\frac{2}{h_i + h_{i+1}}\\left(\\frac{u_{i+1} - u_i}{h_{i+1}} - \\frac{u_i - u_{i-1}}{h_i}\\right)$$\n将这些代入离散方程 $L_h u_i = 0$，可为每个内节点生成一个线性方程，从而为未知节点值 $\\{u_i\\}_{i=1}^{N-1}$ 形成一个三对角系统。该系统可写作 $A \\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$。三对角矩阵 $A$ 的元素和右端向量 $\\mathbf{b}$ 由 $u_{i-1}, u_i, u_{i+1}$ 的系数以及边界条件 $u_0=0, u_N=1$ 确定。对于一个内节点 $x_i$，方程为：\n$$ \\left(-\\frac{1}{h_i} - \\frac{2\\varepsilon}{h_i(h_i+h_{i+1})}\\right) u_{i-1} + \\left(\\frac{1}{h_i} + \\frac{2\\varepsilon}{h_i h_{i+1}}\\right) u_i + \\left(-\\frac{2\\varepsilon}{h_{i+1}(h_i+h_{i+1})}\\right) u_{i+1} = 0 $$\n由于边界条件，第一个方程（$i=1$）涉及 $u_0=0$，最后一个方程（$i=N-1$）涉及 $u_N=1$，后者会贡献到右端向量 $\\mathbf{b}$ 中。这个三对角系统可以被高效求解。得到的向量 $\\mathbf{u}$ 与边界值结合，给出完整的离散解 $u_h = [u_0, u_1, \\dots, u_{N-1}, u_N]^T$。\n\n内节点 $x_i$ 处的局部截断误差（LTE）定义为将精确解 $u(x)$ 应用于离散算子时产生的残差：\n$$\\tau_i = L_h u(x_i) = -\\varepsilon D^{(2)} u(x_i) + D^{(1)} u(x_i)$$\n这通过在必要的节点（$x_{i-1}, x_i, x_{i+1}$）上计算解析解 $u(x)$ 的值，并将这些值代入离散算子公式来计算。问题要求计算边界层区域 $\\{x \\in [0,1] : x \\ge 1-3\\varepsilon\\}$ 内的最大绝对局部截断误差：\n$$\\max_{\\text{layer}} |\\tau| = \\max_{i: x_i \\ge 1-3\\varepsilon} |\\tau_i|$$\n\n全局误差在 $H^1$ 半范数中度量，它量化了精确解 $u(x)$ 和数值解 $u_h(x)$ 的导数之间的差异。数值解表示为网格上的连续分段线性插值。其导数 $u_h'(x)$ 是分段常数：在每个区间 $[x_{i-1}, x_i]$ 上，$u_h'(x) = (u_i-u_{i-1})/h_i$。误差 $e=u-u_h$ 的 $H^1$ 半范数的平方为：\n$$\\|e\\|_{H^1}^2 = \\int_0^1 |u'(x) - u_h'(x)|^2 dx = \\sum_{i=1}^N \\int_{x_{i-1}}^{x_i} \\left| u'(x) - \\frac{u_i - u_{i-1}}{h_i} \\right|^2 dx$$\n每个子区间 $[x_{i-1}, x_i]$ 上的积分可以通过展开平方并逐项积分来解析计算：\n$$\\int_{x_{i-1}}^{x_i} \\left( (u'(x))^2 - 2\\frac{u_i-u_{i-1}}{h_i}u'(x) + \\left(\\frac{u_i-u_{i-1}}{h_i}\\right)^2 \\right) dx$$\n涉及 $u'(x)$ 和 $(u'(x))^2$ 的积分使用这些导数的精确公式计算。具体地，使用 $u'(x)^2 = \\frac{1}{\\varepsilon^2} \\frac{e^{2(x-1)/\\varepsilon}}{(1-e^{-1/\\varepsilon})^2}$ 的数值稳定形式：\n$$\\int_{x_{i-1}}^{x_i} (u'(x))^2 dx = \\frac{1}{2\\varepsilon(1-e^{-1/\\varepsilon})^2} \\left[ e^{2(x_i-1)/\\varepsilon} - e^{2(x_{i-1}-1)/\\varepsilon} \\right]$$\n$$\\int_{x_{i-1}}^{x_i} u'(x) dx = u(x_i) - u(x_{i-1})$$\n将所有区间的结果相加并取平方根，即可得到最终的全局误差 $\\|e\\|_{H^1}$。\n\n最后一步是为每组参数 $(\\varepsilon, \\beta, N)$ 计算比率 $R = \\|e\\|_{H^1} / \\max_{\\text{layer}} |\\tau|$。这个比率揭示了格式在区域中最具挑战性部分所产生的局部误差与由此产生的能量范数下的全局误差之间的关系。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main solver function to compute error ratios for the given test cases.\n    \"\"\"\n    test_cases = [\n        (0.1, 1, 200),\n        (0.1, 4, 200),\n        (0.05, 1, 300),\n        (0.05, 4, 300),\n        (0.02, 1, 600),\n        (0.02, 4, 300),\n    ]\n\n    results = []\n    for eps, beta, N in test_cases:\n        ratio = compute_error_metrics(eps, beta, N)\n        results.append(ratio)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_error_metrics(eps, beta, N):\n    \"\"\"\n    Computes local and global errors and their ratio for one set of parameters.\n    \"\"\"\n    # 1. Mesh generation\n    i_vals = np.arange(N + 1)\n    x = 1 - (1 - i_vals / N)**beta\n    \n    # h[i] corresponds to the mathematical h_i = x_i - x_{i-1}\n    h = np.zeros(N + 1)\n    h[1:] = x[1:] - x[:-1]\n\n    # 2. Assemble and solve the linear system for the discrete solution u_h\n    # A*u = b for unknowns u_1, ..., u_{N-1}\n    num_unknowns = N - 1\n    lower = np.zeros(num_unknowns - 1)\n    main = np.zeros(num_unknowns)\n    upper = np.zeros(num_unknowns - 1)\n    b = np.zeros(num_unknowns)\n    \n    u_0, u_N = 0.0, 1.0\n\n    for i in range(1, N):  # Iterate over interior nodes x_1, ..., x_{N-1}\n        h_i = h[i]\n        h_i_plus_1 = h[i+1]\n        \n        # Coefficients for equation at node i: a*u_{i-1} + b*u_i + c*u_{i+1} = 0\n        a_coeff = -1/h_i - 2*eps / (h_i * (h_i + h_i_plus_1))\n        b_coeff = 1/h_i + 2*eps / (h_i * h_i_plus_1)\n        c_coeff = -2*eps / (h_i_plus_1 * (h_i + h_i_plus_1))\n\n        j = i - 1  # Matrix row index (0 to N-2)\n        main[j] = b_coeff\n        if i  1:\n            lower[j-1] = a_coeff\n        if i  N-1:\n            upper[j] = c_coeff\n\n    # Apply boundary conditions to the RHS vector b\n    # For i=1, a_1*u_0 = 0 since u_0=0. So b[0] stays 0.\n    # For i=N-1, we need the c_coeff from the last iteration\n    b[num_unknowns-1] = -c_coeff * u_N\n\n    # Solve the tridiagonal system using scipy's banded solver\n    ab = np.zeros((3, num_unknowns))\n    ab[0, 1:] = upper\n    ab[1, :] = main\n    ab[2, :-1] = lower\n    u_internal = solve_banded((1, 1), ab, b)\n    \n    u_h = np.concatenate(([u_0], u_internal, [u_N]))\n\n    # 3. Compute local truncation error\n    def u_exact_func(x_vals, eps_val):\n        # Numerically stable form of the exact solution\n        term1 = np.exp((x_vals - 1) / eps_val)\n        term2 = np.exp(-1 / eps_val)\n        return (term1 - term2) / (1 - term2)\n\n    taus = np.zeros(num_unknowns)\n    layer_indices = []\n    layer_threshold = 1 - 3 * eps\n\n    for i in range(1, N): # Interior nodes\n        h_i = h[i]\n        h_i_plus_1 = h[i+1]\n        \n        u_vals = u_exact_func(x[i-1:i+2], eps)\n        u_im1, u_i, u_ip1 = u_vals[0], u_vals[1], u_vals[2]\n        \n        D1_u = (u_i - u_im1) / h_i\n        D2_u = (2 / (h_i + h_i_plus_1)) * ((u_ip1 - u_i) / h_i_plus_1 - (u_i - u_im1) / h_i)\n        \n        j = i - 1 # Index for taus array\n        taus[j] = -eps * D2_u + D1_u\n        \n        if x[i] = layer_threshold:\n            layer_indices.append(j)\n\n    if not layer_indices:\n        max_tau_in_layer = np.nan\n    else:\n        max_tau_in_layer = np.max(np.abs(taus[layer_indices]))\n\n    # 4. Compute global H1 seminorm error\n    def u_prime_sq_integral(xa, xb, eps_val):\n        # Integral of (u'(x))^2 over [xa, xb]\n        D_sq = (1 - np.exp(-1 / eps_val))**2\n        if D_sq == 0: return np.inf\n        const = 1 / (2 * eps_val * D_sq)\n        term_b = np.exp(2 * (xb - 1) / eps_val)\n        term_a = np.exp(2 * (xa - 1) / eps_val)\n        return const * (term_b - term_a)\n        \n    h1_error_sq = 0.0\n    for i in range(1, N + 1):  # Loop over intervals [x_{i-1}, x_i]\n        h_i = h[i]\n        xa, xb = x[i-1], x[i]\n        \n        c_i = (u_h[i] - u_h[i-1]) / h_i\n        int_u_prime = u_exact_func(xb, eps) - u_exact_func(xa, eps)\n        int_u_prime_sq = u_prime_sq_integral(xa, xb, eps)\n        int_c_sq = c_i**2 * h_i\n        \n        interval_error_sq = int_u_prime_sq - 2*c_i*int_u_prime + int_c_sq\n        h1_error_sq += interval_error_sq\n        \n    global_h1_error = np.sqrt(h1_error_sq)\n\n    # 5. Compute and return the ratio\n    if max_tau_in_layer == 0:\n        return np.inf if global_h1_error  0 else 0.0\n    return global_h1_error / max_tau_in_layer\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}