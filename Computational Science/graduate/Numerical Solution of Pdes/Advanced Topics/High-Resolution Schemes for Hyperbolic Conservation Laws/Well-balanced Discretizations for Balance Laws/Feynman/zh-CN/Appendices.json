{
    "hands_on_practices": [
        {
            "introduction": "检验守恒律数值格式的一个基本标准是其能否精确维持重要的物理稳态。对于浅水方程，最关键的稳态之一是“静止湖泊”状态，其中流体静止不动，水平面平坦。本练习将引导你通过直接的代数推导，对比一个简单的“朴素”离散格式与一个精心设计的“适定平衡”格式，亲手揭示为何前者会产生虚假的数值扰动，而后者能够完美地保持静水平衡 。",
            "id": "3462989",
            "problem": "考虑具有底部地形的一维浅水方程 (SWE) 的守恒形式偏微分方程 (PDE)：\n$$\nh_{t} + (hu)_{x} = 0, \\qquad (hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x},\n$$\n其中 $h$ 是水深，$u$ 是速度，$g$ 是重力加速度，$b(x)$ 是底部高程。静止湖泊稳态定义为 $u(x) \\equiv 0$ 且 $\\eta(x) \\equiv h(x) + b(x) \\equiv H$，其中 $H$ 为一个常数。\n\n在一个具有单元中心 $x_i$ 和间距 $\\Delta x$ 的均匀网格上，考虑动量方程的有限体积离散化，其中静水压力项的界面数值通量在静止湖泊条件下（即 $u \\equiv 0$）基于分片常数单元状态进行计算，具体如下：\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right), \\qquad F_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right),\n$$\n并将单元 $i$ 中动量方程的离散残差定义为\n$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i},\n$\n具有两种不同的源项离散化：\n- 朴素的逐点源项计算：\n$$\nS_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n- 一种良好平衡的离散化，它使用相邻水深的中心平均值乘以底部斜率的中心差分：\n$$\nS_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n\n假设为静止湖泊状态，其中对所有 $j \\in \\{i-1, i, i+1\\}$ 都有 $h_{j} = H - b_{j}$。请用 $g$、$\\Delta x$ 和局部水深测量样本 $b_{i-1}$、$b_{i}$、$b_{i+1}$ 来推导离散残差 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$。将您的最终结果以行矩阵 $\\bigl(R_{i}^{\\mathrm{naive}} \\;\\; R_{i}^{\\mathrm{wb}}\\bigr)$ 的形式给出，并尽可能简化。不要包含任何单位，也不要进行近似；请给出精确的解析表达式。",
            "solution": "在尝试求解之前，对问题陈述进行严格验证。\n\n### 第 1 步：提取已知条件\n- **控制方程 (浅水方程):**\n$$\nh_{t} + (hu)_{x} = 0\n$$\n$$\n(hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x}\n$$\n- **变量：**$h$ 是水深，$u$ 是速度，$g$ 是重力加速度，$b(x)$ 是底部高程。\n- **稳态条件 (静止湖泊)：**$u(x) \\equiv 0$ 且 $\\eta(x) \\equiv h(x) + b(x) \\equiv H$，其中 $H$ 是一个常数。\n- **离散化：**具有单元中心 $x_{i}$ 和间距 $\\Delta x$ 的均匀网格。\n- **界面通量 (静水压力项)：**\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right)\n$$\n$$\nF_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right)\n$$\n- **离散残差：**\n$$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}\n$$\n- **源项离散化：**\n  - 朴素：$S_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n  - 良好平衡：$S_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n- **计算条件：**静止湖泊条件在离散层面上成立，即对于所有相关单元索引 $j$，有 $h_{j} = H - b_{j}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n评估问题的有效性。\n- **科学依据：**该问题使用浅水方程，这是流体动力学中的一个标准模型。所提出的数值方法（有限体积法、良好平衡格式）是计算物理和偏微分方程数值分析中的既定概念。该问题是验证格式良好平衡性质的标准练习。它在科学上和数学上都是合理的。\n- **适定性：**该任务是基于一套完整的给定公式和条件的直接代数推导。保证结果唯一。\n- **客观性：**该问题使用精确的数学语言表述，没有歧义或主观因素。\n\n### 第 3 步：结论与行动\n该问题是**有效**的。将提供完整解答。\n\n### 解题推导\n目标是在静止湖泊条件下计算离散残差 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$。两种残差共享相同的通量散度项，但在源项离散化上有所不同。\n\n首先，我们分析对残差的通量散度贡献，这对两种情况是相同的。该项离散化了压力梯度 $\\left(\\frac{1}{2}gh^2\\right)_x$，由下式给出：\n$$\n-\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} = -\\frac{1}{\\Delta x} \\left[ \\frac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right) - \\frac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right) \\right]\n$$\n简化括号内的表达式：\n$$\n-\\frac{g}{4\\Delta x} \\left[ (h_{i}^{2} + h_{i+1}^{2}) - (h_{i-1}^{2} + h_{i}^{2}) \\right] = -\\frac{g}{4\\Delta x} \\left(h_{i+1}^{2} - h_{i-1}^{2}\\right)\n$$\n该项表示作用在单元 $i$ 上的净压力。\n\n现在，我们在静止湖泊条件下（对任意索引 $j$ 都有 $h_{j} = H - b_{j}$）计算这个表达式。\n$$\nh_{i+1}^{2} - h_{i-1}^{2} = (H - b_{i+1})^{2} - (H - b_{i-1})^{2}\n$$\n展开平方项：\n$$\n= (H^{2} - 2Hb_{i+1} + b_{i+1}^{2}) - (H^{2} - 2Hb_{i-1} + b_{i-1}^{2})\n$$\n$$\n= 2H(b_{i-1} - b_{i+1}) + b_{i+1}^{2} - b_{i-1}^{2}\n$$\n对平方差 $b_{i+1}^{2} - b_{i-1}^{2} = (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})$ 进行因式分解，并注意到 $b_{i-1} - b_{i+1} = -(b_{i+1} - b_{i-1})$：\n$$\n= -2H(b_{i+1} - b_{i-1}) + (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})\n$$\n$$\n= (b_{i+1} - b_{i-1}) (b_{i+1} + b_{i-1} - 2H)\n$$\n将此代回到通量散度项中：\n$$\n-\\frac{g}{4\\Delta x}(h_{i+1}^{2} - h_{i-1}^{2}) = -\\frac{g}{4\\Delta x} (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)\n$$\n\n现在我们准备好计算每种情况下的总残差。\n\n**1. 朴素离散化 ($R_{i}^{\\mathrm{naive}}$)**\n残差为 $R_{i}^{\\mathrm{naive}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{naive}}$。\n朴素源项为 $S_{i}^{\\mathrm{naive}} = - g h_{i} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$。\n在静止湖泊条件下，$h_{i} = H - b_{i}$，因此源项变为：\n$$\nS_{i}^{\\mathrm{naive}} = -g(H - b_{i}) \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}\n$$\n结合通量项和源项：\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)}{4\\Delta x} - \\frac{g(H - b_{i})(b_{i+1} - b_{i-1})}{2 \\Delta x}\n$$\n提取公因式 $\\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x}$：\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -(b_{i+1} + b_{i-1} - 2H) - 2(H - b_{i}) \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -b_{i+1} - b_{i-1} + 2H - 2H + 2b_{i} \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left( 2b_{i} - b_{i+1} - b_{i-1} \\right)\n$$\n这个表达式可以更有启发性地写为：\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} - 2b_{i} + b_{i-1})}{4\\Delta x}\n$$\n对于非平坦的底部，此残差不为零，这表明朴素格式在静止状态下会产生虚假动量，这是一个已知的数值伪影。\n\n**2. 良好平衡离散化 ($R_{i}^{\\mathrm{wb}}$)**\n残差为 $R_{i}^{\\mathrm{wb}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{wb}}$。\n良好平衡源项为 $S_{i}^{\\mathrm{wb}} = -g \\frac{h_{i+1} + h_{i-1}}{2} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x} = -\\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4 \\Delta x}$。\n总残差为：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1}^{2} - h_{i-1}^{2})}{4\\Delta x} - \\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4\\Delta x}\n$$\n提取公因式 $-\\frac{g}{4\\Delta x}$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1}^{2} - h_{i-1}^{2}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\n使用恒等式 $h_{i+1}^{2} - h_{i-1}^{2} = (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1})$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\n提取公因式 $(h_{i+1} + h_{i-1})$：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) \\right]\n$$\n现在，我们将静止湖泊条件 $h_j = H - b_j$ 应用于方括号中的项：\n$$\n(h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) = \\left( (H - b_{i+1}) - (H - b_{i-1}) \\right) + (b_{i+1} - b_{i-1})\n$$\n$$\n= (-b_{i+1} + b_{i-1}) + (b_{i+1} - b_{i-1}) = 0\n$$\n由于该项恰好为零，整个残差也变为零：\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\times 0 = 0\n$$\n这表明“良好平衡”离散化完美地保持了静止湖泊稳态，因为其残差恒等于零。\n\n最终结果是包含 $R_{i}^{\\mathrm{naive}}$ 和 $R_{i}^{\\mathrm{wb}}$ 简化表达式的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\dfrac{g(b_{i+1}-b_{i-1})(b_{i+1}-2b_{i}+b_{i-1})}{4\\Delta x} & 0 \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在实际的流体模拟中，保持稳态不仅是计算域内部的问题，边界条件的处理也至关重要。不恰当的边界处理同样会破坏平衡，产生非物理的流动。此练习将适定平衡的概念扩展到带有反射壁（即固壁）的边界，要求你分析在静止湖泊条件下边界处的数值通量，并从第一性原理出发，验证为何一个适定平衡的内部格式与特定的“镜像”边界条件相结合，能够在边界单元处也维持静止状态 。",
            "id": "3462951",
            "problem": "考虑带底部地形的一维浅水方程，这是一种典型的自由表面流平衡律，\n$$\n\\partial_{t} U(x,t) + \\partial_{x} F\\!\\left(U(x,t)\\right) = S\\!\\left(U(x,t),\\partial_{x} z(x)\\right),\n$$\n其中守恒变量为 $U=(h,\\,q)^{\\top}$，包括水深 $h(x,t)$ 和流量 $q(x,t)=h(x,t)\\,u(x,t)$，物理通量为\n$$\nF(U) = \\begin{pmatrix} q \\\\ \\dfrac{q^{2}}{h} + \\dfrac{1}{2}\\,g\\,h^{2} \\end{pmatrix},\n$$\n模拟地形 $z(x)$ 上重力的源项为\n$$\nS(U,\\partial_{x}z) = \\begin{pmatrix} 0 \\\\ -\\,g\\,h\\,\\partial_{x} z \\end{pmatrix},\n$$\n其中 $g>0$ 为重力加速度。静湖状态定义为具有恒定的自由表面高程 $\\eta(x)=h(x)+z(x)\\equiv H$ 和零速度 $u(x,t)\\equiv 0$。空间域为河道 $[a,b]$，在 $x=a$ 和 $x=b$ 处为反射（固壁）边界，意味着两个边界处的法向速度为零。\n\n将区域离散化为 $N$ 个宽度为 $\\Delta x$ 的均匀有限体积，单元中心为 $x_{i}$，$i=1,\\dots,N$，并采用一阶有限体积半离散格式\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{i}(t) = -\\,\\frac{1}{\\Delta x}\\,\\Big(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\Big) + S_{i},\n$$\n其中 $F_{i+\\frac{1}{2}}$ 是单元 $i$ 和 $i+1$ 之间界面的两点数值通量，$S_{i}$ 是一个相容的离散源项。数值通量采用 Harten–Lax–van Leer (HLL) 通量，对于左右状态 $U_{L},U_{R}$ 定义为\n$$\nF_{\\mathrm{HLL}}(U_{L},U_{R})=\n\\begin{cases}\nF(U_{L}),  & S_{L}\\ge 0, \\\\\n\\dfrac{S_{R}\\,F(U_{L}) - S_{L}\\,F(U_{R}) + S_{L}\\,S_{R}\\,\\big(U_{R}-U_{L}\\big)}{S_{R}-S_{L}}, & S_{L}<0, S_{R}>0, \\\\\nF(U_{R}),  & S_{R}\\le 0,\n\\end{cases}\n$$\n其中 $c=\\sqrt{g h}$ 为浅水波速，$S_{L} = \\min(u_L - c_L, u_R - c_R)$，$S_{R} = \\max(u_L + c_L, u_R + c_R)$。在边界 $x_{1/2}=a$ 和 $x_{N+1/2}=b$ 处，通过设置虚拟单元来施加反射壁条件，使得在边界处的法向速度为零。具体来说，$U_{0} = (h_{1}, -q_{1})^{\\top}$ 和 $U_{N+1} = (h_{N}, -q_{N})^{\\top}$。\n\n假设一个良态平衡的内部离散格式，即对于任何 $i=2,\\dots,N-1$，如果初始条件 $U(0)$ 是静湖状态，则 $\\frac{\\mathrm{d}}{\\mathrm{d}t}U_i(0)=0$。\n\n您需要计算在 $t=0$ 时刻，区域边界 $x_{1/2}$ 和 $x_{N+1/2}$ 上的数值通量，然后验证这个边界条件与良态平衡的内部离散相结合，在初始时刻不会在邻近边界的单元（即单元 $1$ 和 $N$）中产生伪动。您的最终答案应为一个行向量，其中包含在静湖初始条件下计算出的两个边界通量 $F_{1/2}$ 和 $F_{N+1/2}$ 的分量，形式为\n$$\n\\begin{pmatrix} F_{1/2, h} & F_{1/2, q} & F_{N+1/2, h} & F_{N+1/2, q} \\end{pmatrix}.\n$$",
            "solution": "该问题是适定的，并且在双曲平衡律数值方法的理论中有坚实的科学基础。所有必需的定义和条件都已提供，足以进行完整的分析。\n\n分析按要求分为两部分：首先，在静湖初始条件下计算区域边界上的数值通量；其次，验证这些边界条件与良态平衡的内部离散相结合，在初始时刻不会在邻近边界的单元中产生伪动。\n\n**第1部分：边界数值通量的计算**\n\n我们的任务是计算在 $t=0$ 时刻的数值通量 $F_{1/2} = F_{\\mathrm{HLL}}(U_{0}, U_{1})$ 和 $F_{N+1/2} = F_{\\mathrm{HLL}}(U_{N}, U_{N+1})$。初始条件是静湖状态，意味着速度 $u(x,0) \\equiv 0$，这意味着流量 $q(x,0) = h(x,0)u(x,0) \\equiv 0$。对于离散状态，这意味着对于所有 $i=1, \\dots, N$，$q_{i}(0) = 0$。\n\n**$F_{1/2}$ 的计算**\n左边界界面 $x_{1/2}$ 处的通量由 $F_{1/2} = F_{\\mathrm{HLL}}(U_{L}, U_{R})$ 给出，其中左状态 $U_{L}$ 是虚拟状态 $U_{0}$，右状态 $U_{R}$ 是第一个单元中的状态 $U_{1}$。\n\n虚拟状态由反射壁条件定义：$U_{0} = (h_{1}, -q_{1})^{\\top}$。单元 1 中的状态是 $U_{1} = (h_{1}, q_{1})^{\\top}$。\n\n在初始时刻 $t=0$ 时，我们有 $q_{1}(0) = 0$。因此，在 $x_{1/2}$ 处的黎曼问题的状态是：\n$$\nU_{L} = U_{0}(0)=\\begin{pmatrix} h_{1} \\\\ -0 \\end{pmatrix} = \\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\n$$\nU_{R} = U_{1}(0)=\\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\n左右状态是相同的：$U_{L} = U_{R} = U_{1}(0)$。\n\n当 HLL 通量的输入状态相同时，即 $U_{L}=U_{R}=U$，HLL 通量是相容的，并简化为物理通量 $F(U)$。我们可以从定义中证明这一点。对于状态 $U=(h, 0)^{\\top}$，有 $u=0$，$c=\\sqrt{gh}$，所以信号速度为 $S_L = -\\sqrt{gh} < 0$ 和 $S_R = \\sqrt{gh} > 0$（假设 $h>0$）。因此，应使用HLL公式的中间分支。代入 $U_L=U_R=U$ 和 $F(U_L)=F(U_R)=F(U)$，我们得到：\n$$\nF_{\\mathrm{HLL}}(U,U) = \\frac{S_{R} F(U) - S_{L} F(U) + S_{L} S_{R} (U-U)}{S_{R}-S_{L}} = \\frac{(S_{R}-S_{L})F(U)}{S_{R}-S_{L}} = F(U).\n$$\n因此，边界通量为：\n$$\nF_{1/2} = F(U_1(0)) = F\\left(\\begin{pmatrix} h_1 \\\\ 0 \\end{pmatrix}\\right) = \\begin{pmatrix} 0 \\\\ \\frac{1}{2} g h_1^2 \\end{pmatrix}.\n$$\n\n**$F_{N+1/2}$ 的计算**\n通过对称的论证，右边界界面 $x_{N+1/2}$ 处的状态为 $U_L = U_N(0) = (h_N, 0)^{\\top}$ 和 $U_R = U_{N+1}(0) = (h_N, 0)^{\\top}$。因此，数值通量同样等于物理通量：\n$$\nF_{N+1/2} = F(U_N(0)) = F\\left(\\begin{pmatrix} h_N \\\\ 0 \\end{pmatrix}\\right) = \\begin{pmatrix} 0 \\\\ \\frac{1}{2} g h_N^2 \\end{pmatrix}.\n$$\n\n最终，边界通量的分量为 $(F_{1/2, h}, F_{1/2, q}, F_{N+1/2, h}, F_{N+1/2, q}) = (0, \\frac{1}{2}gh_1^2, 0, \\frac{1}{2}gh_N^2)$。\n\n**第2部分：良态平衡验证**\n问题要求验证这个边界条件在与一个良态平衡的内部格式结合时，不会在边界单元中产生动量。在单元1中，动量方程的离散形式为：\n$$\n\\frac{\\mathrm{d}q_1}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( F_{3/2,q} - F_{1/2,q} \\right) + S_{1,q}\n$$\n我们已计算出 $F_{1/2,q} = \\frac{1}{2}gh_1^2$。良态平衡格式的核心特性是，对于静湖状态，内部通量 $F_{i+1/2}$ 和源项 $S_i$ 的离散化是耦合的，以确保 $\\frac{\\mathrm{d}U_i}{\\mathrm{d}t}=0$。这意味着对于单元1，该格式的设计应确保 $-\\frac{1}{\\Delta x} (F_{3/2,q} - F_{1/2,q}) + S_{1,q}$ 在静湖条件下精确为零。我们在这里的处理方式——通过镜像单元在边界上创建一个静止的黎曼问题——恰好为良态平衡格式提供了其在内部界面上所期望的平衡状态，因此动量更新为零。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{1}{2} g h_{1}^{2} & 0 & \\frac{1}{2} g h_{N}^{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "当平衡律涉及非凸通量函数时，适定平衡格式可能会揭示出更深层次的复杂性，即可能存在多个不同的稳态解。在这种情况下，数值格式本身可能无法唯一确定解，而解的选择则依赖于重构过程。这个高级编程练习将引导你探索这一现象，通过为一个具有非凸通量的模型构造不同的稳态解，并实现代码来量化比较不同重构选择（例如，选择最小或最大根）所导致的截然不同的结果 。",
            "id": "3462931",
            "problem": "考虑一个一维偏微分方程 (PDE) 的标量守恒律\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x),\n$$\n其中 $f$ 为光滑通量函数，$a$ 为源项。如果一个适定平衡的有限体积离散格式，在某个目标稳態族所对应的连续稳態条件成立时，其离散更新恰好为零，且不引入伪瞬态，则称该格式对于此稳態族是精确的。特别地，对于满足\n$$\n\\partial_x f(u(x)) = a(x),\n$$\n的稳態，原始变量 $w(x) \\equiv f(u(x))$ 服从\n$$\n\\partial_x w(x) = a(x),\n$$\n因此 $w$ 可通过对 $a$ 积分确定（相差一个可加常数）。在间距均匀为 $\\Delta x$ 的离散网格中，可通过将离散通量与 $a$ 的一个离散反导数相匹配，来实现对此族稳态的精确适定平衡，从而使得关于网格平均值 $\\{\\bar u_i\\}$ 的离散方程可以伸缩求和。这将稳态条件从 $u$ 提升到了 $w=f(u)$，并且在通量 $f$ 非凸的情况下，引入了从 $w$ 到 $u$ 的多值反演。\n\n你需要通过构造性和定量的方式证明，对于一类非凸通量，精确适定平衡机制能够通过选择用于反演 $w=f(u)$ 的重构方法，来从多个稳態中进行选择。你的任务包含三个部分：\n\n1) 从上述定义和稳态条件出发，推导为何对于一个非凸通量 $f$，在给定 $Q(x)$ 的情况下，条件 $w(x)=f(u(x))=Q(x)$ 会容许多个逐点解 $u(x)$。同时，推导为何一个在 $w$ 上精确适定平衡的离散格式对于在每个网格点上选择反函数 $f^{-1}$ 的哪个分支是无差异的。解释重构的选择如何构成了在容许稳态中的一种选择机制。\n\n2) 对于特定的非凸通量\n$$\nf(u) = u^3 - u,\n$$\n和源项\n$$\na(x) \\equiv 0,\n$$\n稳态满足 $f(u(x)) \\equiv Q(x)$，其中 $Q$ 是常数或空间变化的函数。对于此通量，当 $Q$ 位于区间\n$$\n\\left(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}}\\right),\n$$\n内时，代数方程 $u^3 - u = Q$ 有三个不同的实根，而在此区间外只有一个实根。定义两个重构算子，将给定的 $Q$ 映射到一个逐点稳态 $u$：\n- $\\mathcal{R}_{\\mathrm{L}}(Q)$ 选择 $u^3 - u = Q$ 的最小实根。\n- $\\mathcal{R}_{\\mathrm{R}}(Q)$ 选择 $u^3 - u = Q$ 的最大实根。\n当只有一个实根时，$\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$ 都返回该唯一根。\n\n3) 实现一个完整的、可运行的程序，该程序在区间 $[0,1]$ 上使用包含 $N$ 个网格的均匀网格（网格中心为 $x_i = (i+1/2)\\Delta x$，$\\Delta x = 1/N$），构建以下四个稳态测试（角度必须以弧度为单位）：\n- 测试 A (理想情况，最大程度非唯一): $Q(x)\\equiv 0$。\n- 测试 B (多根但有偏): $Q(x)\\equiv 0.3$。\n- 测试 C (单根情形): $Q(x)\\equiv 0.5$。\n- 测试 D (在多根情形内空间变化): $Q(x)=0.35\\sin(2\\pi x)$。\n\n对每个测试，计算两个重构的稳态\n$$\nu^{\\mathrm{L}}_i = \\mathcal{R}_{\\mathrm{L}}(Q(x_i)), \\quad u^{\\mathrm{R}}_i = \\mathcal{R}_{\\mathrm{R}}(Q(x_i)),\n$$\n然后报告以下三个浮点数：\n- 算术平均值 $\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$。\n- 算术平均值 $\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$。\n- 差值的离散 $L^2$-范数，定义为\n$$\n\\left\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\right\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} \\left(u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i\\right)^2}。\n$$\n\n你的程序必须：\n- 使用 $N=200$。\n- 通过稳健的三次方程代数公式精确计算 $u^3-u=Q$ 的实根（禁止访问外部网络或文件）。\n- 实现上文定义的 $\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$。\n- 生成单行输出，按 A, B, C, D 的顺序包含所有测试的结果，每个测试贡献一个按上述顺序排列的三元浮点数组，并汇集成一个扁平列表。即，最终输出必须是形如\n$$\n[\\overline{u}^{\\mathrm{L}}_{\\mathrm{A}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{A}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{A}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{B}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{B}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{B}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{C}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{C}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{C}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{D}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{D}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{D}}]\n$$\n的单行，无空格，其中所有角度均以弧度为单位，所有量均为无量纲实数。\n\n设计实现时应确保每个测试都是可复现且数值稳定的。最终打印的列表必须是程序的唯一输出。输出值为浮点数，不涉及单位。程序不得接受任何输入。数值结果应反映由 $\\mathcal{R}_{\\mathrm{L}}$ 与 $\\mathcal{R}_{\\mathrm{R}}$ 引起的分支选择差异，包括在单根情形下的一致性以及在存在三个实根时的差异性。",
            "solution": "所述问题在科学上是合理的，数学上是适定的，并为定量演示提供了一套完整的规范。它植根于双曲守恒律数值方法的既有理论，特别关注适定平衡格式以及由非凸通量函数带来的挑战。定义精确，参数无歧义，所需计算也已明确界定。因此，该问题是有效的，下面给出完整解法。\n\n问题的核心在于连续偏微分方程理论与离散数值近似的交叉点。我们需要证明一个为某稳态族设计的“适定平衡”数值格式，为何会看似矛盾地容许多个不同的离散解，以及如何解决这种模糊性。\n\n### 第一部分：适定平衡原理与非凸性\n\n我们从一维标量守恒律开始：\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x)\n$$\n此处，$u(x,t)$ 是一个守恒量，$f(u)$ 是通量函数，$a(x)$ 是一个与空间相关的源项。根据定义，稳态是一个不随时间变化的解，即 $\\partial_t u = 0$。一个解若要成为稳态，必须满足以下常微分方程：\n$$\n\\partial_x f(u(x)) = a(x)\n$$\n将此方程对 $x$ 积分，得到关于解 $u(x)$ 的一个代数条件：\n$$\nf(u(x)) = \\int a(x) \\, dx + C \\equiv Q(x)\n$$\n其中 $Q(x)$ 是源项 $a(x)$ 的任意一个反导数，积分常数 $C$ 由边界条件确定。这意味着任何稳态解 $u(x)$ 都必须满足 $f(u(x)) = Q(x)$，其中 $Q(x)$ 是某个导数为 $a(x)$ 的函数。\n\n求解此 PDE 的有限体积法将区域离散化为网格单元，并演化网格平均值 $u_i(t)$。一个通用的更新公式为：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\n其中 $F_{i\\pm1/2}$ 是网格界面上的数值通量，$A_i$ 是网格单元 $i$ 中源项的离散表示。如果一个格式在用满足 $\\partial_x f(u) = a(x)$ 的稳态族中的某个状态进行初始化时，其离散更新恰好为零，则称该格式对于此稳态族是**适定平衡 (well-balanced)** 的。也就是说，通量的离散散度必须精确抵消离散源项：\n$$\n\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\n实现此目标的一种强大技术称为**精确适定平衡**，其方法是围绕原始变量 $w(x) = f(u(x))$ 构建格式。设计的数值通量和源项使离散平衡关系成为连续平衡关系的完美模拟。例如，可以定义数值通量 $F_{i+1/2}$ 包含值 $Q(x_{i+1/2})$，以确保通量差值形成伸缩求和，并与源项的一致离散化相匹配，通常为 $A_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} a(x) dx = \\frac{Q(x_{i+1/2}) - Q(x_{i-1/2})}{\\Delta x}$。\n\n问题的症结在于当通量函数 $f(u)$ 是**非凸**的，即其导数 $f'(u)$不是单调的。在这种情况下，反函数 $u = f^{-1}(w)$ 可能是多值的。对于给定的 $w = Q(x)$ 值，可能存在多个不同的 $u$ 值满足 $f(u) = w$。\n\n根据其构造，适定平衡格式只关心 $w=f(u)$ 的平衡。它确保 $\\partial_x w$ 的离散表示与离散源项相匹配。因此，任何满足 $f(u_i) = Q(x_i)$ (对所有 $i$) 的离散解 $\\{u_i\\}$ 都将被完美地保持为稳态。该格式对于在每个网格点 $i$ 上选择 $u_i = f^{-1}(Q(x_i))$ 的哪个可能根是无差异的。\n\n这种无差异性为单个剖面 $Q(x)$ 创造了一个容许稳态族。只有通过施加一个额外的**选择原理**，才能唯一地确定一个特定的稳態。在数值格式的背景下，这种选择是通过重构过程进行的，该过程将底层的平衡数据 $Q(x)$ 映射到一个特定的解剖面 $u(x)$。问题定义了两个这样的重构算子，$\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$，它们分别选择最小和最大的实根。这些算子解决了模糊性，并从可能性的流形中选择了一个唯一的、全局定义的稳态。\n\n### 第二部分：对特定通量 $f(u) = u^3 - u$ 的分析\n\n问题给出了特定的非凸通量 $f(u) = u^3 - u$。为了找到其非可逆区域，我们通过寻找其导数的根来检验其临界点：\n$$\nf'(u) = \\frac{d}{du}(u^3 - u) = 3u^2 - 1 = 0\n$$\n临界点为 $u = \\pm 1/\\sqrt{3}$。在这些局部极值点处的通量值为：\n$$\nf\\left(\\frac{1}{\\sqrt{3}}\\right) = \\left(\\frac{1}{\\sqrt{3}}\\right)^3 - \\frac{1}{\\sqrt{3}} = \\frac{1}{3\\sqrt{3}} - \\frac{1}{\\sqrt{3}} = -\\frac{2}{3\\sqrt{3}}\n$$\n$$\nf\\left(-\\frac{1}{\\sqrt{3}}\\right) = \\left(-\\frac{1}{\\sqrt{3}}\\right)^3 - \\left(-\\frac{1}{\\sqrt{3}}\\right) = -\\frac{1}{3\\sqrt{3}} + \\frac{1}{\\sqrt{3}} = \\frac{2}{3\\sqrt{3}}\n$$\n因此，对于开区间 $(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}})$ 内的任何给定值 $Q$，水平线 $w=Q$ 与 $f(u)$ 的图像相交三次。这意味着方程 $u^3 - u = Q$ 有三个不同的实根。对于 $|Q| > \\frac{2}{3\\sqrt{3}}$，只有一个实根。对于 $|Q| = \\frac{2}{3\\sqrt{3}}$，有两个不同的实根，其中一个重数为二。\n\n重构算子 $\\mathcal{R}_{\\mathrm{L}}(Q)$ 和 $\\mathcal{R}_{\\mathrm{R}}(Q)$ 被定义为选择 $u^3 - u - Q = 0$ 的最小和最大实根。当存在三个不同实根时，$\\mathcal{R}_{\\mathrm{L}}(Q) \\neq \\mathcal{R}_{\\mathrm{R}}(Q)$，导致对于同一个平衡剖面 $Q(x)$ 产生两个不同的稳态解 $u^{\\mathrm{L}}(x)$ 和 $u^{\\mathrm{R}}(x)$。当只存在一个实根时，$\\mathcal{R}_{\\mathrm{L}}(Q) = \\mathcal{R}_{\\mathrm{R}}(Q)$，得到的稳态是唯一的。\n\n### 第三部分：计算实现策略\n\n该任务要求为四个测试用例实现此选择机制。总体计算流程如下：\n\n1.  **离散化**：使用 $N=200$ 个宽度为 $\\Delta x = 1/N$ 的均匀网格单元对空间域 $[0, 1]$ 进行离散化。网格中心为 $x_i = (i+1/2)\\Delta x$，其中 $i=0, 1, \\dots, N-1$。\n\n2.  **平衡剖面生成**：对于四个测试（A, B, C, D）中的每一个，根据指定的 $Q(x)$ 公式生成一个包含 $N$ 个值的向量 $\\{Q_i\\} = \\{Q(x_i)\\}$。\n\n3.  **三次方程求根**：核心组件是一个稳健的求解器，用于求解每个 $Q_i$ 对应的降次三次方程 $u^3 - u - Q_i = 0$ 的实根。这通过实现标准解析公式来完成。该方法取决于与判别式相关的项 $D = Q_i^2/4 - 1/27$ 的符号：\n    -   若 $D > 0$，对应于 $|Q_i| > 2/(3\\sqrt{3})$，存在一个实根，使用卡尔丹公式求解。\n    -   若 $D  0$，对应于 $|Q_i|  2/(3\\sqrt{3})$，存在三个不同的实根，使用三角/韦達替换法求解。\n    -   若 $D = 0$，对应于 $|Q_i| = 2/(3\\sqrt{3})$，存在重根，可以直接计算。\n\n4.  **重构**：对每个 $i$，计算方程 $u^3 - u - Q_i = 0$ 的实根列表并排序。通过分别选择排序后列表的第一个（最小）和最后一个（最大）元素来应用重构算子 $\\mathcal{R}_{\\mathrm{L}}$ 和 $\\mathcal{R}_{\\mathrm{R}}$。这将产生两个解值向量 $u^{\\mathrm{L}}$ 和 $u^{\\mathrm{R}}$，每个向量的大小均为 $N$。\n\n5.  **分析**：对每个测试用例，从重构的解向量中计算以下三个量：\n    -   “左”状态的算术平均值：$\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$。\n    -   “右”状态的算术平均值：$\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$。\n    -   差值的离散 $L^2$-范数：$\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} (u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i)^2}$。\n\n6.  **输出**：将得到的十二个浮点数（四个测试各一个三元组）收集到一个列表中，并按指定格式打印。结果将定量地展示选择机制：对于测试 A、B 和 D，其中 $Q(x)$ 进入多根区域，两个重构解将有所不同，产生非零范数。对于测试 C，其中 $Q(x)$ 处于单根区域，解将是相同的，其差值的范数将为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of reconstructing steady states for a balance law with a nonconvex flux.\n    \"\"\"\n\n    N = 200\n    DX = 1.0 / N\n    x = (np.arange(N) + 0.5) * DX\n    \n    # Define the four test cases for the equilibrium profile Q(x).\n    test_cases = [\n        (\"A\", lambda x_vals: np.full_like(x_vals, 0.0)),\n        (\"B\", lambda x_vals: np.full_like(x_vals, 0.3)),\n        (\"C\", lambda x_vals: np.full_like(x_vals, 0.5)),\n        (\"D\", lambda x_vals: 0.35 * np.sin(2 * np.pi * x_vals)),\n    ]\n\n    all_results = []\n\n    def solve_cubic_real_roots(q_val):\n        \"\"\"\n        Computes the real roots of u^3 - u - q = 0 using analytical formulas.\n        The equation is in depressed cubic form u^3 + p*u + q' = 0 with p=-1, q'=-q_val.\n        \n        The method selection is based on the sign of the discriminant.\n        \"\"\"\n        # Using the formulation for x^3 + px + q = 0\n        p, q_prime = -1.0, -q_val\n        \n        # Discriminant term from Cardano's formula: D = (q'/2)^2 + (p/3)^3\n        d = (q_prime / 2.0)**2 + (p / 3.0)**3\n        \n        # Machine epsilon for floating point comparison\n        epsilon = 1e-12\n\n        if d > epsilon:\n            # One real root\n            term = np.sqrt(d)\n            root = np.cbrt(-q_prime / 2.0 + term) + np.cbrt(-q_prime / 2.0 - term)\n            return [root]\n        elif d  -epsilon:\n            # Three distinct real roots (trigonometric solution)\n            # Roots are 2*sqrt(-p/3)*cos((1/3)*acos((3q')/(2p*sqrt(-p/3))) - 2*pi*k/3) for k=0,1,2\n            term_mul = 2.0 * np.sqrt(-p / 3.0) # 2/sqrt(3)\n            arg_acos = (3.0 * q_prime) / (2.0 * p * np.sqrt(-p / 3.0))\n            \n            # Clip argument to arccos to handle potential floating point inaccuracies\n            arg_acos = np.clip(arg_acos, -1.0, 1.0)\n            \n            phi = np.arccos(arg_acos)\n            \n            root1 = term_mul * np.cos(phi / 3.0)\n            root2 = term_mul * np.cos((phi - 2.0 * np.pi) / 3.0)\n            root3 = term_mul * np.cos((phi + 2.0 * np.pi) / 3.0)\n            \n            return sorted([root1, root2, root3])\n        else: # d is close to zero\n            # Three real roots with at least two equal\n            # For D=0, q_val^2 = 4/27\n            if abs(q_val)  epsilon: # q_prime is also zero\n                return [-1.0, 0.0, 1.0]\n\n            # Roots are 2*A, -A, -A where A = sgn(q_val)/sqrt(3)\n            A = np.sign(q_val) / np.sqrt(3.0)\n            root_single = 2.0*A\n            root_double = -A\n            \n            return sorted([root_single, root_double, root_double])\n\n\n    for test_name, q_func in test_cases:\n        Q_vals = q_func(x)\n        \n        u_L = np.zeros(N)\n        u_R = np.zeros(N)\n\n        for i in range(N):\n            q_i = Q_vals[i]\n            roots = solve_cubic_real_roots(q_i)\n            \n            # R_L selects the smallest real root\n            u_L[i] = roots[0]\n            # R_R selects the largest real root\n            u_R[i] = roots[-1]\n\n        # Compute the required metrics\n        mean_u_L = np.mean(u_L)\n        mean_u_R = np.mean(u_R)\n        l2_diff_norm = np.sqrt(DX * np.sum((u_L - u_R)**2))\n        \n        all_results.extend([mean_u_L, mean_u_R, l2_diff_norm])\n\n    # Format the final output string exactly as specified\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}