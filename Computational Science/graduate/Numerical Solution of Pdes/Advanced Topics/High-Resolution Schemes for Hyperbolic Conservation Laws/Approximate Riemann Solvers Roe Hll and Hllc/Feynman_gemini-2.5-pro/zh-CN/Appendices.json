{
    "hands_on_practices": [
        {
            "introduction": "任何有限体积方法的核心都是计算单元界面处的数值通量。这个练习提供了一个具体的动手实践，用于计算 Harten-Lax-van Leer (HLL) 通量，这是最基本的近似黎曼求解器之一。通过使用给定的左右状态并应用以信号速度 $S_L$ 和 $S_R$ 为界的 HLL 通量公式，本练习将巩固您对 HLL 求解器基本机制的理解，这是实现或理解任何使用 HLL 求解器的代码的第一步。",
            "id": "3364359",
            "problem": "考虑量热完全气体的一维可压缩欧拉方程，其比热比为 $\\gamma$。设界面处的左右状态由原始变量 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$ 给出，相应的守恒变量为 $U=(\\rho,\\rho u,E)$，物理通量为 $F(U)=(\\rho u,\\rho u^2+p,u(E+p))$。假设理想气体声速为 $a=\\sqrt{\\gamma p/\\rho}$。使用 Davis 的波速估计，从左右状态得到左右信号速度 $S_L$ 和 $S_R$。利用这些要素构建界面处的 Harten–Lax–van Leer (HLL) 数值通量。\n\n使用以下具体数据：\n- $\\gamma=1.4$，\n- 左状态 $(\\rho_L,u_L,p_L)=(1.0,20.0,1.0\\times 10^{5})$，\n- 右状态 $(\\rho_R,u_R,p_R)=(0.125,-10.0,1.0\\times 10^{4})$，\n\n其中 $\\rho$ 的单位是 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$，$u$ 的单位是 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，$p$ 的单位是 $\\mathrm{Pa}$。使用 Davis 估计 $S_L=\\min(u_L-a_L,u_R-a_R)$ 和 $S_R=\\max(u_L+a_L,u_R+a_R)$，以及 Harten–Lax–van Leer (HLL) 的数值通量构造方法，计算界面处 HLL 通量的质量通量分量（第一个分量）。\n\n将最终结果四舍五入至四位有效数字，并以 $\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$ 为单位表示。",
            "solution": "该问题要求在给定左右状态并使用 Davis 波速估计的情况下，计算一维欧拉方程的 Harten-Lax-van Leer (HLL) 数值通量的质量通量分量。\n\n守恒形式的一维欧拉方程为 $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0$，其中 $U$ 是守恒变量矢量，$F(U)$ 是物理通量矢量。对于本问题，它们定义如下：\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix}\n$$\n其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力，$E$ 是单位体积的总能量。该问题要求计算 HLL 数值通量的第一个分量，即质量通量。\n\nHLL 数值通量 $F_{HLL}$ 是网格界面处黎曼问题解的近似。它基于左右波速估计 $S_L$ 和 $S_R$ 来定义。HLL 通量的公式为：\n$$\nF_{HLL} = \n\\begin{cases} \nF_L & \\text{if } S_L \\ge 0 \\\\\n\\frac{S_R F_L - S_L F_R + S_L S_R (U_R - U_L)}{S_R - S_L} & \\text{if } S_L < 0 < S_R \\\\\nF_R & \\text{if } S_R \\le 0 \n\\end{cases}\n$$\n其中 $U_L$ 和 $F_L$ 是使用左状态 $(\\rho_L, u_L, p_L)$ 计算的守恒状态和通量矢量，$U_R$ 和 $F_R$ 是使用右状态 $(\\rho_R, u_R, p_R)$ 计算的。\n\n该问题只要求计算质量通量分量，即 $F_{HLL}$ 矢量的第一个分量。我们将任意矢量 $V$ 的第一个分量记为 $V_1$。那么我们有：\n$U_1 = \\rho$\n$F_1 = \\rho u$\n\n首先，我们根据给定的左右状态计算必要的量。\n该气体的比热比 $\\gamma = 1.4$。\n\n**左状态 (L):**\n原始变量：$(\\rho_L, u_L, p_L) = (1.0, 20.0, 1.0 \\times 10^5)$。\n声速 $a_L$ 计算如下：\n$$\na_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{(1.4)(1.0 \\times 10^5)}{1.0}} = \\sqrt{140000} \\approx 374.1657 \\, \\mathrm{m/s}\n$$\n状态和通量矢量的第一个分量为：\n$$\nU_{L,1} = \\rho_L = 1.0 \\, \\mathrm{kg/m^3}\n$$\n$$\nF_{L,1} = \\rho_L u_L = (1.0)(20.0) = 20.0 \\, \\mathrm{kg/(m^2 s)}\n$$\n\n**右状态 (R):**\n原始变量：$(\\rho_R, u_R, p_R) = (0.125, -10.0, 1.0 \\times 10^4)$。\n声速 $a_R$ 计算如下：\n$$\na_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{(1.4)(1.0 \\times 10^4)}{0.125}} = \\sqrt{112000} \\approx 334.6640 \\, \\mathrm{m/s}\n$$\n状态和通量矢量的第一个分量为：\n$$\nU_{R,1} = \\rho_R = 0.125 \\, \\mathrm{kg/m^3}\n$$\n$$\nF_{R,1} = \\rho_R u_R = (0.125)(-10.0) = -1.25 \\, \\mathrm{kg/(m^2 s)}\n$$\n\n接下来，我们使用所提供的 Davis 估计计算波速估计值 $S_L$ 和 $S_R$：\n$$\nS_L = \\min(u_L - a_L, u_R - a_R)\n$$\n$$\nS_R = \\max(u_L + a_L, u_R + a_R)\n$$\n我们计算特征速度：\n$$\nu_L - a_L \\approx 20.0 - 374.1657 = -354.1657 \\, \\mathrm{m/s}\n$$\n$$\nu_R - a_R \\approx -10.0 - 334.6640 = -344.6640 \\, \\mathrm{m/s}\n$$\n$$\nu_L + a_L \\approx 20.0 + 374.1657 = 394.1657 \\, \\mathrm{m/s}\n$$\n$$\nu_R + a_R \\approx -10.0 + 334.6640 = 324.6640 \\, \\mathrm{m/s}\n$$\n现在我们求 $S_L$ 和 $S_R$ 的最小和最大速度：\n$$\nS_L = \\min(-354.1657, -344.6640) = -354.165738... \\, \\mathrm{m/s}\n$$\n$$\nS_R = \\max(394.1657, 324.6640) = 394.165738... \\, \\mathrm{m/s}\n$$\n我们观察到 $S_L  0$ 且 $S_R > 0$。因此，我们必须使用 HLL 通量的中间部分公式。HLL 通量的第一个分量 $F_{HLL,1}$ 为：\n$$\nF_{HLL,1} = \\frac{S_R F_{L,1} - S_L F_{R,1} + S_L S_R (U_{R,1} - U_{L,1})}{S_R - S_L}\n$$\n代入计算出的值：\n$F_{L,1} = 20.0$\n$F_{R,1} = -1.25$\n$U_{L,1} = 1.0$\n$U_{R,1} = 0.125$\n$S_L \\approx -354.1657$\n$S_R \\approx 394.1657$\n\n让我们计算公式中的各项：\n分母为：\n$$\nS_R - S_L \\approx 394.165738 - (-354.165738) = 748.331476 \\, \\mathrm{m/s}\n$$\n分子由三项组成：\n第 1 项：$S_R F_{L,1} \\approx (394.165738)(20.0) = 7883.31476$\n第 2 项：$-S_L F_{R,1} \\approx -(-354.165738)(-1.25) = -442.7071725$\n第 3 项：$S_L S_R (U_{R,1} - U_{L,1})$\n对于这个特定的数据集，$S_L = u_L - a_L$ 且 $S_R = u_L + a_L$。这使得乘积 $S_L S_R$ 简化为 $u_L^2 - a_L^2 = (20.0)^2 - (\\sqrt{140000})^2 = 400 - 140000 = -139600$。\n$$\nS_L S_R (U_{R,1} - U_{L,1}) = (-139600)(0.125 - 1.0) = (-139600)(-0.875) = 122150\n$$\n将分子中的各项相加：\n$$\n\\text{Numerator} \\approx 7883.31476 - 442.7071725 + 122150 = 129590.6075875\n$$\n最后，我们计算通量：\n$$\nF_{HLL,1} = \\frac{129590.6075875}{748.331476} \\approx 173.17646\n$$\n问题要求将结果四舍五入到四位有效数字。\n$$\nF_{HLL,1} \\approx 173.2 \\, \\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\n$$\n所有输入值均采用国际单位制（SI）基本单位，因此所得通量也采用 SI 单位，质量通量的单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{173.2}\n$$"
        },
        {
            "introduction": "在掌握了 HLL 通量的基本计算之后，理解其局限性至关重要。这个实践问题揭示了 HLL 格式的主要缺点之一：它无法精确解析接触间断。通过计算 HLL 模型中间区域的“厚度”，本练习直观地展示了 HLL 如何将接触波涂抹在一个较宽的区域内，而正是这一缺陷推动了 HLLC（Harten-Lax-van Leer-Contact）求解器的发展，后者通过引入额外的接触波速度 $S_{*}$ 来修正这一问题。",
            "id": "3364391",
            "problem": "考虑比热比 $\\gamma = 1.4$ 的理想气体的一维可压缩欧拉方程，其守恒形式写作：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\n其中 $\\boldsymbol{U} = (\\rho, \\rho u, E)^{\\top}$ 且 $\\boldsymbol{F}(\\boldsymbol{U}) = (\\rho u,\\; \\rho u^{2} + p,\\; u(E + p))^{\\top}$。状态方程为 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$。\n\n在 $x=0$ 处设置一个 Sod 型黎曼问题，其左、右状态为\n$$\n(\\rho_{L}, u_{L}, p_{L}) = (1,\\; 0,\\; 1), \\quad (\\rho_{R}, u_{R}, p_{R}) = (0.125,\\; 0,\\; 0.1),\n$$\n单位为无量纲。使用均匀有限体积离散化，网格宽度 $\\Delta x = 1$，间断位于两个网格之间的界面 $x_{1/2} = 0$ 处。使用 $x_{1/2}$ 处的单个黎曼通量计算显式欧拉时间更新，且边界邻近通量等于相应的均匀状态通量。\n\n定义 Courant–Friedrichs–Lewy (CFL) 数为 $\\mathrm{CFL} = 0.5$，并选择时间步长\n$$\n\\Delta t = \\frac{\\mathrm{CFL}\\,\\Delta x}{\\max(|u_{L}| + a_{L},\\, |u_{R}| + a_{R})},\n$$\n其中声速 $a = \\sqrt{\\gamma p / \\rho}$ 在各个状态下分别计算。\n\n$x_{1/2}$ 处的黎曼通量将使用以下方法计算：\n- Harten–Lax–van Leer (HLL) 近似黎曼求解器，其双波速 $S_{L}$ 和 $S_{R}$ 通过 Davis 界估计：$S_{L} = \\min(u_{L} - a_{L},\\, u_{R} - a_{R})$ 和 $S_{R} = \\max(u_{L} + a_{L},\\, u_{R} + a_{R})$。\n- Harten–Lax–van Leer with Contact (HLLC) 近似黎曼求解器，其接触波速 $S_{*}$ 通过与跨越 $S_{L}$ 和 $S_{R}$ 的 Rankine–Hugoniot 条件的一致性获得：\n$$\nS_{*} = \\frac{p_{R} - p_{L} + \\rho_{L} u_{L}(S_{L} - u_{L}) - \\rho_{R} u_{R}(S_{R} - u_{R})}{\\rho_{L}(S_{L} - u_{L}) - \\rho_{R}(S_{R} - u_{R})}.\n$$\n\n对于每种求解器，在 $x_{1/2}$ 处执行显式通量计算，并对两个相邻网格的平均值进行相应的一步更新。将“一个时间步长后的接触间断厚度”定义为求解器波模型中，在时刻 $\\Delta t$ 包含接触波的中间自相似区域的空间宽度：\n- 对于 HLL，这是 $S_{L}$ 和 $S_{R}$ 之间的单个中间区域的宽度，等于 $(S_{R} - S_{L})\\,\\Delta t$。\n- 对于 HLLC，接触是以速度 $S_{*}$ 传播的实际间断，因此在波模型中其几何厚度为零。\n\n使用指定的初始状态和 CFL 选择，计算 HLL 和 HLLC 在一个时间步长后的接触厚度之差，\n$$\n\\Theta \\equiv \\left[(S_{R} - S_{L})\\,\\Delta t\\right] - 0,\n$$\n将最终结果表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "用户希望针对一个特定的一维欧拉方程问题，找出 Harten-Lax-van Leer (HLL) 和 Harten-Lax-van Leer-Contact (HLLC) 近似黎曼求解器之间接触间断厚度 $\\Theta$ 的差异。\n\n首先对问题进行验证。\n\n### 步骤 1：提取给定条件\n- **控制方程**：一维可压缩欧拉方程，$\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0$。\n- **状态和通量矢量**：$\\boldsymbol{U} = (\\rho, \\rho u, E)^{\\top}$, $\\boldsymbol{F}(\\boldsymbol{U}) = (\\rho u, \\rho u^{2} + p, u(E + p))^{\\top}$。\n- **状态方程**：$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$。\n- **比热比**：$\\gamma = 1.4$。\n- **左状态**：$(\\rho_{L}, u_{L}, p_{L}) = (1, 0, 1)$。\n- **右状态**：$(\\rho_{R}, u_{R}, p_{R}) = (0.125, 0, 0.1)$。\n- **离散化**：网格宽度 $\\Delta x = 1$。\n- **时间步进**：$\\mathrm{CFL} = 0.5$, $\\Delta t = \\frac{\\mathrm{CFL}\\,\\Delta x}{\\max(|u_{L}| + a_{L}, |u_{R}| + a_{R})}$。\n- **声速**：$a = \\sqrt{\\gamma p / \\rho}$。\n- **HLL 波速 (Davis 估计)**：$S_{L} = \\min(u_{L} - a_{L}, u_{R} - a_{R})$ 和 $S_{R} = \\max(u_{L} + a_{L}, u_{R} + a_{R})$。\n- **目标量**：$\\Theta = (S_{R} - S_{L})\\Delta t$。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题具有科学依据，因为它涉及计算流体动力学中的标准方程和数值方法（欧拉方程、HLL/HLLC 求解器）。指定的初始条件对应于著名的 Sod 激波管问题，这是一个标准基准测试。所有必要的参数和定义（$\\gamma$、初始状态、$\\Delta x$、$\\mathrm{CFL}$ 以及 $a$、$\\Delta t$、$S_L$、$S_R$ 和 $\\Theta$ 的公式）都已提供，使得问题自成体系且适定。语言客观、精确。该问题并非无足轻重，因为它需要仔细应用所提供的公式，并且它正确地指出了大部分上下文信息（例如 $S_*$ 的公式）对于最终计算并非必要。没有矛盾或事实错误。\n\n### 步骤 3：结论与行动\n该问题有效。将提供一个完整的、有理有据的解答。\n\n### 解题推导\n目标是计算量 $\\Theta$，它被定义为 HLL 中间区域在一个时间步长 $\\Delta t$ 后的空间宽度。其公式为 $\\Theta = (S_{R} - S_{L})\\,\\Delta t$。计算分几个步骤进行。\n\n首先，我们计算左 ($L$) 状态和右 ($R$) 状态的声速 $a$。公式为 $a = \\sqrt{\\gamma p / \\rho}$。\n对于左状态 $(\\rho_{L}, u_{L}, p_{L}) = (1, 0, 1)$ 和 $\\gamma = 1.4$：\n$$\na_{L} = \\sqrt{\\frac{\\gamma p_{L}}{\\rho_{L}}} = \\sqrt{\\frac{1.4 \\times 1}{1}} = \\sqrt{1.4}\n$$\n对于右状态 $(\\rho_{R}, u_{R}, p_{R}) = (0.125, 0, 0.1)$：\n$$\na_{R} = \\sqrt{\\frac{\\gamma p_{R}}{\\rho_{R}}} = \\sqrt{\\frac{1.4 \\times 0.1}{0.125}} = \\sqrt{\\frac{0.14}{0.125}} = \\sqrt{1.12}\n$$\n我们注意到 $1.4 > 1.12$，所以 $a_{L} > a_{R}$。\n\n接下来，我们使用给定的 Courant–Friedrichs–Lewy (CFL) 条件计算时间步长 $\\Delta t$。\n$$\n\\Delta t = \\frac{\\mathrm{CFL}\\,\\Delta x}{\\max(|u_{L}| + a_{L}, |u_{R}| + a_{R})}\n$$\n给定 $\\mathrm{CFL} = 0.5$，$\\Delta x = 1$，以及 $u_{L} = u_{R} = 0$：\n$$\n\\max(|u_{L}| + a_{L}, |u_{R}| + a_{R}) = \\max(a_{L}, a_{R}) = \\max(\\sqrt{1.4}, \\sqrt{1.12}) = \\sqrt{1.4} = a_{L}\n$$\n将这些值代入 $\\Delta t$ 的公式中：\n$$\n\\Delta t = \\frac{0.5 \\times 1}{\\sqrt{1.4}} = \\frac{0.5}{\\sqrt{1.4}}\n$$\n\n现在，我们使用指定的 Davis 估计来计算 HLL 波速 $S_{L}$ 和 $S_{R}$。\n对于最左侧的波速 $S_{L}$：\n$$\nS_{L} = \\min(u_{L} - a_{L}, u_{R} - a_{R}) = \\min(0 - \\sqrt{1.4}, 0 - \\sqrt{1.12}) = \\min(-\\sqrt{1.4}, -\\sqrt{1.12})\n$$\n由于 $\\sqrt{1.4} > \\sqrt{1.12}$，因此 $-\\sqrt{1.4}  -\\sqrt{1.12}$。所以：\n$$\nS_{L} = -\\sqrt{1.4} = -a_{L}\n$$\n对于最右侧的波速 $S_{R}$：\n$$\nS_{R} = \\max(u_{L} + a_{L}, u_{R} + a_{R}) = \\max(0 + \\sqrt{1.4}, 0 + \\sqrt{1.12}) = \\max(\\sqrt{1.4}, \\sqrt{1.12})\n$$\n所以：\n$$\nS_{R} = \\sqrt{1.4} = a_{L}\n$$\n\n最后，我们计算 $\\Theta = (S_{R} - S_{L})\\,\\Delta t$。\n代入我们为 $S_{R}$、$S_{L}$ 和 $\\Delta t$ 找到的表达式：\n$$\n\\Theta = \\left(\\sqrt{1.4} - (-\\sqrt{1.4})\\right) \\left(\\frac{0.5}{\\sqrt{1.4}}\\right) = (2\\sqrt{1.4}) \\left(\\frac{0.5}{\\sqrt{1.4}}\\right)\n$$\n包含 $\\sqrt{1.4}$ 的项相互抵消，得到一个简单的结果：\n$$\n\\Theta = 2 \\times 0.5 = 1\n$$\n这个结果也可以通过符号推导得出。在给定条件 $u_L=u_R=0$ 和 $a_L>a_R$ 下，我们有：\n$S_L = -a_L$\n$S_R = a_L$\n$\\Delta t = \\frac{\\mathrm{CFL}\\,\\Delta x}{a_L}$\n然后，$\\Theta = (S_R - S_L)\\Delta t = (a_L - (-a_L))\\frac{\\mathrm{CFL}\\,\\Delta x}{a_L} = (2a_L)\\frac{\\mathrm{CFL}\\,\\Delta x}{a_L} = 2 \\times \\mathrm{CFL} \\times \\Delta x$。\n代入给定值 $\\mathrm{CFL} = 0.5$ 和 $\\Delta x = 1$ 得到：\n$$\n\\Theta = 2 \\times 0.5 \\times 1 = 1\n$$\n问题要求结果四舍五入到四位有效数字。精确值 $1$ 写为 $1.000$ 以满足此要求。",
            "answer": "$$\n\\boxed{1.000}\n$$"
        },
        {
            "introduction": "理解了近似黎曼求解器的机制以及选择像 HLLC 这样更高级求解器的动机后，下一步是了解它如何融入一个完整的高性能数值格式中。这个问题涉及一个实际的编码练习，要求您将 HLLC 黎曼求解器与高阶的 5 阶加权基本无振荡 (WENO) 重构格式相结合。这种组合是计算流体动力学中用于模拟包含平滑特征和强激波的流场的先进方法的代表，完成此练习将使您对构建有限体积求解器的整个过程有端到端的理解。",
            "id": "3364352",
            "problem": "考虑量热完全气体的一维可压缩欧拉方程，其守恒形式对守恒变量 $U = [\\rho, \\rho u, E]^\\top$ 写为，通量为 $F(U) = [\\rho u, \\rho u^2 + p, u (E + p)]^\\top$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是总能量密度，$p$ 是压力。压力通过理想气体状态方程与守恒变量相关联：$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$，其中 $\\gamma$ 是比热比。您将使用高阶非线性重构和近似黎曼求解器，为这些方程在均匀网格上实现一个显式有限体积时间步。本问题中的所有量都是无量纲的，不需要物理单位。\n\n您必须执行以下步骤：\n- 在横跨区间 $[0, L]$ 的 $N$ 个网格的均匀网格上，使用有限体积半离散更新。设 $\\Delta x = L/N$，并将时间 $t^n$ 的网格平均守恒变量表示为 $U_i^n$（网格索引为 $i$）。对于内部网格，通过计算 $U_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)$ 来推进一个时间步，其中 $F_{i\\pm\\frac{1}{2}}$ 是网格界面上的数值通量。\n- 使用五阶加权本质无振荡 (WENO) 重构，从网格中心的原始变量 $V = [\\rho, u, p]^\\top$ 构造左右界面状态 $V_{i+\\frac{1}{2}}^L$ 和 $V_{i+\\frac{1}{2}}^R$。使用通过在每个边界上设置 3 个虚拟单元实现的出口（零梯度）边界条件。\n- 使用应用于每个界面上重构的左右状态的 Harten–Lax–van Leer–Contact (HLLC) 近似黎曼求解器计算数值通量 $F_{i+\\frac{1}{2}}$，并采用物理上合理的波速估计。\n- 根据 Courant–Friedrichs–Lewy (CFL) 条件选择时间步 $\\Delta t$：$\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + a_i\\right)$，其中 $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ 是根据时间 $t^n$ 的原始变量计算出的局部声速。\n- 为确保极端状态下的数值鲁棒性，通过施加下限值 $\\rho \\gets \\max(\\rho, \\varepsilon_\\rho)$ 和 $p \\gets \\max(p, \\varepsilon_p)$ 来强制保证重构密度和压力的正性，其中 $\\varepsilon_\\rho$ 和 $\\varepsilon_p$ 是小的正常数。\n\n您的程序必须实现上述算法，并将其应用于下面指定的测试套件。对于每个测试用例，从给定的初始数据运行恰好一个时间步，并报告更新后域内积分的守恒量，定义为 $M = \\sum_{i} \\rho_i^{n+1}\\,\\Delta x$，$P = \\sum_{i} (\\rho u)_i^{n+1}\\,\\Delta x$ 和 $E_T = \\sum_{i} E_i^{n+1}\\,\\Delta x$，以浮点数形式表示。\n\n测试套件：\n- 情况 1（一般非对称黎曼问题）：$L = 1$，$N = 200$，$\\gamma = 1.4$，$\\text{CFL} = 0.4$。初始原始变量为分段常数：当 $x  0.5$ 时，$[\\rho, u, p] = [1.0, 0.75, 1.0]$；当 $x \\ge 0.5$ 时，$[\\rho, u, p] = [0.125, 0.0, 0.1]$。\n- 情况 2（均匀流，边界一致性）：$L = 1$，$N = 64$，$\\gamma = 1.4$，$\\text{CFL} = 0.5$。初始原始变量为均匀值：对于所有 $x$，$[\\rho, u, p] = [0.8, -0.2, 0.5]$。\n- 情况 3（左侧近真空，强膨胀）：$L = 1$，$N = 400$，$\\gamma = 1.4$，$\\text{CFL} = 0.2$。初始原始变量为分段常数：当 $x  0.5$ 时，$[\\rho, u, p] = [0.01, 2.0, 0.001]$；当 $x \\ge 0.5$ 时，$[\\rho, u, p] = [1.0, 0.0, 1.0]$。\n\n实现要求：\n- 在每个边界上精确使用 3 个虚拟单元，并采用出口边界条件，即在每个重构步骤中，将虚拟单元的值设置为最接近的内部单元的值。\n- 使用 5 点模板对原始变量进行分量重构，以在所有内部界面上生成 $V_{i+\\frac{1}{2}}^L$ 和 $V_{i+\\frac{1}{2}}^R$。\n- 基于重构的界面状态和理想气体关系，使用对左、右和接触波速的一致估计来计算 HLLC 通量。\n- 对每种情况执行恰好一个更新步骤，并在更新后计算总量 $M$、$P$ 和 $E_T$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须按此确切顺序包含值 $[M_1, P_1, E_{T,1}, M_2, P_2, E_{T,2}, M_3, P_3, E_{T,3}]$，其中下标表示测试用例编号。以编程语言的默认字符串格式打印浮点数。",
            "solution": "用户要求实现一个用于一维可压缩欧拉方程的高阶有限体积格式的单时间步。该解决方案涉及计算流体力学中的几个标准组件，下文将详细介绍。守恒变量为 $U = [\\rho, \\rho u, E]^\\top$，原始变量为 $V = [\\rho, u, p]^\\top$。压力 $p$ 由理想气体定律 $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$ 给出。\n\n该方法的核心是网格 $i$ 的半离散有限体积更新：\n$$\n\\frac{dU_i}{dt} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\n其中 $U_i$ 是网格平均守恒态，$F_{i\\pm\\frac{1}{2}}$ 是网格界面处的数值通量。时间积分采用显式欧拉方法：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\n时间步 $\\Delta t$ 由 CFL 条件确定，$\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + a_i)}$，其中 $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ 是声速。\n\n主要挑战在于计算数值通量 $F_{i+\\frac{1}{2}}$。这是一个两阶段的过程：重构和黎曼求解器。\n\n**1. WENO 重构**\n为了实现高阶精度并捕捉激波而不产生伪振荡，使用了五阶加权本质无振荡 (WENO) 格式。在每个界面 $i+\\frac{1}{2}$，我们需要重构界面左侧 ($V_{i+\\frac{1}{2}}^L$) 和右侧 ($V_{i+\\frac{1}{2}}^R$) 的状态变量。重构是对原始变量 $V = [\\rho, u, p]^\\top$ 逐分量进行的。\n\n让我们考虑在界面 $i+\\frac{1}{2}$ 对一个通用变量 $v$ 进行重构。左偏重构 $v_{i+\\frac{1}{2}}^L$ 使用一个包含网格平均值 $\\{v_{i-2}, v_{i-1}, v_i, v_{i+1}, v_{i+2}\\}$ 的五点模板。此模板被分成三个三点子模板，每个子模板提供一个三阶候选重构 $q_k$。\n- $q_0 = \\frac{1}{3}v_{i-2} - \\frac{7}{6}v_{i-1} + \\frac{11}{6}v_i$\n- $q_1 = -\\frac{1}{6}v_{i-1} + \\frac{5}{6}v_i + \\frac{1}{3}v_{i+1}$\n- $q_2 = \\frac{1}{3}v_i + \\frac{5}{6}v_{i+1} - \\frac{1}{6}v_{i+2}$\n\n这些候选值使用非线性权重 $\\omega_k$ 进行组合，权重取决于每个子模板中解的光滑度。光滑度由指示子 $IS_k$ 衡量。\n- $IS_0 = \\frac{13}{12}(v_{i-2} - 2v_{i-1} + v_i)^2 + \\frac{1}{4}(v_{i-2} - 4v_{i-1} + 3v_i)^2$\n- $IS_1 = \\frac{13}{12}(v_{i-1} - 2v_i + v_{i+1})^2 + \\frac{1}{4}(v_{i-1} - v_{i+1})^2$\n- $IS_2 = \\frac{13}{12}(v_i - 2v_{i+1} + v_{i+2})^2 + \\frac{1}{4}(3v_i - 4v_{i+1} + v_{i+2})^2$\n\n非线性权重计算为 $\\omega_k = \\frac{\\alpha_k}{\\sum_j \\alpha_j}$，其中 $\\alpha_k = \\frac{d_k}{(\\varepsilon + IS_k)^2}$。常数 $d_k$ 是在光滑解上产生五阶格式的最优线性权重；对于左偏格式，它们是 $d_0=0.1$，$d_1=0.6$，$d_2=0.3$。小参数 $\\varepsilon$（例如 $10^{-40}$）防止除以零。\n\n最终的重构值为 $v_{i+\\frac{1}{2}}^L = \\omega_0 q_0 + \\omega_1 q_1 + \\omega_2 q_2$。右偏重构 $v_{i+\\frac{1}{2}}^R$ 是对称地执行的，使用模板 $\\{v_{i-1}, v_i, v_{i+1}, v_{i+2}, v_{i+3}\\}$ 和一组不同的线性权重（$d'_0=0.3$，$d'_1=0.6$，$d'_2=0.1$）。\n\n该问题要求出口（零梯度）边界条件。这是通过在域的每一侧使用 3 个虚拟单元来实现的，其值被设置为最接近的内部单元的值。重构后，通过施加下限值来强制保证密度和压力的正性。\n\n**2. HLLC 近似黎曼求解器**\n利用每个界面上重构的左右状态（$V^L, V^R$），我们求解一个局部黎曼问题来计算通量。Harten-Lax-van Leer-Contact (HLLC) 求解器是一个高效的选择，它能正确解析孤立的接触间断和激波。\n\nHLLC 求解器将黎曼问题的解近似为由三个波分隔的四个常数状态：一个速度为 $S_L$ 的最左波（激波或稀疏波）、一个速度为 $S_M$ 的接触波和一个速度为 $S_R$ 的最右波。\n\n关键步骤如下：\n1.  **估计波速**：外波速 $S_L$ 和 $S_R$ 对稳定性和准确性至关重要。一个基于 Einfeldt 对 Roe 平均波速修正的稳健选择被采用：\n    $$ S_L = \\min(u_L - a_L, u_{roe} - a_{roe}), \\quad S_R = \\max(u_R + a_R, u_{roe} + a_{roe}) $$\n    其中 $u_{roe}$ 和 $a_{roe}$ 是 Roe 平均速度和声速。接触波速 $S_M$ 则从 Rankine-Hugoniot 跳跃条件推导得出：\n    $$ S_M = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L (S_L - u_L) - \\rho_R (S_R - u_R)} $$\n\n2.  **确定通量**：通过界面的通量取决于相对于界面（在黎曼问题框架中静止于 $x=0$）的波速。\n    - 如果 $S_L \\ge 0$，整个波结构向右移动，因此通量就是左状态的通量 $F(U_L)$。\n    - 如果 $S_R \\le 0$，整个结构向左移动，通量为 $F(U_R)$。\n    - 如果 $S_L  0  S_R$，界面位于波扇内部。通量取决于接触波速 $S_M$ 的位置：\n        - 如果 $S_M \\ge 0$，界面位于“左星区”（在左波和接触波之间）。通量为 $F_{*L} = F_L + S_L(U_{*L} - U_L)$。\n        - 如果 $S_M  0$，界面位于“右星区”（在接触波和右波之间）。通量为 $F_{*R} = F_R + S_R(U_{*R} - U_R)$。\n    星区状态 $U_{*L}$ 和 $U_{*R}$ 是从跨越外波的跳跃条件推导出来的。\n\n**3. 最终更新**\n一旦所有 $N+1$ 个内部界面的数值通量 $F_{i+1/2}$ 都计算出来，每个网格中的守恒变量就更新一个时间步。最后一步是将所得的守恒量在整个域上求和，以获得总质量 $M$、总动量 $P$ 和总能量 $E_T$。\n\n提供的代码使用 NumPy 以矢量化方式高效地实现了整个算法。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D Euler equations for three test cases using a 5th-order WENO scheme\n    and an HLLC Riemann solver for one time step.\n    \"\"\"\n\n    # --- Problem constants and helper functions ---\n    \n    # A small value to prevent division by zero in sensitive calculations\n    _TINY = 1e-40\n    # Positivity-preserving floors for rho and p\n    _RHO_FLOOR = 1e-9\n    _P_FLOOR = 1e-9\n\n    def prim_to_cons(V, gamma):\n        rho, u, p = V[0], V[1], V[2]\n        E = p / (gamma - 1.0) + 0.5 * rho * u**2\n        return np.array([rho, rho * u, E])\n\n    def cons_to_prim(U, gamma):\n        rho, rhou, E = U[0], U[1], U[2]\n        u = rhou / (rho + _TINY)  \n        p = (gamma - 1.0) * (E - 0.5 * rho * u**2)\n        return np.array([rho, u, p])\n\n    def get_flux_from_cons_prim(U, V, gamma):\n        _rho, rhou, E = U[0], U[1], U[2]\n        _rho_p, u, p = V[0], V[1], V[2]\n        return np.array([rhou, rhou * u + p, u * (E + p)])\n\n    # --- WENO5 Reconstruction ---\n\n    def weno5_reconstruction(v, N, num_ghosts):\n        g = num_ghosts\n        \n        # Left-biased reconstruction for v_L at N+1 interfaces\n        vm2 = v[g-3 : N+g-2]\n        vm1 = v[g-2 : N+g-1]\n        v0  = v[g-1 : N+g]\n        vp1 = v[g   : N+g+1]\n        vp2 = v[g+1 : N+g+2]\n\n        is0 = (13./12.) * (vm2 - 2*vm1 + v0)**2 + (1./4.) * (vm2 - 4*vm1 + 3*v0)**2\n        is1 = (13./12.) * (vm1 - 2*v0  + vp1)**2 + (1./4.) * (vm1 - vp1)**2\n        is2 = (13./12.) * (v0  - 2*vp1 + vp2)**2 + (1./4.) * (3*v0 - 4*vp1 + vp2)**2\n\n        d0, d1, d2 = 0.1, 0.6, 0.3\n        alpha0 = d0 / (is0 + _TINY)**2\n        alpha1 = d1 / (is1 + _TINY)**2\n        alpha2 = d2 / (is2 + _TINY)**2\n        alpha_sum = alpha0 + alpha1 + alpha2\n\n        w0 = alpha0 / alpha_sum\n        w1 = alpha1 / alpha_sum\n        \n        q0 = (1./3.)*vm2 - (7./6.)*vm1 + (11./6.)*v0\n        q1 = (-1./6.)*vm1 + (5./6.)*v0 + (1./3.)*vp1\n        q2 = (1./3.)*v0 + (5./6.)*vp1 - (1./6.)*vp2\n        \n        v_left = w0*q0 + w1*q1 + (1.0 - w0 - w1)*q2\n\n        # Right-biased reconstruction for v_R\n        vp3 = v[g+2 : N+g+3]\n        \n        is0_r = is1\n        is1_r = is2\n        is2_r = (13./12.) * (vp1 - 2*vp2 + vp3)**2 + (1./4.) * (3*vp1 - 4*vp2 + vp3)**2\n\n        d0_r, d1_r, d2_r = 0.3, 0.6, 0.1\n        alpha0_r = d0_r / (is0_r + _TINY)**2\n        alpha1_r = d1_r / (is1_r + _TINY)**2\n        alpha2_r = d2_r / (is2_r + _TINY)**2\n        alpha_sum_r = alpha0_r + alpha1_r + alpha2_r\n        \n        w0_r = alpha0_r / alpha_sum_r\n        w1_r = alpha1_r / alpha_sum_r\n\n        q0_r = q1\n        q1_r = q2\n        q2_r = (11./6.)*vp1 - (7./6.)*vp2 + (1./3.)*vp3\n        \n        v_right = w0_r*q0_r + w1_r*q1_r + (1.0 - w0_r - w1_r)*q2_r\n        \n        return v_left, v_right\n\n    # --- HLLC Riemann Solver ---\n\n    def hllc_flux(V_L, V_R, gamma):\n        U_L = prim_to_cons(V_L, gamma)\n        U_R = prim_to_cons(V_R, gamma)\n\n        rho_L, u_L, p_L = V_L[0], V_L[1], V_L[2]\n        rho_R, u_R, p_R = V_R[0], V_R[1], V_R[2]\n        \n        E_L, E_R = U_L[2], U_R[2]\n\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        a_R = np.sqrt(gamma * p_R / rho_R)\n\n        rho_sqrt_L, rho_sqrt_R = np.sqrt(rho_L), np.sqrt(rho_R)\n        rho_sqrt_sum = rho_sqrt_L + rho_sqrt_R\n        \n        u_roe = (rho_sqrt_L * u_L + rho_sqrt_R * u_R) / rho_sqrt_sum\n        H_L = (E_L + p_L) / rho_L\n        H_R = (E_R + p_R) / rho_R\n        H_roe = (rho_sqrt_L * H_L + rho_sqrt_R * H_R) / rho_sqrt_sum\n        a_roe_sq = (gamma - 1.0) * (H_roe - 0.5 * u_roe**2)\n        a_roe = np.sqrt(np.maximum(a_roe_sq, _TINY))\n\n        S_L = np.minimum(u_L - a_L, u_roe - a_roe)\n        S_R = np.maximum(u_R + a_R, u_roe + a_roe)\n\n        num = p_R - p_L + rho_L*u_L*(S_L - u_L) - rho_R*u_R*(S_R - u_R)\n        den = rho_L*(S_L - u_L) - rho_R*(S_R - u_R)\n        S_M = num / (den + _TINY)\n\n        F_L = get_flux_from_cons_prim(U_L, V_L, gamma)\n        F_R = get_flux_from_cons_prim(U_R, V_R, gamma)\n\n        U_star_L = np.zeros_like(U_L)\n        den_SL_SM = S_L - S_M\n        U_star_L[0] = rho_L * (S_L - u_L) / (den_SL_SM + _TINY)\n        U_star_L[1] = U_star_L[0] * S_M\n        p_star_term = p_L / (rho_L * (S_L - u_L) + _TINY)\n        U_star_L[2] = U_star_L[0] * (E_L/rho_L + (S_M - u_L) * (S_M + p_star_term))\n        flux_star_L = F_L + S_L[:, np.newaxis].T * (U_star_L - U_L)\n\n        U_star_R = np.zeros_like(U_R)\n        den_SR_SM = S_R - S_M\n        U_star_R[0] = rho_R * (S_R - u_R) / (den_SR_SM + _TINY)\n        U_star_R[1] = U_star_R[0] * S_M\n        p_star_term_R = p_R / (rho_R * (S_R - u_R) + _TINY)\n        U_star_R[2] = U_star_R[0] * (E_R/rho_R + (S_M - u_R) * (S_M + p_star_term_R))\n        flux_star_R = F_R + S_R[:, np.newaxis].T * (U_star_R - U_R)\n        \n        flux = np.where(S_L >= 0, F_L, \n               np.where(S_R = 0, F_R, \n               np.where(S_M >= 0, flux_star_L, flux_star_R)))\n        \n        return flux\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.4, \n         'ic': {'x_disc': 0.5, 'L': [1.0, 0.75, 1.0], 'R': [0.125, 0.0, 0.1]}},\n        {'L': 1.0, 'N': 64,  'gamma': 1.4, 'CFL': 0.5, \n         'ic': {'uniform': [0.8, -0.2, 0.5]}},\n        {'L': 1.0, 'N': 400, 'gamma': 1.4, 'CFL': 0.2, \n         'ic': {'x_disc': 0.5, 'L': [0.01, 2.0, 0.001], 'R': [1.0, 0.0, 1.0]}}\n    ]\n    \n    final_results = []\n    \n    for case in test_cases:\n        L, N, gamma, CFL = case['L'], case['N'], case['gamma'], case['CFL']\n        dx = L / N\n        num_ghosts = 3\n        g = num_ghosts\n\n        x_centers = (np.arange(N) + 0.5) * dx\n        V_interior = np.zeros((3, N))\n        \n        if 'uniform' in case['ic']:\n            state = case['ic']['uniform']\n            V_interior[0,:] = state[0]\n            V_interior[1,:] = state[1]\n            V_interior[2,:] = state[2]\n        else:\n            x_disc = case['ic']['x_disc']\n            state_L, state_R = case['ic']['L'], case['ic']['R']\n            for i in range(N):\n                if x_centers[i]  x_disc:\n                    V_interior[:, i] = state_L\n                else:\n                    V_interior[:, i] = state_R\n\n        U_interior = prim_to_cons(V_interior, gamma)\n        \n        a_interior = np.sqrt(gamma * V_interior[2,:] / V_interior[0,:])\n        max_speed = np.max(np.abs(V_interior[1,:]) + a_interior)\n        dt = CFL * dx / max_speed\n\n        V_full = np.zeros((3, N + 2 * g))\n        V_full[:, g:N+g] = V_interior\n        V_full[:, :g] = V_interior[:, 0:1]\n        V_full[:, N+g:] = V_interior[:, -1:]\n\n        V_L = np.zeros((3, N + 1))\n        V_R = np.zeros((3, N + 1))\n        for k in range(3):\n            v_l_comp, v_r_comp = weno5_reconstruction(V_full[k, :], N, g)\n            V_L[k, :] = v_l_comp\n            V_R[k, :] = v_r_comp\n\n        V_L[0, :] = np.maximum(V_L[0, :], _RHO_FLOOR)\n        V_L[2, :] = np.maximum(V_L[2, :], _P_FLOOR)\n        V_R[0, :] = np.maximum(V_R[0, :], _RHO_FLOOR)\n        V_R[2, :] = np.maximum(V_R[2, :], _P_FLOOR)\n\n        fluxes = hllc_flux(V_L, V_R, gamma)\n        \n        U_interior_new = U_interior - (dt / dx) * (fluxes[:, 1:] - fluxes[:, :-1])\n\n        M = np.sum(U_interior_new[0, :]) * dx\n        P = np.sum(U_interior_new[1, :]) * dx\n        E_T = np.sum(U_interior_new[2, :]) * dx\n        \n        final_results.extend([M, P, E_T])\n        \n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```"
        }
    ]
}