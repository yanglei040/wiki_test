{
    "hands_on_practices": [
        {
            "introduction": "对双曲守恒律的理论理解建立在求解黎曼问题的基础上。对于非凸通量函数，标准的Rankine–Hugoniot条件不足以保证解的唯一性，因此必须使用熵条件。这项练习  将挑战你分析这样一个案例，探索熵条件如何筛选出物理相关的复合波结构，从而巩固你对熵在冲击波理论中基本作用的理解。",
            "id": "3386005",
            "problem": "考虑标量守恒律 $u_{t} + f(u)_{x} = 0$，其通量为 $f(u) = u^{3} - u$。黎曼问题由以下初值数据构成：当 $x  0$ 时 $u(x,0) = u_{L}$，当 $x > 0$ 时 $u(x,0) = u_{R}$。对于一个标量守恒律，熵对 $(\\eta,q)$ 的概念由一个凸熵 $\\eta(u)$ 和一个相关的熵通量 $q(u)$ 定义，它们满足 $q'(u) = \\eta'(u) f'(u)$。激波的可采性要求熵不等式 $[q] - s[\\eta] \\le 0$ 成立，其中 $s$ 是 Rankine–Hugoniot 速度 $s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$，并且 $[\\cdot]$ 表示物理量穿过间断时的跳跃。使用一个凸熵 $\\eta(u)$，将通量为 $f(u) = u^{3} - u$ 的可采黎曼解分类为激波、稀疏波或复合波（稀疏波和激波的组合），并解释当 $f$ 非凸时，熵不等式如何区分可采与不可采的分支。然后，对于特定的黎曼数据 $u_{L} = 1$ 和 $u_{R} = -1$，确定可采的自相似解结构，并使用凸熵 $\\eta(u) = \\frac{1}{2} u^{2}$ 计算熵可采复合波中间断的唯一激波速度 $s$。将 $s$ 的最终值表示为一个精确的有理数。",
            "solution": "用户想要分析具有非凸通量 $f(u) = u^{3} - u$ 的标量守恒律 $u_{t} + (u^{3} - u)_{x} = 0$ 的黎曼问题。\n\n### 第一部分：问题验证\n\n**步骤1：提取已知条件**\n-   标量守恒律：$u_{t} + (u^{3} - u)_{x} = 0$。\n-   通量函数：$f(u) = u^{3} - u$。\n-   黎曼问题初值数据：当 $x  0$ 时 $u(x,0) = u_{L}$，当 $x > 0$ 时 $u(x,0) = u_{R}$。\n-   熵对 $(\\eta,q)$：$\\eta(u)$ 是凸的，且 $q'(u) = \\eta'(u) f'(u)$。\n-   激波的熵不等式：$[q] - s[\\eta] \\le 0$。\n-   Rankine–Hugoniot 速度：$s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$。\n-   跳跃记号：$[\\cdot]$ 表示一个量穿过间断时的跳跃，定义为 $[v] = v_{R} - v_{L}$。\n-   特定黎曼数据：$u_{L} = 1$ 和 $u_{R} = -1$。\n-   特定凸熵：$\\eta(u) = \\frac{1}{2} u^{2}$。\n-   目标：对解进行分类，并对于特定数据，确定可采的自相似解结构，并计算复合波中的激波速度 $s$。最终值必须是一个精确的有理数。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题是非线性双曲守恒律理论中的一个标准练习，这是一个在应用数学和物理学中完善建立的领域。黎曼问题、Rankine-Hugoniot 条件、熵条件以及非凸通量的复合波等概念都是该学科的基础。\n-   **良定的**：该问题是良定的。初值数据已指定，并且要求熵可采解正是确保此类偏微分方程存在唯一、具有物理意义的解所需的条件。\n-   **目标**：该问题以精确、客观的数学语言陈述。\n-   **结论**：不存在科学缺陷、歧义或信息缺失。该问题是有效的。\n\n### 第二部分：求解\n\n#### 解的一般分类\n给定的守恒律为 $u_t + f(u)_x = 0$，其通量为 $f(u)=u^3-u$。特征速度由 $f'(u) = 3u^2-1$ 给出。该通量是非凸的，因为其二阶导数 $f''(u) = 6u$ 在拐点 $u=0$ 处变号。\n黎曼问题（当 $x0$ 时 $u(x,0) = u_L$，当 $x>0$ 时为 $u_R$）的解是自相似的，即它们是 $\\xi = x/t$ 的函数。这些解由常数状态、稀疏波和激波组成。\n\n-   **稀疏波**：连接状态 $u_1$ 和 $u_2$ 的连续解，其中当 $u$ 遍历波剖面时，特征速度 $f'(u)$ 是非减的。对于 $f'(u)=3u^2-1$，当 $u_1  u_2$ 时，如果区间 $[u_1, u_2]$ 位于 $f'(u)$ 递增的区域内（例如，$0 \\le u_1  u_2$），这是可能的；或者当 $u_1 > u_2$ 时，如果 $f'(u)$ 是递减的（例如，$u_1 > u_2$ 且 $u_1, u_2 \\le 0$），这也是可能的。\n\n-   **激波**：连接状态 $u_L$ 到 $u_R$ 的不连续解，以速度 $s = [f]/[u] = (f(u_R)-f(u_L))/(u_R-u_L)$ 传播。对于非凸通量，如果一个激波对每个凸熵函数 $\\eta(u)$ 都满足熵不等式 $[q] - s[\\eta] \\le 0$，则该激波是可采的。这等价于 Oleinik 熵条件，其几何意义是，对于从 $u_L$ 到 $u_R$ 的激波：\n    -   如果 $u_L  u_R$，对于所有 $u \\in (u_L, u_R)$，连接 $(u_L, f(u_L))$ 和 $(u_R, f(u_R))$ 的弦必须位于 $f(u)$ 图像的上方。\n    -   如果 $u_L > u_R$，对于所有 $u \\in (u_R, u_L)$，该弦必须位于 $f(u)$ 图像的下方。\n违反此条件的激波是不稳定的，并会分解为可采激波和稀疏波的组合。\n\n-   **复合波**：对于非凸通量，连接 $u_L$ 和 $u_R$ 的熵可采解可能是激波和稀疏波的复合。该解的结构由通量函数的凸包或凹包决定。对于 $u_L > u_R$（如我们特定情况），解对应于在区间 $[u_R, u_L]$ 上追踪 $f(u)$ 的上凹包。\n\n#### 对于 $u_L = 1, u_R = -1$ 的特定解\n给定 $u_L=1$ 和 $u_R=-1$。因此，$u_L > u_R$。\n$f(u_L) = f(1) = 1^3-1 = 0$。\n$f(u_R) = f(-1) = (-1)^3-(-1) = 0$。\n一个连接 $u_L=1$ 到 $u_R=-1$ 的单一激波的速度为 $s = \\frac{f(-1)-f(1)}{-1-1} = \\frac{0-0}{-2} = 0$。根据 $u_L > u_R$ 的 Oleinik 条件，对于所有 $u \\in (-1,1)$，连接 $(1,0)$ 和 $(-1,0)$ 的弦必须位于 $f(u)$ 图像的下方。该弦是直线 $y=0$。然而，对于 $u \\in (0,1)$，$f(u) = u^3-u  0$。该条件被违反，因此这个激波是不可采的。\n\n解必须是一个复合波。由于 $u_L > u_R$，解由从右到左速度递减的波组成（即 $\\xi=x/t$ 减小）。允许解廓线 $u(\\xi)$ 为非增函数的结构是一个稀疏波后跟一个激波。\n其结构为：$u_L=1 \\xrightarrow{\\text{稀疏波}} u_m \\xrightarrow{\\text{激波}} u_R=-1$。\n\n1.  **稀疏波**：一个稀疏波将 $u_L=1$ 连接到一个中间状态 $u_m$。对于一个从状态 $u_1$ 到 $u_2$ 且 $u_1>u_2$ 的稀疏波，特征速度 $f'(u)$ 在 $[u_2, u_1]$ 上必须是递减的。对于我们的问题，这意味着 $f'(u)=3u^2-1$ 在 $[u_m, 1]$ 上必须递减。这是不可能的，因为 $f'(u)$ 在 $[0,1]$ 上是递增的。\n    逻辑必须反过来：解 $u(\\xi)$ 是 $\\xi$ 的一个非增函数。一个从 $u_1$ 到 $u_2$ ($u_1 > u_2$) 的稀疏波具有扩展的特征线，速度范围从 $f'(u_1)$ 到 $f'(u_2)$，这要求 $f'(u_1) > f'(u_2)$。\n    解的结构必须是一个从 $u_L=1$ 到 $u_m$ 的稀疏波和一个从 $u_m$ 到 $u_R=-1$ 的激波。我们来检查速度。稀疏波的速度必须高于激波的速度。\n    -   稀疏波将 $u_L=1$ 连接到 $u_m  1$。为了使波速 $\\xi$ 正确排序，我们需要 $f'(u)$ 在 $[u_m, 1]$ 上是递增的。如果 $u_m \\in [0, 1]$，这个条件成立。\n    -   激波将 $u_m$ 连接到 $u_R=-1$。\n    -   在稀疏波和激波的边界处，状态必须匹配，并且激波速度必须等于其相邻状态的特征速度。这是一个声速条件：$s = f'(u_m)$。\n\n2.  **确定 $u_m$ 和 $s$**：\n    激波速度 $s$ 由从 $u_m$ 跳跃到 $-1$ 的 Rankine-Hugoniot 条件给出：\n    $$s = \\frac{f(u_R) - f(u_m)}{u_R - u_m} = \\frac{f(-1) - f(u_m)}{-1 - u_m} = \\frac{0 - (u_m^3 - u_m)}{-1 - u_m} = \\frac{-u_m(u_m-1)(u_m+1)}{-(u_m+1)} = u_m(u_m-1) = u_m^2 - u_m$$\n    声速条件是 $s = f'(u_m) = 3u_m^2 - 1$。\n    令两个关于 $s$ 的表达式相等：\n    $$u_m^2 - u_m = 3u_m^2 - 1$$\n    $$2u_m^2 + u_m - 1 = 0$$\n    对二次方程进行因式分解：\n    $$(2u_m - 1)(u_m + 1) = 0$$\n    这为中间状态提供了两个可能的值：$u_m = 1/2$ 或 $u_m = -1$。\n    如果 $u_m=-1$，稀疏波部分消失，我们只剩下从 $1$ 到 $-1$ 的不可采激波。\n    因此，唯一有效的中间状态是 $u_m = 1/2$。该值位于区间 $[0,1]$ 内，这与对稀疏波部分的要求一致。\n\n3.  **计算激波速度**：\n    当 $u_m = 1/2$ 时，激波将 $u_m=1/2$ 连接到 $u_R=-1$。该激波的速度为：\n    $$s = u_m^2 - u_m = \\left(\\frac{1}{2}\\right)^2 - \\frac{1}{2} = \\frac{1}{4} - \\frac{1}{2} = -\\frac{1}{4}$$\n    复合波由一个从 $u=1$ 到 $u=1/2$ 的稀疏波（填充速度范围 $\\xi \\in [f'(1/2), f'(1)] = [-1/4, 2]$）和一个以速度 $s=-1/4$ 传播的从 $u=1/2$ 到 $u=-1$ 的激波组成。这在我关于速度的推理中存在一个错误。让我精确地说明一下。解是关于 $\\xi = x/t$ 的非增函数。\n    - 对于 $\\xi > 2 = f'(1)$，有 $u=1$。\n    - 对于 $-1/4  \\xi  2$，我们有一个连接 $u=1$ 到 $u=1/2$ 的稀疏波。\n    - 在 $\\xi = -1/4$ 处，有一个从 $u=1/2$ 到 $u=-1$ 的激波。\n    - 对于 $\\xi  -1/4$，有 $u=-1$。\n    这个顺序是一致的。\n\n4.  **熵条件验证**：\n    我们使用 $\\eta(u) = \\frac{1}{2}u^2$ 来验证从 $u_m=1/2$ 到 $u_R=-1$ 的激波是可采的。\n    该激波是在 $\\xi=s=-1/4$ 处的一个间断。右侧的状态是 $u_{right}=1/2$，左侧的状态是 $u_{left}=-1$。\n    在熵条件的记法中，我们令 $u_R \\to u_{right}$ 和 $u_L \\to u_{left}$。\n    因此，$u_R = 1/2$ 和 $u_L=-1$。\n    熵通量 $q(u)$ 满足 $q'(u) = \\eta'(u)f'(u) = u(3u^2-1) = 3u^3-u$。积分得到 $q(u) = \\frac{3}{4}u^4 - \\frac{1}{2}u^2$。\n    我们需要检验 $[q] - s[\\eta] \\le 0$，其中 $[v] = v(u_R) - v(u_L)$。\n    -   $[q] = q(1/2) - q(-1) = \\left(\\frac{3}{4}(\\frac{1}{16}) - \\frac{1}{2}(\\frac{1}{4})\\right) - \\left(\\frac{3}{4}(1) - \\frac{1}{2}(1)\\right) = (\\frac{3}{64} - \\frac{8}{64}) - (\\frac{1}{4}) = -\\frac{5}{64} - \\frac{16}{64} = -\\frac{21}{64}$。\n    -   $[\\eta] = \\eta(1/2) - \\eta(-1) = \\frac{1}{2}(\\frac{1}{4}) - \\frac{1}{2}(1) = \\frac{1}{8} - \\frac{1}{2} = -\\frac{3}{8}$。\n    -   $s = -1/4$。\n    将这些值代入不等式中：\n    $$[q] - s[\\eta] = -\\frac{21}{64} - \\left(-\\frac{1}{4}\\right)\\left(-\\frac{3}{8}\\right) = -\\frac{21}{64} - \\frac{3}{32} = -\\frac{21}{64} - \\frac{6}{64} = -\\frac{27}{64}$$\n    由于 $-27/64 \\le 0$，熵不等式得到满足，该激波是可采的。\n\n可采的自相似解是一个复合波，由一个从 $u=1$ 到 $u=1/2$ 的稀疏波，后跟一个从 $u=1/2$ 到 $u=-1$ 的激波组成。该解中唯一的激波速度是 $s=-1/4$。",
            "answer": "$$ \\boxed{-\\frac{1}{4}} $$"
        },
        {
            "introduction": "虽然解析解富有启发性，但我们通常依赖数值方法来求解守恒律。然而，一些在其他方面表现优异的数值格式可能会产生非物理的“膨胀激波”，从而导致灾难性的失败。本练习  提供了一个动手计算，比较了一个标准数值通量和一个经过熵修正的通量，直接说明了少量目标性的数值耗散如何能修正这些关键性错误。",
            "id": "3385955",
            "problem": "考虑标量守恒律（无粘伯格斯方程）$u_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0$，其作为一个黎曼问题，初始数据为当 $x  0$ 时 $u(x,0) = u_{L}$，当 $x > 0$ 时 $u(x,0) = u_{R}$。令左状态为 $u_{L} = 1$，右状态为 $u_{R} = -1$。您将在有限体积法的界面 $x = 0$ 处，通过两种不同的近似黎曼求解器来近似计算单元间的数值通量。这两种求解器是通过将通量差分分解为一个中心一致部分和一个基于特征信息构建的耗散修正项来构造的。\n\n使用此分解，计算：\n- 通过使用局部最大特征速度的 Lax–Friedrichs 构造方法获得的单元间数值通量，\n- 通过配备 Harten 熵修正的 Roe 线性化方法获得的单元间数值通量，其中熵修正阈值为 $\\delta = 0.2$，该修正将任何特征速度 $|a|$ 在其值较小时替换为其平滑量级。\n\n然后，计算这两个在 $x=0$ 处的通量之差，定义为 Lax–Friedrichs 通量减去带熵修正的 Roe 通量。将您的最终答案表示为单个实数，并四舍五入到四位有效数字。该量是无量纲的；不要包含任何单位。",
            "solution": "该问题要求计算和比较无粘伯格斯方程在特定界面上的两种不同数值通量。控制偏微分方程是一个标量守恒律：\n$$\nu_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0\n$$\n物理通量函数为 $f(u) = \\frac{1}{2}u^{2}$。相应的雅可比矩阵，即特征速度，为 $a(u) = f'(u) = u$。\n\n该问题是一个黎曼问题，初始数据在 $x=0$ 处存在间断：\n$$\nu(x,0) = \n\\begin{cases} \nu_{L} = 1  \\text{当 } x  0 \\\\\nu_{R} = -1  \\text{当 } x > 0\n\\end{cases}\n$$\n我们需要计算左状态 $u_L$ 和右状态 $u_R$ 之间界面上的数值通量 $F(u_L, u_R)$。所考虑的数值通量函数的一般形式是带有附加人工耗散项的中心差分格式：\n$$\nF(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} D(u_L, u_R)\n$$\n其中 $D(u_L, u_R)$ 是耗散项。\n\n首先，我们计算给定状态的物理通量：\n$$\nf(u_L) = f(1) = \\frac{1}{2}(1)^2 = \\frac{1}{2}\n$$\n$$\nf(u_R) = f(-1) = \\frac{1}{2}(-1)^2 = \\frac{1}{2}\n$$\n\n**1. Lax–Friedrichs 数值通量 ($F_{LF}$)**\n\nLax-Friedrichs (LF) 格式使用基于局部最大特征速度的耗散项。数值通量由下式给出：\n$$\nF_{LF}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} c_{max} (u_R - u_L)\n$$\n其中 $c_{max}$ 是局部模板中特征速度的最大绝对值，定义为 $c_{max} = \\max(|a(u_L)|, |a(u_R)|)$。\n对于伯格斯方程，$a(u)=u$，所以我们有：\n$$\nc_{max} = \\max(|u_L|, |u_R|) = \\max(|1|, |-1|) = 1\n$$\n现在，我们将这些值代入 LF 通量公式：\n$$\nF_{LF} = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right) - \\frac{1}{2}(1)(-1 - 1) = \\frac{1}{2}(1) - \\frac{1}{2}(-2) = \\frac{1}{2} + 1 = 1.5\n$$\n\n**2. 带 Harten 熵修正的 Roe 数值通量 ($F_{Roe}$)**\n\nRoe 格式通过引入一个 Roe 平均状态来线性化问题。对于一个标量方程，Roe 平均特征速度 $\\tilde{a}$ 必须满足 Rankine-Hugoniot 条件 $f(u_R) - f(u_L) = \\tilde{a}(u_R - u_L)$。对于伯格斯方程，这给出：\n$$\n\\tilde{a} = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{\\frac{1}{2}(u_R - u_L)(u_R + u_L)}{u_R - u_L} = \\frac{1}{2}(u_L + u_R)\n$$\n对于给定的状态，Roe 速度为：\n$$\n\\tilde{a} = \\frac{1}{2}(1 + (-1)) = 0\n$$\n标准 Roe 通量为：\n$$\nF_{Roe, std}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} |\\tilde{a}| (u_R - u_L)\n$$\n由于 $\\tilde{a} = 0$，标准 Roe 通量将具有零耗散。对于给定的数据（$u_L > u_R$），这是有问题的，因为它对应于一个跨音速稀疏波（$a(u_L) = 1 > 0$ 且 $a(u_R) = -1  0$）。零耗散通量会错误地捕捉到一个静止激波。为了修正这个问题，需要进行熵修正。\n\nHarten 熵修正通过在 $|z|$ 很小时，用一个平滑函数 $\\psi(z)$ 替换绝对值函数 $|z|$ 来修改耗散项。指定的形式是：\n$$\n\\psi(z) = \n\\begin{cases} \n|z|  \\text{若 } |z| \\geq \\delta \\\\\n\\frac{z^2 + \\delta^2}{2\\delta}  \\text{若 } |z|  \\delta\n\\end{cases}\n$$\n问题指定了熵修正阈值为 $\\delta = 0.2$。我们计算出的 Roe 速度是 $\\tilde{a} = 0$。由于 $|\\tilde{a}| = 0  0.2$，我们必须使用平滑公式：\n$$\n\\psi(\\tilde{a}) = \\psi(0) = \\frac{0^2 + (0.2)^2}{2(0.2)} = \\frac{(0.2)^2}{0.4} = \\frac{0.04}{0.4} = 0.1\n$$\n那么，带 Harten 熵修正的 Roe 通量是：\n$$\nF_{Roe}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} \\psi(\\tilde{a}) (u_R - u_L)\n$$\n代入数值：\n$$\nF_{Roe} = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right) - \\frac{1}{2}(0.1)(-1 - 1) = \\frac{1}{2}(1) - \\frac{1}{2}(0.1)(-2) = 0.5 - (-0.1) = 0.6\n$$\n\n**3. 通量之差**\n\n最后，我们计算 Lax-Friedrichs 通量和带熵修正的 Roe 通量之差：\n$$\n\\Delta F = F_{LF} - F_{Roe} = 1.5 - 0.6 = 0.9\n$$\n问题要求答案四舍五入到四位有效数字。精确值为 $0.9$，为满足此要求可写为 $0.9000$。",
            "answer": "$$\n\\boxed{0.9000}\n$$"
        },
        {
            "introduction": "理解的最终检验是付诸实践。这个编程练习  的任务是让你构建一个有限体积求解器，亲眼见证熵修正的效果。通过模拟一个具有挑战性的跨音速稀疏问题并量化结果，你将对这些理论修正在创建稳健可靠的流体动力学及其他波动现象的数值模拟中的重要性获得切身的体会。",
            "id": "3386017",
            "problem": "考虑无粘性流体流动的标量守恒律模型，即无粘性 Burgers 方程，它是一个偏微分方程 (PDE)，由 $u_t + f(u)_x = 0$ 给出，其中 $f(u) = \\tfrac{1}{2} u^2$。物理相关的（熵）解是通过一个要求来选取的，即对于任意凸熵对 $(\\eta(u), q(u))$，不等式 $\\eta(u)_t + q(u)_x \\le 0$ 在分布意义下成立。对于在界面处具有左状态 $u_L$ 和右状态 $u_R$ 的 Riemann 初始数据，当 $u_L > u_R$ 时，熵解包含一个激波；当 $u_L  u_R$ 时，包含一个稀疏波。在跨音速稀疏波处违反离散熵条件的数值格式会产生膨胀激波（伪非物理解），除非应用了熵修正。\n\n您的任务是实现一个一维、一阶、显式的有限体积法，该方法带有 Roe 型近似 Riemann 求解器和可选的 Harten–Hyman 型熵修正。计算域为 $x \\in [-1, 1]$，有 $N_x$ 个均匀单元格，并具有固定的远场边界值 $u(x \\le -1, t) = u_L$ 和 $u(x \\ge 1, t) = u_R$。时间步进使用 Courant–Friedrichs–Lewy (CFL) 数 $\\mathrm{CFL} = 0.9$，并演化到最终时间 $T = 0.3$。初始数据为 Riemann 问题，$x  0$ 时 $u(x, 0) = u_L$，$x \\ge 0$ 时 $u(x, 0) = u_R$，其中 $u_L = -1$ 和 $u_R = 1$。必须使用 Roe 线性化来构建界面上的数值通量，并且必须通过单个参数 $\\delta \\ge 0$ 实现熵修正，具体如下：在 Roe 波速的音速区域，用一个依赖于 $\\delta$ 的平滑函数替换波速的绝对值；在该区域之外，保持不变。当 $\\delta = 0$ 时，没有熵修正。\n\n为了进行比较，基于自相似公式 $u(x, t) = \\xi$（其中在扇形区域 $\\xi = x/t$ 且在区域外为常数状态），计算在时间 $T$ 的稀疏扇的精确解。通过计算以下度量来量化熵修正的效果：\n- 离散 $L^1$ 误差 $E_{L^1} = \\sum_i |u_i(T) - u_{\\mathrm{exact}}(x_i, T)| \\Delta x$。\n- 归一化最大单步跳跃 $J_{\\mathrm{norm}} = \\max_i |u_{i+1}(T) - u_i(T)| / (u_R - u_L)$，它可作为伪激波强度的指标。\n- 布尔激波指示器 $B_{\\mathrm{shock}}$，定义为：如果 $J_{\\mathrm{norm}} > \\tau$，则 $B_{\\mathrm{shock}} = \\text{True}$，否则 $B_{\\mathrm{shock}} = \\text{False}$，阈值为 $\\tau = 0.1$。\n\n实现程序以运行以下参数值 $(N_x, \\delta)$ 的测试套件：\n1. $(200, 0.0)$ 作为无熵修正的基准（预期在跨音速稀疏波处出现伪激波）。\n2. $(200, 0.1)$ 作为温和的熵修正（预期抑制膨胀激波并保留稀疏波）。\n3. $(200, 1.0)$ 作为强熵修正（预期过度平滑，产生更大的 $L^1$ 误差，但仍能抑制伪激波）。\n4. $(50, 0.1)$ 作为粗网格情况（预期与在更细网格上使用相同修正相比，误差更大）。\n5. $(800, 0.1)$ 作为细网格情况（预期误差更小，稀疏波更平滑）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例产生一个列表 $[E_{L^1}, J_{\\mathrm{norm}}, B_{\\mathrm{shock}}]$。对于整个测试套件，请打印一个嵌套列表\n$[[E_{L^1}^{(1)}, J_{\\mathrm{norm}}^{(1)}, B_{\\mathrm{shock}}^{(1)}], \\dots, [E_{L^1}^{(5)}, J_{\\mathrm{norm}}^{(5)}, B_{\\mathrm{shock}}^{(5)}]]$。\n所有量都是无量纲的，并且结果应以指定的嵌套列表格式打印为 Python 原生类型（浮点数和布尔值）。",
            "solution": "用户提供了一个具有科学依据、适定且客观的问题。它描述了计算流体动力学中的一个标准数值实验，用于测试有限体积格式中熵修正对双曲守恒律的有效性。所有参数和条件都已明确定义，任务是实现指定的算法并计算明确定义的度量。因此，该问题是有效的，并将提供一个解。\n\n该问题需要数值求解一维无粘性 Burgers 方程，这是一个标量双曲守恒律的原型：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} f(u) = 0\n$$\n其中通量函数为 $f(u) = \\frac{1}{2}u^2$。计算域为 $x \\in [-1, 1]$，初始条件是在 $x=0$ 处具有左状态 $u_L = -1$ 和右状态 $u_R = 1$ 的 Riemann 问题。由于 $u_L  u_R$，精确解是一个稀疏波。\n\n解是使用一阶显式有限体积法构建的。区域被离散化为 $N_x$ 个宽度为 $\\Delta x = 2/N_x$ 的均匀单元格。单元格中心位于 $x_i = -1 + (i - 1/2)\\Delta x$，$i=1, \\dots, N_x$。在时间 $t$，单元格 $i$ 中解的单元平均值表示为 $u_i(t)$。\n\n有限体积法的半离散形式为：\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中 $F_{i+1/2}$ 是单元格 $i$ 和单元格 $i+1$ 之间界面处的数值通量。\n\n数值通量是使用 Roe 近似 Riemann 求解器确定的。对于 Burgers 方程，左状态 $u_L$ 和右状态 $u_R$ 之间的 Roe 通量由下式给出：\n$$\nF(u_L, u_R) = \\frac{1}{2} (f(u_L) + f(u_R)) - \\frac{1}{2} |\\hat{a}(u_L, u_R)| (u_R - u_L)\n$$\nBurgers 方程的特征速度为 $a(u) = f'(u) = u$。对于这个特定方程，Roe 平均速度 $\\hat{a}$ 简化为算术平均值：\n$$\n\\hat{a}(u_L, u_R) = \\frac{u_L + u_R}{2}\n$$\n因此，在单元格 $i$ 和 $i+1$（状态为 $u_i$ 和 $u_{i+1}$）之间的界面 $x_{i+1/2}$ 处的数值通量为：\n$$\nF_{i+1/2} = \\frac{1}{2} \\left( \\frac{1}{2}u_i^2 + \\frac{1}{2}u_{i+1}^2 \\right) - \\frac{1}{2} \\left| \\frac{u_i + u_{i+1}}{2} \\right| (u_{i+1} - u_i)\n$$\n\n标准 Roe 求解器的一个已知缺陷是它在跨音速稀疏波上不能满足熵条件。对于给定的初始数据 $u_L = -1, u_R = 1$，精确解是一个以 $x=0$ 为中心的稀疏扇。在中心附近，会存在数值状态使得 $u_i \\approx -u_{i+1}$，导致 Roe 速度 $\\hat{a}_{i+1/2} \\approx 0$。当速度为零时，与 $|\\hat{a}|$ 成正比的数值耗散项消失，格式可能会产生一个伪非物理的定常激波（膨胀激波）。\n\n为了解决这个问题，应用了 Harten-Hyman 熵修正。此修正通过在音速区域引入最小程度的扩散来修改 Roe 速度的绝对值。令 $\\lambda = \\hat{a}_{i+1/2}$。绝对值 $|\\lambda|$ 被函数 $\\psi(\\lambda)$ 替换：\n$$\n\\psi(\\lambda) = \\begin{cases}\n|\\lambda|  \\text{if } |\\lambda| \\ge \\delta \\\\\n\\frac{\\lambda^2 + \\delta^2}{2\\delta}  \\text{if } |\\lambda|  \\delta\n\\end{cases}\n$$\n其中 $\\delta \\ge 0$ 是用户定义的参数。当 $\\delta=0$ 时，不应用修正。修改后的数值通量为：\n$$\nF_{i+1/2}^{\\text{fixed}} = \\frac{1}{2} (f(u_i) + f(u_{i+1})) - \\frac{1}{2} \\psi\\left(\\frac{u_i + u_{i+1}}{2}\\right) (u_{i+1} - u_i)\n$$\n\n对于时间积分，使用一阶向前欧拉方法：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\n时间步长 $\\Delta t$ 受到 Courant–Friedrichs–Lewy (CFL) 稳定性条件的约束：\n$$\n\\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max_{j} |u_j^n|}\n$$\n给定 $\\mathrm{CFL} = 0.9$。\n\n在 $x=-1$ 和 $x=1$ 处的固定边界条件通过使用虚拟单元来实现。一个状态为 $u_0 = u_L = -1$ 的虚拟单元放置在域的左侧，另一个状态为 $u_{N_x+1} = u_R = 1$ 的虚拟单元放置在右侧。这些用于计算域边界处的通量 $F_{1/2}$ 和 $F_{N_x+1/2}$。\n\n对于 $u_L  u_R$ 的 Riemann 问题的精确解是一个稀疏波，由扇形区域内的自相似解 $u(x,t) = x/t$ 给出：\n$$\nu_{\\text{exact}}(x, t) = \\begin{cases}\nu_L  \\text{if } x/t \\le u_L \\\\\nx/t  \\text{if } u_L  x/t  u_R \\\\\nu_R  \\text{if } x/t \\ge u_R\n\\end{cases}\n$$\n对于给定的参数 $u_L=-1, u_R=1$，在最终时间 $T=0.3$ 的精确解是：\n$$\nu_{\\text{exact}}(x, 0.3) = \\begin{cases}\n-1  \\text{if } x/0.3 \\le -1 \\\\\nx/0.3  \\text{if } -1  x/0.3  1 \\\\\n1  \\text{if } x/0.3 \\ge 1\n\\end{cases}\n$$\n这个精确解用于计算数值结果的 $L^1$ 误差。\n\n在最终时间 $T = 0.3$ 计算以下度量：\n1.  离散 $L^1$ 误差：$E_{L^1} = \\sum_{i=1}^{N_x} |u_i(T) - u_{\\mathrm{exact}}(x_i, T)| \\Delta x$。\n2.  归一化最大单步跳跃：$J_{\\mathrm{norm}} = \\max_{i=0, \\dots, N_x} |u_{i+1}(T) - u_i(T)| / (u_R - u_L)$，其中 $u_0 = u_L$ 且 $u_{N_x+1} = u_R$。该度量用于量化任何伪激波的强度。\n3.  布尔激波指示器：如果 $J_{\\mathrm{norm}} > 0.1$，则 $B_{\\mathrm{shock}} = \\text{True}$，否则为 $\\text{False}$。\n\n实现将首先根据 Riemann 数据初始化解数组，然后向前步进时间直到 $T=0.3$。在每个时间步中，通过虚拟单元应用边界条件，使用熵修正计算通量，并更新解。最后，为每个测试用例计算并收集度量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the inviscid Burgers' equation for a rarefaction wave using a\n    first-order finite volume method with a Roe solver and an optional\n    Harten-Hyman entropy fix. It computes key error and shock metrics for a\n    suite of test cases.\n    \"\"\"\n    \n    # Test suite of parameter values (Nx, delta)\n    test_cases = [\n        (200, 0.0),  # Baseline without entropy fix\n        (200, 0.1),  # Mild entropy fix\n        (200, 1.0),  # Strong entropy fix\n        (50, 0.1),   # Coarse grid\n        (800, 0.1),  # Fine grid\n    ]\n\n    # Global parameters\n    uL = -1.0\n    uR = 1.0\n    T_final = 0.3\n    CFL = 0.9\n    domain_start = -1.0\n    domain_end = 1.0\n    shock_indicator_threshold = 0.1\n\n    all_results = []\n\n    for Nx, delta in test_cases:\n        # --- 1. Grid and Initial Conditions ---\n        dx = (domain_end - domain_start) / Nx\n        x_centers = np.linspace(domain_start + dx / 2, domain_end - dx / 2, Nx)\n        \n        # Initial condition: u(x,0) = uL for x0, uR for x>=0\n        u = np.where(x_centers  0, uL, uR)\n\n        t = 0.0\n        # --- 2. Time Evolution Loop ---\n        while t  T_final:\n            # Add ghost cells for boundary conditions\n            u_ext = np.concatenate(([uL], u, [uR]))\n\n            # --- 3. Compute time step based on CFL condition ---\n            max_speed = np.max(np.abs(u_ext))\n            if max_speed == 0:\n                # Avoid division by zero, though unlikely in this problem\n                dt = CFL * dx \n            else:\n                dt = CFL * dx / max_speed\n            \n            # Ensure the final time is not overshot\n            dt = min(dt, T_final - t)\n\n            # --- 4. Compute Numerical Fluxes with Entropy Fix ---\n            u_left = u_ext[:-1]\n            u_right = u_ext[1:]\n\n            f_left = 0.5 * u_left**2\n            f_right = 0.5 * u_right**2\n\n            # Roe-averaged speed\n            a_hat = 0.5 * (u_left + u_right)\n            \n            # Harten-Hyman entropy fix\n            abs_a_hat = np.abs(a_hat)\n            if delta > 0:\n                mask = abs_a_hat  delta\n                abs_a_hat[mask] = (a_hat[mask]**2 + delta**2) / (2 * delta)\n            \n            # Roe flux\n            flux = 0.5 * (f_left + f_right) - 0.5 * abs_a_hat * (u_right - u_left)\n\n            # --- 5. Update Solution ---\n            u = u - (dt / dx) * (flux[1:] - flux[:-1])\n            \n            t += dt\n\n        # --- 6. Post-Processing at T=T_final ---\n        # Compute exact solution\n        xi = x_centers / T_final\n        u_exact = np.piecewise(xi, [xi = uL, (xi > uL)  (xi  uR), xi >= uR],\n                                   [uL, lambda v: v, uR])\n        \n        # Metric 1: L1 error\n        E_L1 = np.sum(np.abs(u - u_exact)) * dx\n\n        # Metric 2: Normalized maximum jump\n        u_final_ext = np.concatenate(([uL], u, [uR]))\n        max_jump = np.max(np.abs(np.diff(u_final_ext)))\n        J_norm = max_jump / (uR - uL)\n\n        # Metric 3: Boolean shock indicator\n        B_shock = J_norm > shock_indicator_threshold\n\n        all_results.append([E_L1, J_norm, B_shock])\n    \n    # Print the results in the specified format\n    print(all_results)\n\nsolve()\n```"
        }
    ]
}