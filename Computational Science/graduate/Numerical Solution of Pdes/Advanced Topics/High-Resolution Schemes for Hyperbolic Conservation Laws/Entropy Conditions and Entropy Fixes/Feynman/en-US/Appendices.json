{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp why entropy fixes are indispensable in numerical methods, we must first return to the underlying partial differential equations. For conservation laws with nonconvex flux functions, the Rankine-Hugoniot condition alone is insufficient to guarantee a unique solution to a Riemann problem. This foundational exercise guides you through the analytical process of applying the entropy inequality to select the single, physically admissible solution from a multitude of mathematical possibilities, introducing the fascinating concept of composite waves that arise in these scenarios .",
            "id": "3386005",
            "problem": "Consider the scalar conservation law $u_{t} + f(u)_{x} = 0$ with flux $f(u) = u^{3} - u$. The Riemann problem consists of initial data $u(x,0) = u_{L}$ for $x < 0$ and $u(x,0) = u_{R}$ for $x > 0$. The concept of an entropy pair $(\\eta,q)$ for a scalar conservation law is defined by a convex entropy $\\eta(u)$ and an associated entropy flux $q(u)$ satisfying $q'(u) = \\eta'(u) f'(u)$, and admissibility across a shock requires the entropy inequality $[q] - s[\\eta] \\le 0$, where $s$ is the Rankine–Hugoniot speed $s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$ and $[\\cdot]$ denotes the jump of the quantity across the discontinuity. Using a convex entropy $\\eta(u)$, classify the admissible Riemann solutions for the flux $f(u) = u^{3} - u$ into shocks, rarefactions, or composite waves (combinations of rarefactions and shocks), explaining how the entropy inequality separates admissible from inadmissible branches when $f$ is nonconvex. Then, for the specific Riemann data $u_{L} = 1$ and $u_{R} = -1$, determine the admissible self-similar solution structure and compute the unique shock speed $s$ of the discontinuity in the entropy-admissible composite wave, using the convex entropy $\\eta(u) = \\frac{1}{2} u^{2}$. Express the final value of $s$ as an exact rational number.",
            "solution": "#### General Classification of Solutions\nThe given conservation law is $u_t + f(u)_x=0$ with flux $f(u)=u^3-u$. The characteristic speed is given by $f'(u) = 3u^2-1$. The flux is nonconvex because its second derivative, $f''(u)=6u$, changes sign at the inflection point $u=0$.\nSolutions to the Riemann problem, $u(x,0) = u_L$ for $x<0$ and $u_R$ for $x>0$, are self-similar, i.e., they are functions of $\\xi = x/t$. These solutions are composed of constant states, rarefaction waves, and shock waves.\n\n-   **Rarefaction Waves**: A continuous solution connecting states $u_1$ and $u_2$, where the characteristic speed $f'(u)$ is non-decreasing as $u$ traverses the wave profile. For $f'(u)=3u^2-1$, this is possible for $u_1 < u_2$ if the interval $[u_1, u_2]$ is within a region where $f'(u)$ is increasing (e.g., $0 \\le u_1 < u_2$) or for $u_1 > u_2$ if $f'(u)$ is decreasing (e.g., $u_1 > u_2$ and $u_1, u_2 \\le 0$).\n\n-   **Shock Waves**: A discontinuous solution connecting a state $u_L$ to $u_R$ that propagates with speed $s = [f]/[u] = (f(u_R)-f(u_L))/(u_R-u_L)$. For a nonconvex flux, a shock is admissible if it satisfies the entropy inequality $[q] - s[\\eta] \\le 0$ for every convex entropy function $\\eta(u)$. This is equivalent to the Oleinik entropy condition, which geometrically means that for a shock from $u_L$ to $u_R$:\n    -   if $u_L < u_R$, the chord connecting $(u_L, f(u_L))$ and $(u_R, f(u_R))$ must lie above the graph of $f(u)$ for all $u \\in (u_L, u_R)$.\n    -   if $u_L > u_R$, the chord must lie below the graph of $f(u)$ for all $u \\in (u_R, u_L)$.\nShocks that violate this condition are unstable and resolve into combinations of admissible shocks and rarefaction waves.\n\n-   **Composite Waves**: For nonconvex fluxes, the entropy-admissible solution connecting $u_L$ and $u_R$ may be a composition of shocks and rarefactions. The structure of this solution is determined by the convex or concave envelope of the flux function. For $u_L > u_R$ (as in our specific case), the solution corresponds to tracing the upper concave envelope of $f(u)$ on the interval $[u_R, u_L]$.\n\n#### Specific Solution for $u_L = 1, u_R = -1$\nWe are given $u_L=1$ and $u_R=-1$. Thus, $u_L > u_R$.\n$f(u_L) = f(1) = 1^3-1=0$.\n$f(u_R) = f(-1) = (-1)^3-(-1)=0$.\nA single shock connecting $u_L=1$ to $u_R=-1$ would have speed $s = \\frac{f(-1)-f(1)}{-1-1} = \\frac{0-0}{-2} = 0$. According to the Oleinik condition for $u_L>u_R$, the chord connecting $(1,0)$ and $(-1,0)$ must lie below the graph of $f(u)$ for all $u \\in (-1,1)$. The chord is the line $y=0$. However, for $u \\in (0,1)$, $f(u) = u^3-u < 0$. The condition is violated, so this shock is not admissible.\n\nThe solution must be a composite wave. Since $u_L>u_R$, the solution consists of waves ordered by decreasing speed from right to left (as $\\xi=x/t$ decreases). The structure that allows for a non-increasing solution profile $u(\\xi)$ is a rarefaction wave followed by a shock.\nThe structure is: $u_L=1 \\xrightarrow{\\text{Rarefaction}} u_m \\xrightarrow{\\text{Shock}} u_R=-1$.\n\n1.  **Rarefaction Wave**: A rarefaction connects $u_L=1$ to an intermediate state $u_m$. For a rarefaction from a state $u_1$ to $u_2$ with $u_1>u_2$, the characteristic speed $f'(u)$ must be decreasing on $[u_2, u_1]$. For our problem, this means $f'(u)=3u^2-1$ must decrease on $[u_m, 1]$. This is not possible as $f'(u)$ is increasing on $[0,1]$.\n    The logic must be reversed: the solution $u(\\xi)$ is a non-increasing function of $\\xi$. A rarefaction from $u_1$ to $u_2$ ($u_1 > u_2$) has characteristics that spread, with speeds from $f'(u_1)$ to $f'(u_2)$, requiring $f'(u_1) > f'(u_2)$.\n    The solution structure must be a rarefaction from $u_L=1$ to $u_m$ and a shock from $u_m$ to $u_R=-1$. Let's examine the speeds. The rarefaction speeds must be higher than the shock speed.\n    -   The rarefaction connects $u_L=1$ to $u_m < 1$. For the wave speeds $\\xi$ to be ordered correctly, we need $f'(u)$ to be increasing on $[u_m, 1]$. This holds if $u_m \\in [0, 1]$.\n    -   The shock connects $u_m$ to $u_R=-1$.\n    -   At the boundary between the rarefaction and the shock, the states must match, and the shock speed must equal the characteristic speed of the state it adjoins. This is a sonic condition: $s = f'(u_m)$.\n\n2.  **Determining $u_m$ and $s$**:\n    The shock speed $s$ is given by the Rankine-Hugoniot condition for the jump from $u_m$ to $-1$:\n    $$s = \\frac{f(u_R) - f(u_m)}{u_R - u_m} = \\frac{f(-1) - f(u_m)}{-1 - u_m} = \\frac{0 - (u_m^3 - u_m)}{-1 - u_m} = \\frac{-u_m(u_m-1)(u_m+1)}{-(u_m+1)} = u_m(u_m-1) = u_m^2 - u_m$$\n    The sonic condition is $s = f'(u_m) = 3u_m^2 - 1$.\n    Equating the two expressions for $s$:\n    $$u_m^2 - u_m = 3u_m^2 - 1$$\n    $$2u_m^2 + u_m - 1 = 0$$\n    Factoring the quadratic equation:\n    $$(2u_m - 1)(u_m + 1) = 0$$\n    This yields two possible values for the intermediate state: $u_m = 1/2$ or $u_m = -1$.\n    If $u_m=-1$, the rarefaction part vanishes, and we are left with the inadmissible shock from $1$ to $-1$.\n    Therefore, the only valid intermediate state is $u_m = 1/2$. This value lies in the interval $[0,1]$, which is consistent with the requirement for the rarefaction part.\n\n3.  **Calculating the Shock Speed**:\n    With $u_m = 1/2$, the shock connects $u_m=1/2$ to $u_R=-1$. The speed of this shock is:\n    $$s = u_m^2 - u_m = \\left(\\frac{1}{2}\\right)^2 - \\frac{1}{2} = \\frac{1}{4} - \\frac{1}{2} = -\\frac{1}{4}$$\n    The composite wave consists of a rarefaction from $u=1$ to $u=1/2$ filling the speeds $\\xi \\in [f'(1/2), f'(1)] = [-1/4, 2]$, followed by a shock from $u=1/2$ to $u=-1$ travelling at speed $s=-1/4$. The wave ordering is consistent:\n    - For $\\xi > 2 = f'(1)$, $u=1$.\n    - For $-1/4 < \\xi < 2$, we have a rarefaction connecting $u=1$ to $u=1/2$.\n    - At $\\xi = -1/4$, there is a shock from $u=1/2$ to $u=-1$.\n    - For $\\xi < -1/4$, $u=-1$.\n\n4.  **Entropy Condition Verification**:\n    Let's verify the shock from $u_m=1/2$ to $u_R=-1$ is admissible using $\\eta(u) = \\frac{1}{2}u^2$.\n    The shock is a discontinuity at $\\xi=s=-1/4$. At the shock, the state on the right is $u_{right}=1/2$, and the state on the left is $u_{left}=-1$.\n    In the entropy condition notation, we set $u_R \\to u_{right}$ and $u_L \\to u_{left}$.\n    So, $u_R = 1/2$ and $u_L=-1$.\n    The entropy flux $q(u)$ satisfies $q'(u) = \\eta'(u)f'(u) = u(3u^2-1) = 3u^3-u$. Integrating gives $q(u) = \\frac{3}{4}u^4 - \\frac{1}{2}u^2$.\n    We need to check $[q] - s[\\eta] \\le 0$, where $[v] = v(u_R) - v(u_L)$.\n    -   $[q] = q(1/2) - q(-1) = \\left(\\frac{3}{4}(\\frac{1}{16}) - \\frac{1}{2}(\\frac{1}{4})\\right) - \\left(\\frac{3}{4}(1) - \\frac{1}{2}(1)\\right) = (\\frac{3}{64} - \\frac{8}{64}) - (\\frac{1}{4}) = -\\frac{5}{64} - \\frac{16}{64} = -\\frac{21}{64}$.\n    -   $[\\eta] = \\eta(1/2) - \\eta(-1) = \\frac{1}{2}(\\frac{1}{4}) - \\frac{1}{2}(1) = \\frac{1}{8} - \\frac{1}{2} = -\\frac{3}{8}$.\n    -   $s = -1/4$.\n    Substituting these values into the inequality:\n    $$[q] - s[\\eta] = -\\frac{21}{64} - \\left(-\\frac{1}{4}\\right)\\left(-\\frac{3}{8}\\right) = -\\frac{21}{64} - \\frac{3}{32} = -\\frac{21}{64} - \\frac{6}{64} = -\\frac{27}{64}$$\n    Since $-27/64 \\le 0$, the entropy inequality is satisfied, and the shock is admissible.\n\nThe admissible self-similar solution is a composite wave consisting of a rarefaction from $u=1$ to $u=1/2$, followed by a shock from $u=1/2$ to $u=-1$. The unique shock speed in this solution is $s=-1/4$.",
            "answer": "$$ \\boxed{-\\frac{1}{4}} $$"
        },
        {
            "introduction": "Having established the theoretical necessity of an entropy condition, we now shift our focus to its practical implementation within a numerical scheme. This practice provides a concrete, hands-on calculation at the heart of a finite volume method: the numerical flux. You will confront the classic failure of the otherwise excellent Roe solver at a transonic rarefaction and see precisely how an entropy fix, in this case Harten's fix, introduces the exact amount of numerical dissipation needed to prevent the formation of a non-physical expansion shock .",
            "id": "3385955",
            "problem": "Consider the scalar conservation law (the inviscid Burgers equation) given by $u_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0$, posed as a Riemann problem with initial data $u(x,0) = u_{L}$ for $x < 0$ and $u(x,0) = u_{R}$ for $x > 0$. Let the left state be $u_{L} = 1$ and the right state be $u_{R} = -1$. You will work at the interface $x = 0$ in a finite volume method and approximate the intercell numerical flux by two different approximate Riemann solvers that are constructed via a flux-difference decomposition into a central, consistent part plus a dissipative correction built from characteristic information. \n\nUsing this decomposition, compute:\n- the intercell numerical flux obtained by the Lax–Friedrichs construction that uses the largest local characteristic speed,\n- the intercell numerical flux obtained by the Roe linearization equipped with Harten’s entropy fix, where the entropy-fix threshold is $\\delta = 0.2$ and the fix replaces the magnitude of any characteristic speed $|a|$ by a smoothed magnitude for small $|a|$.\n\nThen, calculate the difference between these two fluxes at $x=0$, defined as the Lax–Friedrichs flux minus the Roe-with-entropy-fix flux. Express your final answer as a single real number and round your answer to four significant figures. The quantity is dimensionless; do not include any units.",
            "solution": "The problem requires the computation and comparison of two different numerical fluxes for the inviscid Burgers' equation at a specific interface. The governing partial differential equation is a scalar conservation law:\n$$\nu_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0\n$$\nThe physical flux function is $f(u) = \\frac{1}{2}u^{2}$. The corresponding Jacobian, which represents the characteristic speed, is $a(u) = f'(u) = u$.\n\nThe problem is a Riemann problem with initial data given by a discontinuity at $x=0$:\n$$\nu(x,0) = \n\\begin{cases} \nu_{L} = 1 & \\text{for } x < 0 \\\\\nu_{R} = -1 & \\text{for } x > 0\n\\end{cases}\n$$\nWe are asked to compute the numerical flux $F(u_L, u_R)$ at the interface between the left state $u_L$ and the right state $u_R$. The general form of the numerical flux functions considered is a central differencing scheme with an added artificial dissipation term:\n$$\nF(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} D(u_L, u_R)\n$$\nwhere $D(u_L, u_R)$ is the dissipation term.\n\nFirst, we calculate the physical fluxes for the given states:\n$$\nf(u_L) = f(1) = \\frac{1}{2}(1)^2 = \\frac{1}{2}\n$$\n$$\nf(u_R) = f(-1) = \\frac{1}{2}(-1)^2 = \\frac{1}{2}\n$$\n\n**1. Lax–Friedrichs Numerical Flux ($F_{LF}$)**\n\nThe Lax-Friedrichs (LF) scheme uses a dissipation term based on the maximum local characteristic speed. The numerical flux is given by:\n$$\nF_{LF}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} c_{max} (u_R - u_L)\n$$\nwhere $c_{max}$ is the maximum magnitude of the characteristic speed in the local stencil, defined as $c_{max} = \\max(|a(u_L)|, |a(u_R)|)$.\nFor the Burgers' equation, $a(u)=u$, so we have:\n$$\nc_{max} = \\max(|u_L|, |u_R|) = \\max(|1|, |-1|) = 1\n$$\nNow, we substitute the values into the LF flux formula:\n$$\nF_{LF} = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right) - \\frac{1}{2}(1)(-1 - 1) = \\frac{1}{2}(1) - \\frac{1}{2}(-2) = \\frac{1}{2} + 1 = 1.5\n$$\n\n**2. Roe Numerical Flux with Harten's Entropy Fix ($F_{Roe}$)**\n\nThe Roe scheme linearizes the problem by introducing a Roe-averaged state. For a scalar equation, the Roe-averaged characteristic speed $\\tilde{a}$ must satisfy the Rankine-Hugoniot condition $f(u_R) - f(u_L) = \\tilde{a}(u_R - u_L)$. For the Burgers' equation, this gives:\n$$\n\\tilde{a} = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{\\frac{1}{2}(u_R - u_L)(u_R + u_L)}{u_R - u_L} = \\frac{1}{2}(u_L + u_R)\n$$\nFor the given states, the Roe speed is:\n$$\n\\tilde{a} = \\frac{1}{2}(1 + (-1)) = 0\n$$\nThe standard Roe flux is:\n$$\nF_{Roe, std}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} |\\tilde{a}| (u_R - u_L)\n$$\nSince $\\tilde{a} = 0$, the standard Roe flux has zero dissipation. This is a known failure point for the Roe scheme that occurs at sonic points, such as the stationary shock in this problem where the characteristic speeds span the wave speed ($a(u_L) > 0 > a(u_R)$). The lack of dissipation leads to an incorrect flux value. To correct this, an entropy fix is required.\n\nHarten's entropy fix modifies the dissipation term by replacing the absolute value function $|z|$ with a smoothed function $\\psi(z)$ when $|z|$ is small. The specified form is:\n$$\n\\psi(z) = \n\\begin{cases} \n|z| & \\text{if } |z| \\geq \\delta \\\\\n\\frac{z^2 + \\delta^2}{2\\delta} & \\text{if } |z| < \\delta\n\\end{cases}\n$$\nThe problem specifies an entropy-fix threshold of $\\delta = 0.2$. Our calculated Roe speed is $\\tilde{a} = 0$. Since $|\\tilde{a}| = 0 < 0.2$, we must use the smoothed formula:\n$$\n\\psi(\\tilde{a}) = \\psi(0) = \\frac{0^2 + (0.2)^2}{2(0.2)} = \\frac{(0.2)^2}{0.4} = \\frac{0.04}{0.4} = 0.1\n$$\nThe Roe flux with Harten's entropy fix is then:\n$$\nF_{Roe}(u_L, u_R) = \\frac{1}{2}\\left[f(u_L) + f(u_R)\\right] - \\frac{1}{2} \\psi(\\tilde{a}) (u_R - u_L)\n$$\nSubstituting the values:\n$$\nF_{Roe} = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right) - \\frac{1}{2}(0.1)(-1 - 1) = \\frac{1}{2}(1) - \\frac{1}{2}(0.1)(-2) = 0.5 - (-0.1) = 0.6\n$$\n\n**3. Difference between the Fluxes**\n\nFinally, we calculate the difference between the Lax-Friedrichs flux and the entropy-fixed Roe flux:\n$$\n\\Delta F = F_{LF} - F_{Roe} = 1.5 - 0.6 = 0.9\n$$\nThe problem requires the answer to be rounded to four significant figures. The exact value is $0.9$, which can be written as $0.9000$ to meet this requirement.",
            "answer": "$$\n\\boxed{0.9000}\n$$"
        },
        {
            "introduction": "The final step in connecting theory to practice is to move from a single flux calculation to a complete numerical simulation. This coding exercise allows you to witness the global impact of an entropy fix on the solution profile as it evolves in time. By implementing a finite volume solver for the inviscid Burgers' equation, you will directly observe the formation of a spurious expansion shock when no fix is applied and, more importantly, quantify its suppression and the recovery of the correct rarefaction structure once the Harten-Hyman entropy fix is activated .",
            "id": "3386017",
            "problem": "Consider the scalar conservation law model for inviscid fluid flow, the inviscid Burgers equation, which is a Partial Differential Equation (PDE) given by $u_t + f(u)_x = 0$ with $f(u) = \\tfrac{1}{2} u^2$. The physically relevant (entropy) solution is selected by the requirement that, for any convex entropy pair $(\\eta(u), q(u))$, the inequality $\\eta(u)_t + q(u)_x \\le 0$ holds in the sense of distributions. For Riemann initial data with left state $u_L$ and right state $u_R$ at an interface, the entropy solution contains a shock if $u_L > u_R$ and a rarefaction if $u_L < u_R$. Numerical schemes that violate the discrete entropy condition at transonic rarefactions can produce expansion shocks (spurious non-physical discontinuities) unless an entropy fix is applied.\n\nYour task is to implement a one-dimensional, first-order, explicit finite-volume method with a Roe-type approximate Riemann solver and an optional entropy fix of Harten–Hyman type. The computational domain is $x \\in [-1, 1]$, with $N_x$ uniform cells and fixed far-field boundary values $u(x \\le -1, t) = u_L$ and $u(x \\ge 1, t) = u_R$. Use Courant–Friedrichs–Lewy (CFL) number $\\mathrm{CFL} = 0.9$ for time stepping, and evolve to final time $T = 0.3$. The initial data is the Riemann problem $u(x, 0) = u_L$ for $x < 0$ and $u(x, 0) = u_R$ for $x \\ge 0$, with $u_L = -1$ and $u_R = 1$. The Roe linearization must be used to build numerical fluxes at interfaces, and an entropy fix must be implemented via a single parameter $\\delta \\ge 0$ as follows: in the sonic region of the Roe wave speed, replace the absolute value of the wave speed by a smooth function depending on $\\delta$; outside this region, leave it unchanged. When $\\delta = 0$, there is no entropy fix.\n\nCompute the exact solution for the rarefaction fan at time $T$ for comparison, based on the self-similar formulation $u(x, t) = \\xi$ with $\\xi = x/t$ in the fan region and constant states outside. Quantify the effect of the entropy fix by computing the following metrics:\n- The discrete $L^1$ error $E_{L^1} = \\sum_i |u_i(T) - u_{\\mathrm{exact}}(x_i, T)| \\Delta x$.\n- The normalized maximum one-step jump $J_{\\mathrm{norm}} = \\max_i |u_{i+1}(T) - u_i(T)| / (u_R - u_L)$, which serves as an indicator of spurious shock strength.\n- A boolean shock indicator $B_{\\mathrm{shock}}$ defined as $B_{\\mathrm{shock}} = \\text{True}$ if $J_{\\mathrm{norm}} > \\tau$, and $B_{\\mathrm{shock}} = \\text{False}$ otherwise, with threshold $\\tau = 0.1$.\n\nImplement the program to run the following test suite of parameter values $(N_x, \\delta)$:\n1. $(200, 0.0)$ as the baseline without entropy fix (expected spurious shock at the transonic rarefaction).\n2. $(200, 0.1)$ as a mild entropy fix (expected suppression of expansion shock and preservation of rarefaction).\n3. $(200, 1.0)$ as a strong entropy fix (expected over-smoothing, larger $L^1$ error but still suppression of spurious shock).\n4. $(50, 0.1)$ as a coarse-grid case (expected larger errors compared to the same fix on finer grids).\n5. $(800, 0.1)$ as a fine-grid case (expected smaller errors and smoother rarefaction).\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case yields a list $[E_{L^1}, J_{\\mathrm{norm}}, B_{\\mathrm{shock}}]$. For the entire test suite, print a single nested list\n$[[E_{L^1}^{(1)}, J_{\\mathrm{norm}}^{(1)}, B_{\\mathrm{shock}}^{(1)}], \\dots, [E_{L^1}^{(5)}, J_{\\mathrm{norm}}^{(5)}, B_{\\mathrm{shock}}^{(5)}]]$.\nAll quantities are dimensionless, and results should be printed as Python native types (floats and booleans) in the specified nested list format.",
            "solution": "The problem requires the numerical solution of the one-dimensional inviscid Burgers' equation, a prototype for scalar hyperbolic conservation laws:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} f(u) = 0\n$$\nwhere the flux function is $f(u) = \\frac{1}{2}u^2$. The computational domain is $x \\in [-1, 1]$, and the initial condition is a Riemann problem with a left state $u_L = -1$ and a right state $u_R = 1$ at $x=0$. Since $u_L < u_R$, the exact solution is a rarefaction wave.\n\nThe solution is constructed using a first-order explicit finite-volume method. The domain is discretized into $N_x$ uniform cells of width $\\Delta x = 2/N_x$. The cell centers are located at $x_i = -1 + (i - 1/2)\\Delta x$ for $i=1, \\dots, N_x$. The cell-averaged value of the solution in cell $i$ at time $t$ is denoted by $u_i(t)$.\n\nThe semi-discrete form of the finite-volume method is:\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$.\n\nThe numerical flux is determined using Roe's approximate Riemann solver. For the Burgers' equation, the Roe flux between a left state $u_L$ and a right state $u_R$ is given by:\n$$\nF(u_L, u_R) = \\frac{1}{2} (f(u_L) + f(u_R)) - \\frac{1}{2} |\\hat{a}(u_L, u_R)| (u_R - u_L)\n$$\nThe characteristic speed for Burgers' equation is $a(u) = f'(u) = u$. The Roe-averaged speed $\\hat{a}$ for this specific equation simplifies to the arithmetic mean:\n$$\n\\hat{a}(u_L, u_R) = \\frac{u_L + u_R}{2}\n$$\nThus, the numerical flux at the interface $x_{i+1/2}$ between cells $i$ and $i+1$ (with states $u_i$ and $u_{i+1}$) is:\n$$\nF_{i+1/2} = \\frac{1}{2} \\left( \\frac{1}{2}u_i^2 + \\frac{1}{2}u_{i+1}^2 \\right) - \\frac{1}{2} \\left| \\frac{u_i + u_{i+1}}{2} \\right| (u_{i+1} - u_i)\n$$\n\nA known deficiency of the standard Roe solver is its failure to satisfy the entropy condition across transonic rarefactions. For the given initial data $u_L = -1, u_R = 1$, the exact solution is a rarefaction fan centered at $x=0$. Near the center, numerical states will exist such that $u_i \\approx -u_{i+1}$, leading to a Roe speed $\\hat{a}_{i+1/2} \\approx 0$. When the speed is zero, the numerical dissipation term proportional to $|\\hat{a}|$ vanishes, and the scheme can generate a spurious, non-physical stationary shock (an expansion shock).\n\nTo remedy this, a Harten-Hyman entropy fix is applied. This fix modifies the absolute value of the Roe speed by introducing a minimum level of diffusion in sonic regions. Let $\\lambda = \\hat{a}_{i+1/2}$. The absolute value $|\\lambda|$ is replaced by a function $\\psi(\\lambda)$:\n$$\n\\psi(\\lambda) = \\begin{cases}\n|\\lambda| & \\text{if } |\\lambda| \\ge \\delta \\\\\n\\frac{\\lambda^2 + \\delta^2}{2\\delta} & \\text{if } |\\lambda| < \\delta\n\\end{cases}\n$$\nwhere $\\delta \\ge 0$ is a user-defined parameter. When $\\delta=0$, no fix is applied. The modified numerical flux is:\n$$\nF_{i+1/2}^{\\text{fixed}} = \\frac{1}{2} (f(u_i) + f(u_{i+1})) - \\frac{1}{2} \\psi\\left(\\frac{u_i + u_{i+1}}{2}\\right) (u_{i+1} - u_i)\n$$\n\nFor time integration, a first-order forward Euler method is used:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\nThe time step $\\Delta t$ is constrained by the Courant–Friedrichs–Lewy (CFL) condition for stability:\n$$\n\\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{\\max_{j} |u_j^n|}\n$$\nwith a given $\\mathrm{CFL} = 0.9$.\n\nThe fixed boundary conditions at $x=-1$ and $x=1$ are implemented using ghost cells. A ghost cell with state $u_0 = u_L = -1$ is placed to the left of the domain, and another with state $u_{N_x+1} = u_R = 1$ is placed to the right. These are used to compute the fluxes $F_{1/2}$ and $F_{N_x+1/2}$ at the domain boundaries.\n\nThe exact solution to the Riemann problem for $u_L < u_R$ is a rarefaction wave given by the self-similar solution $u(x,t) = x/t$ in the fan region:\n$$\nu_{\\text{exact}}(x, t) = \\begin{cases}\nu_L & \\text{if } x/t \\le u_L \\\\\nx/t & \\text{if } u_L < x/t < u_R \\\\\nu_R & \\text{if } x/t \\ge u_R\n\\end{cases}\n$$\nFor the given parameters $u_L=-1, u_R=1$, the exact solution at the final time $T=0.3$ is:\n$$\nu_{\\text{exact}}(x, 0.3) = \\begin{cases}\n-1 & \\text{if } x/0.3 \\le -1 \\\\\nx/0.3 & \\text{if } -1 < x/0.3 < 1 \\\\\n1 & \\text{if } x/0.3 \\ge 1\n\\end{cases}\n$$\nThis exact solution is used to compute the $L^1$ error of the numerical result.\n\nThe following metrics are computed at the final time $T = 0.3$:\n1.  The discrete $L^1$ error: $E_{L^1} = \\sum_{i=1}^{N_x} |u_i(T) - u_{\\mathrm{exact}}(x_i, T)| \\Delta x$.\n2.  The normalized maximum one-step jump: $J_{\\mathrm{norm}} = \\max_{i=0, \\dots, N_x} |u_{i+1}(T) - u_i(T)| / (u_R - u_L)$, where $u_0 = u_L$ and $u_{N_x+1} = u_R$. This metric quantifies the strength of any spurious shocks.\n3.  A boolean shock indicator: $B_{\\mathrm{shock}} = \\text{True}$ if $J_{\\mathrm{norm}} > 0.1$, and $\\text{False}$ otherwise.\n\nThe implementation will proceed by initializing the solution array based on the Riemann data, then stepping forward in time until $T=0.3$. In each time step, boundary conditions are applied via ghost cells, fluxes are computed with the entropy fix, and the solution is updated. Finally, the metrics are calculated and collected for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the inviscid Burgers' equation for a rarefaction wave using a\n    first-order finite volume method with a Roe solver and an optional\n    Harten-Hyman entropy fix. It computes key error and shock metrics for a\n    suite of test cases.\n    \"\"\"\n    \n    # Test suite of parameter values (Nx, delta)\n    test_cases = [\n        (200, 0.0),  # Baseline without entropy fix\n        (200, 0.1),  # Mild entropy fix\n        (200, 1.0),  # Strong entropy fix\n        (50, 0.1),   # Coarse grid\n        (800, 0.1),  # Fine grid\n    ]\n\n    # Global parameters\n    uL = -1.0\n    uR = 1.0\n    T_final = 0.3\n    CFL = 0.9\n    domain_start = -1.0\n    domain_end = 1.0\n    shock_indicator_threshold = 0.1\n\n    all_results = []\n\n    for Nx, delta in test_cases:\n        # --- 1. Grid and Initial Conditions ---\n        dx = (domain_end - domain_start) / Nx\n        x_centers = np.linspace(domain_start + dx / 2, domain_end - dx / 2, Nx)\n        \n        # Initial condition: u(x,0) = uL for x<0, uR for x>=0\n        u = np.where(x_centers < 0, uL, uR)\n\n        t = 0.0\n        # --- 2. Time Evolution Loop ---\n        while t < T_final:\n            # Add ghost cells for boundary conditions\n            u_ext = np.concatenate(([uL], u, [uR]))\n\n            # --- 3. Compute time step based on CFL condition ---\n            max_speed = np.max(np.abs(u_ext))\n            if max_speed == 0:\n                # Avoid division by zero, though unlikely in this problem\n                dt = CFL * dx \n            else:\n                dt = CFL * dx / max_speed\n            \n            # Ensure the final time is not overshot\n            dt = min(dt, T_final - t)\n\n            # --- 4. Compute Numerical Fluxes with Entropy Fix ---\n            u_left = u_ext[:-1]\n            u_right = u_ext[1:]\n\n            f_left = 0.5 * u_left**2\n            f_right = 0.5 * u_right**2\n\n            # Roe-averaged speed\n            a_hat = 0.5 * (u_left + u_right)\n            \n            # Harten-Hyman entropy fix\n            abs_a_hat = np.abs(a_hat)\n            if delta > 0:\n                mask = abs_a_hat < delta\n                abs_a_hat[mask] = (a_hat[mask]**2 + delta**2) / (2 * delta)\n            \n            # Roe flux\n            flux = 0.5 * (f_left + f_right) - 0.5 * abs_a_hat * (u_right - u_left)\n\n            # --- 5. Update Solution ---\n            u = u - (dt / dx) * (flux[1:] - flux[:-1])\n            \n            t += dt\n\n        # --- 6. Post-Processing at T=T_final ---\n        # Compute exact solution\n        xi = x_centers / T_final\n        u_exact = np.piecewise(xi, [xi <= uL, (xi > uL) & (xi < uR), xi >= uR],\n                                   [uL, lambda v: v, uR])\n        \n        # Metric 1: L1 error\n        E_L1 = np.sum(np.abs(u - u_exact)) * dx\n\n        # Metric 2: Normalized maximum jump\n        u_final_ext = np.concatenate(([uL], u, [uR]))\n        max_jump = np.max(np.abs(np.diff(u_final_ext)))\n        J_norm = max_jump / (uR - uL)\n\n        # Metric 3: Boolean shock indicator\n        B_shock = J_norm > shock_indicator_threshold\n\n        all_results.append([E_L1, J_norm, B_shock])\n    \n    # Print the results in the specified format\n    print(all_results)\n\nsolve()\n```"
        }
    ]
}