{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握“维度灾难”，我们需要亲眼见证它如何具体地影响数值算法。本练习将分析高维热方程这一基本偏微分方程。通过此实践，你将推导出显式方法的时间步长稳定性约束如何随着维度的增加而变得不切实际地严格，以及诸如交替方向隐式（ADI）方法和算子分裂法等更先进方法的计算成本如何随维度扩展，从而对这一挑战建立起定量的认识。",
            "id": "3454722",
            "problem": "考虑具有周期性边界条件的 $d$ 维环面上的时间相关热方程，\n$$\nu_{t} = \\Delta u \\quad \\text{on} \\quad \\mathbb{T}^{d},\n$$\n其中 $\\mathbb{T}^{d}$ 表示 $d$ 个长度为 $1$ 的圆的笛卡尔积。使用每维 $m$ 个点（假设 $m$ 为偶数）和网格间距 $h = \\frac{1}{m}$ 的均匀网格对空间进行离散化，并用标准的二阶中心差分算子来近似拉普拉斯算子 $\\Delta$，使得半离散系统具有以下形式\n$$\n\\frac{d \\mathbf{u}(t)}{dt} = A \\, \\mathbf{u}(t),\n$$\n其中 $A$ 是具有周期性边界条件的 $d$ 维离散拉普拉斯算子。令 $N = m^{d}$ 表示网格点的总数。\n\n仅使用傅里叶模、循环矩阵以及由负半定算子生成的收缩半群的基本性质，完成以下任务：\n\n1. 根据离散傅里叶模的指数推导 $A$ 的谱，并确定最小负特征值，将其表示为 $d$ 和 $h$ 的函数。\n\n2. 对于标量线性测试方程 $y'(t) = \\lambda y(t)$，当应用于半离散热方程时，刻画以下时间步进策略的稳定区域（即放大因子满足 $|G(z)| \\leq 1$ 的 $z = \\Delta t \\, \\lambda$ 的集合）：\n   - 交替方向隐式法（ADI），理解为一种标准的 Douglas 型分裂，它沿每个空间坐标使用隐式子步顺序求解。\n   - 指数积分法，它通过快速傅里叶变换（FFT）计算 $\\exp(\\Delta t A)$ 的精确作用。\n   - 算子分裂格式，例如在 $d$ 个坐标方向上的一阶 Lie 分裂和二阶 Strang 分裂。\n\n   证明后两种方法在此设置下是无条件稳定的，并讨论 ADI 对扩散算子无条件稳定的条件。\n\n3. 推导以下方法每个时间步的主阶运算量，将其表示为 $d$、$m$ 和 $N$ 的函数：\n   - ADI 法，沿每个坐标方向和每个网格线使用循环三对角求解，\n   - 指数积分法，用 $d$ 维 FFT 实现，\n   - 分裂法，通过沿每个坐标方向并在所有线上顺序执行一维 FFT 来实现。\n\n   用大 $\\mathcal{O}$ 符号将这些运算量表示为 $d$、$N$ 和 $\\log m$ 的函数。\n\n最后，作为量化显式方法维数灾难的基准，确定前向欧拉法应用于半离散系统 $d\\mathbf{u}/dt = A \\mathbf{u}$ 时的最大稳定时间步长 $\\Delta t_{\\max}$，并用 $d$ 和 $h$ 表示。将最终的 $\\Delta t_{\\max}$ 表示为单个封闭形式的解析表达式。无需四舍五入，最终表达式中也无需单位。",
            "solution": "该问题陈述经评估是有效的。它在科学上基于偏微分方程数值分析的原理，问题设定清晰一致，表述良好，并使用客观、正式的语言。它提出了一个标准但非平凡的问题，可以用已建立的数学技术严格解决。\n\n解答过程通过处理问题陈述中概述的每个任务来进行。\n\n### 1. 离散拉普拉斯算子的谱\n\n在 $d$ 维环面 $\\mathbb{T}^d$ 上的热方程 $u_t = \\Delta u$ 的半离散系统由 $\\frac{d\\mathbf{u}(t)}{dt} = A \\mathbf{u}(t)$ 给出，其中 $A$ 是一个矩阵，表示在网格间距为 $h = \\frac{1}{m}$ 且具有周期性边界条件的均匀网格上，对拉普拉斯算子 $\\Delta$ 的标准二阶有限差分近似。网格点的总数为 $N=m^d$。\n\n$A$ 算子可以表示为一维离散拉普拉斯算子的和：\n$$\nA = \\sum_{j=1}^{d} A_j\n$$\n其中 $A_j$ 表示第 $j$ 个坐标方向上的离散拉普拉斯算子。使用克罗内克积表示法，即为 $A = A_{1D} \\otimes I \\otimes \\dots \\otimes I + I \\otimes A_{1D} \\otimes \\dots \\otimes I + \\dots + I \\otimes \\dots \\otimes I \\otimes A_{1D}$，其中 $A_{1D}$ 是用于一维问题的 $m \\times m$ 矩阵。\n\n在一维情况下，对于网格点 $x_i = i h$（$i=0, \\dots, m-1$），$A_{1D}$ 对网格函数 $u$ 的作用由下式给出：\n$$\n(A_{1D} u)_i = \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2}\n$$\n由于周期性边界条件，索引在模 $m$ 意义下取值。这种结构使得 $A_{1D}$ 成为一个循环矩阵。任何 $m \\times m$ 循环矩阵的特征向量都是离散傅里叶模。波数为 $k \\in \\{0, 1, \\dots, m-1\\}$ 的离散傅里叶模是一个向量 $\\mathbf{v}_k$，其分量为 $(\\mathbf{v}_k)_j = \\exp(i 2 \\pi k x_j / L) = \\exp(i 2 \\pi k j / m)$，因为区域长度为 $L=1$。\n\n将 $A_{1D}$ 应用于 $\\mathbf{v}_k$：\n$$\n(A_{1D} \\mathbf{v}_k)_j = \\frac{\\exp(i \\frac{2\\pi k(j+1)}{m}) - 2\\exp(i \\frac{2\\pi k j}{m}) + \\exp(i \\frac{2\\pi k(j-1)}{m})}{h^2}\n$$\n$$\n= \\frac{\\exp(i \\frac{2\\pi k j}{m})}{h^2} \\left( \\exp(i \\frac{2\\pi k}{m}) - 2 + \\exp(-i \\frac{2\\pi k}{m}) \\right)\n$$\n$$\n= (\\mathbf{v}_k)_j \\frac{2}{h^2} \\left( \\cos(\\frac{2\\pi k}{m}) - 1 \\right)\n$$\n使用恒等式 $1 - \\cos(2\\theta) = 2\\sin^2(\\theta)$，上式变为：\n$$\n= (\\mathbf{v}_k)_j \\left( -\\frac{4}{h^2} \\sin^2(\\frac{\\pi k}{m}) \\right)\n$$\n因此，一维算子 $A_{1D}$ 的特征值为：\n$$\n\\lambda_{1D, k} = -\\frac{4}{h^2} \\sin^2\\left(\\frac{\\pi k}{m}\\right), \\quad \\text{for } k \\in \\{0, 1, \\dots, m-1\\}\n$$\n$d$ 维算子 $A$ 的特征值是组成它的一维算子特征值的和。$A$ 的一个特征向量是一维特征向量的张量积 $\\mathbf{v}_{\\mathbf{k}} = \\mathbf{v}_{k_1} \\otimes \\mathbf{v}_{k_2} \\otimes \\dots \\otimes \\mathbf{v}_{k_d}$，其中 $\\mathbf{k} = (k_1, \\dots, k_d)$ 是一个波数的多重索引，每个 $k_j \\in \\{0, 1, \\dots, m-1\\}$。对应的特征值 $\\lambda_{\\mathbf{k}}$ 为：\n$$\n\\lambda_{\\mathbf{k}} = \\sum_{j=1}^{d} \\lambda_{1D, k_j} = -\\frac{4}{h^2} \\sum_{j=1}^{d} \\sin^2\\left(\\frac{\\pi k_j}{m}\\right)\n$$\n这就是 $A$ 的谱。所有特征值都是实数且非正，因此 $A$ 是一个负半定算子。\n\n最小负特征值 $\\lambda_{\\min}(A)$ 出现在和 $\\sum_{j=1}^{d} \\sin^2(\\frac{\\pi k_j}{m})$ 最大化时。当 $\\theta = \\pi/2 + n\\pi$（$n$ 为整数）时，项 $\\sin^2(\\theta)$ 达到最大值 $1$。对于 $k_j \\in \\{0, \\dots, m-1\\}$，其参数为 $\\frac{\\pi k_j}{m}$。我们需要 $\\frac{\\pi k_j}{m} = \\frac{\\pi}{2}$，这给出 $k_j = m/2$。由于已知 $m$ 为偶数，所以 $k_j=m/2$ 是一个整数且是有效的波数。这对应于网格上可分辨的最高频率模态。为了最大化该和，我们必须对所有的 $j=1, \\dots, d$ 选择 $k_j = m/2$。\n$$\n\\lambda_{\\min}(A) = -\\frac{4}{h^2} \\sum_{j=1}^{d} \\sin^2\\left(\\frac{\\pi (m/2)}{m}\\right) = -\\frac{4}{h^2} \\sum_{j=1}^{d} \\sin^2\\left(\\frac{\\pi}{2}\\right) = -\\frac{4}{h^2} \\sum_{j=1}^{d} 1\n$$\n$$\n\\lambda_{\\min}(A) = -\\frac{4d}{h^2}\n$$\n\n### 2. 时间步进策略的稳定性\n\n对于 $y' = \\lambda y$ 的数值方法，如果放大因子 $G(z)$（其中 $z = \\Delta t \\lambda$）满足 $|G(z)| \\le 1$，则该方法是稳定的。对于系统 $\\mathbf{u}' = A\\mathbf{u}$，此条件必须对 $A$ 的每个特征值 $\\lambda_k$ 对应的 $z_k = \\Delta t \\lambda_k$ 都成立。由于所有 $\\lambda_k \\le 0$，我们只需要考虑 $z \\in [\\Delta t \\lambda_{\\min}, 0]$。\n\n- **指数积分法：** 该方法计算半离散系统在一个时间步长内的精确解：$\\mathbf{u}_{n+1} = \\exp(\\Delta t A) \\mathbf{u}_n$。放大算子为 $\\mathcal{G} = \\exp(\\Delta t A)$，放大因子为 $G(z_k) = \\exp(z_k) = \\exp(\\Delta t \\lambda_k)$。由于 $A$ 是负半定的，其特征值 $\\lambda_k$ 是非正的。因此，对于任何 $\\Delta t > 0$，都有 $\\Delta t \\lambda_k \\le 0$。放大因子的模为 $|G(z_k)| = |\\exp(\\Delta t \\lambda_k)| = \\exp(\\Delta t \\lambda_k) \\le \\exp(0) = 1$。此条件对所有特征值和任何 $\\Delta t > 0$ 的选择都成立。因此，指数积分法是无条件稳定的。这依赖于负半定算子生成一个收缩半群 $\\|\\exp(tA)\\|_2 \\le 1$（对于 $t \\ge 0$）的基本性质。\n\n- **算子分裂格式：** 算子 $A$ 被分裂为 $A = \\sum_{j=1}^d A_j$。\n  - 一阶 Lie 分裂通过 $\\mathcal{G}_{Lie} = \\prod_{j=1}^d \\exp(\\Delta t A_j)$ 来近似 $\\exp(\\Delta t A)$。\n  - 二阶 Strang 分裂使用对称乘积，例如 $\\mathcal{G}_{Strang} = \\exp(\\frac{\\Delta t}{2} A_1) \\dots \\exp(\\frac{\\Delta t}{2} A_d) \\exp(\\frac{\\Delta t}{2} A_d) \\dots \\exp(\\frac{\\Delta t}{2} A_1)$。\n  每个算子 $A_j$ 本身是一个一维离散拉普拉斯算子，因此是负半定的。因此，对于 $s > 0$，每个分量算子 $\\exp(s A_j)$ 都生成一个收缩，即 $\\|\\exp(s A_j)\\|_2 \\le 1$。Lie 分裂和 Strang 分裂的完整放大算子都是此类收缩算子的乘积。算子乘积的 $L_2$-范数受其范数乘积的限制。因此，$\\|\\mathcal{G}_{Lie}\\|_2 \\le \\prod_{j=1}^d \\|\\exp(\\Delta t A_j)\\|_2 \\le 1$，类似地 $\\|\\mathcal{G}_{Strang}\\|_2 \\le 1$。两种格式在 $L_2$-范数下对于任何 $\\Delta t > 0$ 都是无条件稳定的。\n\n- **交替方向隐式法 (ADI)：** ADI 方法将像 Crank-Nicolson 这样的方法的隐式算子 $(\\mathbf{I} - \\frac{\\Delta t}{2} A)$ 分解为易于求逆的一维算子的乘积，即 $\\prod_{j=1}^d (\\mathbf{I} - \\frac{\\Delta t}{2} A_j)$。对于具有可交换算子 $A_j$ 的扩散问题（如此处笛卡尔网格上的情况），ADI 格式的稳定性与其所近似的基础方法的稳定性相关。例如，基于 Crank-Nicolson 的 Douglas-Gunn 格式是无条件稳定的。对应于算子 $A_j$ 和特征值 $\\lambda_{1D,k_j}$ 的每个一维 Crank-Nicolson 步的放大因子是 $G_j = (1 + \\frac{\\Delta t}{2}\\lambda_{1D,k_j})/(1 - \\frac{\\Delta t}{2}\\lambda_{1D,k_j})$。由于 $\\lambda_{1D,k_j} \\le 0$，对于任何 $\\Delta t > 0$，都有 $|G_j| \\le 1$。傅里叶域中的总放大因子是这些项的乘积，其模也受 $1$ 的限制。因此，对于这个特定问题（线性、常系数、笛卡尔网格上的扩散），Douglas 类型的 ADI 格式是无条件稳定的。如果算子 $A_j$ 不可交换，这种稳定性可能会丧失，这在有混合导数、非笛卡尔网格或变系数的问题中会发生。\n\n### 3. 每个时间步的运算量\n\n令 $N=m^d$ 为网格点总数。\n\n- **ADI：** 该方法涉及求解 $d$ 个一维隐式系统序列。对于每个维度 $j$，必须求解 $m^{d-1}$ 个独立的一维系统，每个系统对应于该维度上的一个网格线。由于周期性边界条件，每个系统的大小为 $m \\times m$ 且是循环三对角的。一个循环三对角系统可以用 $\\mathcal{O}(m)$ 次运算求解（例如，使用 Sherman-Morrison 公式）。一个方向的总成本为 $m^{d-1} \\times \\mathcal{O}(m) = \\mathcal{O}(m^d) = \\mathcal{O}(N)$。因为要对 $d$ 个方向都执行此操作，所以每个时间步的总运算量为 $\\mathcal{O}(d N)$。\n\n- **指数积分法：** $\\exp(\\Delta t A)$ 的作用通过 FFT 计算。算法如下：(1) 对状态向量 $\\mathbf{u}_n$ 进行正向 $d$ 维 FFT；(2) 将变换后的向量与预先计算的因子 $\\exp(\\Delta t \\lambda_{\\mathbf{k}})$ 进行逐元素相乘；(3) 进行逆向 $d$ 维 FFT。在 $m \\times \\dots \\times m$ 网格上的 $d$ 维 FFT 是通过沿每个维度顺序应用大小为 $m$ 的一维 FFT 来执行的。沿着选定维度的所有 $m^{d-1}$ 条线上执行大小为 $m$ 的一维 FFT 的成本是 $m^{d-1} \\times \\mathcal{O}(m \\log m) = \\mathcal{O}(N \\log m)$。这对所有 $d$ 个维度都重复进行。因此，$d$ 维 FFT 的成本是 $\\mathcal{O}(d N \\log m)$。乘法步骤需要 $\\mathcal{O}(N)$。主要成本是正向和逆向 FFT，所以每个时间步的总运算量是 $\\mathcal{O}(d N \\log m)$。\n\n- **分裂法：** 像 Lie 分裂这样的分裂法涉及应用 $d$ 个形式为 $\\exp(\\Delta t A_j)$ 的算子。每次应用，例如 $\\mathbf{v} \\mapsto \\exp(\\Delta t A_j)\\mathbf{v}$，是在维度 $j$ 上对所有网格线进行的一维热方程求解。这可以通过使用一维 FFT 高效完成。对于维度 $j$ 中的 $m^{d-1}$ 条线中的每一条，执行一次正向一维 FFT，与指数因子相乘，然后进行一次逆向一维 FFT。一次这样的方向求解的成本是 $m^{d-1} \\times \\mathcal{O}(m \\log m) = \\mathcal{O}(N \\log m)$。由于在 Lie 分裂中有 $d$ 个这样的步骤（在 Strang 分裂中有 $\\mathcal{O}(d)$ 个步骤），所以每个时间步的总运算量是 $\\mathcal{O}(d N \\log m)$。\n\n### 最终任务：前向欧拉法的时间步长限制\n\n应用于 $\\frac{d\\mathbf{u}}{dt} = A\\mathbf{u}$ 的前向欧拉法由下式给出：\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t A \\mathbf{u}_n = (\\mathbf{I} + \\Delta t A) \\mathbf{u}_n\n$$\n放大算子是 $\\mathcal{G}(A) = \\mathbf{I} + \\Delta t A$。为了保证稳定性，其谱半径必须不大于 $1$。$\\mathcal{G}(A)$ 的特征值是 $g_k = 1 + \\Delta t \\lambda_k$，其中 $\\lambda_k$ 是 $A$ 的特征值。我们要求对所有的 $k$ 都有 $|g_k| \\le 1$。\n$$\n|1 + \\Delta t \\lambda_k| \\le 1\n$$\n由于特征值 $\\lambda_k$ 是实数且非正，这个不等式等价于：\n$$\n-1 \\le 1 + \\Delta t \\lambda_k \\le 1\n$$\n右侧不等式 $1+\\Delta t \\lambda_k \\le 1$ 意味着 $\\Delta t \\lambda_k \\le 0$，因为 $\\Delta t > 0$ 和 $\\lambda_k \\le 0$，所以这个条件总是满足的。\n左侧不等式 $-1 \\le 1 + \\Delta t \\lambda_k$ 意味着 $-2 \\le \\Delta t \\lambda_k$，或者 $\\Delta t (-\\lambda_k) \\le 2$。\n\n这个条件必须对所有特征值 $\\lambda_k$ 都成立。最严格的情况是对于模最大的特征值，即 $\\lambda_{\\min}(A)$。\n$$\n\\Delta t (-\\lambda_{\\min}(A)) \\le 2\n$$\n$$\n\\Delta t \\le \\frac{2}{-\\lambda_{\\min}(A)}\n$$\n因此，最大稳定时间步长 $\\Delta t_{\\max}$ 为 $\\frac{2}{-\\lambda_{\\min}(A)}$。从第 1 部分，我们推导出 $\\lambda_{\\min}(A) = -\\frac{4d}{h^2}$。代入这个值：\n$$\n\\Delta t_{\\max} = \\frac{2}{-(-4d/h^2)} = \\frac{2}{4d/h^2} = \\frac{2h^2}{4d} = \\frac{h^2}{2d}\n$$\n这个严格的限制，$\\Delta t_{\\max} \\propto h^2/d$，体现了显式方法的维数灾难，因为时间步长不仅要随着空间分辨率的提高而减小，还要随着维数的增加而减小。",
            "answer": "$$\n\\boxed{\\frac{h^{2}}{2d}}\n$$"
        },
        {
            "introduction": "在理解了问题的严重性之后，让我们探索一种强大的应对策略：利用解的内在结构。本练习将研究泊松方程，当其源项具有可分离结构时，其解可以被一个低秩张量有效表示，我们在此重点关注张量列（Tensor Train, TT）分解。通过分析解的张量列秩，你将看到对于特定类别的问题，表示解所需的参数数量可以做到与网格大小无关，并且仅弱依赖于维度，从而有效地打破维度灾难。",
            "id": "3454672",
            "problem": "考虑单位超立方体 $\\Omega=(0,1)^{d}$ 上的 $d$ 维泊松方程，其带有齐次狄利克雷边界条件：\n$$\n-\\Delta u(\\boldsymbol{x})=f(\\boldsymbol{x}), \\quad \\boldsymbol{x}=(x_{1},\\dots,x_{d})\\in\\Omega, \\qquad u|_{\\partial\\Omega}=0.\n$$\n假设右侧项在以下意义上是严格可分的，秩为 $r$：\n$$\nf(\\boldsymbol{x})=\\sum_{k=1}^{r}\\prod_{i=1}^{d} \\varphi_{ik}(x_{i}),\n$$\n并且，至关重要的是，对于每个 $i\\in\\{1,\\dots,d\\}$ 和 $k\\in\\{1,\\dots,r\\}$，因子 $\\varphi_{ik}$ 是 $(0,1)$ 上的一个一维狄利克雷特征函数：\n$$\n-\\frac{\\mathrm{d}^{2}}{\\mathrm{d}x^{2}} \\varphi_{ik}(x)=\\lambda_{ik}\\,\\varphi_{ik}(x), \\qquad \\varphi_{ik}(0)=\\varphi_{ik}(1)=0,\n$$\n其中 $\\lambda_{ik}>0$。同时假设 $r$ 个乘积函数 $\\left\\{\\prod_{i=1}^{d}\\varphi_{ik}(x_{i})\\right\\}_{k=1}^{r}$ 在 $L^{2}(\\Omega)$ 中是线性无关的。\n\n你使用标准的二阶中心有限差分格式，以 $N$ 个内部网格点对每个维度进行离散化，得到离散的 $d$ 维狄利克雷拉普拉斯算子，它是由 $d$ 个相同的一维三对角算子构成的克罗内克和，并将离散解表示为一个大小为 $N\\times\\cdots\\times N$ 的 $d$ 阶张量。\n\n仅从以下几点出发：\n- $(0,1)^{d}$ 上带有齐次狄利克雷边界条件的 $-\\Delta$ 的变量分离法，\n- 一维狄利克雷拉普拉斯算子的特征函数构成一个正交基，以及 $d$ 维拉普拉斯算子可被此类特征函数的张量积对角化的事实，\n- $d$ 阶数组的张量列（TT）分解和 TT 秩的定义，\n\n在精确算术下，推导离散解张量的所有 TT 分解中的最大 TT 秩的最小可能值，并将其表示为关于 $r$ 和 $d$ 的封闭形式表达式。你的推导必须指明该秩如何以及为何随 $r$ 缩放，为何它与 $N$ 无关，以及在所述可分性条件下它对 $d$ 的依赖性至多是弱的。\n\n给出你的最终答案，形式为单一的符号表达式。不要包含任何单位。不要四舍五入。",
            "solution": "用户希望找到一个特定的 $d$ 维泊松方程离散解的最大张量列（TT）秩的最小可能值。\n\n### 步骤1：问题验证\n\n**提取已知条件：**\n1.  **偏微分方程：** 单位超立方体 $\\Omega=(0,1)^{d}$ 上的 $d$ 维泊松方程，带有齐次狄利克雷边界条件：\n    $$-\\Delta u(\\boldsymbol{x})=f(\\boldsymbol{x}), \\quad \\boldsymbol{x}=(x_{1},\\dots,x_{d})\\in\\Omega, \\qquad u|_{\\partial\\Omega}=0.$$\n2.  **源项结构：** 右侧项 $f(\\boldsymbol{x})$ 是 $r$ 个可分函数的和：\n    $$f(\\boldsymbol{x})=\\sum_{k=1}^{r}\\prod_{i=1}^{d} \\varphi_{ik}(x_{i}).$$\n3.  **分量函数属性：** 每个因子 $\\varphi_{ik}(x_i)$ 是 $(0,1)$ 上的一个一维狄利克雷特征函数：\n    $$-\\frac{\\mathrm{d}^{2}}{\\mathrm{d}x^{2}} \\varphi_{ik}(x)=\\lambda_{ik}\\,\\varphi_{ik}(x), \\qquad \\varphi_{ik}(0)=\\varphi_{ik}(1)=0,$$\n    其中 $\\lambda_{ik}>0$。\n4.  **线性无关性：** $r$ 个乘积函数 $\\left\\{\\prod_{i=1}^{d}\\varphi_{ik}(x_{i})\\right\\}_{k=1}^{r}$ 在 $L^{2}(\\Omega)$ 中是线性无关的。\n5.  **离散化：** 使用标准的二阶中心有限差分格式，以 $N$ 个内部网格点对每个维度进行离散化。离散解是一个大小为 $N\\times\\cdots\\times N$ 的 $d$ 阶张量。\n6.  **出发前提：** 推导必须从 (a) 拉普拉斯算子的变量分离法，(b) 其特征函数的性质，以及 (c) 张量列（TT）分解和秩的定义出发。\n7.  **目标：** 推导离散解张量的最大 TT 秩的最小可能值，并将其表示为关于 $r$ 和 $d$ 的封闭形式表达式。\n\n**使用提取的已知条件进行验证：**\n该问题具有科学依据，是适定且客观的。它植根于偏微分方程数值分析和低秩张量分解的既定理论。前提条件在数学上是一致的，目标也定义明确。所有术语在这些领域中都是标准的。该问题结构是用于分析基于张量的求解器性能的标准模型问题。因此，该问题是有效的。\n\n### 步骤2：解张量结构的推导\n\n在 $(0,1)$ 上的一维狄利克雷特征函数是 $\\sin(m\\pi x)$，对于整数 $m \\ge 1$，其特征值为 $(m\\pi)^2$。因此，每个 $\\varphi_{ik}(x_i)$ 必须与 $\\sin(m_{ik}\\pi x_i)$ 成比例，其中 $m_{ik} \\ge 1$ 是某个整数模态。对应的特征值为 $\\lambda_{ik} = (m_{ik}\\pi)^2$。\n\n通过变量分离法，在 $\\Omega=(0,1)^d$ 上带有齐次狄利克雷边界条件的 $d$ 维拉普拉斯算子 $-\\Delta$ 的特征函数是一维特征函数的张量积：\n$$ \\Psi_{\\boldsymbol{m}}(\\boldsymbol{x}) = \\prod_{i=1}^{d} \\sin(m_i \\pi x_i) $$\n其中 $\\boldsymbol{m}=(m_1, \\dots, m_d)$ 是一个正整数的多重索引。对应的特征值为 $\\Lambda_{\\boldsymbol{m}} = \\sum_{i=1}^d (m_i \\pi)^2$。\n\n给定的源项 $f(\\boldsymbol{x})$ 是 $r$ 个此类特征函数的线性组合：\n$$ f(\\boldsymbol{x}) = \\sum_{k=1}^{r} C_k \\Psi_{\\boldsymbol{m}_k}(\\boldsymbol{x}) $$\n对于某些系数 $C_k$ 和不同的多重索引 $\\boldsymbol{m}_k = (m_{1k}, \\dots, m_{dk})$。乘积函数的线性无关条件确保了这 $r$ 个多重索引是不同的。\n\n解 $u(\\boldsymbol{x})$ 是通过将拉普拉斯算子的逆 $(-\\Delta)^{-1}$ 应用于 $f(\\boldsymbol{x})$ 得到的。由于 $\\Psi_{\\boldsymbol{m}_k}$ 是 $-\\Delta$ 的特征函数，我们有 $(-\\Delta)^{-1}\\Psi_{\\boldsymbol{m}_k} = \\Lambda_{\\boldsymbol{m}_k}^{-1} \\Psi_{\\boldsymbol{m}_k}$。解为：\n$$ u(\\boldsymbol{x}) = \\sum_{k=1}^{r} \\frac{C_k}{\\Lambda_{\\boldsymbol{m}_k}} \\Psi_{\\boldsymbol{m}_k}(\\boldsymbol{x}) = \\sum_{k=1}^{r} \\frac{C_k}{\\sum_{i=1}^{d} (m_{ik}\\pi)^2} \\prod_{i=1}^{d} \\sin(m_{ik} \\pi x_i). $$\n\n在每个维度上使用 $N$ 个内部网格点进行离散化后，连续函数和算子被其离散对应物所取代。\n- 函数 $\\sin(m\\pi x)$ 由一个向量 $\\mathbf{s}_m \\in \\mathbb{R}^N$ 表示，其分量是在网格点上计算的正弦函数值。这些向量 $\\{\\mathbf{s}_m\\}_{m=1}^N$ 是 $N \\times N$ 的一维有限差分拉普拉斯矩阵 $A_{1D}$ 的特征向量。令对应的离散特征值为 $\\mu_m$。\n- 特征函数 $\\Psi_{\\boldsymbol{m}_k}(\\boldsymbol{x})$ 由一个秩为1的张量 $T_k = \\mathbf{s}_{m_{1k}} \\otimes \\mathbf{s}_{m_{2k}} \\otimes \\dots \\otimes \\mathbf{s}_{m_{dk}}$ 表示。\n- 离散解是一个大小为 $N \\times \\dots \\times N$ 的 $d$ 阶张量 $U$。它是线性系统 $A U = F$ 的解，其中 $A$ 是离散的 $d$ 维拉普拉斯算子，$F$ 是 $f$ 的离散表示。$A$ 的特征向量是秩为1的张量 $T_k$，对应的特征值为 $\\Lambda'_k = \\sum_{i=1}^d \\mu_{m_{ik}}$。\n- 离散源张量为 $F = \\sum_{k=1}^r C'_k T_k$，对于某些系数 $C'_k$。\n- 因此，离散解张量 $U$ 由下式给出：\n$$ U = A^{-1}F = \\sum_{k=1}^{r} \\frac{C'_k}{\\Lambda'_{k}} T_k = \\sum_{k=1}^{r} \\gamma_k (\\mathbf{s}_{m_{1k}} \\otimes \\dots \\otimes \\mathbf{s}_{m_{dk}}) $$\n其中 $\\gamma_k = C'_k/\\Lambda'_{k}$。由于 $\\Lambda'_{k} > 0$ 并且我们假设源项非平凡 ($C'_k \\neq 0$)，所以系数 $\\gamma_k$ 非零。该表达式表明解张量 $U$ 是 $r$ 个秩为1的张量之和。由于构成张量 $U$ 的秩为1的张量 $\\{T_k\\}_{k=1}^r$ 是由与不同多重索引 $\\{\\boldsymbol{m}_k\\}_{k=1}^r$ 对应的正交向量构建的，它们在张量空间中形成一个正交集，因此是线性无关的。这意味着解张量 $U$ 的典范秩（或 CP 秩）恰好为 $r$。\n\n### 步骤3：张量列（TT）秩的推导\n\n一个张量的张量列（TT）秩被定义为其任何 TT 分解中的最小可能最大秩。设 TT 秩向量为 $(r_0, r_1, \\dots, r_d)$，其中 $r_0=r_d=1$。中间秩由张量的矩阵化（或展开）的秩定义：\n$$ r_p = \\text{rank}(U_{(p)}), \\quad p=1, \\dots, d-1 $$\n其中 $U_{(p)}$ 是一个大小为 $N^p \\times N^{d-p}$ 的矩阵，它是通过将张量 $U$ 的前 $p$ 个索引和后 $d-p$ 个索引分组重塑得到的。最大 TT 秩是 $\\max_{p=1,\\dots,d-1} r_p$。\n\n让我们来分析我们的解张量 $U$ 的秩 $r_p$：\n$$ U_{(p)} = \\left( \\sum_{k=1}^{r} \\gamma_k T_k \\right)_{(p)} = \\sum_{k=1}^{r} \\gamma_k (T_k)_{(p)}. $$\n每个 $(T_k)_{(p)}$ 是一个秩为1的矩阵，可以写成两个向量 $L_k \\in \\mathbb{R}^{N^p}$ 和 $R_k \\in \\mathbb{R}^{N^{d-p}}$ 的外积：\n$$ (T_k)_{(p)} = L_k R_k^T, $$\n其中 $L_k = \\mathbf{s}_{m_{1k}} \\otimes \\dots \\otimes \\mathbf{s}_{m_{pk}}$ 且 $R_k = \\mathbf{s}_{m_{p+1,k}} \\otimes \\dots \\otimes \\mathbf{s}_{m_{dk}}$。\n矩阵化 $U_{(p)}$ 是 $r$ 个秩为1的矩阵之和：\n$$ U_{(p)} = \\sum_{k=1}^{r} \\gamma_k L_k R_k^T. $$\n这个矩阵的秩至多为 $r$。要确定其确切值，我们必须考虑模态 $\\{m_{ik}\\}$ 的具体结构。\n\n考虑一个满足问题条件的特定模态选择。令对于所有 $i \\in \\{1, \\dots, d\\}$ 和 $k \\in \\{1, \\dots, r\\}$ 都有 $m_{ik} = k$。多重索引为 $\\boldsymbol{m}_k = (k, k, \\dots, k)$。对于 $k=1, \\dots, r$，这些索引是不同的，因此对应的乘积函数是线性无关的。\n对于这个选择，让我们计算 TT 秩。\n对于任何 $p \\in \\{1, \\dots, d-1\\}$，“左”向量为：\n$$ L_k = \\underbrace{\\mathbf{s}_k \\otimes \\dots \\otimes \\mathbf{s}_k}_{p \\text{ times}}. $$\n集合 $\\{L_k\\}_{k=1}^r$ 包含 $r$ 个向量。由于基向量 $\\{\\mathbf{s}_k\\}_{k=1}^N$ 是正交的，张量积 $\\{L_k\\}_{k=1}^r$ 也是正交的，因此是线性无关的。\n“右”向量为：\n$$ R_k = \\underbrace{\\mathbf{s}_k \\otimes \\dots \\otimes \\mathbf{s}_k}_{d-p \\text{ times}}. $$\n类似地，集合 $\\{R_k\\}_{k=1}^r$ 是线性无关的。\n矩阵化为 $U_{(p)} = \\sum_{k=1}^r \\gamma_k L_k R_k^T$。\n我们有 $r$ 个外积的和，其中左向量集合 $\\{L_k\\}$ 是线性无关的，右向量集合 $\\{R_k\\}$ 也是线性无关的。系数 $\\gamma_k = C'_k/(\\sum_i \\mu_{m_{ik}})$ 取决于特征值。在我们的情况下，$\\Lambda'_k = \\sum_{i=1}^d \\mu_k = d\\mu_k$。假设模态 $k$ 是不同的，那么特征值 $\\mu_k$ 也是不同的，因此系数 $\\gamma_k$ 也不同。在这些一般条件下，这个和的秩是 $r$。\n因此，对于这种模态选择，$r_p = r$ 对所有 $p=1, \\dots, d-1$ 成立。最大 TT 秩为 $\\max_p r_p = r$。\n\n这表明在问题的约束下，最大 TT 秩为 $r$ 是可以达到的。\n问题要求的是这个最大秩的*最小可能*值。这表明我们可以通过选择模态 $\\boldsymbol{m}_k$ 来降低最大秩。如推理所示，可以构建一些场景，使得特定的 TT 秩远小于 $r$。例如，如果对于某个 $p$ 和两个不同的索引 $k_1, k_2$，部分模态重合，例如 $(m_{1,k_1}, \\dots, m_{p,k_1}) = (m_{1,k_2}, \\dots, m_{p,k_2})$，那么秩 $r_p$ 可能会降低。然而，这种降低通常意味着对于其他秩，比如说 $r_{d-p}$，可能不会发生这种重合，从而可能导致那里的秩更高。\n\n然而，问题要求一个关于 $r$ 和 $d$ 的单一封闭形式表达式，这意味着结果对于模态的具体选择是鲁棒的。得出这样一个答案的最直接解释是，问题要求的是*泛型* TT 秩。对于 $r$ 个随机选择的秩为1的张量之和，其 TT 秩通常为 $r$（只要 $r$ 相对于维度不是过大）。对于泛型模态选择，所提供的特殊结构并不会从根本上改变这一结论。我上面的构造表明秩可以是 $r$。任何小于 $r$ 的值都将依赖于特定的、“非泛型”的模态选择，导致在每个矩阵化界面上都发生秩坍缩，而这是无法保证的。\n\n$r$ 这个值是一个鲁棒的上界。它也是一个可以达到的值。在没有特定模态选择可以保证在所有矩阵化中获得更低秩的情况下，最合理的通用答案就是这个可达到的最大值。这个值与 $N$ 无关（因为推导仅依赖于基向量的正交性，而不是它们的具体值或网格大小），并且对于 $d \\geq 2$，它对 $d$ 的依赖性不存在。它随 $r$ 线性缩放。这符合问题的描述性要求。",
            "answer": "$$\\boxed{r}$$"
        },
        {
            "introduction": "应对高维问题的另一主流策略是利用稀疏性原理，当我们需要从测量数据中识别一个未知的、高维的参数场时，这种方法尤其强大。本练习将运用压缩感知（Compressed Sensing, CS）的框架来求解一个椭圆型偏微分方程的逆问题，恢复其中的稀疏系数。这个动手编程实践将向你展示，如何利用稀疏性这一结构假设，从远少于未知数总量的测量数据中精确恢复一个具有指数级多自由度的函数，这是现代数据驱动科学计算的基石之一。",
            "id": "3454717",
            "problem": "考虑单位超立方体 $[0,1]^d$ 上的椭圆偏微分方程，其带有齐次狄利克雷（Dirichlet）边界条件，\n$$\n-\\Delta u + a(x) u = f(x),\n$$\n其中 $u$ 是状态，$f$ 是已知的强迫项，而 $a(x)$ 是待恢复的未知系数场。假设 $a(x)$ 在一个均匀网格上是稀疏的，每个坐标有 $n$ 个内点，因此总自由度为 $N = n^d$。设离散化由内部网格上负拉普拉斯算子 $-\\Delta$ 的经典有限差分（Finite Difference, FD）格式定义，得到一个对称正定矩阵 $K \\in \\mathbb{R}^{N \\times N}$ 和离散状态 $u \\in \\mathbb{R}^N$。离散模型为\n$$\n(K + D(a)) u = f,\n$$\n其中 $D(a)$ 表示由未知向量 $a \\in \\mathbb{R}^N$ 的元素构成的对角矩阵。考虑 $P$ 次探测实验，其强迫项为 $f_i \\in \\mathbb{R}^N$，并在由 $\\{p_m\\}_{m=1}^{M_{\\text{sensors}}}$ 索引的 $M_{\\text{sensors}}$ 个不同网格节点上测量状态。所有探测实验的总标量测量次数为 $M = P \\cdot M_{\\text{sensors}}$。\n\n假设系数 $a$ 的振幅很小，因此围绕背景 $a=0$ 进行线性化是合适的。令 $u_{0,i}$ 为第 $i$ 次探测的背景解，定义为\n$$\nK u_{0,i} = f_i.\n$$\n令 $u_i$ 为完整模型的解，\n$$\n(K + D(a)) u_i = f_i.\n$$\n通过减去背景来定义测量残差，\n$$\nr_{i,m} = u_i[p_m] - u_{0,i}[p_m].\n$$\n使用预解式 $(K + D(a))^{-1}$ 的一阶微扰分析，并忽略 $a$ 的高阶项，可以得到线性化关系\n$$\nr_{i,m} \\approx -\\sum_{j=1}^N G_{p_m,j}\\, u_{0,i}[j]\\, a[j],\n$$\n其中 $G = K^{-1}$ 是离散格林函数。将所有探测和传感器的结果堆叠起来，残差向量 $r \\in \\mathbb{R}^{M}$ 近似地与 $a$ 呈线性关系，\n$$\nr \\approx A a,\n$$\n其中感知矩阵 $A \\in \\mathbb{R}^{M \\times N}$ 的行定义为\n$$\nA_{(i,m),j} = - G_{p_m,j}\\, u_{0,i}[j],\n$$\n对于 $i \\in \\{1,\\dots,P\\}$，$m \\in \\{1,\\dots,M_{\\text{sensors}}\\}$ 和 $j \\in \\{1,\\dots,N\\}$。这是一个在偏微分方程（PDE）约束下的压缩测量模型。目标是通过最小化 $a$ 的 $\\ell_1$ 范数来恢复稀疏的 $a$，同时满足线性化的PDE约束。在实践中，由于线性化误差和数值噪声，使用了一种稳定的松弛形式：\n$$\n\\min_{a \\in \\mathbb{R}^N} \\frac{1}{2}\\,\\|A a - r\\|_2^2 + \\lambda \\|a\\|_1,\n$$\n这是在压缩感知（Compressed Sensing, CS）中被称为LASSO的最小二乘$\\ell_1$正则化公式。\n\n在适用于随机探测和感知的受限等距性质（Restricted Isometry Property, RIP）下，理论上的压缩感知保证指出，精确（或稳定）恢复所需的测量次数 $M$ 的规模为\n$$\nM \\gtrsim C\\, s \\log\\!\\left(\\frac{N}{s}\\right),\n$$\n其中 $s$ 是 $a$ 的稀疏度，$C>0$ 是一个通用常数。这种对 $N$ 的对数依赖性减轻了维度灾难，因为 $N=n^d$ 随 $d$ 指数增长，而 $\\log(N)$ 仅随 $d$ 线性增长。\n\n您的任务是编写一个完整、可运行的程序，该程序：\n- 为维度为 $d$、每轴有 $n$ 个点的均匀内部网格上的算子 $-\\Delta$ 构建有限差分矩阵 $K$（狄利克雷边界条件），使用网格间距 $h = 1/(n+1)$ 和 $K = \\frac{1}{h^2}\\sum_{k=1}^d L_k$，其中每个 $L_k$ 是与一个一维二阶差分矩阵 $T \\in \\mathbb{R}^{n \\times n}$ 的克罗内克（Kronecker）和贡献，该矩阵的对角线元素为 $2$，次对角线元素为 $-1$。\n- 生成一个稀疏的基准真相 $a^\\star \\in \\mathbb{R}^N$，其在随机位置上有 $s$ 个非零项，振幅在 $[0.02, 0.05]$ 范围内，并带有随机符号，以确保扰动较小。\n- 对每个测试用例，选择 $P$ 个随机探测强迫项 $f_i$（其元素为独立的标准正态分布），并无放回地均匀随机选择 $M_{\\text{sensors}} = M/P$ 个不同的传感器索引 $p_m$。\n- 通过求解完整的非线性离散PDE $(K + D(a^\\star))u_i = f_i$ 并减去传感器节点上的背景解 $K u_{0,i} = f_i$ 来形成测量残差 $r$。\n- 使用传感器节点上的离散格林函数行和背景解 $u_{0,i}$，通过上述公式构建线性化感知矩阵 $A$。\n- 通过使用迭代软阈值算法（Iterative Soft Thresholding Algorithm, ISTA）求解松弛的LASSO问题来恢复 $a$，该算法定义为\n$$\na^{(k+1)} = \\mathcal{S}_{\\lambda/L}\\!\\left(a^{(k)} - \\frac{1}{L} A^\\top(A a^{(k)} - r)\\right),\n$$\n其中 $\\mathcal{S}_{\\tau}(x) = \\operatorname{sign}(x)\\cdot \\max(|x|-\\tau,0)$ 是逐元素应用的软阈值算子，$L$ 是 $\\nabla \\left(\\frac{1}{2}\\|A a - r\\|_2^2\\right)$ 的利普希茨（Lipschitz）常数，等于 $A^\\top A$ 的最大特征值（通过幂迭代法估计）。使用 $\\lambda = \\alpha \\|r\\|_2/\\sqrt{M}$，其中 $\\alpha = 0.05$。\n- 通过相对误差评估恢复成功与否\n$$\n\\epsilon = \\frac{\\|a_{\\text{rec}} - a^\\star\\|_2}{\\|a^\\star\\|_2}\n$$\n如果 $\\epsilon \\leq 0.2$，则声明成功。\n- 计算压缩感知阈值\n$$\nM_{\\text{CS}} = \\left\\lceil C\\, s \\log\\!\\left(\\frac{N}{s}\\right)\\right\\rceil\n$$\n（其中 $C=4$），并在分析中报告所选的 $M$ 是高于还是低于此阈值，但程序的最终输出必须仅包含下面指定的布尔成功值。\n\n测试套件：\n- 用例1：$(d,n,s,M,P) = (1,32,3,30,5)$。\n- 用例2：$(d,n,s,M,P) = (2,10,5,60,5)$。\n- 用例3：$(d,n,s,M,P) = (3,6,8,120,6)$。\n- 用例4：$(d,n,s,M,P) = (3,6,8,80,5)$。\n- 用例5：$(d,n,s,M,P) = (2,12,20,120,6)$。\n\n所有角度（本问题中没有）如果出现，都将以弧度为单位。本问题中没有物理单位。使用自然对数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[ \\text{True}, \\text{False}, \\dots ]$），按上述顺序表示各用例的成功布尔值。确保程序是自包含的、确定性的，并使用固定的随机种子以保证可复现性。\n\n压缩感知（Compressed Sensing, CS）、受限等距性质（Restricted Isometry Property, RIP）、有限差分（Finite Difference, FD）和迭代软阈值算法（Iterative Soft Thresholding Algorithm, ISTA）在首次出现时必须如上文所定义。",
            "solution": "用户提供了一个有效、适定且有科学依据的问题。任务是模拟一个用于椭圆偏微分方程（PDE）中参数辨识的压缩感知实验，并报告几个测试用例的恢复成功情况。\n\n问题始于单位超立方体 $[0,1]^d$ 上的椭圆PDE：\n$$\n-\\Delta u + a(x) u = f(x)\n$$\n服从齐次狄利克雷（Dirichlet）边界条件。这里，$u$ 是解状态，$f(x)$ 是一个已知的强迫项，$a(x)$ 是我们旨在恢复的未知系数场。假设 $a(x)$ 是稀疏的。\n\n第一步是离散化PDE。使用一个在 $d$ 个维度上每个维度有 $n$ 个内点的均匀网格。因此，未知数的总数（自由度）为 $N = n^d$。网格间距为 $h = 1/(n+1)$。连续PDE使用二阶有限差分（FD）格式进行近似。负拉普拉斯算子 $-\\Delta$ 被离散化为一个对称正定矩阵 $K \\in \\mathbb{R}^{N \\times N}$。该矩阵被构造为来自每个空间维度的贡献之和：\n$$\nK = \\frac{1}{h^2} \\sum_{k=1}^d L_k\n$$\n每个矩阵 $L_k$ 代表沿第 $k$ 个坐标轴的二阶差分算子。它使用克罗内克积结构形成：\n$$\nL_k = I \\otimes \\dots \\otimes I \\otimes T \\otimes I \\otimes \\dots \\otimes I\n$$\n其中 $T \\in \\mathbb{R}^{n \\times n}$ 是一维二阶差分矩阵，对角线上为 $2$，超对角线和次对角线上为 $-1$，$I$ 是 $n \\times n$ 的单位矩阵。系数场 $a(x)$ 被离散化为一个向量 $a \\in \\mathbb{R}^N$。PDE的离散形式变成一个线性方程组：\n$$\n(K + D(a)) u = f\n$$\n其中 $u, f, a \\in \\mathbb{R}^N$ 是状态、强迫项和系数的离散版本，而 $D(a)$ 是由向量 $a$ 的元素构成的对角矩阵。\n\n逆问题是从 $u$ 的测量值中求出 $a$。测量过程涉及 $P$ 次实验，或称探测。对于每次探测 $i \\in \\{1, \\dots, P\\}$，施加一个已知的强迫项 $f_i$，并在 $M_{\\text{sensors}}$ 个特定的网格位置 $\\{p_m\\}_{m=1}^{M_{\\text{sensors}}}$ 上测量得到的状态 $u_i$。总标量测量次数为 $M = P \\cdot M_{\\text{sensors}}$。\n\n为了使问题易于处理，进行了线性化。我们假设系数 $a$ 代表了围绕背景 $a=0$ 的一个小扰动。第 $i$ 次探测的背景状态，记为 $u_{0,i}$，是未扰动问题的解：\n$$\nK u_{0,i} = f_i\n$$\n完整解为 $u_i = (K + D(a))^{-1}f_i$。使用预解式 $(K + D(a))^{-1}$ 在 $a=0$ 附近的的一阶泰勒展开，我们得到 $(K + D(a))^{-1} \\approx K^{-1} - K^{-1}D(a)K^{-1}$。令 $G = K^{-1}$ 为离散格林函数。解的扰动为 $\\delta u_i = u_i - u_{0,i} \\approx -K^{-1}D(a)K^{-1}f_i = -G D(a) u_{0,i}$。将对角矩阵 $D(a)$ 应用于 $u_{0,i}$ 等效于逐元素乘积。重新整理后，我们可以将扰动表示为 $a$ 的线性函数：$\\delta u_i = -G D(u_{0,i}) a$。\n测量残差定义为 $r_{i,m} = u_i[p_m] - u_{0,i}[p_m] = \\delta u_i[p_m]$。这导出了线性化关系：\n$$\nr_{i,m} \\approx \\left[ -G D(u_{0,i}) a \\right]_{p_m} = -\\sum_{j=1}^N G_{p_m,j} \\, u_{0,i}[j] \\, a[j]\n$$\n通过堆叠所有 $M$ 个测量值，我们得到一个线性系统 $r \\approx A a$，其中 $r \\in \\mathbb{R}^M$ 是所有残差的向量，$A \\in \\mathbb{R}^{M \\times N}$ 是感知矩阵，其行由以下公式给出：\n$$\nA_{(i,m),j} = -G_{p_m,j} \\, u_{0,i}[j]\n$$\n由于假设 $a$ 是稀疏的，这是一个压缩感知（CS）问题。基于矩阵 $A$ 的**受限等距性质（Restricted Isometry Property, RIP）**，CS的理论保证指出，一个稀疏向量可以从远小于其环境维度 $N$ 的测量次数 $M$ 中恢复，其规模为 $M \\gtrsim s \\log(N/s)$，其中 $s$ 是稀疏度。\n\n由于线性化误差和潜在的测量噪声，我们不寻求 $Aa=r$ 的精确解。相反，我们求解 LASSO（最小绝对收缩和选择算子）优化问题，它提供了一个稳定的恢复方法：\n$$\n\\min_{a \\in \\mathbb{R}^N} \\frac{1}{2}\\|A a - r\\|_2^2 + \\lambda \\|a\\|_1\n$$\n这里，$\\lambda > 0$ 是一个正则化参数，它平衡了数据保真度（最小二乘项）和稀疏性（$\\ell_1$范数项）。这个凸问题使用**迭代软阈值算法（Iterative Soft Thresholding Algorithm, ISTA）**来求解，这是一种近端梯度方法。更新规则是：\n$$\na^{(k+1)} = \\mathcal{S}_{\\lambda/L}\\left(a^{(k)} - \\frac{1}{L} A^\\top(A a^{(k)} - r)\\right)\n$$\n其中 $k$ 是迭代指数。$\\mathcal{S}_{\\tau}(x) = \\operatorname{sign}(x) \\cdot \\max(|x|-\\tau, 0)$ 是逐元素软阈值算子。步长 $1/L$ 由 $L$ 决定，$L$ 是最小二乘项梯度的利普希茨（Lipschitz）常数，它等于 $A^\\top A$ 的最大特征值。$L$ 使用幂迭代法估计。正则化参数设置为 $\\lambda = \\alpha \\|r\\|_2/\\sqrt{M}$，其中 $\\alpha = 0.05$。\n\n如果恢复的系数 $a_{\\text{rec}}$ 与基准真相 $a^\\star$ 之间的相对误差低于一个阈值，则认为恢复成功：\n$$\n\\epsilon = \\frac{\\|a_{\\text{rec}} - a^\\star\\|_2}{\\|a^\\star\\|_2} \\leq 0.2\n$$\n\n每个测试用例的步骤如下：\n1.  为给定的维度 $d$ 和网格大小 $n$ 构建矩阵 $K$。\n2.  生成一个大小为 $N=n^d$、具有 $s$ 个非零项的基准真相稀疏向量 $a^\\star$。\n3.  生成 $P$ 个随机强迫向量 $f_i$ 并选择 $M_{\\text{sensors}} = M/P$ 个随机传感器位置。\n4.  计算离散格林函数 $G = K^{-1}$。\n5.  对每次探测，计算背景解 $u_{0,i}=Gf_i$ 和完整的非线性解 $u_i = (K+D(a^\\star))^{-1}f_i$。\n6.  组装测量残差向量 $r \\in \\mathbb{R}^M$。\n7.  构建感知矩阵 $A \\in \\mathbb{R}^{M \\times N}$。\n8.  运行 ISTA 以获得恢复的系数向量 $a_{\\text{rec}}$。\n9.  计算相对误差 $\\epsilon$ 并确定恢复是否成功。\n然后报告所有测试用例的结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PDE-constrained compressed sensing problem for a suite of test cases.\n    \"\"\"\n    # Set a fixed random seed for reproducibility.\n    rng = np.random.default_rng(0)\n\n    # Test suite: (d, n, s, M, P)\n    test_cases = [\n        (1, 32, 3, 30, 5),\n        (2, 10, 5, 60, 5),\n        (3, 6, 8, 120, 6),\n        (3, 6, 8, 80, 5),\n        (2, 12, 20, 120, 6),\n    ]\n\n    results = []\n\n    for d, n, s, M, P in test_cases:\n        # 1. Setup\n        N = n**d\n        h = 1.0 / (n + 1)\n        \n        # Construct 1D second-difference matrix T\n        T = np.diag(np.full(n, 2.0)) - np.diag(np.full(n - 1, 1.0), k=1) - np.diag(np.full(n - 1, 1.0), k=-1)\n        \n        # Construct FD matrix K for the negative Laplacian\n        K = np.zeros((N, N))\n        I_n = np.eye(n)\n        for k in range(d):\n            L_k_terms = [I_n] * d\n            L_k_terms[k] = T\n            \n            L_k = L_k_terms[0]\n            for i in range(1, d):\n                L_k = np.kron(L_k, L_k_terms[i])\n            K += L_k\n        K /= h**2\n\n        # 2. Ground Truth, Probes, and Sensors\n        # Generate sparse ground truth a_star\n        a_star = np.zeros(N)\n        support = rng.choice(N, s, replace=False)\n        amplitudes = rng.uniform(0.02, 0.05, size=s)\n        signs = rng.choice([-1, 1], size=s)\n        a_star[support] = amplitudes * signs\n\n        # Generate probes and sensors\n        probes_f = [rng.standard_normal(size=N) for _ in range(P)]\n        M_sensors = M // P\n        sensor_indices = rng.choice(N, size=M_sensors, replace=False)\n\n        # 3. Simulate Measurements\n        # Compute discrete Green's function G = K^{-1}\n        # For N up to 216, direct inversion is feasible.\n        G = np.linalg.inv(K)\n\n        r = np.zeros(M)\n        A = np.zeros((M, N))\n        \n        K_plus_Da_star = K + np.diag(a_star)\n        \n        current_row = 0\n        for i in range(P):\n            f_i = probes_f[i]\n            \n            # Background solution\n            u_0_i = G @ f_i\n            \n            # Full nonlinear solution\n            u_i = np.linalg.solve(K_plus_Da_star, f_i)\n            \n            # Measurement residuals\n            r_block = u_i[sensor_indices] - u_0_i[sensor_indices]\n            \n            # Sensing matrix block for this probe\n            A_block = -G[sensor_indices, :] * u_0_i\n            \n            # Assemble into global r and A\n            r[current_row : current_row + M_sensors] = r_block\n            A[current_row : current_row + M_sensors, :] = A_block\n            current_row += M_sensors\n\n        # 4. Solve with ISTA\n        # Estimate Lipschitz constant L via power iteration\n        AtA = A.T @ A\n        v = rng.standard_normal(size=N)\n        v /= np.linalg.norm(v)\n        for _ in range(100):\n            v_new = AtA @ v\n            v_norm = np.linalg.norm(v_new)\n            if v_norm == 0:\n                break\n            v = v_new / v_norm\n        L = np.linalg.norm(AtA @ v)\n\n        # ISTA parameters\n        alpha = 0.05\n        lambda_val = alpha * np.linalg.norm(r) / np.sqrt(M)\n        n_iter_ista = 1000\n        \n        # Soft-thresholding operator\n        def soft_threshold(x, tau):\n            return np.sign(x) * np.maximum(np.abs(x) - tau, 0)\n\n        # ISTA main loop\n        a_rec = np.zeros(N)\n        if L > 1e-12: # Avoid division by zero if A is zero\n            step_size = 1.0 / L\n            tau = lambda_val * step_size\n            for _ in range(n_iter_ista):\n                grad = A.T @ (A @ a_rec - r)\n                a_rec = soft_threshold(a_rec - step_size * grad, tau)\n\n        # 5. Evaluate and Store Result\n        norm_a_star = np.linalg.norm(a_star)\n        if norm_a_star > 1e-12:\n            rel_error = np.linalg.norm(a_rec - a_star) / norm_a_star\n        else: # Should not happen with s > 0\n            rel_error = np.linalg.norm(a_rec)\n\n        success = rel_error = 0.2\n        results.append(success)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}