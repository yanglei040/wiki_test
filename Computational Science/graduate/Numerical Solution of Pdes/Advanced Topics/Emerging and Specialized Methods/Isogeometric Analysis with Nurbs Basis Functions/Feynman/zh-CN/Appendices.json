{
    "hands_on_practices": [
        {
            "introduction": "在验证数值代码的准确性时，“精确解方法”（Method of Manufactured Solutions）是一种强大而基础的技术。此练习将引导您完成该过程中的关键一步：对于一个在弯曲物理域上的偏微分方程，如何从一个在简单参数域上定义的光滑函数（即“人造解”）出发，精确推导出其对应的源项。这个过程的核心在于运用链式法则和几何变换，将物理域上的微分算子（如拉普拉斯算子）转换为参数域上的表达式，这需要您仔细处理由NURBS映射产生的雅可比矩阵和度量张量。通过这项实践，您将深刻理解几何映射如何改变偏微分方程的形式，这是等几何分析中连接几何与分析的基石。",
            "id": "3411193",
            "problem": "考虑一个弯曲物理域 $\\Omega$ 上的二维泊松方程 $-\\nabla_{x}\\cdot\\nabla_{x} u = f$。该物理域是通过一个光滑双射映射 $F:\\hat{\\Omega}\\to\\Omega$ 从参数正方形 $\\hat{\\Omega} = [0,1]^{2}$ 得到的非均匀有理B样条（NURBS）像。设NURBS映射由双线性（权重等于 $1$）曲面显式给出\n$$F(\\xi,\\eta) = \\big(x(\\xi,\\eta),y(\\xi,\\eta)\\big) = \\big(\\xi,\\,\\eta + c\\,\\xi\\,\\eta\\big),$$\n其中 $c$ 是一个固定的实参数，满足 $c>-1$，因此对于所有 $(\\xi,\\eta)\\in\\hat{\\Omega}$ 都有 $1+c\\,\\xi>0$。通过一个参数函数 $\\hat{u}:\\hat{\\Omega}\\to\\mathbb{R}$ 的拉回，规定 $u$ 来定义构造解：\n$$u(x,y) = \\hat{u}\\big(F^{-1}(x,y)\\big),\\qquad \\hat{u}(\\xi,\\eta) = \\sin(\\pi\\,\\xi)\\,\\sin(\\pi\\,\\eta).$$\n你的任务是推导泊松方程中以物理坐标 $(x,y)$ 表示的精确右端项 $f$，其形式应适用于使用NURBS基函数的等几何分析中的伽辽金误差验证。你必须从连接映射下的梯度和相应度量张量的基本几何守恒恒等式出发。具体来说，利用物理梯度是通过链式法则和 $F$ 的雅可比矩阵 $J_{F}(\\xi,\\eta)$ 从参数梯度得到的，以及拉普拉斯算子可以用参数坐标 $(\\xi,\\eta)$ 和度量张量 $G(\\xi,\\eta) = J_{F}(\\xi,\\eta)^{\\top}\\,J_{F}(\\xi,\\eta)$ 来表示。\n\n计算 $J_{F}$ 和 $G$，并使用 $G^{-1}$ 和 $\\det(G)$ 将物理拉普拉斯算子 $\\Delta_{x} u$ 用 $(\\xi,\\eta)$ 表示，然后对构造的 $\\hat{u}$ 进行求值。最后，通过代入从 $F$ 得到的逆映射 $(\\xi,\\eta)=F^{-1}(x,y)$，将你的答案完全用物理坐标 $(x,y)$ 表示。给出 $f(x,y)$ 的精确解析表达式，不得进行数值近似。无需单位，也不进行四舍五入。",
            "solution": "该问题是有效的。这是一个标准的、适定的偏微分方程数值分析问题，特别是在用于等几何分析中代码验证的构造解方法框架内。所有必要的数据和定义都已提供，该问题在科学上和数学上都是合理的。\n\n目标是在给定构造解 $u(x,y)$ 的情况下，求解泊松方程 $-\\Delta_{x} u = f$ 中的源项 $f(x,y)$。解 $u$ 是通过将参数域 $\\hat{\\Omega} = [0,1]^2$ 上的函数 $\\hat{u}(\\xi,\\eta)$ 拉回到物理域 $\\Omega$ 来定义的。映射为 $F:\\hat{\\Omega} \\to \\Omega$，由 $F(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta)) = (\\xi, \\eta+c\\xi\\eta)$ 给出。解为 $u(x,y) = \\hat{u}(F^{-1}(x,y))$，其中 $\\hat{u}(\\xi,\\eta) = \\sin(\\pi\\xi)\\sin(\\pi\\eta)$。\n\n该任务需要计算 $u$ 在物理坐标下的拉普拉斯算子，$\\Delta_x u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}$。这涉及到使用链式法则将物理空间偏导数算子 $(\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y})$ 用参数空间算子 $(\\frac{\\partial}{\\partial \\xi}, \\frac{\\partial}{\\partial \\eta})$ 来表示。\n\n首先，我们建立导数算子之间的关系。对于任意光滑函数 $g(x,y)$，其与 $F$ 的复合为 $\\hat{g}(\\xi, \\eta) = g(F(\\xi, \\eta))$。链式法则给出：\n$$ \\frac{\\partial \\hat{g}}{\\partial \\xi} = \\frac{\\partial g}{\\partial x}\\frac{\\partial x}{\\partial \\xi} + \\frac{\\partial g}{\\partial y}\\frac{\\partial y}{\\partial \\xi} \\quad \\text{和} \\quad \\frac{\\partial \\hat{g}}{\\partial \\eta} = \\frac{\\partial g}{\\partial x}\\frac{\\partial x}{\\partial \\eta} + \\frac{\\partial g}{\\partial y}\\frac{\\partial y}{\\partial \\eta} $$\n映射分量的偏导数是：\n$$ \\frac{\\partial x}{\\partial \\xi} = 1, \\quad \\frac{\\partial x}{\\partial \\eta} = 0, \\quad \\frac{\\partial y}{\\partial \\xi} = c\\eta, \\quad \\frac{\\partial y}{\\partial \\eta} = 1+c\\xi $$\n将这些代入链式法则方程：\n$$ \\frac{\\partial \\hat{g}}{\\partial \\xi} = \\frac{\\partial g}{\\partial x} + c\\eta \\frac{\\partial g}{\\partial y} $$\n$$ \\frac{\\partial \\hat{g}}{\\partial \\eta} = (1+c\\xi) \\frac{\\partial g}{\\partial y} $$\n从第二个方程，我们求解 $\\frac{\\partial g}{\\partial y}$：\n$$ \\frac{\\partial g}{\\partial y} = \\frac{1}{1+c\\xi} \\frac{\\partial \\hat{g}}{\\partial \\eta} $$\n将此代入第一个方程，我们可以求解 $\\frac{\\partial g}{\\partial x}$：\n$$ \\frac{\\partial \\hat{g}}{\\partial \\xi} = \\frac{\\partial g}{\\partial x} + c\\eta \\left( \\frac{1}{1+c\\xi} \\frac{\\partial \\hat{g}}{\\partial \\eta} \\right) \\implies \\frac{\\partial g}{\\partial x} = \\frac{\\partial \\hat{g}}{\\partial \\xi} - \\frac{c\\eta}{1+c\\xi} \\frac{\\partial \\hat{g}}{\\partial \\eta} $$\n这些表达式定义了作用于 $(\\xi, \\eta)$ 函数的物理导数算子：\n$$ \\frac{\\partial}{\\partial x} \\equiv D_x = D_\\xi - \\frac{c\\eta}{1+c\\xi} D_\\eta $$\n$$ \\frac{\\partial}{\\partial y} \\equiv D_y = \\frac{1}{1+c\\xi} D_\\eta $$\n其中 $D_\\xi = \\frac{\\partial}{\\partial \\xi}$ 和 $D_\\eta = \\frac{\\partial}{\\partial \\eta}$。\n\n接下来，我们通过将这些算子两次应用于 $u$ 来计算二阶偏导数，其中 $u$ 的参数表示为 $\\hat{u}$。\n对于 $\\frac{\\partial^2 u}{\\partial y^2}$：\n$$ \\frac{\\partial^2 u}{\\partial y^2} = D_y(D_y u) = \\left(\\frac{1}{1+c\\xi} D_\\eta\\right) \\left(\\frac{1}{1+c\\xi} D_\\eta \\hat{u}\\right) = \\frac{1}{(1+c\\xi)^2} D_\\eta^2 \\hat{u} = \\frac{1}{(1+c\\xi)^2} \\frac{\\partial^2 \\hat{u}}{\\partial \\eta^2} $$\n对于 $\\frac{\\partial^2 u}{\\partial x^2}$：\n$$ \\frac{\\partial^2 u}{\\partial x^2} = D_x(D_x u) = \\left(D_\\xi - \\frac{c\\eta}{1+c\\xi} D_\\eta\\right) \\left(D_\\xi \\hat{u} - \\frac{c\\eta}{1+c\\xi} D_\\eta \\hat{u}\\right) $$\n仔细应用乘法法则，合并同类项后得到：\n$$ \\frac{\\partial^2 u}{\\partial x^2} = \\frac{\\partial^2 \\hat{u}}{\\partial \\xi^2} - \\frac{2c\\eta}{1+c\\xi}\\frac{\\partial^2 \\hat{u}}{\\partial \\xi \\partial \\eta} + \\frac{c^2\\eta^2}{(1+c\\xi)^2}\\frac{\\partial^2 \\hat{u}}{\\partial \\eta^2} + \\frac{2c^2\\eta}{(1+c\\xi)^2}\\frac{\\partial \\hat{u}}{\\partial \\eta} $$\n参数坐标下的拉普拉斯算子是和 $\\Delta_x u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}$：\n$$ \\Delta_x u = \\frac{\\partial^2 \\hat{u}}{\\partial \\xi^2} - \\frac{2c\\eta}{1+c\\xi}\\frac{\\partial^2 \\hat{u}}{\\partial \\xi \\partial \\eta} + \\frac{1+c^2\\eta^2}{(1+c\\xi)^2}\\frac{\\partial^2 \\hat{u}}{\\partial \\eta^2} + \\frac{2c^2\\eta}{(1+c\\xi)^2}\\frac{\\partial \\hat{u}}{\\partial \\eta} $$\n现在，我们计算 $\\hat{u}(\\xi,\\eta) = \\sin(\\pi\\xi)\\sin(\\pi\\eta)$ 的必要导数：\n$$ \\frac{\\partial \\hat{u}}{\\partial \\eta} = \\pi\\sin(\\pi\\xi)\\cos(\\pi\\eta) $$\n$$ \\frac{\\partial^2 \\hat{u}}{\\partial \\xi^2} = -\\pi^2\\sin(\\pi\\xi)\\sin(\\pi\\eta) = -\\pi^2\\hat{u} $$\n$$ \\frac{\\partial^2 \\hat{u}}{\\partial \\eta^2} = -\\pi^2\\sin(\\pi\\xi)\\sin(\\pi\\eta) = -\\pi^2\\hat{u} $$\n$$ \\frac{\\partial^2 \\hat{u}}{\\partial \\xi \\partial \\eta} = \\pi^2\\cos(\\pi\\xi)\\cos(\\pi\\eta) $$\n将这些代入 $\\Delta_x u$ 的表达式中：\n$$ \\Delta_x u = -\\pi^2\\hat{u} - \\frac{2c\\eta}{1+c\\xi}(\\pi^2\\cos(\\pi\\xi)\\cos(\\pi\\eta)) + \\frac{1+c^2\\eta^2}{(1+c\\xi)^2}(-\\pi^2\\hat{u}) + \\frac{2c^2\\eta}{(1+c\\xi)^2}(\\pi\\sin(\\pi\\xi)\\cos(\\pi\\eta)) $$\n我们可以对各项进行分组：\n$$ \\Delta_x u = -\\pi^2\\hat{u} \\left(1 + \\frac{1+c^2\\eta^2}{(1+c\\xi)^2}\\right) - \\frac{2c\\eta\\pi^2}{1+c\\xi}\\cos(\\pi\\xi)\\cos(\\pi\\eta) + \\frac{2c^2\\eta\\pi}{(1+c\\xi)^2}\\sin(\\pi\\xi)\\cos(\\pi\\eta) $$\n最后一步是将此结果用物理坐标 $(x,y)$ 表示。我们需要逆映射 $F^{-1}(x,y)=(\\xi,\\eta)$。\n从 $x=\\xi$ 和 $y=\\eta(1+c\\xi)$，我们得到：\n$$ \\xi = x \\quad \\text{和} \\quad \\eta = \\frac{y}{1+cx} $$\n将这些代入 $\\Delta_x u$ 的表达式中：\n$$ \\Delta_x u(x,y) = -\\pi^2 \\sin(\\pi x)\\sin\\left(\\frac{\\pi y}{1+cx}\\right) \\left(1 + \\frac{1+c^2\\left(\\frac{y}{1+cx}\\right)^2}{(1+cx)^2}\\right) - \\frac{2c\\left(\\frac{y}{1+cx}\\right)\\pi^2}{1+cx}\\cos(\\pi x)\\cos\\left(\\frac{\\pi y}{1+cx}\\right) + \\frac{2c^2\\left(\\frac{y}{1+cx}\\right)\\pi}{(1+cx)^2}\\sin(\\pi x)\\cos\\left(\\frac{\\pi y}{1+cx}\\right) $$\n简化系数：\n$$ 1 + \\frac{1+c^2\\frac{y^2}{(1+cx)^2}}{(1+cx)^2} = \\frac{(1+cx)^2 + 1 + \\frac{c^2y^2}{(1+cx)^2}}{(1+cx)^2} = \\frac{(1+cx)^4 + (1+cx)^2 + c^2y^2}{(1+cx)^4} $$\n$$ \\frac{2c\\left(\\frac{y}{1+cx}\\right)\\pi^2}{1+cx} = \\frac{2c\\pi^2 y}{(1+cx)^2} $$\n$$ \\frac{2c^2\\left(\\frac{y}{1+cx}\\right)\\pi}{(1+cx)^2} = \\frac{2c^2\\pi y}{(1+cx)^3} $$\n综合起来：\n$$ \\Delta_x u(x,y) = -\\pi^2 \\sin(\\pi x)\\sin\\left(\\frac{\\pi y}{1+cx}\\right)\\frac{(1+cx)^4+(1+cx)^2+c^2y^2}{(1+cx)^4} - \\frac{2c\\pi^2 y}{(1+cx)^2}\\cos(\\pi x)\\cos\\left(\\frac{\\pi y}{1+cx}\\right) + \\frac{2c^2\\pi y}{(1+cx)^3}\\sin(\\pi x)\\cos\\left(\\frac{\\pi y}{1+cx}\\right) $$\n源项为 $f(x,y) = -\\Delta_x u(x,y)$。\n$$ f(x,y) = \\pi^2 \\sin(\\pi x)\\sin\\left(\\frac{\\pi y}{1+cx}\\right)\\frac{(1+cx)^4+(1+cx)^2+c^2y^2}{(1+cx)^4} + \\frac{2c\\pi y}{(1+cx)^3} \\cos\\left(\\frac{\\pi y}{1+cx}\\right) \\left(\\pi(1+cx)\\cos(\\pi x) - c\\sin(\\pi x)\\right) $$",
            "answer": "$$\\boxed{\\pi^2 \\sin(\\pi x)\\sin\\left(\\frac{\\pi y}{1+cx}\\right) \\frac{(1+cx)^4+(1+cx)^2+c^2y^2}{(1+cx)^4} + \\frac{2c\\pi y}{(1+cx)^3} \\cos\\left(\\frac{\\pi y}{1+cx}\\right) \\left( \\pi(1+cx)\\cos(\\pi x) - c\\sin(\\pi x) \\right)}$$"
        },
        {
            "introduction": "将连续的偏微分方程转化为离散的代数系统，核心步骤之一是在物理域上进行积分，以构建刚度矩阵和载荷向量。这项动手编程练习将向您展示如何通过将积分拉回到简单的参数正方形域来高效地完成这一任务。您将亲手实现雅可比行列式的计算，它作为局部面积的修正因子，并直观地观察到几何的曲率如何通过它来影响数值求积的权重。这个练习是连接理论与实际代码实现的重要桥梁，是任何有限元或等几何分析程序的基础。",
            "id": "3411147",
            "problem": "您的任务是实现对由非均匀有理B样条（NURBS）参数化的曲面片元的逐元素数值积分。从通过可微映射的面积分的回拉（pullback）出发，推导并实现一个程序，该程序使用高斯求积计算恒定标量场的曲面积分，并通过雅可比行列式显式地量化曲率如何影响求积权重。您的实现必须使用一个张量积NURBS曲面，其在角向具有二次基，在径向具有线性基，并且必须根据可微映射规则精确处理从参数正方形到物理平面的映射。\n\n基本基础：\n- 一个曲面片元由一个平滑映射 $S : [0,1]^2 \\to \\mathbb{R}^2$ 定义，其中 $(u,v) \\in [0,1]^2$ 是参数坐标，$(x,y) = S(u,v)$ 是物理坐标。\n- 曲面积分的变量替换公式表明，对于一个标量场 $f(x,y)$，\n$$\n\\int_{\\Omega} f(x,y) \\, dA = \\int_{[0,1]^2} f(S(u,v)) \\, \\left|\\det J(u,v)\\right| \\, du \\, dv,\n$$\n其中 $J(u,v)$ 是 $S$ 关于 $(u,v)$ 的偏导数雅可比矩阵，$\\left|\\det J(u,v)\\right|$ 是其行列式的绝对值。\n- 非均匀有理B样条（NURBS）曲面由张量积有理基函数构建。对于 $u$ 方向的次数 $p$ 和 $v$ 方向的次数 $q$，定义多项式B样条基函数 $N_i(u)$ 和 $M_j(v)$，其中 $i=0,\\dots,p$ 和 $j=0,\\dots,q$，以及正权重 $w_{ij}$。有理基函数为\n$$\nR_{ij}(u,v) = \\frac{N_i(u) M_j(v) w_{ij}}{W(u,v)}, \\quad W(u,v) = \\sum_{a=0}^{p}\\sum_{b=0}^{q} N_a(u) M_b(v) w_{ab}.\n$$\n曲面映射则为\n$$\nS(u,v) = \\sum_{i=0}^{p}\\sum_{j=0}^{q} R_{ij}(u,v) \\, P_{ij},\n$$\n其中 $P_{ij} \\in \\mathbb{R}^2$ 是控制点。\n- 高斯求积通过在特定节点上对函数求值的加权和来近似积分。对于每个参数方向，使用 $n_u$ 和 $n_v$ 个带权重的节点，并为 $[0,1]^2$ 形成张量积求积。\n\n要求：\n1. 构建一个单一的张量积NURBS曲面，在 $u$ 方向上使用二次基（$p=2$），在 $v$ 方向上使用线性基（$q=1$）。使用对应于单个元素的钳位节点矢量，因此多项式基简化为在 $[0,1]$ 上的伯恩斯坦多项式：\n   - 在 $u$ 方向，使用 $[0,1]$ 上的二次伯恩斯坦多项式：$N_0(u)$、$N_1(u)$、$N_2(u)$。\n   - 在 $v$ 方向，使用 $[0,1]$ 上的线性伯恩斯坦多项式：$M_0(v)$、$M_1(v)$。\n   提供它们关于 $u$ 和 $v$ 的一阶导数的一致定义。\n2. 通过圆弧和径向段的张量积，在平面中定义一个四分之一环形几何体。$u$ 方向对应于从 $0$ 到 $\\pi/2$ 的角坐标，$v$ 方向对应于径向坐标。使用一个 $3 \\times 2$ 的控制点网格：\n   - 对于每个半径 $r \\in \\{r_{\\mathrm{in}}, r_{\\mathrm{out}}\\}$，设置\n     $P_{0,\\cdot}(r) = (r, 0)$，\n     $P_{1,\\cdot}(r) = \\left(\\frac{r}{\\sqrt{2}}, \\frac{r}{\\sqrt{2}}\\right)$，\n     $P_{2,\\cdot}(r) = (0, r)$，\n     其中 $\\cdot$ 表示两个径向位置 $r=r_{\\mathrm{in}}$ 和 $r=r_{\\mathrm{out}}$。\n   - 对于沿圆弧的有理权重，使用 $(w_{0,\\cdot}, w_{1,\\cdot}, w_{2,\\cdot}) = \\left(1, \\frac{1}{\\sqrt{2}}, 1\\right)$，对两个径向位置重复此设置。这在 $u$ 方向上精确表示一个圆弧。\n3. 通过 $S(u,v)$ 关于 $u$ 和 $v$ 的一阶导数计算雅可比矩阵 $J(u,v)$，这些导数从有理基和控制点获得。\n4. 实现张量积高斯求积，在 $u$ 方向有 $n_u = 5$ 个节点，在 $v$ 方向有 $n_v = 5$ 个节点，从 $[-1,1]$ 映射到 $[0,1]$，并用这些来近似恒定标量场 $f(x,y)=1$ 在物理曲面上的积分。\n5. 通过计算所有求积节点上 $\\left|\\det J(u,v)\\right|$ 的极值，来量化弯曲几何对求积权重的影响。\n6. 实现以下参数集的测试套件，并为每个测试用例计算：\n   - 近似面积 $A \\approx \\sum w_u w_v \\left|\\det J(u,v)\\right|$。\n   - 在所有求积点上 $\\left|\\det J(u,v)\\right|$ 的最小值和最大值。\n   使用以下用例：\n   - 用例1（正常情况，有理圆环）：$r_{\\mathrm{in}} = 1.0$，$r_{\\mathrm{out}} = 2.0$，权重 $(1, 1/\\sqrt{2}, 1)$。\n   - 用例2（多项式，非有理几何）：$r_{\\mathrm{in}} = 1.0$，$r_{\\mathrm{out}} = 2.0$，权重 $(1, 1, 1)$。\n   - 用例3（边界情况，退化环）：$r_{\\mathrm{in}} = 1.5$，$r_{\\mathrm{out}} = 1.5$，权重 $(1, 1/\\sqrt{2}, 1)$。\n7. 最终输出格式：您的程序应生成单行输出，包含一个逗号分隔的三个子列表的列表，每个子列表按顺序对应一个测试用例，并包含三个浮点数 $[A, \\min|\\det J|, \\max|\\det J|]$。例如：“[[A1,min1,max1],[A2,min2,max2],[A3,min3,max3]]”。所有数字都表示为无单位的浮点数。\n\n您的程序必须是自包含的，并且能够按原样运行，不接受任何输入，并且必须遵守指定的执行环境和库。",
            "solution": "经过严格的验证过程，用户提供的问题被评估为 **有效** 的。该问题在微分几何和数值分析方面具有科学依据，问题设定良好，目标明确，数据充分，并且结构客观。它要求在等几何分析领域进行标准的、可验证的计算。\n\n该解决方案首先推导NURBS曲面及其导数的必要数学公式，然后实现一个数值算法来计算所需的量。\n\n**1. NURBS曲面参数化与基函数**\n\nNURBS曲面由一个从参数域（此处选择为单位正方形 $[0,1]^2$）到 $\\mathbb{R}^2$ 中物理域的映射 $S(u,v)$ 定义。该映射是一个有理函数，由下式给出：\n$$ S(u,v) = \\frac{\\sum_{i=0}^{p}\\sum_{j=0}^{q} N_i(u) M_j(v) w_{ij} P_{ij}}{\\sum_{a=0}^{p}\\sum_{b=0}^{q} N_a(u) M_b(v) w_{ab}} $$\n其中 $P_{ij} \\in \\mathbb{R}^2$ 是控制点，$w_{ij} > 0$ 是它们的相关权重，$N_i(u)$ 和 $M_j(v)$ 分别是次数为 $p$ 和 $q$ 的B样条基函数。\n\n对于这个问题，考虑使用钳位节点矢量的单个片元，这将B样条基函数简化为伯恩斯坦多项式。\n次数指定为 $u$ 方向为 $p=2$（二次），$v$ 方向为 $q=1$（线性）。\n\n基函数及其一阶导数如下：\n- 在 $u$ 方向（在 $[0,1]$ 上的二次伯恩斯坦多项式）：\n  - $N_0(u) = (1-u)^2$\n  - $N_1(u) = 2u(1-u)$\n  - $N_2(u) = u^2$\n  - $N_0'(u) = -2(1-u)$\n  - $N_1'(u) = 2 - 4u$\n  - $N_2'(u) = 2u$\n\n- 在 $v$ 方向（在 $[0,1]$ 上的线性伯恩斯坦多项式）：\n  - $M_0(v) = 1-v$\n  - $M_1(v) = v$\n  - $M_0'(v) = -1$\n  - $M_1'(v) = 1$\n\n**2. 曲面导数与雅可比矩阵**\n\n为了计算曲面面积，我们需要映射 $S(u,v)$ 的雅可比矩阵。让我们定义 $S(u,v)$ 的向量值分子和标量值分母为：\n$$ \\mathbf{A}(u,v) = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i(u) M_j(v) w_{ij} P_{ij} $$\n$$ W(u,v) = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i(u) M_j(v) w_{ij} $$\n曲面映射 $S(u,v) = \\mathbf{A}(u,v) / W(u,v)$ 的偏导数使用商法则求得：\n$$ \\frac{\\partial S}{\\partial u} = \\frac{1}{W^2} \\left( W \\frac{\\partial \\mathbf{A}}{\\partial u} - \\mathbf{A} \\frac{\\partial W}{\\partial u} \\right) \\quad \\text{和} \\quad \\frac{\\partial S}{\\partial v} = \\frac{1}{W^2} \\left( W \\frac{\\partial \\mathbf{A}}{\\partial v} - \\mathbf{A} \\frac{\\partial W}{\\partial v} \\right) $$\n$\\mathbf{A}(u,v)$ 和 $W(u,v)$ 的导数通过对其各自的和进行逐项微分得到：\n$$ \\frac{\\partial \\mathbf{A}}{\\partial u} = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i'(u) M_j(v) w_{ij} P_{ij} \\quad \\text{和} \\quad \\frac{\\partial W}{\\partial u} = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i'(u) M_j(v) w_{ij} $$\n$$ \\frac{\\partial \\mathbf{A}}{\\partial v} = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i(u) M_j'(v) w_{ij} P_{ij} \\quad \\text{和} \\quad \\frac{\\partial W}{\\partial v} = \\sum_{i=0}^{2}\\sum_{j=0}^{1} N_i(u) M_j'(v) w_{ij} $$\n雅可比矩阵 $J(u,v)$ 由偏导数向量构成，这些向量沿参数网格线与曲面相切：\n$$ J(u,v) = \\begin{bmatrix} \\frac{\\partial S_x}{\\partial u}  \\frac{\\partial S_x}{\\partial v} \\\\ \\frac{\\partial S_y}{\\partial u}  \\frac{\\partial S_y}{\\partial v} \\end{bmatrix} $$\n其行列式的绝对值 $|\\det J(u,v)|$ 是参数域和物理域之间的局部面积缩放因子。\n\n**3. 通过高斯求积进行数值积分**\n\n曲面片元的面积是恒定标量场 $f(x,y)=1$ 的积分，通过变量替换到参数域来计算：\n$$ \\mathrm{Area} = \\int_{\\Omega} 1 \\, dA = \\int_{0}^{1}\\int_{0}^{1} |\\det J(u,v)| \\, du \\, dv $$\n这个二维积分使用张量积高斯-勒让德求积法则进行数值近似。对于指定的 $u$ 方向 $n_u = 5$ 个节点和 $v$ 方向 $n_v = 5$ 个节点，我们首先获取区间 $[-1,1]$ 上的标准求积点 $\\{\\xi_k\\}$ 和权重 $\\{\\omega_k\\}$。这些点通过仿射变换 $u_k = (\\xi_k + 1)/2$ 映射到积分区间 $[0,1]$。相应的求积权重必须按此变换的雅可比行列式（即 $1/2$）进行缩放。因此，对于 $[0,1]$ 区间的权重是 $w_{u_k} = \\omega_k/2$。面积则通过离散求和来近似：\n$$ \\mathrm{Area} \\approx \\sum_{k=1}^{n_u} \\sum_{l=1}^{n_v} w_{u_k} w_{v_l} |\\det J(u_k, v_l)| $$\n其中 $(u_k, v_l)$ 是映射后的求积点。\n\n**4. 算法实现步骤**\n\n对于每个测试用例，整个算法按以下步骤进行：\n1.  **初始化几何**：根据指定的半径和权重向量，构建 $3 \\times 2$ 的控制点网格 $P_{ij}$ 和相应的 $3 \\times 2$ 权重矩阵 $w_{ij}$。\n2.  **准备求积**：获取 $[-1,1]$ 上的5个高斯-勒让德节点和权重，并将它们映射以创建 $[0,1]^2$ 域的求积法则。\n3.  **积分循环**：遍历 $n_u \\times n_v = 25$ 个求积点 $(u_k, v_l)$。在每个点上：\n    a.  评估伯恩斯坦基函数 $N_i(u_k)$, $M_j(v_l)$ 及其导数 $N_i'(u_k)$, $M_j'(v_l)$。\n    b.  通过对所有基函数、权重和控制点的贡献求和，计算 $W$ 和 $\\mathbf{A}$ 及其关于 $u$ 和 $v$ 的偏导数。\n    c.  应用商法则求出切向量 $\\frac{\\partial S}{\\partial u}$ 和 $\\frac{\\partial S}{\\partial v}$。\n    d.  计算雅可比矩阵的行列式 $\\det J(u_k, v_l)$。\n    e.  将加权贡献 $w_{u_k} w_{v_l} |\\det J(u_k, v_l)|$ 添加到面积的运行总和中。\n    f.  存储 $|\\det J(u_k, v_l)|$ 的值以供后续分析。\n4.  **汇总结果**：循环结束后，累加的总和即为近似面积 $A$。从存储的雅可比行列式列表中找出最小值和最大值。\n\n对所有指定的测试用例执行此过程以生成最终结果。$|\\det J|$ 在求积点上的变化提供了一个NURBS映射引入的几何畸变的定量度量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the area and Jacobian determinant statistics for NURBS surfaces.\n    \"\"\"\n    # Test cases: (r_in, r_out, weights_u)\n    test_cases = [\n        (1.0, 2.0, np.array([1.0, 1.0 / np.sqrt(2.0), 1.0])),\n        (1.0, 2.0, np.array([1.0, 1.0, 1.0])),\n        (1.5, 1.5, np.array([1.0, 1.0 / np.sqrt(2.0), 1.0])),\n    ]\n\n    # Gaussian quadrature parameters for a 5-point rule\n    n_points = 5\n    gauss_points, gauss_weights = np.polynomial.legendre.leggauss(n_points)\n\n    # Map nodes and weights from [-1, 1] to [0, 1]\n    # For a function f(x) on [0,1], integral is approx. sum(w_i * f(x_i))\n    # where x_i = (p_i+1)/2 and w_i = q_i/2\n    q_points = 0.5 * (gauss_points + 1)\n    q_weights = 0.5 * gauss_weights\n\n    # --- Basis Functions and their Derivatives ---\n    # Quadratic Bernstein polynomials for u in [0,1]\n    N_funcs = [\n        lambda u: (1 - u)**2,\n        lambda u: 2 * u * (1 - u),\n        lambda u: u**2\n    ]\n    # Derivatives of quadratic Bernstein polynomials\n    dN_du_funcs = [\n        lambda u: -2 * (1 - u),\n        lambda u: 2 - 4 * u,\n        lambda u: 2 * u\n    ]\n    # Linear Bernstein polynomials for v in [0,1]\n    M_funcs = [\n        lambda v: 1 - v,\n        lambda v: v\n    ]\n    # Derivatives of linear Bernstein polynomials\n    dM_dv_funcs = [\n        lambda v: -1.0,\n        lambda v: 1.0\n    ]\n\n    results = []\n    for r_in, r_out, weights_u in test_cases:\n        # --- Define Geometry: Control Points and Weights ---\n        # Control points P[i, j, coord] for a 3x2 grid\n        P = np.zeros((3, 2, 2))\n        radii = [r_in, r_out]\n        \n        for j in range(2): # 0 for r_in, 1 for r_out\n            r = radii[j]\n            P[0, j, :] = [r, 0.0]\n            P[1, j, :] = [r / np.sqrt(2.0), r / np.sqrt(2.0)]\n            P[2, j, :] = [0.0, r]\n\n        # Weights w[i, j] for a 3x2 grid\n        weights = np.zeros((3, 2))\n        weights[:, 0] = weights_u\n        weights[:, 1] = weights_u\n\n        # --- Numerical Integration ---\n        total_area = 0.0\n        det_J_values = []\n\n        for k in range(n_points):\n            u = q_points[k]\n            wu = q_weights[k]\n            \n            # Evaluate u-basis functions and derivatives\n            N_vals = np.array([f(u) for f in N_funcs])\n            dN_du_vals = np.array([f(u) for f in dN_du_funcs])\n\n            for l in range(n_points):\n                v = q_points[l]\n                wv = q_weights[l]\n\n                # Evaluate v-basis functions and derivatives\n                M_vals = np.array([f(v) for f in M_funcs])\n                dM_dv_vals = np.array([f(v) for f in dM_dv_funcs])\n\n                # --- Calculate S(u,v) derivatives using the quotient rule ---\n                # S(u,v) = A(u,v) / W(u,v)\n                \n                # W and its derivatives\n                W_ij = np.outer(N_vals, M_vals) * weights\n                W = np.sum(W_ij)\n                \n                dW_du_ij = np.outer(dN_du_vals, M_vals) * weights\n                dW_du = np.sum(dW_du_ij)\n\n                dW_dv_ij = np.outer(N_vals, dM_dv_vals) * weights\n                dW_dv = np.sum(dW_dv_ij)\n\n                # A and its derivatives (A is a 2D vector)\n                A = np.einsum('ij,ijk->k', W_ij, P)\n                dA_du = np.einsum('ij,ijk->k', dW_du_ij, P)\n                dA_dv = np.einsum('ij,ijk->k', dW_dv_ij, P)\n\n                # Apply quotient rule for dS/du and dS/dv\n                # dS_du and dS_dv are 2D vectors (tangents)\n                dS_du = (dA_du * W - A * dW_du) / (W**2)\n                dS_dv = (dA_dv * W - A * dW_dv) / (W**2)\n                \n                # Jacobian determinant\n                det_J = dS_du[0] * dS_dv[1] - dS_du[1] * dS_dv[0]\n                abs_det_J = np.abs(det_J)\n                \n                det_J_values.append(abs_det_J)\n                total_area += wu * wv * abs_det_J\n\n        min_det_J = np.min(det_J_values)\n        max_det_J = np.max(det_J_values)\n        \n        results.append([total_area, min_det_J, max_det_J])\n\n    # Format the final output string exactly as required\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        output_str += f\"[{res[0]},{res[1]},{res[2]}]\"\n        if i  len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在等几何分析中，基函数的选择不仅提供了精确的几何表示，还决定了最终线性系统的结构特性。这个概念性问题旨在挑战您分析基函数的支撑集、单元间的连续性等属性如何转化为矩阵的稀疏性和带宽。理解这些联系对于预测计算性能和选择高效的线性求解器至关重要。通过对比一维和二维情况，您将深入体会到等几何方法与传统有限元方法在系统矩阵结构上的异同。",
            "id": "3411112",
            "problem": "考虑在等几何分析中，使用非均匀有理B样条（NURBS）对椭圆型偏微分方程进行标准的伽辽金离散化。令 $R_i$ 表示由定义在具有正权重的开放、均匀节点向量上的 $p$ 次B样条获得的NURBS基函数，因此每个 $R_i$ 都继承了其底层B样条的紧支集和连续性。在一维空间中，刚度矩阵定义为\n$$\nK_{ij} \\;=\\; \\int_{0}^{1} R_i'(x)\\,R_j'(x)\\,\\mathrm{d}x,\n$$\n在二维空间中定义为\n$$\nK_{(i,j),(i',j')} \\;=\\; \\int_{\\Omega} \\nabla R_{i,j}(\\boldsymbol{\\xi})\\cdot\\nabla R_{i',j'}(\\boldsymbol{\\xi})\\,\\mathrm{d}\\boldsymbol{\\xi},\n$$\n其中 $\\Omega=[0,1]^2$，$R_{i,j}$ 是在 $\\xi_x$ 和 $\\xi_y$ 方向上次数分别为 $p_x$ 和 $p_y$ 的张量积NURBS基，索引对 $(i,j)$ 枚举了沿每个参数方向的基函数。\n\n你通过在每个当前节点区间内沿细化方向插入一个重数为1的内部节点来进行均匀 $h$-细化（即，没有次数提升或 $k$-细化）。假设细化后内部节点的重数保持为1，因此内部连续性在一维情况下为 $C^{p-1}$，在二维情况下为 $C^{p_x-1}$/$C^{p_y-1}$。对于二维矩阵，假设采用字典序，其中 $x$-索引 $i$ 变化最快，即全局行/列索引映射为 $k=i+N_x j$，其中 $N_x$ 是 $x$ 方向上基函数的数量。\n\n基于基本原理——B样条的紧支集、由节点重数决定的连续性、以及定义伽辽金矩阵中非零项的重叠结构——选择所有正确描述这种均匀节点插入对稀疏模式和矩阵带宽影响的陈述：\n\nA. 在一维情况下，对于固定的次数 $p$ 和内部重数1，均匀节点插入保持半带宽和每内部行的非零元数量不变（边界效应除外），因为每个基函数在其两侧最多与 $p$ 个相邻基函数重叠，从而产生一个固定的带状模板。\n\nB. 在一维情况下，NURBS中的有理分母在均匀节点插入下产生全局耦合，导致刚度矩阵变得稠密，并且半带宽随着节点区间的数量增长。\n\nC. 在二维情况下，对于固定的次数 $p_x$ 和 $p_y$ 以及字典序 $k=i+N_x j$（其中 $i$ 变化最快），均匀 $h$-细化保留了每行固定的局部模板，但代数半带宽随 $N_x$ 线性增加，因为在 $y$ 方向上偏移最多 $p_y$ 的相邻基函数会引起大小约为 $N_x p_y$ 的索引间隙。\n\nD. 在一维和二维情况下，均匀节点插入会缩小基函数的参数支集，因此严格减小了组装矩阵的半带宽。\n\nE. 在二维情况下，对于上述排序，均匀细化下的半带宽按 $p_y + N_y p_x$ 的比例缩放（即，随着 $y$ 方向上基函数数量 $N_y$ 的增长而增长），因为变化最快的索引是 $i$，并且在 $x$ 方向上偏移的相邻基函数主导了最大的索引间隙。",
            "solution": "该问题陈述是有效的，因为它在科学上基于成熟的等几何分析理论，是适定的，并使用了客观、精确的术语。因此，我们可以进行推导和分析。\n\n这个问题的核心在于理解刚度矩阵的稀疏性和结构，这由基函数的支集决定。让我们首先建立基本原理。\n\n**原理1：NURBS基函数的支集**\n一个次数为 $p$ 的B样条基函数，记作 $N_{i,p}(\\xi)$，仅在由节点向量定义的参数域的一个有限区间上非零。具体来说，其支集是区间 $[\\xi_i, \\xi_{i+p+1})$，覆盖了 $p+1$ 个节点区间。\n一个非均匀有理B样条（NURBS）基函数 $R_i(\\xi)$ 定义为：\n$$ R_i(\\xi) = \\frac{w_i N_{i,p}(\\xi)}{\\sum_{k} w_k N_{k,p}(\\xi)} $$\n其中 $w_k$ 是权重。问题陈述所有权重均为正。因此，分母（通常称为权重函数 $W(\\xi) = \\sum_{k} w_k N_{k,p}(\\xi)$）在至少一个基函数非零的整个参数域上是正的。\n关键点在于，当分子为零时，$R_i(\\xi)$ 也为零。由于 $w_i  0$，分子 $w_i N_{i,p}(\\xi)$ 为零的位置与B样条 $N_{i,p}(\\xi)$ 为零的位置完全相同。因此，NURBS基函数 $R_i(\\xi)$ 的支集与其底层B样条基函数 $N_{i,p}(\\xi)$ 的支集相同。NURBS的有理性质不会扩展支集或引入全局耦合。\n\n**原理2：伽辽金矩阵的稀疏性**\n刚度矩阵项 $K_{ij} = \\int_{0}^{1} R_i'(x) R_j'(x) \\mathrm{d}x$（在一维情况下）只有在导数 $R_i'(x)$ 和 $R_j'(x)$ 的支集有非空交集时才可能非零。一个函数导数的支集是该函数自身支集的子集。因此，$K_{ij} \\neq 0$ 的一个必要条件是基函数 $R_i(x)$ 和 $R_j(x)$ 的支集重叠。同样的逻辑也适用于二维情况。\n\n基于这些原理，我们可以分析一维和二维的情况。\n\n**一维情况分析**\n一个次数为 $p$ 的基函数 $R_i$ 的支集跨越 $p+1$ 个节点区间。它将与任何其他在这些区间内同样有支集的基函数 $R_j$ 重叠。$R_i$ 的支集是 $[\\xi_i, \\xi_{i+p+1})$，$R_j$ 的支集是 $[\\xi_j, \\xi_{j+p+1})$。它们重叠当且仅当它们的索引距离不大于 $p$，即 $|i-j| \\le p$。\n对于任何内部基函数 $R_i$，它与其左侧的 $p$ 个相邻基函数（$R_{i-p}, \\dots, R_{i-1}$）和右侧的 $p$ 个相邻基函数（$R_{i+1}, \\dots, R_{i+p}$）以及自身重叠。这导致刚度矩阵的任意给定行中最多有 $2p+1$ 个非零项。半带宽 $b$ 定义为使 $K_{ij}$ 可能非零的最大索引差 $|i-j|$。因此，对于一维情况，半带宽为 $b = p$。\n如前所述，均匀 $h$-细化涉及插入新节点，这增加了基函数的总数。然而，次数 $p$ 保持不变。因此，仅取决于 $p$ 的基本重叠结构保持不变。每个新的次数为 $p$ 的基函数仍将与其两侧的恰好 $p$ 个相邻基函数重叠。因此，半带宽（$b=p$）和每内部行的非零元数量（$2p+1$）保持恒定，与细化水平无关。\n\n**二维情况分析**\n二维基函数是张量积：$R_{i,j}(\\boldsymbol{\\xi}) = R_{i,p_x}(\\xi_x) R_{j,p_y}(\\xi_y)$。项 $K_{(i,j),(i',j')}$ 只有在 $R_{i,j}$ 和 $R_{i',j'}$ 的支集重叠时才非零。这要求在两个参数方向上同时存在重叠。基于一维分析，这种情况发生当且仅当 $|i-i'| \\le p_x$ 且 $|j-j'| \\le p_y$。\n这定义了一个相互作用的基函数的固定局部“模板”。对于一个内部函数 $(i,j)$，它与一个 $(2p_x+1) \\times (2p_y+1)$ 大小的相邻函数块相互作用。因此，矩阵中对应行的非零元数量是恒定的，由次数 $p_x$ 和 $p_y$ 决定。\n然而，代数半带宽关键取决于从二维索引对 $(i,j)$ 到一维全局索引 $k$ 的映射。问题指定了字典序，其中 $x$-索引 $i$ 变化最快：$k = i + N_x j$，其中 $N_x$ 是 $x$ 方向上基函数的总数。\n让我们计算两个相互作用的函数之间的最大索引差 $\\Delta k = |k - k'|$：\n$$ \\Delta k = |(i + N_x j) - (i' + N_x j')| = |(i-i') + N_x(j-j')| $$\n为了找到半带宽，我们必须在重叠条件 $|i-i'| \\le p_x$ 和 $|j-j'| \\le p_y$ 的约束下最大化该值。使用三角不等式，有 $|\\Delta k| \\le |i-i'| + N_x|j-j'|$。当 $|i-i'| = p_x$ 和 $|j-j'| = p_y$ 时达到最大值。\n$$ b = \\max(\\Delta k) = p_x + N_x p_y $$\n这就是半带宽。\n在均匀 $h$-细化下，每个方向上的基函数数量 $N_x$ 和 $N_y$ 增加。由于半带宽 $b$ 主要由项 $N_x p_y$ 决定，它随着细化的进行而与 $N_x$ 线性增长。大的索引跳跃是由在“慢变”索引方向（在此例中是 $j$）上偏移的相邻基函数引起的。\n\n现在我们评估每个选项：\n\n**A. 在一维情况下，对于固定的次数 $p$ 和内部重数 $1$，均匀节点插入保持半带宽和每内部行的非零元数量不变（边界效应除外），因为每个基函数在其两侧最多与 $p$ 个相邻基函数重叠，从而产生一个固定的带状模板。**\n该陈述与我们的一维分析完全一致。半带宽是 $p$，每内部行的非零元数量是 $2p+1$。这两个量都只取决于次数 $p$，而在 $h$-细化期间 $p$ 是固定的。\n**结论：正确。**\n\n**B. 在一维情况下，NURBS中的有理分母在均匀节点插入下产生全局耦合，导致刚度矩阵变得稠密，并且半带宽随着节点区间的数量增长。**\n这是不正确的。正如在原理1中确立的，NURBS基函数的支集与底层B样条的支集相同。有理分母不引入全局耦合。基函数保持紧支集，得到的刚度矩阵是稀疏和带状的。\n**结论：不正确。**\n\n**C. 在二维情况下，对于固定的次数 $p_x$ 和 $p_y$ 以及字典序 $k=i+N_x j$（其中 $i$ 变化最快），均匀 $h$-细化保留了每行固定的局部模板，但代数半带宽随 $N_x$ 线性增加，因为在 $y$ 方向上偏移最多 $p_y$ 的相邻基函数会引起大小约为 $N_x p_y$ 的索引间隙。**\n该陈述准确地反映了我们的二维分析。每行的非零元数量（局部模板）是恒定的，为 $(2p_x+1)(2p_y+1)$。半带宽约为 $p_x + N_x p_y$，在细化时随 $N_x$ 线性增长。其原因是来自慢变（$y$）方向上偏移的相邻基函数所产生的索引间隙，这也是正确的。\n**结论：正确。**\n\n**D. 在一维和二维情况下，均匀节点插入会缩小基函数的参数支集，因此严格减小了组装矩阵的半带宽。**\n前提是正确的——节点插入确实会缩小基函数支集的物理尺寸。然而，结论是错误的。代数半带宽由索引连通性决定，而不是支集的物理尺寸。在一维情况下，半带宽保持不变。在二维情况下，它会增加。因此，该陈述是错误的。\n**结论：不正确。**\n\n**E. 在二维情况下，对于上述排序，均匀细化下的半带宽按 $p_y + N_y p_x$ 的比例缩放（即，随着 $y$ 方向上基函数数量 $N_y$ 的增长而增长），因为变化最快的索引是 $i$，并且在 $x$ 方向上偏移的相邻基函数主导了最大的索引间隙。**\n该陈述为带宽提出了一个不正确的公式和错误的推理，对于给定的排序（$k=i+N_x j$）。我们推导出的半带宽是 $p_x + N_x p_y$。大的索引间隙是由在慢变（$j$）方向上偏移的相邻基函数引起的，而不是快变（$i$）方向。所提出的公式 $p_y + N_y p_x$ 将对应于 $j$ 是最快索引的排序，即 $k = j + N_y i$。\n**结论：不正确。**",
            "answer": "$$\\boxed{AC}$$"
        }
    ]
}