{
    "hands_on_practices": [
        {
            "introduction": "黎曼问题（Riemann problem）研究的是从简单的分段常数初始状态演化而来的解，它是双曲守恒律研究的基石。通过分析无粘性伯格斯方程的特征速度，我们可以确定初始的间断是会平滑成一个连续的稀疏波，还是会演变成一个激波。本练习  将引导您从第一性原理出发，解析地构建这些解，从而对非线性产生的丰富波动现象建立基础性的理解。",
            "id": "3424885",
            "problem": "考虑无粘性 Burgers 方程，这是一个标量守恒律偏微分方程 (PDE)，\n$$\nu_{t} + \\left(\\tfrac{1}{2}u^{2}\\right)_{x} = 0,\\quad x \\in \\mathbb{R},\\ t > 0,\n$$\n其 Riemann 初始数据为\n$$\nu(x,0) = \\begin{cases}\nu_{L},  x  0,\\\\\nu_{R},  x > 0.\n\\end{cases}\n$$\n从时空控制体上的积分守恒陈述和光滑解的特征线法出发，完成以下步骤：\n- 证明自相似性的出现，并推导在光滑区域上自相似剖面 $u(x,t)=U(\\xi)$（其中 $\\xi=x/t$）所满足的常微分方程。\n- 从应用于包含单个移动间断的控制体的积分守恒律出发，推导决定间断传播速度的代数关系，该关系用间断两侧的状态表示。\n- 利用光滑解的特征速度，构建一个物理上可接受的选择准则，以确定解何时必须是连续的自相似扩展波，以及何时必须是根据上述代数关系传播的间断。根据 $u_{L}$ 和 $u_{R}$ 的大小关系进行分类，并写出当出现连续剖面时的显式自相似形式。\n\n然后，对于 $u_{L}=\\tfrac{5}{3}$ 和 $u_{R}=-\\tfrac{1}{3}$ 的具体情况，确定产生哪种波，并计算在时间 $t=\\tfrac{9}{8}$ 时所产生的间断（如果存在）的精确 $x$ 坐标。仅报告这个最终位置作为你的答案。无需四舍五入。",
            "solution": "该问题要求分析无粘性 Burgers 方程的 Riemann 问题，然后进行一个具体计算。该偏微分方程是一个标量守恒律，$u_{t} + f(u)_{x} = 0$，其中守恒量是 $u(x,t)$，通量是 $f(u) = \\frac{1}{2}u^{2}$。方程为 $u_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0$。使用链式法则，可将其写成拟线性形式 $u_{t} + u u_{x} = 0$。初始数据是一个 Riemann 问题：\n$$\nu(x,0) = \\begin{cases}\nu_{L},  x  0,\\\\\nu_{R},  x > 0.\n\\end{cases}\n$$\n\n首先，我们证明自相似解的出现。Burgers 方程 $u_{t} + u u_{x} = 0$ 在尺度变换 $(x,t) \\to (\\lambda x, \\lambda t)$（其中 $\\lambda > 0$ 为任意常数）下是不变的。令 $x'=\\lambda x$，$t'=\\lambda t$，并定义 $v(x',t') = u(x,t)$。偏导数变换为 $u_{t} = \\lambda v_{t'}$ 和 $u_{x} = \\lambda v_{x'}$。代入偏微分方程得到 $\\lambda v_{t'} + v(\\lambda v_{x'}) = 0$，化简为 $v_{t'} + v v_{x'} = 0$。该偏微分方程形式不变。初始数据 $u(x,0)$ 只依赖于 $x$ 的符号，而 $x$ 的符号在尺度变换 $x \\to \\lambda x$（其中 $\\lambda > 0$）下也是不变的。由于控制方程和初始数据在该尺度变换下都是不变的，因此解本身也应是尺度不变的。如果一个函数 $u(x,t)$ 满足 $u(\\lambda x, \\lambda t) = u(x,t)$，则它是尺度不变的。该性质意味着 $u$ 必须是比例 $\\xi = x/t$ 的函数。因此，我们寻找形式为 $u(x,t) = U(\\xi)$ 的自相似解。\n\n为了推导 $U(\\xi)$ 的常微分方程 (ODE)，我们将此形式代入拟线性偏微分方程 $u_{t} + u u_{x} = 0$。使用链式法则：\n$$ u_{t} = \\frac{\\partial}{\\partial t} U(x/t) = U'(\\xi) \\frac{\\partial \\xi}{\\partial t} = U'(\\xi) \\left(-\\frac{x}{t^{2}}\\right) = -\\frac{\\xi}{t}U'(\\xi) $$\n$$ u_{x} = \\frac{\\partial}{\\partial x} U(x/t) = U'(\\xi) \\frac{\\partial \\xi}{\\partial x} = U'(\\xi) \\left(\\frac{1}{t}\\right) = \\frac{1}{t}U'(\\xi) $$\n将这些代入偏微分方程，得到：\n$$ -\\frac{\\xi}{t}U'(\\xi) + U(\\xi) \\left(\\frac{1}{t}U'(\\xi)\\right) = 0 $$\n两边乘以 $t$，我们得到光滑区域上自相似剖面的常微分方程：\n$$ (U(\\xi) - \\xi) U'(\\xi) = 0 $$\n这个常微分方程意味着对于任意 $\\xi$，要么 $U'(\\xi)=0$（即 $U(\\xi)$ 是一个常数），要么 $U(\\xi) = \\xi$。\n\n接下来，我们推导间断的传播速度。我们从守恒律在任意固定区间 $[x_1, x_2]$ 上的积分形式开始：\n$$ \\frac{d}{dt} \\int_{x_1}^{x_2} u(x,t) dx = f(u(x_1,t)) - f(u(x_2,t)) $$\n设一个间断位于 $x=s(t)$，其速度为 $S = s'(t)$。令 $u_L = \\lim_{x \\to s(t)^-} u(x,t)$ 和 $u_R = \\lim_{x \\to s(t)^+} u(x,t)$。我们将积分定律应用于包含 $s(t)$ 的区间 $[x_1, x_2]$，即 $x_1  s(t)  x_2$。左边可以用 Leibniz 积分法则在移动子域 $[x_1, s(t)]$ 和 $[s(t), x_2]$ 上展开：\n$$ \\frac{d}{dt} \\int_{x_1}^{x_2} u dx = \\frac{d}{dt}\\left(\\int_{x_1}^{s(t)} u dx + \\int_{s(t)}^{x_2} u dx\\right) = \\int_{x_1}^{x_2} u_t dx + S(u_L - u_R) $$\n在光滑区域内，$u_t = -f(u)_x$。因此，\n$$ \\int_{x_1}^{x_2} u_t dx = -\\int_{x_1}^{s(t)} f(u)_x dx - \\int_{s(t)}^{x_2} f(u)_x dx = -(f(u_L) - f(u(x_1,t))) - (f(u(x_2,t)) - f(u_R)) $$\n结合这些结果得到：\n$$ f(u(x_1,t)) - f(u(x_2,t)) = -(f(u_L) - f(u(x_1,t))) - (f(u(x_2,t)) - f(u_R)) + S(u_L - u_R) $$\n$$ f(u_L) - f(u_R) = S(u_L - u_R) $$\n这个关系式是 Rankine-Hugoniot 跳跃条件。对于 $u_L \\neq u_R$，间断的速度为：\n$$ S = \\frac{f(u_L) - f(u_R)}{u_L - u_R} $$\n对于无粘性 Burgers 方程，其中 $f(u) = \\frac{1}{2}u^2$，这变成：\n$$ S = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{1}{2}(u_L + u_R) $$\n\n为了构建选择准则，我们考虑特征速度。对于方程 $u_t + uu_x = 0$，特征曲线由 $\\frac{dx}{dt} = u$ 给出，这意味着信息以速度 $u$ 传播。\n如果 $u_L  u_R$，从 $x  0$ 发出的特征线速度为 $u_L$，从 $x > 0$ 发出的特征线速度为 $u_R$。由于 $u_L  u_R$，特征线从原点发散，在状态 $u_L$ 和 $u_R$ 之间形成一个空间。在这个空间中，解是连续的，并且由 $u(x,t) = x/t$ 给出。这是一个稀疏波。其显式自相似形式为\n$$\nu(x,t) = U(x/t) = \\begin{cases}\nu_L  \\text{if } x/t  u_L \\\\\nx/t  \\text{if } u_L \\le x/t \\le u_R \\\\\nu_R  \\text{if } x/t > u_R\n\\end{cases}\n$$\n如果 $u_L > u_R$，从 $x  0$ 发出的特征线比从 $x > 0$ 发出的特征线移动得更快。它们会汇合并形成一个不连续的激波。该激波以 Rankine-Hugoniot 速度 $S$ 传播。这是物理上可接受的解。\n\n对于我们给定的情况 $u_{L}=\\tfrac{5}{3}$ 和 $u_{R}=-\\tfrac{1}{3}$，我们有 $u_L > u_R$。因此，一个激波形成。\n激波速度为：\n$$ S = \\frac{1}{2}(u_L + u_R) = \\frac{1}{2}\\left(\\frac{5}{3} - \\frac{1}{3}\\right) = \\frac{1}{2}\\left(\\frac{4}{3}\\right) = \\frac{2}{3} $$\n激波的位置由 $x(t) = S \\cdot t$ 给出。在时间 $t=\\tfrac{9}{8}$，间断的 $x$ 坐标是：\n$$ x = \\frac{2}{3} \\times \\frac{9}{8} = \\frac{18}{24} = \\frac{3}{4} $$",
            "answer": "$$\\boxed{\\frac{3}{4}}$$"
        },
        {
            "introduction": "黎曼问题的解析解不仅仅是一个理论练习，它也是一类最重要的守恒律数值格式的基本构建模块。戈杜诺夫（Godunov）方法巧妙地利用每个单元界面上的自相似解来定义一个基于物理的数值通量。本练习  要求您推导出伯格斯方程的精确戈杜诺夫通量，将前一个练习中获得的解析洞察转化为数值算法的具体组成部分。",
            "id": "3424896",
            "problem": "考虑无粘性伯格斯动力学的标量守恒律，\n$$\nu_{t} + \\left(\\tfrac{1}{2}u^{2}\\right)_{x} = 0,\n$$\n该方程建立在均匀网格上，网格单元中心为 $x_{i}$，单元宽度为 $\\Delta x$，时间步长为 $\\Delta t$。令 $u_{i}^{n}$ 表示在时间层 $t^{n}$ 上单元 $i$ 内的单元平均值。从积分形式的守恒律和每个时间步长内初始数据的分段常数重构出发，构建一个一阶 Godunov 有限体积更新格式\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\,\\Big(F_{i+\\frac{1}{2}}^{n} - F_{i-\\frac{1}{2}}^{n}\\Big),\n$$\n其中 $F_{i+\\frac{1}{2}}^{n}$ 是通过求解界面 $x_{i+\\frac{1}{2}}$ 上的黎曼问题得到的单元间数值通量，其左右状态分别由 $u_{i}^{n}$ 和 $u_{i+1}^{n}$ 给出。仅使用特征线法、Rankine–Hugoniot 跳跃条件和激波的熵可容许性条件，推导无粘性伯格斯方程的精确黎曼求解器，从而获得单元间通量 $F_{i+\\frac{1}{2}}^{n}$ 作为 $(u_{i}^{n},u_{i+1}^{n})$ 函数的闭式解析表达式。将您最终的通量公式 $F_{i+\\frac{1}{2}}^{n}(u_{i}^{n},u_{i+1}^{n})$ 以单一闭式解析表达式的形式给出。无需舍入，此无量纲通量不涉及物理单位。",
            "solution": "用户希望推导无粘性伯格斯方程的 Godunov 通量。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **控制方程：** 无粘性伯格斯动力学的标量守恒律为 $u_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0$。\n-   **数值格式：** 使用一阶 Godunov 有限体积法，更新公式为 $u_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\,(F_{i+\\frac{1}{2}}^{n} - F_{i-\\frac{1}{2}}^{n})$。\n-   **网格：** 均匀网格，单元中心为 $x_i$，单元宽度为 $\\Delta x$，时间步长为 $\\Delta t$。\n-   **状态变量：** $u_{i}^{n}$ 是在时间 $t^n$ 时单元 $i$ 中解的单元平均值。\n-   **通量定义：** 单元间数值通量 $F_{i+\\frac{1}{2}}^{n}$ 是通过求解界面 $x_{i+\\frac{1}{2}}$ 上的黎曼问题得到的。\n-   **黎曼问题数据：** 左状态为 $u_L = u_{i}^{n}$，右状态为 $u_R = u_{i+1}^{n}$。\n-   **所需工具：** 推导必须使用特征线法、Rankine–Hugoniot 跳跃条件和激波的熵可容许性条件。\n-   **目标：** 推导单元间通量 $F_{i+\\frac{1}{2}}^{n}$ 作为 $(u_{i}^{n}, u_{i+1}^{n})$ 函数的闭式解析表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学基础：** 该问题在科学上是合理的。无粘性伯格斯方程是非线性双曲守恒律的一个基本原型。基于黎曼问题精确解的 Godunov 方法是求解此类方程的现代数值方法的基石。所提到的所有概念（特征线、Rankine-Hugoniot 条件、熵条件）都是用于此分析的标准且正确的理论工具。\n-   **适定性：** 该问题是适定的。它要求推导一个特定的数学函数，即伯格斯方程的 Godunov 通量，已知该通量具有唯一的形式。\n-   **客观性：** 该问题以精确、客观的数学语言陈述，没有歧义或主观因素。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整的解决方案。\n\n### Godunov 通量的推导\n\n该问题要求推导无粘性伯格斯方程 $u_t + f(u)_x=0$ 的数值通量 $F_{i+\\frac{1}{2}}^{n}$，其中物理通量为 $f(u) = \\frac{1}{2}u^2$。Godunov 方法将单元界面 $x_{i+\\frac{1}{2}}$ 处的数值通量定义为在该界面处局部黎曼问题解的物理通量值。黎曼问题的解是自相似的，仅依赖于比值 $x/t$。因此，在界面位置（在黎曼问题的局部坐标中为 $x=0$）的解在时间上是恒定的。设此界面状态为 $u_{i+\\frac{1}{2}}^{*} = u(0, t; u_L, u_R)$，其中 $u_L = u_i^n$ 且 $u_R = u_{i+1}^n$。那么 Godunov 通量就是 $F_{i+\\frac{1}{2}}^{n} = f(u_{i+\\frac{1}{2}}^{*})$。\n\n为了求得 $u_{i+\\frac{1}{2}}^{*}$，我们必须求解伯格斯方程的黎曼问题：\n$$\nu_t + u u_x = 0\n$$\n初值数据为\n$$\nu(x,0) = \\begin{cases} u_L,  x  0 \\\\ u_R,  x > 0 \\end{cases}\n$$\n该方程的特征速度为 $a(u) = f'(u) = u$。解取决于 $u_L$ 和 $u_R$ 之间的关系。为使推导清晰，我们使用 $u_L$ 和 $u_R$，并在最终表达式中代入 $u_i^n$ 和 $u_{i+1}^n$。\n\n**情况 1：稀疏波 ($u_L  u_R$)**\n\n如果 $u_L  u_R$，特征线发散。在状态 $u_L$ 和 $u_R$ 之间会形成一个称为稀疏波的连续解。解沿着特征线 $x = \\text{const} + u t$（它们是直线）保持不变。在来自左侧的最快特征线（速度为 $u_L$）和来自右侧的最慢特征线（速度为 $u_R$）之间的区域，解由自相似形式 $u(x,t) = x/t$ 给出。完整的解是：\n$$\nu(x,t) = \\begin{cases}\nu_L  \\text{if } x/t  u_L \\\\\nx/t  \\text{if } u_L \\le x/t \\le u_R \\\\\nu_R  \\text{if } x/t > u_R\n\\end{cases}\n$$\n我们需要找到界面处的状态 $u_{i+\\frac{1}{2}}^{*}$，这对应于 $x/t = 0$。\n-   如果 $u_L \\le 0 \\le u_R$，点 $x/t = 0$ 落在稀疏扇内。状态为 $u_{i+\\frac{1}{2}}^{*} = 0$。\n-   如果 $0  u_L  u_R$，点 $x/t = 0$ 位于扇的左侧（$0  u_L$）。状态为 $u_{i+\\frac{1}{2}}^{*} = u_L$。\n-   如果 $u_L  u_R  0$，点 $x/t = 0$ 位于扇的右侧（$u_R  0$）。状态为 $u_{i+\\frac{1}{2}}^{*} = u_R$。\n\n对应的 Godunov 通量 $F = f(u_{i+\\frac{1}{2}}^{*}) = \\frac{1}{2}(u_{i+\\frac{1}{2}}^{*})^2$ 为：\n-   如果 $u_L \\le 0 \\le u_R$，通量为 $f(0) = 0$。\n-   如果 $0  u_L  u_R$，通量为 $f(u_L)$。\n-   如果 $u_L  u_R  0$，通量为 $f(u_R)$。\n\n**情况 2：激波 ($u_L > u_R$)**\n\n如果 $u_L > u_R$，特征线汇合，导致一个不连续的解（激波）。激波以一个恒定的速度 $s$ 传播，该速度由 Rankine-Hugoniot 跳跃条件给出：\n$$\ns = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{\\frac{1}{2}(u_R-u_L)(u_R+u_L)}{u_R-u_L} = \\frac{u_L+u_R}{2}\n$$\n熵条件要求特征线必须进入激波，对于标量凸通量，这意味着 $a(u_L) > s > a(u_R)$。对于伯格斯方程，这是 $u_L > s > u_R$。因为 $u_L > (u_L+u_R)/2 \\Leftrightarrow u_L > u_R$ 并且 $(u_L+u_R)/2 > u_R \\Leftrightarrow u_L > u_R$，所以当 $u_L > u_R$ 时，熵条件总是满足的。\n\n解是一个以速度 $s$ 传播的单个间断：\n$$\nu(x,t) = \\begin{cases} u_L,  x  st \\\\ u_R,  x > st \\end{cases}\n$$\n为了找到界面 $x=0$ 处的状态 $u_{i+\\frac{1}{2}}^{*}$，我们检查激波速度 $s$ 的符号。\n-   如果 $s > 0$，激波向右移动。对于任何 $t>0$，点 $x=0$ 位于激波波阵面的左侧（$0  st$）。因此，状态为 $u_{i+\\frac{1}{2}}^{*} = u_L$。这种情况发生在 $u_L + u_R > 0$ 时。\n-   如果 $s  0$，激波向左移动。点 $x=0$ 位于激波波阵面的右侧（$st  0$）。状态为 $u_{i+\\frac{1}{2}}^{*} = u_R$。这种情况发生在 $u_L + u_R  0$ 时。\n-   如果 $s = 0$，激波是静止的，并保持在 $x=0$ 处。这种情况发生在 $u_L + u_R = 0$ 时。通量在静止激波上是连续的，即 $f(u_L) = f(u_R)$（因为 $u_L = -u_R$，所以 $f(u_L)=\\frac{1}{2}u_L^2 = \\frac{1}{2}(-u_R)^2=f(u_R)$）。我们可以将这种情况与 $s > 0$ 的情况关联起来，将状态取为 $u_L$。\n\n对应的 Godunov 通量为：\n-   如果 $u_L+u_R \\ge 0$，通量为 $f(u_L)$。\n-   如果 $u_L+u_R  0$，通量为 $f(u_R)$。\n\n**总结与最终通量表达式**\n\n我们现在将这些结果综合成一个单一的数值通量表达式 $F_{i+\\frac{1}{2}}^{n}(u_i^n, u_{i+1}^n)$。令 $u_L = u_i^n$ 和 $u_R = u_{i+1}^n$，以及 $f(u) = \\frac{1}{2}u^2$。\n\n我们可以根据状态 $u_L$ 和 $u_R$ 来组织选择通量的条件：\n\n1.  **通量为 $f(u_L)$：** 这在两种情况下发生：\n    a) 整个稀疏扇向右移动的稀疏波（$0  u_L  u_R$）。\n    b) 向右移动或静止的激波（$u_L > u_R$ 且 $s = (u_L+u_R)/2 \\ge 0$）。\n    这些条件可以合并：如果 $u_L > 0$ 并且 ($u_R > 0$) 或 ($u_R \\le 0$ 且 $u_L+u_R \\ge 0$)，则通量为 $f(u_L)$。\n\n2.  **通量为 $f(u_R)$：** 这在两种情况下发生：\n    a) 整个稀疏扇向左移动的稀疏波（$u_L  u_R  0$）。\n    b) 向左移动的激波（$u_L > u_R$ 且 $s = (u_L+u_R)/2  0$）。\n    这些条件可以合并：如果 $u_R  0$ 并且 ($u_L  0$) 或 ($u_L \\ge 0$ 且 $u_L+u_R  0$)，则通量为 $f(u_R)$。\n\n3.  **通量为 $0$：** 这发生在跨越原点的稀疏波（$u_L \\le 0 \\le u_R$），此时界面处的状态为 $u=0$。通量为 $f(0)=0$。\n\n这三种情况互斥，并涵盖了 $(u_L, u_R)$ 的所有可能性。我们可以用分段解析的形式写出最终的通量公式。令 $F_{i+\\frac{1}{2}}^{n} = F(u_{i}^{n}, u_{i+1}^{n})$。\n\n$$\nF(u_{i}^{n}, u_{i+1}^{n}) = \\begin{cases}\n\\frac{1}{2}(u_{i}^{n})^{2}  \\text{若 } u_{i}^{n} > 0 \\text{ 且 } (u_{i+1}^{n} > 0 \\text{ 或 } (u_{i+1}^{n} \\le 0 \\text{ 且 } u_{i}^{n}+u_{i+1}^{n} \\ge 0)) \\\\\n\\frac{1}{2}(u_{i+1}^{n})^{2}  \\text{若 } u_{i+1}^{n}  0 \\text{ 且 } (u_{i}^{n}  0 \\text{ 或 } (u_{i}^{n} \\ge 0 \\text{ 且 } u_{i}^{n}+u_{i+1}^{n}  0)) \\\\\n0  \\text{若 } u_{i}^{n} \\le 0 \\le u_{i+1}^{n}\n\\end{cases}\n$$\n该表达式构成了无粘性伯格斯方程的 Godunov 单元间通量的闭式解析公式。",
            "answer": "$$\n\\boxed{\nF_{i+\\frac{1}{2}}^{n}(u_{i}^{n}, u_{i+1}^{n}) = \\begin{cases}\n\\frac{1}{2}(u_{i}^{n})^{2}  \\text{若 } u_{i}^{n} > 0 \\text{ 且 } ( (u_{i+1}^{n} > 0) \\text{ 或 } ( (u_{i+1}^{n} \\le 0) \\text{ 且 } (u_{i}^{n}+u_{i+1}^{n} \\ge 0) ) ) \\\\\n\\frac{1}{2}(u_{i+1}^{n})^{2}  \\text{若 } u_{i+1}^{n}  0 \\text{ 且 } ( (u_{i}^{n}  0) \\text{ 或 } ( (u_{i}^{n} \\ge 0) \\text{ 且 } (u_{i}^{n}+u_{i+1}^{n}  0) ) ) \\\\\n0  \\text{若 } u_{i}^{n} \\le 0 \\le u_{i+1}^{n}\n\\end{cases}\n}\n$$"
        },
        {
            "introduction": "本练习将从有限体积法转向另一种强大的数值方法范式——谱方法，用于求解有粘性的伯格斯方程。虽然谱方法对于光滑问题能提供极高的精度，但将其应用于非线性方程会引入一个关键的数值挑战，即“混淆误差”（aliasing），在这种现象中，未被解析的相互作用会污染解。在这个动手编程练习  中，您将实现一个复杂的半隐式求解器，并直接研究混淆效应以及如何使用三分之二法则来确保数值的稳定性和准确性。",
            "id": "3424879",
            "problem": "考虑周期域上的一维粘性 Burgers 方程，\n$$\nu_t + u\\,u_x = \\nu\\,u_{xx}, \\quad x \\in [0,2\\pi), \\quad t \\ge 0,\n$$\n其周期性边界条件为 $u(x+2\\pi,t)=u(x,t)$，初始条件为 $u(x,0)=u_0(x)$。目标是构造一个空间上的 Fourier 伪谱方法和一个半隐式二阶精度的时间离散化方案，分析非线性项 $u\\,u_x$ 产生的混叠效应，并实现 $\\frac{2}{3}$法则去混叠策略。\n\n从以下基本点出发：\n- 在 $2\\pi$ 周期域上的 Fourier 级数表示，以及物理空间中的微分对应于 Fourier 空间中波数为 $k$ 的模式乘以 $\\mathrm{i}k$ 这一事实。\n- 在 $N$ 个点的均匀网格 $x_j = j\\,\\Delta x$（其中 $\\Delta x = \\frac{2\\pi}{N}$）上的离散 Fourier 变换（通过快速 Fourier 变换 (FFT) 计算），对于偶数 $N$，整数波数 $k \\in \\{-\\frac{N}{2},\\ldots,\\frac{N}{2}-1\\}$。\n- 对流项的对称形式 $u\\,u_x = \\frac{1}{2}\\partial_x(u^2)$，这对于能量特性更有利。\n- 对扩散项使用 Crank-Nicolson 方法，对非线性项使用 Adams-Bashforth 方法，以构成一个半隐式二阶方法。\n\n任务：\n1. 推导空间上的 Fourier 伪谱半离散化。精确定义离散网格、离散 Fourier 变换及其逆变换、整数波数向量 $k$ 以及将 Fourier 系数向量 $\\widehat{u}$ 映射到 $\\mathrm{i}k\\,\\widehat{u}$ 的谱微分算子。展示如何使用物理空间乘法和对 $u^2$ 的 Fourier 微分来伪谱地构建非线性项。\n2. 解释当在具有有限模式数 $N$ 的网格上形成非线性乘积时，项 $u\\,u_x$ 的混叠来源。你的解释应该形式化地阐述 Fourier 模式的离散卷积，以及为什么它会以 $N$ 为模进行环绕，从而导致低波数被未解析的高波数相互作用所污染。\n3. 提出并论证针对二次非线性的 $\\frac{2}{3}$法则去混叠策略：在用于计算非线性项的所有辅助场中，只保留 $|k| \\le \\lfloor N/3 \\rfloor$ 的低波数模式，以便消除离散卷积中的伪环绕。你的解释必须清晰地将二次非线性的卷积支撑集与截断 $|k| \\le \\lfloor N/3 \\rfloor$ 联系起来。\n4. 通过使用 Crank-Nicolson 方法处理扩散项和两步 Adams-Bashforth 方法处理非线性项，构建一个时间上二阶精度的全离散方法。陈述在时间层 $t^n = n\\,\\Delta t$ 时，Fourier 空间中 Fourier 系数 $\\widehat{u}^n$ 的更新规则。在 Adams-Bashforth 部分使用非线性的对称形式 $-\\frac{1}{2}\\partial_x(u^2)$。解释如何在第一步初始化这个两步法。\n5. 实现求解器，并提供两种构建非线性项的选项：使用和不使用 $\\frac{2}{3}$ 法则去混叠。使用周期域 $[0,2\\pi)$，初始条件 $u_0(x) = \\sin(x)$，以及以下测试套件。对于每个测试，使用所推导的方法，以均匀步长 $\\Delta t$ 积分到最终时间 $T$。对于每次运行，记录：\n   - 最终离散能量 $E(T) = \\frac{1}{2}\\,\\langle u(\\cdot,T)^2 \\rangle$，其中 $\\langle\\cdot\\rangle$ 表示在网格上的空间平均。\n   - 最终时刻的高模能量分数，\n     $$\n     \\mathcal{F}_{\\text{hi}}(T) = \\frac{\\sum_{|k|>\\lfloor N/3 \\rfloor} |\\widehat{u}_k(T)|^2}{\\sum_{k} |\\widehat{u}_k(T)|^2},\n     $$\n     根据时刻 $T$ 的离散 Fourier 系数计算。\n   - 一个布尔标志，指示离散能量是否随时间非增，即 $E^{n+1} \\le E^n$ 在一个小的非负容差范围内（在每一步使用 $E^n$ 的 $10^{-12}$ 倍作为相对容差）。\n\n测试套件（不涉及物理单位；所有量均为无量纲）：\n- 情况 A（理想路径，去混叠）：$N=64$，$\\nu=0.05$，$T=0.5$，$\\Delta t=5\\times 10^{-4}$，启用 $\\frac{2}{3}$ 法则去混叠。\n- 情况 B（混叠开启，更陡峭的梯度）：$N=64$，$\\nu=0.01$，$T=0.5$，$\\Delta t=5\\times 10^{-4}$，禁用去混叠。\n- 情况 C（更高分辨率，去混叠）：$N=96$，$\\nu=0.01$，$T=0.5$，$\\Delta t=5\\times 10^{-4}$，启用 $\\frac{2}{3}$ 法则去混叠。\n\n程序要求和输出格式：\n- 实现该方法并运行上述三个情况。\n- 对于每种情况，按顺序 $[E(T), \\mathcal{F}_{\\text{hi}}(T), \\text{is\\_energy\\_nonincreasing}]$ 输出一个包含三个条目的列表，其中 $E(T)$ 和 $\\mathcal{F}_{\\text{hi}}(T)$ 是实值浮点数，$\\text{is\\_energy\\_nonincreasing}$ 是一个布尔值。\n- 程序应生成单行输出，其中包含一个列表，列表内有三个子列表作为情况结果，格式完全如下\n$$\n\\text{[ [e\\_A,f\\_A,b\\_A], [e\\_B,f\\_B,b\\_B], [e\\_C,f\\_C,b\\_C] ]}.\n$$\n不应打印任何其他文本。",
            "solution": "问题陈述已经过严格审查，并被确定为 **有效**。它提出了一个在数值偏微分方程领域中定义明确的任务，具体来说是粘性 Burgers 方程的数值求解。该问题具有科学依据，内容自洽，所有参数和目标都已足够精确地指定。它要求推导和实现标准的、成熟的数值方法（Fourier 伪谱方法、半隐式时间积分以及用于去混叠的 $\\frac{2}{3}$ 法则）。\n\n我们将系统地进行求解，依次解决提出的各项任务。\n\n### 任务 1：Fourier 伪谱半离散化\n\n一维粘性 Burgers 方程为\n$$u_t + u u_x = \\nu u_{xx}, \\quad x \\in [0, 2\\pi)$$\n具有周期性边界条件。为了数值稳定性和更好地处理能量守恒性质，我们使用对流项的对称形式 $u u_x = \\frac{1}{2}\\partial_x(u^2)$。偏微分方程（PDE）变为：\n$$u_t + \\frac{1}{2}\\frac{\\partial}{\\partial x}(u^2) = \\nu u_{xx}$$\nFourier 伪谱方法在离散网格上近似解 $u(x,t)$，并用其 Fourier 级数表示。我们定义一个由 $N$ 个点组成的均匀网格 $x_j = j \\frac{2\\pi}{N}$，其中 $j=0, 1, \\ldots, N-1$。设 $u_j(t) = u(x_j, t)$ 为网格上的函数值。\n\n离散 Fourier 变换（DFT）及其逆变换（IDFT）在物理空间表示 $\\{u_j\\}$ 和 Fourier 空间表示 $\\{\\widehat{u}_k\\}$ 之间进行映射。遵循 NumPy 等数值库中使用的通用约定，它们的定义如下：\n$$ \\widehat{u}_k = \\sum_{j=0}^{N-1} u_j e^{-2\\pi\\mathrm{i}jk/N} \\quad (\\text{DFT}) $$\n$$ u_j = \\frac{1}{N} \\sum_{k=0}^{N-1} \\widehat{u}_k e^{2\\pi\\mathrm{i}jk/N} \\quad (\\text{IDFT}) $$\nDFT 的索引 $k \\in \\{0, 1, \\ldots, N-1\\}$ 对应于物理整数波数，对于偶数 $N$，这些波数通常排列为 $k \\in \\{0, 1, \\ldots, \\frac{N}{2}-1, -\\frac{N}{2}, \\ldots, -1\\}$。这个整数波数向量对于谱微分至关重要。\n\nFourier 基的关键性质是物理空间中的微分在 Fourier 空间中变为乘法。空间导数 $\\partial_x f(x)$ 的 Fourier 变换是 $\\mathrm{i}k\\widehat{f}(k)$。将此应用于我们的 PDE，我们将其转换为关于 Fourier 系数 $\\widehat{u}_k(t)$ 的常微分方程（ODE）组：\n$$ \\frac{d\\widehat{u}_k}{dt} + \\mathcal{F}\\left(\\frac{1}{2}\\frac{\\partial}{\\partial x}(u^2)\\right)_k = \\nu \\mathcal{F}(u_{xx})_k $$\n应用微分法则：\n$$ \\frac{d\\widehat{u}_k}{dt} + \\frac{\\mathrm{i}k}{2}\\widehat{(u^2)}_k = \\nu (\\mathrm{i}k)^2 \\widehat{u}_k = -\\nu k^2 \\widehat{u}_k $$\n这个方程需要非线性项的 Fourier 系数 $\\widehat{(u^2)}_k$。在伪谱（或配置）方法中，该项是通过变换回物理空间，执行乘法，然后再变换回 Fourier 空间来计算的。步骤如下：\n1.  从给定时间 $t$ 的谱系数 $\\widehat{u}_k(t)$ 开始。\n2.  通过 IDFT 计算物理空间值 $u_j(t)$：$\\{u_j\\} = \\text{IDFT}(\\{\\widehat{u}_k\\})$。\n3.  在物理空间中执行非线性操作（平方）：$v_j = u_j^2$。\n4.  通过 DFT 将结果变换回 Fourier 空间：$\\{\\widehat{v}_k\\} = \\text{DFT}(\\{v_j\\})$，其中 $\\widehat{v}_k = \\widehat{(u^2)}_k$。\n\n因此，对于每个波数 $k$ 的半离散 ODE 系统为：\n$$ \\frac{d\\widehat{u}_k}{dt} = -\\frac{\\mathrm{i}k}{2}\\widehat{(u^2)}_k - \\nu k^2 \\widehat{u}_k $$\n其中 $\\widehat{(u^2)}_k$ 如前所述以伪谱方式计算。项 $\\mathcal{N}(\\widehat{u})_k = -\\frac{\\mathrm{i}k}{2}\\widehat{(u^2)}_k$ 代表 Fourier 空间中的非线性项，而 $\\mathcal{L}(\\widehat{u})_k = -\\nu k^2 \\widehat{u}_k$ 是线性（扩散）项。\n\n### 任务 2：混叠的来源\n\n混叠是一种因连续信号离散化而产生的误差。在用于非线性 PDE 的 Fourier 谱方法中，它源于在有限网格上计算非线性乘积。\n\n两个函数乘积 $u(x)^2$ 的精确 Fourier 变换对应于它们各自 Fourier 变换的卷积：\n$$ \\widehat{(u^2)}(k) = (\\widehat{u} * \\widehat{u})(k) = \\sum_{p+q=k} \\widehat{u}_p \\widehat{u}_q $$\n如果函数 $u(x)$ 包含有限带宽的波数，比如说其系数 $\\widehat{u}_p$ 仅在 $|p| \\le K$ 时非零，那么卷积乘积 $\\widehat{(u^2)}(k)$ 将在最高达 $|k| \\le 2K$ 的波数上具有非零系数。\n\n在具有 $N$ 个网格点的离散情况下，我们只能表示有限范围内的波数，例如 $k \\in \\{-\\frac{N}{2}, \\ldots, \\frac{N}{2}-1\\}$。当我们在物理空间计算乘积 $u_j^2$ 然后对其进行 DFT 时，该操作对应于 Fourier 空间中的 *循环* 或 *周期* 卷积：\n$$ \\widehat{(u^2)}_k = \\sum_{p+q \\equiv k \\pmod N} \\widehat{u}_p \\widehat{u}_q $$\n当来自原始信号的波数之和 $p+q$ 超出可表示波数的范围时，问题就出现了。例如，如果我们有相互作用的模式 $p=N/3$ 和 $q=N/3$，它们的和是 $p+q=2N/3$。在一个有 $N$ 个点的网格上，这个高波数与较低的波数 $k' = 2N/3 - N = -N/3$ 是无法区分的。这种现象就是混叠：一个高波数的相互作用 $(p, q)$ 伪装成或“混叠成”一个低波数模式 $k'$，从而污染其振幅。这种将能量伪转移到已解析模式中的现象违反了 PDE 的真实动力学，可能导致非物理行为，并常常引发数值不稳定性。\n\n### 任务 3：$\\frac{2}{3}$ 法则去混叠\n\n$\\frac{2}{3}$ 法则是一种去混叠策略，它通过确保离散卷积对于正在解析的模式与精确卷积相同，从而消除二次非线性项产生的混叠误差。\n\n假设我们解析的模式最高达到截断波数 $K$，即我们强制当 $|k| > K$ 时 $\\widehat{u}_k = 0$。二次乘积 $u^2$ 会生成最高达到波数 $2K$ 的模式。为了在 $N$ 点网格上正确表示此乘积，所有生成的模式都必须是唯一可表示的。在此类网格上，最高唯一波数约为 $N/2$。\n\n去混叠的关键洞见是防止任何混叠波数落回到已解析的频带 $[-K, K]$ 内。如果存在模式 $|p|, |q| \\le K$，使得它们的和 $p+q$ 混叠到一个波数 $k_a$（其中 $|k_a| \\le K$），就会发生混叠误差。混叠波数为 $k_a = p+q - mN$，其中 $m$ 为某个非零整数。不失一般性，设 $m=1$。我们需要对所有 $|p|,|q| \\le K$ 阻止 $|p+q-N| \\le K$ 的情况发生。\n\n为了避免这种情况，我们必须确保“混叠间隙”足够大。条件是 $|p+q-N| > K$。$|p+q-N|$ 的最小值出现在 $p+q$ 尽可能大（即 $2K$，对于 $p,q>0$）或尽可能小（即 $-2K$，对于 $p,q0$）时。我们考虑正数情况。我们需要 $|2K - N| > K$。由于为了唯一表示，$K$ 必须小于 $N/2$，所以 $N-2K$ 是正数。该条件简化为 $N-2K > K$，得出 $3K  N$，即 $K  N/3$。\n\n因此，如果我们对二次非线性的输入场进行截断，使其只包含模式 $|k| \\le K = \\lfloor N/3 \\rfloor$，则得到的乘积将具有最高达到 $|k| \\le 2K = 2\\lfloor N/3 \\rfloor$ 的模式。由于 $2\\lfloor N/3 \\rfloor  N - \\lfloor N/3 \\rfloor$，环绕模式将不会污染已解析的谱带 $|k| \\le \\lfloor N/3 \\rfloor$。\n\n计算非线性项的去混叠过程如下：\n1.  给定解的系数 $\\widehat{u}_k$。\n2.  通过将所有 $|k| > \\lfloor N/3 \\rfloor$ 的系数设置为零，创建一个临时的、滤波后的场 $\\widehat{u}'_k$。\n3.  计算 $u'_j = \\text{IDFT}(\\{\\widehat{u}'_k\\})$。\n4.  在物理空间中计算乘积：$v'_j = (u'_j)^2$。\n5.  变换回 Fourier 空间：$\\widehat{(v')}_k = \\text{DFT}(\\{v'_j\\})$。这就是去混叠后的 $\\widehat{(u^2)}_k$。然后，将得到的非线性项 $\\mathcal{N}_k = -\\frac{\\mathrm{i}k}{2}\\widehat{(v')}_k$ 用于时间步进格式。\n\n### 任务 4：全离散二阶方法\n\n我们通过使用 Crank-Nicolson 方法隐式处理刚性线性扩散项，并使用两步 Adams-Bashforth (AB2) 方法显式处理非线性项，来构建一个半隐式、时间上二阶精度的时间积分格式。\n\n半离散系统为 $\\frac{d\\widehat{u}}{dt} = \\mathcal{N}(\\widehat{u}) + \\mathcal{L}(\\widehat{u})$。AB2/CN 离散化为：\n$$ \\frac{\\widehat{u}_k^{n+1} - \\widehat{u}_k^n}{\\Delta t} = \\left(\\frac{3}{2}\\mathcal{N}_k^n - \\frac{1}{2}\\mathcal{N}_k^{n-1}\\right) + \\frac{1}{2}\\left(\\mathcal{L}_k^{n+1} + \\mathcal{L}_k^n\\right) $$\n其中 $\\widehat{u}_k^n$ 是在时间 $t^n = n\\Delta t$ 的系数，且 $\\mathcal{N}_k^n = \\mathcal{N}(\\widehat{u}^n)_k$ 和 $\\mathcal{L}_k^n = \\mathcal{L}(\\widehat{u}^n)_k = -\\nu k^2 \\widehat{u}_k^n$。\n\n代入 $\\mathcal{L}_k$ 的表达式并重新整理以求解 $\\widehat{u}_k^{n+1}$：\n$$ \\widehat{u}_k^{n+1} - \\frac{\\Delta t}{2}(-\\nu k^2 \\widehat{u}_k^{n+1}) = \\widehat{u}_k^n + \\frac{\\Delta t}{2}(-\\nu k^2 \\widehat{u}_k^n) + \\Delta t \\left(\\frac{3}{2}\\mathcal{N}_k^n - \\frac{1}{2}\\mathcal{N}_k^{n-1}\\right) $$\n$$ \\widehat{u}_k^{n+1} \\left(1 + \\frac{\\nu k^2 \\Delta t}{2}\\right) = \\widehat{u}_k^n \\left(1 - \\frac{\\nu k^2 \\Delta t}{2}\\right) + \\Delta t \\left(\\frac{3}{2}\\mathcal{N}_k^n - \\frac{1}{2}\\mathcal{N}_k^{n-1}\\right) $$\n$\\widehat{u}_k^{n+1}$ 的最终更新规则是：\n$$ \\widehat{u}_k^{n+1} = \\frac{1}{1 + \\frac{1}{2}\\nu k^2 \\Delta t} \\left[ \\left(1 - \\frac{1}{2}\\nu k^2 \\Delta t\\right) \\widehat{u}_k^n + \\Delta t \\left(\\frac{3}{2}\\mathcal{N}_k^n - \\frac{1}{2}\\mathcal{N}_k^{n-1}\\right) \\right] $$\n此公式在时间上是二阶精度的。\n\nAB2 方法是一种两步法，需要来自时间层 $n$ 和 $n-1$ 的信息来计算时间层 $n+1$。为了在 $t=0$ 开始积分，我们只有 $\\widehat{u}^0$。我们无法计算 $\\mathcal{N}^{-1}$。一个标准的程序是在第一个时间步使用一个不同的、至少为一阶精度的一步法。为了保持格式的整体二阶精度，我们为第一步使用一种局部截断误差至少为 $O(\\Delta t^2)$ 的方法。一个合适的选择是一步 Adams-Bashforth / Crank-Nicolson (AB1/CN) 格式：\n$$ \\frac{\\widehat{u}_k^1 - \\widehat{u}_k^0}{\\Delta t} = \\mathcal{N}_k^0 + \\frac{1}{2}(\\mathcal{L}_k^1 + \\mathcal{L}_k^0) $$\n求解 $\\widehat{u}_k^1$ 得到启动步骤：\n$$ \\widehat{u}_k^1 = \\frac{1}{1 + \\frac{1}{2}\\nu k^2 \\Delta t} \\left[ \\left(1 - \\frac{1}{2}\\nu k^2 \\Delta t\\right) \\widehat{u}_k^0 + \\Delta t \\mathcal{N}_k^0 \\right] $$\n在完成这第一步之后，我们有了 $\\widehat{u}^0$ 和 $\\widehat{u}^1$，这使我们能够计算 $\\mathcal{N}^0$ 和 $\\mathcal{N}^1$。然后我们可以在所有后续的时间步中使用主要的 AB2/CN 格式。这个具有较大局部误差的单一步骤不会降低该方法的全局二阶收敛性。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the 1D viscous Burgers' equation using a Fourier pseudospectral method\n    with a semi-implicit, second-order time-stepping scheme (CN/AB2).\n    \"\"\"\n\n    test_cases = [\n        # Case A: happy path, dealiased\n        {'N': 64, 'nu': 0.05, 'T': 0.5, 'dt': 5e-4, 'dealias': True},\n        # Case B: aliasing on, sharper gradients\n        {'N': 64, 'nu': 0.01, 'T': 0.5, 'dt': 5e-4, 'dealias': False},\n        # Case C: higher resolution, dealiased\n        {'N': 96, 'nu': 0.01, 'T': 0.5, 'dt': 5e-4, 'dealias': True},\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        N = case['N']\n        nu = case['nu']\n        T = case['T']\n        dt = case['dt']\n        dealias = case['dealias']\n\n        # 1. Spatial grid and wavenumbers\n        x = np.arange(N) * (2 * np.pi / N)\n        # Integer wavenumbers k for Fourier differentiation\n        k = np.fft.fftfreq(N, d=1.0/N)\n\n        # 2. Initial condition in physical and spectral space\n        u0 = np.sin(x)\n        u_hat = np.fft.fft(u0)\n\n        # 3. Precompute parts of the time-stepping operators\n        # Crank-Nicolson multipliers for the linear (diffusion) term\n        linear_op_implicit = 1.0 + 0.5 * nu * dt * k**2\n        linear_op_explicit = 1.0 - 0.5 * nu * dt * k**2\n\n        def nonlinear_term(u_hat_in, k_vec, dealias_flag, N_grid):\n            \"\"\"Computes the nonlinear term -0.5 * i * k * FFT( (IFFT(u_hat))^2 ).\"\"\"\n            u_hat_local = np.copy(u_hat_in)\n            \n            if dealias_flag:\n                # Apply 2/3-rule for dealiasing\n                k_cutoff = math.floor(N_grid / 3.0)\n                # Zero out modes with |k| > k_cutoff\n                u_hat_local[np.abs(k_vec) > k_cutoff] = 0.0\n\n            # Pseudospectral computation\n            u_phys = np.fft.ifft(u_hat_local)\n            u_sq_phys = u_phys**2\n            u_sq_hat = np.fft.fft(u_sq_phys)\n            \n            return -0.5j * k_vec * u_sq_hat\n\n        # 4. Time integration loop\n        num_steps = int(round(T / dt))\n        is_energy_nonincreasing = True\n        rel_tol = 1e-12\n\n        # Startup step calculation (AB1/CN)\n        # Calculate initial energy and nonlinear term\n        energy_prev = 0.5 * np.sum(np.abs(u_hat)**2) / (N**2)\n        N_curr = nonlinear_term(u_hat, k, dealias, N)\n        \n        # First step using AB1/CN\n        u_hat_new = (linear_op_explicit * u_hat + dt * N_curr) / linear_op_implicit\n        u_hat = u_hat_new\n        \n        # Check energy monotonicity for the first step\n        energy_curr = 0.5 * np.sum(np.abs(u_hat)**2) / (N**2)\n        if energy_curr > energy_prev * (1.0 + rel_tol):\n            is_energy_nonincreasing = False\n        energy_prev = energy_curr\n\n        # Store nonlinear terms for AB2\n        N_prev = N_curr\n        N_curr = nonlinear_term(u_hat, k, dealias, N)\n        \n        # Main loop using AB2/CN\n        for _ in range(1, num_steps):\n            # AB2 step for nonlinear term\n            N_ab2 = 1.5 * N_curr - 0.5 * N_prev\n            \n            # Full update\n            u_hat_new = (linear_op_explicit * u_hat + dt * N_ab2) / linear_op_implicit\n            u_hat = u_hat_new\n\n            # Check energy monotonicity\n            energy_curr = 0.5 * np.sum(np.abs(u_hat)**2) / (N**2)\n            if energy_curr > energy_prev * (1.0 + rel_tol) and is_energy_nonincreasing:\n                is_energy_nonincreasing = False\n            energy_prev = energy_curr\n            \n            # Update nonlinear terms for next step\n            N_prev = N_curr\n            N_curr = nonlinear_term(u_hat, k, dealias, N)\n\n        # 5. Compute final diagnostics\n        # Final discrete energy E(T)\n        final_energy = 0.5 * np.sum(np.abs(u_hat)**2) / (N**2)\n\n        # High-mode energy fraction F_hi(T)\n        k_cutoff_analysis = math.floor(N / 3.0)\n        high_modes_mask = np.abs(k) > k_cutoff_analysis\n        \n        total_spectral_energy = np.sum(np.abs(u_hat)**2)\n        if total_spectral_energy > 0:\n            high_mode_spectral_energy = np.sum(np.abs(u_hat[high_modes_mask])**2)\n            high_mode_fraction = high_mode_spectral_energy / total_spectral_energy\n        else:\n            high_mode_fraction = 0.0\n\n        all_results.append([final_energy, high_mode_fraction, is_energy_nonincreasing])\n\n    # 6. Format and print the final output\n    # Convert boolean to lowercase 'true'/'false' for exact matching.\n    output_str = \"[\"\n    for i, res in enumerate(all_results):\n        e, f, b = res\n        b_str = 'true' if b else 'false'\n        output_str += f\"[{e:.8f},{f:.8f},{b_str}]\"\n        if i  len(all_results) - 1:\n            output_str += \", \"\n    output_str += \"]\"\n\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}