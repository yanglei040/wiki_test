{
    "hands_on_practices": [
        {
            "introduction": "在模拟复合材料或具有不同介质的物理系统时，扩散系数的间断是常见情况。本练习旨在引导您推导并实现一种能够精确处理此类界面问题的有限差分格式，其核心在于通过计算有效电导率来保证跨界面的通量连续性。通过与精确解的比较，您将亲身体验到该方法的鲁棒性和准确性。",
            "id": "3393695",
            "problem": "考虑由通量守恒和 Fick 定律支配的一维稳态扩散：扩散通量 $q(x)$ 满足 $q(x) = -k(x)\\,u_x(x)$，其中 $k(x)$ 是一个空间变化的传导率，而稳态平衡意味着 $q_x(x) = 0$。这两者共同构成了在域 $x \\in (0,1)$ 上的二阶偏微分方程 (PDE) $-(k(x)\\,u_x(x))_x = 0$，其 Dirichlet 边界条件为 $u(0) = u_L$ 和 $u(1) = u_R$。传导率 $k(x)$ 在一组有限的界面上是不连续的；具体来说，存在有序的界面位置 $\\{\\alpha_1,\\alpha_2,\\dots,\\alpha_{m-1}\\}$，满足 $0 = \\alpha_0  \\alpha_1  \\cdots  \\alpha_{m-1}  \\alpha_m = 1$，使得对于 $x \\in [\\alpha_{j-1},\\alpha_j)$ 和 $j \\in \\{1,2,\\dots,m\\}$，有 $k(x) = k_j$。在每个界面 $x = \\alpha_j$ 处，物理一致性要求解 $u(x)$ 的连续性和通量 $k(x)\\,u_x(x)$ 的连续性。\n您的任务是：\n- 从守恒律 $q_x(x) = 0$ 和 Fick 定律 $q(x) = -k(x)\\,u_x(x)$ 出发，在一个包含 $N$ 个点 $x_i = i\\,h$（其中 $h = 1/(N-1)$）的均匀网格上，推导一个稳健的有限差分近似，通过面通量隐式地施加界面条件。对内部网格点 $x_i$（其中 $i \\in \\{1,2,\\dots,N-2\\}$）使用控制体积，并获得一个在每个控制体积内保持通量守恒的离散平衡方程。\n- 证明穿过每个面 $(x_i,x_{i+1})$ 的离散通量可以一致地表示为有效传导率 $k_{i+1/2}$ 乘以离散梯度 $(u_{i+1} - u_i)/h$，其中 $k_{i+1/2}$ 源于子区间 $(x_i,x_{i+1})$ 上传导率的局部串联组合。具体来说，对于分段常数的 $k(x)$，电阻的串联定律得出\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(x)}\\,dx }。\n$$\n- 为内部未知数 $\\{u_i\\}_{i=1}^{N-2}$ 组装得到的三对角线性系统，并通过右端项来包含 Dirichlet 边界条件。\n- 对于零源情况 $-(k(x)\\,u_x(x))_x = 0$，在分段常数 $k(x)$ 和 Dirichlet 边界条件下，根据 $1/k(x)$ 的累积积分推导出精确解：\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}。\n$$\n使用此精确解来计算您的数值方法的误差。\n\n此问题中的所有变量都是无量纲的；不需要物理单位。此问题不涉及角度。\n\n实现一个完整的程序，该程序：\n- 构建均匀网格。\n- 根据给定的 $\\{\\alpha_j\\}$ 和 $\\{k_j\\}$，使用串联定律计算每个面区间 $(x_{i-1},x_i)$ 和 $(x_i,x_{i+1})$ 上的有效面传导率 $k_{i-1/2}$ 和 $k_{i+1/2}$。\n- 利用给定的 Dirichlet 边界数据，为内部未知数组装并求解三对角线性系统。\n- 在网格上计算精确解，并计算所有网格点上的最大绝对误差。\n- 执行以下参数值测试套件，并按下面指定的格式在一行中输出每种情况的最大绝对误差。\n\n测试套件（每种情况由 $(N,\\boldsymbol{\\alpha},\\boldsymbol{k},u_L,u_R)$ 指定）：\n1. 情况 A（理想情况，单界面）：$(N = 201,\\ \\boldsymbol{\\alpha} = [0.37],\\ \\boldsymbol{k} = [1.0,4.0],\\ u_L = 0.0,\\ u_R = 1.0)$。\n2. 情况 B（界面靠近边界）：$(N = 201,\\ \\boldsymbol{\\alpha} = [0.001],\\ \\boldsymbol{k} = [2.0,0.5],\\ u_L = 0.0,\\ u_R = 1.0)$。\n3. 情况 C（极端对比度）：$(N = 401,\\ \\boldsymbol{\\alpha} = [0.7333333],\\ \\boldsymbol{k} = [10^{-6},1.0],\\ u_L = 0.0,\\ u_R = 1.0)$。\n4. 情况 D（双界面）：$(N = 301,\\ \\boldsymbol{\\alpha} = [0.2,0.8],\\ \\boldsymbol{k} = [1.0,10.0,0.1],\\ u_L = 0.0,\\ u_R = 1.0)$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表的结果。对于上述四种情况，程序必须以 $[e_A,e_B,e_C,e_D]$ 的格式精确打印一行，其中每个条目是相应情况的最大绝对误差，表示为十进制数。",
            "solution": "我们从基本平衡定律开始。在稳态扩散中，扩散通量 $q(x)$ 遵循守恒律 $q_x(x) = 0$，而 Fick 定律通过 $q(x) = -k(x)\\,u_x(x)$ 将通量与梯度联系起来，其中 $k(x)$ 是传导率。将这两者结合起来，得到二阶偏微分方程 (PDE)\n$$\n-(k(x)\\,u_x(x))_x = 0 \\quad \\text{for } x \\in (0,1),\n$$\n其 Dirichlet 边界条件为 $u(0) = u_L$ 和 $u(1) = u_R$。在任何 $k(x)$ 不连续的界面 $x=\\alpha_j$ 处，物理要求是 $u(x)$ 的连续性和通量 $k(x)\\,u_x(x)$ 的连续性。这些界面条件源于质量守恒和不存在奇异源。\n\n为了进行离散化，我们使用一个包含 $N$ 个点 $x_i = i\\,h$ 的均匀网格，其中 $h = 1/(N-1)$。我们考虑以内部网格点 $x_i$（其中 $i \\in \\{1,2,\\dots,N-2\\}$）为中心的控制体积，其面位于 $x_{i-1/2} = x_{i-1}$ 和 $x_{i+1/2} = x_{i+1}$。将守恒律在控制体积 $(x_{i-1},x_{i+1})$ 上积分，并应用一维散度定理，得到通量平衡：\n$$\nq(x_{i+1/2}) - q(x_{i-1/2}) = 0.\n$$\n用一致的离散通量来近似每个面通量，得到\n$$\nq(x_{i+1/2}) \\approx -k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h}, \\quad q(x_{i-1/2}) \\approx -k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h},\n$$\n其中 $k_{i\\pm 1/2}$ 是有效面传导率。代入后，我们得到离散守恒方程\n$$\n-k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h} + k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h} = 0.\n$$\n乘以 $h$ 并重新整理，得到对称三对角格式\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = 0,\n$$\n此式对每个内部索引 $i \\in \\{1,2,\\dots,N-2\\}$ 均有效。引入 Dirichlet 边界条件 $u_0 = u_L$ 和 $u_{N-1} = u_R$ 将边界贡献移至右端项：\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} =\n\\begin{cases}\nk_{i-1/2}\\,u_L  \\text{if } i=1,\\\\\n0  \\text{if } 1  i  N-2,\\\\\nk_{i+1/2}\\,u_R  \\text{if } i=N-2.\n\\end{cases}\n$$\n这个线性系统是对称且严格对角占优的，因为 $k_{i\\pm 1/2} > 0$，这确保了解的唯一性和稳定性。\n\n界面问题中的关键在于有效面传导率 $k_{i+1/2}$ 的选择。对于光滑的 $k(x)$，使用中点或算术平均值就足以达到二阶精度。然而，在区间 $(x_i,x_{i+1})$ 内 $k(x)$ 的不连续点处，在一个点上简单地对 $k$ 进行采样无法捕捉到正确的通量连续性。正确的有效传导率由电阻的串联定律得到。在长度为 $h$ 的区间 $(x_i,x_{i+1})$ 上，通量是恒定的， $u$ 的下降值是跨子段下降值的总和：\n$$\nu_{i+1} - u_i = \\int_{x_i}^{x_{i+1}} u_x(s)\\,ds = -\\int_{x_i}^{x_{i+1}} \\frac{q}{k(s)}\\,ds = -q\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds.\n$$\n解出通量 $q$：\n$$\nq = -\\frac{u_{i+1} - u_i}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\n与离散通量 $q \\approx -k_{i+1/2}\\,\\frac{u_{i+1}-u_i}{h}$ 比较，得到有效面传导率\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\n对于具有界面 $\\{\\alpha_j\\}$ 的分段常数 $k(x)$，积分 $\\int_{x_i}^{x_{i+1}} 1/k(s)\\,ds$ 分解为在每种材料内部长度为 $\\ell_j$ 的重叠子段上的有限和：\n$$\n\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds = \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j}, \\quad \\text{where } \\ell_j = \\max\\{0, \\min(x_{i+1},\\alpha_j) - \\max(x_i,\\alpha_{j-1})\\}.\n$$\n因此，\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j} }.\n$$\n当 $(x_i,x_{i+1})$ 完全位于单一材料内部时，此式简化为 $k_{i+1/2} = k_j$。当 $(x_i,x_{i+1})$ 横跨单个界面且 $k$ 在两侧为分段常数时，上述公式是两个子段上传导率的精确串联组合，它推广了我们所熟知的调和平均（当界面恰好位于节点中点时，即 $\\ell_{\\text{left}} = \\ell_{\\text{right}} = h/2$，可恢复调和平均）。\n\n对于零源控制偏微分方程，可以通过积分 $u_x = -q/k(x)$（其中通量 $q$ 为常数）并应用 Dirichlet 边界条件来获得精确解：\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}.\n$$\n因为 $k(x)$ 是分段常数，所以 $\\int_0^x \\frac{1}{k(s)}\\,ds$ 是 $x$ 的分段线性函数，其在每个材料区间 $[\\alpha_{j-1},\\alpha_j)$ 内的斜率为 $1/k_j$，而分母 $\\int_0^1 \\frac{1}{k(s)}\\,ds$ 是各区间长度除以其传导率的总和。\n\n程序的算法步骤：\n1. 构建均匀网格 $\\{x_i\\}_{i=0}^{N-1}$ 并设置 Dirichlet 值 $u_0 = u_L$, $u_{N-1} = u_R$。\n2. 对于每个内部索引 $i \\in \\{1,\\dots,N-2\\}$，通过串联定律计算 $k_{i-1/2}$ 和 $k_{i+1/2}$：\n   - 对于面区间 $(x_{i-1},x_i)$，计算重叠子段的长度 $\\ell_j = \\max\\{0, \\min(x_i,\\alpha_j) - \\max(x_{i-1},\\alpha_{j-1})\\}$，然后设置 $k_{i-1/2} = h / \\sum_j (\\ell_j/k_j)$。\n   - 类似地，对 $(x_i,x_{i+1})$ 计算以获得 $k_{i+1/2}$。\n3. 组装三对角系统\n   $$\n   -k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2}+k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = b_i,\n   $$\n   其中 $b_1 = k_{1-1/2}\\,u_L$，$1  i  N-2$ 时 $b_i = 0$，$b_{N-2} = k_{N-2+1/2}\\,u_R$。求解该系统得到 $\\{u_i\\}_{i=1}^{N-2}$。\n4. 在网格点 $\\{x_i\\}$ 上计算精确解 $u_{\\text{exact}}(x_i)$。\n5. 计算数值解和精确解之间的最大绝对误差 $\\max_i |u_i - u_{\\text{exact}}(x_i)|$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef overlap_length(a_start, a_end, b_start, b_end):\n    \"\"\"Length of overlap between intervals [a_start, a_end] and [b_start, b_end].\"\"\"\n    left = max(a_start, b_start)\n    right = min(a_end, b_end)\n    return max(0.0, right - left)\n\ndef effective_conductivity_on_interval(xL, xR, alphas, ks):\n    \"\"\"\n    Compute the effective conductivity over [xL, xR] for piecewise-constant k defined\n    by interfaces 'alphas' (sorted ascending) and values 'ks' per segment.\n    Uses the series law: k_eff = (xR - xL) / sum_j (overlap_j / k_j).\n    \"\"\"\n    # Build segment boundaries: [0, alpha1, alpha2, ..., 1]\n    boundaries = [0.0] + list(alphas) + [1.0]\n    denom = 0.0\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        ell = overlap_length(xL, xR, seg_start, seg_end)\n        if ell  0.0:\n            denom += ell / ks[j]\n    # denom should be positive since xR > xL and ks[j] > 0\n    if denom = 0.0:\n        # This should not happen, but guard against numerical issues.\n        # Fallback to a large number to avoid division by zero\n        return 1e12\n    return (xR - xL) / denom\n\ndef assemble_and_solve(N, alphas, ks, uL, uR):\n    \"\"\"\n    Assemble the tridiagonal system for -(k u')' = 0 with Dirichlet BCs\n    using effective face conductivities, solve, and return the grid, numerical solution.\n    \"\"\"\n    x = np.linspace(0.0, 1.0, N)\n    h = x[1] - x[0]\n    M = N - 2  # number of interior points\n    if M = 0:\n        # Trivial grid with only boundaries\n        if N == 2:\n            u = np.array([uL, uR])\n        elif N == 1:\n            u = np.array([uL])\n        else:\n            u = np.array([])\n        return x, u\n\n    # Precompute face conductivities k_{i-1/2} and k_{i+1/2} for interior stencils\n    k_left_face = np.zeros(M)\n    k_right_face = np.zeros(M)\n    for i in range(1, N - 1):  # i = 1..N-2\n        im = i - 1  # interior index 0..M-1\n        k_left_face[im] = effective_conductivity_on_interval(x[i - 1], x[i], alphas, ks)\n        k_right_face[im] = effective_conductivity_on_interval(x[i], x[i + 1], alphas, ks)\n\n    # Assemble tridiagonal matrix A and RHS b\n    diag = k_left_face + k_right_face\n    lower = -k_left_face[1:]   # subdiagonal A[i,i-1] for i=1..M-1\n    upper = -k_right_face[:-1] # superdiagonal A[i,i+1] for i=0..M-2\n    b = np.zeros(M)\n    # Boundary contributions\n    b[0] += k_left_face[0] * uL\n    b[-1] += k_right_face[-1] * uR\n\n    # Build full matrix for solve (small sizes acceptable)\n    A = np.zeros((M, M))\n    np.fill_diagonal(A, diag)\n    np.fill_diagonal(A[1:], lower)       # subdiagonal\n    np.fill_diagonal(A[:, 1:], upper)    # superdiagonal\n\n    # Solve for interior unknowns\n    u_interior = np.linalg.solve(A, b)\n\n    # Assemble full solution including boundaries\n    u = np.zeros(N)\n    u[0] = uL\n    u[-1] = uR\n    u[1:-1] = u_interior\n    return x, u\n\ndef integral_invk_up_to(x_val, alphas, ks):\n    \"\"\"\n    Compute S(x) = int_0^x (1/k(s)) ds for piecewise-constant k defined by 'alphas' and 'ks'.\n    \"\"\"\n    boundaries = [0.0] + list(alphas) + [1.0]\n    S = 0.0\n    # Sum contributions from each segment up to x\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        if x_val = seg_start:\n            break\n        contrib_end = min(x_val, seg_end)\n        length = max(0.0, contrib_end - seg_start)\n        S += length / ks[j]\n        if x_val  seg_end:\n            break\n    return S\n\ndef exact_solution_on_grid(x, alphas, ks, uL, uR):\n    \"\"\"\n    Exact solution for -(k u')' = 0 with Dirichlet BCs:\n    u(x) = uL + (uR - uL) * S(x) / S(1), where S(x) = int_0^x 1/k(s) ds.\n    \"\"\"\n    S1 = integral_invk_up_to(1.0, alphas, ks)\n    # Handle degenerate case (should not happen for positive ks)\n    if S1 == 0.0:\n        return np.full_like(x, uL)\n    u_exact = np.empty_like(x)\n    for i, xi in enumerate(x):\n        Sx = integral_invk_up_to(xi, alphas, ks)\n        u_exact[i] = uL + (uR - uL) * (Sx / S1)\n    return u_exact\n\ndef max_abs_error(u_num, u_exact):\n    return float(np.max(np.abs(u_num - u_exact)))\n\ndef run_case(N, alphas, ks, uL, uR):\n    x, u_num = assemble_and_solve(N, alphas, ks, uL, uR)\n    u_exact = exact_solution_on_grid(x, alphas, ks, uL, uR)\n    return max_abs_error(u_num, u_exact)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (N, alphas, ks, uL, uR)\n        (201, [0.37], [1.0, 4.0], 0.0, 1.0),\n        # Case B: interface near boundary\n        (201, [0.001], [2.0, 0.5], 0.0, 1.0),\n        # Case C: extreme contrast ratio\n        (401, [0.7333333], [1.0e-6, 1.0], 0.0, 1.0),\n        # Case D: two interfaces\n        (301, [0.2, 0.8], [1.0, 10.0, 0.1], 0.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, alphas, ks, uL, uR = case\n        err = run_case(N, alphas, ks, uL, uR)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在上一节处理了系数间断的特定情况后，我们现在转向一个更普遍的问题：如何从第一性原理出发设计一个高质量的离散格式。本练习要求您推导一种特定的系数平均方法，以确保当系数 $a(x,y)$ 和解 $u(x,y)$ 本身都是线性函数时，离散算子能够精确地再现连续算子的性质。这种保持简单解精确性的能力是构建可靠数值格式的关键一步。",
            "id": "3393670",
            "problem": "考虑二维空间中的稳态变系数扩散方程，\n$$\n-\\,\\nabla\\cdot\\big(a(x,y)\\,\\nabla u(x,y)\\big)=0,\n$$\n该方程定义在一个矩形域上，该域具有一个由轴对齐的矩形控制体组成的整合的笛卡尔网格。设以 $\\big(x_i,y_j\\big)$ 为中心的控制体在 $x$ 方向和 $y$ 方向的宽度分别为 $\\Delta x_i$ 和 $\\Delta y_j$。一个标准的五点有限体积近似将穿过位于 $\\big(x_{i+\\frac{1}{2}},y_j\\big)$ 的垂直面的法向通量定义为\n$$\nF_{i+\\frac{1}{2},j} \\;\\approx\\; -\\,a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j,\n$$\n水平面的情况类似，其中 $\\Delta x_{i+\\frac{1}{2}}=\\tfrac{1}{2}\\big(\\Delta x_i+\\Delta x_{i+1}\\big)$，而 $a_{i+\\frac{1}{2},j}$ 是一个面心系数，通过对邻近的单元中心采样值 $a_{i,j}$ 和 $a_{i+1,j}$ 进行平均得到。\n\n从散度定理和有限体积法的定义出发，推导出一个 $a_{i+\\frac{1}{2},j}$ 的面平均设计，该设计保证当系数 $a(x,y)=A x + B y + C$ 是线性的且满足 $\\nabla a\\cdot\\nabla u=0$（从而使连续算子为零）时，离散算子能精确地保持任何稳态线性解 $u(x,y)=\\alpha x+\\beta y+\\gamma$。在一般的非均匀笛卡尔网格上，为实现此特性，请确定对 $a_{i+\\frac{1}{2},j}$ 的平均权重所需的最小条件。你的最终答案必须是用 LaTeX 书写的，以 $\\Delta x_i$、$\\Delta x_{i+1}$、$a_{i,j}$ 和 $a_{i+1,j}$ 表示的 $a_{i+\\frac{1}{2},j}$ 的单一闭式解析表达式。不需要任何数值近似或四舍五入，最终答案中也不应包含任何物理单位。",
            "solution": "该问题要求在一个稳态变系数扩散方程的有限体积离散化中，为系数 $a(x,y)$ 推导一个面平均公式，\n$$ -\\nabla \\cdot \\big(a(x,y) \\nabla u(x,y)\\big) = 0. $$\n这个我们记为 $a_{i+\\frac{1}{2},j}$ 的面心系数公式必须保证，当系数 $a(x,y) = Ax + By + C$ 也是线性的且条件 $\\nabla a \\cdot \\nabla u = 0$ 成立时，离散算子能精确地保持任何形式为 $u(x,y) = \\alpha x + \\beta y + \\gamma$ 的线性解。\n\n有限体积法首先将偏微分方程在一个控制体 $V_{i,j}$ 上积分，该控制体以 $(x_i, y_j)$ 为中心，尺寸为 $\\Delta x_i \\times \\Delta y_j$。\n$$ - \\iint_{V_{i,j}} \\nabla \\cdot (a \\nabla u) \\, dx \\, dy = 0. $$\n应用散度定理将其转换为一个关于穿过控制体边界 $\\partial V_{i,j}$ 的通量平衡方程：\n$$ - \\oint_{\\partial V_{i,j}} (a \\nabla u) \\cdot \\mathbf{n} \\, dS = 0, $$\n其中 $\\mathbf{n}$ 是向外的单位法向量。对于一个矩形控制体，该方程表明穿过四个面的通量之和为零：\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} - \\mathcal{F}_{i-\\frac{1}{2}, j} + \\mathcal{G}_{i, j+\\frac{1}{2}} - \\mathcal{G}_{i, j-\\frac{1}{2}} = 0. $$\n这里，$\\mathcal{F}$ 和 $\\mathcal{G}$ 分别表示穿过垂直面和水平面的精确总通量。对于位于 $x=x_{i+\\frac{1}{2}}$ 的垂直面，其通量由以下积分给出：\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} = \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} \\left(-a(x,y) \\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=x_{i+\\frac{1}{2}}} dy. $$\n问题为此通量提供了相应的数值近似：\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j. $$\n将这些数值通量代入平衡方程，即可形成离散守恒律：\n$$ (F_{i+\\frac{1}{2},j} - F_{i-\\frac{1}{2},j}) + (G_{i,j+\\frac{1}{2}} - G_{i,j-\\frac{1}{2}}) = 0. $$\n我们的目标是确定 $a_{i+\\frac{1}{2},j}$ 的表达式，以确保此离散方程对给定的线性函数精确成立。\n\n对于线性解 $u(x,y) = \\alpha x + \\beta y + \\gamma$，节点值为 $u_{i,j} = \\alpha x_i + \\beta y_j + \\gamma$。在单元中心之间计算的梯度的有限差商是精确的：\n$$ \\frac{u_{i+1,j} - u_{i,j}}{x_{i+1} - x_i} = \\frac{(\\alpha x_{i+1} + \\beta y_j + \\gamma) - (\\alpha x_i + \\beta y_j + \\gamma)}{x_{i+1} - x_i} = \\alpha = \\frac{\\partial u}{\\partial x}. $$\n问题将单元中心之间的距离定义为 $\\Delta x_{i+\\frac{1}{2}} = \\frac{1}{2}(\\Delta x_i + \\Delta x_{i+1})$。相邻控制体的几何形状意味着 $x_{i+1} - x_i = \\frac{1}{2}\\Delta x_i + \\frac{1}{2}\\Delta x_{i+1} = \\Delta x_{i+\\frac{1}{2}}$。因此，离散导数项正确地计算了常数偏导数：\n$$ \\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}} = \\alpha. $$\n类似地，对于 $y$ 方向，有 $\\frac{u_{i,j+1}-u_{i,j}}{\\Delta y_{j+\\frac{1}{2}}} = \\beta$。\n\n将这些精确的导数代入数值通量表达式中，可得：\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j \\quad \\text{和} \\quad G_{i,j+\\frac{1}{2}} = -a_{i,j+\\frac{1}{2}} \\beta \\Delta x_i. $$\n控制体 $(i,j)$ 的离散守恒律变为：\n$$ \\alpha \\Delta y_j (a_{i-\\frac{1}{2},j} - a_{i+\\frac{1}{2},j}) + \\beta \\Delta x_i (a_{i,j-\\frac{1}{2}} - a_{i,j+\\frac{1}{2}}) = 0. $$\n为满足此条件，我们可以强制要求数值通量近似 $F_{i+\\frac{1}{2},j}$ 等于精确的积分通量 $\\mathcal{F}_{i+\\frac{1}{2},j}$。我们来计算在线性系数 $a(x,y)=Ax+By+C$ 和常数梯度 $\\partial u / \\partial x = \\alpha$ 情况下的精确通量：\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} (A x_{i+\\frac{1}{2}} + B y + C) \\, dy. $$\n对 $y$ 进行积分：\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\left[ (A x_{i+\\frac{1}{2}} + C)y + \\frac{B}{2}y^2 \\right]_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} = -\\alpha \\left( (A x_{i+\\frac{1}{2}} + C)\\Delta y_j + B y_j \\Delta y_j \\right). $$\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha (A x_{i+\\frac{1}{2}} + B y_j + C) \\Delta y_j = -\\alpha \\, a\\left(x_{i+\\frac{1}{2}}, y_j\\right) \\Delta y_j. $$\n通过令数值通量 $F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j$ 等于精确通量 $\\mathcal{F}_{i+\\frac{1}{2},j}$，我们找到了面系数的必要条件：\n$$ a_{i+\\frac{1}{2},j} = a\\left(x_{i+\\frac{1}{2}}, y_j\\right). $$\n这意味着面上的数值系数必须等于该面几何中心处连续系数的精确值。这一选择保证了离散守恒方程得到满足，因为它与连续条件 $\\nabla a \\cdot \\nabla u = A\\alpha+B\\beta = 0$ 成正比。\n\n最后一步是，用已知的单元中心值 $a_{i,j} = a(x_i, y_j)$ 和 $a_{i+1,j} = a(x_{i+1}, y_j)$ 来表示 $a_{i+\\frac{1}{2},j} = a(x_{i+\\frac{1}{2}}, y_j)$。由于 $a(x,y)$ 对其自变量是线性的，函数 $a(x, y_j)$ 是 $x$ 的线性函数。它在 $x_{i+\\frac{1}{2}}$ 处的值可以通过在其在 $x_i$ 和 $x_{i+1}$ 处的值之间进行线性插值得到。函数 $f(x)$ 在点 $x_0$ 和 $x_1$ 之间的一维线性插值通用公式为 $f(x) = f(x_0) \\frac{x_1-x}{x_1-x_0} + f(x_1) \\frac{x-x_0}{x_1-x_0}$。\n我们设 $f(x) = a(x, y_j)$，$x_0=x_i$，$x_1=x_{i+1}$，以及 $x=x_{i+\\frac{1}{2}}$。面的坐标是 $x_{i+\\frac{1}{2}} = x_i + \\frac{\\Delta x_i}{2}$。用于插值权重的相关距离是：\n$x_{i+1} - x_i = \\Delta x_{i+\\frac{1}{2}} = \\frac{\\Delta x_i + \\Delta x_{i+1}}{2}$。\n$x - x_0 = x_{i+\\frac{1}{2}} - x_i = \\frac{\\Delta x_i}{2}$。\n$x_1 - x = x_{i+1} - x_{i+\\frac{1}{2}} = \\frac{\\Delta x_{i+1}}{2}$。\n\n将这些距离代入插值公式：\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\frac{\\Delta x_{i+1}}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}} + a_{i+1,j} \\frac{\\frac{\\Delta x_i}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}}. $$\n简化此表达式可得到最终的面平均公式：\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\Delta x_{i+1}}{\\Delta x_i + \\Delta x_{i+1}} + a_{i+1,j} \\frac{\\Delta x_i}{\\Delta x_i + \\Delta x_{i+1}}. $$\n这是一个相邻单元中心系数的加权算术平均值，其中权重由单元的宽度决定。\n对于形式为 $a_{i+1/2,j} = w_i a_{i,j} + w_{i+1}a_{i+1,j}$ 的方案，所确定的平均权重 $w_i$ 和 $w_{i+1}$ 的最小条件是它们必须满足 $w_i+w_{i+1}=1$ 和 $w_i x_i + w_{i+1} x_{i+1} = x_{i+1/2}$。这些条件强制要求平均等效于到面中心的线性插值，这正是推导出的公式所实现的功能。",
            "answer": "$$\\boxed{\\frac{\\Delta x_{i+1} a_{i,j} + \\Delta x_i a_{i+1,j}}{\\Delta x_i + \\Delta x_{i+1}}}$$"
        },
        {
            "introduction": "前面的练习探讨了如何为光滑和间断的系数选择合适的平均方法，现在我们将这一概念推向极限，研究当系数在网格尺度下发生剧烈振荡时的情形。本编程练习将通过一个数值实验，对比算术平均和调和平均在计算有效扩散率时的表现，揭示在欠解析情况下，只有物理上正确的平均格式（调和平均）才能捕捉到系统的宏观行为。这对于理解多尺度问题的数值模拟至关重要。",
            "id": "3393701",
            "problem": "考虑单位区间上守恒形式的一维变系数扩散偏微分方程（PDE），\n$$-\\frac{d}{dx}\\left(a(x)\\frac{du}{dx}\\right)=0 \\quad \\text{for } x\\in(0,1),$$\n服从狄利克雷边界条件\n$$u(0)=0,\\quad u(1)=1.$$\n设扩散系数为\n$$a(x)=1+\\alpha\\sin\\!\\left(\\frac{x}{h^\\gamma}\\right),$$\n其中参数满足 $|\\alpha|1$ 和 $\\gamma>0$，均匀网格间距为 $h=\\frac{1}{N}$，$N\\in\\mathbb{N}$。任务是研究在网格点 $x_i=i h$, $i=0,\\dots,N$ 上为守恒二阶有限差分格式构建面心系数时相关的混叠和平均效应，其中离散面位置为 $x_{i+\\frac{1}{2}}=\\left(i+\\frac{1}{2}\\right)h$。\n\n从通量守恒以及离散散度和梯度的定义出发，使用经典的守恒格式在该网格上离散化偏微分方程，\n$$\\frac{1}{h}\\left(F_{i+\\frac{1}{2}}-F_{i-\\frac{1}{2}}\\right)=0 \\quad \\text{for } i=1,\\dots,N-1,$$\n其中面通量为\n$$F_{i+\\frac{1}{2}}=-a_{i+\\frac{1}{2}}\\frac{u_{i+1}-u_i}{h},$$\n并施加边界条件 $u_0=0$ 和 $u_N=1$。此处，$a_{i+\\frac{1}{2}}$ 是一个面心扩散系数，必须由 $a(x)$ 的节点采样值构建。\n\n基于节点采样 $a_i=a(x_i)$，定义两种不同的面系数构建方法：\n- 算术面平均：\n$$a_{i+\\frac{1}{2}}^{\\mathrm{arith}}=\\frac{a_i+a_{i+1}}{2}.$$\n- 调和面平均：\n$$a_{i+\\frac{1}{2}}^{\\mathrm{harm}}=\\frac{2}{\\frac{1}{a_i}+\\frac{1}{a_{i+1}}}.$$\n\n对于给定的网格和面系数构建方法，将离散有效扩散率定义为在整个区域上维持单位势降的恒定离散通量；等价地，如果稳态离散通量 $J_h$ 对所有内面都满足 $u_{i+1}-u_i=\\frac{J_h h}{a_{i+\\frac{1}{2}}}$，并且边界数据强制 $\\sum_{i=0}^{N-1}(u_{i+1}-u_i)=1$，则\n$$a_{\\mathrm{eff}}^{(h)}:=J_h.$$\n\n将一维守恒问题的连续有效扩散率定义为 $a(x)$ 在区间上的调和平均值的倒数，\n$$a_{\\mathrm{eff}}:=\\left(\\int_{0}^{1}\\frac{1}{a(x)}\\,dx\\right)^{-1}.$$\n对于函数族 $a(x)=1+\\alpha\\sin\\!\\left(\\frac{x}{h^\\gamma}\\right)$，其中 $|\\alpha|1$ 且 $\\gamma>0$，当 $h\\to 0$ 时，在 $(0,1)$ 上的振荡次数趋于无穷，并且 $a_{\\mathrm{eff}}$ 在极限情况下是良定义的且与 $h$ 无关。\n\n您的程序必须：\n- 对于每个指定的测试用例 $(\\alpha,\\gamma,N)$ 及 $h=\\frac{1}{N}$，使用算术和调和面平均法以及上述守恒离散格式计算 $a_{\\mathrm{eff}}^{(h)}$（不要解稠密线性系统；利用守恒性直接计算稳态离散通量）。\n- 对于相同的 $\\alpha$，使用通过分析得出的正确表达式计算连续有效扩散率 $a_{\\mathrm{eff}}$。\n- 报告每个测试用例的两个相对误差，\n$$\\mathrm{err}^{\\mathrm{arith}}=\\frac{\\left|a_{\\mathrm{eff}}^{(h),\\mathrm{arith}}-a_{\\mathrm{eff}}\\right|}{a_{\\mathrm{eff}}},\\qquad \\mathrm{err}^{\\mathrm{harm}}=\\frac{\\left|a_{\\mathrm{eff}}^{(h),\\mathrm{harm}}-a_{\\mathrm{eff}}\\right|}{a_{\\mathrm{eff}}}.$$\n\n测试套件：\n- 用例 1：$(\\alpha,\\gamma,N)=\\left(0.5,0.5,512\\right)$。\n- 用例 2：$(\\alpha,\\gamma,N)=\\left(0.5,1.0,512\\right)$。\n- 用例 3：$(\\alpha,\\gamma,N)=\\left(0.5,1.5,512\\right)$。\n- 用例 4：$(\\alpha,\\gamma,N)=\\left(0.0,1.3,64\\right)$。\n- 用例 5：$(\\alpha,\\gamma,N)=\\left(0.9,1.5,4096\\right)$。\n- 用例 6：$(\\alpha,\\gamma,N)=\\left(0.5,1.5,32\\right)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序如下\n$$\\left[\\mathrm{err}^{\\mathrm{arith}}_{\\#1},\\mathrm{err}^{\\mathrm{harm}}_{\\#1},\\mathrm{err}^{\\mathrm{arith}}_{\\#2},\\mathrm{err}^{\\mathrm{harm}}_{\\#2},\\dots,\\mathrm{err}^{\\mathrm{arith}}_{\\#6},\\mathrm{err}^{\\mathrm{harm}}_{\\#6}\\right].$$\n所有值都必须是无物理单位的实数。目标是确定在哪些区间（$\\gamma$ 相对于网格分辨率的值）算术面平均能捕捉到正确的有效扩散率（相对误差小），以及在哪些区间会失效（量级为 1 的相对误差），并与调和面平均进行对比。",
            "solution": "该问题经过分析被认为是有效的。所有前提、定义和约束在科学上都是合理的，在数学上是一致的，并且是适定的。该问题是偏微分方程数值分析中的一个标准练习，尽管很有见地，但它特别关注有限差分法中变系数的处理。\n\n求解过程分为三个主要步骤：\n1. 推导连续有效扩散率 $a_{\\mathrm{eff}}$ 的解析表达式。\n2. 推导离散有效扩散率 $a_{\\mathrm{eff}}^{(h)}$ 的计算公式。\n3. 将这些公式应用于指定的测试用例，以计算所需的相对误差。\n\n**1. 连续有效扩散率 $a_{\\mathrm{eff}}$**\n\n问题将连续有效扩散率定义为\n$$a_{\\mathrm{eff}} := \\left(\\int_{0}^{1}\\frac{1}{a(x)}\\,dx\\right)^{-1}.$$\n扩散系数由 $a(x) = 1+\\alpha\\sin(x/h^\\gamma)$ 给出。当网格间距 $h \\to 0$（等价于 $N \\to \\infty$）时，正弦项的频率 $\\omega = 1/h^\\gamma$ 趋于无穷。因此，这是一个高振荡函数的积分。对于任何周期为 $P$ 的周期函数 $f(y)$，其与一个快速变化的线性函数复合后的积分会收敛到其平均值：\n$$\\lim_{k\\to\\infty} \\int_a^b f(kx) \\,dx = (b-a) \\frac{1}{P} \\int_0^P f(y) \\,dy.$$\n在我们的例子中，函数是 $g(x) = 1/a(x) = 1/(1+\\alpha\\sin(x/h^\\gamma))$。设 $k=1/h^\\gamma$。我们关心当 $k\\to\\infty$ 时 $\\int_0^1 \\frac{dx}{1+\\alpha\\sin(kx)}$ 的极限。函数 $f(y) = 1/(1+\\alpha\\sin y)$ 的周期为 $2\\pi$。其平均值为\n$$\\frac{1}{2\\pi}\\int_0^{2\\pi} \\frac{1}{1+\\alpha\\sin y} \\,dy.$$\n这是一个标准积分。使用 Weierstrass 代换 $t=\\tan(y/2)$，我们有 $dy = \\frac{2\\,dt}{1+t^2}$ 和 $\\sin y = \\frac{2t}{1+t^2}$。当 $y$ 从 $0$ 变化到 $2\\pi$ 时，$t$ 从 $0$ 变化到 $\\infty$，然后从 $-\\infty$ 变化到 $0$，所以积分区间可以取为从 $-\\infty$ 到 $\\infty$。\n\\begin{align*} \\frac{1}{2\\pi}\\int_0^{2\\pi} \\frac{dy}{1+\\alpha\\sin y} = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} \\frac{1}{1+\\alpha\\frac{2t}{1+t^2}} \\frac{2\\,dt}{1+t^2} \\\\ = \\frac{1}{\\pi}\\int_{-\\infty}^{\\infty} \\frac{dt}{1+t^2+2\\alpha t} \\\\ = \\frac{1}{\\pi}\\int_{-\\infty}^{\\infty} \\frac{dt}{(t+\\alpha)^2 + (1-\\alpha^2)}. \\end{align*}\n因为 $|\\alpha|1$，所以 $1-\\alpha^2 > 0$。该积分计算结果为\n$$ \\frac{1}{\\pi} \\left[ \\frac{1}{\\sqrt{1-\\alpha^2}} \\arctan\\left(\\frac{t+\\alpha}{\\sqrt{1-\\alpha^2}}\\right) \\right]_{-\\infty}^{\\infty} = \\frac{1}{\\pi\\sqrt{1-\\alpha^2}} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{\\sqrt{1-\\alpha^2}}. $$\n因此，在极限 $h\\to 0$ 下，积分 $\\int_0^1 \\frac{dx}{a(x)}$ 收敛于 $\\frac{1}{\\sqrt{1-\\alpha^2}}$。所以连续有效扩散率为\n$$ a_{\\mathrm{eff}} = \\left( \\frac{1}{\\sqrt{1-\\alpha^2}} \\right)^{-1} = \\sqrt{1-\\alpha^2}. $$\n该表达式用作计算相对误差的“真”值。\n\n**2. 离散有效扩散率 $a_{\\mathrm{eff}}^{(h)}$**\n\n守恒有限差分格式由下式给出\n$$ \\frac{1}{h}\\left(F_{i+\\frac{1}{2}}-F_{i-\\frac{1}{2}}\\right)=0, \\quad i=1,\\dots,N-1. $$\n该方程意味着离散通量在所有面上是恒定的，即对于某个常数 $J_h$ 和所有 $i=0,\\dots,N-1$，有 $F_{i+\\frac{1}{2}} = -J_h$。\n通量定义为\n$$ F_{i+\\frac{1}{2}} = -a_{i+\\frac{1}{2}}\\frac{u_{i+1}-u_i}{h}. $$\n令两个通量表达式相等，我们得到\n$$ -J_h = -a_{i+\\frac{1}{2}}\\frac{u_{i+1}-u_i}{h}, $$\n可以重新排列以表示单元面上的势降：\n$$ u_{i+1}-u_i = \\frac{J_h h}{a_{i+\\frac{1}{2}}}. $$\n为了找到 $J_h$，我们将这个势降在所有从 $i=0$ 到 $i=N-1$ 的区间上求和：\n$$ \\sum_{i=0}^{N-1}(u_{i+1}-u_i) = \\sum_{i=0}^{N-1} \\frac{J_h h}{a_{i+\\frac{1}{2}}}. $$\n左边是一个伸缩求和，其值为 $u_N-u_0$。使用边界条件 $u_0=0$ 和 $u_N=1$，我们得到 $u_N-u_0=1$。方程变为\n$$ 1 = J_h h \\sum_{i=0}^{N-1} \\frac{1}{a_{i+\\frac{1}{2}}}. $$\n求解 $J_h$（其定义为离散有效扩散率 $a_{\\mathrm{eff}}^{(h)}$），我们得到\n$$ a_{\\mathrm{eff}}^{(h)} := J_h = \\left(h \\sum_{i=0}^{N-1} \\frac{1}{a_{i+\\frac{1}{2}}}\\right)^{-1}. $$\n该公式允许一旦构建了面心系数 $a_{i+\\frac{1}{2}}$，就可以直接计算 $a_{\\mathrm{eff}}^{(h)}$，而无需求解完整的未知数向量 $u_i$。问题指定了两种构建这些系数的方法。\n\n**3. 计算过程**\n\n对于每个测试用例 $(\\alpha, \\gamma, N)$：\n1. 设置网格间距 $h=1/N$。\n2. 计算连续有效扩散率 $a_{\\mathrm{eff}} = \\sqrt{1-\\alpha^2}$。\n3. 生成网格节点 $x_i=ih$，其中 $i=0, \\dots, N$。\n4. 计算扩散系数的节点值：$a_i = 1+\\alpha\\sin(x_i/h^\\gamma)$。\n5. 对于算术平均：\n   a. 计算面系数：$a_{i+\\frac{1}{2}}^{\\mathrm{arith}} = \\frac{a_i+a_{i+1}}{2}$，其中 $i=0, \\dots, N-1$。\n   b. 计算离散有效扩散率：$a_{\\mathrm{eff}}^{(h),\\mathrm{arith}} = \\left(h \\sum_{i=0}^{N-1} \\frac{1}{a_{i+\\frac{1}{2}}^{\\mathrm{arith}}}\\right)^{-1}$。\n   c. 计算相对误差：$\\mathrm{err}^{\\mathrm{arith}}=\\frac{\\left|a_{\\mathrm{eff}}^{(h),\\mathrm{arith}}-a_{\\mathrm{eff}}\\right|}{a_{\\mathrm{eff}}}$。\n6. 对于调和平均：\n   a. 计算面系数：$a_{i+\\frac{1}{2}}^{\\mathrm{harm}} = \\frac{2a_i a_{i+1}}{a_i+a_{i+1}}$，其中 $i=0, \\dots, N-1$。\n   b. 计算离散有效扩散率：$a_{\\mathrm{eff}}^{(h),\\mathrm{harm}} = \\left(h \\sum_{i=0}^{N-1} \\frac{1}{a_{i+\\frac{1}{2}}^{\\mathrm{harm}}}\\right)^{-1}$。注意 $\\frac{1}{a_{i+\\frac{1}{2}}^{\\mathrm{harm}}} = \\frac{1}{2}(\\frac{1}{a_i}+\\frac{1}{a_{i+1}})$。该求和成为对 $1/a(x)$ 的梯形法则积分。\n   c. 计算相对误差：$\\mathrm{err}^{\\mathrm{harm}}=\\frac{\\left|a_{\\mathrm{eff}}^{(h),\\mathrm{harm}}-a_{\\mathrm{eff}}\\right|}{a_{\\mathrm{eff}}}$。\n7. 收集并报告计算出的误差。思考过程中的分析表明，对于 $\\gamma1$（充分解析），两种方法都应产生小误差。对于 $\\gamma \\ge 1$（临界采样或混叠），算术平均预计会通过收敛到不正确的值或有偏估计而产生显著的 $O(1)$ 误差，而调和平均预计将保持准确，因为它对应于定义有效扩散率的积分的一个稳定数值求积。用例 4，其中 $\\alpha=0$，是一个控制组，此时 $a(x)=1$，$a_{\\mathrm{eff}}=1$，两种方法都应产生精确的离散值 $a_{\\mathrm{eff}}^{(h)}=1$，从而导致零误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_errors(alpha, gamma, N):\n    \"\"\"\n    Computes the relative errors for the effective diffusivity for a given\n    test case (alpha, gamma, N) using arithmetic and harmonic averaging.\n    \"\"\"\n    h = 1.0 / N\n\n    # Step 1: Compute continuum effective diffusivity\n    # For highly oscillatory a(x), a_eff converges to sqrt(1-alpha^2).\n    # Handle alpha=0 case, where a_eff=1. The formula is robust.\n    a_eff_cont = np.sqrt(1 - alpha**2)\n\n    # Step 2: Set up the grid and nodal coefficients\n    # x_i = i*h for i=0,...,N\n    x_nodes = np.linspace(0.0, 1.0, N + 1)\n    \n    # a_i = a(x_i)\n    # The term x_nodes / (h**gamma) can be large, but sin handles it.\n    a_nodes = 1.0 + alpha * np.sin(x_nodes / (h**gamma))\n\n    # --- Arithmetic Averaging ---\n    # a_{i+1/2} = (a_i + a_{i+1}) / 2\n    a_face_arith = (a_nodes[:-1] + a_nodes[1:]) / 2.0\n    \n    # a_eff_h = (h * sum(1/a_{i+1/2}))^{-1}\n    # np.sum automatically sums over the entire array.\n    a_eff_h_arith = 1.0 / (h * np.sum(1.0 / a_face_arith))\n    \n    # err = |a_eff_h - a_eff_cont| / a_eff_cont\n    # a_eff_cont is guaranteed to be non-zero since |alpha|1.\n    # For alpha=0, a_eff_cont=1, so no division by zero.\n    err_arith = np.abs(a_eff_h_arith - a_eff_cont) / a_eff_cont\n\n    # --- Harmonic Averaging ---\n    # a_{i+1/2} = 2 / (1/a_i + 1/a_{i+1})\n    a_face_harm = 2.0 / (1.0/a_nodes[:-1] + 1.0/a_nodes[1:])\n    \n    # a_eff_h = (h * sum(1/a_{i+1/2}))^{-1}\n    a_eff_h_harm = 1.0 / (h * np.sum(1.0 / a_face_harm))\n    \n    # err = |a_eff_h - a_eff_cont| / a_eff_cont\n    err_harm = np.abs(a_eff_h_harm - a_eff_cont) / a_eff_cont\n\n    return err_arith, err_harm\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (alpha, gamma, N)\n    test_cases = [\n        (0.5, 0.5, 512),   # Case 1\n        (0.5, 1.0, 512),   # Case 2\n        (0.5, 1.5, 512),   # Case 3\n        (0.0, 1.3, 64),    # Case 4\n        (0.9, 1.5, 4096),  # Case 5\n        (0.5, 1.5, 32),    # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha, gamma, N = case\n        err_arith, err_harm = compute_errors(alpha, gamma, N)\n        results.append(err_arith)\n        results.append(err_harm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}