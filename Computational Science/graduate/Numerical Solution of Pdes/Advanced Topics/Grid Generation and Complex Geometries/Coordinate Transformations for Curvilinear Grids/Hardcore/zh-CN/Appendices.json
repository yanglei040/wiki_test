{
    "hands_on_practices": [
        {
            "introduction": "任何坐标变换都在其定义的空间中引入了独特的局部几何结构。在数值求解偏微分方程时，理解和计算这些几何量至关重要。本练习将通过一个我们熟悉的例子——极坐标系，来巩固这一理解。你将从第一性原理出发，推导协变和逆变度量张量以及尺度因子，从而将抽象的张量概念与具体的几何直觉联系起来 。",
            "id": "3375279",
            "problem": "考虑一个从极坐标 $(r,\\theta)$ 到直角坐标 $(x,y)$ 的二维曲线坐标映射，由 $(x,y)=(r\\cos\\theta,r\\sin\\theta)$ 在去心平面 $r0$ 上给出。在为了曲线网格上的数值求解而进行坐标系间偏微分方程（PDE）变换的背景下，从以下基本定义出发：\n\n- 协变基矢量定义为 $\\boldsymbol{a}_{i}=\\partial\\boldsymbol{x}/\\partial\\xi^{i}$，其中 $\\boldsymbol{x}=(x,y)$ 且 $\\xi^{1}=r$, $\\xi^{2}=\\theta$。\n- 协变度量张量分量定义为 $g_{ij}=\\boldsymbol{a}_{i}\\cdot\\boldsymbol{a}_{j}$。\n- 逆变度量张量分量定义为 $g^{ij}$，满足 $g^{ik}g_{kj}=\\delta^{i}_{\\;j}$，其中 $\\delta^{i}_{\\;j}$ 是克罗内克δ。\n- 对于正交坐标系，标度因子为 $h_{i}=\\sqrt{g_{ii}}$。\n\n仅使用这些定义，推导给定映射的协变度量张量 $g_{ij}(r,\\theta)$ 及其逆 $g^{ij}(r,\\theta)$，并求出标度因子 $h_{r}$ 和 $h_{\\theta}$。假设 $\\theta$ 以弧度为单位。将您的最终答案表示为一个单行矩阵，按顺序依次列出\n$g_{rr}$、$g_{r\\theta}$、$g_{\\theta r}$、$g_{\\theta\\theta}$、$g^{rr}$、$g^{r\\theta}$、$g^{\\theta r}$、$g^{\\theta\\theta}$、$h_{r}$、$h_{\\theta}$。\n无需四舍五入。",
            "solution": "该问题被验证为自洽的、有科学依据且适定的。任务是基于基本定义，推导极坐标系的协变和逆变度量张量以及标度因子。\n\n直角坐标 $(x,y)$ 作为曲线坐标 $(\\xi^{1}, \\xi^{2}) = (r, \\theta)$ 的函数，由以下映射给出：\n$$x(r,\\theta) = r\\cos\\theta$$\n$$y(r,\\theta) = r\\sin\\theta$$\n因此，在直角坐标基 $(\\boldsymbol{i}, \\boldsymbol{j})$ 中的位置矢量 $\\boldsymbol{x}$ 为：\n$$\\boldsymbol{x}(r, \\theta) = (r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}$$\n\n协变基矢量 $\\boldsymbol{a}_{i} = \\frac{\\partial\\boldsymbol{x}}{\\partial\\xi^{i}}$ 通过对位置矢量关于每个曲线坐标求偏导数来计算。\n\n对于 $\\xi^{1} = r$：\n$$\\boldsymbol{a}_{1} = \\boldsymbol{a}_{r} = \\frac{\\partial\\boldsymbol{x}}{\\partial r} = \\frac{\\partial}{\\partial r}\\left((r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}\\right) = (\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}$$\n\n对于 $\\xi^{2} = \\theta$：\n$$\\boldsymbol{a}_{2} = \\boldsymbol{a}_{\\theta} = \\frac{\\partial\\boldsymbol{x}}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta}\\left((r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}\\right) = (-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j}$$\n\n协变度量张量的分量 $g_{ij} = \\boldsymbol{a}_{i} \\cdot \\boldsymbol{a}_{j}$ 通过计算这些基矢量的点积求得。\n\n分量 $g_{11} = g_{rr}$：\n$$g_{rr} = \\boldsymbol{a}_{r} \\cdot \\boldsymbol{a}_{r} = ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}) \\cdot ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j})$$\n$$g_{rr} = \\cos^{2}\\theta + \\sin^{2}\\theta = 1$$\n\n分量 $g_{12} = g_{r\\theta}$：\n$$g_{r\\theta} = \\boldsymbol{a}_{r} \\cdot \\boldsymbol{a}_{\\theta} = ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}) \\cdot ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j})$$\n$$g_{r\\theta} = (\\cos\\theta)(-r\\sin\\theta) + (\\sin\\theta)(r\\cos\\theta) = -r\\cos\\theta\\sin\\theta + r\\sin\\theta\\cos\\theta = 0$$\n\n分量 $g_{21} = g_{\\theta r}$：\n度量张量是对称的，所以 $g_{\\theta r} = g_{r\\theta}$。\n$$g_{\\theta r} = 0$$\n\n分量 $g_{22} = g_{\\theta\\theta}$：\n$$g_{\\theta\\theta} = \\boldsymbol{a}_{\\theta} \\cdot \\boldsymbol{a}_{\\theta} = ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j}) \\cdot ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j})$$\n$$g_{\\theta\\theta} = (-r\\sin\\theta)^{2} + (r\\cos\\theta)^{2} = r^{2}\\sin^{2}\\theta + r^{2}\\cos^{2}\\theta = r^{2}(\\sin^{2}\\theta + \\cos^{2}\\theta) = r^{2}$$\n\n协变度量张量，表示为矩阵，是：\n$$[g_{ij}] = \\begin{pmatrix} g_{rr}  g_{r\\theta} \\\\ g_{\\theta r}  g_{\\theta\\theta} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  r^{2} \\end{pmatrix}$$\n由于非对角分量 ($g_{r\\theta}$、$g_{\\theta r}$) 为零，该坐标系是正交的。\n\n逆变度量张量 $[g^{ij}]$ 是协变度量张量 $[g_{ij}]$ 的逆。对于一个 $2 \\times 2$ 的对角矩阵，其逆矩阵通过取每个对角元素的倒数得到。\n$$[g^{ij}] = [g_{ij}]^{-1} = \\begin{pmatrix} 1  0 \\\\ 0  r^{2} \\end{pmatrix}^{-1} = \\begin{pmatrix} 1^{-1}  0 \\\\ 0  (r^{2})^{-1} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  \\frac{1}{r^{2}} \\end{pmatrix}$$\n逆变度量张量的分量是：\n$$g^{rr} = 1$$\n$$g^{r\\theta} = 0$$\n$$g^{\\theta r} = 0$$\n$$g^{\\theta\\theta} = \\frac{1}{r^{2}}$$\n\n最后，对于正交坐标系，标度因子 $h_{i}$ 定义为 $h_{i} = \\sqrt{g_{ii}}$。\n$r$ 坐标的标度因子是：\n$$h_{r} = \\sqrt{g_{rr}} = \\sqrt{1} = 1$$\n$\\theta$ 坐标的标度因子是：\n$$h_{\\theta} = \\sqrt{g_{\\theta\\theta}} = \\sqrt{r^{2}}$$\n鉴于题目说明规定了 $r0$，我们有 $|r|=r$。\n$$h_{\\theta} = r$$\n\n按指定顺序排列的所求量为：\n$g_{rr} = 1$\n$g_{r\\theta} = 0$\n$g_{\\theta r} = 0$\n$g_{\\theta\\theta} = r^{2}$\n$g^{rr} = 1$\n$g^{r\\theta} = 0$\n$g^{\\theta r} = 0$\n$g^{\\theta\\theta} = \\frac{1}{r^{2}}$\n$h_{r} = 1$\n$h_{\\theta} = r$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  0  0  r^2  1  0  0  \\frac{1}{r^2}  1  r\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从计算几何属性过渡到其实际应用，一个关键步骤是确保我们生成的网格是有效的。数值模拟要求网格是“单射”的，即网格线不能交叉或折叠，否则会导致计算奇异。本练习将探讨如何利用坐标变换的雅可比行列式来保证网格的有效性，这是网格生成中的一个核心问题 。通过分析一个具体的映射，你将确定使变换保持有效的参数范围。",
            "id": "3375241",
            "problem": "在偏微分方程 (PDE) 的数值解法中，结构化曲线网格通常通过从一个简单的参考域进行平滑坐标映射来构建。考虑从计算坐标 $(\\xi,\\eta) \\in [0,1]^2$ 到物理坐标 $(x,y)$ 的映射，其定义为 $x=\\xi$ 和 $y=\\eta+\\epsilon \\sin(\\pi \\xi)\\sin(\\pi \\eta)$，其中 $\\epsilon \\in \\mathbb{R}$ 是一个标量控制参数。仅使用雅可比行列式的定义、反函数定理以及关于三角函数的标准事实，确定最大的容许振幅 $\\epsilon_{\\max}  0$，使得对于所有满足 $|\\epsilon|  \\epsilon_{\\max}$ 的 $\\epsilon$，该映射在闭合单位正方形上是单射的，并且是边界共形的，即它在边界上限制为一个保持边对应关系和角点位置的双射。请以单个精确表达式的形式给出您的答案。不需要四舍五入。",
            "solution": "该问题要求为给定的坐标映射找到使其有效的最大容许振幅 $\\epsilon_{\\max}  0$。一个映射如果是在闭合单位正方形上的单射，并满足特定的边界条件，则被定义为有效的。\n\n从计算坐标 $(\\xi, \\eta) \\in [0, 1]^2$ 到物理坐标 $(x, y)$ 的映射由以下公式给出：\n$$x(\\xi, \\eta) = \\xi$$\n$$y(\\xi, \\eta) = \\eta + \\epsilon \\sin(\\pi \\xi) \\sin(\\pi \\eta)$$\n其中 $\\epsilon \\in \\mathbb{R}$ 是一个控制参数。\n\n首先，我们验证边界条件。问题指出，映射必须是“边界共形的”，这被定义为在边界上限制为一个保持边对应关系和角点位置的双射。我们来研究一下计算域边界 $\\partial([0, 1]^2)$ 的四条边 的映射情况。\n\n1.  底边：$\\eta = 0$，$\\xi \\in [0, 1]$。\n    该映射给出 $x = \\xi$ 和 $y = 0 + \\epsilon \\sin(\\pi \\xi) \\sin(0) = 0$。其像是从 $(0, 0)$ 到 $(1, 0)$ 的线段。\n2.  右边：$\\xi = 1$，$\\eta \\in [0, 1]$。\n    该映射给出 $x = 1$ 和 $y = \\eta + \\epsilon \\sin(\\pi) \\sin(\\pi \\eta) = \\eta$。其像是从 $(1, 0)$ 到 $(1, 1)$ 的线段。\n3.  顶边：$\\eta = 1$，$\\xi \\in [0, 1]$。\n    该映射给出 $x = \\xi$ 和 $y = 1 + \\epsilon \\sin(\\pi \\xi) \\sin(\\pi) = 1$。其像是从 $(1, 1)$ 到 $(0, 1)$ 的线段。\n4.  左边：$\\xi = 0$，$\\eta \\in [0, 1]$。\n    该映射给出 $x = 0$ 和 $y = \\eta + \\epsilon \\sin(0) \\sin(\\pi \\eta) = \\eta$。其像是从 $(0, 1)$ 到 $(0, 0)$ 的线段。\n\n计算正方形的四个角点映射如下：\n- $(0, 0) \\mapsto (0, 0)$\n- $(1, 0) \\mapsto (1, 0)$\n- $(1, 1) \\mapsto (1, 1)$\n- $(0, 1) \\mapsto (0, 1)$\n\n该映射在单位正方形的整个边界上是恒等变换。这自然地满足了作为保持边对应关系和角点位置的双射的条件。因此，边界条件对 $\\epsilon$ 的值没有施加任何限制。\n\n接下来，我们处理映射必须在闭合单位正方形 $[0, 1]^2$ 上是单射的这一条件。该映射是连续可微的。根据一个与反函数定理相关的结果（通常称为全局单值性定理或 Hadamard 定理），一个定义在紧致、单连通域上的 $C^1$ 映射，如果它在边界上是单射的，并且其雅可比行列式在域的内部不变号（且不为零），则该映射是全局单射的。\n\n我们已经确定了在边界上的单射性。下一步是计算该变换的雅可比行列式。雅可比矩阵 $\\mathbf{J}$ 由下式给出：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n偏导数为：\n$\\frac{\\partial x}{\\partial \\xi} = 1$\n$\\frac{\\partial x}{\\partial \\eta} = 0$\n$\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} \\left( \\eta + \\epsilon \\sin(\\pi \\xi) \\sin(\\pi \\eta) \\right) = \\epsilon \\pi \\cos(\\pi \\xi) \\sin(\\pi \\eta)$\n$\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} \\left( \\eta + \\epsilon \\sin(\\pi \\xi) \\sin(\\pi \\eta) \\right) = 1 + \\epsilon \\pi \\sin(\\pi \\xi) \\cos(\\pi \\eta)$\n\n雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} 1  0 \\\\ \\epsilon \\pi \\cos(\\pi \\xi) \\sin(\\pi \\eta)  1 + \\epsilon \\pi \\sin(\\pi \\xi) \\cos(\\pi \\eta) \\end{pmatrix}\n$$\n雅可比行列式 $J$ 为：\n$$\nJ(\\xi, \\eta) = \\det(\\mathbf{J}) = (1) \\left( 1 + \\epsilon \\pi \\sin(\\pi \\xi) \\cos(\\pi \\eta) \\right) - (0) \\left( \\epsilon \\pi \\cos(\\pi \\xi) \\sin(\\pi \\eta) \\right)\n$$\n$$\nJ(\\xi, \\eta) = 1 + \\epsilon \\pi \\sin(\\pi \\xi) \\cos(\\pi \\eta)\n$$\n在边界上任何满足 $\\xi \\in \\{0, 1\\}$ 的点，我们有 $\\sin(\\pi \\xi) = 0$，这使得 $J(\\xi, \\eta) = 1$。为确保雅可比行列式在内部不变号且不为零，我们要求对所有的 $(\\xi, \\eta) \\in [0, 1]^2$ 都有 $J(\\xi, \\eta)  0$。这给出了不等式：\n$$\n1 + \\epsilon \\pi \\sin(\\pi \\xi) \\cos(\\pi \\eta)  0\n$$\n为了找到保证该不等式在整个域上都成立的 $\\epsilon$ 的条件，我们必须找到当 $(\\xi, \\eta) \\in [0, 1]^2$ 时，项 $f(\\xi, \\eta) = \\sin(\\pi \\xi) \\cos(\\pi \\eta)$ 的最小值和最大值。\n\n对于 $\\xi \\in [0, 1]$，项 $\\sin(\\pi \\xi)$ 的范围是从 $0$ 到 $1$。\n对于 $\\eta \\in [0, 1]$，项 $\\cos(\\pi \\eta)$ 的范围是从 $-1$ 到 $1$。\n\n$f(\\xi, \\eta)$ 的最大值出现在 $\\sin(\\pi \\xi)$ 达到其最大值 ($1$) 且 $\\cos(\\pi \\eta)$ 达到其最大值 ($1$) 时。这发生在 $(\\xi, \\eta) = (\\frac{1}{2}, 0)$，此时 $f(\\frac{1}{2}, 0) = \\sin(\\frac{\\pi}{2}) \\cos(0) = 1 \\cdot 1 = 1$。\n$f(\\xi, \\eta)$ 的最小值出现在 $\\sin(\\pi \\xi)$ 达到其最大值 ($1$) 且 $\\cos(\\pi \\eta)$ 达到其最小值 ($-1$) 时。这发生在 $(\\xi, \\eta) = (\\frac{1}{2}, 1)$，此时 $f(\\frac{1}{2}, 1) = \\sin(\\frac{\\pi}{2}) \\cos(\\pi) = 1 \\cdot (-1) = -1$。\n所以，$f(\\xi, \\eta)$ 的范围是 $[-1, 1]$。\n\n我们必须满足的不等式是 $\\epsilon \\pi f(\\xi, \\eta)  -1$。我们必须同时考虑正的和负的 $\\epsilon$。\n\n情况1：$\\epsilon  0$。\n不等式可以重写为 $f(\\xi, \\eta)  -\\frac{1}{\\epsilon \\pi}$。这必须对所有 $f(\\xi, \\eta)$ 的值都成立，包括其最小值 $-1$。所以我们要求：\n$$\n-1  -\\frac{1}{\\epsilon \\pi} \\implies 1  \\frac{1}{\\epsilon \\pi} \\implies \\epsilon \\pi  1 \\implies \\epsilon  \\frac{1}{\\pi}\n$$\n\n情况2：$\\epsilon  0$。\n令 $\\epsilon = -|\\epsilon|$。不等式是 $1 - |\\epsilon| \\pi f(\\xi,\\eta)  0$，或 $1  |\\epsilon| \\pi f(\\xi, \\eta)$。这必须对所有 $f(\\xi, \\eta)$ 的值都成立，所以它必须对其最大值 $1$ 成立。我们要求：\n$$\n1  |\\epsilon| \\pi (1) \\implies |\\epsilon|  \\frac{1}{\\pi}\n$$\n由于 $\\epsilon  0$，这意味着 $\\epsilon  -\\frac{1}{\\pi}$。\n\n结合两种情况，使得映射为单射的 $\\epsilon$ 的条件是 $-\\frac{1}{\\pi}  \\epsilon  \\frac{1}{\\pi}$，这等价于 $|\\epsilon|  \\frac{1}{\\pi}$。\n\n问题要求找到最大的容许振幅 $\\epsilon_{\\max}  0$，使得对于所有满足 $|\\epsilon|  \\epsilon_{\\max}$ 的 $\\epsilon$，该映射是有效的。我们推导出的条件是 $|\\epsilon|  \\frac{1}{\\pi}$。通过直接比较，我们可以确定 $\\epsilon_{\\max}$ 为 $\\frac{1}{\\pi}$。如果 $|\\epsilon| = \\frac{1}{\\pi}$，雅可比行列式在域内或边界上的某一点会变为零，单射性的条件被违反。\n\n因此，最大的这种振幅是 $\\epsilon_{\\max} = \\frac{1}{\\pi}$。",
            "answer": "$$\\boxed{\\frac{1}{\\pi}}$$"
        },
        {
            "introduction": "当我们将连续的数学模型转换到离散的数值计算世界时，新的挑战便会出现。在曲线网格上，即使是像均匀流这样最简单的物理情景，其精确保持也并非理所当然。本练习深入探讨了“自由流保持”和“几何守恒律”(GCL) 的概念，揭示了在离散化度量项和通量项时，若采用不一致的算子会如何引入数值误差 。这是一个在开发稳健求解器时必须掌握的关键实践。",
            "id": "3375264",
            "problem": "考虑在光滑曲线网格上二维被动标量的守恒输运。设计算坐标为 $(\\xi,\\eta)\\in[0,1)\\times[0,1)$，带有周期性边界，且到物理空间的映射由下式给出\n$$\nx(\\xi,\\eta) = \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta),\\qquad\ny(\\xi,\\eta) = \\eta + \\alpha \\cos(2\\pi \\xi)\\sin(2\\pi \\eta),\n$$\n其中 $\\alpha\\in\\mathbb{R}$ 为以弧度为单位的预设扭曲振幅。雅可比行列式为\n$$\nJ(\\xi,\\eta) = x_\\xi y_\\eta - x_\\eta y_\\xi.\n$$\n对于恒定的物理平流速度 $(u,v)\\in\\mathbb{R}^2$ 和计算空间中的守恒公式，标量场 $q(\\xi,\\eta,t)$ 的方程为\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{1}{J}\\left(\\frac{\\partial}{\\partial \\xi}\\big(\\tilde U\\,q\\big)+\\frac{\\partial}{\\partial \\eta}\\big(\\tilde V\\,q\\big)\\right)=0,\n$$\n其中逆变度量加权速度分量为\n$$\n\\tilde U = u\\,y_\\eta - v\\,x_\\eta,\\qquad \\tilde V = -u\\,y_\\xi + v\\,x_\\xi.\n$$\n一个一致的离散格式应该能精确保持均匀解 $q(\\xi,\\eta,t)\\equiv q_0$；这被称为自由流保持（Free-Stream Preservation, FSP）。在一个节点网格上，其均匀间距为 $h_\\xi=h_\\eta=1/N$，令 $D_\\xi^{(p)}$ 和 $D_\\eta^{(p)}$ 分别为 $\\xi$ 和 $\\eta$ 方向上 $p\\in\\{2,4,6\\}$ 阶的周期性中心差分导数算子。考虑均匀状态 $q\\equiv 1$ 的半离散残差，\n$$\n\\mathcal{R}=\\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m\\right),\n$$\n其中散度以 $p_{\\rm flux}$ 阶计算，但用于构建 $\\tilde U_m,\\tilde V_m$ 的度量项是通过 $p_{\\rm metric}$ 阶的离散导数得到的，即，\n$$\n\\tilde U_m = u\\,\\big(D_\\eta^{(p_{\\rm metric})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm metric})}x\\big),\\qquad\n\\tilde V_m = -u\\,\\big(D_\\xi^{(p_{\\rm metric})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm metric})}x\\big).\n$$\n从坐标变换和守恒输运律的核心定义出发，并仅使用周期性中心差分算子的性质，您必须：\n\n- 根据为确保 $q\\equiv 1$ 时 $\\mathcal{R}\\equiv 0$ 必须成立的离散度量恒等式，推导离散FSP条件。\n- 解释为什么 $p_{\\rm metric}\\neq p_{\\rm flux}$ 的不匹配通常会违反此条件。\n- 在不改变通量散度所用 $p_{\\rm flux}$ 的情况下，提出一种恢复离散FSP的修正方法。\n\n然后，实现一个程序，该程序：\n\n- 为指定的 $N$，在 $(\\xi,\\eta)$ 中构建一个包含 $N\\times N$ 个节点的均匀周期性网格。\n- 使用标准节点模板和均匀间距 $h=1/N$，将 $D^{(p)}$ 实现为 $p\\in\\{2,4,6\\}$ 阶的周期性中心差分。\n- 对于指定的 $\\alpha$（角度以弧度为单位），根据给定的映射计算 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$。\n- 使用 $p_{\\rm metric}$ 构造 $\\tilde U_m, \\tilde V_m$，并使用 $p_{\\rm flux}$ 计算残差 $\\mathcal{R}$。\n- 通过返回网格上的最大绝对值 $\\|\\mathcal{R}\\|_\\infty$ 作为浮点数来量化对FSP的违反程度。\n- 实现您提出的修正方法，并计算修正后的残差 $\\mathcal{R}_{\\rm corr}$ 及其 $\\|\\mathcal{R}_{\\rm corr}\\|_\\infty$。\n\n为了归一化，通过精确地对 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 进行微分，从映射中解析地计算 $J(\\xi,\\eta)$：\n$$\nx_\\xi=1+\\alpha(2\\pi)\\cos(2\\pi\\xi)\\sin(2\\pi\\eta),\\quad\nx_\\eta=\\alpha(2\\pi)\\sin(2\\pi\\xi)\\cos(2\\pi\\eta),\n$$\n$$\ny_\\xi=-\\alpha(2\\pi)\\sin(2\\pi\\xi)\\sin(2\\pi\\eta),\\quad\ny_\\eta=1+\\alpha(2\\pi)\\cos(2\\pi\\xi)\\cos(2\\pi\\eta),\n$$\n然后 $J=x_\\xi y_\\eta - x_\\eta y_\\xi$。所有三角函数均使用弧度制角。\n\n测试套件。您的程序必须计算并汇总以下五个案例，将每个结果报告为浮点数：\n\n- 案例1（不匹配，正常路径）：$N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$, $p_{\\rm metric}=2$。报告 $\\|\\mathcal{R}\\|_\\infty$。\n- 案例2（阶数匹配）：$N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$, $p_{\\rm metric}=4$。报告 $\\|\\mathcal{R}\\|_\\infty$。\n- 案例3（在奇数网格上更强的不匹配）：$N=63$, $\\alpha=0.3$, $u=-0.8$, $v=0.3$, $p_{\\rm flux}=6$, $p_{\\rm metric}=2$。报告 $\\|\\mathcal{R}\\|_\\infty$。\n- 案例4（对案例1应用您的修正）：使用 $N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$，并根据您的修正方法构造 $\\tilde U,\\tilde V$。报告 $\\|\\mathcal{R}_{\\rm corr}\\|_\\infty$。\n- 案例5（边缘情况，直线网格）：$N=32$, $\\alpha=0.0$, $u=1.2$, $v=-0.7$, $p_{\\rm flux}=6$, $p_{\\rm metric}=2$。报告 $\\|\\mathcal{R}\\|_\\infty$。\n\n最终输出格式。您的程序应生成单行输出，其中包含用逗号分隔并用方括号括起来的结果列表（例如， $[{\\rm result}_1,{\\rm result}_2,{\\rm result}_3,{\\rm result}_4,{\\rm result}_5]$）。所有角度必须解释为弧度。不需要物理单位转换，所有结果必须打印为浮点数。",
            "solution": "该问题要求推导在曲线网格上有限差分格式的自由流保持（FSP）条件，解释当度量和通量导数算子不一致时其失效的原因，并提出一种修正方法。随后需要进行数值实现以验证分析。\n\n### 第1部分：离散自由流保持条件的推导\n\n在计算域 $(\\xi,\\eta)$ 中，标量 $q$ 的守恒输运方程由下式给出：\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{1}{J}\\left(\\frac{\\partial}{\\partial \\xi}\\big(\\tilde U\\,q\\big)+\\frac{\\partial}{\\partial \\eta}\\big(\\tilde V\\,q\\big)\\right)=0\n$$\n其中 $\\tilde U = u\\,y_\\eta - v\\,x_\\eta$ 和 $\\tilde V = -u\\,y_\\xi + v\\,x_\\xi$ 是恒定物理速度 $(u,v)$ 下的逆变度量加权速度分量。\n\n自由流保持（FSP）原则要求均匀流场 $q(\\xi,\\eta,t) \\equiv q_0$（其中 $q_0$ 为常数）必须是控制方程的精确稳态解。不失一般性，我们设 $q_0=1$。对于稳态，$\\frac{\\partial q}{\\partial t} = 0$。将 $q=1$ 代入方程，得到连续FSP条件，通常称为几何守恒律（Geometric Conservation Law, GCL）：\n$$\n\\frac{1}{J}\\left(\\frac{\\partial \\tilde U}{\\partial \\xi} + \\frac{\\partial \\tilde V}{\\partial \\eta}\\right) = 0 \\implies \\frac{\\partial \\tilde U}{\\partial \\xi} + \\frac{\\partial \\tilde V}{\\partial \\eta} = 0\n$$\n代入 $\\tilde U$ 和 $\\tilde V$ 的定义，并注意到 $u$ 和 $v$ 是常数：\n$$\n\\frac{\\partial}{\\partial \\xi}(u\\,y_\\eta - v\\,x_\\eta) + \\frac{\\partial}{\\partial \\eta}(-u\\,y_\\xi + v\\,x_\\xi) = 0\n$$\n$$\nu\\left(\\frac{\\partial y_\\eta}{\\partial \\xi} - \\frac{\\partial y_\\xi}{\\partial \\eta}\\right) - v\\left(\\frac{\\partial x_\\eta}{\\partial \\xi} - \\frac{\\partial x_\\xi}{\\partial \\eta}\\right) = 0\n$$\n根据光滑映射 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 的克莱罗定理（Clairaut's theorem），混合偏导数相等（例如 $\\frac{\\partial^2 y}{\\partial \\xi \\partial \\eta} = \\frac{\\partial^2 y}{\\partial \\eta \\partial \\xi}$）。这意味着 $\\frac{\\partial y_\\eta}{\\partial \\xi} = \\frac{\\partial y_\\xi}{\\partial \\eta}$ 且 $\\frac{\\partial x_\\eta}{\\partial \\xi} = \\frac{\\partial x_\\xi}{\\partial \\eta}$。因此，上述表达式简化为 $u(0) - v(0) = 0$，此式成立，从而证实了连续GCL。\n\n现在，我们分析半离散形式。均匀状态 $q=1$ 的残差为：\n$$\n\\mathcal{R}=\\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m\\right)\n$$\n其中 $D_\\xi^{(p)}$ 和 $D_\\eta^{(p)}$ 是 $p$ 阶离散导数算子，离散度量加权速度为：\n$$\n\\tilde U_m = u\\,\\big(D_\\eta^{(p_{\\rm metric})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm metric})}x\\big), \\qquad \\tilde V_m = -u\\,\\big(D_\\xi^{(p_{\\rm metric})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm metric})}x\\big)\n$$\n对于离散FSP，残差 $\\mathcal{R}$ 必须恒等于零。这要求离散散度为零：\n$$\nD_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m = 0\n$$\n代入 $\\tilde U_m$ 和 $\\tilde V_m$ 的表达式，并利用离散算子的线性性质：\n$$\nD_\\xi^{(p_{\\rm flux})}\\left(u(D_\\eta^{(p_{\\rm metric})}y) - v(D_\\eta^{(p_{\\rm metric})}x)\\right) + D_\\eta^{(p_{\\rm flux})}\\left(-u(D_\\xi^{(p_{\\rm metric})}y) + v(D_\\xi^{(p_{\\rm metric})}x)\\right) = 0\n$$\n$$\nu\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}y - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}y\\right) - v\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}x - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}x\\right) = 0\n$$\n由于该关系式必须对任意恒定速度 $(u,v)$ 都成立，所以 $u$ 和 $v$ 的系数必须独立为零。这得出了FSP所需的离散度量恒等式：\n$$\nD_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}y = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}y\n$$\n$$\nD_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}x = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}x\n$$\n这些方程表明，混合离散导数算子应用于网格坐标函数时，其作用必须是可交换的。\n\n### 第2部分：由算子不匹配导致的FSP违反\n\n如果离散导数算子可交换，则离散度量恒等式得到满足。我们来分析这一性质。算子 $D_\\xi^{(p)}$ 和 $D_\\eta^{(p)}$ 是线性的，作用于周期性网格，因此可以在傅里叶空间中进行分析。一个导数算子 $D^{(p)}$ 有一个傅里叶符号 $\\widehat{D^{(p)}}(k,h)$，使得 $D^{(p)}f$ 的离散傅里叶变换为 $\\widehat{D^{(p)}}(k,h)\\hat{f}(k)$。沿 $\\xi$ 作用的算子的符号取决于波数 $k_\\xi$，而沿 $\\eta$ 作用的算子的符号取决于波数 $k_\\eta$。\n\n算子交换条件 $D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})} = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}$ 在傅里叶空间中转化为：\n$$\n\\widehat{D^{(p_{\\rm flux})}}(k_\\xi, h)\\widehat{D^{(p_{\\rm metric})}}(k_\\eta, h) = \\widehat{D^{(p_{\\rm flux})}}(k_\\eta, h)\\widehat{D^{(p_{\\rm metric})}}(k_\\xi, h)\n$$\n对于所有离散波数 $k_\\xi, k_\\eta$。令 $F_1(k) = \\widehat{D^{(p_{\\rm flux})}}(k, h)$ 和 $F_2(k) = \\widehat{D^{(p_{\\rm metric})}}(k, h)$。条件是 $F_1(k_\\xi) F_2(k_\\eta) = F_1(k_\\eta) F_2(k_\\xi)$。这可以重排为：\n$$\n\\frac{F_1(k_\\xi)}{F_2(k_\\xi)} = \\frac{F_1(k_\\eta)}{F_2(k_\\eta)}\n$$\n该方程必须对所有 $k_\\xi$ 和 $k_\\eta$ 成立。这仅在比率 $F_1(k)/F_2(k)$ 为一个不依赖于波数 $k$ 的常数时才可能实现。\n\n我们来考察 $p=2, 4$ 阶中心差分算子的符号：\n- $p=2$: $\\widehat{D^{(2)}}(k, h) = \\frac{i}{h}\\sin(kh)$\n- $p=4$: $\\widehat{D^{(4)}}(k, h) = \\frac{i}{h}\\left(\\frac{4}{3}\\sin(kh) - \\frac{1}{6}\\sin(2kh)\\right)$\n\n如果 $p_{\\rm flux} \\neq p_{\\rm metric}$，例如 $p_{\\rm flux}=4$ 和 $p_{\\rm metric}=2$，则比率为：\n$$\n\\frac{\\widehat{D^{(4)}}(k, h)}{\\widehat{D^{(2)}}(k, h)} = \\frac{\\frac{i}{h}\\left(\\frac{4}{3}\\sin(kh) - \\frac{1}{6}\\sin(2kh)\\right)}{\\frac{i}{h}\\sin(kh)} = \\frac{4}{3} - \\frac{1}{6}\\frac{2\\sin(kh)\\cos(kh)}{\\sin(kh)} = \\frac{4}{3} - \\frac{1}{3}\\cos(kh)\n$$\n该比率是波数 $k$ 的函数，并且不是常数。因此，交换性质不成立，离散度量恒等式被违反，FSP也因此被破坏。一个非零残差 $\\mathcal{R}$ 会出现，引入可能破坏解的数值误差。只有当 $p_{\\rm flux} = p_{\\rm metric}$ 时，FSP才能得到保证，此时比率为1，是一个常数，算子可平凡交换。\n\n### 第3部分：恢复FSP的修正方法\n\n问题的根源在于用于计算度量（$D^{(p_{\\rm metric})}$）和散度（$D^{(p_{\\rm flux})}$）的离散算子不一致，导致了对离散GCL的违反。问题要求提出一种在不改变通量散度算子阶数 $p_{\\rm flux}$ 的情况下恢复FSP的修正方法。\n\n恢复FSP最直接的方法是确保离散度量恒等式得到满足。这可以通过使算子兼容来实现。我提出的修正是使用与通量散度所用*相同*的离散算子重新计算度量项。具体来说，我们在构造度量加权速度时设置 $p_{\\rm metric} = p_{\\rm flux}$。\n\n因此，修正后的度量加权速度分量 $\\tilde U_{\\rm corr}$ 和 $\\tilde V_{\\rm corr}$ 定义为：\n$$\n\\tilde U_{\\rm corr} = u\\,\\big(D_\\eta^{(p_{\\rm flux})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm flux})}x\\big)\n$$\n$$\n\\tilde V_{\\rm corr} = -u\\,\\big(D_\\xi^{(p_{\\rm flux})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm flux})}x\\big)\n$$\n然后，均匀状态 $q=1$ 的残差计算如下：\n$$\n\\mathcal{R}_{\\rm corr} = \\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_{\\rm corr} + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_{\\rm corr}\\right)\n$$\n将修正后的通量定义代入散度项，我们得到：\n$$\nu\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm flux})}y - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm flux})}y\\right) - v\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm flux})}x - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm flux})}x\\right)\n$$\n由于 $D_\\xi^{(p_{\\rm flux})}$ 和 $D_\\eta^{(p_{\\rm flux})}$ 是同类型的算子，作用于计算网格的不同笛卡尔坐标轴上，它们的应用是可交换的：$D_\\xi^{(p)}D_\\eta^{(p)} = D_\\eta^{(p)}D_\\xi^{(p)}$。因此，括号中的项恒等于零。修正后的残差 $\\mathcal{R}_{\\rm corr}$ 在机器精度内将为零，FSP得以恢复。此修正不改变通量散度算子 $D^{(p_{\\rm flux})}$，而是修改其参数以使其与之保持一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for Free-Stream Preservation analysis.\n    \"\"\"\n\n    def periodic_central_difference(F, p, axis, h):\n        \"\"\"\n        Computes the periodic central difference of order p on a 2D array F.\n\n        Args:\n            F (np.ndarray): The 2D input field.\n            p (int): The order of accuracy {2, 4, 6}.\n            axis (int): The axis along which to differentiate (0 for xi, 1 for eta).\n            h (float): The uniform grid spacing.\n\n        Returns:\n            np.ndarray: The derivative field.\n        \"\"\"\n        if p == 2:\n            # Stencil weights: [-1/2, 0, 1/2] / h\n            return (np.roll(F, -1, axis=axis) - np.roll(F, 1, axis=axis)) / (2.0 * h)\n        elif p == 4:\n            # Stencil weights: [1/12, -8/12, 0, 8/12, -1/12] / h\n            return (\n                -np.roll(F, -2, axis=axis) + 8 * np.roll(F, -1, axis=axis)\n                - 8 * np.roll(F, 1, axis=axis) + np.roll(F, 2, axis=axis)\n            ) / (12.0 * h)\n        elif p == 6:\n            # Correct stencil: (c3*(f(i+3)-f(i-3)) + c2*(f(i+2)-f(i-2)) + c1*(f(i+1)-f(i-1)))/h\n            # c1=3/4, c2=-3/20, c3=1/60\n            # Common denominator 60h: (45*(f(i+1)-f(i-1)) - 9*(f(i+2)-f(i-2)) + 1*(f(i+3)-f(i-3)))/(60h)\n            # The provided implementation is confusingly written but mathematically equivalent.\n            return (\n                np.roll(F, -3, axis=axis)\n                - 9 * np.roll(F, -2, axis=axis)\n                + 45 * np.roll(F, -1, axis=axis)\n                - 45 * np.roll(F, 1, axis=axis)\n                + 9 * np.roll(F, 2, axis=axis)\n                - np.roll(F, 3, axis=axis)\n            ) / (-60.0 * h)\n        else:\n            raise ValueError(f\"Unsupported order p={p}\")\n\n    def compute_fsp_error(N, alpha, u, v, p_flux, p_metric):\n        \"\"\"\n        Computes the maximum absolute FSP residual ||R||_infinity for given parameters.\n        \"\"\"\n        h = 1.0 / N\n        xi_1d = np.arange(N) * h\n        eta_1d = np.arange(N) * h\n        xi, eta = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n        # Compute physical coordinates from the mapping\n        x = xi + alpha * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        y = eta + alpha * np.cos(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n\n        # Compute analytical Jacobian for normalization\n        x_xi_ana = 1 + alpha * 2 * np.pi * np.cos(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        x_eta_ana = alpha * 2 * np.pi * np.sin(2 * np.pi * xi) * np.cos(2 * np.pi * eta)\n        y_xi_ana = -alpha * 2 * np.pi * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        y_eta_ana = 1 + alpha * 2 * np.pi * np.cos(2 * np.pi * xi) * np.cos(2 * np.pi * eta)\n        J_ana = x_xi_ana * y_eta_ana - x_eta_ana * y_xi_ana\n\n        # Compute discrete metric terms using the specified p_metric operator\n        y_eta_m = periodic_central_difference(y, p_metric, 1, h)\n        x_eta_m = periodic_central_difference(x, p_metric, 1, h)\n        y_xi_m = periodic_central_difference(y, p_metric, 0, h)\n        x_xi_m = periodic_central_difference(x, p_metric, 0, h)\n\n        # Compute discrete contravariant metric-weighted velocity components\n        U_tilde_m = u * y_eta_m - v * x_eta_m\n        V_tilde_m = -u * y_xi_m + v * x_xi_m\n\n        # Compute the divergence term using the specified p_flux operator\n        div_term = (\n            periodic_central_difference(U_tilde_m, p_flux, 0, h) +\n            periodic_central_difference(V_tilde_m, p_flux, 1, h)\n        )\n\n        # Compute the final residual R\n        R = div_term / J_ana\n\n        # Return the infinity norm of the residual\n        return np.max(np.abs(R))\n\n    # Define the test cases from the problem statement.\n    test_cases = {\n        1: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4, 'p_metric': 2},\n        2: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4, 'p_metric': 4},\n        3: {'N': 63, 'alpha': 0.3, 'u': -0.8, 'v': 0.3, 'p_flux': 6, 'p_metric': 2},\n        4: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4}, # Correction Case\n        5: {'N': 32, 'alpha': 0.0, 'u': 1.2, 'v': -0.7, 'p_flux': 6, 'p_metric': 2},\n    }\n\n    results = []\n\n    # Case 1: Mismatch p_flux=4, p_metric=2\n    params = test_cases[1]\n    res1 = compute_fsp_error(**params)\n    results.append(res1)\n\n    # Case 2: Matched orders p_flux=4, p_metric=4\n    params = test_cases[2]\n    res2 = compute_fsp_error(**params)\n    results.append(res2)\n\n    # Case 3: Stronger mismatch p_flux=6, p_metric=2\n    params = test_cases[3]\n    res3 = compute_fsp_error(**params)\n    results.append(res3)\n\n    # Case 4: Corrected version of Case 1.\n    # The proposed correction is to use the same order for metrics as for the flux.\n    # So, we use Case 1's parameters but set p_metric = p_flux.\n    params_case1 = test_cases[1]\n    res4 = compute_fsp_error(\n        N=params_case1['N'],\n        alpha=params_case1['alpha'],\n        u=params_case1['u'],\n        v=params_case1['v'],\n        p_flux=params_case1['p_flux'],\n        p_metric=params_case1['p_flux']  # The correction is applied here\n    )\n    results.append(res4)\n\n    # Case 5: Edge case with a straight grid (alpha=0.0)\n    params = test_cases[5]\n    res5 = compute_fsp_error(**params)\n    results.append(res5)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}