{
    "hands_on_practices": [
        {
            "introduction": "The quality of a computational mesh is paramount, extending far beyond simple geometric partitioning. This practice explores the critical link between the local geometry of a triangulation and the stability of the resulting numerical scheme, a cornerstone concept in the numerical analysis of PDEs. By connecting the Delaunay condition to the potential for spurious oscillations in a Discontinuous Galerkin (DG) method for convection-dominated flows , you will gain a concrete understanding of why \"well-shaped\" triangles are essential for obtaining physically meaningful solutions.",
            "id": "3377002",
            "problem": "Consider the steady two-dimensional convection–diffusion equation with constant coefficients on a polygonal domain,\n$$\n- \\varepsilon \\nabla^2 u + \\boldsymbol{b} \\cdot \\nabla u = 0,\n$$\nwith Dirichlet data prescribed on the inflow portion of the boundary. Assume a Discontinuous Galerkin (DG) scheme with symmetric interior penalty for diffusion and an upwind numerical flux for convection, using a linear polynomial degree per element. Let the characteristic mesh size be $h$, the diffusion coefficient be $\\varepsilon$, the constant velocity be $\\boldsymbol{b}$, and the element-wise Péclet number be defined as\n$$\nPe = \\frac{\\lVert \\boldsymbol{b} \\rVert h}{2 \\varepsilon},\n$$\nwith the regime of interest being $Pe \\gg 1$.\n\nStart from the following fundamental bases and core definitions:\n- The Delaunay triangulation of a planar point set is the triangulation for which the open circumcircle of every triangle contains no vertex of the triangulation. Equivalently, the local Delaunay criterion for two triangles sharing an interior edge states that the sum of the two angles opposite the common edge is at most $\\pi$. This is tightly connected to Voronoi diagrams, as the Delaunay triangulation is the straight-line dual of the Voronoi diagram, and the local Delaunay condition is equivalent to the Voronoi edge lying within the corresponding primal edge’s perpendicular bisector segment.\n- For piecewise linear approximation of diffusion in two dimensions, the symmetric part of the edge-based stiffness coupling between two nodes across an interior edge is proportional to the sum of cotangents of the two angles $\\alpha$ and $\\beta$ opposite that edge, namely $\\tfrac{1}{2}(\\cot \\alpha + \\cot \\beta)$. Using the trigonometric identity,\n$$\n\\cot \\alpha + \\cot \\beta = \\frac{\\sin(\\alpha + \\beta)}{\\sin \\alpha \\, \\sin \\beta},\n$$\nthe sign of this coupling is determined by $\\sin(\\alpha + \\beta)$. In particular, it is nonnegative if and only if $\\alpha + \\beta \\le \\pi$, the local Delaunay condition.\n- In a DG scheme with interior penalty for diffusion, the symmetric interior consistency terms across an interior edge reproduce the same sign structure as the continuous piecewise linear diffusion discretization. The upwind convective flux contributes nonpositive off-diagonal entries in the discrete operator matrix. A sufficient edge-wise monotonicity condition (hence a discrete maximum principle preventing spurious oscillations) is that every interior edge has nonpositive off-diagonal entries in the global matrix. For $Pe \\gg 1$, if an interior edge is aligned nearly tangentially to $\\boldsymbol{b}$ (so that $|\\boldsymbol{b} \\cdot \\boldsymbol{n}|$ is small across that edge), then the convective contribution is too weak to offset any positive off-diagonal arising from diffusion. Therefore, any violation of the local Delaunay condition, i.e., any interior edge with $\\alpha + \\beta > \\pi$, can trigger spurious oscillations.\n\nTask. You must:\n- Derive, from the above bases, a geometry-only threshold for oscillation onset in the high-Péclet-number regime. Your derivation must show that for an interior edge shared by two triangles with opposite angles $\\alpha$ and $\\beta$ expressed in radians, spurious oscillations are predicted to occur if and only if $\\alpha + \\beta > \\pi$.\n- Implement a complete, runnable program that, given a small test suite of planar two-triangle meshes formed by splitting a quadrilateral along a diagonal, computes for each test case:\n  1. The sum $\\alpha + \\beta$ of the angles opposite the diagonal (in radians).\n  2. A boolean indicator that is true if and only if $\\alpha + \\beta > \\pi$ (predicted oscillations), and false otherwise (no oscillations).\n- You must use the angle unit in radians throughout. No physical units other than radians are required in your outputs.\n\nTest suite. Use the following five cases, each defined by four points and a chosen diagonal that splits them into two triangles. In each case, the interior edge is the diagonal joining the first and third listed points. Points are given in Cartesian coordinates:\n- Case $1$: $\\left(0,0\\right)$, $\\left(1,0\\right)$, $\\left(1,1\\right)$, $\\left(0,1\\right)$; diagonal between $\\left(0,0\\right)$ and $\\left(1,1\\right)$.\n- Case $2$: $\\left(0,0\\right)$, $\\left(0.6,0.58\\right)$, $\\left(1,1\\right)$, $\\left(0.4,0.44\\right)$; diagonal between $\\left(0,0\\right)$ and $\\left(1,1\\right)$.\n- Case $3$: $\\left(0,0\\right)$, $\\left(1,0.2\\right)$, $\\left(1,1\\right)$, $\\left(0.2,1\\right)$; diagonal between $\\left(0,0\\right)$ and $\\left(1,1\\right)$.\n- Case $4$: $\\left(0,0\\right)$, $\\left(0.51,0.49\\right)$, $\\left(1,1\\right)$, $\\left(0.49,0.51\\right)$; diagonal between $\\left(0,0\\right)$ and $\\left(1,1\\right)$.\n- Case $5$: $\\left(0,0\\right)$, $\\left(0.75,0.70\\right)$, $\\left(1,1\\right)$, $\\left(0.25,0.30\\right)$; diagonal between $\\left(0,0\\right)$ and $\\left(1,1\\right)$.\n\nFor each test, interpret the four points as defining two triangles $\\triangle \\left(p_0,p_1,p_2\\right)$ and $\\triangle \\left(p_0,p_3,p_2\\right)$ that share the diagonal $\\overline{p_0 p_2}$. The two opposite angles are at vertices $p_1$ and $p_3$ respectively; compute their sum $\\alpha + \\beta$ in radians. Then evaluate the boolean predicted oscillation indicator defined above.\n\nFinal output format. Your program should produce a single line of output containing the boolean results for the five cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\mathrm{False},\\mathrm{True},\\ldots\\right]$.",
            "solution": "The task is to derive a geometry-only threshold for the onset of spurious oscillations in a Discontinuous Galerkin (DG) numerical scheme for the steady convection-diffusion equation, and then to implement a program that applies this threshold to a set of test cases. The analysis is performed in the high-Péclet-number regime ($Pe \\gg 1$), where convection dominates diffusion.\n\nThe governing equation is $- \\varepsilon \\nabla^2 u + \\boldsymbol{b} \\cdot \\nabla u = 0$. A sufficient condition for a numerical solution to be free of spurious oscillations is that it satisfies a discrete maximum principle. This is often ensured if the global system matrix, let's call it $A$, is an M-matrix, which requires all its off-diagonal entries to be non-positive.\n\nThe matrix $A$ results from the DG discretization. For any interior edge of the mesh shared between two elements (triangles), the off-diagonal entries of $A$ that couple degrees of freedom across this edge are the sum of a contribution from the diffusion term, $A_D$, and a contribution from the convection term, $A_C$. We must analyze the sign of the total off-diagonal entry $A_{ij} = (A_D)_{ij} + (A_C)_{ij}$.\n\n1.  **Contribution from Diffusion ($A_D$)**: The problem uses a symmetric interior penalty Galerkin (SIPG) method for the diffusion term $- \\varepsilon \\nabla^2 u$. The problem statement asserts that the sign structure of the resulting matrix entries is identical to that of a standard continuous piecewise linear finite element method. For the operator $-\\nabla^2 u$, the off-diagonal stiffness matrix entry corresponding to an edge shared by two triangles is proportional to $-(\\cot \\alpha + \\cot \\beta)$, where $\\alpha$ and $\\beta$ are the angles opposite this common edge. The diffusion coefficient $\\varepsilon$ is a positive scaling factor. Thus, the sign of the contribution from the diffusion term is that of $-(\\cot \\alpha + \\cot \\beta)$.\n\n    Using the trigonometric identity $\\cot \\alpha + \\cot \\beta = \\frac{\\sin(\\alpha + \\beta)}{\\sin \\alpha \\sin \\beta}$, the sign of the diffusive contribution becomes the sign of $-\\sin(\\alpha + \\beta)$, since $\\alpha, \\beta \\in (0, \\pi)$ implies $\\sin\\alpha > 0$ and $\\sin\\beta > 0$.\n    -   If the local Delaunay condition $\\alpha + \\beta \\le \\pi$ holds, then $\\sin(\\alpha + \\beta) \\ge 0$, which makes the diffusive contribution $(A_D)_{ij}$ non-positive. This is a stabilizing term.\n    -   If the local Delaunay condition is violated, $\\alpha + \\beta > \\pi$, then $\\sin(\\alpha + \\beta) < 0$, which makes the diffusive contribution $(A_D)_{ij}$ positive. A positive off-diagonal entry violates the M-matrix condition and can lead to instability.\n\n2.  **Contribution from Convection ($A_C$)**: The convection term $\\boldsymbol{b} \\cdot \\nabla u$ is discretized using an upwind numerical flux. As stated in the problem, this choice is stabilizing and contributes non-positive entries to the off-diagonals of the system matrix, i.e., $(A_C)_{ij} \\le 0$.\n\n3.  **Total Off-Diagonal Entry and High-Péclet Number Analysis**: The total off-diagonal entry is $A_{ij} = (A_D)_{ij} + (A_C)_{ij}$.\n    -   If $\\alpha + \\beta \\le \\pi$ (Delaunay edge), then $(A_D)_{ij} \\le 0$ and $(A_C)_{ij} \\le 0$, so $A_{ij} \\le 0$. The M-matrix condition is satisfied for this edge, and no oscillations are expected to originate from it.\n    -   If $\\alpha + \\beta > \\pi$ (non-Delaunay edge), then $(A_D)_{ij} > 0$. The overall sign of $A_{ij}$ now depends on a competition between the positive diffusive term and the negative convective term. The M-matrix condition holds only if $|(A_C)_{ij}| \\ge (A_D)_{ij}$.\n\n    The key insight for the high-Péclet number regime, $Pe \\gg 1$, is given in the problem statement. The magnitude of the stabilizing upwind flux across an edge $e$ with unit normal $\\boldsymbol{n}_e$ is dependent on the quantity $|\\boldsymbol{b} \\cdot \\boldsymbol{n}_e|$. If the flow direction $\\boldsymbol{b}$ is nearly tangential to the edge $e$, then $\\boldsymbol{b}$ is nearly orthogonal to $\\boldsymbol{n}_e$, and thus $|\\boldsymbol{b} \\cdot \\boldsymbol{n}_e|$ becomes very small. In this case, the stabilizing contribution $(A_C)_{ij}$ can be made arbitrarily weak, regardless of the magnitude $\\lVert\\boldsymbol{b}\\rVert$ or the smallness of $\\varepsilon$.\n\n    Since the orientation of the constant velocity $\\boldsymbol{b}$ is arbitrary with respect to the mesh, a robust scheme should be stable for any $\\boldsymbol{b}$. If the mesh contains an edge with $\\alpha + \\beta > \\pi$, one can always choose a flow direction $\\boldsymbol{b}$ nearly parallel to that edge. For such a flow, the stabilizing upwind term vanishes, and the sign of the off-diagonal entry is dominated by the positive diffusive term: $A_{ij} \\approx (A_D)_{ij} > 0$. This violation of the M-matrix condition is a well-known trigger for spurious oscillations.\n\n    Therefore, the potential for oscillations is fundamentally tied to the mesh geometry itself. The purely geometric condition $\\alpha + \\beta > \\pi$ is a sufficient criterion for predicting the onset of oscillations in the high-Péclet number limit, as it indicates the existence of a \"worst-case\" flow direction that will induce instability.\n\nThe computational task is to calculate the sum of the angles $\\alpha + \\beta$ for each given mesh configuration and check if it exceeds $\\pi$. The angles are computed at the vertices opposite the shared diagonal. For a triangle with vertices $P_1, P_2, P_3$, the angle $\\theta$ at vertex $P_2$ can be calculated using the dot product formula for vectors $\\vec{v}_{21} = P_1 - P_2$ and $\\vec{v}_{23} = P_3 - P_2$:\n$$\n\\theta = \\arccos\\left( \\frac{\\vec{v}_{21} \\cdot \\vec{v}_{23}}{\\lVert\\vec{v}_{21}\\rVert \\lVert\\vec{v}_{23}\\rVert} \\right)\n$$\nThe program will implement this calculation for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing the geometry of five two-triangle meshes.\n    For each mesh, it computes the sum of the angles opposite the common\n    diagonal and determines if this sum exceeds pi, which is the criterion\n    for predicting numerical oscillations in a high-Peclet number regime.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case has four points p0, p1, p2, p3. The triangles are\n    # (p0, p1, p2) and (p0, p3, p2), sharing the diagonal p0-p2.\n    # The angles of interest, alpha and beta, are at p1 and p3 respectively.\n    test_cases = [\n        # Case 1: Square, Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([1,0]), 'p2':_p([1,1]), 'p3':_p([0,1])},\n        # Case 2: Convex quad, non-Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([0.6,0.58]), 'p2':_p([1,1]), 'p3':_p([0.4,0.44])},\n        # Case 3: Concave quad, non-Delaunay diagonal.\n        {'p0':_p([0,0]), 'p1':_p([1,0.2]), 'p2':_p([1,1]), 'p3':_p([0.2,1])},\n        # Case 4: Sliver quad, highly non-Delaunay.\n        {'p0':_p([0,0]), 'p1':_p([0.51,0.49]), 'p2':_p([1,1]), 'p3':_p([0.49,0.51])},\n        # Case 5: Convex quad, non-Delaunay.\n        {'p0':_p([0,0]), 'p1':_p([0.75,0.70]), 'p2':_p([1,1]), 'p3':_p([0.25,0.30])},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p0, p1, p2, p3 = case['p0'], case['p1'], case['p2'], case['p3']\n        \n        # Calculate angle alpha at p1 for triangle (p0, p1, p2).\n        alpha = _calculate_angle(p0, p1, p2)\n        \n        # Calculate angle beta at p3 for triangle (p0, p3, p2).\n        beta = _calculate_angle(p0, p3, p2)\n        \n        angle_sum = alpha + beta\n        \n        # The geometry-only threshold for predicted oscillations is alpha + beta > pi.\n        # This corresponds to the diagonal violating the local Delaunay condition.\n        oscillation_predicted = angle_sum > np.pi\n        \n        results.append(oscillation_predicted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _p(coords):\n    \"\"\"Helper function to create a numpy array from coordinates.\"\"\"\n    return np.array(coords, dtype=np.float64)\n\ndef _calculate_angle(pA, pB, pC):\n    \"\"\"\n    Calculates the angle at vertex pB in triangle pA-pB-pC in radians.\n    \n    Args:\n        pA, pB, pC: Numpy arrays representing the coordinates of the vertices.\n        \n    Returns:\n        The angle at pB in radians.\n    \"\"\"\n    # Vectors from pB to pA and pC\n    vec_BA = pA - pB\n    vec_BC = pC - pB\n    \n    # Dot product of the two vectors\n    dot_product = np.dot(vec_BA, vec_BC)\n    \n    # Product of the magnitudes (norms) of the vectors\n    norm_product = np.linalg.norm(vec_BA) * np.linalg.norm(vec_BC)\n    \n    # To prevent domain errors with arccos due to floating point inaccuracies,\n    # clip the value to be within [-1.0, 1.0].\n    cosine_of_angle = np.clip(dot_product / norm_product, -1.0, 1.0)\n    \n    # Calculate the angle using arccos gives the result in radians\n    angle_rad = np.arccos(cosine_of_angle)\n    \n    return angle_rad\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond ensuring stability, a high-quality mesh is crucial for achieving accuracy. This hands-on problem moves from the qualitative nature of stability to a quantitative analysis of accuracy in the finite element method (FEM). You will investigate how integrals for mass and stiffness matrices are computed and how element distortion introduces quantifiable errors when using numerical quadrature . This exercise provides a direct, practical insight into the interplay between element geometry and the precision of an FEM simulation.",
            "id": "3377010",
            "problem": "You are assembling the finite element matrices for the scalar diffusion partial differential equation (PDE) $-\\nabla \\cdot (\\kappa \\nabla u) = f$ on a polygonal domain $\\Omega \\subset \\mathbb{R}^{2}$ using Lagrange elements of degree $k \\in \\{1,2\\}$. The computational mesh is a Delaunay triangulation, produced by a refinement algorithm that enforces a minimum interior angle $\\alpha_{0} \\in (0,\\pi/3]$ on all triangles. Assume constant coefficient $\\kappa>0$ and that all element maps are affine. Let the local mass matrix be defined by $M_{ij}^{(T)} = \\int_{T} \\phi_{i} \\phi_{j} \\,\\mathrm{d}x$ and the local stiffness matrix by $K_{ij}^{(T)} = \\int_{T} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\,\\mathrm{d}x$ for shape functions $\\{\\phi_{i}\\}$ spanning the Lagrange space.\n\nPart (a): A triangular quadrature rule is said to be exact up to degree $q$ if it integrates every polynomial of total degree at most $q$ exactly on any triangle. Using only fundamental properties of Lagrange basis functions and affine mappings, determine the minimal polynomial exactness degree $q$ required so that $M_{ij}^{(T)}$ and $K_{ij}^{(T)}$ are computed exactly on any triangle $T$ when using polynomial degree $k=1$ and $k=2$.\n\nPart (b): To quantify the effect of element distortion on quadrature error when under-integration is used, consider the one-parameter family of affine triangles $T_{s}$ obtained by mapping the reference triangle $\\widehat{T} = \\{(\\xi,\\eta) \\in \\mathbb{R}^{2} : \\xi \\ge 0,\\, \\eta \\ge 0,\\, \\xi + \\eta \\le 1\\}$ via the linear map $A_{s} = \\mathrm{diag}(s,1)$ with $s \\ge 1$, so that $(x,y) = A_{s}(\\xi,\\eta)^{\\top}$. On $\\widehat{T}$, consider the quadratic Lagrange edge basis function $\\widehat{\\phi}_{23}(\\xi,\\eta) = 4 \\lambda_{2} \\lambda_{3} = 4 \\xi \\eta$, where $\\lambda_{2}(\\xi,\\eta) = \\xi$ and $\\lambda_{3}(\\xi,\\eta) = \\eta$ are barycentric coordinates. Let $\\phi_{23}$ be its pullforward to $T_{s}$.\n\nDefine the local stiffness entry $a_{23,23}(s) := \\int_{T_{s}} \\nabla \\phi_{23} \\cdot \\nabla \\phi_{23} \\,\\mathrm{d}x$. Approximate this integral using the one-point centroid quadrature rule on $T_{s}$, which is exact for polynomials up to degree $1$. Derive, in closed form, the quadrature error\n$$\nE(s) \\;:=\\; a_{23,23}(s) \\;-\\; \\Big(\\text{area}(T_{s})\\Big)\\, \\Big(\\nabla \\phi_{23} \\cdot \\nabla \\phi_{23}\\Big)\\Big|_{\\text{centroid of }T_{s}},\n$$\nas an analytic expression in $s$.\n\nReport your final answer as a row matrix $\\big[q_{\\mathrm{mass}}^{(1)},\\, q_{\\mathrm{stiff}}^{(1)},\\, q_{\\mathrm{mass}}^{(2)},\\, q_{\\mathrm{stiff}}^{(2)},\\, E(s)\\big]$, where $q_{\\mathrm{mass}}^{(k)}$ and $q_{\\mathrm{stiff}}^{(k)}$ denote the minimal exactness degrees for the mass and stiffness matrices for polynomial degree $k$. No units are required. Do not simplify $E(s)$ numerically. The final answer must be a single row matrix as specified.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard problem in the theory of the finite element method.\n\n### Part (a): Minimal Quadrature Exactness Degree\n\nThe goal is to find the minimal polynomial exactness degree $q$ for a quadrature rule to compute the local mass and stiffness matrices exactly for Lagrange elements of degree $k$. The element maps are affine, which implies that polynomial basis functions on a reference element are mapped to polynomial basis functions of the same degree on any physical element $T$.\n\nLet $\\{\\phi_i\\}$ be the set of Lagrange basis functions on an element $T$. For degree $k$ elements, each $\\phi_i$ is a polynomial of total degree at most $k$.\n\n**Local Mass Matrix ($M^{(T)}$):**\nThe entries of the local mass matrix are given by $M_{ij}^{(T)} = \\int_{T} \\phi_{i} \\phi_{j} \\,\\mathrm{d}x$.\nThe integrand is the product of two basis functions, $\\phi_i \\phi_j$. Since $\\phi_i$ and $\\phi_j$ are polynomials of degree at most $k$, their product is a polynomial of degree at most $k+k=2k$.\nTherefore, to compute the integral exactly, the quadrature rule must be exact for polynomials of total degree up to $2k$. The minimal required exactness degree is $q_{\\mathrm{mass}}^{(k)} = 2k$.\n\nFor linear elements ($k=1$):\n$q_{\\mathrm{mass}}^{(1)} = 2(1) = 2$.\n\nFor quadratic elements ($k=2$):\n$q_{\\mathrm{mass}}^{(2)} = 2(2) = 4$.\n\n**Local Stiffness Matrix ($K^{(T)}$):**\nThe entries of the local stiffness matrix are given by $K_{ij}^{(T)} = \\int_{T} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\,\\mathrm{d}x$.\nThe integrand is $\\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} = \\frac{\\partial \\phi_i}{\\partial x}\\frac{\\partial \\phi_j}{\\partial x} + \\frac{\\partial \\phi_i}{\\partial y}\\frac{\\partial \\phi_j}{\\partial y}$.\nIf $\\phi_i$ is a polynomial of degree at most $k$, its first-order partial derivatives, $\\frac{\\partial \\phi_i}{\\partial x}$ and $\\frac{\\partial \\phi_i}{\\partial y}$, are polynomials of degree at most $k-1$.\nThe product of any two such partial derivatives, e.g., $\\frac{\\partial \\phi_i}{\\partial x}\\frac{\\partial \\phi_j}{\\partial x}$, is a polynomial of degree at most $(k-1) + (k-1) = 2k-2$.\nThe entire integrand, being a sum of such products, is a polynomial of degree at most $2k-2$.\nTo compute this integral exactly, the quadrature rule must be exact for polynomials of degree up to $2k-2$. The minimal required exactness degree is $q_{\\mathrm{stiff}}^{(k)} = 2k-2$.\n\nFor linear elements ($k=1$):\n$q_{\\mathrm{stiff}}^{(1)} = 2(1) - 2 = 0$. The integrand is a constant, so a rule exact for degree $0$ polynomials (i.e., constants) is sufficient.\n\nFor quadratic elements ($k=2$):\n$q_{\\mathrm{stiff}}^{(2)} = 2(2) - 2 = 2$.\n\n### Part (b): Quadrature Error Calculation\n\nWe are asked to compute the error $E(s)$ for a specific stiffness matrix entry on a family of triangles $T_s$.\n\n**1. Geometric and Functional Setup**\nThe mapping from the reference element $\\widehat{T}$ to the physical element $T_s$ is given by the affine transformation $F(\\xi, \\eta) = (x, y)^{\\top}$ where $x = s\\xi$ and $y = \\eta$. The Jacobian matrix of this map is\n$$J_F = \\begin{pmatrix} s & 0 \\\\ 0 & 1 \\end{pmatrix},$$\nand its determinant is $|\\det(J_F)| = s$.\nThe area of the physical triangle $T_s$ is $\\text{area}(T_s) = \\int_{\\widehat{T}} |\\det(J_F)| \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = s \\cdot \\text{area}(\\widehat{T}) = s \\cdot \\frac{1}{2} = \\frac{s}{2}$.\nThe reference basis function is $\\widehat{\\phi}_{23}(\\xi, \\eta) = 4\\xi\\eta$. The physical basis function is $\\phi_{23}(x,y) = \\widehat{\\phi}_{23}(F^{-1}(x,y))$. The inverse map is $F^{-1}(x,y) = (\\xi, \\eta)^{\\top} = (x/s, y)^{\\top}$, so $\\phi_{23}(x,y) = 4(x/s)y = \\frac{4}{s}xy$.\n\n**2. Exact Integral Calculation**\nThe stiffness entry is $a_{23,23}(s) = \\int_{T_s} \\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} \\, \\mathrm{d}x$. We perform this integral by changing variables to the reference element $\\widehat{T}$.\nThe physical gradient $\\nabla_x \\phi_{23}$ is related to the reference gradient $\\nabla_\\xi \\widehat{\\phi}_{23}$ by $\\nabla_x \\phi_{23} = (J_F^{-T}) \\nabla_\\xi \\widehat{\\phi}_{23}$.\nFirst, we find the reference gradient:\n$$\\nabla_\\xi \\widehat{\\phi}_{23} = \\left(\\frac{\\partial}{\\partial\\xi}(4\\xi\\eta), \\frac{\\partial}{\\partial\\eta}(4\\xi\\eta)\\right)^{\\top} = (4\\eta, 4\\xi)^{\\top}.$$\nThe inverse-transpose of the Jacobian is $J_F^{-T} = (J_F^{-1})^T = \\begin{pmatrix} 1/s & 0 \\\\ 0 & 1 \\end{pmatrix}^T = \\begin{pmatrix} 1/s & 0 \\\\ 0 & 1 \\end{pmatrix}$.\nSo, the physical gradient expressed in reference coordinates is:\n$$\\nabla_x \\phi_{23} = \\begin{pmatrix} 1/s & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} 4\\eta \\\\ 4\\xi \\end{pmatrix} = \\begin{pmatrix} 4\\eta/s \\\\ 4\\xi \\end{pmatrix}.$$\nThe integrand is the dot product:\n$$\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} = \\left(\\frac{4\\eta}{s}\\right)^2 + (4\\xi)^2 = \\frac{16\\eta^2}{s^2} + 16\\xi^2.$$\nThe integral is:\n$$a_{23,23}(s) = \\int_{\\widehat{T}} \\left(\\frac{16\\eta^2}{s^2} + 16\\xi^2\\right) |\\det(J_F)| \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = s \\int_{\\widehat{T}} \\left(\\frac{16\\eta^2}{s^2} + 16\\xi^2\\right) \\mathrm{d}\\xi\\mathrm{d}\\eta.$$\n$$a_{23,23}(s) = \\frac{16}{s} \\int_{\\widehat{T}} \\eta^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta + 16s \\int_{\\widehat{T}} \\xi^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta.$$\nUsing the standard integral formula over the unit reference triangle, $\\int_{\\widehat{T}} \\xi^a \\eta^b \\,\\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{a!b!}{(a+b+2)!}$:\n$$\\int_{\\widehat{T}} \\eta^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = \\frac{0!2!}{(0+2+2)!} = \\frac{2}{24} = \\frac{1}{12}.$$\n$$\\int_{\\widehat{T}} \\xi^2 \\, \\mathrm{d}\\xi\\mathrm{d}\\eta = \\frac{2!0!}{(2+0+2)!} = \\frac{2}{24} = \\frac{1}{12}.$$\nSubstituting these values:\n$$a_{23,23}(s) = \\frac{16}{s} \\left(\\frac{1}{12}\\right) + 16s \\left(\\frac{1}{12}\\right) = \\frac{4}{3s} + \\frac{4s}{3}.$$\n\n**3. Approximate Integral Calculation**\nThe one-point centroid quadrature rule approximates the integral as $Q(g) = \\text{area}(T_s) \\cdot g(x_c, y_c)$, where $(x_c, y_c)$ is the centroid of $T_s$.\nThe vertices of $T_s$ are $(0,0)$, $(s,0)$, and $(0,1)$. The centroid is the average of the vertex coordinates:\n$$(x_c, y_c) = \\left(\\frac{0+s+0}{3}, \\frac{0+0+1}{3}\\right) = \\left(\\frac{s}{3}, \\frac{1}{3}\\right).$$\nThe integrand in physical coordinates is $\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23} = (\\frac{\\partial}{\\partial x}(\\frac{4xy}{s}))^2 + (\\frac{\\partial}{\\partial y}(\\frac{4xy}{s}))^2 = (\\frac{4y}{s})^2 + (\\frac{4x}{s})^2 = \\frac{16}{s^2}(y^2+x^2)$.\nEvaluating the integrand at the centroid:\n$$\\left.\\left(\\nabla\\phi_{23} \\cdot \\nabla\\phi_{23}\\right)\\right|_{(s/3, 1/3)} = \\frac{16}{s^2}\\left(\\left(\\frac{1}{3}\\right)^2 + \\left(\\frac{s}{3}\\right)^2\\right) = \\frac{16}{s^2}\\left(\\frac{1}{9} + \\frac{s^2}{9}\\right) = \\frac{16(1+s^2)}{9s^2}.$$\nThe approximate integral is:\n$$Q_s = \\text{area}(T_s) \\cdot \\frac{16(1+s^2)}{9s^2} = \\frac{s}{2} \\cdot \\frac{16(1+s^2)}{9s^2} = \\frac{8(1+s^2)}{9s} = \\frac{8}{9s} + \\frac{8s}{9}.$$\n\n**4. Quadrature Error**\nThe error is the exact value minus the approximate value:\n$$E(s) = a_{23,23}(s) - Q_s = \\left(\\frac{4}{3s} + \\frac{4s}{3}\\right) - \\left(\\frac{8}{9s} + \\frac{8s}{9}\\right).$$\n$$E(s) = \\left(\\frac{4s}{3} - \\frac{8s}{9}\\right) + \\left(\\frac{4}{3s} - \\frac{8}{9s}\\right) = \\left(\\frac{12s - 8s}{9}\\right) + \\left(\\frac{12 - 8}{9s}\\right) = \\frac{4s}{9} + \\frac{4}{9s}.$$\n\n**Summary of Results**\nThe required values are:\n- $q_{\\mathrm{mass}}^{(1)} = 2$\n- $q_{\\mathrm{stiff}}^{(1)} = 0$\n- $q_{\\mathrm{mass}}^{(2)} = 4$\n- $q_{\\mathrm{stiff}}^{(2)} = 2$\n- $E(s) = \\frac{4s}{9} + \\frac{4}{9s}$\n\nThese are combined into a single row matrix for the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 & 0 & 4 & 2 & \\frac{4s}{9} + \\frac{4}{9s}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Our focus now shifts from the Delaunay triangulation to its dual, the Voronoi diagram, which forms the basis of the Finite Volume Method (FVM). While the geometric properties of Voronoi cells provide an elegant framework for discretization in the domain interior, handling boundaries requires careful and consistent treatment. This practice tackles the essential task of implementing boundary conditions using a ghost-cell approach, demonstrating how to design and analyze the strategy to preserve the overall accuracy of the scheme . This is a vital skill for developing robust and accurate FVM codes for real-world applications.",
            "id": "3376977",
            "problem": "Consider the steady isotropic diffusion Partial Differential Equation (PDE) $-\\nabla \\cdot (k \\nabla u) = f$ posed on a smooth bounded domain $\\Omega \\subset \\mathbb{R}^{2}$ with boundary $\\partial \\Omega$, where $k > 0$ is a constant diffusion coefficient and $u$ is sufficiently smooth. Discretize $\\Omega$ by the Delaunay Triangulation (DT) of a set of points $\\{\\boldsymbol{x}_{i}\\}$ and construct the associated Voronoi diagram control volumes $\\{V_{i}\\}$ for a Finite Volume Method (FVM). Assume standard two-point fluxes across Voronoi faces: for a face shared by cells $i$ and $j$, the diffusive flux is approximated as $F_{ij} = -|\\Gamma_{ij}|\\, k \\,\\frac{u_{j} - u_{i}}{d_{ij}}$, where $|\\Gamma_{ij}|$ is the face length and $d_{ij}$ is the distance between $\\boldsymbol{x}_{i}$ and $\\boldsymbol{x}_{j}$ along the line orthogonal to the face.\n\nFocus on a single control volume $V_{i}$ adjacent to a locally straight portion of $\\partial \\Omega$ with unit outward normal $\\boldsymbol{n}$ and boundary-face centroid $\\boldsymbol{x}_{\\Gamma} \\in \\partial \\Omega$. Let the generator point $\\boldsymbol{x}_{i}$ lie at signed distance $d_{i} = h > 0$ from the tangent line at $\\boldsymbol{x}_{\\Gamma}$ along the inward normal direction $-\\boldsymbol{n}$, and let the boundary Voronoi face associated to $V_{i}$ have length $|\\Gamma|$.\n\nTo impose boundary conditions in the two-point flux form on this boundary face, introduce a single ghost cell with ghost generator $\\boldsymbol{x}_{g}$ placed at signed distance $d_{g}$ from $\\boldsymbol{x}_{\\Gamma}$ along the outward normal direction $+\\boldsymbol{n}$, and use the boundary-face flux\n$$\nF_{i\\partial} \\;=\\; -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{d_{i} + d_{g}},\n$$\nwhere $u_{g}$ is the unknown ghost value. Assume $d_{g} = h$ (symmetric reflection across the boundary) for geometric consistency with Voronoi orthogonality. Consider two boundary-condition types at $\\boldsymbol{x}_{\\Gamma}$:\n- Dirichlet: $u(\\boldsymbol{x}_{\\Gamma}) = u_{b}$ with known $u_{b}$;\n- Neumann: $\\partial_{n} u(\\boldsymbol{x}_{\\Gamma}) = g_{n}$ with known normal derivative $g_{n}$.\n\nStarting from the control-volume conservation law and the divergence theorem, and using Taylor expansions along the normal coordinate $s$ with $s=0$ at $\\boldsymbol{x}_{\\Gamma}$, $s>0$ pointing in the inward normal direction $-\\boldsymbol{n}$, perform the following:\n1. Construct a ghost-cell strategy $u_{g}$ for each boundary-condition type that guarantees exactness for all linear functions $u(s)$ and conservativeness of the boundary-face flux $F_{i\\partial}$ in the discrete balance for $V_{i}$.\n2. Quantify the leading-order consistency error of the boundary-face flux by deriving the coefficient $\\mathcal{C}$ in the expansion\n$$\nF_{i\\partial}^{\\text{disc}} \\;-\\; F_{i\\partial}^{\\text{exact}} \\;=\\; \\mathcal{C}\\, h \\;+\\; \\mathcal{O}\\!\\left(h^{2}\\right),\n$$\nfor each boundary-condition type, as $h \\to 0$. Express $\\mathcal{C}$ in terms of $|\\Gamma|$, $k$, and normal derivatives of $u$ evaluated at $\\boldsymbol{x}_{\\Gamma}$.\n\nReport the four quantities $\\big(u_{g}^{D},\\, \\mathcal{C}^{D},\\, u_{g}^{N},\\, \\mathcal{C}^{N}\\big)$, corresponding to Dirichlet and Neumann boundary conditions respectively, as a single closed-form analytic expression. No numerical substitution is required.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the field of numerical analysis for partial differential equations, well-posed, and uses objective, formal language. There are no contradictions, missing information, or unsound premises. We may proceed with the solution.\n\nThe problem asks for the derivation of ghost-cell values and the leading-order consistency error for a finite-volume flux approximation at a boundary for both Dirichlet and Neumann conditions.\n\nLet's establish a one-dimensional coordinate system normal to the boundary. The problem defines a coordinate $s$ representing the signed distance from the boundary tangent, with $s=0$ at the boundary point $\\boldsymbol{x}_{\\Gamma}$ and $s>0$ pointing into the domain $\\Omega$ (along the inward normal $-\\boldsymbol{n}$).\nThe internal node $\\boldsymbol{x}_i$ is at $s = d_i = h$.\nThe ghost node $\\boldsymbol{x}_g$ is located at a distance $d_g = h$ along the outward normal $+\\boldsymbol{n}$, which corresponds to $s = -h$.\nThe value of the solution $u$ at the internal node is $u_i = u(s=h)$. The value at the boundary is $u(s=0)$. The ghost value is $u_g$.\n\nThe exact flux out of the domain through the boundary face $\\Gamma$ is given by the integral of the normal component of the flux vector $\\boldsymbol{q} = -k\\nabla u$.\n$$\nF_{i\\partial}^{\\text{exact}} = \\int_{\\Gamma} \\boldsymbol{q} \\cdot \\boldsymbol{n} \\, \\mathrm{d}\\Gamma = \\int_{\\Gamma} (-k \\nabla u) \\cdot \\boldsymbol{n} \\, \\mathrm{d}\\Gamma = \\int_{\\Gamma} -k \\, \\partial_n u \\, \\mathrm{d}\\Gamma\n$$\nwhere $\\partial_n u = \\nabla u \\cdot \\boldsymbol{n}$ is the derivative in the direction of the outward normal $\\boldsymbol{n}$.\nSince the coordinate $s$ points along $-\\boldsymbol{n}$, we have the relation $\\frac{d}{ds} = -\\frac{d}{dn}$, or $\\partial_n u = -\\frac{du}{ds}$.\nSubstituting this into the flux definition:\n$$\nF_{i\\partial}^{\\text{exact}} = \\int_{\\Gamma} -k \\left(-\\frac{du}{ds}\\right) \\, \\mathrm{d}\\Gamma = \\int_{\\Gamma} k \\frac{du}{ds} \\, \\mathrm{d}\\Gamma\n$$\nFor a small face of length $|\\Gamma|$, we can approximate this as:\n$$\nF_{i\\partial}^{\\text{exact}} \\approx |\\Gamma|\\, k \\,\\frac{du}{ds}\\bigg|_{s=0}\n$$\nThe discrete flux out of the control volume $V_i$ through the boundary face is given by:\n$$\nF_{i\\partial}^{\\text{disc}} = -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{d_{i} + d_{g}} = -|\\Gamma|\\, k \\,\\frac{u_{g} - u_{i}}{2h} = |\\Gamma|\\, k \\,\\frac{u_{i} - u_{g}}{2h}\n$$\nWe perform a Taylor series expansion of $u(s)$ around $s=0$:\n$$\nu(s) = u(0) + s \\frac{du}{ds}\\bigg|_{0} + \\frac{s^2}{2!} \\frac{d^2u}{ds^2}\\bigg|_{0} + \\mathcal{O}(s^3)\n$$\nUsing the shorthand $u_0 = u(0)$, $u'_0 = \\frac{du}{ds}\\big|_{0}$, $u''_0 = \\frac{d^2u}{ds^2}\\big|_{0}$, we have:\n$$\nu_i = u(h) = u_0 + h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)\n$$\n\n### 1. Dirichlet Boundary Condition: $u(\\boldsymbol{x}_{\\Gamma}) = u_b$\nFor this condition, $u(0) = u_b$, so $u_0 = u_b$.\n\nFirst, we determine the ghost-cell value $u_g^D$. The strategy must be exact for any linear function $u(s) = as+b$. For such a function, $u_b = b$, $u_i = ah+b$. We need to find $u_g$ in terms of $u_i$ and $u_b$. A standard second-order accurate approach is to assume the boundary value is the average of the internal and ghost values, which are symmetric with respect to the boundary:\n$$\nu_b \\approx \\frac{u_i + u_g}{2}\n$$\nSolving for $u_g$ gives the ghost-cell strategy:\n$$\nu_g^D = 2u_b - u_i\n$$\nThis is exact for linear functions, as $2b - (ah+b) = b-ah = u(-h)$.\n\nNext, we analyze the consistency error for the flux. We substitute $u_g^D$ into the discrete flux formula:\n$$\nF_{i\\partial}^{\\text{disc}, D} = |\\Gamma|\\, k \\,\\frac{u_{i} - u_{g}^D}{2h} = |\\Gamma|\\, k \\,\\frac{u_{i} - (2u_b - u_i)}{2h} = |\\Gamma|\\, k \\,\\frac{2u_i - 2u_b}{2h} = |\\Gamma|\\, k \\,\\frac{u_i - u_b}{h}\n$$\nNow, using the Taylor expansion for $u_i$ around $s=0$, with $u_b = u_0$:\n$$\nu_i - u_b = (u_0 + h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)) - u_0 = h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)\n$$\nSubstituting this into the discrete flux expression:\n$$\nF_{i\\partial}^{\\text{disc}, D} = |\\Gamma|\\, k \\,\\frac{h u'_0 + \\frac{h^2}{2} u''_0 + \\mathcal{O}(h^3)}{h} = |\\Gamma|\\, k \\left( u'_0 + \\frac{h}{2} u''_0 + \\mathcal{O}(h^2) \\right)\n$$\nThe exact flux is $F_{i\\partial}^{\\text{exact}} = |\\Gamma|\\, k \\,u'_0$. The consistency error is the difference:\n$$\nF_{i\\partial}^{\\text{disc}, D} - F_{i\\partial}^{\\text{exact}} = |\\Gamma|\\, k \\left( u'_0 + \\frac{h}{2} u''_0 \\right) - |\\Gamma|\\, k \\, u'_0 + \\mathcal{O}(h^2) = \\frac{1}{2} |\\Gamma|\\, k \\, u''_0 \\, h + \\mathcal{O}(h^2)\n$$\nComparing this to the form $\\mathcal{C}h + \\mathcal{O}(h^2)$, we find the coefficient for the Dirichlet case:\n$$\n\\mathcal{C}^D = \\frac{1}{2} |\\Gamma|\\, k \\, u''_0 = \\frac{1}{2} |\\Gamma|\\, k \\, \\frac{d^2u}{ds^2}\\bigg|_{\\boldsymbol{x}_\\Gamma}\n$$\n\n### 2. Neumann Boundary Condition: $\\partial_n u(\\boldsymbol{x}_{\\Gamma}) = g_n$\nThe condition is given in terms of the outward normal derivative. We relate this to our coordinate $s$: $\\partial_n u = - \\frac{du}{ds}$, so the condition at $s=0$ is $-\\frac{du}{ds}\\big|_{0} = g_n$, or $u'_0 = -g_n$.\n\nFirst, we determine the ghost-cell value $u_g^N$. We use a centered difference approximation for the derivative at the boundary, which is second-order accurate:\n$$\nu'_0 \\approx \\frac{u(h) - u(-h)}{2h} \\approx \\frac{u_i - u_g}{2h}\n$$\nSetting this approximation equal to the known derivative value:\n$$\n\\frac{u_i - u_g}{2h} = u'_0 = -g_n\n$$\nSolving for $u_g$ provides the ghost-cell strategy:\n$$\nu_i - u_g = -2h g_n \\implies u_g^N = u_i + 2h g_n\n$$\nThis strategy is exact for linear functions $u(s)=as+b$, where $u'_0=a=-g_n$, as $u_g^N = (ah+b) + 2h(-a) = b-ah = u(-h)$.\n\nNext, we analyze the consistency error. We substitute $u_g^N$ into the discrete flux formula:\n$$\nF_{i\\partial}^{\\text{disc}, N} = |\\Gamma|\\, k \\,\\frac{u_i - u_g^N}{2h} = |\\Gamma|\\, k \\,\\frac{u_i - (u_i + 2h g_n)}{2h} = |\\Gamma|\\, k \\,\\frac{-2h g_n}{2h} = -|\\Gamma|\\, k \\, g_n\n$$\nThe exact flux is given by:\n$$\nF_{i\\partial}^{\\text{exact}} \\approx |\\Gamma|\\, k \\, u'_0 = |\\Gamma|\\, k \\, (-g_n) = -|\\Gamma|\\, k \\, g_n\n$$\nThe discrete flux is constructed to be identical to the exact flux based on the given boundary data. Therefore, the consistency error is zero:\n$$\nF_{i\\partial}^{\\text{disc}, N} - F_{i\\partial}^{\\text{exact}} = (-|\\Gamma|\\, k \\, g_n) - (-|\\Gamma|\\, k \\, g_n) = 0\n$$\nThis implies that the leading-order error coefficient $\\mathcal{C}^N$ is zero.\n\n### Summary of Results\nThe four quantities are:\n- Dirichlet ghost value: $u_{g}^{D} = 2u_{b} - u_{i}$\n- Dirichlet error coefficient: $\\mathcal{C}^{D} = \\frac{1}{2}|\\Gamma|k\\frac{d^2u}{ds^2}\\bigg|_{\\boldsymbol{x}_\\Gamma}$\n- Neumann ghost value: $u_{g}^{N} = u_{i} + 2hg_{n}$\n- Neumann error coefficient: $\\mathcal{C}^{N} = 0$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2u_{b} - u_{i} & \\frac{1}{2}|\\Gamma|k\\frac{d^{2}u}{ds^{2}}\\bigg|_{\\boldsymbol{x}_\\Gamma} & u_{i} + 2hg_{n} & 0 \\end{pmatrix}}\n$$"
        }
    ]
}