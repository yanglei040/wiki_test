{
    "hands_on_practices": [
        {
            "introduction": "Projection methods are powerful tools for solving the incompressible flow equations, but not all projection schemes are created equal. The precise way in which the velocity and pressure updates are decoupled introduces a \"splitting error\" that can affect the method's accuracy. This first practice invites you to perform a theoretical analysis of two foundational first-order projection methods, revealing how a subtle difference in their formulation leads to a significant difference in the accuracy of the pressure solution, a crucial lesson in numerical algorithm design .",
            "id": "3435342",
            "problem": "Consider the unsteady incompressible Stokes equations posed on the unit square domain $\\Omega=(0,1)^{2}$ with homogeneous no-slip boundary conditions:\n$$\n\\partial_{t}\\boldsymbol{u} - \\nu \\Delta \\boldsymbol{u} + \\nabla p = \\boldsymbol{f}, \\qquad \\nabla \\cdot \\boldsymbol{u} = 0 \\quad \\text{in } \\Omega \\times (0,T], \\qquad \\boldsymbol{u}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nwhere $\\boldsymbol{u}(\\boldsymbol{x},t)$ is the velocity field, $p(\\boldsymbol{x},t)$ is the pressure, $\\nu>0$ is the kinematic viscosity, and $\\boldsymbol{f}$ is a sufficiently smooth body force chosen so that the exact solution $(\\boldsymbol{u},p)$ is smooth on $\\overline{\\Omega}\\times[0,T]$. Assume a semi-discrete (in time) analysis in which spatial operators and boundary conditions are imposed exactly (i.e., no spatial discretization error). Let $\\Delta t>0$ be the uniform time step and define $t^{n}=n\\Delta t$.\n\nTwo classical projection methods are considered with first-order time stepping:\n\n1. The non-incremental pressure-correction method (Chorin). The method advances from $\\boldsymbol{u}^{n}$ to $\\boldsymbol{u}^{n+1}$ by: first computing an intermediate velocity $\\boldsymbol{v}^{n+1}$ via a backward Euler viscous step without pressure,\n$$\n\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} = \\boldsymbol{f}^{n+1}, \\qquad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nthen solving a scalar Poisson equation for the projection potential $\\phi^{n+1}$,\n$$\n\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1} \\quad \\text{in } \\Omega, \\qquad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0,\n$$\nand updating\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\qquad p^{n+1} = \\phi^{n+1}.\n$$\n\n2. The incremental pressure-correction method (Temam). The method advances from $(\\boldsymbol{u}^{n},p^{n})$ by first computing $\\boldsymbol{v}^{n+1}$ via a backward Euler viscous step with the previous pressure,\n$$\n\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} + \\nabla p^{n} = \\boldsymbol{f}^{n+1}, \\qquad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nthen solving for $\\phi^{n+1}$,\n$$\n\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1} \\quad \\text{in } \\Omega, \\qquad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0,\n$$\nand updating\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\qquad p^{n+1} = p^{n} + \\phi^{n+1}.\n$$\n\nAssume that $\\boldsymbol{u}$ and $p$ are sufficiently smooth in time and space and that the boundary data are consistent with the Stokes problem, with $\\boldsymbol{u}|_{\\partial\\Omega}=\\boldsymbol{0}$ exactly.\n\nUsing a first-principles consistency and stability reasoning for each scheme, determine the expected temporal orders of accuracy in the $L^{2}(\\Omega)$ norm for the velocity and pressure when $\\Delta t \\to 0$. Let $\\alpha_{C}$ and $\\beta_{C}$ denote the temporal orders for the velocity $\\boldsymbol{u}$ and pressure $p$, respectively, under the Chorin method, and let $\\alpha_{T}$ and $\\beta_{T}$ denote the corresponding orders under the Temam method. Express your final answer as the row matrix $(\\alpha_{C},\\beta_{C},\\alpha_{T},\\beta_{T})$. No rounding is required, and no physical units should be included with the final answer.",
            "solution": "The temporal orders of accuracy for the velocity and pressure for each projection method are determined by a consistency analysis, which involves calculating the local truncation error of each scheme. The stability of these first-order projection methods is assumed, which, by the Lax-Richtmyer equivalence theorem, implies that the order of the global error is the same as the order of the local truncation error.\n\n**1. Non-incremental Pressure-Correction Method (Chorin)**\n\nThe scheme consists of three steps:\n1.  Viscous step: $\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} = \\boldsymbol{f}^{n+1}, \\quad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0}.$\n2.  Poisson equation: $\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1}, \\quad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0.$\n3.  Update: $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\quad p^{n+1} = \\phi^{n+1}.$\n\nThe crucial aspect of this scheme is the treatment of the pressure. The numerical pressure $p^{n+1}$ is set to be the potential $\\phi^{n+1}$. The boundary condition for $\\phi^{n+1}$ is derived by enforcing the no-penetration condition ($\\boldsymbol{u}^{n+1}\\cdot\\boldsymbol{n}=0$) on the boundary. From the update step, $\\boldsymbol{u}^{n+1}\\cdot\\boldsymbol{n} = \\boldsymbol{v}^{n+1}\\cdot\\boldsymbol{n} - \\Delta t \\nabla\\phi^{n+1}\\cdot\\boldsymbol{n}$. Since both $\\boldsymbol{u}^{n+1}$ and $\\boldsymbol{v}^{n+1}$ are zero on the boundary, their normal components are zero. This leads to $\\Delta t \\nabla\\phi^{n+1}\\cdot\\boldsymbol{n} = 0$, which implies the artificial boundary condition $\\frac{\\partial \\phi^{n+1}}{\\partial n} = 0$. Since $p^{n+1} = \\phi^{n+1}$, the scheme implicitly imposes $\\frac{\\partial p^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0$.\n\nLet's compare this to the boundary condition satisfied by the exact pressure $p(\\boldsymbol{x},t)$. By evaluating the exact momentum equation on the boundary $\\partial\\Omega$ where $\\boldsymbol{u}=\\boldsymbol{0}$ (and thus $\\partial_t \\boldsymbol{u} = \\boldsymbol{0}$), we have:\n$$-\\nu \\Delta \\boldsymbol{u} + \\nabla p = \\boldsymbol{f} \\quad \\text{on } \\partial\\Omega.$$\nTaking the dot product with the outward normal vector $\\boldsymbol{n}$ gives the exact Neumann boundary condition for the pressure:\n$$\\frac{\\partial p}{\\partial n} = \\boldsymbol{n} \\cdot (\\boldsymbol{f} + \\nu \\Delta \\boldsymbol{u}) \\quad \\text{on } \\partial\\Omega.$$\nThis expression is generally non-zero. Therefore, the scheme imposes a boundary condition on the pressure that is inconsistent with the exact pressure's boundary condition. The error in the Neumann data is $O(1)$. This $O(1)$ inconsistency creates a numerical boundary layer in the pressure solution. Rigorous analysis shows that this boundary layer has a thickness of $O(\\sqrt{\\nu\\Delta t})$ and leads to a global error in the $L^2(\\Omega)$ norm that scales as $O(\\sqrt{\\Delta t})$. Thus, the order of accuracy for the pressure is $\\beta_C = 1/2$.\n\nNow, let's analyze the velocity error. The local truncation error for the velocity, $\\boldsymbol{e}_{u}^{n+1} = \\boldsymbol{u}_{num}^{n+1} - \\boldsymbol{u}_{exact}(t^{n+1})$, can be analyzed by substituting the exact solution into the scheme. The analysis shows that the intermediate velocity error is $\\boldsymbol{v}^{n+1} - \\boldsymbol{u}(t^{n+1}) = \\Delta t \\nabla p(t^{n+1}) + O((\\Delta t)^2)$. The velocity update is $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t\\nabla \\phi^{n+1}$. The local error is then:\n$$\\boldsymbol{u}^{n+1} - \\boldsymbol{u}(t^{n+1}) = (\\boldsymbol{v}^{n+1} - \\boldsymbol{u}(t^{n+1})) - \\Delta t \\nabla \\phi^{n+1} \\approx \\Delta t \\nabla p(t^{n+1}) - \\Delta t \\nabla \\phi^{n+1} = \\Delta t \\nabla (p(t^{n+1}) - \\phi^{n+1}).$$\nThe term $\\nabla(p(t^{n+1}) - \\phi^{n+1})$ is the gradient of the pressure error. Even though the pressure error itself is large near the boundary, its gradient is found to be bounded in the $L^2$ norm, i.e., $\\|\\nabla(p - \\phi)\\|_{L^2} = O(1)$. Therefore, the local truncation error for velocity is $O(\\Delta t)$. For a stable scheme, this yields a global velocity accuracy of first order. Thus, $\\alpha_C = 1$.\n\nIn summary, for the non-incremental Chorin method, we have $(\\alpha_C, \\beta_C) = (1, 1/2)$.\n\n**2. Incremental Pressure-Correction Method (Temam)**\n\nThe scheme consists of three steps:\n1.  Viscous step: $\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} + \\nabla p^{n} = \\boldsymbol{f}^{n+1}, \\quad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0}.$\n2.  Poisson equation: $\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1}, \\quad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0.$\n3.  Update: $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\quad p^{n+1} = p^{n} + \\phi^{n+1}.$\n\nThe crucial differences are the inclusion of $\\nabla p^n$ in the viscous step and the incremental update of the pressure. Let's analyze the boundary condition for the pressure $p^{n+1}$. As before, the projection requires $\\frac{\\partial\\phi^{n+1}}{\\partial n}=0$. From the pressure update, this implies:\n$$\\frac{\\partial p^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega} = \\frac{\\partial p^{n}}{\\partial n}\\Big|_{\\partial\\Omega} + \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega} = \\frac{\\partial p^{n}}{\\partial n}\\Big|_{\\partial\\Omega}.$$\nThe scheme imposes a lagged boundary condition on the pressure. Let us evaluate the error in this boundary condition at time $t^{n+1}$. Assuming the numerical solution is accurate at time $t^n$, i.e., $\\frac{\\partial p^n}{\\partial n} \\approx \\frac{\\partial p(t^n)}{\\partial n}$, the error in the Neumann data is:\n$$\\frac{\\partial p^n}{\\partial n} - \\frac{\\partial p(t^{n+1})}{\\partial n} \\approx \\frac{\\partial p(t^n)}{\\partial n} - \\frac{\\partial p(t^{n+1})}{\\partial n} = -\\left( \\frac{\\partial p(t^{n+1})}{\\partial n} - \\frac{\\partial p(t^n)}{\\partial n} \\right) = - \\Delta t \\frac{\\partial}{\\partial t}\\left(\\frac{\\partial p}{\\partial n}\\right) + O((\\Delta t)^2).$$\nThe error in the pressure boundary condition is $O(\\Delta t)$. For an elliptic equation like the pressure Poisson equation, an $O(\\Delta t)$ error in the Neumann data leads to an $O(\\Delta t)$ error in the solution over the entire domain. Thus, the local truncation error for pressure is $O(\\Delta t)$, and the global accuracy is first-order. So, $\\beta_T = 1$.\n\nFor the velocity, we can combine the scheme's equations to find the underlying consistency error. The result is that the incremental scheme is equivalent to a fully coupled backward Euler discretization of the Stokes equations, plus a splitting error term. This splitting error is of the form $\\nu \\Delta t \\Delta(\\nabla(p^{n+1}-p^n))$. Since $p^{n+1}-p^n \\approx \\Delta t \\frac{\\partial p}{\\partial t}$, this splitting error is $O((\\Delta t)^2)$. The dominant temporal error comes from the first-order backward Euler discretization of $\\partial_t\\boldsymbol{u}$, which has a truncation error of $O(\\Delta t)$. Therefore, the total local truncation error for velocity is $O(\\Delta t)$, leading to a first-order accurate velocity solution. Thus, $\\alpha_T = 1$.\n\nIn summary, for the incremental Temam method, we have $(\\alpha_T, \\beta_T) = (1, 1)$.\n\n**Conclusion**\n\nCombining the results for both schemes, the temporal orders of accuracy are:\n-   Chorin's non-incremental method: $(\\alpha_C, \\beta_C) = (1, 1/2)$.\n-   Temam's incremental method: $(\\alpha_T, \\beta_T) = (1, 1)$.\n\nThe final answer is the row matrix $(\\alpha_{C}, \\beta_{C}, \\alpha_{T}, \\beta_{T})$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & \\frac{1}{2} & 1 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After analyzing the theoretical differences between projection schemes, the next step is to see these algorithms in action. This hands-on coding exercise guides you through the implementation of both an incremental (velocity-correction) and a non-incremental (pressure-correction) method for the Stokes equations. By using a Fourier spectral method on a periodic domain, we can simplify the spatial differentiation and Poisson solve, allowing you to focus purely on the logic of the projection steps and verify their behavior in a controlled setting .",
            "id": "3322008",
            "problem": "Consider the two-dimensional incompressible Stokes equations on a periodic square domain of side length $L$ with spatial coordinates $(x,y)$, where all quantities are nondimensional:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwith velocity $\\mathbf{u}(x,y,t)$, pressure $p(x,y,t)$, kinematic viscosity $\\nu$, and body force $\\mathbf{f}(x,y,t)$. The objective is to design and implement one time step of two distinct fractional-step projection methods:\n1. A velocity-correction (incremental pressure projection) scheme.\n2. A standard pressure-correction (non-incremental) scheme.\n\nBoth schemes must be derived and implemented starting from the fundamental base of the above governing equations and the Helmholtz decomposition of vector fields (into divergence-free and gradient parts), ensuring the divergence-free constraint at the end of the step. The domain is periodic, so the spatial discretization should respect periodic boundary conditions. Use a Fourier spectral representation (discrete Fourier transform on a uniform grid) to compute spatial derivatives, gradients, divergences, and solve the scalar Poisson problem that arises in the projection.\n\nImplement the following in a single program:\n- Represent the domain as $[0,2\\pi] \\times [0,2\\pi]$ with a uniform $N \\times N$ grid for each test case.\n- Use a single explicit time step from $t^n$ to $t^{n+1} = t^n + \\Delta t$.\n- For the velocity-correction scheme, construct the intermediate velocity by explicitly including the old pressure gradient and then enforce incompressibility via a scalar potential correction. Update the pressure incrementally.\n- For the standard pressure-correction scheme, construct the intermediate velocity without any pressure term, then enforce incompressibility via a scalar pressure solve, and update the pressure non-incrementally.\n- Solve the required periodic Poisson problem in Fourier space by imposing a zero-mean constraint on the pressure (set the zero wavenumber component of pressure to zero).\n- Quantify the following for each test case:\n  1. The $L^2$ norm of the divergence of the corrected velocity from the velocity-correction scheme at $t^{n+1}$.\n  2. The $L^2$ norm of the divergence of the corrected velocity from the pressure-correction scheme at $t^{n+1}$.\n  3. The $L^2$ norm of the difference between the updated pressure and the sum of old pressure plus the scalar correction for the velocity-correction scheme (this evaluates the pressure update formula used by the incremental approach).\n  4. The $L^2$ norm of the difference between the updated pressure and the scalar correction for the pressure-correction scheme (this evaluates the pressure update formula used by the non-incremental approach).\n  5. The $L^2$ norm of the difference between the updated pressures produced by the two schemes.\n\nStart from the following analytic fields at time $t^n$ (all nondimensional), evaluated on the grid:\n- Initial velocity components:\n  $$\n  u_x^n(x,y) = \\sin(x)\\cos(y) + 0.25 \\sin(3x)\\sin(2y), \\quad\n  u_y^n(x,y) = -\\cos(x)\\sin(y) + 0.25 \\cos(2x)\\sin(3y).\n  $$\n- Initial pressure (for nonzero initial pressure cases):\n  $$\n  p^n(x,y) = \\cos(2x)\\sin(y).\n  $$\n  For zero initial pressure cases, use $p^n(x,y) = 0$.\n- Body force:\n  $$\n  f_x(x,y) = 0.1 \\cos(2x)\\cos(2y), \\quad\n  f_y(x,y) = -0.1 \\sin(2x)\\sin(2y).\n  $$\n  For zero-force cases, use $\\mathbf{f}(x,y) = \\mathbf{0}$.\n\nUse the discrete Fourier transform to compute spatial operators. Let $k_x$ and $k_y$ be the angular wavenumbers associated with the discrete Fourier modes on the grid, and use the Fourier relations for gradient, divergence, and Laplacian consistently over the periodic domain. Enforce zero mean for the pressure by setting the Fourier coefficient at the zero wavenumber to $0$.\n\nTest Suite:\nImplement the program for the following four test cases, each specified by the tuple $(N, \\Delta t, \\nu, p\\_zero, f\\_zero)$:\n1. $(32, 0.05, 0.1, \\text{False}, \\text{False})$.\n2. $(32, 0.001, 0.5, \\text{False}, \\text{False})$.\n3. $(32, 0.2, 0.01, \\text{False}, \\text{True})$.\n4. $(32, 0.1, 0.1, \\text{True}, \\text{False})$.\n\nFor each test case:\n- Construct the fields $u_x^n$, $u_y^n$, $p^n$ (either nonzero or zero as specified), and $\\mathbf{f}$ (either nonzero or zero as specified).\n- Perform one time step using both schemes, enforcing incompressibility via the projection.\n- Compute the quantities enumerated above as real numbers.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of five floating-point numbers in the following order:\n$[ \\| \\nabla \\cdot \\mathbf{u}^{n+1}\\|_{2,\\text{vel-corr}}, \\| \\nabla \\cdot \\mathbf{u}^{n+1}\\|_{2,\\text{press-corr}}, \\| p^{n+1} - (p^n + \\phi)\\|_{2,\\text{vel-corr}}, \\| p^{n+1} - \\phi\\|_{2,\\text{press-corr}}, \\| p^{n+1}_{\\text{vel-corr}} - p^{n+1}_{\\text{press-corr}} \\|_{2} ]$,\nthen aggregate all test cases sequentially into a single flat list. For example, the output format is\n$[r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}, r_{1,5}, r_{2,1}, \\dots, r_{4,5}]$,\nwith each $r_{i,j}$ a floating-point number. No physical units are required since the problem is nondimensional; angles are in radians due to the periodic trigonometric functions on the domain $[0,2\\pi]^2$.",
            "solution": "The problem requires the implementation and comparison of two fractional-step projection methods for the two-dimensional incompressible Stokes equations on a doubly periodic domain. The spatial discretization will be handled using a Fourier spectral method, which is natural for periodic problems. We will carry out a single time step using an explicit-in-viscosity formulation.\n\nThe governing Stokes equations are:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f} \\quad (1)\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0 \\quad (2)\n$$\nwhere $\\mathbf{u}$ is the velocity, $p$ is the pressure, $\\nu$ is the kinematic viscosity, and $\\mathbf{f}$ is a body force. The domain is $[0, 2\\pi] \\times [0, 2\\pi]$.\n\nA semi-discrete form using an explicit Euler method for the viscous and force terms and an implicit pressure gradient is:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = -\\nabla p^{n+1} + \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\nThis coupled system is solved using projection methods, which decouple the velocity and pressure updates.\n\n**Spatial Discretization: Fourier Spectral Method**\nFor a periodic function on an $N \\times N$ grid, we use the Discrete Fourier Transform (DFT). The spatial derivative operators become algebraic multiplications in Fourier space. Let $\\hat{g}(\\mathbf{k}) = \\mathcal{F}(g(\\mathbf{x}))$ be the DFT of a field $g$, where $\\mathbf{k} = (k_x, k_y)$ is the wavenumber vector.\n- Gradient: $\\mathcal{F}(\\nabla g) = i\\mathbf{k} \\hat{g}$\n- Divergence: $\\mathcal{F}(\\nabla \\cdot \\mathbf{v}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{v}}$\n- Laplacian: $\\mathcal{F}(\\nabla^2 g) = -|\\mathbf{k}|^2 \\hat{g} = -(k_x^2 + k_y^2) \\hat{g}$\n\nThe core of the projection step is solving a Poisson equation of the form $\\nabla^2 \\phi = S$. In Fourier space, this becomes $-|\\mathbf{k}|^2 \\hat{\\phi} = \\hat{S}$, which is solved as $\\hat{\\phi} = -\\hat{S} / |\\mathbf{k}|^2$. For the DC component ($k_x=k_y=0$), $|\\mathbf{k}|^2=0$. A unique solution is obtained by imposing a zero-mean constraint on $\\phi$, which translates to setting its DC Fourier coefficient $\\hat{\\phi}(0,0)=0$. This is consistent as $\\hat{S}(0,0)$ will also be zero for a source term $S$ that is the divergence of a vector field on a periodic domain.\n\n**1. Velocity-Correction (Incremental Pressure) Scheme**\n\nThis scheme incorporates the pressure gradient from the previous time step into the prediction of an intermediate velocity field, $\\mathbf{u}^*$.\n\n**Step 1: Predictor Step.** An intermediate velocity $\\mathbf{u}^*$ is computed by time-stepping the full momentum equation using the old pressure $p^n$:\n$$\n\\frac{\\mathbf{u}^* - \\mathbf{u}^n}{\\Delta t} = -\\nabla p^n + \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\nIn Fourier space, this is:\n$$\n\\hat{\\mathbf{u}}^* = \\hat{\\mathbf{u}}^n + \\Delta t (-i\\mathbf{k}\\hat{p}^n - \\nu |\\mathbf{k}|^2\\hat{\\mathbf{u}}^n + \\hat{\\mathbf{f}}^n)\n$$\n\n**Step 2: Projection Step.** The field $\\mathbf{u}^*$ is not generally divergence-free. It is projected onto the space of divergence-free fields. This is achieved by finding a scalar potential $\\phi$ such that subtracting its gradient corrects the velocity. The correction is defined by:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^*}{\\Delta t} = -\\nabla \\phi\n$$\nEnforcing the incompressibility constraint $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ on this equation leads to a Poisson equation for $\\phi$:\n$$\n\\nabla^2 \\phi = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^*\n$$\nWe solve this in Fourier space:\n$$\n\\hat{\\phi} = -\\frac{1}{\\Delta t |\\mathbf{k}|^2} (i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}^*)\n$$\nwith $\\hat{\\phi}(0,0) = 0$.\n\n**Step 3: Velocity Correction & Pressure Update.** The final velocity is computed by applying the correction:\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^* - \\Delta t (i\\mathbf{k}\\hat{\\phi})\n$$\nThe pressure is updated incrementally:\n$$\np^{n+1} = p^n + \\phi\n$$\nThe problem asks to verify this definition by computing $\\| p^{n+1} - (p^n + \\phi) \\|_{2}$, which should be zero to machine precision.\n\n**2. Standard Pressure-Correction (Non-Incremental) Scheme**\n\nThis classic scheme omits the pressure gradient from the predictor step.\n\n**Step 1: Predictor Step.** An intermediate velocity $\\mathbf{u}^*$ is computed without any pressure term:\n$$\n\\frac{\\mathbf{u}^* - \\mathbf{u}^n}{\\Delta t} = \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\nIn Fourier space:\n$$\n\\hat{\\mathbf{u}}^* = \\hat{\\mathbf{u}}^n + \\Delta t (-\\nu |\\mathbf{k}|^2\\hat{\\mathbf{u}}^n + \\hat{\\mathbf{f}}^n)\n$$\n\n**Step 2: Projection Step.** The correction step uses a scalar potential, which is now identified with the new pressure $p^{n+1}$ (or a scaled version). The governing equations for the step are:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^*}{\\Delta t} = -\\nabla p^{n+1}, \\quad \\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\nThis leads to a Poisson equation for the pressure at time $t^{n+1}$:\n$$\n\\nabla^2 p^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^*\n$$\nIn the problem's notation, we solve for a scalar $\\phi$ and then set $p^{n+1}=\\phi$. The solution in Fourier space is:\n$$\n\\hat{\\phi} = \\hat{p}^{n+1} = -\\frac{1}{\\Delta t |\\mathbf{k}|^2} (i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}^*)\n$$\nwith $\\hat{\\phi}(0,0) = 0$.\n\n**Step 3: Velocity Correction & Pressure Update.** The final velocity is:\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^* - \\Delta t (i\\mathbf{k}\\hat{p}^{n+1})\n$$\nThe pressure update is non-incremental; the new pressure is simply the potential $\\phi$ found in the projection step:\n$$\np^{n+1} = \\phi\n$$\nThe problem verifies this by asking for $\\| p^{n+1} - \\phi \\|_{2}$.\n\n**Equivalence of the Schemes for Stokes Flow**\nA key insight for this problem is that for the linear Stokes equations with this explicit time-stepping, the two schemes yield identical results for both velocity and pressure, provided the initial pressure field $p^n$ has zero mean. The specified $p^n(x,y) = \\cos(2x)\\sin(y)$ has a mean of zero over the periodic domain. Consequently, all computed norms are expected to be non-zero only due to floating-point numerical errors and should be on the order of machine precision. The final velocity fields from both schemes will be divergence-free to machine precision by construction.\n\n**Implementation Summary**\nFor each test case:\n1. Construct the $N \\times N$ grid, initial fields $\\mathbf{u}^n$, $p^n$, $\\mathbf{f}^n$, and wavenumber arrays $k_x, k_y$.\n2. Compute the 2D DFT of all initial fields.\n3. Execute the predictor, projection, and correction steps for both schemes as described above, performing all calculus operations in Fourier space.\n4. Compute the required five $L^2$ norms. The $L^2$ norm of a discrete field $g_{ij}$ on a grid of size $N \\times N$ over a domain of side length $L=2\\pi$ is calculated as $\\|g\\|_{2} = (L/N)\\sqrt{\\sum_{i,j} |g_{ij}|^2}$.\n5. The results are collected and formatted into a single flat list.",
            "answer": "[5.91238478440939e-16,3.601267597116515e-16,8.232490518341657e-16,3.69396347101869e-16,2.235652579172084e-15,1.214434914173874e-16,7.567083811822833e-17,1.725916942045625e-16,7.747963474640498e-17,4.897379555670732e-16,2.290500139268673e-15,1.38548902598858e-15,3.220141670984925e-15,1.44299406526735e-15,8.966961445706248e-15,2.959954005898864e-16,1.801648710892976e-16,0.0,0.0,1.119034299946252e-15]"
        },
        {
            "introduction": "In any practical CFD simulation, the pressure Poisson equation is solved iteratively, which means it is never solved exactly. This raises a critical question: how accurate must the Poisson solve be to avoid compromising the overall accuracy of the simulation? This final practice bridges theory and real-world application by having you derive the direct relationship between the linear solver's residual and the final divergence error, and then implement an adaptive strategy to control this error, ensuring both physical fidelity and computational efficiency .",
            "id": "3435356",
            "problem": "Consider a standard velocity projection method for incompressible flow discretization in which the velocity and pressure are decoupled by solving a scalar Poisson equation for an auxiliary scalar field at each time step. Let $u^{n}$ denote the discrete velocity at time $t^{n}$, and let an intermediate velocity $u^{\\star}$ be computed by a momentum step that does not enforce incompressibility. The projection step computes a scalar potential $\\phi$ by solving a discrete Poisson equation and then corrects the velocity by subtracting a scaled discrete gradient.\n\nAssume the following fundamental base, which is standard in projection methods:\n- The underlying continuous model is the incompressible Navierâ€“Stokes equations, but the derivation here relies only on the incompressibility constraint and the structure of the projection step.\n- The discrete divergence operator is denoted by $D$, the discrete gradient by $G$, and the discrete Laplacian by $A := D G$. These are the consistent operators resulting from a finite difference, finite volume, or finite element discretization on a regular mesh, with appropriate boundary treatment, such that $A$ is symmetric positive definite on the pressure space.\n- The density $\\rho$ is constant and positive, and all quantities are understood to be nondimensional.\n\nThe discrete projection step at time $t^{n+1}$ updates the velocity by\n$$\nu^{n+1} = u^{\\star} - \\frac{\\Delta t}{\\rho}\\, G \\phi,\n$$\nwhere $\\phi$ solves the linear system\n$$\nA \\phi = \\frac{\\rho}{\\Delta t}\\, D u^{\\star}.\n$$\nIn practice, this linear system is approximately solved by an iterative method that terminates according to one of the following stopping rules:\n1. A relative residual rule: the Euclidean norm of the residual $r := b - A \\tilde{\\phi}$ satisfies $\\|r\\|_2 \\le \\varepsilon_{\\text{lin}} \\,\\|b\\|_2$, with $b := \\frac{\\rho}{\\Delta t} D u^{\\star}$.\n2. An absolute residual rule: the Euclidean norm of the residual satisfies $\\|r\\|_2 \\le \\tau_{\\text{abs}}$.\n\nTask A (derivation): Starting from the definitions above, and without invoking any unproven shortcut, derive an a priori bound that links the norm of the post-projection discrete divergence $\\|D u^{n+1}\\|_2$ to the linear solver residual tolerance, for both stopping rules. The derivation must use only the facts stated above and standard properties of linear systems and norms.\n\nTask B (tolerance design): Propose an adaptive selection strategy for the linear solver tolerance that equilibrates the solver-induced divergence error with the discretization error in space and time. Assume that the leading-order discretization error in the divergence scales as $C_s h^{k} + C_t \\Delta t^{q}$, where $h$ is the mesh size, $\\Delta t$ is the time step, $k$ is the spatial order, $q$ is the temporal order, and $C_s, C_t$ are positive constants. Let the target level for the solver-induced divergence be a fraction $\\theta \\in (0,1]$ of this estimate:\n$$\n\\tau_{\\text{div}} := \\theta \\left( C_s h^{k} + C_t \\Delta t^{q} \\right).\n$$\nDesign rules for both a relative tolerance $\\varepsilon_{\\text{lin}}$ and an absolute tolerance $\\tau_{\\text{abs}}$ that achieve $\\|D u^{n+1}\\|_2 \\lesssim \\tau_{\\text{div}}$, subject to practical caps $\\varepsilon_{\\max}$ and $\\tau_{\\max}$ and to a safeguard that avoids division by a small $\\|D u^{\\star}\\|_2$ by replacing it with a floor value $u_{\\star,\\min} > 0$ where appropriate.\n\nTask C (implementation): Implement a program that, for each test case in the suite below, computes the following three quantities:\n1. The a priori upper bound on $\\|D u^{n+1}\\|_2$ caused by the inexact Poisson solve in that case, using the rule corresponding to the provided stopping criterion.\n2. The recommended relative tolerance $\\varepsilon_{\\text{lin}}$ based on the adaptive strategy in Task B.\n3. The recommended absolute tolerance $\\tau_{\\text{abs}}$ based on the adaptive strategy in Task B.\n\nAll quantities are nondimensional; no physical units are required. Use the Euclidean norm for all vector norms.\n\nNumerical parameters common to all tests:\n- Spatial order $k = 2$ and temporal order $q = 2$.\n- Constants $C_s = 1$ and $C_t = 1$.\n- Fraction $\\theta = 0.5$.\n- Density $\\rho = 1$.\n- Practical caps: $\\varepsilon_{\\max} = 10^{-1}$, $\\tau_{\\max} = 10^{-2}$.\n- Safeguard floor $u_{\\star,\\min} = 10^{-8}$.\n\nEach test case provides the tuple $(\\Delta t, h, \\|D u^{\\star}\\|_2, \\text{mode}, \\text{tol})$ where:\n- $\\Delta t$ is the time step,\n- $h$ is the mesh size,\n- $\\|D u^{\\star}\\|_2$ is the Euclidean norm of the intermediate divergence,\n- $\\text{mode}$ is $0$ for the relative residual rule and $1$ for the absolute residual rule,\n- $\\text{tol}$ is $\\varepsilon_{\\text{lin}}$ when $\\text{mode}=0$ and $\\tau_{\\text{abs}}$ when $\\text{mode}=1$.\n\nTest suite:\n- Test 1: $(10^{-2}, 1/64, 10^{-1}, 0, 10^{-6})$.\n- Test 2: $(10^{-2}, 1/128, 5 \\times 10^{-2}, 1, 10^{-8})$.\n- Test 3: $(10^{-4}, 1/32, 2 \\times 10^{-2}, 0, 10^{-3})$.\n- Test 4: $(5 \\times 10^{-3}, 1/16, 10^{-12}, 0, 10^{-8})$.\n\nRequired final output format:\n- Your program should produce a single line of output containing a list with one sublist per test case. Each sublist must contain exactly three floating-point numbers in the order: $[\\text{bound}, \\varepsilon_{\\text{lin,recommended}}, \\tau_{\\text{abs,recommended}}]$. The overall format is a single list of these sublists, for example: [[b1,e1,a1],[b2,e2,a2],...].",
            "solution": "### Task A: Derivation of A Priori Bound\n\nThe objective is to relate the divergence of the final velocity field, $\\|D u^{n+1}\\|_2$, to the residual of the inexact Poisson solve. The velocity is updated using the approximate potential $\\tilde{\\phi}$:\n$$\nu^{n+1} = u^{\\star} - \\frac{\\Delta t}{\\rho}\\, G \\tilde{\\phi}.\n$$\nApplying the discrete divergence operator $D$ to this equation yields:\n$$\nD u^{n+1} = D u^{\\star} - D \\left( \\frac{\\Delta t}{\\rho}\\, G \\tilde{\\phi} \\right).\n$$\nSince $D$ is a linear operator and $\\Delta t$ and $\\rho$ are scalars, this becomes:\n$$\nD u^{n+1} = D u^{\\star} - \\frac{\\Delta t}{\\rho}\\, (D G) \\tilde{\\phi}.\n$$\nUsing the definition of the discrete Laplacian, $A := D G$, we have:\n$$\nD u^{n+1} = D u^{\\star} - \\frac{\\Delta t}{\\rho}\\, A \\tilde{\\phi}.\n$$\nThe residual of the linear system solve for $\\phi$ is defined as $r = b - A \\tilde{\\phi}$, where the right-hand side is $b = \\frac{\\rho}{\\Delta t}\\, D u^{\\star}$. From this definition, we can express $A \\tilde{\\phi}$ as $A \\tilde{\\phi} = b - r$. Substituting this into the equation for $D u^{n+1}$:\n$$\nD u^{n+1} = D u^{\\star} - \\frac{\\Delta t}{\\rho}\\, (b - r).\n$$\nNow, substitute the expression for $b$:\n$$\nD u^{n+1} = D u^{\\star} - \\frac{\\Delta t}{\\rho}\\, \\left( \\frac{\\rho}{\\Delta t}\\, D u^{\\star} - r \\right).\n$$\nDistributing the term $\\frac{\\Delta t}{\\rho}$ gives:\n$$\nD u^{n+1} = D u^{\\star} - \\left( \\frac{\\Delta t}{\\rho} \\frac{\\rho}{\\Delta t} \\right) D u^{\\star} + \\frac{\\Delta t}{\\rho} r.\n$$\nThe first two terms cancel, resulting in a direct relationship between the post-projection divergence and the linear solver residual:\n$$\nD u^{n+1} = \\frac{\\Delta t}{\\rho} r.\n$$\nTaking the Euclidean norm of both sides gives:\n$$\n\\|D u^{n+1}\\|_2 = \\left\\| \\frac{\\Delta t}{\\rho} r \\right\\|_2 = \\frac{\\Delta t}{\\rho} \\|r\\|_2.\n$$\nWe now analyze this result for each of the two stopping rules.\n\n**1. Relative Residual Rule:** The stopping criterion is $\\|r\\|_2 \\le \\varepsilon_{\\text{lin}} \\|b\\|_2$.\nThe norm of the right-hand side vector $b$ is:\n$$\n\\|b\\|_2 = \\left\\| \\frac{\\rho}{\\Delta t} D u^{\\star} \\right\\|_2 = \\frac{\\rho}{\\Delta t} \\|D u^{\\star}\\|_2.\n$$\nSubstituting this into the stopping criterion gives an upper bound on the residual norm:\n$$\n\\|r\\|_2 \\le \\varepsilon_{\\text{lin}} \\frac{\\rho}{\\Delta t} \\|D u^{\\star}\\|_2.\n$$\nFinally, substituting this inequality into the expression for $\\|D u^{n+1}\\|_2$:\n$$\n\\|D u^{n+1}\\|_2 \\le \\frac{\\Delta t}{\\rho} \\left( \\varepsilon_{\\text{lin}} \\frac{\\rho}{\\Delta t} \\|D u^{\\star}\\|_2 \\right).\n$$\nThis simplifies to the a priori bound for the relative residual rule:\n$$\n\\|D u^{n+1}\\|_2 \\le \\varepsilon_{\\text{lin}} \\|D u^{\\star}\\|_2.\n$$\n\n**2. Absolute Residual Rule:** The stopping criterion is $\\|r\\|_2 \\le \\tau_{\\text{abs}}$.\nSubstituting this directly into the expression for $\\|D u^{n+1}\\|_2$ gives the a priori bound for the absolute residual rule:\n$$\n\\|D u^{n+1}\\|_2 \\le \\frac{\\Delta t}{\\rho} \\tau_{\\text{abs}}.\n$$\n\n### Task B: Adaptive Tolerance Design\n\nThe goal is to select the linear solver tolerances, $\\varepsilon_{\\text{lin}}$ and $\\tau_{\\text{abs}}$, such that the solver-induced divergence error is equilibrated with the estimated discretization error. The target level for the solver-induced divergence is given by:\n$$\n\\tau_{\\text{div}} := \\theta \\left( C_s h^{k} + C_t \\Delta t^{q} \\right).\n$$\nWe wish to enforce $\\|D u^{n+1}\\|_2 \\lesssim \\tau_{\\text{div}}$ by setting the derived a priori bounds to be equal to this target level.\n\n**1. Design for Relative Tolerance $\\varepsilon_{\\text{lin}}$:**\nWe start with the bound derived in Task A: $\\|D u^{n+1}\\|_2 \\le \\varepsilon_{\\text{lin}} \\|D u^{\\star}\\|_2$.\nSetting this bound equal to the target divergence $\\tau_{\\text{div}}$:\n$$\n\\varepsilon_{\\text{lin}} \\|D u^{\\star}\\|_2 = \\tau_{\\text{div}}.\n$$\nSolving for $\\varepsilon_{\\text{lin}}$ yields:\n$$\n\\varepsilon_{\\text{lin}} = \\frac{\\tau_{\\text{div}}}{\\|D u^{\\star}\\|_2}.\n$$\nTo prevent division by a very small number if $\\|D u^{\\star}\\|_2$ is close to zero (which can happen as the solution converges), we use the provided safeguard. The denominator is replaced by $\\max(\\|D u^{\\star}\\|_2, u_{\\star,\\min})$. The proposed tolerance is thus:\n$$\n\\varepsilon_{\\text{lin, proposed}} = \\frac{\\tau_{\\text{div}}}{\\max(\\|D u^{\\star}\\|_2, u_{\\star,\\min})}.\n$$\nThis is then capped by the practical maximum $\\varepsilon_{\\max}$. The final rule for the recommended relative tolerance is:\n$$\n\\varepsilon_{\\text{lin, recommended}} = \\min \\left( \\frac{\\theta (C_s h^k + C_t \\Delta t^q)}{\\max(\\|D u^{\\star}\\|_2, u_{\\star,\\min})}, \\varepsilon_{\\max} \\right).\n$$\n\n**2. Design for Absolute Tolerance $\\tau_{\\text{abs}}$:**\nWe start with the bound derived in Task A: $\\|D u^{n+1}\\|_2 \\le \\frac{\\Delta t}{\\rho} \\tau_{\\text{abs}}$.\nSetting this bound equal to the target divergence $\\tau_{\\text{div}}$:\n$$\n\\frac{\\Delta t}{\\rho} \\tau_{\\text{abs}} = \\tau_{\\text{div}}.\n$$\nSolving for $\\tau_{\\text{abs}}$ yields:\n$$\n\\tau_{\\text{abs}} = \\frac{\\rho}{\\Delta t} \\tau_{\\text{div}}.\n$$\nThis is capped by the practical maximum $\\tau_{\\max}$. The final rule for the recommended absolute tolerance is:\n$$\n\\tau_{\\text{abs, recommended}} = \\min \\left( \\frac{\\rho}{\\Delta t} \\theta (C_s h^k + C_t \\Delta t^q), \\tau_{\\max} \\right).\n$$\n\n### Task C: Implementation\nThe derivations from Tasks A and B provide the necessary formulae to compute the required quantities for each test case.\n- The a priori bound on $\\|D u^{n+1}\\|_2$ is calculated using either $\\|D u^{n+1}\\|_2 \\le \\varepsilon_{\\text{lin}} \\|D u^{\\star}\\|_2$ for $\\text{mode}=0$ or $\\|D u^{n+1}\\|_2 \\le \\frac{\\Delta t}{\\rho} \\tau_{\\text{abs}}$ for $\\text{mode}=1$, with the specific `tol` value from the test case.\n- The recommended relative tolerance $\\varepsilon_{\\text{lin,recommended}}$ is calculated using the formula from Task B.\n- The recommended absolute tolerance $\\tau_{\\text{abs,recommended}}$ is calculated using the formula from Task B.\nThese calculations are performed for each test case to produce the final output.",
            "answer": "[[1e-07, 0.00171661376953125, 0.01], [1e-10, 0.0016103515625, 0.0080517578125], [2e-05, 0.02441455078125, 0.01], [8e-21, 0.1, 0.01]]"
        }
    ]
}