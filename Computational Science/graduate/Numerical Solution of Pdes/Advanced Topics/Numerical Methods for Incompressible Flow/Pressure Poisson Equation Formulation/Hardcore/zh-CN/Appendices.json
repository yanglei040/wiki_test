{
    "hands_on_practices": [
        {
            "introduction": "将压力泊松方程付诸实践的第一步是将其离散化，并求解由此产生的线性方程组。本练习将通过一个具体的、分步的计算，带你完成雅可比（Jacobi）方法的一次迭代，从而在连续的偏微分方程和其数值解之间架起一座桥梁。这个过程有助于揭开迭代求解器的神秘面纱，并为你建立起坚实的基础。",
            "id": "3307564",
            "problem": "在计算流体动力学 (CFD) 中，考虑一个由分数步长（投影）法推进的二维不可压缩流。令中间速度场表示为 $u^{\\ast}$，质量密度为 $\\rho$，时间步长为 $\\Delta t$。校正后的速度 $u^{n+1}$ 是通过压力校正强制实现不可压缩性得到的。在两个方向上间距均为 $h$ 的均匀笛卡尔网格上进行计算，并假设在区域边界上压力满足狄利克雷 (Dirichlet) 边界条件。关注一个内部单元 $(i,j)$。\n\n从不可压缩流的控制方程和分数步长投影法的定义出发，推导压力泊松方程 (PPE)，该方程通过 $p^{n+1}$ 和 $u^{\\ast}$ 来强制满足 $\\nabla \\cdot u^{n+1} = 0$。在均匀网格上使用标准的五点模板离散拉普拉斯算子，并根据前一次迭代的相邻压力值和局部源项，推导用于内部压力更新的雅可比 (Jacobi) 不动点迭代格式。然后，使用以下数据，为特定的内部位置 $(i,j)$ 计算一次雅可比迭代：\n\n- 网格间距：$h = 0.01 \\,\\text{m}$。\n- 密度：$\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$。\n- 时间步长：$\\Delta t = 0.1 \\,\\text{s}$。\n- $(i,j)$ 处的面心中间速度：\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$，$u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$，\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$，$v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$。\n- 第 $m$ 次迭代的相邻压力（单位：帕斯卡）：\n  - $p^{(m)}_{i+1,j} = 100000$，$p^{(m)}_{i-1,j} = 100010$，$p^{(m)}_{i,j+1} = 100000$，$p^{(m)}_{i,j-1} = 100005$。\n\n在单元 $(i,j)$ 处，使用标准的二阶有限体积或有限差分离散散度来构建 $q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right)\\nabla \\cdot u^{\\ast}$，并对内部压力执行一次雅可比更新。以帕斯卡为单位表示更新后的压力。提供精确值，不要四舍五入。\n\n此外，对于一个尺寸为 $N_{x} \\times N_{y}$、带有狄利克雷边界条件的方形内部网格，通过给出雅可比迭代矩阵的谱半径作为 $N_{x}$ 和 $N_{y}$ 的函数，讨论雅可比方法每次迭代的预期收敛率，并简要解释其对大的 $N_{x},N_{y}$ 的影响。此讨论不影响所要求的数值答案。",
            "solution": "该问题需要在计算流体动力学的背景下进行多步推导和计算，特别是有关于不可压缩流的投影法。我们将首先推导连续的压力泊松方程 (PPE)，然后对其进行离散化并建立雅可比迭代格式，接着进行一次迭代步骤的数值计算，最后讨论该方法的收敛性。\n\n**1. 压力泊松方程 (PPE) 的推导**\n\n求解不可压缩纳维-斯托克斯 (Navier-Stokes) 方程的投影法通过将动量方程的更新分为两个步骤来在时间上推进求解。密度 $\\rho$ 为常数的不可压缩流体的控制方程是连续性方程和动量方程。\n\n投影法的核心在于第二步，即校正或投影步。在计算出中间速度场 $\\mathbf{u}^{\\ast}$（通常通过求解不含压力梯度项的动量方程得到）之后，找到一个压力场 $p^{n+1}$，使得校正后的速度场 $\\mathbf{u}^{n+1}$ 是无散度的。\n\n校正后的速度 $\\mathbf{u}^{n+1}$、中间速度 $\\mathbf{u}^{\\ast}$ 以及新时间步的压力 $p^{n+1}$ 之间的关系由投影步方程给出：\n$$ \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}}{\\Delta t} = -\\frac{1}{\\rho} \\nabla p^{n+1} $$\n其中 $\\Delta t$ 是时间步长。这个方程可以重排以显式地表示校正后的速度：\n$$ \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} $$\n不可压缩流的基本约束是速度场必须始终是无散度（螺线场）的。我们将此条件施加于校正后的速度场 $\\mathbf{u}^{n+1}$：\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = 0 $$\n为了推导压力 $p^{n+1}$ 的方程，我们对速度校正方程取散度：\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\left( \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\n将不可压缩性约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 应用于左侧，并在右侧使用散度算子的线性性质，我们得到：\n$$ 0 = \\nabla \\cdot \\mathbf{u}^{\\ast} - \\nabla \\cdot \\left( \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\n假设密度 $\\rho$ 和时间步长 $\\Delta t$ 是常数，它们可以移到散度算子之外：\n$$ \\nabla \\cdot (\\nabla p^{n+1}) = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\n算子 $\\nabla \\cdot \\nabla$ 是拉普拉斯算子，记为 $\\nabla^2$ 或 $\\Delta$。因此，我们得到了压力泊松方程 (PPE)：\n$$ \\nabla^2 p^{n+1} = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\n这个椭圆型偏微分方程确定了将中间速度场投影到无散度空间上所需的压力场。\n\n**2. 离散化与雅可比迭代**\n\n我们在一个在 $x$ 和 $y$ 方向上间距均为 $h$ 的均匀二维笛卡尔网格上离散化PPE。令 $p_{i,j}$ 表示单元 $(i,j)$ 中心的压力。\n\n在 $(i,j)$ 处的拉普拉斯算子 $\\nabla^2 p$ 使用标准的二阶五点有限差分模板进行近似：\n$$ (\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h^2} $$\n我们记为 $q$ 的右侧源项在单元中心 $(i,j)$ 处进行离散化。问题指定了一种交错网格布置，其中速度存储在单元的面上。中间速度场 $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ 的散度通过中心差分来近似：\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} \\approx \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} $$\n离散后的源项则为：\n$$ q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right) \\left( \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} \\right) $$\n结合这些，完全离散化的PPE为：\n$$ \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2} = q_{i,j} $$\n为了推导雅可比不动点迭代，我们求解此方程以得到中心压力 $p_{i,j}$。设迭代计数器为 $m$。雅可比方法仅使用来自前一次迭代 $m$ 的所有相邻点的值来更新 $(i,j)$ 处的值。\n$$ -4p_{i,j} = h^2 q_{i,j} - (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1}) $$\n$$ p_{i,j} = \\frac{1}{4} (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - h^2 q_{i,j}) $$\n因此，雅可比更新规则为：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\n\n**3. 一次雅可比迭代的数值计算**\n\n我们有以下给定数据：\n- 网格间距：$h = 0.01 \\,\\text{m}$。\n- 密度：$\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$。\n- 时间步长：$\\Delta t = 0.1 \\,\\text{s}$。\n- 中间速度：\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$，$u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$，$v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n- 前一次迭代的压力（在迭代 $m$ 时）：\n  - $p^{(m)}_{i+1,j} = 100000$ Pa, $p^{(m)}_{i-1,j} = 100010$ Pa, $p^{(m)}_{i,j+1} = 100000$ Pa, $p^{(m)}_{i,j-1} = 100005$ Pa.\n\n首先，我们计算单元 $(i,j)$ 处 $\\mathbf{u}^{\\ast}$ 的离散散度：\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{0.20 - 0.10}{0.01} + \\frac{-0.05 - (-0.10)}{0.01} = \\frac{0.10}{0.01} + \\frac{0.05}{0.01} = 10 + 5 = 15 \\,\\text{s}^{-1} $$\n接下来，我们计算源项 $q_{i,j}$：\n$$ q_{i,j} = \\frac{\\rho}{\\Delta t} (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{1000}{0.1} \\times 15 = 10000 \\times 15 = 150000 \\,\\text{Pa}\\,\\text{m}^{-2} $$\n现在，我们计算出现在雅可比公式中的项 $h^2 q_{i,j}$：\n$$ h^2 q_{i,j} = (0.01)^2 \\times 150000 = 0.0001 \\times 150000 = 15 \\,\\text{Pa} $$\n最后，我们执行一次雅可比迭代来求解 $p^{(m+1)}_{i,j}$：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\n代入给定的压力值和计算出的项：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (100000 + 100010 + 100000 + 100005 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400015 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400000) $$\n$$ p^{(m+1)}_{i,j} = 100000 \\,\\text{Pa} $$\n\n**4. 雅可比方法的收敛率**\n\n对于线性系统 $A\\mathbf{p}=\\mathbf{b}$，雅可比方法的收敛性由雅可比迭代矩阵 $T_J$ 的谱半径 $\\rho(T_J)$ 决定。对于在具有 $N_x \\times N_y$ 个内部点和狄利克雷边界条件的矩形网格上使用五点模板离散化的二维泊松方程，雅可比矩阵的谱半径由下式给出：\n$$ \\rho(T_J) = \\frac{1}{2} \\left[ \\cos\\left(\\frac{\\pi}{N_x+1}\\right) + \\cos\\left(\\frac{\\pi}{N_y+1}\\right) \\right] $$\n对于大量的网格点，即 $N_x \\gg 1$ 和 $N_y \\gg 1$，余弦函数的自变量很小。对于小的 $x$，我们可以使用泰勒级数展开 $\\cos(x) \\approx 1 - x^2/2$。\n$$ \\rho(T_J) \\approx \\frac{1}{2} \\left[ \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_x+1}\\right)^2\\right) + \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_y+1}\\right)^2\\right) \\right] $$\n$$ \\rho(T_J) \\approx 1 - \\frac{\\pi^2}{4} \\left( \\frac{1}{(N_x+1)^2} + \\frac{1}{(N_y+1)^2} \\right) $$\n由于网格间距 $h$ 与 $N_x$ 和 $N_y$ 成反比（例如，对于长度为 $L_x$ 的区域，有 $h_x = L_x/(N_x+1)$），我们得到 $\\rho(T_J) \\approx 1 - O(h^2)$。\n\n这个结果对雅可比方法的性能有着至关重要的影响。当网格加密时（即 $N_x, N_y \\rightarrow \\infty$ 或 $h \\rightarrow 0$），谱半径 $\\rho(T_J)$ 趋近于 1。收敛率取决于谱半径比 1 小多少，它会变得极低。将误差减小一个固定因子所需的迭代次数与 $(1 - \\rho(T_J))^{-1}$ 成正比，即 $O(N_x^2 + N_y^2)$ 或 $O(h^{-2})$。这表明雅可比求解器的计算量随着每个方向上网格分辨率的增加呈二次方增长，使其对于细网格和大规模问题而言慢得令人无法接受。这种不良的扩展性使得必须使用更高级、更高效的求解器，如逐次超松弛 (SOR) 法、共轭梯度法，或者最有效的多重网格法。",
            "answer": "$$\n\\boxed{100000}\n$$"
        },
        {
            "introduction": "在掌握了离散化的技术细节之后，理解压力场的物理作用至关重要。本练习利用一个具有已知解析解的理想化场景，精确地展示了压力梯度如何将一个非无散度的速度场“投影”到一个无散度的速度场上，从而完美地满足不可压缩性约束。这突出了压力泊松方程在流体模拟中的核心目的。",
            "id": "3321950",
            "problem": "考虑一个周期性域中的二维常密度不可压缩流，该流动由不可压缩纳维-斯托克斯方程控制。在无量纲变量下进行计算，使得密度为 $1$，时间步长为 $\\Delta t = 1$。域为 $\\Omega = [0,2\\pi]\\times[0,2\\pi]$，在两个方向上均采用周期性边界条件。在一个标准的分步投影法中，首先在没有压力的情况下推进一个临时速度场 $\\,\\boldsymbol{u}^{\\ast}\\,$，然后通过压力更新对其进行校正，以强制满足不可压缩性。\n\n从不可压缩流的基本约束和投影步的定义出发：校正后的速度满足 $\\,\\nabla\\cdot \\boldsymbol{u}^{n+1} = 0\\,$，并且是通过从临时速度中减去一个时间步长内的压力梯度得到的。利用这些基本原理，推导在校正后强制满足不可压缩性时，压力在周期性边界条件下必须满足的椭圆边值问题，不要假设任何预先推导出的公式。\n\n设给定的临时速度为\n$$\n\\boldsymbol{u}^{\\ast}(x,y) = \\big(2\\sin(x)\\cos(y),\\; -\\cos(x)\\sin(y)\\big), \\quad (x,y)\\in\\Omega.\n$$\n对区域 $\\Omega$ 上的压力施加标准的零均值条件以确保唯一性。\n\n基于以上信息，计算：\n- 经过一个投影步后强制满足不可压缩性的压力场 $\\,p(x,y)\\,$，以及\n- 由下式定义的散度缩减因子 $\\,r\\,$\n$$\nr \\equiv \\frac{\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}},\n$$\n其中 $\\|f\\|_{L^{2}(\\Omega)} \\equiv \\left(\\int_{\\Omega} |f|^{2}\\, \\mathrm{d}x\\,\\mathrm{d}y\\right)^{1/2}$。\n\n将你的最终答案报告为一个数对，其中包含 $\\,p(x,y)\\,$ 的闭式表达式和标量 $\\,r\\,$。由于进行了无量纲化，因此不需要单位。答案必须是一个包含这两个条目的单行矩阵。不需要进行四舍五入。",
            "solution": "用户希望我解决一个计算流体动力学问题，该问题涉及用于不可压缩流的分步投影法。\n\n### 第一步：提取已知条件\n-   **控制方程**：不可压缩纳维-斯托克斯方程（隐含）。\n-   **流动特性**：二维（$2$D）、常密度（$\\rho=1$）。\n-   **时间步长**：$\\Delta t = 1$。\n-   **域**：$\\Omega = [0, 2\\pi] \\times [0, 2\\pi]$。\n-   **边界条件**：在 x 和 y 方向上均是周期的。\n-   **分步法**：一个临时速度 $\\boldsymbol{u}^{\\ast}$ 被校正为 $\\boldsymbol{u}^{n+1}$。\n-   **校正步定义**：$\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\Delta t \\nabla p$。\n-   **不可压缩性约束**：$\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$。\n-   **临时速度场**：$\\boldsymbol{u}^{\\ast}(x,y) = (2\\sin(x)\\cos(y), -\\cos(x)\\sin(y))$。\n-   **压力唯一性条件**：域上的零均值压力，$\\int_{\\Omega} p(x,y)\\, \\mathrm{d}A = 0$。\n-   **要求输出**：\n    1.  压力场 $p(x,y)$。\n    2.  散度缩减因子 $r \\equiv \\frac{\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}}$，其中 $\\|f\\|_{L^{2}(\\Omega)} \\equiv \\left(\\int_{\\Omega} |f|^{2}\\, \\mathrm{d}x\\,\\mathrm{d}y\\right)^{1/2}$。\n\n### 第二步：使用提取的已知条件进行验证\n这个问题具有科学依据，是不可压缩流投影法理论中的一个标准练习。它是适定的；域、边界条件以及压力的唯一性约束都已指定，这确保了待推导的椭圆问题存在唯一解。该问题是客观的，并使用精确的数学语言。没有矛盾、信息缺失或违反物理原理之处。因此，该问题是有效的。\n\n### 第三步：推导与求解\n\n**第一部分：压力泊松方程的推导**\n\n投影法包含两个基本步骤。首先，计算一个中间速度场 $\\boldsymbol{u}^{\\ast}$。其次，将该场投影到无散矢量场的空间上，以获得下一个时间步的速度 $\\boldsymbol{u}^{n+1}$。这个投影是通过减去一个标量场的梯度来实现的，该标量场被视为压力 $p$。\n\n校正后速度 $\\boldsymbol{u}^{n+1}$ 和临时速度 $\\boldsymbol{u}^{\\ast}$ 之间的关系由下式给出：\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\Delta t \\nabla p\n$$\n鉴于时间步长为 $\\Delta t = 1$，上式简化为：\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\nabla p\n$$\n校正后的速度场必须满足不可压缩性约束：\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0\n$$\n为了找到控制压力 $p$ 的方程，我们对校正步方程取散度：\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot (\\boldsymbol{u}^{\\ast} - \\nabla p)\n$$\n利用散度算子的线性性，我们有：\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot \\boldsymbol{u}^{\\ast} - \\nabla \\cdot (\\nabla p)\n$$\n代入不可压缩性约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$ 并认识到 $\\nabla \\cdot (\\nabla p)$ 是拉普拉斯算子 $\\nabla^2 p$，我们得到：\n$$\n0 = \\nabla \\cdot \\boldsymbol{u}^{\\ast} - \\nabla^2 p\n$$\n这就得到了压力的椭圆边值问题，即压力泊松方程（PPE）：\n$$\n\\nabla^2 p = \\nabla \\cdot \\boldsymbol{u}^{\\ast}\n$$\n\n**第二部分：求解压力场 $p(x,y)$**\n\n首先，我们必须计算 PPE 的源项，即给定临时速度场 $\\boldsymbol{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ 的散度。\n临时速度的分量是 $u^{\\ast}(x,y) = 2\\sin(x)\\cos(y)$ 和 $v^{\\ast}(x,y) = -\\cos(x)\\sin(y)$。\n其散度为：\n$$\n\\nabla \\cdot \\boldsymbol{u}^{\\ast} = \\frac{\\partial u^{\\ast}}{\\partial x} + \\frac{\\partial v^{\\ast}}{\\partial y} = \\frac{\\partial}{\\partial x}(2\\sin(x)\\cos(y)) + \\frac{\\partial}{\\partial y}(-\\cos(x)\\sin(y))\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u}^{\\ast} = 2\\cos(x)\\cos(y) - \\cos(x)\\cos(y) = \\cos(x)\\cos(y)\n$$\n因此，待求解的 PPE 为：\n$$\n\\nabla^2 p(x,y) = \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2} = \\cos(x)\\cos(y)\n$$\n该问题定义在一个周期性域上。由于源项是三角函数形式，我们可以寻找一个类似形式的解，$p(x,y) = A\\cos(x)\\cos(y)$，其中 $A$ 是一个待定常数。这种形式自动满足周期性边界条件。\n我们计算这个试探解的偏导数：\n$$\n\\frac{\\partial^2 p}{\\partial x^2} = \\frac{\\partial^2}{\\partial x^2} (A\\cos(x)\\cos(y)) = -A\\cos(x)\\cos(y)\n$$\n$$\n\\frac{\\partial^2 p}{\\partial y^2} = \\frac{\\partial^2}{\\partial y^2} (A\\cos(x)\\cos(y)) = -A\\cos(x)\\cos(y)\n$$\n将这些代入 PPE：\n$$\n\\nabla^2 p = -A\\cos(x)\\cos(y) - A\\cos(x)\\cos(y) = -2A\\cos(x)\\cos(y)\n$$\n我们将其与源项相等：\n$$\n-2A\\cos(x)\\cos(y) = \\cos(x)\\cos(y)\n$$\n这意味着 $-2A = 1$，所以 $A = -\\frac{1}{2}$。\n压力的一般解是这个特解与齐次方程 $\\nabla^2 p_h = 0$ 在周期性边界条件下的任意解之和。唯一这样的解是常数。因此，通解为：\n$$\np(x,y) = -\\frac{1}{2}\\cos(x)\\cos(y) + C\n$$\n为了找到常数 $C$，我们应用零均值条件：\n$$\n\\int_{\\Omega} p(x,y) \\, \\mathrm{d}x\\,\\mathrm{d}y = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\left(-\\frac{1}{2}\\cos(x)\\cos(y) + C\\right) \\, \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\n$$\n-\\frac{1}{2} \\left( \\int_{0}^{2\\pi} \\cos(x) \\, \\mathrm{d}x \\right) \\left( \\int_{0}^{2\\pi} \\cos(y) \\, \\mathrm{d}y \\right) + C \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\, \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\n余弦函数在一个完整周期上的定积分为零：$\\int_{0}^{2\\pi} \\cos(t) \\, \\mathrm{d}t = [\\sin(t)]_{0}^{2\\pi} = 0$。\n方程简化为：\n$$\n-\\frac{1}{2}(0)(0) + C \\cdot (2\\pi)^2 = 0 \\implies C = 0\n$$\n因此，唯一的压力场是：\n$$\np(x,y) = -\\frac{1}{2}\\cos(x)\\cos(y)\n$$\n\n**第三部分：计算散度缩减因子 $r$**\n\n缩减因子定义为 $r = \\frac{\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}}$。\n\n分子涉及校正后速度场的散度 $\\nabla \\cdot \\boldsymbol{u}^{n+1}$。根据构造，投影步的设计就是为了强制其为零。如第一部分所示，$\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot \\boldsymbol{u}^{\\ast} - \\nabla^2 p$。由于我们解出 $\\nabla^2 p = \\nabla \\cdot \\boldsymbol{u}^{\\ast}$，可得 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$。\n零函数的 $L^2$-范数为零：\n$$\n\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)} = \\|0\\|_{L^{2}(\\Omega)} = 0\n$$\n\n分母需要计算临时速度散度 $\\nabla \\cdot \\boldsymbol{u}^{\\ast} = \\cos(x)\\cos(y)$ 的 $L^2$-范数。\n$$\n\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}^2 = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} |\\cos(x)\\cos(y)|^2 \\, \\mathrm{d}x\\,\\mathrm{d}y\n$$\n$$\n= \\int_{0}^{2\\pi} \\cos^2(x) \\, \\mathrm{d}x \\int_{0}^{2\\pi} \\cos^2(y) \\, \\mathrm{d}y\n$$\n为了计算该积分，我们使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$：\n$$\n\\int_{0}^{2\\pi} \\cos^2(\\theta) \\, \\mathrm{d}\\theta = \\int_{0}^{2\\pi} \\frac{1}{2}(1 + \\cos(2\\theta)) \\, \\mathrm{d}\\theta = \\frac{1}{2} \\left[ \\theta + \\frac{1}{2}\\sin(2\\theta) \\right]_{0}^{2\\pi} = \\frac{1}{2}(2\\pi - 0) = \\pi\n$$\n因此，范数的平方是：\n$$\n\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}^2 = (\\pi)(\\pi) = \\pi^2\n$$\n范数本身是 $\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)} = \\sqrt{\\pi^2} = \\pi$。\n该值非零，因此缩减因子 $r$ 是良定义的。\n代入分子和分母：\n$$\nr = \\frac{0}{\\pi} = 0\n$$\n缩减因子为 $0$，这表示当精确求解时，投影步完全消除了速度场中的散度，正如理论所要求的那样。\n\n最终答案由数对 $(p(x,y), r)$ 组成。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{2}\\cos(x)\\cos(y) & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在前两个练习概念的基础上，这最后一个练习将引导你使用更真实、更稳健的有限体积法（Finite Volume Method, FVM）进行实现。你将学习如何从通量守恒的基本原理出发，构建压力泊松方程的线性系统，并正确地处理不同类型的边界条件，包括处理纯诺伊曼（Neumann）问题时至关重要但又十分微妙的相容性条件。这个练习是开发实用计算流体动力学（CFD）求解器的关键一步。",
            "id": "3434688",
            "problem": "考虑用于不可压缩投影法的压力泊松方程 (PPE)，该方程建立在一个二维矩形域上，并采用有限体积法在均匀的单元中心网格上进行离散化。其数学模型和数值公式必须从第一性原理出发，以散度定理和控制体上的通量守恒为起点进行推导。控制方程是关于压力场 $p$ 的泊松方程，形式为 $\\nabla^{2} p = f$，定义在矩形域 $\\Omega = [0,L_x] \\times [0,L_y]$ 上，其中 $f$ 是给定的源场。边界表示为 $\\partial \\Omega$，其单位外法向量为 $\\mathbf{n}$。每个边界上都指定了边界条件：狄利克雷条件 $p = p_D$ 或诺伊曼条件 $\\frac{\\partial p}{\\partial n} = g$。目标是通过将诺伊曼项表示为边界面通量，并将边界条件整合到有限体积 PPE 中，同时通过验证全局通量平衡来确保可解性。\n\n你必须基于以下基本原理推导有限体积离散化：\n- 散度定理 (Gauss 定理)：对于足够光滑的向量场 $\\mathbf{q}$，有 $\\int_{\\Omega} \\nabla \\cdot \\mathbf{q}\\, d\\Omega = \\int_{\\partial \\Omega} \\mathbf{q}\\cdot \\mathbf{n}\\, dS$。\n- 拉普拉斯算子的定义，即梯度的散度：$\\nabla^{2} p = \\nabla \\cdot (\\nabla p)$。\n- 每个控制体上的有限体积平衡：所有面上的通量之和等于源项的体积分。\n\n在一个具有 $N_x \\times N_y$ 个矩形控制体的均匀网格上，单元间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$，你必须：\n- 使用单元中心差分除以中心间距，再乘以面面积，来线性近似法向梯度，从而表示穿过每个内部面的离散面通量。这将为每个面产生与 $A/d$ 成正比的系数贡献。\n- 对于狄利克雷边界，将边界面视为一个由面上已知边界值驱动的已知通量项。使用单元中心到边界面之间的距离（单元间距的一半）来定义乘以给定 $p_D$ 的相应 $A/d$ 系数。\n- 对于诺伊曼边界，将边界条件作为面上给定的法向梯度 $\\frac{\\partial p}{\\partial n} = g$ 引入，并将相应的已知通量 $g \\, A$ 加入到相邻边界控制体的方程右侧。\n- 为未知的单元中心壓力值组装最终的线性系统。\n\n对于纯诺伊曼边界条件，必须使用从散度定理导出的积分相容性条件来验证全局可解性。该条件指出，当所有边界均为诺伊曼边界时，源项在整个域上的积分必须等于法向导数在边界上的积分。在均匀网格上的离散形式中，这转化为检查 $f$ 乘以控制体面积之和是否在指定容差内等于 $g$ 乘以边界面长度之和。当存在任何狄利克雷边界时，线性系统应是适定的，无需满足相容性条件；然而，仍应计算并报告全局平衡。\n\n你的程序必须：\n- 根据上述原理和边界条件处理方法，为 PPE 构建有限体积线性系统。\n- 对于纯诺伊曼问题，通过将单个单元的压力约束到指定值（例如，零）来实现规范固定，以移除零空间（常数压力模式），从而为数值计算获得唯一解。在评估原始 PPE 平衡时，用于验证的残差必须排除规范固定的行。\n- 计算并报告全局通量平衡失配值，以及一个布尔值，用于指示在纯诺伊曼边界条件下的可解性。\n- 求解线性系统，并为 PPE 方程计算离散残差范数。\n\n所有量均为无量纲；无需物理单位。\n\n测试套件定义：\n- 使用以下三个测试用例，每个用例由 $(N_x,N_y,L_x,L_y)$、常数源 $f$ 以及西（$x=0$）、东（$x=L_x$）、南（$y=0$）和北（$y=L_y$）边界上的边界条件指定。对于狄利克雷边界，使用常数 $p_D$；对于诺伊曼边界，使用常数 $g$。\n\n1. 正常路径（混合边界条件）：\n    - $N_x = 10$, $N_y = 8$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 0.0$,\n    - 西：狄利克雷 $p_D = 0.0$；东：狄利克雷 $p_D = 1.0$；南：诺伊曼 $g = 0.0$；北：诺伊曼 $g = 0.0$。\n\n2. 纯诺伊曼，全局一致：\n    - $N_x = 12$, $N_y = 12$, $L_x = 1.0$, $L_y = 2.0$,\n    - $f = 3.0$ (常数),\n    - 西：诺伊曼 $g = 0.0$；东：诺伊曼 $g = 0.0$；南：诺伊曼 $g = 2.0$；北：诺伊曼 $g = 4.0$。\n    - 离散全局平衡条件应成立：$\\sum f \\Delta x \\Delta y \\approx \\sum g\\, A_{\\text{face}}$。\n\n3. 纯诺伊曼，全局不一致：\n    - $N_x = 16$, $N_y = 16$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 1.0$ (常数),\n    - 西：诺伊曼 $g = 0.0$；东：诺伊曼 $g = 0.0$；南：诺伊曼 $g = 0.0$；北：诺伊曼 $g = 0.0$。\n    - 离散全局平衡条件应不成立：$\\sum f \\Delta x \\Delta y \\not\\approx \\sum g\\, A_{\\text{face}}$。\n\n输出规范：\n- 对于每个测试用例，生成一个包含三个元素的列表 $[b, m, r]$，其中 $b$ 是一个布尔值，表示可解性（对于纯诺伊曼情况，如果全局平衡在容差范围内成立，则为真；对于混合边界情况，始终为真），$m$ 是一个浮点数，等于绝对失配值 $|\\sum f \\Delta x \\Delta y - \\sum g A_{\\text{face}}|$，$r$ 是一个浮点数，等于原始 PPE 方程的每个单元的离散 $\\ell_2$ 残差范数（对于纯诺伊曼情况，在计算残差范数时排除规范固定的行）。你的程序应生成一行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，格式为 $[[b_1,m_1,r_1],[b_2,m_2,r_2],[b_3,m_3,r_3]]$。\n\n数值容差：\n- 在判断纯诺伊曼情况下的可解性布尔值 $b$ 时，使用 $10^{-10}$ 的平衡容差。",
            "solution": "用户提供的问题被评估为有效。这是一个在数值偏微分方程领域定义明确的问题，具体涉及压力泊松方程 (PPE) 的有限体积离散化。该问题是自包含的，具有科学依据，并为三个不同的测试用例提供了所有必要的数据和边界条件，涵盖了混合边界条件、适定的纯诺伊曼问题和不适定的纯诺伊曼问题。关于从第一性原理推导、边界条件实现和验证的说明清晰且在数学上是合理的。\n\n### 有限体积离散化的推导\n\n控制方程是在二维域 $\\Omega = [0,L_x] \\times [0,L_y]$ 上关于压力 $p(\\mathbf{x})$ 的泊松方程：\n$$ \\nabla^2 p = f $$\n其中 $f$ 是给定的源项。利用恒等式 $\\nabla^2 p = \\nabla \\cdot (\\nabla p)$，我们可以将该方程写成守恒形式。有限体积法首先将此方程在一个以 $(x_i, y_j)$ 为中心的控制体（或单元）$V_{i,j}$ 上进行积分：\n$$ \\int_{V_{i,j}} \\nabla \\cdot (\\nabla p) \\,dV = \\int_{V_{i,j}} f \\,dV $$\n对左侧应用散度定理，将体积分转换为在控制体边界 $\\partial V_{i,j}$ 上的面积分：\n$$ \\oint_{\\partial V_{i,j}} (\\nabla p) \\cdot \\mathbf{n} \\,dS = \\int_{V_{i,j}} f \\,dV $$\n其中 $\\mathbf{n}$ 是表面 $\\partial V_{i,j}$ 上的单位外法向量。\n\n网格是均匀且以单元为中心的，包含 $N_x \\times N_y$ 个单元。单元尺寸为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$，因此单元 $V_{i,j}$ 的体积（在二维中为面积）是 $\\Delta V = \\Delta x \\Delta y$。压力 $p_{i,j}$ 代表单元中心的值。面积分是穿过矩形单元四个面（东、西、南、北）的通量之和：\n$$ F_e + F_w + F_n + F_s = f_{i,j} \\Delta x \\Delta y $$\n其中 $F_k$ 是流出面 $k$ 的总通量。对于一个内部面，例如单元 $(i,j)$ 和 $(i+1,j)$ 之间的东面，通量通过梯度的二阶中心差分来近似：\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS \\approx \\left(\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}\\right) \\Delta y $$\n类似地，一个内部单元其他面上的通量为：\n$$ F_w = \\int_{\\text{west face}} (\\nabla p \\cdot (-\\mathbf{e}_x)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}\\right) \\Delta y $$\n$$ F_n = \\int_{\\text{north face}} (\\nabla p \\cdot \\mathbf{e}_y) \\,dS \\approx \\left(\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}\\right) \\Delta x $$\n$$ F_s = \\int_{\\text{south face}} (\\nabla p \\cdot (-\\mathbf{e}_y)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}\\right) \\Delta x $$\n将这些代入平衡方程，得到拉普拉斯算子的标准五点差分格式：\n$$ \\frac{\\Delta y}{\\Delta x}(p_{i+1,j} - 2p_{i,j} + p_{i-1,j}) + \\frac{\\Delta x}{\\Delta y}(p_{i,j+1} - 2p_{i,j} + p_{i,j-1}) = f_{i,j} \\Delta x \\Delta y $$\n该方程构成了线性系统 $A\\mathbf{p} = \\mathbf{b}$ 中的一行，其中 $\\mathbf{p}$ 是未知的单元中心压力向量。对于一维索引为 $k = j \\cdot N_x + i$ 的内部单元 $(i,j)$：\n- 对角线系数：$A_{k,k} = -2\\left(\\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y}\\right)$\n- 非对角线系数：$A_{k, k\\pm 1} = \\frac{\\Delta y}{\\Delta x}$（对于东/西相邻单元），$A_{k, k\\pm N_x} = \\frac{\\Delta x}{\\Delta y}$（对于南/北相邻单元）。\n- 右侧项：$b_k = f_{i,j} \\Delta x \\Delta y$。\n\n#### 边界条件\n\n对于与域边界相邻的单元，一个或多个通量项必须被修改。\n\n**1. 诺伊曼边界条件**：\n法向导数是给定的，即 $\\frac{\\partial p}{\\partial n} = g$。穿过边界面通量是直接指定的。例如，在东边界（$x=L_x$），外法线为 $\\mathbf{n}=\\mathbf{e}_x$，因此 $\\frac{\\partial p}{\\partial x}=g_e$。流出单元 $(N_x-1, j)$ 东面的通量为：\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS = \\int g_e \\,dS = g_e \\Delta y $$\n这是一个已知值。通量平衡变为 $F_w + F_n + F_s + g_e \\Delta y = f_{N_x-1,j} \\Delta x \\Delta y$。已知通量项移到右侧，因此 $b_k$ 被修改为：$b_k \\rightarrow b_k - g_e \\Delta y$。类似的修改适用于其他诺伊曼边界，需注意外法线的方向。\n\n**2. 狄利克雷边界条件**：\n压力是给定的，即 $p=p_D$。通量通过单元中心与边界之间的单边差分来近似。对于单元 $(N_x-1, j)$ 的东面，该面位于 $x=L_x$，单元中心位于 $x=L_x-\\frac{\\Delta x}{2}$。梯度为 $\\frac{\\partial p}{\\partial x} \\approx \\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}$。通量为：\n$$ F_e = \\left(\\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}\\right) \\Delta y = 2\\frac{\\Delta y}{\\Delta x}(p_D - p_{N_x-1,j}) $$\n该表达式包含未知量 $p_{N_x-1,j}$ 和已知量 $p_D$。包含未知量的项修改了矩阵 $A$ 的对角元素：$A_{k,k} \\rightarrow A_{k,k} - 2\\frac{\\Delta y}{\\Delta x}$。包含已知值的项修改了右侧向量：$b_k \\rightarrow b_k - 2\\frac{\\Delta y}{\\Delta x}p_D$。\n\n### 可解性与规范固定\n\n对于纯诺伊曼问题，矩阵 $A$ 是奇异的，其零空间对应于一个常数压力场（即，如果 $\\mathbf{c}$ 是一个常数向量，则 $A\\mathbf{c} = \\mathbf{0}$）。解存在的充要条件是右侧向量 $\\mathbf{b}$ 与 $A^T$ 的零空间正交。这导致了相容性条件，其连续形式为：\n$$ \\int_{\\Omega} f \\,dV = \\oint_{\\partial \\Omega} \\frac{\\partial p}{\\partial n} \\,dS $$\n在离散形式中，这通过比较所有源项之和与所有给定边界通量之和来检验：\n$$ \\sum_{i,j} f_{i,j} \\Delta x \\Delta y = \\sum_{\\text{bnd faces}} g_k A_k $$\n如果此条件成立，可以通过“规范固定”——即约束一个压力值——来获得唯一解。我们通过将线性系统的第一行修改为 $1 \\cdot p_{0,0} = 0$ 来设定 $p_{0,0}=0$。\n\n### 残差计算\n\n在求解（可能已修改的）系统 $A'\\mathbf{p} = \\mathbf{b}'$ 以找到 $\\mathbf{p}$ 后，通过计算*原始*方程的残差 $\\mathbf{r}_{\\text{vec}} = A\\mathbf{p} - \\mathbf{b}$ 来评估解的质量。然后，每个单元的离散 $\\ell_2$ 范数计算为残差向量分量的均方根 (RMS)。对于纯诺伊曼问题，与规范固定的单元相对应的方程被排除在此计算之外，因为它被人为地改变了。\n$$ r = \\sqrt{\\frac{1}{N_{\\text{eq}}} \\sum_{k \\in \\text{non-gauged}} ( (A\\mathbf{p})_k - b_k )^2} $$\n其中 $N_{\\text{eq}}$ 是求和中的方程数量（对于混合边界条件情况为 $N_x N_y$，对于纯诺伊曼情况为 $N_x N_y - 1$）。",
            "answer": "[[True, 0.0, 4.471649989531862e-16], [True, 0.0, 7.859604313506148e-16], [False, 1.0, 0.0625]]"
        }
    ]
}