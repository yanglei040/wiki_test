{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the Ladyzhenskaya–Babuška–Brezzi (LBB) condition, it's essential to see what happens when it fails. This first exercise provides a classic and insightful demonstration of LBB instability. You will analytically construct a \"checkerboard\" pressure mode for the equal-order bilinear ($Q_1/Q_1$) element pair and prove that it generates a zero response in the core coupling term of the Stokes equations, leading to a breakdown of stability. This hands-on derivation makes the abstract concept of a spurious mode tangible and clear .",
            "id": "3414772",
            "problem": "Consider the incompressible Stokes equations on the square domain $\\Omega=(0,1)^{2}$ with homogeneous Dirichlet boundary conditions for the velocity. Let $\\mathcal{T}_{h}$ be a uniform, axis-aligned, conforming quadrilateral mesh with $n_{x}\\times n_{y}$ vertices, where $n_{x}$ and $n_{y}$ are even integers, and mesh size $h=1/\\max\\{n_{x}-1,n_{y}-1\\}$. Let $S_{h}$ denote the scalar space of continuous, piecewise bilinear ($Q_{1}$) functions on $\\mathcal{T}_{h}$. Define the discrete velocity and pressure spaces by\n$$\nV_{h}=\\left\\{v_{h}=(u_{h},w_{h}) : u_{h}\\in S_{h},\\ w_{h}\\in S_{h},\\ v_{h}|_{\\partial\\Omega}=0\\right\\},\\qquad\nQ_{h}=\\left\\{q_{h}\\in S_{h} : \\int_{\\Omega} q_{h}\\,dx=0\\right\\}.\n$$\nThe mixed formulation couples velocity and pressure via the bilinear form\n$$\nb(v_{h},q_{h})=-\\int_{\\Omega} q_{h}\\,\\nabla\\cdot v_{h}\\,dx.\n$$\nThe Ladyzhenskaya–Babuška–Brezzi (LBB) stability condition requires the existence of a discrete inf–sup constant\n$$\n\\beta_{h}=\\inf_{q_{h}\\in Q_{h}\\setminus\\{0\\}}\\ \\sup_{v_{h}\\in V_{h}\\setminus\\{0\\}}\\ \\frac{b(v_{h},q_{h})}{\\|v_{h}\\|_{H^{1}(\\Omega)}\\,\\|q_{h}\\|_{L^{2}(\\Omega)}}>0,\n$$\nindependent of $h$.\n\nUsing only the definitions above and fundamental properties of tensor-product $Q_{1}$ bases, construct a nonzero “checkerboard” pressure $q_{h}\\in Q_{h}$ whose nodal values alternate in sign across the mesh, and rigorously demonstrate that $b(v_{h},q_{h})=0$ for all $v_{h}\\in V_{h}$ on this uniform quadrilateral mesh. From this, compute the discrete inf–sup constant $\\beta_{h}$ for the equal-order $Q_{1}/Q_{1}$ pair on $\\mathcal{T}_{h}$. Express your final answer as a single real number. No rounding is required and no physical units are involved.",
            "solution": "The problem is valid. It is a well-posed, scientifically grounded problem in the field of numerical analysis for partial differential equations. All definitions are standard and the premises are consistent.\n\nThe solution proceeds in three steps:\n1.  Construction of a specific non-zero pressure function $q_h$ and verification that it belongs to the discrete pressure space $Q_h$.\n2.  A rigorous proof that for this $q_h$, the bilinear form $b(v_h, q_h)$ is zero for all functions $v_h$ in the discrete velocity space $V_h$.\n3.  Deduction of the value of the discrete inf-sup constant $\\beta_h$ from the preceding results.\n\nLet the nodes of the uniform quadrilateral mesh $\\mathcal{T}_h$ be denoted by $(x_i, y_j)$, where $x_i = i h_x$ for $i \\in \\{0, 1, \\dots, n_x-1\\}$ and $y_j = j h_y$ for $j \\in \\{0, 1, \\dots, n_y-1\\}$. The element dimensions are $h_x = 1/(n_x-1)$ and $h_y = 1/(n_y-1)$.\n\nStep 1: Construct the checkerboard pressure mode $q_h$.\nWe define a function $q_h \\in S_h$ by prescribing its nodal values. Let $\\phi_{ij}(x,y)$ be the standard $Q_1$ basis function associated with the node $(x_i, y_j)$. We define $q_h$ as:\n$$\nq_h(x,y) = \\sum_{i=0}^{n_x-1} \\sum_{j=0}^{n_y-1} (-1)^{i+j} \\phi_{ij}(x,y).\n$$\nThe nodal value of $q_h$ at $(x_i, y_j)$ is thus $(-1)^{i+j}$. Since not all nodal values are zero, $q_h$ is a non-zero function in $S_h$.\n\nTo show that $q_h \\in Q_h$, we must verify that its integral over $\\Omega$ is zero. We will show a stronger result: the integral of $q_h$ over any single element $K \\in \\mathcal{T}_h$ is zero.\nConsider an arbitrary element $K_{kl} = [x_k, x_{k+1}] \\times [y_l, y_{l+1}]$ for $k \\in \\{0, \\dots, n_x-2\\}$ and $l \\in \\{0, \\dots, n_y-2\\}$. On this element, $q_h$ is a bilinear polynomial determined by its four nodal values at the corners:\n$q_h(x_k, y_l) = (-1)^{k+l}$\n$q_h(x_{k+1}, y_l) = (-1)^{k+1+l} = -(-1)^{k+l}$\n$q_h(x_k, y_{l+1}) = (-1)^{k+l+1} = -(-1)^{k+l}$\n$q_h(x_{k+1}, y_{l+1}) = (-1)^{k+1+l+1} = (-1)^{k+l}$.\nLet $(\\xi, \\eta)$ be the local coordinates on the reference element $[0,1]^2$, where $\\xi = (x-x_k)/h_x$ and $\\eta = (y-y_l)/h_y$. The function $q_h$ on $K_{kl}$ can be written as:\n$$\nq_h(\\xi, \\eta) = (-1)^{k+l} \\left[ (1-\\xi)(1-\\eta) - \\xi(1-\\eta) - (1-\\xi)\\eta + \\xi\\eta \\right] = (-1)^{k+l} (1-2\\xi)(1-2\\eta).\n$$\nThe integral of $q_h$ over $K_{kl}$ is:\n$$\n\\int_{K_{kl}} q_h \\,dx\\,dy = \\int_0^1 \\int_0^1 (-1)^{k+l} (1-2\\xi)(1-2\\eta) h_x h_y \\,d\\xi\\,d\\eta.\n$$\nThis integral can be separated:\n$$\n\\int_{K_{kl}} q_h \\,dx\\,dy = (-1)^{k+l} h_x h_y \\left( \\int_0^1 (1-2\\xi) \\,d\\xi \\right) \\left( \\int_0^1 (1-2\\eta) \\,d\\eta \\right).\n$$\nThe value of each integral is $\\int_0^1 (1-2t) \\,dt = [t-t^2]_0^1 = 1-1=0$.\nTherefore, $\\int_{K_{kl}} q_h \\,dx\\,dy = 0$. Since this holds for every element $K_{kl} \\in \\mathcal{T}_h$, we have:\n$$\n\\int_{\\Omega} q_h \\,dx = \\sum_{K \\in \\mathcal T_h} \\int_K q_h \\,dx = 0.\n$$\nThus, $q_h$ is a non-zero function in $Q_h$. Note that this result is independent of the condition that $n_x$ and $n_y$ are even.\n\nStep 2: Show that $b(v_h, q_h) = 0$ for all $v_h \\in V_h$.\nThe bilinear form is $b(v_h, q_h) = -\\int_{\\Omega} q_h \\nabla \\cdot v_h \\,dx$. Applying integration by parts (Green's first identity):\n$$\nb(v_h, q_h) = -\\int_{\\partial\\Omega} q_h (v_h \\cdot n) \\,ds + \\int_{\\Omega} \\nabla q_h \\cdot v_h \\,dx.\n$$\nSince $v_h \\in V_h$, we have $v_h|_{\\partial\\Omega}=0$, so the boundary integral vanishes. We are left with showing that $\\int_{\\Omega} \\nabla q_h \\cdot v_h \\,dx = 0$.\nAny function $v_h = (u_h, w_h) \\in V_h$ can be expressed as a linear combination of the vector basis functions. The basis for $V_h$ is given by $\\{ (\\phi_{ij}, 0), (0, \\phi_{ij}) \\}_{i,j \\text{ interior}}$, where $(i,j \\text{ interior})$ means $i \\in \\{1,\\dots,n_x-2\\}$ and $j \\in \\{1,\\dots,n_y-2\\}$. By linearity, it is sufficient to show that the integral is zero for each of these basis functions.\n\nLet's first test the basis function $(\\phi_{ij}, 0)$ for an interior node $(i,j)$:\n$$\nb((\\phi_{ij}, 0), q_h) = \\int_{\\Omega} \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dx\\,dy.\n$$\nThe support of the basis function $\\phi_{ij}$ is the union of the four elements that meet at node $(x_i, y_j)$: $K_{i-1,j-1}$, $K_{i,j-1}$, $K_{i-1,j}$, and $K_{i,j}$. We compute the integral over each of these elements.\nOn an element $K_{kl}$, we found $\\frac{\\partial q_h}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ (-1)^{k+l}(1-2\\xi)(1-2\\eta) \\right] = (-1)^{k+l} (-2/h_x) (1-2\\eta)$.\nThe integral is evaluated in local coordinates $(\\xi, \\eta) \\in [0,1]^2$.\n\n- On $K_{i,j}$ (node $(i,j)$ is bottom-left): $\\phi_{ij}$ corresponds to $(1-\\xi)(1-\\eta)$.\n$$ \\int_{K_{i,j}}\\!\\! \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dxdy = \\int_0^1\\!\\!\\int_0^1 \\! \\frac{-2(-1)^{i+j}}{h_x}(1-2\\eta) (1-\\xi)(1-\\eta) h_x h_y d\\xi d\\eta = -2(-1)^{i+j}h_y \\left(\\int_0^1 (1-\\xi)d\\xi\\right)\\left(\\int_0^1 (1-2\\eta)(1-\\eta)d\\eta\\right) = -2(-1)^{i+j}h_y\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{6}\\right) = -\\frac{(-1)^{i+j}h_y}{6}. $$\n- On $K_{i-1,j}$ (node $(i,j)$ is bottom-right): $\\phi_{ij}$ corresponds to $\\xi(1-\\eta)$.\n$$ \\int_{K_{i-1,j}}\\!\\! \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dxdy = \\int_0^1\\!\\!\\int_0^1 \\! \\frac{-2(-1)^{i-1+j}}{h_x}(1-2\\eta) \\xi(1-\\eta) h_x h_y d\\xi d\\eta = -2(-1)^{i-1+j}h_y \\left(\\int_0^1 \\xi d\\xi\\right)\\left(\\int_0^1 (1-2\\eta)(1-\\eta)d\\eta\\right) = -2(-1)^{i-1+j}h_y\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{6}\\right) = +\\frac{(-1)^{i+j}h_y}{6}. $$\n- On $K_{i,j-1}$ (node $(i,j)$ is top-left): $\\phi_{ij}$ corresponds to $(1-\\xi)\\eta$.\n$$ \\int_{K_{i,j-1}}\\!\\! \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dxdy = \\int_0^1\\!\\!\\int_0^1 \\! \\frac{-2(-1)^{i+j-1}}{h_x}(1-2\\eta) (1-\\xi)\\eta h_x h_y d\\xi d\\eta = -2(-1)^{i+j-1}h_y \\left(\\int_0^1 (1-\\xi)d\\xi\\right)\\left(\\int_0^1 (1-2\\eta)\\eta d\\eta\\right) = -2(-1)^{i+j-1}h_y\\left(\\frac{1}{2}\\right)\\left(-\\frac{1}{6}\\right) = -\\frac{(-1)^{i+j}h_y}{6}. $$\n- On $K_{i-1,j-1}$ (node $(i,j)$ is top-right): $\\phi_{ij}$ corresponds to $\\xi\\eta$.\n$$ \\int_{K_{i-1,j-1}}\\!\\! \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dxdy = \\int_0^1\\!\\!\\int_0^1 \\! \\frac{-2(-1)^{i-1+j-1}}{h_x}(1-2\\eta) \\xi\\eta h_x h_y d\\xi d\\eta = -2(-1)^{i+j}h_y \\left(\\int_0^1 \\xi d\\xi\\right)\\left(\\int_0^1 (1-2\\eta)\\eta d\\eta\\right) = -2(-1)^{i+j}h_y\\left(\\frac{1}{2}\\right)\\left(-\\frac{1}{6}\\right) = +\\frac{(-1)^{i+j}h_y}{6}. $$\nSumming the contributions from the four elements:\n$$ b((\\phi_{ij}, 0), q_h) = \\sum_{K} \\int_K \\frac{\\partial q_h}{\\partial x} \\phi_{ij} \\,dx\\,dy = (-1)^{i+j}h_y \\left(-\\frac{1}{6} + \\frac{1}{6} - \\frac{1}{6} + \\frac{1}{6}\\right) = 0. $$\nBy symmetry of the problem, a similar calculation for the basis function $(0, \\phi_{ij})$ yields $b((0, \\phi_{ij}), q_h) = \\int_{\\Omega} \\frac{\\partial q_h}{\\partial y} \\phi_{ij} \\,dx\\,dy = 0$.\nSince $b(v, q_h)$ is zero for all basis functions of $V_h$, by linearity it is zero for all $v_h \\in V_h$.\n\nStep 3: Compute the discrete inf-sup constant $\\beta_h$.\nThe discrete inf-sup constant is defined as:\n$$\n\\beta_h = \\inf_{p_h \\in Q_h \\setminus \\{0\\}} \\sup_{v_h \\in V_h \\setminus \\{0\\}} \\frac{b(v_h,p_h)}{\\|v_h\\|_{H^1(\\Omega)}\\,\\|p_h\\|_{L^2(\\Omega)}}.\n$$\nThe infimum is taken over all non-zero functions in the discrete pressure space $Q_h$. We have constructed a specific non-zero function, the checkerboard mode $q_h$, which belongs to $Q_h$. Therefore, the infimum must be less than or equal to the value of the expression for this specific $q_h$:\n$$\n\\beta_h \\le \\sup_{v_h\\in V_h\\setminus\\{0\\}}\\ \\frac{b(v_h, q_h)}{\\|v_h\\|_{H^{1}(\\Omega)}\\,\\|q_h\\|_{L^{2}(\\Omega)}}.\n$$\nIn Step 2, we proved that $b(v_h, q_h) = 0$ for all $v_h \\in V_h$. Substituting this into the expression above:\n$$\n\\sup_{v_h\\in V_h\\setminus\\{0\\}}\\ \\frac{0}{\\|v_h\\|_{H^{1}(\\Omega)}\\,\\|q_h\\|_{L^{2}(\\Omega)}} = 0.\n$$\nThis shows that $\\beta_h \\le 0$.\nBy definition, for any $p_h \\in Q_h$, the term $b(v_h, p_h)$ can be positive or negative, but the supremum $\\sup_{v_h} b(v_h, p_h)$ will be non-negative (we can always choose $v_h$ to have the \"right\" sign, or $v_h=0$). More formally, the term inside the infimum is a quotient of a supremum and norms, which must be non-negative. The infimum of a set of non-negative numbers must also be non-negative. Thus, $\\beta_h \\ge 0$.\n\nCombining the two inequalities, $\\beta_h \\le 0$ and $\\beta_h \\ge 0$, we are forced to conclude that $\\beta_h = 0$. This demonstrates the instability of the equal-order $Q_1/Q_1$ finite element pair for the Stokes equations.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "After diagnosing instability, the next logical step is to explore a cure. This practice examines one of the most common stabilization techniques: the grad-div method. By working within a simplified and idealized algebraic setting, you can isolate the effect of the stabilization parameter $\\gamma$ and derive a closed-form expression for the resulting LBB constant. This exercise provides a sharp theoretical lens through which to understand how stabilization works and to appreciate the subtleties involved in tuning its strength .",
            "id": "3414768",
            "problem": "Consider the stationary incompressible Stokes equations on a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^{2}$ with homogeneous Dirichlet boundary conditions for the velocity. Let $\\nu>0$ denote the viscosity. The mixed finite element method seeks $(u_{h},p_{h}) \\in V_{h} \\times Q_{h}$ satisfying the discrete saddle-point system with bilinear forms\n$$a(u_{h},v_{h}) := \\nu \\int_{\\Omega} \\nabla u_{h} : \\nabla v_{h} \\,\\mathrm{d}x, $$\n$$b(v_{h},q_{h}) := - \\int_{\\Omega} q_{h} \\,\\nabla \\cdot v_{h} \\,\\mathrm{d}x,$$\nand a grad-div stabilization term\n$$s_{\\gamma}(u_{h},v_{h}) := \\gamma \\int_{\\Omega} (\\nabla \\cdot u_{h}) (\\nabla \\cdot v_{h}) \\,\\mathrm{d}x,$$\nwhere $\\gamma \\ge 0$ is a stabilization parameter. The velocity norm is defined by\n$$\\|v_{h}\\|_{\\gamma}^{2} := \\nu \\int_{\\Omega} |\\nabla v_{h}|^{2} \\,\\mathrm{d}x + \\gamma \\int_{\\Omega} |\\nabla \\cdot v_{h}|^{2} \\,\\mathrm{d}x,$$\nand the pressure norm is $\\|q_{h}\\|_{Q} := \\left( \\int_{\\Omega} |q_{h}|^{2} \\,\\mathrm{d}x \\right)^{1/2}$.\n\nThe Ladyzhenskaya–Babuška–Brezzi (LBB) discrete inf-sup constant associated with this stabilized formulation is\n$$\n\\beta_{h}(\\gamma) := \\inf_{q_{h} \\in Q_{h} \\setminus \\{0\\}} \\; \\sup_{v_{h} \\in V_{h} \\setminus \\{0\\}} \\; \\frac{b(v_{h},q_{h})}{\\|v_{h}\\|_{\\gamma} \\, \\|q_{h}\\|_{Q}}.\n$$\n\nAssume the following simplified but internally consistent algebraic setting that isolates the effect of grad-div stabilization: let $Q_{h} = \\mathrm{span}\\{q_{1}\\}$ be one-dimensional with $\\|q_{1}\\|_{Q} = 1$, and let $V_{h} = \\mathrm{span}\\{v_{1},v_{2}\\}$ be two-dimensional. Suppose the bases are mutually orthogonal with respect to both the gradient inner product and the divergence inner product, namely,\n$$\n\\int_{\\Omega} \\nabla v_{i} : \\nabla v_{j} \\,\\mathrm{d}x = a_{i} \\, \\delta_{ij},\n$$\n$$\n\\int_{\\Omega} (\\nabla \\cdot v_{i}) \\, (\\nabla \\cdot v_{j}) \\,\\mathrm{d}x = d_{i} \\, \\delta_{ij},\n$$\nwith given constants $a_{1},a_{2} > 0$ and $d_{1},d_{2} \\ge 0$. Denote the pressure-velocity coupling coefficients by\n$$\n\\beta_{i} := - \\int_{\\Omega} q_{1} \\, (\\nabla \\cdot v_{i}) \\,\\mathrm{d}x,\n$$\nfor $i=1,2$.\n\nUnder these assumptions, the effective discrete LBB constant reduces to a supremum over $V_{h}$ for the single pressure direction $q_{1}$. Starting from the core definitions above, derive a closed-form analytic expression for $\\beta_{h}(\\gamma)$ in terms of $\\nu$, $\\gamma$, $a_{1}$, $a_{2}$, $d_{1}$, $d_{2}$, $\\beta_{1}$, and $\\beta_{2}$. Express your final answer as a single closed-form expression for $\\beta_{h}(\\gamma)$; no numerical rounding is required. Additionally, in your derivation, interpret the limit $\\gamma \\to \\infty$ in relation to pressure-robustness, but the final answer must be the expression for $\\beta_{h}(\\gamma)$ itself.",
            "solution": "The problem is assessed to be valid as it represents a well-posed, self-contained, and scientifically grounded exercise in the theory of numerical analysis for partial differential equations. All definitions and assumptions are provided and are internally consistent.\n\nThe objective is to derive a closed-form expression for the discrete Ladyzhenskaya–Babuška–Brezzi (LBB) inf-sup constant $\\beta_{h}(\\gamma)$ for a given simplified finite element setting.\n\nThe LBB constant is defined as:\n$$\n\\beta_{h}(\\gamma) := \\inf_{q_{h} \\in Q_{h} \\setminus \\{0\\}} \\; \\sup_{v_{h} \\in V_{h} \\setminus \\{0\\}} \\; \\frac{b(v_{h},q_{h})}{\\|v_{h}\\|_{\\gamma} \\, \\|q_{h}\\|_{Q}}\n$$\nThe problem specifies that the pressure space $Q_{h}$ is one-dimensional, spanned by a single basis function $q_{1}$ with $\\|q_{1}\\|_{Q} = 1$. Any element $q_{h} \\in Q_{h}$ can be written as $q_{h} = c q_{1}$ for some scalar $c \\in \\mathbb{R}$. The norm is $\\|q_{h}\\|_{Q} = |c| \\|q_{1}\\|_{Q} = |c|$. The bilinear form $b(v_{h}, q_{h}) = b(v_{h}, c q_{1}) = c \\, b(v_{h}, q_{1})$.\nSubstituting these into the definition, the scalar $c$ cancels out:\n$$\n\\frac{b(v_{h},q_{h})}{\\|q_{h}\\|_{Q}} = \\frac{c \\, b(v_{h},q_{1})}{|c|} = \\mathrm{sgn}(c) \\, b(v_{h},q_{1})\n$$\nThe infimum over $Q_{h} \\setminus \\{0\\}$ (all non-zero $c$) means we can simply fix $q_{h} = q_{1}$ (i.e., $c=1$) without loss of generality. The definition of $\\beta_{h}(\\gamma)$ thus simplifies to a single supremum over the velocity space $V_{h}$:\n$$\n\\beta_{h}(\\gamma) = \\sup_{v_{h} \\in V_{h} \\setminus \\{0\\}} \\; \\frac{b(v_{h},q_{1})}{\\|v_{h}\\|_{\\gamma}}\n$$\nThe velocity space is two-dimensional, $V_{h} = \\mathrm{span}\\{v_{1}, v_{2}\\}$. An arbitrary velocity field $v_{h} \\in V_{h}$ can be expressed as a linear combination $v_{h} = c_{1} v_{1} + c_{2} v_{2}$ for coefficients $(c_{1}, c_{2}) \\in \\mathbb{R}^{2} \\setminus \\{(0,0)\\}$.\n\nWe now express the numerator and the denominator of the fraction in terms of $c_{1}$ and $c_{2}$.\n\nThe numerator is $b(v_{h}, q_{1})$. Using linearity and the provided definitions:\n$$\nb(v_{h}, q_{1}) = b(c_{1}v_{1} + c_{2}v_{2}, q_{1}) = c_{1} b(v_{1}, q_{1}) + c_{2} b(v_{2}, q_{1})\n$$\nThe problem defines $b(v_{h},q_{h}) = - \\int_{\\Omega} q_{h} \\,\\nabla \\cdot v_{h} \\,\\mathrm{d}x$ and the coupling coefficients $\\beta_{i} := - \\int_{\\Omega} q_{1} \\, (\\nabla \\cdot v_{i}) \\,\\mathrm{d}x$. Thus, $b(v_{i}, q_{1}) = \\beta_{i}$.\nThe numerator becomes a simple dot product:\n$$\nb(v_{h}, q_{1}) = c_{1}\\beta_{1} + c_{2}\\beta_{2}\n$$\n\nThe denominator is $\\|v_{h}\\|_{\\gamma}$, whose square is defined as $\\|v_{h}\\|_{\\gamma}^{2} = \\nu \\int_{\\Omega} |\\nabla v_{h}|^{2} \\,\\mathrm{d}x + \\gamma \\int_{\\Omega} |\\nabla \\cdot v_{h}|^{2} \\,\\mathrm{d}x$. We evaluate each term using the basis expansion $v_{h} = c_{1}v_{1} + c_{2}v_{2}$.\nThe first term involves:\n$$\n\\int_{\\Omega} |\\nabla v_{h}|^{2} \\,\\mathrm{d}x = \\int_{\\Omega} \\nabla(c_{1}v_{1} + c_{2}v_{2}) : \\nabla(c_{1}v_{1} + c_{2}v_{2}) \\,\\mathrm{d}x \\\\\n= \\int_{\\Omega} (c_{1}^{2} \\nabla v_{1}:\\nabla v_{1} + 2c_{1}c_{2} \\nabla v_{1}:\\nabla v_{2} + c_{2}^{2} \\nabla v_{2}:\\nabla v_{2}) \\,\\mathrm{d}x\n$$\nUsing the orthogonality condition $\\int_{\\Omega} \\nabla v_{i} : \\nabla v_{j} \\,\\mathrm{d}x = a_{i} \\, \\delta_{ij}$:\n$$\nc_{1}^{2} \\int_{\\Omega} \\nabla v_{1}:\\nabla v_{1} \\,\\mathrm{d}x + c_{2}^{2} \\int_{\\Omega} \\nabla v_{2}:\\nabla v_{2} \\,\\mathrm{d}x = c_{1}^{2} a_{1} + c_{2}^{2} a_{2}\n$$\nThe second term involves:\n$$\n\\int_{\\Omega} |\\nabla \\cdot v_{h}|^{2} \\,\\mathrm{d}x = \\int_{\\Omega} (\\nabla \\cdot (c_{1}v_{1} + c_{2}v_{2}))^{2} \\,\\mathrm{d}x \\\\\n= \\int_{\\Omega} (c_{1}^{2} (\\nabla \\cdot v_{1})^{2} + 2c_{1}c_{2} (\\nabla \\cdot v_{1})(\\nabla \\cdot v_{2}) + c_{2}^{2} (\\nabla \\cdot v_{2})^{2}) \\,\\mathrm{d}x\n$$\nUsing the orthogonality condition $\\int_{\\Omega} (\\nabla \\cdot v_{i}) (\\nabla \\cdot v_{j}) \\,\\mathrm{d}x = d_{i} \\, \\delta_{ij}$:\n$$\nc_{1}^{2} \\int_{\\Omega} (\\nabla \\cdot v_{1})^{2} \\,\\mathrm{d}x + c_{2}^{2} \\int_{\\Omega} (\\nabla \\cdot v_{2})^{2} \\,\\mathrm{d}x = c_{1}^{2} d_{1} + c_{2}^{2} d_{2}\n$$\nCombining these results, the squared norm is:\n$$\n\\|v_{h}\\|_{\\gamma}^{2} = \\nu(c_{1}^{2} a_{1} + c_{2}^{2} a_{2}) + \\gamma(c_{1}^{2} d_{1} + c_{2}^{2} d_{2}) = c_{1}^{2}(\\nu a_{1} + \\gamma d_{1}) + c_{2}^{2}(\\nu a_{2} + \\gamma d_{2})\n$$\nThe problem now reduces to finding the maximum of the following expression over all non-zero $(c_{1}, c_{2})$:\n$$\n\\beta_{h}(\\gamma) = \\sup_{(c_{1},c_{2}) \\neq (0,0)} \\frac{c_{1}\\beta_{1} + c_{2}\\beta_{2}}{\\sqrt{c_{1}^{2}(\\nu a_{1} + \\gamma d_{1}) + c_{2}^{2}(\\nu a_{2} + \\gamma d_{2})}}\n$$\nThis is a standard maximization problem. Let's introduce a change of variables to simplify the denominator:\nLet $\\tilde{c}_{1} = c_{1}\\sqrt{\\nu a_{1} + \\gamma d_{1}}$ and $\\tilde{c}_{2} = c_{2}\\sqrt{\\nu a_{2} + \\gamma d_{2}}$.\nThis implies $c_{1} = \\frac{\\tilde{c}_{1}}{\\sqrt{\\nu a_{1} + \\gamma d_{1}}}$ and $c_{2} = \\frac{\\tilde{c}_{2}}{\\sqrt{\\nu a_{2} + \\gamma d_{2}}}$.\nThe expression to be maximized becomes:\n$$\n\\frac{\\frac{\\tilde{c}_{1}\\beta_{1}}{\\sqrt{\\nu a_{1} + \\gamma d_{1}}} + \\frac{\\tilde{c}_{2}\\beta_{2}}{\\sqrt{\\nu a_{2} + \\gamma d_{2}}}}{\\sqrt{\\tilde{c}_{1}^{2} + \\tilde{c}_{2}^{2}}}\n$$\nThis expression is of the form $\\frac{\\mathbf{w} \\cdot \\tilde{\\mathbf{c}}}{\\|\\tilde{\\mathbf{c}}\\|}$, where $\\tilde{\\mathbf{c}} = (\\tilde{c}_{1}, \\tilde{c}_{2})$ and $\\mathbf{w}$ is the constant vector:\n$$\n\\mathbf{w} = \\left(\\frac{\\beta_{1}}{\\sqrt{\\nu a_{1} + \\gamma d_{1}}}, \\frac{\\beta_{2}}{\\sqrt{\\nu a_{2} + \\gamma d_{2}}}\\right)\n$$\nBy the Cauchy-Schwarz inequality, the supremum of this expression is $\\|\\mathbf{w}\\|$. Therefore, $\\beta_{h}(\\gamma) = \\|\\mathbf{w}\\|$.\n$$\n\\beta_{h}(\\gamma) = \\sqrt{\\left(\\frac{\\beta_{1}}{\\sqrt{\\nu a_{1} + \\gamma d_{1}}}\\right)^{2} + \\left(\\frac{\\beta_{2}}{\\sqrt{\\nu a_{2} + \\gamma d_{2}}}\\right)^{2}}\n$$\nThis yields the final closed-form expression:\n$$\n\\beta_{h}(\\gamma) = \\sqrt{\\frac{\\beta_{1}^{2}}{\\nu a_{1} + \\gamma d_{1}} + \\frac{\\beta_{2}^{2}}{\\nu a_{2} + \\gamma d_{2}}}\n$$\nAs a consistency check, note that if $d_{i}=0$, meaning $\\nabla \\cdot v_{i}=0$, then $\\beta_{i} = -\\int q_1 (\\nabla \\cdot v_i) dx = 0$. In this case, the term $\\beta_i^2 / (\\nu a_i + \\gamma d_i)$ becomes $0/(\\nu a_i) = 0$, which is correct.\n\nFinally, we interpret the limit $\\gamma \\to \\infty$ in relation to pressure-robustness.\nThe derived expression for $\\beta_{h}(\\gamma)$ shows that for any basis function $v_{i}$ with $d_{i} = \\int (\\nabla\\cdot v_i)^2 dx > 0$, the corresponding term $\\frac{\\beta_{i}^{2}}{\\nu a_{i} + \\gamma d_{i}}$ vanishes as $\\gamma \\to \\infty$. If all basis functions have $d_i>0$, then $\\lim_{\\gamma\\to\\infty} \\beta_{h}(\\gamma) = 0$. This indicates that the stability of the discretization deteriorates for very large stabilization parameters, a phenomenon known as locking.\nThe stabilization term $\\gamma \\int (\\nabla\\cdot u_h)(\\nabla\\cdot v_h)dx$ is designed to penalize the divergence of the discrete velocity field. As $\\gamma \\to \\infty$, the method enforces the constraint $\\nabla\\cdot u_h \\approx 0$ very strongly. This mimics a key property of pressure-robust methods, which often work with exactly (or near exactly) divergence-free velocity approximations, thereby decoupling the velocity error from the pressure. However, the LBB constant describes the ability of the velocity space $V_h$ to control the pressure space $Q_h$ via the divergence operator. The norm $\\|v_h\\|_\\gamma$ heavily penalizes velocities with non-zero divergence. Since it is precisely these velocities that are needed for the term $b(v_h, q_h)=-\\int q_h (\\nabla\\cdot v_h)dx$ to be non-zero, the ratio in the LBB definition shrinks. The simplified model demonstrates that naively taking $\\gamma \\to \\infty$ with a general-purpose finite element space $V_h$ can lead to instability, because the subspace of nearly divergence-free functions within $V_h$ may not be sufficiently rich to ensure stability. True pressure-robust methods require specific choices of finite element spaces (like Scott-Vogelius) where the discrete divergence-free subspace has good approximation properties.",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\beta_{1}^{2}}{\\nu a_{1} + \\gamma d_{1}} + \\frac{\\beta_{2}^{2}}{\\nu a_{2} + \\gamma d_{2}}}}$$"
        },
        {
            "introduction": "This final practice bridges the gap between abstract theory and computational reality. The LBB condition, while defined analytically, can be quantified numerically by solving a generalized eigenvalue problem. This exercise guides you through the derivation that connects the inf-sup constant $\\beta_h$ to the smallest non-zero eigenvalue of the discrete system. You will then implement a program to assemble the finite element matrices and perform this calculation, allowing you to computationally verify the instability of the $P_1/P_1$ pair and the stability of the Taylor-Hood ($P_2/P_1$) pair firsthand .",
            "id": "3414744",
            "problem": "Consider the mixed finite element discretization of an incompressible Stokes-type system on the unit square domain, where the discrete inf-sup (Ladyzhenskaya–Babuška–Brezzi (LBB)) constant $\\beta_h$ is defined for discrete velocity and pressure spaces $(V_h,Q_h)$ by the Rayleigh-quotient characterization\n$$\n\\beta_h \\;=\\; \\inf_{q_h \\in Q_h\\setminus\\{0\\}} \\; \\sup_{v_h \\in V_h\\setminus\\{0\\}} \\; \\frac{b(v_h,q_h)}{\\|v_h\\|_V\\,\\|q_h\\|_Q},\n$$\nwith the bilinear form $b(v_h,q_h) = \\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega$, the velocity norm $\\|v_h\\|_V$ induced by the $H^1$ inner product, and the pressure norm $\\|q_h\\|_Q$ induced by the $L^2$ inner product. Assume homogeneous Dirichlet boundary conditions for the velocity so that the $H^1$ seminorm defines a proper norm on $V_h$.\n\nWork on a conforming triangular mesh generated by splitting each quadrilateral cell of a uniform Cartesian grid into two triangles with consistent orientation. Let the pressure space $Q_h$ be continuous piecewise linear on triangle vertices. Let the velocity space $V_h$ be either:\n- equal-order piecewise linear (denoted $P_1/P_1$), with velocity basis functions equal to the pressure basis functions on vertices and zero velocity on the boundary by eliminating boundary degrees of freedom;\n- Taylor–Hood ($P_2/P_1$), with quadratic velocity basis functions defined on triangle vertices and mid-edge nodes, pressure as above, and zero velocity on boundary by eliminating velocity degrees of freedom associated to boundary vertices and boundary edges.\n\nFrom the discrete viewpoint, the bilinear form $b(v_h,q_h)$ induces the discrete divergence operator $B \\in \\mathbb{R}^{n_p \\times n_v}$ via\n$$\nq_h^\\top\\, B \\, v_h \\;=\\; b(v_h,q_h) \\;=\\; \\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega,\n$$\nwhere $n_p$ and $n_v$ are the numbers of pressure and velocity degrees of freedom, respectively. The velocity $H^1$ inner product induces the symmetric positive-definite stiffness matrix $K \\in \\mathbb{R}^{n_v \\times n_v}$, with entries\n$$\nK_{ij} \\;=\\; \\int_\\Omega \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\Omega,\n$$\nwhere $\\phi_i$ are the scalar velocity basis functions for a single component, and the full velocity matrix is the block diagonal of two identical copies (for the two components). The pressure $L^2$ inner product induces the symmetric positive-definite mass matrix $M_p \\in \\mathbb{R}^{n_p \\times n_p}$ with entries\n$$\n(M_p)_{ij} \\;=\\; \\int_\\Omega \\psi_i \\, \\psi_j \\, d\\Omega,\n$$\nwhere $\\psi_i$ are the pressure basis functions.\n\nStarting from the fundamental characterization that the supremum over $v_h$ can be expressed by the Riesz representation in the velocity norm, derive and implement the discrete generalized eigenvalue problem\n$$\nB\\,K^{-1}\\,B^\\top\\, q \\;=\\; \\lambda \\, M_p \\, q,\n$$\nand show that the discrete LBB constant satisfies\n$$\n\\beta_h \\;=\\; \\sqrt{\\lambda_{\\min}^+},\n$$\nwhere $\\lambda_{\\min}^+$ is the smallest strictly positive generalized eigenvalue of the pair $(B\\,K^{-1}\\,B^\\top,\\, M_p)$.\n\nImplementation details and constraints:\n- Mesh: a uniform $(n_x \\times n_y)$ grid over the unit square, each cell split into two triangles. Use vertex-based continuous piecewise linear basis for pressure on triangle vertices. For velocity, use either piecewise linear basis on vertices ($P_1/P_1$) or quadratic basis on vertices and mid-edge nodes ($P_2/P_1$). Eliminate velocity degrees of freedom on the boundary to enforce homogeneous Dirichlet conditions.\n- Shape functions:\n  - For $P_1$, use barycentric coordinates $\\lambda_1,\\lambda_2,\\lambda_3$ with constant gradients on each triangle.\n  - For $P_2$, use the six standard quadratic Lagrange shape functions on triangles expressed in barycentric coordinates:\n    $N_1=\\lambda_1(2\\lambda_1-1)$, $N_2=\\lambda_2(2\\lambda_2-1)$, $N_3=\\lambda_3(2\\lambda_3-1)$, $N_4=4\\lambda_1\\lambda_2$, $N_5=4\\lambda_2\\lambda_3$, $N_6=4\\lambda_3\\lambda_1$, with gradients computed via the chain rule from the constant gradients of $\\lambda_i$.\n- Quadrature: use the three-point degree-2 symmetric quadrature rule on triangles, with barycentric coordinates $(\\frac{2}{3},\\frac{1}{6},\\frac{1}{6})$, $(\\frac{1}{6},\\frac{2}{3},\\frac{1}{6})$, $(\\frac{1}{6},\\frac{1}{6},\\frac{2}{3})$, each with weight $\\frac{A}{3}$ on a triangle of area $A$.\n- Assembly:\n  - Assemble $K$ (for a single component) from $\\int \\nabla \\phi_i \\cdot \\nabla \\phi_j$; the full velocity stiffness is block diagonal with two identical copies.\n  - Assemble $M_p$ from $\\int \\psi_i \\psi_j$.\n  - Assemble $B$ from $\\int \\partial_\\alpha \\psi_i \\, \\phi_j$ for $\\alpha \\in \\{x,y\\}$, concatenating the component blocks horizontally to form $B \\in \\mathbb{R}^{n_p \\times 2 n_v^{\\text{base}}}$.\n- Eigenproblem: compute the generalized eigenvalues of $(B K^{-1} B^\\top, M_p)$, discard eigenvalues below a small tolerance (e.g., $10^{-8}$), and take $\\beta_h$ to be the square root of the smallest remaining eigenvalue.\n\nYour program must implement this assembly and eigen-analysis for the following test suite of parameter values (element family, $n_x$, $n_y$):\n1. $P_1/P_1$, $n_x=2$, $n_y=2$.\n2. $P_2/P_1$, $n_x=2$, $n_y=2$.\n3. $P_1/P_1$, $n_x=3$, $n_y=2$.\n4. $P_2/P_1$, $n_x=3$, $n_y=3$.\n\nAll angles are purely geometric and do not require units. There are no physical units in this problem. Your program should produce a single line of output containing the results as a comma-separated list of decimal floats rounded to six decimal places, enclosed in square brackets, in the order of the above test suite (e.g., \"[0.123456,0.234567,0.345678,0.456789]\").",
            "solution": "The problem is valid as it is scientifically grounded in the theory of mixed finite element methods, is well-posed, objective, and provides a complete and consistent set of specifications for its implementation. We will first derive the specified generalized eigenvalue problem from the definition of the discrete LBB constant, and then proceed to the numerical implementation.\n\nThe discrete LBB (or inf-sup) constant, $\\beta_h$, is defined by a Rayleigh-quotient-like structure:\n$$\n\\beta_h = \\inf_{q_h \\in Q_h\\setminus\\{0\\}} \\sup_{v_h \\in V_h\\setminus\\{0\\}} \\frac{b(v_h, q_h)}{\\|v_h\\|_V \\|q_h\\|_Q}\n$$\nwhere $b(v_h, q_h) = \\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega$. The velocity space $V_h$ is a Hilbert space endowed with the inner product $\\langle u_h, v_h \\rangle_V = \\int_\\Omega \\nabla u_h \\cdot \\nabla v_h \\, d\\Omega$, which induces the norm $\\|v_h\\|_V = \\sqrt{\\langle v_h, v_h \\rangle_V}$. The pressure space $Q_h$ is a Hilbert space with the inner product $\\langle p_h, q_h \\rangle_Q = \\int_\\Omega p_h q_h \\, d\\Omega$, inducing the norm $\\|q_h\\|_Q = \\sqrt{\\langle q_h, q_h \\rangle_Q}$.\n\nLet us analyze the inner supremum term for a fixed non-zero pressure function $q_h \\in Q_h$:\n$$\n\\sup_{v_h \\in V_h\\setminus\\{0\\}} \\frac{b(v_h, q_h)}{\\|v_h\\|_V} = \\sup_{v_h \\in V_h\\setminus\\{0\\}} \\frac{\\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega}{\\|v_h\\|_V}\n$$\nThe numerator, $L_{q_h}(v_h) = \\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega$, is a bounded linear functional on the Hilbert space $V_h$. By the Riesz Representation Theorem, for any such functional, there exists a unique element $w_{q_h} \\in V_h$ such that for all $v_h \\in V_h$:\n$$\nL_{q_h}(v_h) = \\langle w_{q_h}, v_h \\rangle_V \\quad \\implies \\quad \\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega = \\int_\\Omega \\nabla w_{q_h} \\cdot \\nabla v_h \\, d\\Omega\n$$\nThe supremum is then achieved when $v_h$ is chosen to be proportional to $w_{q_h}$, and by the Cauchy-Schwarz inequality, its value is the norm of the Riesz representer:\n$$\n\\sup_{v_h \\in V_h\\setminus\\{0\\}} \\frac{\\langle w_{q_h}, v_h \\rangle_V}{\\|v_h\\|_V} = \\|w_{q_h}\\|_V\n$$\nNow, we express this relationship in terms of the discrete matrix operators. Let $q$ be the vector of coefficients for the pressure function $q_h = \\sum_i q_i \\psi_i$, and let $v$ and $w_q$ be the coefficient vectors for the velocity functions $v_h$ and $w_{q_h}$, respectively. The given matrix definitions are:\n- $q^\\top B v = b(v_h,q_h)$\n- $v^\\top K v = \\|v_h\\|_V^2$\n- $q^\\top M_p q = \\|q_h\\|_Q^2$\n\nThe Riesz representation identity $\\int_\\Omega \\nabla q_h \\cdot v_h \\, d\\Omega = \\int_\\Omega \\nabla w_{q_h} \\cdot \\nabla v_h \\, d\\Omega$ translates to the discrete form for all coefficient vectors $v$:\n$$\nq^\\top B v = w_q^\\top K v\n$$\nSince this holds for any $v$, we must have $q^\\top B = w_q^\\top K$. Transposing both sides yields $B^\\top q = K^\\top w_q$. As the velocity stiffness matrix $K$ is symmetric ($K = K^\\top$), we have $B^\\top q = K w_q$. Since $V_h$ consists of functions that are zero on the boundary, the $H^1$ seminorm is a true norm, and the resulting stiffness matrix $K$ is symmetric positive definite and thus invertible. We can solve for the coefficient vector of the Riesz representer:\n$$\nw_q = K^{-1} B^\\top q\n$$\nThe squared norm of this representer is:\n$$\n\\|w_{q_h}\\|_V^2 = w_q^\\top K w_q = (K^{-1} B^\\top q)^\\top K (K^{-1} B^\\top q) = q^\\top B (K^{-1})^\\top K K^{-1} B^\\top q\n$$\nUsing the symmetry of $K$ (which implies symmetry of $K^{-1}$, i.e., $(K^{-1})^\\top = K^{-1}$), this simplifies to:\n$$\n\\|w_{q_h}\\|_V^2 = q^\\top B K^{-1} B^\\top q\n$$\nSubstituting this back into the definition of $\\beta_h$, we get:\n$$\n\\beta_h^2 = \\inf_{q_h \\in Q_h\\setminus\\{0\\}} \\frac{\\|w_{q_h}\\|_V^2}{\\|q_h\\|_Q^2} = \\inf_{q \\neq 0} \\frac{q^\\top (B K^{-1} B^\\top) q}{q^\\top M_p q}\n$$\nThis is the definition of the minimal value of the Rayleigh quotient for the matrix pencil $(A, M)$ where $A = B K^{-1} B^\\top$ and $M=M_p$. The infimum is therefore the smallest generalized eigenvalue $\\lambda$ of the problem:\n$$\nB K^{-1} B^\\top q = \\lambda M_p q\n$$\nA special consideration is required for the null space of the discrete divergence operator $B^\\top$. For any constant pressure function $q_h = c$, its gradient is zero, so $\\nabla q_h = 0$. This implies $b(v_h, q_h)=0$ for all $v_h$. In the discrete setting, the coefficient vector $q_c$ corresponding to a constant pressure lies in the null space of $B^\\top$, i.e., $B^\\top q_c = 0$. Consequently, $B K^{-1} B^\\top q_c = 0$, which means that $\\lambda = 0$ is always a generalized eigenvalue. This eigenvalue is an artifact of the physics (pressure is only defined up to a constant) and does not reflect the stability of the discretization for non-constant pressures. The LBB condition is concerned with the stability of the coupling for the parts of the pressure space that are not in this null space. Therefore, we must seek the smallest strictly positive eigenvalue, $\\lambda_{\\min}^+$.\nTaking the square root gives the final relation:\n$$\n\\beta_h = \\sqrt{\\lambda_{\\min}^+}\n$$\nThis completes the derivation. The implementation will now proceed to construct the matrices $K$, $B$, and $M_p$ and solve this generalized eigenvalue problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef compute_lbb(family, nx, ny):\n    \"\"\"\n    Computes the LBB constant for a given finite element family and mesh size.\n    \"\"\"\n    # 1. MESH and DOF GENERATION\n    \n    # Pressure DOFs (P1) are always at the vertices of the coarse grid\n    p_nodes_x = nx + 1\n    p_nodes_y = ny + 1\n    n_p = p_nodes_x * p_nodes_y\n    p_coords = np.array([[i / nx, j / ny] for j in range(p_nodes_y) for i in range(p_nodes_x)])\n\n    if family == 'P1/P1':\n        v_type = 'P1'\n        num_v_basis_per_elem = 3\n        v_coords = p_coords\n        v_nodes_x = p_nodes_x\n        v_nodes_y = p_nodes_y\n        \n        # Internal velocity P1 DOFs (at vertices)\n        v_dof_map = -np.ones(v_nodes_x * v_nodes_y, dtype=int)\n        dof = 0\n        for j in range(1, v_nodes_y - 1):\n            for i in range(1, v_nodes_x - 1):\n                v_dof_map[i + j * v_nodes_x] = dof\n                dof += 1\n        n_v_base = dof\n\n    elif family == 'P2/P1':\n        v_type = 'P2'\n        num_v_basis_per_elem = 6\n        v_nodes_x = 2 * nx + 1\n        v_nodes_y = 2 * ny + 1\n        v_coords = np.array([[i / (2 * nx), j / (2 * ny)] for j in range(v_nodes_y) for i in range(v_nodes_x)])\n\n        # Internal velocity P2 DOFs (at vertices and edge midpoints)\n        v_dof_map = -np.ones(v_nodes_x * v_nodes_y, dtype=int)\n        dof = 0\n        for j in range(1, v_nodes_y - 1):\n            for i in range(1, v_nodes_x - 1):\n                v_dof_map[i + j * v_nodes_x] = dof\n                dof += 1\n        n_v_base = dof\n\n    # Triangles (elements of the mesh)\n    elements = []\n    for j in range(ny):\n        for i in range(nx):\n            p0 = i + j * p_nodes_x\n            p1 = (i + 1) + j * p_nodes_x\n            p2 = i + (j + 1) * p_nodes_x\n            p3 = (i + 1) + (j + 1) * p_nodes_x\n            elements.append((p0, p1, p3))  # Bottom-left to top-right diagonal\n            elements.append((p0, p3, p2))\n\n    # 2. MATRIX ASSEMBLY\n\n    # Quadrature rule on reference triangle\n    quad_points = np.array([[2/3, 1/6, 1/6], [1/6, 2/3, 1/6], [1/6, 1/6, 2/3]]) # Barycentric coords\n    quad_weights = np.array([1/3, 1/3, 1/3])\n\n    # Initialize global matrices\n    K_base = np.zeros((n_v_base, n_v_base))\n    M_p = np.zeros((n_p, n_p))\n    B_x = np.zeros((n_p, n_v_base))\n    B_y = np.zeros((n_p, n_v_base))\n\n    for el_nodes_p in elements:\n        # Physical coordinates of the element's vertices\n        v_coords_p = p_coords[np.array(el_nodes_p)]\n        \n        # Geometric properties\n        edge1 = v_coords_p[1] - v_coords_p[0]\n        edge2 = v_coords_p[2] - v_coords_p[0]\n        area = 0.5 * np.abs(edge1[0] * edge2[1] - edge1[1] * edge2[0])\n        \n        # Gradients of P1 basis functions (barycentric coordinates)\n        J_inv_T = (1 / (2 * area)) * np.array([[v_coords_p[1, 1] - v_coords_p[2, 1], v_coords_p[2, 0] - v_coords_p[1, 0]],\n                                               [v_coords_p[2, 1] - v_coords_p[0, 1], v_coords_p[0, 0] - v_coords_p[2, 0]],\n                                               [v_coords_p[0, 1] - v_coords_p[1, 1], v_coords_p[1, 0] - v_coords_p[0, 0]]])\n        grads_p = J_inv_T\n\n        if v_type == 'P1':\n            el_nodes_v = el_nodes_p\n            grads_v = grads_p\n        elif v_type == 'P2':\n            i0, j0 = el_nodes_p[0] % p_nodes_x, el_nodes_p[0] // p_nodes_x\n            i1, j1 = el_nodes_p[1] % p_nodes_x, el_nodes_p[1] // p_nodes_x\n            i3, j3 = el_nodes_p[2] % p_nodes_x, el_nodes_p[2] // p_nodes_x\n            v_idx0, v_idx1, v_idx3 = 2*i0+2*j0*v_nodes_x, 2*i1+2*j1*v_nodes_x, 2*i3+2*j3*v_nodes_x\n            m_idx01 = (i0+i1) + (j0+j1)*v_nodes_x\n            m_idx13 = (i1+i3) + (j1+j3)*v_nodes_x\n            m_idx03 = (i0+i3) + (j0+j3)*v_nodes_x\n            el_nodes_v = [v_idx0, v_idx1, v_idx3, m_idx01, m_idx13, m_idx03]\n\n        p_global_dofs = list(el_nodes_p)\n        v_global_dofs = [v_dof_map[idx] for idx in el_nodes_v]\n\n        for i in range(len(quad_points)):\n            lmbda = quad_points[i]\n            w = quad_weights[i] * area\n\n            # Evaluate basis functions\n            vals_p = lmbda\n            if v_type == 'P1':\n                vals_v = lmbda\n            elif v_type == 'P2':\n                vals_v = np.array([lmbda[0]*(2*lmbda[0]-1), lmbda[1]*(2*lmbda[1]-1), lmbda[2]*(2*lmbda[2]-1),\n                                   4*lmbda[0]*lmbda[1], 4*lmbda[1]*lmbda[2], 4*lmbda[2]*lmbda[0]])\n                \n                # Evaluate P2 velocity gradients\n                grad_lmbda = J_inv_T\n                grads_v = np.zeros((6, 2))\n                grads_v[0, :] = (4 * lmbda[0] - 1) * grad_lmbda[0]\n                grads_v[1, :] = (4 * lmbda[1] - 1) * grad_lmbda[1]\n                grads_v[2, :] = (4 * lmbda[2] - 1) * grad_lmbda[2]\n                grads_v[3, :] = 4 * (lmbda[1] * grad_lmbda[0] + lmbda[0] * grad_lmbda[1])\n                grads_v[4, :] = 4 * (lmbda[2] * grad_lmbda[1] + lmbda[1] * grad_lmbda[2])\n                grads_v[5, :] = 4 * (lmbda[0] * grad_lmbda[2] + lmbda[2] * grad_lmbda[0])\n\n            # Assemble local contributions\n            for r in range(3): # pressure basis functions\n                pr = p_global_dofs[r]\n                for s in range(3):\n                    ps = p_global_dofs[s]\n                    M_p[pr, ps] += vals_p[r] * vals_p[s] * w\n\n                for s in range(num_v_basis_per_elem):\n                    vs = v_global_dofs[s]\n                    if vs != -1:\n                        B_x[pr, vs] += grads_p[r, 0] * vals_v[s] * w\n                        B_y[pr, vs] += grads_p[r, 1] * vals_v[s] * w\n            \n            for r in range(num_v_basis_per_elem):\n                vr = v_global_dofs[r]\n                if vr != -1:\n                    for s in range(num_v_basis_per_elem):\n                        vs = v_global_dofs[s]\n                        if vs != -1:\n                            K_base[vr, vs] += np.dot(grads_v[r], grads_v[s]) * w\n\n    # 3. CONSTRUCT FULL MATRICES AND SOLVE EIGENPROBLEM\n    if n_v_base == 0:\n        return 0.0\n\n    K = linalg.block_diag(K_base, K_base)\n    B = np.hstack([B_x, B_y])\n\n    # K is small enough for direct inversion\n    K_inv = linalg.inv(K)\n    A_mat = B @ K_inv @ B.T\n\n    # Solve the generalized eigenvalue problem A*q = lambda*M_p*q\n    eigenvalues = linalg.eigh(A_mat, M_p, eigvals_only=True)\n\n    # Find the smallest strictly positive eigenvalue\n    tol = 1e-8\n    positive_eigenvalues = eigenvalues[eigenvalues > tol]\n    \n    if len(positive_eigenvalues) == 0:\n      return 0.0\n      \n    lambda_min_plus = np.min(positive_eigenvalues)\n    beta_h = np.sqrt(lambda_min_plus)\n\n    return beta_h\n\n\ndef solve():\n    \"\"\"\n    Main function to run the specified test cases and print results.\n    \"\"\"\n    test_cases = [\n        ('P1/P1', 2, 2),\n        ('P2/P1', 2, 2),\n        ('P1/P1', 3, 2),\n        ('P2/P1', 3, 3),\n    ]\n\n    results = []\n    for family, nx, ny in test_cases:\n        result = compute_lbb(family, nx, ny)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}