{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the Chorin projection method, we must first build its essential components from the ground up. This practice guides you through the process of translating the continuous differential operators—gradient and divergence—into their discrete matrix forms on a staggered Marker-and-Cell (MAC) grid. By constructing these operators in a simple one-dimensional setting and using them to solve for pressure and correct a velocity field, you will gain a concrete understanding of how the projection step mathematically enforces incompressibility on a discrete level .",
            "id": "3301246",
            "problem": "Consider the incompressible Navier–Stokes equations in one spatial dimension on a Marker-and-Cell (MAC) grid in a channel of length $L$ with no-slip walls at $x=0$ and $x=L$. The velocity is stored at face locations and the pressure at cell centers. Let there be $N$ uniformly sized control volumes (cells), with cell centers indexed by $i=1,\\dots,N$ and faces indexed by $j=0,\\dots,N$. The grid spacing is $h=L/N$. The velocity component aligned with the channel is denoted by $u$, and incompressibility requires a discrete divergence equal to zero in every cell after the projection. The projection step of Chorin’s method enforces incompressibility by solving a discrete Poisson equation for the pressure and then correcting the intermediate velocity.\n\nStarting from the finite-volume statement of mass conservation (discrete divergence of face-normal fluxes per cell) and a centered-difference approximation of the pressure gradient at interior faces (with homogeneous Neumann boundary conditions at the walls consistent with no-slip and zero normal pressure gradient), do the following for the specific case $N=4$, $L=1$ m, $h=L/N$, density $\\rho=1$ kg/m$^{3}$, and time step $\\Delta t=0.2$ s:\n\n1. Define the discrete divergence operator $D \\in \\mathbb{R}^{N \\times (N+1)}$ that maps face velocities $\\boldsymbol{u} \\in \\mathbb{R}^{N+1}$ to cell-centered divergences, using second-order finite-volume flux differences. Write its explicit matrix entries for the ordering $\\boldsymbol{u} = \\big(u_0,u_1,\\dots,u_N\\big)^{\\mathsf{T}}$ and $\\boldsymbol{d} = D \\boldsymbol{u}$ with $\\boldsymbol{d} \\in \\mathbb{R}^{N}$ ordered by cells $i=1,\\dots,N$.\n\n2. Define the discrete gradient operator $G \\in \\mathbb{R}^{(N+1) \\times N}$ that maps cell-centered pressures $\\boldsymbol{p} \\in \\mathbb{R}^{N}$ to face-centered pressure gradients, with centered differences on interior faces $j=1,\\dots,N-1$ and homogeneous Neumann conditions at boundary faces $j=0$ and $j=N$. Write its explicit matrix entries.\n\n3. Form the discrete pressure Laplacian $L = D G \\in \\mathbb{R}^{N \\times N}$ and write its explicit matrix form. State the solvability condition for the Neumann problem and the gauge constraint you will use to obtain a unique pressure.\n\n4. Given the intermediate face-velocity vector (in m/s)\n$$\n\\boldsymbol{u}^{\\ast} \\;=\\; \\big(0,\\;0.8,\\;-0.4,\\;0.6,\\;0\\big)^{\\mathsf{T}},\n$$\nderive from first principles the discrete Poisson equation for pressure in the projection step and solve for the unique mean-zero discrete pressure $\\boldsymbol{p} \\in \\mathbb{R}^{N}$ (in Pa). Then compute the corrected face velocities via the projection update that enforces no-slip at the walls.\n\nWhat is the value of the pressure at the second cell center, $p_2$ (in Pa)? Round your answer to four significant figures and express it in Pascals (Pa).",
            "solution": "The problem asks for the value of the pressure at the second cell center, $p_2$, as part of a projection step in Chorin's method for the incompressible Navier-Stokes equations. The problem is well-defined and provides all necessary data and boundary conditions. We shall proceed by systematically constructing the discrete operators and solving the resulting pressure Poisson equation.\n\nThe given parameters for the specific case are:\n- Number of cells: $N=4$\n- Channel length: $L=1$ m\n- Cell width: $h = \\frac{L}{N} = \\frac{1}{4} = 0.25$ m\n- Fluid density: $\\rho=1$ kg/m$^3$\n- Time step: $\\Delta t = 0.2$ s\n- Intermediate velocity vector: $\\boldsymbol{u}^{\\ast} = \\big(0, 0.8, -0.4, 0.6, 0\\big)^{\\mathsf{T}}$ m/s\n\n**1. Discrete Divergence Operator $D$**\n\nThe discrete divergence operator $D$ maps face-centered velocities $\\boldsymbol{u} = \\big(u_0, u_1, u_2, u_3, u_4\\big)^{\\mathsf{T}}$ to cell-centered divergences $\\boldsymbol{d} = \\big(d_1, d_2, d_3, d_4\\big)^{\\mathsf{T}}$. For a uniform grid, the divergence in cell $i$ (with faces $i-1$ and $i$) is the net flux per unit volume (or area in 2D, length in 1D), which is given by:\n$$\nd_i = (\\nabla \\cdot \\boldsymbol{u})_i = \\frac{u_i - u_{i-1}}{h}\n$$\nfor $i=1, \\dots, N$. This defines the rows of the $N \\times (N+1)$ matrix $D$. With $N=4$ and $h=0.25$, so $1/h=4$, the operator is:\n$$\n\\boldsymbol{d} = D\\boldsymbol{u} = \\frac{1}{h}\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 & 0 \\\\\n0 & -1 & 1 & 0 & 0 \\\\\n0 & 0 & -1 & 1 & 0 \\\\\n0 & 0 & 0 & -1 & 1\n\\end{pmatrix}\n\\begin{pmatrix} u_0 \\\\ u_1 \\\\ u_2 \\\\ u_3 \\\\ u_4 \\end{pmatrix}\n=\n4\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 & 0 \\\\\n0 & -1 & 1 & 0 & 0 \\\\\n0 & 0 & -1 & 1 & 0 \\\\\n0 & 0 & 0 & -1 & 1\n\\end{pmatrix}\n\\begin{pmatrix} u_0 \\\\ u_1 \\\\ u_2 \\\\ u_3 \\\\ u_4 \\end{pmatrix}\n$$\n\n**2. Discrete Gradient Operator $G$**\n\nThe discrete gradient operator $G$ maps cell-centered pressures $\\boldsymbol{p} = \\big(p_1, p_2, p_3, p_4\\big)^{\\mathsf{T}}$ to face-centered gradients $(\\nabla p)_j$.\n- For interior faces $j=1, \\dots, N-1$, a centered difference is used. The gradient at face $j$ (between cells $j$ and $j+1$) is:\n  $$ (\\nabla p)_j = \\frac{p_{j+1} - p_j}{h} $$\n- For boundary faces $j=0$ and $j=N=4$, homogeneous Neumann conditions $(\\nabla p)_0 = 0$ and $(\\nabla p)_N = 0$ are applied.\n\nThis defines the $(N+1) \\times N$ matrix $G$:\n$$\nG \\boldsymbol{p} = \\frac{1}{h}\n\\begin{pmatrix}\n0 & 0 & 0 & 0 \\\\\n-1 & 1 & 0 & 0 \\\\\n0 & -1 & 1 & 0 \\\\\n0 & 0 & -1 & 1 \\\\\n0 & 0 & 0 & 0\n\\end{pmatrix}\n\\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\\\ p_4 \\end{pmatrix}\n=\n4\n\\begin{pmatrix}\n0 & 0 & 0 & 0 \\\\\n-1 & 1 & 0 & 0 \\\\\n0 & -1 & 1 & 0 \\\\\n0 & 0 & -1 & 1 \\\\\n0 & 0 & 0 & 0\n\\end{pmatrix}\n\\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\\\ p_4 \\end{pmatrix}\n$$\nIt is a common property for such discretizations that $G$ is the negative transpose of $D$, i.e., $D = -G^{\\mathsf{T}}$, if we neglect the boundary conditions. The zero rows in $G$ represent the Neumann boundary conditions.\n\n**3. Discrete Pressure Laplacian $L = DG$**\n\nThe discrete Laplacian is an $N \\times N$ matrix formed by the product $L=DG$.\n$$\nL = DG = \\frac{1}{h^2}\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 & 0 \\\\\n0 & -1 & 1 & 0 & 0 \\\\\n0 & 0 & -1 & 1 & 0 \\\\\n0 & 0 & 0 & -1 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n0 & 0 & 0 & 0 \\\\\n-1 & 1 & 0 & 0 \\\\\n0 & -1 & 1 & 0 \\\\\n0 & 0 & -1 & 1 \\\\\n0 & 0 & 0 & 0\n\\end{pmatrix}\n$$\nPerforming the matrix multiplication gives:\n$$\nL = \\frac{1}{h^2}\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 \\\\\n1 & -2 & 1 & 0 \\\\\n0 & 1 & -2 & 1 \\\\\n0 & 0 & 1 & -1\n\\end{pmatrix}\n$$\nSubstituting $h=0.25$, we have $1/h^2 = 1/(0.0625) = 16$.\n$$\nL = 16\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 \\\\\n1 & -2 & 1 & 0 \\\\\n0 & 1 & -2 & 1 \\\\\n0 & 0 & 1 & -1\n\\end{pmatrix}\n$$\nThis is the standard 1D finite-difference representation of the second derivative with Neumann boundary conditions. The sum of the entries in each row is zero, which implies that the matrix $L$ is singular. Its null space consists of constant vectors $\\boldsymbol{c} = (c, c, \\dots, c)^{\\mathsf{T}}$. The solvability condition for the Neumann problem $L\\boldsymbol{p} = \\boldsymbol{f}$ is that the right-hand-side vector $\\boldsymbol{f}$ must be orthogonal to the null space of $L^{\\mathsf{T}}$. Since $L$ is symmetric ($L=L^{\\mathsf{T}}$), this means $\\boldsymbol{f}$ must be orthogonal to the constant vectors, which requires the sum of its components to be zero: $\\sum_{i=1}^N f_i = 0$. To obtain a unique solution for $\\boldsymbol{p}$, a gauge constraint is imposed, such as fixing one pressure value or requiring the mean pressure to be zero, as requested: $\\sum_{i=1}^N p_i = 0$.\n\n**4. Solve for the Pressure**\n\nThe projection step involves solving a Poisson equation for the pressure, which corrects the intermediate velocity field $\\boldsymbol{u}^*$ to be divergence-free. The update step is $\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho} \\nabla p$. Requiring $\\nabla \\cdot \\boldsymbol{u}^{n+1}=0$ leads to the pressure Poisson equation:\n$$\n\\nabla^2 p = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\boldsymbol{u}^*\n$$\nIn discrete form, this is $L\\boldsymbol{p} = \\frac{\\rho}{\\Delta t} D\\boldsymbol{u}^*$.\n\nFirst, we compute the right-hand side, $\\boldsymbol{f} = \\frac{\\rho}{\\Delta t} D\\boldsymbol{u}^*$.\n$$\n\\frac{\\rho}{\\Delta t} = \\frac{1 \\text{ kg/m}^3}{0.2 \\text{ s}} = 5 \\text{ kg/(m}^3 \\cdot \\text{s)}\n$$\n$$\nD\\boldsymbol{u}^* = \\frac{1}{h}\n\\begin{pmatrix} u_1^* - u_0^* \\\\ u_2^* - u_1^* \\\\ u_3^* - u_2^* \\\\ u_4^* - u_3^* \\end{pmatrix}\n= 4\n\\begin{pmatrix} 0.8 - 0 \\\\ -0.4 - 0.8 \\\\ 0.6 - (-0.4) \\\\ 0 - 0.6 \\end{pmatrix}\n= 4\n\\begin{pmatrix} 0.8 \\\\ -1.2 \\\\ 1.0 \\\\ -0.6 \\end{pmatrix}\n=\n\\begin{pmatrix} 3.2 \\\\ -4.8 \\\\ 4.0 \\\\ -2.4 \\end{pmatrix} \\text{ s}^{-1}\n$$\nThe sum of the components is $3.2 - 4.8 + 4.0 - 2.4 = 0$, satisfying the solvability condition. Now, we calculate $\\boldsymbol{f}$:\n$$\n\\boldsymbol{f} = 5 \\times D\\boldsymbol{u}^* =\n5 \\begin{pmatrix} 3.2 \\\\ -4.8 \\\\ 4.0 \\\\ -2.4 \\end{pmatrix}\n=\n\\begin{pmatrix} 16 \\\\ -24 \\\\ 20 \\\\ -12 \\end{pmatrix} \\text{ Pa/m}^2\n$$\nThe linear system to solve is $L\\boldsymbol{p} = \\boldsymbol{f}$:\n$$\n16\n\\begin{pmatrix}\n-1 & 1 & 0 & 0 \\\\\n1 & -2 & 1 & 0 \\\\\n0 & 1 & -2 & 1 \\\\\n0 & 0 & 1 & -1\n\\end{pmatrix}\n\\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\\\ p_4 \\end{pmatrix}\n=\n\\begin{pmatrix} 16 \\\\ -24 \\\\ 20 \\\\ -12 \\end{pmatrix}\n$$\nDividing by $16$ gives the system of equations:\n1.  $-p_1 + p_2 = 1$\n2.  $p_1 - 2p_2 + p_3 = -1.5$\n3.  $p_2 - 2p_3 + p_4 = 1.25$\n4.  $p_3 - p_4 = -0.75$\n\nWe supplement these with the mean-zero gauge constraint:\n5.  $p_1 + p_2 + p_3 + p_4 = 0$\n\nFrom equation (1), $p_1 = p_2 - 1$.\nFrom equation (4), $p_4 = p_3 + 0.75$.\nSubstitute $p_1$ into equation (2):\n$(p_2 - 1) - 2p_2 + p_3 = -1.5 \\implies -p_2 + p_3 = -0.5 \\implies p_3 = p_2 - 0.5$.\nNow express $p_4$ in terms of $p_2$:\n$p_4 = p_3 + 0.75 = (p_2 - 0.5) + 0.75 = p_2 + 0.25$.\n\nWe have expressed all pressures in terms of $p_2$:\n- $p_1 = p_2 - 1$\n- $p_2 = p_2$\n- $p_3 = p_2 - 0.5$\n- $p_4 = p_2 + 0.25$\n\nNow, substitute these into the gauge constraint (5):\n$$ (p_2 - 1) + p_2 + (p_2 - 0.5) + (p_2 + 0.25) = 0 $$\n$$ 4p_2 - 1.25 = 0 $$\n$$ 4p_2 = 1.25 $$\n$$ p_2 = \\frac{1.25}{4} = \\frac{5/4}{4} = \\frac{5}{16} = 0.3125 $$\nThe value of the pressure at the second cell center, $p_2$, is $0.3125$ Pa. The question asks for the answer rounded to four significant figures, which is precisely $0.3125$.\n\nAs a final verification, we can compute the corrected velocity field $\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho} G \\boldsymbol{p}$.\nThe pressure vector is $\\boldsymbol{p} = (-0.6875, 0.3125, -0.1875, 0.5625)^{\\mathsf{T}}$.\nThe pressure gradient term is:\n$$\n\\frac{\\Delta t}{\\rho} G \\boldsymbol{p} = 0.2 \\times 4 \\times\n\\begin{pmatrix}\n0 \\\\\np_2 - p_1 \\\\\np_3 - p_2 \\\\\np_4 - p_3 \\\\\n0\n\\end{pmatrix}\n= 0.8\n\\begin{pmatrix}\n0 \\\\\n0.3125 - (-0.6875) \\\\\n-0.1875 - 0.3125 \\\\\n0.5625 - (-0.1875) \\\\\n0\n\\end{pmatrix}\n= 0.8\n\\begin{pmatrix}\n0 \\\\\n1 \\\\\n-0.5 \\\\\n0.75 \\\\\n0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0.8 \\\\\n-0.4 \\\\\n0.6 \\\\\n0\n\\end{pmatrix}\n$$\nThe corrected velocity is:\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho} G \\boldsymbol{p} = \\begin{pmatrix} 0 \\\\ 0.8 \\\\ -0.4 \\\\ 0.6 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 0.8 \\\\ -0.4 \\\\ 0.6 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe final velocity is zero everywhere. It is trivially divergence-free ($D\\boldsymbol{u}^{n+1} = \\boldsymbol{0}$) and satisfies the no-slip boundary conditions ($u_0^{n+1}=0, u_4^{n+1}=0$). This confirms the calculations.\n\nThe value of the pressure at the second cell center, $p_2$, is $0.3125$ Pa.",
            "answer": "$$\\boxed{0.3125}$$"
        },
        {
            "introduction": "In theory, the projection step requires an exact solution to the pressure Poisson equation, but in practice, this system is almost always solved iteratively and inexactly. This exercise delves into the practical consequences of this approximation, asking you to derive and then numerically verify the direct relationship between the solver's residual error and the mass conservation error in the final velocity field. This is a critical concept in computational fluid dynamics, as it demonstrates that the degree to which we conserve mass is directly controlled by the tolerance we set for the linear solver .",
            "id": "3301215",
            "problem": "Consider the incompressible Navier–Stokes equations and an operator-splitting scheme where the velocity is updated by a projection step to enforce incompressibility. In Chorin’s projection method, one first advances to an intermediate velocity field $u^\\ast$ using the momentum equations without pressure, and then enforces incompressibility by solving a Poisson equation for a pressure-like variable $p$ and projecting:\n$$\nu^{n+1} \\leftarrow u^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla p,\n$$\nwith the intent that the corrected velocity satisfies the discrete divergence-free constraint. Assume a uniform Cartesian grid on a periodic square domain $[0,1]^2$, with grid spacing $h = 1/N$ in each direction, using a staggered Marker-And-Cell (MAC) discretization: horizontal velocity components are located at horizontal face centers and vertical velocity components at vertical face centers, while pressure and divergence are at cell centers. Denote by $\\nabla_h \\cdot$ the MAC discrete divergence mapping face-centered velocity to cell centers, by $\\nabla_h$ the MAC discrete gradient mapping cell-centered pressure to faces, and by $L_h$ the standard five-point discrete Laplacian at cell centers. The MAC operators satisfy the compatibility identity $\\nabla_h \\cdot \\nabla_h p = L_h p$ under periodic boundary conditions. Let $\\|\\cdot\\|_{2}$ denote the unweighted Euclidean norm of a vector of all grid values, and let $\\|\\cdot\\|_{L^2_h}$ denote the discrete $L^2$ norm on the domain defined by\n$$\n\\|q\\|_{L^2_h} \\equiv \\left( \\sum_{i,j} |q_{i,j}|^2\\, h^2 \\right)^{1/2}.\n$$\nIn the pressure projection, the pressure-like variable $p_h$ is computed by solving the discrete Poisson equation\n$$\nL_h p_h = b_h, \\quad \\text{with} \\quad b_h = \\frac{\\rho}{\\Delta t} \\, (\\nabla_h \\cdot u^\\ast),\n$$\nbut suppose the linear solve is inexact and terminates when a residual $r_h = L_h p_h - b_h$ meets a stopping criterion. The projection is then performed with this inexact $p_h$. Two common stopping criteria are:\n1. Absolute tolerance: $\\|r_h\\|_{2} \\le \\varepsilon_{\\mathrm{abs}}$ for a prescribed $\\varepsilon_{\\mathrm{abs}} > 0$.\n2. Relative tolerance: $\\|r_h\\|_{2} \\le \\varepsilon_{\\mathrm{rel}} \\, \\|b_h\\|_{2}$ for a prescribed $\\varepsilon_{\\mathrm{rel}} > 0$.\n\nStarting only from the fundamental properties of the MAC discretization, the definition of the projection update, and the norms above, derive a quantitative relationship between the discrete mass conservation error in the corrected velocity, measured by the discrete $L^2$ norm $\\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$, the solver tolerance (either $\\varepsilon_{\\mathrm{abs}}$ or $\\varepsilon_{\\mathrm{rel}}$), and the grid spacing $h$. Use dimensionless units with $\\rho = 1$ and $\\Delta t = 1$.\n\nThen implement a program that constructs a smooth face-centered intermediate velocity field $u^\\ast_h$ on the MAC grid by sampling the continuous field\n$$\nu_x(x,y) = \\sin(2\\pi x)\\,\\sin(2\\pi y), \\qquad u_y(x,y) = \\cos(2\\pi x)\\,\\sin(2\\pi y),\n$$\nat the appropriate face locations on a uniform periodic grid, computes the corresponding $b_h = \\nabla_h \\cdot u^\\ast_h$ at cell centers, and evaluates the predicted discrete mass conservation error $\\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$ implied by the derived relationship under both stopping criteria, without actually solving the linear system. Use the identity that connects $\\nabla_h \\cdot u^{n+1}$ to the residual $r_h$ and the relation between the discrete norms to evaluate the error magnitude for a given tolerance.\n\nConstruct the following test suite to probe different scalings:\n- Absolute-tolerance scaling with tolerance at fixed grid resolution: fix $N = 64$ and compute the slope (base-$e$ logarithmic regression) of $\\log \\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$ versus $\\log \\varepsilon_{\\mathrm{abs}}$ using $\\varepsilon_{\\mathrm{abs}} \\in \\{10^{-6}, 5\\times 10^{-7}, 2.5\\times 10^{-7}\\}$.\n- Absolute-tolerance scaling with grid spacing at fixed tolerance: fix $\\varepsilon_{\\mathrm{abs}} = 10^{-6}$ and compute the slope of $\\log \\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$ versus $\\log h$ using $N \\in \\{32, 64, 128\\}$ (so $h \\in \\{1/32,1/64,1/128\\}$).\n- Relative-tolerance scaling with tolerance at fixed grid resolution: fix $N = 64$ and compute the slope of $\\log \\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$ versus $\\log \\varepsilon_{\\mathrm{rel}}$ using $\\varepsilon_{\\mathrm{rel}} \\in \\{10^{-6}, 5\\times 10^{-7}, 2.5\\times 10^{-7}\\}$.\n- Relative-tolerance scaling with grid spacing at fixed tolerance: fix $\\varepsilon_{\\mathrm{rel}} = 10^{-6}$ and compute the slope of $\\log \\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$ versus $\\log h$ using $N \\in \\{32, 64, 128\\}$.\n\nFor each of the four bullets above, estimate the slope by least-squares fitting of a line to the pairs $(\\log x,\\log y)$, where $x$ is $\\varepsilon_{\\mathrm{abs}}$, $h$, $\\varepsilon_{\\mathrm{rel}}$, or $h$ as appropriate, and $y$ is the corresponding $\\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$. Your program should output a single line containing the four slopes, in this order:\n- first, the absolute-tolerance slope with respect to $\\varepsilon_{\\mathrm{abs}}$,\n- second, the absolute-tolerance slope with respect to $h$,\n- third, the relative-tolerance slope with respect to $\\varepsilon_{\\mathrm{rel}}$,\n- fourth, the relative-tolerance slope with respect to $h$,\nrounded to three decimal places.\n\nFinal Output Format: Your program should produce a single line of output containing the four slopes as a comma-separated list enclosed in square brackets, for example, \"[s1,s2,s3,s4]\". Since the outputs are dimensionless slopes, no physical units are required.",
            "solution": "The user has provided a valid problem statement.\n\n### Step 1: Givens Extraction\n- **Governing Equations**: Incompressible Navier–Stokes equations.\n- **Numerical Method**: Chorin’s projection method.\n- **Projection Step**: $u^{n+1} \\leftarrow u^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla p$.\n- **Domain and Grid**: Periodic square domain $[0,1]^2$, uniform Cartesian grid, spacing $h = 1/N$.\n- **Discretization**: Staggered Marker-And-Cell (MAC).\n- **Discrete Operators**: $\\nabla_h \\cdot$ (divergence), $\\nabla_h$ (gradient), $L_h$ (Laplacian).\n- **Operator Identity**: $\\nabla_h \\cdot \\nabla_h p = L_h p$ under periodic boundary conditions.\n- **Norms**:\n    - Euclidean norm: $\\|\\cdot\\|_{2}$.\n    - Discrete $L^2$ norm: $\\|q\\|_{L^2_h} \\equiv \\left( \\sum_{i,j} |q_{i,j}|^2\\, h^2 \\right)^{1/2}$.\n- **Pressure Poisson Problem**: $L_h p_h = b_h$, where $b_h = \\frac{\\rho}{\\Delta t} \\, (\\nabla_h \\cdot u^\\ast)$.\n- **Inexact Solve**: Residual is $r_h = L_h p_h - b_h$.\n- **Stopping Criteria**:\n    1.  Absolute: $\\|r_h\\|_{2} \\le \\varepsilon_{\\mathrm{abs}}$.\n    2.  Relative: $\\|r_h\\|_{2} \\le \\varepsilon_{\\mathrm{rel}} \\, \\|b_h\\|_{2}$.\n- **Constants**: Dimensionless units with $\\rho = 1$ and $\\Delta t = 1$.\n- **Objective 1 (Derivation)**: Derive the relationship between $\\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$, the tolerance ($\\varepsilon_{\\mathrm{abs}}$ or $\\varepsilon_{\\mathrm{rel}}$), and grid spacing $h$.\n- **Objective 2 (Implementation)**: Implement a program to compute the predicted mass conservation error for a given intermediate velocity field and test different scaling laws.\n- **Intermediate Velocity Field**: $u_x(x,y) = \\sin(2\\pi x)\\,\\sin(2\\pi y)$, $u_y(x,y) = \\cos(2\\pi x)\\,\\sin(2\\pi y)$.\n- **Test Cases**:\n    - Case 1: $N = 64$, $\\varepsilon_{\\mathrm{abs}} \\in \\{10^{-6}, 5\\times 10^{-7}, 2.5\\times 10^{-7}\\}$.\n    - Case 2: $\\varepsilon_{\\mathrm{abs}} = 10^{-6}$, $N \\in \\{32, 64, 128\\}$.\n    - Case 3: $N = 64$, $\\varepsilon_{\\mathrm{rel}} \\in \\{10^{-6}, 5\\times 10^{-7}, 2.5\\times 10^{-7}\\}$.\n    - Case 4: $\\varepsilon_{\\mathrm{rel}} = 10^{-6}$, $N \\in \\{32, 64, 128\\}$.\n- **Output**: Four slopes from base-$e$ logarithmic regression, rounded to three decimal places, in the format `[s1,s2,s3,s4]`.\n\n### Step 2: Problem Validation\nThe problem is scientifically grounded in the principles of computational fluid dynamics, specifically concerning projection methods for incompressible flow. It is well-posed, with all necessary definitions and data provided to perform the required derivation and numerical computation. The language is objective and unambiguous. The problem is a standard exercise in analyzing the properties of numerical schemes and is neither trivial nor ill-posed. All criteria for a valid problem are met.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Principle-Based Solution\n\nThe objective is to derive a quantitative relationship between the discrete mass conservation error of the projected velocity field, $\\|\\nabla_h \\cdot u^{n+1}\\|_{L^2_h}$, and the parameters of the numerical method, namely the solver tolerance and grid spacing.\n\n**1. Connecting Divergence Error to the Poisson Solver Residual**\n\nThe projection method updates the velocity in two steps. We are concerned with the second step, the projection, which enforces the incompressibility constraint. The discrete update rule for the velocity field $u_h$ is given as:\n$$\nu_h^{n+1} = u_h^\\ast - \\frac{\\Delta t}{\\rho} \\nabla_h p_h\n$$\nwhere $u_h^{n+1}$ is the new velocity, $u_h^\\ast$ is the intermediate velocity, $\\nabla_h p_h$ is the discrete pressure gradient, $\\Delta t$ is the time step, and $\\rho$ is the density. The problem states to use dimensionless units where $\\rho = 1$ and $\\Delta t = 1$, simplifying the equation to:\n$$\nu_h^{n+1} = u_h^\\ast - \\nabla_h p_h\n$$\nTo assess the mass conservation of the new velocity field, we apply the discrete divergence operator, $\\nabla_h \\cdot$, to this equation. This operator maps face-centered velocity data to cell-centered divergence data.\n$$\n\\nabla_h \\cdot u_h^{n+1} = \\nabla_h \\cdot u_h^\\ast - \\nabla_h \\cdot (\\nabla_h p_h)\n$$\nThe problem provides the identity for the MAC discretization on a periodic domain: $\\nabla_h \\cdot \\nabla_h p_h = L_h p_h$, where $L_h$ is the discrete Laplacian operator on cell-centered data. Substituting this identity gives:\n$$\n\\nabla_h \\cdot u_h^{n+1} = \\nabla_h \\cdot u_h^\\ast - L_h p_h\n$$\nThe pressure-like variable $p_h$ is obtained by solving the discrete Poisson equation $L_h p_h = b_h$, where the source term is $b_h = \\frac{\\rho}{\\Delta t} \\nabla_h \\cdot u_h^\\ast$. With our unit constants, this becomes $b_h = \\nabla_h \\cdot u_h^\\ast$. The problem specifies that this linear system is solved inexactly, resulting in a non-zero residual $r_h$:\n$$\nr_h = L_h p_h - b_h\n$$\nWe can rearrange this definition of the residual to express $L_h p_h$ as $L_h p_h = b_h + r_h$. Substituting this and the definition of $b_h$ into the equation for the divergence of $u_h^{n+1}$:\n$$\n\\nabla_h \\cdot u_h^{n+1} = b_h - (b_h + r_h)\n$$\nThis simplifies to a fundamental identity for projection methods:\n$$\n\\nabla_h \\cdot u_h^{n+1} = -r_h\n$$\nThis result shows that the discrete divergence of the projected velocity field is exactly equal to the negative of the residual from the inexact pressure Poisson solve.\n\n**2. Relating Norms**\n\nThe problem requires us to quantify the error using the discrete $L^2_h$ norm. From the identity above, we have:\n$$\n\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h} = \\|-r_h\\|_{L^2_h} = \\|r_h\\|_{L^2_h}\n$$\nThe stopping criteria for the linear solver are given in terms of the unweighted Euclidean norm, $\\|\\cdot\\|_2$. We must relate the $\\|\\cdot\\|_{L^2_h}$ norm to the $\\|\\cdot\\|_2$ norm. For any grid function $q_h$ defined on the $N \\times N$ cell centers, the definitions are:\n$$\n\\|q_h\\|_{L^2_h}^2 = \\sum_{i,j=0}^{N-1} |q_{h,i,j}|^2 h^2 \\quad \\text{and} \\quad \\|q_h\\|_2^2 = \\sum_{i,j=0}^{N-1} |q_{h,i,j}|^2\n$$\nBy factoring out the constant $h^2$ from the first sum, we find the direct relationship:\n$$\n\\|q_h\\|_{L^2_h}^2 = h^2 \\|q_h\\|_2^2 \\implies \\|q_h\\|_{L^2_h} = h \\|q_h\\|_2\n$$\nApplying this to the residual $r_h$, we obtain the central expression for the divergence error:\n$$\n\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h} = h \\|r_h\\|_2\n$$\n\n**3. Analysis of Stopping Criteria**\n\nWe now analyze the two specified stopping criteria by substituting them into this expression. We assume the solver terminates at the boundary of the criterion, representing the worst-case scenario.\n\n**Case A: Absolute Tolerance**\nThe stopping criterion is $\\|r_h\\|_2 \\le \\varepsilon_{\\mathrm{abs}}$. At termination, we have $\\|r_h\\|_2 \\approx \\varepsilon_{\\mathrm{abs}}$. The divergence error is thus:\n$$\n\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h} \\approx h \\varepsilon_{\\mathrm{abs}}\n$$\nThis relationship predicts the following scaling laws:\n- At a fixed grid resolution (fixed $h$), the error $\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h}$ is directly proportional to $\\varepsilon_{\\mathrm{abs}}$. The slope of $\\log(\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h})$ versus $\\log(\\varepsilon_{\\mathrm{abs}})$ is $1$.\n- At a fixed tolerance (fixed $\\varepsilon_{\\mathrm{abs}}$), the error is directly proportional to $h$. The slope of $\\log(\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h})$ versus $\\log(h)$ is $1$.\n\n**Case B: Relative Tolerance**\nThe stopping criterion is $\\|r_h\\|_2 \\le \\varepsilon_{\\mathrm{rel}} \\|b_h\\|_2$. At termination, we have $\\|r_h\\|_2 \\approx \\varepsilon_{\\mathrm{rel}} \\|b_h\\|_2$. The divergence error is:\n$$\n\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h} \\approx h \\varepsilon_{\\mathrm{rel}} \\|b_h\\|_2\n$$\nTo understand the scaling with respect to $h$, we must determine how $\\|b_h\\|_2$ depends on $h$. The term $b_h = \\nabla_h \\cdot u_h^\\ast$ is a discrete approximation of the continuous divergence $\\nabla \\cdot u$. For a smooth velocity field, the discrete operator $\\nabla_h \\cdot$ is consistent, meaning $(\\nabla_h \\cdot u_h^\\ast)(x,y) \\to (\\nabla \\cdot u)(x,y)$ as $h \\to 0$. The discrete $L^2_h$ norm is designed to approximate the continuous $L^2$ integral norm:\n$$\n\\|b_h\\|_{L^2_h}^2 = \\sum_{i,j} |b_{h,i,j}|^2 h^2 \\xrightarrow{h \\to 0} \\int_{[0,1]^2} |(\\nabla \\cdot u)(x,y)|^2 dx dy\n$$\nThe integral on the right is a constant for a given continuous field $u$. Therefore, for small $h$, $\\|b_h\\|_{L^2_h}$ is approximately constant. Using the relationship between norms, $\\|b_h\\|_2 = h^{-1}\\|b_h\\|_{L^2_h}$, we deduce the scaling:\n$$\n\\|b_h\\|_2 \\propto h^{-1}\n$$\nSubstituting this scaling back into the error expression for the relative tolerance case:\n$$\n\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h} \\approx h \\varepsilon_{\\mathrm{rel}} (C h^{-1}) = C \\varepsilon_{\\mathrm{rel}}\n$$\nwhere $C$ is a constant related to the $L^2$ norm of the continuous divergence. This relationship predicts:\n- At a fixed grid resolution (fixed $h$), the error $\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h}$ is directly proportional to $\\varepsilon_{\\mathrm{rel}}$. The slope of $\\log(\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h})$ versus $\\log(\\varepsilon_{\\mathrm{rel}})$ is $1$.\n- At a fixed tolerance (fixed $\\varepsilon_{\\mathrm{rel}}$), the error is approximately independent of the grid spacing $h$. The slope of $\\log(\\|\\nabla_h \\cdot u_h^{n+1}\\|_{L^2_h})$ versus $\\log(h)$ is $0$.\n\nThe provided problem requires implementing a program to numerically verify these four predicted slopes.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_bh_norm2(N):\n    \"\"\"\n    Computes the Euclidean norm of the discrete divergence of the\n    intermediate velocity field u* on a MAC grid.\n\n    Args:\n        N (int): The number of grid cells in each direction.\n\n    Returns:\n        float: The Euclidean L2 norm of the discrete divergence vector b_h.\n    \"\"\"\n    h = 1.0 / N\n    \n    # Create grid indices for an N x N grid\n    j_idx, i_idx = np.indices((N, N))\n\n    # Define coordinates for the horizontal (u) velocity components\n    # ux is located at (i*h, (j+0.5)*h)\n    x_u = i_idx * h\n    y_u = (j_idx + 0.5) * h\n    \n    # Define coordinates for the vertical (v) velocity components\n    # uy is located at ((i+0.5)*h, j*h)\n    x_v = (i_idx + 0.5) * h\n    y_v = j_idx * h\n\n    # Sample the continuous velocity field to get the discrete intermediate velocity u*\n    # u_x(x,y) = sin(2*pi*x)*sin(2*pi*y)\n    # u_y(x,y) = cos(2*pi*x)*sin(2*pi*y)\n    ux_h = np.sin(2 * np.pi * x_u) * np.sin(2 * np.pi * y_u)\n    uy_h = np.cos(2 * np.pi * x_v) * np.sin(2 * np.pi * y_v)\n\n    # Compute the discrete divergence b_h = nabla_h . u* at cell centers.\n    # The divergence at cell (j,i) is (u_right - u_left)/h + (u_top - u_bottom)/h.\n    # On a periodic MAC grid, u_left of cell (j,i) is ux_h[j,i] and u_right is ux_h[j,(i+1)%N].\n    # Similarly, u_bottom is uy_h[j,i] and u_top is uy_h[(j+1)%N,i].\n    # We use np.roll for efficient periodic boundary handling.\n    # np.roll(ux_h, -1, axis=1) corresponds to ux_h[j, (i+1)%N]\n    # np.roll(uy_h, -1, axis=0) corresponds to uy_h[(j+1)%N, i]\n    b_h = ((np.roll(ux_h, -1, axis=1) - ux_h) + (np.roll(uy_h, -1, axis=0) - uy_h)) / h\n    \n    # The Euclidean norm ||b_h||_2 is equivalent to the Frobenius norm of the matrix\n    b_h_norm2 = np.linalg.norm(b_h)\n    \n    return b_h_norm2\n\ndef get_slope(x_values, y_values):\n    \"\"\"\n    Performs a linear regression on the base-e logarithm of the data.\n\n    Args:\n        x_values (np.ndarray): The independent variable values.\n        y_values (np.ndarray): The dependent variable values.\n\n    Returns:\n        float: The slope of the line fitted to (log(x), log(y)).\n    \"\"\"\n    log_x = np.log(x_values)\n    log_y = np.log(y_values)\n    # np.polyfit with degree 1 returns [slope, intercept]\n    slope, _ = np.polyfit(log_x, log_y, 1)\n    return slope\n\ndef solve():\n    \"\"\"\n    Main function to perform the four scaling tests and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # 1. Absolute tolerance scaling with tol, fixed N\n        {'N_vals': np.array([64]), 'eps_vals': np.array([1e-6, 5e-7, 2.5e-7]), 'mode': 'abs_vs_eps'},\n        # 2. Absolute tolerance scaling with h, fixed tol\n        {'N_vals': np.array([32, 64, 128]), 'eps_vals': np.array([1e-6]), 'mode': 'abs_vs_h'},\n        # 3. Relative tolerance scaling with tol, fixed N\n        {'N_vals': np.array([64]), 'eps_vals': np.array([1e-6, 5e-7, 2.5e-7]), 'mode': 'rel_vs_eps'},\n        # 4. Relative tolerance scaling with h, fixed tol\n        {'N_vals': np.array([32, 64, 128]), 'eps_vals': np.array([1e-6]), 'mode': 'rel_vs_h'},\n    ]\n\n    results = []\n\n    # Case 1: Absolute tolerance vs. epsilon_abs\n    case1 = test_cases[0]\n    N1 = case1['N_vals'][0]\n    h1 = 1.0 / N1\n    eps_abs_vals = case1['eps_vals']\n    # Derived relationship: ||div u||_L2h = h * eps_abs\n    errors1 = h1 * eps_abs_vals\n    slope1 = get_slope(eps_abs_vals, errors1)\n    results.append(slope1)\n\n    # Case 2: Absolute tolerance vs. h\n    case2 = test_cases[1]\n    N_vals2 = case2['N_vals']\n    h_vals2 = 1.0 / N_vals2\n    eps_abs2 = case2['eps_vals'][0]\n    # Derived relationship: ||div u||_L2h = h * eps_abs\n    errors2 = h_vals2 * eps_abs2\n    slope2 = get_slope(h_vals2, errors2)\n    results.append(slope2)\n\n    # Case 3: Relative tolerance vs. epsilon_rel\n    case3 = test_cases[2]\n    N3 = case3['N_vals'][0]\n    h3 = 1.0 / N3\n    eps_rel_vals = case3['eps_vals']\n    b_h_norm2_N64 = compute_bh_norm2(N3)\n    # Derived relationship: ||div u||_L2h = h * eps_rel * ||b_h||_2\n    errors3 = h3 * eps_rel_vals * b_h_norm2_N64\n    slope3 = get_slope(eps_rel_vals, errors3)\n    results.append(slope3)\n\n    # Case 4: Relative tolerance vs. h\n    case4 = test_cases[3]\n    N_vals4 = case4['N_vals']\n    h_vals4 = 1.0 / N_vals4\n    eps_rel4 = case4['eps_vals'][0]\n    errors4 = []\n    for N_val in N_vals4:\n        h_val = 1.0 / N_val\n        b_h_norm2 = compute_bh_norm2(N_val)\n        # Derived relationship: ||div u||_L2h = h * eps_rel * ||b_h||_2\n        error = h_val * eps_rel4 * b_h_norm2\n        errors4.append(error)\n    errors4 = np.array(errors4)\n    slope4 = get_slope(h_vals4, errors4)\n    results.append(slope4)\n\n    # Final print statement in the exact required format.\n    print(f\"[{results[0]:.3f},{results[1]:.3f},{results[2]:.3f},{results[3]:.3f}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "The choice of grid structure has profound implications for the stability of a numerical scheme. While the staggered MAC grid naturally prevents certain instabilities, collocated grids—where all variables are stored at the same locations—can suffer from spurious pressure oscillations known as \"checkerboarding.\" This advanced practice challenges you to implement and diagnose this very issue, comparing a naive collocated scheme with the celebrated Rhie-Chow interpolation method designed to suppress these oscillations . Through this hands-on comparison, you will appreciate the subtle art of designing discrete operators that maintain the crucial coupling between pressure and velocity.",
            "id": "3301242",
            "problem": "Consider the two-dimensional incompressible flow on a unit square domain with uniform spacing and a collocated grid of $N \\times N$ cell centers. The fundamental base for this problem is the incompressible Navier–Stokes equations and Chorin’s projection method. The governing equations are the conservation of mass and momentum, with the projection idea that an intermediate velocity $u^\\*$ is corrected by a pressure $p$ so that the corrected velocity $u^{n+1}$ is divergence-free. In the continuous setting, this is expressed as $u^{n+1} = u^\\* - \\frac{\\Delta t}{\\rho} \\nabla p$ and $\\nabla \\cdot u^{n+1} = 0$, where $\\rho$ is the density and $\\Delta t$ is the time step. The pressure $p$ is determined by solving a pressure Poisson equation derived from enforcing the incompressibility constraint.\n\nOn collocated grids, the discrete coupling of pressure and velocity can lead to spurious pressure checkerboarding, where pressure oscillates in an alternating pattern between adjacent cells. Rhie–Chow interpolation is a well-known scheme that modifies face-interpolated mass fluxes to prevent such decoupling. Your task is to implement and compare three projection variants in a purely numerical context:\n\n1. A naive collocated scheme without Rhie–Chow interpolation, in which face velocities are obtained by averaging corrected cell-centered velocities, and the discrete pressure equation arises from the divergence of those averaged cell-centered gradients.\n\n2. A scheme that uses Rhie–Chow interpolation, in which face-normal pressure gradients are computed as differences across faces (rather than averages of cell-centered gradients), and face velocities include the pressure-gradient contribution evaluated at faces.\n\n3. An exact discrete projection in which the pressure is obtained by solving the standard five-point discrete Laplacian and the corrected velocity is computed with cell-centered gradients consistent with that Laplacian.\n\nAll three variants should be implemented on a uniform collocated grid with indices $(i,j)$ for $i,j \\in \\{0,1,\\dots,N-1\\}$ and cell-center coordinates $x_i = \\frac{i+1/2}{N}$, $y_j = \\frac{j+1/2}{N}$. Take density $\\rho = 1$ (non-dimensional) and a specified time step $\\Delta t$. Use an interior computational set of unknowns restricted to indices $i \\in \\{2,3,\\dots,N-3\\}$ and $j \\in \\{2,3,\\dots,N-3\\}$ for the pressure solution. Impose homogeneous Dirichlet boundary conditions for $p$ on the boundary of that interior set. This restriction ensures that wide stencils appearing in the naive collocated scheme do not refer to out-of-domain indices.\n\nLet the manufactured intermediate velocity field be defined at cell centers by\n$$\nu^\\*_x(i,j) = \\sin(2\\pi y_j) + \\varepsilon (-1)^i,\\quad\nu^\\*_y(i,j) = \\sin(2\\pi x_i) - \\varepsilon (-1)^j,\n$$\nwhere $\\varepsilon$ is a specified amplitude. For each variant, construct a discrete right-hand side for the pressure equation from the discrete divergence of $u^\\*$ and solve for the pressure $p$ on the interior set. Then form corrected velocities $u^{n+1}$ according to each variant’s face-velocity construction and compute the discrete divergence.\n\nDefine the following discrete metrics that your program must compute for each variant on the interior set:\n\n- The discrete divergence norm $\\|\\nabla \\cdot u^{n+1}\\|_2$, computed as the root-mean-square of the cell-wise finite-volume divergence using face velocities appropriate to the scheme, expressed as a dimensionless float.\n\n- A pressure checkerboard amplitude $\\alpha$, defined as the absolute correlation of the solved pressure with the alternating mode $v_{i,j}=(-1)^{i+j}$ on the interior set,\n$$\n\\alpha = \\frac{\\left|\\sum_{i,j} p_{i,j}\\,(-1)^{i+j}\\right|}{\\|p\\|_2\\,\\|v\\|_2},\n$$\nwhich lies in $[0,1]$ and is dimensionless.\n\nFor the naive collocated scheme without Rhie–Chow, construct the pressure operator by taking the divergence of the average of cell-centered gradients, which produces a wide-stencil discrete operator in both $x$ and $y$ directions. For the Rhie–Chow scheme, use face-based pressure gradients in the mass flux and recover the standard five-point discrete Laplacian. For the exact projection scheme, use the five-point discrete Laplacian to solve for $p$ and correct with cell-centered gradients; its divergence should be measured with a cell-centered discrete divergence consistent with the five-point Laplacian.\n\nUse the following test suite of parameter values:\n\n- Test case 1 (happy path): $N=16$, $\\Delta t = 10^{-3}$, $\\varepsilon = 0.2$.\n\n- Test case 2 (edge, small grid): $N=8$, $\\Delta t = 10^{-3}$, $\\varepsilon = 0.3$.\n\n- Test case 3 (refinement): $N=24$, $\\Delta t = 10^{-3}$, $\\varepsilon = 0.1$.\n\nFor each test case, your program must output six floats in order:\n$[\\|\\nabla \\cdot u\\|_2^{\\text{noRC}}, \\alpha^{\\text{noRC}}, \\|\\nabla \\cdot u\\|_2^{\\text{RC}}, \\alpha^{\\text{RC}}, \\|\\nabla \\cdot u\\|_2^{\\text{exact}}, \\alpha^{\\text{exact}}]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for all test cases concatenated sequentially). There are no physical units in this non-dimensionalized problem; all outputs are dimensionless floats.",
            "solution": "The user wants to compare three variants of Chorin's projection method for incompressible flow on a collocated grid. The goal is to analyze their effectiveness in suppressing spurious pressure oscillations, a phenomenon known as checkerboarding. This will be accomplished by solving for a pressure field from a manufactured intermediate velocity field and then computing two key metrics: a pressure checkerboard amplitude and the divergence norm of the corrected velocity field.\n\n### Problem Formulation\n\nThe problem is set on a two-dimensional unit square domain discretized by a uniform collocated grid of $N \\times N$ cells. The cell centers are located at $(x_i, y_j) = (\\frac{i+1/2}{N}, \\frac{j+1/2}{N})$ for $i, j \\in \\{0, 1, \\dots, N-1\\}$. The grid spacing is $h=1/N$. We are given a manufactured intermediate velocity field $u^*$ at the cell centers:\n$$\nu^\\*_x(i,j) = \\sin(2\\pi y_j) + \\varepsilon (-1)^i\n$$\n$$\nu^\\*_y(i,j) = \\sin(2\\pi x_i) - \\varepsilon (-1)^j\n$$\nThe term with amplitude $\\varepsilon$ introduces a high-frequency component designed to excite checkerboard instabilities.\n\nThe core of the projection method is to find a pressure field $p$ such that the corrected velocity $u^{n+1}$ is divergence-free. This leads to a pressure Poisson equation of the form $L p = f$, where $L$ is a discrete Laplacian operator and $f$ is related to the divergence of $u^*$. The pressure $p$ is solved on an interior subgrid defined by indices $i, j \\in \\{2, 3, \\dots, N-3\\}$, with homogeneous Dirichlet boundary conditions ($p=0$) on the boundary of this subgrid. For all schemes, we assume density $\\rho=1$.\n\n### Discrete Operators\n\nWe define several discrete operators:\n1.  **Cell-centered Divergence ($\\nabla_c \\cdot$):** A standard second-order central difference applied to a cell-centered vector field.\n    $$\n    (\\nabla_c \\cdot \\mathbf{u})_{i,j} = \\frac{u_{x,i+1,j} - u_{x,i-1,j}}{2h} + \\frac{u_{y,i,j+1} - u_{y,i,j-1}}{2h}\n    $$\n2.  **Cell-centered Gradient ($\\nabla_c$):** A standard second-order central difference.\n    $$\n    (\\nabla_c p)_{i,j} = \\left( \\frac{p_{i+1,j} - p_{i-1,j}}{2h}, \\frac{p_{i,j+1} - p_{i,j-1}}{2h} \\right)\n    $$\n3.  **Face-based Divergence ($\\nabla_f \\cdot$):** The standard finite-volume divergence using velocities at cell faces (e.g., at $i\\pm1/2, j$ and $i, j\\pm1/2$).\n    $$\n    (\\nabla_f \\cdot \\mathbf{u})_{i,j} = \\frac{u_{x,i+1/2,j} - u_{x,i-1/2,j}}{h} + \\frac{u_{y,i,j+1/2} - u_{y,i,j-1/2}}{h}\n    $$\n4.  **Face-based Gradient ($\\nabla_f$):** A gradient computed on cell faces.\n    $$\n    (\\nabla_{f,x} p)_{i+1/2,j} = \\frac{p_{i+1,j} - p_{i,j}}{h}\n    $$\n5.  **Standard 5-point Laplacian ($L_{5pt}$):** Arises from $\\nabla_f \\cdot \\nabla_f p$.\n    $$\n    (L_{5pt} p)_{i,j} = \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2}\n    $$\n6.  **Wide-stencil Laplacian ($L_{wide}$):** Arises from $\\nabla_c \\cdot \\nabla_c p$.\n    $$\n    (L_{wide} p)_{i,j} = \\frac{p_{i+2,j} + p_{i-2,j} + p_{i,j+2} + p_{i,j-2} - 4p_{i,j}}{4h^2}\n    $$\nThe right-hand side for the pressure equation in all variants is derived from the divergence of $u^*$. A consistent choice for all schemes is the cell-centered divergence, $(\\nabla_c \\cdot u^*)$.\n\n### Three Projection Variants\n\n**1. Naive Collocated Scheme (noRC)**\nThis scheme uses inconsistent operators, which is known to cause pressure-velocity decoupling. The corrected velocity at cell centers is $u^{n+1} = u^* - \\Delta t \\nabla_c p$. The incompressibility constraint is enforced on the face velocities, which are simple averages of cell-center velocities. This leads to the pressure equation involving the wide-stencil Laplacian:\n$$\nL_{wide} p = \\frac{1}{\\Delta t} (\\nabla_c \\cdot u^*)\n$$\nAfter solving for $p$, the corrected velocities $u^{n+1}$ are computed at cell centers. The divergence for the metric is calculated using the finite-volume approach ($\\nabla_f \\cdot$) with face velocities obtained by averaging the corrected cell-centered velocities. This scheme is expected to exhibit strong pressure checkerboarding.\n\n**2. Rhie-Chow Interpolation Scheme (RC)**\nThis scheme introduces a specific interpolation for face velocities that remedies the decoupling issue. The face-normal velocity correction is proportional to the face-normal pressure gradient $\\nabla_f p$.\n$$\nu^{n+1}_{x,i+1/2,j} = \\bar{u}^*_{x,i+1/2,j} - \\Delta t (\\nabla_{f,x} p)_{i+1/2,j}\n$$\nwhere $\\bar{u}^*$ denotes simple averaging. Enforcing $\\nabla_f \\cdot u^{n+1} = 0$ leads to a pressure equation with the standard 5-point Laplacian:\n$$\nL_{5pt} p = \\frac{1}{\\Delta t} (\\nabla_c \\cdot u^*)\n$$\nThe operator $L_{5pt}$ couples adjacent pressure nodes, effectively suppressing high-frequency oscillations. After solving for $p$, the corrected velocities are computed directly at the faces, and the divergence norm metric is based on these. This scheme should yield a very small checkerboard amplitude $\\alpha$ and a divergence norm close to zero.\n\n**3. \"Exact\" Discrete Projection Scheme (exact)**\nThis variant is designed to highlight the importance of using consistent discrete operators. It solves the same pressure equation as the Rhie-Chow scheme, using the stable 5-point Laplacian:\n$$\nL_{5pt} p = \\frac{1}{\\Delta t} (\\nabla_c \\cdot u^*)\n$$\nThus, the resulting pressure field $p_{exact}$ is identical to $p_{RC}$, and so $\\alpha_{exact} = \\alpha_{RC}$. However, the velocity correction is then performed using the cell-centered gradient, inconsistent with the Laplacian used:\n$$\nu^{n+1} = u^* - \\Delta t \\nabla_c p\n$$\nThe divergence metric is then computed using the cell-centered divergence operator $\\nabla_c \\cdot u^{n+1}$. Because the operators are inconsistent ($L_{5pt} \\neq \\nabla_c \\cdot \\nabla_c$), the resulting divergence will not be zero. We expect a small $\\alpha$ but a non-trivial divergence norm.\n\n### Implementation Strategy\nFor each test case:\n1.  Initialize the grid properties ($N, h$) and the intermediate velocity field $u^*$.\n2.  Define the interior computational grid, of size $M \\times M$ where $M = N-4$.\n3.  Compute the RHS for the pressure equation, $f = \\frac{1}{\\Delta t} (\\nabla_c \\cdot u^*)$, on the interior grid.\n4.  For each variant:\n    a.  Construct the corresponding sparse matrix for the discrete Laplacian ($L_{wide}$ or $L_{5pt}$) incorporating homogeneous Dirichlet boundary conditions.\n    b.  Solve the linear system $L p = f$ for the pressure field $p$ on the interior grid.\n    c.  Pad the interior solution with zeros to obtain a full $N \\times N$ pressure field.\n    d.  Compute the corrected velocity field $u^{n+1}$ according to the variant's definition (cell-centered or face-centered).\n    e.  Compute the divergence of $u^{n+1}$ using the appropriate discrete operator.\n    f.  Calculate the two required metrics: the checkerboard amplitude $\\alpha$ and the RMS norm of the divergence, $\\|\\nabla \\cdot u^{n+1}\\|_2$, on the interior grid.\n5.  Collect and return the six resulting floating-point values.",
            "answer": "```python\nimport numpy as np\nimport scipy.sparse\nimport scipy.sparse.linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (16, 1e-3, 0.2),  # Test case 1\n        (8, 1e-3, 0.3),   # Test case 2\n        (24, 1e-3, 0.1),  # Test case 3\n    ]\n\n    results = []\n    for N, dt, epsilon in test_cases:\n        case_results = run_single_case(N, dt, epsilon)\n        results.extend(case_results)\n\n    # Format output as a comma-separated list of floats inside brackets\n    print(f\"[{','.join(f'{r:.6e}' for r in results)}]\")\n\ndef run_single_case(N, dt, epsilon):\n    \"\"\"\n    Implements the three projection variants for a single test case.\n    \"\"\"\n    h = 1.0 / N\n    if N  5:  # Interior grid must have positive size\n        return [np.nan] * 6\n    M = N - 4\n    \n    int_slice = np.s_[2:N-2, 2:N-2]\n    \n    # Setup grid and intermediate velocity\n    coords = (np.arange(N) + 0.5) * h\n    x, y = np.meshgrid(coords, coords, indexing='ij')\n\n    u_star_x = np.sin(2 * np.pi * y) + epsilon * ((-1) ** np.arange(N))[:, np.newaxis]\n    u_star_y = np.sin(2 * np.pi * x) - epsilon * ((-1) ** np.arange(N))[np.newaxis, :]\n\n    # Common Part: RHS from divergence of u*\n    div_u_star_full = (u_star_x[2:, 1:-1] - u_star_x[:-2, 1:-1]) / (2 * h) + \\\n                      (u_star_y[1:-1, 2:] - u_star_y[1:-1, :-2]) / (2 * h)\n    div_u_star_int = div_u_star_full[1:N-3, 1:N-3] # Extract interior corresponding to [2:N-2] on N-grid\n\n    # --- Variant 1: Naive (noRC) ---\n    A_noRC = scipy.sparse.lil_matrix((M*M, M*M))\n    for i in range(M): # M-grid index\n        for j in range(M):\n            k = i * M + j\n            A_noRC[k, k] = -4.0\n            if i >= 2:   A_noRC[k, k - 2 * M] = 1.0\n            if i = M-3: A_noRC[k, k + 2 * M] = 1.0\n            if j >= 2:   A_noRC[k, k - 2] = 1.0\n            if j = M-3: A_noRC[k, k + 2] = 1.0\n    \n    b_noRC = (4 * h**2 / dt) * div_u_star_int.flatten()\n    p_vec_noRC = scipy.sparse.linalg.spsolve(A_noRC.tocsr(), b_noRC)\n    p_int_noRC = p_vec_noRC.reshape((M, M))\n    \n    p_full_noRC = np.zeros((N, N))\n    p_full_noRC[int_slice] = p_int_noRC\n    \n    grad_p_x_c = (p_full_noRC[2:, 1:-1] - p_full_noRC[:-2, 1:-1]) / (2 * h)\n    grad_p_y_c = (p_full_noRC[1:-1, 2:] - p_full_noRC[1:-1, :-2]) / (2 * h)\n    u_np1_x = u_star_x.copy(); u_np1_y = u_star_y.copy()\n    u_np1_x[1:-1, 1:-1] -= dt * grad_p_x_c\n    u_np1_y[1:-1, 1:-1] -= dt * grad_p_y_c\n    \n    u_face_x = 0.5 * (u_np1_x[:-1, :] + u_np1_x[1:, :])\n    u_face_y = 0.5 * (u_np1_y[:, :-1] + u_np1_y[:, 1:])\n    \n    div_u_np1_full = (u_face_x[1:, 1:-1] - u_face_x[:-1, 1:-1]) / h + \\\n                     (u_face_y[1:-1, 1:] - u_face_y[1:-1, :-1]) / h\n    div_u_np1_int_noRC = div_u_np1_full[1:N-3, 1:N-3]\n\n    div_norm_noRC, alpha_noRC = compute_metrics(p_int_noRC, div_u_np1_int_noRC)\n\n    # --- Variant 2: Rhie-Chow (RC) ---\n    A_RC = scipy.sparse.lil_matrix((M*M, M*M))\n    for i in range(M):\n        for j in range(M):\n            k = i * M + j\n            A_RC[k, k] = -4.0\n            if i > 0:   A_RC[k, k - M] = 1.0\n            if i  M-1: A_RC[k, k + M] = 1.0\n            if j > 0:   A_RC[k, k - 1] = 1.0\n            if j  M-1: A_RC[k, k + 1] = 1.0\n\n    b_RC = (h**2 / dt) * div_u_star_int.flatten()\n    p_vec_RC = scipy.sparse.linalg.spsolve(A_RC.tocsr(), b_RC)\n    p_int_RC = p_vec_RC.reshape((M, M))\n    \n    p_full_RC = np.zeros((N, N))\n    p_full_RC[int_slice] = p_int_RC\n\n    u_star_face_x = 0.5 * (u_star_x[:-1, :] + u_star_x[1:, :])\n    u_star_face_y = 0.5 * (u_star_y[:, :-1] + u_star_y[:, 1:])\n    grad_p_x_f = (p_full_RC[1:, :] - p_full_RC[:-1, :]) / h\n    grad_p_y_f = (p_full_RC[:, 1:] - p_full_RC[:, :-1]) / h\n    u_np1_face_x = u_star_face_x - dt * grad_p_x_f\n    u_np1_face_y = u_star_face_y - dt * grad_p_y_f\n\n    div_u_np1_full_rc = (u_np1_face_x[1:, 1:-1] - u_np1_face_x[:-1, 1:-1]) / h + \\\n                        (u_np1_face_y[1:-1, 1:] - u_np1_face_y[1:-1, :-1]) / h\n    div_u_np1_int_RC = div_u_np1_full_rc[1:N-3, 1:N-3]\n\n    div_norm_RC, alpha_RC = compute_metrics(p_int_RC, div_u_np1_int_RC)\n\n    # --- Variant 3: \"Exact\" Discrete Projection ---\n    p_int_exact = p_int_RC\n    p_full_exact = p_full_RC\n    alpha_exact = alpha_RC\n\n    grad_p_x_c_ex = (p_full_exact[2:, 1:-1] - p_full_exact[:-2, 1:-1]) / (2 * h)\n    grad_p_y_c_ex = (p_full_exact[1:-1, 2:] - p_full_exact[1:-1, :-2]) / (2 * h)\n    \n    u_np1_x_ex = u_star_x.copy(); u_np1_y_ex = u_star_y.copy()\n    u_np1_x_ex[1:-1, 1:-1] -= dt * grad_p_x_c_ex\n    u_np1_y_ex[1:-1, 1:-1] -= dt * grad_p_y_c_ex\n\n    div_u_np1_full_ex = (u_np1_x_ex[2:, 1:-1] - u_np1_x_ex[:-2, 1:-1]) / (2 * h) + \\\n                        (u_np1_y_ex[1:-1, 2:] - u_np1_y_ex[1:-1, :-2]) / (2 * h)\n    div_u_np1_int_exact = div_u_np1_full_ex[1:N-3, 1:N-3]\n    \n    div_norm_exact, _ = compute_metrics(p_int_exact, div_u_np1_int_exact)\n    \n    return [div_norm_noRC, alpha_noRC, div_norm_RC, alpha_RC, div_norm_exact, alpha_exact]\n\ndef compute_metrics(p_int, div_u_np1_int):\n    \"\"\"\n    Computes the pressure checkerboard amplitude and divergence norm.\n    \"\"\"\n    M = p_int.shape[0]\n    i_m, j_m = np.meshgrid(np.arange(M), np.arange(M), indexing='ij')\n    v = (-1)**(i_m + 2 + j_m + 2) # Use original grid indices for checkerboard pattern\n\n    norm_p = np.linalg.norm(p_int)\n    norm_v = np.linalg.norm(v)\n\n    if norm_p  1e-15:\n        alpha = 0.0\n    else:\n        alpha = np.abs(np.sum(p_int * v)) / (norm_p * norm_v)\n\n    div_norm = np.linalg.norm(div_u_np1_int) / M if M > 0 else 0.0\n    \n    return div_norm, alpha\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}