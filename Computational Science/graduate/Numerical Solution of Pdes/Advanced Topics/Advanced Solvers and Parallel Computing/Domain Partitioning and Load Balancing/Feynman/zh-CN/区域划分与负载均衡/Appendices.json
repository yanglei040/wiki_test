{
    "hands_on_practices": [
        {
            "introduction": "理论上的改进最终必须通过实际性能的提升来验证。本实践旨在将负载均衡的抽象概念与具体的性能指标联系起来，你将使用一个标准的并行性能模型，分析重新分区前后的性能剖析数据，从而量化计算不平衡和通信开销的改善所带来的实际加速效果。这个练习将帮助你掌握评估分区策略有效性的基本技能 。",
            "id": "3382812",
            "problem": "考虑一个用于三维椭圆型偏微分方程的隐式求解器，该求解器采用有限体积离散化，并使用消息传递接口 (MPI) 在分布式内存高性能计算 (HPC) 集群上执行。在每次非线性迭代中，求解器在子域上进行计算，并与邻居交换幽灵数据。并行迭代时间被建模为计算时间和通信时间之和，其中计算时间由最慢的进程决定（以考虑负载不均衡）。形式上，对于给定分区的一次迭代，总时间定义为 $T_{\\text{total}}=T_{\\text{comp}}+T_{\\text{comm}}$，其中 $T_{\\text{comp}}=\\gamma\\,\\bar{t}_{\\text{comp}}$ 且 $\\gamma=\\frac{t_{\\text{comp}}^{\\max}}{\\bar{t}_{\\text{comp}}}$ 是不均衡因子。\n\n一个包含 $P=64$ 个进程的基线分区，在 60 次迭代中聚合的性能剖析数据如下：\n- 重新分区前每次迭代的平均每进程计算时间：$\\bar{t}_{\\text{comp}}^{\\text{b}}=0.011\\,\\text{s}$。\n- 重新分区前的不均衡因子：$\\gamma^{\\text{b}}=1.09$。\n- 重新分区前每次迭代的主要通信时间：$t_{\\text{comm}}^{\\text{b}}=0.0040\\,\\text{s}$。\n- 重新分区前总迭代时间的样本均值和样本标准差：$\\bar{t}_{\\text{total}}^{\\text{b}}=0.01599\\,\\text{s}$ 和 $s^{\\text{b}}=0.0012\\,\\text{s}$。\n\n应用了基于图的重新分区以减少不均衡和进程间边界的数量。60 次迭代后新的性能剖析数据如下：\n- 重新分区后每次迭代的平均每进程计算时间：$\\bar{t}_{\\text{comp}}^{\\text{a}}=0.0103\\,\\text{s}$。\n- 重新分区后的不均衡因子：$\\gamma^{\\text{a}}=1.02$。\n- 重新分区后每次迭代的主要通信时间：$t_{\\text{comm}}^{\\text{a}}=0.0028\\,\\text{s}$。\n- 重新分区后总迭代时间的样本均值和样本标准差：$\\bar{t}_{\\text{total}}^{\\text{a}}=0.013306\\,\\text{s}$ 和 $s^{\\text{a}}=0.0009\\,\\text{s}$。\n\n仅使用上述基本定义，完成以下任务：\n1. 根据各分量时间，计算由重新分区带来的预期加速比 $S$，定义为 $S=\\frac{T_{\\text{total}}^{\\text{b}}}{T_{\\text{total}}^{\\text{a}}}$。\n2. 通过执行双样本 Welch t检验（不等方差）来评估总迭代时间的观察到的变化是否具有统计显著性，检验的原假设为重新分区前后的平均总迭代时间相等，显著性水平为 $\\alpha=0.01$。报告检验统计量、近似自由度和双边 p 值，并说明该变化是否显著。\n\n将预期加速比 $S$ 四舍五入到四位有效数字。最终提供的数值答案是四舍五入后的预期加速比 $S$，不带单位。所有中间量可以使用秒作为单位。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、是良构的且客观的。\n\n### 步骤 1：提取已知条件\n给定的数据和定义如下：\n- 总迭代时间模型：$T_{\\text{total}}=T_{\\text{comp}}+T_{\\text{comm}}$\n- 计算时间模型：$T_{\\text{comp}}=\\gamma\\,\\bar{t}_{\\text{comp}}$，其中 $\\gamma$ 是不均衡因子。\n- 进程数：$P=64$\n- 每个样本的迭代次数：$N=60$\n- 统计检验的显著性水平：$\\alpha=0.01$\n\n- 重新分区前的数据（基线）：\n  - 平均每进程计算时间：$\\bar{t}_{\\text{comp}}^{\\text{b}}=0.011\\,\\text{s}$\n  - 不均衡因子：$\\gamma^{\\text{b}}=1.09$\n  - 通信时间：$t_{\\text{comm}}^{\\text{b}}=0.0040\\,\\text{s}$\n  - 总时间的样本均值：$\\bar{t}_{\\text{total}}^{\\text{b}}=0.01599\\,\\text{s}$\n  - 总时间的样本标准差：$s^{\\text{b}}=0.0012\\,\\text{s}$\n\n- 重新分区后的数据：\n  - 平均每进程计算时间：$\\bar{t}_{\\text{comp}}^{\\text{a}}=0.0103\\,\\text{s}$\n  - 不均衡因子：$\\gamma^{\\text{a}}=1.02$\n  - 通信时间：$t_{\\text{comm}}^{\\text{a}}=0.0028\\,\\text{s}$\n  - 总时间的样本均值：$\\bar{t}_{\\text{total}}^{\\text{a}}=0.013306\\,\\text{s}$\n  - 总时间的样本标准差：$s^{\\text{a}}=0.0009\\,\\text{s}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题基于并行计算原理和数值模拟性能建模，具有科学依据。计算和通信时间的模型是该领域的标准模型。这些数值对于 HPC 模拟是符合实际的。该问题是良构的，为所要求的计算提供了所有必要的数据。检查所提供数据的一致性：\n- 建模的重新分区前总时间：$T_{\\text{total}}^{\\text{b}} = \\gamma^{\\text{b}}\\,\\bar{t}_{\\text{comp}}^{\\text{b}} + t_{\\text{comm}}^{\\text{b}} = (1.09)(0.011\\,\\text{s}) + 0.0040\\,\\text{s} = 0.01199\\,\\text{s} + 0.0040\\,\\text{s} = 0.01599\\,\\text{s}$。这与提供的样本均值 $\\bar{t}_{\\text{total}}^{\\text{b}}$ 相匹配。\n- 建模的重新分区后总时间：$T_{\\text{total}}^{\\text{a}} = \\gamma^{\\text{a}}\\,\\bar{t}_{\\text{comp}}^{\\text{a}} + t_{\\text{comm}}^{\\text{a}} = (1.02)(0.0103\\,\\text{s}) + 0.0028\\,\\text{s} = 0.010506\\,\\text{s} + 0.0028\\,\\text{s} = 0.013306\\,\\text{s}$。这与提供的样本均值 $\\bar{t}_{\\text{total}}^{\\text{a}}$ 相匹配。\n该问题内部一致、客观，并且不包含科学缺陷、歧义或缺失信息。\n\n### 步骤 3：结论与操作\n问题有效。将提供解答。\n\n### 第 1 部分：预期加速比计算\n预期加速比 $S$ 是重新分区前的总迭代时间与重新分区后的总迭代时间之比。总时间使用提供的性能模型计算。\n\n重新分区前的总时间 $T_{\\text{total}}^{\\text{b}}$ 为：\n$$T_{\\text{total}}^{\\text{b}} = T_{\\text{comp}}^{\\text{b}} + T_{\\text{comm}}^{\\text{b}} = \\gamma^{\\text{b}}\\,\\bar{t}_{\\text{comp}}^{\\text{b}} + t_{\\text{comm}}^{\\text{b}}$$\n代入给定值：\n$$T_{\\text{total}}^{\\text{b}} = (1.09)(0.011) + 0.0040 = 0.01199 + 0.0040 = 0.01599\\,\\text{s}$$\n\n重新分区后的总时间 $T_{\\text{total}}^{\\text{a}}$ 为：\n$$T_{\\text{total}}^{\\text{a}} = T_{\\text{comp}}^{\\text{a}} + T_{\\text{comm}}^{\\text{a}} = \\gamma^{\\text{a}}\\,\\bar{t}_{\\text{comp}}^{\\text{a}} + t_{\\text{comm}}^{\\text{a}}$$\n代入给定值：\n$$T_{\\text{total}}^{\\text{a}} = (1.02)(0.0103) + 0.0028 = 0.010506 + 0.0028 = 0.013306\\,\\text{s}$$\n\n预期加速比 $S$ 定义为：\n$$S = \\frac{T_{\\text{total}}^{\\text{b}}}{T_{\\text{total}}^{\\text{a}}}$$\n代入计算出的总时间：\n$$S = \\frac{0.01599}{0.013306} \\approx 1.2017135$$\n按要求四舍五入到四位有效数字，我们得到：\n$$S \\approx 1.202$$\n\n### 第 2 部分：统计显著性检验\n为了评估总迭代时间的变化是否具有统计显著性，我们进行双样本 Welch t检验，检验原假设 $H_0: \\mu_{\\text{b}} = \\mu_{\\text{a}}$ 与备择假设 $H_1: \\mu_{\\text{b}} \\neq \\mu_{\\text{a}}$，其中 $\\mu_{\\text{b}}$ 和 $\\mu_{\\text{a}}$ 分别是重新分区前后的真实平均总迭代时间。显著性水平为 $\\alpha=0.01$。\n\n样本数据为：\n- 样本 1（重新分区前）：样本量 $n_1=60$，样本均值 $\\bar{x}_1 = \\bar{t}_{\\text{total}}^{\\text{b}} = 0.01599$，样本标准差 $s_1 = s^{\\text{b}} = 0.0012$。\n- 样本 2（重新分区后）：样本量 $n_2=60$，样本均值 $\\bar{x}_2 = \\bar{t}_{\\text{total}}^{\\text{a}} = 0.013306$，样本标准差 $s_2 = s^{\\text{a}} = 0.0009$。\n\nWelch t-统计量的计算公式为：\n$$t = \\frac{\\bar{x}_1 - \\bar{x}_2}{\\sqrt{\\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}}$$\n代入数值：\n$$t = \\frac{0.01599 - 0.013306}{\\sqrt{\\frac{(0.0012)^2}{60} + \\frac{(0.0009)^2}{60}}} = \\frac{0.002684}{\\sqrt{\\frac{1.44 \\times 10^{-6}}{60} + \\frac{0.81 \\times 10^{-6}}{60}}}$$\n$$t = \\frac{0.002684}{\\sqrt{2.4 \\times 10^{-8} + 1.35 \\times 10^{-8}}} = \\frac{0.002684}{\\sqrt{3.75 \\times 10^{-8}}} \\approx \\frac{0.002684}{1.93649 \\times 10^{-4}} \\approx 13.86$$\n检验统计量为 $t \\approx 13.86$。\n\n自由度 $\\nu$ 使用 Welch-Satterthwaite 方程近似计算：\n$$\\nu \\approx \\frac{\\left( \\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2} \\right)^2}{\\frac{(s_1^2/n_1)^2}{n_1-1} + \\frac{(s_2^2/n_2)^2}{n_2-1}} = \\frac{\\left( 3.75 \\times 10^{-8} \\right)^2}{\\frac{(2.4 \\times 10^{-8})^2}{59} + \\frac{(1.35 \\times 10^{-8})^2}{59}}$$\n$$\\nu \\approx \\frac{1.40625 \\times 10^{-15}}{\\frac{5.76 \\times 10^{-16}}{59} + \\frac{1.8225 \\times 10^{-16}}{59}} = \\frac{1.40625 \\times 10^{-15}}{(9.7627 \\times 10^{-18}) + (3.0890 \\times 10^{-18})} \\approx \\frac{1.40625 \\times 10^{-15}}{1.28517 \\times 10^{-17}} \\approx 109.4$$\n近似自由度为 $\\nu \\approx 109.4$。\n\n对于自由度 $\\nu \\approx 109.4$、检验统计量 $t \\approx 13.86$ 的双边检验，p 值由 $P(|T| > 13.86)$ 给出，其中 $T$ 服从自由度为 109.4 的 t 分布。这是一个极大的 t 值，表明 p 值非常小。p 值远小于任何常规显著性水平，即 $p \\ll 0.0001$。\n\n检验结论：由于 p 值远小于指定的显著性水平 $\\alpha=0.01$，我们拒绝原假设 $H_0$。这意味着有极强的统计证据表明，观察到的总迭代时间减少并非由随机偶然造成。该变化具有统计显著性。\n\n统计结果摘要：\n- 检验统计量：$t \\approx 13.86$\n- 近似自由度：$\\nu \\approx 109.4$\n- 双边 p 值：$p \\ll 0.0001$\n- 结论：在 $\\alpha=0.01$ 的水平上，平均总迭代时间的变化具有统计显著性。\n\n问题要求仅提供计算出的加速比 $S$ 作为最终答案。",
            "answer": "$$\\boxed{1.202}$$"
        },
        {
            "introduction": "在掌握了如何衡量分区性能之后，我们将深入探讨不同分区策略在特定应用场景下的理论表现。现实世界中的网格往往具有高度各向异性，这对分区算法提出了严峻挑战。本实践要求你进行渐进分析，以理解为何简单的空间填充曲线在此类网格上可能表现不佳，并揭示更先进的、能够感知各向异性的图分区方法在何种性能区间内具有优势 。",
            "id": "3382849",
            "problem": "给定一个二维边界层网格，该网格源于在固定物理尺寸的矩形域上对偏微分方程进行数值求解。该网格具有高度各向异性的单元，其纵横比 $a \\gg 1$，定义为近壁处单元的切向尺寸与法向尺寸之比。设网格单元总数为 $N$，分布在逻辑矩形网格上，其中流向有 $n_x$ 个单元，壁面法向有 $n_y$ 个单元，因此 $n_x n_y = N$。在物理尺寸固定的情况下，各向异性意味着 $n_x \\asymp N^{1/2} a^{-1/2}$ 且 $n_y \\asymp N^{1/2} a^{1/2}$。该网格被划分给 $P$ 个相同的处理器。\n\n通信量（记为 $V$）被建模为被分区切割的唯一跨分区网格邻接（图边）的总数。您将比较三类分区方法：\n\n- 基于在 $n_x \\times n_y$ 网格上定义的 Morton（Z序）或 Hilbert 曲线的连续段的空间填充曲线（SFC）分区。其通信量分别表示为 $V_M$ 和 $V_H$。\n- 一种“最优”的多级图划分器，它可以通过沿长边方向将切口对齐为条带状来利用各向异性，产生的通信量为 $V_G$。\n\n使用以下源于核心几何原理的建模假设：\n\n- 对于一个由 $A_b$ 个网格单元组成的连通集，其中 $A_b \\ll n_x n_y$，以网格边为单位的最小界面长度满足等周标度律 $L_{\\min}(A_b) \\asymp \\min\\{\\kappa_1 \\sqrt{A_b}, \\kappa_2 A_b/n_x\\}$。其中第一项对应于近似方形的形状，第二项对应于当宽度饱和到 $n_x$ 时的“条带状”形状。这里的 $\\kappa_1$ 和 $\\kappa_2$ 是与 $a$、$N$ 和 $P$ 无关的常数。\n- Hilbert 空间填充曲线（SFC）的连续范围会产生一个单一的连通块，其界面长度在 $L_{\\min}(A_b)$ 的一个常数因子范围内；而 Morton SFC 块具有相同的渐近指数，但常数更大。因此，出于标度分析的目的，在忽略常数的情况下，可以取 $L_H(A_b) \\asymp \\min\\{\\sqrt{A_b}, A_b/n_x\\}$ 和 $L_M(A_b) \\asymp \\min\\{\\sqrt{A_b}, A_b/n_x\\}$。\n- 通过取 $P$ 个相等的连续 SFC 段进行分区，会产生 $P$ 个块，每个块的面积为 $A_b = N/P$。SFC 分区的唯一切割边总数标度为 $V_{\\mathrm{SFC}} \\asymp \\tfrac{P}{2} L_{\\mathrm{SFC}}(A_b)$，不考虑与 $a$、$N$ 和 $P$ 无关的常数。\n- 与长边对齐的条带分区会切割短边 $n_y$，产生 $P-1$ 个长度为 $n_x$ 的边界，因此主导项为 $V_G \\asymp n_x P$。（注：原文为切割短边$n_x$，应为切割长边，即沿短边$n_y$方向切割，产生$n_x$长度的边界，模型无误。）\n\n任务：\n\n- 从上述基本标度关系和通信量作为对偶图中切割规模的定义出发，推导 $V_H(a,P,N)$ 和 $V_M(a,P,N)$ 作为 $a$、$P$ 和 $N$ 的函数的渐近公式，包括由约束 $A_b \\le n_x^2$ 引起的 $P$ 相对于 $a$ 的区间变化。\n- 通过比较 $V_H$（或 $V_M$）与 $V_G$，确定空间填充曲线性能不及条带对齐图分区的区间。\n- 最后，确定渐近临界处理器数量 $P^{\\star}(a)$。在该数量下，对于 $a \\gg 1$ 的情况，在忽略常数因子和低阶项的前提下，Hilbert SFC 的通信量与条带图划分器的通信量在主导项上相匹配。\n\n请以仅包含 $a$ 的单个闭式表达式的形式提供您的最终答案 $P^{\\star}(a)$。不需要进行数值舍入，也不需要报告单位。在推导过程中请明确说明您使用的任何中间区间条件，但请确保最终报告的量仅为 $P^{\\star}(a)$。",
            "solution": "首先对用户提供的问题进行严格的验证程序。\n\n### 步骤1：提取已知条件\n- **网格属性**：在固定物理尺寸域中的二维逻辑矩形边界层网格。\n- **各向异性**：单元纵横比 $a \\gg 1$。\n- **网格尺寸**：总单元数 $N$，流向有 $n_x$ 个单元，壁面法向有 $n_y$ 个单元。\n- **网格标度关系**：$n_x n_y = N$，$n_x \\asymp N^{1/2} a^{-1/2}$，$n_y \\asymp N^{1/2} a^{1/2}$。\n- **并行化**：网格被划分给 $P$ 个相同的处理器。\n- **通信量 ($V$)**：被切割的唯一网格边的总数。\n- **分区方法和通信量模型**：\n    - 空间填充曲线（SFC）分区（$V_M$, $V_H$）：切割边总数标度为 $V_{\\mathrm{SFC}} \\asymp \\frac{P}{2} L_{\\mathrm{SFC}}(A_b)$，其中 $A_b = N/P$。为进行标度分析，取 $V_{\\mathrm{SFC}} \\asymp P \\cdot L_{\\mathrm{SFC}}(A_b)$。\n    - 面积为 $A_b$ 的 SFC 块的界面长度被建模为 $L_H(A_b) \\asymp \\min\\{\\sqrt{A_b}, A_b/n_x\\}$ 和 $L_M(A_b) \\asymp \\min\\{\\sqrt{A_b}, A_b/n_x\\}$，忽略常数。\n    - 条带图划分器 ($V_G$)：通信量标度为 $V_G \\asymp n_x P$。\n- **约束**：注意到与条件 $A_b \\le n_x^2$ 相关的区间变化。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题在并行科学计算领域有充分的依据，特别是在结构化各向异性网格上求解偏微分方程的区域分解方法的性能分析方面。网格各向异性、空间填充曲线、图划分和通信量标度等概念在该领域是标准内容。该问题与指定主题*偏微分方程的数值解法*中的*区域划分和负载均衡*直接相关。\n- **适定性**：该问题提供了一套完整的标度关系和定义，足以推导出所需量。任务陈述清晰，可得唯一的渐近结果。\n- **客观性**：问题以精确、客观和技术性的语言陈述，不含主观论断。\n\n### 步骤3：结论与操作\n该问题被判定为**有效**，因为它在科学上是合理的、适定的和客观的。将提供完整解答。\n\n### 解答推导\n\n分析过程如下：首先推导每种分区策略通信量的渐近标度律，然后进行比较以找到临界处理器数量 $P^{\\star}(a)$。渐近等价用 $\\asymp$ 表示，在求解 $P^{\\star}$ 时，由于我们忽略了常数因子，因此将其视为等号。\n\n**1. SFC 通信量的渐近公式 ($V_H$, $V_M$)**\n\nSFC 分区的通信量由 $V_{\\mathrm{SFC}} \\asymp P \\cdot L_{\\mathrm{SFC}}(A_b)$ 给出，其中块面积为 $A_b = N/P$。单个块的界面长度为 $L_{\\mathrm{SFC}}(A_b) \\asymp \\min\\{\\sqrt{A_b}, A_b/n_x\\}$。\n\n$\\min$ 函数的行为取决于 $\\sqrt{A_b}$ 和 $A_b/n_x$ 之间的比较。当 $\\sqrt{A_b} = A_b/n_x$ 时，两项相等，这意味着 $\\sqrt{A_b} = n_x$，或 $A_b = n_x^2$。我们来确定这个转换点上关于 $P$ 的条件。\n$$A_b = n_x^2 \\implies \\frac{N}{P} = \\left(N^{1/2} a^{-1/2}\\right)^2 = \\frac{N}{a} \\implies P = a$$\n这为处理器数量 $P$ 相对于各向异性 $a$ 定义了两个区间。\n\n物理上，“近方形”块的周长与 $\\sqrt{A_b}$ 成正比，这只有在块的“自然”边长 $\\sqrt{A_b}$ 小于网格的最窄维度 $n_x$ 时才可能。当 $\\sqrt{A_b} > n_x$ 时，块的形状被迫拉伸成“条带状”，其周长由更窄的维度主导，即 $A_b/n_x$。因此：\n- 当 $\\sqrt{A_b} \\le n_x$ (即 $A_b \\le n_x^2$, $P \\ge a$) 时，块是“近方形”的，$L_{\\mathrm{SFC}}(A_b) \\asymp \\sqrt{A_b}$。\n- 当 $\\sqrt{A_b} > n_x$ (即 $A_b > n_x^2$, $P  a$) 时，块是“条带状”的，$L_{\\mathrm{SFC}}(A_b) \\asymp A_b/n_x$。\n\n现在我们计算 $V_{\\mathrm{SFC}} \\asymp P \\cdot L_{\\mathrm{SFC}}(A_b)$：\n- 对于 $P \\ge a$（小块，“近方形”）：$V_{\\mathrm{SFC}} \\asymp P \\sqrt{A_b} = P \\sqrt{N/P} = \\sqrt{NP}$。\n- 对于 $P  a$（大块，“条带状”）：$V_{\\mathrm{SFC}} \\asymp P \\cdot \\frac{A_b}{n_x} = P \\cdot \\frac{N/P}{n_x} = \\frac{N}{n_x}$。代入 $n_x \\asymp N^{1/2} a^{-1/2}$，我们得到 $V_{\\mathrm{SFC}} \\asymp \\frac{N}{N^{1/2} a^{-1/2}} = N^{1/2} a^{1/2}$。\n\n所以，$V_H$ 和 $V_M$ 的渐近公式是：\n$$V_{\\mathrm{SFC}}(a,P,N) \\asymp \\begin{cases} N^{1/2} a^{1/2}   \\text{若 } P  a \\\\ \\sqrt{NP}  \\text{若 } P \\ge a \\end{cases}$$\n这表明，当处理器数量较少时，通信成本是恒定的，由网格各向异性决定。当处理器数量较多时，成本随 $\\sqrt{P}$ 增长。\n\n**2. 条带划分器的渐近公式 ($V_G$)**\n\n条带图划分器的模型为 $V_G \\asymp n_x P$。代入 $n_x$ 的标度关系：\n$$V_G(a,P,N) \\asymp (N^{1/2} a^{-1/2}) P = P N^{1/2} a^{-1/2}$$\n\n**3. 比较和确定性能不佳的区间**\n\n我们在 $P$ 的两个区间内比较 $V_{\\mathrm{SFC}}$ 和 $V_G$。\n-   **区间 1：$P  a$**\n    $V_{\\mathrm{SFC}} \\asymp N^{1/2} a^{1/2}$。\n    $V_G \\asymp P N^{1/2} a^{-1/2}$。\n    比值为 $\\frac{V_{\\mathrm{SFC}}}{V_G} \\asymp \\frac{N^{1/2} a^{1/2}}{P N^{1/2} a^{-1/2}} = \\frac{a}{P}$。\n    由于 $P  a$ 且 $a \\gg 1$，该比值 $> 1$。因此，$V_{\\mathrm{SFC}} > V_G$。在此区间内，与能感知各向异性的条带划分器相比，空间填充曲线的性能较差。\n\n-   **区间 2：$P \\ge a$**\n    $V_{\\mathrm{SFC}} \\asymp \\sqrt{NP} = N^{1/2} P^{1/2}$。\n    $V_G \\asymp P N^{1/2} a^{-1/2}$。\n    比值为 $\\frac{V_{\\mathrm{SFC}}}{V_G} \\asymp \\frac{N^{1/2} P^{1/2}}{P N^{1/2} a^{-1/2}} = \\frac{P^{1/2}}{P a^{-1/2}} = \\frac{a^{1/2}}{P^{1/2}} = \\sqrt{\\frac{a}{P}}$。\n    由于 $P \\ge a$，该比值小于或等于1。因此，$V_{\\mathrm{SFC}} \\le V_G$。在此区间内，空间填充曲线的性能优于或等于条带划分器。\n\nSFC 性能不佳的区间是 $P  a$。\n\n**4. 确定临界处理器数量 $P^{\\star}(a)$**\n\n临界处理器数量 $P^{\\star}(a)$ 是通信量相等时的 $P$ 值，即 $V_H(P^{\\star}) \\asymp V_G(P^{\\star})$。根据我们上面的分析，在 $P=a$ 点，两种成本从 $V_G  V_{\\mathrm{SFC}}$ 过渡到 $V_G \\ge V_{\\mathrm{SFC}}$。我们可以通过在边界处令表达式相等来验证这一点。\n在 $P=a$ 时：\n$$V_{\\mathrm{SFC}}(a,a,N) \\asymp \\sqrt{Na}$$\n$$V_G(a,a,N) \\asymp a \\cdot N^{1/2} a^{-1/2} = N^{1/2} a^{1/2} = \\sqrt{Na}$$\n在 $P=a$ 时，两个表达式渐近相等。因此，临界处理器数量为 $P^{\\star}(a) = a$。这表明，在高度各向异性的网格上，要使 Hilbert 曲线分区的竞争力与最优条带分区相当，处理器数量必须与网格的纵横比成比例。\n最终结果要求仅用 $a$ 表示。\n\n$$P^{\\star}(a) \\asymp a$$",
            "answer": "$$\\boxed{a}$$"
        },
        {
            "introduction": "最后的实践将分区与性能建模的概念融合到一个整体优化问题中。在诸如加性 Schwarz 方法等区域分解方法中，选择分区方案只是第一步，子域间的重叠量是另一个关键的可调参数。本练习将构建一个复杂的性能模型，该模型描述了增加重叠以改善收敛速度与增加每次迭代成本之间的权衡，并要求你找出最小化总求解时间的最优重叠大小 。",
            "id": "3382824",
            "problem": "您需要设计并实现一个程序，该程序为一个应用于二维椭圆偏微分方程的加性 Schwarz 预条件子选择最优的整数重叠大小 $\\delta$（以网格点为单位）。选择依据是一个每次迭代成本和收敛率模型，该模型取决于重叠大小、模板半径和区域划分。目标是最小化总求解时间 $T(\\delta)$，该时间定义为迭代次数与每次迭代时间的乘积。程序必须为几个指定的测试用例计算最优的 $\\delta$，并将所有结果输出在同一行中。\n\n假设以下基本且经过充分检验的事实成立。\n\n- 对于条件数为 $\\kappa$ 的对称正定线性系统，预处理共轭梯度法至少需要\n$$\nn_{\\text{iter}} \\ge \\tfrac{1}{2} \\sqrt{\\kappa} \\, \\ln\\!\\bigl(\\tfrac{2}{\\varepsilon}\\bigr)\n$$\n次迭代，才能将相对误差降低到预定容差 $\\varepsilon$ 以下，其中 $\\ln$ 是自然对数。\n\n- 对于在二维椭圆算子上使用加性 Schwarz 预条件子的重叠区域分解，其中子区域特征直径为 $H$，重叠为 $\\delta$（以网格点为单位），严格的理论给出了一个形式如下的界\n$$\n\\kappa(\\delta) \\le C_{\\kappa} \\, \\bigl(1 + \\tfrac{H}{\\delta}\\bigr)^{2},\n$$\n其中 $C_{\\kappa} \\ge 1$ 是一个无量纲常数，反映了算子、网格正则性和粗空间的性质。在实践中，最小允许有效重叠受网格分辨率的限制；将 $\\delta$ 解释为网格点单位，并在使用此界时取 $\\delta_{\\text{eff}} = \\max(1,\\delta)$。如果 $\\delta=0$（非重叠块雅可比），您可以通过在迭代次数上乘以一个常数因子 $\\phi_{0} \\ge 1$ 来模拟额外的性能下降。\n\n- 在一个被划分为 $P_x \\times P_y$ 个子区域的逻辑处理器网格的均匀二维网格上，对于一个同步最近邻迭代方法，其每次迭代的时间由最慢的子区域决定。使用一个包含延迟和带宽的标准线性通信模型：\n    - 每个子区域与其最多4个面邻居交换厚度等于模板半径 $k$（以网格点为单位）的光环数据。设 $k$ 为模板半径，因此在所需光环厚度的意义上，$k=1$ 对应于5点模板，$k=2$ 对应于9点模板。\n    - 在一个网格点上计算一次模板更新的时间是 $\\alpha$ 秒（修正：与模板大小无关），这反映了浮点运算量。\n    - 每次邻居交换产生 $\\lambda$ 秒的延迟成本，以及每通信一个网格点 $\\nu$ 秒的带宽成本。在二维中交换厚度为 $k$ 的光环，需要在每个对应的面上发送 $k$ 个高度等于局部扩展子区域高度的列和 $k$ 个宽度等于局部扩展子区域宽度的行。\n\n- 考虑一个包含 $N_x \\times N_y$ 个点的均匀矩形全局网格，该网格被划分为 $P_x \\times P_y$ 个矩形子区域。核心（非重叠）子区域的大小沿每个坐标轴尽可能均匀地分布：沿x轴，前 $r_x = N_x \\bmod P_x$ 个子区域的大小为 $\\lceil N_x / P_x \\rceil$，其余 $P_x - r_x$ 个子区域的大小为 $\\lfloor N_x / P_x \\rfloor$；y轴同理。$\\delta$ 个网格点的重叠将每个子区域向每个内部面扩展 $\\delta$；在全局边界处，没有超出物理域的扩展，因此在边界一侧的扩展仅在内部面上进行。因此，对于一个核心大小为 $n_x \\times n_y$ 且在x和y方向上都位于内部的子区域，其扩展后的大小为 $(n_x + 2\\delta)\\times(n_y + 2\\delta)$；在x方向上位于边界、y方向上位于内部的子区域，其大小为 $(n_x + \\delta)\\times(n_y + 2\\delta)$；在x和y方向上都位于边界的子区域，其大小为 $(n_x + \\delta)\\times(n_y + \\delta)$。\n\n- 对于一个扩展大小为 $n_x^{\\text{ext}} \\times n_y^{\\text{ext}}$ 的子区域，其每次迭代的计算时间为\n$$\nt_{\\text{comp}} = \\alpha \\, n_x^{\\text{ext}} \\, n_y^{\\text{ext}}.\n$$\n该子区域每次迭代的通信时间为\n$$\nt_{\\text{comm}} = \\lambda \\, n_{\\text{nbr}} \\;+\\; \\nu \\, k \\, \\bigl( n_{\\text{nbr},x} n_y^{\\text{ext}} + n_{\\text{nbr},y} n_x^{\\text{ext}} \\bigr),\n$$\n其中 $n_{\\text{nbr}} \\in \\{2,3,4\\}$ 是面邻居的总数，$n_{\\text{nbr},x}$ 和 $n_{\\text{nbr},y}$ 分别是x和y方向上的邻居数。整个并行步骤的每次迭代时间是所有子区域的 $t_{\\text{comp}} + t_{\\text{comm}}$ 的最大值。\n\n- 设子区域特征直径 $H$ 取为在上述均匀分布下，沿x或y方向的核心子区域边长的最大值（以网格点为单位）。\n\n对于每个测试用例，您的程序必须计算最优的整数重叠 $\\delta^{\\star} \\in \\{0,1,2,\\dots,\\delta_{\\max}\\}$，以最小化\n$$\nT(\\delta) \\;=\\; n_{\\text{iter}}(\\delta) \\;\\cdot\\; t_{\\text{iter}}(\\delta),\n$$\n其中\n$$\nn_{\\text{iter}}(\\delta) \\;=\\; \\left\\lceil \\tfrac{1}{2} \\, \\sqrt{\\kappa(\\delta)} \\, \\ln\\!\\bigl(\\tfrac{2}{\\varepsilon}\\bigr) \\cdot \\bigl( \\phi_{0} \\text{ if } \\delta=0 \\text{ else } 1 \\bigr) \\right\\rceil,\n\\quad\n\\kappa(\\delta) \\;=\\; C_{\\kappa} \\, \\bigl( 1 + \\tfrac{H}{\\delta_{\\text{eff}}} \\bigr)^{2},\n\\quad\n\\delta_{\\text{eff}} \\;=\\; \\max(1,\\delta),\n$$\n且 $t_{\\text{iter}}(\\delta)$ 定义为如上所述的所有子区域的 $t_{\\text{comp}} + t_{\\text{comm}}$ 的最大值。如果存在多个 $\\delta$ 得到相同最小值，则选择最小的那个 $\\delta$ 来达到最小 $T(\\delta)$。\n\n测试套件。对于每组参数元组，使用所述的精确定义和单位。时间单位为秒。\n\n- 案例 #1：$N_x=4096$, $N_y=4096$, $P_x=8$, $P_y=8$, $k=1$, $\\alpha=4\\times 10^{-10}$, $\\lambda=5\\times 10^{-6}$, $\\nu=8\\times 10^{-10}$, $C_{\\kappa}=4$, $\\varepsilon=10^{-8}$, $\\phi_{0}=3$, $\\delta_{\\max}=8$。\n- 案例 #2：$N_x=4096$, $N_y=4096$, $P_x=4$, $P_y=4$, $k=1$, $\\alpha=4\\times 10^{-10}$, $\\lambda=5\\times 10^{-5}$, $\\nu=8\\times 10^{-10}$, $C_{\\kappa}=4$, $\\varepsilon=10^{-8}$, $\\phi_{0}=3$, $\\delta_{\\max}=8$。\n- 案例 #3：$N_x=8192$, $N_y=1024$, $P_x=16$, $P_y=2$, $k=3$, $\\alpha=4\\times 10^{-10}$, $\\lambda=5\\times 10^{-6}$, $\\nu=8\\times 10^{-10}$, $C_{\\kappa}=6$, $\\varepsilon=10^{-8}$, $\\phi_{0}=3$, $\\delta_{\\max}=12$。\n- 案例 #4：$N_x=3000$, $N_y=3000$, $P_x=7$, $P_y=7$, $k=1$, $\\alpha=3\\times 10^{-10}$, $\\lambda=1\\times 10^{-5}$, $\\nu=1\\times 10^{-9}$, $C_{\\kappa}=5$, $\\varepsilon=10^{-8}$, $\\phi_{0}=3$, $\\delta_{\\max}=10$。\n- 案例 #5：$N_x=2048$, $N_y=2048$, $P_x=32$, $P_y=32$, $k=1$, $\\alpha=2\\times 10^{-10}$, $\\lambda=1\\times 10^{-6}$, $\\nu=2\\times 10^{-9}$, $C_{\\kappa}=4$, $\\varepsilon=10^{-8}$, $\\phi_{0}=3$, $\\delta_{\\max}=6$。\n\n最终输出格式。您的程序应生成一行输出，按顺序包含测试用例的最优重叠，格式为用方括号括起来的逗号分隔列表，例如 $[d_1,d_2,\\dots,d_5]$，其中每个 $d_i$ 是案例 $i$ 的最优整数 $\\delta^{\\star}$。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它提出了一个适定的优化问题，该问题基于并行数值方法的标准性能模型，并提供了所有必要的参数和定义。\n\n总体目标是在范围 $\\{0, 1, \\dots, \\delta_{\\max}\\}$ 内找到整数重叠大小 $\\delta^{\\star}$，以最小化总求解时间 $T(\\delta)$。该时间被建模为收敛所需的迭代次数 $n_{\\text{iter}}(\\delta)$ 与每次迭代所用时间 $t_{\\text{iter}}(\\delta)$ 的乘积。\n$$\nT(\\delta) = n_{\\text{iter}}(\\delta) \\cdot t_{\\text{iter}}(\\delta)\n$$\n因此，最优重叠 $\\delta^{\\star}$ 是最小化此函数的参数：\n$$\n\\delta^{\\star} = \\underset{\\delta \\in \\{0, 1, \\dots, \\delta_{\\max}\\}}{\\arg\\min} T(\\delta)\n$$\n如果出现平局（即多个 $\\delta$ 得到相同最小值），则选择最小的 $\\delta$ 值。求解需要对每个允许的整数 $\\delta$ 值系统地评估 $T(\\delta)$，并找出产生最小时间的那个值。这涉及到从给定的模型中推导 $n_{\\text{iter}}(\\delta)$ 和 $t_{\\text{iter}}(\\delta)$ 的表达式。\n\n### 迭代次数, $n_{\\text{iter}}(\\delta)$\n\n迭代次数由预处理共轭梯度法的收敛特性决定，这又取决于预处理系统的条件数 $\\kappa(\\delta)$。模型由下式给出：\n$$\nn_{\\text{iter}}(\\delta) = \\left\\lceil \\tfrac{1}{2} \\, \\sqrt{\\kappa(\\delta)} \\, \\ln\\!\\bigl(\\tfrac{2}{\\varepsilon}\\bigr) \\cdot M(\\delta) \\right\\rceil\n$$\n其中 $\\varepsilon$ 是误差容差，$M(\\delta)$ 是一个乘法因子，定义为：\n$$\nM(\\delta) = \\begin{cases} \\phi_0  \\text{if } \\delta=0 \\\\ 1  \\text{if } \\delta > 0 \\end{cases}\n$$\n条件数 $\\kappa(\\delta)$ 本身取决于特征子区域直径 $H$ 与有效重叠 $\\delta_{\\text{eff}}$ 的比值：\n$$\n\\kappa(\\delta) = C_{\\kappa} \\left( 1 + \\frac{H}{\\delta_{\\text{eff}}} \\right)^{2}, \\quad \\text{with } \\delta_{\\text{eff}} = \\max(1, \\delta)\n$$\n特征直径 $H$ 是沿每个坐标轴的最大核心子区域维数的最大值。对于一个在 $P_x \\times P_y$ 个处理器之间划分的 $N_x \\times N_y$ 点的全局网格，最大的核心维度是 $\\lceil N_x / P_x \\rceil$ 和 $\\lceil N_y / P_y \\rceil$。因此，\n$$\nH = \\max\\left(\\lceil N_x / P_x \\rceil, \\lceil N_y / P_y \\rceil\\right)\n$$\n随着 $\\delta$ 的增加，$\\delta_{\\text{eff}}$ 也增加，导致当 $\\delta \\ge 1$ 时，$\\kappa(\\delta)$ 以及因此的 $n_{\\text{iter}}(\\delta)$ 单调递减。$\\delta=0$ 的情况引入了一个惩罚因子 $\\phi_0$。\n\n### 每次迭代时间, $t_{\\text{iter}}(\\delta)$\n\n每次迭代的时间 $t_{\\text{iter}}(\\delta)$ 由并行计算中最慢的子区域决定。对于任何给定的子区域 $p$，其单次迭代时间 $t_p$ 是其计算时间 $t_{\\text{comp}, p}$ 和通信时间 $t_{\\text{comm}, p}$ 的总和。\n$$\nt_{\\text{iter}}(\\delta) = \\max_{p} \\left( t_{\\text{comp}, p}(\\delta) + t_{\\text{comm}, p}(\\delta) \\right)\n$$\n该时间的组成部分建模如下：\n$$\nt_{\\text{comp}, p} = \\alpha \\, n_x^{\\text{ext}} \\, n_y^{\\text{ext}}\n$$\n$$\nt_{\\text{comm}, p} = \\lambda \\, n_{\\text{nbr}} + \\nu \\, k \\, \\bigl( n_{\\text{nbr},x} n_y^{\\text{ext}} + n_{\\text{nbr},y} n_x^{\\text{ext}} \\bigr)\n$$\n这里，$\\alpha$、 $k$、 $\\lambda$ 和 $\\nu$ 是与计算和通信性能相关的常数。项 $n_{x,p}^{\\text{ext}}$、 $n_{y,p}^{\\text{ext}}$ 和 $n_{\\text{nbr},p}$ 是特定子区域 $p$ 的属性：其扩展维度和邻居数量，这些属性取决于其核心维度和在处理器网格中的位置。\n\n子区域的属性由其处理器网格索引 $(i, j)$ 决定，其中 $i \\in \\{0, \\dots, P_x-1\\}$ 且 $j \\in \\{0, \\dots, P_y-1\\}$。\n核心维度由下式给出：\n$$\nn_{x,i}^{\\text{core}} = \\begin{cases} \\lceil N_x / P_x \\rceil   \\text{if } i  (N_x \\bmod P_x) \\\\ \\lfloor N_x / P_x \\rfloor   \\text{otherwise} \\end{cases}\n$$\n$$\nn_{y,j}^{\\text{core}} = \\begin{cases} \\lceil N_y / P_y \\rceil   \\text{if } j  (N_y \\bmod P_y) \\\\ \\lfloor N_y / P_y \\rfloor   \\text{otherwise} \\end{cases}\n$$\n扩展维度是通过为每个内面添加重叠 $\\delta$ 来找到的：\n$$\nn_{x,i}^{\\text{ext}} = n_{x,i}^{\\text{core}} + \\delta \\cdot ( (1 \\text{ if } i > 0) + (1 \\text{ if } i  P_x-1) )\n$$\n$$\nn_{y,j}^{\\text{ext}} = n_{y,j}^{\\text{core}} + \\delta \\cdot ( (1 \\text{ if } j > 0) + (1 \\text{ if } j  P_y-1) )\n$$\n邻居的数量为：\n$$\nn_{\\text{nbr},ij} = (1 \\text{ if } i > 0) + (1 \\text{ if } i  P_x-1) + (1 \\text{ if } j > 0) + (1 \\text{ if } j  P_y-1)\n$$\n子区域的时间 $t_p(\\delta)$ 是其核心维度、扩展维度和邻居数量的单调递增函数。为了找到最大时间 $t_{\\text{iter}}(\\delta)$，我们必须确定这些因素组合起来最大的子区域。这需要比较一小组代表性子区域的总时间，这些子区域捕获了所有大/小核心维度和角/边/内部位置的独特组合。一个足够检查的代表性处理器索引 $(i,j)$ 集合包括来自 $\\{0, 1, r_x, r_x+1, P_x-1\\}$ 的 x-索引组合，y-索引类似，以确保评估所有不同的配置。\n\n### 算法解\n\n优化过程如下：\n1. 对于给定的测试用例，预先计算所有与 $\\delta$ 无关的参数，例如子区域核心大小和特征直径 $H$。\n2. 将最小时间 $T_{\\min}$ 初始化为无穷大，将最优重叠 $\\delta^{\\star}$ 初始化为一个无效值。\n3. 遍历从 $0$ 到 $\\delta_{\\max}$ 的每个整数 $\\delta$。\n    a. 使用上述公式计算 $n_{\\text{iter}}(\\delta)$。\n    b. 通过在所有代表性子区域配置中找到最大时间来计算 $t_{\\text{iter}}(\\delta)$。对于每个代表性处理器索引对 $(i,j)$：\n        i. 确定其核心大小、扩展大小和邻居数量。\n        ii. 计算其总迭代时间 $t_{i,j}(\\delta)$。\n        iii. 这些计算出的时间的最大值即为 $t_{\\text{iter}}(\\delta)$。\n    c. 计算总求解时间 $T(\\delta) = n_{\\text{iter}}(\\delta) \\cdot t_{\\text{iter}}(\\delta)$。\n    d. 如果 $T(\\delta)  T_{\\min}$，则更新 $T_{\\min} = T(\\delta)$ 和 $\\delta^{\\star} = \\delta$。\n4. 循环完成后，$\\delta^{\\star}$ 的最终值就是该测试用例的最优重叠。对所有测试用例重复此过程。",
            "answer": "$$\\boxed{[4,1,6,4,2]}$$"
        }
    ]
}