{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the finite element method lies in constructing system matrices from element-level contributions. This exercise guides you through the essential process of deriving the element matrix for the Streamline-Upwind/Petrov-Galerkin (SUPG) method applied to a one-dimensional convection-diffusion problem. Mastering this hands-on derivation  is the first crucial step toward implementing and understanding stabilized numerical schemes.",
            "id": "3397671",
            "problem": "Consider the one-dimensional steady convection–diffusion boundary value problem on the open interval $\\Omega=(0,L)$ with homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(L)=0$,\n$$\n-\\epsilon\\,u''(x) + a\\,u'(x) = f(x), \\quad x\\in(0,L),\n$$\nwhere $\\epsilon>0$ and $a\\in\\mathbb{R}\\setminus\\{0\\}$ are constant coefficients and $f(x)$ is a given source. Discretize $\\Omega$ with a uniform mesh of $N$ elements of length $h=L/N$, and let $V_h$ denote the space of continuous, piecewise linear ($P_1$) functions subordinate to this mesh that vanish at $x=0$ and $x=L$. Consider the Streamline-Upwind/Petrov–Galerkin (SUPG) stabilized formulation, interpreted in the residual-based Galerkin/least-squares sense, in which the test space is modified elementwise by adding a streamline term proportional to the directional derivative along the convection field. Specifically, for an arbitrary but elementwise-constant stabilization parameter $\\tau>0$ that may depend on $h$, $a$, and $\\epsilon$, use test functions of the form $v_h + \\tau\\,a\\,v_h'$ with $v_h\\in V_h$.\n\nStarting from the standard weak form and the residual-based SUPG augmentation under the assumption of piecewise linear trial functions (so that elementwise second derivatives vanish), derive the explicit $2\\times 2$ element matrices on a generic element $K=[x_i,x_{i+1}]$ in terms of the local hat functions $\\varphi_1$ and $\\varphi_2$ and their derivatives, and then assemble the global linear system for the interior nodes. Work only with the bilinear (left-hand side) contributions, and assume $a$ and $\\epsilon$ are constant on $\\Omega$. Your derivation must begin from the weak form and the definition of the SUPG residual and proceed by computing exact element integrals using the properties of $P_1$ basis functions.\n\nFinally, for the assembled tridiagonal system associated with the interior node equations, express the three nonzero coefficients at node $i$—the subdiagonal coefficient $\\ell$ (coupling $u_{i-1}$), the diagonal coefficient $d$ (coupling $u_i$), and the superdiagonal coefficient $u$ (coupling $u_{i+1}$)—purely in terms of $\\epsilon$, $a$, $h$, and $\\tau$. Provide your final answer as a single row matrix $\\begin{pmatrix}\\ell & d & u\\end{pmatrix}$ containing these three closed-form analytic expressions. No numerical evaluation is required, and no rounding should be performed.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique, verifiable solution. We may therefore proceed with the derivation.\n\nThe starting point is the strong form of the one-dimensional steady convection–diffusion equation on the domain $\\Omega=(0,L)$:\n$$\n-\\epsilon\\,u''(x) + a\\,u'(x) = f(x)\n$$\nwith homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(L)=0$. The coefficients $\\epsilon>0$ and $a\\in\\mathbb{R}\\setminus\\{0\\}$ are constants.\n\nThe standard Galerkin weak formulation seeks a solution $u_h$ from a finite-dimensional trial space $V_h$ such that for all test functions $v_h \\in V_h$:\n$$\n\\int_0^L (-\\epsilon\\,u_h'' + a\\,u_h') v_h \\,dx = \\int_0^L f v_h \\,dx\n$$\nIntegrating the second-order term by parts and applying the boundary conditions $v_h(0)=v_h(L)=0$ yields the bilinear form $B(u_h, v_h)$:\n$$\nB(u_h, v_h) = \\int_0^L \\left(\\epsilon\\,u_h' v_h' + a\\,u_h' v_h\\right) dx\n$$\n\nThe Streamline-Upwind/Petrov–Galerkin (SUPG) method modifies the test function to $w_h = v_h + \\delta_h$ where $\\delta_h$ is a perturbation chosen to enhance stability. As specified, the test functions are of the form $v_h + \\tau a v_h'$, where $\\tau>0$ is a constant stabilization parameter on each element. The SUPG weak formulation is to find $u_h \\in V_h$ such that for all $v_h \\in V_h$:\n$$\n\\int_0^L (-\\epsilon u_h'' + a u_h' - f) (v_h + \\tau a v_h') \\,dx = 0\n$$\nThis is a residual-based method where we require the residual $R(u_h) = -\\epsilon u_h'' + a u_h' - f$ to be orthogonal to the modified test space. Focusing on the bilinear form (left-hand side), we have:\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L (-\\epsilon u_h'' + a u_h') (v_h + \\tau a v_h') \\,dx\n$$\nExpanding this expression gives:\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L (-\\epsilon u_h'' + a u_h') v_h \\,dx + \\int_0^L (-\\epsilon u_h'' + a u_h') (\\tau a v_h') \\,dx\n$$\nThe first term, after integration by parts, is the standard Galerkin bilinear form $B(u_h, v_h)$. The second term is the stabilization term. The problem specifies the use of continuous, piecewise linear ($P_1$) basis functions for $V_h$. For such functions, the second derivative $u_h''$ is zero within each element $K$. Applying this simplification, the stabilization term becomes:\n$$\n\\int_0^L (a u_h') (\\tau a v_h') \\,dx = \\sum_{K} \\int_K \\tau a^2 u_h' v_h' \\,dx\n$$\nCombining the Galerkin and stabilization parts, the full SUPG bilinear form is:\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L \\left(\\epsilon u_h' v_h' + a u_h' v_h\\right) dx + \\sum_{K} \\int_K \\tau a^2 u_h' v_h' \\,dx\n$$\nSince the integrals can be computed element by element, we can write the contribution from a single generic element $K=[x_i, x_{i+1}]$ of length $h = x_{i+1} - x_i$ as:\n$$\nB_{SUPG}^K(u_h, v_h) = \\int_K \\left[(\\epsilon + \\tau a^2) u_h' v_h' + a u_h' v_h\\right] dx\n$$\nTo derive the element matrix, we use the local linear basis functions (\"hat functions\") on a reference element $[0,1]$ via the mapping $\\xi = (x - x_i)/h$. The local basis functions are:\n$$\n\\varphi_1(\\xi) = 1 - \\xi \\quad \\text{and} \\quad \\varphi_2(\\xi) = \\xi\n$$\nTheir derivatives with respect to $x$ are:\n$$\n\\frac{d\\varphi_1}{dx} = \\frac{d\\varphi_1}{d\\xi}\\frac{d\\xi}{dx} = (-1)\\frac{1}{h} = -\\frac{1}{h}\n$$\n$$\n\\frac{d\\varphi_2}{dx} = \\frac{d\\varphi_2}{d\\xi}\\frac{d\\xi}{dx} = (1)\\frac{1}{h} = \\frac{1}{h}\n$$\nThe $2\\times 2$ element matrix $A^K$ has entries $A^K_{jk} = B_{SUPG}^K(\\varphi_k, \\varphi_j)$, where $j$ indexes the test function and $k$ indexes the trial function. Using the change of variable $dx = h\\,d\\xi$:\n$$\nA^K_{jk} = \\int_{x_i}^{x_{i+1}} \\left[(\\epsilon + \\tau a^2) \\varphi_k' \\varphi_j' + a \\varphi_k' \\varphi_j\\right] dx = \\frac{\\epsilon + \\tau a^2}{h} \\int_0^1 \\frac{d\\varphi_k}{d\\xi}\\frac{d\\varphi_j}{d\\xi} d\\xi + a \\int_0^1 \\frac{d\\varphi_k}{d\\xi} \\varphi_j d\\xi\n$$\nWe compute the two integral matrices. First, the \"stiffness\" part: $S_{jk} = \\int_0^1 \\frac{d\\varphi_j}{d\\xi}\\frac{d\\varphi_k}{d\\xi} d\\xi$.\n$$\nS = \\begin{pmatrix} \\int_0^1(-1)(-1)d\\xi & \\int_0^1(-1)(1)d\\xi \\\\ \\int_0^1(1)(-1)d\\xi & \\int_0^1(1)(1)d\\xi \\end{pmatrix} = \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n$$\nSecond, the \"convection\" part: $C_{jk} = \\int_0^1 \\varphi_j \\frac{d\\varphi_k}{d\\xi} d\\xi$.\n$$\nC_{11} = \\int_0^1 (1-\\xi)(-1)d\\xi = -\\frac{1}{2}, \\quad C_{12} = \\int_0^1 (1-\\xi)(1)d\\xi = \\frac{1}{2}\n$$\n$$\nC_{21} = \\int_0^1 (\\xi)(-1)d\\xi = -\\frac{1}{2}, \\quad C_{22} = \\int_0^1 (\\xi)(1)d\\xi = \\frac{1}{2}\n$$\nSo, the matrix $C$ is $C = \\begin{pmatrix} -1/2 & 1/2 \\\\ -1/2 & 1/2 \\end{pmatrix}$.\nThe element matrix $A^K$ is thus:\n$$\nA^K = \\frac{\\epsilon + \\tau a^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + a \\begin{pmatrix} -1/2 & 1/2 \\\\ -1/2 & 1/2 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2} & -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\\\ -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2} & \\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}\n$$\nWe assemble the global system for an interior node $i$. The equation for the unknown $u_i$ is formed by setting the test function to the global basis function $\\phi_i$. Node $i$ is connected to nodes $i-1$ and $i+1$ through elements $K_{i-1}=[x_{i-1}, x_i]$ and $K_i=[x_i, x_{i+1}]$.\nThe coefficient for $u_{i-1}$ (subdiagonal, $\\ell$) is the coupling between trial function $\\phi_{i-1}$ and test function $\\phi_i$. This occurs on element $K_{i-1}$, where $\\phi_{i-1}$ is the first local basis function ($\\varphi_1$) and $\\phi_i$ is the second ($\\varphi_2$). The coefficient is $A^K_{21}$.\n$$\n\\ell = A^K_{21} = -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}\n$$\nThe coefficient for $u_{i+1}$ (superdiagonal, $u$) is the coupling between trial function $\\phi_{i+1}$ and test function $\\phi_i$. This occurs on element $K_i$, where $\\phi_i$ is the first local basis function ($\\varphi_1$) and $\\phi_{i+1}$ is the second ($\\varphi_2$). The coefficient is $A^K_{12}$.\n$$\nu = A^K_{12} = -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2}\n$$\nThe coefficient for $u_i$ (diagonal, $d$) is the coupling of $\\phi_i$ with itself. It receives a contribution from $K_{i-1}$, where $\\phi_i$ is the second local basis function ($\\varphi_2$), giving $A^K_{22}$. It also receives a contribution from $K_i$, where $\\phi_i$ is the first local basis function ($\\varphi_1$), giving $A^K_{11}$. The total coefficient is the sum.\n$$\nd = A^K_{11} + A^K_{22} = \\left(\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}\\right) + \\left(\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2}\\right) = \\frac{2(\\epsilon + \\tau a^2)}{h}\n$$\nThe three nonzero coefficients for the equation at interior node $i$ are therefore fully determined.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2} & \\frac{2(\\epsilon + \\tau a^2)}{h} & -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The true value of a numerical method is revealed in its performance. This computational practice provides a direct demonstration of why stabilization is crucial for advection-dominated problems by tasking you to compare the standard Galerkin method against its SUPG-stabilized counterpart. You will quantitatively measure the suppression of unphysical oscillations , gaining a concrete appreciation for the power of Galerkin/least-squares techniques.",
            "id": "3397663",
            "problem": "Consider the steady one-dimensional advection-diffusion boundary value problem on the unit interval, posed as follows: find a scalar field $u(x)$ satisfying\n$$\n-\\varepsilon \\, u''(x) + a \\, u'(x) = 0 \\quad \\text{for } x \\in (0,1),\n$$\nwith Dirichlet boundary conditions\n$$\nu(0) = 1, \\quad u(1) = 0,\n$$\nwhere $\\varepsilon &gt; 0$ is the diffusion coefficient and $a \\neq 0$ is the constant advection speed. You will discretize this problem using continuous, piecewise-linear finite elements on a uniform mesh with $N$ elements and adopt two formulations:\n- the standard Bubnov-Galerkin method (denoted \"Galerkin\"),\n- the Streamline Upwind Petrov-Galerkin (SUPG) stabilization, a member of the Galerkin/Least-Squares family, with a constant element-wise stabilization parameter $\\tau = \\frac{h}{2 |a|}$, where $h = \\frac{1}{N}$ is the uniform element size.\n\nStarting from the strong form, use the standard variational framework to motivate each discrete formulation. Then implement both discrete operators explicitly by assembling the global matrices from element contributions. For linear shape functions on a uniform mesh and constant coefficients, you may rely on canonical local contributions derived from the definitions of the bilinear forms, but you must preserve the non-symmetric advection operator exactly as it arises from the variational form.\n\nDefine the \"Gibbs-like oscillation amplitude\" of a discrete solution $u_h$ as the sum of the overshoot above the upper boundary value and the undershoot below the lower boundary value:\n$$\n\\mathcal{A}(u_h) \\;=\\; \\max\\!\\big(0, \\max_{x \\in [0,1]} u_h(x) - 1 \\big) \\;+\\; \\max\\!\\big(0, 0 - \\min_{x \\in [0,1]} u_h(x) \\big).\n$$\nOn a uniform mesh, evaluate $\\mathcal{A}(u_h)$ at the nodal values.\n\nYour task is to implement a complete program that:\n- assembles and solves the linear systems for both the Galerkin and SUPG formulations,\n- computes $\\mathcal{A}(u_h)$ for both formulations,\n- reports the quantitative reduction in oscillation achieved by SUPG relative to Galerkin.\n\nUse the following test suite of parameter sets $(N, \\varepsilon, a)$:\n- Case $\\#1$: $(N, \\varepsilon, a) = (40, 10^{-2}, 1)$,\n- Case $\\#2$: $(N, \\varepsilon, a) = (80, 10^{-4}, 1)$,\n- Case $\\#3$: $(N, \\varepsilon, a) = (40, 10^{-6}, 1)$.\n\nFor each case, compute three floats:\n- $A_G = \\mathcal{A}(u_h^{\\text{Galerkin}})$,\n- $A_S = \\mathcal{A}(u_h^{\\text{SUPG}})$,\n- $\\Delta = A_G - A_S$.\n\nThe final program output must be a single line in the format\n$$\n\\big[ A_G^{(1)}, A_S^{(1)}, \\Delta^{(1)}, A_G^{(2)}, A_S^{(2)}, \\Delta^{(2)}, A_G^{(3)}, A_S^{(3)}, \\Delta^{(3)} \\big],\n$$\nnamely a single Python-style list containing the nine results for the three cases in order, with entries separated by commas and no additional text. All computations are nondimensional; no physical units are required. Angles are not used. Percentages are not used: all results are real numbers. Ensure your implementation is general with respect to $(N, \\varepsilon, a)$ as specified, and that the assembly and boundary condition enforcement are mathematically consistent with the stated discretizations.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard benchmark problem in the numerical analysis of partial differential equations, complete with all necessary data and definitions for a unique solution. The chosen parameters are designed to highlight the known deficiencies of the Bubnov-Galerkin method in advection-dominated regimes and the efficacy of the SUPG stabilization technique.\n\nThe problem is to solve the steady one-dimensional advection-diffusion equation on the domain $x \\in (0,1)$:\n$$\n-\\varepsilon u''(x) + a u'(x) = 0\n$$\nsubject to Dirichlet boundary conditions $u(0) = 1$ and $u(1) = 0$. Here, $\\varepsilon > 0$ is the diffusion coefficient and $a \\neq 0$ is the constant advection speed.\n\nTo derive the finite element formulations, we first establish the weak (variational) form of the problem. We multiply the governing equation by a test function $v(x)$ from a suitable space of functions $W$ and integrate over the domain $\\Omega = (0,1)$:\n$$\n\\int_0^1 (-\\varepsilon u'' + a u') v \\, dx = 0\n$$\nApplying integration by parts to the second-order diffusion term, $-\\int_0^1 \\varepsilon u'' v \\, dx = \\int_0^1 \\varepsilon u' v' \\, dx - [\\varepsilon u' v]_0^1$, yields:\n$$\n\\int_0^1 (\\varepsilon u' v' + a u' v) \\, dx - [\\varepsilon u' v]_0^1 = 0\n$$\nTo handle the essential boundary conditions on $u$, we seek a solution $u$ in a trial space $V$ whose members satisfy these conditions. The test functions $v$ are chosen from a space $W_0$ where the functions vanish at the boundaries where Dirichlet conditions are specified, i.e., $v(0) = v(1) = 0$. This choice eliminates the boundary term $[\\varepsilon u' v]_0^1$. The weak formulation is then: Find $u \\in V$ such that $u(0)=1, u(1)=0$, that for all $v \\in W_0$ satisfies:\n$$\nB(u, v) = \\int_0^1 (\\varepsilon u' v' + a u' v) \\, dx = 0\n$$\nThe term $B(u, v)$ is a bilinear form. The problem is discretized using the finite element method on a uniform mesh of $N$ elements, with element size $h=1/N$. The nodes are located at $x_i = i h$ for $i=0, 1, \\dots, N$. The solution $u(x)$ is approximated by a continuous, piecewise-linear function $u_h(x) = \\sum_{j=0}^N U_j \\phi_j(x)$, where $U_j$ are the nodal values of the solution and $\\phi_j(x)$ are the standard linear \"hat\" basis functions.\n\nThe Bubnov-Galerkin formulation uses the same space for trial and test functions, so $v_h(x)$ is also a linear combination of the basis functions $\\phi_j(x)$. The discrete system is assembled from element-level contributions. On a generic element $\\Omega_e = [x_e, x_{e+1}]$ of length $h$, the local basis functions are $N_1(x) = (x_{e+1}-x)/h$ and $N_2(x) = (x-x_e)/h$, with derivatives $N_1'(x) = -1/h$ and $N_2'(x) = 1/h$. The $2 \\times 2$ element stiffness matrix $\\mathbf{k}^e_G$ has entries $k^e_{ij} = B(\\phi_j, \\phi_i)|_{\\Omega_e}$, which, using local coordinates, are $k^e_{\\alpha\\beta} = \\int_{\\Omega_e} (\\varepsilon N_\\beta' N_\\alpha' + a N_\\beta' N_\\alpha) \\, dx$, where $\\alpha, \\beta \\in \\{1,2\\}$.\nThe diffusion part is $\\mathbf{k}^e_{diff} = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$.\nThe advection part is $\\mathbf{k}^e_{adv} = \\frac{a}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix}$.\nThe Galerkin element matrix is the sum:\n$$\n\\mathbf{k}^e_G = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + \\frac{a}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\varepsilon}{h} - \\frac{a}{2} & -\\frac{\\varepsilon}{h} + \\frac{a}{2} \\\\ -\\frac{\\varepsilon}{h} - \\frac{a}{2} & \\frac{\\varepsilon}{h} + \\frac{a}{2} \\end{pmatrix}\n$$\nThis matrix, when assembled, leads to a centered difference approximation for the advection term, which is prone to spurious oscillations when advection dominates diffusion (i.e., when the element Peclet number $Pe_h = |a|h/(2\\varepsilon) > 1$).\n\nThe Streamline Upwind Petrov-Galerkin (SUPG) method introduces a stabilization term to the weak form to address these oscillations. The modified weak form is:\n$$\nB(u_h, v_h) + \\sum_{e=0}^{N-1} \\int_{\\Omega_e} \\mathcal{R}(u_h) \\, \\mathcal{P}(v_h) \\, dx = 0\n$$\nwhere $\\mathcal{R}(u_h) = -\\varepsilon u_h'' + a u_h'$ is the residual of the strong form and $\\mathcal{P}(v_h)$ is a perturbation to the test function. For SUPG stabilization, the perturbation is aligned with the streamline direction, $\\mathcal{P}(v_h) = \\tau a v_h'$. Since $u_h$ is piecewise linear, its second derivative $u_h''$ is zero within each element. The stabilization term simplifies to:\n$$\nB_{stab}(u_h, v_h) = \\sum_{e=0}^{N-1} \\int_{\\Omega_e} (a u_h') (\\tau a v_h') \\, dx\n$$\nThe stabilization parameter is given as $\\tau = \\frac{h}{2|a|}$. The element stabilization matrix $\\mathbf{k}^e_{stab}$ has entries $k^e_{stab, \\alpha\\beta} = \\int_{\\Omega_e} \\tau (a N_\\beta') (a N_\\alpha') dx = \\tau a^2 \\int_{\\Omega_e} N_\\alpha' N_\\beta' dx$. This is proportional to the diffusion matrix:\n$$\n\\mathbf{k}^e_{stab} = \\tau a^2 \\left( \\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} \\right) = \\frac{h}{2|a|} a^2 \\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} = \\frac{|a|}{2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n$$\nThe total SUPG element matrix is $\\mathbf{k}^e_S = \\mathbf{k}^e_G + \\mathbf{k}^e_{stab}$. For the case $a > 0$, $|a|=a$, this becomes:\n$$\n\\mathbf{k}^e_S = \\left( \\frac{\\varepsilon}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + \\frac{a}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix} \\right) + \\frac{a}{2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} + a \\begin{pmatrix} 0 & 0 \\\\ -1 & 1 \\end{pmatrix}\n$$\nThe assembly of these element matrices produces a global system of linear equations $\\mathbf{K} \\mathbf{U} = \\mathbf{F}$ of size $(N-1) \\times (N-1)$ for the unknown interior nodal values $\\mathbf{U} = [U_1, \\dots, U_{N-1}]^T$. The boundary conditions $U_0=1$ and $U_N=0$ are imposed by modifying the first and last equations of the full system, moving known quantities to the right-hand side vector $\\mathbf{F}$. For an interior node $i$, the assembled row of the linear system is determined by the coefficients from the element matrices. For Galerkin, the equation is $(-\\frac{\\varepsilon}{h} - \\frac{a}{2})U_{i-1} + (\\frac{2\\varepsilon}{h})U_i + (-\\frac{\\varepsilon}{h} + \\frac{a}{2})U_{i+1} = 0$. For SUPG ($a>0$), it becomes $(-\\frac{\\varepsilon}{h}-a)U_{i-1} + (\\frac{2\\varepsilon}{h}+a)U_i + (-\\frac{\\varepsilon}{h})U_{i+1} = 0$. The right-hand side vector $\\mathbf{F}$ is non-zero only in its first entry, resulting from the boundary condition at $x=0$. For node $i=1$, the term involving $U_0=1$ is moved to the right. The coefficient of $U_0$ in the equation for node $1$ is $K_{1,0}$, which corresponds to the element matrix entry $k^e_{1,0}$ where local node $1$ of element $0$ is the global node $0$, and local node $2$ is global node $1$. This corresponds to using a test function $\\phi_1$ and a trial function $\\phi_0$. The term is $k^e_{21}$. So, $F_1 = -K_{1,0} U_0 = -k^e_{21} \\cdot 1$. For Galerkin, $F_1 = \\frac{\\varepsilon}{h} + \\frac{a}{2}$. For SUPG, $F_1=\\frac{\\varepsilon}{h}+a$.\n\nThe Gibbs-like oscillation amplitude $\\mathcal{A}(u_h)$ is computed from the nodal solution vector $\\mathbf{U}_{full} = [1, U_1, \\dots, U_{N-1}, 0]^T$ using the formula:\n$$\n\\mathcal{A}(u_h) = \\max(0, \\max(\\mathbf{U}_{full}) - 1) + \\max(0, 0 - \\min(\\mathbf{U}_{full}))\n$$\nThe algorithm proceeds by implementing this assembly and solution process for each test case, first for the Galerkin method and then for the SUPG method, to compute the respective oscillation amplitudes $A_G$ and $A_S$, and their difference $\\Delta = A_G - A_S$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_fem_1d(N, epsilon, a, method='Galerkin'):\n    \"\"\"\n    Solves the 1D advection-diffusion problem using linear finite elements.\n\n    Args:\n        N (int): Number of elements.\n        epsilon (float): Diffusion coefficient.\n        a (float): Advection speed.\n        method (str): 'Galerkin' or 'SUPG'.\n\n    Returns:\n        numpy.ndarray: The full nodal solution vector U of size (N+1).\n    \"\"\"\n    h = 1.0 / N\n    num_unknowns = N - 1\n\n    if num_unknowns <= 0:\n        # Handle trivial case N=1\n        return np.array([1.0, 0.0])\n\n    # Initialize the (N-1)x(N-1) system matrix K and RHS vector F\n    K_red = np.zeros((num_unknowns, num_unknowns))\n    F_red = np.zeros(num_unknowns)\n\n    # Define element matrices based on the chosen method\n    k_diff = (epsilon / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n\n    if method == 'Galerkin':\n        k_adv = (a / 2.0) * np.array([[-1.0, 1.0], [-1.0, 1.0]])\n        k_elem = k_diff + k_adv\n    elif method == 'SUPG':\n        # SUPG with tau = h / (2 * |a|)\n        if a == 0:\n            k_elem = k_diff\n        else:\n            # Galerkin advection matrix\n            k_adv = (a / 2.0) * np.array([[-1.0, 1.0], [-1.0, 1.0]])\n            # Stabilization matrix contribution is proportional to the stiffness part\n            # k_stab = tau * a^2 * (1/h) * [[1, -1], [-1, 1]]\n            # tau = h / (2*|a|)\n            # k_stab = (h / (2*|a|)) * a^2 * (1/h) * [[1, -1], [-1, 1]]\n            # k_stab = (|a|/2) * [[1, -1], [-1, 1]]\n            k_stab = (abs(a) / 2.0) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n            k_elem = k_diff + k_adv + k_stab\n    else:\n        raise ValueError(\"Method must be 'Galerkin' or 'SUPG'\")\n\n    # Assemble the reduced tridiagonal system for interior nodes\n    lower_diag = k_elem[1, 0]\n    main_diag = k_elem[0, 0] + k_elem[1, 1]\n    upper_diag = k_elem[0, 1]\n\n    np.fill_diagonal(K_red, main_diag)\n    if num_unknowns > 1:\n        # Use np.diag_indices_from and slicing for robust diagonal filling\n        rows, cols = np.diag_indices_from(K_red)\n        K_red[rows[1:], cols[:-1]] = lower_diag\n        K_red[rows[:-1], cols[1:]] = upper_diag\n\n    # Apply boundary conditions\n    # u(0) = 1 (affects the first equation for U_1)\n    # The term k_elem[1,0] * U_0 is moved to the RHS\n    F_red[0] = -k_elem[1, 0] * 1.0\n    \n    # u(N) = 0 (affects the last equation for U_{N-1})\n    # The term k_elem[0,1] * U_N is moved to the RHS. Since U_N=0, this is 0.\n    # No modification needed for F_red[num_unknowns-1] as it is already 0.\n\n    # Solve the linear system for interior nodes\n    U_internal = np.linalg.solve(K_red, F_red)\n\n    # Construct the full solution vector including boundary nodes\n    U_full = np.zeros(N + 1)\n    U_full[0] = 1.0\n    U_full[N] = 0.0\n    U_full[1:N] = U_internal\n\n    return U_full\n\ndef compute_oscillation_amplitude(u_h):\n    \"\"\"\n    Computes the Gibbs-like oscillation amplitude for a nodal solution.\n    \"\"\"\n    overshoot = np.max([0.0, np.max(u_h) - 1.0])\n    undershoot = np.max([0.0, 0.0 - np.min(u_h)])\n    return overshoot + undershoot\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (40, 1e-2, 1.0),\n        (80, 1e-4, 1.0),\n        (40, 1e-6, 1.0),\n    ]\n\n    results = []\n    for N, epsilon, a in test_cases:\n        # Solve using Bubnov-Galerkin method\n        U_G = solve_fem_1d(N, epsilon, a, method='Galerkin')\n        A_G = compute_oscillation_amplitude(U_G)\n\n        # Solve using SUPG method\n        U_S = solve_fem_1d(N, epsilon, a, method='SUPG')\n        A_S = compute_oscillation_amplitude(U_S)\n\n        # Compute reduction in oscillation\n        Delta = A_G - A_S\n        \n        results.extend([A_G, A_S, Delta])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The stabilization parameter, $\\tau$, can often seem like an ad-hoc 'magic number'. This exercise demystifies its origin by analyzing the mathematical properties of the semi-discrete system for the pure advection equation. By requiring the system's generator matrix to be Metzler—a condition that prevents the creation of new, unphysical extrema—you will derive the minimal value of $\\tau$ needed to ensure non-oscillatory behavior , providing a rigorous basis for a classic stabilization formula.",
            "id": "3397658",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ posed on the periodic domain $\\Omega = (0,L)$, where $a \\in \\mathbb{R}\\setminus\\{0\\}$ is a constant advection speed. Let $\\{\\varphi_{i}\\}_{i=1}^{N}$ be the standard continuous, piecewise-linear hat basis associated with a uniform mesh of $N$ intervals, mesh size $h = L/N$. Using the Galerkin/least-squares (GLS) stabilization, consider the semi-discrete weak formulation: find $u_{h}(t) \\in \\mathrm{span}\\{\\varphi_{i}\\}$ such that for all $v_{h} \\in \\mathrm{span}\\{\\varphi_{i}\\}$,\n$$(\\dot{u}_{h}, v_{h})_{\\Omega} + a\\,(u_{h,x}, v_{h})_{\\Omega} + \\tau\\,a^{2}\\,(u_{h,x}, v_{h,x})_{\\Omega} = 0,$$\nwhere $\\tau > 0$ is a constant stabilization parameter and $(\\cdot,\\cdot)_{\\Omega}$ denotes the $L^{2}(\\Omega)$ inner product. Adopt mass lumping so that the mass matrix is diagonal with node-wise mass $m_{i} = \\int_{\\Omega}\\varphi_{i}\\,dx = h$.\n\nOn the uniform mesh, the algebraic system for the nodal values $\\{u_{i}(t)\\}$ can be written as\n$$h\\,\\dot{u}_{i} + \\sum_{j}A_{ij}\\,u_{j} = 0,$$\nwith the spatial operator $A = a\\,B + a^{2}\\tau\\,K$, where $B_{ij} = \\int_{\\Omega}\\varphi_{j,x}\\,\\varphi_{i}\\,dx$ is the Galerkin advection matrix and $K_{ij} = \\int_{\\Omega}\\varphi_{j,x}\\,\\varphi_{i,x}\\,dx$ is the stiffness matrix. For the uniform mesh with the chosen basis, the nonzero stencil entries are\n$$B_{i,i+1} = \\frac{1}{2},\\quad B_{i,i-1} = -\\frac{1}{2},\\quad B_{i,i} = 0,$$\n$$K_{i,i} = \\frac{2}{h},\\quad K_{i,i+1} = -\\frac{1}{h},\\quad K_{i,i-1} = -\\frac{1}{h}.$$\n\nAnalyze the semi-discrete Fourier amplification factor $g(\\theta)$ defined by the modal relation $u_{i}(t) = \\hat{u}(t)\\,\\exp(\\mathrm{i}\\,i\\,\\theta)$, $\\theta \\in [-\\pi,\\pi]$, where $\\dot{\\hat{u}}(t) = g(\\theta)\\,\\hat{u}(t)$, and determine a condition on the stabilization parameter $\\tau$ that guarantees non-oscillatory behavior in the following sense: the generator matrix $-M^{-1}A$ (with $M = h\\,I$ the lumped mass matrix) is Metzler, i.e., it has nonnegative off-diagonal entries, ensuring the semi-discrete dynamics preserve positivity and do not create new extrema. Express your final answer as the minimal $\\tau$ (as a function of $a$ and $h$) that satisfies this condition. The final answer must be a single closed-form expression.",
            "solution": "The problem has been validated and is deemed sound. The concepts are standard within the numerical analysis of partial differential equations. All provided data and definitions are consistent and sufficient for deriving a solution.\n\nThe semi-discrete system of ordinary differential equations for the nodal values $\\{u_{i}(t)\\}$ is given by\n$$h\\,\\dot{u}_{i} + \\sum_{j}A_{ij}\\,u_{j} = 0$$\nfor each node $i$. Using mass lumping, the mass matrix $M$ is a diagonal matrix with entries $M_{ii} = h$. In matrix form, this system is $M\\dot{\\mathbf{u}} + A\\mathbf{u} = \\mathbf{0}$, where $\\mathbf{u}$ is the vector of nodal values. This can be rewritten as\n$$\\dot{\\mathbf{u}} = -M^{-1}A\\mathbf{u}.$$\nThe generator matrix for the semi-discrete dynamics is $G = -M^{-1}A$. With the lumped mass matrix $M = h\\,I$, where $I$ is the identity matrix, the generator matrix simplifies to\n$$G = -\\frac{1}{h}A.$$\nThe problem defines non-oscillatory behavior as the property that the generator matrix $G$ is a Metzler matrix. A matrix is Metzler if all of its off-diagonal entries are non-negative. Therefore, we require\n$$G_{ij} \\ge 0 \\quad \\text{for all } i \\ne j.$$\nSubstituting the expression for $G$ in terms of $A$, this condition becomes\n$$-\\frac{1}{h}A_{ij} \\ge 0 \\quad \\text{for all } i \\ne j.$$\nSince the mesh size $h$ is positive, this is equivalent to requiring that the off-diagonal entries of the spatial operator matrix $A$ are non-positive:\n$$A_{ij} \\le 0 \\quad \\text{for all } i \\ne j.$$\nThe matrix $A$ is given by the sum $A = a\\,B + a^{2}\\tau\\,K$. For the given piecewise-linear basis functions on a uniform mesh, the only non-zero off-diagonal entries are for $j = i-1$ and $j = i+1$. We must analyze these two cases.\n\nCase 1: $j=i+1$\nThe entry $A_{i,i+1}$ is given by\n$$A_{i,i+1} = a\\,B_{i,i+1} + a^{2}\\tau\\,K_{i,i+1}.$$\nSubstituting the provided stencil values $B_{i,i+1} = \\frac{1}{2}$ and $K_{i,i+1} = -\\frac{1}{h}$:\n$$A_{i,i+1} = a\\left(\\frac{1}{2}\\right) + a^{2}\\tau\\left(-\\frac{1}{h}\\right) = \\frac{a}{2} - \\frac{a^{2}\\tau}{h}.$$\nThe Metzler condition requires $A_{i,i+1} \\le 0$:\n$$\\frac{a}{2} - \\frac{a^{2}\\tau}{h} \\le 0 \\implies \\frac{a}{2} \\le \\frac{a^{2}\\tau}{h}.$$\nSince $a \\in \\mathbb{R}\\setminus\\{0\\}$, $a^2$ is strictly positive. We can multiply the inequality by $\\frac{h}{a^2} > 0$ without changing its direction:\n$$\\frac{h}{a^2}\\frac{a}{2} \\le \\tau \\implies \\frac{h}{2a} \\le \\tau.$$\n\nCase 2: $j=i-1$\nThe entry $A_{i,i-1}$ is given by\n$$A_{i,i-1} = a\\,B_{i,i-1} + a^{2}\\tau\\,K_{i,i-1}.$$\nSubstituting the provided stencil values $B_{i,i-1} = -\\frac{1}{2}$ and $K_{i,i-1} = -\\frac{1}{h}$:\n$$A_{i,i-1} = a\\left(-\\frac{1}{2}\\right) + a^{2}\\tau\\left(-\\frac{1}{h}\\right) = -\\frac{a}{2} - \\frac{a^{2}\\tau}{h}.$$\nThe Metzler condition requires $A_{i,i-1} \\le 0$:\n$$-\\frac{a}{2} - \\frac{a^{2}\\tau}{h} \\le 0 \\implies -\\frac{a}{2} \\le \\frac{a^{2}\\tau}{h}.$$\nAgain, multiplying by $\\frac{h}{a^2} > 0$:\n$$-\\frac{h}{a^2}\\frac{a}{2} \\le \\tau \\implies -\\frac{h}{2a} \\le \\tau.$$\n\nTo ensure the generator matrix is Metzler, both conditions on the stabilization parameter $\\tau$ must be satisfied simultaneously. The problem also specifies $\\tau > 0$. We have:\n$$ \\tau \\ge \\frac{h}{2a} \\quad \\text{and} \\quad \\tau \\ge -\\frac{h}{2a}. $$\nThis pair of inequalities can be combined into a single condition:\n$$ \\tau \\ge \\max\\left(\\frac{h}{2a}, -\\frac{h}{2a}\\right). $$\nThe maximum of a number and its negative is its absolute value. Thus, the condition on $\\tau$ is\n$$ \\tau \\ge \\left|\\frac{h}{2a}\\right|. $$\nSince $h > 0$, this is equivalent to\n$$ \\tau \\ge \\frac{h}{2|a|}. $$\nThe problem asks for the minimal value of $\\tau$ that satisfies this condition. This minimal value is achieved at equality:\n$$ \\tau_{\\min} = \\frac{h}{2|a|}. $$\nThis choice of $\\tau$ ensures all off-diagonal entries of $A$ are non-positive, which in turn guarantees that all off-diagonal entries of the generator matrix $G = -A/h$ are non-negative, satisfying the Metzler property. This specific value of $\\tau$ adds sufficient artificial diffusion to the central-differencing-like Galerkin scheme to recover the non-oscillatory properties of the first-order upwind scheme.",
            "answer": "$$\\boxed{\\frac{h}{2|a|}}$$"
        }
    ]
}