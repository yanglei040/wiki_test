{
    "hands_on_practices": [
        {
            "introduction": "在求解双曲型偏微分方程的数值方法中，稳定性是首要的基石。在考虑精度之前，我们必须确保数值解不会随着时间的推移而无限增长导致计算发散。本练习 () 将引导您运用冯·诺依曼稳定性分析这一核心工具，从第一性原理出发，严格推导出著名的库朗-弗里德里希斯-列维（CFL）条件。",
            "id": "3278584",
            "problem": "考虑在一维波动方程 $u_{tt} = c^2 u_{xx}$（一个二阶双曲型偏微分方程 (PDE)）上，使用间距为 $\\Delta x$ 的均匀空间网格和均匀时间步长 $\\Delta t$。假设通过在空间和时间上应用二阶中心差分来近似网格点 $x_j = j \\Delta x$ 和 $t^n = n \\Delta t$ 处的 $u_{tt}$ 和 $u_{xx}$，构建了一个显式有限差分格式。假设采用周期性边界条件，从而允许离散傅里叶模式，并定义无量纲的 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda = \\dfrac{c \\Delta t}{\\Delta x}$。\n\n仅从离散格式和线性常系数格式稳定性的适当基本定义出发，确定 $\\lambda$ 的最大允许值，使得该方法对所有空间傅里叶波数都是稳定的。你的最终答案必须是一个实数。无需四舍五入，最终答案中也无需物理单位。",
            "solution": "问题陈述经评估有效。它具有科学依据、是适定的、客观的，并包含足够的信息以获得唯一解。所涉及的概念——一维波动方程、有限差分法和 Von Neumann 稳定性分析——在数值分析领域是标准且定义明确的。因此，我们可以开始推导。\n\n问题考虑的是一维波动方程，一个二阶双曲型偏微分方程 (PDE)：\n$$\nu_{tt} = c^2 u_{xx}\n$$\n其中 $u$ 是波幅，$t$ 是时间，$x$ 是空间坐标，$c$ 是波速。问题指定了对时间和空间导数均使用二阶中心差分的离散化方法。设 $U_j^n$ 是 $u(x_j, t^n)$ 的数值近似，其中 $x_j = j \\Delta x$ 且 $t^n = n \\Delta t$。\n\n在 $(x_j, t^n)$ 处对时间导数 $u_{tt}$ 的二阶中心差分近似为：\n$$\nu_{tt} \\approx \\frac{U_j^{n+1} - 2U_j^n + U_j^{n-1}}{(\\Delta t)^2}\n$$\n在 $(x_j, t^n)$ 处对空间导数 $u_{xx}$ 的二阶中心差分近似为：\n$$\nu_{xx} \\approx \\frac{U_{j+1}^n - 2U_j^n + U_{j-1}^n}{(\\Delta x)^2}\n$$\n将这些近似式代入 PDE，得到有限差分方程：\n$$\n\\frac{U_j^{n+1} - 2U_j^n + U_j^{n-1}}{(\\Delta t)^2} = c^2 \\frac{U_{j+1}^n - 2U_j^n + U_{j-1}^n}{(\\Delta x)^2}\n$$\n该格式是显式的，因为我们可以重新整理它，用当前和之前时间层（$U^n$ 和 $U^{n-1}$）的解来求解未来时间层（$U_j^{n+1}$）的解。让我们引入 Courant–Friedrichs–Lewy (CFL) 数，$\\lambda = \\frac{c \\Delta t}{\\Delta x}$。重新整理方程以求解 $U_j^{n+1}$：\n$$\nU_j^{n+1} - 2U_j^n + U_j^{n-1} = \\left( \\frac{c \\Delta t}{\\Delta x} \\right)^2 (U_{j+1}^n - 2U_j^n + U_{j-1}^n)\n$$\n$$\nU_j^{n+1} = 2U_j^n - U_j^{n-1} + \\lambda^2 (U_{j+1}^n - 2U_j^n + U_{j-1}^n)\n$$\n为了分析这个具有周期性边界条件的线性常系数格式的稳定性，我们采用 Von Neumann 稳定性分析。我们假设解的形式为单个傅里叶模式：\n$$\nU_j^n = G^n e^{i k x_j} = G^n e^{i k j \\Delta x}\n$$\n其中 $k$ 是空间波数，$i = \\sqrt{-1}$，$G = G(k)$ 是每个时间步的增长因子。为了使格式稳定，增长因子的模必须对所有波数 $k$ 都满足 $|G| \\le 1$。将傅里叶模式代入有限差分格式：\n$$\nG^{n+1} e^{i k j \\Delta x} = 2G^n e^{i k j \\Delta x} - G^{n-1} e^{i k j \\Delta x} + \\lambda^2 \\left( G^n e^{i k (j+1) \\Delta x} - 2G^n e^{i k j \\Delta x} + G^n e^{i k (j-1) \\Delta x} \\right)\n$$\n两边同除以公共非零项 $G^{n-1} e^{i k j \\Delta x}$，得到关于 $G$ 的特征方程：\n$$\nG^2 = 2G - 1 + \\lambda^2 G (e^{i k \\Delta x} - 2 + e^{-i k \\Delta x})\n$$\n使用恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，并令 $\\theta = k \\Delta x$，我们简化括号中的表达式：\n$$\nG^2 = 2G - 1 + \\lambda^2 G (2\\cos(k \\Delta x) - 2)\n$$\n$$\nG^2 = 2G - 1 - 2\\lambda^2 G (1 - \\cos(k \\Delta x))\n$$\n使用半角公式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\nG^2 = 2G - 1 - 4\\lambda^2 G \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n将其整理成标准二次方程形式 $aG^2+bG+c=0$：\n$$\nG^2 - 2\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)G + 1 = 0\n$$\n该二次方程的根由求根公式 $G = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 给出：\n$$\nG = \\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right) \\pm \\sqrt{\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 - 1}\n$$\n为了保证稳定性，我们要求 $|G| \\le 1$。两个根的乘积为 $G_1 G_2 = c/a = 1$。如果根是实数，为了保证稳定性，我们必须有 $|G| \\le 1$。这意味着一个根的模必须大于或等于 $1$，另一个根的模必须小于或等于 $1$。只有当两个根的模都恰好为 $1$ 时，才能避免无界增长。这种情况发生在根等于 $1$ 或 $-1$ 时。\n如果根是一对共轭复数，它们的乘积为 $1$ 意味着它们的模也为 $1$。出现复数根（包括重根）的条件是二次方程的判别式为负数或零。\n$$\n\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 - 1 \\le 0\n$$\n$$\n\\left(1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right)^2 \\le 1\n$$\n两边开平方根，得到：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n$$\n这个不等式代表了两个条件：\n1. $1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0$。这个条件总是成立的，因为 $\\lambda^2 \\ge 0$ 且正弦平方项是非负的。\n2. $-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 2 \\implies \\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1$。\n\n这第二个条件 $\\lambda^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1$ 是稳定性的充要条件。它必须对所有可能的空间波数 $k$ 成立。为确保这一点，我们必须考虑“最坏情况”，即对应于使 $\\sin^2\\left(\\frac{k \\Delta x}{2}\\right)$ 项最大化的 $k$ 值。无量纲波数 $\\theta = k \\Delta x$ 的范围可以从 $-\\pi$ 到 $\\pi$。$\\sin^2(\\theta/2)$ 的最大值在 $\\theta/2 = \\pm \\pi/2$ 时出现，即 $\\theta = \\pm \\pi$。这对应于网格上可表示的最高频率模式（奈奎斯特频率）。在此频率下：\n$$\n\\max \\left[ \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right] = \\sin^2\\left(\\frac{\\pi}{2}\\right) = 1^2 = 1\n$$\n将此最大值代入稳定性条件，得到对 $\\lambda$ 的最严格约束：\n$$\n\\lambda^2 \\cdot 1 \\le 1 \\implies \\lambda^2 \\le 1\n$$\n由于 CFL 数 $\\lambda = \\frac{c \\Delta t}{\\Delta x}$ 是由正量（$c, \\Delta t, \\Delta x$）定义的，所以 $\\lambda$ 是非负的。因此，稳定性条件简化为：\n$$\n0 \\le \\lambda \\le 1\n$$\n问题要求使方法稳定的 $\\lambda$ 的最大允许值。这是所推导区间的上界。\n$$\n\\lambda_{\\max} = 1\n$$",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "一个稳定的数值格式未必是精确的，它可能引入各种误差，例如数值色散。本练习 () 关注数值色散现象，即在离散网格上，不同频率的波以错误的相速度传播，从而导致波形失真。通过设计一个由网格能表示的最高频率（奈奎斯特频率）构成的“恶意”初始条件，这个实践性的编码任务将使抽象的色散误差变得直观可见，并让您亲手量化其影响。",
            "id": "3229319",
            "problem": "考虑定义在周期性区间 $[0,L)$ 上的一维线性波偏微分方程 (PDE) $u_{tt} = c^2 u_{xx}$，其中 $u(x,t)$ 在时间和空间上二阶可微，$c$ 是恒定波速，$L$ 是区域长度。数值任务是研究一种标准二阶显式有限差分法的色散特性，其初始条件被特意选择为给定空间网格上可以表示的最高频率。\n\n您将使用一个包含 $N$ 个点的均匀网格，空间步长为 $\\Delta x = L/N$，时间步长为 $\\Delta t$。设网格点为 $x_i = i \\,\\Delta x$（其中 $i = 0,1,\\dots,N-1$），时间层为 $t^n = n \\,\\Delta t$（其中整数 $n \\ge 0$）。使用周期性边界条件，意味着索引按模 $N$ 回绕。此网格上可表示的最高波数（奈奎斯特模式）为 $k_{\\max} = \\pi/\\Delta x$。定义“恶意的”初始位移为 $u(x,0) = \\cos(k_{\\max} x)$，初始速度为 $u_t(x,0) = 0$。此初始条件最大化了对数值色散的敏感性，因为它位于离散谱的边缘。\n\n实现一个与 $u_{tt} = c^2 u_{xx}$ 相容的二阶精度显式有限差分法，在上述网格上对时间和空间均使用中心差分。在近似空间导数时使用周期性边界条件。从 $u(x,0)$ 初始化 $u^0$，并利用 $u_t(x,0)$ 和该方法与偏微分方程的相容性来构造 $u^1$，以使整体格式在时间上保持二阶精度。\n\n对于每次模拟，通过利用该模式在固定网格点上的离散时间行为，或通过将演变的解 $u^n$ 与初始空间模式 $\\phi_i = \\cos(k_{\\max} x_i)$ 进行相关联，来估计与奈奎斯特模式相关的数值角频率 $\\omega_{\\text{num}}$。具体来说，对于一个近似单模的时间序列，使用余弦序列的恒等式从序列 $\\{u^n\\}$ 中估计 $\\cos(\\omega_{\\text{num}} \\Delta t)$，并在多个时间层上对此估计值进行平均以减少数值噪声。计算由连续偏微分方程为此模式导出的精确角频率 $\\omega_{\\text{exact}} = c\\,k_{\\max}$。将色散误差度量定义为无量纲浮点数\n$$\nE = \\left| \\frac{\\omega_{\\text{num}}}{\\omega_{\\text{exact}}} - 1 \\right|.\n$$\n\n所有物理量必须使用适当的单位处理：选择 $L$ 的单位为米，$c$ 的单位为米/秒，$\\Delta t$ 的单位为秒；三角函数中的角度以弧度为单位。为了稳定性，应遵守 Courant–Friedrichs–Lewy (CFL) 条件；定义无量纲的库朗数 $s = \\frac{c\\,\\Delta t}{\\Delta x}$，并使用 $s \\le 1$ 的值。\n\n您的程序必须：\n- 使用 $k_{\\max} = \\pi/\\Delta x$ 构建“恶意的”初始条件。\n- 在周期性边界条件下，使用二阶显式中心有限差分法推进解。\n- 从时间序列估计 $\\omega_{\\text{num}}$，并为每个测试用例计算 $E$。\n- 将每个 $E$ 四舍五入到8位小数。\n\n使用以下测试套件，该套件在保持 $L$ 和 $c$ 固定的同时，改变库朗数 $s$ 以探索不同机制下的色散：\n- 用例 1：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.2$，$n_{\\text{steps}} = 200$。\n- 用例 2：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.5$，$n_{\\text{steps}} = 200$。\n- 用例 3：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 0.9$，$n_{\\text{steps}} = 200$。\n- 用例 4：$L = 1$ (米)，$c = 1$ (米/秒)，$N = 128$，$s = 1.0$，$n_{\\text{steps}} = 200$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序与上述测试用例一致。例如，输出格式必须为\n$[E_1,E_2,E_3,E_4]$,\n其中每个 $E_j$ 是用例 $j$ 的色散误差，四舍五入到8位小数。",
            "solution": "该问题要求研究标准二阶显式有限差分法在求解一维线性波方程 $u_{tt} = c^2 u_{xx}$ 时的数值色散。分析聚焦于一个特定的初始条件——奈奎斯特模式，即离散网格上可表示的最高频率模式。这一选择最大限度地暴露了格式的色散误差。\n\n首先，我们定义计算域和离散化。空间域是一个周期性区间 $[0,L)$，被离散化为 $N$ 个点 $x_i = i \\Delta x$（其中 $i=0, 1, \\dots, N-1$），网格间距为 $\\Delta x = L/N$。时间被离散化为多个时间层 $t^n = n \\Delta t$，其中 $\\Delta t$ 是时间步长。在网格点 $x_i$ 和时间 $t^n$ 的解表示为 $u_i^n \\approx u(x_i, t^n)$。\n\n偏微分方程 $u_{tt} = c^2 u_{xx}$ 的时间和空间导数均使用二阶精度的中心有限差分来近似：\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n将这些表达式代入偏微分方程并重新整理，得到显式时间推进格式，通常称为蛙跳法：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\left(\\frac{c \\Delta t}{\\Delta x}\\right)^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n令 $s = \\frac{c \\Delta t}{\\Delta x}$ 为无量纲库朗数。该格式可以写成：\n$$\nu_i^{n+1} = 2(1-s^2)u_i^n + s^2(u_{i+1}^n + u_{i-1}^n) - u_i^{n-1}\n$$\n施加周期性边界条件，意味着索引按模 $N$ 计算，使得 $u_N^n = u_0^n$ 且 $u_{-1}^n = u_{N-1}^n$。该格式在 $s \\le 1$ 时是稳定的。\n\n初始条件被指定为一种“恶意的”模式，旨在探究最坏情况下的色散。初始位移为 $u(x,0) = \\cos(k_{\\max}x)$，其中 $k_{\\max} = \\pi/\\Delta x$ 是奈奎斯特波数。在离散网格上，这变为：\n$$\nu_i^0 = u(x_i, 0) = \\cos(k_{\\max} x_i) = \\cos\\left(\\frac{\\pi}{\\Delta x} i \\Delta x\\right) = \\cos(i\\pi) = (-1)^i\n$$\n这个初始条件对应于一个锯齿状或棋盘状模式，是网格上可以表示的最高频率波。初始速度为 $u_t(x,0)=0$。\n\n蛙跳法是一种三层方法，需要来自前两个时间步 $u^n$ 和 $u^{n-1}$ 的数据来计算 $u^{n+1}$。为了求得第一个时间步的解 $u^1$，我们必须采用一种不同的方法来保持格式的二阶精度。使用 $u(x,t)$ 在 $t=0$ 附近的泰勒级数展开：\n$$\nu(x, \\Delta t) = u(x,0) + \\Delta t \\, u_t(x,0) + \\frac{(\\Delta t)^2}{2} u_{tt}(x,0) + O((\\Delta t)^3)\n$$\n使用初始条件 $u_t(x,0)=0$ 以及偏微分方程本身 $u_{tt}(x,0) = c^2 u_{xx}(x,0)$，我们得到：\n$$\nu(x, \\Delta t) \\approx u(x,0) + \\frac{c^2 (\\Delta t)^2}{2} u_{xx}(x,0)\n$$\n在空间上离散化该表达式，得到 $u_i^1$ 的计算公式：\n$$\nu_i^1 = u_i^0 + \\frac{s^2}{2} (u_{i+1}^0 - 2u_i^0 + u_{i-1}^0) = (1-s^2)u_i^0 + \\frac{s^2}{2}(u_{i+1}^0 + u_{i-1}^0)\n$$\n在 $u^0$ 和 $u^1$ 确定之后，主蛙跳循环可以对所有后续的时间步进行。\n\n为了量化色散误差，我们必须估计数值角频率 $\\omega_{\\text{num}}$，并将其与精确角频率 $\\omega_{\\text{exact}}$ 进行比较。对于波数为 $k$ 的波，连续偏微分方程意味着一个线性色散关系 $\\omega = c k$。对于奈奎斯特模式，这给出：\n$$\n\\omega_{\\text{exact}} = c k_{\\max} = \\frac{c \\pi}{\\Delta x}\n$$\n针对指定初始条件的数值解，预计会按照 $u_i^n \\approx (-1)^i \\cos(\\omega_{\\text{num}} n \\Delta t)$ 演化。该模式的时变振幅 $A_n = \\cos(\\omega_{\\text{num}} n \\Delta t)$ 可以通过将数值解向量 $U^n = \\{u_i^n\\}_{i=0}^{N-1}$ 投影到初始模态形状向量 $\\phi = \\{(-1)^i\\}_{i=0}^{N-1}$ 上来分离：\n$$\nA_n = \\frac{1}{N} \\sum_{i=0}^{N-1} u_i^n \\phi_i\n$$\n序列 $\\{A_n\\}$ 遵循余弦的三项递推关系：$A_{n+1} + A_{n-1} = 2 A_n \\cos(\\omega_{\\text{num}} \\Delta t)$。我们可以重新整理这个关系来估计相位步长的余弦值：\n$$\n\\cos(\\omega_{\\text{num}} \\Delta t) = \\frac{A_{n+1} + A_{n-1}}{2 A_n}\n$$\n通过对每个时间步 $n$（其中 $A_n$ 不接近于零）计算此量并对结果进行平均，我们获得一个稳健的估计值 $\\cos_{\\text{est}}$。数值角频率随后通过以下方式恢复：\n$$\n\\omega_{\\text{num}} = \\frac{1}{\\Delta t} \\arccos(\\cos_{\\text{est}})\n$$\n最后，色散误差度量 $E$ 计算为数值频率与精确频率之间的相对差异：\n$$\nE = \\left| \\frac{\\omega_{\\text{num}}}{\\omega_{\\text{exact}}} - 1 \\right|\n$$\n对于每组给定的参数，重复此过程，以分析色散误差如何随库朗数 $s$ 变化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the wave equation for the Nyquist mode to analyze numerical dispersion.\n    \"\"\"\n    # test_cases: (L, c, N, s, n_steps)\n    test_cases = [\n        (1.0, 1.0, 128, 0.2, 200),\n        (1.0, 1.0, 128, 0.5, 200),\n        (1.0, 1.0, 128, 0.9, 200),\n        (1.0, 1.0, 128, 1.0, 200),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, c, N, s, n_steps = case\n\n        # Grid and simulation parameters\n        dx = L / N\n        dt = s * dx / c\n        \n        # Store solution history\n        u_history = np.zeros((n_steps + 1, N))\n\n        # Initial condition u^0: Nyquist mode u(x,0) = cos(pi*x/dx)\n        # u_i^0 = cos(pi * i*dx / dx) = cos(i*pi) = (-1)^i\n        u_curr = np.array([(-1)**i for i in range(N)], dtype=float)\n        u_history[0, :] = u_curr\n        \n        # First time step u^1, using u_t(x,0) = 0\n        # u_i^1 = (1-s^2)u_i^0 + (s^2/2)(u_{i+1}^0 + u_{i-1}^0)\n        u_prev = np.copy(u_curr) # This will be u^0\n        u_ip1 = np.roll(u_curr, -1)\n        u_im1 = np.roll(u_curr, 1)\n        u_curr = (1 - s**2) * u_curr + (s**2 / 2.0) * (u_ip1 + u_im1)\n        u_history[1, :] = u_curr\n\n        # Main loop (leapfrog scheme)\n        for n in range(1, n_steps):\n            u_ip1 = np.roll(u_curr, -1)\n            u_im1 = np.roll(u_curr, 1)\n            u_next = 2.0 * (1.0 - s**2) * u_curr + s**2 * (u_ip1 + u_im1) - u_prev\n            \n            u_prev = np.copy(u_curr)\n            u_curr = np.copy(u_next)\n            u_history[n + 1, :] = u_curr\n\n        # Post-processing: Estimate numerical frequency\n        # Initial mode shape\n        phi = np.array([(-1)**i for i in range(N)], dtype=float)\n        \n        # Project solution onto the mode shape to get amplitudes A_n\n        # A_n = dot(u_n, phi) / N\n        amplitudes = np.dot(u_history, phi) / N\n\n        cos_estimates = []\n        # Estimate cos(omega_num * dt) from the amplitude recurrence\n        # cos(theta) = (A_{n+1} + A_{n-1}) / (2 * A_n)\n        for n in range(1, n_steps):\n            # Avoid division by zero or small numbers\n            if abs(amplitudes[n]) > 1e-10:\n                cos_est = (amplitudes[n+1] + amplitudes[n-1]) / (2.0 * amplitudes[n])\n                cos_estimates.append(cos_est)\n\n        if not cos_estimates:\n             # Fallback if no valid estimates could be made (highly unlikely)\n             # Use the analytical dispersion relation for the Nyquist mode\n             avg_cos_est = 1.0 - 2.0 * s**2\n        else:\n             avg_cos_est = np.mean(cos_estimates)\n\n        # Clip to handle potential floating-point errors pushing value outside [-1, 1]\n        avg_cos_est = np.clip(avg_cos_est, -1.0, 1.0)\n        \n        omega_num = np.arccos(avg_cos_est) / dt\n\n        # Calculate exact frequency and dispersion error\n        k_max = np.pi / dx\n        omega_exact = c * k_max\n        \n        # Ensure omega_exact is not zero to avoid division errors\n        if abs(omega_exact) > 1e-12:\n            dispersion_error = abs(omega_num / omega_exact - 1.0)\n        else:\n            dispersion_error = 0.0 if abs(omega_num) > 1e-12 else 0.0\n            \n        results.append(round(dispersion_error, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际仿真中，我们常常需要在有限的计算区域内模拟无界空间中的波传播问题。吸收边界条件（Absorbing Boundary Conditions, ABCs）是应对这一挑战的关键技术，其目标是吸收向外传播的波，防止其在计算域边界产生虚假反射。本练习 () 深入探讨了一种离散的吸收边界条件，要求您推导其产生的数值反射系数 $R$ 并量化其性能，从而揭示连续物理与离散近似在边界处理上的微妙差异。",
            "id": "3381686",
            "problem": "考虑标量场 $u(x,t)$ 的一维二阶波动方程，\n$$\nu_{tt}(x,t) = c^2\\,u_{xx}(x,t),\n$$\n其中 $c$ 是以 $\\mathrm{m/s}$ 为单位的波速。在空间轴上使用间距为 $\\Delta x$（单位为米）的均匀网格进行离散，并使用步长为 $\\Delta t$（单位为秒）的时间进行离散。在内部区域，使用标准的二阶显式有限差分格式，\n$$\nu_j^{n+1} = 2\\,u_j^n - u_j^{n-1} + \\lambda^2\\left(u_{j+1}^n - 2\\,u_j^n + u_{j-1}^n\\right),\n$$\n对于 $j\\ge 1$，其中 Courant 数为 $\\lambda = \\dfrac{c\\,\\Delta t}{\\Delta x}$。在左边界节点 $j=0$ 处，实施一个局部吸收阻抗边界条件，形式为离散的 Robin 条件，\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2\\,\\Delta t} - c_b\\,\\frac{u_1^n - u_0^n}{\\Delta x} = 0,\n$$\n其中 $c_b$ 是一个待选的边界阻抗系数，单位外法线指向 $x$ 减小的方向，因此在连续极限下，$u_t + c\\,u_n=0$ 变为 $u_t - c\\,u_x=0$。\n\n假设存在形式为\n$$\nu_j^n = e^{-i\\,\\omega\\,n\\,\\Delta t}\\big(A\\,e^{-i\\,k\\,j\\,\\Delta x} + B\\,e^{i\\,k\\,j\\,\\Delta x}\\big),\n$$\n的单色离散平面波解，其中 $\\omega$ 是角频率（单位为弧度/秒），$k$ 是波数（单位为弧度/米），复振幅 $A$ 和 $B$ 分别代表向左传播的入射波和向右传播的反射波。推导：\n1. 由内部格式所决定的、连接 $\\omega$ 和 $k$ 的离散色散关系。\n2. 对于上述使用中心时间差分和前向空间差分书写的离散 Robin 边界条件，推导边界处的复值反射系数 $R = \\dfrac{B}{A}$，用 $c_b$、$\\Delta x$、$\\Delta t$ 和 $k$ 表示。\n3. 网格尺度上的精确阻抗匹配条件，即对于给定的离散模式，能使反射系数恒为零的 $c_b$ 值，表示为 $(\\omega, k, \\Delta t, \\Delta x)$ 的函数。\n\n然后，量化当边界条件中的 $c_b$ 被选择为等于物理波速 $c$，并且 $\\Delta t$ 接近 Courant–Friedrichs–Lewy (CFL) 极限 $\\lambda\\approx 1$ 时，纯粹由时间离散化引起的反射。使用推导出的反射系数计算其模。\n\n所有角度必须以弧度处理。使用以下参数值测试集，其中所有情况均设置 $c=1\\,\\mathrm{m/s}$ 和 $\\Delta x=1\\,\\mathrm{m}$：\n- 测试 1 (理想情况): $\\lambda = 0.9$, $k\\,\\Delta x = \\dfrac{\\pi}{3}$。\n- 测试 2 (接近CFL): $\\lambda = 0.99$, $k\\,\\Delta x = \\dfrac{\\pi}{3}$。\n- 测试 3 (接近CFL，长波长): $\\lambda = 0.99$, $k\\,\\Delta x = 0.01$。\n- 测试 4 (接近CFL，近奈奎斯特): $\\lambda = 0.99$, $k\\,\\Delta x = 0.9\\,\\pi$。\n- 测试 5 (低于CFL): $\\lambda = 0.5$, $k\\,\\Delta x = \\dfrac{\\pi}{3}$。\n\n对于每个测试用例，计算当边界阻抗系数设置为物理波速 $c_b=c$ 时反射系数的模 $|R|$。将每个 $|R|$ 表示为一个四舍五入到八位小数的浮点数（无量纲）。你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，\"[r1,r2,r3,r4,r5]\"）。",
            "solution": "用户提供的问题是偏微分方程数值分析中的一个适定且标准的练习，具体涉及一维波动方程的有限差分时域 (FDTD) 方法。该问题在科学上是合理的、自洽的且客观的。我们将进行完整的求解。\n\n该问题要求进行三部分的推导，然后对一组测试用例进行数值计算。\n\n### 第 1 部分：离散色散关系\n\n用于波动方程 $u_{tt} = c^2 u_{xx}$ 的内部有限差分格式为：\n$$\nu_j^{n+1} = 2u_j^n - u_j^{n-1} + \\lambda^2\\left(u_{j+1}^n - 2u_j^n + u_{j-1}^n\\right)\n$$\n其中 $u_j^n \\approx u(j\\Delta x, n\\Delta t)$，Courant 数为 $\\lambda = \\frac{c\\Delta t}{\\Delta x}$。\n\n我们分析离散平面波解的行为，它可以表示为 $u_j^n \\propto e^{-i(\\omega n\\Delta t - k j\\Delta x)}$ 形式的单个模式。将此代入数值格式，我们得到：\n$$\ne^{-i\\omega(n+1)\\Delta t} e^{ikj\\Delta x} = 2e^{-i\\omega n\\Delta t} e^{ikj\\Delta x} - e^{-i\\omega(n-1)\\Delta t} e^{ikj\\Delta x} + \\lambda^2 \\left( e^{-i\\omega n\\Delta t} e^{ik(j+1)\\Delta x} - 2e^{-i\\omega n\\Delta t} e^{ikj\\Delta x} + e^{-i\\omega n\\Delta t} e^{ik(j-1)\\Delta x} \\right)\n$$\n除以公因子 $e^{-i\\omega n\\Delta t} e^{ikj\\Delta x}$：\n$$\ne^{-i\\omega\\Delta t} = 2 - e^{i\\omega\\Delta t} + \\lambda^2 \\left( e^{ik\\Delta x} - 2 + e^{-ik\\Delta x} \\right)\n$$\n重新整理各项，将时间和空间部分分组：\n$$\ne^{i\\omega\\Delta t} + e^{-i\\omega\\Delta t} - 2 = \\lambda^2 \\left( e^{ik\\Delta x} + e^{-ik\\Delta x} - 2 \\right)\n$$\n使用恒等式 $2\\cos\\theta = e^{i\\theta} + e^{-i\\theta}$，上式变为：\n$$\n2\\cos(\\omega\\Delta t) - 2 = \\lambda^2 (2\\cos(k\\Delta x) - 2)\n$$\n应用半角恒等式 $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$：\n$$\n-4\\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right) = -2\\lambda^2 \\left( 2\\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right)\n$$\n$$\n\\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n取主平方根，得到离散色散关系：\n$$\n\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\lambda\\sin\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n该关系通过数值网格参数（$\\Delta x$, $\\Delta t$）和物理波速 $c$，将离散模式的时间频率 $\\omega$ 与其空间波数 $k$ 联系起来。任何偏离连续关系 $\\omega = ck$ 的现象都称为数值色散。\n\n### 第 2 部分：反射系数\n\n在左边界 $j=0$ 处，施加一个离散的 Robin 条件：\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2\\Delta t} - c_b\\frac{u_1^n - u_0^n}{\\Delta x} = 0\n$$\n假设解是入射波（向左传播，振幅为 $A$）和反射波（向右传播，振幅为 $B$）的叠加：\n$$\nu_j^n = e^{-i\\omega n\\Delta t} \\left( A e^{-ikj\\Delta x} + B e^{ikj\\Delta x} \\right)\n$$\n我们计算边界条件所需的各项：\n$$\nu_0^n = e^{-i\\omega n\\Delta t} (A+B)\n$$\n$$\nu_0^{n+1} = e^{-i\\omega(n+1)\\Delta t} (A+B) = u_0^n e^{-i\\omega\\Delta t}\n$$\n$$\nu_0^{n-1} = e^{-i\\omega(n-1)\\Delta t} (A+B) = u_0^n e^{i\\omega\\Delta t}\n$$\n$$\nu_1^n = e^{-i\\omega n\\Delta t} \\left( A e^{-ik\\Delta x} + B e^{ik\\Delta x} \\right)\n$$\n将这些代入边界条件并除以公因子 $e^{-i\\omega n\\Delta t}$：\n$$\n(A+B)\\frac{e^{-i\\omega\\Delta t} - e^{i\\omega\\Delta t}}{2\\Delta t} - \\frac{c_b}{\\Delta x} \\left[ \\left( A e^{-ik\\Delta x} + B e^{ik\\Delta x} \\right) - (A+B) \\right] = 0\n$$\n使用恒等式 $e^{-i\\theta} - e^{i\\theta} = -2i\\sin\\theta$：\n$$\n(A+B) \\frac{-i\\sin(\\omega\\Delta t)}{\\Delta t} - \\frac{c_b}{\\Delta x} \\left[ A(e^{-ik\\Delta x} - 1) + B(e^{ik\\Delta x} - 1) \\right] = 0\n$$\n为了求反射系数 $R = B/A$，我们用 $A$ 除以上式：\n$$\n(1+R) \\frac{-i\\sin(\\omega\\Delta t)}{\\Delta t} = \\frac{c_b}{\\Delta x} \\left[ (e^{-ik\\Delta x} - 1) + R(e^{ik\\Delta x} - 1) \\right]\n$$\n我们重新整理以求解 $R$：\n$$\nR \\left[ \\frac{-i\\sin(\\omega\\Delta t)}{\\Delta t} - \\frac{c_b}{\\Delta x}(e^{ik\\Delta x} - 1) \\right] = \\frac{c_b}{\\Delta x}(e^{-ik\\Delta x} - 1) + \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t}\n$$\n这给出了反射系数：\n$$\nR = \\frac{\\frac{c_b}{\\Delta x}(e^{-ik\\Delta x} - 1) + \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t}}{-\\frac{i\\sin(\\omega\\Delta t)}{\\Delta t} - \\frac{c_b}{\\Delta x}(e^{ik\\Delta x} - 1)} = - \\frac{\\frac{c_b}{\\Delta x}(e^{-ik\\Delta x} - 1) + \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t}}{\\frac{c_b}{\\Delta x}(e^{ik\\Delta x} - 1) + \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t}}\n$$\n\n### 第 3 部分：精确阻抗匹配条件\n\n如果反射系数 $R$ 的分子为零，则 $R$ 为零：\n$$\n\\frac{c_b}{\\Delta x}(e^{-ik\\Delta x} - 1) + \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t} = 0\n$$\n求解 $c_b$：\n$$\nc_b = - \\frac{i\\sin(\\omega\\Delta t)}{\\Delta t} \\frac{\\Delta x}{e^{-ik\\Delta x} - 1}\n$$\n为简化，我们使用恒等式 $e^{-i\\theta} - 1 = -2i\\sin(\\theta/2)e^{-i\\theta/2}$ 和 $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$：\n$$\nc_b = - \\frac{i \\cdot 2\\sin(\\omega\\Delta t/2) \\cos(\\omega\\Delta t/2)}{\\Delta t} \\frac{\\Delta x}{-2i\\sin(k\\Delta x/2) e^{-ik\\Delta x/2}}\n$$\n$$\nc_b = \\frac{\\Delta x}{\\Delta t} \\frac{\\sin(\\omega\\Delta t/2)}{\\sin(k\\Delta x/2)} \\cos(\\omega\\Delta t/2) e^{ik\\Delta x/2}\n$$\n代入离散色散关系 $\\sin(\\omega\\Delta t/2) = \\lambda\\sin(k\\Delta x/2)$：\n$$\nc_b = \\frac{\\Delta x}{\\Delta t} \\lambda \\cos(\\omega\\Delta t/2) e^{ik\\Delta x/2}\n$$\n使用 $\\lambda = c\\Delta t/\\Delta x$：\n$$\nc_b = c \\cos\\left(\\frac{\\omega\\Delta t}{2}\\right) e^{ik\\Delta x/2}\n$$\n这是对于给定的离散模式 $(k, \\omega)$，$c_b$ 满足完美吸收的条件。请注意，对于实值边界算子，$c_b$ 必须是实数。推导出的条件表明 $c_b$ 通常是复数，这意味着这种局部的、一阶的边界条件不能完美吸收所有频率的波。\n\n### 第 4 部分：反射的数值计算\n\n题目要求我们计算当 $c_b$ 设置为物理波速 $c_b = c$ 时反射系数的模 $|R|$。我们使用第 2 部分中得到的 $R$ 的公式。为了便于计算，我们将分子和分母同乘以 $\\Delta t$：\n$$\nR = - \\frac{\\frac{c\\Delta t}{\\Delta x}(e^{-ik\\Delta x} - 1) + i\\sin(\\omega\\Delta t)}{\\frac{c\\Delta t}{\\Delta x}(e^{ik\\Delta x} - 1) + i\\sin(\\omega\\Delta t)}\n$$\n代入 $\\lambda = c\\Delta t/\\Delta x$，我们得到用于计算的表达式：\n$$\nR = - \\frac{\\lambda(e^{-ik\\Delta x} - 1) + i\\sin(\\omega\\Delta t)}{\\lambda(e^{ik\\Delta x} - 1) + i\\sin(\\omega\\Delta t)}\n$$\n对于由参数 $(\\lambda, k\\Delta x)$ 指定的每个测试用例，计算步骤如下：\n1.  给定 $\\lambda$ 和 $\\tilde{k} = k\\Delta x$。\n2.  根据色散关系，确定相应的离散频率项 $\\omega\\Delta t$：\n    $$\n    \\omega\\Delta t = 2\\arcsin\\left(\\lambda\\sin\\left(\\frac{\\tilde{k}}{2}\\right)\\right)\n    $$\n3.  计算 $\\sin(\\omega\\Delta t)$。\n4.  将 $\\lambda$、$\\tilde{k}$ 和 $\\sin(\\omega\\Delta t)$ 代入 $R$ 的表达式。\n5.  计算分子 $(N)$ 和分母 $(D)$ 的复数值。\n6.  反射系数的模为 $|R| = |N|/|D|$。\n\n此过程在提供的 Python 代码中实现。常数 $c=1\\,\\mathrm{m/s}$ 和 $\\Delta x=1\\,\\mathrm{m}$ 意味着 $\\Delta t = \\lambda \\frac{\\Delta x}{c} = \\lambda$ 秒。针对指定的五个测试用例进行计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the numerical reflection coefficient for a 1D wave\n    equation with a finite-difference scheme and a discrete impedance boundary\n    condition.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (lambda, k*Delta_x)\n    # c=1 and Delta_x=1 are fixed across all tests.\n    test_cases = [\n        (0.9, np.pi / 3),      # Test 1 (happy path)\n        (0.99, np.pi / 3),     # Test 2 (near-CFL)\n        (0.99, 0.01),          # Test 3 (near-CFL, long wavelength)\n        (0.99, 0.9 * np.pi),   # Test 4 (near-CFL, near-Nyquist)\n        (0.5, np.pi / 3),      # Test 5 (sub-CFL)\n    ]\n\n    results = []\n    \n    for lmbda, k_dx in test_cases:\n        # Step 1: Use the discrete dispersion relation to find omega*Delta_t.\n        # sin(omega*dt/2) = lambda * sin(k*dx/2)\n        # We can assume the argument to arcsin is = 1 because lambda = 1 is the CFL stability condition.\n        sin_omega_dt_half = lmbda * np.sin(k_dx / 2)\n        omega_dt = 2 * np.arcsin(sin_omega_dt_half)\n\n        # Step 2: Calculate sin(omega*dt) which is needed in the reflection coefficient formula.\n        sin_omega_dt = np.sin(omega_dt)\n\n        # Step 3: Define complex exponential terms.\n        exp_ikdx = np.exp(1j * k_dx)\n        exp_neg_ikdx = np.exp(-1j * k_dx) # or 1/exp_ikdx\n        \n        # Step 4: Calculate the numerator and denominator of the reflection coefficient formula.\n        # R = - [lambda*(exp(-i*k*dx) - 1) + i*sin(omega*dt)] / [lambda*(exp(i*k*dx) - 1) + i*sin(omega*dt)]\n        \n        numerator = lmbda * (exp_neg_ikdx - 1) + 1j * sin_omega_dt\n        denominator = lmbda * (exp_ikdx - 1) + 1j * sin_omega_dt\n        \n        # Step 5: Compute the magnitude of the reflection coefficient |R|.\n        # |R| = |-num/den| = |num| / |den|\n        r_magnitude = np.abs(numerator) / np.abs(denominator)\n        \n        # Step 6: Round to eight decimal places and append to results.\n        results.append(f\"{r_magnitude:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}