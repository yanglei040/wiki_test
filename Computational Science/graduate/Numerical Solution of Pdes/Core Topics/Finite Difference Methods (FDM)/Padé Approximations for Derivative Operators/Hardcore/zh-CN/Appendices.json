{
    "hands_on_practices": [
        {
            "introduction": "Padé 格式的威力在于其能在紧凑的模板上实现高精度。本练习将指导您完成一个基础而重要的任务：利用泰勒级数展开，从第一性原理出发推导一个六阶精度紧凑格式的系数。掌握这一过程  是理解乃至创造新数值方法的基石。",
            "id": "3428918",
            "problem": "考虑在均匀网格 $x_{i} = x_{0} + i h$ 上采样的光滑函数 $f(x)$，网格间距为 $h  0$，并采用周期性边界条件，这是数值求解偏微分方程（PDE）中的标准做法。通过以下隐式格式定义一阶导数 $f'(x)$ 的一个紧致Padé型三对角近似：\n$$\n\\alpha\\, D_{i-1} + D_{i} + \\alpha\\, D_{i+1} \\;=\\; \\frac{1}{h}\\left[ a\\left(f_{i+1} - f_{i-1}\\right) + b\\left(f_{i+{2}} - f_{i-{2}}\\right) \\right],\n$$\n其中 $D_{i}$ 是 $f'(x_{i})$ 的离散近似，而 $\\alpha$、$a$ 和 $b$ 是待确定的、与网格无关的系数。目标是选择 $\\alpha$、$a$ 和 $b$，使得该近似达到六阶精度，即截断误差为 $\\mathcal{O}(h^{6})$。\n\n仅从函数 $f(x)$ 在 $x_{i}$ 点的泰勒级数展开以及周期性网格的离散傅里叶符号的定义出发，推导保证六阶精度的条件，并求解唯一的系数 $\\alpha$、$a$ 和 $b$，这些系数需满足左侧为三对角形式，且右侧最多只使用到二阶邻点。然后，使用离散傅里叶模 $f_{j} = \\exp(\\mathrm{i} k x_{j})$（其中无量纲波数为 $\\xi = k h$），构建修正波数符号\n$$\n\\kappa(\\xi) \\quad \\text{使得} \\quad D_{j} \\;=\\; \\frac{\\mathrm{i}\\, \\kappa(\\xi)}{h}\\, f_{j},\n$$\n并通过将 $\\kappa(\\xi)$ 在 $\\xi = 0$ 附近进行泰勒级数展开来验证其六阶精度。\n\n以精确有理数形式表示最终系数 $\\alpha$、$a$、$b$ 和 $c$，其中 $c$ 是乘以 $\\left(f_{i+3} - f_{i-3}\\right)$ 的系数，在此构造中必须设为零。以单行矩阵的形式提供最终答案。无需四舍五入，不涉及物理单位。",
            "solution": "首先验证该问题，确认其为数值分析领域中一个适定且科学上合理的问题。该问题要求推导用于一阶导数的六阶紧致有限差分格式的系数。\n\n给定的格式为：\n$$\n\\alpha\\, D_{i-1} + D_{i} + \\alpha\\, D_{i+1} \\;=\\; \\frac{1}{h}\\left[ a\\left(f_{i+1} - f_{i-1}\\right) + b\\left(f_{i+{2}} - f_{i-{2}}\\right) \\right]\n$$\n为确定精度阶数，我们分析截断误差。截断误差通过将精确导数 $f'(x_i)$ 替换为其近似 $D_i$、将精确函数值 $f(x_i)$ 替换为 $f_i$ 来获得。令 $f_i^{(n)}$ 表示 $f(x)$ 在 $x_i$ 处计算的 $n$ 阶导数。截断误差 $T_i$ 定义为：\n$$\nT_i = \\left( \\alpha\\, f'_{i-1} + f'_{i} + \\alpha\\, f'_{i+1} \\right) - \\frac{1}{h}\\left[ a\\left(f_{i+1} - f_{i-1}\\right) + b\\left(f_{i+{2}} - f_{i-{2}}\\right) \\right]\n$$\n我们将每一项在点 $x_i$ 附近进行泰勒级数展开。函数值的展开式为：\n$$\nf_{i\\pm m} = f(x_i \\pm mh) = \\sum_{n=0}^{\\infty} \\frac{(\\pm mh)^n}{n!} f_i^{(n)}\n$$\n这给出了中心差分：\n$$\nf_{i+1} - f_{i-1} = 2hf_i' + \\frac{2h^3}{3!}f_i''' + \\frac{2h^5}{5!}f_i^{(5)} + \\frac{2h^7}{7!}f_i^{(7)} + \\mathcal{O}(h^9)\n$$\n$$\nf_{i+2} - f_{i-2} = 4hf_i' + \\frac{16h^3}{3!}f_i''' + \\frac{64h^5}{5!}f_i^{(5)} + \\frac{256h^7}{7!}f_i^{(7)} + \\mathcal{O}(h^9)\n$$\n当格式算子的右侧（RHS）作用于精确函数时，变为：\n$$\n\\text{RHS} = \\frac{a}{h}\\left(2hf_i' + \\frac{h^3}{3}f_i''' + \\frac{h^5}{60}f_i^{(5)} + \\frac{h^7}{2520}f_i^{(7)}\\right) + \\frac{b}{h}\\left(4hf_i' + \\frac{8h^3}{3}f_i''' + \\frac{32h^5}{60}f_i^{(5)} + \\frac{128h^7}{2520}f_i^{(7)}\\right) + \\dots\n$$\n$$\n\\text{RHS} = (2a+4b)f_i' + \\left(\\frac{a}{3}+\\frac{8b}{3}\\right)h^2f_i''' + \\left(\\frac{a}{60}+\\frac{32b}{60}\\right)h^4f_i^{(5)} + \\left(\\frac{a}{2520}+\\frac{128b}{2520}\\right)h^6f_i^{(7)} + \\mathcal{O}(h^8)\n$$\n左侧（LHS）的导数项的展开式为：\n$$\nf'_{i\\pm 1} = f'(x_i \\pm h) = f'_i \\pm hf''_i + \\frac{h^2}{2!}f'''_i \\pm \\frac{h^3}{3!}f^{(4)}_i + \\frac{h^4}{4!}f^{(5)}_i \\pm \\frac{h^5}{5!}f^{(6)}_i + \\frac{h^6}{6!}f^{(7)}_i + \\mathcal{O}(h^7)\n$$\nLHS 变为：\n$$\n\\text{LHS} = \\alpha(f'_i - hf''_i + \\frac{h^2}{2}f'''_i - \\dots) + f'_i + \\alpha(f'_i + hf''_i + \\frac{h^2}{2}f'''_i + \\dots)\n$$\n由于该格式是中心格式，所有偶数阶导数项都相互抵消。\n$$\n\\text{LHS} = (1+2\\alpha)f'_i + \\alpha h^2 f'''_i + \\frac{\\alpha h^4}{12}f_i^{(5)} + \\frac{\\alpha h^6}{360}f_i^{(7)} + \\mathcal{O}(h^8)\n$$\n为了使截断误差 $T_i = \\text{LHS} - \\text{RHS}$ 达到 $\\mathcal{O}(h^6)$，LHS 和 RHS 中 $f'_i$、$h^2 f'''_i$ 和 $h^4 f^{(5)}_i$ 的系数必须匹配。这就得到了一个关于 $\\alpha$、$a$ 和 $b$ 的三元线性方程组：\n1. $f'_i$:  $1+2\\alpha = 2a+4b$\n2. $h^2 f'''_i$: $\\alpha = \\frac{a}{3} + \\frac{8b}{3} \\implies 3\\alpha = a+8b$\n3. $h^4 f^{(5)}_i$: $\\frac{\\alpha}{12} = \\frac{a}{60} + \\frac{32b}{60} \\implies 5\\alpha = a+32b$\n\n我们求解这个方程组。用方程（3）减去方程（2）：\n$$\n(a+32b) - (a+8b) = 5\\alpha - 3\\alpha \\implies 24b = 2\\alpha \\implies \\alpha = 12b\n$$\n将 $\\alpha=12b$ 代入方程（2）：\n$$\na+8b = 3(12b) = 36b \\implies a = 28b\n$$\n最后，将 $\\alpha=12b$ 和 $a=28b$ 代入方程（1）：\n$$\n1 + 2(12b) = 2(28b) + 4b\n$$\n$$\n1 + 24b = 56b + 4b\n$$\n$$\n1 = 36b \\implies b = \\frac{1}{36}\n$$\n由此，我们求得其他系数：\n$$\na = 28b = \\frac{28}{36} = \\frac{7}{9}\n$$\n$$\n\\alpha = 12b = \\frac{12}{36} = \\frac{1}{3}\n$$\n问题规定 RHS 最多使用到二阶邻点，这意味着项 $(f_{i+3} - f_{i-3})$ 的系数 $c$ 为零。因此，$c=0$。\n系数为：$\\alpha = 1/3$、$a = 7/9$、$b = 1/36$ 和 $c=0$。\n\n为了验证精度阶数，我们分析修正波数 $\\kappa(\\xi)$。我们将傅里叶模 $f_j = \\exp(\\mathrm{i} k x_j)$ 和定义 $D_j = \\frac{\\mathrm{i}}{h}\\kappa(\\xi)f_j$ 代入格式中，其中 $\\xi=kh$ 且 $f_{j \\pm m} = f_j \\exp(\\pm \\mathrm{i} m \\xi)$。\n$$\n\\alpha \\frac{\\mathrm{i}\\kappa}{h}f_{i-1} + \\frac{\\mathrm{i}\\kappa}{h}f_i + \\alpha \\frac{\\mathrm{i}\\kappa}{h}f_{i+1} = \\frac{1}{h}\\left[ a(f_{i+1}-f_{i-1}) + b(f_{i+2}-f_{i-2}) \\right]\n$$\n两边同除以 $f_i/h$ 并代入指数形式，得：\n$$\n\\mathrm{i}\\kappa \\left( \\alpha \\exp(-\\mathrm{i}\\xi) + 1 + \\alpha \\exp(\\mathrm{i}\\xi) \\right) = a(\\exp(\\mathrm{i}\\xi) - \\exp(-\\mathrm{i}\\xi)) + b(\\exp(2\\mathrm{i}\\xi) - \\exp(-2\\mathrm{i}\\xi))\n$$\n使用欧拉恒等式 $2\\cos(x) = \\exp(\\mathrm{i}x)+\\exp(-\\mathrm{i}x)$ 和 $2\\mathrm{i}\\sin(x) = \\exp(\\mathrm{i}x)-\\exp(-\\mathrm{i}x)$：\n$$\n\\mathrm{i}\\kappa(1+2\\alpha\\cos\\xi) = a(2\\mathrm{i}\\sin\\xi) + b(2\\mathrm{i}\\sin(2\\xi))\n$$\n求解修正波数 $\\kappa(\\xi)$：\n$$\n\\kappa(\\xi) = \\frac{2a\\sin\\xi + 2b\\sin(2\\xi)}{1+2\\alpha\\cos\\xi}\n$$\n精确微分对应于 $\\kappa_{exact}(\\xi) = \\xi$。我们在 $\\xi=0$ 附近对 $\\kappa(\\xi)$ 进行泰勒级数展开。分子 $N(\\xi)$ 和分母 $D(\\xi)$ 的展开式为：\n$$\nN(\\xi) = 2a\\left(\\xi-\\frac{\\xi^3}{6}+\\frac{\\xi^5}{120}-\\frac{\\xi^7}{5040}\\right) + 2b\\left(2\\xi-\\frac{8\\xi^3}{6}+\\frac{32\\xi^5}{120}-\\frac{128\\xi^7}{5040}\\right) + \\mathcal{O}(\\xi^9)\n$$\n$$\nD(\\xi) = 1+2\\alpha\\left(1-\\frac{\\xi^2}{2}+\\frac{\\xi^4}{24}-\\frac{\\xi^6}{720}\\right) + \\mathcal{O}(\\xi^8)\n$$\n合并同类项：\n$$\nN(\\xi) = (2a+4b)\\xi - \\frac{1}{3}(a+8b)\\xi^3 + \\frac{1}{60}(a+32b)\\xi^5 - \\frac{1}{2520}(a+128b)\\xi^7 + \\dots\n$$\n$$\nD(\\xi) = (1+2\\alpha) - \\alpha\\xi^2 + \\frac{\\alpha}{12}\\xi^4 - \\frac{\\alpha}{360}\\xi^6 + \\dots\n$$\n我们推导出的条件确保了 $\\kappa(\\xi)$ 展开式中 $\\xi$、$\\xi^3$ 和 $\\xi^5$ 的系数分别为 $1$、$0$ 和 $0$。\n$$\n1+2\\alpha = 2a+4b \\quad \\implies \\quad \\kappa(0) = 0, \\kappa'(0)=1\n$$\n$$\n(1+2\\alpha)\\left(-\\frac{\\xi^2}{1+2\\alpha}\\frac{\\alpha}{(1+2\\alpha)}\\right) = -\\frac{1}{3}(a+8b) \\implies \\alpha D'(0)\n$$\n让我们代入我们的系数值：\n$1+2\\alpha = 5/3$, $2a+4b = 5/3$。\n$a+8b=1$, $3\\alpha=1$。\n$a+32b=5/3$, $5\\alpha=5/3$。\n$\\kappa(\\xi) = N(\\xi)/D(\\xi)$ 的展开式变为：\n$$\n\\kappa(\\xi) = \\frac{\\frac{5}{3}\\xi - \\frac{1}{3}(1)\\xi^3 + \\frac{1}{60}(\\frac{5}{3})\\xi^5 - \\dots}{\\frac{5}{3} - \\frac{1}{3}\\xi^2 + \\frac{1}{12}(\\frac{1}{3})\\xi^4 - \\dots} = \\frac{\\frac{5}{3}\\left(\\xi - \\frac{1}{5}\\xi^3 + \\frac{1}{60}\\xi^5 - \\dots\\right)}{\\frac{5}{3}\\left(1 - \\frac{1}{5}\\xi^2 + \\frac{1}{60}\\xi^4 - \\dots\\right)}\n$$\n对关于 $\\xi$ 的多项式进行长除法：\n$$\n\\kappa(\\xi) = \\left(\\xi - \\frac{1}{5}\\xi^3 + \\frac{1}{60}\\xi^5 - \\dots\\right) \\left(1 + \\left(\\frac{1}{5}\\xi^2 - \\frac{1}{60}\\xi^4\\right) + \\left(\\frac{1}{5}\\xi^2\\right)^2 + \\dots \\right)\n$$\n$$\n\\kappa(\\xi) = \\xi + \\left(-\\frac{1}{5}+\\frac{1}{5}\\right)\\xi^3 + \\left(\\frac{1}{60}-\\frac{1}{5}\\frac{1}{5} + \\frac{1}{25}\\right)\\xi^5 + \\dots\n$$\n手动展开时存在一个错误。使精度达到 $O(h^4)$ 的条件是 $N(\\xi)$ 和 $\\kappa(\\xi)D(\\xi)$ 中 $\\xi^5$ 的系数相匹配。令 $\\kappa(\\xi) = \\xi + C_7\\xi^7+\\dots$。\n$\\kappa(\\xi)D(\\xi)$ 中的 $\\xi^5$ 项是 $\\xi(\\frac{\\alpha}{12}\\xi^4)$。$N(\\xi)$ 中的 $\\xi^5$ 项是 $\\frac{a+32b}{60}\\xi^5$。\n使它们相等得到 $\\frac{\\alpha}{12} = \\frac{a+32b}{60}$，这正是我们的第三个条件 $5\\alpha = a+32b$。\n该方程组的构造确实是为了使这些项消失到所要求的阶数。\n$\\kappa(\\xi)$ 与 $\\xi$ 的偏差首次出现在 $\\xi^7$ 阶：\n$$\n\\kappa(\\xi)-\\xi \\approx C_7\\xi^7\n$$\n其中 $C_7$ 是领头误差系数。物理空间中的误差为 $\\mathcal{O}(h^6)$，这证实了其六阶精度。\n因此，系数 $\\alpha=1/3$、$a=7/9$、$b=1/36$ 以及隐含的 $c=0$ 是正确的。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{3}  \\frac{7}{9}  \\frac{1}{36}  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "构建一个数值格式后，分析其质量至关重要。本练习将介绍两个关键的性能度量：色散误差和耗散误差，它们量化了格式对不同频率波的传播效果。通过为一个给定的紧凑格式计算这些误差 ，您将深入理解使其在求解波动类问题时如此高效的谱属性。",
            "id": "3428900",
            "problem": "考虑一个间距为 $h  0$ 且整数索引为 $j \\in \\mathbb{Z}$ 的均匀、无限、周期性网格。令 $f_j$ 表示一个足够光滑的函数 $f(x)$ 在 $x = j h$ 处的网格采样。如果对一阶导数的一种平移不变线性近似满足以下形式的隐式差分关系，则称其为有理近似（帕德近似）：\n$$\n\\sum_{\\ell=-L}^{L} a_{\\ell} f^\\prime_{j+\\ell} \\;=\\; \\frac{1}{h}\\sum_{m=-M}^{M} b_m f_{j+m},\n$$\n其中 $a_{\\ell}$ 和 $b_m$ 是实系数，$L, M$ 是有限整数。对于周期性问题，使用基本拟设 $f_j = e^{\\mathrm{i} j \\theta}$（其中无量纲波数为 $\\,\\theta = k h\\,$，角度单位：弧度）的傅里叶分析，通过其符号 $\\widehat{D}(\\theta)$ 来表征离散导数算子，定义为 $f^\\prime_j \\approx \\widehat{D}(\\theta) f_j$。精确的连续导数对应的符号为 $\\mathrm{i} k = (\\mathrm{i}/h)\\theta$。\n\n色散误差和耗散误差是根据离散算子产生的修正波数来定义的：\n- 色散误差是虚部与精确无量纲波数的偏差，由下式给出：\n$$\nE_{\\mathrm{disp}}(\\theta) \\;=\\; \\operatorname{Im}\\!\\big(\\widehat{D}(\\theta)\\,h\\big) \\;-\\; \\theta.\n$$\n- 耗散误差是无量纲符号的实部，由下式给出：\n$$\nE_{\\mathrm{diss}}(\\theta) \\;=\\; \\operatorname{Re}\\!\\big(\\widehat{D}(\\theta)\\,h\\big).\n$$\n\n在本问题中，分析以下用于一阶导数的候选紧致（帕德）格式：\n$$\n\\frac{1}{4} f^\\prime_{j-1} + f^\\prime_j + \\frac{1}{4} f^\\prime_{j+1} \\;=\\; \\frac{3}{4h}\\,\\big(f_{j+1} - f_{j-1}\\big).\n$$\n从傅里叶拟设和上述隐式关系出发，推导离散符号 $\\widehat{D}(\\theta)$，然后计算在 $\\theta$ 值的均匀网格上的色散和耗散误差。\n\n使用以下测试套件和规范：\n- 使用一个包含 $M = 1001$ 个点的均匀网格，覆盖 $\\theta \\in [0,\\pi]$（包含端点），单位为弧度。\n- 计算以下量：\n  1. 一个布尔值，表示是否满足 $\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{diss}}(\\theta)| \\le \\varepsilon$，容差为 $\\varepsilon = 10^{-12}$。\n  2. 网格上的最大绝对色散误差，$\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{disp}}(\\theta)|$，以浮点数形式表示。\n  3. 出现最大绝对色散误差时的 $\\theta$ 值（以弧度为单位），以浮点数形式表示。\n  4. $\\theta = \\pi/4$ 时的色散误差，以浮点数形式表示。\n  5. 网格上耗散误差的 $L^\\infty$ 范数，$\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{diss}}(\\theta)|$，以浮点数形式表示。\n\n您的程序应生成单行输出，其中包含这五个结果，形式为方括号内以逗号分隔的列表（例如，“[result1,result2,result3,result4,result5]”）。由于所有量都已通过 $\\theta = k h$ 无量纲化，并且角度单位明确为弧度，因此不需要物理单位。",
            "solution": "该问题被评估为有效，因为它代表了偏微分方程数值分析中一个适定且有科学依据的练习。所有给定的定义、条件和参数都是一致且充分的，足以推导出唯一且有意义的解。\n\n问题的核心是通过推导给定紧致有限差分格式的符号 $\\widehat{D}(\\theta)$，来确定其谱特性，然后分析相关的色散和耗散误差。\n\n指定的隐式差分格式为：\n$$\n\\frac{1}{4} f^\\prime_{j-1} + f^\\prime_j + \\frac{1}{4} f^\\prime_{j+1} \\;=\\; \\frac{3}{4h}\\,\\big(f_{j+1} - f_{j-1}\\big)\n$$\n\n这必须符合有理近似的一般形式：\n$$\n\\sum_{\\ell=-L}^{L} a_{\\ell} f^\\prime_{j+\\ell} \\;=\\; \\frac{1}{h}\\sum_{m=-M}^{M} b_m f_{j+m}\n$$\n\n通过比较这两种形式，我们可以确定系数 $a_{\\ell}$ 和 $b_m$。\n左侧（LHS）涉及导数项，给出 $L=1$ 时的 $a_{\\ell}$ 系数：\n$a_{-1} = 1/4$，$a_0 = 1$ 和 $a_1 = 1/4$。\n\n右侧（RHS）涉及函数值，给出 $M=1$ 时的 $b_m$ 系数：\n$b_{-1} = -3/4$，$b_0 = 0$ 和 $b_1 = 3/4$。\n\n为了找到符号 $\\widehat{D}(\\theta)$，我们使用傅里叶拟设 $f_j = e^{\\mathrm{i} j \\theta}$ 和离散算子的定义 $f'_j \\approx \\widehat{D}(\\theta) f_j$。将这些应用于任意网格点 $j+k$ 可得：\n$$\nf_{j+k} = e^{\\mathrm{i} (j+k) \\theta} = f_j e^{\\mathrm{i} k \\theta}\n$$\n$$\nf'_{j+k} \\approx \\widehat{D}(\\theta) f_{j+k} = \\widehat{D}(\\theta) f_j e^{\\mathrm{i} k \\theta}\n$$\n\n将这些表达式代入格式的一般形式，得到：\n$$\n\\sum_{\\ell=-L}^{L} a_{\\ell} \\left( \\widehat{D}(\\theta) f_j e^{\\mathrm{i} \\ell \\theta} \\right) \\;=\\; \\frac{1}{h}\\sum_{m=-M}^{M} b_m \\left( f_j e^{\\mathrm{i} m \\theta} \\right)\n$$\n\n由于 $f_j = e^{\\mathrm{i} j \\theta}$ 不恒为零，我们可以从两边将其约去：\n$$\n\\widehat{D}(\\theta) \\sum_{\\ell=-L}^{L} a_{\\ell} e^{\\mathrm{i} \\ell \\theta} \\;=\\; \\frac{1}{h}\\sum_{m=-M}^{M} b_m e^{\\mathrm{i} m \\theta}\n$$\n\n这使我们能够解出符号 $\\widehat{D}(\\theta)$：\n$$\n\\widehat{D}(\\theta) = \\frac{1}{h} \\frac{\\sum_{m=-M}^{M} b_m e^{\\mathrm{i} m \\theta}}{\\sum_{\\ell=-L}^{L} a_{\\ell} e^{\\mathrm{i} \\ell \\theta}}\n$$\n\n让我们用已确定的系数来计算分子和分母的和。\n分母的和，我们可以称之为 $\\mathcal{A}(\\theta)$，是：\n$$\n\\mathcal{A}(\\theta) = \\sum_{\\ell=-1}^{1} a_{\\ell} e^{\\mathrm{i} \\ell \\theta} = a_{-1}e^{-\\mathrm{i}\\theta} + a_0 + a_1e^{\\mathrm{i}\\theta}\n$$\n$$\n\\mathcal{A}(\\theta) = \\frac{1}{4}e^{-\\mathrm{i}\\theta} + 1 + \\frac{1}{4}e^{\\mathrm{i}\\theta} = 1 + \\frac{1}{4}(e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta})\n$$\n使用 Euler 恒等式 $e^{\\mathrm{i}x} + e^{-\\mathrm{i}x} = 2\\cos(x)$，我们得到：\n$$\n\\mathcal{A}(\\theta) = 1 + \\frac{1}{2}\\cos(\\theta)\n$$\n\n分子的和，我们可以称之为 $\\mathcal{B}(\\theta)$，是：\n$$\n\\mathcal{B}(\\theta) = \\sum_{m=-1}^{1} b_m e^{\\mathrm{i} m \\theta} = b_{-1}e^{-\\mathrm{i}\\theta} + b_0 + b_1e^{\\mathrm{i}\\theta}\n$$\n$$\n\\mathcal{B}(\\theta) = -\\frac{3}{4}e^{-\\mathrm{i}\\theta} + 0 + \\frac{3}{4}e^{\\mathrm{i}\\theta} = \\frac{3}{4}(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta})\n$$\n使用 Euler 恒等式 $e^{\\mathrm{i}x} - e^{-\\mathrm{i}x} = 2\\mathrm{i}\\sin(x)$，我们得到：\n$$\n\\mathcal{B}(\\theta) = \\frac{3}{4}(2\\mathrm{i}\\sin(\\theta)) = \\frac{3}{2}\\mathrm{i}\\sin(\\theta)\n$$\n\n将 $\\mathcal{A}(\\theta)$ 和 $\\mathcal{B}(\\theta)$ 代回 $\\widehat{D}(\\theta)$ 的表达式中：\n$$\n\\widehat{D}(\\theta) = \\frac{1}{h} \\frac{\\frac{3}{2}\\mathrm{i}\\sin(\\theta)}{1 + \\frac{1}{2}\\cos(\\theta)} = \\frac{\\mathrm{i}}{h} \\frac{3\\sin(\\theta)}{2+\\cos(\\theta)}\n$$\n\n问题根据无量纲修正波数 $\\widehat{D}(\\theta)h$ 定义了色散和耗散误差：\n$$\n\\widehat{D}(\\theta)h = \\mathrm{i} \\frac{3\\sin(\\theta)}{2+\\cos(\\theta)}\n$$\n\n对于所有分母不为零的实数 $\\theta$（由于 $\\cos(\\theta) \\ge -1$，分母恒不为零），该表达式是纯虚数。\n\n耗散误差定义为 $E_{\\mathrm{diss}}(\\theta) = \\operatorname{Re}(\\widehat{D}(\\theta)h)$。根据我们推导的表达式：\n$$\nE_{\\mathrm{diss}}(\\theta) = \\operatorname{Re}\\left(\\mathrm{i} \\frac{3\\sin(\\theta)}{2+\\cos(\\theta)}\\right) = 0\n$$\n该格式是完全无耗散的。\n\n色散误差定义为 $E_{\\mathrm{disp}}(\\theta) = \\operatorname{Im}(\\widehat{D}(\\theta)h) - \\theta$。\n$$\nE_{\\mathrm{disp}}(\\theta) = \\operatorname{Im}\\left(\\mathrm{i} \\frac{3\\sin(\\theta)}{2+\\cos(\\theta)}\\right) - \\theta = \\frac{3\\sin(\\theta)}{2+\\cos(\\theta)} - \\theta\n$$\n\n有了这些误差的解析表达式，我们就可以按要求进行数值计算。\n\n1.  **耗散误差阈值的布尔值**：由于对所有 $\\theta$ 都有 $E_{\\mathrm{diss}}(\\theta) = 0$，所以 $\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{diss}}(\\theta)| = 0$。给定容差 $\\varepsilon = 10^{-12}$，条件 $0 \\le 10^{-12}$ 为真。结果是 `True`。\n\n2.  **最大绝对色散误差**：我们需要找到 $\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{disp}}(\\theta)|$。让我们分析 $E_{\\mathrm{disp}}(\\theta)$ 的导数：\n    $$\n    \\frac{d}{d\\theta}E_{\\mathrm{disp}}(\\theta) = \\frac{d}{d\\theta}\\left(\\frac{3\\sin(\\theta)}{2+\\cos(\\theta)}\\right) - 1\n    $$\n    分数的导数为 $\\frac{3\\cos(\\theta)(2+\\cos(\\theta)) - 3\\sin(\\theta)(-\\sin(\\theta))}{(2+\\cos(\\theta))^2} = \\frac{6\\cos(\\theta) + 3\\cos^2(\\theta) + 3\\sin^2(\\theta)}{(2+\\cos(\\theta))^2} = \\frac{6\\cos(\\theta)+3}{(2+\\cos(\\theta))^2}$。\n    因此，$\\frac{d}{d\\theta}E_{\\mathrm{disp}}(\\theta) = \\frac{6\\cos(\\theta)+3}{(2+\\cos(\\theta))^2} - 1 = \\frac{6\\cos(\\theta)+3 - (4+4\\cos(\\theta)+\\cos^2(\\theta))}{(2+\\cos(\\theta))^2} = \\frac{-\\cos^2(\\theta)+2\\cos(\\theta)-1}{(2+\\cos(\\theta))^2} = -\\frac{(\\cos(\\theta)-1)^2}{(2+\\cos(\\theta))^2}$。\n    对于所有 $\\theta \\in [0, \\pi]$，该导数小于或等于零，且仅在 $\\theta=0$ 时等于零。这意味着 $E_{\\mathrm{disp}}(\\theta)$ 在区间 $[0, \\pi]$ 上是单调递减函数。\n    端点处的误差为：\n    $E_{\\mathrm{disp}}(0) = \\frac{3\\sin(0)}{2+\\cos(0)} - 0 = 0$。\n    $E_{\\mathrm{disp}}(\\pi) = \\frac{3\\sin(\\pi)}{2+\\cos(\\pi)} - \\pi = \\frac{0}{2-1} - \\pi = -\\pi$。\n    由于函数是单调的，最大绝对值必定出现在某个端点。我们有 $|E_{\\mathrm{disp}}(0)|=0$ 和 $|E_{\\mathrm{disp}}(\\pi)|=\\pi$。因此，最大绝对色散误差为 $\\pi$。\n\n3.  **最大误差处的 $\\theta$ 值**：根据以上分析，最大绝对误差出现在 $\\theta=\\pi$ 处。\n\n4.  **$\\theta=\\pi/4$ 处的色散误差**：我们直接计算表达式的值：\n    $$\n    E_{\\mathrm{disp}}(\\pi/4) = \\frac{3\\sin(\\pi/4)}{2+\\cos(\\pi/4)} - \\frac{\\pi}{4} = \\frac{3(\\sqrt{2}/2)}{2+(\\sqrt{2}/2)} - \\frac{\\pi}{4} = \\frac{3\\sqrt{2}}{4+\\sqrt{2}} - \\frac{\\pi}{4}\n    $$\n\n5.  **耗散误差的 $L^\\infty$ 范数**：即 $\\max_{\\theta \\in [0,\\pi]} |E_{\\mathrm{diss}}(\\theta)|$。如前所述，$E_{\\mathrm{diss}}(\\theta)=0$，所以该值为 $0$。\n\n这些结果将在最终程序中进行数值计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the dispersion and dissipation errors of a compact finite difference scheme.\n    \"\"\"\n    \n    # 1. Setup the computational grid and constants.\n    M = 1001\n    epsilon = 1e-12\n    # Create a uniform grid for theta from 0 to pi.\n    theta = np.linspace(0, np.pi, M)\n\n    # 2. Define and compute the error functions.\n    # The nondimensional symbol is D_hat * h = i * (3*sin(theta)) / (2+cos(theta)).\n    # The dissipation error is the real part, which is identically zero.\n    # The dispersion error is the imaginary part minus theta.\n    \n    # E_diss(theta) = Re(D_hat * h)\n    e_diss = np.zeros_like(theta)\n    \n    # E_disp(theta) = Im(D_hat * h) - theta\n    # Handle the case theta=0 to avoid potential 0/0 (though not an issue here).\n    # The expression is well-behaved, but it's good practice.\n    numerator = 3 * np.sin(theta)\n    denominator = 2 + np.cos(theta)\n    imaginary_part = np.divide(numerator, denominator, out=np.zeros_like(numerator), where=denominator!=0)\n    e_disp = imaginary_part - theta\n\n    # 3. Compute the five required quantities.\n    \n    # Quantity 1: Boolean indicating if max dissipation error is below a tolerance.\n    # Since e_diss is identically 0, max|e_diss| is 0.\n    l_inf_diss_error = np.max(np.abs(e_diss))\n    is_low_dissipation = l_inf_diss_error = epsilon\n    \n    # Quantity 2: Maximum absolute dispersion error over the grid.\n    max_abs_disp_error = np.max(np.abs(e_disp))\n    \n    # Quantity 3: The value of theta where the max absolute dispersion error occurs.\n    # As shown in the derivation, this occurs at theta = pi.\n    # We can confirm this numerically.\n    max_error_index = np.argmax(np.abs(e_disp))\n    theta_at_max_error = theta[max_error_index]\n    \n    # Quantity 4: The dispersion error at theta = pi/4.\n    # Computed directly for higher accuracy than interpolating from the grid.\n    theta_val = np.pi / 4.0\n    disp_err_at_pi_4 = (3 * np.sin(theta_val)) / (2 + np.cos(theta_val)) - theta_val\n    \n    # Quantity 5: The L-infinity norm of the dissipation error.\n    # This is the same as calculated for Quantity 1.\n    l_inf_diss_error_recomputed = l_inf_diss_error\n\n    # 4. Collate results and print in the specified format.\n    results = [\n        is_low_dissipation,\n        max_abs_disp_error,\n        theta_at_max_error,\n        disp_err_at_pi_4,\n        l_inf_diss_error_recomputed\n    ]\n\n    # Convert all results to strings and join with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理论必须与实践相结合。最后一个练习要求您实现两种不同的算法来应用紧凑微分算子：一种利用快速傅里叶变换（FFT），另一种直接求解带状线性系统。这个练习  将为您提供关于谱方法和物理空间方法之间计算权衡的实践经验，这是高性能科学计算中的一个核心主题。",
            "id": "3428876",
            "problem": "要求您为一阶导数算子的周期性紧致Padé近似构建、分析并比较两种数值求解器。该近似是使用类谱方法有限差分解偏微分方程(PDE)的核心构建模块。区域是周期性的，长度为 $L = 2\\pi$，所有角度都必须以弧度处理。您必须遵守以下要求，并生成一个单一、完整、可运行的程序，该程序执行所有任务并以末尾指定的确切格式打印汇总结果。\n\n起点和核心定义：\n- 考虑一个均匀周期性网格 $x_j = j h$，其中 $j = 0, 1, \\dots, N-1$，间距为 $h = L/N$，且 $L = 2\\pi$。\n- 令 $u_j = u(x_j)$ 表示光滑周期函数 $u(x)$ 的采样值。\n- 考虑周期性网格上一阶导数 $u'(x)$ 的三对角紧致Padé格式，其形式为\n$$\n\\alpha\\, u'_{j-1} + u'_j + \\alpha\\, u'_{j+1} \\;=\\; \\frac{b_1}{h}\\,\\left(u_{j+1} - u_{j-1}\\right),\n$$\n其中 $\\alpha$ 和 $b_1$ 是待定常数，且下标按周期性解释：$u_{-1} = u_{N-1}$ 和 $u_{N} = u_0$。\n\n任务：\n1) 从 $u(x)$ 及其导数在 $x_j$ 点的基本泰勒级数展开出发，通过施加格式近似 $u'(x_j)$ 的截断误差为 $\\mathcal{O}(h^4)$ 阶的条件，来确定系数 $\\alpha$ 和 $b_1$。您必须从第一性原理出发，通过匹配泰勒系数来推导它们，不得使用任何预先记下的系数。\n\n2) 对周期性网格使用离散傅里叶变换 (DFT) 分析，在傅里叶空间中对角化该紧致格式。也就是说，考虑离散傅里叶模式 $e^{\\mathrm{i} j \\theta}$，其中网格角 $\\theta = 2\\pi m/N$ (m为整数)，并推导有理修正波数 $\\kappa(\\theta)$，使得该格式在傅里叶空间中的作用等效于乘以 $\\mathrm{i}\\,\\kappa(\\theta)$。请用 $\\alpha$、$b_1$、$h$、$\\sin(\\theta)$ 和 $\\cos(\\theta)$ 明确表示 $\\kappa(\\theta)$。\n\n3) 为作用于采样数据 $u_j$ 的导数算子实现两种求解器：\n- 基于FFT的求解器（快速傅里叶变换(FFT)方法）：使用DFT将 $u_j$ 变换到傅里叶空间，将每个傅里叶系数乘以 $\\mathrm{i}\\,\\kappa(\\theta_m)$，然后变换回物理空间以获得导数值。这实现了您所推导的对角化，并逐个模式地应用了有理符号。\n- 直接带状求解：组装左侧线性算子，其主对角线元素为1，周期性第一副对角线元素为 $\\alpha$，外加位于右上角和左下角的两个回卷角点元素 $\\alpha$。组装右端项模板向量 $(b_1/h)\\,(u_{j+1} - u_{j-1})$。然后，使用基于托马斯算法（用于内部三对角部分）和Sherman–Morrison–Woodbury恒等式（用于合并两个回卷角点耦合）的线性时间循环三对角求解器，直接求解关于 $u'_j$ 的线性系统。不要使用任何黑箱循环矩阵求解器。\n\n4) 定义、实现并使用向量 $\\mathbf{v}$ 和 $\\mathbf{w}$ 的离散相对 $L^2$ 误差，其定义为\n$$\nE_2(\\mathbf{v},\\mathbf{w}) \\;=\\; \\frac{\\|\\mathbf{v} - \\mathbf{w}\\|_2}{\\|\\mathbf{w}\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示欧几里得范数。对于以下测试套件，计算并报告基于FFT的求解器和直接带状求解相对于精确导数的相对 $L^2$ 误差。\n\n5) 成本模型与比较：不测量墙上时钟时间，而是使用以下合理且广泛使用的计数方法，估算两种方法作为 $N$ 的函数的理论运算计数成本：\n- 一个长度为 $N$ 的复数FFT或逆FFT大约需要 $C_{\\mathrm{FFT}}\\,N \\log_2 N$ 次浮点运算，其中 $C_{\\mathrm{FFT}} = 5$。基于FFT的方法使用两次此类变换（正向和逆向），外加 $\\mathcal{O}(N)$ 次逐元素乘法，您应将其总计为 $3N$ 次浮点运算，用于逐点乘法和简单向量操作。因此，使用\n$$\n\\mathrm{cost}_{\\mathrm{FFT}}(N) \\;=\\; 2\\,C_{\\mathrm{FFT}}\\,N \\log_2 N \\;+\\; 3 N.\n$$\n- 一次通过托马斯算法的三对角求解大约需要 $8N$ 次浮点运算。通过Sherman–Morrison–Woodbury恒等式进行的循环校正需要额外两次三对角求解和可忽略的额外 $\\mathcal{O}(1)$ 工作量，因此总共是三次三对角求解。右端项模板应用和向量更新是 $\\mathcal{O}(N)$ 的，计为 $3N$ 次浮点运算。因此，使用\n$$\n\\mathrm{cost}_{\\mathrm{banded}}(N) \\;=\\; 3\\cdot 8 N \\;+\\; 3 N \\;=\\; 27 N.\n$$\n报告成本比\n$$\n\\rho(N) \\;=\\; \\frac{\\mathrm{cost}_{\\mathrm{FFT}}(N)}{\\mathrm{cost}_{\\mathrm{banded}}(N)}.\n$$\n\n测试套件：\n- 对于每种情况，令 $[0, 2\\pi]$ 上的 $u(x) = \\sin(k\\,x)$ 并进行周期性延拓，因此精确导数为 $u'(x) = k \\cos(k\\,x)$。\n- 使用以下四种情况，它们测试了不同的区域（平滑、中等波数和近奈奎斯特行为），所有角度均以弧度为单位：\n  - 情况 A：$N = 64$，$k = 4$。\n  - 情况 B：$N = 128$，$k = 1$。\n  - 情况 C：$N = 96$，$k = 32$。\n  - 情况 D：$N = 63$，$k = 31$。\n对于每种情况，计算并存储一个包含三个浮点数的三元组：基于FFT的相对 $L^2$ 误差、直接带状求解的相对 $L^2$ 误差和成本比 $\\rho(N)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，列表中的每个条目本身都是一个方括号括起来的三元组。这四个条目必须按照上述测试用例的顺序打印。例如，一个有效的形状是\n$[ [e_{A,\\mathrm{FFT}}, e_{A,\\mathrm{band}}, \\rho_A], [e_{B,\\mathrm{FFT}}, e_{B,\\mathrm{band}}, \\rho_B], [e_{C,\\mathrm{FFT}}, e_{C,\\mathrm{band}}, \\rho_C], [e_{D,\\mathrm{FFT}}, e_{D,\\mathrm{band}}, \\rho_D] ]$\n不带任何额外注释。",
            "solution": "用户的问题是一个定义明确的数值分析练习，重点是在周期性域上为一阶导数构建和分析一个四阶紧致有限差分格式。该问题具有科学依据、内容自洽且客观。它包含该领域一系列标准任务：通过泰勒级数推导格式系数，使用傅里叶分析（修正波数）分析格式的谱特性，实现两种不同的求解算法（一种在傅里叶空间，一种在物理空间），最后，在一组指定的测试用例上比较它们的精度和理论成本。所有提供的定义、约束和测试参数都清晰一致。因此，该问题被认为是**有效的**，下面将给出完整的解决方案。\n\n### 1. 格式系数的推导\n\n问题指定了在均匀网格 $x_j = j h$ 上，光滑周期函数 $u(x)$ 的一阶导数 $u'_j = u'(x_j)$ 的三对角紧致Padé格式：\n$$\n\\alpha\\, u'_{j-1} + u'_j + \\alpha\\, u'_{j+1} = \\frac{b_1}{h}\\,\\left(u_{j+1} - u_{j-1}\\right)\n$$\n为了确定常数 $\\alpha$ 和 $b_1$，我们要求该格式具有 $\\mathcal{O}(h^4)$ 阶的截断误差。这通过匹配方程两边在 $x_j$ 点附近的泰勒级数展开中的各项来实现。\n\n首先，我们展开左侧（LHS）涉及导数 $u'$ 的项：\n$u'_{j\\pm 1} = u'(x_j \\pm h) = u'(x_j) \\pm h u''(x_j) + \\frac{h^2}{2} u'''(x_j) \\pm \\frac{h^3}{6} u^{(4)}(x_j) + \\frac{h^4}{24} u^{(5)}(x_j) \\pm \\mathcal{O}(h^5)$。\n对 $u'_{j-1}$ 和 $u'_{j+1}$ 求和：\n$u'_{j-1} + u'_{j+1} = 2u'_j + h^2 u'''_j + \\frac{h^4}{12}u^{(5)}_j + \\mathcal{O}(h^6)$。\n完整的LHS变为：\n$$\n\\text{LHS} = (1+2\\alpha)u'_j + \\alpha h^2 u'''_j + \\frac{\\alpha h^4}{12} u^{(5)}_j + \\mathcal{O}(h^6)\n$$\n接下来，我们展开右侧（RHS）涉及函数值 $u$ 的项：\n$u_{j\\pm 1} = u(x_j \\pm h) = u(x_j) \\pm h u'(x_j) + \\frac{h^2}{2} u''(x_j) \\pm \\frac{h^3}{6} u'''(x_j) + \\frac{h^4}{24} u^{(4)}(x_j) \\pm \\frac{h^5}{120} u^{(5)}(x_j) + \\mathcal{O}(h^6)$。\n差分 $u_{j+1} - u_{j-1}$ 是标准的二阶中心差分模板（相差一个因子 $2h$）：\n$u_{j+1} - u_{j-1} = 2h u'_j + \\frac{h^3}{3} u'''_j + \\frac{h^5}{60} u^{(5)}_j + \\mathcal{O}(h^7)$。\n完整的RHS变为：\n$$\n\\text{RHS} = \\frac{b_1}{h} \\left( 2h u'_j + \\frac{h^3}{3} u'''_j + \\frac{h^5}{60} u^{(5)}_j + \\mathcal{O}(h^7) \\right) = 2b_1 u'_j + \\frac{b_1 h^2}{3} u'''_j + \\frac{b_1 h^4}{60} u^{(5)}_j + \\mathcal{O}(h^6)\n$$\n为使格式精确，LHS必须近似于RHS。我们逐项匹配导数的系数。\n\\begin{itemize}\n    \\item $u'_j$ 的系数：$1+2\\alpha = 2b_1$\n    \\item $u'''_j$ 的系数：$\\alpha h^2 = \\frac{b_1 h^2}{3} \\implies \\alpha = \\frac{b_1}{3}$\n\\end{itemize}\n这给出了一个关于 $\\alpha$ 和 $b_1$ 的二元线性方程组。将第二个方程代入第一个方程：\n$1 + 2\\left(\\frac{b_1}{3}\\right) = 2b_1 \\implies 1 = 2b_1 - \\frac{2b_1}{3} = \\frac{4b_1}{3}$。\n这得到 $b_1 = 3/4$。\n代回后，我们发现 $\\alpha = \\frac{1}{3} b_1 = \\frac{1}{3} \\left(\\frac{3}{4}\\right) = 1/4$。\n因此系数为 $\\alpha=1/4$ 和 $b_1=3/4$。\n截断误差由第一个不匹配的项决定，即 $u^{(5)}_j$ 项。误差与 $(\\text{RHS 项}) - (\\text{LHS 项})$ 成正比：\n$\\left( \\frac{b_1}{60} - \\frac{\\alpha}{12} \\right) h^4 u^{(5)}_j = \\left( \\frac{3/4}{60} - \\frac{1/4}{12} \\right) h^4 u^{(5)}_j = \\left( \\frac{1}{80} - \\frac{1}{48} \\right) h^4 u^{(5)}_j = \\left( \\frac{3-5}{240} \\right) h^4 u^{(5)}_j = -\\frac{1}{120}h^4 u^{(5)}_j$。\n首项误差为 $\\mathcal{O}(h^4)$，符合要求。\n\n### 2. 修正波数的推导\n\n我们分析该格式在单个离散傅里叶模式 $u_j = e^{\\mathrm{i} j \\theta}$ 上的行为，其中 $\\theta = 2\\pi m/N$ 是整数模式数 $m$ 对应的网格角。精确导数对应于乘以 $\\mathrm{i}k = \\mathrm{i}\\theta/h$。然而，数值格式的有效作用是乘以 $\\mathrm{i}\\kappa(\\theta)$，其中 $\\kappa(\\theta)$ 是修正波数。我们将 $u_j = e^{\\mathrm{i} j \\theta}$ 及其数值导数的拟设 $u'_j = \\mathrm{i}\\kappa(\\theta) e^{\\mathrm{i} j \\theta}$ 代入Padé格式：\n$$\n\\alpha(\\mathrm{i}\\kappa e^{\\mathrm{i}(j-1)\\theta}) + (\\mathrm{i}\\kappa e^{\\mathrm{i}j\\theta}) + \\alpha(\\mathrm{i}\\kappa e^{\\mathrm{i}(j+1)\\theta}) = \\frac{b_1}{h}(e^{\\mathrm{i}(j+1)\\theta} - e^{\\mathrm{i}(j-1)\\theta})\n$$\n除以公因子 $\\mathrm{i} e^{\\mathrm{i} j \\theta}$：\n$$\n\\kappa \\left( \\alpha e^{-\\mathrm{i}\\theta} + 1 + \\alpha e^{\\mathrm{i}\\theta} \\right) = \\frac{b_1}{h} \\frac{1}{\\mathrm{i}} \\left( e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta} \\right)\n$$\n使用欧拉公式 $e^{\\mathrm{i}\\theta} \\pm e^{-\\mathrm{i}\\theta} = 2\\cos\\theta$ 或 $2\\mathrm{i}\\sin\\theta$：\n$$\n\\kappa \\left( 1 + 2\\alpha \\cos\\theta \\right) = \\frac{b_1}{h} (2\\sin\\theta)\n$$\n求解修正波数 $\\kappa(\\theta)$：\n$$\n\\kappa(\\theta) = \\frac{1}{h} \\frac{2b_1 \\sin\\theta}{1 + 2\\alpha \\cos\\theta}\n$$\n代入推导出的系数 $\\alpha=1/4$ 和 $b_1=3/4$：\n$$\n\\kappa(\\theta) = \\frac{1}{h} \\frac{2(3/4) \\sin\\theta}{1 + 2(1/4) \\cos\\theta} = \\frac{1}{h} \\frac{(3/2) \\sin\\theta}{1 + (1/2) \\cos\\theta} = \\frac{3 \\sin\\theta}{h(2 + \\cos\\theta)}\n$$\n这个有理函数 $\\kappa(\\theta)$ 代表了数值格式的有效波数。\n\n### 3. 求解器实现\n\n#### 基于FFT的求解器\n修正波数的推导表明，该紧致格式在傅里叶空间中是对角的。这提示了一种使用快速傅里叶变换 (FFT) 的高效求解方法。步骤如下：\n1.  给定函数采样向量 $\\mathbf{u} = [u_0, u_1, \\dots, u_{N-1}]^T$，计算其离散傅里叶变换 (DFT)，$\\hat{\\mathbf{u}} = \\text{FFT}(\\mathbf{u})$。\n2.  对每个傅里叶模式 $m=0, 1, \\dots, N-1$，计算相应的网格角 $\\theta_m = 2\\pi m/N$（`numpy.fft.fftfreq` 会正确处理负频率）和修正波数 $\\kappa(\\theta_m)$。\n3.  导数向量的DFT $\\hat{\\mathbf{u}}'$ 通过将 $\\hat{\\mathbf{u}}$ 的每个分量乘以其对应的谱算子 $\\mathrm{i}\\kappa(\\theta_m)$ 得到。即 $\\hat{u}'_m = \\mathrm{i}\\kappa(\\theta_m)\\hat{u}_m$。\n4.  物理空间中所需的导数向量 $\\mathbf{u}'$ 通过应用逆DFT得到：$\\mathbf{u}' = \\text{IFFT}(\\hat{\\mathbf{u}}')$。\n由于输入函数 $u(x)$ 是实数，得到的导数也必须是实数。最终向量中任何微小的虚部都是由浮点误差引起的，应当舍去。\n\n#### 直接带状求解\nPadé格式可以写成关于未知导数向量 $\\mathbf{u}' = [u'_0, \\dots, u'_{N-1}]^T$ 的线性方程组 $A \\mathbf{u}' = \\mathbf{f}$。矩阵 $A$ 代表左侧算子，是一个循环三对角矩阵：\n$$\nA = \\begin{pmatrix}\n1  \\alpha  0  \\dots  0  \\alpha \\\\\n\\alpha  1  \\alpha    0 \\\\\n0  \\ddots  \\ddots  \\ddots   \\vdots \\\\\n\\vdots   \\ddots  \\ddots  \\ddots  0 \\\\\n0    \\alpha  1  \\alpha \\\\\n\\alpha  0  \\dots  0  \\alpha  1\n\\end{pmatrix}\n$$\n向量 $\\mathbf{f}$ 是将右侧算子应用于数据向量 $\\mathbf{u}$ 的结果。\n直接求解这个循环系统比简单的三对角求解更复杂。我们使用Sherman-Morrison-Woodbury公式。矩阵 $A$ 表示为一个简单的三对角矩阵 $T$ 加上一个针对角点元素的低秩校正 $C$。\n$A = T + C$，其中 $T$ 与 $A$ 相同，但角点元素 $A_{0,N-1}$ 和 $A_{N-1,0}$ 被设为零。校正矩阵 $C$ 是一个秩为2的更新：$C = \\alpha \\mathbf{e}_0 \\mathbf{e}_{N-1}^T + \\alpha \\mathbf{e}_{N-1} \\mathbf{e}_0^T$，其中 $\\mathbf{e}_j$ 是第 $j$ 个标准基向量。我们将其写为 $C = UV^T$，其中 $U=[\\alpha \\mathbf{e}_0, \\alpha \\mathbf{e}_{N-1}]$ 且 $V=[\\mathbf{e}_{N-1}, \\mathbf{e}_0]$。\n为了求解 $A\\mathbf{x} = \\mathbf{b}$，即 $(T+UV^T)\\mathbf{x}=\\mathbf{b}$，解由以下公式给出：\n$$\n\\mathbf{x} = T^{-1}\\mathbf{b} - T^{-1}U (I + V^T T^{-1} U)^{-1} V^T T^{-1}\\mathbf{b}\n$$\n该公式按以下算法实现：\n1.  求解 $T\\mathbf{y} = \\mathbf{f}$ 得到 $\\mathbf{y}$。这是一个标准的三对角系统，可以用托马斯算法以 $\\mathcal{O}(N)$ 的运算量高效求解。\n2.  求解 $T Z=U$ 得到 $N \\times 2$ 矩阵 $Z$。这需要额外两次三对角求解，对应 $U$ 的每一列。\n3.  计算 $2 \\times 2$ 矩阵 $M = I + V^T Z$。\n4.  计算 $2 \\times 1$ 向量 $\\mathbf{w} = V^T \\mathbf{y}$。\n5.  求解小型 $2 \\times 2$ 系统 $M\\mathbf{q} = \\mathbf{w}$ 得到 $\\mathbf{q}$。\n6.  最终解为 $\\mathbf{u}' = \\mathbf{y} - Z\\mathbf{q}$。\n此过程需要调用三次三对角求解器，与所提供的成本模型一致。\n\n### 4. 误差计算\n数值解的精度使用离散相对 $L^2$ 误差来评估，其定义为：\n$$\nE_2(\\mathbf{v},\\mathbf{w}) = \\frac{\\|\\mathbf{v} - \\mathbf{w}\\|_2}{\\|\\mathbf{w}\\|_2}\n$$\n这里，$\\mathbf{v}$ 是数值计算出的导数向量（来自FFT或直接方法），$\\mathbf{w}$ 是精确导数值的向量，$\\|\\cdot\\|_2$ 是标准的欧几里得范数。该度量衡量误差向量的大小相对于精确解向量大小的比例。\n\n### 5. 成本模型\n两种方法的计算成本使用提供的公式估算，这些公式反映了核心算法的渐近复杂度。\n- **基于FFT的方法**：主要由两次长度为 $N$ 的FFT（正向和逆向）主导，每次成本约为 $5 N \\log_2 N$ 次运算。包括 $\\mathcal{O}(N)$ 的向量运算，总成本为 $\\mathrm{cost}_{\\mathrm{FFT}}(N) = 10 N \\log_2 N + 3 N$。\n- **直接带状方法**：主要由三次三对角求解主导，每次使用托马斯算法的成本约为 $8N$ 次运算。包括用于RHS和最终向量更新的 $\\mathcal{O}(N)$ 次运算，总成本为 $\\mathrm{cost}_{\\mathrm{banded}}(N) = 3 \\cdot 8 N + 3 N = 27 N$。\n对每个测试用例计算成本比 $\\rho(N) = \\mathrm{cost}_{\\mathrm{FFT}}(N) / \\mathrm{cost}_{\\mathrm{banded}}(N)$，以比较它们的理论效率。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef thomas_solver(a, b, c, d):\n    \"\"\"\n    Solves a tridiagonal system of equations Ax=d, where A is defined by its diagonals a, b, c.\n    This function implements the Thomas algorithm.\n\n    Args:\n        a (np.ndarray): The sub-diagonal of A (length n-1).\n        b (np.ndarray): The main diagonal of A (length n).\n        c (np.ndarray): The super-diagonal of A (length n-1).\n        d (np.ndarray): The right-hand side vector (length n).\n\n    Returns:\n        np.ndarray: The solution vector x.\n    \"\"\"\n    n = len(d)\n    if n == 0:\n        return np.array([])\n    if n == 1:\n        return np.array([d[0] / b[0]])\n\n    c_prime = np.zeros(n - 1, dtype=float)\n    d_prime = np.zeros(n, dtype=float)\n    \n    # Forward elimination step\n    c_prime[0] = c[0] / b[0]\n    d_prime[0] = d[0] / b[0]\n    for i in range(1, n - 1):\n        m = b[i] - a[i - 1] * c_prime[i - 1]\n        c_prime[i] = c[i] / m\n        d_prime[i] = (d[i] - a[i - 1] * d_prime[i - 1]) / m\n\n    m_last = b[n - 1] - a[n - 2] * c_prime[n - 2]\n    d_prime[n - 1] = (d[n - 1] - a[n - 2] * d_prime[n - 2]) / m_last\n    \n    # Backward substitution step\n    x = np.zeros(n, dtype=float)\n    x[n - 1] = d_prime[n - 1]\n    for i in range(n - 2, -1, -1):\n        x[i] = d_prime[i] - c_prime[i] * x[i + 1]\n        \n    return x\n\ndef perform_calculation(N, k):\n    \"\"\"\n    Performs all calculations for a given test case specified by N and k,\n    returning a list with the FFT error, banded solver error, and cost ratio.\n    \"\"\"\n    # 1. Setup constants, grid, test function, and its exact derivative\n    L = 2.0 * np.pi\n    h = L / N\n    x = np.arange(N, dtype=float) * h\n    alpha = 1.0 / 4.0\n    b1 = 3.0 / 4.0\n\n    u = np.sin(k * x)\n    u_prime_exact = k * np.cos(k * x)\n\n    # 2. FFT-based solver\n    u_hat = np.fft.fft(u)\n    # The frequencies for the DFT. Note that fftfreq gives frequencies in cycles/sample.\n    # We need angular frequency on the grid, which is 2*pi*f.\n    freq = np.fft.fftfreq(N)\n    theta = 2.0 * np.pi * freq\n    \n    # Denominator 2 + cos(theta) is always >= 1.0, so no division by zero risk.\n    # The effective wavenumber (kappa_eff) is kappa*h.\n    kappa_eff = (3.0 * np.sin(theta)) / (2.0 + np.cos(theta))\n    # The spectral operator is i * kappa_eff / h\n    spectral_op = 1j * kappa_eff / h\n    \n    # In our derivation, kappa was defined as the full multiplier for the spectral derivative,\n    # i.e., u'_hat = i*kappa*u_hat where kappa is dimensional.\n    # kappa = (1/h) * kappa_eff\n    kappa = (1.0 / h) * kappa_eff\n\n    u_prime_hat_fft = 1j * kappa * u_hat\n    u_prime_fft = np.real(np.fft.ifft(u_prime_hat_fft))\n\n    # 3. Direct banded solver (Cyclic Thomas via Sherman-Morrison-Woodbury)\n    # Right-hand side vector f\n    f = (b1 / h) * (np.roll(u, -1) - np.roll(u, 1))\n    \n    # Tridiagonal matrix T diagonals\n    a_diag = alpha * np.ones(N - 1)\n    b_diag = np.ones(N)\n    c_diag = alpha * np.ones(N - 1)\n\n    # The circulant matrix is A = T + U V^T\n    # with U = [alpha*e_0, alpha*e_{N-1}], V = [e_{N-1}, e_0]\n    u_sm1 = np.zeros(N); u_sm1[0] = alpha\n    u_sm2 = np.zeros(N); u_sm2[-1] = alpha\n\n    # Three tridiagonal solves\n    y = thomas_solver(a_diag, b_diag, c_diag, f)\n    z1 = thomas_solver(a_diag, b_diag, c_diag, u_sm1)\n    z2 = thomas_solver(a_diag, b_diag, c_diag, u_sm2)\n    \n    # Form and solve the 2x2 system Mq = w for the correction\n    M = np.array([\n        [1.0 + z1[-1], z2[-1]],\n        [z1[0], 1.0 + z2[0]]\n    ])\n    w = np.array([y[-1], y[0]])\n    q = np.linalg.solve(M, w)\n    \n    # Final solution is y corrected by the SMW term: x = y - Zq\n    u_prime_banded = y - q[0] * z1 - q[1] * z2\n\n    # 4. Error and Cost Calculation\n    norm_exact = np.linalg.norm(u_prime_exact)\n    \n    # Handle cases where norm_exact is zero (e.g., k=0)\n    if norm_exact  1e-14:\n        err_fft = np.linalg.norm(u_prime_fft - u_prime_exact)\n        err_banded = np.linalg.norm(u_prime_banded - u_prime_exact)\n    else:\n        err_fft = np.linalg.norm(u_prime_fft - u_prime_exact) / norm_exact\n        err_banded = np.linalg.norm(u_prime_banded - u_prime_exact) / norm_exact\n\n    rho = (10.0 * N * math.log2(N) + 3.0 * N) / (27.0 * N)\n    \n    return [err_fft, err_banded, rho]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (64, 4),   # Case A\n        (128, 1),  # Case B\n        (96, 32),  # Case C\n        (63, 31),  # Case D\n    ]\n\n    results = []\n    for N, k in test_cases:\n        result_triple = perform_calculation(N, k)\n        results.append(result_triple)\n\n    # Format the final output string as specified.\n    result_strings = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}