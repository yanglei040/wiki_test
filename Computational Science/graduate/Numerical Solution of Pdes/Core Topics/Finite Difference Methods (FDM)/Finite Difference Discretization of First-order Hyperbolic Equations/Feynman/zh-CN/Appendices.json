{
    "hands_on_practices": [
        {
            "introduction": "要真正理解一个数值格式，我们必须超越其形式上的精度阶数。更深入的分析揭示了格式如何处理解的不同波分量。本练习将介绍傅里叶分析，它是一个强大的诊断工具，可将格式的误差分解为数值耗散（振幅衰减）和数值色散（相位误差）。通过推导和比较像迎风格式和 Lax-Wendroff 格式这类基本格式的放大因子，您将对其内在行为获得核心理解，而这些行为决定了它们在模拟中的表现。",
            "id": "3393016",
            "problem": "考虑常系数线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中 $u(x,t)$ 是一个光滑标量场，平流速度 $a  0$ 为正。该方程定义在一个无限均匀网格上，网格间距为 $h$，时间步长为 $\\Delta t$。令 Courant–Friedrichs–Lewy (CFL) 数定义为 $\\lambda = a\\,\\Delta t/h$。对单频分量 $u^{n}_{j} = \\hat{u}\\,\\exp(i\\,j\\,\\kappa)\\,\\exp(i\\,n\\,\\varphi)$ 进行傅里叶模态分析，其中 $\\kappa = k\\,h$ 是无量纲波数，$k$ 是物理波数，$j,n \\in \\mathbb{Z}$ 分别是空间和时间索引。\n\n1. 对于 $a  0$ 的前向欧拉、一阶迎风有限差分格式，\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\lambda\\left(u^{n}_{j} - u^{n}_{j-1}\\right),\n$$\n推导离散放大因子 $G_{\\text{up}}(\\kappa)$，并确定该格式是否引入离散色散、离散耗散，或两者兼有。用 $G_{\\text{up}}(\\kappa)$ 的辐角表示离散相位，并用 $\\varphi/\\Delta t$ 和 $k$ 表示数值相速度。\n\n2. 对于线性平流的经典 Lax–Wendroff 格式，\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\frac{\\lambda}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right) + \\frac{\\lambda^{2}}{2}\\left(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\right),\n$$\n推导离散放大因子 $G_{\\text{LW}}(\\kappa)$ 及其模。确定使格式对所有 $\\kappa \\in [0,\\pi]$ 都是无耗散的关于 $\\lambda$ 的条件，并用 $G_{\\text{LW}}(\\kappa)$ 的辐角和 $k$ 表示数值相速度。\n\n3. 考虑以下用于近似 $u_{x}$ 的单参数族三点、三对角紧致迎风有限差分格式，该格式以半离散形式（使用精确时间积分的线方法）给出，因此其色散特性仅由空间微分控制：\n$$\n\\alpha\\,u'_{j-1} + u'_{j} = \\frac{1}{h}\\left(c_{-1}\\,u_{j-1} + c_{0}\\,u_{j} + c_{1}\\,u_{j+1}\\right),\n$$\n其中 $\\alpha \\ge 0$ 是一个自由的迎风偏置参数，$c_{-1},c_{0},c_{1}$ 是待定常系数，其值由相容性以及对 $a  0$ 的迎风平流的偏置确定。使用傅里叶模态分析，推导通过 $u'_{j} \\approx i\\,\\tilde{k}(\\kappa)\\,u_{j}$ 定义的半离散修正波数 $\\tilde{k}(\\kappa)$，并构造其小 $\\kappa$ 展开式 $\\tilde{k}(\\kappa)\\,h = \\kappa + \\beta_{3}(\\alpha)\\,\\kappa^{3} + \\mathcal{O}(\\kappa^{5})$。施加形式三阶精度和迎风偏置所需的条件，然后将目标频带 $\\kappa \\in [0,\\kappa_{b}]$（其中 $0  \\kappa_{b}  \\pi$ 为固定值）上的主阶归一化相速度误差定义为积分\n$$\n\\mathcal{E}(\\alpha) = \\int_{0}^{\\kappa_{b}}\\left(\\frac{\\tilde{k}(\\kappa)}{k} - 1\\right)^{2}\\,d\\kappa,\n$$\n其中 $k = \\kappa/h$。使用关于 $\\kappa$ 的主阶渐近式，以闭合形式最小化在 $\\alpha \\ge 0$ 上的 $\\mathcal{E}(\\alpha)$。你的最终答案必须是最小化该主阶度量的 $\\alpha$ 的单个最优值，表示为一个精确数。无需四舍五入，最终答案中不应包含任何单位。",
            "solution": "该问题陈述是偏微分方程数值分析中的一个标准练习，特别关注线性平流方程的有限差分方法。它具有科学依据、是适定的、客观的，并包含求解所需的所有信息。该问题被认为是有效的。\n\n第1部分：一阶迎风格式\n\n对于 $a  0$ 的一阶迎风格式由下式给出\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\lambda\\left(u^{n}_{j} - u^{n}_{j-1}\\right)\n$$\n其中 $\\lambda = a\\,\\Delta t/h$ 是CFL数。为了进行傅里叶分析，我们代入一个单模 $u^{n}_{j} = G^{n}(\\kappa)\\,\\exp(i\\,j\\,\\kappa)$，其中 $G(\\kappa)$ 是放大因子，$\\kappa=kh$ 是无量纲波数。\n$$\nG^{n+1}\\,\\exp(i\\,j\\,\\kappa) = G^{n}\\,\\exp(i\\,j\\,\\kappa) - \\lambda\\left(G^{n}\\,\\exp(i\\,j\\,\\kappa) - G^{n}\\,\\exp(i\\,(j-1)\\,\\kappa)\\right)\n$$\n两边同除以 $G^{n}\\,\\exp(i\\,j\\,\\kappa)$，我们得到放大因子 $G_{\\text{up}}(\\kappa)$：\n$$\nG_{\\text{up}}(\\kappa) = 1 - \\lambda(1 - \\exp(-i\\,\\kappa)) = 1 - \\lambda + \\lambda e^{-i\\kappa} = 1 - \\lambda + \\lambda(\\cos(\\kappa) - i\\sin(\\kappa))\n$$\n因此：\n$$\nG_{\\text{up}}(\\kappa) = (1 - \\lambda + \\lambda\\,\\cos(\\kappa)) - i\\,\\lambda\\,\\sin(\\kappa)\n$$\n为了分析耗散，我们计算 $G_{\\text{up}}(\\kappa)$ 的模：\n$$\n|G_{\\text{up}}(\\kappa)|^2 = (1 - \\lambda + \\lambda\\,\\cos\\kappa)^2 + (-\\lambda\\,\\sin\\kappa)^2\n$$\n$$\n|G_{\\text{up}}(\\kappa)|^2 = (1-\\lambda)^2 + 2\\lambda(1-\\lambda)\\cos\\kappa + \\lambda^2\\cos^2\\kappa + \\lambda^2\\sin^2\\kappa\n$$\n$$\n|G_{\\text{up}}(\\kappa)|^2 = 1 - 2\\lambda + \\lambda^2 + 2\\lambda\\cos\\kappa - 2\\lambda^2\\cos\\kappa + \\lambda^2 = 1 - 2\\lambda(1-\\cos\\kappa) + 2\\lambda^2(1-\\cos\\kappa)\n$$\n$$\n|G_{\\text{up}}(\\kappa)|^2 = 1 - 2\\lambda(1-\\lambda)(1-\\cos\\kappa)\n$$\n使用半角恒等式 $1-\\cos\\kappa = 2\\sin^2(\\kappa/2)$，我们得到\n$$\n|G_{\\text{up}}(\\kappa)|^2 = 1 - 4\\lambda(1-\\lambda)\\sin^2(\\frac{\\kappa}{2})\n$$\n为使格式稳定，我们需要 $|G_{\\text{up}}(\\kappa)| \\le 1$，这意味着 $4\\lambda(1-\\lambda)\\sin^2(\\kappa/2) \\ge 0$。由于 $\\lambda  0$ 且 $\\sin^2(\\kappa/2) \\ge 0$，这要求 $1-\\lambda \\ge 0$，因此稳定性条件是 $0  \\lambda \\le 1$。如果 $0  \\lambda  1$，那么对于任何 $\\kappa \\ne 0, 2\\pi, \\dots$，都有 $|G_{\\text{up}}(\\kappa)|  1$。对于非零波数，振幅的这种减小表明存在数值（或人为）耗散。\n\n为了分析色散，我们考察 $G_{\\text{up}}(\\kappa)$ 的相位。每个时间步长的数值相移是 $\\varphi = \\arg(G_{\\text{up}}(\\kappa))$。\n$$\n\\varphi = \\arg(G_{\\text{up}}) = \\arctan\\left(\\frac{-\\lambda\\,\\sin(\\kappa)}{1 - \\lambda + \\lambda\\,\\cos(\\kappa)}\\right)\n$$\n精确解 $u(x,t) = f(x-at)$ 有一个相应的放大因子 $G_{\\text{exact}} = \\exp(-i\\,a\\,k\\,\\Delta t) = \\exp(-i\\,\\lambda\\,\\kappa)$。精确相移是 $-\\lambda\\,\\kappa$。数值相速度定义为 $c_{\\text{num}} = -\\varphi / (k\\,\\Delta t)$。代入 $k=\\kappa/h$ 和 $\\Delta t = \\lambda h/a$：\n$$\nc_{\\text{num}} = -\\frac{\\varphi}{(\\kappa/h)(\\lambda h/a)} = -\\frac{a\\,\\varphi}{\\lambda\\,\\kappa}\n$$\n由于 $\\varphi$ 不是 $\\kappa$ 的线性函数（具体来说，除非在 $\\kappa \\to 0$ 的极限情况下，否则 $\\varphi \\ne -\\lambda\\kappa$），数值相速度 $c_{\\text{num}}$ 对于所有波数 $k$ 来说都不是恒定的。相速度对波数的这种依赖性就是数值色散的定义。因此，一阶迎风格式同时引入了离散耗散和离散色散。\n\n第2部分：Lax-Wendroff 格式\n\nLax-Wendroff 格式由下式给出\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\frac{\\lambda}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right) + \\frac{\\lambda^{2}}{2}\\left(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\right)\n$$\n代入 $u^n_j = G^n(\\kappa)\\exp(i j \\kappa)$ 可得：\n$$\nG_{\\text{LW}}(\\kappa) = 1 - \\frac{\\lambda}{2}(\\exp(i\\kappa) - \\exp(-i\\kappa)) + \\frac{\\lambda^2}{2}(\\exp(i\\kappa) - 2 + \\exp(-i\\kappa))\n$$\n使用欧拉恒等式 $2i\\sin\\kappa = e^{i\\kappa}-e^{-i\\kappa}$ 和 $2\\cos\\kappa = e^{i\\kappa}+e^{-i\\kappa}$：\n$$\nG_{\\text{LW}}(\\kappa) = 1 - i\\lambda\\sin(\\kappa) + \\frac{\\lambda^2}{2}(2\\cos(\\kappa) - 2) = 1 - \\lambda^2(1-\\cos(\\kappa)) - i\\lambda\\sin(\\kappa)\n$$\n放大因子的模的平方是：\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = \\left(1 - \\lambda^2(1-\\cos\\kappa)\\right)^2 + (-\\lambda\\sin\\kappa)^2\n$$\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = 1 - 2\\lambda^2(1-\\cos\\kappa) + \\lambda^4(1-\\cos\\kappa)^2 + \\lambda^2\\sin^2\\kappa\n$$\n使用 $\\sin^2\\kappa = 1-\\cos^2\\kappa = (1-\\cos\\kappa)(1+\\cos\\kappa)$：\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = 1 - 2\\lambda^2(1-\\cos\\kappa) + \\lambda^4(1-\\cos\\kappa)^2 + \\lambda^2(1-\\cos\\kappa)(1+\\cos\\kappa)\n$$\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = 1 + (1-\\cos\\kappa)\\left[-2\\lambda^2 + \\lambda^4(1-\\cos\\kappa) + \\lambda^2(1+\\cos\\kappa)\\right]\n$$\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = 1 + (1-\\cos\\kappa)\\left[-\\lambda^2 + \\lambda^2\\cos\\kappa + \\lambda^4 - \\lambda^4\\cos\\kappa\\right]\n$$\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = 1 - (1-\\cos\\kappa)^2(\\lambda^2 - \\lambda^4) = 1 - \\lambda^2(1-\\lambda^2)(1-\\cos\\kappa)^2\n$$\n如果对所有 $\\kappa$ 都有 $|G_{\\text{LW}}(\\kappa)| = 1$，则该格式是无耗散的。这发生在减去项对所有 $\\kappa$ 都为零时。由于 $(1-\\cos\\kappa)^2$ 不恒等于零，这要求 $\\lambda^2(1-\\lambda^2)=0$。给定 $\\lambda>0$，唯一的非平凡解是 $1-\\lambda^2=0$，这意味着 $\\lambda=1$。Lax-Wendroff 格式的稳定性条件是 $0  \\lambda \\le 1$。该格式仅在稳定性边界 $\\lambda=1$ 处是无耗散的。\n\n数值相速度为 $c_{\\text{num}} = -\\arg(G_{\\text{LW}}) / (k\\,\\Delta t)$，其中\n$$\n\\arg(G_{\\text{LW}}) = \\arctan\\left(\\frac{-\\lambda\\sin(\\kappa)}{1-\\lambda^2(1-\\cos(\\kappa))}\\right)\n$$\n\n第3部分：紧致迎风格式\n\n半离散紧致格式由下式给出\n$$\n\\alpha\\,u'_{j-1} + u'_{j} = \\frac{1}{h}\\left(c_{-1}\\,u_{j-1} + c_{0}\\,u_{j} + c_{1}\\,u_{j+1}\\right)\n$$\n为了满足与一阶微分算子尽可能高阶的相容性，我们对所有项在点 $j$ 附近进行泰勒级数展开。匹配 $u$ 的各阶导数项，得到关于系数 $c_{-1}, c_0, c_1$ 的方程组：\n1. $u_j$的系数: $c_{-1} + c_0 + c_1 = 0$\n2. $u'_j$的系数: $c_1 - c_{-1} = 1+\\alpha$\n3. $u''_j$的系数: $\\frac{h}{2}(c_1+c_{-1}) = -\\alpha h \\implies c_1+c_{-1} = -2\\alpha$\n解此方程组可得系数作为 $\\alpha$ 的函数：\n$c_1 = \\frac{1-\\alpha}{2}$， $c_{-1} = -\\frac{1+3\\alpha}{2}$， $c_0 = 2\\alpha$。\n\n将 $u_j = \\hat{u}\\exp(ij\\kappa)$ 和 $u'_j = i\\tilde{k}u_j$ 代入格式，可求得修正波数 $\\tilde{k}(\\kappa)$：\n$$\n\\alpha (i\\tilde{k}) e^{i(j-1)\\kappa} + (i\\tilde{k}) e^{ij\\kappa} = \\frac{1}{h}\\left(c_{-1}e^{i(j-1)\\kappa} + c_0 e^{ij\\kappa} + c_1 e^{i(j+1)\\kappa}\\right)\n$$\n两边同除以 $i e^{ij\\kappa}$ 并重新整理可得：\n$$\n\\tilde{k}(\\kappa) h (\\alpha e^{-i\\kappa} + 1) = \\frac{1}{i}(c_{-1}e^{-i\\kappa} + c_0 + c_1 e^{i\\kappa})\n$$\n代入上面求得的系数表达式：\n$$\n\\text{分子} = \\frac{1}{i}\\left(2\\alpha - \\frac{1+3\\alpha}{2}e^{-i\\kappa} + \\frac{1-\\alpha}{2}e^{i\\kappa}\\right) = \\frac{1}{i}\\left(2\\alpha(1-\\cos\\kappa) + i(1+\\alpha)\\sin\\kappa\\right)\n$$\n$$\n\\text{分母} = \\alpha e^{-i\\kappa} + 1 = 1 + \\alpha\\cos\\kappa - i\\alpha\\sin\\kappa\n$$\n将分子和分母同乘以分母的共轭 $1+\\alpha\\cos\\kappa+i\\alpha\\sin\\kappa$ 是一种方法，但对我们的目标而言，进行小 $\\kappa$ 展开更为直接。\n对 $\\tilde{k}(\\kappa)h$ 的表达式进行小 $\\kappa$ 泰勒展开可得：\n$$\n\\tilde{k}(\\kappa)h = \\kappa + \\left(\\frac{2\\alpha-1}{6(1+\\alpha)}\\right)\\kappa^3 + \\mathcal{O}(\\kappa^5)\n$$\n这具有问题中指定的形式 $\\tilde{k}(\\kappa)h = \\kappa + \\beta_3(\\alpha)\\kappa^3 + \\mathcal{O}(\\kappa^5)$，其中\n$$\n\\beta_3(\\alpha) = \\frac{2\\alpha-1}{6(1+\\alpha)}\n$$\n问题要求在 $\\alpha \\ge 0$ 的范围内，通过最小化误差积分 $\\mathcal{E}(\\alpha)$ 来寻找最优的 $\\alpha$。我们将使用上面推导出的主误差项系数 $\\beta_3(\\alpha)$ 来近似该积分。\n\n归一化相速度误差为 $\\frac{\\tilde{k}(\\kappa)}{k} - 1 = \\frac{\\tilde{k}(\\kappa)h}{\\kappa} - 1$。使用展开式中的主阶项：\n$$\n\\frac{\\tilde{k}(\\kappa)}{k} - 1 = \\beta_3(\\alpha)\\kappa^2 + \\mathcal{O}(\\kappa^4)\n$$\n误差积分 $\\mathcal{E}(\\alpha)$ 使用此主阶项近似为：\n$$\n\\mathcal{E}(\\alpha) = \\int_{0}^{\\kappa_{b}}\\left(\\frac{\\tilde{k}(\\kappa)}{k} - 1\\right)^{2}\\,d\\kappa \\approx \\int_{0}^{\\kappa_{b}} (\\beta_3(\\alpha)\\kappa^2)^2 d\\kappa\n$$\n$$\n\\mathcal{E}(\\alpha) \\approx (\\beta_3(\\alpha))^2 \\int_{0}^{\\kappa_{b}} \\kappa^4 d\\kappa = (\\beta_3(\\alpha))^2 \\frac{\\kappa_b^5}{5}\n$$\n为了在固定的 $\\kappa_b  0$ 下最小化 $\\mathcal{E}(\\alpha)$，我们必须在定义域 $\\alpha \\ge 0$ 上最小化 $|\\beta_3(\\alpha)|$（或等价地，其平方）。$(\\beta_3(\\alpha))^2$ 的最小值出现在其分子为零时，即 $2\\alpha-1 = 0$，解得 $\\alpha = 1/2$。这个值在允许的范围 $\\alpha \\ge 0$ 内。当 $\\alpha=1/2$ 时，主误差系数 $\\beta_3(1/2)=0$，这在此近似下产生了可能的最小误差 $\\mathcal{E}(1/2)=0$。这对应于将格式的精度阶数从二阶提升到四阶的情况。因此，该参数的最优值是 $1/2$。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "虽然线性分析富有洞察力，但许多现实世界中的双曲问题是非线性的，并且能够形成激波。对于这些守恒律方程，数值格式最关键的特性不仅仅是其精度，还在于其能否捕捉到以正确物理速度传播的激波，该速度由 Rankine-Hugoniot 条件决定。本动手编程练习将展示在应用于 Burgers 方程时，守恒型离散与非守恒型离散之间的显著差异。您将亲眼见证为何只有写成守恒形式的格式才能正确逼近弱解，并捕捉激波传播的物理现象。",
            "id": "3393018",
            "problem": "考虑被称为无粘 Burgers 方程的标量守恒律，$u_t + \\tfrac{1}{2}(u^2)_x = 0$，该方程建立在一维空间域上，具有分段常数的黎曼初值数据和常数狄利克雷边界数据。本问题的基础是双曲守恒律理论、弱形式和朗金-雨贡纽跳跃条件，以及基于库朗-弗里德里希斯-列维 (CFL) 数的稳定性考量。您将比较两种显式一阶有限差分离散格式：一种是使用数值通量的守恒格式，另一种是直接离散平流形式 $u_t + u u_x = 0$ 的非守恒格式。\n\n设置如下。设空间域为 $[-1,1]$，离散为 $N$ 个宽度为 $\\Delta x = \\tfrac{2}{N}$ 的均匀单元，单元中心为 $x_i = -1 + (i+\\tfrac{1}{2})\\Delta x$，其中 $i = 0,\\dots,N-1$。定义分段常数黎曼初值数据 $u(x,0) = u_L$ (对于 $x  0$) 和 $u(x,0) = u_R$ (对于 $x  0$)，并施加常数狄利克雷边界条件 $u(-1,t) = u_L$ 和 $u(1,t) = u_R$ (对于所有 $t \\ge 0$)。假设 $u_L  u_R$，以便形成一个以明确定义的速度传播的激波。精确的激波速度 $s_{\\mathrm{RH}}$ 由标量守恒律 $u_t + f(u)_x = 0$ 的朗金-雨贡纽跳跃条件确定，其中 $f(u) = \\tfrac{1}{2}u^2$。\n\n第一种离散格式是使用相容数值通量的守恒有限体积/有限差分方法。在界面 $i+\\tfrac{1}{2}$ 处采用局部 Lax–Friedrichs (也称作 Rusanov) 数值通量：\n$$\nF_{i+\\frac{1}{2}}^n = \\frac{1}{2}\\left(f(u_i^n) + f(u_{i+1}^n)\\right) - \\frac{1}{2}\\alpha_{i+\\frac{1}{2}}^n\\left(u_{i+1}^n - u_i^n\\right),\n$$\n其中 $f(u) = \\tfrac{1}{2}u^2$ 且 $\\alpha_{i+\\frac{1}{2}}^n = \\max\\left(|u_i^n|,|u_{i+1}^n|\\right)$。更新公式为\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right),\n$$\n在 $x=-1$ 和 $x=1$ 处的鬼点/界面状态分别取为 $u_L$ 和 $u_R$，以定义 $F_{-\\frac{1}{2}}^n$ 和 $F_{N-\\frac{1}{2}}^n$。选择时间步长以满足基于库朗-弗里德里希斯-列维 (CFL) 数的稳定性约束，具体为\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|},\n$$\n其中 $0  \\mathrm{CFL}  1$。\n\n第二种离散格式处理方程的非守恒平流形式 $u_t + u u_x = 0$，并使用基于局部速度 $u_i^n$ 的逐点迎风离散：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(\\max(u_i^n,0)\\left(u_i^n - u_{i-1}^n\\right) + \\min(u_i^n,0)\\left(u_{i+1}^n - u_i^n\\right)\\right),\n$$\n其中边界处的鬼点邻居值从 $u_L$ 和 $u_R$ 一致地赋予，并且在每次时间更新后，将边界单元的值重新设置为 $u_L$ 和 $u_R$ 以维持狄利克雷条件。为保证稳定性，使用相同的基于 CFL 的时间步长选择：\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|}.\n$$\n\n为了数值化地量化激波速度，定义中点状态 $u_{\\mathrm{mid}} = \\tfrac{1}{2}(u_L + u_R)$。在给定的最终时间 $T$，通过定位离散剖面相对于 $u_{\\mathrm{mid}}$ 变号的第一个索引 $i$（即 $(u_i^n - u_{\\mathrm{mid}})(u_{i+1}^n - u_{\\mathrm{mid}}) \\le 0$），然后在线性插值单元界面内来估计激波位置 $x_{\\mathrm{shock}}(T)$：\n$$\nx_{\\mathrm{shock}}(T) \\approx x_i + \\Delta x \\cdot \\frac{u_{\\mathrm{mid}} - u_i^n}{u_{i+1}^n - u_i^n}.\n$$\n根据构造，激波初始位于 $x=0$，因此数值激波速度近似为 $s_{\\mathrm{num}} \\approx \\tfrac{x_{\\mathrm{shock}}(T)}{T}$。计算每种格式的速度误差为\n$$\n\\varepsilon = \\left|s_{\\mathrm{num}} - s_{\\mathrm{RH}}\\right|,\n$$\n其中 $s_{\\mathrm{RH}}$ 是对于 $f(u) = \\tfrac{1}{2}u^2$ 且从 $u_L$ 跳跃到 $u_R$ 时的朗金-雨贡纽速度。\n\n在相同的网格和参数上实现这两种格式，并比较在相同最终时间的速度误差。使用以下测试套件，其设计旨在确保覆盖典型的激波情况、静止激波和中等强度激波：\n1. 测试用例 1：$u_L = 2.0$, $u_R = 0.0$, $T = 0.30$, $N = 800$, $\\mathrm{CFL} = 0.45$。\n2. 测试用例 2：$u_L = 1.0$, $u_R = -1.0$, $T = 0.30$, $N = 800$, $\\mathrm{CFL} = 0.45$。\n3. 测试用例 3：$u_L = 1.0$, $u_R = 0.5$, $T = 0.20$, $N = 800$, $\\mathrm{CFL} = 0.45$。\n\n对于每个测试用例，计算速度误差对 $[\\varepsilon_{\\mathrm{cons}}, \\varepsilon_{\\mathrm{noncons}}]$，其中 $\\varepsilon_{\\mathrm{cons}}$ 是守恒格式的误差，$\\varepsilon_{\\mathrm{noncons}}$ 是非守恒格式的误差。您的程序应生成单行输出，其中包含三对结果，以逗号分隔的列表形式包含在方括号中，每对结果本身也包含在方括号中，并按测试套件的顺序列出（例如，格式为 $[[e_{1,\\mathrm{cons}},e_{1,\\mathrm{noncons}}],[e_{2,\\mathrm{cons}},e_{2,\\mathrm{noncons}}],[e_{3,\\mathrm{cons}},e_{3,\\mathrm{noncons}}]]$）。此问题中所有量均为纯数学量，因此不需要物理单位，输出中也不出现角度或百分比。该任务具有内在的可测试性，因为输出是为定义的测试套件生成的一列浮点数值。",
            "solution": "用户提供了一个问题，要求实现并比较两种用于无粘 Burgers 方程 $u_t + \\frac{1}{2}(u^2)_x = 0$ 的有限差分格式。目标是比较守恒格式与非守恒格式在激波速度预测方面的准确性。\n\n### 问题验证\n\n此问题经过了严格的验证过程。\n\n**步骤 1：提取的已知条件**\n-   **控制方程（守恒形式）：** $u_t + \\frac{1}{2}(u^2)_x = 0$，通量为 $f(u) = \\frac{1}{2}u^2$。\n-   **控制方程（非守恒形式）：** $u_t + u u_x = 0$。\n-   **域和网格：** 空间域 $[-1,1]$，离散为 $N$ 个宽度为 $\\Delta x = 2/N$ 的均匀单元。单元中心 $x_i = -1 + (i+\\frac{1}{2})\\Delta x$，其中 $i=0,\\dots,N-1$。\n-   **初始/边界数据：** 黎曼初值数据 $u(x,0) = u_L$ (对于 $x0$) 和 $u(x,0) = u_R$ (对于 $x>0$)。常数狄利克雷边界条件 $u(-1,t) = u_L$ 和 $u(1,t) = u_R$。条件 $u_L > u_R$ 确保激波的形成。\n-   **精确激波速度：** 朗金-雨贡纽条件决定了激波速度 $s_{\\mathrm{RH}}$。\n-   **格式 1（守恒）：** 有限体积格式 $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n)$，使用局部 Lax–Friedrichs (Rusanov) 数值通量：$F_{i+\\frac{1}{2}}^n = \\frac{1}{2}(f(u_i^n) + f(u_{i+1}^n)) - \\frac{1}{2}\\alpha_{i+\\frac{1}{2}}^n(u_{i+1}^n - u_i^n)$，其中 $\\alpha_{i+\\frac{1}{2}}^n = \\max(|u_i^n|,|u_{i+1}^n|)$。边界通量 $F_{-\\frac{1}{2}}^n$ 和 $F_{N-\\frac{1}{2}}^n$ 使用鬼点状态 $u_L$ 和 $u_R$ 定义。\n-   **格式 2（非守恒）：** 平流形式的迎风离散：$u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}(\\max(u_i^n,0)(u_i^n - u_{i-1}^n) + \\min(u_i^n,0)(u_{i+1}^n - u_i^n))$。边界处理涉及使用 $u_L$ 和 $u_R$ 作为鬼点单元值，并在每个时间步后重新施加 $u_0^n=u_L, u_{N-1}^n=u_R$。\n-   **时间步进：** 两种格式均为 $\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|}$。\n-   **分析：** 数值激波速度 $s_{\\mathrm{num}} = x_{\\mathrm{shock}}(T)/T$，其中 $x_{\\mathrm{shock}}(T)$ 是通过在解穿过 $u_{\\mathrm{mid}} = \\frac{1}{2}(u_L+u_R)$ 的点进行线性插值找到的。速度误差为 $\\varepsilon = |s_{\\mathrm{num}} - s_{\\mathrm{RH}}|$。\n-   **测试套件：**\n    1.  $u_L = 2.0, u_R = 0.0, T = 0.30, N = 800, \\mathrm{CFL} = 0.45$。\n    2.  $u_L = 1.0, u_R = -1.0, T = 0.30, N = 800, \\mathrm{CFL} = 0.45$。\n    3.  $u_L = 1.0, u_R = 0.5, T = 0.20, N = 800, \\mathrm{CFL} = 0.45$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学基础：** 该问题牢固地建立在双曲守恒律的数学理论和标准数值方法（有限体积、有限差分、迎风格式、Lax-Friedrichs 通量）之上。无粘 Burgers 方程是这些现象的典范模型。所有方面在科学和数学上都是合理的。\n-   **适定性：** 该问题是适定的。对于 $u_L > u_R$ 的 Burgers 方程的初边值问题，存在一个由单个激波组成的唯一弱解。数值格式是标准的，其稳定性通过 CFL 条件处理。分析过程有明确定义。\n-   **客观性：** 问题陈述是客观、精确且无歧义的。它描述了数学和数值设置，没有使用主观性语言。\n-   **完整性和一致性：** 该问题是自洽的。提供了所有必要的方程、参数和程序。关于边界条件的说明虽然具体，但清晰明了，可以无歧义地实现。\n-   **可行性：** 参数对于数值模拟是合理的。所需的计算在计算上是可行的。\n\n**步骤 3：结论和行动**\n此问题是**有效的**。它代表了偏微分方程数值分析中的一个标准的、定义明确的练习。将按计划进行求解。\n\n### 基于原理的求解设计\n\n该问题的核心在于守恒律数值方法的一个基本原理：数值格式必须是“守恒形式”，以保证其捕获的任何激波都以正确的物理速度传播。这由 Lax-Wendroff 定理形式化。该问题要求直接比较一个遵守此原理的格式（守恒有限体积法）和一个不遵守此原理的格式（非守恒迎风格式）。\n\n**1. 精确激波速度（朗金-雨贡纽条件）**\n对于标量守恒律 $u_t + f(u)_x=0$，分离状态 $u_L$ 和 $u_R$ 的间断（激波）的速度 $s$ 由朗金-雨贡纽条件给出：\n$$s = \\frac{[f(u)]}{[u]} = \\frac{f(u_R) - f(u_L)}{u_R - u_L}$$\n对于无粘 Burgers 方程，通量为 $f(u) = \\frac{1}{2}u^2$。将其代入该条件可得：\n$$s_{\\mathrm{RH}} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{\\frac{1}{2}(u_R - u_L)(u_R + u_L)}{u_R - u_L}$$\n由于我们处于激波情况 ($u_L > u_R$)，分母非零，我们得到精确的激波速度为：\n$$s_{\\mathrm{RH}} = \\frac{1}{2}(u_L + u_R)$$\n此公式将用于计算每个测试用例的精确速度并计算误差 $\\varepsilon$。\n\n**2. 数值格式和时间演化**\n将实现一个通用函数，为给定的数值格式执行从 $t=0$到 $t=T$ 的时间步进。\n\n-   **网格和初始状态：** 在 $[-1,1]$ 上建立一个均匀的以单元为中心的网格。初始条件是一个分段常数函数，通过将 $u_L$ 赋给中心 $x_i  0$ 的单元，将 $u_R$ 赋给 $x_i > 0$ 的单元来进行离散化。因为网格是以单元为中心且单元数 $N$ 为偶数，所以没有单元中心落在 $x=0$ 上，因此赋值是明确的。\n\n-   **时间步进：** 模拟在循环中进行。在每一步 $n$，时间步长 $\\Delta t$ 根据 CFL 条件动态计算以确保稳定性：$\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / \\max_i |u_i^n|$。最后的时间步长会进行调整，以确保模拟在目标时间 $T$ 准时结束。\n\n**2.1. 守恒格式 (Lax–Friedrichs)**\n该格式通过基于跨越单元边界的净通量来更新单元平均值。其更新公式为\n$$u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right)$$\n数值通量 $F_{i+\\frac{1}{2}}$ 是单元 $i$ 和 $i+1$ 之间界面上真实通量的近似。局部 Lax-Friedrichs (Rusanov) 通量是一种流行的选择，它引入与局部波速成正比的数值耗散以保持稳定性。其形式为\n$$F_{i+\\frac{1}{2}} = \\frac{f(u_i) + f(u_{i+1})}{2} - \\frac{\\alpha_{i+\\frac{1}{2}}}{2}(u_{i+1} - u_i)$$\n其中 $\\alpha_{i+\\frac{1}{2}} = \\max(|u_i|, |u_{i+1}|)$。\n边界条件通过在域外引入“鬼点单元”来处理。左边界的通量 $F_{-\\frac{1}{2}}$ 使用左侧鬼点单元中的状态 $u_L$ 和第一个内部单元中的 $u_0$ 计算。类似地，右边界的通量 $F_{N-\\frac{1}{2}}$ 使用 $u_{N-1}$ 和鬼点状态 $u_R$。\n\n**2.2. 非守恒格式（迎风）**\n该格式离散了 Burgers 方程的非守恒（平流）形式 $u_t + u u_x = 0$。空间导数 $u_x$ 使用一阶迎风差分来近似，其中差分的方向（向前或向后）取决于局部平流速度 $u_i$ 的符号。\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\n\\begin{cases}\nu_i^n(u_i^n - u_{i-1}^n)  \\text{if } u_i^n > 0 \\\\\nu_i^n(u_{i+1}^n - u_i^n)  \\text{if } u_i^n \\le 0\n\\end{cases}\n$$\n该格式不具备守恒形式。因此，不能保证它会收敛到原始守恒律的弱解，从而可能产生以不正确速度传播的激波。边界条件按规定实现：使用值为 $u_L$ 和 $u_R$ 的鬼点单元来计算 $u_0$ 和 $u_{N-1}$ 的更新，并且在整个解向量更新后，边界单元的值被重置为 $u_0 = u_L$ 和 $u_{N-1} = u_R$。\n\n**3. 激波速度分析**\n将解演化到最终时间 $T$ 后，识别数值激波位置。\n-   计算中点值 $u_{\\mathrm{mid}} = (u_L+u_R)/2$。\n-   代码搜索第一个相邻单元对 $(i, i+1)$，在该处解穿过此中点值，即 $(u_i - u_{\\mathrm{mid}})(u_{i+1} - u_{\\mathrm{mid}}) \\le 0$。\n-   在此区间内使用线性插值来找到更精确的激波位置估计：\n    $$x_{\\mathrm{shock}} = x_i + \\Delta x \\frac{u_{\\mathrm{mid}} - u_i}{u_{i+1} - u_i}$$\n-   然后，假设激波从 $x=0$ 开始，数值激波速度为 $s_{\\mathrm{num}} = x_{\\mathrm{shock}} / T$。\n-   最后，每种格式的误差计算为 $\\varepsilon = |s_{\\mathrm{num}} - s_{\\mathrm{RH}}|$。\n\n该实现将处理每个测试用例，运行两种格式，计算它们各自的速度误差，并按规定格式化结果。这种比较分析预计将证明守恒格式在激波捕捉问题上的优越准确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It implements both a conservative and a nonconservative scheme for\n    the inviscid Burgers' equation and compares their shock speed prediction.\n    \"\"\"\n\n    def solve_case(u_L, u_R, T, N, CFL):\n        \"\"\"\n        Solves a single test case for both schemes.\n        \n        Returns:\n            A list containing the speed errors [err_cons, err_noncons].\n        \"\"\"\n        # --- Grid and Initial Conditions ---\n        L_domain = 2.0\n        dx = L_domain / N\n        x = np.linspace(-1 + dx / 2, 1 - dx / 2, N)\n        u0 = np.where(x  0, u_L, u_R)\n\n        # --- Exact Shock Speed (Rankine-Hugoniot) ---\n        s_rh = 0.5 * (u_L + u_R)\n        \n        # --- Function to run a simulation for a given scheme ---\n        def run_simulation(scheme_type):\n            u = u0.copy()\n            t = 0.0\n\n            while t  T:\n                # Calculate time step via CFL condition\n                max_u_abs = np.max(np.abs(u))\n                # Prevent division by zero if solution is identically zero\n                if max_u_abs  1e-12:\n                    max_u_abs = 1e-12\n                \n                dt = CFL * dx / max_u_abs\n                \n                # Ensure we stop exactly at time T\n                if t + dt > T:\n                    dt = T - t\n\n                if scheme_type == 'conservative':\n                    # Pad solution vector with ghost cells for boundary conditions\n                    u_padded = np.concatenate(([u_L], u, [u_R]))\n                    \n                    # Rusanov (Local Lax-Friedrichs) flux\n                    u_left = u_padded[:-1]\n                    u_right = u_padded[1:]\n                    \n                    flux_phys_left = 0.5 * u_left**2\n                    flux_phys_right = 0.5 * u_right**2\n                    \n                    alpha = np.maximum(np.abs(u_left), np.abs(u_right))\n                    \n                    flux_num = 0.5 * (flux_phys_left + flux_phys_right) - 0.5 * alpha * (u_right - u_left)\n                    \n                    # Update cell averages\n                    u = u - (dt / dx) * (flux_num[1:] - flux_num[:-1])\n\n                elif scheme_type == 'nonconservative':\n                    u_old = u.copy()\n                    u_new = u.copy()\n\n                    # Update for interior points (vectorized)\n                    # Note: These diffs use the state from the previous time step\n                    u_forward_diff = np.roll(u_old, -1) - u_old\n                    u_backward_diff = u_old - np.roll(u_old, 1)\n\n                    # Handle boundaries for difference calculation\n                    u_backward_diff[0] = u_old[0] - u_L\n                    u_forward_diff[N-1] = u_R - u_old[N-1]\n\n                    u_p = np.maximum(u_old, 0)\n                    u_n = np.minimum(u_old, 0)\n                    \n                    spatial_term = u_p * u_backward_diff + u_n * u_forward_diff\n                    u_new = u_old - (dt/dx) * spatial_term\n                    \n                    # Re-impose Dirichlet BC on boundary cells as specified\n                    u_new[0] = u_L\n                    u_new[N-1] = u_R\n                    u = u_new\n\n                t += dt\n            \n            return u\n\n        # --- Run simulations and calculate errors ---\n        errors = []\n        for scheme in ['conservative', 'nonconservative']:\n            u_final = run_simulation(scheme)\n            \n            u_mid = 0.5 * (u_L + u_R)\n            \n            # Find shock location by finding where solution crosses u_mid\n            # The condition finds the cell *before* the crossing\n            crossings = np.where((u_final[:-1] - u_mid) * (u_final[1:] - u_mid) = 0)[0]\n            \n            if len(crossings) > 0:\n                i_shock = crossings[0] # Take the first crossing\n                \n                u_i = u_final[i_shock]\n                u_ip1 = u_final[i_shock + 1]\n                x_i = x[i_shock]\n                \n                # Linear interpolation to find precise shock position\n                # Add a small epsilon to denominator to avoid division by zero\n                denominator = u_ip1 - u_i\n                if abs(denominator)  1e-12:\n                    # If flat, place shock at interface\n                    x_shock = x_i + 0.5 * dx \n                else: \n                    x_shock = x_i + dx * (u_mid - u_i) / denominator\n            else:\n                # If no crossing is found (e.g., shock diffused out or exited domain), mark as NaN\n                x_shock = np.nan\n\n            if np.isnan(x_shock):\n                s_num = np.nan\n                error = np.nan\n            else:\n                s_num = x_shock / T\n                error = abs(s_num - s_rh)\n            errors.append(error)\n            \n        return errors\n\n    # --- Test Suite ---\n    test_cases = [\n        # (u_L, u_R, T, N, CFL)\n        (2.0, 0.0, 0.30, 800, 0.45),\n        (1.0, -1.0, 0.30, 800, 0.45),\n        (1.0, 0.5, 0.20, 800, 0.45),\n    ]\n\n    results = []\n    for params in test_cases:\n        errors = solve_case(*params)\n        results.append(errors)\n\n    # --- Final Output Formatting ---\n    formatted_pairs = [f\"[{e_c},{e_n}]\" for e_c, e_n in results]\n    print(f\"[{','.join(formatted_pairs)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个格式的理论性质，例如其精度阶数和数值黏性，对模拟质量有实实在在的影响。当解包含尖锐梯度或不连续性时，这一点尤其明显。在本实践中，我们通过一个富有挑战性的问题来考察不同格式的性能：一个离散狄拉克 $\\delta$ 函数的平流。通过测量 $L^1$ 误差并计算数值收敛率，您将量化每种格式在保持解的形状和位置方面的有效性，从而为每种方法引入的数值扩散提供一个实际的度量。",
            "id": "3393020",
            "problem": "考虑在周期性一维域 $[0,1)$ 上的线性平流方程 $u_t + a\\,u_x = 0$，其中速度 $a \\in \\mathbb{R}$ 为常数，初始条件为测度值形式 $u(x,0) = \\delta(x - x_0)$，$\\delta$ 是狄拉克δ分布，$x_0 \\in [0,1)$。其精确解是输运测度 $u(x,t) = \\delta(x - x_0 - a t \\bmod 1)$。本题的目标是研究标准的显式有限差分格式如何传播此类测度值初始数据，并量化当离散近似表示为网格单元平均值时，其在 $L^1$ 意义下收敛到精确解的速率。\n\n您的任务是推导、实现和比较三种广泛用于一阶双曲方程的显式有限差分格式：\n- 一阶迎风格式，\n- Lax–Friedrichs格式，以及\n- Lax–Wendroff格式。\n\n从一阶双曲偏微分方程的守恒性和相容性原理以及周期性边界条件出发，推导每种格式，而不要调用任何预先给定的离散化公式。确保每种格式都遵守 Courant–Friedrichs–Lewy (CFL) 条件，其中 Courant–Friedrichs–Lewy (CFL) 数定义为 $\\nu = |a|\\,\\Delta t/\\Delta x$。对于下面描述的测试套件，假定 $a0$。\n\n使用具有 $N$ 个单元、网格间距 $\\Delta x = 1/N$ 和周期性索引的均匀网格。通过单元平均值在离散层面上表示测度值初始条件，具体如下：给定 $x_0 \\in [0,1)$，通过将所有质量放置在包含 $x_0$ 的单元中来设置初始离散向量 $u^0 \\in \\mathbb{R}^N$，即，对于唯一的索引 $j$ 使得 $x_0 \\in [j\\Delta x,(j+1)\\Delta x)$（索引模 $N$），有 $u^0_j = 1/\\Delta x$，而对于 $i \\ne j$，有 $u^0_i = 0$。使用每种格式，选择满足指定 CFL 数 $\\nu \\in (0,1]$ 的 $\\Delta t$ 来随时间演化 $u^n$，并计算数值时间 $T_{\\text{num}} = k\\,\\Delta t$，其中 $k$ 是所应用的时间步数。取 $k = \\left\\lfloor T/\\Delta t + 1/2 \\right\\rfloor$ 以逼近目标物理时间 $T0$，并在下面的精确参考解中使用 $T_{\\text{num}}$。\n\n在时间 $T_{\\text{num}}$ 的精确离散参考解定义为向量 $u^{\\star} \\in \\mathbb{R}^N$，其仅有一个非零项，对应于包含平流点 $x^\\star = (x_0 + a\\,T_{\\text{num}}) \\bmod 1$ 的单元，即，对于唯一的 $j$ 使得 $x^\\star \\in [j\\Delta x,(j+1)\\Delta x)$，有 $u^{\\star}_j = 1/\\Delta x$，而对于 $i \\ne j$，有 $u^{\\star}_i = 0$。对于给定的离散解 $u$，根据此精确离散参考解衡量 $L^1$ 误差：\n$$\nE_{L^1} = \\sum_{j=0}^{N-1} \\left| u_j - u^{\\star}_j \\right|\\,\\Delta x.\n$$\n这个 $L^1$ 误差量化了当 $\\Delta x \\to 0$ 时模糊输运的δ函数的数值扩散和色散。\n\n对于在相同目标时间 $T$ 和相同 CFL 数 $\\nu$ 下的一对具有 $N$ 和 $2N$ 个单元的网格，通过以下公式定义观测到的 $L^1$ 收敛率：\n$$\n\\text{rate} = \\frac{\\log\\!\\left(E_{L^1}(N) / E_{L^1}(2N)\\right)}{\\log\\!\\left(\\Delta x / (\\Delta x/2)\\right)} = \\log_2\\!\\left(\\frac{E_{L^1}(N)}{E_{L^1}(2N)}\\right).\n$$\n\n在周期域上实现所有三种格式，并为以下测试套件计算所要求的指标。在所有情况下，使用 $a = 1$、$x_0 = 0.123$ 和 $T = 0.3$，并采用周期性边界条件和每个测试指定的 CFL 数 $\\nu$：\n\n- 测试 $1$ (理想情况，单调扩散)：格式 upwind，$\\nu = 0.8$，网格对 $(N,2N) = (200,400)$。以浮点数形式输出观测到的 $L^1$ 收敛率。\n- 测试 $2$ (更强的人工扩散)：格式 Lax–Friedrichs，$\\nu = 0.8$，网格对 $(N,2N) = (200,400)$。以浮点数形式输出观测到的 $L^1$ 收敛率。\n- 测试 $3$ (色散的，更高形式阶)：格式 Lax–Wendroff，$\\nu = 0.8$，网格对 $(N,2N) = (200,400)$。以浮点数形式输出观测到的 $L^1$ 收敛率。\n- 测试 $4$ (边界 CFL 情况)：格式 upwind，$\\nu = 1.0$，单个网格 $N = 400$。以浮点数形式输出在时间 $T_{\\text{num}}$ 时的 $L^1$ 误差。\n- 测试 $5$ (小 CFL，单调扩散)：格式 upwind，$\\nu = 0.2$，网格对 $(N,2N) = (256,512)$。以浮点数形式输出观测到的 $L^1$ 收敛率。\n\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来的结果（例如 $[r_1,r_2,r_3,e_4,r_5]$），其中每个条目是对应于上述顺序测试的浮点数。本问题不涉及单位，任何可能隐式出现的角度均无关紧要。",
            "solution": "所提出的问题是分析三种常见的有限差分格式——一阶迎风、Lax-Friedrichs 和 Lax-Wendroff——对于带测度值初始条件的一维线性平流方程 $u_t + a\\,u_x = 0$ 的行为。分析涉及从基本原理推导这些格式，在周期域上实现它们，并为一个非光滑的、类狄拉克δ函数的初始数据计算它们的 $L^1$ 收敛率。\n\n我们首先建立一个基于守恒律积分形式的一般框架。线性平流方程是通量函数为 $f(u) = a u$ 的一个守恒律。将该偏微分方程在一个由单元 $j$（即 $[x_{j-1/2}, x_{j+1/2}]$）和一个时间区间 $[t^n, t^{n+1}]$ 定义的控制体上进行积分，得到：\n$$\n\\int_{t^n}^{t^{n+1}} \\int_{x_{j-1/2}}^{x_{j+1/2}} (u_t + (au)_x) \\, dx \\, dt = 0\n$$\n在时空域上应用散度定理，得到：\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^{n+1}) \\, dx - \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^n) \\, dx + \\int_{t^n}^{t^{n+1}} a u(x_{j+1/2}, t) \\, dt - \\int_{t^n}^{t^{n+1}} a u(x_{j-1/2}, t) \\, dt = 0\n$$\n令 $u_j^n$ 为时间 $t^n$ 时单元 $j$ 中解的单元平均值，$u_j^n \\approx \\frac{1}{\\Delta x} \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x, t^n) \\, dx$。我们使用一个数值通量函数 $F_{j\\pm1/2}$ 来近似通量的时间积分，该函数依赖于时间 $t^n$ 时的解值。方程变为：\n$$\n\\Delta x u_j^{n+1} - \\Delta x u_j^n + \\Delta t F_{j+1/2} - \\Delta t F_{j-1/2} = 0\n$$\n整理后得到标准的守恒型有限差分更新公式：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} (F_{j+1/2} - F_{j-1/2})\n$$\n推导每种格式就是定义数值通量 $F$。对于所有格式，我们定义 Courant-Friedrichs-Lewy (CFL) 数为 $\\nu = a \\frac{\\Delta t}{\\Delta x}$，并根据测试用例的规定假设 $a>0$。\n\n**1. 一阶迎风格式**\n该格式基于信号传播的物理原理。对于 $a  0$ 的平流方程，特征线（也就是信息）从左向右传播。因此，单元 $j$ 和 $j+1$ 之间的界面 $x_{j+1/2}$ 处的通量应由上游单元（即迎风单元）的状态决定，这里是单元 $j$。我们据此定义数值通量：\n$$\nF_{j+1/2} = f(u_j^n) = a u_j^n\n$$\n将其代入守恒型更新公式：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} (a u_j^n - a u_{j-1}^n)\n$$\n使用 $\\nu$ 的定义：\n$$\nu_j^{n+1} = u_j^n - \\nu(u_j^n - u_{j-1}^n) = (1-\\nu)u_j^n + \\nu u_{j-1}^n\n$$\n该格式在 CFL 条件 $0 \\le \\nu \\le 1$ 下是稳定的。\n\n**2. Lax–Friedrichs格式**\nLax–Friedrichs 格式可以从时间向前、空间居中 (FTCS) 的离散化推导而来，而 FTCS 格式是无条件不稳定的。通过将时间更新中的项 $u_j^n$ 替换为其邻居的空间平均值 $\\frac{1}{2}(u_{j+1}^n + u_{j-1}^n)$ 来解决不稳定性问题。这引入了数值扩散。推导始于：\n$$\n\\frac{u_j^{n+1} - \\frac{1}{2}(u_{j+1}^n + u_{j-1}^n)}{\\Delta t} + a \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0\n$$\n求解 $u_j^{n+1}$：\n$$\nu_j^{n+1} = \\frac{1}{2}(u_{j+1}^n + u_{j-1}^n) - \\frac{a \\Delta t}{2\\Delta x}(u_{j+1}^n - u_{j-1}^n)\n$$\n代入 $\\nu = a \\Delta t / \\Delta x$ 并合并各项，得到更新规则：\n$$\nu_j^{n+1} = \\left(\\frac{1}{2} - \\frac{\\nu}{2}\\right)u_{j+1}^n + \\left(\\frac{1}{2} + \\frac{\\nu}{2}\\right)u_{j-1}^n\n$$\n该格式在 $|\\nu| \\le 1$ 时是稳定的。\n\n**3. Lax–Wendroff格式**\n该格式被设计为在时间和空间上都具有二阶精度。推导从解在时间上的泰勒级数展开开始：\n$$\nu(x, t+\\Delta t) = u(x,t) + \\Delta t u_t(x,t) + \\frac{(\\Delta t)^2}{2} u_{tt}(x,t) + O((\\Delta t)^3)\n$$\n从控制偏微分方程中，我们可以用空间导数表示时间导数：\n$u_t = -a u_x$\n$u_{tt} = \\frac{\\partial}{\\partial t}(-a u_x) = -a (\\frac{\\partial u}{\\partial t})_x = -a(-a u_x)_x = a^2 u_{xx}$\n将这些代入泰勒展开式：\n$$\nu(x, t+\\Delta t) \\approx u(x,t) - a \\Delta t u_x(x,t) + \\frac{(a \\Delta t)^2}{2} u_{xx}(x,t)\n$$\n现在我们在 $(x_j, t^n)$ 处用二阶中心差分近似来离散化这个方程的空间导数：\n$$\n(u_x)_j^n \\approx \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x}, \\qquad (u_{xx})_j^n \\approx \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\n$$\n代入这些近似值得到 Lax-Wendroff 格式：\n$$\nu_j^{n+1} = u_j^n - a \\Delta t \\left(\\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x}\\right) + \\frac{(a \\Delta t)^2}{2} \\left(\\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\\right)\n$$\n使用 $\\nu = a \\Delta t / \\Delta x$ 并合并 $u_{j-1}^n$、$u_j^n$ 和 $u_{j+1}^n$ 的系数：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{\\nu^2}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\n$$\nu_j^{n+1} = \\left(\\frac{\\nu^2}{2} - \\frac{\\nu}{2}\\right) u_{j+1}^n + (1 - \\nu^2) u_j^n + \\left(\\frac{\\nu^2}{2} + \\frac{\\nu}{2}\\right) u_{j-1}^n\n$$\n该格式在 $|\\nu| \\le 1$ 时也是稳定的。\n\n**实现与评估**\n仿真根据问题描述进行。对于每个测试，我们在 $[0,1)$ 上设置一个包含 $N$ 个单元的均匀网格，单元宽度为 $\\Delta x = 1/N$。时间步长 $\\Delta t$ 由指定的 CFL 数 $\\nu$ 确定。初始条件 $u(x,0)=\\delta(x-x_0)$ 通过将总质量 $1$ 放入包含 $x_0$ 的单个单元中进行离散化，得到 $u_j^0 = (1/\\Delta x) \\delta_{j,j_0}$，其中 $j_0 = \\lfloor x_0/\\Delta x \\rfloor$。解演化 $k = \\lfloor T/\\Delta t + 1/2 \\rfloor$ 步，直到数值时间 $T_{\\text{num}} = k \\Delta t$。精确离散参考解 $u^\\star$ 的构造类似，在索引 $j^\\star = \\lfloor ((x_0 + a T_{\\text{num}}) \\bmod 1) / \\Delta x \\rfloor$ 处有一个非零项。计算 $L^1$ 误差 $E_{L^1} = \\sum_{j=0}^{N-1} |u_j^k - u^\\star_j| \\Delta x$。对于收敛性测试，使用两个网格 $N$ 和 $2N$，通过 $\\log_2(E_{L^1}(N) / E_{L^1}(2N))$ 求得收敛率。\n\n一个特殊情况是测试4，其中迎风格式使用 $\\nu = 1$。更新规则简化为 $u_j^{n+1} = u_{j-1}^n$，这是一个精确的离散平移操作。$k$ 步后的数值解就是初始条件平移 $k$ 个单元，即 $u_j^k = u_{j-k}^0$。数值解的峰值位置与包含真实平流位置的单元索引完全对齐，理论上导致 $L^1$ 误差为 $0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and compares three finite difference schemes for the 1D advection equation.\n    \"\"\"\n\n    def run_simulation(scheme: str, nu: float, N: int, a: float, x0: float, T: float) -> float:\n        \"\"\"\n        Runs a single simulation and computes the L1 error.\n\n        Args:\n            scheme: The name of the numerical scheme ('upwind', 'lax-friedrichs', 'lax-wendroff').\n            nu: The Courant-Friedrichs-Lewy (CFL) number.\n            N: The number of grid cells.\n            a: The constant advection speed.\n            x0: The initial position of the delta distribution.\n            T: The target final time.\n\n        Returns:\n            The L1 error of the numerical solution.\n        \"\"\"\n        # Grid and time step setup\n        dx = 1.0 / N\n        # Since a > 0 is assumed from the problem description for tests, |a| = a\n        dt = nu * dx / a\n        # Number of steps to approximate target time T\n        # The problem specifies k = floor(T/dt + 1/2), which is equivalent to rounding.\n        num_steps = int(round(T / dt))\n        T_num = num_steps * dt\n\n        # Initial condition: discrete delta function as a cell average\n        u = np.zeros(N, dtype=np.float64)\n        j0 = int(np.floor(x0 / dx))\n        if 0 = j0  N:\n            u[j0] = 1.0 / dx\n\n        # Scheme-specific update function\n        if scheme == 'upwind':\n            # u_j^{n+1} = (1-nu) u_j^n + nu u_{j-1}^n\n            # Assumes a > 0 as specified for the test suite\n            def update_step(u_n):\n                return (1.0 - nu) * u_n + nu * np.roll(u_n, 1)\n        elif scheme == 'lax-friedrichs':\n            # u_j^{n+1} = 0.5*(1-nu)*u_{j+1}^n + 0.5*(1+nu)*u_{j-1}^n\n            c_jp1 = 0.5 * (1.0 - nu)\n            c_jm1 = 0.5 * (1.0 + nu)\n            def update_step(u_n):\n                return c_jp1 * np.roll(u_n, -1) + c_jm1 * np.roll(u_n, 1)\n        elif scheme == 'lax-wendroff':\n            # u_j^{n+1} = c_{j+1}*u_{j+1}^n + c_j*u_j^n + c_{j-1}*u_{j-1}^n\n            c_j = 1.0 - nu**2\n            c_jp1 = 0.5 * nu * (nu - 1.0)\n            c_jm1 = 0.5 * nu * (nu + 1.0)\n            def update_step(u_n):\n                return c_jp1 * np.roll(u_n, -1) + c_j * u_n + c_jm1 * np.roll(u_n, 1)\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        # Time evolution loop\n        u_n = u\n        for _ in range(num_steps):\n            u_n = update_step(u_n)\n\n        # Final numerical solution\n        u_final = u_n\n        \n        # Exact discrete reference solution\n        x_star = (x0 + a * T_num) % 1.0\n        u_exact = np.zeros(N, dtype=np.float64)\n        j_star = int(np.floor(x_star / dx))\n        if 0 = j_star  N:\n            u_exact[j_star] = 1.0 / dx\n\n        # L1 error calculation\n        l1_error = np.sum(np.abs(u_final - u_exact)) * dx\n        \n        return l1_error\n\n    # --- Test Suite ---\n    a_const = 1.0\n    x0_const = 0.123\n    T_const = 0.3\n    \n    test_cases = [\n        {'type': 'rate', 'scheme': 'upwind', 'nu': 0.8, 'N_pair': (200, 400)},\n        {'type': 'rate', 'scheme': 'lax-friedrichs', 'nu': 0.8, 'N_pair': (200, 400)},\n        {'type': 'rate', 'scheme': 'lax-wendroff', 'nu': 0.8, 'N_pair': (200, 400)},\n        {'type': 'error', 'scheme': 'upwind', 'nu': 1.0, 'N': 400},\n        {'type': 'rate', 'scheme': 'upwind', 'nu': 0.2, 'N_pair': (256, 512)},\n    ]\n\n    results = []\n    for case in test_cases:\n        if case['type'] == 'rate':\n            N1, N2 = case['N_pair']\n            err1 = run_simulation(case['scheme'], case['nu'], N1, a_const, x0_const, T_const)\n            err2 = run_simulation(case['scheme'], case['nu'], N2, a_const, x0_const, T_const)\n            \n            if err1 == 0.0 or err2 == 0.0:\n                 # Avoid division by zero, although not expected for these tests\n                 rate = np.nan\n            else:\n                 rate = np.log2(err1 / err2)\n            results.append(rate)\n        elif case['type'] == 'error':\n            error = run_simulation(case['scheme'], case['nu'], case['N'], a_const, x0_const, T_const)\n            results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}