{
    "hands_on_practices": [
        {
            "introduction": "傅里叶分析是理解数值格式如何处理不同波长解分量的基石。本练习将指导你通过推导常见差分格式（如一阶迎风格式、Lax-Wendroff格式和紧致格式）的离散符号（放大因子），来量化它们的耗散（振幅误差）和色散（相位误差）特性。这是分析和设计数值格式的一项基本技能，对于预测其在实际问题中的行为至关重要。",
            "id": "3393016",
            "problem": "考虑常系数线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中 $u(x,t)$ 是一个光滑标量场，具有正平流速度 $a > 0$，方程定义在间距为 $h$、时间步长为 $\\Delta t$ 的无限均匀网格上。设 Courant–Friedrichs–Lewy (CFL) 数定义为 $\\lambda = a\\,\\Delta t/h$。对单频分量 $u^{n}_{j} = \\hat{u}\\,\\exp(i\\,j\\,\\kappa)\\,\\exp(i\\,n\\,\\varphi)$ 使用傅里叶模态分析，其中 $\\kappa = k\\,h$ 是无量纲波数，$k$ 是物理波数，$j,n \\in \\mathbb{Z}$ 是空间和时间索引。\n\n1. 对于 $a > 0$ 的前向欧拉、一阶迎风有限差分格式，\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\lambda\\left(u^{n}_{j} - u^{n}_{j-1}\\right),\n$$\n推导离散放大因子 $G_{\\text{up}}(\\kappa)$，并确定该格式是引入离散色散、离散耗散，还是两者兼有。用 $G_{\\text{up}}(\\kappa)$ 的辐角表示离散相位，并用 $\\varphi/\\Delta t$ 和 $k$ 表示数值相速度。\n\n2. 对于线性平流的经典 Lax–Wendroff 格式，\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\frac{\\lambda}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right) + \\frac{\\lambda^{2}}{2}\\left(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\right),\n$$\n推导离散放大因子 $G_{\\text{LW}}(\\kappa)$ 及其模。确定 $\\lambda$ 在什么条件下，该格式对所有 $\\kappa \\in [0,\\pi]$ 都是无耗散的，并用 $G_{\\text{LW}}(\\kappa)$ 的辐角和 $k$ 表示数值相速度。\n\n3. 考虑以下对 $u_{x}$ 的单参数族三点三对角紧致迎风有限差分近似，该近似以半离散形式（采用精确时间积分的方法线）给出，因此色散性质仅由空间微分控制：\n$$\n\\alpha\\,u'_{j-1} + u'_{j} = \\frac{1}{h}\\left(c_{-1}\\,u_{j-1} + c_{0}\\,u_{j} + c_{1}\\,u_{j+1}\\right),\n$$\n其中 $\\alpha \\ge 0$ 是一个自由迎风偏置参数，$c_{-1},c_{0},c_{1}$ 是待定常系数，由相容性和对 $a > 0$ 的迎风平流偏置确定。使用傅里叶模态分析，推导通过 $u'_{j} \\approx i\\,\\tilde{k}(\\kappa)\\,u_{j}$ 定义的半离散修正波数 $\\tilde{k}(\\kappa)$，并构造其小 $\\kappa$ 展开式 $\\tilde{k}(\\kappa)\\,h = \\kappa + \\beta_{3}(\\alpha)\\,\\kappa^{3} + \\mathcal{O}(\\kappa^{5})$。施加形式三阶精度和迎风偏置所需的条件，然后将目标频带 $\\kappa \\in [0,\\kappa_{b}]$（对于固定的 $0  \\kappa_{b}  \\pi$）上的主阶归一化相速度误差定义为积分\n$$\n\\mathcal{E}(\\alpha) = \\int_{0}^{\\kappa_{b}}\\left(\\frac{\\tilde{k}(\\kappa)}{k} - 1\\right)^{2}\\,d\\kappa,\n$$\n其中 $k = \\kappa/h$。使用 $\\kappa$ 中的主阶渐近，以闭合形式在 $\\alpha \\ge 0$ 上最小化 $\\mathcal{E}(\\alpha)$。你的最终答案必须是最小化主阶度量的单个最优 $\\alpha$ 值，表示为一个精确数。无需四舍五入，最终答案中不应包含单位。",
            "solution": "### 第一部分：一阶迎风格式\n\n对于 $a > 0$ 的一阶迎风格式由下式给出\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\lambda\\left(u^{n}_{j} - u^{n}_{j-1}\\right)\n$$\n其中 $\\lambda = a\\,\\Delta t/h$ 是 CFL 数。为进行傅里叶分析，我们代入单个模态 $u^{n}_{j} = G^{n}(\\kappa)\\,\\exp(i\\,j\\,\\kappa)$，其中 $G(\\kappa)$ 是放大因子，$\\kappa=kh$ 是无量纲波数。\n$$\nG^{n+1}\\,\\exp(i\\,j\\,\\kappa) = G^{n}\\,\\exp(i\\,j\\,\\kappa) - \\lambda\\left(G^{n}\\,\\exp(i\\,j\\,\\kappa) - G^{n}\\,\\exp(i\\,(j-1)\\,\\kappa)\\right)\n$$\n两边同除以 $G^{n}\\,\\exp(i\\,j\\,\\kappa)$，我们得到放大因子 $G_{\\text{up}}(\\kappa)$：\n$$\nG_{\\text{up}}(\\kappa) = 1 - \\lambda(1 - \\exp(-i\\,\\kappa)) = (1 - \\lambda + \\lambda\\,\\cos(\\kappa)) - i\\,\\lambda\\,\\sin(\\kappa)\n$$\n为分析耗散，我们计算 $G_{\\text{up}}(\\kappa)$ 的模的平方：\n$$\n|G_{\\text{up}}(\\kappa)|^2 = (1 - \\lambda + \\lambda\\,\\cos\\kappa)^2 + (-\\lambda\\,\\sin\\kappa)^2\n$$\n$$\n|G_{\\text{up}}(\\kappa)|^2 = 1 - 2\\lambda(1-\\lambda)(1-\\cos\\kappa)\n$$\n使用半角恒等式 $1-\\cos\\kappa = 2\\sin^2(\\kappa/2)$，我们得到\n$$\n|G_{\\text{up}}(\\kappa)|^2 = 1 - 4\\lambda(1-\\lambda)\\sin^2(\\frac{\\kappa}{2})\n$$\n为使格式稳定，我们需要 $|G_{\\text{up}}(\\kappa)| \\le 1$，这意味着 $4\\lambda(1-\\lambda)\\sin^2(\\kappa/2) \\ge 0$。由于 $\\lambda > 0$ 且 $\\sin^2(\\kappa/2) \\ge 0$，这要求 $1-\\lambda \\ge 0$，因此稳定性条件是 $0  \\lambda \\le 1$。如果 $0  \\lambda  1$，那么对于任意 $\\kappa \\ne 0, 2\\pi, \\dots$，都有 $|G_{\\text{up}}(\\kappa)|  1$。非零波数的振幅减小表明存在数值（或人为）耗散。\n\n为分析色散，我们考察 $G_{\\text{up}}(\\kappa)$ 的相位。每时间步的数值相移是 $\\varphi = \\arg(G_{\\text{up}}(\\kappa))$。\n$$\n\\varphi = \\arctan\\left(\\frac{-\\lambda\\,\\sin(\\kappa)}{1 - \\lambda + \\lambda\\,\\cos(\\kappa)}\\right)\n$$\n精确解 $u(x,t) = f(x-at)$ 有对应的放大因子 $G_{\\text{exact}} = \\exp(-i\\,a\\,k\\,\\Delta t) = \\exp(-i\\,\\lambda\\,\\kappa)$。精确相移是 $-\\lambda\\,\\kappa$。数值相速度定义为 $c_{\\text{num}} = -\\varphi / (k\\,\\Delta t)$。代入 $k=\\kappa/h$ 和 $\\Delta t = \\lambda h/a$：\n$$\nc_{\\text{num}} = -\\frac{\\varphi}{(\\kappa/h)(\\lambda h/a)} = -\\frac{a\\,\\varphi}{\\lambda\\,\\kappa}\n$$\n由于 $\\varphi$ 不是 $\\kappa$ 的线性函数（具体来说，除非在 $\\kappa \\to 0$ 的极限情况下，否则 $\\varphi \\ne -\\lambda\\kappa$），数值相速度 $c_{\\text{num}}$ 对于所有波数 $k$ 都不是常数。相速度对波数的这种依赖性就是数值色散的定义。因此，一阶迎风格式既引入了离散耗散，也引入了离散色散。\n\n### 第二部分：Lax-Wendroff 格式\n\nLax-Wendroff 格式由下式给出\n$$\nu^{n+1}_{j} = u^{n}_{j} - \\frac{\\lambda}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right) + \\frac{\\lambda^{2}}{2}\\left(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\right)\n$$\n代入 $u^n_j = G^n(\\kappa)\\exp(i j \\kappa)$ 可得：\n$$\nG_{\\text{LW}}(\\kappa) = 1 - \\frac{\\lambda}{2}(e^{i\\kappa} - e^{-i\\kappa}) + \\frac{\\lambda^2}{2}(e^{i\\kappa} - 2 + e^{-i\\kappa})\n$$\n使用欧拉恒等式，$2i\\sin\\kappa = e^{i\\kappa}-e^{-i\\kappa}$ 和 $2\\cos\\kappa = e^{i\\kappa}+e^{-i\\kappa}$：\n$$\nG_{\\text{LW}}(\\kappa) = 1 - i\\lambda\\sin(\\kappa) + \\frac{\\lambda^2}{2}(2\\cos(\\kappa) - 2) = 1 - \\lambda^2(1-\\cos(\\kappa)) - i\\lambda\\sin(\\kappa)\n$$\n放大因子的模平方为：\n$$\n|G_{\\text{LW}}(\\kappa)|^2 = \\left(1 - \\lambda^2(1-\\cos\\kappa)\\right)^2 + (-\\lambda\\sin\\kappa)^2 = 1 - \\lambda^2(1-\\lambda^2)(1-\\cos\\kappa)^2\n$$\n如果对于所有 $\\kappa$ 都有 $|G_{\\text{LW}}(\\kappa)| = 1$，则该格式是无耗散的。这在减去项对所有 $\\kappa$ 都为零时发生。由于 $(1-\\cos\\kappa)^2$ 不恒为零，这要求 $\\lambda^2(1-\\lambda^2)=0$。给定 $\\lambda>0$，唯一的非平凡解是 $1-\\lambda^2=0$，这意味着 $\\lambda=1$。Lax-Wendroff 格式的稳定性条件是 $0  \\lambda \\le 1$。该格式仅在稳定性边界 $\\lambda=1$ 时是无耗散的。\n\n数值相速度为 $c_{\\text{num}} = -\\arg(G_{\\text{LW}}) / (k\\,\\Delta t)$，其中\n$$\n\\arg(G_{\\text{LW}}) = \\arctan\\left(\\frac{-\\lambda\\sin(\\kappa)}{1-\\lambda^2(1-\\cos(\\kappa))}\\right)\n$$\n\n### 第三部分：紧致迎风格式\n\n半离散紧致格式由下式给出\n$$\n\\alpha\\,u'_{j-1} + u'_{j} = \\frac{1}{h}\\left(c_{-1}\\,u_{j-1} + c_{0}\\,u_{j} + c_{1}\\,u_{j+1}\\right)\n$$\n为了一致性，我们对所有项在点 $j$ 周围进行泰勒级数展开。匹配 $u$ 的各阶导数项可以得到一个关于系数 $c_{-1}, c_0, c_1$ 的方程组：\n1. $u_j$ 的系数: $c_{-1} + c_0 + c_1 = 0$\n2. $u'_j$ 的系数: $h(c_1 - c_{-1}) = (1+\\alpha)h \\implies c_1 - c_{-1} = 1+\\alpha$\n3. $u''_j$ 的系数: $\\frac{h^2}{2}(c_1+c_{-1}) = -\\alpha h^2 \\implies c_1+c_{-1} = -2\\alpha$\n解此方程组可得系数为 $\\alpha$ 的函数：\n$c_1 = \\frac{1-\\alpha}{2}$, $c_{-1} = -\\frac{1+3\\alpha}{2}$, $c_0 = 1+2\\alpha$。这里， $c_0 = -(c_1+c_{-1}) = -(-2\\alpha) = 2\\alpha$.\n\n修正波数 $\\tilde{k}(\\kappa)$ 可通过将 $u_j = \\hat{u}\\exp(ij\\kappa)$ 和 $u'_j = i\\frac{\\tilde{k}}{h}u_j$ 代入格式中求得：\n$$\n\\alpha (i\\frac{\\tilde{k}}{h}) e^{i(j-1)\\kappa} + (i\\frac{\\tilde{k}}{h}) e^{ij\\kappa} = \\frac{1}{h}\\left(c_{-1}e^{i(j-1)\\kappa} + c_0 e^{ij\\kappa} + c_1 e^{i(j+1)\\kappa}\\right)\n$$\n两边同除以 $\\frac{i}{h} e^{ij\\kappa}$ 并重新整理可得：\n$$\n\\tilde{k} (\\alpha e^{-i\\kappa} + 1) = \\frac{1}{i}(c_{-1}e^{-i\\kappa} + c_0 + c_1 e^{i\\kappa})\n$$\n对小 $\\kappa$ 展开 $\\tilde{k}$ 的表达式可得：\n$$\n\\tilde{k} = \\kappa + \\left(\\frac{2\\alpha-1}{6(1+\\alpha)}\\right)\\kappa^3 + \\mathcal{O}(\\kappa^5)\n$$\n这符合问题中指定的形式 $\\tilde{k}(\\kappa) = \\kappa/h + \\beta_3(\\alpha)(\\kappa/h)^{3}h^2 + \\dots$ 应该是 $\\tilde{k}(\\kappa)h = \\kappa + \\dots$。所以，$\\tilde{k}(\\kappa)h$ 的展开式为 $\\kappa + \\beta_3(\\alpha)\\kappa^3 + \\mathcal{O}(\\kappa^5)$，其中\n$$\n\\beta_3(\\alpha) = \\frac{2\\alpha-1}{6(1+\\alpha)}\n$$\n归一化相速度误差是 $\\frac{\\tilde{k}(\\kappa)}{k} - 1 = \\frac{\\tilde{k}(\\kappa)h}{\\kappa} - 1$。使用展开式的主阶项：\n$$\n\\frac{\\tilde{k}(\\kappa)}{k} - 1 = \\beta_3(\\alpha)\\kappa^2 + \\mathcal{O}(\\kappa^4)\n$$\n误差积分 $\\mathcal{E}(\\alpha)$ 使用此主阶项近似为：\n$$\n\\mathcal{E}(\\alpha) = \\int_{0}^{\\kappa_{b}}\\left(\\frac{\\tilde{k}(\\kappa)}{k} - 1\\right)^{2}\\,d\\kappa \\approx \\int_{0}^{\\kappa_{b}} (\\beta_3(\\alpha)\\kappa^2)^2 d\\kappa\n$$\n$$\n\\mathcal{E}(\\alpha) \\approx (\\beta_3(\\alpha))^2 \\int_{0}^{\\kappa_{b}} \\kappa^4 d\\kappa = (\\beta_3(\\alpha))^2 \\frac{\\kappa_b^5}{5}\n$$\n为了在固定的 $\\kappa_b > 0$ 下最小化 $\\mathcal{E}(\\alpha)$，我们必须在域 $\\alpha \\ge 0$ 上最小化 $|\\beta_3(\\alpha)|$。这等价于最小化平方量 $(\\beta_3(\\alpha))^2$。\n$(\\beta_3(\\alpha))^2$ 的最小值在分子为零时出现，因为对于 $\\alpha \\ge 0$，分母 $6(1+\\alpha)$ 不为零。\n$$\n2\\alpha-1 = 0 \\implies \\alpha = \\frac{1}{2}\n$$\n该值位于允许范围 $\\alpha \\ge 0$ 内。在 $\\alpha=1/2$ 时，$\\beta_3(1/2)=0$，这在此主阶近似下产生了可能的最小误差 $\\mathcal{E}(1/2)=0$。这对应于格式变为四阶精度的情况。因此，参数的最优值是 $1/2$。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "从线性分析过渡到更复杂的非线性守恒律世界，例如伯格斯方程（Burgers’ equation）。对于包含不连续解（即激波）的问题，仅有一个稳定的格式是不够的。这个编程练习将通过一个鲜明的对比，展示为什么只有“守恒型”格式才能正确捕捉激波的传播速度——这是一个关键的物理特性，而非守恒格式则会产生错误的结果。",
            "id": "3393018",
            "problem": "考虑标量守恒律，即无粘性伯格斯方程 $u_t + \\tfrac{1}{2}(u^2)_x = 0$，此方程建立在一维空间域上，具有分段常数的黎曼初始数据和恒定的狄利克雷边界数据。此问题的基础是双曲守恒律理论、弱形式和 Rankine–Hugoniot 跳跃条件，以及基于 Courant–Friedrichs–Lewy (CFL) 数的稳定性考量。您将比较两种显式一阶有限差分格式：一种是使用数值通量的守恒格式，另一种是直接离散对流形式 $u_t + u u_x = 0$ 的非守恒格式。\n\n设置如下。设空间域为 $[-1,1]$，离散为 $N$ 个宽度为 $\\Delta x = \\tfrac{2}{N}$ 的均匀单元，单元中心为 $x_i = -1 + (i+\\tfrac{1}{2})\\Delta x$，其中 $i = 0,\\dots,N-1$。定义分段常数的黎曼初始数据为 $u(x,0) = u_L$（当 $x \\le 0$）和 $u(x,0) = u_R$（当 $x > 0$），并对所有 $t \\ge 0$ 施加恒定的狄利克雷边界条件 $u(-1,t) = u_L$ 和 $u(1,t) = u_R$。假设 $u_L > u_R$，以便一个激波形成并以明确定义的速度传播。精确的激波速度 $s_{\\mathrm{RH}}$ 由标量守恒律 $u_t + f(u)_x = 0$（其中 $f(u) = \\tfrac{1}{2}u^2$）的 Rankine–Hugoniot 跳跃条件确定。\n\n第一种离散格式是使用相容数值通量的守恒有限体积/有限差分方法。在界面 $i+\\tfrac{1}{2}$ 处采用局部 Lax–Friedrichs (也称为 Rusanov) 数值通量：\n$$\nF_{i+\\frac{1}{2}}^n = \\frac{1}{2}\\left(f(u_i^n) + f(u_{i+1}^n)\\right) - \\frac{1}{2}\\alpha_{i+\\frac{1}{2}}^n\\left(u_{i+1}^n - u_i^n\\right),\n$$\n其中 $f(u) = \\tfrac{1}{2}u^2$ 且 $\\alpha_{i+\\frac{1}{2}}^n = \\max\\left(|u_i^n|,|u_{i+1}^n|\\right)$。更新公式为\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right),\n$$\n在 $x=-1$ 和 $x=1$ 处的虚拟/界面状态分别取为 $u_L$ 和 $u_R$，用以定义 $F_{-\\frac{1}{2}}^n$ 和 $F_{N-\\frac{1}{2}}^n$。选择时间步长以满足基于 Courant–Friedrichs–Lewy (CFL) 数的稳定性约束，具体为\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|},\n$$\n其中 $0  \\mathrm{CFL}  1$。\n\n第二种离散格式处理方程的非守恒对流形式 $u_t + u u_x = 0$，并使用基于局部速度 $u_i^n$ 的逐点迎风离散格式：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(\\max(u_i^n,0)\\left(u_i^n - u_{i-1}^n\\right) + \\min(u_i^n,0)\\left(u_{i+1}^n - u_i^n\\right)\\right),\n$$\n边界处的虚拟邻近值由 $u_L$ 和 $u_R$ 一致地给定，并且在每次时间更新后，将边界单元的值重新设置为 $u_L$ 和 $u_R$ 以维持狄利克雷条件。为了稳定性，使用相同的基于 CFL 的时间步长选择方法：\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i^n|}.\n$$\n\n为了数值化地量化激波速度，定义中点状态 $u_{\\mathrm{mid}} = \\tfrac{1}{2}(u_L + u_R)$。通过定位离散剖面相对于 $u_{\\mathrm{mid}}$ 变号的第一个索引 $i$（即 $(u_i^n - u_{\\mathrm{mid}})(u_{i+1}^n - u_{\\mathrm{mid}}) \\le 0$）来估计给定最终时间 $T$ 时的激波位置 $x_{\\mathrm{shock}}(T)$，然后在单元界面内进行线性插值：\n$$\nx_{\\mathrm{shock}}(T) \\approx x_i + \\Delta x \\cdot \\frac{u_{\\mathrm{mid}} - u_i^n}{u_{i+1}^n - u_i^n}.\n$$\n根据构造，激波初始位于 $x=0$，因此数值激波速度近似为 $s_{\\mathrm{num}} \\approx \\tfrac{x_{\\mathrm{shock}}(T)}{T}$。计算每种格式的速度误差为\n$$\n\\varepsilon = \\left|s_{\\mathrm{num}} - s_{\\mathrm{RH}}\\right|,\n$$\n其中 $s_{\\mathrm{RH}}$ 是对于 $f(u) = \\tfrac{1}{2}u^2$ 和从 $u_L$ 到 $u_R$ 的跳跃的 Rankine–Hugoniot 速度。\n\n在相同的网格和参数下实现两种格式，并比较它们在同一最终时间的速度误差。使用以下测试套件，旨在确保覆盖典型的激波情况、静止激波和中等强度激波：\n1. 测试用例 1：$u_L = 2.0$，$u_R = 0.0$，$T = 0.30$，$N = 800$，$\\mathrm{CFL} = 0.45$。\n2. 测试用例 2：$u_L = 1.0$，$u_R = -1.0$，$T = 0.30$，$N = 800$，$\\mathrm{CFL} = 0.45$。\n3. 测试用例 3：$u_L = 1.0$，$u_R = 0.5$，$T = 0.20$，$N = 800$，$\\mathrm{CFL} = 0.45$。\n\n对于每个测试用例，计算速度误差对 $[\\varepsilon_{\\mathrm{cons}}, \\varepsilon_{\\mathrm{noncons}}]$，其中 $\\varepsilon_{\\mathrm{cons}}$ 是守恒格式的误差，$\\varepsilon_{\\mathrm{noncons}}$ 是非守恒格式的误差。您的程序应生成单行输出，其中包含三个结果对，形式为方括号括起来的逗号分隔列表，每个结果对本身也用方括号括起来，并按测试套件的顺序排列（例如，格式为 $[[e_{1,\\mathrm{cons}},e_{1,\\mathrm{noncons}}],[e_{2,\\mathrm{cons}},e_{2,\\mathrm{noncons}}],[e_{3,\\mathrm{cons}},e_{3,\\mathrm{noncons}}]]$）。此问题中所有量均为纯数学量，因此不需要物理单位，输出中也不出现角度或百分比。该任务本质上是可测试的，因为输出是为定义的测试套件生成的一系列浮点值。",
            "solution": "该问题的核心在于守恒律数值方法的一个基本原理：数值格式必须是“守恒形式”，以保证其捕捉到的任何激波都以正确的物理速度传播。这一点由Lax-Wendroff定理形式化。该问题要求直接比较一个遵守此原理的格式（守恒有限体积法）和一个不遵守此原理的格式（非守恒迎风格式）。\n\n**1. 精确激波速度 (Rankine–Hugoniot 条件)**\n对于标量守恒律 $u_t + f(u)_x=0$，分隔状态 $u_L$ 和 $u_R$ 的间断（激波）的速度 $s$ 由 Rankine–Hugoniot 条件给出：\n$s = \\frac{f(u_R) - f(u_L)}{u_R - u_L}$\n对于无粘性伯格斯方程，通量为 $f(u) = \\frac{1}{2}u^2$。因此，精确的激波速度为：\n$s_{\\mathrm{RH}} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{1}{2}(u_L + u_R)$\n此公式将用于计算每个测试用例的精确速度并计算误差 $\\varepsilon$。\n\n**2. 数值格式与时间演化**\n将实现一个通用函数，用于对给定数值格式执行从 $t=0$ 到 $t=T$ 的时间步进。\n\n*   **守恒格式 (Lax–Friedrichs):** 该格式通过更新基于跨越单元边界的净通量的单元平均值来工作。其更新公式为 $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n)$。局部Lax-Friedrichs (Rusanov) 数值通量引入了与局部波速成比例的数值耗散以维持稳定性。\n\n*   **非守恒格式 (迎风):** 该格式离散了伯格斯方程的非守恒（对流）形式 $u_t + u u_x = 0$。空间导数 $u_x$ 使用一阶迎风差分来近似，其中差分的方向取决于局部对流速度 $u_i$ 的符号。该格式不是守恒形式，因此预计它会产生以不正确速度传播的激波。\n\n**3. 激波速度分析**\n将解演化到最终时间 $T$ 后，通过在解穿过中点值 $u_{\\mathrm{mid}} = (u_L+u_R)/2$ 的点进行线性插值来识别数值激波位置 $x_{\\mathrm{shock}}$。然后，数值激波速度为 $s_{\\mathrm{num}} = x_{\\mathrm{shock}} / T$。最后，每种格式的误差计算为 $\\varepsilon = |s_{\\mathrm{num}} - s_{\\mathrm{RH}}|$。\n\n实现将处理每个测试用例，运行两种格式，计算它们各自的速度误差，并按规定格式化结果。这种比较分析预计将展示守恒格式在激波捕捉问题中的卓越准确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It implements both a conservative and a nonconservative scheme for\n    the inviscid Burgers' equation and compares their shock speed prediction.\n    \"\"\"\n\n    def solve_case(u_L, u_R, T, N, CFL):\n        \"\"\"\n        Solves a single test case for both schemes.\n        \n        Returns:\n            A list containing the speed errors [err_cons, err_noncons].\n        \"\"\"\n        # --- Grid and Initial Conditions ---\n        L_domain = 2.0\n        dx = L_domain / N\n        x = np.linspace(-1 + dx / 2, 1 - dx / 2, N)\n        u0 = np.where(x = 0, u_L, u_R)\n\n        # --- Exact Shock Speed (Rankine-Hugoniot) ---\n        s_rh = 0.5 * (u_L + u_R)\n        \n        # --- Function to run a simulation for a given scheme ---\n        def run_simulation(scheme_type):\n            u = u0.copy()\n            t = 0.0\n\n            while t  T:\n                # Calculate time step via CFL condition\n                max_u_abs = np.max(np.abs(u))\n                # Prevent division by zero if solution is identically zero\n                if max_u_abs  1e-12:\n                    max_u_abs = 1e-12\n                \n                dt = CFL * dx / max_u_abs\n                \n                # Ensure we stop exactly at time T\n                if t + dt > T:\n                    dt = T - t\n\n                if scheme_type == 'conservative':\n                    # Pad solution vector with ghost cells for boundary conditions\n                    u_padded = np.concatenate(([u_L], u, [u_R]))\n                    \n                    # Rusanov (Local Lax-Friedrichs) flux\n                    u_left = u_padded[:-1]\n                    u_right = u_padded[1:]\n                    \n                    flux_phys_left = 0.5 * u_left**2\n                    flux_phys_right = 0.5 * u_right**2\n                    \n                    alpha = np.maximum(np.abs(u_left), np.abs(u_right))\n                    \n                    flux_num = 0.5 * (flux_phys_left + flux_phys_right) - 0.5 * alpha * (u_right - u_left)\n                    \n                    # Update cell averages\n                    u = u - (dt / dx) * (flux_num[1:] - flux_num[:-1])\n\n                elif scheme_type == 'nonconservative':\n                    u_old = u.copy()\n                    u_new = u.copy()\n\n                    # Pad with ghost cells for difference calculation\n                    u_padded = np.concatenate(([u_L], u_old, [u_R]))\n                    \n                    u_backward_diff = u_padded[1:-1] - u_padded[0:-2]\n                    u_forward_diff = u_padded[2:] - u_padded[1:-1]\n\n                    u_p = np.maximum(u_old, 0)\n                    u_n = np.minimum(u_old, 0)\n                    \n                    spatial_term = u_p * u_backward_diff + u_n * u_forward_diff\n                    u_new = u_old - (dt/dx) * spatial_term\n                    \n                    # Re-impose Dirichlet BC on boundary cells as specified\n                    u_new[0] = u_L\n                    u_new[N-1] = u_R\n                    u = u_new\n\n                t += dt\n            \n            return u\n\n        # --- Run simulations and calculate errors ---\n        errors = []\n        for scheme in ['conservative', 'nonconservative']:\n            u_final = run_simulation(scheme)\n            \n            u_mid = 0.5 * (u_L + u_R)\n            \n            # Find shock location by finding where solution crosses u_mid\n            crossings = np.where((u_final[:-1] - u_mid) * (u_final[1:] - u_mid) = 0)[0]\n            \n            if len(crossings) > 0:\n                i_shock = crossings[0]\n                \n                u_i = u_final[i_shock]\n                u_ip1 = u_final[i_shock + 1]\n                x_i = x[i_shock]\n                \n                denominator = u_ip1 - u_i\n                if abs(denominator)  1e-12:\n                    x_shock = x_i + 0.5 * dx \n                else: \n                    x_shock = x_i + dx * (u_mid - u_i) / denominator\n            else:\n                x_shock = np.nan\n\n            if np.isnan(x_shock):\n                error = np.nan\n            else:\n                s_num = x_shock / T\n                error = abs(s_num - s_rh)\n            errors.append(error)\n            \n        return errors\n\n    # --- Test Suite ---\n    test_cases = [\n        # (u_L, u_R, T, N, CFL)\n        (2.0, 0.0, 0.30, 800, 0.45),\n        (1.0, -1.0, 0.30, 800, 0.45),\n        (1.0, 0.5, 0.20, 800, 0.45),\n    ]\n\n    results = []\n    for params in test_cases:\n        errors = solve_case(*params)\n        results.append(errors)\n\n    # --- Final Output Formatting ---\n    formatted_pairs = [f\"[{e_c},{e_n}]\" for e_c, e_n in results]\n    print(f\"[{','.join(formatted_pairs)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "将我们在一维问题中建立的理解扩展到高维情况。算子分裂法是一种高效处理多维方程的常用策略，它将复杂问题分解为一系列更简单的一维问题进行求解。本练习聚焦于分析这种分裂过程所引入的误差，该误差源于空间微分算子的不可交换性，通过计算其对易子来量化这一误差是理解分裂法精度的关键。",
            "id": "3393023",
            "problem": "考虑在单位正方形上带有周期性边界条件的线性一阶双曲偏微分方程 $u_{t} + a(x,y)\\,u_{x} + b(x,y)\\,u_{y} = 0$，其中 $a(x,y) = 1 + x\\,y$ 且 $b(x,y) = 1 + x^{2}$。初始条件为 $u(x,y,0) = \\sin(\\pi x)\\,\\cos(\\pi y)$。设对每个坐标方向的空间导数使用逐维一阶迎风有限差分格式进行离散化，其中平流速度的局部符号决定了迎风方向。因为在定义域上 $a(x,y) \\geq 1$ 且 $b(x,y) \\geq 1$，所以在所有网格点上均在两个方向上采用后向差分。定义作用于网格函数 $u_{i,j}$ 上的半离散算子 $L_{x}^{\\Delta}$ 和 $L_{y}^{\\Delta}$ 为 $L_{x}^{\\Delta} u_{i,j} = -a_{i,j}\\,\\frac{u_{i,j} - u_{i-1,j}}{\\Delta x}$ 和 $L_{y}^{\\Delta} u_{i,j} = -b_{i,j}\\,\\frac{u_{i,j} - u_{i,j-1}}{\\Delta y}$，其中 $(x_{i},y_{j})$ 是间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀网格点。\n\n在一个时间步长 $\\Delta t$ 内的李(Lie)方向分裂更新，先应用 $x$ 方向平流更新，然后应用 $y$ 方向平流更新。使用泰勒展开和对 $u$ 的光滑性假设，用分裂的半离散算子的对易子来刻画该分裂引入的主阶局部误差。在连续极限 $\\Delta x,\\Delta y \\to 0$ 下，对于给定的 $a(x,y)$、$b(x,y)$ 和 $u(x,y,0)$，计算在点 $(x_{*},y_{*}) = \\left(\\frac{1}{2},\\frac{1}{2}\\right)$ 处的显式对易子误差项，表示为局部误差中乘以 $\\Delta t^{2}$ 的系数。将你的最终答案以一个依赖于 $\\pi$ 和 $\\Delta t$ 的单一闭式解析表达式的形式给出。\n\n此外，利用你推导的表达式，解释流场 $(a,b)$ 的哪些结构特性导致分裂误差的抵消或放大，但不要将此解释部分包含在你的最终答案中。无需四舍五入，也无需物理单位。",
            "solution": "该问题的半离散形式可写为 $\\frac{d\\vec{u}}{dt} = (L_x^\\Delta + L_y^\\Delta) \\vec{u}$。在一个时间步长 $\\Delta t$ 内的精确解由 $\\vec{u}(t_0+\\Delta t) = \\exp(\\Delta t(L_x^\\Delta + L_y^\\Delta))\\vec{u}(t_0)$ 给出。\n\n李(Lie)方向分裂通过顺序应用算子来近似此演化过程：先应用 $x$ 方向平流，再应用 $y$ 方向平流。这对应于算子 $\\exp(\\Delta t L_y^\\Delta) \\exp(\\Delta t L_x^\\Delta)$。\n\n为了刻画局部误差，我们将精确解和近似解的算子进行关于 $\\Delta t$ 的泰勒级数展开。\n精确算子：\n$$ \\exp(\\Delta t(L_x^\\Delta + L_y^\\Delta)) = I + \\Delta t(L_x^\\Delta + L_y^\\Delta) + \\frac{\\Delta t^2}{2}((L_x^\\Delta)^2 + L_x^\\Delta L_y^\\Delta + L_y^\\Delta L_x^\\Delta + (L_y^\\Delta)^2) + \\mathcal{O}(\\Delta t^3) $$\n近似分裂算子：\n$$ \\exp(\\Delta t L_y^\\Delta) \\exp(\\Delta t L_x^\\Delta) = \\left( I + \\Delta t L_y^\\Delta + \\frac{\\Delta t^2}{2}(L_y^\\Delta)^2 + \\dots \\right) \\left( I + \\Delta t L_x^\\Delta + \\frac{\\Delta t^2}{2}(L_x^\\Delta)^2 + \\dots \\right) $$\n$$ = I + \\Delta t L_x^\\Delta + \\Delta t L_y^\\Delta + \\Delta t^2 L_y^\\Delta L_x^\\Delta + \\frac{\\Delta t^2}{2}((L_x^\\Delta)^2 + (L_y^\\Delta)^2) + \\mathcal{O}(\\Delta t^3) $$\n局部截断误差是近似解与精确解之差，其主阶项为：\n$$ \\text{Error} = (\\text{Approx}) - (\\text{Exact}) = \\frac{\\Delta t^2}{2} (L_y^\\Delta L_x^\\Delta - L_x^\\Delta L_y^\\Delta) + \\mathcal{O}(\\Delta t^3) = -\\frac{\\Delta t^2}{2} [L_x^\\Delta, L_y^\\Delta] + \\mathcal{O}(\\Delta t^3) $$\n在连续极限下，半离散算子 $L_x^\\Delta$ 和 $L_y^\\Delta$ 收敛于微分算子 $L_x = -a \\frac{\\partial}{\\partial x}$ 和 $L_y = -b \\frac{\\partial}{\\partial y}$。离散算子的对易子收敛于微分算子的对易子：\n$$ [L_x, L_y]u = (L_x L_y - L_y L_x)u = (a b_x u_y - b a_y u_x) $$\n因此，主阶局部误差项是 $-\\frac{\\Delta t^2}{2} (a b_x u_y - b a_y u_x)$。\n\n现在我们在点 $(x_{*}, y_{*}) = (\\frac{1}{2}, \\frac{1}{2})$ 处，使用初始条件 $u(x,y,0) = \\sin(\\pi x)\\cos(\\pi y)$ 计算此项的值。\n所需的各分量为：\n-   $a(x,y) = 1 + xy \\implies a(\\frac{1}{2}, \\frac{1}{2}) = \\frac{5}{4}$\n-   $b(x,y) = 1 + x^2 \\implies b(\\frac{1}{2}, \\frac{1}{2}) = \\frac{5}{4}$\n-   $a_y = x \\implies a_y(\\frac{1}{2}, \\frac{1}{2}) = \\frac{1}{2}$\n-   $b_x = 2x \\implies b_x(\\frac{1}{2}, \\frac{1}{2}) = 1$\n-   $u_x = \\pi \\cos(\\pi x)\\cos(\\pi y) \\implies u_x(\\frac{1}{2}, \\frac{1}{2}, 0) = \\pi \\cos(\\frac{\\pi}{2})\\cos(\\frac{\\pi}{2}) = 0$\n-   $u_y = -\\pi \\sin(\\pi x)\\sin(\\pi y) \\implies u_y(\\frac{1}{2}, \\frac{1}{2}, 0) = -\\pi \\sin(\\frac{\\pi}{2})\\sin(\\frac{\\pi}{2}) = -\\pi$\n\n将这些值代入误差表达式中：\n$$\n\\text{误差项} = -\\frac{\\Delta t^2}{2} \\left[ a(x_*,y_*) b_x(x_*,y_*) u_y(x_*,y_*,0) - b(x_*,y_*) a_y(x_*,y_*) u_x(x_*,y_*,0) \\right]\n$$\n$$\n= -\\frac{\\Delta t^2}{2} \\left[ \\left(\\frac{5}{4}\\right)(1)(-\\pi) - \\left(\\frac{5}{4}\\right)\\left(\\frac{1}{2}\\right)(0) \\right]\n$$\n$$\n= -\\frac{\\Delta t^2}{2} \\left[ -\\frac{5\\pi}{4} \\right] = \\frac{5\\pi}{8}\\Delta t^2\n$$\n这就是在指定点的主阶局部误差的最终解析表达式。",
            "answer": "$$\n\\boxed{\\frac{5\\pi}{8}\\Delta t^{2}}\n$$"
        }
    ]
}