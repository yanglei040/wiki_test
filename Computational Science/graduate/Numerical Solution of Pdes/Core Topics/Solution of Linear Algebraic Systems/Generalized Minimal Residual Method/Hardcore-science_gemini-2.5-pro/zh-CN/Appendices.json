{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握像 GMRES 这样的迭代算法，没有比在一个小规模问题上亲手进行计算更好的方法了。本练习将引导您对一个简单的 $2 \\times 2$ 系统执行 GMRES 的前两次迭代，从而揭开该方法的神秘面纱。通过手动执行 Arnoldi 过程并求解得到的最小二乘问题，您将对克雷洛夫子空间 (Krylov subspace) 的构建以及每一步中残差最小化的过程建立起具体的理解 。",
            "id": "3237128",
            "problem": "考虑线性系统 $A x = b$，其中\n$$A = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}, \\quad b = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}。$$\n从初始猜测 $x_0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 开始，使用标准的欧几里得内积，执行广义最小残差（GMRES）方法，进行 $k = 1$ 和 $k = 2$ 次迭代，不使用预处理。\n\n仅使用以下基本特性：在第 $k$ 次迭代时，GMRES 在 $x_0 + \\mathcal{K}_k(A, r_0)$ 中选择 $x_k$，其中 $\\mathcal{K}_k(A, r_0)$ 是由 $A$ 和 $r_0 = b - A x_0$ 生成的第 $k$ 个Krylov子空间，以最小化残差 $r_k = b - A x_k$ 的欧几里得范数。通过 Arnoldi 过程构建Krylov子空间的必要标准正交基，并根据投影问题的最小二乘残差最小化的第一性原理，精确计算前两个GMRES迭代解 $x_1$ 和 $x_2$。\n\n将您的最终答案表示为单个行矩阵 $\\begin{pmatrix} x_{1,1}  x_{1,2}  x_{2,1}  x_{2,2} \\end{pmatrix}$，其元素为精确的有理数。不需要四舍五入。",
            "solution": "问题是要求对线性系统 $Ax=b$ 执行广义最小残差（GMRES）方法的前两次迭代（$k=1$ 和 $k=2$），从零初始猜测开始。该问题定义明确，所有必要数据均已提供。\n\n给定的系统定义如下：\n$$A = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}, \\quad b = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad x_0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$$\n\nGMRES方法在第 $k$ 次迭代时构造一个形式为 $x_k = x_0 + z_k$ 的近似解，其中 $z_k$ 从第 $k$ 个Krylov子空间 $\\mathcal{K}_k(A, r_0) = \\text{span}\\{r_0, Ar_0, \\dots, A^{k-1}r_0\\}$ 中选取。向量 $z_k$ 的选择是为了最小化残差 $r_k = b - Ax_k$ 的欧几里得范数。\n\n首先，我们计算初始残差 $r_0$：\n$$r_0 = b - A x_0 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$$\n\nArnoldi 过程用于为Krylov子空间 $\\mathcal{K}_k(A, r_0)$ 生成一个标准正交基 $V_k = [v_1, v_2, \\dots, v_k]$。该过程从标准化初始残差开始。令 $\\beta = \\|r_0\\|_2$。\n$$\\beta = \\left\\| \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\right\\|_2 = \\sqrt{1^2 + 0^2} = 1$$\n第一个基向量 $v_1$ 是：\n$$v_1 = \\frac{r_0}{\\beta} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$$\n\n在第 $k$ 次迭代时，我们寻找 $x_k = x_0 + V_k y_k$，对于某个向量 $y_k \\in \\mathbb{R}^k$，它最小化 $\\|b - A(x_0 + V_k y_k)\\|_2 = \\|r_0 - A V_k y_k\\|_2$。\n根据 Arnoldi 过程，我们有关系式 $A V_k = V_{k+1} \\bar{H}_k$，其中 $\\bar{H}_k$ 是一个 $(k+1) \\times k$ 的上海森堡矩阵（upper Hessenberg matrix）。\n将此代入最小化问题，并使用 $r_0 = \\beta v_1 = \\beta V_{k+1} e_1$（其中 $e_1$ 是 $\\mathbb{R}^{k+1}$ 中的第一个标准基向量），我们得到：\n$$\\| \\beta V_{k+1} e_1 - V_{k+1} \\bar{H}_k y_k \\|_2 = \\| V_{k+1} (\\beta e_1 - \\bar{H}_k y_k) \\|_2$$\n由于 $V_{k+1}$ 具有标准正交列，这简化为求解以下最小二乘问题的 $y_k$：\n$$y_k = \\arg\\min_{y \\in \\mathbb{R}^k} \\| \\beta e_1 - \\bar{H}_k y \\|_2$$\n\n**迭代 $k=1$**\n\n我们首先执行一步 Arnoldi 迭代来找到 $v_2$ 和矩阵 $\\bar{H}_1$。\n计算 $w_1 = A v_1$：\n$$w_1 = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}$$\n元素 $h_{1,1}$ 是 $w_1$ 在 $v_1$ 上的投影：\n$$h_{1,1} = v_1^T w_1 = \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} = 2$$\n下一个未归一化的向量是 $\\tilde{w}_1 = w_1 - h_{1,1}v_1$：\n$$\\tilde{w}_1 = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$$\n其范数为 $h_{2,1} = \\|\\tilde{w}_1\\|_2 = \\sqrt{0^2+1^2} = 1$。\n第二个基向量是 $v_2 = \\tilde{w}_1 / h_{2,1}$：\n$$v_2 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$$\n矩阵 $\\bar{H}_1$ 是一个 $2 \\times 1$ 的矩阵：\n$$\\bar{H}_1 = \\begin{pmatrix} h_{1,1} \\\\ h_{2,1} \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}$$\n我们现在求解 $y_1 \\in \\mathbb{R}$ 的最小二乘问题：\n$$y_1 = \\arg\\min_{y \\in \\mathbb{R}} \\left\\| \\beta e_1 - \\bar{H}_1 y \\right\\|_2 = \\arg\\min_{y_1 \\in \\mathbb{R}} \\left\\| \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} y_1 \\right\\|_2$$\n解由正规方程 $(\\bar{H}_1^T \\bar{H}_1) y_1 = \\bar{H}_1^T (\\beta e_1)$ 给出。\n$$\\bar{H}_1^T \\bar{H}_1 = \\begin{pmatrix} 2  1 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} = 2^2 + 1^2 = 5$$\n$$\\bar{H}_1^T (\\beta e_1) = \\begin{pmatrix} 2  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = 2$$\n因此，$5 y_1 = 2$，这得到 $y_1 = \\frac{2}{5}$。\n第一个GMRES迭代解 $x_1$ 是：\n$$x_1 = x_0 + V_1 y_1 = x_0 + v_1 y_1 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\frac{2}{5} = \\begin{pmatrix} \\frac{2}{5} \\\\ 0 \\end{pmatrix}$$\n\n**迭代 $k=2$**\n\n我们继续 Arnoldi 过程以找到 $\\bar{H}_2$ 的第二列。\n计算 $w_2 = A v_2$：\n$$w_2 = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$$\n元素 $h_{1,2}$ 和 $h_{2,2}$ 是 $w_2$ 在 $v_1$ 和 $v_2$ 上的投影：\n$$h_{1,2} = v_1^T w_2 = \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = 1$$\n$$h_{2,2} = v_2^T w_2 = \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = 2$$\n下一个未归一化的向量 $\\tilde{w}_2$ 是：\n$$\\tilde{w}_2 = w_2 - h_{1,2} v_1 - h_{2,2} v_2 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$$\n其范数为 $h_{3,2} = \\|\\tilde{w}_2\\|_2 = 0$。这表明Krylov子空间 $\\mathcal{K}_2(A, r_0)$ 在 $A$ 下是不变的，Arnoldi过程终止。对于一个 $2 \\times 2$ 的系统，这意味着 GMRES(2) 将找到精确解。\n矩阵 $\\bar{H}_2$ 是一个 $3 \\times 2$ 的矩阵：\n$$\\bar{H}_2 = \\begin{pmatrix} h_{1,1}  h_{1,2} \\\\ h_{2,1}  h_{2,2} \\\\ 0  h_{3,2} \\end{pmatrix} = \\begin{pmatrix} 2  1 \\\\ 1  2 \\\\ 0  0 \\end{pmatrix}$$\n我们求解 $y_2 = \\begin{pmatrix} y_{2,1} \\\\ y_{2,2} \\end{pmatrix} \\in \\mathbb{R}^2$ 的最小二乘问题：\n$$y_2 = \\arg\\min_{y \\in \\mathbb{R}^2} \\| \\beta e_1 - \\bar{H}_2 y \\|_2 = \\arg\\min_{y_2 \\in \\mathbb{R}^2} \\left\\| \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2  1 \\\\ 1  2 \\\\ 0  0 \\end{pmatrix} y_2 \\right\\|_2$$\n由于 $\\bar{H}_2$ 的最后一行是零，如果我们能精确求解上面的 $2 \\times 2$ 系统，这个问题的残差将为零。我们需要求解 $H_2 y_2 = \\beta e_1^{(2)}$，其中 $H_2$ 是 $\\bar{H}_2$ 的上面 $2 \\times 2$ 部分，而 $e_1^{(2)}$ 是 $\\mathbb{R}^2$ 中的第一个标准基向量。\n$$\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} \\begin{pmatrix} y_{2,1} \\\\ y_{2,2} \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$$\n根据第二个方程，$y_{2,1} + 2y_{2,2} = 0$，所以 $y_{2,1} = -2y_{2,2}$。\n代入第一个方程：$2(-2y_{2,2}) + y_{2,2} = 1$，化简得 $-3y_{2,2} = 1$，所以 $y_{2,2} = -\\frac{1}{3}$。\n这得到 $y_{2,1} = -2(-\\frac{1}{3}) = \\frac{2}{3}$。\n因此，系数向量是 $y_2 = \\begin{pmatrix} \\frac{2}{3} \\\\ -\\frac{1}{3} \\end{pmatrix}$。\n第二个GMRES迭代解 $x_2$ 是：\n$$x_2 = x_0 + V_2 y_2 = x_0 + v_1 y_{2,1} + v_2 y_{2,2} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\frac{2}{3} + \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} \\left(-\\frac{1}{3}\\right) = \\begin{pmatrix} \\frac{2}{3} \\\\ -\\frac{1}{3} \\end{pmatrix}$$\n正如预期的那样，$x_2$ 是系统 $Ax=b$ 的精确解。\n\n计算出的迭代解是 $x_1 = \\begin{pmatrix} \\frac{2}{5} \\\\ 0 \\end{pmatrix}$ 和 $x_2 = \\begin{pmatrix} \\frac{2}{3} \\\\ -\\frac{1}{3} \\end{pmatrix}$。所要求的分量是 $x_{1,1} = \\frac{2}{5}$，$x_{1,2} = 0$，$x_{2,1} = \\frac{2}{3}$ 和 $x_{2,2} = -\\frac{1}{3}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2}{5}  0  \\frac{2}{3}  -\\frac{1}{3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "GMRES 的一个关键特性是它能够在每次迭代中监控收敛情况，而无需显式计算解向量 $x_k$。这是通过高效更新残差范数来实现的。本练习  聚焦于这一核心机制，要求您使用吉文斯旋转 (Givens rotations)——一种将零引入矩阵的标准数值线性代数工具——来推导单步迭代后更新的残差范数的表达式。",
            "id": "3399084",
            "problem": "考虑将广义最小残差方法（GMRES, Generalized Minimal Residual）应用于一个线性系统，该系统由方形域上具有狄利克雷边界条件的稳态线性对流扩散偏微分方程的稳定有限体积离散化产生。设离散系统为 $A x = b$，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是一个大型、稀疏且非对称的矩阵。GMRES 通过阿诺尔迪过程构建克里洛夫子空间。从初始猜测值 $x_0$ 开始，经过一个阿诺尔迪步骤后，该方法产生标准正交向量 $V_2 \\in \\mathbb{R}^{n \\times 2}$ 和 $2 \\times 1$ 的上海森堡列\n$$\n\\bar{H}_1 \\;=\\; \\begin{bmatrix} h_{1,1} \\\\ h_{2,1} \\end{bmatrix},\n$$\n其中初始残差范数为 $\\beta = \\|r_0\\|_2 = \\|b - A x_0\\|_2$。GMRES 通过应用带有参数 $c_1$ 和 $s_1$ 的单个正交吉文斯旋转 $G_1 \\in \\mathbb{R}^{2 \\times 2}$ 来计算最小二乘问题 $\\min_{y \\in \\mathbb{R}} \\|\\beta e_1 - \\bar{H}_1 y\\|_2$ 的最小化子，该旋转将元素 $h_{2,1}$ 置为零，即\n$$\nG_1 \\;=\\; \\begin{bmatrix} c_1  s_1 \\\\ -s_1  c_1 \\end{bmatrix}, \\quad c_1^2 + s_1^2 = 1, \\quad G_1 \\begin{bmatrix} h_{1,1} \\\\ h_{2,1} \\end{bmatrix} \\;=\\; \\begin{bmatrix} \\rho_1 \\\\ 0 \\end{bmatrix},\n$$\n其中 $\\rho_1 \\in \\mathbb{R}$ 被选为非负。\n\n仅使用 GMRES 的基础框架（阿诺尔迪分解和通过正交变换进行的残差最小二乘最小化）以及吉文斯旋转的定义性质，推导在此单次旋转后，更新后的残差范数的闭式解析表达式，该表达式应以 $\\beta$、$h_{1,1}$ 和 $h_{2,1}$ 表示。你的最终答案必须是单个解析表达式，并且不应需要任何舍入。",
            "solution": "问题陈述已经过验证，被认为是具有科学依据、适定且客观的。它代表了在求解线性系统的广义最小残差（GMRES）方法背景下的一个标准推导。所有提供的信息都是一致且充分的，足以推导出所要求的表达式。\n\n目标是推导 GMRES 算法一步之后残差向量范数的表达式。GMRES 方法寻求一个形式为 $x_1 = x_0 + z_0$ 的近似解 $x_1$，其中 $z_0$ 位于第一个克里洛夫子空间 $\\mathcal{K}_1(A, r_0) = \\text{span}\\{r_0\\}$ 中。该子空间的一个更方便的基是单个标准正交向量 $v_1 = r_0 / \\|r_0\\|_2 = r_0 / \\beta$。因此，$x_1 = x_0 + y_1 v_1$，其中某个标量系数 $y_1 \\in \\mathbb{R}$ 最小化新残差 $r_1 = b - A x_1$ 的范数。\n\n残差 $r_1$ 可以用初始残差 $r_0$ 表示：\n$$\nr_1 = b - A(x_0 + y_1 v_1) = (b - A x_0) - y_1 A v_1 = r_0 - y_1 A v_1\n$$\n使用 $r_0 = \\beta v_1$，这变为：\n$$\nr_1 = \\beta v_1 - y_1 A v_1\n$$\n阿诺尔迪过程为克里洛夫子空间 $\\mathcal{K}_{m+1}(A, r_0)$ 构建一个标准正交基 $V_{m+1} = [v_1, \\dots, v_{m+1}]$ 和一个相应的上海森堡矩阵 $\\bar{H}_m$，使得关系式 $A V_m = V_{m+1} \\bar{H}_m$ 成立。对于第一步（$m=1$），我们有 $V_1 = [v_1]$，$V_2 = [v_1, v_2]$ 和 $\\bar{H}_1 \\in \\mathbb{R}^{2 \\times 1}$。关系式为 $A v_1 = V_2 \\bar{H}_1$。问题陈述提供了 $\\bar{H}_1 = \\begin{bmatrix} h_{1,1} \\\\ h_{2,1} \\end{bmatrix}$。\n\n将 $A v_1 = V_2 \\bar{H}_1$ 代入 $r_1$ 的表达式中：\n$$\nr_1 = \\beta v_1 - y_1 (V_2 \\bar{H}_1)\n$$\n向量 $v_1$ 可以写成 $V_2 e_1$，其中 $e_1 = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix} \\in \\mathbb{R}^2$。这得到：\n$$\nr_1 = \\beta V_2 e_1 - y_1 V_2 \\bar{H}_1 = V_2 (\\beta e_1 - y_1 \\bar{H}_1)\n$$\n我们需要求这个残差的范数 $\\|r_1\\|_2$。由于 $V_2$ 的列是标准正交的，乘以 $V_2$ 是一个等距变换，保持欧几里得范数不变。因此：\n$$\n\\|r_1\\|_2 = \\|V_2 (\\beta e_1 - y_1 \\bar{H}_1)\\|_2 = \\|\\beta e_1 - y_1 \\bar{H}_1\\|_2\n$$\nGMRES 找到标量 $y_1$（在问题中记为 $y$）来最小化这个范数。更新后的残差的范数就是这个最小值：\n$$\n\\|r_1\\|_2 = \\min_{y \\in \\mathbb{R}} \\|\\beta e_1 - \\bar{H}_1 y\\|_2\n$$\n让我们明确地写出范数内的向量：\n$$\n\\beta e_1 - \\bar{H}_1 y = \\beta \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix} - y \\begin{bmatrix} h_{1,1} \\\\ h_{2,1} \\end{bmatrix} = \\begin{bmatrix} \\beta - y h_{1,1} \\\\ -y h_{2,1} \\end{bmatrix}\n$$\n问题陈述指出，这个最小二乘问题通过应用一个吉文斯旋转 $G_1 = \\begin{bmatrix} c_1  s_1 \\\\ -s_1  c_1 \\end{bmatrix}$ 来解决。由于 $G_1$ 是一个正交矩阵，它也保持欧几里得范数不变。因此：\n$$\n\\|\\beta e_1 - \\bar{H}_1 y\\|_2 = \\|G_1 (\\beta e_1 - \\bar{H}_1 y)\\|_2 = \\|\\beta G_1 e_1 - y G_1 \\bar{H}_1\\|_2\n$$\n我们计算变换后的分量。问题陈述指出 $G_1$ 被构造用来消去 $\\bar{H}_1$ 的次对角线元素：\n$$\nG_1 \\bar{H}_1 = G_1 \\begin{bmatrix} h_{1,1} \\\\ h_{2,1} \\end{bmatrix} = \\begin{bmatrix} \\rho_1 \\\\ 0 \\end{bmatrix}\n$$\n变换后的右侧向量是：\n$$\n\\beta G_1 e_1 = \\beta \\begin{bmatrix} c_1  s_1 \\\\ -s_1  c_1 \\end{bmatrix} \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix} = \\beta \\begin{bmatrix} c_1 \\\\ -s_1 \\end{bmatrix}\n$$\n将这些代入范数表达式中：\n$$\n\\|r_1\\|_2 = \\min_{y \\in \\mathbb{R}} \\left\\| \\beta \\begin{bmatrix} c_1 \\\\ -s_1 \\end{bmatrix} - y \\begin{bmatrix} \\rho_1 \\\\ 0 \\end{bmatrix} \\right\\|_2 = \\min_{y \\in \\mathbb{R}} \\left\\| \\begin{bmatrix} \\beta c_1 - y \\rho_1 \\\\ -\\beta s_1 \\end{bmatrix} \\right\\|_2\n$$\n范数的平方是 $(\\beta c_1 - y \\rho_1)^2 + (-\\beta s_1)^2$。为了对 $y$ 最小化该式，我们将包含 $y$ 的项设为零。这在 $y \\rho_1 = \\beta c_1$ 时发生。于是，范数平方的最小值是 $(0)^2 + (-\\beta s_1)^2 = \\beta^2 s_1^2$。\n更新后的残差范数是这个最小值的平方根：\n$$\n\\|r_1\\|_2 = \\sqrt{\\beta^2 s_1^2} = |\\beta s_1|\n$$\n由于 $\\beta = \\|r_0\\|_2$ 是一个范数，它是非负的，所以 $\\|r_1\\|_2 = \\beta |s_1|$。\n\n最后一步是找到用 $h_{1,1}$ 和 $h_{2,1}$ 表示 $|s_1|$ 的表达式。吉文斯旋转的定义给出了方程组：\n$$\n\\begin{cases}\nc_1 h_{1,1} + s_1 h_{2,1} = \\rho_1 \\\\\n-s_1 h_{1,1} + c_1 h_{2,1} = 0\n\\end{cases}\n$$\n以及性质 $c_1^2 + s_1^2 = 1$。从第二个方程，我们得到 $c_1 h_{2,1} = s_1 h_{1,1}$。对其平方可得 $c_1^2 h_{2,1}^2 = s_1^2 h_{1,1}^2$。代入 $c_1^2 = 1 - s_1^2$：\n$$\n(1 - s_1^2) h_{2,1}^2 = s_1^2 h_{1,1}^2\n$$\n$$\nh_{2,1}^2 - s_1^2 h_{2,1}^2 = s_1^2 h_{1,1}^2\n$$\n$$\nh_{2,1}^2 = s_1^2 (h_{1,1}^2 + h_{2,1}^2)\n$$\n求解 $s_1^2$ 可得：\n$$\ns_1^2 = \\frac{h_{2,1}^2}{h_{1,1}^2 + h_{2,1}^2}\n$$\n取平方根可得 $s_1$ 的量值：\n$$\n|s_1| = \\sqrt{\\frac{h_{2,1}^2}{h_{1,1}^2 + h_{2,1}^2}} = \\frac{|h_{2,1}|}{\\sqrt{h_{1,1}^2 + h_{2,1}^2}}\n$$\n这个表达式是充分的，因为问题不要求确定 $s_1$ 的符号。问题陈述中的条件 $\\rho_1 \\ge 0$ 用于唯一地定义吉文斯参数 $c_1$ 和 $s_1$，但这里只需要它们的量值。\n\n最后，将 $|s_1|$ 的表达式代入残差范数的公式中：\n$$\n\\|r_1\\|_2 = \\beta |s_1| = \\beta \\frac{|h_{2,1}|}{\\sqrt{h_{1,1}^2 + h_{2,1}^2}}\n$$\n这就是 GMRES 一步之后更新后的残差范数的闭式解析表达式，用给定的量 $\\beta$、$h_{1,1}$ 和 $h_{2,1}$ 表示。",
            "answer": "$$\n\\boxed{\\beta \\frac{|h_{2,1}|}{\\sqrt{h_{1,1}^{2} + h_{2,1}^{2}}}}\n$$"
        },
        {
            "introduction": "虽然完整 GMRES 在精确算术下保证在至多 $n$ 步内收敛，但其每次迭代的内存和计算成本不断增长，使其对于大型系统不切实际。常见的解决方案是重启动的 GMRES，即 GMRES($m$)，但这引入了一个新挑战：停滞 (stagnation)。这项高级练习  要求您构造一个特定的矩阵来展示这种病态行为，即重启动的 GMRES 无法取得进展，并通过理论分析和编程实现来验证这一现象。",
            "id": "3399033",
            "problem": "设 $A \\in \\mathbb{R}^{4 \\times 4}$ 为一个非奇异矩阵，考虑使用广义最小残差法 (GMRES) 和初始猜测 $x_0$ 来求解线性系统 $A x = b$。广义最小残差法 (GMRES) 在仿射空间 $x_0 + \\mathcal{K}_k(A, r_0)$ 中构造第 $k$ 个近似解 $x_k$，其中 $\\mathcal{K}_k(A, r_0) = \\operatorname{span}\\{r_0, A r_0, A^2 r_0, \\dots, A^{k-1} r_0\\}$ 表示 $k$ 步 Krylov 子空间，而 $r_0 = b - A x_0$ 是初始残差。GMRES 使用 Arnoldi 过程为 $\\mathcal{K}_k(A, r_0)$ 构造一个标准正交基 $V_k = [v_1, \\dots, v_k]$，以及一个满足 $A V_k = V_{k+1} H_k$ 的上 Hessenberg 矩阵 $H_k \\in \\mathbb{R}^{(k+1)\\times k}$。然后，通过最小化欧几里得范数 $\\| \\beta e_1 - H_k y \\|_2$ 来确定校正量 $y_k \\in \\mathbb{R}^k$，其中 $\\beta = \\| r_0 \\|_2$，而 $e_1 \\in \\mathbb{R}^{k+1}$ 是第一个标准基向量。\n\n一种重启变体 GMRES($m$) 执行 $m$ 步，更新迭代解，然后用新的残差重启 Arnoldi 过程，并在多个循环中重复此程序。众所周知，不利的重启行为可能导致停滞，即即使完全 GMRES 会收敛，残差范数在多个循环中也不再减小。\n\n构造一个特定的 $4 \\times 4$ 矩阵 $A$ 和初始残差 $r_0$，使得完全 GMRES 在 $4$ 步内收敛，但 GMRES($2$) 因不利的重启行为而在多个循环中停滞。使用以下带有参数 $\\alpha, \\beta, \\gamma \\in \\mathbb{R}$ 的构造来构建矩阵 $A$：\n$$\nA(\\alpha,\\beta,\\gamma) = \\begin{bmatrix}\n0  0  \\alpha  0 \\\\\n1  0  0  0 \\\\\n0  1  0  0 \\\\\n0  0  \\gamma  \\beta\n\\end{bmatrix},\n$$\n并取 $r_0 = e_1 = [1,0,0,0]^\\top$，$x_0 = 0$ 且 $b = r_0$。当 $\\alpha \\neq 0$ 且 $\\beta \\neq 0$ 时，该矩阵 $A$ 是非奇异的。\n\n从 Krylov 子空间的基本定义和 Arnoldi 关系 $A V_k = V_{k+1} H_k$ 出发，推导使 $H_2$ 的第一行变为零的条件，这会导致 GMRES($2$) 在最小二乘问题 $\\min_{y\\in\\mathbb{R}^2} \\|\\beta e_1 - H_2 y\\|_2$ 中停滞，因为第一个分量无法被减小。然后，分析当 $H_4$ 具有满列秩时，完全 GMRES ($k=4$) 如何通过求解 $H_4 y = \\beta e_1$ 实现精确收敛。\n\n您的程序必须：\n- 根据上述定义实现 GMRES 和重启 GMRES，使用 Arnoldi 过程并求解最小二乘问题以获得校正向量。\n- 构造矩阵 $A(\\alpha,\\beta,\\gamma)$ 并数值上验证指定的收敛和停滞性质。\n- 包含一个由以下四个案例组成的测试套件：\n    1. 正常路径：$\\alpha = 2$, $\\beta = 3$, $\\gamma = 1$, $r_0 = e_1$, $x_0 = 0$, $b = r_0$。验证完全 GMRES 在 $4$ 步内达到低于 $10^{-12}$ 的残差范数，并且重启 GMRES($2$) 在 $5$ 个循环中停滞（每个循环结束时的残差范数与初始残差范数在 $10^{-12}$ 的容差范围内保持相等）。\n    2. 边界条件：与案例1相同的 $A$ 和 $r_0$，但使用 GMRES($4$) 并进行单个循环。验证循环结束时的残差范数低于 $10^{-12}$。\n    3. 边缘案例（打破停滯的扰动）：修改 $A$，设置 $A_{1,2} \\leftarrow \\varepsilon$（$\\varepsilon = 0.1$），同时保持 $\\alpha = 2, \\beta = 3, \\gamma = 1$，并使用 $r_0 = e_1$。验证重启 GMRES($2$) 在 $5$ 个循环中没有停滯，即最后一个循环结束时的残差范数比初始残差范数至少小 $10^{-6}$。\n    4. 边缘案例（不同的初始残差）：使用原始的 $A$（$\\alpha = 2, \\beta = 3, \\gamma = 1$），但取 $r_0 = \\frac{1}{2}[1,1,1,1]^\\top$, $x_0 = 0$ 和 $b = r_0$。验证重启 GMRES($2$) 在 $3$ 个循环中没有停滯，即最后一个循环结束时的残差范数比初始残差范数至少小 $10^{-6}$。\n\n对于所有案例，使用标准的欧几里得范数测量残差范数，不涉及任何物理单位。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），每个结果都是一个布尔值，指示该测试案例的指定条件是否得到满足。",
            "solution": "所提供的问题是有效的。它在科学上基于数值线性代数领域中 Krylov 子空间方法的成熟理论，特别是广义最小残差 (GMRES) 法。该问题是适定的、客观的，并为一个特定的数值分析任务提供了一个完整、一致的设置：演示和分析重启 GMRES 中的停滞现象。\n\n解决方案分两部分进行。首先，提供一个理论推导，以解释对于给定的矩阵结构，导致 GMRES($2$) 停滞的条件，以及为什么完全 GMRES($4$) 仍然收敛。其次，构建一个 Python 实现，以在指定的测试案例中数值上验证这些发现。\n\n### GMRES 行为的理论分析\n\n我们分析 GMRES 方法对于给定的矩阵 $A(\\alpha, \\beta, \\gamma)$ 和初始条件下线性系统 $A x = b$ 的行为。\n矩阵为：\n$$\nA = A(\\alpha,\\beta,\\gamma) = \\begin{bmatrix}\n0  0  \\alpha  0 \\\\\n1  0  0  0 \\\\\n0  1  0  0 \\\\\n0  0  \\gamma  \\beta\n\\end{bmatrix}\n$$\n初始猜测为 $x_0 = 0$，因此初始残差为 $r_0 = b - A x_0 = b$。给定 $r_0 = e_1 = [1,0,0,0]^\\top$，因此 $b=e_1$。初始残差的范数，我们记为 $\\rho_0$ 以避免与矩阵 $A$ 中的参数 $\\beta$ 混淆，为 $\\rho_0 = \\|r_0\\|_2 = \\|e_1\\|_2 = 1$。\n\nGMRES 方法使用 Arnoldi 过程为 Krylov 子空间 $\\mathcal{K}_k(A, r_0)$ 构建一个标准正交基 $V_k = [v_1, \\dots, v_k]$。第一个基向量是 $v_1 = r_0 / \\rho_0 = e_1$。\n\n#### $k=1, 2$ 时的 Arnoldi 过程\n\n让我们执行 Arnoldi 过程的前两步。\n\n**第1步：构造 $v_2$ 和 $H_2$ 的第一列。**\n过程从 $v_1 = e_1$ 开始。我们计算 $w_1 = A v_1$：\n$$ w_1 = A v_1 = A e_1 = [0, 1, 0, 0]^\\top = e_2 $$\nHessenberg 矩阵 $H$ 第一列的元素是 $w_1$ 在现有基向量上的投影。\n$$ h_{1,1} = v_1^\\top w_1 = e_1^\\top e_2 = 0 $$\n我们将 $w_1$ 相对于 $v_1$ 正交化：\n$$ \\tilde{w}_1 = w_1 - h_{1,1} v_1 = e_2 - 0 \\cdot e_1 = e_2 $$\n次对角线元素 $h_{2,1}$ 是结果的范数：\n$$ h_{2,1} = \\|\\tilde{w}_1\\|_2 = \\|e_2\\|_2 = 1 $$\n下一个基向量是归一化后的 $\\tilde{w}_1$：\n$$ v_2 = \\tilde{w}_1 / h_{2,1} = e_2 $$\n\n**第2步：构造 $v_3$ 和 $H_2$ 的第二列。**\n我们计算 $w_2 = A v_2$：\n$$ w_2 = A v_2 = A e_2 = [0, 0, 1, 0]^\\top = e_3 $$\n$H$ 第二列的元素是 $w_2$ 在 $v_1$ 和 $v_2$ 上的投影：\n$$ h_{1,2} = v_1^\\top w_2 = e_1^\\top e_3 = 0 $$\n$$ h_{2,2} = v_2^\\top w_2 = e_2^\\top e_3 = 0 $$\n因此，对于 GMRES($2$)，上 Hessenberg 矩阵 $H_2 \\in \\mathbb{R}^{3 \\times 2}$ 是：\n$$\nH_2 = \\begin{bmatrix} h_{1,1}  h_{1,2} \\\\ h_{2,1}  h_{2,2} \\\\ 0  h_{3,2} \\end{bmatrix}\n$$\n为了完成计算，我们计算 $h_{3,2}$。首先，我们正交化 $w_2$：\n$$ \\tilde{w}_2 = w_2 - h_{1,2} v_1 - h_{2,2} v_2 = e_3 - 0 \\cdot e_1 - 0 \\cdot e_2 = e_3 $$\n并求其范数：\n$$ h_{3,2} = \\|\\tilde{w}_2\\|_2 = \\|e_3\\|_2 = 1 $$\n因此，$k=2$ 时的 Arnoldi 过程产生 $V_3 = [e_1, e_2, e_3]$ 和以下矩阵：\n$$\nH_2 = \\begin{bmatrix} 0  0 \\\\ 1  0 \\\\ 0  1 \\end{bmatrix}\n$$\n\n#### GMRES($2$) 的停滞\n\n在 GMRES($m$) 中，更新后的迭代解是 $x_m = x_0 + V_m y_m$，其中 $y_m$ 求解最小二乘问题 $\\min_{y \\in \\mathbb{R}^m} \\| \\rho_0 e_1 - H_m y \\|_2$。对于我们 $m=2$ 的情况，我们有 $\\rho_0=1$ 且 $e_1 \\in \\mathbb{R}^{3}$。我们需要求解：\n$$ \\min_{y \\in \\mathbb{R}^2} \\left\\| \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\end{bmatrix} - \\begin{bmatrix} 0  0 \\\\ 1  0 \\\\ 0  1 \\end{bmatrix} \\begin{bmatrix} y_1 \\\\ y_2 \\end{bmatrix} \\right\\|_2 $$\n残差向量的范数是：\n$$ \\left\\| \\begin{bmatrix} 1 - (0 \\cdot y_1 + 0 \\cdot y_2) \\\\ 0 - (1 \\cdot y_1 + 0 \\cdot y_2) \\\\ 0 - (0 \\cdot y_1 + 1 \\cdot y_2) \\end{bmatrix} \\right\\|_2 = \\left\\| \\begin{bmatrix} 1 \\\\ -y_1 \\\\ -y_2 \\end{bmatrix} \\right\\|_2 = \\sqrt{1^2 + y_1^2 + y_2^2} $$\n当 $y_1=0$ 且 $y_2=0$ 时，该表达式取得最小值。最优解为 $y_2 = [0,0]^\\top$。\n\n这种行为的原因是 $H_2$ 的第一行完全为零。这是因为对于 $v_1=e_1$ 和 $v_2=e_2$，我们有 $h_{1,1} = v_1^\\top A v_1 = A_{11}$ 和 $h_{1,2} = v_1^\\top A v_2 = A_{12}$，对于给定的矩阵结构，这两者都为零。因为目标向量 $\\rho_0 e_1$ 的第一个分量非零，但 $H_2$ 的第一行为零，所以残差的这个分量无法被减小。\n\n当 $y_2 = 0$ 时，解的更新为 $x_2 = x_0 + V_2 y_2 = 0 + V_2 \\cdot 0 = 0$。新的解与初始猜测相同。新的残差为 $r_2 = b - A x_2 = b = r_0$。当 GMRES($2$) 重启时，它以完全相同的残差 $r_0$ 开始，过程完全相同地重复，没有任何进展。这就是停滞。\n\n#### 完全 GMRES($4$) 的收敛\n\n完全 GMRES 直到子空间张成整个空间（即 $k=n=4$）时才重启。让我们继续 Arnoldi 过程。我们有 $v_1=e_1, v_2=e_2, v_3=e_3$。\n\n**第3步：构造 $v_4$ 和 $H_4$ 的第三列。**\n我们计算 $w_3 = A v_3 = A e_3 = [\\alpha, 0, 0, \\gamma]^\\top$。\n$$ h_{1,3} = v_1^\\top w_3 = e_1^\\top [\\alpha, 0, 0, \\gamma]^\\top = \\alpha $$\n$$ h_{2,3} = v_2^\\top w_3 = e_2^\\top [\\alpha, 0, 0, \\gamma]^\\top = 0 $$\n$$ h_{3,3} = v_3^\\top w_3 = e_3^\\top [\\alpha, 0, 0, \\gamma]^\\top = 0 $$\n正交化 $w_3$：\n$$ \\tilde{w}_3 = w_3 - h_{1,3} v_1 - h_{2,3} v_2 - h_{3,3} v_3 = [\\alpha, 0, 0, \\gamma]^\\top - \\alpha e_1 = [0, 0, 0, \\gamma]^\\top = \\gamma e_4 $$\n$$ h_{4,3} = \\|\\tilde{w}_3\\|_2 = |\\gamma| $$\n假设 $\\gamma \\neq 0$，下一个基向量是 $v_4 = \\tilde{w}_3 / h_{4,3} = \\operatorname{sgn}(\\gamma) e_4$。\n\n**第4步：构造 $H_4$ 的第四列。**\n我们计算 $w_4 = A v_4 = A (\\operatorname{sgn}(\\gamma) e_4) = \\operatorname{sgn}(\\gamma) [0, 0, 0, \\beta]^\\top = \\operatorname{sgn}(\\gamma) \\beta e_4$。\n$$ h_{1,4} = v_1^\\top w_4 = 0, \\quad h_{2,4} = v_2^\\top w_4 = 0, \\quad h_{3,4} = v_3^\\top w_4 = 0 $$\n$$ h_{4,4} = v_4^\\top w_4 = (\\operatorname{sgn}(\\gamma)e_4)^\\top (\\operatorname{sgn}(\\gamma)\\beta e_4) = \\beta $$\n正交化 $w_4$：\n$$ \\tilde{w}_4 = w_4 - \\sum_{i=1}^4 h_{i,4} v_i = (\\operatorname{sgn}(\\gamma)\\beta e_4) - h_{4,4} v_4 = (\\operatorname{sgn}(\\gamma)\\beta e_4) - \\beta (\\operatorname{sgn}(\\gamma)e_4) = 0 $$\n$$ h_{5,4} = \\|\\tilde{w}_4\\|_2 = 0 $$\n由于 $h_{5,4}=0$，Arnoldi 过程终止（一次“幸运分解”）。Krylov 子空间 $\\mathcal{K}_4(A, r_0)$ 在 $A$ 作用下不变。这意味着 $Ax=b$ 的精确解位于仿射空间 $x_0 + \\mathcal{K}_4(A, r_0)$ 中。\n\n完整的 $5 \\times 4$ Hessenberg 矩阵 $H_4$ 为：\n$$\nH_4 = \\begin{bmatrix}\n0  0  \\alpha  0 \\\\\n1  0  0  0 \\\\\n0  1  0  0 \\\\\n0  0  |\\gamma|  \\beta \\\\\n0  0  0  0\n\\end{bmatrix}\n$$\nGMRES($4$) 的最小二乘问题是 $\\min_{y \\in \\mathbb{R}^4} \\| \\rho_0 e_1 - H_4 y \\|_2$，其中 $\\rho_0=1$ 且 $e_1 \\in \\mathbb{R}^5$。由于 $H_4$ 的最后一行是零，如果我们能够求解方程组 $\\bar{H}_4 y = \\rho_0 \\bar{e}_1$，其中 $\\bar{H}_4$ 是 $H_4$ 的上 $4 \\times 4$ 子块，就可以实现零残差：\n$$\n\\begin{bmatrix}\n0  0  \\alpha  0 \\\\\n1  0  0  0 \\\\\n0  1  0  0 \\\\\n0  0  |\\gamma|  \\beta\n\\end{bmatrix}\n\\begin{bmatrix} y_1 \\\\ y_2 \\\\ y_3 \\\\ y_4 \\end{bmatrix}\n=\n\\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\n$$\n这个 $4 \\times 4$ 矩阵 $\\bar{H}_4$ 的行列式是 $-\\alpha \\beta$。由于问题指定 $A$ 是非奇异的（$\\alpha \\neq 0, \\beta \\neq 0$），所以 $\\det(\\bar{H}_4) \\neq 0$。因此，存在唯一的解 $y_4$，这会得到零残差范数。完全 GMRES 在 $4$ 步内收敛。\n\n这些测试案例旨在证实这一分析：对于特殊的矩阵和 $r_0$ 会发生停滞，但通过扰动矩阵（案例3，其中 $A_{12} \\neq 0$ 使得 $h_{1,2} \\neq 0$）或选择一个与特殊结构不符的不同初始残差（案例4），这种停滞会被打破。",
            "answer": "```python\nimport numpy as np\n\ndef gmres_custom(A, b, x0, m, max_cycles, tol=1e-15):\n    \"\"\"\n    Implements the Generalized Minimal Residual (GMRES) method.\n\n    Args:\n        A (np.ndarray): The coefficient matrix of the linear system.\n        b (np.ndarray): The right-hand side vector.\n        x0 (np.ndarray): The initial guess for the solution.\n        m (int): The restart parameter (dimension of the Krylov subspace).\n        max_cycles (int): The maximum number of restart cycles.\n        tol (float): The tolerance for convergence.\n\n    Returns:\n        tuple: A tuple containing:\n            - x (np.ndarray): The final computed solution.\n            - residual_norms (list): A list of residual norms, starting with the\n              initial norm, followed by the norm after each cycle.\n    \"\"\"\n    n = A.shape[0]\n    x = x0.copy()\n\n    # Store history of residual norms (initial + after each cycle)\n    residual_norms = []\n\n    r = b - A @ x\n    initial_r_norm = np.linalg.norm(r)\n    residual_norms.append(initial_r_norm)\n\n    if initial_r_norm  tol:\n        return x, residual_norms\n\n    for cycle in range(max_cycles):\n        # Arnoldi Process\n        V = np.zeros((n, m + 1), dtype=float)\n        H = np.zeros((m + 1, m), dtype=float)\n\n        current_r_norm = np.linalg.norm(r)\n        if current_r_norm  tol:\n            break\n        V[:, 0] = r / current_r_norm\n\n        # This is the `beta*e_1` vector for the least-squares problem,\n        # where beta is the norm of the current residual.\n        e1_vec = np.zeros(m + 1)\n        e1_vec[0] = current_r_norm\n\n        actual_m = m\n        for j in range(m):\n            w = A @ V[:, j]\n            for i in range(j + 1):\n                H[i, j] = V[:, i].T @ w\n                w = w - H[i, j] * V[:, i]\n\n            H[j + 1, j] = np.linalg.norm(w)\n\n            # Happy breakdown: subspace is A-invariant\n            if H[j + 1, j]  1e-16:\n                actual_m = j + 1\n                break\n\n            V[:, j + 1] = w / H[j + 1, j]\n\n        # Adjust H and e1_vec to the actual subspace dimension\n        H_m = H[:actual_m + 1, :actual_m]\n        e1_vec_m = e1_vec[:actual_m + 1]\n\n        # Solve the least-squares problem: min || beta*e1 - H*y ||\n        y, _, _, _ = np.linalg.lstsq(H_m, e1_vec_m, rcond=None)\n\n        # Update the solution\n        x += V[:, :actual_m] @ y\n\n        # Update residual for the next cycle\n        r = b - A @ x\n        residual_norms.append(np.linalg.norm(r))\n\n    return x, residual_norms\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for GMRES behavior.\n    \"\"\"\n    results = []\n\n    # --- Test Case 1: Stagnation ---\n    alpha, beta, gamma = 2.0, 3.0, 1.0\n    A1 = np.array([\n        [0, 0, alpha, 0],\n        [1, 0, 0,     0],\n        [0, 1, 0,     0],\n        [0, 0, gamma, beta]\n    ], dtype=float)\n    x0 = np.zeros(4)\n    r0 = np.array([1.0, 0.0, 0.0, 0.0])\n    b = r0.copy()\n\n    # Full GMRES(4)\n    _, res_norms_full = gmres_custom(A1, b, x0, m=4, max_cycles=1)\n    cond1_full = res_norms_full[-1]  1e-12\n\n    # Restarted GMRES(2)\n    _, res_norms_restarted = gmres_custom(A1, b, x0, m=2, max_cycles=5)\n    r_norm_initial = res_norms_restarted[0]\n    cond1_stagnation = all(\n        abs(res_norms_restarted[i] - r_norm_initial)  1e-12 \n        for i in range(1, 6)\n    )\n    results.append(cond1_full and cond1_stagnation)\n\n    # --- Test Case 2: Boundary Condition (GMRES(4)) ---\n    # This is identical to the first part of Case 1, as GMRES(4) is full GMRES for n=4.\n    _, res_norms_boundary = gmres_custom(A1, b, x0, m=4, max_cycles=1)\n    cond2 = res_norms_boundary[-1]  1e-12\n    results.append(cond2)\n\n    # --- Test Case 3: Perturbation Breaking Stagnation ---\n    epsilon = 0.1\n    A3 = A1.copy()\n    A3[0, 1] = epsilon  # A_{1,2} in 1-based indexing\n\n    _, res_norms_pert = gmres_custom(A3, b, x0, m=2, max_cycles=5)\n    cond3 = res_norms_pert[-1]  res_norms_pert[0] - 1e-6\n    results.append(cond3)\n    \n    # --- Test Case 4: Different Initial Residual ---\n    A4 = A1.copy()  # Original matrix\n    r0_4 = 0.5 * np.ones(4)\n    b4 = r0_4.copy()\n\n    _, res_norms_r0 = gmres_custom(A4, b4, x0, m=2, max_cycles=3)\n    cond4 = res_norms_r0[-1]  res_norms_r0[0] - 1e-6\n    results.append(cond4)\n\n    # Final print statement\n    print(f\"[{','.join(map(str, [r.lower() for r in map(str, results)]))}]\")\n\nsolve()\n```"
        }
    ]
}