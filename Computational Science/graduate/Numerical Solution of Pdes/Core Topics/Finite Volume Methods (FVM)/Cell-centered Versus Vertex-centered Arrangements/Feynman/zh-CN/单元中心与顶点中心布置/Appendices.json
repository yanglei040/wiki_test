{
    "hands_on_practices": [
        {
            "introduction": "在任何数值模拟中，边界条件的正确施加是保证解的准确性和稳定性的关键第一步。本练习将带你实践如何在单元中心网格（cell-centered grid）上处理常见的狄利克雷（Dirichlet）边界条件。你将通过推导“虚拟单元”（ghost cell）的数值，掌握如何利用线性外插法来精确满足物理边界上的给定值，这项基本功的训练将加深你对有限体积法几何直观性的理解。",
            "id": "3368871",
            "problem": "考虑一个一维域 $[0,L]$，使用均匀的单元中心离散化方法来求解偏微分方程 (PDE)。设存在 $N$ 个内部单元，因此网格间距为 $\\Delta x = L/N$。单元中心位于 $x_{i} = (i-\\tfrac{1}{2})\\Delta x$（其中 $i=1,\\dots,N$），并在 $x_{0} = -\\tfrac{1}{2}\\Delta x$ 和 $x_{N+1} = L + \\tfrac{1}{2}\\Delta x$ 处放置两个虚拟单元中心。给定狄利克雷边界条件 $u(0) = \\alpha$ 和 $u(L) = \\beta$。在单元中心的有限差分或有限体积格式中，边界附近的离散模板需要虚拟值 $u_{0}$ 和 $u_{N+1}$。\n\n仅从单元中心网格的几何定义和狄利克雷边界数据出发，通过要求跨越每个边界的线性重构在物理边界处与给定的边界值相匹配来施加边界条件，同时使用位于 $x=\\Delta x/2$（左侧）和 $x=L-\\Delta x/2$（右侧）的相邻内部单元中心值。具体来说，在左边界，使用一个通过 $(x_{0},u_{0})$ 和 $(x_{1},u_{1})$ 的线性函数，其在 $x=0$ 处的值等于 $\\alpha$；在右边界，使用一个通过 $(x_{N},u_{N})$ 和 $(x_{N+1},u_{N+1})$ 的线性函数，其在 $x=L$ 处的值等于 $\\beta$。\n\n推导虚拟值 $u_{0}$ 和 $u_{N+1}$ 关于 $\\alpha$、$\\beta$、$u_{1}$ 和 $u_{N}$ 的闭式表达式。你的最终答案必须表示为一个包含两个符号形式虚拟值的单行矩阵。不需要进行数值计算或四舍五入。",
            "solution": "问题陈述已经过验证，被认为是科学合理的、适定的、客观的和完整的。它描述了在单元中心有限差分或有限体积格式中实现狄利克雷边界条件的标准且正确的过程。可以从所提供的信息中推导出严谨的解。\n\n我们的任务是通过施加狄利克雷边界条件 $u(0) = \\alpha$ 和 $u(L) = \\beta$ 来找到虚拟单元变量 $u_0$ 和 $u_{N+1}$ 的值。该施加过程是通过跨边界的线性重构完成的。\n\n首先，我们考虑位于 $x=0$ 的左边界。问题陈述要求我们必须使用一个通过点 $(x_0, u_0)$ 和 $(x_1, u_1)$ 的线性函数，并要求其在 $x=0$ 处的值等于 $\\alpha$。这些点的坐标由网格定义给出：\n$x_0 = -\\frac{1}{2}\\Delta x$\n$x_1 = \\frac{1}{2}\\Delta x$\n因此，这两个点是 $(-\\frac{1}{2}\\Delta x, u_0)$ 和 $(\\frac{1}{2}\\Delta x, u_1)$。\n\n通过两点 $(x_a, y_a)$ 和 $(x_b, y_b)$ 的线性函数 $u(x)$ 可以用点斜式表示：\n$u(x) = y_a + \\frac{y_b - y_a}{x_b - x_a}(x - x_a)$\n代入我们的点 $(x_0, u_0)$ 和 $(x_1, u_1)$，我们得到：\n$u(x) = u_0 + \\frac{u_1 - u_0}{x_1 - x_0}(x - x_0)$\nx坐标的差值为 $x_1 - x_0 = \\frac{1}{2}\\Delta x - (-\\frac{1}{2}\\Delta x) = \\Delta x$。\n将此结果和 $x_0$ 的表达式代入方程，得到：\n$u(x) = u_0 + \\frac{u_1 - u_0}{\\Delta x}(x - (-\\frac{1}{2}\\Delta x))$\n$u(x) = u_0 + \\frac{u_1 - u_0}{\\Delta x}(x + \\frac{1}{2}\\Delta x)$\n\n我们现在施加边界条件 $u(0) = \\alpha$：\n$\\alpha = u(0) = u_0 + \\frac{u_1 - u_0}{\\Delta x}(0 + \\frac{1}{2}\\Delta x)$\n$\\alpha = u_0 + \\frac{u_1 - u_0}{\\Delta x}(\\frac{1}{2}\\Delta x)$\n$\\alpha = u_0 + \\frac{1}{2}(u_1 - u_0)$\n$\\alpha = u_0 + \\frac{1}{2}u_1 - \\frac{1}{2}u_0$\n$\\alpha = \\frac{1}{2}u_0 + \\frac{1}{2}u_1$\n这个方程表明，边界上的值是相邻虚拟单元中心和内部单元中心值的算术平均值，这是符合预期的，因为边界 $x=0$ 是位置 $x_0$ 和 $x_1$ 的几何中点。\n\n为了求出虚拟值 $u_0$，我们对其求解：\n$2\\alpha = u_0 + u_1$\n$u_0 = 2\\alpha - u_1$\n\n接下来，我们考虑位于 $x=L$ 的右边界。过程是类似的。我们使用一个通过点 $(x_N, u_N)$ 和 $(x_{N+1}, u_{N+1})$ 的线性函数，并要求其在 $x=L$ 处的值为 $\\beta$。坐标为：\n$x_N = L - \\frac{1}{2}\\Delta x$\n$x_{N+1} = L + \\frac{1}{2}\\Delta x$\n这两个点是 $(L - \\frac{1}{2}\\Delta x, u_N)$ 和 $(L + \\frac{1}{2}\\Delta x, u_{N+1})$。\n\n使用点斜式，并以点 $(x_N, u_N)$ 为基准：\n$u(x) = u_N + \\frac{u_{N+1} - u_N}{x_{N+1} - x_N}(x - x_N)$\nx坐标的差值为 $x_{N+1} - x_N = (L + \\frac{1}{2}\\Delta x) - (L - \\frac{1}{2}\\Delta x) = \\Delta x$。\n将此结果和 $x_N$ 的表达式代入方程，得到：\n$u(x) = u_N + \\frac{u_{N+1} - u_N}{\\Delta x}(x - (L - \\frac{1}{2}\\Delta x))$\n\n我们现在施加边界条件 $u(L) = \\beta$：\n$\\beta = u(L) = u_N + \\frac{u_{N+1} - u_N}{\\Delta x}(L - (L - \\frac{1}{2}\\Delta x))$\n$\\beta = u_N + \\frac{u_{N+1} - u_N}{\\Delta x}(\\frac{1}{2}\\Delta x)$\n$\\beta = u_N + \\frac{1}{2}(u_{N+1} - u_N)$\n$\\beta = u_N + \\frac{1}{2}u_{N+1} - \\frac{1}{2}u_N$\n$\\beta = \\frac{1}{2}u_N + \\frac{1}{2}u_{N+1}$\n如前所述，边界上的值是相邻内部单元中心和虚拟单元中心值的算术平均值，因为 $x=L$ 是 $x_N$ 和 $x_{N+1}$ 的中点。\n\n为了求出虚拟值 $u_{N+1}$，我们对其求解：\n$2\\beta = u_N + u_{N+1}$\n$u_{N+1} = 2\\beta - u_N$\n\n推导出的虚拟值表达式为 $u_0 = 2\\alpha - u_1$ 和 $u_{N+1} = 2\\beta - u_N$。这些表达式按照要求，用给定的边界值 $\\alpha$ 和 $\\beta$ 以及相邻的内部单元值 $u_1$ 和 $u_N$ 来表示。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2\\alpha - u_1 & 2\\beta - u_N\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "网格变量的布置方式对数值解的质量有决定性影响，尤其是在不可压缩流的模拟中，一个不恰当的选择可能导致灾难性的数值失稳。本练习将通过一个经典的解析反例，揭示同位网格（collocated grid）布置下固有的压力-速度解耦（pressure-velocity decoupling）问题。你将运用一个“棋盘格”压力模式，从理论上证明为何标准的离散算子会对此类高频振荡“视而不见”，从而产生非物理的解。完成这个推导，你将深刻领会交错网格（staggered grid）设计的精妙之处及其在计算流体力学中的重要性。",
            "id": "3368859",
            "problem": "考虑在单位正方形域上且在两个方向上都具有周期性边界条件的不可压缩斯托克斯方程。方程由动量平衡方程 $-\\nabla p + \\mu \\Delta \\boldsymbol{u} = \\boldsymbol{0}$ 和不可压缩约束 $\\nabla \\cdot \\boldsymbol{u} = 0$ 给出，其中 $p$ 是压力，$\\mu$ 是动力粘度，$\\boldsymbol{u} = (u,v)$ 是速度。假设一个源于投影法的半离散压力到速度更新：由给定压力场产生的预测速度为 $\\boldsymbol{u}^{*} = -\\frac{\\Delta t}{\\rho} \\nabla p$，其中 $\\Delta t$ 是时间步长，$\\rho$ 是密度。在此预测阶段忽略扩散项。\n\n在具有 $N \\times N$ 个点和网格间距 $h = \\frac{1}{N}$ 的均匀方形网格上，考虑两种空间离散化方案：\n\n1. 顶点中心同位网格布置，其中 $u$、$v$ 和 $p$ 都存储在顶点 $\\{(i,j)\\}_{i,j=0}^{N-1}$ 处。顶点 $(i,j)$ 处的离散梯度 $\\nabla p$ 通过标准两点中心差分进行近似，\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2h}, \n\\quad \n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2h}.\n$$\n定义用于顶点 $(i,j)$ 处离散散度的面法向预测速度，该速度通过节点速度的线性插值得到：\n$$\nu^{*}_{i+\\frac{1}{2},j} = \\frac{u^{*}_{i+1,j} + u^{*}_{i,j}}{2}, \n\\quad \nu^{*}_{i-\\frac{1}{2},j} = \\frac{u^{*}_{i,j} + u^{*}_{i-1,j}}{2},\n$$\n$$\nv^{*}_{i,j+\\frac{1}{2}} = \\frac{v^{*}_{i,j+1} + v^{*}_{i,j}}{2}, \n\\quad \nv^{*}_{i,j-\\frac{1}{2}} = \\frac{v^{*}_{i,j} + v^{*}_{i,j-1}}{2}.\n$$\n则顶点 $(i,j)$ 处的离散散度为\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{i,j} = \\frac{u^{*}_{i+\\frac{1}{2},j} - u^{*}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{*}_{i,j+\\frac{1}{2}} - v^{*}_{i,j-\\frac{1}{2}}}{h}.\n$$\n\n2. 单元中心网格布置，其中 $p$ 存储在单元中心 $\\{(i,j)\\}_{i,j=0}^{N-1}$，而 $u$ 和 $v$ 存储在相应的单元面上。用于计算面法向预测速度的离散梯度采用单个单元的差分：\n$$\nu^{*}_{i+\\frac{1}{2},j} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i+1,j} - p_{i,j}}{h}, \n\\quad \nv^{*}_{i,j+\\frac{1}{2}} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i,j+1} - p_{i,j}}{h}.\n$$\n单元中心 $(i,j)$ 处的离散散度为\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{i,j} = \\frac{u^{*}_{i+\\frac{1}{2},j} - u^{*}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{*}_{i,j+\\frac{1}{2}} - v^{*}_{i,j-\\frac{1}{2}}}{h}.\n$$\n\n为同位网格布置构建棋盘格压力模式作为反例：\n- 对于顶点中心同位网格情况，在顶点处定义 $p_{i,j} = p_{0} (-1)^{i+j}$，其中 $p_{0}$ 是一个恒定振幅。\n- 对于单元中心情况，在单元中心处定义 $p_{i,j} = p_{0} (-1)^{i+j}$。\n\n从上述基本定义出发，不引入任何额外的稳定化或滤波，推导两种布置在棋盘格压力模式下的离散预测速度场，并计算在通用位置 $(i,j)$ 处的相应离散散度。然后，取每个散度表达式的绝对值，并将 $p_{0}$、$\\Delta t$、$\\rho$ 和 $h$ 视为符号常数，计算定义如下的比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} = \\frac{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{collocated}}\\right|}{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}}\\right|}.\n$$\n\n最终答案以单个简化的实数或闭式解析表达式的形式给出。不需要单位。如果您选择引入任何数值近似，请将最终答案四舍五入到四位有效数字。",
            "solution": "目标是针对指定的棋盘格压力模式，计算比率 $\\mathcal{R} = \\frac{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{collocated}}\\right|}{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}}\\right|}$。这需要为顶点中心同位网格和单元中心网格两种布置推导预测速度场 $(\\nabla \\cdot \\boldsymbol{u}^{*})$ 的离散散度。\n\n首先，我们分析顶点中心同位网格布置。\n压力场在顶点上定义为 $p_{i,j} = p_{0} (-1)^{i+j}$，其中 $p_{0}$ 是一个恒定振幅。顶点 $(i,j)$ 处的预测速度分量由 $\\boldsymbol{u}^{*} = -\\frac{\\Delta t}{\\rho} \\nabla p$ 给出，其中梯度由中心差分近似。让我们计算顶点 $(i,j)$ 处离散压力梯度的分量：\nx 分量为：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2h} = \\frac{p_{0}(-1)^{(i+1)+j} - p_{0}(-1)^{(i-1)+j}}{2h}\n$$\n提出公因式：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{0}(-1)^{i+j}}{2h} \\left( (-1)^{1} - (-1)^{-1} \\right) = \\frac{p_{0}(-1)^{i+j}}{2h} \\left( -1 - (-1) \\right) = 0\n$$\n类似地，y 分量为：\n$$\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2h} = \\frac{p_{0}(-1)^{i+(j+1)} - p_{0}(-1)^{i+(j-1)}}{2h}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{0}(-1)^{i+j}}{2h} \\left( (-1)^{1} - (-1)^{-1} \\right) = \\frac{p_{0}(-1)^{i+j}}{2h} \\left( -1 - (-1) \\right) = 0\n$$\n由于离散压力梯度处处为零，顶点上的预测速度分量也为零：\n$$\nu^{*}_{i,j} = -\\frac{\\Delta t}{\\rho} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = 0\n$$\n$$\nv^{*}_{i,j} = -\\frac{\\Delta t}{\\rho} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = 0\n$$\n散度是使用面中心的速度计算的，这些速度是通过节点速度的线性插值获得的。由于所有节点速度均为零，插值得到的面法向速度也为零：\n$$\nu^{*}_{i \\pm \\frac{1}{2},j} = 0 \\quad \\text{and} \\quad v^{*}_{i,j \\pm \\frac{1}{2}} = 0\n$$\n因此，顶点 $(i,j)$ 处的离散散度恒为零：\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{collocated}} = \\frac{u^{*}_{i+\\frac{1}{2},j} - u^{*}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{*}_{i,j+\\frac{1}{2}} - v^{*}_{i,j-\\frac{1}{2}}}{h} = \\frac{0 - 0}{h} + \\frac{0 - 0}{h} = 0\n$$\n这表明，没有稳定化的同位网格布置对棋盘格压力模式完全不敏感。\n\n接下来，我们分析单元中心网格布置。\n压力场在单元中心定义为 $p_{i,j} = p_{0} (-1)^{i+j}$。预测的面法向速度直接由相邻单元中心的压力差计算得出。让我们计算单元 $(i,j)$ 面上的速度：\n单元右侧面上的速度为：\n$$\nu^{*}_{i+\\frac{1}{2},j} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i+1,j} - p_{i,j}}{h} = -\\frac{\\Delta t}{\\rho h} \\left( p_{0}(-1)^{(i+1)+j} - p_{0}(-1)^{i+j} \\right)\n$$\n$$\nu^{*}_{i+\\frac{1}{2},j} = -\\frac{\\Delta t p_{0}}{\\rho h} (-1)^{i+j} ((-1)^{1} - 1) = -\\frac{\\Delta t p_{0}}{\\rho h} (-1)^{i+j} (-2) = \\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\n$$\n单元左侧面上的速度为：\n$$\nu^{*}_{i-\\frac{1}{2},j} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i,j} - p_{i-1,j}}{h} = -\\frac{\\Delta t}{\\rho h} \\left( p_{0}(-1)^{i+j} - p_{0}(-1)^{(i-1)+j} \\right)\n$$\n$$\nu^{*}_{i-\\frac{1}{2},j} = -\\frac{\\Delta t p_{0}}{\\rho h} (-1)^{i+j} (1 - (-1)^{-1}) = -\\frac{\\Delta t p_{0}}{\\rho h} (-1)^{i+j} (2) = -\\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\n$$\n类似地，对于顶面和底面上的速度：\n$$\nv^{*}_{i,j+\\frac{1}{2}} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i,j+1} - p_{i,j}}{h} = -\\frac{\\Delta t}{\\rho h} \\left( p_{0}(-1)^{i+(j+1)} - p_{0}(-1)^{i+j} \\right) = \\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\n$$\n$$\nv^{*}_{i,j-\\frac{1}{2}} = -\\frac{\\Delta t}{\\rho} \\frac{p_{i,j} - p_{i,j-1}}{h} = -\\frac{\\Delta t}{\\rho h} \\left( p_{0}(-1)^{i+j} - p_{0}(-1)^{i+(j-1)} \\right) = -\\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\n$$\n现在，我们计算单元中心 $(i,j)$ 处的离散散度：\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}} = \\frac{u^{*}_{i+\\frac{1}{2},j} - u^{*}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{*}_{i,j+\\frac{1}{2}} - v^{*}_{i,j-\\frac{1}{2}}}{h}\n$$\n代入推导出的面速度表达式：\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}} = \\frac{1}{h} \\left( \\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j} - \\left(-\\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\\right) \\right) + \\frac{1}{h} \\left( \\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j} - \\left(-\\frac{2 \\Delta t p_{0}}{\\rho h} (-1)^{i+j}\\right) \\right)\n$$\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}} = \\frac{1}{h} \\left( \\frac{4 \\Delta t p_{0}}{\\rho h} (-1)^{i+j} \\right) + \\frac{1}{h} \\left( \\frac{4 \\Delta t p_{0}}{\\rho h} (-1)^{i+j} \\right)\n$$\n$$\n(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}} = \\frac{8 \\Delta t p_{0}}{\\rho h^2} (-1)^{i+j}\n$$\n这个结果非零，表明单元中心（交错）网格布置能正确地耦合棋盘格模式下的压力和速度。\n\n最后，我们计算比率 $\\mathcal{R}$。\n$$\n\\mathcal{R} = \\frac{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{collocated}}\\right|}{\\left|(\\nabla \\cdot \\boldsymbol{u}^{*})_{\\text{cell-centered}}\\right|} = \\frac{|0|}{\\left|\\frac{8 \\Delta t p_{0}}{\\rho h^2} (-1)^{i+j}\\right|}\n$$\n假设物理和数值常数 $p_{0}、\\Delta t、\\rho$ 和 $h$ 非零，则分母非零。由于 $\\rho > 0$ 且 $h > 0$，分母的模为 $\\frac{8 |\\Delta t p_{0}|}{\\rho h^2}$。\n$$\n\\mathcal{R} = \\frac{0}{\\frac{8 |\\Delta t p_{0}|}{\\rho h^2}} = 0\n$$\n最终的比率恰好为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在从理论上认识到同位网格的“棋盘格不稳定性”后，通过编程实践来复现并量化这一现象是巩固理解的最好方式。本练习要求你动手编写代码，实现并对比一个朴素的同位网格格式与经典的交错网格——马可-赛尔（Marker-And-Cell, MAC）格式。通过对特定压力模式进行数值实验，你将亲眼观察到同位格式的失效，并验证MAC格式的鲁棒性。这项实践旨在将抽象的理论转化为可执行的算法，并让你掌握计算流体力学中验证数值格式稳定性的核心技能。",
            "id": "3368917",
            "problem": "您将分析不可压缩流中的离散压力-速度耦合，并展示在同位（单元中心）网格布置上出现的经典棋盘格不稳定性，以及采用单元中心压力和面中心速度的 Marker-And-Cell (MAC) 格式如何缓解该问题。整个工作将在一个均匀、周期性的二维网格上，在线性化的稳态设置下进行。\n\n考虑线性化的稳态不可压缩方程\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0, \\quad \\alpha \\, \\boldsymbol{u} + \\nabla p = \\boldsymbol{0},\n$$\n其中 $\\boldsymbol{u} = (u,v)$ 是速度，$p$ 是压力，$\\alpha > 0$ 是一个常数。您将在一个包含 $N \\times N$ 个单元、网格间距为 $h = 1/N$ 并具有周期性边界条件的均匀网格上，研究两种离散布置。\n\n在一个均匀索引网格上为 $p_{i,j}$ 定义离散场，其中 $i,j \\in \\{0,1,\\dots,N-1\\}$，并且在两个方向上都使用模 $N$ 的周期性环绕索引。\n\n您将实现两种格式，用于将给定的离散压力场 $p_{i,j}$ 映射到一个离散散度场 $\\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j}$：\n\n- 同位（单元中心）布置：\n  - 单元中心的离散压力梯度：\n    $$\n    \\left(\\partial_x p\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2h}, \\quad \\left(\\partial_y p\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2h}.\n    $$\n  - 根据线性动量关系得到的单元中心速度：\n    $$\n    u_{i,j} = -\\frac{1}{\\alpha} \\left(\\partial_x p\\right)_{i,j}, \\quad v_{i,j} = -\\frac{1}{\\alpha} \\left(\\partial_y p\\right)_{i,j}.\n    $$\n  - 使用二阶中心差分和到面的算术平均计算单元中心的离散散度，这等效于\n    $$\n    \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2h} + \\frac{v_{i,j+1} - v_{i,j-1}}{2h}.\n    $$\n\n- Marker-And-Cell (MAC) 布置（单元中心压力，面中心速度）：\n  - 面法向压力梯度：\n    $$\n    \\left(\\partial_x p\\right)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h}, \\quad \\left(\\partial_y p\\right)_{i,j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{h}.\n    $$\n  - 根据线性动量关系得到的面中心速度：\n    $$\n    u_{i+\\frac{1}{2},j} = -\\frac{1}{\\alpha} \\left(\\partial_x p\\right)_{i+\\frac{1}{2},j}, \\quad v_{i,j+\\frac{1}{2}} = -\\frac{1}{\\alpha} \\left(\\partial_y p\\right)_{i,j+\\frac{1}{2}}.\n    $$\n  - 单元中心的离散散度，作为面通量的差分：\n    $$\n    \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h}.\n    $$\n\n对于任意压力场 $p_{i,j}$，将离散散度的均方根 (RMS) 定义为\n$$\n\\mathrm{RMS}\\left(\\nabla \\cdot \\boldsymbol{u}\\right) = \\left( \\frac{1}{N^2} \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} \\left[\\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j}\\right]^2 \\right)^{\\frac{1}{2}}.\n$$\n\n实现一个程序，对于下述每个测试用例，在 $N \\times N$ 的周期性网格上构建指定的制造压力场 $p_{i,j}$，使用上面定义的同位映射和 MAC 映射（其中 $\\alpha = 1$）计算离散散度，并返回一对浮点数值\n$$\n\\left[\\mathrm{RMS}_{\\mathrm{collocated}}, \\, \\mathrm{RMS}_{\\mathrm{MAC}}\\right].\n$$\n\n测试套件：\n- 用例 1：$N = 16$, $p_{i,j} = (-1)^{i+j}$。\n- 用例 2：$N = 16$, $p_{i,j} = \\sin(2\\pi x_i) + \\sin(4\\pi y_j)$，其中 $x_i = i/N$, $y_j = j/N$。\n- 用例 3：$N = 32$, $p_{i,j} = (-1)^i$。\n- 用例 4：$N = 8$, $p_{i,j} = (-1)^{i+j}$。\n\n注意：\n- 上述同位映射对应于：使用二阶中心差分从单元中心压力梯度计算出的单元中心速度，以及一个使用到面的算术平均的离散散度（这在代数上等效于单元中心速度的中心差分）。\n- MAC 映射将速度置于面上，并直接在面上使用单个单元的压力差，然后在单元中心使用面通量的标准差分。\n\n预期检测的现象：\n- 对于振荡的 $2h$ 波长压力模式，例如 $p_{i,j} = (-1)^{i+j}$ 或 $p_{i,j} = (-1)^i$，同位映射应产生数值上处于舍入误差水平（接近于零）的 $\\mathrm{RMS}_{\\mathrm{collocated}}$，而 MAC 映射应产生具有 $O(h^{-2})$ 标度律且明显非零的 $\\mathrm{RMS}_{\\mathrm{MAC}}$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个条目对应一个测试用例，其本身是一个按 $\\left[\\mathrm{RMS}_{\\mathrm{collocated}}, \\mathrm{RMS}_{\\mathrm{MAC}}\\right]$ 顺序排列的双元素列表。例如，一个包含两个用例的有效输出如下所示：\n  - `[[0.0,1.0],[0.5,2.5]]`\n此问题不涉及物理单位或角度。所有报告的数字必须是实值十进制数。",
            "solution": "我们从不可压缩、稳态、线性化的方程开始\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0, \\qquad \\alpha \\boldsymbol{u} + \\nabla p = \\boldsymbol{0},\n$$\n其中 $\\alpha > 0$。消去 $\\boldsymbol{u}$ 得到\n$$\n\\boldsymbol{u} = -\\frac{1}{\\alpha} \\nabla p.\n$$\n该速度场的离散散度定义了一个离散压力算子（舒尔补），它控制在给定的离散化中压力如何影响质量守恒。我们将为两种布置推导这个算子。\n\n同位（单元中心）布置：\n- 在一个间距为 $h$ 的均匀周期性网格上，将 $p_{i,j}$ 和 $(u_{i,j},v_{i,j})$ 都置于单元中心。\n- 用二阶中心差分来离散化单元中心的压力梯度：\n  $$\n  \\left(\\partial_x p\\right)_{i,j} = \\frac{p_{i+1,j}-p_{i-1,j}}{2h}, \\quad \\left(\\partial_y p\\right)_{i,j} = \\frac{p_{i,j+1}-p_{i,j-1}}{2h}.\n  $$\n  线性动量关系给出\n  $$\n  u_{i,j} = -\\frac{1}{\\alpha}\\frac{p_{i+1,j}-p_{i-1,j}}{2h}, \\quad v_{i,j} = -\\frac{1}{\\alpha}\\frac{p_{i,j+1}-p_{i,j-1}}{2h}.\n  $$\n- 为了计算单元中心的 $\\nabla \\cdot \\boldsymbol{u}$，一种常见的二阶同位网格做法是使用到面的算术平均，然后再将面通量的差分返回到中心。这在代数上等效于以下单元中心速度的中心差分：\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2h} + \\frac{v_{i,j+1} - v_{i,j-1}}{2h}.\n  $$\n  代入 $u_{i,j}$ 和 $v_{i,j}$ 可得\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = -\\frac{1}{\\alpha} \\left[ \\frac{1}{4h^2}\\left(p_{i+2,j} - 2p_{i,j} + p_{i-2,j}\\right) + \\frac{1}{4h^2}\\left(p_{i,j+2} - 2p_{i,j} + p_{i,j-2}\\right) \\right].\n  $$\n  这是一个步长为 2 的离散拉普拉斯算子，通常称为 $2h$-拉普拉斯算子：\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = -\\frac{1}{\\alpha} \\left(\\Delta_{2h} p\\right)_{i,j}.\n  $$\n  一个关键的观察是，波长为 $2h$ 的振荡压力模式会被 $\\Delta_{2h}$ 消除。例如，设 $p_{i,j} = (-1)^{i+j}$。那么 $p_{i\\pm 2,j} = p_{i,j}$ 且 $p_{i,j\\pm 2} = p_{i,j}$，从而得到\n  $$\n  p_{i+2,j} - 2p_{i,j} + p_{i-2,j} = 0, \\quad p_{i,j+2} - 2p_{i,j} + p_{i,j-2} = 0,\n  $$\n  因此对于所有 $i,j$ 都有 $\\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = 0$。对于诸如 $p_{i,j} = (-1)^i$ 的模式也是如此。因此，从 $p$ 到 $\\nabla \\cdot \\boldsymbol{u}$ 的同位映射有一个包含棋盘格模式的非平凡零空间，并且无法约束此类振荡压力模式。这就是经典的棋盘格不稳定性。\n\nMarker-And-Cell (MAC) 布置：\n- 将 $p_{i,j}$ 置于单元中心，$u_{i+\\frac{1}{2},j}$ 置于垂直面，$v_{i,j+\\frac{1}{2}}$ 置于水平面。\n- 用单个单元的差分来离散化面法向压力梯度：\n  $$\n  \\left(\\partial_x p\\right)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h}, \\quad \\left(\\partial_y p\\right)_{i,j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{h},\n  $$\n  并在面上施加线性动量关系：\n  $$\n  u_{i+\\frac{1}{2},j} = -\\frac{1}{\\alpha} \\frac{p_{i+1,j} - p_{i,j}}{h}, \\quad v_{i,j+\\frac{1}{2}} = -\\frac{1}{\\alpha} \\frac{p_{i,j+1} - p_{i,j}}{h}.\n  $$\n- 单元中心的离散散度为\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h}.\n  $$\n  代入面速度可得\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = -\\frac{1}{\\alpha} \\left[ \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h^2} \\right] = -\\frac{1}{\\alpha} \\left(\\Delta_{h} p\\right)_{i,j},\n  $$\n  即标准的 5 点 $h$-拉普拉斯算子。该算子不会消除 $2h$ 波长的棋盘格模式；对于 $p_{i,j} = (-1)^{i+j}$，可以获得一个非零响应，其标度律为 $O(h^{-2})$。\n\n在棋盘格模式上的定量对比：\n- 对于 $p_{i,j} = (-1)^{i+j}$，在周期性网格上，同位映射精确地得出 $\\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = 0$，因此 $\\mathrm{RMS}_{\\mathrm{collocated}} = 0$（在舍入误差范围内）。\n- 对于 MAC 映射中相同的 $p_{i,j}$，直接计算可得\n  $$\n  \\left(\\partial_x p\\right)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h} = \\frac{-2(-1)^{i+j}}{h},\n  $$\n  因此 $u_{i+\\frac{1}{2},j} = \\frac{2(-1)^{i+j}}{\\alpha h}$，类似地 $v_{i,j+\\frac{1}{2}} = \\frac{2(-1)^{i+j}}{\\alpha h}$。所以，\n  $$\n  \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h} = \\frac{4(-1)^{i+j}}{\\alpha h^2}, \\quad \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h} = \\frac{4(-1)^{i+j}}{\\alpha h^2},\n  $$\n  总散度为\n  $$\n  \\left(\\nabla \\cdot \\boldsymbol{u}\\right)_{i,j} = \\frac{8(-1)^{i+j}}{\\alpha h^2}.\n  $$\n  因此，RMS 的标度律为\n  $$\n  \\mathrm{RMS}_{\\mathrm{MAC}} = \\frac{8}{\\alpha h^2},\n  $$\n  对于小的 $h$ 来说，这是一个很大的、明显非零的值。\n\n算法设计：\n- 为每个测试用例在 $N \\times N$ 周期性网格上构建 $p_{i,j}$。\n- 通过数组循环移位实现周期性中心差分，以评估同位映射的单元中心梯度和散度。\n- 通过数组移位为 MAC 映射实现面差分和通量差分。\n- 计算每个映射和每个测试用例的离散散度的 RMS。\n- 以指定格式返回成对列表 $\\left[\\mathrm{RMS}_{\\mathrm{collocated}}, \\mathrm{RMS}_{\\mathrm{MAC}}\\right]$。\n\n测试套件覆盖范围：\n- 用例 1 和用例 4 在不同的 $N$ 上针对 $2h$ 棋盘格模式 $p_{i,j} = (-1)^{i+j}$，旨在突出同位映射中的零空间和 MAC 映射中的非零响应。\n- 用例 2 是一个平滑的制造压力，两种格式都应该能“看到”，并在两种映射中都产生非零响应。\n- 用例 3 使用一维棋盘格模式 $p_{i,j} = (-1)^i$，它也位于同位映射在 $x$ 方向的 $2h$ 零空间中，但对于 MAC 映射则不然。\n\n程序完全按照定义实现了这些映射，并打印所需的列表。其中，在棋盘格用例中接近于零的 $\\mathrm{RMS}_{\\mathrm{collocated}}$ 证实了振荡模式的解耦，而 MAC 映射则对这些模式保持敏感。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_pressure(mode: str, N: int) -> np.ndarray:\n    \"\"\"\n    Construct manufactured pressure fields p[i,j] on an N x N periodic grid.\n\n    Modes:\n    - \"checkerboard2d\": p[i,j] = (-1)^(i+j)\n    - \"checkerboardX\":  p[i,j] = (-1)^i\n    - \"smooth\":         p[i,j] = sin(2*pi*x_i) + sin(4*pi*y_j), x_i=i/N, y_j=j/N\n    \"\"\"\n    i = np.arange(N).reshape(N, 1)\n    j = np.arange(N).reshape(1, N)\n    if mode == \"checkerboard2d\":\n        # (-1)^(i+j): use parity to avoid large powers\n        p = np.where(((i + j) % 2) == 0, 1.0, -1.0)\n    elif mode == \"checkerboardX\":\n        p = np.where((i % 2) == 0, 1.0, -1.0) * np.ones((1, N))\n    elif mode == \"smooth\":\n        x = (i / N).astype(float)  # shape (N,1)\n        y = (j / N).astype(float)  # shape (1,N)\n        p = np.sin(2.0 * np.pi * x) + np.sin(4.0 * np.pi * y)\n    else:\n        raise ValueError(\"Unknown mode\")\n    return p.astype(float)\n\ndef divergence_collocated_from_pressure(p: np.ndarray, alpha: float = 1.0) -> np.ndarray:\n    \"\"\"\n    Collocated mapping:\n    - Cell-centered gradients: central differences at cell centers.\n    - Cell-centered velocities from linear momentum.\n    - Divergence via central differences of cell-centered velocities (equiv. avg-to-face then difference).\n    Periodic boundary conditions via np.roll.\n    \"\"\"\n    N = p.shape[0]\n    h = 1.0 / N\n\n    # Cell-centered gradients (central differences)\n    dpdx_c = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2.0 * h)\n    dpdy_c = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2.0 * h)\n\n    # Cell-centered velocities\n    u_c = -dpdx_c / alpha\n    v_c = -dpdy_c / alpha\n\n    # Divergence: central difference of cell-centered velocities\n    div = (np.roll(u_c, -1, axis=0) - np.roll(u_c, 1, axis=0)) / (2.0 * h)\n    div += (np.roll(v_c, -1, axis=1) - np.roll(v_c, 1, axis=1)) / (2.0 * h)\n    return div\n\ndef divergence_mac_from_pressure(p: np.ndarray, alpha: float = 1.0) -> np.ndarray:\n    \"\"\"\n    MAC mapping:\n    - Face-normal gradients: one-cell differences at faces.\n    - Face-centered velocities from linear momentum.\n    - Divergence at centers: difference of face fluxes over h.\n    Periodic boundary conditions via np.roll.\n    \"\"\"\n    N = p.shape[0]\n    h = 1.0 / N\n\n    # Face-centered velocities from pressure differences\n    # u at i+1/2,j uses forward difference in i (x-direction)\n    u_right = -(np.roll(p, -1, axis=0) - p) / (h * alpha)  # u_{i+1/2,j}\n    u_left  = -(p - np.roll(p, 1, axis=0)) / (h * alpha)   # u_{i-1/2,j}\n    # v at i,j+1/2 uses forward difference in j (y-direction)\n    v_top    = -(np.roll(p, -1, axis=1) - p) / (h * alpha) # v_{i,j+1/2}\n    v_bottom = -(p - np.roll(p, 1, axis=1)) / (h * alpha)  # v_{i,j-1/2}\n\n    # Divergence at centers: (u_right - u_left)/h + (v_top - v_bottom)/h\n    div = (u_right - u_left) / h + (v_top - v_bottom) / h\n    return div\n\ndef rms(field: np.ndarray) -> float:\n    return float(np.sqrt(np.mean(field**2)))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (mode, N)\n    test_cases = [\n        (\"checkerboard2d\", 16),  # Case 1\n        (\"smooth\", 16),          # Case 2\n        (\"checkerboardX\", 32),   # Case 3\n        (\"checkerboard2d\", 8),   # Case 4\n    ]\n\n    results = []\n    for mode, N in test_cases:\n        p = build_pressure(mode, N)\n        div_coll = divergence_collocated_from_pressure(p, alpha=1.0)\n        div_mac = divergence_mac_from_pressure(p, alpha=1.0)\n        rms_coll = rms(div_coll)\n        rms_mac = rms(div_mac)\n        results.append([rms_coll, rms_mac])\n\n    # Final print statement in the exact required format.\n    # Print raw Python-like list with nested lists.\n    print(str(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}