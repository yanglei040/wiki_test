{
    "hands_on_practices": [
        {
            "introduction": "The finite volume method's strength lies in its foundation on the integral form of a conservation law, which makes it robust and adaptable to complex geometries. This exercise takes you back to first principles, tasking you with discretizing the divergence operator on a polar coordinate grid . By working directly from the divergence theorem on an annular control volume, you will see how metric terms, such as the radius $r$ in the area element $r \\, \\mathrm{d}r \\, \\mathrm{d}\\theta$, arise naturally and must be handled consistently to maintain conservation.",
            "id": "3409398",
            "problem": "Consider a steady conservation law for a scalar being transported by a flux field in the Euclidean plane expressed in polar coordinates. Let $\\mathbf{f}(r,\\theta)=f_{r}(r,\\theta)\\,\\mathbf{e}_{r}+f_{\\theta}(r,\\theta)\\,\\mathbf{e}_{\\theta}$ be a sufficiently smooth flux vector field, where $\\mathbf{e}_{r}$ and $\\mathbf{e}_{\\theta}$ are the polar unit basis vectors. Using the divergence theorem as the fundamental starting point, derive a metric-consistent finite volume method (FVM) discretization for the cell-averaged divergence over a polar control volume $\\mathcal{C}_{i,j}=[r_{i-\\frac{1}{2}},r_{i+\\frac{1}{2}}]\\times[\\theta_{j-\\frac{1}{2}},\\theta_{j+\\frac{1}{2}}]$. Your derivation must begin from the integral conservation form $\\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A=\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s$ specialized to polar coordinates, and it must explicitly exhibit the correct $r$-weighted measures on faces and in area. Do not assume any “shortcut” formulas for curvilinear coordinates; instead, reason from the geometry of the control volume in polar coordinates.\n\nThen, for a single annular-sector control volume with $r$-edges $R_{1}=r_{i-\\frac{1}{2}}$ and $R_{2}=r_{i+\\frac{1}{2}}$ and angular edges $\\Theta_{1}=\\theta_{j-\\frac{1}{2}}$ and $\\Theta_{2}=\\theta_{j+\\frac{1}{2}}$, apply your metric-consistent FVM formula using exact face integrals to the flux field\n$$\nf_{r}(r,\\theta)=a\\,r^{2}\\cos\\theta,\\qquad f_{\\theta}(r,\\theta)=b\\,r^{3}\\sin\\!\\bigl(2\\theta\\bigr),\n$$\nwhere $a$ and $b$ are constants. Provide the resulting closed-form expression for the discrete cell-averaged divergence $\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j}$ in terms of $a$, $b$, $R_{1}$, $R_{2}$, $\\Theta_{1}$, and $\\Theta_{2}$. The final answer must be a single analytical expression. No numerical rounding is required. Clearly state the final expression. Acronyms must be defined on first use, for example, Partial Differential Equation (PDE) and Finite Volume Method (FVM).",
            "solution": "The problem is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique analytical solution. It is a standard exercise in the numerical solution of Partial Differential Equations (PDEs). Therefore, the problem is valid, and a solution will be provided.\n\nThe core of the Finite Volume Method (FVM) is the discretization of the integral form of a conservation law. We are given the steady conservation law in integral form over a control volume $\\mathcal{C}_{i,j}$:\n$$\n\\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A = \\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s\n$$\nwhere $\\mathbf{f}$ is the flux vector, $\\mathbf{n}$ is the outward-pointing unit normal to the boundary $\\partial\\mathcal{C}_{i,j}$, $\\mathrm{d}A$ is the differential area element, and $\\mathrm{d}s$ is the differential line element along the boundary.\n\nThe cell-averaged divergence, denoted $\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j}$, is defined as the total divergence within the cell divided by the cell's area $A_{i,j}$:\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A\n$$\nSubstituting the divergence theorem gives the fundamental FVM formula:\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s\n$$\n\nOur task is to evaluate the right-hand side for a control volume in polar coordinates. The control volume $\\mathcal{C}_{i,j}$ is an annular sector defined by $r \\in [r_{i-\\frac{1}{2}}, r_{i+\\frac{1}{2}}]$ and $\\theta \\in [\\theta_{j-\\frac{1}{2}}, \\theta_{j+\\frac{1}{2}}]$. The boundary $\\partial\\mathcal{C}_{i,j}$ consists of four faces:\n$1$. The outer face at $r = r_{i+\\frac{1}{2}}$, where $\\theta$ varies from $\\theta_{j-\\frac{1}{2}}$ to $\\theta_{j+\\frac{1}{2}}$. Here, the outward normal is $\\mathbf{n} = \\mathbf{e}_r$ and the differential arc length is $\\mathrm{d}s = r_{i+\\frac{1}{2}}\\mathrm{d}\\theta$.\n$2$. The inner face at $r = r_{i-\\frac{1}{2}}$, where $\\theta$ varies. The outward normal is $\\mathbf{n} = -\\mathbf{e}_r$ and the arc length is $\\mathrm{d}s = r_{i-\\frac{1}{2}}\\mathrm{d}\\theta$.\n$3$. The clockwise face at $\\theta = \\theta_{j+\\frac{1}{2}}$, where $r$ varies from $r_{i-\\frac{1}{2}}$ to $r_{i+\\frac{1}{2}}$. The outward normal is $\\mathbf{n} = \\mathbf{e}_\\theta$ and the line element is $\\mathrm{d}s = \\mathrm{d}r$.\n$4$. The counter-clockwise face at $\\theta = \\theta_{j-\\frac{1}{2}}$, where $r$ varies. The outward normal is $\\mathbf{n} = -\\mathbf{e}_\\theta$ and the line element is $\\mathrm{d}s = \\mathrm{d}r$.\n\nThe flux vector is given in polar components as $\\mathbf{f} = f_r \\mathbf{e}_r + f_\\theta \\mathbf{e}_\\theta$. The total flux through the boundary, $\\oint \\mathbf{f}\\cdot\\mathbf{n}\\,\\mathrm{d}s$, is the sum of the fluxes through these four faces:\n\\begin{align*}\n\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s &= \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathbf{f}(r_{i+\\frac{1}{2}}, \\theta) \\cdot \\mathbf{e}_r \\, (r_{i+\\frac{1}{2}} \\mathrm{d}\\theta) \\\\\n&+ \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathbf{f}(r_{i-\\frac{1}{2}}, \\theta) \\cdot (-\\mathbf{e}_r) \\, (r_{i-\\frac{1}{2}} \\mathrm{d}\\theta) \\\\\n&+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} \\mathbf{f}(r, \\theta_{j+\\frac{1}{2}}) \\cdot \\mathbf{e}_\\theta \\, \\mathrm{d}r \\\\\n&+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} \\mathbf{f}(r, \\theta_{j-\\frac{1}{2}}) \\cdot (-\\mathbf{e}_\\theta) \\, \\mathrm{d}r\n\\end{align*}\nEvaluating the dot products yields:\n\\begin{align*}\n\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s = &\\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} f_r(r_{i+\\frac{1}{2}}, \\theta) r_{i+\\frac{1}{2}} \\mathrm{d}\\theta - \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} f_r(r_{i-\\frac{1}{2}}, \\theta) r_{i-\\frac{1}{2}} \\mathrm{d}\\theta \\\\\n&+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta(r, \\theta_{j+\\frac{1}{2}}) \\mathrm{d}r - \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta(r, \\theta_{j-\\frac{1}{2}}) \\mathrm{d}r\n\\end{align*}\nThis expression correctly exhibits the $r$-weighted measure for the radial flux component, since the arc length element is $\\mathrm{d}s = r \\mathrm{d}\\theta$. The flux component $f_r$ is multiplied by the face length $r \\mathrm{d}\\theta$, leading to the term $r f_r$.\n\nThe area of the control volume $A_{i,j}$ is found by integrating the polar area element $\\mathrm{d}A = r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$:\n$$\nA_{i,j} = \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta = \\left(\\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathrm{d}\\theta\\right) \\left(\\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} r\\,\\mathrm{d}r\\right) = (\\theta_{j+\\frac{1}{2}} - \\theta_{j-\\frac{1}{2}}) \\left[\\frac{1}{2}r^2\\right]_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} = \\frac{1}{2}(\\theta_{j+\\frac{1}{2}} - \\theta_{j-\\frac{1}{2}})(r_{i+\\frac{1}{2}}^2 - r_{i-\\frac{1}{2}}^2)\n$$\nCombining these results gives the general metric-consistent FVM discretization for the cell-averaged divergence, based on exact face integrals:\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\left[ \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\left(r f_r\\right)|_{r=r_{i+\\frac{1}{2}}} \\mathrm{d}\\theta - \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\left(r f_r\\right)|_{r=r_{i-\\frac{1}{2}}} \\mathrm{d}\\theta + \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta|_{\\theta=\\theta_{j+\\frac{1}{2}}} \\mathrm{d}r - \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta|_{\\theta=\\theta_{j-\\frac{1}{2}}} \\mathrm{d}r \\right]\n$$\n\nNow, we apply this formula to the specific flux field and control volume.\nThe boundaries are $r_{i-\\frac{1}{2}} = R_1$, $r_{i+\\frac{1}{2}} = R_2$, $\\theta_{j-\\frac{1}{2}} = \\Theta_1$, and $\\theta_{j+\\frac{1}{2}} = \\Theta_2$. The flux components are $f_r(r,\\theta) = a r^2 \\cos\\theta$ and $f_\\theta(r,\\theta) = b r^3 \\sin(2\\theta)$.\n\nThe area of the control volume is:\n$$\nA = \\frac{1}{2}(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)\n$$\n\nNext, we evaluate the four boundary integrals exactly:\n$1$. Integral over the outer face at $r=R_2$:\n$$\n\\int_{\\Theta_1}^{\\Theta_2} (r f_r)|_{r=R_2} \\mathrm{d}\\theta = \\int_{\\Theta_1}^{\\Theta_2} R_2 (a R_2^2 \\cos\\theta) \\mathrm{d}\\theta = a R_2^3 \\int_{\\Theta_1}^{\\Theta_2} \\cos\\theta \\mathrm{d}\\theta = a R_2^3 [\\sin\\theta]_{\\Theta_1}^{\\Theta_2} = a R_2^3 (\\sin\\Theta_2 - \\sin\\Theta_1)\n$$\n$2$. Integral over the inner face at $r=R_1$:\n$$\n\\int_{\\Theta_1}^{\\Theta_2} (r f_r)|_{r=R_1} \\mathrm{d}\\theta = \\int_{\\Theta_1}^{\\Theta_2} R_1 (a R_1^2 \\cos\\theta) \\mathrm{d}\\theta = a R_1^3 \\int_{\\Theta_1}^{\\Theta_2} \\cos\\theta \\mathrm{d}\\theta = a R_1^3 (\\sin\\Theta_2 - \\sin\\Theta_1)\n$$\nThe net flux from the radial faces is the difference between these two: $a (R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1)$.\n\n$3$. Integral over the clockwise face at $\\theta=\\Theta_2$:\n$$\n\\int_{R_1}^{R_2} f_\\theta|_{\\theta=\\Theta_2} \\mathrm{d}r = \\int_{R_1}^{R_2} b r^3 \\sin(2\\Theta_2) \\mathrm{d}r = b \\sin(2\\Theta_2) \\left[\\frac{1}{4}r^4\\right]_{R_1}^{R_2} = \\frac{b}{4} \\sin(2\\Theta_2) (R_2^4 - R_1^4)\n$$\n$4$. Integral over the counter-clockwise face at $\\theta=\\Theta_1$:\n$$\n\\int_{R_1}^{R_2} f_\\theta|_{\\theta=\\Theta_1} \\mathrm{d}r = \\int_{R_1}^{R_2} b r^3 \\sin(2\\Theta_1) \\mathrm{d}r = b \\sin(2\\Theta_1) \\left[\\frac{1}{4}r^4\\right]_{R_1}^{R_2} = \\frac{b}{4} \\sin(2\\Theta_1) (R_2^4 - R_1^4)\n$$\nThe net flux from the angular faces is the difference: $\\frac{b}{4} (R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))$.\n\nThe total outgoing flux is the sum of the net fluxes from the radial and angular faces:\n$$\n\\oint \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s = a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))\n$$\nFinally, the discrete cell-averaged divergence is this total flux divided by the cell area:\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))}{\\frac{1}{2}(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)}\n$$\nThis expression can be rewritten by bringing the factor of $\\frac{1}{2}$ in the denominator to the numerator as a factor of $2$:\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{2}{(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)} \\left[ a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1)) \\right]\n$$\nThis is the final closed-form expression.",
            "answer": "$$\n\\boxed{\\frac{2}{(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)} \\left[ a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1)) \\right]}\n$$"
        },
        {
            "introduction": "Many physical systems are described by balance laws, where the divergence of a flux is balanced by a source term, written as $\\partial_t u + \\nabla\\cdot \\mathbf{f}(u) = s(u,\\mathbf{x})$. A critical challenge in discretizing such equations is to preserve physically important steady-state solutions, where the flux divergence exactly cancels the source. This practice guides you through the design and implementation of a \"well-balanced\" scheme, a technique that modifies the source term discretization to be consistent with the numerical flux, ensuring that these crucial equilibrium states are maintained exactly by the numerical method .",
            "id": "3409361",
            "problem": "Consider the one-dimensional balance law in integral conservation form on a periodic domain,\n$$\n\\frac{\\partial}{\\partial t} u(x,t) + \\frac{\\partial}{\\partial x} f(u(x,t)) = s(u(x,t),x), \\quad x \\in [0,1), \\ t \\ge 0,\n$$\nwith the flux given by the identity map\n$$\nf(u) = u,\n$$\nand assume that the source does not depend on the unknown,\n$$\ns(u,x) \\equiv s(x),\n$$\nso that nontrivial spatially varying steady states satisfy\n$$\n\\frac{\\partial}{\\partial x} f(u^\\star(x)) = s(x) \\quad \\Longleftrightarrow \\quad \\frac{\\partial}{\\partial x} u^\\star(x) = s(x).\n$$\nWork on a uniform mesh of $N$ control volumes with cell width $\\Delta x = 1/N$, periodic indexing $i \\in \\{0,1,\\dots,N-1\\}$, and denote the cell-average approximation at time level $n$ by $U_i^n \\approx \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t^n)\\,dx$. Use the explicit forward Euler finite volume update\n$$\nU_i^{n+1} \\;=\\; U_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+1/2}^n - F_{i-1/2}^n\\Big) \\;+\\; \\Delta t \\, S_i,\n$$\nwhere $F_{i+1/2}^n$ is a consistent numerical flux and $S_i$ is a discrete source. For the homogeneous flux, adopt the standard upwind numerical flux for right-going advection,\n$$\nF_{i+1/2}^n \\;=\\; U_i^n.\n$$\n\nYour tasks:\n\n1) Starting from the integral conservation form over a control volume and the definition of the numerical flux above, derive a discrete source $S_i$ that yields a well-balanced scheme which exactly preserves a discrete family of nontrivial steady states. Specifically, construct a discrete antiderivative sequence $\\{G_i\\}_{i=0}^{N-1}$ that approximates a potential $G(x)$ with $\\frac{d}{dx}G(x)=s(x)$, and define $S_i$ so that the scheme exactly preserves any discrete state of the form $U_i^\\star = G_i + C$, where $C$ is any constant. Prove that with your choice, the one-step update produces $U_i^{n+1}=U_i^n$ for any initial data satisfying $U_i^n = G_i + C$.\n\n2) Based on your derivation, implement a program that:\n- Uses periodic boundary conditions.\n- Constructs the discrete potential $\\{G_i\\}$ by enforcing the discrete difference relation\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} \\approx s\\big(x_{i-1/2}\\big),\n$$\nfor $i=0,1,\\dots,N-1$, with periodic indexing (indices modulo $N$), where $x_{i-1/2} = i\\,\\Delta x$.\n- Defines the discrete source as\n$$\nS_i = \\frac{G_i - G_{i-1}}{\\Delta x}.\n$$\n- Advances one explicit forward Euler time step with the upwind numerical flux for a prescribed Courant number $\\lambda = \\Delta t / \\Delta x$.\n\n3) Use your implementation to compute, for each of the following test cases, the maximum absolute one-step change\n$$\n\\max_{0 \\le i \\le N-1} \\left|U_i^{n+1} - U_i^n\\right|.\n$$\nAll tests use $N=200$ and periodic boundary conditions. The domain is $[0,1)$, and the Courant number $\\lambda$ is specified per test case.\n- Test 1 (smooth steady state, happy path): Let $s(x) = 2\\pi \\cos(2\\pi x)$. Construct $G_i$ from the discrete condition above, set $U_i^0 = G_i$ (i.e., choose the constant $C=0$), and use $\\lambda = 0.9$.\n- Test 2 (discontinuous source aligned with the grid): Let $s(x) = 1$ for $x \\in [0,0.5)$ and $s(x) = -1$ for $x \\in [0.5,1)$. Construct $G_i$ accordingly, set $U_i^0 = G_i$, and use $\\lambda = 0.9$.\n- Test 3 (perturbation of a steady state): Use the same $s(x)$ as in Test 1, construct $G_i$, and set $U_i^0 = G_i + \\varepsilon \\sin(4\\pi x_i)$ with $\\varepsilon = 10^{-3}$ and $x_i = (i+\\tfrac{1}{2})\\Delta x$. Use $\\lambda = 0.9$.\n- Test 4 (constant offset invariance, edge case at Courant limit): Use the same $s(x)$ as in Test 2, construct $G_i$, and set $U_i^0 = G_i + C$ with $C = 2.0$. Use $\\lambda = 1.0$.\n\nAll computations are nondimensional; no physical units are involved. Angles inside trigonometric functions are in radians.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), in the order of Tests 1 through 4. Each result must be a floating-point number equal to the maximum absolute one-step change as defined above.",
            "solution": "We begin with the integral conservation form of a one-dimensional balance law over a control volume $\\left[x_{i-1/2}, x_{i+1/2}\\right]$,\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t)\\,dx \\;+\\; \\left(f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t))\\right) \\;=\\; \\int_{x_{i-1/2}}^{x_{i+1/2}} s(u(x,t),x)\\,dx.\n$$\nLet $\\Delta x = x_{i+1/2} - x_{i-1/2}$ denote the mesh spacing, and $U_i(t)$ denote the cell average $U_i(t) = \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t)\\,dx$. A first-order explicit finite volume method with time step $\\Delta t$ evaluates the flux through cell interfaces with a numerical flux $F_{i\\pm 1/2}^n$ at time level $t^n$, and approximates the source integral with a discrete quantity $\\Delta x\\, S_i$. The forward Euler update reads\n$$\nU_i^{n+1} \\;=\\; U_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) \\;+\\; \\Delta t\\, S_i.\n$$\nIn our setting, the flux is $f(u) = u$, which is the linear advection flux with unit speed. For right-going flow, the upwind numerical flux is\n$$\nF_{i+1/2}^n = U_i^n,\n$$\nwhich is consistent with the physical flux and stable under the Courant–Friedrichs–Lewy (CFL) condition $\\lambda=\\Delta t/\\Delta x \\le 1$. The source is assumed to depend only on the spatial variable, $s(u,x)\\equiv s(x)$, and steady states must satisfy\n$$\n\\frac{d}{dx} u^\\star(x) = s(x).\n$$\nTo ensure an exactly well-balanced scheme for a discrete family of steady states, we introduce a discrete antiderivative $\\{G_i\\}$ that approximates a potential $G(x)$ with $G'(x) = s(x)$. We do not require an analytic $G$; instead, we construct $G_i$ directly from $s(x)$ via the discrete condition\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} = s\\left(x_{i-1/2}\\right), \\quad i=0,1,\\dots,N-1,\n$$\nwith periodic indexing, where $x_{i-1/2} = i \\Delta x$ denotes the location of the interface between cells $i-1$ and $i$. This recurrence defines $G$ up to an additive constant, which is immaterial for steady-state preservation.\n\nGiven $\\{G_i\\}$, we choose the discrete source as\n$$\nS_i = \\frac{G_i - G_{i-1}}{\\Delta x}.\n$$\nThe forward Euler update with the upwind flux can be written using the Courant number $\\lambda = \\Delta t/\\Delta x$ as\n$$\nU_i^{n+1} = U_i^n - \\lambda \\left(U_i^n - U_{i-1}^n\\right) + \\lambda \\left(G_i - G_{i-1}\\right).\n$$\nTo prove that this scheme is well-balanced for the discrete family $U_i^\\star = G_i + C$, where $C$ is any constant, substitute $U_i^n = U_i^\\star$:\n\n$$\n\\begin{aligned}\nU_i^{n+1} &= \\left(G_i + C\\right) - \\lambda \\left((G_i + C) - (G_{i-1} + C)\\right) + \\lambda \\left(G_i - G_{i-1}\\right) \\\\\n&= \\left(G_i + C\\right) - \\lambda \\left(G_i - G_{i-1}\\right) + \\lambda \\left(G_i - G_{i-1}\\right) \\\\\n&= G_i + C \\\\\n&= U_i^n.\n\\end{aligned}\n$$\n\nTherefore, the update yields $U_i^{n+1} = U_i^n$ for all $i$, exactly, for any $U_i^n$ that can be written as $G_i + C$. This proves that the scheme is exactly well-balanced for the family of nontrivial discrete steady states parameterized by the constant offset $C$.\n\nAlgorithmic design details:\n- Grid and periodicity: Let $N$ be the number of cells and $\\Delta x = 1/N$. Define interface locations $x_{i-1/2} = i\\,\\Delta x$ and cell centers $x_i = (i + \\tfrac{1}{2})\\Delta x$. Indices are taken modulo $N$ to enforce periodicity.\n- Discrete potential construction: Given a function $s(x)$, sample it at interfaces to obtain $s_{i-1/2} = s(x_{i-1/2})$. Fix $G_0$ arbitrarily (e.g., $G_0 = \\Delta x\\, s_{-1/2}$ or $G_0 = 0$) and construct\n$$\nG_i = G_{i-1} + \\Delta x\\, s_{i-1/2}, \\quad i=1,2,\\dots,N-1.\n$$\nThis ensures that the difference quotient recovers the interface samples of $s(x)$,\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} = s_{i-1/2}.\n$$\n- Source term: Set $S_i = (G_i - G_{i-1}) / \\Delta x$.\n- One-step update: With Courant number $\\lambda$, compute\n$$\nU_i^{n+1} = U_i^n - \\lambda \\left(U_i^n - U_{i-1}^n\\right) + \\lambda \\left(G_i - G_{i-1}\\right),\n$$\nwith index arithmetic modulo $N$ to implement periodic boundary conditions. For $\\lambda \\le 1$, this is stable for the homogeneous part.\n- Diagnostic: Report the maximum absolute one-step change,\n$$\n\\max_i |U_i^{n+1} - U_i^n|.\n$$\n\nTest suite design and expectations:\n- Test 1: $s(x) = 2\\pi \\cos(2\\pi x)$, $U_i^0 = G_i$, $\\lambda=0.9$. By the well-balanced property, the maximum absolute one-step change must be exactly zero in floating-point arithmetic because the cancellation in the update occurs term-by-term.\n- Test 2: $s(x) = 1$ on $[0,0.5)$ and $s(x) = -1$ on $[0.5,1)$, $U_i^0 = G_i$, $\\lambda=0.9$. The discontinuity is aligned with the grid interfaces for $N$ even. The discrete construction of $G$ still ensures exact cancellation and zero one-step change.\n- Test 3: Same $s(x)$ as Test 1, $U_i^0 = G_i + \\varepsilon \\sin(4\\pi x_i)$, $\\varepsilon=10^{-3}$, $\\lambda=0.9$. The perturbation evolves according to the upwind step applied to the perturbation itself:\n$$\nV_i^{n+1} = V_i^n - \\lambda (V_i^n - V_{i-1}^n), \\quad V_i^n = U_i^n - G_i,\n$$\nso the one-step change is nonzero and determined by the upwinding of the sinusoidal mode. The program computes and reports the resulting maximum change.\n- Test 4: Same $s(x)$ as Test 2, $U_i^0 = G_i + C$ with $C=2.0$, and $\\lambda=1.0$. The constant offset is preserved exactly because the homogeneous update depends only on differences $U_i - U_{i-1}$ and the source uses differences of $G$. The one-step change is exactly zero.\n\nThe final output format is a single line containing the list of four floating-point results in the order of Tests 1 through 4, as a comma-separated list enclosed in square brackets, for example\n$$\n[\\text{result1},\\text{result2},\\text{result3},\\text{result4}].\n$$",
            "answer": "```python\nimport numpy as np\n\ndef build_grid(N: int):\n    dx = 1.0 / N\n    # Cell centers and interfaces (periodic domain [0,1))\n    x_centers = (np.arange(N) + 0.5) * dx\n    x_interfaces = (np.arange(N) * dx) % 1.0\n    return dx, x_centers, x_interfaces\n\ndef s_smooth(x):\n    # s(x) = 2*pi*cos(2*pi*x)\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x)\n\ndef s_step(x):\n    # s(x) = 1 on [0,0.5), -1 on [0.5,1)\n    return np.where((x >= 0.5) & (x < 1.0), -1.0, 1.0)\n\ndef construct_G_from_s(N, dx, s_at_interfaces):\n    # Construct G_i such that (G_i - G_{i-1})/dx = s(x_{i-1/2})\n    G = np.zeros(N, dtype=np.float64)\n    # Set G[0] arbitrarily; using the recurrence ensures the desired differences\n    for i in range(1, N):\n        G[i] = G[i-1] + dx * s_at_interfaces[i]\n    return G\n\ndef upwind_one_step(U, G, lam):\n    # Periodic shift by one cell (i-1)\n    U_im1 = np.roll(U, 1)\n    G_im1 = np.roll(G, 1)\n    # Forward Euler update with upwind flux and well-balanced source\n    U_new = U - lam * (U - U_im1) + lam * (G - G_im1)\n    return U_new\n\ndef max_one_step_change(U, G, lam):\n    U_new = upwind_one_step(U, G, lam)\n    return float(np.max(np.abs(U_new - U)))\n\ndef run_tests():\n    results = []\n\n    # Common grid\n    N = 200\n    dx, x_centers, x_interfaces = build_grid(N)\n\n    # Test 1: smooth steady state, lambda = 0.9\n    lam1 = 0.9\n    s_intf_1 = s_smooth(x_interfaces)\n    G1 = construct_G_from_s(N, dx, s_intf_1)\n    U0_1 = G1.copy()  # steady state (C=0)\n    res1 = max_one_step_change(U0_1, G1, lam1)\n    results.append(res1)\n\n    # Test 2: discontinuous source aligned with grid, lambda = 0.9\n    lam2 = 0.9\n    s_intf_2 = s_step(x_interfaces)\n    G2 = construct_G_from_s(N, dx, s_intf_2)\n    U0_2 = G2.copy()  # steady state (C=0)\n    res2 = max_one_step_change(U0_2, G2, lam2)\n    results.append(res2)\n\n    # Test 3: perturbation of steady state, lambda = 0.9, epsilon=1e-3\n    lam3 = 0.9\n    s_intf_3 = s_smooth(x_interfaces)\n    G3 = construct_G_from_s(N, dx, s_intf_3)\n    epsilon = 1e-3\n    U0_3 = G3 + epsilon * np.sin(4.0 * np.pi * x_centers)\n    res3 = max_one_step_change(U0_3, G3, lam3)\n    results.append(res3)\n\n    # Test 4: constant offset invariance at Courant limit, lambda = 1.0\n    lam4 = 1.0\n    s_intf_4 = s_step(x_interfaces)\n    G4 = construct_G_from_s(N, dx, s_intf_4)\n    C = 2.0\n    U0_4 = G4 + C\n    res4 = max_one_step_change(U0_4, G4, lam4)\n    results.append(res4)\n\n    return results\n\ndef solve():\n    results = run_tests()\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Nonlinear hyperbolic conservation laws, such as the inviscid Burgers' equation, are known to develop discontinuous solutions (shocks), even from smooth initial data. A key theoretical and numerical challenge is ensuring the computed weak solution is the physically relevant one, which requires satisfying an entropy condition. This hands-on coding exercise introduces you to the concept of entropy-stable numerical fluxes, which are designed to dissipate the correct amount of mathematical entropy to capture shocks correctly . You will implement two different entropy-stable fluxes and quantitatively compare their dissipative properties, providing a direct link between numerical scheme design and the physical correctness of the solution.",
            "id": "3409438",
            "problem": "Consider the scalar conservation law for inviscid Burgers’ equation in one spatial dimension, given by the partial differential equation (PDE)\n$$\n\\partial_t u + \\partial_x f(u) = 0,\\quad f(u) = \\frac{u^2}{2},\n$$\nposed on the periodic domain $[0,1)$ with period $1$. Start from the integral conservation law on a control volume, namely\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x + \\left[f\\big(u(x_{i+\\frac{1}{2}}^{-},t)\\big) - f\\big(u(x_{i-\\frac{1}{2}}^{+},t)\\big)\\right] = 0,\n$$\nand discretize the spatial domain into $N$ uniform control volumes of width $\\Delta x = 1/N$, with cell-averaged unknowns\n$$\nu_i(t) \\approx \\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x,\\quad i=0,1,\\dots,N-1,\n$$\nusing periodic indexing modulo $N$. Approximate the interface fluxes by a numerical flux $\\widehat{f}(u_L,u_R)$ to obtain the semi-discrete control volume scheme\n$$\n\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\nEvolve the semi-discrete scheme in time using the Strong Stability Preserving Runge–Kutta (SSP-RK) third-order method with time step $\\Delta t$ chosen by the Courant–Friedrichs–Lewy (CFL) condition\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i|},\n$$\nwith $\\mathrm{CFL} = 0.4$ and the convention that the denominator is replaced by $\\max\\{\\max_i |u_i|, 10^{-12}\\}$ to avoid division by zero.\n\nDefine the convex mathematical entropy and entropy flux for Burgers’ equation by\n$$\nU(u) = \\frac{u^2}{2},\\qquad \\Psi(u) = \\frac{u^3}{3}.\n$$\nThe discrete total entropy at time $t$ is\n$$\n\\mathcal{E}(t) = \\sum_{i=0}^{N-1} U(u_i(t))\\,\\Delta x.\n$$\nOn a periodic domain, the entropy flux through the boundary is zero. Therefore, discretizations that satisfy a discrete entropy inequality will yield $\\mathcal{E}(t)$ nonincreasing in time, and the discrete entropy dissipation over a time interval $[0,T]$ can be quantified by the difference\n$$\n\\Delta \\mathcal{E} = \\mathcal{E}(T) - \\mathcal{E}(0),\n$$\nwhich should be less than or equal to zero.\n\nImplement and compare two entropy-stable finite volume fluxes:\n- Lax–Friedrichs split flux. Use the two-point entropy-conservative flux for Burgers’ equation\n$$\n\\widehat{f}^{\\mathrm{EC}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right),\n$$\naugmented with Lax–Friedrichs dissipation\n$$\n\\widehat{f}^{\\mathrm{LF}}(u_L,u_R) = \\widehat{f}^{\\mathrm{EC}}(u_L,u_R) - \\frac{1}{2}\\,\\alpha^{\\mathrm{LF}}(u_R - u_L),\\quad \\alpha^{\\mathrm{LF}} = \\max\\{|u_L|,|u_R|\\}.\n$$\n- Harten–Lax–van Leer (HLL) flux. Use the characteristic signal speeds for Burgers’ equation, which are the minimum and maximum of the local characteristic speeds $s_L = \\min\\{u_L,u_R\\}$ and $s_R = \\max\\{u_L,u_R\\}$, to define\n$$\n\\widehat{f}^{\\mathrm{HLL}}(u_L,u_R) = \n\\begin{cases}\nf(u_L), & s_L \\ge 0,\\\\\nf(u_R), & s_R \\le 0,\\\\\n\\dfrac{s_R f(u_L) - s_L f(u_R) + s_L s_R (u_R - u_L)}{s_R - s_L}, & \\text{otherwise}.\n\\end{cases}\n$$\n\nTime integration must use the third-order SSP-RK method with the above $\\Delta t$. For each test case below, compute the discrete entropy dissipation $\\Delta \\mathcal{E}$ for both numerical fluxes and report the values.\n\nTest suite. Run the computation for the following three cases, each with its own parameters. All runs use $\\mathrm{CFL} = 0.4$ and periodic boundary conditions on $[0,1)$.\n- Case A (smooth, pre-shock): $N = 400$, final time $T = 0.12$, initial condition $u(x,0) = \\sin(2\\pi x)$, where $x$ is the cell center $x_i = (i+1/2)\\Delta x$.\n- Case B (discontinuous, shock and rarefaction): $N = 400$, final time $T = 0.10$, initial condition $u(x,0) = 1$ for $x \\in [0,0.5)$ and $u(x,0) = -1$ for $x \\in [0.5,1)$, with periodic wrap-around.\n- Case C (constant state): $N = 200$, final time $T = 0.10$, initial condition $u(x,0) = 0.7$ for all $x$.\n\nAnswer specification and output format. For each case, compute the discrete entropy dissipation values $\\Delta \\mathcal{E}^{\\mathrm{LF}}$ and $\\Delta \\mathcal{E}^{\\mathrm{HLL}}$ as real numbers (dimensionless), in this order. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[\\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{A}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{A}},\\ \\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{B}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{B}},\\ \\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{C}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{C}}\\right].\n$$\nEach number should be printed as a decimal with exactly eight digits after the decimal point. No other text should be printed. Since all quantities are nondimensional, no physical units are required.",
            "solution": "We begin from the integral conservation law for a control volume. For a scalar conservation law $\\partial_t u + \\partial_x f(u) = 0$ on a control volume $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$, integrating and using the Fundamental Theorem of Calculus yields\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x + f\\big(u(x_{i+\\frac{1}{2}}^{-},t)\\big) - f\\big(u(x_{i-\\frac{1}{2}}^{+},t)\\big) = 0.\n$$\nDefining the cell average $u_i(t) = \\frac{1}{\\Delta x}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x$ and approximating the fluxes by a consistent numerical flux $\\widehat{f}(u_L,u_R)$ leads to the semi-discrete finite volume scheme\n$$\n\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\nThis procedure directly encodes the conservation property at the discrete level because internal fluxes cancel when summing over all control volumes.\n\nFor Burgers’ equation, $f(u) = \\frac{u^2}{2}$, and the characteristic speed is $a(u) = f'(u) = u$. A convex mathematical entropy and its entropy flux are given by\n$$\nU(u) = \\frac{u^2}{2},\\qquad \\Psi(u) = \\int^u a(v)\\,U'(v)\\,\\mathrm{d}v = \\int^u v \\cdot v\\,\\mathrm{d}v = \\frac{u^3}{3}.\n$$\nWe measure discrete total entropy as $\\mathcal{E}(t) = \\sum_i U(u_i(t))\\Delta x$. On a periodic domain, the continuous entropy balance reads $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int U(u)\\,\\mathrm{d}x \\le 0$ for entropy solutions; at the discrete level, an entropy-stable finite volume flux $\\widehat{f}$ satisfies a cellwise inequality which, upon summing, implies $\\mathcal{E}(t)$ is nonincreasing.\n\nEntropy-stable flux construction proceeds by splitting into an entropy-conservative central flux plus an entropy dissipation. For Burgers’ equation, the two-point entropy-conservative flux (Tadmor flux) is\n$$\n\\widehat{f}^{\\mathrm{EC}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right).\n$$\nThis flux alone is non-dissipative and conserves the entropy discretely but is not stable in the presence of shocks. Adding a symmetric positive dissipation coefficient $d(u_L,u_R) \\ge 0$ in the form $-\\frac{1}{2} d(u_L,u_R)(u_R - u_L)$ yields an entropy-stable flux. A prototypical choice is the Lax–Friedrichs (also known as Rusanov) dissipation\n$$\n\\alpha^{\\mathrm{LF}}(u_L,u_R) = \\max\\{|a(u_L)|,|a(u_R)|\\} = \\max\\{|u_L|,|u_R|\\},\n$$\ngiving the Lax–Friedrichs split flux\n$$\n\\widehat{f}^{\\mathrm{LF}}(u_L,u_R) = \\widehat{f}^{\\mathrm{EC}}(u_L,u_R) - \\frac{1}{2}\\alpha^{\\mathrm{LF}}(u_R - u_L).\n$$\nThis choice is entropy-stable: the discrete entropy production at each interface is nonnegative and sums to a nonincreasing $\\mathcal{E}(t)$.\n\nAn alternative entropy-stable discretization uses an approximate Riemann solver. The Harten–Lax–van Leer (HLL) flux employs bounding signal speeds $s_L \\le 0 \\le s_R$ that enclose all local characteristic speeds. For Burgers’ equation, the local characteristic speeds are the states themselves, so a convenient choice is $s_L = \\min\\{u_L,u_R\\}$ and $s_R = \\max\\{u_L,u_R\\}$. The HLL flux is\n$$\n\\widehat{f}^{\\mathrm{HLL}}(u_L,u_R) = \n\\begin{cases}\nf(u_L), & s_L \\ge 0,\\\\\nf(u_R), & s_R \\le 0,\\\\\n\\dfrac{s_R f(u_L) - s_L f(u_R) + s_L s_R (u_R - u_L)}{s_R - s_L}, & \\text{otherwise}.\n\\end{cases}\n$$\nFor scalar convex fluxes, this coincides with the Godunov flux and is entropy-dissipative; thus it also yields a nonincreasing $\\mathcal{E}(t)$.\n\nTime integration uses the Strong Stability Preserving Runge–Kutta (SSP-RK) third-order scheme, which, when combined with a monotone (Total Variation Diminishing) spatial discretization under a suitable Courant–Friedrichs–Lewy (CFL) condition, preserves strong stability properties. The method updates $u^n$ to $u^{n+1}$ via\n$$\n\\begin{aligned}\nu^{(1)} &= u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\nu^{(2)} &= \\frac{3}{4}u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\nu^{n+1} &= \\frac{1}{3}u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right),\n\\end{aligned}\n$$\nwhere $\\mathcal{L}(u)$ is the finite volume spatial operator\n$$\n[\\mathcal{L}(u)]_i = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\nThe time step is chosen as\n$$\n\\Delta t = \\mathrm{CFL}\\cdot \\frac{\\Delta x}{\\max_i |u_i|},\n$$\nwith $\\mathrm{CFL} = 0.4$ and the maximum modulus safeguarded by taking $\\max\\{\\max_i |u_i|,10^{-12}\\}$.\n\nTo quantify discrete entropy dissipation, we compute\n$$\n\\Delta \\mathcal{E} = \\sum_{i=0}^{N-1} \\frac{u_i(T)^2}{2}\\,\\Delta x - \\sum_{i=0}^{N-1} \\frac{u_i(0)^2}{2}\\,\\Delta x.\n$$\nFor periodic boundaries, there is no boundary contribution to the entropy balance, so any monotone or entropy-stable flux should satisfy $\\Delta \\mathcal{E} \\le 0$. We evaluate $\\Delta \\mathcal{E}$ for both the Lax–Friedrichs split flux and the HLL flux on three test cases:\n- Case A: smooth $\\sin(2\\pi x)$ initial data at final time $T = 0.12$ with $N = 400$. This is near, but prior to, the exact shock formation time $t_s = 1/(2\\pi)$, so dissipation is expected to be small but nonzero due to numerical diffusion.\n- Case B: discontinuous step data with $u=1$ on $[0,0.5)$ and $u=-1$ on $[0.5,1)$ at $T = 0.10$ with $N = 400$. This contains shocks and rarefactions; dissipation is expected to be larger, with HLL typically less diffusive than Lax–Friedrichs on contact-free scalar problems, though both are entropy dissipative.\n- Case C: constant state $u=0.7$ at $T = 0.10$ with $N = 200$. The finite volume method with consistent numerical fluxes on a periodic grid preserves constants exactly, so $\\Delta \\mathcal{E}$ should be exactly zero up to roundoff.\n\nThe algorithm proceeds by:\n- discretizing the domain into $N$ cells with centers $x_i = (i+\\tfrac{1}{2})\\Delta x$,\n- initializing $u_i(0)$ from the specified initial condition,\n- evolving in time using SSP-RK with the chosen flux and adaptive $\\Delta t$ per the CFL rule,\n- computing $\\Delta \\mathcal{E}$ at $t=0$ and $t=T$,\n- repeating for both fluxes and all three test cases,\n- and printing the six values in the required order and format.\n\nThis design starts from the integral conservation law and uses a finite volume control volume discretization. The entropy framework motivates the flux choices and the metric $\\Delta \\mathcal{E}$ as a quantifiable measure of discrete entropy dissipation. The periodic boundary ensures boundary entropy flux is zero, directly linking the observed change in $\\mathcal{E}$ to numerical dissipation.",
            "answer": "```python\nimport numpy as np\n\ndef flux_physical(u):\n    return 0.5 * u * u\n\ndef flux_entropy_conservative(uL, uR):\n    # Tadmor EC flux for Burgers: (uL^2 + uL*uR + uR^2)/6\n    return (uL*uL + uL*uR + uR*uR) / 6.0\n\ndef flux_LF_split(uL, uR):\n    f_ec = flux_entropy_conservative(uL, uR)\n    alpha = max(abs(uL), abs(uR))\n    return f_ec - 0.5 * alpha * (uR - uL)\n\ndef flux_HLL(uL, uR):\n    fL = flux_physical(uL)\n    fR = flux_physical(uR)\n    sL = min(uL, uR)\n    sR = max(uL, uR)\n    if sL >= 0.0:\n        return fL\n    elif sR <= 0.0:\n        return fR\n    else:\n        denom = sR - sL\n        # denom > 0 because sR > sL when sL < 0 < sR\n        return (sR * fL - sL * fR + sL * sR * (uR - uL)) / denom\n\ndef compute_fluxes(u, flux_func):\n    N = len(u)\n    # Periodic indexing\n    fluxes = np.zeros(N, dtype=float)\n    for i in range(N):\n        uL = u[i]\n        uR = u[(i + 1) % N]\n        fluxes[i] = flux_func(uL, uR)\n    return fluxes\n\ndef spatial_operator(u, dx, flux_func):\n    N = len(u)\n    F = compute_fluxes(u, flux_func)\n    # Residual: -(F_{i+1/2} - F_{i-1/2})/dx\n    # Here F[i] corresponds to interface between i and i+1 (i+1/2)\n    # So F_imh for cell i is F[i-1], F_iph is F[i]\n    res = -(F - np.roll(F, 1)) / dx\n    return res\n\ndef ssp_rk3(u0, T, dx, CFL, flux_func):\n    u = u0.copy()\n    t = 0.0\n    while t < T - 1e-14:\n        umax = np.max(np.abs(u))\n        denom = max(umax, 1e-12)\n        dt = CFL * dx / denom\n        # Do not step beyond T\n        if t + dt > T:\n            dt = T - t\n        # Stage 1\n        L1 = spatial_operator(u, dx, flux_func)\n        u1 = u + dt * L1\n        # Stage 2\n        L2 = spatial_operator(u1, dx, flux_func)\n        u2 = 0.75 * u + 0.25 * (u1 + dt * L2)\n        # Stage 3\n        L3 = spatial_operator(u2, dx, flux_func)\n        u = (1.0/3.0) * u + (2.0/3.0) * (u2 + dt * L3)\n        t += dt\n    return u\n\ndef total_entropy(u, dx):\n    return np.sum(0.5 * u * u) * dx\n\ndef init_case_A(N):\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    return np.sin(2.0 * np.pi * x)\n\ndef init_case_B(N):\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    u = np.empty(N, dtype=float)\n    u[x < 0.5] = 1.0\n    u[x >= 0.5] = -1.0\n    return u\n\ndef init_case_C(N, c=0.7):\n    return np.full(N, c, dtype=float)\n\ndef run_case(u0, T, flux_func, CFL=0.4):\n    N = len(u0)\n    dx = 1.0 / N\n    E0 = total_entropy(u0, dx)\n    uT = ssp_rk3(u0, T, dx, CFL, flux_func)\n    ET = total_entropy(uT, dx)\n    return ET - E0\n\ndef solve():\n    # Test suite parameters\n    CFL = 0.4\n    # Case A\n    N_A = 400\n    T_A = 0.12\n    u0_A = init_case_A(N_A)\n    # Case B\n    N_B = 400\n    T_B = 0.10\n    u0_B = init_case_B(N_B)\n    # Case C\n    N_C = 200\n    T_C = 0.10\n    u0_C = init_case_C(N_C, c=0.7)\n\n    results = []\n\n    # Case A: LF split and HLL\n    dE_A_LF = run_case(u0_A, T_A, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_A_HLL = run_case(u0_A, T_A, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_A_LF, dE_A_HLL])\n\n    # Case B: LF split and HLL\n    dE_B_LF = run_case(u0_B, T_B, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_B_HLL = run_case(u0_B, T_B, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_B_LF, dE_B_HLL])\n\n    # Case C: LF split and HLL\n    dE_C_LF = run_case(u0_C, T_C, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_C_HLL = run_case(u0_C, T_C, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_C_LF, dE_C_HLL])\n\n    # Format with exactly 8 digits after decimal point\n    formatted = \",\".join(f\"{val:.8f}\" for val in results)\n    print(f\"[{formatted}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}