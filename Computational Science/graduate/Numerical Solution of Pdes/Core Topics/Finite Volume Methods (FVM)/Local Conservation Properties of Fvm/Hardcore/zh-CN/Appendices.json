{
    "hands_on_practices": [
        {
            "introduction": "本练习以一维线性平流方程为基础模型，旨在通过计算来检验几种常用离散方法的局部守恒特性。你将亲手实现并对比有限体积法（FVM）、有限差分法（FDM）和间断伽辽金法（DG），通过计算它们的单元平衡残差，直观地理解为何有些格式（如FVM）在构造上就能保证离散守恒，而另一些则不能。这个实践将帮助你牢固掌握局部守恒在离散层面上的精确含义。",
            "id": "3416942",
            "problem": "考虑一维线性平流方程的守恒形式，该方程定义在周期性域上，\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0,\\qquad f(u)=a\\,u,\\qquad x\\in[0,L],\n$$\n其中 $u(x,t)$ 是被平流的量，$a$ 是一个恒定的平流速度，$L$ 是域的长度。设域被均匀离散为 $N$ 个单元，单元大小为 $h=L/N$。对于任意单元 $K_i=[x_i,x_{i+1}]$，精确的局部守恒定律为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{x_i}^{x_{i+1}} u(x,t)\\,\\mathrm{d}x + \\big(f(u(x_{i+1}^{-},t)) - f(u(x_i^{+},t))\\big) = 0,\n$$\n该定律表明，单元积分的时间变化与穿过单元边界的净通量相平衡。本问题要求您在单个时间点 $t=0$ 时，计算三种离散化方法的离散单元平衡残差，并比较哪种方法逐单元地保持局部守恒。\n\n您必须实现并比较：\n- 有限体积法 (FVM)，使用分段常数单元平均值和标准的迎风数值通量；将单元平均值定义为位于单元中心的 $U_i$，面通量定义为 $F_{i+1/2}=a\\,U^{\\text{upwind}}$，并采用周期性边界条件。\n- 有限差分法 (FDM)，在网格节点 $x_j=jh$（$j=0,\\dots,N-1$）处使用中心差分，并采用周期性边界条件；将单元 $[x_i,x_{i+1}]$ 的隐含单元平均值定义为 $\\bar{u}_i=(u_i+u_{i+1})/2$，并使用节点中心差分时间导数来近似 $\\mathrm{d}\\bar{u}_i/\\mathrm{d}t$。\n- 间断伽辽金法 (DG)，在每个单元 $[x_i,x_{i+1}]$ 上定义，使用多项式次数 $p=1$（分段线性表示）和迎风数值通量；单元平均值的时间演化使用常数测试函数 $v=1$ 进行测试，面上的迹取自每个单元内部的多项式（在此设置中，构造多项式以匹配 $x_i$ 和 $x_{i+1}$ 处的端点值，因此其迹与端点处的精确初始值一致）。\n\n对于每种方法的每个单元 $i$，计算离散单元平衡残差\n$$\nB_i = h\\,\\frac{\\mathrm{d}}{\\mathrm{d}t}\\bar{u}_i + \\big(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\big),\n$$\n其中 $\\bar{u}_i$ 是该方法对应的单元平均值，$F_{i\\pm\\frac{1}{2}}$ 是单元 $i$ 左右两面的向外数值通量，并假定采用周期性索引。如果对于所有单元 $i$，$B_i$ 在离散意义上精确为0（在数值舍入误差范围内），则该方法保持局部守恒。\n\n您不需要进行时间演化；而是直接根据初始条件在 $t=0$ 时计算所有量。使用以下由频率参数 $k$ 定义的初始条件，其中 $k\\in\\mathbb{N}$ 被解释为在 $[0,L]$ 上的波长数：\n$$\nu(x,0) = \\begin{cases}\n\\sin\\big(2\\pi k\\,x/L\\big),  k>0,\\\\\n1,  k=0.\n\\end{cases}\n$$\n\n实现以下参数值的测试套件：\n- 测试 1：$L=1$, $N=32$, $a=1$, $k=1$。\n- 测试 2：$L=1$, $N=32$, $a=-1$, $k=1$。\n- 测试 3：$L=1$, $N=8$, $a=1$, $k=0$。\n- 测试 4：$L=1$, $N=16$, $a=1$, $k=2$。\n\n对于每个测试，计算每种方法在所有单元上的残差的最大绝对值：\n$$\nR^{\\text{FVM}}=\\max_i|B_i^{\\text{FVM}}|,\\quad R^{\\text{FDM}}=\\max_i|B_i^{\\text{FDM}}|,\\quad R^{\\text{DG}}=\\max_i|B_i^{\\text{DG}}|.\n$$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且本身是按 $[R^{\\text{FVM}},R^{\\text{FDM}},R^{\\text{DG}}]$ 顺序排列的三个浮点数的列表。例如，输出格式必须是\n$$\n\\big[\\,[R^{\\text{FVM}}_1,R^{\\text{FDM}}_1,R^{\\text{DG}}_1],[R^{\\text{FVM}}_2,R^{\\text{FDM}}_2,R^{\\text{DG}}_2],\\ldots\\,\\big].\n$$\n\n无需报告物理单位；所有量都是无量纲的。打印的数值必须是原始浮点数，不带任何附加文本。",
            "solution": "该问题要求分析三种数值方法——有限体积法 (FVM)、有限差分法 (FDM) 和间断伽辽金法 (DG)——对于一维线性平流方程 $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$ 的局部守恒性质。该分析通过为每种方法计算离散单元平衡残差 $B_i$ 在时间 $t=0$ 时进行。如果每个单元的此残差都为零，则该方法是局部守恒的。\n\n我们建立一个一致的离散化框架。域 $[0,L]$ 被划分为 $N$ 个单元，其中单元 $i$ 是区间 $[x_i, x_{i+1}]$，对于 $i=0, \\dots, N-1$。网格节点为 $x_i = i h$，单元宽度为 $h=L/N$。周期性意味着任何索引 $j$ 都被视为 $j \\pmod N$。单元 $i$ 的残差定义为 $B_i = h\\,\\frac{\\mathrm{d}}{\\mathrm{d}t}\\bar{u}_i + (F_{\\text{right}} - F_{\\text{left}})$，其中 $\\bar{u}_i$ 是特定于方法的单元平均值，$F_{\\text{right}}$ 和 $F_{\\text{left}}$ 分别是单元右侧 ($x_{i+1}$) 和左侧 ($x_i$) 面上的数值通量。\n\n初始条件由 $u(x,0)$ 给出，对于 $k>0$ 是正弦波，对于 $k=0$ 是常数。所有量都在 $t=0$ 时使用此初始条件进行评估。\n\n**1. 有限体积法 (FVM)**\n\nFVM 直接由守恒定律的积分形式构建。状态变量是单元平均值，$U_i(t) = \\frac{1}{h} \\int_{x_i}^{x_{i+1}} u(x,t) dx$。单元 $i$ 的 FVM 半离散形式通过平衡单元边界处的通量导出：\n$$\n\\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{1}{h} (F_{i+1} - F_i)\n$$\n其中 $F_j$ 是界面 $x_j$ 处的数值通量。问题指定了基于分段常数单元平均值的迎风通量。单元 $j-1$ 和单元 $j$ 之间界面 $x_j$ 处的通量 $F_j$ 是：\n$$\nF_j = \\begin{cases} a\\,U_{j-1}  \\text{ if } a > 0 \\\\ a\\,U_j  \\text{ if } a < 0 \\end{cases}\n$$\n要为 FVM 计算的残差是 $B_i^{\\text{FVM}} = h\\,\\frac{\\mathrm{d}U_i}{\\mathrm{d}t} + (F_{i+1} - F_i)$。将 FVM 半离散化代入 $\\frac{\\mathrm{d}U_i}{\\mathrm{d}t}$：\n$$\nB_i^{\\text{FVM}} = h \\left( -\\frac{1}{h} (F_{i+1} - F_i) \\right) + (F_{i+1} - F_i) = -(F_{i+1} - F_i) + (F_{i+1} - F_i) = 0\n$$\n这个结果纯粹是代数上的，并且无论 $U_i$ 的具体值或初始条件的形式如何都成立。FVM 通过其构造本身就是局部守恒的。因此，我们期望 $R^{\\text{FVM}} = \\max_i|B_i^{\\text{FVM}}|$ 为零，直至机器精度。\n\n**2. 间断伽辽金法 (DG)**\n\n该问题描述了一个使用分段线性多项式 ($p=1$) 的伽辽金方法。然而，“构造多项式以匹配 $x_i$ 和 $x_{i+1}$ 处的端点值”这一指令定义了一个全局连续的分段线性函数。这更准确地称为连续伽辽金 (CG) 方法。一个真正的 DG 方法将允许在单元边界处存在间断。我们遵循明确的指令进行。\n\n单元 $i$ 上的线性多项式是 $u_h(x) = u(x_i,0)\\frac{x_{i+1}-x}{h} + u(x_{i+1},0)\\frac{x-x_i}{h}$。单元平均值 $\\bar{u}_i$ 是 $u_h(x)$ 在 $[x_i, x_{i+1}]$ 上的积分除以 $h$：\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i}^{x_{i+1}} u_h(x) \\mathrm{d}x = \\frac{u(x_i,0) + u(x_{i+1},0)}{2}\n$$\n在伽辽金方法中，单元平均值的演化是通过在单元上用常数函数 $v(x)=1$ 测试偏微分方程找到的：\n$$\n\\int_{x_i}^{x_{i+1}} \\frac{\\partial u_h}{\\partial t} \\cdot 1 \\mathrm{d}x + F^*_{i+1} - F^*_{i} = 0 \\implies h \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F^*_{i+1} - F^*_i) = 0\n$$\n这里，$F^*_j$ 是面 $x_j$ 处的数值通量，指定为迎风通量。由于解 $u_h$ 是连续的，任何界面 $x_j$ 处的左右极限都是相同的：$u_h(x_j^-) = u_h(x_j^+) = u(x_j,0)$。因此，迎风通量简化为解析通量，$F^*_j = f(u(x_j,0)) = a\\,u(x_j,0)$。\n\n残差是 $B_i^{\\text{DG}} = h\\,\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F^*_{i+1} - F^*_i)$。根据伽辽金格式对单元平均值的定义，这恒等于零。与 FVM 一样，该方法通过其构造本身就是局部守恒的。我们期望 $R^{\\text{DG}} = \\max_i|B_i^{\\text{DG}}|$ 为零，直至机器精度。\n\n**3. 有限差分法 (FDM)**\n\nFDM 方法被指定为一种混合构造。我们使用节点值 $u_j = u(x_j,0)$。\n- 单元 $[x_i, x_{i+1}]$ 的隐含单元平均值是 $\\bar{u}_i = (u_i + u_{i+1})/2$。\n- 这个平均值的时间导数使用节点时间导数来近似：$\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} = \\frac{1}{2}(\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} + \\frac{\\mathrm{d}u_{i+1}}{\\mathrm{d}t})$。\n- 节点时间导数通过偏微分方程 $\\frac{\\partial u}{\\partial t} = -a\\frac{\\partial u}{\\partial x}$ 找到，其中空间导数用二阶中心差分来近似：$\\frac{\\mathrm{d}u_j}{\\mathrm{d}t} \\approx -a \\frac{u_{j+1}-u_{j-1}}{2h}$。\n- 面 $x_j$ 处的通量取为节点处的解析通量，$F_j = f(u_j) = a u_j$。\n\n将这些结合起来，项 $h \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t}$ 变为：\n$$\nh \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} = \\frac{h}{2} \\left[ \\left( -a \\frac{u_{i+1}-u_{i-1}}{2h} \\right) + \\left( -a \\frac{u_{i+2}-u_{i}}{2h} \\right) \\right] = -\\frac{a}{4} (u_{i+2} + u_{i+1} - u_i - u_{i-1})\n$$\n单元 $i$ 的残差是 $B_i^{\\text{FDM}} = h\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F_{i+1} - F_i)$：\n$$\nB_i^{\\text{FDM}} = -\\frac{a}{4} (u_{i+2} + u_{i+1} - u_i - u_{i-1}) + a(u_{i+1} - u_i)\n$$\n$$\nB_i^{\\text{FDM}} = a \\left[ -\\frac{1}{4}u_{i+2} + \\left(1-\\frac{1}{4}\\right)u_{i+1} + \\left(\\frac{1}{4}-1\\right)u_i + \\frac{1}{4}u_{i-1} \\right] = \\frac{a}{4}[-u_{i+2} + 3u_{i+1} - 3u_i + u_{i-1}]\n$$\n这个表达式通常不为零。它代表一个三阶有限差分模板，近似于 $-\\frac{a h^3}{4} \\frac{\\partial^3 u}{\\partial x^3}$。该残差是该方案各组成部分截断误差的体现，并且将不为零，除非 $u(x,0)$ 是一个次数为2或更低的多项式（使得 $\\frac{\\partial^3 u}{\\partial x^3}=0$）。对于测试用例 $k=0$，$u(x,0)=1$，因此所有导数都为零，残差也将为零。对于 $k>0$，残差将不为零，这表明这种 FDM 构造不是局部守恒的。\n\n**预测总结**：\n- 对于所有测试用例，$R^{\\text{FVM}}$ 和 $R^{\\text{DG}}$ 将近似为零，反映了它们固有的局部守恒性。\n- 对于 $k>0$，$R^{\\text{FDM}}$ 将不为零，而对于 $k=0$ 则为零。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residuals(L, N, a, k):\n    \"\"\"\n    Computes the maximum absolute cell-wise balance residuals for FVM, FDM, and DG.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of cells/nodes.\n        a (float): Advection speed.\n        k (int): Wavenumber for the initial condition.\n\n    Returns:\n        tuple: A tuple containing (R_fvm, R_fdm, R_dg).\n    \"\"\"\n    h = L / N\n    # Grid nodes x_j = j*h for j = 0, ..., N-1\n    x_nodes = np.linspace(0, L, N, endpoint=False)\n    \n    if k == 0:\n        u_nodes = np.ones(N)\n    else:\n        u_nodes = np.sin(2 * np.pi * k * x_nodes / L)\n\n    # --- FVM Calculation ---\n    # Cell i is [x_i, x_{i+1}]. Cell averages U_i are computed.\n    if k == 0:\n        U_cell_avg = np.ones(N)\n    else:\n        # U_i = (1/h) * integral of u(x,0) from x_i to x_{i+1}\n        # Integral of sin(c*x) is -cos(c*x)/c. c = 2*pi*k/L\n        # U_i = (1/h) * [-cos(c*x_{i+1})/c + cos(c*x_i)/c]\n        #     = (L / (2*pi*k*h)) * [cos(c*x_i) - cos(c*x_{i+1})]\n        #     = (N / (2*pi*k)) * [cos(2*pi*k*i/N) - cos(2*pi*k*(i+1)/N)]\n        i = np.arange(N)\n        U_cell_avg = (N / (2 * np.pi * k)) * (np.cos(2 * np.pi * k * i / N) - np.cos(2 * np.pi * k * (i + 1) / N))\n\n    # Flux F_j at interface between cell j-1 and j\n    # We use periodic indexing with np.roll\n    # If a > 0, F_j = a * U_{j-1}\n    # If a < 0, F_j = a * U_j\n    if a > 0:\n        # F_fluxes corresponds to F_0, F_1, ..., F_{N-1}\n        F_fluxes = a * np.roll(U_cell_avg, 1)\n    else:\n        F_fluxes = a * U_cell_avg\n    \n    # Residual for cell i: [x_i, x_{i+1}], uses fluxes F_i and F_{i+1}\n    F_left = F_fluxes\n    F_right = np.roll(F_fluxes, -1)\n    \n    h_dUdt = -(F_right - F_left)\n    B_fvm = h_dUdt + (F_right - F_left)\n    R_fvm = np.max(np.abs(B_fvm))\n\n    # --- FDM Calculation ---\n    # Residual for cell i: [x_i, x_{i+1}]\n    # B_i = (a/4)*[-u_{i+2} + 3*u_{i+1} - 3*u_i + u_{i-1}]\n    if k == 0:\n        R_fdm = 0.0\n    else:\n        u_im1 = np.roll(u_nodes, 1)\n        u_ip1 = np.roll(u_nodes, -1)\n        u_ip2 = np.roll(u_nodes, -2)\n        B_fdm = (a / 4.0) * (-u_ip2 + 3 * u_ip1 - 3 * u_nodes + u_im1)\n        R_fdm = np.max(np.abs(B_fdm))\n\n    # --- DG Calculation ---\n    # Described method is Continuous Galerkin (CG), not DG.\n    # Flux at node j is F*_j = a*u_j\n    F_star_fluxes = a * u_nodes\n    \n    # Residual for cell i: [x_i, x_{i+1}], uses fluxes F*_i and F*_{i+1}\n    F_star_left = F_star_fluxes\n    F_star_right = np.roll(F_star_fluxes, -1)\n    \n    # h * d(u_bar)_i/dt is defined by the scheme\n    h_dubar_dt = -(F_star_right - F_star_left)\n    B_dg = h_dubar_dt + (F_star_right - F_star_left)\n    R_dg = np.max(np.abs(B_dg))\n    \n    return [R_fvm, R_fdm, R_dg]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (L, N, a, k)\n        (1.0, 32, 1.0, 1),\n        (1.0, 32, -1.0, 1),\n        (1.0, 8, 1.0, 0),\n        (1.0, 16, 1.0, 2),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, N, a, k = case\n        residuals = calculate_residuals(L, N, a, k)\n        results.append(residuals)\n        \n    # Format the output string\n    # e.g., [[val1,val2,val3],[val4,val5,val6]]\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "真实世界的应用常常涉及复杂的几何形状，这要求数值格式在非正交网格上依然能保持准确性。本练习聚焦于处理扩散问题时，非正交性（网格扭曲）对有限体积法精度的影响。你将通过对一个扭曲四边形控制体进行细致的通量计算，定量地比较标准的“两点通量近似”（TPFA）与引入了“非正交修正”的通量格式。这个实践将让你直观地看到简单格式的误差来源，并理解如何通过设计更高级的通量格式，在保证局部守恒的同时恢复数值解的精度。",
            "id": "3417003",
            "problem": "考虑由守恒律 $\\nabla \\cdot (-k \\nabla u) = 0$ 控制的稳态各向同性扩散，其中扩散系数为常数 $k=1$。在有限体积法 (FVM) 中，局部守恒要求通过任何控制体表面的扩散通量之和等于在该体积上积分的净源项。我们处理一个扭曲的四边形控制体 $P$，其顶点（逆时针列出）为\n$\\mathbf{v}_1=(0,0)$、$\\mathbf{v}_2=(1,0.2)$、$\\mathbf{v}_3=(1.2,1.1)$、$\\mathbf{v}_4=(-0.1,0.9)$。\n通过将每条边的边矢量 $\\mathbf{e}_f=\\mathbf{v}_{i+1}-\\mathbf{v}_i$ 旋转 $-90^\\circ$ 来定义面面积矢量 $\\mathbf{S}_f$，即 $R_{-90^\\circ}(a,b)=(b,-a)$，因此 $\\mathbf{S}_f=R_{-90^\\circ}(\\mathbf{e}_f)$。设单元中心为 $\\mathbf{x}_P=(0.55,0.55)$，穿过 $\\mathbf{v}_2$ 和 $\\mathbf{v}_3$ 之间表面的相邻单元中心为 $\\mathbf{x}_N=(1.5,0.6)$。其余三个面为边界面。使用面中心 $\\mathbf{x}_{f_i}=\\frac{1}{2}(\\mathbf{v}_i+\\mathbf{v}_{i+1})$，其中 $i=1,2,3,4$。\n\n使用制造解 $u(x,y)=x+2y$，该解产生恒定梯度 $\\nabla u=(1,2)$。在边界面上，施加等于在面中心处计算的制造解的狄利克雷数据：$u_b=u(\\mathbf{x}_{f})$。\n\n使用两种模型计算单元 $P$ 每个面上的扩散通量：\n1) 一种正交两点通量模型，该模型假设 $\\nabla u$ 沿着连接相关点的直线为常数。对于内面，取 $\\mathbf{d}=\\mathbf{x}_N-\\mathbf{x}_P$；对于边界面，取 $\\mathbf{d}=\\mathbf{x}_f-\\mathbf{x}_P$。在此假设下，基于 $\\nabla u$ 在 $\\mathbf{d}$ 上的投影和面面积矢量 $\\mathbf{S}_f$，推导并使用正交通量 $F_f^{\\text{orth}}$。\n2) 一种非正交修正模型，通过将 $\\mathbf{S}_f$ 分解为一个平行于 $\\mathbf{d}$ 的正交分量和一个垂直于该直线的扭曲分量，并添加一个由在 $\\mathbf{x}_P$ 处的一致梯度重构构成的修正项得到。\n\n计算单元守恒残差 $R_P^{\\text{orth}}=\\sum_{f} F_f^{\\text{orth}}$ 和 $R_P^{\\text{corr}}=\\sum_{f} F_f^{\\text{corr}}$，其中求和遍及 $P$ 的四个面。最后，报告单个标量值 $R_P^{\\text{orth}}-R_P^{\\text{corr}}$。将您的答案四舍五入到四位有效数字。",
            "solution": "用户希望使用有限体积法 (FVM) 计算单个四边形控制体的两个守恒残差之差 $R_P^{\\text{orth}} - R_P^{\\text{corr}}$。\n\n### 第一步：问题验证\n\n**1.1. 提取的已知条件：**\n- **控制方程：** 稳态各向同性扩散，$\\nabla \\cdot (-k \\nabla u) = 0$，扩散系数 $k=1$。\n- **控制体几何：** 单个四边形单元 $P$，其逆时针顶点为 $\\mathbf{v}_1=(0,0)$、$\\mathbf{v}_2=(1,0.2)$、$\\mathbf{v}_3=(1.2,1.1)$ 和 $\\mathbf{v}_4=(-0.1,0.9)$。\n- **面面积矢量：** $\\mathbf{S}_f = R_{-90^\\circ}(\\mathbf{e}_f)$，其中 $\\mathbf{e}_f = \\mathbf{v}_{i+1}-\\mathbf{v}_i$ 是边矢量，且 $R_{-90^\\circ}(a,b)=(b,-a)$。\n- **单元中心与连接性：** 单元 $P$ 的中心为 $\\mathbf{x}_P=(0.55,0.55)$。$\\mathbf{v}_2$ 和 $\\mathbf{v}_3$ 之间的面是内面，相邻单元中心为 $\\mathbf{x}_N=(1.5,0.6)$。其余三个面是边界面。\n- **面中心：** $\\mathbf{x}_{f_i} = \\frac{1}{2}(\\mathbf{v}_i + \\mathbf{v}_{i+1})$。\n- **制造解：** $u(x,y) = x+2y$，这意味着梯度为常数 $\\nabla u = (1,2)$。\n- **边界条件：** 对于边界面，施加狄利克雷条件 $u_b = u(\\mathbf{x}_f)$。\n- **通量模型1（正交）：** $F_f^{\\text{orth}}$ 是一个两点通量，假设 $\\nabla u$ 沿着连接相关点的直线为常数。对于内面，连接这些点的矢量为 $\\mathbf{d}=\\mathbf{x}_N-\\mathbf{x}_P$；对于边界面，为 $\\mathbf{d}=\\mathbf{x}_f-\\mathbf{x}_P$。该通量基于 $\\nabla u$ 在 $\\mathbf{d}$ 上的投影。\n- **通量模型2（修正）：** $F_f^{\\text{corr}}$ 是通过在 $F_f^{\\text{orth}}$ 上添加非正交修正项得到的。此修正基于 $\\mathbf{S}_f$ 的分解和在 $\\mathbf{x}_P$ 处“一致的梯度重构”。\n- **目标：** 计算 $R_P^{\\text{orth}} - R_P^{\\text{corr}}$，其中 $R_P = \\sum_f F_f$，并将结果四舍五入到四位有效数字。\n\n**1.2. 验证：**\n该问题是偏微分方程数值解中的一个明确定义的练习，特别关注非正交网格上的有限体积法。\n- 它具有科学依据：所有概念（FVM、扩散、制造解、非正交修正）在计算物理和工程学中都是标准的。制造解 $u(x,y)=x+2y$ 满足控制方程 $\\nabla \\cdot (\\nabla u) = \\nabla \\cdot (1,2) = 0$。\n- 它是适定的：所有必要的几何数据、物理参数和模型定义都已提供，可以计算出唯一的答案。\n- 它是客观的：该问题以精确的数学术语陈述。\n\n该问题被视为有效。\n\n### 第二步：几何计算\n设控制体的四个面为 $f_1$（从 $\\mathbf{v}_1$ 到 $\\mathbf{v}_2$）、$f_2$（从 $\\mathbf{v}_2$ 到 $\\mathbf{v}_3$）、$f_3$（从 $\\mathbf{v}_3$ 到 $\\mathbf{v}_4$）和 $f_4$（从 $\\mathbf{v}_4$ 到 $\\mathbf{v}_1$）。\n\n**边矢量 $\\mathbf{e}_f$：**\n- $\\mathbf{e}_1 = \\mathbf{v}_2 - \\mathbf{v}_1 = (1, 0.2)$\n- $\\mathbf{e}_2 = \\mathbf{v}_3 - \\mathbf{v}_2 = (1.2-1, 1.1-0.2) = (0.2, 0.9)$\n- $\\mathbf{e}_3 = \\mathbf{v}_4 - \\mathbf{v}_3 = (-0.1-1.2, 0.9-1.1) = (-1.3, -0.2)$\n- $\\mathbf{e}_4 = \\mathbf{v}_1 - \\mathbf{v}_4 = (0-(-0.1), 0-0.9) = (0.1, -0.9)$\n\n**面面积矢量 $\\mathbf{S}_f$：**\n- $\\mathbf{S}_1 = (0.2, -1)$\n- $\\mathbf{S}_2 = (0.9, -0.2)$\n- $\\mathbf{S}_3 = (-0.2, 1.3)$\n- $\\mathbf{S}_4 = (-0.9, -0.1)$\n几何封闭性检查：$\\sum_f \\mathbf{S}_f = (0.2+0.9-0.2-0.9, -1-0.2+1.3-0.1) = (0,0)$，这是正确的。\n\n**面中心 $\\mathbf{x}_f$：**\n- $\\mathbf{x}_{f_1} = \\frac{1}{2}(\\mathbf{v}_1+\\mathbf{v}_2) = (0.5, 0.1)$\n- $\\mathbf{x}_{f_2} = \\frac{1}{2}(\\mathbf{v}_2+\\mathbf{v}_3) = (1.1, 0.65)$\n- $\\mathbf{x}_{f_3} = \\frac{1}{2}(\\mathbf{v}_3+\\mathbf{v}_4) = (0.55, 1)$\n- $\\mathbf{x}_{f_4} = \\frac{1}{2}(\\mathbf{v}_4+\\mathbf{v}_1) = (-0.05, 0.45)$\n\n**中心到中心/面的矢量 $\\mathbf{d}_f$：**\n- $f_1$ (边界面): $\\mathbf{d}_1 = \\mathbf{x}_{f_1} - \\mathbf{x}_P = (0.5-0.55, 0.1-0.55) = (-0.05, -0.45)$\n- $f_2$ (内面): $\\mathbf{d}_2 = \\mathbf{x}_N - \\mathbf{x}_P = (1.5-0.55, 0.6-0.55) = (0.95, 0.05)$\n- $f_3$ (边界面): $\\mathbf{d}_3 = \\mathbf{x}_{f_3} - \\mathbf{x}_P = (0.55-0.55, 1-0.55) = (0, 0.45)$\n- $f_4$ (边界面): $\\mathbf{d}_4 = \\mathbf{x}_{f_4} - \\mathbf{x}_P = (-0.05-0.55, 0.45-0.55) = (-0.6, -0.1)$\n\n### 第三步：计算正交通量 ($F_f^{\\text{orth}}$)\n正交通量模型通过将面上的梯度投影到矢量 $\\mathbf{d}_f$ 上来近似它。梯度近似值为 $(\\nabla u)_{\\text{orth}} = \\frac{(\\nabla u \\cdot \\mathbf{d}_f)}{|\\mathbf{d}_f|^2}\\mathbf{d}_f$。通量为 $F_f^{\\text{orth}} = -k (\\nabla u)_{\\text{orth}} \\cdot \\mathbf{S}_f$。当 $k=1$ 时，公式为：\n$$F_f^{\\text{orth}} = - \\frac{(\\nabla u \\cdot \\mathbf{d}_f)}{|\\mathbf{d}_f|^2} (\\mathbf{d}_f \\cdot \\mathbf{S}_f)$$\n制造解提供了 $\\nabla u = (1,2)$。\n\n- **面 $f_1$：**\n  $\\nabla u \\cdot \\mathbf{d}_1 = (1,2) \\cdot (-0.05, -0.45) = -0.05 - 0.9 = -0.95$\n  $|\\mathbf{d}_1|^2 = (-0.05)^2 + (-0.45)^2 = 0.0025 + 0.2025 = 0.205$\n  $\\mathbf{d}_1 \\cdot \\mathbf{S}_1 = (-0.05, -0.45) \\cdot (0.2, -1) = -0.01 + 0.45 = 0.44$\n  $F_{f_1}^{\\text{orth}} = - \\frac{-0.95}{0.205} (0.44) = \\frac{0.418}{0.205} = \\frac{418}{205}$\n\n- **面 $f_2$：**\n  $\\nabla u \\cdot \\mathbf{d}_2 = (1,2) \\cdot (0.95, 0.05) = 0.95 + 0.1 = 1.05$\n  $|\\mathbf{d}_2|^2 = (0.95)^2 + (0.05)^2 = 0.9025 + 0.0025 = 0.905$\n  $\\mathbf{d}_2 \\cdot \\mathbf{S}_2 = (0.95, 0.05) \\cdot (0.9, -0.2) = 0.855 - 0.01 = 0.845$\n  $F_{f_2}^{\\text{orth}} = - \\frac{1.05}{0.905} (0.845) = -\\frac{0.88725}{0.905} = -\\frac{3549}{3620}$\n\n- **面 $f_3$：**\n  $\\nabla u \\cdot \\mathbf{d}_3 = (1,2) \\cdot (0, 0.45) = 0.9$\n  $|\\mathbf{d}_3|^2 = 0^2 + (0.45)^2 = 0.2025$\n  $\\mathbf{d}_3 \\cdot \\mathbf{S}_3 = (0, 0.45) \\cdot (-0.2, 1.3) = 0.585$\n  $F_{f_3}^{\\text{orth}} = - \\frac{0.9}{0.2025} (0.585) = -\\frac{0.5265}{0.2025} = -2.6$\n\n- **面 $f_4$：**\n  $\\nabla u \\cdot \\mathbf{d}_4 = (1,2) \\cdot (-0.6, -0.1) = -0.6 - 0.2 = -0.8$\n  $|\\mathbf{d}_4|^2 = (-0.6)^2 + (-0.1)^2 = 0.36 + 0.01 = 0.37$\n  $\\mathbf{d}_4 \\cdot \\mathbf{S}_4 = (-0.6, -0.1) \\cdot (-0.9, -0.1) = 0.54 + 0.01 = 0.55$\n  $F_{f_4}^{\\text{orth}} = - \\frac{-0.8}{0.37} (0.55) = \\frac{0.44}{0.37} = \\frac{44}{37}$\n\n### 第四步：计算修正通量 ($F_f^{\\text{corr}}$)\n修正通量为 $F_f^{\\text{corr}} = F_f^{\\text{orth}} + C_f$，其中 $C_f$ 是非正交修正项。该修正项旨在弥补正交梯度近似中的误差。该误差项为 $-k ((\\nabla u)_{\\text{recon}} - (\\nabla u)_{\\text{orth}}) \\cdot \\mathbf{S}_f$。题目指定在 $\\mathbf{x}_P$ 处使用“一致的梯度重构”。给定制造解，最一致的重构是精确梯度，即 $\\nabla u=(1,2)$。\n$$F_f^{\\text{corr}} = -k (\\nabla u)_{\\text{orth}} \\cdot \\mathbf{S}_f - k ((\\nabla u) - (\\nabla u)_{\\text{orth}}) \\cdot \\mathbf{S}_f = -k (\\nabla u) \\cdot \\mathbf{S}_f$$\n因此，修正通量就是精确通量，用精确梯度 $\\nabla u=(1,2)$ 和 $k=1$ 计算得出。\n$$F_f^{\\text{corr}} = - (1,2) \\cdot \\mathbf{S}_f$$\n\n- $F_{f_1}^{\\text{corr}} = - (1,2) \\cdot (0.2, -1) = - (0.2 - 2) = 1.8$\n- $F_{f_2}^{\\text{corr}} = - (1,2) \\cdot (0.9, -0.2) = - (0.9 - 0.4) = -0.5$\n- $F_{f_3}^{\\text{corr}} = - (1,2) \\cdot (-0.2, 1.3) = - (-0.2 + 2.6) = -2.4$\n- $F_{f_4}^{\\text{corr}} = - (1,2) \\cdot (-0.9, -0.1) = - (-0.9 - 0.2) = 1.1$\n\n### 第五步：计算守恒残差\n单元 $P$ 的守恒残差是其所有面上的通量之和。\n**正交残差：**\n$R_P^{\\text{orth}} = \\sum_f F_f^{\\text{orth}} = F_{f_1}^{\\text{orth}} + F_{f_2}^{\\text{orth}} + F_{f_3}^{\\text{orth}} + F_{f_4}^{\\text{orth}}$\n$R_P^{\\text{orth}} = \\frac{418}{205} - \\frac{3549}{3620} - 2.6 + \\frac{44}{37}$\n$R_P^{\\text{orth}} \\approx 2.03902439 - 0.98038674 - 2.6 + 1.18918919 \\approx -0.35217316$\n\n**修正残差：**\n$R_P^{\\text{corr}} = \\sum_f F_f^{\\text{corr}} = 1.8 - 0.5 - 2.4 + 1.1 = 0$\n正如预期的那样，对于一个无散矢量场（$\\nabla \\cdot (-k\\nabla u) = 0$），在一个闭合体积上精确通量的总和为零。\n\n### 第六步：最终计算\n所求的量是 $R_P^{\\text{orth}} - R_P^{\\text{corr}}$。\n$R_P^{\\text{orth}} - R_P^{\\text{corr}} = R_P^{\\text{orth}} - 0 = R_P^{\\text{orth}} \\approx -0.35217316$\n四舍五入到四位有效数字，得到 $-0.3522$。",
            "answer": "$$\\boxed{-0.3522}$$"
        }
    ]
}