{
    "hands_on_practices": [
        {
            "introduction": "The foundational principle of the Finite Volume Method (FVM) is its guarantee of local conservation. This practice provides a direct and quantitative way to understand this core concept by tasking you with computing the cell-wise conservation residual for a simple advection problem. By comparing the results from FVM with those from a standard Finite Difference Method (FDM) and a Galerkin-type method, you will see firsthand why FVM is described as being \"locally conservative by construction,\" a property not inherently shared by all numerical schemes. This exercise makes the abstract definition of conservation a concrete, computable quantity, clarifying its central role in the method's formulation.",
            "id": "3416942",
            "problem": "Consider the one-dimensional linear advection equation in conservative form, posed on a periodic domain,\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0,\\qquad f(u)=a\\,u,\\qquad x\\in[0,L],\n$$\nwhere $u(x,t)$ is the advected quantity, $a$ is a constant advection speed, and $L$ is the domain length. Let the domain be discretized uniformly into $N$ cells with cell size $h=L/N$. For any cell $K_i=[x_i,x_{i+1}]$, the exact local conservation law reads\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{x_i}^{x_{i+1}} u(x,t)\\,\\mathrm{d}x + \\big(f(u(x_{i+1}^{-},t)) - f(u(x_i^{+},t))\\big) = 0,\n$$\nwhich states that the temporal change of the cell integral is balanced by the net flux across the cell boundary. This problem asks you to compute, at a single time $t=0$, the discrete cell-wise balance residuals for three discretization approaches and to compare which maintain local conservation element-by-element.\n\nYou must implement and compare:\n- The Finite Volume Method (FVM), using piecewise constant cell averages and the standard upwind numerical flux; define the cell averages as $U_i$ located at the cell centers and the face fluxes as $F_{i+1/2}=a\\,U^{\\text{upwind}}$, with periodic boundary conditions.\n- The Finite Difference Method (FDM), using central differences at grid nodes $x_j=jh$ for $j=0,\\dots,N-1$ with periodic boundary conditions; define the implied cell averages as $\\bar{u}_i=(u_i+u_{i+1})/2$ for cells $[x_i,x_{i+1}]$, and use nodal central-difference time derivatives to approximate $\\mathrm{d}\\bar{u}_i/\\mathrm{d}t$.\n- The Discontinuous Galerkin Method (DG), defined on each cell $[x_i,x_{i+1}]$ using polynomial degree $p=1$ (piecewise linear representation) with the upwind numerical flux; the cell-average temporal evolution is tested using the constant test function $v=1$, and the face traces are taken from the polynomial inside each cell (in this setup, construct the polynomial to match the endpoint values at $x_i$ and $x_{i+1}$, so its traces coincide with the exact initial values at the endpoints).\n\nFor each method on each cell $i$, compute the discrete cell-wise balance residual\n$$\nB_i = h\\,\\frac{\\mathrm{d}}{\\mathrm{d}t}\\bar{u}_i + \\big(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\big),\n$$\nwhere $\\bar{u}_i$ is the cell average appropriate to the method, $F_{i\\pm\\frac{1}{2}}$ are the outward numerical fluxes at the right and left faces of cell $i$, and periodic indexing is assumed. A method maintains local conservation if, for all cells $i$, $B_i=0$ exactly in the discrete sense (up to numerical roundoff).\n\nYou will not evolve in time; instead, evaluate all quantities at $t=0$ directly from the initial condition. Use the following initial conditions defined by a frequency parameter $k$, with $k\\in\\mathbb{N}$ interpreted as the number of wavelengths over $[0,L]$:\n$$\nu(x,0) = \\begin{cases}\n\\sin\\big(2\\pi k\\,x/L\\big), & k>0,\\\\\n1, & k=0.\n\\end{cases}\n$$\n\nImplement the following test suite of parameter values:\n- Test $1$: $L=1$, $N=32$, $a=1$, $k=1$.\n- Test $2$: $L=1$, $N=32$, $a=-1$, $k=1$.\n- Test $3$: $L=1$, $N=8$, $a=1$, $k=0$.\n- Test $4$: $L=1$, $N=16$, $a=1$, $k=2$.\n\nFor each test, compute the maximum absolute value of the residual across all cells for each method:\n$$\nR^{\\text{FVM}}=\\max_i|B_i^{\\text{FVM}}|,\\quad R^{\\text{FDM}}=\\max_i|B_i^{\\text{FDM}}|,\\quad R^{\\text{DG}}=\\max_i|B_i^{\\text{DG}}|.\n$$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to a test case and is itself a list of three floats in the order $[R^{\\text{FVM}},R^{\\text{FDM}},R^{\\text{DG}}]$. For example, the output format must be\n$$\n\\big[\\,[R^{\\text{FVM}}_1,R^{\\text{FDM}}_1,R^{\\text{DG}}_1],[R^{\\text{FVM}}_2,R^{\\text{FDM}}_2,R^{\\text{DG}}_2],\\ldots\\,\\big].\n$$\n\nNo physical unit reporting is required; all quantities are dimensionless. The numerical values printed must be raw floats without any additional text.",
            "solution": "The problem requires an analysis of the local conservation properties of three numerical methods—Finite Volume (FVM), Finite Difference (FDM), and Discontinuous Galerkin (DG)—for the one-dimensional linear advection equation, $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$. The analysis is performed at time $t=0$ by computing a discrete cell-wise balance residual, $B_i$, for each method. A method is locally conservative if this residual is zero for every cell.\n\nWe establish a consistent discretization framework. The domain $[0,L]$ is divided into $N$ cells, where cell $i$ is the interval $[x_i, x_{i+1}]$ for $i=0, \\dots, N-1$. The grid nodes are $x_i = i h$ with cell width $h=L/N$. Periodicity implies that any index $j$ is treated as $j \\pmod N$. The residual for cell $i$ is defined as $B_i = h\\,\\frac{\\mathrm{d}}{\\mathrm{d}t}\\bar{u}_i + (F_{\\text{right}} - F_{\\text{left}})$, where $\\bar{u}_i$ is the method-specific cell average, and $F_{\\text{right}}$ and $F_{\\text{left}}$ are the numerical fluxes at the right ($x_{i+1}$) and left ($x_i$) faces of the cell, respectively.\n\nThe initial condition is given by $u(x,0)$, which is either a sinusoid for $k>0$ or a constant for $k=0$. All quantities are evaluated at $t=0$ using this initial condition.\n\n**1. Finite Volume Method (FVM)**\n\nThe FVM is formulated directly from the integral form of the conservation law. The state variables are the cell averages, $U_i(t) = \\frac{1}{h} \\int_{x_i}^{x_{i+1}} u(x,t) dx$. The semi-discrete form of the FVM for cell $i$ is derived by balancing fluxes at the cell boundaries:\n$$\n\\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{1}{h} (F_{i+1} - F_i)\n$$\nwhere $F_j$ is the numerical flux at the interface $x_j$. The problem specifies an upwind flux based on the piecewise constant cell averages. The flux $F_j$ at the interface between cell $j-1$ and cell $j$ is:\n$$\nF_j = \\begin{cases} a\\,U_{j-1} & \\text{if } a > 0 \\\\ a\\,U_j & \\text{if } a < 0 \\end{cases}\n$$\nThe residual to be computed for FVM is $B_i^{\\text{FVM}} = h\\,\\frac{\\mathrm{d}U_i}{\\mathrm{d}t} + (F_{i+1} - F_i)$. Substituting the FVM semi-discretization for $\\frac{\\mathrm{d}U_i}{\\mathrm{d}t}$:\n$$\nB_i^{\\text{FVM}} = h \\left( -\\frac{1}{h} (F_{i+1} - F_i) \\right) + (F_{i+1} - F_i) = -(F_{i+1} - F_i) + (F_{i+1} - F_i) = 0\n$$\nThis result is purely algebraic and holds regardless of the specific values of $U_i$ or the form of the initial condition. The FVM is locally conservative by construction. Therefore, we expect $R^{\\text{FVM}} = \\max_i|B_i^{\\text{FVM}}|$ to be zero, up to machine precision.\n\n**2. Discontinuous Galerkin (DG) Method**\n\nThe problem describes a Galerkin method using piecewise linear polynomials ($p=1$). However, the instruction to \"construct the polynomial to match the endpoint values at $x_i$ and $x_{i+1}$\" defines a globally continuous piecewise linear function. This is more accurately termed a Continuous Galerkin (CG) method. A true DG method would permit discontinuities at cell boundaries. We proceed following the explicit instructions.\n\nThe linear polynomial on cell $i$ is $u_h(x) = u(x_i,0)\\frac{x_{i+1}-x}{h} + u(x_{i+1},0)\\frac{x-x_i}{h}$. The cell average $\\bar{u}_i$ is the integral of $u_h(x)$ over $[x_i, x_{i+1}]$ divided by $h$:\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i}^{x_{i+1}} u_h(x) \\mathrm{d}x = \\frac{u(x_i,0) + u(x_{i+1},0)}{2}\n$$\nThe evolution of the cell average in a Galerkin method is found by testing the PDE with a constant function $v(x)=1$ over the cell:\n$$\n\\int_{x_i}^{x_{i+1}} \\frac{\\partial u_h}{\\partial t} \\cdot 1 \\mathrm{d}x + F^*_{i+1} - F^*_{i} = 0 \\implies h \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F^*_{i+1} - F^*_i) = 0\n$$\nHere, $F^*_j$ is the numerical flux at face $x_j$, specified as the upwind flux. Since the solution $u_h$ is continuous, the left and right limits at any interface $x_j$ are identical: $u_h(x_j^-) = u_h(x_j^+) = u(x_j,0)$. The upwind flux thus simplifies to the analytical flux, $F^*_j = f(u(x_j,0)) = a\\,u(x_j,0)$.\n\nThe residual is $B_i^{\\text{DG}} = h\\,\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F^*_{i+1} - F^*_i)$. By the definition of the Galerkin scheme for the cell average, this is identically zero. Like FVM, this method is locally conservative by construction. We expect $R^{\\text{DG}} = \\max_i|B_i^{\\text{DG}}|$ to be zero up to machine precision.\n\n**3. Finite Difference Method (FDM)**\n\nThe FDM approach is specified as a hybrid construction. We use nodal values $u_j = u(x_j,0)$.\n- The implied cell average for cell $[x_i, x_{i+1}]$ is $\\bar{u}_i = (u_i + u_{i+1})/2$.\n- The time derivative of this average is approximated using nodal time derivatives: $\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} = \\frac{1}{2}(\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} + \\frac{\\mathrm{d}u_{i+1}}{\\mathrm{d}t})$.\n- The nodal time derivatives are found using the PDE, $\\frac{\\partial u}{\\partial t} = -a\\frac{\\partial u}{\\partial x}$, with the spatial derivative approximated by a second-order central difference: $\\frac{\\mathrm{d}u_j}{\\mathrm{d}t} \\approx -a \\frac{u_{j+1}-u_{j-1}}{2h}$.\n- The fluxes at faces $x_j$ are taken to be the analytical flux at the nodes, $F_j = f(u_j) = a u_j$.\n\nCombining these, the term $h \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t}$ becomes:\n$$\nh \\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} = \\frac{h}{2} \\left[ \\left( -a \\frac{u_{i+1}-u_{i-1}}{2h} \\right) + \\left( -a \\frac{u_{i+2}-u_{i}}{2h} \\right) \\right] = -\\frac{a}{4} (u_{i+2} + u_{i+1} - u_i - u_{i-1})\n$$\nThe residual for cell $i$ is $B_i^{\\text{FDM}} = h\\frac{\\mathrm{d}\\bar{u}_i}{\\mathrm{d}t} + (F_{i+1} - F_i)$:\n$$\nB_i^{\\text{FDM}} = -\\frac{a}{4} (u_{i+2} + u_{i+1} - u_i - u_{i-1}) + a(u_{i+1} - u_i)\n$$\n$$\nB_i^{\\text{FDM}} = a \\left[ -\\frac{1}{4}u_{i+2} + \\left(1-\\frac{1}{4}\\right)u_{i+1} + \\left(\\frac{1}{4}-1\\right)u_i + \\frac{1}{4}u_{i-1} \\right] = \\frac{a}{4}[-u_{i+2} + 3u_{i+1} - 3u_i + u_{i-1}]\n$$\nThis expression is generally non-zero. It represents a third-order finite difference stencil, which approximates $-\\frac{a h^3}{4} \\frac{\\partial^3 u}{\\partial x^3}$. The residual is a manifestation of the truncation error of the scheme's components and will be non-zero unless $u(x,0)$ is a polynomial of degree 2 or less (making $\\frac{\\partial^3 u}{\\partial x^3}=0$). For the test case $k=0$, $u(x,0)=1$, so all derivatives are zero and the residual will be zero. For $k>0$, the residual will be non-zero, demonstrating that this FDM construction is not locally conservative.\n\n**Summary of Predictions**:\n- $R^{\\text{FVM}}$ and $R^{\\text{DG}}$ will be approximately zero for all test cases, reflecting their inherent local conservation.\n- $R^{\\text{FDM}}$ will be non-zero for $k>0$ and zero for $k=0$.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residuals(L, N, a, k):\n    \"\"\"\n    Computes the maximum absolute cell-wise balance residuals for FVM, FDM, and DG.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of cells/nodes.\n        a (float): Advection speed.\n        k (int): Wavenumber for the initial condition.\n\n    Returns:\n        tuple: A tuple containing (R_fvm, R_fdm, R_dg).\n    \"\"\"\n    h = L / N\n    # Grid nodes x_j = j*h for j = 0, ..., N-1\n    x_nodes = np.linspace(0, L, N, endpoint=False)\n    \n    if k == 0:\n        u_nodes = np.ones(N)\n    else:\n        u_nodes = np.sin(2 * np.pi * k * x_nodes / L)\n\n    # --- FVM Calculation ---\n    # Cell i is [x_i, x_{i+1}]. Cell averages U_i are computed.\n    if k == 0:\n        U_cell_avg = np.ones(N)\n    else:\n        # U_i = (1/h) * integral of u(x,0) from x_i to x_{i+1}\n        # Integral of sin(c*x) is -cos(c*x)/c. c = 2*pi*k/L\n        # U_i = (1/h) * [-cos(c*x_{i+1})/c + cos(c*x_i)/c]\n        #     = (L / (2*pi*k*h)) * [cos(c*x_i) - cos(c*x_{i+1})]\n        #     = (N / (2*pi*k)) * [cos(2*pi*k*i/N) - cos(2*pi*k*(i+1)/N)]\n        i = np.arange(N)\n        U_cell_avg = (N / (2 * np.pi * k)) * (np.cos(2 * np.pi * k * i / N) - np.cos(2 * np.pi * k * (i + 1) / N))\n\n    # Flux F_j at interface between cell j-1 and j\n    # We use periodic indexing with np.roll\n    # If a > 0, F_j = a * U_{j-1}\n    # If a < 0, F_j = a * U_j\n    if a > 0:\n        # F_fluxes corresponds to F_0, F_1, ..., F_{N-1}\n        F_fluxes = a * np.roll(U_cell_avg, 1)\n    else:\n        F_fluxes = a * U_cell_avg\n    \n    # Residual for cell i: [x_i, x_{i+1}], uses fluxes F_i and F_{i+1}\n    F_left = F_fluxes\n    F_right = np.roll(F_fluxes, -1)\n    \n    h_dUdt = -(F_right - F_left)\n    B_fvm = h_dUdt + (F_right - F_left)\n    R_fvm = np.max(np.abs(B_fvm))\n\n    # --- FDM Calculation ---\n    # Residual for cell i: [x_i, x_{i+1}]\n    # B_i = (a/4)*[-u_{i+2} + 3*u_{i+1} - 3*u_i + u_{i-1}]\n    if k == 0:\n        R_fdm = 0.0\n    else:\n        u_im1 = np.roll(u_nodes, 1)\n        u_ip1 = np.roll(u_nodes, -1)\n        u_ip2 = np.roll(u_nodes, -2)\n        B_fdm = (a / 4.0) * (-u_ip2 + 3 * u_ip1 - 3 * u_nodes + u_im1)\n        R_fdm = np.max(np.abs(B_fdm))\n\n    # --- DG Calculation ---\n    # Described method is Continuous Galerkin (CG), not DG.\n    # Flux at node j is F*_j = a*u_j\n    F_star_fluxes = a * u_nodes\n    \n    # Residual for cell i: [x_i, x_{i+1}], uses fluxes F*_i and F*_{i+1}\n    F_star_left = F_star_fluxes\n    F_star_right = np.roll(F_star_fluxes, -1)\n    \n    # h * d(u_bar)_i/dt is defined by the scheme\n    h_dubar_dt = -(F_star_right - F_star_left)\n    B_dg = h_dubar_dt + (F_star_right - F_star_left)\n    R_dg = np.max(np.abs(B_dg))\n    \n    return [R_fvm, R_fdm, R_dg]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (L, N, a, k)\n        (1.0, 32, 1.0, 1),\n        (1.0, 32, -1.0, 1),\n        (1.0, 8, 1.0, 0),\n        (1.0, 16, 1.0, 2),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, N, a, k = case\n        residuals = calculate_residuals(L, N, a, k)\n        results.append(residuals)\n        \n    # Format the output string\n    # e.g., [[val1,val2,val3],[val4,val5,val6]]\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "While local conservation is a cornerstone of FVM, it is not the sole determinant of a \"good\" numerical scheme. This exercise explores a crucial second property: the Discrete Maximum Principle (DMP), which ensures that numerical solutions behave physically in the absence of sources. Through a carefully constructed scenario on a non-admissible mesh, you will discover that a scheme can be perfectly conservative yet produce unphysical oscillations, violating the DMP. This practice is a valuable cautionary tale, highlighting the critical interplay between conservation, mesh quality, and the stability properties of the discretization itself.",
            "id": "3416962",
            "problem": "Consider steady diffusion governed by the partial differential equation $-\\nabla \\cdot (k \\nabla u) = 0$ with isotropic and spatially uniform diffusivity $k = 1$, zero volumetric sources, and piecewise constant Dirichlet boundary data. Discretize this equation by the Finite Volume Method (FVM) using a Two-Point Flux Approximation (TPFA) on a deliberately skew, non-admissible three-cell mesh that remains locally conservative but is known to be prone to violating the discrete maximum principle (DMP) due to skewness-induced coefficients. Let the control volumes be $V_{1}$, $V_{2}$, and $V_{3}$ arranged in a chain with two internal faces, between $V_{1}$ and $V_{2}$ and between $V_{2}$ and $V_{3}$. The outer boundary of $V_{1}$ is subject to Dirichlet data $u = 0$, and the outer boundary of $V_{3}$ is subject to Dirichlet data $u = 1$. There is no boundary face attached to $V_{2}$. Assume the following face-based TPFA fluxes oriented outward of a cell:\n- For an internal face shared by $V_{i}$ and $V_{j}$, the flux is $F_{i \\to j} = T_{ij}\\,(u_{i} - u_{j})$, with symmetric coefficients $T_{ij} = T_{ji}$, constructed from the skew mesh’s geometric projections. The internal-face transmissibilities are given by $T_{12} = -\\frac{1}{2}$ and $T_{23} = \\frac{5}{3}$, which can occur on strongly skew, non-admissible grids.\n- For a boundary face attached to $V_{1}$ with Dirichlet value $u = 0$, treat it as a ghost neighbor with transmissibility $T_{1b} = 1$, yielding the boundary flux $F_{1 \\to b} = T_{1b}\\,(u_{1} - 0)$. For a boundary face attached to $V_{3}$ with Dirichlet value $u = 1$, use $T_{3b} = 1$ and $F_{3 \\to b} = T_{3b}\\,(u_{3} - 1)$.\n\nUsing the conservation law as the fundamental base, namely that for each control volume $V_{i}$ the algebraic sum of outward fluxes through its faces is zero, write the three balance equations for the unknown cell-centered values $u_{1}$, $u_{2}$, and $u_{3}$ and solve the resulting linear system exactly. Then compute the overshoot\n$$\\delta \\equiv \\max\\{u_{1}, u_{2}, u_{3}\\} - 1,$$\nwhich quantifies the violation of the discrete maximum principle relative to the largest Dirichlet boundary value $1$.\n\nBriefly justify why the scheme remains locally conservative on each internal face even though it violates the discrete maximum principle. Provide the final numerical value of $\\delta$ rounded to four significant figures. No physical units are required.",
            "solution": "The problem statement is valid. It presents a well-posed problem in the numerical analysis of partial differential equations, specifically concerning the properties of the Finite Volume Method (FVM). The setup, while using a contrived non-admissible mesh to produce a specific outcome, is internally consistent and grounded in established theory regarding discretization methods.\n\nThe core principle of the Finite Volume Method is local conservation. For each control volume $V_i$, the net flux of the conserved quantity across its boundary is zero in the steady state with no sources or sinks. For a generic control volume $V_i$, this is expressed as:\n$$\n\\sum_{j \\in N(i)} F_{i \\to j} = 0\n$$\nwhere $N(i)$ is the set of neighbors of cell $i$ (including boundary patches treated as neighbors) and $F_{i \\to j}$ is the flux from cell $i$ to cell $j$. The problem provides the flux laws for the Two-Point Flux Approximation (TPFA). We apply this conservation principle to each of the three control volumes $V_1$, $V_2$, and $V_3$.\n\nFor control volume $V_1$:\nThe cell $V_1$ exchanges fluxes with its internal neighbor $V_2$ and a boundary face with a prescribed value $u=0$. The balance equation is:\n$$\nF_{1 \\to 2} + F_{1 \\to b} = 0\n$$\nUsing the given flux definitions, $F_{1 \\to 2} = T_{12}(u_1 - u_2)$ and $F_{1 \\to b} = T_{1b}(u_1 - 0)$. Substituting the given transmissibility values $T_{12} = -\\frac{1}{2}$ and $T_{1b} = 1$:\n$$\n\\left(-\\frac{1}{2}\\right)(u_1 - u_2) + (1)(u_1 - 0) = 0\n$$\n$$\n-\\frac{1}{2}u_1 + \\frac{1}{2}u_2 + u_1 = 0\n$$\n$$\n\\frac{1}{2}u_1 + \\frac{1}{2}u_2 = 0 \\implies u_1 + u_2 = 0\n$$\n\nFor control volume $V_2$:\nThe cell $V_2$ is an internal cell and exchanges fluxes with its neighbors $V_1$ and $V_3$. The balance equation is:\n$$\nF_{2 \\to 1} + F_{2 \\to 3} = 0\n$$\nThe fluxes are $F_{2 \\to 1} = T_{21}(u_2 - u_1)$ and $F_{2 \\to 3} = T_{23}(u_2 - u_3)$. Given that transmissibilities are symmetric, $T_{21} = T_{12} = -\\frac{1}{2}$. The other given value is $T_{23} = \\frac{5}{3}$.\n$$\n\\left(-\\frac{1}{2}\\right)(u_2 - u_1) + \\left(\\frac{5}{3}\\right)(u_2 - u_3) = 0\n$$\nMultiplying by $6$ to clear the denominators:\n$$\n-3(u_2 - u_1) + 10(u_2 - u_3) = 0\n$$\n$$\n-3u_2 + 3u_1 + 10u_2 - 10u_3 = 0\n$$\n$$\n3u_1 + 7u_2 - 10u_3 = 0\n$$\n\nFor control volume $V_3$:\nThe cell $V_3$ exchanges fluxes with its internal neighbor $V_2$ and a boundary face with a prescribed value $u=1$. The balance equation is:\n$$\nF_{3 \\to 2} + F_{3 \\to b} = 0\n$$\nThe fluxes are $F_{3 \\to 2} = T_{32}(u_3 - u_2)$ and $F_{3 \\to b} = T_{3b}(u_3 - 1)$. With symmetric transmissibility $T_{32} = T_{23} = \\frac{5}{3}$ and the given $T_{3b}=1$:\n$$\n\\left(\\frac{5}{3}\\right)(u_3 - u_2) + (1)(u_3 - 1) = 0\n$$\nMultiplying by $3$:\n$$\n5(u_3 - u_2) + 3(u_3 - 1) = 0\n$$\n$$\n5u_3 - 5u_2 + 3u_3 - 3 = 0\n$$\n$$\n-5u_2 + 8u_3 = 3\n$$\n\nWe now have a system of three linear equations for the three unknowns $u_1$, $u_2$, and $u_3$:\n$$\n\\begin{cases}\n\\quad u_1 + u_2 = 0 & (1) \\\\\n\\quad 3u_1 + 7u_2 - 10u_3 = 0 & (2) \\\\\n\\quad -5u_2 + 8u_3 = 3 & (3)\n\\end{cases}\n$$\nFrom equation $(1)$, we find $u_1 = -u_2$. Substituting this into equation $(2)$:\n$$\n3(-u_2) + 7u_2 - 10u_3 = 0 \\implies 4u_2 - 10u_3 = 0 \\implies 2u_2 = 5u_3\n$$\nFrom this relationship, we can express $u_3$ in terms of $u_2$ as $u_3 = \\frac{2}{5}u_2$. Now we substitute this expression for $u_3$ into equation $(3)$:\n$$\n-5u_2 + 8\\left(\\frac{2}{5}u_2\\right) = 3\n$$\n$$\n-5u_2 + \\frac{16}{5}u_2 = 3\n$$\n$$\n\\left(-\\frac{25}{5} + \\frac{16}{5}\\right)u_2 = 3 \\implies -\\frac{9}{5}u_2 = 3\n$$\nSolving for $u_2$:\n$$\nu_2 = 3 \\cdot \\left(-\\frac{5}{9}\\right) = -\\frac{15}{9} = -\\frac{5}{3}\n$$\nNow we can find $u_1$ and $u_3$:\n$$\nu_1 = -u_2 = -\\left(-\\frac{5}{3}\\right) = \\frac{5}{3}\n$$\n$$\nu_3 = \\frac{2}{5}u_2 = \\frac{2}{5}\\left(-\\frac{5}{3}\\right) = -\\frac{2}{3}\n$$\nThe solution for the cell-centered values is $(u_1, u_2, u_3) = (\\frac{5}{3}, -\\frac{5}{3}, -\\frac{2}{3})$. The boundary conditions are $u=0$ and $u=1$. The discrete maximum principle (DMP) would require that all cell values lie within the range of boundary values, i.e., $0 \\le u_i \\le 1$. Our solution clearly violates this principle, with $u_1 \\approx 1.667$, $u_2 \\approx -1.667$, and $u_3 \\approx -0.667$. This violation stems from the negative transmissibility coefficient $T_{12}=-\\frac{1}{2}$, a known consequence of applying the TPFA on non-admissible (e.g., highly skewed) meshes.\n\nNext, we compute the overshoot $\\delta$:\n$$\n\\delta \\equiv \\max\\{u_1, u_2, u_3\\} - 1\n$$\n$$\n\\delta = \\max\\left\\{\\frac{5}{3}, -\\frac{5}{3}, -\\frac{2}{3}\\right\\} - 1 = \\frac{5}{3} - 1 = \\frac{2}{3}\n$$\nThe problem requires this value rounded to four significant figures.\n$$\n\\delta = \\frac{2}{3} \\approx 0.666666... \\approx 0.6667\n$$\n\nFinally, we justify why the scheme remains locally conservative. Local conservation on an internal face between cells $V_i$ and $V_j$ requires that the flux leaving $V_i$ into $V_j$ is the exact negative of the flux leaving $V_j$ into $V_i$. In our notation, this means $F_{i \\to j} = - F_{j \\to i}$.\nThe flux from $V_i$ to $V_j$ is defined as $F_{i \\to j} = T_{ij}(u_i - u_j)$.\nThe flux from $V_j$ to $V_i$ is defined as $F_{j \\to i} = T_{ji}(u_j - u_i)$.\nThe problem states that the transmissibility coefficients are symmetric, i.e., $T_{ij} = T_{ji}$. Using this property:\n$$\nF_{j \\to i} = T_{ji}(u_j - u_i) = T_{ij}(u_j - u_i) = -T_{ij}(u_i - u_j) = -F_{i \\to j}\n$$\nThis relationship holds for any value of $T_{ij}$, positive or negative. The local conservation property is thus a direct consequence of the symmetric definition of the inter-cell fluxes and is entirely independent of the sign of the transmissibility coefficients. Therefore, even though a negative $T_{ij}$ leads to a violation of the DMP, the FVM scheme remains locally conservative by construction.",
            "answer": "$$\n\\boxed{0.6667}\n$$"
        },
        {
            "introduction": "Engineering and scientific simulations rarely permit the use of perfectly regular, orthogonal grids. This hands-on practice delves into the practical challenges of applying FVM to the skewed, non-orthogonal meshes that arise in complex geometries. You will investigate how a simple two-point flux approximation, which is accurate on orthogonal grids, fails to properly enforce the conservation law when evaluated with an exact solution on a skewed cell, leading to a significant \"consistency error\". By quantifying this conservation residual, you will gain a fundamental appreciation for why more advanced non-orthogonal correction schemes and multi-point flux approximations are essential for achieving accuracy in real-world FVM simulations.",
            "id": "3417003",
            "problem": "Consider steady isotropic diffusion with constant coefficient $k=1$ governed by the conservation law $\\nabla \\cdot (-k \\nabla u) = 0$. In the Finite Volume Method (FVM), local conservation requires that the sum of diffusive fluxes across the faces of any control volume equals the net source integrated over that volume. Work with a single skewed quadrilateral control volume $P$ with vertices (listed counterclockwise)\n$\\mathbf{v}_1=(0,0)$, $\\mathbf{v}_2=(1,0.2)$, $\\mathbf{v}_3=(1.2,1.1)$, $\\mathbf{v}_4=(-0.1,0.9)$.\nDefine the face area vectors $\\mathbf{S}_f$ for each edge by rotating the edge vector $\\mathbf{e}_f=\\mathbf{v}_{i+1}-\\mathbf{v}_i$ by $-90^\\circ$, i.e., $R_{-90^\\circ}(a,b)=(b,-a)$, so that $\\mathbf{S}_f=R_{-90^\\circ}(\\mathbf{e}_f)$. Let the cell center be $\\mathbf{x}_P=(0.55,0.55)$ and the neighbor cell center across the face between $\\mathbf{v}_2$ and $\\mathbf{v}_3$ be $\\mathbf{x}_N=(1.5,0.6)$. The three remaining faces are boundary faces. Use face centers $\\mathbf{x}_{f_i}=\\frac{1}{2}(\\mathbf{v}_i+\\mathbf{v}_{i+1})$ for $i=1,2,3,4$.\n\nUse the manufactured solution $u(x,y)=x+2y$, which yields a constant gradient $\\nabla u=(1,2)$. On boundary faces, impose Dirichlet data equal to the manufactured solution evaluated at the face center: $u_b=u(\\mathbf{x}_{f})$.\n\nCompute the diffusive fluxes on each face of cell $P$ using two models:\n1) An orthogonal two-point flux model that assumes $\\nabla u$ is constant along the line connecting the relevant points. For the interior face, take $\\mathbf{d}=\\mathbf{x}_N-\\mathbf{x}_P$ and for a boundary face, take $\\mathbf{d}=\\mathbf{x}_f-\\mathbf{x}_P$. Under this assumption, derive and use the orthogonal flux $F_f^{\\text{orth}}$ based on the projection of $\\nabla u$ onto $\\mathbf{d}$ and the face area vector $\\mathbf{S}_f$.\n2) A non-orthogonally corrected model obtained by decomposing $\\mathbf{S}_f$ into an orthogonal component parallel to $\\mathbf{d}$ and a skew component orthogonal to that line, and adding a correction term formed with a consistent gradient reconstruction at $\\mathbf{x}_P$.\n\nCompute the cell-wise conservation residual $R_P^{\\text{orth}}=\\sum_{f} F_f^{\\text{orth}}$ and $R_P^{\\text{corr}}=\\sum_{f} F_f^{\\text{corr}}$, where the sum is over the four faces of $P$. Finally, report the single scalar quantity $R_P^{\\text{orth}}-R_P^{\\text{corr}}$. Round your answer to four significant figures.",
            "solution": "The user wants to compute the difference between two conservation residuals, $R_P^{\\text{orth}} - R_P^{\\text{corr}}$, for a single quadrilateral control volume using the Finite Volume Method (FVM).\n\n### Step 1: Problem Validation\n\n**1.1. Extracted Givens:**\n- **Governing Equation:** Steady isotropic diffusion, $\\nabla \\cdot (-k \\nabla u) = 0$, with diffusion coefficient $k=1$.\n- **Control Volume Geometry:** A single quadrilateral cell $P$ with counterclockwise vertices $\\mathbf{v}_1=(0,0)$, $\\mathbf{v}_2=(1,0.2)$, $\\mathbf{v}_3=(1.2,1.1)$, and $\\mathbf{v}_4=(-0.1,0.9)$.\n- **Face Area Vectors:** $\\mathbf{S}_f = R_{-90^\\circ}(\\mathbf{e}_f)$, where $\\mathbf{e}_f = \\mathbf{v}_{i+1}-\\mathbf{v}_i$ is the edge vector and $R_{-90^\\circ}(a,b)=(b,-a)$.\n- **Cell Centers & Connectivity:** Cell center of $P$ is $\\mathbf{x}_P=(0.55,0.55)$. The face between $\\mathbf{v}_2$ and $\\mathbf{v}_3$ is an interior face, with neighbor cell center $\\mathbf{x}_N=(1.5,0.6)$. The other three faces are boundary faces.\n- **Face Centers:** $\\mathbf{x}_{f_i} = \\frac{1}{2}(\\mathbf{v}_i + \\mathbf{v}_{i+1})$.\n- **Manufactured Solution:** $u(x,y) = x+2y$, which implies a constant gradient $\\nabla u = (1,2)$.\n- **Boundary Conditions:** For boundary faces, Dirichlet condition $u_b = u(\\mathbf{x}_f)$ is imposed.\n- **Flux Model 1 (Orthogonal):** $F_f^{\\text{orth}}$ is a two-point flux assuming $\\nabla u$ is constant along the line connecting the relevant points. The vector connecting these points is $\\mathbf{d}=\\mathbf{x}_N-\\mathbf{x}_P$ for the interior face and $\\mathbf{d}=\\mathbf{x}_f-\\mathbf{x}_P$ for boundary faces. The flux is based on the projection of $\\nabla u$ onto $\\mathbf{d}$.\n- **Flux Model 2 (Corrected):** $F_f^{\\text{corr}}$ is obtained by adding a non-orthogonal correction term to $F_f^{\\text{orth}}$. This correction is based on a decomposition of $\\mathbf{S}_f$ and a \"consistent gradient reconstruction at $\\mathbf{x}_P$\".\n- **Objective:** Compute $R_P^{\\text{orth}} - R_P^{\\text{corr}}$, where $R_P = \\sum_f F_f$, and round to four significant figures.\n\n**1.2. Validation:**\nThe problem is a well-defined exercise in the numerical solution of partial differential equations, specifically focusing on the finite volume method on non-orthogonal grids.\n- It is **scientifically grounded**: All concepts (FVM, diffusion, manufactured solution, non-orthogonal correction) are standard in computational physics and engineering. The manufactured solution $u(x,y)=x+2y$ satisfies the governing equation $\\nabla \\cdot (\\nabla u) = \\nabla \\cdot (1,2) = 0$.\n- It is **well-posed**: All necessary geometric data, physical parameters, and model definitions are provided to compute a unique answer.\n- It is **objective**: The problem is stated in precise mathematical terms.\n\nThe problem is deemed **valid**.\n\n### Step 2: Geometric Calculations\nLet the four faces of the control volume be $f_1$ (from $\\mathbf{v}_1$ to $\\mathbf{v}_2$), $f_2$ (from $\\mathbf{v}_2$ to $\\mathbf{v}_3$), $f_3$ (from $\\mathbf{v}_3$ to $\\mathbf{v}_4$), and $f_4$ (from $\\mathbf{v}_4$ to $\\mathbf{v}_1$).\n\n**Edge vectors $\\mathbf{e}_f$:**\n- $\\mathbf{e}_1 = \\mathbf{v}_2 - \\mathbf{v}_1 = (1, 0.2)$\n- $\\mathbf{e}_2 = \\mathbf{v}_3 - \\mathbf{v}_2 = (1.2-1, 1.1-0.2) = (0.2, 0.9)$\n- $\\mathbf{e}_3 = \\mathbf{v}_4 - \\mathbf{v}_3 = (-0.1-1.2, 0.9-1.1) = (-1.3, -0.2)$\n- $\\mathbf{e}_4 = \\mathbf{v}_1 - \\mathbf{v}_4 = (0-(-0.1), 0-0.9) = (0.1, -0.9)$\n\n**Face area vectors $\\mathbf{S}_f$:**\n- $\\mathbf{S}_1 = (0.2, -1)$\n- $\\mathbf{S}_2 = (0.9, -0.2)$\n- $\\mathbf{S}_3 = (-0.2, 1.3)$\n- $\\mathbf{S}_4 = (-0.9, -0.1)$\nA check for geometric closure: $\\sum_f \\mathbf{S}_f = (0.2+0.9-0.2-0.9, -1-0.2+1.3-0.1) = (0,0)$, which is correct.\n\n**Face centers $\\mathbf{x}_f$:**\n- $\\mathbf{x}_{f_1} = \\frac{1}{2}(\\mathbf{v}_1+\\mathbf{v}_2) = (0.5, 0.1)$\n- $\\mathbf{x}_{f_2} = \\frac{1}{2}(\\mathbf{v}_2+\\mathbf{v}_3) = (1.1, 0.65)$\n- $\\mathbf{x}_{f_3} = \\frac{1}{2}(\\mathbf{v}_3+\\mathbf{v}_4) = (0.55, 1)$\n- $\\mathbf{x}_{f_4} = \\frac{1}{2}(\\mathbf{v}_4+\\mathbf{v}_1) = (-0.05, 0.45)$\n\n**Center-to-center/face vectors $\\mathbf{d}_f$:**\n- $f_1$ (boundary): $\\mathbf{d}_1 = \\mathbf{x}_{f_1} - \\mathbf{x}_P = (0.5-0.55, 0.1-0.55) = (-0.05, -0.45)$\n- $f_2$ (interior): $\\mathbf{d}_2 = \\mathbf{x}_N - \\mathbf{x}_P = (1.5-0.55, 0.6-0.55) = (0.95, 0.05)$\n- $f_3$ (boundary): $\\mathbf{d}_3 = \\mathbf{x}_{f_3} - \\mathbf{x}_P = (0.55-0.55, 1-0.55) = (0, 0.45)$\n- $f_4$ (boundary): $\\mathbf{d}_4 = \\mathbf{x}_{f_4} - \\mathbf{x}_P = (-0.05-0.55, 0.45-0.55) = (-0.6, -0.1)$\n\n### Step 3: Calculation of Orthogonal Fluxes ($F_f^{\\text{orth}}$)\nThe orthogonal flux model approximates the gradient at the face by its projection onto the vector $\\mathbf{d}_f$. The gradient approximation is $(\\nabla u)_{\\text{orth}} = \\frac{(\\nabla u \\cdot \\mathbf{d}_f)}{|\\mathbf{d}_f|^2}\\mathbf{d}_f$. The flux is $F_f^{\\text{orth}} = -k (\\nabla u)_{\\text{orth}} \\cdot \\mathbf{S}_f$. With $k=1$, this is:\n$$F_f^{\\text{orth}} = - \\frac{(\\nabla u \\cdot \\mathbf{d}_f)}{|\\mathbf{d}_f|^2} (\\mathbf{d}_f \\cdot \\mathbf{S}_f)$$\nThe manufactured solution provides $\\nabla u = (1,2)$.\n\n- **Face $f_1$:**\n  $\\nabla u \\cdot \\mathbf{d}_1 = (1,2) \\cdot (-0.05, -0.45) = -0.05 - 0.9 = -0.95$\n  $|\\mathbf{d}_1|^2 = (-0.05)^2 + (-0.45)^2 = 0.0025 + 0.2025 = 0.205$\n  $\\mathbf{d}_1 \\cdot \\mathbf{S}_1 = (-0.05, -0.45) \\cdot (0.2, -1) = -0.01 + 0.45 = 0.44$\n  $F_{f_1}^{\\text{orth}} = - \\frac{-0.95}{0.205} (0.44) = \\frac{0.418}{0.205} = \\frac{418}{205}$\n\n- **Face $f_2$:**\n  $\\nabla u \\cdot \\mathbf{d}_2 = (1,2) \\cdot (0.95, 0.05) = 0.95 + 0.1 = 1.05$\n  $|\\mathbf{d}_2|^2 = (0.95)^2 + (0.05)^2 = 0.9025 + 0.0025 = 0.905$\n  $\\mathbf{d}_2 \\cdot \\mathbf{S}_2 = (0.95, 0.05) \\cdot (0.9, -0.2) = 0.855 - 0.01 = 0.845$\n  $F_{f_2}^{\\text{orth}} = - \\frac{1.05}{0.905} (0.845) = -\\frac{0.88725}{0.905} = -\\frac{3549}{3620}$\n\n- **Face $f_3$:**\n  $\\nabla u \\cdot \\mathbf{d}_3 = (1,2) \\cdot (0, 0.45) = 0.9$\n  $|\\mathbf{d}_3|^2 = 0^2 + (0.45)^2 = 0.2025$\n  $\\mathbf{d}_3 \\cdot \\mathbf{S}_3 = (0, 0.45) \\cdot (-0.2, 1.3) = 0.585$\n  $F_{f_3}^{\\text{orth}} = - \\frac{0.9}{0.2025} (0.585) = -\\frac{0.5265}{0.2025} = -2.6$\n\n- **Face $f_4$:**\n  $\\nabla u \\cdot \\mathbf{d}_4 = (1,2) \\cdot (-0.6, -0.1) = -0.6 - 0.2 = -0.8$\n  $|\\mathbf{d}_4|^2 = (-0.6)^2 + (-0.1)^2 = 0.36 + 0.01 = 0.37$\n  $\\mathbf{d}_4 \\cdot \\mathbf{S}_4 = (-0.6, -0.1) \\cdot (-0.9, -0.1) = 0.54 + 0.01 = 0.55$\n  $F_{f_4}^{\\text{orth}} = - \\frac{-0.8}{0.37} (0.55) = \\frac{0.44}{0.37} = \\frac{44}{37}$\n\n### Step 4: Calculation of Corrected Fluxes ($F_f^{\\text{corr}}$)\nThe corrected flux is $F_f^{\\text{corr}} = F_f^{\\text{orth}} + C_f$, where $C_f$ is the non-orthogonal correction term. The correction term is designed to account for the error in the orthogonal gradient approximation. This error term is $-k ((\\nabla u)_{\\text{recon}} - (\\nabla u)_{\\text{orth}}) \\cdot \\mathbf{S}_f$. The problem specifies using a \"consistent gradient reconstruction at $\\mathbf{x}_P$\". Given the manufactured solution, the most consistent reconstruction is the exact gradient, $\\nabla u=(1,2)$.\n$$F_f^{\\text{corr}} = -k (\\nabla u)_{\\text{orth}} \\cdot \\mathbf{S}_f - k ((\\nabla u) - (\\nabla u)_{\\text{orth}}) \\cdot \\mathbf{S}_f = -k (\\nabla u) \\cdot \\mathbf{S}_f$$\nSo, the corrected flux is simply the exact flux, calculated with the exact gradient $\\nabla u=(1,2)$ and $k=1$.\n$$F_f^{\\text{corr}} = - (1,2) \\cdot \\mathbf{S}_f$$\n\n- $F_{f_1}^{\\text{corr}} = - (1,2) \\cdot (0.2, -1) = - (0.2 - 2) = 1.8$\n- $F_{f_2}^{\\text{corr}} = - (1,2) \\cdot (0.9, -0.2) = - (0.9 - 0.4) = -0.5$\n- $F_{f_3}^{\\text{corr}} = - (1,2) \\cdot (-0.2, 1.3) = - (-0.2 + 2.6) = -2.4$\n- $F_{f_4}^{\\text{corr}} = - (1,2) \\cdot (-0.9, -0.1) = - (-0.9 - 0.2) = 1.1$\n\n### Step 5: Calculation of Conservation Residuals\nThe conservation residual for the cell $P$ is the sum of fluxes over all its faces.\n**Orthogonal Residual:**\n$R_P^{\\text{orth}} = \\sum_f F_f^{\\text{orth}} = F_{f_1}^{\\text{orth}} + F_{f_2}^{\\text{orth}} + F_{f_3}^{\\text{orth}} + F_{f_4}^{\\text{orth}}$\n$R_P^{\\text{orth}} = \\frac{418}{205} - \\frac{3549}{3620} - 2.6 + \\frac{44}{37}$\n$R_P^{\\text{orth}} \\approx 2.03902439 - 0.98038674 - 2.6 + 1.18918919 \\approx -0.35217316$\n\n**Corrected Residual:**\n$R_P^{\\text{corr}} = \\sum_f F_f^{\\text{corr}} = 1.8 - 0.5 - 2.4 + 1.1 = 0$\nAs expected, the sum of exact fluxes over a closed volume for a divergence-free vector field ($\\nabla \\cdot (-k\\nabla u) = 0$) is zero.\n\n### Step 6: Final Calculation\nThe required quantity is $R_P^{\\text{orth}} - R_P^{\\text{corr}}$.\n$R_P^{\\text{orth}} - R_P^{\\text{corr}} = R_P^{\\text{orth}} - 0 = R_P^{\\text{orth}} \\approx -0.35217316$\nRounding to four significant figures gives $-0.3522$.",
            "answer": "$$\\boxed{-0.3522}$$"
        }
    ]
}