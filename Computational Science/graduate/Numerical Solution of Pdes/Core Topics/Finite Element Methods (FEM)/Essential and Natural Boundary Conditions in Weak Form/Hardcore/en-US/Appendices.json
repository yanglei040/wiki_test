{
    "hands_on_practices": [
        {
            "introduction": "The first step in applying the finite element method is translating a partial differential equation from its strong form into a weak, or variational, formulation. This exercise is a foundational \"paper-and-pencil\" practice in which you will derive the weak form for a general elliptic PDE with a mix of Dirichlet, Neumann, and Robin boundary conditions. Pay close attention to how integration by parts gives rise to boundary integrals, allowing us to distinguish essential conditions, which constrain the function space, from natural conditions, which are satisfied weakly as part of the variational problem itself .",
            "id": "3387621",
            "problem": "Consider the second-order linear elliptic Partial Differential Equation (PDE) in mixed boundary conditions on the unit square domain $\\Omega=(0,1)\\times(0,1)$ with boundary $\\Gamma=\\partial\\Omega$ partitioned into a Dirichlet segment $\\Gamma_D$, a Neumann segment $\\Gamma_N$, and a Robin segment $\\Gamma_R$ as follows:\n- $\\Gamma_D=\\{(x,0): 0x1\\}$,\n- $\\Gamma_N=\\{(x,1): 0x1\\}\\cup\\{(0,y): 0y1\\}$,\n- $\\Gamma_R=\\{(1,y): 0y1\\}$.\n\nThe strong form is\n$$\n-\\nabla\\cdot\\big(k\\,\\nabla u\\big)+c\\,u=f\\quad\\text{in }\\Omega,\n$$\nwith boundary conditions\n$$\nu=g\\quad\\text{on }\\Gamma_D,\\qquad \\big(k\\,\\nabla u\\big)\\cdot n=h\\quad\\text{on }\\Gamma_N,\\qquad \\big(k\\,\\nabla u\\big)\\cdot n+\\alpha\\,u=r\\quad\\text{on }\\Gamma_R,\n$$\nwhere $n$ is the outward unit normal. The coefficients and data are\n$$\nk=\\begin{pmatrix}2  1 \\\\ 1  3\\end{pmatrix},\\quad c=5,\\quad \\alpha=4,\\quad f(x,y)=x+2,\\quad g=0,\n$$\n$$\nh(x,1)=1+x\\text{ for }(x,1)\\in\\Gamma_N,\\quad h(0,y)=0\\text{ for }(0,y)\\in\\Gamma_N,\\quad r(y)=y^2\\text{ for }(1,y)\\in\\Gamma_R.\n$$\n\n(a) Starting from the strong form and using integration by parts together with the given boundary conditions, construct the weak form by identifying the trial space $V$ and test space $V_0$, and assembling the bilinear form $a(\\cdot,\\cdot)$ and the linear functional $\\ell(\\cdot)$ so that the weak problem reads: find $u\\in V$ such that\n$$\na(u,v)=\\ell(v)\\quad\\text{for all }v\\in V_0.\n$$\nClearly state which boundary conditions are essential and which are natural, and ensure that the Neumann and Robin data appear in the correct places.\n\n(b) Let $u(x,y)=(1+x)\\,y$ and $v(x,y)=y$. Using your assembled $a(\\cdot,\\cdot)$ and $\\ell(\\cdot)$, evaluate the scalar\n$$\nJ \\equiv a(u,v)-\\ell(v).\n$$\nReport the exact value of $J$ as a single real number. No rounding is required, and no units are involved.",
            "solution": "The user wants me to solve a two-part problem centered on the weak formulation of a second-order elliptic partial differential equation.\n\n(a) Construct the weak form of the given PDE.\n\nThe process begins with the strong form of the PDE, valid in the domain $\\Omega$:\n$$\n-\\nabla\\cdot\\big(k\\,\\nabla u\\big)+c\\,u=f\n$$\nTo derive the weak form, we multiply the equation by an arbitrary test function $v$ and integrate over the domain $\\Omega$. The test function $v$ is chosen from a suitable space $V_0$, which will be defined shortly.\n$$\n\\int_\\Omega \\left( -\\nabla\\cdot(k\\,\\nabla u) + c\\,u \\right) v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nUsing the linearity of the integral, we separate the terms on the left-hand side:\n$$\n-\\int_\\Omega \\big(\\nabla\\cdot(k\\,\\nabla u)\\big) v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nThe first term is handled using integration by parts, which in this multidimensional context is an application of the divergence theorem (or Green's first identity). The identity states $\\int_\\Omega (\\nabla \\cdot \\mathbf{F}) \\phi \\, d\\Omega = \\oint_{\\partial\\Omega} (\\mathbf{F} \\cdot n) \\phi \\, dS - \\int_\\Omega \\mathbf{F} \\cdot \\nabla\\phi \\, d\\Omega$. Let $\\mathbf{F} = k\\,\\nabla u$ and $\\phi = v$.\n$$\n\\int_\\Omega \\big(\\nabla\\cdot(k\\,\\nabla u)\\big) v \\, d\\Omega = \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS - \\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega\n$$\nwhere $\\Gamma = \\partial\\Omega$ is the boundary of the domain and $n$ is the outward unit normal vector. Substituting this back into the integrated PDE gives:\n$$\n-\\left( \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS - \\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega \\right) + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nRearranging the terms yields the foundational equation for the weak form:\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega + \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS\n$$\nThe boundary conditions are now incorporated. The boundary $\\Gamma$ is partitioned into $\\Gamma_D$, $\\Gamma_N$, and $\\Gamma_R$. The boundary integral is split accordingly:\n$$\n\\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_D} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS + \\int_{\\Gamma_N} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS + \\int_{\\Gamma_R} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS\n$$\nThe distinction between essential and natural boundary conditions is crucial.\nAn **essential boundary condition** is one that is imposed directly on the function space for the solution. In this problem, the Dirichlet condition $u=g$ on $\\Gamma_D$ is a quintessential essential condition. We define the trial space $V$ for the solution $u$ and the test space $V_0$ for the test function $v$ using the appropriate Sobolev space $H^1(\\Omega) = \\{w \\in L^2(\\Omega) : \\nabla w \\in [L^2(\\Omega)]^2\\}$.\nThe trial space is the set of functions that satisfy the essential (Dirichlet) boundary condition:\n$V = \\{w \\in H^1(\\Omega) \\mid w|_{\\Gamma_D} = g\\}$.\nThe test space is the corresponding vector space where the homogeneous version of the essential condition holds:\n$V_0 = \\{w \\in H^1(\\Omega) \\mid w|_{\\Gamma_D} = 0\\}$.\nSince any test function $v \\in V_0$ must be zero on $\\Gamma_D$, the integral over $\\Gamma_D$ vanishes:\n$$\n\\int_{\\Gamma_D} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = 0\n$$\n**Natural boundary conditions** are those that are not explicitly enforced on the function spaces but are instead incorporated into the weak formulation itself through the boundary integral terms. The Neumann and Robin conditions fall into this category.\nOn the Neumann boundary $\\Gamma_N$, we substitute the condition $(k\\,\\nabla u)\\cdot n = h$:\n$$\n\\int_{\\Gamma_N} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_N} h v \\, dS\n$$\nOn the Robin boundary $\\Gamma_R$, we substitute the condition $(k\\,\\nabla u)\\cdot n = r - \\alpha u$:\n$$\n\\int_{\\Gamma_R} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_R} (r - \\alpha u) v \\, dS = \\int_{\\Gamma_R} r v \\, dS - \\int_{\\Gamma_R} \\alpha u v \\, dS\n$$\nSubstituting these boundary integral expressions back into the main equation gives:\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega + \\int_{\\Gamma_N} h v \\, dS + \\int_{\\Gamma_R} r v \\, dS - \\int_{\\Gamma_R} \\alpha u v \\, dS\n$$\nTo arrive at the standard weak form $a(u,v)=\\ell(v)$, we group all terms involving the solution $u$ on the left-hand side and all other terms, which depend only on the test function $v$ and given data, on the right-hand side.\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega + \\int_{\\Gamma_R} \\alpha u v \\, dS = \\int_\\Omega f v \\, d\\Omega + \\int_{\\Gamma_N} h v \\, dS + \\int_{\\Gamma_R} r v \\, dS\n$$\nFrom this equation, we identify the bilinear form $a(\\cdot,\\cdot)$ and the linear functional $\\ell(\\cdot)$.\n\nThe final weak formulation is: Find $u \\in V$ such that $a(u,v) = \\ell(v)$ for all $v \\in V_0$.\n\nThe components are:\n- **Trial Space:** $V = \\{w \\in H^1(\\Omega) \\mid w=g \\text{ on } \\Gamma_D\\}$. Since $g=0$ is given, $V = \\{w \\in H^1(\\Omega) \\mid w=0 \\text{ on } \\Gamma_D\\}$.\n- **Test Space:** $V_0 = \\{w \\in H^1(\\Omega) \\mid w=0 \\text{ on } \\Gamma_D\\}$. For this problem, $V = V_0$.\n- **Bilinear Form:**\n$$a(u,v) = \\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v \\Big) \\,d\\Omega + \\int_{\\Gamma_R} \\alpha\\,u\\,v \\,dS$$\n- **Linear Functional:**\n$$\\ell(v) = \\int_\\Omega f v \\,d\\Omega + \\int_{\\Gamma_N} h v \\,dS + \\int_{\\Gamma_R} r v \\,dS$$\n\n- **Essential Boundary Condition:** $u=g$ on $\\Gamma_D$. It is enforced by the construction of the trial space $V$.\n- **Natural Boundary Conditions:** $(k\\,\\nabla u)\\cdot n=h$ on $\\Gamma_N$ and $(k\\,\\nabla u)\\cdot n+\\alpha\\,u=r$ on $\\Gamma_R$. They are satisfied weakly through their inclusion in the definitions of $a(u,v)$ and $\\ell(v)$.\n\n(b) Evaluate $J \\equiv a(u,v)-\\ell(v)$.\n\nWe need to compute the scalar $J$ for the given functions $u(x,y)=(1+x)y$ and $v(x,y)=y$.\nThe expression for $J$ is:\n$$\nJ = a(u,v) - \\ell(v) = \\left( \\int_\\Omega \\big((k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v\\big) \\,d\\Omega + \\int_{\\Gamma_R} \\alpha\\,u\\,v \\,dS \\right) - \\left( \\int_\\Omega f v \\,d\\Omega + \\int_{\\Gamma_N} h v \\,dS + \\int_{\\Gamma_R} r v \\,dS \\right)\n$$\nRearranging the terms for a combined calculation:\n$$\nJ = \\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v - fv \\Big) \\,d\\Omega - \\int_{\\Gamma_N} h v \\,dS + \\int_{\\Gamma_R} (\\alpha\\,u\\,v - r v) \\,dS\n$$\nFirst, we compute the necessary components:\n- Functions: $u(x,y) = (1+x)y$, $v(x,y) = y$\n- Gradients: $\\nabla u = \\begin{pmatrix} y \\\\ 1+x \\end{pmatrix}$, $\\nabla v = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$\n- Coefficient matrix: $k = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix}$\n- Other coefficients and data: $c=5$, $\\alpha=4$, $f(x,y)=x+2$.\n\nNow, we evaluate each integral term.\n\n1.  **Domain Integral:** $\\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v - fv \\Big) \\,d\\Omega$ over $\\Omega=(0,1)\\times(0,1)$.\n    The integrand is computed as follows:\n    - $k\\,\\nabla u = \\begin{pmatrix} 2  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} y \\\\ 1+x \\end{pmatrix} = \\begin{pmatrix} 2y + (1+x) \\\\ y + 3(1+x) \\end{pmatrix} = \\begin{pmatrix} x+2y+1 \\\\ 3x+y+3 \\end{pmatrix}$\n    - $(k\\,\\nabla u)\\cdot\\nabla v = (3x+y+3) \\cdot 1 = 3x+y+3$\n    - $c\\,u\\,v = 5 \\cdot (1+x)y \\cdot y = 5(1+x)y^2 = 5y^2+5xy^2$\n    - $f v = (x+2)y = xy+2y$\n    The full integrand is $(3x+y+3) + (5y^2+5xy^2) - (xy+2y) = 5xy^2-xy+5y^2-y+3x+3$.\n    $\\int_0^1 \\int_0^1 (5xy^2 - xy + 5y^2 - y + 3x + 3) \\, dx \\, dy$\n    $= \\int_0^1 \\left[ \\frac{5}{2}x^2y^2 - \\frac{1}{2}x^2y + 5xy^2 - xy + \\frac{3}{2}x^2 + 3x \\right]_{x=0}^{1} \\, dy$\n    $= \\int_0^1 \\left( \\frac{5}{2}y^2 - \\frac{1}{2}y + 5y^2 - y + \\frac{3}{2} + 3 \\right) \\, dy$\n    $= \\int_0^1 \\left( \\frac{15}{2}y^2 - \\frac{3}{2}y + \\frac{9}{2} \\right) \\, dy$\n    $= \\left[ \\frac{15}{2}\\frac{y^3}{3} - \\frac{3}{2}\\frac{y^2}{2} + \\frac{9}{2}y \\right]_0^1 = \\left[ \\frac{5}{2}y^3 - \\frac{3}{4}y^2 + \\frac{9}{2}y \\right]_0^1$\n    $= \\frac{5}{2} - \\frac{3}{4} + \\frac{9}{2} = \\frac{14}{2} - \\frac{3}{4} = 7 - \\frac{3}{4} = \\frac{25}{4}$.\n\n2.  **Neumann Boundary Integral:** $- \\int_{\\Gamma_N} h v \\,dS$\n    $\\Gamma_N$ consists of two parts:\n    - $\\Gamma_{N1} = \\{(x,1) : 0x1\\}$. Here $dS=dx$, $h(x,1)=1+x$, and $v(x,1)=1$.\n      $\\int_{\\Gamma_{N1}} h v \\,dS = \\int_0^1 (1+x)(1) \\,dx = [x+\\frac{x^2}{2}]_0^1 = 1+\\frac{1}{2} = \\frac{3}{2}$.\n    - $\\Gamma_{N2} = \\{(0,y) : 0y1\\}$. Here $dS=dy$, $h(0,y)=0$, and $v(0,y)=y$.\n      $\\int_{\\Gamma_{N2}} h v \\,dS = \\int_0^1 (0)(y) \\,dy = 0$.\n    The total integral is $\\frac{3}{2}$. The term in $J$ is $-\\frac{3}{2}$.\n\n3.  **Robin Boundary Integral:** $\\int_{\\Gamma_R} (\\alpha\\,u\\,v - r v) \\,dS$\n    $\\Gamma_R = \\{(1,y) : 0y1\\}$. Here $dS=dy$.\n    - $\\alpha=4$.\n    - $u(1,y) = (1+1)y = 2y$.\n    - $r(y) = y^2$.\n    - $v(1,y) = y$.\n    The integrand is $(\\alpha u(1,y) - r(y)) v(1,y) = (4(2y) - y^2)y = (8y-y^2)y = 8y^2-y^3$.\n    The integral is $\\int_0^1 (8y^2-y^3) \\,dy = [\\frac{8}{3}y^3 - \\frac{1}{4}y^4]_0^1 = \\frac{8}{3} - \\frac{1}{4} = \\frac{32-3}{12} = \\frac{29}{12}$.\n\n4.  **Final Value of J:**\n    Combining all parts:\n    $J = (\\text{Domain Integral}) - (\\text{Neumann Integral Term}) + (\\text{Robin Integral})$\n    $J = \\frac{25}{4} - \\frac{3}{2} + \\frac{29}{12}$\n    To sum these fractions, we use a common denominator of $12$:\n    $J = \\frac{25 \\cdot 3}{12} - \\frac{3 \\cdot 6}{12} + \\frac{29}{12} = \\frac{75 - 18 + 29}{12} = \\frac{57 + 29}{12} = \\frac{86}{12}$\n    Simplifying the fraction gives:\n    $J = \\frac{43}{6}$",
            "answer": "$$\\boxed{\\frac{43}{6}}$$"
        },
        {
            "introduction": "What happens when a boundary value problem has no essential conditions and is governed entirely by natural (Neumann) conditions? This practice explores this critical special case, revealing a deeper property of weak formulations. By considering the Poisson equation with pure Neumann data, you will derive a necessary \"compatibility condition\" that the source term and boundary flux must satisfy for a solution to exist . This exercise illuminates the physical concept of conservation or balance inherent in the PDE and introduces the common technique of enforcing uniqueness on the non-unique solution.",
            "id": "3387571",
            "problem": "Consider the Poisson Partial Differential Equation (PDE) $-\\Delta u = f$ on a bounded, connected, Lipschitz domain $\\Omega \\subset \\mathbb{R}^{2}$ with outward unit normal $\\boldsymbol{n}$ on its boundary $\\Gamma = \\partial \\Omega$, subject to the pure Neumann boundary condition $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$. Starting from the divergence theorem and the definition of the weak formulation, derive the necessary compatibility condition that ensures the existence of weak solutions. Then explain, from first principles, why the solution $u$ is not unique and how to enforce uniqueness by imposing a mean-zero constraint in the weak problem. Finally, describe a principled way to enforce the mean-zero constraint in a conforming Finite Element Method (FEM) discretization, including the algebraic form of the augmented linear system using a Lagrange multiplier.\n\nFor a concrete calculation, take $\\Omega$ to be the unit disk in $\\mathbb{R}^{2}$, parameterized by polar coordinates $(r,\\theta)$ with angles measured in radians, and let the data be $f(r,\\theta) = r^{2}$ and $g_{N}(\\theta) = \\sin(\\theta)$. If the given data do not satisfy the compatibility condition, one common remedy is to add a constant correction $\\alpha$ to the Neumann boundary data, replacing $g_{N}$ by $g_{N}^{\\star} = g_{N} + \\alpha$. Compute the exact value of the constant $\\alpha$ that restores compatibility. Provide your final answer as a single exact value. No rounding is required.",
            "solution": "The problem statement is parsed and validated as follows.\n\n**Step 1: Extract Givens**\n- **PDE:** $-\\Delta u = f$\n- **Domain:** A bounded, connected, Lipschitz domain $\\Omega \\subset \\mathbb{R}^{2}$ with boundary $\\Gamma = \\partial \\Omega$.\n- **Boundary Condition:** Pure Neumann, $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$, where $\\boldsymbol{n}$ is the outward unit normal.\n- **Task 1:** Derive the necessary compatibility condition for the existence of weak solutions starting from the divergence theorem.\n- **Task 2:** Explain the non-uniqueness of the solution $u$ and how to enforce uniqueness using a mean-zero constraint.\n- **Task 3:** Describe the enforcement of the mean-zero constraint in a conforming Finite Element Method (FEM) using a Lagrange multiplier, providing the algebraic form of the augmented linear system.\n- **Task 4 (Concrete Calculation):**\n  - Domain: $\\Omega$ is the unit disk in $\\mathbb{R}^{2}$.\n  - Data: $f(r,\\theta) = r^{2}$ and $g_{N}(\\theta) = \\sin(\\theta)$.\n  - Correction Method: Replace $g_{N}$ with $g_{N}^{\\star} = g_{N} + \\alpha$, where $\\alpha$ is a constant.\n  - Objective: Compute the exact value of $\\alpha$ to restore compatibility.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It addresses standard topics in the theory and numerical analysis of partial differential equations, specifically the Poisson equation with Neumann boundary conditions.\n- The use of concepts such as weak formulation, compatibility condition, function spaces like $H^1(\\Omega)$, Lagrange multipliers, and the Finite Element Method are all standard and mathematically rigorous.\n- The problem is self-contained and provides all necessary information for both the theoretical derivations and the concrete calculation.\n- The language is precise and uses standard mathematical terminology, avoiding ambiguity or subjectivity.\n- The concrete calculation involves well-defined functions on a standard domain (the unit disk), and the goal is to find a specific constant that satisfies a clearly defined mathematical condition.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution process will proceed.\n\n***\n\nWe address each part of the problem sequentially.\n\n**Part 1: Derivation of the Compatibility Condition**\n\nThe process begins by deriving the weak formulation of the problem. We start with the strong form of the Poisson equation:\n$$-\\Delta u = f \\quad \\text{in } \\Omega$$\nWe multiply this equation by an arbitrary test function $v$ from a suitable function space, which for this problem is the Sobolev space $H^1(\\Omega)$, and integrate over the domain $\\Omega$:\n$$-\\int_{\\Omega} (\\Delta u) v \\, d\\mathbf{x} = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\nThe left-hand side is integrated by parts. The relevant vector calculus identity is the first Green's identity, which is a direct consequence of the divergence theorem. The divergence theorem states that for a vector field $\\mathbf{F}$, $\\int_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\, d\\mathbf{x} = \\int_{\\Gamma} \\mathbf{F} \\cdot \\boldsymbol{n} \\, dS$. Let $\\mathbf{F} = v \\nabla u$. Then $\\nabla \\cdot \\mathbf{F} = \\nabla v \\cdot \\nabla u + v \\Delta u$. Applying the divergence theorem gives:\n$$\\int_{\\Omega} (\\nabla v \\cdot \\nabla u + v \\Delta u) \\, d\\mathbf{x} = \\int_{\\Gamma} (v \\nabla u) \\cdot \\boldsymbol{n} \\, dS$$\nRearranging this identity, we find an expression for the integral of $v \\Delta u$:\n$$\\int_{\\Omega} v \\Delta u \\, d\\mathbf{x} = \\int_{\\Gamma} v (\\nabla u \\cdot \\boldsymbol{n}) \\, dS - \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$$\nSubstituting this back into the integrated PDE and using the definition of the normal derivative $\\partial_{\\boldsymbol{n}} u = \\nabla u \\cdot \\boldsymbol{n}$ yields:\n$$-\\left( \\int_{\\Gamma} v (\\partial_{\\boldsymbol{n}} u) \\, dS - \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} \\right) = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\n$$\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} - \\int_{\\Gamma} v (\\partial_{\\boldsymbol{n}} u) \\, dS = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\nNow, we enforce the Neumann boundary condition $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$:\n$$\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} = \\int_{\\Omega} f v \\, d\\mathbf{x} + \\int_{\\Gamma} v g_{N} \\, dS$$\nThis equation defines the weak formulation: Find $u \\in H^1(\\Omega)$ such that the above equality holds for all test functions $v \\in H^1(\\Omega)$.\n\nTo derive the compatibility condition, we observe that the gradient operator $\\nabla$ annihilates constant functions. Let us choose a specific test function $v = c$ for some non-zero constant $c \\in \\mathbb{R}$. For simplicity, let $c=1$. Substituting $v=1$ into the weak formulation:\nThe left-hand side (LHS) becomes:\n$$\\text{LHS} = \\int_{\\Omega} \\nabla u \\cdot \\nabla (1) \\, d\\mathbf{x} = \\int_{\\Omega} \\nabla u \\cdot \\mathbf{0} \\, d\\mathbf{x} = 0$$\nThe right-hand side (RHS) becomes:\n$$\\text{RHS} = \\int_{\\Omega} f (1) \\, d\\mathbf{x} + \\int_{\\Gamma} (1) g_{N} \\, dS = \\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_{N} \\, dS$$\nFor a solution to exist, the LHS must equal the RHS. This imposes a constraint on the data $f$ and $g_N$:\n$$0 = \\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_{N} \\, dS$$\nThis is the necessary compatibility condition. It has a physical interpretation in heat transfer, for example, where it represents a global energy balance: the total heat generated within the domain ($\\int f \\, d\\mathbf{x}$) must be balanced by the heat flux across the boundary ($-\\int g_N \\, dS$).\n\n**Part 2: Non-uniqueness and Uniqueness Enforcement**\n\nIf a solution $u$ to the weak problem exists, it is not unique. Let $u$ be a solution. Consider the function $\\tilde{u} = u + c$, where $c$ is an arbitrary constant. Since $\\nabla \\tilde{u} = \\nabla(u+c) = \\nabla u + \\nabla c = \\nabla u$, substituting $\\tilde{u}$ into the LHS of the weak form gives:\n$$\\int_{\\Omega} \\nabla \\tilde{u} \\cdot \\nabla v \\, d\\mathbf{x} = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$$\nThe LHS is identical for both $u$ and $\\tilde{u}$. The RHS of the weak form does not depend on the solution $u$. Therefore, if $u$ satisfies the weak formulation, so does $\\tilde{u} = u+c$ for any constant $c \\in \\mathbb{R}$. The solution is unique only up to an additive constant.\n\nTo enforce uniqueness, we must impose an additional constraint that fixes this constant. A standard choice is to require the solution to have a zero mean value over the domain:\n$$\\int_{\\Omega} u \\, d\\mathbf{x} = 0$$\nThe problem is then posed on the subspace $V_0 = \\{w \\in H^1(\\Omega) \\mid \\int_{\\Omega} w \\, d\\mathbf{x} = 0\\}$. The Poincar√©-Wirtinger inequality guarantees that for functions in $V_0$, the seminorm $|\\cdot|_{H^1(\\Omega)} = \\|\\nabla(\\cdot)\\|_{L^2(\\Omega)}$ is a norm equivalent to the full $H^1(\\Omega)$ norm. This ensures that the bilinear form $a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$ is coercive on $V_0$. By the Lax-Milgram theorem, the problem of finding $u \\in V_0$ such that $a(u,v) = L(v)$ for all $v \\in V_0$ has a unique solution, provided the compatibility condition holds.\n\n**Part 3: FEM with Lagrange Multiplier**\n\nIn a conforming Finite Element Method, the space $H^1(\\Omega)$ is approximated by a finite-dimensional subspace $V_h \\subset H^1(\\Omega)$, spanned by a set of basis functions $\\{\\phi_i\\}_{i=1}^N$. The discrete solution is $u_h = \\sum_{j=1}^N U_j \\phi_j$. Enforcing the mean-zero constraint $\\int_{\\Omega} u_h \\, d\\mathbf{x} = 0$ directly by constructing a basis for the discrete version of $V_0$ can be cumbersome.\n\nA more general and principled approach is to use a Lagrange multiplier $\\lambda \\in \\mathbb{R}$ to enforce the constraint. We seek a pair $(u_h, \\lambda) \\in V_h \\times \\mathbb{R}$ that solves the saddle-point problem:\nFind $(u_h, \\lambda)$ such that for all $(v_h, \\mu) \\in V_h \\times \\mathbb{R}$:\n$$\n\\begin{cases}\n\\int_{\\Omega} \\nabla u_h \\cdot \\nabla v_h \\, d\\mathbf{x} + \\int_{\\Omega} \\lambda v_h \\, d\\mathbf{x} = \\int_{\\Omega} f v_h \\, d\\mathbf{x} + \\int_{\\Gamma} g_N v_h \\, dS \\\\\n\\int_{\\Omega} \\mu u_h \\, d\\mathbf{x} = 0\n\\end{cases}\n$$\nLetting $v_h = \\phi_i$ for $i=1,\\dots,N$ and $\\mu=1$, we obtain the algebraic system. Let $\\mathbf{U} \\in \\mathbb{R}^N$ be the vector of coefficients $U_j$.\nThe first equation becomes:\n$$\\sum_{j=1}^N U_j \\left( \\int_{\\Omega} \\nabla \\phi_j \\cdot \\nabla \\phi_i \\, d\\mathbf{x} \\right) + \\lambda \\left( \\int_{\\Omega} \\phi_i \\, d\\mathbf{x} \\right) = \\int_{\\Omega} f \\phi_i \\, d\\mathbf{x} + \\int_{\\Gamma} g_N \\phi_i \\, dS$$\nThe second equation becomes:\n$$\\sum_{j=1}^N U_j \\left( \\int_{\\Omega} \\phi_j \\, d\\mathbf{x} \\right) = 0$$\nLet us define the following matrices and vectors:\n- Stiffness Matrix: $A \\in \\mathbb{R}^{N \\times N}$ with $A_{ij} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\mathbf{x}$.\n- Load Vector: $\\mathbf{F} \\in \\mathbb{R}^N$ with $F_i = \\int_{\\Omega} f \\phi_i \\, d\\mathbf{x} + \\int_{\\Gamma} g_N \\phi_i \\, dS$.\n- Constraint Vector: $\\mathbf{B} \\in \\mathbb{R}^N$ with $B_j = \\int_{\\Omega} \\phi_j \\, d\\mathbf{x}$.\n\nThe system can be written in a block matrix form:\n$$\n\\begin{pmatrix}\nA  \\mathbf{B} \\\\\n\\mathbf{B}^T  0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{U} \\\\\n\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{F} \\\\\n0\n\\end{pmatrix}\n$$\nThis augmented system is non-singular and has a unique solution $(\\mathbf{U}, \\lambda)$, thus yielding a unique FEM solution $u_h$ that satisfies the mean-zero constraint.\n\n**Part 4: Concrete Calculation**\n\nWe need to find the constant $\\alpha$ such that the modified data, $f(r,\\theta) = r^2$ and $g_N^{\\star}(\\theta) = \\sin(\\theta) + \\alpha$, satisfy the compatibility condition on the unit disk $\\Omega$. The condition is:\n$$\\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_N^{\\star} \\, dS = 0$$\nThe domain $\\Omega$ is the unit disk, so we use polar coordinates $(r, \\theta)$. The area element is $d\\mathbf{x} = r \\, dr \\, d\\theta$, and the boundary line element is $dS = 1 \\cdot d\\theta = d\\theta$ since $r=1$ on $\\Gamma$.\n\nFirst, we compute the integral of $f$ over $\\Omega$:\n$$\\int_{\\Omega} f \\, d\\mathbf{x} = \\int_0^{2\\pi} \\int_0^1 (r^2) (r \\, dr \\, d\\theta) = \\int_0^{2\\pi} \\left( \\int_0^1 r^3 \\, dr \\right) \\, d\\theta$$\nThe inner integral is:\n$$\\int_0^1 r^3 \\, dr = \\left[ \\frac{r^4}{4} \\right]_0^1 = \\frac{1}{4}$$\nThe outer integral is:\n$$\\int_0^{2\\pi} \\frac{1}{4} \\, d\\theta = \\frac{1}{4} [\\theta]_0^{2\\pi} = \\frac{2\\pi}{4} = \\frac{\\pi}{2}$$\nNext, we compute the integral of $g_N^{\\star}$ over the boundary $\\Gamma$:\n$$\\int_{\\Gamma} g_N^{\\star} \\, dS = \\int_0^{2\\pi} (\\sin(\\theta) + \\alpha) \\, d\\theta = \\int_0^{2\\pi} \\sin(\\theta) \\, d\\theta + \\int_0^{2\\pi} \\alpha \\, d\\theta$$\nThe first term is:\n$$\\int_0^{2\\pi} \\sin(\\theta) \\, d\\theta = [-\\cos(\\theta)]_0^{2\\pi} = -\\cos(2\\pi) - (-\\cos(0)) = -1 - (-1) = 0$$\nThe second term is:\n$$\\int_0^{2\\pi} \\alpha \\, d\\theta = \\alpha [\\theta]_0^{2\\pi} = 2\\pi\\alpha$$\nSo, $\\int_{\\Gamma} g_N^{\\star} \\, dS = 2\\pi\\alpha$.\n\nFinally, we substitute these results into the compatibility condition:\n$$\\frac{\\pi}{2} + 2\\pi\\alpha = 0$$\nSolving for $\\alpha$:\n$$2\\pi\\alpha = -\\frac{\\pi}{2}$$\n$$\\alpha = \\frac{-\\pi/2}{2\\pi} = -\\frac{1}{4}$$\nThe required constant is $\\alpha = -1/4$.",
            "answer": "$$\\boxed{-\\frac{1}{4}}$$"
        },
        {
            "introduction": "Theory becomes tangible when implemented in code. This hands-on programming exercise guides you through building a one-dimensional finite element solver to solidify your understanding of how boundary conditions are handled in practice. You will see how the natural boundary condition appears as a simple addition to the load vector, while the essential boundary condition requires a direct modification of the global stiffness matrix and load vector before solving . This practice bridges the gap between the abstract variational equations and the concrete algebraic system that a computer solves.",
            "id": "3387611",
            "problem": "Consider the scalar Poisson-type Partial Differential Equation (PDE) on the one-dimensional domain $\\Omega = (0,1)$,\n$$\n- u''(x) = f(x) \\quad \\text{for } x \\in \\Omega,\n$$\nwith boundary decomposition into essential (Dirichlet) boundary $\\Gamma_D$ and natural (Neumann) boundary $\\Gamma_N$. Let $H^1(\\Omega)$ denote the Sobolev space of functions with square-integrable derivatives, and let $V_h \\subset H^1(\\Omega)$ be a conforming, continuous, piecewise-linear finite element space on a uniform mesh with $N$ elements and nodes $\\{x_i\\}_{i=0}^{N}$, where $x_0 = 0$ and $x_N = 1$.\n\nStarting from the standard weak form for the Poisson problem,\n$$\n\\text{Find } u \\in H^1(\\Omega) \\text{ with } u|_{\\Gamma_D} = g \\text{ such that} \\quad\n\\int_\\Omega u'(x) v'(x) \\, dx = \\int_\\Omega f(x) v(x) \\, dx + \\int_{\\Gamma_N} t \\, v \\, ds \\quad \\forall v \\in H^1_0(\\Omega;\\Gamma_D),\n$$\nwhere $H^1_0(\\Omega;\\Gamma_D)$ denotes the subspace of $H^1(\\Omega)$ with trace zero on $\\Gamma_D$, and $t$ is the prescribed natural boundary traction satisfying the flux convention $-u'(x) n = t$ on $\\Gamma_N$ with outward unit normal $n$, you are to:\n\n- Formulate the discrete finite element equations on $V_h$ using the nodal basis $\\{\\varphi_i\\}_{i=0}^{N}$.\n- Assemble the global stiffness matrix $K \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ with entries\n$$\nK_{ij} = \\int_\\Omega \\varphi_i'(x) \\varphi_j'(x) \\, dx,\n$$\nand the global load vector $F \\in \\mathbb{R}^{N+1}$ with entries\n$$\nF_i = \\int_\\Omega f(x) \\, \\varphi_i(x) \\, dx + \\int_{\\Gamma_N} t \\, \\varphi_i \\, ds.\n$$\n- Enforce essential boundary conditions $u|_{\\Gamma_D} = g$ strongly by elimination, meaning:\n  1. Identify the set of boundary Degrees of Freedom (DOF) $B$ associated with $\\Gamma_D$ and the interior set $I$ as the complement in $\\{0,1,\\dots,N\\}$.\n  2. Partition $K$ and $F$ accordingly, and solve for the interior unknowns using\n$$\nK_{II} \\, u_I = F_I - K_{IB} \\, g_B,\n$$\nthen set $u_B = g_B$ and construct the full vector $u$.\n- Include the natural boundary contribution $\\int_{\\Gamma_N} t \\, \\varphi_i \\, ds$ appropriately in the load vector for boundary nodes in $\\Gamma_N$.\n\nYour program must implement the above for the following test suite, using $V_h$ defined on a uniform mesh with the specified $N$, and must solve the linear system produced by the strong enforcement via elimination. For each test case, compute the specified quantitative result.\n\nTest Suite:\n1. Mixed boundary condition (happy path):\n   - Mesh: $N = 8$.\n   - Source: $f(x) = 0$.\n   - Essential boundary: $\\Gamma_D = \\{0\\}$ with $g(0) = 2$.\n   - Natural boundary: $\\Gamma_N = \\{1\\}$ with traction $t(1) = -3$ (so that $u'(1) = 3$).\n   - Analytical solution: $u_{\\text{exact}}(x) = 2 + 3x$.\n   - Output: the maximum nodal absolute error $\\max_{i} |u(x_i) - u_{\\text{exact}}(x_i)|$ as a floating-point number.\n\n2. Pure essential boundary (stiffness elimination coverage):\n   - Mesh: $N = 32$.\n   - Source: $f(x) = \\sin(\\pi x)$.\n   - Essential boundary: $\\Gamma_D = \\{0,1\\}$ with $g(0) = 0$ and $g(1) = 0$.\n   - Natural boundary: none.\n   - Analytical solution satisfying $-u''(x) = \\sin(\\pi x)$ and $u(0) = 0$, $u(1) = 0$ is $u_{\\text{exact}}(x) = \\dfrac{\\sin(\\pi x)}{\\pi^2}$.\n   - Output: the approximate $L^2$ norm of the error $\\left(\\int_0^1 |u(x) - u_{\\text{exact}}(x)|^2 \\, dx\\right)^{1/2}$ computed by the composite trapezoidal rule on the mesh nodes, as a floating-point number.\n\n3. Inhomogeneous essential boundary (edge case for nonzero $g$):\n   - Mesh: $N = 10$.\n   - Source: $f(x) = 0$.\n   - Essential boundary: $\\Gamma_D = \\{0,1\\}$ with $g(0) = 1$ and $g(1) = 2$.\n   - Natural boundary: none.\n   - Analytical solution: $u_{\\text{exact}}(x) = 1 + x$.\n   - Output: the maximum nodal absolute error $\\max_{i} |u(x_i) - u_{\\text{exact}}(x_i)|$ as a floating-point number.\n\nAlgorithmic Requirements:\n- Use a uniform mesh on $(0,1)$ with nodes $x_i = \\dfrac{i}{N}$ for $i = 0,1,\\dots,N$.\n- Use continuous, piecewise-linear (hat) basis functions $\\{\\varphi_i\\}_{i=0}^{N}$.\n- Assemble $K$ by summing local element contributions. For an element $e = [x_i,x_{i+1}]$ of length $h = x_{i+1} - x_i$, the local stiffness matrix is\n$$\nK^{(e)} = \\frac{1}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}.\n$$\n- Assemble $F$ using two-point Gaussian quadrature on each element for the source term $\\int_{x_i}^{x_{i+1}} f(x)\\varphi_j(x)\\,dx$, and include natural boundary contributions $\\int_{\\Gamma_N} t \\, \\varphi_j \\, ds$ by adding $t$ to the load entry corresponding to the boundary node in $\\Gamma_N$.\n- Enforce essential boundary conditions by elimination as described above. Do not use penalty methods or Lagrange multipliers.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results of the three test cases as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$), where each $r_k$ is the floating-point result specified for that test case. No units are required; all quantities are dimensionless real numbers.",
            "solution": "The problem presents a standard application of the one-dimensional finite element method (FEM) to the Poisson equation with mixed boundary conditions. The problem is scientifically grounded, well-posed, and provides all necessary information for a unique solution. The formulation, including the weak form, choice of basis functions, assembly procedures, and boundary condition enforcement via elimination, adheres to established principles of numerical analysis for partial differential equations. The provided test cases have analytical solutions that correctly satisfy the governing equations and boundary conditions, allowing for rigorous verification of the numerical implementation. The problem is therefore deemed valid.\n\nThe solution proceeds by first discretizing the continuous problem, then assembling the global system of linear equations, applying boundary conditions, solving the system, and finally calculating the required error metrics.\n\n**1. Discretization: Mesh and Basis Functions**\nThe domain $\\Omega = (0,1)$ is discretized into a uniform mesh of $N$ elements, resulting in $N+1$ nodes $\\{x_i\\}_{i=0}^{N}$ where $x_i = i/N$. The length of each element is uniform, $h = 1/N$.\n\nWe use a finite element space $V_h$ of continuous, piecewise-linear functions. The standard basis for this space is the set of nodal \"hat\" functions $\\{\\varphi_i(x)\\}_{i=0}^{N}$, defined by the property $\\varphi_i(x_j) = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta. An individual basis function $\\varphi_i(x)$ is non-zero only over the interval $(x_{i-1}, x_{i+1})$ and is explicitly given by:\n$$\n\\varphi_i(x) = \\begin{cases}\n\\frac{x - x_{i-1}}{h}  \\text{if } x \\in [x_{i-1}, x_i] \\\\\n\\frac{x_{i+1} - x}{h}  \\text{if } x \\in [x_i, x_{i+1}] \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nThe derivative, $\\varphi_i'(x)$, is piecewise constant:\n$$\n\\varphi_i'(x) = \\begin{cases}\n\\frac{1}{h}  \\text{if } x \\in (x_{i-1}, x_i) \\\\\n-\\frac{1}{h}  \\text{if } x \\in (x_i, x_{i+1}) \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nThe finite element solution $u_h(x)$ is represented as a linear combination of these basis functions: $u_h(x) = \\sum_{j=0}^{N} U_j \\varphi_j(x)$, where $U_j = u_h(x_j)$ are the unknown nodal values (degrees of freedom).\n\n**2. Assembly of the Global Stiffness Matrix**\nThe global stiffness matrix $K$ has entries $K_{ij} = \\int_0^1 \\varphi_i'(x) \\varphi_j'(x) \\, dx$. Due to the local support of the basis functions, the integrand $\\varphi_i'(x) \\varphi_j'(x)$ is non-zero only when the supports of $\\varphi_i$ and $\\varphi_j$ overlap, which occurs only if $|i-j| \\le 1$. This results in a sparse, tridiagonal matrix.\n\nThe entries are calculated as:\n- Diagonal entries ($j=i$):\nFor interior nodes ($i=1, \\dots, N-1$): $K_{ii} = \\int_{x_{i-1}}^{x_{i+1}} (\\varphi_i')^2 dx = \\int_{x_{i-1}}^{x_i} (\\frac{1}{h})^2 dx + \\int_{x_i}^{x_{i+1}} (-\\frac{1}{h})^2 dx = \\frac{1}{h^2}h + \\frac{1}{h^2}h = \\frac{2}{h}$.\nFor boundary nodes ($i=0, N$): $K_{00} = \\int_{x_0}^{x_1} (\\varphi_0')^2 dx = \\frac{1}{h}$ and $K_{NN} = \\int_{x_{N-1}}^{x_N} (\\varphi_N')^2 dx = \\frac{1}{h}$.\n\n- Off-diagonal entries ($j=i+1$):\n$K_{i,i+1} = \\int_{x_i}^{x_{i+1}} \\varphi_i'(x) \\varphi_{i+1}'(x) dx = \\int_{x_i}^{x_{i+1}} (-\\frac{1}{h})(\\frac{1}{h}) dx = -\\frac{1}{h}$.\nBy symmetry, $K_{i+1,i} = K_{i,i+1} = -1/h$.\n\nThis assembly can be conceptualized by summing local element stiffness matrices. For an element $e = [x_i, x_{i+1}]$, the local matrix is $K^{(e)} = \\frac{1}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$, which contributes to the global entries $(i,i), (i,i+1), (i+1,i), (i+1,i+1)$.\n\n**3. Assembly of the Global Load Vector**\nThe global load vector $F$ has entries $F_i = \\int_0^1 f(x) \\varphi_i(x) \\, dx + \\int_{\\Gamma_N} t \\, \\varphi_i \\, ds$.\nThe first term, the source term, is assembled by summing contributions from each element. The integral over an element $[x_k, x_{k+1}]$ is approximated using two-point Gaussian quadrature. The formula for an integral over $[a,b]$ is $\\int_a^b G(x)dx \\approx \\frac{b-a}{2} \\sum_{j=1}^2 w_j G(x_j)$, where $w_{1,2}=1$ and quadrature points are $x_{1,2} = \\frac{b+a}{2} \\pm \\frac{b-a}{2\\sqrt{3}}$. For element $e_k = [x_k, x_{k+1}]$, the contribution to $F_k$ and $F_{k+1}$ involves evaluating $f(x)$ and the basis functions at these quadrature points.\n\nThe second term accounts for natural (Neumann) boundary conditions. The integral $\\int_{\\Gamma_N} t \\, \\varphi_i \\, ds$ simplifies because on the 1D domain, $\\Gamma_N$ can only contain the endpoints $x=0$ or $x=1$. For a node $x_k \\in \\Gamma_N$, the basis function $\\varphi_i(x)$ acts as a Kronecker delta, $\\varphi_i(x_k) = \\delta_{ik}$. Thus, if $x_k \\in \\Gamma_N$, we simply add the prescribed traction value $t(x_k)$ to the corresponding entry $F_k$ of the load vector. Per the problem's flux convention, $-u'(x)n=t$. At $x=1$, $n=1$, so $-u'(1)=t(1)$. At $x=0$, $n=-1$, so $u'(0)=t(0)$.\n\n**4. Enforcement of Essential Boundary Conditions**\nEssential (Dirichlet) boundary conditions $u(x_k) = g_k$ for $x_k \\in \\Gamma_D$ are enforced by elimination. The set of all degrees of freedom (DOFs) $\\{0, \\dots, N\\}$ is partitioned into interior DOFs $I$ and boundary DOFs $B$. The linear system $KU=F$ is partitioned accordingly:\n$$\n\\begin{bmatrix} K_{II}  K_{IB} \\\\ K_{BI}  K_{BB} \\end{bmatrix}\n\\begin{bmatrix} U_I \\\\ U_B \\end{bmatrix}\n=\n\\begin{bmatrix} F_I \\\\ F_B \\end{bmatrix}\n$$\nThe values $U_B$ are known ($U_B=g_B$). The top block of equations, $K_{II}U_I + K_{IB}U_B = F_I$, is solved for the unknown interior values $U_I$:\n$$\nK_{II}U_I = F_I - K_{IB}g_B\n$$\nThe right-hand side is modified to account for the influence of the fixed boundary values, and a reduced system is solved. After finding $U_I$, the full solution vector $U$ is constructed by combining $U_I$ and the known $U_B=g_B$.\n\n**5. Error Calculation**\n- The maximum nodal absolute error is calculated as $\\max_{i} |U_i - u_{\\text{exact}}(x_i)|$, where $U_i$ is the computed nodal value and $u_{\\text{exact}}$ is the provided analytical solution.\n- The approximate $L^2$ norm of the error, specified for test case $2$, is computed using the composite trapezoidal rule on the nodal error values $e_i = U_i - u_{\\text{exact}}(x_i)$. The squared $L^2$ norm is approximated as $\\int_0^1 (u_h - u_{\\text{exact}})^2 dx \\approx \\int_0^1 e(x)^2 dx \\approx \\sum_{i=0}^{N-1} \\frac{h}{2} (e_i^2 + e_{i+1}^2)$. The final error is the square root of this value. This is efficiently computed using `numpy.trapz`.\n\nFor test cases $1$ and $3$, the source function $f(x)=0$ and the exact solution is linear. The piecewise-linear finite element method is able to exactly represent any linear function. Therefore, the numerical solution should be identical to the exact solution at the nodes, and the computed error is expected to be close to machine precision ($0.0$).",
            "answer": "```python\nimport numpy as np\n\ndef solve_fem_1d(N, f, essential_bcs, natural_bcs, u_exact, error_type):\n    \"\"\"\n    Solves the 1D Poisson equation -u'' = f using the finite element method.\n\n    Args:\n        N (int): Number of elements.\n        f (callable): Source function f(x).\n        essential_bcs (dict): Dictionary of essential (Dirichlet) BCs, {node_idx: value}.\n        natural_bcs (dict): Dictionary of natural (Neumann) BCs, {node_idx: traction}.\n        u_exact (callable): The exact solution function u_exact(x).\n        error_type (str): Type of error to compute ('max_nodal' or 'l2').\n\n    Returns:\n        float: The computed error.\n    \"\"\"\n    # 1. Mesh and space parameters\n    n_nodes = N + 1\n    h = 1.0 / N\n    nodes = np.linspace(0, 1, n_nodes)\n\n    # 2. Assemble global stiffness matrix K\n    K = np.zeros((n_nodes, n_nodes))\n    for i in range(N):\n        # Element stiffness matrix for element [x_i, x_{i+1}]\n        K_e = (1 / h) * np.array([[1, -1], [-1, 1]])\n        # Add to global matrix\n        K[i:i+2, i:i+2] += K_e\n\n    # 3. Assemble global load vector F\n    F = np.zeros(n_nodes)\n    \n    # Source term using 2-point Gaussian quadrature\n    if f is not None:\n        # Gauss points and weights on [-1, 1]\n        gauss_points = np.array([-1/np.sqrt(3), 1/np.sqrt(3)])\n        gauss_weights = np.array([1, 1])\n\n        for i in range(N):\n            # Map Gauss points to element [x_i, x_{i+1}]\n            x_gauss = nodes[i] + (h/2) * (1 + gauss_points)\n            \n            # Evaluate f(x) at quadrature points\n            f_vals = f(x_gauss)\n\n            # Local basis functions evaluated at quadrature points\n            # phi_i_local maps to (1-xi)/2, phi_{i+1}_local to (1+xi)/2\n            phi_i_vals = 0.5 * (1 - gauss_points)\n            phi_i_plus_1_vals = 0.5 * (1 + gauss_points)\n\n            # Element load vector contributions\n            F_e_i = (h/2) * np.sum(gauss_weights * f_vals * phi_i_vals)\n            F_e_i_plus_1 = (h/2) * np.sum(gauss_weights * f_vals * phi_i_plus_1_vals)\n\n            F[i] += F_e_i\n            F[i+1] += F_e_i_plus_1\n            \n    # Natural boundary conditions\n    for node_idx, traction in natural_bcs.items():\n        F[node_idx] += traction\n\n    # 4. Enforce essential boundary conditions by elimination\n    all_dofs = set(range(n_nodes))\n    boundary_dofs = set(essential_bcs.keys())\n    interior_dofs = sorted(list(all_dofs - boundary_dofs))\n    boundary_dofs_sorted = sorted(list(boundary_dofs))\n\n    if not interior_dofs: # Pure Dirichlet case with all nodes specified\n        U = np.zeros(n_nodes)\n        for dof, val in essential_bcs.items():\n            U[dof] = val\n    else:\n        # Partition K and F\n        K_II = K[np.ix_(interior_dofs, interior_dofs)]\n        F_I = F[interior_dofs]\n\n        g_B = np.array([essential_bcs[dof] for dof in boundary_dofs_sorted])\n\n        # If there are boundary DOFs, modify the RHS\n        if boundary_dofs_sorted:\n            K_IB = K[np.ix_(interior_dofs, boundary_dofs_sorted)]\n            F_I -= K_IB @ g_B\n\n        # 5. Solve for interior DOFs\n        U_I = np.linalg.solve(K_II, F_I)\n\n        # 6. Reconstruct full solution vector\n        U = np.zeros(n_nodes)\n        U[interior_dofs] = U_I\n        U[boundary_dofs_sorted] = g_B\n    \n    # 7. Calculate error\n    u_exact_nodes = u_exact(nodes)\n    \n    if error_type == 'max_nodal':\n        error = np.max(np.abs(U - u_exact_nodes))\n    elif error_type == 'l2':\n        error_sq_vals = (U - u_exact_nodes)**2\n        integral_error_sq = np.trapz(error_sq_vals, x=nodes)\n        error = np.sqrt(integral_error_sq)\n    else:\n        raise ValueError(\"Unknown error type\")\n\n    return error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 8,\n            \"f\": lambda x: 0.0 * x,\n            \"essential_bcs\": {0: 2.0},\n            \"natural_bcs\": {8: -3.0},\n            \"u_exact\": lambda x: 2.0 + 3.0 * x,\n            \"error_type\": \"max_nodal\",\n        },\n        {\n            \"N\": 32,\n            \"f\": lambda x: np.sin(np.pi * x),\n            \"essential_bcs\": {0: 0.0, 32: 0.0},\n            \"natural_bcs\": {},\n            \"u_exact\": lambda x: np.sin(np.pi * x) / (np.pi**2),\n            \"error_type\": \"l2\",\n        },\n        {\n            \"N\": 10,\n            \"f\": lambda x: 0.0 * x,\n            \"essential_bcs\": {0: 1.0, 10: 2.0},\n            \"natural_bcs\": {},\n            \"u_exact\": lambda x: 1.0 + x,\n            \"error_type\": \"max_nodal\",\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_fem_1d(\n            case[\"N\"],\n            case[\"f\"],\n            case[\"essential_bcs\"],\n            case[\"natural_bcs\"],\n            case[\"u_exact\"],\n            case[\"error_type\"],\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}