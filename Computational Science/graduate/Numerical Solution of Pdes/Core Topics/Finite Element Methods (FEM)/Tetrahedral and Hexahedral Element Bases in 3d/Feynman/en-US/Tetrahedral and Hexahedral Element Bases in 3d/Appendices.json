{
    "hands_on_practices": [
        {
            "introduction": "Before performing any analysis on a finite element mesh, we must ensure the mesh itself is valid. This practice focuses on the fundamental link between the geometry of a physical element and its reference counterpart, a concept that underpins the entire Finite Element Method. By computing the Jacobian determinant for a linear tetrahedron, you will gain a concrete understanding of how it quantifies volume scaling and, more importantly, how its sign determines whether an element is valid or unphysically \"inverted\" . This check is the first line of defense for ensuring the integrity of a numerical simulation.",
            "id": "3453395",
            "problem": "Consider the standard linear isoparametric mapping used in the Finite Element Method (FEM) for three-dimensional problems from the reference tetrahedron $\\hat{T}$ with vertices at $(0,0,0)$, $(1,0,0)$, $(0,1,0)$, $(0,0,1)$ to a physical tetrahedral element $T$ in $\\mathbb{R}^{3}$. The mapping is defined by $\\boldsymbol{x}(\\boldsymbol{\\xi}) = \\sum_{i=1}^{4} \\boldsymbol{x}_{i} \\phi_{i}(\\boldsymbol{\\xi})$ where $\\boldsymbol{x}_{i} \\in \\mathbb{R}^{3}$ are the physical vertex coordinates and $\\{\\phi_{i}\\}_{i=1}^{4}$ are the linear nodal basis functions on $\\hat{T}$ with $\\phi_{1}(\\boldsymbol{\\xi}) = 1 - \\xi_{1} - \\xi_{2} - \\xi_{3}$, $\\phi_{2}(\\boldsymbol{\\xi}) = \\xi_{1}$, $\\phi_{3}(\\boldsymbol{\\xi}) = \\xi_{2}$, and $\\phi_{4}(\\boldsymbol{\\xi}) = \\xi_{3}$. The Jacobian matrix $J$ of the mapping is $J = \\nabla_{\\boldsymbol{\\xi}} \\boldsymbol{x}(\\boldsymbol{\\xi})$, which is constant for this affine map.\n\nLet the physical tetrahedron $T$ have vertices ordered consistently with the reference element as follows:\n- $\\boldsymbol{x}_{1} = (0,1,2)$,\n- $\\boldsymbol{x}_{2} = (2,1,3)$,\n- $\\boldsymbol{x}_{3} = (1,4,2)$,\n- $\\boldsymbol{x}_{4} = (3,0,5)$.\n\nUsing only the fundamental definitions of isoparametric mapping, the Jacobian, and oriented volume scaling under affine transformations, compute the determinant $\\det J$ for this mapping. Then, interpret the sign of $\\det J$ in terms of orientation consistency and element inversion for the mapping between $\\hat{T}$ and $T$. Express the final numerical value of $\\det J$ exactly with no rounding. Your interpreted statement should be given in words in your derivation, but only the value of $\\det J$ will be graded numerically.",
            "solution": "The problem asks for the computation and interpretation of the determinant of the Jacobian matrix for a linear isoparametric mapping from a reference tetrahedron $\\hat{T}$ to a physical tetrahedron $T$.\n\nFirst, we establish the theoretical framework. The mapping from the reference coordinate system $\\boldsymbol{\\xi} = (\\xi_1, \\xi_2, \\xi_3)$ to the physical coordinate system $\\boldsymbol{x} = (x^{(1)}, x^{(2)}, x^{(3)})$ is given by:\n$$\n\\boldsymbol{x}(\\boldsymbol{\\xi}) = \\sum_{i=1}^{4} \\boldsymbol{x}_{i} \\phi_{i}(\\boldsymbol{\\xi})\n$$\nwhere $\\boldsymbol{x}_i \\in \\mathbb{R}^{3}$ are the coordinates of the vertices of the physical element $T$, and $\\{\\phi_i\\}_{i=1}^{4}$ are the linear basis (or shape) functions on the reference element $\\hat{T}$. The reference element vertices are $\\hat{v}_1=(0,0,0)$, $\\hat{v}_2=(1,0,0)$, $\\hat{v}_3=(0,1,0)$, and $\\hat{v}_4=(0,0,1)$. The given shape functions are:\n$\\phi_{1}(\\boldsymbol{\\xi}) = 1 - \\xi_{1} - \\xi_{2} - \\xi_{3}$\n$\\phi_{2}(\\boldsymbol{\\xi}) = \\xi_{1}$\n$\\phi_{3}(\\boldsymbol{\\xi}) = \\xi_{2}$\n$\\phi_{4}(\\boldsymbol{\\xi}) = \\xi_{3}$\n\nThe Jacobian matrix $J$ of this mapping is defined by its components $J_{ij} = \\frac{\\partial x^{(i)}}{\\partial \\xi_j}$. For an affine mapping, the Jacobian is a constant matrix. The columns of the Jacobian matrix are the vectors $\\frac{\\partial \\boldsymbol{x}}{\\partial \\xi_j}$ for $j=1, 2, 3$. We compute these columns by differentiating the mapping function:\n$$\n\\frac{\\partial \\boldsymbol{x}}{\\partial \\xi_j} = \\frac{\\partial}{\\partial \\xi_j} \\left( \\sum_{i=1}^{4} \\boldsymbol{x}_{i} \\phi_{i}(\\boldsymbol{\\xi}) \\right) = \\sum_{i=1}^{4} \\boldsymbol{x}_{i} \\frac{\\partial \\phi_{i}}{\\partial \\xi_j}\n$$\nWe find the partial derivatives of the shape functions with respect to the reference coordinates:\n$\\frac{\\partial \\phi_1}{\\partial \\xi_1}=-1$, $\\frac{\\partial \\phi_2}{\\partial \\xi_1}=1$, $\\frac{\\partial \\phi_3}{\\partial \\xi_1}=0$, $\\frac{\\partial \\phi_4}{\\partial \\xi_1}=0$.\n$\\frac{\\partial \\phi_1}{\\partial \\xi_2}=-1$, $\\frac{\\partial \\phi_2}{\\partial \\xi_2}=0$, $\\frac{\\partial \\phi_3}{\\partial \\xi_2}=1$, $\\frac{\\partial \\phi_4}{\\partial \\xi_2}=0$.\n$\\frac{\\partial \\phi_1}{\\partial \\xi_3}=-1$, $\\frac{\\partial \\phi_2}{\\partial \\xi_3}=0$, $\\frac{\\partial \\phi_3}{\\partial \\xi_3}=0$, $\\frac{\\partial \\phi_4}{\\partial \\xi_3}=1$.\n\nUsing these derivatives, the columns of the Jacobian matrix are:\nColumn 1: $\\frac{\\partial \\boldsymbol{x}}{\\partial \\xi_1} = \\boldsymbol{x}_1(-1) + \\boldsymbol{x}_2(1) + \\boldsymbol{x}_3(0) + \\boldsymbol{x}_4(0) = \\boldsymbol{x}_2 - \\boldsymbol{x}_1$.\nColumn 2: $\\frac{\\partial \\boldsymbol{x}}{\\partial \\xi_2} = \\boldsymbol{x}_1(-1) + \\boldsymbol{x}_2(0) + \\boldsymbol{x}_3(1) + \\boldsymbol{x}_4(0) = \\boldsymbol{x}_3 - \\boldsymbol{x}_1$.\nColumn 3: $\\frac{\\partial \\boldsymbol{x}}{\\partial \\xi_3} = \\boldsymbol{x}_1(-1) + \\boldsymbol{x}_2(0) + \\boldsymbol{x}_3(0) + \\boldsymbol{x}_4(1) = \\boldsymbol{x}_4 - \\boldsymbol{x}_1$.\n\nThe Jacobian matrix $J$ is thus formed by the edge vectors of the physical tetrahedron $T$ emanating from the vertex $\\boldsymbol{x}_1$:\n$$\nJ = \\begin{pmatrix} \\boldsymbol{x}_2 - \\boldsymbol{x}_1 & \\boldsymbol{x}_3 - \\boldsymbol{x}_1 & \\boldsymbol{x}_4 - \\boldsymbol{x}_1 \\end{pmatrix}\n$$\nThe vertices of the physical tetrahedron $T$ are given as:\n$\\boldsymbol{x}_1 = (0,1,2)$\n$\\boldsymbol{x}_2 = (2,1,3)$\n$\\boldsymbol{x}_3 = (1,4,2)$\n$\\boldsymbol{x}_4 = (3,0,5)$\n\nWe now compute the edge vectors which form the columns of $J$:\n$\\boldsymbol{e}_1 = \\boldsymbol{x}_2 - \\boldsymbol{x}_1 = (2-0, 1-1, 3-2) = (2, 0, 1)$\n$\\boldsymbol{e}_2 = \\boldsymbol{x}_3 - \\boldsymbol{x}_1 = (1-0, 4-1, 2-2) = (1, 3, 0)$\n$\\boldsymbol{e}_3 = \\boldsymbol{x}_4 - \\boldsymbol{x}_1 = (3-0, 0-1, 5-2) = (3, -1, 3)$\n\nAssembling the Jacobian matrix with these column vectors:\n$$\nJ = \\begin{pmatrix} 2 & 1 & 3 \\\\ 0 & 3 & -1 \\\\ 1 & 0 & 3 \\end{pmatrix}\n$$\nNext, we compute the determinant of $J$. Using the Sarrus rule or cofactor expansion:\n$$\n\\det J = (2)(3)(3) + (1)(-1)(1) + (3)(0)(0) - \\left[ (3)(3)(1) + (1)(0)(3) + (2)(-1)(0) \\right]\n$$\n$$\n\\det J = 18 - 1 + 0 - (9 + 0 + 0)\n$$\n$$\n\\det J = 17 - 9 = 8\n$$\nThe determinant of the Jacobian is $\\det J = 8$.\n\nFinally, we interpret the sign of this determinant. The determinant of the Jacobian, $\\det J$, represents the local scaling factor of volume between the reference element and the physical element. Specifically, an infinitesimal volume $d\\hat{V}$ in the reference space is mapped to an infinitesimal volume $dV$ in the physical space according to the relation $dV = \\det J \\, d\\hat{V}$.\n\nThe sign of $\\det J$ is critical for the validity of the finite element:\n- If $\\det J > 0$, the mapping is orientation-preserving. This means the \"handedness\" of the local coordinate system is the same in both the reference and physical elements. For instance, a right-handed basis in $\\hat{T}$ is mapped to a right-handed basis in $T$. This is the required condition for a non-inverted, physically meaningful element.\n- If $\\det J < 0$, the mapping is orientation-reversing, which implies the element has been \"flipped inside-out.\" This corresponds to an invalid or tangled element in the mesh, which will lead to incorrect results in a simulation.\n- If $\\det J = 0$, the mapping is singular. The physical element is degenerate, meaning it has zero volume (e.g., its four vertices are coplanar). This is also an invalid element for a $3$D analysis.\n\nIn this problem, $\\det J = 8$, which is a positive value. This indicates that the mapping from the reference tetrahedron $\\hat{T}$ to the physical tetrahedron $T$ is orientation-preserving. Therefore, the element $T$ is a valid, non-inverted element. The scaling factor for volume is $8$; that is, the volume of the physical tetrahedron $T$ is $8$ times the volume of the reference tetrahedron $\\hat{T}$. Since $\\text{Vol}(\\hat{T}) = 1/6$, the volume of the physical element is $\\text{Vol}(T) = 8 \\times (1/6) = 4/3$.",
            "answer": "$$\\boxed{8}$$"
        },
        {
            "introduction": "While linear basis functions offer simplicity, higher-order polynomials can provide significantly greater accuracy for a given mesh. This exercise moves from the geometric validity of an element to defining the function spaces used for approximation. We will construct a quadratic ($P_2$) Lagrange basis function directly from its defining property: it must be equal to one at its designated node and zero at all other nodes. This practice demonstrates a systematic way to derive basis functions on the reference tetrahedron using the elegant framework of barycentric coordinates , a skill essential for understanding and implementing a wide range of advanced finite elements.",
            "id": "3453402",
            "problem": "Consider the quadratic Lagrange space $P_2$ of total-degree at most two polynomials on the reference tetrahedron $\\hat T \\subset \\mathbb{R}^3$. Let the reference tetrahedron be defined as the convex hull of the vertices $\\hat v_1=(0,0,0)$, $\\hat v_2=(1,0,0)$, $\\hat v_3=(0,1,0)$, and $\\hat v_4=(0,0,1)$. Let $(\\lambda_1,\\lambda_2,\\lambda_3,\\lambda_4)$ denote the barycentric coordinates on $\\hat T$, which satisfy $\\lambda_i \\ge 0$ and $\\lambda_1+\\lambda_2+\\lambda_3+\\lambda_4=1$, with the identification $\\lambda_1=1-x-y-z$, $\\lambda_2=x$, $\\lambda_3=y$, and $\\lambda_4=z$ for $(x,y,z)\\in \\hat T$. In the context of the Finite Element Method (FEM), the $P_2$ Lagrange nodal basis on $\\hat T$ uses the $10$ degrees of freedom given by the $4$ vertices and the $6$ edge midpoints of $\\hat T$. Starting from the defining property of Lagrange interpolation that basis functions satisfy the Kronecker delta conditions at the selected nodes, enumerate all vertex and edge-midpoint nodes of $\\hat T$ and derive the corresponding quadratic Lagrange basis polynomials on $\\hat T$ that satisfy the Kronecker delta conditions at these nodes. Conclude with the explicit polynomial for the basis function associated with the edge midpoint between $\\hat v_2$ and $\\hat v_3$ written in terms of the barycentric coordinates. The final answer must be the single closed-form expression for this specific basis function. No numerical rounding is required, and no physical units are involved.",
            "solution": "The problem as stated is valid. It is scientifically grounded in the principles of numerical analysis and the Finite Element Method (FEM), specifically concerning the construction of polynomial basis functions on a simplicial element. The problem is well-posed, objective, and contains all necessary information to derive a unique solution.\n\nThe objective is to determine a specific quadratic Lagrange basis function on the reference tetrahedron $\\hat{T}$. The space of polynomials of total degree at most two on $\\hat{T}$, denoted $P_2(\\hat{T})$, is a vector space of dimension $\\binom{3+2}{3} = 10$. A basis for this space can be determined by defining $10$ nodal variables, which are specified as the function values at the $4$ vertices and $6$ edge midpoints of $\\hat{T}$. The resulting basis functions, $\\phi_j$, are the unique polynomials in $P_2(\\hat{T})$ that satisfy the Kronecker delta property $\\phi_j(\\hat{x}_k) = \\delta_{jk}$, where $\\{\\hat{x}_k\\}_{k=1}^{10}$ is the set of these $10$ nodes.\n\nFirst, we identify the nodes in terms of their Cartesian and barycentric coordinates. The reference tetrahedron $\\hat{T}$ is the convex hull of the vertices $\\hat{v}_1=(0,0,0)$, $\\hat{v}_2=(1,0,0)$, $\\hat{v}_3=(0,1,0)$, and $\\hat{v}_4=(0,0,1)$. The barycentric coordinates $(\\lambda_1, \\lambda_2, \\lambda_3, \\lambda_4)$ are linear polynomials related to the Cartesian coordinates $(x,y,z)$ by $\\lambda_1 = 1-x-y-z$, $\\lambda_2=x$, $\\lambda_3=y$, and $\\lambda_4=z$.\n\nThe $10$ nodes for the $P_2$ Lagrange element are:\nThe $4$ vertices:\n- $\\hat{v}_1 = (0,0,0)$, with barycentric coordinates $(1,0,0,0)$.\n- $\\hat{v}_2 = (1,0,0)$, with barycentric coordinates $(0,1,0,0)$.\n- $\\hat{v}_3 = (0,1,0)$, with barycentric coordinates $(0,0,1,0)$.\n- $\\hat{v}_4 = (0,0,1)$, with barycentric coordinates $(0,0,0,1)$.\n\nThe $6$ edge midpoints, $\\hat{v}_{ij} = \\frac{1}{2}(\\hat{v}_i + \\hat{v}_j)$:\n- $\\hat{v}_{12} = (\\frac{1}{2},0,0)$, with barycentric coordinates $(\\frac{1}{2},\\frac{1}{2},0,0)$.\n- $\\hat{v}_{13} = (0,\\frac{1}{2},0)$, with barycentric coordinates $(\\frac{1}{2},0,\\frac{1}{2},0)$.\n- $\\hat{v}_{14} = (0,0,\\frac{1}{2})$, with barycentric coordinates $(\\frac{1}{2},0,0,\\frac{1}{2})$.\n- $\\hat{v}_{23} = (\\frac{1}{2},\\frac{1}{2},0)$, with barycentric coordinates $(0,\\frac{1}{2},\\frac{1}{2},0)$.\n- $\\hat{v}_{24} = (\\frac{1}{2},0,\\frac{1}{2})$, with barycentric coordinates $(0,\\frac{1}{2},0,\\frac{1}{2})$.\n- $\\hat{v}_{34} = (0,\\frac{1}{2},\\frac{1}{2})$, with barycentric coordinates $(0,0,\\frac{1}{2},\\frac{1}{2})$.\n\nWe are asked to find the basis function associated with the midpoint of the edge connecting $\\hat{v}_2$ and $\\hat{v}_3$. Let us denote this node by $\\hat{v}_{23}$ and its corresponding basis function by $\\phi_{23}$. By definition of a Lagrange basis function, $\\phi_{23}$ must satisfy:\n- $\\phi_{23}(\\hat{v}_{23}) = 1$.\n- $\\phi_{23}(\\hat{x}_k) = 0$ for all other $9$ nodes $\\hat{x}_k \\neq \\hat{v}_{23}$.\n\nThe barycentric coordinate $\\lambda_i$ is a linear polynomial that is equal to $1$ at vertex $\\hat{v}_i$ and $0$ on the face opposite to $\\hat{v}_i$. The face opposite to $\\hat{v}_2$ is defined by the equation $\\lambda_2=0$, and it contains the vertices $\\hat{v}_1, \\hat{v}_3, \\hat{v}_4$. The face opposite to $\\hat{v}_3$ is defined by $\\lambda_3=0$ and contains the vertices $\\hat{v}_1, \\hat{v}_2, \\hat{v}_4$.\n\nLet us examine the set of nodes where $\\phi_{23}$ must be zero:\n$\\{\\hat{v}_1, \\hat{v}_2, \\hat{v}_3, \\hat{v}_4, \\hat{v}_{12}, \\hat{v}_{13}, \\hat{v}_{14}, \\hat{v}_{24}, \\hat{v}_{34}\\}$.\n\nA significant number of these nodes lie on the planes $\\lambda_1=0$ or $\\lambda_4=0$.\nAny $P_2$ node that is not $\\hat{v}_{23}$ must lie on one of the faces not containing the edge between $\\hat{v}_2$ and $\\hat{v}_3$. These faces are defined by $\\lambda_1=0$ and $\\lambda_4=0$. The polynomial $\\lambda_2 \\lambda_3$ is a quadratic polynomial that is zero if either $\\lambda_2=0$ or $\\lambda_3=0$. This condition is not sufficient. A better construction is to find planes that pass through all the zero-nodes.\nThe function must be zero at all nodes *not* on the edge $(\\hat{v}_2, \\hat{v}_3)$. This includes all nodes on the planes $\\lambda_1=0$ and $\\lambda_4=0$. The polynomial $\\lambda_1 \\lambda_4$ is zero on these planes. Wait, this isn't right.\n\nThe standard construction is to note that the basis function for the edge node $\\hat{v}_{ij}$ must be zero at all other nodes. All other nodes have at least one barycentric coordinate $\\lambda_k=0$ where $k \\notin \\{i, j\\}$. Thus, the product of all such $\\lambda_k$ would vanish. For $\\phi_{23}$, the indices are $i=2, j=3$. The other indices are $k=1,4$. The polynomial $\\lambda_1$ is zero at $\\hat{v}_2, \\hat{v}_3, \\hat{v}_4, \\hat{v}_{23}, \\hat{v}_{24}, \\hat{v}_{34}$. The polynomial $\\lambda_4$ is zero at $\\hat{v}_1, \\hat{v}_2, \\hat{v}_3, \\hat{v}_{12}, \\hat{v}_{13}, \\hat{v}_{23}$.\nThe product $\\lambda_2 \\lambda_3$ is zero at all nodes where either $\\lambda_2=0$ or $\\lambda_3=0$. This includes the nodes $\\hat{v}_1, \\hat{v}_4, \\hat{v}_{13}, \\hat{v}_{14}, \\hat{v}_{34}$ (where $\\lambda_2=0$) and $\\hat{v}_1, \\hat{v}_4, \\hat{v}_{12}, \\hat{v}_{14}, \\hat{v}_{24}$ (where $\\lambda_3=0$). It is also zero at $\\hat{v}_2$ and $\\hat{v}_3$. The set of nodes where $\\lambda_2 \\lambda_3 = 0$ is $\\{\\hat{v}_1, \\hat{v}_2, \\hat{v}_3, \\hat{v}_4, \\hat{v}_{12}, \\hat{v}_{13}, \\hat{v}_{14}, \\hat{v}_{24}, \\hat{v}_{34}\\}$, which is precisely the set of all nodes except $\\hat{v}_{23}$.\nThis suggests that the desired basis function $\\phi_{23}$ is proportional to the product $\\lambda_2 \\lambda_3$.\nLet us set $\\phi_{23} = C \\lambda_2 \\lambda_3$ for some constant $C$.\nThis function is a quadratic polynomial, so it belongs to $P_2(\\hat{T})$.\n\nTo determine the constant $C$, we enforce the condition $\\phi_{23}(\\hat{v}_{23}) = 1$. The barycentric coordinates of the node $\\hat{v}_{23}$ are $(0, \\frac{1}{2}, \\frac{1}{2}, 0)$.\nSubstituting these values into the expression for $\\phi_{23}$:\n$$\n\\phi_{23}(\\hat{v}_{23}) = C \\left(\\frac{1}{2}\\right) \\left(\\frac{1}{2}\\right) = \\frac{C}{4}\n$$\nSetting this equal to $1$:\n$$\n\\frac{C}{4} = 1 \\implies C = 4\n$$\nThus, the explicit form of the basis function associated with the edge midpoint $\\hat{v}_{23}$ is:\n$$\n\\phi_{23} = 4 \\lambda_2 \\lambda_3\n$$\nThis function is quadratic, equals $1$ at $\\hat{v}_{23}$, and is zero at all other $P_2$ nodes on the tetrahedron, as required.\n\nFor completeness, the general forms for the $P_2$ basis functions on a tetrahedron are:\n- For a vertex node $\\hat{v}_i$: $\\phi_i = \\lambda_i(2\\lambda_i - 1)$.\n- For an edge midpoint node $\\hat{v}_{ij}$: $\\phi_{ij} = 4\\lambda_i\\lambda_j$.\nOur derived result for $\\phi_{23}$ is consistent with this general formula.",
            "answer": "$$\n\\boxed{4 \\lambda_2 \\lambda_3}\n$$"
        },
        {
            "introduction": "The ultimate goal of the finite element framework is to transform a continuous partial differential equation into a discrete system of linear equations. This practice tackles the core of this process: computing the entries of the local \"stiffness\" matrix, which represents the discretized differential operator. This exercise synthesizes the concepts of isoparametric mapping, Jacobian transformation, and basis function derivatives into a single, concrete calculation . By completing it, you will gain direct, hands-on experience in how the mathematical formulation of a PDE is translated into the numerical components of a real-world FEM simulation.",
            "id": "3453422",
            "problem": "Consider the three-dimensional ($3$D) diffusion model given by the second-order linear partial differential equation (PDE) $-\\nabla \\cdot (a(\\boldsymbol{x})\\nabla u)=f$ on a domain partitioned into tetrahedral elements. In the standard Galerkin finite element method (Finite Element Method, FEM) with first-order ($\\mathbb{P}_1$) tetrahedral basis functions $\\{N_i\\}$, the local stiffness matrix entry associated with an element $K$ is defined by the bilinear form\n$$\nA_{ij} \\;=\\; \\int_{K} \\nabla N_i(\\boldsymbol{x})\\cdot a(\\boldsymbol{x})\\,\\nabla N_j(\\boldsymbol{x})\\,dx \\;=\\; \\int_{K} \\nabla N_i(\\boldsymbol{x})^{\\top}\\,a(\\boldsymbol{x})\\,\\nabla N_j(\\boldsymbol{x})\\,dx .\n$$\nStarting from the chain rule and the definition of the isoparametric mapping from the reference tetrahedron $\\hat{K}$ with vertices $\\hat{v}_1=(0,0,0)$, $\\hat{v}_2=(1,0,0)$, $\\hat{v}_3=(0,1,0)$, $\\hat{v}_4=(0,0,1)$, write an explicit formula for the entry $A_{ij}$ in terms of the reference gradients $\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i$ and the element Jacobian. Then, compute the specific entry $A_{13}$ on the physical tetrahedral element $K$ with vertices\n$$\n\\boldsymbol{v}_1=(0,0,0),\\quad \\boldsymbol{v}_2=(1,0,0),\\quad \\boldsymbol{v}_3=(0,2,0),\\quad \\boldsymbol{v}_4=(0,0,3),\n$$\nassuming a constant, symmetric, positive definite diffusion tensor on $K$ given by\n$$\na(\\boldsymbol{x})\\equiv a \\;=\\; \\begin{pmatrix}2 & 1 & 0\\\\[4pt] 1 & 3 & 0\\\\[4pt] 0 & 0 & 4\\end{pmatrix}.\n$$\nYour derivation must begin from the fundamental chain-rule relationship between physical and reference gradients and integrate using the element mapping. You may use that the reference $\\mathbb{P}_1$ basis functions on $\\hat{K}$ are $\\hat{N}_1(\\xi,\\eta,\\zeta)=1-\\xi-\\eta-\\zeta$, $\\hat{N}_2(\\xi,\\eta,\\zeta)=\\xi$, $\\hat{N}_3(\\xi,\\eta,\\zeta)=\\eta$, $\\hat{N}_4(\\xi,\\eta,\\zeta)=\\zeta$, with constant reference gradients on $\\hat{K}$.\n\nExpress the final answer for $A_{13}$ as an exact value. Do not round. In your outline, clearly indicate the mapping to the reference element and how the Jacobian enters the computation. You may additionally comment on how the procedure differs for trilinear ($\\mathbb{Q}_1$) hexahedral elements, but the only quantity to be numerically evaluated is $A_{13}$ for the given tetrahedral element.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It represents a standard calculation in the Finite Element Method (FEM) for solving partial differential equations. All necessary data and definitions are provided, and there are no internal contradictions or ambiguities.\n\nThe primary task is to compute a specific entry, $A_{13}$, of the local stiffness matrix for a given tetrahedral element $K$. The stiffness matrix entry is defined by the integral:\n$$\nA_{ij} = \\int_{K} \\nabla N_i(\\boldsymbol{x})^{\\top}\\,a(\\boldsymbol{x})\\,\\nabla N_j(\\boldsymbol{x})\\,dx\n$$\nHere, $N_i(\\boldsymbol{x})$ are the $\\mathbb{P}_1$ basis functions on the physical element $K$, $\\nabla$ is the gradient with respect to the physical coordinates $\\boldsymbol{x}=(x,y,z)$, and $a(\\boldsymbol{x})$ is the diffusion tensor. The standard FEM procedure involves mapping this integral to a reference element $\\hat{K}$ where calculations are simpler.\n\n**1. Isoparametric Mapping and the Jacobian**\n\nThe isoparametric mapping provides a transformation from the reference coordinates $\\hat{\\boldsymbol{x}}=(\\xi, \\eta, \\zeta) \\in \\hat{K}$ to the physical coordinates $\\boldsymbol{x}=(x,y,z) \\in K$. For a linear tetrahedral element, this mapping is affine and is defined using the reference basis functions $\\hat{N}_k$ and the vertices $\\boldsymbol{v}_k$ of the physical element:\n$$\n\\boldsymbol{x}(\\hat{\\boldsymbol{x}}) = \\sum_{k=1}^{4} \\boldsymbol{v}_k \\hat{N}_k(\\hat{\\boldsymbol{x}})\n$$\nGiven the vertices $\\boldsymbol{v}_1=(0,0,0)$, $\\boldsymbol{v}_2=(1,0,0)$, $\\boldsymbol{v}_3=(0,2,0)$, $\\boldsymbol{v}_4=(0,0,3)$ and the reference basis functions $\\hat{N}_1=1-\\xi-\\eta-\\zeta$, $\\hat{N}_2=\\xi$, $\\hat{N}_3=\\eta$, $\\hat{N}_4=\\zeta$, the mapping becomes:\n$$\n\\boldsymbol{x}(\\xi,\\eta,\\zeta) = (0,0,0)(1-\\xi-\\eta-\\zeta) + (1,0,0)\\xi + (0,2,0)\\eta + (0,0,3)\\zeta = (\\xi, 2\\eta, 3\\zeta)\n$$\nThe Jacobian matrix of this transformation, $J$, relates the differential operators in the two coordinate systems. It is defined as:\n$$\nJ = \\frac{\\partial(x,y,z)}{\\partial(\\xi,\\eta,\\zeta)} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial x}{\\partial \\zeta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\zeta} \\\\ \\frac{\\partial z}{\\partial \\xi} & \\frac{\\partial z}{\\partial \\eta} & \\frac{\\partial z}{\\partial \\zeta} \\end{pmatrix}\n$$\nFor the mapping $\\boldsymbol{x}(\\xi,\\eta,\\zeta) = (\\xi, 2\\eta, 3\\zeta)$, the Jacobian is a constant matrix:\n$$\nJ = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 2 & 0 \\\\ 0 & 0 & 3 \\end{pmatrix}\n$$\nThe determinant of the Jacobian is $|J| = \\det(J) = 1 \\cdot 2 \\cdot 3 = 6$.\n\n**2. Transformation of Gradients and the Integral**\n\nThe chain rule relates the gradients in the physical and reference coordinate systems. Let $\\nabla_{\\boldsymbol{x}}$ be the gradient with respect to $\\boldsymbol{x}$ and $\\nabla_{\\hat{\\boldsymbol{x}}}$ be the gradient with respect to $\\hat{\\boldsymbol{x}}$. Then, for a function $f$, we have $\\nabla_{\\hat{\\boldsymbol{x}}} f = J^{\\top} \\nabla_{\\boldsymbol{x}} f$. We need the physical gradient $\\nabla_{\\boldsymbol{x}} N_i$, which is obtained by inverting this relationship:\n$$\n\\nabla_{\\boldsymbol{x}} N_i(\\boldsymbol{x}) = (J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i(\\hat{\\boldsymbol{x}})\n$$\nThe differential volume element transforms according to $dx = |J|\\,d\\hat{x}$.\n\nSubstituting these transformations into the expression for $A_{ij}$:\n$$\nA_{ij} = \\int_{\\hat{K}} \\left((J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i\\right)^{\\top} a \\left((J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j\\right) |J|\\,d\\hat{x}\n$$\nUsing the property $(AB)^{\\top} = B^{\\top}A^{\\top}$, we get:\n$$\nA_{ij} = \\int_{\\hat{K}} (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i)^{\\top} (J^{-1}) a (J^{-1})^{\\top} (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j) |J|\\,d\\hat{x}\n$$\nThis is the explicit formula for $A_{ij}$ in terms of reference quantities. For $\\mathbb{P}_1$ elements, the reference gradients $\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i$ are constant vectors. Since the mapping is affine, $J$ is a constant matrix. The problem states that $a(\\boldsymbol{x})$ is a constant tensor $a$. Therefore, the entire integrand is constant and can be moved outside the integral:\n$$\nA_{ij} = |J| \\left( (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i)^{\\top} J^{-1} a (J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j \\right) \\int_{\\hat{K}} d\\hat{x}\n$$\nThe integral $\\int_{\\hat{K}} d\\hat{x}$ is the volume of the reference tetrahedron, $\\text{Vol}(\\hat{K})$. The vertices $\\hat{v}_1=(0,0,0), \\hat{v}_2=(1,0,0), \\hat{v}_3=(0,1,0), \\hat{v}_4=(0,0,1)$ define a tetrahedron with volume $\\frac{1}{6}$.\nThus, the final formula is:\n$$\nA_{ij} = |J| \\text{Vol}(\\hat{K}) \\left( (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i)^{\\top} J^{-1} a (J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j \\right) = \\text{Vol}(K) \\left( (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i)^{\\top} J^{-1} a (J^{-1})^{\\top} \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j \\right)\n$$\nwhere $\\text{Vol}(K)=|J|\\text{Vol}(\\hat{K}) = 6 \\cdot \\frac{1}{6} = 1$.\n\n**3. Calculation of $A_{13}$**\n\nWe need to compute $A_{13}$ for the given element and diffusion tensor.\nFirst, we find the necessary components:\n- Volume of the physical element: $\\text{Vol}(K) = 1$.\n- Reference gradients for $i=1$ and $j=3$:\n  $$\n  \\hat{N}_1 = 1 - \\xi - \\eta - \\zeta \\implies \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_1 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}\n  $$\n  $$\n  \\hat{N}_3 = \\eta \\implies \\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n  $$\n- Inverse of the Jacobian matrix:\n  $$\n  J^{-1} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 2 & 0 \\\\ 0 & 0 & 3 \\end{pmatrix}^{-1} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\frac{1}{2} & 0 \\\\ 0 & 0 & \\frac{1}{3} \\end{pmatrix}\n  $$\n- Diffusion tensor:\n  $$\n  a = \\begin{pmatrix} 2 & 1 & 0 \\\\ 1 & 3 & 0 \\\\ 0 & 0 & 4 \\end{pmatrix}\n  $$\nNow, we compute the matrix product $B = J^{-1} a (J^{-1})^{\\top}$. Since $J^{-1}$ is diagonal, $(J^{-1})^{\\top} = J^{-1}$.\n$$\nB = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\frac{1}{2} & 0 \\\\ 0 & 0 & \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 2 & 1 & 0 \\\\ 1 & 3 & 0 \\\\ 0 & 0 & 4 \\end{pmatrix} \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\frac{1}{2} & 0 \\\\ 0 & 0 & \\frac{1}{3} \\end{pmatrix}\n$$\n$$\nB = \\begin{pmatrix} 2 & 1 & 0 \\\\ \\frac{1}{2} &  \\frac{3}{2} & 0 \\\\ 0 & 0 & \\frac{4}{3} \\end{pmatrix} \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\frac{1}{2} & 0 \\\\ 0 & 0 & \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} 2 & \\frac{1}{2} & 0 \\\\ \\frac{1}{2} & \\frac{3}{4} & 0 \\\\ 0 & 0 & \\frac{4}{9} \\end{pmatrix}\n$$\nFinally, we compute $A_{13} = \\text{Vol}(K) (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_1)^{\\top} B (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_3)$:\n$$\nA_{13} = (1) \\begin{pmatrix} -1 & -1 & -1 \\end{pmatrix} \\begin{pmatrix} 2 & \\frac{1}{2} & 0 \\\\ \\frac{1}{2} & \\frac{3}{4} & 0 \\\\ 0 & 0 & \\frac{4}{9} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\nFirst, multiply the matrix $B$ by the vector $\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_3$:\n$$\n\\begin{pmatrix} 2 & \\frac{1}{2} & 0 \\\\ \\frac{1}{2} & \\frac{3}{4} & 0 \\\\ 0 & 0 & \\frac{4}{9} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{3}{4} \\\\ 0 \\end{pmatrix}\n$$\nThen, perform the final dot product:\n$$\nA_{13} = \\begin{pmatrix} -1 & -1 & -1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{3}{4} \\\\ 0 \\end{pmatrix} = (-1)\\left(\\frac{1}{2}\\right) + (-1)\\left(\\frac{3}{4}\\right) + (-1)(0)\n$$\n$$\nA_{13} = -\\frac{1}{2} - \\frac{3}{4} = -\\frac{2}{4} - \\frac{3}{4} = -\\frac{5}{4}\n$$\n\n**4. Comparison with Hexahedral Elements**\nFor trilinear ($\\mathbb{Q}_1$) hexahedral elements, the procedure is conceptually similar but computationally more involved. The key differences are:\n1.  **Mapping and Jacobian**: The isoparametric mapping uses $8$ nodes and trilinear basis functions (e.g., $\\hat{N}_i = \\frac{1}{8}(1\\pm\\xi)(1\\pm\\eta)(1\\pm\\zeta)$ on the reference cube $[-1,1]^3$). This mapping is generally not affine. Consequently, the Jacobian matrix $J$ and its determinant $|J|$ are functions of the reference coordinates $(\\xi,\\eta,\\zeta)$, not constants.\n2.  **Reference Gradients**: The gradients of the trilinear basis functions, $\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i$, are also not constant vectors; their components are linear functions of the reference coordinates.\n3.  **Integration**: Because the integrand $ (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_i)^{\\top} J^{-1} a (J^{-1})^{\\top} (\\nabla_{\\hat{\\boldsymbol{x}}} \\hat{N}_j) |J| $ is no longer a constant but a rational function of $(\\xi,\\eta,\\zeta)$, the integral must be evaluated using numerical quadrature, such as a $2 \\times 2 \\times 2$ Gaussian quadrature scheme. This is in stark contrast to the tetrahedral case where the integral reduces to a multiplication by the element's volume.",
            "answer": "$$ \\boxed{-\\frac{5}{4}} $$"
        }
    ]
}