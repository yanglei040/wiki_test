{
    "hands_on_practices": [
        {
            "introduction": "数值方法的稳定性是获得可靠解的首要条件。第一个练习将通过一个基础的动手计算，来确定应用于有限元空间离散的显式时间步进格式的稳定性极限。通过对系统矩阵进行谱分析，你将推导出允许的最大稳定时间步长，从而具体理解空间离散尺度（$h$）和物理属性（$\\nu$）如何共同约束时间步长（$\\Delta t$）。",
            "id": "3447081",
            "problem": "考虑一维热方程 $u_{t} = \\nu u_{xx}$，定义在空间区间 $[0,L]$上，其齐次狄利克雷边界条件为 $u(0,t) = 0$ 和 $u(L,t) = 0$，其中 $\\nu  0$ 是热扩散系数。将空间域离散为三个长度为 $h = L/3$ 的均匀子区间，并用与四个网格节点相关的连续分段线性基函数来近似 $u(x,t)$。在 $x=0$ 和 $x=L$ 处强加边界条件，使得半离散系统用两个内部节点自由度表示。使用标准的伽辽金有限元方法(FEM)和一致质量矩阵。将得到的半离散系统表示为 $M \\dot{\\mathbf{u}}(t) + \\nu K \\mathbf{u}(t) = \\mathbf{0}$，其中 $M$ 是 $2 \\times 2$ 的质量矩阵，$K$ 是 $2 \\times 2$ 的刚度矩阵。\n\n使用具有均匀时间步长 $\\Delta t$ 的前向欧拉法对该半离散系统进行时间离散化，得到全离散更新格式为 $\\mathbf{u}^{n+1} = \\mathbf{u}^{n} - \\Delta t \\,\\nu\\, M^{-1} K \\,\\mathbf{u}^{n}$。从变分形式以及 $M$ 和 $K$ 的单元定义出发，组装全局内部矩阵，并通过广义特征值问题 $K \\mathbf{v} = \\mu M \\mathbf{v}$ 进行谱分析，以确定该方法对所有模式在 $\\ell^{2}$-范数下非放大的最大允许时间步长 $\\Delta t_{\\max}$。\n\n给出 $\\Delta t_{\\max}$ 关于 $L$ 和 $\\nu$ 的精确、闭式符号表达式。将您的答案以秒为单位表示。您的最终答案必须是一个单一的闭式表达式，且不得包含不等式或附加条件。",
            "solution": "该问题要求解一维热方程的半离散有限元近似在前向欧拉时间离散化下的最大稳定时间步长。\n\n控制偏微分方程为热方程：\n$$\nu_{t} = \\nu u_{xx}, \\quad x \\in [0,L], t0\n$$\n其齐次狄利克雷边界条件为 $u(0,t) = 0$ 和 $u(L,t) = 0$。参数 $\\nu  0$ 是热扩散系数。\n\n标准的伽辽金有限元方法从变分（或弱）形式开始。我们寻求一个在函数空间 $H^1_0([0,L])$ 中的解 $u(\\cdot, t)$，使得对于任意测试函数 $v \\in H^1_0([0,L])$：\n$$\n\\int_{0}^{L} u_t v \\,dx = \\int_{0}^{L} (\\nu u_{xx}) v \\,dx\n$$\n对右侧进行分部积分并应用齐次边界条件，得到：\n$$\n\\int_{0}^{L} u_t v \\,dx = -\\nu \\int_{0}^{L} u_x v_x \\,dx\n$$\n空间域 $[0,L]$ 被离散为三个均匀子区间，因此网格尺寸为 $h = L/3$。节点位于 $x_0=0$，$x_1=L/3$，$x_2=2L/3$ 和 $x_3=L$。我们使用连续分段线性基函数 $\\phi_i(x)$。近似解写为这些基函数的线性组合：\n$$\nu_h(x,t) = \\sum_{j=0}^{3} u_j(t) \\phi_j(x)\n$$\n边界条件 $u(0,t)=0$ 和 $u(L,t)=0$ 被强加，这意味着 $u_0(t)=0$ 和 $u_3(t)=0$。因此，近似解由两个内部节点值定义：\n$$\nu_h(x,t) = u_1(t)\\phi_1(x) + u_2(t)\\phi_2(x)\n$$\n我们从相同的有限维空间中选择测试函数，即 $v_h(x) = \\phi_i(x)$，其中 $i=1,2$。将 $u_h$ 和 $v_h$ 代入弱形式，得到关于内部节点值 $\\mathbf{u}(t) = [u_1(t), u_2(t)]^T$ 的常微分方程组：\n$$\nM \\dot{\\mathbf{u}}(t) + \\nu K \\mathbf{u}(t) = \\mathbf{0}\n$$\n其中 $M$ 是一致质量矩阵，$K$ 是刚度矩阵，其元素为：\n$$\nM_{ij} = \\int_0^L \\phi_j(x) \\phi_i(x) \\,dx \\quad \\text{和} \\quad K_{ij} = \\int_0^L \\phi'_j(x) \\phi'_i(x) \\,dx\n$$\n为了计算这些矩阵，我们首先确定一个长度为 $h$ 的通用单元的单元质量矩阵 $M^e$ 和单元刚度矩阵 $K^e$。在局部域 $[0,h]$上使用线性形函数 $N_1(\\xi) = 1-\\xi/h$ 和 $N_2(\\xi) = \\xi/h$，我们得到：\n$$\nM^e = \\int_0^h \\begin{pmatrix} N_1^2  N_1 N_2 \\\\ N_2 N_1  N_2^2 \\end{pmatrix} d\\xi = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n$$\nK^e = \\int_0^h \\begin{pmatrix} (N'_1)^2  N'_1 N'_2 \\\\ N'_2 N'_1  (N'_2)^2 \\end{pmatrix} d\\xi = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n两个内部自由度的全局矩阵是由三个单元 $[x_0, x_1]$、$[x_1, x_2]$ 和 $[x_2, x_3]$ 的贡献组装而成的。\n对于质量矩阵 $M$：\n$M_{11}$ 接收来自单元1（节点2）和单元2（节点1）的贡献：$M_{11} = M^e_{22} + M^e_{11} = h/3 + h/3 = 2h/3$。\n$M_{22}$ 接收来自单元2（节点2）和单元3（节点1）的贡献：$M_{22} = M^e_{22} + M^e_{11} = h/3 + h/3 = 2h/3$。\n$M_{12} = M_{21}$ 接收来自单元2的贡献：$M_{12} = M^e_{12} = h/6$。\n$$\nM = \\begin{pmatrix} 2h/3  h/6 \\\\ h/6  2h/3 \\end{pmatrix} = \\frac{h}{6} \\begin{pmatrix} 4  1 \\\\ 1  4 \\end{pmatrix}\n$$\n对于刚度矩阵 $K$：\n$K_{11}$ 接收来自单元1（节点2）和单元2（节点1）的贡献：$K_{11} = K^e_{22} + K^e_{11} = 1/h + 1/h = 2/h$。\n$K_{22}$ 接收来自单元2（节点2）和单元3（节点1）的贡献：$K_{22} = K^e_{22} + K^e_{11} = 1/h + 1/h = 2/h$。\n$K_{12} = K_{21}$ 接收来自单元2的贡献：$K_{12} = K^e_{12} = -1/h$。\n$$\nK = \\begin{pmatrix} 2/h  -1/h \\\\ -1/h  2/h \\end{pmatrix} = \\frac{1}{h} \\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix}\n$$\n该半离散系统使用时间步长为 $\\Delta t$ 的前向欧拉法进行时间离散化：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{n}}{\\Delta t} = - \\nu M^{-1} K \\mathbf{u}^{n}\n$$\n这给出了全离散更新规则：\n$$\n\\mathbf{u}^{n+1} = (I - \\Delta t \\, \\nu M^{-1} K) \\mathbf{u}^{n}\n$$\n矩阵 $G = I - \\Delta t \\, \\nu M^{-1} K$ 是放大矩阵。为使该方法非放大（稳定），$G$ 的谱半径必须满足 $\\rho(G) \\le 1$。\n$G$ 的特征值（记为 $\\lambda_G$）与 $M^{-1}K$ 的特征值（记为 $\\mu$）通过 $\\lambda_G = 1 - \\Delta t \\, \\nu \\mu$ 相关联。特征值 $\\mu$ 是广义特征值问题 $K \\mathbf{v} = \\mu M \\mathbf{v}$ 的解。\n由于 $M$ 和 $K$ 是对称正定矩阵，特征值 $\\mu$ 是实数且为正。稳定性条件 $|\\lambda_G| \\le 1$ 变为：\n$$\n|1 - \\Delta t \\, \\nu \\mu| \\le 1 \\implies -1 \\le 1 - \\Delta t \\, \\nu \\mu \\le 1\n$$\n对于 $\\Delta t, \\nu, \\mu > 0$，右侧不等式恒成立。左侧不等式给出：\n$$\n-2 \\le - \\Delta t \\, \\nu \\mu \\implies \\Delta t \\le \\frac{2}{\\nu \\mu}\n$$\n为确保所有模式的稳定性，此条件必须对最大特征值 $\\mu_{\\max}$ 成立。因此，最大稳定时间步长为：\n$$\n\\Delta t_{\\max} = \\frac{2}{\\nu \\mu_{\\max}}\n$$\n我们现在求解广义特征值问题 $\\det(K - \\mu M) = 0$：\n$$\n\\det\\left( \\frac{1}{h} \\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix} - \\mu \\frac{h}{6} \\begin{pmatrix} 4  1 \\\\ 1  4 \\end{pmatrix} \\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} \\frac{2}{h} - \\frac{4\\mu h}{6}  -\\frac{1}{h} - \\frac{\\mu h}{6} \\\\ -\\frac{1}{h} - \\frac{\\mu h}{6}  \\frac{2}{h} - \\frac{4\\mu h}{6} \\end{pmatrix} = 0\n$$\n这得到特征方程：\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right)^2 - \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right)^2 = 0\n$$\n这是 $A^2 - B^2 = 0$ 的形式，可因式分解为 $(A-B)(A+B) = 0$。\n\n情况1：$A-B = 0$\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right) - \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right) = 0 \\implies \\frac{3}{h} - \\frac{3\\mu h}{6} = 0 \\implies \\frac{3}{h} = \\frac{\\mu h}{2} \\implies \\mu_1 = \\frac{6}{h^2}\n$$\n情况2：$A+B = 0$\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right) + \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right) = 0 \\implies \\frac{1}{h} - \\frac{5\\mu h}{6} = 0 \\implies \\frac{1}{h} = \\frac{5\\mu h}{6} \\implies \\mu_2 = \\frac{6}{5h^2}\n$$\n特征值为 $\\mu_1 = 6/h^2$ 和 $\\mu_2 = 6/(5h^2)$。最大特征值为：\n$$\n\\mu_{\\max} = \\frac{6}{h^2}\n$$\n现在我们可以计算最大稳定时间步长：\n$$\n\\Delta t_{\\max} = \\frac{2}{\\nu \\mu_{\\max}} = \\frac{2}{\\nu (6/h^2)} = \\frac{2h^2}{6\\nu} = \\frac{h^2}{3\\nu}\n$$\n问题指明区域 $[0,L]$ 被划分为三个子区间，因此网格尺寸为 $h = L/3$。将此代入 $\\Delta t_{\\max}$ 的表达式中：\n$$\n\\Delta t_{\\max} = \\frac{(L/3)^2}{3\\nu} = \\frac{L^2/9}{3\\nu} = \\frac{L^2}{27\\nu}\n$$\n这就是最大允许时间步长的最终表达式。",
            "answer": "$$\\boxed{\\frac{L^2}{27\\nu}}$$"
        },
        {
            "introduction": "尽管像BDF2这样的高阶隐式方法在理论上具有出色的稳定性，但它们在实践中的表现关键取决于实现的准确性。本练习旨在探讨数值积分这一微妙但重要的因素对稳定性的影响，揭示质量矩阵的欠积分如何损害BDF2格式的A-稳定性。通过这个编程实践，你将量化稳定性的退化过程，并体会空间积分与时间稳定性之间的相互作用。",
            "id": "3447128",
            "problem": "考虑单位区间上具有齐次狄利克雷边界条件的一维扩散算子的线性、含时有限元方法 (FEM) 半离散化。该半离散模型为 $M \\dot{u} + K u = f$，其中 $M$ 是质量矩阵，$K$ 是刚度矩阵，它们由均匀网格上的连续分片线性形函数组装而成。假设 $f \\equiv 0$，从而使得连续演化相对于精确质量矩阵 $M$ 诱导的能量是收缩的。已知二阶向后差分格式 (BDF2) 对于具有非正实谱的标量测试方程是绝对稳定（A-稳定）的。\n\n你的任务是量化在组装 $M$ 过程中的求积误差如何影响将 BDF2 应用于 $M \\dot{u} + K u = 0$ 时观察到的步进绝对稳定性，并提供一个关于用于 $M$ 的求积阶数的定量退化度量。严格遵循以下基本原理：$M$ 和 $K$ 的伽辽金定义，BDF2 作为求解 $\\dot{u}$ 的两步隐式公式的定义，以及通过单步放大算子的谱半径来表征稳定性。\n\n请实现以下内容，并遵守所有规范：\n\n1) 几何与离散化：\n- 使用具有 $N$ 个单元的单位区间 $[0,1]$ 的均匀剖分，以及在两端点具有齐次狄利克雷边界条件的连续分片线性基函数。使用 $N = 32$。\n- 使用单元上的精确积分来组装精确刚度矩阵 $K$。\n- 组装两个质量矩阵：使用精确积分的精确质量矩阵 $M_{\\text{ex}}$，以及通过每个单元 $q$ 个点的高斯-勒让德求积组装的近似质量矩阵 $M_q$，其中 $q \\in \\{1,2,3\\}$。\n\n2) 时间离散化：\n- 将二阶向后差分格式 (BDF2) 应用于均匀时间步长 $\\Delta t$ 上的半离散系统 $M_q \\dot{u} + K u = 0$。从 BDF2 的定义出发，它是一个两步线性多步格式，使用新时间点和前两个时间点的 $u$ 的线性组合来逼近新时间点的 $\\dot{u}$，不要假定任何简化公式。\n\n3) 稳定性表征：\n- 对于用 $M_q$ 代替 $M$ 的齐次问题，推导将分块状态 $[u^n; u^{n-1}]$ 映射到 $[u^{n+1}; u^n]$ 的线性、时不变、单步放大算子。定义该放大算子的谱半径，并用它来衡量在给定 $\\Delta t$ 下的绝对稳定性。\n- 通过矩阵对 $(M_q, M_{\\text{ex}})$ 的最小广义特征值 $c(q)$ 来量化近似质量相对于精确质量的矫顽性退化，即在非零 $v$ 上瑞利商 $v^\\top M_q v / v^\\top M_{\\text{ex}} v$ 的最小值。这个数满足 $c(q) \\in [0,\\infty)$，并衡量了质量在最坏情况下的相对低估程度；接近 0 的值表示矫顽性的丧失。\n\n4) 测试套件和输出指标：\n- 使用 $N = 32$ 个单元。\n- 使用求积阶数 $q \\in \\{1,2,3\\}$ 来组装 $M_q$。\n- 使用时间步长集合 $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$。\n- 对于每个 $q$，计算两个量：\n  a) 如上文定义的矫顽性比 $c(q)$。\n  b) 在给定的 $\\Delta t$ 值上，BDF2 放大算子的最大谱半径 $\\rho_{\\max}(q)$。\n\n5) 输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[c(1), \\rho_{\\max}(1), c(2), \\rho_{\\max}(2), c(3), \\rho_{\\max}(3)]$。\n- 所有输出必须是浮点格式的实数。\n\n不涉及物理单位；所有量纲均为一。不使用角度。不使用百分比；比率必须表示为小数。数值结果必须由你的程序针对指定的测试套件直接计算得出；不允许外部输入。",
            "solution": "我们从单位区间 $[0,1]$ 上具有齐次狄利克雷边界条件的一维扩散算子的标准伽辽金有限元方法 (FEM) 半离散化开始。设 $N$ 为单元数量，节点为 $x_i = i h$（$i=0,\\dots,N$），均匀间距为 $h = 1/N$。在内部节点具有节点值的分片线性连续基函数通过以下方式定义了质量矩阵和刚度矩阵：\n$$\n(M_{\\text{ex}})_{ij} = \\int_0^1 \\varphi_i(x) \\varphi_j(x)\\,dx,\\qquad\nK_{ij} = \\int_0^1 \\varphi_i'(x) \\varphi_j'(x)\\,dx.\n$$\n在每个长度为 $h$ 的单元上，分片线性基函数的精确局部贡献为\n$$\nM_{\\text{loc,ex}} = \\frac{h}{6} \\begin{bmatrix}2  1 \\\\ 1  2 \\end{bmatrix}, \\qquad\nK_{\\text{loc}} = \\frac{1}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}.\n$$\n近似质量矩阵 $M_q$ 是通过使用每个单元 $q$ 个点的高斯-勒让德求积来计算质量的单元积分得到的。在局部坐标为 $\\xi \\in [0,1]$ 的单个单元上，基函数为 $\\varphi_1(\\xi)=1-\\xi$ 和 $\\varphi_2(\\xi)=\\xi$，雅可比行列式为 $h$，近似的局部质量矩阵项为\n$$\n(M_{\\text{loc},q})_{ab} \\approx h \\sum_{\\ell=1}^{q} w_\\ell\\, \\varphi_a(\\xi_\\ell)\\,\\varphi_b(\\xi_\\ell),\n$$\n其中 $(\\xi_\\ell,w_\\ell)$ 是从 $[-1,1]$ 映射到 $[0,1]$ 的高斯-勒让德求积点和权重。刚度矩阵是使用上面的 $K_{\\text{loc}}$ 精确组装的。通过限制到内部自由度来施加狄利克雷边界条件。\n\n对于时间离散化，考虑带有近似质量的半离散系统，\n$$\nM_q \\dot{u}(t) + K u(t) = 0.\n$$\n二阶向后差分格式 (BDF2) 是一种两步隐式线性多步法。从均匀网格上时间步长为 $\\Delta t$ 的标量函数 $y(t)$ 的定义出发，在时间 $t_{n+1}$ 处对导数的 BDF2 近似为\n$$\n\\dot{y}(t_{n+1}) \\approx \\frac{1}{\\Delta t}\\left( \\frac{3}{2} y^{n+1} - 2 y^{n} + \\frac{1}{2} y^{n-1} \\right).\n$$\n将此定义应用于带有 $M_q$ 和 $K$ 的向量系统，得到\n$$\nM_q \\frac{1}{\\Delta t}\\left( \\frac{3}{2} u^{n+1} - 2 u^{n} + \\frac{1}{2} u^{n-1} \\right) + K u^{n+1} = 0.\n$$\n整理各项，我们得到由前两个值确定新值 $u^{n+1}$ 的线性系统：\n$$\n\\left(\\frac{3}{2} M_q + \\Delta t\\, K\\right) u^{n+1} = 2 M_q u^{n} - \\frac{1}{2} M_q u^{n-1}.\n$$\n定义矩阵\n$$\nA := \\frac{3}{2} M_q + \\Delta t\\, K,\\qquad B := 2 M_q,\\qquad C := -\\frac{1}{2} M_q.\n$$\n则\n$$\nu^{n+1} = A^{-1} B\\, u^{n} + A^{-1} C\\, u^{n-1}.\n$$\n引入分块状态向量 $w^n = \\begin{bmatrix} u^n \\\\ u^{n-1} \\end{bmatrix}$，将 $w^n$ 映射到 $w^{n+1}$ 的单步放大算子 $T(\\Delta t)$ 为\n$$\nw^{n+1} =\n\\begin{bmatrix}\nA^{-1} B  A^{-1} C \\\\\nI  0\n\\end{bmatrix}\n\\begin{bmatrix}\nu^n \\\\ u^{n-1}\n\\end{bmatrix}\n=: T(\\Delta t)\\, w^n.\n$$\n在给定 $\\Delta t$ 下的绝对稳定性由谱半径 $\\rho(T(\\Delta t))$ 表征，它是 $T(\\Delta t)$ 特征值的最大模。对于齐次问题，迭代下幅值不增对应于 $\\rho(T(\\Delta t)) \\le 1$。\n\n为了量化 $M_q$ 中求积误差的影响，我们将相对于精确质量的矫顽性比定义为矩阵对 $(M_q, M_{\\text{ex}})$ 的最小广义特征值：\n$$\nc(q) := \\min_{v \\ne 0} \\frac{v^\\top M_q v}{v^\\top M_{\\text{ex}} v}.\n$$\n这是 $M_q v = \\lambda M_{\\text{ex}} v$ 广义谱中的最小值。它衡量了非精确求积质量对 $M_{\\text{ex}}$-范数的最坏情况下的低估程度。对于分片线性单元上的精确求积，$M_q = M_{\\text{ex}}$，因此 $c(q) = 1$。欠积分可能导致 $c(q)$ 显著低于 1，如果 $M_q$ 在某些方向上失去矫顽性，甚至可能导致 $c(q)=0$。\n\n算法步骤：\n- 在均匀网格的内部自由度上精确组装 $K$ 和 $M_{\\text{ex}}$。\n- 对于每个求积阶数 $q \\in \\{1,2,3\\}$，使用每个单元 $q$ 个点的高斯-勒让德求积组装 $M_q$。\n- 计算矫顽性比 $c(q)$，即 $(M_q, M_{\\text{ex}})$ 的最小广义特征值。\n- 对于每个 $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$，构建 $T(\\Delta t)$ 并计算其谱半径 $\\rho(T(\\Delta t))$。令 $\\rho_{\\max}(q)$ 为在给定的 $\\Delta t$ 值上 $\\rho(T(\\Delta t))$ 的最大值。\n- 以单行形式输出列表 $[c(1), \\rho_{\\max}(1), c(2), \\rho_{\\max}(2), c(3), \\rho_{\\max}(3)]$。\n\n基本原理：\n- 推导过程使用 $M$ 和 $K$ 的伽辽金定义以及 BDF2 的基本定义来构建时间步进算子。\n- $T(\\Delta t)$ 的谱半径量化了线性、自治齐次系统的绝对稳定性。\n- 定义 $c(q)$ 的广义特征值问题是求积引起的相对于精确内积的矫顽性损失的直接数学度量，这在基于能量的稳定性分析中至关重要。例如，当 $q=1$（每个单元一个高斯点）时，求积对于二次被积函数 $\\varphi_i \\varphi_j$ 并非精确，这可能导致 $M_q$ 成为半正定矩阵且 $c(1)=0$，而当 $q \\ge 2$ 时，对于分片线性基函数是精确的，并得出 $c(q)=1$。\n\n程序使用 $N=32$、$q \\in \\{1,2,3\\}$ 和 $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$ 实现这些步骤，并报告所要求的聚合结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef assemble_matrices(n_elements: int, q_points: int):\n    \"\"\"\n    Assemble stiffness K (exact), exact mass M_ex, and quadrature-based mass M_q\n    for 1D P1 FEM on [0,1] with homogeneous Dirichlet BCs.\n\n    Parameters:\n        n_elements: number of uniform elements (N)\n        q_points: number of Gauss-Legendre points per element for mass quadrature\n\n    Returns:\n        M_q: (n_dof x n_dof) mass matrix with q-point quadrature\n        K:   (n_dof x n_dof) exact stiffness matrix\n        M_ex:(n_dof x n_dof) exact mass matrix\n    \"\"\"\n    N = n_elements\n    h = 1.0 / N\n    n_dof = N - 1  # interior nodes\n\n    # Initialize matrices\n    M_q = np.zeros((n_dof, n_dof), dtype=float)\n    M_ex = np.zeros((n_dof, n_dof), dtype=float)\n    K = np.zeros((n_dof, n_dof), dtype=float)\n\n    # Exact local matrices (P1)\n    Mloc_ex = (h / 6.0) * np.array([[2.0, 1.0],\n                                    [1.0, 2.0]], dtype=float)\n    Kloc = (1.0 / h) * np.array([[1.0, -1.0],\n                                 [-1.0, 1.0]], dtype=float)\n\n    # Gauss-Legendre quadrature nodes/weights on [0,1]\n    # Map from [-1,1] nodes/weights\n    if q_points >= 1:\n        xi_gl, w_gl = np.polynomial.legendre.leggauss(q_points)\n        xi = 0.5 * (xi_gl + 1.0)  # to [0,1]\n        w = 0.5 * w_gl\n    else:\n        raise ValueError(\"q_points must be >= 1\")\n\n    # Shape functions on reference [0,1]\n    def phi1(xi_ref):\n        return 1.0 - xi_ref\n\n    def phi2(xi_ref):\n        return xi_ref\n\n    # Assemble over elements\n    for e in range(N):\n        # Global node indices\n        left = e\n        right = e + 1\n\n        # Local mass with quadrature\n        Mloc_q = np.zeros((2, 2), dtype=float)\n        for (xip, wp) in zip(xi, w):\n            vals = np.array([phi1(xip), phi2(xip)], dtype=float)\n            Mloc_q += h * wp * np.outer(vals, vals)\n\n        # Add to global matrices with Dirichlet BC handling (interior indices)\n        # Interior indices: i-1 for global node i in 1..N-1\n        li = left - 1\n        ri = right - 1\n\n        # Mass exact\n        if 0 = li  n_dof:\n            M_ex[li, li] += Mloc_ex[0, 0]\n        if 0 = ri  n_dof:\n            M_ex[ri, ri] += Mloc_ex[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            M_ex[li, ri] += Mloc_ex[0, 1]\n            M_ex[ri, li] += Mloc_ex[1, 0]\n\n        # Mass quadrature\n        if 0 = li  n_dof:\n            M_q[li, li] += Mloc_q[0, 0]\n        if 0 = ri  n_dof:\n            M_q[ri, ri] += Mloc_q[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            M_q[li, ri] += Mloc_q[0, 1]\n            M_q[ri, li] += Mloc_q[1, 0]\n\n        # Stiffness exact\n        if 0 = li  n_dof:\n            K[li, li] += Kloc[0, 0]\n        if 0 = ri  n_dof:\n            K[ri, ri] += Kloc[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            K[li, ri] += Kloc[0, 1]\n            K[ri, li] += Kloc[1, 0]\n\n    return M_q, K, M_ex\n\ndef bdf2_step_matrix(M: np.ndarray, K: np.ndarray, dt: float):\n    \"\"\"\n    Construct the BDF2 amplification matrix T(dt) for the homogeneous system\n    M u_dot + K u = 0, using mass matrix M and stiffness K.\n\n    T maps [u^n; u^{n-1}] to [u^{n+1}; u^n].\n\n    Returns:\n        T: (2n x 2n) amplification matrix\n    \"\"\"\n    n = M.shape[0]\n    A = 1.5 * M + dt * K\n    B = 2.0 * M\n    C = -0.5 * M\n\n    # Solve A X = B and A Y = C\n    X = linalg.solve(A, B, assume_a='sym')\n    Y = linalg.solve(A, C, assume_a='sym')\n\n    # Build block matrix\n    T = np.zeros((2 * n, 2 * n), dtype=float)\n    T[:n, :n] = X\n    T[:n, n:] = Y\n    T[n:, :n] = np.eye(n)\n    # T[n:, n:] already zeros\n    return T\n\ndef spectral_radius(mat: np.ndarray) - float:\n    vals = linalg.eig(mat, left=False, right=False)\n    return float(np.max(np.abs(vals)))\n\ndef coercivity_ratio(M_q: np.ndarray, M_ex: np.ndarray) - float:\n    \"\"\"\n    Compute the smallest generalized eigenvalue of (M_q, M_ex).\n    Since M_ex is SPD and M_q is symmetric (possibly semidefinite),\n    use symmetric generalized eigenvalue solver.\n    \"\"\"\n    # Ensure symmetry\n    Mq_sym = 0.5 * (M_q + M_q.T)\n    Mex_sym = 0.5 * (M_ex + M_ex.T)\n    # Generalized symmetric eigenproblem\n    # eigh returns real eigenvalues; handle potential tiny negative due to rounding.\n    vals = linalg.eigh(Mq_sym, Mex_sym, lower=True, eigvals_only=True)\n    # Clean up numerical noise\n    vals_real = np.real(vals)\n    # Minimal eigenvalue\n    lam_min = float(np.min(vals_real))\n    # Clamp tiny negatives to zero\n    if lam_min  0 and abs(lam_min)  1e-12:\n        lam_min = 0.0\n    return lam_min\n\ndef solve():\n    # Define the test cases from the problem statement.\n    N = 32\n    q_list = [1, 2, 3]\n    dt_list = [1e-3, 1e-1, 1.0, 10.0]\n\n    results = []\n    for q in q_list:\n        Mq, K, Mex = assemble_matrices(N, q_points=q)\n        # Coercivity degradation metric\n        c_q = coercivity_ratio(Mq, Mex)\n\n        # Stability metric: maximum spectral radius over dt_list\n        rho_max = 0.0\n        for dt in dt_list:\n            T = bdf2_step_matrix(Mq, K, dt)\n            rho = spectral_radius(T)\n            if rho  rho_max:\n                rho_max = rho\n\n        # Append results in order [c(q), rho_max(q)]\n        # Format to a reasonable number of decimals for stable output\n        results.append(f\"{c_q:.6f}\")\n        results.append(f\"{rho_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "稳定性分析通常关注数值误差在时间步之间的放大。然而，对于自适应方法，时间步长选择算法本身的稳定性也至关重要。本思想实验模拟了一个常见的陷阱：即使底层数值格式是无条件稳定的，一个激进且滞后的自适应步长控制器也可能引发步长序列的振荡。通过分析这种动态行为并设计一个稳定控制器，你将探索一个更高级的、系统层面的计算科学稳定性观点。",
            "id": "3447103",
            "problem": "考虑单位区间上具有齐次狄利克雷边界条件的一维热方程，\n$$\nu_{t}(x,t) - u_{xx}(x,t) = 0,\\quad x \\in (0,1),\\ t0,\\qquad u(0,t)=u(1,t)=0,\\qquad u(x,0)=u_{0}(x).\n$$\n在拟一致网格上使用连续分片线性元，通过有限元法（FEM）进行空间离散，得到半离散系统\n$$\nM \\dot{U}(t) + K U(t) = 0,\n$$\n其中 $M$ 是对称正定质量矩阵，$K$ 是对称正定刚度矩阵。使用后向欧拉法进行时间推进，\n$$\n\\left(M + k_{n} K\\right) U^{n} = M U^{n-1},\\qquad n\\ge 1,\n$$\n其中 $k_{n} = t_{n} - t_{n-1}$ 是时间步长。假设初始条件 $U^{0}$ 是某个 $\\lambda0$ 的广义特征问题 $K \\phi = \\lambda M \\phi$ 的一个特征向量，因此对所有 $n$ 都有 $U^{n} = a_{n} \\phi$。\n\n一位实践者采用自适应时间步进，使用一种残差型后验估计子，该估计子在第 $n$ 步开始时仅根据第 $n-1$ 步的数据计算。这引入了一步延迟，对于这种线性不变子空间情形，可以建模为\n$$\nr_{n} = C\\, k_{n-1}^{p},\n$$\n其中 $C0$ 取决于 $\\lambda$ 和与网格相关的范数，$p$ 是时间步进方法的局部相容阶。对于后向欧拉法，取 $p=1$。该实践者使用一个激进比例控制器，\n$$\nk_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{1/p},\n$$\n其中 $\\mathrm{tol}0$ 是一个固定的容差。\n\n1) 仅使用上述模型和解子空间的不变性，证明激进控制器与延迟估计子相结合会引起一个不衰减的振荡步长序列。你的推导必须从离散更新和特征模态不变性出发，通过变换到对数变量 $x_{n} = \\ln k_{n}$，得到关于误差 $e_{n} = x_{n} - s$ 的齐次线性递推关系，其中 $s = \\frac{1}{p}(\\ln \\mathrm{tol} - \\ln C)$。\n\n2) 为稳定步长动态，你提出了一个欠松弛幂控制器\n$$\nk_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{\\beta},\n$$\n其中松弛参数 $\\beta \\in (0,1)$ 待定。将由对数变量 $x_{n} = \\ln k_{n}$ 导出的递推关系在不动点 $x = s$ 附近进行线性化，并推导出误差 $e_{n} = x_{n} - s$ 的特征多项式。确定 $\\beta \\in (0,1)$ 的唯一值，该值能产生临界阻尼，即特征多项式有一个重实根，且误差无振荡地衰减到零。\n\n给出 $\\beta$ 的精确值作为最终答案，无单位。无需四舍五入。最终答案必须是单个数字。",
            "solution": "该问题分为两部分。第一部分要求证明用于自适应时间步进的激进比例控制器会导致步长序列产生不衰减的振荡。第二部分要求推导一个用于欠松弛控制器的稳定化参数 $\\beta$，以实现临界阻尼。分析将基于所提供的误差估计子和步长控制器的模型。\n\n**第1部分：激进控制器的分析**\n\n步长控制算法由两个方程定义：延迟后验估计子模型和激进比例控制器。\n第 $n$ 步的误差估计子是前一时间步长 $k_{n-1}$ 的函数：\n$$r_{n} = C k_{n-1}^{p}$$\n其中 $C > 0$ 是一个常数，$p$ 是时间步进方法的局部相容阶。对于后向欧拉法，给定 $p=1$。\n\n激进比例控制器根据当前时间步长 $k_n$ 和误差估计 $r_n$ 来更新下一个时间步长 $k_{n+1}$：\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{1/p}$$\n其中 $\\mathrm{tol} > 0$ 是一个指定的容差。\n\n首先，我们将这两个方程结合起来，以获得时间步长序列 $\\{k_n\\}$ 的一个递推关系。将 $r_n$ 的表达式代入控制器方程，得到：\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{C k_{n-1}^{p}}\\right)^{1/p} = k_{n} \\frac{(\\mathrm{tol})^{1/p}}{C^{1/p} (k_{n-1}^{p})^{1/p}} = k_{n} \\frac{(\\mathrm{tol}/C)^{1/p}}{k_{n-1}}$$\n对于后向欧拉法，我们有 $p=1$，这可将递推关系简化为：\n$$k_{n+1} = \\frac{(\\mathrm{tol}/C) k_{n}}{k_{n-1}}$$\n这是一个关于时间步长 $k_n$ 的二阶非线性递推关系。\n\n为了分析其动态特性，我们按照建议，使用对数变量将该递推关系转换为线性关系。令 $x_{n} = \\ln k_{n}$。对 $k_n$ 递推关系的两边取自然对数：\n$$\\ln k_{n+1} = \\ln\\left(\\frac{(\\mathrm{tol}/C) k_{n}}{k_{n-1}}\\right)$$\n$$x_{n+1} = \\ln(\\mathrm{tol}/C) + \\ln k_{n} - \\ln k_{n-1}$$\n$$x_{n+1} = \\ln(\\mathrm{tol}) - \\ln(C) + x_{n} - x_{n-1}$$\n这是一个关于 $x_n$ 的二阶线性非齐次递推关系。\n\n问题定义了误差变量 $e_{n} = x_{n} - s$，其中 $s$ 是对数不动点步长，由 $s = \\frac{1}{p}(\\ln\\mathrm{tol} - \\ln C)$ 给出。对于 $p=1$，这等于 $s = \\ln\\mathrm{tol} - \\ln C$。我们将 $x_{n} = e_{n} + s$ 代入 $x_n$ 的递推关系：\n$$(e_{n+1} + s) = (\\ln\\mathrm{tol} - \\ln C) + (e_{n} + s) - (e_{n-1} + s)$$\n使用 $s$ 的定义：\n$$e_{n+1} + s = s + e_{n} + s - e_{n-1} - s$$\n$$e_{n+1} = e_{n} - e_{n-1}$$\n这就得到了关于误差 $e_n$ 的齐次线性递推关系：\n$$e_{n+1} - e_{n} + e_{n-1} = 0$$\n为了确定误差的行为，我们分析与此递推关系相关的特征多项式的根：\n$$z^2 - z + 1 = 0$$\n使用二次公式求根：\n$$z = \\frac{-(-1) \\pm \\sqrt{(-1)^2 - 4(1)(1)}}{2(1)} = \\frac{1 \\pm \\sqrt{1 - 4}}{2} = \\frac{1 \\pm i\\sqrt{3}}{2}$$\n这两个根是一对共轭复数。它们的模为：\n$$|z| = \\sqrt{\\left(\\frac{1}{2}\\right)^2 + \\left(\\pm\\frac{\\sqrt{3}}{2}\\right)^2} = \\sqrt{\\frac{1}{4} + \\frac{3}{4}} = \\sqrt{1} = 1$$\n由于根位于复平面的单位圆上（$z = \\exp(\\pm i\\pi/3)$），误差 $e_n$ 的通解形式为 $e_{n} = A \\cos(n\\pi/3) + B \\sin(n\\pi/3)$，其中 $A$ 和 $B$ 是常数。此解是纯振荡的，并且当 $n \\to \\infty$ 时不衰减到零。因此，对数步长 $x_n$ 围绕稳态 $s$ 振荡而不收敛，步长 $k_n$ 围绕其稳态值 $k_{ss} = \\exp(s) = \\mathrm{tol}/C$ 振荡而不衰减。这证实了激进控制器的不稳定性。\n\n**第2部分：使用欠松弛控制器进行稳定化**\n\n为了稳定步长选择，引入了一个欠松弛幂控制器：\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{\\beta}$$\n其中 $\\beta \\in (0,1)$ 是一个松弛参数。估计子模型仍然是 $r_{n} = C k_{n-1}^{p}$。\n\n我们遵循类似的过程。首先，将估计子代入控制器：\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{C k_{n-1}^{p}}\\right)^{\\beta} = k_{n} (\\mathrm{tol}/C)^{\\beta} (k_{n-1}^{-p})^{\\beta} = k_n (\\mathrm{tol}/C)^{\\beta} k_{n-1}^{-p\\beta}$$\n接下来，我们变换到对数变量 $x_n = \\ln k_n$：\n$$\\ln k_{n+1} = \\ln k_{n} + \\beta \\ln(\\mathrm{tol}/C) - p\\beta \\ln k_{n-1}$$\n$$x_{n+1} = x_{n} - p\\beta x_{n-1} + \\beta(\\ln\\mathrm{tol} - \\ln C)$$\n这是一个关于 $x_n$ 的线性（或更准确地说是仿射）递推关系。问题要求在不动点 $s = \\frac{1}{p}(\\ln\\mathrm{tol} - \\ln C)$ 附近对其进行线性化。由于该关系已经是仿射的，线性化是精确的，并且对应于分析误差 $e_n = x_n - s$ 的动态特性。\n将 $x_n = e_n+s$ 代入递推关系：\n$$e_{n+1} + s = (e_n+s) - p\\beta(e_{n-1}+s) + \\beta(\\ln\\mathrm{tol} - \\ln C)$$\n$$e_{n+1} = e_n - p\\beta e_{n-1} - p\\beta s + \\beta(\\ln\\mathrm{tol} - \\ln C)$$\n根据不动点 $s$ 的定义，我们有 $p s = \\ln\\mathrm{tol} - \\ln C$。将此代入方程：\n$$e_{n+1} = e_n - p\\beta e_{n-1} - \\beta(p s) + \\beta(p s)$$\n$$e_{n+1} = e_n - p\\beta e_{n-1}$$\n这就得到了关于误差的齐次线性递推关系：\n$$e_{n+1} - e_{n} + p\\beta e_{n-1} = 0$$\n相应的特征多项式为：\n$$z^2 - z + p\\beta = 0$$\n临界阻尼要求特征多项式有一个重实根。这发生在二次方程的判别式为零时。\n$$(\\text{判别式}) = (-1)^2 - 4(1)(p\\beta) = 0$$\n$$1 - 4p\\beta = 0$$\n解出 $\\beta$，我们得到：\n$$\\beta = \\frac{1}{4p}$$\n问题指明时间步进方法是后向欧拉法，其相容阶为 $p=1$。将 $p=1$ 代入我们的 $\\beta$ 表达式：\n$$\\beta = \\frac{1}{4(1)} = \\frac{1}{4}$$\n这个 $\\beta = 1/4$ 的值位于指定的区间 $(0,1)$ 内。对于这个值，特征多项式变为 $z^2 - z + 1/4 = (z - 1/2)^2 = 0$，它在 $z=1/2$ 处有一个重实根。因为根满足 $|z|1$，误差 $e_n$ 将无振荡地衰减到零，从而确保步长选择序列的稳定性。",
            "answer": "$$\\boxed{\\frac{1}{4}}$$"
        }
    ]
}