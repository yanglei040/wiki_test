## 引言
在[偏微分方程](@entry_id:141332)的数值求解中，尤其是在有限元方法（FEM）中，一个核心的计算挑战是在任意形状的网格单元上进行积分。直接处理这些不同形状和大小的物理单元会导致计算流程复杂且效率低下。为了克服这一障碍，一种强大而通用的策略应运而生：将积分计算从物理域转移到统一的、几何形状简单的[参考单元](@entry_id:168425)上。这种方法不仅[标准化](@entry_id:637219)了计算过程，还极大地提高了实现效率和代码的可重用性。

本文旨在系统性地介绍[参考单元](@entry_id:168425)上[数值积分](@entry_id:136578)的完整框架。我们将深入探讨实现这一转换所涉及的关键原理，并展示其在众多科学与工程领域中的广泛应用。读者将通过本文学习到：

- 在 **原理与机制** 章节，我们将奠定理论基础，详细解释从物理单元到参考单元的[坐标映射](@entry_id:747874)、[雅可比](@entry_id:264467)变换的角色，以及如何选择和应用[高斯求积](@entry_id:146011)等数值方法来高效地近似积分。
- 在 **应用与跨学科连接** 章节，我们将展示这些原理如何应用于有限元方法的核心任务——组装单元矩阵，如何通过[等参映射](@entry_id:173239)处理复杂弯曲几何，并探讨其在[结构力学](@entry_id:276699)、电磁学和[流体力学](@entry_id:136788)等领域的深刻联系。
- 最后，在 **动手实践** 章节，我们将通过一系列精心设计的练习，将理论知识转化为实践技能，帮助读者巩固对求积法则构建、单元矩阵计算和误差来源的理解。

通过这三个层层递进的章节，本文将引导您全面掌握参考单元[数值积分](@entry_id:136578)这一基本而强大的计算工具。

## 原理与机制

在有限元方法中，[求解偏微分方程](@entry_id:138485)的数值解通常涉及在离散的网格上计算积分。为了简化和规范化这一过程，通常的做法是将计算从物理域中的任意形状的单元（物理单元）转移到一个固定的、简单的标准几何体（参考单元）上。本章将详细阐述实现这一转换所涉及的核心原理与机制，重点讨论积分、函数及其导数如何在该转换下变化，以及如何在参考单元上高效地执行[数值积分](@entry_id:136578)（即求积）。

### [参考单元](@entry_id:168425)与[多项式空间](@entry_id:144410)

在有限元方法中，我们主要使用两类参考单元：单纯形和超立方体。它们的选择通常取决于网格剖分的类型。

#### 参考单纯形

在 $d$ 维空间中，一个 **$d$-单纯形** 是 $d+1$ 个[仿射无关](@entry_id:262726)顶点的凸包。在二维空间中，参考单纯形通常是 **参考三角形** $\hat{K}$，其标准定义为：
$$
\hat{K} = \{(\xi, \eta) \in \mathbb{R}^2 : \xi \ge 0, \eta \ge 0, \xi + \eta \le 1\}
$$
这个三角形的顶点是 $(0,0)$, $(1,0)$ 和 $(0,1)$。在参考单纯形上，使用 **[重心坐标](@entry_id:155488)**（barycentric coordinates）$\{\lambda_i\}_{i=1}^{d+1}$ 通常会非常方便。对于二维参考三角形，任何点 $(\xi, \eta) \in \hat{K}$ 都可以用三个非负的[重心坐标](@entry_id:155488) $(\lambda_1, \lambda_2, \lambda_3)$ 表示，它们满足 $\lambda_1 + \lambda_2 + \lambda_3 = 1$。这些坐标代表了该点相对于三个顶点的“权重”，并且在从[参考单元](@entry_id:168425)到物理单元的[仿射变换](@entry_id:144885)下保持不变。

#### 参考[超立方体](@entry_id:273913)

**$d$-维参考[超立方体](@entry_id:273913)** 通常定义为 $[-1, 1]^d$。在二维情况下，我们得到的是 **参考正方形** $\hat{Q}$：
$$
\hat{Q} = [-1, 1]^2 = \{(\xi, \eta) \in \mathbb{R}^2 : -1 \le \xi \le 1, -1 \le \eta \le 1\}
$$
在[超立方体](@entry_id:273913)上，我们自然地使用标准的[笛卡尔坐标](@entry_id:167698) $(\xi_1, \dots, \xi_d)$，这些坐标也称为 **张量积坐标**（tensor-product coordinates）。

#### 参考单元上的[多项式空间](@entry_id:144410)

与这两类[参考单元](@entry_id:168425)相对应，我们定义了两种主要的[多项式空间](@entry_id:144410)。

在参考单纯形 $\hat{K}$ 上，我们通常使用 **总次数多项式空间** $\mathbb{P}_k(\hat{K})$。这个空间包含所有在 $d$ 个坐标变量中总次数不超过 $k$ 的多项式。例如，在二维参考三角形上，一个多项式 $p(\xi, \eta) = \sum_{i,j} c_{ij} \xi^i \eta^j$ 属于 $\mathbb{P}_k(\hat{K})$ 当且仅当对于所有非零系数 $c_{ij}$ 都有 $i+j \le k$。该空间的维度由组合公式给出：
$$
\dim \mathbb{P}_k(\hat{K}) = \binom{d+k}{d}
$$
对于二维情况 ($d=2$)，维度为 $\frac{(k+1)(k+2)}{2}$ 。

在参考超立方体 $\hat{Q}$ 上，我们使用 **[张量积](@entry_id:140694)多项式空间** $\mathbb{Q}_k(\hat{Q})$。这个空间由一维多项式空间张量积而成，包含所有在每个坐标变量中的次数都不超过 $k$ 的多项式。例如，在二维参考正方形上，$p(\xi, \eta)$ 属于 $\mathbb{Q}_k(\hat{Q})$ 当且仅当它可以被写作 $p(\xi, \eta) = \sum_{i=0}^{k} \sum_{j=0}^{k} a_{ij} \xi^i \eta^j$。该空间的维度是：
$$
\dim \mathbb{Q}_k(\hat{Q}) = (k+1)^d
$$
对于二维情况 ($d=2$)，维度为 $(k+1)^2$ 。值得注意的是，当维度 $d>1$ 且 $k \ge 1$ 时，$\mathbb{P}_k(\hat{Q})$ 是 $\mathbb{Q}_k(\hat{Q})$ 的一个[真子集](@entry_id:152276)。例如，$\xi^k \eta^k$ 属于 $\mathbb{Q}_k(\hat{Q})$，但其总次数为 $2k$，因此不属于 $\mathbb{P}_k(\hat{Q})$（除非 $k=0$）。

### 积分的变量代换

为了在参考单元上进行计算，我们需要一个可靠的方法来转换积分。这通过多元微积分中的 **变量代换公式** 来实现。给定一个可逆的、足够光滑的映射 $F: \hat{K} \to K$，它将[参考单元](@entry_id:168425) $\hat{K}$ 上的点 $\hat{x}$ 映射到物理单元 $K$ 上的点 $x$。

该映射的 **雅可比矩阵**（Jacobian matrix）$J_F(\hat{x})$ 定义为 $F$ 的所有一阶偏导数组成的矩阵，其第 $(i, j)$ 个元素是 $\frac{\partial F_i}{\partial \hat{x}_j}$。该矩阵描述了映射 $F$ 如何在局部拉伸和旋转空间。其[行列式](@entry_id:142978)，即 **[雅可比行列式](@entry_id:137120)**（Jacobian determinant）$\det J_F(\hat{x})$，则描述了局部体积的变化率。

对于一个在 $K$ 上可积的函数 $f(x)$，变量代换公式为：
$$
\int_K f(x) \, dx = \int_{\hat{K}} f(F(\hat{x})) \, |\det J_F(\hat{x})| \, d\hat{x}
$$
这里的[绝对值](@entry_id:147688)至关重要。$dx$ 和 $d\hat{x}$ 代表无穷小的[体积元](@entry_id:267802)，它们本质上是非负的。$|\det J_F(\hat{x})|$ 描述了从 $\hat{K}$ 到 $K$ 的局部[体积缩放因子](@entry_id:158899)，它也必须是非负的。如果省略[绝对值](@entry_id:147688)而 $\det J_F(\hat{x})$ 为负，将导致一个正的积分（例如，一个区域的面积）等于一个负值，这是荒谬的 。

为了保证这种变换是良定义的，并且能够保持[函数空间](@entry_id:143478)的[范数等价](@entry_id:137561)（这对于保证[数值方法的稳定性](@entry_id:165924)至关重要），映射 $F$ 必须满足一定的 **正则性假设**。一个足够强的条件是 $F$ 是一个 $C^1$ 微分同胚，即 $F$ 和它的逆 $F^{-1}$ 都是连续可微的。更弱但同样充分的条件是 $F$ 是 **双-Lipschitz**（bi-Lipschitz）的，这意味着 $F$ 和 $F^{-1}$ 都是[Lipschitz连续的](@entry_id:267396)。这些条件确保了[雅可比矩阵](@entry_id:264467)及其[逆矩阵](@entry_id:140380)的范数，以及雅可比行列式本身，在整个单元上有界且远离零 [@problem_id:3425900, @problem_id:3425935]。

### [仿射映射](@entry_id:746332)及其性质

在许多情况下，特别是当物理单元是直线边界的多边形（或多面体）时，我们可以使用最简单的映射类型：**[仿射映射](@entry_id:746332)**（affine mapping）。一个[仿射映射](@entry_id:746332)具有以下形式：
$$
F(\hat{x}) = B\hat{x} + b
$$
其中 $B$ 是一个 $d \times d$ 的常数矩阵，$b$ 是一个常数向量。

[仿射映射](@entry_id:746332)的一个关键特性是它的[雅可比矩阵](@entry_id:264467)是常数：$J_F(\hat{x}) = B$。这极大地简化了所有计算。

要成为一个有效的单元映射， $F$ 必须是可逆的，这意味着矩阵 $B$ 必须是可逆的，即 $\det B \neq 0$。此外，在有限元实践中，我们通常要求映射是 **保向的**（orientation-preserving），这意味着 $\det B > 0$。这个条件保证了单元顶点的顺序（例如，逆时针）在映射后得以保持，这对于一致地定义外[法向量](@entry_id:264185)等至关重要 。

#### [仿射映射](@entry_id:746332)下的变换

对于保向的[仿射映射](@entry_id:746332)，变量代换公式和导数变换公式变得非常简洁。

**[积分变换](@entry_id:186209)**：由于 $\det J_F = \det B$ 是一个正常数，积分公式简化为：
$$
\int_K f(x) \, dx = (\det B) \int_{\hat{K}} f(B\hat{x} + b) \, d\hat{x}
$$

**梯度变换**：令 $\hat{u}(\hat{x}) = u(F(\hat{x}))$ 是函数 $u(x)$ 的 **回拉**（pullback）。根据[链式法则](@entry_id:190743)，物理坐标下的梯度 $\nabla_x u$ 和参考坐标下的梯度 $\nabla_{\hat{x}} \hat{u}$ 之间的关系是：
$$
\nabla_x u(x) = B^{-T} \nabla_{\hat{x}} \hat{u}(\hat{x})
$$
其中 $B^{-T}$ 表示矩阵 $B$ 的逆的[转置](@entry_id:142115)。这个公式是计算刚度矩阵等涉及导数的项的基础 [@problem_id:3425877, @problem_id:3425917]。

[仿射映射](@entry_id:746332)的几何局限性也值得注意。一个[仿射映射](@entry_id:746332)可以将一个参考三角形映射到任何非退化的物理三角形。然而，它只能将参考正方形映射到一个 **平行四边形**，因为[仿射变换](@entry_id:144885)保持对角线中点重合的性质。要将参考正方形映射到一般的（非平行四边形）四边形，需要更复杂的非[仿射映射](@entry_id:746332) 。

### [参考单元](@entry_id:168425)上的[数值求积](@entry_id:136578)

除了极少数情况，变换后的积分 $\int_{\hat{K}} g(\hat{x}) d\hat{x}$ 通常无法解析计算，因此我们采用 **[数值求积](@entry_id:136578)**（numerical quadrature）进行近似。一个求积法则用节点 $\hat{x}_i$ 上的函数值的加权和来近似积分：
$$
\int_{\hat{K}} g(\hat{x}) \, d\hat{x} \approx \sum_{i=1}^N \hat{w}_i g(\hat{x}_i)
$$
其中 $\hat{w}_i$ 是[求积权重](@entry_id:753910)。[求积法则](@entry_id:753909)的一个关键特性是其 **[精确度](@entry_id:143382)**（degree of exactness），定义为该法则能够精确积分的最高次多项式的次数。

#### 一维高斯求积

大多数高维[求积法则](@entry_id:753909)都源于一维的情况。在参考区间 $[-1, 1]$ 上，**[高斯-勒让德求积](@entry_id:138201)**（Gauss-Legendre quadrature）是一种特别强大和高效的方法。一个 $n$ 点的[高斯-勒让德求积](@entry_id:138201)法则具有以下特性：
- **节点** $\{\xi_i\}_{i=1}^n$ 是 $n$ 次勒让德多项式 $P_n(\xi)$ 的 $n$ 个根。
- **精确度**：该法则的精确度为 $2n-1$。这意味着它能精确地积分所有次数不超过 $2n-1$ 的一维多项式。对于给定的 $n$ 个节点，这是可能达到的最高[精确度](@entry_id:143382) 。

#### 参考正方形上的求积

对于参考正方形 $\hat{Q} = [-1,1]^2$，我们可以通过 **张量积**（tensor product）的方式，从一维[高斯-勒让德求积](@entry_id:138201)法则构造二维[求积法则](@entry_id:753909)。如果一维 $n$ 点法则的节点为 $\{\xi_i\}$，权重为 $\{w_i\}$，则二维法则由以下部分构成：
- **节点**：$n^2$ 个点，是所有可能的点对 $(\xi_i, \xi_j)$，$i,j=1,\dots,n$。
- **权重**：与节点 $(\xi_i, \xi_j)$ 对应的权重是 $w_i w_j$。

通过将双重积分写成[累次积分](@entry_id:144407)并对每一维应用一维法则，我们可以推断出该[张量积法则](@entry_id:177156)的[精确度](@entry_id:143382)。如果一维法则对于次数高达 $2n-1$ 的多项式是精确的，那么二维[张量积法则](@entry_id:177156)对于张量积多项式空间 $\mathbb{Q}_{2n-1}(\hat{Q})$ 中的所有多项式都是精确的 。

#### 参考三角形上的求积

对于参考三角形 $\hat{K}$，情况更为复杂，因为无法直接使用[张量积](@entry_id:140694)构造。一个[求积法则](@entry_id:753909)要达到 $m$ 次的精确度，必须对[多项式空间](@entry_id:144410) $\mathbb{P}_m(\hat{K})$ 的所有[基函数](@entry_id:170178)都成立。这等价于满足一系列的 **[矩条件](@entry_id:136365)**（moment conditions）：
$$
\sum_{i=1}^N w_i \xi_i^a \eta_i^b = \int_{\hat{K}} \xi^a \eta^b \, d\hat{x} \quad \text{对于所有满足 } a+b \le m \text{ 的非负整数 } a, b
$$
右侧的精确矩可以通过解析积分计算得出，其通用公式为：
$$
\int_{\hat{K}} \xi^a \eta^b \, d\hat{x} = \frac{a! b!}{(a+b+2)!}
$$
例如，三角形的面积是 $a=0, b=0$ 的情况，积分为 $\frac{1}{2}$。寻找在给定精确度下使用最少求积点数的优化法则是数值分析中的一个专门领域 。

### 组装单元矩阵：应用实例

现在，我们将上述概念结合起来，分析在有限元实践中如何计算两个核心的单元矩阵：质量矩阵和刚度矩阵。我们假设使用基于[仿射映射](@entry_id:746332)的 $P_p$ 拉格朗日单元（即在[参考单元](@entry_id:168425)上使用 $\mathbb{P}_p$ 多项式）。

#### 质量矩阵

局部质量矩阵的元素定义为 $M_{ij} = \int_K \phi_i \phi_j \, dx$，其中 $\phi_i$ 和 $\phi_j$ 是物理单元上的[基函数](@entry_id:170178)。
1.  **变换到参考单元**：使用[仿射映射](@entry_id:746332)的[积分变换](@entry_id:186209)公式，我们得到：
    $$
    M_{ij} = (\det B) \int_{\hat{K}} \hat{\phi}_i(\hat{x}) \hat{\phi}_j(\hat{x}) \, d\hat{x}
    $$
2.  **分析被积函数**：参考[基函数](@entry_id:170178) $\hat{\phi}_i$ 和 $\hat{\phi}_j$ 都是 $\mathbb{P}_p$ 空间中的多项式（总次数 $\le p$）。它们的乘积 $\hat{\phi}_i \hat{\phi}_j$ 是一个总次数最高可达 $p+p=2p$ 的多项式，即属于 $\mathbb{P}_{2p}$。常数因子 $\det B$ 不改变多项式的次数。
3.  **求积要求**：因此，为了精确计算质量矩阵，我们必须使用一个在 $\hat{K}$ 上[精确度](@entry_id:143382)至少为 $2p$ 的[求积法则](@entry_id:753909) 。

#### [刚度矩阵](@entry_id:178659)

局部刚度矩阵的元素通常涉及梯度的[点积](@entry_id:149019)，例如 $A_{ij} = \int_K \nabla\phi_i \cdot \nabla\phi_j \, dx$。
1.  **变换到[参考单元](@entry_id:168425)**：同时使用梯度变换和[积分变换](@entry_id:186209)公式：
    $$
    A_{ij} = (\det B) \int_{\hat{K}} (B^{-T} \nabla_{\hat{x}}\hat{\phi}_i) \cdot (B^{-T} \nabla_{\hat{x}}\hat{\phi}_j) \, d\hat{x}
    $$
2.  **分析被积函数**：$\hat{\phi}_i$ 和 $\hat{\phi}_j$ 属于 $\mathbb{P}_p$。它们的梯度 $\nabla_{\hat{x}}\hat{\phi}_i$ 和 $\nabla_{\hat{x}}\hat{\phi}_j$ 的分量是总次数最高为 $p-1$ 的多项式。[点积](@entry_id:149019)是这些梯度分量的二次型，因此被积函数是总次数最高为 $(p-1)+(p-1) = 2p-2$ 的多项式。矩阵 $B$ 的相关项是常数，不影响多项式次数。
3.  **求积要求**：因此，精确计算[刚度矩阵](@entry_id:178659)需要一个在 $\hat{K}$ 上精确度至少为 $2p-2$ 的求积法则 。

当使用[仿射映射](@entry_id:746332)时，一个在参考单元上对次数为 $p$ 的多项式精确的[求积法则](@entry_id:753909)，在物理单元上同样对次数为 $p$ 的多项式精确，因为[雅可比行列式](@entry_id:137120)是常数 。

### 用于弯曲单元的[等参映射](@entry_id:173239)

[仿射映射](@entry_id:746332)只能生成直边单元，这限制了它们准确拟合复杂几何或弯曲边界的能力。为了克服这一点，我们引入了 **[等参映射](@entry_id:173239)**（isoparametric mapping）的概念。

其核心思想是 **用相同的[基函数](@entry_id:170178)来描述几何和描述场变量**。具体来说，物理单元上任一点的位置 $x$ 由参考单元上的坐标 $\hat{x}$ 通过以下方式确定：
$$
x = F(\hat{x}) = \sum_{a=1}^{n_{\text{node}}} X_a \hat{N}_a(\hat{x})
$$
其中 $\{X_a\}$ 是物理单元的节点坐标（例如，顶点和边上的控制点），$\{\hat{N}_a\}$ 是用于定义解空间的[拉格朗日基](@entry_id:751105)函数 。

如果[基函数](@entry_id:170178) $\hat{N}_a$ 是[非线性](@entry_id:637147)的（例如，$\mathbb{P}_2$ 或 $\mathbb{Q}_1$），那么映射 $F$ 本身也是[非线性](@entry_id:637147)的，并且能够产生弯曲的单元。这种方法的代价是[雅可比矩阵](@entry_id:264467) $J_F(\hat{x})$ 不再是常数，而是在单元上变化的函数，这使得积分计算变得更加复杂。

例如：
- 对于一个二维 $\mathbb{Q}_1$（双线性）[四边形单元](@entry_id:176937)，[雅可比行列式](@entry_id:137120) $\det J_F(\hat{\xi}, \hat{\eta})$ 是 $\hat{\xi}$ 和 $\hat{\eta}$ 的一个[仿射函数](@entry_id:635019)。仅当物理单元是平行四边形时，它才退化为常数 。
- 对于一个 $d$ 维单纯形上的 $\mathbb{P}_p$ [等参映射](@entry_id:173239)，$\det J_F(\hat{x})$ 是一个总次数最高为 $d(p-1)$ 的多项式 。

当雅可比行列式不再是常数时，被积函数 $f(F(\hat{x})) \det J_F(\hat{x})$ 的多项式次数会显著增加。例如，如果要在一个由 $\mathbb{P}_p$ [等参映射](@entry_id:173239)定义的 $d$ 维弯曲单元上积分一个物理空间中的 $r$ 次多项式，那么在[参考单元](@entry_id:168425)上的被积函数次数最高可达 $rp + d(p-1)$。这要求使用比仿射单元更高阶的求积法则来保证积分的准确性 。