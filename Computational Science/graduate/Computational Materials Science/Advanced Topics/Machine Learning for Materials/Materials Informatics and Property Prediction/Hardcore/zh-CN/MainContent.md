## 引言
[材料信息学](@entry_id:197429)（Materials Informatics）正作为一种由数据驱动的新[范式](@entry_id:161181)，深刻地变革着[材料科学](@entry_id:152226)与工程的研究方式。传统的材料研发依赖于耗时且昂贵的试错法实验，而[材料信息学](@entry_id:197429)通过整合大数据、机器学习和物理模型，旨在从根本上加速新材料的发现、设计与优化过程。然而，从海量的、异构的材料数据到构建出具有可靠预测能力和物理洞察力的模型，存在着巨大的知识鸿沟。如何将原子的三维[排列](@entry_id:136432)转化为机器可读的语言？如何确保模型学到的是真实的物理规律而非数据中的巧合？如何利用模型智能地指导未来的实验方向？

本文旨在系统性地解答这些问题，为读者提供一幅关于[材料性能](@entry_id:146723)预测的完整蓝图。在接下来的章节中，您将学习到：

*   在 **“原理与机制”** 章节中，我们将奠定理论基石，深入探讨如何用数学语言描述材料，如何构建尊重物理对称性的[机器学习模型](@entry_id:262335)，以及如何通过严格的流程确保模型的稳健性与可靠性，避免常见的数据陷阱。
*   在 **“应用与[交叉](@entry_id:147634)学科联系”** 章节中，我们将把理论付诸实践，展示这些原理如何应用于[高通量筛选](@entry_id:271166)、[多保真度建模](@entry_id:752274)、[可解释性](@entry_id:637759)分析以及实现自主发现的闭环系统，并揭示其与物理、化学、计算机科学等领域的深刻联系。
*   最后，在 **“动手实践”** 章节中，您将有机会通过具体的编程练习，亲手实现构建[凸包](@entry_id:262864)、应用[多保真度学习](@entry_id:752239)和设计[贝叶斯优化](@entry_id:175791)策略等核心任务，将理论知识转化为实践技能。

通过这趟由浅入深的旅程，本文将为您装备必要的知识与工具，以应对数据驱动时代下材料研发的挑战与机遇。

## 原理与机制

在“引言”章节中，我们概述了[材料信息学](@entry_id:197429)作为一个新兴[交叉](@entry_id:147634)领域的巨大潜力。本章将深入探讨其核心的科学原理与技术机制，为后续章节的应用和高级主题奠定坚实的基础。我们将从材料的数字化表示开始，逐步深入到性能预测模型，最终讨论如何构建和验证稳健、可靠的机器学习系统。

### 材料的机器学习表示

[机器学习模型](@entry_id:262335)无法直接处理原子、键和[晶格](@entry_id:196752)。首要任务是将材料的物理和化学信息转化为模型能够理解的数学对象——[特征向量](@entry_id:151813)或图。表示方法的选择深刻地影响着模型的性能、泛化能力及其物理意义的解释性。

#### 基于化学组分的表示方法

最简洁的材料表示是其化学组分。对于一个由 $n$ 种元素构成的材料，其组分可以表示为一个多元组 $c = \{(Z_i, x_i)\}_{i=1}^n$，其中 $Z_i$ 是第 $i$ 种化学元素，$x_i$ 是其原子分数，且 $\sum_{i=1}^n x_i = 1$。为了将这些信息转化为固定长度的[特征向量](@entry_id:151813)，一种常用策略是计算元素固有属性（如原子半径、[电负性](@entry_id:147633)、价电子数等）的统计量。例如，对于任意一种元素属性函数 $p(Z)$，我们可以计算其加权平均值、加权[方差](@entry_id:200758)等统计量 ：

- **加权平均值**: $\mu_p(c) = \sum_{i=1}^n x_i p(Z_i)$
- **加权[方差](@entry_id:200758)**: $\sigma_p^2(c) = \sum_{i=1}^n x_i (p(Z_i) - \mu_p(c))^2$

这类描述符，通常被称为 Magpie 特征，其关键优势在于它们的 **[置换不变性](@entry_id:753356)（permutation invariance）**。由于化学组分是一个元素的集合，其表示不应依赖于元素的列举顺序。求和、求平均、取最大/最小值等操作天然满足这种对称性要求。

然而，仅依赖组分的表示方法存在一个根本性局限：它们无法区分具有相同化学组分但原子[排列](@entry_id:136432)方式不同的 **多晶型物（polymorphs）** 。例如，石英（quartz）和方石英（cristobalite）都是 $\mathrm{SiO_2}$，但它们的[原子结构](@entry_id:137190)和物理性质（如体弹模量）差异巨大。一个只接收组分信息的模型，对于输入 $c = \{\text{Si}: 1/3, \text{O}: 2/3\}$，必然只能输出一个单一的预测值。从[统计学习](@entry_id:269475)的角度看，如果真实属性 $y$ 同时依赖于组分 $c$ 和结构 $S$，那么在平方损失下，最优的纯组分模型 $f^*(c)$ 只能预测该组分下所有可能结构的属性平均值，即 $f^*(c) = \mathbb{E}[y \mid c]$。由于模型无法获取结构信息 $S$，其预测必然存在一个不可约减的误差，其大小为[条件方差](@entry_id:183803) $\mathrm{Var}(y \mid c)$ 。这揭示了引入原子结构信息的必要性。

#### 基于[原子结构](@entry_id:137190)的表示方法

为了区分多晶型物并更精确地预测性质，我们必须将三维原子结构编码到模型中。这需要我们处理更复杂的对称性要求。

##### 物理对称性的核心作用：[不变性](@entry_id:140168)与[等变性](@entry_id:636671)

一个孤立的原子体系，其物理性质（如总能量）不应随[坐标系](@entry_id:156346)的选择而改变。这意味着模型必须尊重底层的物理对称性。我们主要关注三种对称性：平移、旋转和[置换](@entry_id:136432) 。

- **平移（Translation）**: 将体系中所有原子的坐标 $\mathbf{r}_i$ 加上一个恒定的平移向量 $\mathbf{t}$，体系的能量和[原子间作用力](@entry_id:158182)不应改变。
- **旋转（Rotation）**: 将体系中所有原子的坐标 $\mathbf{r}_i$ 绕原点进行一次旋转（由一个[正交矩阵](@entry_id:169220) $\mathbf{R}$ 描述），体系的能量不应改变。
- **[置换](@entry_id:136432)（Permutation）**: 对体系中的同种原子进行重新编号，不应改变任何[物理可观测量](@entry_id:154692)。

这些对称性要求可以通过 **不变性（invariance）** 和 **[等变性](@entry_id:636671)（equivariance）** 的数学语言来精确描述。一个函数 $f(x)$ 对某个变换 $g$ 是不变的，如果 $f(g \cdot x) = f(x)$；它是等变的，如果 $f(g \cdot x) = \rho(g) f(x)$，其中 $\rho(g)$ 是该变换在输出空间的一种表示。

对于一个原子体系 $\mathbf{X} = \{(\mathbf{r}_i, Z_i)\}_{i=1}^N$，其总能量 $E(\mathbf{X})$ 是一个标量，它必须对整个欧几里得群 $E(3)$（包含平移和旋转）以及原子置换群 $S_N$ 保持 **不变**。而作用在原子 $i$ 上的力 $\mathbf{F}_i(\mathbf{X}) = -\nabla_{\mathbf{r}_i} E(\mathbf{X})$ 是一个三维矢量。当整个体系被旋转矩阵 $\mathbf{R}$ 旋转时，力矢量也必须以同样的方式旋转，即 $\mathbf{F}_i(g \cdot \mathbf{X}) = \mathbf{R} \mathbf{F}_i(\mathbf{X})$。这被称为 $E(3)$ **[等变性](@entry_id:636671)**。同样，当原子被[置换](@entry_id:136432)时，相应的力矢量列表也随之[置换](@entry_id:136432)，这体现了[置换](@entry_id:136432)[等变性](@entry_id:636671) 。任何一个严谨的原子结构模型都必须内在地满足或通过设计来满足这些[不变性](@entry_id:140168)和[等变性](@entry_id:636671)要求。

##### 局部[原子环境描述符](@entry_id:748321)：SOAP

一种满足上述对称性要求的强大方法是构建局部原子环境的描述符。**原子位置光滑重叠（Smooth Overlap of Atomic Positions, SOAP）** 描述符是一个典型的例子 。其核心思想如下：

1.  以某个中心原子为原点，将其邻近原子（在一个[截断半径](@entry_id:136708) $r_c$ 内）的位置表示为一个三维的、平滑的原子密度函数 $\rho_{\mathbf{x}}(\mathbf{r})$。这通常通过在每个邻居原子位置上放置一个[高斯函数](@entry_id:261394)并求和来实现。

2.  将这个密度函数 $\rho_{\mathbf{x}}(\mathbf{r})$ 在一个[正交函数](@entry_id:160936)基上展开。这个基由径向函数 $\{g_n(r)\}$ 和球谐函数 $\{Y_{lm}(\hat{\mathbf{r}})\}$ 的乘积构成：
    $$ \rho_{\mathbf{x}}(\mathbf{r}) = \sum_{n,l,m} c_{nlm}(\mathbf{x}) g_n(r) Y_{lm}(\hat{\mathbf{r}}) $$
    其中，$c_{nlm}(\mathbf{x})$ 是展开系数。

3.  在旋转操作下，展开系数 $c_{nlm}$ 会以一种明确的方式（通过维格纳D矩阵）进行变换，但这种变换是复杂的。为了获得[旋转不变性](@entry_id:137644)，我们可以构建这些系数的二次[不变量](@entry_id:148850)，即 **SOAP 功率谱（power spectrum）**：
    $$ p_{nn'l}(\mathbf{x}) = \sum_{m=-l}^{l} c_{nlm}(\mathbf{x}) c_{n'lm}^*(\mathbf{x}) $$
    这些[功率谱](@entry_id:159996)分量 $p_{nn'l}(\mathbf{x})$ 构成了一个对旋转不变的[特征向量](@entry_id:151813)，它捕捉了原子邻域环境的径向和角向信息。

4.  基于这些[功率谱](@entry_id:159996)向量，我们可以定义两个原子环境 $\mathbf{x}$ 和 $\mathbf{x}'$ 之间的相似度核函数 $k(\mathbf{x}, \mathbf{x}')$。一个标准且有效的选择是归一化的[内积](@entry_id:158127)，即两个[功率谱](@entry_id:159996)向量之间的余弦相似度 ：
    $$ k(\mathbf{x}, \mathbf{x}') = \frac{\sum_{n,n',l} p_{nn'l}(\mathbf{x}) p_{nn'l}(\mathbf{x}')}{\sqrt{\left(\sum_{n,n',l} p_{nn'l}(\mathbf{x})^2\right) \left(\sum_{n,n',l} p_{nn'l}(\mathbf{x}')^2\right)}} $$
    这个[核函数](@entry_id:145324)既是旋转不变的，也是归一化的（$k(\mathbf{x}, \mathbf{x})=1$），非常适用于[核方法](@entry_id:276706)，如[高斯过程回归](@entry_id:276025)。

##### 晶体[图表示](@entry_id:273102)与[图神经网络](@entry_id:136853)

将整个[晶体结构](@entry_id:140373)表示为一个图（Graph）是另一种强大的[范式](@entry_id:161181)。在这种表示中，原子是图的 **节点（nodes）**，而原子间的连接（通常由[截断半径](@entry_id:136708)内的近邻关系定义）是图的 **边（edges）**。**图神经网络（Graph Neural Networks, GNNs）**，特别是 **[消息传递神经网络](@entry_id:751916)（Message Passing Neural Networks, MPNNs）**，是处理这类图数据的自然选择 。

一个典型的 MPNN 架构遵循以下步骤来满足物理对称性约束：
1.  **节点初始化**：每个原子（节点）$i$ 根据其元素种类 $s_i$ 被赋予一个初始[特征向量](@entry_id:151813) $h_i^{(0)}$，通常通过一个可学习的嵌入层 $h_i^{(0)} = \mathrm{E}(s_i)$ 实现。
2.  **消息传递**：在每一层（或迭代）$t$ 中，每个节点 $i$ 从其邻居节点 $\mathcal{N}(i)$ 收集“消息”。消息 $m_{ij}$ 从邻居 $j$ 发送到 $i$，它通常是一个依赖于中心节点、邻居节点和它们之间边的特征的函数：$m_{ij} = \mathrm{M}_t(h_i^{(t)}, h_j^{(t)}, e_{ij})$。为了保证[旋转不变性](@entry_id:137644)，边的特征 $e_{ij}$ 必须是标量，如原子间距 $d_{ij}$ 或从局部几何（如球面沃罗诺伊分割）派生的固溶角 $\omega_{ij}$ 。
3.  **聚合**：节点 $i$ 将收到的所有消息聚合成一个单一的向量 $m_i^{(t)}$。为了满足[置换不变性](@entry_id:753356)（邻居的顺序不重要），聚合函数必须是一个[对称函数](@entry_id:177113)，如求和、求平均或取最大值。求和是最常用的选择：$m_i^{(t)} = \sum_{j \in \mathcal{N}(i)} m_{ij}$。
4.  **更新**：节点 $i$ 的[特征向量](@entry_id:151813)根据其旧[状态和](@entry_id:193625)聚合后的消息进行更新：$h_i^{(t+1)} = \mathrm{U}_t(h_i^{(t)}, m_i^{(t)})$。
5.  **读出**：经过 $T$ 轮[消息传递](@entry_id:751915)后，每个原子都获得了编码其局部环境信息的[特征向量](@entry_id:151813) $h_i^{(T)}$。对于需要预测的体系总属性（如总能量），最终的预测值通过一个读出函数获得。为了保证属性的 **[广延性](@entry_id:144932)（extensivity）**（即体系大小加倍，属性值也应加倍），读出函数通常是对所有原子贡献的求和：$\hat{Y} = \sum_{i=1}^{N} \mathrm{P}(h_i^{(T)})$。

在处理周期性晶体时，邻居搜索和距离计算必须正确处理 **周期性边界条件（periodic boundary conditions）**，通常采用[最小镜像约定](@entry_id:142070)（minimum-image convention） 。通过这样的精心设计，MPNN 能够学习到从[原子结构](@entry_id:137190)到材料属性的复杂映射，同时严格遵守底层的物理对称性。

### 关键[材料性能](@entry_id:146723)的预测

一旦我们有了材料的数学表示，就可以训练模型来预测其各种性质。热力学稳定性是[材料科学](@entry_id:152226)中最基本和最重要的属性之一，我们将以此为例，说明预测的原理。

#### 目标属性：生成能

在 $T=0\,\mathrm{K}$ 和低压下，一个相的稳定性由其 **生成能（formation energy）** $E_{\mathrm{form}}$ 决定。对于一个包含 $n_i$ 个元素 $i$ 的化合物，其（单位原子）生成能定义为该化合物的总能量 $E_{\mathrm{tot}}$ 与其构成元素的参考能量（化学势 $\mu_i$）之差，并按总原子数归一化 ：
$$ E_f = \frac{E_{\mathrm{tot}} - \sum_i n_i \mu_i}{\sum_i n_i} $$
这个定义使得生成能成为一个 **[内含性质](@entry_id:181209)（intensive property）**，其值不依赖于计算单元的选择（例如，使用原胞或超胞计算会得到相同的结果）。生成能为负值通常表示该化合[物相](@entry_id:196677)对于其纯元素组分是能量上有利的。

选择合适的元素化学势 $\mu_i$ 作为参考态至关重要。理论计算中，通常使用[密度泛函理论](@entry_id:139027)（DFT）计算出的元素最稳定[晶体结构](@entry_id:140373)的单位原子能量。然而，DFT 计算本身存在系统误差，这会影响生成能的绝对精度。为了提高与实验值的一致性，研究者发展了诸如 **拟合元素相参考能（Fitted Elemental-phase Reference Energies, FERE）** 等修正方案，通过在一个已知化合物的数据集上拟合 $\mu_i$ 值来吸收平均的元素特定误差 。对于像氧这样的元素，其[标准态](@entry_id:145000)是气体（$\mathrm{O}_2$ 分子），选择合适的参考态是一个微妙的问题，直接使用固态氧或气态分子的 DFT 能量可能都需要额外的校正才能获得高精度结果 。

#### 凸包与[热力学稳定性](@entry_id:142877)

单个化合物的生成能本身并不足以判断其是否能在热力学平衡中稳定存在。一个相可能会分解成能量更低的多个相的混合物。判断[绝对稳定性](@entry_id:165194)的工具是 **生成能凸包（convex hull of formation energies）** 。

在一个能量-组分图上，我们将所有已知相的单位原子生成能作为数据点绘制出来。这些点的 **下方凸[包络线](@entry_id:174062)（lower convex envelope）** 就构成了凸包。
- **稳定相**：其数据点恰好落在[凸包](@entry_id:262864)上的相是[热力学](@entry_id:141121)稳定相。纯元素和所有稳定的化合物都位于[凸包](@entry_id:262864)的顶点。
- **[亚稳相](@entry_id:184907)**：其数据点位于[凸包](@entry_id:262864)上方的相是[亚稳相](@entry_id:184907)。它们虽然能量上不是最低，但可能由于动力学壁垒而存在。
- **相分离区域与[连接线](@entry_id:196944)**：[凸包](@entry_id:262864)上连接两个稳定相顶点的直线段被称为 **[连接线](@entry_id:196944)（tie-line）**。任何位于这两个顶点之间的组分，其[热力学平衡](@entry_id:141660)态都是这两个稳定相的混合物，其能量就位于这条连接线上。

一个[亚稳相](@entry_id:184907)的稳定性程度可以用其能量高出凸包的垂直距离来量化，这个距离被称为 **离[凸包](@entry_id:262864)距离（hull distance）** 或 **分解能** 。它代表了该[亚稳相分解](@entry_id:144859)成邻近的稳定[相混合](@entry_id:199798)物所能释放的能量，是衡量其亚稳程度的关键指标。例如，考虑一个二元体系 $A$-$B$ 中的 $AB_3$ 相（$x_B=0.75$），其计算生成能为 $-0.18\,\mathrm{eV}$/atom。如果其两侧的稳定相是 $AB_2$（$x_B=2/3$, $E_f=-0.27\,\mathrm{eV}$/atom）和纯元素 $B$（$x_B=1$, $E_f=0\,\mathrm{eV}$/atom），我们可以通过线性插值计算出在 $x_B=0.75$ 处的凸包能量：
$$ E_{\mathrm{hull}}(0.75) = -0.27 + \left(\frac{0 - (-0.27)}{1 - 2/3}\right) \left(0.75 - \frac{2}{3}\right) \approx -0.2025\,\mathrm{eV}/\text{atom} $$
该 $AB_3$ 相的离凸包距离就是：
$$ \Delta E_{\mathrm{hull}} = E_f(0.75) - E_{\mathrm{hull}}(0.75) = -0.18 - (-0.2025) = +0.0225\,\mathrm{eV}/\text{atom} $$
这个正值表明 $AB_3$ 是亚稳的，并量化了其亚稳程度。

#### 微观结构-性能关联

除了[完美晶体](@entry_id:138314)，许多材料的性能取决于其微观结构，例如[多晶材料](@entry_id:158956)的晶粒[分布](@entry_id:182848)或[复合材料](@entry_id:139856)的相[分布](@entry_id:182848)。为了将微观结构与宏观性能联系起来，我们需要对微观结构进行量化表征。**[两点相关函数](@entry_id:185074)（two-point correlation function）** $S_2(\mathbf{r})$ 就是一种基本的统计描述符 。

对于一个两相材料，我们可以通过一个[指示函数](@entry_id:186820) $I_A(\mathbf{x})$ 来表示空间点 $\mathbf{x}$ 是否属于 $A$ 相（$I_A=1$）或另一相（$I_A=0$）。$S_2^{AA}(\mathbf{r})$ 被定义为在相空间中随机选择一个点 $\mathbf{x}$，找到它和另一个与它相距一个矢量 $\mathbf{r}$ 的点 $\mathbf{x}+\mathbf{r}$ **同时** 位于 $A$ 相的概率。根据概率论的基本原理，这个概率等于指示函数乘积的系综平均：
$$ S_2^{AA}(\mathbf{r}) = \langle I_A(\mathbf{x}) I_A(\mathbf{x}+\mathbf{r}) \rangle $$
这个函数依赖于矢量 $\mathbf{r}$，因此它捕捉了微观结构的各向异性信息。然而，对于许多有效介质属性（如有效电导率），我们希望使用与样品整体取向无关的特征。这可以通过对 $S_2(\mathbf{r})$ 进行 **旋转平均** 来实现，得到一个只依赖于距离 $\rho = \|\mathbf{r}\|$ 的各向同性统计量 $S_{2,\mathrm{iso}}(\rho)$。这个操作可以通过在所有旋转构成的[特殊正交群](@entry_id:146418) $\mathrm{SO}(n)$ 上对 $S_2(R\mathbf{r})$ 进行积分来严谨地定义 。通过在不同半径 $\rho_j$ [上采样](@entry_id:275608) $S_{2,\mathrm{iso}}(\rho_j)$，我们可以获得一组捕捉了微观结构[特征长度尺度](@entry_id:266383)且旋转不变的特征，用于[机器学习模型](@entry_id:262335)的输入。

### 构建稳健可靠的模型

一个成功的[材料信息学](@entry_id:197429)模型不仅要做出准确的预测，还必须是稳健和可靠的。这要求我们从数据源头到[模型验证](@entry_id:141140)的整个流程中都采取严谨的[科学方法](@entry_id:143231)。

#### [数据策管](@entry_id:165262)与[数据泄漏](@entry_id:260649)

##### 材料数据集的严谨定义

“垃圾进，垃圾出”的原则在这里同样适用。一个高质量的材料数据集必须远不止是结构和属性的简单列表。它必须包含详尽的 **[元数据](@entry_id:275500)（metadata）** 和 **出处（provenance）** 信息 。这包括：
- **标签来源**：是来自实验测量还是理论计算？
- **计算细节**：如果是 DFT 计算，使用了哪种交换关联泛函？[截断能](@entry_id:177594)是多少？$k$点网格密度是多少？
- **实验条件**：如果来自实验，测量时的温度、压力是多少？

这些信息至关重要，因为不同的数据生成过程会引入不同类型的误差。例如，使用特定 DFT 泛函 $f$ 计算的属性 $y_i$ 可能与“真实”值 $y^\star(x_i)$ 之间存在一个系统的、依赖于泛函的偏差 $b_f$，即 $y_i = y^\star(x_i) + b_f + \epsilon_{c,i}$。而实验测量的属性则可能受到温度效应 $\Delta_T(x_i)$ 和依赖于样本的测量噪声 $\epsilon_{e,i}$ 的影响。如果一个模型在混合了这些不同来源的数据集上进行训练，而没有将来源和条件作为特征，它将无法区分真实物理 $y^\star(x)$ 和这些系统性偏差。其结果是，模型学到的将是真实物理与数据集中各种系统偏差的某种平均混合体，导致其预测产生偏误 。因此，区分 **系统误差/偏差（systematic error/bias）** 和 **随机不确定性/噪声（aleatoric uncertainty/noise）** 是至关重要的。

##### [晶体学](@entry_id:140656)重复导致的[数据泄漏](@entry_id:260649)

在构建模型时，一个尤其[隐蔽](@entry_id:196364)的陷阱是 **[数据泄漏](@entry_id:260649)（data leakage）**。在[材料科学](@entry_id:152226)中，这常常以 **晶体学重复（crystallographic duplicates）** 的形式出现 。同一个晶体相可能在数据库中以多种形式存在：
- 不同的[晶胞](@entry_id:143489)选择（如原胞 vs. 某个传统晶胞）。
- 超胞结构（如 $1 \times 1 \times 1$ 的[原胞](@entry_id:159354)和 $2 \times 1 \times 1$ 的超胞）。
- 不同的对称性设置或原子排序。
- 由不同研究组或不同计算参数独立弛豫得到的、原子位置有微小差异的结构。

如果这些本质上相同的结构被随机地分配到交叉验证的训练集和[验证集](@entry_id:636445)中，模型的性能评估结果将会被严重夸大。模型在验证集上的“成功”预测，并非因为它学会了泛化到新的物理结构，而仅仅是因为它在训练集中“见过”了一个几乎一样的结构。

为了防止这种泄漏，必须在构建数据集和划分交叉验证折叠之前进行严格的 **去重（deduplication）**。一个稳健的去重流程  应该包括：
1.  **[晶胞](@entry_id:143489)规范化**：将所有[晶体结构](@entry_id:140373)转换为一个唯一的、规范的表示，例如通过 Niggli 约化算法得到规范约化胞。
2.  **快速预筛选**：通过比较规范化后的[晶格](@entry_id:196752)[度规张量](@entry_id:160222) $G = A^T A$ 等廉价指标，快速排除明显不同的结构。
3.  **精确结构匹配**：对于预筛选后的候选对，进行精确的、考虑了周期性、原子种类和[空间群对称性](@entry_id:204211)的结构匹配。这通常通过最小化一个对称性感知的[均方根偏差](@entry_id:170440)（RMSD）来实现。
4.  **设置物理阈值**：选择合适的 RMSD 阈值（例如 $0.1\,\text{\AA}$）来判定结构是否相同。这个阈值应足够大以容忍来自不同 DFT 弛豫的数值噪声，但又足够小以区分不同的多晶型物。
通过这个流程，所有重复的结构被识别并[聚类](@entry_id:266727)。在交叉验证时，必须保证一个聚类的所有成员都位于同一个折叠中（即同在训练集或同在验证集），从而杜绝泄漏。

#### 严格的[模型验证](@entry_id:141140)

由于[数据泄漏](@entry_id:260649)的风险，标准的随机 K 折[交叉验证](@entry_id:164650)对于材料数据集是严重不足的。我们需要更严格的验证策略，其设计应与模型的预期应用场景（deployment domain）相匹配 。如果目标是让[模型泛化](@entry_id:174365)到全新的化学体系或全新的结构原型，那么[验证集](@entry_id:636445)必须在这些方面与训练集完全分离。

一种先进且可靠的策略是基于 **相似性图的组 K 折交叉验证（Group K-Fold Cross-Validation on a similarity graph）** 。其步骤如下：
1.  构建一个无向的 **相似性图** $H$。图中的每个节点代表数据集中的一个材料样本。
2.  在任意两个样本 $i$ 和 $j$ 之间添加一条边，如果它们满足任何一种“相似”条件，即任何一种可能导致[数据泄漏](@entry_id:260649)的联系。这些条件应包括：
    - **晶体学重复**：如上一节所述的结构匹配。
    - **共享化学组分**：例如，具有相同的归一化化学式。
    - **共享结构原型**：例如，具有相同的[晶体学](@entry_id:140656)拓扑标签（如 AFLOW 或 OQMD 的原型标签）。
3.  找到这个相似性图的所有 **连通分量（connected components）**。每个连通分量都是一个“不可分割”的样本块，其中任何两个样本都通过一条相似性路径相连。
4.  在这些连通分量上执行组 K 折[交叉验证](@entry_id:164650)，即随机地将整个连通分量分配到 K 个折叠中。

通过这种方式，可以保证任何一个折叠中的训练集和验证集之间，不存在任何由组分、原型或结构重复所定义的相似性连接。这种方法提供的性能评估结果，能更真实地反映模型在面对真正“新”材料时的泛化能力。

#### 理解和检测[分布偏移](@entry_id:638064)

最后，即使一个模型通过了严格的验证，当它被部署到实际应用中时，我们仍需警惕 **[分布偏移](@entry_id:638064)（distribution shift）** 的问题。即，模型在预测时遇到的新数据，其[统计分布](@entry_id:182030) $p_{\mathrm{test}}(x,y)$ 可能不同于训练时的数据[分布](@entry_id:182848) $p_{\mathrm{train}}(x,y)$ 。主要有三种类型的[分布偏移](@entry_id:638064)：

1.  **[协变量偏移](@entry_id:636196)（Covariate Shift）**: 输入特征的[分布](@entry_id:182848)发生变化（$p_{\mathrm{test}}(x) \neq p_{\mathrm{train}}(x)$），但输入与输出之间的物理关系保持不变（$p_{\mathrm{test}}(y \mid x) = p_{\mathrm{train}}(y \mid x)$）。这在材料筛选中很常见，我们希望模型能预测训练集中未见过的化学空间的性质。
2.  **标签偏移（Label Shift）**: 输出标签的[分布](@entry_id:182848)发生变化（$p_{\mathrm{test}}(y) \neq p_{\mathrm{train}}(y)$），但给定一个标签，其对应输入的[分布](@entry_id:182848)不变（$p_{\mathrm{test}}(x \mid y) = p_{\mathrm{train}}(x \mid y)$）。例如，我们可能更关注寻找具有极高或极低属性值的材料。
3.  **概念偏移（Concept Shift）**: 输入与输出之间的根本关系发生了变化（$p_{\mathrm{test}}(y \mid x) \neq p_{\mathrm{train}}(y \mid x)$）。这是最危险的偏移，因为它意味着模型学到的物理规律已不再适用。例如，一个在 $0\,\mathrm{K}$ 数据上训练的模型被用来预测高温下的性质，而温度并未作为输入特征。

对于一个已部署的模型，在对一个新的、未标记的输入 $x^\star$ 进行预测前，进行 **[分布](@entry_id:182848)外（Out-of-Distribution, OOD）** 检测是至关重要的。这主要是为了检测[协变量偏移](@entry_id:636196)。常用的方法是在模型学习到的[特征空间](@entry_id:638014) $\phi(x)$ 中，评估新数据点 $\phi(x^\star)$ 的“[典型性](@entry_id:204613)” 。
- **[核密度估计](@entry_id:167724)（Kernel Density Estimation, KDE）**: 在[训练集](@entry_id:636396)的所有[特征向量](@entry_id:151813) $\{\phi(x_i)\}$ 上构建一个[密度估计](@entry_id:634063)器。如果新数据点 $\phi(x^\star)$ 处的估计密度低于某个阈值，则将其标记为 OOD。
- **[马氏距离](@entry_id:269828)（Mahalanobis Distance）**: 假设[训练集](@entry_id:636396)的[特征向量](@entry_id:151813)服从一个多元[高斯分布](@entry_id:154414)，我们可以计算其均值 $\mu_\phi$ 和协方差矩阵 $\Sigma_\phi$。新数据点 $\phi(x^\star)$ 的[马氏距离](@entry_id:269828) $D_M(\phi(x^\star)) = \sqrt{(\phi(x^\star) - \mu_{\phi})^T \Sigma_{\phi}^{-1} (\phi(x^\star) - \mu_{\phi})}$ 衡量了它到[分布](@entry_id:182848)中心的距离（已考虑特征间的相关性）。超过特定阈值的距离表示该点是异[常点](@entry_id:164624)。

这些 OOD 检测方法让我们能够为模型的预测附加一个[置信度](@entry_id:267904)：当模型被要求对它“从未见过”类型的材料进行预测时，我们可以对其输出持保留态度。值得注意的是，这些基于输入特征的 OOD 检测方法无法检测到纯粹的概念偏移，因为概念偏移改变的是 $p(y|x)$，而输入 $x$ 本身可能仍在[分布](@entry_id:182848)内。