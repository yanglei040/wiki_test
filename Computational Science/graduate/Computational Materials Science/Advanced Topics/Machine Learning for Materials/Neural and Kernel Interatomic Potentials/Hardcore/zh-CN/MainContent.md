## 引言
在原子尺度上模拟材料的行为是现代[计算材料科学](@entry_id:145245)和化学的核心挑战之一。传统的量子力学方法虽然精度高，但计算成本巨大，难以应用于大体系和长时间的模拟；而[经典力场](@entry_id:747367)虽然高效，却往往难以准确捕捉复杂的化学成键和量子效应。近年来，[机器学习原子间势](@entry_id:751582)（ML-IAP），特别是基于[神经网](@entry_id:276355)络和核函数的方法，正以其兼顾量子精度与计算效率的独特优势，深刻地改变着这一领域的研究[范式](@entry_id:161181)。然而，这些强大的模型并非简单的“黑箱”，其背后蕴含着深刻的物理原理和精巧的数学设计。本文旨在填补理论与应用之间的知识鸿沟，为读者提供一个关于ML-IAP的系统性学习框架。

本文将引导读者逐步深入ML-IAP的世界。在第一章“原则与机制”中，我们将奠定理论基石，详细阐述局域性假设、对称性约束，并剖析从原子坐标到能量预测的全过程。接下来的“应用与跨学科连接”一章将展示这些理论如何在分子动力学、材料属性预测和[化学反应](@entry_id:146973)研究等真实场景中发挥威力。最后，“动手实践”部分将提供一系列精心设计的编程练习，帮助您将理论知识转化为解决实际问题的能力。通过本系列文章的学习，您将能够理解、评估并最终应用这些前沿工具来解决您自己研究领域中的科学问题。

## 原则与机制

在上一章引言的基础上，本章将深入探讨构成神经和核函数[势函数](@entry_id:176105)（统称为[机器学习原子间势](@entry_id:751582)，ML-IAP）的核心科学原则与关键技术机制。我们将系统地阐述这些模型如何将基本的物理对称性编码到数学框架中，如何将复杂的原[子环](@entry_id:154194)境表示为信息丰富的描述符，以及如何利用这些描述符来预测能量和力。

### 原子[能量分解](@entry_id:193582)：局域性假设

现代ML-IAP的基石是一个强大而简洁的假设：**局域性 (locality)**。该假设断言，一个包含大量原子的系统的总势能 $E$ 可以被分解为各个原子能量贡献 $E_i$ 的总和。更关键的是，每个原子 $i$ 的能量贡献 $E_i$ 仅由其自身及其周围一个有限空间区域内的邻居原子所构成的**局域原子环境 (local atomic environment)** $\mathcal{N}_i$ 决定。

这个思想可以形式化地表述为 ：存在一个原子能量映射 $\varepsilon$，使得总能量可以写作：
$$
E = \sum_{i} E_i = \sum_{i} \varepsilon(\mathcal{N}_i)
$$
其中，$\mathcal{N}_i$ 代表以原子 $i$ 为中心、在某个有限的**[截断半径](@entry_id:136708) (cutoff radius)** $R_c$ 内的所有邻居原子的集合。这个集合通常包含邻居原子的种类信息以及它们相对于中心原子 $i$ 的位置向量。例如，$\mathcal{N}_i = \{ (Z_j, \mathbf{r}_{ji}) : |\mathbf{r}_{ji}| \le R_c \}$，其中 $Z_j$ 是邻居原子 $j$ 的化学种类，$\mathbf{r}_{ji} = \mathbf{r}_j - \mathbf{r}_i$ 是相对位置向量。

局域性假设的物理基础源于Walter Kohn提出的**电子物质的“近视”原理 (principle of nearsightedness of electronic matter)**。该原理指出，在具有[能隙](@entry_id:191975)的系统中，局域的外部势场变化对远离该区域的电子性质影响微乎其微，并且这种影响会随距离指数衰减。因此，在许多材料（特别是[半导体](@entry_id:141536)和绝缘体）中，一个原子的成键行为主要由其近邻决定。ML-IAP正是将这一物理洞见转化为一个可行的计算模型。通过设定一个有限的 $R_c$，我们将一个原则上是多体、多尺度的量子力学问题，简化为了一个可在原子尺度上并行处理的、具有固定复杂度的计算任务。

然而，必须清醒地认识到局域性假设的局限性。它通过在 $R_c$ 处截断相互作用，从根本上排除了所有超出该范围的物理效应。对于那些本质上具有长程衰减特性的相互作用，例如离子晶体中的**库仑静电相互作用**（按 $1/r$ 衰减）和分子体系中的**范德华[色散力](@entry_id:153203)**（按 $1/r^6$ 衰减），这种截断会引入系统性偏差。简单地增大切断半径 $R_c$ 不仅计算成本高昂，而且对于 $1/r$ 这样的慢衰减相互作用，其收敛性很差，无法准确描述宏观体系的性质。因此，一个纯粹的局域模型本身无法精确捕捉带电或极性体系的物理。

正确的做法是构建**混合模型 (hybrid models)**，即在局域ML-IAP的基础上，用一个解析的、基于物理的**长程求解器 (long-range solver)** 来显式处理这些非局域相互作用。我们将在本章末尾详细讨论如何通过Ewald求和等方法实现这一点 。

最后，需要区分**局域性 (locality)** 和 **体序 (body-order)**。局域性指的是空间上的截断，而体序指的是一个[相互作用项](@entry_id:637283)中包含的粒子数量。原子能量函数 $\varepsilon(\mathcal{N}_i)$ 是截断球内所有邻居原子位置的复杂函数，它隐式地包含了对、三体、四体乃至更高阶的相互作用信息，只要这些原子都位于 $R_c$ 之内。因此，一个局域模型可以是任意高体序的，这与一个仅考虑二体作用但作用范围无限的简单[对势](@entry_id:753090)（如[Lennard-Jones势](@entry_id:143105)）有着本质区别 。

### 物理对称性的核心作用

一个物理上合理的[势函数](@entry_id:176105)必须遵从其所描述的物理系统所固有的基本对称性。对于原子系统而言，这些对称性源于空间的基本性质（均匀性和各向同性）以及[全同粒子](@entry_id:142755)的不可区分性。这些对称性不是可选项，而是必须被严格执行的约束，它们极大地限定了原子能量函数 $\varepsilon(\mathcal{N}_i)$ 的数学形式 。

1.  **[平移不变性](@entry_id:195885) (Translational Invariance):** 由于[空间的均匀性](@entry_id:172987)，将整个原子系统在空间中平移一个任意矢量 $\mathbf{a}$，其总能量 $E$ 保持不变。
    $$
    E(\{(Z_k, \mathbf{r}_k + \mathbf{a})\}) = E(\{(Z_k, \mathbf{r}_k)\})
    $$
    这一要求通过将原子能量函数 $\varepsilon$ 定义为仅依赖于相对位置向量 $\mathbf{r}_{ji} = \mathbf{r}_j - \mathbf{r}_i$ 的函数而自动满足。由于相对位置向量在全局平移下不变，$(\mathbf{r}_j + \mathbf{a}) - (\mathbf{r}_i + \mathbf{a}) = \mathbf{r}_{ji}$，因此局域环境 $\mathcal{N}_i$ 的描述本身就是平移不变的。

2.  **[旋转不变性](@entry_id:137644) (Rotational Invariance):** 由于[空间的各向同性](@entry_id:171241)，将整个原子系统绕任意轴旋转，其总能量 $E$（一个标量）也应保持不变。若用一个旋转矩阵 $\mathbf{Q} \in \mathrm{SO}(3)$ 来表示旋转操作，则：
    $$
    E(\{(Z_k, \mathbf{Q}\mathbf{r}_k)\}) = E(\{(Z_k, \mathbf{r}_k)\})
    $$
    在旋转操作下，每个相对位置向量会发生旋转 $\mathbf{r}_{ji} \to \mathbf{Q}\mathbf{r}_{ji}$。为了保证总能量不变，每个原子能量贡献 $\varepsilon(\mathcal{N}_i)$ 也必须是旋转不变的。这意味着，如果我们将环境 $\mathcal{N}_i$ 中的所有相对位置向量都进行旋转，得到新的环境 $\mathbf{Q}\mathcal{N}_i$，那么函数 $\varepsilon$ 的值必须保持不变：
    $$
    \varepsilon(\mathbf{Q}\mathcal{N}_i) = \varepsilon(\mathcal{N}_i)
    $$
    要满足此条件，$\varepsilon$ 必须通过**[旋转不变量](@entry_id:170459) (rotational invariants)** 来构造，例如原子间的距离 $r_{ij} = |\mathbf{r}_{ji}|$、由[点积](@entry_id:149019)构成的键角 $\cos\theta_{ijk} = \hat{\mathbf{r}}_{ji} \cdot \hat{\mathbf{r}}_{ki}$，以及由相对位置向量张量积经过完全收缩得到的高阶标量。

3.  **[置换不变性](@entry_id:753356) (Permutational Invariance):** 源于量子力学中全同粒子的不可区分性。交换体系中任意两个同种原子的标签，系统的总能量不会改变。对于原子能量函数 $\varepsilon(\mathcal{N}_i)$ 而言，这意味着它必须是其输入参数（即邻居原子）的一个**[对称函数](@entry_id:177113) (symmetric function)**。换句话说，如果邻居原子 $j$ 和 $k$ 是同一种类，交换它们在函数 $\varepsilon$ 输入列表中的位置，函数值不能改变。例如，对于一个中心原子和两个同种邻居构成的体系，必须有 $\varepsilon(\dots, \mathbf{r}_{ji}, \dots, \mathbf{r}_{ki}, \dots) = \varepsilon(\dots, \mathbf{r}_{ki}, \dots, \mathbf{r}_{ji}, \dots)$。这一要求通常通过对所有同种邻居的贡献进行求和或取平均来实现。

综上所述，任何一个有效的ML-IAP都必须通过其架构设计来保证这三种不变性。将原始的、依赖于绝对坐标的原子构型，转化为一组满足上述对称性要求的、固定维度的数值**描述符 (descriptors)** 或**特征 (features)**，是构建ML-IAP的核心步骤。

### 描述原子环境：从标量到张量

将一个包含可变数量邻居的、处在三维空间中的局域原子环境 $\mathcal{N}_i$ 转化为一个满足对称性要求的固定长度的向量 $\mathbf{z}_i$，是ML-IAP成功的关键。这个过程称为[特征化](@entry_id:161672)或描述符构建。下面我们介绍几种代表性的方法。

#### 基于[对称函数](@entry_id:177113)的方法

由Jörg Behler和Michele Parrinello提出的**[原子中心对称函数](@entry_id:174796) (Atom-centered Symmetry Functions, ACSF)** 是最早也是最直观的一类描述符 。它们直接根据[旋转不变量](@entry_id:170459)（距离和角度）构建，并通过求和来满足[置换不变性](@entry_id:753356)。

最常见的ACSF包括两体和三体项：

-   **[径向对称](@entry_id:141658)函数 ($G^2$):** 用于描述中心原子 $i$ 周围的径向邻居[分布](@entry_id:182848)。其通用形式为：
    $$
    G_{i}^{2}(\eta, R_{s}) = \sum_{j \neq i} \exp\left[-\eta(r_{ij} - R_{s})^2\right] f_{c}(r_{ij}; R_{c})
    $$
    这是一个对所有邻居 $j$ 的高斯函数求和。参数 $\eta$ 控制高斯函数的宽度，$\eta$ 越大，径向分辨率越高。参数 $R_s$ 是高斯函数的中心，通过设置一系列不同的 $R_s$ 值，可以探测不同距离壳层的邻居[分布](@entry_id:182848)。$f_c(r; R_c)$ 是一个**截断函数**，例如 $f_c(r; R_c) = \frac{1}{2}\left[\cos(\pi r/R_c) + 1\right]$ （对于 $r \le R_c$），它能保证原子在穿越[截断半径](@entry_id:136708) $R_c$ 时，其贡献平滑地变为零，从而确保能量和力的连续性。

-   **角向[对称函数](@entry_id:177113) ($G^4$):** 用于描述以中心原子 $i$ 为顶点的键角 $\theta_{ijk}$ 的[分布](@entry_id:182848)。其[标准形式](@entry_id:153058)为：
    $$
    G_{i}^{4}(\eta, \zeta, \lambda) = 2^{1-\zeta} \sum_{j \neq i} \sum_{k \neq i, k \neq j} (1 + \lambda \cos\theta_{ijk})^{\zeta} \exp\left[-\eta(r_{ij}^2 + r_{ik}^2)\right] f_c(r_{ij}; R_c) f_c(r_{ik}; R_c)
    $$
    （注：文献中存在多种$G^4$的变体，此处为常见的一种）。此函数对所有邻居对 $(j, k)$ 求和。参数 $\lambda$ 通常取 $+1$ 或 $-1$，用于[控制函数](@entry_id:183140)的敏感角度范围。参数 $\zeta$ 控制角向分辨率，$\zeta$ 越大，函数对特定角度的选择性越强。指数项则对距离较远的原子对进行衰减。

通过组合使用一系列具有不同参数 $(\eta, R_s, \zeta, \lambda)$ 的ACSF，可以为每个原子构建一个描述其局域化学环境的[特征向量](@entry_id:151813)。

#### 基于邻居密度的方法：[SOAP描述符](@entry_id:189760)

一种更系统、更完备的描述符构建方法是基于**邻居原子密度 (neighbor atomic density)** 的展开。其中，**原子位置光滑重叠 (Smooth Overlap of Atomic Positions, SOAP)** 描述符是典型代表，它被用于[高斯近似势](@entry_id:749744) (Gaussian Approximation Potential, GAP) 中。

其核心思想如下 ：

1.  **定义邻居密度:** 对于中心原子 $i$，其邻居原子密度 $\rho_i(\mathbf{r})$ 被定义为一系列以邻居原子位置 $\mathbf{r}_{ij}$ 为中心的高斯函数的叠加（在极限情况下可视为Dirac delta函数）：
    $$
    \rho_i(\mathbf{r}) = \sum_{j \in \mathcal{N}(i)} \exp(-\alpha |\mathbf{r} - \mathbf{r}_{ij}|^2)
    $$

2.  **[基函数](@entry_id:170178)展开:** 将该密度函数 $\rho_i(\mathbf{r})$ 展开在一组正交的[基函数](@entry_id:170178)上。这组[基函数](@entry_id:170178)通常由[径向基函数](@entry_id:754004) $g_n(r)$ 和球谐函数 $Y_{lm}(\hat{\mathbf{r}})$ 的乘积构成。展开系数 $c_{nlm}(i)$ 计算如下：
    $$
    c_{nlm}(i) = \int \rho_i(\mathbf{r}) g_n(r) Y_{lm}^*(\hat{\mathbf{r}}) \, d\mathbf{r}
    $$

3.  **构建[不变量](@entry_id:148850):** 展开系数 $c_{nlm}(i)$ 本身在旋转下会以复杂的方式变换。为了获得[旋转不变量](@entry_id:170459)，可以构建所谓的**[功率谱](@entry_id:159996) (power spectrum)**：
    $$
    p_{nn'l}(i) = \sum_{m=-l}^{l} c_{nlm}(i) c_{n'lm}^*(i)
    $$
    根据角动量耦合理论，这些功率谱分量 $p_{nn'l}(i)$ 是[旋转不变量](@entry_id:170459)。它们构成了[SOAP描述符](@entry_id:189760)的向量。

**示例：计算一个简化的SOAP核**

为了更具体地理解这个过程，我们考虑一个简化场景 。假设我们只关心 $l=0$ 的各项同性部分，且仅使用两个[径向基函数](@entry_id:754004) $g_1(r)$ 和 $g_2(r)$。功率谱简化为 $p_{nn'0} = c_{n00} c_{n'00}$。两个环境 $A$ 和 $B$ 之间的相似性可以通过一个[核函数](@entry_id:145324)来度量，例如[点积](@entry_id:149019)核 $K(A,B) = \sum_{n,n'} p_{nn'0}^A p_{nn'0}^B$。经过归一化后，它等于描述符向量之间余弦相似度的平方。

考虑两个环境：$A$ 有两个邻居，距离为 $r_{A,1}=2$ Å 和 $r_{A,2}=3.5$ Å；$B$ 也有两个邻居，距离为 $r_{B,1}=2.25$ Å 和 $r_{B,2}=3.75$ Å。设[截断半径](@entry_id:136708) $R_c=4$ Å，[径向基函数](@entry_id:754004)为 $g_1(r) = \frac{\sqrt{3}}{8}$ 和 $g_2(r) = \frac{\sqrt{5}}{8}(r-3)$。

首先，我们计算忽略常数因子后的系数向量 $\mathbf{v}^X_n = \sum_i g_n(r_{X,i})$：
-   对于环境A:
    $v^A_1 = g_1(2) + g_1(3.5) = \frac{\sqrt{3}}{8} + \frac{\sqrt{3}}{8} = \frac{\sqrt{3}}{4}$
    $v^A_2 = g_2(2) + g_2(3.5) = \frac{\sqrt{5}}{8}(2-3) + \frac{\sqrt{5}}{8}(3.5-3) = -\frac{\sqrt{5}}{16}$
-   对于环境B:
    $v^B_1 = g_1(2.25) + g_1(3.75) = \frac{\sqrt{3}}{4}$
    $v^B_2 = g_2(2.25) + g_2(3.75) = \frac{\sqrt{5}}{8}(-0.75) + \frac{\sqrt{5}}{8}(0.75) = 0$

然后，我们计算归一化[核函数](@entry_id:145324) $K(A,B) = \frac{(\mathbf{v}^A \cdot \mathbf{v}^B)^2}{|\mathbf{v}^A|^2 |\mathbf{v}^B|^2}$：
-   [点积](@entry_id:149019): $\mathbf{v}^A \cdot \mathbf{v}^B = (\frac{\sqrt{3}}{4})(\frac{\sqrt{3}}{4}) + (-\frac{\sqrt{5}}{16})(0) = \frac{3}{16}$
-   模长的平方:
    $|\mathbf{v}^A|^2 = (\frac{\sqrt{3}}{4})^2 + (-\frac{\sqrt{5}}{16})^2 = \frac{3}{16} + \frac{5}{256} = \frac{53}{256}$
    $|\mathbf{v}^B|^2 = (\frac{\sqrt{3}}{4})^2 + 0^2 = \frac{3}{16}$
-   核函数值:
    $K(A,B) = \frac{(3/16)^2}{(53/256)(3/16)} = \frac{3/16}{53/256} = \frac{3}{16} \cdot \frac{256}{53} = \frac{48}{53}$

这个例子清晰地展示了如何从原子坐标出发，通过一步步系统的数学变换，最终得到一个量化两个原子环境相似度的标量值。

#### 张量描述符：不变性与[等变性](@entry_id:636671)

ACSF和SOAP都遵循“不变性”的策略：即在特征构建的早期阶段就将所有方向信息抛弃，以获得旋转不变的标量描述符。然而，方向信息本身对于[描述化学](@entry_id:148710)键和复杂的原子相互作用至关重要。现代ML-IAP的发展趋势是转向“[等变性](@entry_id:636671)”(equivariance) 策略，即在模型的中间层保留和处理矢量、张量等具有方向性的特征。

**矩张量势 (Moment Tensor Potentials, MTPs)** 是一个重要的里程碑 。它首先构建一个称为**矩张量 (moment tensor)** 的[高阶张量](@entry_id:200122)，然后通过[张量缩并](@entry_id:193373)来系统地构造[不变量](@entry_id:148850)。矩张量定义为：
$$
M_{\mu, \nu} = \sum_{j} f_{\mu}(r_{ij}) \underbrace{\mathbf{r}_{ij} \otimes \dots \otimes \mathbf{r}_{ij}}_{\nu \text{ times}}
$$
这是一个 $\nu$ 阶张量，其中 $f_\mu(r)$ 是一组[径向基函数](@entry_id:754004)。$M_{\mu, \nu}$ 在旋转下会像一个 $\nu$ 阶张量一样变换。为了获得[不变量](@entry_id:148850)，我们可以将这些张量与自身或其他张量进行完全的[指标缩并](@entry_id:180403)。例如：
-   $M_{\mu,1} \cdot M_{\nu,1}$ (两个一阶张量/向量的[点积](@entry_id:149019)) 是一个[不变量](@entry_id:148850)。
-   $\mathrm{Tr}(M_{\mu,2})$ ([二阶张量](@entry_id:199780)的迹) 是一个[不变量](@entry_id:148850)。
-   $M_{\mu,2} : M_{\nu,2}$ (两个二阶张量的[Frobenius内积](@entry_id:153693)) 也是一个[不变量](@entry_id:148850)。

通过系统地枚举这些缩并方式，MTPs能够构建一个完备的、包含任意高体序相互作用的[不变量](@entry_id:148850)基。

**[E(3)等变神经网络](@entry_id:748761)** 则将这一思想推向了极致 。这类模型，如NequIP、MACE等，其核心是一种称为**E(3)-[等变性](@entry_id:636671)**的性质。一个函数或[神经网](@entry_id:276355)络层 $f$ 被称为E(3)等变的，如果当其输入发生欧几里得群（平移和旋转）变换时，其输出也以完全相同的方式进行变换。

形式上，如果一个变换 $g=(R, \mathbf{t})$ 作用于输入位置 $\mathbf{r}_i \to R\mathbf{r}_i + \mathbf{t}$，并且作用于一个类型为 $l$ 的张量特征 $\mathbf{u}_i^{(l)}$ 使之变换为 $\mathbf{u}_i^{(l)} \to D^{(l)}(R) \mathbf{u}_i^{(l)}$ (其中 $D^{(l)}(R)$ 是[Wigner D-矩阵](@entry_id:187739))，那么一个等变层 $f$ 的输出 $f(\{\mathbf{r}_i, \mathbf{u}_i^{(l)}\})$ 也必须遵循完全相同的变换规则。

在这些模型中，原子特征不再是标量，而是被表示为一系列不同类型（不同阶）的张量 $\mathbf{u}_i^{(l)}$。例如，类型-0 ($l=0$) 特征是标量，类型-1 ($l=1$) 特征是矢量，类型-2 ($l=2$) 特征是[二阶张量](@entry_id:199780)等。网络的每一层都被精心设计成等变操作（例如，通过球谐函数和[Clebsch-Gordan系数](@entry_id:142551)进行[张量积](@entry_id:140694)），从而保证信息在网络中流动时，其张量属性和变换规律得以保持。最终，在网络的最后一层，这些等变特征被缩并成一个旋转不变的标量——原子能量。这种方法最大限度地保留了系统的几何信息，从而在数据效率和准确性上取得了显著的成功。

### 从描述符到能量：[核方法](@entry_id:276706)与[神经网](@entry_id:276355)络

一旦我们将每个原[子环](@entry_id:154194)境 $\mathcal{N}_i$ 转换成了一个固定维度的描述符向量 $\mathbf{z}_i$，下一步就是建立一个从 $\mathbf{z}_i$ 到原子能量 $E_i$ 的映射关系 $E_i = f(\mathbf{z}_i)$。主要有两种主流方法：[核方法](@entry_id:276706)和[神经网](@entry_id:276355)络。

#### [核方法](@entry_id:276706)与[高斯过程回归](@entry_id:276025)

**[核方法](@entry_id:276706) (Kernel methods)**，特别是以**[高斯过程回归](@entry_id:276025) (Gaussian Process Regression, GPR)** 为代表的方法，构成了GAP等模型的基础。其核心思想是“相似的输入产生相似的输出”。两个原[子环](@entry_id:154194)境的相似度由一个**[核函数](@entry_id:145324) (kernel function)** $k(\mathbf{z}, \mathbf{z}')$ 来度量。

在高斯过程框架下，我们假设原子能量函数 $f(\cdot)$ 是一个从**高斯过程 (Gaussian Process, GP)** 中抽取的样本。一个GP由一个[均值函数](@entry_id:264860)（通常设为零）和一个[协方差函数](@entry_id:265031)（即[核函数](@entry_id:145324) $k$）完全定义，记为 $f(\cdot) \sim \mathcal{GP}(0, k(\cdot, \cdot))$。

假设我们有一组训练数据，包含 $N$ 个原子环境的描述符 $\{\mathbf{x}_i\}_{i=1}^N$ 和它们对应的能量标签 $\{y_i\}_{i=1}^N$（这里用 $\mathbf{x}$ 代替 $\mathbf{z}$ 以遵循常规记法）。我们假设观测值包含高斯噪声，即 $y_i = f(\mathbf{x}_i) + \epsilon_i$，其中 $\epsilon_i \sim \mathcal{N}(0, \sigma^2)$。

对于一个新的、未见过的原[子环](@entry_id:154194)境 $\mathbf{x}_*$，GPR能够给出其能量 $f_* = f(\mathbf{x}_*)$ 的[预测分布](@entry_id:165741)（一个[高斯分布](@entry_id:154414)），其均值和[方差](@entry_id:200758)由以下公式给出 ：
-   **[后验均值](@entry_id:173826) (Posterior Mean):**
    $$
    m_* = \mathbf{k}_*^T (K + \sigma^2 I)^{-1} \mathbf{y}
    $$
-   **后验[方差](@entry_id:200758) (Posterior Variance):**
    $$
    s_*^2 = k_{**} - \mathbf{k}_*^T (K + \sigma^2 I)^{-1} \mathbf{k}_*
    $$
其中，$\mathbf{y}$ 是训练标签向量，$K$ 是训练数据的 $N \times N$ 核矩阵（$K_{ij} = k(\mathbf{x}_i, \mathbf{x}_j)$），$\mathbf{k}_*$ 是测试点与所有训练点之间的[核函数](@entry_id:145324)值构成的向量（$(\mathbf{k}_*)_i = k(\mathbf{x}_i, \mathbf{x}_*)$），$k_{**} = k(\mathbf{x}_*, \mathbf{x}_*)$ 是测试点自身的[核函数](@entry_id:145324)值，$I$ 是[单位矩阵](@entry_id:156724)。

预测的能量值就是[后验均值](@entry_id:173826) $m_*$，它被表示为训练标签的线性组合，权重由核函数决定。后验[方差](@entry_id:200758) $s_*^2$ 则提供了模型对预测的[不确定性度量](@entry_id:152963)，这在主动学习等场景中非常有用。

#### [神经网](@entry_id:276355)络方法及其与[核方法](@entry_id:276706)的联系

另一种主流方法是使用**[人工神经网络](@entry_id:140571) (Artificial Neural Network, ANN)**。在这种框架下（例如[Behler-Parrinello](@entry_id:177243) NNP），描述符向量 $\mathbf{z}_i$ 作为输入，通过一个或多个隐藏层，最终输出一个标量原子能量 $E_i$。每个原子都有一个相同结构和权重的[神经网](@entry_id:276355)络，确保了[置换不变性](@entry_id:753356)。

表面上看，[核方法](@entry_id:276706)和[神经网](@entry_id:276355)络是两种截然不同的[范式](@entry_id:161181)。然而，一项深刻的理论进展揭示了它们之间的内在联系。在特定条件下，即当[神经网](@entry_id:276355)络的宽度趋于无穷大时，其行为可以用一个称为**[神经正切核](@entry_id:634487) (Neural Tangent Kernel, NTK)** 的确定性[核函数](@entry_id:145324)来精确描述 。

具体来说，一个在“懒惰训练”(lazy training) 机制下通过[梯度下降优化](@entry_id:634206)的无限宽[神经网](@entry_id:276355)络，其学习的函数预测器等价于在一个由NTK $\Theta(\mathbf{z}, \mathbf{z}')$ 所诱导的[再生核希尔伯特空间](@entry_id:633928) (RKHS) 中进行核回归。

这意味着，GAP模型所代表的[核方法](@entry_id:276706)和NNP模型所代表的[神经网](@entry_id:276355)络方法，在理论上可以被统一。两种模型[范式](@entry_id:161181)给出的函数类别是否“重合”，其充分必要条件是它们所对应的[核函数](@entry_id:145324)（GAP中的预设核 $k$ 和无限宽NNP中的NTK $\Theta$）成正比，即 $\Theta(\mathbf{z}, \mathbf{z}') = c \cdot k(\mathbf{z}, \mathbf{z}')$，其中 $c > 0$ 是一个常数。这一联系为理解和设计ML-IAP提供了强大的理论工具。

### 超越局域性：体序与[长程相互作用](@entry_id:140725)

最后，我们回到ML-IAP的两个高级主题：模型的体序和对[长程相互作用](@entry_id:140725)的处理。

#### 模型的体序

**体序 (Body-order)** 指的是模型能描述的同时相互作用的原子数量。例如，对势是二体的，[EAM势](@entry_id:748767)包含多体项。ML-IAP的有效体序是由其描述符和函数形式共同决定的。

一个有趣的发现是，即使描述符本身是基于原子对构建的（二体的），最终的模型也可以是高体序的 。以SOAP为例，[功率谱](@entry_id:159996) $p_{nn'l}(i)$ 是由两个密度展开系数 $c_{nlm}$ 相乘得到的，而每个 $c_{nlm}$ 都是对所有邻居的贡献求和。因此，$p_{nn'l}(i)$ 包含了邻居对 $(j, k)$ 之间的关联，是一个二体描述符。然而，如果我们将一个基于[SOAP描述符](@entry_id:189760)向量 $\mathbf{d}$ 的[核函数](@entry_id:145324)定义为 $K(\mathbf{d}_i, \mathbf{d}_k) = (\mathbf{d}_i \cdot \mathbf{d}_k)^\zeta$，其中 $\zeta$ 是一个正整数。那么，当我们将能量表达式（如 $E_i = \sum_s \alpha_s K(\mathbf{d}_i, \mathbf{d}_s)$）展开时，会包含 $\zeta$ 次幂的[内积](@entry_id:158127)项。由于描述符的分量（即功率谱项）是二体的，$\zeta$ 次幂的核函数在展开后，在选择不同邻居的情况下，最多可以同时涉及到 $2\zeta$ 个不同的邻居原子。因此，该模型的最大体序为 $2\zeta$。通过调节[核函数](@entry_id:145324)的指数 $\zeta$，可以系统地控制模型的体序，从而捕捉更复杂的多体化学相互作用。

#### 处理长程[静电相互作用](@entry_id:166363)

正如本章开头所述，基于局域性假设的ML-IAP无法自行处理长程[静电相互作用](@entry_id:166363)。在周期性体系中，所有周期映像下的[电荷](@entry_id:275494)相互作用之和，即[晶格和](@entry_id:189839)，是一个**条件收敛 (conditionally convergent)** 的级数，其值取决于求和的顺序，这在物理上是不可接受的。

标准解决方案是采用**混合方法**，将总[能量分解](@entry_id:193582)为一个短程项和一个长程项 ：
$$
E = E_{\text{short}} + E_{\text{long}}
$$
其中，$E_{\text{short}}$ 由ML-IAP负责学习，而 $E_{\text{long}}$ 由一个解析的物理模型（如**Ewald求和**）精确计算。

Ewald方法的核心思想是，通过引入一组正负相反的高斯[电荷分布](@entry_id:144400)来“屏蔽”原始的点电荷，从而将 $1/r$ 的慢衰减势分解为一个快速衰减的实空间部分和一个平滑变化的[倒易空间](@entry_id:754151)部分：
-   **[实空间](@entry_id:754128)部分:** 是一个短程的、被屏蔽的库仑相互作用，由于其快速衰减，可以用一个有限的[截断半径](@entry_id:136708)来计算，这与ML-IAP的局域框架兼容。
-   **[倒易空间](@entry_id:754151)部分:** 是由平滑的高斯电荷分布产生的，可以通过[傅里叶变换](@entry_id:142120)在[倒易空间](@entry_id:754151)中高效求和。
-   **[自能修正](@entry_id:754667)项:** 用于扣除人为引入的高斯[电荷](@entry_id:275494)与其自身产生的[势场](@entry_id:143025)的相互作用。

最终，对于一个包含 $N$ 个点电荷 $\{q_i\}$ 的周期性体系，其完整的混合能量表达式为：
$$
E = \sum_{i=1}^{N} U_i(\mathbf{D}_i; r_c) + \frac{1}{2} \sum_{i,j,\mathbf{n}}' q_i q_j \frac{\text{erfc}(\sqrt{\alpha}|\mathbf{r}_{ij\mathbf{n}}|)}{|\mathbf{r}_{ij\mathbf{n}}|} + \frac{4\pi}{V} \sum_{\mathbf{G} \neq 0} \frac{\exp(-\frac{G^2}{4\alpha})}{G^2} \left|\sum_{k=1}^{N} q_k \exp(-i\mathbf{G}\cdot\mathbf{r}_k)\right|^2 - \frac{\sqrt{\alpha}}{\sqrt{\pi}} \sum_{i=1}^{N} q_i^2
$$
其中，第一项 $\sum U_i$ 是由ML-IAP学习的短程能量，它负责描述量子力学校正、交换-关联、极化以及对被[屏蔽库仑势](@entry_id:151053)的修正。其余三项共同构成了精确的Ewald[静电能](@entry_id:267406)：第二项是[实空间](@entry_id:754128)求和（$\mathbf{r}_{ij\mathbf{n}} = \mathbf{r}_i-\mathbf{r}_j+\mathbf{R_n}$，$\mathbf{R_n}$是[晶格矢量](@entry_id:161583)，'表示 $i \neq j$ 当 $\mathbf{n}=0$），第三项是[倒易空间求和](@entry_id:754152)（$\mathbf{G}$是[倒易晶格矢量](@entry_id:263351)，$V$是[晶胞体积](@entry_id:173348)），第四项是[自能修正](@entry_id:754667)。$\alpha$ 是控制[实空间](@entry_id:754128)和[倒易空间](@entry_id:754151)划分的Ewald参数。

通过这种方式，ML-IAP从繁重的长程静电计算中解放出来，可以专注于学习复杂的、决定材料特性的局域量子效应，从而实现了对复杂带电材料体系的高精度和高效率模拟。