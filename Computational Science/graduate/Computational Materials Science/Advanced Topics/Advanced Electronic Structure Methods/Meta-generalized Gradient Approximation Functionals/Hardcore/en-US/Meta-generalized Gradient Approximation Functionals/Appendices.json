{
    "hands_on_practices": [
        {
            "introduction": "Meta-GGA functionals achieve higher accuracy by incorporating the kinetic energy density, $\\tau(\\mathbf{r})$, which allows them to distinguish between different types of chemical bonds and electronic regions. The iso-orbital indicator, $\\alpha(\\mathbf{r})$, is a key dimensionless quantity built from $\\tau(\\mathbf{r})$ that acts as an \"orbital-recognition\" tool. This exercise provides a foundational understanding of this concept by demonstrating analytically that for any system described by a single orbital, $\\alpha(\\mathbf{r})$ correctly evaluates to zero, a crucial exact constraint satisfied by modern functionals like SCAN. ",
            "id": "163484",
            "problem": "In Density-Functional Theory (DFT), meta-Generalized Gradient Approximation (meta-GGA) exchange-correlation functionals improve upon GGAs by including the Kohn-Sham kinetic energy density, $\\tau(\\mathbf{r})$, as an additional ingredient besides the electron density $\\rho(\\mathbf{r})$ and its gradient $\\nabla \\rho(\\mathbf{r})$.\n\nThe total electron density and kinetic energy density for a system of $N$ electrons are given by summations over the occupied Kohn-Sham orbitals $\\psi_i(\\mathbf{r})$:\n$$ \\rho(\\mathbf{r}) = \\sum_{i=1}^{N} f_i |\\psi_i(\\mathbf{r})|^2 $$\n$$ \\tau(\\mathbf{r}) = \\frac{1}{2} \\sum_{i=1}^{N} f_i |\\nabla\\psi_i(\\mathbf{r})|^2 $$\nwhere $f_i$ are the occupation numbers.\n\nA key dimensionless quantity used in modern meta-GGAs like the Strongly Constrained and Appropriately Normed (SCAN) functional is the iso-orbital indicator, $\\alpha(\\mathbf{r})$. It is defined as:\n$$ \\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})} $$\nHere, $\\tau_W(\\mathbf{r})$ is the von Weizsäcker kinetic energy density, which is the exact kinetic energy density for any one-electron system, given by:\n$$ \\tau_W(\\mathbf{r}) = \\frac{|\\nabla \\rho(\\mathbf{r})|^2}{8\\rho(\\mathbf{r})} $$\nAnd $\\tau_{\\text{unif}}(\\mathbf{r})$ is the kinetic energy density of a uniform electron gas of density $\\rho(\\mathbf{r})$:\n$$ \\tau_{\\text{unif}}(\\mathbf{r}) = C_F \\rho(\\mathbf{r})^{5/3} $$\nwhere $C_F$ is a constant related to the Fermi momentum. The value of $\\alpha$ helps distinguish different chemical environments: $\\alpha=0$ indicates single-orbital regions (like covalent bonds or atomic tails), while $\\alpha=1$ corresponds to the uniform electron gas.\n\nConsider a generic electronic system that can be described by a single, real, doubly-occupied Kohn-Sham orbital $\\psi(\\mathbf{r})$. Assuming the orbital and its gradient are non-zero, calculate the value of the iso-orbital indicator $\\alpha(\\mathbf{r})$ for this system.",
            "solution": "1. Electron density for a doubly-occupied real orbital $\\psi(\\mathbf{r})$:\n$$\\rho(\\mathbf{r}) = 2|\\psi(\\mathbf{r})|^2.$$\n2. Kohn–Sham kinetic energy density:\n$$\\tau(\\mathbf{r}) = \\frac{1}{2}\\sum_i f_i|\\nabla\\psi_i|^2\n= \\frac{1}{2} \\cdot 2 |\\nabla\\psi|^2\n= |\\nabla\\psi|^2.$$\n3. Gradient of the density:\n$$\\nabla \\rho = \\nabla\\bigl(2\\psi^2\\bigr) = 4\\psi\\nabla\\psi.$$\n4. von Weizsäcker kinetic energy density:\n$$\\tau_W(\\mathbf{r}) = \\frac{|\\nabla \\rho|^2}{8\\rho}\n=\\frac{(4\\psi\\nabla\\psi)^2}{8 \\cdot 2\\psi^2}\n=\\frac{16\\psi^2|\\nabla\\psi|^2}{16\\psi^2}\n=|\\nabla\\psi|^2.$$\n5. Difference entering the iso-orbital indicator:\n$$\\tau-\\tau_W=|\\nabla\\psi|^2-|\\nabla\\psi|^2=0.$$\n6. Therefore\n$$\\alpha(\\mathbf{r})\n=\\frac{\\tau-\\tau_W}{\\tau_{\\text{unif}}}\n=\\frac{0}{\\tau_{\\text{unif}}}=0.$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "The increased complexity of meta-GGA functionals can introduce significant numerical challenges, particularly affecting the convergence of the Self-Consistent Field (SCF) cycle. The dependence of the exchange-correlation potential on the kinetic energy density, characterized by the derivative $\\frac{\\partial v_{xc}}{\\partial \\tau}$, can amplify instabilities in systems with strong density variations. This practice guides you through a numerical simulation to explore this issue, using linear response theory to model the SCF update and directly compute how the spectral radius of the convergence map is influenced by the meta-GGA's sensitivity to $\\tau$. ",
            "id": "3465724",
            "problem": "Consider a one-dimensional periodic system in atomic units in the framework of Kohn–Sham Density Functional Theory (DFT) with a Self-Consistent Field (SCF) iteration. The exchange–correlation potential is modeled by a meta-Generalized Gradient Approximation (meta-GGA), which depends on both the electron density $\\rho(x)$ and the kinetic energy density $\\tau(x)$. We study strongly inhomogeneous charge density waves, linearize the SCF density update map around a stationary solution, and analyze the spectral radius of the Jacobian to determine convergence under linear mixing.\n\nBase definitions and assumptions:\n- The SCF update uses linear mixing with mixing parameter $m \\in (0,1)$ on the density. For a small density perturbation $\\delta \\rho(x)$, its Fourier component at wavevector $q$ is denoted $\\delta \\rho(q)$.\n- The induced density change under the Kohn–Sham response is given by $\\delta \\rho_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$, where $\\chi_0(q)$ is the static noninteracting density–density response (susceptibility), and $\\delta v_{\\mathrm{eff}}(q)$ is the effective potential variation consisting of the Hartree (Coulomb) contribution and the exchange–correlation contribution.\n- The effective potential variation is $\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta \\rho(q) + \\delta v_{xc}(q)$, where $v_c(q)$ is the screened Coulomb kernel and $\\delta v_{xc}(q)$ is the exchange–correlation variation.\n- For a meta-GGA, the exchange–correlation variation satisfies the chain rule $\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial \\rho}\\right)\\delta \\rho(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$ evaluated at the stationary solution, where $\\frac{\\partial v_{xc}}{\\partial \\rho}$ and $\\frac{\\partial v_{xc}}{\\partial \\tau}$ are treated as constants with respect to small perturbations around the stationary state.\n- For a charge-density wave with Fourier component $q$, the kinetic-energy-density variation is modeled as $\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta \\rho(q)$, where $\\gamma>0$ is a model coefficient capturing the scaling of $\\tau$ with spatial gradients in the Kohn–Sham orbitals.\n\nThe linear mixing update for the density is $ \\delta \\rho_{\\mathrm{new}}(q) = (1-m)\\,\\delta \\rho_{\\mathrm{in}}(q) + m\\,\\delta \\rho_{\\mathrm{out}}(q) $. This defines a linearized map whose Jacobian $J$ is diagonal in the Fourier basis $\\{q\\}$, with eigenvalues $\\lambda(q)$ depending on the system parameters. Convergence of the SCF iteration under linear mixing occurs when the spectral radius $\\rho = \\max_q |\\lambda(q)|$ satisfies $ \\rho < 1 $.\n\nModel kernels to be used in this problem:\n- Use a Thomas–Fermi-like model for the noninteracting susceptibility\n$$\n\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2},\n$$\nwhere $\\chi_{\\rm amp}>0$ and $q_0>0$.\n- Use a Yukawa-screened Coulomb kernel\n$$\nv_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2},\n$$\nwhere $\\alpha_c>0$ and $\\kappa>0$.\n- Treat $\\left(\\frac{\\partial v_{xc}}{\\partial \\rho}\\right)=c_n$ and $\\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)=s$ as constants specified per test case. The meta-GGA contribution is modeled via the above chain rule with $\\delta \\tau(q)=\\gamma q^2 \\delta \\rho(q)$.\n\nLet $L$ be the system length and $N$ the number of real-space grid points. Use discrete Fourier modes $q_k = \\frac{2\\pi}{L}k$ for integer indices $k$ in the range $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$, which covers nonnegative wavenumbers up to the Nyquist frequency. For each test case, assemble the linearized map eigenvalues over these modes, compute the spectral radius $\\rho$ and identify the maximizing mode $q^\\star$ that achieves it. To quantify sensitivity to the meta-GGA kinetic-energy-density dependence, compute the partial derivative $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$ at the maximizing mode $q^\\star$.\n\nYour program must:\n1. For each test case, generate the set of nonnegative Fourier modes $q_k$ as specified by $L$ and $N$.\n2. Using the base definitions and the model kernels, derive and compute the eigenvalues $\\lambda(q_k)$ of the linearized SCF map, the spectral radius $\\rho = \\max_k |\\lambda(q_k)|$, the maximizing wavevector $q^\\star$, and the sensitivity $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$.\n3. Produce a single line of output containing, for each test case in order, the spectral radius and the sensitivity evaluated at $q^\\star$, as a comma-separated list enclosed in square brackets. Express each number as a float rounded to six decimal places. No physical units are required; all quantities are dimensionless in atomic units.\n\nTest suite:\n- Case $1$ (happy path): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$.\n- Case $2$ (larger meta-GGA sensitivity): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$.\n- Case $3$ (negative meta-GGA sensitivity): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$.\n- Case $4$ (edge mixing close to instability): $L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\rho_1, S_1, \\rho_2, S_2, \\rho_3, S_3, \\rho_4, S_4]$, where $\\rho_i$ is the spectral radius for case $i$ and $S_i$ is the sensitivity $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$ for case $i$, each rounded to six decimal places.",
            "solution": "The problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **SCF Update Rule**: Linear mixing with parameter $m \\in (0,1)$ for a density perturbation: $\\delta \\rho_{\\mathrm{new}}(q) = (1-m)\\,\\delta \\rho_{\\mathrm{in}}(q) + m\\,\\delta \\rho_{\\mathrm{out}}(q)$.\n- **Kohn–Sham Response**: The induced density change is $\\delta \\rho_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$, where $\\chi_0(q)$ is the static noninteracting susceptibility.\n- **Effective Potential Variation**: $\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta \\rho(q) + \\delta v_{xc}(q)$, with $v_c(q)$ as the screened Coulomb kernel.\n- **meta-GGA Exchange–Correlation Variation**: $\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial \\rho}\\right)\\delta \\rho(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$. The partial derivatives are constants for a given stationary state, denoted $c_n = \\left(\\frac{\\partial v_{xc}}{\\partial \\rho}\\right)$ and $s = \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)$.\n- **Kinetic Energy Density Variation Model**: $\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta \\rho(q)$, for a model coefficient $\\gamma>0$.\n- **SCF Convergence Condition**: The spectral radius $\\rho = \\max_q |\\lambda(q)|$ of the linearized map's Jacobian must satisfy $\\rho < 1$.\n- **Model for Susceptibility**: $\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2}$, with $\\chi_{\\rm amp}>0$ and $q_0>0$.\n- **Model for Coulomb Kernel**: $v_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2}$, with $\\alpha_c>0$ and $\\kappa>0$.\n- **Discrete Fourier Modes**: The wavevectors are $q_k = \\frac{2\\pi}{L}k$ for integer indices $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$.\n- **Task**: Compute the spectral radius $\\rho$, the maximizing mode $q^\\star$, and the sensitivity $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$.\n- **Test Case 1**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$.\n- **Test Case 2**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$.\n- **Test Case 3**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$.\n- **Test Case 4**: $L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the specified criteria:\n- **Scientifically Grounded**: The problem is based on established principles of Kohn-Sham Density Functional Theory (DFT), specifically the linear response analysis of Self-Consistent Field (SCF) convergence. The use of simplified models for the susceptibility and Coulomb interaction is a standard practice in theoretical solid-state physics for analyzing general trends. The model for a meta-GGA functional is consistent with its definition. The problem is scientifically sound.\n- **Well-Posed**: The problem statement is unambiguous. It provides all necessary mathematical formulas, parameters, and a well-defined computational task. For the given discrete set of wavevectors, a unique spectral radius $\\rho$ is guaranteed to exist.\n- **Objective**: The problem is stated in precise, objective mathematical and physical language, free from subjective or qualitative claims.\n\nThe problem does not exhibit any of the invalidity flags. It is scientifically sound, formally specified, complete, consistent, and computationally feasible.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be developed.\n\n### Principle-Based Design\nThe solution requires two main steps: first, to derive the analytical expressions for the quantities of interest, and second, to implement a numerical calculation based on these expressions.\n\n**1. Derivation of the Jacobian Eigenvalue $\\lambda(q)$**\nThe goal is to find the eigenvalue $\\lambda(q)$ of the linear map that transforms an input density perturbation $\\delta \\rho_{\\mathrm{in}}(q)$ to the new perturbation $\\delta \\rho_{\\mathrm{new}}(q)$ after one SCF step with linear mixing. The update rule is:\n$$\n\\delta \\rho_{\\mathrm{new}}(q) = (1-m)\\,\\delta \\rho_{\\mathrm{in}}(q) + m\\,\\delta \\rho_{\\mathrm{out}}(q)\n$$\nThe eigenvalue $\\lambda(q)$ is the ratio $\\delta \\rho_{\\mathrm{new}}(q) / \\delta \\rho_{\\mathrm{in}}(q)$ in the linear regime:\n$$\n\\lambda(q) = 1 - m + m \\frac{\\delta \\rho_{\\mathrm{out}}(q)}{\\delta \\rho_{\\mathrm{in}}(q)}\n$$\nThe term $\\delta \\rho_{\\mathrm{out}}(q)$ is the response of the Kohn-Sham system to the input perturbation $\\delta \\rho_{\\mathrm{in}}(q)$. We denote $\\delta \\rho(q) \\equiv \\delta \\rho_{\\mathrm{in}}(q)$ for clarity in the following steps. The Kohn-Sham response is $\\delta \\rho_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$. The effective potential variation $\\delta v_{\\mathrm{eff}}(q)$ is induced by $\\delta \\rho(q)$:\n$$\n\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta \\rho(q) + \\delta v_{xc}(q)\n$$\nThe exchange-correlation potential variation $\\delta v_{xc}(q)$ for a meta-GGA functional is given by the chain rule, using the provided constant derivatives and the model for $\\delta\\tau(q)$:\n$$\n\\delta v_{xc}(q) = c_n\\,\\delta \\rho(q) + s\\,\\delta \\tau(q) = c_n\\,\\delta \\rho(q) + s(\\gamma\\,q^2\\,\\delta \\rho(q)) = (c_n + s \\gamma q^2) \\, \\delta \\rho(q)\n$$\nSubstituting this into the expression for $\\delta v_{\\mathrm{eff}}(q)$:\n$$\n\\delta v_{\\mathrm{eff}}(q) = \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta \\rho(q)\n$$\nThe output density perturbation is then:\n$$\n\\delta \\rho_{\\mathrm{out}}(q) = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta \\rho(q)\n$$\nFrom this, we find the ratio needed for $\\lambda(q)$:\n$$\n\\frac{\\delta \\rho_{\\mathrm{out}}(q)}{\\delta \\rho_{\\mathrm{in}}(q)} = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right)\n$$\nFinally, substituting this into the expression for $\\lambda(q)$ and inserting the model kernels for $\\chi_0(q)$ and $v_c(q)$ gives the complete formula:\n$$\n\\lambda(q) = 1 - m + m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) \\left( \\frac{\\alpha_c}{q^2 + \\kappa^2} + c_n + s \\gamma q^2 \\right)\n$$\nThis is the central expression to be evaluated numerically.\n\n**2. Derivation of the Sensitivity $\\frac{\\partial \\lambda(q)}{\\partial s}$**\nThe sensitivity of the eigenvalue to the meta-GGA parameter $s$ is its partial derivative $\\frac{\\partial \\lambda(q)}{\\partial s}$. We differentiate the expression for $\\lambda(q)$ with respect to $s$, treating all other parameters and $q$ as constant:\n$$\n\\frac{\\partial \\lambda(q)}{\\partial s} = \\frac{\\partial}{\\partial s} \\left[ 1 - m + m \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\right]\n$$\nThe only term dependent on $s$ is $m \\chi_0(q) s \\gamma q^2$. Its derivative with respect to $s$ is $m \\chi_0(q) \\gamma q^2$.\n$$\n\\frac{\\partial \\lambda}{\\partial s}(q) = m \\chi_0(q) (\\gamma q^2) = m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) (\\gamma q^2) = - \\frac{m \\gamma \\chi_{\\rm amp} q_0^2 q^2}{q^2 + q_0^2}\n$$\nThis expression will be evaluated at the specific wavevector $q^\\star$ that maximizes $|\\lambda(q)|$.\n\n**3. Computational Algorithm**\nFor each test case with its given set of parameters $\\{L, N, m, \\alpha_c, \\kappa, \\chi_{\\rm amp}, q_0, \\gamma, c_n, s\\}$:\n1.  Generate the discrete wavevector grid: $q_k = \\frac{2\\pi}{L}k$ for $k \\in \\{0, 1, \\dots, \\lfloor N/2 \\rfloor\\}$.\n2.  For each $q_k$ on the grid, calculate the eigenvalue $\\lambda(q_k)$ using the derived formula.\n3.  Calculate the absolute values $|\\lambda(q_k)|$ for all $k$.\n4.  The spectral radius is $\\rho = \\max_k |\\lambda(q_k)|$.\n5.  Find the index $k^\\star$ that yields this maximum value, i.e., $|\\lambda(q_{k^\\star})| = \\rho$. The maximizing wavevector is $q^\\star = q_{k^\\star}$.\n6.  Calculate the sensitivity $S = \\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$ using the derived formula evaluated at $q = q^\\star$.\n7.  The pair of values $(\\rho, S)$ is stored, and the process is repeated for all test cases.\n8.  The final results are formatted into a single string as specified.\nThis entire procedure is implemented in the provided Python code.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DFT SCF convergence problem for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.1},\n        # Case 2: larger meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.6},\n        # Case 3: negative meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': -0.2},\n        # Case 4: edge mixing close to instability\n        {'L': 20, 'N': 512, 'm': 0.9, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.3},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        L = case['L']\n        N = case['N']\n        m = case['m']\n        alpha_c = case['alpha_c']\n        kappa = case['kappa']\n        chi_amp = case['chi_amp']\n        q0 = case['q0']\n        gamma = case['gamma']\n        cn = case['cn']\n        s = case['s']\n\n        # 1. Generate the set of nonnegative Fourier modes q_k\n        k_indices = np.arange(0, N // 2 + 1)\n        q = (2 * np.pi / L) * k_indices\n\n        # 2. Derive and compute the eigenvalues lambda(q_k)\n        \n        # Model for susceptibility chi_0(q)\n        q_sq = q**2\n        chi0_q = -chi_amp * q0**2 / (q_sq + q0**2)\n        \n        # Model for Coulomb kernel v_c(q)\n        vc_q = alpha_c / (q_sq + kappa**2)\n        \n        # Expression for the eigenvalue lambda(q)\n        # lambda(q) = 1 - m + m * chi_0(q) * (v_c(q) + c_n + s * gamma * q^2)\n        lambda_q = 1.0 - m + m * chi0_q * (vc_q + cn + s * gamma * q_sq)\n\n        # Compute the spectral radius rho = max_k |lambda(q_k)|\n        abs_lambda_q = np.abs(lambda_q)\n        rho = np.max(abs_lambda_q)\n\n        # Identify the maximizing wavevector q_star\n        idx_star = np.argmax(abs_lambda_q)\n        q_star = q[idx_star]\n        q_star_sq = q_star**2\n\n        # Compute the sensitivity d(lambda)/ds at q_star\n        # d(lambda)/ds = m * chi_0(q) * gamma * q^2\n        # d(lambda)/ds = - m * gamma * chi_amp * q0^2 * q^2 / (q^2 + q0^2)\n        sensitivity = - (m * gamma * chi_amp * q0**2 * q_star_sq) / (q_star_sq + q0**2)\n        \n        # Append results for this case, formatted to six decimal places\n        results.append(f\"{rho:.6f}\")\n        results.append(f\"{sensitivity:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Calculating accurate forces and stresses is essential for geometry optimizations and molecular dynamics, but this task becomes more complex with meta-GGA functionals. The dependence of the kinetic energy density $\\tau$ on Kohn-Sham orbitals, which in turn depend on atomic positions, introduces additional Pulay terms in the expressions for forces and stresses that are absent in simpler functionals. This advanced exercise provides a hands-on experience in implementing a model system to isolate and quantify the Pulay error in the stress tensor, offering insight into the rigorous implementation required for reliable meta-GGA calculations. ",
            "id": "3465726",
            "problem": "You are tasked with implementing a simplified meta-Generalized Gradient Approximation (meta-GGA) stress and force calculation in a Projector Augmented-Wave (PAW)-like model and designing a stress-convergence test that isolates the error associated with neglecting the derivative of the kinetic-energy density with respect to atomic positions, denoted as the Pulay term $\\partial \\tau / \\partial \\mathbf{R}$, under volume-conserving strains. Your implementation must be a complete, runnable program as specified in the output instructions.\n\nStarting point and definitions. Use the following foundational framework from Kohn–Sham Density Functional Theory (DFT):\n\n- The total energy functional is $E[\\{ \\psi_i \\}] = \\int \\left( T_s[\\{ \\psi_i \\}] + v_{\\text{ext}}(\\mathbf{r}) \\rho(\\mathbf{r}) + E_{\\text{H}}[\\rho] + E_{\\text{xc}}[\\rho, \\nabla \\rho, \\tau] \\right) \\, d\\mathbf{r}$, where $T_s$ is the non-interacting kinetic energy, $v_{\\text{ext}}$ is the external potential, $E_{\\text{H}}$ is the Hartree energy, and $E_{\\text{xc}}$ is the exchange-correlation energy. The electron density is $\\rho(\\mathbf{r}) = \\sum_i |\\psi_i(\\mathbf{r})|^2$, and the kinetic-energy density is $\\tau(\\mathbf{r}) = \\sum_i |\\nabla \\psi_i(\\mathbf{r})|^2$.\n\n- In a meta-GGA, the exchange-correlation energy density depends on $\\rho(\\mathbf{r})$, its gradient $\\nabla \\rho(\\mathbf{r})$, and the kinetic-energy density $\\tau(\\mathbf{r})$, and can be represented as $e_{\\text{xc}}(\\mathbf{r}) = f\\left(\\rho(\\mathbf{r}), \\nabla \\rho(\\mathbf{r}), \\tau(\\mathbf{r})\\right)$ for a physically reasonable function $f$.\n\n- The stress tensor $\\boldsymbol{\\sigma}$ is obtained from the derivative of the total energy with respect to the strain tensor $\\boldsymbol{\\varepsilon}$ as per $\\sigma_{ij} = \\frac{1}{V} \\frac{\\partial E}{\\partial \\varepsilon_{ij}}$, with $V$ the volume. For a homogeneous deformation with deformation gradient $\\mathbf{F}$, $\\mathbf{F} = \\mathbf{I} + \\boldsymbol{\\varepsilon}$, the gradient operator transforms covariantly as $\\nabla_{\\mathbf{r}} = \\mathbf{F}^{-\\mathsf{T}} \\nabla_{\\mathbf{r}'}$ when mapping from the reference coordinate $\\mathbf{r}'$ to the deformed coordinate $\\mathbf{r} = \\mathbf{F} \\mathbf{r}'$.\n\n- The force on an atom at position $\\mathbf{R}$ is $\\mathbf{F} = - \\frac{\\partial E}{\\partial \\mathbf{R}}$, which includes both Hellmann–Feynman and Pulay contributions when the basis set or projector functions depend on $\\mathbf{R}$.\n\nModel system. Implement a single normalized Gaussian Kohn–Sham orbital $\\psi(\\mathbf{r})$ in a periodic cube of side $L$ in atomic units:\n\n- Let the reference unit cell be a cube with side $L$ and volume $V = L^3$. Use $L = 10$ in atomic units (Bohr).\n\n- Place the orbital at the reference center $\\mathbf{R}_0 = (L/2, L/2, L/2)$.\n\n- Define the normalized orbital as $\\psi(\\mathbf{r}) = \\left(\\pi \\sigma^2\\right)^{-3/4} \\exp\\left(-\\frac{|\\mathbf{r} - \\mathbf{R}|^2}{2\\sigma^2}\\right)$, where $\\mathbf{R}$ is the atomic center in the deformed configuration and $\\sigma$ is the width parameter. The density is $\\rho(\\mathbf{r}) = |\\psi(\\mathbf{r})|^2$ and the gradient of the orbital in deformed coordinates is $\\nabla_{\\mathbf{r}} \\psi(\\mathbf{r}) = -\\frac{\\mathbf{r}-\\mathbf{R}}{\\sigma^2} \\psi(\\mathbf{r})$, yielding $\\nabla_{\\mathbf{r}} \\rho(\\mathbf{r}) = 2\\psi(\\mathbf{r}) \\nabla_{\\mathbf{r}} \\psi(\\mathbf{r})$ and the smooth kinetic-energy density $\\tau_{\\text{smooth}}(\\mathbf{r}) = |\\nabla_{\\mathbf{r}} \\psi(\\mathbf{r})|^2$.\n\n- Augmentation (PAW-like) contribution to the kinetic-energy density: $\\Delta \\tau(\\mathbf{r}) = A_{\\text{aug}} \\exp\\left( -\\left(\\frac{|\\mathbf{r} - \\mathbf{R}_{\\text{aug}}|}{r_c}\\right)^2 \\right)$, where $A_{\\text{aug}}$ is an amplitude and $r_c$ is a characteristic radius. The total kinetic-energy density is $\\tau(\\mathbf{r}) = \\tau_{\\text{smooth}}(\\mathbf{r}) + \\Delta \\tau(\\mathbf{r})$.\n\n- For meta-GGA variables, use the reduced gradient $s(\\mathbf{r}) = \\frac{|\\nabla \\rho(\\mathbf{r})|}{2 k_F(\\mathbf{r}) \\rho(\\mathbf{r})}$ with $k_F(\\mathbf{r}) = \\left(3 \\pi^2 \\rho(\\mathbf{r})\\right)^{1/3}$, the von Weizsäcker kinetic-energy density $\\tau_W(\\mathbf{r}) = \\frac{|\\nabla \\rho(\\mathbf{r})|^2}{8 \\rho(\\mathbf{r})}$, and the uniform-gas kinetic-energy density $\\tau_{\\text{unif}}(\\mathbf{r}) = \\frac{3}{10}\\left(3\\pi^2\\right)^{2/3} \\rho(\\mathbf{r})^{5/3}$. Define the iso-orbital indicator $\\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})}$.\n\n- Use the following physically reasonable meta-GGA test exchange-correlation energy density:\n$$\ne_{\\text{xc}}(\\mathbf{r}) = A_x \\, \\rho(\\mathbf{r})^{4/3}\\, \\left(1 + B\\, s(\\mathbf{r})^2\\right)\\, \\exp\\left(- C\\, \\alpha(\\mathbf{r})\\right),\n$$\nwhere $A_x = -\\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3}$ (Local Density Approximation exchange prefactor), $B = 0.2$, and $C = 0.5$. All quantities are in atomic units. The total exchange-correlation energy for this model is $E_{\\text{xc}} = \\int e_{\\text{xc}}(\\mathbf{r}) \\, d\\mathbf{r}$.\n\nDeformation and coordinate transformation. Consider volume-conserving homogeneous strains:\n\n- Uniaxial volume-conserving strain parameterized by $\\varepsilon$ with deformation gradient $\\mathbf{F}(\\varepsilon) = \\operatorname{diag}(1+\\varepsilon, (1+\\varepsilon)^{-1}, 1)$, for which $\\det \\mathbf{F} = 1$.\n\n- Simple shear with parameter $\\gamma$ and $\\mathbf{F}(\\gamma) = \\begin{pmatrix} 1 & \\gamma & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}$, for which $\\det \\mathbf{F} = 1$.\n\nUnder deformation $\\mathbf{F}$, map reference grid points $\\mathbf{r}'$ to deformed coordinates $\\mathbf{r} = \\mathbf{F} \\mathbf{r}'$, and set the deformed atomic center for the orbital as $\\mathbf{R} = \\mathbf{F} \\mathbf{R}_0$ to preserve fractional coordinates. The covariant gradient relation yields $\\nabla_{\\mathbf{r}}$ fields consistently with the deformation. Use a uniform grid and numerical quadrature with the deformed-field evaluation and the unchanged volume element $dV = \\frac{V}{N^3}$ since $\\det \\mathbf{F} = 1$.\n\nPulay-error isolation. Compute two stress estimates to isolate the error associated with neglecting $\\partial \\tau / \\partial \\mathbf{R}$:\n\n- Pulay-free: Both the orbital center and augmentation center follow the deformation, i.e., $\\mathbf{R}_{\\text{aug}} = \\mathbf{F} \\mathbf{R}_0$, and all gradients and $\\tau$ are evaluated covariantly in deformed coordinates.\n\n- Pulay-contaminated: The orbital center follows the deformation, but the augmentation center is frozen at $\\mathbf{R}_{\\text{aug}} = \\mathbf{R}_0$, i.e., it does not follow $\\mathbf{F}$, thereby neglecting the implicit $\\partial \\tau / \\partial \\mathbf{R}$ contribution from the augmentation part under strain.\n\nThe stress components are estimated by symmetric finite differences of the energy with respect to the strain parameters:\n$$\n\\sigma_{xx} \\approx \\frac{E(\\varepsilon) - E(-\\varepsilon)}{2 \\varepsilon V}, \\quad \\sigma_{xy} \\approx \\frac{E(\\gamma) - E(-\\gamma)}{2 \\gamma V}.\n$$\n\nForce calculation. At zero strain, compute the $x$-component of the force on the atomic center by symmetric finite differences with a small displacement $\\delta R$:\n$$\nF_x \\approx -\\frac{E(R_x + \\delta R) - E(R_x - \\delta R)}{2 \\delta R}.\n$$\nCompute this once in the Pulay-free mode (both orbital and augmentation centers move together with $\\mathbf{R}$) and once in the Pulay-contaminated mode (the orbital center moves with $\\mathbf{R}$, but the augmentation center is frozen at $\\mathbf{R}_{\\text{aug}} = \\mathbf{R}_0$). Report the magnitude of the difference between the two $x$-component forces to quantify the Pulay-force error.\n\nNumerical and physical units. All computations must be performed in atomic units. Report stresses in Hartree per Bohr cubed and forces in Hartree per Bohr. Use angles in radians implicitly as appropriate.\n\nTest suite. Your program must implement the above and evaluate the following test cases, which vary grid resolution and orbital/augmentation parameters to assess convergence and edge behaviors. For each case, set:\n\n- Cell side $L = 10$.\n- Strain parameters $\\varepsilon = 10^{-3}$ and $\\gamma = 10^{-3}$.\n- Force displacement $\\delta R = 10^{-3}$.\n- The orbital center $\\mathbf{R}_0 = (L/2, L/2, L/2)$.\n\nProvide the parameter sets:\n\n1. $(N, \\sigma, r_c, A_{\\text{aug}}) = (24, 0.8, 1.0, 0.1)$.\n2. $(N, \\sigma, r_c, A_{\\text{aug}}) = (36, 0.8, 1.0, 0.1)$.\n3. $(N, \\sigma, r_c, A_{\\text{aug}}) = (40, 0.8, 1.0, 0.1)$.\n4. $(N, \\sigma, r_c, A_{\\text{aug}}) = (24, 0.5, 0.6, 0.2)$.\n5. $(N, \\sigma, r_c, A_{\\text{aug}}) = (24, 0.8, 1.0, 0.0)$, a boundary case with no augmentation to verify vanishing Pulay error.\n\nFor each test case, compute:\n\n- The absolute difference between Pulay-free and Pulay-contaminated $\\sigma_{xx}$ under volume-conserving uniaxial strain.\n- The absolute difference between Pulay-free and Pulay-contaminated $\\sigma_{xy}$ under shear.\n- The absolute difference in the $x$-component of the force at zero strain between Pulay-free and Pulay-contaminated modes.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, three floating-point numbers per test case corresponding to the three quantities above, flattened across the five cases:\n$[\\Delta \\sigma_{xx}^{(1)}, \\Delta \\sigma_{xy}^{(1)}, \\Delta F_x^{(1)}, \\Delta \\sigma_{xx}^{(2)}, \\Delta \\sigma_{xy}^{(2)}, \\Delta F_x^{(2)}, \\ldots, \\Delta \\sigma_{xx}^{(5)}, \\Delta \\sigma_{xy}^{(5)}, \\Delta F_x^{(5)}]$.\nAll outputs are in atomic units. The program must not require user input or external files. The numerical answers must be reported as floating-point numbers without unit symbols, and without any additional text beyond the specified single-line output.",
            "solution": "The user's request is to critically validate and, if valid, solve a problem in computational materials science. The problem requires the implementation of a simplified meta-Generalized Gradient Approximation (meta-GGA) calculation to analyze the \"Pulay error\" in stresses and forces.\n\n### Step 1: Problem Validation\n\nThe problem statement has been meticulously analyzed against the specified validation criteria.\n\n*   **Extraction of Givens**: All definitions, constants, and procedural steps have been extracted verbatim. This includes the definition of the single-Gaussian-orbital model system, the specific meta-GGA functional form involving the iso-orbital indicator $\\alpha(\\mathbf{r})$, the description of volume-conserving strains, the finite difference formulas for stress and force, and the five test cases with their respective parameters $(N, \\sigma, r_c, A_{\\text{aug}})$.\n\n*   **Validation Using Extracted Givens**:\n    1.  **Scientifically Grounded**: The problem is fundamentally sound. It is rooted in core principles of Kohn-Sham Density Functional Theory (DFT), including the definitions of electron density, kinetic-energy density, and the stress tensor's relation to energy derivatives. The use of a meta-GGA functional depending on $\\rho, \\nabla \\rho$, and $\\tau$ is a standard concept in advanced DFT. The PAW-like augmentation model for the kinetic-energy density and the concept of Pulay errors (incomplete basis-set-related errors) are well-established topics in the field. The provided functional form is a physically plausible, albeit simplified, model for a meta-GGA.\n    2.  **Well-Posed**: The problem is well-posed. It provides all necessary information—a specific functional, a model system, precise definitions for all variables, and a clear computational task. The objective is to compute the difference between two well-defined calculation modes (\"Pulay-free\" and \"Pulay-contaminated\"), which guarantees a unique and meaningful result for each test case.\n    3.  **Objective**: The problem is stated in precise, unbiased, and formal mathematical language. There are no subjective elements.\n    4.  **Completeness and Consistency**: The problem is self-contained. All required constants, equations, and numerical parameters ($L, \\varepsilon, \\gamma, \\delta R$) are explicitly provided. The logic is consistent; for instance, the case where the augmentation amplitude $A_{\\text{aug}} = 0$ must logically lead to a zero Pulay error, providing an internal consistency check. A minor ambiguity regarding the total energy $E$ versus the exchange-correlation energy $E_{\\text{xc}}$ is resolved by noting that for the requested *difference* calculation, all other energy terms are identical between the two modes and thus cancel, making the use of only $E_{\\text{xc}}$ the correct and intended approach.\n    5.  **Feasibility**: The model is a simplification of a real physical system, but the parameters and grid sizes (e.g., $N=40$) are computationally feasible. Analysis of the functional form confirms that numerical instabilities at the cell boundaries (where density $\\rho \\to 0$) are managed by the mathematical structure of the exchange-correlation energy density, which goes to zero, preventing divergences.\n\n*   **Verdict**: The problem is **valid**. It is a well-designed, scientifically sound, and computationally tractable exercise in a key area of computational materials science.\n\n### Step 2: Solution Design and Implementation\n\nThe solution involves creating a program to perform numerical integration of the meta-GGA energy density over a 3D grid, following the rules of coordinate transformation under strain.\n\n1.  **System Representation**: The system is a periodic cubic cell of side $L=10$ a.u. A uniform $N \\times N \\times N$ grid of points represents the reference configuration space.\n2.  **Core Calculation (`get_Exc`)**: A central function is designed to calculate the total exchange-correlation energy, $E_{\\text{xc}} = \\int e_{\\text{xc}}(\\mathbf{r}) d\\mathbf{r}$, which is approximated by a sum over the grid points: $E_{\\text{xc}} \\approx \\sum_i e_{\\text{xc}}(\\mathbf{r}_i) \\Delta V$. This function takes the deformation matrix $\\mathbf{F}$, the orbital center $\\mathbf{R}_{\\text{orb}}$, and the augmentation center $\\mathbf{R}_{\\text{aug}}$ as inputs.\n    *   **Coordinate Transformation**: For each reference grid point $\\mathbf{r}'_i$, the corresponding point in the deformed cell is found via $\\mathbf{r}_i = \\mathbf{F} \\mathbf{r}'_i$.\n    *   **Field Evaluation**: At each point $\\mathbf{r}_i$, the necessary fields are computed: the orbital $\\psi(\\mathbf{r}_i)$, density $\\rho(\\mathbf{r}_i)$, gradient $\\nabla \\psi(\\mathbf{r}_i)$, the smooth kinetic-energy density $\\tau_{\\text{smooth}}(\\mathbf{r}_i)$, and the augmentation density $\\Delta\\tau(\\mathbf{r}_i)$. The total kinetic-energy density is $\\tau(\\mathbf{r}_i) = \\tau_{\\text{smooth}}(\\mathbf{r}_i) + \\Delta\\tau(\\mathbf{r}_i)$.\n    *   **Meta-GGA Variables**: From the primary fields, the derived meta-GGA variables—the reduced gradient $s(\\mathbf{r}_i)$, von Weizsäcker kinetic energy $\\tau_W(\\mathbf{r}_i)$, uniform gas kinetic energy $\\tau_{\\text{unif}}(\\mathbf{r}_i)$, and the iso-orbital indicator $\\alpha(\\mathbf{r}_i)$—are calculated according to their definitions. Special care is taken to handle potential division-by-zero errors when the density $\\rho$ is small by adding a small positive constant.\n    *   **Energy Density and Integration**: The exchange-correlation energy density $e_{\\text{xc}}(\\mathbf{r}_i)$ is computed and summed over all grid points, multiplied by the volume element $\\Delta V = V/N^3$, to obtain $E_{\\text{xc}}$.\n3.  **Pulay Error Calculation**:\n    *   **Stress Error**: For both uniaxial and shear strains, the stress is computed using a symmetric finite difference formula. Two versions are calculated:\n        a.  **Pulay-free**: The energy is evaluated with both the orbital center and augmentation center transformed according to the strain ($\\mathbf{R}_{\\text{orb}} = \\mathbf{F} \\mathbf{R}_0$ and $\\mathbf{R}_{\\text{aug}} = \\mathbf{F} \\mathbf{R}_0$).\n        b.  **Pulay-contaminated**: The energy is evaluated with the orbital center transformed, but the augmentation center remains fixed at the reference position ($\\mathbf{R}_{\\text{orb}} = \\mathbf{F} \\mathbf{R}_0$ and $\\mathbf{R}_{\\text{aug}} = \\mathbf{R}_0$).\n        The absolute difference between the two resulting stress values ($\\sigma^{\\text{free}}$ and $\\sigma^{\\text{cont}}$) constitutes the Pulay stress error.\n    *   **Force Error**: A similar procedure is followed for the force calculation at zero strain. The energy is evaluated for small positive and negative displacements of the atom.\n        a.  **Pulay-free**: The orbital and augmentation centers move together ($\\mathbf{R}_{\\text{orb}} = \\mathbf{R}_{\\text{aug}} = \\mathbf{R}_0 \\pm \\delta\\mathbf{R}$).\n        b.  **Pulay-contaminated**: The orbital center moves, but the augmentation center is fixed ($\\mathbf{R}_{\\text{orb}} = \\mathbf{R}_0 \\pm \\delta\\mathbf{R}$, $\\mathbf{R}_{\\text{aug}} = \\mathbf{R}_0$).\n        The absolute difference between the two force components gives the Pulay force error.\n4.  **Implementation**: The algorithm is implemented in Python using the NumPy library for efficient, vectorized numerical operations on the grid. A class encapsulates the parameters and calculation logic for clarity and reusability across the test suite. The final program iterates through the five provided test cases, computes the three requested error quantities for each, and prints them in the specified format. The use of vectorized operations (e.g., `np.einsum` for coordinate transformation) is crucial for performance.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem as specified: implementing a simplified\n    meta-GGA stress and force calculation and performing a Pulay-error analysis.\n    \"\"\"\n\n    class MetaGGACalculator:\n        \"\"\"\n        A class to encapsulate the simplified meta-GGA calculation for a given set of parameters.\n        \"\"\"\n        def __init__(self, N, sigma, r_c, A_aug):\n            # Physical and numerical parameters from the test case\n            self.N = N\n            self.sigma = sigma\n            self.r_c = r_c\n            self.A_aug = A_aug\n\n            # Fixed parameters from the problem statement\n            self.L = 10.0\n            self.V = self.L**3\n            self.R0 = np.array([self.L / 2, self.L / 2, self.L / 2])\n            \n            self.eps = 1e-3\n            self.gam = 1e-3\n            self.dR = 1e-3\n\n            # Meta-GGA functional constants\n            self.Ax = -3.0 / 4.0 * (3.0 / np.pi)**(1.0 / 3.0)\n            self.B = 0.2\n            self.C = 0.5\n\n            # Numerical integration grid and volume element\n            self.dV_cell = self.V / self.N**3\n            # Use endpoint=False to represent a periodic cell grid starting at 0\n            grid_1d = np.linspace(0, self.L, self.N, endpoint=False)\n            X_ref, Y_ref, Z_ref = np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij')\n            self.r_ref = np.stack((X_ref, Y_ref, Z_ref)) # Shape (3, N, N, N)\n\n            # Pre-compute psi normalization constant\n            self.psi_norm = (np.pi * self.sigma**2)**(-0.75)\n            \n            # Small number to avoid division by zero or log(0)\n            self.TINY = 1e-40\n\n        def get_Exc(self, F, R_orb, R_aug):\n            \"\"\"\n            Calculates the total exchange-correlation energy for a given deformation\n            and atomic/augmentation positions.\n            \"\"\"\n            # Transform reference grid points to deformed coordinates using Einstein summation\n            r_def = np.einsum('ij,jklm->iklm', F, self.r_ref)\n            \n            # --- Field calculations on the grid ---\n            # Reshape centers for broadcasting over the grid\n            R_orb = R_orb.reshape(3, 1, 1, 1)\n            R_aug = R_aug.reshape(3, 1, 1, 1)\n\n            # Orbital and density\n            r_minus_R_orb = r_def - R_orb\n            r_minus_R_orb_sq_norm = np.sum(r_minus_R_orb**2, axis=0)\n            psi = self.psi_norm * np.exp(-r_minus_R_orb_sq_norm / (2 * self.sigma**2))\n            rho = psi**2\n            rho_safe = np.maximum(rho, self.TINY)\n\n            # Gradients and smooth kinetic energy density\n            grad_r_psi = -r_minus_R_orb / self.sigma**2 * psi\n            tau_smooth = np.sum(grad_r_psi**2, axis=0)\n\n            grad_r_rho = 2 * psi * grad_r_psi\n            norm_grad_r_rho_sq = np.sum(grad_r_rho**2, axis=0)\n            norm_grad_r_rho = np.sqrt(norm_grad_r_rho_sq)\n            \n            # Augmentation contribution to tau\n            r_minus_R_aug = r_def - R_aug\n            r_minus_R_aug_sq_norm = np.sum(r_minus_R_aug**2, axis=0)\n            delta_tau = self.A_aug * np.exp(-r_minus_R_aug_sq_norm / self.r_c**2)\n            \n            tau_total = tau_smooth + delta_tau\n            \n            # --- Meta-GGA variable calculations ---\n            kF = (3 * np.pi**2 * rho_safe)**(1.0/3.0)\n            s = norm_grad_r_rho / (2 * kF * rho_safe)\n            \n            tau_W = norm_grad_r_rho_sq / (8 * rho_safe)\n            tau_unif = (3.0/10.0) * (3 * np.pi**2)**(2.0/3.0) * rho_safe**(5.0/3.0)\n            \n            alpha = (tau_total - tau_W) / np.maximum(tau_unif, self.TINY)\n            \n            # --- Energy density and integration ---\n            exc_density = self.Ax * rho**(4.0/3.0) * (1 + self.B * s**2) * np.exp(-self.C * alpha)\n            \n            Exc = np.sum(exc_density) * self.dV_cell\n            \n            return Exc\n            \n        def calculate_pulay_errors(self):\n            \"\"\"\n            Computes the stress and force errors due to the frozen augmentation core.\n            \"\"\"\n            \n            # --- Uniaxial Stress (sigma_xx) Calculation ---\n            F_uniax_p = np.diag([1 + self.eps, 1 / (1 + self.eps), 1])\n            F_uniax_m = np.diag([1 - self.eps, 1 / (1 - self.eps), 1])\n            \n            R_p_orb = F_uniax_p @ self.R0\n            R_m_orb = F_uniax_m @ self.R0\n            \n            E_p_free = self.get_Exc(F_uniax_p, R_p_orb, R_p_orb)\n            E_m_free = self.get_Exc(F_uniax_m, R_m_orb, R_m_orb)\n            sigma_xx_free = (E_p_free - E_m_free) / (2 * self.eps * self.V)\n            \n            E_p_cont = self.get_Exc(F_uniax_p, R_p_orb, self.R0)\n            E_m_cont = self.get_Exc(F_uniax_m, R_m_orb, self.R0)\n            sigma_xx_cont = (E_p_cont - E_m_cont) / (2 * self.eps * self.V)\n\n            delta_sigma_xx = np.abs(sigma_xx_free - sigma_xx_cont)\n\n            # --- Shear Stress (sigma_xy) Calculation ---\n            F_shear_p = np.array([[1, self.gam, 0], [0, 1, 0], [0, 0, 1]])\n            F_shear_m = np.array([[1, -self.gam, 0], [0, 1, 0], [0, 0, 1]])\n\n            R_p_orb = F_shear_p @ self.R0\n            R_m_orb = F_shear_m @ self.R0\n\n            E_p_free = self.get_Exc(F_shear_p, R_p_orb, R_p_orb)\n            E_m_free = self.get_Exc(F_shear_m, R_m_orb, R_m_orb)\n            sigma_xy_free = (E_p_free - E_m_free) / (2 * self.gam * self.V)\n\n            E_p_cont = self.get_Exc(F_shear_p, R_p_orb, self.R0)\n            E_m_cont = self.get_Exc(F_shear_m, R_m_orb, self.R0)\n            sigma_xy_cont = (E_p_cont - E_m_cont) / (2 * self.gam * self.V)\n            \n            delta_sigma_xy = np.abs(sigma_xy_free - sigma_xy_cont)\n            \n            # --- Force (F_x) Calculation ---\n            F_ident = np.identity(3)\n            disp_vec = np.array([self.dR, 0, 0])\n            \n            R_p_orb = self.R0 + disp_vec\n            R_m_orb = self.R0 - disp_vec\n            \n            E_p_free = self.get_Exc(F_ident, R_p_orb, R_p_orb)\n            E_m_free = self.get_Exc(F_ident, R_m_orb, R_m_orb)\n            Fx_free = -(E_p_free - E_m_free) / (2 * self.dR)\n\n            E_p_cont = self.get_Exc(F_ident, R_p_orb, self.R0)\n            E_m_cont = self.get_Exc(F_ident, R_m_orb, self.R0)\n            Fx_cont = -(E_p_cont - E_m_cont) / (2 * self.dR)\n            \n            delta_Fx = np.abs(Fx_free - Fx_cont)\n            \n            return delta_sigma_xx, delta_sigma_xy, delta_Fx\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (24, 0.8, 1.0, 0.1),\n        (36, 0.8, 1.0, 0.1),\n        (40, 0.8, 1.0, 0.1),\n        (24, 0.5, 0.6, 0.2),\n        (24, 0.8, 1.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        calculator = MetaGGACalculator(*case)\n        delta_s_xx, delta_s_xy, delta_Fx = calculator.calculate_pulay_errors()\n        results.extend([delta_s_xx, delta_s_xy, delta_Fx])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}