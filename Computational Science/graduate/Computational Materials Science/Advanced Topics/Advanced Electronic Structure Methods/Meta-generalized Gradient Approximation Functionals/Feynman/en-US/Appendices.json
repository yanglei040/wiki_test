{
    "hands_on_practices": [
        {
            "introduction": "Meta-GGA functionals achieve higher accuracy by incorporating the Kohn-Sham kinetic energy density, $\\tau(\\mathbf{r})$, to better describe diverse chemical environments. A key innovation is the iso-orbital indicator, $\\alpha(\\mathbf{r})$, which helps the functional distinguish regions dominated by a single orbital (like covalent bonds, where $\\alpha \\approx 0$) from regions resembling a uniform electron gas (where $\\alpha \\approx 1$). This foundational exercise guides you through the derivation of this property for the important limiting case of a single-orbital system, providing a concrete understanding of how $\\alpha$ works .",
            "id": "163484",
            "problem": "In Density-Functional Theory (DFT), meta-Generalized Gradient Approximation (meta-GGA) exchange-correlation functionals improve upon GGAs by including the Kohn-Sham kinetic energy density, $\\tau(\\mathbf{r})$, as an additional ingredient besides the electron density $n(\\mathbf{r})$ and its gradient $\\nabla n(\\mathbf{r})$.\n\nThe total electron density and kinetic energy density for a system of $N$ electrons are given by summations over the occupied Kohn-Sham orbitals $\\psi_i(\\mathbf{r})$:\n$$ n(\\mathbf{r}) = \\sum_{i=1}^{N} f_i |\\psi_i(\\mathbf{r})|^2 $$\n$$ \\tau(\\mathbf{r}) = \\frac{1}{2} \\sum_{i=1}^{N} f_i |\\nabla\\psi_i(\\mathbf{r})|^2 $$\nwhere $f_i$ are the occupation numbers.\n\nA key dimensionless quantity used in modern meta-GGAs like the Strongly Constrained and Appropriately Normed (SCAN) functional is the iso-orbital indicator, $\\alpha(\\mathbf{r})$. It is defined as:\n$$ \\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_W(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})} $$\nHere, $\\tau_W(\\mathbf{r})$ is the von Weizsäcker kinetic energy density, which is the exact kinetic energy density for any one-electron system, given by:\n$$ \\tau_W(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|^2}{8n(\\mathbf{r})} $$\nAnd $\\tau_{\\text{unif}}(\\mathbf{r})$ is the kinetic energy density of a uniform electron gas of density $n(\\mathbf{r})$:\n$$ \\tau_{\\text{unif}}(\\mathbf{r}) = C_F n(\\mathbf{r})^{5/3} $$\nwhere $C_F$ is a constant related to the Fermi momentum. The value of $\\alpha$ helps distinguish different chemical environments: $\\alpha=0$ indicates single-orbital regions (like covalent bonds or atomic tails), while $\\alpha=1$ corresponds to the uniform electron gas.\n\nConsider a generic electronic system that can be described by a single, real, doubly-occupied Kohn-Sham orbital $\\psi(\\mathbf{r})$. Assuming the orbital and its gradient are non-zero, calculate the value of the iso-orbital indicator $\\alpha(\\mathbf{r})$ for this system.",
            "solution": "1. Electron density for a doubly-occupied real orbital $\\psi(\\mathbf r)$:\n$$n(\\mathbf r)=2|\\psi(\\mathbf r)|^2.$$\n2. Kohn–Sham kinetic energy density:\n$$\\tau(\\mathbf r)=\\frac{1}{2}\\sum_i f_i|\\nabla\\psi_i|^2 = \\frac{1}{2}\\cdot 2\\,|\\nabla\\psi|^2 =|\\nabla\\psi|^2.$$\n3. Gradient of the density:\n$$\\nabla n= \\nabla\\bigl(2\\psi^2\\bigr)=4\\,\\psi\\,\\nabla\\psi.$$\n4. von Weizsäcker kinetic energy density:\n$$\\tau_W(\\mathbf r)=\\frac{|\\nabla n|^2}{8\\,n} =\\frac{(4\\psi\\,\\nabla\\psi)^2}{8\\cdot2\\psi^2} =\\frac{16\\psi^2|\\nabla\\psi|^2}{16\\psi^2} =|\\nabla\\psi|^2.$$\n5. Difference entering the iso-orbital indicator:\n$$\\tau-\\tau_W=|\\nabla\\psi|^2-|\\nabla\\psi|^2=0.$$\n6. Therefore\n$$\\alpha(\\mathbf r) =\\frac{\\tau-\\tau_W}{\\tau_{\\text{unif}}} =\\frac{0}{\\tau_{\\text{unif}}}=0.$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "The design of robust and physically meaningful energy functionals must obey fundamental invariance principles. One such principle is that the total energy and forces should be invariant to a uniform shift in the kinetic energy density, $\\tau(\\mathbf{r}) \\to \\tau(\\mathbf{r}) + \\delta$, as this shift is an arbitrary choice of energy zero. This hands-on coding practice demonstrates how to construct a numerical test to diagnose this \"gauge invariance,\" contrasting a properly designed functional that depends on the gradient of $\\tau(\\mathbf{r})$ with a sensitive one that depends directly on $\\tau(\\mathbf{r})$ .",
            "id": "3465779",
            "problem": "Consider the construction and validation of a meta-Generalized Gradient Approximation (meta-GGA) type model within Density Functional Theory (DFT), where the exchange-correlation energy density depends on the electron density and the kinetic energy density. Let the computational domain be one-dimensional and periodic with length $L$, discretized uniformly into $N$ grid points with grid spacing $\\Delta x = L/N$. Define a model electron density $n(x)$ as a superposition of Gaussian components centered at positions $R_i$ with widths $\\sigma_i$ and weights $w_i$, given by\n$$\nn(x) = \\sum_{i=1}^{M} \\frac{w_i}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left(-\\frac{(x - R_i)^2}{2\\sigma_i^2}\\right),\n$$\nwhere periodic boundary conditions are applied by interpreting $x$ on a circle of circumference $L$. The gradients are computed with periodic boundary conditions via central finite differences.\n\nDefine the model orbital kinetic energy density $\\tau(x)$ using a mixture of the Thomas-Fermi term and the Weizsäcker term,\n$$\n\\tau(x) = c_{\\mathrm{TF}} n(x)^{5/3} + \\lambda_{\\mathrm{W}} \\frac{|\\nabla n(x)|^2}{8\\left(n(x) + n_{\\mathrm{floor}}\\right)},\n$$\nwhere $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$, $\\lambda_{\\mathrm{W}}$ is a dimensionless mixing parameter, and $n_{\\mathrm{floor}}$ is a small positive floor added to the denominator to prevent division by zero. The gradient $|\\nabla n(x)|$ is computed by periodic central differences.\n\nConstruct two meta-GGA-like energy densities:\n1. A gauge-sensitive form,\n$$\ne_{\\mathrm{sens}}(x) = a \\frac{\\tau(x)}{n(x) + n_{\\mathrm{floor}}},\n$$\n2. A gauge-invariant-to-uniform-shifts form that depends only on the spatial variation of $\\tau(x)$,\n$$\ne_{\\mathrm{inv}}(x) = a \\frac{|\\nabla \\tau(x)|^2}{\\left(n(x) + n_{\\mathrm{floor}}\\right)^q},\n$$\nwhere $a$ and $q$ are dimensionless parameters, and $\\nabla \\tau(x)$ is computed via periodic central differences. The total energy is\n$$\nE = \\int_0^L e(x)\\, dx,\n$$\nwith the integral evaluated numerically via the discrete sum $E \\approx \\sum_{j=0}^{N-1} e(x_j)\\,\\Delta x$.\n\nDefine a uniform perturbation of the kinetic energy density input as\n$$\n\\tau(x) \\rightarrow \\tau'(x) = \\tau(x) + \\delta,\n$$\nwhere $\\delta$ is a small constant. Under an ideal physical construction, a uniform shift in $\\tau(x)$ should not alter physically measurable totals if the functional is gauge-invariant to such shifts; otherwise, diagnostic changes appear.\n\nDefine the force on a Gaussian center $R_i$ as the negative derivative of the total energy with respect to $R_i$,\n$$\nF_i = -\\frac{\\partial E}{\\partial R_i}.\n$$\nCompute forces numerically via a symmetric finite-difference approximation with a displacement $h$,\n$$\nF_i \\approx -\\frac{E(R_i + h) - E(R_i - h)}{2h},\n$$\nholding all other parameters fixed.\n\nYour task is to write a program that, for each test case specified below, computes the total energy and forces for both the unperturbed $\\tau(x)$ and the perturbed $\\tau'(x) = \\tau(x) + \\delta$, and then assesses invariance by checking whether the absolute energy difference is less than or equal to a threshold $\\varepsilon_E$ and the maximum absolute difference in force components is less than or equal to a threshold $\\varepsilon_F$.\n\nUse the following fixed parameter values unless overridden in a test case:\n- $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$,\n- $\\lambda_{\\mathrm{W}} = 1$,\n- $n_{\\mathrm{floor}} = 10^{-3}$,\n- $a = 0.5$,\n- $q = 1$,\n- Finite-difference force displacement $h = 10^{-3}$.\n\nTest suite:\n- Case 1 (gauge-sensitive, happy path): $L = 10$, $N = 4096$, $M = 2$, $R = [3.2, 6.9]$, $\\sigma = [0.25, 0.25]$, $w = [1.0, 0.8]$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-6}$, $\\varepsilon_F = 10^{-6}$, energy density $e_{\\mathrm{sens}}(x)$.\n- Case 2 (gauge-invariant-to-uniform-shifts): same as Case 1 but use $e_{\\mathrm{inv}}(x)$ with $q = 1$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-8}$, $\\varepsilon_F = 10^{-8}$.\n- Case 3 (zero perturbation boundary check): same as Case 1 but with $\\delta = 0$, $\\varepsilon_E = 10^{-12}$, $\\varepsilon_F = 10^{-12}$, energy density $e_{\\mathrm{sens}}(x)$.\n- Case 4 (edge positions near boundaries, gauge-invariant-to-uniform-shifts): $L = 10$, $N = 2048$, $M = 2$, $R = [0.1, 9.9]$, $\\sigma = [0.20, 0.30]$, $w = [1.2, 0.6]$, $\\delta = 10^{-3}$, $\\varepsilon_E = 10^{-8}$, $\\varepsilon_F = 10^{-8}$, energy density $e_{\\mathrm{inv}}(x)$, $q = 1$.\n\nFor each test case, output two boolean values: the first indicating whether the energy is invariant within the specified threshold, and the second indicating whether all force components are invariant within the specified threshold. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n[\\text{E\\_inv}^{(1)}, \\text{F\\_inv}^{(1)}, \\text{E\\_inv}^{(2)}, \\text{F\\_inv}^{(2)}, \\text{E\\_inv}^{(3)}, \\text{F\\_inv}^{(3)}, \\text{E\\_inv}^{(4)}, \\text{F\\_inv}^{(4)}],\n$$\nwhere $\\text{E\\_inv}^{(k)}$ and $\\text{F\\_inv}^{(k)}$ are the energy and force invariance booleans for case $k$. No physical units are required; all quantities are treated as dimensionless. Angles do not appear. Percentages are not used.",
            "solution": "The problem statement is valid. It presents a well-posed computational task grounded in the principles of Density Functional Theory (DFT) and numerical analysis. All required definitions, parameters, and procedures are specified, and there are no scientific or logical contradictions.\n\nThe core of the problem is to investigate the \"gauge invariance\" of two model meta-Generalized Gradient Approximation (meta-GGA) energy functionals with respect to a uniform shift in the kinetic energy density, $\\tau(x)$. The solution involves implementing a numerical model on a one-dimensional periodic grid and calculating changes in total energy and inter-particle forces under this perturbation.\n\nThe algorithmic design follows these steps:\n\n1.  **Domain Discretization**: The continuous one-dimensional periodic domain of length $L$ is discretized into $N$ grid points $x_j = j \\Delta x$ for $j = 0, \\dots, N-1$, where the grid spacing is $\\Delta x = L/N$.\n\n2.  **Electron Density Calculation**: The electron density $n(x)$ is constructed as a superposition of $M$ Gaussian functions. For periodic boundary conditions, the distance $(x - R_i)$ between a grid point $x$ and a Gaussian center $R_i$ is calculated using the minimum image convention. The periodic distance $d_p(x, R_i)$ on a circle of circumference $L$ is given by $d_p = d - L \\cdot \\text{round}(d/L)$, where $d = x - R_i$. The density at each grid point $x_j$ is then computed using the formula:\n    $$\n    n(x_j) = \\sum_{i=1}^{M} \\frac{w_i}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left(-\\frac{d_p(x_j, R_i)^2}{2\\sigma_i^2}\\right)\n    $$\n\n3.  **Gradient Calculation**: Spatial gradients, such as $\\nabla n(x)$ and $\\nabla \\tau(x)$, are approximated numerically using the second-order central finite-difference scheme with periodic boundary conditions. For a function $f(x)$ discretized on the grid as $f_j = f(x_j)$, the derivative at point $j$ is:\n    $$\n    (\\nabla f)_j \\approx \\frac{f_{j+1} - f_{j-1}}{2\\Delta x}\n    $$\n    The indices are handled periodically, i.e., $f_N = f_0$ and $f_{-1} = f_{N-1}$. This is efficiently implemented using array-rolling operations.\n\n4.  **Kinetic Energy Density Calculation**: The model kinetic energy density, $\\tau(x)$, is a sum of the Thomas-Fermi term, which is exact for a uniform electron gas, and the Weizsäcker term, which is exact for single-orbital systems and provides a leading-order gradient correction. It is computed at each grid point as:\n    $$\n    \\tau(x_j) = c_{\\mathrm{TF}} n(x_j)^{5/3} + \\lambda_{\\mathrm{W}} \\frac{|\\nabla n(x_j)|^2}{8\\left(n(x_j) + n_{\\mathrm{floor}}\\right)}\n    $$\n    where $c_{\\mathrm{TF}} = \\frac{3}{10}(3\\pi^2)^{2/3}$. The term $n_{\\mathrm{floor}}$ is a small positive constant added to the denominator to ensure numerical stability in regions where $n(x)$ approaches zero.\n\n5.  **Total Energy Calculation**: The program implements two forms of the meta-GGA-like energy density, $e(x)$.\n    *   The gauge-sensitive form, $e_{\\mathrm{sens}}(x) = a \\frac{\\tau(x)}{n(x) + n_{\\mathrm{floor}}}$, explicitly depends on the absolute value of $\\tau(x)$. A uniform shift $\\tau(x) \\to \\tau(x) + \\delta$ will directly change $e_{\\mathrm{sens}}(x)$, leading to a change in the total energy.\n    *   The gauge-invariant form, $e_{\\mathrm{inv}}(x) = a \\frac{|\\nabla \\tau(x)|^2}{(n(x) + n_{\\mathrm{floor}})^q}$, depends only on the gradient of $\\tau(x)$. Since the gradient of a constant is zero, $\\nabla(\\tau(x) + \\delta) = \\nabla\\tau(x)$, this functional form is, by construction, invariant to uniform shifts in $\\tau(x)$.\n\n    The total energy $E$ is calculated by numerically integrating the appropriate energy density $e(x)$ over the domain using a simple Riemann sum:\n    $$\n    E = \\int_0^L e(x)\\, dx \\approx \\sum_{j=0}^{N-1} e(x_j)\\,\\Delta x\n    $$\n\n6.  **Force Calculation**: The force $F_i$ on the center of the $i$-th Gaussian, $R_i$, is the negative gradient of the total energy, $F_i = -\\frac{\\partial E}{\\partial R_i}$. This derivative is approximated numerically using a symmetric finite-difference scheme with a small displacement $h$:\n    $$\n    F_i \\approx -\\frac{E(R_1, \\dots, R_i + h, \\dots, R_M) - E(R_1, \\dots, R_i - h, \\dots, R_M)}{2h}\n    $$\n    This requires re-evaluating the total energy $E$ twice for each force component $F_i$.\n\n7.  **Invariance Analysis**: For each test case, the program performs the following sequence:\n    a. Calculate the reference total energy $E_0$ and forces $\\vec{F}_0$ using the unperturbed kinetic energy density $\\tau(x)$.\n    b. Calculate the perturbed total energy $E_\\delta$ and forces $\\vec{F}_\\delta$ using $\\tau'(x) = \\tau(x) + \\delta$.\n    c. Assess energy invariance by checking if the absolute difference $|E_\\delta - E_0|$ is less than or equal to the specified threshold $\\varepsilon_E$.\n    d. Assess force invariance by checking if the maximum absolute difference across all force components, $\\max_i |F_{i, \\delta} - F_{i, 0}|$, is less than or equal to the threshold $\\varepsilon_F$.\n    e. The results, two boolean values per test case, are collected and formatted for the final output.\n\nThis comprehensive procedure allows for a direct numerical test of the gauge-invariance properties designed into the model functionals.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n\n    # Fixed parameters as defined in the problem statement\n    C_TF = (3.0 / 10.0) * (3.0 * np.pi**2)**(2.0 / 3.0)\n    LAMBDA_W = 1.0\n    N_FLOOR = 1e-3\n    A_PARAM = 0.5\n    H_FORCE = 1e-3\n\n    # Test cases from the problem statement\n    test_cases = [\n        {'case': 1, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 1e-3, 'eps_E': 1e-6, 'eps_F': 1e-6, 'type': 'sens', 'q': 1.0},\n        {'case': 2, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 1e-3, 'eps_E': 1e-8, 'eps_F': 1e-8, 'type': 'inv', 'q': 1.0},\n        {'case': 3, 'L': 10, 'N': 4096, 'M': 2, 'R': [3.2, 6.9], 'sigma': [0.25, 0.25], 'w': [1.0, 0.8],\n         'delta': 0.0, 'eps_E': 1e-12, 'eps_F': 1e-12, 'type': 'sens', 'q': 1.0},\n        {'case': 4, 'L': 10, 'N': 2048, 'M': 2, 'R': [0.1, 9.9], 'sigma': [0.20, 0.30], 'w': [1.2, 0.6],\n         'delta': 1e-3, 'eps_E': 1e-8, 'eps_F': 1e-8, 'type': 'inv', 'q': 1.0},\n    ]\n\n    def get_total_energy(params, R_vec, tau_shift):\n        \"\"\"\n        Computes the total energy for a given set of parameters and a tau shift.\n        \"\"\"\n        L, N, M, sigma, w = params['L'], params['N'], params['M'], params['sigma'], params['w']\n        q, e_type = params['q'], params['type']\n        \n        dx = L / N\n        x_grid = np.linspace(0, L, N, endpoint=False)\n\n        # 1. Calculate electron density n(x) with periodic boundary conditions\n        n = np.zeros(N)\n        for i in range(M):\n            dist = x_grid - R_vec[i]\n            periodic_dist = dist - L * np.round(dist / L)\n            gaussian = (w[i] / (np.sqrt(2 * np.pi) * sigma[i])) * \\\n                       np.exp(-periodic_dist**2 / (2 * sigma[i]**2))\n            n += gaussian\n\n        n_plus_floor = n + N_FLOOR\n\n        # 2. Calculate gradient of n(x)\n        grad_n = (np.roll(n, -1) - np.roll(n, 1)) / (2 * dx)\n\n        # 3. Calculate kinetic energy density tau(x)\n        term_tf = C_TF * n**(5.0 / 3.0)\n        term_w = LAMBDA_W * grad_n**2 / (8.0 * n_plus_floor)\n        tau = term_tf + term_w\n        \n        # 4. Apply perturbation\n        tau_perturbed = tau + tau_shift\n\n        # 5. Calculate energy density e(x)\n        if e_type == 'sens':\n            e_density = A_PARAM * tau_perturbed / n_plus_floor\n        elif e_type == 'inv':\n            grad_tau_perturbed = (np.roll(tau_perturbed, -1) - np.roll(tau_perturbed, 1)) / (2 * dx)\n            e_density = A_PARAM * grad_tau_perturbed**2 / (n_plus_floor**q)\n        else:\n            raise ValueError(\"Unknown energy density type\")\n\n        # 6. Calculate total energy E\n        total_energy = np.sum(e_density) * dx\n        return total_energy\n\n    def calculate_forces(params, R_vec, tau_shift):\n        \"\"\"\n        Calculates forces on each Gaussian center via finite differences.\n        \"\"\"\n        M = params['M']\n        forces = np.zeros(M)\n        for i in range(M):\n            R_plus = np.copy(R_vec)\n            R_plus[i] += H_FORCE\n            E_plus = get_total_energy(params, R_plus, tau_shift)\n\n            R_minus = np.copy(R_vec)\n            R_minus[i] -= H_FORCE\n            E_minus = get_total_energy(params, R_minus, tau_shift)\n\n            forces[i] = -(E_plus - E_minus) / (2 * H_FORCE)\n        return forces\n\n    results = []\n    for params in test_cases:\n        R_vec = np.array(params['R'])\n        \n        # Calculate for unperturbed case (tau_shift = 0)\n        E0 = get_total_energy(params, R_vec, 0.0)\n        F0 = calculate_forces(params, R_vec, 0.0)\n\n        # Calculate for perturbed case (tau_shift = delta)\n        delta = params['delta']\n        Ed = get_total_energy(params, R_vec, delta)\n        Fd = calculate_forces(params, R_vec, delta)\n\n        # Perform invariance checks\n        is_E_inv = np.abs(Ed - E0) = params['eps_E']\n        is_F_inv = np.max(np.abs(Fd - F0)) = params['eps_F']\n\n        results.extend([is_E_inv, is_F_inv])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While the added ingredients of meta-GGA functionals can significantly improve physical accuracy, they also introduce greater mathematical complexity, which can lead to numerical instabilities during the Self-Consistent Field (SCF) cycle. Understanding the origin of these instabilities is crucial for developing robust computational methods. This advanced exercise uses a linearized response model to analyze SCF convergence, demonstrating how instabilities can arise from the functional's sensitivity to the kinetic energy density, specifically the term $\\frac{\\partial v_{xc}}{\\partial \\tau}$ .",
            "id": "3465724",
            "problem": "Consider a one-dimensional periodic system in atomic units in the framework of Kohn–Sham Density Functional Theory (DFT) with a Self-Consistent Field (SCF) iteration. The exchange–correlation potential is modeled by a meta-Generalized Gradient Approximation (meta-GGA), which depends on both the electron density $n(x)$ and the kinetic energy density $\\tau(x)$. We study strongly inhomogeneous charge density waves, linearize the SCF density update map around a stationary solution, and analyze the spectral radius of the Jacobian to determine convergence under linear mixing.\n\nBase definitions and assumptions:\n- The SCF update uses linear mixing with mixing parameter $m \\in (0,1)$ on the density. For a small density perturbation $\\delta n(x)$, its Fourier component at wavevector $q$ is denoted $\\delta n(q)$.\n- The induced density change under the Kohn–Sham response is given by $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$, where $\\chi_0(q)$ is the static noninteracting density–density response (susceptibility), and $\\delta v_{\\mathrm{eff}}(q)$ is the effective potential variation consisting of the Hartree (Coulomb) contribution and the exchange–correlation contribution.\n- The effective potential variation is $\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)$, where $v_c(q)$ is the screened Coulomb kernel and $\\delta v_{xc}(q)$ is the exchange–correlation variation.\n- For a meta-GGA, the exchange–correlation variation satisfies the chain rule $\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)\\delta n(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$ evaluated at the stationary solution, where $\\frac{\\partial v_{xc}}{\\partial n}$ and $\\frac{\\partial v_{xc}}{\\partial \\tau}$ are treated as constants with respect to small perturbations around the stationary state.\n- For a charge-density wave with Fourier component $q$, the kinetic-energy-density variation is modeled as $\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta n(q)$, where $\\gamma0$ is a model coefficient capturing the scaling of $\\tau$ with spatial gradients in the Kohn–Sham orbitals.\n\nThe linear mixing update for the density is $ \\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q) $. This defines a linearized map whose Jacobian $J$ is diagonal in the Fourier basis $\\{q\\}$, with eigenvalues $\\lambda(q)$ depending on the system parameters. Convergence of the SCF iteration under linear mixing occurs when the spectral radius $\\rho = \\max_q |\\lambda(q)|$ satisfies $ \\rho  1 $.\n\nModel kernels to be used in this problem:\n- Use a Thomas–Fermi-like model for the noninteracting susceptibility\n$$\n\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2},\n$$\nwhere $\\chi_{\\rm amp}0$ and $q_00$.\n- Use a Yukawa-screened Coulomb kernel\n$$\nv_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2},\n$$\nwhere $\\alpha_c0$ and $\\kappa0$.\n- Treat $\\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)=c_n$ and $\\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)=s$ as constants specified per test case. The meta-GGA contribution is modeled via the above chain rule with $\\delta \\tau(q)=\\gamma q^2 \\delta n(q)$.\n\nLet $L$ be the system length and $N$ the number of real-space grid points. Use discrete Fourier modes $q_k = \\frac{2\\pi}{L}k$ for integer indices $k$ in the range $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$, which covers nonnegative wavenumbers up to the Nyquist frequency. For each test case, assemble the linearized map eigenvalues over these modes, compute the spectral radius $\\rho$ and identify the maximizing mode $q^\\star$ that achieves it. To quantify sensitivity to the meta-GGA kinetic-energy-density dependence, compute the partial derivative $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$ at the maximizing mode $q^\\star$.\n\nYour program must:\n1. For each test case, generate the set of nonnegative Fourier modes $q_k$ as specified by $L$ and $N$.\n2. Using the base definitions and the model kernels, derive and compute the eigenvalues $\\lambda(q_k)$ of the linearized SCF map, the spectral radius $\\rho = \\max_k |\\lambda(q_k)|$, the maximizing wavevector $q^\\star$, and the sensitivity $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$.\n3. Produce a single line of output containing, for each test case in order, the spectral radius and the sensitivity evaluated at $q^\\star$, as a comma-separated list enclosed in square brackets. Express each number as a float rounded to six decimal places. No physical units are required; all quantities are dimensionless in atomic units.\n\nTest suite:\n- Case $1$ (happy path): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$.\n- Case $2$ (larger meta-GGA sensitivity): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$.\n- Case $3$ (negative meta-GGA sensitivity): $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$.\n- Case $4$ (edge mixing close to instability): $L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\rho_1, S_1, \\rho_2, S_2, \\rho_3, S_3, \\rho_4, S_4]$, where $\\rho_i$ is the spectral radius for case $i$ and $S_i$ is the sensitivity $\\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$ for case $i$, each rounded to six decimal places.",
            "solution": "The problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **SCF Update Rule**: Linear mixing with parameter $m \\in (0,1)$ for a density perturbation: $\\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q)$.\n- **Kohn–Sham Response**: The induced density change is $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$, where $\\chi_0(q)$ is the static noninteracting susceptibility.\n- **Effective Potential Variation**: $\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)$, with $v_c(q)$ as the screened Coulomb kernel.\n- **meta-GGA Exchange–Correlation Variation**: $\\delta v_{xc}(q) = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)\\delta n(q) + \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)\\delta \\tau(q)$. The partial derivatives are constants for a given stationary state, denoted $c_n = \\left(\\frac{\\partial v_{xc}}{\\partial n}\\right)$ and $s = \\left(\\frac{\\partial v_{xc}}{\\partial \\tau}\\right)$.\n- **Kinetic Energy Density Variation Model**: $\\delta \\tau(q) = \\gamma\\,q^2\\,\\delta n(q)$, for a model coefficient $\\gamma0$.\n- **SCF Convergence Condition**: The spectral radius $\\rho = \\max_q |\\lambda(q)|$ of the linearized map's Jacobian must satisfy $\\rho  1$.\n- **Model for Susceptibility**: $\\chi_0(q) = -\\frac{\\chi_{\\rm amp}}{1 + \\left(\\frac{q}{q_0}\\right)^2}$, with $\\chi_{\\rm amp}0$ and $q_00$.\n- **Model for Coulomb Kernel**: $v_c(q) = \\frac{\\alpha_c}{q^2 + \\kappa^2}$, with $\\alpha_c0$ and $\\kappa0$.\n- **Discrete Fourier Modes**: The wavevectors are $q_k = \\frac{2\\pi}{L}k$ for integer indices $k = 0, 1, \\dots, \\lfloor \\frac{N}{2} \\rfloor$.\n- **Task**: Compute the spectral radius $\\rho$, the maximizing mode $q^\\star$, and the sensitivity $\\left.\\frac{\\partial \\lambda(q)}{\\partial s}\\right|_{q=q^\\star}$.\n- **Test Case 1**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.1$.\n- **Test Case 2**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.6$.\n- **Test Case 3**: $L=20$, $N=512$, $m=0.5$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=-0.2$.\n- **Test Case 4**: $L=20$, $N=512$, $m=0.9$, $\\alpha_c=1.0$, $\\kappa=0.5$, $\\chi_{\\rm amp}=0.8$, $q_0=1.0$, $\\gamma=0.5$, $c_n=-0.3$, $s=0.3$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the specified criteria:\n- **Scientifically Grounded**: The problem is based on established principles of Kohn-Sham Density Functional Theory (DFT), specifically the linear response analysis of Self-Consistent Field (SCF) convergence. The use of simplified models for the susceptibility and Coulomb interaction is a standard practice in theoretical solid-state physics for analyzing general trends. The model for a meta-GGA functional is consistent with its definition. The problem is scientifically sound.\n- **Well-Posed**: The problem statement is unambiguous. It provides all necessary mathematical formulas, parameters, and a well-defined computational task. For the given discrete set of wavevectors, a unique spectral radius $\\rho$ is guaranteed to exist.\n- **Objective**: The problem is stated in precise, objective mathematical and physical language, free from subjective or qualitative claims.\n\nThe problem does not exhibit any of the invalidity flags. It is scientifically sound, formally specified, complete, consistent, and computationally feasible.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be developed.\n\n### Principle-Based Design\nThe solution requires two main steps: first, to derive the analytical expressions for the quantities of interest, and second, to implement a numerical calculation based on these expressions.\n\n**1. Derivation of the Jacobian Eigenvalue $\\lambda(q)$**\nThe goal is to find the eigenvalue $\\lambda(q)$ of the linear map that transforms an input density perturbation $\\delta n_{\\mathrm{in}}(q)$ to the new perturbation $\\delta n_{\\mathrm{new}}(q)$ after one SCF step with linear mixing. The update rule is:\n$$\n\\delta n_{\\mathrm{new}}(q) = (1-m)\\,\\delta n_{\\mathrm{in}}(q) + m\\,\\delta n_{\\mathrm{out}}(q)\n$$\nThe eigenvalue $\\lambda(q)$ is the ratio $\\delta n_{\\mathrm{new}}(q) / \\delta n_{\\mathrm{in}}(q)$ in the linear regime:\n$$\n\\lambda(q) = 1 - m + m \\frac{\\delta n_{\\mathrm{out}}(q)}{\\delta n_{\\mathrm{in}}(q)}\n$$\nThe term $\\delta n_{\\mathrm{out}}(q)$ is the response of the Kohn-Sham system to the input perturbation $\\delta n_{\\mathrm{in}}(q)$. We denote $\\delta n(q) \\equiv \\delta n_{\\mathrm{in}}(q)$ for clarity in the following steps. The Kohn-Sham response is $\\delta n_{\\mathrm{out}}(q) = \\chi_0(q)\\,\\delta v_{\\mathrm{eff}}(q)$. The effective potential variation $\\delta v_{\\mathrm{eff}}(q)$ is induced by $\\delta n(q)$:\n$$\n\\delta v_{\\mathrm{eff}}(q) = v_c(q)\\,\\delta n(q) + \\delta v_{xc}(q)\n$$\nThe exchange-correlation potential variation $\\delta v_{xc}(q)$ for a meta-GGA functional is given by the chain rule, using the provided constant derivatives and the model for $\\delta\\tau(q)$:\n$$\n\\delta v_{xc}(q) = c_n\\,\\delta n(q) + s\\,\\delta \\tau(q) = c_n\\,\\delta n(q) + s(\\gamma\\,q^2\\,\\delta n(q)) = (c_n + s \\gamma q^2) \\, \\delta n(q)\n$$\nSubstituting this into the expression for $\\delta v_{\\mathrm{eff}}(q)$:\n$$\n\\delta v_{\\mathrm{eff}}(q) = \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta n(q)\n$$\nThe output density perturbation is then:\n$$\n\\delta n_{\\mathrm{out}}(q) = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\delta n(q)\n$$\nFrom this, we find the ratio needed for $\\lambda(q)$:\n$$\n\\frac{\\delta n_{\\mathrm{out}}(q)}{\\delta n_{\\mathrm{in}}(q)} = \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right)\n$$\nFinally, substituting this into the expression for $\\lambda(q)$ and inserting the model kernels for $\\chi_0(q)$ and $v_c(q)$ gives the complete formula:\n$$\n\\lambda(q) = 1 - m + m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) \\left( \\frac{\\alpha_c}{q^2 + \\kappa^2} + c_n + s \\gamma q^2 \\right)\n$$\nThis is the central expression to be evaluated numerically.\n\n**2. Derivation of the Sensitivity $\\frac{\\partial \\lambda(q)}{\\partial s}$**\nThe sensitivity of the eigenvalue to the meta-GGA parameter $s$ is its partial derivative $\\frac{\\partial \\lambda(q)}{\\partial s}$. We differentiate the expression for $\\lambda(q)$ with respect to $s$, treating all other parameters and $q$ as constant:\n$$\n\\frac{\\partial \\lambda(q)}{\\partial s} = \\frac{\\partial}{\\partial s} \\left[ 1 - m + m \\chi_0(q) \\left( v_c(q) + c_n + s \\gamma q^2 \\right) \\right]\n$$\nThe only term dependent on $s$ is $m \\chi_0(q) s \\gamma q^2$. Its derivative with respect to $s$ is $m \\chi_0(q) \\gamma q^2$.\n$$\n\\frac{\\partial \\lambda}{\\partial s}(q) = m \\chi_0(q) (\\gamma q^2) = m \\left( -\\frac{\\chi_{\\rm amp} q_0^2}{q^2 + q_0^2} \\right) (\\gamma q^2) = - \\frac{m \\gamma \\chi_{\\rm amp} q_0^2 q^2}{q^2 + q_0^2}\n$$\nThis expression will be evaluated at the specific wavevector $q^\\star$ that maximizes $|\\lambda(q)|$.\n\n**3. Computational Algorithm**\nFor each test case with its given set of parameters $\\{L, N, m, \\alpha_c, \\kappa, \\chi_{\\rm amp}, q_0, \\gamma, c_n, s\\}$:\n1.  Generate the discrete wavevector grid: $q_k = \\frac{2\\pi}{L}k$ for $k \\in \\{0, 1, \\dots, \\lfloor N/2 \\rfloor\\}$.\n2.  For each $q_k$ on the grid, calculate the eigenvalue $\\lambda(q_k)$ using the derived formula.\n3.  Calculate the absolute values $|\\lambda(q_k)|$ for all $k$.\n4.  The spectral radius is $\\rho = \\max_k |\\lambda(q_k)|$.\n5.  Find the index $k^\\star$ that yields this maximum value, i.e., $|\\lambda(q_{k^\\star})| = \\rho$. The maximizing wavevector is $q^\\star = q_{k^\\star}$.\n6.  Calculate the sensitivity $S = \\left.\\frac{\\partial \\lambda}{\\partial s}\\right|_{q^\\star}$ using the derived formula evaluated at $q = q^\\star$.\n7.  The pair of values $(\\rho, S)$ is stored, and the process is repeated for all test cases.\n8.  The final results are formatted into a single string as specified.\nThis entire procedure is implemented in the provided Python code.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DFT SCF convergence problem for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.1},\n        # Case 2: larger meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.6},\n        # Case 3: negative meta-GGA sensitivity\n        {'L': 20, 'N': 512, 'm': 0.5, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': -0.2},\n        # Case 4: edge mixing close to instability\n        {'L': 20, 'N': 512, 'm': 0.9, 'alpha_c': 1.0, 'kappa': 0.5, 'chi_amp': 0.8, 'q0': 1.0, 'gamma': 0.5, 'cn': -0.3, 's': 0.3},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        L = case['L']\n        N = case['N']\n        m = case['m']\n        alpha_c = case['alpha_c']\n        kappa = case['kappa']\n        chi_amp = case['chi_amp']\n        q0 = case['q0']\n        gamma = case['gamma']\n        cn = case['cn']\n        s = case['s']\n\n        # 1. Generate the set of nonnegative Fourier modes q_k\n        k_indices = np.arange(0, N // 2 + 1)\n        q = (2 * np.pi / L) * k_indices\n\n        # 2. Derive and compute the eigenvalues lambda(q_k)\n        \n        # Model for susceptibility chi_0(q)\n        q_sq = q**2\n        chi0_q = -chi_amp * q0**2 / (q_sq + q0**2)\n        \n        # Model for Coulomb kernel v_c(q)\n        vc_q = alpha_c / (q_sq + kappa**2)\n        \n        # Expression for the eigenvalue lambda(q)\n        # lambda(q) = 1 - m + m * chi_0(q) * (v_c(q) + c_n + s * gamma * q^2)\n        lambda_q = 1.0 - m + m * chi0_q * (vc_q + cn + s * gamma * q_sq)\n\n        # Compute the spectral radius rho = max_k |lambda(q_k)|\n        abs_lambda_q = np.abs(lambda_q)\n        rho = np.max(abs_lambda_q)\n\n        # Identify the maximizing wavevector q_star\n        idx_star = np.argmax(abs_lambda_q)\n        q_star = q[idx_star]\n        q_star_sq = q_star**2\n\n        # Compute the sensitivity d(lambda)/ds at q_star\n        # d(lambda)/ds = m * chi_0(q) * gamma * q^2\n        # d(lambda)/ds = - m * gamma * chi_amp * q0^2 * q^2 / (q^2 + q0^2)\n        sensitivity = - (m * gamma * chi_amp * q0**2 * q_star_sq) / (q_star_sq + q0**2)\n        \n        # Append results for this case, formatted to six decimal places\n        results.append(f\"{rho:.6f}\")\n        results.append(f\"{sensitivity:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}