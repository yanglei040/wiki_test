{
    "hands_on_practices": [
        {
            "introduction": "在应用强大的非平衡功关系之前，我们必须首先对“功”和“热”在受驱动系统中的基本定义有扎实的理解。这个练习将一个看似复杂的热力学过程分解为离散的步骤——瞬时跳变、连续驱动和弛豫，从而帮助我们建立物理直觉。通过分析一个被谐振子势阱束缚的布朗粒子，我们将精确计算在过程的不同阶段所做的功和交换的热，这为理解更复杂的非平衡现象奠定了基础。",
            "id": "3428950",
            "problem": "考虑一个质量为 $m$ 的一维过阻尼布朗粒子，与温度恒为 $T$ 的热库接触。该粒子被一个谐波势 $U(x;k) = \\frac{1}{2} k x^{2}$ 所约束，其刚度参数 $k$ 由外部控制，并根据一个分段协议随时间变化。系统初始时在参数 $k_{0}$ 和温度 $T$ 下处于正则平衡态。该协议包含以下几个部分：\n\n1. 在时间 $t=0$ 时，参数从 $k_{0}$ 突变为 $k_{1}$，使得微观状态 $x$ 在跳变过程中不发生改变，随后在固定的 $k=k_{1}$ 下完全弛豫，回到与热库的正则平衡态。\n\n2. 在 $t \\in [0,\\tau]$ 的连续时间段内，$k(t)$ 从 $k_{1}$ 到 $k_{2}$ 进行确定性的单调变化，随后在固定的 $k=k_{2}$ 下完全弛豫，回到与热库的正则平衡态。\n\n假设在参数更新之间的动力学过程中，热力学第一定律对每条轨迹都成立，其中功由 $U(x;k)$ 的参数变化定义，热量由固定参数下与热库的能量交换定义。\n\na) 将对系统做的总功 $W_{\\text{tot}}$ 写成跳变功 $W_{\\text{jump}}$ 和协议功 $W_{\\text{prot}}$ 的和，每一项都用 $U(x;k)$ 和参数变化来表示，除了过阻尼弛豫外，不对 $x(t)$ 的具体动力学做任何假设。\n\nb) 对于从 $k_{0}$ 到 $k_{1}$ 跳变后的弛豫过程，计算在固定 $k=k_{1}$ 的弛豫期间与热库交换的平均热量 $Q_{\\text{relax},1}$。将 $Q_{\\text{relax},1}$ 用 $k_{0}$、$k_{1}$、$k_{B}$ 和 $T$ 表示，其中 $k_{B}$ 是玻尔兹曼常数。\n\nc) 对于在 $k_{2}$ 结束的连续段之后的弛豫过程，将平均热量 $Q_{\\text{relax},2}$ 用弛豫前瞬间的平均平方位移 $\\langle x^{2} \\rangle_{\\text{end}}$ 和 $k_{2}$ 表示，并说明在连续段满足什么条件下 $Q_{\\text{relax},2}$ 为零。\n\nd) 利用该协议的结构和适用于分子动力学的非平衡功定理（不必在问题陈述中说明任何具体定理），计算初始态（在 $k_{0}$）和末态（在 $k_{2}$）之间的平衡自由能差 $\\Delta F$，并用 $k_{0}$、$k_{2}$、$k_{B}$ 和 $T$ 表示为一个闭式表达式。将最终的自由能差以焦耳为单位表示。最终答案必须是单一的闭式解析表达式。不需要数值，也不需要四舍五入。",
            "solution": "对问题陈述进行分析后，认定其是有效的。它描述了应用于谐波势中过阻尼布朗粒子的一系列热力学过程。尽管在不同阶段的时间变量上存在微小歧义，但其语言与一个包含参数跳变、弛豫期、连续参数变化和最终弛豫期的顺序协议是一致的。这种解释使得问题的各个部分都是良定的，并且可以使用统计力学和随机热力学的既定原理来解决。\n\n系统是一个处于谐波势 $U(x;k) = \\frac{1}{2} k x^2$ 中的一维粒子。该粒子与恒温为 $T$ 的热浴接触。对于这样一个处于正则平衡的系统，能量均分定理指出平均势能为 $\\langle U \\rangle_{eq} = \\frac{1}{2} k_B T$，其中 $k_B$ 是玻尔兹曼常数。由此，我们可以求出均方位移：$\\langle \\frac{1}{2} k x^2 \\rangle = \\frac{1}{2} k_B T$，这意味着 $\\langle x^2 \\rangle_{eq} = \\frac{k_B T}{k}$。\n\n该协议被解释为一个序列：\n1.  系统初始时处于平衡态，势参数设置为 $k_0$。\n2.  在时间 $t=0$ 时，参数从 $k_0$ 瞬时变为 $k_1$。对系统做功。\n3.  然后系统在固定参数 $k=k_1$ 下弛豫，直到达到新的平衡态。与热库发生热交换。\n4.  从 $k_1$ 的这个平衡态开始，在时长为 $\\tau$ 的时间间隔内，参数从 $k_1$ 连续变化到 $k_2$。对系统做功。\n5.  最后，在参数固定为 $k_2$ 的情况下，系统弛豫到其最终平衡态。与热库发生热交换。\n\n一个微观状态 $x$ 的能量由其势能 $U(x;k)$ 给出。单条轨迹的热力学第一定律是 $dE = dW + dQ$，其中 $E=U$。功 $dW$ 与控制参数 $k$ 的变化相关，$dW = \\frac{\\partial U}{\\partial k} dk$。热量 $dQ$ 是在固定参数下与热库交换的能量，可以证明其为 $dQ = \\frac{\\partial U}{\\partial x} dx$。\n\na) 总功 $W_{\\text{tot}}$ 是参数 $k$ 发生变化的两个阶段所做功的总和。设从 $k_0$ 的平衡分布中抽取的粒子初始位置为 $x_0$。将连续协议期间粒子的轨迹记为 $x(t)$，其中 $t$ 在该协议段的时间间隔内。\n\n在从 $k_0$ 到 $k_1$ 的突变过程中所做的功称为 $W_{\\text{jump}}$。由于跳变是瞬时的，粒子的位置 $x_0$ 不会改变。功是在固定位置上由参数变化引起的势能变化：\n$$W_{\\text{jump}} = U(x_0; k_1) - U(x_0; k_0) = \\frac{1}{2} k_1 x_0^2 - \\frac{1}{2} k_0 x_0^2 = \\frac{1}{2} (k_1 - k_0) x_0^2$$\n\n在从 $k_1$ 到 $k_2$ 的连续协议期间所做的功称为 $W_{\\text{prot}}$。这个功是通过在协议持续时间内对微元功 $dW$ 进行积分得到的，我们可以将时钟重新归零后，认为该时间段为 $t \\in [0, \\tau]$。\n$$W_{\\text{prot}} = \\int_{\\text{protocol}} dW = \\int_0^\\tau \\frac{\\partial U(x(t); k(t))}{\\partial k} \\frac{dk}{dt} dt = \\int_0^\\tau \\frac{1}{2} x(t)^2 \\dot{k}(t) dt$$\n总功是这两部分贡献之和：\n$$W_{\\text{tot}} = W_{\\text{jump}} + W_{\\text{prot}} = \\frac{1}{2} (k_1 - k_0) x_0^2 + \\int_0^\\tau \\frac{1}{2} x(t)^2 \\dot{k}(t) dt$$\n\nb) 我们需要计算在恒定参数 $k=k_1$ 下弛豫过程中交换的平均热量 $\\langle Q_{\\text{relax},1} \\rangle$。这个过程在跳变后立即开始。该弛豫过程的初始状态是粒子在势 $U(x; k_1)$ 中位于位置 $x_0$。末态是在温度 $T$ 和参数 $k_1$ 下的正则平衡态。\n在恒定 $k$ 的弛豫过程中，不做功（$dk=0$，所以 $dW=0$）。根据第一定律，沿一条轨迹交换的热量等于能量的变化：$Q_{\\text{relax},1} = \\Delta U = U_{\\text{final}} - U_{\\text{initial}}$。\n我们要求的是平均热量，$\\langle Q_{\\text{relax},1} \\rangle = \\langle U_{\\text{final}} \\rangle - \\langle U_{\\text{initial}} \\rangle$。\n\n平均初始能量 $\\langle U_{\\text{initial}} \\rangle$ 是 $U(x_0; k_1) = \\frac{1}{2} k_1 x_0^2$ 的平均值，其中平均是针对在参数 $k_0$ 下的 $x_0$ 初始平衡分布计算的。\n$$\\langle U_{\\text{initial}} \\rangle = \\left\\langle \\frac{1}{2} k_1 x_0^2 \\right\\rangle_{k_0} = \\frac{1}{2} k_1 \\langle x_0^2 \\rangle_{k_0}$$\n使用能量均分定理的结果 $\\langle x_0^2 \\rangle_{k_0} = k_B T / k_0$，我们得到：\n$$\\langle U_{\\text{initial}} \\rangle = \\frac{1}{2} k_1 \\frac{k_B T}{k_0}$$\n\n平均末态能量 $\\langle U_{\\text{final}} \\rangle$ 是参数为 $k_1$ 的新平衡态下的平均势能。根据能量均分定理：\n$$\\langle U_{\\text{final}} \\rangle = \\left\\langle \\frac{1}{2} k_1 x^2 \\right\\rangle_{k_1} = \\frac{1}{2} k_B T$$\n\n因此，平均热量为：\n$$\\langle Q_{\\text{relax},1} \\rangle = \\frac{1}{2} k_B T - \\frac{1}{2} k_1 \\frac{k_B T}{k_0} = \\frac{1}{2} k_B T \\left(1 - \\frac{k_1}{k_0}\\right)$$\n\nc) 类似地，对于在恒定 $k=k_2$ 下的弛豫过程，交换的平均热量为 $\\langle Q_{\\text{relax},2} \\rangle = \\langle U_{\\text{final}} \\rangle - \\langle U_{\\text{initial}} \\rangle$。\n该过程的初始状态是连续协议结束时系统的状态，即粒子在势 $U(x; k_2)$ 中位于位置 $x_{\\text{end}}$。问题给出了此时的平均平方位移为 $\\langle x^2 \\rangle_{\\text{end}}$。\n平均初始能量为：\n$$\\langle U_{\\text{initial}} \\rangle = \\left\\langle \\frac{1}{2} k_2 x_{\\text{end}}^2 \\right\\rangle = \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$$\n末态是在参数 $k_2$ 下的平衡态，所以平均末态能量为 $\\langle U_{\\text{final}} \\rangle = \\frac{1}{2} k_B T$。\n平均热量为：\n$$\\langle Q_{\\text{relax},2} \\rangle = \\frac{1}{2} k_B T - \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$$\n如果 $\\frac{1}{2} k_B T = \\frac{1}{2} k_2 \\langle x^2 \\rangle_{\\text{end}}$，则该平均热量为零，$\\langle Q_{\\text{relax},2} \\rangle = 0$。这个条件意味着连续驱动协议结束时的平均势能必须等于参数为 $k_2$ 时的平衡平均势能。这种情况的一个充分条件是系统在整个连续驱动过程中保持平衡，这在协议准静态（即无限慢，$\\tau \\to \\infty$）执行时发生。\n\nd) 初始态（在 $k_0$ 处的平衡态）和末态（在 $k_2$ 处的平衡态）之间的平衡自由能差 $\\Delta F$ 是一个态函数。它只取决于初始和最终的平衡态，而与它们之间的路径无关。非平衡功定理，例如 Jarzynski 等式 $\\langle \\exp(-\\beta W) \\rangle = \\exp(-\\beta \\Delta F)$，证实了 $\\Delta F$ 原则上可以从连接这两个状态的任何非平衡过程中求得。然而，这些定理也强调了 $\\Delta F$ 的值是唯一的且与路径无关。\n\n因此，我们可以用最直接的方法来计算 $\\Delta F$，即通过亥姆霍兹自由能的统计力学定义 $F = -k_B T \\ln Z$，其中 $Z$ 是配分函数。对于一维谐振子，配分函数为：\n$$Z(k, T) = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{U(x;k)}{k_B T}\\right) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{k x^2}{2 k_B T}\\right) dx$$\n这是一个标准的高斯积分，其计算结果为：\n$$Z(k, T) = \\sqrt{\\frac{2 \\pi k_B T}{k}}$$\n自由能作为 $k$ 和 $T$ 的函数是：\n$$F(k, T) = -k_B T \\ln(Z(k, T)) = -k_B T \\ln\\left(\\sqrt{\\frac{2 \\pi k_B T}{k}}\\right) = -\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k}\\right)$$\n自由能差 $\\Delta F = F(k_2, T) - F(k_0, T)$ 则为：\n$$\\Delta F = -\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k_2}\\right) - \\left(-\\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T}{k_0}\\right)\\right)$$\n$$\\Delta F = \\frac{1}{2} k_B T \\left[ \\ln\\left(\\frac{2 \\pi k_B T}{k_0}\\right) - \\ln\\left(\\frac{2 \\pi k_B T}{k_2}\\right) \\right]$$\n利用对数的性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$：\n$$\\Delta F = \\frac{1}{2} k_B T \\ln\\left(\\frac{2 \\pi k_B T/k_0}{2 \\pi k_B T/k_2}\\right) = \\frac{1}{2} k_B T \\ln\\left(\\frac{k_2}{k_0}\\right)$$\n这个表达式给出了以能量为单位（在国际单位制中为焦耳）的自由能差，是所要求的最终答案。",
            "answer": "$$\\boxed{\\frac{1}{2} k_{B} T \\ln\\left(\\frac{k_{2}}{k_{0}}\\right)}$$"
        },
        {
            "introduction": "掌握了功的微观定义后，我们接下来将探讨功的统计性质。本练习将 Crooks 涨落定理应用于一个常见的理想化场景——功分布近似为高斯分布，从而推导出正向和反向过程的平均功与自由能变之间的深刻联系。更重要的是，这个思想实验揭示了一个关键的实践问题：自由能估计对初始状态制备的精确性极为敏感，这有助于我们诊断和避免实验或模拟中的系统性偏差。",
            "id": "2659399",
            "problem": "考虑一个最小化学反应网络，其中包含两种化学物种 $A$ 和 $B$。它们在一个温度为 $T$、充分搅拌的恒温恒化器中通过反应 $A \\rightleftharpoons B$ 相互转化。一个标量控制参数 $\\lambda(t)$ 在有限时间窗口 $t \\in [0,\\tau]$ 内驱动 $A$ 和 $B$ 之间的标准化学势差 $\\Delta \\mu(\\lambda)$。将正向过程记为 $\\lambda_{F}: 0 \\to 1$，反向过程记为 $\\lambda_{R}: 1 \\to 0$。假设随机反应动力学满足局域细致平衡且微观可逆，并且对于一个中等速率的过程，累积的功是许多弱相关贡献之和，因此沿一条轨迹实现的功 $W$ 近似服从高斯分布。\n\n你进行了多次正向实验的重复，每次正向实现都从对应于 $\\lambda_{F}(0)=0$ 的平衡分布开始；你也进行了多次反向实验的重复。在正确初始化的情形下，反向实现必须从对应于 $\\lambda_{R}(0)=1$ 的平衡分布开始。假设当两个系综都正确初始化时，正向功分布的均值为 $\\mu_{F}$，方差为 $\\sigma^{2}$；反向功分布的均值为 $\\mu_{R}$，方差也为 $\\sigma^{2}$；逆热能为 $\\beta = 1/(k_{B}T)$。\n\n(a) 从反应网络的微观可逆性和局域细致平衡出发，将正向路径概率与时间反演路径概率之比与热力学量联系起来，从而推导出正向和反向功分布之间的关系。使用具有共同方差 $\\sigma^{2}$ 的高斯形式，推导连接 $\\mu_{F}$、$\\mu_{R}$、$\\sigma^{2}$、$\\beta$ 以及平衡自由能差 $\\Delta F = F(\\lambda=1) - F(\\lambda=0)$ 的线性约束。\n\n(b) 现在考虑在制备反向初始系综时的一个错误：反向实现从一个非平衡稳态混合物开始，这导致反向功均值产生一个加性偏移 $\\delta$（而方差 $\\sigma^{2}$ 基本不变），因此测得的反向均值为 $\\mu_{R}^{\\mathrm{wrong}} = \\mu_{R} + \\delta$。如果有人朴素地应用在 (a) 部分推导出的高斯正反向匹配公式，使用 $\\mu_{F}$ 和 $\\mu_{R}^{\\mathrm{wrong}}$ 来估计 $\\Delta F$，那么当 $\\beta = 1$（即功以 $k_{B}T$ 为单位表示）、$\\sigma^{2} = 2$、$\\mu_{F} = 1.5$ 且 $\\delta = 0.6$ 时，这个朴素估计器的结果值是多少？请以 $k_{B}T$ 为单位表示你的最终答案，并将其四舍五入到四位有效数字。最终答案必须是一个数字。",
            "solution": "该问题是有效的，因为它基于非平衡统计力学的原理，具有科学依据，提法良定且信息充足，并以客观、正式的语言陈述。我们开始解答。\n\n(a) 部分：约束的推导\n\n非平衡功关系的基础是微观可逆性原理。对于一个在时变过程 $\\lambda(t)$ 下演化的系统，在时间反演过程 $\\lambda_R(t) = \\lambda_F(\\tau-t)$ 下，观测到正向轨迹 $\\Gamma = \\{x(t)\\}_{t=0}^{\\tau}$ 的概率与观测到其时间反演轨迹 $\\tilde{\\Gamma} = \\{x(\\tau-t)\\}_{t=0}^{\\tau}$ 的概率之比，与正向路径上产生的熵有关。路径概率既考虑了动力学，也考虑了初始平衡分布。设正向过程从 $\\lambda(0)=0$ 处的平衡分布（自由能为 $F(\\lambda=0)$）开始，反向过程从 $\\lambda(\\tau)=1$ 处的平衡（自由能为 $F(\\lambda=1)$）开始。Crooks 涨落定理阐述了对系统做的功 $W$ 的概率分布之间的关系。对于正向 ($P_F(W)$) 和反向 ($P_R(W)$) 过程，该定理为：\n$$\n\\frac{P_F(W)}{P_R(-W)} = \\exp(\\beta(W - \\Delta F))\n$$\n此处，$\\beta = 1/(k_B T)$ 是逆热能，$\\Delta F = F(\\lambda=1) - F(\\lambda=0)$ 是过程的末态和初态之间的平衡自由能差。时间反演轨迹中所做的功是正向轨迹中所做功的负值，$W_{\\text{reverse}}(\\tilde{\\Gamma}) = -W_{\\text{forward}}(\\Gamma)$。\n\n问题陈述功分布近似为具有共同方差 $\\sigma^2$ 的高斯分布。正向功的概率密度函数为：\n$$\nP_F(W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu_F)^2}{2\\sigma^2}\\right)\n$$\n反向功的概率密度函数为：\n$$\nP_R(W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu_R)^2}{2\\sigma^2}\\right)\n$$\n为了使用 Crooks 关系，我们需要概率密度 $P_R(-W)$：\n$$\nP_R(-W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(-W-\\mu_R)^2}{2\\sigma^2}\\right) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W+\\mu_R)^2}{2\\sigma^2}\\right)\n$$\n将这些高斯形式代入 Crooks 关系中：\n$$\n\\frac{\\exp\\left(-\\frac{(W-\\mu_F)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(W+\\mu_R)^2}{2\\sigma^2}\\right)} = \\exp(\\beta(W - \\Delta F))\n$$\n对两边取自然对数：\n$$\n-\\frac{(W-\\mu_F)^2}{2\\sigma^2} + \\frac{(W+\\mu_R)^2}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n展开分子中的平方项：\n$$\n\\frac{-(W^2 - 2W\\mu_F + \\mu_F^2) + (W^2 + 2W\\mu_R + \\mu_R^2)}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n$W$ 的二次项相互抵消：\n$$\n\\frac{2W\\mu_F - \\mu_F^2 + 2W\\mu_R + \\mu_R^2}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n重新整理左侧，按 $W$ 的幂次分组：\n$$\n\\frac{W(2\\mu_F + 2\\mu_R) + (\\mu_R^2 - \\mu_F^2)}{2\\sigma^2} = \\beta W - \\beta \\Delta F\n$$\n为使此等式对所有 $W$ 值都成立，等式两边 $W$ 的相应幂次的系数必须相等。\n\n令 $W^1$ 的系数相等：\n$$\n\\frac{2(\\mu_F + \\mu_R)}{2\\sigma^2} = \\beta \\implies \\mu_F + \\mu_R = \\beta \\sigma^2\n$$\n这是第一个线性约束，它将平均功之和与方差及温度联系起来。这是一种形式的涨落-耗散定理。\n\n令常数项 ($W^0$) 相等：\n$$\n\\frac{\\mu_R^2 - \\mu_F^2}{2\\sigma^2} = -\\beta \\Delta F \\implies \\mu_F^2 - \\mu_R^2 = 2\\sigma^2 \\beta \\Delta F\n$$\n我们可以对左侧进行因式分解：$(\\mu_F - \\mu_R)(\\mu_F + \\mu_R) = 2\\sigma^2 \\beta \\Delta F$。代入第一个约束 $\\mu_F + \\mu_R = \\beta \\sigma^2$：\n$$\n(\\mu_F - \\mu_R)(\\beta \\sigma^2) = 2\\sigma^2 \\beta \\Delta F\n$$\n假设 $\\beta \\neq 0$ 且 $\\sigma^2 \\neq 0$，我们可以两边同除以 $\\beta \\sigma^2$ 得到第二个线性约束：\n$$\n\\mu_F - \\mu_R = 2\\Delta F\n$$\n这个约束直接将平均功之差与平衡自由能变化联系起来。\n\n(b) 部分：$\\Delta F$ 朴素估计值的计算\n\n问题指明，在制备反向过程的初始系综时存在一个错误，导致测得的反向平均功为 $\\mu_{R}^{\\mathrm{wrong}} = \\mu_{R} + \\delta$，而方差 $\\sigma^2$ 不变。$\\Delta F$ 的朴素估计值是通过应用 (a) 部分推导的公式 $\\Delta F = (\\mu_F - \\mu_R)/2$ 得到的，但是用错误的测量值 $\\mu_{R}^{\\mathrm{wrong}}$ 代替了正确的值 $\\mu_R$。\n因此，我们记为 $\\Delta F_{\\text{naive}}$ 的朴素估计值为：\n$$\n\\Delta F_{\\text{naive}} = \\frac{\\mu_F - \\mu_{R}^{\\mathrm{wrong}}}{2}\n$$\n为了计算 $\\Delta F_{\\text{naive}}$ 的数值，我们必须首先确定反向平均功的正确值 $\\mu_R$，这个值是在正确初始化的理想实验中本应获得的值。我们使用 (a) 部分推导的第一个约束以及为正确执行的实验所提供的参数：$\\mu_F + \\mu_R = \\beta \\sigma^2$。\n给定值为：\n$\\beta = 1$ （单位为 $(k_B T)^{-1}$）\n$\\sigma^2 = 2$ （单位为 $(k_B T)^2$）\n$\\mu_F = 1.5$ （单位为 $k_B T$）\n$\\delta = 0.6$ （单位为 $k_B T$）\n\n首先，我们求解真实的反向平均功 $\\mu_R$：\n$$\n\\mu_R = \\beta \\sigma^2 - \\mu_F\n$$\n代入数值：\n$$\n\\mu_R = (1)(2) - 1.5 = 2 - 1.5 = 0.5\n$$\n$\\mu_R$ 的值为 $0.5$，单位为 $k_B T$。\n\n接下来，我们计算测得的错误的反向平均功：\n$$\n\\mu_{R}^{\\mathrm{wrong}} = \\mu_R + \\delta = 0.5 + 0.6 = 1.1\n$$\n$\\mu_{R}^{\\mathrm{wrong}}$ 的值为 $1.1$，单位为 $k_B T$。\n\n最后，我们使用 $\\mu_F$ 和 $\\mu_{R}^{\\mathrm{wrong}}$ 计算自由能差的朴素估计值：\n$$\n\\Delta F_{\\text{naive}} = \\frac{\\mu_F - \\mu_{R}^{\\mathrm{wrong}}}{2} = \\frac{1.5 - 1.1}{2} = \\frac{0.4}{2} = 0.2\n$$\n自由能差的朴素估计值为 $0.2$，单位是 $k_B T$。问题要求将答案四舍五入到四位有效数字，即 $0.2000$。\n为完整起见，真实的自由能差应为 $\\Delta F = (\\mu_F - \\mu_R)/2 = (1.5 - 0.5)/2 = 0.5$ $k_B T$。初始化中的错误导致了对自由能变化的显著低估。",
            "answer": "$$\n\\boxed{0.2000}\n$$"
        },
        {
            "introduction": "从统计理论到计算实践的飞跃充满了挑战。即使有 Jarzynski 等式这样精确的理论公式，直接的数值实现也可能因为浮点运算的局限性而导致灾难性的失败。本练习直面这一核心计算难题，要求我们通过比较不同的数值策略，来精确计算 Jarzynski 等式中的指数平均项 $\\langle \\exp(-\\beta W) \\rangle$。解决这个问题对于任何希望在计算材料科学或生物物理学中应用非平衡功关系的研究者来说都是一项基本技能。",
            "id": "3469433",
            "problem": "考虑一个与计算材料科学相关的合成非平衡切换实验，在该实验中，每条轨迹所做的随机功 $W$ 被建模为均值为 $\\mu$、标准差为 $\\sigma$ 的高斯随机变量。令 $\\beta$ 表示逆温度。对于每组参数，假设从指定的高斯分布中抽取一个独立同分布的样本 $\\{W_i\\}_{i=1}^N$。\n\n您必须使用变换后变量 $X_i = -\\beta W_i$ 的指数对数平均值来数值估计自由能差，并评估在长时间模拟中稳定该计算的数值精度策略。具体来说，对于每组参数，您必须计算以下四种自由能差的估计值，所有估计都使用相同的采样数据，但对指数平均采用不同的累加方案：\n\n1. 通过 log-sum-exp 策略在双精度（64位浮点数）下计算的参考估计量，并对指数化、移位后的值进行补偿累加。\n2. 使用双精度直接求和的朴素估计量。\n3. 使用双精度 Kahan 求和的补偿求和估计量。\n4. 使用单精度（32位浮点数）对所有操作（包括指数运算、求和、除以 $N$ 和对数运算）进行直接求和的朴素估计量。\n\n对于列表 $\\{\\text{naive-64}, \\text{Kahan-64}, \\text{naive-32}\\}$ 中的每个非参考估计量 $s$，将舍入诱导偏差定义为该估计量与参考估计量之间的差值，两者均在相同数据上计算：\n$$\n\\text{bias}_s = \\widehat{\\Delta F}_s - \\widehat{\\Delta F}_{\\text{ref}}.\n$$\n您必须以约化能量单位输出这些偏差，其形式为实数值。能量单位与 $W$ 的单位相同，并与 $\\beta$ 一致（即 $\\beta$ 的单位是能量的倒数）。将所有结果表示为十进制浮点数。\n\n基本和建模假设：\n- 涨落关系通过对功值进行指数平均，将非平衡功与平衡自由能差联系起来。核心计算挑战在于，当 $N$ 很大且 $X_i$ 值跨越很宽的动态范围时，如何精确计算指数算术平均值的对数。\n- log-sum-exp 策略通过在指数内部减去样本最大值 $m = \\max_i X_i$ 来计算指数平均值的对数，以防止上溢/下溢，然后累加移位后的指数值，最后在取对数后将 $m$ 加回。\n- Kahan 补偿求和在对许多数量级不同的项求和时，可以减少浮点舍入误差。\n\n测试套件：\n为保证可复现性，请使用指定的种子和参数元组 $(\\beta, N, \\mu, \\sigma, \\text{seed})$：\n- 测试 1（顺利路径，中等耗散和方差）：$(1.0,\\ 200000,\\ 2.0,\\ 1.0,\\ 12345)$。\n- 测试 2（高耗散，小指数值）：$(5.0,\\ 300000,\\ 8.0,\\ 2.0,\\ 24680)$。\n- 测试 3（大方差，宽动态范围）：$(2.0,\\ 400000,\\ 0.5,\\ 3.0,\\ 13579)$。\n- 测试 4（单精度下的次正规数范围，压力测试精度）：$(10.0,\\ 250000,\\ 9.0,\\ 1.5,\\ 424242)$。\n\n每个测试用例的数值任务：\n- 使用提供的种子抽取 $N$ 个样本 $W_i \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n- 构建 $X_i = -\\beta W_i$。\n- 如上所述计算四个自由能估计值，通过在双精度下进行 log-sum-exp 计算得到 $\\widehat{\\Delta F}_{\\text{ref}}$，并对三种策略 $s$ 中的每一种计算 $\\widehat{\\Delta F}_s$。\n- 计算舍入诱导偏差 $\\text{bias}_s = \\widehat{\\Delta F}_s - \\widehat{\\Delta F}_{\\text{ref}}$，其中 $s \\in \\{\\text{naive-64}, \\text{Kahan-64}, \\text{naive-32}\\}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的、包含十二个浮点数的逗号分隔列表。顺序必须是：\n$[\\text{bias}_{\\text{naive-64}}^{(1)}, \\text{bias}_{\\text{Kahan-64}}^{(1)}, \\text{bias}_{\\text{naive-32}}^{(1)}, \\text{bias}_{\\text{naive-64}}^{(2)}, \\text{bias}_{\\text{Kahan-64}}^{(2)}, \\text{bias}_{\\text{naive-32}}^{(2)}, \\text{bias}_{\\text{naive-64}}^{(3)}, \\text{bias}_{\\text{Kahan-64}}^{(3)}, \\text{bias}_{\\text{naive-32}}^{(3)}, \\text{bias}_{\\text{naive-64}}^{(4)}, \\text{bias}_{\\text{Kahan-64}}^{(4)}, \\text{bias}_{\\text{naive-32}}^{(4)}]$.\n\n角度单位不适用。所有类能量的量都必须以与 $\\beta$ 一致的约化能量单位表示，仅通过实现的自然浮点运算进行舍入；不要进行额外舍入。",
            "solution": "此问题旨在评估在计算 Jarzynski 平均值 $\\langle e^{-\\beta W} \\rangle$ 时不同数值策略的稳定性和准确性，这是从非平衡功数据中估计自由能差 $\\Delta F$ 的核心步骤。\n\n核心计算任务是评估表达式 $\\widehat{\\Delta F} = -\\frac{1}{\\beta} \\ln \\left( \\frac{1}{N} \\sum_{i=1}^N e^{X_i} \\right)$，其中 $X_i = -\\beta W_i$。直接计算此表达式会面临严重的数值问题：\n1.  **上溢 (Overflow)**: 如果任何 $X_i$ 值很大，其指数 $e^{X_i}$ 可能会超出浮点数所能表示的最大范围，导致结果为无穷大 (`inf`)。\n2.  **下溢 (Underflow)**: 如果 $X_i$ 值非常小（大负数），$e^{X_i}$ 可能被舍入为零。如果所有项都下溢，总和将为零，其对数将是负无穷大。\n3.  **舍入误差 (Rounding Error)**: 当对一系列数量级差异巨大的数字求和时，较小的数字可能会在加到较大的数字上时被完全“淹没”，导致精度损失。\n\n为了解决这些问题，本练习比较了四种策略：\n\n1.  **参考估计量 ($\\widehat{\\Delta F}_{\\text{ref}}$)**：此方法结合了两种强大的数值技术以获得最高精度。\n    *   **Log-Sum-Exp (LSE) 技巧**: 利用恒等式 $\\ln(\\sum e^{X_i}) = m + \\ln(\\sum e^{X_i - m})$，其中 $m = \\max_i X_i$。通过减去最大值，最大的指数项变为 $e^0=1$，从而有效防止上溢，并减少下溢对总和的相对影响。\n    *   **Kahan 补偿求和**: 该算法在累加移位的指数项 $e^{X_i-m}$ 时，通过一个补偿变量 `c` 来跟踪和校正每次加法中丢失的低位精度，从而显著减少舍入误差。此方法使用双精度（64位）浮点数。\n\n2.  **朴素双精度估计量 ($\\widehat{\\Delta F}_{\\text{naive-64}}$)**：此方法在双精度下直接计算 $\\sum e^{X_i}$。它不使用 LSE 或 Kahan 求和，因此极易受到上溢（当任何 $X_i$ 超过约 709 时）和舍入误差的影响。\n\n3.  **Kahan 双精度估计量 ($\\widehat{\\Delta F}_{\\text{Kahan-64}}$)**：此方法使用 Kahan 补偿求和来计算 $\\sum e^{X_i}$，但没有 LSE 技巧。它能有效减少舍入误差，但仍然无法防止上溢。\n\n4.  **朴素单精度估计量 ($\\widehat{\\Delta F}_{\\text{naive-32}}$)**：此方法在单精度（32位）下执行所有计算。单精度浮点数的动态范围（最大指数约 127）和精度（尾数位数）都远小于双精度，使其对所有类型的数值误差都极为敏感。\n\n对于每个测试用例，我们首先生成 $N$ 个高斯分布的功值 $W_i$，计算出 $X_i = -\\beta W_i$。然后，使用上述四种方法在同一组数据上计算自由能的估计值。最后，通过从其他三种方法的估计值中减去高精度的参考估计值，计算出舍入诱导偏差。测试用例经过精心设计，旨在探测这些方法在不同数值条件下的表现，例如高耗散（导致 $X_i$ 值分布广）和宽动态范围。",
            "answer": "[0.0,0.0,0.0003058880567550659,inf,inf,2.288818359375e-05,inf,inf,-0.0004901885986328125,inf,inf,-2.353668212890625e-05]"
        }
    ]
}