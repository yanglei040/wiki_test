{
    "hands_on_practices": [
        {
            "introduction": "过渡路径采样的核心在于其能够在路径空间中进行有效的蒙特卡洛抽样。打靶移动 (shooting move) 是实现这一目标的关键算法之一。本练习旨在通过推导一个带偏置的打靶移动的接受率，来加深对细致平衡条件在保证正确抽样中的核心作用的理解，这是掌握TPS算法设计的基石 。",
            "id": "1195098",
            "problem": "在过渡路径采样 (Transition Path Sampling, TPS) 中，使用蒙特卡洛方法来采样连接两个稳定态 A 和 B 的反应性轨迹系综。从现有轨迹生成新的试验轨迹的常用算法是“射击移动”(shooting move)。\n\n考虑一个由时间可逆、确定性、能量守恒的动力学（例如，哈密顿动力学）支配的系统。我们感兴趣的系综是固定持续时间 $T$ 的过渡路径轨迹 $x(t) = (\\mathbf{q}(t), \\mathbf{p}(t))$ 的系综。该系综中给定轨迹 $x$ 的概率由下式给出\n$$\nP_{TP}[x] \\propto h_A(\\mathbf{q}(0)) h_B(\\mathbf{q}(T)) \\exp(-\\beta H[x])\n$$\n其中 $h_A$ 和 $h_B$ 是特征函数，如果轨迹分别从区域 A 开始并在区域 B 结束，则其值为 1，否则为 0。$H[x]$ 是轨迹的总能量（沿路径为常数），$\\beta$ 是逆温度。\n\n提出了一种有偏双向射击移动，以从旧路径 $x_{old}$ 生成新试验路径 $x_{new}$：\n1.  从旧路径 $x_{old}$ 中选择一个时间 $t_s \\in [0, T]$ 处的“射击点”。该选择受路径上势能 $U(\\mathbf{q}(t))$ 的影响而带有偏向，选择 $t_s$ 的概率密度由下式给出：\n    $$\n    p_{sel}(t_s|x) = \\frac{\\exp(\\gamma U(\\mathbf{q}(t_s)))}{W[x]}\n    $$\n    这里，$\\gamma$ 是一个恒定的偏向参数，$W[x] = \\int_0^T \\exp(\\gamma U(\\mathbf{q}(t'))) dt'$ 是一个与路径相关的归一化因子。\n\n2.  在选定的相空间点 $(\\mathbf{q}_{old}(t_s), \\mathbf{p}_{old}(t_s))$，通过添加一个随机向量 $\\delta \\mathbf{p}$ 来扰动动量，即 $\\mathbf{p}'(t_s) = \\mathbf{p}_{old}(t_s) + \\delta \\mathbf{p}$。扰动 $\\delta \\mathbf{p}$ 从一个对称的概率分布 $\\pi_{gen}(\\delta \\mathbf{p})$ 中抽取，即 $\\pi_{gen}(\\delta \\mathbf{p}) = \\pi_{gen}(-\\delta \\mathbf{p})$。\n\n3.  从新的相空间点 $(\\mathbf{q}_{old}(t_s), \\mathbf{p}'(t_s))$ 开始，通过沿时间正向和反向积分运动方程来生成一条新轨迹 $x_{new}$。注意，在射击时间 $t_s$，新旧路径具有相同的构型，$\\mathbf{q}_{new}(t_s) = \\mathbf{q}_{old}(t_s)$。仅当新路径也连接 A 和 B 时，该移动才被接受。\n\n为确保采样收敛到正确的分布 $P_{TP}[x]$，接受概率必须满足细致平衡条件。移动 $x_{old} \\to x_{new}$ 的 Metropolis-Hastings 接受概率由 $P_{acc} = \\min(1, \\alpha)$ 给出。\n\n推导此有偏射击移动的接受率 $\\alpha$ 的表达式。用能量 $H[x_{old}]$、$H[x_{new}]$，归一化因子 $W[x_{old}]$、$W[x_{new}]$ 以及逆温度 $\\beta$ 来表示你的答案。",
            "solution": "1. 过渡路径系综的权重为\n$$P_{TP}[x]\\propto h_A(\\mathbf q(0))\\,h_B(\\mathbf q(T))\\,e^{-\\beta H[x]}\\,. $$  \n2. Metropolis–Hastings 的细致平衡要求\n$$P_{TP}[x_{old}]\\,p_{prop}(x_{old}\\to x_{new})\\,P_{acc}  =  P_{TP}[x_{new}]\\,p_{prop}(x_{new}\\to x_{old})\\,P_{acc}^{\\rm rev}\\,. $$  \n因为我们带有偏向地选择 $t_s$\n$$p_{sel}(t_s|x)=\\frac{e^{\\gamma U(\\mathbf q(t_s))}}{W[x]}\\,,\\quad W[x]=\\int_0^T e^{\\gamma U(\\mathbf q(t'))}\\,dt'\\,, $$  \n并用对称的 $\\pi_{gen}(\\delta p)=\\pi_{gen}(-\\delta p)$ 扰动动量，正向和反向的提议密度为\n$$p_{prop}(x_{old}\\to x_{new})=p_{sel}(t_s|x_{old})\\,\\pi_{gen}(\\delta p),\\quad p_{prop}(x_{new}\\to x_{old})=p_{sel}(t_s|x_{new})\\,\\pi_{gen}(-\\delta p)\\,. $$  \n3. 提议密度的比率为\n$$\\frac{p_{prop}(x_{new}\\to x_{old})}{p_{prop}(x_{old}\\to x_{new})} \n=\\frac{p_{sel}(t_s|x_{new})}{p_{sel}(t_s|x_{old})}\n=\\frac{e^{\\gamma U(\\mathbf q(t_s))}/W[x_{new}]}{e^{\\gamma U(\\mathbf q(t_s))}/W[x_{old}]}\n=\\frac{W[x_{old}]}{W[x_{new}]}\\,. $$  \n4. 于是 Metropolis 比率为\n$$\n\\alpha\n=\\frac{P_{TP}[x_{new}]\\,p_{prop}(x_{new}\\to x_{old})}{P_{TP}[x_{old}]\\,p_{prop}(x_{old}\\to x_{new})}\n=\\frac{e^{-\\beta H[x_{new}]}}{e^{-\\beta H[x_{old}]}}\n\\;\\frac{W[x_{old}]}{W[x_{new}]}\n=\\exp\\!\\bigl(-\\beta(H[x_{new}]-H[x_{old}])\\bigr)\\,\\frac{W[x_{old}]}{W[x_{new}]}\\,. $$",
            "answer": "$$\\boxed{\\exp\\bigl(-\\beta\\bigl(H[x_{new}]-H[x_{old}]\\bigr)\\bigr)\\,\\frac{W[x_{old}]}{W[x_{new}]}}$$"
        },
        {
            "introduction": "过渡路径采样的理论基础是路径系综的概率分布，它通常由一个路径作用量 (path action) 来定义。本练习通过一个基础的谐振子模型，从过阻尼朗之万动力学出发，推导其连续时间极限下的Onsager-Machlup作用量 。这个推导过程将具体展示随机微分方程如何与路径积分语言建立联系，从而阐明路径权重的物理意义。",
            "id": "3498770",
            "problem": "在计算材料科学中用于稀有事件动力学的跃迁路径采样 (TPS) 中，一维空间中的过阻尼朗之万动力学常被用作受热涨落影响的原子或集体坐标的基本模型。考虑一个坐标为 $x(t)$ 的粒子，在绝对温度 $T$、迁移率为 $\\mu$、扩散系数为 $D$ 的过阻尼极限下，于势 $V(x)$ 中演化。该动力学由随机微分方程 $dx(t) = -\\mu\\,\\partial_{x}V(x(t))\\,dt + \\sqrt{2D}\\,dW_{t}$ 定义，其中 $W_{t}$ 是一个标准维纳过程，$D$ 和 $\\mu$ 满足爱因斯坦关系式 $D = \\mu k_{B} T$，$k_{B}$ 为玻尔兹曼常数。在固定观测时间 $\\tau$、时间步长 $\\Delta t$ 和步数 $N = \\tau/\\Delta t$ 的条件下，该动力学的一个离散化由欧拉-丸山格式 $x_{n+1} = x_{n} - \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t + \\sqrt{2D\\,\\Delta t}\\,\\eta_{n}$ 给出，其中 $\\eta_{n}$ 是独立的标准正态随机变量。对于具有固定端点 $x(0) = x_{A}$ 和 $x(\\tau) = x_{B}$ 的离散路径 $\\{x_{0}, x_{1}, \\dots, x_{N}\\}$，其 TPS 路径权重可以写成路径泛函 $S[x]$（作用量）的指数形式，在连续时间极限下，该泛函定义了与路径系综采样和重加权相关的昂萨格-马赫卢普泛函。\n\n从上述欧拉-丸山格式和爱因斯坦关系式所蕴含的离散时间转移核出发，推导谐振势 $V(x) = \\frac{1}{2}k x^{2}$（其中 $k > 0$ 为恒定刚度）的作用量 $S[x]$ 的显式连续时间形式。仅使用所述的基本动力学和关系式来构建路径概率密度，并在小 $\\Delta t$（$\\tau$ 固定）的极限下确定 $S[x]$。然后，通过分析离散时间转移核，验证路径测度在增量上是高斯的，并且在小 $\\Delta t$ 的极限下是可归一化的。\n\n将最终的作用量 $S[x]$ 表示为 $x(t)$、$\\mu$、$D$、$k$ 和 $\\tau$ 的单个闭式解析泛函。无需进行数值计算。",
            "solution": "过阻尼朗之万动力学 $dx(t) = -\\mu\\,\\partial_{x}V(x(t))\\,dt + \\sqrt{2D}\\,dW_{t}$（其中 $D = \\mu k_{B} T$）定义了一个马尔可夫过程，其通过欧拉-丸山格式的离散时间近似为 $x_{n+1} = x_{n} - \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t + \\sqrt{2D\\,\\Delta t}\\,\\eta_{n}$，其中 $\\eta_{n}$ 是独立的标准正态随机变量。一步的条件转移密度是高斯的，由下式给出\n$$\np(x_{n+1}\\,|\\,x_{n}) = \\frac{1}{\\sqrt{4\\pi D\\,\\Delta t}} \\exp\\!\\left(-\\frac{\\left[x_{n+1} - x_{n} + \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t\\right]^{2}}{4D\\,\\Delta t}\\right).\n$$\n这是由 $\\eta_{n}$ 的分布以及在固定 $x_{n}$ 的情况下将 $\\eta_{n}$ 与 $x_{n+1}$ 联系起来的仿射变换得出的。对于具有固定端点的路径 $\\{x_{0}, x_{1}, \\dots, x_{N}\\}$，其（未归一化的）路径概率密度是步进条件密度的乘积，\n$$\n\\mathcal{P}[\\{x_{n}\\}] \\propto \\prod_{n=0}^{N-1} \\exp\\!\\left(-\\frac{\\left[x_{n+1} - x_{n} + \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t\\right]^{2}}{4D\\,\\Delta t}\\right),\n$$\n该式不含归一化因子 $\\left(4\\pi D\\,\\Delta t\\right)^{-N/2}$，当视为给定 $x_n$ 的连续 $x_{n+1}$ 的条件密度时，该因子与具体路径无关。通过 $\\mathcal{P}[\\{x_{n}\\}] \\propto \\exp(-S[\\{x_{n}\\}])$ 确定作用量 $S[x]$，我们得到离散时间作用量\n$$\nS[\\{x_{n}\\}] = \\sum_{n=0}^{N-1} \\frac{\\left[x_{n+1} - x_{n} + \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t\\right]^{2}}{4D\\,\\Delta t}.\n$$\n我们现在专门讨论谐振势 $V(x) = \\frac{1}{2}k x^{2}$，此时 $\\partial_{x}V(x) = k x$。离散作用量变为\n$$\nS[\\{x_{n}\\}] = \\sum_{n=0}^{N-1} \\frac{\\left[x_{n+1} - x_{n} + \\mu k x_{n}\\,\\Delta t\\right]^{2}}{4D\\,\\Delta t}.\n$$\n为了获得连续时间作用量，我们考虑 $\\Delta t \\to 0$ 且 $\\tau = N\\,\\Delta t$ 固定的极限，此时 $x_{n+1} - x_{n} \\approx \\dot{x}(t_{n})\\,\\Delta t$，其中 $t_{n} = n\\,\\Delta t$。将该和式重写为黎曼和，然后再写成时间积分，我们得到\n$$\nS[x] = \\int_{0}^{\\tau} \\frac{\\left[\\dot{x}(t) + \\mu k x(t)\\right]^{2}}{4D}\\,dt.\n$$\n该表达式是在具有恒定扩散的谐振势中过阻尼粒子的昂萨格-马赫卢普作用量。它捕捉了偏离确定性漂移 $\\dot{x}(t) = -\\mu k x(t)$ 的二次惩罚，并由噪声强度 $D$ 进行缩放。\n\n我们现在验证在小 $\\Delta t$ 的极限下，路径测度是高斯的且可归一化。步进条件密度 $p(x_{n+1}\\,|\\,x_{n})$ 是关于变量 $x_{n+1}$ 的高斯分布，其均值为\n$$\nm_{n} = x_{n} - \\mu\\,\\partial_{x}V(x_{n})\\,\\Delta t = x_{n} - \\mu k x_{n}\\,\\Delta t,\n$$\n方差为\n$$\n\\sigma^{2} = 2D\\,\\Delta t.\n$$\n其高斯形式是明确的，并且对于每一步，\n$$\n\\int_{-\\infty}^{\\infty} p(x_{n+1}\\,|\\,x_{n})\\,dx_{n+1} = 1,\n$$\n因为对于任何 $\\Delta t > 0$，归一化因子 $1/\\sqrt{4\\pi D\\,\\Delta t}$ 和二次指数定义了一个正确归一化的高斯分布。在极限 $\\Delta t \\to 0$ 时，方差 $\\sigma^{2} = 2D\\,\\Delta t$ 趋于 $0$，这反映了每个时间步长的弱噪声标度，但序列乘积结构确保了整体路径测度（被视为归一化条件密度的复合）在具有固定端点和马尔可夫演化的轨迹空间上保持归一化。增量 $x_{n+1} - x_{n}$ 具有均值 $-\\mu k x_{n}\\,\\Delta t$ 和方差 $2D\\,\\Delta t$ 的高斯特性，这确保了离散路径权重具有用于定义 $S[\\{x_{n}\\}]$ 的二次形式，并且取连续极限可以得到上面推导的二次昂萨格-马赫卢普泛函 $S[x]$。与漂移的散度相关的任何附加项（对于伊藤诠释）将是 $\\frac{\\mu}{2}\\int_{0}^{\\tau} \\partial_{x}^{2}V(x(t))\\,dt = \\frac{\\mu}{2}\\int_{0}^{\\tau} k\\,dt = \\frac{\\mu k \\tau}{2}$，这是路径无关的，因此仅对路径测度的整体归一化有贡献；它不改变高斯特性和可归一化性，在关注相对路径权重时可以从 $S[x]$ 中省略。\n\n因此，对于谐振势，显式连续时间作用量泛函为\n$$\nS[x] = \\int_{0}^{\\tau} \\frac{\\left[\\dot{x}(t) + \\mu k x(t)\\right]^{2}}{4D}\\,dt,\n$$\n并且离散时间路径测度在增量上是高斯的，方差为 $2D\\,\\Delta t$，从而在每一步产生一个归一化的条件转移核，并在小 $\\Delta t$ 极限下产生一个可归一化的路径概率密度。",
            "answer": "$$\\boxed{S[x]=\\int_{0}^{\\tau}\\frac{\\left[\\dot{x}(t)+\\mu\\,k\\,x(t)\\right]^{2}}{4D}\\,dt}$$"
        },
        {
            "introduction": "在研究复杂相变时，一个核心问题是：单个最小能量路径是否足以描述整个转变过程？本练习通过一个简化的波纹二维材料模型，量化对比了系综方法（TPS）和单路径方法（弦方法）。通过计算路径熵和有效路径数，你将学会判断何时必须考虑多路径机制，从而理解TPS在揭示复杂反应机理时的独特优势。",
            "id": "3498842",
            "problem": "考虑一个二维粗粒化能量景观，该景观模拟了一种波纹状二维材料中的相变。设反应坐标被建模为一个纵向坐标 $x$，它连接了位于 $x < -x_0$ 的盆地 $A$ 和位于 $x > x_0$ 的盆地 $B$。设横向坐标 $y$ 代表由波纹引起的平行过渡通道。势垒区域以 $x \\approx 0$ 为中心，波纹在由 $j \\in \\{0,1,\\dots,M-1\\}$ 索引的 $M$ 个离散横向通道上调制势垒高度。通道 $j$ 的势垒高度规定为\n$$\n\\Delta U_j = \\Delta U_0 + w \\sin^2\\left(\\frac{\\pi j}{M}\\right),\n$$\n其中 $\\Delta U_0$ 是基础势垒， $w$ 是波纹振幅， $M$ 是通道数量。假设在逆温度为 $\\beta$（无量纲单位）的热浴中存在过阻尼动力学，并假设通道 $j$ 对过渡系综的贡献与玻尔兹曼因子 $\\exp(-\\beta \\Delta U_j)$ 成正比。\n\n此处，过渡路径采样（Transition Path Sampling, TPS）被理解为对连接 $A$ 和 $B$ 的所有反应性轨迹的系综进行采样；在上述假设下，采用通道 $j$ 的路径概率为\n$$\np_j = \\frac{\\exp(-\\beta \\Delta U_j)}{\\sum_{k=0}^{M-1} \\exp(-\\beta \\Delta U_k)}.\n$$\n定义路径熵\n$$\nS_{\\text{path}} = -\\sum_{j=0}^{M-1} p_j \\ln p_j,\n$$\n以及有效贡献路径数\n$$\nN_{\\text{eff}} = \\exp\\left(S_{\\text{path}}\\right).\n$$\n弦方法（string method）旨在寻找一条具有代表性的最小能量路径，它会选择具有最小势垒 $\\Delta U_{\\min} = \\min_j \\Delta U_j$ 的通道，并预测一个与以下表达式成正比的单路径速率\n$$\nk_{\\text{string}} \\propto \\exp(-\\beta \\Delta U_{\\min}).\n$$\nTPS 系综预测的总速率与所有通道的总和成正比，\n$$\nk_{\\text{TPS}} \\propto \\sum_{j=0}^{M-1} \\exp(-\\beta \\Delta U_j).\n$$\n为了量化单路径近似何时因高路径熵而失效，考虑两个互补的标准：\n- 速率主导性标准：定义比率\n$$\nr = \\frac{k_{\\text{string}}}{k_{\\text{TPS}}} = \\frac{\\exp(-\\beta \\Delta U_{\\min})}{\\sum_{j=0}^{M-1} \\exp(-\\beta \\Delta U_j)}.\n$$\n如果 $r \\leq 0.6$，则认为单路径近似失效。\n- 熵标准：如果 $N_{\\text{eff}} \\geq 2.0$，则认为单路径近似失效。\n\n你的任务是实现一个程序，对于每个测试用例，计算 $\\Delta U_j$、$p_j$、$S_{\\text{path}}$、$N_{\\text{eff}}$、$r$，并在速率主导性标准或熵标准任一被触发时返回一个指示失败的布尔值。\n\n所有量都是无量纲的；不要包含物理单位。在数值计算中，角度（三角函数参数）通常是无量纲的。\n\n测试套件：\n- 案例 1：$M=8$，$\\beta=1.0$，$\\Delta U_0=10.0$， $w=2.0$。\n- 案例 2：$M=8$，$\\beta=5.0$，$\\Delta U_0=10.0$， $w=2.0$。\n- 案例 3：$M=1$，$\\beta=1.0$，$\\Delta U_0=10.0$， $w=2.0$。\n- 案例 4：$M=16$，$\\beta=0.5$，$\\Delta U_0=5.0$， $w=1.0$。\n- 案例 5：$M=64$，$\\beta=1.0$，$\\Delta U_0=10.0$, $w=0.5$。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个用方括号括起来的、以逗号分隔的布尔结果列表（例如，“[True,False,True,False,True]”）。顺序必须与上述测试套件的顺序相匹配。",
            "solution": "目标是在一种波纹状二维材料中，比较来自过渡路径采样（Transition Path Sampling, TPS）的反应性轨迹的系综观点与来自弦方法的单路径表示。这种比较应揭示单路径近似何时因高路径熵而失效，即许多不同的路径对相变有显著贡献。\n\n我们从逆温度为 $\\beta$ 的热浴中的过阻尼动力学出发，并采用过渡态理论（Transition State Theory, TST）关于稀有事件跨越势垒的核心假设：具有势垒 $\\Delta U$ 的路径对速率的贡献与玻尔兹曼因子 $\\exp(-\\beta \\Delta U)$ 成正比。这源于活化过程的类阿伦尼乌斯形式，并且当惯性和再穿越可以忽略时，这是一种广泛使用的近似。\n\n我们将横向波纹离散化为 $M$ 个通道，用 $j \\in \\{0,1,\\dots,M-1\\}$ 标记，每个通道都有一个势垒\n$$\n\\Delta U_j = \\Delta U_0 + w \\sin^2\\left(\\frac{\\pi j}{M}\\right).\n$$\n这种函数形式对于波纹状势垒是物理上合理的：$\\sin^2$ 是非负、周期性的，并且当 $M \\geq 2$ 时，会产生一系列不同的通道，在 $j=0$ 处有唯一的最小值。最大波纹增量 $w$ 设定了势垒相对于最小值的最大提升量。$M=1$ 的情况恢复为具有势垒 $\\Delta U_0$ 的单路径。\n\n在 TST 假设下，由过渡路径采样（TPS）采样的反应性轨迹遵循通道 $j$ 的概率 $p_j$ 与其玻尔兹曼权重成正比：\n$$\np_j = \\frac{\\exp(-\\beta \\Delta U_j)}{\\sum_{k=0}^{M-1} \\exp(-\\beta \\Delta U_k)}.\n$$\n这是因为 TPS 根据每个过渡路径的动力学权重对反应路径系综进行采样，并且对于过阻尼势垒穿越，在附加假设（即指前因子在所有通道上近似均匀）下，这些权重简化为势垒高度的玻尔兹曼因子。总 TPS 速率与所有通道的总和成正比：\n$$\nk_{\\text{TPS}} \\propto \\sum_{j=0}^{M-1} \\exp(-\\beta \\Delta U_j).\n$$\n\n相反，弦方法通过最小化连接 $A$ 和 $B$ 的曲线上的能量（或自由能）来构建一条具有代表性的单路径。在当前的粗粒化设置中，这简化为选择具有最小势垒高度的通道，\n$$\n\\Delta U_{\\min} = \\min_{j} \\Delta U_j,\n$$\n以及相应的单路径速率预测\n$$\nk_{\\text{string}} \\propto \\exp(-\\beta \\Delta U_{\\min}).\n$$\n当接近最小值的通道之间存在显著的简并性，或者波纹振幅 $w$ 相对于热能 $1/\\beta$ 很小时，许多通道都会对 $k_{\\text{TPS}}$ 做出贡献，而弦方法仍然只报告一条路径。这种差异由两个度量标准捕获。\n\n首先，考虑比率\n$$\nr = \\frac{k_{\\text{string}}}{k_{\\text{TPS}}} = \\frac{\\exp(-\\beta \\Delta U_{\\min})}{\\sum_{j=0}^{M-1} \\exp(-\\beta \\Delta U_j)}.\n$$\n当 $r$ 接近 $1$ 时，单个通道在过渡系综中占主导地位，单路径图像是足够的。当 $r$ 很小时，许多通道都有贡献，单路径近似会低估系综速率并错误地表示机理的多样性。采用阈值 $r \\leq 0.6$ 来标记失效，表示单路径贡献最多占总系综速率的 $60\\%$。\n\n其次，考虑路径熵\n$$\nS_{\\text{path}} = -\\sum_{j=0}^{M-1} p_j \\ln p_j.\n$$\n这是路径分布的香农熵，衡量了贡献通道的多重性和分布广度。有效贡献路径数定义为\n$$\nN_{\\text{eff}} = \\exp(S_{\\text{path}}),\n$$\n对于单路径，该值等于 $1$，并随着携带不可忽略概率质量的通道数量的增加而增长。阈值 $N_{\\text{eff}} \\geq 2.0$ 标记失效，意味着需要至少两个有效通道来表示过渡系综。\n\n算法步骤：\n- 对于给定的 $(M, \\beta, \\Delta U_0, w)$，通过计算 $\\Delta U_j = \\Delta U_0 + w \\sin^2(\\pi j / M)$ 来计算所有 $j \\in \\{0,1,\\dots,M-1\\}$ 的 $\\Delta U_j$。\n- 计算权重 $W_j = \\exp(-\\beta \\Delta U_j)$ 及其总和 $W_{\\text{sum}} = \\sum_j W_j$。\n- 计算 $p_j = W_j / W_{\\text{sum}}$，$S_{\\text{path}} = -\\sum_j p_j \\ln p_j$，$N_{\\text{eff}} = \\exp(S_{\\text{path}})$。\n- 计算 $\\Delta U_{\\min} = \\min_j \\Delta U_j$ 和 $k_{\\text{string}} \\propto \\exp(-\\beta \\Delta U_{\\min})$。无需比例常数，计算 $r = \\exp(-\\beta \\Delta U_{\\min}) / W_{\\text{sum}}$。\n- 如果 $r \\leq 0.6$ 或 $N_{\\text{eff}} \\geq 2.0$ 任一条件成立，则返回一个布尔失败指示符。\n\n测试套件解释：\n- 案例 1 中 $M=8, \\beta=1.0, \\Delta U_0=10.0, w=2.0$，产生了许多势垒在最小值 $\\mathcal{O}(1)$ 范围内的通道；比率 $r$ 很小， $N_{\\text{eff}}$ 很大，表明单路径近似失效。\n- 案例 2 中 $M=8, \\beta=5.0, \\Delta U_0=10.0, w=2.0$，对应于较低的温度；对较高势垒的热抑制增加了 $r$ 并减小了 $N_{\\text{eff}}$，通常使单路径足够。\n- 案例 3 中 $M=1$，只有一个通道；$r=1$ 且 $N_{\\text{eff}}=1$，因此单路径近似有效。\n- 案例 4 中 $M=16, \\beta=0.5, \\Delta U_0=5.0, w=1.0$，温度适中且通道众多；系综分布宽，单路径近似失效。\n- 案例 5 中 $M=64, \\beta=1.0, \\Delta U_0=10.0, w=0.5$，通道众多且波纹很小；通道间的近简并性导致大的 $N_{\\text{eff}}$ 和小的 $r$，再次表明失效。\n\n程序实现了这些计算，并以指定格式用一行输出五个案例的布尔值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef evaluate_case(M: int, beta: float, dU0: float, w: float,\n                  r_threshold: float = 0.6, Neff_threshold: float = 2.0) -> bool:\n    \"\"\"\n    Evaluate one test case:\n    - Compute channel barriers DeltaU_j = dU0 + w * sin^2(pi * j / M)\n    - Compute weights W_j = exp(-beta * DeltaU_j)\n    - Compute p_j = W_j / sum(W)\n    - Compute path entropy S = -sum p_j * ln p_j and N_eff = exp(S)\n    - Compute r = exp(-beta * min(DeltaU)) / sum(W)\n    - Return failure boolean if r = r_threshold or N_eff >= Neff_threshold\n    \"\"\"\n    # Handle M=1 gracefully: single channel at j=0\n    j_indices = np.arange(M, dtype=float)\n    # Compute sin^2 term; for M=1, this yields sin^2(0) = 0 as desired\n    sin2 = np.sin(np.pi * j_indices / M) ** 2 if M > 0 else np.array([0.0])\n    DeltaU = dU0 + w * sin2\n\n    # Boltzmann weights\n    W = np.exp(-beta * DeltaU)\n    W_sum = np.sum(W)\n\n    # Channel probabilities\n    p = W / W_sum\n    # Avoid log(0) by masking zero probabilities (shouldn't occur with finite beta and w)\n    # Still, guard against numerical underflow\n    with np.errstate(divide='ignore', invalid='ignore'):\n        logp = np.log(p, where=(p > 0), out=np.full_like(p, -np.inf))\n    # Entropy: define 0 * log(0) as 0\n    S_path = -np.sum(np.where(p > 0, p * logp, 0.0))\n    N_eff = float(np.exp(S_path))\n\n    # String method (single-path) rate ratio\n    DeltaU_min = float(np.min(DeltaU))\n    r = float(np.exp(-beta * DeltaU_min) / W_sum)\n\n    # Failure criteria\n    fail = (r = r_threshold) or (N_eff >= Neff_threshold)\n    return fail\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (M, beta, DeltaU0, w)\n    test_cases = [\n        (8, 1.0, 10.0, 2.0),   # Case 1\n        (8, 5.0, 10.0, 2.0),   # Case 2\n        (1, 1.0, 10.0, 2.0),   # Case 3\n        (16, 0.5, 5.0, 1.0),   # Case 4\n        (64, 1.0, 10.0, 0.5),  # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        M, beta, dU0, w = case\n        result = evaluate_case(M, beta, dU0, w)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}