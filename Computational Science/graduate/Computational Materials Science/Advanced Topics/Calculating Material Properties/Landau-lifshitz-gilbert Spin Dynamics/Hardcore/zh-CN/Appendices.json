{
    "hands_on_practices": [
        {
            "introduction": "构建微磁学模拟的第一步是将连续的物理模型转化为离散的数值形式。本练习将指导您从交换能泛函出发，通过变分原理在有限差分网格上推导交换场的离散算子，这是将LLG方程的物理原理转化为可计算算法的基础。通过这个实践，您将掌握处理微分算子和在数值模型中恰当施加诺伊曼边界条件（Neumann boundary conditions）的关键技能。",
            "id": "3460200",
            "problem": "考虑一个铁磁长方体，它被离散化到一个均匀、以单元为中心、沿每个笛卡尔方向单元尺寸均为 $\\Delta$ 的立方有限差分网格上。磁化场 $\\mathbf{m}(\\mathbf{r},t)$ 是一个单位矢量场。微磁交换能密度由 $A \\, |\\nabla \\mathbf{m}|^{2}$ 给出，其中 $A$ 是交换刚度。在 Landau–Lifshitz–Gilbert 动力学中，相应的交换有效场由交换能对 $\\mathbf{m}$ 的变分导数得到。\n\n从交换能泛函出发，并仅使用上述网格上的标准有限体积或有限差分近似，推导一个离散交换场算子，该算子与一个逐分量作用于 $\\mathbf{m}$ 的离散拉普拉斯算子成正比。在长方体的边界上施加法向导数为零的边界条件 $\\partial_{n} \\mathbf{m} = 0$。你的推导应：\n- 从交换能积分和该积分在网格上的一致离散近似开始。\n- 使用变分法来获得扮演拉普拉斯算子角色的离散算子。\n- 解释如何在边界单元上引入法向导数为零的边界条件，以及为什么这种实现与变分推导是一致的。\n\n最后，考虑一个位于平面边界上的边界单元，其向外单位法线沿 $x$ 负方向（即位于 $x=0$ 的面上，因此该单元没有 $-x$ 方向的邻居）。对于 $\\mathbf{m}$ 的一个笛卡尔分量，写出此边界单元上离散拉普拉斯算子的七点有限差分模板系数，并按 $[\\text{中心}, +x, -x, +y, -y, +z, -z]$ 的顺序列出这些系数。将你的最终答案表示为关于 $\\Delta$ 的单个行向量。无需进行数值计算。",
            "solution": "该问题要求从连续交换能泛函出发，在有限差分网格上推导一个离散交换场算子。推导过程必须采用变分法，并引入法向导数为零的边界条件。最后，必须确定在边界单元上所得离散拉普拉斯算子的具体模板系数。\n\n占据体积 $V$ 的铁磁体的连续交换能泛函由下式给出：\n$$E_{ex} = \\int_V A |\\nabla \\mathbf{m}|^2 dV$$\n其中 $A$ 是交换刚度常数，$\\mathbf{m} = (m_x, m_y, m_z)$ 是归一化的磁化矢量场，即 $|\\mathbf{m}| = 1$。项 $|\\nabla \\mathbf{m}|^2$ 是各分量梯度平方和的简写：\n$$|\\nabla \\mathbf{m}|^2 = |\\nabla m_x|^2 + |\\nabla m_y|^2 + |\\nabla m_z|^2 = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left( \\left(\\frac{\\partial m_\\alpha}{\\partial x}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial y}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial z}\\right)^2 \\right)$$\n\n为了在单元尺寸为 $\\Delta$ 的均匀立方网格上离散化该能量，我们可以将积分近似为对所有单元的求和。然而，对于基于导数的能量，一个更稳健的方法是离散化与相邻单元之间的连接相关的能量贡献。我们在连接两个相邻单元的链路上近似空间导数，并在体积上对能量密度求和。例如，项 $\\int (\\frac{\\partial m_\\alpha}{\\partial x})^2 dV$ 可以通过考虑单元 $(i,j,k)$ 和 $(i+1,j,k)$ 之间的导数来离散化。导数近似为 $\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta}$。能量密度为 $(\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2$。将此能量与一个体积元 $\\Delta^3$ 相关联（例如，以单元之间的面为中心的体积），能量贡献为 $A (\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2 \\Delta^3 = A \\Delta (m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k})^2$。\n\n对网格中所有最近邻连接求和，总的离散交换能 $E_{ex}^{disc}$ 可以写为：\n$$E_{ex}^{disc} = A \\Delta \\sum_{\\langle p, p' \\rangle} |\\mathbf{m}_p - \\mathbf{m}_{p'}|^2$$\n其中求和是对网格中所有唯一的最近邻单元对 $\\langle p, p' \\rangle$ 进行的。为避免重复计算，一种等效的写法是，对每个单元 $p = (i,j,k)$ 及其在正轴方向上的邻居求和：\n$$E_{ex}^{disc} = A \\Delta \\sum_{i,j,k} \\left( |\\mathbf{m}_{i+1,j,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j+1,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j,k+1} - \\mathbf{m}_{i,j,k}|^2 \\right)$$\n其中 $|\\mathbf{v}|^2 = v_x^2 + v_y^2 + v_z^2$。\n\n交换有效场 $\\mathbf{H}_{ex}$ 是从能量的变分导数推导出来的。在离散情况下，单元 $p$ 处的场与 $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$ 成正比。我们寻求一个与此导数成正比的算子。让我们计算该导数的一个分量，针对一个内部单元 $p_0 = (i,j,k)$ 的任意分量 $\\alpha \\in \\{x,y,z\\}$。\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,p_0}} = \\frac{\\partial}{\\partial m_{\\alpha,i,j,k}} E_{ex}^{disc}$$\n$E_{ex}^{disc}$ 中依赖于 $\\mathbf{m}_{i,j,k}$ 的项是那些连接单元 $(i,j,k)$ 与其六个最近邻单元 $(i\\pm 1,j,k)$, $(i,j\\pm 1,k)$, 和 $(i,j,k\\pm 1)$ 的项。我们将 $\\mathbf{m}_{i,j,k}$ 记为 $\\mathbf{m}_0$，其邻居记为 $\\mathbf{m}_{\\pm x}, \\mathbf{m}_{\\pm y}, \\mathbf{m}_{\\pm z}$。能量的相关部分是：\n$$E_{rel} = A \\Delta \\left( |\\mathbf{m}_{+x}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-x}|^2 + |\\mathbf{m}_{+y}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-y}|^2 + |\\mathbf{m}_{+z}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-z}|^2 \\right)$$\n关于 $m_{\\alpha,0}$ 的导数是：\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = A \\Delta \\left( -2(m_{\\alpha,+x}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-x}) -2(m_{\\alpha,+y}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-y}) -2(m_{\\alpha,+z}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-z}) \\right)$$\n整理关于 $m_{\\alpha,0}$ 的项：\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = 2A\\Delta \\left( 6m_{\\alpha,0} - (m_{\\alpha,+x} + m_{\\alpha,-x} + m_{\\alpha,+y} + m_{\\alpha,-y} + m_{\\alpha,+z} + m_{\\alpha,-z}) \\right)$$\n作用于标量场 $f$ 的拉普拉斯算子 $\\nabla^2$ 的标准七点有限差分近似是：\n$$(\\nabla_d^2 f)_i = \\frac{f_{i+1,j,k} + f_{i-1,j,k} + f_{i,j+1,k} + f_{i,j-1,k} + f_{i,j,k+1} + f_{i,j,k-1} - 6f_{i,j,k}}{\\Delta^2}$$\n将此与我们的导数进行比较，我们发现：\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,i,j,k}} = -2A\\Delta \\Delta^2 (\\nabla_d^2 m_\\alpha)_{i,j,k} = -2A\\Delta^3 (\\nabla_d^2 m_\\alpha)_{i,j,k}$$\n因此，单元 $p$ 处的有效场算子与 $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$ 成正比，而后者又与 $2A\\Delta^3 \\nabla_d^2 \\mathbf{m}_p$ 成正比。因此，离散交换场算子与逐分量作用于 $\\mathbf{m}$ 的离散拉普拉斯算子成正比。\n\n接下来，我们引入边界条件 $\\partial_n \\mathbf{m} = 0$，其中 $\\partial_n$ 是沿向外法线方向的导数。从连续泛函的变分可以看出，这是交换能最小化的一个自然边界条件：\n$$\\delta E_{ex} = 2A \\int_V (\\nabla \\mathbf{m}) \\cdot (\\nabla \\delta \\mathbf{m}) dV = \\int_S 2A (\\delta\\mathbf{m}) \\cdot (\\partial_n \\mathbf{m}) dS - \\int_V 2A (\\delta\\mathbf{m}) \\cdot (\\nabla^2 \\mathbf{m}) dV$$\n为了使体积分能够定义有效场，面积分必须为零。如果边界上 $\\delta\\mathbf{m}=0$（固定边界条件）或 $\\partial_n \\mathbf{m} = 0$（自由边界条件），面积分就为零。本问题施加的是后者。\n在离散模型中，这个条件通过使用虚拟单元来实现。考虑一个位于 $x=0$ 面上的边界单元。其向外法线为 $\\mathbf{n}=-\\hat{x}$。边界条件为 $-\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$，或简写为 $\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$。设该边界单元的索引为 $(0,j,k)$。该单元的一般拉普拉斯表达式需要用到不存在的邻居 $(-1,j,k)$ 处的值，这是一个虚拟单元。我们使用边界条件来定义这个虚拟单元中的值。用中心差分来近似边界（单元 0 和 -1 之间）上的导数：\n$$\\frac{\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}}{\\Delta} = 0 \\quad \\implies \\quad \\mathbf{m}_{-1,j,k} = \\mathbf{m}_{0,j,k}$$\n这意味着虚拟单元中的磁化强度被设定为等于相邻边界单元中的磁化强度。这与变分推导是一致的，因为来自单元 $(0,j,k)$ 和虚拟单元 $(-1,j,k)$ 之间连接的能量贡献，即 $A\\Delta|\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}|^2$，为零。这对应于边界外没有交换力矩。\n\n最后，我们求出这个边界单元 $(0,j,k)$ 处离散拉普拉斯算子 $\\nabla_d^2$ 的模板系数。我们使用拉普拉斯算子的一般表达式，并代入虚拟单元的值。对于任意分量 $m_\\alpha$，我们将其记为 $m$：\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{-1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\n代入 $m_{-1,j,k} = m_{0,j,k}$：\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{0,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\n整理各项：\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{-5 m_{0,j,k} + m_{1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1}}{\\Delta^2}$$\n该算子是中心单元及其真实邻居处值的线性组合。按 $[\\text{中心}, +x, -x, +y, -y, +z, -z]$ 顺序排列的七点模板系数是 $m_{0,j,k}$、$m_{1,j,k}$、$m_{-1,j,k}$（它不是一个真实单元）、$m_{0,j+1,k}$ 等的系数。\n中心单元 $(0,j,k)$ 的系数是 $\\frac{-5}{\\Delta^2}$。\n$+x$ 邻居 $(1,j,k)$ 的系数是 $\\frac{1}{\\Delta^2}$。\n$-x$ 邻居的系数是 $0$，因为这个位置在计算域之外。\n$\\pm y$ 和 $\\pm z$ 邻居的系数都是 $\\frac{1}{\\Delta^2}$。\n\n最终的系数向量是：\n$$ \\left[ \\frac{-5}{\\Delta^2}, \\frac{1}{\\Delta^2}, 0, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2} \\right] $$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{-5}{\\Delta^2}  \\frac{1}{\\Delta^2}  0  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在处理了短程的交换相互作用后，我们必须解决计算上更具挑战性的长程退磁场。本练习探讨了利用卷积定理和快速傅里叶变换（FFT）高效计算退磁场的标准方法，并深入分析了开放边界条件与周期性边界条件对计算结果的根本性影响。通过分析这些场景，您可以深刻理解数值方法的选择（例如零填充）如何直接对应于不同的物理系统，这是微磁学模拟中一个至关重要且精妙的概念。",
            "id": "3460239",
            "problem": "考虑一个用于朗道-栗弗席兹-吉尔伯特（LLG）方程的有限差分微磁求解器，该求解器使用有效场 $\\mathbf{H}_\\mathrm{eff}(\\mathbf{r}, t)$ 在时间上推进磁化场 $\\mathbf{M}(\\mathbf{r}, t)$，其中有效场包括退磁（静磁）场 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$。该求解器采用一种基于快速傅里叶变换（FFT）的算法，通过与退磁张量核在开放边界条件（有限样本）或周期性边界条件（PBC）下进行卷积，从 $\\mathbf{M}(\\mathbf{r})$ 计算 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$。您的任务是根据静磁学和卷积的定义进行推理，以评估基于FFT的方法应如何构建，以及PBC如何改变最终的场。\n\n使用以下内容作为您的基本依据：\n- 无自由电流情况下的静磁麦克斯韦方程组：$\\nabla \\cdot \\mathbf{B} = 0$，$\\nabla \\times \\mathbf{H} = \\mathbf{0}$，其中 $\\mathbf{B} = \\mu_0 (\\mathbf{H} + \\mathbf{M})$，$\\mu_0$ 是自由空间磁导率。\n- 退磁场源于 $\\nabla \\cdot \\mathbf{H} = - \\nabla \\cdot \\mathbf{M}$，并且可以从满足 $\\nabla^2 \\phi(\\mathbf{r}) = \\nabla \\cdot \\mathbf{M}(\\mathbf{r})$ 和 $\\mathbf{H}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$ 的标量静磁势 $\\phi(\\mathbf{r})$ 获得。\n- 在有限网格上应用离散傅里叶变换时，实空间中的卷积在傅里叶空间中变为乘法，除非采取预防措施，否则会产生循环卷绕。\n\n假设一个均匀的笛卡尔网格，有 $N_x \\times N_y \\times N_z$ 个单元，尺寸分别为 $a_x$、$a_y$ 和 $a_z$。退磁场在每个时间步通过使用FFT将离散实空间退磁张量核 $\\mathbf{N}(\\mathbf{r})$ 与 $\\mathbf{M}(\\mathbf{r})$ 进行卷积来计算一次。该求解器支持开放边界条件（有限样本，无周期性）和周期性边界条件，后者可应用于所有3个维度或仅面内（$x,y$）维度，代表沿z轴具有有限厚度的无限薄膜。\n\n选择所有关于基于FFT的计算以及周期性边界条件对退磁场和能量影响的正确陈述：\n\nA. 在有限差分微磁代码中，通过与 $\\mathbf{N}(\\mathbf{r})$ 进行卷积来计算 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$ 的高效实现方法是：将 $\\mathbf{M}(\\mathbf{r})$ 和 $\\mathbf{N}(\\mathbf{r})$ 都嵌入到一个尺寸至少为 $2N_x \\times 2N_y \\times 2N_z$ 的零填充数组中，进行离散傅里叶变换，在倒易空间中相乘，即 $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$，然后进行逆变换。若不进行填充，开放边界条件会因循环卷绕和镜像自相互作用而遭到破坏。\n\nB. 在所有三个维度上都采用完全周期性边界条件的情况下，退磁张量的 $\\mathbf{k} = \\mathbf{0}$ 分量应设置为 $\\mathbf{N}(\\mathbf{0}) = \\mathbf{I}$（单位张量），这样空间均匀的磁化将处处产生退磁场 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}(\\mathbf{r})$。\n\nC. 对于一个在 $x$ 和 $y$ 方向上周期性但在 $z$ 方向上开放的薄膜（二维PBC），空间均匀的面外磁化 $\\mathbf{M}(\\mathbf{r}) = M_0 \\hat{\\mathbf{z}}$ 产生的平均退磁场为 $\\mathbf{H}_\\mathrm{d} = - M_0 \\hat{\\mathbf{z}}$，而空间均匀的面内磁化产生的平均退磁场为零。如果退磁张量在面内是周期性的，但在 $z$ 方向上保留了物理上的非周期性格林函数，则可以通过FFT卷积重现此行为。\n\nD. 在FFT卷积中施加完全周期性边界条件等效于对计算单元的无限周期性镜像求和偶极相互作用；因此，对于空间均匀的磁化，在完全周期性边界条件下的退磁能量密度恒等于零，而在开放边界条件下，其值为 $\\frac{1}{2} \\mu_0 M_0^2 N_\\mathrm{shape}$，其中 $N_\\mathrm{shape}$ 是有限样本的与形状相关的退磁因子。\n\nE. 在离散傅里叶卷积中，高频分量的混叠是无害的，因为实空间退磁核以 $1/r^3$ 的形式衰减；因此，即使对于开放边界条件，零填充也是不必要的。\n\n选择所有正确的选项。",
            "solution": "分析始于对问题陈述的验证，该陈述在科学上是合理的、提法恰当，并且基于静磁学和计算物理学的既定原理。问题要求评估关于在微磁模拟中基于快速傅里叶变换（FFT）计算退磁场 $\\mathbf{H}_\\mathrm{d}$ 的陈述。\n\n核心物理原理是，对于给定的磁化分布 $\\mathbf{M}(\\mathbf{r})$，退磁场 $\\mathbf{H}_\\mathrm{d}$ 是静磁麦克斯韦方程组的解。这可以表述为标量势 $\\phi(\\mathbf{r})$ 的泊松方程，$\\nabla^2 \\phi(\\mathbf{r}) = \\nabla \\cdot \\mathbf{M}(\\mathbf{r})$，且 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$。解可以表示为 $\\mathbf{M}(\\mathbf{r})$ 与退磁张量核 $\\mathbf{N}(\\mathbf{r})$ 的卷积，即 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = - (\\mathbf{N} * \\mathbf{M})(\\mathbf{r})$。在离散数值方案中，根据卷积定理，这可以高效地计算为傅里叶空间中的逐元素乘积：$\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$，其中波浪号（$\\tilde{\\cdot}$）表示离散傅里叶变换（DFT），通常通过FFT实现。\n\nA. 在有限差分微磁代码中，通过与 $\\mathbf{N}(\\mathbf{r})$ 进行卷积来计算 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r})$ 的高效实现方法是：将 $\\mathbf{M}(\\mathbf{r})$ 和 $\\mathbf{N}(\\mathbf{r})$ 都嵌入到一个尺寸至少为 $2N_x \\times 2N_y \\times 2N_z$ 的零填充数组中，进行离散傅里叶变换，在倒易空间中相乘，即 $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$，然后进行逆变换。若不进行填充，开放边界条件会因循环卷绕和镜像自相互作用而遭到破坏。\n\n该陈述讨论了有限样本（开放边界条件）的模拟。DFT固有地假设输入信号是周期性的。在大小为 $N_x \\times N_y \\times N_z$ 的未填充数组上使用DFT应用卷积定理，会得到*循环*卷积。这意味着模拟单元一个边界处的元素会与相对边界处的元素相互作用，如同它们相邻一样，这等效于模拟一个无限周期系统。为了模拟一个孤立的有限样本，需要进行*线性*卷积。这可以通过在变换前对数组进行零填充来实现。如果磁化网格的大小为 $N_x \\times N_y \\times N_z$，则将其填充到至少 $(2N_x-1) \\times (2N_y-1) \\times (2N_z-1)$ 的大小是防止卷绕伪影所必需的。为了FFT算法的效率，通常使用 $2N_x \\times 2N_y \\times 2N_z$ 的大小。此过程正确地消除了与周期性镜像的虚假相互作用。公式 $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$ 是卷积定理的正确应用。该陈述是对该技术的精确和标准描述。\n**结论：正确。**\n\nB. 在所有三个维度上都采用完全周期性边界条件的情况下，退磁张量的 $\\mathbf{k} = \\mathbf{0}$ 分量应设置为 $\\mathbf{N}(\\mathbf{0}) = \\mathbf{I}$（单位张量），这样空间均匀的磁化将处处产生退磁场 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}(\\mathbf{r})$。\n\n该陈述涉及一个在所有3个维度上都具有完全周期性边界条件（PBC）的系统。对于空间均匀的磁化 $\\mathbf{M}(\\mathbf{r}) = \\mathbf{M}_0$（一个常数），磁荷密度 $\\rho_m = - \\nabla \\cdot \\mathbf{M} = \\mathbf{0}$。在一个没有源的无限周期介质中，退磁场 $\\mathbf{H}_\\mathrm{d}$ 必须为零。从计算角度看，均匀磁化 $\\mathbf{M}_0$ 在傅里叶空间中由 $\\mathbf{k} = \\mathbf{0}$ 处的单个非零分量表示。为了在实空间中获得零场 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = \\mathbf{0}$，其傅里叶变换 $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k})$ 必须对所有 $\\mathbf{k}$ 都为零。由于 $\\tilde{\\mathbf{M}}(\\mathbf{k})$ 仅在 $\\mathbf{k}=\\mathbf{0}$ 时非零，关系式 $\\tilde{\\mathbf{H}}_\\mathrm{d}(\\mathbf{k}) = - \\tilde{\\mathbf{N}}(\\mathbf{k}) \\tilde{\\mathbf{M}}(\\mathbf{k})$ 要求 $\\tilde{\\mathbf{N}}(\\mathbf{0})$ 必须是零张量，即 $\\tilde{\\mathbf{N}}(\\mathbf{0}) = \\mathbf{0}$。该陈述提议 $\\tilde{\\mathbf{N}}(\\mathbf{0}) = \\mathbf{I}$，这将产生非零场 $\\mathbf{H}_\\mathrm{d}(\\mathbf{r}) = -\\mathbf{M}_0$。这对于完全三维周期性系统是错误的。\n**结论：错误。**\n\nC. 对于一个在 $x$ 和 $y$ 方向上周期性但在 $z$ 方向上开放的薄膜（二维PBC），空间均匀的面外磁化 $\\mathbf{M}(\\mathbf{r}) = M_0 \\hat{\\mathbf{z}}$ 产生的平均退磁场为 $\\mathbf{H}_\\mathrm{d} = - M_0 \\hat{\\mathbf{z}}$，而空间均匀的面内磁化产生的平均退磁场为零。如果退磁张量在面内是周期性的，但在 $z$ 方向上保留了物理上的非周期性格林函数，则可以通过FFT卷积重现此行为。\n\n该陈述描述了无限薄膜的静磁学。对于均匀的面外磁化 $\\mathbf{M} = M_0 \\hat{\\mathbf{z}}$，磁表面荷 $\\sigma_m = \\pm M_0$ 出现在顶部和底部表面上。这些电荷片在薄膜内部产生均匀场 $\\mathbf{H}_\\mathrm{d} = -M_0 \\hat{\\mathbf{z}}$，类似于平行板电容器。对于均匀的面内磁化，例如 $\\mathbf{M} = M_0 \\hat{\\mathbf{x}}$，顶部和底部表面上的表面荷 $\\sigma_m = \\mathbf{M} \\cdot \\hat{\\mathbf{n}} = 0$，导致各处的退磁场均为零。这两种物理描述都是正确的。该陈述进一步断言，基于FFT卷积的数值方法可以重现此行为。这是正确的；对于这种几何结构，使用二维FFT处理面内维度，并结合z方向的非周期性求解器的专门方法是标准做法。\n**结论：正确。**\n\nD. 在FFT卷积中施加完全周期性边界条件等效于对计算单元的无限周期性镜像求和偶极相互作用；因此，对于空间均匀的磁化，在完全周期性边界条件下的退磁能量密度恒等于零，而在开放边界条件下，其值为 $\\frac{1}{2} \\mu_0 M_0^2 N_\\mathrm{shape}$，其中 $N_\\mathrm{shape}$ 是有限样本的与形状相关的退磁因子。\n\n该陈述正确地将具有PBC的FFT方法等同于偶极相互作用的埃瓦尔德求和的一种形式。正如在选项B中确立的，在基于FFT的代码中使用的标准求和约定下，完全三维周期系统中的均匀磁化 $\\mathbf{M}_0$ 产生零退磁场，$\\mathbf{H}_\\mathrm{d} = \\mathbf{0}$。退磁能量密度为 $E_\\mathrm{d} = -\\frac{1}{2}\\mu_0 \\mathbf{M} \\cdot \\mathbf{H}_\\mathrm{d}$，因此为零。作为对比，该陈述正确地给出了均匀磁化的有限（开放BC）椭球形状样本的形状各向异性能量密度为 $\\frac{1}{2}\\mu_0 M_0^2 N_\\mathrm{shape}$，这是由其非零的内部退磁场引起的。这一比较突显了完全周期系统和有限系统物理学上的一个关键区别，且陈述的所有部分都是准确的。\n**结论：正确。**\n\nE. 在离散傅里叶卷积中，高频分量的混叠是无害的，因为实空间退磁核以 $1/r^3$ 的形式衰减；因此，即使对于开放边界条件，零填充也是不必要的。\n\n这个陈述在多个方面都是不正确的。首先，对于开放边界条件，省略零填充的主要问题不是混叠，而是强制执行了循环卷积，这在物理上对应于周期性边界条件，而非开放边界条件。其次，给出的理由是错误的。退磁场的核具有长程的 $1/r^3$ 衰减，这恰恰是卷绕误差显著的原因。短程相互作用的卷绕误差可能可以忽略不计，但长程相互作用则不然。因此，零填充对于模拟孤立系统至关重要。前提有缺陷，结论是错误的。\n**结论：错误。**\n\n最终整理出的正确选项：A、C、D。",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "在掌握了有效场的计算方法后，我们需要一个稳定而精确的积分器来求解LLG方程随时间的演化。本练习将指导您实现一种先进的算子分裂方法，该方法将磁矩的进动和阻尼动力学分开处理，从而构建一个保持系统几何结构的积分器。通过亲手编程实现这种几何积分器并将其精度与标准的龙格－库塔（Runge-Kutta）方法进行比较，您将具体地体会到结构保持算法在模拟振荡物理系统（如铁磁共振）时所展现出的卓越性能。",
            "id": "3460197",
            "problem": "实现一个用于朗道-利夫希兹-吉尔伯特自旋动力学的数值积分器，该积分器使用算子分裂方法，解析地处理进动项，并隐式地处理阻尼项，并在一个铁磁共振 (FMR) 衰荡的场景中，将其相位精度与一个标准的显式格式进行比较。处理对象为一个单位范数的单畴宏自旋。使用以下基本框架来推导您的方法。\n\n基本方程与定义：\n- 在恒定有效磁场 $\\mathbf{H}\\in\\mathbb{R}^3$ 中，单位磁化矢量 $\\mathbf{m}(t)\\in\\mathbb{R}^3$ 的朗道-利夫希兹-吉尔伯特方程的吉尔伯特形式为\n$$\n(1+\\alpha^2)\\,\\frac{d\\mathbf{m}}{dt} \\;=\\; -\\gamma\\,\\mathbf{m}\\times \\mathbf{H} \\;-\\; \\alpha\\,\\gamma\\,\\mathbf{m}\\times(\\mathbf{m}\\times \\mathbf{H}),\n$$\n其中 $\\gamma$ 是旋磁比，单位为 $\\mathrm{rad\\,s^{-1}\\,T^{-1}}$，$\\alpha\\ge 0$ 是无量纲阻尼，$\\times$ 表示矢量叉积，且对于所有 $t$ 都有 $\\|\\mathbf{m}\\|=1$。\n- 定义 $\\gamma'=\\gamma/(1+\\alpha^2)$，这样方程可以写成两个矢量场的和：\n$$\n\\frac{d\\mathbf{m}}{dt} \\;=\\; \\underbrace{-\\gamma'\\,\\mathbf{m}\\times\\mathbf{H}}_{\\text{进动}} \\;+\\; \\underbrace{-\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})}_{\\text{阻尼}}.\n$$\n- 在恒定场 $\\mathbf{H} = H_0\\,\\mathbf{h}$ 中（其中 $H_0=\\|\\mathbf{H}\\|$ 且 $\\mathbf{h}$ 是单位矢量），进动频率为 $\\omega = \\gamma' H_0$（单位 $\\mathrm{rad/s}$），铁磁共振 (FMR) 周期为 $T_{\\mathrm{per}} = 2\\pi/\\omega$。\n\n任务要求：\n1. 基于上述分解，从第一性原理推导一个时间分裂格式，该格式应用：\n   - 在一个时间步长 $\\Delta t$ 内，围绕轴 $\\mathbf{h}$ 进行角度为 $\\theta=\\omega\\,\\Delta t$ 的精确进动映射（进动子步中无近似），以及\n   - 在一个时间间隔 $\\tau$ 内，对阻尼子步进行隐式更新，该更新保持单位范数且无条件稳定。请展示如何在恒定 $\\mathbf{H}$ 条件下，将阻尼子步的隐式矢量方程简化为关于 $s = \\mathbf{h}\\cdot \\mathbf{m}_{\\mathrm{new}}$ 的标量非线性方程，并以闭式解的形式求解，从而得到 $\\mathbf{m}_{\\mathrm{new}}$ 的显式公式。\n2. 以对称的 Strang 式方式（半步阻尼、完整进动、半步阻尼）组合这两个子步，以获得一个二阶类辛分裂方法。\n3. 在代码中实现以下两者：\n   - 推导出的分裂积分器，以及\n   - 一个直接应用于上述吉尔伯特形式的基准显式四阶龙格-库塔 (RK4) 方法（您可以在每个 RK4 步骤后投影回单位球面以控制范数漂移）。\n4. 模拟一次 FMR 衰荡：取恒定场 $\\mathbf{H}=H_0\\hat{\\mathbf{z}}$ 且 $H_00$，从一个与 $\\hat{\\mathbf{z}}$ 呈微小极角 $\\theta_0$ 的略微倾斜的初始磁化强度 $\\mathbf{m}(0)$ 开始，演化整数个 FMR 周期。将时间 $t$ 的数值相位定义为方位角 $\\phi(t)=\\mathrm{atan2}(m_y(t),m_x(t))$（单位为弧度），并与解析相位 $\\phi_{\\mathrm{exact}}(t)=\\omega t$（模 $2\\pi$）进行比较。使用包裹绝对相位误差 $\\varepsilon_\\phi(t) = \\left|\\mathrm{atan2}(\\sin(\\phi(t)-\\phi_{\\mathrm{exact}}(t)),\\cos(\\phi(t)-\\phi_{\\mathrm{exact}}(t)))\\right|$（单位为弧度）。\n5. 设计包含以下三个案例的测试套件以评估相位精度：\n   - 案例 A（理想路径）：$\\gamma = 1.760859\\times 10^{11}\\ \\mathrm{rad\\,s^{-1}\\,T^{-1}}$，$H_0=1.0\\ \\mathrm{T}$，$\\alpha=0.02$，$\\theta_0 = 5^\\circ$（转换为弧度），总时间 $T_{\\mathrm{tot}}=20\\,T_{\\mathrm{per}}$，时间步长 $\\Delta t = T_{\\mathrm{per}}/12$。\n   - 案例 B（精细步长）：与案例 A 相同，但 $\\Delta t = T_{\\mathrm{per}}/40$。\n   - 案例 C（边界情况，无阻尼）：与案例 A 相同，但 $\\alpha=0.0$ 且 $\\Delta t = T_{\\mathrm{per}}/12$。\n   在所有案例中，$T_{\\mathrm{per}}=2\\pi/\\omega$，其中 $\\omega=\\gamma' H_0$ 且 $\\gamma'=\\gamma/(1+\\alpha^2)$，并且积分应精确运行 20 个 FMR 周期，以使 $T_{\\mathrm{tot}}/\\Delta t$ 为整数。所有角度必须以弧度为单位，时间以秒为单位，磁场以特斯拉为单位。\n6. 对于每个案例，计算分裂方法和 RK4 方法在最终时刻的包裹绝对相位误差，并返回一个布尔值，指示分裂方法的最终相位误差是否严格小于 RK4 的误差。\n7. 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按 A、B、C 的顺序给出结果。例如，输出格式必须类似于 $\\texttt{[true,false,true]}$，但使用 Python 的布尔值大写形式。\n\n您的交付成果必须是一个完整、可运行的程序，该程序：\n- 实现上述方法和比较。\n- 不使用用户输入。\n- 精确打印一行，其中包含一个如上指定的包含三个布尔值的 Python 列表。",
            "solution": "该问题要求推导、实现并比较两种用于单畴宏自旋的朗道-利夫希兹-吉尔伯特 (LLG) 方程的数值积分器。任务的核心是开发一种几何感知的分裂方法，并以一个标准的显式龙格-库塔积分器为基准，来衡量其相位精度。\n\nLLG 方程以吉尔伯特形式给出，它可以被重排并分解为一个进动项和一个阻尼项。设 $\\gamma' = \\gamma/(1+\\alpha^2)$，单位磁化矢量 $\\mathbf{m}$ 在恒定有效场 $\\mathbf{H}$ 中的运动方程为：\n$$\n\\frac{d\\mathbf{m}}{dt} = \\underbrace{-\\gamma'\\,\\mathbf{m}\\times\\mathbf{H}}_{\\mathbf{f}_{\\text{prec}}(\\mathbf{m})} + \\underbrace{-\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})}_{\\mathbf{f}_{\\text{damp}}(\\mathbf{m})}\n$$\n磁场是恒定的，$\\mathbf{H} = H_0\\mathbf{h}$，其中 $\\mathbf{h}$ 是一个单位矢量。在模拟中，我们使用 $\\mathbf{h}=\\hat{\\mathbf{z}}$。\n\n我们采用对称的二阶 Strang 分裂格式来对该系统进行积分。在一个时间步长 $\\Delta t$ 内，其形式解近似为对应于进动流和阻尼流的算子复合：\n$$\n\\mathbf{m}(t+\\Delta t) \\approx \\mathcal{D}_{\\Delta t/2} \\circ \\mathcal{P}_{\\Delta t} \\circ \\mathcal{D}_{\\Delta t/2}(\\mathbf{m}(t))\n$$\n其中 $\\mathcal{P}_{\\Delta t}$ 是在完整时间步长 $\\Delta t$ 上的进动流算子，而 $\\mathcal{D}_{\\tau}$ 是在时间间隔 $\\tau = \\Delta t/2$ 上的阻尼流算子。我们现在推导这些算子的精确解析形式。\n\n**1. 进动子步 $\\mathcal{P}_{\\Delta t}$**\n\n进动动力学由以下线性常微分方程 (ODE) 描述：\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\gamma' \\mathbf{m} \\times \\mathbf{H} = \\omega (\\mathbf{h} \\times \\mathbf{m})\n$$\n其中 $\\omega = \\gamma' H_0$ 是拉莫尔进动频率。该方程描述了矢量 $\\mathbf{m}$ 以恒定角速度 $\\omega$ 绕由 $\\mathbf{h}$ 定义的轴进行的刚性旋转。对于一个时间步长 $\\Delta t$，其解析解是旋转一个角度 $\\theta = \\omega \\Delta t$。这个旋转可以使用罗德里格斯旋转公式精确计算：\n$$\n\\mathcal{P}_{\\Delta t}(\\mathbf{m}_{\\text{in}}) = \\mathbf{m}_{\\text{in}} \\cos\\theta + (\\mathbf{h} \\times \\mathbf{m}_{\\text{in}}) \\sin\\theta + \\mathbf{h} (\\mathbf{h} \\cdot \\mathbf{m}_{\\text{in}}) (1 - \\cos\\theta)\n$$\n由于此映射是精确旋转，它自然地保持了磁化强度的范数，即 $\\|\\mathbf{m}\\|=1$。\n\n**2. 阻尼子步 $\\mathcal{D}_{\\tau}$**\n\n阻尼动力学由以下非线性常微分方程描述：\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{H})\n$$\n使用矢量三重积恒等式 $\\mathbf{a}\\times(\\mathbf{b}\\times\\mathbf{c}) = \\mathbf{b}(\\mathbf{a}\\cdot\\mathbf{c})-\\mathbf{c}(\\mathbf{a}\\cdot\\mathbf{b})$ 以及 $\\|\\mathbf{m}\\|=1$，方程变为：\n$$\n\\frac{d\\mathbf{m}}{dt} = \\alpha\\gamma' \\left( \\mathbf{H} - (\\mathbf{m}\\cdot\\mathbf{H})\\mathbf{m} \\right)\n$$\n该方程描述了一个将 $\\mathbf{m}$ 移向与 $\\mathbf{H}$ 对齐的流。该运动被约束在单位球面上经过初始磁化矢量和场矢量 $\\mathbf{H}$ 的大圆上。这种几何洞察使我们能够找到阻尼子步的精确解析解。\n\n设 $\\phi(t)$ 为 $\\mathbf{m}(t)$ 和 $\\mathbf{h}$ 之间的极角。我们可以将 $\\mathbf{m}(t)$ 参数化为 $\\mathbf{m}(t) = \\cos(\\phi(t))\\mathbf{h} + \\sin(\\phi(t))\\hat{\\mathbf{p}}$，其中 $\\hat{\\mathbf{p}}$ 是一个垂直于 $\\mathbf{h}$ 且位于运动平面内的固定单位矢量。将此代入阻尼常微分方程，得到关于角度 $\\phi(t)$ 的标量常微分方程：\n$$\n\\frac{d\\phi}{dt} = -\\alpha\\gamma'H_0 \\sin\\phi\n$$\n这是一个可分离的常微分方程。为了找到在时间间隔 $\\tau$ 上的映射，我们进行积分：\n$$\n\\int_{\\phi_{\\text{old}}}^{\\phi_{\\text{new}}} \\frac{d\\phi}{\\sin\\phi} = \\int_{0}^{\\tau} -\\alpha\\gamma'H_0 dt\n$$\n$\\csc\\phi$ 的积分是 $\\ln|\\tan(\\phi/2)|$。这导致：\n$$\n\\ln\\left(\\frac{\\tan(\\phi_{\\text{new}}/2)}{\\tan(\\phi_{\\text{old}}/2)}\\right) = -\\alpha\\gamma'H_0\\tau\n$$\n求解 $\\phi_{\\text{new}}$，我们得到显式的闭式更新法则：\n$$\n\\tan(\\phi_{\\text{new}}/2) = \\tan(\\phi_{\\text{old}}/2) \\exp(-\\alpha\\gamma'H_0\\tau)\n$$\n给定一个输入矢量 $\\mathbf{m}_{\\text{old}}$，我们首先找到它的极角 $\\phi_{\\text{old}} = \\arccos(\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})$。然后我们使用上面的公式找到 $\\phi_{\\text{new}}$。新矢量 $\\mathbf{m}_{\\text{new}}$ 在保持运动平面的前提下被重构：\n$$\n\\mathbf{m}_{\\text{new}} = \\cos(\\phi_{\\text{new}})\\mathbf{h} + \\sin(\\phi_{\\text{new}})\\frac{\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}}{\\|\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}\\|}\n$$\n这个用于阻尼流的精确解是无条件稳定的，并且通过构造保持单位范数，满足了阻尼子步积分器的所有要求。\n\n**3. 基准：四阶龙格-库塔 (RK4) 方法**\n\n为了比较，我们将一个标准的显式四阶龙格-库塔 (RK4) 方法直接应用于完整的 LLG 方程。从时间 $t_n$ 到 $t_n+\\Delta t$ 的单步 RK4 如下：\n$$\n\\begin{aligned}\n    \\mathbf{k}_1 = \\mathbf{f}(\\mathbf{m}_n) \\\\\n    \\mathbf{k}_2 = \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_1) \\\\\n    \\mathbf{k}_3 = \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_2) \\\\\n    \\mathbf{k}_4 = \\mathbf{f}(\\mathbf{m}_n + \\Delta t\\mathbf{k}_3) \\\\\n    \\mathbf{m}_{n+1}^* = \\mathbf{m}_n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{aligned}\n$$\n其中 $\\mathbf{f}(\\mathbf{m}) = \\mathbf{f}_{\\text{prec}}(\\mathbf{m}) + \\mathbf{f}_{\\text{damp}}(\\mathbf{m})$。RK4 方法本身不保持 $\\mathbf{m}$ 的单位范数。因此，必须在每个时间步后应用一个投影步骤，即 $\\mathbf{m}_{n+1} = \\mathbf{m}_{n+1}^* / \\|\\mathbf{m}_{n+1}^*\\|$，以防止非物理的范数漂移。\n\n**4. 相位误差计算**\n\n积分器的精度通过铁磁共振 (FMR) 衰荡模拟中的相位误差来评估。在时间 $t$，进动磁化强度的解析相位是 $\\phi_{\\text{exact}}(t) = \\omega t$。数值相位是 $\\phi_{\\text{num}}(t) = \\mathrm{atan2}(m_y(t), m_x(t))$。模拟运行时间为 $T_{\\text{tot}} = 20 T_{\\text{per}}$，因此精确的最终相位是 $\\phi_{\\text{exact}}(T_{\\text{tot}}) = 40\\pi$，即模 $2\\pi$ 等于 $0$。包裹绝对相位误差计算为 $\\varepsilon_\\phi = |\\mathrm{atan2}(\\sin(\\phi_{\\text{num}}-\\phi_{\\text{exact}}), \\cos(\\phi_{\\text{num}}-\\phi_{\\text{exact}}))|$。分裂积分器作为一种精确处理主要振荡部分的几何方法，预计会比通用目的的 RK4 方法表现出显著更低的相位误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares a Landau-Lifshitz-Gilbert (LLG) splitting integrator\n    against a standard RK4 integrator for a ferromagnetic resonance ring-down problem.\n    The comparison is based on the final phase accuracy for three test cases.\n    \"\"\"\n\n    # --- Fundamental Constants ---\n    GAMMA = 1.760859e11  # Gyromagnetic ratio in rad s^-1 T^-1\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Happy path with moderate damping and time step\n        {'name': 'A', 'alpha': 0.02, 'dt_frac': 12},\n        # Case B: Refined time step\n        {'name': 'B', 'alpha': 0.02, 'dt_frac': 40},\n        # Case C: Boundary case with no damping\n        {'name': 'C', 'alpha': 0.0, 'dt_frac': 12},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Parameter Setup ---\n        alpha = case['alpha']\n        dt_frac = case['dt_frac']\n\n        H0 = 1.0  # Tesla\n        h_axis = np.array([0.0, 0.0, 1.0])\n        H_vec = H0 * h_axis\n\n        theta0_deg = 5.0\n        theta0_rad = np.deg2rad(theta0_deg)\n        m0 = np.array([np.sin(theta0_rad), 0.0, np.cos(theta0_rad)])\n\n        gammap = GAMMA / (1.0 + alpha**2)\n        omega = gammap * H0\n        T_per = 2.0 * np.pi / omega\n        \n        T_tot = 20.0 * T_per\n        dt = T_per / dt_frac\n        num_steps = int(round(T_tot / dt))\n\n        # --- Integrator Implementations ---\n\n        # 1. Splitting Method (Half-Damping, Full-Precession, Half-Damping)\n        def precession_step(m, angle):\n            \"\"\"Exact rotation around z-axis by a given angle.\"\"\"\n            cos_a = np.cos(angle)\n            sin_a = np.sin(angle)\n            mx_new = m[0] * cos_a - m[1] * sin_a\n            my_new = m[0] * sin_a + m[1] * cos_a\n            return np.array([mx_new, my_new, m[2]])\n\n        def damping_step(m, tau):\n            \"\"\"Exact solution of the damping sub-problem over time interval tau.\"\"\"\n            if alpha == 0.0:\n                return m\n            \n            s_old = np.clip(m @ h_axis, -1.0, 1.0)\n            \n            # If m is already aligned with H, no damping occurs.\n            if 1.0 - abs(s_old)  1e-14:\n                return np.sign(s_old) * h_axis\n\n            phi_old = np.arccos(s_old)\n            sin_phi_old = np.sin(phi_old)\n\n            lamb = alpha * gammap * H0 * tau\n            tan_phi_old_half = np.tan(phi_old / 2.0)\n            tan_phi_new_half = tan_phi_old_half * np.exp(-lamb)\n            phi_new = 2.0 * np.arctan(tan_phi_new_half)\n\n            s_new = np.cos(phi_new)\n            sin_phi_new = np.sin(phi_new)\n            \n            # Reconstruct the new vector in the same plane (m, h)\n            m_perp_old = m - s_old * h_axis\n            m_new = s_new * h_axis + m_perp_old * (sin_phi_new / sin_phi_old)\n            \n            return m_new\n\n        def integrate_split(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            precession_angle = omega * dt_val\n            damping_tau = dt_val / 2.0\n            for _ in range(n_steps):\n                m = damping_step(m, damping_tau)\n                m = precession_step(m, precession_angle)\n                m = damping_step(m, damping_tau)\n            return m\n\n        # 2. RK4 Method\n        def llg_rhs(m):\n            m_cross_H = np.cross(m, H_vec)\n            m_cross_m_cross_H = np.cross(m, m_cross_H)\n            rhs = -gammap * m_cross_H - alpha * gammap * m_cross_m_cross_H\n            return rhs\n\n        def integrate_rk4(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            for _ in range(n_steps):\n                k1 = llg_rhs(m)\n                k2 = llg_rhs(m + dt_val / 2.0 * k1)\n                k3 = llg_rhs(m + dt_val / 2.0 * k2)\n                k4 = llg_rhs(m + dt_val * k3)\n                m = m + dt_val / 6.0 * (k1 + 2 * k2 + 2 * k3 + k4)\n                m /= np.linalg.norm(m)  # Re-normalize after each step\n            return m\n\n        # --- Execution and Comparison ---\n        m_final_split = integrate_split(m0, num_steps, dt)\n        m_final_rk4 = integrate_rk4(m0, num_steps, dt)\n\n        # Final phase is 40*pi, which is 0 mod 2*pi\n        phi_exact_final = 0.0\n\n        phi_split = np.arctan2(m_final_split[1], m_final_split[0])\n        phi_rk4 = np.arctan2(m_final_rk4[1], m_final_rk4[0])\n\n        d_phi_split = phi_split - phi_exact_final\n        error_split = abs(np.arctan2(np.sin(d_phi_split), np.cos(d_phi_split)))\n\n        d_phi_rk4 = phi_rk4 - phi_exact_final\n        error_rk4 = abs(np.arctan2(np.sin(d_phi_rk4), np.cos(d_phi_rk4)))\n\n        results.append(error_split  error_rk4)\n\n    # --- Print Final Output ---\n    # The output format is a Python list of booleans, converted to a string.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}