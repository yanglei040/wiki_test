{
    "hands_on_practices": [
        {
            "introduction": "掌握理论的最好方法之一就是通过一个可以解析求解的简化模型。这个练习将引导你从第一性原理出发，推导一个简单单原子立方晶格的动力学矩阵。通过这个过程，你将亲手实践如何应用声学求和规则，并将实空间中的原子间力常数通过晶格傅里叶变换转换成倒空間中的声子色散关系，为你理解更复杂的DFPT计算打下坚实的基础。",
            "id": "3460694",
            "problem": "考虑一个晶格参数为 $a$、原子质量为 $m$ 的单原子简立方布拉菲晶格。在由密度泛函微扰理论（DFPT）构建的晶格动力学谐振近似中，原子间力常数张量定义为 Kohn–Sham 总能量对原子位移的二阶导数，而动力学矩阵 $\\mathbf{D}(\\mathbf{q})$ 是这些实空间力常数的质量加权晶格傅里叶变换。假设仅存在最近邻耦合，并且原点与任意最近邻矢量 $\\mathbf{R}$ 之间的对相互作用力常数张量是各向同性的，即 $\\Phi_{\\alpha \\beta}(\\mathbf{R})=-\\kappa \\,\\delta_{\\alpha \\beta}$，其中在位项由声学求和规则 $\\sum_{\\mathbf{R}}\\Phi_{\\alpha \\beta}(\\mathbf{R})=0$ 确定。最近邻矢量集为 $\\mathbf{R}=\\pm a\\,\\hat{\\mathbf{x}},\\pm a\\,\\hat{\\mathbf{y}},\\pm a\\,\\hat{\\mathbf{z}}$。\n\n从谐振运动方程和动力学矩阵的定义出发，推导在第一布里渊区中任意波矢 $\\mathbf{q}$ 的动力学矩阵 $\\mathbf{D}(\\mathbf{q})$ 的显式解析表达式。然后，沿着简立方布里渊区的高对称路径 $\\Gamma \\rightarrow X \\rightarrow M$，求出声子色散的闭合形式（三重简并的声学角频率 $\\omega(\\mathbf{q})$），其中 $\\Gamma=(0,0,0)$，$X=(\\pi/a,0,0)$，$M=(\\pi/a,\\pi/a,0)$。将路径段 $\\Gamma \\rightarrow X$ 参数化为 $\\mathbf{q}=(k,0,0)$，其中 $k\\in[0,\\pi/a]$；将路径段 $X \\rightarrow M$ 参数化为 $\\mathbf{q}=(\\pi/a,t,0)$，其中 $t\\in[0,\\pi/a]$。将您的最终结果 $\\mathbf{D}(\\mathbf{q})$、$\\omega_{\\Gamma X}(k)$ 和 $\\omega_{XM}(t)$ 表示为闭合形式的解析表达式。请勿代入数值，也无需四舍五入。在最终答案中，按所述顺序给出表达式，且不包含单位。",
            "solution": "该问题陈述经核实具有科学依据、形式适定、客观且内部一致。它代表了固态物理学中的一个标准问题。我们开始求解。\n\n该问题要求解出单原子简立方晶格在特定高对称路径上的动力学矩阵 $\\mathbf{D}(\\mathbf{q})$ 和声子色散关系 $\\omega(\\mathbf{q})$。此分析基于一个简化模型，该模型在谐振近似下具有各向同性的最近邻相互作用。\n\n首先，我们将动力学矩阵 $\\mathbf{D}(\\mathbf{q})$ 定义为原子间力常数张量 $\\Phi_{\\alpha \\beta}(\\mathbf{R})$ 的质量加权傅里叶变换：\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\sum_{\\mathbf{R}} \\Phi_{\\alpha \\beta}(\\mathbf{R}) \\exp(i \\mathbf{q} \\cdot \\mathbf{R})$$\n其中 $m$ 是原子质量，$\\mathbf{q}$ 是波矢，求和遍及所有晶格矢量 $\\mathbf{R}$。下标 $\\alpha, \\beta$ 表示笛卡尔分量 $\\{x, y, z\\}$。\n\n给定的力常数仅在在位（$\\mathbf{R}=0$）和最近邻（NN）相互作用下非零。最近邻力常数张量被指定为 $\\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}}) = -\\kappa \\delta_{\\alpha \\beta}$，其中 $\\kappa$ 是一个正常数，$\\delta_{\\alpha \\beta}$ 是克罗内克 δ 符号。\n\n在位力常数 $\\Phi_{\\alpha \\beta}(0)$ 由声学求和规则确定，该规则确保整个晶体的刚性平移不消耗能量。该规则表述为：\n$$\\sum_{\\mathbf{R}} \\Phi_{\\alpha \\beta}(\\mathbf{R}) = 0$$\n展开此求和，我们得到：\n$$\\Phi_{\\alpha \\beta}(0) + \\sum_{\\mathbf{R} \\neq 0} \\Phi_{\\alpha \\beta}(\\mathbf{R}) = 0$$\n由于只考虑最近邻相互作用，对 $\\mathbf{R} \\neq 0$ 的求和简化为对最近邻矢量的求和。\n$$\\Phi_{\\alpha \\beta}(0) = - \\sum_{\\mathbf{R}_{\\text{NN}}} \\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}})$$\n简立方晶格有6个最近邻，位于 $\\mathbf{R}_{\\text{NN}} = \\{\\pm a\\hat{\\mathbf{x}}, \\pm a\\hat{\\mathbf{y}}, \\pm a\\hat{\\mathbf{z}}\\}$。代入给定的最近邻力常数形式：\n$$\\Phi_{\\alpha \\beta}(0) = - \\sum_{j=1}^{6} (-\\kappa \\delta_{\\alpha \\beta}) = 6\\kappa \\delta_{\\alpha \\beta}$$\n\n现在我们可以构建动力学矩阵。我们将对 $\\mathbf{R}$ 的求和拆分为在位项和对最近邻的求和：\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\left( \\Phi_{\\alpha \\beta}(0) \\exp(i \\mathbf{q} \\cdot 0) + \\sum_{\\mathbf{R}_{\\text{NN}}} \\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}}) \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\n代入力常数的表达式：\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\left( 6\\kappa \\delta_{\\alpha \\beta} - \\kappa \\delta_{\\alpha \\beta} \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{\\kappa}{m} \\delta_{\\alpha \\beta} \\left( 6 - \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\n对最近邻矢量的求和计算如下，其中 $\\mathbf{q} = (q_x, q_y, q_z)$：\n$$ \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) = \\exp(i q_x a) + \\exp(-i q_x a) + \\exp(i q_y a) + \\exp(-i q_y a) + \\exp(i q_z a) + \\exp(-i q_z a) $$\n使用恒等式 $2\\cos\\theta = e^{i\\theta} + e^{-i\\theta}$，该求和变为：\n$$ \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) = 2\\cos(q_x a) + 2\\cos(q_y a) + 2\\cos(q_z a) $$\n将此结果代回 $D_{\\alpha \\beta}(\\mathbf{q})$ 的表达式中：\n$$ D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{\\kappa}{m} \\delta_{\\alpha \\beta} \\left( 6 - 2\\cos(q_x a) - 2\\cos(q_y a) - 2\\cos(q_z a) \\right) $$\n$$ D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) \\delta_{\\alpha \\beta} $$\n这表明动力学矩阵是对角的。令 $\\mathbf{I}_3$ 为 $3 \\times 3$ 单位矩阵。则动力学矩阵为：\n$$ \\mathbf{D}(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) \\mathbf{I}_3 $$\n这是第一个要求的表达式。\n\n声子频率 $\\omega(\\mathbf{q})$ 通过求解本征值问题 $\\mathbf{D}(\\mathbf{q})\\mathbf{e} = \\omega^2(\\mathbf{q})\\mathbf{e}$ 得到。由于 $\\mathbf{D}(\\mathbf{q})$ 是单位矩阵的标量倍，其三个本征值相同。这给出了一个三重简并的声学声子支。\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) $$\n使用三角恒等式 $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$，我们可以将其重写为：\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left[ (1 - \\cos(q_x a)) + (1 - \\cos(q_y a)) + (1 - \\cos(q_z a)) \\right] $$\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left[ 2\\sin^2\\left(\\frac{q_x a}{2}\\right) + 2\\sin^2\\left(\\frac{q_y a}{2}\\right) + 2\\sin^2\\left(\\frac{q_z a}{2}\\right) \\right] $$\n$$ \\omega^2(\\mathbf{q}) = \\frac{4\\kappa}{m} \\left( \\sin^2\\left(\\frac{q_x a}{2}\\right) + \\sin^2\\left(\\frac{q_y a}{2}\\right) + \\sin^2\\left(\\frac{q_z a}{2}\\right) \\right) $$\n取平方根得到通用的色散关系：\n$$ \\omega(\\mathbf{q}) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{q_x a}{2}\\right) + \\sin^2\\left(\\frac{q_y a}{2}\\right) + \\sin^2\\left(\\frac{q_z a}{2}\\right)} $$\n\n接下来，我们沿着指定的高对称路径 $\\Gamma \\rightarrow X \\rightarrow M$ 计算此表达式。\n\n对于路径段 $\\Gamma \\rightarrow X$，波矢参数化为 $\\mathbf{q} = (k, 0, 0)$，其中 $k \\in [0, \\pi/a]$。\n将 $q_x=k, q_y=0, q_z=0$ 代入通用色散关系：\n$$ \\omega_{\\Gamma X}(k) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{ka}{2}\\right) + \\sin^2(0) + \\sin^2(0)} = 2\\sqrt{\\frac{\\kappa}{m}} \\left|\\sin\\left(\\frac{ka}{2}\\right)\\right| $$\n由于 $k \\in [0, \\pi/a]$，自变量 $ka/2$ 在 $[0, \\pi/2]$ 范围内，其中正弦函数为非负。因此，绝对值是多余的。\n$$ \\omega_{\\Gamma X}(k) = 2\\sqrt{\\frac{\\kappa}{m}} \\sin\\left(\\frac{ka}{2}\\right) $$\n这是第二个要求的表达式。\n\n对于路径段 $X \\rightarrow M$，波矢参数化为 $\\mathbf{q} = (\\pi/a, t, 0)$，其中 $t \\in [0, \\pi/a]$。\n将 $q_x=\\pi/a, q_y=t, q_z=0$ 代入通用色散关系：\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{(\\pi/a)a}{2}\\right) + \\sin^2\\left(\\frac{ta}{2}\\right) + \\sin^2(0)} $$\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{\\pi}{2}\\right) + \\sin^2\\left(\\frac{ta}{2}\\right)} $$\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{1 + \\sin^2\\left(\\frac{ta}{2}\\right)} $$\n这是第三个也是最后一个要求的表达式。",
            "answer": "$$ \\boxed{ \\frac{2\\kappa}{m}\\left(3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a)\\right)\\mathbf{I}_3, \\quad 2\\sqrt{\\frac{\\kappa}{m}} \\sin\\left(\\frac{ka}{2}\\right), \\quad 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{1 + \\sin^2\\left(\\frac{ta}{2}\\right)} } $$"
        },
        {
            "introduction": "真实的DFPT计算并非总是完美的，数值误差可能会导致违反平移不变性等基本物理定律，从而产生非物理的结果。本练习聚焦于一个最常见的数值问题：声学求和规则（ASR）的破坏。你将通过编写一个简单的数值诊断程序，亲眼见证微小的ASR破坏是如何导致在$\\Gamma$点附近出现虚假的声子虚频，这是在实际声子谱计算中必須学会诊断和修正的关键问题。",
            "id": "3460693",
            "problem": "要求您实现一个受密度泛函微扰理论 (DFPT) 启发的数值诊断程序，重点关注声学求和规则 (ASR) 及其与一维单原子布拉菲晶格中伪虚声子频率的关系。该诊断程序作用于合成的、近似于 DFPT 计算出的平移不变力常数，并有意引入可控的 ASR 违背，以便量化其后果。\n\n从以下基本陈述和定义开始：\n\n- 在晶格动力学的谐振近似中，Born–Oppenheimer 势能对原子位移展开到二阶，通过 $\\Phi_{ij} = \\partial^2 E / \\partial u_i \\partial u_j$ 定义了力常数矩阵 $\\Phi_{ij}$，其中 $i$ 和 $j$ 是原子索引。对于一维单原子晶格，只有一个笛卡尔方向，张量指标简化为标量。\n- 平移不变性意味着声学求和规则：对每个原子 $i$，$\\sum_j \\Phi_{ij} = 0$。这确保了均匀平移不会产生恢复力。\n- 倒易空间中的质量归一化动力学矩阵由晶格傅里叶变换定义：$D(q) = \\frac{1}{M} \\sum_R \\Phi_{0R} e^{\\mathrm{i} q R}$，其中 $M$ 是原子质量，$R$ 遍历所有晶格矢量，$q$ 是波矢。声子角频率满足 $\\omega^2(q) = \\lambda(q)$，其中 $\\lambda(q)$ 是 $D(q)$ 的本征值；对于一维单原子晶格，$D(q)$ 是标量且等于 $\\omega^2(q)$。如果 $D(q)  0$，则 $\\omega(q)$ 为虚数，这对于稳定结构是不符合物理实际的，并且可能源于对声学求和规则的数值违背。\n\n您的数值诊断程序应量化 ASR 偏差，并将其与伪虚模式相关联：\n\n- 将 ASR 偏差定义为 $\\delta = \\max_i \\left| \\sum_j \\Phi_{ij} \\right|$。对于具有平移不变性的一维单原子链，这简化为 $\\delta = \\left| \\Phi_{00} + \\sum_{R \\neq 0} \\Phi_{0R} \\right|$。\n- 对于具有弹簧常数 $K$ 和晶格常数 $a$ 的一维单原子链的最近邻模型，取非零实空间力常数为 $\\Phi_{01} = \\Phi_{0,-1} = -K$ 和 $\\Phi_{00} = 2K + \\epsilon$，其中 $\\epsilon$ 参数化了一个对声学求和规则的可控违背。当 $\\epsilon = 0$ 时，该规则被精确满足。\n- 在此模型中，质量归一化动力学矩阵为 $D(q) = \\frac{1}{M} \\left[ \\Phi_{00} + 2 \\Phi_{01} \\cos(q a) \\right] = \\frac{1}{M} \\left[ (2K + \\epsilon) - 2K \\cos(q a) \\right]$。当 $D(q)  0$ 时，出现伪虚频率。\n\n实现一个程序，对每个测试用例执行以下操作：\n\n1. 使用指定的 $K$ 和 $\\epsilon$ 构建上述一维最近邻力常数，并计算以 $\\text{eV}/\\text{\\AA}^2$ 为单位的 ASR 偏差 $\\delta$。\n2. 在闭区间 $q \\in \\left[-\\pi/a, \\pi/a\\right]$ 上构建一个包含 $N_q$ 个点的均匀波矢网格（单位为 $\\text{\\AA}^{-1}$），在该网格上对 $D(q)$ 进行采样，并计算满足 $D(q)  -\\gamma$ 的网格点所占的比例 $f_{\\mathrm{imag}}$，其中 $\\gamma$ 是一个小的正数保护阈值，用于避免将数值舍入误差归类为虚数。将 $f_{\\mathrm{imag}}$ 以 $[0,1]$ 范围内的十进制数报告。\n3. 处理完所有测试用例后，计算整个测试套件中 ASR 偏差向量 $\\{\\delta\\}$ 与分数向量 $\\{f_{\\mathrm{imag}}\\}$ 之间的皮尔逊线性相关系数 $r_{\\mathrm{all}}$。如果任一向量的标准差为零，则将相关性定义为 $0$。\n4. 此外，计算一个条件相关系数 $r_{\\mathrm{neg}}$，该系数仅限于满足 $\\sum_j \\Phi_{0j} = \\epsilon  0$ 的测试用例子集，即在此模型中能够实际产生 $D(q)  0$ 的情况。如果此类情况少于两个，则定义 $r_{\\mathrm{neg}} = 0$。\n\n物理单位和角度单位：\n\n- 以 $\\text{eV}/\\text{\\AA}^2$ 为单位报告 $\\delta$。\n- 长度使用 $\\text{\\AA}$，质量使用 $\\text{atomic mass units}$（原子质量单位）。\n- 波矢 $q$ 的单位必须是 $\\text{\\AA}^{-1}$，三角函数中的角度必须是弧度。\n\n测试套件：\n\n除非另有说明，所有情况均使用以下固定参数：\n\n- 晶格常数 $a = 5.43\\,\\text{\\AA}$。\n- 原子质量 $M = 28.0855\\,\\text{amu}$。\n- 弹簧常数 $K = 10.0\\,\\text{eV}/\\text{\\AA}^2$。\n- 波矢点数 $N_q = 501$。\n- 虚数保护阈值 $\\gamma = 1.0 \\times 10^{-12}\\,\\text{eV}/(\\text{amu}\\cdot\\text{\\AA}^2)$。\n\n通过 ASR 违背参数 $\\epsilon$ 定义四个测试用例：\n\n- 用例 1：$\\epsilon = 0.0 \\times K$。\n- 用例 2：$\\epsilon = -1.0 \\times 10^{-4} \\times K$。\n- 用例 3：$\\epsilon = -0.5 \\times K$。\n- 用例 4：$\\epsilon = +0.5 \\times K$。\n\n对于每个用例，计算并记录如上定义的序对 $(\\delta, f_{\\mathrm{imag}})$。然后计算 $r_{\\mathrm{all}}$ 和 $r_{\\mathrm{neg}}$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须包含序列 $[\\delta_1, f_{\\mathrm{imag},1}, \\delta_2, f_{\\mathrm{imag},2}, \\delta_3, f_{\\mathrm{imag},3}, \\delta_4, f_{\\mathrm{imag},4}, r_{\\mathrm{all}}, r_{\\mathrm{neg}}]$，其中 $\\delta_i$ 的单位为 $\\text{eV}/\\text{\\AA}^2$，$f_{\\mathrm{imag},i}$ 为 $[0,1]$ 范围内的十进制数，$r_{\\mathrm{all}}$ 和 $r_{\\mathrm{neg}}$ 为 $\\left[-1,1\\right]$ 范围内的无单位十进制数。",
            "solution": "该问题是有效的，因为它在科学上基于固态物理学（特别是晶格动力学）的原理，并且提法明确，提供了获得唯一数值解所需的所有信息。\n\n目标是实现一个数值诊断程序，以研究在一个简化的一维 ($1$D) 单原子晶格模型中，声学求和规则 (ASR) 的违背与伪虚声子频率出现之间的关系。\n\n算法设计对每个测试用例分四个主要步骤进行，最后对所有用例进行最终的相关性分析。\n\n首先，我们建立物理模型。对于一个晶格常数为 $a$、原子质量为 $M$、且最近邻相互作用由弹簧常数 $K$ 建模的一维单原子链，给出了非零力常数 $\\Phi_{ij}$。问题引入了一个参数 $\\epsilon$ 来控制对 ASR 的违背：\n$$ \\Phi_{01} = \\Phi_{0,-1} = -K $$\n$$ \\Phi_{00} = 2K + \\epsilon $$\n对于此模型，平移不变性要求任何原子的力常数之和为零。位于原点 ($R=0$) 的原子的力常数之和为：\n$$ \\sum_{j} \\Phi_{0j} = \\Phi_{00} + \\Phi_{01} + \\Phi_{0,-1} = (2K + \\epsilon) + (-K) + (-K) = \\epsilon $$\n当且仅当 $\\epsilon=0$ 时，ASR 被满足。ASR 偏差 $\\delta$ 定义为该和在所有原子上的最大绝对值。由于平移对称性，这对所有原子都是一致的，因此：\n$$ \\delta = \\left| \\sum_j \\Phi_{0j} \\right| = |\\epsilon| $$\n给定的弹簧常数为 $K=10.0\\,\\text{eV}/\\text{\\AA}^2$。对于由 $\\epsilon$ 值定义的每个测试用例，可以直接计算出 $\\delta$（单位为 $\\text{eV}/\\text{\\AA}^2$）。\n\n其次，我们确定虚声子模式的比例 $f_{\\mathrm{imag}}$。声子频率 $\\omega(q)$ 与动力学矩阵 $D(q)$ 的本征值相关。对于一维单原子晶格，$D(q)$ 是一个标量，由力常数的傅里叶变换给出：\n$$ D(q) = \\frac{1}{M} \\sum_R \\Phi_{0R} e^{\\mathrm{i} q R} = \\omega^2(q) $$\n对于我们的最近邻模型，该和变为：\n$$ D(q) = \\frac{1}{M} \\left( \\Phi_{00} + \\Phi_{01}e^{\\mathrm{i}qa} + \\Phi_{0,-1}e^{-\\mathrm{i}qa} \\right) = \\frac{1}{M} \\left( \\Phi_{00} + (\\Phi_{01} + \\Phi_{0,-1})\\cos(qa) \\right) $$\n代入模型的力常数：\n$$ D(q) = \\frac{1}{M} \\left( (2K + \\epsilon) - 2K\\cos(qa) \\right) = \\frac{1}{M} \\left( 2K(1 - \\cos(qa)) + \\epsilon \\right) $$\n如果 $\\omega^2(q)  0$，即 $D(q)  0$，就会出现虚频率 $\\omega(q)$。为避免将由数值舍入产生的微小负数归类为虚数，问题使用一个保护阈值 $\\gamma = 1.0 \\times 10^{-12}\\,\\text{eV}/(\\text{amu}\\cdot\\text{\\AA}^2)$ 定义了一个更严格的条件：\n$$ D(q)  -\\gamma $$\n计算过程如下：在第一布里渊区 $q \\in [-\\pi/a, \\pi/a]$（其中 $a=5.43\\,\\text{\\AA}$）构建一个包含 $N_q = 501$ 个波矢 $q$ 的均匀网格。对于网格上的每个 $q$ 值，使用给定参数（$M=28.0855\\,\\text{amu}$，$K=10.0\\,\\text{eV}/\\text{\\AA}^2$）和测试用例特定的 $\\epsilon$ 来计算 $D(q)$。统计满足条件 $D(q)  -\\gamma$ 的网格点数 $N_{\\mathrm{imag}}$。然后，比例 $f_{\\mathrm{imag}}$ 为：\n$$ f_{\\mathrm{imag}} = \\frac{N_{\\mathrm{imag}}}{N_q} $$\n$2K(1 - \\cos(qa))$ 项始终是非负的。因此，要使 $D(q)$ 为负，$\\epsilon$ 必须为负，且其绝对值必须足以克服 $2K(1 - \\cos(qa))$ 项。具体来说，只有当 $\\epsilon  0$ 时才可能出现虚模式。如果 $\\epsilon \\ge 0$，则对所有 $q$ 都有 $D(q) \\ge 0$，因此 $f_{\\mathrm{imag}}$ 将为 $0$。\n\n第三，我们计算在所有四个测试用例中，所有计算出的 ASR 偏差集合 $\\{\\delta_i\\}$ 与对应的虚模式比例集合 $\\{f_{\\mathrm{imag},i}\\}$ 之间的皮尔逊线性相关系数 $r_{\\mathrm{all}}$。对于两个大小为 $n$ 的数据集 $X$ 和 $Y$，皮尔逊相关系数 $r$ 为：\n$$ r = \\frac{\\sum_{i=1}^n (X_i - \\bar{X})(Y_i - \\bar{Y})}{\\sqrt{\\sum_{i=1}^n (X_i - \\bar{X})^2} \\sqrt{\\sum_{i=1}^n (Y_i - \\bar{Y})^2}} $$\n如果 $\\{\\delta_i\\}$ 或 $\\{f_{\\mathrm{imag},i}\\}$ 的标准差为零，问题规定 $r_{\\mathrm{all}}$ 应定义为 $0$。\n\n第四，我们计算一个条件相关系数 $r_{\\mathrm{neg}}$。该系数使用相同的皮尔逊公式计算，但仅限于 ASR 违背总和为负的测试用例子集，即 $\\sum_j \\Phi_{0j} = \\epsilon  0$。如果该子集包含的数据点少于两个（这是计算有意义相关性所需的最小值），则 $r_{\\mathrm{neg}}$ 定义为 $0$。\n\n总体算法是遍历四个指定的 $\\epsilon$ 值，为每个值计算序对 $(\\delta, f_{\\mathrm{imag}})$，并存储这些结果。处理完所有情况后，从存储的结果中计算出两个相关系数 $r_{\\mathrm{all}}$ 和 $r_{\\mathrm{neg}}$。最终输出是一个包含十个结果数值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs numerical diagnostics on a 1D monatomic lattice model to correlate\n    Acoustic Sum Rule (ASR) violations with spurious imaginary phonon frequencies.\n    \"\"\"\n    # Define fixed physical parameters and numerical settings\n    a = 5.43  # Lattice constant in Angstrom\n    M = 28.0855  # Atomic mass in amu\n    K = 10.0  # Spring constant in eV/A^2\n    N_q = 501  # Number of wavevector points in the grid\n    gamma = 1.0e-12  # Guard threshold for imaginary modes in eV/(amu*A^2)\n\n    # Define the four test cases by the factor applied to K for epsilon\n    test_case_factors = [0.0, -1.0e-4, -0.5, 0.5]\n\n    # Lists to store results for correlation analysis\n    delta_results = []\n    f_imag_results = []\n    epsilon_values = []\n    output_list = []\n\n    # Create the uniform wavevector grid for the first Brillouin zone\n    q_grid = np.linspace(-np.pi / a, np.pi / a, N_q)\n\n    # Process each test case\n    for factor in test_case_factors:\n        # 1. Calculate ASR violation parameter epsilon and deviation delta\n        epsilon = factor * K\n        delta = abs(epsilon)\n\n        epsilon_values.append(epsilon)\n        delta_results.append(delta)\n\n        # 2. Calculate the dynamical matrix D(q) and find imaginary modes\n        # D(q) = (1/M) * [ (2K + epsilon) - 2K*cos(q*a) ]\n        D_q = (1.0 / M) * ((2.0 * K + epsilon) - 2.0 * K * np.cos(q_grid * a))\n        \n        # Count points where D(q) is below the negative threshold\n        imaginary_modes_count = np.sum(D_q  -gamma)\n        \n        # Calculate the fraction of imaginary modes\n        f_imag = imaginary_modes_count / N_q\n        f_imag_results.append(f_imag)\n\n        # Append the pair (delta, f_imag) to the final output list\n        output_list.append(delta)\n        output_list.append(f_imag)\n\n    # 3. Compute the Pearson correlation coefficient r_all for all cases\n    # Per the problem, if std dev is zero, correlation is 0.\n    if np.std(delta_results) == 0.0 or np.std(f_imag_results) == 0.0:\n        r_all = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, the off-diagonal element is the correlation\n        r_all = np.corrcoef(delta_results, f_imag_results)[0, 1]\n    \n    # 4. Compute the conditional correlation coefficient r_neg for cases with epsilon  0\n    neg_epsilon_indices = [i for i, e in enumerate(epsilon_values) if e  0]\n    \n    # Per the problem, if fewer than two such cases exist, r_neg is 0.\n    if len(neg_epsilon_indices)  2:\n        r_neg = 0.0\n    else:\n        delta_neg_subset = [delta_results[i] for i in neg_epsilon_indices]\n        f_imag_neg_subset = [f_imag_results[i] for i in neg_epsilon_indices]\n        \n        # Check for zero std dev within the subset\n        if np.std(delta_neg_subset) == 0.0 or np.std(f_imag_neg_subset) == 0.0:\n            r_neg = 0.0\n        else:\n            r_neg = np.corrcoef(delta_neg_subset, f_imag_neg_subset)[0, 1]\n\n    # Append correlation coefficients to the final output list\n    output_list.append(r_all)\n    output_list.append(r_neg)\n\n    # Format and print the final output as a single comma-separated list\n    # The format specifier ensures floating point representation without excessive precision\n    formatted_results = [f\"{val:.12g}\" for val in output_list]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "金属体系的声子计算由于费米面的存在而尤其具有挑战性，对布里渊区$k$点取样和电子展宽（smearing）参数$\\sigma$的收敛性要求极高。这个高级练习将指导你进行一个系统的收敛性研究，并教会你一种严谨的数值方法：通过分析声子频率随$\\sigma \\to 0$外推的行为，来区分由于计算参数不足导致的“假”声子不稳定性与材料本身固有的“真”物理不稳定性。掌握这种方法对于处理金属或窄带隙半导体中的软声子模和相变至关重要。",
            "id": "3460717",
            "problem": "考虑一个在密度泛函微扰理论 (DFPT) 框架下，用于金属声子的简化但有科学依据的模型。在金属中，声子动力学矩阵会获得一个电子屏蔽贡献，该贡献同时依赖于布里渊区采样（$k$ 点网格）和用于正则化费米能量附近占据数的费米面展宽参数 $\\sigma$。\n\n我们研究一个一维布里渊区，其简约坐标 $q \\in [0,1)$，并包含两个声子支：一个声学支 ($A$) 和一个光学支 ($O$)。未微扰（裸）声子频率定义为\n$$\n\\omega_{0,A}(q) = v_s \\left|\\sin(\\pi q)\\right|,\\quad \\omega_{0,O}(q) = \\omega_{\\mathrm{opt}},\n$$\n两者均以太赫兹 (THz) 为单位。电子-声子屏蔽会引起一个类科恩异常的频率平方修正，该修正局域在波矢 $q_0$ 附近，表示为\n$$\n\\Delta \\omega^2(q,\\sigma) = -G \\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right) \\cdot \\frac{1}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p},\n$$\n其中 $G$ 的单位是 $\\mathrm{THz}^2$，$w$ 是简约坐标 $q$ 中的一个无量纲宽度，$p$ 是控制展宽依赖关系的正指数，$\\sigma$ 是以电子伏特 (eV) 为单位的展宽，其特征尺度为 $\\sigma_0$ (单位 eV)。有限的 $k$ 点采样会在电子响应中引入一个偏差，我们将其建模为\n$$\nB(N_k,q) = -\\frac{B_0}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\n其中 $B_0$ 的单位是 $\\mathrm{THz}^2$ 且 $\\beta>0$。残余离散化噪声建模为\n$$\n\\eta(N_k,q) = \\frac{\\eta_0}{N_k^\\gamma} \\sin(2\\pi q),\n$$\n其中 $\\eta_0$ 的单位是 $\\mathrm{THz}^2$ 且 $\\gamma>0$。这两个支的总频率平方为\n$$\n\\omega_A^2(q; \\sigma, N_k) = \\omega_{0,A}^2(q) + \\Delta \\omega^2(q,\\sigma) + B(N_k,q) + \\eta(N_k,q),\n$$\n$$\n\\omega_O^2(q; \\sigma, N_k) = \\omega_{0,O}^2 + \\alpha\\,\\Delta \\omega^2(q,\\sigma) + \\frac{B_0'}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\n其中 $\\alpha \\in [0,1]$ 减小了光学支的电子异常，$B_0'$ 是光学支采样偏差的振幅。对于任意 $(\\sigma,N_k)$，负的频率平方表示存在不稳定性；按照标准做法，我们将报告的频率定义为\n$$\n\\omega(q,\\nu; \\sigma, N_k) = \\begin{cases}\n+\\sqrt{\\omega_\\nu^2(q; \\sigma, N_k)},  \\text{if } \\omega_\\nu^2(q; \\sigma, N_k) \\ge 0,\\\\\n-\\sqrt{-\\omega_\\nu^2(q; \\sigma, N_k)},  \\text{if } \\omega_\\nu^2(q; \\sigma, N_k)  0,\n\\end{cases}\n$$\n单位为 THz，这样虚模就由负值表示。\n\n你的任务是为三种合成金属材料，实现一个关于展宽 $\\sigma$ 和 $k$ 点网格尺寸 $N_k$ 的系统性收敛研究。对于每种材料，构建函数\n$$\nm(N_k,\\sigma) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu(q; \\sigma, N_k),\n$$\n其中 $\\mathbb{Q}$ 是 $q$ 在 $[0,1)$ 上的一个均匀网格，有 $N_q=201$ 个点，并定义最小频率平方\n$$\ny(N_k,\\sigma) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu^2(q; \\sigma, N_k).\n$$\n为了在固定的 $N_k$ 下分析 $\\sigma \\to 0$ 的极限，请将以下受 DFPT 启发的回归模型拟合到给定展宽集合上的数据 $\\{(\\sigma_i, y(N_k,\\sigma_i))\\}$：\n$$\ny(N_k,\\sigma) \\approx c(N_k) - \\frac{A(N_k)}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p},\n$$\n其中每个 $N_k$ 都有拟合参数 $c(N_k)$ 和 $A(N_k)$，且 $\\sigma_0$ 和 $p$ 已知。在拟合中使用非负的 $A(N_k)$。那么，外推到 $\\sigma \\to 0$ 的最小频率平方为\n$$\ny_0(N_k) = c(N_k) - A(N_k),\n$$\n而相应的外推最小频率为\n$$\n\\omega_0(N_k) = \\begin{cases}\n+\\sqrt{y_0(N_k)},  \\text{if } y_0(N_k) \\ge 0,\\\\\n-\\sqrt{-y_0(N_k)},  \\text{if } y_0(N_k)  0,\n\\end{cases}\n$$\n单位为 THz。基于 $y_0(N_k)$ 在不同网格上的模式，设计一个伪不稳定性度量：定义一个容差 $\\tau = 10^{-3}\\,\\mathrm{THz}^2$，并且当且仅当以下条件成立时，声明存在伪不稳定性：\n$$\n\\left(y_0(N_{k,1})  0\\right)\\ \\wedge\\ \\left(y_0(N_{k,3}) \\ge 0\\right)\\ \\wedge\\ \\left(y_0(N_{k,2}) - y_0(N_{k,1}) \\ge -\\tau\\right)\\ \\wedge\\ \\left(y_0(N_{k,3}) - y_0(N_{k,2}) \\ge -\\tau\\right),\n$$\n即，在最粗糙的网格上为负，在最精细的网格上为非负，并且随着 $N_k$ 增加，在容差范围内非递减。\n\n对这三种材料使用以下参数集（所有频率单位为 THz，所有 $G$、$B_0$、$B_0'$、$\\eta_0$ 单位为 $\\mathrm{THz}^2$，$q_0$、$w$ 为无量纲）：\n- 材料1（意在在粗糙网格上表现出伪不稳定性）：\n  - $v_s = 5.0$, $\\omega_{\\mathrm{opt}} = 10.0$, $q_0 = 0.30$, $w = 0.06$, $G = 12.0$, $\\alpha = 0.4$, $B_0 = 10.0$, $B_0' = 3.0$, $\\beta = 0.30$, $\\eta_0 = 0.6$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n- 材料2（意在具有一个在 $\\sigma \\to 0$ 和 $N_k \\to \\infty$ 时持续存在的真实不稳定性）：\n  - $v_s = 3.0$, $\\omega_{\\mathrm{opt}} = 8.0$, $q_0 = 0.30$, $w = 0.06$, $G = 12.0$, $\\alpha = 0.5$, $B_0 = 2.0$, $B_0' = 1.0$, $\\beta = 0.50$, $\\eta_0 = 0.4$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n- 材料3（意在表现为稳定且具有良好收敛性）：\n  - $v_s = 5.0$, $\\omega_{\\mathrm{opt}} = 12.0$, $q_0 = 0.35$, $w = 0.05$, $G = 6.0$, $\\alpha = 0.3$, $B_0 = 2.0$, $B_0' = 1.0$, $\\beta = 0.50$, $\\eta_0 = 0.3$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n\n使用展宽测试组\n$$\n\\{\\sigma_i\\} = \\{0.00,\\,0.005,\\,0.010,\\,0.020,\\,0.040\\}\\ \\mathrm{eV},\n$$\n以及 $k$ 点网格\n$$\n\\{N_{k,j}\\} = \\{12,\\,24,\\,48\\}.\n$$\n\n你的程序必须：\n- 对于每种材料，对于每个 $N_k \\in \\{12,24,48\\}$，通过在均匀 $q$ 网格和两个声子支上进行最小化，计算在给定 $\\sigma$ 集合上的 $y(N_k,\\sigma_i)$。\n- 拟合上述回归模型以获得 $c(N_k)$ 和 $A(N_k)$，然后计算 $y_0(N_k)$ 和 $\\omega_0(N_k)$。\n- 根据指定的规则确定伪不稳定性布尔值。\n\n物理单位要求：\n- 报告每种材料的 $\\omega_0(N_{k,3})$，单位为 THz，四舍五入到三位小数。布尔值必须是严格的布尔类型，根据规则指示是否存在伪不稳定性。\n\n最终输出格式：\n- 生成单行输出，包含一个由逗号分隔的列表，其中有三个项目，每个项目对应一种材料。每个项目本身必须是一个形式为 $[\\omega_0(N_{k,3}), \\text{布尔值}]$ 的双元素列表，其中第一个元素是四舍五入到三位小数的 THz 单位浮点数，第二个是布尔值。例如，总输出应如下所示\n$$\n\\big[ [\\omega_0^{(1)}, \\text{True}],\\ [\\omega_0^{(2)}, \\text{False}],\\ [\\omega_0^{(3)}, \\text{False}] \\big].\n$$\n\n你的程序必须是自包含的，不接受任何输入，并遵循指定的运行时环境约束。输出应精确地为一行，包含上述列表。",
            "solution": "该问题要求对三种合成金属材料的声子频率进行系统的收敛性研究，该研究基于一个植根于密度泛函微扰理论 (DFPT) 的简化模型。任务的核心是区分真实的物理不稳定性（虚声子频率）与由粗糙的布里渊区采样 ($N_k$) 和有限的电子展宽 ($\\sigma$) 产生的数值赝象。\n\n对于每种材料，求解方法按以下步骤顺序实现：\n1.  对于每个指定的 $k$ 点网格尺寸 $N_k$ 和给定集合中的每个展宽值 $\\sigma_i$，我们在一个精细的波矢 $q$ 网格上计算声学 ($A$) 和光学 ($O$) 两个支的声子频率平方。\n2.  确定在两个声子支和所有 $q$ 点上的最小频率平方，记为 $y(N_k, \\sigma_i)$。\n3.  对于每个固定的 $N_k$，使用计算出的点集 $\\{(\\sigma_i, y(N_k, \\sigma_i))\\}$ 对一个具有物理动机的模型进行回归拟合。这允许外推到零展宽极限，从而得到 $y_0(N_k)$。\n4.  分析外推值 $y_0(N_k)$ 作为 $N_k$ 函数的收敛行为，以将任何观察到的不稳定性归类为“伪”（数值赝象）或“真”（持续存在的物理特征）。\n5.  报告在最密 $k$ 点网格下的最终收敛最小频率 $\\omega_0(N_{k,3})$，以及关于伪不稳定性的判定结果。\n\n首先，我们建立计算网格和物理模型。一维布里渊区通过一个包含 $N_q=201$ 个点的均匀网格进行采样，用于简约坐标 $q \\in [0,1)$。声学支和光学支的频率平方由下式给出：\n$$\n\\omega_A^2(q; \\sigma, N_k) = \\omega_{0,A}^2(q) + \\Delta \\omega^2(q,\\sigma) + B(N_k,q) + \\eta(N_k,q),\n$$\n$$\n\\omega_O^2(q; \\sigma, N_k) = \\omega_{0,O}^2 + \\alpha\\,\\Delta \\omega^2(q,\\sigma) + \\frac{B_0'}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\n其中各分量定义如下：\n- 裸声学频率平方：$\\omega_{0,A}^2(q) = (v_s |\\sin(\\pi q)|)^2$\n- 裸光学频率平方：$\\omega_{0,O}^2 = \\omega_{\\mathrm{opt}}^2$\n- 科恩异常修正：$\\Delta \\omega^2(q,\\sigma) = -G \\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right) \\cdot \\frac{1}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p}$\n- 声学支 $k$ 点采样偏差：$B(N_k,q) = -\\frac{B_0}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right)$\n- 残余离散化噪声：$\\eta(N_k,q) = \\frac{\\eta_0}{N_k^\\gamma} \\sin(2\\pi q)$\n\n对于每种材料，我们遍历 $k$ 点网格集合 $\\{N_{k,j}\\} = \\{12, 24, 48\\}$ 和展宽值集合 $\\{\\sigma_i\\} = \\{0.00, 0.005, 0.010, 0.020, 0.040\\}\\,\\mathrm{eV}$。对于每一对 $(N_k, \\sigma_i)$，我们计算所有 $q$ 点的 $\\omega_A^2(q)$ 和 $\\omega_O^2(q)$。然后找到最小频率平方：\n$$\ny(N_k,\\sigma_i) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu^2(q; \\sigma_i, N_k).\n$$\n这为每个 $N_k$ 提供了五个 $(y, \\sigma)$ 数据对的数据集。\n\n接下来，我们外推到零展宽极限。对于每个固定的 $N_k$，我们拟合回归模型：\n$$\ny(N_k,\\sigma) \\approx c(N_k) - \\frac{A(N_k)}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p}.\n$$\n为了便于线性回归，我们引入一个预测变量 $X(\\sigma) = \\frac{1}{1 + (\\sigma/\\sigma_0)^p}$。模型变为 $y \\approx c - A \\cdot X$。这是一个关于系数 $c$ 和 $A$ 的线性最小二乘问题。我们可以将其写为最小化 $\\| M\\mathbf{p} - \\mathbf{y} \\|_2^2$，其中 $\\mathbf{y}$ 是 $y(N_k, \\sigma_i)$ 值的向量，$\\mathbf{p} = [c(N_k), A(N_k)]^T$ 是参数向量，$M$ 是设计矩阵，其列代表常数项 ($1$) 和预测项 ($-X_i$)。问题指定了一个非负性约束 $A(N_k) \\ge 0$。这个约束线性最小二乘问题使用 `scipy.optimize.lsq_linear` 求解，其中 $c(N_k)$ 的界限设置为 $(-\\infty, \\infty)$，$A(N_k)$ 的界限设置为 $[0, \\infty)$。在确定最优参数 $c(N_k)$ 和 $A(N_k)$ 后，外推的零展宽最小频率平方计算如下：\n$$\ny_0(N_k) = c(N_k) - A(N_k).\n$$\n对每个 $N_k \\in \\{12, 24, 48\\}$ 重复此过程，得到三个值：$y_0(N_{k,1})$、$y_0(N_{k,2})$ 和 $y_0(N_{k,3})$。\n\n最后，我们应用伪不稳定性判据。当且仅当使用容差 $\\tau = 10^{-3}\\,\\mathrm{THz}^2$ 的一组四个条件全部满足时，一个不稳定性被标记为“伪”：\n1. $y_0(N_{k,1})  0$ (在最粗糙的网格上存在不稳定性)\n2. $y_0(N_{k,3}) \\ge 0$ (在最精细的网格上是稳定的)\n3. $y_0(N_{k,2}) - y_0(N_{k,1}) \\ge -\\tau$ (从最粗糙到中等网格的非递减趋势)\n4. $y_0(N_{k,3}) - y_0(N_{k,2}) \\ge -\\tau$ (从中等到最精细网格的非递减趋势)\n根据这个逻辑谓词确定一个布尔值。然后，使用虚频的标准约定，从 $y_0(N_{k,3})$ 计算最密网格的最终外推频率 $\\omega_0(N_{k,3})$：\n$$\n\\omega_0(N_k) = \\begin{cases}\n+\\sqrt{y_0(N_k)},  \\text{if } y_0(N_k) \\ge 0,\\\\\n-\\sqrt{-y_0(N_k)},  \\text{if } y_0(N_k)  0.\n\\end{cases}\n$$\n$\\omega_0(N_{k,3})$ 的值四舍五入到三位小数，这个浮点数连同伪不稳定性布尔值，构成了每种材料的最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import lsq_linear\n\ndef solve():\n    \"\"\"\n    Performs a convergence study of phonon frequencies for three synthetic materials,\n    extrapolates to zero smearing, and identifies false instabilities.\n    \"\"\"\n\n    # Define the material parameters as test cases\n    test_cases = [\n        # Material 1 (intended to exhibit a false instability)\n        {\n            \"name\": \"Material 1\",\n            \"params\": {\n                \"v_s\": 5.0, \"omega_opt\": 10.0, \"q0\": 0.30, \"w\": 0.06, \"G\": 12.0, \"alpha\": 0.4,\n                \"B0\": 10.0, \"B0_prime\": 3.0, \"beta\": 0.30, \"eta0\": 0.6, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        },\n        # Material 2 (intended to have a true instability)\n        {\n            \"name\": \"Material 2\",\n            \"params\": {\n                \"v_s\": 3.0, \"omega_opt\": 8.0, \"q0\": 0.30, \"w\": 0.06, \"G\": 12.0, \"alpha\": 0.5,\n                \"B0\": 2.0, \"B0_prime\": 1.0, \"beta\": 0.50, \"eta0\": 0.4, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        },\n        # Material 3 (intended to be stable)\n        {\n            \"name\": \"Material 3\",\n            \"params\": {\n                \"v_s\": 5.0, \"omega_opt\": 12.0, \"q0\": 0.35, \"w\": 0.05, \"G\": 6.0, \"alpha\": 0.3,\n                \"B0\": 2.0, \"B0_prime\": 1.0, \"beta\": 0.50, \"eta0\": 0.3, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        }\n    ]\n\n    # Computational parameters\n    Nq = 201\n    q_grid = np.linspace(0, 1, Nq, endpoint=False)\n    sigma_values = np.array([0.00, 0.005, 0.010, 0.020, 0.040])\n    Nk_values = np.array([12, 24, 48])\n    tau = 1e-3\n\n    final_results = []\n\n    for case in test_cases:\n        params = case[\"params\"]\n        y0_by_Nk = {}\n\n        for Nk in Nk_values:\n            y_data = []\n            \n            for sigma in sigma_values:\n                # Calculate all components of the squared frequencies\n                omega_0A_sq = (params[\"v_s\"] * np.abs(np.sin(np.pi * q_grid)))**2\n                omega_0O_sq = params[\"omega_opt\"]**2\n                \n                common_gaussian = np.exp(-(q_grid - params[\"q0\"])**2 / (2 * params[\"w\"]**2))\n                \n                # Handle sigma=0 correctly for the formula\n                if params[\"sigma0\"] == 0 and sigma != 0:\n                    # Should not happen based on params, but for robustness\n                    delta_omega_sq_term = 0.0\n                elif sigma == 0.0:\n                    delta_omega_sq_term = 1.0\n                else:\n                    delta_omega_sq_term = 1.0 / (1.0 + (sigma / params[\"sigma0\"])**params[\"p\"])\n                \n                delta_omega_sq = -params[\"G\"] * common_gaussian * delta_omega_sq_term\n                \n                B_Nk_q = -params[\"B0\"] / (Nk**params[\"beta\"]) * common_gaussian\n                eta_Nk_q = params[\"eta0\"] / (Nk**params[\"gamma\"]) * np.sin(2 * np.pi * q_grid)\n                \n                B_prime_term = params[\"B0_prime\"] / (Nk**params[\"beta\"]) * common_gaussian\n\n                # Calculate total squared frequencies for both branches\n                omega_A_sq = omega_0A_sq + delta_omega_sq + B_Nk_q + eta_Nk_q\n                omega_O_sq = omega_0O_sq + params[\"alpha\"] * delta_omega_sq + B_prime_term\n\n                # Find the minimum squared frequency for this (Nk, sigma)\n                y_Nk_sigma = np.min(np.concatenate((omega_A_sq, omega_O_sq)))\n                y_data.append(y_Nk_sigma)\n\n            # Perform the regression to find y0(Nk)\n            # Predictor variable X(sigma) = 1 / (1 + (sigma/sigma0)^p)\n            X = 1.0 / (1.0 + (sigma_values / params[\"sigma0\"])**params[\"p\"])\n            # Model is y ~ c - A*X. We want to find p = [c, A]\n            M = np.vstack([np.ones_like(X), -X]).T\n            \n            fit_result = lsq_linear(M, np.array(y_data), bounds=([-np.inf, 0], [np.inf, np.inf]))\n            c_Nk, A_Nk = fit_result.x\n            \n            y0_Nk = c_Nk - A_Nk\n            y0_by_Nk[Nk] = y0_Nk\n\n        # Analyze for false instability\n        y0_vals = [y0_by_Nk[Nk] for Nk in Nk_values]\n        \n        is_false_instability = (\n            y0_vals[0]  0 and\n            y0_vals[2] >= 0 and\n            (y0_vals[1] - y0_vals[0]) >= -tau and\n            (y0_vals[2] - y0_vals[1]) >= -tau\n        )\n\n        # Calculate final frequency omega_0(N_k=48)\n        y0_final = y0_vals[2]\n        if y0_final >= 0:\n            omega0_final = np.sqrt(y0_final)\n        else:\n            omega0_final = -np.sqrt(-y0_final)\n\n        # Store rounded final frequency and boolean\n        final_results.append([round(omega0_final, 3), is_false_instability])\n\n    print(final_results)\n\nsolve()\n```"
        }
    ]
}