{
    "hands_on_practices": [
        {
            "introduction": "菲克定律通常假设扩散系数 $D$ 是一个常数，但这在许多物理情境下只是一个近似。一个更基本的模型，即晶格气体模型，考虑了原子占据晶格位置时的排斥效应，这导致扩散通量与浓度之间存在非线性关系。本练习旨在通过推导和数值验证，量化菲克定律与这种更真实的晶格气体模型之间的偏差，从而加深对菲克定律适用范围的理解 ()。",
            "id": "3451875",
            "problem": "要求您实现并分析固体中的一维质量输运过程，该过程遵循两种源于不同物理假设的本构定律：格气排斥模型和 Fick 定律。目标是通过第一性原理和计算验证，确定在哪些位点分数浓度范围内，Fick 行为不再是格气模型的充分近似。所有物理量都必须使用国际单位制（SI）处理，但浓度除外，它是一个在区间 $\\left(0,1\\right)$ 内的无量纲位点分数。您的最终程序必须计算并报告一个指定测试套件的结果。\n\n需要使用的基本原理和定义：\n- 一维空间中的连续性方程为 $\\,\\partial c/\\partial t + \\partial J/\\partial x = 0\\,$，其中 $\\,c(x,t)\\,$ 是位点分数浓度，$\\,J(x,t)\\,$ 是数量通量。\n- 等温条件下的非平衡热力学意味着存在一个本构关系，通过迁移率将通量与化学势 $\\,\\mu\\,$ 的梯度联系起来。对于有位点排斥的格气模型，格点上无相互作用的占据物的局部化学势为 $\\,\\mu(c) = k_{\\mathrm{B}} T \\ln\\!\\left(\\dfrac{c}{1-c}\\right)\\,$，其中 $\\,k_{\\mathrm{B}}\\,$ 是 Boltzmann 常数，$\\,T\\,$ 是绝对温度。\n- 设 $\\,M_{\\mathrm{p}}(c)\\,$ 表示单粒子迁移率，单位为 $\\mathrm{s}/\\mathrm{kg}$。假设 $\\,M_{\\mathrm{p}}(c) = D_0/(k_{\\mathrm{B}} T)\\,$，其中 $\\,D_0\\,$ 是一个参考示踪扩散系数，单位为 $\\mathrm{m}^2/\\mathrm{s}$。数量通量的格气本构定律为 $\\,J_{\\mathrm{LG}} = - M_{\\mathrm{p}}(c)\\, c\\, \\nabla \\mu\\,$。在一维情况下，此为 $\\,J_{\\mathrm{LG}}(x) = - M_{\\mathrm{p}}(c(x))\\, c(x)\\, \\dfrac{\\mathrm{d}\\mu}{\\mathrm{d}x}\\,$。\n- 具有恒定扩散系数 $\\,D_0\\,$ 的 Fick 定律为 $\\,J_{\\mathrm{F}} = - D_0 \\nabla c\\,$，在一维情况下为 $\\,J_{\\mathrm{F}}(x) = - D_0 \\dfrac{\\mathrm{d} c}{\\mathrm{d} x}\\,$。\n\n任务：\n1. 从上述定义出发，推导 Fick 通量 $\\,J_{\\mathrm{F}}\\,$ 与格气通量 $\\,J_{\\mathrm{LG}}\\,$ 之间的瞬时局部相对偏差的表达式，并用局部浓度 $\\,c\\,$ 表示。您的推导必须基于所给定的基本原理，不应引用任何未提供的简化公式。将最终的相对偏差表示为仅关于 $\\,c\\,$ 的函数。\n2. 在长度为 $\\,L\\,$ 的一维周期性域中，通过构建一个稳态浓度分布 $\\,c(x) = \\bar{c} + a \\sin(2\\pi x/L)\\,$ 来实现数值验证。这里 $\\,\\bar{c}\\,$ 是空间平均浓度，$\\,a\\,$ 是一个振幅，其选择应确保处处有 $\\,c(x)\\in(0,1)\\,$。使用具有 $\\,N\\,$ 个点的均匀网格和周期性有限差分来计算空间梯度。使用 $\\,N = 20001\\,$ 和 $\\,L = 1\\times 10^{-6}\\,\\mathrm{m}\\,$。使用 $\\,k_{\\mathrm{B}} = 1.380\\,649\\times 10^{-23}\\,\\mathrm{J/K}\\,$，$\\,T = 1000\\,\\mathrm{K}\\,$ 以及 $\\,D_0 = 1\\times 10^{-14}\\,\\mathrm{m}^2/\\mathrm{s}\\,$。为确保对数计算的数值稳定性，在计算 $\\,\\mu(c)\\,$ 时，通过一个小的 $\\,\\varepsilon = 10^{-9}\\,$ 将 $\\,c(x)\\,$ 的范围限制在远离 $\\,0\\,$ 和 $\\,1\\,$ 的区间内。\n3. 对每个网格点，使用给定的本构关系计算瞬时格气通量 $\\,J_{\\mathrm{LG}}(x)\\,$ 和瞬时 Fick 通量 $\\,J_{\\mathrm{F}}(x)\\,$。将逐点相对偏差定义为 $\\,r(x) = \\dfrac{\\lvert J_{\\mathrm{F}}(x) - J_{\\mathrm{LG}}(x)\\rvert}{\\max\\left(\\lvert J_{\\mathrm{LG}}(x)\\rvert, \\tau\\right)}\\,$，其中 $\\,\\tau = 10^{-30}\\,$，以避免在梯度为零的驻点处发生除零错误。\n4. 对于给定的容差 $\\,\\delta\\in(0,1)\\,$，将失效集定义为满足 $\\,r(x) \\ge \\delta\\,$ 的位置集合。将此集合映射到其对应的浓度值 $\\,c(x)\\,$。如果失效集为空，则报告 $\\,\\left[0.0, 0.0\\right]\\,$。否则，报告该失效集上的最小和最大浓度，并四舍五入到三位小数。\n5. 为以下参数三元组 $\\,\\left(\\bar{c}, a, \\delta\\right)\\,$ 的测试套件实现计算。这些参数的选取旨在探测稀疏、中等和接近饱和的区域，以及接近阈值和广泛覆盖的情况：\n   - 测试 $\\,1\\,$: $\\left(\\bar{c}, a, \\delta\\right) = \\left(0.1, 0.05, 0.2\\right)$。\n   - 测试 $\\,2\\,$: $\\left(\\bar{c}, a, \\delta\\right) = \\left(0.3, 0.1, 0.25\\right)$。\n   - 测试 $\\,3\\,$: $\\left(\\bar{c}, a, \\delta\\right) = \\left(0.8, 0.15, 0.1\\right)$。\n   - 测试 $\\,4\\,$: $\\left(\\bar{c}, a, \\delta\\right) = \\left(0.5, 0.49, 0.5\\right)$。\n   - 测试 $\\,5\\,$: $\\left(\\bar{c}, a, \\delta\\right) = \\left(0.02, 0.015, 0.03\\right)$。\n6. 单位和数值输出：\n   - 浓度是无量纲的。所有其他输入和中间量必须按照指定的国际单位制（SI）单位进行处理。\n   - 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个条目对应一个测试用例，本身是一个包含失效的浓度下限和上限的双元素列表，四舍五入到三位小数。例如，一个有效的输出格式是 $\\left[\\left[0.000,0.000\\right],\\left[0.250,0.400\\right],\\dots\\right]$。\n\n您的最终交付成果必须是一个完整的、可运行的程序，该程序执行上述任务，并仅为指定的测试套件打印所描述的单行输出。不允许外部输入，也不得读取或写入任何文件。",
            "solution": "该问题经评估有效。它在科学上基于非平衡热力学和输运现象的原理，特别是 Fick 扩散及其与更基本的格气模型的关系。该问题是适定的，为获得唯一解提供了所有必要的常数、定义和边界条件。语言客观、精确，任务结构清晰，旨在获得可验证的结果。因此，将提供完整的解决方案。\n\n解决方案分为两部分：首先，对两种通量模型之间的关系及由此产生的相对偏差进行解析推导；其次，描述用于验证此关系的数值算法。\n\n### 第 1 部分：解析推导\n\n问题定义了两种一维质量通量的本构定律。具有恒定扩散系数 $D_0$ 的 Fick 第一定律由下式给出：\n$$\nJ_{\\mathrm{F}}(x) = - D_0 \\frac{\\mathrm{d} c}{\\mathrm{d} x}\n$$\n基于非平衡热力学的格气模型，根据化学势梯度定义了通量 $J_{\\mathrm{LG}}$：\n$$\nJ_{\\mathrm{LG}}(x) = - M_{\\mathrm{p}}(c(x))\\, c(x)\\, \\frac{\\mathrm{d}\\mu}{\\mathrm{d}x}\n$$\n所提供的单粒子迁移率 $M_{\\mathrm{p}}(c)$ 和化学势 $\\mu(c)$ 的定义如下：\n$$\nM_{\\mathrm{p}}(c) = \\frac{D_0}{k_{\\mathrm{B}} T}\n$$\n$$\n\\mu(c) = k_{\\mathrm{B}} T \\ln\\left(\\frac{c}{1-c}\\right)\n$$\n其中 $k_{\\mathrm{B}}$ 是 Boltzmann 常数，$T$ 是绝对温度。\n\n为了将 $J_{\\mathrm{LG}}$ 与浓度梯度 $\\frac{\\mathrm{d}c}{\\mathrm{d}x}$ 联系起来，我们首先对化学势的导数应用链式法则：\n$$\n\\frac{\\mathrm{d}\\mu}{\\mathrm{d}x} = \\frac{\\mathrm{d}\\mu}{\\mathrm{d}c} \\frac{\\mathrm{d}c}{\\mathrm{d}x}\n$$\n$\\mu(c)$ 对 $c$ 的导数为：\n$$\n\\frac{\\mathrm{d}\\mu}{\\mathrm{d}c} = \\frac{\\mathrm{d}}{\\mathrm{d}c} \\left[ k_{\\mathrm{B}} T (\\ln(c) - \\ln(1-c)) \\right] = k_{\\mathrm{B}} T \\left( \\frac{1}{c} + \\frac{1}{1-c} \\right) = k_{\\mathrm{B}} T \\frac{1-c+c}{c(1-c)} = \\frac{k_{\\mathrm{B}} T}{c(1-c)}\n$$\n现在，我们将此结果以及 $M_{\\mathrm{p}}(c)$ 的表达式代入 $J_{\\mathrm{LG}}(x)$ 的公式中：\n$$\nJ_{\\mathrm{LG}}(x) = - \\left(\\frac{D_0}{k_{\\mathrm{B}} T}\\right) c(x) \\left(\\frac{k_{\\mathrm{B}} T}{c(x)(1-c(x))}\\right) \\frac{\\mathrm{d}c}{\\mathrm{d}x}\n$$\n项 $k_{\\mathrm{B}}T$ 和 $c(x)$ 相消，得到格气通量的简化表达式：\n$$\nJ_{\\mathrm{LG}}(x) = - \\frac{D_0}{1-c(x)} \\frac{\\mathrm{d}c}{\\mathrm{d}x}\n$$\n通过将其与 Fick 通量 $J_{\\mathrm{F}}(x)$进行比较，我们发现一个直接关系：\n$$\nJ_{\\mathrm{LG}}(x) = \\frac{1}{1-c(x)} \\left(-D_0 \\frac{\\mathrm{d}c}{\\mathrm{d}x}\\right) = \\frac{1}{1-c(x)} J_{\\mathrm{F}}(x)\n$$\n这表明格气模型等效于具有浓度依赖性扩散系数 $D(c) = D_0 / (1-c)$ 的 Fick 扩散。只有在 $c \\to 0$ 的稀疏极限下，才能恢复具有恒定扩散系数 $D_0$ 的 Fick 定律。根据这个关系，我们也可以写出 $J_{\\mathrm{F}}(x) = (1-c(x)) J_{\\mathrm{LG}}(x)$。\n\n接下来，我们推导逐点相对偏差的表达式，其定义为：\n$$\nr(x) = \\frac{\\lvert J_{\\mathrm{F}}(x) - J_{\\mathrm{LG}}(x)\\rvert}{\\max\\left(\\lvert J_{\\mathrm{LG}}(x)\\rvert, \\tau\\right)}\n$$\n使用关系式 $J_{\\mathrm{F}}(x) = (1-c(x)) J_{\\mathrm{LG}}(x)$，我们简化分子：\n$$\n\\lvert J_{\\mathrm{F}}(x) - J_{\\mathrm{LG}}(x)\\rvert = \\lvert (1-c(x)) J_{\\mathrm{LG}}(x) - J_{\\mathrm{LG}}(x)\\rvert = \\lvert -c(x) J_{\\mathrm{LG}}(x)\\rvert = c(x) \\lvert J_{\\mathrm{LG}}(x)\\rvert\n$$\n因为浓度 $c(x)$ 总是正的。相对偏差变为：\n$$\nr(x) = \\frac{c(x) \\lvert J_{\\mathrm{LG}}(x)\\rvert}{\\max\\left(\\lvert J_{\\mathrm{LG}}(x)\\rvert, \\tau\\right)}\n$$\n只要 $\\frac{\\mathrm{d}c}{\\mathrm{d}x} \\neq 0$，通量 $\\lvert J_{\\mathrm{LG}}(x)\\rvert$ 就非零。对于所有满足 $\\lvert J_{\\mathrm{LG}}(x)\\rvert \\ge \\tau$ 的点，表达式简化为：\n$$\nr(x) = c(x)\n$$\n正则化参数 $\\tau = 10^{-30}$ 非常小。通量大小只会在浓度分布极值点周围梯度消失的无穷小区域内低于此值。因此，在实际应用中，失效条件 $r(x) \\ge \\delta$ 等效于 $c(x) \\ge \\delta$。\n\n失效集由 Fick 定律是较差近似的点组成，因此对应于局部浓度 $c(x)$ 超过容差 $\\delta$ 的区域。\n\n### 第 2 部分：数值实现与算法\n\n数值验证的结构旨在从第一性原理计算通量及其偏差，而不依赖于上面推导的解析简化。这是对理论的稳健检验。\n\n1.  **离散化**：将长度为 $L = 1 \\times 10^{-6}\\,\\mathrm{m}$ 的一维周期性域离散化为一个包含 $N = 20001$ 个点的均匀网格。网格间距为 $h = L/N$。空间坐标由数组 $x_i = i \\cdot h$ 表示，其中 $i = 0, \\dots, N-1$。\n\n2.  **浓度分布**：对于每个测试用例 $(\\bar{c}, a, \\delta)$，在每个网格点上计算稳态浓度分布：\n    $$\n    c_i = c(x_i) = \\bar{c} + a \\sin(2\\pi x_i/L)\n    $$\n\n3.  **梯度计算**：使用考虑周期性边界条件的二阶中心有限差分格式计算空间梯度。对于网格上的通用函数 $f(x)$，其在点 $i$ 的导数近似为：\n    $$\n    \\frac{\\mathrm{d}f}{\\mathrm{d}x}\\bigg|_{i} \\approx \\frac{f_{i+1} - f_{i-1}}{2h}\n    $$\n    通过环绕索引来处理周期性（例如，$f_{N} \\equiv f_0$ 和 $f_{-1} \\equiv f_{N-1}$）。\n\n4.  **通量计算**：\n    -   **Fick 通量 ($J_{\\mathrm{F}}$)**：首先，使用有限差分格式计算浓度梯度 $\\frac{\\mathrm{d}c}{\\mathrm{d}x}$。然后，通量计算为 $J_{\\mathrm{F},i} = -D_0 \\left(\\frac{\\mathrm{d}c}{\\mathrm{d}x}\\right)_i$。\n    -   **格气通量 ($J_{\\mathrm{LG}}$)**：根据基本定义进行计算。\n        a. 计算化学势 $\\mu_i = \\mu(c_i)$。为避免对数引起的数值不稳定性，首先将浓度值 $c_i$ 截断到 $[\\varepsilon, 1-\\varepsilon]$ 范围内，其中 $\\varepsilon = 10^{-9}$。\n        $$\n        c_{\\text{clamped},i} = \\max(\\varepsilon, \\min(c_i, 1-\\varepsilon))\n        $$\n        $$\n        \\mu_i = k_{\\mathrm{B}} T \\ln\\left(\\frac{c_{\\text{clamped},i}}{1-c_{\\text{clamped},i}}\\right)\n        $$\n        b. 使用相同的周期性中心差分格式对 $\\mu_i$ 值数组计算化学势的梯度 $\\left(\\frac{\\mathrm{d}\\mu}{\\mathrm{d}x}\\right)_i$。\n        c. 计算单粒子迁移率 $M_p = D_0/(k_{\\mathrm{B}}T)$。\n        d. 最后，组装格气通量：$J_{\\mathrm{LG},i} = -M_p \\cdot c_i \\cdot \\left(\\frac{\\mathrm{d}\\mu}{\\mathrm{d}x}\\right)_i$。注意，使用原始未截断的浓度 $c_i$ 作为前置因子。\n\n5.  **失效集分析**：\n    a. 对每个网格点 $i$，使用给定公式计算逐点相对偏差 $r_i$，其中 $\\tau=10^{-30}$ 用于正则化。\n    b. 使用布尔掩码识别出“失效集”中所有满足 $r_i \\ge \\delta$ 的点。\n    c. 如果此掩码为空（即没有点满足条件），则该测试用例的结果为 $[0.0, 0.0]$。\n    d. 否则，收集失效集对应的浓度 $c_i$。找到该集合的最小值和最大值，从而得到 Fick 近似失效的浓度范围界限。然后将这些界限四舍五入到三位小数。\n\n当为给定的测试套件执行此综合数值程序时，它验证了失效区域由条件 $c(x) \\ge \\delta$ 决定的解析发现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the concentration range where the Fickian model deviates from a\n    lattice-gas model by a given tolerance, for a set of test cases.\n    \"\"\"\n    # Define physical and numerical constants from the problem statement\n    N = 20001\n    L = 1.0e-6  # meters\n    k_B = 1.380649e-23  # J/K\n    T = 1000.0  # K\n    D_0 = 1.0e-14  # m²/s\n    epsilon = 1.0e-9\n    tau = 1.0e-30\n\n    # Define the test suite of parameter triplets (c_bar, a, delta)\n    test_cases = [\n        (0.1, 0.05, 0.2),    # Test 1\n        (0.3, 0.1, 0.25),   # Test 2\n        (0.8, 0.15, 0.1),   # Test 3\n        (0.5, 0.49, 0.5),   # Test 4\n        (0.02, 0.015, 0.03), # Test 5\n    ]\n\n    all_results = []\n\n    # Setup the discretized one-dimensional periodic spatial grid\n    x = np.linspace(0, L, N, endpoint=False)\n    h = L / N  # Grid spacing\n\n    # Process each test case\n    for c_bar, a, delta in test_cases:\n        # 1. Construct the stationary concentration profile c(x)\n        c = c_bar + a * np.sin(2 * np.pi * x / L)\n\n        # 2. Compute the Fickian flux J_F\n        # Gradient of concentration using second-order periodic central differences\n        dc_dx = (np.roll(c, -1) - np.roll(c, 1)) / (2 * h)\n        J_F = -D_0 * dc_dx\n\n        # 3. Compute the Lattice-Gas flux J_LG from fundamental definitions\n        # Clamp concentration to avoid log(0) or division by zero in mu\n        c_clamped = np.clip(c, epsilon, 1 - epsilon)\n        \n        # Chemical potential mu(c)\n        mu = k_B * T * np.log(c_clamped / (1 - c_clamped))\n        \n        # Gradient of chemical potential using second-order periodic central differences\n        dmu_dx = (np.roll(mu, -1) - np.roll(mu, 1)) / (2 * h)\n        \n        # Per-particle mobility M_p\n        M_p = D_0 / (k_B * T)\n        \n        # Assemble the lattice-gas flux J_LG (using original unclamped c)\n        J_LG = -M_p * c * dmu_dx\n\n        # 4. Compute the pointwise relative deviation r(x)\n        numerator = np.abs(J_F - J_LG)\n        denominator = np.maximum(np.abs(J_LG), tau)\n        r = numerator / denominator\n\n        # 5. Determine the failure set and its concentration range\n        # The failure set consists of points where the deviation exceeds the tolerance\n        failure_mask = r >= delta\n        \n        if not np.any(failure_mask):\n            # If the failure set is empty, report [0.0, 0.0]\n            result = [0.0, 0.0]\n        else:\n            # Otherwise, find the min and max concentrations in the failure set\n            c_in_failure_set = c[failure_mask]\n            min_c = np.min(c_in_failure_set)\n            max_c = np.max(c_in_failure_set)\n            result = [min_c, max_c]\n        \n        all_results.append(result)\n\n    # 6. Format the final output string as specified\n    formatted_results = []\n    for res in all_results:\n        # Round each bound to three decimal places\n        formatted_results.append(f\"[{res[0]:.3f},{res[1]:.3f}]\")\n    \n    # Print the single-line output\n    print(f\"[{','.join(formatted_results)}]\")\n\n\n# Execute the main function\nsolve()\n```"
        },
        {
            "introduction": "在许多晶体材料中，原子扩散在不同方向上并非等同，这种现象称为各向异性扩散。本练习将理论与原子尺度的模拟相结合，展示了如何从分子动力学（MD）轨迹中提取各向异性扩散张量。你将通过分析原子的均方位移（MSD）来量化不同晶向的扩散系数，并利用这些系数预测非均匀扩散前沿的椭圆形状 ()。",
            "id": "3451861",
            "problem": "考虑在一个层状晶体固体的二维横截面中的各向异性菲克输运问题，其主方向沿笛卡尔坐标轴对齐。层状平面平行于 $x$ 轴，堆叠方向沿 $y$ 轴。您将获得模拟该固体中非相互作用示踪原子长时间扩散运动的合成自分子动力学 (MD) 轨迹。您的任务是构建一个程序，从第一性原理出发，量化单轴各向异性并预测各向异性扩散前沿。\n\n从一个有效的基础出发：质量守恒和具有各向异性输运张量的菲克第一定律的线性响应形式。从这些原理出发，推导适用于具有恒定各向异性扩散张量的固体的控制输运方程，并确定在此条件下点源初始化的基本解。同时，使用均方位移与沿各主轴的扩散系数之间的适当长时间关系，将 MD 中观察到的扩散运动与宏观输运系数联系起来。利用这些推导设计一个数值稳健的算法，该算法能够：\n- 通过对长时间下均方位移与时间的关系进行回归，从 MD 轨迹中分别估算沿 $x$ 轴的 $D_\\parallel$ 和沿 $y$ 轴的 $D_\\perp$。\n- 在给定的评估时间 $t_\\text{eval}$，给定 $t=0$ 时的点源总质量 $M$ 的情况下，预测沿 $x$ 轴和 $y$ 轴上浓度等于预设阈值 $c_\\text{th}$ 的位置 $x_\\text{front}$ 和 $y_\\text{front}$。\n\n科学真实性约束：\n- 将扩散系数张量在实验室坐标系中视为常数和对角矩阵，以反映主轴与坐标轴对齐的均匀层状晶体。\n- 将 MD 轨迹视为稀疏、非相互作用的示踪剂，其长时间统计数据反映了与固体中扩散运动一致的独立高斯增量。\n\n单位和输出：\n- 扩散系数必须以 $\\mathrm{m^2/s}$ 为单位报告。\n- 距离必须以 $\\mathrm{m}$ 为单位报告。\n- 所有最终数值结果必须以浮点数形式打印。此任务不使用角度。\n\n测试套件和必需参数：\n对于每个测试用例，您的程序必须使用具有零均值和与沿各轴的扩散运动一致的方差的独立高斯增量来生成合成 MD 轨迹。具体来说，对于一个时间步长 $\\Delta t$，沿轴 $i \\in \\{x,y\\}$ 的每步增量是从一个方差为 $2 D_i \\Delta t$ 的正态分布中抽取的。为确保可复现性，每个案例使用一个固定的伪随机种子。然后，程序必须从生成的轨迹中估算 $D_\\parallel$ 和 $D_\\perp$，并随后使用推导出的各向异性解计算在 $t_\\text{eval}$ 时的 $x_\\text{front}$ 和 $y_\\text{front}$。\n\n实现以下三个科学上合理的测试用例：\n\n- 案例 A（理想情况，各向同性极限）：\n  - 真实扩散系数：$D_\\parallel = 2\\times 10^{-17}\\ \\mathrm{m^2/s}$，$D_\\perp = 2\\times 10^{-17}\\ \\mathrm{m^2/s}$。\n  - 粒子数：$N_\\text{p} = 500$。\n  - 时间步数：$N_\\text{steps} = 400$。\n  - 时间步长：$\\Delta t = 100\\ \\mathrm{s}$。\n  - 评估时间：$t_\\text{eval} = N_\\text{steps}\\,\\Delta t = 40000\\ \\mathrm{s}$。\n  - 点源质量：$M = 1.0$。\n  - 浓度阈值：$c_\\text{th} = 10^{10}$。\n  - 随机种子：$s = 42$。\n\n- 案例 B（中等各向异性，层状晶体）：\n  - 真实扩散系数：$D_\\parallel = 1\\times 10^{-16}\\ \\mathrm{m^2/s}$，$D_\\perp = 1\\times 10^{-18}\\ \\mathrm{m^2/s}$。\n  - 粒子数：$N_\\text{p} = 800$。\n  - 时间步数：$N_\\text{steps} = 600$。\n  - 时间步长：$\\Delta t = 100\\ \\mathrm{s}$。\n  - 评估时间：$t_\\text{eval} = N_\\text{steps}\\,\\Delta t = 60000\\ \\mathrm{s}$。\n  - 点源质量：$M = 1.0$。\n  - 浓度阈值：$c_\\text{th} = 2\\times 10^{10}$。\n  - 随机种子：$s = 12345$。\n\n- 案例 C（边缘情况，具有近乎阻塞的垂直输运的极端各向异性）：\n  - 真实扩散系数：$D_\\parallel = 5\\times 10^{-17}\\ \\mathrm{m^2/s}$，$D_\\perp = 1\\times 10^{-21}\\ \\mathrm{m^2/s}$。\n  - 粒子数：$N_\\text{p} = 400$。\n  - 时间步数：$N_\\text{steps} = 500$。\n  - 时间步长：$\\Delta t = 200\\ \\mathrm{s}$。\n  - 评估时间：$t_\\text{eval} = N_\\text{steps}\\,\\Delta t = 100000\\ \\mathrm{s}$。\n  - 点源质量：$M = 1.0$。\n  - 浓度阈值：$c_\\text{th} = 10^{11}$。\n  - 随机种子：$s = 2023$。\n\n算法要求：\n- 通过对 $N_\\text{p}$ 个独立粒子沿 $x$ 和 $y$ 轴的每步增量进行累加求和来构建 MD 轨迹，从 $t=0$ 时的零位移开始。\n- 在每个时间步 $t_k = k\\,\\Delta t$（其中 $k=1,\\dots,N_\\text{steps}$），通过对所有粒子进行平均，计算沿各轴的均方位移 $\\langle \\Delta x(t)^2\\rangle$ 和 $\\langle \\Delta y(t)^2\\rangle$。\n- 通过对最后 $70\\%$ 的时间样本的均方位移与时间进行线性最小二乘拟合来估算 $D_\\parallel$ 和 $D_\\perp$。提取斜率 $a_i$（其中 $i\\in\\{x,y\\}$），并返回估计值 $D_i = a_i / 2$。\n- 使用推导出的在时间 $t_\\text{eval}$ 时总质量为 $M$ 的点源的各向异性基本解，计算浓度等于 $c_\\text{th}$ 时的轴向前沿位置 $x_\\text{front}$ 和 $y_\\text{front}$。确保您推导的表达式所需的对数参数严格为正；如果不是，则在该测试用例中为相应的前沿位置返回一个非数值 (Not-a-Number) 结果。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，按顺序 $[D_\\parallel, D_\\perp, x_\\text{front}, y_\\text{front}]$ 输出一个包含四个浮点数的列表，其中 $D_\\parallel$ 和 $D_\\perp$ 的单位是 $\\mathrm{m^2/s}$，$x_\\text{front}$ 和 $y_\\text{front}$ 的单位是 $\\mathrm{m}$。因此，总输出必须是一个包含三个此类列表的列表，每个测试用例一个，例如 $[[d_{1x},d_{1y},x_1,y_1],[d_{2x},d_{2y},x_2,y_2],[d_{3x},d_{3y},x_3,y_3]]$。",
            "solution": "科学基础始于固体的质量守恒和菲克第一定律。用 $c(\\mathbf{r},t)$ 表示浓度，用 $\\mathbf{J}(\\mathbf{r},t)$ 表示通量。质量守恒要求\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot \\mathbf{J} = 0.\n$$\n对于各向异性菲克输运，线性响应通过一个恒定的二阶张量 $\\mathbf{D}$ 将通量与浓度梯度联系起来，\n$$\n\\mathbf{J} = -\\mathbf{D}\\,\\nabla c,\n$$\n其中 $\\mathbf{D}$ 是正定的，并且在层状晶体的主轴坐标系中是对角的，其对角元为沿 $x$ 轴的 $D_\\parallel$ 和沿 $y$ 轴的 $D_\\perp$。将 $\\mathbf{J}$ 代入守恒方程，得到各向异性扩散方程\n$$\n\\frac{\\partial c}{\\partial t} = \\nabla \\cdot \\left(\\mathbf{D}\\,\\nabla c\\right).\n$$\n在二维无界域中，对于一个在 $t=0$ 时位于原点、总质量为 $M$ 的点源，其基本解（格林函数）是各向异性高斯函数\n$$\nc(x,y,t) = \\frac{M}{4\\pi t \\sqrt{D_\\parallel D_\\perp}} \\exp\\!\\left(-\\frac{x^2}{4 D_\\parallel t} - \\frac{y^2}{4 D_\\perp t}\\right).\n$$\n该解可通过傅里叶变换方法得到：应用空间傅里叶变换将线性常系数偏微分方程解耦，对每个波矢 $\\mathbf{k}$ 得到一个关于时间的常微分方程，其在傅里叶空间中的解为 $\\hat{c}(\\mathbf{k},t) = \\hat{c}(\\mathbf{k},0)\\exp\\!\\left(-t\\,(D_\\parallel k_x^2 + D_\\perp k_y^2)\\right)$；进行逆变换即可得到上述高斯函数。\n\n为了将分子动力学 (MD) 轨迹与宏观输运系数联系起来，我们沿每个主轴使用爱因斯坦关系。对于一个在长时间范围内进行具有不相关增量的平稳、遍历的随机行走的示踪粒子，沿轴 $i \\in \\{x,y\\}$ 的均方位移 (MSD) 与时间成线性关系：\n$$\n\\left\\langle \\Delta r_i(t)^2 \\right\\rangle = 2 D_i t \\quad \\text{as } t \\to \\infty,\n$$\n其中 $D_i$ 是扩散张量的相应分量。对于一个包含 $N_\\text{p}$ 个独立示踪剂的系综，在离散时间 $t_k = k\\,\\Delta t$ 的经验 MSD 是通过对粒子的位移平方进行平均计算的，即 $\\left\\langle \\Delta r_i(t_k)^2 \\right\\rangle = \\frac{1}{N_\\text{p}}\\sum_{n=1}^{N_\\text{p}} \\left(r_{i,n}(t_k) - r_{i,n}(0)\\right)^2$。对 $\\left\\langle \\Delta r_i(t)^2 \\right\\rangle$ 与 $t$ 在晚期时间窗口内进行线性最小二乘回归，可以估计斜率 $a_i$，从而得到 $D_i \\approx a_i/2$。\n\n一旦估算出 $D_\\parallel$ 和 $D_\\perp$，就可以通过求解坐标轴上浓度等于预设阈值 $c_\\text{th}$ 的位置，来找到在时间 $t_\\text{eval}$ 的轴向扩散前沿。沿 $x$ 轴 ($y=0$)，解简化为\n$$\nc(x,0,t_\\text{eval}) = \\frac{M}{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}} \\exp\\!\\left(-\\frac{x^2}{4 D_\\parallel t_\\text{eval}}\\right),\n$$\n且前沿 $x_\\text{front}$ 满足\n$$\n\\exp\\!\\left(-\\frac{x_\\text{front}^2}{4 D_\\parallel t_\\text{eval}}\\right) = c_\\text{th}\\,\\frac{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}}{M}.\n$$\n假设 $0  c_\\text{th}  \\frac{M}{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}}$，使得右侧在 $(0,1)$ 区间内，解为\n$$\nx_\\text{front} = \\sqrt{ -4 D_\\parallel t_\\text{eval} \\,\\ln\\!\\left( c_\\text{th}\\,\\frac{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}}{M} \\right) }.\n$$\n同样，沿 $y$ 轴 ($x=0$)，\n$$\ny_\\text{front} = \\sqrt{ -4 D_\\perp t_\\text{eval} \\,\\ln\\!\\left( c_\\text{th}\\,\\frac{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}}{M} \\right) }.\n$$\n\n算法实现细节：\n- 合成 MD 生成：对于每个案例，在每个持续时间为 $\\Delta t$ 的时间步中，为 $N_\\text{p}$ 个粒子中的每一个抽取独立的、服从 $\\mathcal{N}\\!\\left(0,\\,2 D_\\parallel \\Delta t\\right)$ 的高斯增量 $\\Delta x$ 和服从 $\\mathcal{N}\\!\\left(0,\\,2 D_\\perp \\Delta t\\right)$ 的高斯增量 $\\Delta y$。通过累加这些增量来构建位置 $x_n(t_k)$ 和 $y_n(t_k)$，并在 $t_0=0$ 时从零开始初始化。为确保可复现性，每个案例固定伪随机种子 $s$。\n- MSD 估算：在每个 $t_k$，通过对所有粒子进行平均来计算 $\\langle \\Delta x(t_k)^2 \\rangle$ 和 $\\langle \\Delta y(t_k)^2 \\rangle$。使用最后 $70\\%$ 的 $\\{t_k\\}$ 来拟合 $\\langle \\Delta x(t)^2 \\rangle \\approx a_x t + b_x$ 和 $\\langle \\Delta y(t)^2 \\rangle \\approx a_y t + b_y$。报告 $D_\\parallel = a_x/2$ 和 $D_\\perp = a_y/2$。\n- 前沿计算：计算对数参数 $A = c_\\text{th}\\,\\frac{4\\pi t_\\text{eval} \\sqrt{D_\\parallel D_\\perp}}{M}$。如果 $A \\le 0$ 或 $A \\ge 1$，则在该阈值和时间下，所请求的前沿在无界高斯模型中没有定义；在这种情况下，为 $x_\\text{front}$ 和 $y_\\text{front}$ 返回非数值 (Not-a-Number)。否则，使用上述公式计算 $x_\\text{front}$ 和 $y_\\text{front}$。\n\n将此方法应用于指定的测试套件：\n- 案例 A 的参数为 $D_\\parallel = 2\\times 10^{-17}\\ \\mathrm{m^2/s}$，$D_\\perp = 2\\times 10^{-17}\\ \\mathrm{m^2/s}$，$N_\\text{p}=500$，$N_\\text{steps}=400$，$\\Delta t=100\\ \\mathrm{s}$，$t_\\text{eval}=40000\\ \\mathrm{s}$，$M=1.0$，$c_\\text{th}=10^{10}$，$s=42$。算法将估算出接近其真实值的 $D_\\parallel$ 和 $D_\\perp$，且沿 $x$ 和 $y$ 轴的前沿将相等。\n- 案例 B 的参数为 $D_\\parallel = 1\\times 10^{-16}\\ \\mathrm{m^2/s}$，$D_\\perp = 1\\times 10^{-18}\\ \\mathrm{m^2/s}$，$N_\\text{p}=800$，$N_\\text{steps}=600$，$\\Delta t=100\\ \\mathrm{s}$，$t_\\text{eval}=60000\\ \\mathrm{s}$，$M=1.0$，$c_\\text{th}=2\\times 10^{10}$，$s=12345$。算法将捕捉到 $x$ 轴前沿远大于 $y$ 轴前沿，这与各向异性一致。\n- 案例 C 的参数为 $D_\\parallel = 5\\times 10^{-17}\\ \\mathrm{m^2/s}$，$D_\\perp = 1\\times 10^{-21}\\ \\mathrm{m^2/s}$，$N_\\text{p}=400$，$N_\\text{steps}=500$，$\\Delta t=200\\ \\mathrm{s}$，$t_\\text{eval}=100000\\ \\mathrm{s}$，$M=1.0$，$c_\\text{th}=10^{11}$，$s=2023$。算法将预测沿 $x$ 轴的前沿比沿 $y$ 轴的大几个数量级，反映了近乎阻塞的垂直扩散。\n\n最终程序必须将三个案例的结果汇总到单行中，格式为 $[[D_{\\parallel,A},D_{\\perp,A},x_{\\text{front},A},y_{\\text{front},A}],[D_{\\parallel,B},D_{\\perp,B},x_{\\text{front},B},y_{\\text{front},B}],[D_{\\parallel,C},D_{\\perp,C},x_{\\text{front},C},y_{\\text{front},C}]]$，并精确打印该行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef estimate_diffusion_coefficients(msd_times, msd_values):\n    # Fit MSD(t) ~ a * t + b over times and return D = a/2\n    # Use numpy polyfit for linear regression\n    a, b = np.polyfit(msd_times, msd_values, 1)\n    return a / 2.0\n\ndef generate_md_trajectories(Dx, Dy, Np, Nsteps, dt, seed):\n    # Generate synthetic MD trajectories: positions over time for Np particles\n    rng = np.random.default_rng(seed)\n    # Increments: shape (Np, Nsteps) for each axis\n    std_x = np.sqrt(2.0 * Dx * dt)\n    std_y = np.sqrt(2.0 * Dy * dt)\n    inc_x = rng.normal(loc=0.0, scale=std_x, size=(Np, Nsteps))\n    inc_y = rng.normal(loc=0.0, scale=std_y, size=(Np, Nsteps))\n    # Positions by cumulative sum along time\n    pos_x = np.cumsum(inc_x, axis=1)\n    pos_y = np.cumsum(inc_y, axis=1)\n    return pos_x, pos_y\n\ndef compute_msd(pos, dt):\n    # pos: shape (Np, Nsteps), initial position at t=0 is zero implicitly\n    # Times: t_k = (k+1) * dt (since first column is after first increment)\n    Nsteps = pos.shape[1]\n    times = dt * np.arange(1, Nsteps + 1)\n    # MSD at each time step: average over particles of squared displacement\n    msd = np.mean(pos**2, axis=0)\n    return times, msd\n\ndef compute_fronts(Dx_est, Dy_est, M, c_th, t_eval):\n    # Compute front positions along axes using anisotropic Gaussian solution\n    # Argument for logarithm:\n    if Dx_est = 0 or Dy_est = 0:\n        return np.nan, np.nan\n    arg = c_th * (4.0 * np.pi * t_eval * np.sqrt(Dx_est * Dy_est)) / M\n    if not (arg > 0.0 and arg  1.0):\n        return np.nan, np.nan\n    ln_arg = np.log(arg)\n    x_front = np.sqrt(-4.0 * Dx_est * t_eval * ln_arg)\n    y_front = np.sqrt(-4.0 * Dy_est * t_eval * ln_arg)\n    return x_front, y_front\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (Dx_true, Dy_true, Np, Nsteps, dt, t_eval, M, c_th, seed)\n    test_cases = [\n        (2e-17, 2e-17, 500, 400, 100.0, 40000.0, 1.0, 1e10, 42),\n        (1e-16, 1e-18, 800, 600, 100.0, 60000.0, 1.0, 2e10, 12345),\n        (5e-17, 1e-21, 400, 500, 200.0, 100000.0, 1.0, 1e11, 2023),\n    ]\n\n    results = []\n    for Dx_true, Dy_true, Np, Nsteps, dt, t_eval, M, c_th, seed in test_cases:\n        # Generate synthetic MD trajectories\n        pos_x, pos_y = generate_md_trajectories(Dx_true, Dy_true, Np, Nsteps, dt, seed)\n        # Compute MSD vs time for each axis\n        times_x, msd_x = compute_msd(pos_x, dt)\n        times_y, msd_y = compute_msd(pos_y, dt)\n        # Use last 70% of times for regression\n        start_idx = int(0.3 * Nsteps)  # index where the last 70% begins\n        Dx_est = estimate_diffusion_coefficients(times_x[start_idx:], msd_x[start_idx:])\n        Dy_est = estimate_diffusion_coefficients(times_y[start_idx:], msd_y[start_idx:])\n        # Compute anisotropic diffusion fronts at t_eval using estimated D\n        x_front, y_front = compute_fronts(Dx_est, Dy_est, M, c_th, t_eval)\n        results.append([Dx_est, Dy_est, x_front, y_front])\n\n    # Final print statement in the exact required format.\n    # Ensure floats print in a compact representation.\n    print(f\"[{','.join('[' + ','.join(map(str, case)) + ']' for case in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实材料，如多晶体，其微观结构极不均匀，其中晶界通常是原子扩散的快速通道。本练习旨在解决如何为这种复杂的异质材料计算一个宏观的“有效”扩散系数。你将通过在一个代表多晶微观结构的二维网格上求解稳态扩散方程，来探索局部扩散率的差异如何决定材料的整体输运性质 ()。",
            "id": "3451830",
            "problem": "考虑一个二维多晶体，其表示在一个矩形域上，空间坐标为 $x \\in [0,L_x]$ 和 $y \\in [0,L_y]$，并在一个 $N_x \\times N_y$ 节点的均匀网格上进行离散化。局部浓度场为 $c(x,y)$，单位为 $\\mathrm{mol}/\\mathrm{m}^3$。在晶粒内部和沿晶界，扩散是菲克式且各向同性的，具有一个与位置相关的扩散系数 $D(x,y)$。在晶粒内部像素中，$D(x,y) = D_\\mathrm{bulk}$；在晶界像素中，$D(x,y) = D_\\mathrm{gb}$，且 $D_\\mathrm{gb} \\gg D_\\mathrm{bulk}$。浓度满足质量守恒和菲克第一定律。目标是从微观结构图中提取沿 $x$ 方向输运的有效扩散系数 $D_\\mathrm{eff}$。\n\n从控制固体中扩散的基本定律出发：\n- 菲克第一定律 $\\,\\mathbf{J}(x,y) = -D(x,y)\\,\\nabla c(x,y)$，\n- 质量守恒 $\\,\\partial_t c(x,y) + \\nabla \\cdot \\mathbf{J}(x,y) = 0$，\n\n您必须推导并实现一个计算程序，以在施加的宏观浓度差下求解稳态（不随时间变化）扩散问题。分别在左边界和右边界施加狄利克雷边界条件 $c(0,y) = c_\\mathrm{L}$ 和 $c(L_x,y) = c_\\mathrm{R}$，并在上边界和下边界施加齐次诺伊曼边界条件（法向通量为零），即在 $y=0$ 和 $y=L_y$ 处 $\\partial c/\\partial y = 0$。沿 $x$ 方向的宏观尺度浓度梯度为 $G = (c_\\mathrm{R} - c_\\mathrm{L})/L_x$，单位为 $\\mathrm{mol}/\\mathrm{m}^4$。\n\n将沿 $x$ 方向的有效扩散系数 $D_\\mathrm{eff}$ 定义为比例系数，该系数关联了稳态通量分量 $J_x$ 的横截面平均值与施加的宏观梯度 $G$，即满足 $\\langle J_x \\rangle_y = -D_\\mathrm{eff}\\,G$ 的唯一 $D_\\mathrm{eff}$，其中 $\\langle \\cdot \\rangle_y$ 表示沿 $y$ 方向在宽度 $L_y$ 上的平均。以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位表示 $D_\\mathrm{eff}$，并四舍五入至三位有效数字。\n\n您将获得作为网格上二元场的微观结构图，该图指示了晶界像素，您必须用它来分配 $D(x,y)$。晶界是如下文所述排列的一个像素厚的线。使用一个一致的有限差分或有限体积离散化方法，该方法能保证通量在具有不同 $D$ 的界面上连续，并通过对相邻像素间界面上的 $D$ 采用尊重串联电阻相加的适当平均方法来确保科学真实性。求解得到的稳态线性系统，然后计算 $\\langle J_x \\rangle_y$ 以获得 $D_\\mathrm{eff}$。\n\n整个过程中使用的数值单位和常数：\n- $L_x$ 和 $L_y$ 的单位为 $\\mathrm{m}$，\n- $D_\\mathrm{bulk}$ 和 $D_\\mathrm{gb}$ 的单位为 $\\mathrm{m}^2/\\mathrm{s}$，\n- $c_\\mathrm{L}$ 和 $c_\\mathrm{R}$ 的单位为 $\\mathrm{mol}/\\mathrm{m}^3$，\n- 本问题中所有角度均不相关，因此不需要角度单位。\n\n测试套件：\n为以下三个测试案例计算 $D_\\mathrm{eff}$。在所有案例中，设置 $c_\\mathrm{L} = 1.0$ 和 $c_\\mathrm{R} = 0.0$，单位为 $\\mathrm{mol}/\\mathrm{m}^3$。\n\n1. 理想情况（通道与输运方向对齐）：\n   - $N_x = 60$, $N_y = 60$,\n   - $L_x = 1 \\times 10^{-5}\\ \\mathrm{m}$, $L_y = 1 \\times 10^{-5}\\ \\mathrm{m}$,\n   - $D_\\mathrm{bulk} = 1 \\times 10^{-16}\\ \\mathrm{m}^2/\\mathrm{s}$, $D_\\mathrm{gb} = 1 \\times 10^{-12}\\ \\mathrm{m}^2/\\mathrm{s}$,\n   - 晶界：位于行 $y$ 索引 $N_y/4$、$N_y/2$ 和 $3N_y/4$（四舍五入到最近的整数）处的水平线，每条线一个像素厚，横跨整个 $x$ 范围。\n\n2. 均匀介质（边界条件与基准检查）：\n   - $N_x = 60$, $N_y = 60$,\n   - $L_x = 1 \\times 10^{-5}\\ \\mathrm{m}$, $L_y = 1 \\times 10^{-5}\\ \\mathrm{m}$,\n   - $D_\\mathrm{bulk} = 1 \\times 10^{-16}\\ \\mathrm{m}^2/\\mathrm{s}$, $D_\\mathrm{gb}$ 不相关，但设置为 $1 \\times 10^{-12}\\ \\mathrm{m}^2/\\mathrm{s}$,\n   - 晶界：无（所有像素均为晶粒内部）。结果应与均匀介质的预期相符。\n\n3. 方向边界情况（边界垂直于输运方向）：\n   - $N_x = 60$, $N_y = 60$,\n   - $L_x = 1 \\times 10^{-5}\\ \\mathrm{m}$, $L_y = 1 \\times 10^{-5}\\ \\mathrm{m}$,\n   - $D_\\mathrm{bulk} = 1 \\times 10^{-16}\\ \\mathrm{m}^2/\\mathrm{s}$, $D_\\mathrm{gb} = 1 \\times 10^{-12}\\ \\mathrm{m}^2/\\mathrm{s}$,\n   - 晶界：位于列 $x$ 索引 $N_x/3$ 和 $2N_x/3$（四舍五入到最近的整数）处的垂直线，每条线一个像素厚，横跨整个 $y$ 范围。\n\n算法要求：\n- 使用守恒格式在 $N_x \\times N_y$ 网格上对稳态扩散方程 $\\nabla \\cdot (D \\nabla c) = 0$ 进行离散化。\n- 在 $x=0$ 和 $x=L_x$ 处施加狄利克雷条件，在 $y=0$ 和 $y=L_y$ 处施加齐次诺伊曼条件。\n- 在具有不同扩散系数 $D_1$ 和 $D_2$ 的相邻像素之间的界面处，使用等于调和平均值 $D_\\mathrm{iface} = 2/(1/D_1 + 1/D_2)$ 的界面扩散系数，以正确捕捉通过不连续界面的串联输运。\n- 求解出 $c(x,y)$ 后，计算穿过每个左边界面的局部法向通量 $J_x$，对其进行 $y$ 方向的平均得到 $\\langle J_x \\rangle_y$，并通过与 $G = (c_\\mathrm{R} - c_\\mathrm{L})/L_x$ 的定义关系计算 $D_\\mathrm{eff}$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果，其中每个 $D_\\mathrm{eff}$ 采用三位有效数字的科学记数法格式，例如 $\\left[\\texttt{1.23e-16},\\texttt{9.87e-17},\\texttt{2.00e-15}\\right]$。每个条目的单位都是 $\\mathrm{m}^2/\\mathrm{s}$。",
            "solution": "用户提供的问题已经过分析，并被认为是**有效**的。该问题具有科学依据、提法恰当、客观，并包含一套完整且一致的求解参数和说明。该问题属于计算材料科学的既定领域，并涉及核心课题——菲克式输运。我们现在将进行完整且条理清晰的解答。\n\n### 1. 控制方程与离散化\n该物理过程由具有位置相关扩散系数 $D(x,y)$ 的稳态扩散方程控制。从质量守恒 $\\partial_t c + \\nabla \\cdot \\mathbf{J} = 0$ 和菲克第一定律 $\\mathbf{J} = -D \\nabla c$ 出发，我们得到浓度场 $c(x,y)$ 的不依赖于时间的控制偏微分方程（PDE）：\n$$ \\nabla \\cdot (D(x,y) \\nabla c(x,y)) = 0 $$\n展开此表达式得到：\n$$ \\frac{\\partial}{\\partial x} \\left( D(x,y) \\frac{\\partial c}{\\partial x} \\right) + \\frac{\\partial}{\\partial y} \\left( D(x,y) \\frac{\\partial c}{\\partial y} \\right) = 0 $$\n我们在一个 $N_x \\times N_y$ 节点的均匀网格上对此方程进行离散化。节点位于位置 $(x_i, y_j) = (i\\Delta x, j\\Delta y)$，其中 $i \\in \\{0, 1, \\dots, N_x-1\\}$ 且 $j \\in \\{0, 1, \\dots, N_y-1\\}$。网格间距为 $\\Delta x = L_x / (N_x - 1)$ 和 $\\Delta y = L_y / (N_y - 1)$。令 $c_{i,j}$ 表示浓度 $c(x_i, y_j)$。\n\n我们采用守恒的有限差分格式（等效于以顶点为中心的有限体积法）。该偏微分方程在以每个内部节点 $(i,j)$ 为中心的控制体积上进行积分。应用散度定理可得到通过控制体表面的通量平衡。穿过节点 $(i,j)$ 和 $(i+1,j)$ 之间界面的通量 $J_{x, i+1/2, j}$ 近似为：\n$$ J_{x, i+1/2, j} \\approx -D_{i+1/2, j} \\frac{c_{i+1, j} - c_{i, j}}{\\Delta x} $$\n$y$ 方向的通量 $J_{y, i, j+1/2}$ 也有类似的表达式。在内部节点 $(i,j)$ 处的离散化守恒定律为：\n$$ \\frac{J_{x, i+1/2, j} - J_{x, i-1/2, j}}{\\Delta x} + \\frac{J_{y, i, j+1/2} - J_{y, i, j-1/2}}{\\Delta y} = 0 $$\n根据规定，在两个具有扩散系数 $D_1$ 和 $D_2$ 的区域之间的界面 $k$ 处的扩散系数是调和平均值 $D_\\mathrm{iface} = 2/(1/D_1 + 1/D_2)$，这正确地模拟了串联电阻。因此，对于节点 $(i,j)$ 和 $(i+1,j)$ 之间的界面，其节点扩散系数分别为 $D_{i,j}$ 和 $D_{i+1,j}$，我们定义：\n$$ D_{i+1/2, j} = \\frac{2 D_{i,j} D_{i+1,j}}{D_{i,j} + D_{i+1,j}} $$\n将通量表达式代入守恒定律，得到一个关于 $c_{i,j}$ 及其邻居的线性方程。我们定义节点之间的传导系数：\n$$ T_{E} = \\frac{D_{i+1/2, j}}{\\Delta x^2}, \\quad T_{W} = \\frac{D_{i-1/2, j}}{\\Delta x^2}, \\quad T_{N} = \\frac{D_{i, j+1/2}}{\\Delta y^2}, \\quad T_{S} = \\frac{D_{i, j-1/2}}{\\Delta y^2} $$\n内部节点 $(i,j)$ 的离散方程为：\n$$ (T_E + T_W + T_N + T_S) c_{i,j} - T_E c_{i+1,j} - T_W c_{i-1,j} - T_N c_{i,j+1} - T_S c_{i,j-1} = 0 $$\n\n### 2. 线性系统的组装与边界条件\n为每个浓度未知的节点生成一个线性方程。未知浓度为 $c_{i,j}$，其中 $i \\in \\{1, \\dots, N_x-2\\}$ 且 $j \\in \\{0, \\dots, N_y-1\\}$。这构成了一个包含 $M = (N_x-2) \\times N_y$ 个线性方程的系统，形式为 $A\\mathbf{c} = \\mathbf{b}$，其中 $\\mathbf{c}$ 是未知浓度的向量。\n\n边界条件按如下方式并入：\n- **狄利克雷边界 ($x=0, x=L_x$)**：浓度 $c_{0,j} = c_\\mathrm{L}$ 和 $c_{N_x-1,j} = c_\\mathrm{R}$ 是已知的。当一个未知节点与这些边界相邻时，已知的浓度值被移到右侧向量 $\\mathbf{b}$ 中。对于对应于节点 $(1,j)$ 的方程，项 $-T_W c_{0,j}$ 变成一个源项 $T_W c_\\mathrm{L}$，加到 $\\mathbf{b}$ 的相应元素上。类似地，对于节点 $(N_x-2, j)$，项 $-T_E c_{N_x-1,j}$ 对 $\\mathbf{b}$ 贡献 $T_E c_\\mathrm{R}$。\n\n- **诺伊曼边界 ($y=0, y=L_y$)**：齐次诺伊曼条件 $\\partial c / \\partial y = 0$ 意味着穿过这些边界的通量为零。对于底部边界上的节点 ($j=0$)，通量项 $J_{y,i,j-1/2}$ 为零，这意味着 $T_S = 0$。对于顶部边界上的节点 ($j=N_y-1$)，通量项 $J_{y,i,j+1/2}$ 为零，这意味着 $T_N = 0$。这修改了边界节点的模板。对于节点 $(i,0)$，方程变为：\n$$ (T_E + T_W + T_N) c_{i,0} - T_E c_{i+1,0} - T_W c_{i-1,0} - T_N c_{i,1} = 0 $$\n类似的修改适用于 $j=N_y-1$ 处的节点。\n\n得到的矩阵 $A$ 是稀疏、带状且对角占优的，这确保了该系统是良态的，并且可以使用稀疏线性系统的数值方法高效求解。\n\n### 3. 有效扩散系数的计算\n求解线性系统得到未知浓度后，完整的场 $c_{i,j}$ 就已知了。有效扩散系数 $D_\\mathrm{eff}$ 由宏观关系式 $\\langle J_x \\rangle_y = -D_\\mathrm{eff} G$ 定义，其中 $G = (c_\\mathrm{R} - c_\\mathrm{L}) / L_x$ 是施加的宏观梯度。\n平均通量 $\\langle J_x \\rangle_y$ 是通过在横截面上对局部微观通量进行平均来计算的。由于质量守恒，这个平均值与 $x$ 的位置无关。我们可以方便地在 $i=0$ 和 $i=1$ 列之间的界面上计算它：\n$$ \\langle J_x \\rangle_y = \\frac{1}{N_y} \\sum_{j=0}^{N_y-1} J_{x, 1/2, j} = \\frac{1}{N_y} \\sum_{j=0}^{N_y-1} \\left( -D_{1/2, j} \\frac{c_{1, j} - c_{0,j}}{\\Delta x} \\right) $$\n其中求和表示在横截面上的 $N_y$ 个节点上的离散平均。\n将此代入 $D_\\mathrm{eff}$ 的定义中：\n$$ D_\\mathrm{eff} = - \\frac{\\langle J_x \\rangle_y}{G} = - \\frac{\\frac{1}{N_y} \\sum_{j=0}^{N_y-1} \\left(-D_{1/2,j} \\frac{c_{1,j} - c_\\mathrm{L}}{\\Delta x}\\right)}{(c_\\mathrm{R} - c_\\mathrm{L})/L_x} $$\n使用 $L_x = (N_x-1)\\Delta x$ 并化简，我们得到 $D_\\mathrm{eff}$ 的最终表达式：\n$$ D_\\mathrm{eff} = \\frac{N_x-1}{N_y (c_\\mathrm{R} - c_\\mathrm{L})} \\sum_{j=0}^{N_y-1} D_{1/2, j} (c_{1,j} - c_\\mathrm{L}) $$\n对于给定的问题参数 $c_\\mathrm{L}=1.0$ 和 $c_\\mathrm{R}=0.0$，这变为：\n$$ D_\\mathrm{eff} = -\\frac{N_x-1}{N_y} \\sum_{j=0}^{N_y-1} D_{1/2, j} (c_{1,j} - 1.0) $$\n此过程将应用于三个测试案例中的每一个，以确定它们各自的有效扩散系数。所提供的 Python 代码实现了这一完整的数值计算过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Computes the effective diffusivity for three different microstructures\n    by solving the steady-state diffusion equation.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"name\": \"Horizontal GBs\",\n            \"Nx\": 60, \"Ny\": 60,\n            \"Lx\": 1e-5, \"Ly\": 1e-5,\n            \"D_bulk\": 1e-16, \"D_gb\": 1e-12,\n            \"gb_type\": \"horizontal\",\n            \"gb_locs\": [15, 30, 45] # Using provided indices directly\n        },\n        {\n            \"name\": \"Uniform medium\",\n            \"Nx\": 60, \"Ny\": 60,\n            \"Lx\": 1e-5, \"Ly\": 1e-5,\n            \"D_bulk\": 1e-16, \"D_gb\": 1e-12,\n            \"gb_type\": \"none\",\n            \"gb_locs\": []\n        },\n        {\n            \"name\": \"Vertical GBs\",\n            \"Nx\": 60, \"Ny\": 60,\n            \"Lx\": 1e-5, \"Ly\": 1e-5,\n            \"D_bulk\": 1e-16, \"D_gb\": 1e-12,\n            \"gb_type\": \"vertical\",\n            \"gb_locs\": [20, 40] # Using provided indices directly\n        }\n    ]\n\n    c_L = 1.0\n    c_R = 0.0\n    results = []\n\n    for case in test_cases:\n        Nx, Ny = case[\"Nx\"], case[\"Ny\"]\n        Lx, Ly = case[\"Lx\"], case[\"Ly\"]\n        D_bulk, D_gb = case[\"D_bulk\"], case[\"D_gb\"]\n\n        dx = Lx / (Nx - 1)\n        dy = Ly / (Ny - 1)\n        dx2, dy2 = dx**2, dy**2\n\n        D_map = np.full((Ny, Nx), D_bulk)\n        if case[\"gb_type\"] == \"horizontal\":\n            for j in case[\"gb_locs\"]:\n                D_map[j, :] = D_gb\n        elif case[\"gb_type\"] == \"vertical\":\n            for i in case[\"gb_locs\"]:\n                D_map[:, i] = D_gb\n\n        num_unknowns = (Nx - 2) * Ny\n        A = lil_matrix((num_unknowns, num_unknowns))\n        b = np.zeros(num_unknowns)\n\n        # Mapping: (i, j) -> k = (i - 1) * Ny + j\n        # Where i in [1, Nx-2], j in [0, Ny-1]\n        for i in range(1, Nx - 1):\n            for j in range(Ny):\n                k = (i - 1) * Ny + j\n                \n                # West Neighbor\n                D_W_iface = 2 * D_map[j, i-1] * D_map[j, i] / (D_map[j, i-1] + D_map[j, i]) if (D_map[j, i-1] + D_map[j, i]) != 0 else 0\n                T_W = D_W_iface / dx2\n                if i == 1: # Left Dirichlet BC\n                    b[k] += T_W * c_L\n                else:\n                    k_W = (i - 2) * Ny + j\n                    A[k, k_W] = -T_W\n\n                # East Neighbor\n                D_E_iface = 2 * D_map[j, i] * D_map[j, i+1] / (D_map[j, i] + D_map[j, i+1]) if (D_map[j, i] + D_map[j, i+1]) != 0 else 0\n                T_E = D_E_iface / dx2\n                if i == Nx - 2: # Right Dirichlet BC\n                    b[k] += T_E * c_R\n                else:\n                    k_E = i * Ny + j\n                    A[k, k_E] = -T_E\n                \n                # South Neighbor\n                T_S = 0.0\n                if j > 0: # Not on bottom Neumann BC\n                    D_S_iface = 2 * D_map[j-1, i] * D_map[j, i] / (D_map[j-1, i] + D_map[j, i]) if (D_map[j-1, i] + D_map[j, i]) != 0 else 0\n                    T_S = D_S_iface / dy2\n                    k_S = (i - 1) * Ny + (j - 1)\n                    A[k, k_S] = -T_S\n                \n                # North Neighbor\n                T_N = 0.0\n                if j  Ny - 1: # Not on top Neumann BC\n                    D_N_iface = 2 * D_map[j, i] * D_map[j+1, i] / (D_map[j, i] + D_map[j+1, i]) if (D_map[j, i] + D_map[j+1, i]) != 0 else 0\n                    T_N = D_N_iface / dy2\n                    k_N = (i - 1) * Ny + (j + 1)\n                    A[k, k_N] = -T_N\n\n                A[k, k] = T_W + T_E + T_S + T_N\n\n        # Solve the linear system\n        A_csr = A.tocsr()\n        c_vec = spsolve(A_csr, b)\n\n        # Reconstruct full concentration field to calculate flux\n        C = np.zeros((Ny, Nx))\n        C[:, 0] = c_L\n        C[:, -1] = c_R\n        C[:, 1:-1] = c_vec.reshape((Nx - 2, Ny)).T\n\n        # Calculate effective diffusivity\n        sum_J_x_dx = 0.0\n        for j in range(Ny):\n            D_half_j = 2 * D_map[j, 0] * D_map[j, 1] / (D_map[j, 0] + D_map[j, 1]) if (D_map[j, 0] + D_map[j, 1]) != 0 else 0\n            J_x_j = -D_half_j * (C[j, 1] - C[j, 0]) / dx\n            sum_J_x_dx += J_x_j\n        \n        avg_J_x = sum_J_x_dx / Ny\n        macro_G = (c_R - c_L) / Lx\n        D_eff = -avg_J_x / macro_G if macro_G != 0 else 0\n        \n        results.append(\"{:.2e}\".format(D_eff))\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}