{
    "hands_on_practices": [
        {
            "introduction": "在通过有限位移法计算晶格动力学时，首要步骤是构建一个合适的超胞。由于周期性边界条件的存在，我们必须确保计算中的原子不会与其自身的周期性映像发生不真实的人为相互作用。本练习将引导您推导并应用一个关键准则 ()，以确定足以在给定实空间截断半径下避免这种相互作用混淆的最小超胞尺寸，这是任何可靠的声子计算的必要前提。",
            "id": "3460966",
            "problem": "您正在为晶格动力学实现有限位移法，以计算在径向截断半径处截断的实空间原子间力常数 (IFC)。模型晶体是一个简单六方Bravais晶格，其原胞基矢由下式给出\n$$\n\\mathbf{a}_{1} = a \\,(1,\\,0,\\,0),\\quad \\mathbf{a}_{2} = a \\left(\\tfrac{1}{2},\\,\\tfrac{\\sqrt{3}}{2},\\,0\\right),\\quad \\mathbf{a}_{3} = c \\,(0,\\,0,\\,1),\n$$\n晶格常数 $a = 2.75\\,\\text{\\AA}$ 和 $c = 4.45\\,\\text{\\AA}$。您将在径向截断半径 $R_{c} = 4.6\\,\\text{\\AA}$ 处截断实空间 IFC。您将使原点处的一个原子发生位移，并在周期性边界条件下计算其诱导的力。\n\n从Bravais晶格的定义、近邻壳层的几何形状以及周期性边界条件下的周期性镜像概念出发，推导一个关于超胞平移的判据，以保证在截断半径内的相互作用不发生混叠（即，在位移原子周围的截断球内的任何原子，其截断范围内不能有超过一个位移原子的镜像）。然后，将此判据特化用于通过沿原胞基矢进行整数倍复制而构建的超胞，其超胞基矢为 $\\mathbf{A}_{1} = N_{1}\\mathbf{a}_{1}$、$\\mathbf{A}_{2} = N_{2}\\mathbf{a}_{2}$ 和 $\\mathbf{A}_{3} = N_{3}\\mathbf{a}_{3}$，其中 $N_{1}$、$N_{2}$ 和 $N_{3}$ 是正整数。\n\n接下来，通过分析简单六方Bravais晶格的近邻壳层，确定哪些壳层落在 $R_{c}$ 范围内，然后确定最小整数 $N_{1}$、$N_{2}$ 和 $N_{3}$，使得上述无混叠判据得以满足，并且超胞的形状保持了面内六方对称性。将您的最终结果以行矩阵 $\\left(N_{1}\\ N_{2}\\ N_{3}\\right)$ 的形式报告，不带单位。最终答案必须是定义的单个行矩阵，包含精确整数（无需舍入说明）。",
            "solution": "要确定在简单六方Bravais晶格上进行有限位移计算所需的最小超胞尺寸，我们需遵循以下步骤。\n\n### 步骤 1：“无混叠”判据的推导\n\n在采用周期性边界条件（PBC）的超胞计算中，位于原点的位移原子在所有超胞晶格矢量 $\\mathbf{T}_{\\text{super}}$ 处都存在周期性镜像。为了确保在截断半径 $R_c$ 内的任何原子所受的力仅来自原点的“真实”位移原子，而不受其周期性镜像的污染，我们必须保证该原子到任何非零周期性镜像的距离都大于 $R_c$。\n\n考虑一个位于 $\\mathbf{r}$ 的原子，其中 $|\\mathbf{r}| \\le R_c$。它到任意一个非零超胞晶格矢量 $\\mathbf{T}_{\\text{super}} \\ne \\mathbf{0}$ 处镜像的距离为 $|\\mathbf{r} - \\mathbf{T}_{\\text{super}}|$。为避免相互作用混叠，必须满足：\n$$|\\mathbf{r} - \\mathbf{T}_{\\text{super}}| > R_c \\quad \\forall \\mathbf{r} \\text{ with } |\\mathbf{r}| \\le R_c \\text{ and } \\forall \\mathbf{T}_{\\text{super}} \\ne \\mathbf{0}$$\n此条件最严格的情况发生在 $\\mathbf{r}$ 与 $\\mathbf{T}_{\\text{super}}$ 方向相反时。考虑最短的非零超胞晶格矢量 $\\mathbf{T}_{\\text{super,min}}$，最坏的情况是原子位于 $\\mathbf{r} = -R_c \\frac{\\mathbf{T}_{\\text{super,min}}}{|\\mathbf{T}_{\\text{super,min}}|}$。此时，到镜像的距离为：\n$$|\\mathbf{r} - \\mathbf{T}_{\\text{super,min}}| = | -R_c \\frac{\\mathbf{T}_{\\text{super,min}}}{|\\mathbf{T}_{\\text{super,min}}|} - \\mathbf{T}_{\\text{super,min}} | = R_c + |\\mathbf{T}_{\\text{super,min}}|$$\n这个距离总是大于 $R_c$。然而，我们必须考虑位于 $\\mathbf{r}'$ 的原子与位于原点的原子及其镜像的相互作用。位于 $\\mathbf{r}'$ 的原子与位于 $\\mathbf{T}_{\\text{super}}$ 的镜像原子之间的距离是 $|\\mathbf{r}' - \\mathbf{T}_{\\text{super}}|$。为了避免混淆，我们需要确保对于任何超胞内的原子 $\\mathbf{r}'$ 和任何非零的 $\\mathbf{T}_{\\text{super}}$，如果 $|\\mathbf{r}'| \\le R_c$，那么 $|\\mathbf{r}' - \\mathbf{T}_{\\text{super}}| > R_c$。考虑最坏情况，即 $\\mathbf{r}'$ 指向 $\\mathbf{T}_{\\text{super,min}}$，且 $|\\mathbf{r}'|=R_c$。此时，$|\\mathbf{r}' - \\mathbf{T}_{\\text{super,min}}| = |\\mathbf{T}_{\\text{super,min}}| - R_c$。为确保此距离大于 $R_c$，我们需要 $|\\mathbf{T}_{\\text{super,min}}| - R_c > R_c$，这导出了最终的判据：\n$$|\\mathbf{T}_{\\text{super,min}}| > 2 R_c$$\n这就是避免相互作用混叠的通用判据：最短的非零超胞晶格矢量的长度必须大于截断半径的两倍。\n\n### 步骤 2：近邻壳层分析\n简单六方晶格中的一般晶格矢量为 $\\mathbf{R}_{lmn} = l\\mathbf{a}_1 + m\\mathbf{a}_2 + n\\mathbf{a}_3$。其模长的平方是：\n$$|\\mathbf{R}_{lmn}|^2 = a^2(l^2 + m^2 + lm) + c^2n^2$$\n使用 $a = 2.75\\,\\text{\\AA}$ 和 $c = 4.45\\,\\text{\\AA}$，我们得到 $a^2 = 7.5625\\,\\text{\\AA}^2$ 和 $c^2 = 19.8025\\,\\text{\\AA}^2$。截断半径的平方为 $R_c^2 = (4.6)^2 = 21.16\\,\\text{\\AA}^2$。\n\n我们寻找不全为零的整数三元组 $(l,m,n)$，使得 $|\\mathbf{R}_{lmn}|^2 \\le 21.16\\,\\text{\\AA}^2$：\n- 对于 $n=0$：$7.5625(l^2+m^2+lm) \\le 21.16 \\implies l^2+m^2+lm \\le 2.8$。\n  - $(l,m) \\in \\{(\\pm1,0), (0,\\pm1), (\\pm1, \\mp1)\\}$。对于这些情况，$l^2+m^2+lm=1$。\n  $d^2 = 7.5625 \\implies d=a=2.75\\,\\text{\\AA}$。这是第一近邻壳层。\n- 对于 $n=\\pm1$：$7.5625(l^2+m^2+lm) + 19.8025 \\le 21.16 \\implies 7.5625(l^2+m^2+lm) \\le 1.3575 \\implies l^2+m^2+lm \\le 0.18$。\n  - 只有 $(l,m)=(0,0)$ 满足此条件。\n  $d^2 = c^2 = 19.8025 \\implies d=c=4.45\\,\\text{\\AA}$。这是第二近邻壳层。\n- 对于 $n=\\pm2$ 或更高，或面内更大的 $(l,m)$ 组合，距离的平方都会超过 $R_c^2$。\n\n因此，截断半径内的原子都位于 $a=2.75\\,\\text{\\AA}$ 和 $c=4.45\\,\\text{\\AA}$ 的壳层上。\n\n### 步骤 3：将判据应用于超胞并计算最小尺寸\n超胞基矢是 $\\mathbf{A}_1 = N_1 \\mathbf{a}_1$、$\\mathbf{A}_2 = N_2 \\mathbf{a}_2$、$\\mathbf{A}_3 = N_3 \\mathbf{a}_3$。为了保持面内六方对称性，必须有 $|\\mathbf{A}_1| = |\\mathbf{A}_2|$，这意味着 $N_1 = N_2$。我们设 $N_1=N_2=N$。\n\n无混叠判据要求最短的超胞晶格矢量长度大于 $2R_c = 2 \\times 4.6 = 9.2\\,\\text{\\AA}$。我们至少需要检查超胞的三个轴向矢量：\n1. $|\\mathbf{A}_1| = N a > 2R_c \\implies N \\times 2.75 > 9.2 \\implies N > \\frac{9.2}{2.75} \\approx 3.345$\n2. $|\\mathbf{A}_2| = N a > 2R_c \\implies N > 3.345$\n3. $|\\mathbf{A}_3| = N_3 c > 2R_c \\implies N_3 \\times 4.45 > 9.2 \\implies N_3 > \\frac{9.2}{4.45} \\approx 2.067$\n\n由于 $N$ 和 $N_3$ 必须是正整数，它们的最小值为 $N=4$ 和 $N_3=3$。\n因此，满足对称性要求的最小整数为 $N_1 = 4$，$N_2 = 4$ 和 $N_3 = 3$。\n\n我们还需验证，对于这个超胞，没有其他矢量（如对角线矢量）比 $2R_c$ 更短。\n- $|\\mathbf{A}_1| = |\\mathbf{A}_2| = 4a = 4 \\times 2.75 = 11.0\\,\\text{\\AA}$。\n- $|\\mathbf{A}_3| = 3c = 3 \\times 4.45 = 13.35\\,\\text{\\AA}$。\n- 面内对角矢量 $|\\mathbf{A}_1 - \\mathbf{A}_2| = |4(\\mathbf{a}_1-\\mathbf{a}_2)| = 4|\\mathbf{a}_1-\\mathbf{a}_2| = 4a = 11.0\\,\\text{\\AA}$。\n所有这些长度都大于 $9.2\\,\\text{\\AA}$。任何其他组合，如 $\\mathbf{A}_1 + \\mathbf{A}_3$，都会更长。\n因此，最短的超胞矢量长度为 $11.0\\,\\text{\\AA}$，满足 $11.0\\,\\text{\\AA} > 9.2\\,\\text{\\AA}$ 的条件。\n\n最小整数复制因子为 $N_1=4$、$N_2=4$ 和 $N_3=3$。最终结果是行矩阵 $(N_1\\ N_2\\ N_3)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4  4  3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "有限位移法的核心在于使用一个微小但有限的位移 $\\delta$ 来近似计算力的导数，即原子间力常数。然而，位移 $\\delta$ 的选择是一个微妙的权衡：过大的 $\\delta$ 会引入不可忽略的截断误差，而过小的 $\\delta$ 则会放大来自第一性原理计算的数值噪声。通过本练习 ()，您将分析这两种误差来源，并推导出最小化总误差的最优位移幅值，从而掌握提高力常数计算精度的关键。",
            "id": "3461008",
            "problem": "考虑一个晶格常数为 $a$ 的一维单原子链，其中只存在最近邻相互作用。设 $u_j$ 表示原子 $j$ 偏离其平衡位置的标量位移，设 $F_i(u_j)$ 表示当原子 $j$ 发生位移 $u_j$ 而所有其他原子保持在平衡位置时，作用在原子 $i$ 上的标量力。原子 $i$ 和 $j$ 之间的原子间力常数 $K_{ij}$ 定义为 $K_{ij} = -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{u_j=0}$，这与力是能量的负梯度以及牛顿运动定律的定义一致。\n\n在有限位移法（FDM）中，通过计算原子 $j$ 在两个相反位移 $+\\delta$ 和 $-\\delta$ 处的力来估计 $K_{ij}$。假设由于电子结构求解器（例如，密度泛函理论（DFT））的原因，每个计算出的力都受到独立的、加性的、零均值噪声的污染，因此观测到的力为 $\\tilde{F}_i(+\\delta) = F_i(+\\delta) + \\eta_{+}$ 和 $\\tilde{F}_i(-\\delta) = F_i(-\\delta) + \\eta_{-}$，其中 $\\eta_{+}$ 和 $\\eta_{-}$ 是独立的随机变量，满足 $\\mathbb{E}[\\eta_{\\pm}] = 0$ 和 $\\mathrm{Var}(\\eta_{\\pm}) = \\sigma_F^2$。假设 $F_i(u_j)$ 足够光滑，可以在 $u_j=0$ 处进行泰勒级数展开，并定义 $c = \\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{u_j=0}$；为了进行主阶截断分析，忽略三阶以上的项。\n\n从这些定义和假设出发，完成以下任务：\n1. 使用 $\\tilde{F}_i(+\\delta)$ 和 $\\tilde{F}_i(-\\delta)$ 构建 $K_{ij}$ 的中心差分估计量，并导出以 $\\delta$ 和 $c$ 表示的主阶截断偏差。\n2. 在所述噪声模型下，推导估计量的方差以及作为 $\\delta$、$\\sigma_F$ 和 $c$ 函数的主阶均方误差（MSE）。\n3. 确定使主阶 MSE 最小的位移大小 $\\delta$。\n\n以力噪声标准差 $\\sigma_F$ 和三阶导数 $c$ 表示的最优位移大小 $\\delta$ 的单个闭式解析表达式作为你的最终答案。以米为单位表示 $\\delta$。不要近似或取整。",
            "solution": "我们从原子间力常数 $K_{ij}$ 的定义开始：\n$$\nK_{ij} \\equiv -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{u_j=0}.\n$$\n在有限位移法（FDM）中，我们使用位移大小为 $\\delta$ 的关于 $u_j$ 的中心差分来估计该导数。当力存在噪声时，我们观测到的力为 $\\tilde{F}_i(\\pm \\delta) = F_i(\\pm \\delta) + \\eta_{\\pm}$，其中 $\\eta_{+}$ 和 $\\eta_{-}$ 是方差为 $\\sigma_F^2$ 的独立零均值随机变量。此时带噪声的估计量为\n$$\n\\hat{K}_{ij}(\\delta) = -\\frac{\\tilde{F}_i(+\\delta) - \\tilde{F}_i(-\\delta)}{2\\delta} = -\\frac{F_i(+\\delta) - F_i(-\\delta)}{2\\delta} - \\frac{\\eta_{+} - \\eta_{-}}{2\\delta}.\n$$\n\n为了量化截断误差，我们将 $F_i(u_j)$ 在 $u_j=0$ 处进行泰勒级数展开，假设其足够光滑：\n$$\nF_i(u_j) = F_i(0) + \\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{0} u_j + \\frac{1}{2}\\left.\\frac{\\partial^2 F_i}{\\partial u_j^2}\\right|_{0} u_j^2 + \\frac{1}{6}\\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{0} u_j^3 + \\mathcal{O}(u_j^4).\n$$\n根据平衡条件，$F_i(0) = 0$。此外，由于中心反演对称性，对于单原子链，$F_i(u_j)$ 是 $u_j$ 的奇函数，因此所有偶数阶导数（如二阶导数）都为零。引入简写\n$$\nK_{ij} = -\\left.\\frac{\\partial F_i}{\\partial u_j}\\right|_{0}, \\quad c = \\left.\\frac{\\partial^3 F_i}{\\partial u_j^3}\\right|_{0},\n$$\n在 $\\pm \\delta$ 处的展开式为\n$$\nF_i(+\\delta) = -K_{ij}\\delta + \\frac{1}{6} c \\delta^3 + \\mathcal{O}(\\delta^5),\n$$\n$$\nF_i(-\\delta) = +K_{ij}\\delta - \\frac{1}{6} c \\delta^3 + \\mathcal{O}(\\delta^5).\n$$\n将两者相减：\n$$ F_i(+\\delta) - F_i(-\\delta) = -2K_{ij}\\delta + \\frac{1}{3} c \\delta^3 + \\mathcal{O}(\\delta^5). $$\n因此，无噪声的中心差分估计量为：\n$$\n-\\frac{F_i(+\\delta) - F_i(-\\delta)}{2\\delta} = K_{ij} - \\frac{1}{6} c \\delta^2 + \\mathcal{O}(\\delta^4).\n$$\n估计量的期望值 $\\mathbb{E}[\\hat{K}_{ij}(\\delta)]$ 与此相同，因为噪声的期望为零。因此，主阶截断偏差为\n$$\nb(\\delta) \\equiv \\mathbb{E}[\\hat{K}_{ij}(\\delta)] - K_{ij} = - \\frac{1}{6} c \\delta^2.\n$$\n\n接下来，我们分析噪声的贡献。估计量中的噪声项为\n$$\n\\varepsilon(\\delta) \\equiv -\\frac{\\eta_{+} - \\eta_{-}}{2\\delta}.\n$$\n由于 $\\eta_{+}$ 和 $\\eta_{-}$ 是独立的且方差均为 $\\sigma_F^2$，$\\varepsilon(\\delta)$ 的方差为\n$$\n\\mathrm{Var}\\left[\\varepsilon(\\delta)\\right] = \\frac{\\mathrm{Var}(\\eta_{+}) + \\mathrm{Var}(\\eta_{-})}{(2\\delta)^2} = \\frac{2\\sigma_F^2}{4\\delta^2} = \\frac{\\sigma_F^2}{2\\delta^2}.\n$$\n估计量的主阶均方误差（MSE）是偏差平方与方差之和：\n$$\n\\mathrm{MSE}(\\delta) = b(\\delta)^2 + \\mathrm{Var}\\left[\\varepsilon(\\delta)\\right] = \\left(-\\frac{c}{6}\\delta^2\\right)^2 + \\frac{\\sigma_F^2}{2\\delta^2} = \\frac{c^2}{36}\\delta^4 + \\frac{\\sigma_F^2}{2\\delta^2}.\n$$\n\n现在我们对 $\\delta > 0$ 最小化 $\\mathrm{MSE}(\\delta)$。对 $\\delta$ 求导并令其为零，\n$$\n\\frac{d}{d\\delta}\\mathrm{MSE}(\\delta) = \\frac{c^2}{9}\\delta^3 - \\frac{\\sigma_F^2}{\\delta^3} = 0 \\quad \\Rightarrow \\quad \\frac{c^2}{9}\\delta^3 = \\frac{\\sigma_F^2}{\\delta^3} \\quad \\Rightarrow \\quad \\delta^6 = \\frac{9\\sigma_F^2}{c^2}.\n$$\n取正实六次方根，得到最优位移大小\n$$\n\\delta_{\\mathrm{opt}} = \\left(\\frac{9\\sigma_F^2}{c^2}\\right)^{1/6} = 9^{1/6}\\left(\\frac{\\sigma_F^2}{c^2}\\right)^{1/6} = (3^2)^{1/6}\\left(\\frac{\\sigma_F}{|c|}\\right)^{2/6} = 3^{1/3}\\left(\\frac{\\sigma_F}{|c|}\\right)^{1/3}.\n$$\n该表达式最小化了主阶均方误差，平衡了截断偏差和力噪声方差。根据题目要求，位移大小需以米为单位表示；鉴于 $\\sigma_F$ 的单位是力，而 $c$ 的单位是力每位移立方，组合 $\\left(\\frac{\\sigma_F}{|c|}\\right)^{1/3}$ 的单位正是位移，符合要求。",
            "answer": "$$\\boxed{3^{1/3}\\left(\\frac{\\sigma_{F}}{|c|}\\right)^{1/3}}$$"
        },
        {
            "introduction": "晶格的平移不变性是一个基本物理原理，它要求所有原子在经历相同的均匀位移时，每个原子所受的合力必须为零。这一原理在数学上体现为对原子间力常数矩阵的严格约束，即声学求和规则（Acoustic Sum Rule, ASR）。本练习 () 旨在解决一个实际问题：从有限位移计算中获得的力常数由于数值噪声通常会轻微违反ASR，您将学习如何通过一个保持原始数据信息最大化的最小二乘法来施加这一约束，从而修正力常数并确保声子谱的物理正确性。",
            "id": "3460982",
            "problem": "给定一组有噪声的、拟合的原子间力常数，它们表示为一个实数矩阵，该矩阵应满足晶格动力学中的平移不变性声学求和规则。声学求和规则要求，所有原子的统一平移不产生力。从牛顿定律和谐波力的叠加原理出发，所有原子以相同位移进行统一平移意味着，每个原子因此位移所受的合力必须为零。这导出了对原子间力常数的线性约束：对于每个原子索引 $I$ 和每对笛卡尔分量 $\\alpha$ 和 $\\beta$，必须满足块行求和条件\n$$\n\\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)} = 0\n$$\n，其中 $\\Phi \\in \\mathbb{R}^{(ND) \\times (ND)}$ 是 $N$ 个原子在 $D$ 个笛卡尔维度中的原子间力常数矩阵，复合索引分别为行的 $(I,\\alpha)$ 和列的 $(J,\\beta)$。\n\n您必须构造一个最小二乘校正，该校正在强制执行这些线性约束的同时，最小化与原始 $\\Phi$ 的总偏差。具体来说，设 $x \\in \\mathbb{R}^{(ND)^2}$ 是通过堆叠 $\\Phi$ 的行得到的向量化形式，设 $A \\in \\mathbb{R}^{m \\times (ND)^2}$ 是编码声学求和规则的约束矩阵，其中 $m = N D^2$。目标是计算校正后的向量 $x^\\star$，它解决了以下约束最小化问题：\n$$\n\\min_{x \\in \\mathbb{R}^{(ND)^2}} \\ \\lVert x - x_0 \\rVert_2^2 \\quad \\text{subject to} \\quad A x = 0,\n$$\n其中 $x_0$ 是给定的有噪声的 $\\Phi$ 的向量化形式。您的程序必须实现对任意 $N$ 和 $D$ 构造 $A$，使用 Moore–Penrose 伪逆来形成并求解上述最小二乘投影问题，以确保即使在 $A A^\\top$ 是奇异矩阵时解也是良定义的，然后将 $x^\\star$ 重塑回矩阵形式 $\\Phi^\\star$。\n\n为验证正确性，请使用以下包含四个案例的测试套件。在每个案例中，$N$ 是原子数，$D$ 是笛卡尔分量数，$\\Phi_0$ 是一个精确满足求和规则的矩阵，$\\Delta$ 是一个加性噪声。有噪声的输入为 $\\Phi = \\Phi_0 + \\Delta$。\n\n- 案例 1（正常情况，$N=2$，$D=1$）：\n  - $\\Phi_0 = \\begin{bmatrix} 10  -10 \\\\ -10  10 \\end{bmatrix}$，\n  - $\\Delta = \\begin{bmatrix} 0.3  -0.2 \\\\ 0.1  -0.05 \\end{bmatrix}$。\n\n- 案例 2（多原子，$N=3$，$D=1$）：\n  - 设 $k_{12} = 5$ 且 $k_{23} = 7$，\n  - $\\Phi_0 = \\begin{bmatrix} 5  -5  0 \\\\ -5  12  -7 \\\\ 0  -7  7 \\end{bmatrix}$，\n  - $\\Delta = \\begin{bmatrix} 0.2  0.05  -0.1 \\\\ 0.12  -0.18  0.07 \\\\ 0.09  -0.04  0.02 \\end{bmatrix}$。\n\n- 案例 3（矢量自由度，$N=2$，$D=2$）：\n  - 设 $A = \\begin{bmatrix} 12  1 \\\\ 1  9 \\end{bmatrix}$ 并将 $\\Phi_0$ 构造为大小为 $4 \\times 4$ 的分块矩阵\n    $\n    \\Phi_0 = \\begin{bmatrix} A  -A \\\\ -A  A \\end{bmatrix}\n    $，\n  - $\\Delta$ 是将序列\n    $\n    [0.05, -0.03, 0.02, 0.01, -0.02, 0.04, -0.05, 0.03, 0.01, -0.02, 0.03, -0.01, -0.04, 0.02, -0.03, 0.05]\n    $\n    按行主序重塑后得到的 $4 \\times 4$ 矩阵。\n\n- 案例 4（边界情况，已满足求和规则，$N=2$，$D=1$）：\n  - $\\Phi_0 = \\begin{bmatrix} 3  -3 \\\\ -3  3 \\end{bmatrix}$，\n  - $\\Delta = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}$。\n\n对于每个测试案例，您的程序必须：\n- 为给定的 $N$ 和 $D$ 构造 $A$，使得每个约束行对应一个固定的 $(I,\\alpha,\\beta)$ 三元组，并在该行求和中为所有 $J$ 将每个变量 $\\Phi_{(I,\\alpha),(J,\\beta)}$ 设置为 $1$。\n- 计算最优校正 $x^\\star = x_0 - A^\\top (A A^\\top)^+ A x_0$，其中 $(\\cdot)^+$ 是 Moore–Penrose 伪逆，并将 $x^\\star$ 重塑为 $\\Phi^\\star$。\n- 作为对比，构建一个朴素的可行校正 $\\widetilde{\\Phi}$，即对于每个固定的 $(I,\\alpha,\\beta)$，仅调整对角元素 $(J=I,\\beta)$ 来消除相应的行和，也就是从 $\\Phi_{(I,\\alpha),(I,\\beta)}$ 中减去当前的和。\n- 对每个案例报告三个值：$r = \\lVert A \\,\\mathrm{vec}(\\Phi^\\star) \\rVert_2$（浮点数），$m$（布尔值，指示在 $10^{-10}$ 的数值容差内是否满足 $\\lVert \\mathrm{vec}(\\Phi^\\star) - x_0 \\rVert_2 \\le \\lVert \\mathrm{vec}(\\widetilde{\\Phi}) - x_0 \\rVert_2$），以及 $i$（布尔值，指示当输入已满足约束时，校正是否保持输入不变，即当 $\\lVert A x_0 \\rVert_2 \\le 10^{-12}$ 和 $\\lVert \\mathrm{vec}(\\Phi^\\star) - x_0 \\rVert_2 \\le 10^{-12}$ 同时成立时，$i$ 为真）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个案例的结果，格式为用方括号括起来的逗号分隔列表，每个案例的结果本身是按 $[r, m, i]$ 顺序排列的三元素列表。例如，一个语法上有效的格式是\n  $\n  [[r_1,m_1,i_1],[r_2,m_2,i_2],[r_3,m_3,i_3],[r_4,m_4,i_4]]。\n  $\n本问题不要求物理单位，也不涉及角度或百分比。所有计算都应使用向量的欧几里得范数。程序必须是自包含的，并且不需要用户输入。",
            "solution": "该问题要求解决一个约束最小二乘问题，以在有噪声的原子间力常数矩阵 $\\Phi$ 上强制执行声学求和规则（ASR）。这是一个标准的优化问题，其几何解释是将给定的向量投影到一个线性子空间上。\n\n### 1. 问题的数学形式\n\n给定一个有噪声的力常数向量 $x_0 = \\mathrm{vec}(\\Phi)$，我们希望找到一个满足ASR的向量 $x^\\star$，使得它与 $x_0$ 的欧几里得距离最小。ASR可以表示为一组线性方程 $Ax=0$，其中 $A$ 是约束矩阵。因此，优化问题是：\n$$\n\\min_{x} \\frac{1}{2} \\lVert x - x_0 \\rVert_2^2 \\quad \\text{subject to} \\quad A x = 0\n$$\n\n### 2. 投影法求解\n\n这个问题的解 $x^\\star$ 是向量 $x_0$ 在约束 $Ax=0$ 定义的子空间（即 $A$ 的零空间 $\\mathcal{N}(A)$）上的正交投影。\n一个向量可以分解为它在某个子空间上的投影和在该子空间正交补上的投影之和。$\\mathcal{N}(A)$ 的正交补是 $A$ 的行空间 $\\mathcal{R}(A^T)$。因此，我们可以将 $x_0$ 分解为：\n$$\nx_0 = x^\\star + x_{\\text{err}}\n$$\n其中 $x^\\star \\in \\mathcal{N}(A)$ 且 $x_{\\text{err}} \\in \\mathcal{R}(A^T)$。我们的目标是找到 $x^\\star$。\n$x_{\\text{err}}$ 是 $x_0$ 在 $\\mathcal{R}(A^T)$ 上的投影。正交投影算子 $P$ 到一个矩阵 $A$ 的行空间由下式给出：\n$$\nP = A^T (A A^T)^+ A\n$$\n其中 $(\\cdot)^+$ 是 Moore-Penrose 伪逆，它保证了即使当 $A A^T$ 不可逆（即约束是线性相关的）时，解也是唯一的且具有最小范数。\n因此，误差向量（即需要从 $x_0$ 中减去的校正量）是 $x_0$ 在行空间上的投影：\n$$\nx_{\\text{err}} = P x_0 = A^T (A A^T)^+ A x_0\n$$\n最终，满足约束的校正向量 $x^\\star$ 是：\n$$\nx^\\star = x_0 - x_{\\text{err}} = x_0 - A^T (A A^T)^+ A x_0\n$$\n这与问题中给出的公式一致。这个解是最优的，因为它最小化了校正量 $\\lVert x_0 - x^\\star \\rVert_2 = \\lVert x_{\\text{err}} \\rVert_2$ 的大小，这等价于最小化 $\\lVert x - x_0 \\rVert_2^2$。\n\n### 3. 约束矩阵 $A$ 的构造\n\n约束矩阵 $A$ 的作用是从向量化的力常数矩阵 $x$ 中提取出行和。ASR要求 $N \\times D^2$ 个独立的和为零。因此，$A$ 的维度是 $(N D^2) \\times (N D)^2$。\n$A$ 的每一行对应一个特定的 ASR 约束，由三元组 $(I, \\alpha, \\beta)$ 标识。该行中的非零元素（均为 1）对应于 $x$ 中那些构成 $\\sum_{J=0}^{N-1} \\Phi_{(I,\\alpha),(J,\\beta)}$ 和的元素。\n具体来说，对于由 $(I, \\alpha, \\beta)$ 确定的约束，我们将 $\\Phi$ 的行索引固定为 $i_{\\text{row}} = I \\cdot D + \\alpha$。然后，我们遍历所有原子 $J=0, \\dots, N-1$，对应的列索引为 $j_{\\text{col}} = J \\cdot D + \\beta$。在 $A$ 的相应行中，我们将与 $\\Phi_{i_{\\text{row}}, j_{\\text{col}}}$ 在向量 $x$ 中的位置相对应的列设为 1。\n\n### 4. 朴素校正法\n\n作为对比，朴素校正法通过修改每个约束和中的单个元素来强制满足约束。对于由 $(I, \\alpha, \\beta)$ 定义的每个约束，它计算当前的和 $S = \\sum_{J} \\Phi_{(I,\\alpha),(J,\\beta)}$，然后将这个和从对角元素 $\\Phi_{(I,\\alpha),(I,\\beta)}$ 中减去。虽然这种方法也能满足 $Ax=0$，但它将全部校正量集中在一个元素上，通常会导致比最小二乘法更大的总偏差 $\\lVert \\widetilde{x} - x_0 \\rVert_2$。",
            "answer": "[[1.1102230246251565e-16, true, false],[2.960594732333751e-16, true, false],[5.204170427930421e-16, true, false],[0.0, true, true]]"
        }
    ]
}