{
    "hands_on_practices": [
        {
            "introduction": "德拜模型为理解晶体固体的低温热容提供了一个强大而简洁的框架。本练习将挑战您从基本统计力学原理出发，从头开始构建该模型，并最终完成数值实现。通过计算热容并验证著名的 $T^3$ 定律，您将亲身体会到这个固态物理学基石的精髓。",
            "id": "3477867",
            "problem": "考虑一个在声子的德拜近似下建模的晶体固体。假设存在各向同性线性声学色散关系 $\\,\\omega = v\\,k\\,$，并有一个截止角频率 $\\,\\omega_D\\,$，使得对于一个包含 $\\,N\\,$ 个原子的系统，总振动模式数等于 $\\,3N\\,$。令德拜温度 $\\,\\Theta_D\\,$ 由 $\\,k_{\\mathrm{B}}\\Theta_D = \\hbar \\omega_D\\,$ 定义，其中 $\\,k_{\\mathrm{B}}\\,$ 是玻尔兹曼常数，$\\,\\hbar\\,$ 是约化普朗克常数。声子占据数遵循玻色-爱因斯坦（BE）分布 $\\,n_{\\mathrm{BE}}(\\omega,T) = \\left[\\exp\\!\\left(\\hbar\\omega / (k_{\\mathrm{B}} T)\\right)-1\\right]^{-1}\\,$。振动内能由态密度（DOS）、每个模式的能量以及BE占据数三者的乘积对频率积分得到。定容热容 $\\,C_V\\,$ 由 $\\,C_V = \\left(\\partial U/\\partial T\\right)_V\\,$ 定义。在热力学极限下进行计算，并报告摩尔热容，即每摩尔原子的热容。\n\n任务：\n1. 仅从上述基本定义出发，推导在德拜模型下摩尔热容 $\\,C_V\\,$ 作为温度 $\\,T\\,$ 和德拜温度 $\\,\\Theta_D\\,$ 的函数的表达式。您的推导不应假定任何预先制表的德拜函数；它必须从线性色散和BE统计所蕴含的态密度出发，通过模式计数约束来施加在 $\\,\\omega_D\\,$ 处的截止。\n2. 实现一个数值积分来评估在德拜温度 $\\,\\Theta_D = 300\\,\\mathrm{K}\\,$ 时，以下几个温度下的摩尔热容 $\\,C_V\\,$（单位为 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$）：$\\,T = 5\\,\\mathrm{K},\\,30\\,\\mathrm{K},\\,100\\,\\mathrm{K},\\,300\\,\\mathrm{K}\\,$。将每个报告值四舍五入到 $6$ 位小数，并以 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ 为单位表示所有结果。\n3. 通过使用普通最小二乘法，在低温集合 $\\,T \\in \\{2\\,\\mathrm{K},3\\,\\mathrm{K},5\\,\\mathrm{K},8\\,\\mathrm{K},12\\,\\mathrm{K}\\}\\,$ 上计算 $\\,\\ln C_V\\,$ 对 $\\,\\ln T\\,$ 的最佳拟合斜率，以验证低温 $\\,T^3\\,$ 定律。将斜率报告为四舍五入到 $3$ 位小数的浮点数。同时报告一个布尔值，如果拟合斜率与 $\\,3\\,$ 的偏差不超过 $\\,0.05\\,$，则为真，否则为假。\n\n数值和物理细节：\n- 使用气体常数 $\\,R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}\\,$。\n- 所有温度 $\\,T\\,$ 和 $\\,\\Theta_D\\,$ 的单位均为 $\\mathrm{K}$。\n- 热容的最终答案单位必须是 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n- 用于斜率拟合的所有对数都必须使用自然对数。\n\n测试套件和要求的输出：\n- 德拜温度：$\\,\\Theta_D = 300\\,\\mathrm{K}\\,$。\n- 热容评估温度：$\\,T = 5\\,\\mathrm{K},\\,30\\,\\mathrm{K},\\,100\\,\\mathrm{K},\\,300\\,\\mathrm{K}\\,$。\n- 低温斜率拟合温度：$\\,T = 2\\,\\mathrm{K},\\,3\\,\\mathrm{K},5\\,\\mathrm{K},8\\,\\mathrm{K},12\\,\\mathrm{K}\\,$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：$\\left[C_V(5\\,\\mathrm{K}),\\,C_V(30\\,\\mathrm{K}),\\,C_V(100\\,\\mathrm{K}),\\,C_V(300\\,\\mathrm{K}),\\,\\text{斜率},\\,\\text{布尔值}\\right]$。前四个条目必须四舍五入到 $6$ 位小数，斜率四舍五入到 $3$ 位小数，布尔值必须是标准编程语言大写形式的真或假（即 True 或 False）。例如，输出可能看起来像 $\\,[24.000000,24.500000,24.900000,24.943388,2.999,True]\\,$。这只是一个示例格式；您的程序必须计算指定参数的实际值。",
            "solution": "该问题要求在德拜模型内对摩尔热容 $C_V$ 进行第一性原理推导，然后进行数值评估，并验证低温 $T^3$ 定律。\n\n推导始于三维各向同性固体中的声子态密度（DOS）。在 k 空间中，半径为 $k = |\\mathbf{k}|$ 的球体内允许的波矢 $\\mathbf{k}$ 的数量与该球的体积成正比。对于一个体积为 $V$、包含 $N$ 个原子的晶体，并考虑到三种极化模式（一种纵波，两种横波）假设具有相同的声速 $v$，波矢大小不超过 $k$ 的模式数 $G(k)$ 为：\n$$ G(k) = 3 \\times \\frac{V}{(2\\pi)^3} \\left(\\frac{4}{3}\\pi k^3\\right) = \\frac{V k^3}{2\\pi^2} $$\nk 空间中的态密度是 $G(k)$ 对 $k$ 的导数：\n$$ g(k) = \\frac{dG(k)}{dk} = \\frac{3Vk^2}{2\\pi^2} $$\n使用线性声学色散关系 $\\omega = vk$，我们可以将态密度从 k 空间转换到频率空间。由于 $k = \\omega/v$ 且 $dk = d\\omega/v$，以角频率 $\\omega$ 表示的态密度 $g(\\omega)$ 可通过关系式 $g(\\omega)d\\omega = g(k)dk$ 求得：\n$$ g(\\omega) = g(k(\\omega)) \\frac{dk}{d\\omega} = \\left(\\frac{3V( \\omega/v )^2}{2\\pi^2}\\right) \\frac{1}{v} = \\frac{3V}{2\\pi^2 v^3} \\omega^2 $$\n德拜模型施加了一个截止频率 $\\omega_D$，使得总振动模式数等于 $3N$。这个归一化条件是：\n$$ \\int_0^{\\omega_D} g(\\omega) d\\omega = \\int_0^{\\omega_D} \\frac{3V}{2\\pi^2 v^3} \\omega^2 d\\omega = \\frac{V \\omega_D^3}{2\\pi^2 v^3} = 3N $$\n由此，我们得到 $\\omega_D^3 = 6\\pi^2 N v^3 / V$。我们可以将其代回到态密度表达式中以消去 $V$ 和 $v$：\n$$ g(\\omega) = \\frac{9N}{\\omega_D^3} \\omega^2, \\quad \\text{for } 0 \\le \\omega \\le \\omega_D $$\n且对于 $\\omega  \\omega_D$，有 $g(\\omega) = 0$。\n\n固体的振动内能 $U$ 是所有声子模式能量的总和。在温度 $T$ 下，频率为 $\\omega$ 的量子谐振子的平均能量由 $\\hbar\\omega$ 乘以玻色-爱因斯坦占据数 $n_{\\mathrm{BE}}(\\omega, T) = (\\exp(\\hbar\\omega / (k_B T)) - 1)^{-1}$ 给出。零点能项被忽略，因为它是一个常数，在计算热容时会消失。因此，总内能为：\n$$ U = \\int_0^{\\omega_D} \\hbar\\omega \\, n_{\\mathrm{BE}}(\\omega, T) \\, g(\\omega) d\\omega = \\int_0^{\\omega_D} \\frac{\\hbar\\omega}{e^{\\hbar\\omega/k_B T} - 1} \\left(\\frac{9N\\omega^2}{\\omega_D^3}\\right) d\\omega $$\n$$ U = \\frac{9N\\hbar}{\\omega_D^3} \\int_0^{\\omega_D} \\frac{\\omega^3}{e^{\\hbar\\omega/k_B T} - 1} d\\omega $$\n定容热容为 $C_V = (\\partial U / \\partial T)_V$。我们对积分关于 $T$ 求导：\n$$ C_V = \\frac{\\partial}{\\partial T} \\left( \\frac{9N\\hbar}{\\omega_D^3} \\int_0^{\\omega_D} \\frac{\\omega^3}{e^{\\hbar\\omega/k_B T} - 1} d\\omega \\right) $$\n在积分号下求导是最直接的方法：\n$$ C_V = \\frac{9N\\hbar}{\\omega_D^3} \\int_0^{\\omega_D} \\omega^3 \\frac{\\partial}{\\partial T} \\left( \\frac{1}{e^{\\hbar\\omega/k_B T} - 1} \\right) d\\omega $$\n热学因子的导数是：\n$$ \\frac{\\partial}{\\partial T} \\left(e^{\\hbar\\omega/k_B T} - 1\\right)^{-1} = -1 \\cdot \\left(e^{\\hbar\\omega/k_B T} - 1\\right)^{-2} \\cdot e^{\\hbar\\omega/k_B T} \\cdot \\left(-\\frac{\\hbar\\omega}{k_B T^2}\\right) = \\frac{\\hbar\\omega}{k_B T^2} \\frac{e^{\\hbar\\omega/k_B T}}{\\left(e^{\\hbar\\omega/k_B T} - 1\\right)^2} $$\n将此代回 $C_V$ 的表达式中：\n$$ C_V = \\frac{9N\\hbar}{\\omega_D^3} \\int_0^{\\omega_D} \\omega^3 \\left( \\frac{\\hbar\\omega}{k_B T^2} \\frac{e^{\\hbar\\omega/k_B T}}{\\left(e^{\\hbar\\omega/k_B T} - 1\\right)^2} \\right) d\\omega = \\frac{9N\\hbar^2}{k_B T^2 \\omega_D^3} \\int_0^{\\omega_D} \\frac{\\omega^4 e^{\\hbar\\omega/k_B T}}{\\left(e^{\\hbar\\omega/k_B T} - 1\\right)^2} d\\omega $$\n为简化起见，我们引入无量纲变量 $x = \\hbar\\omega/(k_B T)$。这意味着 $\\omega = k_B T x / \\hbar$ 和 $d\\omega = (k_B T / \\hbar) dx$。积分上限变为 $x_D = \\hbar\\omega_D/(k_B T)$。我们使用德拜温度的定义 $\\Theta_D = \\hbar\\omega_D/k_B$，因此 $x_D = \\Theta_D/T$。将这些代入 $C_V$ 表达式并简化常数，得到：\n$$ C_V = 9N k_B \\left(\\frac{T}{\\Theta_D}\\right)^3 \\int_0^{\\Theta_D/T} \\frac{x^4 e^x}{(e^x - 1)^2} dx $$\n对于摩尔热容 $C_{V,m}$，我们考虑一摩尔原子，因此 $N = N_A$，其中 $N_A$ 是阿伏伽德罗常数。使用关系式 $R = N_A k_B$，其中 $R$ 是摩尔气体常数，我们得到最终表达式：\n$$ C_{V,m}(T, \\Theta_D) = 9R \\left(\\frac{T}{\\Theta_D}\\right)^3 \\int_0^{\\Theta_D/T} \\frac{x^4 e^x}{(e^x - 1)^2} dx $$\n该表达式需要进行数值评估。这是一个正常积分，因为被积函数 $f(x) = x^4 e^x / (e^x-1)^2$ 在 $x \\to 0$ 时趋近于 $x^2$，因此在积分下限处为零。我们使用数值积分，特别是 `scipy.integrate.quad` 函数，它非常适合这类定积分。计算是针对 $\\Theta_D = 300\\,\\mathrm{K}$ 和指定温度进行的。\n\n为了验证低温 $T^3$ 定律，我们分析了当 $T \\to 0$ 时 $C_{V,m}$ 的行为。在此极限下，积分上限 $\\Theta_D/T \\to \\infty$。$C_{V,m}$ 的表达式变得与 $T^3$ 成正比：\n$$ C_{V,m}(T) \\approx 9R \\left(\\frac{T}{\\Theta_D}\\right)^3 \\int_0^{\\infty} \\frac{x^4 e^x}{(e^x - 1)^2} dx = A \\cdot T^3 $$\n其中 $A = \\frac{9R}{\\Theta_D^3} \\int_0^{\\infty} \\frac{x^4 e^x}{(e^x - 1)^2} dx$ 是一个常数。该定积分的值为 $4\\pi^4/15$。\n为了数值验证这一关系，我们对数据的对数进行线性模型拟合：\n$$ \\ln(C_{V,m}) = \\ln(A) + 3 \\ln(T) $$\n这是一个 $y = m x + c$ 形式的线性方程，其中 $y = \\ln(C_{V,m})$，$x = \\ln(T)$，斜率 $m = 3$，截距 $c = \\ln(A)$。我们为给定的低温集合 $T \\in \\{2\\,\\mathrm{K},3\\,\\mathrm{K},5\\,\\mathrm{K},8\\,\\mathrm{K},12\\,\\mathrm{K}\\}$ 计算 $C_{V,m}$，对 $T$ 和 $C_{V,m}$ 取自然对数，并执行普通最小二乘线性回归以找到最佳拟合斜率。问题要求报告此斜率，并检查其与 $3$ 的绝对偏差是否不超过 $0.05$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    This function solves the entire problem as stated.\n    It calculates molar heat capacities, performs a linear fit to verify\n    the T^3 law, and prints the results in the required format.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    THETA_D = 300.0      # Debye temperature in K\n    R = 8.314462618      # Molar gas constant in J mol^-1 K^-1\n\n    # --- Core Physics Implementation ---\n    def integrand(x):\n        \"\"\"\n        The integrand for the Debye heat capacity integral: x^4 * e^x / (e^x - 1)^2.\n        This implementation is numerically stable.\n        \"\"\"\n        # For x=0, the limit is 0.\n        if x == 0:\n            return 0.0\n        # Use np.expm1 for better precision with small x, where exp(x)-1 would suffer from catastrophic cancellation.\n        denominator = np.expm1(x)\n        if denominator == 0:  # Should not happen for x > 0\n            return 0.0\n        return (x**4 * np.exp(x)) / (denominator**2)\n\n    def calculate_cv(T, theta_d):\n        \"\"\"\n        Calculates the molar heat capacity Cv at a given temperature T and Debye temperature.\n        \"\"\"\n        if T == 0.0:\n            return 0.0\n        \n        # Upper limit of integration\n        x_d = theta_d / T\n        \n        # Perform numerical integration\n        integral_val, _ = quad(integrand, 0, x_d)\n        \n        # Calculate molar heat capacity\n        prefactor = 9 * R * (T / theta_d)**3\n        cv = prefactor * integral_val\n        return cv\n\n    # --- Task 2: Calculate Molar Heat Capacity ---\n    temps_cv = [5.0, 30.0, 100.0, 300.0]\n    cv_results = [calculate_cv(T, THETA_D) for T in temps_cv]\n    \n    # --- Task 3: Verify Low-Temperature T^3 Law ---\n    temps_low = np.array([2.0, 3.0, 5.0, 8.0, 12.0])\n    \n    # Calculate Cv values for the low-temperature range\n    cv_low = np.array([calculate_cv(T, THETA_D) for T in temps_low])\n    \n    # Perform ordinary least squares fit on the log-log data\n    # ln(Cv) = slope * ln(T) + intercept\n    log_T = np.log(temps_low)\n    log_cv = np.log(cv_low)\n    \n    # np.polyfit returns [slope, intercept] for a degree 1 polynomial\n    slope, _ = np.polyfit(log_T, log_cv, 1)\n    \n    # Check if the slope is within the specified tolerance\n    is_slope_valid = abs(slope - 3.0) = 0.05\n    \n    # --- Format and Print Final Output ---\n    # Collate all results\n    all_results = [\n        cv_results[0],\n        cv_results[1],\n        cv_results[2],\n        cv_results[3],\n        slope,\n        is_slope_valid\n    ]\n\n    # Format the list into the required string output\n    # Using f-strings for float formatting to ensure trailing zeros\n    # And str() for the boolean\n    formatted_results = [\n        f\"{all_results[0]:.6f}\",\n        f\"{all_results[1]:.6f}\",\n        f\"{all_results[2]:.6f}\",\n        f\"{all_results[3]:.6f}\",\n        f\"{all_results[4]:.3f}\",\n        str(all_results[5])\n    ]\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然德拜模型在描述简单晶体中的声学模方面表现出色，但许多材料表现出更复杂的声子谱，包括独特的光学支。本练习将指导您对一个更真实的、同时包含声学和光学声子的态密度进行建模。您将学习数值计算总热容，更重要的是，学会剖析不同类型声子的贡献，揭示它们如何在不同温度区间占据主导地位。",
            "id": "3477839",
            "problem": "给定一个晶体固体，其声子态密度模型由两部分组成：一个声学连续谱和一个尖锐的光学峰。态密度以每摩尔原胞为单位定义，因此对角频率积分可计算出每摩尔的声子模数量。声学部分被建模为类德拜连续谱，形式为 $g_{\\mathrm{ac}}(\\omega)=A\\,\\omega^{2}$，在区间 $0 \\le \\omega \\le \\omega_{\\mathrm{D}}$ 上；光学部分被建模为一个以光学角频率 $\\omega_{\\mathrm{E}}$ 为中心、标准差为 $\\sigma$ 的窄高斯分布，即对于 $\\omega \\ge 0$，有 $g_{\\mathrm{op}}(\\omega)=\\dfrac{N_{\\mathrm{op}}}{\\sigma\\sqrt{2\\pi}}\\exp\\!\\left(-\\dfrac{(\\omega-\\omega_{\\mathrm{E}})^{2}}{2\\sigma^{2}}\\right)$。此处 $A$ 的选择需满足 $\\int_{0}^{\\omega_{\\mathrm{D}}}g_{\\mathrm{ac}}(\\omega)\\,d\\omega=N_{\\mathrm{ac}}$，其中 $N_{\\mathrm{ac}}$ 是每摩尔的声学模数量，$N_{\\mathrm{op}}$ 是每摩尔的光学模数量。总态密度为 $g(\\omega)=g_{\\mathrm{ac}}(\\omega)+g_{\\mathrm{op}}(\\omega)$。\n\n从无相互作用声子的玻色-爱因斯坦分布以及内能和定容热容的定义出发，推导一个关于摩尔定容热容 $C_{V}(T)$ 的表达式，该表达式是一个包含 $g(\\omega)$ 并对 $\\omega$ 积分的形式。然后，使用该表达式，对下列参数集进行数值计算，求出摩尔热容。\n\n归一化与参数：\n- 声学态密度在 $[0,\\omega_{\\mathrm{D}}]$ 上为 $g_{\\mathrm{ac}}(\\omega)=A\\,\\omega^{2}$，其中 $A$ 由 $\\int_{0}^{\\omega_{\\mathrm{D}}}g_{\\mathrm{ac}}(\\omega)\\,d\\omega=N_{\\mathrm{ac}}$ 固定，这意味着 $A=\\dfrac{3N_{\\mathrm{ac}}}{\\omega_{\\mathrm{D}}^{3}}$。\n- 光学峰在 $\\omega \\ge 0$ 上为 $g_{\\mathrm{op}}(\\omega)=\\dfrac{N_{\\mathrm{op}}}{\\sigma\\sqrt{2\\pi}}\\exp\\!\\left(-\\dfrac{(\\omega-\\omega_{\\mathrm{E}})^{2}}{2\\sigma^{2}}\\right)$。\n- 使用 $\\omega_{\\mathrm{D}}=\\dfrac{k_{\\mathrm{B}}\\Theta_{\\mathrm{D}}}{\\hbar}$ 和 $\\omega_{\\mathrm{E}}=\\dfrac{k_{\\mathrm{B}}\\Theta_{\\mathrm{E}}}{\\hbar}$，其中 $\\Theta_{\\mathrm{D}}$ 和 $\\Theta_{\\mathrm{E}}$ 是特征温度。\n- 使用 $\\sigma=\\alpha\\,\\omega_{\\mathrm{E}}$，其中 $\\alpha$ 是给定的无量纲宽度。\n- 每摩尔的模数量为 $N_{\\mathrm{ac}}=(n_{\\mathrm{ac}})N_{\\mathrm{A}}$ 和 $N_{\\mathrm{op}}=(n_{\\mathrm{op}})N_{\\mathrm{A}}$，其中 $n_{\\mathrm{ac}}$ 和 $n_{\\mathrm{op}}$ 分别是每个原胞的声学支和光学支的数量，$N_{\\mathrm{A}}$ 是阿伏伽德罗常数。\n\n常数：\n- 玻尔兹曼常数 $k_{\\mathrm{B}}=1.380649\\times 10^{-23}\\,\\mathrm{J/K}$。\n- 约化普朗克常数 $\\hbar=1.054571817\\times 10^{-34}\\,\\mathrm{J\\cdot s}$。\n- 阿伏伽德罗常数 $N_{\\mathrm{A}}=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$。\n\n温度区间的分类：\n- 对每种情况，分别通过对 $g_{\\mathrm{ac}}(\\omega)$ 和 $g_{\\mathrm{op}}(\\omega)$ 积分来计算声学和光学对 $C_{V}(T)$ 的贡献。定义主导阈值分数 $f_{\\mathrm{dom}}=0.7$。如果声学贡献至少占总量的 $f_{\\mathrm{dom}}$，则将该区间标记为声学主导。如果光学贡献至少占总量的 $f_{\\mathrm{dom}}$，则将该区间标记为光学主导。否则，标记为混合。将标签编码为整数：$0$ 表示声学主导，$1$ 表示光学主导，$2$ 表示混合。在总热容在数值上与零无法区分的情况下（例如在极低温度下），约定声学贡献占主导地位。\n\n单位与输出：\n- 所有温度以 $\\mathrm{K}$ 表示，所有角频率以 $\\mathrm{rad/s}$ 表示，最终的摩尔热容以 $\\mathrm{J/(mol\\cdot K)}$ 表示。\n- 您的程序必须为每个测试用例输出一个包含两个元素的列表，其中包含四舍五入到六位小数的摩尔热容和作为整数的主导代码。将结果汇总到一行中，打印成一个由这类双元素列表组成的列表，例如 $[[C_{1},d_{1}],[C_{2},d_{2}],\\dots]$。\n\n测试套件：\n- 情况 A 参数：$\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$，$\\Theta_{\\mathrm{E}}=800\\,\\mathrm{K}$，$\\alpha=0.03$， $n_{\\mathrm{ac}}=3$, $n_{\\mathrm{op}}=3$。\n  - A1: $T=5\\,\\mathrm{K}$。\n  - A2: $T=200\\,\\mathrm{K}$。\n  - A3: $T=1500\\,\\mathrm{K}$。\n- 情况 B 参数：$\\Theta_{\\mathrm{D}}=300\\,\\mathrm{K}$，$\\Theta_{\\mathrm{E}}=900\\,\\mathrm{K}$，$\\alpha=0.03$，$n_{\\mathrm{ac}}=3$，$n_{\\mathrm{op}}=9$。\n  - B1: $T=600\\,\\mathrm{K}$。\n  - B2: $T=50\\,\\mathrm{K}$。\n\n您的程序应生成一行输出，其中包含一个以逗号分隔并用方括号括起来的列表，列表中的每个元素本身就是一个双元素列表 $[C_{V},d]$，其中 $C_{V}$ 以 $\\mathrm{J/(mol\\cdot K)}$ 为单位，四舍五入到六位小数，$d\\in\\{0,1,2\\}$，按 A1、A2、A3、B1、B2 的顺序排列。",
            "solution": "该问题是有效的，因为它科学地基于固态物理和统计力学的原理，问题提出得很好，提供了所有必要的数据和定义，并且其表述是客观的。该模型结合了用于声学声子的类德拜连续谱和用于光学声子的高斯峰，是材料科学中使用的标准且物理上合理的近似。\n\n解决方案分两个阶段进行：首先，推导摩尔定容热容 $C_V(T)$ 的理论表达式；其次，描述用于计算给定参数下 $C_V(T)$ 的数值算法。\n\n**1. 摩尔热容的理论推导**\n\n晶体固体被建模为一种由无相互作用的准粒子（声子）组成的气体。作为玻色子，在温度 $T$ 的热平衡状态下，角频率为 $\\omega$ 的模式中声子的平均数量由玻色-爱因斯坦分布 $n(\\omega, T)$ 给出：\n$$n(\\omega, T) = \\frac{1}{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1}$$\n其中 $\\hbar$ 是约化普朗克常数，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n单个声子模的平均能量，包括零点能，是 $\\langle E(\\omega) \\rangle = \\hbar \\omega \\left(n(\\omega, T) + \\frac{1}{2}\\right)$。每摩尔的总内能 $U(T)$ 是通过对摩尔声子态密度 $g(\\omega)$ 上各模式的能量进行积分得到的：\n$$U(T) = \\int_{0}^{\\infty} g(\\omega) \\langle E(\\omega) \\rangle d\\omega = \\int_{0}^{\\infty} g(\\omega) \\hbar \\omega \\left( \\frac{1}{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1} + \\frac{1}{2} \\right) d\\omega$$\n摩尔定容热容 $C_V(T)$ 是内能对温度的导数：$C_V(T) = \\left(\\frac{\\partial U}{\\partial T}\\right)_V$。零点能项 $\\int_{0}^{\\infty} g(\\omega) \\frac{\\hbar \\omega}{2} d\\omega$ 与温度无关，因此其导数为零。我们可以交换微分和积分的顺序：\n$$C_V(T) = \\int_{0}^{\\infty} g(\\omega) \\frac{\\partial}{\\partial T} \\left( \\frac{\\hbar \\omega}{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1} \\right) d\\omega$$\n对 $T$ 进行微分得到：\n$$\\frac{\\partial}{\\partial T} \\left( \\frac{\\hbar \\omega}{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1} \\right) = \\hbar \\omega \\left( - \\frac{1}{\\left(\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1\\right)^2} \\right) \\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) \\left( -\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T^2} \\right) = k_{\\mathrm{B}} \\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right)^2 \\frac{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right)}{\\left(\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1\\right)^2}$$\n将此代入 $C_V(T)$ 的积分中，我们得到最终表达式：\n$$C_V(T) = \\int_{0}^{\\infty} g(\\omega) k_{\\mathrm{B}} \\left( \\frac{\\hbar \\omega}{k_{\\mathrm{B}} T} \\right)^2 \\frac{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right)}{\\left(\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1\\right)^2} d\\omega$$\n\n**2. 数值实现策略**\n\n总态密度是声学和光学贡献之和，$g(\\omega) = g_{\\mathrm{ac}}(\\omega) + g_{\\mathrm{op}}(\\omega)$。因此，总热容是各分支贡献之和：$C_V(T) = C_{V,\\mathrm{ac}}(T) + C_{V,\\mathrm{op}}(T)$。\n\n声学贡献 $C_{V,\\mathrm{ac}}(T)$ 是使用类德拜 DOS $g_{\\mathrm{ac}}(\\omega) = A\\omega^2$ 计算的，它仅在 $0 \\le \\omega \\le \\omega_{\\mathrm{D}}$ 时非零。归一化常数 $A$ 由条件 $\\int_{0}^{\\omega_{\\mathrm{D}}} A\\omega^2 d\\omega = N_{\\mathrm{ac}}$ 决定，得出 $A = \\frac{3N_{\\mathrm{ac}}}{\\omega_{\\mathrm{D}}^3}$。每摩尔的声学模数量为 $N_{\\mathrm{ac}} = n_{\\mathrm{ac}}N_{\\mathrm{A}}$。截止频率为 $\\omega_{\\mathrm{D}} = \\frac{k_{\\mathrm{B}}\\Theta_{\\mathrm{D}}}{\\hbar}$。所以，声学贡献为：\n$$C_{V,\\mathrm{ac}}(T) = \\int_{0}^{\\omega_{\\mathrm{D}}} \\left(\\frac{3N_{\\mathrm{ac}}}{\\omega_{\\mathrm{D}}^3}\\omega^2\\right) k_{\\mathrm{B}} \\left( \\frac{\\hbar \\omega}{k_{\\mathrm{B}} T} \\right)^2 \\frac{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right)}{\\left(\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1\\right)^2} d\\omega$$\n\n光学贡献 $C_{V,\\mathrm{op}}(T)$ 是使用高斯 DOS $g_{\\mathrm{op}}(\\omega) = \\frac{N_{\\mathrm{op}}}{\\sigma\\sqrt{2\\pi}}\\exp\\left(-\\frac{(\\omega-\\omega_{\\mathrm{E}})^2}{2\\sigma^2}\\right)$ 计算的，在 $\\omega \\ge 0$ 上积分。参数为 $N_{\\mathrm{op}} = n_{\\mathrm{op}}N_{\\mathrm{A}}$，$\\omega_{\\mathrm{E}} = \\frac{k_{\\mathrm{B}}\\Theta_{\\mathrm{E}}}{\\hbar}$ 和 $\\sigma = \\alpha\\omega_{\\mathrm{E}}$。\n$$C_{V,\\mathrm{op}}(T) = \\int_{0}^{\\infty} \\left(\\frac{N_{\\mathrm{op}}}{\\sigma\\sqrt{2\\pi}}\\exp\\left(-\\frac{(\\omega-\\omega_{\\mathrm{E}})^2}{2\\sigma^2}\\right)\\right) k_{\\mathrm{B}} \\left( \\frac{\\hbar \\omega}{k_{\\mathrm{B}} T} \\right)^2 \\frac{\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right)}{\\left(\\exp\\left(\\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}\\right) - 1\\right)^2} d\\omega$$\n\n这些定积分是数值计算的。为了数值稳定性，被积函数的核项被重写。令 $x = \\frac{\\hbar \\omega}{k_{\\mathrm{B}} T}$ 和 $y = x/2$。核变为：\n$$k_{\\mathrm{B}} x^2 \\frac{e^x}{(e^x-1)^2} = k_{\\mathrm{B}} x^2 \\frac{e^x}{(e^{x/2}(e^{x/2}-e^{-x/2}))^2} = k_{\\mathrm{B}} x^2 \\frac{e^x}{e^x(2\\sinh(x/2))^2} = k_{\\mathrm{B}} \\frac{(2y)^2}{4\\sinh^2(y)} = k_{\\mathrm{B}} \\left(\\frac{y}{\\sinh(y)}\\right)^2$$\n这种形式避免了当 $x$ 很大时与 $\\exp(x)$ 相关的数值溢出，并且在 $y \\to 0$ 时表现良好，此时它正确地趋近于 $k_{\\mathrm{B}}$。\n\n数值解是通过为 $g_{\\mathrm{ac}}(\\omega)$、$g_{\\mathrm{op}}(\\omega)$ 和稳定化的核定义函数来实现的。使用 `scipy.integrate.quad` 函数来评估 $C_{V,\\mathrm{ac}}(T)$ 和 $C_{V,\\mathrm{op}}(T)$ 的积分。\n\n最后，根据相对贡献对主导区间进行分类。给定阈值分数 $f_{\\mathrm{dom}}=0.7$：\n- 如果 $C_V(T)$ 在数值上接近于零，则按惯例将该区间编码为 $0$（声学主导）。\n- 如果 $\\frac{C_{V,\\mathrm{ac}}(T)}{C_V(T)} \\ge f_{\\mathrm{dom}}$，则代码为 $0$（声学主导）。\n- 如果 $\\frac{C_{V,\\mathrm{op}}(T)}{C_V(T)} \\ge f_{\\mathrm{dom}}$，则代码为 $1$（光学主导）。\n- 否则，代码为 $2$（混合）。\n\n最终的摩尔热容 $C_V(T)$ 以 $\\mathrm{J/(mol\\cdot K)}$ 为单位，四舍五入到六位小数，并附带整数主导代码。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Calculates the molar heat capacity of a solid with a composite phonon DOS\n    and determines the dominant contribution (acoustic or optical).\n    \"\"\"\n\n    # Physical Constants\n    KB = 1.380649e-23  # Boltzmann constant in J/K\n    HBAR = 1.054571817e-34  # Reduced Planck constant in J.s\n    NA = 6.02214076e23  # Avogadro constant in mol^-1\n    R = KB * NA  # Molar gas constant in J/(mol.K)\n    \n    # Dominance threshold\n    F_DOM = 0.7\n\n    test_cases = [\n        # Case A: Theta_D=400, Theta_E=800, alpha=0.03, n_ac=3, n_op=3\n        {'T': 5, 'Theta_D': 400, 'Theta_E': 800, 'alpha': 0.03, 'n_ac': 3, 'n_op': 3},  # A1\n        {'T': 200, 'Theta_D': 400, 'Theta_E': 800, 'alpha': 0.03, 'n_ac': 3, 'n_op': 3}, # A2\n        {'T': 1500, 'Theta_D': 400, 'Theta_E': 800, 'alpha': 0.03, 'n_ac': 3, 'n_op': 3},# A3\n        # Case B: Theta_D=300, Theta_E=900, alpha=0.03, n_ac=3, n_op=9\n        {'T': 600, 'Theta_D': 300, 'Theta_E': 900, 'alpha': 0.03, 'n_ac': 3, 'n_op': 9}, # B1\n        {'T': 50, 'Theta_D': 300, 'Theta_E': 900, 'alpha': 0.03, 'n_ac': 3, 'n_op': 9},  # B2\n    ]\n\n    def integrand_kernel(omega, T):\n        \"\"\"\n        Calculates the numerically stable kernel of the heat capacity integral.\n        Kernel: k_B * (y/sinh(y))^2 where y = hbar*omega/(2*k_B*T).\n        \"\"\"\n        if T == 0.0 or omega == 0.0:\n            return 0.0 # No contribution at T=0 or omega=0\n        \n        y = HBAR * omega / (2 * KB * T)\n        \n        # for y -> 0, (y/sinh(y))^2 -> 1.\n        # for y > 700, sinh(y) overflows. We can use an asymptotic form\n        # but for the parameters in this problem, y does not reach this limit.\n        if y  1e-6:\n             return KB\n\n        return KB * (y / np.sinh(y))**2\n\n    def calculate_cv_for_case(params):\n        \"\"\"\n        Computes CV and dominance code for a single parameter set.\n        \"\"\"\n        T = params['T']\n        Theta_D = params['Theta_D']\n        Theta_E = params['Theta_E']\n        alpha = params['alpha']\n        n_ac = params['n_ac']\n        n_op = params['n_op']\n\n        # Derived parameters\n        w_D = KB * Theta_D / HBAR\n        w_E = KB * Theta_E / HBAR\n        sigma = alpha * w_E\n        N_ac = n_ac * NA\n        N_op = n_op * NA\n        A = 3 * N_ac / (w_D**3)\n\n        # 1. Acoustic Contribution\n        def g_ac(omega):\n            return A * omega**2\n\n        def ac_integrand(omega):\n            return g_ac(omega) * integrand_kernel(omega, T)\n\n        # Integrate over [0, w_D] for the acoustic part\n        cv_ac, _ = quad(ac_integrand, 0, w_D)\n\n        # 2. Optical Contribution\n        def g_op(omega):\n            norm = N_op / (sigma * np.sqrt(2 * np.pi))\n            return norm * np.exp(-0.5 * ((omega - w_E) / sigma)**2)\n\n        def op_integrand(omega):\n            return g_op(omega) * integrand_kernel(omega, T)\n\n        # Integrate over [0, inf) for the optical part.\n        # The Gaussian is sharply peaked, so numerical integration is efficient.\n        cv_op, _ = quad(op_integrand, 0, np.inf)\n\n        # 3. Total CV and dominance classification\n        cv_total = cv_ac + cv_op\n        \n        # Dominance code determination\n        dominance_code = 2  # Default to mixed\n        \n        if np.isclose(cv_total, 0.0, atol=1e-9):\n            # Convention for numerically zero CV (e.g., at very low T)\n            dominance_code = 0\n        elif cv_ac / cv_total >= F_DOM:\n            dominance_code = 0  # Acoustic-dominated\n        elif cv_op / cv_total >= F_DOM:\n            dominance_code = 1  # Optical-dominated\n        \n        return [round(cv_total, 6), dominance_code]\n\n    results = []\n    for case in test_cases:\n        result = calculate_cv_for_case(case)\n        results.append(result)\n\n    # Format output as a list of lists string. e.g., [[C1,d1],[C2,d2]]\n    results_str = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "连续的理论模型与现代计算材料科学中使用的离散数值方法之间通常存在一个关键的鸿沟。本练习旨在通过比较理想的德拜积分与模拟真实超胞计算的离散求和，来弥合这一差距。通过分析采样误差及其收敛性，您将对计算参数（如 $q$ 点网格密度）如何影响模拟热力学性质的准确性形成实践性的理解。",
            "id": "3477869",
            "problem": "您需要编写一个完整且可运行的程序，该程序从第一性原理出发，将 Debye 模型预测的每原子定容热容与通过对倒易空间进行有限位移超晶胞采样所获得的离散化晶格动力学估算值进行比较。您的程序必须实现以下两种方法，并量化由采样引起的误差随倒易空间采样密度的变化。所有物理量必须以科学上真实且自洽的方式处理，数值答案必须按规定以无量纲形式计算。\n\n从以下原理开始。\n\n- 晶体固体支持量子化的晶格振动（声子）。每个角频率为 $\\omega$ 的简正模携带的平均热能由 Bose–Einstein 统计确定，其中占据数为 $n(\\omega,T)=\\left(\\exp\\{\\hbar\\omega/(k_{\\mathrm{B}}T)\\}-1\\right)^{-1}$，并且该模式的热能贡献不包括零点能项。单个模式的定容热容是其热能对温度 $T$ 的导数。\n- 在用于各向同性单原子晶体的 Debye 模型中，三个声学支被近似为线性色散关系 $\\omega=v\\lvert\\mathbf{q}\\rvert$，直至一个截止波矢大小 $q_{\\mathrm{D}}$，该截止值的选取是为了使总模式数等于 $3N$（对于 $N$ 个原子）。Debye 温度定义为 $\\Theta_{\\mathrm{D}}=\\hbar\\omega_{\\mathrm{D}}/k_{\\mathrm{B}}$，其中 $\\omega_{\\mathrm{D}}=v q_{\\mathrm{D}}$。\n- 对波矢 $\\mathbf{q}$ 的布里渊区求和可以替换为在半径为 $q_{\\mathrm{D}}$ 的球体上对 $\\mathbf{q}$ 中的均匀测度进行积分，而 Debye 模型对每原子热容的预测是通过在该球体上对单位模式热容进行积分并加以适当归一化得到的。\n- 一个线性尺寸为 $S$ 的有限位移超晶胞在以 $\\Gamma$ 点为中心的正规网格上对布里渊区进行采样，每个倒易晶格方向上有 $S$ 个点。在各向同性 Debye 近似中，您可以通过将一个 $S\\times S\\times S$ 的正规 $\\Gamma$ 中心网格放置在立方体 $[-q_{\\mathrm{D}},q_{\\mathrm{D}}]^3$ 中，并仅保留 Debye 球 $\\lvert\\mathbf{q}\\rvert\\le q_{\\mathrm{D}}$ 内的网格点来理想化此采样。然后，晶格动力学热容的每原子值可以通过对保留的 $\\mathbf{q}$ 点上的三个相同的声学模式贡献（在 $\\omega=v\\lvert\\mathbf{q}\\rvert$ 处计算）进行均匀平均来近似。\n\n要实现的任务。\n\n1) 实现一个函数，该函数在给定 Debye 温度 $\\Theta_{\\mathrm{D}}$ 和温度 $T$ 的条件下，返回 Debye 模型下的每原子热容，形式为无量纲比值 $C_V/k_{\\mathrm{B}}$。该函数必须从每模式的 Bose–Einstein 占据数出发，通过如上所述在 Debye 球上积分得到。最终表达式涉及以 $x=\\hbar\\omega/(k_{\\mathrm{B}}T)$ 表示的无量纲 Debye 积分，并且仅依赖于比值 $T/\\Theta_{\\mathrm{D}}$。不要引入任何唯象拟合参数。\n\n2) 实现一个函数，该函数返回有限位移晶格动力学估算的每原子熱容，同样以无量纲比值 $C_V/k_{\\mathrm{B}}$ 的形式。使用一个位于立方体 $[-q_{\\mathrm{D}},q_{\\mathrm{D}}]^3$ 内的 $\\Gamma$ 中心 $S\\times S\\times S$ 网格，仅保留满足 $\\lvert\\mathbf{q}\\rvert\\le q_{\\mathrm{D}}$ 的点，并对每个波矢的三个声学模式贡献进行平均。使用与 (1) 中相同的每模式 Bose–Einstein 表达式，以及线性色散关系 $\\omega=v\\lvert\\mathbf{q}\\rvert$ 和 $v q_{\\mathrm{D}}=\\omega_{\\mathrm{D}}$，从而无量纲频率为 $\\lvert\\mathbf{q}\\rvert/q_{\\mathrm{D}}$，上限为 $x_{\\mathrm{D}}=\\Theta_{\\mathrm{D}}/T$。通过取每模式热容被积函数在零频率下的适当极限来处理 $\\mathbf{q}=\\mathbf{0}$ 模式。\n\n3) 使用上述两个函数，计算以下测试套件的指标。所有温度必须以开尔文为单位处理，所有 Debye 温度 $\\Theta_{\\mathrm{D}}$ 均以开尔文给出，最终报告的指标必须是无量纲十进制数。\n\n- 案例 A（正常路径，混合温度覆盖）：$\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$，温度 $T\\in\\{20,80,400,2000\\}\\,\\mathrm{K}$，采样尺寸 $S=6$。计算在所列温度范围内，有限位移估计值与 Debye 预测值之间的最大绝对相对误差，\n$$\\max_{T}\\left\\lvert \\frac{\\left(C_V^{\\mathrm{FD}}/k_{\\mathrm{B}}\\right)-\\left(C_V^{\\mathrm{Debye}}/k_{\\mathrm{B}}\\right)}{\\left(C_V^{\\mathrm{Debye}}/k_{\\mathrm{B}}\\right)}\\right\\rvert,$$\n并以十进制数形式返回。\n\n- 案例 B（细化比较）：$\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$，温度 $T\\in\\{20,80,400,2000\\}\\,\\mathrm{K}$，采样尺寸 $S=12$。计算与案例 A 中相同的最大绝对相对误差，并以十进制数形式返回。\n\n- 案例 C（低温标度压力测试）：$\\Theta_{\\mathrm{D}}=300\\,\\mathrm{K}$，温度 $T\\in\\{3,6,9,12,15\\}\\,\\mathrm{K}$，采样尺寸 $S=8$。仅使用有限位移估计值，通过对所提供温度范围内的 $\\ln\\left(C_V^{\\mathrm{FD}}/k_{\\mathrm{B}}\\right)$ 与 $\\ln T$ 进行最小二乘拟合来估计低温标度指数 $p$，并以十进制数形式返回绝对偏差 $\\lvert p-3\\rvert$。\n\n- 案例 D（代表性温度下的观测采样收敛阶数）：$\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$，固定温度 $T=\\Theta_{\\mathrm{D}}$，两个采样尺寸 $S_1=6$ 和 $S_2=12$。计算在此单一温度下如案例 A 中定义的绝对相对误差 $e(S_1)$ 和 $e(S_2)$，并以十进制数形式返回观测到的收敛阶数\n$$\\alpha=\\frac{\\ln\\left(e(S_1)/e(S_2)\\right)}{\\ln\\left(S_2/S_1\\right)}$$。\n\n最终输出格式。\n\n- 您的程序应生成单行输出，其中包含案例 A–D 的结果，按顺序排列，形式为用方括号括起来的逗号分隔列表，例如 $\\left[\\text{A},\\text{B},\\text{C},\\text{D}\\right]$，其中每个条目都是一个十进制数。不允许有其他输出。\n\n注释和约束。\n\n- 仅使用 $k_{\\mathrm{B}}$ 作为符号单位来形成无量纲比值 $C_V/k_{\\mathrm{B}}$。所有最终报告的量必须是无单位的十进制数。\n- 所有积分和求和程序必须在指定范围内数值稳定。使用其正确的极限值来处理每模式热容在 $x\\to 0$ 时的极限。\n- 不要引入任何外部输入；所有参数均如上所述，并且必须根据测试套件进行硬编码。",
            "solution": "该问题要求对单原子晶体固体的定容热容进行比较分析，比较连续 Debye 模型和离散化晶格动力学近似的预测结果。分析将通过从第一性原理出发实现两种模型，并在一系列指定的测试案例中评估它们的一致性和行为来进行。\n\n### 1. 基本原理：声子热容\n\n晶体固体的热学性质主要由其晶格振动决定，这些振动可以被量子化为声子。每个声子模式对应一个具有特定角频率 $\\omega$ 和波矢 $\\mathbf{q}$ 的振动简正模，其行为如同一个量子谐振子。在温度为 $T$ 时，单个模式的平均热能 $\\langle E \\rangle$（不包括恒定的零点能）由能量量子 $\\hbar\\omega$ 和 Bose-Einstein 统计的平均占据数 $n(\\omega, T)$ 的乘积给出：\n$$\n\\langle E \\rangle = \\hbar\\omega \\, n(\\omega, T) = \\frac{\\hbar\\omega}{\\exp\\left(\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T}\\right) - 1}\n$$\n其中 $\\hbar$ 是约化普朗克常数，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。该单个模式的定容热容 $C_{V, \\text{mode}}$ 是其平均能量对温度的导数：\n$$\nC_{V, \\text{mode}} = \\frac{\\partial \\langle E \\rangle}{\\partial T}\n$$\n\n为方便推导，我们引入无量纲变量 $x = \\hbar\\omega/(k_{\\mathrm{B}}T)$。对 $T$ 的偏导数可以用 $x$ 来表示：$\\frac{\\partial}{\\partial T} = \\frac{\\partial x}{\\partial T}\\frac{d}{dx} = -\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T^2}\\frac{d}{dx} = -\\frac{x}{T}\\frac{d}{dx}$。\n将此应用于能量表达式 $\\langle E \\rangle = k_{\\mathrm{B}}T \\frac{x}{e^x - 1}$ 会很繁琐。因此，我们直接求导：\n$$\nC_{V, \\text{mode}} = \\frac{\\partial}{\\partial T} \\left( \\frac{\\hbar\\omega}{e^{\\hbar\\omega/(k_{\\mathrm{B}}T)} - 1} \\right) = \\hbar\\omega \\left( - \\frac{1}{(e^{\\hbar\\omega/(k_{\\mathrm{B}}T)} - 1)^2} \\right) \\left( e^{\\hbar\\omega/(k_{\\mathrm{B}}T)} \\right) \\left( -\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T^2} \\right)\n$$\n简化并以无量纲形式表示，得到每个模式的热容贡献，这是两种模型的基本构建块：\n$$\n\\frac{C_{V, \\text{mode}}}{k_{\\mathrm{B}}} = \\left(\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T}\\right)^2 \\frac{\\exp\\left(\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T}\\right)}{\\left(\\exp\\left(\\frac{\\hbar\\omega}{k_{\\mathrm{B}}T}\\right) - 1\\right)^2} = \\frac{x^2 e^x}{(e^x - 1)^2}\n$$\n在低频极限下，当 $\\omega \\to 0$（因此 $x \\to 0$）时，我们使用泰勒展开 $e^x \\approx 1 + x + x^2/2$，这使得 $(e^x - 1)^2 \\approx x^2$。表达式简化为 $\\frac{x^2(1+x)}{x^2} \\approx 1+x$，极限为 $1$：\n$$\n\\lim_{x \\to 0} \\frac{C_{V, \\text{mode}}}{k_{\\mathrm{B}}} = 1\n$$\n这个极限对于处理 $\\mathbf{q}=\\mathbf{0}$ 处的声学模式至关重要。\n\n### 2. Debye 热容模型 ($C_V^{\\text{Debye}}$)\n\nDebye 模型通过近似固体的声子谱来计算总热容。它假设所有三个声学模式都具有线性的、各向同性的色散关系 $\\omega = v|\\mathbf{q}|$，直到一个截止频率 $\\omega_{\\mathrm{D}}$。选择此截止频率是为了确保模式总数正确，即对于有 $N$ 个原子的固体为 $3N$。这导致态密度（单位频率的模式数）为 $g(\\omega) = \\frac{9N\\omega^2}{\\omega_{\\mathrm{D}}^3}$（当 $\\omega \\le \\omega_{\\mathrm{D}}$ 时），否则为 $g(\\omega)=0$。\n\n每原子的总热容 $C_V^{\\text{Debye}}$，是通过将单模式热容乘以归一化的态密度并在所有允许的频率上积分得到的：\n$$\n\\frac{C_V^{\\text{Debye}}}{k_{\\mathrm{B}}} = \\frac{1}{N} \\int_0^{\\omega_{\\mathrm{D}}} \\frac{C_{V, \\text{mode}}}{k_{\\mathrm{B}}} g(\\omega) \\, d\\omega = \\int_0^{\\omega_{\\mathrm{D}}} \\frac{x^2 e^x}{(e^x - 1)^2} \\frac{9\\omega^2}{\\omega_{\\mathrm{D}}^3} \\, d\\omega\n$$\n为了计算这个积分，我们将积分变量从 $\\omega$ 更改为无量纲的 $y = \\hbar\\omega/(k_{\\mathrm{B}}T)$。这得到 $\\omega = \\frac{k_{\\mathrm{B}}T}{\\hbar}y$ 和 $d\\omega = \\frac{k_{\\mathrm{B}}T}{\\hbar}dy$。积分上限变为 $y_D = \\hbar\\omega_{\\mathrm{D}}/(k_{\\mathrm{B}}T) = \\Theta_{\\mathrm{D}}/T$，其中 $\\Theta_{\\mathrm{D}}$ 是 Debye 温度。表达式变为：\n$$\n\\frac{C_V^{\\text{Debye}}}{k_{\\mathrm{B}}} = \\frac{9}{\\omega_{\\mathrm{D}}^3} \\int_0^{\\Theta_{\\mathrm{D}}/T} \\frac{y^2 e^y}{(e^y - 1)^2} \\left( \\frac{k_{\\mathrm{B}}T}{\\hbar}y \\right)^2 \\left( \\frac{k_{\\mathrm{B}}T}{\\hbar} \\right) \\, dy\n$$\n代入 $\\omega_{\\mathrm{D}} = k_{\\mathrm{B}}\\Theta_{\\mathrm{D}}/\\hbar$，我们得到 Debye 热容的标准形式：\n$$\n\\frac{C_V^{\\text{Debye}}}{k_{\\mathrm{B}}} = 9 \\left( \\frac{T}{\\Theta_{\\mathrm{D}}} \\right)^3 \\int_0^{\\Theta_{\\mathrm{D}}/T} \\frac{y^4 e^y}{(e^y - 1)^2} \\, dy\n$$\n这个定积分必须进行数值计算。\n\n### 3. 有限位移 (FD) 模型 ($C_V^{\\text{FD}}$)\n\n有限位移方法用离散的波矢 $\\mathbf{q}$ 网格上的求和来近似布里渊区的积分。问题指定了一种理想化的采样方案：一个正规的、以 $\\Gamma$ 为中心的 $S \\times S \\times S$ 点网格被放置在立方体 $[-q_{\\mathrm{D}}, q_{\\mathrm{D}}]^3$ 内。\n\n为了构建这个网格，我们在每个笛卡尔轴上定义 $S$ 个点，跨越区间 $[-q_{\\mathrm{D}}, q_{\\mathrm{D}}]$。对于 $S  1$，一个维度上的坐标由 $q_i = q_{\\mathrm{D}} \\left(-1 + \\frac{2k}{S-1}\\right)$ 给出，其中 $k \\in \\{0, 1, \\dots, S-1\\}$。这将创建一个包含立方体边界的网格。完整的三维网格由这些坐标组合成的所有点 $\\mathbf{q} = (q_x, q_y, q_z)$ 组成。\n\n从此网格中，只有位于 Debye 球内的点，即满足 $|\\mathbf{q}| \\le q_{\\mathrm{D}}$ 的点，才被保留用于计算。\n\n每原子热容 $C_V^{\\text{FD}}/k_{\\mathrm{B}}$ 被定义为“对保留的 $\\mathbf{q}$ 点上的三个相同的声学模式贡献的均匀平均值”。设 $N_q$ 是保留的网格点数。对于每个保留的点 $\\mathbf{q}_i$，我们计算无量纲频率变量 $x_i = \\hbar\\omega_i/(k_{\\mathrm{B}}T)$。使用线性色散关系 $\\omega_i = v|\\mathbf{q}_i|$ 和关系式 $\\Theta_{\\mathrm{D}} = \\hbar v q_{\\mathrm{D}}/k_{\\mathrm{B}}$，这变为 $x_i = \\frac{|\\mathbf{q}_i|}{q_{\\mathrm{D}}} \\frac{\\Theta_{\\mathrm{D}}}{T}$。在 $\\mathbf{q}_i$ 处三个模式的贡献是 $3 \\cdot (C_{V, \\text{mode}}/k_{\\mathrm{B}})$。将这些贡献在 $N_q$ 个点上平均，得到：\n$$\n\\frac{C_V^{\\text{FD}}}{k_{\\mathrm{B}}} = \\frac{1}{N_q} \\sum_{i=1}^{N_q} 3 \\cdot \\frac{C_{V, \\text{mode}}(x_i)}{k_{\\mathrm{B}}} = \\frac{3}{N_q} \\sum_{i=1}^{N_q} \\frac{x_i^2 e^{x_i}}{(e^{x_i} - 1)^2}\n$$\n该公式在 $T \\to \\infty$ 时正确地得到了 $3$ 的 Dulong-Petit 极限（因为 $x_i \\to 0$ 且每模式贡献趋近于 $1$）。对于测试案例中使用的偶数 $S$，网格不包括 $\\mathbf{q}=\\mathbf{0}$ 点，因此对于这些特定计算，严格来说不需要 $x \\to 0$ 的极限，但一个鲁棒的算法必须能处理它。\n\n### 4. 计算策略与测试案例\n\n解决方案是使用 `numpy` 和 `scipy` 库实现的 Python 程序。\n\n- **`debye_cv` 函数**：实现 Debye 模型。它以 $T$ 和 $\\Theta_{\\mathrm{D}}$ 作为输入，并使用 `scipy.integrate.quad` 来数值计算 $C_V^{\\text{Debye}}/k_{\\mathrm{B}}$ 的定积分。\n- **`fd_cv` 函数**：实现有限位移模型。它以 $T$、$\\Theta_{\\mathrm{D}}$ 和网格尺寸 $S$ 作为输入。它以编程方式生成 $S \\times S \\times S$ 网格，过滤 Debye 球内的点，计算所有保留点的每模式贡献，并按规定计算最终平均值。通过使用 `numpy.expm1` 确保小 $x$ 值的数值稳定性。\n\n主程序随后执行指定的四个测试案例：\n- **案例 A  B**：对于一组温度（$T \\in \\{20, 80, 400, 2000\\}\\,\\mathrm{K}$）和给定的 $\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$，调用 `debye_cv` 和 `fd_cv` (A 使用 $S=6$，B 使用 $S=12$)。计算最大绝对相对误差 $\\max_T |(C_V^{\\mathrm{FD}} - C_V^{\\mathrm{Debye}})/C_V^{\\mathrm{Debye}}|$。\n- **案例 C**：对于一组低温（$T \\in \\{3, 6, 9, 12, 15\\}\\,\\mathrm{K}$），$\\Theta_{\\mathrm{D}}=300\\,\\mathrm{K}$ 和 $S=8$，使用 `fd_cv` 函数计算热容。对 $\\ln(C_V^{\\mathrm{FD}}/k_{\\mathrm{B}})$ 与 $\\ln(T)$ 进行线性最小二乘拟合（`numpy.polyfit`）。这条线的斜率 $p$ 是低温标度指数的估计值。报告绝对偏差 $|p-3|$，以测试模型再现预期的 $T^3$ 定律的能力。\n- **案例 D**：分析 FD 近似相对于网格密度的收敛性。在固定温度 $T=\\Theta_{\\mathrm{D}}=400\\,\\mathrm{K}$下，计算 $S_1=6$ 和 $S_2=12$ 的绝对相对误差 $e(S)$。然后计算观测到的收敛阶数 $\\alpha = \\ln(e(S_1)/e(S_2))/\\ln(S_2/S_1)$。\n\n最终输出是包含四个十进制数结果的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem by implementing Debye and Finite-Displacement\n    models for heat capacity and evaluating the specified test cases.\n    \"\"\"\n\n    def debye_cv(T, Theta_D):\n        \"\"\"\n        Calculates the Debye model heat capacity per atom (dimensionless C_V/k_B).\n\n        Args:\n            T (float): Temperature in Kelvin.\n            Theta_D (float): Debye temperature in Kelvin.\n\n        Returns:\n            float: Dimensionless heat capacity C_V / k_B.\n        \"\"\"\n        if T == 0.0:\n            return 0.0\n        \n        # Upper limit for the Debye integral\n        x_D = Theta_D / T\n\n        def integrand(y):\n            \"\"\"The integrand of the Debye heat capacity integral.\"\"\"\n            if np.isclose(y, 0.0):\n                # The integrand behaves as y**2 near 0, but is 0 at y=0.\n                return 0.0\n            # Use np.expm1 for numerical stability for small y\n            return (y**4 * np.exp(y)) / (np.expm1(y))**2\n\n        integral_val, _ = integrate.quad(integrand, 0, x_D, epsabs=1e-12, epsrel=1e-12)\n        \n        return 9.0 * (T / Theta_D)**3 * integral_val\n\n    def fd_cv(T, Theta_D, S):\n        \"\"\"\n        Calculates the finite-displacement heat capacity per atom (dimensionless C_V/k_B).\n\n        Args:\n            T (float): Temperature in Kelvin.\n            Theta_D (float): Debye temperature in Kelvin.\n            S (int): Linear size of the reciprocal-space sampling grid.\n\n        Returns:\n            float: Dimensionless heat capacity C_V / k_B.\n        \"\"\"\n        if T == 0.0:\n            return 0.0\n\n        # 1. Generate dimensionless q-grid coordinates in the cube [-1, 1]^3\n        if S == 1:\n            q_coords_1d = np.array([0.0])\n        else:\n            k = np.arange(S)\n            q_coords_1d = -1.0 + 2.0 * k / (S - 1.0)\n        \n        qx, qy, qz = np.meshgrid(q_coords_1d, q_coords_1d, q_coords_1d, indexing='ij')\n        \n        # 2. Filter points inside the Debye sphere (|q'| = 1)\n        q_mag_sq = qx**2 + qy**2 + qz**2\n        retained_mask = q_mag_sq = 1.0\n        \n        q_mag_retained = np.sqrt(q_mag_sq[retained_mask])\n        num_retained_q = q_mag_retained.size\n        \n        if num_retained_q == 0:\n            return 0.0\n\n        # 3. Calculate heat capacity contributions\n        x_D_factor = Theta_D / T\n        x_values = q_mag_retained * x_D_factor\n        \n        # Get per-mode contributions, C_V,mode / k_B\n        cv_contributions = np.zeros_like(x_values)\n        \n        nonzero_mask = ~np.isclose(x_values, 0.0)\n        \n        # For q=0, x=0, contribution is 1.0\n        cv_contributions[~nonzero_mask] = 1.0\n        \n        x_nz = x_values[nonzero_mask]\n        cv_contributions[nonzero_mask] = (x_nz**2 * np.exp(x_nz)) / (np.expm1(x_nz))**2\n        \n        # 4. Compute the average as per the problem statement\n        # C_V/k_B = (1/Nq) * sum(3 * per_mode_cv) = 3 * mean(per_mode_cv)\n        total_cv_per_kB = 3.0 * np.mean(cv_contributions)\n        \n        return total_cv_per_kB\n\n    # --- Test Case Execution ---\n    \n    # Case A: Max relative error for S=6\n    Theta_D_A = 400.0\n    T_A = np.array([20.0, 80.0, 400.0, 2000.0])\n    S_A = 6\n    errors_A = []\n    for T in T_A:\n        cv_debye_val = debye_cv(T, Theta_D_A)\n        cv_fd_val = fd_cv(T, Theta_D_A, S_A)\n        if cv_debye_val > 1e-12:\n            errors_A.append(np.abs((cv_fd_val - cv_debye_val) / cv_debye_val))\n        else:\n            errors_A.append(np.abs(cv_fd_val - cv_debye_val))\n    result_A = np.max(errors_A)\n    \n    # Case B: Max relative error for S=12\n    Theta_D_B = 400.0\n    T_B = np.array([20.0, 80.0, 400.0, 2000.0])\n    S_B = 12\n    errors_B = []\n    for T in T_B:\n        cv_debye_val = debye_cv(T, Theta_D_B)\n        cv_fd_val = fd_cv(T, Theta_D_B, S_B)\n        if cv_debye_val > 1e-12:\n            errors_B.append(np.abs((cv_fd_val - cv_debye_val) / cv_debye_val))\n        else:\n            errors_B.append(np.abs(cv_fd_val - cv_debye_val))\n    result_B = np.max(errors_B)\n    \n    # Case C: Low-temperature scaling exponent\n    Theta_D_C = 300.0\n    T_C = np.array([3.0, 6.0, 9.0, 12.0, 15.0])\n    S_C = 8\n    cv_fd_C = np.array([fd_cv(T, Theta_D_C, S_C) for T in T_C])\n    \n    p = np.polyfit(np.log(T_C), np.log(cv_fd_C), 1)[0]\n    result_C = np.abs(p - 3.0)\n\n    # Case D: Observed convergence order\n    Theta_D_D = 400.0\n    T_D = Theta_D_D\n    S1, S2 = 6, 12\n    \n    cv_debye_D = debye_cv(T_D, Theta_D_D)\n    \n    cv_fd_S1 = fd_cv(T_D, Theta_D_D, S1)\n    e_S1 = np.abs((cv_fd_S1 - cv_debye_D) / cv_debye_D)\n\n    cv_fd_S2 = fd_cv(T_D, Theta_D_D, S2)\n    e_S2 = np.abs((cv_fd_S2 - cv_debye_D) / cv_debye_D)\n    \n    if e_S2 == 0:\n        # Handle case of perfect convergence for simplicity, though unlikely\n        result_D = np.inf\n    else:\n        result_D = np.log(e_S1 / e_S2) / np.log(S2 / S1)\n    \n    # --- Final Output ---\n    \n    # Collect results and print in the required format\n    results = [result_A, result_B, result_C, result_D]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}