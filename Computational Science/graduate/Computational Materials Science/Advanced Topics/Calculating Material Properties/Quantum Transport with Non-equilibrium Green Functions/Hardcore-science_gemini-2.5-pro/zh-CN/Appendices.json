{
    "hands_on_practices": [
        {
            "introduction": "自能函数 $\\Sigma(E)$ 是在NEGF框架中描述开放量子系统的核心。本练习将指导您推导一个典型模型——半无限一维紧束缚电极——的精确解析自能，并将基于精确自能计算得到的透射函数与广泛使用的宽带近似（Wide-Band Limit, WBL）结果进行比较。通过这项实践，您将深刻理解电极自能的物理起源、宽带近似背后的假设，并定量地掌握其局限性，特别是在能带边缘（此处存在范霍夫奇异点）附近 。",
            "id": "3482922",
            "problem": "考虑一个由哈密顿量 $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$ 描述的单点器件，该器件耦合到两个半无限一维紧束缚导线，分别标记为左 ($L$) 和右 ($R$)。每条导线的特征是在位能 $\\varepsilon_0$ 和最近邻跃迁参数 $t$，器件通过耦合振幅 $\\tau_L$ 和 $\\tau_R$ 分别耦合到每条导线的末端格点。在非平衡格林函数 (NEGF) 的框架内进行分析，从推迟格林函数 $G^r$、超前格林函数 $G^a$、自能 $\\Sigma_\\alpha^r(E)$（其中 $\\alpha \\in \\{L,R\\}$）以及耦合（展宽）函数 $\\Gamma_\\alpha(E)$ 的定义出发。使用 Landauer 方法处理相干输运，并利用 NEGF 形式理论中导出的透射率与器件及导线性质之间的关系。\n\n您的任务是：\n- 从基本的 NEGF 定义和定义半无限周期系统导线自能的方程出发，推导半无限一维紧束缚链的精确的、依赖于能量的表面格林函数，并由此获得每条导线的 $\\Sigma_\\alpha^r(E)$ 和 $\\Gamma_\\alpha(E)$。\n- 通过将依赖于能量的耦合函数 $\\Gamma_\\alpha(E)$ 替换为常数 $\\Gamma_{\\alpha,0}$ 来定义宽带极限 (WBL) 近似。这些常数是通过在参考能量 $E_0$ 处计算精确的 $\\Gamma_\\alpha(E)$ 得到的。在本问题中，设 $E_0 = 0\\,\\mathrm{eV}$。\n- 使用 NEGF 推导通过该单点器件的透射函数，并用 $G^r$、$G^a$ 和耦合函数表示。分别使用精确的半无限紧束缚自能和使用宽带极限（采用 $\\Gamma_{\\alpha,0}$ 且不考虑依赖于能量的实部偏移）计算该透射函数。\n- 通过为每个能量 $E$ 计算误差度量 $\\Delta(E) = \\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right| / \\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)$，来量化宽带极限在能带边缘（van Hove 奇点出现处）附近的误差。其中正则化常数 $\\epsilon_\\mathrm{reg} = 10^{-12}$。所有能量和耦合均以 $\\mathrm{eV}$ 为单位表示。\n\n在一个程序中实现上述过程，该程序为以下参数集测试套件计算误差度量 $\\Delta(E)$。该套件探讨了一般情况、趋近能带边缘的 van Hove 奇点的情况、能带外的情况以及一种耦合边界条件：\n\n- 情况 1（一般情况，能带中心）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n- 情况 2（近能带边缘）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.8\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n- 情况 3（更近能带边缘）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.95\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n- 情况 4（趋近 van Hove 奇点）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.999\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n- 情况 5（能带外）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (2.1\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n- 情况 6（零耦合边界）：$(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1,r_2,\\dots,r_6]$），其中每个 $r_i$ 是相应情况的 $\\Delta(E)$ 的浮点数值。所有能量和耦合都必须以 $\\mathrm{eV}$ 为单位，计算出的透射率是无量綱的。本问题不涉及角度。",
            "solution": "所提出的问题是计算材料科学领域中的一个有效且适定的练习，具体涉及在非平衡格林函数 (NEGF) 形式理论框架内建模的单点电子器件的量子输运问题。它要求推导并比较使用精确导线自能与使用宽带极限近似计算的透射函数。所有给定的参数和定义都是标准的、科学上合理且自洽的。因此，我们着手进行求解。\n\n主要任务是推导单能级量子点（由哈密顿量 $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$ 描述，耦合到两个半无限一维紧束缚导线）的透射函数 $T(E)$。求解过程包括几个关键步骤：推导导线性质，构建器件格林函数，然后计算透射率。\n\n**1. 一维紧束缚导线的表面格林函数**\n\n一个半无限一维紧束缚导线（格点索引从 $n=0$ 到无穷）由一个具有在位能 $\\varepsilon_0$ 和最近邻跃迁 $t$ 的哈密顿量描述。我们需要求解推迟格林函数 $g^r(E) = [(E+i\\eta)I - H_\\mathrm{lead}]^{-1}$（其中 $\\eta \\to 0^+$）。对应于导线末端格点的矩阵元 $g^r_{00}(E)$ 被称为表面格林函数，我们记为 $g^r_{surf}(E)$。\n\n这个矩阵元可以通过递推论证求得。格点 0 处的格林函数可以通过 Dyson 方程表示，其中的自能项描述了与链其余部分（格点 $n=1, 2, \\dots$）的耦合：\n$$g^r_{surf}(E) = \\left( E+i\\eta - \\varepsilon_0 - t \\cdot g^r_{surf}(E) \\cdot t \\right)^{-1}$$\n这里，我们利用了这样一个事实：连接到从格点 1 开始的子链的自能是 $t^2 g^r_{surf}(E)$，因为该子链在结构上与原始的半无限链相同。令 $g = g^r_{surf}(E)$ 和 $z = E - \\varepsilon_0 + i\\eta$，方程变为：\n$$g = (z - t^2 g)^{-1} \\implies t^2 g^2 - z g + 1 = 0$$\n这个关于 $g$ 的二次方程有两个解：\n$$g = \\frac{z \\pm \\sqrt{z^2 - 4t^2}}{2t^2}$$\n为选择物理上正确的根，我们要求格林函数代表进入导线的出射波或衰减波，这对应于当 $\\mathrm{Im}(E) \\to \\infty$ 时衰减的解。这个条件由负号满足。因此，精确的表面格林函数是：\n$$g^r_{surf}(E) = \\frac{(E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2}}{2t^2}$$\n在此表达式中，平方根的分支选择使其虚部为负，这与能量 $E$ 中的微小正虚部 $i\\eta$ 一致。\n\n**2. 导线自能和展宽函数**\n\n导线 $\\alpha \\in \\{L, R\\}$ 通过跃迁振幅 $\\tau_\\alpha$ 耦合到器件。描述导线对器件影响的推迟自能 $\\Sigma^r_\\alpha(E)$ 由下式给出：\n$$\\Sigma^r_\\alpha(E) = \\tau_\\alpha^2 g^r_{surf}(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2} \\right]$$\n展宽（或耦合）函数 $\\Gamma_\\alpha(E)$ 与自能的关系为 $\\Gamma_\\alpha(E) = i[\\Sigma^r_\\alpha(E) - \\Sigma^a_\\alpha(E)]$。由于超前自能是推迟自能的厄米共轭，即 $\\Sigma^a_\\alpha(E) = (\\Sigma^r_\\alpha(E))^*$，上式简化为：\n$$\\Gamma_\\alpha(E) = -2 \\mathrm{Im}[\\Sigma^r_\\alpha(E)]$$\n$\\Gamma_\\alpha(E)$ 的行为取决于能量 $E$ 是否落在导线的导带内，导带范围从 $\\varepsilon_0 - 2|t|$ 到 $\\varepsilon_0 + 2|t|$。\n\n- **能带内 ($|E - \\varepsilon_0|  2|t|$):** 项 $(E - \\varepsilon_0)^2 - 4t^2$ 为负。平方根是纯虚数：$\\sqrt{(E - \\varepsilon_0)^2 - 4t^2} = \\pm i\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$。正确的物理根给出了 $\\Sigma^r_\\alpha(E)$ 的负虚部，对应于耗散。\n$$\\Sigma^r_\\alpha(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - i\\sqrt{4t^2 - (E - \\varepsilon_0)^2} \\right]$$\n虚部为 $\\mathrm{Im}[\\Sigma^r_\\alpha(E)] = -\\frac{\\tau_\\alpha^2}{2t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$。因此展宽为：\n$$\\Gamma_\\alpha(E) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$$\n- **能带外 ($|E - \\varepsilon_0| > 2|t|$):** 平方根项是实数。在极限 $\\eta \\to 0^+$下，$\\Sigma^r_\\alpha(E)$ 的虚部为零。因此 $\\Gamma_\\alpha(E) = 0$，表示在这些能量下导线中没有可用于输运的态。\n\n**3. 透射函数：精确解 vs. 宽带极限**\n\n单点器件的总推迟格林函数为：\n$$G^r(E) = \\left[ E - \\varepsilon_\\mathrm{d} - \\Sigma^r_L(E) - \\Sigma^r_R(E) \\right]^{-1}$$\n根据 NEGF 框架中的 Landauer-Büttiker 公式，透射函数由下式给出：\n$$T(E) = \\mathrm{Tr}\\left[\\Gamma_L(E) G^r(E) \\Gamma_R(E) G^a(E)\\right]$$\n对于单点器件，这是一个标量表达式，其中 $G^a(E) = (G^r(E))^*$：\n$$T(E) = \\Gamma_L(E) \\Gamma_R(E) |G^r(E)|^2$$\n\n**A. 精确透射率 $T_\\mathrm{exact}(E)$**\n为了计算精确透射率，我们使用上面推导出的依赖于能量的 $\\Sigma^r_\\alpha(E)$ 和 $\\Gamma_\\alpha(E)$ 表达式。透射率仅在导线能带内非零。\n\n**B. 宽带极限 (WBL) 透射率 $T_\\mathrm{WBL}(E)$**\nWBL 近似通过假设导线展宽在感兴趣的能量范围内是常数来简化问题。依赖于能量的自能 $\\Sigma^r_\\alpha(E)$ 被一个纯虚常数替代：\n$$\\Sigma^r_\\alpha(E) \\approx \\Sigma^r_{\\alpha, \\mathrm{WBL}} = -i\\frac{\\Gamma_{\\alpha,0}}{2}$$\n其中 $\\Gamma_{\\alpha,0}$ 是在参考能量 $E_0$ 处计算的精确展宽函数的值。问题指定 $E_0 = 0\\,\\mathrm{eV}$。对于给定的導線参数 $\\varepsilon_0 = 0\\,\\mathrm{eV}$ 和 $t=1.0\\,\\mathrm{eV}$，$E_0$ 位于能带中心。\n$$\\Gamma_{\\alpha,0} = \\Gamma_\\alpha(E_0=0) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (0 - 0)^2} = \\frac{2|t|\\tau_\\alpha^2}{t^2} = \\frac{2\\tau_\\alpha^2}{|t|}$$\nWBL 中的器件格林函数为：\n$$G^r_\\mathrm{WBL}(E) = \\left[ E - \\varepsilon_\\mathrm{d} - (-i\\frac{\\Gamma_{L,0}}{2}) - (-i\\frac{\\Gamma_{R,0}}{2}) \\right]^{-1} = \\left[ (E - \\varepsilon_\\mathrm{d}) + i\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2} \\right]^{-1}$$\n于是，WBL 透射率是一个洛伦兹函数：\n$$T_\\mathrm{WBL}(E) = \\Gamma_{L,0} \\Gamma_{R,0} |G^r_\\mathrm{WBL}(E)|^2 = \\frac{\\Gamma_{L,0} \\Gamma_{R,0}}{(E - \\varepsilon_\\mathrm{d})^2 + \\left(\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2}\\right)^2}$$\n值得注意的是，该近似预测在所有能量下都有非零透射，这是与精确结果的一个关键区别。\n\n**4. 误差度量**\nWBL 近似的误差由度量 $\\Delta(E)$ 来量化：\n$$\\Delta(E) = \\frac{\\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right|}{\\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)}$$\n正则化常数 $\\epsilon_\\mathrm{reg} = 10^{-12}$ 防止在 $T_\\mathrm{exact}(E)$ 为零的区域（例如导带之外或当导线解耦时）出现除以零的情况。\n\n我们现在将实现这些公式，为指定的测试用例计算 $\\Delta(E)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error measure Δ(E) for the WBL approximation across several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E, eps_d, eps_0, t, tau_L, tau_R)\n        (0.0, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 1: general, band center\n        (1.8, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 2: near band edge\n        (1.95, 0.0, 0.0, 1.0, 0.5, 0.5),  # Case 3: closer to band edge\n        (1.999, 0.0, 0.0, 1.0, 0.5, 0.5), # Case 4: approaching van Hove singularity\n        (2.1, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 5: outside the band\n        (0.0, 0.0, 0.0, 1.0, 0.0, 0.5),   # Case 6: zero coupling boundary\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_delta(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_delta(E, eps_d, eps_0, t, tau_L, tau_R):\n    \"\"\"\n    Calculates the error measure Δ(E) for a given set of parameters.\n    \n    Args:\n        E (float): Energy.\n        eps_d (float): Device on-site energy.\n        eps_0 (float): Lead on-site energy.\n        t (float): Lead hopping parameter.\n        tau_L (float): Left lead coupling.\n        tau_R (float): Right lead coupling.\n\n    Returns:\n        float: The calculated error Δ(E).\n    \"\"\"\n    epsilon_reg = 1e-12\n    t_abs = np.abs(t)\n\n    # --- Wide-Band Limit (WBL) Calculation ---\n    # Reference energy for WBL is E0 = 0.0 eV.\n    # The reference energy E0 falls within the band since eps_0=0 and t=1.\n    if t_abs > 0:\n        E0 = 0.0\n        arg_sqrt_wbl = 4 * t**2 - (E0 - eps_0)**2\n        # WBL constant is based on E0 being in the band.\n        if arg_sqrt_wbl >= 0:\n            Gamma_L0 = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n            Gamma_R0 = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n        else: # E0 is outside the band, all WBL couplings are zero.\n            Gamma_L0 = 0.0\n            Gamma_R0 = 0.0\n    else:\n        Gamma_L0 = 0.0\n        Gamma_R0 = 0.0\n\n    Gamma_sum_0 = Gamma_L0 + Gamma_R0\n    denominator_wbl = (E - eps_d)**2 + (Gamma_sum_0 / 2)**2\n    \n    if np.isclose(denominator_wbl, 0.0):\n        # Avoid division by zero, though unlikely for physical parameters.\n        T_wbl = float('inf') if Gamma_L0 * Gamma_R0 != 0 else 0.0\n    else:\n        T_wbl = (Gamma_L0 * Gamma_R0) / denominator_wbl\n    \n    # --- Exact Calculation ---\n    band_half_width = 2 * t_abs\n    is_in_band = np.abs(E - eps_0)  band_half_width\n\n    if not is_in_band or t_abs == 0:\n        T_exact = 0.0\n    else:\n        # Calculate Γ_α(E)\n        arg_sqrt_exact = 4 * t**2 - (E - eps_0)**2\n        Gamma_L = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_exact)\n        Gamma_R = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_exact)\n\n        # Calculate Σ^r_α(E)\n        # Use numpy.lib.scimath.sqrt to handle complex results automatically\n        # for arguments that are negative.\n        sqrt_term_complex = np.lib.scimath.sqrt((E - eps_0)**2 - 4 * t**2)\n        \n        Sigma_r_surf_factor = ((E - eps_0) - sqrt_term_complex) / (2 * t**2)\n        \n        Sigma_r_L = tau_L**2 * Sigma_r_surf_factor\n        Sigma_r_R = tau_R**2 * Sigma_r_surf_factor\n        \n        Sigma_r_total = Sigma_r_L + Sigma_r_R\n\n        # Calculate G^r(E)\n        G_r = 1.0 / (E - eps_d - Sigma_r_total)\n        \n        # Calculate T_exact(E)\n        T_exact = Gamma_L * Gamma_R * np.abs(G_r)**2\n    \n    # --- Error Calculation ---\n    numerator = np.abs(T_wbl - T_exact)\n    denominator = np.maximum(T_exact, epsilon_reg)\n    delta = numerator / denominator\n    \n    return delta\n\nsolve()\n```"
        },
        {
            "introduction": "掌握了如何为器件连接电极后，我们便可以研究介观器件中的量子干涉现象。本练习将NEGF形式论应用于介观物理学中最著名的现象之一：环状几何结构中的阿哈罗诺夫-玻姆（Aharonov-Bohm）效应。您将计算电导随磁通量的振荡，并引入比蒂克（Büttiker）探针来模拟退相干过程，从而将抽象的NEGF方法与可测量的量子效应具体地联系起来，生动地展示了相位相干性如何引起干涉，以及非弹性散射如何抑制这种干涉 。",
            "id": "3482866",
            "problem": "你的任务是使用非平衡格林函数 (NEGF) 形式理论实现一个计算实验，以研究在表现出 Aharonov–Bohm 振荡的介观环几何结构中的量子输运。该环被建模为一个具有 $N$ 个格点的单带紧束缚晶格，包含最近邻跃迁，并在跃迁项上引入复数 Peierls 相位，以计入穿过环的垂直磁场 $B$ 的影响。两条外部导线连接到环的相对两侧格点上，并通过连接到选定环格点的 Büttiker 电压探针引入退相干。你的程序必须计算以 $2e^2/h$ 为单位的双端电导 $G(B)$，并量化振荡幅度与退相干强度和探针密度的函数关系。\n\n使用的基础理论：\n- 器件区域的推迟格林函数 $G^r(E)$ 定义为\n$$\nG^r(E) = \\left[E + i0^+ - H - \\sum_\\alpha \\Sigma_\\alpha\\right]^{-1},\n$$\n其中 $H$ 是器件的哈密顿量，$\\Sigma_\\alpha$ 是每个终端 $\\alpha$（导线和探针）的自能。\n- 具有最近邻跃迁 $t$ 和每个键上 Peierls 相位 $\\varphi$ 的环上紧束缚哈密顿量为\n$$\nH_{i,i+1} = -t\\, e^{i\\varphi}, \\quad H_{i+1,i} = -t\\, e^{-i\\varphi},\n$$\n满足周期性边界条件 $i+N \\equiv i$，且环上所有键的相位总和为 $\\sum_{\\text{bonds around ring}} \\varphi = 2\\pi \\Phi/\\Phi_0$，其中 $\\Phi = B A$ 是磁通量，$A$ 是环的面积，$\\Phi_0 = h/e$ 是磁通量子。\n- 在宽带极限下，一个以耦合速率 $\\gamma_\\alpha$ 耦合到格点 $i_\\alpha$ 的终端 $\\alpha$ 产生的自能为\n$$\n\\Sigma_\\alpha = -i\\gamma_\\alpha \\, |i_\\alpha\\rangle\\langle i_\\alpha|, \\quad \\Gamma_\\alpha = i\\left(\\Sigma_\\alpha - \\Sigma_\\alpha^\\dagger\\right) = 2\\gamma_\\alpha\\, |i_\\alpha\\rangle\\langle i_\\alpha|.\n$$\n- 在线性响应区，多终端 Landauer–Büttiker 电流关系为\n$$\nI_\\alpha = \\frac{2e^2}{h}\\sum_\\beta T_{\\alpha\\beta}(V_\\alpha - V_\\beta),\n$$\n其中透射率为\n$$\nT_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E)\\,\\Gamma_\\beta G^a(E)\\right],\n$$\n且 $G^a = \\left(G^r\\right)^\\dagger$。在单格点宽带耦合的情况下，此公式简化为\n$$\nT_{\\alpha\\beta}(E) = \\Gamma_\\alpha \\Gamma_\\beta \\left|G^r_{i_\\alpha,i_\\beta}(E)\\right|^2.\n$$\n- Büttiker 探针通过在选定的格点上添加具有耦合强度 $\\eta$ 和未知电势 $V_p$ 的终端来模拟退相干，其中 $V_p$ 通过施加每个探针的净电流为零 ($I_p=0$) 的条件来确定。\n\n你的任务：\n1. 构建一个大小为 $N \\times N$ 的环哈密顿量 $H$，使其具有最近邻跃迁 $t$ 和每个键上均匀的 Peierls 相位，从而使环绕一周累积的总相位等于 $2\\pi\\Phi/\\Phi_0$。使用环半径 $R$ 定义面积 $A=\\pi R^2$。使用周期性边界条件，并将所有在位能设置为 $0$。使用 $t=1$。\n2. 在格点 $i_L=0$ 和 $i_R=N/2$（假设 $N$ 为偶数）处连接两条导线，在宽带极限下用自能 $\\Sigma_L=-i\\gamma\\,|i_L\\rangle\\langle i_L|$ 和 $\\Sigma_R=-i\\gamma\\,|i_R\\rangle\\langle i_R|$ 进行建模，其中 $\\gamma=0.5$。设费米能为 $E_F=0$，并向 $E_F$ 添加一个小的数值正则化项 $i\\delta$，其中 $\\delta=10^{-12}$。\n3. 在指定的环格点子集上添加 Büttiker 探针，其耦合强度为 $\\eta$（宽带，单格点），每个探针贡献一个自能 $\\Sigma_p=-i\\eta\\,|i_p\\rangle\\langle i_p|$ 和展宽 $\\Gamma_p=2\\eta\\,|i_p\\rangle\\langle i_p|$。将它们视为具有未知电势 $V_p$ 的电压探针。通过线性 Landauer–Büttiker 关系施加 $I_p=0$ 的条件来确定 $V_p$。\n4. 对于给定的磁场 $B$，计算推迟格林函数 $G^r(E_F)$ 以及所有终端之间的透射率 $T_{\\alpha\\beta}(E_F)$。建立多终端电流的线性系统，对探针强制施加 $I_p=0$ 的条件，并通过固定 $V_L=+1/2$ 和 $V_R=-1/2$ 来施加源漏偏压。计算无量纲双端电导 $g(B)$，其定义为\n$$\ng(B) = \\frac{I_L}{V_L - V_R},\n$$\n该值等于以 $2e^2/h$ 为单位的 $G(B)$。\n5. 通过将磁场 $B$ 从 $0$ 扫描到 $B_{\\max}=\\Phi_0/A$，并在包括端点在内的 51 个等间距值上评估 $g(B)$，来研究跨越一个磁通量子的 Aharonov–Bohm 振荡。将振荡幅度量化为\n$$\n\\Delta g = \\max_{B\\in[0,B_{\\max}]} g(B) - \\min_{B\\in[0,B_{\\max}]} g(B).\n$$\n6. 使用 Büttiker 探针实现三种不同的退相干配置，以研究振荡幅度对退相干强度和探针密度的依赖性。\n\n物理单位和常数：\n- 使用特斯拉 (Tesla) 作为 $B$ 的单位。\n- 使用米 (meter) 作为 $R$ 的单位，$\\mathrm{m}^2$ 作为面积 $A=\\pi R^2$ 的单位。\n- 使用库仑 (Coulomb) 作为电子电荷 $e$ 的单位，焦耳-秒 (Joule-second) 作为普朗克常数 $h$ 的单位，韦伯 ($\\mathrm{Wb}$) 作为磁通量子 $\\Phi_0=h/e$ 的单位。\n- 以 $2e^2/h$ 为单位，将电导报告为无量纲浮点数。\n\n测试套件规范：\n- 通用参数：$N=40$，$t=1$，$E_F=0$，$\\delta=10^{-12}$，$\\gamma=0.5$，$R=50\\times 10^{-9}\\,\\mathrm{m}$，$i_L=0$，$i_R=20$，$B\\in[0,B_{\\max}]$，包含 $51$ 个点。\n- 情况 A（相干参考）：无探针，$\\eta=0$。\n- 情况 B（弱退相干，稀疏探针）：探针位于 $i_p\\in\\{4,8,12,16,24,28,32,36\\}$，$\\eta=0.05$。\n- 情况 C（强退相干，密集探针）：探针位于除 $i_L$ 和 $i_R$ 外的所有格点，$\\eta=0.5$。\n\n每种情况所需的输出：\n- $B=0$ 时的 $g(0)$，\n- $B=B_{\\max}/2$ 时的 $g(\\Phi_0/2A)$，\n- 在扫描范围 $B\\in[0,B_{\\max}]$ 上的 $\\Delta g$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含以逗号分隔并括在方括号中的结果列表，顺序如下：\n$$\n\\left[g_A(0),\\, g_A(B_{\\max}/2),\\, \\Delta g_A,\\, g_B(0),\\, g_B(B_{\\max}/2),\\, \\Delta g_B,\\, g_C(0),\\, g_C(B_{\\max}/2),\\, \\Delta g_C\\right],\n$$\n其中每个条目都是一个四舍五入到六位小数的浮点数。不应打印任何额外文本。",
            "solution": "该问题要求基于非平衡格林函数 (NEGF) 形式理论实现一个量子输运计算，以研究在受退相干影响的介观环中的 Aharonov-Bohm 效应。解决方案涉及构建系统的哈密顿量，通过自能来计入外部连接，计算格林函数和透射概率，并最终求解双端电导。退相干使用 Büttiker 的电压探针进行建模，这需要为探针电势求解一个自洽问题。\n\n针对每种指定的物理配置，该解决方案通过一系列计算步骤实现：\n\n1.  **系统定义**：器件的核心是一个由紧束缚模型描述的、具有 $N$ 个格点的一维环。大小为 $N \\times N$ 的哈密顿矩阵 $H$ 具有零在位能 ($H_{i,i}=0$) 和大小为 $t$ 的最近邻跃迁项。垂直于环面积 $A$ 的磁场 $B$ 引入了磁通量 $\\Phi = BA$。这通过 Peierls 替换被纳入哈密顿量中，该替换为跃迁项赋予了复数相位。单个键上累积的相位是均匀的，由 $\\varphi = \\frac{2\\pi}{N} \\frac{\\Phi}{\\Phi_0}$ 给出，其中 $\\Phi_0=h/e$ 是磁通量子。因此，哈密顿矩阵元为：\n    $$\n    H_{i,j} =\n    \\begin{cases}\n    -t e^{i\\varphi}    \\text{if } j = (i+1) \\pmod N \\\\\n    -t e^{-i\\varphi}   \\text{if } j = (i-1) \\pmod N \\\\\n    0                  \\text{otherwise}\n    \\end{cases}\n    $$\n    我们设置跃迁能量 $t=1$ 作为能量单位。\n\n2.  **终端自能**：环连接到外部终端：两条导线（源极 $L$ 和漏极 $R$）和一组用于模拟退相干的 Büttiker 电压探针。每个耦合到环上单个格点 $i_\\alpha$ 的终端 $\\alpha$ 对系统贡献一个自能项 $\\Sigma_\\alpha$。在宽带近似下，此自能是局域的且为纯虚数：\n    $$\n    \\Sigma_\\alpha = -i\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|\n    $$\n    其中 $|i_\\alpha\\rangle$ 是格点 $i_\\alpha$ 的基矢量，$\\gamma_\\alpha$ 是耦合强度。对于导线，耦合强度为 $\\gamma=0.5$；对于探针，耦合强度为 $\\eta$。总自能矩阵 $\\Sigma$ 是所有终端贡献的总和：$\\Sigma = \\sum_\\alpha \\Sigma_\\alpha$。\n\n3.  **推迟格林函数**：NEGF 形式理论中的核心量是推迟格林函数 $G^r(E)$，它描述了能量为 $E$ 的电子在器件中的传播。它是通过对代表开放系统有效哈密顿量的矩阵求逆得到的：\n    $$\n    G^r(E) = \\left[ (E + i\\delta)I - H - \\Sigma \\right]^{-1}\n    $$\n    此处，$I$ 是单位矩阵，$\\delta$ 是一个无穷小的正数（在此实现中为 $10^{-12}$），用以确保格林函数的“推迟”性质。所有计算都在费米能 $E=E_F=0$ 处进行。\n\n4.  **透射概率**：电子从终端 $\\beta$ 透射到终端 $\\alpha$ 的概率由 Landauer-Büttiker 公式给出：\n    $$\n    T_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E) \\Gamma_\\beta G^a(E)\\right]\n    $$\n    其中 $G^a(E) = (G^r(E))^\\dagger$ 是超前格林函数，$\\Gamma_\\alpha(E) = i(\\Sigma_\\alpha(E) - \\Sigma_\\alpha^\\dagger(E))$ 是描述电子逸出到终端 $\\alpha$ 速率的展宽函数。对于我们的单格点宽带耦合模型，这简化为 $\\Gamma_\\alpha = 2\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|$，并且透射公式简化为：\n    $$\n    T_{\\alpha\\beta} = (2\\gamma_\\alpha)(2\\gamma_\\beta) \\left|G^r_{i_\\alpha, i_\\beta}\\right|^2\n    $$\n    其中 $G^r_{i_\\alpha, i_\\beta}$ 是位于终端 $\\alpha$ 和 $\\beta$ 的耦合格点之间的格林函数矩阵元。\n\n5.  **Büttiker 探针与退相干**：退相干过程将电子散射到不同的动量态之间，从而破坏相位相干性。Büttiker 的模型通过引入不汲取净电流的虚拟电压探针来模拟这一过程。对于每个探针 $p$，必须满足条件 $I_p=0$。根据多终端 Landauer 公式，进入终端 $\\alpha$ 的电流为 $I_\\alpha = \\frac{2e^2}{h} \\sum_{\\beta \\neq \\alpha} T_{\\alpha\\beta} (V_\\alpha - V_\\beta)$。对所有探针 $p$ 施加 $I_p=0$ 的条件，会为未知的探针电势 $V_p$ 生成一个线性方程组：\n    $$\n    \\sum_{\\beta \\neq p} T_{p\\beta} (V_p - V_\\beta) = 0 \\quad \\implies \\quad \\left(\\sum_{\\beta \\neq p} T_{p\\beta}\\right) V_p - \\sum_{\\beta \\neq p, \\text{probe}} T_{p\\beta} V_\\beta = T_{pL}V_L + T_{pR}V_R\n    $$\n    在给定固定导线电势 $V_L = +1/2$ 和 $V_R = -1/2$ 的情况下，构建并求解此线性系统，以获得探针电势矢量 $\\{V_p\\}$。\n\n6.  **电导计算**：一旦所有终端电势都已知，就可以计算从源极导线流出的电流 $I_L$。以 $2e^2/h$ 为单位的无量纲电导 $g(B)$ 则由下式给出：\n    $$\n    g(B) = \\frac{I_L / (2e^2/h)}{V_L - V_R} = \\sum_{\\beta \\neq L} T_{L\\beta}(V_L - V_\\beta)\n    $$\n    因为我们定义 $V_L - V_R = 1$。\n\n7.  **Aharonov-Bohm 振荡分析**：为观察 Aharonov-Bohm 效应，需要对一系列磁场值重复整个计算过程。磁场 $B$ 从 $0$ 扫描到 $B_{\\max} = \\Phi_0/A$，这对应于将穿过环的磁通量 $\\Phi$ 从 $0$ 扫描到一个磁通量子 $\\Phi_0$。此扫描在 51 个等间距点上执行。每个点的电导 $g(B)$ 都会被存储。从得到的曲线上，提取所需的量：$g(0)$、$g(B_{\\max}/2)$ 以及振荡幅度 $\\Delta g = \\max(g) - \\min(g)$。此过程针对问题陈述中指定的三种不同退相干配置执行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L, V_R):\n    \"\"\"\n    Computes the two-terminal dimensionless conductance for a mesoscopic ring.\n\n    This function implements the NEGF formalism for a tight-binding ring with leads and\n    Büttiker probes, calculating the conductance for a given magnetic flux.\n    \"\"\"\n    # 1. Construct the tight-binding Hamiltonian H for the ring\n    H = np.zeros((N, N), dtype=complex)\n    phase = (2 * np.pi / N) * flux_ratio\n    exp_phase = np.exp(1j * phase)\n    \n    for i in range(N - 1):\n        H[i, i + 1] = -t * exp_phase\n        H[i + 1, i] = -t * np.conj(exp_phase)\n    # Periodic boundary conditions for the ring\n    H[N - 1, 0] = -t * exp_phase\n    H[0, N - 1] = -t * np.conj(exp_phase)\n    \n    # 2. Construct the total self-energy matrix Sigma from all terminals\n    Sigma = np.zeros((N, N), dtype=complex)\n    Sigma[i_L, i_L] = -1j * gamma\n    Sigma[i_R, i_R] = -1j * gamma\n    for p_site in probe_sites:\n        Sigma[p_site, p_site] -= 1j * eta\n        \n    # 3. Calculate the retarded Green's function G^r\n    E = E_F + 1j * delta\n    G_r = np.linalg.inv(E * np.eye(N) - H - Sigma)\n    \n    # 4. Define terminals and calculate the transmission matrix T\n    terminals = [(i_L, gamma), (i_R, gamma)] + [(p, eta) for p in probe_sites]\n    num_terminals = len(terminals)\n    T = np.zeros((num_terminals, num_terminals))\n\n    for alpha in range(num_terminals):\n        for beta in range(alpha + 1, num_terminals):\n            i_alpha, gamma_alpha = terminals[alpha]\n            i_beta, gamma_beta = terminals[beta]\n            \n            trans = 4 * gamma_alpha * gamma_beta * np.abs(G_r[i_alpha, i_beta])**2\n            T[alpha, beta] = trans\n            T[beta, alpha] = trans\n\n    # 5. Solve for probe voltages if probes are present\n    num_probes = len(probe_sites)\n    if num_probes == 0:\n        # For the coherent case with no probes, conductance is simply T_LR\n        g = T[0, 1]\n        return g\n\n    # Set up and solve the linear system for probe potentials\n    A_matrix = np.zeros((num_probes, num_probes))\n    b_vector = np.zeros(num_probes)\n    \n    # Terminal indices: L=0, R=1, probes=2 to num_probes+1\n    for k in range(num_probes):  # Matrix row index, corresponding to probe k\n        alpha = k + 2  # Terminal index for probe k\n        \n        # Right-hand side of the linear system\n        b_vector[k] = T[alpha, 0] * V_L + T[alpha, 1] * V_R\n        \n        # Left-hand side matrix A\n        A_matrix[k, k] = np.sum(T[alpha, :]) # On-diagonal: sum of transmissions from probe\n        for m in range(num_probes): # Matrix column index\n            if k != m:\n                beta = m + 2 # Terminal index for probe m\n                A_matrix[k, m] = -T[alpha, beta]\n            \n    probe_voltages = np.linalg.solve(A_matrix, b_vector)\n    \n    # 6. Calculate the final two-terminal conductance\n    all_voltages = np.zeros(num_terminals)\n    all_voltages[0] = V_L\n    all_voltages[1] = V_R\n    all_voltages[2:] = probe_voltages\n    \n    # Calculate dimensionless current into lead L (index 0)\n    i_L_dim = 0.0\n    for beta in range(1, num_terminals):\n        i_L_dim += T[0, beta] * (all_voltages[0] - all_voltages[beta])\n        \n    g = i_L_dim  # Since V_L - V_R = 1\n    return g\n\ndef solve():\n    \"\"\"\n    Main function to run the quantum transport experiment for all test cases.\n    \"\"\"\n    # Common physical and numerical parameters\n    N = 40\n    t = 1.0\n    E_F = 0.0\n    delta = 1e-12\n    gamma = 0.5\n    i_L = 0\n    i_R = 20\n    V_L_bias = 0.5\n    V_R_bias = -0.5\n    \n    # Magnetic field sweep parameters\n    num_b_points = 51\n    # We sweep the dimensionless flux ratio Phi/Phi_0 from 0 to 1.\n    flux_ratios = np.linspace(0.0, 1.0, num_b_points)\n\n    # Define the three test cases as specified\n    probe_sites_C = [i for i in range(N) if i not in [i_L, i_R]]\n    test_cases = [\n        {'name': 'A', 'probe_sites': [], 'eta': 0.0},\n        {'name': 'B', 'probe_sites': [4, 8, 12, 16, 24, 28, 32, 36], 'eta': 0.05},\n        {'name': 'C', 'probe_sites': probe_sites_C, 'eta': 0.5}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        probe_sites = case['probe_sites']\n        eta = case['eta']\n        \n        g_values = []\n        for flux_ratio in flux_ratios:\n            g = calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L_bias, V_R_bias)\n            g_values.append(g)\n            \n        g_values = np.array(g_values)\n        \n        # Extract required results for the current case\n        g_zero_flux = g_values[0]  # B=0 corresponds to flux_ratio=0\n        # B = B_max/2 corresponds to flux_ratio=0.5. Index is (51-1)/2 = 25.\n        g_half_flux = g_values[25]\n        delta_g = np.max(g_values) - np.min(g_values)\n        \n        results.extend([g_zero_flux, g_half_flux, delta_g])\n\n    # Print the final results in the required format\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了计算具体的输运性质，NEGF形式论还必须遵循基本的物理定律，例如输运系数的对称性。本练习要求您在一个多端子霍尔棒（Hall bar）几何结构中，数值验证作为非平衡热力学基石的昂萨格-卡西米尔（Onsager-Casimir）倒易关系：$T_{pq}(B) = T_{qp}(-B)$。更重要的是，本练习还将引导您探究非物理的建模选择（例如，非厄米哈密顿量）如何破坏这一基本对称性，从而加深您对NEGF数学结构（如厄米性和解析性）与基本物理原理之间深刻联系的理解 。",
            "id": "3482888",
            "problem": "您被要求设计并实现一个数值实验，使用非平衡格林函数（NEGF）形式主义来评估多端紧束缚器件中相干量子输运的微观可逆性，并探究由非保守离散化或不对称引线自能实现引起的偏差。\n\n您必须基于固态量子输运中的以下基本原理进行操作：\n- 一个开放器件的非平衡格林函数（NEGF）推迟格林函数 $G^{r}$ 和超前格林函数 $G^{a}$，由包含引线（通过自能）的开放边界哈密顿量的算符逆来定义。\n- 每个半无限长引线向器件哈密顿量贡献一个推迟自能 $\\Sigma_{p}^{r}$，其展宽矩阵为 $\\Gamma_{p} = i \\left(\\Sigma_{p}^{r} - \\left(\\Sigma_{p}^{r}\\right)^{\\dagger}\\right)$。\n- 在能量 $E$ 时，从引线 $q$ 到引线 $p$ 的透射率由 Caroli 公式定义：$T_{pq}(E) = \\mathrm{Tr} \\left[ \\Gamma_{p} G^{r} \\Gamma_{q} G^{a} \\right]$。\n- 在存在磁场 $B$ 的情况下，对于无相互作用的相干输运，微观可逆性（Onsager–Casimir 对称性）指出，在时间反演不变性下，对于所有引线 $p \\neq q$，有 $T_{pq}(B) = T_{qp}(-B)$。\n\n您的任务：\n- 为一个尺寸为 $L_{x} \\times L_{y}$、具有最近邻跃迁的方形晶格器件实现一个相干输运模拟器。使用 Peierls 替代方法，通过每个晶胞的无量纲磁通量 $f$（即磁通量子的一个分数）来引入一个均匀垂直磁场。使用朗道规范，使得 $y$ 方向的跃迁获得一个相位因子 $\\exp\\left(i 2 \\pi f x\\right)$，其中 $x \\in \\{0,1,\\dots,L_{x}-1\\}$ 标记沿 $x$ 方向的晶格坐标。\n- 将四根半无限长引线连接到器件的左、右、底和顶部边缘。将每根引线建模为一组解耦的半无限长一维链（每个边缘格点一条），其在位能与器件在位能相等，最近邻跃迁强度与器件跃迁强度大小相等。从每个边缘器件格点到其引线的耦合应等于该边缘处缺失的键。对于垂直边缘，在界面处的耦合中包含适当的 Peierls 相位，使得耦合振幅为 $v=-t \\exp\\left(\\pm i 2 \\pi f x\\right)$，符号由外法线方向决定，但请注意，$\\Sigma_{p}^{r}$ 依赖于 $|v|^{2}$，因此在保守实现中，其对角元与该相位无关。\n- 通过求解表面格林函数的二次不动点方程，计算半无限长一维链的推迟和超前表面格林函数，并根据虚部的符号选择推迟或超前分支。在能量上添加一个正无穷小量 $i \\eta$（其中 $\\eta  0$）以选择外行边界条件。\n- 构建器件的推迟和超前格林函数，并在单一能量 $E$ 下计算所有 $p \\neq q$ 的透射率 $T_{pq}$。\n\n微观可逆性检查：\n- 对于给定的磁通量 $f$ 及其反向 $-f$，计算透射矩阵 $\\{T_{pq}(f)\\}$ 和 $\\{T_{pq}(-f)\\}$，并返回最大绝对偏差\n$$\\Delta(f) = \\max_{p \\neq q} \\left| T_{pq}(f) - T_{qp}(-f) \\right|.$$\n- 一个正确的保守且对称的实现应在舍入误差范围内得出数值上接近于 $0$ 的 $\\Delta(f)$。\n\n偏差实验：\n- 实现两种受控偏差：\n  1. 一种非保守离散化，通过使用不对称的前向/后向跃迁 $-t$ 和 $-(t+\\delta)$（其中 $\\delta  0$），使器件哈密顿量沿 $x$ 方向变为非厄米的，同时保持 $y$ 方向在 Peierls 相位下是保守的。这应该会虚假地违反微观可逆性并增加 $\\Delta(f)$。\n  2. 一种不对称引线自能实现，其中一个选定的引线使用超前（而非推迟）表面格林函数来构建其自能。这种非物理的选择违反了解析性，并应增加 $\\Delta(f)$。\n\n所有运行中使用的数值和物理参数：\n- 晶格尺寸：$L_{x} = L_{y} = 3$。\n- 最近邻跃迁强度：$t = 1$。\n- 在位能：$u = 0$。\n- 能量：$E = 0$。\n- 无穷小展宽：$\\eta = 1 \\times 10^{-9}$。\n- 磁通量值：$f \\in \\{0, 0.08\\}$。\n- 用于非保守离散化的不对称参数：$\\delta = 0.1$。\n\n测试套件：\n- 情况1（正常路径，有限场）：保守器件，所有引线均为推迟自能，在 $f = 0.08$ 时。\n- 情况2（边界情况，零场）：保守器件，所有引线均为推迟自能，在 $f = 0$ 时。\n- 情况3（非保守离散化）：器件具有不对称的 x-跃迁（$\\delta = 0.1$），所有引线均为推迟自能，在 $f = 0.08$ 时。\n- 情况4（不对称引线自能）：保守器件，但顶部引线使用其表面格林函数的超前分支（其他引线为推迟），在 $f = 0.08$ 时。\n\n计算和输出内容：\n- 对于每种情况，计算上面定义的标量 $\\Delta(f)$。您的程序必须生成单行输出，其中包含这四个标量结果，按情况1到4的顺序以逗号分隔的列表形式，并用方括号括起来，即 $[\\Delta_{1},\\Delta_{2},\\Delta_{3},\\Delta_{4}]$。\n- 所有量均为无量纲；不需要物理单位。\n- 角度（在适用作相位时），根据复指数的构造，以弧度为单位。\n\n约束：\n- 不要为最终的微观可逆性属性硬编码任何快捷表达式。您的实现必须从上述的推迟和超前格林函数、自能、展宽和透射公式的定义出发。\n- 通过无穷小量 $i \\eta$ 和对表面格林函数根的显式分支选择，确保数值稳定地选择推迟或超前分支。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4]”）。",
            "solution": "用户提供了一个问题，要求使用非平衡格林函数（NEGF）形式主义对介观器件中的量子输运进行数值模拟。问题的核心是为一个保守系统验证微观可逆性原理 $T_{pq}(B) = T_{qp}(-B)$，并在特定的非物理条件下展示其被违反的情况。\n\n### 步骤 1：提取已知条件\n\n- **系统**：一个 $L_x \\times L_y$ 大小的二维紧束缚模型，位于方形晶格上，四条半无限长引线连接到其边缘（左、右、底、顶）。\n- **物理参数**：\n    - 晶格尺寸：$L_x = 3, L_y = 3$。\n    - 最近邻跃迁强度：$t = 1$。\n    - 在位能：$u = 0$。\n    - 用于透射率计算的能量：$E = 0$。\n    - 用于格林函数的无穷小展宽：$\\eta = 1 \\times 10^{-9}$。\n- **磁场**：通过 Peierls 替代引入一个均匀垂直磁场，由每个晶胞的无量纲磁通量 $f$ 表示。在朗道规范中，从水平坐标 $x$ 处的格点出发、沿 $+y$ 方向的跃迁积分获得一个相位因子 $\\exp(i 2 \\pi f x)$。\n- **引线模型**：每根引线由连接到相应器件边缘上每个格点的解耦一维半无限长链组成。引线的在位能和跃迁与器件参数相匹配。\n- **NEGF 定义**：\n    - 推迟/超前格林函数：$G^{r}, G^{a}$。\n    - 引线自能：$\\Sigma_{p}^{r}$。由一维链的表面格林函数计算得出。\n    - 展宽矩阵：$\\Gamma_{p} = i \\left(\\Sigma_{p}^{r} - (\\Sigma_{p}^{r})^{\\dagger}\\right)$。\n    - 透射公式（Caroli）：$T_{pq}(E) = \\mathrm{Tr} \\left[ \\Gamma_{p} G^{r} \\Gamma_{q} G^{a} \\right]$。\n- **微观可逆性检查**：计算最大偏差 $\\Delta(f) = \\max_{p \\neq q} \\left| T_{pq}(f) - T_{qp}(-f) \\right|$。\n- **偏差情景**：\n    1.  **非保守离散化**：在 x 方向使用不对称跃迁元 $-t$ 和 $-(t+\\delta)$（其中 $\\delta = 0.1$）进行跃迁。这使得器件哈密顿量非厄米。\n    2.  **不对称引线自能**：对于顶部引线，其自能使用超前表面格林函数 $g_s^a$ 而非推迟的 $g_s^r$ 来构建。\n- **测试用例**：\n    1.  保守系统（$\\delta=0$，所有引线均为推迟），$f = 0.08$。\n    2.  保守系统（$\\delta=0$，所有引线均为推迟），$f = 0$。\n    3.  非保守系统（$\\delta = 0.1$），$f = 0.08$。\n    4.  顶部引线自能不对称，$f = 0.08$。\n- **输出**：包含四个计算出的 $\\Delta$ 值的单行文本，以逗号分隔并用方括号括起来：$[\\Delta_1, \\Delta_2, \\Delta_3, \\Delta_4]$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n这个问题是计算凝聚态物理学中一个标准的、定义明确的练习。\n- **科学上合理**：该问题建立在已有的 NEGF 形式主义、紧束缚模型和用于磁场的 Peierls 替代方法之上。这些是固态物理和介观物理中的基本概念。偏差实验旨在探究理论背后的物理假设（例如，厄米性、因果性/解析性）。\n- **良态的**：所有必需的参数（$L_x, L_y, t, u, E, \\eta, f, \\delta$）和定义都已提供。目标——计算四种不同情况下的 $\\Delta(f)$——是清晰明确的。每种情况都存在唯一的数值解。\n- **客观性**：问题以精确、技术性的语言陈述，没有主观性或模糊性。\n\n该问题通过了所有验证标准。它在科学上不是不合理的、不完整的、矛盾的、不切实际的或病态的。它代表了一个概念上合理且计算上可行的问题。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。将根据指定的原则和参数开发一个解决方案。\n\n### 基于原则的设计\n\n解决方案将构建为一组函数，每个函数负责一个不同的物理或计算步骤，以反映 NEGF 形式主义的结构。\n\n1.  **系统和格点索引**：$L_x \\times L_y = 3 \\times 3$ 的器件有 $N=9$ 个格点。建立从二维晶格坐标 $(i_x, i_y)$ 到一维矩阵索引 $k$ 的映射，使用 $k = i_y \\cdot L_x + i_x$。\n\n2.  **表面格林函数**：半无限长引线的自能需要一维紧束缚链的表面格林函数 $g_s$。这通过求解二次方程 $t^2 g_s^2 - (E - u + i\\eta) g_s + 1 = 0$ 得到。两个根对应于推迟（$g_s^r$，其中 $\\mathrm{Im}(g_s^r)  0$）和超前（$g_s^a$，其中 $\\mathrm{Im}(g_s^a) > 0$）分支。一个函数将解此方程并返回两个分支。\n\n3.  **器件哈密顿量构建**：构建一个 $N \\times N$ 的矩阵 $H$。\n    - **x方向跃迁**：对于保守器件（$\\delta=0$），相邻格点间的跃迁为 $-t$。对于非保守情况，从 $x$ 到 $x+1$ 的跃迁为 $-(t+\\delta)$，从 $x+1$ 到 $x$ 的跃迁为 $-t$，导致一个非厄米矩阵 $H \\neq H^{\\dagger}$。\n    - **y方向跃迁**：从 $(i_x, i_y)$ 到 $(i_x, i_y+1)$ 的跃迁包含 Peierls 相位因子，给出一个矩阵元 $-t \\exp(i 2\\pi f i_x)$。其共轭元确保哈密顿量的这部分是厄米的。性质 $H(-f) = H(f)^T$ 对微观可逆性至关重要。\n\n4.  **引线自能**：构建四个 $N \\times N$ 的自能矩阵 $\\Sigma_p$（$p \\in \\{0,1,2,3\\}$ 分别对应左、右、底、顶）。每个矩阵在格点基底下都是对角的。对于边缘上的格点 $k$，自能为 $\\Sigma_{p,kk} = |v|^2 g_s$，其中 $|v|^2=t^2$ 是耦合强度的平方，$g_s$ 是表面格林函数。\n    - 在标准情况下，使用 $g_s = g_s^r$。\n    - 在情况4中，对于顶部引线（$p=3$），使用 $g_s=g_s^a$，这违反了推迟自能的解析性要求。\n\n5.  **器件格林函数**：\n    - 通过矩阵求逆计算推迟格林函数：$G^r = [ (E+i\\eta)I - H - \\sum_p \\Sigma_p ]^{-1}$。\n    - 超前格林函数是其厄米共轭：$G^a = (G^r)^{\\dagger}$。这一定义关系正确地传播了 $H$ 或 $\\Sigma$ 中任何非物理性所带来的后果。\n\n6.  **展宽和透射率**：\n    - 根据定义计算展宽矩阵：$\\Gamma_p = i(\\Sigma_p - \\Sigma_p^{\\dagger})$。对于标准的推迟自能，$\\Gamma_p$ 是半正定的。对于情况4中的非物理自能，相应的 $\\Gamma_3$ 变为负定的，代表非物理的粒子增益。\n    - 使用 Caroli 公式计算透射率 $T_{pq}$，$T_{pq} = \\mathrm{Tr}(\\Gamma_p G^r \\Gamma_q G^a)$。迹运算产生实值的透射概率。\n\n7.  **微观可逆性检查**：对给定的磁通量 $f$ 及其反向 $-f$ 执行整个计算，以获得透射矩阵 $\\{T_{pq}(f)\\}$ 和 $\\{T_{pq}(-f)\\}$。通过取所有不同引线对 $p \\neq q$ 的最大绝对差 $|T_{pq}(f) - T_{qp}(-f)|$ 来找到最终偏差 $\\Delta(f)$。\n\n这种分步实现将问题陈述中的物理定义直接转化为数值算法，确保不走捷径，并且核心物理被显式建模。对于“正常路径”情况（1和2），$\\Delta(f)$ 预计接近机器精度。对于偏差情况（3和4），对厄米性或解析性的违反破坏了内在的对称性，导致数值上显著的非零 $\\Delta(f)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import inv\n\ndef solve():\n    \"\"\"\n    Main function to run the NEGF simulation for the four test cases\n    and check microreversibility.\n    \"\"\"\n\n    # --- Physical and numerical parameters from the problem statement ---\n    LX, LY = 3, 3\n    T_HOP = 1.0\n    U_ONSITE = 0.0\n    E_ENERGY = 0.0\n    ETA = 1e-9\n    DELTA = 0.1\n    FLUX_VALUES = {'case1': 0.08, 'case2': 0.0, 'case3': 0.08, 'case4': 0.08}\n\n    def get_surface_green_function(t_hop, E, u, eta):\n        \"\"\"\n        Solves the quadratic equation for the 1D semi-infinite lead's \n        surface Green's function (g_s).\n        \n        The equation is t_hop^2 * g_s^2 - (E - u + i*eta) * g_s + 1 = 0.\n        \n        Returns:\n            (g_r, g_a): Retarded (Im  0) and advanced (Im > 0) solutions.\n        \"\"\"\n        complex_E = E - u + 1j * eta\n        \n        # Coefficients of the quadratic equation a*x^2 + b*x + c = 0\n        a = t_hop**2\n        b = -complex_E\n        c = 1.0\n        \n        discriminant_sqrt = np.sqrt(b**2 - 4 * a * c, dtype=np.complex128)\n        \n        g1 = (-b + discriminant_sqrt) / (2 * a)\n        g2 = (-b - discriminant_sqrt) / (2 * a)\n        \n        # The retarded branch has a negative imaginary part, advanced has a positive one.\n        g_r = g1 if g1.imag  0 else g2\n        g_a = g1 if g1.imag > 0 else g2\n        \n        return g_r, g_a\n\n    def build_hamiltonian(Lx, Ly, t_hop, f, delta):\n        \"\"\"\n        Builds the device Hamiltonian matrix H for a given flux f.\n        The parameter delta introduces non-Hermitian x-hopping if non-zero.\n        \"\"\"\n        N = Lx * Ly\n        H = np.zeros((N, N), dtype=np.complex128)\n        \n        for iy in range(Ly):\n            for ix in range(Lx):\n                k = iy * Lx + ix\n                \n                # Hopping in x-direction (to the right neighbor)\n                if ix  Lx - 1:\n                    k_right = k + 1\n                    H[k, k_right] = -(t_hop + delta)  # Asymmetric hopping\n                    H[k_right, k] = -t_hop\n                \n                # Hopping in y-direction (to the top neighbor) with Peierls phase\n                if iy  Ly - 1:\n                    k_up = k + Lx\n                    phase = np.exp(1j * 2 * np.pi * f * ix)\n                    H[k, k_up] = -t_hop * phase\n                    H[k_up, k] = -t_hop * np.conj(phase)\n        return H\n\n    def build_self_energies(Lx, Ly, t_hop, E, u, eta, asymmetric_lead_idx):\n        \"\"\"\n        Builds the self-energy matrices for the 4 leads.\n        Leads indexed as 0:left, 1:right, 2:bottom, 3:top.\n        If asymmetric_lead_idx is specified, that lead uses g_s^a instead of g_s^r.\n        \"\"\"\n        N = Lx * Ly\n        g_r, g_a = get_surface_green_function(t_hop, E, u, eta)\n        \n        sigmas = [np.zeros((N, N), dtype=np.complex128) for _ in range(4)]\n        v_sq = t_hop**2\n        \n        # Determine which surface Green's function to use for each lead\n        g_s_choices = [g_r] * 4\n        if asymmetric_lead_idx != -1:\n            g_s_choices[asymmetric_lead_idx] = g_a\n\n        # Lead 0 (left edge, x=0)\n        for iy in range(Ly):\n            k = iy * Lx + 0\n            sigmas[0][k, k] = v_sq * g_s_choices[0]\n            \n        # Lead 1 (right edge, x=Lx-1)\n        for iy in range(Ly):\n            k = iy * Lx + (Lx - 1)\n            sigmas[1][k, k] = v_sq * g_s_choices[1]\n            \n        # Lead 2 (bottom edge, y=0)\n        for ix in range(Lx):\n            k = 0 * Lx + ix\n            sigmas[2][k, k] = v_sq * g_s_choices[2]\n            \n        # Lead 3 (top edge, y=Ly-1)\n        for ix in range(Ly):\n            k = (Ly - 1) * Lx + ix\n            sigmas[3][k, k] = v_sq * g_s_choices[3]\n            \n        return sigmas\n\n    def compute_transmission_matrix(f, delta, asymmetric_lead_idx):\n        \"\"\"\n        Computes the full transmission matrix T_pq for a given set of parameters.\n        \"\"\"\n        N = LX * LY\n        \n        H = build_hamiltonian(LX, LY, T_HOP, f, delta)\n        \n        sigmas = build_self_energies(LX, LY, T_HOP, E_ENERGY, U_ONSITE, ETA, asymmetric_lead_idx)\n        sigma_total = sum(sigmas)\n        \n        # Retarded Green's function\n        complex_E = E_ENERGY - U_ONSITE + 1j * ETA\n        G_r = inv(complex_E * np.identity(N) - H - sigma_total)\n        \n        # Advanced Green's function\n        G_a = G_r.conj().T\n        \n        # Broadening matrices\n        gammas = [1j * (s - s.conj().T) for s in sigmas]\n        \n        # Transmission T_pq = Tr(Gamma_p * G_r * Gamma_q * G_a)\n        num_leads = 4\n        T_matrix = np.zeros((num_leads, num_leads))\n        for p in range(num_leads):\n            for q in range(num_leads):\n                if p != q:\n                    # Use @ for matrix multiplication\n                    prod = gammas[p] @ G_r @ gammas[q] @ G_a\n                    T_matrix[p, q] = np.trace(prod).real\n        return T_matrix\n\n    def calculate_delta(f, delta, asymmetric_lead_idx):\n        \"\"\"\n        Calculates the microreversibility deviation Delta(f).\n        \"\"\"\n        T_f_pos = compute_transmission_matrix(f, delta, asymmetric_lead_idx)\n        T_f_neg = compute_transmission_matrix(-f, delta, asymmetric_lead_idx)\n        \n        max_dev = 0.0\n        num_leads = 4\n        for p in range(num_leads):\n            for q in range(num_leads):\n                if p != q:\n                    dev = np.abs(T_f_pos[p, q] - T_f_neg[q, p])\n                    if dev > max_dev:\n                        max_dev = dev\n        return max_dev\n\n    # --- Define and run test cases ---\n    test_cases = [\n        # Case 1 (happy path, finite field): conservative, f = 0.08\n        {'f': FLUX_VALUES['case1'], 'delta': 0.0, 'asym_idx': -1},\n        # Case 2 (boundary, zero field): conservative, f = 0\n        {'f': FLUX_VALUES['case2'], 'delta': 0.0, 'asym_idx': -1},\n        # Case 3 (non-conservative discretization): asymmetric hopping, f = 0.08\n        {'f': FLUX_VALUES['case3'], 'delta': DELTA, 'asym_idx': -1},\n        # Case 4 (asymmetric lead self-energy): top lead uses g_s^a, f = 0.08\n        {'f': FLUX_VALUES['case4'], 'delta': 0.0, 'asym_idx': 3},\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_val = calculate_delta(case['f'], case['delta'], case['asym_idx'])\n        results.append(delta_val)\n\n    # --- Final print statement in the exact required format ---\n    # Using scientific notation to handle both small and large values consistently.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}