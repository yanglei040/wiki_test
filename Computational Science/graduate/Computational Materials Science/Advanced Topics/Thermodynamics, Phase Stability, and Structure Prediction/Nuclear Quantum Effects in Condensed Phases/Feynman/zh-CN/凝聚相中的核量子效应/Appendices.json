{
    "hands_on_practices": [
        {
            "introduction": "在路径积分模拟中，一个核心任务是计算诸如动能和势能之类的量子可观测量。质心正则系综能量估计量 (centroid virial estimator) 是一个在凝聚相系统中计算量子动能的强大工具。本练习将通过一个可精确求解的简谐振子模型，引导您推导并实现该估计量，并将其结果与量子统计力学的精确解进行比较，从而深刻理解其理论基础和实际应用 。",
            "id": "3430032",
            "problem": "在凝聚相中，一维核自由度通常可以局部近似为一个谐波环境，其势能为 $V(q)=\\frac{1}{2}k q^2$，其中 $q$ 是核坐标，$k$ 是有效弹簧常数，核质量为 $m$。在路径积分分子动力学 (Path Integral Molecular Dynamics, PIMD) 中，核量子效应由一个经典同构表示，该同构包含 $P$ 个由谐波弹簧连接的珠子，弹簧频率为 $\\omega_{P}=\\frac{P}{\\beta \\hbar}$，其中 $\\beta=\\frac{1}{k_{\\mathrm{B}}T}$，$T$ 是温度，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\hbar$ 是约化普朗克常数。量子动能的质心维里估计量源于应用于环状聚合物表示的维里定理，它在有限 $P$ 值下提供了一个无偏估计量，并在 $P \\to \\infty$ 时收敛到精确的量子动能。\n\n从一维单个粒子的正则配分函数 $Z=\\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$（其哈密顿量为 $\\hat{H}=\\frac{\\hat{p}^2}{2m}+V(\\hat{q})$）出发，利用路径积分表示和环状聚合物同构中的维里定理，推导在谐波势 $V(q)=\\frac{1}{2}k q^2$ 这一特殊情况下动能的质心维里估计量的表达式。然后，展示该估计量与谐振子的精确量子期望值之间的关系，并陈述动能、势能和总能量相应的闭式表达式。请谨慎处理自由粒子极限 $k\\to 0$ 并给出其极限表达式。\n\n你的任务是实现一个完整、可运行的程序，对以下测试套件中的每组参数，计算：\n- 使用专门针对谐波势的质心维里估计量计算的量子动能，\n- 量子势能，\n- 量子总能量。\n\n所有能量必须以焦耳 (J) 为单位表示。对于自由粒子极限 ($k=0$)，请使用正确的极限表达式。程序不得读取任何输入；它应在内部包含参数集。\n\n测试套件（每个案例以 $(m,k,T)$ 形式给出）：\n- 案例1：($m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K}$)\n- 案例2：($m=\\;3.343583719\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K}$)\n- 案例3：($m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;0\\;\\mathrm{N/m},\\;T=\\;300\\;\\mathrm{K}$)\n- 案例4：($m=\\;1.67262192369\\times 10^{-27}\\;\\mathrm{kg},\\;k=\\;500\\;\\mathrm{N/m},\\;T=\\;5000\\;\\mathrm{K}$)\n\n覆盖性设计：\n- 案例1探测的是在室温下处于刚性谐波环境中且核量子效应很强的轻核。\n- 案例2通过增加质量（近似于氘核）来减弱量子效应，同时保持$k$和$T$不变。\n- 案例3是自由粒子极限（$k=0$），用于测试估计量的极限行为。\n- 案例4是接近经典极限的高温区。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素对应一个测试案例，并且本身也是一个用方括号括起来的逗号分隔子列表，按 $[\\text{动能},\\text{势能},\\text{总能}]$ 的顺序列出三种能量（单位为焦耳）。例如：$[[E_{K}^{(1)},E_{V}^{(1)},E_{\\mathrm{tot}}^{(1)}],[E_{K}^{(2)},E_{V}^{(2)},E_{\\mathrm{tot}}^{(2)}],\\ldots]$。",
            "solution": "该问题要求推导并实现计算公式，用于求解质量为 $m$ 的单个粒子在一维谐波势 $V(q)=\\frac{1}{2}k q^2$ 中、温度为 $T$ 时的量子动能、势能和总能量。推导过程置于路径积分分子动力学 (PIMD) 框架下，特别要求使用动能的质心维里估计量，并阐明其与精确量子期望值的关系。\n\n所述问题具有科学依据、良置且客观。所有参数都具有物理意义，而 PIMD、质心维里估计量和量子谐振子的概念是现代凝聚相量子动力学的基石。因此，该问题被认定为**有效的**。\n\n解决方案首先推导一维量子谐振子 (QHO) 能量分量的精确量子统计力学期望值。然后，我们基于质心维里估计量对谐波系统的性质，证明使用这些精确公式是合理的。最后，我们仔细处理弹簧常数 $k=0$ 的自由粒子特殊情况。\n\n**1. 量子谐振子的能量期望值 ($k > 0$)**\n\n一维量子谐振子的哈密顿量由下式给出：\n$$ \\hat{H} = \\frac{\\hat{p}^2}{2m} + \\frac{1}{2}k\\hat{q}^2 $$\n该系统的能量本征值是量子化的：\n$$ E_n = \\hbar \\omega \\left(n + \\frac{1}{2}\\right), \\quad n = 0, 1, 2, \\dots $$\n其中 $\\omega = \\sqrt{k/m}$ 是振子的角频率，$\\hbar$ 是约化普朗克常数。\n\n在逆温 $\\beta = 1/(k_{\\mathrm{B}}T)$ 下，正则配分函数 $Z$ 是对所有态的求和：\n$$ Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right] = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta \\hbar \\omega (n + 1/2)} $$\n$$ Z = e^{-\\beta \\hbar \\omega / 2} \\sum_{n=0}^{\\infty} \\left(e^{-\\beta \\hbar \\omega}\\right)^n $$\n这是一个几何级数，其和为：\n$$ Z = e^{-\\beta \\hbar \\omega / 2} \\frac{1}{1 - e^{-\\beta \\hbar \\omega}} = \\frac{1}{e^{\\beta \\hbar \\omega / 2} - e^{-\\beta \\hbar \\omega / 2}} = \\frac{1}{2 \\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)} $$\n总能量的期望值 $\\langle E_{\\mathrm{tot}} \\rangle$ 可由配分函数求得：\n$$ \\langle E_{\\mathrm{tot}} \\rangle = - \\frac{\\partial \\ln Z}{\\partial \\beta} = - \\frac{\\partial}{\\partial \\beta} \\left[-\\ln\\left(2 \\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)\\right)\\right] $$\n$$ \\langle E_{\\mathrm{tot}} \\rangle = \\frac{1}{\\sinh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)} \\cdot \\cosh\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) \\cdot \\frac{\\hbar \\omega}{2} = \\frac{\\hbar \\omega}{2} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) $$\n对于谐振子，维里定理指出动能的期望值 $\\langle K \\rangle$ 等于势能的期望值 $\\langle V \\rangle$：\n$$ \\langle K \\rangle = \\langle V \\rangle $$\n因为 $\\langle E_{\\mathrm{tot}} \\rangle = \\langle K \\rangle + \\langle V \\rangle$，我们有：\n$$ \\langle K \\rangle = \\langle V \\rangle = \\frac{1}{2}\\langle E_{\\mathrm{tot}} \\rangle = \\frac{\\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) $$\n该问题要求的是动能的质心维里估计量。PIMD 中的一个关键结果是，对于谐波势，质心维里估计量对于任意数量的珠子 $P \\ge 2$ 都是精确的，这意味着它能得到动能的真实量子力学期望值。因此，上面为 $\\langle K \\rangle$ 推导的表达式正是质心维里估计量将产生的值。\n\n**2. 自由粒子的能量期望值 ($k = 0$)**\n\n$k=0$ 的情况必须单独处理。此时，势能 $V(q)=0$，系统是一个自由粒子。哈密顿量纯粹是动能：\n$$ \\hat{H} = \\frac{\\hat{p}^2}{2m} $$\n总能量的期望值纯粹是动能，即 $\\langle E_{\\mathrm{tot}} \\rangle = \\langle K \\rangle$。对于一维系统，在正则系综中，自由粒子的量子力学平均动能与经典结果相同：\n$$ \\langle K \\rangle = \\frac{1}{2} k_{\\mathrm{B}} T $$\n根据定义，势能为零：\n$$ \\langle V \\rangle = 0 $$\n因此，总能量为：\n$$ \\langle E_{\\mathrm{tot}} \\rangle = \\frac{1}{2} k_{\\mathrm{B}} T $$\n需要注意的是，不能直接对谐振子公式取 $k \\to 0$ 的极限。这样做会得到 $\\langle E_{\\mathrm{tot}} \\rangle \\to k_{\\mathrm{B}}T$，其中 $\\langle K \\rangle \\to \\frac{1}{2} k_{\\mathrm{B}}T$ 且 $\\langle V \\rangle \\to \\frac{1}{2} k_{\\mathrm{B}}T$。这个极限描述的是一个粒子在无限浅、无限宽的谐波阱（经典振子极限）中的情况，这与势能在任何地方都严格为零的真实自由粒子是物理上不同的系统。显式的 $k=0$ 情况对应于真实的自由粒子。\n\n**计算公式总结：**\n\n计算根据 $k$ 的值分为两种情况。\n\n**情况1：谐振子 ($k > 0$)**\n- 角频率：$\\omega = \\sqrt{k/m}$\n- 总能量：$E_{\\mathrm{tot}} = \\frac{\\hbar \\omega}{2} \\coth\\left(\\frac{\\hbar \\omega}{2 k_{\\mathrm{B}} T}\\right)$\n- 动能：$E_{K} = \\frac{1}{2} E_{\\mathrm{tot}}$\n- 势能：$E_{V} = \\frac{1}{2} E_{\\mathrm{tot}}$\n\n**情况2：自由粒子 ($k = 0$)**\n- 动能：$E_{K} = \\frac{1}{2} k_{\\mathrm{B}} T$\n- 势能：$E_{V} = 0$\n- 总能量：$E_{\\mathrm{tot}} = \\frac{1}{2} k_{\\mathrm{B}} T$\n\n计算中将使用以下物理常数：\n- 玻尔兹曼常数，$k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ J/K\n- 约化普朗克常数，$\\hbar = 1.054571817 \\times 10^{-34}$ J·s",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the quantum kinetic, potential, and total energies for a 1D particle\n    in a harmonic potential for several test cases, including the free-particle limit.\n    \"\"\"\n\n    # Physical constants in SI units\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n    HBAR = 1.054571817e-34 # Reduced Planck constant in J*s\n\n    # Test suite: each tuple is (m, k, T)\n    # m in kg, k in N/m, T in K\n    test_cases = [\n        (1.67262192369e-27, 500.0, 300.0), # Case 1: Proton in a stiff potential\n        (3.343583719e-27,   500.0, 300.0), # Case 2: Deuteron, reduced quantum effects\n        (1.67262192369e-27, 0.0,   300.0), # Case 3: Free particle limit\n        (1.67262192369e-27, 500.0, 5000.0), # Case 4: High-temperature classical limit\n    ]\n\n    results = []\n    for m, k, T in test_cases:\n        if k == 0.0:\n            # Free particle case (k=0)\n            # The potential is zero, total energy is purely kinetic.\n            # The quantum and classical results for average kinetic energy are the same.\n            E_K = 0.5 * K_B * T\n            E_V = 0.0\n            E_tot = E_K\n        else:\n            # Quantum Harmonic Oscillator case (k>0)\n            # Angular frequency\n            omega = np.sqrt(k / m)\n            \n            # Argument for the hyperbolic cotangent function\n            x = (HBAR * omega) / (2.0 * K_B * T)\n            \n            # coth(x) = 1/tanh(x). Numerically stable for positive x.\n            coth_x = 1.0 / np.tanh(x)\n            \n            # Total energy for the QHO\n            E_tot = (HBAR * omega / 2.0) * coth_x\n            \n            # From the virial theorem for a harmonic oscillator, K = V\n            E_K = 0.5 * E_tot\n            E_V = 0.5 * E_tot\n            \n        results.append([E_K, E_V, E_tot])\n\n    # Format the final output string as per the problem specification.\n    # e.g., [[E_K1,E_V1,E_tot1],[E_K2,E_V2,E_tot2],...]\n    formatted_cases = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "掌握了如何计算量子可观测量后，下一个关键的实际问题是如何确保路径积分分子动力学 (PIMD) 模拟的准确性。离散化所用的珠子数量 $P$ 是控制计算精度的核心参数。本练习将引导您检验一个广泛使用的关于如何选择 $P$ 的经验法则 ($P \\gtrsim \\beta \\hbar \\omega_{\\max}$)，并定量分析对于包含多种振动模式的复杂系统（如液态水），为达到所需精度实际需要多少珠子 。",
            "id": "3430035",
            "problem": "您必须编写一个完整且可运行的程序，使用振动模式的谐振子近似，对凝聚相中核量子效应的路径积分珠子数进行第一性原理收敛性研究。该程序必须实现一个基于不等式 $P_{\\text{beads}} \\gtrsim \\beta \\hbar \\omega_{\\max}$ 的判据，并测试其在代表液态水和甲烷的非均匀模式谱中的充分性。该研究必须基于以下基础和要求构建。\n\n从一组角频率为 $\\{\\omega_i\\}$ 的独立一维谐振子的正则量子配分函数 $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ 开始。每个模式的精确量子平均能量可从广为接受的量子统计力学原理中获得。对于使用路径积分分子动力学 (PIMD) 的收敛路径积分离散化，珠子数 $P_{\\text{beads}}$ 控制着 Trotter 分解误差。使用虚时路径积分在 $P$ 个切片中的原始 Trotter 分解以及环状聚合物表示。谐振子的离散化配分函数可以表示为珠子坐标的多维高斯形式，通过对角化为环状聚合物简正模式可以精确积分。有限 $P$ 下的平均能量必须通过对离散化配分函数关于 $\\beta$ 求导来计算，而不借助随机采样。除了二次型的对角化和对 $\\ln Z$ 关于 $\\beta$ 求导的法则外，不要假定任何快捷公式。您必须使用国际单位制 (SI) 中的常数 $\\hbar$ 和玻尔兹曼常数 $k_{\\mathrm{B}}$。\n\n您的程序必须为每个测试用例执行以下步骤：\n1.  使用 $c$ 的单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$ 的公式 $\\omega = 2\\pi c \\tilde{\\nu}$，将所有提供的以 $\\mathrm{cm}^{-1}$ 为单位的振动模式输入转换为以 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位的角频率。\n2.  对于给定的开尔文温度 $T$，计算 $\\beta = 1/(k_{\\mathrm{B}} T)$，单位为 $\\mathrm{J}^{-1}$。\n3.  通过对所有模式的精确谐振子能量求和，计算独立模式系统的精确总量子平均能量 $E_{\\text{exact,tot}}$。\n4.  通过评估环状聚合物表示的离散高斯积分并对 $-\\partial \\ln Z_P/\\partial \\beta$ 求导，计算总能量的有限-$P$ 离散近似 $E_{P,\\text{tot}}$。您必须确定性地为任何正整数 $P$ 获得 $E_{P,\\text{tot}}$，无需蒙特卡洛采样。\n5.  将经验法则珠子数定义为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是模式集中的最大角频率，$\\lceil \\cdot \\rceil$ 表示向上取整到下一个整数。强制 $P_{\\text{rule}} \\ge 1$。\n6.  对于总相对误差的指定容差 $\\delta_{\\text{tot}}$ 和最差单模相对误差的指定容差 $\\delta_{\\text{single}}$，确定：\n    a. 最小珠子数 $P_{\\text{tot}}$，使得 $\\left|E_{P,\\text{tot}} - E_{\\text{exact,tot}}\\right|/E_{\\text{exact,tot}} \\le \\delta_{\\text{tot}}$。\n    b. 最小珠子数 $P_{\\text{worst}}$，使得 $\\max_i \\left( \\left|E_{P}(\\omega_i) - E_{\\text{exact}}(\\omega_i)\\right|/E_{\\text{exact}}(\\omega_i) \\right) \\le \\delta_{\\text{single}}$。\n7.  通过检查在 $P = P_{\\text{rule}}$ 时的相应相对误差，评估经验法则珠子数 $P_{\\text{rule}}$ 是否满足总误差判据以及是否满足最差模式判据，这两个结果为布尔值。\n8.  以浮点数形式报告过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$。\n\n所有物理常数必须使用国际单位制 (SI)：$\\hbar$ 单位为 $\\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}}$ 单位为 $\\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c$ 单位为 $\\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。输入中的所有频率都以 $\\mathrm{cm}^{-1}$ 给出，在使用前必须转换为以 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位的角频率。温度以开尔文为单位。\n\n测试套件包括四个案例，每个案例由一个元组 $(T, \\{\\tilde{\\nu}_i\\}, \\delta_{\\text{tot}}, \\delta_{\\text{single}})$ 定义，其中 $T$ 是开尔文温度，$\\{\\tilde{\\nu}_i\\}$ 是以 $\\mathrm{cm}^{-1}$ 为单位的波数列表，容差是无量纲的小数。\n1.  案例 1 (300 开尔文下的类液态水)：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n2.  案例 2 (300 开尔文下的类甲烷)：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n3.  案例 3 (100 开尔文下的类液态水)：$T = 100$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n4.  案例 4 (300 开尔文下的低频边界)：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [100, 200, 300, 400, 500, 600]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含六个元素的列表，顺序为 $[P_{\\text{tot}}, P_{\\text{worst}}, P_{\\text{rule}}, \\text{pass}_{\\text{tot}}, \\text{pass}_{\\text{worst}}, \\mathcal{O}]$，其中前三个是整数，接下来两个是布尔值，最后一个是浮点数。因此，总输出应为包含四个此类列表的列表，针对四个测试用例，打印为单行，例如 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$。不应打印其他任何文本。根据构造，所有角度都以弧度为单位，输出中不出现其他单位，因为报告的量是无量纲或计数。所有百分比类型的比较必须按规定作为小数处理（例如，百分之一为 $0.01$）。",
            "solution": "该解决方案围绕量子统计力学原理和量子体系的路径积分表述构建。问题的核心是确定由独立谐振子组成的体系的路径积分表示相对于离散化中使用的珠子数 $P$ 的收敛性。\n\n**1. 基础理论**\n\n**1.1. 谐振子的精确量子能量**\n\n对于角频率为 $\\omega$ 的单个量子谐振子，其能级由 $E_n = \\hbar\\omega(n + 1/2)$ 给出，其中 $n=0, 1, 2, \\dots$。在逆温度 $\\beta = 1/(k_B T)$ 下，正则配分函数 $Z_{\\text{exact}}$ 是对所有状态的求和：\n$$ Z_{\\text{exact}}(\\omega) = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta\\hbar\\omega(n+1/2)} = \\frac{e^{-\\beta\\hbar\\omega/2}}{1 - e^{-\\beta\\hbar\\omega}} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega/2)} $$\n平均能量 $E_{\\text{exact}}(\\omega)$ 通过对配分函数的对数关于 $\\beta$ 求导得到：\n$$ E_{\\text{exact}}(\\omega) = -\\frac{\\partial \\ln Z_{\\text{exact}}(\\omega)}{\\partial \\beta} = \\frac{\\hbar\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) $$\n该表达式给出了单个谐振子模式的精确量子力学平均能量。对于由频率为 $\\{\\omega_i\\}$ 的独立谐振子组成的体系，总精确能量就是对所有模式求和：\n$$ E_{\\text{exact,tot}} = \\sum_i E_{\\text{exact}}(\\omega_i) $$\n\n**1.2. 路径积分离散化能量**\n\n路径积分表述将一个量子粒子表示为一个由 $P$ 个珠子组成的经典“环状聚合物”。对于谐振子，使用原始 Trotter 分解，离散化配分函数 $Z_P$ 可以写为关于珠子位置 $\\mathbf{x} = (x_1, \\dots, x_P)$ 的多维高斯积分。该积分可以通过对角化指数中的二次型来精确求解，这对应于变换到环状聚合物简正模式。\n\n按照要求，推导过程是通过对得到的 $\\ln Z_P$ 的闭合形式表达式求导。质量为 $m$ 的粒子在谐振子势中的离散化配分函数为：\n$$ Z_P = \\left( \\frac{mP}{2\\pi\\beta\\hbar^2} \\right)^{P/2} \\int d\\mathbf{x} \\exp\\left( -\\sum_{s=1}^P \\left[ \\frac{mP}{2\\beta\\hbar^2}(x_s - x_{s+1})^2 + \\frac{\\beta m\\omega^2}{2P}x_s^2 \\right] \\right) $$\n其中 $x_{P+1} \\equiv x_1$。指数中的项是一个二次型 $-\\frac{1}{2}\\mathbf{x}^T \\mathbf{A} \\mathbf{x}$。矩阵 $\\mathbf{A}$ 是一个循环矩阵，其特征值 $\\lambda_k$ (对于 $k=0, \\dots, P-1$) 为：\n$$ \\lambda_k = \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} $$\n积分的计算结果为 $(2\\pi)^{P/2}(\\det \\mathbf{A})^{-1/2} = (2\\pi)^{P/2} (\\prod_k \\lambda_k)^{-1/2}$。这导出了配分函数的表达式：\n$$ Z_P = \\left(\\frac{mP}{\\beta\\hbar^2}\\right)^{P/2} \\left(\\prod_{k=0}^{P-1} \\lambda_k\\right)^{-1/2} $$\n取对数得到：\n$$ \\ln Z_P = \\frac{P}{2}\\ln\\left(\\frac{mP}{\\beta\\hbar^2}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\ln\\left( \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} \\right) $$\n能量 $E_P(\\omega)$ 通过计算 $-\\partial(\\ln Z_P)/\\partial\\beta$ 找到。在执行微分和简化后，可以得到“热力学”能量估计量：\n$$ E_P(\\omega) = \\frac{P}{2\\beta} + \\frac{1}{2} \\sum_{k=0}^{P-1} \\frac{\\frac{\\omega^2}{P} - \\frac{4P}{\\beta^2\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)}{\\frac{\\beta \\omega^2}{P} + \\frac{4P}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)} $$\n请注意，质量 $m$ 消掉了，这对于谐振子只依赖于 $\\omega$ 的属性是符合预期的。该公式是确定性的，允许在不使用随机采样的情况下计算任何有限珠子数 $P$ 的能量。一组模式的总能量是总和 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$。\n\n**2. 算法实现**\n\n程序实现了上述理论框架以执行所要求的收敛性研究。\n\n**步骤 1：初始化**\n物理常数按规定以国际单位制 (SI) 定义：$\\hbar = 1.054571817 \\times 10^{-34} \\, \\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c = 2.99792458 \\times 10^{10} \\, \\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。\n\n**步骤 2：输入转换**\n对于每个测试用例，温度 $T$ 用于计算 $\\beta = 1/(k_B T)$。振动波数 $\\{\\tilde{\\nu}_i\\}$（单位为 $\\mathrm{cm}^{-1}$）使用关系式 $\\omega = 2\\pi c \\tilde{\\nu}$ 转换为角频率 $\\{\\omega_i\\}$（单位为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$）。\n\n**步骤 3：精确能量和近似能量的计算**\n实现了使用推导出的公式计算 $E_{\\text{exact}}(\\omega)$ 和 $E_P(\\omega)$ 的函数。这些函数使用 `numpy` 进行矢量化，以高效地同时计算整个频率集 $\\{\\omega_i\\}$ 的能量。\n\n**步骤 4：收敛性分析**\n从 $P=1$ 开始启动一个搜索循环。在每次迭代中，程序计算总 PIMD 能量 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$ 和各个模式的能量 $E_P(\\omega_i)$。然后计算相对误差：\n-   总相对误差：$\\epsilon_{\\text{tot}}(P) = |E_{P,\\text{tot}} - E_{\\text{exact,tot}}| / E_{\\text{exact,tot}}$\n-   最差模式相对误差：$\\epsilon_{\\text{worst}}(P) = \\max_i(|E_P(\\omega_i) - E_{\\text{exact}}(\\omega_i)| / E_{\\text{exact}}(\\omega_i))$\n\n循环继续进行，递增 $P$，直到找到满足 $\\epsilon_{\\text{tot}}(P_{\\text{tot}}) \\le \\delta_{\\text{tot}}$ 和 $\\epsilon_{\\text{worst}}(P_{\\text{worst}}) \\le \\delta_{\\text{single}}$ 的最小 $P_{\\text{tot}}$ 和 $P_{\\text{worst}}$ 值。\n\n**步骤 5：经验法则评估**\n启发式珠子数 $P_{\\text{rule}}$ 计算为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是集合中的最高频率。强制最小值为 1。然后通过计算在 $P=P_{\\text{rule}}$ 时的总相对误差和最差模式相对误差，并检查它们是否满足指定的容差（$\\delta_{\\text{tot}}$ 和 $\\delta_{\\text{single}}$）来测试此规则的性能。\n\n**步骤 6：报告**\n最后，收集每个测试用例的结果——$P_{\\text{tot}}$、$P_{\\text{worst}}$、$P_{\\text{rule}}$、两个布尔值的通过/失败检查以及过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$——并格式化为最终输出所需的列表的列表结构。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the PIMD convergence study for all test cases.\n    \"\"\"\n    \n    # Physical constants in SI units, except for c as specified\n    HBAR = 1.054571817e-34  # J.s\n    KB = 1.380649e-23        # J/K\n    C_CMS = 2.99792458e10   # cm/s\n\n    test_cases = [\n        # Case 1 (water-like at 300 K)\n        (300, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 2 (methane-like at 300 K)\n        (300, [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200], 0.01, 0.01),\n        # Case 3 (water-like at 100 K)\n        (100, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 4 (low-frequency at 300 K)\n        (300, [100, 200, 300, 400, 500, 600], 0.01, 0.01),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        T_kelvin, nu_cm_inv, delta_tot, delta_single = case\n        \n        # 1. Convert inputs\n        beta = 1.0 / (KB * T_kelvin)\n        omegas = 2.0 * np.pi * C_CMS * np.array(nu_cm_inv)\n        \n        # 3. Compute exact energies\n        def calc_E_exact(omega_arr, beta_val, hbar_val):\n            x = beta_val * hbar_val * omega_arr / 2.0\n            # Handle potential overflow in np.exp(2*x) for coth(x)\n            large_x_mask = x > 35\n            coth_x = np.zeros_like(x)\n            # For large x, coth(x) is 1\n            coth_x[large_x_mask] = 1.0\n            # For other x, use standard definition\n            non_large_x = ~large_x_mask\n            # Avoid division by zero if x is very small sinh(x->0) -> 0\n            small_x_mask = x  1e-8\n            x_safe = np.copy(x[non_large_x])\n            x_safe[x_safe  1e-8] = 1e-8 # Prevent division by zero, coth(x) ~ 1/x for small x\n            coth_x[non_large_x] = np.cosh(x_safe) / np.sinh(x_safe)\n            return (hbar_val * omega_arr / 2.0) * coth_x\n\n        E_exact_per_mode = calc_E_exact(omegas, beta, HBAR)\n        E_exact_tot = np.sum(E_exact_per_mode)\n\n        # 4. PIMD energy calculator\n        def calc_E_P(omega_arr, beta_val, P, hbar_val):\n            k = np.arange(P)\n            sin_k = np.sin(np.pi * k / P)\n            sin_k_sq = sin_k**2\n            \n            omega_arr_sq = omega_arr[:, np.newaxis]**2\n\n            num_part1 = omega_arr_sq / P\n            num_part2 = (4 * P / (beta_val**2 * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            numerator = num_part1 - num_part2\n            \n            den_part1 = (beta_val / P) * omega_arr_sq\n            den_part2 = (4 * P / (beta_val * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            denominator = den_part1 + den_part2\n            \n            sum_term = np.sum(numerator / denominator, axis=1)\n            \n            E_p_per_mode = P / (2 * beta_val) + 0.5 * sum_term\n            return E_p_per_mode, np.sum(E_p_per_mode)\n\n        # 5. Rule-of-thumb bead count\n        omega_max = np.max(omegas) if omegas.size > 0 else 0\n        P_rule_float = beta * HBAR * omega_max\n        P_rule = max(1, math.ceil(P_rule_float))\n\n        # 6. Find minimal P_tot and P_worst\n        P = 1\n        P_tot, P_worst = None, None\n        \n        while P_tot is None or P_worst is None:\n            E_p_per_mode, E_p_tot = calc_E_P(omegas, beta, P, HBAR)\n            \n            if P_tot is None:\n                rel_err_tot = np.abs(E_p_tot - E_exact_tot) / E_exact_tot\n                if rel_err_tot = delta_tot:\n                    P_tot = P\n            \n            if P_worst is None:\n                rel_err_per_mode = np.abs(E_p_per_mode - E_exact_per_mode) / E_exact_per_mode\n                max_rel_err = np.max(rel_err_per_mode)\n                if max_rel_err = delta_single:\n                    P_worst = P\n\n            P += 1\n            if P > 500:\n                 if P_tot is None: P_tot = -1\n                 if P_worst is None: P_worst = -1\n                 break\n\n        # 7. Evaluate P_rule\n        E_prule_per_mode, E_prule_tot = calc_E_P(omegas, beta, P_rule, HBAR)\n        \n        err_tot_at_prule = np.abs(E_prule_tot - E_exact_tot) / E_exact_tot\n        pass_tot = err_tot_at_prule = delta_tot\n        \n        err_worst_at_prule = np.max(np.abs(E_prule_per_mode - E_exact_per_mode) / E_exact_per_mode)\n        pass_worst = err_worst_at_prule = delta_single\n        \n        # 8. Overkill factor\n        overkill = float(P_rule) / P_tot if P_tot != 0 else float('inf')\n\n        all_results.append([P_tot, P_worst, P_rule, pass_tot, pass_worst, overkill])\n\n    # Format output string manually to match the exact requirement\n    # \"[[item1,item2,...],[item1,item2,...]]\" with no spaces.\n    list_of_list_strs = []\n    for res_list in all_results:\n        str_items = [str(item) for item in res_list]\n        str_items[3] = str_items[3].lower() # Boolean to lowercase\n        str_items[4] = str_items[4].lower() # Boolean to lowercase\n        list_str = \"[\" + \",\".join(str_items) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    \n    print(final_output_str.replace(\" \",\"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "在更深入的 PIMD 分析中，我们会发现即使是对于同一个物理量（如动能），也存在多种不同的数学估计量。虽然在理想条件下它们是等价的，但在实际模拟中，由于恒温器等算法细节的影响，它们可能给出不同的结果。本练习通过比较坐标空间和动量空间的动能估计量，让您亲手量化这种偏差，并理解恒温器如何引入系统性误差，从而培养对模拟结果进行批判性评估的能力 。",
            "id": "3430047",
            "problem": "考虑一个一维量子谐振子，用作液态甲醇中 O–H 伸缩振动模式的简化模型，以评估凝聚相中的核量子效应。该谐振子的角频率为 $\\omega$，对应于温度 $T = 298\\,\\mathrm{K}$ 时波数为 $\\bar{\\nu} = 3300\\,\\mathrm{cm}^{-1}$。取光速 $c = 2.99792458\\times 10^{10}\\,\\mathrm{cm/s}$，约化普朗克常数 $\\hbar = 1.054571817\\times 10^{-34}\\,\\mathrm{J\\cdot s}$，玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$，以及阿伏伽德罗常数 $N_{\\mathrm{A}} = 6.02214076\\times 10^{23}\\,\\mathrm{mol}^{-1}$。角频率为 $\\omega = 2\\pi c \\bar{\\nu}$，逆温度为 $\\beta = 1/(k_{\\mathrm{B}} T)$。对于此谐振子，精确的量子力学平均动能由 $K_{\\mathrm{exact}} = (\\hbar \\omega / 4)\\,\\coth\\!\\left(\\beta \\hbar \\omega / 2\\right)$ 给出。\n\n使用路径积分离散化，含 $P$ 个珠子（bead）。定义环状聚合物频率 $\\omega_{P} = P/(\\beta \\hbar)$ 和简正模式弹簧频率 $\\omega_{k} = 2\\,\\omega_{P}\\,\\sin(\\pi k / P)$，其中 $k = 0, 1, \\dots, P-1$。考虑动能 $K$ 的两种估计量：\n\n1. 一种针对谐振子情况特化的坐标空间质心维里估计量，可简化为\n$$\nK_{\\mathrm{cv}}(P) = \\frac{k_{\\mathrm{B}} T}{2P}\\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}}\n$$\n\n2. 一种动量空间简正模式估计量，定义为\n$$\nK_{\\mathrm{mom}}(P; a, b) = \\frac{k_{\\mathrm{B}} T}{2P}\\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}}\\, s_{k}(a, b)\n$$\n其中 $s_{k}(a, b)$ 参数化了由恒温器引起的简正模式动量方差对其正则值的偏离。将此偏离建模为\n$$\ns_{k}(a, b) = 1 + \\frac{a}{1 + \\left(\\omega_{k}/b\\right)^{2}}\n$$\n其中 $a$（无量纲振幅）和 $b$（频率，单位为 $\\mathrm{rad/s}$）是与模式无关的参数。正则、无偏的情况对应于 $a = 0$，此时对所有 $k$ 都有 $s_{k}(0,b) = 1$，并且对任何 $P$ 都有 $K_{\\mathrm{mom}}(P;0,b) = K_{\\mathrm{cv}}(P)$。$a$ 不为零时，模拟了恒温器调节不当对动量空间估计量造成的偏差，而 $b$ 设定了该偏差作用的特征频率尺度。\n\n您的任务是：\n\n- 从谐振子量子配分函数的路径积分表示的第一性原理以及质心维里和动量空间估计量的定义出发，推导用于 $K_{\\mathrm{exact}}$、$K_{\\mathrm{cv}}(P)$ 和 $K_{\\mathrm{mom}}(P; a, b)$ 的表达式。清晰阐明简正模式分解如何导出所述公式，而无需引用任何特定于实现的快捷方式。\n- 实现一个程序，为一组给定的测试用例计算 $K_{\\mathrm{exact}}$、$K_{\\mathrm{cv}}(P)$ 和 $K_{\\mathrm{mom}}(P; a, b)$，然后量化以下偏差\n$$\n\\Delta_{\\mathrm{cv}}(P) = K_{\\mathrm{cv}}(P) - K_{\\mathrm{exact}}, \\quad \\Delta_{\\mathrm{mom}}(P; a, b) = K_{\\mathrm{mom}}(P; a, b) - K_{\\mathrm{exact}}, \\quad \\Delta_{\\mathrm{mom-cv}}(P; a, b) = K_{\\mathrm{mom}}(P; a, b) - K_{\\mathrm{cv}}(P).\n$$\n所有能量均以 $\\mathrm{kJ/mol}$ 表示。\n\n使用以下测试套件。恒温器频率尺度 $b$ 必须使用给定的 $\\tilde{b}$ 设置为 $b = \\tilde{b}\\,\\omega_{P}$，以便 $b$ 随 $P$ 和温度自适应：\n\n- 测试用例 A（经典边界）：$P = 1$，$a = 0.0$，$\\tilde{b} = 1.0$。\n- 测试用例 B（无偏理想路径）：$P = 16$，$a = 0.0$，$\\tilde{b} = 1.0$。\n- 测试用例 C（对非质心模式的正偏差）：$P = 16$，$a = 0.2$，$\\tilde{b} = 1.0$。\n- 测试用例 D（负偏差，较缓和的频率依赖性）：$P = 32$，$a = -0.1$，$\\tilde{b} = 5.0$。\n- 测试用例 E（接近收敛的 $P$ 无偏情况）：$P = 256$，$a = 0.0$，$\\tilde{b} = 0.5$。\n\n您的程序必须生成单行输出，其中包含一个结果列表，每个测试用例一个结果，每个结果是一个包含六个浮点数的列表：\n$[K_{\\mathrm{exact}}, K_{\\mathrm{cv}}, K_{\\mathrm{mom}}, \\Delta_{\\mathrm{cv}}, \\Delta_{\\mathrm{mom}}, \\Delta_{\\mathrm{mom-cv}}]$，\n所有数值均以 $\\mathrm{kJ/mol}$ 为单位，并四舍五入到六位小数。例如，输出格式应为\n$[[x_{1},x_{2},x_{3},x_{4},x_{5},x_{6}],[y_{1},y_{2},y_{3},y_{4},y_{5},y_{6}],\\dots]$，在单行上，无额外文本。确保在正则无偏情况下 ($a=0$)，动量空间和坐标空间估计量在数值精度范围内匹配，并且偏差的符号和大小与 $a$ 和 $\\tilde{b}$ 的符号和尺度一致地变化。",
            "solution": "我们从角频率为 $\\omega$、逆温度为 $\\beta = 1/(k_{\\mathrm{B}} T)$ 的量子谐振子开始。精确的正则系综平均能量可以从配分函数或直接从谐振子平均能量的标准结果中获得。精确的量子力学平均能量为 $\\langle H \\rangle = \\frac{\\hbar \\omega}{2} \\coth\\!\\left(\\frac{\\beta \\hbar \\omega}{2}\\right)$。因为势是二次的，根据维里定理可得 $\\langle K \\rangle = \\langle V \\rangle = \\frac{1}{2}\\langle H \\rangle$。因此，精确的动能为\n$$\nK_{\\mathrm{exact}} = \\frac{1}{2}\\langle H \\rangle = \\frac{\\hbar \\omega}{4} \\coth\\!\\left(\\frac{\\beta \\hbar \\omega}{2}\\right).\n$$\n\n为了与路径积分分子动力学联系起来，我们考虑将量子配分函数进行 Trotter 分解，得到 $P$ 个副本（珠子），从而产生一个由 $P$ 个珠子通过谐振弹簧连接而成的环状聚合物的经典同构模型。在简正模式坐标下，环状聚合物的哈密顿量解耦为 $P$ 个独立的模式 $q_{k}$，其有效频率为 $\\sqrt{\\omega^{2} + \\omega_{k}^{2}}$，其中环状聚合物的弹簧频率为\n$$\n\\omega_{k} = 2\\,\\omega_{P}\\,\\sin\\!\\left(\\frac{\\pi k}{P}\\right), \\quad \\omega_{P} = \\frac{P}{\\beta \\hbar}, \\quad k = 0, 1, \\dots, P-1.\n$$\n质心模式对应于 $k=0$，此时 $\\omega_{0} = 0$。对于谐势 $V(x) = \\frac{1}{2} m \\omega^{2} x^{2}$，每个简正模式的平衡分布是高斯分布，经典能量均分定理给出\n$$\n\\langle q_{k}^{2} \\rangle = \\frac{k_{\\mathrm{B}} T}{m \\left(\\omega^{2} + \\omega_{k}^{2}\\right)}.\n$$\n物理坐标 $x$ 是所有珠子的平均值，而物理动能可以用相对于质心的位置方差来表示。将质心维里估计量特化于谐振子情况，可以得到\n$$\nK_{\\mathrm{cv}}(P) = \\frac{m \\omega^{2}}{2} \\frac{1}{P} \\sum_{k=0}^{P-1} \\langle q_{k}^{2} \\rangle = \\frac{k_{\\mathrm{B}} T}{2P} \\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}}.\n$$\n当 $P=1$ 时，此表达式简化为经典结果 $K_{\\mathrm{cv}}(1) = \\frac{1}{2} k_{\\mathrm{B}} T$；当 $P \\to \\infty$ 时，它收敛到精确的量子结果，这反映了 Trotter 分解的收敛性。\n\n动量空间简正模式估计量的提出，是基于这样一种观察：在简正模式表示中，与物理坐标相关的动能可以写成各模式动能的加权和。在与正则恒温器平衡时，动量的方差为 $\\langle p_{k}^{2} \\rangle = m k_{\\mathrm{B}} T$，与 $k$ 无关。使用与坐标空间估计量中出现的相同权重系数，动量空间估计量变为\n$$\nK_{\\mathrm{mom}}(P) = \\frac{1}{2 m P} \\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}} \\,\\langle p_{k}^{2} \\rangle.\n$$\n如果恒温器正确地生成了正则动量，那么 $\\langle p_{k}^{2} \\rangle = m k_{\\mathrm{B}} T$，并且对于任何 $P$，动量空间估计量都精确地简化为 $K_{\\mathrm{cv}}(P)$：\n$$\nK_{\\mathrm{mom}}(P) = \\frac{k_{\\mathrm{B}} T}{2P} \\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}} = K_{\\mathrm{cv}}(P).\n$$\n\n然而，实际的恒温器方案可能会以频率依赖的方式扭曲动量方差，尤其是在为每个简正模式使用色噪声或调节不当的摩擦参数时。为了以一种可控且解析透明的方式量化这种偏差，我们引入一个方差扭曲的参数模型：\n$$\n\\langle p_{k}^{2} \\rangle = m k_{\\mathrm{B}} T\\, s_{k}(a, b),\n$$\n与\n$$\ns_{k}(a, b) = 1 + \\frac{a}{1 + \\left(\\omega_{k}/b\\right)^{2}}.\n$$\n此处，$a$ 是一个无量纲振幅，控制着偏离正则采样的幅度和符号，$b$ 是一个频率尺度（单位为 $\\mathrm{rad/s}$），它设定了偏离随模式频率衰减的速度。将此代入动量估计量可得\n$$\nK_{\\mathrm{mom}}(P; a, b) = \\frac{k_{\\mathrm{B}} T}{2P} \\sum_{k=0}^{P-1} \\frac{\\omega^{2}}{\\omega^{2} + \\omega_{k}^{2}}\\, s_{k}(a, b).\n$$\n当 $a = 0$ 时，对所有 $k$ 都有 $s_{k} = 1$，且 $K_{\\mathrm{mom}}(P;0,b) = K_{\\mathrm{cv}}(P)$，与预期相符。对于 $a \\neq 0$，偏差取决于 $P$ 和尺度 $b$，其中低频模式（小的 $\\omega_{k}$）比高频模式受到的影响更大。\n\n程序的算法设计如下：\n\n1. 根据给定的波数 $\\bar{\\nu}$ 和常数，计算角频率 $\\omega = 2\\pi c \\bar{\\nu}$。计算 $\\beta = 1/(k_{\\mathrm{B}} T)$。\n\n2. 对于由 $(P, a, \\tilde{b})$ 指定的每个测试用例，计算环状聚合物频率 $\\omega_{P} = P/(\\beta \\hbar)$ 和模式频率 $\\omega_{k} = 2 \\omega_{P} \\sin(\\pi k / P)$，其中 $k = 0, 1, \\dots, P-1$。将恒温器频率尺度设置为 $b = \\tilde{b}\\,\\omega_{P}$。\n\n3. 计算权重 $w_{k} = \\omega^{2}/(\\omega^{2} + \\omega_{k}^{2})$。\n\n4. 计算\n$$\nK_{\\mathrm{cv}}(P) = \\frac{k_{\\mathrm{B}} T}{2P} \\sum_{k=0}^{P-1} w_{k},\n\\quad\nK_{\\mathrm{mom}}(P; a, b) = \\frac{k_{\\mathrm{B}} T}{2P} \\sum_{k=0}^{P-1} w_{k}\\, s_{k}(a, b),\n\\quad\nK_{\\mathrm{exact}} = \\frac{\\hbar \\omega}{4} \\coth\\!\\left(\\frac{\\beta \\hbar \\omega}{2}\\right).\n$$\n\n5. 通过乘以 $N_{\\mathrm{A}}/1000$，将所有能量从 $\\mathrm{J}$ 转换为 $\\mathrm{kJ/mol}$。\n\n6. 计算偏差\n$$\n\\Delta_{\\mathrm{cv}}(P) = K_{\\mathrm{cv}}(P) - K_{\\mathrm{exact}},\\quad\n\\Delta_{\\mathrm{mom}}(P; a, b) = K_{\\mathrm{mom}}(P; a, b) - K_{\\mathrm{exact}},\\quad\n\\Delta_{\\mathrm{mom-cv}}(P; a, b) = K_{\\mathrm{mom}}(P; a, b) - K_{\\mathrm{cv}}(P).\n$$\n\n7. 将每个报告值四舍五入到六位小数，并按规定顺序（A 到 E）输出包含五个测试用例的六元组列表的单行。\n\n科学真实性通过以下方式得以保证：使用一个公认的谐振子模型来描述主导核量子效应的高频分子内伸缩振动模式；采用标准的环状聚合物简正模式表示法；并引入一个频率依赖的、由恒温器引起的方差扭曲模型，该模型反映了实际恒温器如何不同地影响各个简正模式。该测试套件涵盖了经典、无偏的量子离散化、正偏差、负偏差和接近收敛的情况，从而能够对不同的 $P$ 和恒温器参数进行全面评估。所有结果按要求以 $\\mathrm{kJ/mol}$ 为单位报告。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef coth(x: float) -> float:\n    # Numerically stable hyperbolic cotangent\n    # For large |x|, coth(x) -> 1 with small corrections; numpy handles typical ranges well here.\n    return 1.0 / np.tanh(x)\n\ndef compute_kinetic_energies_kJ_per_mol(P: int, a: float, b_tilde: float,\n                                        T: float,\n                                        wavenumber_cm_inv: float) -> tuple:\n    # Physical constants (SI)\n    kB = 1.380649e-23            # J/K\n    hbar = 1.054571817e-34       # J*s\n    NA = 6.02214076e+23          # 1/mol\n    c_cm_s = 2.99792458e10       # cm/s\n\n    # Derived quantities\n    beta = 1.0 / (kB * T)\n    omega = 2.0 * np.pi * c_cm_s * wavenumber_cm_inv  # rad/s\n\n    # Ring-polymer frequencies\n    omega_P = P / (beta * hbar)  # rad/s\n    k_vals = np.arange(P, dtype=float)\n    omega_k = 2.0 * omega_P * np.sin(np.pi * k_vals / P)  # rad/s\n\n    # Weights for harmonic estimator\n    weights = (omega**2) / (omega**2 + omega_k**2)\n\n    # Thermostat frequency scale\n    b = b_tilde * omega_P  # rad/s\n\n    # Distortion factors s_k(a,b)\n    # Avoid division by zero when b=0 by handling as special case (though no test uses b=0).\n    if b == 0.0:\n        s_k = np.ones_like(omega_k) * (1.0 + a)  # all modes equally distorted\n    else:\n        s_k = 1.0 + a / (1.0 + (omega_k / b)**2)\n\n    # Exact quantum kinetic energy (J)\n    x = 0.5 * beta * hbar * omega\n    K_exact_J = 0.25 * hbar * omega * coth(x)\n\n    # Coordinate-space estimator (J)\n    K_cv_J = 0.5 * kB * T * np.mean(weights)\n\n    # Momentum-space estimator (J)\n    K_mom_J = 0.5 * kB * T * np.mean(weights * s_k)\n\n    # Convert to kJ/mol\n    conv = NA / 1000.0\n    K_exact = K_exact_J * conv\n    K_cv = K_cv_J * conv\n    K_mom = K_mom_J * conv\n\n    # Biases (kJ/mol)\n    delta_cv = K_cv - K_exact\n    delta_mom = K_mom - K_exact\n    delta_mom_cv = K_mom - K_cv\n\n    # Round to 6 decimals as required\n    def r6(x): return float(f\"{x:.6f}\")\n    return (r6(K_exact), r6(K_cv), r6(K_mom), r6(delta_cv), r6(delta_mom), r6(delta_mom_cv))\n\ndef solve():\n    # Fixed physical inputs from the problem statement\n    T = 298.0  # K\n    wavenumber_cm_inv = 3300.0  # cm^-1\n\n    # Test suite: (P, a, b_tilde)\n    test_cases = [\n        # Test case A: classical boundary\n        (1, 0.0, 1.0),\n        # Test case B: unbiased happy path\n        (16, 0.0, 1.0),\n        # Test case C: positive bias on non-centroid modes\n        (16, 0.2, 1.0),\n        # Test case D: negative bias, softer frequency dependence\n        (32, -0.1, 5.0),\n        # Test case E: near-converged P unbiased\n        (256, 0.0, 0.5),\n    ]\n\n    results = []\n    for P, a, b_tilde in test_cases:\n        res = compute_kinetic_energies_kJ_per_mol(P, a, b_tilde, T, wavenumber_cm_inv)\n        results.append(list(res))\n\n    # Final print statement in the exact required format.\n    # Single line, list of lists, with no spaces.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}