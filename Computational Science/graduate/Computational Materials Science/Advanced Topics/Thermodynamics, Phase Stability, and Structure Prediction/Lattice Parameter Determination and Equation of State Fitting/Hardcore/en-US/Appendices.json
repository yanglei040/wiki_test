{
    "hands_on_practices": [
        {
            "introduction": "A foundational task in computational materials science is determining a material's equilibrium structure and its response to pressure. While several equations of state (EOS) exist to model the pressure-volume relationship, they are not universally interchangeable. This exercise provides critical hands-on practice in fitting common EOS models—Murnaghan, Birch-Murnaghan, and Vinet—to synthetic data, emphasizing that model selection must balance the goodness of fit with the physical plausibility of its predictions, especially when extrapolating beyond the data range .",
            "id": "3461383",
            "problem": "You are given three independent static-compression datasets for a cubic crystalline solid, each consisting of measured volumes and corresponding pressures. Assume a cubic lattice with one atom per primitive cell, so that the lattice parameter is related to the volume by $a = V^{1/3}$. Your task is to determine, for each dataset, the most appropriate equation of state fit among three widely used models, determine the zero-pressure lattice parameter, and quantify the quality of fit. The three models are to be treated as three hypotheses for the pressure–volume relationship and must be fitted by nonlinear least squares under thermodynamic constraints. The selection must be based on the interplay of residuals across the measured data, behavior when extrapolated to high compression, and physical plausibility at high pressure.\n\nFundamental bases you may use:\n- The equation of state is a constitutive relation between pressure and volume for hydrostatic compression, grounded in the definition $P = -\\partial E/\\partial V$, where $P$ is pressure, $E$ is internal energy, and $V$ is volume.\n- For a cubic crystal with one atom per primitive cell, the lattice parameter $a$ and volume $V$ satisfy $V = a^3$.\n- The isothermal bulk modulus at zero pressure $B_0$ and its pressure derivative $B_0'$ are strictly positive for stable solids and typically satisfy $B_0'  1$.\n\nTask requirements for each dataset:\n1. Fit the three widely used equations of state (treated as three distinct hypotheses) to the given pressure–volume data by minimizing the sum of squared residuals between measured $P$ and model $P(V)$ over the dataset, subject to constraints $V_0  0$, $B_0  0$, and $B_0'  1$, where $V_0$ is the zero-pressure volume, $B_0$ is the zero-pressure bulk modulus, and $B_0'$ is its pressure derivative. The specific functional forms of the three models are to be considered part of standard computational materials science knowledge and are not provided here; you must implement them based on first principles and accepted literature.\n2. Compute the root-mean-square error (RMSE) of the fit in units of gigapascal (GPa).\n3. Evaluate high-pressure extrapolation to a compression state of $V/V_0 = 0.5$. Determine whether the extrapolated pressure is finite and positive and whether the pressure increases monotonically with increasing compression locally near that state (for example, check that $P(V=0.50\\,V_0)  P(V=0.52\\,V_0)$). If any of these physical plausibility conditions fail, penalize that model heavily in the selection.\n4. Select the “best” model as the one that minimizes a composite metric that prioritizes low RMSE while disqualifying non-physical extrapolation behavior by a large penalty.\n5. From the best-fit model, report the fitted zero-pressure lattice parameter $a_0$ in angstroms, computed as $a_0 = V_0^{1/3}$. Express $a_0$ in $\\mathrm{\\AA}$ rounded to four decimal places.\n6. Report the RMSE of the best-fit model in $\\mathrm{GPa}$ rounded to three decimal places.\n\nAngle units are not applicable. All reported physical quantities must be in the following units:\n- Volume $V$ in $\\mathrm{\\AA^3}$ (cubic angstrom), pressure $P$ in $\\mathrm{GPa}$ (gigapascal), and lattice parameter $a$ in $\\mathrm{\\AA}$ (angstrom).\n\nYour program must implement the above selection logic and apply it to the following three datasets (the datasets span compressions down to approximately $V/V_0 \\approx 0.6$):\n\nDataset 1:\n- Volumes $V_i$ in $\\mathrm{\\AA^3}$: $[16.0,\\,15.2,\\,14.4,\\,13.6,\\,12.8,\\,12.0,\\,11.2,\\,10.4,\\,9.6]$.\n- Pressures $P_i$ in $\\mathrm{GPa}$: $[0.0,\\,9.75,\\,22.68,\\,38.91,\\,60.83,\\,90.53,\\,130.8,\\,182.0,\\,257.8]$.\n\nDataset 2:\n- Volumes $V_i$ in $\\mathrm{\\AA^3}$: $[10.0,\\,9.5,\\,9.0,\\,8.5,\\,8.0,\\,7.5,\\,7.0,\\,6.5,\\,6.0]$.\n- Pressures $P_i$ in $\\mathrm{GPa}$: $[0.0,\\,16.81,\\,38.6,\\,65.4,\\,101.1,\\,148.5,\\,213.6,\\,301.5,\\,426.5]$.\n\nDataset 3:\n- Volumes $V_i$ in $\\mathrm{\\AA^3}$: $[20.0,\\,19.0,\\,18.0,\\,17.0,\\,16.0,\\,15.0,\\,14.0,\\,13.0,\\,12.0]$.\n- Pressures $P_i$ in $\\mathrm{GPa}$: $[0.0,\\,2.651,\\,6.30,\\,11.34,\\,18.22,\\,28.03,\\,41.6,\\,59.3,\\,85.5]$.\n\nModel indexing for output:\n- Index $0$: Murnaghan equation of state.\n- Index $1$: third-order Birch–Murnaghan equation of state.\n- Index $2$: Vinet equation of state.\n\nTest suite and output specification:\n- Apply your procedure to all three datasets.\n- For each dataset, output a triple consisting of the integer index of the selected best model, the fitted $a_0$ in $\\mathrm{\\AA}$ (rounded to four decimals), and the RMSE in $\\mathrm{GPa}$ (rounded to three decimals).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order of the datasets, for a total of nine values. For example, an output line of the form $[i_1, a_{0,1}, \\mathrm{RMSE}_1, i_2, a_{0,2}, \\mathrm{RMSE}_2, i_3, a_{0,3}, \\mathrm{RMSE}_3]$ where $i_k$ is an integer and the others are floats.\n\nThere is no user input. All constants and arrays are specified above. Ensure that your optimization imposes the stated thermodynamic constraints and that you enforce the physical plausibility checks in the high-compression extrapolation regime $V/V_0 \\approx 0.5$.",
            "solution": "The problem requires a comprehensive analysis of three pressure-volume ($P$-$V$) datasets for a cubic crystalline solid. The objective is to determine the most suitable equation of state (EOS) from a set of three standard models—Murnaghan, third-order Birch-Murnaghan, and Vinet—for each dataset. The selection must be based on a quantitative procedure that involves data fitting, evaluation of residuals, and assessment of physical plausibility under high compression.\n\nThe methodological approach is structured as follows:\n1.  For each dataset, fit the three specified EOS models to the given pressure-volume data.\n2.  Evaluate each fit based on a composite metric that combines the goodness of fit (RMSE) with a penalty for non-physical behavior upon extrapolation.\n3.  Select the model that minimizes this metric.\n4.  Report the integer index of the chosen model, its fitted zero-pressure lattice parameter ($a_0$), and its root-mean-square error (RMSE).\n\n**1. Equations of State (EOS)**\n\nThe relationship between pressure $P$ and volume $V$ is described by an EOS, derived from the internal energy $E$ via the thermodynamic relation $P = -\\partial E / \\partial V$. The three models to be tested are defined by their respective parameters: the zero-pressure volume $V_0$, the zero-pressure bulk modulus $B_0 = -V (\\partial P / \\partial V)|_{V=V_0}$, and the first pressure derivative of the bulk modulus at zero pressure, $B_0' = (\\partial B / \\partial P)|_{P=0}$.\n\nThe functional forms are:\n- **Murnaghan EOS (Index $0$):** This model is derived by assuming a linear relationship between the bulk modulus and pressure, $B(P) = B_0 + B_0' P$. Integration leads to the pressure-volume relation:\n$$\nP(V) = \\frac{B_0}{B_0'} \\left[ \\left( \\frac{V_0}{V} \\right)^{B_0'} - 1 \\right]\n$$\n\n- **Third-Order Birch-Murnaghan EOS (Index $1$):** This model is based on expanding the Helmholtz free energy in powers of the Eulerian finite strain, $f_E = \\frac{1}{2} [ (V_0/V)^{2/3} - 1 ]$. Truncating the expansion at the third order yields the following expression for pressure:\n$$\nP(V) = \\frac{3 B_0}{2} \\left[ \\left( \\frac{V_0}{V} \\right)^{7/3} - \\left( \\frac{V_0}{V} \\right)^{5/3} \\right] \\left\\{ 1 + \\frac{3}{4} (B_0' - 4) \\left[ \\left( \\frac{V_0}{V} \\right)^{2/3} - 1 \\right] \\right\\}\n$$\n\n- **Vinet EOS (Index $2$):** This \"universal\" EOS is derived from interatomic potential considerations and is known for its robustness over a wide range of compressions. Its form is:\n$$\nP(V) = 3 B_0 \\frac{1 - (V/V_0)^{1/3}}{(V/V_0)^{2/3}} \\exp\\left[\\frac{3}{2}(B_0' - 1)\\left(1 - (V/V_0)^{1/3}\\right)\\right]\n$$\n\n**2. Optimization and Fitting Procedure**\n\nFor each model and dataset, the optimal parameters ($V_0$, $B_0$, $B_0'$) are determined by minimizing the sum of squared residuals ($S$) between the measured pressures $P_{i, \\text{data}}$ and the pressures predicted by the model $P_{\\text{model}}$:\n$$\nS = \\sum_{i} \\left[ P_{i, \\text{data}} - P_{\\text{model}}(V_i; V_0, B_0, B_0') \\right]^2\n$$\nThis is a nonlinear least-squares optimization problem. The algorithm is implemented using `scipy.optimize.least_squares` with the Trust Region Reflective (`trf`) method, which is suitable for bound-constrained problems.\n\nThe optimization is subject to thermodynamic constraints required for a stable solid: $V_0  0$, $B_0  0$, and $B_0'  1$. These are enforced by setting lower bounds on the parameters during the optimization. Initial guesses for the parameters are estimated from the data: $V_0$ is approximated by the volume at zero pressure, $B_0$ is estimated from the initial slope of the $P$-$V$ curve, and $B_0'$ is set to a typical value of $4$.\n\n**3. Model Selection Protocol**\n\nA simple comparison of goodness of fit is insufficient, as an EOS must also be physically meaningful outside the range of the fitted data. Therefore, a two-part selection protocol is implemented.\n\n- **Goodness of Fit:** The primary measure of fit quality is the Root-Mean-Square Error (RMSE), calculated as:\n$$\n\\text{RMSE} = \\sqrt{\\frac{S}{N}}\n$$\nwhere $N$ is the number of data points.\n\n- **High-Pressure Plausibility Test:** Each fitted EOS is extrapolated to a high-compression state of $V/V_0 = 0.5$. The physical plausibility is tested against two criteria:\n    1.  The extrapolated pressure must be finite and positive ($P  0$).\n    2.  The pressure must increase monotonically with compression. This is equivalent to the bulk modulus $B = -V(dP/dV)$ being positive. This condition is verified by checking that $P(V=0.50 V_0)  P(V=0.52 V_0)$.\n\n- **Composite Metric:** A composite metric $M$ is defined to select the best model:\n$$\nM = \\text{RMSE} + \\text{Penalty}\n$$\nIf a model fails the plausibility test, a large penalty (e.g., $10^{10}$) is added to its RMSE. This effectively disqualifies any model that exhibits unphysical behavior at high compression. The model with the minimum value of $M$ is selected as the most appropriate one for the given dataset.\n\n**4. Calculation of Final Results**\n\nOnce the best model is identified for a given dataset, the final results are computed from its fitted parameters.\n- **Zero-Pressure Lattice Parameter ($a_0$):** For a cubic crystal with one atom per primitive cell, the volume is $V = a^3$. The zero-pressure lattice parameter is therefore calculated as:\n$$\na_0 = (V_0)^{1/3}\n$$\nThis value is reported in angstroms ($\\mathrm{\\AA}$) rounded to four decimal places.\n- **RMSE:** The RMSE of the best-fit model is reported in gigapascals (GPa) rounded to three decimal places.\n\nThis entire procedure is automated and applied sequentially to the three provided datasets to generate the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\n# ##############################################################################\n# EQUATION OF STATE (EOS) MODEL IMPLEMENTATIONS\n# ##############################################################################\n\ndef p_murnaghan(V, params):\n    \"\"\"Calculates pressure using the Murnaghan EOS.\"\"\"\n    V0, B0, B0_prime = params\n    # Ensure numerical stability for V0\n    ratio = V0 / V\n    pressure = (B0 / B0_prime) * (np.power(ratio, B0_prime) - 1.0)\n    return pressure\n\ndef p_bm3(V, params):\n    \"\"\"Calculates pressure using the 3rd-order Birch-Murnaghan EOS.\"\"\"\n    V0, B0, B0_prime = params\n    # Ensure numerical stability for V0\n    ratio = V0 / V\n    term1 = np.power(ratio, 7./3.) - np.power(ratio, 5./3.)\n    term2 = 1.0 + 0.75 * (B0_prime - 4.0) * (np.power(ratio, 2./3.) - 1.0)\n    pressure = 1.5 * B0 * term1 * term2\n    return pressure\n\ndef p_vinet(V, params):\n    \"\"\"Calculates pressure using the Vinet EOS.\"\"\"\n    V0, B0, B0_prime = params\n    # Ensure numerical stability for V0\n    x = np.power(V / V0, 1./3.)\n    eta = 1.5 * (B0_prime - 1.0)\n    pressure = 3.0 * B0 * ((1.0 - x) / (x**2)) * np.exp(eta * (1.0 - x))\n    return pressure\n\n# List of EOS functions dispatchable by index\nEOS_MODELS = [p_murnaghan, p_bm3, p_vinet]\n\n# ##############################################################################\n# CORE LOGIC FOR DATASET PROCESSING\n# ##############################################################################\n\ndef residuals(params, V_data, P_data, model_index):\n    \"\"\"Residuals function for the least-squares solver.\"\"\"\n    try:\n        P_model = EOS_MODELS[model_index](V_data, params)\n        # Handle non-finite results from the model, which can occur with\n        # extreme parameter values explored by the optimizer.\n        if not np.all(np.isfinite(P_model)):\n            return np.full_like(P_data, 1e12) # Return a large error\n        return P_model - P_data\n    except (ValueError, OverflowError, ZeroDivisionError):\n        return np.full_like(P_data, 1e12) # Return a large error on numerical failure\n\n\ndef process_dataset(V_data, P_data):\n    \"\"\"\n    Fits all three EOS models to a dataset, selects the best one based on\n    a composite metric, and returns the required results.\n    \"\"\"\n    models_results = []\n    \n    for i in range(len(EOS_MODELS)):\n        # Initial guess for parameters (V0, B0, B0_prime)\n        v0_guess = V_data[0]\n        # Estimate B0 from the first two points: B0 ~ -V * dP/dV\n        if len(V_data)  1 and (V_data[1] - V_data[0]) != 0:\n            b0_guess = -v0_guess * (P_data[1] - P_data[0]) / (V_data[1] - V_data[0])\n        else:\n            b0_guess = 100.0 # A generic fallback value\n        # Ensure guess is positive\n        b0_guess = max(b0_guess, 1.0)\n        p0 = [v0_guess, b0_guess, 4.0] # B0'~4 is a common starting point\n\n        # Parameter bounds: V0  0, B0  0, B0'  1\n        bounds = ([1e-9, 1e-9, 1.0], [np.inf, np.inf, np.inf])\n\n        # Perform the non-linear least squares fit\n        fit_result = least_squares(\n            residuals,\n            p0,\n            bounds=bounds,\n            args=(V_data, P_data, i),\n            method='trf'\n        )\n\n        if not fit_result.success:\n            models_results.append({'metric': np.inf, 'index': i})\n            continue\n\n        fit_params = fit_result.x\n        V0_fit, _, _ = fit_params\n\n        # Calculate RMSE\n        P_pred = EOS_MODELS[i](V_data, fit_params)\n        rmse = np.sqrt(np.mean((P_data - P_pred)**2))\n\n        # High-pressure extrapolation check\n        penalty = 0.0\n        try:\n            V_extrap1 = 0.50 * V0_fit\n            V_extrap2 = 0.52 * V0_fit\n            P_extrap1 = EOS_MODELS[i](V_extrap1, fit_params)\n            P_extrap2 = EOS_MODELS[i](V_extrap2, fit_params)\n            \n            # 1. Check for finite and positive pressure\n            if not np.isfinite(P_extrap1) or P_extrap1 = 0:\n                penalty = 1e10\n            # 2. Check for monotonic pressure increase with compression\n            elif not np.isfinite(P_extrap2) or P_extrap1 = P_extrap2:\n                penalty = 1e10\n        except (ValueError, OverflowError, ZeroDivisionError):\n             penalty = 1e10 # Penalize on any numerical failure during extrapolation\n\n        models_results.append({\n            'metric': rmse + penalty,\n            'index': i,\n            'V0': V0_fit,\n            'rmse': rmse\n        })\n\n    # Select the best model (the one with the minimum composite metric)\n    best_model = min(models_results, key=lambda x: x['metric'])\n    \n    # Calculate a0 from the best fit's V0\n    best_a0 = best_model['V0']**(1./3.)\n\n    return [\n        best_model['index'],\n        round(best_a0, 4),\n        round(best_model['rmse'], 3)\n    ]\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all specified datasets and print\n    the final formatted output.\n    \"\"\"\n    # Define the datasets from the problem statement.\n    test_cases = [\n        (\n            np.array([16.0, 15.2, 14.4, 13.6, 12.8, 12.0, 11.2, 10.4, 9.6]),\n            np.array([0.0, 9.75, 22.68, 38.91, 60.83, 90.53, 130.8, 182.0, 257.8])\n        ),\n        (\n            np.array([10.0, 9.5, 9.0, 8.5, 8.0, 7.5, 7.0, 6.5, 6.0]),\n            np.array([0.0, 16.81, 38.6, 65.4, 101.1, 148.5, 213.6, 301.5, 426.5])\n        ),\n        (\n            np.array([20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0]),\n            np.array([0.0, 2.651, 6.30, 11.34, 18.22, 28.03, 41.6, 59.3, 85.5])\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        V_data, P_data = case\n        result_triple = process_dataset(V_data, P_data)\n        results.extend(result_triple)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving beyond simple cubic systems, many technologically important materials possess anisotropic crystal structures, such as hexagonal close-packed (hcp) metals. For these materials, hydrostatic pressure induces not only a volume change but also a relaxation of internal structural parameters, like the axial ratio $\\eta = c/a$. This practice introduces the robust thermodynamic principle of enthalpy minimization, where the equilibrium structure at a given pressure $P$ is found by minimizing the function $H(V, \\eta; P) = E(V, \\eta) + PV$, providing a more general and powerful approach to predicting structural properties under compression .",
            "id": "3461409",
            "problem": "You are given a synthetic dataset of total energies for a hexagonal close-packed metal as a function of atomic volume and axial ratio, intended to emulate a converged electronic-structure calculation. The axial ratio is defined as $\\eta = c/a$. The goal is to jointly optimize the atomic volume $V$ and $\\eta$ under an external pressure $P$ by fitting a smooth energy surface $E(V,\\eta)$ and then minimizing the enthalpy $H(V,\\eta;P)$ to obtain the equilibrium values $(V(P),\\eta(P))$. The pressure enters thermodynamics through the definition of enthalpy $H=E+PV$, and the mechanical equilibrium under an imposed external pressure is uniquely determined by minimizing $H$ with respect to $V$ and $\\eta$ at fixed $P$. The fundamental base that should be used is the definition of pressure as the negative derivative of energy with respect to volume at fixed $\\eta$, namely $P=-\\partial E/\\partial V$, and the thermodynamic minimum principle that the stable state of a system in a pressure reservoir minimizes the enthalpy.\n\nUse the provided dataset of energies $E(V,\\eta)$ to construct a least-squares fit to a bivariate polynomial in $V$ and $\\eta$ up to second order, including cross terms. Then, for each specified pressure $P$, determine the pair $(V(P),\\eta(P))$ by minimizing the enthalpy $H(V,\\eta;P)$. From these minimized pairs, extract $\\eta(P)$ and report its values.\n\nUnits and fixed constants:\n- Energies $E$ are in electronvolts per atom, denoted $\\text{eV}$.\n- Volumes $V$ are in cubic angstroms per atom, denoted $\\text{\\AA}^3$.\n- Pressures $P$ are in gigapascals, denoted $\\text{GPa}$.\n- To combine $P$ and $V$ consistently in $H=E+PV$, use the conversion factor $C = 160.21766208$ with units $\\text{GPa}\\cdot\\text{\\AA}^3/\\text{eV}$, so that $PV/C$ has units of energy in $\\text{eV}$.\n\nData grid:\n- Volumes $V$ at five values: $\\{14.5,\\,15.5,\\,16.5,\\,17.5,\\,18.5\\}$ $\\text{\\AA}^3$.\n- Axial ratios $\\eta$ at five values: $\\{1.55,\\,1.58,\\,1.60,\\,1.62,\\,1.65\\}$ (dimensionless).\n- Energies $E(V,\\eta)$ in $\\text{eV}$ at the $5\\times 5$ grid points ordered by the nested loops $V$ outer, $\\eta$ inner (i.e., for each $V$ in ascending order, list the $5$ energies for the $\\eta$ values in ascending order):\n\nFor $V=14.5$: $\\{-3.00084,\\,-3.00000,\\,-2.99904,\\,-2.99840,\\,-2.99524\\}$\n\nFor $V=15.5$: $\\{-4.50024,\\,-4.50000,\\,-4.49944,\\,-4.49856,\\,-4.49664\\}$\n\nFor $V=16.5$: $\\{-4.99964,\\,-5.00000,\\,-4.99984,\\,-4.99936,\\,-4.99804\\}$\n\nFor $V=17.5$: $\\{-4.49904,\\,-4.50000,\\,-4.50024,\\,-4.50016,\\,-4.49944\\}$\n\nFor $V=18.5$: $\\{-2.99844,\\,-3.00000,\\,-3.00064,\\,-3.00096,\\,-3.00084\\}$\n\nAlgorithmic requirements:\n1. Fit $E(V,\\eta)$ by least squares to a bivariate polynomial including constant, linear, quadratic, and cross terms in $V$ and $\\eta$, without assuming any particular equation of state functional form beyond smoothness. Specifically, fit coefficients for the set of basis functions $\\{1,\\,V,\\,\\eta,\\,V^2,\\,V\\eta,\\,\\eta^2\\}$ so that the fitted model is $E_{\\text{fit}}(V,\\eta)$.\n2. For a given external pressure $P$ in $\\text{GPa}$, define the enthalpy as $H(V,\\eta;P) = E_{\\text{fit}}(V,\\eta) + (P/C)\\,V$ with the above $C$. Determine $(V(P),\\eta(P))$ by minimizing $H$ with respect to $V$ and $\\eta$. Treat $\\eta$ as dimensionless and $V$ in $\\text{\\AA}^3$.\n3. Extract $\\eta(P)$ for each pressure.\n\nTest suite of pressures:\n- $P_1 = 0.0$ $\\text{GPa}$ (ambient).\n- $P_2 = 10.0$ $\\text{GPa}$ (moderate compression).\n- $P_3 = 60.0$ $\\text{GPa}$ (high compression).\n- $P_4 = 120.0$ $\\text{GPa}$ (very high compression).\n- $P_5 = -2.0$ $\\text{GPa}$ (weak tension).\n\nAnswer specification:\n- Report the axial ratios $\\eta(P_i)$ (dimensionless) for $i\\in\\{1,2,3,4,5\\}$ rounded to $6$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\eta(P_1),\\eta(P_2),\\eta(P_3),\\eta(P_4),\\eta(P_5)]$ with each entry printed as a decimal number rounded to six decimal places.",
            "solution": "The problem requires the determination of the equilibrium axial ratio, $\\eta$, of a hexagonal close-packed metal under various external pressures, $P$. The methodological approach is prescribed: first, to model the total energy surface, $E(V, \\eta)$, as a function of atomic volume, $V$, and axial ratio, $\\eta$, by fitting a polynomial to a given synthetic dataset; and second, to find the equilibrium state $(V(P), \\eta(P))$ by minimizing the enthalpy, $H = E + PV$, for each given pressure.\n\nThe fundamental principle governing the system's equilibrium state at constant temperature and pressure is the minimization of the appropriate thermodynamic potential, which in this case is the enthalpy. The enthalpy per atom is defined as:\n$$H(V, \\eta; P) = E(V, \\eta) + PV$$\nwhere $E$ is the internal energy per atom. To maintain consistency of units between the energy term ($E$, in electronvolts, $\\text{eV}$) and the pressure-volume term ($PV$, where $P$ is in gigapascals, $\\text{GPa}$, and $V$ is in cubic angstroms, $\\text{\\AA}^3$), a conversion factor, $C = 160.21766208 \\, \\text{GPa}\\cdot\\text{\\AA}^3/\\text{eV}$, is used. The enthalpy expression to be minimized is therefore:\n$$H(V, \\eta; P) = E(V, \\eta) + \\frac{P}{C}V$$\n\nThe first step is to obtain a continuous analytical form for the energy surface, $E(V, \\eta)$, from the discrete set of $N=25$ data points provided. As per the problem statement, we fit the data to a second-order bivariate polynomial:\n$$E_{\\text{fit}}(V, \\eta) = c_0 + c_1 V + c_2 \\eta + c_3 V^2 + c_4 V\\eta + c_5 \\eta^2$$\nThe six unknown coefficients, $\\mathbf{c} = [c_0, c_1, c_2, c_3, c_4, c_5]^T$, are determined via a linear least-squares regression. For each of the $N$ data points $(V_j, \\eta_j, E_j)$, a linear equation is formed. This set of equations can be expressed in matrix form as $\\mathbf{A}\\mathbf{c} \\approx \\mathbf{b}$, where $\\mathbf{b}$ is the $N \\times 1$ vector of energy values and $\\mathbf{A}$ is the $N \\times 6$ design matrix whose $j$-th row is $[1, V_j, \\eta_j, V_j^2, V_j\\eta_j, \\eta_j^2]$. The least-squares solution minimizes the sum of squared residuals, $||\\mathbf{A}\\mathbf{c} - \\mathbf{b}||^2$, and is found by solving the normal equations $(\\mathbf{A}^T\\mathbf{A})\\mathbf{c} = \\mathbf{A}^T\\mathbf{b}$.\n\nOnce the coefficients $\\mathbf{c}$ are determined, we have an analytical expression for the enthalpy:\n$$H(V, \\eta; P) = (c_0 + c_1 V + c_2 \\eta + c_3 V^2 + c_4 V\\eta + c_5 \\eta^2) + \\frac{P}{C}V$$\nTo find the equilibrium state $(V(P), \\eta(P))$ that minimizes $H$, we set the partial derivatives of $H$ with respect to $V$ and $\\eta$ to zero:\n$$\\frac{\\partial H}{\\partial V} = \\frac{\\partial E_{\\text{fit}}}{\\partial V} + \\frac{P}{C} = (c_1 + 2c_3 V + c_4 \\eta) + \\frac{P}{C} = 0$$\n$$\\frac{\\partial H}{\\partial \\eta} = \\frac{\\partial E_{\\text{fit}}}{\\partial \\eta} = c_2 + c_4 V + 2c_5 \\eta = 0$$\nThis constitutes a system of two linear equations for the variables $V$ and $\\eta$:\n$$2c_3 V + c_4 \\eta = -c_1 - \\frac{P}{C}$$\n$$c_4 V + 2c_5 \\eta = -c_2$$\nThis system can be written in matrix form as $\\mathbf{M}\\mathbf{x} = \\mathbf{d}$, where $\\mathbf{x} = [V, \\eta]^T$, $\\mathbf{d} = [-c_1 - P/C, -c_2]^T$, and $\\mathbf{M}$ is the Hessian matrix of $E_{\\text{fit}}(V, \\eta)$:\n$$\\mathbf{M} = \\begin{pmatrix} \\frac{\\partial^2 E_{\\text{fit}}}{\\partial V^2}  \\frac{\\partial^2 E_{\\text{fit}}}{\\partial V \\partial \\eta} \\\\ \\frac{\\partial^2 E_{\\text{fit}}}{\\partial \\eta \\partial V}  \\frac{\\partial^2 E_{\\text{fit}}}{\\partial \\eta^2} \\end{pmatrix} = \\begin{pmatrix} 2c_3  c_4 \\\\ c_4  2c_5 \\end{pmatrix}$$\nFor the solution to correspond to a minimum, the Hessian matrix $\\mathbf{M}$ must be positive definite, which physically corresponds to the stability of the crystal structure. The equilibrium state is then found by solving this linear system for $(V, \\eta)$ for each given pressure $P$.\n\nThe computational procedure is as follows:\n1.  Construct the $25 \\times 6$ design matrix $\\mathbf{A}$ and the $25 \\times 1$ energy vector $\\mathbf{b}$ from the provided data.\n2.  Solve for the coefficient vector $\\mathbf{c}$ using a numerical linear least-squares solver.\n3.  For each pressure $P$ in the test suite $\\{0.0, 10.0, 60.0, 120.0, -2.0\\}\\,\\text{GPa}$:\n    a. Form the Hessian matrix $\\mathbf{M}$ and the right-hand-side vector $\\mathbf{d}$.\n    b. Solve the $2 \\times 2$ linear system $\\mathbf{M}[V, \\eta]^T = \\mathbf{d}$ to find the equilibrium pair $(V(P), \\eta(P))$.\n    c. Extract and store the value of $\\eta(P)$.\n4.  Report the list of calculated $\\eta(P)$ values, each rounded to six decimal places, according to the specified format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of determining equilibrium axial ratio as a function of pressure\n    for a hexagonal metal, based on a synthetic energy-volume-eta dataset.\n    \"\"\"\n\n    # --- Step 0: Define Givens and Constants ---\n    \n    # Grid points for Volume (V) in Angstrom^3\n    V_data = np.array([14.5, 15.5, 16.5, 17.5, 18.5])\n    \n    # Grid points for axial ratio (eta = c/a), dimensionless\n    eta_data = np.array([1.55, 1.58, 1.60, 1.62, 1.65])\n    \n    # Energy E(V, eta) in eV, ordered with V as outer loop, eta as inner loop\n    E_data_raw = np.array([\n        -3.00084, -3.00000, -2.99904, -2.99840, -2.99524,  # V=14.5\n        -4.50024, -4.50000, -4.49944, -4.49856, -4.49664,  # V=15.5\n        -4.99964, -5.00000, -4.99984, -4.99936, -4.99804,  # V=16.5\n        -4.49904, -4.50000, -4.50024, -4.50016, -4.49944,  # V=17.5\n        -2.99844, -3.00000, -3.00064, -3.00096, -3.00084   # V=18.5\n    ])\n\n    # Conversion factor from GPa*A^3 to eV\n    C = 160.21766208\n    \n    # Test suite of pressures in GPa\n    pressures_GPa = np.array([0.0, 10.0, 60.0, 120.0, -2.0])\n\n    # --- Step 1: Fit Energy Surface E(V, eta) ---\n\n    # Generate the full grid of (V, eta) points corresponding to the energy data\n    V_grid, eta_grid = np.meshgrid(V_data, eta_data, indexing='ij')\n    V_flat = V_grid.flatten()\n    eta_flat = eta_grid.flatten()\n    E_flat = E_data_raw\n\n    # Construct the design matrix A for the polynomial model:\n    # E_fit = c0*1 + c1*V + c2*eta + c3*V^2 + c4*V*eta + c5*eta^2\n    A = np.column_stack([\n        np.ones_like(V_flat),\n        V_flat,\n        eta_flat,\n        V_flat**2,\n        V_flat * eta_flat,\n        eta_flat**2\n    ])\n\n    # Solve the linear least-squares problem Ac = E to find the coefficients\n    coeffs, _, _, _ = np.linalg.lstsq(A, E_flat, rcond=None)\n    c0, c1, c2, c3, c4, c5 = coeffs\n\n    # --- Step 2: Minimize Enthalpy H(V, eta; P) for Each Pressure ---\n\n    # The minimization condition leads to a 2x2 linear system M * [V, eta]^T = d\n    # The matrix M is the Hessian of the fitted energy E_fit\n    Hessian_E = np.array([\n        [2 * c3, c4],\n        [c4, 2 * c5]\n    ])\n\n    results_eta = []\n    for P in pressures_GPa:\n        # The right-hand-side vector d depends on pressure P\n        d = np.array([\n            -(c1 + P / C),\n            -c2\n        ])\n        \n        # Solve the linear system for the equilibrium (V, eta) at the given pressure\n        try:\n            V_eq, eta_eq = np.linalg.solve(Hessian_E, d)\n            results_eta.append(eta_eq)\n        except np.linalg.LinAlgError:\n            # This case should not be reached with the given valid problem data\n            results_eta.append(np.nan)\n        \n    # --- Step 3: Format and Print the Final Answer ---\n    \n    # Format the list of eta values as specified in the problem\n    formatted_results = [f\"{eta:.6f}\" for eta in results_eta]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The fundamental concept of an equation of state, which connects a material's energy landscape to its mechanical properties, is not confined to three-dimensional bulk systems. With the rise of nanomaterials, it's essential to adapt these principles to lower dimensions. This problem explores this extension by guiding you through the derivation and application of a two-dimensional EOS for a monolayer crystal, relating the in-plane stress $\\sigma$ to the primitive cell area $A$, and ultimately connecting these microscopic parameters to the material's measurable 2D bulk modulus .",
            "id": "3461399",
            "problem": "Consider a two-dimensional crystalline monolayer whose in-plane elastic response can be described by an equation of state relating the primitive-cell area $A$ to the in-plane Cauchy stress $\\sigma(A)$ under homogeneous isotropic strain. Let the two-dimensional bulk modulus be defined by $B_{2\\mathrm{D}}(A) = A\\,\\mathrm{d}\\sigma/\\mathrm{d}A$. For layered crystals, an effective three-dimensional bulk modulus can be estimated by $B_{3\\mathrm{D}} \\approx B_{2\\mathrm{D}}/t$, where $t$ is an effective layer thickness. Assume that the two-dimensional bulk modulus varies linearly with stress, $B_{2\\mathrm{D}}(\\sigma) = B_{2\\mathrm{D},0} + B_{2\\mathrm{D},0}'\\,\\sigma$, where $B_{2\\mathrm{D},0}$ is the bulk modulus at zero stress and $B_{2\\mathrm{D},0}'$ is a dimensionless slope. Starting from the definitions of stress, area, and bulk modulus, derive a physically consistent equation of state $\\sigma(A)$ that satisfies the boundary condition $\\sigma(A_0) = 0$ at the equilibrium area $A_0$. Using this derived model, implement a fitting procedure to determine $A_0$, $B_{2\\mathrm{D},0}$, and $B_{2\\mathrm{D},0}'$ from synthetic stress-versus-area data for three test cases. Then, compute the hexagonal lattice parameter $a_0$ from the fitted equilibrium area via $A_0 = (\\sqrt{3}/2)\\,a_0^2$, the equilibrium two-dimensional bulk modulus $B_{2\\mathrm{D},0}$, and the effective three-dimensional bulk modulus $B_{3\\mathrm{D},0} = B_{2\\mathrm{D},0}/t$. Express $a_0$ in angstroms ($\\mathrm{\\AA}$), $A_0$ in square angstroms ($\\mathrm{\\AA}^2$), $B_{2\\mathrm{D},0}$ in newton per meter ($\\mathrm{N/m}$), and $B_{3\\mathrm{D},0}$ in gigapascal ($\\mathrm{GPa}$). Your program must construct the synthetic datasets from the parameters provided below, perform a nonlinear least-squares fit to recover the model parameters, and produce the specified outputs.\n\nFundamental base for derivation and modeling:\n- Use the definition $B_{2\\mathrm{D}}(A) = A\\,\\mathrm{d}\\sigma/\\mathrm{d}A$ and the linear relation $B_{2\\mathrm{D}}(\\sigma) = B_{2\\mathrm{D},0} + B_{2\\mathrm{D},0}'\\,\\sigma$ as the starting point.\n- Impose the boundary condition $\\sigma(A_0) = 0$ and require the model to be consistent with small-strain behavior near $A_0$.\n\nTest suite (construct the synthetic stress data $\\sigma(A)$ by evaluating the derived equation of state at the specified sampling areas without any random noise):\n- Case $1$ (graphene-like):\n  - True hexagonal lattice parameter $a_0^{\\text{true}} = 2.46\\,\\mathrm{\\AA}$.\n  - True two-dimensional bulk modulus at zero stress $B_{2\\mathrm{D},0}^{\\text{true}} = 200\\,\\mathrm{N/m}$.\n  - True dimensionless slope $B_{2\\mathrm{D},0}'^{\\text{true}} = 4$.\n  - Effective layer thickness $t = 3.35\\,\\mathrm{\\AA}$.\n  - Sampling areas $A$ given by $A = m \\, A_0^{\\text{true}}$ with multipliers $m \\in \\{0.96, 0.98, 1.00, 1.02, 1.04\\}$ and $A_0^{\\text{true}} = (\\sqrt{3}/2)\\,(a_0^{\\text{true}})^2$.\n- Case $2$ (molybdenum disulfide-like):\n  - True hexagonal lattice parameter $a_0^{\\text{true}} = 3.15\\,\\mathrm{\\AA}$.\n  - True two-dimensional bulk modulus at zero stress $B_{2\\mathrm{D},0}^{\\text{true}} = 120\\,\\mathrm{N/m}$.\n  - True dimensionless slope $B_{2\\mathrm{D},0}'^{\\text{true}} = 5$.\n  - Effective layer thickness $t = 6.15\\,\\mathrm{\\AA}$.\n  - Sampling areas $A$ given by $A = m \\, A_0^{\\text{true}}$ with multipliers $m \\in \\{0.95, 0.975, 1.00, 1.025, 1.05\\}$ and $A_0^{\\text{true}} = (\\sqrt{3}/2)\\,(a_0^{\\text{true}})^2$.\n- Case $3$ (stiff monolayer, boundary sampling):\n  - True hexagonal lattice parameter $a_0^{\\text{true}} = 3.00\\,\\mathrm{\\AA}$.\n  - True two-dimensional bulk modulus at zero stress $B_{2\\mathrm{D},0}^{\\text{true}} = 400\\,\\mathrm{N/m}$.\n  - True dimensionless slope $B_{2\\mathrm{D},0}'^{\\text{true}} = 3$.\n  - Effective layer thickness $t = 3.50\\,\\mathrm{\\AA}$.\n  - Sampling areas $A$ given by $A = m \\, A_0^{\\text{true}}$ with multipliers $m \\in \\{0.99, 1.00, 1.01\\}$ and $A_0^{\\text{true}} = (\\sqrt{3}/2)\\,(a_0^{\\text{true}})^2$.\n\nIn all cases, generate the synthetic $\\sigma(A)$ using only the derived equation of state and the above parameter values. Fit the model parameters $(A_0, B_{2\\mathrm{D},0}, B_{2\\mathrm{D},0}')$ for each case. From the fitted $A_0$, compute $a_0$ via $a_0 = \\sqrt{2A_0/\\sqrt{3}}$. Then compute $B_{2\\mathrm{D},0}$ and $B_{3\\mathrm{D},0} = B_{2\\mathrm{D},0}/t$ (convert $t$ from $\\mathrm{\\AA}$ to $\\mathrm{m}$ before division, and report $B_{3\\mathrm{D},0}$ in $\\mathrm{GPa}$). Use no external input beyond the specified test suite. Angles do not appear in this problem. All outputs must adhere to the unit constraints above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the list $[a_0, A_0, B_{2\\mathrm{D},0}, B_{3\\mathrm{D},0}]$ for one test case in the order Case $1$, Case $2$, Case $3$. For example, the printed line should look like $[[x_1,y_1,z_1,w_1],[x_2,y_2,z_2,w_2],[x_3,y_3,z_3,w_3]]$ with all entries being floating-point numbers.",
            "solution": "The problem requires first deriving the 2D equation of state (EOS) from the given principles, and then using it to fit synthetic data.\n\n**1. EOS Derivation**\n\nThe provided relations, $B_{2\\mathrm{D}}(A) = A \\frac{\\mathrm{d}\\sigma}{\\mathrm{d}A}$ and $B_{2\\mathrm{D}}(\\sigma) = B_{2\\mathrm{D},0} + B_{2\\mathrm{D},0}' \\sigma$, combine to form a separable first-order ordinary differential equation. Integrating this equation with the boundary condition $\\sigma(A_0) = 0$ yields a 2D analogue of the Murnaghan EOS:\n$$ \\sigma(A) = \\frac{B_{2\\mathrm{D},0}}{B_{2\\mathrm{D},0}'} \\left[ \\left(\\frac{A}{A_0}\\right)^{B_{2\\mathrm{D},0}'} - 1 \\right] $$\nThis function models the stress $\\sigma$ in terms of the area $A$ and the three fitting parameters: the equilibrium area $A_0$, the zero-stress 2D bulk modulus $B_{2\\mathrm{D},0}$, and its dimensionless derivative $B_{2\\mathrm{D},0}'$.\n\n**2. Fitting and Calculation**\n\nFor each test case, the procedure is as follows:\n1.  Synthetic stress-area data is generated by evaluating the derived EOS at the specified sampling areas using the \"true\" parameters.\n2.  A non-linear least-squares fitting routine (`scipy.optimize.curve_fit`) is used to fit the EOS to this synthetic data, recovering the model parameters $(A_0, B_{2\\mathrm{D},0}, B_{2\\mathrm{D},0}')$.\n3.  From the fitted parameters, the final output quantities are calculated:\n    - The hexagonal lattice parameter $a_0$ is found from the fitted area $A_0$ using $a_0 = \\sqrt{2A_0/\\sqrt{3}}$.\n    - The 2D bulk modulus is the fitted parameter $B_{2\\mathrm{D},0}$.\n    - The effective 3D bulk modulus $B_{3\\mathrm{D},0}$ is calculated via $B_{3\\mathrm{D},0} = B_{2\\mathrm{D},0}/t$, with unit conversions to yield a result in GPa.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves the problem by deriving, fitting, and calculating material properties.\n    \"\"\"\n\n    # Define the 2D Murnaghan-like Equation of State derived in the solution.\n    def eos_2d_murnaghan(A, A0, B2D0, B2D0_prime):\n        \"\"\"\n        Two-dimensional Murnaghan-like equation of state.\n        \n        Args:\n            A (float or np.ndarray): Area(s) in Angstrom^2.\n            A0 (float): Equilibrium area in Angstrom^2.\n            B2D0 (float): 2D bulk modulus at zero stress in N/m.\n            B2D0_prime (float): Dimensionless derivative of 2D bulk modulus.\n        \n        Returns:\n            float or np.ndarray: Stress(es) in N/m.\n        \"\"\"\n        # Handle the special case where B2D0_prime is close to zero,\n        # which corresponds to a logarithmic EOS. For the given problem\n        # data, B2D0_prime is not zero, so we only need the general form.\n        if np.isclose(B2D0_prime, 0.0):\n            return B2D0 * np.log(A / A0)\n        else:\n            ratio = A / A0\n            return (B2D0 / B2D0_prime) * (np.power(ratio, B2D0_prime) - 1.0)\n\n    # Test cases as specified in the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case 1 (graphene-like)\",\n            \"a0_true\": 2.46,      # Angstrom\n            \"B2D0_true\": 200.0,   # N/m\n            \"B2D0_prime_true\": 4.0,\n            \"t\": 3.35,            # Angstrom\n            \"multipliers\": [0.96, 0.98, 1.00, 1.02, 1.04]\n        },\n        {\n            \"name\": \"Case 2 (molybdenum disulfide-like)\",\n            \"a0_true\": 3.15,      # Angstrom\n            \"B2D0_true\": 120.0,   # N/m\n            \"B2D0_prime_true\": 5.0,\n            \"t\": 6.15,            # Angstrom\n            \"multipliers\": [0.95, 0.975, 1.00, 1.025, 1.05]\n        },\n        {\n            \"name\": \"Case 3 (stiff monolayer, boundary sampling)\",\n            \"a0_true\": 3.00,      # Angstrom\n            \"B2D0_true\": 400.0,   # N/m\n            \"B2D0_prime_true\": 3.0,\n            \"t\": 3.50,            # Angstrom\n            \"multipliers\": [0.99, 1.00, 1.01]\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Generate synthetic data\n        a0_true = case[\"a0_true\"]\n        B2D0_true = case[\"B2D0_true\"]\n        B2D0_prime_true = case[\"B2D0_prime_true\"]\n        t = case[\"t\"]\n        \n        # Calculate true equilibrium area from true lattice parameter\n        A0_true = (np.sqrt(3.0) / 2.0) * a0_true**2\n        \n        # Generate sampling areas and corresponding stresses\n        areas = A0_true * np.array(case[\"multipliers\"])\n        stresses = eos_2d_murnaghan(areas, A0_true, B2D0_true, B2D0_prime_true)\n\n        # 2. Perform the fit\n        # Initial guess for the fit; using true values for robustness as data is noise-free\n        p0 = [A0_true, B2D0_true, B2D0_prime_true]\n        \n        # Use scipy.optimize.curve_fit to find the best-fit parameters\n        popt, _ = curve_fit(eos_2d_murnaghan, areas, stresses, p0=p0)\n        \n        A0_fit, B2D0_fit, B2D0_prime_fit = popt\n\n        # 3. Calculate output quantities from fitted parameters\n        # Fitted hexagonal lattice parameter in Angstroms\n        a0_fit = np.sqrt(2.0 * A0_fit / np.sqrt(3.0))\n        \n        # Fitted equilibrium 2D bulk modulus in N/m\n        # B2D0_fit is already in N/m.\n\n        # Fitted effective 3D bulk modulus in GPa\n        # Conversion: B_3D [GPa] = (B_2D [N/m] / t [A]) * 10\n        B3D0_fit_gpa = (B2D0_fit / t) * 10.0\n        \n        # Collect results for this case\n        case_results = [a0_fit, A0_fit, B2D0_fit, B3D0_fit_gpa]\n        results.append(case_results)\n\n    # Final print statement in the exact required format\n    # The map(str, ...) will format each sublist, and join will add commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}