{
    "hands_on_practices": [
        {
            "introduction": "任何有效的物理模型都必须遵守基本的守恒定律，例如线动量和角动量守恒。对于依赖于成对相互作用的模型，角动量守恒要求粒子间的力是“中心力”，即作用力方向沿着粒子连线。本练习 () 通过对比一个正确的中心力模型和一个错误的非中心力模型，让学生亲手验证这一基本原则，并量化违反该原则所产生的伪力矩，从而深刻理解力场构建的正确性对于物理模拟的重要性。",
            "id": "3446073",
            "problem": "要求您通过测量角动量守恒和量化伪力矩，来验证一个成对介观粒子模型中的旋转不变性。在约化的耗散粒子动力学单位下进行计算，其中所有量都是无量纲的。考虑一个三维空间中由 $N$ 个点粒子组成的系统，它们的位置为 $\\mathbf{r}_i \\in \\mathbb{R}^3$，速度为 $\\mathbf{v}_i \\in \\mathbb{R}^3$，且质量相等，均为 $m$。时间变量为 $t$。目标是针对两种不同的成对相互作用模型，计算在一个显式欧拉时间步内，系统绕原点的净内力矩 $\\boldsymbol{\\tau}(t)$ 以及总角动量的变化量 $\\Delta \\mathbf{L} = \\mathbf{L}(t+\\Delta t) - \\mathbf{L}(t)$。这两种模型分别是：一个旋转不变的中心力模型和一个故意设计用来违反旋转不变性的非中心力模型。\n\n从以下基本原理出发：\n- 粒子 $i$ 的牛顿第二定律：$$m \\frac{d \\mathbf{v}_i}{d t} = \\sum_{j \\neq i} \\mathbf{F}_{ij},$$ 其中 $\\mathbf{F}_{ij}$ 是粒子 $j$ 对粒子 $i$ 的作用力。\n- 牛顿第三定律：$$\\mathbf{F}_{ij} = - \\mathbf{F}_{ji}.$$\n- 绕原点的总角动量定义：$$\\mathbf{L}(t) = \\sum_{i=1}^{N} m \\, \\mathbf{r}_i(t) \\times \\mathbf{v}_i(t).$$\n- 绕原点的净内力矩定义：$$\\boldsymbol{\\tau}(t) = \\sum_{i=1}^{N} \\mathbf{r}_i(t) \\times \\left( \\sum_{j \\neq i} \\mathbf{F}_{ij}(t) \\right).$$\n\n实现以下具有截断半径 $r_c$ 的确定性成对力模型，不含任何随机力：\n\n1. 旋转不变的中心力模型。对于一对粒子的分离矢量 $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$，距离 $r_{ij} = \\|\\mathbf{r}_{ij}\\|$，以及单位矢量 $\\hat{\\mathbf{r}}_{ij} = \\mathbf{r}_{ij} / r_{ij}$，定义保守权重为 $w_C(r_{ij}) = 1 - r_{ij}/r_c$（当 $r_{ij}  r_c$ 时），否则 $w_C(r_{ij}) = 0$。定义 $w_D(r_{ij}) = \\left[w_C(r_{ij})\\right]^2$。保守力和耗散力分别为：\n$$\\mathbf{F}_{ij}^{C} = a \\, w_C(r_{ij}) \\, \\hat{\\mathbf{r}}_{ij}, \\quad \\mathbf{F}_{ij}^{D} = - \\gamma \\, w_D(r_{ij}) \\left( \\left( \\mathbf{v}_i - \\mathbf{v}_j \\right) \\cdot \\hat{\\mathbf{r}}_{ij} \\right) \\hat{\\mathbf{r}}_{ij},$$\n总的成对力为 $\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^{C} + \\mathbf{F}_{ij}^{D}$（当 $r_{ij}  r_c$ 时），否则 $\\mathbf{F}_{ij} = \\mathbf{0}$。\n\n2. 非中心力（错误）模型。使用与上述相同的 $\\mathbf{F}_{ij}^{C}$，但将耗散力替换为非中心力形式\n$$\\mathbf{F}_{ij}^{D,\\mathrm{bug}} = - \\gamma \\, w_D(r_{ij}) \\left( \\mathbf{v}_i - \\mathbf{v}_j \\right),$$\n因此总的成对力为 $\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^{C} + \\mathbf{F}_{ij}^{D,\\mathrm{bug}}$（当 $r_{ij}  r_c$ 时），否则 $\\mathbf{F}_{ij} = \\mathbf{0}$。该模型（由于对称性）保持线性动量守恒，但因为耗散项不是中心力而违反了旋转不变性。\n\n每个测试案例需实现的数值步骤：\n- 所有粒子的质量 $m = 1$。\n- 根据指定模型计算时刻 $t$ 的所有成对力。\n- 计算净内力矩 $\\boldsymbol{\\tau}(t)$ 及其欧几里得范数 $\\|\\boldsymbol{\\tau}(t)\\|$。\n- 计算总角动量 $\\mathbf{L}(t)$。\n- 前进一步大小为 $\\Delta t$ 的显式欧拉步：对每个粒子，\n$$\\mathbf{v}_i(t+\\Delta t) = \\mathbf{v}_i(t) + \\Delta t \\, \\frac{\\sum_{j \\neq i} \\mathbf{F}_{ij}(t)}{m}, \\quad \\mathbf{r}_i(t+\\Delta t) = \\mathbf{r}_i(t) + \\Delta t \\, \\mathbf{v}_i(t).$$\n- 计算 $\\mathbf{L}(t+\\Delta t)$ 及其变化量 $\\Delta \\mathbf{L} = \\mathbf{L}(t+\\Delta t) - \\mathbf{L}(t)$，以及其欧几里得范数 $\\|\\Delta \\mathbf{L}\\|$。\n- 以无量纲浮点数的形式报告 $\\|\\boldsymbol{\\tau}(t)\\|$ 和 $\\|\\Delta \\mathbf{L}\\|$。\n\n测试套件。使用以下四个测试案例，均在约化的耗散粒子动力学单位（无量纲）下：\n\n- 案例1（中心力模型，粒子对）：$N = 2$, $a = 25.0$, $\\gamma = 4.5$, $r_c = 1.0$, $\\Delta t = 0.01$, $\\mathbf{r}_1 = (0.0, 0.0, 0.0)$, $\\mathbf{r}_2 = (0.5, 0.0, 0.0)$, $\\mathbf{v}_1 = (0.0, 1.0, 0.0)$, $\\mathbf{v}_2 = (0.0, -1.0, 0.0)$；使用旋转不变的中心力模型。\n- 案例2（中心力模型，非对称三粒子体系）：$N = 3$, $a = 25.0$, $\\gamma = 4.5$, $r_c = 1.0$, $\\Delta t = 0.01$, $\\mathbf{r}_1 = (0.0, 0.0, 0.0)$, $\\mathbf{r}_2 = (0.6, 0.2, 0.0)$, $\\mathbf{r}_3 = (0.2, 0.7, 0.0)$, $\\mathbf{v}_1 = (0.1, -0.2, 0.0)$, $\\mathbf{v}_2 = (-0.05, 0.03, 0.0)$, $\\mathbf{v}_3 = (0.02, -0.01, 0.0)$；使用旋转不变的中心力模型。\n- 案例3（非中心力错误模型，相同的三粒子体系）：与案例2相同，但耗散项使用非中心力模型。\n- 案例4（在截断半径处无相互作用）：$N = 3$, $a = 25.0$, $\\gamma = 4.5$, $r_c = 1.0$, $\\Delta t = 0.01$, $\\mathbf{r}_1 = (0.0, 0.0, 0.0)$, $\\mathbf{r}_2 = (2.0, 0.0, 0.0)$, $\\mathbf{r}_3 = (0.0, 2.0, 0.0)$, $\\mathbf{v}_1 = (0.3, -0.1, 0.0)$, $\\mathbf{v}_2 = (-0.2, 0.2, 0.0)$, $\\mathbf{v}_3 = (0.0, -0.15, 0.0)$；使用旋转不变的中心力模型。\n\n您的程序必须为每个案例计算两个浮点数 $\\|\\boldsymbol{\\tau}(t)\\|$ 和 $\\|\\Delta \\mathbf{L}\\|$，每个都四舍五入到八位小数。最终输出格式为一行，包含按案例顺序展开的所有这些值的逗号分隔列表，即：\n$$[\\|\\boldsymbol{\\tau}\\|_1, \\|\\Delta \\mathbf{L}\\|_1, \\|\\boldsymbol{\\tau}\\|_2, \\|\\Delta \\mathbf{L}\\|_2, \\|\\boldsymbol{\\tau}\\|_3, \\|\\Delta \\mathbf{L}\\|_3, \\|\\boldsymbol{\\tau}\\|_4, \\|\\Delta \\mathbf{L}\\|_4].$$\n不应打印任何其他文本。所有输出在约化的耗散粒子动力学单位下均为无量纲。",
            "solution": "该问题在科学上是有效的，它基于经典力学原理，提供了一个定义明确的计算物理练习，用于验证粒子模型中旋转不变性的重要性。\n\n角动量守恒的核心原理是，对于一个孤立系统（不受外力矩作用），其总角动量 $\\mathbf{L}$ 随时间保持不变。这要求系统内部所有内力产生的净力矩 $\\boldsymbol{\\tau}_{\\text{int}}$ 为零。\n\n总角动量定义为：\n$$\n\\mathbf{L}(t) = \\sum_{i=1}^{N} m \\left( \\mathbf{r}_i(t) \\times \\mathbf{v}_i(t) \\right)\n$$\n其时间导数是净内力矩：\n$$\n\\frac{d\\mathbf{L}}{dt} = \\boldsymbol{\\tau}_{\\text{int}}(t) = \\sum_{i=1}^{N} \\mathbf{r}_i(t) \\times \\mathbf{F}_i(t) = \\sum_{i=1}^{N} \\mathbf{r}_i(t) \\times \\left( \\sum_{j \\neq i} \\mathbf{F}_{ij}(t) \\right)\n$$\n其中 $\\mathbf{F}_{ij}$ 是粒子 $j$ 对粒子 $i$ 的作用力。利用牛顿第三定律（$\\mathbf{F}_{ij} = -\\mathbf{F}_{ji}$），可以将力矩表达式重写为对所有粒子对的求和：\n$$\n\\boldsymbol{\\tau}_{\\text{int}} = \\sum_{i  j} (\\mathbf{r}_i \\times \\mathbf{F}_{ij} + \\mathbf{r}_j \\times \\mathbf{F}_{ji}) = \\sum_{i  j} (\\mathbf{r}_i - \\mathbf{r}_j) \\times \\mathbf{F}_{ij} = \\sum_{i  j} \\mathbf{r}_{ij} \\times \\mathbf{F}_{ij}\n$$\n这个结果是关键。要使净内力矩为零，必须满足 $\\mathbf{r}_{ij} \\times \\mathbf{F}_{ij} = \\mathbf{0}$。这意味着力向量 $\\mathbf{F}_{ij}$ 必须与位置差向量 $\\mathbf{r}_{ij}$ 平行。这样的力被称为**中心力**。\n\n1.  **对于旋转不变的中心力模型**：保守力和耗散力都被定义为与单位向量 $\\hat{\\mathbf{r}}_{ij}$ 成比例，即 $\\mathbf{F}_{ij} = (\\dots) \\hat{\\mathbf{r}}_{ij}$。因此，$\\mathbf{F}_{ij}$ 与 $\\mathbf{r}_{ij}$ 始终共线，它们的叉积为零。理论上，对于每一对粒子，$\\mathbf{r}_{ij} \\times \\mathbf{F}_{ij} = \\mathbf{0}$，因此总内力矩 $\\boldsymbol{\\tau}_{\\text{int}}$ 恒为零。角动量守恒。在数值计算中，由于浮点舍入误差，计算出的力矩可能是一个非常接近零的小数。\n\n2.  **对于非中心力（错误）模型**：耗散力项 $\\mathbf{F}_{ij}^{D,\\mathrm{bug}} = -\\gamma w_D(r_{ij})(\\mathbf{v}_i - \\mathbf{v}_j)$ 通常不与 $\\mathbf{r}_{ij}$ 平行。因此，$\\mathbf{r}_{ij} \\times \\mathbf{F}_{ij}^{D,\\mathrm{bug}} \\neq \\mathbf{0}$，这将产生一个非零的“伪力矩”，导致总内力矩 $\\boldsymbol{\\tau}_{\\text{int}}$ 不为零。因此，系统的角动量将不再守恒。\n\n该练习通过显式欧拉积分来近似角动量的变化。根据角动量-力矩关系，$d\\mathbf{L} = \\boldsymbol{\\tau} dt$，其离散形式为 $\\Delta \\mathbf{L} \\approx \\boldsymbol{\\tau}(t) \\Delta t$。因此，我们预期对于中心力模型，$\\|\\boldsymbol{\\tau}(t)\\|$ 和 $\\|\\Delta \\mathbf{L}\\|$ 都应接近于零（在机器精度范围内）；而对于非中心力模型，两者都应为显著的非零值，且 $\\|\\Delta \\mathbf{L}\\| \\approx \\|\\boldsymbol{\\tau}(t)\\| \\Delta t$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates rotational invariance in a pairwise mesoscale particle model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Central model, pair\n        {\n            \"N\": 2, \"a\": 25.0, \"gamma\": 4.5, \"rc\": 1.0, \"dt\": 0.01, \"m\": 1.0,\n            \"r\": np.array([[0.0, 0.0, 0.0], [0.5, 0.0, 0.0]]),\n            \"v\": np.array([[0.0, 1.0, 0.0], [0.0, -1.0, 0.0]]),\n            \"model_type\": 'central'\n        },\n        # Case 2: Central model, asymmetric triplet\n        {\n            \"N\": 3, \"a\": 25.0, \"gamma\": 4.5, \"rc\": 1.0, \"dt\": 0.01, \"m\": 1.0,\n            \"r\": np.array([[0.0, 0.0, 0.0], [0.6, 0.2, 0.0], [0.2, 0.7, 0.0]]),\n            \"v\": np.array([[0.1, -0.2, 0.0], [-0.05, 0.03, 0.0], [0.02, -0.01, 0.0]]),\n            \"model_type\": 'central'\n        },\n        # Case 3: Non-central model, same triplet\n        {\n            \"N\": 3, \"a\": 25.0, \"gamma\": 4.5, \"rc\": 1.0, \"dt\": 0.01, \"m\": 1.0,\n            \"r\": np.array([[0.0, 0.0, 0.0], [0.6, 0.2, 0.0], [0.2, 0.7, 0.0]]),\n            \"v\": np.array([[0.1, -0.2, 0.0], [-0.05, 0.03, 0.0], [0.02, -0.01, 0.0]]),\n            \"model_type\": 'non-central'\n        },\n        # Case 4: No interactions at cut-off\n        {\n            \"N\": 3, \"a\": 25.0, \"gamma\": 4.5, \"rc\": 1.0, \"dt\": 0.01, \"m\": 1.0,\n            \"r\": np.array([[0.0, 0.0, 0.0], [2.0, 0.0, 0.0], [0.0, 2.0, 0.0]]),\n            \"v\": np.array([[0.3, -0.1, 0.0], [-0.2, 0.2, 0.0], [0.0, -0.15, 0.0]]),\n            \"model_type\": 'central'\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        norm_torque, norm_delta_L = run_simulation_step(\n            case[\"N\"], case[\"r\"], case[\"v\"], case[\"m\"],\n            case[\"a\"], case[\"gamma\"], case[\"rc\"], case[\"dt\"],\n            case[\"model_type\"]\n        )\n        results.append(round(norm_torque, 8))\n        results.append(round(norm_delta_L, 8))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation_step(N, r, v, m, a, gamma, rc, dt, model_type):\n    \"\"\"\n    Computes net torque and change in angular momentum for one time step.\n    \n    Args:\n        N (int): Number of particles.\n        r (np.ndarray): (N, 3) array of particle positions.\n        v (np.ndarray): (N, 3) array of particle velocities.\n        m (float): Particle mass.\n        a (float): Conservative force parameter.\n        gamma (float): Dissipative force parameter.\n        rc (float): Cutoff radius.\n        dt (float): Time step size.\n        model_type (str): 'central' or 'non-central'.\n\n    Returns:\n        tuple: (norm_torque, norm_delta_L) as floats.\n    \"\"\"\n    # 1. Compute total angular momentum at time t\n    L_t = np.sum(np.cross(r, v) * m, axis=0)\n\n    # 2. Compute pairwise forces and total force on each particle\n    forces = np.zeros_like(r)\n    for i in range(N):\n        for j in range(i + 1, N):\n            r_ij = r[i] - r[j]\n            r_ij_norm = np.linalg.norm(r_ij)\n\n            # Interact only if within cutoff radius\n            if 0  r_ij_norm  rc:\n                r_ij_hat = r_ij / r_ij_norm\n                v_ij = v[i] - v[j]\n\n                w_C = 1.0 - r_ij_norm / rc\n                w_D = w_C**2\n\n                F_ij_C = a * w_C * r_ij_hat\n\n                if model_type == 'central':\n                    F_ij_D = -gamma * w_D * np.dot(v_ij, r_ij_hat) * r_ij_hat\n                elif model_type == 'non-central':\n                    F_ij_D = -gamma * w_D * v_ij\n                else:\n                    raise ValueError(\"Unknown model type\")\n\n                F_ij = F_ij_C + F_ij_D\n                \n                forces[i] += F_ij\n                forces[j] -= F_ij\n\n    # 3. Compute net internal torque at time t\n    torque_t = np.sum(np.cross(r, forces), axis=0)\n    norm_torque_t = np.linalg.norm(torque_t)\n\n    # 4. Advance one Explicit Euler step\n    # Position update uses velocity at time t\n    r_new = r + dt * v\n    v_new = v + dt * forces / m\n\n    # 5. Compute total angular momentum at time t+dt\n    L_t_dt = np.sum(np.cross(r_new, v_new) * m, axis=0)\n\n    # 6. Compute change in angular momentum\n    delta_L = L_t_dt - L_t\n    norm_delta_L = np.linalg.norm(delta_L)\n    \n    return norm_torque_t, norm_delta_L\n\nsolve()\n```"
        },
        {
            "introduction": "在确保了力场形式的物理正确性之后，下一步是设定其参数以模拟特定流体。在耗散粒子动力学（DPD）中，保守排斥力参数 $a$ 直接决定了流体的状态方程，包括其可压缩性和声速。本练习 () 引导学生探索这个微观参数与宏观物理性质之间的深刻联系，并实践如何调节该参数以达到目标声速，从而有效控制流体中的可压缩性伪影，这在模拟近不可压流体时至关重要。",
            "id": "3446051",
            "problem": "考虑一个三维单组分耗散粒子动力学 (DPD) 流体，其具有标准的保守相互作用。类型为 $i$ 和 $j$ 的粒子之间的保守对力为 $F_{ij}^{\\mathrm{C}}(r) = a_{ij} w(r)$，作用范围为 $r \\le r_c$，其中 $a_{ij}$ 是保守力振幅，$w(r)$ 是一个正权重函数。假设采用典型的 DPD 选择 $w(r) = 1 - r/r_c$（当 $r \\le r_c$）和 $w(r) = 0$（当 $r  r_c$）。通过耗散力和随机力确保热化，使得流体在温度 $T$ 下是等温的。全文使用 DPD 约化单位：截断长度 $r_c = 1$ 作为长度单位，玻尔兹曼常数 $k_{\\mathrm{B}} T = 1$ 作为能量尺度，粒子质量 $m = 1$，时间单位 $\\tau = r_c \\sqrt{m/(k_{\\mathrm{B}} T)}$。数密度 $\\rho$ 以 $r_c^{-3}$ 表示，压力以 $(k_{\\mathrm{B}} T)/r_c^3$ 表示，压缩率以 $r_c^3/(k_{\\mathrm{B}} T)$ 表示，速度以 $r_c/\\tau$ 表示。\n\n基本原理：\n- 根据牛顿第二定律和维里定理，在均匀条件下，压力是动能维里和相互作用维里之和。在 $g(r) \\approx 1$（平均场近似）下，保守力的维里贡献为\n$$\nP_{\\mathrm{int}} = \\frac{2\\pi}{3} \\rho^2 \\int_{0}^{r_c} r^3 F^{\\mathrm{C}}(r)\\,\\mathrm{d}r .\n$$\n- 在温度 $T$ 下的总压力为\n$$\nP(\\rho) = \\rho k_{\\mathrm{B}} T + P_{\\mathrm{int}} .\n$$\n- 等温压缩率定义为\n$$\n\\kappa_T = \\frac{1}{\\rho} \\left( \\frac{\\partial \\rho}{\\partial P} \\right)_T = \\frac{1}{\\rho \\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T } .\n$$\n- 长波静态结构因子满足可压缩性方程\n$$\nS(0) = \\rho k_{\\mathrm{B}} T \\kappa_T .\n$$\n- 在体积为 $V$ 的巨正则系综控制体积中，粒子数涨落遵循\n$$\n\\mathrm{Var}(N) = S(0) \\langle N \\rangle ,\n$$\n因此密度涨落为\n$$\n\\left\\langle (\\delta \\rho)^2 \\right\\rangle = \\frac{\\mathrm{Var}(N)}{V^2} = \\frac{\\rho^2 k_{\\mathrm{B}} T\\,\\kappa_T}{V} .\n$$\n- 对于等温正压流体，等温声速为\n$$\nc_s^2 = \\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T = \\frac{1}{\\rho \\kappa_T} .\n$$\n- 马赫数是 $Ma = U/c_s$，其中 $U$ 是特征流速。\n\n任务 1（从推导到算法）：\n1. 使用 $F^{\\mathrm{C}}(r) = a\\, w(r)$ 和 $w(r) = 1 - r/r_c$，推导平均场保守维里：\n$$\nP_{\\mathrm{int}} = \\frac{2\\pi}{3}\\rho^2 \\int_{0}^{r_c} r^3 a\\left(1 - \\frac{r}{r_c}\\right)\\,\\mathrm{d}r = a \\rho^2 \\frac{\\pi r_c^4}{30}.\n$$\n因此，\n$$\nP(\\rho) = \\rho k_{\\mathrm{B}} T + a \\rho^2 \\frac{\\pi r_c^4}{30}.\n$$\n2. 证明\n$$\n\\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15},\n$$\n因此\n$$\nc_s^2 = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15}, \\qquad \\kappa_T = \\frac{1}{\\rho\\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right)}.\n$$\n3. 将可压缩性方程与涨落公式结合，以表示密度涨落：\n$$\n\\left\\langle (\\delta \\rho)^2 \\right\\rangle = \\frac{\\rho^2 k_{\\mathrm{B}} T}{V} \\cdot \\frac{1}{\\rho\\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right)} = \\frac{\\rho\\, k_{\\mathrm{B}} T}{V\\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right)}.\n$$\n4. 给定目标等温声速 $c_s^{\\mathrm{target}}$ 和流速为 $U$ 时的最大允许马赫数 $Ma_{\\max}$，将所需声速定义为\n$$\nc_s^{\\mathrm{req}} = \\max\\left( c_s^{\\mathrm{target}}, \\frac{U}{Ma_{\\max}} \\right).\n$$\n求解产生 $c_s^{\\mathrm{req}}$ 的保守振幅 $a$，并满足 $a \\ge 0$：\n$$\na_{\\mathrm{req}} = \\max\\left( 0,\\ \\frac{15}{\\pi r_c^4 \\rho} \\left( \\left( c_s^{\\mathrm{req}} \\right)^2 - k_{\\mathrm{B}} T \\right) \\right).\n$$\n\n任务 2（程序规范）：\n- 实现一个程序，为每个测试用例计算：\n    1. 使用上述公式和给定的初始 $a$ 计算初始等温密度涨落 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle$。\n    2. 从涨落中推断出的可压缩性\n    $$\n    \\kappa_T^{\\mathrm{infer}} = \\frac{ \\left\\langle (\\delta \\rho)^2 \\right\\rangle\\, V }{ \\rho^2 k_{\\mathrm{B}} T } .\n    $$\n    3. 理论可压缩性\n    $$\n    \\kappa_T^{\\mathrm{theory}} = \\frac{1}{\\rho\\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right)} .\n    $$\n    4. 绝对误差 $|\\kappa_T^{\\mathrm{infer}} - \\kappa_T^{\\mathrm{theory}}|$。\n    5. 满足 $c_s^{\\mathrm{req}}$ 所需的保守振幅 $a_{\\mathrm{req}}$。\n    6. 调整后的声速 $c_s^{\\mathrm{tuned}} = \\sqrt{ k_{\\mathrm{B}} T + a_{\\mathrm{req}} \\rho \\frac{\\pi r_c^4}{15} }$。\n    7. 最终的马赫数 $Ma^{\\mathrm{actual}} = U / c_s^{\\mathrm{tuned}}$。\n    8. 使用 $a_{\\mathrm{req}}$ 计算的调整后密度涨落 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle_{\\mathrm{tuned}}$。\n- 单位：以 $r_c/\\tau$ 报告 $c_s$ 和 $U$，以 $r_c^3/(k_{\\mathrm{B}} T)$ 报告 $\\kappa_T$，以 $r_c^{-6}$ 报告 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle$ 的值，而 $Ma$ 为无量纲。\n- 最终输出格式：您的程序应生成单行输出，包含每个用例的结果列表，其中每个用例是按上述顺序排列的八个浮点数的列表。输出必须是单个 Python 列表的列表，作为单行打印，例如，\"[[case1_values...],[case2_values...],...]]\"。\n\n测试套件：\n- 用例 A（一般情况，中等可压缩性）：$\\rho = 5.0$, $V = 50.0$, $a = 25.0$, $U = 0.5$, $Ma_{\\max} = 0.1$, $c_s^{\\mathrm{target}} = 5.0$, $r_c = 1.0$, $k_{\\mathrm{B}} T = 1.0$。\n- 用例 B（小体积，较强涨落）：$\\rho = 5.0$, $V = 5.0$, $a = 25.0$, $U = 0.2$, $Ma_{\\max} = 0.05$, $c_s^{\\mathrm{target}} = 10.0$, $r_c = 1.0$, $k_{\\mathrm{B}} T = 1.0$。\n- 用例 C（边界情况，$c_s^{\\mathrm{target}}$ 低于热基线）：$\\rho = 3.0$, $V = 30.0$, $a = 10.0$, $U = 0.2$, $Ma_{\\max} = 0.2$, $c_s^{\\mathrm{target}} = 0.8$, $r_c = 1.0$, $k_{\\mathrm{B}} T = 1.0$。\n- 用例 D（高密度，严格的马赫数约束）：$\\rho = 10.0$, $V = 100.0$, $a = 80.0$, $U = 1.0$, $Ma_{\\max} = 0.05$, $c_s^{\\mathrm{target}} = 8.0$, $r_c = 1.0$, $k_{\\mathrm{B}} T = 1.0$。\n\n您的程序应为每个用例计算八个所要求的量，并按以下确切顺序打印包含列表的列表的单行：$\\left[ \\left\\langle (\\delta \\rho)^2 \\right\\rangle, \\kappa_T^{\\mathrm{infer}}, \\kappa_T^{\\mathrm{theory}}, |\\Delta \\kappa_T|, a_{\\mathrm{req}}, c_s^{\\mathrm{tuned}}, Ma^{\\mathrm{actual}}, \\left\\langle (\\delta \\rho)^2 \\right\\rangle_{\\mathrm{tuned}} \\right]$，对应于用例 A，然后是用例 B、用例 C 和用例 D，并汇总到一个列表中。",
            "solution": "我们从牛顿方程和维里定理开始。对于均匀流体，压力是理想（动能）和相互作用维里贡献的总和。对于等温流体，理想项是 $P_{\\mathrm{ideal}} = \\rho k_{\\mathrm{B}} T$。在平均场近似 $g(r) \\approx 1$ 下，具有各向同性保守对力 $F^{\\mathrm{C}}(r)$ 的相互作用维里是\n$$\nP_{\\mathrm{int}} = \\frac{2\\pi}{3} \\rho^2 \\int_{0}^{r_c} r^3 F^{\\mathrm{C}}(r) \\,\\mathrm{d}r .\n$$\n使用 DPD 保守力 $F^{\\mathrm{C}}(r) = a w(r)$ 和 $w(r) = 1 - r/r_c$（当 $r \\le r_c$），我们计算径向积分：\n$$\n\\int_{0}^{r_c} r^3 a\\left(1 - \\frac{r}{r_c}\\right) \\mathrm{d}r = a \\left[ \\int_{0}^{r_c} r^3 \\mathrm{d}r - \\frac{1}{r_c} \\int_{0}^{r_c} r^4 \\mathrm{d}r \\right] = a \\left[ \\frac{r_c^4}{4} - \\frac{r_c^5}{5 r_c} \\right] = a \\left( \\frac{r_c^4}{4} - \\frac{r_c^4}{5} \\right) = a \\frac{r_c^4}{20} .\n$$\n代入维里表达式可得\n$$\nP_{\\mathrm{int}} = \\frac{2\\pi}{3} \\rho^2 \\left( a \\frac{r_c^4}{20} \\right) = a \\rho^2 \\frac{\\pi r_c^4}{30} .\n$$\n因此，平均场压力为\n$$\nP(\\rho) = \\rho k_{\\mathrm{B}} T + a \\rho^2 \\frac{\\pi r_c^4}{30} .\n$$\n我们在恒定温度 $T$ 下对 $\\rho$ 求导，以获得等温刚度：\n$$\n\\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T = k_{\\mathrm{B}} T + 2 a \\rho \\frac{\\pi r_c^4}{30} = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} .\n$$\n对于等温正压流体，等温声速由下式给出\n$$\nc_s^2 = \\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} .\n$$\n根据等温压缩率的定义，\n$$\n\\kappa_T = \\frac{1}{\\rho \\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T } = \\frac{1}{\\rho \\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right)} .\n$$\n可压缩性方程通过零波矢处的静态结构因子将长波密度涨落与 $\\kappa_T$ 联系起来：\n$$\nS(0) = \\rho k_{\\mathrm{B}} T \\kappa_T .\n$$\n在巨正则系综条件下，平均粒子数为 $\\langle N \\rangle = \\rho V$ 的控制体积 $V$ 中，粒子数涨落满足\n$$\n\\mathrm{Var}(N) = S(0) \\langle N \\rangle = \\left( \\rho k_{\\mathrm{B}} T \\kappa_T \\right) (\\rho V) = \\rho^2 V k_{\\mathrm{B}} T \\kappa_T .\n$$\n转换为密度涨落，\n$$\n\\left\\langle (\\delta \\rho)^2 \\right\\rangle = \\frac{ \\mathrm{Var}(N) }{ V^2 } = \\frac{ \\rho^2 V k_{\\mathrm{B}} T \\kappa_T }{V^2} = \\frac{ \\rho^2 k_{\\mathrm{B}} T \\kappa_T}{V} .\n$$\n代入 $\\kappa_T$ 的表达式，可得到密度涨落的封闭形式预测：\n$$\n\\left\\langle (\\delta \\rho)^2 \\right\\rangle = \\frac{ \\rho^2 k_{\\mathrm{B}} T }{ V } \\cdot \\frac{1}{ \\rho \\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right) } = \\frac{ \\rho k_{\\mathrm{B}} T }{ V \\left( k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15} \\right) } .\n$$\n这些关系允许进行一致性检查：通过测量的 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle$ 推断 $\\kappa_T$\n$$\n\\kappa_T^{\\mathrm{infer}} = \\frac{ \\left\\langle (\\delta \\rho)^2 \\right\\rangle V }{ \\rho^2 k_{\\mathrm{B}} T }\n$$\n如果测量是理想的并且平均场假设成立，则该值必须与理论值 $\\kappa_T^{\\mathrm{theory}}$ 相匹配。绝对差\n$$\n|\\Delta \\kappa_T| = \\left| \\kappa_T^{\\mathrm{infer}} - \\kappa_T^{\\mathrm{theory}} \\right|\n$$\n量化了任何差异。\n\n为了在给定的马赫数约束下，调整保守振幅 $a$ 以达到目标声速，同时最小化声学伪影，我们利用了等温流中由可压缩性驱动的声学伪影与 $\\mathcal{O}(Ma^2)$ 成比例这一事实。对于给定的特征速度 $U$ 和最大允许马赫数 $Ma_{\\max}$，所需的声速是\n$$\nc_s^{\\mathrm{req}} = \\max\\left( c_s^{\\mathrm{target}}, \\frac{U}{Ma_{\\max}} \\right) .\n$$\n求解 $c_s^2 = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15}$ 关于 $a$ 可得\n$$\na = \\frac{15}{\\pi r_c^4 \\rho} \\left( c_s^2 - k_{\\mathrm{B}} T \\right) .\n$$\n施加 DPD 排斥力非负的物理约束，我们取\n$$\na_{\\mathrm{req}} = \\max\\left( 0,\\ \\frac{15}{\\pi r_c^4 \\rho} \\left( \\left( c_s^{\\mathrm{req}} \\right)^2 - k_{\\mathrm{B}} T \\right) \\right) .\n$$\n那么调整后的声速是\n$$\nc_s^{\\mathrm{tuned}} = \\sqrt{ k_{\\mathrm{B}} T + a_{\\mathrm{req}} \\rho \\frac{\\pi r_c^4}{15} } ,\n$$\n最终的马赫数是\n$$\nMa^{\\mathrm{actual}} = \\frac{U}{ c_s^{\\mathrm{tuned}} } .\n$$\n最后，调整后的密度涨落计算如下\n$$\n\\left\\langle (\\delta \\rho)^2 \\right\\rangle_{\\mathrm{tuned}} = \\frac{ \\rho^2 k_{\\mathrm{B}} T }{V} \\cdot \\frac{1}{ \\rho \\left( k_{\\mathrm{B}} T + a_{\\mathrm{req}} \\rho \\frac{\\pi r_c^4}{15} \\right) } = \\frac{ \\rho k_{\\mathrm{B}} T }{V \\left( k_{\\mathrm{B}} T + a_{\\mathrm{req}} \\rho \\frac{\\pi r_c^4}{15} \\right) } .\n$$\n\n程序中实现的算法步骤：\n- 对于每个测试用例 $(\\rho, V, a, U, Ma_{\\max}, c_s^{\\mathrm{target}}, r_c, k_{\\mathrm{B}} T)$：\n    1. 计算 $\\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T = k_{\\mathrm{B}} T + a \\rho \\frac{\\pi r_c^4}{15}$。\n    2. 计算 $\\kappa_T^{\\mathrm{theory}} = \\frac{1}{\\rho \\left( \\frac{\\partial P}{\\partial \\rho} \\right)_T }$。\n    3. 计算 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle = \\frac{ \\rho^2 k_{\\mathrm{B}} T }{V} \\kappa_T^{\\mathrm{theory}}$。\n    4. 推断 $\\kappa_T^{\\mathrm{infer}} = \\frac{ \\left\\langle (\\delta \\rho)^2 \\right\\rangle V }{ \\rho^2 k_{\\mathrm{B}} T }$ 和绝对误差 $|\\Delta \\kappa_T|$。\n    5. 确定 $c_s^{\\mathrm{req}} = \\max( c_s^{\\mathrm{target}}, U/Ma_{\\max} )$ 并计算非负的 $a_{\\mathrm{req}}$。\n    6. 使用 $a_{\\mathrm{req}}$ 计算 $c_s^{\\mathrm{tuned}}$、$Ma^{\\mathrm{actual}}$ 和 $\\left\\langle (\\delta \\rho)^2 \\right\\rangle_{\\mathrm{tuned}}$。\n- 将每个用例的八个输出聚合成一个列表，并按要求将包含所有四个用例列表的单个列表打印在同一行上。\n\n该流程定量地将 DPD 流体中的可压缩性、密度涨落和声学效应联系起来，并提供了一种有原则的方法来调整保守力振幅，以在中尺度流体动力学中满足马赫数约束下实现目标等温声学特性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef dp_drho_isothermal(rho, a, rc, kBT):\n    # dP/d rho at constant T: kBT + a * rho * pi * rc^4 / 15\n    return kBT + a * rho * np.pi * (rc**4) / 15.0\n\ndef kappa_T_theory(rho, a, rc, kBT):\n    dpdrho = dp_drho_isothermal(rho, a, rc, kBT)\n    return 1.0 / (rho * dpdrho)\n\ndef density_variance(rho, V, a, rc, kBT):\n    # (delta rho)^2 = rho^2 * kBT * kappa_T / V\n    kappa = kappa_T_theory(rho, a, rc, kBT)\n    return (rho**2) * kBT * kappa / V\n\ndef infer_kappa_T_from_variance(var_rho, rho, V, kBT):\n    # kappa_T_infer = var_rho * V / (rho^2 * kBT)\n    return var_rho * V / (rho**2 * kBT)\n\ndef required_a_for_cs(rho, rc, kBT, cs_req):\n    # a_req = max(0, (15/(pi rc^4 rho)) * (cs_req^2 - kBT))\n    a_raw = (15.0 / (np.pi * (rc**4) * rho)) * (cs_req**2 - kBT)\n    return max(0.0, a_raw)\n\ndef tuned_cs(rho, a, rc, kBT):\n    # cs^2 = kBT + a * rho * pi * rc^4 / 15\n    return np.sqrt(dp_drho_isothermal(rho, a, rc, kBT))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (rho, V, a_initial, U, Ma_max, cs_target, rc, kBT)\n    test_cases = [\n        (5.0, 50.0, 25.0, 0.5, 0.1, 5.0, 1.0, 1.0),   # Case A\n        (5.0, 5.0, 25.0, 0.2, 0.05, 10.0, 1.0, 1.0),  # Case B\n        (3.0, 30.0, 10.0, 0.2, 0.2, 0.8, 1.0, 1.0),   # Case C\n        (10.0, 100.0, 80.0, 1.0, 0.05, 8.0, 1.0, 1.0) # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, V, a_init, U, Ma_max, cs_target, rc, kBT = case\n\n        # Initial theoretical compressibility and density variance\n        dpdrho_init = dp_drho_isothermal(rho, a_init, rc, kBT)\n        kappa_th = 1.0 / (rho * dpdrho_init)\n        var_init = (rho**2) * kBT * kappa_th / V\n\n        # Inferred compressibility from variance\n        kappa_infer = infer_kappa_T_from_variance(var_init, rho, V, kBT)\n        abs_error = abs(kappa_infer - kappa_th)\n\n        # Required speed of sound to satisfy target and Mach constraint\n        cs_req = max(cs_target, U / Ma_max)\n\n        # Compute required a (nonnegative)\n        a_req = required_a_for_cs(rho, rc, kBT, cs_req)\n\n        # Tuned sound speed, Mach number, and tuned variance\n        cs_tuned = tuned_cs(rho, a_req, rc, kBT)\n        Ma_actual = U / cs_tuned\n        # Tuned variance using tuned a\n        var_tuned = density_variance(rho, V, a_req, rc, kBT)\n\n        results.append([\n            var_init,\n            kappa_infer,\n            kappa_th,\n            abs_error,\n            a_req,\n            cs_tuned,\n            Ma_actual,\n            var_tuned\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"{results}\")\n\nsolve()\n```"
        },
        {
            "introduction": "介观模拟方法的最终考验在于其能否准确再现宏观物理现象。本练习 () 提供了一个经典的验证案例：通过模拟胶体颗粒在流体中的沉降过程来检验斯托克斯定律。此练习不仅是一个简单的理论应用，它还要求学生考虑由周期性边界条件引起的有限尺寸效应并进行修正，这是几乎所有粒子模拟中都必须面对的实际问题，从而将理论预测与模拟“测量”进行严谨的比较。",
            "id": "3446122",
            "problem": "你需要编写一个完整、可运行的程序，模拟耗散粒子动力学 (DPD) 如何在立方周期性边界条件下，为一个在重力作用下于粘性牛顿流体溶剂中沉降的球形胶体恢复介观流体动力学行为。目标是从第一性原理计算终端沉降速度，并在考虑周期性边界效应后，验证斯托克斯预测。\n\n你的推导和算法必须严格基于以下基本定律和经过充分检验的公式：\n- 牛顿第二定律指出，动量的时间变化率等于作用力的总和。在达到终端速度时，加速度为零，粒子所受合力为零。\n- 在重力加速度为 $g$ 的条件下，一个半径为 $R$、密度为 $\\rho_p$（粒子）和 $\\rho$（溶剂）的球形粒子所受的重力-浮力为 $F_g = \\frac{4}{3}\\pi R^3 (\\rho_p - \\rho) g$。\n- 在蠕动流（低雷诺数）极限下，且粒子表面满足无滑移条件时，一个在粘度为 $\\eta$ 的牛顿溶剂中以速度 $U$ 运动的球体所受的斯托克斯阻力为 $F_d = 6\\pi \\eta R U$。\n- 在边长为 $L$ 的立方、三重周期性域中，流体动力学长程相互作用会改变迁移率。对于在上述条件下沉降的单个球体，其平动迁移率的主阶周期性校正可由 Hasimoto 级数很好地描述。记 $\\alpha = R/L$。则无量纲迁移率因子为 $M(\\alpha) = 1 - c_1 \\alpha + c_3 \\alpha^3 + \\mathcal{O}(\\alpha^5)$，其中 $c_1 = 2.837297$ 且 $c_3 = 4.19$。这将通过乘法因子 $M(\\alpha)$ 来修正无限域中的终端速度。\n\n基于以上原理，通过稳态下的力平衡推导出无限域中的终端速度，然后应用周期性校正因子 $M(\\alpha)$ 得到周期性盒子中的预测终端速度。使用此结果与一个给定的“测量”终端速度进行比较，你应将该测量值理解为来自一个已进行时间平均直至达到稳态的 DPD 模拟。\n\n你的程序必须：\n- 对于每个测试用例，计算以米/秒为单位的无限域终端速度，然后应用上述周期性边界校正，得到以米/秒为单位的预测终端速度。\n- 计算相对误差 $e = \\frac{\\lvert U_{\\text{meas}} - U_{\\text{pred}}\\rvert}{\\lvert U_{\\text{pred}}\\rvert}$，结果为小数。如果 $U_{\\text{pred}} = 0$，则改用绝对误差准则：若 $\\lvert U_{\\text{meas}}\\rvert \\le \\tau_{\\text{abs}}$，则认为比较有效，其中 $\\tau_{\\text{abs}}$ 是一个以米/秒为单位的微小绝对阈值。\n- 通过检查 $e \\le \\tau_{\\text{rel}}$ 来验证带有周期性校正的斯托克斯定律，其中 $\\tau_{\\text{rel}}$ 是一个以小数表示的相对容差。使用 $\\tau_{\\text{rel}} = 0.03$ 和 $\\tau_{\\text{abs}} = 1\\times 10^{-12}$。\n\n物理单位和数值要求：\n- 所有输入必须按国际单位制（SI units）解释。半径和长度单位为米，密度单位为千克/立方米，重力加速度单位为米/秒平方，粘度单位为帕斯卡·秒，速度单位为米/秒。\n- 所有内部计算的速度均以米/秒表示。相对误差是无量纲的，必须计算为小数（例如，百分之二表示为 $0.02$）。\n\n测试套件：\n对于下方的每个测试用例，给定参数为 $(\\rho_p, \\rho, g, R, \\eta, L, U_{\\text{meas}})$。\n\n1. 正常路径，带有中等周期性校正：\n   - $\\rho_p = 2000\\,\\text{kg/m}^3$, $\\rho = 1000\\,\\text{kg/m}^3$, $g = 9.81\\,\\text{m/s}^2$, $R = 1.0\\times 10^{-6}\\,\\text{m}$, $\\eta = 1.0\\times 10^{-3}\\,\\text{Pa}\\cdot\\text{s}$, $L = 5.0\\times 10^{-5}\\,\\text{m}$, $U_{\\text{meas}} = 2.077930593644\\times 10^{-6}\\,\\text{m/s}$。\n\n2. 大盒子，周期性校正可忽略：\n   - $\\rho_p = 2000\\,\\text{kg/m}^3$, $\\rho = 1000\\,\\text{kg/m}^3$, $g = 9.81\\,\\text{m/s}^2$, $R = 1.0\\times 10^{-6}\\,\\text{m}$, $\\eta = 1.0\\times 10^{-3}\\,\\text{Pa}\\cdot\\text{s}$, $L = 1.0\\times 10^{-3}\\,\\text{m}$, $U_{\\text{meas}} = 2.1629456277627886\\times 10^{-6}\\,\\text{m/s}$。\n\n3. 边界条件（中性浮力）：\n   - $\\rho_p = 1000\\,\\text{kg/m}^3$, $\\rho = 1000\\,\\text{kg/m}^3$, $g = 9.81\\,\\text{m/s}^2$, $R = 1.0\\times 10^{-6}\\,\\text{m}$, $\\eta = 1.0\\times 10^{-3}\\,\\text{Pa}\\cdot\\text{s}$, $L = 1.0\\times 10^{-4}\\,\\text{m}$, $U_{\\text{meas}} = 0.0\\,\\text{m/s}$。\n\n4. 小盒子，强周期性校正（带有故意轻微不匹配的边界情况）：\n   - $\\rho_p = 2000\\,\\text{kg/m}^3$, $\\rho = 1000\\,\\text{kg/m}^3$, $g = 9.81\\,\\text{m/s}^2$, $R = 1.0\\times 10^{-6}\\,\\text{m}$, $\\eta = 1.0\\times 10^{-3}\\,\\text{Pa}\\cdot\\text{s}$, $L = 5.0\\times 10^{-6}\\,\\text{m}$, $U_{\\text{meas}} = 1.07697283448\\times 10^{-6}\\,\\text{m/s}$。\n\n5. 不同的溶剂粘度和颗粒尺寸：\n   - $\\rho_p = 1500\\,\\text{kg/m}^3$, $\\rho = 1000\\,\\text{kg/m}^3$, $g = 9.81\\,\\text{m/s}^2$, $R = 5.0\\times 10^{-7}\\,\\text{m}$, $\\eta = 2.0\\times 10^{-3}\\,\\text{Pa}\\cdot\\text{s}$, $L = 2.0\\times 10^{-5}\\,\\text{m}$, $U_{\\text{meas}} = 1.2912626475515624\\times 10^{-7}\\,\\text{m/s}$。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含一个逗号分隔的 Python 风格布尔值列表，按测试用例的顺序给出验证结果，例如：$[{\\rm True},{\\rm False},{\\rm True},\\dots]$。",
            "solution": "该问题要求将周期性域中单个球形胶体沉降的介观流体动力学预测与模拟的“测量”数据进行验证。验证过程如下：首先从第一性原理推导终端沉降速度，然后引入周期性边界条件的校正，最后将此预测值与给定数据在指定容差范围内进行比较。\n\n分析分为三个阶段：首先，推导孤立球体在无限流体中的终端速度（$U_{\\infty}$）；其次，应用立方周期性域的校正因子以获得预测速度（$U_{\\text{pred}}$）；第三，建立验证协议，以比较 $U_{\\text{pred}}$ 和测量速度（$U_{\\text{meas}}$）。\n\n根据牛顿第二定律，当作用在粒子上的合力为零时，粒子达到恒定的终端速度。在此沉降问题中，考虑两种力：驱动沉降的重力-浮力 $F_g$，以及与运动方向相反的流体动力学阻力 $F_d$。在稳态下，这些力相互平衡：\n$$\n\\sum F = F_g - F_d = 0 \\implies F_g = F_d\n$$\n问题给出了这些力的表达式。对于半径为 $R$、粒子密度为 $\\rho_p$、溶剂密度为 $\\rho$ 的球体，在重力加速度为 $g$ 的情况下，其所受的重力-浮力为：\n$$\nF_g = \\frac{4}{3}\\pi R^3 (\\rho_p - \\rho) g\n$$\n在低雷诺数（蠕动流）区域，该球体以速度 $U$ 通过动力粘度为 $\\eta$ 的溶剂时所受的斯托克斯阻力为：\n$$\nF_d = 6\\pi \\eta R U\n$$\n通过令这两个力相等，我们可以解出在无限、无界域中的终端速度，记为 $U_{\\infty}$：\n$$\n6\\pi \\eta R U_{\\infty} = \\frac{4}{3}\\pi R^3 (\\rho_p - \\rho) g\n$$\n解出 $U_{\\infty}$，得到斯托克斯沉降速度：\n$$\nU_{\\infty} = \\frac{\\frac{4}{3}\\pi R^3 (\\rho_p - \\rho) g}{6\\pi \\eta R} = \\frac{4 R^2 (\\rho_p - \\rho) g}{18 \\eta} = \\frac{2}{9} \\frac{R^2 (\\rho_p - \\rho) g}{\\eta}\n$$\n此表达式给出了没有边界效应时的基准速度。当粒子处于中性浮力状态（即 $\\rho_p = \\rho$）时，会出现一个特殊情况。此时，$F_g = 0$，因此 $U_{\\infty} = 0$。\n\n接下来，我们考虑周期性边界条件的影响。在使用边长为 $L$ 的立方周期性盒子的模拟中，粒子与其自身的周期性镜像相互作用，这会改变流体动力学阻力。这种效应由一个无量纲迁移率因子 $M(\\alpha)$ 捕获，该因子是比率 $\\alpha = R/L$ 的函数。问题指定了该因子的 Hasimoto 级数展开式，截断至 $\\alpha^3$ 项：\n$$\nM(\\alpha) = 1 - c_1 \\alpha + c_3 \\alpha^3 + \\mathcal{O}(\\alpha^5)\n$$\n给定的常数为 $c_1 = 2.837297$ 和 $c_3 = 4.19$。周期性系统中的预测终端速度 $U_{\\text{pred}}$ 是通过将无限域速度乘以该迁移率因子得到的：\n$$\nU_{\\text{pred}} = U_{\\infty} \\times M(\\alpha) = \\left( \\frac{2}{9} \\frac{R^2 (\\rho_p - \\rho) g}{\\eta} \\right) \\left( 1 - c_1 \\frac{R}{L} + c_3 \\left(\\frac{R}{L}\\right)^3 \\right)\n$$\n最后，我们必须建立一个明确的准则，用于将 DPD“测量值” $U_{\\text{meas}}$ 与我们的理论预测值 $U_{\\text{pred}}$ 进行验证。验证方法取决于预测速度是否为零。\n\n情况1：$U_{\\text{pred}} \\ne 0$（即 $\\rho_p \\ne \\rho$）。\n相对误差 $e$ 计算如下：\n$$\ne = \\frac{\\lvert U_{\\text{meas}} - U_{\\text{pred}}\\rvert}{\\lvert U_{\\text{pred}}\\rvert}\n$$\n如果该误差在指定的相对容差 $\\tau_{\\text{rel}} = 0.03$ 范围内，则验证成功。也就是说，如果 $e \\le 0.03$，结果为 `True`。\n\n情况2：$U_{\\text{pred}} = 0$（即 $\\rho_p = \\rho$）。\n在这种情况下，相对误差无定义。验证将改为基于一个绝对容差 $\\tau_{\\text{abs}} = 1 \\times 10^{-12}\\,\\text{m/s}$。如果测量速度的量级可以忽略不计，则验证成功，即：\n$$\n\\lvert U_{\\text{meas}} \\rvert \\le \\tau_{\\text{abs}}\n$$\n将要实现的算法将遍历每个测试用例，应用这些推导出的公式来计算 $U_{\\text{pred}}$，然后使用相应的验证准则来确定一个布尔结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the predicted terminal settling velocity of a spherical colloid in a\n    periodic box and verifies it against a \"measured\" value from a DPD simulation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (rho_p, rho, g, R, eta, L, U_meas)\n    test_cases = [\n        # 1. Happy path with moderate periodic correction\n        (2000.0, 1000.0, 9.81, 1.0e-6, 1.0e-3, 5.0e-5, 2.077930593644e-6),\n        # 2. Large box, negligible periodic correction\n        (2000.0, 1000.0, 9.81, 1.0e-6, 1.0e-3, 1.0e-3, 2.1629456277627886e-6),\n        # 3. Boundary condition (neutral buoyancy)\n        (1000.0, 1000.0, 9.81, 1.0e-6, 1.0e-3, 1.0e-4, 0.0),\n        # 4. Small box, strong periodic correction\n        (2000.0, 1000.0, 9.81, 1.0e-6, 1.0e-3, 5.0e-6, 1.07697283448e-6),\n        # 5. Different solvent viscosity and particle size\n        (1500.0, 1000.0, 9.81, 5.0e-7, 2.0e-3, 2.0e-5, 1.2912626475515624e-7),\n    ]\n\n    # Constants and tolerances\n    c1 = 2.837297\n    c3 = 4.19\n    tau_rel = 0.03\n    tau_abs = 1.0e-12\n\n    results = []\n    for case in test_cases:\n        rho_p, rho, g, R, eta, L, u_meas = case\n        \n        # Check for the neutral buoyancy case first to avoid division by zero later\n        if rho_p == rho:\n            u_pred = 0.0\n            is_valid = abs(u_meas) = tau_abs\n            results.append(is_valid)\n            continue\n            \n        # Step 1: Calculate the infinite-domain terminal velocity (U_infinity)\n        # U_infinity = (2 * R^2 * (rho_p - rho) * g) / (9 * eta)\n        u_infinity = (2.0 / 9.0) * (R**2 * (rho_p - rho) * g) / eta\n\n        # Step 2: Calculate the periodic correction factor M(alpha)\n        alpha = R / L\n        # M(alpha) = 1 - c1*alpha + c3*alpha^3\n        m_alpha = 1.0 - c1 * alpha + c3 * (alpha**3)\n        \n        # Step 3: Calculate the predicted terminal velocity in the periodic box\n        u_pred = u_infinity * m_alpha\n\n        # Step 4: Verify against the \"measured\" velocity using relative error\n        # e = |U_meas - U_pred| / |U_pred|\n        if u_pred != 0.0:\n            relative_error = abs(u_meas - u_pred) / abs(u_pred)\n            is_valid = relative_error = tau_rel\n        else:\n            # This branch should not be reached due to the initial check for rho_p == rho,\n            # but is included for logical completeness.\n            is_valid = abs(u_meas) = tau_abs\n            \n        results.append(is_valid)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [str(r) for r in results]))}]\")\n\nsolve()\n```"
        }
    ]
}