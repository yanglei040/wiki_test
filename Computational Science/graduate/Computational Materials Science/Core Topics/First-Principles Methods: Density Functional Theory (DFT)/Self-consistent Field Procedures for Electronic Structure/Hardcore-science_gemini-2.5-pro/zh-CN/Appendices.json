{
    "hands_on_practices": [
        {
            "introduction": "自洽场 (SCF) 计算的核心是一个迭代过程：根据输入电荷密度生成输出电荷密度，然后将两者混合以构建下一次迭代的输入。这项练习将引导你完成这个过程的一个具体步骤，以巩固对密度构建和线性混合在稳定收敛中作用的理解。通过亲自计算由一组轨道产生的输出密度，并将之与输入密度混合，你将对 SCF 循环的基本机制有更深刻的认识 。",
            "id": "3486399",
            "problem": "考虑一个密度泛函理论（DFT）的 Kohn–Sham 公式下的一维无相互作用电子模型，其中单体电子密度由一组正交归一的单粒子轨道及其占据数得到。设正交归一的轨道是质量为 $m$、角频率为 $\\omega$ 的一维量子谐振子的前两个本征函数，采用标准归一化约定：\n$$\n\\psi_{0}(x) = \\left(\\frac{m \\omega}{\\pi \\hbar}\\right)^{\\frac{1}{4}} \\exp\\!\\left(-\\frac{m \\omega}{2 \\hbar} x^{2}\\right), \\quad \\psi_{1}(x) = \\left(\\frac{m \\omega}{\\pi \\hbar}\\right)^{\\frac{1}{4}} \\sqrt{2}\\,\\sqrt{\\frac{m \\omega}{\\hbar}}\\, x \\exp\\!\\left(-\\frac{m \\omega}{2 \\hbar} x^{2}\\right).\n$$\n假设占据数分别为 $f_{0} = 1$ 和 $f_{1} = \\frac{1}{2}$，并且进入自洽场（SCF）程序的输入密度是一个归一化的高斯函数，其积分等于总电子数 $N = f_{0} + f_{1}$：\n$$\n\\rho_{\\text{in}}(x) = N \\sqrt{\\frac{b}{\\pi}} \\exp(-b x^{2}), \\quad b0,\n$$\n其中 $N = f_{0} + f_{1}$，$\\hbar$ 是约化普朗克常数。\n\n仅使用 Kohn-Sham 形式中单体密度的标准定义以及正交归一轨道的 Slater 行列式构造，计算与集合 $\\{\\psi_{i}\\}$ 和 $\\{f_{i}\\}$ 相关联的输出密度 $\\rho_{\\text{out}}(x)$。然后，解释在不动点迭代中进行密度混合的基本原理，并使用线性混合方法（混合参数为 $\\alpha \\in (0,1)$）构建下一次迭代的混合密度 $\\rho_{\\text{next}}(x)$。请以 $\\rho_{\\text{out}}(x)$ 和 $\\rho_{\\text{next}}(x)$ 的封闭形式解析表达式给出您的最终结果。\n\n将您的最终答案表示为变量为 $x$、参数为 $m$、$\\omega$、$\\hbar$、$b$ 和 $\\alpha$ 的解析函数。无需进行数值取整。如果提供多个表达式，请将它们写成一个单行矩阵。最终答案框中无需报告物理单位。",
            "solution": "该问题已经过验证，被认为是科学上可靠、提法恰当且客观的。这是计算电子结构理论中的一个标准理论练习。所有必要的数据和定义都已提供，问题没有矛盾或含糊之处。\n\n在 Kohn-Sham 形式中，单体电子密度 $\\rho(x)$ 是根据单粒子轨道集 $\\{\\psi_i(x)\\}$ 及其相应的占据数 $\\{f_i\\}$ 通过以下公式构建的：\n$$\n\\rho(x) = \\sum_{i} f_{i} |\\psi_{i}(x)|^{2}\n$$\n\n首先，我们使用给定的轨道 $\\psi_{0}(x)$ 和 $\\psi_{1}(x)$ 以及占据数 $f_{0}=1$ 和 $f_{1}=\\frac{1}{2}$ 来计算输出密度 $\\rho_{\\text{out}}(x)$。\n\n给定的正交归一轨道为：\n$$\n\\psi_{0}(x) = \\left(\\frac{m \\omega}{\\pi \\hbar}\\right)^{\\frac{1}{4}} \\exp\\left(-\\frac{m \\omega}{2 \\hbar} x^{2}\\right)\n$$\n$$\n\\psi_{1}(x) = \\left(\\frac{m \\omega}{\\pi \\hbar}\\right)^{\\frac{1}{4}} \\sqrt{2}\\,\\sqrt{\\frac{m \\omega}{\\hbar}}\\, x \\exp\\left(-\\frac{m \\omega}{2 \\hbar} x^{2}\\right)\n$$\n为简化表示，我们定义参数 $\\gamma = \\frac{m \\omega}{\\hbar}$。于是轨道可以写成：\n$$\n\\psi_{0}(x) = \\left(\\frac{\\gamma}{\\pi}\\right)^{\\frac{1}{4}} \\exp\\left(-\\frac{\\gamma}{2} x^{2}\\right)\n$$\n$$\n\\psi_{1}(x) = \\left(\\frac{\\gamma}{\\pi}\\right)^{\\frac{1}{4}} \\sqrt{2\\gamma}\\, x \\exp\\left(-\\frac{\\gamma}{2} x^{2}\\right)\n$$\n接下来，我们求这些轨道的模的平方：\n$$\n|\\psi_{0}(x)|^{2} = \\left[ \\left(\\frac{\\gamma}{\\pi}\\right)^{\\frac{1}{4}} \\exp\\left(-\\frac{\\gamma}{2} x^{2}\\right) \\right]^2 = \\sqrt{\\frac{\\gamma}{\\pi}} \\exp(-\\gamma x^{2})\n$$\n$$\n|\\psi_{1}(x)|^{2} = \\left[ \\left(\\frac{\\gamma}{\\pi}\\right)^{\\frac{1}{4}} \\sqrt{2\\gamma}\\, x \\exp\\left(-\\frac{\\gamma}{2} x^{2}\\right) \\right]^2 = \\sqrt{\\frac{\\gamma}{\\pi}} (2\\gamma x^{2}) \\exp(-\\gamma x^{2})\n$$\n现在，我们可以使用占据数 $f_{0}=1$ 和 $f_{1}=\\frac{1}{2}$ 来构建输出密度 $\\rho_{\\text{out}}(x)$：\n$$\n\\rho_{\\text{out}}(x) = f_{0} |\\psi_{0}(x)|^{2} + f_{1} |\\psi_{1}(x)|^{2}\n$$\n$$\n\\rho_{\\text{out}}(x) = (1) \\left(\\sqrt{\\frac{\\gamma}{\\pi}} \\exp(-\\gamma x^{2})\\right) + \\left(\\frac{1}{2}\\right) \\left(\\sqrt{\\frac{\\gamma}{\\pi}} (2\\gamma x^{2}) \\exp(-\\gamma x^{2})\\right)\n$$\n$$\n\\rho_{\\text{out}}(x) = \\sqrt{\\frac{\\gamma}{\\pi}} \\exp(-\\gamma x^{2}) + \\sqrt{\\frac{\\gamma}{\\pi}} \\gamma x^{2} \\exp(-\\gamma x^{2})\n$$\n提取公因式，我们得到：\n$$\n\\rho_{\\text{out}}(x) = \\sqrt{\\frac{\\gamma}{\\pi}} (1 + \\gamma x^{2}) \\exp(-\\gamma x^{2})\n$$\n将 $\\gamma = \\frac{m \\omega}{\\hbar}$ 代回，输出密度的最终表达式为：\n$$\n\\rho_{\\text{out}}(x) = \\sqrt{\\frac{m \\omega}{\\pi \\hbar}} \\left(1 + \\frac{m \\omega}{\\hbar} x^{2}\\right) \\exp\\left(-\\frac{m \\omega}{\\hbar} x^{2}\\right)\n$$\n此密度的总电子数为 $\\int_{-\\infty}^{\\infty} \\rho_{\\text{out}}(x) dx = f_{0} \\int |\\psi_{0}|^2 dx + f_{1} \\int |\\psi_{1}|^2 dx = f_{0}(1) + f_{1}(1) = 1 + \\frac{1}{2} = \\frac{3}{2}$，这与定义 $N = f_{0} + f_{1}$ 一致。\n\n接下来，我们讨论密度混合的基本原理。自洽场（SCF）程序是一个迭代过程，旨在寻找映射 $\\mathcal{F}$ 的一个不动点，其中 $\\rho_{\\text{out}} = \\mathcal{F}(\\rho_{\\text{in}})$。一个简单的不动点迭代使用第 $k$ 步的全部输出来更新第 $k+1$ 步的密度：$\\rho_{k+1} = \\rho_{\\text{out},k}$。这个过程通常不稳定且难以收敛。输出密度可能会对输入密度中的误差进行过度修正，导致连续迭代之间出现大的、无阻尼的振荡（通常称为“电荷振荡”）。密度混合是一种数值技术，用于抑制这些振荡并稳定收敛过程。在线性混合中，下一次迭代的密度由当前迭代的输入密度和输出密度的线性组合构成：\n$$\n\\rho_{\\text{next}}(x) = (1-\\alpha) \\rho_{\\text{in}}(x) + \\alpha \\rho_{\\text{out}}(x)\n$$\n混合参数 $\\alpha \\in (0,1)$ 控制步长。一个较小的 $\\alpha$ 值确保密度被谨慎地更新，这可以减轻振荡并提高达到自洽解的可能性，尽管这可能会以较慢的收敛速度为代价。\n\n最后，我们使用给定的输入密度 $\\rho_{\\text{in}}(x)$、计算出的输出密度 $\\rho_{\\text{out}}(x)$ 和混合参数 $\\alpha$ 来计算混合密度 $\\rho_{\\text{next}}(x)$。\n总电子数为 $N = f_0 + f_1 = 1 + \\frac{1}{2} = \\frac{3}{2}$。输入密度由下式给出：\n$$\n\\rho_{\\text{in}}(x) = N \\sqrt{\\frac{b}{\\pi}} \\exp(-b x^{2}) = \\frac{3}{2} \\sqrt{\\frac{b}{\\pi}} \\exp(-b x^{2})\n$$\n使用线性混合公式，我们将 $\\rho_{\\text{in}}(x)$ 和 $\\rho_{\\text{out}}(x)$ 组合起来：\n$$\n\\rho_{\\text{next}}(x) = (1-\\alpha) \\left( \\frac{3}{2} \\sqrt{\\frac{b}{\\pi}} \\exp(-b x^{2}) \\right) + \\alpha \\left( \\sqrt{\\frac{m \\omega}{\\pi \\hbar}} \\left(1 + \\frac{m \\omega}{\\hbar} x^{2}\\right) \\exp\\left(-\\frac{m \\omega}{\\hbar} x^{2}\\right) \\right)\n$$\n该表达式代表了用于后续SCF迭代的输入电子密度。由于指数项中的系数不同（即 $-b x^2$ 和 $-\\frac{m \\omega}{\\hbar} x^2$），这两项不能进一步简化。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{\\frac{m \\omega}{\\pi \\hbar}} \\left(1 + \\frac{m \\omega}{\\hbar} x^{2}\\right) \\exp\\left(-\\frac{m \\omega}{\\hbar} x^{2}\\right)  (1-\\alpha) \\frac{3}{2} \\sqrt{\\frac{b}{\\pi}} \\exp(-b x^{2}) + \\alpha \\sqrt{\\frac{m \\omega}{\\pi \\hbar}} \\left(1 + \\frac{m \\omega}{\\hbar} x^{2}\\right) \\exp\\left(-\\frac{m \\omega}{\\hbar} x^{2}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "简单的线性混合虽然直观，但在许多实际系统中收敛缓慢甚至发散。为了解决这个问题，计算科学家们开发了更强大的收敛加速算法。这项练习将向你介绍一种被广泛使用的高效技术——迭代子空间直接求逆 (DIIS) 。通过推导并求解 DIIS 方程，你将深入了解该方法如何利用之前迭代的历史信息来外推出一个更优的解，从而显著加速自洽过程。",
            "id": "3486427",
            "problem": "考虑密度泛函理论中 Kohn–Sham 方程的一次自洽场迭代，其中，在迭代子空间中已收集了三个先前的试探密度矩阵 $\\{D_1, D_2, D_3\\}$ 及其对应的残差向量 $\\{R_1, R_2, R_3\\}$。残差向量 $R_i$（在正交归一的分子轨道基中）定义为当前试探密度在满足广义本征值问题时的误差，它与另一个残差 $R_j$ 的内积使用 Hilbert–Schmidt 内积定义为 $\\langle R_i, R_j \\rangle = \\mathrm{Tr}\\!\\left(R_i^{\\dagger} R_j\\right)$。迭代子空间直接求逆 (DIIS) 方法通过选择系数 $\\{c_i\\}$ 来构造一个外推密度 $D^{\\mathrm{DIIS}} = \\sum_{i=1}^{3} c_i D_i$，这些系数在满足仿射约束 $\\sum_{i=1}^{3} c_i = 1$ 的条件下，最小化由残差内积构成的二次型。\n\n已知内积已被计算出来，形成了对称的残差度量矩阵 $B$，其元素为 $B_{ij} = \\langle R_i, R_j \\rangle$：\n$$\nB \\;=\\;\n\\begin{pmatrix}\n0.0400  0.0150  0.0100 \\\\\n0.0150  0.0500  0.0200 \\\\\n0.0100  0.0200  0.0600\n\\end{pmatrix}.\n$$\n从第一性原理出发——即自洽场的 Kohn–Sham 变分框架、残差及其内积的定义，以及迭代子空间中残差范数的约束最小化——推导系数 $\\{c_i\\}$ 的 Pulay 迭代子空间直接求逆 (DIIS) 线性系统，求解精确系数 $c_1$、$c_2$ 和 $c_3$，并将得到的外推密度更新 $D^{\\mathrm{DIIS}}$ 写成一个关于 $\\{D_1, D_2, D_3\\}$ 和精确系数的单一解析表达式。以精确形式表示最终的外推密度更新；无需四舍五入。",
            "solution": "该问题要求推导并求解迭代子空间直接求逆 (DIIS) 方程，以找到一组最优系数 $\\{c_1, c_2, c_3\\}$，用于在自洽场 (SCF) 过程中外推出一个新的试探密度矩阵。\n\nDIIS 过程通过一组 $n$ 个先前试探密度矩阵 $\\{D_i\\}_{i=1}^n$ 的线性组合来构造一个外推密度矩阵 $D^{\\mathrm{DIIS}}$。在本问题中，$n=3$，因此我们有：\n$$D^{\\mathrm{DIIS}} = \\sum_{i=1}^{3} c_i D_i$$\n系数 $c_i$ 是通过最小化相应的外推残差向量 $R^{\\mathrm{DIIS}}$ 的范数来确定的，该向量由各个残差向量 $\\{R_i\\}_{i=1}^3$ 的相同线性组合构成：\n$$R^{\\mathrm{DIIS}} = \\sum_{i=1}^{3} c_i R_i$$\n最小化过程受到系数之和为一的约束，这确保了如果 $D_i$ 被正确归一化（例如 $\\mathrm{Tr}(D_i S) = N_{electrons}$），外推密度 $D^{\\mathrm{DIIS}}$ 也能保持这种归一化。该约束为：\n$$\\sum_{i=1}^{3} c_i = 1$$\n需要最小化的量是外推残差向量的范数平方，$S = \\|R^{\\mathrm{DIIS}}\\|^2$。使用给定的内积定义 $\\langle R_i, R_j \\rangle = \\mathrm{Tr}(R_i^{\\dagger} R_j)$，我们可以将 $S$ 表示为关于系数 $c_i$ 的二次型：\n$$S = \\left\\langle \\sum_{i=1}^{3} c_i R_i, \\sum_{j=1}^{3} c_j R_j \\right\\rangle = \\sum_{i=1}^{3} \\sum_{j=1}^{3} c_i c_j \\langle R_i, R_j \\rangle$$\n设 $B$ 是残差内积的对称矩阵，其元素为 $B_{ij} = \\langle R_i, R_j \\rangle$。设 $\\mathbf{c}$ 是系数的列向量 $(c_1, c_2, c_3)^T$。目标函数为 $S(\\mathbf{c}) = \\mathbf{c}^T B \\mathbf{c}$。\n\n为了解决这个约束最小化问题，我们使用拉格朗日乘数法。我们定义一个包含约束的拉格朗日函数 $\\mathcal{L}$，其中 $\\lambda$ 是拉格朗日乘数：\n$$\\mathcal{L}(\\mathbf{c}, \\lambda) = \\mathbf{c}^T B \\mathbf{c} - \\lambda \\left(\\sum_{i=1}^{3} c_i - 1\\right)$$\n为求最小值，我们将 $\\mathcal{L}$ 对每个系数 $c_k$ 和乘数 $\\lambda$ 的偏导数设为零。为了形式更方便，我们可以将拉格朗日函数定义为 $\\mathcal{L}(\\mathbf{c}, \\lambda_L) = \\mathbf{c}^T B \\mathbf{c} + 2\\lambda_L (\\mathbf{1}^T\\mathbf{c} - 1)$，其中 $\\mathbf{1}$ 是一个全为 1 的列向量。\n平稳性条件是：\n$$\\frac{\\partial \\mathcal{L}}{\\partial c_k} = 0 \\quad \\text{for } k=1, 2, 3$$\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\lambda_L} = 0$$\n关于 $c_k$ 的导数是：\n$$\\frac{\\partial}{\\partial c_k} \\left( \\sum_{i,j} c_i B_{ij} c_j + 2\\lambda_L \\left(\\sum_i c_i - 1\\right) \\right) = 2 \\sum_j B_{kj} c_j + 2\\lambda_L = 0$$\n这给出了三个方程组：$\\sum_j B_{kj} c_j + \\lambda_L = 0$，对于 $k=1, 2, 3$。以矩阵形式表示，即 $B\\mathbf{c} + \\lambda_L \\mathbf{1} = \\mathbf{0}$。\n关于 $\\lambda_L$ 的导数恢复了约束条件：\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\lambda_L} = 2\\left( \\sum_i c_i - 1 \\right) = 0 \\implies \\sum_i c_i = 1$$\n综合这些结果，我们得到包含 $n+1$ 个方程（此处为 4 个方程）的 Pulay DIIS 线性系统：\n$$\n\\begin{pmatrix}\nB_{11}  B_{12}  B_{13}  1 \\\\\nB_{21}  B_{22}  B_{23}  1 \\\\\nB_{31}  B_{32}  B_{33}  1 \\\\\n1  1  1  0\n\\end{pmatrix}\n\\begin{pmatrix}\nc_1 \\\\\nc_2 \\\\\nc_3 \\\\\n\\lambda_L\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0 \\\\\n0 \\\\\n1\n\\end{pmatrix}\n$$\n这就是推导出的线性系统。为了求解系数 $\\mathbf{c}$，我们可以进行解析求解。从 $B\\mathbf{c} = -\\lambda_L \\mathbf{1}$ 出发，并假设 $B$ 是可逆的，我们得到 $\\mathbf{c} = -\\lambda_L B^{-1} \\mathbf{1}$。\n将此代入约束 $\\mathbf{1}^T \\mathbf{c} = 1$ 中：\n$$1 = \\mathbf{1}^T (-\\lambda_L B^{-1} \\mathbf{1}) = -\\lambda_L (\\mathbf{1}^T B^{-1} \\mathbf{1})$$\n这使我们能够解出拉格朗日乘数：\n$$-\\lambda_L = \\frac{1}{\\mathbf{1}^T B^{-1} \\mathbf{1}} = \\frac{1}{\\sum_{i,j} (B^{-1})_{ij}}$$\n将此代回 $\\mathbf{c}$ 的表达式中：\n$$\\mathbf{c} = \\frac{B^{-1} \\mathbf{1}}{\\sum_{i,j} (B^{-1})_{ij}}$$\n从分量上看，每个系数 $c_k$ 的解是 $B^{-1}$ 第 $k$ 行元素之和，再除以 $B^{-1}$ 所有元素的总和进行归一化：\n$$c_k = \\frac{\\sum_j (B^{-1})_{kj}}{\\sum_{i,j} (B^{-1})_{ij}}$$\n现在，我们使用给定的矩阵 $B$ 应用此公式：\n$$B = \\begin{pmatrix} 0.0400  0.0150  0.0100 \\\\ 0.0150  0.0500  0.0200 \\\\ 0.0100  0.0200  0.0600 \\end{pmatrix}$$\n为了获得精确解，我们将小数值转换为分数。给定数值的最小公分母是 $200$。\n$$B = \\begin{pmatrix} \\frac{4}{100}  \\frac{1.5}{100}  \\frac{1}{100} \\\\ \\frac{1.5}{100}  \\frac{5}{100}  \\frac{2}{100} \\\\ \\frac{1}{100}  \\frac{2}{100}  \\frac{6}{100} \\end{pmatrix} = \\frac{1}{200} \\begin{pmatrix} 8  3  2 \\\\ 3  10  4 \\\\ 2  4  12 \\end{pmatrix}$$\n令 $B_{int} = \\begin{pmatrix} 8  3  2 \\\\ 3  10  4 \\\\ 2  4  12 \\end{pmatrix}$。则 $B^{-1} = 200 \\times B_{int}^{-1}$。\n我们首先计算 $B_{int}$ 的行列式：\n$$\\det(B_{int}) = 8(10 \\cdot 12 - 4 \\cdot 4) - 3(3 \\cdot 12 - 4 \\cdot 2) + 2(3 \\cdot 4 - 10 \\cdot 2)$$\n$$\\det(B_{int}) = 8(120-16) - 3(36-8) + 2(12-20) = 8(104) - 3(28) + 2(-8) = 832 - 84 - 16 = 732$$\n接下来，我们求 $B_{int}$ 的伴随矩阵，也就是其余子式矩阵的转置：\n$$ \\mathrm{adj}(B_{int}) = \\begin{pmatrix} 10 \\cdot 12 - 4 \\cdot 4  -(3 \\cdot 12 - 2 \\cdot 4)  3 \\cdot 4 - 2 \\cdot 10 \\\\ -(3 \\cdot 12 - 4 \\cdot 2)  8 \\cdot 12 - 2 \\cdot 2  -(8 \\cdot 4 - 3 \\cdot 2) \\\\ 3 \\cdot 4 - 10 \\cdot 2  -(8 \\cdot 4 - 3 \\cdot 2)  8 \\cdot 10 - 3 \\cdot 3 \\end{pmatrix}^T $$\n$$ \\mathrm{adj}(B_{int}) = \\begin{pmatrix} 104  -28  -8 \\\\ -28  92  -26 \\\\ -8  -26  71 \\end{pmatrix} $$\n所以，$B_{int}^{-1} = \\frac{1}{732} \\mathrm{adj}(B_{int})$。而 $B^{-1} = \\frac{200}{732} \\mathrm{adj}(B_{int}) = \\frac{50}{183} \\mathrm{adj}(B_{int})$。\n为了求系数 $c_k$，我们需要 $B^{-1}$ 的行和。让我们求 $\\mathrm{adj}(B_{int})$ 的行和：\n第 1 行和：$104 - 28 - 8 = 68$\n第 2 行和：$-28 + 92 - 26 = 38$\n第 3 行和：$-8 - 26 + 71 = 37$\n$c_k$ 的分子与这些和成正比。分母与所有元素的总和成正比，即这些行和的总和：$68 + 38 + 37 = 143$。\n归一化常数 $\\frac{50}{183}$ 被约掉了，所以我们有：\n$$c_1 = \\frac{68}{143}$$\n$$c_2 = \\frac{38}{143}$$\n$$c_3 = \\frac{37}{143}$$\n作为检验，$\\sum_i c_i = \\frac{68+38+37}{143} = \\frac{143}{143} = 1$。约束条件得到满足。\n将这些精确系数代入 $D^{\\mathrm{DIIS}}$ 的表达式，即可得到最终的外推密度更新：\n$$D^{\\mathrm{DIIS}} = \\frac{68}{143} D_1 + \\frac{38}{143} D_2 + \\frac{37}{143} D_3$$\n这就是 DIIS 密度更新的最终解析表达式。",
            "answer": "$$\n\\boxed{\\frac{68}{143} D_1 + \\frac{38}{143} D_2 + \\frac{37}{143} D_3}\n$$"
        },
        {
            "introduction": "对于金属等具有挑战性的系统，即使是 DIIS 方法也可能遇到收敛困难。这促使研究者们探索在迭代过程中直接操作单粒子密度矩阵而非电荷密度的策略。这项高级练习将引导你从理论上对比标准密度混合与一种基于密度矩阵纯化的更新方案 。你将通过推导和编程实现，来分析这两种方法在不同物理情境下（例如，绝缘体与金属）的收敛特性，从而理解为何需要针对特定问题采用不同的高级收敛策略。",
            "id": "3486367",
            "problem": "考虑在 Kohn–Sham 密度泛函理论 (KS-DFT) 中的自洽场 (SCF) 程序，其中电子密度通过迭代更新以达到一个不动点，该不动点代表基态电子分布。设 SCF 映射接受一个输入密度，并通过求解一个有效单粒子薛定谔方程来产生一个输出密度，该方程的势泛函依赖于输入密度。假设不动点存在，并且 SCF 映射在不动点处是 Fréchet 可微的。SCF 映射在不动点附近的线性化定义了一个雅可比算符，其对无穷小密度微扰的作用概括了输出密度对输入微扰的响应。在金属中，费米能级附近的低能屏蔽和近简并会产生用朴素更新难以收缩的响应模式。\n\n考虑两种更新策略：\n首先，是标准的密度混合方案，其中密度的下一个迭代是通过一个混合参数将当前输入密度与新产生的输出密度进行线性混合而形成的。其次，是一种基于密度矩阵的阻尼策略，其中单粒子密度矩阵使用一个强制幂等性的纯化多项式向一个纯化的密度矩阵进行阻尼；该阻尼由一个单独的参数控制。假设纯化多项式是 McWeeny 多项式，并且对微扰的分析可以在不动点密度矩阵的本征基中逐模式地进行，将每个模式视为一个具有相应占据数的标量。McWeeny 多项式作用于本征值，其在占据数处的导数值决定了由纯化引起的该模式中微扰的局部谱收缩。\n\n从上述基本基础出发，在不引用目标量的预先推导公式的情况下，执行以下操作：\n1. 推导标准密度混合更新的线性化误差传播算符。用 SCF 映射的雅可比算符的本征值和混合参数表示其谱。\n2. 推导与 McWeeny 纯化相结合的密度矩阵阻尼的线性化误差传播算符，假设微扰与不动点密度矩阵对易，并且可在相同基中对角化。用雅可比算符的本征值、阻尼参数以及在模式占据数处计算的纯化多项式导数值表示其谱。\n3. 使用不动点迭代的收敛判据，确定一个必要且充分的不等式，该不等式用混合参数、阻尼参数、雅可比算符本征值和纯化导数因子来指明密度矩阵阻尼何时具有比标准密度混合严格更小的谱半径。清晰阐明金属性分数占据（例如，接近半填充）与绝缘性占据（接近零或一）在此不等式中的作用。\n4. 实现一个程序，给定由雅可比算符本征值列表、相应模式占据数列表以及选定的混合和阻尼参数组成的小型测试套件，为每个测试用例计算密度矩阵阻尼是否比标准密度混合产生严格更好的收敛性。该程序必须执行以下操作：\n   a. 对每个测试用例，计算标准密度混合的线性化误差传播算符的谱半径。\n   b. 对同一测试用例，计算采用 McWeeny 纯化的密度矩阵阻尼的线性化误差传播算符的谱半径。\n   c. 对每个测试用例返回一个布尔值，当且仅当密度矩阵阻尼下的谱半径严格小于标准密度混合下的谱半径时为`true`；否则返回`false`。\n\n采用 McWeeny 纯化多项式 $P(x) = 3x^{2} - 2x^{3}$，并使用其在每个模式的占据数处计算的导数 $P'(x)$。将每个模式与其自身的占据数 $p_{i}$ 和雅可比算符本征值 $\\lambda_{i}$ 独立处理，并假设所有本征值都是实的且位于区间 $[0,1]$ 内。设标准混合参数为 $\\alpha \\in (0,1)$，密度矩阵阻尼参数为 $\\gamma  0$。使用不动点迭代的收敛判据，该判据要求迭代算符的谱半径严格小于 $1$ 才能在线性区域内收敛。\n\n你的程序应处理以下四个测试用例，每个用例指定为 $\\{\\text{本征值}, \\text{占据数}, \\alpha, \\gamma\\}$：\n- 测试用例 1：本征值 $\\{0.3, 0.6, 0.9\\}$，占据数 $\\{0.0, 1.0, 0.0\\}$，$\\alpha = 0.5$，$\\gamma = 0.8$。\n- 测试用例 2：本征值 $\\{0.7, 0.9, 0.95\\}$，占据数 $\\{0.5, 0.5, 0.5\\}$，$\\alpha = 0.3$，$\\gamma = 0.7$。\n- 测试用例 3：本征值 $\\{0.3, 0.35, 0.4\\}$，占据数 $\\{0.5, 0.5, 0.5\\}$，$\\alpha = 0.2$，$\\gamma = 0.9$。\n- 测试用例 4：本征值 $\\{1.0, 1.0, 1.0\\}$，占据数 $\\{0.5, 0.0, 1.0\\}$，$\\alpha = 0.5$，$\\gamma = 0.5$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $\\left[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}\\right]$，其中每个 $\\text{result}_{i}$ 是一个布尔值。本问题不要求物理单位。不涉及角度。不涉及百分比。程序不得读取任何输入，并且必须按原样运行。",
            "solution": "Kohn–Sham 密度泛函理论 (KS-DFT) 中的自洽场 (SCF) 程序通过迭代更新电子密度，以达到使能量泛函最小化的不动点。设 SCF 映射记为 $F$，它接受一个输入密度 $\\rho$ 并通过求解 Kohn–Sham 方程返回一个输出密度 $\\rho_{\\text{out}} = F(\\rho)$。一个不动点 $\\rho^{\\star}$ 满足 $F(\\rho^{\\star}) = \\rho^{\\star}$。我们考虑围绕不动点的微扰 $\\delta \\rho = \\rho - \\rho^{\\star}$，并假设 $F$ 在 $\\rho^{\\star}$ 处是 Fréchet 可微的。线性化得到\n$$\n\\delta \\rho_{\\text{out}} \\approx J \\, \\delta \\rho,\n$$\n其中 $J$ 是 $F$ 在 $\\rho^{\\star}$ 处的雅可比算符，即 $J = \\mathrm{D}F(\\rho^{\\star})$，它捕捉了密度对输入密度中小微扰的响应。\n\n我们通过它们的线性化误差传播来分析两种更新方案。\n\n对于标准密度混合，更新方式为\n$$\n\\rho_{k+1} = \\rho_{k} + \\alpha \\left(F(\\rho_{k}) - \\rho_{k}\\right),\n$$\n其中混合参数 $\\alpha \\in (0,1)$。在不动点附近进行线性化得到\n$$\n\\delta \\rho_{k+1} = \\delta \\rho_{k} + \\alpha \\left(J \\, \\delta \\rho_{k} - \\delta \\rho_{k}\\right) = \\left[(1 - \\alpha) I + \\alpha J\\right] \\delta \\rho_{k}.\n$$\n因此，标准密度混合的线性化误差传播算符是\n$$\nM_{\\text{mix}} = (1 - \\alpha) I + \\alpha J.\n$$\n设 $J$ 的谱是实的且位于 $[0,1]$ 区间内，并假设 $J$ 是可对角化的。那么对于 $J$ 的每个本征对 $(\\lambda_{i}, v_{i})$ 且 $J v_{i} = \\lambda_{i} v_{i}$，对应的 $M_{\\text{mix}}$ 的本征值为\n$$\n\\mu^{\\text{mix}}_{i} = (1 - \\alpha) + \\alpha \\lambda_{i}.\n$$\n收敛判据要求谱半径 $\\rho(M_{\\text{mix}}) = \\max_{i} |\\mu^{\\text{mix}}_{i}|$ 严格小于 $1$。\n\n对于采用 McWeeny 纯化的密度矩阵阻尼，我们在单粒子密度矩阵表示 $D$ 中进行操作。在不动点 $D^{\\star}$ 处，对于零温下的幂等投影子，其本征值理想情况下为 $0$ 或 $1$。由于存在温度展宽或简并时费米能级附近的分数占据，金属使这一情况变得复杂。考虑以下形式的更新\n$$\nD_{k+1} = D_{k} + \\gamma \\left(P(D_{\\text{out}}) - D_{k}\\right),\n$$\n其中 $D_{\\text{out}}$ 是与当前哈密顿量一致的输出密度矩阵，$P$ 是一个纯化多项式，这里取为作用于 $D$ 的本征值上的 McWeeny 多项式 $P(x) = 3x^{2} - 2x^{3}$，$\\gamma  0$ 是一个阻尼参数。在假设微扰与 $D^{\\star}$ 对易并且可以在联合本征基中逐模式分析的前提下，$P$ 对本征值的作用产生一个依赖于模式的导数因子 $s_{i} = P'(p_{i})$，其中 $p_{i}$ 是模式 $i$ 中的占据数（$D^{\\star}$ 的本征值）。对于 McWeeny 纯化，\n$$\nP'(x) = 6x - 6x^{2} = 6x(1 - x),\n$$\n所以\n$$\ns_{i} = 6 p_{i} (1 - p_{i}).\n$$\n在绝缘性占据 $p_{i} \\approx 0$ 或 $p_{i} \\approx 1$ 附近，有 $s_{i} \\approx 0$；而在半填充 $p_{i} \\approx 0.5$ 附近，有 $s_{i} \\approx 1.5$。\n\n为了线性化密度矩阵阻尼更新，我们使用量化密度线性响应的相同雅可比算符本征值 $\\lambda_{i}$ 来模拟 $D_{\\text{out}}$ 对微扰的响应。在模式 $i$ 中，将微扰视为一个标量，并写出该模式对应的线性化误差传播为\n$$\n\\delta d_{k+1}^{(i)} = \\left[(1 - \\gamma) + \\gamma \\, s_{i} \\, \\lambda_{i}\\right] \\delta d_{k}^{(i)}.\n$$\n因此，密度矩阵阻尼的线性化误差传播算符的本征值为\n$$\n\\mu^{\\text{pur}}_{i} = (1 - \\gamma) + \\gamma s_{i} \\lambda_{i}.\n$$\n谱半径为 $\\rho(M_{\\text{pur}}) = \\max_{i} |\\mu^{\\text{pur}}_{i}|$，收敛要求 $\\rho(M_{\\text{pur}})  1$。\n\n我们现在确定密度矩阵阻尼何时能比标准密度混合产生严格更好的收敛性。条件是\n$$\n\\max_{i} \\left| (1 - \\gamma) + \\gamma s_{i} \\lambda_{i} \\right|  \\max_{i} \\left| (1 - \\alpha) + \\alpha \\lambda_{i} \\right|.\n$$\n对于任何 $\\gamma$ 而言，要使收敛性相对于混合方法有所改善，一个必要条件是通过检查最差的模式来获得。假设所有本征值和参数都是非负的，且 $0 \\le \\lambda_{i} \\le 1$。那么每个模式中密度矩阵阻尼的最大斜率因子是 $s_{i} \\lambda_{i}$。如果对于最差的模式有 $s_{\\max} \\lambda_{\\max}  1$，那么增加 $\\gamma$ 会使 $\\mu^{\\text{pur}}_{i}$ 的大小从 $\\mu^{\\text{pur}}_{i}(\\gamma = 0) = 1$ 开始超过 $1$，因此 $\\rho(M_{\\text{pur}}) \\ge 1$，没有选择 $\\gamma  0$ 能使密度矩阵阻尼比混合更好。因此，潜在改进的一个必要条件是\n$$\ns_{\\max} \\lambda_{\\max} \\le 1,\n$$\n其中 $s_{\\max} = \\max_{i} s_{i}$ 和 $\\lambda_{\\max} = \\max_{i} \\lambda_{i}$。当 $s_{\\max} \\lambda_{\\max}  1$ 时，选择一个足够大的 $\\gamma$（在其他模式施加的限制范围内）可以将 $\\mu^{\\text{pur}}_{i}$ 降低到混合本征值以下，并实现更好的收敛性。这个条件捕捉了物理上的洞察：在绝缘性占据附近，其中 $p_{i} \\approx 0$ 或 $p_{i} \\approx 1$ 导致 $s_{i} \\approx 0$，纯化能有效地阻尼误差，通常优于密度混合。相反，在金属性体系中，$p_{i} \\approx 0.5$ 导致 $s_{i} \\approx 1.5$，如果 $\\lambda_{\\max}$ 接近 $1$（屏蔽效果差），那么 $s_{\\max} \\lambda_{\\max} \\approx 1.5$，对于任何正的 $\\gamma$，密度矩阵阻尼在线性区域内都不可能比混合更具收敛性。\n\n程序的算法设计直接源于上述推导。对每个测试用例，我们计算：\n1. 混合迭代本征值集合 $\\mu^{\\text{mix}}_{i} = (1 - \\alpha) + \\alpha \\lambda_{i}$ 及其谱半径 $\\rho_{\\text{mix}} = \\max_{i} |\\mu^{\\text{mix}}_{i}|$。\n2. 每个模式的纯化导数因子 $s_{i} = 6 p_{i} (1 - p_{i})$。\n3. 密度矩阵阻尼迭代本征值集合 $\\mu^{\\text{pur}}_{i} = (1 - \\gamma) + \\gamma s_{i} \\lambda_{i}$ 及其谱半径 $\\rho_{\\text{pur}} = \\max_{i} |\\mu^{\\text{pur}}_{i}|$。\n4. 一个布尔结果，当且仅当 $\\rho_{\\text{pur}}  \\rho_{\\text{mix}}$ 时为 `true`，否则为 `false`。\n\n我们将此计算应用于给定的测试套件：\n- 测试用例 1：本征值 $\\{0.3, 0.6, 0.9\\}$，占据数 $\\{0.0, 1.0, 0.0\\}$，$\\alpha = 0.5$，$\\gamma = 0.8$。这里，$s_{i} = \\{0, 0, 0\\}$，所以密度矩阵阻尼的本征值等于 $(1 - \\gamma) = 0.2$，得到 $\\rho_{\\text{pur}} = 0.2$。混合谱半径为 $(1 - 0.5) + 0.5 \\times 0.9 = 0.95$，所以结果是 `true`。\n- 测试用例 2：本征值 $\\{0.7, 0.9, 0.95\\}$，占据数 $\\{0.5, 0.5, 0.5\\}$，$\\alpha = 0.3$，$\\gamma = 0.7$。这里，$s_{i} = \\{1.5, 1.5, 1.5\\}$ 且 $\\rho_{\\text{pur}}$ 超过 $1$，因为 $\\mu^{\\text{pur}}_{\\max} = (1 - 0.7) + 0.7 \\times 1.5 \\times 0.95 = 1.2975$，而 $\\rho_{\\text{mix}} = (1 - 0.3) + 0.3 \\times 0.95 = 0.985$，所以结果是 `false`。\n- 测试用例 3：本征值 $\\{0.3, 0.35, 0.4\\}$，占据数 $\\{0.5, 0.5, 0.5\\}$，$\\alpha = 0.2$，$\\gamma = 0.9$。这里，$s_{i} = \\{1.5, 1.5, 1.5\\}$ 且 $\\mu^{\\text{pur}}_{\\max} = (1 - 0.9) + 0.9 \\times 1.5 \\times 0.4 = 0.64$，而 $\\rho_{\\text{mix}} = (1 - 0.2) + 0.2 \\times 0.4 = 0.88$，所以结果是 `true`。\n- 测试用例 4：本征值 $\\{1.0, 1.0, 1.0\\}$，占据数 $\\{0.5, 0.0, 1.0\\}$，$\\alpha = 0.5$，$\\gamma = 0.5$。这里，$s_{i} = \\{1.5, 0, 0\\}$，得到 $\\mu^{\\text{pur}}_{\\max} = (1 - 0.5) + 0.5 \\times 1.5 \\times 1.0 = 1.25$，而 $\\rho_{\\text{mix}} = (1 - 0.5) + 0.5 \\times 1.0 = 1.0$，所以结果是 `false`。\n\n程序实现了这一逻辑，并以所要求的确切格式将布尔结果作为单行列表打印出来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mcweeny_derivative(p):\n    \"\"\"\n    Compute the derivative of the McWeeny purification polynomial at occupation p.\n    P(x) = 3x^2 - 2x^3 = P'(x) = 6x - 6x^2 = 6x(1 - x)\n    \"\"\"\n    return 6.0 * p * (1.0 - p)\n\ndef spectral_radius_standard_mixing(lambdas, alpha):\n    \"\"\"\n    Compute spectral radius of the linearized error-propagation operator for standard density mixing:\n    M_mix eigenvalues: (1 - alpha) + alpha * lambda_i\n    \"\"\"\n    lambdas = np.asarray(lambdas, dtype=float)\n    eigvals = (1.0 - alpha) + alpha * lambdas\n    return float(np.max(np.abs(eigvals)))\n\ndef spectral_radius_density_matrix_purification(lambdas, occupations, gamma):\n    \"\"\"\n    Compute spectral radius of the linearized error-propagation operator for density-matrix damping with McWeeny purification:\n    M_pur eigenvalues: (1 - gamma) + gamma * s_i * lambda_i, where s_i = P'(p_i) = 6 p_i (1 - p_i)\n    \"\"\"\n    lambdas = np.asarray(lambdas, dtype=float)\n    occupations = np.asarray(occupations, dtype=float)\n    s = mcweeny_derivative(occupations)\n    eigvals = (1.0 - gamma) + gamma * s * lambdas\n    return float(np.max(np.abs(eigvals)))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Each case is a tuple: (lambdas, occupations, alpha, gamma)\n        ([0.3, 0.6, 0.9], [0.0, 1.0, 0.0], 0.5, 0.8),     # Test case 1\n        ([0.7, 0.9, 0.95], [0.5, 0.5, 0.5], 0.3, 0.7),    # Test case 2\n        ([0.3, 0.35, 0.4], [0.5, 0.5, 0.5], 0.2, 0.9),    # Test case 3\n        ([1.0, 1.0, 1.0], [0.5, 0.0, 1.0], 0.5, 0.5),     # Test case 4\n    ]\n\n    results = []\n    for lambdas, occupations, alpha, gamma in test_cases:\n        rho_mix = spectral_radius_standard_mixing(lambdas, alpha)\n        rho_pur = spectral_radius_density_matrix_purification(lambdas, occupations, gamma)\n        # True if density-matrix damping yields strictly smaller spectral radius than standard mixing\n        results.append(rho_pur  rho_mix)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results)).lower()}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}