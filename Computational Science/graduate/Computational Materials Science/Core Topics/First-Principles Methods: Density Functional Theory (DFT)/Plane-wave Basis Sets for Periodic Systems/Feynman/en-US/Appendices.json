{
    "hands_on_practices": [
        {
            "introduction": "The kinetic energy cutoff, $E_{\\text{cut}}$, is the single most important parameter governing the completeness of a plane-wave basis set. This exercise builds a direct, quantitative link between this abstract energy value and the tangible concept of real-space resolution. By applying the Nyquist-Shannon sampling theorem, you will derive the relationship that allows you to estimate the cutoff needed to resolve features of a given size, a foundational skill for setting up any accurate plane-wave calculation .",
            "id": "3478136",
            "problem": "A periodic crystal calculation in Density Functional Theory (DFT) expands the Bloch wavefunction as $\\psi_{n\\mathbf{k}}(\\mathbf{r}) = \\exp(i \\mathbf{k}\\cdot\\mathbf{r})\\,u_{n\\mathbf{k}}(\\mathbf{r})$, where the lattice-periodic part $u_{n\\mathbf{k}}(\\mathbf{r})$ is represented in a plane-wave basis as $u_{n\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{n\\mathbf{k}}(\\mathbf{G}) \\exp(i \\mathbf{G}\\cdot\\mathbf{r})$. The basis is truncated by a kinetic-energy cutoff $E_{\\text{cut}}$ through the condition $\\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{k}+\\mathbf{G}|^{2} \\leq E_{\\text{cut}}$, where $\\hbar$ is the reduced Planck constant and $m_{e}$ is the electron mass. Consider a three-dimensional, isotropic real-space grid of spacing $\\Delta r$ used to represent $u_{n\\mathbf{k}}(\\mathbf{r})$ and assume the calculation is performed at the Brillouin zone (BZ) center, $\\mathbf{k}=\\mathbf{0}$. Using only first principles of Fourier representation of periodic functions and the sampling theorem (Nyquist–Shannon), derive an expression that links the minimal required kinetic-energy cutoff $E_{\\text{cut}}$ to the target real-space resolution $\\Delta r$ by relating the largest reciprocal-space magnitude $|\\mathbf{G}|$ needed to faithfully represent features of characteristic size $\\Delta r$.\n\nThen evaluate your expression for the target resolution $\\Delta r = 0.50 \\ \\text{\\AA}$. Use the constants $1 \\ \\text{\\AA} = 1.0 \\times 10^{-10} \\ \\text{m}$, $\\hbar = 1.054 \\, 571 \\, 817 \\times 10^{-34} \\ \\text{J}\\,\\text{s}$, $m_{e} = 9.109 \\, 383 \\, 7015 \\times 10^{-31} \\ \\text{kg}$, and the conversion $1 \\ \\text{eV} = 1.602 \\, 176 \\, 634 \\times 10^{-19} \\ \\text{J}$. Express the final energy in electronvolts (eV) and round your answer to four significant figures.",
            "solution": "The problem requires the derivation of a relationship between the plane-wave kinetic energy cutoff, $E_{\\text{cut}}$, and the real-space grid resolution, $\\Delta r$, for a periodic crystal calculation. Subsequently, this expression must be evaluated for a specific resolution.\n\nThe starting point is the expansion of the lattice-periodic part of the Bloch wavefunction, $u_{n\\mathbf{k}}(\\mathbf{r})$, into a basis of plane waves. At the Brillouin zone center ($\\mathbf{k}=\\mathbf{0}$), this expansion is given by:\n$$\nu_{n\\mathbf{0}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{n\\mathbf{0}}(\\mathbf{G}) \\exp(i \\mathbf{G}\\cdot\\mathbf{r})\n$$\nwhere $\\mathbf{G}$ are the reciprocal lattice vectors. This is a Fourier series representation of the periodic function $u_{n\\mathbf{0}}(\\mathbf{r})$.\n\nThe basis set is truncated by including only plane waves for which the kinetic energy is below a certain cutoff $E_{\\text{cut}}$. For $\\mathbf{k}=\\mathbf{0}$, this condition is:\n$$\n\\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{G}|^{2} \\leq E_{\\text{cut}}\n$$\nThis implies that the basis set includes all reciprocal lattice vectors $\\mathbf{G}$ with a magnitude up to a certain maximum value, which we will denote as $|\\mathbf{G}|_{\\text{max}}$. The minimal energy cutoff is therefore determined by this maximum magnitude:\n$$\nE_{\\text{cut}} = \\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{G}|_{\\text{max}}^{2}\n$$\nThe problem asks to relate this cutoff to the real-space resolution $\\Delta r$ using the Nyquist-Shannon sampling theorem. The theorem states that to perfectly reconstruct a signal, the sampling rate must be at least twice its highest frequency component. In the context of spatial functions, this means the sampling interval (grid spacing) must be small enough to capture the most rapidly oscillating component of the function.\n\nA rapidly varying feature in real space corresponds to high-frequency (large wavevector) components in reciprocal space. Let a \"feature of characteristic size $\\Delta r$\" be the smallest spatial variation we wish to resolve. This can be modeled as a sinusoidal wave with a half-wavelength equal to $\\Delta r$. The full wavelength of this most rapidly varying component is therefore $\\lambda_{\\text{min}} = 2\\Delta r$.\n\nThe magnitude of the wavevector corresponding to a wavelength $\\lambda$ is given by the relation $k = 2\\pi/\\lambda$. To represent a feature with a minimum wavelength of $\\lambda_{\\text{min}}$, we must include all plane waves with wavevector magnitudes up to $|\\mathbf{G}|_{\\text{max}}$ where:\n$$\n|\\mathbf{G}|_{\\text{max}} = \\frac{2\\pi}{\\lambda_{\\text{min}}}\n$$\nSubstituting $\\lambda_{\\text{min}} = 2\\Delta r$ into this equation gives the required maximum magnitude of the reciprocal lattice vectors:\n$$\n|\\mathbf{G}|_{\\text{max}} = \\frac{2\\pi}{2\\Delta r} = \\frac{\\pi}{\\Delta r}\n$$\nThis establishes the link between the real-space resolution and the necessary extent of the reciprocal-space basis.\n\nNow, we can derive the expression for $E_{\\text{cut}}$ by substituting this result for $|\\mathbf{G}|_{\\text{max}}$ into the energy cutoff formula:\n$$\nE_{\\text{cut}} = \\frac{\\hbar^{2}}{2 m_{e}} \\left( \\frac{\\pi}{\\Delta r} \\right)^{2} = \\frac{\\hbar^{2} \\pi^{2}}{2 m_{e} (\\Delta r)^{2}}\n$$\nThis is the desired expression relating the minimal kinetic-energy cutoff to the target real-space resolution.\n\nNext, we evaluate this expression for the given values:\n- Target resolution: $\\Delta r = 0.50 \\ \\text{\\AA} = 0.50 \\times 10^{-10} \\ \\text{m}$\n- Reduced Planck constant: $\\hbar = 1.054571817 \\times 10^{-34} \\ \\text{J}\\,\\text{s}$\n- Electron mass: $m_{e} = 9.1093837015 \\times 10^{-31} \\ \\text{kg}$\n- Energy conversion: $1 \\ \\text{eV} = 1.602176634 \\times 10^{-19} \\ \\text{J}$\n\nWe substitute these SI unit values into the derived formula:\n$$\nE_{\\text{cut}} = \\frac{(1.054571817 \\times 10^{-34} \\ \\text{J}\\,\\text{s})^{2} \\pi^{2}}{2 (9.1093837015 \\times 10^{-31} \\ \\text{kg}) (0.50 \\times 10^{-10} \\ \\text{m})^{2}}\n$$\nFirst, let's compute the numerator and denominator:\nNumerator: $(\\hbar\\pi)^2 = (1.054571817 \\times 10^{-34} \\times \\pi)^2 \\approx 1.0975608 \\times 10^{-67} \\ (\\text{J}\\,\\text{s})^2$\nDenominator: $2 m_{e} (\\Delta r)^2 = 2 \\times (9.1093837015 \\times 10^{-31}) \\times (0.50 \\times 10^{-10})^2 \\approx 4.5546919 \\times 10^{-51} \\ \\text{kg}\\,\\text{m}^2$\n\nNow, we calculate $E_{\\text{cut}}$ in Joules:\n$$\nE_{\\text{cut}} = \\frac{1.0975608 \\times 10^{-67} \\ \\text{J}^2 \\text{s}^2}{4.5546919 \\times 10^{-51} \\ \\text{kg}\\,\\text{m}^2} \\approx 2.409739 \\times 10^{-17} \\ \\text{J}\n$$\nTo express this energy in electronvolts (eV), we use the conversion factor:\n$$\nE_{\\text{cut}} (\\text{in eV}) = \\frac{E_{\\text{cut}} (\\text{in J})}{1.602176634 \\times 10^{-19} \\ \\text{J/eV}}\n$$\n$$\nE_{\\text{cut}} (\\text{in eV}) = \\frac{2.409739 \\times 10^{-17}}{1.602176634 \\times 10^{-19}} \\approx 150.4032 \\ \\text{eV}\n$$\nThe problem requires the answer to be rounded to four significant figures. Rounding $150.4032$ to four significant figures gives $150.4$.",
            "answer": "$$\\boxed{150.4}$$"
        },
        {
            "introduction": "A finite basis set inevitably introduces errors into calculated physical quantities. This practice uses a simplified yet powerful model to explore how the choice of $E_{\\text{cut}}$ directly impacts the accuracy of computed atomic forces—a critical quantity for structural relaxation and molecular dynamics. By comparing a truncated plane-wave result against an exact analytical solution, you will gain a practical understanding of convergence and see why sharp features in the potential or density demand a larger basis set for accurate force calculations .",
            "id": "3478126",
            "problem": "Consider a three-dimensional periodic system described by a cubic unit cell of side length $L$ with periodic boundary conditions. Two atoms, a \"heavy\" species fixed at the origin and a \"light\" species whose position is parametrized by the displacement vector $\\mathbf{R} = (R_x, 0, 0)$ along the $x$-axis, are represented by localized scalar fields $\\rho_\\mathrm{H}(\\mathbf{r})$ and $\\rho_\\mathrm{L}(\\mathbf{r})$, respectively. The interaction energy is modeled as the overlap functional\n$$\nE(\\mathbf{R}) = \\int_{\\text{cell}} \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r}.\n$$\nThe force component on the light species is defined by the negative gradient of the energy with respect to its position,\n$$\nF_\\alpha = -\\frac{\\partial E}{\\partial R_\\alpha}, \\quad \\alpha \\in \\{x,y,z\\},\n$$\nand in this problem you will focus on $F_x$.\n\nAdopt a plane-wave basis set for periodic systems. Let $\\mathbf{G}$ denote reciprocal lattice vectors of the cubic cell, $\\mathbf{G} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$ with $n_x, n_y, n_z \\in \\mathbb{Z}$. The plane-wave kinetic energy of a mode $\\mathbf{G}$ is given by the free-electron dispersion\n$$\nE_{\\mathbf{G}} = \\frac{\\hbar^2 |\\mathbf{G}|^2}{2 m_e}.\n$$\nWork in atomic units, where $\\hbar = 1$ and $m_e = 1$, so that\n$$\nE_{\\mathbf{G}} = \\frac{|\\mathbf{G}|^2}{2}, \\quad G_\\text{cut} = \\sqrt{2 E_\\text{cut}},\n$$\nwith $E_\\text{cut}$ the plane-wave kinetic energy cutoff.\n\nAssume the real-space fields are spherically symmetric Gaussians with total weights $Q_\\mathrm{H}$ and $Q_\\mathrm{L}$ and widths $\\sigma_\\mathrm{H}$ and $\\sigma_\\mathrm{L}$:\n$$\n\\rho_\\mathrm{H}(\\mathbf{r}) = A_\\mathrm{H} \\exp\\!\\left(-\\frac{|\\mathbf{r}|^2}{2 \\sigma_\\mathrm{H}^2}\\right), \\quad \\rho_\\mathrm{L}(\\mathbf{r}) = A_\\mathrm{L} \\exp\\!\\left(-\\frac{|\\mathbf{r}|^2}{2 \\sigma_\\mathrm{L}^2}\\right),\n$$\nwith $A_\\mathrm{H}$ and $A_\\mathrm{L}$ chosen so that $\\int \\rho_\\mathrm{H} \\, d^3\\mathbf{r} = Q_\\mathrm{H}$ and $\\int \\rho_\\mathrm{L} \\, d^3\\mathbf{r} = Q_\\mathrm{L}$. The corresponding Fourier coefficients (over the unit cell, approximated by the continuum transform for sufficiently large $L$ relative to $\\sigma_\\mathrm{H}$ and $\\sigma_\\mathrm{L}$) evaluated at reciprocal lattice vectors are\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\approx Q_\\mathrm{H} \\exp\\!\\left(-\\frac{\\sigma_\\mathrm{H}^2 |\\mathbf{G}|^2}{2}\\right), \\qquad\n\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\approx Q_\\mathrm{L} \\exp\\!\\left(-\\frac{\\sigma_\\mathrm{L}^2 |\\mathbf{G}|^2}{2}\\right).\n$$\n\nUsing a plane-wave basis truncated at $E_\\text{cut}$, approximate the energy by the Fourier series restricted to $|\\mathbf{G}| \\le G_\\text{cut}$:\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\, \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) \\, e^{i \\mathbf{G} \\cdot \\mathbf{R}}, \\qquad V = L^3.\n$$\nCompute the truncated-basis force component $F_x^{(E_\\text{cut})} = -\\partial E^{(E_\\text{cut})} / \\partial R_x$ by differentiating the series. To quantify basis-set errors, compare $F_x^{(E_\\text{cut})}$ against the exact $F_x$ obtained by solving the real-space Gaussian overlap analytically. Explicitly compute the absolute error\n$$\n\\Delta F_x(E_\\text{cut}) = \\left| F_x^{(E_\\text{cut})} - F_x^\\text{exact} \\right|.\n$$\n\nIn the advanced-graduate context of plane-wave basis sets for periodic systems, the role of high-$|\\mathbf{G}|$ components is critical for representing sharp features in $\\rho_\\mathrm{H}$ when $\\sigma_\\mathrm{H}$ is small (heavy species) and in the gradient $\\partial E / \\partial R_x$ that weights high-frequency modes. Starting from the above fundamental definitions, your program must:\n- use atomic units throughout and report forces and errors in dimensionless units consistent with the chosen normalization;\n- implement the truncated plane-wave sum for $E^{(E_\\text{cut})}(\\mathbf{R})$ and its derivative with respect to $R_x$;\n- derive and implement the exact $F_x^\\text{exact}$ for the Gaussian overlap in infinite space, and use it to compute $\\Delta F_x(E_\\text{cut})$.\n\nTest Suite:\nUse the following parameter sets, each given as $(L, \\sigma_\\mathrm{H}, \\sigma_\\mathrm{L}, Q_\\mathrm{H}, Q_\\mathrm{L}, R_x, E_\\text{cut})$, to cover typical, boundary, and edge cases.\n1. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 5.0)$: a moderate cutoff where the heavy species is sharp relative to the light one.\n2. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 40.0)$: a high cutoff expected to reduce basis-set error substantially.\n3. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 0.5)$: a very low cutoff near the boundary where only the lowest Fourier components are included.\n4. $(20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 5.0)$: a sharper heavy species (smaller $\\sigma_\\mathrm{H}$) at moderate cutoff to emphasize high-$|\\mathbf{G}|$ contributions.\n5. $(20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 80.0)$: the same sharp case with a very high cutoff to probe convergence.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is the absolute error $\\Delta F_x(E_\\text{cut})$ for the corresponding test case, in dimensionless units. For example:\n$$\n[\\Delta F_x^{(1)}, \\Delta F_x^{(2)}, \\Delta F_x^{(3)}, \\Delta F_x^{(4)}, \\Delta F_x^{(5)}].\n$$",
            "solution": "The problem requires the calculation of the absolute error in the interatomic force component $F_x$ for a two-atom system, comparing a plane-wave basis set calculation with a finite energy cutoff $E_\\text{cut}$ against the exact analytical solution. The system consists of a \"heavy\" species fixed at the origin and a \"light\" species displaced by $\\mathbf{R} = (R_x, 0, 0)$. Atomic units ($\\hbar=1$, $m_e=1$) are used throughout.\n\nThe core of the problem lies in evaluating two expressions for the force $F_x = -\\partial E / \\partial R_x$ and finding their difference. The first is the exact force $F_x^\\text{exact}$, derived from the analytical evaluation of the interaction energy integral in continuous real space. The second is the approximate force $F_x^{(E_\\text{cut})}$, derived from the truncated plane-wave expansion of the energy.\n\n### Step 1: Derivation of the Exact Force, $F_x^\\text{exact}$\n\nThe interaction energy is given by the overlap integral:\n$$\nE(\\mathbf{R}) = \\int_{\\text{cell}} \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r}\n$$\nGiven that the cell length $L$ is large compared to the widths $\\sigma_\\mathrm{H}$ and $\\sigma_\\mathrm{L}$ of the Gaussian fields, we can approximate the integral over the cell by an integral over all space ($\\mathbb{R}^3$). This expression is a cross-correlation of the two density fields. For real, symmetric functions, this is equivalent to convolution. The problem can be solved efficiently in Fourier space. Let $\\mathcal{F}$ denote the three-dimensional continuous Fourier transform. The Convolution Theorem states that the Fourier transform of a convolution is the product of the Fourier transforms. More specifically for the given overlap integral, Parseval's theorem gives:\n$$\nE(\\mathbf{R}) = \\int \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r} = \\frac{1}{(2\\pi)^3} \\int \\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) \\, \\tilde{\\rho}_\\mathrm{L}^*(\\mathbf{k}) \\, e^{i\\mathbf{k}\\cdot\\mathbf{R}} \\, d^3\\mathbf{k}\n$$\nwhere $\\tilde{\\rho}(\\mathbf{k}) = \\int \\rho(\\mathbf{r}) e^{-i\\mathbf{k}\\cdot\\mathbf{r}} d^3\\mathbf{r}$. The fields $\\rho_\\mathrm{H}(\\mathbf{r})$ and $\\rho_\\mathrm{L}(\\mathbf{r})$ are real and spherically symmetric, which implies their Fourier transforms $\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k})$ and $\\tilde{\\rho}_\\mathrm{L}(\\mathbf{k})$ are also real and spherically symmetric. Thus, $\\tilde{\\rho}_\\mathrm{L}^*(\\mathbf{k}) = \\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{k})$.\n\nThe problem provides the Fourier coefficients, which are equivalent to the continuous Fourier transforms for a large cell:\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) = Q_\\mathrm{H} \\exp\\left(-\\frac{\\sigma_\\mathrm{H}^2 |\\mathbf{k}|^2}{2}\\right), \\qquad\n\\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = Q_\\mathrm{L} \\exp\\left(-\\frac{\\sigma_\\mathrm{L}^2 |\\mathbf{k}|^2}{2}\\right)\n$$\nThe product of these transforms is another unnormalized Gaussian:\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) \\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = Q_\\mathrm{H} Q_\\mathrm{L} \\exp\\left(-\\frac{(\\sigma_\\mathrm{H}^2 + \\sigma_\\mathrm{L}^2) |\\mathbf{k}|^2}{2}\\right)\n$$\nLet $\\sigma_\\text{tot}^2 = \\sigma_\\mathrm{H}^2 + \\sigma_\\mathrm{L}^2$. The energy expression becomes:\n$$\nE(\\mathbf{R}) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi)^3} \\int \\exp\\left(-\\frac{\\sigma_\\text{tot}^2 |\\mathbf{k}|^2}{2}\\right) e^{i\\mathbf{k}\\cdot\\mathbf{R}} \\, d^3\\mathbf{k}\n$$\nThis is proportional to the inverse Fourier transform of a Gaussian. Using the standard result for the transform of a Gaussian, we obtain:\n$$\nE^\\text{exact}(\\mathbf{R}) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi)^3} \\left(\\frac{2\\pi}{\\sigma_\\text{tot}^2}\\right)^{3/2} \\exp\\left(-\\frac{|\\mathbf{R}|^2}{2\\sigma_\\text{tot}^2}\\right) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi \\sigma_\\text{tot}^2)^{3/2}} \\exp\\left(-\\frac{|\\mathbf{R}|^2}{2\\sigma_\\text{tot}^2}\\right)\n$$\nTo find the force component $F_x^\\text{exact}$, we differentiate with respect to $R_x$. With $\\mathbf{R}=(R_x, 0, 0)$, we have $|\\mathbf{R}|^2 = R_x^2$.\n$$\nF_x^\\text{exact} = -\\frac{\\partial E^\\text{exact}}{\\partial R_x} = -\\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi \\sigma_\\text{tot}^2)^{3/2}} \\exp\\left(-\\frac{R_x^2}{2\\sigma_\\text{tot}^2}\\right) \\left(-\\frac{2 R_x}{2\\sigma_\\text{tot}^2}\\right)\n$$\n$$\nF_x^\\text{exact} = \\frac{Q_\\mathrm{H} Q_\\mathrm{L} R_x}{(2\\pi)^{3/2} (\\sigma_\\text{tot}^2)^{5/2}} \\exp\\left(-\\frac{R_x^2}{2\\sigma_\\text{tot}^2}\\right)\n$$\nThis is the analytical formula for the exact force.\n\n### Step 2: Derivation of the Truncated Force, $F_x^{(E_\\text{cut})}$\n\nThe energy in the truncated plane-wave basis is given by a discrete sum over reciprocal lattice vectors $\\mathbf{G}$ within a sphere defined by the cutoff energy $E_\\text{cut}$:\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\, \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) \\, e^{i \\mathbf{G} \\cdot \\mathbf{R}}\n$$\nwhere $V=L^3$ and $G_\\text{cut} = \\sqrt{2 E_\\text{cut}}$. As established, the Fourier coefficients are real and even, so $\\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) = \\tilde{\\rho}_\\mathrm{L}(\\mathbf{G})$. The product of the coefficients is thus $\\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) = Q_\\mathrm{H} Q_\\mathrm{L} \\exp(-\\sigma_\\text{tot}^2 |\\mathbf{G}|^2/2)$.\nSince $E^{(E_\\text{cut})}$ must be a real quantity, we can write it as:\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\cos(\\mathbf{G} \\cdot \\mathbf{R})\n$$\nThe force component $F_x^{(E_\\text{cut})}$ is the negative derivative with respect to $R_x$:\n$$\nF_x^{(E_\\text{cut})} = -\\frac{\\partial E^{(E_\\text{cut})}}{\\partial R_x} = -\\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\frac{\\partial}{\\partial R_x} \\cos(G_x R_x)\n$$\n$$\nF_x^{(E_\\text{cut})} = -\\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) (-G_x \\sin(G_x R_x))\n$$\nSubstituting the expression for the coefficient product, we arrive at the final formula for the truncated force:\n$$\nF_x^{(E_\\text{cut})} = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} G_x \\exp\\left(-\\frac{\\sigma_\\text{tot}^2 |\\mathbf{G}|^2}{2}\\right) \\sin(G_x R_x)\n$$\n\n### Step 3: Algorithmic Implementation\n\nThe algorithm proceeds as follows for each test case:\n1.  Calculate $F_x^\\text{exact}$ using its analytical formula derived in Step 1.\n2.  Calculate $F_x^{(E_\\text{cut})}$ by performing the discrete sum derived in Step 2. The sum is over all reciprocal lattice vectors $\\mathbf{G} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$ (where $n_x, n_y, n_z$ are integers) that satisfy the cutoff condition $|\\mathbf{G}| \\le G_\\text{cut}$. This condition translates to a constraint on the integer indices:\n    $$\n    |\\mathbf{G}|^2 = \\left(\\frac{2\\pi}{L}\\right)^2 (n_x^2 + n_y^2 + n_z^2) \\le G_\\text{cut}^2 = 2 E_\\text{cut} \\quad \\implies \\quad n_x^2 + n_y^2 + n_z^2 \\le \\frac{2 E_\\text{cut} L^2}{4\\pi^2}\n    $$\n    The implementation will iterate through a cubic grid of integers $(n_x, n_y, n_z)$ up to a maximum index determined by the cutoff radius, check if each vector falls within the cutoff sphere, and if so, add its contribution to the total sum for the force.\n3.  Compute the absolute error $\\Delta F_x(E_\\text{cut}) = |F_x^{(E_\\text{cut})} - F_x^\\text{exact}|$.\n\nThis procedure is implemented for each parameter set provided in the test suite to generate the final list of errors.",
            "answer": "[1.328906691456e-03,8.049103444040e-09,1.109968413155e-02,3.315573715893e-02,4.887677462002e-07]"
        },
        {
            "introduction": "This advanced practice delves into a subtle but crucial consequence of using a basis set that depends on the simulation cell: the distinction between Pulay forces and Pulay stress. You will conduct a numerical thought experiment to demonstrate why the plane-wave basis is \"force-free\" (an advantageous property) but not \"stress-free.\" Understanding this distinction is essential for performing reliable cell optimizations or calculating the pressure of a system, as it reveals how the basis set's dependence on strain introduces an artificial contribution to the stress tensor that must be carefully converged .",
            "id": "3478143",
            "problem": "Consider a cubic periodic cell of lattice parameter $a$ in atomic units, so the real-space volume is $V = a^3$. A single-particle wavefunction $\\psi(\\mathbf{r})$ is represented in a plane-wave basis as $\\psi(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i \\mathbf{G}\\cdot \\mathbf{r}}$ at the $\\Gamma$ point (i.e., $\\mathbf{k}=\\mathbf{0}$). The reciprocal lattice vectors for a uniformly strained cubic cell are $\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}$ with $\\mathbf{n}\\in\\mathbb{Z}^3$, where $\\lambda > 0$ is the isotropic strain factor defining the transformation $V \\to \\lambda^3 V$. In a plane-wave calculation with a kinetic energy cutoff $E_\\text{cut}$ (in Hartree), only those plane waves with $|\\mathbf{G}(\\lambda)|^2 \\le 2 E_\\text{cut}$ are included.\n\nThis problem asks you to implement a thought experiment program that demonstrates two facts for plane-wave bases in periodic systems:\n- Plane waves produce zero Pulay forces under atomic translations.\n- Plane waves produce nonzero Pulay stress under uniform strain when using a finite kinetic energy cutoff.\n\nYou will use a synthetic $\\Gamma$-point wavefunction whose continuous Fourier amplitude is a normalized Gaussian in reciprocal space,\n$$\nc(\\mathbf{k}) \\propto \\exp\\!\\left(-\\frac{|\\mathbf{k}|^2}{2\\sigma^2}\\right),\n$$\nwith $\\sigma$ in inverse Bohr units. In the discrete plane-wave basis, you sample $c(\\mathbf{k})$ at the reciprocal lattice vectors $\\mathbf{G}(\\lambda)$, renormalize within the truncated set selected by the cutoff, and approximate the kinetic energy expectation. In atomic units (with electron mass and reduced Planck constant equal to $1$), the kinetic operator is $-\\nabla^2$, so the kinetic energy expectation in the truncated plane-wave basis at strain $\\lambda$ is defined by the renormalized discrete sum\n$$\nE_\\text{pw}(\\lambda, E_\\text{cut}) = \\frac{\\sum_{|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}} |\\mathbf{G}(\\lambda)|^2\\,\\left|c(\\mathbf{G}(\\lambda))\\right|^2}{\\sum_{|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}} \\left|c(\\mathbf{G}(\\lambda))\\right|^2}.\n$$\n\nDefine the strain parameter $\\epsilon = \\ln \\lambda$ and consider the hydrostatic Pulay stress-like quantity (per unit reference volume) at the unstrained state $\\lambda=1$,\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) = \\frac{1}{V_0}\\left.\\frac{\\partial E_\\text{pw}(\\lambda, E_\\text{cut})}{\\partial \\epsilon}\\right|_{\\epsilon=0},\\quad V_0=a^3.\n$$\nApproximate the derivative by a central finite difference with step $\\Delta \\epsilon$,\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) \\approx \\frac{1}{V_0}\\frac{E_\\text{pw}(e^{+\\Delta\\epsilon}, E_\\text{cut}) - E_\\text{pw}(e^{-\\Delta\\epsilon}, E_\\text{cut})}{2\\Delta\\epsilon}.\n$$\n\nTo demonstrate zero Pulay forces, consider a rigid translation of the wavefunction by $\\Delta x$ along the $x$-axis. In the plane-wave representation, this introduces a phase $e^{-i G_x \\Delta x}$ in each coefficient, but the kinetic energy depends only on $|c_{\\mathbf{G}}|^2$ and is invariant under such phases. Numerically verify the vanishing derivative (force component),\n$$\nF_x(E_\\text{cut}) = \\left.\\frac{\\partial E_\\text{pw}(\\lambda=1, E_\\text{cut}; \\Delta x)}{\\partial \\Delta x}\\right|_{\\Delta x=0} \\approx \\frac{E_\\text{pw}(1, E_\\text{cut}; +\\Delta x) - E_\\text{pw}(1, E_\\text{cut}; -\\Delta x)}{2\\Delta x},\n$$\nand check that $|F_x(E_\\text{cut})|$ is below a numerical tolerance.\n\nProgram requirements:\n- Use $a = 10$ Bohr, $\\sigma = 3$ Bohr$^{-1}$, and central difference steps $\\Delta \\epsilon = 10^{-2}$ and $\\Delta x = 10^{-1}$ Bohr.\n- Implement $E_\\text{pw}(\\lambda, E_\\text{cut})$ exactly as the discrete renormalized sum over all integer triplets $\\mathbf{n} = (n_x,n_y,n_z)$ with $|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}$, where $\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}$. The weight at each included $\\mathbf{G}$ is $\\left|c(\\mathbf{G}(\\lambda))\\right|^2 = \\exp\\!\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{2\\sigma^2}\\right)$.\n- For the Pulay force test, compute the central difference using the same $E_\\text{pw}$ because the phase due to translation cancels in $\\left|c_{\\mathbf{G}}\\right|^2$. The expected force is numerically zero to within tolerance.\n- Physical and numerical units: Report stresses in Hartree per Bohr$^3$ and use Bohr for distances and Hartree for energies.\n- Test suite:\n    1. $E_\\text{cut}=5$ Hartree (very small cutoff; significant Pulay stress expected).\n    2. $E_\\text{cut}=20$ Hartree (small cutoff).\n    3. $E_\\text{cut}=80$ Hartree (moderate cutoff).\n    4. $E_\\text{cut}=160$ Hartree (large cutoff; Pulay stress should be smaller).\n  For each $E_\\text{cut}$ in the suite, compute $\\sigma_\\text{Pulay}(E_\\text{cut})$ at $\\lambda=1$ using $\\Delta \\epsilon=10^{-2}$ and verify the Pulay force condition $|F_x(E_\\text{cut})|<10^{-12}$ Hartree per Bohr.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the four Pulay stress values (in Hartree/Bohr$^3$) for the test suite in the order given, followed by a single boolean indicating if the zero Pulay force check passed simultaneously for all test cases. For example, the structure must be like \"[stress5,stress20,stress80,stress160,True]\".\n\nScientific realism and derivation scope:\n- Begin from the definition of the plane-wave basis for periodic systems, the kinetic energy operator in atomic units, and the variational projection onto a truncated plane-wave subspace defined by $E_\\text{cut}$.\n- Derive, from these bases, why forces vanish under atomic translations (no dependence of the basis on atomic positions) and why stresses are nonzero under uniform strain (the basis depends on the cell metric, so the truncated subspace changes with strain even at fixed $E_\\text{cut}$).\n- Do not use any shortcut formulas or hand the target expressions; implement the sums explicitly as defined.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.",
            "solution": "The problem is validated as scientifically sound, well-posed, and computationally feasible. It represents a standard numerical experiment in computational materials science designed to illustrate the concepts of Pulay forces and stresses in the context of plane-wave basis sets.\n\nThe solution is presented in two parts: first, a principled derivation of the physical concepts, and second, an algorithmic implementation based on these principles.\n\n### Principles and Derivation\n\nA single-particle electronic wavefunction $\\psi(\\mathbf{r})$ in a periodic solid can be described using Bloch's theorem. For a given crystal momentum vector $\\mathbf{k}$ in the first Brillouin zone, the wavefunction takes the form $\\psi_{\\mathbf{k}}(\\mathbf{r}) = u_{\\mathbf{k}}(\\mathbf{r}) e^{i\\mathbf{k}\\cdot\\mathbf{r}}$, where $u_{\\mathbf{k}}(\\mathbf{r})$ has the same periodicity as the crystal lattice. The periodic function $u_{\\mathbf{k}}(\\mathbf{r})$ can be expanded in a Fourier series over the reciprocal lattice vectors $\\mathbf{G}$:\n$$\nu_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}+\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\nThis leads to the plane-wave expansion of the Bloch function:\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}+\\mathbf{G}} e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}\n$$\nThe problem specifies calculations at the $\\Gamma$-point, for which $\\mathbf{k}=\\mathbf{0}$. The wavefunction is thus expanded as a simple Fourier series over the reciprocal lattice vectors:\n$$\n\\psi(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\nThe basis functions are the plane waves $\\{e^{i\\mathbf{G}\\cdot\\mathbf{r}}\\}$. In atomic units ($\\hbar=1$, $m_e=1$), the kinetic energy operator is $\\hat{T} = -\\frac{1}{2}\\nabla^2$. The plane waves are eigenfunctions of this operator:\n$$\n\\hat{T} e^{i\\mathbf{G}\\cdot\\mathbf{r}} = -\\frac{1}{2}\\nabla^2 e^{i\\mathbf{G}\\cdot\\mathbf{r}} = \\frac{|\\mathbf{G}|^2}{2} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\nThe expectation value of the kinetic energy for a normalized wavefunction $\\psi$ is therefore:\n$$\n\\langle E_{kin} \\rangle = \\frac{\\sum_{\\mathbf{G}} |c_{\\mathbf{G}}|^2 \\frac{|\\mathbf{G}|^2}{2}}{\\sum_{\\mathbf{G}} |c_{\\mathbf{G}}|^2}\n$$\nThe problem defines a quantity $E_\\text{pw}$ that is proportional to this kinetic energy, $E_\\text{pw} = 2 \\langle E_{kin} \\rangle$. This scaling factor does not affect the conceptual conclusions.\n\nIn any practical calculation, the infinite sum over all $\\mathbf{G}$ must be truncated. A standard choice is to include all plane waves with a kinetic energy up to a certain cutoff, $E_\\text{cut}$:\n$$\n\\frac{|\\mathbf{G}|^2}{2} \\le E_\\text{cut} \\implies |\\mathbf{G}|^2 \\le 2 E_\\text{cut}\n$$\nThis truncation defines a finite, variationally-projected subspecies for the wavefunction.\n\n**1. Pulay Forces (Atomic Translations)**\n\nPulay forces arise when the basis set used to describe the wavefunctions depends on the positions of the atoms. To analyze this for a plane-wave basis, consider a rigid translation of the entire system (or just the wavefunction, for this thought experiment) by a vector $\\mathbf{d}$. The new wavefunction $\\psi'(\\mathbf{r})$ is $\\psi(\\mathbf{r}-\\mathbf{d})$. We can express $\\psi'(\\mathbf{r})$ in the original plane-wave basis:\n$$\n\\psi'(\\mathbf{r}) = \\psi(\\mathbf{r}-\\mathbf{d}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot(\\mathbf{r}-\\mathbf{d})} = \\sum_{\\mathbf{G}} \\left(c_{\\mathbf{G}} e^{-i\\mathbf{G}\\cdot\\mathbf{d}}\\right) e^{i\\mathbf{G}\\cdot\\mathbf{r}} = \\sum_{\\mathbf{G}} c'_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\nThe new coefficients are $c'_{\\mathbf{G}} = c_{\\mathbf{G}} e^{-i\\mathbf{G}\\cdot\\mathbf{d}}$. The crucial observation is that the magnitude of each coefficient remains unchanged: $|c'_{\\mathbf{G}}|^2 = |c_{\\mathbf{G}}|^2$. The basis functions themselves, $\\{e^{i\\mathbf{G}\\cdot\\mathbf{r}}\\}$, are defined with respect to the simulation cell and are independent of atomic positions.\n\nThe kinetic energy expectation $E_\\text{pw}$ is a function of $|\\mathbf{G}|^2$ and $|c_{\\mathbf{G}}|^2$. Since neither of these quantities changes upon translation, $E_\\text{pw}$ is invariant. The Pulay force, which is the derivative of the energy with respect to an atomic displacement, is therefore identically zero for a plane-wave basis. This is a significant advantage of such bases. The problem asks to verify this numerically by calculating the force component $F_x$ for a displacement $\\Delta x$, which will be computationally zero.\n\n**2. Pulay Stress (Cell Strain)**\n\nPulay stress arises from the dependence of the basis set on the cell parameters (i.e., strain). In this problem, we consider a uniform isotropic strain described by a factor $\\lambda$, which transforms the lattice parameter $a$ to $\\lambda a$. The reciprocal lattice vectors for the cubic cell depend on $\\lambda$:\n$$\n\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}, \\quad \\text{where } \\mathbf{n} = (n_x, n_y, n_z) \\in \\mathbb{Z}^3\n$$\nThe set of plane waves included in the calculation is defined by the cutoff condition, which now depends explicitly on $\\lambda$:\n$$\n|\\mathbf{G}(\\lambda)|^2 \\le 2 E_\\text{cut} \\quad \\implies \\quad \\left(\\frac{2\\pi}{\\lambda a}\\right)^2 |\\mathbf{n}|^2 \\le 2 E_\\text{cut}\n$$\nAs $\\lambda$ changes, the set of integer vectors $\\mathbf{n}$ that satisfy this inequality also changes. This means the basis set itself, i.e., the subspace defined by the truncation, is a function of the strain $\\lambda$.\n\nThe calculated energy $E_\\text{pw}(\\lambda, E_\\text{cut})$ is a sum over this $\\lambda$-dependent set of reciprocal vectors. Its derivative with respect to a strain parameter, such as $\\epsilon = \\ln \\lambda$, will be non-zero due to two contributions:\na) The continuous change in the terms $|\\mathbf{G}(\\lambda)|^2$ and the weights $|c(\\mathbf{G}(\\lambda))|^2$ for the vectors that remain within the cutoff sphere.\nb) The discontinuous change in the sum as vectors $\\mathbf{G}(\\lambda)$ enter or leave the summation domain when $\\lambda$ is varied.\n\nThis latter effect is the source of the Pulay stress. For any finite $E_\\text{cut}$, this stress is non-zero. It only vanishes in the limit of a complete basis set, $E_\\text{cut} \\to \\infty$. The problem asks to compute this \"stress-like\" quantity $\\sigma_\\text{Pulay}$ and observe its dependence on $E_\\text{cut}$. We expect $\\sigma_\\text{Pulay}$ to decrease as $E_\\text{cut}$ increases, as the basis set becomes more complete.\n\n### Algorithmic Implementation\n\nThe core of the program is the function to compute $E_\\text{pw}(\\lambda, E_\\text{cut})$:\n$$\nE_\\text{pw}(\\lambda, E_\\text{cut}) = \\frac{\\sum_{\\mathbf{n} \\in S(\\lambda, E_\\text{cut})} |\\mathbf{G}(\\lambda)|^2\\,\\exp\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{2\\sigma^2}\\right)}{\\sum_{\\mathbf{n} \\in S(\\lambda, E_\\text{cut})} \\exp\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{2\\sigma^2}\\right)}\n$$\nwhere $S(\\lambda, E_\\text{cut})$ is the set of integer triplets $\\mathbf{n}$ satisfying the cutoff condition.\n\n1.  To implement this, we determine the maximum integer component, $n_\\text{max}$, by rearranging the cutoff inequality: $|\\mathbf{n}|^2 \\le 2 E_\\text{cut} (\\frac{\\lambda a}{2\\pi})^2$. Any component $n_i$ cannot exceed $\\sqrt{|\\mathbf{n}|^2}$, so $|n_i| \\le \\lfloor\\sqrt{2 E_\\text{cut}} \\frac{\\lambda a}{2\\pi}\\rfloor$.\n2.  We iterate through all integer triplets $(n_x, n_y, n_z)$ from $-n_\\text{max}$ to $+n_\\text{max}$.\n3.  For each triplet $\\mathbf{n}$, we calculate $|\\mathbf{G}(\\lambda)|^2 = (\\frac{2\\pi}{\\lambda a})^2 (n_x^2+n_y^2+n_z^2)$ and check if it is less than or equal to $2E_\\text{cut}$.\n4.  If the condition is met, we compute the corresponding term for the numerator and denominator and add it to the running sums. The exponential weight is calculated as $\\exp(-|\\mathbf{G}(\\lambda)|^2 / (2\\sigma^2))$ per the problem statement.\n5.  After the loops complete, the final value is the ratio of the total numerator to the total denominator.\n\nThe Pulay stress $\\sigma_\\text{Pulay}$ is then calculated using a central finite difference approximation. We compute $E_\\text{pw}$ at two slightly different strains, $\\lambda_+ = e^{+\\Delta\\epsilon}$ and $\\lambda_- = e^{-\\Delta\\epsilon}$, and apply the formula:\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) \\approx \\frac{1}{a^3}\\frac{E_\\text{pw}(e^{+\\Delta\\epsilon}, E_\\text{cut}) - E_\\text{pw}(e^{-\\Delta\\epsilon}, E_\\text{cut})}{2\\Delta\\epsilon}\n$$\nThe Pulay force check is trivial. As analytically shown, the energy is invariant to translation, so the finite difference formula for $F_x$ evaluates to exactly $0$, satisfying the condition $|F_x| < 10^{-12}$.\n\nThe program iterates over the specified $E_\\text{cut}$ values, computes the stress for each, and confirms the force condition passes for all cases. The final output is formatted as a single list.",
            "answer": "[0.0003058863673552097,8.026402844837583e-05,1.758410294711311e-05,1.2065876374020958e-05,True]"
        }
    ]
}