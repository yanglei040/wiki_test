{
    "hands_on_practices": [
        {
            "introduction": "电子能带结构计算是理解和预测材料电子特性的核心。这项实践将指导你从第一性原理出发，使用平面波方法构建一个简化的能带结构计算程序，这是现代电子结构计算软件的基石。通过亲手实现并比较范数守恒赝势和投影缀加波（PAW）赝势这两种模型 ，你将深刻理解不同计算选择对收敛性和最终结果的实际影响。",
            "id": "3433862",
            "problem": "您的任务是设计并实现一个计算测试，用于在固定的平面波动能截断下，比较使用两种不同赝势模型计算出的晶体硅的能带结构。这两种模型分别是“保范”赝势和一种类似“投影缀加波 (PAW)”的替代赝势。您的程序必须在一个周期性势场中，使用单粒子薛定谔方程的平面波展开，沿指定的高对称路径构建能带结构，量化价带宽度，并通过将每种情况与高截断参考结果进行比较来评估收敛行为。所有结果必须以电子伏特 (eV) 表示。\n\n其理论基础是周期性势场中的单粒子薛定谔方程、布洛赫定理和平面波方法：\n- 单粒子薛定谔方程为 $H\\psi = E\\psi$，适用于周期性势场 $V(\\mathbf{r})$，其中 $H = -\\frac{\\hbar^2}{2m}\\nabla^2 + V(\\mathbf{r})$。\n- 根据布洛赫定理，解可以在平面波基组中展开，其波矢为 $\\mathbf{k} + \\mathbf{G}$，其中 $\\mathbf{k}$ 位于第一布里渊区，$\\mathbf{G}$ 遍历所有倒格矢。\n- 在一个由动能截断 $E_{\\mathrm{cut}}$ 定义的截断平面波基组中，只包含满足 $\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$ 的倒格矢 $\\mathbf{G}$，并建立哈密顿矩阵\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V(\\mathbf{G}-\\mathbf{G}'),\n$$\n其中 $V(\\mathbf{q})$ 是周期性势场的傅里叶变换。\n- 对于每个晶格常数为 $a$ 的常规立方晶胞中有两个原子的硅的金刚石结构，结构因子以下述形式进入局域势的傅里叶分量：\n$$\nV(\\mathbf{q}) = S(\\mathbf{q})\\,v(|\\mathbf{q}|), \\quad S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}},\n$$\n其中基矢 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$，$v(|\\mathbf{q}|)$ 是一个模拟赝势的球对称形状因子。\n\n您必须实现两种赝势形状因子，它们仅在傅里叶空间中的衰减速率上有所不同，这反映了一个公认的观念，即保范模型更“硬”（需要更多平面波才能收敛），而类 PAW 模型更“软”（用更少的平面波收敛得更快）。请使用以下物理上合理的模型：\n- 对于类 PAW 模型，设 $v_{\\mathrm{PAW}}(q) = -V_0\\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{PAW}}}\\right)^2\\right]$。\n- 对于保范模型，设 $v_{\\mathrm{NC}}(q) = -V_0\\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{NC}}}\\right)^2\\right]$。\n选择参数 $V_0$、$q_0^{\\mathrm{PAW}}$ 和 $q_0^{\\mathrm{NC}}$，使得 $q_0^{\\mathrm{NC}}  q_0^{\\mathrm{PAW}}$，从而使保范势在倒易空间中更硬。周期性势则由 $V(\\mathbf{q}) = S(\\mathbf{q})\\,v(q)$ 完全确定。\n\n对硅使用金刚石常规立方晶格常数 $a = 5.431$ $\\mathrm{\\AA}$。构建倒格矢 $\\mathbf{G} = \\frac{2\\pi}{a}(h,k,l)$，并限制在面心立方布拉菲格子的倒格子上（其在倒易空间中为体心立方）。在常规立方指数中，这意味着只包括奇偶性全部相同（全偶或全奇）的三元组 $(h,k,l)$。为选择基组，强制执行动能截断条件 $\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$，其中 $\\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n\n沿分段线性高对称路径 $\\Gamma \\rightarrow X \\rightarrow L$ 构建能带结构，其中\n- $\\Gamma = (0,0,0)$，\n- $X = \\left(\\frac{\\pi}{a},0,0\\right)$，\n- $L = \\left(\\frac{\\pi}{a},\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$，\n每个线段分别采样 $N_\\Gamma$ 和 $N_X$ 个等距点，且 $N_\\Gamma = N_X = 20$。\n\n对于每种赝势模型和截断值，对路径上每个采样的 $\\mathbf{k}$ 点进行哈密顿量对角化，对本征值进行排序，并将“价带宽度”定义为最低能带沿该路径的能量展宽，\n$$\nW_{\\mathrm{val}} = \\max_{\\mathbf{k}\\in\\mathrm{path}} E_{1}(\\mathbf{k}) - \\min_{\\mathbf{k}\\in\\mathrm{path}} E_{1}(\\mathbf{k}),\n$$\n单位为电子伏特。将给定情况的“收敛误差”定义为\n$$\n\\Delta W = \\left|W_{\\mathrm{val}}(E_{\\mathrm{cut}}) - W_{\\mathrm{val}}(E_{\\mathrm{cut}}^{\\mathrm{ref}})\\right|,\n$$\n其中 $E_{\\mathrm{cut}}^{\\mathrm{ref}}$ 是一个更高的截断值，用作相同赝势模型的固定参考。\n\n测试套件：\n- 在您的实现中使用以下赝势参数：$V_0 = 10.0$ $\\mathrm{eV}$，$q_0^{\\mathrm{PAW}} = 2.0$ $\\mathrm{\\AA}^{-1}$，$q_0^{\\mathrm{NC}} = 3.5$ $\\mathrm{\\AA}^{-1}$。\n- 使用 $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 60.0$ $\\mathrm{eV}$ 作为参考截断。\n- 评估以下六种情况：\n    1. 类 PAW 模型，截断能 $E_{\\mathrm{cut}} = 10.0$ $\\mathrm{eV}$。\n    2. 保范模型，截断能 $E_{\\mathrm{cut}} = 10.0$ $\\mathrm{eV}$。\n    3. 类 PAW 模型，截断能 $E_{\\mathrm{cut}} = 20.0$ $\\mathrm{eV}$。\n    4. 保范模型，截断能 $E_{\\mathrm{cut}} = 20.0$ $\\mathrm{eV}$。\n    5. 类 PAW 模型，截断能 $E_{\\mathrm{cut}} = 40.0$ $\\mathrm{eV}$。\n    6. 保范模型，截断能 $E_{\\mathrm{cut}} = 40.0$ $\\mathrm{eV}$。\n\n要求的输出与单位：\n- 对于每种情况，计算以电子伏特为单位的价带宽度 $W_{\\mathrm{val}}$ 和以电子伏特为单位的收敛误差 $\\Delta W$，两者均为浮点数。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的数对列表，每个数对对应一种情况，而每个数对本身是一个包含两个元素的列表 $[W_{\\mathrm{val}},\\Delta W]$。例如：“[[w1,err1],[w2,err2],...]”，其中每个 $w_i$ 和 $err_i$ 的单位都是电子伏特。\n\n科学真实性约束：\n- 模型必须遵循所述的物理假设和单位。\n- 不应包含任何外部数据或快捷方式。哈密顿量必须按照描述从第一性原理构建。\n- 所有能量必须以电子伏特报告。\n- 不需要角度。\n- 不需要百分比。\n\n您的实现必须是一个完整、可运行的 Python 程序，能够执行上述计算，并以指定的精确格式在单行上打印结果。",
            "solution": "我们从周期性势场中的单粒子薛定谔方程开始，\n$$\n\\left(-\\frac{\\hbar^2}{2m}\\nabla^2 + V(\\mathbf{r})\\right)\\psi(\\mathbf{r}) = E\\psi(\\mathbf{r}).\n$$\n对于具有晶格周期性的晶体，根据布洛赫定理，晶体动量为 $\\mathbf{k}$ 的本征态可以展开为一系列平面波，\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}},\n$$\n其中求和遍历所有倒格矢 $\\mathbf{G}$。将平面波展开式代入薛定谔方程，并投影到一个平面波上，即可得到矩阵元\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V(\\mathbf{G}-\\mathbf{G}').\n$$\n动能项是对角的，而势能项通过傅里叶变换 $V(\\mathbf{q})$ 耦合了由 $\\mathbf{q} = \\mathbf{G}-\\mathbf{G}'$ 分隔的平面波。对于每个常规立方晶胞中有两个原子的金刚石结构硅，周期性局域势的傅里叶系数可以表示为\n$$\nV(\\mathbf{q}) = S(\\mathbf{q})\\,v(|\\mathbf{q}|), \\quad S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}},\n$$\n其中 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$ 是常规立方晶胞中第二个原子的基矢，$v(|\\mathbf{q}|)$ 是体现赝势的球对称形状因子。\n\n我们选择两种有充分物理动机的倒易空间形状因子：\n- 一种类 PAW（投影缀加波）的替代形式\n$$\nv_{\\mathrm{PAW}}(q) = -V_0 \\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{PAW}}}\\right)^2\\right],\n$$\n- 一种保范形式\n$$\nv_{\\mathrm{NC}}(q) = -V_0 \\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{NC}}}\\right)^2\\right],\n$$\n其中 $q_0^{\\mathrm{NC}}  q_0^{\\mathrm{PAW}}$ 以确保保范形状因子随 $q$ 衰减得更慢，因此更硬，这与保范赝势需要更多平面波才能收敛这一公认的观察结果一致。\n\n我们从硅的面心立方 (FCC) 常规立方晶胞（晶格常数 $a=5.431$ $\\mathrm{\\AA}$）构建倒格子 $\\mathbf{G}$。常规立方的倒格子基矢是 $\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$、$\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$，但只有全部为偶数或全部为奇数的整数三元组 $(h,k,l)$ 才对应于 FCC 正格子的体心立方 (BCC) 倒格子；因此我们将指数 $(h,k,l)$ 限制为具有相同奇偶性的组合。我们使用动能截断 $E_{\\mathrm{cut}}$ 来截断平面波基组\n$$\n\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}},\n$$\n并使用 $\\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n\n对于能带结构色散关系，我们扫描倒易空间中的一条高对称路径：\n- $\\Gamma = (0,0,0)$,\n- $X = \\left(\\frac{\\pi}{a},0,0\\right)$,\n- $L = \\left(\\frac{\\pi}{a},\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$.\n我们从 $\\Gamma$ 到 $X$ 采样 $N_\\Gamma = 20$ 个点，从 $X$ 到 $L$ 采样 $N_X = 20$ 个点，从而生成沿路径的一系列 $\\mathbf{k}$ 点。\n\n对于每个 $\\mathbf{k}$，我们构建哈密顿量 $H(\\mathbf{k})$，其维度 $M$ 等于所包含的 $\\mathbf{G}$ 矢量的数量。对角元为 $\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2$。非对角耦合元 $V(\\mathbf{G}-\\mathbf{G}')$ 仅依赖于 $\\mathbf{G}-\\mathbf{G}'$，并且可以预先计算在一个矩阵 $V_{\\mathbf{G},\\mathbf{G}'}$ 中。完整的哈密顿量为\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V_{\\mathbf{G},\\mathbf{G}'}.\n$$\n由于 $V(\\mathbf{q})$ 在 $v(q)$ 为实数和结构因子 $S(\\mathbf{q})$ 为复数的情况下满足 $V(-\\mathbf{q}) = V(\\mathbf{q})^*$，因此哈密顿量是厄米矩阵，可以使用标准算法进行对角化。将本征值按升序排列，得到能带 $E_n(\\mathbf{k})$，$n=1,\\dots,M$。\n\n我们将价带宽度定义为最低能带沿路径的能量展宽，\n$$\nW_{\\mathrm{val}} = \\max_{\\mathbf{k}} E_1(\\mathbf{k}) - \\min_{\\mathbf{k}} E_1(\\mathbf{k}).\n$$\n这一选择与单粒子图像一致，其中最低能带对应于局域势模型中最强束缚的、类价带的能带。尽管对价带占据的完整描述需要进行电子计数，但我们在这里关注相对色散关系和收敛行为。对于收敛性评估，我们将误差定义为相对于更高截断参考值的差值，\n$$\n\\Delta W = \\left|W_{\\mathrm{val}}(E_{\\mathrm{cut}}) - W_{\\mathrm{val}}(E_{\\mathrm{cut}}^{\\mathrm{ref}})\\right|.\n$$\n\n算法步骤：\n1. 设置 $a = 5.431$ $\\mathrm{\\AA}$，计算 $b = \\frac{2\\pi}{a}$，以及 $\\alpha = \\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n2. 生成倒格矢 $\\mathbf{G} = b(h,k,l)$，其整数边界由 $E_{\\mathrm{cut}}$ 决定：要求 $\\alpha|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$ 且 $(h,k,l)$ 的奇偶性相同。\n3. 构建金刚石结构因子 $S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}}$，其中 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$。\n4. 使用 $V_0 = 10.0$ $\\mathrm{eV}$、$q_0^{\\mathrm{PAW}} = 2.0$ $\\mathrm{\\AA}^{-1}$ 和 $q_0^{\\mathrm{NC}} = 3.5$ $\\mathrm{\\AA}^{-1}$ 来定义赝势形状因子 $v(q)$。\n5. 对所选赝势，预计算势能矩阵 $V_{\\mathbf{G},\\mathbf{G}'} = S(\\mathbf{G}-\\mathbf{G}')\\,v(|\\mathbf{G}-\\mathbf{G}'|)$。\n6. 通过在 $\\Gamma$ 到 $X$ 之间插值 20 个点以及在 $X$ 到 $L$ 之间插值 20 个点来构建 $\\mathbf{k}$ 点路径。\n7. 对每个 $\\mathbf{k}$，通过将动能对角项和 $V$ 矩阵相加来构建 $H(\\mathbf{k})$，对其进行对角化以获得本征值，并收集最低本征值 $E_1(\\mathbf{k})$。\n8. 将 $E_1$ 在整个路径上的展宽计算为 $W_{\\mathrm{val}}$。\n9. 对每种赝势模型，在 $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 60.0$ $\\mathrm{eV}$ 下计算一个参考 $W_{\\mathrm{val}}$，并对每个目标 $E_{\\mathrm{cut}}$ 计算其绝对差值 $\\Delta W$。\n10. 将结果报告为单位为电子伏特的数对 $[W_{\\mathrm{val}}, \\Delta W]$。\n\n基于第一性原理的预期行为：\n- 类 PAW 模型，$v(q)$ 衰减更快，强调低 $q$ 分量，因此在使用截断平面波基组时收敛更快；在低 $E_{\\mathrm{cut}}$ 时，类 PAW 模型的 $W_{\\mathrm{val}}$ 将更接近其高截断参考值，从而产生更小的 $\\Delta W$。\n- 保范模型，衰减更慢，需要更高的 $E_{\\mathrm{cut}}$ 来精确表示波函数；在相同的低 $E_{\\mathrm{cut}}$ 下，$W_{\\mathrm{val}}$ 将更多地偏离参考值，从而产生更大的 $\\Delta W$。\n- 随着 $E_{\\mathrm{cut}}$ 的增加，两种模型都应显示出 $\\Delta W$ 的减小，反映出收敛性的改善。\n\n该实现严格遵守所述的物理原理，仅使用指定的库，以电子伏特计算所有能量，并以规定的格式返回单行输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants and lattice parameter\nHBAR2_OVER_2M = 3.80998212  # eV*Angstrom^2\nA_SI = 5.431  # Angstrom\nB_RECIP = 2.0 * np.pi / A_SI  # 1/Angstrom\n\n# High-symmetry k-path points in 1/Angstrom\nK_GAMMA = np.array([0.0, 0.0, 0.0])\nK_X = np.array([np.pi / A_SI, 0.0, 0.0])\nK_L = np.array([np.pi / A_SI, np.pi / A_SI, np.pi / A_SI])\n\n# Diamond basis vector tau in Angstrom\nTAU = (A_SI / 4.0) * np.array([1.0, 1.0, 1.0])\n\ndef generate_bcc_reciprocal_vectors(E_cut):\n    \"\"\"\n    Generate reciprocal lattice vectors G = B_RECIP * (h,k,l) (in 1/Angstrom)\n    for FCC direct lattice (BCC reciprocal), restricted to indices of equal parity,\n    and satisfying the kinetic energy cutoff condition HBAR2_OVER_2M * |G|^2 = E_cut.\n    \"\"\"\n    # Determine bounds for h,k,l using maximum integer such that alpha * (b^2) * n^2 = E_cut\n    # alpha*b^2 ~ scaling per integer squared\n    alpha_b2 = HBAR2_OVER_2M * (B_RECIP ** 2)\n    # max integer in one direction assuming other components are zero\n    n_max = int(np.floor(np.sqrt(E_cut / alpha_b2))) + 1\n    G_list = []\n    for h in range(-n_max, n_max + 1):\n        for k in range(-n_max, n_max + 1):\n            for l in range(-n_max, n_max + 1):\n                # Enforce equal parity (all even or all odd) for BCC reciprocal lattice\n                if (h % 2) == (k % 2) and (k % 2) == (l % 2):\n                    G = B_RECIP * np.array([h, k, l], dtype=float)\n                    E_g = HBAR2_OVER_2M * np.dot(G, G)\n                    if E_g = E_cut + 1e-12:\n                        G_list.append(G)\n    # Sort by |G| to have a consistent order\n    G_arr = np.array(G_list)\n    if len(G_arr) == 0:\n        return G_arr\n    norms = np.linalg.norm(G_arr, axis=1)\n    order = np.argsort(norms)\n    G_sorted = G_arr[order]\n    return G_sorted\n\ndef k_path(num_gamma_to_x=20, num_x_to_l=20):\n    \"\"\"\n    Generate the k-point path Gamma -> X -> L with specified points per segment.\n    Returns an array of shape (num_points, 3).\n    \"\"\"\n    # Linear interpolation including endpoints, but avoid double-counting X\n    ks1 = np.linspace(0.0, 1.0, num_gamma_to_x, endpoint=True)\n    seg1 = (1.0 - ks1)[:, None] * K_GAMMA[None, :] + ks1[:, None] * K_X[None, :]\n    ks2 = np.linspace(0.0, 1.0, num_x_to_l, endpoint=True)\n    seg2 = (1.0 - ks2)[:, None] * K_X[None, :] + ks2[:, None] * K_L[None, :]\n    # Concatenate; since seg1 includes X and seg2 includes X, we can include both for simplicity\n    path = np.vstack([seg1, seg2])\n    return path\n\ndef structure_factor(q_vec):\n    \"\"\"\n    Diamond structure factor S(q) = 1 + exp(i q . tau).\n    q_vec is in 1/Angstrom, tau in Angstrom.\n    Returns complex scalar.\n    \"\"\"\n    phase = np.dot(q_vec, TAU)\n    return 1.0 + np.exp(1j * phase)\n\ndef v_form_factor(q_mag, model_params):\n    \"\"\"\n    Spherically symmetric pseudopotential form factor v(q) for given magnitude q (1/Angstrom).\n    model_params: dict with keys 'V0' (eV), 'q0' (1/Angstrom).\n    v(q) = -V0 * exp(-(q/q0)^2)\n    \"\"\"\n    V0 = model_params['V0']\n    q0 = model_params['q0']\n    return -V0 * np.exp(- (q_mag / q0) ** 2)\n\ndef precompute_V_matrix(G_vectors, model_params):\n    \"\"\"\n    Precompute the potential coupling matrix V_{G,G'} = S(G - G') * v(|G - G'|)\n    for all pairs of G. Returns a complex matrix of shape (M,M).\n    \"\"\"\n    M = len(G_vectors)\n    V_mat = np.zeros((M, M), dtype=np.complex128)\n    # Precompute differences and their v(q) * S(q)\n    for i in range(M):\n        Gi = G_vectors[i]\n        for j in range(M):\n            Gj = G_vectors[j]\n            q = Gi - Gj\n            q_mag = np.linalg.norm(q)\n            if q_mag  1e-9: # Avoid numerical issues at q=0 if v(0) is not needed for off-diagonal\n                S_q = 2.0\n                v_q = v_form_factor(0.0, model_params)\n            else:\n                S_q = structure_factor(q)\n                v_q = v_form_factor(q_mag, model_params)\n            V_mat[i, j] = S_q * v_q\n    # Enforce Hermiticity numerically by symmetrizing\n    V_mat = 0.5 * (V_mat + V_mat.conj().T)\n    return V_mat\n\ndef assemble_H_and_lowest_e(G_vectors, V_mat, k_vec):\n    \"\"\"\n    Assemble Hamiltonian H(k) = diag( alpha * |k + G|^2 ) + V_mat, and return lowest eigenvalue.\n    \"\"\"\n    # Kinetic diagonal\n    KG = G_vectors + k_vec[None, :]\n    kinetic = HBAR2_OVER_2M * np.einsum('ij,ij->i', KG, KG)  # alpha * |k+G|^2\n    H = V_mat.copy()\n    # Add kinetic to the diagonal\n    np.fill_diagonal(H, H.diagonal() + kinetic)\n    # Diagonalize Hermitian matrix\n    evals = np.linalg.eigvalsh(H)\n    return evals[0]  # lowest eigenvalue (real)\n\ndef compute_valence_bandwidth(E_cut, model_params, num_k_seg=20):\n    \"\"\"\n    Compute the valence bandwidth W_val for the given cutoff and pseudopotential model.\n    \"\"\"\n    Gs = generate_bcc_reciprocal_vectors(E_cut)\n    if len(Gs) == 0:\n        # If no G vectors satisfy the cutoff, bandwidth is zero by construction\n        return 0.0\n    V_mat = precompute_V_matrix(Gs, model_params)\n    kpts = k_path(num_gamma_to_x=num_k_seg, num_x_to_l=num_k_seg)\n    # Compute lowest eigenvalue at each k-point\n    lowest_e = []\n    for k in kpts:\n        e0 = assemble_H_and_lowest_e(Gs, V_mat, k)\n        lowest_e.append(e0)\n    lowest_e = np.array(lowest_e)\n    # Valence bandwidth is max-min of the lowest band energies\n    W_val = float(np.max(lowest_e) - np.min(lowest_e))\n    return W_val\n\ndef solve():\n    # Define pseudopotential parameters\n    paw_params = {'V0': 10.0, 'q0': 2.0}  # eV, 1/Angstrom\n    nc_params = {'V0': 10.0, 'q0': 3.5}   # eV, 1/Angstrom\n\n    # Reference cutoff for convergence assessment\n    E_cut_ref = 60.0  # eV\n\n    # Test cases: (label, model_params, E_cut)\n    test_cases = [\n        (\"PAW\", paw_params, 10.0),\n        (\"NC\",  nc_params, 10.0),\n        (\"PAW\", paw_params, 20.0),\n        (\"NC\",  nc_params, 20.0),\n        (\"PAW\", paw_params, 40.0),\n        (\"NC\",  nc_params, 40.0),\n    ]\n\n    # Precompute references for each model\n    W_ref = {}\n    # Compute once for PAW and NC\n    W_ref[\"PAW\"] = compute_valence_bandwidth(E_cut_ref, paw_params, num_k_seg=20)\n    W_ref[\"NC\"] = compute_valence_bandwidth(E_cut_ref, nc_params, num_k_seg=20)\n\n    results_pairs = []\n    for label, params, E_cut in test_cases:\n        W_val = compute_valence_bandwidth(E_cut, params, num_k_seg=20)\n        dW = abs(W_val - W_ref[label])\n        results_pairs.append([W_val, dW])\n\n    # Format output as a single line: list of [W_val, dW] pairs\n    # Ensure pure Python-list string formatting with numeric entries\n    def pair_to_str(pair):\n        return f\"[{pair[0]},{pair[1]}]\"\n    out = \"[\" + \",\".join(pair_to_str(p) for p in results_pairs) + \"]\"\n    print(out)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "当材料尺寸减小到纳米尺度时，量子限制效应会显著改变其电子性质，形成分立的子能带。这项实践将引导你使用有限差分法这一强大的数值工具，来求解一维量子阱中的薛定谔方程，并以此为基础分析平板结构中的量子限制效应 。通过将数值解与解析解进行对比，你将直观地掌握子能带的形成、能量随厚度的标度关系，以及低维系统与块体材料的根本差异。",
            "id": "3433832",
            "problem": "考虑晶体板中的电子，其模型为具有有效质量 $m^{\\ast}$ 的单一各向同性抛物线型导带，电子在 $z$ 方向上被厚度为 $L$ 的无限深势阱限制，在平面内 $(x,y)$ 方向上自由运动。假设适用单粒子不含时薛定谔方程。平面内色散关系由平移不变性决定，$z$ 方向的限制产生了分立的量子阱子带。您将使用有限差分 (FD) 法对沿 $z$ 方向的动能算符进行离散化，并结合在 $z=0$ 和 $z=L$ 处的 Dirichlet 边界条件，来近似求解受限本征能量。\n\n从质量为 $m^{\\ast}$ 的电子在沿 $z$ 方向的无限深方势阱中且在平面内自由运动的不含时薛定谔方程出发，\n- 推导变量分离，分离出一个平面内平面波（其波矢大小为 $k=\\lvert \\mathbf{k}_{\\parallel}\\rvert$）和一个满足一维 $z$ 方程的依赖于 $z$ 的包络函数，\n- 证明平面内色散贡献与量子化限制能量是可加性分离的，\n- 并为 $z$ 方程构建一个二阶中心差分有限差分格式，该格式具有 $N_{z}$ 个内部格点和均匀间距 $a$，并通过从本征问题中排除边界点来施加在 $z=0$ 和 $z=L$ 处的 Dirichlet 边界条件。\n\n然后，您将使用有限差分哈密顿矩阵数值计算最低的几个限制本征能量，并评估以下性质：\n- 最低限制能级与连续无限深阱极限的定量一致性，\n- 最低限制能级随板厚 $L$ 的标度关系，\n- 表明子带形成的第二限制能级与第一限制能级之比，\n- 平面内抛物线型色散关系和有效质量的保持性，\n- 以及在给定能量截断值以下的受限子带数量。\n\n使用以下常数和单位：\n- 约化普朗克常数 $\\hbar$，单位为 $\\mathrm{J \\cdot s}$，\n- 电子静止质量 $m_{e}$，单位为 $\\mathrm{kg}$，\n- 元电荷 $q$，单位为 $\\mathrm{C}$，\n- 能量输出必须通过除以 $q$ 从焦耳转换为电子伏特 (eV) 来表示，\n- 所有长度必须以米表示，波矢以 $\\mathrm{m^{-1}}$ 表示，\n- 不涉及角度，且不使用百分号；任何比率都应为无量纲小数。\n\n采用以下离散化方案：\n- 选择内部有限差分点数 $N_{z}$ 为 $N_{z} = \\max\\!\\big(50, \\lfloor p \\cdot L_{\\mathrm{nm}} \\rfloor \\big)$，其中 $p$ 是每纳米点数密度，$L_{\\mathrm{nm}}$ 是以纳米表示的 $L$，\n- 设置网格间距 $a = L / (N_{z}+1)$，\n- 构建 $z$ 方向动能的三对角有限差分哈密顿量，$H_{z} = \\gamma \\, T$，其中 $\\gamma = \\dfrac{\\hbar^{2}}{2 m^{\\ast} a^{2}}$，$T$ 是一个 $N_{z} \\times N_{z}$ 的三对角矩阵，其主对角线元素为 $2$，第一副对角线和第一超对角线元素为 $-1$，\n- 求解 $H_{z}$ 的最小的 $n_{\\max}$ 个本征值，以获得 $k=0$ 时的受限子带能量。\n\n对于平面内色散关系的验证，利用哈密顿量的可加性分离构成 $E_{n}(k) = E^{(z)}_{n} + E_{\\parallel}(k)$，其中 $E_{\\parallel}(k)$ 由平面内动能确定。通过使用对称有限差分数值近似在 $k=0$ 处的 $\\dfrac{\\mathrm{d}^{2} E_{1}}{\\mathrm{d} k^{2}}$，然后反演联系曲率与有效质量的关系，来估算平面内有效质量。\n\n测试套件：\n- 所有测试通用的物理参数：有效质量 $m^{\\ast} = 0.067 \\, m_{e}$，每纳米点数密度 $p = 40$，并对每个 $L$ 考虑最多 $n_{\\max} = 6$ 个受限能级。\n- 测试 1（第一能级的一致性）：$L = 5 \\, \\mathrm{nm}$。计算有限差分法计算的基态限制能量与相同 $m^{\\ast}$ 和 $L$ 的连续无限深阱极限之间的绝对差，单位为 $\\mathrm{eV}$。\n- 测试 2（厚度标度关系）：$L_{1} = 5 \\, \\mathrm{nm}$ 和 $L_{2} = 10 \\, \\mathrm{nm}$。计算有限差分法计算的基态能量之比与连续谱厚度标度关系预测值之间的绝对差，结果为无量纲小数。\n- 测试 3（子带形成）：$L = 5 \\, \\mathrm{nm}$。计算有限差分比率 $E^{(z)}_{2}/E^{(z)}_{1}$ 与连续无限深阱极限下前两个能级的比率之间的绝对差，结果为无量纲小数。\n- 测试 4（平面内有效质量）：$L = 5 \\, \\mathrm{nm}$。使用最低子带，利用 $k_{0} = 1.0 \\times 10^{8} \\, \\mathrm{m^{-1}}$ 在 $k=0$ 处对曲率进行对称有限差分估计，计算由此提取的有效质量与输入 $m^{\\ast}$ 之间的相对误差，结果为无量纲小数。\n- 测试 5（薄板在截断能量下的子带数量）：$L = 5 \\, \\mathrm{nm}$。计算在 $k=0$ 时，严格低于 $0.5 \\, \\mathrm{eV}$ 能量截断值的受限子带 $E^{(z)}_{n}$ 的整数数量。\n- 测试 6（厚板在截断能量下的子带数量）：$L = 20 \\, \\mathrm{nm}$。计算在 $k=0$ 时，严格低于相同的 $0.5 \\, \\mathrm{eV}$ 能量截断值的受限子带 $E^{(z)}_{n}$ 的整数数量。\n\n您的程序必须实现有限差分格式和连续无限深阱极限，使用相同的 $m^{\\ast}$ 和 $L$ 参数进行比较，并按上述顺序生成六个结果：\n- 测试 1：一个浮点数，单位为 $\\mathrm{eV}$，\n- 测试 2：一个无量纲浮点数，\n- 测试 3：一个无量纲浮点数，\n- 测试 4：一个无量纲浮点数，\n- 测试 5：一个整数，\n- 测试 6：一个整数。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个逗号分隔的结果列表，并用方括号括起来（例如 $[r_{1},r_{2},r_{3},r_{4},r_{5},r_{6}]$）。确保能量单位为 $\\mathrm{eV}$，非能量量为指定的无量纲小数或整数。",
            "solution": "### 理论框架\n\n该问题要求我们对量子阱结构中的电子进行建模。该模型假设一个单一的各向同性抛物线型导带，由有效质量 $m^{\\ast}$ 表征。电子在 $z$ 方向上被厚度为 $L$ 的板内的无限深势阱限制，并且可以在 $xy$ 平面内自由移动。\n\n控制方程是单粒子的不含时薛定谔方程 (TISE)：\n$$\n\\left( -\\frac{\\hbar^2}{2m^{\\ast}} \\nabla^2 + V(z) \\right) \\Psi(\\mathbf{r}) = E \\Psi(\\mathbf{r})\n$$\n其中 $\\mathbf{r} = (x,y,z)$，$\\nabla^2$ 是拉普拉斯算符，$E$ 是总能量。势能 $V(z)$ 描述了无限深方势阱：\n$$\nV(z) = \\begin{cases} 0  \\text{if } 0  z  L \\\\ \\infty  \\text{otherwise} \\end{cases}\n$$\n限制势仅取决于 $z$。这使得变量分离成为可能。我们假设解的形式为 $\\Psi(x,y,z) = \\phi(x,y) \\psi(z)$。将其代入 TISE 并除以 $\\Psi(x,y,z)$ 得到：\n$$\n\\frac{1}{\\phi(x,y)} \\left( -\\frac{\\hbar^2}{2m^{\\ast}} (\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}) \\phi(x,y) \\right) + \\frac{1}{\\psi(z)} \\left( -\\frac{\\hbar^2}{2m^{\\ast}} \\frac{d^2}{dz^2} \\psi(z) + V(z)\\psi(z) \\right) = E\n$$\n该方程分离为两个独立的方程，一个用于平面内运动 $(x,y)$，一个用于限制方向 $(z)$：\n$$\n-\\frac{\\hbar^2}{2m^{\\ast}} (\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}) \\phi(x,y) = E_{\\parallel} \\phi(x,y)\n$$\n$$\n-\\frac{\\hbar^2}{2m^{\\ast}} \\frac{d^2\\psi(z)}{dz^2} + V(z)\\psi(z) = E_z \\psi(z)\n$$\n总能量是各部分能量之和：$E = E_{\\parallel} + E_z$。\n\n平面内方程描述了一个自由粒子。其解是平面波，$\\phi(x,y) = C e^{i(k_x x + k_y y)}$，其中 $\\mathbf{k}_{\\parallel} = (k_x, k_y)$ 是平面内波矢。对应的能量是平面内运动的动能：\n$$\nE_{\\parallel}(k) = \\frac{\\hbar^2 (k_x^2 + k_y^2)}{2m^{\\ast}} = \\frac{\\hbar^2 k^2}{2m^{\\ast}}\n$$\n其中 $k = |\\mathbf{k}_{\\parallel}|$ 是平面内波矢的大小。这定义了抛物线型的平面内色散关系。\n\n$z$ 方向的方程是粒子在一维无限深方势阱中的 TISE。由无限深势阱产生的边界条件是 $\\psi(0)=0$ 和 $\\psi(L)=0$。其解析解是众所周知的：\n$$\n\\psi_n(z) = \\sqrt{\\frac{2}{L}} \\sin\\left(\\frac{n\\pi z}{L}\\right)\n$$\n对应的量子化本征能量构成了子带底：\n$$\nE_n^{(z)} = \\frac{\\hbar^2 \\pi^2 n^2}{2m^{\\ast} L^2} \\quad \\text{for } n = 1, 2, 3, \\dots\n$$\n因此，在第 $n$ 个子带中，具有平面内波矢 $k$ 的电子的总能量是可加性分离的：\n$$\nE_n(k) = E_n^{(z)} + E_{\\parallel}(k) = \\frac{\\hbar^2 \\pi^2 n^2}{2m^{\\ast} L^2} + \\frac{\\hbar^2 k^2}{2m^{\\ast}}\n$$\n\n### 有限差分离散化\n\n现在我们对 $z$ 方向的薛定谔方程进行离散化，以数值方式求出限制能量 $E_n^{(z)}$。我们沿 $z$ 方向定义一个具有 $N_z$ 个内部点的均匀网格。格点为 $z_j = j \\cdot a$，其中 $j=0, 1, \\dots, N_z+1$，网格间距为 $a=L/(N_z+1)$。波函数由其在这些点上的值表示，即 $\\psi_j = \\psi(z_j)$。Dirichlet 边界条件为 $\\psi_0 = 0$ 和 $\\psi_{N_z+1}=0$。\n\n二阶导数使用二阶中心差分公式进行近似：\n$$\n\\frac{d^2\\psi}{dz^2}\\bigg|_{z_j} \\approx \\frac{\\psi_{j+1} - 2\\psi_j + \\psi_{j-1}}{a^2}\n$$\n将此代入势阱内的一维 TISE（$V(z)=0$）：\n$$\n-\\frac{\\hbar^2}{2m^{\\ast}} \\left( \\frac{\\psi_{j+1} - 2\\psi_j + \\psi_{j-1}}{a^2} \\right) = E_z \\psi_j\n$$\n整理各项，我们得到一个关于内部格点 $j=1, \\dots, N_z$ 的线性方程组：\n$$\n\\frac{\\hbar^2}{2m^{\\ast}a^2} (2\\psi_j - \\psi_{j-1} - \\psi_{j+1}) = E_z \\psi_j\n$$\n这可以写成一个矩阵本征值问题，$H_z \\vec{\\psi} = E_z \\vec{\\psi}$，其中 $\\vec{\\psi}$ 是向量 $(\\psi_1, \\dots, \\psi_{N_z})^T$。哈密顿矩阵 $H_z$ 是一个 $N_z \\times N_z$ 的三对角矩阵。根据题目要求，我们可以写成 $H_z = \\gamma T$，其中 $\\gamma = \\frac{\\hbar^2}{2m^{\\ast}a^2}$，$T$ 是无量纲矩阵：\n$$\nT = \\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\cdots  0 \\\\\n0  -1  2  \\ddots  \\vdots \\\\\n\\vdots  \\vdots  \\ddots  \\ddots  -1 \\\\\n0  0  \\cdots  -1  2\n\\end{pmatrix}\n$$\n该矩阵 $H_z$ 的本征值是限制能量 $E_n^{(z)}$ 的数值近似。\n\n### 数值实现与测试\n\n实现过程首先根据给定的物理和离散化参数构建三对角哈密顿矩阵。然后使用数值求解器找到本征值。`scipy.linalg.eigh_tridiagonal` 函数对此类问题非常高效。\n\n- **测试 1 (一致性)**：将有限差分法得到的最低本征值与解析基态能量 $E_1^{(z)} = \\hbar^2\\pi^2/(2m^{\\ast}L^2)$进行比较。二阶中心差分格式的离散误差会导致有限差分法的本征值略低于连续谱的值。\n\n- **测试 2 (标度关系)**：连续谱能量的标度关系为 $E_n^{(z)} \\propto L^{-2}$。该测试验证对于两种不同厚度 $L_1$ 和 $L_2$，有限差分计算的基态能量之比是否近似于连续谱的标度比 $(L_2/L_1)^2$。由于离散化密度方案 $N_z \\propto L$，结果会与理想标度关系有微小偏差。\n\n- **测试 3 (子带形成)**：计算第二与第一限制能量之比 $E_2^{(z)}/E_1^{(z)}$。在连续谱极限下，此比值为 $2^2/1^2=4$。由于依赖于能量的离散误差，有限差分法的结果会略有不同。\n\n- **测试 4 (平面内有效质量)**：总能量为 $E_1(k) = E_{1,FD}^{(z)} + \\hbar^2 k^2/(2m^{\\ast})$。平面内有效质量与能带的曲率相关：$m^{\\ast} = \\hbar^2 / (\\mathrm{d}^2E/\\mathrm{d}k^2)$。通过对 $E_1(k)$ 的给定解析形式使用有限差分数值近似在 $k=0$ 处的二阶导数，我们必须能够恢复输入的有效质量，因为我们从一开始就假设了哈密顿量的可加性分离。该测试确认了这种自洽性，相对误差预计为零（或在机器精度范围内）。\n\n- **测试 5 和 6 (子带计数)**：对于给定的板厚 $L$，我们计算限制能量的全谱 $E_n^{(z)}$，并统计有多少个严格低于 $0.5 \\, \\mathrm{eV}$ 的能量截断值。由于限制能量随 $L$ 的增加而减小，预计测试 6 中的厚板将比测试 5 中的薄板在截断值以下容纳更多子带。\n\n计算使用所提供的物理常数和参数进行。所有能量输出都转换为电子伏特 (eV)。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Main function to perform the calculations and print the final results.\n    \"\"\"\n    # Physical constants in SI units\n    HBAR = 1.054571817e-34  # J*s\n    M_E = 9.1093837015e-31  # kg\n    Q = 1.602176634e-19     # C (elementary charge for eV conversion)\n\n    # Common parameters for all tests\n    M_STAR_REL = 0.067\n    M_STAR = M_STAR_REL * M_E\n    P_DENSITY = 40.0\n    E_CUTOFF_EV = 0.5\n    E_CUTOFF_J = E_CUTOFF_EV * Q\n\n    def solve_fd(L_m, m_star, p_density):\n        \"\"\"\n        Solves the 1D Schrodinger equation for an infinite well using the \n        Finite Difference method.\n        Returns all confinement eigenenergies in Joules, sorted in ascending order.\n        \"\"\"\n        L_nm = L_m * 1e9\n        Nz = int(max(50, np.floor(p_density * L_nm)))\n        a = L_m / (Nz + 1)\n        \n        gamma = HBAR**2 / (2 * m_star * a**2)\n        \n        # The FD Hamiltonian matrix Hz is gamma * T, where T is a tridiagonal matrix\n        # with 2 on the diagonal and -1 on the off-diagonals.\n        # This is equivalent to a tridiagonal matrix with 2*gamma on the diagonal and\n        # -gamma on the off-diagonals.\n        diagonal = 2 * gamma * np.ones(Nz)\n        off_diagonal = -gamma * np.ones(Nz - 1)\n        \n        eigenvalues_J = eigh_tridiagonal(diagonal, off_diagonal, eigvals_only=True)\n        return eigenvalues_J\n\n    def solve_continuum(n, L_m, m_star):\n        \"\"\"\n        Calculates the analytical n-th eigenenergy for a 1D infinite well.\n        \"\"\"\n        return (HBAR * np.pi * n)**2 / (2 * m_star * L_m**2)\n\n    results = []\n\n    # --- Test 1: Agreement of the first level ---\n    L = 5.0e-9\n    fd_energies_test1_J = solve_fd(L, M_STAR, P_DENSITY)\n    e1_fd_J = fd_energies_test1_J[0]\n    e1_cont_J = solve_continuum(1, L, M_STAR)\n    diff_ev = abs(e1_fd_J - e1_cont_J) / Q\n    results.append(diff_ev)\n\n    # --- Test 2: Thickness scaling ---\n    L1 = 5.0e-9\n    L2 = 10.0e-9\n    e1_fd_L1_J = solve_fd(L1, M_STAR, P_DENSITY)[0]\n    e1_fd_L2_J = solve_fd(L2, M_STAR, P_DENSITY)[0]\n    fd_ratio = e1_fd_L1_J / e1_fd_L2_J\n    continuum_ratio = (L2 / L1)**2\n    diff_ratio = abs(fd_ratio - continuum_ratio)\n    results.append(diff_ratio)\n\n    # --- Test 3: Subband formation ---\n    L = 5.0e-9\n    e1_fd_J = fd_energies_test1_J[0]\n    e2_fd_J = fd_energies_test1_J[1]\n    fd_subband_ratio = e2_fd_J / e1_fd_J\n    continuum_subband_ratio = 4.0\n    diff_subband_ratio = abs(fd_subband_ratio - continuum_subband_ratio)\n    results.append(diff_subband_ratio)\n\n    # --- Test 4: In-plane effective mass ---\n    k0 = 1.0e8\n    m_input = M_STAR\n    e1_at_0 = fd_energies_test1_J[0]\n    \n    # E(k) = E_z + hbar^2*k^2/(2*m_star)\n    e1_at_k0 = e1_at_0 + (HBAR**2 * k0**2) / (2 * m_input)\n    \n    # Curvature C from symmetric finite difference: C = 2*(E(k0) - E(0)) / k0^2\n    # For a purely quadratic dispersion, the two-point formula is exact for any k0.\n    # C = (E(k0)-E(0)) / (0.5*k0^2)\n    curvature = 2 * (e1_at_k0 - e1_at_0) / k0**2\n    \n    # m_extracted = hbar^2 / C\n    m_extracted = HBAR**2 / curvature\n    \n    rel_error_mass = abs(m_extracted - m_input) / m_input\n    results.append(rel_error_mass)\n\n    # --- Test 5: Subband count at cutoff for thin slab (L=5nm) ---\n    count_thin = np.sum(fd_energies_test1_J  E_CUTOFF_J)\n    results.append(int(count_thin))\n\n    # --- Test 6: Subband count at cutoff for thicker slab (L=20nm) ---\n    L = 20.0e-9\n    fd_energies_thick_J = solve_fd(L, M_STAR, P_DENSITY)\n    count_thick = np.sum(fd_energies_thick_J  E_CUTOFF_J)\n    results.append(int(count_thick))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然密度泛函理论（DFT）是材料计算的有力工具，但其著名的“带隙问题”限制了其在某些应用中的预测精度。这项实践聚焦于一个高级且实用的主题：如何修正DFT计算结果以更好地匹配实验或更高精度的理论（如$G_0W_0$）。通过实施“剪刀修正”这一启发式方法并量化其引入的残余误差，你将学会批判性地评估计算结果，并理解不同理论方法之间的层次关系。",
            "id": "3433858",
            "problem": "给定一个立方晶体中布里渊区（BZ）中心与某个区边界方向之间路径上的能带色散模型。该路径是从 $\\Gamma$ 到 $X$ 的连线，由标量波矢 $k \\in [0,\\pi/a]$ 参数化，其中 $a$ 是以埃（$\\text{\\AA}$）为单位的晶格常数，$k$ 的单位是逆埃（$\\text{\\AA}^{-1}$）。能量参考点是 $\\Gamma$ 点的价带顶，其能量设为 0 电子伏特（eV）。您的任务是提出、实现并测试一个剪刀修正（scissor correction），该修正根据 $\\Gamma$ 点处 $G_0W_0$ 近似（G0W0）下的多体微扰理论计算的基本带隙进行校准。然后，分析该修正对有效质量以及沿 $\\Gamma$–$X$ 路径上更高能量的导带所产生的残余误差。\n\n从以下经过充分测试的基础模型开始。对于第 $n$ 个导带（其中 $n \\in \\{1,2,3\\}$），其色散部分的 $E_{d,n}(k)$ 由一个非抛物线 Kane 型关系建模，\n$$\nE_{d,n}(k)\\bigl(1+\\alpha_n E_{d,n}(k)\\bigr) = A_n k^2,\n$$\n其中\n$$\nA_n = \\frac{\\hbar^2}{2 m_n} \\times 10^{20},\n$$\n因此，当 $k$ 的单位是 $\\text{\\AA}^{-1}$ 时，$A_n$ 的单位是 $\\text{eV}\\cdot\\text{\\AA}^2$。此处 $\\hbar$ 是普朗克约化常数，单位为 $\\text{eV}\\cdot \\text{s}$，$m_n$ 是能带有效质量，单位为千克。总能带能量为\n$$\nE_n(k) = E_{0,n} + E_{d,n}(k),\n$$\n其中 $E_{0,1} = E_g$ 是基本带隙，对于 $n \\ge 2$，$E_{0,n} = E_g + \\Delta_n$。非抛物线性参数 $\\alpha_n$ 的单位是 $\\text{eV}^{-1}$。带边的有效质量通过有效质量定理与曲率相关，对于小的 $k$ 值，其二阶导数为\n$$\n\\left.\\frac{d^2 E_n}{dk^2}\\right|_{k=0} = \\frac{\\hbar^2}{m_n} \\times 10^{20}.\n$$\n\n使用密度泛函理论（DFT）和 $G_0W_0$ 在 $\\Gamma$ 点的带边带隙来校准剪刀修正。定义\n$$\n\\Delta^{\\text{sc}} = E_g^{G_0W_0} - E_g^{\\text{DFT}}.\n$$\n将剪刀修正统一应用于所有 DFT 导带，如下所示\n$$\nE^{\\text{sc}}_n(k) = E^{\\text{DFT}}_n(k) + \\Delta^{\\text{sc}},\n$$\n这会保持曲率不变，因此 DFT 的有效质量也保持不变。通过将经过剪刀修正的量与目标 $G_0W_0$ 的量进行比较，来量化此近似所引起的残余差异。\n\n您的程序必须：\n- 为 DFT 和 $G_0W_0$ 两套参数实现上述色散模型。\n- 对从 0 到 $\\pi/a$（包含两端）的 $k$ 值使用一个包含 $N_k$ 个点的均匀网格，其中 $N_k \\ge 3$。\n- 通过在 $k=0$ 处使用前向三点二阶有限差分公式估算曲率，计算经过剪刀修正的第一导带（CB1）和 $G_0W_0$ 的 CB1 在 $\\Gamma$ 点的有效质量：\n$$\n\\left.\\frac{d^2E}{dk^2}\\right|_{k=0} \\approx \\frac{E(2h) - 2E(h) + E(0)}{h^2}, \\quad h = \\frac{\\pi/a}{N_k-1}.\n$$\n然后使用以下公式将曲率转换为质量\n$$\nm^* = \\frac{\\hbar^2 \\times 10^{20}}{\\left.\\frac{d^2E}{dk^2}\\right|_{k=0}},\n$$\n并报告有效质量的相对误差\n$$\n\\varepsilon_m = \\frac{m^*_{\\text{sc}} - m^*_{G_0W_0}}{m^*_{G_0W_0}},\n$$\n以无量纲小数形式表示。\n- 计算第二和第三导带（CB2 和 CB3）沿 $\\Gamma$–$X$ 路径的均方根（RMS）能量误差，\n$$\n\\mathrm{RMS}_n = \\sqrt{\\frac{1}{M}\\sum_{i=0}^{M-1}\\left(E^{\\text{sc}}_n(k_i)-E^{G_0W_0}_n(k_i)\\right)^2},\n$$\n其中 $M=N_k$，并以电子伏特（eV）为单位报告每个 RMS 值。\n\n在您的计算中使用以下物理常数：\n- $\\hbar = 6.582119569\\times 10^{-16}\\,\\text{eV}\\cdot \\text{s}$,\n- $m_e = 9.10938356\\times 10^{-31}\\,\\text{kg}$.\n在内部以千克为单位报告有效质量值，但将误差表示为无量纲小数。\n\n测试套件。在以下三组参数集上运行您的实现，每组参数是针对一种假设的立方材料的 DFT 和 $G_0W_0$ 参数元组：\n- 情况 1（典型）：\n  - $a = 5.65\\,\\text{\\AA}$, $N_k=101$, $E_g^{\\text{DFT}}=0.90\\,\\text{eV}$, $E_g^{G_0W_0}=1.20\\,\\text{eV}$.\n  - CB$1$: $m^{\\text{DFT}}/m_e = 0.25$, $\\alpha^{\\text{DFT}}=0.8\\,\\text{eV}^{-1}$, $\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$; $m^{G_0W_0}/m_e = 0.20$, $\\alpha^{G_0W_0}=1.0\\,\\text{eV}^{-1}$, $\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$.\n  - CB$2$: $\\Delta_2^{\\text{DFT}}=1.00\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=0.60$, $\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$; $\\Delta_2^{G_0W_0}=0.90\\,\\text{eV}$, $m^{G_0W_0}/m_e=0.50$, $\\alpha^{G_0W_0}=0.4\\,\\text{eV}^{-1}$.\n  - CB$3$: $\\Delta_3^{\\text{DFT}}=2.00\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=1.20$, $\\alpha^{\\text{DFT}}=0.2\\,\\text{eV}^{-1}$; $\\Delta_3^{G_0W_0}=1.80\\,\\text{eV}$, $m^{G_0W_0}/m_e=1.00$, $\\alpha^{G_0W_0}=0.25\\,\\text{eV}^{-1}$.\n- 情况 2（边界，零剪刀修正）：\n  - $a = 3.57\\,\\text{\\AA}$, $N_k=101$, $E_g^{\\text{DFT}}=1.50\\,\\text{eV}$, $E_g^{G_0W_0}=1.50\\,\\text{eV}$.\n  - CB$1$: $m^{\\text{DFT}}/m_e = 0.35$, $\\alpha^{\\text{DFT}}=0.9\\,\\text{eV}^{-1}$, $\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$; $m^{G_0W_0}/m_e = 0.30$, $\\alpha^{G_0W_0}=1.1\\,\\text{eV}^{-1}$, $\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$.\n  - CB$2$: $\\Delta_2^{\\text{DFT}}=0.80\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=0.55$, $\\alpha^{\\text{DFT}}=0.4\\,\\text{eV}^{-1}$; $\\Delta_2^{G_0W_0}=0.75\\,\\text{eV}$, $m^{G_0W_0}/m_e=0.45$, $\\alpha^{G_0W_0}=0.5\\,\\text{eV}^{-1}$.\n  - CB$3$: $\\Delta_3^{\\text{DFT}}=1.50\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=0.90$, $\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$; $\\Delta_3^{G_0W_0}=1.40\\,\\text{eV}$, $m^{G_0W_0}/m_e=0.80$, $\\alpha^{G_0W_0}=0.35\\,\\text{eV}^{-1}$.\n- 情况 3（负剪刀修正）：\n  - $a = 4.00\\,\\text{\\AA}$, $N_k=101$, $E_g^{\\text{DFT}}=1.80\\,\\text{eV}$, $E_g^{G_0W_0}=1.50\\,\\text{eV}$.\n  - CB$1$: $m^{\\text{DFT}}/m_e = 0.18$, $\\alpha^{\\text{DFT}}=1.1\\,\\text{eV}^{-1}$, $\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$; $m^{G_0W_0}/m_e = 0.22$, $\\alpha^{G_0W_0}=0.9\\,\\text{eV}^{-1}$, $\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$.\n  - CB$2$: $\\Delta_2^{\\text{DFT}}=1.20\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=0.40$, $\\alpha^{\\text{DFT}}=0.5\\,\\text{eV}^{-1}$; $\\Delta_2^{G_0W_0}=1.10\\,\\text{eV}$, $m^{G_0W_0}/m_e=0.45$, $\\alpha^{G_0W_0}=0.45\\,\\text{eV}^{-1}$.\n  - CB$3$: $\\Delta_3^{\\text{DFT}}=2.50\\,\\text{eV}$, $m^{\\text{DFT}}/m_e=0.85$, $\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$; $\\Delta_3^{G_0W_0}=2.30\\,\\text{eV}$, $m^{G_0W_0}/m_e=0.75$, $\\alpha^{G_0W_0}=0.35\\,\\text{eV}^{-1}$.\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序为每个测试用例提供一个三元组：$[\\varepsilon_m,\\mathrm{RMS}_2,\\mathrm{RMS}_3]$。对于所有三种情况，将这些三元组聚合为单个列表的列表，例如\n$$\n[[\\varepsilon_{m,1},\\mathrm{RMS}_{2,1},\\mathrm{RMS}_{3,1}],[\\varepsilon_{m,2},\\mathrm{RMS}_{2,2},\\mathrm{RMS}_{3,2}],[\\varepsilon_{m,3},\\mathrm{RMS}_{2,3},\\mathrm{RMS}_{3,3}]].\n$$\n每个 $\\varepsilon_m$ 必须是无量纲小数，每个 $\\mathrm{RMS}_n$ 的单位必须是电子伏特（eV）。",
            "solution": "### 色散模型\n\n该任务的核心是实现并分析一个用于模拟导带色散的 Kane 型非抛物线模型。第 $n$ 个能带的总能量由 $E_n(k) = E_{0,n} + E_{d,n}(k)$ 给出，其中 $k$ 是波矢大小，$E_{0,n}$ 是 $\\Gamma$ 点（$k=0$）的带边能量，$E_{d,n}(k)$ 是能量的色散部分。带边能量为 $E_{0,n} = E_g + \\Delta_n$，其中 $E_g$ 是基本带隙，$\\Delta_n$ 是分裂能（约定 $\\Delta_1 = 0$）。\n\n色散部分 $E_{d,n}(k)$ 由以下二次方程定义：\n$$\n\\alpha_n E_{d,n}(k)^2 + E_{d,n}(k) - A_n k^2 = 0\n$$\n这里 $A_n = (\\hbar^2 / 2m_n) \\times 10^{20}$ 是一个与能带有效质量 $m_n$ 相关的参数。假设 $\\alpha_n \\ge 0$，物理上有意义的解（能量从 $E_{d,n}(0)=0$ 开始增加）可以通过求解上述二次方程得到：\n$$\nE_{d,n}(k) = \\frac{-1 + \\sqrt{1 + 4\\alpha_n A_n k^2}}{2\\alpha_n}\n$$\n对于每个测试用例，我们都将实现一个函数，该函数使用给定的参数集（DFT 或 $G_0W_0$）和 $k$ 点网格来计算三个导带的能量 $E_n(k)$。\n\n### 剪刀修正与误差分析\n\n剪刀修正是对所有在 DFT 水平上计算的导带进行刚性向上平移，以匹配更高精度理论（此处为 $G_0W_0$）的基本带隙。平移量 $\\Delta^{\\text{sc}}$ 定义为：\n$$\n\\Delta^{\\text{sc}} = E_g^{G_0W_0} - E_g^{\\text{DFT}}\n$$\n因此，经过剪刀修正的能量为 $E^{\\text{sc}}_n(k) = E^{\\text{DFT}}_n(k) + \\Delta^{\\text{sc}}$。\n\n分析的核心是量化此修正引入的残余误差。\n\n**有效质量误差：** 剪刀修正是一个恒定的能量平移，它保留了能带的曲率。因此，经过剪刀修正的能带的有效质量 $m^*_{\\text{sc}}$ 将与原始 DFT 计算的有效质量 $m^{\\text{DFT}}_1$ 完全相同。我们将通过在 $k=0$ 处使用三点前向有限差分公式数值计算曲率来验证这一点，并将其与目标 $G_0W_0$ 的有效质量 $m^*_{G_0W_0}$ 进行比较。相对误差 $\\varepsilon_m$ 定义为：\n$$\n\\varepsilon_m = \\frac{m^*_{\\text{sc}} - m^*_{G_0W_0}}{m^*_{G_0W_0}}\n$$\n\n**高能带的均方根能量误差：** 对于更高能量的导带（$n=2, 3$），剪刀修正通常不太准确，因为它忽略了 DFT 和 $G_0W_0$ 之间能带分裂和色散形状的差异。我们通过计算整个 $\\Gamma-X$ 路径上的均方根（RMS）误差来量化这种差异：\n$$\n\\mathrm{RMS}_n = \\sqrt{\\frac{1}{N_k}\\sum_{i=0}^{N_k-1}\\left(E^{\\text{sc}}_n(k_i)-E^{G_0W_0}_n(k_i)\\right)^2}\n$$\n此计算将对每个测试用例的能带 $n=2$ 和 $n=3$ 执行。整个过程将封装在一个 Python 脚本中，该脚本遍历所提供的三个测试用例，并为每个用例计算结果三元组 $(\\varepsilon_m, \\mathrm{RMS}_2, \\mathrm{RMS}_3)$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the band structure problem for all test cases.\n    \"\"\"\n\n    # Physical constants\n    HBAR = 6.582119569e-16  # eV*s\n    M_E = 9.10938356e-31    # kg\n    HBAR_SQ_FACTOR = HBAR**2 * 1e20\n\n    # Test suite: a list of tuples, each containing parameters for one case.\n    # Format: (a, Nk, dft_params, gw_params)\n    # _params are dicts: {'Eg': ..., 'bands': {1: {'m_ratio':.., 'alpha':.., 'Delta':..}, ...}}\n    test_cases = [\n        # Case 1 (typical)\n        (\n            5.65, 101,  # a, Nk\n            {\n                \"Eg\": 0.90,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.25, \"alpha\": 0.8, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.60, \"alpha\": 0.3, \"Delta\": 1.00},\n                    3: {\"m_ratio\": 1.20, \"alpha\": 0.2, \"Delta\": 2.00},\n                }\n            },\n            {\n                \"Eg\": 1.20,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.20, \"alpha\": 1.0, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.50, \"alpha\": 0.4, \"Delta\": 0.90},\n                    3: {\"m_ratio\": 1.00, \"alpha\": 0.25, \"Delta\": 1.80},\n                }\n            }\n        ),\n        # Case 2 (boundary, zero scissor)\n        (\n            3.57, 101,  # a, Nk\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.35, \"alpha\": 0.9, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.55, \"alpha\": 0.4, \"Delta\": 0.80},\n                    3: {\"m_ratio\": 0.90, \"alpha\": 0.3, \"Delta\": 1.50},\n                }\n            },\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.30, \"alpha\": 1.1, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.45, \"alpha\": 0.5, \"Delta\": 0.75},\n                    3: {\"m_ratio\": 0.80, \"alpha\": 0.35, \"Delta\": 1.40},\n                }\n            }\n        ),\n        # Case 3 (negative scissor)\n        (\n            4.00, 101,  # a, Nk\n            {\n                \"Eg\": 1.80,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.18, \"alpha\": 1.1, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.40, \"alpha\": 0.5, \"Delta\": 1.20},\n                    3: {\"m_ratio\": 0.85, \"alpha\": 0.3, \"Delta\": 2.50},\n                }\n            },\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.22, \"alpha\": 0.9, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.45, \"alpha\": 0.45, \"Delta\": 1.10},\n                    3: {\"m_ratio\": 0.75, \"alpha\": 0.35, \"Delta\": 2.30},\n                }\n            }\n        ),\n    ]\n\n    all_results = []\n    for case_data in test_cases:\n        all_results.append(process_case(case_data, HBAR_SQ_FACTOR, M_E))\n\n    # Format the final output string as a list of lists.\n    list_of_lists_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    final_output = f\"[{','.join(list_of_lists_str)}]\"\n    print(final_output)\n\ndef compute_bands(k_mesh, params, hbar_sq_factor, m_e):\n    \"\"\"\n    Computes band energies for all bands in a parameter set.\n    \"\"\"\n    bands = {}\n    k2 = k_mesh**2\n    for n in [1, 2, 3]:\n        p = params['bands'][n]\n        m_kg = p['m_ratio'] * m_e\n        alpha = p['alpha']\n        E0 = params['Eg'] + p['Delta']\n        A = hbar_sq_factor / (2 * m_kg)\n\n        # Solve for the dispersive part of the energy\n        if abs(alpha)  1e-9:\n            E_d = A * k2\n        else:\n            # Quadratic formula: alpha*E_d^2 + E_d - A*k^2 = 0\n            # We take the positive root for energy increasing from k=0\n            sqrt_term = np.sqrt(1 + 4 * alpha * A * k2)\n            E_d = (-1 + sqrt_term) / (2 * alpha)\n\n        bands[n] = E0 + E_d\n    return bands\n\ndef process_case(case_data, hbar_sq_factor, m_e):\n    \"\"\"\n    Processes a single test case to compute the required error metrics.\n    \"\"\"\n    a, Nk, dft_params, gw_params = case_data\n\n    # 1. Setup k-mesh\n    k_max = np.pi / a\n    k_mesh = np.linspace(0, k_max, Nk, dtype=np.float64)\n    h = k_mesh[1] - k_mesh[0]\n\n    # 2. Compute DFT and G0W0 bands\n    dft_bands = compute_bands(k_mesh, dft_params, hbar_sq_factor, m_e)\n    gw_bands = compute_bands(k_mesh, gw_params, hbar_sq_factor, m_e)\n\n    # 3. Apply scissor correction\n    delta_sc = gw_params['Eg'] - dft_params['Eg']\n    sc_bands = {n: dft_bands[n] + delta_sc for n in dft_bands}\n\n    # 4. Compute fractional effective mass error for CB1\n    # Curvature of scissor-corrected band from 3-point finite difference formula\n    curv_sc = (sc_bands[1][2] - 2 * sc_bands[1][1] + sc_bands[1][0]) / h**2\n    m_star_sc = hbar_sq_factor / curv_sc\n\n    # Curvature of G0W0 band\n    curv_gw = (gw_bands[1][2] - 2 * gw_bands[1][1] + gw_bands[1][0]) / h**2\n    m_star_gw = hbar_sq_factor / curv_gw\n    \n    eps_m = (m_star_sc - m_star_gw) / m_star_gw\n\n    # 5. Compute RMS energy error for CB2 and CB3\n    rms_2 = np.sqrt(np.mean((sc_bands[2] - gw_bands[2])**2))\n    rms_3 = np.sqrt(np.mean((sc_bands[3] - gw_bands[3])**2))\n\n    return [eps_m, rms_2, rms_3]\n\nsolve()\n```"
        }
    ]
}