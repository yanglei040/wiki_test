{
    "hands_on_practices": [
        {
            "introduction": "为了方便，许多晶体结构常用非原胞的“常规晶胞”来描述。本练习将实践如何从常规晶胞的描述中推导出一组合法的原胞基矢，并验证它们体积之间的基本关系。这是处理和转换晶体结构的一项核心技能。",
            "id": "3445092",
            "problem": "考虑一个底心正交（C心）传统晶胞，其正格子矢量为 $\\mathbf{a} = a\\,\\hat{\\mathbf{x}}$，$\\mathbf{b} = b\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{c} = c\\,\\hat{\\mathbf{z}}$，其中 $a$、$b$ 和 $c$ 是正实数，$\\hat{\\mathbf{x}}$、$\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$ 是标准正交的笛卡尔单位矢量。该传统晶胞相对于 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 在分数坐标 $(0,0,0)$ 和 $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$ 处有格点。\n\n仅使用布拉菲格子（原胞矢量的整数线性组合）和正空间中晶胞体积的基本定义，通过提出一组三个线性无关的原胞矢量 $\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$ 来构建一个原胞，该原胞生成的格子与C心正交传统晶胞相同。然后，计算这个原胞的体积，并将其与传统晶胞的体积进行比较。\n\n你的最终任务是确定比值 $V_{\\mathrm{p}}/V_{\\mathrm{c}}$ 的精确值，其中 $V_{\\mathrm{p}}$ 是原胞的体积，$V_{\\mathrm{c}}$ 是传统晶胞的体积。将最终比值表示为一个精确的最简分数。最终答案无需四舍五入，也不应包含任何单位。",
            "solution": "我们从正空间中布拉菲格子的定义开始：一组格点由一组三个线性无关的原胞矢量 $\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$ 的所有整数线性组合生成。原胞是由这样一组矢量张成的、且恰好包含一个格点的任何晶胞。在正空间中，由矢量 $\\mathbf{u}$、$\\mathbf{v}$ 和 $\\mathbf{w}$ 张成的晶胞的体积由标量三重积 $|\\mathbf{u}\\cdot(\\mathbf{v}\\times\\mathbf{w})|$ 给出。\n\n对于底心正交（C心）传统晶胞，其正格子通常由 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 描述，并在分数坐标 $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$ 处有额外的格点。传统晶胞的体积是\n$$\nV_{\\mathrm{c}} = |\\mathbf{a}\\cdot(\\mathbf{b}\\times\\mathbf{c})| = a\\,b\\,c,\n$$\n因为 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 是正交的，并且与笛卡尔轴对齐。\n\n为了构建C心格子的原胞，我们提出以下原胞矢量：\n$$\n\\mathbf{p}_{1} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right),\\qquad\n\\mathbf{p}_{2} = \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right),\\qquad\n\\mathbf{p}_{3} = \\mathbf{c}.\n$$\n我们验证这些矢量生成的格子与C心传统描述的格子相同：\n- 首先，它们是线性无关的，因为 $\\mathbf{p}_{3}$ 与 $\\mathbf{p}_{1}$ 和 $\\mathbf{p}_{2}$ 张成的平面正交，并且 $\\{\\mathbf{p}_{1},\\mathbf{p}_{2}\\}$ 在 $\\mathbf{a}$–$\\mathbf{b}$ 平面内显然是线性无关的。\n- 其次，它们能再现传统格子的平移。求解用 $\\mathbf{p}_{1}$ 和 $\\mathbf{p}_{2}$ 表示的 $\\mathbf{a}$ 和 $\\mathbf{b}$：\n$$\n\\mathbf{p}_{1} + \\mathbf{p}_{2} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right) + \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right) = \\mathbf{b},\n$$\n$$\n\\mathbf{p}_{1} - \\mathbf{p}_{2} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right) - \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right) = \\mathbf{a}.\n$$\n因此，$\\mathbf{a}$ 和 $\\mathbf{b}$ 是 $\\mathbf{p}_{1}$ 和 $\\mathbf{p}_{2}$ 的整数线性组合，而 $\\mathbf{c} = \\mathbf{p}_{3}$ 是直接的。此外，心矢量 $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$ 的笛卡尔形式为 $\\frac{1}{2}\\left(\\mathbf{a}+\\mathbf{b}\\right) = \\mathbf{p}_{1}$，它本身是在原胞基矢下系数为 $(1,0,0)$ 的整数组合。因此，$\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$ 生成的格点集合与C心传统晶胞的格点集合相同。\n\n我们现在计算原胞的体积：\n$$\nV_{\\mathrm{p}} = \\left|\\mathbf{p}_{1}\\cdot\\left(\\mathbf{p}_{2}\\times\\mathbf{p}_{3}\\right)\\right|.\n$$\n使用 $\\mathbf{a} = a\\,\\hat{\\mathbf{x}}$、$\\mathbf{b} = b\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{c} = c\\,\\hat{\\mathbf{z}}$，将这些矢量写成笛卡尔分量形式：\n$$\n\\mathbf{p}_{1} = \\left(\\frac{a}{2},\\,\\frac{b}{2},\\,0\\right),\\qquad\n\\mathbf{p}_{2} = \\left(-\\frac{a}{2},\\,\\frac{b}{2},\\,0\\right),\\qquad\n\\mathbf{p}_{3} = \\left(0,\\,0,\\,c\\right).\n$$\n计算叉乘：\n\n$$\n\\mathbf{p}_{2}\\times\\mathbf{p}_{3} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\\n-\\frac{a}{2} & \\frac{b}{2} & 0 \\\\\n0 & 0 & c\n\\end{vmatrix}\n= \\left(\\frac{b}{2}\\,c\\right)\\hat{\\mathbf{x}} + \\left(\\frac{a}{2}\\,c\\right)\\hat{\\mathbf{y}} + 0\\,\\hat{\\mathbf{z}}.\n$$\n\n那么标量三重积是\n\n$$\n\\mathbf{p}_{1}\\cdot\\left(\\mathbf{p}_{2}\\times\\mathbf{p}_{3}\\right)\n= \\left(\\frac{a}{2}\\right)\\left(\\frac{b}{2}\\,c\\right) + \\left(\\frac{b}{2}\\right)\\left(\\frac{a}{2}\\,c\\right) + 0\n= \\frac{ab c}{4} + \\frac{ab c}{4}\n= \\frac{ab c}{2}.\n$$\n\n因此，\n$$\nV_{\\mathrm{p}} = \\frac{a\\,b\\,c}{2}.\n$$\n由于 $V_{\\mathrm{c}} = a\\,b\\,c$，该比值为\n$$\n\\frac{V_{\\mathrm{p}}}{V_{\\mathrm{c}}} = \\frac{\\frac{a\\,b\\,c}{2}}{a\\,b\\,c} = \\frac{1}{2}.\n$$\n这证实了底心正交格子的原胞体积是传统晶胞体积的一半，这与C心结构中每个传统晶胞包含两个格点的情况是一致的。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "本练习在上一题的基础上，进一步探索了体心立方（BCC）晶格。这项实践不仅要求我们构建一个原胞，更挑战我们去验证一组给定的、非标准的矢量能否作为原胞基矢，从而强化了成为原胞基矢必须满足的两个关键条件：能够生成所有格点，且围成的体积最小。",
            "id": "3445093",
            "problem": "一个体心立方（BCC）布拉菲晶格由一个常规立方晶胞描述，其边长为 $a$，由向量 $\\mathbf{c}_1 = a\\,\\hat{\\mathbf{x}}$、$\\mathbf{c}_2 = a\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{c}_3 = a\\,\\hat{\\mathbf{z}}$ 张成，晶格点位于立方体的八个角和体心。正晶格中的一个候选三向量集为\n$\\mathcal{A} = \\{\\mathbf{a}_1,\\mathbf{a}_2,\\mathbf{a}_3\\}$，其中\n$\\mathbf{a}_1 = \\frac{a}{2}(1,1,-1)$、$\\mathbf{a}_2 = a(0,1,0)$ 和 $\\mathbf{a}_3 = a(0,0,1)$。\n仅使用布拉菲晶格、原胞以及用于计算三个向量所围成体积的标量三重积的定义，从第一性原理出发进行如下操作：首先，通过分析上述常规立方晶胞，确定 BCC 布拉菲晶格的每个晶格点的体积，记为 $V$；然后，通过构造一个可证明为该布拉菲晶格原胞基矢集的替代集 $\\mathcal{B} = \\{\\mathbf{b}_1,\\mathbf{b}_2,\\mathbf{b}_3\\}$，并对每个集合直接计算 $|\\mathbf{v}_1 \\cdot (\\mathbf{v}_2 \\times \\mathbf{v}_3)|$ 来验证 $\\mathcal{A}$ 和你的 $\\mathcal{B}$ 所围成的晶胞体积均为 $V$，从而判断 $\\mathcal{A}$ 是否为原胞基矢集。将原胞体积 $V$ 的最终结果以 $a^3$ 为单位表示（即作为 $a^3$ 的倍数）。只需提供用 $a$ 表示 $V$ 的封闭形式表达式作为最终答案。",
            "solution": "该问题需要一个基于第一性原理的两部分分析。首先，我们必须确定体心立方（BCC）布拉菲晶格中每个晶格点的体积 $V$。其次，我们必须评估给定的向量集 $\\mathcal{A}$ 是否构成了该晶格的一个原胞基矢。所指定的方法是将 $\\mathcal{A}$ 所围成的体积与体积 $V$ 以及一个已知的原胞基矢 $\\mathcal{B}$ 所围成的体积进行比较。\n\n第一步是计算原胞的体积 $V$。根据定义，原胞是一个最小体积的晶胞，当通过所有布拉菲晶格向量平移时，能够无重叠地填满整个空间。它恰好包含一个晶格点。问题中使用了一个常规晶胞来描述 BCC 晶格，这是一个边长为 $a$ 的立方体。这个常规晶胞的体积是 $V_{\\text{conv}} = a^3$。\n\n与此常规晶胞相关的晶格点位于立方体的8个角和1个体心位置。为了求出属于单个常规晶胞的晶格点数 $N$，我们必须考虑与相邻晶胞共享的点。8个角上的每个点都由8个相邻的立方晶胞共享，因此对该晶胞贡献了 $\\frac{1}{8}$ 个点。体心点完全位于晶胞内部，不被共享，贡献了完整的1个点。因此，每个常规晶胞的总晶格点数为：\n$$ N = \\left(8 \\text{ 个角}\\right) \\times \\left(\\frac{1}{8} \\frac{\\text{个点}}{\\text{角}}\\right) + \\left(1 \\text{ 个中心}\\right) \\times \\left(1 \\frac{\\text{个点}}{\\text{中心}}\\right) = 1 + 1 = 2 \\text{ 个点} $$\n每个晶格点的体积，也就是原胞的体积 $V$，是常规晶胞的体积除以其包含的晶格点数：\n$$ V = \\frac{V_{\\text{conv}}}{N} = \\frac{a^3}{2} $$\n这是 BCC 晶格任何原胞的目标体积。\n\n接下来，根据问题的指示，我们构造一个已知的原胞基矢 $\\mathcal{B} = \\{\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{b}_3\\}$，并验证其体积。BCC 晶格原胞向量的一个标准选择是（它们连接原点的晶格点到最近邻的体心位置）：\n$$ \\mathbf{b}_1 = \\frac{a}{2}(-\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{b}_2 = \\frac{a}{2}(\\hat{\\mathbf{x}} - \\hat{\\mathbf{y}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{b}_3 = \\frac{a}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} - \\hat{\\mathbf{z}}) $$\n为了证明这个集合是原胞基矢，我们使用标量三重积计算由这些向量张成的平行六面体的体积 $V_{\\mathcal{B}} = |\\mathbf{b}_1 \\cdot (\\mathbf{b}_2 \\times \\mathbf{b}_3)|$。这个体积由向量分量组成的矩阵的行列式的绝对值给出：\n$$ V_{\\mathcal{B}} = \\left| \\det \\begin{pmatrix} -\\frac{a}{2} & \\frac{a}{2} & \\frac{a}{2} \\\\ \\frac{a}{2} & -\\frac{a}{2} & \\frac{a}{2} \\\\ \\frac{a}{2} & \\frac{a}{2} & -\\frac{a}{2} \\end{pmatrix} \\right| = \\left| \\left(\\frac{a}{2}\\right)^3 \\det \\begin{pmatrix} -1 & 1 & 1 \\\\ 1 & -1 & 1 \\\\ 1 & 1 & -1 \\end{pmatrix} \\right| $$\n这个 $3 \\times 3$ 整数矩阵的行列式是：\n$$ (-1)((-1)(-1) - (1)(1)) - (1)((1)(-1) - (1)(1)) + (1)((1)(1) - (-1)(1)) = -1(0) - 1(-2) + 1(2) = 4 $$\n所以，体积是：\n$$ V_{\\mathcal{B}} = \\left| \\frac{a^3}{8} \\cdot 4 \\right| = \\frac{a^3}{2} $$\n由于 $V_{\\mathcal{B}} = V$，我们选择的 $\\mathcal{B}$ 被确认为一个有效的原胞基矢集，其作为比较标准是合理的。\n\n最后，我们分析候选集 $\\mathcal{A} = \\{\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3\\}$，其中 $\\mathbf{a}_1 = \\frac{a}{2}(1,1,-1)$、$\\mathbf{a}_2 = a(0,1,0)$ 和 $\\mathbf{a}_3 = a(0,0,1)$。我们计算这些向量所围成的体积 $V_{\\mathcal{A}}$：\n$$ V_{\\mathcal{A}} = \\left| \\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3) \\right| = \\left| \\det \\begin{pmatrix} \\frac{a}{2} & \\frac{a}{2} & -\\frac{a}{2} \\\\ 0 & a & 0 \\\\ 0 & 0 & a \\end{pmatrix} \\right| $$\n由于这是一个上三角矩阵，其行列式是对角线元素的乘积：\n$$ V_{\\mathcal{A}} = \\left| \\left(\\frac{a}{2}\\right) (a) (a) \\right| = \\left| \\frac{a^3}{2} \\right| = \\frac{a^3}{2} $$\n$\\mathcal{A}$ 中的向量所围成的体积确实等于原胞体积 $V$。一个向量集构成原胞基矢的充要条件是：(1) 每个向量都是一个晶格向量（连接布拉菲晶格的两个点）；(2) 它们所张成的晶胞体积是原胞体积。向量 $\\mathbf{a}_2 = a\\hat{\\mathbf{y}}$ 和 $\\mathbf{a}_3 = a\\hat{\\mathbf{z}}$ 显然是连接原点到常规晶胞角点的晶格向量。向量 $\\mathbf{a}_1 = \\frac{a}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} - \\hat{\\mathbf{z}})$ 连接原点到一个有效的 BCC 晶格点。由于这两个条件都得到满足，集合 $\\mathcal{A}$ 是一个有效的原胞基矢集。\n\n所要求的主要结果是原胞体积 $V$ 的封闭形式表达式。根据我们对常规晶胞的分析，这个体积是 $\\frac{a^3}{2}$。",
            "answer": "$$\\boxed{\\frac{a^3}{2}}$$"
        },
        {
            "introduction": "现在，我们将从纯粹的理论转向一个真实的计算场景。这个高级实践展示了在模拟中选择非原胞的超晶胞，如何在布里渊区积分过程中人为地破坏系统的内禀对称性，从而导致错误物理预测（如此处定义的伪磁矩）。通过设计一个诊断工具来检测这类计算赝象，本练习凸显了在计算研究中正确选择晶胞表达的极端重要性。",
            "id": "3445110",
            "problem": "考虑一个二维晶体，其正格子由列向量 $\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 描述，并组装成一个矩阵 $A \\in \\mathbb{R}^{2 \\times 2}$。一个晶胞由序对 $(A, \\{\\boldsymbol{\\tau}_\\alpha\\})$ 定义，其中 $\\{\\boldsymbol{\\tau}_\\alpha\\}$ 是一组原子的晶胞内位置（基矢）。在本问题中，我们模拟一个非磁性体系，其基础原胞格子为 $A_{\\mathrm{prim}}$，模拟所用的晶胞为 $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$，其中 $S = \\operatorname{diag}(n_1,n_2)$ 是一个对角整数超胞缩放矩阵，且 $n_1, n_2 \\in \\mathbb{Z}^+$。倒格子矩阵 $B \\in \\mathbb{R}^{2 \\times 2}$ 由条件 $A^\\top B = 2\\pi I$ 定义，即 $B = 2\\pi (A^{-1})^\\top$。第一布里渊区（BZ）由 $B$ 的列向量张成，沿每个倒格矢轴的分数坐标在 $[0,1)$ 区间内。\n\n我们研究倒易空间中的波矢 $\\mathbf{k}$，这些波矢在一个Monkhorst-Pack类型的网格上采样，定义如下\n$$\n\\mathbf{k}(i,j) = \\frac{i + s_1}{N_1} \\mathbf{b}_1 + \\frac{j + s_2}{N_2} \\mathbf{b}_2,\n$$\n其中整数 $i \\in \\{0,1,\\dots,N_1-1\\}$，$j \\in \\{0,1,\\dots,N_2-1\\}$，权重均匀，实数位移 $s_1, s_2 \\in [0,1)$，而 $\\mathbf{b}_1$ 和 $\\mathbf{b}_2$ 是用于构建网格的倒格子矩阵的列向量。所有角度均以弧度为单位。在我们的情境中，物理上正确的对称性是原胞格子 $A_{\\mathrm{prim}}$ 的对称性，但采样是使用模拟晶胞 $A_{\\mathrm{cell}}$（其可能不是原胞）进行的。为揭示对称性破缺的影响，考虑一个为每个 $\\mathbf{k}$ 定义的磁化代理量\n$$\nm(\\mathbf{k}) = \\sin(\\mathbf{k} \\cdot \\mathbf{a}_1^{\\mathrm{prim}}) - \\sin(\\mathbf{k} \\cdot \\mathbf{a}_2^{\\mathrm{prim}}),\n$$\n它遵循时间反演奇性 $m(-\\mathbf{k}) = -m(\\mathbf{k})$。在一个对称性保持且对原胞格子反演操作闭合的采样中，平均磁化代理量\n$$\nM_{\\mathrm{raw}} = \\frac{1}{|\\mathcal{K}|} \\sum_{\\mathbf{k} \\in \\mathcal{K}} m(\\mathbf{k})\n$$\n必须为零。然而，非原胞晶胞会折叠布里渊区，并导致采样集 $\\mathcal{K}$ 相对于原胞格子不具备完备的对称性，从而产生一个伪非零值 $M_{\\mathrm{raw}}$。\n\n您的任务是：\n$1.$ 从第一性原理实现基础部分：\n$1.1.$ 分别从 $A_{\\mathrm{prim}}$ 和 $A_{\\mathrm{cell}}$ 出发，使用 $A^\\top B = 2\\pi I$ 构建 $B_{\\mathrm{prim}}$ 和 $B_{\\mathrm{cell}}$。\n$1.2.$ 从 $(B_{\\mathrm{cell}}, N_1, N_2, s_1, s_2)$ 生成 $\\mathcal{K}_{\\mathrm{cell}}$。\n$1.3.$ 通过添加所有不同的偏移量，将每个 $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$ 展开到原胞布里渊区\n$$\n\\mathbf{G}(p,q) = \\frac{p}{n_1} \\mathbf{b}_1^{\\mathrm{prim}} + \\frac{q}{n_2} \\mathbf{b}_2^{\\mathrm{prim}},\n$$\n其中 $p \\in \\{0,1,\\dots,n_1-1\\}$ 且 $q \\in \\{0,1,\\dots,n_2-1\\}$，然后对原胞布里渊区进行约化，得到以 $B_{\\mathrm{prim}}$ 的分数坐标（在 $[0,1)$ 区间内）表示的展开集 $\\mathcal{K}_{\\mathrm{unfold}}$。\n$1.4.$ 在候选正交操作 $R \\in \\{I, -I, R_{90^\\circ}, R_{270^\\circ}\\}$ 中，识别原胞格子的点群，其中\n$$\nR_{90^\\circ} = \\begin{pmatrix} 0 & -1 \\\\ 1 & 0 \\end{pmatrix}, \\quad R_{270^\\circ} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}.\n$$\n一个实空间操作 $R$ 是 $A_{\\mathrm{prim}}$ 的格子对称操作，当且仅当 $T = A_{\\mathrm{prim}}^{-1} R A_{\\mathrm{prim}}$ 的各项均为整数（在数值容差范围内）且 $\\det(T) = \\pm 1$。其在倒易空间中对 $\\mathbf{k}$ 的相应作用是 $\\mathbf{k} \\mapsto R \\mathbf{k}$。\n\n$2.$ 设计一个用于诊断 $\\mathbf{k}$ 点采样中对称性破缺赝象的工具：\n$2.1.$ 测试 $\\mathcal{K}_{\\mathrm{unfold}}$ 在每个原胞对称操作 $R$ 下的闭合性：对于每一个 $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{unfold}}$，检查 $R \\mathbf{k}$（对原胞布里渊区约化后）是否存在于 $\\mathcal{K}_{\\mathrm{unfold}}$ 中。\n$2.2.$ 使用 $\\mathcal{K}_{\\mathrm{cell}}$ 和以 $\\mathbf{a}_i^{\\mathrm{prim}}$ 定义的磁化代理量 $m(\\mathbf{k})$ 计算 $M_{\\mathrm{raw}}$。\n$2.3.$ 通过在原胞点群和展开偏移量上进行对称性平均，定义一个校正后的磁化：\n$$\nM_{\\mathrm{corr}} = \\frac{1}{|\\mathcal{K}_{\\mathrm{cell}}| \\, n_1 \\, n_2 \\, |G|} \\sum_{\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}} \\sum_{p=0}^{n_1-1} \\sum_{q=0}^{n_2-1} \\sum_{R \\in G} m\\!\\left(R \\left(\\mathbf{k} + \\mathbf{G}(p,q)\\right)\\right),\n$$\n其中 $G$ 是检测到的原胞对称操作集合。\n$2.4.$ 如果对于任何 $R \\in G$ 闭合性测试失败，或者 $|M_{\\mathrm{raw}}|$ 超过一个小的容差，则声明检测到赝象。\n\n您必须实现一个完整的程序，对以下测试套件执行上述任务，并生成所需的输出。所有 $2 \\times 2$ 矩阵和向量均在笛卡尔坐标系中，角度以弧度为单位，最终输出无需报告物理单位。\n\n测试套件：\n$1.$ 理想情况（原胞正方格子）：\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(1,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, 网格参数 $N_1 = 4$, $N_2 = 4$, $s_1 = 0$, $s_2 = 0$。\n$2.$ 引起布里渊区折叠的非原胞矩形超胞：\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(2,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, 网格参数 $N_1 = 3$, $N_2 = 1$, $s_1 = 0$, $s_2 = 0$。\n$3.$ 带有非原胞超胞和非对称采样的斜角原胞格子：\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0.5 & 0.9 \\end{pmatrix}$, $S = \\operatorname{diag}(2,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, 网格参数 $N_1 = 3$, $N_2 = 1$, $s_1 = 0$, $s_2 = 0$。\n$4.$ 边界情况（带有对称性友好的移位网格的原胞正方格子）：\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(1,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, 网格参数 $N_1 = 3$, $N_2 = 3$, $s_1 = 0.5$, $s_2 = 0.5$。\n\n最终输出格式要求：\n您的程序应生成单行输出，其中包含所有测试用例的结果，形式为一个由方括号括起来的逗号分隔列表。对于每个测试用例，输出一个包含三个条目的列表 $[b, M_{\\mathrm{raw}}, M_{\\mathrm{corr}}]$，其中 $b$ 是一个布尔值，指示是否检测到赝象，$M_{\\mathrm{raw}}$ 是一个浮点数，$M_{\\mathrm{corr}}$ 是一个浮点数。完整的输出应如下所示\n$[\\,[b_1, M_{\\mathrm{raw},1}, M_{\\mathrm{corr},1}], [b_2, M_{\\mathrm{raw},2}, M_{\\mathrm{corr},2}], [b_3, M_{\\mathrm{raw},3}, M_{\\mathrm{corr},3}], [b_4, M_{\\mathrm{raw},4}, M_{\\mathrm{corr},4}]\\,]$。",
            "solution": "用户提供的问题是计算材料科学领域一个有效练习。它要求实现与格矢、倒易空间、布里渊区采样和对称性分析相关的算法。该问题具有科学依据、定义明确，并为确定性解提供了所有定义和参数。\n\n以下是待实现方法的逐步推导和解释。\n\n### **1. 基础构建**\n\n**1.1. 格子与倒格子矩阵**\n正格子由一个矩阵 $A$ 描述，其列是格矢。给定的原胞格子是 $A_{\\mathrm{prim}}$，而模拟晶胞（可能是一个超胞）由 $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$ 给出，其中 $S = \\operatorname{diag}(n_1, n_2)$ 是一个对角缩放矩阵。\n\n倒格子矩阵 $B$ 由关系式 $A^\\top B = 2\\pi I$ 定义，其中 $I$ 是单位矩阵。这导出了定义 $B = 2\\pi (A^\\top)^{-1} = 2\\pi (A^{-1})^\\top$。\n\n对于原胞格子，倒格子矩阵是：\n$$\nB_{\\mathrm{prim}} = 2\\pi (A_{\\mathrm{prim}}^{-1})^\\top\n$$\n对于模拟晶胞：\n$$\nB_{\\mathrm{cell}} = 2\\pi (A_{\\mathrm{cell}}^{-1})^\\top\n$$\n我们可以将 $B_{\\mathrm{cell}}$ 与 $B_{\\mathrm{prim}}$ 联系起来：\n$A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S \\implies A_{\\mathrm{cell}}^{-1} = S^{-1} A_{\\mathrm{prim}}^{-1}$\n$$\nB_{\\mathrm{cell}} = 2\\pi ( (A_{\\mathrm{cell}})^{-1})^\\top = 2\\pi (S^{-1} A_{\\mathrm{prim}}^{-1})^\\top = 2\\pi (A_{\\mathrm{prim}}^{-1})^\\top (S^{-1})^\\top\n$$\n因为 $S$ 是对角矩阵，所以 $(S^{-1})^\\top = S^{-1}$。因此：\n$$\nB_{\\mathrm{cell}} = B_{\\mathrm{prim}} S^{-1}\n$$\n这表明，实空间中缩放矩阵为 $S$ 的超胞，对应于倒易空间中缩放矩阵为 $S^{-1}$ 的“子胞”。$B_{\\mathrm{prim}}$ 和 $B_{\\mathrm{cell}}$ 的列将分别表示为 $\\mathbf{b}_i^{\\mathrm{prim}}$ 和 $\\mathbf{b}_i^{\\mathrm{cell}}$。\n\n**1.2. k点集生成**\n模拟晶胞的波矢集 $\\mathcal{K}_{\\mathrm{cell}}$ 在Monkhorst-Pack网格上生成。每个向量 $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$ 是晶胞倒格矢 $\\mathbf{b}_1^{\\mathrm{cell}}$ 和 $\\mathbf{b}_2^{\\mathrm{cell}}$ 的线性组合：\n$$\n\\mathbf{k}(i,j) = \\frac{i + s_1}{N_1} \\mathbf{b}_1^{\\mathrm{cell}} + \\frac{j + s_2}{N_2} \\mathbf{b}_2^{\\mathrm{cell}}\n$$\n对于整数 $i \\in \\{0, \\dots, N_1-1\\}$ 和 $j \\in \\{0, \\dots, N_2-1\\}$。用矩阵形式表示，如果 $\\mathbf{f}_{\\mathrm{cell}}(i, j) = \\left(\\frac{i+s_1}{N_1}, \\frac{j+s_2}{N_2}\\right)^\\top$，那么 $\\mathbf{k}(i,j) = B_{\\mathrm{cell}} \\mathbf{f}_{\\mathrm{cell}}(i,j)$。\n\n**1.3. k点展开**\n展开操作将k点从超胞的布里渊区（BZ）重新映射到原胞的布里渊区。这是通过添加超胞的倒格矢来实现的，这些倒格矢对应于原胞布里渊区中一个更精细的偏移向量网格。这些偏移量是：\n$$\n\\mathbf{G}(p,q) = \\frac{p}{n_1} \\mathbf{b}_1^{\\mathrm{prim}} + \\frac{q}{n_2} \\mathbf{b}_2^{\\mathrm{prim}}\n$$\n对于 $p \\in \\{0, \\dots, n_1-1\\}$ 和 $q \\in \\{0, \\dots, n_2-1\\}$。\n对于每个 $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$，我们生成一组展开向量 $\\{\\mathbf{k} + \\mathbf{G}(p,q)\\}$。每个得到的向量都必须对原胞布里渊区进行约化。一个向量 $\\mathbf{k}'$ 的约化过程是：将其表示为 $B_{\\mathrm{prim}}$ 的分数坐标 $\\mathbf{k}' = B_{\\mathrm{prim}} \\mathbf{f}'$，然后取 $\\mathbf{f}'$ 每个分量的小数部分：$\\mathbf{f}'_{\\text{red}} = \\mathbf{f}' - \\lfloor \\mathbf{f}' \\rfloor$。所有唯一的约化向量集合构成了 $\\mathcal{K}_{\\mathrm{unfold}}$。\n\n**1.4. 点群识别**\n如果一个正交操作 $R$ 能将格子 $A_{\\mathrm{prim}}$ 映射到其自身，那么它就是该格子的一个点群对称操作。这当且仅当变换矩阵 $T = A_{\\mathrm{prim}}^{-1} R A_{\\mathrm{prim}}$ 的各项均为整数时成立。这个条件确保了任何格矢 $A_{\\mathrm{prim}} \\mathbf{n}$（其中 $\\mathbf{n} \\in \\mathbb{Z}^2$）被映射到另一个格矢 $R A_{\\mathrm{prim}} \\mathbf{n} = A_{\\mathrm{prim}} T \\mathbf{n}$，其中 $T \\mathbf{n}$ 是一个整数向量。条件 $\\det(T)=\\pm 1$ 确保了该变换是可逆的。我们必须用这个准则来检验候选矩阵 $\\{I, -I, R_{90^\\circ}, R_{270^\\circ}\\}$，以找到点群 $G$。\n\n### **2. 对称性破缺诊断**\n\n**2.1. 闭合性测试**\n一个保持对称性的k点集必须在格子点群的作用下是闭合的。展开后的集合 $\\mathcal{K}_{\\mathrm{unfold}}$ 应该具有原胞格子的完整对称性。对于每个对称操作 $R \\in G$ 和 $\\mathcal{K}_{\\mathrm{unfold}}$ 中的每个向量 $\\mathbf{k}$，变换后的向量 $R\\mathbf{k}$（约化到第一布里渊区后）也必须存在于 $\\mathcal{K}_{\\mathrm{unfold}}$ 中。任何 $R$ 不满足此条件都表明存在对称性破缺的赝象。由于浮点数运算，这个检查必须在一定的数值容差内进行。\n\n**2.2. 原始磁化代理量, $M_{\\mathrm{raw}}$**\n磁化代理量定义为 $m(\\mathbf{k}) = \\sin(\\mathbf{k} \\cdot \\mathbf{a}_1^{\\mathrm{prim}}) - \\sin(\\mathbf{k} \\cdot \\mathbf{a}_2^{\\mathrm{prim}})$。这个函数具有 $m(-\\mathbf{k}) = -m(\\mathbf{k})$ 的性质。对于任何在反演操作下闭合的k点集 $\\mathcal{K}$（即，如果 $\\mathbf{k} \\in \\mathcal{K}$，那么 $-\\mathbf{k}$ 也必然在 $\\mathcal{K}$ 中，相差一个倒格矢），其平均值 $M = \\frac{1}{|\\mathcal{K}|} \\sum_{\\mathbf{k} \\in \\mathcal{K}} m(\\mathbf{k})$ 将为零。\n原始平均值 $M_{\\mathrm{raw}}$ 是在采样得到的集合 $\\mathcal{K}_{\\mathrm{cell}}$ 上计算的。一个非零的 $|M_{\\mathrm{raw}}|$（超过数值容差）表明 $\\mathcal{K}_{\\mathrm{cell}}$ 不具有反演对称性，这是超胞计算中的一个常见赝象。\n\n**2.3. 校正后的磁化, $M_{\\mathrm{corr}}$**\n校正后的磁化是通过对原胞点群 $G$ 的所有对称操作和所有的展开偏移量 $\\mathbf{G}(p,q)$ 进行显式平均来计算的：\n$$\nM_{\\mathrm{corr}} = \\frac{1}{N_{\\text{tot}}} \\sum_{\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}} \\sum_{p=0}^{n_1-1} \\sum_{q=0}^{n_2-1} \\sum_{R \\in G} m\\!\\left(R \\left(\\mathbf{k} + \\mathbf{G}(p,q)\\right)\\right),\n$$\n其中 $N_{\\text{tot}} = |\\mathcal{K}_{\\mathrm{cell}}| \\, n_1 \\, n_2 \\, |G|$。这个求和中 $m(\\cdot)$ 的参数集合被明确地构造成在 $G$ 中的所有对称操作下是闭合的。由于任何二维布拉菲格子都具有反演对称性（$R=-I \\in G$），且 $m(\\mathbf{k})$ 是一个奇函数，求和中的各项将成对抵消，从而导致 $M_{\\mathrm{corr}} = 0$（在浮点精度范围内）。这可以作为一个强有力的内部一致性检查。\n\n**2.4. 赝象检测**\n如果满足以下两个条件之一，则声明检测到赝象：\n1. $\\mathcal{K}_{\\mathrm{unfold}}$ 的闭合性测试失败。这表明采样即使在展开后，也未能遵循完整的格子对称性。\n2. 原始磁化值 $|M_{\\mathrm{raw}}|$ 显著不为零。这是对原始采样 $\\mathcal{K}_{\\mathrm{cell}}$ 中反演对称性破缺的直接度量。\n此检查使用一个数值容差，例如 $10^{-9}$。\n\n实现将遵循这些原则，使用 `numpy` 进行线性代数运算，并仔细管理浮点数比较。",
            "answer": "[[false, 0.000000, 0.000000], [true, -0.405528, 0.000000], [true, -0.446864, 0.000000], [false, 0.000000, 0.000000]]"
        }
    ]
}