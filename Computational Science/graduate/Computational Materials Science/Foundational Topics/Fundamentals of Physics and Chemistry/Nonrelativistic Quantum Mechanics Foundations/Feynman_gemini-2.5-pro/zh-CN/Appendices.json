{
    "hands_on_practices": [
        {
            "introduction": "变分原理是寻找量子体系基态能量的理论基石，它断言任何试探波函数的能量期望值都是基态真实能量的一个上界。然而，这一强大原理的成立严格依赖于哈密顿算符的厄米性。这项实践  通过一个简洁的数值实验，揭示了当厄米性被破坏时（例如在高级计算方法中因不完备的基组截断而出现），变分原理可能失效并给出低于基态能量的错误结果，同时还演示了如何通过算符的“厄米化”来诊断并修正这类问题。",
            "id": "3469751",
            "problem": "考虑一个与计算材料科学相关的非相对论量子力学系统的有限维近似，其中哈密顿矩阵作用于代表截断基的实向量空间。设 $H\\in\\mathbb{R}^{2\\times 2}$ 为一个对称（厄米、自伴）哈密顿量，其本征值代表能级。基本变分原理指出，对于任意归一化试探态 $\\lvert \\psi \\rangle$ 和厄米哈密顿量 $H$，瑞利商 $E_{\\text{var}}=\\frac{\\langle \\psi \\rvert H \\lvert \\psi \\rangle}{\\langle \\psi \\rvert \\psi \\rangle}$ 满足 $E_{\\text{var}}\\ge E_0$，其中 $E_0$ 是 $H$ 的基态能量。然而，非厄米截断（例如，使用不相等的左、右试探矢量构成不完全双正交集）会使能量估计产生偏差，并导致违反该不等式。一种诊断性的补救方法是通过有效哈密顿量（H_eff）将算符厄米化，其定义为 $H_{\\text{eff}}=\\frac{1}{2}(H+H^\\dagger)$，并使用一致的内积来评估正则瑞利商。\n\n从瑞利商的基本定义和变分界限对厄米性的要求出发，实现一个验证程序，以检测由非厄米截断引起的违规情况。使用以下纯数学设置：\n- 设哈密顿量为 $H=\\begin{pmatrix}0.5  0\\\\ 0  1.5\\end{pmatrix}$。其基态能量在无量纲单位下为 $E_0=0.5$。\n- 对于右试探矢量 $\\lvert r \\rangle$ 和左试探矢量 $\\langle l \\rvert$（不必相等），定义双正交瑞利商\n$$E_{\\text{bi}}=\\frac{\\langle l \\rvert H \\lvert r \\rangle}{\\langle l \\rvert r \\rangle},$$\n以及使用厄米化算符的正则（厄米）瑞利商\n$$E_{\\text{eff}}=\\frac{\\langle r \\rvert H_{\\text{eff}} \\lvert r \\rangle}{\\langle r \\rvert r \\rangle},\\quad H_{\\text{eff}}=\\frac{1}{2}(H+H^\\dagger).$$\n对于实对称的 $H$，我们有 $H_{\\text{eff}}=H$。\n\n您的程序必须为下面的每个测试用例计算 $E_{\\text{bi}}$ 和 $E_{\\text{eff}}$，将每个值与 $E_0$ 进行比较，并使用数值容差 $\\tau=10^{-9}$ 报告对不等式 $E_{\\text{var}}\\ge E_0$ 的违规情况。如果计算出的能量严格小于 $E_0-\\tau$，则发生违规。\n- 测试套件（无量纲单位）：\n    1. 情况 A（厄米截断的“理想路径”）：$\\lvert r \\rangle=\\begin{pmatrix}0\\\\1\\end{pmatrix}$ 和 $\\langle l \\rvert=\\begin{pmatrix}0  1\\end{pmatrix}$。\n    2. 情况 B（非厄米截断，中等斜交性）：$\\lvert r \\rangle=\\begin{pmatrix}1\\\\0.6\\end{pmatrix}$ 和 $\\langle l \\rvert=\\begin{pmatrix}1  -0.6\\end{pmatrix}$。\n    3. 情况 C（非厄米截断，接近奇异重叠的严重斜交性）：$\\lvert r \\rangle=\\begin{pmatrix}1\\\\0.95\\end{pmatrix}$ 和 $\\langle l \\rvert=\\begin{pmatrix}1  -0.95\\end{pmatrix}$。\n\n对于每种情况，计算并报告：\n- $E_{\\text{bi}}$，四舍五入到六位小数，\n- 一个布尔值，指示 $E_{\\text{bi}}$ 是否违反了不等式。",
            "solution": "该问题要求分析量子力学中的变分原理，特别是在有限维向量空间内，其在厄米和非厄米投影下的行为。问题的核心是，对于给定的哈密顿量和不同的试探矢量，计算两种形式的瑞利商，并验证变分不等式是否得到满足。\n\n基本变分原理指出，对于任意归一化的试探态矢量 $\\lvert \\psi \\rangle$ 和厄米哈密顿算符 $H$，由瑞利商 $E_{\\text{var}}$ 给出的能量期望值是真实基态能量 $E_0$ 的一个上界。在数学上，这表示为：\n$$E_{\\text{var}} = \\frac{\\langle \\psi \\rvert H \\lvert \\psi \\rangle}{\\langle \\psi \\rvert \\psi \\rangle} \\ge E_0$$\n该原理是量子化学和材料科学中许多近似方法的基础。其有效性关键取决于算符 $H$ 的厄米性（即 $H = H^\\dagger$，其中 $H^\\dagger$ 是 $H$ 的共轭转置）。\n\n该问题引入了一种情况，即通过使用非厄米投影，该条件可能会被违反。这通过定义一个“双正交”瑞利商 $E_{\\text{bi}}$ 来形式化，该瑞利商使用不同的左试探矢量 $\\langle l \\rvert$ 和右试探矢量 $\\lvert r \\rangle$：\n$$E_{\\text{bi}} = \\frac{\\langle l \\rvert H \\lvert r \\rangle}{\\langle l \\rvert r \\rangle}$$\n当 $\\langle l \\rvert$ 不是 $\\lvert r \\rangle$ 的共轭转置时，$E_{\\text{bi}}$ 量不是一个真正的期望值，并且不保证有下界 $E_0$。它可以产生低于基态的能量估计，这在物理上是不现实的。\n\n为解决此问题，定义了一个“厄米化”的有效哈密顿量 $H_{\\text{eff}}$，为 $H_{\\text{eff}} = \\frac{1}{2}(H + H^\\dagger)$。然后使用这个保证为厄米的算符和单个试探矢量 $\\lvert r \\rangle$ 构建一个正则瑞利商：\n$$E_{\\text{eff}} = \\frac{\\langle r \\rvert H_{\\text{eff}} \\lvert r \\rangle}{\\langle r \\rvert r \\rangle}$$\n根据构造，$H_{\\text{eff}}$ 是厄米的，因此变分原理适用，我们必须有 $E_{\\text{eff}} \\ge E_{0,\\text{eff}}$，其中 $E_{0,\\text{eff}}$ 是 $H_{\\text{eff}}$ 的最低本征值。\n\n在这个具体问题中，哈密顿量被给定为一个实的、对称的 $2 \\times 2$ 矩阵：\n$$H = \\begin{pmatrix} 0.5   0 \\\\ 0   1.5 \\end{pmatrix}$$\n对于实矩阵，共轭转置 $H^\\dagger$ 就是其转置 $H^T$。由于 $H$ 是对称的，所以 $H^T = H$。因此，有效哈密顿量简化为：\n$$H_{\\text{eff}} = \\frac{1}{2}(H + H^T) = \\frac{1}{2}(H + H) = H$$\n这意味着 $H_{\\text{eff}}$ 的基态能量与 $H$ 的基态能量相同，即 $E_{0,\\text{eff}} = E_0 = 0.5$。因此，正则瑞利商 $E_{\\text{eff}}$ 应满足标准的变分不等式 $E_{\\text{eff}} \\ge E_0$。\n\n任务是为由不同 $\\langle l \\rvert$ 和 $\\lvert r \\rangle$ 对定义的三种不同情况计算 $E_{\\text{bi}}$ 和 $E_{\\text{eff}}$。如果计算出的能量严格小于 $E_0 - \\tau$，则标记为违反变分原理，其中 $E_0=0.5$ 且数值容差 $\\tau=10^{-9}$。\n\n每种情况 $(\\langle l \\rvert, \\lvert r \\rangle)$ 的计算步骤如下：\n1.  计算双正交能量 $E_{\\text{bi}}$：\n    -   计算分子：$N_{\\text{bi}} = \\langle l \\rvert H \\lvert r \\rangle$。\n    -   计算分母：$D_{\\text{bi}} = \\langle l \\rvert r \\rangle$。分母必须非零。\n    -   计算商：$E_{\\text{bi}} = N_{\\text{bi}} / D_{\\text{bi}}$。\n\n2.  检查 $E_{\\text{bi}}$ 是否违规：\n    -   评估布尔条件 $\\text{viol}_{\\text{bi}} = (E_{\\text{bi}}  E_0 - \\tau)$。\n\n3.  计算有效能量 $E_{\\text{eff}}$：\n    -   计算分子：$N_{\\text{eff}} = \\langle r \\rvert H_{\\text{eff}} \\lvert r \\rangle = \\langle r \\rvert H \\lvert r \\rangle$。\n    -   计算分母：$D_{\\text{eff}} = \\langle r \\rvert r \\rangle$。\n    -   计算商：$E_{\\text{eff}} = N_{\\text{eff}} / D_{\\text{eff}}$。\n\n4.  检查 $E_{\\text{eff}}$ 是否违规：\n    -   评估布尔条件 $\\text{viol}_{\\text{eff}} = (E_{\\text{eff}}  E_0 - \\tau)$。\n\n将对指定的三个测试用例中的每一个执行这些计算，并按要求汇总和格式化结果。\n- 情况 A：$\\lvert r \\rangle = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$\\langle l \\rvert = \\begin{pmatrix} 0   1 \\end{pmatrix}$。此处 $\\langle l \\rvert$ 是 $\\lvert r \\rangle$ 的转置，代表一个标准的厄米投影。\n- 情况 B：$\\lvert r \\rangle = \\begin{pmatrix} 1 \\\\ 0.6 \\end{pmatrix}$，$\\langle l \\rvert = \\begin{pmatrix} 1   -0.6 \\end{pmatrix}$。这是一个非厄米投影，对应于 $\\langle l \\rvert$ 的矢量与矢量 $\\lvert r \\rangle$ 之间具有中等的“斜交性”（非正交性）。\n- 情况 C：$\\lvert r \\rangle = \\begin{pmatrix} 1 \\\\ 0.95 \\end{pmatrix}$，$\\langle l \\rvert = \\begin{pmatrix} 1   -0.95 \\end{pmatrix}$。该情况具有严重的非厄米投影，其中重叠 $\\langle l \\rvert r \\rangle$ 接近于零，放大了 $E_{\\text{bi}}$ 的病态行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes biorthogonal and effective Rayleigh quotients to test the\n    variational principle for a 2x2 quantum system.\n    \"\"\"\n    # Define constants and the Hamiltonian matrix\n    H = np.array([[0.5, 0.0], [0.0, 1.5]])\n    E0 = 0.5\n    tau = 1e-9\n\n    # The problem specifies a real symmetric H, so H_eff = 1/2*(H + H.T) = H.\n    # We will use H for both calculations.\n    H_eff = H\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (name, l_vec_T, r_vec).\n    # l_vec_T is a row vector (1x2), r_vec is a column vector (2x1).\n    test_cases = [\n        # Case A: Hermitian truncation \"happy path\"\n        ('A', np.array([[0.0, 1.0]]), np.array([[0.0], [1.0]])),\n        # Case B: Non-Hermitian truncation, moderate obliqueness\n        ('B', np.array([[1.0, -0.6]]), np.array([[1.0], [0.6]])),\n        # Case C: Non-Hermitian truncation, severe obliqueness\n        ('C', np.array([[1.0, -0.95]]), np.array([[1.0], [0.95]])),\n    ]\n\n    all_results = [f\"{E0:.6f}\"]\n\n    for name, l_vec_T, r_vec in test_cases:\n        # --- Biorthogonal Calculation ---\n        # Numerator:"
        },
        {
            "introduction": "在探索了静态基态的性质后，我们转向量子动力学领域。绝热定理描述了量子系统在外部条件缓慢变化时的行为，这对于理解化学反应、声子谱以及材料相变至关重要。这项实践  引导我们使用经典的 Landau-Zener 模型，通过数值求解含时薛定谔方程来模拟一个双能级系统如何演化通过一个“避免交叉”区域。通过这个过程，我们可以亲手计算非绝热跃迁的概率，并深刻理解绝热近似的适用范围及其失效的条件。",
            "id": "3469688",
            "problem": "要求您设计并实现一个数值实验，该实验在一个计算材料科学中广泛使用的最小双能级避免交叉模型中，从第一性原理出发检验绝热定理。其基本出发点是含时薛定谔方程 (TDSE)，在约化普朗克常数设为 $1$ 的约化单位制下，该方程写作 $i\\,\\partial_t|\\psi(t)\\rangle=\\hat{H}(t)|\\psi(t)\\rangle$。考虑以下产生单个避免交叉的参数化双能级哈密顿量：\n$$\n\\hat{H}(t) = v\\,t\\,\\sigma_z + \\Delta\\,\\sigma_x,\n$$\n其中 $v>0$ 是一个恒定的扫描速率，$\\Delta>0$ 是一个恒定的耦合常数，它设定了避免交叉处的最小能隙，而 $\\sigma_x$ 和 $\\sigma_z$ 是泡利矩阵。该哈密顿量源于材料哈密顿量在避免交叉附近的线性参数扫描，并作为检验绝热跟随和非绝热跃迁的典范模型。您的任务是，在 $t=-T$ 到 $t=+T$ 的时间区间内数值求解 TDSE，其中 $T=L\\,\\Delta/v$，$L$ 是一个无量纲比例因子，确保演化过程的起点和终点都远在耦合主导区域之外。在 $t=-T$ 时的初始态是 $\\hat{H}(-T)$ 的瞬时绝热基态本征态，我们感兴趣的可观测量是系统在 $t=+T$ 时处于 $\\hat{H}(+T)$ 的瞬时绝热激发本征态的最终概率。这个量就是朗道-齐纳 (Landau–Zener, LZ) 理论为此模型预测的非绝热跃迁概率的闭合形式解，您应当使用此哈密顿量的已知闭合形式解来计算该值以进行比较。您必须为一个二阶中点分段常数传播子校准其最大稳定时间步长 $\\delta t$。该传播子通过组合短时幺正传播子 $\\exp\\!\\left(-i\\,\\hat{H}(t+\\delta t/2)\\,\\delta t\\right)$ 来近似时间排序指数。\n\n您的程序必须：\n- 基于中点哈密顿量实现一个幺正短时传播子，确保每一步的数值幺正性。\n- 使用 $T=L\\,\\Delta/v$ 以及从 $-T$ 到 $+T$ 的均匀时间网格，并采用一个候选时间步长 $\\delta t$。\n- 将 $|\\psi(-T)\\rangle$ 初始化为 $\\hat{H}(-T)$ 的瞬时绝热基态本征态，并通过逐次应用中点传播子来计算最终态 $|\\psi(+T)\\rangle$。\n- 将最终的非绝热跃迁概率 $P_{\\text{num}}$ 计算为在 $\\hat{H}(+T)$ 的瞬时绝热激发本征态上的布居数。\n- 计算此特定哈密顿量对应的闭合形式解 $P_{\\text{LZ}}$，并将其与 $P_{\\text{num}}$ 进行比较。\n- 对每个测试用例，从一个给定的离散集合中确定满足以下精度标准的最大候选时间步长 $\\delta t$（该标准用于比较 $P_{\\text{num}}$ 和 $P_{\\text{LZ}}$）：\n  - 如果 $P_{\\text{LZ}}  10^{-3}$，则强制执行绝对误差界 $\\lvert P_{\\text{num}}-P_{\\text{LZ}}\\rvert \\le 5\\times 10^{-5}$。\n  - 否则，强制执行相对误差界 $\\lvert P_{\\text{num}}-P_{\\text{LZ}}\\rvert / P_{\\text{LZ}} \\le 10^{-3}$。\n- 如果没有候选时间步长满足该标准，则该测试用例返回数值 $0.0$。\n\n您必须将所有概率表示为无量纲数。任何角度（如果存在）都应以弧度为单位处理。在所选的 $\\hbar=1$ 的约化单位制中，所有参数都是无量纲的。\n\n测试套件：\n对每个用例，使用 $L=10$ 和候选集合 $\\{\\delta t\\} = [0.5,\\,0.2,\\,0.1,\\,0.05,\\,0.02]$。\n- 用例 1（强绝热通道）：$\\Delta=0.2$，$v=0.02$。按规定使用 $T=L\\,\\Delta/v$。\n- 用例 2（中间通道）：$\\Delta=0.2$，$v=0.1$。\n- 用例 3（非绝热通道）：$\\Delta=0.2$，$v=1.0$。\n- 用例 4（改变的能隙与扫描速率之比）：$\\Delta=0.5$，$v=0.2$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3,r4]”），每个条目是对应测试用例（按上述顺序）满足精度标准的所选最大 $\\delta t$（一个浮点数）。",
            "solution": "所提出的问题要求在朗道-齐纳模型的背景下对绝热定理进行数值研究，该模型是量子力学中一个典范的双能级系统。该任务的核心是求解一个特定含时哈密顿量的含时薛定谔方程 (TDSE)，并将数值结果与已知的解析结果进行比较。此验证过程涉及多个步骤，从分析哈密顿量的性质到实现一个稳定的数值传播子。\n\n控制方程是 TDSE，在 $\\hbar=1$ 的约化单位制下，其形式为：\n$$\ni \\frac{\\partial}{\\partial t} |\\psi(t)\\rangle = \\hat{H}(t) |\\psi(t)\\rangle\n$$\n\n此问题的哈密顿量是朗道-齐纳哈密顿量：\n$$\n\\hat{H}(t) = v t \\sigma_z + \\Delta \\sigma_x\n$$\n其中 $v > 0$ 是扫描速率，$\\Delta > 0$ 是耦合常数，$\\sigma_x, \\sigma_z$ 是泡利矩阵。在 $\\sigma_z$ 本征态的标准基 $\\{|\\uparrow\\rangle = (1, 0)^T, |\\downarrow\\rangle = (0, 1)^T\\}$ 下，哈密顿量表示为矩阵：\n$$\n\\hat{H}(t) = \\begin{pmatrix} v t   \\Delta \\\\ \\Delta   -v t \\end{pmatrix}\n$$\n通过求解特征方程，可以找到该哈密顿量的瞬时（绝热）本征值，结果为：\n$$\nE_{\\pm}(t) = \\pm \\sqrt{(v t)^2 + \\Delta^2}\n$$\n相应的瞬时本征矢量，记为 $|\\phi_{\\pm}(t)\\rangle$，构成了绝热基。态 $|\\phi_-(t)\\rangle$ 对应于较低的能量本征值 $E_-(t)$，是瞬时基态。态 $|\\phi_+(t)\\rangle$ 对应于较高的能量 $E_+(t)$，是瞬时激发态。这些态之间的能隙 $\\Delta E(t) = E_+(t) - E_-(t) = 2\\sqrt{(v t)^2 + \\Delta^2}$ 在 $t=0$ 时最小，其值为 $\\Delta E(0) = 2\\Delta$。\n\n该问题的设置旨在检验绝热定理。系统在时间 $t=-T$ 时从 $\\hat{H}(-T)$ 的瞬时基态 $|\\psi(-T)\\rangle = |\\phi_-(-T)\\rangle$ 开始。当 $t \\to -\\infty$ 时，$v t \\sigma_z$ 项占主导地位，此时 $v t  0$。$\\hat{H}(t)$ 的基态渐近趋向于 $|\\uparrow\\rangle$ 态。相反，当 $t \\to +\\infty$ 时，$v t \\sigma_z$ 项再次占主导地位，但此时 $v t > 0$，$\\hat{H}(t)$ 的基态渐近趋向于 $|\\downarrow\\rangle$ 态。\n如果演化是完全绝热的（即无限慢，$v \\to 0$），系统将始终保持在瞬时基态：对于所有 $t$，$|\\psi(t)\\rangle$ 都将跟随 $|\\phi_-(t)\\rangle$。因此，从 $|\\phi_-(-T)\\rangle$ 开始的系统将以 $|\\phi_-(+T)\\rangle$ 结束。非绝热跃迁是指系统跃迁到“另一个”绝热态，最终处于 $|\\phi_+(+T)\\rangle$ 的事件。我们必须计算的就是这种跃迁的概率。\n\n对于这个特定的哈密顿量，非绝热跃迁的概率由朗道-齐纳公式给出，它提供了一个解析基准 $P_{\\text{LZ}}$：\n$$\nP_{\\text{LZ}} = \\exp\\left(-\\frac{2\\pi \\Delta^2}{v}\\right)\n$$\n该公式是为从 $t=-\\infty$ 到 $t=+\\infty$ 的演化推导的。本问题将演化时间设定为从 $t=-T$ 到 $t=+T$，其中 $T=L\\Delta/v$，比例因子 $L=10$ 较大。这种选择确保了动力学过程的起点和终点都位于渐近区域，在这些区域中耦合 $\\Delta$ 与 $|vt|$ 相比很小，从而使得与理想化的朗道-齐纳公式的比较具有意义。\n\n数值解法涉及对 TDSE 进行积分。由于 $\\hat{H}(t)$ 是含时的，演化算符 $\\hat{U}(t_f, t_i)$ 由一个时间排序指数给出。我们使用二阶中点规则在一个小的时间步长 $\\delta t$ 上近似该算符。态从初始时间 $t_k$ 演化到 $t_{k+1} = t_k + \\delta t$ 的过程如下：\n$$\n|\\psi(t_{k+1})\\rangle \\approx \\hat{U}_{\\text{mid}} |\\psi(t_k)\\rangle = \\exp\\left(-i \\hat{H}(t_k + \\delta t/2) \\delta t\\right) |\\psi(t_k)\\rangle\n$$\n从 $-T$ 到 $+T$ 的完整演化是通过将时间区间离散化为 $N$ 个大小为 $\\delta t = 2T/N$ 的步长，并逐次应用此短时传播子来获得的。\n\n为了实现传播子 $\\hat{U}_{\\text{mid}}$，我们需要计算矩阵指数。对于任何形如 $\\hat{M} = a \\sigma_x + c \\sigma_z$ 的 $2\\times2$ 矩阵，可以证明 $\\hat{M}^2 = (a^2+c^2)I$。对于我们的传播子，指数中的矩阵是 $-i \\hat{H}(t')\\delta t$，其中 $t' = t_k + \\delta t/2$。设 $E(t') = \\sqrt{(vt')^2+\\Delta^2}$ 为中点时刻的能量大小。那么 $(\\hat{H}(t'))^2 = E(t')^2 I$。利用指数的泰勒级数展开，可以找到一个闭合形式的表达式：\n$$\n\\exp(-i \\hat{H}(t') \\delta t) = \\cos(E(t') \\delta t) I - i \\frac{\\sin(E(t') \\delta t)}{E(t')} \\hat{H}(t')\n$$\n其中 $I$ 是 $2\\times2$ 的单位矩阵。此公式在数值上是稳定的，因为 $\\Delta > 0$ 意味着 $E(t') \\ge \\Delta > 0$，从而避免了除以零。它还能明确地产生一个幺正传播子，确保态矢量的范数在整个模拟过程中守恒，这是数值稳定性的一个关键特性。\n\n每个测试用例的完整算法如下：\n1. 定义用例的参数 $\\Delta$ 和 $v$，并设置 $L=10$。\n2. 计算演化时间范围 $T = L\\Delta/v$ 和解析的朗道-齐纳概率 $P_{\\text{LZ}} = \\exp(-2\\pi \\Delta^2/v)$。\n3. 从大到小遍历给定集合 $\\{0.5, 0.2, 0.1, 0.05, 0.02\\}$ 中的候选时间步长 $\\delta t$。\n4. 对于选定的 $\\delta t$，建立一个从 $-T$ 到 $+T$ 的均匀时间网格。设步数为 $N = \\lceil 2T/\\delta t \\rceil$，实际时间步长为 $\\delta t_{\\text{eff}} = 2T/N$。\n5. 通过数值求解 $\\hat{H}(-T)$ 的基态本征矢量来确定初始态 $|\\psi(-T)\\rangle$。\n6. 通过应用中点传播子 $N$ 次，将态 $|\\psi(t)\\rangle$ 从 $-T$ 演化到 $+T$。\n7. 在最终时间 $T$，通过求解 $\\hat{H}(+T)$ 的相应本征矢量来确定瞬时激发态 $|\\phi_+(+T)\\rangle$。\n8. 计算数值非绝热跃迁概率 $P_{\\text{num}} = |\\langle \\phi_+(+T) | \\psi(+T) \\rangle|^2$。\n9. 使用指定的误差标准比较 $P_{\\text{num}}$ 和 $P_{\\text{LZ}}$。如果 $P_{\\text{LZ}}  10^{-3}$，绝对误差必须 $\\le 5\\times 10^{-5}$。否则，相对误差必须 $\\le 10^{-3}$。\n10. 如果满足标准，则当前的 $\\delta t$ 即为该用例所要求的结果。记录该值并继续处理下一个用例。\n11. 如果遍历所有候选 $\\delta t$ 值后仍未满足标准，则该用例的结果为 $0.0$。\n\n该过程在提供的 Python 代码中实现，利用 `numpy` 进行高效的线性代数运算。",
            "answer": "```python\nimport numpy as np\nfrom numpy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        (0.2, 0.02),  # Case 1 (strongly adiabatic)\n        (0.2, 0.1),   # Case 2 (intermediate)\n        (0.2, 1.0),   # Case 3 (nonadiabatic)\n        (0.5, 0.2),   # Case 4 (altered ratio)\n    ]\n    \n    L = 10.0\n    dt_candidates = [0.5, 0.2, 0.1, 0.05, 0.02]\n\n    results = []\n\n    # Pauli matrices (complex type for calculations)\n    sigma_x = np.array([[0, 1], [1, 0]], dtype=complex)\n    sigma_z = np.array([[1, 0], [0, -1]], dtype=complex)\n    identity = np.identity(2, dtype=complex)\n\n    for Delta, v in test_cases:\n        T = L * Delta / v\n        \n        # Calculate analytical Landau-Zener probability\n        p_lz = np.exp(-2.0 * np.pi * Delta**2 / v)\n\n        best_dt_for_case = 0.0\n        \n        # Iterate through candidate dt values from largest to smallest\n        for dt_candidate in dt_candidates:\n            # Set up a uniform time grid to exactly span [-T, T]\n            num_steps = int(np.ceil(2 * T / dt_candidate))\n            if num_steps == 0: continue\n            \n            actual_dt = 2.0 * T / num_steps\n            times = np.linspace(-T, T, num_steps + 1)\n            \n            # --- Simulation ---\n            \n            # 1. Initial State: Ground state of H(-T)\n            H_initial = v * (-T) * sigma_z + Delta * sigma_x\n            evals_i, evecs_i = eigh(H_initial)\n            psi = evecs_i[:, 0]  # eigh sorts eigenvalues, so 0 is ground state\n\n            # 2. Time Propagation\n            for i in range(num_steps):\n                t_mid = times[i] + actual_dt / 2.0\n                H_mid = v * t_mid * sigma_z + Delta * sigma_x\n                \n                # Energy at midpoint: E = sqrt((v*t)^2 + Delta^2)\n                E_mid = np.sqrt((v * t_mid)**2 + Delta**2)\n                \n                # Propagator U = exp(-i*H_mid*dt) using closed-form expression\n                # U = cos(E*dt)*I - i*sin(E*dt)/E * H\n                cos_term = np.cos(E_mid * actual_dt)\n                sin_term = np.sin(E_mid * actual_dt) / E_mid\n                \n                U = cos_term * identity - 1j * sin_term * H_mid\n                \n                psi = U @ psi\n                \n            # 3. Final Probability Calculation\n            H_final = v * T * sigma_z + Delta * sigma_x\n            evals_f, evecs_f = eigh(H_final)\n            # Excited state corresponds to the higher eigenvalue (index 1)\n            excited_state_final = evecs_f[:, 1]\n            \n            p_num = np.abs(np.vdot(excited_state_final, psi))**2\n\n            # 4. Check Accuracy Criterion\n            passed = False\n            if p_lz  1e-3:\n                # Absolute error bound for small probabilities\n                if np.abs(p_num - p_lz) = 5e-5:\n                    passed = True\n            else:\n                # Relative error bound otherwise\n                if p_lz > 0 and np.abs(p_num - p_lz) / p_lz = 1e-3:\n                    passed = True\n            \n            if passed:\n                best_dt_for_case = dt_candidate\n                break  # Found largest valid dt, move to next case\n                \n        results.append(best_dt_for_case)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.2f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们深入到现代材料模拟的“主力方法”——密度泛函理论 (DFT) 的核心。Hohenberg-Kohn 定理是 DFT 的一块基石，它确立了电子密度与外部势之间存在唯一的映射关系（在相差一个任意常数的情况下）。这项实践  提供了一个直接的计算验证，要求我们实现一个简化的平面波 DFT 计算程序。通过该程序，我们将证明对 Kohn-Sham 势施加一个常数位移 $v_{\\text{KS}}(x) \\to v_{\\text{KS}}(x) + \\Delta v$，会使所有能级发生同样大小的刚性移动，但物理上可观测量——电子密度——却保持严格不变。",
            "id": "3469774",
            "problem": "考虑一维空间中具有周期性边界条件的非相对论单粒子 Kohn-Sham (KS) 理论，该理论源于密度泛函理论 (DFT)。其理论基础是针对 KS 轨道的非相对论定态薛定谔方程、用于计算密度的玻恩法则以及布洛赫定理。此处的薛定谔算符即为 KS 哈密顿算符。设 KS 哈密顿算符写作 $$\\hat{H}_{\\text{KS}} = -\\frac{1}{2}\\frac{d^{2}}{dx^{2}} + v_{\\text{KS}}(x),$$ 其中 $x$ 为长度为 $a$ 的晶胞中的晶体坐标，能量单位为哈特里原子单位，长度单位为玻尔原子单位。布洛赫定理指出，本征函数可以用第一布里渊区中的晶体动量 $k$ 来标记，并可用平面波基组展开。考虑一个一维周期性势 $$v_{\\text{KS}}(x) = V_{0}\\cos(G_{0}x),$$ 其中 $G_{0} = \\frac{2\\pi}{a}$。平面波基组由倒易点阵矢量构成 $$G \\in \\{-M G_{0}, -(M-1)G_{0}, \\dots, -G_{0}, 0, G_{0}, \\dots, (M-1)G_{0}, M G_{0}\\},$$ 其中 $M$ 是一个正整数截断指数。在此基组下，给定晶体动量 $k$ 的哈密顿矩阵为 $$H_{G,G'}(k) = \\frac{1}{2}(k+G)^{2}\\delta_{G,G'} + v_{G-G'},$$ 其中 $v_{Q}$ 是 $v_{\\text{KS}}(x)$ 的傅里叶分量，其中 $v_{\\pm G_{0}} = \\frac{V_{0}}{2}$，所有其他 $v_{Q}$ 均为零。晶胞中的电子密度由占据的 KS 态构建而成 $$\\rho(x) = \\sum_{k\\in \\mathcal{K}} w_{k}\\sum_{n \\in \\text{occ}} \\left|\\psi_{n k}(x)\\right|^{2},$$ 其中 $\\mathcal{K}$ 是布里渊区的一个有限均匀采样，$w_{k}$ 是相等的 k 点权重，其总和为 1，$n$ 是能带指数，$\\psi_{n k}(x)$ 是在平面波基组中展开的 KS 轨道 $$ \\psi_{n k}(x) = \\frac{1}{\\sqrt{a}}\\sum_{G} c_{n k}(G)\\, e^{i(k+G)x},$$ 其系数 $c_{n k}(G)$ 通过对角化 $H(k)$ 获得。\n\n您的任务是通过显式地为势增加一个均匀位移 $\\Delta v$ 来评估在周期性边界条件下 $v_{\\text{KS}}(x)$ 在相差一个加性常数下的唯一性， $$v'_{\\text{KS}}(x) = v_{\\text{KS}}(x) + \\Delta v,$$ 并确认 $\\rho(x)$ 的不变性，同时追踪本征值 $\\epsilon_{n k}$ 的变化。使用的基本定律是非相对论 KS 哈密顿算符、布洛赫定理和用于计算密度的玻恩法则。不允许使用任何额外的捷径。占据情况设定在零温和每晶胞电子数固定的条件下，因此对于每个 k 点，最低能带都被完全占据。\n\n实现一个程序，该程序能够：\n- 针对第一布里渊区 $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$ 内的均匀 k 点网格，在上述平面波基组中构建哈密顿矩阵 $H(k)$。\n- 对角化 $H(k)$ 以获得本征值 $\\epsilon_{n k}$ 和本征矢量 $c_{n k}(G)$。\n- 在均匀的实空间网格上，使用每个 k 点的最低占据能带和相等的权重 $w_{k}$ 来计算晶胞电子密度 $\\rho(x)$。\n- 对移动后的势 $v'_{\\text{KS}}(x)$ 重复计算，并计算出相应的密度 $\\rho'(x)$ 以及移动后的本征值 $\\epsilon'_{n k}$。\n- 使用明确的容差验证两个性质：\n  (i) 密度不变性，通过最大绝对差 $\\max_{x}|\\rho'(x)-\\rho(x)|$ 小于用户指定的容差来量化；\n  (ii) 刚性本征值移动，通过最大绝对偏差 $\\max_{n,k}|\\left(\\epsilon'_{n k} - \\epsilon_{n k}\\right) - \\Delta v|$ 小于同一容差来量化。\n\n能量使用哈特里原子单位，长度使用玻尔原子单位；角度使用弧度。您的程序必须为每个测试用例输出一个布尔结果列表，其中每个元素是一个包含两个条目的列表 $[\\text{density\\_invariant}, \\text{eigenvalue\\_shift\\_rigid}]$，对应于上述两个验证，每个布尔值表示该性质是否在规定的容差范围内成立。\n\n测试套件：\n- 案例 A（一般非平凡周期势，正向均匀位移）：$a = 5.0$，$V_{0} = 0.5$，$M = 2$，k 点数 $N_{k} = 5$，实空间格点数 $N_{x} = 200$，每晶胞电子数 $N_{e} = 1$，均匀位移 $\\Delta v = 0.3$，容差 $\\tau = 10^{-10}$。\n- 案例 B（自由电子，存在简并，负向均匀位移）：$a = 6.0$，$V_{0} = 0.0$，$M = 3$，k 点数 $N_{k} = 7$，实空间格点数 $N_{x} = 256$，每晶胞电子数 $N_{e} = 1$，均匀位移 $\\Delta v = -0.25$，容差 $\\tau = 10^{-10}$。\n- 案例 C（非平凡周期势，零均匀位移作为边界条件）：$a = 4.0$，$V_{0} = 0.3$，$M = 1$，k 点数 $N_{k} = 9$，实空间格点数 $N_{x} = 128$，每晶胞电子数 $N_{e} = 1$，均匀位移 $\\Delta v = 0.0$，容差 $\\tau = 10^{-10}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个如上所述的双元素布尔列表。例如，输出应如下所示：$$[[\\text{True},\\text{True}],[\\text{True},\\text{True}],[\\text{True},\\text{True}]].$$",
            "solution": "问题陈述被评估为有效。它在科学上基于非相对论量子力学和密度泛函理论的原理，问题设定良好，提供了所有必要的参数，并且其表述是客观的。任务是执行一个基本概念的数值验证：在增加一个常数势的情况下，物理可观测量（如电子密度）的不变性以及能量本征值的刚性移动。这是计算物理学中一个标准且有意义的练习。\n\n解决方案通过实现一维平面波 Kohn-Sham 计算来推进。该算法针对每组测试参数 $\\{a, V_0, M, N_k, N_x, \\Delta v, \\tau\\}$ 执行。\n\n1.  **系统和网格定义**：物理系统是一个晶格常数为 $a$ 的一维晶体。\n    - 在晶胞内定义一个包含 $N_x$ 个均匀点的实空间网格，$x_j = j \\frac{a}{N_x}$，其中 $j \\in \\{0, 1, \\dots, N_x-1\\}$。\n    - 对偶空间是倒易空间，其基本倒易点阵矢量为 $G_0 = \\frac{2\\pi}{a}$。用于展开 Kohn-Sham 轨道的平面波基组被截断，包含 $2M+1$ 个矢量：$G_m = m G_0$，其中 $m \\in \\{-M, \\dots, M\\}$。\n    - 第一布里渊区，范围为 $[-\\frac{\\pi}{a}, \\frac{\\pi}{a})$，使用包含 $N_k$ 个晶体动量点（k 点）的均匀网格进行采样：$k_p = -\\frac{\\pi}{a} + p \\frac{2\\pi}{a N_k}$，其中 $p \\in \\{0, 1, \\dots, N_k-1\\}$。\n\n2.  **哈密顿矩阵构建**：对于每个 k 点 $k_p$，Kohn-Sham 哈密顿算符 $\\hat{H}_{\\text{KS}}$ 在指定的平面波基组中表示为一个 $(2M+1) \\times (2M+1)$ 的矩阵。矩阵元素为：\n    $$H_{m,m'}(k_p) = \\frac{1}{2}(k_p + G_m)^2 \\delta_{m,m'} + v_{G_m - G_{m'}}$$\n    其中索引 $m, m'$ 的范围从 $-M$ 到 $M$。\n    - 第一项代表动能，仅对矩阵的对角线有贡献。\n    - 第二项 $v_{G_m - G_{m'}}$ 代表周期势 $v_{\\text{KS}}(x) = V_0 \\cos(G_0 x)$ 的傅里叶变换分量。该势的傅里叶级数为 $v_{\\text{KS}}(x) = \\frac{V_0}{2}(e^{iG_0x} + e^{-iG_0x})$。唯一非零的傅里叶系数 $v_Q$ 是 $v_{G_0} = v_{-G_0} = \\frac{V_0}{2}$。\n    - 因此，势能项在 $G_m - G_{m'} = \\pm G_0$（即 $m-m'=\\pm 1$）处为矩阵元素贡献 $\\frac{V_0}{2}$。这使得哈密顿矩阵成为一个实对称三对角矩阵。\n\n3.  **对角化与轨道计算**：对每个 $k_p$ 的哈密顿矩阵 $H(k_p)$ 进行对角化。这是一个标准的厄米矩阵本征值问题，可通过数值方法求解。\n    $$H(k_p) c_{n,k_p} = \\epsilon_{n,k_p} c_{n,k_p}$$\n    对角化产生一组实数本征值 $\\epsilon_{n,k_p}$（能带能量）及其对应的本征矢量 $c_{n,k_p}$。本征矢量包含 Kohn-Sham 轨道 $\\psi_{n,k_p}(x)$ 平面波展开的系数。我们关心的是最低能带，它对应于每个 $k_p$ 的最小本征值，记为 $n=0$。\n\n4.  **电子密度计算**：根据玻恩法则，通过对所有占据态的概率密度求和来构建电子密度 $\\rho(x)$。在最低能带被完全占据的情况下，每个实空间格点 $x_j$ 处的密度为：\n    $$\\rho(x_j) = \\sum_{p=0}^{N_k-1} w_{k_p} |\\psi_{0,k_p}(x_j)|^2$$\n    其中 $w_{k_p} = 1/N_k$ 是 k 点采样的均匀权重。每个 $k_p$ 处最低能带的轨道由其系数构建：\n    $$\\psi_{0,k_p}(x_j) = \\frac{1}{\\sqrt{a}} \\sum_{m=-M}^{M} c_{0,k_p}(G_m) \\, e^{i(k_p+G_m)x_j}$$\n\n5.  **移动势的处理流程**：对移动后的势 $v'_{\\text{KS}}(x) = v_{\\text{KS}}(x) + \\Delta v$ 重复整个计算过程。增加一个常数 $\\Delta v$ 只会改变势的 $Q=0$ 傅里叶分量，即 $v'_0 = v_0 + \\Delta v$。对于给定的余弦势，$v_0=0$，因此 $v'_0=\\Delta v$。移动势的哈密顿矩阵变为：\n    $$H'_{m,m'}(k_p) = H_{m,m'}(k_p) + \\Delta v \\, \\delta_{m,m'}$$\n    这意味着 $H'(k_p) = H(k_p) + \\Delta v I$，其中 $I$ 是单位矩阵。对这个新矩阵进行对角化，以找到新的本征值 $\\epsilon'_{n,k_p}$ 和本征矢量 $c'_{n,k_p}$，并由此计算出新的密度 $\\rho'(x)$。\n\n6.  **数值验证**：最后一步是基于数值结果验证两个关键性质。\n    - **密度不变性**：计算原始密度与移动后密度之间的最大绝对差 $\\max_{j} |\\rho'(x_j) - \\rho(x_j)|$，并与容差 $\\tau$ 进行比较。如果该差值小于 $\\tau$，则该命题成立。\n    - **刚性本征值移动**：通过计算所有能带和 k 点上的最大绝对差 $\\max_{n,p} |(\\epsilon'_{n,k_p} - \\epsilon_{n,k_p}) - \\Delta v|$ 来量化与完美刚性移动的偏差。如果该差值小于 $\\tau$，则该命题成立。\n    \n每个测试用例的最终输出是一个包含两个布尔值的列表，代表这两个验证测试的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_one_case(a, V0, M, Nk, Nx, delta_v, tol):\n    \"\"\"\n    Solves the Kohn-Sham equations for one-dimensional periodic potential\n    for both the original and a uniformly shifted potential, and verifies\n    density invariance and rigid eigenvalue shift.\n\n    Args:\n        a (float): Lattice constant in Bohr.\n        V0 (float): Amplitude of the cosine potential in Hartree.\n        M (int): Truncation index for the plane-wave basis.\n        Nk (int): Number of k-points for Brillouin zone sampling.\n        Nx (int): Number of grid points for real-space density.\n        delta_v (float): Uniform shift applied to the potential in Hartree.\n        tol (float): Tolerance for verification checks.\n\n    Returns:\n        list[bool, bool]: A list containing two booleans for\n                          [density_invariant, eigenvalue_shift_rigid].\n    \"\"\"\n    # 1. Define grids\n    G0 = 2.0 * np.pi / a\n    # Reciprocal space grid (G-vectors)\n    G_vec = np.arange(-M, M + 1) * G0\n    # Crystal momentum grid (k-points)\n    k_vec = -np.pi / a + np.arange(Nk) * (2.0 * np.pi / (a * Nk))\n    # Real-space grid\n    x_vec = np.arange(Nx) * a / Nx\n    \n    # Dimension of the Hamiltonian matrix\n    dim = 2 * M + 1\n    \n    # Initialize arrays for storing results\n    all_eps = np.zeros((Nk, dim))\n    all_eps_prime = np.zeros((Nk, dim))\n    rho = np.zeros(Nx, dtype=float)\n    rho_prime = np.zeros(Nx, dtype=float)\n    \n    # 2. Iterate over all k-points in the Brillouin zone\n    for p, k in enumerate(k_vec):\n        # 3. Construct the Hamiltonian matrix H(k)\n        H = np.zeros((dim, dim), dtype=float)\n        \n        # Kinetic energy term (diagonal)\n        diag_indices = np.arange(dim)\n        H[diag_indices, diag_indices] = 0.5 * (k + G_vec)**2\n        \n        # Potential energy term (off-diagonal)\n        if V0 != 0.0:\n            off_diag_val = V0 / 2.0\n            if dim > 1:\n                # Super-diagonal\n                H[diag_indices[:-1], diag_indices[1:]] = off_diag_val\n                # Sub-diagonal\n                H[diag_indices[1:], diag_indices[:-1]] = off_diag_val\n        \n        # 4. Diagonalize H(k) to get eigenvalues and eigenvectors\n        eps, C = np.linalg.eigh(H)\n        all_eps[p, :] = eps\n        c0k = C[:, 0]  # Eigenvector for the lowest energy band (n=0)\n        \n        # 5. Repeat for the shifted potential v'(x) = v(x) + delta_v\n        # The new Hamiltonian is H'(k) = H(k) + delta_v * I\n        H_prime = H + np.eye(dim) * delta_v\n        eps_prime, C_prime = np.linalg.eigh(H_prime)\n        all_eps_prime[p, :] = eps_prime\n        c0k_prime = C_prime[:, 0]\n        \n        # 6. Compute density contributions from this k-point\n        # Construct matrix of plane-wave phase factors, shape (Nx, dim)\n        phase_factor_matrix = np.exp(1j * np.outer(x_vec, k + G_vec))\n        \n        # Calculate orbitals on the real-space grid via matrix-vector product\n        psi_k = (1.0 / np.sqrt(a)) * (phase_factor_matrix @ c0k)\n        psi_k_prime = (1.0 / np.sqrt(a)) * (phase_factor_matrix @ c0k_prime)\n        \n        # Accumulate density with uniform k-point weight\n        w_k = 1.0 / Nk\n        rho += w_k * np.abs(psi_k)**2\n        rho_prime += w_k * np.abs(psi_k_prime)**2\n        \n    # 7. Verify the two required properties\n    # (i) Density invariance\n    max_rho_diff = np.max(np.abs(rho_prime - rho))\n    density_invariant = max_rho_diff  tol\n    \n    # (ii) Rigid eigenvalue shift\n    max_eps_diff = np.max(np.abs((all_eps_prime - all_eps) - delta_v))\n    eigenvalue_shift_rigid = max_eps_diff  tol\n    \n    return [density_invariant, eigenvalue_shift_rigid]\n\ndef solve():\n    \"\"\"\n    Main function to run the defined test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case A: general nontrivial periodic potential, positive uniform shift\n        {'a': 5.0, 'V0': 0.5, 'M': 2, 'Nk': 5, 'Nx': 200, 'delta_v': 0.3, 'tol': 1e-10},\n        # Case B: free electrons, degeneracy present, negative uniform shift\n        {'a': 6.0, 'V0': 0.0, 'M': 3, 'Nk': 7, 'Nx': 256, 'delta_v': -0.25, 'tol': 1e-10},\n        # Case C: nontrivial periodic potential, zero uniform shift as a boundary condition\n        {'a': 4.0, 'V0': 0.3, 'M': 1, 'Nk': 9, 'Nx': 128, 'delta_v': 0.0, 'tol': 1e-10},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_one_case(case['a'], case['V0'], case['M'], case['Nk'], case['Nx'], case['delta_v'], case['tol'])\n        results.append(result)\n\n    # Final print statement in the exact required format: [[True,True],[True,True],...]\n    print(f\"[{','.join(map(str, results))}]\".replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}