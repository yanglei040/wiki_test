{
    "hands_on_practices": [
        {
            "introduction": "分子动力学（MD）模拟是建立在经典力学基础之上的。在温度为 $T$ 的正则系综中，这些模拟应当能重现由玻尔兹曼统计预测的速度分布。本练习将指导您建立一个严谨的框架，用于检验模拟是否达到了热平衡状态并且行为正确，这是任何基于模拟的研究中至关重要的第一步。通过将模拟数据与麦克斯韦-玻尔兹曼（Maxwell-Boltzmann）分布的理论预测进行比较 ，您将掌握验证计算模型保真度的基本技能。",
            "id": "3435506",
            "problem": "您的任务是设计一个基于统计学原理的计算测试，用于验证在温度 $T$ 下对伦纳德-琼斯流体进行的分子动力学 (MD) 模拟所产生的速度分量是否遵循玻尔兹曼统计预测的高斯分布，以及由此产生的速率分布是否与三维麦克斯韦-玻尔兹曼形式相匹配。您的程序必须完全自包含，无需任何用户输入或外部数据即可运行。它必须仅使用经过充分检验的科学原理和定义作为基础，实现以下要求。\n\n解决方案必须基于以下基本原理：\n- 固定温度 $T$ 下的正则系综意味着相空间概率密度与 $\\exp(-\\beta H)$ 成正比，其中 $\\beta = 1 / (k_B T)$，$H$ 为哈密顿量。\n- 质量为 $m$ 的非相对论性粒子的动能为 $E_{\\mathrm{kin}} = \\frac{1}{2} m (v_x^2 + v_y^2 + v_z^2)$。\n- 平衡状态下空间各向同性意味着速度矢量的分布仅取决于其大小。\n- 玻尔兹曼常数为 $k_B$；使用 $k_B = 1.380649 \\times 10^{-23}$，单位为 $\\mathrm{J/K}$。\n- 预期的统计行为可由这些定义和各向同性推导得出，但您不能假定任何简便公式。\n\n需要实现的验证任务：\n- 推导在温度 $T$ 下，质量为 $m$ 的单个笛卡尔速度分量 $v_x$ 的理论累积分布函数 (CDF)，该函数由正则系综和各向同性所蕴含，并用它来测试 $v_x$ 的样本是否与给定 $T$ 和 $m$ 下相应的高斯分布一致。\n- 推导在温度 $T$ 下，质量为 $m$ 的速率 $s = \\sqrt{v_x^2 + v_y^2 + v_z^2}$ 的理论 CDF，并用它来测试速率样本是否与由此产生的三维速率分布一致。\n- 使用一个基于统计学原理的拟合优度程序，将样本与一个完全指定的理论 CDF进行比较。使用单样本拟合优度检验，该检验基于您推导出的精确 CDF 得出 $p$ 值，并为每个检验选择显著性水平 $\\alpha = 10^{-4}$。\n- 除了对一维分量的拟合优度检验外，还包括一个检验，即每个笛卡尔速度分量的样本均值与零一致，使用由理论方差所决定的标准误，并使用双侧 $z$ 分数阈值 $|z| \\le 4.0$。\n- 当且仅当所有三个分量检验同时通过，并且速率检验在指定的 $\\alpha$ 和 $z$ 分数阈值下通过时，才宣布 MD 样本通过测试。\n\n为内部测试套件生成数据：\n- 因为程序必须是独立的且可复现的，您必须通过在三个笛卡尔方向上进行独立采样来生成合成的“假定 MD”速度数据。对于给定的模拟质量 $m$、“模拟温度” $T_{\\mathrm{sim}}$、理论温度 $T_{\\mathrm{theory}}$（测试评估数据所依据的值）、漂移矢量 $(\\mu_x, \\mu_y, \\mu_z)$ (单位 $\\mathrm{m/s}$) 和各向异性尺度因子 $(a_x, a_y, a_z)$，按如下方式生成 $N$ 个样本：\n  - 对于每个分量 $i \\in \\{x,y,z\\}$，从均值为 $\\mu_i$、标准差为 $\\sigma_i = a_i \\sqrt{k_B T_{\\mathrm{sim}} / m}$ 的正态分布中独立抽取 $v_i$。\n  - 统计检验必须根据 $T_{\\mathrm{theory}}$ 和 $m$ 下的理论模型进行评估。\n- 所有速度必须以 $\\mathrm{m/s}$ 表示，所有温度以 $\\mathrm{K}$ 表示，质量以 $\\mathrm{kg}$ 表示。\n\n您的程序必须实现以下参数集测试套件，每个参数集都会生成一个独立的合成数据集。对于每种情况，程序必须输出一个布尔值，指示数据是否通过所有验证任务。参数是元组 $(N, m, T_{\\mathrm{theory}}, T_{\\mathrm{sim}}, \\mu_x, \\mu_y, \\mu_z, a_x, a_y, a_z, \\mathrm{seed})$，单位如下：\n- 案例 1 (理想情况，各向同性，温度正确): $(N = 20000, m = 6.63 \\times 10^{-26}\\ \\mathrm{kg}, T_{\\mathrm{theory}} = 120\\ \\mathrm{K}, T_{\\mathrm{sim}} = 120\\ \\mathrm{K}, \\mu_x = 0\\ \\mathrm{m/s}, \\mu_y = 0\\ \\mathrm{m/s}, \\mu_z = 0\\ \\mathrm{m/s}, a_x = 1, a_y = 1, a_z = 1, \\mathrm{seed} = 12345)$。\n- 案例 2 (温度不匹配): $(N = 15000, m = 6.63 \\times 10^{-26}\\ \\mathrm{kg}, T_{\\mathrm{theory}} = 120\\ \\mathrm{K}, T_{\\mathrm{sim}} = 150\\ \\mathrm{K}, \\mu_x = 0\\ \\mathrm{m/s}, \\mu_y = 0\\ \\mathrm{m/s}, \\mu_z = 0\\ \\mathrm{m/s}, a_x = 1, a_y = 1, a_z = 1, \\mathrm{seed} = 2024)$。\n- 案例 3 (单方向非零漂移): $(N = 15000, m = 6.63 \\times 10^{-26}\\ \\mathrm{kg}, T_{\\mathrm{theory}} = 120\\ \\mathrm{K}, T_{\\mathrm{sim}} = 120\\ \\mathrm{K}, \\mu_x = 40\\ \\mathrm{m/s}, \\mu_y = 0\\ \\mathrm{m/s}, \\mu_z = 0\\ \\mathrm{m/s}, a_x = 1, a_y = 1, a_z = 1, \\mathrm{seed} = 777)$。\n- 案例 4 (单方向各向异性): $(N = 15000, m = 6.63 \\times 10^{-26}\\ \\mathrm{kg}, T_{\\mathrm{theory}} = 120\\ \\mathrm{K}, T_{\\mathrm{sim}} = 120\\ \\mathrm{K}, \\mu_x = 0\\ \\mathrm{m/s}, \\mu_y = 0\\ \\mathrm{m/s}, \\mu_z = 0\\ \\mathrm{m/s}, a_x = 1, a_y = 1, a_z = 1.5, \\mathrm{seed} = 314159)$。\n- 案例 5 (高温，模型正确，样本量适中): $(N = 5000, m = 6.63 \\times 10^{-26}\\ \\mathrm{kg}, T_{\\mathrm{theory}} = 3000\\ \\mathrm{K}, T_{\\mathrm{sim}} = 3000\\ \\mathrm{K}, \\mu_x = 0\\ \\mathrm{m/s}, \\mu_y = 0\\ \\mathrm{m/s}, \\mu_z = 0\\ \\mathrm{m/s}, a_x = 1, a_y = 1, a_z = 1, \\mathrm{seed} = 424242)$。\n\n每个案例的接受标准：\n- 对于三个分量中的每一个，计算样本均值相对于 $T_{\\mathrm{theory}}$ 和 $m$ 下理论标准差的双侧 $z$ 分数，并要求 $|z| \\le 4.0$。\n- 对每个分量，以显著性水平 $\\alpha = 10^{-4}$，针对给定 $T_{\\mathrm{theory}}$ 和 $m$ 下推导出的高斯 CDF 进行单样本拟合优度检验；并独立地，以相同的 $\\alpha$ 对速率样本，针对相同 $T_{\\mathrm{theory}}$ 和 $m$ 下推导出的三维速率 CDF 进行单样本拟合优度检验。所有四个检验都必须得出 $p \\ge \\alpha$。\n- 当且仅当所有这些条件同时满足时，该案例才通过。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含五个案例的通过/失败结果，格式为一个无空格、逗号分隔的 Python 风格布尔值列表，例如 `[True,False,True,True,False]`。\n\n角度单位不适用。所有物理单位如上所述，所有速度必须以 $\\mathrm{m/s}$ 为单位处理。不要进行任何四舍五入；布尔值是精确的。",
            "solution": "目标是构建一个计算程序，用于验证来自流体分子动力学 (MD) 模拟在指定温度 $T$ 下的速度数据是否符合经典统计力学，特别是玻尔兹曼统计的预测。验证过程通过从第一性原理推导速度分量和粒子速率的理论概率分布，然后将这些分布用于严格的统计检验来完成。\n\n首先，我们建立理论基础。在正则系综中，对于一个处于固定温度 $T$ 的系统，观察到能量为 $E$ 的微观状态的概率与玻尔兹曼因子 $\\exp(-\\beta E)$ 成正比，其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数。对于一个由非相互作用粒子组成的系统，或者当仅考虑哈密顿量的动能部分时，质量为 $m$、速度矢量为 $\\mathbf{v} = (v_x, v_y, v_z)$ 的单个粒子的能量是其动能 $E_{\\mathrm{kin}} = \\frac{1}{2} m (v_x^2 + v_y^2 + v_z^2)$。\n\n因此，速度矢量 $\\mathbf{v}$ 的概率密度函数 (PDF) 由下式给出：\n$$P(v_x, v_y, v_z) \\propto \\exp\\left(-\\beta E_{\\mathrm{kin}}\\right) = \\exp\\left(-\\frac{\\beta m}{2} (v_x^2 + v_y^2 + v_z^2)\\right)$$\n该表达式可以分解为三个独立的项：\n$$P(v_x, v_y, v_z) \\propto \\exp\\left(-\\frac{\\beta m v_x^2}{2}\\right) \\exp\\left(-\\frac{\\beta m v_y^2}{2}\\right) \\exp\\left(-\\frac{\\beta m v_z^2}{2}\\right)$$\n这种因式分解意味着速度分量 $v_x$、$v_y$ 和 $v_z$ 是统计上独立的随机变量。问题中各向同性的假设意味着每个分量的分布是相同的。因此，我们可以分析单个分量，例如 $v_x$。其 PDF 为：\n$$P(v_x) = C \\exp\\left(-\\frac{\\beta m v_x^2}{2}\\right)$$\n其中 $C$ 是一个归一化常数。这是一个均值为 $0$ 的高斯（正态）分布形式。为了找到方差 $\\sigma^2$，我们对 PDF 进行归一化：$\\int_{-\\infty}^{\\infty} P(v_x) dv_x = 1$。使用标准高斯积分 $\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\pi/a}$，其中 $a = \\beta m / 2$，我们求得 $C = \\sqrt{\\beta m / (2\\pi)}$。PDF 为：\n$$P(v_x) = \\sqrt{\\frac{m}{2\\pi k_B T}} \\exp\\left(-\\frac{m v_x^2}{2 k_B T}\\right)$$\n通过将其与零均值高斯 PDF 的标准形式 $P(x) = (1/(\\sigma \\sqrt{2\\pi})) \\exp(-x^2/(2\\sigma^2))$ 进行比较，我们确定理论方差为 $\\sigma^2_{\\mathrm{theory}} = k_B T / m$。\n\n对于拟合优度检验，我们需要累积分布函数 (CDF)，$F(v_x) = \\int_{-\\infty}^{v_x} P(u) du$。这个积分与误差函数 $\\mathrm{erf}(z) = (2/\\sqrt{\\pi}) \\int_0^z e^{-t^2} dt$ 有关。速度分量最终的 CDF 是：\n$$F(v_x) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(v_x \\sqrt{\\frac{m}{2 k_B T}}\\right)\\right]$$\n这完全指定了用于检验 $v_x$ 值样本的理论分布。\n\n接下来，我们推导粒子速率 $s = |\\mathbf{v}| = \\sqrt{v_x^2 + v_y^2 + v_z^2}$ 的分布。由于各向同性，切换到速度空间中的球坐标很方便。体积元 $dv_x dv_y dv_z$ 变为 $4\\pi s^2 ds$。找到速率在 $s$ 和 $s+ds$ 之间的粒子的概率是联合 PDF 在相应球壳上的积分：\n$$P(s)ds = 4\\pi s^2 P(v_x, v_y, v_z)|_{|\\mathbf{v}|=s} ds = 4\\pi s^2 \\left(\\frac{m}{2\\pi k_B T}\\right)^{3/2} \\exp\\left(-\\frac{m s^2}{2 k_B T}\\right) ds$$\n这就是麦克斯韦-玻尔兹曼速率分布。速率对应的 CDF，$F(s) = \\int_0^s P(u)du$ (对于 $s \\ge 0$)，是通过对该表达式积分得到的。结果是：\n$$F(s) = \\mathrm{erf}\\left(s\\sqrt{\\frac{m}{2 k_B T}}\\right) - \\sqrt{\\frac{2m}{\\pi k_B T}} s \\exp\\left(-\\frac{m s^2}{2 k_B T}\\right)$$\n此 CDF 将用于检验速率样本。\n\n计算程序根据这些推导实现了两种统计检验。\n1.  **均值验证**：对于每个笛卡尔分量 $v_i$，我们检验其样本均值 $\\bar{v}_i$ 是否与理论均值 $0$ 一致。计算 $z$ 分数 $z_i = \\bar{v}_i / SE_i$，其中 $SE_i$ 是均值的标准误。它由 $SE_i = \\sigma_{\\mathrm{theory}} / \\sqrt{N}$ 给出，其中 $\\sigma_{\\mathrm{theory}} = \\sqrt{k_B T_{\\mathrm{theory}} / m}$，$N$ 是样本大小。如果所有三个分量的 $|z_i| \\le 4.0$，则 MD 样本通过此检验，这对应于一个非常严格的置信水平。\n\n2.  **分布验证**：我们使用单样本柯尔莫哥洛夫-斯米尔诺夫 (K-S) 检验来比较采样数据的经验分布与上述推导的理论 CDF。该检验计算经验 CDF 和理论 CDF 之间的最大绝对差。这个差值用于计算一个 $p$ 值。如果 $p$ 值大于或等于指定的显著性水平 $\\alpha = 10^{-4}$，则样本通过此检验。此检验独立地对三个速度分量中的每一个以及速率进行。\n\n当且仅当所有七个条件同时满足时，给定的合成 MD 数据集才被视为通过整体验证：三个均值的 $z$ 分数检验和四个 K-S 检验（三个分量，一个速率）都必须在各自指定的阈值下通过。\n\n该实现根据问题规范生成合成速度数据，使用模拟温度 $T_{\\mathrm{sim}}$、漂移 $\\boldsymbol{\\mu}$ 和各向异性因子 $\\mathbf{a}$，而统计检验则是在温度 $T_{\\mathrm{theory}}$ 下针对理论模型进行的。这种设置允许测试验证程序对偏离理想平衡的常见情况的鲁棒性，例如温度不正确、系统整体运动或动能分布的各向异性。",
            "answer": "```python\nimport numpy as np\nfrom scipy import special, stats\n\ndef solve():\n    \"\"\"\n    Performs a statistically principled validation of synthetic MD velocity data.\n    \"\"\"\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n\n    test_cases = [\n        # Case 1: Happy path, isotropic, correct temperature\n        (20000, 6.63e-26, 120.0, 120.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 12345),\n        # Case 2: Mismatched temperature\n        (15000, 6.63e-26, 120.0, 150.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 2024),\n        # Case 3: Nonzero drift in one direction\n        (15000, 6.63e-26, 120.0, 120.0, 40.0, 0.0, 0.0, 1.0, 1.0, 1.0, 777),\n        # Case 4: Anisotropy in one direction\n        (15000, 6.63e-26, 120.0, 120.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.5, 314159),\n        # Case 5: High temperature, correct model, moderate sample size\n        (5000, 6.63e-26, 3000.0, 3000.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 424242),\n    ]\n\n    def cdf_vx(v, T, m):\n        \"\"\"\n        Theoretical CDF for a Cartesian velocity component.\n        \"\"\"\n        arg = v * np.sqrt(m / (2 * k_B * T))\n        return 0.5 * (1.0 + special.erf(arg))\n\n    def cdf_s(s, T, m):\n        \"\"\"\n        Theoretical CDF for the 3D speed (Maxwell-Boltzmann).\n        \"\"\"\n        # CDF is 0 for s  0\n        s_safe = np.maximum(s, 0)\n        \n        a = m / (2 * k_B * T)\n        sqrt_a = np.sqrt(a)\n        \n        term1 = special.erf(s_safe * sqrt_a)\n        term2 = np.sqrt(4 * a / np.pi) * s_safe * np.exp(-a * s_safe**2)\n        \n        return term1 - term2\n\n    results = []\n    alpha = 1e-4\n    z_threshold = 4.0\n\n    for case in test_cases:\n        N, m, T_theory, T_sim, mu_x, mu_y, mu_z, a_x, a_y, a_z, seed = case\n        \n        rng = np.random.default_rng(seed)\n\n        # Generate synthetic data\n        sigma_sim_base = np.sqrt(k_B * T_sim / m)\n        v_x = rng.normal(loc=mu_x, scale=a_x * sigma_sim_base, size=N)\n        v_y = rng.normal(loc=mu_y, scale=a_y * sigma_sim_base, size=N)\n        v_z = rng.normal(loc=mu_z, scale=a_z * sigma_sim_base, size=N)\n        speeds = np.sqrt(v_x**2 + v_y**2 + v_z**2)\n        \n        # --- Run Verification Tests ---\n        \n        all_checks_passed = True\n        \n        # 1. Mean verification (z-score tests)\n        sigma_theory = np.sqrt(k_B * T_theory / m)\n        std_err = sigma_theory / np.sqrt(N)\n        \n        if std_err == 0:  # Avoid division by zero\n            all_checks_passed = False\n        else:\n            for v_comp in [v_x, v_y, v_z]:\n                mean_v = np.mean(v_comp)\n                z_score = mean_v / std_err\n                if abs(z_score)  z_threshold:\n                    all_checks_passed = False\n                    break\n        \n        if not all_checks_passed:\n            results.append(False)\n            continue\n            \n        # 2. Distribution verification (K-S tests)\n        # Components\n        for v_comp in [v_x, v_y, v_z]:\n            ks_result = stats.kstest(v_comp, lambda v: cdf_vx(v, T_theory, m))\n            if ks_result.pvalue  alpha:\n                all_checks_passed = False\n                break\n        \n        if not all_checks_passed:\n            results.append(False)\n            continue\n        \n        # Speed\n        ks_result_speed = stats.kstest(speeds, lambda s: cdf_s(s, T_theory, m))\n        if ks_result_speed.pvalue  alpha:\n            all_checks_passed = False\n\n        results.append(all_checks_passed)\n        \n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\".replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "从理想气体模型转向真实材料时，我们常常会遇到各向异性的环境，此时粒子的动能由有效质量张量 $\\mathbf{m}$ 决定。本练习将麦克斯韦-玻尔兹曼框架推广到晶体中的准粒子，您将推导这种各向异性如何重塑速度分布，并探索能量均分定理的深刻结论——即平均动能仍然是 $\\frac{3}{2} k_B T$，即使在这种更复杂的情况下该定理依然成立 。这项实践对于在固态物理和半导体器件建模中准确应用统计力学至关重要。",
            "id": "3435458",
            "problem": "晶体中的单个无相互作用的准粒子的动能由一个各向异性的有效质量张量决定。在计算材料科学中，有效质量近似将准粒子速度建模为连续变量，将动能建模为由一个对称正定有效质量张量决定的二次型。考虑一个准粒子，其速度矢量为 $\\mathbf{v}\\in\\mathbb{R}^3$，有效质量张量为对称正定的 $\\mathbf{m}\\in\\mathbb{R}^{3\\times 3}$。其动能为 $H_{\\mathrm{kin}}(\\mathbf{v})=\\tfrac{1}{2}\\,\\mathbf{v}^\\top \\mathbf{m}\\,\\mathbf{v}$。在绝对温度为 $T$ 的热平衡状态下，正则系综根据玻尔兹曼因子给出微观态的概率密度。玻尔兹曼常数为 $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J/K}$。\n\n你的任务是：\n\n- 以正则系综和玻尔兹曼因子为基本出发点，推导能量为 $H_{\\mathrm{kin}}(\\mathbf{v})=\\tfrac{1}{2}\\,\\mathbf{v}^\\top \\mathbf{m}\\,\\mathbf{v}$ 的准粒子的平衡态速度空间概率密度 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$。通过计算相应的高斯积分来显式计算归一化常数。不假设各向同性。你必须从正则概率密度 $p(\\mathbf{v})\\propto\\exp(-\\beta H_{\\mathrm{kin}}(\\mathbf{v}))$（其中 $\\beta=1/(k_B T)$）出发，推导出获得 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$ 和速度空间配分函数 $Z_{\\mathbf{v}}(T,\\mathbf{m})$ 所需的所有步骤。\n- 根据你推导出的 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$，获得 $\\mathbf{v}$ 的协方差矩阵（即 $\\mathbb{E}[\\mathbf{v}\\,\\mathbf{v}^\\top]$）的闭式表达式，用 $k_B$、$T$ 和 $\\mathbf{m}$ 表示。\n- 将沿单位矢量 $\\mathbf{n}\\in\\mathbb{R}^3$ 的方向动能定义为 $E_{\\mathbf{n}}=\\tfrac{1}{2}\\,(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})\\,(\\mathbf{n}^\\top\\mathbf{v})^2$。推导其平均值 $\\mathbb{E}[E_{\\mathbf{n}}]$ 和方差 $\\mathrm{Var}(E_{\\mathbf{n}})$ 的闭式表达式，用 $k_B$、$T$、$\\mathbf{m}$ 和 $\\mathbf{n}$ 表示，不假设 $\\mathbf{n}$ 是 $\\mathbf{m}$ 的特征向量。\n- 在平衡分布 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$ 下，推导总动能 $E=\\tfrac{1}{2}\\,\\mathbf{v}^\\top\\mathbf{m}\\,\\mathbf{v}$ 的分布，并求出 $\\mathbb{E}[E]$ 和 $\\mathrm{Var}(E)$。解释这些结果是否依赖于 $\\mathbf{m}$ 的各向异性。\n\n然后，设计并实现一个模拟程序，从推导出的平衡分布中对 $\\mathbf{v}$ 进行采样，并针对给定的 $\\mathbf{m}$、$T$ 和 $\\mathbf{n}$ 估计 $E_{\\mathbf{n}}$ 的样本均值。使用以下参数值测试套件。所有质量单位必须是千克，所有温度单位必须是开尔文，所有能量单位必须是焦耳。当提供角度时，其单位为度。\n\n常数：\n- $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J/K}$。\n- 电子静止质量 $m_e=9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$。\n\n对于下方的每个测试用例，从 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$ 中生成 $N$ 个独立样本，计算 $E_{\\mathbf{n}}$ 的样本均值，并以小数（而非百分比）形式报告样本均值与你推导的 $E_{\\mathbf{n}}$ 理论平均值之间的绝对相对误差。\n\n测试套件：\n- 用例 1：$T=300\\,\\mathrm{K}$，$\\mathbf{m}=0.5\\,m_e\\,\\mathbf{I}_{3}$，$\\mathbf{n}=(1,0,0)$，$N=100000$。\n- 用例 2：$T=300\\,\\mathrm{K}$，$\\mathbf{m}=\\mathrm{diag}(0.2,1.0,0.5)\\,m_e$，$\\mathbf{n}=(0,0,1)$，$N=120000$。\n- 用例 3：$T=300\\,\\mathrm{K}$，$\\mathbf{m}=\\mathrm{diag}(0.2,1.0,0.5)\\,m_e$，$\\mathbf{n}=(1,1,0)/\\sqrt{2}$，$N=150000$。\n- 用例 4：$T=800\\,\\mathrm{K}$，$\\mathbf{m}=\\mathbf{R}(\\theta)\\,\\mathrm{diag}(0.1,1.5,0.3)\\,m_e\\,\\mathbf{R}(\\theta)^\\top$，其中 $\\mathbf{R}(\\theta)$ 是绕 $\\hat{\\mathbf{z}}$ 轴旋转 $\\theta=45$ 度的旋转矩阵，$\\mathbf{n}=(1,0,0)$，$N=180000$。旋转矩阵为\n$$\n\\mathbf{R}(\\theta)=\\begin{pmatrix}\n\\cos\\theta  -\\sin\\theta  0\\\\\n\\sin\\theta  \\cos\\theta  0\\\\\n0  0  1\n\\end{pmatrix}.\n$$\n- 用例 5：$T=100\\,\\mathrm{K}$，$\\mathbf{m}=\\mathrm{diag}(0.01,5.0,0.5)\\,m_e$，$\\mathbf{n}=(\\sqrt{3}/2,\\,1/2,\\,0)$，$N=150000$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是相应测试用例的绝对相对误差，格式化为浮点数。最终的数值输出是无单位的小数。",
            "solution": "该问题提法明确，具有科学依据，并为提供完整解法提供了所有必要信息。它包含一个理论推导部分，以及一个通过计算验证部分推导结果的部分。我们将首先进行所要求的推导，然后设计模拟。\n\n准粒子的动能由 $H_{\\mathrm{kin}}(\\mathbf{v})=\\tfrac{1}{2}\\,\\mathbf{v}^\\top \\mathbf{m}\\,\\mathbf{v}$ 给出，其中 $\\mathbf{v} \\in \\mathbb{R}^3$ 是速度，$\\mathbf{m} \\in \\mathbb{R}^{3\\times 3}$ 是对称正定有效质量张量。系统处于温度为 $T$ 的热平衡状态。玻尔兹曼常数为 $k_B$。我们定义 $\\beta = 1/(k_B T)$。\n\n### 1. 平衡态速度空间概率密度 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$ 的推导\n\n根据正则系综，具有速度 $\\mathbf{v}$ 的微观态的概率密度正比于玻尔兹曼因子：\n$$\np(\\mathbf{v}) \\propto \\exp(-\\beta H_{\\mathrm{kin}}(\\mathbf{v})) = \\exp\\left(-\\frac{\\beta}{2} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}\\right)\n$$\n这是关于 $\\mathbf{v}$ 的多元正态分布的核。一个均值为 $\\boldsymbol{\\mu}$、协方差矩阵为 $\\mathbf{\\Sigma}$ 的 $d$ 维多元正态分布的一般形式是：\n$$\nf(\\mathbf{x}) = \\frac{1}{\\sqrt{(2\\pi)^d \\det(\\mathbf{\\Sigma})}} \\exp\\left(-\\frac{1}{2} (\\mathbf{x}-\\boldsymbol{\\mu})^\\top \\mathbf{\\Sigma}^{-1} (\\mathbf{x}-\\boldsymbol{\\mu})\\right)\n$$\n在我们的情况中，二次型 $\\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}$ 表明分布中心在 $\\boldsymbol{\\mu}=\\mathbf{0}$。通过比较指数部分，我们有：\n$$\n\\frac{1}{2} \\mathbf{v}^\\top \\mathbf{\\Sigma}^{-1} \\mathbf{v} = \\frac{\\beta}{2} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}\n$$\n这意味着协方差矩阵的逆是 $\\mathbf{\\Sigma}^{-1} = \\beta \\mathbf{m}$。由于 $\\mathbf{m}$ 是正定的，它是可逆的。因此协方差矩阵是：\n$$\n\\mathbf{\\Sigma} = (\\beta \\mathbf{m})^{-1} = \\frac{1}{\\beta} \\mathbf{m}^{-1} = k_B T \\mathbf{m}^{-1}\n$$\n归一化常数是速度空间中的配分函数 $Z_{\\mathbf{v}}(T,\\mathbf{m})$，通过对未归一化的密度在所有可能的速度上积分得到：\n$$\nZ_{\\mathbf{v}}(T,\\mathbf{m}) = \\int_{\\mathbb{R}^3} \\exp\\left(-\\frac{\\beta}{2} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}\\right) d^3\\mathbf{v}\n$$\n这是一个标准的高斯积分。对于一般二次型 $\\frac{1}{2}\\mathbf{x}^\\top\\mathbf{A}\\mathbf{x}$，积分为 $\\sqrt{(2\\pi)^d \\det(\\mathbf{A}^{-1})}$。这里，$d=3$，二次型中的矩阵是 $\\beta\\mathbf{m}$。\n$$\nZ_{\\mathbf{v}}(T,\\mathbf{m}) = \\sqrt{(2\\pi)^3 \\det((\\beta\\mathbf{m})^{-1})} = \\sqrt{(2\\pi)^3 \\det(\\beta^{-1}\\mathbf{m}^{-1})}\n$$\n使用行列式的性质 $\\det(c\\mathbf{A}) = c^d \\det(\\mathbf{A})$：\n$$\nZ_{\\mathbf{v}}(T,\\mathbf{m}) = \\sqrt{(2\\pi)^3 (\\beta^{-1})^3 \\det(\\mathbf{m}^{-1})} = \\sqrt{(2\\pi)^3 (k_B T)^3 (\\det\\mathbf{m})^{-1}} = (2\\pi k_B T)^{3/2} (\\det\\mathbf{m})^{-1/2}\n$$\n归一化的概率密度函数即为 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m}) = \\frac{1}{Z_{\\mathbf{v}}} \\exp(-\\beta H_{\\mathrm{kin}}(\\mathbf{v}))$，也就是：\n$$\np(\\mathbf{v}\\,|\\,T,\\mathbf{m}) = \\frac{\\sqrt{\\det(\\mathbf{m})}}{(2\\pi k_B T)^{3/2}} \\exp\\left(-\\frac{1}{2k_B T} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}\\right)\n$$\n这表明 $\\mathbf{v}$ 服从一个三维多元正态分布，$\\mathbf{v} \\sim \\mathcal{N}(\\mathbf{0}, k_B T \\mathbf{m}^{-1})$。\n\n### 2. 协方差矩阵 $\\mathbb{E}[\\mathbf{v}\\,\\mathbf{v}^\\top]$ 的推导\n\n一个均值为 $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{v}]$ 的随机矢量 $\\mathbf{v}$ 的协方差矩阵定义为 $\\mathrm{Cov}(\\mathbf{v}) = \\mathbb{E}[(\\mathbf{v}-\\boldsymbol{\\mu})(\\mathbf{v}-\\boldsymbol{\\mu})^\\top]$。从推导出的分布 $p(\\mathbf{v}\\,|\\,T,\\mathbf{m})$，我们看到该分布为 $\\mathcal{N}(\\mathbf{0}, k_B T \\mathbf{m}^{-1})$。其均值为 $\\mathbb{E}[\\mathbf{v}]=\\mathbf{0}$。因此，协方差矩阵就是：\n$$\n\\mathbb{E}[\\mathbf{v}\\,\\mathbf{v}^\\top] = \\mathrm{Cov}(\\mathbf{v}) = \\mathbf{\\Sigma} = k_B T \\mathbf{m}^{-1}\n$$\n\n### 3. 方向动能 $E_{\\mathbf{n}}$ 的平均值和方差\n\n方向动能为 $E_{\\mathbf{n}}=\\tfrac{1}{2}\\,(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})\\,(\\mathbf{n}^\\top\\mathbf{v})^2$。其中 $c_{\\mathbf{n}} = \\frac{1}{2}(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})$ 是一个标量常数，代表 $\\mathbf{n}$ 方向有效质量的一半。\n$E_{\\mathbf{n}}$ 的平均值为：\n$$\n\\mathbb{E}[E_{\\mathbf{n}}] = \\mathbb{E}\\left[\\frac{1}{2}(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})\\,(\\mathbf{n}^\\top\\mathbf{v})^2\\right] = \\frac{1}{2}(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n}) \\mathbb{E}[(\\mathbf{n}^\\top\\mathbf{v})^2]\n$$\n期望项 $\\mathbb{E}[(\\mathbf{n}^\\top\\mathbf{v})^2]$ 可以展开为 $\\mathbb{E}[(\\mathbf{n}^\\top\\mathbf{v})(\\mathbf{v}^\\top\\mathbf{n})] = \\mathbb{E}[\\mathbf{n}^\\top(\\mathbf{v}\\mathbf{v}^\\top)\\mathbf{n}]$。利用期望的线性性质：\n$$\n\\mathbb{E}[(\\mathbf{n}^\\top\\mathbf{v})^2] = \\mathbf{n}^\\top \\mathbb{E}[\\mathbf{v}\\mathbf{v}^\\top] \\mathbf{n} = \\mathbf{n}^\\top (k_B T \\mathbf{m}^{-1}) \\mathbf{n} = k_B T (\\mathbf{n}^\\top \\mathbf{m}^{-1} \\mathbf{n})\n$$\n将此代回，我们得到平均方向动能：\n$$\n\\mathbb{E}[E_{\\mathbf{n}}] = \\frac{1}{2} k_B T (\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n}) (\\mathbf{n}^\\top \\mathbf{m}^{-1} \\mathbf{n})\n$$\n对于方差，我们首先注意到随机变量 $X = \\mathbf{n}^\\top\\mathbf{v}$ 是一个多元正态矢量各分量的线性组合，因此它本身也是一个正态随机变量。其均值为 $\\mathbb{E}[X] = \\mathbf{n}^\\top \\mathbb{E}[\\mathbf{v}] = 0$。其方差为 $\\sigma_X^2 = \\mathrm{Var}(X) = \\mathbb{E}[X^2] = k_B T (\\mathbf{n}^\\top \\mathbf{m}^{-1} \\mathbf{n})$。因此，$X \\sim \\mathcal{N}(0, \\sigma_X^2)$。\n我们需要计算 $\\mathrm{Var}(E_{\\mathbf{n}}) = \\mathrm{Var}(c_{\\mathbf{n}} X^2) = c_{\\mathbf{n}}^2 \\mathrm{Var}(X^2)$。\n一个零均值正态变量的平方的方差是 $\\mathrm{Var}(X^2) = \\mathbb{E}[X^4] - (\\mathbb{E}[X^2])^2$。对于 $X \\sim \\mathcal{N}(0, \\sigma_X^2)$，其矩为 $\\mathbb{E}[X^2] = \\sigma_X^2$ 和 $\\mathbb{E}[X^4] = 3(\\sigma_X^2)^2$。\n因此，$\\mathrm{Var}(X^2) = 3(\\sigma_X^2)^2 - (\\sigma_X^2)^2 = 2(\\sigma_X^2)^2$。\n方向动能的方差是：\n$$\n\\mathrm{Var}(E_{\\mathbf{n}}) = c_{\\mathbf{n}}^2 \\cdot 2(\\sigma_X^2)^2 = 2 \\left( \\frac{1}{2}(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n}) \\right)^2 (k_B T (\\mathbf{n}^\\top \\mathbf{m}^{-1} \\mathbf n))^2 = \\frac{1}{2} (k_B T)^2 (\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})^2 (\\mathbf{n}^\\top \\mathbf{m}^{-1} \\mathbf{n})^2\n$$\n\n### 4. 总动能 $E$ 的分布、平均值和方差\n\n总动能为 $E = H_{\\mathrm{kin}}(\\mathbf{v})=\\tfrac{1}{2}\\,\\mathbf{v}^\\top \\mathbf{m}\\,\\mathbf{v}$。\n为求其平均值，我们使用迹的性质 $\\mathbf{x}^\\top\\mathbf{A}\\mathbf{x} = \\mathrm{Tr}(\\mathbf{A}\\mathbf{x}\\mathbf{x}^\\top)$：\n$$\n\\mathbb{E}[E] = \\mathbb{E}\\left[\\frac{1}{2} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v}\\right] = \\frac{1}{2}\\mathbb{E}[\\mathrm{Tr}(\\mathbf{m}\\mathbf{v}\\mathbf{v}^\\top)] = \\frac{1}{2}\\mathrm{Tr}(\\mathbb{E}[\\mathbf{m}\\mathbf{v}\\mathbf{v}^\\top])\n$$\n$$\n\\mathbb{E}[E] = \\frac{1}{2}\\mathrm{Tr}(\\mathbf{m}\\mathbb{E}[\\mathbf{v}\\mathbf{v}^\\top]) = \\frac{1}{2}\\mathrm{Tr}(\\mathbf{m}(k_B T \\mathbf{m}^{-1})) = \\frac{1}{2} k_B T \\mathrm{Tr}(\\mathbf{m}\\mathbf{m}^{-1}) = \\frac{1}{2} k_B T \\mathrm{Tr}(\\mathbf{I}_3)\n$$\n由于 $\\mathrm{Tr}(\\mathbf{I}_3) = 3$，平均总动能为：\n$$\n\\mathbb{E}[E] = \\frac{3}{2} k_B T\n$$\n为了找到 $E$ 的分布，我们进行变量替换。令 $\\mathbf{m}^{1/2}$ 为 $\\mathbf{m}$ 的唯一对称正定平方根。令 $\\mathbf{u} = \\sqrt{\\beta} \\mathbf{m}^{1/2} \\mathbf{v}$。$p(\\mathbf{v})$ 中的指数部分变为：\n$$\n-\\frac{\\beta}{2} \\mathbf{v}^\\top \\mathbf{m} \\mathbf{v} = -\\frac{1}{2} (\\sqrt{\\beta}\\mathbf{m}^{1/2}\\mathbf{v})^\\top (\\sqrt{\\beta}\\mathbf{m}^{1/2}\\mathbf{v}) = -\\frac{1}{2} \\mathbf{u}^\\top\\mathbf{u} = -\\frac{1}{2} \\sum_{i=1}^3 u_i^2\n$$\n从 $\\mathbf{u} \\to \\mathbf{v}$ 变换的雅可比行列式是 $| \\det((\\sqrt{\\beta}\\mathbf{m}^{1/2})^{-1}) | = (\\beta)^{-3/2} (\\det \\mathbf{m})^{-1/2}$。$\\mathbf{u}$ 的概率密度是 $p(\\mathbf{u}) = p(\\mathbf{v}(\\mathbf{u})) |J|$，可以简化为 $p(\\mathbf{u}) = (2\\pi)^{-3/2} \\exp(-\\frac{1}{2}\\mathbf{u}^\\top\\mathbf{u})$。这表明分量 $u_1, u_2, u_3$ 是独立的标准正态随机变量，$u_i \\sim \\mathcal{N}(0, 1)$。\n总能量 $E$ 可以用 $\\mathbf{u}$ 表示：\n$$\nE = \\frac{1}{2\\beta} (\\mathbf{u}^\\top \\mathbf{u}) = \\frac{1}{2} k_B T (u_1^2 + u_2^2 + u_3^2)\n$$\n$d$ 个独立标准正态变量的平方和服从自由度为 $d$ 的卡方分布，即 $\\chi_d^2$。这里，$\\sum u_i^2 \\sim \\chi_3^2$。$E$ 的分布是一个常数 $\\frac{1}{2}k_B T$ 乘以一个 $\\chi_3^2$ 随机变量的分布。$E$ 的概率密度函数是一个伽马分布，具体为：\n$$\np(E) = \\frac{2\\sqrt{E}}{\\sqrt{\\pi}(k_B T)^{3/2}} \\exp\\left(-\\frac{E}{k_B T}\\right) \\quad \\text{for } E \\ge 0\n$$\n$E$ 的方差是：\n$$\n\\mathrm{Var}(E) = \\mathrm{Var}\\left(\\frac{1}{2} k_B T \\chi_3^2\\right) = \\left(\\frac{1}{2} k_B T\\right)^2 \\mathrm{Var}(\\chi_3^2)\n$$\n一个 $\\chi_d^2$ 分布的方差是 $2d$。对于 $d=3$，$\\mathrm{Var}(\\chi_3^2) = 6$。\n$$\n\\mathrm{Var}(E) = \\frac{1}{4}(k_B T)^2 \\cdot 6 = \\frac{3}{2}(k_B T)^2\n$$\n平均值 $\\mathbb{E}[E]$、方差 $\\mathrm{Var}(E)$ 以及 $E$ 的整个分布，都只依赖于温度 $T$ 和空间维度（$d=3$）。它们与有效质量张量 $\\mathbf{m}$ 的具体形式（各向异性）无关。\n\n### 模拟设计\n\n该模拟将通过对大量样本求平均来估计 $\\mathbb{E}[E_{\\mathbf{n}}]$，并将其与理论值进行比较。\n1.  **生成样本**：从其分布 $\\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma})$（其中 $\\mathbf{\\Sigma} = k_B T \\mathbf{m}^{-1}$）中对速度矢量 $\\mathbf{v}$ 进行采样。\n    - 生成一个由3个独立的标准正态随机变量组成的矢量 $\\mathbf{z}$。\n    - 计算协方差矩阵的 Cholesky 分解：$\\mathbf{\\Sigma} = \\mathbf{L}\\mathbf{L}^\\top$。\n    - 通过线性变换 $\\mathbf{v} = \\mathbf{L}\\mathbf{z}$ 获得一个 $\\mathbf{v}$ 的样本。\n2.  **计算样本均值**：对于每个样本 $\\mathbf{v}_i$，计算 $E_{\\mathbf{n},i} = \\frac{1}{2}(\\mathbf{n}^\\top\\mathbf{m}\\,\\mathbf{n})\\,(\\mathbf{n}^\\top\\mathbf{v}_i)^2$。样本均值为 $\\bar{E}_{\\mathbf{n}} = \\frac{1}{N}\\sum_{i=1}^N E_{\\mathbf{n},i}$。\n3.  **计算误差**：计算绝对相对误差 $|\\bar{E}_{\\mathbf{n}} - \\mathbb{E}[E_{\\mathbf{n}}]| / |\\mathbb{E}[E_{\\mathbf{n}}]|$, 其中 $\\mathbb{E}[E_{\\mathbf{n}}]$ 是上面推导出的闭式表达式。\n将对每个测试用例实施此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute relative error between the theoretical mean and\n    the sample mean of the directional kinetic energy for a quasiparticle.\n    \"\"\"\n    # Define constants\n    K_B = 1.380649e-23  # J/K\n    M_E = 9.1093837015e-31  # kg\n\n    # Define the rotation matrix function\n    def get_rotation_matrix(theta_deg):\n        theta_rad = np.deg2rad(theta_deg)\n        c, s = np.cos(theta_rad), np.sin(theta_rad)\n        return np.array([[c, -s, 0], [s, c, 0], [0, 0, 1]])\n\n    # Test suite of parameters\n    test_cases = [\n        {\n            \"T\": 300.0,\n            \"m\": 0.5 * M_E * np.identity(3),\n            \"n\": np.array([1.0, 0.0, 0.0]),\n            \"N\": 100000,\n        },\n        {\n            \"T\": 300.0,\n            \"m\": np.diag([0.2, 1.0, 0.5]) * M_E,\n            \"n\": np.array([0.0, 0.0, 1.0]),\n            \"N\": 120000,\n        },\n        {\n            \"T\": 300.0,\n            \"m\": np.diag([0.2, 1.0, 0.5]) * M_E,\n            \"n\": np.array([1.0, 1.0, 0.0]) / np.sqrt(2.0),\n            \"N\": 150000,\n        },\n        {\n            \"T\": 800.0,\n            \"m\": get_rotation_matrix(45) @ np.diag([0.1, 1.5, 0.3]) @ get_rotation_matrix(45).T * M_E,\n            \"n\": np.array([1.0, 0.0, 0.0]),\n            \"N\": 180000,\n        },\n        {\n            \"T\": 100.0,\n            \"m\": np.diag([0.01, 5.0, 0.5]) * M_E,\n            \"n\": np.array([np.sqrt(3.0) / 2.0, 1.0 / 2.0, 0.0]),\n            \"N\": 150000,\n        },\n    ]\n\n    results = []\n    # Use a fixed seed for reproducibility.\n    rng = np.random.default_rng(seed=42)\n\n    for case in test_cases:\n        T = case[\"T\"]\n        m = case[\"m\"]\n        n = case[\"n\"]\n        N = case[\"N\"]\n\n        # 1. Calculate theoretical mean of directional kinetic energy\n        m_inv = np.linalg.inv(m)\n        term_m = n.T @ m @ n\n        term_m_inv = n.T @ m_inv @ n\n        E_n_mean_theory = 0.5 * K_B * T * term_m * term_m_inv\n\n        # 2. Set up the sampling procedure\n        # Covariance matrix of velocity: Sigma = k_B * T * m^-1\n        Sigma = K_B * T * m_inv\n        \n        # Cholesky decomposition: Sigma = L * L.T\n        # We sample v = L @ z, where z ~ N(0, I)\n        # Using numpy, if Z is (N,3) with z_i in rows, then V = Z @ L.T\n        try:\n            L = np.linalg.cholesky(Sigma)\n        except np.linalg.LinAlgError:\n            # Fallback for matrices that might have precision issues\n            # For a symmetric matrix, eigendecomposition Sigma = Q*D*Q.T\n            # L can be Q*sqrt(D)\n            eigvals, eigvecs = np.linalg.eigh(Sigma)\n            if np.any(eigvals  0): # Should not happen for SPD matrices\n                raise ValueError(\"Covariance matrix is not positive semi-definite.\")\n            L = eigvecs @ np.diag(np.sqrt(eigvals))\n\n        # 3. Generate N samples of v\n        # Z contains N samples of 3D standard normal vectors (row-wise)\n        Z = rng.standard_normal(size=(N, 3))\n        # Transform to samples from N(0, Sigma)\n        # v_row^T = z_row^T @ L^T, so V = Z @ L.T\n        V = Z @ L.T\n\n        # 4. Calculate sample mean of directional kinetic energy\n        # Directional effective mass scalar\n        m_n_eff = term_m\n        \n        # Velocity component along n for all samples\n        v_n = V @ n  # (N, 3) @ (3,) - (N,)\n        \n        # Directional kinetic energy for each sample\n        E_n_samples = 0.5 * m_n_eff * v_n**2\n        \n        # Sample mean\n        E_n_mean_sample = np.mean(E_n_samples)\n\n        # 5. Compute absolute relative error\n        # Avoid division by zero if theoretical mean is zero, although not expected here.\n        if E_n_mean_theory == 0:\n            error = np.abs(E_n_mean_sample)\n        else:\n            error = np.abs(E_n_mean_sample - E_n_mean_theory) / np.abs(E_n_mean_theory)\n        \n        results.append(error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "统计力学的力量在于它能够将微观涨落与宏观现象联系起来。本练习旨在弥合平衡态的麦克斯韦-玻尔兹曼能量分布与化学反应这一非平衡过程之间的鸿沟。您将亲眼见证 Arrhenius 定律 $k(T) = A \\exp(-E_a / k_B T)$ 是如何从一个基本事实中涌现的：只有处于分布高能尾部的粒子才拥有足够的能量来逾越反应能垒 $E_a$ 。这个练习揭示了化学动力学的统计力学基础。",
            "id": "3435493",
            "problem": "模拟一种在三维空间中由点状粒子组成的单组分气体，以在计算材料科学的背景下研究其反应动力学和碰撞能量学。反应由 Arrhenius 定律建模，碰撞能量假定遵循由 Boltzmann 统计得出的 Maxwell-Boltzmann (MB) 分布。你的任务是推导、实现并测试一个程序，该程序为每个测试用例估算活化能，并将其与碰撞能量分布的高能尾部联系起来。\n\n使用的基本原理和假设：\n- 在绝对温度 $T$ 下，能量为 $E$ 的微观状态的 Boltzmann 因子正比于 $\\exp(-E / k_{\\mathrm{B}} T)$，其中 $k_{\\mathrm{B}}$ 是 Boltzmann 常数。\n- 在无相互作用粒子和热平衡的假设下，三维空间中的 Maxwell-Boltzmann 速率分布是经典统计力学一个经过充分检验的推论。\n- 反应速率的 Arrhenius 形式为 $k(T) = A \\exp(-E_a / k_{\\mathrm{B}} T)$，其中 $A$ 是指前因子，$E_a$ 是活化能。\n\n程序要求：\n1. 给定几个温度下的速率常数，通过求解与 Arrhenius 模型一致的最小二乘问题来估算活化能 $E_a$（以电子伏特为单位）。具体来说，将 $\\ln k(T)$ 视为 $1/T$ 的线性函数，并找出最佳拟合的斜率和截距，以推断 $E_a$ 和 $A$。每个测试用例只报告以电子伏特为单位的 $E_a$。\n2. 对于每个测试用例中选定的观测温度 $T_{\\mathrm{obs}}$，从三维速率分布所蕴含的 MB 能量分布中抽取生成合成碰撞能量。从第一性原理出发，通过变量变换推导并实现从速率分布得到的能量概率密度函数 $f_E(E)$，然后通过将 $f_E(E)$ 从 $E_a$ 积分到无穷大，计算能量等于或高于估算活化能 $E_a$ 的碰撞的理论分数。同时，计算生成的能量中等于或高于 $E_a$ 的样本分数。每个测试用例报告理论分数与样本分数之间的绝对差值（浮点数）。\n3. 使用在 $T_{\\mathrm{obs}}$ 下相同的合成能量，量化经验高能尾部是否与 MB 尾部一致。在尾部区域 $E \\ge \\alpha k_{\\mathrm{B}} T_{\\mathrm{obs}}$（其中 $\\alpha = 2$）上，对 $\\ln(\\text{pdf}(E))$ 与 $E$ 的关系进行直线拟合。将拟合得到的斜率与理论值 $-1/(k_{\\mathrm{B}} T_{\\mathrm{obs}})$ 进行比较，并报告一个布尔值，指示其绝对相对偏差是否最多为 $0.05$。\n\n物理常数和单位：\n- 使用 $k_{\\mathrm{B}} = 8.617333262145 \\times 10^{-5} \\ \\mathrm{eV/K}$。\n- 温度必须以 $\\mathrm{K}$ 为单位处理。\n- 反应速率常数 $k(T)$ 的单位是 $\\mathrm{s}^{-1}$。\n- 活化能 $E_a$ 必须以电子伏特（$\\mathrm{eV}$）报告。\n- 能量必须以电子伏特（$\\mathrm{eV}$）处理。\n- 不涉及角度；无需角度单位。\n\n随机性与可复现性：\n- 每个测试用例使用带有固定种子的伪随机数生成器，以确保确定性输出。\n- 通过将精确的 Arrhenius 值与一个对数正态噪声因子相乘来生成合成速率常数，该噪声因子的自然对数标准差已为每个测试用例指定。\n- 通过从三维速率分布推导出的 MB 能量分布中采样，在 $T_{\\mathrm{obs}}$ 下生成碰撞能量；在三维空间中，能量分布对应于形状参数为 $3/2$、尺度参数为 $k_{\\mathrm{B}} T$ 的 Gamma 分布。\n\n测试套件：\n- 案例 1：$A = 1.0 \\times 10^{13} \\ \\mathrm{s}^{-1}$，$E_a = 0.80 \\ \\mathrm{eV}$，温度 $[300, 500, 700, 900] \\ \\mathrm{K}$，对数正态噪声标准差 $0.05$，观测温度索引为 2（即 $T_{\\mathrm{obs}} = 700 \\ \\mathrm{K}$），能量样本大小 $N = 200000$，随机种子 $12345$。\n- 案例 2：$A = 5.0 \\times 10^{12} \\ \\mathrm{s}^{-1}$，$E_a = 1.00 \\ \\mathrm{eV}$，温度 $[1200, 1600, 2000, 2400] \\ \\mathrm{K}$，对数正态噪声标准差 $0.03$，观测温度索引为 2（即 $T_{\\mathrm{obs}} = 2000 \\ \\mathrm{K}$），能量样本大小 $N = 300000$，随机种子 $23456$。\n- 案例 3：$A = 2.0 \\times 10^{13} \\ \\mathrm{s}^{-1}$，$E_a = 1.50 \\ \\mathrm{eV}$，温度 $[250, 275, 300, 325] \\ \\mathrm{K}$，对数正态噪声标准差 $0.04$，观测温度索引为 2（即 $T_{\\mathrm{obs}} = 300 \\ \\mathrm{K}$），能量样本大小 $N = 500000$，随机种子 $34567$。\n\n算法规格：\n- 对于 Arrhenius 拟合，求解线性模型 $\\ln k(T) = b + m \\cdot (1/T)$ 的最小二乘问题，然后通过 $E_a = - m \\, k_{\\mathrm{B}}$ 和 $A = \\exp(b)$ 推断 $E_a$。\n- 对于能量尾部分析，从 MB 速率分布推导 $f_E(E)$，不得使用问题陈述中任何未经论证的快捷公式；以数值方式实现积分，或使用您解决方案中推导得出的闭合形式表达式。计算并报告理论与经验尾部分数之间的绝对差。\n- 对于尾部斜率一致性检查，构建一个基于直方图的概率密度函数估计，将其限制在 $E \\ge \\alpha k_{\\mathrm{B}} T_{\\mathrm{obs}}$（其中 $\\alpha = 2$）的范围内，对 $\\ln(\\text{pdf}(E))$ 与 $E$ 的关系进行线性拟合，并将斜率与 $-1/(k_{\\mathrm{B}} T_{\\mathrm{obs}})$ 进行比较，绝对相对偏差容差为 $0.05$。直方图至少使用 $400$ 个箱。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。按顺序为每个测试用例输出三项内容：以电子伏特为单位的估算活化能（浮点数）、理论与样本尾部分数之间的绝对差（浮点数），以及用于尾部斜率一致性检查的布尔值。因此，最终输出总共应有 $9$ 个项目，例如 $\\left[ e_1, d_1, b_1, e_2, d_2, b_2, e_3, d_3, b_3 \\right]$。\n\n不允许用户输入或外部文件；所有计算必须在程序内部使用指定的测试套件值执行。",
            "solution": "评估认为用户提供的问题是有效的。它在科学上基于统计力学和化学动力学，问题设定良好，提供了所有必要的数据和约束条件，并且其表述是客观的。该问题构成了计算材料科学中一个标准的、尽管是多方面的练习。我们现在着手提供一个完整的、有理有据的解决方案。\n\n解决方案分为三个部分，对应问题陈述所要求的三个任务。\n\n### 第 1 部分：通过 Arrhenius 分析估算活化能\n\nArrhenius 方程描述了反应速率常数 $k(T)$ 对温度的依赖性：\n$$ k(T) = A \\exp\\left(-\\frac{E_a}{k_{\\mathrm{B}} T}\\right) $$\n其中 $A$ 是指前因子，$E_a$ 是活化能，$k_{\\mathrm{B}}$ 是 Boltzmann 常数，$T$ 是绝对温度。为了从一组测量值 $(T_i, k_i)$ 中估算 $E_a$ 和 $A$，我们通过对两边取自然对数来线性化该方程：\n$$ \\ln k(T) = \\ln A - \\frac{E_a}{k_{\\mathrm{B}}} \\frac{1}{T} $$\n该方程具有线性形式 $y = b + m x$，其中：\n- $y = \\ln k(T)$\n- $x = 1/T$\n- 截距为 $b = \\ln A$\n- 斜率为 $m = -E_a / k_{\\mathrm{B}}$\n\n给定在不同温度下测得的一组包含 $N$ 个数据点的速率常数 $\\{ (T_i, k_i) \\}_{i=1}^N$，我们可以将其转换为一组线性数据点 $\\{ (x_i, y_i) \\}_{i=1}^N = \\{ (1/T_i, \\ln k_i) \\}_{i=1}^N$。任务是找到穿过这些点的最佳拟合直线。这通过求解一个线性最小二乘问题来实现，该问题旨在最小化观测值 $y_i$ 与线性模型预测值之间的平方差之和，即 $\\sum_{i=1}^N (y_i - (b + m x_i))^2$。\n\n最优斜率 $m$ 和截距 $b$ 由线性回归的正规方程给出。斜率 $m$ 的计算公式如下：\n$$ m = \\frac{N \\sum(x_i y_i) - (\\sum x_i)(\\sum y_i)}{N \\sum(x_i^2) - (\\sum x_i)^2} $$\n一旦确定了斜率 $m$，就可以直接从其与斜率的关系中推断出活化能 $E_a$：\n$$ E_a = -m \\cdot k_{\\mathrm{B}} $$\n问题要求通过向精确的 Arrhenius 值引入对数正态噪声来生成合成速率常数数据。如果 $k_{\\text{exact}}(T)$ 是真实速率，则带噪声的数据 $k(T)$ 生成为 $k(T) = k_{\\text{exact}}(T) \\cdot \\exp(Z)$，其中 $Z$ 是一个来自均值为 $0$、标准差为指定值 $\\sigma$ 的正态分布的随机变量。取对数后得到 $\\ln k(T) = \\ln k_{\\text{exact}}(T) + Z$，这在 $\\ln k$ 对 $1/T$ 的图中正确地模拟了加性高斯噪声。\n\n### 第 2 部分：Maxwell-Boltzmann 能量分布与尾部分数\n\n这部分要求推导粒子动能的概率密度函数 (PDF) $f_E(E)$，并用它来比较理论尾部分数和样本尾部分数。\n\n**能量概率密度函数 $f_E(E)$ 的推导**\n\n三维空间中粒子的 Maxwell-Boltzmann 速率分布由下式给出：\n$$ f_v(v) = 4\\pi \\left(\\frac{m_p}{2\\pi k_{\\mathrm{B}} T}\\right)^{3/2} v^2 \\exp\\left(-\\frac{m_p v^2}{2 k_{\\mathrm{B}} T}\\right) $$\n其中 $v$ 是粒子速率，$m_p$ 是粒子质量。粒子的动能为 $E = \\frac{1}{2}m_p v^2$。为了找到能量的概率密度函数 $f_E(E)$，我们进行变量变换。\n\n首先，用 $E$ 表示 $v$：$v = \\sqrt{2E/m_p}$。概率密度函数的变换法则是 $f_E(E) = f_v(v(E)) \\left|\\frac{dv}{dE}\\right|$。我们计算雅可比行列式（在此情况下，即一个简单的导数）：\n$$ \\frac{dv}{dE} = \\frac{d}{dE}\\left(\\sqrt{\\frac{2E}{m_p}}\\right) = \\sqrt{\\frac{2}{m_p}} \\cdot \\frac{1}{2}E^{-1/2} = \\frac{1}{\\sqrt{2m_p E}} $$\n将 $v(E)$ 和 $dv/dE$ 代入变换法则：\n$$ f_E(E) = \\left[ 4\\pi \\left(\\frac{m_p}{2\\pi k_{\\mathrm{B}} T}\\right)^{3/2} \\left(\\frac{2E}{m_p}\\right) \\exp\\left(-\\frac{E}{k_{\\mathrm{B}} T}\\right) \\right] \\cdot \\left| \\frac{1}{\\sqrt{2m_p E}} \\right| $$\n化简各项：\n$$ f_E(E) = 4\\pi \\frac{m_p^{3/2}}{(2\\pi)^{3/2} (k_{\\mathrm{B}} T)^{3/2}} \\frac{2E}{m_p} \\frac{1}{\\sqrt{2m_p E}} \\exp\\left(-\\frac{E}{k_{\\mathrm{B}} T}\\right) $$\n$$ f_E(E) = \\frac{4\\pi}{2\\sqrt{2}\\pi^{3/2}} \\frac{1}{(k_{\\mathrm{B}} T)^{3/2}} \\frac{2E}{\\sqrt{2}E^{1/2}} \\exp\\left(-\\frac{E}{k_{\\mathrm{B}} T}\\right) $$\n$$ f_E(E) = \\frac{2}{\\sqrt{\\pi}(k_{\\mathrm{B}} T)^{3/2}} E^{1/2} \\exp\\left(-\\frac{E}{k_{\\mathrm{B}} T}\\right) $$\n这就是 $E \\ge 0$ 的 Maxwell-Boltzmann 能量分布概率密度函数。如问题陈述中所述，该分布是一个形状参数为 $k = 3/2$、尺度参数为 $\\theta = k_{\\mathrm{B}} T$ 的 Gamma 分布。不合时宜的粒子质量 $m_p$ 被消去，这证明了经典统计力学中能量分布形式的普适性。\n\n**尾部分数计算**\n\n能量等于或高于活化能 $E_a$ 的粒子的理论分数是概率密度函数从 $E_a$到无穷大的积分：\n$$ F_{\\text{theo}} = \\int_{E_a}^{\\infty} f_E(E) dE = \\int_{E_a}^{\\infty} \\frac{2}{\\sqrt{\\pi}(k_{\\mathrm{B}} T)^{3/2}} E^{1/2} \\exp\\left(-\\frac{E}{k_{\\mathrm{B}} T}\\right) dE $$\n该积分是 Gamma 分布的互补累积分布函数 (CCDF)，可以用上不完全伽马函数 $\\Gamma(s,x) = \\int_x^\\infty t^{s-1}e^{-t}dt$ 来表示。该分数值由 $\\frac{\\Gamma(3/2, E_a/(k_{\\mathrm{B}}T))}{\\Gamma(3/2)}$ 给出。此值使用标准科学库计算。\n\n样本分数 $F_{\\text{sample}}$ 是根据从 Gamma($k=3/2, \\theta=k_{\\mathrm{B}}T_{\\text{obs}}$) 分布中抽取的 $N$ 个合成能量 $\\{E_i\\}_{i=1}^N$ 集合凭经验确定的。它是能量 $E_i \\ge E_a$ 的样本数与总样本数 $N$ 的比值。\n然后报告绝对差 $|F_{\\text{theo}} - F_{\\text{sample}}|$。\n\n### 第 3 部分：高能尾部一致性检查\n\n最后的任务是验证经验生成的分布的高能尾部是否与理论上的 Maxwell-Boltzmann 形式一致。理论概率密度函数是 $f_E(E) = C E^{1/2} \\exp(-E/k_{\\mathrm{B}}T)$，其中 $C$ 是一个归一化常数。对于高能量 ($E \\gg k_{\\mathrm{B}}T$)，指数项 $\\exp(-E/k_{\\mathrm{B}}T)$ 的行为主导了该函数，超过了变化缓慢得多的 $E^{1/2}$ 项。取自然对数：\n$$ \\ln f_E(E) = \\ln C + \\frac{1}{2}\\ln E - \\frac{E}{k_{\\mathrm{B}}T} $$\n对于大的 $E$，当绘制 $\\ln f_E(E)$ 关于 $E$ 的图时，这种关系近似是线性的，其斜率接近 $-1/(k_{\\mathrm{B}}T)$。\n$$ \\frac{d}{dE} \\ln f_E(E) = \\frac{1}{2E} - \\frac{1}{k_{\\mathrm{B}}T} \\approx -\\frac{1}{k_{\\mathrm{B}}T} \\quad \\text{for } E \\gg k_{\\mathrm{B}}T $$\n指定的算法是：\n1.  通过为 $N$ 个采样能量创建直方图来生成经验概率密度函数。每个箱中概率密度函数的值估计为该箱中的计数除以总样本大小 $N$ 和箱宽的乘积。\n2.  分离出分布的“尾部”区域，定义为能量 $E \\ge \\alpha k_{\\mathrm{B}} T_{\\mathrm{obs}}$，其中 $\\alpha=2$。\n3.  对所有中心 $E_i$ 位于尾部区域且计数不为零的直方图箱 $i$ 的数据点 $(E_i, \\ln(\\text{pdf}_i))$ 进行线性最小二乘拟合。\n4.  设拟合斜率为 $m_{\\text{fit}}$。理论斜率为 $m_{\\text{theo}} = -1/(k_{\\mathrm{B}} T_{\\mathrm{obs}})$。\n5.  如果绝对相对偏差在 $5\\%$ 的容差范围内，则确认一致性：\n    $$ \\left| \\frac{m_{\\text{fit}} - m_{\\text{theo}}}{m_{\\text{theo}}} \\right| \\le 0.05 $$\n此过程提供了一个定量检查，以确定生成的随机数据是否正确再现了 Maxwell-Boltzmann 分布高能尾部中预期的指数衰减。\n\n实现将对每个提供的测试用例遵循这些步骤，并将所需的三个输出（$E_a$、尾部分数差和尾部斜率一致性布尔值）整理成一个最终的列表。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import gammaincc\n\ndef solve():\n    \"\"\"\n    Solves the computational materials science problem for all test cases.\n    \"\"\"\n    # Physical constant\n    KB_EV_K = 8.617333262145e-5  # Boltzmann constant in eV/K\n\n    test_cases = [\n        {\n            \"A\": 1.0e13, \"Ea_true\": 0.80, \"temps_K\": [300, 500, 700, 900],\n            \"lognorm_std\": 0.05, \"T_obs_idx\": 2, \"N_samples\": 200000, \"seed\": 12345\n        },\n        {\n            \"A\": 5.0e12, \"Ea_true\": 1.00, \"temps_K\": [1200, 1600, 2000, 2400],\n            \"lognorm_std\": 0.03, \"T_obs_idx\": 2, \"N_samples\": 300000, \"seed\": 23456\n        },\n        {\n            \"A\": 2.0e13, \"Ea_true\": 1.50, \"temps_K\": [250, 275, 300, 325],\n            \"lognorm_std\": 0.04, \"T_obs_idx\": 2, \"N_samples\": 500000, \"seed\": 34567\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        A = case[\"A\"]\n        Ea_true = case[\"Ea_true\"]\n        temps_K = np.array(case[\"temps_K\"])\n        lognorm_std = case[\"lognorm_std\"]\n        T_obs_idx = case[\"T_obs_idx\"]\n        N_samples = case[\"N_samples\"]\n        seed = case[\"seed\"]\n\n        rng = np.random.default_rng(seed)\n\n        # Generate synthetic rate constant data with lognormal noise\n        k_exact = A * np.exp(-Ea_true / (KB_EV_K * temps_K))\n        noise = rng.normal(0, lognorm_std, size=len(temps_K))\n        k_noisy = k_exact * np.exp(noise)\n\n        # Part 1: Estimate Activation Energy\n        inv_T = 1.0 / temps_K\n        log_k = np.log(k_noisy)\n        \n        # design matrix for least squares: y = m*x + c\n        A_matrix = np.vstack([inv_T, np.ones(len(inv_T))]).T\n        m, c = np.linalg.lstsq(A_matrix, log_k, rcond=None)[0]\n        \n        # Ea = -slope * k_B\n        est_Ea = -m * KB_EV_K\n        results.append(est_Ea)\n\n        # Part 2: Tail Fraction Analysis\n        T_obs = temps_K[T_obs_idx]\n        \n        # Generate energy samples from Gamma distribution\n        # Shape k=3/2, Scale theta=k_B*T\n        shape = 1.5\n        scale = KB_EV_K * T_obs\n        energy_samples = rng.gamma(shape, scale, size=N_samples)\n        \n        # Theoretical fraction of energies = Ea\n        # This is the survival function (1 - CDF) of the Gamma distribution\n        # which is the regularized upper incomplete gamma function Q(k, x)\n        # scipy.special.gammaincc(k, x) computes Q(k, x)\n        arg_gamma = est_Ea / scale\n        theoretical_fraction = gammaincc(shape, arg_gamma)\n        \n        # Sample fraction of energies = Ea\n        sample_fraction = np.sum(energy_samples = est_Ea) / N_samples\n        \n        abs_diff_fraction = abs(theoretical_fraction - sample_fraction)\n        results.append(abs_diff_fraction)\n        \n        # Part 3: Tail Slope Consistency Check\n        # Histogram-based PDF\n        num_bins = 400\n        counts, bin_edges = np.histogram(energy_samples, bins=num_bins)\n        bin_width = bin_edges[1] - bin_edges[0]\n        bin_centers = (bin_edges[:-1] + bin_edges[1:]) / 2.0\n        \n        # Avoid division by zero for bin_width=0, though unlikely with fixed num_bins\n        pdf = counts / (N_samples * bin_width) if bin_width  0 else np.zeros_like(counts)\n\n        # Select tail region E = alpha * k_B * T_obs with alpha = 2\n        tail_threshold = 2.0 * KB_EV_K * T_obs\n        \n        # Filter for tail bins with non-zero counts to avoid log(0)\n        tail_mask = (bin_centers = tail_threshold)  (pdf  0)\n        \n        E_tail = bin_centers[tail_mask]\n        log_pdf_tail = np.log(pdf[tail_mask])\n        \n        is_consistent = False\n        # Need at least 2 points for a linear fit\n        if len(E_tail) = 2:\n            # Fit line to ln(pdf) vs E\n            fit_slope, _ = np.polyfit(E_tail, log_pdf_tail, 1)\n            \n            # Theoretical slope\n            theoretical_slope = -1.0 / (KB_EV_K * T_obs)\n            \n            # Check absolute relative deviation\n            abs_rel_dev = abs((fit_slope - theoretical_slope) / theoretical_slope)\n            \n            if abs_rel_dev = 0.05:\n                is_consistent = True\n\n        results.append(is_consistent)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}