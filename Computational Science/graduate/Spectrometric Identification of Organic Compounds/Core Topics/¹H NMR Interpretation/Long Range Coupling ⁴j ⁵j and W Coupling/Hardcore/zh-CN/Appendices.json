{
    "hands_on_practices": [
        {
            "introduction": "在核磁共振波谱中，观测微弱的远程耦合信号对实验参数的精确设置提出了很高的要求。异核多键相关谱（HMBC）是鉴定这些耦合的关键技术，其实验效果在很大程度上取决于演化延迟时间 $\\Delta$ 的选择。本练习将引导你从自旋哈密顿量的第一性原理出发，推导在理想条件下最大化远程 $^{n}J_{\\mathrm{CH}}$ 耦合信号的最佳延迟时间，并进一步探讨在真实实验中横向弛豫（$T_2$）如何影响这一优化选择，从而深化你对脉冲序列设计的理解。",
            "id": "3711066",
            "problem": "一位化学家正在对一个有机分子进行异核多键相关（Heteronuclear Multiple Bond Correlation, HMBC）核磁共振（Nuclear Magnetic Resonance, NMR）分析，该分子疑似表现出由 W-耦合路径介导的五键氢-碳连通性。HMBC 信号转移依赖于质子自旋（用自旋算符 $\\mathbf{I}$ 表示）和碳自旋（用自旋算符 $\\mathbf{S}$ 表示）在标量耦合哈密顿量作用下的异核标量耦合演化。目标路径是一个远程五键耦合，其大小为 $^{5}J_{\\mathrm{CH}}=1.5\\,\\mathrm{Hz}$。HMBC 中的演化延迟 $\\Delta$ 的选择是为了最大化反相磁化的建立，这种反相磁化在 $\\mathbf{I}$ 和 $\\mathbf{S}$ 之间传递相干性，从而能够观测到弱远程耦合的交叉峰。\n\n从异核双自旋系统的基本自旋哈密顿量演化和标准的乘積算符（product-operator）框架出发，推导出使大小为 $J$ 的单个异核耦合的 HMBC 远程转移最大化的延迟 $\\Delta$，然后计算当 $J=1.5\\,\\mathrm{Hz}$ 时的具体数值。将最终的数值答案以毫秒为单位表示，并四舍五入至三位有效数字。\n\n此外，讨论有限的横向弛豫时间 $T_{2}$（核磁共振中的横向弛豫时间）所引入的权衡，包括 $T_{2}$ 如何在长延迟期间影响信号演化，以及当弛豫不可忽略时，最佳延迟如何改变。你的讨论应是定性的，但需基于相同的基本框架；不要引入无关的经验性“经验法则”。",
            "solution": "该问题要求在异核多键相关（HMBC）实验中，推导针对特定远程异核耦合 $J$ 的最佳演化延迟 $\\Delta$。推导将在核磁共振（NMR）波谱学的乘积算符形式理论框架内进行。我们首先考虑一个没有弛豫的理想化系统，然后计算给定耦合常数的延迟，最后讨论引入横向弛豫的定性效应。\n\nHMBC 实验的核心涉及质子自旋相干性在异核标量耦合哈密顿量影响下的演化。对于一个由质子（自旋 $\\mathbf{I}$）和碳核（自旋 $\\mathbf{S}$）组成的双自旋系统，在延迟 $\\Delta$ 期间，哈密顿量的相关部分是标量耦合项：\n$$H_J = 2\\pi J_{\\mathrm{IS}} I_z S_z$$\n其中 $J_{\\mathrm{IS}}$ 是以赫兹为单位的标量耦合常数，$I_z$ 和 $S_z$ 分别是自旋 I 和自旋 S 的自旋角动量 z-分量的笛卡尔自旋算符。对于本问题，$J_{\\mathrm{IS}}$ 对应于 ${}^5J_{\\mathrm{CH}}$。\n\n在 HMBC 脉冲序列中，在对质子施加初始 $90^{\\circ}$ 脉冲和随后的演化期之后，我们得到横向质子磁化。让我们考虑由算符 $I_x$ 表示的该磁化的一个分量。延迟周期 $\\Delta$ 的目标是将这个同相相干性 ($I_x$) 转换为相对于碳自旋的反相相干性 ($2I_y S_z$)。这个反相项是相干性转移到 S 自旋的必要前体，最终在二维谱中产生交叉峰。\n\n自旋系统在哈密顿量 $H_J$ 作用下随时间 $\\Delta$ 的演化由以下变换描述：\n$$\\sigma(\\Delta) = \\exp(-i H_J \\Delta) \\sigma(0) \\exp(i H_J \\Delta)$$\n其中 $\\sigma(0)$ 是延迟开始时的密度算符，我们取其与 $I_x$ 成正比。\n代入 $H_J$ 和 $\\sigma(0) = I_x$，演化过程为：\n$$I_x \\xrightarrow{2\\pi J I_z S_z \\Delta} \\exp(-i 2\\pi J I_z S_z \\Delta) I_x \\exp(i 2\\pi J I_z S_z \\Delta)$$\n使用乘积算符的标准旋转规则，将 $I_x$ 绕两个自旋的 $z$ 轴旋转（由 $I_z S_z$ 决定）得到：\n$$I_x \\xrightarrow{2\\pi J I_z S_z \\Delta} I_x \\cos(\\pi J \\Delta) + 2 I_y S_z \\sin(\\pi J \\Delta)$$\n这里，我们使用简化符号 $J$ 代表 $J_{\\mathrm{IS}}$。项 $2 I_y S_z$ 代表所需的反相磁化。其产生效率由函数 $\\sin(\\pi J \\Delta)$ 控制。为了最大化转移，我们必须最大化该项的幅值。这发生在 $|\\sin(\\pi J \\Delta)|$ 为最大值时，即等于 $1$。\n$$|\\sin(\\pi J \\Delta)| = 1$$\n当正弦函数的自变量是 $\\frac{\\pi}{2}$ 的奇数倍时，满足此条件：\n$$\\pi J \\Delta = \\frac{(2n+1)\\pi}{2} \\quad \\text{for } n = 0, 1, 2, \\dots$$\n求解 $\\Delta$，我们得到：\n$$\\Delta = \\frac{2n+1}{2J}$$\n最短且最实用的延迟对应于 $n=0$，这在没有弛豫的情况下得出最佳延迟 $\\Delta_{opt}$：\n$$\\Delta_{opt} = \\frac{1}{2J}$$\n\n现在，我们为给定的五键耦合常数 ${}^5J_{\\mathrm{CH}} = J = 1.5\\,\\mathrm{Hz}$ 计算这个延迟。\n$$\\Delta_{opt} = \\frac{1}{2 \\times 1.5\\,\\mathrm{Hz}} = \\frac{1}{3\\,\\mathrm{s}} \\approx 0.3333\\dots\\,\\mathrm{s}$$\n问题要求以毫秒为单位给出结果。\n$$\\Delta_{opt} = \\frac{1}{3}\\,\\mathrm{s} \\times 1000\\,\\frac{\\mathrm{ms}}{\\mathrm{s}} = 333.33\\dots\\,\\mathrm{ms}$$\n四舍五入至三位有效数字得到 $333\\,\\mathrm{ms}$。\n\n问题的第二部分要求讨论有限横向弛豫时间 $T_2$ 的影响。在真实系统中，由算符 $I_x$ 和 $I_y$ 以及包含它们的乘积算符所代表的横向磁化分量，在演化周期 $\\Delta$ 内会发生衰减。这种衰减通常是指数形式的，并由横向弛豫时间 $T_{2}$ 来表征。现在，$I_x$ 算符的演化包含一个衰减项 $\\exp(-\\Delta/T_{2,I})$，其中 $T_{2,I}$ 是质子的横向弛豫时间。\n\n初始产生的 $I_x$ 相干性，在同时考虑标量耦合和弛豫后的完整演化过程是：\n$$I_x \\xrightarrow{2\\pi J I_z S_z \\Delta, \\text{ Relaxation}} \\left[ I_x \\cos(\\pi J \\Delta) + 2 I_y S_z \\sin(\\pi J \\Delta) \\right] \\exp\\left(-\\frac{\\Delta}{T_{2,I}}\\right)$$\n所需反相项 $2I_y S_z$ 的振幅现在与一个函数 $A(\\Delta)$ 成正比：\n$$A(\\Delta) = \\sin(\\pi J \\Delta) \\exp\\left(-\\frac{\\Delta}{T_{2,I}}\\right)$$\n最佳延迟是使函数 $A(\\Delta)$ 最大化的 $\\Delta$ 值。这是一个权衡：$\\sin(\\pi J \\Delta)$ 项随着 $\\Delta$ 的增加而建立，在 $\\Delta = 1/(2J)$ 时达到最大值，而 $\\exp(-\\Delta/T_{2,I})$ 项则持续减小，对长延迟不利。\n\n为了找到最大值，我们将 $A(\\Delta)$ 对 $\\Delta$ 的导数设为零：\n$$\\frac{dA}{d\\Delta} = \\frac{d}{d\\Delta}\\left[ \\sin(\\pi J \\Delta) \\exp\\left(-\\frac{\\Delta}{T_{2,I}}\\right) \\right] = 0$$\n应用乘积法则进行微分：\n$$\\left[ \\pi J \\cos(\\pi J \\Delta) \\right] \\exp\\left(-\\frac{\\Delta}{T_{2,I}}\\right) + \\sin(\\pi J \\Delta) \\left[ -\\frac{1}{T_{2,I}} \\exp\\left(-\\frac{\\Delta}{T_{2,I}}\\right) \\right] = 0$$\n提出非零的指数项：\n$$\\pi J \\cos(\\pi J \\Delta) - \\frac{1}{T_{2,I}} \\sin(\\pi J \\Delta) = 0$$\n$$\\pi J \\cos(\\pi J \\Delta) = \\frac{1}{T_{2,I}} \\sin(\\pi J \\Delta)$$\n这导出了考虑弛豫时的最佳延迟 $\\Delta'_{opt}$ 的条件：\n$$\\tan(\\pi J \\Delta'_{opt}) = \\pi J T_{2,I}$$\n在没有弛豫的极限情况下 ($T_{2,I} \\to \\infty$)，正切函数的自变量必须趋近于 $\\frac{\\pi}{2}$，这恢复到了理想情况 $\\Delta'_{opt} \\to 1/(2J)$。对于任何有限的 $T_{2,I}$，项 $\\pi J T_{2,I}$ 都是有限的。因为对于任何有限的 $x > 0$，都有 $\\arctan(x)  \\frac{\\pi}{2}$，所以正切函数的自变量将小于 $\\frac{\\pi}{2}$。因此，$\\pi J \\Delta'_{opt}  \\frac{\\pi}{2}$，这意味着 $\\Delta'_{opt}  \\frac{1}{2J}$。\n\n总而言之，横向弛豫的存在需要一种折衷。为了最大化可观测信号，演化延迟 $\\Delta$ 必须相对于理想值 $1/(2J)$ 缩短。这个较短的延迟降低了到反相磁化的最大转换效率（$\\sin$ 项小于 $1$），但通过减轻由弛豫引起的指数衰减来获得信号增益。$T_2$ 时间越短（即弛豫越快），这种效应就越显著，最佳延迟也就变得越短。对于观测像本问题中这样的小的远程耦合，这种权衡尤为关键，因为所需的理想延迟 $\\Delta = 1/(2J)$ 可能非常长，如果弛豫显著，会导致大量的信号损失。",
            "answer": "$$\\boxed{333}$$"
        },
        {
            "introduction": "掌握远程耦合知识的最终目的是为了解析复杂的未知化合物结构。与其死记硬背复杂的“裂分树”规则，不如通过亲手构建一个仿真程序来更深刻地理解这些多重峰的形成过程。本练习旨在通过编程实践，让你将给定的耦合常数（$J$ 值）作为输入，基于一级近似规则，算法化地生成最终的谱图外观，从而建立起从耦合参数到实际观测谱峰之间直观而坚实的联系。",
            "id": "3711076",
            "problem": "你的任务是编写一个程序，在质子核磁共振（Proton Nuclear Magnetic Resonance (NMR)）的一级弱耦合近似下，模拟丙烯（SMILES: `C=CC`）中单个端基乙烯基质子的多重峰。该模拟必须基于以下基本原理和事实：\n\n1. 核自旋-自旋耦合源于自旋哈密顿量中的标量$J$-耦合项，在高场弱耦合极限下，这导致一级谱线位置对于耦合贡献是加和的。对于一个被观测质子$X$，其与$n_k$个等价自旋-1/2核的耦合常数为$J_k$，允许的跃迁频率（相对于$X$的化学位移）由下式给出\n$$\n\\nu = \\sum_{k} m_k J_k\n$$\n其中 $m_k \\in \\left\\{ -\\tfrac{n_k}{2},-\\tfrac{n_k}{2}+1,\\ldots,+\\tfrac{n_k}{2} \\right\\}$。\n\n2. 与$n_k$个等价自旋-1/2核耦合所产生的谱线相对强度遵循二项分布。具体而言，对于每个$k$，与给定$m_k$相关的强度权重正比于\n$$\nw_k(m_k) = \\binom{n_k}{m_k + \\tfrac{n_k}{2}},\n$$\n且在$\\nu$处的谱线的总相对强度是所有$k$的乘积，并进行归一化，使得所有强度之和等于1。\n\n3. 远程烯丙位四键耦合（通常称为“W耦合”）在存在时可被视为与三个等价甲基质子之间的一个小的$J$-耦合，产生一个$n_k = 3$的四重峰贡献。\n\n使用这些原理，在以下参数情景下，为丙烯中的单个端基乙烯基质子构建一个纯算法的多重峰模拟。\n\n物理和数值单位：\n- 所有耦合常数$J$必须以$\\mathrm{Hz}$为单位提供和处理。\n- 所有谱线位置必须以相对于被观测共振峰中心的频率偏移量（单位$\\mathrm{Hz}$）报告。\n- 强度必须以无量纲分数报告，其总和为1。\n\n你的程序必须：\n- 接受硬编码的测试用例，这些参数集以配对 $(J_k, n_k)$ 的形式定义被观测质子$X$的耦合组，其中$J_k$是与一组$n_k$个等价自旋耦合的耦合常数（单位$\\mathrm{Hz}$）。\n- 根据上述定义的加和性位置规则和二项式权重计算所有谱线位置和强度。\n- 通过求和其强度来合并完全简并的位置（在给定输入所决定的精确算术中是相同的）。\n- 对每个测试用例，返回：\n  1. 唯一谱线的数量（一个整数）。\n  2. 排序后的谱线位置列表（单位$\\mathrm{Hz}$，浮点数），四舍五入到三位小数。\n  3. 相应顺序的归一化强度列表（浮点数），四舍五入到四位小数。\n  4. 每个非零$J$耦合组的组分多重性列表，对于每个包含的组给出为 $[n_k+1]$ （整数），按输入耦合的相同顺序排列。这以非文本方式编码了“近似模式”（例如，$[2,4]$对应于“四重峰的二重峰”）。\n\n测试套件：\n构建以下明确的测试用例，所有用例均针对丙烯中的端基乙烯基质子：\n\n- 情况1（反式邻位加烯丙位W耦合）：与一个邻位乙烯基质子耦合，其$J_{\\text{vicinal}} = 17.2\\ \\mathrm{Hz}$（反式），并与三个等价甲基质子存在远程烯丙位W耦合，其$J_{\\text{allylic}} = 1.2\\ \\mathrm{Hz}$。表示为耦合 $[(17.2, 1), (1.2, 3)]$。\n\n- 情况2（顺式邻位加烯丙位W耦合）：与一个邻位乙烯基质子耦合，其$J_{\\text{vicinal}} = 10.4\\ \\mathrm{Hz}$（顺式），并与三个等价甲基质子存在远程烯丙位W耦合，其$J_{\\text{allylic}} = 1.2\\ \\mathrm{Hz}$。表示为耦合 $[(10.4, 1), (1.2, 3)]$。\n\n- 情况3（边界情况，无W耦合）：与一个邻位乙烯基质子耦合，其$J_{\\text{vicinal}} = 17.2\\ \\mathrm{Hz}$（反式），但与甲基质子之间不存在烯丙位耦合，$J_{\\text{allylic}} = 0.0\\ \\mathrm{Hz}$。表示为耦合 $[(17.2, 1), (0.0, 3)]$。在这种情况下，$J_k = 0.0$ 的组必须从多重性列表中排除，并且必须合并简并的谱线。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试结果表示为：\n$$\n[\\text{num\\_lines}, [\\text{positions\\_Hz}], [\\text{intensities}], [\\text{multiplicities}]]\n$$\n并且完整的输出是：\n$$\n[[\\cdots], [\\cdots], [\\cdots]]\n$$\n例如，格式应为：\n\"[[8,[p1,p2,...],[i1,i2,...],[2,4]],[8,[...],[...],[2,4]],[2,[...],[...],[2]]]\"。",
            "solution": "在尝试解决方案之前，对问题陈述的有效性进行评估。\n\n### 第1步：提取已知条件\n- **模型**：质子核磁共振（NMR）中的一级弱耦合近似。\n- **被观测核**：丙烯（SMILES: `C=CC`）中的单个端基乙烯基质子。\n- **谱线位置公式**：对于一个被观测质子$X$，其与$n_k$个耦合常数为$J_k$的等价自旋-$\\frac{1}{2}$核耦合，频率偏移$\\nu$由$\\nu = \\sum_{k} m_k J_k$给出。\n- **自旋量子数**：对于每个耦合组$k$，$m_k \\in \\left\\{ -\\frac{n_k}{2}, -\\frac{n_k}{2}+1, \\ldots, +\\frac{n_k}{2} \\right\\}$。\n- **谱线强度公式**：与$n_k$个核耦合的强度权重正比于$w_k(m_k) = \\binom{n_k}{m_k + \\frac{n_k}{2}}$。总相对强度是权重的乘积，并归一化使其总和为1。\n- **特殊情况**：远程烯丙位（W）耦合被视为与三个等价甲基质子的耦合（$n_k = 3$）。\n- **单位**：$J$值以$\\mathrm{Hz}$为单位。谱线位置是频率偏移，单位为$\\mathrm{Hz}$。强度是无量纲分数。\n- **输入格式**：测试用例是配对$(J_k, n_k)$的列表。\n- **每个测试用例的输出要求**：\n    1. 唯一谱线的数量（整数）。\n    2. 排序后的谱线位置列表（$\\mathrm{Hz}$，浮点数，四舍五入到3位小数）。\n    3. 相应的归一化强度列表（浮点数，四舍五入到4位小数）。\n    4. 对于每个$J_k \\neq 0.0$的组，其组分多重性列表为$[n_k+1]$。\n- **处理规则**：\n    - 通过求和强度来合并完全简并的位置。\n    - 对于多重性列表，排除$J_k = 0.0$的组。\n- **测试用例**：\n    1. 情况1：耦合 $[(17.2, 1), (1.2, 3)]$。\n    2. 情况2：耦合 $[(10.4, 1), (1.2, 3)]$。\n    3. 情况3：耦合 $[(17.2, 1), (0.0, 3)]$。\n- **最终输出格式**：一个列表的列表的单行字符串：`[[num_lines, [positions_Hz], [intensities], [multiplicities]], ...]`。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学基础**：该问题基于分析NMR谱图的标准一级（或弱耦合）模型，这是化学中波谱分析的基石。谱线位置和强度的公式是该模型的基础。对于丙烯中指定的质子，耦合常数值是物理上现实的。该问题在科学上是合理的。\n- **良态问题（Well-Posed）**：该问题为计算所需输出提供了一个清晰的、确定性的算法。输入已指定，计算规则明确，输出格式无歧义。每个测试用例都存在唯一且稳定的解。\n- **客观性**：问题以精确的技术语言（例如，“标量$J$-耦合”、“自旋哈密顿量”、“一级弱耦合近似”）陈述，没有任何主观性或含糊不清之处。\n\n问题陈述没有违反任何无效标准。它不是科学上不合理、不可形式化、不完整、不现实、病态、琐碎或不可验证的。\n\n### 第3步：结论与行动\n- **结论**：问题是**有效的**。\n- **行动**：继续提供一个合理的解决方案。\n\n### 解决方案\n该问题要求基于一组自旋-自旋耦合来模拟一级NMR多重峰。此模拟基于弱耦合近似的两个基本原则：谱线位置位移的加和性以及谱线强度的乘积性。\n\n一个未耦合的质子共振是一条单峰，我们可以将其定义为相对位置为$0\\ \\mathrm{Hz}$，相对强度为$1$。每次与一组$n_k$个耦合常数为$J_k$的等价自旋-$\\frac{1}{2}$核的耦合都会使该共振峰发生裂分。可以通过将此过程视为迭代卷积来算法化地构建模拟。\n\n我们从一个基础多重峰开始，表示为一个将谱线位置映射到其相对强度的字典：`{0.0: 1.0}`。然后我们遍历每个指定的耦合组$(J_k, n_k)$。对于每个组，我们生成其特征裂分模式，并将其与当前的多重峰进行“卷积”，以产生下一个更复杂的多重峰。\n\n对于给定的耦合组$(J_k, n_k)$：\n1. 耦合伴侣的总磁自旋量子数$m_k$的可能值范围为从$-\\frac{n_k}{2}$到$+\\frac{n_k}{2}$，步长为整数。我们可以使用从0到$n_k$的索引$i$来枚举这些状态，其中$m_k = i - \\frac{n_k}{2}$。\n2. 该状态贡献的频率位移为 $\\Delta\\nu_i = m_k \\cdot J_k$。\n3. 相应谱线的相对强度（统计权重）由二项式系数$w_i = \\binom{n_k}{i}$给出。\n\n卷积步骤如下进行。对于当前多重峰中的每条谱线$(p, I)$（位置为$p$，强度为$I$）以及正在考虑的耦合组的每个状态$i$（位置位移为$\\Delta\\nu_i$，权重为$w_i$），会生成一条新的谱线，其具有：\n- 新位置：$p' = p + \\Delta\\nu_i$\n- 新强度：$I' = I \\cdot w_i$\n\n这些新谱线$(p', I')$填充了一个用于下一阶段多重峰的新字典。通过使用键为位置的字典，任何完全简并（即具有相同计算位置$p'$）的谱线都会通过求和其强度而自动合并。\n\n对所有耦合常数非零（$J_k \\neq 0.0$）的耦合组重复此过程。$J_k = 0.0$的组不会引起任何裂分，因此不会改变谱线的相对位置或相对强度；因此它们被排除在卷积过程之外。\n\n所有卷积完成后，最终的字典包含所有唯一的谱线位置及其总的未归一化强度。然后通过将每个强度除以所有强度的总和来进行归一化，以确保它们的总和为1。\n\n最终结果按如下方式准备：\n1. 唯一谱线的数量是最终字典中的条目数。\n2. 从字典键中提取谱线位置，按升序排序，并四舍五入到三位小数。\n3. 提取相应的归一化强度，并四舍五入到四位小数。\n4. 对于每个$J_k \\neq 0.0$的输入耦合组$(J_k, n_k)$，构建多重性列表为$[n_k+1]$。\n\n该算法应用于提供的三个测试用例中的每一个。\n\n**情况1**：耦合 $[(17.2, 1), (1.2, 3)]$。这对应于一个四重峰($n_2=3$)的二重峰($n_1=1$)。一个2线模式与一个4线模式的卷积产生$2 \\times 4 = 8$条不同的谱线。多重性为$[1+1, 3+1] = [2, 4]$。\n\n**情况2**：耦合 $[(10.4, 1), (1.2, 3)]$。与情况1类似，这是一个四重峰的二重峰，产生8条谱线。多重性也为$[2, 4]$。唯一的区别是主要邻位耦合$J_{\\text{vicinal}}$的大小。\n\n**情况3**：耦合 $[(17.2, 1), (0.0, 3)]$。第一个耦合产生一个二重峰。第二个耦合$J_2 = 0.0$不引起进一步裂分。最终的模式只是一个二重峰。卷积算法通过跳过$J_2=0.0$的组，正确地产生2条谱线。由于第二组的耦合为零，它被从多重性列表中排除，列表变为$[1+1] = [2]$。\n\n实现将使用`scipy.special.comb`来计算二项式系数，这是一种高效且数值稳定的方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import comb\n\ndef solve():\n    \"\"\"\n    Main function to run the NMR multiplet simulation for all test cases.\n    \"\"\"\n\n    def simulate_multiplet(couplings):\n        \"\"\"\n        Simulates an NMR multiplet for a given set of first-order couplings.\n\n        Args:\n            couplings (list): A list of tuples, where each tuple is (J_k, n_k)\n                              representing a coupling constant J_k in Hz to n_k\n                              equivalent spin-1/2 nuclei.\n\n        Returns:\n            list: A list containing the number of lines, sorted positions,\n                  corresponding intensities, and component multiplicities.\n                  [num_lines, [positions], [intensities], [multiplicities]]\n        \"\"\"\n        # Start with a single unsplit line at 0 Hz with intensity 1.\n        # The multiplet is stored as a dictionary {position: intensity}.\n        multiplet = {0.0: 1.0}\n\n        # Iteratively convolve the multiplet with each coupling group.\n        for J_k, n_k in couplings:\n            # A coupling of 0 Hz does not cause splitting, so we skip it.\n            if J_k == 0.0:\n                continue\n\n            new_multiplet = {}\n            # Generate the splitting pattern for the current group (J_k, n_k).\n            # The pattern has n_k + 1 lines.\n            for i in range(n_k + 1):\n                # Calculate quantum number m_k.\n                m_k = i - n_k / 2.0\n                # Calculate the position shift for this sub-line.\n                pos_shift = m_k * J_k\n                # Calculate the intensity weight (binomial coefficient).\n                intensity_weight = float(comb(n_k, i))\n\n                # Convolve with the existing multiplet lines.\n                for pos, intensity in multiplet.items():\n                    new_pos = pos + pos_shift\n                    new_intensity = intensity * intensity_weight\n                    # Add to the new multiplet, merging degenerate lines.\n                    new_multiplet[new_pos] = new_multiplet.get(new_pos, 0.0) + new_intensity\n            \n            multiplet = new_multiplet\n        \n        # If multiplet is empty (e.g., no non-zero couplings), return a single line.\n        if not multiplet:\n            return [1, [0.000], [1.0000], []]\n\n        # Normalize intensities to sum to 1.\n        total_intensity = sum(multiplet.values())\n        normalized_multiplet = {pos: intensity / total_intensity for pos, intensity in multiplet.items()}\n\n        # Sort the lines by position.\n        sorted_positions = sorted(normalized_multiplet.keys())\n        \n        # Prepare final output lists with specified rounding.\n        num_lines = len(sorted_positions)\n        final_positions = [round(p, 3) for p in sorted_positions]\n        final_intensities = [round(normalized_multiplet[p], 4) for p in sorted_positions]\n        \n        # Calculate multiplicities, excluding groups with J_k = 0.\n        multiplicities = [n_k + 1 for J_k, n_k in couplings if J_k != 0.0]\n\n        return [num_lines, final_positions, final_intensities, multiplicities]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (trans vicinal + allylic W coupling)\n        [(17.2, 1), (1.2, 3)],\n        # Case 2 (cis vicinal + allylic W coupling)\n        [(10.4, 1), (1.2, 3)],\n        # Case 3 (boundary, no W coupling)\n        [(17.2, 1), (0.0, 3)],\n    ]\n\n    results = []\n    for case in test_cases:\n        result = simulate_multiplet(case)\n        results.append(result)\n\n    # Format the final output string to exactly match the problem specification.\n    # This involves building the string piece by piece to control formatting\n    # (e.g., no spaces in lists, fixed decimal places for floats).\n    result_strs = []\n    for res in results:\n        num_lines, positions, intensities, multiplicities = res\n        \n        # Format lists of floats with specific precision and no whitespace.\n        positions_str = f\"[{','.join([f'{p:.3f}' for p in positions])}]\"\n        intensities_str = f\"[{','.join([f'{i:.4f}' for i in intensities])}]\"\n        \n        # Format list of integers with no whitespace.\n        multiplicities_str = str(multiplicities).replace(\" \", \"\")\n        \n        result_strs.append(f\"[{num_lines},{positions_str},{intensities_str},{multiplicities_str}]\")\n\n    # Join all case results into a single string.\n    final_output = f\"[{','.join(result_strs)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "掌握远程耦合知识的最终目的是为了解析复杂的未知化合物结构。然而，在解析过程中，远程相关信号也可能成为一个“陷阱”，导致错误的结构指认。本练习将你置于一个真实的结构解析案例中：面对一组来自HMBC谱图、具有迷惑性的远程相关信号，你需要综合运用对不同核磁共振实验（如HMBC、H2BC）和耦合路径的深刻理解，去伪存真，做出正确的归属判断。通过这个挑战，你将学会如何批判性地评估谱学证据，从而准确无误地确定分子结构。",
            "id": "3711077",
            "problem": "在有机分子的核磁共振波谱学中，标量自旋-自旋耦合通过成键电子传递，并可以用包含 $2\\pi J_{XY} \\mathbf{I}_X \\cdot \\mathbf{S}_Y$ 形式项的自旋哈密顿量来描述，其中 $J_{XY}$ 是相隔 $n$ 个键的原子核 $\\mathrm{X}$ 和 $\\mathrm{Y}$ 之间的标量耦合常数。异核多键相关 (HMBC) 实验利用延迟来增强由远程 $^{n}J_{\\mathrm{CH}}$ 耦合（通常 $n = 2$ 和 $n = 3$）产生的相关信号，但当相应的 $J$ 值不为零时，也可以观察到 $n \\geq 4$ 的情况。检测到的交叉峰幅度是所选演化延迟和 $J$ 值大小的函数，因此如果不同 $n$ 键路径的 $J$ 值落在灵敏度窗口内，由它们产生的交叉峰可以共存。在共轭体系中，$^{4}J_{\\mathrm{CH}}$ 甚至 $^{5}J_{\\mathrm{CH}}$ 在“W”型构象中可能相当显著，而跨杂原子（例如，$\\mathrm{N}$ 或 $\\mathrm{O}$ 上的 $\\mathrm{H}$ 到相邻的碳）的 $^{2}J_{\\mathrm{HC}}$ 也可以被观察到。\n\n考虑一个取代肉桂酰胺的高级结构解析：一个 $\\mathrm{Ar}$–$\\mathrm{CH}=\\mathrm{CH}$–$\\mathrm{C}(=\\mathrm{O})\\mathrm{NH}\\mathrm{R}$ 骨架，在芳香环上带有一个对甲氧基。在 $J_\\text{opt} = 8\\,\\mathrm{Hz}$ 下优化的 HMBC 谱显示了以下交叉峰：一个位于 $\\delta_{\\mathrm{H}}\\,7.10\\,\\mathrm{ppm}$ 附近的芳环 $\\mathrm{H}_\\text{meta}$ 与位于 $\\delta_{\\mathrm{C}}\\,166\\,\\mathrm{ppm}$ 的酰胺羰基碳相关；一个位于 $\\delta_{\\mathrm{H}}\\,6.70\\,\\mathrm{ppm}$ 附近的乙烯基 $\\mathrm{H}_{\\beta}$ 也与酰胺羰基碳相关；一个位于 $\\delta_{\\mathrm{H}}\\,8.60\\,\\mathrm{ppm}$ 附近的 $\\mathrm{NH}$ 质子与酰胺羰基碳和芳环的连位碳都相关。在解析这类谱图时，一个常见的误区是将观测到的 $\\mathrm{H}_\\text{meta} \\leftrightarrow \\mathrm{C=O}$ 这类远程相关信号，错误地归属为某个假想异构体中可能存在的短程 $^{2}J_{\\mathrm{HC}}$ 耦合。\n\n根据第一性原理和经过充分检验的标量耦合传递与 HMBC 信号形成的事实，选择能够正确识别将 $^{4}J_{\\mathrm{CH}}$ 峰与跨杂原子的 $^{2}J_{\\mathrm{HC}}$ 峰混淆的归属风险，并提供有结构依据的验证方法以避免此类错误的选项。\n\nA. 在一个 $\\mathrm{Ar}$–$\\mathrm{CH}=\\mathrm{CH}$–$\\mathrm{C}(=\\mathrm{O})\\mathrm{NH}\\mathrm{R}$ 体系中，$\\mathrm{H}_\\text{meta} \\leftrightarrow \\mathrm{C=O}$ 相关很可能是一个通过共轭路径 $\\mathrm{Ar}$–$\\mathrm{CH}=\\mathrm{CH}$–$\\mathrm{C}=\\mathrm{O}$ 的 $^{4}J_{\\mathrm{CH}}$“W”型耦合，而不是一个跨杂原子的 $^{2}J_{\\mathrm{HC}}$，因为该质子位于碳上，并且不存在 $\\mathrm{H}$–$\\mathrm{X}$–$\\mathrm{C}$ 的二键路径。为了验证，可以改变 HMBC 的延迟时间，比较在 $J_\\text{opt} = 5\\,\\mathrm{Hz}$ 和 $J_\\text{opt} = 10\\,\\mathrm{Hz}$ 下的交叉峰幅度：“W”型构象中的 $^{4}J_{\\mathrm{CH}}$ 通常约为 $0.5$–$3\\,\\mathrm{Hz}$，在较小的 $J_\\text{opt}$ 下应更有利，而跨 $\\mathrm{N}/\\mathrm{O}$ 的 $^{2}J_{\\mathrm{HC}}$ 通常约为 $2$–$10\\,\\mathrm{Hz}$，在较大的 $J_\\text{opt}$ 下可能更强。采集质子检测的二键相关谱 (H2BC)，该谱选择性地检测 $^{2}J_{\\mathrm{HC}}$，如果 $\\mathrm{H}_\\text{meta} \\leftrightarrow \\mathrm{C=O}$ 交叉峰是 $^{4}J_{\\mathrm{CH}}$，则 H2BC 谱中不应显示该峰。进行 $\\mathrm{D}_{2}\\mathrm{O}$ 交换以去除 $\\mathrm{NH}$ 质子：如果在交换后有争议的交叉峰仍然存在，那么它不可能是由 $\\mathrm{NH}$ 介导的 $^{2}J_{\\mathrm{HC}}$，这支持了 $^{4}J_{\\mathrm{CH}}$ 的归属。\n\nB. 任何涉及 $\\mathrm{NH}$ 质子和羰基碳的 HMBC 交叉峰默认情况下必须是跨氮的 $^{2}J_{\\mathrm{HC}}$，因为到羰基的远程 $^{4}J_{\\mathrm{CH}}$ 可忽略不计。因此，应无需额外实验就将此类交叉峰归属为 $^{2}J$；改变 HMBC 延迟时间无法改变这一结论。\n\nC. 烯丙位和乙烯基的“W”型构象通常在 HMBC 中产生幅度 $\\geq 5\\,\\mathrm{Hz}$ 的 $^{5}J_{\\mathrm{CH}}$ 交叉峰，因此从 $\\mathrm{H}_{\\beta}$ 到 $\\mathrm{C}=\\mathrm{O}$ 的强交叉峰的存在必然表明存在一个短的二键路径。一个可靠的结构验证方法是从核欧豪瑟效应 (NOE) 强度推断二面角：强的 NOE 信号意味着小的二面角，因此意味着存在一个二键的 $^{2}J_{\\mathrm{HC}}$ 路径。\n\nD. 异核单量子相干谱 (HSQC) 能揭示耦合中的键数：如果一个 HMBC 交叉峰在 HSQC 谱中不存在，那么它必须是恰好两个键 ($^{2}J_{\\mathrm{HC}}$)。因此，利用 HSQC 谱中是否存在该峰来对交叉峰进行分类，并判定观察到的 $\\mathrm{H}_\\text{meta} \\leftrightarrow \\mathrm{C=O}$ 相关是跨杂原子的 $^{2}J_{\\mathrm{HC}}$；因在 HSQC 谱中未观察到，远程的 $^{4}J_{\\mathrm{CH}}$ 被排除。",
            "solution": "该问题已经过严格验证，被认为是合理的。它在科学上基于核磁共振波谱学的原理，问题提出得当，客观且内部一致。\n\n问题的核心是在一个取代肉桂酰胺，特别是 `p-MeO-Ar–CH=CH–C(=O)NHR` 中，正确归属一个远程异核相关信号，并将其与其他可能的耦合区分开。一个为耦合常数 $J_{\\mathrm{opt}} = 8\\,\\mathrm{Hz}$ 优化的 HMBC 实验显示，在芳环侧链间位的质子 $\\mathrm{H}_{\\mathrm{meta}}$（位于 $\\delta_{\\mathrm{H}}\\,7.10\\,\\mathrm{ppm}$）与酰胺羰基碳（位于 $\\delta_{\\mathrm{C}}\\,166\\,\\mathrm{ppm}$）之间存在一个交叉峰。中心问题是如何正确识别这种相关性，并避免将其错误归属为跨杂原子的二键耦合 $^{2}J_{\\mathrm{HC}}$。\n\n首先，我们必须在所定义的肉桂酰胺结构中确定 `H_meta` 到羰基碳相关的耦合路径。该结构是 `p-MeO-C₆H₄–CH=CH–C(=O)NHR`。从芳环上的一个间位质子到羰基碳的成键路径是：`H–C(meta)–C(ortho)–C(ipso)–C(α)=C(β)–C(=O)`。计算中间的化学键数量，得到一个五键的间隔（`H` 与 `C(meta)` 相距 $0$ 个键）：`C(meta)–C(ortho)` (1)，`C(ortho)–C(ipso)` (2)，`C(ipso)–C(α)` (3)，`C(α)=C(β)` (4)，`C(β)–C(=O)` (5)。因此，观察到的相关信号源于一个 $^{5}J_{\\mathrm{CH}}$ 耦合。这类远程耦合通常很小（例如 $ 1\\,\\mathrm{Hz}$），但在平面共轭体系中，由于自旋信息通过 $\\pi$ 电子体系的高效传递，它们可能变得可以被观察到。问题和选项中使用 $^{4}J_{\\mathrm{CH}}$ 作为此类远程耦合的代表性例子，这是一个可以接受的简化，因为将其与 $^{2}J_{\\mathrm{HC}}$ 区分的原理是相同的。\n\n所述的“误区”是将这种远程耦合错误地归属为通过杂原子的 $^{2}J_{\\mathrm{HC}}$，即一个 `H–X–C` 路径。如果在进行全新结构解析时，正在考虑一个包含这样路径的替代异构体，这可能是一个合理的错误。问题要求找到确保正确归属的最佳策略。我们现在将基于已确立的核磁共振原理来评估每个选项。\n\nA. 这个选项提出，`H_meta` $\\leftrightarrow$ `C=O` 相关是一个通过共轭碳骨架的远程耦合（称为 $^{4}J_{\\mathrm{CH}}$）。它正确地断言，对于给定的结构，情况必须如此，因为质子位于碳上，并且不存在到羰基碳的二键 `H–X–C` 路径。然后，它提出了三个实验验证方法：\n1. 改变 HMBC 延迟时间（通过改变 $J_{\\mathrm{opt}}$）：HMBC 中的信号强度取决于 $J$ 的大小。像 $^{4}J_{\\mathrm{CH}}$ 或 $^{5}J_{\\mathrm{CH}}$ 这样的远程耦合通常具有较小的值（例如 $0.5$–$3\\,\\mathrm{Hz}$），因此在长的演化延迟下（即较小的优化 $J_{\\mathrm{opt}}$ 值，如 $3$-$5\\,\\mathrm{Hz}$）能更好地被观察到。相比之下，$^{2}J_{\\mathrm{HC}}$ 耦合较大（通常为 $2$–$10\\,\\mathrm{Hz}$），在较短的延迟下（较大的 $J_{\\mathrm{opt}}$ 值，如 $8$-$10\\,\\mathrm{Hz}$）给出更强的信号。比较在不同 $J_{\\mathrm{opt}}$ 值下记录的谱图是区分不同大小耦合的有效且强大的方法。\n2. 采集质子检测的二键相关谱 (H2BC)：该实验专门设计用于检测 $^{2}J$ 相关，同时抑制 $^{1}J$、$^{3}J$ 和其他远程相关。如果 `H_meta` $\\leftrightarrow$ `C=O` 相关确实是 $^{5}J_{\\mathrm{CH}}$，那么它在 H2BC 谱中应该是不存在的。这是一个决定性的测试。\n3. 进行 $\\mathrm{D}_{2}\\mathrm{O}$ 交换实验：该实验识别涉及可交换质子（如来自 $\\mathrm{NH}$ 或 $\\mathrm{OH}$ 基团）的相关信号。如果对于 $\\delta_{\\mathrm{H}}\\,7.10\\,\\mathrm{ppm}$ 处的质子信号是否可能属于某个替代结构中的可交换质子（这将允许存在 $^{2}J_{\\mathrm{HNC}}$ 或 $^{2}J_{\\mathrm{HOC}}$ 路径）存在任何不确定性，这个测试将解决它。由于芳环上的 $\\mathrm{H}_{\\mathrm{meta}}$ 是不可交换的，其相关信号在加入 $\\mathrm{D}_{2}\\mathrm{O}$ 后将持续存在，从而排除了可交换质子的参与。\n此选项的所有部分都描述了科学上合理且适当的方法来验证归属。其推理是正确的，并展示了一种严谨的结构解析方法。\n结论：**正确**。\n\nB. 这个选项提出了一些不正确且武断的陈述。它声称任何 `NH` 到羰基碳的交叉峰*必须*是 $^{2}J_{\\mathrm{HC}}$，并且到羰基的远程耦合可以忽略不计。第二部分是一个错误的概括，因为问题本身就提供了一个反例（`H_meta` 到 `C=O`）。建议“无需额外实验”就进行归属，这与严谨的科学实践相悖。最后，“改变 HMBC 延迟时间无法改变这一结论”的断言是明显错误的。延迟依赖性是耦合的关键特征，并为支持或反对关于 $J$ 值的假设提供了关键证据。\n结论：**不正确**。\n\nC. 这个选项以一个科学上不成立的前提开始：即 $^{5}J_{\\mathrm{CH}}$ 耦合通常具有 $\\geq 5\\,\\mathrm{Hz}$ 的大小。实际上，$^{5}J_{\\mathrm{CH}}$ 耦合几乎总是很小，通常 $ 1\\,\\mathrm{Hz}$。$5\\,\\mathrm{Hz}$ 的值对于 $^{2}J_{\\mathrm{CH}}$ 或 $^{3}J_{\\mathrm{CH}}$ 是典型的，但对于 $^{5}J_{\\mathrm{CH}}$ 则不是。该选项接着建议使用核欧豪瑟效应 (NOE) 强度来推断二键路径。这揭示了对 NOE 的根本误解。NOE 源于通过空间的偶极耦合，并与 $r^{-6}$ 成正比（其中 $r$ 是原子核间的距离，通常是质子）。它提供关于空间邻近性的信息，而不是关于共价路径中的键数。强的 NOE 信号意味着距离近，而不是特定的键数或小的二面角。人们不能用 NOE 数据直接证明一个 $^{2}J_{\\mathrm{HC}}$ 连接性。\n结论：**不正确**。\n\nD. 这个选项从根本上歪曲了异核单量子相干谱 (HSQC) 实验的目的。HSQC 谱专门显示直接键合的原子核之间的相关信号，即通过单键耦合（$^{1}J$）。“如果一个 HMBC 交叉峰在 HSQC 谱中不存在，那么它必须是恰好两个键 ($^{2}J_{\\mathrm{HC}}$)”的说法是完全错误的。它在 HSQC 谱中不存在仅意味着该耦合*不是*一个单键耦合。它可能是 $^{2}J$、$^{3}J$、$^{4}J$ 或任何其他多键耦合。遵循该选项的错误逻辑将导致错误的结论，即任何远程相关（根据定义，它在 HSQC 中是不存在的）都是一个二键相关。这是一个导致错误归属的方法。\n结论：**不正确**。\n\n综上所述，只有选项 A 提出了一套逻辑上合理、技术上先进的实验程序，以正确识别异核耦合的性质，并避免问题中描述的特定误区。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}