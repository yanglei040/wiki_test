{
    "hands_on_practices": [
        {
            "introduction": "INADEQUATE实验的成功与否在很大程度上取决于对脉冲序列中演化延迟时间的精确设置。这个延迟时间（通常表示为 $\\tau$）需要根据所研究的碳-碳耦合常数（$J_{\\mathrm{CC}}$）进行优化，以最大化信号转移效率。通过本练习 ，您将推导并应用信号强度与耦合常数及延迟时间之间的函数关系，学会如何选择最佳实验参数以增强目标信号，同时抑制不需要的远程耦合伪影。",
            "id": "3707882",
            "problem": "一个小有机分子中相邻碳原子 $\\mathrm{C}_1$ 和 $\\mathrm{C}_2$ 构成的同核双自旋体系，通过“天然丰度双量子转移实验”（Incredible Natural Abundance Double Quantum Transfer Experiment, INADEQUATE）进行探测，以确定天然丰度下的碳-碳连接性。在理想化的情况下，仅考虑一个孤立的 $\\mathrm{C}_1$–$\\mathrm{C}_2$ 对，在两个持续时间均为 $\\tau$ 的相同演化延迟期间，在各向同性标量耦合哈密顿量 $H_{J} = 2\\pi J\\,\\mathbf{I}_1\\cdot \\mathbf{I}_2$ 的作用下演化，这两个延迟用于产生和转换回双量子相干。假设在高场条件下，化学位移演化被脉冲序列重聚焦，因此在每个 $\\tau$ 周期内可以忽略，以便分析标量耦合介導的相干转移。使用标准的乘积算符形式和标量耦合哈密顿量的性质来：\n\n1. 从同相横向磁化出发，考虑到每个 $\\tau$ 周期都在 $H_{J}$ 下进行演化，推导可观测的单量子相干（从双量子相干转换回来后）的净转移幅度与标量耦合 $J$ 和延迟 $\\tau$ 之间的函数关系。\n\n2. 考虑在同一实验中观察到的两种耦合路径：一种是单键碳-碳耦合，其耦合常数 $J_{1} = 45.0\\ \\mathrm{Hz}$；另一种是双键碳-碳耦合，其耦合常数 $J_{2} = 5.0\\ \\mathrm{Hz}$。选择 $\\tau$ 值，以最大化单键转移幅度，同时确保双键转移幅度被抑制，使其强度（与幅度的平方成正比）不超过 $0.04$。在所有满足这两个要求的正 $\\tau$ 值中，确定最小的那个。\n\n以毫秒为单位报告 $\\tau$ 的值，并将答案四舍五入到四位有效数字。",
            "solution": "该问题被评估为有效，因为它科学地基于核磁共振（NMR）波谱学原理，特别是INADEQUATE实验。给定的参数是物理上现实的，并且问题提法清晰，可以导出一个唯一的解。\n\n### 第一部分：净转移幅度的推导\n\nINADEQUATE实验通过在一对耦合的 $^{13}\\mathrm{C}$ 原子核之间产生和检测双量子相干（DQC）来确定碳-碳连接性。该过程涉及两个关键的演化时期，每个持续时间为 $\\tau$，并由标量耦合哈密顿量 $H_J$ 控制。\n\n问题指出，在这些延迟期间的演化完全受各向同性标量耦合哈密顿量 $H_{J} = 2\\pi J\\,\\mathbf{I}_1\\cdot \\mathbf{I}_2$ 的控制。在高场条件下，这个哈密顿量可以很好地用其久期分量来近似，即 $H_{J} \\approx 2\\pi J I_{1z}I_{2z}$。这种简化是合理的，因为非久期项不介导同相和反相相干之间所需的相干转移。\n\n从初始平衡磁化到最终可观测信号的整个转移过程可以分解为几个步骤。一个简化但概念上正确的路径是：\n1.  **准备**：一个脉冲序列产生同相横向磁化，例如 $I_{1x} + I_{2x}$。\n2.  **DQC生成（第一个 $\\tau$ 周期）**：同相磁化在 $H_J$ 的作用下演化时间 $\\tau$。这个过程将同相相干转换为反相相干。例如，初始项 $I_{1x}$ 的演化由下式给出：\n    $$I_{1x} \\xrightarrow{H_J, \\tau} I_{1x}\\cos(\\pi J \\tau) + 2I_{1y}I_{2z}\\sin(\\pi J \\tau)$$\n    因此，生成的反相项 $2I_{1y}I_{2z}$ 的幅度与 $\\sin(\\pi J \\tau)$ 成正比。随后的一个脉冲将此反相相干转换为DQC。因此，产生的DQC量与 $\\sin(\\pi J \\tau)$ 成正比。\n3.  **DQC转换回（第二个 $\\tau$ 周期）**：经过一段时间后，DQC通过另一个脉冲被转换回反相相干。然后，这个反相相干在 $H_J$ 的作用下进行第二个相同的周期 $\\tau$ 的演化。这个演化将反相相干转换为可观测的同相磁化。这第二步转换的效率也与 $\\sin(\\pi J \\tau)$ 成正比。例如：\n    $$2I_{1y}I_{2z} \\xrightarrow{H_J, \\tau} 2I_{1y}I_{2z}\\cos(\\pi J \\tau) - I_{1x}\\sin(\\pi J \\tau)$$\n    可观测的同相项 $I_{1x}$ 的幅度与 $\\sin(\\pi J \\tau)$ 成正比。\n\n整个过程（同相 $\\rightarrow$ DQC $\\rightarrow$ 同相）的净转移幅度，我们记为 $A(J, \\tau)$，是生成步骤和转换回步骤效率的乘积。由于两个延迟的持续时间相同，均为 $\\tau$，因此函数关系为：\n$$A(J, \\tau) \\propto \\sin(\\pi J \\tau) \\times \\sin(\\pi J \\tau) = \\sin^2(\\pi J \\tau)$$\n为了解决这个问题，我们可以将归一化幅度定义为 $A(J, \\tau) = \\sin^2(\\pi J \\tau)$。\n\n### 第二部分：$\\tau$ 的优化\n\n我们已知两种耦合路径：\n- 单键耦合：$J_{1} = 45.0\\ \\mathrm{Hz}$\n- 双键耦合：$J_{2} = 5.0\\ \\mathrm{Hz}$\n\n这两种路径的转移幅度分别为：\n- $A_1(\\tau) = \\sin^2(\\pi J_1 \\tau) = \\sin^2(45.0 \\pi \\tau)$\n- $A_2(\\tau) = \\sin^2(\\pi J_2 \\tau) = \\sin^2(5.0 \\pi \\tau)$\n\n我们的任务是找到满足以下两个条件的最小正延迟 $\\tau$：\n1.  单键转移幅度 $A_1(\\tau)$ 最大化。\n2.  双键转移的强度不超过 $0.04$。\n\n**条件1：最大化 $A_1(\\tau)$**\n函数 $A_1(\\tau) = \\sin^2(45.0 \\pi \\tau)$ 在以下条件下达到其最大值 $1$：\n$$\\sin(45.0 \\pi \\tau) = \\pm 1$$\n这发生在正弦函数的参数是 $\\frac{\\pi}{2}$ 的奇数倍时：\n$$45.0 \\pi \\tau = \\frac{(2k+1)\\pi}{2} = (k + \\frac{1}{2})\\pi, \\quad \\text{其中 } k \\in \\{0, 1, 2, \\dots\\}$$\n解出 $\\tau$，我们得到一组使单键转移最大化的候选值：\n$$\\tau_k = \\frac{k + 0.5}{45.0}$$\n我们要寻找最小的正 $\\tau$，所以我们将从 $k=0$ 开始测试非负整数值 $k$。\n\n**条件2：抑制双键转移**\n问题指出强度与幅度的平方成正比。设强度为 $I(\\tau)$。则 $I(\\tau) \\propto [A(\\tau)]^2$。对于双键耦合，这意味着 $I_2(\\tau) \\propto [A_2(\\tau)]^2 = [\\sin^2(5.0 \\pi \\tau)]^2 = \\sin^4(5.0 \\pi \\tau)$。\n可能的最大强度对应于幅度 $A_2(\\tau)$ 最大的情况，即 $A_2(\\tau)=1$。因此，我们可以将强度归一化，使得最大强度为 $1$。约束条件则为：\n$$I_2(\\tau) = \\sin^4(5.0 \\pi \\tau) \\le 0.04$$\n两边取平方根，我们得到：\n$$\\sin^2(5.0 \\pi \\tau) \\le \\sqrt{0.04}$$\n$$\\sin^2(5.0 \\pi \\tau) \\le 0.2$$\n\n**寻找最优 $\\tau$**\n我们必须找到满足不等式 $\\sin^2(5.0 \\pi \\tau_k) \\le 0.2$ 的最小的 $\\tau_k = \\frac{k+0.5}{45.0}$（其中 $k=0, 1, 2, \\dots$）。让我们按顺序测试 $k$ 的值。\n\n当 $k=0$ 时：\n$$\\tau_0 = \\frac{0 + 0.5}{45.0} = \\frac{0.5}{45.0} = \\frac{1}{90.0}\\ \\mathrm{s}$$\n现在我们检查这个 $\\tau$ 值是否满足条件2：\n$$ \\sin^2(5.0 \\pi \\tau_0) = \\sin^2\\left(5.0 \\pi \\times \\frac{1}{90.0}\\right) = \\sin^2\\left(\\frac{5.0 \\pi}{90.0}\\right) = \\sin^2\\left(\\frac{\\pi}{18}\\right) $$\n角度 $\\frac{\\pi}{18}$ 弧度等于 $10^{\\circ}$。\n$$ \\sin^2\\left(\\frac{\\pi}{18}\\right) \\approx (0.1736)^2 \\approx 0.03015 $$\n我们将这个值与约束条件进行比较：\n$$ 0.03015 \\le 0.2 $$\n条件满足。由于我们从最小的非负整数 $k=0$ 开始，以找到使 $A_1$ 最大化的最小正 $\\tau$，因此这个值 $\\tau_0 = \\frac{1}{90.0}\\ \\mathrm{s}$ 就是所求的解。\n\n为了完整性，我们再检查一下 $k=1$ 的情况：\n$$\\tau_1 = \\frac{1 + 0.5}{45.0} = \\frac{1.5}{45.0} = \\frac{1}{30.0}\\ \\mathrm{s}$$\n检查条件2：\n$$ \\sin^2(5.0 \\pi \\tau_1) = \\sin^2\\left(5.0 \\pi \\times \\frac{1}{30.0}\\right) = \\sin^2\\left(\\frac{5.0 \\pi}{30.0}\\right) = \\sin^2\\left(\\frac{\\pi}{6}\\right) = (0.5)^2 = 0.25 $$\n由于 $0.25 > 0.2$，这个值是不允许的。\n\n因此，同时满足两个要求的最小正 $\\tau$ 是 $\\tau = \\frac{1}{90.0}\\ \\mathrm{s}$。\n\n最后，我们将这个值转换为毫秒，并四舍五入到四位有效数字：\n$$ \\tau = \\frac{1}{90.0}\\ \\mathrm{s} = \\frac{1000}{90.0}\\ \\mathrm{ms} \\approx 11.111\\dots\\ \\mathrm{ms} $$\n四舍五入到四位有效数字，我们得到 $11.11\\ \\mathrm{ms}$。",
            "answer": "$$\\boxed{11.11}$$"
        },
        {
            "introduction": "INADEQUATE实验的最终产物是一个二维谱图，其中的交叉峰直接揭示了分子中相邻碳原子之间的连接关系。然而，从原始的峰列表到完整的分子骨架结构，还需要一步关键的数据处理和解析。本练习  将指导您通过编程实践，学习如何将实验测得的交叉峰坐标与碳谱化学位移相匹配，并自动构建出代表分子连接性的邻接矩阵，从而将谱图数据转化为直观的化学结构信息。",
            "id": "3707887",
            "problem": "考虑一组由 Incredible Natural Abundance Double Quantum Transfer Experiment (INADEQUATE) 实验记录的碳-13核磁共振化学位移和交叉峰。在INADEQUATE实验中，一个由两个直接键合的碳-13核组成的双自旋体系（其拉莫尔角频率为$\\omega_i$和$\\omega_j$）在标量耦合哈密顿量的作用下演化，使得双量子相干累积的相位与$(\\omega_i + \\omega_j) t$成正比。因此，在坐标处观察到交叉峰，其间接维度对应于单量子频率之和，其直接维度对应于其中一个单量子频率。将此转换为化学位移语言（单位为百万分率，$\\mathrm{ppm}$），如果一个观测到的交叉峰坐标为$(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$，且在指定的容差范围内满足以下条件，则该交叉峰与一个直接键合对$(i, j)$一致：双量子维度约等于$\\delta_i + \\delta_j$之和，单量子维度约等于$\\delta_i$或$\\delta_j$。\n\n假设有$n$个不同的碳-13位点，其化学位移为$\\Delta = [\\delta_1, \\delta_2, \\ldots, \\delta_n]$（单位为$\\mathrm{ppm}$），以及一组$m$个观测到的INADEQUATE交叉峰$P = \\{(\\delta_{\\mathrm{DQ}}^{(k)}, \\delta_{\\mathrm{SQ}}^{(k)})\\}_{k=1}^m$（单位为$\\mathrm{ppm}$）。设$\\epsilon_{\\mathrm{sum}}$和$\\epsilon_{\\mathrm{sq}}$为非负容差（单位为$\\mathrm{ppm}$）。构建一个无向图$G$，其顶点为碳-13位点，边表示从INADEQUATE推断出的直接键合对。用其邻接矩阵$A \\in \\{0,1\\}^{n \\times n}$对$G$进行编码，其中$A_{ii} = 0$，$A_{ij} = A_{ji} = 1$当且仅当存在至少一个交叉峰$(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}}) \\in P$满足以下条件：\n- $|\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| \\le \\epsilon_{\\mathrm{sum}}$，\n- $\\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\} \\le \\epsilon_{\\mathrm{sq}}$，\n- $i \\neq j$。\n\n如果多个候选对$(i,j)$满足给定的交叉峰条件，则选择使标量判据$r = |\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| + \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$最小化的对，同时需满足上述阈值。每个接受的交叉峰最多贡献一条边$(i,j)$，同一对的重复交叉峰不会使邻接值改变到超过$1$。\n\n你的任务是实现一个程序，给定一个由参数集$(\\Delta, P, \\epsilon_{\\mathrm{sum}}, \\epsilon_{\\mathrm{sq}})$组成的测试套件，为每种情况构建邻接矩阵$A$，并将其行主序扁平化表示形式作为整数列表返回。\n\n所有化学位移和容差都以$\\mathrm{ppm}$表示。输出中不涉及角度或其他物理单位。输出为无单位整数。\n\n测试套件：\n- 情况$1$（正常路径链）：\n  - $\\Delta = [\\,40.0,\\,30.0,\\,20.0\\,]$ $\\mathrm{ppm}$，\n  - $P = [\\,(70.0,\\,40.0),\\,(50.0,\\,30.0),\\,(60.0,\\,25.0)\\,]$ $\\mathrm{ppm}$，\n  - $\\epsilon_{\\mathrm{sum}} = 0.2$ $\\mathrm{ppm}$，$\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$。\n- 情况$2$（通过单量子坐标解决歧义）：\n  - $\\Delta = [\\,100.0,\\,50.0,\\,25.0,\\,75.0\\,]$ $\\mathrm{ppm}$，\n  - $P = [\\,(150.0,\\,50.0),\\,(175.0,\\,75.0),\\,(125.0,\\,25.0),\\,(125.0,\\,75.0)\\,]$ $\\mathrm{ppm}$，\n  - $\\epsilon_{\\mathrm{sum}} = 0.3$ $\\mathrm{ppm}$，$\\epsilon_{\\mathrm{sq}} = 0.3$ $\\mathrm{ppm}$。\n- 情况$3$（边界容差的接受与拒绝）：\n  - $\\Delta = [\\,80.0,\\,30.0,\\,50.0\\,]$ $\\mathrm{ppm}$，\n  - $P = [\\,(110.4,\\,80.0),\\,(130.6,\\,50.0),\\,(80.0,\\,30.0)\\,]$ $\\mathrm{ppm}$，\n  - $\\epsilon_{\\mathrm{sum}} = 0.5$ $\\mathrm{ppm}$，$\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$。\n- 情况$4$（重复与方向对称性）：\n  - $\\Delta = [\\,60.0,\\,40.0,\\,20.0,\\,10.0\\,]$ $\\mathrm{ppm}$，\n  - $P = [\\,(100.0,\\,60.0),\\,(100.0,\\,40.0),\\,(60.0,\\,40.0),\\,(60.0,\\,20.0),\\,(100.0,\\,60.0)\\,]$ $\\mathrm{ppm}$，\n  - $\\epsilon_{\\mathrm{sum}} = 0.2$ $\\mathrm{ppm}$，$\\epsilon_{\\mathrm{sq}} = 0.2$ $\\mathrm{ppm}$。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个结果列表，每个测试用例一个结果，每个结果是表示为整数列表的行主序扁平化邻接矩阵。整个输出必须是单个逗号分隔的聚合体，并用方括号括起来，无空格，例如$[[0,1,0],[1,0,1]]$。",
            "solution": "该问题要求构建一个邻接矩阵$A$，用于表示分子中碳原子的连通图。该图是根据$^{13}$C INADEQUATE NMR实验获得的光谱数据推断出来的。因此，解决方案是对将观察到的谱图交叉峰指派给直接键合的碳原子对的规则进行算法解释。\n\n每种情况的输入包括一个包含$n$个碳化学位移的列表$\\Delta = [\\delta_1, \\delta_2, \\ldots, \\delta_n]$，一个包含$m$个观测交叉峰的列表$P = \\{(\\delta_{\\mathrm{DQ}}^{(k)}, \\delta_{\\mathrm{SQ}}^{(k)})\\}_{k=1}^m$，以及两个容差$\\epsilon_{\\mathrm{sum}}$和$\\epsilon_{\\mathrm{sq}}$。输出是$n \\times n$的邻接矩阵$A$，扁平化为行主序列表。\n\nINADEQUATE实验的基本原理规定，一个交叉峰$(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$源于一对直接键合的$^{13}$C核（例如位点$i$和位点$j$），其化学位移分别为$\\delta_i$和$\\delta_j$。交叉峰的坐标通过以下近似关系与单个化学位移相关联：\n$1$. 双量子频率$\\delta_{\\mathrm{DQ}}$是单个化学位移之和：$\\delta_{\\mathrm{DQ}} \\approx \\delta_i + \\delta_j$。\n$2$. 单量子频率$\\delta_{\\mathrm{SQ}}$对应于两个耦合核之一的化学位移：$\\delta_{\\mathrm{SQ}} \\approx \\delta_i$或$\\delta_{\\mathrm{SQ}} \\approx \\delta_j$。\n\n该问题将这些物理原理形式化为一组精确的数学条件。如果在图中顶点$i$和$j$之间建立一条边（即$A_{ij} = A_{ji} = 1$），则必须存在至少一个可以可靠地指派给原子对$(i, j)$的交叉峰$(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$。对于$i \\neq j$，指派受以下标准约束：\n- $|\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)| \\le \\epsilon_{\\mathrm{sum}}$\n- $\\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\} \\le \\epsilon_{\\mathrm{sq}}$\n\n问题的一个关键方面是处理歧义。单个交叉峰可能满足多对原子的容差条件。为解决此问题，定义了一个标量判据$r$来衡量匹配质量：\n$$r = |\\delta_{\\mathrm DQ} - (\\delta_i + \\delta_j)| + \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$$\n对于每个交叉峰，我们必须找到既满足容差条件又使$r$值最小化的原子对$(i, j)$。每个交叉峰最多被指派给一个这样的最佳匹配对。\n\n构建邻接矩阵$A$的总体算法如下：\n\n1.  **初始化**：给定$n$个化学位移的列表$\\Delta$，初始化一个$n \\times n$的矩阵$A$，所有元素设置为$0$。该矩阵将表示图的邻接关系，其中$A_{ii}$定义为$0$。\n\n2.  **遍历交叉峰**：逐个处理集合$P$中的每个交叉峰$(\\delta_{\\mathrm{DQ}}, \\delta_{\\mathrm{SQ}})$。对于每个峰，目标是找到唯一的最佳匹配原子对$(i, j)$。\n\n3.  **为每个峰寻找最佳匹配**：对于当前的交叉峰，遍历所有可能的不同原子对$(i, j)$（其中$0 \\le i  j  n$）。对于每一对：\n    a.  设$\\delta_i$和$\\delta_j$为$\\Delta$中索引为$i$和$j$的化学位移。\n    b.  计算和差，$\\Delta\\delta_{\\mathrm{sum}} = |\\delta_{\\mathrm{DQ}} - (\\delta_i + \\delta_j)|$。\n    c.  计算单量子差，$\\Delta\\delta_{\\mathrm{sq}} = \\min\\{|\\delta_{\\mathrm{SQ}} - \\delta_i|, |\\delta_{\\mathrm{SQ}} - \\delta_j|\\}$。\n    d.  通过测试$\\Delta\\delta_{\\mathrm{sum}} \\le \\epsilon_{\\mathrm{sum}}$和$\\Delta\\delta_{\\mathrm{sq}} \\le \\epsilon_{\\mathrm{sq}}$来检查该对是否为有效候选。\n    e.  如果该对是有效候选，计算其匹配分数$r = \\Delta\\delta_{\\mathrm{sum}} + \\Delta\\delta_{\\mathrm{sq}}$。记录当前峰找到的具有最小$r$值的原子对。\n\n4.  **更新邻接矩阵**：在检查完给定交叉峰的所有可能对之后，如果已确定一个得分最小$r_{\\min}$的最佳匹配对$(i^*, j^*)$，则此指派被视为已确认。通过设置$A_{i^*j^*} = 1$和$A_{j^*i^*} = 1$来更新邻接矩阵以反映此键合。如果当前峰没有满足容差标准的原子对，则该峰被视为未指派的噪声，矩阵保持不变。使用邻接矩阵自然地处理了多个峰确认同一键合的情况；将已为$1$的元素再次设置为$1$没有效果。\n\n5.  **最终确定**：处理完$P$中的所有交叉峰后，矩阵$A$即告完成。最后一步是将这个$n \\times n$的矩阵转换为其行主序扁平化表示，即一个包含$n^2$个整数的一维列表。\n\n此过程确保每个交叉峰最多对图贡献一条边，歧义被确定性地解决，并且最终的连通性是所提供数据和物理模型的直接逻辑结果。使用NumPy数组进行矩阵运算为此算法提供了高效的实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the INADEQUATE adjacency matrix construction problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path chain)\n        (\n            [40.0, 30.0, 20.0],\n            [(70.0, 40.0), (50.0, 30.0), (60.0, 25.0)],\n            0.2, 0.2\n        ),\n        # Case 2 (ambiguity resolved by single-quantum coordinate)\n        (\n            [100.0, 50.0, 25.0, 75.0],\n            [(150.0, 50.0), (175.0, 75.0), (125.0, 25.0), (125.0, 75.0)],\n            0.3, 0.3\n        ),\n        # Case 3 (boundary tolerance acceptance and rejection)\n        (\n            [80.0, 30.0, 50.0],\n            [(110.4, 80.0), (130.6, 50.0), (80.0, 30.0)],\n            0.5, 0.2\n        ),\n        # Case 4 (duplicate and orientation symmetry)\n        (\n            [60.0, 40.0, 20.0, 10.0],\n            [(100.0, 60.0), (100.0, 40.0), (60.0, 40.0), (60.0, 20.0), (100.0, 60.0)],\n            0.2, 0.2\n        )\n    ]\n\n    results = []\n    for case in test_cases:\n        delta, peaks, eps_sum, eps_sq = case\n        adj_matrix = build_adjacency_matrix(delta, peaks, eps_sum, eps_sq)\n        # Flatten the matrix to a row-major list of integers.\n        flat_list = adj_matrix.flatten().astype(int).tolist()\n        results.append(flat_list)\n\n    # Format the final output string as a list of lists without spaces.\n    result_strings = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\ndef build_adjacency_matrix(delta, peaks, eps_sum, eps_sq):\n    \"\"\"\n    Constructs the adjacency matrix from INADEQUATE NMR data.\n\n    Args:\n        delta (list of float): List of chemical shifts.\n        peaks (list of tuple): List of (delta_DQ, delta_SQ) cross-peaks.\n        eps_sum (float): Tolerance for the sum of chemical shifts.\n        eps_sq (float): Tolerance for the single-quantum chemical shift.\n\n    Returns:\n        numpy.ndarray: The n x n adjacency matrix.\n    \"\"\"\n    n = len(delta)\n    adj_matrix = np.zeros((n, n), dtype=int)\n\n    for delta_dq, delta_sq in peaks:\n        min_r = np.inf\n        best_pair = None\n\n        # Iterate through all unique pairs of atoms (i, j) with i  j\n        for i in range(n):\n            for j in range(i + 1, n):\n                delta_i = delta[i]\n                delta_j = delta[j]\n\n                # Calculate differences from experimental values\n                sum_diff = np.abs(delta_dq - (delta_i + delta_j))\n                sq_diff = min(np.abs(delta_sq - delta_i), np.abs(delta_sq - delta_j))\n\n                # Check if the pair is a valid candidate within tolerances\n                if sum_diff = eps_sum and sq_diff = eps_sq:\n                    # Calculate the matching criterion 'r'\n                    r = sum_diff + sq_diff\n                    if r  min_r:\n                        min_r = r\n                        best_pair = (i, j)\n        \n        # If a best-matching pair was found, update the adjacency matrix\n        if best_pair is not None:\n            i, j = best_pair\n            adj_matrix[i, j] = 1\n            adj_matrix[j, i] = 1\n            \n    return adj_matrix\n\nsolve()\n```"
        },
        {
            "introduction": "虽然乘积算符方法为理解脉冲序列提供了直观的物理图像，但对核磁共振实验最根本的理解来自于基于密度矩阵的第一性原理模拟。本练习  要求您利用量子力学的密度矩阵形式和刘维尔-冯·诺伊曼方程，从头开始编写一个简化的INADEQUATE序列的模拟程序。通过追踪密度矩阵在脉冲和演化延迟期间的变化，您将深刻理解相干性是如何被创造、转移和选择的，从而验证理论模型的正确性，并掌握分析和设计复杂NMR实验的终极工具。",
            "id": "3707870",
            "problem": "您的任务是使用基于核磁共振（NMR）密度矩阵形式的第一性原理模拟，来验证“不可思议的自然丰度双量子转移实验”（INADEQUATE）用于直接碳-13到碳-13相关性分析的可行性。请实现一个程序，模拟一个代表两个自旋-$\\tfrac{1}{2}$碳-$13$原子核的双自旋系统，该系统具有标量耦合和化学位移偏移。程序需要评估一个简化的INADEQUATE脉冲序列所产生的可观测信号。模拟必须通过密度矩阵在不含时哈密顿量下的幺正演化以及作为旋转施加的非选择性射频脉冲来执行。\n\n从以下基本理论开始：\n\n- 对于一个封闭量子系统，刘维尔-冯·诺伊曼方程规定密度算符 $\\rho$ 在幺正传播子下演化，即 $\\rho(t) = U(t)\\,\\rho(0)\\,U(t)^\\dagger$，其中 $U(t)$ 由哈密顿量 $H$ 通过 $U(t) = \\exp\\!\\left(-i\\,H\\,t\\right)$ 生成。\n- 对于两个自旋-$\\tfrac{1}{2}$的原子核，笛卡尔自旋角动量算符为 $I_x = \\tfrac{1}{2}\\sigma_x$，$I_y = \\tfrac{1}{2}\\sigma_y$，$I_z = \\tfrac{1}{2}\\sigma_z$，其中 $\\sigma_x$、$\\sigma_y$ 和 $\\sigma_z$ 是泡利矩阵。双自旋算符通过克罗内克积形成，例如 $I_x^{(1)} \\otimes \\mathbb{1}^{(2)}$ 和 $\\mathbb{1}^{(1)} \\otimes I_x^{(2)}$，在不引起歧义的情况下将分别简写为 $I_x^{(1)}$ 和 $I_x^{(2)}$。\n- 在弱耦合和高场近似下，两个自旋的内部哈密顿量（以角频率单位表示）为 $H = 2\\pi\\left(\\omega_1 I_z^{(1)} + \\omega_2 I_z^{(2)} + J\\, I_z^{(1)} I_z^{(2)}\\right)$，其中 $\\omega_1$ 和 $\\omega_2$ 是以赫兹为单位的共振偏移，J 是以赫兹为单位的标量耦合。需要时，单位算符通过张量积隐式包含。\n- 一个绕 $x$ 轴旋转角度为 $\\theta$ 的非选择性射频脉冲由幺正算符 $U_x(\\theta) = \\exp\\!\\left(-i\\,\\theta\\,\\left(I_x^{(1)} + I_x^{(2)}\\right)\\right)$ 表示。角度必须以弧度为单位指定。\n\n考虑以下简化的INADEQUATE脉冲序列，该序列旨在创建和转换回双量子（DQ）相干：\n\n1. 初始化密度算符为 $\\rho_0 = I_z^{(1)} + I_z^{(2)}$。\n2. 施加一个绕 $x$ 轴的非选择性 $90^\\circ$ 脉冲：$\\rho_1 = U_x(\\pi/2)\\,\\rho_0\\,U_x(\\pi/2)^\\dagger$。\n3. 在哈密顿量 $H$ 下自由演化延迟 $\\tau$：$\\rho_2 = U(\\tau)\\,\\rho_1\\,U(\\tau)^\\dagger$，其中 $U(\\tau) = \\exp\\!\\left(-i\\,H\\,\\tau\\right)$。\n4. 施加第二个绕 $x$ 轴的非选择性 $90^\\circ$ 脉冲：$\\rho_3 = U_x(\\pi/2)\\,\\rho_2\\,U_x(\\pi/2)^\\dagger$。\n5. 在哈密顿量 $H$ 下自由演化一个间接演化时间 $t_1$：$\\rho_4 = U(t_1)\\,\\rho_3\\,U(t_1)^\\dagger$。\n6. 施加第三个绕 $x$ 轴的非选择性 $90^\\circ$ 脉冲以转换回相干：$\\rho_5 = U_x(\\pi/2)\\,\\rho_4\\,U_x(\\pi/2)^\\dagger$。\n\n在检测点，定义横向检测算符为 $A = I_x^{(1)} + I_x^{(2)}$。在采集时间 $t_2 = 0$ 时，通过希尔伯特-施密特内积计算无量纲的归一化可观测信号幅度 $S$：\n$$\nS = \\mathrm{Re}\\left(\\frac{\\mathrm{Tr}\\!\\left(A\\,\\rho_5\\right)}{\\sqrt{\\mathrm{Tr}\\!\\left(A^2\\right)\\,\\mathrm{Tr}\\!\\left(\\rho_5^2\\right)}}\\right).\n$$\n这种归一化确保 $S \\in [-1,1]$。\n\n物理单位和约定：\n- 频率 $\\omega_1$、$\\omega_2$ 和 $J$ 必须以赫兹为单位提供。\n- 演化延迟 $\\tau$ 和 $t_1$ 必须以秒为单位提供。\n- 脉冲翻转角必须以弧度为单位。\n- 最终结果 $S$ 必须是无量纲的。\n\n请实现上述模拟，并为构成测试套件的以下每个测试用例计算 $S$：\n\n- 用例 1（通用理想路径）：$(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 50, 0.01, 0.004)$。\n- 用例 2（无耦合边界）：$(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 0, 0.01, 0.004)$。\n- 用例 3（无演化边界）：$(\\omega_1, \\omega_2, J, \\tau, t_1) = (100, 120, 50, 0.0, 0.004)$。\n- 用例 4（大偏移边缘情况）：$(\\omega_1, \\omega_2, J, \\tau, t_1) = (500, 1000, 35, 1/(2\\cdot 35), 0.003)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[$s_1$,$s_2$,$s_3$,$s_4$]”），其中每个 $s_k$ 是相应测试用例计算出的 $S$ 的浮点值。",
            "solution": "问题陈述经评估有效。它在科学上基于核磁共振（NMR）波谱学原理，信息完备、问题明确，并且语言客观。任务是使用密度矩阵形式为一个双自旋系统模拟一个简化的“不可思议的自然丰度双量子转移实验”（INADEQUATE）。\n\n解决方案的开发首先构建代表自旋系统及其相互作用的数学算符，然后模拟系统密度矩阵在指定脉冲序列下的演化。\n\n**1. 双自旋-1/2系统的数学框架**\n\n该系统由两个自旋-$\\frac{1}{2}$的原子核组成。这样一个系统的量子态在维度为 $2 \\times 2 = 4$ 的希尔伯特空间中描述，该空间是单个自旋空间的张量积：$\\mathbb{C}^2 \\otimes \\mathbb{C}^2$。所有算符都表示为 $4 \\times 4$ 的复数矩阵。\n\n基本的单自旋算符使用泡利矩阵定义：\n$$\n\\sigma_x = \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix}, \\quad\n\\sigma_y = \\begin{pmatrix} 0  -i \\\\ i  0 \\end{pmatrix}, \\quad\n\\sigma_z = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\end{pmatrix}, \\quad\n\\mathbb{1}_2 = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n笛卡尔自旋角动量算符由 $I_k = \\frac{1}{2}\\sigma_k$ 给出，其中 $k \\in \\{x, y, z\\}$。\n\n对于双自旋系统，自旋1的算符通过克罗内克积 $I_k^{(1)} = I_k \\otimes \\mathbb{1}_2$ 形成，自旋2的算符则通过 $I_k^{(2)} = \\mathbb{1}_2 \\otimes I_k$ 形成。例如：\n$$\nI_x^{(1)} = \\frac{1}{2} \\sigma_x \\otimes \\mathbb{1}_2 = \\frac{1}{2} \\begin{pmatrix} 0  0  1  0 \\\\ 0  0  0  1 \\\\ 1  0  0  0 \\\\ 0  1  0  0 \\end{pmatrix}, \\quad\nI_z^{(2)} = \\mathbb{1}_2 \\otimes \\frac{1}{2} \\sigma_z = \\frac{1}{2} \\begin{pmatrix} 1  0  0  0 \\\\ 0  -1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  -1 \\end{pmatrix}\n$$\n双自旋相互作用项由这些算符的乘积形成，例如，$I_z^{(1)}I_z^{(2)} = (I_z \\otimes \\mathbb{1}_2)(\\mathbb{1}_2 \\otimes I_z) = I_z \\otimes I_z$。\n\n**2. 哈密顿量和传播子**\n\n内部哈密顿量 $H$ 控制着自旋系统在旋转坐标系中的自由演化，以角频率单位表示为：\n$$\nH = 2\\pi \\left(\\omega_1 I_z^{(1)} + \\omega_2 I_z^{(2)} + J\\, I_z^{(1)} I_z^{(2)}\\right)\n$$\n其中 $\\omega_1$ 和 $\\omega_2$ 是以赫兹为单位的化学位移偏移，J 是以赫兹为单位的标量耦合常数。$2\\pi$ 因子将频率从 Hz 转换为 rad/s。\n\n密度矩阵 $\\rho$ 在时间间隔 $t$ 内的演化由刘维尔-冯·诺伊曼方程描述，其对于不含时哈密顿量的解是一个幺正变换：\n$$\n\\rho(t) = U(t) \\, \\rho(0) \\, U(t)^\\dagger\n$$\n其中传播子 $U(t)$ 是哈密顿量的矩阵指数：\n$$\nU(t) = \\exp(-i H t)\n$$\n射频（RF）脉冲也是幺正变换。一个绕 $x$ 轴、角度为 $\\theta$ 的非选择性脉冲由算符表示：\n$$\nU_x(\\theta) = \\exp\\left(-i \\theta \\left(I_x^{(1)} + I_x^{(2)}\\right)\\right)\n$$\n\n**3. INADEQUATE脉冲序列的模拟**\n\n模拟按步进行，在每个阶段将适当的传播子应用于密度矩阵。\n\n1.  **初始状态**：系统从热平衡状态开始，在高温近似下，这与净纵向磁化成正比。\n    $$\n    \\rho_0 = I_z^{(1)} + I_z^{(2)}\n    $$\n\n2.  **第一个脉冲**：施加一个绕 $x$ 轴的非选择性 $90^\\circ$（$\\pi/2$ 弧度）脉冲。\n    $$\n    \\rho_1 = U_x(\\pi/2) \\, \\rho_0 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n3.  **第一个演化周期**：系统在哈密顿量 $H$ 下自由演化一段时间 $\\tau$。\n    $$\n    \\rho_2 = U(\\tau) \\, \\rho_1 \\, U(\\tau)^\\dagger, \\quad \\text{其中 } U(\\tau) = \\exp(-iH\\tau)\n    $$\n\n4.  **第二个脉冲**：施加另一个绕 $x$ 轴的非选择性 $90^\\circ$ 脉冲。这一步对于将反相相干转换为双量子相干至关重要。\n    $$\n    \\rho_3 = U_x(\\pi/2) \\, \\rho_2 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n5.  **第二个演化周期**：系统演化一个间接演化时间 $t_1$。双量子相干以化学位移之和 $(\\omega_1 + \\omega_2)$ 演化。\n    $$\n    \\rho_4 = U(t_1) \\, \\rho_3 \\, U(t_1)^\\dagger, \\quad \\text{其中 } U(t_1) = \\exp(-iHt_1)\n    $$\n\n6.  **第三个脉冲**：最后一个绕 $x$ 轴的 $90^\\circ$ 脉冲将双量子相干转换回可观测的单量子相干。\n    $$\n    \\rho_5 = U_x(\\pi/2) \\, \\rho_4 \\, U_x(\\pi/2)^\\dagger\n    $$\n\n**4. 可观测信号的计算**\n\n在采集开始时（$t_2=0$）的可观测信号 $S$ 是横向检测算符 $A = I_x^{(1)} + I_x^{(2)}$ 的期望值，该值投影到密度矩阵的最终状态 $\\rho_5$ 上。问题为该信号定义了一个特定的归一化：\n$$\nS = \\mathrm{Re}\\left(\\frac{\\mathrm{Tr}(A\\,\\rho_5)}{\\sqrt{\\mathrm{Tr}(A^2)\\,\\mathrm{Tr}(\\rho_5^2)}}\\right)\n$$\n迹运算 $\\mathrm{Tr}(X)$ 计算矩阵 $X$ 的对角元素之和。项 $\\mathrm{Tr}(A\\rho_5)$ 是两个算符的希尔伯特-施密特内积。\n\n分母中的归一化因子可以简化。首先，考虑 $\\mathrm{Tr}(A^2)$：\n$$\n\\mathrm{Tr}(A^2) = \\mathrm{Tr}\\left((I_x^{(1)} + I_x^{(2)})^2\\right) = \\mathrm{Tr}((I_x^{(1)})^2) + \\mathrm{Tr}((I_x^{(2)})^2) + 2\\mathrm{Tr}(I_x^{(1)}I_x^{(2)})\n$$\n对于任何自旋-$\\frac{1}{2}$算符 $I_k$，$(I_k)^2 = \\frac{1}{4}\\mathbb{1}_2$。因此，$\\mathrm{Tr}((I_k^{(1)})^2) = \\mathrm{Tr}(\\frac{1}{4}\\mathbb{1}_4) = 1$。类似地，$\\mathrm{Tr}((I_k^{(2)})^2) = 1$。并且，$\\mathrm{Tr}(I_x^{(1)}I_x^{(2)}) = \\mathrm{Tr}(I_x \\otimes I_x) = \\mathrm{Tr}(I_x)\\mathrm{Tr}(I_x) = 0 \\cdot 0 = 0$。\n因此，$\\mathrm{Tr}(A^2) = 1 + 1 + 0 = 2$。\n\n接下来，考虑 $\\mathrm{Tr}(\\rho_5^2)$。由于脉冲序列中的所有变换都是幺正的，所以密度矩阵平方的迹是一个守恒量：对于所有 $k$，$\\mathrm{Tr}(\\rho_k^2) = \\mathrm{Tr}(\\rho_0^2)$。\n$$\n\\mathrm{Tr}(\\rho_0^2) = \\mathrm{Tr}\\left((I_z^{(1)} + I_z^{(2)})^2\\right) = \\mathrm{Tr}((I_z^{(1)})^2) + \\mathrm{Tr}((I_z^{(2)})^2) + 2\\mathrm{Tr}(I_z^{(1)}I_z^{(2)}) = 1 + 1 + 0 = 2\n$$\n因此，归一化常数为 $\\sqrt{\\mathrm{Tr}(A^2)\\mathrm{Tr}(\\rho_5^2)} = \\sqrt{2 \\cdot 2} = 2$。\n\n可观测信号的最终表达式简化为：\n$$\nS = \\frac{1}{2} \\mathrm{Re}\\left(\\mathrm{Tr}\\left(A\\,\\rho_5\\right)\\right)\n$$\n计算实现将构建必要的矩阵和传播子，执行矩阵乘法序列以找到 $\\rho_5$，然后对每个给定的测试用例使用此简化公式计算 $S$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Simulates a simplified INADEQUATE NMR experiment for a two-spin-1/2 system.\n    The simulation uses the density matrix formalism and computes the final observable signal.\n    \"\"\"\n    \n    # Define test cases as tuples: (w1, w2, J, tau, t1)\n    # w1, w2, J are in Hz; tau, t1 are in seconds.\n    test_cases = [\n        (100.0, 120.0, 50.0, 0.01, 0.004),\n        (100.0, 120.0, 0.0, 0.01, 0.004),\n        (100.0, 120.0, 50.0, 0.0, 0.004),\n        (500.0, 1000.0, 35.0, 1.0 / (2.0 * 35.0), 0.003),\n    ]\n\n    results = []\n\n    # Define base spin-1/2 operators (Pauli matrices / 2) and identity\n    I2 = np.identity(2, dtype=complex)\n    Sx = 0.5 * np.array([[0, 1], [1, 0]], dtype=complex)\n    Sy = 0.5 * np.array([[0, -1j], [1j, 0]], dtype=complex)\n    Sz = 0.5 * np.array([[1, 0], [0, -1]], dtype=complex)\n\n    # Construct two-spin operators using the Kronecker product\n    # Spin 1 operators\n    Ix1 = np.kron(Sx, I2)\n    Iy1 = np.kron(Sy, I2)\n    Iz1 = np.kron(Sz, I2)\n    \n    # Spin 2 operators\n    Ix2 = np.kron(I2, Sx)\n    Iy2 = np.kron(I2, Sy)\n    Iz2 = np.kron(I2, Sz)\n    \n    # Two-spin interaction term\n    Iz1z2 = np.kron(Sz, Sz)\n\n    # Total operators for pulses and detection\n    Ix_tot = Ix1 + Ix2\n    Iz_tot = Iz1 + Iz2\n\n    # Initial density operator rho_0 = Iz_tot\n    rho_0 = Iz_tot\n    \n    # Detection operator A = Ix_tot\n    A = Ix_tot\n    \n    # Pre-calculate the propagator for a 90-degree pulse about x\n    theta_90 = np.pi / 2.0\n    Ux_90 = expm(-1j * theta_90 * Ix_tot)\n    Ux_90_dag = Ux_90.conj().T\n\n    for case in test_cases:\n        w1, w2, J, tau, t1 = case\n\n        # 1. Construct the Hamiltonian for the current case (in rad/s)\n        H = 2.0 * np.pi * (w1 * Iz1 + w2 * Iz2 + J * Iz1z2)\n\n        # 2. Simulate the pulse sequence\n        # rho_0 is the initial state\n        \n        # Step 1: 90-degree pulse about x\n        rho_1 = Ux_90 @ rho_0 @ Ux_90_dag\n        \n        # Step 2: Free evolution for time tau\n        U_tau = expm(-1j * H * tau)\n        U_tau_dag = U_tau.conj().T\n        rho_2 = U_tau @ rho_1 @ U_tau_dag\n        \n        # Step 3: Second 90-degree pulse about x\n        rho_3 = Ux_90 @ rho_2 @ Ux_90_dag\n        \n        # Step 4: Free evolution for time t1\n        U_t1 = expm(-1j * H * t1)\n        U_t1_dag = U_t1.conj().T\n        rho_4 = U_t1 @ rho_3 @ U_t1_dag\n        \n        # Step 5: Third 90-degree pulse about x (reconversion)\n        rho_5 = Ux_90 @ rho_4 @ Ux_90_dag\n        \n        # 3. Calculate the observable signal S\n        # S = Re( Tr(A * rho_5) / sqrt(Tr(A*A) * Tr(rho_5*rho_5)) )\n        # As derived, the denominator sqrt(Tr(A^2) * Tr(rho_0^2)) is sqrt(2*2) = 2.\n        \n        numerator = np.trace(A @ rho_5)\n        # Denominator is constant, but can be calculated for verification:\n        # tr_A2 = np.trace(A @ A)\n        # tr_rho5_2 = np.trace(rho_5 @ rho_5) # Should be equal to Tr(rho_0^2)\n        # denominator = np.sqrt(tr_A2 * tr_rho5_2)\n        denominator = 2.0\n        \n        S = np.real(numerator / denominator)\n        results.append(S)\n\n    # Format the final output as specified\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}