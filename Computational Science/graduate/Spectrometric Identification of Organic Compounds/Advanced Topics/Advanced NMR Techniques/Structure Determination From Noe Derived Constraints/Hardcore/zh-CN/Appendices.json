{
    "hands_on_practices": [
        {
            "introduction": "在利用NOE数据进行结构解析之前，我们必须首先从根本上理解其定量行为。这项练习将带您回到描述偶极弛豫的基本物理模型——所罗门方程。通过亲手推导瞬态NOE信号的表达式，您将深刻体会到信号强度如何依赖于混合时间 $t_m$、交叉弛豫速率 $\\sigma_{AB}$ 和自弛豫速率 $R_A$、$R_B$，为理解“初始速率近似”及其局限性打下坚实的理论基础 。",
            "id": "3726091",
            "problem": "一个有机分子中由核自旋 $A$ 和 $B$ 组成的双自旋系统，通过瞬态核奥弗豪瑟效应 (NOE) 差分实验进行探测，以获得用于结构测定的质子间距离约束。设纵向自旋-晶格弛豫时间为 $T_{1A}$ 和 $T_{1B}$，相应的弛豫速率为 $R_{A} = 1/T_{1A}$ 和 $R_{B} = 1/T_{1B}$。设 $A$ 和 $B$ 之间的交叉弛豫速率（偶极交叉弛豫）为 $\\sigma_{AB}$，平衡纵向磁化强度为 $M_{A}^{\\mathrm{eq}}$ 和 $M_{B}^{\\mathrm{eq}}$。在脉冲序列中，自旋 $B$ 的纵向磁化强度在 $t=0$ 时被反转，使得 $M_{B}(0) = - M_{B}^{\\mathrm{eq}}$，而自旋 $A$ 保持在平衡态，使得 $M_{A}(0) = M_{A}^{\\mathrm{eq}}$。然后，系统在混合时间 $t_{m}$ 内于交叉弛豫和自弛豫作用下演化，之后观测自旋 $A$ 的纵向磁化强度。在所述初始条件下，NOE 差分信号定义为 $\\Delta M_{A}(t_{m}) = M_{A}(t_{m}) - M_{A}^{\\mathrm{eq}}$。\n\n从描述双自旋纵向弛豫和交叉弛豫的 Solomon 方程出发，推导出一个关于 $\\Delta M_{A}(t_{m})$ 的闭合形式解析表达式，该表达式用 $R_{A}$、$R_{B}$、$\\sigma_{AB}$、$M_{A}^{\\mathrm{eq}}$、$M_{B}^{\\mathrm{eq}}$ 和 $t_{m}$ 表示。仅使用广为接受的物理定律和定义，并清楚地说明你所使用的任何变量变换。在你的推导中，简要论证 $\\Delta M_{A}(t_{m})$ 的初始增长与 $t_{m}$ 呈线性关系的条件，以及哪些参数控制着线性关系的破坏，但你的最终答案仅需表示为 $\\Delta M_{A}(t_{m})$ 的显式闭合形式表达式。\n\n将最终答案表示为一个符号数学表达式。无需进行数值近似或四舍五入。",
            "solution": "问题要求推导一个双自旋系统 ($A, B$) 的瞬态核奥弗豪瑟效应 (NOE) 差分信号 $\\Delta M_{A}(t_{m})$ 的闭合形式表达式。推导从 Solomon 方程开始，该方程描述了在偶极弛豫存在下纵向核自旋磁化强度随时间的演化。\n\n双自旋系统的 Solomon 方程为：\n$$\n\\frac{dM_A(t)}{dt} = -R_A (M_A(t) - M_A^{\\mathrm{eq}}) - \\sigma_{AB} (M_B(t) - M_B^{\\mathrm{eq}})\n$$\n$$\n\\frac{dM_B(t)}{dt} = -R_B (M_B(t) - M_B^{\\mathrm{eq}}) - \\sigma_{AB} (M_A(t) - M_A^{\\mathrm{eq}})\n$$\n在此表达式中，$R_A$ 和 $R_B$ 表示纵向自弛豫速率（也称为外部或泄漏弛豫速率），$\\sigma_{AB}$ 是自旋 $A$ 和 $B$ 之间的交叉弛豫速率。$M_A^{\\mathrm{eq}}$ 和 $M_B^{\\mathrm{eq}}$ 是热平衡时的磁化强度。\n\n为了简化求解，我们定义新变量来表示磁化强度与平衡态的偏差：\n$$\nm_A(t) = M_A(t) - M_A^{\\mathrm{eq}}\n$$\n$$\nm_B(t) = M_B(t) - M_B^{\\mathrm{eq}}\n$$\n其时间导数为 $\\frac{dm_A}{dt} = \\frac{dM_A}{dt}$ 和 $\\frac{dm_B}{dt} = \\frac{dM_B}{dt}$。将这些代入 Solomon 方程，得到一个齐次线性微分方程组：\n$$\n\\frac{dm_A(t)}{dt} = -R_A m_A(t) - \\sigma_{AB} m_B(t)\n$$\n$$\n\\frac{dm_B(t)}{dt} = -\\sigma_{AB} m_A(t) - R_B m_B(t)\n$$\n瞬态 NOE 实验的初始条件为 $M_A(0) = M_A^{\\mathrm{eq}}$（自旋 $A$ 处于平衡态）和 $M_B(0) = -M_B^{\\mathrm{eq}}$（自旋 $B$ 被反转）。用新变量表示，在 $t=0$ 时的这些条件是：\n$$\nm_A(0) = M_A(0) - M_A^{\\mathrm{eq}} = M_A^{\\mathrm{eq}} - M_A^{\\mathrm{eq}} = 0\n$$\n$$\nm_B(0) = M_B(0) - M_B^{\\mathrm{eq}} = -M_B^{\\mathrm{eq}} - M_B^{\\mathrm{eq}} = -2 M_B^{\\mathrm{eq}}\n$$\n我们求解这个耦合一阶常微分方程组。该系统可以写成矩阵形式 $\\frac{d\\mathbf{m}}{dt} = \\mathbf{K} \\mathbf{m}$，其中 $\\mathbf{m}(t) = \\begin{pmatrix} m_A(t) \\\\ m_B(t) \\end{pmatrix}$，速率矩阵 $\\mathbf{K}$ 为 $\\mathbf{K} = \\begin{pmatrix} -R_A   -\\sigma_{AB} \\\\ -\\sigma_{AB}   -R_B \\end{pmatrix}$。\n\n解由 $\\mathbf{K}$ 的特征值决定。特征方程为 $\\det(\\mathbf{K} - \\lambda\\mathbf{I}) = 0$：\n$$\n(-R_A - \\lambda)(-R_B - \\lambda) - \\sigma_{AB}^2 = 0\n$$\n$$\n\\lambda^2 + (R_A + R_B)\\lambda + (R_A R_B - \\sigma_{AB}^2) = 0\n$$\n特征值 $\\lambda_{\\pm}$ 由二次公式给出：\n$$\n\\lambda_{\\pm} = \\frac{-(R_A + R_B) \\pm \\sqrt{(R_A + R_B)^2 - 4(R_A R_B - \\sigma_{AB}^2)}}{2}\n$$\n$$\n\\lambda_{\\pm} = \\frac{-(R_A + R_B) \\pm \\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}}{2}\n$$\n$m_A(t)$ 的通解是带有这些特征值作为速率的指数项的线性组合：\n$$\nm_A(t) = C_1 \\exp(\\lambda_+ t) + C_2 \\exp(\\lambda_- t)\n$$\n系数 $C_1$ 和 $C_2$ 由初始条件确定。首先，我们使用第一个微分方程将 $m_B(t)$ 与 $m_A(t)$ 关联起来：$m_B(t) = -\\frac{1}{\\sigma_{AB}}\\left(\\frac{dm_A}{dt} + R_A m_A\\right)$。\n在 $t=0$ 时，我们有：\n$m_A(0) = C_1 + C_2 = 0 \\implies C_2 = -C_1$。\n$m_B(0) = -\\frac{1}{\\sigma_{AB}}\\left( (C_1\\lambda_+ + C_2\\lambda_-) + R_A(C_1 + C_2) \\right) = -2M_B^{\\mathrm{eq}}$。\n代入 $C_2=-C_1$ 和 $C_1+C_2=0$：\n$m_B(0) = -\\frac{1}{\\sigma_{AB}}(C_1\\lambda_+ - C_1\\lambda_-) = -\\frac{C_1}{\\sigma_{AB}}(\\lambda_+ - \\lambda_-) = -2M_B^{\\mathrm{eq}}$。\n求解 $C_1$：\n$$\nC_1 = \\frac{2 M_B^{\\mathrm{eq}} \\sigma_{AB}}{\\lambda_+ - \\lambda_-}\n$$\n特征值之差为：\n$$\n\\lambda_+ - \\lambda_- = \\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}\n$$\n因此，系数为：\n$$\nC_1 = \\frac{2 M_B^{\\mathrm{eq}} \\sigma_{AB}}{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}} \\quad \\text{and} \\quad C_2 = -C_1\n$$\n$m_A(t)$ 的解为：\n$$\nm_A(t) = C_1 (\\exp(\\lambda_+ t) - \\exp(\\lambda_- t)) = \\frac{2 M_B^{\\mathrm{eq}} \\sigma_{AB}}{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}} (\\exp(\\lambda_+ t) - \\exp(\\lambda_- t))\n$$\n我们感兴趣的量是 $\\Delta M_A(t_m) = M_A(t_m) - M_A^{\\mathrm{eq}} = m_A(t_m)$。为了得到更紧凑的形式，我们从指数项中提出特征值的公共部分，并使用双曲正弦函数的定义 $\\sinh(x) = \\frac{\\exp(x) - \\exp(-x)}{2}$：\n$$\n\\exp(\\lambda_+ t_m) - \\exp(\\lambda_- t_m) = \\exp\\left(-\\frac{R_A+R_B}{2}t_m\\right) \\left[ \\exp\\left(\\frac{\\sqrt{\\dots}}{2}t_m\\right) - \\exp\\left(-\\frac{\\sqrt{\\dots}}{2}t_m\\right) \\right]\n$$\n$$\n= 2\\exp\\left(-\\frac{R_A+R_B}{2}t_m\\right) \\sinh\\left(\\frac{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}}{2}t_m\\right)\n$$\n将此代入 $m_A(t_m)$ 的表达式，得到最终的闭合形式表达式：\n$$\n\\Delta M_A(t_m) = \\frac{4 M_B^{\\mathrm{eq}} \\sigma_{AB}}{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}} \\exp\\left(-\\frac{R_A+R_B}{2} t_m\\right) \\sinh\\left(\\frac{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}}{2} t_m\\right)\n$$\n\nNOE 的初始建立过程可以通过取表达式在 $t_m \\to 0$ 时的极限来分析。对于小的 $x$，$\\sinh(x) \\approx x$ 且 $\\exp(-ax) \\approx 1$。\n$$\n\\Delta M_A(t_m) \\approx \\frac{4 M_B^{\\mathrm{eq}} \\sigma_{AB}}{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}} (1) \\left(\\frac{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}}{2} t_m\\right) = 2 M_B^{\\mathrm{eq}} \\sigma_{AB} t_m\n$$\n这表明对于短的混合时间 $t_m$，NOE 差分信号 $\\Delta M_A(t_m)$ 以 $2\\sigma_{AB}M_B^{\\mathrm{eq}}$ 的速率线性增长。当 $t_m$ 变大，指数项和双曲正弦项不能再用其泰勒级数的第一项来近似时，线性关系就会被破坏。这种破坏由弛豫速率 $R_A$、$R_B$ 和 $\\sigma_{AB}$ 决定，这些速率定义了系统的特征时间常数 $|1/\\lambda_+|$ 和 $|1/\\lambda_-|$。线性近似仅在 $t_m$ 远小于这些时间常数时有效。",
            "answer": "$$ \\boxed{ \\frac{4 M_{B}^{\\mathrm{eq}} \\sigma_{AB}}{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}} \\exp\\left(-\\frac{R_A+R_B}{2} t_m\\right) \\sinh\\left(\\frac{\\sqrt{(R_A - R_B)^2 + 4\\sigma_{AB}^2}}{2} t_m\\right) } $$"
        },
        {
            "introduction": "虽然双自旋体系具有很好的教学意义，但真实的分子拥有复杂的质子相互作用网络。这项练习将利用强大的全弛豫矩阵方法，将我们对NOE的理解从简单的双自旋体系推广到更符合实际的多自旋体系。这项计算实践连接了理论公式与真实的谱图信号强度，通过亲手实现这个计算过程，您将看到直接NOE和间接的自旋扩散效应是如何统一在单一个矩阵指数运算中的 。",
            "id": "3726036",
            "problem": "在核奥弗豪塞尔效应 (NOE) 混合期内，通过核磁共振 (NMR) 观测到的质子网络可以使用一个全弛豫矩阵框架进行建模。考虑一个由 $n$ 个耦合质子纵向磁化强度组成的系统，其集合为一个向量 $\\mathbf{M}(t) \\in \\mathbb{R}^n$，在混合期内根据一个时不变线性系统演化。全弛豫矩阵 $\\mathbf{R} \\in \\mathbb{R}^{n \\times n}$ 在对角线上编码了自弛豫速率，在非对角线上编码了交叉弛豫速率，混合时间为 $t_m$，单位为秒。此处，混合期结束时从自旋 $j$ 到自旋 $i$ 的交叉峰强度定义为：当初始条件为分量 $j$ 上具有单位磁化强度而所有其他分量为零时，将磁化强度从分量 $j$ 转移到分量 $i$ 的时间传播算符的元素；这等效于在时间 $t_m$ 处求值的传播子的非对角元。\n\n从耦合一阶线性常微分方程 $\\frac{d\\mathbf{M}}{dt} = -\\mathbf{R}\\,\\mathbf{M}$ 和矩阵指数作为此类时不变系数线性系统的唯一解算符的定义出发，推导一个算法来计算在时间 $t_m$ 处的传播子，然后提取其非对角元作为交叉峰强度。为以下测试套件数值实现此算法。在每个测试中，通过对 $\\mathbf{R}$（给定的矩阵是对称的）进行正交对角化来计算 $-\\mathbf{R}\\,t_m$ 的矩阵指数，从而得到传播子 $\\mathbf{P}(t_m)$，然后按下述顺序提取指定的非对角元 $\\mathbf{P}_{i j}(t_m)$。将所有最终数值结果表示为无量纲浮点数，四舍五入到 $6$ 位小数。混合时间 $t_m$ 必须以秒为单位处理。\n\n测试套件：\n- 测试 $1$ (理想情况)：$n=3$，其中\n$$\n\\mathbf{R} = \\begin{bmatrix}\n1.00   -0.05  -0.02 \\\\\n-0.05  0.90   -0.03 \\\\\n-0.02  -0.03  1.10\n\\end{bmatrix}\n$$\n单位为 $\\mathrm{s}^{-1}$，且 $t_m = 0.50$ $\\mathrm{s}$。按此顺序提取非对角元：$(1,2),(1,3),(2,1),(2,3),(3,1),(3,2)$，即先提取 $\\mathbf{P}_{1,2}$，然后是 $\\mathbf{P}_{1,3}$，接着是 $\\mathbf{P}_{2,1}$，依此类推。\n\n- 测试 $2$ (边缘情况，零交叉弛豫)：$n=3$，其中\n$$\n\\mathbf{R} = \\begin{bmatrix}\n1.00   0.00  0.00 \\\\\n0.00   0.80  0.00 \\\\\n0.00   0.00  1.20\n\\end{bmatrix}\n$$\n单位为 $\\mathrm{s}^{-1}$，且 $t_m = 0.50$ $\\mathrm{s}$。按相同顺序提取元素：$(1,2),(1,3),(2,1),(2,3),(3,1),(3,2)$。\n\n- 测试 $3$ (边界条件，零混合时间)：$n=3$，其中\n$$\n\\mathbf{R} = \\begin{bmatrix}\n1.10   -0.04  -0.01 \\\\\n-0.04  1.00   -0.02 \\\\\n-0.01  -0.02  0.90\n\\end{bmatrix}\n$$\n单位为 $\\mathrm{s}^{-1}$，且 $t_m = 0.00$ $\\mathrm{s}$。按相同顺序提取元素：$(1,2),(1,3),(2,1),(2,3),(3,1),(3,2)$。\n\n- 测试 $4$ (更强耦合，4 个自旋)：$n=4$，其中\n$$\n\\mathbf{R} = \\begin{bmatrix}\n1.20   -0.12  -0.08  0.00 \\\\\n-0.12  1.00   -0.10  -0.06 \\\\\n-0.08  -0.10  0.90   -0.09 \\\\\n0.00   -0.06  -0.09  1.10\n\\end{bmatrix}\n$$\n单位为 $\\mathrm{s}^{-1}$，且 $t_m = 1.00$ $\\mathrm{s}$。按此顺序提取非对角元：$(1,2),(1,3),(1,4),(2,1),(2,3),(2,4),(3,1),(3,2),(3,4),(4,1),(4,2),(4,3)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 `[r_1,r_2,r_3]`）。该列表必须包含所有四个测试中所有请求条目的舍入浮点值，并按照每个测试上方指定的精确提取顺序连接。此行前后不应打印任何额外文本。",
            "solution": "该问题要求一个数值算法来计算传播子矩阵的非对角元，该矩阵模拟了 NOE 实验中核自旋磁化强度的演化。推导从线性系统和矩阵代数的基本原理出发。\n\n纵向磁化强度向量 $\\mathbf{M}(t)$ 的演化由以下耦合、一阶、常系数线性常微分方程组描述：\n$$\n\\frac{d\\mathbf{M}(t)}{dt} = -\\mathbf{R}\\mathbf{M}(t)\n$$\n其中 $\\mathbf{R}$ 是时不变的弛豫矩阵。给定时间 $t=0$ 时的初始状态 $\\mathbf{M}(0)$，该初值问题的唯一解为：\n$$\n\\mathbf{M}(t) = e^{-\\mathbf{R}t} \\mathbf{M}(0)\n$$\n矩阵 $\\mathbf{P}(t) = e^{-\\mathbf{R}t}$ 是系统的传播子；它将状态向量从时间 $0$ 变换到时间 $t$。问题要求在特定混合时间 $t_m$ 处的交叉峰强度，其定义为传播子矩阵 $\\mathbf{P}(t_m) = e^{-\\mathbf{R}t_m}$ 的非对角元。\n\n我们的任务是计算矩阵指数 $e^{\\mathbf{A}}$，其中 $\\mathbf{A} = -\\mathbf{R}t_m$。问题指明弛豫矩阵 $\\mathbf{R}$ 是实对称矩阵。线性代数中的一个基本定理指出，任何实对称矩阵都是可正交对角化的。这意味着我们可以用其特征值和特征向量将 $\\mathbf{R}$ 写成：\n$$\n\\mathbf{R} = \\mathbf{V} \\mathbf{\\Lambda} \\mathbf{V}^{-1} = \\mathbf{V} \\mathbf{\\Lambda} \\mathbf{V}^T\n$$\n此处，$\\mathbf{\\Lambda}$ 是一个对角矩阵，其元素 $\\mathbf{\\Lambda}_{kk} = \\lambda_k$ 是 $\\mathbf{R}$ 的特征值。$\\mathbf{V}$ 是一个正交矩阵，其列是 $\\mathbf{R}$ 对应的归一化特征向量。$\\mathbf{V}$ 的正交性意味着其逆矩阵等于其转置矩阵，即 $\\mathbf{V}^{-1} = \\mathbf{V}^T$。\n\n这种分解极大地简化了矩阵指数的计算。我们可以将矩阵 $\\mathbf{A} = -\\mathbf{R}t_m$ 写成：\n$$\n\\mathbf{A} = -(\\mathbf{V} \\mathbf{\\Lambda} \\mathbf{V}^T)t_m = \\mathbf{V}(-\\mathbf{\\Lambda}t_m)\\mathbf{V}^T\n$$\n一个已对角化为 $\\mathbf{X} = \\mathbf{V}\\mathbf{D}\\mathbf{V}^T$（其中 $\\mathbf{D}$ 是对角矩阵）的矩阵 $\\mathbf{X}$ 的指数由以下公式给出：\n$$\ne^{\\mathbf{X}} = \\mathbf{V} e^{\\mathbf{D}} \\mathbf{V}^T\n$$\n对角矩阵的指数 $e^{\\mathbf{D}}$ 就是一个对角矩阵，其元素是原始对角元素的指数。将此应用于我们的矩阵 $\\mathbf{A}$：\n$$\n\\mathbf{P}(t_m) = e^{\\mathbf{A}} = e^{\\mathbf{V}(-\\mathbf{\\Lambda}t_m)\\mathbf{V}^T} = \\mathbf{V} e^{-\\mathbf{\\Lambda}t_m} \\mathbf{V}^T\n$$\n矩阵 $e^{-\\mathbf{\\Lambda}t_m}$ 是一个对角矩阵，其元素为 $(e^{-\\mathbf{\\Lambda}t_m})_{kk} = e^{-\\lambda_k t_m}$。\n\n这导出了以下计算算法：\n1.  给定弛豫矩阵 $\\mathbf{R}$ 和混合时间 $t_m$。\n2.  对对称矩阵 $\\mathbf{R}$ 进行特征分解，以获得其特征值 $\\lambda_k$ 和特征向量的正交矩阵 $\\mathbf{V}$。\n3.  构造一个对角矩阵，我们称之为 $\\mathbf{D}_{\\text{exp}}$，其对角元为 $e^{-\\lambda_k t_m}$。\n4.  通过执行矩阵乘法 $\\mathbf{P}(t_m) = \\mathbf{V} \\mathbf{D}_{\\text{exp}} \\mathbf{V}^T$ 来计算最终的传播子矩阵 $\\mathbf{P}(t_m)$。\n5.  从结果矩阵中提取指定的非对角元 $\\mathbf{P}_{ij}(t_m)$。\n6.  按要求将每个提取的值四舍五入到 $6$ 位小数。\n\n该算法将针对每个测试案例实施。\n对于 $t_m = 0.0$ $\\mathrm{s}$ 的边界情况（测试 3），传播子为 $\\mathbf{P}(0) = e^{-\\mathbf{R} \\cdot 0} = e^{\\mathbf{0}} = \\mathbf{I}$，其中 $\\mathbf{0}$ 是零矩阵，$\\mathbf{I}$ 是单位矩阵。因此，所有非对角元预期为 $0$。\n对于 $\\mathbf{R}$ 是对角矩阵的边缘情况（测试 2），其特征向量是标准基向量，因此 $\\mathbf{V} = \\mathbf{I}$。传播子变为 $\\mathbf{P}(t_m) = \\mathbf{I} e^{-\\mathbf{R}t_m} \\mathbf{I}^T = e^{-\\mathbf{R}t_m}$，它本身也是一个对角矩阵。因此，所有非对角元预期为 $0$。\n数值实现将使用 `numpy.linalg.eigh`，该函数专为厄米（Hermitian）矩阵（因此也包括实对称矩阵）的特征分解而设计，确保了数值稳定性和正确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the specified off-diagonal elements of the NOE propagator matrix\n    for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"id\": 1,\n            \"R\": np.array([\n                [1.00, -0.05, -0.02],\n                [-0.05, 0.90, -0.03],\n                [-0.02, -0.03, 1.10]\n            ]),\n            \"tm\": 0.50,\n            \"indices\": [(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]\n        },\n        {\n            \"id\": 2,\n            \"R\": np.array([\n                [1.00, 0.00, 0.00],\n                [0.00, 0.80, 0.00],\n                [0.00, 0.00, 1.20]\n            ]),\n            \"tm\": 0.50,\n            \"indices\": [(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]\n        },\n        {\n            \"id\": 3,\n            \"R\": np.array([\n                [1.10, -0.04, -0.01],\n                [-0.04, 1.00, -0.02],\n                [-0.01, -0.02, 0.90]\n            ]),\n            \"tm\": 0.00,\n            \"indices\": [(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]\n        },\n        {\n            \"id\": 4,\n            \"R\": np.array([\n                [1.20, -0.12, -0.08, 0.00],\n                [-0.12, 1.00, -0.10, -0.06],\n                [-0.08, -0.10, 0.90, -0.09],\n                [0.00, -0.06, -0.09, 1.10]\n            ]),\n            \"tm\": 1.00,\n            \"indices\": [(1, 2), (1, 3), (1, 4), (2, 1), (2, 3), (2, 4), (3, 1), (3, 2), (3, 4), (4, 1), (4, 2), (4, 3)]\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        R = case[\"R\"]\n        tm = case[\"tm\"]\n        indices = case[\"indices\"]\n        n = R.shape[0]\n\n        # The propagator P(t_m) is the matrix exponential of -R*t_m.\n        # We compute this via diagonalization of R: P = V * exp(-Lambda*t_m) * V^T\n        \n        # Handle the trivial boundary case t_m = 0, where P(0) = Identity matrix.\n        if tm == 0.0:\n            P = np.identity(n)\n        else:\n            # Step 1: Eigendecomposition of the symmetric matrix R.\n            # np.linalg.eigh is used for Hermitian (or real symmetric) matrices.\n            # It returns eigenvalues in `eigenvalues` and eigenvectors as columns of `V`.\n            eigenvalues, V = np.linalg.eigh(R)\n            \n            # Step 2: Construct the diagonal matrix from the exponentiated eigenvalues.\n            # The diagonal elements are exp(-lambda_k * t_m).\n            exp_lambda_diag = np.exp(-eigenvalues * tm)\n            D_exp = np.diag(exp_lambda_diag)\n            \n            # Step 3: Reconstruct the propagator matrix P(t_m) = V * D_exp * V^T.\n            # V.T is the transpose of V, which is also its inverse since V is orthogonal.\n            P = V @ D_exp @ V.T\n\n        # Step 4: Extract the specified off-diagonal elements.\n        for i, j in indices:\n            # Convert from 1-based to 0-based indexing for numpy arrays\n            val = P[i-1, j-1]\n            # Round to 6 decimal places as required.\n            rounded_val = round(val, 6)\n            all_results.append(rounded_val)\n\n    # Format the final output as a single comma-separated list in brackets.\n    # Using str() is sufficient for converting the rounded floats to the required string format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在真实的科研工作中，实验数据与理论模型之间经常会出现矛盾。这项最终的练习将您置于结构化学家的角色，面对一个棘手的结构解析难题。这项练习综合考察了您对NOE累积曲线、自旋扩散、共振峰归属技术以及互补性实验（如ROESY和 $^3J$ 耦合分析）的理解，要求您设计一个严谨的诊断策略来解决结构的不确定性，最终得到一个高置信度的分子结构 。",
            "id": "3726092",
            "problem": "一种分子量约为 $500$ 统一原子质量单位的有机化合物，在氘代氯仿中通过核奥弗豪瑟效应谱 (NOESY) 进行分析，得到一组用于三维结构测定的、源自核奥弗豪瑟效应 (NOE) 的距离上限约束。该分子有两个手性中心，正在考虑两种非对映异构体候选物，分别记为 $S_1$ 和 $S_2$。使用 NOE 约束进行的约束距离几何计算显示出一组一致的违背：归属于 $H_A$ 和 $H_B$ 之间以及 $H_M$ 和 $H_N$ 之间的几个交叉峰在混合时间 $\\tau_m = 300$ 毫秒时存在，但在 $\\tau_m = 30$ 毫秒时缺失，而归属于 $H_X$ 和 $H_Y$ 之间的一个交叉峰在 $\\tau_m = 30$ 毫秒时就已经很强，并随着 $\\tau_m$ 的增加而单调增长。来自构象系综的模型距离预测为 $r_{AB}^{S_1} \\approx 4.5$ Å 和 $r_{AB}^{S_2} \\approx 4.8$ Å；$r_{MN}^{S_1} \\approx 4.2$ Å 和 $r_{MN}^{S_2} \\approx 4.4$ Å；以及 $r_{XY}^{S_1} \\approx 2.5$ Å 而 $r_{XY}^{S_2} \\approx 3.6$ Å。在小范围内的不同样品浓度和温度下，这些违背的约束是持续存在的。\n\n设计一个诊断策略，以确定这些持续的 NOE 约束违背是主要源于共振峰归属错误、自旋扩散伪影还是不正确的立体化学。根据第一性原理和实际的实验设计，选择能够最有效地将这些可能性区分开的选项。每个选项都提出了一套有序的步骤；选择那套如果执行，将能让您高置信度地确定原因的步骤。\n\nA. 仅采集长混合时间 NOESY 谱（例如，$\\tau_m \\ge 300$ 毫秒）以最大化对弱接触的灵敏度；假设峰体积与 $r^{-3}$ 成正比，将其转换为距离；接受任何仅在长 $\\tau_m$ 下出现的交叉峰作为相应短质子-质子距离的证据，并使用这些距离来区分 $S_1$ 和 $S_2$，而不进行进一步的归属检查。\n\nB. 在覆盖初始增长区的多个 $\\tau_m$ 值（例如 $\\tau_m = 20, 40, 60$ 毫秒）下记录 NOESY 谱，并将每个可疑交叉峰拟合其初始增长速率；对相同的质子对进行选择性一维 NOE 实验以分离直接转移；使用 $^{13}\\text{C}$-编辑的异核单量子相干谱 (HSQC)、异核多键相关谱 (HMBC) 和全相关谱 (TOCSY) 重新验证共振峰归属，以解决化学位移简并问题；在适当的情况下，采集旋转坐标系奥弗豪瑟效应谱 (ROESY) 以处理运动状态；然后评估所得的 $r^{-6}$ 加权距离与 $S_1$ 和 $S_2$ 模型之间的网络一致性，并辅以关键二面角的邻位标量耦合 ($^3J$) 分析。\n\nC. 仅用长自旋锁定时间的旋转坐标系奥弗豪瑟效应谱 (ROESY) 替代 NOESY，并将在长自旋锁定时间下持续存在的任何交叉峰归属为明确的直接 NOE；对于剩余的违背，在没有额外归属验证或混合时间依赖性分析的情况下，断定为立体化学错误。\n\nD. 升高温度以减少相关时间，并采集扩散排序谱 (DOSY) 以检查分子聚集；如果扩散系数是均匀的，则宣布自旋扩散可以忽略，并将所有违背归因于归属错误，而不执行额外的相关实验或混合时间序列实验。\n\n选择唯一的最佳选项。",
            "solution": "首先必须验证问题陈述的科学性和逻辑完整性。\n\n已知条件如下：\n- 一种分子量约为 $500$ u 的有机化合物。\n- 分析在氘代氯仿溶液中进行。\n- 一组源自 NOE 的距离上限约束用于三维结构测定。\n- 考虑了两种非对映异构体候选物 $S_1$ 和 $S_2$。\n- 一部分 NOE 约束被持续违背。\n- 特定的交叉峰（$H_A-H_B$，$H_M-H_N$）在混合时间 $\\tau_m = 300$ ms 时存在，但在 $\\tau_m = 30$ ms 时缺失。\n- 一个特定的交叉峰（$H_X-H_Y$）在 $\\tau_m = 30$ ms 时很强，并且单调增长。\n- 模型的预测质子间距离为：$r_{AB}^{S_1} \\approx 4.5$ Å, $r_{AB}^{S_2} \\approx 4.8$ Å; $r_{MN}^{S_1} \\approx 4.2$ Å, $r_{MN}^{S_2} \\approx 4.4$ Å; $r_{XY}^{S_1} \\approx 2.5$ Å, $r_{XY}^{S_2} \\approx 3.6$ Å。\n- 在一定范围的样品浓度和温度下，违背是持续存在的。\n\n验证过程如下：\n1.  **科学依据**：该问题基于核磁共振 (NMR) 波谱学的成熟原理，特别是核奥弗豪瑟效应 (NOE) 及其在大分子和小分子结构测定中的应用。混合时间 ($\\tau_m$)、自旋扩散、运动状态 ($\\omega_0\\tau_c$) 以及 NOE 强度与核间距 ($r$) 之间的关系等概念是该领域的基础。所提供的数据（分子量、混合时间、距离）对于标准的 NMR 结构研究是物理上现实的。\n2.  **问题的适定性**：这是一个适定问题。它提出了一个基于 NMR 的结构生物学和化学中具体而常见的挑战：解决实验数据中的模糊性。它要求找到区分三种可能原因（归属错误、伪影、模型不正确）的最佳策略，这是一个可以通过进一步实验解决的问题。\n3.  **客观性**：问题以客观、技术性的语言陈述，没有主观或推测性的主张。\n\n该问题是有效的。它描述了一个需要通过仔细的实验设计来解卷积混杂效应的经典场景。我现在将进行求解推导和选项分析。\n\n核心问题是 NOE 交叉峰的解释以及实验约束与结构模型之间差异的解决。这些差异的三个可能原因是共振峰归属错误、自旋扩散和不正确的立体化学。一个可靠的诊断策略必须能够明确地区分这些可能性。\n\nNOE 的第一性原理：\n两个自旋 $i$ 和 $j$ 之间的 NOE 交叉峰强度 ($I_{ij}$) 取决于混合时间 $\\tau_m$ 和交叉弛豫速率 $\\sigma_{ij}$。在初始速率近似下（即对于短的 $\\tau_m$），强度线性增长：$I_{ij}(\\tau_m) \\approx \\sigma_{ij}\\tau_m$。交叉弛豫速率与核间距离的负六次方成正比，$\\sigma_{ij} \\propto r_{ij}^{-6}$。这个近似对于将 NOE 强度转换为距离约束至关重要。\n\n对所提供的 NOE 数据的分析：\n-   **$H_X - H_Y$ 交叉峰**：该峰在“$\\tau_m = 30$ 毫秒时就已经很强”。这是空间上接近的两个质子之间直接 NOE 的典型特征。提出的距离是 $r_{XY}^{S_1} \\approx 2.5$ Å 和 $r_{XY}^{S_2} \\approx 3.6$ Å。一个 $2.5$ Å 距离的 NOE 会迅速建立并且很强，而一个 $3.6$ Å 距离的 NOE 则要弱得多（弱了 $(3.6/2.5)^6 \\approx 13.6$ 倍），并且在短 $\\tau_m$ 下可能无法被稳定地观测到。这一数据强烈支持立体异构体 $S_1$。\n-   **$H_A-H_B$ 和 $H_M-H_N$ 交叉峰**：这些峰在 $\\tau_m=30$ ms 时缺失，但在 $\\tau_m=300$ ms 时存在。这个时间过程是自旋扩散的经典标志，即一种间接的、多步的磁化转移（例如，$H_A \\xrightarrow{\\text{NOE}} H_C \\xrightarrow{\\text{NOE}} H_B$）。由自旋扩散产生的交叉峰并不对应于观测对（$H_A$ 和 $H_B$）之间的短空间距离，绝不能用作直接的距离约束。两种模型预测的长距离（$r > 4$ Å）也与短 $\\tau_m$ 下没有直接 NOE 的情况相符。“违背”很可能是由于将这些自旋扩散峰错误地解释为直接的短程 NOE 所致。\n\n因此，一个稳健的诊断策略必须实现三个主要目标：\n1.  明确确认所有质子共振峰的归属。这里的错误将使所有后续分析无效。\n2.  严格区分直接 NOE 和自旋扩散伪影。\n3.  收集一套自洽且可靠的结构约束，以自信地选择正确的立体异构体。\n\n现在，我将根据这些要求评估每个选项。\n\n**选项 A**\n这个策略存在根本性缺陷。\n- 使用长混合时间会最大化自旋扩散的贡献，使其无法区分直接和间接效应。这与要求正好相反。\n- NOE-距离关系与 $r^{-6}$ 成正比，而不是 $r^{-3}$。这是一个关键的物理错误。\n- 假设任何在长 $\\tau_m$ 下出现的峰都对应于短距离，正是这个错误很可能导致了最初的问题。这种方法只会加剧现有的错误。\n**结论：不正确。**\n\n**选项 B**\n这个选项提出了一个多管齐下、系统性的方法。\n- *“在覆盖初始增长区的多个 $\\tau_m$ 值下记录 NOESY 谱……并将每个可疑交叉峰拟合其初始增长速率”*：这是识别自旋扩散的黄金标准方法。直接 NOE 将显示出从 $\\tau_m = 0$ 开始的近线性增长，而自旋扩散峰将显示一个滞后期。\n- *“进行选择性一维 NOE 实验”*：这为特定质子对之间的直接转移提供了独立检验，证实了增长曲线的分析。\n- *“使用 $^{13}\\text{C}$-编辑的……HSQC、HMBC 和 TOCSY 重新验证共振峰归属”*：这直接解决了共振峰归属错误的关键可能性。这是任何严谨结构测定中不可或缺的一步。\n- *“采集旋转坐标系奥弗豪瑟效应谱 (ROESY)”*：对于一个质量约为 $500$ u 的分子，其旋转相关时间 $\\tau_c$ 可能使得 $\\omega_0\\tau_c \\approx 1.12$，在这个区域实验室坐标系中的 NOE 会变为零或非常小。ROESY 在此状态下提供明确的正交叉峰，是处理这种大小分子的重要工具。\n- *“评估所得的 $r^{-6}$ 加权距离的网络一致性”*：这应用了正确的物理关系。\n- *“辅以邻位标量耦合 ($^3J$) 分析”*：这引入了一套正交的约束。$^3J$ 耦合通过 Karplus 关系提供关于二面角的信息，这与来自 NOE 的距离信息互补，从而为立体化学归属提供了更稳健的基础。\n该选项系统地解决了所有三个潜在的错误来源（归属错误、自旋扩散、立体化学错误），使用了最合适和最严谨的实验技术组合。\n**结论：正确。**\n\n**选项 C**\n该选项建议仅用长自旋锁定时间的 ROESY 替代 NOESY。\n- 虽然 ROESY很有价值，但它并非没有伪影。在长自旋锁定时间下，可能会发生被称为 Hartmann-Hahn 或 TOCSY 类型的相干磁化转移，产生并非由空间邻近性引起的交叉峰。将任何此类峰指定为“明确的直接 NOE”是不正确且危险的。ROESY 实验也需要仔细解读，通常是通过分析短自旋锁定时间下的增长速率。\n- 这个选项完全跳过了验证共振峰归属的关键步骤。\n- 然后，它在没有排除其他可能性的情况下，做出了“断定立体化学错误”的无根据的跳跃。这缺乏科学严谨性。\n**结论：不正确。**\n\n**选项 D**\n该选项建议使用 DOSY 和改变温度。\n- DOSY（扩散排序谱）测量分子的平移扩散系数。它对于检测聚集非常有效。然而，问题陈述了违背在不同浓度下持续存在，这已经表明聚集不是根本原因。\n- 核心的逻辑缺陷是这个陈述：“如果扩散系数是均匀的，则宣布自旋扩散可以忽略”。自旋扩散是一种*分子内*现象，发生在单个分子内部。没有聚集（由均匀扩散证实）与分子内自旋扩散是否发生无关。自旋扩散是质子密度和分子相关时间的函数，在合适的条件下，它会在单体分子中发生。\n- 这个选项未能提出任何实验（如 TOCSY 或 HMBC）来检查共振峰归属错误，而是通过错误的排除过程将所有违背归因于此。\n**结论：不正确。**\n\n总之，选项 B 是唯一一个概述了全面、科学上合理且方法上严谨的策略，以系统地诊断和解决问题陈述中描述的差异的选项。它正确地确定了解决每个潜在问题所需的实验：共振峰归属错误、自旋扩散和立体异构体的选择，同时还考虑了运动状态可能带来的复杂性。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}