{
    "hands_on_practices": [
        {
            "introduction": "准确的质量测量是所有自动化结构解析平台的基石。此练习将探讨如何量化质谱数据的准确性（以百万分率或 $ppm$ 为单位），并演示如何通过内标校正（锁模）技术来校正系统误差，从而显著提高数据质量。掌握这一实践有助于理解后续所有算法所依赖的输入数据的质量保证过程 。",
            "id": "3693918",
            "problem": "一个自动化结构解析平台依赖于高分辨率质量测量，以筛选串联质谱法生成的候选结构。其核心评分特征是以百万分率（ppm）表示的质量准确度。首先，从相对误差的基本定义和百万分率（定义为百万分之一）的定义出发，推导一个用观测质量和理论质量表示的百万分率质量准确度表达式。然后，考虑一次高分辨率质谱采集，其中使用背景校准离子进行锁模校正。假设测量在正离子模式下进行，电荷 $z=1$，因此 $m/z$ 在数值上等于质量。在相关质量范围内，假设仪器的质量误差可以很好地近似为一个加性常数偏移。\n\n给定：\n- 理论锁模质量 $m_{\\text{L,theoretical}} = 371.101237$。\n- 观测锁模质量 $m_{\\text{L,observed}} = 371.101737$。\n- 理论分析物单同位素质量 $m_{\\text{A,theoretical}} = 300.123456$。\n- 观测分析物单同位素质量 $m_{\\text{A,observed}} = 300.124011$。\n\n在加性偏移假设下，推导锁模校正后的分析物质量，然后使用你推导的表达式计算分析物校正后的质量准确度（以百万分率计）。将最终答案四舍五入到四位有效数字。最终答案以 ppm 为单位表示。",
            "solution": "首先对问题进行验证，确保其具有科学依据、提问清晰且客观。\n\n### 步骤1：提取已知条件\n明确给出的数据和条件是：\n-   理论锁模质量：$m_{\\text{L,theoretical}} = 371.101237$\n-   观测锁模质量：$m_{\\text{L,observed}} = 371.101737$\n-   理论分析物单同位素质量：$m_{\\text{A,theoretical}} = 300.123456$\n-   观测分析物单同位素质量：$m_{\\text{A,observed}} = 300.124011$\n-   电荷态：$z=1$\n-   质量误差模型：在相关质量范围内，仪器的质量误差近似为一个加性常数偏移。\n-   任务1：推导以百万分率（ppm）表示的质量准确度表达式。\n-   任务2：推导锁模校正后的分析物质量。\n-   任务3：计算分析物校正后的质量准确度（以 ppm 计）。\n-   舍入要求：将最终答案四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为锁模校正是高分辨率质谱中一种标准且基础的技术，用于通过校正仪器漂移来提高质量准确度。给定的质量值对于小分子有机物是符合实际的。假设质量误差为加性常数，是在有限质量范围内进行仪器校准时一种常见且合理的一阶近似。该问题提问清晰，提供了所有必要的数据和明确的目标。语言精确客观。因此，该问题被判定为有效。\n\n### 步骤3：结论与操作\n该问题有效。将提供一个完整且有理有据的解答。\n\n### 解题推导\n\n解题过程按问题要求分四个阶段进行：\n1.  百万分率（ppm）质量准确度公式的推导。\n2.  使用锁模校准物计算质量误差偏移。\n3.  计算锁模校正后的分析物质量。\n4.  计算分析物校正后的质量准确度。\n\n#### 1. ppm 质量准确度的推导\n\n质量准确度是衡量质量测量误差的指标。绝对误差 $\\Delta m$ 是观测质量 $m_{\\text{observed}}$ 与理论质量 $m_{\\text{theoretical}}$ 之间的差值。\n$$\n\\Delta m = m_{\\text{observed}} - m_{\\text{theoretical}}\n$$\n相对误差 $E_{\\text{rel}}$ 是将绝对误差通过理论质量进行归一化，使其成为一个无量纲的量。\n$$\nE_{\\text{rel}} = \\frac{\\Delta m}{m_{\\text{theoretical}}} = \\frac{m_{\\text{observed}} - m_{\\text{theoretical}}}{m_{\\text{theoretical}}}\n$$\n单位“百万分率”（ppm）对应于因子 $10^{-6}$。因此，为了以 ppm 表示相对误差，我们将其乘以 $10^6$。我们将其表示为 $E_{\\text{ppm}}$。\n$$\nE_{\\text{ppm}} = E_{\\text{rel}} \\times 10^6 = \\left( \\frac{m_{\\text{observed}} - m_{\\text{theoretical}}}{m_{\\text{theoretical}}} \\right) \\times 10^6\n$$\n这就是所要求的 ppm 质量准确度的表达式。\n\n#### 2. 质量误差偏移的计算\n\n问题陈述，仪器的质量误差可以建模为一个加性常数偏移，我们将其表示为 $\\delta$。这意味着对于任何真实质量 $m_{\\text{true}}$，仪器测得的观测质量 $m_{\\text{observed}}$ 由下式给出：\n$$\nm_{\\text{observed}} = m_{\\text{true}} + \\delta\n$$\n锁模校准物提供了一个参考点来估计这个偏移。使用锁模数据，偏移 $\\delta$ 可以计算为观测锁模质量值与理论锁模质量值之差。\n$$\n\\delta = m_{\\text{L,observed}} - m_{\\text{L,theoretical}}\n$$\n代入给定值：\n$$\n\\delta = 371.101737 - 371.101237 = 0.000500\n$$\n这个 $0.000500$ Da（道尔顿）的常数偏移被假定适用于相关质量范围内的所有测量，包括分析物的测量。\n\n#### 3. 锁模校正后分析物质谱的计算\n\n为了找到分析物的校正质量 $m_{\\text{A,corrected}}$，我们从观测到的分析物质量 $m_{\\text{A,observed}}$ 中减去计算出的质量误差偏移 $\\delta$。\n$$\nm_{\\text{A,corrected}} = m_{\\text{A,observed}} - \\delta\n$$\n代入给定的 $m_{\\text{A,observed}}$ 值和计算出的 $\\delta$ 值：\n$$\nm_{\\text{A,corrected}} = 300.124011 - 0.000500 = 300.123511\n$$\n这就是锁模校正后的分析物质量。\n\n#### 4. 校正后质量准确度的计算\n\n最后，我们计算锁模校正后分析物的质量准确度（以 ppm 计）。我们使用推导出的 $E_{\\text{ppm}}$ 公式，其中校正后的分析物质量 $m_{\\text{A,corrected}}$ 现在作为“观测”质量，并将其与理论分析物质量 $m_{\\text{A,theoretical}}$ 进行比较。\n$$\nE_{\\text{A,ppm}} = \\left( \\frac{m_{\\text{A,corrected}} - m_{\\text{A,theoretical}}}{m_{\\text{A,theoretical}}} \\right) \\times 10^6\n$$\n首先，我们计算分析物的新绝对误差：\n$$\n\\Delta m_{\\text{A,corrected}} = m_{\\text{A,corrected}} - m_{\\text{A,theoretical}} = 300.123511 - 300.123456 = 0.000055\n$$\n现在，我们计算 ppm 误差：\n$$\nE_{\\text{A,ppm}} = \\left( \\frac{0.000055}{300.123456} \\right) \\times 10^6 \\approx 0.18325609 \\text{ ppm}\n$$\n问题要求将最终答案四舍五入到四位有效数字。第一位有效数字是 $1$，其后是 $8$、$3$ 和 $2$。第五位有效数字是 $5$，因此需要将第四位数字向上舍入。\n$$\nE_{\\text{A,ppm}} \\approx 0.1833 \\text{ ppm}\n$$\n这就是分析物校正后的最终质量准确度。",
            "answer": "$$\n\\boxed{0.1833}\n$$"
        },
        {
            "introduction": "在获得高质量的精确质量数据后，我们便可以深入分析同位素精细结构，从中提取关键的化学信息。本练习将演示如何从质谱数据（例如 $^{13}\\mathrm{C}$ 同位素峰的相对强度）推断未知物的元素组成（例如碳原子数）。它引入了一个基于二项分布和最大似然估计的强大统计框架，用于从实验数据中估计化学式参数 。",
            "id": "3693966",
            "problem": "一个基于傅里叶变换离子回旋共振（FT-ICR）的自动化质谱结构解析平台，可获取分子离子的精细同位素结构，并通过算法分配同位素体的计数。该平台通过使用内部校准和元素比例先验来校正非碳同位素（例如氮-15、氘和氧-17）的贡献，从而分离出碳-13卫星峰，然后报告检测到的、对应于恰好有一次碳-13取代的同位素体的离子数量。\n\n假设以下科学上标准的基础成立：\n- 每个碳位点独立地带有重同位素碳-13的概率为 $q$（陆地条件下碳-13的自然丰度）。\n- 对于一个含有 $n$ 个碳原子的分子，碳-13取代的总数在 $n$ 个位点上服从二项分布。\n- 检测器的离子计数可以很好地模型化为从分配给分子离子单一同位素峰簇的 $N$ 个离子中的同位素体分布进行的独立抽样。\n\n平台报告总共归属了 $N = 200000$ 个离子，其中 $x_{1} = 28280$ 个离子被归属于恰好有一次碳-13取代的同位素体。校准后的自然丰度为 $q = 0.0110$。\n\n仅从上述基础出发，使用最大似然法估计分析物中碳原子数 $n$，并使用费雪信息近似，以估计量的标准差来量化其不确定性。请按以下格式表达您的最终数值答案：\n- 将最大似然估计值及其标准差均四舍五入至三位有效数字。\n- 在单个响应中报告这两个数字。\n- 不需要单位；将碳原子数视为无量纲量。",
            "solution": "该问题的情境是利用精细同位素结构进行有机化合物的质谱鉴定，其中一个自动化结构解析平台通过利用同位素模式来估计元素数量。其基本统计学基础是：每个碳原子独立地带有重同位素碳-13的概率为 $q$，因此在 $n$ 个碳位点上，碳-13的取代数服从二项分布。\n\n令 $n$ 表示碳原子数。在给定分子中，碳-13取代数是一个二项随机变量 $K \\sim \\text{Binomial}(n, q)$，其概率质量函数为\n$$\n\\Pr(K = k) = \\binom{n}{k} q^{k} (1 - q)^{n - k}.\n$$\n“恰好有一次碳-13取代”这一事件的概率为\n$$\np(n) = \\Pr(K = 1) = \\binom{n}{1} q (1 - q)^{n - 1} = n q (1 - q)^{n - 1}.\n$$\n在 $N$ 次独立的离子归属中，恰好有一次碳-13取代的离子计数 $x_{1}$ 服从参数为 $N$ 和 $p(n)$ 的二项分布，\n$$\nx_{1} \\sim \\text{Binomial}(N, p(n)), \\quad p(n) = n q (1 - q)^{n - 1}.\n$$\n给定 $x_{1}$ 和 $N$，关于 $n$ 的似然函数（在不考虑与 $n$ 无关的乘法常数的情况下）为\n$$\nL(n) \\propto \\left[p(n)\\right]^{x_{1}} \\left[1 - p(n)\\right]^{N - x_{1}},\n$$\n对数似然函数为\n$$\n\\ell(n) = x_{1} \\ln p(n) + (N - x_{1}) \\ln\\!\\left(1 - p(n)\\right).\n$$\n为求最大似然估计，对 $n$ 求导并令导数等于零。为简化符号，记 $s = 1 - q$。则 $p(n) = n q s^{n - 1}$ 且\n$$\n\\frac{d}{dn} p(n) = q s^{n - 1} \\left(1 + n \\ln s \\right),\n$$\n此式由 $\\ln p(n) = \\ln q + \\ln n + (n - 1) \\ln s$ 和链式法则得出。对数似然函数的导数为\n$$\n\\frac{d}{dn} \\ell(n) = x_{1} \\frac{p'(n)}{p(n)} - (N - x_{1}) \\frac{p'(n)}{1 - p(n)} = p'(n) \\left[ \\frac{x_{1}}{p(n)} - \\frac{N - x_{1}}{1 - p(n)} \\right].\n$$\n令 $\\frac{d}{dn} \\ell(n) = 0$ 得到似然方程\n$$\n\\frac{x_{1}}{p(n)} = \\frac{N - x_{1}}{1 - p(n)} \\quad \\Rightarrow \\quad \\frac{x_{1}}{N} = p(n).\n$$\n定义经验分数 $y = x_{1} / N$。最大似然估计 $\\hat{n}$ 满足\n$$\ny = n q s^{n - 1}.\n$$\n此方程可用朗伯 $W$ 函数求得闭合形式解。整理得\n$$\n\\frac{y}{q} = n s^{n - 1} \\quad \\Rightarrow \\quad \\frac{y s}{q} = n s^{n}.\n$$\n令 $\\alpha = \\ln s$，则 $s^{n} = \\exp(\\alpha n)$。于是\n$$\nn \\exp(\\alpha n) = \\frac{y s}{q}.\n$$\n设 $z = \\alpha n$。则方程变为\n$$\n\\frac{z}{\\alpha} \\exp(z) = \\frac{y s}{q} \\quad \\Rightarrow \\quad z \\exp(z) = \\alpha \\frac{y s}{q}.\n$$\n根据朗伯 $W$ 函数的定义，$z = W\\!\\left(\\alpha \\frac{y s}{q}\\right)$，因此\n$$\n\\hat{n} = \\frac{W\\!\\left(\\alpha \\frac{y s}{q}\\right)}{\\alpha}, \\quad \\text{其中} \\quad \\alpha = \\ln(1 - q), \\quad s = 1 - q, \\quad y = \\frac{x_{1}}{N}.\n$$\n\n为量化不确定性，我们使用费雪信息近似。对于通过 $n$ 重参数化的二项似然，关于 $n$ 的费雪信息为\n$$\nI(n) = N \\frac{\\left[p'(n)\\right]^{2}}{p(n) \\left[1 - p(n)\\right]}.\n$$\n我们已有 $p(n) = n q s^{n - 1}$ 和 $p'(n) = q s^{n - 1} \\left(1 + n \\ln s \\right)$。代入得\n$$\nI(n) = N \\cdot \\frac{\\left[q s^{n - 1} \\left(1 + n \\ln s \\right)\\right]^{2}}{n q s^{n - 1} \\left(1 - n q s^{n - 1}\\right)} = N \\cdot \\frac{q s^{n - 1} \\left(1 + n \\ln s \\right)^{2}}{n \\left(1 - n q s^{n - 1}\\right)}.\n$$\n最大似然估计量的渐近方差可通过在 $\\hat{n}$ 处求值的费雪信息逆来近似，\n$$\n\\operatorname{Var}(\\hat{n}) \\approx \\frac{1}{I(\\hat{n})}, \\quad \\text{因此} \\quad \\operatorname{sd}(\\hat{n}) \\approx \\sqrt{\\frac{1}{I(\\hat{n})}}.\n$$\n\n现在代入给定的数值。输入为 $q = 0.0110$, $N = 200000$, $x_{1} = 28280$。计算 $y = x_{1}/N$，\n$$\ny = \\frac{28280}{200000} = 0.1414.\n$$\n则 $s = 1 - q = 0.9890$ 且 $\\alpha = \\ln(s) = \\ln(0.9890)$。数值上，$\\alpha \\approx -0.011061$。朗伯 $W$ 函数的自变量为\n$$\n\\alpha \\frac{y s}{q} = \\alpha \\cdot \\frac{0.1414 \\times 0.9890}{0.0110}.\n$$\n计算 $c = \\frac{y s}{q} \\approx \\frac{0.1414 \\times 0.9890}{0.0110} \\approx 12.713$，因此 $\\alpha c \\approx -0.011061 \\times 12.713 \\approx -0.1406$。朗伯 $W$ 函数的求值为 $W(-0.1406) \\approx -0.166$。所以\n$$\n\\hat{n} = \\frac{W(\\alpha c)}{\\alpha} \\approx \\frac{-0.166}{-0.011061} \\approx 15.01.\n$$\n四舍五入至三位有效数字，最大似然估计为 $15.0$。\n\n接下来计算在 $\\hat{n} \\approx 15.01$ 处的费雪信息。使用 $p(\\hat{n}) = y = 0.1414$，$s^{\\hat{n} - 1} = s^{14} = \\exp(14 \\alpha) \\approx \\exp(14 \\times -0.011061) \\approx \\exp(-0.1549) \\approx 0.8564$，以及\n$$\n1 + \\hat{n} \\ln s \\approx 1 + 15.01 \\times (-0.011061) \\approx 0.834.\n$$\n则\n$$\nI(\\hat{n}) = N \\cdot \\frac{q s^{\\hat{n} - 1} \\left(1 + \\hat{n} \\ln s \\right)^{2}}{\\hat{n} \\left(1 - \\hat{n} q s^{\\hat{n} - 1}\\right)} \\approx 200000 \\cdot \\frac{0.0110 \\times 0.8564 \\times (0.834)^{2}}{15.01 \\times \\left(1 - 0.1414\\right)}.\n$$\n数值上，分子因子为 $0.0110 \\times 0.8564 \\times (0.834)^{2} \\approx 0.00655$，分母因子为 $15.01 \\times 0.8586 \\approx 12.88$，得到\n$$\nI(\\hat{n}) \\approx 200000 \\times \\frac{0.00655}{12.88} \\approx 1.02 \\times 10^{2}.\n$$\n因此\n$$\n\\operatorname{sd}(\\hat{n}) \\approx \\sqrt{\\frac{1}{I(\\hat{n})}} \\approx \\sqrt{\\frac{1}{1.02 \\times 10^{2}}} \\approx 0.0992.\n$$\n四舍五入至三位有效数字，标准差为 $0.0992$。\n\n在单个响应中报告这两个数字，四舍五入至三位有效数字，无单位。",
            "answer": "$$\\boxed{\\begin{pmatrix}15.0 & 0.0992\\end{pmatrix}}$$"
        },
        {
            "introduction": "在确定了可能的元素组成后，下一个核心挑战是解析原子间的连接方式，这通常需要借助串联质谱（MS/MS）技术。此练习将复杂的分子碎裂过程建模为一个图论问题，您将学习如何构建一个结合了质谱证据和先验化学知识的概率性目标函数。通过优化此函数，我们可以找到最可能的碎裂路径，从而为最终的结构解析提供关键线索 。",
            "id": "3693961",
            "problem": "您正在设计一个简化的自动化结构解析模块，该模块根据观测到的串联质谱（MS/MS）数据对碎裂树进行评分。该模块必须在碎裂图上运行，其中节点代表候选子结构（包括前体），有向边代表产生中性丢失的可能裂解。任务是根据提供的质量数构建碎裂图，定义一个基于概率建模的、有原则的目标函数，并计算能够最大化该目标函数的最合理的有向树状结构（以母体为根的有向生成树）。\n\n该问题的基本基础是将MS/MS强度解释为碎片形成概率的代理，将高斯质量测量误差用于峰与碎片的匹配，以及将源自经验化学知识的中性丢失合理性先验。您的推导和计算必须从以下几点开始：\n\n- 质量测量误差的高斯概率密度函数，对于质荷比$m/z$值为$x$的峰，匹配质量为$m$、质量精度为$\\sigma$的碎片，其函数为$$\\mathcal{N}(x; m, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - m)^2}{2\\sigma^2}\\right)$$。\n- 中性丢失的经验先验（例如，水、氨、甲基、一氧化碳、二氧化碳），指定为从碎裂化学中已知的基本概率。\n\n您必须形式化在碎裂图$G=(V,E)$上以母体节点$r$为根的有向树状结构$T$的目标函数，其中节点集$V=\\{r, v_1, \\dots, v_n\\}$，有向边集为$E$。每个节点$v_i$（其中$i \\geq 1$）有一个候选碎片质量$m_i$（单位为道尔顿，Da），母体节点$r$的质量为$M_p$（单位为道尔顿）。观测到的MS/MS谱是一个有限的峰集合$S=\\{(m_j, I_j)\\}_{j=1}^N$，其中$m_j$的单位为道尔顿，$I_j$为非负强度，您必须将其归一化以使$\\sum_{j=1}^{N} I_j = 1$。设$\\alpha > 0$为强度加权指数，$\\sigma > 0$为质量精度（单位为道尔顿）。\n\n将质量为$m_v$的节点$v$的碎片似然定义为由强度加权的高斯似然的混合，\n$$\n\\ell(v) = \\sum_{j=1}^{N} I_j^\\alpha \\, \\mathcal{N}(m_j; m_v, \\sigma).\n$$\n使用以下规则定义有向边$(u \\to v)$（其丢失量$d = m_u - m_v > 0$）的中性丢失先验。设已知丢失的集合为\n$$\n\\mathcal{L} = \\{(\\text{H}_2\\text{O}, \\, 18.0106, \\, p_{\\text{H}_2\\text{O}}), \\, (\\text{NH}_3, \\, 17.0265, \\, p_{\\text{NH}_3}), \\, (\\text{CH}_3, \\, 15.0235, \\, p_{\\text{CH}_3}), \\, (\\text{CO}, \\, 27.9949, \\, p_{\\text{CO}}), \\, (\\text{CO}_2, \\, 43.9898, \\, p_{\\text{CO}_2}) \\},\n$$\n其中中间项是丢失质量（道尔顿），最后一项是其基本先验概率。给定一个容差$\\delta > 0$（道尔顿），如果存在一个已知丢失，其质量为$l$，使得$|d - l| \\leq \\delta$，则将先验设置为该丢失的基本概率；否则，设置一个随丢失量衰减的未知丢失先验，\n$$\n\\pi(d) = p_u \\, \\exp(-\\lambda d),\n$$\n其中$p_u \\in (0,1)$和$\\lambda > 0$是常数。\n\n设$\\beta > 0$用于加权先验的贡献，$\\gamma \\geq 0$用于惩罚较大的丢失。将边集为$E_T \\subseteq E$的有向树状结构$T$的总目标定义为（每个节点$v \\in V \\setminus \\{r\\}$必须有且仅有一条入边）：\n$$\nJ(T) = \\sum_{(u \\to v) \\in E_T} \\left[ \\log \\ell(v) + \\beta \\log \\pi(m_u - m_v) - \\gamma (m_u - m_v) \\right].\n$$\n您必须假设边只允许从高质量指向低质量，即，仅当$m_u > m_v$时，$(u \\to v) \\in E$才被允许。在此约束下，碎裂图是一个按质量排序的有向无环图。\n\n您的程序必须：\n\n1.  对于每个测试用例，从前体质量$M_p$和候选碎片质量列表$m_i$（道尔顿）构建节点集$V$。通过包含所有满足$m_u > m_v$的对$(u \\to v)$来构建有向边集$E$，包括从前体节点$r$到每个碎片节点$v$的边。\n2.  使用归一化强度和高斯质量似然计算每个碎片节点的$\\ell(v)$。使用一个小的下限值$\\epsilon = 10^{-12}$，通过将$\\ell(v)$替换为$\\max(\\ell(v), \\epsilon)$来避免对零取对数。\n3.  使用上述的已知丢失容差规则计算每条边的$\\pi(d)$。\n4.  计算边权重$w(u \\to v) = \\log \\ell(v) + \\beta \\log \\pi(m_u - m_v) - \\gamma (m_u - m_v)$。\n5.  由于图是按质量顺序的无环图，通过为每个碎片节点$v \\in V \\setminus \\{r\\}$选择具有最大权重$w(u \\to v)$的唯一入边$(u \\to v)$（在所有允许的父节点$u$中，$m_u > m_v$）来找到最大目标树状结构。总目标$J(T)$是所有碎片节点上这些选定权重的总和。\n6.  为测试套件生成最终输出，以单行形式包含每个测试用例的总目标值$J(T)$列表，四舍五入到六位小数，格式为逗号分隔的列表并用方括号括起来。不得打印任何其他文本。\n\n物理和数值单位：所有质量（$m_j$、$m_v$、$M_p$和已知丢失质量）均以道尔顿（Da）为单位。最终答案必须是浮点数（小数）。\n\n使用以下测试套件。对于每个案例，输入都明确提供：\n\n- 案例A（包含多个已知中性丢失的正常路径）：\n    - 前体质量$M_p = 180.0630$ Da。\n    - 候选碎片质量（Da）：$[162.0524, \\, 145.0259, \\, 130.0024, \\, 102.0075]$。\n    - 观测到的峰$(m_j, I_j)$: $[(162.0520, \\, 0.8), \\, (145.0260, \\, 0.6), \\, (130.0020, \\, 0.5), \\, (102.0080, \\, 0.3), \\, (90.0000, \\, 0.1)]$。\n- 案例B（只有一个主要碎片的边界条件）：\n    - 前体质量$M_p = 150.0520$ Da。\n    - 候选碎片质量（Da）：$[132.0414]$。\n    - 观测到的峰$(m_j, I_j)$: $[(132.0410, \\, 0.9), \\, (120.0000, \\, 0.2), \\, (100.0000, \\, 0.1)]$。\n- 案例C（直接丢失和逐步丢失之间存在模糊性的边缘案例）：\n    - 前体质量$M_p = 200.0840$ Da。\n    - 候选碎片质量（Da）：$[182.0734, \\, 165.0469, \\, 150.0234]$。\n    - 观测到的峰$(m_j, I_j)$: $[(165.0470, \\, 0.7), \\, (150.0235, \\, 0.6), \\, (182.0730, \\, 0.05), \\, (140.0000, \\, 0.1)]$。\n\n全局参数（所有测试用例相同）：\n- 质量精度$\\sigma = 0.01$ Da。\n- 强度指数$\\alpha = 0.5$。\n- 已知丢失和基本先验：\n  - 水$\\text{H}_2\\text{O}$：质量$18.0106$ Da，基本先验$p_{\\text{H}_2\\text{O}} = 0.3$。\n  - 氨$\\text{NH}_3$：质量$17.0265$ Da，基本先验$p_{\\text{NH}_3} = 0.2$。\n  - 甲基$\\text{CH}_3$：质量$15.0235$ Da，基本先验$p_{\\text{CH}_3} = 0.1$。\n  - 一氧化碳$\\text{CO}$：质量$27.9949$ Da，基本先验$p_{\\text{CO}} = 0.05$。\n  - 二氧化碳$\\text{CO}_2$：质量$43.9898$ Da，基本先验$p_{\\text{CO}_2} = 0.05$。\n- 已知丢失匹配的容差$\\delta = 0.25$ Da。\n- 未知丢失先验参数：$p_u = 0.02$, $\\lambda = 0.02$ $\\text{Da}^{-1}$。\n- 丢失量惩罚系数$\\gamma = 0.01$。\n- 先验加权系数$\\beta = 1.0$。\n- 似然下限$\\epsilon = 10^{-12}$。\n\n您的程序应生成一行输出，其中包含结果，格式为方括号括起来的逗号分隔列表（例如，$[r_1, r_2, r_3]$），其中每个$r_i$是相应测试用例的总目标值$J(T)$，四舍五入到六位小数。",
            "solution": "该问题要求设计并实现一个用于在串联质谱中对碎裂树状结构进行评分的模块。这涉及到构建一个概率性目标函数，并找到使该函数最大化的树状结构。解决方案从第一性原理出发，始于对谱图数据和化学知识的概率性解释，并最终形成一个高效的优化算法。\n\n核心任务是在碎裂图$G=(V, E)$中找到一个以母体节点$r$为根的最合理的有向树状结构$T$。树状结构是一种有向生成树，其中除根节点外的每个节点都恰好有一条入边。这种结构代表了关于母体分子如何碎裂以产生观测到的小分子（碎片）的假说。\n\n首先，我们形式化图的结构。节点集$V$包括质量为$M_p$的前体离子（表示为$r$）和一组候选碎片离子$\\{v_1, \\dots, v_n\\}$及其对应质量$\\{m_1, \\dots, m_n\\}$。当且仅当节点$u$的质量$m_u$大于节点$v$的质量$m_v$时，边集$E$中存在一条有向边$(u \\to v)$。这个约束条件$m_u > m_v$确保了碎裂总是导致正的质量丢失，$d = m_u - m_v > 0$。因此，图$G$是一个有向无环图（DAG），其中节点按质量进行偏序。\n\n接下来，我们为树状结构$T$定义一个有原则的、概率性的目标函数$J(T)$。整个树状结构的分数定义为其构成边的分数之和。树状结构中单条边$(u \\to v)$的分数（表示为$w(u \\to v)$）由三项组成。对于一个边集为$E_T$的树状结构$T$，其总目标为：\n$$\nJ(T) = \\sum_{(u \\to v) \\in E_T} w(u \\to v)\n$$\n其中，边的权重由下式给出：\n$$\nw(u \\to v) = \\log \\ell(v) + \\beta \\log \\pi(m_u - m_v) - \\gamma (m_u - m_v)\n$$\n边权重中的每一项都具有独特的物理和概率意义。使用对数将概率的乘积（一个联合概率模型）转换为对数概率的和，这在数值上更稳定，在分析上也更易于处理。\n\n第一项$\\log \\ell(v)$是碎片节点$v$的对数似然。它基于观测到的MS/MS谱$S = \\{(m_j, I_j)\\}_{j=1}^N$来量化质量为$m_v$的碎片存在的证据。似然$\\ell(v)$被形式化为一个混合模型：\n$$\n\\ell(v) = \\sum_{j=1}^{N} I_j'^\\alpha \\, \\mathcal{N}(m_j; m_v, \\sigma)\n$$\n在这里，$I_j'$表示第$j$个峰的归一化强度，使得$\\sum_{j=1}^{N} I_j' = 1$。指数$\\alpha$是一个加权因子，用于调节峰强度的影响。函数$\\mathcal{N}(m_j; m_v, \\sigma)$是高斯概率密度函数，它模拟了在真实碎片质量为$m_v$、仪器质量精度标准差为$\\sigma$的情况下，观测到质量为$m_j$的峰的概率。该项有效地衡量了候选碎片$v$的理论质量在多大程度上可以被观测到的谱峰所解释。为了防止对零取对数产生数值问题，我们应用一个下限值$\\epsilon$，将$\\ell(v)$替换为$\\max(\\ell(v), \\epsilon)$。\n\n第二项$\\beta \\log \\pi(m_u - m_v)$融合了先验化学知识。函数$\\pi(d)$是质量为$d = m_u - m_v$的中性丢失的先验概率。某些中性丢失（例如，小的稳定分子如水或一氧化碳）在化学上更受青睐，并以高频率发生。该模型通过定义一组已知的常见丢失$\\mathcal{L}$来捕捉这一点。如果计算出的丢失$d$在给定容差$\\delta$内与某个已知丢失质量$l \\in \\mathcal{L}$匹配（即$|d-l| \\le \\delta$），其先验概率就被设置为一个预定义的值$p_l$。如果多个已知丢失匹配，则选择质量差异最小的那个。对于所有其他“未知”丢失，我们分配一个随丢失质量指数衰减的先验：$\\pi(d) = p_u \\, \\exp(-\\lambda d)$。这反映了丢失任意大的、非特定碎片的可能性越来越小。系数$\\beta$平衡了这一先验信息与数据驱动的似然项的贡献。\n\n第三项$-\\gamma (m_u - m_v)$是一个与中性丢失质量成正比的惩罚项。它充当一个正则化项，由系数$\\gamma \\geq 0$控制。在其他条件相同的情况下，该项引入了对具有较小步骤的碎裂路径的偏好，从而促进更详细和简约的解释。\n\n最后一步是找到最大化$J(T)$的树状结构$T$。由于图是DAG，并且边权重是这样定义的，问题得到了极大的简化。目标函数的结构允许进行贪心优化。完整的目标是树状结构中所有边的权重之和。由于每个碎片节点$v \\in V \\setminus \\{r\\}$都恰好有一条入边，我们可以将目标重写为对碎片节点的求和，其中为每个节点选择其最佳父节点：\n$$\nJ(T) = \\sum_{v \\in V \\setminus \\{r\\}} \\max_{(u \\to v) \\in E} w(u \\to v)\n$$\n这等价于：\n$$\nJ(T) = \\sum_{v \\in V \\setminus \\{r\\}} \\left( \\log \\ell(v) + \\max_{(u \\to v) \\in E} \\left[ \\beta \\log \\pi(m_u - m_v) - \\gamma(m_u - m_v) \\right] \\right)\n$$\n这种分解表明，一个节点$v$的最优父节点可以独立于其他任何节点的选择来确定。因此，算法如下：\n1.  对于每个碎片节点$v_i$，根据谱图数据计算其似然$\\ell(v_i)$。\n2.  对于每个碎片节点$v_i$，考虑所有可能的父节点$u$（即所有质量$m_u > m_{v_i}$的节点）。\n3.  对于每个潜在的父节点$u$，计算相应的边权重$w(u \\to v_i)$。\n4.  确定为$v_i$产生最大边权重的父节点$u^*$。这个最大权重是节点$v_i$对总分的贡献。\n5.  总目标$J(T)$是所有碎片节点上这些最大权重的总和。\n\n这个过程保证了在多项式时间内找到得分最高的树状结构，具体时间复杂度为$O(n^2)$，其中$n$是节点数，因为$O(n)$个碎片节点中的每一个都考虑$O(n)$个潜在的父节点。实现将精确遵循这一逻辑。",
            "answer": "$$\n\\boxed{[-10.150035, -5.548777, -13.914561]}\n$$"
        }
    ]
}