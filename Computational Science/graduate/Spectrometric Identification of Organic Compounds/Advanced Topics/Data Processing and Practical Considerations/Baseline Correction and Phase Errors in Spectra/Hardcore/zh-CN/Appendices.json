{
    "hands_on_practices": [
        {
            "introduction": "本练习是掌握相位校正的基础。我们将从谱学中最基本的数学模型——复洛伦兹函数——出发，学习如何将其分解为物理上有意义的实部（吸收）和虚部（色散）。理解这种分解是诊断和校正相位误差的第一步，因为相位误差的本质就是这两个分量的混合。通过一个具体的计算案例，您将练习如何对单个谱峰执行基线校正，并从数据中精确计算出零阶相位误差。",
            "id": "3694193",
            "problem": "在相敏光谱法中，例如傅里叶变换核磁共振（FT-NMR）或复数傅里叶变换红外光谱（FT-IR），复频域中的单个孤立共振可以由一个源于阻尼振子线性响应理论的复数洛伦兹响应函数来建模。考虑复数线型\n$$L(\\omega)=\\frac{A}{\\gamma - i(\\omega - \\omega_{0})},$$\n其中 $A$ 是与跃迁强度成正比的实数振幅，$\\gamma0$ 是均匀半峰半宽，$\\omega_{0}$ 是共振角频率。在相敏检测中，由于仪器背景和切趾，测得的复数谱可能表现出全局相位误差 $\\phi$ 和基线偏移，在窄窗口范围内，这些可以近似为实部和虚部通道中的加性常数。\n\n从上面定义的 $L(\\omega)$ 出发，仅使用代数运算和复数函数实部与虚部的定义：\n\n1. 将 $L(\\omega)$ 分解为其作为 $\\omega$、$A$、$\\gamma$ 和 $\\omega_{0}$ 的显式函数的实部（吸收，对称）分量和虚部（色散，反对称）分量。\n\n2. 假设一个角度为 $\\phi$ 的全局相移通过乘以 $\\exp(i\\phi)$ 来变换复数谱。推导表达式，说明旋转后的实部和虚部是如何由原始的吸收和色散分量混合而成的。\n\n3. 现在考虑一个实际的基线校正情景：一台光谱仪报告峰中心 $\\omega=\\omega_{0}$ 处的原始复数值为 $S_{\\text{raw}}(\\omega_{0})=S_{\\text{raw},R}(\\omega_{0})+i\\,S_{\\text{raw},I}(\\omega_{0})$，其中 $S_{\\text{raw},R}(\\omega_{0})=3.150$ 和 $S_{\\text{raw},I}(\\omega_{0})=0.550$（任意强度单位）。在相同的窄光谱窗口内，离共振基线估计在实部和虚部通道中分别为常数偏移量 $B_{R}=0.150$ 和 $B_{I}=-0.050$。通过从原始通道中减去 $B_{R}$ 和 $B_{I}$ 来执行基线校正，以获得 $S_{R}(\\omega_{0})$ 和 $S_{I}(\\omega_{0})$。利用第1部分和第2部分的结果，从经过基线校正的峰中心值确定全局相位误差角 $\\phi$（以弧度为单位）。将最终角度以弧度表示，并将答案四舍五入到四位有效数字。",
            "solution": "该问题具有科学依据，提法恰当，客观，并包含推导唯一且有意义解所需的所有必要信息。它精确地模拟了相敏光谱法中的一个常见情景。因此，该问题是有效的，将提供解答。\n\n按要求分三部分解答此问题。\n\n第1部分：将复数线型分离为实部和虚部分量。\n给定的复数洛伦兹线型为：\n$$L(\\omega)=\\frac{A}{\\gamma - i(\\omega - \\omega_{0})}$$\n为了将其分离为实部和虚部，我们将分子和分母同乘以分母的复共轭，即 $\\gamma + i(\\omega - \\omega_{0})$。\n$$L(\\omega) = \\frac{A}{\\gamma - i(\\omega - \\omega_{0})} \\times \\frac{\\gamma + i(\\omega - \\omega_{0})}{\\gamma + i(\\omega - \\omega_{0})}$$\n分母变为：\n$$(\\gamma - i(\\omega - \\omega_{0}))(\\gamma + i(\\omega - \\omega_{0})) = \\gamma^2 - (i(\\omega - \\omega_{0}))^2 = \\gamma^2 - i^2(\\omega - \\omega_{0})^2 = \\gamma^2 + (\\omega - \\omega_{0})^2$$\n分子变为：\n$$A(\\gamma + i(\\omega - \\omega_{0})) = A\\gamma + iA(\\omega - \\omega_{0})$$\n将它们组合起来，我们得到：\n$$L(\\omega) = \\frac{A\\gamma + iA(\\omega - \\omega_{0})}{\\gamma^2 + (\\omega - \\omega_{0})^2}$$\n这个表达式现在可以分离为其实部 $L_R(\\omega)$ 和虚部 $L_I(\\omega)$，其中 $L(\\omega) = L_R(\\omega) + i L_I(\\omega)$。\n实部（吸收）分量是：\n$$L_R(\\omega) = \\frac{A\\gamma}{\\gamma^2 + (\\omega - \\omega_{0})^2}$$\n此函数是一个以 $\\omega = \\omega_{0}$ 为中心的对称洛伦兹函数。\n虚部（色散）分量是：\n$$L_I(\\omega) = \\frac{A(\\omega - \\omega_{0})}{\\gamma^2 + (\\omega - \\omega_{0})^2}$$\n此函数是一个以 $\\omega = \\omega_{0}$ 为中心的反对称色散曲线。\n\n第2部分：全局相移的影响。\n通过乘以复指数 $\\exp(i\\phi)$，对复数谱 $L(\\omega)$ 施加一个角度为 $\\phi$ 的全局相移。设得到的谱为 $L'(\\omega)$。\n$$L'(\\omega) = L(\\omega) \\exp(i\\phi)$$\n代入 $L(\\omega) = L_R(\\omega) + i L_I(\\omega)$ 并使用欧拉公式 $\\exp(i\\phi) = \\cos(\\phi) + i\\sin(\\phi)$：\n$$L'(\\omega) = (L_R(\\omega) + i L_I(\\omega)) (\\cos(\\phi) + i\\sin(\\phi))$$\n展开乘积：\n$$L'(\\omega) = L_R(\\omega)\\cos(\\phi) + i L_R(\\omega)\\sin(\\phi) + i L_I(\\omega)\\cos(\\phi) + i^2 L_I(\\omega)\\sin(\\phi)$$\n$$L'(\\omega) = L_R(\\omega)\\cos(\\phi) - L_I(\\omega)\\sin(\\phi) + i (L_R(\\omega)\\sin(\\phi) + L_I(\\omega)\\cos(\\phi))$$\n因此，新的实部 $L'_R(\\omega) = \\text{Re}[L'(\\omega)]$ 和新的虚部 $L'_I(\\omega) = \\text{Im}[L'(\\omega)]$ 是原始吸收和色散分量的混合：\n$$L'_R(\\omega) = L_R(\\omega)\\cos(\\phi) - L_I(\\omega)\\sin(\\phi)$$\n$$L'_I(\\omega) = L_R(\\omega)\\sin(\\phi) + L_I(\\omega)\\cos(\\phi)$$\n\n第3部分：基线校正和相位误差 $\\phi$ 的确定。\n测得的原始信号 $S_{\\text{raw}}(\\omega)$ 是经过相移的信号 $L'(\\omega)$ 加上恒定的基线偏移量 $B_R$ 和 $B_I$。\n$$S_{\\text{raw}}(\\omega) = (L'_R(\\omega) + B_R) + i(L'_I(\\omega) + B_I)$$\n给定峰中心 $\\omega = \\omega_{0}$ 处的原始值：$S_{\\text{raw},R}(\\omega_{0}) = 3.150$ 和 $S_{\\text{raw},I}(\\omega_{0}) = 0.550$。基线偏移量为 $B_{R}=0.150$ 和 $B_{I}=-0.050$。\n\n首先，我们进行基线校正以找到真实的信号值 $S_R(\\omega_0)$ 和 $S_I(\\omega_0)$，它们分别对应于 $L'_R(\\omega_0)$ 和 $L'_I(\\omega_0)$。\n$$S_R(\\omega_0) = S_{\\text{raw},R}(\\omega_0) - B_R = 3.150 - 0.150 = 3.000$$\n$$S_I(\\omega_0) = S_{\\text{raw},I}(\\omega_0) - B_I = 0.550 - (-0.050) = 0.550 + 0.050 = 0.600$$\n\n接下来，我们在峰中心 $\\omega=\\omega_{0}$ 处计算第1部分中的原始吸收和色散分量。\n峰中心处的吸收分量达到其最大值：\n$$L_R(\\omega_0) = \\frac{A\\gamma}{\\gamma^2 + (\\omega_0 - \\omega_{0})^2} = \\frac{A\\gamma}{\\gamma^2} = \\frac{A}{\\gamma}$$\n峰中心处的色散分量为零：\n$$L_I(\\omega_0) = \\frac{A(\\omega_0 - \\omega_{0})}{\\gamma^2 + (\\omega_0 - \\omega_{0})^2} = 0$$\n\n现在，我们在 $\\omega = \\omega_0$ 处使用第2部分中的表达式：\n$$S_R(\\omega_0) = L'_R(\\omega_0) = L_R(\\omega_0)\\cos(\\phi) - L_I(\\omega_0)\\sin(\\phi)$$\n代入 $L_I(\\omega_0) = 0$，我们得到：\n$$S_R(\\omega_0) = L_R(\\omega_0)\\cos(\\phi) = \\frac{A}{\\gamma}\\cos(\\phi)$$\n同样对于虚部：\n$$S_I(\\omega_0) = L'_I(\\omega_0) = L_R(\\omega_0)\\sin(\\phi) + L_I(\\omega_0)\\cos(\\phi)$$\n代入 $L_I(\\omega_0) = 0$，我们得到：\n$$S_I(\\omega_0) = L_R(\\omega_0)\\sin(\\phi) = \\frac{A}{\\gamma}\\sin(\\phi)$$\n\n我们得到一个包含我们计算出的基线校正值的方程组：\n$$3.000 = \\frac{A}{\\gamma}\\cos(\\phi)$$\n$$0.600 = \\frac{A}{\\gamma}\\sin(\\phi)$$\n为了求出相角 $\\phi$，我们可以用第二个方程除以第一个方程。未知的振幅因子 $\\frac{A}{\\gamma}$ 被消掉。\n$$\\frac{S_I(\\omega_0)}{S_R(\\omega_0)} = \\frac{\\frac{A}{\\gamma}\\sin(\\phi)}{\\frac{A}{\\gamma}\\cos(\\phi)} = \\tan(\\phi)$$\n代入数值：\n$$\\tan(\\phi) = \\frac{0.600}{3.000} = 0.200$$\n相位误差角 $\\phi$ 是该值的反正切：\n$$\\phi = \\arctan(0.200)$$\n以弧度计算该值：\n$$\\phi \\approx 0.1973955598... \\text{ rad}$$\n按要求将结果四舍五入到四位有效数字，得到：\n$$\\phi \\approx 0.1974 \\text{ rad}$$",
            "answer": "$$\n\\boxed{0.1974}\n$$"
        },
        {
            "introduction": "在单个谱峰校正的基础上，本练习将我们带入一个更真实的场景：相位误差在整个谱图范围内是变化的。我们将探讨频率依赖性相位误差的物理来源（通常是数据采集中的微小时间延迟），并引入线性相位误差模型 $\\phi(\\omega) = \\phi_{0} + \\phi_{1}\\omega$ 。这个练习模拟了波谱学家的实际工作流程：利用多个参考峰来确定全局校正参数，同时应对仪器报告的相位数据回卷（wrapping）所带来的挑战。",
            "id": "3694188",
            "problem": "在用于有机化合物光谱鉴定的傅里叶变换 (FT) 核磁共振波谱学中，不完美的接收器时序和参考相位会产生相位误差，该误差可一阶近似为角频率的线性函数。具体而言，如果检测到的自由感应衰减在时间上有一个小的偏移量 $t_{0}$，并且接收器增加了一个恒定的相位偏移 $\\phi_{0}$，那么复数谱会获得一个相位 $\\phi(\\omega)$，它可以很好地由 $\\phi(\\omega) = \\phi_{0} + \\phi_{1}\\,\\omega$ 描述，其中 $\\phi_{1}$ 等于有效时间原点偏移 $t_{0}$，$\\omega$ 是角频率。基线畸变通过在相位分析之前从幅度谱中减去一个平滑的基线来单独处理；假设此基线校正已经执行。\n\n在整个谱中选取了六个具有良好表征的吸收模式线型的非重叠参考峰。它们的角频率 $\\omega_{i}$ 和测量的相位 $\\tilde{\\phi}_{i}$（由仪器在区间 $(-\\pi,\\pi]$ 内以 $2\\pi$ 为模报告）如下所列。每次相位测量的标准不确定度均为 $0.05$ 弧度。\n\n- $\\omega_{1} = 500~\\mathrm{rad/s}$, $\\tilde{\\phi}_{1} = -0.21~\\mathrm{rad}$\n- $\\omega_{2} = 1000~\\mathrm{rad/s}$, $\\tilde{\\phi}_{2} = -0.87~\\mathrm{rad}$\n- $\\omega_{3} = 1500~\\mathrm{rad/s}$, $\\tilde{\\phi}_{3} = -1.42~\\mathrm{rad}$\n- $\\omega_{4} = 2000~\\mathrm{rad/s}$, $\\tilde{\\phi}_{4} = -2.06~\\mathrm{rad}$\n- $\\omega_{5} = 2500~\\mathrm{rad/s}$, $\\tilde{\\phi}_{5} = -2.63~\\mathrm{rad}$\n- $\\omega_{6} = 3000~\\mathrm{rad/s}$, $\\tilde{\\phi}_{6} = 3.003~\\mathrm{rad}$\n\n从时域中的时间平移与频域中的线性相位斜坡之间的基本关系出发，并使用统计推断中最小二乘估计的定义，首先通过加上或减去 $2\\pi$ 的适当整数倍来解开相位 $\\tilde{\\phi}_{i}$，以获得一组与 $\\omega_{i}$ 呈线性关系的连续相位 $\\phi_{i}$。然后对 $\\phi_{i}$ 与 $\\omega_{i}$ 进行加权线性回归（由于不确定度相同，权重相等），以估计零阶相位 $\\phi_{0}$（单位为弧度）和一阶相位系数 $\\phi_{1}$（单位为秒）。\n\n将 $\\phi_{0}$（单位为弧度）和 $\\phi_{1}$（单位为秒）的最终数值表示出来，四舍五入到四位有效数字。提供这两个数字作为您的最终答案。",
            "solution": "用户提供的问题陈述已经过验证，被认为是科学上合理的、适定的和客观的。它描述了傅里叶变换核磁共振（FT-NMR）波谱学中的一个标准数据分析程序。\n\n该问题需要一个两步过程，从一组测量的相位数据点中确定零阶相位 $\\phi_{0}$ 和一阶相位系数 $\\phi_{1}$。相位误差作为角频率 $\\omega$ 函数的底层模型由以下线性关系给出：\n$$\n\\phi(\\omega) = \\phi_{0} + \\phi_{1}\\omega\n$$\n该模型与傅里叶变换的基本性质一致。一个时域信号 $s(t)$ 被平移 $t_{0}$ 变为 $s(t-t_{0})$，如果变换核定义为 $\\exp(i\\omega t)$，其傅里叶变换将是 $S(\\omega)\\exp(i\\omega t_{0})$；如果变换核为 $\\exp(-i\\omega t)$，则其傅里叶变换为 $S(\\omega)\\exp(-i\\omega t_{0})$。问题陈述指明 $\\phi_{1}$ 等于时间偏移 $t_{0}$，这意味着所用的约定导致了相位项为 $+\\omega t_{0}$。仪器还引入了一个恒定的相位偏移 $\\phi_{0}$。因此，总相位是这两个贡献的总和，与给定模型相匹配。\n\n提供的数据包含六对角频率 $(\\omega_{i})$ 及其对应的测量相位 $(\\tilde{\\phi}_{i})$。这些相位是折叠的，意味着它们是在区间 $(-\\pi, \\pi]$ 内以 $2\\pi$ 为模报告的。第一步是解开这些相位，以获得一个连续的线性趋势。第二步是对解开的数据进行线性最小二乘回归，以找到最佳拟合参数 $\\phi_{0}$ 和 $\\phi_{1}$。\n\n**步骤 1：相位解缠**\n真实相位 $\\phi_{i}$ 通过方程 $\\phi_{i} = \\tilde{\\phi}_{i} + 2\\pi k_{i}$ 与测量相位 $\\tilde{\\phi}_{i}$ 相关联，其中 $k_{i}$ 是一个整数。我们必须为 $i=1, \\dots, 6$ 找到正确的整数 $k_{i}$，使得序列 $\\phi_{i}$ 相对于 $\\omega_{i}$ 近似线性。我们可以迭代地完成这个过程。\n\n我们假设第一个点没有被折叠，所以 $k_{1}=0$。\n- 对于 $i=1$：$\\omega_{1} = 500~\\mathrm{rad/s}$，$\\tilde{\\phi}_{1} = -0.21~\\mathrm{rad}$。令 $\\phi_{1} = \\tilde{\\phi}_{1} = -0.21$。\n\n- 对于 $i=2$：$\\omega_{2} = 1000~\\mathrm{rad/s}$，$\\tilde{\\phi}_{2} = -0.87~\\mathrm{rad}$。与第一个点的相位差是 $\\tilde{\\phi}_{2} - \\phi_{1} = -0.66~\\mathrm{rad}$。对于 $500~\\mathrm{rad/s}$ 的频率步长来说，这是一个合理的变化。我们设置 $k_{2}=0$，所以 $\\phi_{2} = \\tilde{\\phi}_{2} = -0.87$。\n\n- 对于 $i=3$：$\\omega_{3} = 1500~\\mathrm{rad/s}$，$\\tilde{\\phi}_{3} = -1.42~\\mathrm{rad}$。相位差是 $\\tilde{\\phi}_{3} - \\phi_{2} = -0.55~\\mathrm{rad}$。这与上一步类似，所以我们设置 $k_{3}=0$，得到 $\\phi_{3} = -1.42$。\n\n- 对于 $i=4$：$\\omega_{4} = 2000~\\mathrm{rad/s}$，$\\tilde{\\phi}_{4} = -2.06~\\mathrm{rad}$。差值是 $\\tilde{\\phi}_{4} - \\phi_{3} = -0.64~\\mathrm{rad}$。我们设置 $k_{4}=0$，得到 $\\phi_{4} = -2.06$。\n\n- 对于 $i=5$：$\\omega_{5} = 2500~\\mathrm{rad/s}$，$\\tilde{\\phi}_{5} = -2.63~\\mathrm{rad}$。差值是 $\\tilde{\\phi}_{5} - \\phi_{4} = -0.57~\\mathrm{rad}$。我们设置 $k_{5}=0$，得到 $\\phi_{5} = -2.63$。\n\n- 对于 $i=6$：$\\omega_{6} = 3000~\\mathrm{rad/s}$，$\\tilde{\\phi}_{6} = 3.003~\\mathrm{rad}$。与前一个测量相位的差是 $\\tilde{\\phi}_{6} - \\phi_{5} = 3.003 - (-2.63) = 5.633~\\mathrm{rad}$。这是一个显著的跳跃，与之前的差值（均约为 $-0.6~\\mathrm{rad}$）不一致。这表明发生了相位折叠。$5.633~\\mathrm{rad}$ 的跳跃接近于 $2\\pi \\approx 6.283~\\mathrm{rad}$。为了恢复线性，我们必须减去 $2\\pi$ 的整数倍。预期的相位 $\\phi_{6}$ 应该接近于 $\\phi_{5} + (\\phi_{5}-\\phi_{4}) \\approx -2.63 - 0.57 = -3.20~\\mathrm{rad}$。$\\tilde{\\phi}_{6} - 2\\pi = 3.003 - 2\\pi \\approx 3.003 - 6.283 = -3.28~\\mathrm{rad}$ 的值非常接近这个预期值。因此，我们选择 $k_{6}=-1$。\n$\\phi_{6} = \\tilde{\\phi}_{6} + 2\\pi k_{6} = 3.003 - 2\\pi$。\n\n解缠后的数据集 $(\\omega_{i}, \\phi_{i})$ 是：\n- $(\\omega_{1}, \\phi_{1}) = (500, -0.21)$\n- $(\\omega_{2}, \\phi_{2}) = (1000, -0.87)$\n- $(\\omega_{3}, \\phi_{3}) = (1500, -1.42)$\n- $(\\omega_{4}, \\phi_{4}) = (2000, -2.06)$\n- $(\\omega_{5}, \\phi_{5}) = (2500, -2.63)$\n- $(\\omega_{6}, \\phi_{6}) = (3000, 3.003 - 2\\pi)$\n\n**步骤 2：加权线性回归**\n我们需要将模型 $\\phi = \\phi_{0} + \\phi_{1}\\omega$ 拟合到解缠后的数据。由于每次相位测量的标准不确定度都相同（$0.05~\\mathrm{rad}$），加权最小二乘回归简化为非加权线性回归。$\\phi_{0}$ 和 $\\phi_{1}$ 的估计值是使残差平方和最小化的值。\n\n斜率 ($\\phi_{1}$) 和截距 ($\\phi_{0}$) 的公式为：\n$$\n\\phi_{1} = \\frac{N \\sum_{i=1}^{N}(\\omega_{i} \\phi_{i}) - (\\sum_{i=1}^{N} \\omega_{i})(\\sum_{i=1}^{N} \\phi_{i})}{N \\sum_{i=1}^{N}(\\omega_{i}^2) - (\\sum_{i=1}^{N} \\omega_{i})^2}\n$$\n$$\n\\phi_{0} = \\bar{\\phi} - \\phi_{1} \\bar{\\omega} = \\frac{1}{N}\\sum_{i=1}^{N}\\phi_{i} - \\phi_{1} \\left(\\frac{1}{N}\\sum_{i=1}^{N}\\omega_{i}\\right)\n$$\n其中 $N=6$。我们计算必要的总和：\n- $\\sum_{i=1}^{6} \\omega_{i} = 500+1000+1500+2000+2500+3000 = 10500$\n- $\\sum_{i=1}^{6} \\omega_{i}^2 = 500^2+1000^2+1500^2+2000^2+2500^2+3000^2 = 250000(1^2+2^2+3^2+4^2+5^2+6^2) = 250000(91) = 22750000$\n- $\\sum_{i=1}^{6} \\phi_{i} = -0.21 - 0.87 - 1.42 - 2.06 - 2.63 + (3.003 - 2\\pi) = -4.187 - 2\\pi$\n- $\\sum_{i=1}^{6} (\\omega_{i} \\phi_{i}) = 500(-0.21) + 1000(-0.87) + 1500(-1.42) + 2000(-2.06) + 2500(-2.63) + 3000(3.003 - 2\\pi)$\n   $= -105 - 870 - 2130 - 4120 - 6575 + 9009 - 6000\\pi = -4791 - 6000\\pi$\n\n现在，我们将这些总和代入公式中。\n$\\phi_{1}$ 的分母是：\n$$\nN \\sum \\omega_{i}^2 - (\\sum \\omega_{i})^2 = 6(22750000) - (10500)^2 = 136500000 - 110250000 = 26250000\n$$\n$\\phi_{1}$ 的分子是：\n$$\nN \\sum(\\omega_{i} \\phi_{i}) - (\\sum \\omega_{i})(\\sum \\phi_{i}) = 6(-4791 - 6000\\pi) - (10500)(-4.187 - 2\\pi)\n$$\n$$\n= -28746 - 36000\\pi - (-43963.5 - 21000\\pi) = 15217.5 - 15000\\pi\n$$\n所以，$\\phi_{1}$ 的估计值为：\n$$\n\\phi_{1} = \\frac{15217.5 - 15000\\pi}{26250000} \\approx \\frac{15217.5 - 15000(3.14159265)}{26250000} \\approx \\frac{-31906.3898}{26250000} \\approx -0.0012154815~\\mathrm{s}\n$$\n接下来，我们计算 $\\phi_{0}$ 的估计值。\n$\\bar{\\omega} = \\frac{10500}{6} = 1750~\\mathrm{rad/s}$。\n$\\bar{\\phi} = \\frac{-4.187 - 2\\pi}{6}$。\n$$\n\\phi_{0} = \\bar{\\phi} - \\phi_{1} \\bar{\\omega} = \\frac{-4.187 - 2\\pi}{6} - \\left( \\frac{15217.5 - 15000\\pi}{26250000} \\right) (1750)\n$$\n$$\n\\phi_{0} = \\frac{-4.187 - 2\\pi}{6} - \\frac{15217.5 - 15000\\pi}{15000} = \\frac{-4.187 - 2\\pi}{6} - (1.0145 - \\pi)\n$$\n$$\n\\phi_{0} = -0.697833... - \\frac{\\pi}{3} - 1.0145 + \\pi = -1.712333... + \\frac{2\\pi}{3}\n$$\n$$\n\\phi_{0} \\approx -1.712333... + \\frac{2(3.14159265)}{3} \\approx -1.712333... + 2.094395... \\approx 0.382062~\\mathrm{rad}\n$$\n\n**步骤 3：最终答案**\n问题要求将 $\\phi_{0}$ 和 $\\phi_{1}$ 的最终数值四舍五入到四位有效数字。\n$\\phi_{0} \\approx 0.382062~\\mathrm{rad}$。四舍五入到四位有效数字得到 $0.3821$。\n$\\phi_{1} \\approx -0.0012154815~\\mathrm{s}$。四舍五入到四位有效数字得到 $-0.001215$。\n\n估计的参数是 $\\phi_{0} = 0.3821~\\mathrm{rad}$ 和 $\\phi_{1} = -0.001215~\\mathrm{s}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.3821  -0.001215\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "最后的这项练习将引导您从手动校正转向算法思维，这是现代科学数据分析的一项关键技能。我们将探讨一个更深层次的问题：计算机如何自动区分由可校正的相位误差引起的谱线扭曲，和由两个真实信号重叠造成的谱线变形？ 通过这项编程练习，您将构建一个分析工具，通过检验谱图实部和虚部的正交性——这是正确定相信号的关键特征——来回答这个问题。",
            "id": "3694138",
            "problem": "您需要实现一个程序，在与有机化合物光谱鉴定相关的合成谱图中，区分由相位误差引起的谱特征与真实的峰重叠。您的程序必须从由指数衰减正弦波组成的时域自由感应衰减（FID）信号生成复杂谱图，并通过 principled 比较改变零阶和一阶相位参数时谱图的变化，来为每个测试案例判断观测到的扭曲是由相位误差主导还是由真实重叠主导。\n\n基本原理：\n- FID 被建模为阻尼复指数的线性叠加：对于时间样本 $t_n = n \\Delta t$，其中 $n \\in \\{0,1,\\dots,N-1\\}$，\n$$ s(t_n) = \\sum_{k=1}^{K} A_k \\exp\\!\\big( i 2\\pi f_k t_n \\big)\\,\\exp\\!\\big(-t_n/T_{2,k}\\big). $$\n- 频域谱是 $s(t_n)$ 的离散傅里叶变换（DFT），在频率点 $\\nu_m$ 处表示为 $S(\\nu_m)$。\n- 零阶和一阶相位通过以下方式对复数谱进行乘法修正：\n$$ S_{\\text{meas}}(\\nu) = S(\\nu)\\,\\exp\\!\\Big( i \\big[\\phi_0 + \\phi_1(\\nu - \\nu_{\\text{ref}})\\big] \\Big), $$\n其中 $\\phi_0$ 是以弧度为单位的恒定相位偏移，$\\phi_1$ 是以弧度/赫兹为单位的线性相位斜率，$\\nu_{\\text{ref}}$ 是以赫兹为单位的选定参考频率。\n- 观测到的实部通道 $R(\\nu)$ 和虚部通道 $I(\\nu)$ 分别是 $S_{\\text{meas}}(\\nu)$ 的实部和虚部。在没有相位误差的情况下，$R(\\nu)$ 主要包含吸收线型，$I(\\nu)$ 主要包含色散线型。零阶相位误差将 $I(\\nu)$ 按与 $\\phi_0$ 成正比的比例混入 $R(\\nu)$，而一阶相位误差则将 $I(\\nu)$ 以与 $(\\nu - \\nu_{\\text{ref}})\\phi_1$ 成正比的频率相关权重混入 $R(\\nu)$。\n\n任务：\n- 对于下方的每个测试案例，您必须：\n  1. 生成时域 FID $s(t_n)$，通过离散傅里叶变换计算其复数谱 $S(\\nu_m)$，并保留非负频率部分 $\\nu_m \\ge 0$。\n  2. 应用相位模型，使用指定的 $\\phi_0$ 和 $\\phi_1$ 获得 $S_{\\text{meas}}(\\nu)$。然后定义 $R(\\nu) = \\mathrm{Re}\\big(S_{\\text{meas}}(\\nu)\\big)$ 和 $I(\\nu) = \\mathrm{Im}\\big(S_{\\text{meas}}(\\nu)\\big)$。\n  3. 仅将指定的基线多项式 $b(\\nu)$ 添加到 $R(\\nu)$ 中，其中\n     $$ b(\\nu) = c_0 + c_1(\\nu - \\nu_{\\text{ref}}) + c_2(\\nu - \\nu_{\\text{ref}})^2. $$\n  4. 为将分析集中在峰上并避免基线区域，创建一个掩码，选择幅度 $\\lvert S_{\\text{meas}}(\\nu)\\rvert$ 超过其最大值的固定比例的频率点，具体为满足以下条件的 $\\nu$：\n     $$ \\lvert S_{\\text{meas}}(\\nu)\\rvert \\ge \\alpha \\max_{\\nu'} \\lvert S_{\\text{meas}}(\\nu')\\rvert, $$\n     其中 $\\alpha = 0.2$（无量纲）。\n  5. 通过最小化掩码处理后的实部和虚部通道之间的归一化相关性来量化相位误差特征，该最小化过程通过对相位参数进行小幅调整实现：\n     $$ M(\\phi_0',\\phi_1') = \\frac{\\left\\lvert \\sum_{\\nu \\in \\mathcal{M}} \\big(R'(\\nu) - \\bar R'\\big)\\big(I'(\\nu) - \\bar I'\\big) \\right\\rvert}{\\sqrt{\\sum_{\\nu \\in \\mathcal{M}} \\big(R'(\\nu) - \\bar R'\\big)^2}\\,\\sqrt{\\sum_{\\nu \\in \\mathcal{M}} \\big(I'(\\nu) - \\bar I'\\big)^2}}, $$\n     其中 $\\mathcal{M}$ 是掩码索引集，$R'(\\nu)$ 和 $I'(\\nu)$ 是在对 $S_{\\text{meas}}(\\nu)$ 应用附加相位校正 $\\exp\\!\\big(-i[\\phi_0' + \\phi_1'(\\nu - \\nu_{\\text{ref}})]\\big)$ 后获得的值；上划线表示掩码样本的平均值。设 $M_{\\text{initial}} = M(0,0)$ 且\n     $$ M_{\\min} = \\min_{\\phi_0'\\in\\Phi_0,\\,\\phi_1'\\in\\Phi_1} M(\\phi_0',\\phi_1'), $$\n     其中搜索集为\n     $$ \\Phi_0 = \\{ \\phi_0' \\,\\mid\\, \\phi_0' \\in [-\\pi/6,\\ \\pi/6] \\}, \\quad \\Phi_1 = \\{ \\phi_1' \\,\\mid\\, \\phi_1' \\in [-10^{-2},\\ 10^{-2}] \\ \\text{rad/Hz} \\}. $$\n     对 $\\Phi_0$ 使用至少 $61$ 个样本的均匀网格，对 $\\Phi_1$ 使用至少 $41$ 个样本的均匀网格。\n  6. 通过改善率 $\\mathrm{IR}$ 来判断是否为相位主导：\n     $$ \\mathrm{IR} = M_{\\text{initial}} - M_{\\min}. $$\n     如果 $\\mathrm{IR} \\ge \\tau$，则声明该案例为相位主导，输出整数 $1$；否则声明为重叠/基线主导，输出整数 $0$。使用固定阈值 $\\tau = 0.2$（无量纲）。\n\n需遵守的实现细节：\n- 使用 $N = 4096$ 个样本和采样间隔 $\\Delta t = 1.0\\times 10^{-3}\\ \\mathrm{s}$。\n- 使用 $\\nu_{\\text{ref}} = 0\\ \\mathrm{Hz}$。\n- 角度 $\\phi_0$ 和 $\\phi_1$ 必须以弧度为单位，其中 $\\phi_1$ 的单位为弧度/赫兹。\n- 如果任何答案涉及角度，始终以弧度表示。频率必须以赫兹处理。\n- 您的最终程序必须是确定性的，并且不得使用任何随机数。\n\n测试套件：\n对于每个案例，定义数组 $\\{A_k\\}$、以赫兹为单位的 $\\{f_k\\}$ 和以秒为单位的 $\\{T_{2,k}\\}$，以及以弧度为单位的 $\\phi_0$、以弧度/赫兹为单位的 $\\phi_1$ 和基线系数 $(c_0,c_1,c_2)$。\n\n- 案例 1（单峰，零阶相位误差）：\n  - $K=1$, $A=[1.0]$, $f=[50.0]$, $T_2=[0.15]$,\n  - $\\phi_0 = 0.349066$, $\\phi_1 = 0.0$,\n  - $(c_0,c_1,c_2) = (0.0, 0.0, 0.0)$。\n\n- 案例 2（两个重叠峰，正确相位）：\n  - $K=2$, $A=[1.0, 0.6]$, $f=[50.0, 57.0]$, $T_2=[0.15, 0.12]$,\n  - $\\phi_0 = 0.0$, $\\phi_1 = 0.0$,\n  - $(c_0,c_1,c_2) = (0.0, 0.0, 0.0)$。\n\n- 案例 3（两个重叠峰，一阶相位误差）：\n  - $K=2$, $A=[1.0, 0.6]$, $f=[50.0, 57.0]$, $T_2=[0.15, 0.12]$,\n  - $\\phi_0 = 0.0$, $\\phi_1 = 0.004$,\n  - $(c_0,c_1,c_2) = (0.0, 0.0, 0.0)$。\n\n- 案例 4（严重重叠峰，微小零阶相位）：\n  - $K=2$, $A=[1.0, 0.9]$, $f=[50.0, 52.0]$, $T_2=[0.20, 0.18]$,\n  - $\\phi_0 = 0.0174533$, $\\phi_1 = 0.0$,\n  - $(c_0,c_1,c_2) = (0.0, 0.0, 0.0)$。\n\n- 案例 5（带基线和零阶相位的单峰）：\n  - $K=1$, $A=[1.0]$, $f=[50.0]$, $T_2=[0.12]$,\n  - $\\phi_0 = 0.436332$, $\\phi_1 = 0.0$,\n  - $(c_0,c_1,c_2) = (0.05, 2.0\\times 10^{-4}, -1.0\\times 10^{-6})$。\n\n要求输出：\n- 对每个案例，计算上述整数决策：如果 $\\mathrm{IR} \\ge \\tau$ 输出 $1$，否则输出 $0$。\n- 您的程序应生成单行输出，其中包含五个案例的结果，形式为方括号括起来的逗号分隔整数列表，例如 $[1,0,1,0,1]$。\n\n角度单位要求：\n- 所有内部和外部角度必须以弧度为单位。一阶相位系数 $\\phi_1$ 的单位是弧度/赫兹。不得使用度。\n\n物理单位：\n- 时间单位为秒，频率单位为赫兹，角度单位为弧度。计算中不允许使用其他单位。\n\n您的解决方案必须是最终答案部分指定的完整、可运行的程序。",
            "solution": "该问题要求实现一种算法，以区分由相位误差引起的光谱扭曲和由真实峰重叠或基线伪影造成的光谱扭曲。该方法基于对相位非相干性的量化测量及其对系统性相位校正程序的响应。\n\n解决方案通过一个多步骤的流程来处理每个测试案例，具体如下。\n\n**1. 信号生成与傅里叶变换**\n模拟的基础是时域信号，即自由感应衰减（FID）。对于每个案例，FID $s(t_n)$ 被合成为 $K$ 个复数、指数衰减的正弦波之和。该模型在多种形式的光谱学（如核磁共振NMR、傅里叶变换离子回旋共振FT-ICR）中，能准确表示来自多个不同分子种类或原子核位点的信号。公式如下：\n$$ s(t_n) = \\sum_{k=1}^{K} A_k \\exp(i 2\\pi f_k t_n) \\exp(-t_n/T_{2,k}) $$\n此处，$t_n = n \\Delta t$，对于 $n \\in \\{0, 1, \\dots, N-1\\}$，其中 $N=4096$，$\\Delta t = 10^{-3}$ s。$A_k$ 是振幅，$f_k$ 是振荡频率（单位Hz），$T_{2,k}$ 是第 $k$ 个组分的横向弛豫时间常数。\n\n频域谱 $S(\\nu)$ 通过对复数FID $s(t_n)$ 进行离散傅里叶变换（DFT）得到，为提高效率，使用快速傅里叶变换（FFT）算法。相应的频率轴 $\\nu_m$ 也被生成。按照规定，仅保留谱图的非负频率部分（$\\nu_m \\ge 0$）进行分析。这是标准做法，因为对于真实信号，负频率部分是冗余的。虽然我们的信号是复数，但我们感兴趣的频率 $f_k$ 是正数。\n\n**2. 施加谱伪影**\n然后，对理想谱图 $S(\\nu)$ 进行修改，以模拟实验中的不完美之处。\n\n首先，以乘法方式引入相位误差。这是傅里叶变换光谱学中常见的伪影。测量谱 $S_{\\text{meas}}(\\nu)$ 与真实谱 $S(\\nu)$ 的关系如下：\n$$ S_{\\text{meas}}(\\nu) = S(\\nu) \\exp\\Big( i \\big[\\phi_0 + \\phi_1(\\nu - \\nu_{\\text{ref}})\\big] \\Big) $$\n此处，$\\phi_0$ 是零阶相位误差（对所有频率的恒定旋转），$\\phi_1$ 是一阶相位误差（随频率变化的旋转），其中 $\\nu_{\\text{ref}} = 0$ Hz。此操作会将理想谱线中纯吸收的实部和纯色散的虚部混合在一起。\n\n其次，一个多项式基线扭曲 $b(\\nu)$ *仅*被加到谱图的实部：\n$$ b(\\nu) = c_0 + c_1(\\nu - \\nu_{\\text{ref}}) + c_2(\\nu - \\nu_{\\text{ref}})^2 $$\n$$ R(\\nu) = \\mathrm{Re}\\big(S_{\\text{meas}}(\\nu)\\big) + b(\\nu) $$\n这模拟了在处理过的谱图中经常影响实部（吸收）通道的基线漂移。虚部保持为 $I(\\nu) = \\mathrm{Im}\\big(S_{\\text{meas}}(\\nu)\\big)$。\n\n**3. 用于聚焦分析的谱图掩码**\n为确保分析对峰的扭曲敏感，而不是对无信号区域的噪声或基线敏感，我们创建了一个掩码。该掩码只选择信号幅度 $|S_{\\text{meas}}(\\nu)|$ 显著的频率点。具体来说，我们选择满足以下条件的点：\n$$ |S_{\\text{meas}}(\\nu)| \\ge \\alpha \\max_{\\nu'} |S_{\\text{meas}}(\\nu')| $$\n阈值因子 $\\alpha = 0.2$。这个掩码由索引集 $\\mathcal{M}$ 表示，它被计算一次后，用于给定测试案例的所有后续相关性计算。\n\n**4. 通过相关性最小化量化相位误差**\n决策逻辑的核心在于量化相位误差。一个理想的、相位正确的峰具有纯吸收（对称）的实部和纯色散（反对称）的虚部。在峰周围的对称区间内，这两个分量是正交的，意味着它们的相关性为零。相位误差会引入混合，从而产生非零相关性。\n\n我们定义一个度量 $M(\\phi_0', \\phi_1')$，它是施加由参数 $(\\phi_0', \\phi_1')$ 表征的*试验性相位校正*后，实部和虚部通道之间的绝对皮尔逊相关系数。校正后的谱图为 $S'(\\nu) = S_{\\text{meas}}(\\nu) \\exp\\big(-i[\\phi_0' + \\phi_1'(\\nu - \\nu_{\\text{ref}})]\\big)$。用于相关性计算的通道是 $R'(\\nu) = \\mathrm{Re}(S'(\\nu)) + b(\\nu)$ 和 $I'(\\nu) = \\mathrm{Im}(S'(\\nu))$。该度量为：\n$$ M(\\phi_0',\\phi_1') = \\frac{\\left\\lvert \\sum_{\\nu \\in \\mathcal{M}} \\big(R'(\\nu) - \\bar R'\\big)\\big(I'(\\nu) - \\bar I'\\big) \\right\\rvert}{\\sqrt{\\sum_{\\nu \\in \\mathcal{M}} \\big(R'(\\nu) - \\bar R'\\big)^2}\\,\\sqrt{\\sum_{\\nu \\in \\mathcal{M}} \\big(I'(\\nu) - \\bar I'\\big)^2}} $$\n其中求和与平均值是在掩码区域 $\\mathcal{M}$ 上进行的。\n\n算法首先计算初始相关性 $M_{\\text{initial}} = M(0, 0)$。然后，它在试验校正参数 $\\phi_0' \\in [-\\pi/6, \\pi/6]$ 和 $\\phi_1' \\in [-10^{-2}, 10^{-2}]$ rad/Hz 的空间上进行网格搜索，以找到可能的最小相关性 $M_{\\min}$。搜索网格分别使用 $61$ 和 $41$ 个点。\n\n如果谱图扭曲主要是由相位误差引起的，那么选择合适的 $(\\phi_0', \\phi_1')$ 将能逆转该误差，从而在很大程度上恢复实部和虚部的正交性，并显著降低相关性。因此，$M_{\\min}$ 将远小于 $M_{\\text{initial}}$。如果扭曲是由固有的峰重叠或无法校正的基线引起的，那么简单的相位校正无法消除它，$M_{\\min}$ 将接近 $M_{\\text{initial}}$。\n\n**5. 决策标准**\n通过改善率 $\\mathrm{IR} = M_{\\text{initial}} - M_{\\min}$ 来进行区分。大的 IR 表明初始相关性的很大部分可通过调相来校正，意味着存在主导的相位误差。小的 IR 表明相关性是信号固有的（例如峰重叠），或者是无法通过相位校正处理的伪影（如基线）。\n\n最终决策通过将 IR 与固定阈值 $\\tau = 0.2$ 进行比较来做出：\n- 如果 $\\mathrm{IR} \\ge \\tau$，该案例被分类为相位主导（输出 $1$）。\n- 如果 $\\mathrm{IR}  \\tau$，则被分类为重叠/基线主导（输出 $0$）。\n\n这种基于原则的方法提供了一种稳健、自动化的方法来识别谱图扭曲的性质，这是自动化谱图分析中的关键一步。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"K\": 1, \"A\": [1.0], \"f\": [50.0], \"T2\": [0.15],\n            \"phi0\": 0.349066, \"phi1\": 0.0, \"c\": (0.0, 0.0, 0.0)\n        },\n        {\n            \"K\": 2, \"A\": [1.0, 0.6], \"f\": [50.0, 57.0], \"T2\": [0.15, 0.12],\n            \"phi0\": 0.0, \"phi1\": 0.0, \"c\": (0.0, 0.0, 0.0)\n        },\n        {\n            \"K\": 2, \"A\": [1.0, 0.6], \"f\": [50.0, 57.0], \"T2\": [0.15, 0.12],\n            \"phi0\": 0.0, \"phi1\": 0.004, \"c\": (0.0, 0.0, 0.0)\n        },\n        {\n            \"K\": 2, \"A\": [1.0, 0.9], \"f\": [50.0, 52.0], \"T2\": [0.20, 0.18],\n            \"phi0\": 0.0174533, \"phi1\": 0.0, \"c\": (0.0, 0.0, 0.0)\n        },\n        {\n            \"K\": 1, \"A\": [1.0], \"f\": [50.0], \"T2\": [0.12],\n            \"phi0\": 0.436332, \"phi1\": 0.0, \"c\": (0.05, 2.0e-4, -1.0e-6)\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        decision = solve_case(case)\n        results.append(decision)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_correlation(R, I, mask):\n    \"\"\"\n    Calculates the absolute Pearson correlation coefficient for masked regions.\n    \"\"\"\n    R_masked = R[mask]\n    I_masked = I[mask]\n\n    if R_masked.size  2:\n        return 0.0\n\n    R_bar = np.mean(R_masked)\n    I_bar = np.mean(I_masked)\n\n    R_dev = R_masked - R_bar\n    I_dev = I_masked - I_bar\n\n    numerator = np.abs(np.sum(R_dev * I_dev))\n    \n    sum_sq_R = np.sum(R_dev**2)\n    sum_sq_I = np.sum(I_dev**2)\n    \n    denominator = np.sqrt(sum_sq_R * sum_sq_I)\n\n    if denominator  1e-15:  # Handle near-zero variance\n        return 0.0\n    \n    return numerator / denominator\n\ndef solve_case(case_params):\n    \"\"\"\n    Processes a single test case according to the problem description.\n    \"\"\"\n    # Global parameters\n    N = 4096\n    dt = 1.0e-3\n    nu_ref = 0.0\n    alpha = 0.2\n    tau = 0.2\n    N_phi0_grid = 61\n    N_phi1_grid = 41\n\n    # Unpack case-specific parameters\n    K = case_params['K']\n    A_list = np.array(case_params['A'])\n    f_list = np.array(case_params['f'])\n    T2_list = np.array(case_params['T2'])\n    phi0, phi1 = case_params['phi0'], case_params['phi1']\n    c0, c1, c2 = case_params['c']\n\n    # 1. Generate FID and spectrum\n    t = np.arange(N) * dt\n    # Use broadcasting for efficient FID generation\n    fid = np.sum(A_list[:, np.newaxis] \\\n                 * np.exp(1j * 2 * np.pi * f_list[:, np.newaxis] * t[np.newaxis, :]) \\\n                 * np.exp(-t[np.newaxis, :] / T2_list[:, np.newaxis]), axis=0)\n    \n    spectrum_full = np.fft.fft(fid)\n    freq_full = np.fft.fftfreq(N, d=dt)\n    \n    # Retain non-negative frequency part\n    sorted_indices = np.argsort(freq_full)\n    freq_sorted = freq_full[sorted_indices]\n    spectrum_sorted = spectrum_full[sorted_indices]\n    \n    non_neg_mask_freq = freq_sorted >= 0\n    nu = freq_sorted[non_neg_mask_freq]\n    S = spectrum_sorted[non_neg_mask_freq]\n    \n    # 2. Apply initial phase error\n    phase_initial = np.exp(1j * (phi0 + phi1 * (nu - nu_ref)))\n    S_meas = S * phase_initial\n\n    # 3. Define baseline polynomial\n    baseline = c0 + c1 * (nu - nu_ref) + c2 * (nu - nu_ref)**2\n    \n    # 4. Create analysis mask\n    magnitude = np.abs(S_meas)\n    max_mag = np.max(magnitude)\n    analysis_mask = magnitude >= alpha * max_mag\n\n    # 5. Quantify phase-error via grid search\n    phi0_prime_grid = np.linspace(-np.pi/6, np.pi/6, N_phi0_grid)\n    phi1_prime_grid = np.linspace(-1e-2, 1e-2, N_phi1_grid)\n\n    # Calculate M_initial = M(0, 0)\n    R_init = np.real(S_meas) + baseline\n    I_init = np.imag(S_meas)\n    M_initial = calculate_correlation(R_init, I_init, analysis_mask)\n    \n    # Grid search for M_min\n    M_min = M_initial\n    \n    for phi0_p in phi0_prime_grid:\n        for phi1_p in phi1_prime_grid:\n            phase_corr_prime = np.exp(-1j * (phi0_p + phi1_p * (nu - nu_ref)))\n            S_prime = S_meas * phase_corr_prime\n            \n            R_prime = np.real(S_prime) + baseline\n            I_prime = np.imag(S_prime)\n            \n            current_M = calculate_correlation(R_prime, I_prime, analysis_mask)\n            \n            if current_M  M_min:\n                M_min = current_M\n\n    # 6. Decide based on Improvement Ratio (IR)\n    IR = M_initial - M_min\n    \n    return 1 if IR >= tau else 0\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}