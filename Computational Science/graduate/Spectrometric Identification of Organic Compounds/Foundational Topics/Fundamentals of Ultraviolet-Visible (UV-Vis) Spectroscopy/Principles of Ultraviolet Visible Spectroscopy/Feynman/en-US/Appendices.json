{
    "hands_on_practices": [
        {
            "introduction": "While a full quantum mechanical treatment of a molecule can be complex, simplified models often provide profound insights into chemical trends. This practice explores the classic particle-in-a-box model, a cornerstone of introductory quantum mechanics, to explain a fundamental principle in UV-Vis spectroscopy: how the length of a conjugated $\\pi$-system influences the wavelength of maximum absorption ($\\lambda_{\\max}$). By calculating the HOMO-LUMO transition energy for polyenes of different lengths, you will derive a quantitative prediction for the red shift that occurs as conjugation is extended, connecting abstract theory to observable spectroscopic data .",
            "id": "3719614",
            "problem": "An organic chemist seeks to rationalize the ultraviolet-visible (UV-Vis) absorption maxima of conjugated polyenes using the one-dimensional particle-in-a-box model for the $\\pi$ electron system. Consider $N_{\\pi}$ electrons confined in a one-dimensional infinite potential well of length $L$ equal to the conjugated chain length, with two electrons per energy level (due to spin degeneracy) and the lowest-energy allowed optical transition approximated by the highest occupied molecular orbital (HOMO) to lowest unoccupied molecular orbital (LUMO) transition. Starting from the time-independent Schrödinger equation and the definition of the energy levels for a particle in a one-dimensional infinite potential well, derive the expression for the HOMO-LUMO transition energy and the corresponding absorption wavelength $\\lambda$ in terms of $L$, $N_{\\pi}$, the electron mass $m_{e}$, the speed of light $c$, and Planck’s constant $h$.\n\nUsing this framework, model the lowest-energy $\\pi \\rightarrow \\pi^{*}$ transition of butadiene (with $N_{\\pi} = 4$) and hexatriene (with $N_{\\pi} = 6$). Take the box length $L$ to be the conjugated chain length obtained by summing the appropriate carbon-carbon bond lengths along the polyene backbone, using $l_{\\mathrm{C{=}C}} = 1.34$ Å and $l_{\\mathrm{C{-}C}} = 1.47$ Å. Thus, for butadiene use $L_{\\mathrm{but}} = 2 l_{\\mathrm{C{=}C}} + 1 l_{\\mathrm{C{-}C}}$, and for hexatriene use $L_{\\mathrm{hex}} = 3 l_{\\mathrm{C{=}C}} + 2 l_{\\mathrm{C{-}C}}$. Compute the predicted absorption wavelengths $\\lambda_{\\mathrm{but}}$ and $\\lambda_{\\mathrm{hex}}$, and then compute the red shift $\\Delta \\lambda = \\lambda_{\\mathrm{hex}} - \\lambda_{\\mathrm{but}}$.\n\nUse $h = 6.62607015 \\times 10^{-34}$ J·s, $c = 2.99792458 \\times 10^{8}$ m·s$^{-1}$, and $m_{e} = 9.10938356 \\times 10^{-31}$ kg. Express the final red shift $\\Delta \\lambda$ in nanometers. Round your final answer to four significant figures.\n\nFor context in your discussion, typical experimental $\\lambda_{\\max}$ values are approximately $217$ nm for butadiene and $258$ nm for hexatriene, but do not use these values in your calculation of $\\Delta \\lambda$; they are provided only for qualitative comparison after you complete the computation.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard application of the particle-in-a-box model to approximate the electronic absorption spectra of conjugated polyenes, a classic problem in introductory quantum chemistry. All necessary data, constants, and conditions are provided, and there are no internal contradictions or violations of physical principles within the context of the model. Therefore, the problem is valid and a solution will be provided.\n\nThe analysis begins with the time-independent Schrödinger equation for a particle of mass $m$ confined to a one-dimensional box of length $L$, extending from $x=0$ to $x=L$. The potential energy $V(x)$ is $0$ inside the box and infinite outside. The equation is:\n$$\n-\\frac{\\hbar^2}{2m} \\frac{d^2\\psi(x)}{dx^2} = E\\psi(x)\n$$\nwhere $\\hbar$ is the reduced Planck constant ($h/(2\\pi)$), $\\psi(x)$ is the eigenfunction (wavefunction), and $E$ is the eigenvalue (energy). The boundary conditions are $\\psi(0)=0$ and $\\psi(L)=0$.\n\nThe solutions to this equation yield quantized energy levels for the particle, in this case an electron of mass $m_e$:\n$$\nE_n = \\frac{n^2 h^2}{8 m_e L^2}\n$$\nwhere $n$ is the principal quantum number, which can be any positive integer ($n = 1, 2, 3, \\ldots$), and $h$ is Planck's constant.\n\nIn the free electron model for a conjugated polyene with $N_{\\pi}$ $\\pi$-electrons, we assume these electrons occupy the available energy levels. According to the Pauli exclusion principle, a maximum of two electrons (with opposite spins) can occupy each energy level. The electrons will fill the levels starting from the lowest energy ($n=1$). Therefore, for $N_{\\pi}$ electrons, the number of occupied energy levels is $N_{\\pi}/2$.\n\nThe highest occupied molecular orbital (HOMO) corresponds to the energy level with quantum number $n_{\\mathrm{HOMO}}$. This is the highest energy level that is filled with electrons.\n$$\nn_{\\mathrm{HOMO}} = \\frac{N_{\\pi}}{2}\n$$\nThe lowest unoccupied molecular orbital (LUMO) corresponds to the next available energy level, which has the quantum number $n_{\\mathrm{LUMO}}$.\n$$\nn_{\\mathrm{LUMO}} = n_{\\mathrm{HOMO}} + 1 = \\frac{N_{\\pi}}{2} + 1\n$$\nThe lowest-energy electronic transition, observed in UV-Vis spectroscopy as the $\\pi \\rightarrow \\pi^{*}$ transition, corresponds to the promotion of an electron from the HOMO to the LUMO. The energy of this transition, $\\Delta E$, is the difference between the energies of these two levels:\n$$\n\\Delta E = E_{\\mathrm{LUMO}} - E_{\\mathrm{HOMO}} = E_{\\frac{N_{\\pi}}{2}+1} - E_{\\frac{N_{\\pi}}{2}}\n$$\nSubstituting the expression for $E_n$:\n$$\n\\Delta E = \\frac{h^2}{8 m_e L^2} \\left[ \\left(\\frac{N_{\\pi}}{2} + 1\\right)^2 - \\left(\\frac{N_{\\pi}}{2}\\right)^2 \\right]\n$$\nExpanding the squared term and simplifying:\n$$\n\\left(\\frac{N_{\\pi}}{2} + 1\\right)^2 - \\left(\\frac{N_{\\pi}}{2}\\right)^2 = \\left( \\frac{N_{\\pi}^2}{4} + N_{\\pi} + 1 \\right) - \\frac{N_{\\pi}^2}{4} = N_{\\pi} + 1\n$$\nThus, the expression for the transition energy is:\n$$\n\\Delta E = \\frac{h^2 (N_{\\pi} + 1)}{8 m_e L^2}\n$$\nThe energy of the absorbed photon is related to its wavelength $\\lambda$ by the Planck-Einstein relation, $\\Delta E = h\\nu = hc/\\lambda$, where $c$ is the speed of light. Solving for $\\lambda$:\n$$\n\\lambda = \\frac{hc}{\\Delta E} = \\frac{hc}{\\frac{h^2 (N_{\\pi} + 1)}{8 m_e L^2}}\n$$\nThis simplifies to the general expression for the absorption wavelength:\n$$\n\\lambda = \\frac{8 m_e c L^2}{h (N_{\\pi} + 1)}\n$$\nNow, we apply this derived expression to butadiene and hexatriene using the provided data: $l_{\\mathrm{C{=}C}} = 1.34$ Å and $l_{\\mathrm{C{-}C}} = 1.47$ Å. First, convert these lengths to SI units (meters):\n$l_{\\mathrm{C{=}C}} = 1.34 \\times 10^{-10}$ m\n$l_{\\mathrm{C{-}C}} = 1.47 \\times 10^{-10}$ m\n\nFor butadiene ($N_{\\pi} = 4$), the box length $L_{\\mathrm{but}}$ is:\n$$\nL_{\\mathrm{but}} = 2 l_{\\mathrm{C{=}C}} + 1 l_{\\mathrm{C{-}C}} = 2(1.34 \\times 10^{-10} \\text{ m}) + 1(1.47 \\times 10^{-10} \\text{ m}) = (2.68 + 1.47) \\times 10^{-10} \\text{ m} = 4.15 \\times 10^{-10} \\text{ m}\n$$\nFor hexatriene ($N_{\\pi} = 6$), the box length $L_{\\mathrm{hex}}$ is:\n$$\nL_{\\mathrm{hex}} = 3 l_{\\mathrm{C{=}C}} + 2 l_{\\mathrm{C{-}C}} = 3(1.34 \\times 10^{-10} \\text{ m}) + 2(1.47 \\times 10^{-10} \\text{ m}) = (4.02 + 2.94) \\times 10^{-10} \\text{ m} = 6.96 \\times 10^{-10} \\text{ m}\n$$\nThe physical constants provided are:\n$h = 6.62607015 \\times 10^{-34}$ J·s\n$c = 2.99792458 \\times 10^{8}$ m·s$^{-1}$\n$m_e = 9.10938356 \\times 10^{-31}$ kg\n\nNow, calculate the absorption wavelength for butadiene, $\\lambda_{\\mathrm{but}}$:\n$$\n\\lambda_{\\mathrm{but}} = \\frac{8 m_e c (L_{\\mathrm{but}})^2}{h (N_{\\pi} + 1)} = \\frac{8(9.10938356 \\times 10^{-31})(2.99792458 \\times 10^8)(4.15 \\times 10^{-10})^2}{(6.62607015 \\times 10^{-34})(4 + 1)}\n$$\n$$\n\\lambda_{\\mathrm{but}} = \\frac{(2.184906... \\times 10^{-21})(1.72225 \\times 10^{-19})}{(6.62607015 \\times 10^{-34})(5)} = \\frac{3.76307... \\times 10^{-40}}{3.313035... \\times 10^{-33}} = 1.13579... \\times 10^{-7} \\text{ m}\n$$\nIn nanometers, this is $\\lambda_{\\mathrm{but}} = 113.579...$ nm.\n\nNext, calculate the absorption wavelength for hexatriene, $\\lambda_{\\mathrm{hex}}$:\n$$\n\\lambda_{\\mathrm{hex}} = \\frac{8 m_e c (L_{\\mathrm{hex}})^2}{h (N_{\\pi} + 1)} = \\frac{8(9.10938356 \\times 10^{-31})(2.99792458 \\times 10^8)(6.96 \\times 10^{-10})^2}{(6.62607015 \\times 10^{-34})(6 + 1)}\n$$\n$$\n\\lambda_{\\mathrm{hex}} = \\frac{(2.184906... \\times 10^{-21})(4.84416 \\times 10^{-19})}{(6.62607015 \\times 10^{-34})(7)} = \\frac{1.05862... \\times 10^{-40}}{4.638249... \\times 10^{-33}} = 2.28242... \\times 10^{-7} \\text{ m}\n$$\nIn nanometers, this is $\\lambda_{\\mathrm{hex}} = 228.242...$ nm.\n\nFinally, compute the red shift, $\\Delta \\lambda$, which is the difference between the absorption wavelength of hexatriene and butadiene:\n$$\n\\Delta \\lambda = \\lambda_{\\mathrm{hex}} - \\lambda_{\\mathrm{but}} = 228.242... \\text{ nm} - 113.579... \\text{ nm} = 114.663... \\text{ nm}\n$$\nRounding the final result to four significant figures gives $114.7$. Re-checking the calculation with greater precision gives $114.649$ nm. Rounding to four significant figures gives $114.6$ nm. Let's recalculate carefully:\n$\\lambda_{\\mathrm{but}} = 1.13593 \\times 10^{-7}$ m.\n$\\lambda_{\\mathrm{hex}} = 2.28242 \\times 10^{-7}$ m.\n$\\Delta \\lambda = (2.28242 - 1.13593) \\times 10^{-7}$ m = $1.14649 \\times 10^{-7}$ m = $114.649$ nm.\nRounding to four significant figures yields $114.6$ nm.\n\nThe calculated values of $\\lambda_{\\mathrm{but}} \\approx 114$ nm and $\\lambda_{\\mathrm{hex}} \\approx 228$ nm are qualitatively consistent with the trend of increasing wavelength with increasing conjugation length. However, they quantitatively underestimate the experimental values of $\\lambda_{\\max}$ ($217$ nm for butadiene and $258$ nm for hexatriene). This discrepancy is expected, as the free electron model is a crude approximation that neglects electron-electron repulsion, assumes a constant potential within the box, and uses a simplified definition of the box length. More sophisticated models are required for quantitative accuracy.\n\nThe required calculation is the red shift, $\\Delta \\lambda$.\n$$\n\\Delta \\lambda = 114.649... \\text{ nm}\n$$\nRounding to four significant figures, the result is $114.6$ nm.",
            "answer": "$$\n\\boxed{114.6}\n$$"
        },
        {
            "introduction": "Moving from theoretical principles to practical laboratory work, quantitative analysis is a primary application of UV-Vis spectroscopy. This exercise is centered on the Beer-Lambert law and the essential task of creating a calibration curve to measure the concentration of an unknown sample . You will implement the method of ordinary least squares to fit a linear model to experimental data and then use this model to calculate a critical figure of merit: the limit of detection (LOD), which defines the minimum concentration that can be reliably measured.",
            "id": "3719580",
            "problem": "You are tasked with constructing calibration curves and computing the limit of detection for a chromophore measured by Ultraviolet-Visible (UV-Vis) spectroscopy. Work from first principles: assume a one-pass cell with fixed pathlength and a linear absorbance response within the investigated concentration range. Derive and implement a method to estimate the calibration slope and intercept by ordinary least squares, estimate the blank noise from replicate blank measurements, and compute the limit of detection. All computations must be internally consistent and unit-coherent. Your program must accept no input and must use the provided test suite embedded within the code.\n\nFundamental base:\n- The Beer–Lambert law states that absorbance satisfies $A=\\varepsilon b c$ for sufficiently dilute solutions, where $A$ is absorbance, $\\varepsilon$ is the molar absorptivity, $b$ is the optical pathlength, and $c$ is concentration. In practical calibration in the presence of baseline offsets and instrument drift, a linear model $A=mc+b$ is fit to calibration data, where $m$ is the slope and $b$ is the intercept.\n- For $n$ calibration pairs $\\{(c_i,A_i)\\}_{i=1}^n$, the ordinary least squares estimator minimizes $\\sum_{i=1}^n (A_i-(mc_i+b))^2$ over $m$ and $b$.\n- The blank noise standard deviation $\\sigma$ is estimated from $N$ replicate blank measurements $\\{A^{(\\text{blank})}_j\\}_{j=1}^N$ using the unbiased sample standard deviation.\n- Define the limit of detection (LOD) operationally as $LOD = \\dfrac{3\\sigma}{m}$.\n\nYour tasks:\n1. Given calibration data consisting of nonzero concentrations and replicate absorbance measurements at each concentration, construct the regression dataset by treating each replicate as an individual observation paired with its concentration. Fit the linear model $A=mc+b$ using ordinary least squares (no weighting).\n2. Estimate the blank noise $\\sigma$ as the unbiased sample standard deviation of the provided replicate blank absorbances.\n3. Compute the limit of detection using $LOD=\\dfrac{3\\sigma}{m}$.\n4. Convert the computed LOD from $\\mathrm{mol\\,L^{-1}}$ to micromoles per liter ($\\mu\\mathrm{M}$) by multiplying by $10^6$.\n5. For each test case, produce a single floating-point number equal to the LOD in $\\mu\\mathrm{M}$, rounded to six decimal places.\n\nImplement the following test suite. Each case specifies a list of concentrations (in $\\mathrm{mol\\,L^{-1}}$), a correspondingly indexed list of lists of absorbance replicates (unitless), and a list of blank absorbance replicates (unitless). Only the nonzero concentrations and their absorbance replicates are used in the regression. Blanks are used solely for estimating $\\sigma$.\n\nTest Case 1 (happy path, strong chromophore):\n- Concentrations $c$: $[2.0\\times 10^{-6}, 4.0\\times 10^{-6}, 6.0\\times 10^{-6}, 8.0\\times 10^{-6}]$ $\\mathrm{mol\\,L^{-1}}$.\n- Absorbance replicates per concentration $A$: first level $[0.0410, 0.0392, 0.0405]$, second level $[0.0812, 0.0791, 0.0806]$, third level $[0.1215, 0.1190, 0.1204]$, fourth level $[0.1610, 0.1588, 0.1603]$.\n- Blank replicates $A^{(\\text{blank})}$: $[0.0012, 0.0008, 0.0015, 0.0005, 0.0010, 0.0011, 0.0009, 0.0013, 0.0007, 0.0014]$.\n\nTest Case 2 (weaker chromophore, lower slope and higher relative noise):\n- Concentrations $c$: $[5.0\\times 10^{-6}, 1.0\\times 10^{-5}, 1.5\\times 10^{-5}, 2.0\\times 10^{-5}]$ $\\mathrm{mol\\,L^{-1}}$.\n- Absorbance replicates per concentration $A$: first level $[0.0076, 0.0072]$, second level $[0.0154, 0.0146]$, third level $[0.0228, 0.0223]$, fourth level $[0.0305, 0.0293]$.\n- Blank replicates $A^{(\\text{blank})}$: $[0.0003, 0.0011, 0.0009, 0.0015, 0.0007, 0.0012, 0.0006, 0.0010]$.\n\nTest Case 3 (nonzero intercept due to baseline offset):\n- Concentrations $c$: $[0.5\\times 10^{-6}, 1.0\\times 10^{-6}, 1.5\\times 10^{-6}, 2.0\\times 10^{-6}, 3.0\\times 10^{-6}]$ $\\mathrm{mol\\,L^{-1}}$.\n- Absorbance replicates per concentration $A$: first level $[0.0106, 0.0102]$, second level $[0.0155, 0.0150]$, third level $[0.0204, 0.0201]$, fourth level $[0.0252, 0.0248]$, fifth level $[0.0356, 0.0349]$.\n- Blank replicates $A^{(\\text{blank})}$: $[0.0051, 0.0048, 0.0053, 0.0049, 0.0050, 0.0052, 0.0047, 0.0054]$.\n\nTest Case 4 (edge case: minimal calibration, zero blank variance):\n- Concentrations $c$: $[1.0\\times 10^{-6}, 2.0\\times 10^{-6}]$ $\\mathrm{mol\\,L^{-1}}$.\n- Absorbance replicates per concentration $A$: first level $[0.0200]$, second level $[0.0400]$.\n- Blank replicates $A^{(\\text{blank})}$: $[0.0009, 0.0009, 0.0009, 0.0009]$.\n\nAngle units are not applicable. Express the final results for all four test cases in a single line as a comma-separated Python-style list of floats with each LOD in $\\mu\\mathrm{M}$, rounded to six decimal places (e.g., $[0.123456,0.234567,0.345678,0.456789]$). The program must print exactly this single line and nothing else.",
            "solution": "The problem requires the calculation of the limit of detection (LOD) for a chemical species from Ultraviolet-Visible (UV-Vis) spectroscopy calibration data. This will be accomplished by applying the principles of ordinary least squares (OLS) linear regression and statistical analysis of blank measurements. The entire procedure is grounded in established analytical chemistry methodology.\n\nThe fundamental relationship between absorbance ($A$) and concentration ($c$) for dilute solutions is given by the Beer-Lambert law, $A = \\varepsilon b c$, where $\\varepsilon$ is the molar absorptivity and $b$ is the optical pathlength. In a practical experimental setup, this relationship is modeled by a linear equation to account for instrumental offsets and background signals:\n$$A = mc + \\text{b}$$\nHere, $m$ is the calibration sensitivity or slope (proportional to $\\varepsilon b$) and $\\text{b}$ is the intercept, which ideally represents the absorbance of a blank sample.\n\nThe procedure to determine the LOD can be decomposed into four distinct steps.\n\nStep $1$: Linear Regression using Ordinary Least Squares (OLS)\n\nGiven a set of $n$ calibration data points $(c_i, A_i)$, where $c_i$ is the concentration and $A_i$ is the corresponding measured absorbance, the OLS method finds the parameters $m$ and $\\text{b}$ that minimize the sum of the squared residuals, $S$:\n$$S(m, \\text{b}) = \\sum_{i=1}^{n} (A_i - (mc_i + \\text{b}))^2$$\nTo find the minimum, the partial derivatives of $S$ with respect to $m$ and $\\text{b}$ are set to zero. This yields a system of two linear equations known as the normal equations. Solving this system gives the estimators for the slope ($m$) and intercept ($\\text{b}$). The formula for the slope $m$ is:\n$$m = \\frac{n \\sum_{i=1}^{n} c_i A_i - (\\sum_{i=1}^{n} c_i) (\\sum_{i=1}^{n} A_i)}{n \\sum_{i=1}^{n} c_i^2 - (\\sum_{i=1}^{n} c_i)^2}$$\nThe problem provides replicate absorbance measurements for each non-zero concentration. To construct the regression dataset, each replicate is treated as an individual data point. For a concentration $c_k$ with $r_k$ absorbance replicates, we generate $r_k$ pairs $(c_k, A_{k,j})$ for $j=1, \\dots, r_k$. The total number of points, $n$, is the sum of all replicates across all non-zero concentrations.\n\nStep $2$: Estimation of Blank Noise\n\nThe noise of the measurement system at zero concentration is a critical parameter. It is estimated by the standard deviation of a series of replicate blank measurements. Given $N$ blank absorbance readings $\\{A_j^{(\\text{blank})}\\}_{j=1}^N$, the noise is quantified by the unbiased sample standard deviation, $\\sigma$. The formula for $\\sigma$ is:\n$$\\sigma = \\sqrt{\\frac{1}{N-1} \\sum_{j=1}^{N} (A_j^{(\\text{blank})} - \\bar{A}^{(\\text{blank})})^2}$$\nwhere $\\bar{A}^{(\\text{blank})}$ is the mean of the blank absorbance readings. The use of the $N-1$ term in the denominator (Bessel's correction) provides an unbiased estimate of the true population variance. This calculation is only valid for $N \\ge 2$. All test cases provided satisfy this condition.\n\nStep $3$: Calculation of the Limit of Detection (LOD)\n\nThe limit of detection is operationally defined as the lowest concentration of a substance that can be reliably distinguished from the absence of that substance (a blank). A common convention, specified in the problem, defines the signal at the LOD to be three times the standard deviation of the blank noise above the mean blank signal. By inverting the calibration equation ($A = mc + \\text{b}$), we find the concentration corresponding to a given absorbance. The LOD is the concentration that produces a signal equal to $3\\sigma$ above the baseline. Thus, we calculate it using the slope $m$ from the calibration curve:\n$$\\text{LOD} = \\frac{3\\sigma}{m}$$\nThe units of $\\sigma$ are absorbance units (unitless), and the units of $m$ are $\\mathrm{Absorbance \\cdot L \\cdot mol^{-1}}$ (effectively $\\mathrm{L \\cdot mol^{-1}}$). Therefore, the resulting LOD has units of $\\mathrm{mol \\cdot L^{-1}}$.\n\nStep $4$: Unit Conversion and Formatting\n\nThe final step is to convert the LOD from units of moles per liter ($\\mathrm{mol \\cdot L^{-1}}$) to micromoles per liter ($\\mu\\mathrm{M}$). This is achieved by multiplying the result by a factor of $10^6$:\n$$\\text{LOD}_{(\\mu\\mathrm{M})} = \\text{LOD}_{(\\mathrm{mol \\cdot L^{-1}})} \\times 10^6 \\, \\frac{\\mu\\mathrm{mol}}{\\mathrm{mol}}$$\nThe final numerical value is then rounded to six decimal places as required.\n\nThis complete, four-step process will be implemented for each test case provided in the problem statement. Special cases, such as the one with zero variance in the blank measurements (Test Case $4$), will be handled correctly by these formulas, yielding a $\\sigma$ of $0$ and consequently an LOD of $0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the UV-Vis calibration and limit of detection problem for a predefined test suite.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"concentrations\": [2.0e-6, 4.0e-6, 6.0e-6, 8.0e-6],\n            \"absorbance_replicates\": [\n                [0.0410, 0.0392, 0.0405],\n                [0.0812, 0.0791, 0.0806],\n                [0.1215, 0.1190, 0.1204],\n                [0.1610, 0.1588, 0.1603]\n            ],\n            \"blank_replicates\": [0.0012, 0.0008, 0.0015, 0.0005, 0.0010, 0.0011, 0.0009, 0.0013, 0.0007, 0.0014]\n        },\n        {\n            \"concentrations\": [5.0e-6, 1.0e-5, 1.5e-5, 2.0e-5],\n            \"absorbance_replicates\": [\n                [0.0076, 0.0072],\n                [0.0154, 0.0146],\n                [0.0228, 0.0223],\n                [0.0305, 0.0293]\n            ],\n            \"blank_replicates\": [0.0003, 0.0011, 0.0009, 0.0015, 0.0007, 0.0012, 0.0006, 0.0010]\n        },\n        {\n            \"concentrations\": [0.5e-6, 1.0e-6, 1.5e-6, 2.0e-6, 3.0e-6],\n            \"absorbance_replicates\": [\n                [0.0106, 0.0102],\n                [0.0155, 0.0150],\n                [0.0204, 0.0201],\n                [0.0252, 0.0248],\n                [0.0356, 0.0349]\n            ],\n            \"blank_replicates\": [0.0051, 0.0048, 0.0053, 0.0049, 0.0050, 0.0052, 0.0047, 0.0054]\n        },\n        {\n            \"concentrations\": [1.0e-6, 2.0e-6],\n            \"absorbance_replicates\": [\n                [0.0200],\n                [0.0400]\n            ],\n            \"blank_replicates\": [0.0009, 0.0009, 0.0009, 0.0009]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Step 1: Construct regression dataset and perform OLS\n        \n        # Unpack data into flat lists for regression\n        concentrations_flat = []\n        absorbances_flat = []\n        for i, c in enumerate(case[\"concentrations\"]):\n            for a in case[\"absorbance_replicates\"][i]:\n                concentrations_flat.append(c)\n                absorbances_flat.append(a)\n\n        c_reg = np.array(concentrations_flat)\n        A_reg = np.array(absorbances_flat)\n        n = len(c_reg)\n\n        # Calculate OLS slope 'm' using the direct formula\n        # m = (n * sum(xy) - sum(x)*sum(y)) / (n * sum(x^2) - (sum(x))^2)\n        sum_c = np.sum(c_reg)\n        sum_A = np.sum(A_reg)\n        sum_cA = np.sum(c_reg * A_reg)\n        sum_c_sq = np.sum(c_reg**2)\n        \n        numerator = n * sum_cA - sum_c * sum_A\n        denominator = n * sum_c_sq - sum_c**2\n        \n        # Handle case where denominator is zero (all concentrations are the same)\n        if denominator == 0:\n            # This case is not in the test suite, but it's a pathological condition.\n            # LOD would be infinite if noise > 0, or undefined otherwise.\n            # We can represent it as NaN or handle it as an error. For this problem, we assume valid inputs.\n            m = np.nan\n        else:\n            m = numerator / denominator\n\n        # Step 2: Estimate blank noise standard deviation (sigma)\n        # Use ddof=1 for the unbiased sample standard deviation\n        sigma = np.std(case[\"blank_replicates\"], ddof=1)\n\n        # Step 3: Compute the limit of detection (LOD)\n        # LOD = 3 * sigma / m\n        if m == 0:\n            # If slope is zero, LOD is infinite for non-zero noise, and zero/undetermined for zero noise.\n            # The test cases do not result in a slope of zero.\n            lod_mol_L = np.inf if sigma > 0 else 0.0\n        else:\n            lod_mol_L = (3 * sigma) / m\n\n        # Step 4: Convert LOD to micromoles per liter (uM)\n        lod_uM = lod_mol_L * 1e6\n        \n        # Append the result, which will be formatted later\n        results.append(lod_uM)\n\n    # Final print statement in the exact required format.\n    # Use format specifier \"f\" to ensure 6 decimal places, even with trailing zeros.\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Spectroscopy is a powerful tool not only for quantifying stable species but also for studying dynamic chemical systems. This advanced practice demonstrates how to use absorbance measurements to probe an acid-base equilibrium and determine a fundamental physicochemical constant, the acid dissociation constant ($\\mathrm{p}K_a$) . You will derive the mathematical model that describes how a solution's absorbance changes with $\\mathrm{pH}$ and then apply non-linear regression techniques to fit this model to data, a widely used method in physical and analytical chemistry.",
            "id": "3719603",
            "problem": "A phenolic dye in water exhibits an acid-base equilibrium between its protonated form and its deprotonated form, both of which absorb light in the ultraviolet-visible region. The task is to design an experiment using Ultraviolet-Visible spectroscopy (UV-Vis) to determine the acid dissociation constant expressed as $\\mathrm{p}K_a$, and to compute $\\mathrm{p}K_a$ from measured absorbance versus acidity ($\\mathrm{pH}$) data by deriving a physically grounded model from first principles and fitting it to data.\n\nYou must start the derivation from fundamental and well-tested bases appropriate to spectrometric identification of organic compounds: the definition of absorbance and the Beer–Lambert law, the mass action law for acid-base equilibrium of a monoprotic acid, and the definition of acidity $\\mathrm{pH}$ and $\\mathrm{p}K_a$. You must not use or assume any target formulas beyond these bases. In particular, begin from: absorbance additivity for independently absorbing species, proportionality of absorbance to concentration and molar absorptivity, and the ratio of conjugate-base to acid concentrations defined by the mass action law. From these starting points, derive the dependence of absorbance on $\\mathrm{pH}$ for a fixed total dye concentration and a fixed optical path length. Then describe an experiment that would produce the absorbance versus $\\mathrm{pH}$ data required by your derived model and specify quantitatively the considerations needed to ensure scientific validity, including dye concentration range, optical path length, buffer selection and $\\mathrm{pH}$ span, ionic strength control, wavelength selection, and data quality checks. Finally, implement an algorithm that estimates $\\mathrm{p}K_a$ by fitting your model to given absorbance versus $\\mathrm{pH}$ data.\n\nYour program must implement the following algorithmic tasks:\n- Derive from the specified principles a model linking absorbance $A$ measured at wavelength $\\lambda$ to $\\mathrm{pH}$ for a two-state acid-base equilibrium of a monoprotic phenolic dye with fixed total concentration $c_T$ and optical path length $l$; the model must explicitly account for the acid and base forms’ molar absorptivities at wavelength $\\lambda$ and the equilibrium fractions dictated by the mass action law.\n- For data measured at a single wavelength, fit the model parameters to absorbance versus $\\mathrm{pH}$ data to estimate $\\mathrm{p}K_a$ while also allowing the molar absorptivities of the acid and base forms at that wavelength to be unknowns.\n- For data measured at multiple wavelengths, perform a global fit that uses a single $\\mathrm{p}K_a$ across wavelengths while allowing wavelength-specific molar absorptivities for the acid and base forms, and estimate the global $\\mathrm{p}K_a$.\n- Use nonlinear least squares with physically sensible bounds, choose reasonable initial guesses from the data, and produce numerically stable estimates.\n\nAll answers in this problem that involve physical quantities must be expressed with appropriate units; for example, optical path length must be in $\\mathrm{cm}$, concentration in $\\mathrm{M}$, wavelength in $\\mathrm{nm}$, and absorbance is unitless. The final numerical outputs must be the estimated $\\mathrm{p}K_a$ values for each test case, expressed as unitless floats rounded to three decimal places. There are no angle measurements in this problem. No percentages are required.\n\nTest suite specification:\n- Test case $1$ (single wavelength, well-separated absorptivities):\n  - Optical path length $l = 1.000 \\ \\mathrm{cm}$.\n  - Total dye concentration $c_T = 2.5 \\times 10^{-5} \\ \\mathrm{M}$.\n  - True $\\mathrm{p}K_a = 8.55$.\n  - Wavelength $\\lambda = 525 \\ \\mathrm{nm}$.\n  - Acid-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{HA}} = 18000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - Base-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{A^-}} = 6000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - $\\mathrm{pH}$ values: from $6.50$ to $10.50$ in increments of $0.25$.\n  - Add independent Gaussian noise to absorbance with standard deviation $\\sigma = 0.002$ (unitless), using random seed $12345$.\n- Test case $2$ (single wavelength, nearly equal absorptivities):\n  - Optical path length $l = 1.000 \\ \\mathrm{cm}$.\n  - Total dye concentration $c_T = 1.5 \\times 10^{-5} \\ \\mathrm{M}$.\n  - True $\\mathrm{p}K_a = 7.20$.\n  - Wavelength $\\lambda = 510 \\ \\mathrm{nm}$.\n  - Acid-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{HA}} = 12000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - Base-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{A^-}} = 11000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - $\\mathrm{pH}$ values: from $6.00$ to $9.00$ in increments of $0.30$.\n  - Add independent Gaussian noise to absorbance with standard deviation $\\sigma = 0.0015$, using random seed $54321$.\n- Test case $3$ (single wavelength, $\\mathrm{p}K_a$ near lower boundary of $\\mathrm{pH}$ span):\n  - Optical path length $l = 1.000 \\ \\mathrm{cm}$.\n  - Total dye concentration $c_T = 1.0 \\times 10^{-5} \\ \\mathrm{M}$.\n  - True $\\mathrm{p}K_a = 6.10$.\n  - Wavelength $\\lambda = 500 \\ \\mathrm{nm}$.\n  - Acid-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{HA}} = 14000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - Base-form molar absorptivity at $\\lambda$: $\\varepsilon_{\\mathrm{A^-}} = 4000 \\ \\mathrm{M^{-1} \\ cm^{-1}}$.\n  - $\\mathrm{pH}$ values: from $5.80$ to $8.80$ in increments of $0.25$.\n  - Add independent Gaussian noise to absorbance with standard deviation $\\sigma = 0.002$, using random seed $202310$.\n- Test case $4$ (multi-wavelength global fit):\n  - Optical path length $l = 1.000 \\ \\mathrm{cm}$.\n  - Total dye concentration $c_T = 2.0 \\times 10^{-5} \\ \\mathrm{M}$.\n  - True $\\mathrm{p}K_a = 8.00$.\n  - Wavelengths $\\lambda \\in \\{480, 520, 560\\} \\ \\mathrm{nm}$.\n  - Acid-form molar absorptivities: $\\varepsilon_{\\mathrm{HA}}(480) = 8000$, $\\varepsilon_{\\mathrm{HA}}(520) = 15000$, $\\varepsilon_{\\mathrm{HA}}(560) = 10000$ in $\\mathrm{M^{-1} \\ cm^{-1}}$.\n  - Base-form molar absorptivities: $\\varepsilon_{\\mathrm{A^-}}(480) = 20000$, $\\varepsilon_{\\mathrm{A^-}}(520) = 5000$, $\\varepsilon_{\\mathrm{A^-}}(560) = 8000$ in $\\mathrm{M^{-1} \\ cm^{-1}}$.\n  - $\\mathrm{pH}$ values: from $6.00$ to $10.50$ in increments of $0.50$.\n  - Add independent Gaussian noise to absorbance with standard deviation $\\sigma = 0.002$, using random seed $777$.\n\nYour program must:\n- Construct the synthetic absorbance data for each test case using the specified true parameters and noise characteristics.\n- Fit the derived model to each test case to estimate $\\mathrm{p}K_a$.\n- Produce a single line of output containing the estimated $\\mathrm{p}K_a$ values for test cases $1$ through $4$, in order, as a comma-separated list enclosed in square brackets, rounded to three decimal places (for example, $[\\mathrm{p}K_{a,1},\\mathrm{p}K_{a,2},\\mathrm{p}K_{a,3},\\mathrm{p}K_{a,4}]$). The numerical values are unitless.",
            "solution": "The problem requires the derivation of a model for the absorbance of a phenolic dye as a function of $\\mathrm{pH}$, a description of an experimental design to acquire the necessary data, and the implementation of a numerical algorithm to estimate the dye's acid dissociation constant, $\\mathrm{p}K_a$, from synthetic data.\n\n### 1. Derivation of the Absorbance-pH Model from First Principles\n\nWe begin from the fundamental principles stipulated: the Beer-Lambert law, the mass action law for acid-base equilibrium, and the definitions of $\\mathrm{pH}$ and $\\mathrm{p}K_a$.\n\nA monoprotic phenolic dye, represented as $\\mathrm{HA}$, undergoes an acid-base equilibrium in an aqueous solution:\n$$\n\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^+ + \\mathrm{A}^-\n$$\nwhere $\\mathrm{HA}$ is the protonated (acid) form and $\\mathrm{A}^-$ is the deprotonated (conjugate base) form.\n\n**1.1. Acid-Base Equilibrium:**\nThe acid dissociation constant, $K_a$, is defined by the law of mass action for this equilibrium:\n$$\nK_a = \\frac{[\\mathrm{H}^+][\\mathrm{A}^-]}{[\\mathrm{HA}]}\n$$\nwhere $[\\cdot]$ denotes molar concentration. The quantities $\\mathrm{p}K_a$ and $\\mathrm{pH}$ are defined as:\n$$\n\\mathrm{p}K_a = -\\log_{10}(K_a)\n$$\n$$\n\\mathrm{pH} = -\\log_{10}([\\mathrm{H}^+])\n$$\nRearranging the $K_a$ expression and taking the negative base-10 logarithm yields the Henderson-Hasselbalch equation:\n$$\n\\mathrm{pH} = \\mathrm{p}K_a + \\log_{10}\\left(\\frac{[\\mathrm{A}^-]}{[\\mathrm{HA}]}\\right)\n$$\nThis equation relates the ratio of the concentrations of the base and acid forms to the $\\mathrm{pH}$ and $\\mathrm{p}K_a$. From this, we can express the concentration ratio as:\n$$\n\\frac{[\\mathrm{A}^-]}{[\\mathrm{HA}]} = 10^{\\mathrm{pH} - \\mathrm{p}K_a}\n$$\n\n**1.2. Mass Balance:**\nFor a fixed total concentration of the dye, $c_T$, the mass balance equation is:\n$$\nc_T = [\\mathrm{HA}] + [\\mathrm{A}^-]\n$$\n\n**1.3. Species Concentrations as a Function of pH:**\nWe can now express the concentrations of $\\mathrm{HA}$ and $\\mathrm{A}^-$ as functions of $c_T$, $\\mathrm{pH}$, and $\\mathrm{p}K_a$. From the ratio expression, we have $[\\mathrm{A}^-] = [\\mathrm{HA}] \\cdot 10^{\\mathrm{pH} - \\mathrm{p}K_a}$. Substituting this into the mass balance equation:\n$$\nc_T = [\\mathrm{HA}] + [\\mathrm{HA}] \\cdot 10^{\\mathrm{pH} - \\mathrm{p}K_a} = [\\mathrm{HA}]\\left(1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}\\right)\n$$\nSolving for $[\\mathrm{HA}]$:\n$$\n[\\mathrm{HA}] = \\frac{c_T}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}}\n$$\nAnd consequently for $[\\mathrm{A}^-]$:\n$$\n[\\mathrm{A}^-] = c_T - [\\mathrm{HA}] = c_T - \\frac{c_T}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}} = \\frac{c_T \\cdot \\left(1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}\\right) - c_T}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}} = \\frac{c_T \\cdot 10^{\\mathrm{pH} - \\mathrm{p}K_a}}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}}\n$$\n\n**1.4. Application of Beer-Lambert Law:**\nThe Beer-Lambert law states that absorbance, $A$, is proportional to the concentration of the absorbing species and the optical path length, $l$. For a mixture of independently absorbing species, the total absorbance at a given wavelength, $\\lambda$, is the sum of the individual absorbances:\n$$\nA(\\lambda) = A_{\\mathrm{HA}}(\\lambda) + A_{\\mathrm{A}^-}(\\lambda)\n$$\nwhere $A_{\\mathrm{HA}}$ and $A_{\\mathrm{A}^-}$ are the absorbances of the acid and base forms, respectively. Applying the Beer-Lambert law to each species:\n$$\nA(\\lambda) = \\varepsilon_{\\mathrm{HA}}(\\lambda)[\\mathrm{HA}]l + \\varepsilon_{\\mathrm{A}^-}(\\lambda)[\\mathrm{A}^-]l\n$$\nHere, $\\varepsilon_{\\mathrm{HA}}(\\lambda)$ and $\\varepsilon_{\\mathrm{A}^-}(\\lambda)$ are the molar absorptivities (in $\\mathrm{M^{-1} cm^{-1}}$) of the acid and base forms at wavelength $\\lambda$, and $l$ is the path length (in $\\mathrm{cm}$).\n\n**1.5. Final Model:**\nSubstituting the expressions for $[\\mathrm{HA}]$ and $[\\mathrm{A}^-]$ into the absorbance equation gives the final model relating total absorbance to $\\mathrm{pH}$:\n$$\nA(\\mathrm{pH}, \\lambda) = l \\left( \\varepsilon_{\\mathrm{HA}}(\\lambda)\\frac{c_T}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}} + \\varepsilon_{\\mathrm{A}^-}(\\lambda)\\frac{c_T \\cdot 10^{\\mathrm{pH} - \\mathrm{p}K_a}}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}} \\right)\n$$\nThis equation can be simplified by factoring out common terms:\n$$\nA(\\mathrm{pH}, \\lambda) = l c_T \\left( \\frac{\\varepsilon_{\\mathrm{HA}}(\\lambda) + \\varepsilon_{\\mathrm{A}^-}(\\lambda) \\cdot 10^{\\mathrm{pH} - \\mathrm{p}K_a}}{1 + 10^{\\mathrm{pH} - \\mathrm{p}K_a}} \\right)\n$$\nThis sigmoidal model describes the absorbance at a specific wavelength $\\lambda$ as a function of $\\mathrm{pH}$. The parameters that can be determined by fitting this model to experimental data are the $\\mathrm{p}K_a$ of the dye and the molar absorptivities of its two forms, $\\varepsilon_{\\mathrm{HA}}(\\lambda)$ and $\\varepsilon_{\\mathrm{A}^-}(\\lambda)$.\n\n### 2. Experimental Design\n\nTo acquire the data needed to fit this model, a carefully designed UV-Vis spectrophotometric titration experiment must be performed.\n\n1.  **Dye Concentration ($c_T$)**: The total dye concentration $c_T$ must be chosen to ensure that absorbance values, $A$, lie within the spectrophotometer's linear dynamic range (typically $A \\in [0.1, 1.5]$). Given typical molar absorptivities for dyes ($\\varepsilon \\approx 10^4 - 10^5 \\ \\mathrm{M^{-1} cm^{-1}}$) and a standard path length of $l = 1.000 \\ \\mathrm{cm}$, a concentration in the range of $c_T = 10^{-5} \\ \\mathrm{M}$ to $10^{-4} \\ \\mathrm{M}$ is appropriate. A single stock solution of the dye should be used to prepare all samples to ensure $c_T$ is constant.\n\n2.  **Buffer System and pH Span**: A series of buffer solutions must be prepared to precisely control the $\\mathrm{pH}$ of the dye solutions. The buffers must be transparent in the wavelength range of interest. The $\\mathrm{pH}$ of each solution must be measured accurately with a calibrated $\\mathrm{pH}$ meter. The pH range should span at least $\\mathrm{p}K_a \\pm 2$ units (e.g., from $\\mathrm{pH} = 6$ to $\\mathrm{pH} = 11$ for a phenol with an expected $\\mathrm{p}K_a \\approx 8.5$) to observe the absorbance plateaus corresponding to the nearly pure acid ($\\mathrm{pH} \\ll \\mathrm{p}K_a$) and base ($\\mathrm{pH} \\gg \\mathrm{p}K_a$) forms.\n\n3.  **Ionic Strength Control**: The thermodynamic acid dissociation constant, $K_a$, is defined in terms of activities, not concentrations. The relationship between them is influenced by the ionic strength of the solution. To determine a consistent apparent $\\mathrm{p}K_a$, the ionic strength should be maintained constant across all samples by adding a high concentration (e.g., $0.1 \\ \\mathrm{M}$) of an inert salt like $\\mathrm{KCl}$ or $\\mathrm{NaCl}$.\n\n4.  **Wavelength Selection**: Measurements should be performed at one or more wavelengths. An optimal wavelength for determining $\\mathrm{p}K_a$ is one where the difference in molar absorptivity between the acid and base forms, $|\\varepsilon_{\\mathrm{HA}} - \\varepsilon_{\\mathrm{A}^-}|$, is maximal. This maximizes the change in absorbance during the titration, improving the signal-to-noise ratio of the fit. Collecting data at multiple wavelengths and performing a global fit, where $\\mathrm{p}K_a$ is a shared parameter, yields a more robust and reliable estimate. A measurement at an isosbestic point (where $\\varepsilon_{\\mathrm{HA}} = \\varepsilon_{\\mathrm{A}^-}$) is a useful diagnostic, as absorbance should remain constant with $\\mathrm{pH}$ if the system is a simple two-state equilibrium.\n\n5.  **Spectrophotometer and Data Acquisition**: A dual-beam spectrophotometer is preferred for stability. For each $\\mathrm{pH}$ measurement, a reference cuvette containing the buffer solution (without the dye) at the same pH should be used to correct for any background absorbance or scattering. Temperature must be controlled and kept constant, as $K_a$ is temperature-dependent.\n\n### 3. Algorithmic Implementation\n\nThe estimation of $\\mathrm{p}K_a$ and molar absorptivities is a nonlinear least-squares fitting problem.\n\n-   **Model Function**: The derived equation $A(\\mathrm{pH}, \\lambda)$ is the model to be fitted to the experimental data $(A_i, \\mathrm{pH}_i)$. For a single wavelength, the parameters to be fitted are $(\\mathrm{p}K_a, \\varepsilon_{\\mathrm{HA}}, \\varepsilon_{\\mathrm{A}^-})$. The values of $l$ and $c_T$ are known constants.\n\n-   **Nonlinear Least Squares**: An algorithm such as Levenberg-Marquardt, available in `scipy.optimize.curve_fit`, is suitable for this task. It minimizes the sum of the squares of the residuals, $SS_{res} = \\sum_i (A_{i,obs} - A_{i,model})^2$.\n\n-   **Initial Guesses**: The convergence and correctness of the fit depend on providing reasonable initial parameter estimates ($p_0$):\n    -   $\\varepsilon_{\\mathrm{HA}}$: Can be estimated from the absorbance plateau at low $\\mathrm{pH}$, $A_{acid} \\approx \\varepsilon_{\\mathrm{HA}} l c_T$.\n    -   $\\varepsilon_{\\mathrm{A}^-}$: Can be estimated from the absorbance plateau at high $\\mathrm{pH}$, $A_{base} \\approx \\varepsilon_{\\mathrm{A}^-} l c_T$.\n    -   $\\mathrm{p}K_a$: Can be estimated as the $\\mathrm{pH}$ at which the absorbance is the average of the two plateaus, $A = (A_{acid} + A_{base})/2$.\n\n-   **Parameter Bounds**: To ensure physical realism, bounds should be enforced on the parameters during the fit. Molar absorptivities must be non-negative: $\\varepsilon_{\\mathrm{HA}} \\ge 0$ and $\\varepsilon_{\\mathrm{A}^-} \\ge 0$. The $\\mathrm{p}K_a$ can be bounded to lie within a plausible range, such as the experimental $\\mathrm{pH}$ span.\n\n-   **Global Fitting (Multi-wavelength)**: For data collected at multiple wavelengths ($\\lambda_1, \\lambda_2, \\ldots$), a global fit is performed. All data sets are fitted simultaneously. The $\\mathrm{p}K_a$ is a single global parameter, common to all datasets. Each wavelength $\\lambda_j$ has its own pair of molar absorptivities, $(\\varepsilon_{\\mathrm{HA}}(\\lambda_j), \\varepsilon_{\\mathrm{A}^-}(\\lambda_j))$. This increases the total number of parameters to $1 + 2N_{\\lambda}$ (where $N_{\\lambda}$ is the number of wavelengths), but the increased data redundancy leads to a more robust $\\mathrm{p}K_a$ estimate. The implementation requires structuring the input data and the model function to handle multiple parameter sets tied to a common parameter.\n\nThe provided Python code implements this algorithm, generating synthetic data for the specified test cases and then applying the fitting procedure to estimate $\\mathrm{p}K_a$. For both single- and multi-wavelength cases, a unified fitting function is used that treats the single-wavelength problem as a global fit with $N_{\\lambda}=1$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves for the pKa of a phenolic dye from simulated UV-Vis data\n    for four different test cases, including single and multi-wavelength fits.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1 (single wavelength, well-separated absorptivities)\n        {\n            \"l\": 1.000,  # cm\n            \"c_T\": 2.5e-5,  # M\n            \"true_pKa\": 8.55,\n            \"wavelengths\": [525],  # nm\n            \"eps_HA\": [18000],  # M^-1 cm^-1\n            \"eps_A\": [6000],   # M^-1 cm^-1\n            \"ph_range\": (6.50, 10.50),\n            \"ph_step\": 0.25,\n            \"noise_sigma\": 0.002,\n            \"seed\": 12345,\n        },\n        # Test case 2 (single wavelength, nearly equal absorptivities)\n        {\n            \"l\": 1.000,\n            \"c_T\": 1.5e-5,\n            \"true_pKa\": 7.20,\n            \"wavelengths\": [510],\n            \"eps_HA\": [12000],\n            \"eps_A\": [11000],\n            \"ph_range\": (6.00, 9.00),\n            \"ph_step\": 0.30,\n            \"noise_sigma\": 0.0015,\n            \"seed\": 54321,\n        },\n        # Test case 3 (single wavelength, pKa near lower boundary of pH span)\n        {\n            \"l\": 1.000,\n            \"c_T\": 1.0e-5,\n            \"true_pKa\": 6.10,\n            \"wavelengths\": [500],\n            \"eps_HA\": [14000],\n            \"eps_A\": [4000],\n            \"ph_range\": (5.80, 8.80),\n            \"ph_step\": 0.25,\n            \"noise_sigma\": 0.002,\n            \"seed\": 202310,\n        },\n        # Test case 4 (multi-wavelength global fit)\n        {\n            \"l\": 1.000,\n            \"c_T\": 2.0e-5,\n            \"true_pKa\": 8.00,\n            \"wavelengths\": [480, 520, 560],\n            \"eps_HA\": [8000, 15000, 10000],\n            \"eps_A\": [20000, 5000, 8000],\n            \"ph_range\": (6.00, 10.50),\n            \"ph_step\": 0.50,\n            \"noise_sigma\": 0.002,\n            \"seed\": 777,\n        },\n    ]\n\n    estimated_pKas = []\n\n    for case in test_cases:\n        l = case[\"l\"]\n        c_T = case[\"c_T\"]\n        wavelengths = case[\"wavelengths\"]\n        num_wls = len(wavelengths)\n        eps_HA_true = np.array(case[\"eps_HA\"])\n        eps_A_true = np.array(case[\"eps_A\"])\n        \n        # pH vector\n        ph_values = np.arange(case[\"ph_range\"][0], case[\"ph_range\"][1] + case[\"ph_step\"] / 2.0, case[\"ph_step\"])\n        num_phs = len(ph_values)\n        \n        # Prepare data structured for global fitting\n        # Independent variables: a (2, N) array of [pH, wavelength_index]\n        ph_fit = np.tile(ph_values, num_wls)\n        wl_idx_fit = np.repeat(np.arange(num_wls), num_phs)\n        x_data = np.vstack((ph_fit, wl_idx_fit))\n\n        # Generate absorbance data\n        rng = np.random.default_rng(case[\"seed\"])\n        y_data_true = np.zeros(num_phs * num_wls)\n\n        for i in range(num_wls):\n            start, end = i * num_phs, (i + 1) * num_phs\n            term = 10**(ph_values - case[\"true_pKa\"])\n            y_data_true[start:end] = l * c_T * (eps_HA_true[i] + eps_A_true[i] * term) / (1 + term)\n\n        y_data_noisy = y_data_true + rng.normal(0, case[\"noise_sigma\"], size=y_data_true.shape)\n\n        # Unified model function for both single- and multi-wavelength fitting\n        def model_global(x, pKa, *eps_all):\n            ph, wl_indices = x[0], x[1].astype(int)\n            \n            eps_HA_params = np.array(eps_all[0::2])\n            eps_A_params = np.array(eps_all[1::2])\n\n            eps_HA = eps_HA_params[wl_indices]\n            eps_A = eps_A_params[wl_indices]\n            \n            term = 10**(ph - pKa)\n            absorbance = l * c_T * (eps_HA + eps_A * term) / (1 + term)\n            return absorbance\n\n        # Initial guesses\n        p0 = []\n        bounds_lower = []\n        bounds_upper = []\n\n        # Guess pKa from wavelength with largest absorbance change\n        abs_diffs = []\n        for i in range(num_wls):\n            start, end = i * num_phs, (i + 1) * num_phs\n            wl_data = y_data_noisy[start:end]\n            abs_diffs.append(np.abs(wl_data[-1] - wl_data[0]))\n        \n        best_wl_idx = np.argmax(abs_diffs)\n        start, end = best_wl_idx * num_phs, (best_wl_idx + 1) * num_phs\n        best_wl_data = y_data_noisy[start:end]\n        \n        A_min_obs = best_wl_data[0]\n        A_max_obs = best_wl_data[-1]\n\n        # The absorbance might increase or decrease with pH\n        if A_min_obs > A_max_obs:\n            A_min_obs, A_max_obs = A_max_obs, A_min_obs\n\n        A_mid = (A_min_obs + A_max_obs) / 2.0\n        pKa_guess_idx = np.argmin(np.abs(best_wl_data - A_mid))\n        pKa_guess = ph_values[pKa_guess_idx]\n        \n        p0.append(pKa_guess)\n        bounds_lower.append(case[\"ph_range\"][0] - 1.0)\n        bounds_upper.append(case[\"ph_range\"][1] + 1.0)\n        \n        # Guess epsilons for each wavelength\n        for i in range(num_wls):\n            start, end = i * num_phs, (i + 1) * num_phs\n            wl_data = y_data_noisy[start:end]\n            A_acid_guess = wl_data[0]\n            A_base_guess = wl_data[-1]\n\n            eps_HA_guess = A_acid_guess / (l * c_T)\n            eps_A_guess = A_base_guess / (l * c_T)\n\n            p0.extend([eps_HA_guess, eps_A_guess])\n            bounds_lower.extend([0, 0])\n            bounds_upper.extend([np.inf, np.inf])\n\n        # Perform the fit\n        try:\n            params, _ = curve_fit(\n                model_global,\n                x_data,\n                y_data_noisy,\n                p0=p0,\n                bounds=(bounds_lower, bounds_upper)\n            )\n            estimated_pKa = params[0]\n        except RuntimeError:\n            # Fallback if fit fails\n            estimated_pKa = np.nan\n            \n        estimated_pKas.append(estimated_pKa)\n\n    # Format the final output\n    formatted_results = [f\"{pKa:.3f}\" for pKa in estimated_pKas]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}