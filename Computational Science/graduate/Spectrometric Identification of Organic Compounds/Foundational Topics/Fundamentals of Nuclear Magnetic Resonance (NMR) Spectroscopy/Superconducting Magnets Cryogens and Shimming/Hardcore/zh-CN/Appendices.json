{
    "hands_on_practices": [
        {
            "introduction": "超导磁体在持久模式下运行时，其磁场并非绝对恒定，而是会由于一种称为“磁通蠕动”的量子现象而缓慢衰减。本练习旨在将超导体的微观物理原理与核磁共振波谱仪的宏观性能表现联系起来。通过推导磁场漂移的对数模型并将其与实验数据进行拟合，您将掌握物理建模和定量分析的技能，从而学会预测磁体的长期稳定性 ()。",
            "id": "3726334",
            "problem": "用于有机化合物核磁共振（NMR）光谱鉴定的超导磁体在持续模式下运行，并由液氦（LHe）冷却，使用液氮（LN2）作为辐射屏蔽。在持续模式下，由于量子化涡旋（磁通蠕变）跨越钉扎位点的热激活运动，磁体孔内的磁场会缓慢变化。场漂移会影响谱仪的频率锁定以及用于化学位移定标和匀场的质子共振的长期稳定性。\n\n从以下经过充分检验的物理基础和核心定义出发：\n- 磁感应强度与磁体绕组中的输运电流成正比，即 $B \\propto I$。在一个长而均匀的螺线管中，$B = \\mu_0 n I$，其中 $\\mu_0$ 是自由空间磁导率，n 是匝数密度，但对于推导而言，比例关系就足够了。\n- 磁通蠕变是热激活的涡旋运动。在一个具有 Anderson–Kim 势垒的钉扎涡旋晶格中，激活能与电流密度的关系为 $U(J) = U_0 \\left(1 - \\frac{J}{J_c}\\right)$，其中 $U_0$ 是特征钉扎能，$J_c$ 是临界电流密度。\n- 蠕变速率遵循阿伦尼乌斯定律：$v \\propto \\exp\\!\\left[-\\frac{U(J)}{k_{\\mathrm{B}} T}\\right]$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度。\n- 由涡旋运动产生的电场为 $E \\sim B v$；输运电流的宏观衰减由 $dJ/dt$ 控制，该衰减通过 $U(J)$ 继承了阿伦尼乌斯因子。\n- 在静磁场 $B$ 中，原子核的共振频率 $f$ 由 $f = \\left(\\frac{\\gamma}{2\\pi}\\right) B$ 给出，其中 $\\gamma$ 是旋磁比。对于质子，$\\left(\\frac{\\gamma_H}{2\\pi}\\right) = 42.57747892 \\times 10^6 \\ \\mathrm{Hz/T}$；对于氘，$\\left(\\frac{\\gamma_D}{2\\pi}\\right) = 6.535902 \\times 10^6 \\ \\mathrm{Hz/T}$。\n\n任务：\n1. 基于上述基础，推导在具有 Anderson–Kim 势垒 $U(J)$ 的热激活磁通蠕变条件下，$B(t)$ 对经过时间 $t$ 的预期函数依赖关系，并明确指出定义初始条件的参考时间 $t_0$ 的作用。证明该依赖关系是关于 $t/t_0$ 的对数关系，并确定需要从数据中估计的自由参数，而无需在问题陈述中写出最终的目标公式。\n2. 给定在时间 $t_i$（秒）测得的氘锁场频率 $f_D(t_i)$，使用 $B = \\frac{f_D}{\\gamma_D/2\\pi}$ 将其转换为磁场孔径内的磁场值 $B(t_i)$（单位为 T），并选择 $t_0 = t_{\\min}$（第一次测量时间）通过最小二乘法拟合对数时间漂移模型。从拟合结果中，提取一个量化漂移的振幅参数和参考时间点的磁场值。使用这些参数预测在未来时间 $t_{\\mathrm{future}} = t_{\\mathrm{last}} + 43200$（即在最后一次测量的基础上增加12小时）的质子共振频率 $f_H$（单位为 Hz）。\n3. 使用预测结果，根据标准 $\\left| \\Delta f_H \\right|  10.0 \\ \\mathrm{Hz}$，将磁体在未来12小时内的频率稳定性分类为稳定或不稳定，其中 $\\Delta f_H$ 是在 $t_{\\mathrm{last}}$ 和 $t_{\\mathrm{future}}$ 之间质子频率的预测变化量。\n4. 实现一个程序，对每个测试用例执行转换、拟合和预测，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。每个结果必须是一个包含三个元素的列表：拟合的漂移振幅（单位 T）、在 $t_{\\mathrm{future}}$ 时的预测质子频率（单位 Hz）以及一个表示稳定性的布尔值。因此，输出必须具有以下形式：$[ [\\text{amp}_1,\\text{fH}_1,\\text{stable}_1], [\\text{amp}_2,\\text{fH}_2,\\text{stable}_2], \\dots ]$。\n\n使用以下测量的氘锁场数据测试套件（频率单位 Hz，时间单位 s）。每个案例代表一个不同的磁体和操作条件：\n- 案例 A（标称 $14.1 \\ \\mathrm{T}$ 级磁体，典型漂移）：时间 $[300, 900, 3600, 14400, 21600]$，对应的 $f_D$ 值为 $[92156218.2, 92156216.2, 92156213.7, 92156211.2, 92156210.5]$。\n- 案例 B（标称 $9.4 \\ \\mathrm{T}$ 级磁体，近乎平坦的漂移）：时间 $[60, 120, 300, 1800, 10800]$，对应的 $f_D$ 值为 $[61437478.8, 61437478.7, 61437478.5, 61437478.1, 61437477.8]$。\n- 案例 C（标称 $18.8 \\ \\mathrm{T}$ 级磁体，较大漂移）：时间 $[600, 1800, 7200, 43200]$，对应的 $f_D$ 值为 $[122874957.6, 122874954.0, 122874949.5, 122874943.6]$。\n\n角度单位不适用。所有输出都必须以指定的物理单位提供。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[ [0.000001,600000000.0,True], [\\dots], [\\dots] ]$）。",
            "solution": "用户提供了一个问题，要求对超导核磁共振（NMR）磁体中的磁场漂移进行定量分析。解决该问题需要首先推导漂移的理论模型，然后应用该模型拟合实验数据，最后使用拟合模型进行预测和稳定性分类。\n\n### 问题验证\n该问题已根据既定标准进行了验证。\n\n1.  **已知条件提取**：所有物理原理、常数（$\\gamma_H/2\\pi$、$\\gamma_D/2\\pi$）、任务定义、稳定性标准（$|\\Delta f_H|  10.0 \\ \\mathrm{Hz}$）和测试数据集均已逐字提取。\n2.  **验证检查**：该问题在超导物理学（Anderson-Kim 磁通蠕变）和核磁共振方面具有**坚实的科学基础**。所提供的关系和常数是标准且正确的。它**定义良好**，具有明确的目标、充足的数据和明确的数学程序（最小二乘拟合）。它使用精确、定量的语言，避免了歧义，因此是**客观的**。问题本身是自洽的，没有矛盾。所提供的数据是现实的，通过检查标称场强和氘锁场频率之间的对应关系（$B = f_D / (\\gamma_D/2\\pi)$）可以证实这一点。例如，对于案例 A，$f_D \\approx 92.156 \\times 10^6 \\ \\mathrm{Hz}$，这给出了 $B \\approx (92.156 \\times 10^6) / (6.535902 \\times 10^6) \\approx 14.1 \\ \\mathrm{T}$，与描述相符。该问题既不简单也非无法验证。\n3.  **结论**：该问题被视为**有效**。\n\n### 分步解决方案\n\n#### 第1部分：对数漂移模型的推导\n\n磁场的时间依赖性 $B(t)$ 是根据热激活磁通蠕变原理推导出来的。\n\n1.  磁场 $B$ 与超导绕组中的持续电流密度 $J$ 成正比。因此，$B$ 的时间行为遵循 $J$ 的时间行为。\n2.  电流的衰减是由磁通涡旋运动引起的微小电压造成的。根据法拉第定律，该电压导致电流变化率 $\\frac{dJ}{dt} \\propto -E$，其中 $E$ 是由涡旋运动产生的电场。\n3.  电场与涡旋速度 $v$ 成正比，$E \\sim B v$。该速度是热激活的，并遵循阿伦尼乌斯型定律，$v \\propto \\exp\\left[-\\frac{U(J)}{k_{\\mathrm{B}} T}\\right]$。\n4.  激活能 $U(J)$ 由 Anderson-Kim 模型给出，$U(J) = U_0 \\left(1 - \\frac{J}{J_c}\\right)$，其中 $J$ 接近临界电流密度 $J_c$。\n5.  结合这些，我们得到电流密度衰减的微分方程：\n    $$ \\frac{dJ}{dt} \\propto - J \\exp\\left[-\\frac{U_0}{k_{\\mathrm{B}} T} \\left(1 - \\frac{J}{J_c}\\right)\\right] $$\n    对于慢速蠕变，$J$ 几乎是恒定的，可以并入比例常数中。设 $\\alpha = \\frac{U_0}{k_{\\mathrm{B}}T J_c}$。该方程简化为：\n    $$ \\frac{dJ}{dt} \\approx -C \\exp(\\alpha J) $$\n    其中 $C$ 是一个常数。\n6.  这个微分方程可以通过分离变量法求解：$e^{-\\alpha J} dJ = -C dt$。文献中常见且能证明一致性的更直接方法是检验一个对数解。我们假设一个形式为 $J(t) = K_1 - K_2 \\ln(t)$ 的解。那么 $\\frac{dJ}{dt} = -\\frac{K_2}{t}$。将此代入微分方程得到：\n    $$ -\\frac{K_2}{t} = -C \\exp[\\alpha(K_1 - K_2 \\ln t)] = -C e^{\\alpha K_1} t^{-\\alpha K_2} $$\n    为使此等式对所有 $t$ 成立，$t$ 的幂必须相等：$t^{-1} = t^{-\\alpha K_2}$，这意味着 $\\alpha K_2 = 1$，或 $K_2 = 1/\\alpha$。系数也必须匹配。这证实了对时间的对数依赖关系是一个有效的解。\n7.  由于 $B(t) \\propto J(t)$，磁场也必须表现出对数衰减。我们可以将其表示为相对于参考测量时间 $t_0$ 的关系：\n    $$ B(t) = B(t_0) - A_m \\ln\\left(\\frac{t}{t_0}\\right) $$\n    此处，$t_0$ 是定义初始条件 $B(t_0)$ 的时间。该模型有两个自由参数需要从实验数据中估计：\n    -   $B(t_0)$：参考时间 $t_0$ 时的磁场。\n    -   $A_m$：漂移振幅，一个正常数，通过 $A_m \\propto 1/\\alpha \\propto \\frac{k_{\\mathrm{B}} T J_c}{U_0}$ 与物理参数相关。\n\n#### 第2部分：数据拟合与预测\n\n推导出的模型 $B(t) = B(t_0) - A_m \\ln\\left(\\frac{t}{t_0}\\right)$ 在 $\\ln(t/t_0)$ 上是线性的。我们可以将其重写为线性最小二乘拟合的形式 $y = p_0 + p_1 x$，其中：\n-   $y = B(t)$\n-   $x = \\ln(t/t_0)$\n-   $p_0 = B(t_0)$ 是截距，表示参考时间的磁场。\n-   $p_1 = -A_m$ 是斜率。\n\n每个测试用例的步骤如下：\n1.  **数据转换**：使用关系式 $B_i = f_{D,i} / (\\gamma_D/2\\pi)$，将在时间 $t_i$ 测得的氘频率 $f_{D,i}$ 转换为磁场值 $B_i$。\n2.  **变量变换**：选择第一次测量时间作为参考时间，$t_0 = t_{\\min}$。计算拟合的自变量 $x_i = \\ln(t_i/t_0)$。\n3.  **最小二乘拟合**：对 $B_i$ 与 $x_i$ 进行线性最小二乘回归，以找到最优参数 $p_0$ 和 $p_1$。这将使用 `numpy.linalg.lstsq` 完成。\n4.  **参数提取**：漂移振幅为 $A_m = -p_1$。参考时间的拟合磁场为 $p_0$。\n5.  **预测**：\n    -   计算未来时间 $t_{\\mathrm{future}} = t_{\\mathrm{last}} + 43200 \\ \\mathrm{s}$。\n    -   使用拟合模型预测此时间的磁场：$B_{\\mathrm{future}} = p_0 + p_1 \\ln(t_{\\mathrm{future}}/t_0)$。\n    -   将此磁场转换为相应的质子共振频率：$f_{H, \\mathrm{future}} = (\\gamma_H/2\\pi) \\times B_{\\mathrm{future}}$。\n\n#### 第3部分：稳定性分类\n\n磁体的稳定性是在从 $t_{\\mathrm{last}}$ 到 $t_{\\mathrm{future}}$ 的12小时周期内进行评估的。\n1.  计算质子共振频率的预测变化量，$\\Delta f_H = f_H(t_{\\mathrm{future}}) - f_H(t_{\\mathrm{last}})$。\n2.  使用拟合模型，$f_H(t) = (\\gamma_H/2\\pi) \\times (p_0 + p_1 \\ln(t/t_0))$。\n3.  变化量则为：\n    $$ \\Delta f_H = \\frac{\\gamma_H}{2\\pi} \\times p_1 \\left( \\ln\\left(\\frac{t_{\\mathrm{future}}}{t_0}\\right) - \\ln\\left(\\frac{t_{\\mathrm{last}}}{t_0}\\right) \\right) = \\frac{\\gamma_H}{2\\pi} p_1 \\ln\\left(\\frac{t_{\\mathrm{future}}}{t_{\\mathrm{last}}}\\right) $$\n4.  如果 $|\\Delta f_H|  10.0 \\ \\mathrm{Hz}$，则稳定性分类为 `True`（稳定），否则为 `False`（不稳定）。\n\n以下 Python 代码实现了这整个过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of analyzing superconducting magnet field drift for NMR.\n\n    This function processes several test cases of magnet drift data. For each case, it:\n    1. Converts measured deuterium lock frequencies to magnetic field values.\n    2. Fits a logarithmic-in-time drift model (B(t) = p0 + p1*ln(t/t0)) using linear least squares.\n    3. Extracts the drift amplitude from the fit.\n    4. Forecasts the proton resonance frequency 12 hours after the last measurement.\n    5. Classifies the magnet's stability based on the forecasted frequency change over that 12-hour period.\n    The results are then printed in the specified format.\n    \"\"\"\n\n    # Define physical constants\n    # Gyromagnetic ratio / 2*pi for Proton in Hz/T\n    GAMMA_H_OVER_2PI = 42.57747892e6\n    # Gyromagnetic ratio / 2*pi for Deuterium in Hz/T\n    GAMMA_D_OVER_2PI = 6.535902e6\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (nominal 14.1 T class magnet, typical drift)\n        {\n            \"times\": np.array([300, 900, 3600, 14400, 21600], dtype=np.float64),\n            \"f_D\": np.array([92156218.2, 92156216.2, 92156213.7, 92156211.2, 92156210.5], dtype=np.float64),\n        },\n        # Case B (nominal 9.4 T class magnet, near-flat drift)\n        {\n            \"times\": np.array([60, 120, 300, 1800, 10800], dtype=np.float64),\n            \"f_D\": np.array([61437478.8, 61437478.7, 61437478.5, 61437478.1, 61437477.8], dtype=np.float64),\n        },\n        # Case C (nominal 18.8 T class magnet, larger drift)\n        {\n            \"times\": np.array([600, 1800, 7200, 43200], dtype=np.float64),\n            \"f_D\": np.array([122874957.6, 122874954.0, 122874949.5, 122874943.6], dtype=np.float64),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        times = case[\"times\"]\n        freq_d = case[\"f_D\"]\n\n        # Task 2: Convert frequency to field and fit the model\n        # B(t) = f_D(t) / (gamma_D/2pi)\n        B_measured = freq_d / GAMMA_D_OVER_2PI\n\n        # The model to fit is B(t) = B(t0) - A_m * ln(t/t0), which is a linear model\n        # y = p0 + p1*x where y=B, x=ln(t/t0), p0=B(t0), p1=-A_m\n        t0 = times[0]\n        x_fit = np.log(times / t0)\n\n        # Set up the design matrix for linear least squares\n        A_matrix = np.vstack([np.ones(len(x_fit)), x_fit]).T\n        \n        # Perform the least-squares fit\n        p, _, _, _ = np.linalg.lstsq(A_matrix, B_measured, rcond=None)\n        p0, p1 = p[0], p[1]\n\n        # Extract the drift amplitude\n        drift_amplitude = -p1\n\n        # Forecast proton frequency at t_future\n        t_last = times[-1]\n        t_future = t_last + 43200.0  # Add 12 hours in seconds\n        \n        # Use the fitted model to predict B at t_future\n        B_future = p0 + p1 * np.log(t_future / t0)\n        \n        # Convert B_future to proton frequency\n        f_H_future = GAMMA_H_OVER_2PI * B_future\n\n        # Task 3: Classify stability\n        # Calculate the change in proton frequency from t_last to t_future\n        # Delta_f_H = f_H(t_future) - f_H(t_last)\n        # Using the model: f_H(t) = GAMMA_H_OVER_2PI * (p0 + p1*ln(t/t0))\n        delta_f_H = GAMMA_H_OVER_2PI * p1 * (np.log(t_future / t0) - np.log(t_last / t0))\n        delta_f_H = GAMMA_H_OVER_2PI * p1 * np.log(t_future / t_last)\n\n        # Stability criterion: |Delta f_H|  10.0 Hz\n        is_stable = abs(delta_f_H)  10.0\n\n        results.append([drift_amplitude, f_H_future, is_stable])\n\n    # Task 4: Final print statement in the exact required format\n    # Build the string representation for the final list of lists\n    result_strings = []\n    for res in results:\n        # Each res is [amplitude, frequency, stability_boolean]\n        # str(value) is used for default representation of floats and booleans.\n        # Python's str(True) is 'True', which matches the example's capitalization.\n        result_strings.append(f\"[{str(res[0])},{str(res[1])},{str(res[2])}]\")\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "高分辨率核磁共振谱的获取要求样品区域内的磁场具有极高的均匀性。“匀场”(shimming)是利用一组特殊线圈来校正这些空间不均匀性的关键过程。本练习将匀场过程转化为一个具体的计算问题，揭示其背后的数学原理()。您将学习如何基于实测的磁场图，利用线性最小二乘法计算匀场线圈的最佳电流值，从而亲身体验磁场均匀性是如何被优化和量化的。",
            "id": "3726346",
            "problem": "用于有机化合物波谱鉴定的核磁共振（NMR）超导磁体必须具有高度均匀的静态磁场。样品的磁化率和微小的安装缺陷会在静态磁场中引入空间变化，这可以通过向匀场线圈施加电流来校正。一阶匀场线圈产生的磁场与笛卡尔坐标成正比，通常命名为 $Z_1$（与 $z$ 成正比）和 $X$（与 $x$ 成正比）。考虑在离散位置 $\\mathbf{r}_i=(x_i,y_i,z_i)$ 处测得的静态磁场偏差图 $\\Delta B(\\mathbf{r}_i)$，其中主要分量是 $Z_1$ 和 $X$。目标是计算能够最小化残余不均匀性的匀场电流，然后在施加计算出的匀场后，量化残余均匀性，并以氢原子核的频率偏移表示。\n\n基本原理和定义：\n- 磁场叠加原理指出，总磁场是来自独立源的贡献之和。如果匀场线圈产生的磁场与 $z$ 和 $x$ 成正比，其校准常数 $k_{Z_1}$ 和 $k_X$ 定义为每安培每米的磁场，那么在点 $(x_i,y_i,z_i)$ 处的匀场校正磁场为 $\\Delta B_{\\text{shim}}(x_i,y_i,z_i) = k_{Z_1} I_{Z_1} z_i + k_X I_X x_i$，其中 $I_{Z_1}$ 和 $I_X$ 是以安培为单位的施加电流。\n- 氢原子核的拉莫尔频率偏移与磁场的关系为 $f = \\left(\\gamma/2\\pi\\right) \\Delta B$，其中 $\\gamma/2\\pi = 42.577\\times 10^6$ Hz/T 是质子的磁旋比。\n- 每个样品位置匀场后的残余磁场为 $\\Delta B_{\\text{res},i} = \\Delta B(\\mathbf{r}_i) + \\Delta B_{\\text{shim}}(\\mathbf{r}_i)$，要最小化的平方误差目标函数是 $\\sum_i \\left(\\Delta B_{\\text{res},i}\\right)^2 = \\sum_i \\left(\\Delta B(\\mathbf{r}_i) + k_{Z_1} I_{Z_1} z_i + k_X I_X x_i\\right)^2$。\n- 最小二乘解旨在寻找使上述和最小化的电流 $I_{Z_1}$ 和 $I_X$。由于一阶匀场磁场是 $I_{Z_1}$ 和 $I_X$ 的线性函数，该问题可以转化为一个线性最小二乘问题。\n\n你的任务：\n- 对于下方的每个测试用例，使用数值稳定的方法计算两个匀场电流 $I_{Z_1}$ 和 $I_X$（单位为安培），以最小化 $\\sum_i \\left(\\Delta B(\\mathbf{r}_i) + k_{Z_1} I_{Z_1} z_i + k_X I_X x_i\\right)^2$。如果系统是秩亏的，则返回最小范数解。\n- 使用计算出的电流，形成残余磁场列表 $\\{\\Delta B_{\\text{res},i}\\}$，使用 $f_i = \\left(\\gamma/2\\pi\\right) \\Delta B_{\\text{res},i}$（其中 $\\gamma/2\\pi = 42.577\\times 10^6$ Hz/T）将其转换为以赫兹为单位的频率偏移，然后计算：\n    - 残余频率偏移的均方根值 $\\text{RMS} = \\sqrt{\\frac{1}{N}\\sum_i f_i^2}$，以赫兹表示。\n    - 峰峰值残余频率展宽 $\\text{P2P} = \\max_i f_i - \\min_i f_i$，以赫兹表示。\n- 所有电流以安培表示，所有频率量以赫兹表示。不涉及角度。数值答案必须是浮点数。\n\n测试套件：\n测试用例A（理想路径，二维网格， $Z_1$ 和 $X$ 均可观测）：\n- 坐标 $(x_i,z_i)$（单位为米），其中 $y_i=0$：\n    - $(-0.02,-0.015),(0,-0.015),(0.02,-0.015),(-0.02,0),(0,0),(0.02,0),(-0.02,0.015),(0,0.015),(0.02,0.015)$，即 $x$ 值 $[-0.02,0,0.02]$ 与 $z$ 值 $[-0.015,0,0.015]$ 的笛卡尔积。\n- 校准常数（场/安培/米）：\n    - $k_{Z_1} = 5.0\\times 10^{-3}$ T/(A·m)，$k_X = 5.0\\times 10^{-3}$ T/(A·m)。\n- 在上述点测得的磁场图 $\\Delta B$（单位为特斯拉，按所列顺序）：\n    - $\\left[-1.0\\times 10^{-7}, -1.85\\times 10^{-6}, -3.32\\times 10^{-6}, 1.53\\times 10^{-6}, 0, -1.54\\times 10^{-6}, 3.36\\times 10^{-6}, 1.82\\times 10^{-6}, 1.1\\times 10^{-7}\\right]$。\n\n测试用例B（边界情况，所有 $z_i=0$，仅 $X$ 可观测）：\n- 坐标 $(x_i,z_i)$（单位为米），其中 $y_i=0$：\n    - $(-0.02,0),(-0.01,0),(0,0),(0.01,0),(0.02,0)$。\n- 校准常数：\n    - $k_{Z_1} = 5.0\\times 10^{-3}$ T/(A·m)，$k_X = 4.0\\times 10^{-3}$ T/(A·m)。\n- 在上述点测得的磁场图 $\\Delta B$（单位为特斯拉，按所列顺序）：\n    - $\\left[-1.95\\times 10^{-6}, -1.02\\times 10^{-6}, 0, 1.03\\times 10^{-6}, 1.96\\times 10^{-6}\\right]$。\n\n测试用例C（含异常值的边缘情况，不规则采样）：\n- 坐标 $(x_i,z_i)$（单位为米），其中 $y_i=0$：\n    - $(-0.02,-0.02),(-0.015,-0.01),(-0.005,0),(0,0.01),(0.01,0.02),(0.015,-0.015),(0.02,0),(-0.01,0.02),(0,-0.02),(0.015,0.015)$。\n- 校准常数：\n    - $k_{Z_1} = 6.0\\times 10^{-3}$ T/(A·m)，$k_X = 4.0\\times 10^{-3}$ T/(A·m)。\n- 在上述点测得的磁场图 $\\Delta B$（单位为特斯拉，按所列顺序）：\n    - $\\left[0.85\\times 10^{-6}, 0.12\\times 10^{-6}, -0.24\\times 10^{-6}, -0.88\\times 10^{-6}, -1.32\\times 10^{-6}, 2.90\\times 10^{-6}, 0.95\\times 10^{-6}, -2.26\\times 10^{-6}, 1.74\\times 10^{-6}, -0.60\\times 10^{-6}\\right]$。\n\n算法规范：\n- 对每个案例，构建设计矩阵 $\\mathbf{A}\\in\\mathbb{R}^{N\\times 2}$，其列为 $\\left[k_{Z_1} z_i\\right]$ 和 $\\left[k_X x_i\\right]$。令 $\\mathbf{b}=-\\Delta \\mathbf{B}$。\n- 计算最小范数最小二乘解 $\\mathbf{I}=\\left[I_{Z_1},I_X\\right]^T$，该解最小化 $\\|\\mathbf{A}\\mathbf{I}-\\mathbf{b}\\|_2$。\n- 计算残余磁场 $\\Delta \\mathbf{B}_{\\text{res}}=\\Delta \\mathbf{B}+\\mathbf{A}\\mathbf{I}$。\n- 将残余磁场转换为频率偏移，使用 $f_i=\\left(\\gamma/2\\pi\\right)\\Delta B_{\\text{res},i}$，其中 $\\gamma/2\\pi=42.577\\times 10^6$ Hz/T，然后计算 $\\text{RMS}=\\sqrt{\\frac{1}{N}\\sum_i f_i^2}$ 和 $\\text{P2P}=\\max_i f_i-\\min_i f_i$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含所有三个测试用例的结果，形式为方括号内包含的逗号分隔列表。每个用例的结果本身必须是包含四个浮点数的列表，顺序为 $[I_{Z_1}, I_X, \\text{RMS}, \\text{P2P}]$，其中电流单位为安培，频率度量单位为赫兹。例如，输出必须类似于 $[[i_{A,Z_1},i_{A,X},\\text{rms}_A,\\text{p2p}_A],[i_{B,Z_1},i_{B,X},\\text{rms}_B,\\text{p2p}_B],[i_{C,Z_1},i_{C,X},\\text{rms}_C,\\text{p2p}_C]]$，其中的符号用实际数值替换。",
            "solution": "超导磁体的静态磁场不均匀性可以很好地由球谐函数的线性组合在局部进行描述。一阶谐波 $Z_1$ 和 $X$ 分别对应于与 $z$ 和 $x$ 成正比的磁场。由于磁场是线性叠加的，施加匀场电流后的净残余磁场是测得的偏差与匀场产生的校正之和。该问题的基本原理是线性叠加和线性最小二乘最小化。\n\n我们从位置 $\\mathbf{r}_i=(x_i,y_i,z_i)$ 处测得的偏移量 $\\Delta B(\\mathbf{r}_i)$ 开始。一阶匀场线圈产生的校正磁场由 $\\Delta B_{\\text{shim}}(x_i,y_i,z_i)=k_{Z_1} I_{Z_1} z_i + k_X I_X x_i$ 给出，其中 $k_{Z_1}$ 和 $k_X$ 是将电流和空间坐标转换为磁场的校准常数，$I_{Z_1}$ 和 $I_X$ 是待确定的电流。则在样品 $i$ 处的残余磁场为\n$$\n\\Delta B_{\\text{res},i}=\\Delta B(\\mathbf{r}_i)+k_{Z_1} I_{Z_1} z_i + k_X I_X x_i.\n$$\n为了找到 $I_{Z_1}$ 和 $I_X$，我们最小化残差平方和\n$$\nS(I_{Z_1},I_X)=\\sum_{i=1}^N\\left(\\Delta B(\\mathbf{r}_i)+k_{Z_1} I_{Z_1} z_i + k_X I_X x_i\\right)^2.\n$$\n这是一个线性最小二乘问题。令设计矩阵为\n$$\n\\mathbf{A}=\\begin{bmatrix}\nk_{Z_1} z_1  k_X x_1 \\\\\nk_{Z_1} z_2  k_X x_2 \\\\\n\\vdots  \\vdots \\\\\nk_{Z_1} z_N  k_X x_N\n\\end{bmatrix},\\quad\n\\mathbf{b}=-\\begin{bmatrix}\n\\Delta B(\\mathbf{r}_1) \\\\ \\Delta B(\\mathbf{r}_2) \\\\ \\vdots \\\\ \\Delta B(\\mathbf{r}_N)\n\\end{bmatrix}.\n$$\n我们寻求 $\\mathbf{I}=\\begin{bmatrix}I_{Z_1}\\\\I_X\\end{bmatrix}$ 以最小化 $\\left\\|\\mathbf{A}\\mathbf{I}-\\mathbf{b}\\right\\|_2$。当 $\\mathbf{A}$ 具有满列秩时，解满足正规方程组\n$$\n(\\mathbf{A}^\\top \\mathbf{A})\\mathbf{I}=\\mathbf{A}^\\top \\mathbf{b},\n$$\n从而得到\n$$\n\\mathbf{I}=(\\mathbf{A}^\\top \\mathbf{A})^{-1}\\mathbf{A}^\\top \\mathbf{b}.\n$$\n如果 $\\mathbf{A}$ 是秩亏的（例如，所有 $z_i=0$，导致 $Z_1$ 列为零），则最小范数解由摩尔-彭若斯伪逆给出，\n$$\n\\mathbf{I}=\\mathbf{A}^+\\mathbf{b},\n$$\n它可以通过奇异值分解等方法或返回最小范数解的专用最小二乘求解器来稳定地计算。\n\n一旦求得 $\\mathbf{I}$，残余磁场矢量为\n$$\n\\Delta \\mathbf{B}_{\\text{res}}=\\Delta \\mathbf{B}+\\mathbf{A}\\mathbf{I}.\n$$\n为了在波谱域中评估均匀性，通过以下公式将每个残余磁场转换为氢原子核的频率偏移\n$$\nf_i=\\left(\\frac{\\gamma}{2\\pi}\\right)\\Delta B_{\\text{res},i},\\quad\\frac{\\gamma}{2\\pi}=42.577\\times 10^6\\ \\text{Hz/T}.\n$$\n均方根残余频率为\n$$\n\\text{RMS}=\\sqrt{\\frac{1}{N}\\sum_{i=1}^N f_i^2},\n$$\n峰峰值展宽为\n$$\n\\text{P2P}=\\max_i f_i - \\min_i f_i.\n$$\n\n算法上，对每个测试用例，我们：\n- 使用提供的 $k_{Z_1}$、$k_X$ 和坐标构建 $\\mathbf{A}$。\n- 使用能够优雅处理秩亏情况并产生最小范数解的数值稳定的最小二乘求解器计算 $\\mathbf{I}$。\n- 形成 $\\Delta \\mathbf{B}_{\\text{res}}$ 并使用提供的质子磁旋比将其转换为频率偏移。\n- 计算以赫兹为单位的 $\\text{RMS}$ 和 $\\text{P2P}$。\n\n通过使用能产生物理上合理的电流（对于一阶匀场，在几十毫安到几百毫安的量级）、将厘米转换为米的空间坐标以及微特斯拉单位的测量磁场偏差的校准常数，确保了科学真实性。该测试套件探究了不同的方面：一个同时具有 $z$ 和 $x$ 变化的良态网格，一个只有 $x$ 变化（对 $Z_1$ 秩亏）的边界情况，以及一个带有异常值的不规则集合，以观察最小二乘残差的敏感性。输出格式将每个案例的电流和残余均匀性度量聚合成一个打印在单行上的列表的列表，可直接与程序的计算结果进行验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    # Proton gyromagnetic ratio in Hz/T\n    gamma_hz_per_t = 42.577e6\n\n    # Define the test cases from the problem statement.\n    # Each case: dict with keys: 'x', 'z', 'kz1', 'kx', 'dB'\n    test_cases = [\n        {\n            # Case A\n            \"x\": np.array([-0.02, 0.0, 0.02, -0.02, 0.0, 0.02, -0.02, 0.0, 0.02], dtype=float),\n            \"z\": np.array([-0.015, -0.015, -0.015, 0.0, 0.0, 0.0, 0.015, 0.015, 0.015], dtype=float),\n            \"kz1\": 5.0e-3,\n            \"kx\": 5.0e-3,\n            \"dB\": np.array([-1.0e-7, -1.85e-6, -3.32e-6, 1.53e-6, 0.0, -1.54e-6, 3.36e-6, 1.82e-6, 1.1e-7], dtype=float),\n        },\n        {\n            # Case B\n            \"x\": np.array([-0.02, -0.01, 0.0, 0.01, 0.02], dtype=float),\n            \"z\": np.array([0.0, 0.0, 0.0, 0.0, 0.0], dtype=float),\n            \"kz1\": 5.0e-3,\n            \"kx\": 4.0e-3,\n            \"dB\": np.array([-1.95e-6, -1.02e-6, 0.0, 1.03e-6, 1.96e-6], dtype=float),\n        },\n        {\n            # Case C\n            \"x\": np.array([-0.02, -0.015, -0.005, 0.0, 0.01, 0.015, 0.02, -0.01, 0.0, 0.015], dtype=float),\n            \"z\": np.array([-0.02, -0.01, 0.0, 0.01, 0.02, -0.015, 0.0, 0.02, -0.02, 0.015], dtype=float),\n            \"kz1\": 6.0e-3,\n            \"kx\": 4.0e-3,\n            \"dB\": np.array([0.85e-6, 0.12e-6, -0.24e-6, -0.88e-6, -1.32e-6, 2.90e-6, 0.95e-6, -2.26e-6, 1.74e-6, -0.60e-6], dtype=float),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        x = case[\"x\"]\n        z = case[\"z\"]\n        kz1 = case[\"kz1\"]\n        kx = case[\"kx\"]\n        dB = case[\"dB\"]\n\n        # Construct design matrix A with columns [kz1 * z, kx * x]\n        A = np.column_stack((kz1 * z, kx * x))\n\n        # Target vector b = -dB\n        b = -dB\n\n        # Compute minimum-norm least-squares solution for currents [I_Z1, I_X]\n        # Using lstsq which handles rank-deficiency and returns the minimum-norm solution.\n        I, residuals, rank, s = np.linalg.lstsq(A, b, rcond=None)\n        I_z1, I_x = float(I[0]), float(I[1])\n\n        # Compute residual magnetic field after applying shim currents\n        dB_res = dB + A @ I  # vector of residuals in Tesla\n\n        # Convert residuals to frequency offsets (Hz)\n        f_res = gamma_hz_per_t * dB_res\n\n        # Compute RMS and Peak-to-Peak in Hz\n        rms_hz = float(np.sqrt(np.mean(f_res**2)))\n        p2p_hz = float(np.max(f_res) - np.min(f_res))\n\n        results.append([I_z1, I_x, rms_hz, p2p_hz])\n\n    # Final print statement in the exact required format.\n    # Print a single line: list of lists, each inner list has four floats.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现代无液氦（cryogen-free）超导磁体虽然免去了添加低温液体的繁琐，但也引入了新的挑战，特别是来自制冷机的机械振动。这些振动会耦合到磁场中，导致谱线增宽，从而降低谱图的分辨率。本练习()将引导您解决这个核磁共振仪器领域的实际问题，学习如何从基本物理原理出发，建立一个连接机械振动和谱线宽度的模型。这有助于加深您对仪器噪声来源的理解，并锻炼您进行物理建模和性能量化的能力。",
            "id": "3726332",
            "problem": "一台用于有机化合物波谱鉴定、高分辨率核磁共振（NMR）波谱学的无制冷剂超导磁体，其工作静磁场 $B_0$ 足以在约 $600$ MHz 处产生标称的 $^1\\mathrm{H}$ 共振。低温冷却器引起的振动与匀场后残留的磁场不均匀性耦合，从而调制了样品处的局部静磁场。设匀场后主要的轴向剩余场梯度为 $G_z = 0.25 \\ \\mu\\mathrm{T/mm}$，且由低温冷却器谐波引起的样品轴向位移可建模为\n$$\nz(t) = A_1 \\cos\\!\\big(2\\pi f_1 t + \\phi_1\\big) + A_2 \\cos\\!\\big(2\\pi f_2 t + \\phi_2\\big),\n$$\n其中在 $f_1 = 1.5 \\ \\mathrm{Hz}$ 时 $A_1 = 12 \\ \\mu\\mathrm{m}$，在 $f_2 = 3.0 \\ \\mathrm{Hz}$ 时 $A_2 = 5 \\ \\mu\\mathrm{m}$。此时，样品处的局部磁场为 $B_z(t) = B_0 + G_z z(t)$，瞬时 $^1\\mathrm{H}$ 拉莫尔频率为 $\\nu(t) = \\frac{\\gamma}{2\\pi} B_z(t)$，其中质子磁旋比为 $\\frac{\\gamma}{2\\pi} = 42.577 \\times 10^{6} \\ \\mathrm{Hz/T}$。\n\n假设场调制足够小，可以进行线性化处理，并假设由于低温冷却器循环波动和微音效应，在观测时间内相位 $\\phi_1$ 和 $\\phi_2$ 在 $[0,2\\pi)$ 上均匀取样，因此所产生的瞬时频率偏移可以被视为一个具有确定方差的零均值随机变量。从塞曼关系和磁场梯度的定义出发，推导一个具有物理解释的、由振动引起的均方根（RMS）频率波动的表达式，然后通过将频率抖动建模为高斯分布，估算 $^1\\mathrm{H}$ 谱中额外的半峰全宽（FWHM）线宽增宽。将最终的半峰全宽（FWHM）结果四舍五入至三位有效数字，并以赫兹（Hz）为单位表示。",
            "solution": "问题要求估算由低温冷却器引起的振动导致的 $^1\\mathrm{H}$ 核磁共振谱中额外的半峰全宽（FWHM）线宽增宽。推导将从所提供的基本原理出发。\n\n首先，我们建立物理量之间的关系。瞬时拉莫尔频率 $\\nu(t)$ 与样品所经历的局部磁场 $B_z(t)$ 成正比。这由塞曼关系给出：\n$$\n\\nu(t) = \\frac{\\gamma}{2\\pi} B_z(t)\n$$\n其中 $\\frac{\\gamma}{2\\pi}$ 是质子磁旋比。\n\n局部磁场 $B_z(t)$ 在剩余磁场梯度 $G_z$ 中受到机械振动 $z(t)$ 的调制：\n$$\nB_z(t) = B_0 + G_z z(t)\n$$\n这里，$B_0$ 是静态、均匀的主磁场。将此代入频率表达式中，得到：\n$$\n\\nu(t) = \\frac{\\gamma}{2\\pi} (B_0 + G_z z(t)) = \\frac{\\gamma}{2\\pi} B_0 + \\frac{\\gamma}{2\\pi} G_z z(t)\n$$\n第一项 $\\nu_0 = \\frac{\\gamma}{2\\pi} B_0$ 是恒定的、未受扰动的拉莫尔频率，即共振线的中心。第二项表示由振动引起的瞬时频率波动或偏移 $\\Delta\\nu(t)$：\n$$\n\\Delta\\nu(t) = \\nu(t) - \\nu_0 = \\frac{\\gamma}{2\\pi} G_z z(t)\n$$\n问题给出了轴向位移 $z(t)$ 的显式形式，即两个谐波分量的和：\n$$\nz(t) = A_1 \\cos(2\\pi f_1 t + \\phi_1) + A_2 \\cos(2\\pi f_2 t + \\phi_2)\n$$\n将此代入 $\\Delta\\nu(t)$ 的表达式中：\n$$\n\\Delta\\nu(t) = \\frac{\\gamma}{2\\pi} G_z \\left[ A_1 \\cos(2\\pi f_1 t + \\phi_1) + A_2 \\cos(2\\pi f_2 t + \\phi_2) \\right]\n$$\n问题陈述，相位 $\\phi_1$ 和 $\\phi_2$ 是在 $[0, 2\\pi)$ 上均匀分布的随机变量。这使我们可以将 $\\Delta\\nu(t)$ 视为零均值随机变量。线宽增宽与此频率波动的方差有关，$\\sigma_\\nu^2 = \\langle (\\Delta\\nu(t))^2 \\rangle - \\left(\\langle \\Delta\\nu(t) \\rangle\\right)^2$，其中 $\\langle \\cdot \\rangle$ 表示期望值（对随机相位的平均）。\n\n首先，我们计算平均波动 $\\langle \\Delta\\nu(t) \\rangle$：\n$$\n\\langle \\Delta\\nu(t) \\rangle = \\frac{\\gamma}{2\\pi} G_z \\left[ A_1 \\langle \\cos(2\\pi f_1 t + \\phi_1) \\rangle + A_2 \\langle \\cos(2\\pi f_2 t + \\phi_2) \\rangle \\right]\n$$\n由于 $\\phi_1$ 和 $\\phi_2$ 在 $[0, 2\\pi)$ 上均匀分布，任何余弦函数的平均值均为零。\n$$\n\\langle \\cos(2\\pi f t + \\phi) \\rangle = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\cos(2\\pi f t + \\phi) d\\phi = 0\n$$\n因此，$\\langle \\Delta\\nu(t) \\rangle = 0$。这证实了频率偏移构成一个零均值随机变量的论断。\n\n接下来，我们计算方差 $\\sigma_\\nu^2$。对于零均值变量，方差等于均方值 $\\langle (\\Delta\\nu(t))^2 \\rangle$。\n$$\n\\sigma_\\nu^2 = \\left\\langle \\left( \\frac{\\gamma}{2\\pi} G_z \\left[ A_1 \\cos(2\\pi f_1 t + \\phi_1) + A_2 \\cos(2\\pi f_2 t + \\phi_2) \\right] \\right)^2 \\right\\rangle\n$$\n$$\n\\sigma_\\nu^2 = \\left( \\frac{\\gamma G_z}{2\\pi} \\right)^2 \\left\\langle \\left[ A_1^2 \\cos^2(\\theta_1) + A_2^2 \\cos^2(\\theta_2) + 2 A_1 A_2 \\cos(\\theta_1)\\cos(\\theta_2) \\right] \\right\\rangle\n$$\n其中 $\\theta_1 = 2\\pi f_1 t + \\phi_1$ 且 $\\theta_2 = 2\\pi f_2 t + \\phi_2$。根据期望算子的线性性质：\n$$\n\\sigma_\\nu^2 = \\left( \\frac{\\gamma G_z}{2\\pi} \\right)^2 \\left[ A_1^2 \\langle \\cos^2(\\theta_1) \\rangle + A_2^2 \\langle \\cos^2(\\theta_2) \\rangle + 2 A_1 A_2 \\langle \\cos(\\theta_1)\\cos(\\theta_2) \\rangle \\right]\n$$\n$\\cos^2(\\theta)$ 的期望值为 $\\langle \\cos^2(\\theta) \\rangle = \\langle \\frac{1+\\cos(2\\theta)}{2} \\rangle = \\frac{1}{2} + \\frac{1}{2}\\langle \\cos(2\\theta) \\rangle = \\frac{1}{2}$。\n交叉项的平均值为 $\\langle \\cos(\\theta_1)\\cos(\\theta_2) \\rangle$。由于相位 $\\phi_1$ 和 $\\phi_2$ 是独立的，我们可以对它们独立求平均。$\\cos(\\theta_1)$ 对 $\\phi_1$ 的平均值为零，因此整个交叉项的平均值为零。\n代入这些结果：\n$$\n\\sigma_\\nu^2 = \\left( \\frac{\\gamma G_z}{2\\pi} \\right)^2 \\left[ A_1^2 \\left(\\frac{1}{2}\\right) + A_2^2 \\left(\\frac{1}{2}\\right) + 0 \\right] = \\frac{1}{2} \\left( \\frac{\\gamma G_z}{2\\pi} \\right)^2 (A_1^2 + A_2^2)\n$$\n均方根（RMS）频率波动是方差的平方根，$\\nu_{RMS} = \\sigma_\\nu$。\n$$\n\\nu_{RMS} = \\sqrt{\\frac{1}{2} \\left( \\frac{\\gamma G_z}{2\\pi} \\right)^2 (A_1^2 + A_2^2)} = \\frac{1}{\\sqrt{2}} \\left| \\frac{\\gamma G_z}{2\\pi} \\right| \\sqrt{A_1^2 + A_2^2}\n$$\n问题陈述线宽增宽是由被建模为高斯分布的频率抖动引起的。高斯线型由 $S(\\nu) \\propto \\exp(-(\\nu-\\nu_0)^2 / (2\\sigma_\\nu^2))$ 描述。半峰全宽（FWHM），记为 $\\Delta\\nu_{1/2}$，通过著名公式与标准差 $\\sigma_\\nu$（对于我们的零均值分布，即为 $\\nu_{RMS}$）相关联：\n$$\n\\Delta\\nu_{1/2} = 2\\sqrt{2 \\ln(2)} \\, \\sigma_\\nu = 2\\sqrt{2 \\ln(2)} \\, \\nu_{RMS}\n$$\n现在我们进行数值计算。首先，我们必须确保所有单位都在国际单位制（SI）基本单位中。\n磁旋比为 $\\frac{\\gamma}{2\\pi} = 42.577 \\times 10^6 \\ \\mathrm{Hz/T}$。\n梯度为 $G_z = 0.25 \\ \\mu\\mathrm{T/mm} = 0.25 \\times 10^{-6} \\ \\mathrm{T} / (10^{-3} \\ \\mathrm{m}) = 0.25 \\times 10^{-3} \\ \\mathrm{T/m}$。\n振幅为 $A_1 = 12 \\ \\mu\\mathrm{m} = 12 \\times 10^{-6} \\ \\mathrm{m}$ 和 $A_2 = 5 \\ \\mu\\mathrm{m} = 5 \\times 10^{-6} \\ \\mathrm{m}$。\n\n我们计算 $\\sqrt{A_1^2 + A_2^2}$ 项：\n$$\n\\sqrt{A_1^2 + A_2^2} = \\sqrt{(12 \\times 10^{-6})^2 + (5 \\times 10^{-6})^2} \\ \\mathrm{m} = \\sqrt{(144 + 25) \\times 10^{-12}} \\ \\mathrm{m} = \\sqrt{169 \\times 10^{-12}} \\ \\mathrm{m} = 13 \\times 10^{-6} \\ \\mathrm{m}\n$$\n接下来，我们计算 $\\nu_{RMS}$：\n$$\n\\nu_{RMS} = \\frac{1}{\\sqrt{2}} (42.577 \\times 10^6 \\ \\mathrm{Hz/T}) (0.25 \\times 10^{-3} \\ \\mathrm{T/m}) (13 \\times 10^{-6} \\ \\mathrm{m})\n$$\n$$\n\\nu_{RMS} = \\frac{1}{\\sqrt{2}} (10644.25 \\ \\mathrm{Hz/m}) (13 \\times 10^{-6} \\ \\mathrm{m}) = \\frac{1}{\\sqrt{2}} (0.13837525 \\ \\mathrm{Hz}) \\approx 0.097846 \\ \\mathrm{Hz}\n$$\n最后，我们计算 FWHM 线宽增宽 $\\Delta\\nu_{1/2}$：\n$$\n\\Delta\\nu_{1/2} = 2\\sqrt{2 \\ln(2)} \\cdot \\nu_{RMS} \\approx 2.35482 \\times 0.097846 \\ \\mathrm{Hz} \\approx 0.23041 \\ \\mathrm{Hz}\n$$\n按要求将结果四舍五入到三位有效数字，得到：\n$$\n\\Delta\\nu_{1/2} \\approx 0.230 \\ \\mathrm{Hz}\n$$",
            "answer": "$$\n\\boxed{0.230}\n$$"
        }
    ]
}