{
    "hands_on_practices": [
        {
            "introduction": "掌握QR算法的精髓始于理解其基本操作。这个练习 () 将带你手动执行一个带有威尔金森位移的隐式QR单步迭代。通过亲手计算初始Givens旋转以产生一个“凸起”，并将其“追逐”下去以恢复Hessenberg形式，你将对正交相似变换如何逐步改变矩阵结构建立起直观的认识。",
            "id": "3577332",
            "problem": "考虑实上Hessenberg矩阵\n$$\nH \\;=\\;\n\\begin{pmatrix}\n2   1  0  0\\\\\n1   2  1  0\\\\\n0   1  2  1\\\\\n0   0  1  2\n\\end{pmatrix}.\n$$\n使用由 $H$ 的末尾 $2\\times 2$ 子矩阵定义的Wilkinson位移，对矩阵 $H$ 执行Francis隐式 $QR$ (正交-三角) 迭代的单一位移步。完全在实数算术中进行运算。从第一性原理开始：为末尾的 $2\\times 2$ 块定义Wilkinson位移，根据与 $H-\\mu I$ 相关的首部2-向量构造初始Givens旋转，然后用后续的Givens旋转来“追逐凸起”，以恢复Hessenberg形式。全程使用正交相似变换，不要显式地构造 $H-\\mu I$ 的完整 $QR$ 分解。\n\n任务：\n- 从 $H$ 的末尾 $2\\times 2$ 子矩阵确定Wilkinson位移 $\\mu$。\n- 应用一个隐式单一位移步，得到更新后的矩阵 $H^{(1)}$，并列出其所有元素，保留四位有效数字。\n- 对于您的最终数值答案，报告 $H^{(1)}$ 的 $(4,3)$ 元素，保留四位有效数字。\n\n将所有数值量表示为四位有效数字。最终提交的答案必须是一个实数（指定的矩阵元素），保留四位有效数字。",
            "solution": "用户希望对一个给定的 $4 \\times 4$ 实上Hessenberg矩阵执行带Wilkinson位移的Francis隐式QR迭代的单步操作。该矩阵为\n$$\nH \\;=\\;\n\\begin{pmatrix}\n2   1  0  0\\\\\n1   2  1  0\\\\\n0   1  2  1\\\\\n0   0  1  2\n\\end{pmatrix}.\n$$\n该矩阵实际上是对称三对角矩阵。对对称矩阵应用QR算法的单步操作会保持其对称性。此外，对于对称三对角矩阵，带位移的隐式QR步会保持其三对角结构。\n\n**第1步：确定Wilkinson位移 $\\mu$**\n\nWilkinson位移由 $H$ 的末尾 $2 \\times 2$ 子矩阵的特征值确定。该子矩阵为\n$$\nH_{sub} = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}.\n$$\n该子矩阵的特征值 $\\lambda$ 是其特征多项式的根：\n$$\n\\det(H_{sub} - \\lambda I) = (2-\\lambda)^2 - (1)(1) = 0\n$$\n$$\n\\lambda^2 - 4\\lambda + 4 - 1 = \\lambda^2 - 4\\lambda + 3 = 0\n$$\n$$\n(\\lambda-1)(\\lambda-3) = 0\n$$\n特征值为 $\\lambda_1 = 1$ 和 $\\lambda_2 = 3$。Wilkinson位移 $\\mu$ 是距离末尾对角元素 $H_{44} = 2$ 更近的那个特征值。我们计算距离：\n$$\n|\\lambda_1 - H_{44}| = |1 - 2| = 1\n$$\n$$\n|\\lambda_2 - H_{44}| = |3 - 2| = 1\n$$\n距离相等。按照惯例，可以选择任一特征值作为位移。我们将选择较小的值，$\\mu = 1$。\n\n**第2步：执行隐式QR步**\n\n隐式QR步包括构造一系列Givens旋转来执行相似变换 $H^{(1)} = Q^\\top H Q$，其中 $Q$ 是来自因子分解 $H - \\mu I = QR$ 的正交矩阵。\n\n**2a. 初始凸起创建**\n\n第一步是创建一个Givens旋转 $Q_1$，它将 $H - \\mu I$ 第一列的第二个元素置零。$H - \\mu I$ 的第一列由 $x$ 给出：\n$$\nx = \\begin{pmatrix} H_{11} - \\mu \\\\ H_{21} \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2-1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n我们定义一个作用于前两行的Givens旋转 $Q_1$。这个 $2 \\times 2$ 旋转块是 $\\begin{pmatrix} c_1  s_1 \\\\ -s_1  c_1 \\end{pmatrix}$，其中 $c_1 = \\frac{1}{\\sqrt{1^2+1^2}} = \\frac{1}{\\sqrt{2}}$ 且 $s_1 = \\frac{1}{\\sqrt{1^2+1^2}} = \\frac{1}{\\sqrt{2}}$。\n$$\nQ_1 = \\begin{pmatrix} 1/\\sqrt{2}  1/\\sqrt{2}  0  0 \\\\ -1/\\sqrt{2}  1/\\sqrt{2}  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix}.\n$$\n我们将其作为相似变换应用于 $H$：$H_1 = Q_1 H Q_1^\\top$。\n$$\nH_1 = Q_1 H Q_1^\\top = \\begin{pmatrix} 3  0  1/\\sqrt{2}  0 \\\\ 0  1  1/\\sqrt{2}  0 \\\\ 1/\\sqrt{2}  1/\\sqrt{2}  2  1 \\\\ 0  0  1  2 \\end{pmatrix}.\n$$\n这个变换引入了一个“凸起”，即在位置 $(3,1)$（由于对称性，也在 $(1,3)$）处出现了一个非零元素，破坏了三对角结构。\n\n**2b. 追逐凸起：第一次旋转**\n\n为了恢复三对角形式，我们沿着对角线“追逐”凸起。我们引入一个作用于第2行和第3行的Givens旋转 $Q_2$，以消除元素 $H_1(3,1)$。参数 $c_2, s_2$ 由向量 $[H_1(2,1), H_1(3,1)]^\\top = [0, 1/\\sqrt{2}]^\\top$ 确定。\n这得到 $c_2 = \\frac{0}{\\sqrt{0^2+(1/\\sqrt{2})^2}} = 0$ 和 $s_2 = \\frac{1/\\sqrt{2}}{\\sqrt{0^2+(1/\\sqrt{2})^2}} = 1$。\n$$\nQ_2 = \\begin{pmatrix} 1  0  0  0 \\\\ 0  0  1  0 \\\\ 0  -1  0  0 \\\\ 0  0  0  1 \\end{pmatrix}.\n$$\n我们计算 $H_2 = Q_2 H_1 Q_2^\\top$：\n$$\nH_2 = \\begin{pmatrix} 3  1/\\sqrt{2}  0  0 \\\\ 1/\\sqrt{2}  2  -1/\\sqrt{2}  1 \\\\ 0  -1/\\sqrt{2}  1  0 \\\\ 0  1  0  2 \\end{pmatrix}.\n$$\n凸起已经从 $(3,1)$ 移到了 $(4,2)$（并从 $(1,3)$ 移到了 $(2,4)$）。\n\n**2c. 追逐凸起：第二次旋转**\n\n最后，我们引入一个作用于第3行和第4行的Givens旋转 $Q_3$，以消除位于 $H_2(4,2)$ 的新凸起。参数 $c_3, s_3$ 由向量 $[H_2(3,2), H_2(4,2)]^\\top = [-1/\\sqrt{2}, 1]^\\top$ 确定。\n$$\nr = \\sqrt{(-1/\\sqrt{2})^2 + 1^2} = \\sqrt{1/2 + 1} = \\sqrt{3/2}.\n$$\n$$\nc_3 = \\frac{-1/\\sqrt{2}}{\\sqrt{3/2}} = -\\frac{1}{\\sqrt{3}}, \\quad s_3 = \\frac{1}{\\sqrt{3/2}} = \\sqrt{\\frac{2}{3}}.\n$$\n$$\nQ_3 = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  -1/\\sqrt{3}  \\sqrt{2/3} \\\\ 0  0  -\\sqrt{2/3}  -1/\\sqrt{3} \\end{pmatrix}.\n$$\n更新后的矩阵是 $H^{(1)} = Q_3 H_2 Q_3^\\top$。这个变换恢复了三对角形式。\n$$\nH^{(1)} = \\begin{pmatrix}\n3  1/\\sqrt{2}  0  0 \\\\\n1/\\sqrt{2}  2  \\sqrt{3/2}  0 \\\\\n0  \\sqrt{3/2}  5/3  -\\sqrt{2}/3 \\\\\n0  0  -\\sqrt{2}/3  4/3\n\\end{pmatrix}.\n$$\n\n**第3步：最终数值结果**\n\nWilkinson位移是 $\\mu=1$。\n\n更新后的矩阵 $H^{(1)}$，其元素保留四位有效数字，为：\n$$\n1/\\sqrt{2} \\approx 0.7071\n$$\n$$\n\\sqrt{3/2} \\approx 1.225\n$$\n$$\n5/3 \\approx 1.667\n$$\n$$\n-\\sqrt{2}/3 \\approx -0.4714\n$$\n$$\n4/3 \\approx 1.333\n$$\n$$\nH^{(1)} \\approx \\begin{pmatrix}\n3.000  0.7071  0  0 \\\\\n0.7071  2.000  1.225  0 \\\\\n0  1.225  1.667  -0.4714 \\\\\n0  0  -0.4714  1.333\n\\end{pmatrix}.\n$$\n问题要求 $H^{(1)}$ 的 $(4,3)$ 元素，保留四位有效数字。\n$$\nH^{(1)}_{4,3} = -\\frac{\\sqrt{2}}{3} \\approx -0.4714045...\n$$\n保留四位有效数字，该值为 $-0.4714$。",
            "answer": "$$\\boxed{-0.4714}$$"
        },
        {
            "introduction": "在掌握了单位移之后，我们自然地过渡到更强大和广泛应用的Francis双位移策略。此练习 () 将演示如何在完全使用实数运算的前提下，隐式地应用一对复共轭位移。你将使用Householder反射镜来启动凸起追逐过程，这让你能够熟练掌握QR算法中这一至关重要的技巧，并理解其如何高效处理实矩阵的复特征值。",
            "id": "3577273",
            "problem": "考虑实上Hessenberg矩阵\n$$\nH \\;=\\;\n\\begin{pmatrix}\n0   1  0  0\\\\\n1   0  1  0\\\\\n0   1  0  1\\\\\n0   0  1  0\n\\end{pmatrix} \\in \\mathbb{R}^{4\\times 4}.\n$$\n使用一对复共轭位移执行一步实Francis双位移迭代，位移选择为\n$$\n\\mu \\;=\\; \\mathrm{i}, \\qquad \\overline{\\mu} \\;=\\; -\\mathrm{i},\n$$\n因此实二次位移定义为\n$$\np(z) \\;=\\; z^{2} - \\tau z + \\rho, \\quad \\text{其中} \\quad \\tau \\;=\\; \\mu + \\overline{\\mu} \\;=\\; 0,\\quad \\rho \\;=\\; \\mu\\,\\overline{\\mu} \\;=\\; 1.\n$$\n在实Hessenberg矩阵上使用Francis双位移迭代的隐式正交相似形式，并遵循以下标准约定：\n- 对向量 $x \\in \\mathbb{R}^{3}$ 的前三个分量构造初始Householder反射镜，其中 $x$ 是由 $p(H)e_{1}$ 的前三个元素得到，该反射镜将 $x$ 映射到一个只有第一个分量非负且非零的向量。\n- 从左侧然后从右侧应用每个正交变换，以保持实数算术和Hessenberg结构，并将“凸起”追逐到底部，恢复 $4\\times 4$ 上Hessenberg形式。\n\n完成这单次Francis双位移迭代的完整凸起追逐后，报告更新后的次对角线元素 $h_{21}^{\\text{(new)}}$。以精确解析表达式的形式给出最终答案。无需四舍五入。",
            "solution": "用户希望对一个给定的 $4 \\times 4$ 实上Hessenberg矩阵 $H$ 执行一步实Francis双位移QR算法。该过程涉及创建一个“凸起”，然后“追逐”它以恢复Hessenberg形式。\n\n**步骤1：问题验证**\n\n该问题是在数值线性代数的背景下提出的，描述了一个标准过程，即Francis双位移QR步。所有提供的信息都是自洽、一致且有科学依据的。给定的矩阵确实是一个实上Hessenberg矩阵（更具体地说，是一个对称三对角矩阵）。位移构成一个复共轭对，这导致一个实二次多项式，正如实双位移算法所要求的那样。构造Householder反射镜的说明是明确的，并符合一个有效但特定的约定。问题是适定的和客观的。因此，该问题是有效的，并且可以推导出解决方案。\n\n**步骤2：设置Francis步**\n\n给定的矩阵是：\n$$\nH \\;=\\;\n\\begin{pmatrix}\n0   1  0  0\\\\\n1   0  1  0\\\\\n0   1  0  1\\\\\n0   0  1  0\n\\end{pmatrix}\n$$\n位移为 $\\mu = \\mathrm{i}$ 和 $\\overline{\\mu} = -\\mathrm{i}$。相关的实二次多项式是 $p(z) = (z-\\mu)(z-\\overline{\\mu}) = z^2 - (\\mu+\\overline{\\mu})z + \\mu\\overline{\\mu}$。\n迹为 $\\tau = \\mu + \\overline{\\mu} = \\mathrm{i} - \\mathrm{i} = 0$。\n行列式为 $\\rho = \\mu\\overline{\\mu} = (\\mathrm{i})(-\\mathrm{i}) = 1$。\n所以，多项式是 $p(z) = z^2+1$。\n\n隐式QR算法首先计算矩阵 $p(H)$ 的第一列，我们将其表示为向量 $x_v$。\n$$\nx_v \\;=\\; p(H)e_1 \\;=\\; (H^2 + I)e_1 \\;=\\; H^2e_1 + e_1\n$$\n其中 $e_1 = (1, 0, 0, 0)^\\top$。\n首先，我们计算 $H e_1$，也就是 $H$ 的第一列：\n$$\nH e_1 \\;=\\; \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n接下来，我们计算 $H^2 e_1 = H(H e_1)$：\n$$\nH^2 e_1 \\;=\\; H \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} \\quad (\\text{H 的第二列})\n$$\n现在，我们可以求出 $x_v$：\n$$\nx_v \\;=\\; \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n\n**步骤3：创建凸起**\n\n第一个正交变换 $Q_0$ 是使用一个Householder反射镜 $P_0$ 构造的，它作用于 $x_v$ 的前三个分量。设这个3维向量为 $x$：\n$$\nx \\;=\\; \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n问题指定反射镜应将 $x$ 映射到一个其第一个分量为非负的向量。这意味着目标向量是 $\\|x\\|_2 e_1$。\n$x$ 的范数是 $\\|x\\|_2 = \\sqrt{2^2 + 0^2 + 1^2} = \\sqrt{5}$。\nHouseholder向量 $v$ 由 $v = x - \\|x\\|_2 e_1$ 给出：\n$$\nv \\;=\\; \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\end{pmatrix} - \\sqrt{5} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 2 - \\sqrt{5} \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n$3 \\times 3$ 反射镜是 $P_0 = I - 2 \\frac{v v^\\top}{v^\\top v}$。我们通常在不显式构造矩阵的情况下应用其作用。\n第一个 $4 \\times 4$ 变换矩阵是 $Q_0 = \\mathrm{diag}(P_0, 1)$。\n我们将其作为相似变换应用于 $H$：\n$$\nH^{(1)} \\;=\\; Q_0 H Q_0 \\quad (\\text{因为 } Q_0 \\text{ 是对称反射镜})\n$$\n由于 $H$ 是对称的，$H^{(1)}$ 也将是对称的。变换 $Q_0$ 旨在在Hessenberg结构中创建一个“凸起”。对于对称矩阵，这意味着在三对角带之外创建非零项。让我们计算 $H^{(1)}$ 的第一列：\n$$\nH^{(1)}e_1 \\;=\\; Q_0 H Q_0 e_1\n$$\n首先，让我们求 $Q_0 e_1$。这涉及到将 $P_0$ 应用于 $e_1 \\in \\mathbb{R}^3$。\n$$\nP_0 e_1 \\;=\\; e_1 - 2\\frac{v^\\top e_1}{v^\\top v}v\n$$\n$v^\\top v = (2-\\sqrt{5})^2 + 0^2 + 1^2 = 4 - 4\\sqrt{5} + 5 + 1 = 10 - 4\\sqrt{5}$。\n$v^\\top e_1 = 2-\\sqrt{5}$。\n所以，$P_0 e_1 = e_1 - 2\\frac{2-\\sqrt{5}}{10-4\\sqrt{5}}v = e_1 - \\frac{2-\\sqrt{5}}{5-2\\sqrt{5}}v$。\n$\\frac{2-\\sqrt{5}}{5-2\\sqrt{5}} = \\frac{2-\\sqrt{5}}{-\\sqrt{5}(2-\\sqrt{5})} = -\\frac{1}{\\sqrt{5}}$。\n$P_0 e_1 = e_1 - (-\\frac{1}{\\sqrt{5}})v = e_1 + \\frac{1}{\\sqrt{5}}v = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 2-\\sqrt{5} \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 + \\frac{2}{\\sqrt{5}} - 1 \\\\ 0 \\\\ \\frac{1}{\\sqrt{5}} \\end{pmatrix} = \\begin{pmatrix} 2/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}$。\n所以，$Q_0 e_1 = (2/\\sqrt{5}, 0, 1/\\sqrt{5}, 0)^\\top$。\n现在，我们计算 $H (Q_0 e_1)$：\n$$\nH(Q_0 e_1) \\;=\\; H \\left( \\frac{2}{\\sqrt{5}}e_1 + \\frac{1}{\\sqrt{5}}e_3 \\right) \\;=\\; \\frac{2}{\\sqrt{5}} H e_1 + \\frac{1}{\\sqrt{5}} H e_3\n$$\n$He_1$ 是 $H$ 的第一列，$He_3$ 是第三列。\n$$\nH(Q_0 e_1) \\;=\\; \\frac{2}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 1 \\end{pmatrix} \\;=\\; \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n最后，我们将 $Q_0$ 应用于此向量：$H^{(1)}e_1 = Q_0 (H Q_0 e_1)$。\n$Q_0$ 作用于前三个分量。要变换的向量是 $(0, 3/\\sqrt{5}, 0)^T$。我们称之为 $u_1$。\nHouseholder向量 $v$ 的第二个分量为零 ($v_2=0$)，所以 $v^\\top u_1 = 0$。\n因此，$P_0 u_1 = u_1$。\n该变换不改变前三个分量。\n$$\nH^{(1)}e_1 \\;=\\; Q_0 \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix} \\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} P_0 \\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\end{pmatrix} \\\\ 1 \\end{pmatrix} \\;=\\; \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0 \\\\ 3/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}\n$$\n$H^{(1)}$ 的第一列有非零项 $h_{21}^{(1)} = 3/\\sqrt{5}$ 和 $h_{41}^{(1)} = 1/\\sqrt{5}$。元素 $h_{41}^{(1)}$ 是打破三对角结构的“凸起”。\n\n**步骤4：凸起追逐**\n\n下一步是消除凸起。这通过第二次相似变换 $H^{(2)} = Q_1 H^{(1)} Q_1$ 完成，其中 $Q_1$ 旨在将不需要的元素置零。为了消除 $h_{41}^{(1)}$，我们需要一个作用于第2、3、4行和列的正交变换。\n我们构造 $Q_1 = \\mathrm{diag}(1, P_1)$，其中 $P_1$ 是一个 $3 \\times 3$ 的Householder反射镜。\n$P_1$ 被选择作用于 $H^{(1)}$ 第一列从第二个元素开始的子向量。设这个向量为 $y$：\n$$\ny \\;=\\; \\begin{pmatrix} h_{21}^{(1)} \\\\ h_{31}^{(1)} \\\\ h_{41}^{(1)} \\end{pmatrix} \\;=\\; \\begin{pmatrix} 3/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}\n$$\n按照约定，$P_1$ 将 $y$ 映射到 $\\|y\\|_2 e_1$。\n$\\|y\\|_2 = \\sqrt{(3/\\sqrt{5})^2 + 0^2 + (1/\\sqrt{5})^2} = \\sqrt{9/5 + 1/5} = \\sqrt{10/5} = \\sqrt{2}$。\n所以，$P_1 y = \\sqrt{2} e_1 = (\\sqrt{2}, 0, 0)^\\top$。\n\n经过这一Francis步之后的最终矩阵是 $H^{(\\text{new})} = H^{(2)} = Q_1 H^{(1)} Q_1$。我们需要找到它的 $(2,1)$ 元素，$h_{21}^{(\\text{new})}$。这是 $H^{(2)}$ 第一列的第二个分量。\n$$\nH^{(2)}e_1 \\;=\\; Q_1 H^{(1)} Q_1 e_1\n$$\n由于 $Q_1 = \\mathrm{diag}(1, P_1)$，$Q_1 e_1 = e_1$。\n$$\nH^{(2)}e_1 \\;=\\; Q_1 (H^{(1)}e_1) \\;=\\; \\begin{pmatrix} 1  0 \\\\ 0  P_1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ y \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0 \\\\ P_1 y \\end{pmatrix}\n$$\n根据 $P_1$的构造，我们有 $P_1 y = \\sqrt{2} e_1 \\in \\mathbb{R}^3$。\n$$\nH^{(2)}e_1 \\;=\\; \\begin{pmatrix} 0 \\\\ \\sqrt{2} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n新矩阵 $H^{(\\text{new})}$ 的第一列是 $(0, \\sqrt{2}, 0, 0)^\\top$。\n更新后的次对角线元素是 $h_{21}^{(\\text{new})} = \\sqrt{2}$。这个变换恢复了Hessenberg形式（在这种情况下是三对角形式），从而完成了对 $4 \\times 4$ 矩阵的凸起追逐。\n\n$h_{21}^{(\\text{new})}$ 的精确解析值是最终答案。\n$$\nh_{21}^{(\\text{new})} \\;=\\; \\sqrt{2}\n$$",
            "answer": "$$\\boxed{\\sqrt{2}}$$"
        },
        {
            "introduction": "前面的练习侧重于单步迭代的力学原理，而这个实践 () 则将视角提升到算法的收敛性上。你将通过编程实现并对比一个朴素的QR算法与先进的Francis双位移策略。通过构建一些特定设计的测试案例，你会发现朴素方法在何种情况下会收敛缓慢甚至失败，从而深刻体会到为何双位移策略是计算一般实矩阵特征值的工业标准。",
            "id": "3577262",
            "problem": "您需要研究正交-三角（QR）算法中的位移策略如何影响上海森伯格（upper Hessenberg）矩阵的收敛性，方法是构造一个在不良位移下表现出循环或进展极其缓慢的近乎病态的案例，然后展示一种修复方法。您必须从以下基础出发推导您的方法：对于一个方阵 $A \\in \\mathbb{R}^{n \\times n}$，一个相似变换 $A \\mapsto Q^\\top A Q$（其中 $Q$ 是正交矩阵）保持特征值不变；正交-三角（QR）分解将一个满秩矩阵 $M$ 写成 $M = Q R$ 的形式，其中 $Q$ 是正交矩阵，$R$ 是上三角矩阵；QR算法迭代地将此类相似变换应用于 $A$（或与 $A$ 相似的上海森伯格形式 $H$），以将次对角线元素驱动为 $0$ 并在对角线上揭示特征值；而一个带位移的QR步骤将QR分解应用于 $A - s I$（其中位移量 $s \\in \\mathbb{R}$），并通过 $A \\leftarrow R Q + s I$ 更新 $A$。您的任务是构造并测试一个案例，其中一个不良的单位移选择导致循环或进展极其缓慢，并实现一个双位移（Francis）修复方法，以恢复稳健的收敛性。\n\n具体来说，请在上海森伯格矩阵上实现两种策略：\n- 一个不良的单位移策略：始终使用固定的位移 $s = 0$，因此更新为 $H \\leftarrow R Q$，其中 $H - 0 \\cdot I = Q R$。\n- 一个实隐式双位移（Francis）策略：令当前 $H$ 的尾部 $2 \\times 2$ 子块为 $T$，并定义实二次多项式 $p(\\lambda) = \\lambda^2 - (\\operatorname{tr}(T)) \\lambda + \\det(T)$。通过QR分解 $p(H) = Q R$ 得到的正交因子 $Q$ 实现一个隐式双位移步骤，然后更新 $H \\leftarrow Q^\\top H Q$。这利用了隐式Q定理，在保持实数运算的同时，实现了对应于尾部子块的（可能是共轭复数）特征值的两次位移。\n\n通过跟踪最后一个次对角线元素的大小 $|H_{n,n-1}|$ 来衡量进展；当 $|H_{n,n-1}|  \\tau$（其中 $\\tau > 0$ 是一个容差）时，声明发生“紧缩”（deflation），然后记录达到第一次紧缩所需的迭代次数。如果矩阵在开始时就已经紧缩（即初始时 $|H_{n,n-1}|  \\tau$），则迭代计数为 $0$。如果在指定的迭代预算 $K$ 内没有发生紧缩，则将计数记录为 $K$。\n\n构造以下矩阵和参数的测试套件：\n- 测试案例1（近乎病态的正交上海森伯格矩阵）：通过对一个高斯随机矩阵进行QR分解，生成一个随机正交矩阵 $Q_1 \\in \\mathbb{R}^{12 \\times 12}$，并通过正交相似变换（使用Hessenberg约简）将其约简为上海森伯格形式 $H_1 = Z^\\top Q_1 Z$。由于 $H_1$ 是正交的，固定的不良位移 $s=0$ 将导致循环，$H \\leftarrow R Q = H$（无变化）。双位移策略应能打破循环。\n- 测试案例2（带有共轭复数对的非正常矩阵）：构建一个 $A_2 \\in \\mathbb{R}^{10 \\times 10}$ 矩阵，它是一个分块对角矩阵，其中包含一个 $2 \\times 2$ 的旋转-缩放块 $R = r \\begin{bmatrix} \\cos(\\theta)  \\sin(\\theta) \\\\ -\\sin(\\theta)  \\cos(\\theta) \\end{bmatrix}$（其中 $r = 1.01$，$\\theta = 0.3$，角度以弧度为单位），其余对角线元素为 $3.0, 2.5, 2.0, 1.5, 1.0, 0.2, -0.3, -1.0$。通过Hessenberg约简将 $A_2$ 约简为上海森伯格形式 $H_2$。固定的不良位移 $s=0$ 与尾部结构不匹配，而双位移策略应通过针对嵌入的共轭复数对来加速进展。\n- 测试案例3（边界对角线案例）：取一个 $A_3 \\in \\mathbb{R}^{5 \\times 5}$ 对角矩阵，其对角线元素为 $5.0, 4.0, 3.0, 2.0, 1.0$。由于 $A_3$ 已经紧缩（所有次对角线元素均为 $0$），两种策略都应报告 $0$ 次迭代。\n\n对所有测试案例使用容差 $\\tau = 10^{-10}$ 和迭代预算 $K = 200$。对于每个矩阵 $H_i$（$i \\in \\{1,2,3\\}$），运行不良单位移策略以获得首次紧缩前的迭代次数 $N_i^{\\text{poor}}$（如果未发生紧缩，则为 $K$），并运行实隐式双位移（Francis）策略以获得迭代次数 $N_i^{\\text{fix}}$。将结果汇总到最终输出中，形式为包含列表 $[N_1^{\\text{poor}}, N_1^{\\text{fix}}, N_2^{\\text{poor}}, N_2^{\\text{fix}}, N_3^{\\text{poor}}, N_3^{\\text{fix}}]$ 的单行。\n\n您的程序必须以该格式精确地产生一行输出。构造中的所有角度必须以弧度为单位。不涉及物理单位。输出仅包含整数。",
            "solution": "用户的请求是验证一个关于特征值计算的QR算法收敛性的数值线性代数问题，并在有效的情况下解决它。核心任务是实现并比较一种不良的单位移策略与更稳健的实隐式双位移（Francis）策略，并在三个特定的上海森伯格矩阵上进行测试。\n\n该问题是 **有效的**。它在科学上基于数值线性代数的既定原则，问题陈述清晰（well-posed），所有必要的数据和参数都已提供，并且是客观的。对QR算法、位移策略和测试案例构造的描述是正确且标准的。\n\n解决方案将首先详细介绍两种算法策略，然后将它们应用于指定的测试案例，并按指示测量收敛性。\n\n**1. 算法策略**\n\nQR算法通过迭代将矩阵 $A$ 精化为一种能够揭示其特征值的形式（拟上三角矩阵或Schur形式）。为提高效率，首先通过相似变换 $H = U^\\top A U$ 将 $A$ 约简为上海森伯格形式 $H$，该变换保持特征值不变。所有后续的QR迭代都在 $H$ 上执行，它会保持其海森伯格结构，从而将每次迭代的计算成本从 $O(n^3)$ 降低到 $O(n^2)$。\n\n**1.1. 不良的单位移策略**\n\n这是带位移的QR算法的最简单版本。一次迭代包括选择一个位移 $s \\in \\mathbb{R}$，对位移后的矩阵执行QR分解，然后反转乘法以完成相似变换。\n\n给定当前的海森伯格矩阵 $H_k$，下一个迭代矩阵 $H_{k+1}$ 的计算方式如下：\n1.  选择一个位移 $s$。问题指定了一个固定的、“不良”的位移 $s=0$。\n2.  计算（未位移的）矩阵的QR分解：$H_k = Q_k R_k$。\n3.  更新矩阵：$H_{k+1} = R_k Q_k$。\n\n这个更新是一个相似变换，因为 $R_k = Q_k^\\top H_k$，所以 $H_{k+1} = Q_k^\\top H_k Q_k$。因此，特征值得以保留。通过监控次对角线元素来衡量收敛性。具体来说，我们可以观察元素 $|H_{n,n-1}|$。如果该元素变得可以忽略不计，则最后一个对角元素 $H_{n,n}$ 被认为是一个收敛的特征值，问题可以通过考虑前导的 $(n-1) \\times (n-1)$ 子矩阵来进行“紧缩”（deflated）。众所周知，这种策略在某些情况下收敛缓慢或完全失败，例如对于具有等模特征值的矩阵（如正交矩阵）或具有共轭复数特征值对的矩阵。\n\n**1.2. 实隐式双位移（Francis）策略**\n\n该策略旨在克服单位移方法的缺点，特别是对于具有共轭复数特征值的实矩阵。它隐式地执行两个连续的QR步骤，其位移 $s_1$ 和 $s_2$ 是共轭复数，但仅使用实数算术来完成。\n\n关键思想是选择位移 $s_1$ 和 $s_2$ 为当前海森伯格矩阵 $H_k$ 的尾部 $2 \\times 2$ 子矩阵的特征值：\n$$\nT =\n\\begin{bmatrix}\nH_{n-1, n-1}  H_{n-1, n} \\\\\nH_{n, n-1}  H_{n, n}\n\\end{bmatrix}\n$$\n$T$ 的特征值是实二次多项式 $p(\\lambda) = \\lambda^2 - \\operatorname{tr}(T)\\lambda + \\det(T)$ 的根。这些根 $s_1$ 和 $s_2$ 是极好的位移选择，因为它们通常是整个矩阵 $H_k$ 的一对特征值的良好近似。\n\n直接应用两个QR步骤将是：\n1.  $H_k - s_1 I = Q_1 R_1 \\implies H' = R_1 Q_1 + s_1 I = Q_1^\\top H_k Q_1$\n2.  $H' - s_2 I = Q_2 R_2 \\implies H_{k+1} = R_2 Q_2 + s_2 I = Q_2^\\top H' Q_2$\n\n如果 $s_1$ 和 $s_2$ 是复数，这将需要复数算术。Francis 策略避免了这一点。组合变换为 $H_{k+1} = (Q_1 Q_2)^\\top H_k (Q_1 Q_2)$。隐式Q定理指出，正交矩阵 $Q = Q_1 Q_2$ 基本上由矩阵乘积 $M = (H_k - s_2 I)(H_k - s_1 I) = p(H_k)$ 的第一列确定。\n\n根据问题描述，这将通过以下方式实现：\n1.  形成矩阵 $M = p(H_k) = H_k^2 - \\operatorname{tr}(T)H_k + \\det(T)I$。\n2.  计算该矩阵的QR分解：$M = QR$。\n3.  使用该正交因子 $Q$ 应用相似变换：$H_{k+1} = Q^\\top H_k Q$。\n\n这个过程正确地应用了双位移变换，并且由于 $p(\\lambda)$ 具有实系数，矩阵 $M$ 是实数矩阵，整个计算过程都保持在实数算术中。\n\n**2. 测试套件和预期结果**\n\n当第一次迭代 $k$ 满足 $|(H_k)_{n,n-1}|  \\tau$（其中 $\\tau=10^{-10}$）时，宣布收敛。报告迭代次数，上限为预算 $K=200$。\n\n*   **测试案例1（正交海森伯格矩阵）：** 将一个随机实正交矩阵 $Q_1 \\in \\mathbb{R}^{12 \\times 12}$ 约简为上海森伯格形式 $H_1$。由于 $H_1$ 本身是正交的，其特征值位于复平面的单位圆上。对于不良的单位移策略（$s=0$），$H_1$ 的QR分解为 $H_1 = Q R$，其中 $Q=H_1$，$R=I$（符号可能不同）。下一个迭代矩阵为 $H_{\\text{new}} = R Q = I H_1 = H_1$。该算法毫无进展并将循环，达到迭代预算 $K=200$。Francis双位移将使用从尾部块派生的非零位移，打破循环并快速收敛。\n\n*   **测试案例2（非正常矩阵）：** 构造一个矩阵 $A_2 \\in \\mathbb{R}^{10 \\times 10}$，它具有一对共轭复数特征值 $1.01 e^{\\pm i 0.3}$ 和其他几个实特征值。在约简为海森伯格形式 $H_2$ 后，不良位移 $s=0$ 远离任何特征值，这预示着缓慢的线性收敛。Francis策略根据其设计，能有效针对特征值对（包括共轭复数对），并预期表现出非常快速的、近乎二次的收敛速度。\n\n*   **测试案例3（对角矩阵）：** 一个对角矩阵 $A_3 \\in \\mathbb{R}^{5 \\times 5}$ 已经是上海森伯格形式，并且是完全紧缩的，因为其所有次对角线元素都为零。条件 $|(H_3)_{n,n-1}| = |(A_3)_{5,4}| = 0  \\tau$ 在开始时就已满足。因此，两种算法都应正确识别这一点并报告 $0$ 次迭代。\n\n现在，实现将在指定的测试案例上执行这些过程。",
            "answer": "```python\nimport numpy as np\nimport scipy.linalg\n\ndef solve():\n    \"\"\"\n    Implements and compares a poor single-shift QR strategy with the\n    Francis double-shift QR strategy on three test cases.\n    \"\"\"\n    \n    K = 200  # Iteration budget\n    tau = 1e-10  # Deflation tolerance\n\n    def run_poor_single_shift(H_orig):\n        \"\"\"\n        Runs the QR algorithm with a fixed shift s=0.\n        \"\"\"\n        H = H_orig.copy()\n        n = H.shape[0]\n\n        # Check for initial deflation\n        if n  2 or abs(H[n - 1, n - 2])  tau:\n            return 0\n\n        for i in range(K):\n            # QR factorization of H (since s=0)\n            Q, R = scipy.linalg.qr(H, mode='full')\n            \n            # Update H - RQ\n            H = R @ Q\n\n            # Check for deflation\n            if abs(H[n - 1, n - 2])  tau:\n                return i + 1\n        \n        return K\n\n    def run_francis_double_shift(H_orig):\n        \"\"\"\n        Runs the QR algorithm with the implicit Francis double-shift strategy.\n        \"\"\"\n        H = H_orig.copy()\n        n = H.shape[0]\n\n        # Check for initial deflation\n        if n  2 or abs(H[n - 1, n - 2])  tau:\n            return 0\n\n        for i in range(K):\n            # Get the trailing 2x2 block\n            T = H[n - 2:, n - 2:]\n            \n            # Compute trace and determinant for the characteristic polynomial\n            tr_T = np.trace(T)\n            det_T = np.linalg.det(T)\n            \n            # Form p(H) = H^2 - tr(T)*H + det(T)*I\n            # This is the matrix whose QR factorization gives the implicit Q\n            I = np.identity(n)\n            p_H = H @ H - tr_T * H + det_T * I\n\n            # QR factorization of p(H) to get the transformation matrix Q\n            Q, _ = scipy.linalg.qr(p_H, mode='full')\n            \n            # Update H - Q^T * H * Q\n            H = Q.T @ H @ Q\n\n            # Check for deflation\n            if abs(H[n - 1, n - 2])  tau:\n                return i + 1\n        \n        return K\n\n    results = []\n\n    # Test Case 1: Near-pathological orthogonal upper Hessenberg matrix\n    np.random.seed(0) # for reproducibility\n    n1 = 12\n    # Generate a random orthogonal matrix\n    M1_rand = np.random.randn(n1, n1)\n    Q1_ortho, _ = np.linalg.qr(M1_rand)\n    # Reduce to upper Hessenberg form\n    H1 = scipy.linalg.hessenberg(Q1_ortho)\n    \n    n1_poor = run_poor_single_shift(H1)\n    n1_fix = run_francis_double_shift(H1)\n    results.extend([n1_poor, n1_fix])\n\n    # Test Case 2: Nonnormal matrix with a complex conjugate pair\n    n2 = 10\n    r = 1.01\n    theta = 0.3\n    # Rotation-scaling block with complex eigenvalues\n    R_block = r * np.array([\n        [np.cos(theta), np.sin(theta)],\n        [-np.sin(theta), np.cos(theta)]\n    ])\n    diag_entries = [3.0, 2.5, 2.0, 1.5, 1.0, 0.2, -0.3, -1.0]\n    # Construct block diagonal matrix A2\n    A2 = scipy.linalg.block_diag(R_block, np.diag(diag_entries))\n    # Reduce to upper Hessenberg form\n    H2 = scipy.linalg.hessenberg(A2)\n\n    n2_poor = run_poor_single_shift(H2)\n    n2_fix = run_francis_double_shift(H2)\n    results.extend([n2_poor, n2_fix])\n\n    # Test Case 3: Boundary diagonal case\n    n3 = 5\n    # A3 is already in upper Hessenberg form and is deflated\n    A3 = np.diag([5.0, 4.0, 3.0, 2.0, 1.0])\n    H3 = A3\n\n    n3_poor = run_poor_single_shift(H3)\n    n3_fix = run_francis_double_shift(H3)\n    results.extend([n3_poor, n3_fix])\n\n    # Print the final aggregated results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}