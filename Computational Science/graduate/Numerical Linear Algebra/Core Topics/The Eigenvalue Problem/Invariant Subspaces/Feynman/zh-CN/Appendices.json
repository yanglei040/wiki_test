{
    "hands_on_practices": [
        {
            "introduction": "理解不变子空间的第一步是能够在一个具体的例子中识别并列举它们。这个练习  提供了一个简单的 $3 \\times 3$ 矩阵，它包含一个 Jordan 块，要求你从基本定义出发，找出其所有的不变子空间和约化子空间。通过这个过程，你将加深对矩阵结构（特别是 Jordan 结构）如何决定其不变子空间格的理解，并明确不变子空间与更特殊的约化子空间之间的区别。",
            "id": "3551519",
            "problem": "设 $A \\in \\mathbb{R}^{3 \\times 3}$ 作用于配备了标准欧几里得内积的 $\\mathbb{R}^{3}$，其中\n$$\nA=\\begin{bmatrix} 2  1  0 \\\\ 0  2  0 \\\\ 0  0  3 \\end{bmatrix}.\n$$\n一个子空间 $W \\subseteq \\mathbb{R}^{3}$ 被称为 $A$-不变子空间，如果 $A W \\subseteq W$。一个子空间 $W$ 被称为 $A$ 的约化子空间，如果 $W$ 及其正交补 $W^{\\perp}$ 都是 $A$-不变的；等价地，$W$ 对于 $A$ 及其关于给定内积的伴随算子 $A^{\\ast}$ 都是不变的。\n\n仅从这些定义和 $A$ 的结构出发，推导出 $\\mathbb{R}^{3}$ 的所有 $A$-不变子空间，并确定其中哪些是约化子空间。然后计算有序对 $(N_{\\mathrm{inv}}, N_{\\mathrm{red}})$，其中 $N_{\\mathrm{inv}}$ 是 $A$-不变子空间的总数，$N_{\\mathrm{red}}$ 是约化子空间的总数，计算时包括平凡子空间 $\\{0\\}$ 和 $\\mathbb{R}^{3}$。请以该有序对的形式给出最终答案。无需四舍五入，也无需使用单位。",
            "solution": "该问题要求确定并枚举给定矩阵 $A \\in \\mathbb{R}^{3 \\times 3}$ 的所有 $A$-不变子空间和约化子空间。设 $\\mathbb{R}^3$ 的标准基为 $\\{e_1, e_2, e_3\\}$，其中 $e_1 = (1, 0, 0)^T$, $e_2 = (0, 1, 0)^T$, $e_3 = (0, 0, 1)^T$。\n\n首先，我们分析矩阵 $A$ 的结构：\n$$\nA=\\begin{bmatrix} 2  1  0 \\\\ 0  2  0 \\\\ 0  0  3 \\end{bmatrix}\n$$\n特征多项式为 $\\det(A - \\lambda I) = (2-\\lambda)^2(3-\\lambda)$。特征值为 $\\lambda_1 = 2$（代数重数为 $m_1 = 2$）和 $\\lambda_2 = 3$（代数重数为 $m_2 = 1$）。\n\n$A$ 的一个不变子空间是子空间 $W \\subseteq \\mathbb{R}^3$，满足对所有 $w \\in W$ 都有 $Aw \\in W$。线性算子理论指出，$A$ 的任何不变子空间 $W$ 都可以分解为其与 $A$ 的广义特征空间的交集的直和。设 $G_{\\lambda}(A) = \\ker((A - \\lambda I)^m)$ 是对应于代数重数为 $m$ 的特征值 $\\lambda$ 的广义特征空间。则 $W = (W \\cap G_{2}(A)) \\oplus (W \\cap G_{3}(A))$。\n\n我们来确定 $A$ 的广义特征空间。\n对于 $\\lambda_1 = 2$：\n$$\nA - 2I = \\begin{bmatrix} 0  1  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{bmatrix}\n$$\n特征空间为 $E_2 = \\ker(A-2I) = \\text{span}\\{e_1\\}$。\n广义特征空间为 $G_2(A) = \\ker((A-2I)^2)$。\n$$\n(A-2I)^2 = \\begin{bmatrix} 0  1  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{bmatrix}\\begin{bmatrix} 0  1  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{bmatrix} = \\begin{bmatrix} 0  0  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{bmatrix}\n$$\n$(A-2I)^2$ 的零空间是满足 $z=0$ 的向量 $(x, y, z)^T$ 的集合。因此，$G_2(A) = \\text{span}\\{e_1, e_2\\}$。\n\n对于 $\\lambda_2 = 3$：\n代数重数为 $1$，因此广义特征空间与特征空间相同。\n$$\nA - 3I = \\begin{bmatrix} -1  1  0 \\\\ 0  -1  0 \\\\ 0  0  0 \\end{bmatrix}\n$$\n零空间由 $-x+y=0$ 和 $-y=0$ 给出，这意味着 $x=y=0$。因此，$G_3(A) = E_3 = \\ker(A-3I) = \\text{span}\\{e_3\\}$。\n\n现在，我们求出 $A$ 在其广义特征空间上的限制算子的不变子空间。\n1. 包含在 $G_3(A) = \\text{span}\\{e_3\\}$ 中的 $A$ 的不变子空间：由于这是一个一维特征空间，仅有的不变子空间是 $\\{0\\}$ 和 $G_3(A)$ 本身。共有 $2$ 个这样的子空间。\n\n2. 包含在 $G_2(A) = \\text{span}\\{e_1, e_2\\}$ 中的 $A$ 的不变子空间：$A$ 在 $G_2(A)$ 上的限制在基 $\\{e_1, e_2\\}$ 下的矩阵为 $A_2 = \\begin{bmatrix} 2  1 \\\\ 0  2 \\end{bmatrix}$。该算子的不变子空间有：\n   - $0$ 维子空间：$\\{0\\}$。\n   - 任何 $1$ 维不变子空间都必须是特征空间。唯一的特征值是 $2$，对应的特征空间是 $\\ker(A_2-2I) = \\ker(\\begin{bmatrix} 0  1 \\\\ 0  0 \\end{bmatrix}) = \\text{span}\\{e_1\\}$。\n   - $2$ 维子空间：$G_2(A)$ 本身。\n   因此，包含在 $G_2(A)$ 中的不变子空间有 $3$ 个。\n\n任意一个 $A$-不变子空间 $W$ 都是 $G_2(A)$ 中的一个不变子空间与 $G_3(A)$ 中的一个不变子空间的直和。$A$-不变子空间的总数是每个广义特征空间中此类子空间数量的乘积。\n$N_{\\mathrm{inv}} = 3 \\times 2 = 6$。\n$A$-不变子空间是：\n\\begin{enumerate}\n    \\item $\\{0\\} \\oplus \\{0\\} = \\{0\\}$\n    \\item $\\{0\\} \\oplus \\text{span}\\{e_3\\} = \\text{span}\\{e_3\\}$\n    \\item $\\text{span}\\{e_1\\} \\oplus \\{0\\} = \\text{span}\\{e_1\\}$\n    \\item $\\text{span}\\{e_1\\} \\oplus \\text{span}\\{e_3\\} = \\text{span}\\{e_1, e_3\\}$\n    \\item $\\text{span}\\{e_1, e_2\\} \\oplus \\{0\\} = \\text{span}\\{e_1, e_2\\}$\n    \\item $\\text{span}\\{e_1, e_2\\} \\oplus \\text{span}\\{e_3\\} = \\mathbb{R}^3$\n\\end{enumerate}\n\n接下来，我们确定约化子空间。一个子空间 $W$ 是 $A$ 的约化子空间，如果它在 $A$ 及其伴随算子 $A^*$ 下都是不变的。由于我们使用的是标准欧几里得内积，所以 $A^* = A^T$。\n$$\nA^T = \\begin{bmatrix} 2  0  0 \\\\ 1  2  0 \\\\ 0  0  3 \\end{bmatrix}\n$$\n一个子空间是约化的，当且仅当它既是 $A$ 的不变子空间，也是 $A^T$ 的不变子空间。我们来找出 $A^T$ 的不变子空间。$A^T$ 的特征值与 $A$ 的相同：$\\lambda_1 = 2$ 和 $\\lambda_2 = 3$。\n\n$A^T$ 的广义特征空间是：\n对于 $\\lambda_1=2$：\n$$\nA^T - 2I = \\begin{bmatrix} 0  0  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{bmatrix}\n$$\n特征空间为 $E'_2 = \\ker(A^T-2I) = \\text{span}\\{e_2\\}$。\n广义特征空间 $G_2(A^T) = \\ker((A^T-2I)^2)$。\n$$\n(A^T-2I)^2 = \\begin{bmatrix} 0  0  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{bmatrix}\n$$\n零空间是满足 $z=0$ 的空间，所以 $G_2(A^T) = \\text{span}\\{e_1, e_2\\}$。\n\n对于 $\\lambda_2=3$：$G_3(A^T) = \\ker(A^T-3I) = \\text{span}\\{e_3\\}$。\n\n$A^T$ 的不变子空间可以用类似的方法构造。\n1. 在 $G_3(A^T) = \\text{span}\\{e_3\\}$ 内的不变子空间是 $\\{0\\}$ 和 $\\text{span}\\{e_3\\}$。（$2$ 个子空间）\n2. 在 $G_2(A^T) = \\text{span}\\{e_1, e_2\\}$ 内的不变子空间：$A^T$ 在此空间上的限制矩阵为 $A^T_2 = \\begin{bmatrix} 2  0 \\\\ 1  2 \\end{bmatrix}$。\n   - $\\{0\\}$\n   - $1$ 维不变子空间（特征空间）是 $\\ker(A^T_2-2I) = \\ker(\\begin{bmatrix} 0  0 \\\\ 1  0 \\end{bmatrix}) = \\text{span}\\{e_2\\}$。\n   - $G_2(A^T)$ 本身。\n   共有 $3$ 个这样的子空间。\n\n$A^T$-不变子空间是：\n\\begin{enumerate}\n    \\item $\\{0\\}$\n    \\item $\\text{span}\\{e_3\\}$\n    \\item $\\text{span}\\{e_2\\}$\n    \\item $\\text{span}\\{e_2, e_3\\}$\n    \\item $\\text{span}\\{e_1, e_2\\}$\n    \\item $\\mathbb{R}^3$\n\\end{enumerate}\n\n$A$ 的约化子空间是两个不变子空间列表中共有的子空间。\n比较这两个列表：\n- $\\{0\\}$ 是共有的。\n- $\\text{span}\\{e_3\\}$ 是共有的。\n- $\\text{span}\\{e_1\\}$ 仅是 $A$-不变的。\n- $\\text{span}\\{e_1, e_3\\}$ 仅是 $A$-不变的。\n- $\\text{span}\\{e_1, e_2\\}$ 是共有的。\n- $\\mathbb{R}^3$ 是共有的。\n- $\\text{span}\\{e_2\\}$ 仅是 $A^T$-不变的。\n- $\\text{span}\\{e_2, e_3\\}$ 仅是 $A^T$-不变的。\n\n约化子空间是 $\\{0\\}$, $\\text{span}\\{e_3\\}$, $\\text{span}\\{e_1, e_2\\}$ 和 $\\mathbb{R}^3$。\n共有 $N_{\\mathrm{red}} = 4$ 个约化子空间。\n\n约化子空间 $W$ 的一个等价定义是 $W$ 及其正交补 $W^\\perp$ 都是 $A$-不变的。\n- 对于 $W = \\{0\\}$，$W^\\perp = \\mathbb{R}^3$。两者都是 $A$-不变的。\n- 对于 $W = \\mathbb{R}^3$，$W^\\perp = \\{0\\}$。两者都是 $A$-不变的。\n- 对于 $W = \\text{span}\\{e_3\\}$，$W^\\perp = \\text{span}\\{e_1, e_2\\}$。两者都在 $A$-不变子空间列表中。\n- 对于 $W = \\text{span}\\{e_1, e_2\\}$，$W^\\perp = \\text{span}\\{e_3\\}$。两者都在 $A$-不变子空间列表中。\n\n这确认了有四个约化子空间。\n\n$A$-不变子空间的总数是 $N_{\\mathrm{inv}} = 6$。约化子空间的总数是 $N_{\\mathrm{red}} = 4$。\n所求的有序对是 $(N_{\\mathrm{inv}}, N_{\\mathrm{red}})$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n6  4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "不变子空间在数值线性代数中至关重要，因为它们允许我们将大问题分解为小问题。这个练习  将理论与实践相结合，演示了如何利用一个已知的二维不变子空间，通过 QR 分解和一个相似变换，将一个 $5 \\times 5$ 矩阵转化为上三角分块形式。这个过程是许多特征值算法（如 QR 算法）的核心，它直观地展示了不变子空间如何简化矩阵的结构。",
            "id": "3551527",
            "problem": "设 $A \\in \\mathbb{C}^{5 \\times 5}$ 和 $V \\in \\mathbb{C}^{5 \\times 2}$ 为\n$$\nA \\;=\\;\n\\begin{pmatrix}\n2  1  -1  0  0 \\\\\n0  3  0  4  0 \\\\\n5  -2  0  0  1 \\\\\n0  0  0  -1  0 \\\\\n0  7  0  0  2\n\\end{pmatrix},\n\\qquad\nV \\;=\\;\n\\begin{pmatrix}\n1  1 \\\\\n0  0 \\\\\n1  -1 \\\\\n0  0 \\\\\n0  0\n\\end{pmatrix}.\n$$\n假设 $V$ 的列构成一个二维 $A$-不变子空间的基，因此存在 $T \\in \\mathbb{C}^{2 \\times 2}$ 使得 $A V = V T$。仅使用数值线性代数的基本原理，执行以下步骤：\n\n1. 通过确定矩阵 $T$ 使得 $A V = V T$，验证 $A V$ 位于 $V$ 的值域中。\n\n2. 计算 $V$ 的瘦QR分解（正交三角分解），即 $V = Q R$，其中 $Q \\in \\mathbb{C}^{5 \\times 2}$ 具有标准正交列，而 $R \\in \\mathbb{C}^{2 \\times 2}$ 是上三角矩阵。\n\n3. 通过添加与 $\\mathrm{range}(Q)$ 正交的三个标准正交列 $Q_{\\perp} \\in \\mathbb{C}^{5 \\times 3}$，将 $Q$ 扩展为一个酉基 $\\widehat{Q} \\in \\mathbb{C}^{5 \\times 5}$。例如，可以选择标准基向量 $e_2, e_4, e_5$ 作为 $Q_{\\perp}$ 的列。构造相似变换 $\\widehat{Q}^{*} A \\widehat{Q}$，其中 $(\\cdot)^{*}$ 表示共轭转置。\n\n4. 使用不变性和计算出的因子，证明 $\\widehat{Q}^{*} A \\widehat{Q}$ 是分块上三角矩阵，并明确计算其左上角的 $2 \\times 2$ 子块。\n\n报告 $\\widehat{Q}^{*} A \\widehat{Q}$ 的左上角 $2 \\times 2$ 子块的行列式作为你的最终答案。以精确值形式表示你的最终答案（不要四舍五入）。",
            "solution": "**1. 验证不变性并确定T**\n\n设 $V$ 的列为 $v_1$ 和 $v_2$：\n$$\nv_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad v_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$V$ 的列空间（记作 $\\mathrm{range}(V)$）是 $A$-不变子空间的陈述意味着，对于任何向量 $x \\in \\mathrm{range}(V)$，向量 $Ax$ 也位于 $\\mathrm{range}(V)$ 中。只需对基向量 $v_1$ 和 $v_2$ 进行检验即可。\n\n首先，我们计算乘积 $AV$：\n$$\nA v_1 = \\begin{pmatrix} 2  1  -1  0  0 \\\\ 0  3  0  4  0 \\\\ 5  -2  0  0  1 \\\\ 0  0  0  -1  0 \\\\ 0  7  0  0  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2-1 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\nA v_2 = \\begin{pmatrix} 2  1  -1  0  0 \\\\ 0  3  0  4  0 \\\\ 5  -2  0  0  1 \\\\ 0  0  0  -1  0 \\\\ 0  7  0  0  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2+1 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n所以，矩阵 $AV$ 是：\n$$\nAV = \\begin{pmatrix} 1  3 \\\\ 0  0 \\\\ 5  5 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}\n$$\n要使 $\\mathrm{range}(V)$ 是 $A$-不变的， $AV$ 的列（$Av_1$ 和 $Av_2$）必须是 $V$ 的列（$v_1$ 和 $v_2$）的线性组合。这些线性组合的系数构成了矩阵 $T = \\begin{pmatrix} t_{11}  t_{12} \\\\ t_{21}  t_{22} \\end{pmatrix}$，使得 $Av_1 = t_{11}v_1 + t_{21}v_2$ 且 $Av_2 = t_{12}v_1 + t_{22}v_2$。\n\n对于 $Av_1$：\n$$\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix} = t_{11} \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + t_{21} \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} t_{11}+t_{21} \\\\ 0 \\\\ t_{11}-t_{21} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到方程组：$t_{11}+t_{21} = 1$ 和 $t_{11}-t_{21} = 5$。两式相加得到 $2t_{11}=6 \\implies t_{11}=3$。两式相减得到 $2t_{21}=-4 \\implies t_{21}=-2$。\n\n对于 $Av_2$：\n$$\n\\begin{pmatrix} 3 \\\\ 0 \\\\ 5 \\\\ 0 \\\\ 0 \\end{pmatrix} = t_{12} \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + t_{22} \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} t_{12}+t_{22} \\\\ 0 \\\\ t_{12}-t_{22} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到方程组：$t_{12}+t_{22} = 3$ 和 $t_{12}-t_{22} = 5$。两式相加得到 $2t_{12}=8 \\implies t_{12}=4$。两式相减得到 $2t_{22}=-2 \\implies t_{22}=-1$。\n\n因此，$AV$ 位于 $V$ 的值域中，矩阵 $T$ 为：\n$$\nT = \\begin{pmatrix} 3  4 \\\\ -2  -1 \\end{pmatrix}\n$$\n\n**2. V的瘦QR分解**\n\n我们对 $V=[v_1, v_2]$ 的列应用格拉姆-施密特过程来求得 $Q=[q_1, q_2]$ 和 $R$。\n第一列 $q_1$：\n$$\nr_{11} = \\|v_1\\|_2 = \\sqrt{1^2+0^2+1^2+0^2+0^2} = \\sqrt{2}\n$$\n$$\nq_1 = \\frac{v_1}{r_{11}} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n第二列 $q_2$：\n非对角元素 $r_{12}$ 是：\n$$\nr_{12} = q_1^* v_2 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{2}}(1-1) = 0\n$$\n列 $v_1$ 和 $v_2$ 是正交的。我们计算基的下一个正交向量：\n$$\nw_2 = v_2 - r_{12} q_1 = v_2 - 0 \\cdot q_1 = v_2\n$$\n对角元素 $r_{22}$ 是：\n$$\nr_{22} = \\|w_2\\|_2 = \\|v_2\\|_2 = \\sqrt{1^2+0^2+(-1)^2+0^2+0^2} = \\sqrt{2}\n$$\n$$\nq_2 = \\frac{w_2}{r_{22}} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n瘦QR分解 $V = QR$ 由以下给出：\n$$\nQ = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  1 \\\\ 0  0 \\\\ 1  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}, \\quad R = \\begin{pmatrix} \\sqrt{2}  0 \\\\ 0  \\sqrt{2} \\end{pmatrix}\n$$\n\n**3. 扩展为酉基**\n\n矩阵 $Q \\in \\mathbb{C}^{5 \\times 2}$ 有两个标准正交列，它们张成与 $V$ 相同的不变子空间。我们将这个基扩展为 $\\mathbb{C}^5$ 的一个完整酉基 $\\widehat{Q} \\in \\mathbb{C}^{5 \\times 5}$。问题建议添加标准基向量 $e_2, e_4, e_5$。\n设 $Q_{\\perp} = [e_2, e_4, e_5] = \\begin{pmatrix} 0  0  0 \\\\ 1  0  0 \\\\ 0  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}$。\n$Q$ 的列仅在第一和第三分量上有非零项。$Q_\\perp$ 的列在第二、第四和第五分量上有非零项。因此，$Q^* Q_{\\perp} = 0$，这意味着 $Q_\\perp$ 的列与 $Q$ 的值域正交。由于 $Q_\\perp$ 的列也是标准正交的，所以 $\\widehat{Q} = [Q, Q_{\\perp}]$ 是一个酉矩阵。\n$$\n\\widehat{Q} = \\begin{pmatrix}\n\\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{2}}  0  0  0 \\\\\n0  0  1  0  0 \\\\\n\\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}}  0  0  0 \\\\\n0  0  0  1  0 \\\\\n0  0  0  0  1\n\\end{pmatrix}\n$$\n相似变换为 $\\widehat{Q}^{*} A \\widehat{Q}$，可以写成分块形式：\n$$\n\\widehat{Q}^{*} A \\widehat{Q} = \\begin{pmatrix} Q^* \\\\ Q_{\\perp}^* \\end{pmatrix} A \\begin{pmatrix} Q  Q_{\\perp} \\end{pmatrix} = \\begin{pmatrix} Q^* A Q  Q^* A Q_{\\perp} \\\\ Q_{\\perp}^* A Q  Q_{\\perp}^* A Q_{\\perp} \\end{pmatrix}\n$$\n\n**4. 分块结构和左上角子块计算**\n\n空间 $\\mathrm{range}(Q) = \\mathrm{range}(V)$ 是一个 $A$-不变子空间。这意味着对于 $Q$ 的任意列 $q_j$，$A q_j$ 位于 $\\mathrm{range}(Q)$ 中。空间 $\\mathrm{range}(Q_{\\perp})$ 是 $\\mathrm{range}(Q)$ 的正交补。因此，$\\mathrm{range}(Q)$ 中的任何向量，包括 $A q_j$，都与 $Q_{\\perp}$ 的任何列正交。这意味着对于每个 $j$，$Q_{\\perp}^* (A q_j) = 0$。因此，整个分块 $Q_{\\perp}^* A Q$ 是一个零矩阵。\n$$\nQ_{\\perp}^* A Q = 0\n$$\n变换后的矩阵是分块上三角的：\n$$\n\\widehat{Q}^{*} A \\widehat{Q} = \\begin{pmatrix} Q^* A Q  Q^* A Q_{\\perp} \\\\ 0  Q_{\\perp}^* A Q_{\\perp} \\end{pmatrix}\n$$\n左上角的 $2 \\times 2$ 子块是 $Q^* A Q$。我们可以使用前面步骤中建立的关系来计算这个子块。我们从不变性属性 $AV = VT$ 开始，并代入QR分解 $V = QR$：\n$$\nA(QR) = (QR)T\n$$\n从左侧乘以 $Q^*$ 并利用 $Q^*Q=I_2$（因为 $Q$ 具有标准正交列）的性质，我们得到：\n$$\nQ^* A Q R = Q^* Q R T = I_2 R T = RT\n$$\n所以，$(Q^* A Q) R = RT$。由于 $R = \\sqrt{2} I_2$ 是可逆的，我们可以从右侧乘以 $R^{-1}$：\n$$\nQ^* A Q = R T R^{-1}\n$$\n代入计算出的矩阵 $R$ 和 $T$：\n$$\nR = \\sqrt{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad R^{-1} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$$\nQ^* A Q = \\left( \\sqrt{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} \\right) \\begin{pmatrix} 3  4 \\\\ -2  -1 \\end{pmatrix} \\left( \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} \\right) = \\begin{pmatrix} 3  4 \\\\ -2  -1 \\end{pmatrix} = T\n$$\n$\\widehat{Q}^{*} A \\widehat{Q}$ 的左上角 $2 \\times 2$ 子块恰好是矩阵 $T$。\n\n最后一步是计算这个子块的行列式：\n$$\n\\det(Q^* A Q) = \\det(T) = \\det \\begin{pmatrix} 3  4 \\\\ -2  -1 \\end{pmatrix} = (3)(-1) - (4)(-2) = -3 + 8 = 5\n$$",
            "answer": "$$\\boxed{5}$$"
        },
        {
            "introduction": "对于大型稀疏矩阵，直接计算所有不变子空间是不切实际的。现代数值方法依赖于迭代地构建更小的、包含关键谱信息的子空间，即 Krylov 子空间。这个练习  要求你实现 Arnoldi 过程，这是一种构建 Krylov 子空间正交基的强大算法，并利用其性质来确定生成的子空间何时成为不变子空间。通过这个编码实践，你将掌握一个在大型特征值问题和科学计算中无处不在的基本工具。",
            "id": "3551503",
            "problem": "给定方形实矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和非零向量 $b \\in \\mathbb{R}^n$。令 $m$ 阶克雷洛夫子空间定义为\n$$\n\\mathcal{K}_m(A,b) \\equiv \\operatorname{span}\\{b, Ab, A^2 b, \\dots, A^{m-1} b\\}。\n$$\n如果一个子空间 $\\mathcal{S} \\subseteq \\mathbb{R}^n$ 满足 $A \\mathcal{S} \\subseteq \\mathcal{S}$，则称其在 $A$ 下是不变的。你的任务是，对于每个给定的对 $(A,b)$，计算使 $\\mathcal{K}_m(A,b)$ 在 $A$ 下不变的最小正整数 $m$，并通过阿诺尔迪关系的残差来数值验证这种不变性。\n\n你的推理应仅基于以下基本定义和经过充分检验的事实：\n- 克雷洛夫子空间 $\\mathcal{K}_m(A,b)$ 是通过将 $A$ 重复作用于 $b$ 构建的，其维数最多为 $m$ 且最多为 $n$。\n- Arnoldi 过程为 $\\mathcal{K}_m(A,b)$ 构建一个标准正交基 $V_m = [v_1,\\dots,v_m]$（其中 $v_1 = b/\\lVert b\\rVert_2$）和一个满足阿诺尔迪关系的上赫森伯格矩阵 $H_m \\in \\mathbb{R}^{m \\times m}$\n$$\nA V_m = V_m H_m + h_{m+1,m} v_{m+1} e_m^\\top,\n$$\n其中 $e_m \\in \\mathbb{R}^m$ 是第 $m$ 个标准基向量且 $h_{m+1,m} \\ge 0$。在精确计算中，$h_{m+1,m} = 0$ 当且仅当 $\\mathcal{K}_m(A,b)$ 在 $A$ 下是不变的。\n- 在有限精度下的数值计算只能在一定容差范围内确定等式 $h_{m+1,m} = 0$ 是否成立。\n\n设计一个算法，在给定 $(A,b)$ 和一个容差 $\\tau  0$ 的情况下，计算使 Arnoldi 过程满足 $h_{m+1,m} \\le \\tau$ 的最小 $m$。将此解释为不变性的数值检测。然后，通过计算阿诺尔迪残差的弗罗贝尼乌斯范数来验证该不变性\n$$\nR_m \\equiv A V_m - V_m H_m,\n$$\n当 $h_{m+1,m}$ 在数值上为零时，该范数应在数值上很小。使用带有第二次再次正交化过程的修正格拉姆-施密特法来提高数值稳定性。对向量归一化使用欧几里得范数，对矩阵使用弗罗贝尼乌斯范数。\n\n将你的算法实现为一个完整的程序，以解决以下测试套件。对每种情况，使用容差 $\\tau = 10^{-12}$：\n\n- 情况 1（可对角化且具有多个活动特征值）：令\n$$\nA_1 = \\operatorname{diag}(1,2,4,7,11), \\quad b_1 = [1, \\, 1, \\, 0, \\, 1, \\, 0]^\\top.\n$$\n- 情况 2（单个 Jordan 块，不可对角化，完整链）：令 $A_2 \\in \\mathbb{R}^{4 \\times 4}$ 为特征值为 $2$ 的 Jordan 块，即对于 $i=1,2,3$，$(A_2)_{ii} = 2$ 且 $(A_2)_{i,i+1} = 1$，其他位置为零。令\n$$\nb_2 = [1, \\, 0, \\, 0, \\, 0]^\\top.\n$$\n- 情况 3（特征向量输入，立即不变）：令\n$$\nA_3 = \\begin{bmatrix}\n3  1  0  0 \\\\\n0  5  2  0 \\\\\n0  0  7  0 \\\\\n0  0  0  9\n\\end{bmatrix}, \\quad b_3 = [0, \\, 0, \\, 1, \\, 0]^\\top.\n$$\n- 情况 4（具有幂零块的分块对角矩阵）：令\n$$\nA_4 = \\begin{bmatrix}\n0  1  0  0 \\\\\n0  0  0  0 \\\\\n0  0  5  0 \\\\\n0  0  0  6\n\\end{bmatrix}, \\quad b_4 = [1, \\, 0, \\, 0, \\, 0]^\\top.\n$$\n\n对每种情况，你的程序必须：\n- 运行 Arnoldi 过程，直到遇到第一个满足 $h_{m+1,m} \\le \\tau$ 的索引 $m$（这是宣告数值不变性的最小 $m$）。\n- 计算弗罗贝尼乌斯范数 $\\lVert R_m \\rVert_F$ 来验证 Arnoldi 关系，从而验证不变性。\n- 返回由整数 $m$、标量 $h_{m+1,m}$ 和标量 $\\lVert R_m \\rVert_F$组成的三元组。将两个标量输出四舍五入到 $12$ 位小数。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应于上述顺序的一个测试用例的三元列表 $[m, h, r]$。例如，包含四种情况的输出应如下所示：\n$$\n[[m_1,h_1,r_1],[m_2,h_2,r_2],[m_3,h_3,r_3],[m_4,h_4,r_4]].\n$$\n不应打印任何额外文本。",
            "solution": "该问题要求我们对于给定的实矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和非零向量 $b \\in \\mathbb{R}^n$，确定使克雷洛夫子空间 $\\mathcal{K}_m(A,b) = \\operatorname{span}\\{b, Ab, \\dots, A^{m-1} b\\}$ 成为 $A$ 的不变子空间的最小正整数 $m$。如果对于子空间 $\\mathcal{S}$ 中的任意向量 $s \\in \\mathcal{S}$，向量 $As$ 也在 $\\mathcal{S}$ 中，则称子空间 $\\mathcal{S}$ 在 $A$ 下是不变的，记为 $A\\mathcal{S} \\subseteq \\mathcal{S}$。\n\nArnoldi 迭代是为 $\\mathcal{K}_m(A,b)$ 构建标准正交基的直接方法，并提供了检测不变性的准则。该过程生成一系列标准正交向量 $\\{v_1, v_2, \\dots, v_m\\}$，它们构成了 $\\mathcal{K}_m(A,b)$ 的一个基，其中 $v_1 = b / \\lVert b \\rVert_2$。这些向量作为矩阵 $V_m = [v_1, v_2, \\dots, v_m] \\in \\mathbb{R}^{n \\times m}$ 的列进行存储。该算法还生成一个上赫森伯格矩阵 $H_m \\in \\mathbb{R}^{m \\times m}$。这些矩阵通过 Arnoldi 关系相关联：\n$$\nA V_m = V_m H_m + h_{m+1,m} v_{m+1} e_m^\\top\n$$\n其中 $v_{m+1}$ 是一个与 $V_m$ 的列正交的单位向量，$e_m \\in \\mathbb{R}^m$ 是第 $m$ 个标准基向量，并且 $h_{m+1,m} = \\lVert (I - V_m V_m^\\top) A v_m \\rVert_2 \\ge 0$。\n\n子空间 $\\mathcal{K}_m(A,b)$ 在 $A$ 下不变，当且仅当对于所有 $j \\in \\{1, \\dots, m\\}$，都有 $A v_j \\in \\mathcal{K}_m(A,b)$。由于 Arnoldi 过程的结构，该条件简化为检查 $A v_m \\in \\mathcal{K}_m(A,b)$ 是否成立。向量 $(I - V_m V_m^\\top) A v_m$ 表示 $A v_m$ 在与 $\\mathcal{K}_m(A,b)$ 正交方向上的分量。因此，$A v_m \\in \\mathcal{K}_m(A,b)$ 当且仅当这个正交分量是零向量。这个向量的范数恰好是 $h_{m+1,m}$。因此，在精确计算中，克雷洛夫子空间 $\\mathcal{K}_m(A,b)$ 在 $A$ 下不变，当且仅当 $h_{m+1,m}=0$。这标志着 Arnoldi 过程的“崩溃”，因为无法生成新的基向量 $v_{m+1}$。满足条件的最小 $m$ 对应于向量 $b$ 关于矩阵 $A$ 的最小多项式的次数。\n\n在有限精度计算中，我们通过测试 $h_{m+1,m}$ 是否小于给定的容差 $\\tau  0$ 来检查数值不变性。任务是找到满足 $h_{m+1,m} \\le \\tau$ 的最小正整数 $m$。\n\n需要实现的算法是采用修正格拉姆-施密特（MGS）法进行正交化的 Arnoldi 迭代。为了减轻 MGS 中可能出现的正交性损失，算法中包含了一个再次正交化步骤。\n\n算法流程如下（使用基于 0 的索引 `m` 对应于数学中基于 1 的索引 `m+1`）：\n1.  初始化：给定 $A \\in \\mathbb{R}^{n \\times n}$，$b \\in \\mathbb{R}^n$ 和容差 $\\tau  0$。令 $n$ 为空间维数。预分配矩阵 $V \\in \\mathbb{R}^{n \\times (n+1)}$ 和 $H \\in \\mathbb{R}^{(n+1) \\times n}$。\n2.  开始：计算第一个基向量 $v_1 = b / \\lVert b \\rVert_2$。将其存储为 $V$ 的第一列 `V[:,0]`。\n3.  对 `m` = $0, 1, \\dots, n-1$ 进行迭代：\n    a. 令 $v_{m+1}$ 为第 `m` 个基向量（`V[:,m]`）。计算新向量 $w = A v_{m+1}$。\n    b. 将 $w$ 与现有基 $\\{v_1, \\dots, v_{m+1}\\}$ 正交化。这是 MGS 的第一遍。对于 `j` = $0, \\dots, m$：\n       i.  计算投影系数：$h_{j+1,m+1} = v_{j+1}^\\top w$。将其存储在矩阵 $H$ 的 `H[j,m]`。\n       ii. 从 $w$ 中减去投影：$w \\leftarrow w - h_{j+1,m+1} v_{j+1}$。\n    c. 为了数值稳定性进行再次正交化。这是第二遍。对于 `j` = $0, \\dots, m$：\n       i.  计算修正项：$\\delta h = v_{j+1}^\\top w$。\n       ii. 更新赫森伯格矩阵的元素：$h_{j+1,m+1} \\leftarrow h_{j+1,m+1} + \\delta h$。\n       iii. 更新向量：$w \\leftarrow w - \\delta h v_{j+1}$。\n    d. 计算所得向量 $w$ 的范数，即 $h_{m+2,m+1} = \\lVert w \\rVert_2$。将其存储在 `H[m+1,m]`。\n    e. 检查终止条件：如果 $h_{m+2,m+1} \\le \\tau$，则过程终止。子空间 $\\mathcal{K}_{m+1}$ 是不变的，其最小维数是 $m+1$。中断循环。\n    f. 如果过程未终止，则进行归一化以获得下一个基向量：$v_{m+2} = w / h_{m+2,m+1}$。将其存储为 $V$ 的第 `m+1` 列。\n\n在第 $m$ 次迭代终止时，我们得到标准正交基 $V_{m+1} = [v_1, \\dots, v_{m+1}]$ 和上赫森伯格矩阵 $H_{m+1} \\in \\mathbb{R}^{(m+1) \\times (m+1)}$。Arnoldi 关系的残差是矩阵 $R_{m+1} = A V_{m+1} - V_{m+1} H_{m+1}$。根据该关系，$R_{m+1}$ 的所有列都为零，除了最后一列，它等于 $h_{m+2,m+1} v_{m+2}$。为验证数值不变性和实现的正确性，我们计算弗罗贝尼乌斯范数 $\\lVert R_m \\rVert_F$（其中 $m$ 是报告的维数）。理论上，我们有 $\\lVert R_m \\rVert_F = \\lVert h_{m+1,m} v_{m+1} e_m^\\top \\rVert_F = h_{m+1,m}$。直接计算 $\\lVert A V_m - V_m H_m \\rVert_F$ 可作为一个稳健的数值检验。\n\n每个测试用例的最终输出将是三元组 $(m, h_{m+1,m}, \\lVert R_m \\rVert_F)$，其中 $m$ 是不变子空间的维数，$h_{m+1,m}$ 是触发终止的值，而 $\\lVert R_m \\rVert_F$ 是计算出的残差的弗罗贝尼乌斯范数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef arnoldi_invariance(A, b, tol=1e-12):\n    \"\"\"\n    Computes the smallest m for which the Krylov subspace K_m(A,b) is invariant.\n    The implementation follows the Arnoldi iteration where the loop index `m`\n    is 0-based and corresponds to the column of H being computed.\n    The dimension of the resulting invariant subspace is `m+1`.\n\n    Args:\n        A (np.ndarray): The square matrix of size n x n.\n        b (np.ndarray): The starting vector of size n.\n        tol (float): The tolerance for h_{m+1,m} to be considered zero.\n\n    Returns:\n        tuple: A triplet (dim, h, r) where:\n            dim (int): The smallest dimension of the invariant Krylov subspace.\n            h (float): The value of h_{dim,dim-1} at termination.\n            r (float): The Frobenius norm of the residual matrix R_dim = A V_dim - V_dim H_dim.\n    \"\"\"\n    n = A.shape[0]\n    V = np.zeros((n, n + 1), dtype=float)\n    H = np.zeros((n + 1, n), dtype=float)\n\n    # Step 1: Initialize\n    V[:, 0] = b / np.linalg.norm(b)\n\n    for m in range(n):\n        # In this iteration `m` (0-indexed), we compute the `m`-th column of H\n        # and the `m+1`-th vector of V. The subspace dimension is `m+1`.\n        \n        # Step 2: Generate new vector\n        v_current = V[:, m]\n        w = A @ v_current\n\n        # Step 3: Modified Gram-Schmidt with reorthogonalization\n        # Orthogonalize w against the current basis V_m = V[:, :m+1]\n        \n        # First pass\n        h_col = V[:, :m+1].T @ w\n        w = w - V[:, :m+1] @ h_col\n        H[:m+1, m] = h_col\n\n        # Second reorthogonalization pass for stability\n        h_corr = V[:, :m+1].T @ w\n        w = w - V[:, :m+1] @ h_corr\n        H[:m+1, m] += h_corr\n        \n        # Step 4: Compute h_{m+2,m+1} (math notation) and check for invariance\n        h_next = np.linalg.norm(w)\n        H[m+1, m] = h_next\n\n        # Termination condition: if h_next is numerically zero, the subspace\n        # of dimension m+1 is invariant.\n        if h_next = tol:\n            m_final = m + 1\n            Vm = V[:, :m_final]\n            Hm = H[:m_final, :m_final]\n            \n            # Verification: Compute residual norm\n            Rm = A @ Vm - Vm @ Hm\n            res_norm = np.linalg.norm(Rm, 'fro')\n            \n            return m_final, h_next, res_norm\n\n        # Step 5: Normalize to get next basis vector\n        V[:, m+1] = w / h_next\n\n    # If loop completes without early termination, the space is the full R^n\n    m_final = n\n    Vm = V[:, :n]\n    Hm = H[:n, :n]\n    Rm = A @ Vm - Vm @ Hm\n    res_norm = np.linalg.norm(Rm, 'fro')\n    h_final = H[n, n-1]\n\n    return m_final, h_final, res_norm\n\n\ndef solve():\n    \"\"\"\n    Defines and solves the test suite of problems.\n    \"\"\"\n    tol = 1e-12\n\n    # Case 1\n    A1 = np.diag([1.0, 2.0, 4.0, 7.0, 11.0])\n    b1 = np.array([1, 1, 0, 1, 0], dtype=float)\n\n    # Case 2\n    A2 = np.diag([2.0]*4) + np.diag([1.0]*3, k=1)\n    b2 = np.array([1, 0, 0, 0], dtype=float)\n\n    # Case 3\n    A3 = np.array([\n        [3, 1, 0, 0],\n        [0, 5, 2, 0],\n        [0, 0, 7, 0],\n        [0, 0, 0, 9]\n    ], dtype=float)\n    b3 = np.array([0, 0, 1, 0], dtype=float)\n    \n    # Case 4\n    A4 = np.array([\n        [0, 1, 0, 0],\n        [0, 0, 0, 0],\n        [0, 0, 5, 0],\n        [0, 0, 0, 6]\n    ], dtype=float)\n    b4 = np.array([1, 0, 0, 0], dtype=float)\n    \n    test_cases = [\n        (A1, b1),\n        (A2, b2),\n        (A3, b3),\n        (A4, b4),\n    ]\n\n    results = []\n    for A, b in test_cases:\n        m, h, r = arnoldi_invariance(A, b, tol)\n        # Format h and r to 12 decimal places\n        h_str = f\"{h:.12f}\"\n        r_str = f\"{r:.12f}\"\n        results.append(f\"[{m},{h_str},{r_str}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}