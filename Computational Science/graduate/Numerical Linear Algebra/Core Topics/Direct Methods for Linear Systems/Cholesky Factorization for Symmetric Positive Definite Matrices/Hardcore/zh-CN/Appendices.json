{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握一种算法，最好的方法莫过于亲手在一个小例子上进行演算。这个练习提供了一个源于机器学习（高斯过程回归）领域的具体场景，要求我们对一个 $2 \\times 2$ 矩阵进行 Cholesky 分解。通过完成这个基础计算，你将巩固 Cholesky 分解定义中的核心步骤，并体会它在实际应用中的价值。",
            "id": "3423975",
            "problem": "考虑一个数据同化背景下的线性观测模型，其中潜状态被赋予一个高斯过程（GP）先验。在高斯过程回归（GPR）中，两个输入位置上两个带噪观测函数值的协方差是先验协方差与一个独立观测噪声方差之和。具体来说，设先验协方差矩阵为 $K=\\begin{pmatrix}1  0.9\\\\ 0.9  1\\end{pmatrix}$，观测噪声方差为 $\\sigma^{2}=0.1$，因此观测数据的总协方差为 $A=K+\\sigma^{2}I$。为了在反问题中进行代理建模和超参数推断，需要两个计算基元：行列式的自然对数 $\\ln\\det(A)$ 和具有正对角线元素且满足 $A=L\\,L^{\\top}$ 的下三角 Cholesky 因子 $L$。\n\n从行列式和对称正定矩阵的 Cholesky 分解的定义和基本性质出发，对给定的 $K$ 和 $\\sigma^{2}$，显式计算 $\\ln\\det(K+\\sigma^{2}I)$ 和 Cholesky 因子 $L$。使用自然对数并提供精确的代数表达式（不要四舍五入）。您的最终答案必须包含这两个量，其中 Cholesky 因子由其非零元素指定。",
            "solution": "用户提供了一个来自数据同化和机器学习领域的有效、适定的问题陈述。\n\n该问题要求计算高斯过程回归的两个基本量：协方差矩阵的行列式的自然对数 $\\ln\\det(A)$，以及该矩阵的 Cholesky 因子 $L$。\n\n给定的量是：\n先验协方差矩阵 $K = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix}$。\n观测噪声方差 $\\sigma^{2}=0.1$。\n观测数据的总协方差由模型 $A=K+\\sigma^{2}I$ 给出，其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n\n首先，我们构造矩阵 $A$。\n$$\nI = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$$\nA = K + \\sigma^{2}I = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix} + 0.1 \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$$\nA = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix} + \\begin{pmatrix} 0.1  0 \\\\ 0  0.1 \\end{pmatrix} = \\begin{pmatrix} 1.1  0.9 \\\\ 0.9  1.1 \\end{pmatrix}\n$$\n为保持精确性，我们可以将这些小数值表示为分数：\n$$\nA = \\begin{pmatrix} \\frac{11}{10}  \\frac{9}{10} \\\\ \\frac{9}{10}  \\frac{11}{10} \\end{pmatrix}\n$$\n\n接下来，我们计算第一个所需量 $\\ln\\det(A)$。\n一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ 的行列式由公式 $ad - bc$ 给出。\n$$\n\\det(A) = \\left(\\frac{11}{10}\\right) \\left(\\frac{11}{10}\\right) - \\left(\\frac{9}{10}\\right) \\left(\\frac{9}{10}\\right) = \\frac{121}{100} - \\frac{81}{100} = \\frac{121 - 81}{100} = \\frac{40}{100} = \\frac{2}{5}\n$$\n因此，行列式的自然对数是：\n$$\n\\ln\\det(A) = \\ln\\left(\\frac{2}{5}\\right)\n$$\n\n其次，我们计算 Cholesky 因子 $L$。$A$ 是一个对称正定矩阵，因此存在一个唯一的具有正对角线元素的下三角矩阵 $L$，使得 $A = L L^{\\top}$。设 $L$ 为：\n$$\nL = \\begin{pmatrix} L_{11}  0 \\\\ L_{21}  L_{22} \\end{pmatrix}\n$$\n条件 $A=LL^{\\top}$ 给出：\n$$\n\\begin{pmatrix} A_{11}  A_{12} \\\\ A_{21}  A_{22} \\end{pmatrix} = \\begin{pmatrix} L_{11}  0 \\\\ L_{21}  L_{22} \\end{pmatrix} \\begin{pmatrix} L_{11}  L_{21} \\\\ 0  L_{22} \\end{pmatrix} = \\begin{pmatrix} L_{11}^2  L_{11}L_{21} \\\\ L_{21}L_{11}  L_{21}^2 + L_{22}^2 \\end{pmatrix}\n$$\n我们通过令矩阵的元素相等来求解 $L$ 的元素：\n$(1,1)$ 元素给出 $A_{11} = L_{11}^2$：\n$$\nL_{11}^2 = \\frac{11}{10} \\implies L_{11} = \\sqrt{\\frac{11}{10}}\n$$\n我们取正根，这是 Cholesky 分解的要求。\n\n$(2,1)$ 元素给出 $A_{21} = L_{21}L_{11}$：\n$$\nL_{21} = \\frac{A_{21}}{L_{11}} = \\frac{9/10}{\\sqrt{11/10}} = \\frac{9}{10} \\frac{\\sqrt{10}}{\\sqrt{11}} = \\frac{9}{\\sqrt{10}\\sqrt{11}} = \\frac{9}{\\sqrt{110}}\n$$\n\n$(2,2)$ 元素给出 $A_{22} = L_{21}^2 + L_{22}^2$：\n$$\nL_{22}^2 = A_{22} - L_{21}^2 = \\frac{11}{10} - \\left(\\frac{9}{\\sqrt{110}}\\right)^2 = \\frac{11}{10} - \\frac{81}{110}\n$$\n为了进行减法，我们找到一个公分母：\n$$\nL_{22}^2 = \\frac{11 \\times 11}{110} - \\frac{81}{110} = \\frac{121 - 81}{110} = \\frac{40}{110} = \\frac{4}{11}\n$$\n取正平方根：\n$$\nL_{22} = \\sqrt{\\frac{4}{11}} = \\frac{2}{\\sqrt{11}}\n$$\n因此，Cholesky 因子是：\n$$\nL = \\begin{pmatrix} \\sqrt{\\frac{11}{10}}  0 \\\\ \\frac{9}{\\sqrt{110}}  \\frac{2}{\\sqrt{11}} \\end{pmatrix}\n$$\n问题要求两个计算出的量：$\\ln\\det(A)$ 和 Cholesky 因子 $L$ 的非零元素，即 $L_{11}$、$L_{21}$ 和 $L_{22}$。\n\n最终值为：\n$\\ln\\det(A) = \\ln(\\frac{2}{5})$\n$L_{11} = \\sqrt{\\frac{11}{10}}$\n$L_{21} = \\frac{9}{\\sqrt{110}}$\n$L_{22} = \\frac{2}{\\sqrt{11}}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\ln\\left(\\frac{2}{5}\\right)  \\sqrt{\\frac{11}{10}}  \\frac{9}{\\sqrt{110}}  \\frac{2}{\\sqrt{11}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了基础计算之后，我们可以探索一种更高级也更实用的技巧：更新 Cholesky 分解。当一个已分解的矩阵被增添新的行和列时，我们不必从头计算，而是可以利用其原有的分解结果来高效地获得新矩阵的 Cholesky 因子。这个练习将通过分块矩阵的视角，指导你推导并应用这种更新方法，从而加深对 Cholesky 分解结构性特点的理解。",
            "id": "3222581",
            "problem": "考虑对称正定（SPD）矩阵 $A \\in \\mathbb{R}^{2 \\times 2}$，其表达式为\n$$\nA = \\begin{pmatrix}\n4  2 \\\\\n2  3\n\\end{pmatrix},\n$$\n及其 Cholesky 因子 $G$（对角线元素为正的下三角矩阵），满足 $A = G G^{\\top}$，其中\n$$\nG = \\begin{pmatrix}\n2  0 \\\\\n1  \\sqrt{2}\n\\end{pmatrix}.\n$$\n通过在 $A$ 上附加一行和一列来构造增广矩阵 $B \\in \\mathbb{R}^{3 \\times 3}$：\n$$\nB = \\begin{pmatrix}\nA  b \\\\\nb^{\\top}  c\n\\end{pmatrix}, \\quad\nb = \\begin{pmatrix}\n1 \\\\\n2\n\\end{pmatrix}, \\quad c = 2.\n$$\n仅使用对称正定矩阵的 Cholesky 分解定义和分块矩阵乘法，推导确定 $B$ 的 Cholesky 因子 $H$ 所需的关系式，并计算 $H$ 的右下角对角元素（即 $B = H H^{\\top}$ 中下三角因子 $H$ 的 $(3,3)$ 元素）。将最终数值答案四舍五入至四位有效数字。无需单位。",
            "solution": "首先对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   矩阵 $A \\in \\mathbb{R}^{2 \\times 2}$ 为 $A = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix}$。题目说明该矩阵是对称正定（SPD）的。\n-   $A$ 的 Cholesky 因子为 $G = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix}$，满足 $A = GG^{\\top}$，其中 $G$ 是对角线元素为正的下三角矩阵。\n-   增广矩阵 $B \\in \\mathbb{R}^{3 \\times 3}$ 的形式为 $B = \\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix}$。\n-   向量 $b$ 为 $b = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n-   标量 $c$ 为 $c = 2$。\n-   我们需要找到 $B$ 的 Cholesky 因子 $H$，其中 $B = HH^{\\top}$，并具体计算元素 $H_{33}$。\n-   最终数值答案应四舍五入至四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题源于数值线性代数，特别是 Cholesky 分解，这是一种求解对称正定矩阵线性系统的标准方法。\n-   **适定性**：\n    -   我们验证给定信息的一致性。给定矩阵 $A$ 的 Cholesky 分解表示为 $G G^{\\top}$：\n        $$\n        G G^{\\top} = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix} \\begin{pmatrix} 2  1 \\\\ 0  \\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} (2)(2) + (0)(0)  (2)(1) + (0)(\\sqrt{2}) \\\\ (1)(2) + (\\sqrt{2})(0)  (1)(1) + (\\sqrt{2})(\\sqrt{2}) \\end{pmatrix} = \\begin{pmatrix} 4  2 \\\\ 2  1+2 \\end{pmatrix} = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix} = A\n        $$\n        给定的因子 $G$ 确实是 $A$ 的正确 Cholesky 因子。矩阵 $A$ 是对称正定的，因为其顺序主子式为 $D_1 = 4  0$ 和 $D_2 = \\det(A) = 4 \\times 3 - 2 \\times 2 = 12 - 4 = 8  0$。\n    -   为了使 $B$ 的 Cholesky 分解存在，$B$ 必须是对称正定的。我们构造 $B$ 并进行检查：\n        $$\n        B = \\begin{pmatrix} 4  2  1 \\\\ 2  3  2 \\\\ 1  2  2 \\end{pmatrix}\n        $$\n        $B$ 是对称的。其顺序主子式为：\n        $D_1 = 4  0$。\n        $D_2 = \\det\\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix} = 8  0$。\n        $D_3 = \\det(B) = 4(3 \\cdot 2 - 2 \\cdot 2) - 2(2 \\cdot 2 - 2 \\cdot 1) + 1(2 \\cdot 2 - 3 \\cdot 1) = 4(2) - 2(2) + 1(1) = 8 - 4 + 1 = 5  0$。\n        由于所有顺序主子式均为正，$B$ 是对称正定的，因此存在唯一的、对角线元素为正的 Cholesky 因子 $H$。\n-   **客观性**：问题以精确的数学术语陈述，没有任何主观性。\n\n### 步骤 3：结论与行动\n该问题是自洽、一致且科学上适定的。验证成功。我们开始求解。\n\n矩阵 $B$ 是一个 $3 \\times 3$ 的对称正定矩阵，其 Cholesky 因子 $H$ 是一个对角线元素为正的 $3 \\times 3$ 下三角矩阵，使得 $B = H H^{\\top}$。题目要求我们找到元素 $H_{33}$。我们将按要求使用分块矩阵乘法。\n\n我们按指定方式对矩阵 $B$ 进行分块：\n$$\nB = \\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix}\n$$\n其中 $A$ 是 $2 \\times 2$ 矩阵，$b$ 是 $2 \\times 1$ 向量，$c$ 是一个标量。我们相应地对下三角矩阵 $H$ 进行分块：\n$$\nH = \\begin{pmatrix} L  \\mathbf{0} \\\\ \\mathbf{h}^{\\top}  \\delta \\end{pmatrix}\n$$\n这里，$L$ 是一个 $2 \\times 2$ 的下三角矩阵，$\\mathbf{0}$ 是一个 $2 \\times 1$ 的零向量，$\\mathbf{h}^{\\top}$ 是一个 $1 \\times 2$ 的行向量（因此 $\\mathbf{h}$ 是一个 $2 \\times 1$ 的列向量），$\\delta$ 是一个标量，对应于所求元素 $H_{33}$。根据 Cholesky 分解的定义，对角线元素必须为正，所以 $\\delta > 0$。\n\n$H$ 的转置是：\n$$\nH^{\\top} = \\begin{pmatrix} L^{\\top}  \\mathbf{h} \\\\ \\mathbf{0}^{\\top}  \\delta \\end{pmatrix}\n$$\n现在，我们以分块形式计算乘积 $H H^{\\top}$：\n$$\nH H^{\\top} = \\begin{pmatrix} L  \\mathbf{0} \\\\ \\mathbf{h}^{\\top}  \\delta \\end{pmatrix} \\begin{pmatrix} L^{\\top}  \\mathbf{h} \\\\ \\mathbf{0}^{\\top}  \\delta \\end{pmatrix} = \\begin{pmatrix} L L^{\\top}  L \\mathbf{h} \\\\ \\mathbf{h}^{\\top} L^{\\top}  \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2 \\end{pmatrix}\n$$\n通过令 $B = H H^{\\top}$，我们比较各个分块：\n$$\n\\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix} = \\begin{pmatrix} L L^{\\top}  L \\mathbf{h} \\\\ (L \\mathbf{h})^{\\top}  \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2 \\end{pmatrix}\n$$\n这给了我们一个由三个矩阵/向量方程组成的方程组：\n1.  $A = L L^{\\top}$\n2.  $b = L \\mathbf{h}$\n3.  $c = \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2$\n\n我们逐步求解这个方程组。\n由方程（1），$A = L L^{\\top}$。这表明 $L$ 是 $A$ 的 Cholesky 因子。题目给出了 $A$ 的 Cholesky 因子为 $G$。由于对称正定矩阵的对角线元素为正的 Cholesky 因子是唯一的，我们必有 $L = G$。\n$$\nL = G = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix}\n$$\n由方程（2），$b = L \\mathbf{h}$。由于 $L$ 是下三角矩阵，我们可以使用前向替换法求解向量 $\\mathbf{h}$。\n$$\n\\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix} \\mathbf{h} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n设 $\\mathbf{h} = \\begin{pmatrix} h_1 \\\\ h_2 \\end{pmatrix}$。方程组为：\n$$\n2 h_1 = 1 \\implies h_1 = \\frac{1}{2}\n$$\n$$\n1 h_1 + \\sqrt{2} h_2 = 2 \\implies \\frac{1}{2} + \\sqrt{2} h_2 = 2\n$$\n求解 $h_2$：\n$$\n\\sqrt{2} h_2 = 2 - \\frac{1}{2} = \\frac{3}{2} \\implies h_2 = \\frac{3}{2 \\sqrt{2}} = \\frac{3\\sqrt{2}}{4}\n$$\n所以，向量 $\\mathbf{h}$ 是 $\\mathbf{h} = \\begin{pmatrix} 1/2 \\\\ 3\\sqrt{2}/4 \\end{pmatrix}$。\n\n最后，由方程（3），$c = \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2$，我们可以求解 $\\delta$，即所求的元素 $H_{33}$。\n$$\n\\delta^2 = c - \\mathbf{h}^{\\top} \\mathbf{h}\n$$\n首先，计算 $\\mathbf{h}^{\\top} \\mathbf{h}$：\n$$\n\\mathbf{h}^{\\top} \\mathbf{h} = \\begin{pmatrix} \\frac{1}{2}  \\frac{3\\sqrt{2}}{4} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{3\\sqrt{2}}{4} \\end{pmatrix} = \\left(\\frac{1}{2}\\right)^2 + \\left(\\frac{3\\sqrt{2}}{4}\\right)^2 = \\frac{1}{4} + \\frac{9 \\cdot 2}{16} = \\frac{1}{4} + \\frac{18}{16} = \\frac{4}{16} + \\frac{18}{16} = \\frac{22}{16} = \\frac{11}{8}\n$$\n现在将这个值和 $c=2$ 代入 $\\delta^2$ 的方程中：\n$$\n\\delta^2 = 2 - \\frac{11}{8} = \\frac{16}{8} - \\frac{11}{8} = \\frac{5}{8}\n$$\n由于 $\\delta = H_{33}$ 必须为正，我们取正平方根：\n$$\n\\delta = \\sqrt{\\frac{5}{8}} = \\frac{\\sqrt{5}}{\\sqrt{8}} = \\frac{\\sqrt{5}}{2\\sqrt{2}} = \\frac{\\sqrt{5}\\sqrt{2}}{2\\sqrt{2}\\sqrt{2}} = \\frac{\\sqrt{10}}{4}\n$$\n题目要求数值答案四舍五入到四位有效数字。\n$$\n\\delta = \\frac{\\sqrt{10}}{4} \\approx \\frac{3.16227766}{4} \\approx 0.790569415\n$$\n将此值四舍五入到四位有效数字得到 $0.7906$。",
            "answer": "$$\n\\boxed{0.7906}\n$$"
        },
        {
            "introduction": "Cholesky 分解的一个关键前提是矩阵必须为对称正定矩阵，但在实际问题中这个条件并非总能得到满足。这个高级练习直面这一挑战，它引导我们探索如何通过对角移位（diagonal shift）来确保矩阵的正定性。你需要从理论上分析分解因子如何随对角增量变化，并基于此设计一个稳健的数值算法来寻找最小的有效移位量，这连接了分解的深刻理论性质与数值软件的稳定性设计。",
            "id": "3537154",
            "problem": "给定一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$，并考虑对角移位族 $A_{\\delta} = A + \\delta I$，其中 $\\delta \\in \\mathbb{R}$。对于每一个使得 $A_{\\delta}$ 是对称正定 (SPD) 矩阵的 $\\delta$，都存在一个唯一的 Cholesky 分解 $A_{\\delta} = L(\\delta) L(\\delta)^{\\top}$，其中 $L(\\delta)$ 是一个下三角矩阵且对角线元素严格为正。$L(\\delta)$ 的对角线元素，记为 $L_{ii}(\\delta)$，通常被称为 Cholesky 主元。\n\n您的任务如下。\n\n- 从第一性原理出发，推导出一个控制 $L(\\delta)$ 相对于 $\\delta$ 变化率的关系式。仅使用 Cholesky 分解的核心定义，即对于任何使 $A_{\\delta}$ 为 SPD 的 $\\delta$，都有 $L(\\delta) L(\\delta)^{\\top} = A + \\delta I$。将此恒等式对 $\\delta$ 求导，并证明导数 $S(\\delta) := \\frac{d}{d\\delta}L(\\delta)$ 满足一个结构化的三角 Sylvester 方程，形式如下：\n  $$ S(\\delta) L(\\delta)^{\\top} + L(\\delta) S(\\delta)^{\\top} = I. $$\n  仅利用三角矩阵的代数性质和 $L(\\delta)$ 对角线元素的严格正性，推导出唯一确定 $S(\\delta)$ 的逐元素关系式。根据这些关系式，证明对于每个索引 $i$（$1 \\le i \\le n$），第 $i$ 个主元的导数满足 $L_{ii}'(\\delta) = S_{ii}(\\delta)  0$，因此每个主元 $L_{ii}(\\delta)$ 都是关于 $\\delta$ 的严格递增函数。\n\n- 提出一个数值稳定的算法，在存在舍入误差的有限精度算术中，选择最小的非负移位 $\\delta_{\\min}$，使得对 $A_{\\delta_{\\min}}$ 进行无分块、无主元选择的 Cholesky 分解：\n  $$\n  A_{\\delta_{\\min}} = L L^{\\top}\n  $$\n  不会因计算中断，并且所有主元 $L_{ii} \\ge \\tau$，其中 $\\tau  0$ 是一个给定的阈值。您的算法应：\n  1. 利用主元 $L_{ii}(\\delta)$ 相对于 $\\delta$ 的单调性，来证明在 $\\delta$ 上进行区间限定与二分搜索的合理性。\n  2. 将在无分块 Cholesky 递推中遇到的任何非正被开方数视为需要增加 $\\delta$ 的分解中断。\n  3. 终止时得到的 $\\delta_{\\min}$ 应能保证，在浮点运算中实际计算出的分解中，最小主元至少为 $\\tau$。\n  4. 为 $\\delta$ 的二分法指定一个绝对或相对的停止容差 $\\varepsilon_{\\delta}  0$，并说明二分法为何会终止。\n\n- 将您的算法实现为一个完整的程序。对于每个测试用例，程序返回最小的 $\\delta \\ge 0$，使得在双精度算术中对 $A + \\delta I$ 进行直接的无分块 Cholesky 分解能够成功且不中断，并实现 $\\min_i L_{ii} \\ge \\tau$。使用 Cholesky 递推的直接实现来揭示实际的有限精度行为；不要依赖隐藏主元增长行为的库函数调用。\n\n使用以下测试套件。对于每种情况，输入为一个对称矩阵 $A$ 和一个正常数阈值 $\\tau$：\n  - 情况 1（良态 SPD）：\n    $$ A_1 = \\begin{bmatrix} 4  1  0 \\\\ 1  3  0.5 \\\\ 0  0.5  2 \\end{bmatrix}, \\quad \\tau_1 = 1.0. $$\n  - 情况 2（主对角线元素极小的 SPD）：\n    $$ A_2 = \\operatorname{diag}(10^{-8}, 1, 2), \\quad \\tau_2 = 10^{-3}. $$\n  - 情况 3（不定对称，需要移位才能成为 SPD）：\n    $$ A_3 = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix}, \\quad \\tau_3 = 0.1. $$\n  - 情况 4（半正定对角，需要移位以获得正主元）：\n    $$ A_4 = \\operatorname{diag}(0, 2, 3), \\quad \\tau_4 = 0.5. $$\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的结果与测试套件的顺序相同，例如\n$$ [\\delta_1,\\delta_2,\\delta_3,\\delta_4]. $$\n\n最终输出中的所有数字都应为浮点十进制表示。不涉及物理单位。不涉及角度。不涉及百分比。每个测试用例唯一接受的输出是满足上述规范的标量浮点数 $\\delta_i$。该算法必须是通用的，并且不得硬编码任何答案。",
            "solution": "该问题在科学上基于数值线性代数的原理，是良定的，并且陈述客观，因此被评估为有效。它要求推导关于 Cholesky 分解敏感性的标准结果，并基于这些结果设计和实现一个数值上合理的算法。\n\n### 第 1 部分：理论推导\n\n对称正定 (SPD) 矩阵 $A_{\\delta} = A + \\delta I$ 的 Cholesky 分解由以下恒等式给出：\n$$L(\\delta) L(\\delta)^{\\top} = A + \\delta I$$\n其中 $L(\\delta)$ 是一个下三角矩阵，其对角线元素严格为正，$L_{ii}(\\delta)  0$。为了找到 $L(\\delta)$ 相对于 $\\delta$ 的变化率，我们对此恒等式关于 $\\delta$ 进行微分。矩阵 $A$ 相对于 $\\delta$ 是常数。在左侧使用矩阵微分的乘法法则，并直接对右侧进行微分，我们得到：\n$$\\frac{d}{d\\delta}(L(\\delta)) L(\\delta)^{\\top} + L(\\delta) \\frac{d}{d\\delta}(L(\\delta)^{\\top}) = \\frac{d}{d\\delta}(A) + \\frac{d}{d\\delta}(\\delta I)$$\n令 $S(\\delta) = \\frac{d}{d\\delta}L(\\delta)$。那么 $\\frac{d}{d\\delta}(L(\\delta)^{\\top}) = (\\frac{d}{d\\delta}L(\\delta))^{\\top} = S(\\delta)^{\\top}$。$A$ 的导数是零矩阵，$\\delta I$ 的导数是单位矩阵 $I$。将这些代入微分后的方程，得到：\n$$S(\\delta) L(\\delta)^{\\top} + L(\\delta) S(\\delta)^{\\top} = I$$\n这就是 $S(\\delta)$ 的结构化三角 Sylvester 方程。\n\n由于对于所有在 $A_\\delta$ 为 SPD 的定义域内的 $\\delta$，$L(\\delta)$ 都是下三角矩阵，其非对角线元素 $L_{ij}(\\delta)$（对于 $i  j$）恒为零。因此，它们的导数也必须为零：$S_{ij}(\\delta) = \\frac{d}{d\\delta}L_{ij}(\\delta) = 0$ 对于 $i  j$。这表明 $S(\\delta)$ 也是一个下三角矩阵。\n\n$S(\\delta)$（记为 $S$）关于 $L(\\delta)$（记为 $L$）的逐元素关系式可以通过逐列求解 Sylvester 方程来推导。对于 $j=1, \\dots, n$ 和 $i=j, \\dots, n$：\n$$ (S L^{\\top})_{ij} + (L S^{\\top})_{ij} = \\sum_{k=1}^{j} S_{ik} L_{jk} + \\sum_{k=1}^{i} L_{ik} S_{jk} = \\delta_{ij} $$\n其中 $\\delta_{ij}$ 是克罗内克 δ。由于 $S$ 是下三角矩阵，$S_{jk}=0$ 对于 $k>j$。\n对于对角线元素 ($i=j$)：\n$$ \\sum_{k=1}^{j} S_{jk} L_{jk} + \\sum_{k=1}^{j} L_{jk} S_{jk} = 2 \\sum_{k=1}^{j} S_{jk} L_{jk} = 1 $$\n$$ 2 \\left( S_{jj} L_{jj} + \\sum_{k=1}^{j-1} S_{jk} L_{jk} \\right) = 1 \\implies S_{jj} = \\frac{1}{2 L_{jj}} \\left(1 - 2\\sum_{k=1}^{j-1} S_{jk} L_{jk}\\right) $$\n对于非对角线元素 ($i>j$)：\n$$ \\sum_{k=1}^{j} S_{ik} L_{jk} + \\sum_{k=1}^{j} L_{ik} S_{jk} = 0 $$\n$$ S_{ij} L_{jj} + L_{ij} S_{jj} + \\sum_{k=1}^{j-1} (S_{ik} L_{jk} + L_{ik} S_{jk}) = 0 \\implies S_{ij} = -\\frac{1}{L_{jj}} \\left( L_{ij} S_{jj} + \\sum_{k=1}^{j-1} (S_{ik} L_{jk} + L_{ik} S_{jk}) \\right) $$\n这些关系式允许通过前向代入法逐列唯一地确定 $S$ 的所有元素。\n\n为了证明 $L_{ii}'(\\delta) = S_{ii}(\\delta)  0$，我们使用 Cholesky 主元关于舒尔补的定义。第 $i$ 个主元的平方 $L_{ii}(\\delta)^2$ 是 $A_{\\delta}$ 的前导 $(i-1) \\times (i-1)$ 主子矩阵的舒尔补的 $(1,1)$ 元素。我们将 $A_{\\delta}$ 分块如下：\n$$ A_{\\delta} = \\begin{pmatrix} A_{11}+\\delta I_{i-1}  \\mathbf{a}_{12} \\\\ \\mathbf{a}_{21}  A_{22}+\\delta I_{n-i+1} \\end{pmatrix} $$\n其中 $A_{11}$ 是 $(i-1) \\times (i-1)$ 矩阵，$\\mathbf{a}_{21} = \\mathbf{a}_{12}^\\top$ 是 $A$ 的第 $i$ 行/列的相关部分。主元 $L_{ii}(\\delta)$ 由以下公式确定：\n$$ L_{ii}(\\delta)^2 = (A_{ii} + \\delta) - \\mathbf{a}_{21}^{\\top} (A_{11} + \\delta I_{i-1})^{-1} \\mathbf{a}_{21} $$\n令 $M(\\delta) = A_{11} + \\delta I_{i-1}$。关于 $\\delta$ 求导：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) = 1 - \\mathbf{a}_{21}^{\\top} \\frac{d}{d\\delta}(M(\\delta)^{-1}) \\mathbf{a}_{21} $$\n使用恒等式 $\\frac{d}{d\\delta}(M^{-1}) = -M^{-1} (\\frac{dM}{d\\delta}) M^{-1}$ 并注意到 $\\frac{dM}{d\\delta} = I_{i-1}$，我们得到：\n$$ \\frac{d}{d\\delta}(M(\\delta)^{-1}) = -M(\\delta)^{-2} $$\n将其代回：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) = 1 - \\mathbf{a}_{21}^{\\top} (-M(\\delta)^{-2}) \\mathbf{a}_{21} = 1 + \\mathbf{a}_{21}^{\\top} M(\\delta)^{-2} \\mathbf{a}_{21} $$\n要使 $A_{\\delta}$ 为 SPD，其主子矩阵 $M(\\delta)$ 必须是 SPD。因此，其逆 $M(\\delta)^{-1}$ 和其逆的平方 $M(\\delta)^{-2} = (M(\\delta)^{-1})^{\\top} M(\\delta)^{-1}$ 也都是 SPD。因此，二次型 $\\mathbf{a}_{21}^{\\top} M(\\delta)^{-2} \\mathbf{a}_{21}$ 是非负的。这导致：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) \\ge 1 $$\n由于 $L(\\delta)$ 具有严格为正的对角线，所以 $L_{ii}(\\delta)  0$。因此，我们可以除以 $2L_{ii}(\\delta)$ 得到：\n$$ L_{ii}'(\\delta) = S_{ii}(\\delta) \\ge \\frac{1}{2 L_{ii}(\\delta)}  0 $$\n这证明了每个 Cholesky 主元 $L_{ii}(\\delta)$ 都是关于 $\\delta$ 的严格递增函数。\n\n### 第 2 部分：算法设计\n\n目标是找到最小的非负移位 $\\delta_{\\min} \\ge 0$，使得 $A_{\\delta_{\\min}} = A + \\delta_{\\min} I$ 的无分块 Cholesky 分解能够成功，并产生所有主元 $L_{ii} \\ge \\tau$，其中 $\\tau  0$ 是一个给定的阈值。\n\n1.  **二分法的合理性**：在第 1 部分中，我们证明了每个主元 $L_{ii}(\\delta)$ 都是关于 $\\delta$ 的严格递增函数。因此，最小主元 $g(\\delta) = \\min_i L_{ii}(\\delta)$ 是一个关于 $\\delta$ 的连续非减函数。我们正在寻找最小的 $\\delta \\ge 0$ 使得 $g(\\delta) \\ge \\tau$。这等价于寻找单调函数 $f(\\delta) = g(\\delta) - \\tau = 0$ 的根。$f(\\delta)$ 的单调性使得此问题适用于二分搜索，这种方法一旦找到满足 $f(\\delta_{low})  0$ 和 $f(\\delta_{high}) \\ge 0$ 的界定区间 $[\\delta_{low}, \\delta_{high}]$，就是鲁棒且保证收敛的。\n\n2.  **中断处理**：矩阵 $M$ 的无分块 Cholesky 递推涉及计算 $L_{jj} = \\sqrt{M_{jj} - \\sum_{k=1}^{j-1} L_{jk}^2}$。如果被开方数 $M_{jj} - \\sum_{k=1}^{j-1} L_{jk}^2$ 为非正数，则会发生计算中断。我们的算法将实现一个 Cholesky 分解例程，该例程会显式检查此条件。中断被视为未能满足主元阈值，需要一个更大的 $\\delta$。\n\n3.  **算法**：\n    a. 首先，尝试对 $\\delta=0$ 进行 Cholesky 分解。如果成功且所有主元都 $\\ge \\tau$，则 $\\delta_{\\min}=0$ 是解。\n    b. 否则，我们知道 $\\delta_{\\min}>0$。我们建立一个搜索区间 $[\\delta_{low}, \\delta_{high}]$。设 $\\delta_{low}=0$。\n    c. 通过扩展搜索找到一个上界 $\\delta_{high}$。从一个猜测值开始，例如 $\\delta_{high} = \\tau$，并反复加倍（$\\delta_{high} \\leftarrow 2\\delta_{high}$），直到 $A+\\delta_{high}I$ 的 Cholesky 分解成功且所有主元 $\\ge \\tau$。这保证会终止，因为当 $\\delta \\to \\infty$ 时，$A+\\delta I \\approx \\delta I$，其主元 $\\sqrt{\\delta}$ 最终将超过任何有限的 $\\tau$。\n    d. 建立了区间 $[\\delta_{low}, \\delta_{high}]$ 后，执行二分搜索。在每次迭代中，计算 $\\delta_{mid} = \\delta_{low} + 0.5(\\delta_{high} - \\delta_{low})$。尝试对 $A+\\delta_{mid}I$ 进行 Cholesky 分解。\n        - 如果成功且主元 $\\ge \\tau$，这意味着 $\\delta_{mid}$ 是一个有效（但可能不是最小）的移位。我们更新区间以搜索更小的移位：$\\delta_{high} \\leftarrow \\delta_{mid}$。\n        - 如果失败或未满足主元条件，则 $\\delta_{mid}$ 太小。我们更新：$\\delta_{low} \\leftarrow \\delta_{mid}$。\n    e. 最终解是 $\\delta_{high}$。此值是在容差范围内找到的最小移位，对于该移位，浮点运算中计算出的分解满足主元条件。\n\n4.  **终止与容差**：当区间宽度 $\\delta_{high} - \\delta_{low}$ 小于预定的绝对容差 $\\varepsilon_{\\delta} > 0$ 时，二分法终止。在双精度算术中，$\\varepsilon_{\\delta}$ 的一个合理选择是一个小数，如 $10^{-12}$。所需的迭代次数相对于初始区间宽度和容差是对数的，保证了有限次终止。",
            "answer": "```python\nimport numpy as np\n\ndef _attempt_cholesky(matrix):\n    \"\"\"\n    Performs an unblocked Cholesky factorization M = LL^T.\n    Returns (L, min_pivot) on success, or (None, -1.0) on breakdown.\n    A breakdown occurs if a non-positive radicand is encountered.\n    \"\"\"\n    n = matrix.shape[0]\n    L = np.zeros_like(matrix, dtype=np.float64)\n\n    for j in range(n):\n        # Calculate sum for the diagonal element L[j, j]\n        s_diag = np.dot(L[j, :j], L[j, :j])\n        \n        radicand = matrix[j, j] - s_diag\n        if radicand = 0:\n            return None, -1.0  # Breakdown\n\n        l_jj = np.sqrt(radicand)\n        L[j, j] = l_jj\n\n        # Calculate elements in the j-th column below the diagonal\n        for i in range(j + 1, n):\n            s_offdiag = np.dot(L[i, :j], L[j, :j])\n            L[i, j] = (matrix[i, j] - s_offdiag) / l_jj\n\n    min_pivot = np.min(np.diag(L))\n    return L, min_pivot\n\ndef find_min_shift(A, tau, eps_delta=1e-12, max_iter=100):\n    \"\"\"\n    Finds the minimal non-negative shift delta such that A + delta*I has a \n    Cholesky factorization with all pivots >= tau.\n    \"\"\"\n    n = A.shape[0]\n    I = np.identity(n)\n\n    # 1. Check if delta = 0 works\n    L_0, min_pivot_0 = _attempt_cholesky(A)\n    if L_0 is not None and min_pivot_0 >= tau:\n        return 0.0\n\n    # 2. Bracket the solution: find delta_high\n    delta_low = 0.0\n    # Initial guess for the upper bound. Expand until it works.\n    delta_high = tau \n    if delta_high == 0.0:  # Handle tau=0 case, though problem states tau > 0\n        delta_high = 1e-6\n    \n    for _ in range(max_iter):\n        L_h, min_pivot_h = _attempt_cholesky(A + delta_high * I)\n        if L_h is not None and min_pivot_h >= tau:\n            break  # Found a valid upper bound\n        delta_high *= 2.0\n    else:\n        # This safeguard should not be triggered for valid inputs\n        raise RuntimeError(\"Failed to find an upper bound for delta.\")\n\n    # 3. Bisection search for the minimal delta\n    for _ in range(max_iter):\n        if delta_high - delta_low  eps_delta:\n            break\n        \n        delta_mid = delta_low + 0.5 * (delta_high - delta_low)\n        if delta_mid == delta_low or delta_mid == delta_high: # Stagnation\n            break\n\n        L_mid, min_pivot_mid = _attempt_cholesky(A + delta_mid * I)\n\n        if L_mid is not None and min_pivot_mid >= tau:\n            # delta_mid is a potential solution, try for smaller\n            delta_high = delta_mid\n        else:\n            # delta_mid is too small\n            delta_low = delta_mid\n    \n    return delta_high\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (np.array([[4, 1, 0], [1, 3, 0.5], [0, 0.5, 2]], dtype=np.float64), 1.0),\n        (np.diag([1e-8, 1, 2]).astype(np.float64), 1e-3),\n        (np.array([[0, 1], [1, 0]], dtype=np.float64), 0.1),\n        (np.diag([0, 2, 3]).astype(np.float64), 0.5)\n    ]\n    \n    results = []\n    for A, tau in test_cases:\n        delta = find_min_shift(A, tau)\n        results.append(delta)\n    \n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}