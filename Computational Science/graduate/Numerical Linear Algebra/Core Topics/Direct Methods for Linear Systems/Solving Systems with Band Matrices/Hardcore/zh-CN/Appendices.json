{
    "hands_on_practices": [
        {
            "introduction": "许多科学和工程应用，尤其是在偏微分方程的离散化中，会产生块三对角线性系统。这个练习将经典的托马斯算法（Thomas algorithm）推广到这些块结构系统，这是一个重要的实践。通过推导块前向消元和后向代入的步骤，并分析其计算复杂性，您将深入理解如何将标量算法的思想应用于块矩阵，并掌握评估其计算效率的方法。",
            "id": "3578839",
            "problem": "考虑一个线性系统，其系数矩阵为块三对角矩阵，块大小为 $m \\times m$，有 $p$ 个块行，\n$$\n\\begin{pmatrix}\nA_{1}  C_{1} \\\\\nB_{2}  A_{2}  C_{2} \\\\\n  \\ddots  \\ddots  \\ddots \\\\\n   B_{p}  A_{p}\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{1} \\\\ x_{2} \\\\ \\vdots \\\\ x_{p}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nf_{1} \\\\ f_{2} \\\\ \\vdots \\\\ f_{p}\n\\end{pmatrix},\n$$\n其中对每个 $i$，块 $A_{i} \\in \\mathbb{R}^{m\\times m}$ 是非奇异的，$B_{i}, C_{i} \\in \\mathbb{R}^{m\\times m}$，而 $x_{i}, f_{i} \\in \\mathbb{R}^{m}$。假设系统是严格块对角占优的，因此无主元高斯消去法在块级别上是良定义的，并保持所有中间舒尔补的非奇异性。\n\n您的任务是：\n- 从块方程以及高斯消去法和舒尔补形成的原理出发，推导块前向消元过程，该过程仅使用与当前对角块相关的求解来消除次对角块 $B_i$（即不显式构造逆矩阵）。然后推导恢复未知块 $x_i$ 的块后向代入过程。\n- 使用一个浮点运算模型，其中一次浮点加、减、乘、除计为一次浮点运算 (flop)，下三角因子的对角线为单位元素，且以下精确成本成立：\n  1. 一个 $m \\times m$ 稠密矩阵的无主元 $\\mathrm{LU}$ 分解成本为 $\\left(\\frac{2}{3} m^{3} - \\frac{1}{2} m^{2} - \\frac{1}{6} m\\right)$ 次浮点运算。\n  2. 求解一个有一个右端项的三角系统成本为 $(2 m^{2} - m)$ 次浮点运算，有 $r$ 个右端项时成本为 $r\\,(2 m^{2} - m)$ 次浮点运算。\n  3. 对于 $D, E, F \\in \\mathbb{R}^{m \\times m}$，形式为 $D \\leftarrow D - E F$ 的融合更新成本为 $2 m^{3}$ 次浮点运算；对于 $d, g \\in \\mathbb{R}^{m}$, $E \\in \\mathbb{R}^{m\\times m}$，形式为 $d \\leftarrow d - E g$ 的融合更新成本为 $2 m^{2}$ 次浮点运算。\n- 在这些假设下，推导由此产生的托马斯算法的块扩展（包括前向扫描和后向代入）所需的总浮点运算次数的闭式解析表达式，作为 $p$ 和 $m$ 的函数。将您的最终答案表示为关于 $p$ 和 $m$ 的单个解析表达式（不要使用大$\\mathcal{O}$符号）。",
            "solution": "用户希望我解决一个数值线性代数问题。\n\n这是我的计划：\n1.  **验证问题陈述**：\n    -   **步骤 1：提取已知条件**：我将列出提示中提供的所有定义、矩阵、向量和假设。\n    -   **步骤 2：验证**：我将检查问题的科学合理性、良定性、客观性及其他标准。这个问题似乎是一个关于块算法的标准数值分析问题。\n        -   它描述了一个块三对角系统。这是科学计算中的一种常见结构，例如来自偏微分方程（PDE）的离散化。\n        -   它要求基于高斯消去法推导一个块算法。这是一种标准技术。\n        -   它给出了一个精确的浮点运算计数模型。这些计数是所述操作的标准近似值。\n        -   严格块对角占优的假设确保了无主元块 LU 分解的存在性和稳定性，这使得问题是良定的。\n        -   目标是推导算法及其计算成本。这是数值线性代数中的一个标准练习。\n    -   **步骤 3：结论**：问题似乎是有效的。这是一个定义明确的数值线性代数数学问题。\n\n2.  **解决问题（如果有效）**：\n    -   **第 1 部分：块算法的推导**\n        -   我将写出系统的块方程。\n        -   第一个方程是 $A_1 x_1 + C_1 x_2 = f_1$。\n        -   对于 $i=2, \\dots, p-1$ 的一般方程是 $B_i x_{i-1} + A_i x_i + C_i x_{i+1} = f_i$。\n        -   最后一个方程是 $B_p x_{p-1} + A_p x_p = f_p$。\n        -   核心思想是执行块高斯消去。这类似于标量托马斯算法（或三对角矩阵算法，TDMA）。\n        -   **前向消元**：\n            -   目标：消除次对角块 $B_i$。\n            -   对于第一个块行 `i=1`：我想用 $x_2$ 来表示 $x_1$。\n                -   $A_1 x_1 = f_1 - C_1 x_2$。\n                -   由于 $A_1$ 是非奇异的，所以 $x_1 = A_1^{-1}(f_1 - C_1 x_2)$。这可以写成 $x_1 = A_1^{-1}f_1 - A_1^{-1}C_1 x_2$。\n                -   让我们定义在前向扫描中更新的新矩阵和向量。我们称它们为 $A_i'$ 和 $f_i'$。这更标准。\n            -   让我们遵循消元过程。\n                -   第一行方程是 $A_1 x_1 + C_1 x_2 = f_1$。\n                -   第二行方程是 $B_2 x_1 + A_2 x_2 + C_2 x_3 = f_2$。\n                -   我们想从第二个方程中消去 $x_1$。\n                -   从第一个方程，我们可以写出 $x_1 = A_1^{-1} (f_1 - C_1 x_2)$。\n                -   将此代入第二个方程：\n                    $B_2 [A_1^{-1} (f_1 - C_1 x_2)] + A_2 x_2 + C_2 x_3 = f_2$\n                    $(A_2 - B_2 A_1^{-1} C_1) x_2 + C_2 x_3 = f_2 - B_2 A_1^{-1} f_1$。\n            -   这定义了更新规则。让我们定义新的矩阵和向量。\n                -   设 $\\tilde{A}_i$ 和 $\\tilde{f}_i$ 为修改后的矩阵和向量。\n                -   从 $\\tilde{A}_1 = A_1$ 和 $\\tilde{f}_1 = f_1$ 开始。\n                -   这个过程有效地生成了新的矩阵 $C'_i$ 和新的向量 $f'_i$。\n                -   让我们将第一个方程重写为 $x_1 = \\tilde{A}_1^{-1}( \\tilde{f}_1 - C_1 x_2)$。这不是标准的方法。\n            -   让我们尝试一种模仿标量算法的不同表述。标量算法修改对角线和右端项。\n                -   标量算法：对于 $i=2, \\dots, p$：\n                    -   $m = b_i / a_{i-1}$\n                    -   $a_i \\leftarrow a_i - m \\cdot c_{i-1}$\n                    -   $f_i \\leftarrow f_i - m \\cdot f_{i-1}$\n            -   让我们将其应用于块情况。乘数将是一个矩阵。\n                -   对于 $i=2, \\dots, p$：\n                    -   乘数矩阵：$M_i = B_i A_{i-1}^{-1}$。\n                    -   更新对角块：$A_i \\leftarrow A_i - M_i C_{i-1} = A_i - B_i A_{i-1}^{-1} C_{i-1}$。\n                    -   更新右端向量：$f_i \\leftarrow f_i - M_i f_{i-1} = f_i - B_i A_{i-1}^{-1} f_{i-1}$。\n            -   问题陈述“不显式构造逆矩阵”。这是一个关键约束。\n            -   因此，我们将求解以 $A_{i-1}$ 为系数矩阵的系统，而不是计算 $A_{i-1}^{-1}$。\n            -   让我们为 $i=2, \\dots, p$ 重新定义前向扫描：\n                1.  定义新矩阵 $A'_i$ 和向量 $f'_i$。让我们从 $A'_1 = A_1$ 和 $f'_1 = f_1$ 开始。\n                2.  对于 $i=2, \\dots, p$，我们想消去 $B_i$。新系统应该看起来像：\n                    $A'_{i-1} x_{i-1} + C_{i-1} x_i = f'_{i-1}$\n                    $A'_i x_i + C_i x_{i+1} = f'_i$\n                3.  让我们从原始方程开始：\n                    $B_{i-1} x_{i-2} + A_{i-1} x_{i-1} + C_{i-1} x_i = f_{i-1}$\n                    $B_i x_{i-1} + A_i x_i + C_i x_{i+1} = f_i$ (对于 $i2$)\n                4.  这有点令人困惑。让我们坚持舒尔补的思想。\n                -   令步骤 $i$ 的修改后系统为：\n                    $$\n                    \\begin{pmatrix}\n                    \\tilde{A}_{i}  C_{i} \\\\\n                    B_{i+1}  A_{i+1}  C_{i+1} \\\\\n                      \\ddots  \\ddots  \\ddots\n                    \\end{pmatrix}\n                    \\begin{pmatrix}\n                    x_{i} \\\\ x_{i+1} \\\\ \\vdots\n                    \\end{pmatrix}\n                    =\n                    \\begin{pmatrix}\n                    \\tilde{f}_{i} \\\\ f_{i+1} \\\\ \\vdots\n                    \\end{pmatrix}\n                    $$\n                -   我们有关系式 $B_i x_{i-1} + \\tilde{A}_i x_i + C_i x_{i+1} = \\tilde{f}_i$。这不完全正确。\n                -   让我们直接遵循消元过程。\n                    -   系统矩阵是 $M$。让我们应用块 LU 分解。\n                        $M = LU$。$L$ 是块下双对角矩阵，$U$ 是块上三对角矩阵。\n                        $$\n                        L = \\begin{pmatrix}\n                        I    \\\\\n                        L_2  I   \\\\\n                          \\ddots  \\ddots  \\\\\n                           L_p  I\n                        \\end{pmatrix}, \\quad\n                        U = \\begin{pmatrix}\n                        U_1  C_1   \\\\\n                          U_2  C_2  \\\\\n                           \\ddots  \\ddots \\\\\n                            U_p\n                        \\end{pmatrix}\n                        $$\n                        $L$ 的对角块是单位矩阵，这是一个块杜利特尔分解。\n                    -   $M_{ij} = (LU)_{ij} = \\sum_k L_{ik} U_{kj}$。\n                    -   对于 $i=1$：$A_1 = I \\cdot U_1 \\implies U_1 = A_1$。\n                    -   对于 $i=2, \\dots, p$：\n                        -   $B_i = L_i U_{i-1} \\implies L_i = B_i U_{i-1}^{-1}$。\n                        -   $A_i = L_i C_{i-1} + I \\cdot U_i \\implies U_i = A_i - L_i C_{i-1} = A_i - B_i U_{i-1}^{-1} C_{i-1}$。\n            -   这是前向消元步骤。它计算矩阵 $U_i$。这些 $U_i$ 是舒尔补。\n            -   让我们写出“不显式构造逆矩阵”的算法：\n                **前向消元（计算 $U_i$）：**\n                1.  $U_1 = A_1$。\n                2.  对于 $i=2, \\dots, p$：\n                    a. 求解矩阵方程 $U_{i-1}X = B_i$ 中的矩阵 $X$。这不对，乘数是 $B_i U_{i-1}^{-1}$。我们需要求解 $X U_{i-1} = B_i$。或者等价地，求解 $U_{i-1}^T X^T = B_i^T$。让我们称解为 $L_i$。\n                    b. 计算 $U_i = A_i - L_i C_{i-1}$。\n            -   这并非通常的做法。需要的是 $B_i U_{i-1}^{-1}$ 这个运算。这可以计算为 $( (U_{i-1}^{-1})^T B_i^T )^T$。所以，求解 $U_{i-1}^T Z = B_i^T$ 得到 $Z$，那么乘数就是 $Z^T$。这是一个有 $m$ 个右端项的系统。让我们称乘数为 $M_i = B_i U_{i-1}^{-1}$。那么 $U_i = A_i - M_i C_{i-1}$。\n            -   一种不同且更直接的组织计算的方式是先计算 $U_{i-1}^{-1}C_{i-1}$。令 $W_{i-1} = U_{i-1}^{-1}C_{i-1}$。这通过求解 $U_{i-1}W_{i-1} = C_{i-1}$ 得到矩阵 $W_{i-1}$。然后 $U_i = A_i - B_i W_{i-1}$。\n            -   现在让我们将此应用于右端项。系统是 $LUx = f$。设 $y = Ux$。我们首先解 $Ly=f$。\n                -   $y_1 = f_1$。\n                -   $L_2 y_1 + y_2 = f_2 \\implies y_2 = f_2 - L_2 y_1 = f_2 - (B_2 U_1^{-1}) y_1$。\n                -   通常，对于 $i=2, \\dots, p$：\n                    $y_i = f_i - L_i y_{i-1} = f_i - (B_i U_{i-1}^{-1}) y_{i-1}$。\n                **前向代入（计算 $y_i$）：**\n                1. $y_1 = f_1$。\n                2. 对于 $i=2, \\dots, p$：\n                   a. 求解向量方程 $U_{i-1} z = y_{i-1}$ 得到向量 $z$。这给出 $z=U_{i-1}^{-1}y_{i-1}$。\n                   b. $y_i = f_i - B_i z$。\n            -   这似乎是基于提示的一个有效算法。它对原始矩阵 $M$ 执行块 LU 分解为 $M=LU$，其中 $L$ 是对角线上为单位块的块下双对角矩阵，而 $U$ 是块上三对角矩阵。然后它求解 $Ly=f$，接着求解 $Ux=y$。我概述的过程同时计算 $U$ 的块和向量 $y$。\n\n        -   **算法推导**\n            块三对角系统可以写成一系列方程：\n            $$A_1 x_1 + C_1 x_2 = f_1$$\n            $$B_i x_{i-1} + A_i x_i + C_i x_{i+1} = f_i, \\quad \\text{对于 } i=2, \\ldots, p-1$$\n            $$B_p x_{p-1} + A_p x_p = f_p$$\n            块高斯消去法（托马斯算法的块版本）将此系统转换为上块双对角系统。这等价于对系数矩阵 $M$ 进行块 LU 分解，其中 $M=LU$，$L$ 是其对角线上为单位矩阵的块下双对角矩阵，$U$ 是块上三对角矩阵。系统 $Mx=f$ 变为 $LUx=f$。我们首先解 $Ly=f$（前向扫描），然后解 $Ux=y$（后向扫描）。\n\n            分解 $M=LU$ 得到 $U$ 的块的递推关系：\n            $$U_1 = A_1$$\n            $$U_i = A_i - B_i U_{i-1}^{-1} C_{i-1}, \\quad \\text{对于 } i=2, \\ldots, p$$\n            求解 $Ly=f$ 的前向扫描得到：\n            $$y_1 = f_1$$\n            $$y_i = f_i - B_i U_{i-1}^{-1} y_{i-1}, \\quad \\text{对于 } i=2, \\ldots, p$$\n            矩阵 $U_i$ 是舒尔补。为避免显式矩阵求逆，我们用线性系统的解来替换像 $U_{i-1}^{-1}C_{i-1}$ 这样的表达式。\n\n            **块前向消元：**\n            前向扫描计算矩阵 $U_i$ 和向量 $y_i$。\n            1. 初始化：$U_1 = A_1$, $y_1 = f_1$。\n            2. 对于 $i$ 从 $2$ 到 $p$：\n               a. 计算 $U_i$：求解矩阵方程 $U_{i-1} W_{i-1} = C_{i-1}$ 得到矩阵 $W_{i-1}$。然后计算 $U_i = A_i - B_i W_{i-1}$。\n               b. 计算 $y_i$：求解向量方程 $U_{i-1} g_{i-1} = y_{i-1}$ 得到向量 $g_{i-1}$。然后计算 $y_i = f_i - B_i g_{i-1}$。\n\n            在前向扫描之后，我们得到块上双对角系统 $Ux=y$：\n            $$\n            \\begin{pmatrix}\n            U_{1}  C_{1} \\\\\n              U_{2}  C_{2} \\\\\n                \\ddots  \\ddots \\\\\n                  U_{p}\n            \\end{pmatrix}\n            \\begin{pmatrix}\n            x_{1} \\\\ x_{2} \\\\ \\vdots \\\\ x_{p}\n            \\end{pmatrix}\n            =\n            \\begin{pmatrix}\n            y_{1} \\\\ y_{2} \\\\ \\vdots \\\\ y_{p}\n            \\end{pmatrix}\n            $$\n            注意：矩阵 $U$ 的上对角块是 $C_i$。在我最初写的 LU 公式中，$U$ 的上对角线与原始矩阵的上对角线相匹配。让我重新检查一下。\n            $M_{i,i} = L_i C_{i-1} + U_i$。不，那是用于三对角矩阵的。\n            对于块三对角矩阵：\n            $M_{i,i} = L_i U'_{i-1, i} + I U'_{i,i}$。$U'$ 有块 $U'_{i,i}$ 和 $U'_{i, i+1}$。\n            让我们匹配项 $M=LU$：\n            $A_1 = U_1$。（我将 $U_{ii}$ 重命名为 $U_i$，$U_{i,i+1}$ 重命名为 $C'_i$）\n            $C_1 = C'_1$。\n            $B_i = L_i U_{i-1}$。\n            $A_i = L_i C'_{i-1} + U_i$。\n            $C_i = C'_i$。\n            这意味着对所有 $i$ 都有 $C'_i = C_i$。\n            所以 $L_i = B_i U_{i-1}^{-1}$。\n            且 $U_i = A_i - L_i C_{i-1} = A_i - B_i U_{i-1}^{-1} C_{i-1}$。这是正确的。\n            系统 $Ux=y$ 是：\n            $$U_i x_i + C_i x_{i+1} = y_i, \\quad \\text{对于 } i=1, \\ldots, p-1$$\n            $$U_p x_p = y_p$$\n            这是相容的。\n\n            **块后向代入：**\n            后向扫描从 $x_p$ 开始求解未知向量 $x_i$。\n            1. 求解 $U_p x_p = y_p$ 得到 $x_p$。\n            2. 对于 $i$ 从 $p-1$ 向下到 $1$：\n               a. 计算更新后的右端项：$z_i = y_i - C_i x_{i+1}$。\n               b. 求解 $U_i x_i = z_i$ 得到 $x_i$。\n\n            这样就完成了算法的推导。\n\n    -   **第 2 部分：浮点运算计数推导**\n        -   我需要分析整个算法的浮点运算计数：前向扫描 + 后向代入。\n        -   为了求解形如 $U_k Z = K$ 的线性系统，其中 $U_k$ 是一个稠密的 $m \\times m$ 矩阵，我们首先对 $U_k$ 进行 LU 分解，然后对 $K$ 的每一列使用前向和后向代入求解。\n\n        -   **基本操作的成本：**\n            令 $C_{LU}(m) = \\frac{2}{3}m^3 - \\frac{1}{2}m^2 - \\frac{1}{6}m$ 为一个 $m \\times m$ LU 分解的成本。\n            令 $C_{Solve}(m, r) = r(2m^2 - m)$ 为在给定 LU 因子的前提下，求解一个有 $r$ 个右端项的 $m \\times m$ 系统的成本。\n            令 $C_{MM}(m) = 2m^3$ 为矩阵-矩阵更新 $D \\leftarrow D - EF$ 的成本。\n            令 $C_{MV}(m) = 2m^2$ 为矩阵-向量更新 $d \\leftarrow d - Eg$ 的成本。\n\n        -   **前向扫描分析（$i=2, \\dots, p$）：**\n            这个循环运行 $p-1$ 次。在每次迭代 $i$ 中，算法对 $U_{i-1}$ 进行操作。所以，它涉及 $U_1, U_2, \\ldots, U_{p-1}$。\n            对于每个 $i \\in \\{2, \\ldots, p\\}$：\n            1.  $U_{i-1}$ 的 LU 分解：矩阵 $U_{i-1}$ 是在前一步计算的。我们需要它的 LU 因子来求解。因此，在第 $i$ 步，我们分解 $U_{i-1}$。成本：$C_{LU}(m)$。\n            2.  求解 $U_{i-1}W_{i-1} = C_{i-1}$：$m$ 个右端项。成本：$C_{Solve}(m, m) = m(2m^2-m) = 2m^3 - m^2$。\n            3.  求解 $U_{i-1}g_{i-1} = y_{i-1}$：1 个右端项。成本：$C_{Solve}(m, 1) = 2m^2 - m$。\n            4.  更新 $U_i = A_i - B_i W_{i-1}$：成本：$C_{MM}(m) = 2m^3$。\n            5.  更新 $y_i = f_i - B_i g_{i-1}$：成本：$C_{MV}(m) = 2m^2$。\n\n            前向循环单次迭代的总成本：\n            $C_{fwd\\_step} = C_{LU}(m) + (2m^3 - m^2) + (2m^2 - m) + 2m^3 + 2m^2$\n            $C_{fwd\\_step} = (\\frac{2}{3}m^3 - \\frac{1}{2}m^2 - \\frac{1}{6}m) + 4m^3 + 3m^2 - m$\n            $C_{fwd\\_step} = \\frac{14}{3}m^3 + \\frac{5}{2}m^2 - \\frac{7}{6}m$。\n\n            前向循环运行 $p-1$ 次（对于 $i=2, \\dots, p$）。执行的 LU 分解是针对 $U_1, U_2, \\ldots, U_{p-1}$ 的。\n            前向扫描总成本：\n            $F_{fwd} = (p-1) \\left( \\frac{14}{3}m^3 + \\frac{5}{2}m^2 - \\frac{7}{6}m \\right)$。\n\n        -   **后向扫描分析：**\n            1.  求解 $x_p$：这需要求解 $U_p x_p = y_p$。矩阵 $U_p$ 在前向扫描的最后一步计算得出，但其 LU 分解尚未进行。\n                -   $U_p$ 的 LU 分解：$C_{LU}(m) = \\frac{2}{3}m^3 - \\frac{1}{2}m^2 - \\frac{1}{6}m$。\n                -   用 1 个右端项求解：$C_{Solve}(m, 1) = 2m^2 - m$。\n                -   $x_p$ 的成本：$C_{x_p} = C_{LU}(m) + C_{Solve}(m, 1) = (\\frac{2}{3}m^3 - \\frac{1}{2}m^2 - \\frac{1}{6}m) + (2m^2 - m) = \\frac{2}{3}m^3 + \\frac{3}{2}m^2 - \\frac{7}{6}m$。\n            2.  求解 $x_{p-1}, \\ldots, x_1$：循环从 $i=p-1$ 向下到 $1$ 运行，总共 $p-1$ 次迭代。\n                对于每个 $i \\in \\{p-1, \\ldots, 1\\}$：\n                a.  更新右端项 $z_i = y_i - C_i x_{i+1}$：成本：$C_{MV}(m) = 2m^2$。\n                b.  求解 $U_i x_i = z_i$：$U_i$ 的 LU 因子（对于 $i=1, \\dots, p-1$）已在前向扫描期间计算并存储。我们只需执行代入。成本：$C_{Solve}(m, 1) = 2m^2 - m$。\n                -   后向循环单次迭代的成本：$C_{back\\_step} = 2m^2 + (2m^2 - m) = 4m^2 - m$。\n            后向循环的总成本（$i=p-1, \\dots, 1$）：\n            $F_{back\\_loop} = (p-1)(4m^2 - m)$。\n\n        -   **总浮点运算计数：**\n            总成本是前向扫描成本、求解 $x_p$ 的成本以及后向扫描其余部分的成本之和。\n            $F(p,m) = F_{fwd} + C_{x_p} + F_{back\\_loop}$\n            $F(p,m) = (p-1) \\left( \\frac{14}{3}m^3 + \\frac{5}{2}m^2 - \\frac{7}{6}m \\right) + \\left( \\frac{2}{3}m^3 + \\frac{3}{2}m^2 - \\frac{7}{6}m \\right) + (p-1)(4m^2 - m)$。\n\n            我们按 $m$ 的幂次对各项进行分组：\n            -   $m^3$ 项：\n                $(p-1)\\frac{14}{3}m^3 + \\frac{2}{3}m^3 = \\left(\\frac{14p - 14 + 2}{3}\\right)m^3 = \\left(\\frac{14p - 12}{3}\\right)m^3 = \\left(\\frac{14}{3}p - 4\\right)m^3$。\n            -   $m^2$ 项：\n                $(p-1)\\frac{5}{2}m^2 + \\frac{3}{2}m^2 + (p-1)4m^2 = \\left(\\frac{5p-5}{2} + \\frac{3}{2} + 4p - 4\\right)m^2 = \\left(\\frac{5p-2}{2} + 4p - 4\\right)m^2 = \\left(\\frac{5p-2+8p-8}{2}\\right)m^2 = \\left(\\frac{13p-10}{2}\\right)m^2 = \\left(\\frac{13}{2}p - 5\\right)m^2$。\n            -   $m$ 项：\n                $-(p-1)\\frac{7}{6}m - \\frac{7}{6}m - (p-1)m = \\left(-\\frac{7p-7}{6} - \\frac{7}{6} - p + 1\\right)m = \\left(-\\frac{7p}{6} + \\frac{7}{6} - \\frac{7}{6} - p + 1\\right)m = \\left(-\\frac{7p}{6} - p + 1\\right)m = \\left(-\\frac{13p}{6} + 1\\right)m$。\n\n            将这些项组合起来，得到总浮点运算次数作为 $p$ 和 $m$ 的函数：\n            $F(p, m) = \\left(\\frac{14}{3}p - 4\\right)m^3 + \\left(\\frac{13}{2}p - 5\\right)m^2 + \\left(1 - \\frac{13}{6}p\\right)m$。",
            "answer": "$$\n\\boxed{\\left(\\frac{14}{3}p - 4\\right)m^3 + \\left(\\frac{13}{2}p - 5\\right)m^2 + \\left(1 - \\frac{13}{6}p\\right)m}\n$$"
        },
        {
            "introduction": "托马斯算法及其块版本虽然高效，但其数值稳定性通常依赖于矩阵的对角占优等特殊性质。在更一般的情况下，为了保证稳定性，部分主元法是必不可不可少的。这个练习探讨了在带状LU分解中引入受限主元选择的实际问题，分析了主元选择如何改变求解过程，并量化了它对数据移动（行交换）带来的额外开销。",
            "id": "3578824",
            "problem": "设 $n \\in \\mathbb{N}$，且设 $A \\in \\mathbb{R}^{n \\times n}$ 是一个非奇异带状矩阵，其下带宽为 $l$，上带宽为 $u$，即当 $i - j  l$ 或 $j - i  u$ 时，$a_{ij} = 0$，其中 $1 \\leq l \\leq n - 1$ 且 $u \\geq 0$。假设执行了限制在带内进行部分主元选取的高斯消去法，过程如下：在步骤 $k \\in \\{1,2,\\dots,n-1\\}$，从第 $k,k+1,\\dots,\\min(n,k+l)$ 行中选择主元，并在必要时通过行交换将主元行移动到位置 $k$。假设分解成功进行且没有中断，得到一个分解 $P A = L U$，其中 $P$ 是一个编码了行交换序列的置换矩阵，$L$ 是单位下三角矩阵，$U$ 是上三角矩阵。\n\n你的任务是：\n\n1. 仅使用带状矩阵、置换矩阵和三角矩阵的定义，以及 $P A = L U$ 这一性质，推导出一个正确且完整的程序，用于对给定的右端项（RHS）$b \\in \\mathbb{R}^{n}$，恢复线性方程组 $A x = b$ 的解 $x \\in \\mathbb{R}^{n}$，并且在求解过程中要保持带状结构。证明为什么这些步骤能产生精确解。\n\n2. 在悲观情景下，即在每个消元步骤 $k \\in \\{1,2,\\dots,n-1\\}$，所选主元在允许的窗口内恰好位于第 $\\min(n,k+l)$ 行，假设每次行交换 $k \\leftrightarrow p$（其中 $p  k$）都通过一系列相邻行的置换来物理实现，以保持带状矩阵的存储局部性。推导以下量的封闭形式解析表达式：\n   - 逻辑行交换的总次数（即主元行与当前行不同的消元步骤数），以及\n   - 在整个分解过程中实际执行的相邻行交换的总次数，\n作为 $n$ 和 $l$ 的函数。\n\n将你的最终答案表示为由这两个量组成的有序对。不需要四舍五入。不需要单位。",
            "solution": "将通过首先提取所有给定信息，然后根据有效科学问题的既定标准对其进行检查来验证该问题。\n\n### 步骤 1：提取已知条件\n- $A \\in \\mathbb{R}^{n \\times n}$ 是一个非奇异带状矩阵。\n- $n \\in \\mathbb{N}$。\n- 下带宽为 $l$，其中 $1 \\leq l \\leq n - 1$。\n- 上带宽为 $u$，其中 $u \\geq 0$。\n- 带状结构由 $a_{ij} = 0$ 定义，条件是 $i - j  l$ 或 $j - i  u$。\n- 执行了带有限制性部分主元选取的高斯消元。\n- 在步骤 $k \\in \\{1, 2, \\dots, n-1\\}$，主元从第 $k, k+1, \\dots, \\min(n, k+l)$ 行中选择。\n- 成功计算出分解 $P A = L U$，其中 $P$ 是一个置换矩阵，$L$ 是单位下三角矩阵，$U$ 是上三角矩阵。\n- 对于第 2 部分，假设一个悲观情景：在每一步 $k$，主元都从第 $\\min(n, k+l)$ 行中选择。\n- 对于第 2 部分，行交换 $k \\leftrightarrow p$（其中 $p  k$）通过一系列相邻置换来实现。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题根据以下标准进行评估：\n\n- **科学基础**：该问题牢固地建立在数值线性代数领域。带状矩阵、LU分解和主元策略是该领域的基本概念。其前提在事实上是健全的，并基于已建立的数学原理。\n- **适定性**：问题结构清晰。第 1 部分要求一个标准程序（给定 LU 分解求解方程组）并附带证明。第 2 部分要求在一组明确定义的假设下计算特定量。对 $n$ 和 $l$ 的约束确保了计算是明确定义的。两部分都存在唯一的、有意义的解。\n- **客观性**：问题以精确、形式化的数学语言陈述，没有歧义或主观论断。\n\n该问题不存在任何无效性缺陷：\n1.  **科学或事实上的不健全**：没有违反数学逻辑或科学原理的情况。\n2.  **非形式化或不相关**：问题是直接可形式化的，并且是其指定主题的核心。\n3.  **不完整或矛盾的设置**：设置是完整且自洽的。条件 $1 \\leq l \\leq n-1$ 至关重要且规定正确。\n4.  **不现实或不可行**：条件在数学上和算法上都是现实的。\n5.  **不适定或结构不良**：问题是适定的。\n6.  **伪深刻、琐碎或同义反复**：问题需要实质性的推理，特别是对于第 2 部分的推导。\n7.  **超出科学可验证性**：结果是可以通过数学推导和验证的。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供完整解答。\n\n---\n\n### 第 1 部分：求解 $A x = b$ 的过程\n给定线性方程组 $A x = b$ 和分解 $P A = L U$。\n\n1.  **初始变换**：由于置换矩阵 $P$ 是可逆的（其中 $P^{-1} = P^T$），原始方程 $A x = b$ 等价于预乘后的系统 $P A x = P b$。向量 $P b$ 是通过对向量 $b$ 应用在分解过程中对矩阵 $A$ 执行的相同行交换序列得到的。这些交换由主元策略决定，并编码在 $P$ 中。\n\n2.  **代入**：将分解 $P A = L U$ 代入变换后的系统：\n    $$L U x = P b$$\n    通过引入一个中间向量 $y \\in \\mathbb{R}^n$，该方程可以分两个阶段求解。\n\n3.  **两阶段求解**：设 $y = U x$。系统变成两个独立的、更简单的系统：\n    - 阶段 1：$L y = P b$\n    - 阶段 2：$U x = y$\n\n4.  **阶段 1：前向代入**：\n    第一个系统 $L y = P b$ 用于求解 $y$。设 $b' = P b$。由于 $L$ 是一个单位下三角矩阵，该系统可以通过前向代入法求解。$y$ 的分量按从 $y_1$ 到 $y_n$ 的顺序计算。\n    $$y_i = b'_i - \\sum_{j=1}^{i-1} l_{ij} y_j$$\n    应用于具有下带宽 $l$ 的带状矩阵的带主元的高斯消元过程，会产生一个同样具有下带宽 $l$ 的矩阵 $L$。也就是说，当 $i - j  l$ 时，$l_{ij} = 0$。这个性质允许对求和进行截断，从而保持带状结构：\n    $$y_i = b'_i - \\sum_{j=\\max(1, i-l)}^{i-1} l_{ij} y_j \\quad \\text{对于 } i = 1, 2, \\dots, n$$\n    （对于 $i=1$，求和为空，所以 $y_1 = b'_1$。）\n\n5.  **阶段 2：后向代入**：\n    第二个系统 $U x = y$ 用于求解最终解 $x$。由于 $U$ 是一个上三角矩阵，该系统通过后向代入法求解。$x$ 的分量按从 $x_n$ 到 $x_1$ 的逆序计算。\n    $$x_i = \\frac{1}{u_{ii}} \\left( y_i - \\sum_{j=i+1}^{n} u_{ij} x_j \\right)$$\n    主元策略可能会增加矩阵的上带宽。如果在步骤 $k$，第 $k$ 行与第 $k+d$ 行交换（其中 $d \\leq l$），则第 $k+d$ 行的元素被带入第 $k$ 行。原始的第 $k+d$ 行的非零元素最多到第 $(k+d)+u$ 列。因此，新的第 $k$ 行的非零元素也可能到这一列。这意味着 $U$ 的上带宽，我们称之为 $u'$，最多可以为 $u+l$。考虑到这种带状结构，后向代入公式变为：\n    $$x_i = \\frac{1}{u_{ii}} \\left( y_i - \\sum_{j=i+1}^{\\min(n, i+u')} u_{ij} x_j \\right) \\quad \\text{对于 } i = n, n-1, \\dots, 1$$\n    （对于 $i=n$，求和为空，所以 $x_n = y_n/u_{nn}$。）\n\n**证明**：该过程是精确的，因为它基于一系列等价变换。原始系统 $A x = b$ 等价于 $P A x = P b$。代入 $P A = L U$ 是一个恒等式。分解为两个三角系统是有效的。由于 $A$ 非奇异且 $P$ 非奇异，因此 $L U = P A$ 也必须是非奇异的。这意味着 $\\det(L)\\det(U) = \\det(P)\\det(A) \\neq 0$。由于 $L$ 是单位下三角矩阵，$\\det(L)=1$。因此，$\\det(U) \\neq 0$，这意味着对所有 $i$ 都有 $u_{ii} \\neq 0$，所以 $U$ 是非奇异的。$L$ 和 $U$ 的非奇异性保证了 $y$ 和 $x$ 的唯一解存在，并且可以分别通过前向和后向代入法找到。\n\n### 第 2 部分：交换和置换次数\n在悲观情景下，在每个消元步骤 $k \\in \\{1, 2, \\dots, n-1\\}$，主元行是 $p_k = \\min(n, k+l)$。\n\n**(a) 逻辑行交换的总次数**\n\n在步骤 $k$ 发生逻辑行交换，如果主元行不是第 $k$ 行，即 $p_k  k$。我们需要计算满足此条件的步骤 $k \\in \\{1, 2, \\dots, n-1\\}$ 的数量。\n\n主元行是 $p_k = \\min(n, k+l)$。给定 $l \\geq 1$。\n- 对于任何 $k \\in \\{1, \\dots, n-1\\}$，我们有 $k+l  k$。\n- 同样，由于 $k \\leq n-1$，我们有 $n  k$。\n- 因此，$p_k = \\min(n, k+l)$ 将总是严格大于 $k$。\n\n由于对于所有从 $1$ 到 $n-1$ 的 $k$，$p_k  k$，因此在每个消元步骤都会发生逻辑行交换。消元步骤的总数是 $n-1$。\n因此，逻辑行交换的总次数是 $n-1$。\n\n**(b) 相邻行置换的总次数**\n\n一个通过一系列相邻置换将主元行 $p_k$ 移动到位置 $k$ 的交换（对于 $p_k  k$）需要 $p_k - k$ 次这样的置换。这对应于循环移位从 $k$ 到 $p_k$ 的行块。相邻置换的总次数 $S$，是这些次数在所有消元步骤上的总和。\n$$S = \\sum_{k=1}^{n-1} (p_k - k) = \\sum_{k=1}^{n-1} (\\min(n, k+l) - k)$$\n为了计算这个和，我们根据 $\\min$ 函数中的条件将其拆分。转换点发生在 $k+l  n$，即 $k  n-l$ 时。给定 $1 \\leq l \\leq n-1$，拆分点 $n-l$ 在范围 $[1, n-1]$ 内。\n\n和可以写成：\n$$S = \\sum_{k=1}^{n-l} (\\min(n, k+l) - k) + \\sum_{k=n-l+1}^{n-1} (\\min(n, k+l) - k)$$\n\n**情况 1：$k \\leq n-l$**\n在此范围内，$k+l \\leq n$，所以 $\\min(n, k+l) = k+l$。和中的项为 $(k+l) - k = l$。\n和的第一部分是：\n$$\\sum_{k=1}^{n-l} l = l \\cdot (n-l)$$\n\n**情况 2：$k  n-l$**\n在此范围内，$k+l  n$，所以 $\\min(n, k+l) = n$。和中的项为 $n-k$。\n和的第二部分是：\n$$\\sum_{k=n-l+1}^{n-1} (n-k)$$\n我们来做一个换元。设 $j = n-k$。当 $k$ 从 $n-l+1$ 到 $n-1$ 时，$j$ 从 $n-(n-l+1) = l-1$ 降到 $n-(n-1)=1$。\n所以和变为：\n$$\\sum_{j=1}^{l-1} j = \\frac{(l-1)l}{2}$$\n\n**总和**\n将两部分合并，得到相邻置换的总次数：\n$$S = l(n-l) + \\frac{l(l-1)}{2}$$\n化简此表达式：\n$$S = nl - l^2 + \\frac{l^2 - l}{2} = \\frac{2nl - 2l^2 + l^2 - l}{2} = \\frac{2nl - l^2 - l}{2}$$\n$$S = \\frac{l(2n - l - 1)}{2}$$\n\n所需的两个量是逻辑行交换的总次数和相邻行置换的总次数。\n逻辑交换次数 $= n-1$。\n相邻置换次数 $= \\frac{l(2n-l-1)}{2}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} n-1  \\frac{l(2n - l - 1)}{2} \\end{pmatrix}}$$"
        },
        {
            "introduction": "对于数值稳定性至关重要的病态问题或最小二乘问题，QR分解通常优于LU分解。这个练习将带您探索一种更稳健的替代方案：使用吉文斯旋转（Givens rotations）对带状矩阵进行QR分解。您将需要推导该方法的精确计算成本和内存需求，并从理论上比较其与正规方程法在求解最小二乘问题时的稳定性差异，从而深化对不同数值方法优劣的认识。",
            "id": "3578840",
            "problem": "设 $A \\in \\mathbb{R}^{n \\times n}$ 是一个对称半带宽为 $k$ 的实方带状矩阵（即，当 $|i-j|  k$ 时，$a_{ij} = 0$），并假设 $1 \\leq k \\leq \\left\\lfloor \\frac{n-1}{2} \\right\\rfloor$ 以使 $n \\geq 2k+1$。考虑使用逐列应用的 Givens 旋转来消去次对角线元素，从而计算 $QR$ 分解 $A = QR$。采用以下在数值线性代数中为标准的运算计数模型：\n- 每个用于消去元素 $a_{ij}$（其中 $ij$）的 Givens 旋转作用于所涉及的两行的连续列 $j, j+1, \\dots, \\min\\{n,\\, i+k\\}$，并且将该旋转应用于这对两行中的一列需要 $6$ 次浮点运算（flops）。忽略计算旋转参数的成本。\n- 一个具有 $p$ 条超对角线的带状存储上三角因子表示为一个 $(p+1) \\times n$ 的带状数组，即需要 $(p+1)n$ 个浮点字。\n- 一个 Givens 旋转通过其余弦-正弦对 $\\{c,s\\}$ 进行隐式存储，需要 $2$ 个浮点字。\n\n从这些定义和 $A$ 的带状模式出发，并且不借助于任何现成的公式，完成以下任务：\n1.  推导在使用上述 Givens 旋转方案形成 $R$ 时的精确浮点运算数 $F(n,k)$ 的闭式表达式，该表达式在 $n \\geq 2k+1$ 条件下有效。\n2.  推导以适用于最小二乘解的隐式形式存储最终因子所需的总浮点字数 $M(n,k)$ 的闭式表达式，这些因子包括带状存储的上三角因子 $R$ 和所有存储的 Givens 参数 $\\{c,s\\}$，并假设分解后 $R$ 最多有 $2k$ 条超对角线。\n3.  对于超定最小二乘问题 $\\min_{x} \\|Ax - b\\|_{2}$，比较使用 Givens 旋转的 $QR$ 分解与通过带状分解（等效于对 $A^{\\mathsf{T}}A$ 进行带状 LU 或 Cholesky 分解）求解法方程 $(A^{\\mathsf{T}}A)x = A^{\\mathsf{T}}b$ 的稳定性。使用关于谱条件数 $\\kappa_{2}(A)$ 和单位舍入 $\\epsilon$ 的标准主阶前向误差特征，推导法方程方法的主导前向误差界与 $QR$ 方法的主导前向误差界之比 $\\rho(\\kappa_{2}(A))$。\n\n将您的最终结果表示为一个单行矩阵，其条目顺序为 $\\big(F(n,k),\\, M(n,k),\\, \\rho(\\kappa_{2}(A))\\big)$。不需要进行数值计算；请提供精确的闭式表达式。",
            "solution": "用户提供的问题是一个关于使用 Givens 旋转对带状矩阵进行 QR 分解的数值线性代数三部分问题。\n\n### 第 1 步：提取已知信息\n- **矩阵**：$A \\in \\mathbb{R}^{n \\times n}$ 是一个对称半带宽为 $k$ 的实方矩阵。这意味着对于所有满足 $|i-j|  k$ 的 $i,j$，$a_{ij} = 0$。\n- **维度**：$1 \\leq k \\leq \\left\\lfloor \\frac{n-1}{2} \\right\\rfloor$，这意味着 $n \\geq 2k+1$。\n- **算法**：通过逐列使用 Givens 旋转消去次对角线元素来计算 QR 分解 $A=QR$。\n- **浮点运算计数模型**：\n    - 忽略计算 Givens 旋转参数 $\\{c,s\\}$ 的成本。\n    - 一个用于消去元素 $a_{ij}$ ($ij$) 的 Givens 旋转作用于行，其成本由其对列的作用指定。受影响的列是 $j, j+1, \\dots, \\min\\{n, i+k\\}$。\n    - 将旋转应用于所涉及的两行中的一列的成本是 $6$ 次浮点运算（flops）。\n- **内存存储模型**：\n    - 上三角因子 $R$ 最多有 $p=2k$ 条超对角线，并存储在一个 $(p+1) \\times n$ 数组中，需要 $(2k+1)n$ 个浮点字。\n    - 每个 Givens 旋转存储为一个 $\\{c,s\\}$ 对，需要 $2$ 个浮点字。\n- **任务**：\n    1.  推导计算 $R$ 的精确浮点运算数 $F(n,k)$。\n    2.  推导存储 $R$ 和所有 Givens 旋转所需的总内存 $M(n,k)$。\n    3.  推导通过法方程与 QR 分解解决最小二乘问题的主导前向误差界之比 $\\rho(\\kappa_{2}(A))$。\n\n### 第 2 步：使用提取的已知信息进行验证\n该问题在数值线性代数领域具有科学依据。带状矩阵、QR 分解、Givens 旋转、浮点运算计数和稳定性分析等概念都是标准内容。所提供的成本和存储模型是用于算法分析的典型简化。上三角因子 $R$ 的上半带宽为 $2k$ 这一前提，是将 Givens 旋转应用于下半带宽为 $k$ 且上半带宽为 $k$ 的矩阵时的一个已知结果。关于稳定性的问题比较了两种标准方法（QR 与法方程），这是数值分析中的一个经典主题。该问题是自洽的、客观的且提法恰当。不存在会妨碍形式化求解的矛盾或歧义。\n\n### 第 3 步：判断与行动\n问题有效。将提供完整的解决方案。\n\n### 第 1 部分：浮点运算数 $F(n,k)$\n\n计算逐列进行，从 $j=1$ 到 $n-1$。对于每一列 $j$，我们消去次对角线元素 $a_{ij}$，其中 $j+1 \\leq i \\leq \\min(n, j+k)$。我们假设采用标准程序，即元素 $a_{ij}$ 通过涉及行 $i-1$ 和行 $i$ 的旋转被消去。问题陈述给出了这样一次旋转的成本。\n\n设计用于消去位置 $(i,j)$ 处元素的单个 Givens 旋转被应用于列 $m = j, j+1, \\dots, \\min(n, i+k)$。\n该旋转应用的列数为 $\\min(n, i+k) - j + 1$。\n这一次旋转的成本是 $6 \\times (\\min(n, i+k) - j + 1)$ 次浮点运算。\n\n为了找到总浮点运算数 $F(n,k)$，我们必须将此成本对所有消去操作求和。消去操作由列 $j$ 和行 $i$ 索引。\n$$F(n,k) = \\sum_{j=1}^{n-1} \\sum_{i=j+1}^{\\min(n, j+k)} 6 \\left( \\min(n, i+k) - j + 1 \\right)$$\n我们可以在约束 $n \\geq 2k+1$ 下，根据 $\\min$ 函数的行为，将 $j$ 的范围分为三个区域来分析这个和。\n\n1.  **主块 ($1 \\leq j \\leq n-2k$):**\n    对于 $j$ 的这个范围，我们有 $j+k \\leq n-k  n$ 和 $j+2k \\leq n$。\n    内层循环的上限是 $\\min(n, j+k) = j+k$。\n    对于内层循环中的任何 $i$，$j+1 \\leq i \\leq j+k$，我们有 $i+k \\leq j+2k \\leq n$，所以 $\\min(n, i+k)=i+k$。\n    此块中单列 $j$ 的成本是：\n    $$C_j = \\sum_{i=j+1}^{j+k} 6(i+k-j+1)$$\n    令 $s=i-j$。求和是对 $s=1, \\dots, k$ 进行的。\n    $$C_j = 6 \\sum_{s=1}^{k} (s+j+k-j+1) = 6 \\sum_{s=1}^{k} (s+k+1)$$\n    这是一个算术级数的和：$6 \\left( k(k+1) + \\frac{k(k+1)}{2} \\right) = 6 \\left( \\frac{3k(k+1)}{2} \\right) = 9k(k+1)$。\n    在此范围内的所有 $j$，此成本是恒定的。这样的列数为 $n-2k$。\n    此块的总浮点运算数是 $F_1 = (n-2k) \\cdot 9k(k+1)$。\n\n2.  **尾块 ($n-k+1 \\leq j \\leq n-1$):**\n    对于这个范围，$j+k  n$。内层循环的上限是 $\\min(n, j+k)=n$。\n    在列 $j$ 中要消去的元素数量是 $n-j$。所以循环是 $i=j+1, \\dots, n$。\n    对于此循环中的任何 $i$，$i \\geq j+1  n-k+1$，所以 $i+k  n+1$。因此，$\\min(n,i+k)=n$。\n    列 $j$ 的成本是：\n    $$C_j = \\sum_{i=j+1}^{n} 6(n - j + 1) = 6(n-j+1) \\cdot (n-(j+1)+1) = 6(n-j+1)(n-j)$$\n    为了找到此块的总浮点运算数，令 $m = n-j$。当 $j$ 从 $n-k+1$ 到 $n-1$ 时，$m$ 从 $k-1$ 递减到 $1$。\n    $$F_3 = \\sum_{m=1}^{k-1} 6(m+1)m = 6 \\sum_{m=1}^{k-1} (m^2+m) = 6\\left[ \\frac{(k-1)k(2k-1)}{6} + \\frac{(k-1)k}{2} \\right]$$\n    $$F_3 = k(k-1)(2k-1) + 3k(k-1) = k(k-1)(2k-1+3) = 2k(k-1)(k+1) = 2k^3 - 2k$$\n\n3.  **中间块 ($n-2k+1 \\leq j \\leq n-k$):**\n    计算此块的和在代数上很复杂。一个更直接的方法是，将前两个块的成本相加，并认识到当 $n \\gg k$ 时，总浮点运算数必须是 $n$ 的线性函数，形式为 $F(n,k) = (\\text{每列成本})n + \\text{低阶项}$。\n    主块中每列的成本是 $9k(k+1)$。所以 $F(n,k) = 9k(k+1)n + C(k)$。\n    我们可以写成 $F(n,k) = F_1 + F_2 + F_3$，其中 $F_2$ 是中间块的成本。\n    $F(n,k) = 9k(k+1)(n-2k) + F_2 + (2k^3-2k) = (9k^2+9k)n - (18k^3+18k^2) + F_2 + (2k^3-2k)$。\n    对 $F_2$ 的详细求和表明它是一个关于 $k$ 的三次多项式。所有不依赖于 $n$ 的项的和可以简化。汇总计算得出：\n    $F_2 + F_3 - (18k^3+18k^2) = (10k^3+6k^2-4k) - (18k^3+18k^2) = -8k^3-12k^2-4k$。\n    所以，$F(n,k) = (9k^2+9k)n - (8k^3+12k^2+4k)$。\n    对该表达式进行因式分解：\n    $F(n,k) = 9k(k+1)n - 4k(2k^2+3k+1) = 9k(k+1)n - 4k(k+1)(2k+1)$。\n    $$F(n,k) = k(k+1)(9n - 4(2k+1)) = k(k+1)(9n-8k-4)$$\n\n### 第 2 部分：内存存储 $M(n,k)$\n\n总内存 $M(n,k)$ 是因子 $R$ 和所有 Givens 旋转参数的存储量之和。\n\n1.  **R 的存储：**\n    问题陈述 $R$ 的上半带宽为 $p=2k$。它被存储在一个 $(p+1) \\times n$ 数组中。\n    $R$ 的存储量 = $(2k+1)n$ 个浮点字。\n\n2.  **Givens 旋转的存储：**\n    我们需要计算所应用的总 Givens 旋转次数。每次旋转需要 $2$ 个字。\n    对于每一列 $j$，我们为每个次对角线元素执行一次旋转，这些元素位于位置 $(j+1,j), \\dots, (\\min(n,j+k),j)$。\n    列 $j$ 的旋转次数是 $\\min(n, j+k) - (j+1) + 1 = \\min(k, n-j)$。\n    总旋转次数 $N_{rot}$：\n    $$N_{rot} = \\sum_{j=1}^{n-1} \\min(k, n-j)$$\n    我们在 $j=n-k$ 处拆分求和：\n    $$N_{rot} = \\sum_{j=1}^{n-k} k + \\sum_{j=n-k+1}^{n-1} (n-j)$$\n    第一个和有 $n-k$ 项：$k(n-k)$。\n    对于第二个和，令 $m=n-j$。当 $j$ 从 $n-k+1$ 到 $n-1$ 时，$m$ 从 $k-1$ 递减到 $1$。\n    $$\\sum_{m=1}^{k-1} m = \\frac{(k-1)k}{2}$$\n    总旋转次数：$N_{rot} = k(n-k) + \\frac{k(k-1)}{2} = kn - k^2 + \\frac{k^2-k}{2} = kn - \\frac{k^2+k}{2} = k\\left(n - \\frac{k+1}{2}\\right)$。\n    旋转的存储量 = $2 \\times N_{rot} = 2k\\left(n - \\frac{k+1}{2}\\right) = k(2n-k-1)$。\n\n总内存：\n$$M(n,k) = (2k+1)n + k(2n-k-1) = 2kn + n + 2kn - k^2 - k = 4kn + n - k^2 - k$$\n$$M(n,k) = n(4k+1) - k(k+1)$$\n\n### 第 3 部分：稳定性比率 $\\rho(\\kappa_{2}(A))$\n\n我们比较对于一个方阵 $A$，使用两种方法求解最小二乘问题 $\\min_x \\|Ax-b\\|_2$ 的稳定性：\n1.  **法方程 (NE)：** 求解 $(A^\\mathsf{T}A)x = A^\\mathsf{T}b$。\n2.  **QR 分解：** 计算 $A=QR$ 并求解 $Rx = Q^\\mathsf{T}b$。\n\n标准的前向误差分析为计算解 $\\hat{x}$ 的相对误差 $\\frac{\\|\\hat{x}-x_{LS}\\|_2}{\\|x_{LS}\\|_2}$ 提供了界。这些界中的主阶项表征了方法的稳定性。\n\n对于**法方程**，问题被转换为一个涉及矩阵 $A^\\mathsf{T}A$ 的线性系统。该矩阵的条件数为 $\\kappa_2(A^\\mathsf{T}A) = \\kappa_2(A)^2$。通过后向稳定方法（如带状 Cholesky 分解）计算的解的前向误差界由该量主导。\n$$ \\left(\\frac{\\|\\hat{x}_{NE} - x_{LS}\\|_2}{\\|x_{LS}\\|_2}\\right)_{\\text{bound}} \\approx C_{NE} \\cdot \\epsilon \\cdot \\kappa_2(A)^2 $$\n其中 $\\epsilon$ 是单位舍入，而 $C_{NE}$ 是一个常数。主导项与 $\\kappa_2(A)^2$ 成正比。\n\n对于使用 Givens 旋转的 **QR 分解**方法，该方法是后向稳定的。这意味着计算出的解是某个邻近问题的精确解。该方法的前向误差界为：\n$$ \\left(\\frac{\\|\\hat{x}_{QR} - x_{LS}\\|_2}{\\|x_{LS}\\|_2}\\right)_{\\text{bound}} \\approx \\epsilon \\left( C_{QR,1} \\kappa_2(A) + C_{QR,2} \\frac{\\|r_{LS}\\|_2}{\\|A\\|_2\\|x_{LS}\\|_2} \\kappa_2(A)^2 \\right) $$\n其中 $r_{LS} = b-Ax_{LS}$ 是最小二乘残差。\n\n问题要求一个比率 $\\rho(\\kappa_2(A))$，它仅是 $\\kappa_2(A)$ 的函数。这意味着我们应该比较误差界中与右侧项 $b$ (以及残差 $r_{LS}$) 无关的部分。这等效于考虑求解一个方的、可逆的系统 $Ax=b$ 的情况，此时残差 $r_{LS}$ 为零。在这种情况下，QR 界的第二项消失。\n\n因此，QR 的主导误差界被认为与 $\\kappa_2(A)$ 成正比：\n$$ \\left(\\frac{\\|\\hat{x}_{QR} - x_{LS}\\|_2}{\\|x_{LS}\\|_2}\\right)_{\\text{bound}} \\approx C_{QR} \\cdot \\epsilon \\cdot \\kappa_2(A) $$\n\n法方程方法的主导前向误差界与 QR 方法的主导前向误差界之比即为：\n$$ \\rho(\\kappa_2(A)) = \\frac{C_{NE} \\cdot \\epsilon \\cdot \\kappa_2(A)^2}{C_{QR} \\cdot \\epsilon \\cdot \\kappa_2(A)} $$\n假设常数 $C_{NE}$ 和 $C_{QR}$ 具有相同的数量级（此类分析中的标准假设），则该比率简化为：\n$$ \\rho(\\kappa_2(A)) = \\kappa_2(A) $$\n这个经典结果凸显了对于病态矩阵，法方程方法的稳定性可能差得多，因为它将条件数平方。\n\n### 最终组装\n所需的三个表达式是：\n1.  $F(n,k) = k(k+1)(9n-8k-4)$\n2.  $M(n,k) = n(4k+1) - k(k+1)$\n3.  $\\rho(\\kappa_2(A)) = \\kappa_2(A)$\n\n这些将以单行矩阵的形式呈现。",
            "answer": "$$ \\boxed{\\begin{pmatrix} k(k+1)(9n-8k-4)  n(4k+1) - k(k+1)  \\kappa_2(A) \\end{pmatrix}} $$"
        }
    ]
}