{
    "hands_on_practices": [
        {
            "introduction": "理解 Lanczos 迭代最有效的方法之一是在一个具体的例子上逐步执行它。本练习将指导您在一个源自偏微分方程离散化的小型对称矩阵上进行两步 Lanczos 迭代。通过手动计算，您将亲身体验三项递推关系如何生成一个正交基和相应的对称三对角矩阵 $T_k$，从而为理解该算法的内在机制奠定坚实的基础。",
            "id": "3421772",
            "problem": "考虑由一维泊松方程 $-u''(x)=f(x)$ 在单位区间上采用齐次狄利克雷边界条件的中心有限差分格式所产生的线性系统，为简化起见，网格参数的缩放已被吸收到右端项中。由此得到的对称正定矩阵为\n$$\nA=\\begin{pmatrix}\n2  & -1 & 0 \\\\\n-1 & 2  & -1 \\\\\n0  & -1 & 2\n\\end{pmatrix},\n$$\n这是用于偏微分方程数值解的克雷洛夫子空间方法中的一个标准模型问题。在最小残差法 (MINRES) 中，兰佐斯过程为克雷洛夫子空间生成一个标准正交基，并生成 $A$ 的一个对称三对角投影。无转置拟最小残差法 (TFQMR) 是一种处理非对称问题的相关方法，但本文重点是与 MINRES 相关的对称情况。\n\n从初始猜测 $x_0=\\mathbf{0}$ 和右端向量 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$ 开始，定义初始残差 $r_0=b-Ax_0$ 和第一个兰佐斯基向量 $v_1=r_0/\\|r_0\\|$。利用克雷洛夫子空间的基本定义以及表征对称矩阵上兰佐斯过程的三项递推关系，执行整两轮兰佐斯迭代，以构造标准正交基向量 $v_1$ 和 $v_2$，并组装 $2\\times 2$ 的三对角矩阵 $T_2$，其元素是这些迭代所产生的投影系数。\n\n作为与支撑 MINRES 的谱压缩相关的最终标量诊断，计算三对角矩阵 $T_2$ 的行列式。请将此行列式以单个精确实数的形式给出。无需四舍五入，不涉及单位。答案必须以单个实数值给出。",
            "solution": "该问题要求计算一个 $2 \\times 2$ 三对角矩阵 $T_2$ 的行列式，该矩阵是通过对给定的对称矩阵 $A$ 执行两轮兰佐斯过程生成的。\n\n给定的矩阵是 $A=\\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 2 & -1 \\\\ 0 & -1 & 2 \\end{pmatrix}$，右端向量为 $b=\\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}$，初始猜测为 $x_0=\\mathbf{0}$。\n\n兰佐斯过程通过三项递推关系 $ \\beta_j v_{j+1} = A v_j - \\alpha_j v_j - \\beta_{j-1} v_{j-1} $（其中 $v_0 = \\mathbf{0}, \\beta_0 = 0$）生成一个标准正交基 $\\{v_j\\}$。系数 $\\alpha_j$ 和 $\\beta_j$ 构成了三对角矩阵 $T_k$。\n\n**第 0 步：初始化**\n\n首先，计算初始残差 $r_0$ 并将其归一化得到第一个兰佐斯向量 $v_1$：\n$$\nr_0 = b - Ax_0 = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} - \\mathbf{0} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n$$\n\\|r_0\\|_2 = \\sqrt{1^2 + 0^2 + 0^2} = 1\n$$\n$$\nv_1 = \\frac{r_0}{\\|r_0\\|_2} = \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix}\n$$\n\n**第 1 轮兰佐斯迭代 (j=1):**\n\n1.  计算 $w_1 = Av_1$：\n    $$\n    w_1 = \\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 2 & -1 \\\\ 0 & -1 & 2 \\end{pmatrix} \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix}\n    $$\n2.  计算对角系数 $\\alpha_1$：\n    $$\n    \\alpha_1 = v_1^T w_1 = \\begin{pmatrix}1 & 0 & 0\\end{pmatrix} \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} = 2\n    $$\n3.  计算残差 $r_1 = w_1 - \\alpha_1 v_1$：\n    $$\n    r_1 = \\begin{pmatrix}2 \\\\ -1 \\\\ 0\\end{pmatrix} - 2 \\begin{pmatrix}1 \\\\ 0 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n    $$\n4.  计算次对角系数 $\\beta_1 = \\|r_1\\|_2$：\n    $$\n    \\beta_1 = \\sqrt{0^2 + (-1)^2 + 0^2} = 1\n    $$\n5.  由于 $\\beta_1 \\neq 0$，归一化得到下一个基向量 $v_2$：\n    $$\n    v_2 = \\frac{r_1}{\\beta_1} = \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix}\n    $$\n\n**第 2 轮兰佐斯迭代 (j=2):**\n\n1.  计算 $w_2 = Av_2$：\n    $$\n    w_2 = \\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 2 & -1 \\\\ 0 & -1 & 2 \\end{pmatrix} \\begin{pmatrix}0 \\\\ -1 \\\\ 0\\end{pmatrix} = \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix}\n    $$\n2.  计算对角系数 $\\alpha_2$：\n    $$\n    \\alpha_2 = v_2^T w_2 = \\begin{pmatrix}0 & -1 & 0\\end{pmatrix} \\begin{pmatrix}1 \\\\ -2 \\\\ 1\\end{pmatrix} = 2\n    $$\n至此，我们已获得构造 $T_2$ 所需的所有系数。\n\n**构造并计算 $T_2$：**\n\n$2 \\times 2$ 的三对角矩阵 $T_2$ 由系数 $\\alpha_1, \\alpha_2$ 和 $\\beta_1$ 构成：\n$$\nT_2 = \\begin{pmatrix}\n\\alpha_1 & \\beta_1 \\\\\n\\beta_1 & \\alpha_2\n\\end{pmatrix} = \\begin{pmatrix}\n2 & 1 \\\\\n1 & 2\n\\end{pmatrix}\n$$\n最后，计算 $T_2$ 的行列式：\n$$\n\\det(T_2) = (\\alpha_1)(\\alpha_2) - (\\beta_1)^2 = (2)(2) - (1)^2 = 4 - 1 = 3\n$$\n三对角矩阵 $T_2$ 的行列式为 $3$。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "Lanczos 迭代的一个深刻特性是它与矩阵不变子空间之间的紧密联系。当起始向量恰好位于一个不变子空间中时，算法会“提前终止”，这并非失败，而是一个重要的信号。这个练习设计了一个场景，其中起始向量被限制在一个二维不变子空间内，导致算法在两步后停止，从而揭示了算法的这一特性，并展示了如何利用这种“提前终止”精确地找到与该子空间相关的特征值。",
            "id": "3246897",
            "problem": "考虑一个实对称矩阵 $A \\in \\mathbb{R}^{4 \\times 4}$ 和一个非零起始向量 $b \\in \\mathbb{R}^{4}$，它们由下式给出\n$$\nA \\;=\\; \\begin{pmatrix}\n4 & 0 & 0 & 0 \\\\\n0 & 6 & 0 & 0 \\\\\n0 & 0 & 2 & 0 \\\\\n0 & 0 & 0 & 11\n\\end{pmatrix},\n\\qquad\nb \\;=\\; \\begin{pmatrix}\n2 \\\\ 1 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n子空间 $\\mathcal{S} \\;=\\; \\mathrm{span}\\{e_{1},e_{2}\\}$ 是 $A$ 的一个不变子空间，并且 $b \\in \\mathcal{S}$。使用 Krylov 子空间 $\\mathcal{K}_{k}(A,b)$ 的基本定义和用于对称矩阵特征值近似的 Lanczos 方法，从 $b$ 开始应用 Lanczos 迭代来构造前几个标准正交 Lanczos 向量以及相关的对称三对角投影 $T$，直到由于不变性而发生提前终止。然后确定最大的 Ritz 值，其定义为终止时产生的三对角矩阵 $T$ 的最大特征值。\n\n将您的最终答案以单个实数值的形式给出。无需四舍五入；给出精确值。不要包含单位。",
            "solution": "针对对称矩阵的 Lanczos 方法通过三项递推关系为 Krylov 子空间 $\\mathcal{K}_{k}(A,b) \\;=\\; \\mathrm{span}\\{b, Ab, \\dots, A^{k-1}b\\}$ 构造一个标准正交基 $\\{q_{1}, q_{2}, \\dots\\}$。在每一步中，它形成一个对称三对角矩阵 $T$，其元素是递推系数 $\\alpha_{j}$ 和 $\\beta_{j}$，而 $T$ 的特征值是 Ritz 值，它们近似于 $A$ 的特征值。\n\n我们从不变子空间的观察开始。由于 $A$ 是对角的，\n$$\nA \\;=\\; \\mathrm{diag}(4,6,2,11),\n$$\n子空间 $\\mathcal{S} \\;=\\; \\mathrm{span}\\{e_{1},e_{2}\\}$ 是不变的，因为 $A e_{1} \\in \\mathcal{S}$ 且 $A e_{2} \\in \\mathcal{S}$。由于 $b \\;=\\; \\begin{pmatrix}2 \\\\ 1 \\\\ 0 \\\\ 0\\end{pmatrix}$ 位于 $\\mathcal{S}$ 中，$\\mathcal{K}_{k}(A,b)$ 中的每个向量都将保留在 $\\mathcal{S}$ 中。因此，Krylov 序列的最大维数最多为 $2$，Lanczos 过程将以 $\\beta_{2} \\;=\\; 0$ 提前终止。\n\n我们现在显式地执行迭代。将 $b$ 标准化以获得\n$$\n\\|b\\| \\;=\\; \\sqrt{2^{2} + 1^{2} + 0^{2} + 0^{2}} \\;=\\; \\sqrt{5}, \\qquad q_{1} \\;=\\; \\frac{b}{\\|b\\|} \\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\nLanczos 迭代第 1 步：\n- 计算 $v \\;=\\; A q_{1}$：\n$$\nA q_{1} \\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 4 \\cdot 2 \\\\ 6 \\cdot 1 \\\\ 2 \\cdot 0 \\\\ 11 \\cdot 0 \\end{pmatrix}\n\\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 6 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 计算第一个对角系数 $\\alpha_{1} \\;=\\; q_{1}^{\\top} A q_{1}$：\n$$\n\\alpha_{1} \\;=\\; q_{1}^{\\top} A q_{1}\n\\;=\\; \\frac{1}{5} \\left(2 \\cdot 8 + 1 \\cdot 6\\right)\n\\;=\\; \\frac{22}{5}.\n$$\n- 形成残差 $r_{1} \\;=\\; A q_{1} - \\alpha_{1} q_{1}$：\n$$\nr_{1} \\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 6 \\\\ 0 \\\\ 0 \\end{pmatrix}\n\\;-\\; \\frac{22}{5} \\cdot \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n\\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 8 - \\frac{44}{5} \\\\ 6 - \\frac{22}{5} \\\\ 0 \\\\ 0 \\end{pmatrix}\n\\;=\\; \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 次对角系数 $\\beta_{1} \\;=\\; \\|r_{1}\\|$：\n$$\n\\beta_{1} \\;=\\; \\left\\| \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix} \\right\\|\n\\;=\\; \\frac{1}{5 \\sqrt{5}} \\sqrt{(-4)^{2} + 8^{2}}\n\\;=\\; \\frac{1}{5 \\sqrt{5}} \\sqrt{16 + 64}\n\\;=\\; \\frac{1}{5 \\sqrt{5}} \\cdot 4 \\sqrt{5}\n\\;=\\; \\frac{4}{5}.\n$$\n- 标准化以得到 $q_{2} \\;=\\; r_{1} / \\beta_{1}$：\n$$\nq_{2} \\;=\\; \\frac{ \\frac{1}{5 \\sqrt{5}} \\begin{pmatrix} -4 \\\\ 8 \\\\ 0 \\\\ 0 \\end{pmatrix} }{ \\frac{4}{5} }\n\\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n\nLanczos 迭代第 2 步：\n- 计算 $A q_{2}$：\n$$\nA q_{2} \\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 4 \\cdot (-1) \\\\ 6 \\cdot 2 \\\\ 2 \\cdot 0 \\\\ 11 \\cdot 0 \\end{pmatrix}\n\\;=\\; \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n- 计算 $\\alpha_{2} \\;=\\; q_{2}^{\\top} A q_{2}$：\n$$\n\\alpha_{2} \\;=\\; \\left(\\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}\\right)^{\\!\\top}\n\\left( \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix} \\right)\n\\;=\\; \\frac{1}{5} \\left( (-1)(-4) + 2 \\cdot 12 \\right)\n\\;=\\; \\frac{28}{5}.\n$$\n- 形成残差 $r_{2} \\;=\\; A q_{2} - \\alpha_{2} q_{2} - \\beta_{1} q_{1}$。\n$$\nA q_2 - \\alpha_2 q_2 = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -4 \\\\ 12 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{28}{5} \\frac{1}{\\sqrt{5}} \\begin{pmatrix} -1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5\\sqrt{5}} \\begin{pmatrix} -20 - (-28) \\\\ 60-56 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 4 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\beta_1 q_1 = \\frac{4}{5} \\frac{1}{\\sqrt{5}} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\frac{1}{5\\sqrt{5}} \\begin{pmatrix} 8 \\\\ 4 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n因此 $r_2 = 0$，所以\n$$\n\\beta_{2} \\;=\\; \\|r_{2}\\| \\;=\\; 0.\n$$\n这就是由起始向量 $b$ 位于不变子空间 $\\mathcal{S}$ 中引起的提前终止。\n\n终止时的三对角矩阵 $T$ 为\n$$\nT \\;=\\; \\begin{pmatrix}\n\\alpha_{1} & \\beta_{1} \\\\\n\\beta_{1} & \\alpha_{2}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{22}{5} & \\frac{4}{5} \\\\\n\\frac{4}{5} & \\frac{28}{5}\n\\end{pmatrix}.\n$$\nRitz 值是 $T$ 的特征值，通过求解以下方程得到\n$$\n\\det\\!\\left( T - \\lambda I \\right) \\;=\\; 0\n\\;\\;\\Longleftrightarrow\\;\\;\n\\left(\\frac{22}{5} - \\lambda\\right)\\!\\left(\\frac{28}{5} - \\lambda\\right) - \\left(\\frac{4}{5}\\right)^{2} \\;=\\; 0.\n$$\n展开得到\n$$\n\\lambda^{2} - \\left( \\frac{22}{5} + \\frac{28}{5} \\right) \\lambda + \\frac{22}{5} \\cdot \\frac{28}{5} - \\frac{16}{25}\n\\;=\\; \\lambda^{2} - 10 \\lambda + 24 \\;=\\; 0,\n$$\n其根为\n$$\n\\lambda \\;=\\; \\frac{10 \\pm \\sqrt{10^{2} - 4 \\cdot 24}}{2}\n\\;=\\; \\frac{10 \\pm \\sqrt{4}}{2}\n\\;=\\; \\frac{10 \\pm 2}{2}\n\\;\\in\\; \\{4, 6\\}.\n$$\n因此，终止时产生的最大 Ritz 值为 $6$。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "从理论上的精确算术过渡到实际的有限精度计算时，Lanczos 迭代会面临数值稳定性的挑战，其核心问题是 Lanczos 向量会失去正交性。本练习要求您通过编程来直面这一核心问题，您将实现并比较无重正交化、选择性重正交化和完全重正交化三种策略的效果。通过量化不同策略对 Ritz 值精度的影响，您将掌握解决 Lanczos 迭代数值不稳定性的关键实用技术。",
            "id": "3581514",
            "problem": "设计并实现一个程序，通过应用选择性重正交化策略来维持 Krylov 基向量间的正交性，并量化其对 Ritz 值精度的影响，从而研究对称 Lanczos 过程在有限精度算术下的稳定性。您的程序必须为实对称矩阵实现 Lanczos 迭代的三个变体：无重正交化、选择性重正交化和完全重正交化。经验性比较必须遵循以下规范。\n\n基本基础和假设：\n- 对 binary64 算术（双精度）使用标准舍入浮点模型：对于任何基本运算，$\\mathrm{fl}(x \\circ y) = (x \\circ y) (1 + \\delta)$，其中 $|\\delta| \\leq \\epsilon_{\\mathrm{mach}}$，$\\epsilon_{\\mathrm{mach}}$ 表示双精度的机器 epsilon。\n- 对于实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和初始向量 $v_{1}$（其中 $\\|v_{1}\\|_{2} = 1$），其 $k$ 阶 Krylov 子空间为 $\\mathcal{K}_{k}(A, v_{1}) = \\mathrm{span}\\{v_{1}, A v_{1}, \\dots, A^{k-1} v_{1} \\}$。Lanczos 过程试图为 $\\mathcal{K}_{k}(A, v_{1})$ 生成一个标准正交基 $\\{v_{1}, \\dots, v_{k}\\}$，并产生一个实对称三对角矩阵 $T_{k} \\in \\mathbb{R}^{k \\times k}$，其特征值是关于 $(A, \\mathcal{K}_{k})$ 的 Ritz 值。\n- 在精确算术中，Lanczos 向量是标准正交的，一个三项递推就足够了。在有限精度算术中，可能会发生正交性损失；重正交化可以减轻这种不稳定性。\n\n选择性重正交化指令：\n- 根据测量的正交性损失实现一个选择性重正交化准则。设 $\\eta = c \\sqrt{\\epsilon_{\\mathrm{mach}}}$，其中 $c = 10$。在 Lanczos 迭代的第 $j$ 步，形成候选向量 $w$ 后，计算内积 $h_{i} = v_{i}^{\\top} w$（$i = 1, \\dots, j$）。如果对于任何 $i$ 有 $|h_{i}| > \\eta$，则对那些满足该不等式的 $v_{i}$ 执行修正的 Gram-Schmidt 重正交化，并最多重复此检查 2 遍，以将 $|h_{i}|$ 减少回 $\\mathcal{O}(\\epsilon_{\\mathrm{mach}})$ 附近。\n- 对于完全重正交化变体，在每一步 $j$ 中，对所有先前计算出的 Lanczos 向量 $\\{v_{1}, \\dots, v_{j}\\}$ 执行修正的 Gram-Schmidt 重正交化，最多执行 2 遍。\n- 对于无重正交化变体，仅执行三项递推，不进行任何 Gram-Schmidt 步骤。\n\n精度度量：\n- 对于给定的对称矩阵 $A$、目标子空间维度 $k$ 和目标数量 $r \\leq k$，计算 $T_{k}$ 的 $r$ 个最大的 Ritz 值（按代数顺序），并将它们与 $A$ 的 $r$ 个最大的真实特征值（按代数顺序）进行比较。将误差定义为两组值按降序排序后的最大绝对偏差：\n$$\nE = \\max_{1 \\leq i \\leq r} \\left| \\lambda^{(A)}_{(i)} - \\theta^{(T)}_{(i)} \\right|,\n$$\n其中 $\\lambda^{(A)}_{(i)}$ 是 $A$ 的 $r$ 个最大特征值，$\\theta^{(T)}_{(i)}$ 是 $r$ 个最大 Ritz 值。\n- 将由选择性重正交化带来的改进因子定义为\n$$\n\\mathcal{I} = \\frac{E_{\\mathrm{none}}}{E_{\\mathrm{sel}}},\n$$\n其中 $E_{\\mathrm{none}}$ 是无重正交化下的误差，$E_{\\mathrm{sel}}$ 是选择性重正交化下的误差。如果 $E_{\\mathrm{sel}} = 0$，则报告 $\\mathcal{I} = 10^{16}$。\n\n实现要求：\n- 为上述三种变体实现对称 Lanczos 过程，该过程返回三对角矩阵 $T_{k}$。\n- 对每个测试用例使用一个固定的、可复现的随机初始向量 $v_{1}$，并满足 $\\|v_{1}\\|_{2} = 1$。\n- 使用数值稳定的对称特征值求解器计算 $A$ 的真实特征值。\n\n测试套件：\n- 您的程序必须运行以下三个测试用例，并报告每个用例的改进因子 $\\mathcal{I}$（如上定义）。在所有情况下，都使用双精度算术，不涉及物理单位，也不使用角度。\n    1. 谱间距良好的顺利路径：\n        - $n = 80$, $k = 30$, $r = 5$。\n        - 构建 $A = Q \\Lambda Q^{\\top}$，其中 $\\Lambda = \\mathrm{diag}(\\ell_{1}, \\dots, \\ell_{n})$，$\\ell_{i}$ 在 $1$ 到 $100$ 之间线性分布，$Q$ 是种子为 $0$ 的随机高斯矩阵进行 $\\mathrm{QR}$ 分解得到的正交因子。\n        - 使用种子为 $1$ 的随机高斯初始向量，并归一化为单位 $2$-范数。\n    2. 谱顶端的挑战性密集簇：\n        - $n = 120$, $k = 60$, $r = 8$。\n        - 构建 $A = Q \\Lambda Q^{\\top}$，其中 $\\Lambda$ 有 $10$ 个在 $10$ 附近的特征值，由 $10 + \\delta_{i}$ 给出，$\\delta_{i}$ 在 $[-10^{-8}, 10^{-8}]$ 内独立同分布均匀采样得到，其余 $110$ 个特征值在 $[0.1, 9.9]$ 区间内线性分布。使用种子 $2$ 生成 $Q$ 和进行均匀采样。\n        - 使用种子为 $3$ 的随机高斯初始向量，并归一化为单位 $2$-范数。\n    3. 长运行和结构化算子的边界情况：\n        - $n = 90$, $k = 90$, $r = 10$。\n        - 构建 $A$ 为一个三对角 Toeplitz 矩阵，其主对角线元素为零，第一条次对角线和超对角线元素为一，即 $A_{i,i} = 0$ 且 $A_{i,i+1} = A_{i+1,i} = 1$，$i = 1, \\dots, n-1$。\n        - 使用种子为 $4$ 的随机高斯初始向量，并归一化为单位 $2$-范数。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。该列表必须精确包含 3 个浮点数，按顺序对应于测试用例 1、2 和 3 的改进因子 $\\mathcal{I}$。例如，格式必须严格如 $[x_{1},x_{2},x_{3}]$，不含多余空格，其中 $x_{i}$ 是十进制字符串。\n\n评分和接受标准：\n- 程序必须是自包含的，并且无需用户输入即可运行。\n- 选择性重正交化必须使用阈值 $\\eta = 10 \\sqrt{\\epsilon_{\\mathrm{mach}}}$，并且每步最多进行 2 遍 Gram-Schmidt 过程。\n- 每个 $\\mathcal{I}$ 必须是一个有限非负浮点数，并遵循规则：如果 $E_{\\mathrm{sel}} = 0$，则 $\\mathcal{I} = 10^{16}$。",
            "solution": "此代码实现了对对称 Lanczos 过程的分析，重点关注其数值稳定性。它比较了在无重正交化和使用选择性重正交化策略时计算的 Ritz 值的精度。这种比较通过一个改进因子 $\\mathcal{I}$ 进行量化，并根据问题中定义的三个特定测试用例进行评估。\n\n### 核心算法：对称 Lanczos 迭代\n\nLanczos 过程为 Krylov 子空间 $\\mathcal{K}_k(A, v_1)$ 生成一个标准正交基 $\\{v_1, v_2, \\dots, v_k\\}$ 和一个对称三对角矩阵 $T_k$。其核心是三项递推关系：\n$$ \\beta_j v_{j+1} = A v_j - \\alpha_j v_j - \\beta_{j-1} v_{j-1} $$\n其中 $\\alpha_j = v_j^\\top A v_j$ 且 $\\beta_j = \\|A v_j - \\alpha_j v_j - \\beta_{j-1} v_{j-1}\\|_2$。在有限精度算术中，向量 $\\{v_j\\}$ 的正交性会迅速丧失，导致 Ritz 值（$T_k$ 的特征值）不准确。\n\n### 重正交化策略\n\n为了抵消这种不稳定性，实现了选择性重正交化：\n1.  **无重正交化 (`none`)**：使用基本递推关系，不进行任何校正。这种方法计算成本低，但对于长迭代来说数值上不稳定。\n2.  **选择性重正交化 (`selective`)**：在每一步 $j$ 中，检查新向量 $w_j = A v_j - \\alpha_j v_j - \\beta_{j-1} v_{j-1}$（它应与 $v_1, \\dots, v_j$ 正交）。如果其在任何先前向量 $v_i$ 上的投影的绝对值大于阈值 $\\eta = 10 \\sqrt{\\epsilon_{\\mathrm{mach}}}$，我们就将 $w_j$ 与那些特定的向量进行重正交化。该实现使用修正的 Gram-Schmidt（MGS）方法进行此校正，最多重复两遍以确保恢复正交性。这在完全重正交化的成本和无重正交化的不稳定性之间提供了一种平衡。\n\n### 实现与评估\n\n代码首先实现一个函数 `lanczos_iteration(A, v1, k, mode)`，该函数接受矩阵 $A$、初始向量 $v_1$、迭代次数 $k$ 和一个 `mode` 字符串（`'none'` 或 `'selective'`）。\n\n对于每个测试用例：\n1.  根据规范构建指定的 $n \\times n$ 矩阵 $A$ 和初始向量 $v_1$。\n2.  使用稳定的特征值求解器（`numpy.linalg.eigh`）计算 $A$ 的 $r$ 个最大真实特征值。\n3.  对 `mode='none'` 和 `mode='selective'` 两种模式运行 Lanczos 迭代，以获得三对角矩阵 $T_{k, \\text{none}}$ 和 $T_{k, \\text{sel}}$。\n4.  使用高效的三对角特征值求解器（`scipy.linalg.eigh_tridiagonal`）计算每个 $T_k$ 矩阵的 $r$ 个最大 Ritz 值。\n5.  误差 $E_{\\mathrm{none}}$ 和 $E_{\\mathrm{sel}}$ 计算为对应的已排序真实特征值列表和 Ritz 值列表之间的最大绝对差。\n6.  计算改进因子 $\\mathcal{I} = E_{\\mathrm{none}} / E_{\\mathrm{sel}}$，并处理 $E_{\\mathrm{sel}}=0$ 的特殊情况。\n\n最后，对三个已定义的测试用例重复此过程，并收集和打印最终的改进因子。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef lanczos_iteration(A, v1, k, mode='none'):\n    \"\"\"\n    Performs the symmetric Lanczos iteration for a matrix A and starting vector v1.\n\n    Args:\n        A (np.ndarray): The symmetric matrix.\n        v1 (np.ndarray): The starting vector of unit norm.\n        k (int): The number of Lanczos steps (dimension of Krylov subspace).\n        mode (str): Reorthogonalization mode: 'none' or 'selective'.\n\n    Returns:\n        np.ndarray: The symmetric tridiagonal matrix T_k of size k x k.\n    \"\"\"\n    n = A.shape[0]\n    V = np.zeros((n, k + 1))\n    alphas = np.zeros(k)\n    betas = np.zeros(k)\n\n    eps_mach = np.finfo(float).eps\n    eta = 10.0 * np.sqrt(eps_mach)\n    breakdown_tol = 1e-14\n\n    V[:, 0] = v1\n\n    for j in range(k):\n        v_curr = V[:, j]\n        w = A @ v_curr\n\n        if j > 0:\n            w -= betas[j - 1] * V[:, j - 1]\n\n        alphas[j] = v_curr.T @ w\n        w -= alphas[j] * v_curr\n\n        if mode == 'selective':\n            # Perform selective reorthogonalization with at most 2 MGS passes\n            for _ in range(2):\n                # Projections of w onto the basis V\n                h = V[:, :j + 1].T @ w\n                indices_to_reortho = np.where(np.abs(h) > eta)[0]\n                \n                if len(indices_to_reortho) == 0:\n                    break  # Orthogonality is sufficient\n                \n                # Apply MGS steps for the vectors that lost orthogonality\n                for i in indices_to_reortho:\n                    w -= (V[:, i].T @ w) * V[:, i]\n\n        betas[j] = np.linalg.norm(w)\n\n        if betas[j]  breakdown_tol:\n            # Breakdown: Krylov subspace is invariant or exhausted.\n            k_actual = j + 1\n            T_k = np.zeros((k, k))\n            sub_T_alphas = alphas[:k_actual]\n            sub_T_betas = betas[:k_actual - 1]\n            T_k_sub = np.diag(sub_T_alphas) + np.diag(sub_T_betas, 1) + np.diag(sub_T_betas, -1)\n            T_k[:k_actual, :k_actual] = T_k_sub\n            return T_k\n            \n        V[:, j + 1] = w / betas[j]\n\n    T_k = np.diag(alphas) + np.diag(betas[:k - 1], 1) + np.diag(betas[:k - 1], -1)\n    return T_k\n\ndef run_test_case(case_id):\n    \"\"\"\n    Sets up and runs a single test case, returning the improvement factor.\n    \"\"\"\n    if case_id == 1:\n        n, k, r = 80, 30, 5\n        rng_Q = np.random.default_rng(0)\n        G = rng_Q.standard_normal((n, n))\n        Q, _ = np.linalg.qr(G)\n        lambda_vals = np.linspace(1, 100, n)\n        A = Q @ np.diag(lambda_vals) @ Q.T\n        rng_v1 = np.random.default_rng(1)\n        v1 = rng_v1.standard_normal(n)\n    elif case_id == 2:\n        n, k, r = 120, 60, 8\n        rng = np.random.default_rng(2)\n        cluster_vals = 10.0 + rng.uniform(-1e-8, 1e-8, size=10)\n        other_vals = np.linspace(0.1, 9.9, n - 10)\n        lambda_vals = np.concatenate((other_vals, cluster_vals))\n        G = rng.standard_normal((n, n))\n        Q, _ = np.linalg.qr(G)\n        A = Q @ np.diag(lambda_vals) @ Q.T\n        rng_v1 = np.random.default_rng(3)\n        v1 = rng_v1.standard_normal(n)\n    elif case_id == 3:\n        n, k, r = 90, 90, 10\n        A = np.diag(np.ones(n - 1), 1) + np.diag(np.ones(n - 1), -1)\n        rng_v1 = np.random.default_rng(4)\n        v1 = rng_v1.standard_normal(n)\n    else:\n        raise ValueError(\"Invalid case ID\")\n        \n    v1 /= np.linalg.norm(v1)\n\n    # Compute true eigenvalues of A\n    true_eigvals = np.linalg.eigh(A)[0]\n    largest_true_eigvals = np.flip(true_eigvals[-r:]) # descending order\n\n    # Run Lanczos with no reorthogonalization\n    T_none = lanczos_iteration(A, v1, k, mode='none')\n    ritz_vals_none = eigh_tridiagonal(np.diag(T_none), np.diag(T_none, 1))[0]\n    largest_ritz_none = np.flip(ritz_vals_none[-r:])\n\n    # Run Lanczos with selective reorthogonalization\n    T_sel = lanczos_iteration(A, v1, k, mode='selective')\n    ritz_vals_sel = eigh_tridiagonal(np.diag(T_sel), np.diag(T_sel, 1))[0]\n    largest_ritz_sel = np.flip(ritz_vals_sel[-r:])\n\n    # Compute errors\n    E_none = np.max(np.abs(largest_true_eigvals - largest_ritz_none))\n    E_sel = np.max(np.abs(largest_true_eigvals - largest_ritz_sel))\n    \n    # Compute improvement factor\n    if E_sel == 0.0:\n        if E_none == 0.0:\n            return 1.0\n        return 1e16\n    \n    return E_none / E_sel\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # The problem statement defines the test cases.\n    # We simply iterate through them.\n    test_cases = [1, 2, 3]\n\n    results = []\n    for case_id in test_cases:\n        improvement_factor = run_test_case(case_id)\n        results.append(improvement_factor)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}