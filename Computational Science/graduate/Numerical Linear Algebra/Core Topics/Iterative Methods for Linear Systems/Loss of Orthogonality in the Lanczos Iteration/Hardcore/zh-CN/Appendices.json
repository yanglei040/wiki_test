{
    "hands_on_practices": [
        {
            "introduction": "在深入探讨正交性损失这一复杂现象之前，我们必须首先牢固掌握理想情况下的理论基础。本练习将引导您在一个完美的环境中——即使用精确算术——执行兰佐斯迭代 。通过对一个小型对称矩阵进行计算，您将亲手验证兰佐斯向量的完美正交性以及相关的三对角投影关系，为理解后续的数值偏差建立一个坚实的基准。",
            "id": "3557380",
            "problem": "考虑从一个单位向量开始，对一个实对称矩阵应用 Lanczos 迭代。由矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和初始向量 $q_{1} \\in \\mathbb{R}^{n}$ 生成的 $k$ 阶 Krylov 子空间定义为 $K_{k}(A,q_{1})=\\operatorname{span}\\{q_{1},A q_{1},A^{2} q_{1},\\dots,A^{k-1} q_{1}\\}$。我们寻求 $K_{k}(A,q_{1})$ 的一个标准正交基 $\\{q_{1},\\dots,q_{k}\\}$，使得 $A$ 在该基下的表示 $T_{k} = Q_{k}^{\\top} A Q_{k}$（其中 $Q_{k} = [q_{1}\\ \\cdots\\ q_{k}] \\in \\mathbb{R}^{n \\times k}$）是一个对称三对角矩阵。在精确算术中，这种构造依赖于对称性和正交投影性质，而非数值启发式方法。\n\n设 $A \\in \\mathbb{R}^{4 \\times 4}$ 和 $q_{1} \\in \\mathbb{R}^{4}$ 由下式给出\n$$\nA = \\begin{pmatrix}\n2  1  0  0 \\\\\n1  2  1  0 \\\\\n0  1  2  1 \\\\\n0  0  1  2\n\\end{pmatrix}, \\qquad\nq_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n使用精确算术，并从 Krylov 子空间的定义以及标准正交基产生对称三对角投影的要求出发，推导构建 Lanczos 向量和标量所需的三项递推关系，执行四步 Lanczos 迭代以获得 $q_{2}$、$q_{3}$、$q_{4}$ 以及标量 $\\alpha_{1},\\alpha_{2},\\alpha_{3},\\alpha_{4}$ 和 $\\beta_{2},\\beta_{3},\\beta_{4}$。构造 $Q_{4}=[q_{1}\\ q_{2}\\ q_{3}\\ q_{4}]$ 和 $T_{4} = Q_{4}^{\\top} A Q_{4}$，并精确验证 $Q_{4}^{\\top} Q_{4} = I$ 和 $Q_{4}^{\\top} A Q_{4} = T_{4}$。\n\n最后，计算诊断量\n$$\nD \\;=\\; \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} \\;+\\; \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F},\n$$\n其中 $\\|\\cdot\\|_{F}$ 表示 Frobenius 范数，并给出其精确值。不需要四舍五入。",
            "solution": "在尝试任何解答之前，需要对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- 矩阵 $A \\in \\mathbb{R}^{4 \\times 4}$:\n$$\nA = \\begin{pmatrix}\n2  1  0  0 \\\\\n1  2  1  0 \\\\\n0  1  2  1 \\\\\n0  0  1  2\n\\end{pmatrix}\n$$\n- 初始向量 $q_{1} \\in \\mathbb{R}^{4}$:\n$$\nq_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n- Krylov 子空间定义：$K_{k}(A,q_{1})=\\operatorname{span}\\{q_{1},A q_{1},A^{2} q_{1},\\dots,A^{k-1} q_{1}\\}$。\n- 标准正交基：$\\{q_{1},\\dots,q_{k}\\}$ for $K_{k}(A,q_{1})$。\n- 标准正交矩阵：$Q_{k} = [q_{1}\\ \\cdots\\ q_{k}] \\in \\mathbb{R}^{n \\times k}$。\n- 三对角投影：$T_{k} = Q_{k}^{\\top} A Q_{k}$。\n- 约束条件：$T_k$ 必须是对称三对角矩阵，且算术是精确的。\n- 任务：\n    1. 推导 Lanczos 迭代的三项递推关系。\n    2. 执行四步 Lanczos 迭代以求得 $q_{2}, q_{3}, q_{4}$ 以及标量 $\\alpha_{1},\\alpha_{2},\\alpha_{3},\\alpha_{4}$ 和 $\\beta_{2},\\beta_{3},\\beta_{4}$。\n    3. 构造 $Q_{4}$ 和 $T_{4}$。\n    4. 验证 $Q_{4}^{\\top} Q_{4} = I$ 和 $Q_{4}^{\\top} A Q_{4} = T_{4}$。\n    5. 计算诊断量 $D = \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} + \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题是数值线性代数中的一个标准练习，重点是 Lanczos 算法。所涉及的概念、矩阵和初始向量都是该主题下的标准内容且是适当的。\n- **适定性**：该问题是适定的。对于给定的对称矩阵和起始向量，Lanczos 算法会产生唯一的向量和标量序列（在标准化符号约定下）。任务是具体的，并导向一个唯一、可验证的结果。\n- **客观性**：问题以精确、客观的数学语言陈述。\n- **完整性和一致性**：所有必要的数据（$A$、$q_{1}$）和定义都已提供。没有矛盾之处。\n- **可行性和现实性**：该问题是一个在精确算术下的理论计算，对于所给的小矩阵是完全可行的。\n\n### 第 3 步：结论与行动\n问题有效。将提供解答。\n\n### 三项递推关系的推导\n\nLanczos 算法为 Krylov 子空间 $K_k(A, q_1)$ 构建了一个标准正交基 $\\{q_1, q_2, \\dots, q_k\\}$。矩阵 $Q_k = [q_1 \\ \\dots \\ q_k]$ 的列是标准正交的，因此 $Q_k^\\top Q_k = I_k$。$A$ 在这个基上的投影是 $T_k = Q_k^\\top A Q_k$。对于对称矩阵 $A$，$T_k$ 是对称三对角矩阵。\n\n关系式 $Q_k^\\top A Q_k = T_k$ 可以重写为 $A Q_k = Q_k T_k$。然而，Krylov 子空间 $K_k(A, q_1)$ 通常不是 $A$ 的不变子空间，所以 $A Q_k$ 会有一个分量在 $Q_k$ 的张成空间之外。完整的 Lanczos 关系由下式给出：\n$$AQ_k = Q_k T_k + r_k e_k^\\top$$\n其中 $r_k$ 是一个与 $K_k$ 正交的残差向量，而 $e_k$ 是 $\\mathbb{R}^k$ 中的第 $k$ 个标准基向量。残差可以写为 $r_k = \\beta_{k+1} q_{k+1}$。这给出了关系式：\n$$A Q_k = Q_k T_k + \\beta_{k+1} q_{k+1} e_k^\\top$$\n我们来考察这个矩阵方程的第 $j$ 列（对于 $j  k$）：\n$$A q_j = (Q_k T_k)_j = \\sum_{i=1}^k q_i (T_k)_{ij}$$\n由于 $T_k$ 是对称三对角矩阵，其第 $j$ 列仅在位置 $j-1$、$j$ 和 $j+1$ 处有非零元素：$(T_k)_{j-1,j} = \\beta_j$，$(T_k)_{jj} = \\alpha_j$，以及 $(T_k)_{j+1,j} = \\beta_{j+1}$。这得出：\n$$A q_j = \\beta_j q_{j-1} + \\alpha_j q_j + \\beta_{j+1} q_{j+1}$$\n其中我们定义 $q_0=0$ 和 $\\beta_1=0$。这就是基本的三项递推关系。\n\n为了确定标量 $\\alpha_j$ 和 $\\beta_{j+1}$，我们利用向量 $q_i$ 的标准正交性。将递推关系与 $q_j$ 作内积：\n$$q_j^\\top A q_j = q_j^\\top(\\beta_j q_{j-1} + \\alpha_j q_j + \\beta_{j+1} q_{j+1})$$\n$$q_j^\\top A q_j = \\beta_j q_j^\\top q_{j-1} + \\alpha_j q_j^\\top q_j + \\beta_{j+1} q_j^\\top q_{j+1}$$\n利用 $q_j^\\top q_{j-1} = 0$ 和 $q_j^\\top q_j = 1$，我们得到 $\\alpha_j$ 的公式：\n$$\\alpha_j = q_j^\\top A q_j$$\n为了找到 $\\beta_{j+1}$，我们重新排列递推关系以定义一个残差向量 $r_j$：\n$$r_j = \\beta_{j+1} q_{j+1} = A q_j - \\alpha_j q_j - \\beta_j q_{j-1}$$\n这个残差的大小 $\\beta_{j+1}$ 被选择来确保 $q_{j+1}$ 是一个单位向量：\n$$\\beta_{j+1} = \\|r_j\\|_2 = \\| A q_j - \\alpha_j q_j - \\beta_j q_{j-1} \\|_2$$\n下一个 Lanczos 向量就是 $q_{j+1} = r_j / \\beta_{j+1}$，前提是 $\\beta_{j+1} \\neq 0$。如果 $\\beta_{j+1} = 0$，算法终止。\n\n### 执行 Lanczos 迭代\n\n我们已知 $A$ 和 $q_1$。我们初始化 $\\beta_1 = 0$ 和 $q_0 = \\mathbf{0}$。\n\n**步骤 $j=1$**：\n- 计算 $v_1 = A q_1$：\n$$v_1 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\alpha_1 = q_1^\\top v_1$：\n$$\\alpha_1 = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = 2$$\n- 计算 $r_1 = v_1 - \\alpha_1 q_1 - \\beta_1 q_0$：\n$$r_1 = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} - 0 \\cdot \\mathbf{0} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_2 = \\|r_1\\|_2 = \\sqrt{0^2+1^2+0^2+0^2} = 1$。\n- 计算 $q_2 = r_1 / \\beta_2$：\n$$q_2 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n\n**步骤 $j=2$**：\n- 计算 $v_2 = A q_2$：\n$$v_2 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\alpha_2 = q_2^\\top v_2$：\n$$\\alpha_2 = \\begin{pmatrix} 0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} = 2$$\n- 计算 $r_2 = v_2 - \\alpha_2 q_2 - \\beta_2 q_1$：\n$$r_2 = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_3 = \\|r_2\\|_2 = \\sqrt{0^2+0^2+1^2+0^2} = 1$。\n- 计算 $q_3 = r_2 / \\beta_3$：\n$$q_3 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n\n**步骤 $j=3$**：\n- 计算 $v_3 = A q_3$：\n$$v_3 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix}$$\n- 计算 $\\alpha_3 = q_3^\\top v_3$：\n$$\\alpha_3 = \\begin{pmatrix} 0  0  1  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix} = 2$$\n- 计算 $r_3 = v_3 - \\alpha_3 q_3 - \\beta_3 q_2$：\n$$r_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$$\n- 计算 $\\beta_4 = \\|r_3\\|_2 = \\sqrt{0^2+0^2+0^2+1^2} = 1$。\n- 计算 $q_4 = r_3 / \\beta_4$：\n$$q_4 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$$\n\n**步骤 $j=4$**：\n- 计算 $v_4 = A q_4$：\n$$v_4 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix}$$\n- 计算 $\\alpha_4 = q_4^\\top v_4$：\n$$\\alpha_4 = \\begin{pmatrix} 0  0  0  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix} = 2$$\n- 计算 $r_4 = v_4 - \\alpha_4 q_4 - \\beta_4 q_3$：\n$$r_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} - 1 \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_5 = \\|r_4\\|_2 = 0$。迭代终止。\n\n计算出的标量是：$\\alpha_1=2, \\alpha_2=2, \\alpha_3=2, \\alpha_4=2$ 和 $\\beta_2=1, \\beta_3=1, \\beta_4=1$。\nLanczos 向量是：$q_1=e_1, q_2=e_2, q_3=e_3, q_4=e_4$。\n\n### $Q_4$ 和 $T_4$ 的构造\n\n矩阵 $Q_4$ 由 Lanczos 向量构成：\n$$Q_4 = [q_1 \\ q_2 \\ q_3 \\ q_4] = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix} = I_4$$\n矩阵 $T_4$ 是由 $\\alpha$ 和 $\\beta$ 标量构成的对称三对角矩阵：\n$$T_4 = \\begin{pmatrix} \\alpha_1  \\beta_2  0  0 \\\\ \\beta_2  \\alpha_2  \\beta_3  0 \\\\ 0  \\beta_3  \\alpha_3  \\beta_4 \\\\ 0  0  \\beta_4  \\alpha_4 \\end{pmatrix} = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix}$$\n我们观察到，对于这个特定情况，$T_4 = A$。\n\n### 验证\n\n我们必须验证 (1) $Q_4^\\top Q_4 = I$ 和 (2) $Q_4^\\top A Q_4 = T_4$。\n1.  由于 $Q_4 = I_4$，其转置为 $Q_4^\\top = I_4^\\top = I_4$。因此，\n    $$Q_4^\\top Q_4 = I_4 \\cdot I_4 = I_4$$\n    第一个恒等式已验证。\n2.  使用 $Q_4 = I_4$，我们计算左侧：\n    $$Q_4^\\top A Q_4 = I_4^\\top A I_4 = I_4 A I_4 = A$$\n    根据我们的构造，右侧是 $T_4 = A$。因此，\n    $$A = A$$\n    第二个恒等式也已验证。\n\n### 诊断量的计算\n\n诊断量是 $D = \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} + \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F}$。\n基于上面的精确验证：\n- 第一项是 $Q_4^\\top Q_4 - I = I_4 - I_4 = 0_{4 \\times 4}$，即 $4 \\times 4$ 的零矩阵。\n- 第二项是 $Q_4^\\top A Q_4 - T_4 = A - A = 0_{4 \\times 4}$。\n\n矩阵 $M$ 的 Frobenius 范数是 $\\|M\\|_F = \\sqrt{\\sum_{i,j} |M_{ij}|^2}$。对于零矩阵，此范数为 $0$。\n因此，\n$$D = \\|0_{4 \\times 4}\\|_{F} + \\|0_{4 \\times 4}\\|_{F} = 0 + 0 = 0$$\n诊断量的精确值为 $0$。这个结果是预料之中的，因为问题是在精确算术中执行的，Lanczos 算法的理论性质在此完美成立。诊断量 $D$ 旨在测量正交性的损失和投影的残差，在这个理想化的背景下，它们都为零。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "建立了理想模型后，我们将转向模拟有限精度算术下的真实情况。这项编程练习  要求您实现带有受控舍入模型的兰佐斯迭代，并通过构建具有预设“准中断”（即极小的 $\\beta_k$ 值）的矩阵。您将能够直接观察并量化舍入误差如何与这些不稳定性相互作用，从而引发正交性的突然丧失——这正是我们旨在理解的核心现象。",
            "id": "3557387",
            "problem": "考虑一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和一个单位范数起始向量 $v_1 \\in \\mathbb{R}^n$ 的经典三项 Lanczos 迭代。在精确算术中，Lanczos 基向量 $v_k$ 在残差范数 $\\beta_k = \\lVert r_k \\rVert_2$ 等于零导致迭代中断之前，是相互正交归一的。在浮点算术中，计算步骤会经历舍入，Lanczos 基可能会失去正交性。在此任务中，您将分析小的残差范数 $\\beta_k$（接近中断）如何与舍入相互作用，从而导致正交性的突然丧失。您将构造具有精心设计的接近中断的矩阵，并在一个受控的舍入模型下观察正交性的漂移。\n\n基本定义和精确算术中的迭代：\n- 设 $v_0 = 0$ 且 $\\beta_0 = 0$。对于 $k = 1, 2, \\dots$，定义\n$$\nw_k = A v_k - \\beta_{k-1} v_{k-1}, \\quad \\alpha_k = v_k^\\top w_k, \\quad r_k = w_k - \\alpha_k v_k, \\quad \\beta_k = \\lVert r_k \\rVert_2, \\quad v_{k+1} = \\frac{r_k}{\\beta_k} \\text{ 若 } \\beta_k \\neq 0.\n$$\n- 当前 Lanczos 基 $V_k = [v_1,\\dots,v_k]$ 的正交性由以下公式衡量：\n$$\n\\Delta_k = \\lVert V_k^\\top V_k - I_k \\rVert_F,\n$$\n其中 $I_k$ 是 $k \\times k$ 单位矩阵，$\\lVert \\cdot \\rVert_F$ 表示 Frobenius 范数。\n\n模拟有限精度的舍入模型：\n- 在每次计算出标量或向量量（$w_k$、$\\alpha_k$、$r_k$、$\\beta_k$、$v_{k+1}$）之后，应用舍入到 $s$ 位有效十进制数字。对于一个非零标量 $x$，其舍入后的版本表示为\n$$\n\\mathrm{round}_s(x) = \\mathrm{round}\\left(x, \\; s - 1 - \\left\\lfloor \\log_{10} |x| \\right\\rfloor \\right),\n$$\n其中 $\\mathrm{round}(x, d)$ 将 $x$ 舍入到 $d$ 位小数。对于向量和矩阵的元素，使用相同的有效数字规则逐元素应用舍入。等于 $0$ 的元素保持为 $0$。\n\n通过三对角矩阵精心构造接近中断：\n- 如果 $A$ 是一个对角线元素为 $\\alpha_1,\\dots,\\alpha_n$、非对角线元素为 $\\beta_1,\\dots,\\beta_{n-1}$ 的三对角矩阵，并且起始向量为 $v_1 = e_1$（第一个标准基向量），那么在精确算术中，只要 $\\beta_k \\neq 0$，Lanczos 迭代就会恢复由 $A$ 的元素定义的 $\\alpha_k$ 和 $\\beta_k$，并生成 $v_k = e_k$。\n- 因此，要在特定迭代步构造接近中断，可以选择一个对称三对角矩阵 $A$，使其在选定的索引处的非对角线元素 $\\beta_k$ 很小。\n\n您的程序必须：\n1. 使用对称三对角输入矩阵 $A$，并从 $v_1 = e_1$ 开始，实现上述舍入模型的经典 Lanczos 迭代。\n2. 在每次迭代 $k$ 时，累积正交性漂移 $\\Delta_k$，并报告在已执行迭代中的最大值 $\\max_{1 \\le k \\le m} \\Delta_k$，其中 $m$ 是预定的迭代次数（如果 $\\beta_k$ 被舍入为零或变得小于避免除以一个极小数的安全阈值，迭代可能会提前终止）。\n3. 使用以下测试套件，每个套件由 $(n, \\{\\alpha_i\\}_{i=1}^n, \\{\\beta_i\\}_{i=1}^{n-1}, s, m)$ 指定：\n   - 测试 1 (基准，无接近中断):\n     - $n = 40$\n     - $\\alpha_i = 0$ 对所有 $i = 1,\\dots,40$\n     - $\\beta_i = 1$ 对所有 $i = 1,\\dots,39$\n     - $s = 14$\n     - $m = 40$\n   - 测试 2 (单个轻度接近中断):\n     - $n = 40$\n     - $\\alpha_i = 0$ 对所有 $i = 1,\\dots,40$\n     - $\\beta_i = 1$ 对所有 $i \\in \\{1,\\dots,39\\}$，除了 $\\beta_{25} = 10^{-8}$\n     - $s = 8$\n     - $m = 40$\n   - 测试 3 (多个严重接近中断):\n     - $n = 50$\n     - $\\alpha_i = 0$ 对所有 $i = 1,\\dots,50$\n     - $\\beta_i = 1$ 对所有 $i \\in \\{1,\\dots,49\\}$，除了 $\\beta_{10} = \\beta_{20} = \\beta_{30} = \\beta_{40} = 10^{-12}$\n     - $s = 10$\n     - $m = 50$\n   - 测试 4 (早期接近中断边界):\n     - $n = 30$\n     - $\\alpha_i = 0$ 对所有 $i = 1,\\dots,30$\n     - $\\beta_i = 1$ 对所有 $i \\in \\{2,\\dots,29\\}$，以及 $\\beta_{1} = 10^{-16}$\n     - $s = 8$\n     - $m = 30$\n\n终止的安全规则：\n- 如果舍入后的残差范数 $\\beta_k$ 等于 $0$ 或其量级小于 $10^{-s}$，则终止迭代，并计算到那时为止生成的所有向量的最大正交性漂移。\n\n最终输出要求：\n- 你的程序应产生单行输出，包含用方括号括起来的、以逗号分隔的结果列表，每个测试用例一个浮点数，按上述顺序排列。例如，它应输出\n$$\n[\\delta_1,\\delta_2,\\delta_3,\\delta_4]\n$$\n其中 $\\delta_j$ 是为测试 $j$ 观测到的最大正交性漂移 $\\max_k \\Delta_k$。",
            "solution": "该问题要求在受特定模拟有限精度算术的舍入模型影响时，分析 Lanczos 迭代中正交性的损失。我们通过构造带有精心设计的接近中断的对称三对角矩阵来探究这一现象，众所周知，这种接近中断会加剧正交性的损失。\n\n### 根本原理\n\n**精确算术中的 Lanczos 迭代**\n经典 Lanczos 算法是一种迭代方法，用于寻找大型对称矩阵 $A$ 的特征值和特征向量，或更普遍地，为 Krylov 子空间构建一个正交归一基。从一个单位范数向量 $v_1$ 开始，该迭代生成一个向量序列 $v_1, v_2, \\dots, v_m$ 和两个标量序列 $\\alpha_1, \\dots, \\alpha_m$ 及 $\\beta_1, \\dots, \\beta_{m-1}$。其核心迭代步骤定义为：\n$$\n\\beta_k v_{k+1} = A v_k - \\alpha_k v_k - \\beta_{k-1} v_{k-1}\n$$\n其中 $\\alpha_k = v_k^\\top A v_k$ 且 $\\beta_k = \\lVert A v_k - \\alpha_k v_k - \\beta_{k-1} v_{k-1} \\rVert_2$。这些关系可以总结为矩阵形式：\n$$\nA V_k = V_k T_k + r_k e_k^\\top\n$$\n这里，$V_k = [v_1, v_2, \\dots, v_k]$ 是 Lanczos 向量矩阵，$T_k$ 是一个对称三对角矩阵，其对角线元素为 $\\{\\alpha_i\\}_{i=1}^k$，非对角线元素为 $\\{\\beta_i\\}_{i=1}^{k-1}$，$r_k$ 是第 $k$ 步的残差向量，$e_k$ 是大小为 $k$ 的第 $k$ 个标准基向量。在精确算术中，Lanczos 向量是相互正交归一的，即 $V_k^\\top V_k = I_k$，其中 $I_k$ 是 $k \\times k$ 单位矩阵。如果对于某个 $k  n$ 有 $\\beta_k = 0$，迭代终止，这表示已找到一个不变子空间。\n\n**有限精度下的正交性损失**\n在采用浮点算术的实际计算中，每一步都会引入舍入误差。我们将计算出的量用帽子符号表示，例如 $\\hat{v}_k$。严格的正交性会丧失，即 $\\hat{V}_k^\\top \\hat{V}_k \\neq I_k$。C. C. Paige 的开创性工作表明，正交性的损失不是随机的，而是遵循特定模式。向量 $\\hat{v}_i$ 和 $\\hat{v}_j$ 之间的正交性保持在较高水平，直到三对角矩阵 $T_k$ 的一个特征值（称为 Ritz 值）收敛到原始矩阵 $A$ 的一个特征值。\n\n这种收敛的信号是极小的残差范数，$\\beta_k \\approx 0$。这种情况被称为接近中断。当 $\\beta_k$ 很小时，下一个向量的归一化步骤 $\\hat{v}_{k+1} = \\hat{r}_k / \\hat{\\beta}_k$ 在数值上变得不稳定。分子 $\\hat{r}_k$ 包含之前步骤累积的舍入误差。用一个非常小的 $\\hat{\\beta}_k$ 去除这些误差会极大地放大它们，导致得到的向量 $\\hat{v}_{k+1}$ 在先前的 Lanczos 向量方向上具有显著分量，从而破坏正交性。正交性损失的程度，由 $\\lVert \\hat{V}_k^\\top \\hat{V}_k - I_k \\rVert$ 衡量，对于某个 $j  k$，其值大约与 $\\epsilon / \\beta_{j}$ 成正比，其中 $\\epsilon$ 是机器精度。\n\n**问题的实验设计**\n此问题旨在直接展示这一原理。\n1.  **精心构造的中断**：通过选择矩阵 $A$ 为对称三对角矩阵并以 $v_1 = e_1$ 开始，在精确算术中，Lanczos 迭代会完美地恢复 $A$ 的对角线和非对角线元素作为 $\\alpha_k$ 和 $\\beta_k$ 系数。因此，我们可以通过将 $A$ 的特定非对角线元素设置为非常小的值来构造接近中断。\n2.  **受控舍入**：引入一个舍入模型，以模拟具有 $s$ 位有效十进制数字的有限精度算术。这使得有效机器精度 $\\epsilon$ 约为 $10^{-s}$。\n3.  **观察**：我们使用 Frobenius 范数 $\\Delta_k = \\lVert V_k^\\top V_k - I_k \\rVert_F$ 来衡量正交性损失。我们预期在迭代 $j$ 之后，$\\Delta_k$ 会急剧增加，其中精心构造的 $\\beta_j$ 的量级与有效精度 $10^{-s}$ 相似或更小。\n\n### 算法实现\n\n解决方案包括实现 Lanczos 迭代，并在每次算术运算后应用指定的舍入模型。\n\n1.  **舍入函数**：实现一个函数 `round_s(x, s)`。对于任何非零值 $x$，它使用公式 $\\mathrm{round}(x, s - 1 - \\lfloor \\log_{10} |x| \\rfloor)$ 将其舍入到 $s$ 位有效十进制数字。此函数逐元素应用于向量和矩阵。\n\n2.  **矩阵和向量初始化**：对于每个测试用例，我们根据给定的对角线元素 $\\{\\alpha_i\\}$ 和非对角线元素 $\\{\\beta_i\\}$ 构造 $n \\times n$ 对称三对角矩阵 $A$。起始向量初始化为 $v_1=e_1$。\n\n3.  **迭代过程**：算法按以下步骤进行，其中 $k$ 从 $1$ 到 $m$：\n    a. 初始化状态：当前向量 $v_{\\text{curr}}$ 设置为 $v_1$，前一个向量 $v_{\\text{prev}}$ 是零向量，前一个 beta 值 $\\beta_{\\text{prev}}$ 是 $0$。一个列表 `lanczos_vectors` 将存储生成的正交归一基。\n    b. 在每次迭代 $k$（从 $1$ 到 $m$）中：\n        i. 将当前向量 $v_{\\text{curr}}$ (即 $v_k$) 添加到 `lanczos_vectors`。\n        ii. 计算正交性损失 $\\Delta_k = \\lVert V_k^\\top V_k - I_k \\rVert_F$，其中 $V_k$ 由 `lanczos_vectors` 中的向量构成。跟踪观察到的最大 $\\Delta_k$。\n        iii. 如果 $k$ 达到最大迭代次数 $m$，则迭代终止。\n        iv. 计算并舍入下一组 Lanczos 量：\n            - 计算 $w = A v_{\\text{curr}} - \\beta_{\\text{prev}} v_{\\text{prev}}$ 并对其结果进行舍入。\n            - 计算 $\\alpha = v_{\\text{curr}}^\\top w$ 并对其结果进行舍入。\n            - 计算 $r = w - \\alpha v_{\\text{curr}}$ 并对其结果进行舍入。\n            - 计算 $\\beta = \\lVert r \\rVert_2$ 并对其结果进行舍入。\n        v. 执行终止检查：如果舍入后的 $\\beta$ 为 $0$ 或其量级小于 $10^{-s}$，则终止循环。\n        vi. 计算新 Lanczos 向量 $v_{\\text{next}} = r / \\beta$ 并对其结果进行舍入。\n        vii. 为下一次迭代更新状态：$v_{\\text{prev}}$ 变为 $v_{\\text{curr}}$，$v_{\\text{curr}}$ 变为 $v_{\\text{next}}$，$\\beta_{\\text{prev}}$ 变为 $\\beta$。\n    c. 循环终止后，记录的最大正交性漂移将作为该测试用例的结果返回。\n\n将此过程应用于问题描述中指定的四个测试用例，以获得最终结果。",
            "answer": "$$[2.776633659992683e-13,1.414213562373095,1.414213562373095,1.414213562373095]$$"
        },
        {
            "introduction": "我们已经看到正交性的损失是不可避免的，但这是否意味着算法就失效了呢？最后一个练习  将展示我们仍然可以从不完美的计算中提取有价值的信息。在一个实际场景中，您需要利用一个考虑了正交性损失的修正公式，来评估里兹对（Ritz pairs）的残差范数，并可靠地判断哪些近似特征值已真正收敛。这是开发稳健迭代求解器的一项关键技能。",
            "id": "3557372",
            "problem": "考虑一个对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和经过 $k$ 步的 Lanczos 迭代，生成一个基 $\\hat{Q}_k \\in \\mathbb{R}^{n \\times k}$ 和一个三对角矩阵 $\\hat{T}_k \\in \\mathbb{R}^{k \\times k}$。在精确算术和列向量完全正交的情况下，Lanczos 关系为 $A Q_k = Q_k T_k + \\beta_k q_{k+1} e_k^{\\top}$，并且 $T_k$ 的 Ritz 对 $(\\theta_i, y_i)$ 在 $\\operatorname{span}\\{Q_k\\}$ 中生成 Ritz 向量 $u_i = Q_k y_i$，其残差为 $r_i = A u_i - \\theta_i u_i$。然而，在有限精度舍入和正交性损失的情况下，与完全正交性的偏差可以通过 Gram 缺陷 $\\delta := \\|\\hat{Q}_k^{\\top} \\hat{Q}_k - I\\|_2$ 的谱范数来衡量。假设以下测量和数据可用：\n- Lanczos 迭代的步数为 $k = 4$，三对角矩阵 $\\hat{T}_4$ 为\n$$\n\\hat{T}_4 = \\begin{pmatrix}\n3  1  0  0 \\\\\n1  1  0.5  0 \\\\\n0  0.5  -2  0.8 \\\\\n0  0  0.8  5\n\\end{pmatrix}.\n$$\n- 正交性损失（Gram 缺陷的谱范数）测量为 $\\delta = 3.0 \\times 10^{-12}$。\n- 已知 $A$ 的谱范数的一个先验界：$\\|A\\|_2 \\leq 20$。\n- 最后一个 Lanczos 递推系数测量为 $\\hat{\\beta}_4 = 5.0 \\times 10^{-8}$。\n- $\\hat{T}_4$ 的 Ritz 对 $(\\theta_i, y_i)$ 经过数值计算并归一化，使得 $\\|y_i\\|_2 = 1$。最后一个分量的绝对值 $c_i := |e_4^{\\top} y_i|$ 为\n$$\nc_1 = 2.0 \\times 10^{-2}, \\quad c_2 = 4.5 \\times 10^{-1}, \\quad c_3 = 1.5 \\times 10^{-5}, \\quad c_4 = 9.0 \\times 10^{-1}.\n$$\n如果一个 Ritz 对 $(\\theta_i, u_i)$ 的残差范数的修正后上界至多为给定的容差 $\\tau = 1.0 \\times 10^{-8}$，则可以安全地锁定该 Ritz 对。\n\n仅使用关于 Lanczos 迭代和 Ritz 残差的基本定义和经过充分检验的事实，推导出一个关于 $\\|r_i\\|_2$ 的保守修正后上界，该上界考虑了测得的正交性损失，并用 $\\hat{\\beta}_4$、$c_i$、$\\|A\\|_2$ 和 $\\delta$ 表示。然后对每个 $i \\in \\{1,2,3,4\\}$ 计算此界，并判断在容差 $\\tau$ 下哪些 Ritz 对可以被安全地锁定。最后，将可锁定的 Ritz 对的总数报告为一个整数，无需舍入。在适当时，所有中间数值均使用科学记数法表示。最终答案必须是单个数字。",
            "solution": "该问题有效。这是一个关于 Lanczos 迭代实际行为的数值线性代数中的适定问题。所有必要的数据都已提供，并且上下文在科学上是合理的。\n\n目标是推导 Ritz 对残差范数 $\\|r_i\\|_2$ 的一个修正后上界，该上界考虑了计算出的 Lanczos 基 $\\hat{Q}_k$ 中的正交性损失，然后利用此界确定有多少 Ritz 对可被视为收敛。\n\n首先，我们建立有限精度 Lanczos 迭代中各个量之间的关系。该过程生成一个基 $\\hat{Q}_k \\in \\mathbb{R}^{n \\times k}$ 和一个三对角矩阵 $\\hat{T}_k \\in \\mathbb{R}^{k \\times k}$，它们满足递推关系：\n$$ A \\hat{Q}_k = \\hat{Q}_k \\hat{T}_k + \\hat{\\beta}_k \\hat{q}_{k+1} e_k^{\\top} + F_k $$\n这里，$\\hat{q}_{k+1}$ 是下一个 Lanczos 向量，且 $\\|\\hat{q}_{k+1}\\|_2 = 1$，$\\hat{\\beta}_k$ 是递推系数，$F_k \\in \\mathbb{R}^{n \\times k}$ 是一个表示第 $k$ 步累积浮点误差的矩阵。\n\n一个 Ritz 对 $(\\theta_i, \\hat{u}_i)$ 由 $\\hat{T}_k$ 的一个特征对 $(\\theta_i, y_i)$ 形成。Ritz 向量为 $\\hat{u}_i = \\hat{Q}_k y_i$，其中 $\\hat{T}_k y_i = \\theta_i y_i$ 且 $\\|y_i\\|_2=1$。相应的残差为 $r_i = A \\hat{u}_i - \\theta_i \\hat{u}_i$。\n\n为求得 $r_i$ 的表达式，我们代入 $\\hat{u}_i = \\hat{Q}_k y_i$：\n$$ r_i = A(\\hat{Q}_k y_i) - \\theta_i(\\hat{Q}_k y_i) = (A \\hat{Q}_k) y_i - \\hat{Q}_k (\\theta_i y_i) $$\n使用 $A\\hat{Q}_k$ 的递推关系和属性 $\\hat{T}_k y_i = \\theta_i y_i$：\n$$ r_i = (\\hat{Q}_k \\hat{T}_k + \\hat{\\beta}_k \\hat{q}_{k+1} e_k^{\\top} + F_k) y_i - \\hat{Q}_k (\\hat{T}_k y_i) $$\n$$ r_i = \\hat{Q}_k (\\hat{T}_k y_i) + \\hat{\\beta}_k \\hat{q}_{k+1} (e_k^{\\top} y_i) + F_k y_i - \\hat{Q}_k (\\hat{T}_k y_i) $$\n$$ r_i = \\hat{\\beta}_k (e_k^{\\top} y_i) \\hat{q}_{k+1} + F_k y_i $$\n取 2-范数并应用三角不等式，我们得到残差范数的一个界：\n$$ \\|r_i\\|_2 = \\|\\hat{\\beta}_k (e_k^{\\top} y_i) \\hat{q}_{k+1} + F_k y_i\\|_2 \\leq |\\hat{\\beta}_k| |e_k^{\\top} y_i| \\|\\hat{q}_{k+1}\\|_2 + \\|F_k y_i\\|_2 $$\n鉴于 $\\|\\hat{q}_{k+1}\\|_2 = 1$，$\\|y_i\\|_2=1$，并定义 $c_i = |e_k^{\\top} y_i|$，上式可简化为：\n$$ \\|r_i\\|_2 \\leq \\hat{\\beta}_k c_i + \\|F_k\\|_2 $$\n第一项 $\\hat{\\beta}_k c_i$ 表示精确算术下的残差范数。第二项 $\\|F_k\\|_2$ 是由有限精度引起的修正项。\n\n问题要求用 $\\delta = \\|\\hat{Q}_k^{\\top} \\hat{Q}_k - I\\|_2$ 和 $\\|A\\|_2$ 来表示界。C. C. Paige 关于 Lanczos 算法的基础性工作表明，正交性损失（由 $\\delta$ 量化）和误差项 $F_k$ 都源于正交化步骤中累积的浮点误差。这两个量都与机器精度 $\\epsilon_M$ 和矩阵范数 $\\|A\\|_2$ 成比例。因此，在误差分析中，使用测得的正交性损失 $\\delta$ 作为总累积误差量级的代理指标是一种标准做法。一个简单、保守且物理上合理的误差项模型是 $\\|F_k\\|_2 \\approx \\|A\\|_2 \\delta$。这导出了所要求的残差范数的保守修正后上界，我们将其记为 $B_i$：\n$$ B_i = \\hat{\\beta}_k c_i + \\|A\\|_2 \\delta $$\n\n我们得到 $k=4$ 时的以下值：\n- $\\hat{\\beta}_4 = 5.0 \\times 10^{-8}$\n- $\\|A\\|_2 \\leq 20$，因此为了得到一个保守的界，我们使用 $\\|A\\|_2 = 20$。\n- $\\delta = 3.0 \\times 10^{-12}$\n- $c_1 = 2.0 \\times 10^{-2}$\n- $c_2 = 4.5 \\times 10^{-1}$\n- $c_3 = 1.5 \\times 10^{-5}$\n- $c_4 = 9.0 \\times 10^{-1}$\n- 锁定容差为 $\\tau = 1.0 \\times 10^{-8}$。\n\n首先，我们计算修正项，该项对所有界都是共同的：\n$$ \\|A\\|_2 \\delta = 20 \\times (3.0 \\times 10^{-12}) = 60 \\times 10^{-12} = 6.0 \\times 10^{-11} $$\n\n现在，我们对每个 Ritz 对计算界 $B_i$，并检查是否有 $B_i \\leq \\tau$。\n\n对于 $i=1$：\n$$ B_1 = \\hat{\\beta}_4 c_1 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(2.0 \\times 10^{-2}) + 6.0 \\times 10^{-11} $$\n$$ B_1 = 1.0 \\times 10^{-9} + 6.0 \\times 10^{-11} = 1.0 \\times 10^{-9} + 0.06 \\times 10^{-9} = 1.06 \\times 10^{-9} $$\n由于 $1.06 \\times 10^{-9} \\leq 1.0 \\times 10^{-8}$，Ritz 对 1 可以被锁定。\n\n对于 $i=2$：\n$$ B_2 = \\hat{\\beta}_4 c_2 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(4.5 \\times 10^{-1}) + 6.0 \\times 10^{-11} $$\n$$ B_2 = 22.5 \\times 10^{-9} + 6.0 \\times 10^{-11} = 2.25 \\times 10^{-8} + 0.006 \\times 10^{-8} = 2.256 \\times 10^{-8} $$\n由于 $2.256 \\times 10^{-8}  1.0 \\times 10^{-8}$，Ritz 对 2 不能被锁定。\n\n对于 $i=3$：\n$$ B_3 = \\hat{\\beta}_4 c_3 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(1.5 \\times 10^{-5}) + 6.0 \\times 10^{-11} $$\n$$ B_3 = 7.5 \\times 10^{-13} + 6.0 \\times 10^{-11} = 0.075 \\times 10^{-11} + 6.0 \\times 10^{-11} = 6.075 \\times 10^{-11} $$\n由于 $6.075 \\times 10^{-11} \\leq 1.0 \\times 10^{-8}$，Ritz 对 3 可以被锁定。\n\n对于 $i=4$：\n$$ B_4 = \\hat{\\beta}_4 c_4 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(9.0 \\times 10^{-1}) + 6.0 \\times 10^{-11} $$\n$$ B_4 = 45.0 \\times 10^{-9} + 6.0 \\times 10^{-11} = 4.5 \\times 10^{-8} + 0.006 \\times 10^{-8} = 4.506 \\times 10^{-8} $$\n由于 $4.506 \\times 10^{-8}  1.0 \\times 10^{-8}$，Ritz 对 4 不能被锁定。\n\n可以被安全锁定的 Ritz 对是第 1 对和第 3 对。可锁定的 Ritz 对总数为 2。",
            "answer": "$$\n\\boxed{2}\n$$"
        }
    ]
}