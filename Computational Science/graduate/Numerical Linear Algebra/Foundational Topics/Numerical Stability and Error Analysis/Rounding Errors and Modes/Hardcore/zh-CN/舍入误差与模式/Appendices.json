{
    "hands_on_practices": [
        {
            "introduction": "要精确地分析舍入误差，我们首先需要理解浮点数系统本身是如何构造的。这个练习将引导您从最基本的参数（基数、精度、指数范围）出发，亲手计算一个假设的浮点数系统所能表示的数值范围。通过计算最小和最大的规格化数以及最小的次规格化数，您将具体地理解“渐进下溢”是如何通过次规格化数来填补零与最小规格化数之间的空隙，从而确保数值计算的平滑过渡。",
            "id": "3575435",
            "problem": "考虑一个浮点系统，表示为 $F(\\beta,p,e_{\\min},e_{\\max})$，其中规格化浮点数的形式为 $\\pm \\beta^{e}\\left(d_{0} + d_{1}\\beta^{-1} + d_{2}\\beta^{-2} + \\cdots + d_{p-1}\\beta^{-(p-1)}\\right)$，其中 $1 \\leq d_{0} \\leq \\beta - 1$，$i \\geq 1$ 时 $0 \\leq d_{i} \\leq \\beta - 1$，且 $e_{\\min} \\leq e \\leq e_{\\max}$。当支持渐进下溢时，非规格化数被定义为具有固定指数 $e=e_{\\min}$ 并允许 $d_{0}=0$，因此其尾数可以小至 $d_{p-1}\\beta^{-(p-1)}$，其中 $d_{p-1} \\geq 1$。\n\n假设舍入模式为就近舍入，偶数优先（round-to-nearest, ties to even），这在电气与电子工程师协会浮点算术标准 (IEEE 754) 中有规定。设 $\\beta=4$, $p=3$, $e_{\\min}=-6$, 且 $e_{\\max}=5$。\n\n仅使用上述定义和浮点表示的公认属性，计算：\n- $F(4,3,-6,5)$ 中最小的正规格化可表示数，\n- $F(4,3,-6,5)$ 中最大的正规格化可表示数，\n- 当允许渐进下溢时，最小的正非规格化数。\n\n然后，解释这些值如何通过量化非规格化数的间距及其在指定舍入模式下与下溢边界处的规格化范围的连续性来展示渐进下溢的概念。\n\n将您的最终答案表示为一个包含三个精确值的行向量。不需要舍入。",
            "solution": "该问题是良态的，并且科学地基于 IEEE 754 标准所定义的浮点算术原理。浮点系统 $F(\\beta, p, e_{\\min}, e_{\\max})$ 的所有必要参数都已提供。规格化数和非规格化数的定义是标准且明确的。因此，可以推导出一个有效的解。\n\n指定的浮点系统是 $F(\\beta, p, e_{\\min}, e_{\\max})$，其基数 $\\beta=4$，精度 $p=3$，最小指数 $e_{\\min}=-6$，最大指数 $e_{\\max}=5$。\n\n在此系统中，一个正的规格化浮点数 $x$ 的形式为：\n$$x = \\left(d_{0} + d_{1}\\beta^{-1} + d_{2}\\beta^{-2}\\right) \\times \\beta^{e} = (d_{0}.d_{1}d_{2})_{\\beta} \\times \\beta^{e}$$\n其中数字 $d_i$ 满足 $1 \\leq d_{0} \\leq 3$ 和 $0 \\leq d_{1}, d_{2} \\leq 3$，指数 $e$ 的范围是 $-6 \\leq e \\leq 5$。\n\n一个正的非规格化浮点数 $x_{sub}$（在有渐进下溢的情况下）的形式为：\n$$x_{sub} = \\left(0 + d_{1}\\beta^{-1} + d_{2}\\beta^{-2}\\right) \\times \\beta^{e_{\\min}} = (0.d_{1}d_{2})_{\\beta} \\times \\beta^{-6}$$\n其中数字 $d_1$ 或 $d_2$ 中至少有一个必须为非零。\n\n我们现在计算所需的量。\n\n**1. 最小的正规格化可表示数**\n为了找到最小的正规格化数，我们必须选择最小可能的尾数和最小可能的指数。\n最小指数是 $e = e_{\\min} = -6$。\n对于一个规格化数，首位数字 $d_0$ 必须至少为 $1$。为了使尾数最小，我们选择最小可能的数字：$d_{0} = 1$，$d_{1} = 0$ 和 $d_{2} = 0$。\n最小的规格化尾数是 $(1.00)_{4} = 1 + 0 \\cdot 4^{-1} + 0 \\cdot 4^{-2} = 1$。\n因此，最小的正规格化数，记为 $x_{\\min\\_norm}$，是：\n$$x_{\\min\\_norm} = 1 \\times 4^{e_{\\min}} = 1 \\times 4^{-6} = 4^{-6}$$\n\n**2. 最大的正规格化可表示数**\n为了找到最大的正规格化数，我们必须选择最大可能的尾数和最大可能的指数。\n最大指数是 $e = e_{\\max} = 5$。\n为了使尾数最大，我们选择最大可能的数字，即 $\\beta-1=3$。因此，$d_0=3$，$d_1=3$ 和 $d_2=3$。\n最大的规格化尾数是 $(3.33)_{4} = 3 + 3 \\cdot 4^{-1} + 3 \\cdot 4^{-2}$。\n这可以计算为：\n$$M_{\\max\\_norm} = 3 + \\frac{3}{4} + \\frac{3}{16} = \\frac{48 + 12 + 3}{16} = \\frac{63}{16}$$\n另外，这个尾数是该系统中基点移动前 $p=3$ 位数字的最大数，即 $4 - 4^{-(p-1)} = 4 - 4^{-2}$。\n$$M_{\\max\\_norm} = 4 - \\frac{1}{16} = \\frac{63}{16}$$\n因此，最大的正规格化数，记为 $x_{\\max\\_norm}$，是：\n$$x_{\\max\\_norm} = \\left(4 - 4^{-2}\\right) \\times 4^{e_{\\max}} = \\left(4 - 4^{-2}\\right) \\times 4^{5} = 4^{6} - 4^{3}$$\n$$x_{\\max\\_norm} = 4096 - 64 = 4032$$\n\n**3. 最小的正非规格化数**\n对于非规格化数，指数固定为 $e = e_{\\min} = -6$，首位数字 $d_0 = 0$。数的形式是 $(0.d_{1}d_{2})_{4} \\times 4^{-6}$。\n为了找到最小的正值，我们必须找到最小的非零尾数。这发生在为数字选择最小可能的非零值时。我们设置 $d_1=0$，最后一个数字 $d_2=1$。\n最小的非规格化尾数是 $(0.01)_{4} = 0 + 0 \\cdot 4^{-1} + 1 \\cdot 4^{-2} = 4^{-2}$。\n因此，最小的正非规格化数，记为 $x_{\\min\\_sub}$，是：\n$$x_{\\min\\_sub} = 4^{-2} \\times 4^{e_{\\min}} = 4^{-2} \\times 4^{-6} = 4^{-8}$$\n\n**渐进下溢的解释**\n渐进下溢是一种机制，它允许当一个结果的量级小于最小规格化数时，精度能够平稳地降低。上面计算的值通过检查下溢边界附近可表示数的间距，完美地阐释了这一概念。\n\n浮点数间距的基本单位是“末位单位”(ULP)。对于指数为 $e$ 的数，ULP 是 $\\beta^{e-(p-1)}$。在我们的系统 $F(4,3,-6,5)$ 中，ULP 是 $4^{e-2}$。\n\n让我们考虑下溢阈值附近规格化数的间距。最小的规格化数是 $x_{\\min\\_norm} = (1.00)_4 \\times 4^{-6} = 4^{-6}$。指数是 $e=-6$。\n此指数的 ULP 是 $4^{-6-2} = 4^{-8}$。\n下一个可表示的规格化数是 $(1.01)_4 \\times 4^{-6} = (1 + 4^{-2}) \\times 4^{-6} = 4^{-6} + 4^{-8}$。\n前两个规格化数之间的绝对间隙是 $(4^{-6} + 4^{-8}) - 4^{-6} = 4^{-8}$。\n\n现在，我们来研究非规格化数。它们的形式是 $(0.d_1 d_2)_4 \\times 4^{-6}$。这可以重写为：\n$$(d_1 \\cdot 4^{-1} + d_2 \\cdot 4^{-2}) \\times 4^{-6} = (4d_1 + d_2) \\cdot 4^{-2} \\cdot 4^{-6} = (4d_1 + d_2) \\cdot 4^{-8}$$\n由于 $d_1, d_2 \\in \\{0, 1, 2, 3\\}$，整数值 $4d_1 + d_2$ 的范围可以从 $1$（当 $d_1=0, d_2=1$ 时）到 $15$（当 $d_1=3, d_2=3$ 时）。\n这意味着正的非规格化数恰好是 $4^{-8}$ 的整数倍：\n$$1 \\cdot 4^{-8}, 2 \\cdot 4^{-8}, 3 \\cdot 4^{-8}, \\dots, 15 \\cdot 4^{-8}$$\n其中最小的是 $x_{\\min\\_sub} = 1 \\cdot 4^{-8} = 4^{-8}$。任意两个连续非规格化数之间的间距统一为 $4^{-8}$。\n\n下溢的“渐进”特性通过非规格化数和规格化数边界处间距的无缝过渡得到了证明。\n最大的非规格化数是 $(0.33)_4 \\times 4^{-6} = (4 \\cdot 3 + 3) \\cdot 4^{-8} = 15 \\cdot 4^{-8}$。\n最小的规格化数是 $(1.00)_4 \\times 4^{-6} = 1 \\cdot 4^{-6} = 16 \\cdot 4^{-8}$。\n最大的非规格化数与最小的规格化数之间的间隙是 $(16 \\cdot 4^{-8}) - (15 \\cdot 4^{-8}) = 4^{-8}$。\n\n这个间距 $4^{-8}$，与连续非规格化数之间的间距相同，也与前几个规格化数之间的间距相同。如果没有渐进下溢，任何小于 $x_{\\min\\_norm} = 4^{-6}$ 的结果都将被刷新为 $0$，从而在 $0$ 和第一个可表示数之间造成一个巨大的间隙。渐进下溢用非规格化数填补了这个间隙，这些数保持了与邻近规格化数相同的绝对间距，确保了相邻可表示数之间的距离平滑地减小直至为零。这防止了即使 `x` 和 `y` 不相等，`x - y` 也可能为 $0$ 的不良属性，方法是确保如果 $x-y$ 落在该范围内，它可被表示为一个非规格化数。",
            "answer": "$$\\boxed{\\begin{pmatrix} 4^{-6}  4032  4^{-8} \\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了浮点数系统的基本结构后，我们来看一个在实际计算中可能遇到的具体场景。这个练习将一个乘法运算的精确结果置于“渐进下溢”的边缘，这个结果恰好落入两个可表示的次规格化数正中间，形成了一个“平局”情况。通过解决这个问题，您将练习如何在真实的IEEE 754双精度标准下处理次规格化数，并应用“向偶数舍入”这一关键的平局决胜规则。",
            "id": "3575479",
            "problem": "在电气和电子工程师协会（IEEE）754 标准的 binary64（双精度）格式中，基数为 $2$，尾数（对于规格化数，包括隐藏的前导位）的精度为 $t=53$ 位，规格化数的无偏指数范围为 $e \\in \\{-1022, -1021, \\dots, 1023\\}$。非规格化数是指绝对值严格小于 $2^{-1022}$ 的数，其表示方法为尾数中有一个隐藏的前导 $0$ 和一个固定的指数 $e_{\\min}=-1022$。舍入模式为“向最近舍入，偶数优先”(round-to-nearest, ties-to-even)。\n\n考虑两个可精确表示的双精度数\n$x = 1.5 \\times 2^{-500}$ 和 $y = 2^{-574}$。\n假设浮点乘法是先执行精确的实数乘法，然后在给定的舍入模式下（允许非规格化数）进行单次舍入，得到一个可表示的双精度数。\n\n仅从 IEEE 754 binary64 格式的基本定义（包括规格化和非规格化表示法以及“向最近舍入，偶数优先”规则）出发，确定当 $x$ 和 $y$ 相乘时的精确舍入积 $\\operatorname{fl}(x\\,y)$，并评估相对于精确实数积 $x\\,y$ 的舍入误差。\n\n作为您的最终答案，请提供绝对舍入误差 $|\\operatorname{fl}(x\\,y)-x\\,y|$，并将其精确表示为 $2$ 的单一幂。最终答案无需舍入。不必包含单位。如果您选择以数值形式表示任何中间量，可以这样做，但最终报告的量必须是所要求的精确的 $2$ 的幂。",
            "solution": "问题要求计算两个双精度浮点数 $x = 1.5 \\times 2^{-500}$ 和 $y = 2^{-574}$，在 IEEE 754 binary64 格式和“向最近舍入，偶数优先”的舍入规则下相乘所产生的绝对舍入误差。\n\n首先，我们确认输入数 $x$ 和 $y$ 本身在指定格式下是可精确表示的。\n一个规格化的 binary64 数的一般形式为 $(-1)^s \\times (1.f)_2 \\times 2^e$，其中 $s$ 是符号位，$(1.f)_2$ 是尾数，总精度为 $t=53$ 位（1 位隐藏位，52 位小数位），无偏指数 $e$ 的范围是 $[-1022, 1023]$。\n数 $x = 1.5 \\times 2^{-500}$ 可以写作 $(1 + 0.5) \\times 2^{-500} = (1.1)_2 \\times 2^{-500}$。尾数 $(1.1)_2$ 可以用可用的 53 位中的 2 位来表示，且指数 $e = -500$ 在有效范围 $[-1022, 1023]$ 内。因此，$x$ 是一个可表示的规格化数。\n数 $y = 2^{-574}$ 可以写作 $1.0 \\times 2^{-574}$。尾数 $(1.0)_2$ 是可表示的，且指数 $e=-574$ 也在有效范围内。因此，$y$ 是一个可表示的规格化数。\n\n这个过程首先涉及计算 $x$ 和 $y$ 的精确实数积，然后将此结果舍入到最接近的可表示的 binary64 数。\n\n步骤 1：计算精确积。\n令 $z$ 为 $x$ 和 $y$ 的精确实数积。\n$$z = x \\cdot y = (1.5 \\times 2^{-500}) \\times (2^{-574})$$\n$$z = 1.5 \\times 2^{-500 - 574}$$\n$$z = 1.5 \\times 2^{-1074}$$\n用二进制表示，即为 $z = (1.1)_2 \\times 2^{-1074}$。\n\n步骤 2：分析精确积 $z$。\n$z$ 的指数是 $e = -1074$。在 binary64 中，规格化数的最小指数是 $e_{\\min, \\text{norm}} = -1022$。由于 $e  e_{\\min, \\text{norm}}$，结果 $z$ 落在非规格化范围内。\nbinary64 中的非规格化数使用一个固定的指数，该指数等于最小规格化指数 $e_{\\min} = -1022$，并且尾数中有一个隐藏的前导 0 位。其形式为 $(0.f)_2 \\times 2^{-1022}$，其中 $f$ 是 52 位的小数部分。\n我们必须将 $z$ 改写为指数为 $-1022$ 的形式：\n$$z = 1.5 \\times 2^{-1074} = 1.5 \\times 2^{-1074 + 1022} \\times 2^{-1022} = 1.5 \\times 2^{-52} \\times 2^{-1022}$$\n$z$ 的尾数将是 $M_z = 1.5 \\times 2^{-52}$。我们用二进制表示它：\n$$M_z = (1+0.5) \\times 2^{-52} = 2^{-52} + 2^{-53}$$\n$$M_z = (0.\\underbrace{00\\dots0}_{51 \\text{ 个零}}1)_2 + (0.\\underbrace{00\\dots0}_{52 \\text{ 个零}}1)_2 = (0.\\underbrace{00\\dots0}_{51 \\text{ 个零}}11)_2$$\n尾数 $M_z$ 需要小数点后 53 位才能精确表示。然而，binary64 格式中用于非规格化数的小数域只提供 52 位。因此，$z$ 不是一个可精确表示的数，必须进行舍入。\n\n步骤 3：确定两边的可表示数。\n可表示的非规格化数是最小可能非规格化增量的整数倍，这个增量对应于小数部分的最低有效位（LSB）的值。这个值是 $2^{-52} \\times 2^{-1022} = 2^{-1074}$。我们称之为非规格化数的最后一位单位（ulp），$\\epsilon_{sub} = 2^{-1074}$。\n精确积为 $z = 1.5 \\times 2^{-1074} = 1.5 \\times \\epsilon_{sub}$。\n界定 $z$ 的两个可表示的 binary64 数是：\n$z_{-} = 1 \\times \\epsilon_{sub} = 1 \\times 2^{-1074}$。这个数对应于一个非规格化表示，其尾数小数部分的 LSB 设置为 1，所有其他位都为 0。其 52 位小数部分的整数值为 1。\n$z_{+} = 2 \\times \\epsilon_{sub} = 2 \\times 2^{-1074}$。这对应于一个非规格化表示，其 52 位小数部分的整数值为 2。\n\n步骤 4：应用舍入模式。\n精确值 $z = 1.5 \\times 2^{-1074}$ 正好位于 $z_-$ 和 $z_+$ 的中间。这是一个居中情况（tie case）。\n舍入模式是“向最近舍入，偶数优先”。在居中情况下，我们必须舍入到使尾数（此处指其 52 位小数部分所代表的整数）的最低有效位为 0 的那个数。\n对于 $z_{-}$，尾数小数部分的整数值为 $1$，是奇数。\n对于 $z_{+}$，尾数小数部分的整数值为 $2$，是偶数。\n因此，规则要求向上舍入到 $z_{+}$。\n舍入后的积是 $\\operatorname{fl}(x\\,y) = z_{+}$。\n$$\\operatorname{fl}(x\\,y) = 2 \\times 2^{-1074} = 2^{-1073}$$\n\n步骤 5：计算绝对舍入误差。\n绝对舍入误差是舍入值与精确值之差的绝对值。\n$$\\text{绝对误差} = |\\operatorname{fl}(x\\,y) - z|$$\n$$\\text{绝对误差} = |2 \\times 2^{-1074} - 1.5 \\times 2^{-1074}|$$\n$$\\text{绝对误差} = |(2 - 1.5)| \\times 2^{-1074}$$\n$$\\text{绝对误差} = 0.5 \\times 2^{-1074}$$\n$$\\text{绝对误差} = 2^{-1} \\times 2^{-1074}$$\n$$\\text{绝对误差} = 2^{-1075}$$\n\n绝对舍入误差精确为 $2^{-1075}$。",
            "answer": "$$\\boxed{2^{-1075}}$$"
        },
        {
            "introduction": "我们通常认为浮点运算总会引入误差，但事实并非总是如此。这个练习探讨了一个重要且有些反直觉的特性：在特定条件下，两个浮点数的减法可以得到一个无需舍入的精确结果。您将推导并应用著名的Sterbenz引理，该引理为精确减法提供了一个简单的判据，这对于编写高可靠性的数值算法和进行严格的误差分析至关重要。",
            "id": "3575443",
            "problem": "考虑电气与电子工程师协会（IEEE）754标准的binary64浮点算术，其基数 $\\beta = 2$，精度 $p = 53$（包括隐含的前导位），舍入方式为向最近偶数舍入。在论证可表示性时，仅使用规格化浮点数和精确实数算术。使用以下基本事实作为出发点：在基数为2的规格化浮点系统中，任何非零数 $x$ 都可以唯一地写成 $x = m \\cdot 2^{E}$ 的形式，其中整数 $m$ 满足 $2^{p-1} \\leq m  2^{p}$，并且对于任何固定的指数 $E$，在指数间隔 $[2^{E}, 2^{E+1})$ 内，连续可表示数之间的距离等于 $2^{E-(p-1)}$。将 $x$ 处的末位单位（ULP）定义为在 $x$ 的尺度下，到下一个更大的可表示数之间的距离。\n1) 从这些原则出发，且不引用任何定理，推导出一个紧确的乘法阈值 $T \\geq 1$，该阈值具有以下性质：对于任意两个规格化浮点数 $x$ 和 $y$（其中 $y \\neq 0$）且满足\n$$\nT^{-1} \\leq \\frac{x}{y} \\leq T,\n$$\n其精确实数差 $x - y$ 本身就是该系统中的一个规格化浮点数（因此，在任何舍入模式下，减法都是精确的）。你的推导过程应确定必要的指数对齐，刻画对齐前后的整数有效数，并证明在这种情况下不需要舍入。\n2) 给出具体的双精度（binary64）例子，用以说明在向最近偶数舍入模式下精确和非精确减法的结果，并从基本原理（ULP和指数间隔结构）解释每个结果：\n- 例子A（精确减法的候选）：取 $x_{A} = 1 + 2^{-52}$ 和 $y_{A} = 1$。\n- 例子B（非精确减法的候选）：取 $x_{B} = 1$ 和 $y_{B} = 2^{-53}$。\n- 例子C（精确减法的候选）：取 $x_{C} = \\frac{11}{8}$ 和 $y_{C} = \\frac{3}{4}$。\n对于每个例子，计算精确实数差和在给定舍入模式下的浮点结果 $\\mathrm{fl}(x - y)$，并说明减法是精确的还是非精确的，通过分析ULP尺度的间距以及与你推导的阈值相关的比率条件来证明你的论断。\n最终答案只需报告阈值 $T$ 的精确值。无需舍入。",
            "solution": "问题分为两部分。第一部分要求推导精确浮点减法的紧确乘法阈值 $T$。第二部分要求分析三个具体例子。\n\n第1部分：阈值 $T$ 的推导\n\n设 $x$ 和 $y$ 是指定系统中的两个规格化浮点数，基数 $\\beta=2$，精度 $p=53$。根据问题陈述，任何这样的非零数 $z$ 都可以唯一地写成 $z = m \\cdot 2^E$，其中 $m$ 是满足 $2^{p-1} \\leq m  2^p$ 的整数，而 $E$ 是一个整数指数。通过设 $f=m/2^{p-1}$ 和 $e=E+p-1$，这种表示可以映射到更标准的形式 $z = f \\cdot 2^e$，其中 $1 \\le f  2$ 是尾数，$e$ 是指数。任何这类数的尾数 $f$ 都是一个形如 $M/2^{p-1}$ 的有理数，其中 $M$ 是 $[2^{p-1}, 2^p)$ 内的某个整数。\n\n我们寻求一个紧确阈值 $T \\geq 1$，使得如果 $T^{-1} \\leq x/y \\leq T$，差值 $x-y$ 是一个精确可表示的规格化浮点数。减法精确意味着存储结果无需舍入。\n\n不失一般性，我们假设 $x \\geq y  0$。该条件便简化为 $1 \\leq x/y \\leq T$。$y  x  0$ 的情况是对称的：如果 $y-x$ 是精确的，那么 $x-y = -(y-x)$ 也是精确的。\n\n设 $x$ 和 $y$ 的表示为：\n$x = m_x \\cdot 2^{E_x}$\n$y = m_y \\cdot 2^{E_y}$\n其中 $m_x$ 和 $m_y$ 是 $p$ 位整数，满足 $2^{p-1} \\leq m_x, m_y  2^p$。\n\n精确差为 $x-y = m_x \\cdot 2^{E_x} - m_y \\cdot 2^{E_y}$。为了执行减法，指数必须对齐。令 $k = E_x - E_y$。因为 $x \\geq y$，我们有 $x = m_x 2^{E_x} \\ge y = m_y 2^{E_y}$。比率 $x/y = (m_x/m_y) 2^k$。鉴于 $2^{p-1} \\le m_x, m_y  2^p$，我们有 $1/2  m_x/m_y  2$。因此，$2^{k-1}  x/y  2^{k+1}$。因为 $x/y \\ge 1$，我们必须有 $k+1 > \\log_2(1) = 0$，所以 $k > -1$，这意味着 $k \\ge 0$。\n\n差值可以用公共指数 $E_y$ 写成：\n$x-y = (m_x \\cdot 2^{E_x - E_y} - m_y) \\cdot 2^{E_y} = (m_x 2^k - m_y) \\cdot 2^{E_y}$。\n令 $D = m_x 2^k - m_y$。$D$ 是一个整数。差值 $x-y$ 是精确可表示的，当且仅当它可以写成 $m_d \\cdot 2^{E_d}$ 的形式，其中整数 $m_d, E_d$ 满足 $2^{p-1} \\leq m_d  2^p$。这当且仅当整数 $D$ 可以表示为 $m_d \\cdot 2^s$（对于某个整数 $s$），其中 $m_d$ 是一个其二进制表示最多需要 $p$ 位的整数，并且在移位后能落入规格化范围内时，才有可能。更正式地，令 $D = \\tilde{D} \\cdot 2^s$，其中 $\\tilde{D}$ 是一个奇数。如果 $\\tilde{D}$ 可以存储在一个 $p$ 位尾数中，即要求 $\\tilde{D}  2^p$，那么结果就是精确可表示的。\n\n对比率的条件是 $1 \\leq x/y \\leq T$。我们将检验紧确阈值为 $T=2$ 的假设。因此，我们分析条件 $1 \\leq x/y \\leq 2$。\n从 $2^{k-1}  x/y \\le 2$，我们必须有 $k-1  \\log_2(2) = 1$，这意味着 $k2$。如前所述，$k \\ge 0$。所以，$k$ 只能是 $0$ 或 $1$。\n\n情况1：$k=0$ ($E_x = E_y$)。\n条件 $1 \\leq x/y \\leq 2$ 变为 $1 \\leq m_x/m_y  2$。由于 $m_x, m_y \\ge 2^{p-1}$，当 $x \\ge y$ 且 $k=0$ 时，这个条件总是满足的。\n整数差为 $D = m_x - m_y$。因为 $x \\ge y$，我们有 $D \\ge 0$。\n整数有效数是有界的：$2^{p-1} \\leq m_y \\leq m_x  2^p$。\n因此，$D = m_x - m_y  2^p - 2^{p-1} = 2^{p-1}$。\n$D$ 的奇数部分 $\\tilde{D}$ 必须小于 $D$，所以 $\\tilde{D}  2^{p-1}$。这严格小于 $2^p$。因此，$D$ 可以被规格化为一个 $p$ 位尾数，减法总是精确的。\n\n情况2：$k=1$ ($E_x = E_y+1$)。\n条件 $1 \\leq x/y \\leq 2$ 变为 $1 \\leq (m_x/m_y) \\cdot 2 \\leq 2$，这意味着 $1/2 \\leq m_x/m_y \\leq 1$。\n整数差为 $D = m_x 2^1 - m_y$。从 $m_x/m_y \\leq 1$，我们有 $m_x \\leq m_y$。\n那么 $D = 2m_x - m_y \\leq 2m_x - m_x = m_x$。\n因为 $m_x  2^p$，我们有 $D  2^p$。\n$D$ 的奇数部分 $\\tilde{D}$ 必须小于或等于 $D$，所以 $\\tilde{D}  2^p$。这个条件保证了结果是精确可表示的。\n\n结合这两种情况，如果 $1 \\le x/y \\le 2$，减法 $x-y$ 是精确的。\n如果我们考虑 $y > x > 0$，条件 $T^{-1} \\le x/y \\le T$ 变为 $1/2 \\le x/y  1$。令 $x' = y$ 和 $y'=x$。那么 $1  x'/y' \\le 2$。根据上面的分析，$x'-y' = y-x$ 是精确的。因此，$x-y=-(y-x)$ 也是精确的。\n所以，对于任意两个规格化浮点数 $x,y$，如果 $1/2 \\leq x/y \\leq 2$，差值 $x-y$ 是精确的。这表明 $T=2$ 是一个有效的阈值。\n\n为了证明 $T=2$ 是最紧确的可能阈值，我们必须证明对于任何 $T > 2$，都存在 $x, y$ 使得 $2  x/y \\le T$ 并且 $x-y$ 不是精确可表示的。\n考虑一个略大于2的比率。令 $k = E_x - E_y = 2$。那么 $x/y = (m_x/m_y) \\cdot 4$。要使其略大于2，我们需要 $m_x/m_y$ 略大于 $1/2$。\n我们选择 $m_x = 2^{p-1}$（最小的p位规格化整数有效数）和 $m_y = 2^p-1$（最大的）。\n对于 $p=53$：\n$x = 2^{52} \\cdot 2^{E_x}$\n$y = (2^{53}-1) \\cdot 2^{E_y}$\n设 $E_x = E_y+2$，所以 $k=2$。\n比率为 $x/y = \\frac{2^{52}}{2^{53}-1} \\cdot 2^2 = \\frac{2^{54}}{2^{53}-1} = \\frac{2(2^{53}-1)+2}{2^{53}-1} = 2 + \\frac{2}{2^{53}-1}$。这个比率略大于2。\n我们来计算差值的整数形式：\n$D = m_x 2^k - m_y = 2^{52} \\cdot 2^2 - (2^{53}-1) = 2^{54} - 2^{53} + 1 = 2 \\cdot 2^{53} - 2^{53} + 1 = 2^{53}+1$。\n整数结果是 $D=2^{53}+1$。在二进制中，这是一个1后面跟着52个0，然后是一个1。它需要 $p+1=54$ 位来表示。其奇数部分是 $\\tilde{D}=D=2^{53}+1$。\n由于 $\\tilde{D} > 2^{53}$，它不能用一个 $p=53$ 位的尾数来表示。结果 $x-y=D \\cdot 2^{E_y}=(2^{53}+1) \\cdot 2^{E_y}$ 不是精确可表示的。它必须被舍入。\n这证明了对于任何比率 $x/y > 2$，都不能保证精确减法。因此，阈值 $T=2$ 是紧确的。\n\n第2部分：例子分析\n\n我们对 binary64 使用 $p=53$。\n\n例子A：$x_{A} = 1 + 2^{-52}$，$y_{A} = 1$。\n$x_A$ 和 $y_A$ 是指数间隔 $[1, 2)$ 内的连续规格化浮点数。此指数间隔内的末位单位（ULP）是 $2^{0-(p-1)} = 2^{-52}$。\n$x_A = (1+2^{-52}) \\cdot 2^0$。它的尾数是 $1+2^{-52}$，指数是 $0$。它是一个有效的 binary64 数。\n$y_A = 1 = 1.0 \\cdot 2^0$。也是一个有效的 binary64 数。\n比率为 $x_A/y_A = 1+2^{-52}$。这位于区间 $[1/2, 2]$ 内。我们推导的定理预测减法是精确的。\n精确实数差是 $x_A - y_A = (1+2^{-52}) - 1 = 2^{-52}$。\n数 $2^{-52}$ 可以写成 $1.0 \\cdot 2^{-52}$，这是一个规格化的 binary64 数（尾数是 $1.0$，指数是 $-52$）。\n结果 $\\mathrm{fl}(x_A - y_A)$ 精确地为 $2^{-52}$。减法是**精确的**。\n\n例子B：$x_{B} = 1$，$y_{B} = 2^{-53}$。\n$x_B = 1 = 1.0 \\cdot 2^0$。规格化的。\n$y_B = 2^{-53} = 1.0 \\cdot 2^{-53}$。规格化的。\n比率为 $x_B/y_B = 1 / 2^{-53} = 2^{53}$。这远大于阈值 $T=2$。该定理不保证精确减法。\n精确实数差是 $x_B - y_B = 1 - 2^{-53}$。\n我们来检查这是否是一个精确可表示的 binary64 数。\n$1 - 2^{-53} = (2-2^{-52}) \\cdot 2^{-1}$。\n尾数将是 $f_d = 2-2^{-52} = 1 + (1-2^{-52}) = 1 + \\sum_{i=1}^{52} 2^{-i}$。这对应于二进制表示 $1.11...1$，小数点后有52个1。这是一个有效的 $p=53$ 位尾数。指数是 $e_d = -1$，这是一个有效的指数。\n因此，$1-2^{-53}$ 是一个精确可表示的 binary64 数。事实上，它是严格小于1的最大可表示数。\n由于精确结果是一个可表示的数，因此不需要舍入。计算出的浮点结果是 $\\mathrm{fl}(x_B - y_B) = 1-2^{-53}$。减法是**精确的**。这表明斯特本茨条件（$T^{-1} \\le x/y \\le T$）是精确减法的充分条件，但不是必要条件。\n\n例子C：$x_{C} = \\frac{11}{8}$，$y_{C} = \\frac{3}{4}$。\n$x_C = \\frac{11}{8} = 1.375 = (1.011)_2 = 1.375 \\cdot 2^0$。这是一个规格化的 binary64 数。\n$y_C = \\frac{3}{4} = 0.75 = (0.11)_2 = 1.5 \\cdot 2^{-1}$。这是一个规格化的 binary64 数。\n比率为 $x_C/y_C = (\\frac{11}{8}) / (\\frac{3}{4}) = \\frac{11}{8} \\cdot \\frac{4}{3} = \\frac{11}{6} \\approx 1.833$。\n这个比率位于区间 $[1, 2]$ 内，因此满足条件 $1/2 \\leq x_C/y_C \\leq 2$。该定理预测减法是精确的。\n精确实数差是 $x_C - y_C = \\frac{11}{8} - \\frac{6}{8} = \\frac{5}{8}$。\n数 $\\frac{5}{8} = 0.625 = (0.101)_2 = 1.25 \\cdot 2^{-1}$。尾数 $1.25$ 和指数 $-1$ 构成了一个有效的规格化 binary64 数。\n结果 $\\mathrm{fl}(x_C - y_C)$ 精确地为 $\\frac{5}{8}$。减法是**精确的**。\n这也可以通过注意到两个操作数和结果都是一个公共的更小的值 $\\frac{1}{8}$ 的整数倍，而 $\\frac{1}{8}$ 本身也是一个浮点数来看出。\n$x_C=11 \\cdot (\\frac{1}{8})$，$y_C=6 \\cdot (\\frac{1}{8})$，所以 $x_C-y_C=5 \\cdot (\\frac{1}{8}) = \\frac{5}{8}$。\n\n最终答案仅要求阈值 $T$ 的值。",
            "answer": "$$\n\\boxed{2}\n$$"
        }
    ]
}