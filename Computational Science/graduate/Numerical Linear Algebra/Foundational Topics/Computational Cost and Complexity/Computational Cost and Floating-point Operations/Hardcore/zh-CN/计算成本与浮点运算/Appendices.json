{
    "hands_on_practices": [
        {
            "introduction": "在数值计算中，即使是对于相同的数学结果，计算方式的选择也会极大地影响其计算成本。这个练习通过一个经典的例子——多项式求值——来阐明这一核心思想。通过从第一性原理推导并比较朴素的逐项求幂方法和高效的霍纳法则 (Horner's method) 的浮点运算数 (FLOPs)，你将亲身体会到算法设计对于计算效率的深远影响。",
            "id": "3538828",
            "problem": "考虑一个 $n$ 次多项式 $p(x) = a_{0} + a_{1} x + a_{2} x^{2} + \\cdots + a_{n} x^{n}$，其中对于 $k \\in \\{0,1,\\dots,n\\}$，所有系数 $a_{k}$ 均为实数且通常为非零值，并且 $x \\in \\mathbb{R}$ 是一个给定的标量。你将使用两种不同的方法来计算 $p(x)$ 的值，并计算浮点运算次数（FLOPs），其中根据定义，一次浮点加法消耗 $1$ FLOP，一次浮点乘法消耗 $1$ FLOP；不允许进行其他类型的运算，并且不允许使用融合乘加（FMA）。\n\n方法 A（Horner 法则）：从最高次系数开始，使用嵌套递推来计算 $p(x)$，即用 $y := a_{n}$ 进行初始化，然后对 $k = n-1, n-2, \\dots, 0$ 迭代更新 $y := y \\cdot x + a_{k}$。\n\n方法 B（朴素单项式求值）：通过分别计算每个单项式 $a_{k} x^{k}$ 然后求和的方式来计算 $p(x)$。对于每个 $k \\geq 1$，从值 $x$ 本身开始，通过重复乘以 $x$ 来计算 $x^{k}$（这样构造 $x^{k}$ 恰好需要 $k-1$ 次乘法），然后将结果乘以一次 $a_{k}$，并将其加到一个初始化为 $a_{0}$ 的累加器中。在不同单项式之间不要重用任何 $x$ 的中间次幂。\n\n从多项式的基本定义和 FLOPs 的算术结构出发，推导出方法 A 和方法 B 的精确 FLOPs 计数，作为 $n$ 的函数。然后，将方法 B 的 FLOPs 计数与方法 A 的 FLOPs 计数的比率表示为关于 $n$ 的单个封闭形式表达式。提供此比率作为你的最终答案。不需要进行四舍五入。",
            "solution": "问题要求对使用两种不同算法（Horner 法则和朴素单项式求值）计算一个 $n$ 次多项式的计算成本（以浮点运算次数，即 FLOPs 衡量）进行比较分析。我们需要推导每种方法的 FLOP 计数，然后确定朴素方法的成本与 Horner 方法的成本之比。\n\n多项式由 $p(x) = \\sum_{k=0}^{n} a_k x^k$ 给出，其中 $n$ 是次数，$a_k \\in \\mathbb{R}$ 是系数，$x \\in \\mathbb{R}$ 是求值点。根据定义，一次浮点加法或一次浮点乘法贡献 1 FLOP。\n\n首先，我们分析方法 A，即 Horner 法则。该算法由一个初始化和一个递推定义：\n1.  用最高次系数初始化一个累加器 $y$：$y := a_{n}$。这是一个赋值操作，消耗 $0$ FLOPs。\n2.  对于 $k = n-1, n-2, \\dots, 0$，迭代更新累加器：$y := y \\cdot x + a_{k}$。\n\n让我们研究迭代步骤 $y := y \\cdot x + a_{k}$ 的计算成本。这个操作包含一次乘法（$y \\cdot x$）和一次加法（结果加上 $a_k$）。因此，每次迭代恰好消耗 1 次乘法 FLOP 和 1 次加法 FLOP，每次迭代总共为 2 FLOPs。\n\n循环的索引 $k$ 从 $n-1$ 递减到 $0$。迭代次数是此范围内的整数个数，即 $(n-1) - 0 + 1 = n$。\n方法 A 的总 FLOP 计数，记为 $C_A(n)$，是迭代次数与每次迭代成本的乘积。\n$$C_A(n) = n \\times (\\text{1 次乘法} + \\text{1 次加法}) = n \\times (1 + 1) \\text{ FLOPs} = 2n \\text{ FLOPs}$$\n因此，Horner 法的总成本为 $C_A(n) = 2n$。\n\n接下来，我们分析方法 B，即朴素单项式求值。该算法定义如下：\n1.  为总和初始化一个累加器，$S := a_0$。这消耗 0 FLOPs。\n2.  对于从 $1$ 到 $n$ 的每个索引 $k$，计算项 $a_k x^k$ 并将其加到累加器中：$S := S + a_k x^k$。\n\n问题指明，对于每个 $k \\geq 1$，$x^k$ 的幂是通过 $k-1$ 次连续乘法计算的（例如，$x^2 = x \\cdot x$, $x^3 = x^2 \\cdot x$ 等），并且在不同单项式的计算之间不重用 $x$ 的中间次幂。\n\n让我们为给定的 $k \\in \\{1, 2, \\dots, n\\}$ 分解计算单个项 $a_k x^k$ 并将其加到总和中的 FLOPs：\n-   计算 $x^k$ 的幂：这需要 $k-1$ 次乘法。\n-   乘以系数 $a_k$：这需要 1 次乘法。\n-   将结果 $a_k x^k$ 加到累加器 $S$ 中：这需要 1 次加法。\n\n第 $k$ 项的总乘法次数为 $(k-1) + 1 = k$。\n第 $k$ 项的总加法次数为 $1$。\n因此，处理第 $k$ 项的总 FLOPs 为 $k+1$。\n\n为了找到方法 B 的总 FLOP 计数 $C_B(n)$，我们必须将从 $k=1$ 到 $n$ 的所有项的成本相加。\n总乘法次数是每一项乘法次数的总和：\n$$M_B(n) = \\sum_{k=1}^{n} k = \\frac{n(n+1)}{2}$$\n总加法次数是每一项加法次数的总和：\n$$A_B(n) = \\sum_{k=1}^{n} 1 = n$$\n方法 B 的总 FLOP 计数是所有乘法和加法的总和：\n$$C_B(n) = M_B(n) + A_B(n) = \\frac{n(n+1)}{2} + n = \\frac{n^2+n}{2} + \\frac{2n}{2} = \\frac{n^2+3n}{2}$$\n\n最后，我们需要求方法 B 的 FLOP 计数与方法 A 的 FLOP 计数的比率。设此比率为 $R(n)$。\n$$R(n) = \\frac{C_B(n)}{C_A(n)} = \\frac{\\frac{n^2+3n}{2}}{2n}$$\n对于一个次数 $n \\ge 1$ 的多项式， $C_A(n)$ 和 $C_B(n)$ 均为非零，因此可以进行简化。对于边界情况 $n=0$，$p(x)=a_0$，两种方法都需要 0 FLOPs，使得比率不确定（$0/0$）。然而，要求提供单个封闭形式表达式表明我们应该找到一个在 $n \\ge 1$ 时（此时计算不平凡）有效的公式。对于 $n \\ge 1$，我们可以简化 $R(n)$ 的表达式：\n$$R(n) = \\frac{n^2+3n}{4n} = \\frac{n(n+3)}{4n}$$\n由于 $n \\neq 0$，我们可以从分子和分母中约去因子 $n$：\n$$R(n) = \\frac{n+3}{4}$$\n这个封闭形式表达式给出了任何次数 $n \\ge 1$ 的多项式的计算成本之比。",
            "answer": "$$\\boxed{\\frac{n+3}{4}}$$"
        },
        {
            "introduction": "在科学与工程计算中，我们经常需要对同一个线性系统求解数百次，只是每次的外部输入（即右端项向量 $b$）不同。直接为每一个 $b$ 反复求解整个系统 $Ax=b$ 的代价是高昂的。本练习将引导你分析一种更高效的策略：一次性计算矩阵 $A$ 的 LU 分解，然后利用该分解快速求解所有不同的右端项。",
            "id": "2160772",
            "problem": "一个计算科学家团队正在为一个复杂的物理系统建模。该系统的状态由向量 $x$ 表示，并由线性方程组 $Ax=b$ 确定。矩阵 $A$ 的大小为 $600 \\times 600$，描述了系统固定的内部相互作用，并且不会改变。该团队需要分析系统对100种不同外部条件的响应，每种条件由一个唯一的右侧向量 $b$ 表示。\n\n为了高效地解决这个问题，他们首先计算矩阵 $A$ 的LU分解（Lower-Upper factorization）。一个 $N \\times N$ 矩阵进行LU分解所需的浮点运算（flops）近似数量由公式 $\\frac{2}{3}N^3$ 给出。\n\n一旦获得分解 $A=LU$，对于任何给定的 $b$ 求解 $x$ 就变成一个两步过程：首先求解下三角系统 $Ly=b$（前向代入），然后求解上三角系统 $Ux=y$（后向代入）。求解一个 $N \\times N$ 的三角系统（无论是下三角还是上三角）所需的浮点运算近似数量为 $N^2$。\n\n计算求解所有100种不同外部条件的解所需的浮点运算总数。此计算必须包括执行LU分解的一次性成本。",
            "solution": "设 $N=600$ 为矩阵维度，设 $R=100$ 为不同右侧向量的数量。\n\n一个 $N \\times N$ 矩阵的LU分解成本由下式给出\n$$\n\\frac{2}{3}N^{3}.\n$$\n求解一个下三角系统和一个上三角系统的成本是每个右侧向量 $N^{2}+N^{2}=2N^{2}$。对于 $R$ 个右侧向量，总成本为\n$$\n2RN^{2}.\n$$\n因此，总浮点运算次数为\n$$\n\\frac{2}{3}N^{3}+2RN^{2}.\n$$\n代入 $N=600$ 和 $R=100$，\n$$\n\\frac{2}{3}\\cdot 600^{3}+2\\cdot 100 \\cdot 600^{2}.\n$$\n精确计算每一项：\n$$\n600^{3}=(6\\cdot 10^{2})^{3}=216\\cdot 10^{6}=216{,}000{,}000,\n$$\n所以\n$$\n\\frac{2}{3}\\cdot 600^{3}=\\frac{2}{3}\\cdot 216{,}000{,}000=144{,}000{,}000.\n$$\n此外，\n$$\n600^{2}=360{,}000,\\quad 2\\cdot 100 \\cdot 600^{2}=200\\cdot 360{,}000=72{,}000{,}000.\n$$\n将两部分贡献相加，\n$$\n144{,}000{,}000+72{,}000{,}000=216{,}000{,}000.\n$$\n因此，总浮点运算次数为 $216{,}000{,}000$。",
            "answer": "$$\\boxed{216000000}$$"
        },
        {
            "introduction": "求解线性最小二乘问题是数值线性代数的核心任务之一，而选择正确的算法至关重要。本练习要求你对两种主流方法进行深入的计算成本分析：基于格拉姆矩阵 (Gram matrix) 的正规方程法，以及基于 Householder 变换的 QR 分解法。通过精确推导这两种方法的浮点运算数，你将能够量化它们在计算效率上的差异，这是在实际应用中做出明智算法选择的关键一步。",
            "id": "3538906",
            "problem": "设 $A \\in \\mathbb{R}^{m \\times n}$ 满足 $m \\geq n$ 且为列满秩，并设 $b \\in \\mathbb{R}^{m}$。在实数算术中进行运算，并采用以下浮点运算（flop）模型：每次浮点加法、减法、乘法或除法计为一次flop；计算平方根不计入flop。忽略内存流量和缓存效应。两个长度为 $\\ell$ 的向量的点积需要 $2\\ell - 1$ 次flop，当向量 $v$ 可用时，对一个 $\\ell \\times p$ 矩阵进行秩一更新 $U := U - u v^{T}$，若以向量外积减法的形式执行，则需要 $2 \\ell p$ 次flop。你可以使用这样一个结论：对于一个 $n \\times n$ 上三角矩阵的回代过程，其flop计数恰好为 $n^{2}$。\n\n1) 根据第一性原理，推导利用对称性（只计算上三角部分，然后复制到下三角部分）形成格拉姆矩阵 $G = A^{T} A$ 的精确flop计数。你的推导必须考虑到，对于 $1 \\leq i \\leq j \\leq n$ 的每个元素 $G_{ij}$ 都是 $\\mathbb{R}^{m}$ 中两个向量的点积。\n\n2) 根据第一性原理，推导使用非分块的、基于Householder的QR方法求解线性最小二乘问题 $\\min_{x \\in \\mathbb{R}^{n}} \\|A x - b\\|_{2}$ 的精确flop计数，其中不显式地形成 $Q$：\n- 在第 $j$ 步（$1 \\leq j \\leq n$），构造一个长度为 $\\ell_{j} = m - j + 1$ 的Householder反射变换 $H_{j} = I - \\tau_{j} v_{j} v_{j}^{T}$，它将第 $j$ 列的次对角线部分置零。假设构造 $v_{j}$ 和 $\\tau_{j}$ 的成本恰好为 $2 \\ell_{j}$ 次flop（对应于一次点积加上可忽略的标量运算），并忽略平方根的计算成本。\n- 仅将 $H_{j}$ 应用于 $A$ 中由第 $j+1$ 列到第 $n$ 列组成的尾随子矩阵；不要显式更新第 $j$ 列。实现 $A \\leftarrow A - v_{j} \\left(\\tau_{j} v_{j}^{T} A\\right)$，并精确计算此应用的flop数。\n- 在同一次扫描中，将 $H_{j}$ 应用于 $b$ 的最后 $\\ell_{j}$ 个元素，即执行 $b \\leftarrow b - v_{j} \\left(\\tau_{j} v_{j}^{T} b\\right)$。\n- 在应用完所有反射变换后，通过回代求解 $R x = Q^{T} b$，其中 $R$ 是得到的 $n \\times n$ 上三角因子。\n\n3) 设 $F_{\\mathrm{Gram}}(m,n)$ 为你在第1部分得到的flop计数，$F_{\\mathrm{QR\\_solve}}(m,n)$ 为你在第2部分得到的flop计数。给出比率\n$$\nR(m,n) \\;=\\; \\frac{F_{\\mathrm{Gram}}(m,n)}{F_{\\mathrm{QR\\_solve}}(m,n)}.\n$$\n的简化闭式解析表达式。你的最终答案必须是这个单一的表达式。不要提供任何数值近似。如果简化因子，请保持表达式的精确性。不需要单位。",
            "solution": "该问题要求基于一个特定的flop模型，推导两种不同的浮点运算（flop）计数及其后续的比率。首先，我们将推导形成格拉姆矩阵的flop计数。其次，我们将推导使用基于Householder QR的方法求解线性最小二乘问题的flop计数。最后，我们将计算这两个计数的比率。\n\n第1部分：形成格拉姆矩阵的flop计数，$F_{\\mathrm{Gram}}(m,n)$。\n格拉姆矩阵定义为 $G = A^{T} A$，其中 $A \\in \\mathbb{R}^{m \\times n}$。得到的矩阵 $G$ 是一个 $n \\times n$ 的对称矩阵。元素 $G_{ij}$ 是 $A$ 的第 $i$ 列（记为 $a_i \\in \\mathbb{R}^m$）与 $A$ 的第 $j$ 列（记为 $a_j \\in \\mathbb{R}^m$）的点积。即，$G_{ij} = a_i^T a_j$。\n问题指明要利用对称性，只计算 $G$ 的上三角部分，即 $1 \\le i \\le j \\le n$ 的元素 $G_{ij}$。这样的元素数量是前 $n$ 个整数的和：$n + (n-1) + \\dots + 1 = \\frac{n(n+1)}{2}$。\n每个元素是两个长度为 $m$ 的向量的点积。根据给定的flop模型，两个长度为 $\\ell$ 的向量的点积需要 $2\\ell - 1$ 次flop。在我们的情况下，$\\ell=m$，所以每个元素 $G_{ij}$ 的成本是 $2m-1$ 次flop。\n因此，形成格拉姆矩阵 $G$ 的总flop计数是要计算的元素数量与每个元素成本的乘积：\n$$\nF_{\\mathrm{Gram}}(m,n) = \\frac{n(n+1)}{2} (2m-1)\n$$\n在给定模型下，这个表达式是形成格拉姆矩阵的精确flop计数。\n\n第2部分：通过Householder QR求解最小二乘问题的flop计数，$F_{\\mathrm{QR\\_solve}}(m,n)$。\n该方法包括 $n$ 步Householder变换，将 $A$ 约简为上三角形式 $R$，然后求解一个三角系统。我们将这 $n$ 步的成本相加，并加上最后回代过程的成本。\n\n在第 $j$ 步，对于 $j = 1, \\dots, n$，我们构造并应用一个Householder反射变换 $H_j = I - \\tau_j v_j v_j^T$。向量 $v_j$ 的长度为 $\\ell_j = m-j+1$。\n第 $j$ 步的成本分解如下：\n1.  构造 $v_j$ 和 $\\tau_j$：问题陈述其成本恰好为 $2\\ell_j = 2(m-j+1)$ 次flop。\n2.  将 $H_j$ 应用于 $A$ 的尾随子矩阵：反射变换应用于子矩阵 $A(j:m, j+1:n)$，其维度为 $\\ell_j \\times (n-j)$。更新操作为 $A \\leftarrow A - v_j(\\tau_j v_j^T A)$。执行时，首先计算行向量 $w^T = \\tau_j (v_j^T A(j:m, j+1:n))$，然后执行更新 $A(j:m, j+1:n) \\leftarrow A(j:m, j+1:n) - v_j w^T$。\n    - 计算 $v_j^T A(j:m, j+1:n)$ 涉及 $n-j$ 次长度为 $\\ell_j$ 的向量的点积。这需要 $(n-j)(2\\ell_j - 1)$ 次flop。\n    - 乘以 $\\tau_j$ 额外需要 $n-j$ 次flop。\n    - 秩一更新 $A(j:m, j+1:n) - v_j w^T$ 涉及一个长度为 $\\ell_j$ 的向量和一个长度为 $n-j$ 的向量的外积，以及一个矩阵减法。这需要 $\\ell_j(n-j)$ 次乘法和 $\\ell_j(n-j)$ 次减法，总共为 $2\\ell_j(n-j)$ 次flop。\n    - 在第 $j$ 步更新矩阵的总成本是 $(n-j)(2\\ell_j-1) + (n-j) + 2\\ell_j(n-j) = (n-j)(2\\ell_j-1+1) + 2\\ell_j(n-j) = 2\\ell_j(n-j) + 2\\ell_j(n-j) = 4\\ell_j(n-j) = 4(m-j+1)(n-j)$ 次flop。当 $j=n$ 时，此成本为零。\n3.  将 $H_j$ 应用于向量 $b$：反射变换应用于 $b$ 的最后 $\\ell_j$ 个元素。更新操作为 $b \\leftarrow b - v_j(\\tau_j v_j^T b)$。\n    - 点积 $v_j^T b$（长度为 $\\ell_j$ 的向量）需要 $2\\ell_j - 1$ 次flop。\n    - 乘以 $\\tau_j$ 需要 $1$ 次flop。\n    - 缩放向量减法需要 $2\\ell_j$ 次flop（$\\ell_j$ 次乘法和 $\\ell_j$ 次减法）。\n    - 更新 $b$ 的总成本是 $(2\\ell_j - 1) + 1 + 2\\ell_j = 4\\ell_j = 4(m-j+1)$ 次flop。\n\nQR分解阶段的总成本是这些成本在 $j=1, \\dots, n$ 上的和：\n$$\nF_{\\mathrm{QR\\_fact}}(m,n) = \\sum_{j=1}^{n} \\left( 2(m-j+1) + 4(m-j+1)(n-j) + 4(m-j+1) \\right)\n$$\n$$\nF_{\\mathrm{QR\\_fact}}(m,n) = \\sum_{j=1}^{n} \\left( 6(m-j+1) + 4(m-j+1)(n-j) \\right)\n$$\n我们分别计算这两个和。令 $k = j-1$。\n第一个和是 $6 \\sum_{j=1}^{n} (m-j+1) = 6 \\sum_{j=1}^{n} (m+1-j) = 6(n(m+1) - \\frac{n(n+1)}{2}) = 3n(2m+2-n-1) = 3n(2m-n+1)$。\n第二个和是 $4 \\sum_{j=1}^{n} (m-j+1)(n-j) = 4 \\sum_{k=0}^{n-1} (m-k)(n-1-k)$。\n$4 \\sum_{k=0}^{n-1} [m(n-1) - k(m+n-1) + k^2] = 4[m(n-1)n - (m+n-1)\\frac{(n-1)n}{2} + \\frac{(n-1)n(2n-1)}{6}]$。\n提出因子 $4n(n-1)$ 得到 $\\frac{2n(n-1)}{3}[6m - 3(m+n-1) + (2n-1)] = \\frac{2n(n-1)}{3}(3m-n+2)$。\n将两个和相加：\n$F_{\\mathrm{QR\\_fact}}(m,n) = 3n(2m-n+1) + \\frac{2n(n-1)(3m-n+2)}{3}$\n$= \\frac{9n(2m-n+1) + 2n(3mn-3m-n^2+3n-2)}{3}$\n$= \\frac{n}{3} [18m - 9n + 9 + 6mn - 6m - 2n^2 + 6n - 4]$\n$= \\frac{n}{3} (6mn - 2n^2 + 12m - 3n + 5)$。\n在QR分解之后，通过回代求解系统 $Rx = Q^T b$。问题陈述这需要 $n^2$ 次flop。\n因此，基于QR的求解方法的总成本是：\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = F_{\\mathrm{QR\\_fact}}(m,n) + n^2 = \\frac{n}{3} (6mn - 2n^2 + 12m - 3n + 5) + n^2\n$$\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = \\frac{6mn^2 - 2n^3 + 12mn - 3n^2 + 5n + 3n^2}{3} = \\frac{6mn^2 - 2n^3 + 12mn + 5n}{3}\n$$\n$$\nF_{\\mathrm{QR\\_solve}}(m,n) = \\frac{n(6mn - 2n^2 + 12m + 5)}{3}\n$$\n\n第3部分：比率 $R(m,n)$。\n我们被要求计算比率 $R(m,n) = \\frac{F_{\\mathrm{Gram}}(m,n)}{F_{\\mathrm{QR\\_solve}}(m,n)}$。\n$$\nR(m,n) = \\frac{\\frac{n(n+1)(2m-1)}{2}}{\\frac{n(6mn - 2n^2 + 12m + 5)}{3}}\n$$\n假设 $n \\ge 1$，我们可以消去分子和分母中的因子 $n$。\n$$\nR(m,n) = \\frac{3(n+1)(2m-1)}{2(6mn - 2n^2 + 12m + 5)}\n$$\n这就是该比率的简化闭式解析表达式。无法通过因式分解进一步简化，因为分子中的项 $(n+1)$ 不能整除分母括号内的多项式（在 $n=-1$ 处求值得到 $6m+3 \\ne 0$），而项 $(2m-1)$ 也不能（在 $m=1/2$ 处求值得到 $-2n^2+3n+11 \\ne 0$）。",
            "answer": "$$\n\\boxed{\\frac{3(n+1)(2m-1)}{2(6mn - 2n^{2} + 12m + 5)}}\n$$"
        }
    ]
}