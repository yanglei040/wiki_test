{
    "hands_on_practices": [
        {
            "introduction": "这项练习将正交矩阵的代数定义（$Q^\\top Q = I$）与其基本的几何作用（等距变换，即保持长度和角度的变换）联系起来。通过从第一性原理证明这种等价性并用一个具体的 Householder 反射矩阵进行验证 ，您将对这些矩阵为何对数值稳定性至关重要有更深刻的直观理解。",
            "id": "3563113",
            "problem": "设 $\\langle \\cdot,\\cdot \\rangle$ 表示 $\\mathbb{R}^{n}$ 上的标准欧几里得内积，定义为 $\\langle x,y \\rangle \\coloneqq x^{\\top} y$，$x,y \\in \\mathbb{R}^{n}$。考虑一个矩阵 $Q \\in \\mathbb{R}^{n \\times n}$。仅使用欧几里得内积的双线性性、对称性和正定性，以及矩阵转置的定义，从第一性原理推导使等式 $\\langle Qx, Qy \\rangle = \\langle x, y \\rangle$ 对所有 $x,y \\in \\mathbb{R}^{n}$ 成立时 $Q$ 所需满足的充分必要条件。然后，取 $n=3$ 以及由 $Q \\coloneqq I - 2 u u^{\\top}$ 定义的 Householder 反射矩阵 $Q \\in \\mathbb{R}^{3 \\times 3}$（其中 $u \\coloneqq \\frac{1}{\\sqrt{3}}(1,1,1)^{\\top}$），通过一个具体的计算来验证该等式。对于向量 $x \\coloneqq (1,2,3)^{\\top}$ 和 $y \\coloneqq (4,5,6)^{\\top}$，计算标量\n$$\nS \\coloneqq \\langle Qx, Qy \\rangle - \\langle x, y \\rangle.\n$$\n给出 $S$ 的精确值作为最终答案，不要四舍五入。",
            "solution": "首先根据给定标准验证问题。\n\n### 步骤 1：提取已知条件\n- 内积定义：$\\langle \\cdot,\\cdot \\rangle$ 是 $\\mathbb{R}^{n}$ 上的标准欧几里得内积，$\\langle x,y \\rangle \\coloneqq x^{\\top} y$，$x,y \\in \\mathbb{R}^{n}$。\n- 矩阵：$Q \\in \\mathbb{R}^{n \\times n}$。\n- 等式：$\\langle Qx, Qy \\rangle = \\langle x, y \\rangle$ 对所有 $x,y \\in \\mathbb{R}^{n}$ 成立。\n- 任务 1：仅使用内积的双线性性、对称性和正定性，以及矩阵转置的定义，推导使该等式成立时 $Q$ 所需满足的充分必要条件。\n- 任务 2：在一个具体案例中验证该等式：\n    - $n=3$。\n    - Householder 反射矩阵：$Q \\coloneqq I - 2 u u^{\\top}$。\n    - 向量 $u$：$u \\coloneqq \\frac{1}{\\sqrt{3}}(1,1,1)^{\\top}$。\n    - 向量 $x$：$x \\coloneqq (1,2,3)^{\\top}$。\n    - 向量 $y$：$y \\coloneqq (4,5,6)^{\\top}$。\n- 任务 3：计算标量 $S \\coloneqq \\langle Qx, Qy \\rangle - \\langle x, y \\rangle$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是线性代数中的一个标准练习题。\n- **科学性：** 该问题基于线性代数的基本、公认的原理，包括内积、矩阵运算和正交变换。所有定义都是标准和正确的。\n- **适定性：** 问题陈述清晰。它要求进行推导和具体计算，根据所提供的信息，这两者都有唯一且可确定的答案。\n- **客观性：** 问题使用精确的数学语言表述，没有任何模糊性或主观性。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整的解答。\n\n### 第 1 部分：关于 $Q$ 的条件的推导\n\n给定等式 $\\langle Qx, Qy \\rangle = \\langle x, y \\rangle$ 必须对所有向量 $x, y \\in \\mathbb{R}^{n}$ 成立。我们寻求矩阵 $Q$ 的充分必要条件。\n\n使用标准欧几里得内积的定义 $\\langle a, b \\rangle = a^{\\top}b$，我们可以将该等式重写为：\n$$\n(Qx)^{\\top}(Qy) = x^{\\top}y\n$$\n对左侧应用矩阵乘积的转置性质 $(AB)^{\\top} = B^{\\top}A^{\\top}$，得到：\n$$\nx^{\\top}Q^{\\top}Qy = x^{\\top}y\n$$\n此方程必须对所有 $x, y \\in \\mathbb{R}^{n}$ 成立。我们可以将方程重新整理为：\n$$\nx^{\\top}Q^{\\top}Qy - x^{\\top}y = 0\n$$\n使用矩阵乘法的分配律，我们有：\n$$\nx^{\\top}(Q^{\\top}Q - I)y = 0\n$$\n其中 $I$ 是 $n \\times n$ 单位矩阵。我们定义一个矩阵 $A \\coloneqq Q^{\\top}Q - I$。该条件变为对所有 $x, y \\in \\mathbb{R}^{n}$ 都有 $x^{\\top}Ay = 0$。更正式地，使用内积符号，这表示为对所有 $x, y \\in \\mathbb{R}^{n}$ 都有 $\\langle x, Ay \\rangle = 0$。\n\n为了证明这意味着 $A$ 必须是零矩阵，我们可以按如下方式进行。我们固定向量 $y$。条件 $\\langle x, Ay \\rangle = 0$ 必须对所有向量 $x \\in \\mathbb{R}^{n}$ 成立。内积的正定性意味着非退化性：如果对所有 $v$ 都有 $\\langle v, z \\rangle = 0$，那么 $z$ 必须是零向量。在我们的情况下，$x$ 扮演 $v$ 的角色，$Ay$ 扮演 $z$ 的角色。因为对所有 $x$ 都有 $\\langle x, Ay \\rangle = 0$，所以必然有 $Ay = 0$。\n\n这个结果 $Ay = 0$ 必须对 $\\mathbb{R}^{n}$ 中任意选择的 $y$ 都成立。如果一个矩阵与任何向量相乘都得到零向量，那么该矩阵必须是零矩阵。因此，$A=0$。\n\n代回 $A$ 的定义：\n$$\nQ^{\\top}Q - I = 0 \\implies Q^{\\top}Q = I\n$$\n这是 $Q$ 的必要条件。满足此条件的矩阵称为正交矩阵。\n\n为证明充分性，假设 $Q^{\\top}Q = I$。我们必须证明对所有 $x, y \\in \\mathbb{R}^{n}$ 都有 $\\langle Qx, Qy \\rangle = \\langle x, y \\rangle$。\n从左侧开始：\n$$\n\\langle Qx, Qy \\rangle = (Qx)^{\\top}(Qy) = x^{\\top}Q^{\\top}Qy\n$$\n使用我们的假设 $Q^{\\top}Q = I$：\n$$\nx^{\\top}(I)y = x^{\\top}y = \\langle x, y \\rangle\n$$\n这正是等式的右侧。因此，条件 $Q^{\\top}Q=I$ 也是充分的。\n\n充分必要条件是 $Q$ 必须是一个正交矩阵，即 $Q^{\\top}Q = I$。\n\n### 第 2 部分：验证与计算\n\n我们已知 $n=3$，$x = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix}$，$y = \\begin{pmatrix} 4 \\\\ 5 \\\\ 6 \\end{pmatrix}$，以及 $Q = I - 2uu^{\\top}$，其中 $u = \\frac{1}{\\sqrt{3}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}$。我们需要计算 $S = \\langle Qx, Qy \\rangle - \\langle x, y \\rangle$。\n\n首先，我们验证向量 $u$ 是一个单位向量：\n$$\nu^{\\top}u = \\left(\\frac{1}{\\sqrt{3}}(1, 1, 1)\\right) \\left(\\frac{1}{\\sqrt{3}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\\right) = \\frac{1}{3}(1 \\cdot 1 + 1 \\cdot 1 + 1 \\cdot 1) = \\frac{3}{3} = 1\n$$\n由于 $u$ 是一个单位向量，矩阵 $Q$（一个 Householder 反射矩阵）已知是正交的。正如第 1 部分所证明的，对于任何正交矩阵 $Q$，我们必然有 $\\langle Qx, Qy \\rangle = \\langle x, y \\rangle$，这意味着 $S=0$。题目要求通过具体计算来验证这一点。\n\n首先，我们计算 $\\langle x, y \\rangle$：\n$$\n\\langle x, y \\rangle = x^{\\top}y = (1)(4) + (2)(5) + (3)(6) = 4 + 10 + 18 = 32\n$$\n接下来，我们计算 $Qx$ 和 $Qy$。$Q$ 作用于向量 $v$ 的结果由 $Qv = v - 2u(u^{\\top}v)$ 给出。我们首先计算标量积 $u^{\\top}x$ 和 $u^{\\top}y$。\n$$\nu^{\\top}x = \\frac{1}{\\sqrt{3}}(1, 1, 1) \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\frac{1}{\\sqrt{3}}(1+2+3) = \\frac{6}{\\sqrt{3}} = 2\\sqrt{3}\n$$\n$$\nu^{\\top}y = \\frac{1}{\\sqrt{3}}(1, 1, 1) \\begin{pmatrix} 4 \\\\ 5 \\\\ 6 \\end{pmatrix} = \\frac{1}{\\sqrt{3}}(4+5+6) = \\frac{15}{\\sqrt{3}} = 5\\sqrt{3}\n$$\n现在我们可以计算 $Qx$ 和 $Qy$：\n$$\nQx = x - 2u(u^{\\top}x) = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} - 2\\left(\\frac{1}{\\sqrt{3}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\\right)(2\\sqrt{3}) = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} - 4\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1-4 \\\\ 2-4 \\\\ 3-4 \\end{pmatrix} = \\begin{pmatrix} -3 \\\\ -2 \\\\ -1 \\end{pmatrix}\n$$\n$$\nQy = y - 2u(u^{\\top}y) = \\begin{pmatrix} 4 \\\\ 5 \\\\ 6 \\end{pmatrix} - 2\\left(\\frac{1}{\\sqrt{3}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\\right)(5\\sqrt{3}) = \\begin{pmatrix} 4 \\\\ 5 \\\\ 6 \\end{pmatrix} - 10\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 4-10 \\\\ 5-10 \\\\ 6-10 \\end{pmatrix} = \\begin{pmatrix} -6 \\\\ -5 \\\\ -4 \\end{pmatrix}\n$$\n现在我们计算内积 $\\langle Qx, Qy \\rangle$：\n$$\n\\langle Qx, Qy \\rangle = (Qx)^{\\top}(Qy) = (-3)(-6) + (-2)(-5) + (-1)(-4) = 18 + 10 + 4 = 32\n$$\n最后，我们计算标量 $S$：\n$$\nS = \\langle Qx, Qy \\rangle - \\langle x, y \\rangle = 32 - 32 = 0\n$$\n该计算证实了从 $Q$ 的正交性推导出的理论结果。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在理解了正交矩阵的作用之后，这项练习专注于如何为了一个特定目的而构造一个正交矩阵。您将推导出吉文斯旋转 ，这是一个用于选择性地将向量中单个元素置零的工具，也是许多算法（如 QR 分解）的基本构件。",
            "id": "3563118",
            "problem": "设 $n \\geq 2$ 为一个整数，且 $x \\in \\mathbb{R}^{n}$ 是一个实值向量。固定两个不同的指标 $p, q \\in \\{1, \\dots, n\\}$，并记分量 $x_{p} = a$ 和 $x_{q} = b$，假设 $a^{2} + b^{2} \\neq 0$。考虑一个线性变换 $G \\in \\mathbb{R}^{n \\times n}$，它在所有坐标上的作用等同于单位矩阵，但在由标准基向量 $e_{p}$ 和 $e_{q}$ 张成的二维子空间上，它通过 $2 \\times 2$ 的分块矩阵进行作用：\n$$\nR = \\begin{pmatrix}\nc & s \\\\\n-s & c\n\\end{pmatrix}\n$$\n其中 $c$ 和 $s$ 为某些实数参数。仅使用欧几里得内积、欧几里得范数 $\\| \\cdot \\|_{2}$ 以及正交矩阵的定义（即，一个实矩阵 $Q$ 满足 $Q^{\\top} Q = I$），完成以下任务：\n\n1. 推导参数 $c$ 和 $s$ 需要满足的条件，以确保 $G x$ 的第 $q$ 个分量为 $0$，而其第 $p$ 个分量为非负。特别地，推导 $c$ 和 $s$ 必须满足的关于 $a$ 和 $b$ 的方程，使得二维向量 $\\begin{pmatrix} a \\\\ b \\end{pmatrix}$ 被映射到 $\\begin{pmatrix} \\rho \\\\ 0 \\end{pmatrix}$，其中 $\\rho \\geq 0$ 是一个标量，你必须从基本原理出发确定其性质。\n\n2. 根据这些条件，推导出满足 $c^{2} + s^{2} = 1$ 的 $c$ 和 $s$ 的闭式表达式。\n\n3. 证明在你选择的 $c$ 和 $s$ 下，变换 $G$ 是一个正交矩阵，方法是直接验证 $G^{\\top} G = I$。\n\n将你的最终答案表示为一个单一的解析表达式，给出 $c$ 和 $s$ 作为 $a$ 和 $b$ 的函数的闭式形式。答案中不要求进行数值舍入，也不应引入角度。",
            "solution": "该问题陈述是数值线性代数中一个关于构造吉文斯旋转矩阵的适定的标准任务。它包含了所有必要信息，没有矛盾，并且基于已建立的数学原理。因此，我们着手进行详细解答。\n\n变换 $G$ 作用于向量 $x \\in \\mathbb{R}^{n}$ 时，仅改变其第 $p$ 和第 $q$ 个分量。设 $y = Gx$。对于任何指标 $i \\notin \\{p, q\\}$，分量 $y_i$ 等于 $x_i$。分量 $x_p = a$ 和 $x_q = b$ 的变换由以下矩阵向量乘积给出：\n$$\n\\begin{pmatrix} y_p \\\\ y_q \\end{pmatrix} = \\begin{pmatrix} c & s \\\\ -s & c \\end{pmatrix} \\begin{pmatrix} a \\\\ b \\end{pmatrix} = \\begin{pmatrix} ca + sb \\\\ -sa + cb \\end{pmatrix}\n$$\n\n### 第 1 部分：推导条件并确定 $\\rho$\n\n问题对输出向量 $y$ 施加了两个条件：\n1. 第 $q$ 个分量必须为零：$y_q = 0$。\n2. 第 $p$ 个分量必须为非负：$y_p = \\rho \\geq 0$。\n\n将这些条件应用于变换方程，得到关于参数 $c$ 和 $s$ 的一个二元线性方程组：\n$$\n\\begin{align*}\nca + sb = \\rho \\quad (1) \\\\\n-sa + cb = 0 \\quad (2)\n\\end{align*}\n$$\n问题指明矩阵 $G$ 的构造应使其成为正交矩阵，即 $G^{\\top}G = I$。任何正交矩阵的一个性质是它保持欧几里得范数 $\\| \\cdot \\|_2$ 不变。由于变换 $G$ 仅作用于由 $e_p$ 和 $e_q$ 张成的子空间，子矩阵 $R = \\begin{pmatrix} c & s \\\\ -s & c \\end{pmatrix}$ 也必须是正交的，这意味着它保持该子空间中向量的范数不变。因此，输入向量 $\\begin{pmatrix} a \\\\ b \\end{pmatrix}$ 的范数必须等于输出向量 $\\begin{pmatrix} \\rho \\\\ 0 \\end{pmatrix}$ 的范数。\n\n使用欧几里得范数的定义：\n$$\n\\left\\| \\begin{pmatrix} \\rho \\\\ 0 \\end{pmatrix} \\right\\|_2 = \\left\\| \\begin{pmatrix} a \\\\ b \\end{pmatrix} \\right\\|_2\n$$\n$$\n\\sqrt{\\rho^2 + 0^2} = \\sqrt{a^2 + b^2}\n$$\n根据条件 $\\rho \\geq 0$，我们可以得出结论：\n$$\n\\rho = \\sqrt{a^2 + b^2}\n$$\n这就确定了标量 $\\rho$。条件 $a^2 + b^2 \\neq 0$ 确保了 $\\rho > 0$。\n\n### 第 2 部分：推导 $c$ 和 $s$ 的闭式表达式\n\n我们现在有了一个关于 $c$ 和 $s$ 的完整方程组：\n$$\n\\begin{align*}\nca + sb = \\sqrt{a^2 + b^2} \\quad (1') \\\\\n-sa + cb = 0 \\quad (2')\n\\end{align*}\n$$\n我们来解这个方程组。我们可以将其视为关于变量 $c$ 和 $s$ 的线性系统，写作：\n$$\n\\begin{pmatrix} a & b \\\\ b & -a \\end{pmatrix} \\begin{pmatrix} c \\\\ s \\end{pmatrix} = \\begin{pmatrix} \\sqrt{a^2 + b^2} \\\\ 0 \\end{pmatrix}\n$$\n为了求解，我们可以将方程 $(1')$ 乘以 $a$，方程 $(2')$ 乘以 $b$，然后将它们相加：\n$$\na(ca + sb) + b(-sa + cb) = a\\sqrt{a^2 + b^2} + b(0)\n$$\n$$\nc a^2 + sab - sab + c b^2 = a\\sqrt{a^2 + b^2}\n$$\n$$\nc(a^2 + b^2) = a\\sqrt{a^2 + b^2}\n$$\n由于 $\\rho^2 = a^2 + b^2$，我们可以将其写作 $c \\rho^2 = a \\rho$。因为 $\\rho = \\sqrt{a^2 + b^2} \\neq 0$，我们可以两边同除以 $\\rho$：\n$$\nc \\rho = a \\implies c = \\frac{a}{\\rho} = \\frac{a}{\\sqrt{a^2 + b^2}}\n$$\n类似地，为了求解 $s$，我们将方程 $(1')$ 乘以 $b$，方程 $(2')$ 乘以 $a$，然后用前者减去后者：\n$$\nb(ca + sb) - a(-sa + cb) = b\\sqrt{a^2 + b^2} - a(0)\n$$\n$$\ncab + s b^2 + s a^2 - cab = b\\sqrt{a^2 + b^2}\n$$\n$$\ns(a^2 + b^2) = b\\sqrt{a^2 + b^2}\n$$\n这得到 $s \\rho^2 = b \\rho$。两边同除以 $\\rho \\neq 0$：\n$$\ns \\rho = b \\implies s = \\frac{b}{\\rho} = \\frac{b}{\\sqrt{a^2 + b^2}}\n$$\n这些就是 $c$ 和 $s$ 的闭式表达式。我们可以验证它们满足条件 $c^2 + s^2 = 1$：\n$$\nc^2 + s^2 = \\left(\\frac{a}{\\sqrt{a^2 + b^2}}\\right)^2 + \\left(\\frac{b}{\\sqrt{a^2 + b^2}}\\right)^2 = \\frac{a^2}{a^2 + b^2} + \\frac{b^2}{a^2 + b^2} = \\frac{a^2 + b^2}{a^2 + b^2} = 1\n$$\n这证实了子矩阵 $R$ 的正交性，并完成了第二个任务的要求。\n\n### 第 3 部分：证明 $G$ 的正交性\n\n为了证明 $G$ 是一个正交矩阵，我们必须证明 $G^{\\top}G = I$，其中 $I$ 是 $n \\times n$ 的单位矩阵。这等价于证明 $G$ 的列向量构成一个标准正交集。设 $\\{g_1, g_2, \\dots, g_n\\}$ 是 $G$ 的列向量。\n\n矩阵 $G$ 是一个单位矩阵，除了在行 $p$ 和行 $q$ 与列 $p$ 和列 $q$ 的交点处的元素外。$G$ 的列向量定义如下：\n- 对于 $j \\notin \\{p, q\\}$，第 $j$ 列是 $g_j = e_j$。\n- 第 $p$ 列是 $g_p = c e_p - s e_q$。\n- 第 $q$ 列是 $g_q = s e_p + c e_q$。\n\n我们必须验证对于所有的 $i, j \\in \\{1, \\dots, n\\}$，都有 $g_i^{\\top}g_j = \\delta_{ij}$。\n\n情况 1：$i, j \\notin \\{p, q\\}$。\n在这种情况下，$g_i = e_i$ 且 $g_j = e_j$。它们的内积是 $g_i^{\\top}g_j = e_i^{\\top}e_j = \\delta_{ij}$，符合要求。\n\n情况 2：一个指标在 $\\{p, q\\}$ 中，另一个不在。设 $i \\in \\{p, q\\}$ 且 $j \\notin \\{p, q\\}$。\n我们来检验 $g_p^{\\top}g_j$：\n$$\ng_p^{\\top}g_j = (c e_p - s e_q)^{\\top} e_j = c e_p^{\\top}e_j - s e_q^{\\top}e_j = c \\delta_{pj} - s \\delta_{qj}\n$$\n由于 $j \\neq p$ 且 $j \\neq q$，$\\delta_{pj}$ 和 $\\delta_{qj}$ 均为 $0$。因此，$g_p^{\\top}g_j = 0$。\n现在我们来检验 $g_q^{\\top}g_j$：\n$$\ng_q^{\\top}g_j = (s e_p + c e_q)^{\\top} e_j = s e_p^{\\top}e_j + c e_q^{\\top}e_j = s \\delta_{pj} + c \\delta_{qj}\n$$\n同样，两个克罗内克δ符号均为 $0$，所以 $g_q^{\\top}g_j = 0$。根据内积的对称性，这涵盖了所有此类指标对。\n\n情况 3：指标 $i, j$ 都在 $\\{p, q\\}$ 中。\n我们需要检验三个内积：$g_p^{\\top}g_p$、$g_q^{\\top}g_q$ 和 $g_p^{\\top}g_q$。\n- 对于 $g_p^{\\top}g_p$：\n$$\ng_p^{\\top}g_p = (c e_p - s e_q)^{\\top}(c e_p - s e_q) = c^2 e_p^{\\top}e_p - 2cs e_p^{\\top}e_q + s^2 e_q^{\\top}e_q = c^2(1) - 2cs(0) + s^2(1) = c^2 + s^2\n$$\n如第 2 部分所示，根据我们推导出的 $c$ 和 $s$ 的值，我们有 $c^2 + s^2 = 1$。所以，$g_p^{\\top}g_p = 1 = \\delta_{pp}$。\n\n- 对于 $g_q^{\\top}g_q$：\n$$\ng_q^{\\top}g_q = (s e_p + c e_q)^{\\top}(s e_p + c e_q) = s^2 e_p^{\\top}e_p + 2cs e_p^{\\top}e_q + c^2 e_q^{\\top}e_q = s^2(1) + 2cs(0) + c^2(1) = s^2 + c^2 = 1\n$$\n所以，$g_q^{\\top}g_q = 1 = \\delta_{qq}$。\n\n- 对于 $g_p^{\\top}g_q$：\n$$\ng_p^{\\top}g_q = (c e_p - s e_q)^{\\top}(s e_p + c e_q) = cs e_p^{\\top}e_p + c^2 e_p^{\\top}e_q - s^2 e_q^{\\top}e_p - sc e_q^{\\top}e_q = cs(1) + c^2(0) - s^2(0) - sc(1) = cs - sc = 0\n$$\n所以，$g_p^{\\top}g_q = 0 = \\delta_{pq}$（因为 $p \\neq q$）。\n\n所有情况都已检验完毕，我们确认了对于所有 $i, j$，都有 $g_i^{\\top}g_j = \\delta_{ij}$。因此，矩阵 $G$ 是正交的。在第 2 部分推导出的 $c$ 和 $s$ 的表达式即为所求的函数。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{a}{\\sqrt{a^{2} + b^{2}}} & \\frac{b}{\\sqrt{a^{2} + b^{2}}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "这项高级练习要求您实现一个强大的迭代算法——牛顿-舒尔茨迭代，来计算一个矩阵的极分解中的酉因子。这个练习展示了如何通过算法强制实现酉性，并要求您分析收敛性并设计一个稳健的停止准则 ，这些都是任何数值计算程序员的关键技能。",
            "id": "3563064",
            "problem": "实现一个稳定且收敛的算法，使用 Newton–Schulz 迭代法计算复数或实数矩阵的酉极因子，并从第一性原理推导有原则的停止准则。\n\n你将得到一个纯粹以数学术语表述的矩阵极分解问题。对于一个 $m \\ge n$ 且满列秩的矩阵 $A \\in \\mathbb{C}^{m \\times n}$，其极分解为 $A = U H$，其中 $U \\in \\mathbb{C}^{m \\times n}$ 满足 $U^* U = I$，$H \\in \\mathbb{C}^{n \\times n}$ 是厄米特正定矩阵，且 $H = (A^* A)^{1/2}$。目标是通过迭代一个强制列正交性的映射来计算酉极因子 $U$。\n\n从以下基本基础开始：\n- 极分解的定义 $A = U H$，其中 $U^* U = I$ 且 $H = (A^* A)^{1/2}$。\n- Frobenius 范数的定义 $\\|X\\|_F = \\sqrt{\\operatorname{trace}(X^* X)}$ 和谱范数的定义 $\\|X\\|_2 = \\sigma_{\\max}(X)$，其中 $\\sigma_{\\max}(X)$ 表示 $X$ 的最大奇异值。\n- 奇异值分解 (SVD) $A = P \\Sigma Q^*$，其中 $P \\in \\mathbb{C}^{m \\times n}$ 和 $Q \\in \\mathbb{C}^{n \\times n}$ 具有正交列，且 $\\Sigma = \\operatorname{diag}(\\sigma_1,\\dots,\\sigma_n)$，$\\sigma_i \\ge 0$。\n\n使用这些基础，实现 Newton–Schulz 迭代\n$$\nX_{k+1} = \\tfrac{1}{2} X_k \\bigl(3 I - X_k^* X_k\\bigr),\n$$\n使用谱缩放的 $X_0 = A / \\|A\\|_2$ 进行初始化。这种缩放保留了酉极因子，并确保 $X_0$ 的最大奇异值为 $1$，这在满列秩的情况下足以保证收敛。\n\n从第一性原理推导酉性缺陷 $E_k = X_k^* X_k - I$ 的误差递推关系，并展示 $\\|E_{k+1}\\|$ 关于 $\\|E_k\\|$ 的一个可计算上界。然后，仅使用极分解和 SVD 的定义，将 Frobenius 误差 $\\|X_k - U\\|_F$ 与 $X_k$ 的奇异值以及可计算量 $\\|X_k^* X_k - I\\|_F$ 联系起来，并利用这些关系设计一个鲁棒的停止准则，以确保计算出的 $X_k$ 在 Frobenius 范数下与 $U$ 的误差在指定的容差范围内。你的停止准则应依赖于那些可以从 $X_k$ 轻松计算而无需事先知道 $U$ 的量。\n\n程序要求：\n- 使用 $X_0 = A/\\|A\\|_2$ 实现迭代，并在每一步如上所述构建 $X_{k+1}$。\n- 在迭代 $k$ 次时，定义 $E_k = X_k^* X_k - I$ 并计算 $r_k = \\|E_k\\|_F$。使用推导出的递推关系，仅基于 $r_k$ 计算 $r_{k+1}$ 的一个后验界 $\\widehat{r}_{k+1}$。\n- 使用一个鲁棒的停止规则，当 $r_k \\le \\tau$ 和 $\\widehat{r}_{k+1} \\le \\tau$（其中 $\\tau = 10^{-12}$）同时满足时，或者达到最大迭代次数 $1000$ 次时终止。\n- 终止后，通过奇异值分解 $A = P \\Sigma Q^*$ 计算 $A$ 的真实极因子 $U = P Q^*$。报告终止时的 Frobenius 误差 $d_k = \\|X_k - U\\|_F$。\n\n测试套件：\n使用确定性的正交因子构造 $4$ 个满列秩测试矩阵。对于任意正整数 $p$，通过以下条目定义一个确定性的实数 $p \\times p$ 矩阵 $M$：\n$$\nM_{ij} = \\sin\\!\\bigl((i+1)(j+1)\\bigr) + \\cos\\!\\bigl(2(i+1) - (j+1)\\bigr),\n$$\n对于 $0 \\le i,j \\le p-1$，其中 $\\sin(\\cdot)$ 和 $\\cos(\\cdot)$ 是以弧度为单位的标准正弦和余弦函数。令 $Q_R$ 为紧凑实数 QR 分解 $M = Q_R R$ 中的正交因子，其中 $R$ 的对角线元素通过必要时对 $Q_R$ 应用列符号翻转来变为非负。使用 $Q_R$ 作为一个确定性的正交矩阵。对于 $m \\ge n$，定义\n$$\nA = P_{m \\times m}[:,1\\!:\\!n] \\, \\operatorname{diag}(\\sigma_1,\\dots,\\sigma_n) \\, Q_{n \\times n}^T,\n$$\n其中 $P_{m \\times m}$ 和 $Q_{n \\times n}$ 是通过上述 QR 过程独立构造的，$P_{m \\times m}[:,1\\!:\\!n]$ 表示 $P_{m \\times m}$ 的前 $n$ 列。\n\n使用以下 $4$ 个案例：\n- 案例 1：$m = 4$, $n = 4$, $\\sigma = [2.0, 1.2, 0.5, 0.05]$。\n- 案例 2：$m = 6$, $n = 4$, $\\sigma = [3.0, 1.0, 0.3, 0.01]$。\n- 案例 3：$m = 5$, $n = 5$, $\\sigma = [10^6, 10^3, 1.0, 10^{-3}, 10^{-6}]$。\n- 案例 4：$m = 3$, $n = 3$, $\\sigma = [1.0000001, 1.0, 0.9999999]$。\n\n对于每个案例，使用容差 $\\tau = 10^{-12}$ 和最大迭代次数 $1000$ 运行迭代，并生成三元组输出：\n- 终止时的整数迭代次数 $k$。\n- 终止时的浮点数 $r_k = \\|X_k^* X_k - I\\|_F$。\n- 终止时的浮点数 $d_k = \\|X_k - U\\|_F$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序汇总 4 个案例的三元组结果，例如\n$[k_1,r_1,d_1,k_2,r_2,d_2,k_3,r_3,d_3,k_4,r_4,d_4]$。",
            "solution": "计算矩阵的酉极因子是数值线性代中的一个基本任务。给定一个 $m \\ge n$ 且满列秩的矩阵 $A \\in \\mathbb{C}^{m \\times n}$，其唯一的极分解为 $A = U H$，其中 $U \\in \\mathbb{C}^{m \\times n}$ 具有正交列（即 $U^* U = I_n$），$H \\in \\mathbb{C}^{n \\times n}$ 是一个厄米特正定矩阵。矩阵 $H$ 是 $A^* A$ 唯一的正定平方根，即 $H = (A^* A)^{1/2}$。该问题要求实现 Newton-Schulz 迭代来求解 $U$。\n\n指定的迭代公式如下：\n$$\nX_{k+1} = \\frac{1}{2} X_k \\bigl(3 I - X_k^* X_k\\bigr), \\quad k = 0, 1, 2, \\dots\n$$\n这个迭代在收敛时，会找到一个满足 $X^*X=I$ 的矩阵 $X$。为确保收敛到 $A$ 的正确极因子 $U$，初始猜测 $X_0$ 至关重要。选择 $X_0 = A / \\|A\\|_2$ 是标准做法，其中 $\\|A\\|_2$ 是 $A$ 的谱范数（最大奇异值）。这种缩放确保了 $X_0$ 的所有奇异值都在区间 $(0, 1]$ 内，该区间位于对应于酉矩阵的不动点的吸引盆内。\n\n### 误差递推与停止准则的推导\n\n为了设计一个鲁棒的算法，我们首先分析其收敛行为。令第 $k$ 次迭代的酉性缺陷为厄米特矩阵 $E_k = X_k^* X_k - I$。迭代的目标是使 $E_k$ 趋于零矩阵。我们可以推导出 $E_k$ 的一个递推关系。\n\n从 $E_{k+1}$ 的定义开始：\n$$E_{k+1} = X_{k+1}^* X_{k+1} - I$$\n代入 $X_{k+1}$ 的迭代公式：\n$$X_{k+1}^* X_{k+1} = \\left(\\frac{1}{2} X_k (3I - X_k^* X_k)\\right)^* \\left(\\frac{1}{2} X_k (3I - X_k^* X_k)\\right)$$\n$$= \\frac{1}{4} (3I - X_k^* X_k)^* X_k^* X_k (3I - X_k^* X_k)$$\n由于 $X_k^* X_k$ 是厄米特矩阵，所以 $(3I - X_k^* X_k)^* = (3I - X_k^* X_k)$。代入 $X_k^* X_k = I + E_k$：\n$$E_{k+1} + I = \\frac{1}{4} (3I - (I+E_k)) (I+E_k) (3I - (I+E_k))$$\n$$E_{k+1} + I = \\frac{1}{4} (2I - E_k) (I+E_k) (2I - E_k)$$\n$$E_{k+1} + I = \\frac{1}{4} (2I + E_k - E_k^2)(2I - E_k)$$\n$$E_{k+1} + I = \\frac{1}{4} (4I + 2E_k - 2E_k^2 - 2E_k - E_k^2 + E_k^3) = \\frac{1}{4} (4I - 3E_k^2 + E_k^3)$$\n两边减去 $I$ 得到缺陷矩阵的递推关系：\n$$E_{k+1} = \\frac{1}{4} (E_k^3 - 3E_k^2)$$\n当 $\\|E_k\\|$ 很小时，二次项占主导地位，表明误差的范数呈二次方下降，这是牛顿类方法的一个标志。\n\n根据这个递推关系，我们可以推导出下一个误差的 Frobenius 范数 $r_{k+1} = \\|E_{k+1}\\|_F$ 的一个可计算的后验界，用当前误差范数 $r_k = \\|E_k\\|_F$ 表示。使用三角不等式和 Frobenius 范数的次乘性（$\\|AB\\|_F \\le \\|A\\|_F\\|B\\|_F$）：\n$$r_{k+1} = \\|E_{k+1}\\|_F = \\frac{1}{4} \\|E_k^3 - 3E_k^2\\|_F \\le \\frac{1}{4} (\\|E_k^3\\|_F + 3\\|E_k^2\\|_F) \\le \\frac{1}{4} (\\|E_k\\|_F^3 + 3\\|E_k\\|_F^2)$$\n这提供了所要求的可计算界，我们将其表示为 $\\widehat{r}_{k+1}$：\n$$\\widehat{r}_{k+1} = \\frac{1}{4} (r_k^3 + 3r_k^2)$$\n\n接下来，我们将迭代误差 $d_k = \\|X_k - U\\|_F$ 与可计算的残差范数 $r_k$ 联系起来。该迭代保留了初始矩阵的奇异向量。设 $A$ 的奇异值分解 (SVD) 为 $A = P \\Sigma Q^*$。初始迭代值为 $X_0 = (P \\Sigma Q^*) / \\sigma_{\\max}(A) = P (\\Sigma/\\sigma_1) Q^*$。后续迭代值的形式为 $X_k = P S_k Q^*$，其中 $S_k = \\operatorname{diag}(s_1^{(k)}, \\dots, s_n^{(k)})$ 是由 $X_k$ 的奇异值构成的对角矩阵。真正的酉因子是 $U = PQ^*$。\n\n那么误差 $d_k$ 为：\n$$d_k^2 = \\|X_k - U\\|_F^2 = \\|P S_k Q^* - P I Q^*\\|_F^2 = \\|P(S_k - I)Q^*\\|_F^2$$\n由于 Frobenius 范数是酉不变的，这可以简化为：\n$$d_k^2 = \\|S_k - I\\|_F^2 = \\sum_{i=1}^n (s_i^{(k)} - 1)^2$$\n残差范数 $r_k$ 为：\n$$r_k^2 = \\|X_k^* X_k - I\\|_F^2 = \\|(P S_k Q^*)^* (P S_k Q^*) - I\\|_F^2 = \\|Q S_k^2 Q^* - I\\|_F^2 = \\|Q(S_k^2 - I)Q^*\\|_F^2$$\n再次利用酉不变性：\n$$r_k^2 = \\|S_k^2 - I\\|_F^2 = \\sum_{i=1}^n \\left((s_i^{(k)})^2 - 1\\right)^2 = \\sum_{i=1}^n (s_i^{(k)} - 1)^2 (s_i^{(k)} + 1)^2$$\n当 $k \\to \\infty$ 时，迭代确保对所有 $i$ 都有 $s_i^{(k)} \\to 1$。对于接近收敛的迭代值，$s_i^{(k)}+1 \\approx 2$。这建立了一个近似关系 $r_k \\approx 2 d_k$。更严格地说，由于对所有 $k \\ge 0$ 都有 $s_i^{(k)} \\in (0,1]$，我们有 $1  (s_i^{(k)}+1)^2 \\le 4$。这给出了界限：\n$$d_k^2  r_k^2 \\le 4 d_k^2$$\n两边开方可得：\n$$\\frac{r_k}{2} \\le d_k  r_k$$\n这表明 $r_k$ 是真实误差 $d_k$ 的一个可靠且可计算的代理。\n\n指定的停止准则是当 $r_k \\le \\tau$ 和预测界 $\\widehat{r}_{k+1} \\le \\tau$ (对于容差 $\\tau$) 同时满足时终止。这是一个鲁棒的策略。条件 $r_k \\le \\tau$ 确保了当前迭代值的准确性。条件 $\\widehat{r}_{k+1} \\le \\tau$ 确认了迭代已进入快速（二次）收敛区域，防止了过早终止。对于小的 $\\tau$（例如 $\\tau \\le 1$），条件 $r_k \\le \\tau$ 意味着 $\\widehat{r}_{k+1}  r_k \\le \\tau$，因此 $\\widehat{r}_{k+1} \\le \\tau$ 会自动满足。尽管如此，实现双重检查符合问题的鲁棒性要求。\n\n### 算法实现\n\n算法流程如下：\n1.  初始化 $X_0 = A / \\|A\\|_2$。\n2.  对于 $k=0, 1, 2, \\ldots$ 进行迭代，直至达到最大迭代次数：\n    a. 计算当前残差范数 $r_k = \\|X_k^* X_k - I\\|_F$。\n    b. 计算下一个残差范数的后验界 $\\widehat{r}_{k+1} = \\frac{1}{4}(r_k^3 + 3r_k^2)$。\n    c. 如果 $r_k \\le \\tau$ 且 $\\widehat{r}_{k+1} \\le \\tau$，则终止迭代。\n    d. 否则，计算下一个迭代值：$X_{k+1} = \\frac{1}{2} X_k (3I - X_k^* X_k)$。\n3.  在第 $k$ 次迭代终止时，最终迭代值为 $X_k$。然后我们通过原始矩阵 $A = P\\Sigma Q^*$ 的 SVD 计算出真实的极因子 $U=PQ^*$，以计算最终的真实误差 $d_k = \\|X_k - U\\|_F$。\n\n测试案例是通过一个确定性过程生成的，该过程从种子矩阵 $M_{ij} = \\sin((i+1)(j+1)) + \\cos(2(i+1) - (j+1))$ 构造正交矩阵。$M$ 的 QR 分解提供了一个正交因子 $Q_R$，其列符号经过调整以确保规范表示（$R$ 上的对角线元素非负）。这允许以可复现的方式构造具有已知奇异值和奇异向量的测试矩阵 $A = P \\Sigma Q^T$，从而能够精确验证算法的输出。",
            "answer": "```python\nimport numpy as np\n\ndef create_ortho_matrix(p: int) - np.ndarray:\n    \"\"\"\n    Creates a deterministic real orthogonal matrix of size p x p.\n    \"\"\"\n    i, j = np.ogrid[0:p, 0:p]\n    M = np.sin((i + 1) * (j + 1)) + np.cos(2 * (i + 1) - (j + 1))\n    \n    q, r = np.linalg.qr(M)\n    \n    # Ensure R has non-negative diagonal elements for a unique Q\n    signs = np.sign(np.diag(r))\n    signs[signs == 0] = 1.0\n    \n    q_signed = q @ np.diag(signs)\n    return q_signed\n\ndef polar_newton_schulz(A: np.ndarray, tol: float, max_iter: int) - tuple[int, float, float]:\n    \"\"\"\n    Computes the unitary polar factor of a matrix A using Newton-Schulz iteration.\n\n    Args:\n        A (np.ndarray): Input matrix of shape (m, n) with m = n.\n        tol (float): Tolerance for the stopping criterion.\n        max_iter (int): Maximum number of iterations.\n\n    Returns:\n        tuple[int, float, float]: A tuple containing:\n            - k (int): The number of iterations performed.\n            - rk (float): The final residual norm ||Xk*Xk - I||_F.\n            - dk (float): The final error norm ||Xk - U||_F.\n    \"\"\"\n    m, n = A.shape\n    Id_n = np.eye(n, dtype=A.dtype)\n    \n    # Initialize with a spectrally scaled matrix\n    norm_A_2 = np.linalg.norm(A, 2)\n    if norm_A_2 == 0: # Handle zero matrix case\n        return 0, 0.0, np.linalg.norm(np.zeros_like(A) - np.eye(m, n), 'fro') if m==n else np.linalg.norm(np.zeros_like(A),'fro')\n\n    Xk = A / norm_A_2\n    \n    k = 0\n    rk = np.inf\n    while k  max_iter:\n        Xk_H_Xk = Xk.T.conj() @ Xk\n        Ek = Xk_H_Xk - Id_n\n        rk = np.linalg.norm(Ek, 'fro')\n        \n        # A posteriori bound for the next residual norm\n        r_hat_kplus1 = (rk**3 + 3 * rk**2) / 4.0\n        \n        # Check and-robust stopping criterion\n        if rk = tol and r_hat_kplus1 = tol:\n            break\n            \n        # Newton-Schulz update\n        Xk = 0.5 * Xk @ (3 * Id_n - Xk_H_Xk)\n        k += 1\n\n    # If the loop terminated due to max_iter, rk needs to be recomputed for the final Xk\n    if k == max_iter:\n        Xk_H_Xk = Xk.T.conj() @ Xk\n        Ek = Xk_H_Xk - Id_n\n        rk = np.linalg.norm(Ek, 'fro')\n\n    # Compute the true polar factor U via SVD for validation\n    P, _, Qh = np.linalg.svd(A, full_matrices=False)\n    U_true = P @ Qh\n    \n    # Compute the final Frobenius error\n    dk = np.linalg.norm(Xk - U_true, 'fro')\n    \n    return k, rk, dk\n\ndef solve():\n    \"\"\"\n    Sets up test cases, runs the Newton-Schulz iteration, and prints results.\n    \"\"\"\n    test_cases_params = [\n        {'m': 4, 'n': 4, 'sigma': [2.0, 1.2, 0.5, 0.05]},\n        {'m': 6, 'n': 4, 'sigma': [3.0, 1.0, 0.3, 0.01]},\n        {'m': 5, 'n': 5, 'sigma': [10**6, 10**3, 1.0, 10**-3, 10**-6]},\n        {'m': 3, 'n': 3, 'sigma': [1.0000001, 1.0, 0.9999999]},\n    ]\n\n    results = []\n    TOL = 1e-12\n    MAX_ITER = 1000\n\n    for case in test_cases_params:\n        m, n, sigma = case['m'], case['n'], case['sigma']\n        \n        # Construct deterministic orthogonal matrices\n        P_m_full = create_ortho_matrix(m)\n        Q_n_full = create_ortho_matrix(n)\n        \n        # Form the m x n matrix P with orthonormal columns\n        P = P_m_full[:, :n]\n        \n        # Form the diagonal matrix of singular values\n        S = np.diag(sigma)\n        \n        # Construct the test matrix A = P * Sigma * Q^T\n        A = P @ S @ Q_n_full.T\n        \n        # Run the solver\n        k, rk, dk = polar_newton_schulz(A, TOL, MAX_ITER)\n        \n        results.extend([k, rk, dk])\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}