{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基本问题开始，它将矩阵子空间的几何概念与最小二乘问题的核心联系起来。这个练习要求你从第一性原理出发，证明向量 $b$ 到矩阵 $A$ 的值域 $\\mathcal{R}(A)$ 的距离，恰好等于最小二乘问题 $\\min_{x} \\|Ax - b\\|_{2}$ 的最小残差范数。通过具体的计算，你将亲手验证这个关键的等价关系，从而加深对最小二乘解的几何意义的理解 ()。",
            "id": "3571032",
            "problem": "考虑一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 和一个向量 $b \\in \\mathbb{R}^{m}$。$A$ 的像空间，记作 $\\mathcal{R}(A)$，是所有形如 $Ax$ 的向量的集合，其中 $x \\in \\mathbb{R}^{n}$。$A^{\\top}$ 的零空间，记作 $\\mathcal{N}(A^{\\top})$，是所有满足 $A^{\\top} y = 0$ 的向量 $y \\in \\mathbb{R}^{m}$ 的集合。$\\mathbb{R}^{m}$ 上的欧几里得范数记作 $\\|\\cdot\\|_{2}$，标准的欧几里得内积为 $\\langle u, v \\rangle = u^{\\top} v$。\n\n从这些定义以及基本性质——即在欧几里得内积空间 $\\mathbb{R}^{m}$ 中，像空间 $\\mathcal{R}(A)$ 的正交补是零空间 $\\mathcal{N}(A^{\\top})$——出发，请从第一性原理推导，为何 $b$ 到 $\\mathcal{R}(A)$ 的距离等于对 $Ax \\approx b$ 的任意最小二乘解 $x$ 所能达到的最小残差范数。然后，对于具体数据\n$$\nA = \\begin{pmatrix}\n1  0  0 \\\\\n1  1  0 \\\\\n0  1  1 \\\\\n0  0  1\n\\end{pmatrix} \\in \\mathbb{R}^{4 \\times 3}, \\qquad\nb = \\begin{pmatrix}\n2 \\\\\n0 \\\\\n3 \\\\\n-1\n\\end{pmatrix} \\in \\mathbb{R}^{4},\n$$\n使用 $b$ 相对于子空间 $\\mathcal{R}(A)$ 和 $\\mathcal{N}(A^{\\top})$ 的正交分解，计算距离 $\\operatorname{dist}(b,\\mathcal{R}(A))$ 的精确值，并将此量解释为最小残差范数 $\\min_{x \\in \\mathbb{R}^{3}} \\|Ax - b\\|_{2}$。请将最终答案以单个实数形式给出，无需四舍五入。",
            "solution": "首先验证问题，以确保其是适定的、科学上合理的和完整的。\n\n### 步骤 1：提取已知条件\n- 一个实矩阵 $A \\in \\mathbb{R}^{m \\times n}$。\n- 一个向量 $b \\in \\mathbb{R}^{m}$。\n- $A$ 的像空间：$\\mathcal{R}(A) = \\{Ax \\mid x \\in \\mathbb{R}^{n}\\}$。\n- $A^{\\top}$ 的零空间：$\\mathcal{N}(A^{\\top}) = \\{y \\in \\mathbb{R}^{m} \\mid A^{\\top} y = 0\\}$。\n- $\\mathbb{R}^{m}$ 上的欧几里得范数 $\\|\\cdot\\|_{2}$。\n- 标准欧几里得内积 $\\langle u, v \\rangle = u^{\\top} v$。\n- 一个基本性质：$A$ 的像空间的正交补是其转置的零空间，即 $\\mathcal{R}(A)^{\\perp} = \\mathcal{N}(A^{\\top})$。\n- 一个具体矩阵 $A = \\begin{pmatrix} 1  0  0 \\\\ 1  1  0 \\\\ 0  1  1 \\\\ 0  0  1 \\end{pmatrix} \\in \\mathbb{R}^{4 \\times 3}$。\n- 一个具体向量 $b = \\begin{pmatrix} 2 \\\\ 0 \\\\ 3 \\\\ -1 \\end{pmatrix} \\in \\mathbb{R}^{4}$。\n- 任务是首先推导 $b$ 到 $\\mathcal{R}(A)$ 的距离与最小残差范数之间的关系，然后使用正交分解为给定的 $A$ 和 $b$ 计算此距离。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 问题陈述完全基于线性代数的基本、普遍接受的原理，如像空间、零空间、正交补和最小二乘问题的定义。性质 $\\mathcal{R}(A)^{\\perp} = \\mathcal{N}(A^{\\top})$ 是线性代数基本定理的一部分。\n- **适定性：** 问题定义清晰。它要求一个标准的推导，然后用具体的数值数据进行计算。矩阵 $A$ 具有满列秩，确保最小二乘问题有唯一解和定义明确的投影。存在唯一且稳定的解。\n- **客观性：** 问题使用精确、标准的数学语言，不含主观或模糊的陈述。\n- **完整性与一致性：** 所有必要的数据（$A$、$b$）和定义都已提供。前提条件相互之间以及与标准线性代数理论一致。\n\n### 步骤 3：结论与行动\n问题是**有效的**。这是一个数值线性代数中的标准、适定问题，用于检验基本概念。我们可以继续求解。\n\n### 推导\n从向量 $b \\in \\mathbb{R}^{m}$ 到子空间 $\\mathcal{S} \\subseteq \\mathbb{R}^{m}$ 的距离定义为 $b$ 与 $\\mathcal{S}$ 中任意向量之间可能的最小距离。数学上，\n$$\n\\operatorname{dist}(b, \\mathcal{S}) = \\min_{v \\in \\mathcal{S}} \\|b - v\\|_{2}\n$$\n在此问题中，子空间是 $A$ 的像空间，$\\mathcal{S} = \\mathcal{R}(A)$。根据定义，$\\mathcal{R}(A)$ 中的任何向量 $v$ 都可以表示为 $v = Ax$，其中 $x$ 是某个向量 $x \\in \\mathbb{R}^{n}$。将此代入距离定义可得：\n$$\n\\operatorname{dist}(b, \\mathcal{R}(A)) = \\min_{x \\in \\mathbb{R}^{n}} \\|b - Ax\\|_{2} = \\min_{x \\in \\mathbb{R}^{n}} \\|Ax - b\\|_{2}\n$$\n这个表达式正是线性最小二乘问题 $Ax \\approx b$ 的最小残差范数的定义。这就从第一性原理证明了 $b$ 到 $A$ 的像空间的距离与可实现的最小残差范数之间的等价关系。\n\n在 $\\mathcal{R}(A)$ 中实现这个最小距離的向量是 $b$ 在 $\\mathcal{R}(A)$ 上的正交投影。我们记此投影为 $p = \\operatorname{proj}_{\\mathcal{R}(A)} b$。因此，$p \\in \\mathcal{R}(A)$。代表距离的向量是残差向量 $r = b - p$。\n\n根据正交投影的性质，残差向量 $r$ 与子空间 $\\mathcal{R}(A)$ 正交。这意味着 $r$ 属于 $\\mathcal{R}(A)$ 的正交补，写作 $r \\in \\mathcal{R}(A)^{\\perp}$。问题陈述了基本性质 $\\mathcal{R}(A)^{\\perp} = \\mathcal{N}(A^{\\top})$。因此，残差向量 $r$ 必须位于 $A^{\\top}$ 的零空间中，即 $r \\in \\mathcal{N}(A^{\\top})$。\n\n这就导出了向量 $b$ 的正交分解。任何向量 $b \\in \\mathbb{R}^{m}$ 都可以唯一地写成一个在 $\\mathcal{R}(A)$ 中的分量和一个在其正交补 $\\mathcal{N}(A^{\\top})$ 中的分量之和：\n$$\nb = p + r\n$$\n其中 $p \\in \\mathcal{R}(A)$ 且 $r \\in \\mathcal{N}(A^{\\top})$。向量 $r$ 是 $b$ 在子空间 $\\mathcal{N}(A^{\\top})$ 上的正交投影。我们寻求的距离是这个分量的模长：\n$$\n\\operatorname{dist}(b, \\mathcal{R}(A)) = \\|b-p\\|_{2} = \\|r\\|_{2}\n$$\n\n### 计算\n为了求出给定数据的距离，我们将计算 $b$ 在 $\\mathcal{N}(A^{\\top})$ 上的投影的范数。\n\n首先，我们刻画零空间 $\\mathcal{N}(A^{\\top})$。给定的矩阵 $A$ 为：\n$$\nA = \\begin{pmatrix}\n1  0  0 \\\\\n1  1  0 \\\\\n0  1  1 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n其转置 $A^{\\top}$ 为：\n$$\nA^{\\top} = \\begin{pmatrix}\n1  1  0  0 \\\\\n0  1  1  0 \\\\\n0  0  1  1\n\\end{pmatrix}\n$$\n为求 $\\mathcal{N}(A^{\\top})$，我们求解齐次方程组 $A^{\\top}y = 0$，其中 $y = (y_1, y_2, y_3, y_4)^{\\top} \\in \\mathbb{R}^{4}$：\n$$\n\\begin{pmatrix}\n1  1  0  0 \\\\\n0  1  1  0 \\\\\n0  0  1  1\n\\end{pmatrix}\n\\begin{pmatrix}\ny_1 \\\\ y_2 \\\\ y_3 \\\\ y_4\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\ 0 \\\\ 0\n\\end{pmatrix}\n$$\n这得到以下线性方程组：\n1. $y_1 + y_2 = 0$\n2. $y_2 + y_3 = 0$\n3. $y_3 + y_4 = 0$\n\n由方程(3)得，$y_3 = -y_4$。\n代入方程(2)得，$y_2 + (-y_4) = 0$，所以 $y_2 = y_4$。\n代入方程(1)得，$y_1 + y_2 = 0$，所以 $y_1 = -y_2 = -y_4$。\n令 $y_4 = c$ 为自由参数，任何向量 $y \\in \\mathcal{N}(A^{\\top})$ 都具有以下形式：\n$$\ny = \\begin{pmatrix} -c \\\\ c \\\\ -c \\\\ c \\end{pmatrix} = c \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\end{pmatrix}\n$$\n因此，$\\mathcal{N}(A^{\\top})$ 是 $\\mathbb{R}^{4}$ 的一个一维子空间，由基向量 $u = \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\end{pmatrix}$ 生成。\n\n残差向量 $r$ 是 $b$ 在由 $u$ 生成的子空间上的正交投影。该投影的公式为：\n$$\nr = \\operatorname{proj}_{u} b = \\frac{\\langle b, u \\rangle}{\\langle u, u \\rangle} u\n$$\n给定 $b = \\begin{pmatrix} 2 \\\\ 0 \\\\ 3 \\\\ -1 \\end{pmatrix}$。我们计算所需的内积：\n$$\n\\langle b, u \\rangle = b^{\\top} u = (2)(-1) + (0)(1) + (3)(-1) + (-1)(1) = -2 + 0 - 3 - 1 = -6\n$$\n$$\n\\langle u, u \\rangle = u^{\\top} u = (-1)^2 + (1)^2 + (-1)^2 + (1)^2 = 1 + 1 + 1 + 1 = 4\n$$\n代入这些值，我们得到投影 $r$：\n$$\nr = \\frac{-6}{4} u = -\\frac{3}{2} \\begin{pmatrix} -1 \\\\ 1 \\\\ -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 3/2 \\\\ -3/2 \\\\ 3/2 \\\\ -3/2 \\end{pmatrix}\n$$\n距离是该向量 $r$ 的欧几里得范数：\n$$\n\\operatorname{dist}(b, \\mathcal{R}(A)) = \\|r\\|_{2} = \\left\\| \\begin{pmatrix} 3/2 \\\\ -3/2 \\\\ 3/2 \\\\ -3/2 \\end{pmatrix} \\right\\|_{2}\n$$\n$$\n\\|r\\|_{2} = \\sqrt{\\left(\\frac{3}{2}\\right)^2 + \\left(-\\frac{3}{2}\\right)^2 + \\left(\\frac{3}{2}\\right)^2 + \\left(-\\frac{3}{2}\\right)^2} = \\sqrt{4 \\times \\frac{9}{4}} = \\sqrt{9} = 3\n$$\n这个距离 $3$ 就是 $\\min_{x \\in \\mathbb{R}^{3}} \\|Ax - b\\|_{2}$ 的精确值，它表示用 $A$ 的列空间中的向量来近似 $b$ 时可能达到的最小误差。\n$b$ 在 $\\mathcal{R}(A)$ 中的分量是 $p = b - r = \\begin{pmatrix} 2 \\\\ 0 \\\\ 3 \\\\ -1 \\end{pmatrix} - \\begin{pmatrix} 3/2 \\\\ -3/2 \\\\ 3/2 \\\\ -3/2 \\end{pmatrix} = \\begin{pmatrix} 1/2 \\\\ 3/2 \\\\ 3/2 \\\\ 1/2 \\end{pmatrix}$。可以验证 $p$ 和 $r$ 是正交的，因为 $\\langle p, r \\rangle = 0$。\n\n最终答案是计算出的距离。",
            "answer": "$$\n\\boxed{3}\n$$"
        },
        {
            "introduction": "理论上的子空间在有限精度计算中面临着微妙的挑战，尤其是在处理接近奇异的矩阵时。本练习将引导你构造并分析一些具有病态近相关性的稀疏矩阵，以检验数值算法识别数值秩和零空间的能力 ()。通过比较带列主元和不带列主元的 QR 分解，你将深入体会到为何像秩揭示 QR (RRQR) 这样的稳健分解对于可靠地划分值域和零空间至关重要。",
            "id": "3571098",
            "problem": "设 $A \\in \\mathbb{R}^{m \\times n}$ 是一个实矩阵。值域 $\\mathcal{R}(A)$ 是所有可以写成 $y = A x$（其中 $x \\in \\mathbb{R}^n$）的向量 $y \\in \\mathbb{R}^m$ 的集合。零空间 $\\mathcal{N}(A)$ 是所有满足 $A x = 0$ 的向量 $x \\in \\mathbb{R}^n$ 的集合。左零空间 $\\mathcal{N}(A^\\top)$ 是所有满足 $A^\\top y = 0$ 的向量 $y \\in \\mathbb{R}^m$ 的集合。一个基本恒等式是 $\\mathcal{R}(A) = \\left( \\mathcal{N}(A^\\top) \\right)^\\perp$，即 $A$ 的值域是 $A$ 的左零空间的正交补。数值方法通过利用因式分解产生的正交性和三角结构来近似确定这些子空间。\n\n带列主元的秩揭示QR（RRQR）分解寻找一个排列矩阵 $P \\in \\mathbb{R}^{n \\times n}$、一个正交矩阵 $Q \\in \\mathbb{R}^{m \\times m}$ 和一个上三角矩阵 $R \\in \\mathbb{R}^{m \\times n}$，使得 $A P = Q R$。当数值秩 $k$ 严格小于 $\\min(m,n)$ 时，$R$ 可以分块为\n$$\nR = \\begin{bmatrix}\nR_{11}  R_{12} \\\\\n0  R_{22}\n\\end{bmatrix},\n$$\n其中 $R_{11} \\in \\mathbb{R}^{k \\times k}$ 是良态的，而 $R_{22} \\in \\mathbb{R}^{(m-k) \\times (n-k)}$ 在数值上很小。在 $R_{22} = 0$ 的精确算术中，$\\mathcal{N}(A)$ 在列置换坐标下的一组显式基由下式给出\n$$\nZ_{\\mathrm{perm}} = \\begin{bmatrix}\n- R_{11}^{-1} R_{12} \\\\\nI_{n-k}\n\\end{bmatrix} \\in \\mathbb{R}^{n \\times (n-k)},\n$$\n而在原始坐标下的基为 $Z = P Z_{\\mathrm{perm}}$。这个构造直接源于基本定义：任何右零向量 $z$ 满足 $A z = 0$，因此 $(A P) (P^\\top z) = 0$，并且上三角结构允许通过分块回代来参数化 $P^\\top z$。\n\n您需要实现一个程序，构造具有病态近相关的稀疏矩阵，以压力测试RRQR辨别零空间 $\\mathcal{N}(A)$ 的能力，并分析主元策略如何影响列向量到值域 $\\mathcal{R}(A)$ 与左零空间 $\\mathcal{N}(A^\\top)$ 的映射。分析必须从核心定义出发，并且只利用经过充分检验的数值事实，特别是正交三角分解和机器精度缩放。不允许使用超出这些基础的任何捷径公式。\n\n算法和数值要求：\n\n- 使用标准基向量 $\\{e_i\\}_{i=1}^m \\subset \\mathbb{R}^m$ 和 $\\{e_j\\}_{j=1}^n \\subset \\mathbb{R}^n$ 来构造三个稀疏测试矩阵。每列最多必须有两个非零元，以产生类似于 Kahan 风格示例但具有显式稀疏性的近相关性。\n- 通过将 $R$ 的对角线元素与一个阈值进行比较，使用带列主元的RRQR来确定数值秩 $k$\n$$\n\\tau = \\max(m,n) \\, \\varepsilon \\, \\|A\\|_1,\n$$\n其中 $\\varepsilon$ 是双精度浮点数的机器 epsilon，$\\|\\cdot\\|_1$ 表示与向量 $1$-范数一致的诱导矩阵范数。数值秩是绝对值 $|R_{ii}|$ 超过 $\\tau$ 的对角线元素的数量。\n- 使用上述的分块三角参数化方法，从RRQR构造 $\\mathcal{N}(A)$ 的一个近似基。使用RRQR返回的列置换对基进行反置换。\n- 通过最大残差范数来量化计算出的零空间基的质量\n$$\nr_{\\max} = \\max_{\\ell} \\|A z_\\ell\\|_2,\n$$\n其中 $\\{z_\\ell\\}$ 是计算出的基向量，并已归一化为单位 $2$-范数。较小的 $r_{\\max}$ 表示对 $\\mathcal{N}(A)$ 的识别更可靠。\n- 通过同时计算不带列主元（标准QR）的数值秩来比较主元策略。报告秩如何变化，以及RRQR下 $R_{11}$ 的条件数如何反映值域基的数值稳定性。$2$-范数条件数为\n$$\n\\kappa(R_{11}) = \\frac{\\sigma_{\\max}(R_{11})}{\\sigma_{\\min}(R_{11})},\n$$\n其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是最大和最小奇异值。\n\n测试套件规范：\n\n- 测试用例1（具有稀疏“尖峰”结构的近共线性）：设 $m = 8$, $n = 6$，并定义列\n$$\nc_1 = e_1, \\quad c_j = e_1 + \\epsilon \\, e_j \\text{ for } j = 2,3,4,5,6,\n$$\n其中 $\\epsilon = 10^{-8}$。这是稀疏的，每列最多有两个非零元，并且由于所有列都共享 $e_1$，因此表现出近相关性。\n- 测试用例2（精确重复与近似重复）：设 $m = 8$, $n = 6$，并定义\n$$\nc_1 = e_1, \\quad c_2 = e_1, \\quad c_3 = e_1 + 10^{-12} e_2, \\quad c_4 = e_3, \\quad c_5 = e_4, \\quad c_6 = e_5.\n$$\n这包括一个精确的重复列（$c_1 = c_2$），以强制至少存在一维零空间，以及一个近似重复的列。\n- 测试用例3（列多于行，带环绕的带状链）：设 $m = 5$, $n = 8$，并为 $j = 1,\\dots,8$ 定义\n$$\nr = 1 + ((j-1) \\bmod 5), \\quad r_{\\mathrm{prev}} = 1 + ((r-2) \\bmod 5),\n$$\n和\n$$\nc_j = e_r + \\tau \\, e_{r_{\\mathrm{prev}}},\n$$\n其中 $\\tau = 10^{-6}$。这将产生一个稀疏、带状、近相关的结构，且 $n > m$。\n\n对于每个测试用例，您的程序必须计算并返回一个列表，该列表按顺序包含以下五个量：\n\n1. $k_{\\mathrm{piv}}$：通过带列主元的RRQR找到的数值秩（整数）。\n2. $k_{\\mathrm{nopiv}}$：通过不带主元的QR找到的数值秩（整数）。\n3. $d_{\\mathcal{N}}$：通过RRQR得到的右零空间的维数，等于 $n - k_{\\mathrm{piv}}$（整数）。\n4. $r_{\\max}$：从RRQR构造的单位范数零空间基向量上的最大残差范数（浮点数）。\n5. $\\kappa(R_{11})$：RRQR中前导 $R_{11}$ 块的 $2$-范数条件数（浮点数；如果 $k_{\\mathrm{piv}} = 0$，则报告 $0.0$；如果 $k_{\\mathrm{piv}} = 1$，则报告 $\\kappa$ 为 $1.0$）。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须按上述顺序显示为一个子列表。例如，输出应如下所示\n$$\n[ [k_{\\mathrm{piv}}^{(1)}, k_{\\mathrm{nopiv}}^{(1)}, d_{\\mathcal{N}}^{(1)}, r_{\\max}^{(1)}, \\kappa(R_{11})^{(1)}], [k_{\\mathrm{piv}}^{(2)}, \\dots], [k_{\\mathrm{piv}}^{(3)}, \\dots] ].\n$$\n不允许外部输入；所有矩阵和参数必须在程序内部构造。不涉及物理单位或角度单位，也不需要百分比；所有输出必须是如上指定的数值。",
            "solution": "该问题要求实现和分析秩揭示QR（RRQR）分解，以确定三个特别构造的稀疏矩阵的数值秩和零空间。该分析将比较带列主元的QR分解与不带主元的标准QR分解的结果。任务的核心涉及数值秩估计、零空间基的构造以及计算出的子空间的质量评估。\n\n此问题的理论基础在于矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的四个基本子空间的性质及其通过正交三角分解的计算。RRQR分解 $A P = Q R$ 提供了一种数值稳定的方法，可将 $A$ 的列空间分离为一个用于值域 $\\mathcal{R}(A)$ 的良态基和一个用于零空间 $\\mathcal{N}(A)$ 的基。这里，$P$ 是一个排列矩阵，$Q$ 是一个正交矩阵，$R$ 是一个上三角矩阵。\n\n流程如下：\n\n**1. 矩阵构造**\n对于每个测试用例，按规定构造矩阵 $A$。使用标准基向量 $e_i \\in \\mathbb{R}^m$ 或 $e_j \\in \\mathbb{R}^n$，其定义为在第 $i$（或第 $j$）个位置为 $1$ 而其他位置为零的向量。\n\n- **测试用例1：** $A \\in \\mathbb{R}^{8 \\times 6}$，其列为 $c_1 = e_1$ 和 $c_j = e_1 + \\epsilon \\, e_j$（对于 $j \\in \\{2, 3, 4, 5, 6\\}$），其中 $\\epsilon = 10^{-8}$。这些列是线性无关的，但对于小的 $\\epsilon$，它们几乎是共线的，使得矩阵几乎是秩亏的。\n- **测试用例2：** $A \\in \\mathbb{R}^{8 \\times 6}$，其列为 $c_1 = e_1$, $c_2 = e_1$, $c_3 = e_1 + 10^{-12} e_2$, $c_4 = e_3$, $c_5 = e_4$ 和 $c_6 = e_5$。该矩阵有一个精确的重复列（$c_1=c_2$），保证秩最多为 $n-1=5$，还有一个涉及 $c_3$ 的近似重复。\n- **测试用例3：** $A \\in \\mathbb{R}^{5 \\times 8}$，其列为 $c_j = e_r + \\tau' \\, e_{r_{\\mathrm{prev}}}$（对于 $j \\in \\{1, \\dots, 8\\}$），其中 $r = 1 + ((j-1) \\bmod 5)$，$r_{\\mathrm{prev}} = 1 + ((r-2) \\bmod 5)$，参数 $\\tau' = 10^{-6}$。由于列数 $n=8$ 大于行数 $m=5$，秩最多为 $5$，零空间维数至少为 $n-m=3$。此构造导致了重复列，特别是 $c_1=c_6$、$c_2=c_7$ 和 $c_3=c_8$。\n\n**2. 数值秩确定**\n数值秩 $k$ 是通过检查QR分解得到的因子 $R$ 的对角线元素来确定的。建立一个容差 $\\tau$ 为\n$$\n\\tau = \\max(m,n) \\, \\varepsilon \\, \\|A\\|_1,\n$$\n其中 $\\varepsilon$ 是双精度机器 epsilon，$\\|A\\|_1$ 是矩阵 $A$ 的诱导 $1$-范数。数值秩 $k$ 是满足 $|R_{ii}| > \\tau$ 的对角线元素 $R_{ii}$ 的数量。此计算对标准QR（$A=QR$，得出 $k_{\\mathrm{nopiv}}$）和带列主元的秩揭示QR（$AP=QR$，得出 $k_{\\mathrm{piv}}$）都进行。\n\n**3. 零空间基的构造**\n对于RRQR分解 $A P = Q R$，矩阵 $R$ 根据数值秩 $k=k_{\\mathrm{piv}}$进行分块：\n$$\nR = \\begin{bmatrix} R_{11}  R_{12} \\\\ 0  R_{22} \\end{bmatrix},\n$$\n其中 $R_{11} \\in \\mathbb{R}^{k \\times k}$ 且 $R_{22} \\in \\mathbb{R}^{(m-k) \\times (n-k)}$ 的元素被认为是可忽略的（即，其绝对值小于或等于 $\\tau$）。通过求解 $A z = 0$ 来找到 $A$ 的零空间。利用该分解，这等价于 $Q R P^\\top z = 0$。由于 $Q$ 是正交的，我们求解 $R (P^\\top z) = 0$。令 $z' = P^\\top z$。我们将 $z'$ 分块为 $z' = \\begin{bmatrix} z'_1 \\\\ z'_2 \\end{bmatrix}$，其中 $z'_1 \\in \\mathbb{R}^k$ 且 $z'_2 \\in \\mathbb{R}^{n-k}$。方程变为：\n$$\nR_{11} z'_1 + R_{12} z'_2 = 0.\n$$\n我们可以用自由参数 $z'_2$ 来表示 $z'_1$：$z'_1 = -R_{11}^{-1} R_{12} z'_2$。通过将 $z'_2$ 设置为单位矩阵 $I_{n-k} \\in \\mathbb{R}^{(n-k) \\times (n-k)}$ 的列，可以构成所有这类向量 $z'$ 所在空间的一组基。这给出了 $A P$ 在置换坐标下的零空间的一组基：\n$$\nZ_{\\mathrm{perm}} = \\begin{bmatrix}\n-R_{11}^{-1} R_{12} \\\\\nI_{n-k}\n\\end{bmatrix} \\in \\mathbb{R}^{n \\times (n-k)}.\n$$\n零空间的维数为 $d_{\\mathcal{N}} = n - k_{\\mathrm{piv}}$。如果 $d_{\\mathcal{N}} = 0$，则零空间是平凡的，基为空。如果 $k_{\\mathrm{piv}} = 0$，则整个空间都是零空间，并且 $Z_{\\mathrm{perm}} = I_n$。\n\n为了获得原始矩阵 $A$ 的零空间基 $Z$，我们必须反转置换：$z = P z'$。此操作应用于基矩阵：$Z = P Z_{\\mathrm{perm}}$。如果置换由索引向量 `p` 给出，使得 `A[:, p]` 被分解，则反置换操作对应于 `Z = Z_perm[inv_p, :]`，其中 `inv_p` 是 `p` 的逆置换。\n\n**4. 质量和稳定性度量**\n- **零空间残差：** 计算出的零空间基 $Z = [z_1 | \\dots | z_{d_{\\mathcal{N}}}]$ 的质量由最大2-范数残差衡量：\n$$\nr_{\\max} = \\max_{\\ell=1, \\dots, d_{\\mathcal{N}}} \\|A \\frac{z_\\ell}{\\|z_\\ell\\|_2}\\|_2.\n$$\n- **条件数：** 值域基的数值稳定性通过RRQR分解得到的 $R_{11}$ 块的2-范数条件数来评估：\n$$\n\\kappa(R_{11}) = \\frac{\\sigma_{\\max}(R_{11})}{\\sigma_{\\min}(R_{11})}.\n$$\n如果 $k_{\\mathrm{piv}} = 0$，我们定义 $\\kappa(R_{11})=0.0$。如果 $k_{\\mathrm{piv}} = 1$，则 $\\kappa(R_{11})=1.0$。\n\n实现将使用 `scipy.linalg.qr` 进行分解，`numpy.linalg.norm` 计算范数，`scipy.linalg.solve` 求解线性系统，以及 `scipy.linalg.svd` 计算奇异值以求得条件数。",
            "answer": "$$\n[[6, 6, 0, 0.0, 244948974.278318], [5, 5, 1, 2.220446e-16, 2.236068], [5, 5, 3, 2.302300e-09, 2.618034]]\n$$"
        },
        {
            "introduction": "在理解了如何从几何和数值上识别模型无法解释的数据分量后，我们进而探讨一个更具实践性的问题：如何处理这种不一致性？本练习  设计了一个数值实验，让你对比两种核心建模策略。你将通过代码实现，探索当数据向量 $b$ 包含一个显著的正交于模型值域 $\\mathcal{R}(A)$ 的分量时，Tikhonov 正则化和模型增广这两种方法如何影响解和残差。",
            "id": "3571067",
            "problem": "给定矩阵和向量，要求您设计一个数值过程，从基本定义出发，将一个向量分解为相对于一个矩阵的值域及其正交补的分量，量化其正交分量，并比较两种建模策略：通过正则化抑制正交分量的影响，以及通过模型增广扩展矩阵的值域。所有量均为实值。\n\n基本基础：\n- 对于实矩阵 $A \\in \\mathbb{R}^{m \\times n}$，其值域（也称为列空间）$\\mathcal{R}(A) \\subseteq \\mathbb{R}^{m}$ 是所有可以表示为 $A x$（对于某个 $x \\in \\mathbb{R}^{n}$）的向量集合。\n- 转置的零空间 $\\mathcal{N}(A^{\\top}) \\subseteq \\mathbb{R}^{m}$ 由所有满足 $A^{\\top} y = 0$ 的向量 $y \\in \\mathbb{R}^{m}$ 组成。\n- 一个经过充分检验的事实是，$\\mathcal{R}(A)$ 和 $\\mathcal{N}(A^{\\top})$ 在 $\\mathbb{R}^{m}$ 中互为正交补，因此每个 $b \\in \\mathbb{R}^{m}$ 都允许唯一的正交分解 $b = b_{\\mathcal{R}(A)} + b_{\\perp}$，其中 $b_{\\mathcal{R}(A)} \\in \\mathcal{R}(A)$ 且 $b_{\\perp} \\in \\mathcal{N}(A^{\\top})$。\n- 奇异值分解（SVD）是一个经过充分检验的数值工具，它能为 $\\mathcal{R}(A)$ 和 $\\mathcal{N}(A^{\\top})$ 生成标准正交基，并适用于稳定的数值计算。\n\n任务：\n对于下面的每个测试案例 $(A,b)$，使用数值稳定的线性代数方法实现以下步骤：\n1. 基于SVD信息的数值秩决策，计算正交分解 $b = b_{\\mathcal{R}(A)} + b_{\\perp}$。使用容差 $\\tau = \\max(m,n)\\,\\epsilon\\,\\sigma_{\\max}$，其中 $\\epsilon$ 是双精度浮点数的机器精度，$\\sigma_{\\max}$ 是 $A$ 的最大奇异值。数值秩是严格大于 $\\tau$ 的奇异值的数量。\n2. 报告欧几里得范数 $\\lVert b_{\\perp} \\rVert_{2}$。\n3. 计算正则化参数为 $\\lambda = 10^{-2}$ 的最小化问题 $\\lVert A x - b \\rVert_{2}^{2} + \\lambda^{2} \\lVert x \\rVert_{2}^{2}$ 的吉洪诺夫正则化最小二乘解 $x_{\\lambda}$。然后报告相应数据残差的欧几里得范数 $\\lVert A x_{\\lambda} - b \\rVert_{2}$。\n4. 构建模型增广矩阵 $A_{\\mathrm{aug}} = [A \\ \\ U_{\\perp}]$，其中 $U_{\\perp}$ 的列构成 $\\mathcal{N}(A^{\\top})$ 的一个标准正交基（如果 $\\mathcal{N}(A^{\\top}) = \\{0\\}$，则可能为空）。求解 $A_{\\mathrm{aug}}$ 相对于 $b$ 的最小二乘问题的最小欧几里得范数解，并报告该解的数据残差的欧几里得范数 $\\lVert A_{\\mathrm{aug}} y - b \\rVert_{2}$。同时报告一个布尔值，指示增广是否严格增大了值域，即 $\\dim \\mathcal{N}(A^{\\top}) > 0$ 是否成立。\n5. 报告一个布尔值，指示 $b$ 是否与 $A$ 在数值上相容，即 $\\lVert b_{\\perp} \\rVert_{2} \\leq 10^{-10}$ 是否成立。\n\n数值要求：\n- 所有计算必须以双精度进行。\n- 对于吉洪诺夫步骤，使用与奇异值分解和正交变换一致的数值稳定方法；不要通过显式构造 $A^{\\top} A$ 来求解正规方程。\n- 对于模型增广步骤，从SVD中获取 $U_{\\perp}$，并对 $A_{\\mathrm{aug}}$ 使用基于伪逆的最小欧几里得范数解。\n- 所有报告的浮点值必须四舍五入到六位小数。\n\n测试套件：\n使用以下四个测试案例。每个矩阵 $A$ 和向量 $b$ 都被明确给出。\n\n- 案例 1 ($m=5$, $n=3$):\n  $$\n  A_{1} =\n  \\begin{bmatrix}\n  0.70710678  0.70710678  0.0 \\\\\n  0.70710678  -0.70710678  0.0 \\\\\n  0.0  0.0  1.0 \\\\\n  0.0  0.0  0.0 \\\\\n  0.0  0.0  0.0\n  \\end{bmatrix}, \\quad\n  b_{1} =\n  \\begin{bmatrix}\n  -0.70710678 \\\\\n  2.12132034 \\\\\n  0.5 \\\\\n  0.0 \\\\\n  0.0\n  \\end{bmatrix}.\n  $$\n- 案例 2 ($m=5$, $n=3$):\n  $$\n  A_{2} = A_{1}, \\quad\n  b_{2} =\n  \\begin{bmatrix}\n  -0.70710678 \\\\\n  2.12132034 \\\\\n  0.5 \\\\\n  0.3 \\\\\n  -0.4\n  \\end{bmatrix}.\n  $$\n- 案例 3 ($m=5$, $n=3$):\n  $$\n  A_{3} =\n  \\begin{bmatrix}\n  1.0  0.0  0.0 \\\\\n  0.0  0.001  0.0 \\\\\n  0.0  0.0  0.000001 \\\\\n  0.0  0.0  0.0 \\\\\n  0.0  0.0  0.0\n  \\end{bmatrix}, \\quad\n  b_{3} =\n  \\begin{bmatrix}\n  1.0 \\\\\n  0.001 \\\\\n  0.000001 \\\\\n  0.2 \\\\\n  -0.2\n  \\endbmatrix}.\n  $$\n- 案例 4 ($m=3$, $n=3$):\n  $$\n  A_{4} =\n  \\begin{bmatrix}\n  2.0  0.0  0.0 \\\\\n  0.0  3.0  0.0 \\\\\n  0.0  0.0  4.0\n  \\end{bmatrix}, \\quad\n  b_{4} =\n  \\begin{bmatrix}\n  1.0 \\\\\n  2.0 \\\\\n  3.5\n  \\end{bmatrix}.\n  $$\n\n答案规范：\n- 对于每个案例，生成一个形式为 $[\\lVert b_{\\perp} \\rVert_{2}, \\ \\lVert A x_{\\lambda} - b \\rVert_{2}, \\ \\lVert A_{\\mathrm{aug}} y - b \\rVert_{2}, \\ \\text{aug\\_increases\\_range}, \\ \\text{is\\_consistent}]$ 的列表，其中前三项是四舍五入到六位小数的浮点数，后两项是布尔值。\n- 您的程序应生成单行输出，其中包含所有四个测试案例的结果，格式为一个由方括号括起来的、以逗号分隔的列表，列表中的每个元素是对应案例的列表。例如，一个语法上相似的格式是 $[[f_{11},f_{12},f_{13},b_{11},b_{12}],[f_{21},f_{22},f_{23},b_{21},b_{22}],[f_{31},f_{32},f_{33},b_{31},b_{32}],[f_{41},f_{42},f_{43},b_{41},b_{42}]]$。",
            "solution": "用户提供了一个数值线性代数问题，该问题要求通过基本子空间（特别是矩阵 $A$ 的值域 $\\mathcal{R}(A)$ 及其正交补，即 $A^\\top$ 的零空间 $\\mathcal{N}(A^\\top)$）的视角来分析线性系统 $Ax=b$。该任务涉及计算向量 $b$ 的正交分解，分析处理 $b$ 在 $A$ 的值域之外的分量的两种不同策略（吉洪诺夫正则化和模型增广），并评估系统的数值相容性。\n\n### 问题验证\n\n我将首先根据指定程序验证问题陈述。\n\n#### 步骤1：提取已知条件\n\n-   **矩阵和向量对**：提供了四个测试案例 $(A_k, b_k)$，其中 $k \\in \\{1, 2, 3, 4\\}$。\n    -   案例 1: $A_1 \\in \\mathbb{R}^{5 \\times 3}$, $b_1 \\in \\mathbb{R}^5$\n    -   案例 2: $A_2 = A_1 \\in \\mathbb{R}^{5 \\times 3}$, $b_2 \\in \\mathbb{R}^5$\n    -   案例 3: $A_3 \\in \\mathbb{R}^{5 \\times 3}$, $b_3 \\in \\mathbb{R}^5$\n    -   案例 4: $A_4 \\in \\mathbb{R}^{3 \\times 3}$, $b_4 \\in \\mathbb{R}^3$\n    这些矩阵和向量的具体数值在问题描述中给出。\n-   **定义**：\n    -   值域 $\\mathcal{R}(A) = \\{ y \\in \\mathbb{R}^m \\mid y = Ax \\text{ for some } x \\in \\mathbb{R}^n \\}$。\n    -   转置的零空间 $\\mathcal{N}(A^\\top) = \\{ y \\in \\mathbb{R}^m \\mid A^\\top y = 0 \\}$。\n    -   正交分解：$b = b_{\\mathcal{R}(A)} + b_{\\perp}$，其中 $b_{\\mathcal{R}(A)} \\in \\mathcal{R}(A)$ 且 $b_{\\perp} \\in \\mathcal{N}(A^\\top)$。\n-   **数值参数与方法**：\n    -   数值秩容差：$\\tau = \\max(m,n)\\,\\epsilon\\,\\sigma_{\\max}$，其中 $\\epsilon$ 是双精度机器epsilon，$\\sigma_{\\max}$ 是 $A$ 的最大奇异值。数值秩是奇异值 $>\\tau$ 的数量。\n    -   吉洪诺夫正则化参数：$\\lambda = 10^{-2}$。\n    -   数值相容性准则：$\\lVert b_{\\perp} \\rVert_{2} \\leq 10^{-10}$。\n    -   核心数值工具：奇异值分解（SVD）。\n-   **任务**：\n    1.  计算正交分解 $b = b_{\\mathcal{R}(A)} + b_{\\perp}$。\n    2.  报告 $\\lVert b_{\\perp} \\rVert_{2}$。\n    3.  报告吉洪诺夫残差范数 $\\lVert A x_{\\lambda} - b \\rVert_{2}$。\n    4.  报告增广模型残差范数 $\\lVert A_{\\mathrm{aug}} y - b \\rVert_{2}$ 和一个布尔值 `aug_increases_range`。\n    5.  报告一个布尔值 `is_consistent`。\n-   **格式化**：所有浮点输出必须四舍五入到六位小数。\n\n#### 步骤2：使用提取的已知条件进行验证\n\n对问题进行严格评估。\n\n-   **科学依据**：该问题深深植根于线性代数的基本、普适性原理，例如弗雷德霍姆择一性（Fredholm alternative）和线性代数基本定理，这些定理确立了 $\\mathcal{R}(A)$ 和 $\\mathcal{N}(A^\\top)$ 的正交互补性。使用奇异值分解（SVD）作为主要计算工具是数值线性代数的标准做法，因为它具有稳定性，并能为四个基本子空间提供标准正交基。吉洪诺夫正则化是处理不适定反问题的典型方法。所有概念都是标准的，并且在事实上是可靠的。\n-   **适定性**：对于任何给定的实矩阵 $A$ 和向量 $b$，SVD存在且在奇异向量的符号上是唯一的。数值秩的定义提供了一个明确的过程。正交投影、吉洪诺夫正则化解和基于伪逆的解的公式都是明确定义的。因此，对于每个测试案例，都可以计算出一组唯一且有意義的结果。\n-   **客观性**：问题使用精确的数学语言陈述。所有定义都是形式化的，所有任务都是定量的且可通过计算验证。秩、相容性等标准均以数值阈值的形式明确给出，没有主观解释的余地。\n\n该问题没有表现出任何无效标志。它不是科学上不合理、不可形式化、不完整、不切实际、不适定、同义反复或无法验证的。所提供的数值虽然以有限精度陈述，但代表了应用数学和工程中的典型情景，并且没有引入矛盾。\n\n#### 步骤3：结论与行动\n\n该问题是**有效的**。这是一个精心设计的数值线性代数练习，旨在测试对基本概念的理解以及使用稳定数值方法进行实际应用的能力。我现在将着手提供一个完整的解法。\n\n### 解法\n\n每个测试案例 $(A, b)$ 的解法过程遵循以下步骤。所有计算都基于矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的奇异值分解（SVD）。\n\n设 $A$ 的 SVD 为 $A = U \\Sigma V^\\top$，其中 $U \\in \\mathbb{R}^{m \\times m}$ 和 $V \\in \\mathbb{R}^{n \\times n}$ 是正交矩阵，$\\Sigma \\in \\mathbb{R}^{m \\times n}$ 是一个矩形对角矩阵，其对角线上为非负奇异值 $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge 0$。$U$ 的列是左奇异向量 $\\{u_i\\}$，$V$ 的列是右奇异向量 $\\{v_i\\}$。\n\n**1. 数值秩与正交分解**\n\n首先，我们确定 $A$ 的数值秩 $r$。最大奇异值为 $\\sigma_{\\max} = \\sigma_1$。用于识别非零奇异值的容差由 $\\tau = \\max(m,n)\\,\\epsilon\\,\\sigma_1$ 给出，其中 $\\epsilon$ 是双精度数的机器精度。数值秩 $r$ 是奇异值 $\\sigma_i$ 中满足 $\\sigma_i > \\tau$ 的数量。\n\nSVD 为基本子空间提供了标准正交基：\n-   值域 $\\mathcal{R}(A)$ 由 $U$ 的前 $r$ 列，即 $\\{u_1, \\dots, u_r\\}$ 张成。\n-   $A^\\top$ 的零空间 $\\mathcal{N}(A^\\top)$ 由 $U$ 的后 $m-r$ 列，即 $\\{u_{r+1}, \\dots, u_m\\}$ 张成。\n\n任何向量 $b \\in \\mathbb{R}^m$ 都可以唯一地分解为 $b = b_{\\mathcal{R}(A)} + b_{\\perp}$，其中 $b_{\\mathcal{R}(A)}$ 是 $b$ 到 $\\mathcal{R}(A)$ 上的正交投影，$b_{\\perp}$ 是 $b$ 到 $\\mathcal{N}(A^\\top)$ 上的正交投影。\n投影 $b_{\\perp}$ 计算如下：\n$$ b_{\\perp} = \\sum_{i=r+1}^{m} (u_i^\\top b) u_i = U_{r\\perp} U_{r\\perp}^\\top b $$\n其中 $U_{r\\perp}$ 是矩阵 $[u_{r+1}, \\dots, u_m]$。然后计算欧几里得范数 $\\lVert b_{\\perp} \\rVert_2$。这个值量化了数据向量 $b$ 中无法由模型 $A$ 解释的部分。\n\n**2. 吉洪诺夫正则化残差**\n\n吉洪诺夫正则化解 $x_\\lambda$ 最小化目标函数 $J(x) = \\lVert Ax - b \\rVert_{2}^{2} + \\lambda^{2} \\lVert x \\rVert_{2}^{2}$。基于 SVD 的 $ x_\\lambda $ 解是 $x_\\lambda = \\sum_{i=1}^r \\frac{\\sigma_i}{\\sigma_i^2 + \\lambda^2} (u_i^\\top b) v_i$。\n残差向量 $r_\\lambda = Ax_\\lambda - b$ 可以在 $U$ 的基中进行分析。其沿 $u_i$ 的分量是：\n$$ u_i^\\top r_\\lambda = \\begin{cases} \\left( \\frac{\\sigma_i^2}{\\sigma_i^2 + \\lambda^2} - 1 \\right) u_i^\\top b = \\frac{-\\lambda^2}{\\sigma_i^2 + \\lambda^2} (u_i^\\top b)  \\text{for } i \\le r \\\\ -u_i^\\top b  \\text{for } i > r \\end{cases} $$\n残差的平方范数是这些分量平方的和：\n$$ \\lVert A x_{\\lambda} - b \\rVert_{2}^{2} = \\sum_{i=1}^{r} \\left( \\frac{\\lambda^2}{\\sigma_i^2 + \\lambda^2} (u_i^\\top b) \\right)^2 + \\sum_{i=r+1}^{m} (u_i^\\top b)^2 $$\n第二项恰好是 $\\lVert b_{\\perp} \\rVert_2^2$。第一项显示了正则化如何扰动残差在 $\\mathcal{R}(A)$ 内的投影。对于 $\\lambda > 0$，如果 $b$ 在 $\\mathcal{R}(A)$ 中有非零分量，则该范数总是大于 $\\lVert b_{\\perp} \\rVert_2$。\n\n**3. 模型增广**\n\n增广矩阵是 $A_{\\mathrm{aug}} = [A \\ \\ U_{r\\perp}]$，其中 $U_{r\\perp}$ 是其列构成 $\\mathcal{N}(A^\\top)$ 的标准正交基的矩阵。$A$ 的列张成 $\\mathcal{R}(A)$，$U_{r\\perp}$ 的列张成 $\\mathcal{N}(A^\\top)$。由于 $\\mathcal{R}(A)$ 和 $\\mathcal{N}(A^\\top)$ 是正交补，它们的直和张成整个空间：$\\mathcal{R}(A) \\oplus \\mathcal{N}(A^\\top) = \\mathbb{R}^m$。\n因此，增广矩阵的值域 $\\mathcal{R}(A_{\\mathrm{aug}})$ 是 $\\mathbb{R}^m$。这意味着对于任何向量 $b \\in \\mathbb{R}^m$，系统 $A_{\\mathrm{aug}}y = b$都是相容的。因此，最小二乘问题 $\\min_y \\lVert A_{\\mathrm{aug}} y - b \\rVert_2$ 的最小残差为 $0$。在数值上，这将是一个接近机器精度的值。\n\n如果被添加的空间 $\\mathcal{N}(A^\\top)$ 是非平凡的，则增广会严格增大模型的值域。这当且仅当 $\\dim \\mathcal{N}(A^\\top) = m-r > 0$，或者简单地说 $m > r$ 时发生。因此，如果 $m>r$，布尔值 `aug_increases_range` 为 `True`，否则为 `False`。\n\n**4. 数值相容性**\n\n如果向量 $b$ 与模型值域正交的分量小于给定容差，则认为 $b$ 与模型 $A$ 在数值上是相容的。我们评估条件 $\\lVert b_{\\perp} \\rVert_{2} \\leq 10^{-10}$ 并将布尔结果报告为 `is_consistent`。\n\n使用 NumPy 库提供的数值稳定方法，为每个测试案例实施这些步骤。",
            "answer": "[[0.000000, 0.015792, 0.000000, True, True],[0.500000, 0.500249, 0.000000, True, False],[0.282843, 0.282843, 0.000000, True, False],[0.000000, 0.007802, 0.000000, False, True]]"
        }
    ]
}