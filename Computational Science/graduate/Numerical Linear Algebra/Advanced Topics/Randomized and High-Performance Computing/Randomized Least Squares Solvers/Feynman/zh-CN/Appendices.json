{
    "hands_on_practices": [
        {
            "introduction": "随机化求解器的核心动机在于，它们相比经典方法具有显著提升计算速度的潜力。第一个练习将提供一个直接的、定量的比较。通过分析浮点运算次数，你将确定“草图-求解”流程在何种精确条件下优于传统的QR分解方法，从而将抽象的效率优势具体化。",
            "id": "3570172",
            "problem": "考虑一个高瘦型最小二乘问题，其矩阵为 $A \\in \\mathbb{R}^{n \\times d}$（$n \\gg d$），向量为 $b \\in \\mathbb{R}^{n}$。令 $\\operatorname{nnz}(A)$ 表示 $A$ 的非零元素的数量。您采用一个 sketch-and-solve 流水线，使用一个稀疏无关子空间嵌入 $S \\in \\mathbb{R}^{m \\times n}$，该嵌入每列恰好有 $s$ 个非零元，其符号在 $\\{-1,+1\\}$ 中，且行位置是均匀随机的。您构建降维后的设计矩阵 $SA \\in \\mathbb{R}^{m \\times d}$，并通过对 $SA$ 进行 Householder 正交三角 (QR) 分解来求解降维后的问题 $\\min_{x \\in \\mathbb{R}^{d}} \\|SAx - Sb\\|_{2}$。假设以下来自数值线性代数的、经过充分检验的性能模型和事实：\n- 当通过稀疏嵌入应用计算 $SA$ 时，$A$ 的每个非零元对 $SA$ 的相应条目贡献 $s$ 次更新，因此形成 $SA$ 的算术成本与 $s \\cdot \\operatorname{nnz}(A)$ 成正比。\n- 对于 $m \\ge d$ 的稠密矩阵 $\\mathbb{R}^{m \\times d}$，其 Householder 正交三角 (QR) 分解需要 $2md^{2} - \\frac{2}{3}d^{3}$ 次浮点运算。\n- 对原始（通常在填充后变为稠密）矩阵 $A \\in \\mathbb{R}^{n \\times d}$ 进行经典的 Householder 正交三角 (QR) 分解需要 $2nd^{2} - \\frac{2}{3}d^{3}$ 次浮点运算。\n\n基于这些基础，推导出以下各项的精确算术运算计数，以包含 $n$、$d$、$m$、$s$ 和 $\\operatorname{nnz}(A)$ 的符号表达式表示：\n1. 形成 $SA$ 并通过对 $SA$ 进行 Householder 正交三角 (QR) 分解来求解降维后问题的总浮点运算次数。\n2. 对 $A$ 进行经典 Householder 正交三角 (QR) 分解的浮点运算次数。\n\n将您的最终答案表示为一个包含两个条目的单行矩阵，分别对应于上面的第1项和第2项。您的答案应该是一个以 $n$、$d$、$m$、$s$ 和 $\\operatorname{nnz}(A)$ 表示的闭式解析表达式，单位为浮点运算次数。无需四舍五入。",
            "solution": "在进行求解之前，首先评估问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n- 一个高瘦型最小二乘问题，其矩阵为 $A \\in \\mathbb{R}^{n \\times d}$，向量为 $b \\in \\mathbb{R}^{n}$。\n- 条件：$n \\gg d$。\n- 符号：$\\operatorname{nnz}(A)$ 是 $A$ 的非零元素数量。\n- 方法：一个使用稀疏无关子空间嵌入 $S \\in \\mathbb{R}^{m \\times n}$ 的 sketch-and-solve 流水线。\n- $S$ 的性质：每列恰好有 $s$ 个非零元，其值在 $\\{-1,+1\\}$ 中，且行位置是均匀随机的。\n- 降维后的问题：$\\min_{x \\in \\mathbb{R}^{d}} \\|SAx - Sb\\|_{2}$。\n- 降维后问题的求解方法：对矩阵 $SA \\in \\mathbb{R}^{m \\times d}$ 进行 Householder 正交三角 (QR) 分解。\n- 成本模型 1：基于 $A$ 的每个非零元贡献 $s$ 次更新的事实，形成 $SA$ 的算术成本与 $s \\cdot \\operatorname{nnz}(A)$ 成正比。\n- 成本模型 2：对于 $m \\ge d$ 的稠密矩阵 $\\mathbb{R}^{m \\times d}$，其 Householder QR 分解需要 $2md^{2} - \\frac{2}{3}d^{3}$ 次浮点运算。\n- 成本模型 3：对矩阵 $A \\in \\mathbb{R}^{n \\times d}$ 进行经典 Householder QR 分解需要 $2nd^{2} - \\frac{2}{3}d^{3}$ 次浮点运算。\n- 要求：推导以下各项的精确算术运算计数：\n  1. 形成 $SA$ 并通过对 $SA$ 进行 Householder QR 分解来求解降维后问题。\n  2. 对 $A$ 进行经典 Householder QR 分解。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题定义明确且科学上合理。它基于随机数值线性代数的既定原则，特别是用于超定最小二乘问题的“sketch-and-solve”方法。所提供的 Householder QR 分解的成本模型是标准的，代表了运算计数中的主导项。稀疏嵌入的描述及其应用的成本模型与最前沿的文献（例如，Clarkson-Woodruff sketch）一致。所有必要的变量（$n, d, m, s, \\operatorname{nnz}(A)$）都已定义。该问题是客观的且可形式化的。\n\n“求解降维后的问题”这一短语需要仔细解读。完整的求解过程包括形成 $Sb$、对 $SA$ 进行 QR 分解、将正交变换应用于 $Sb$ 以及求解得到的三角系统。问题仅为分解步骤（$2md^2 - \\frac{2}{3}d^3$）提供了具体的成本模型。问题的并行结构——其中经典方法的成本也仅给出了分解的成本——强烈暗示“通过 QR 求解”指的是这个主导的分解阶段。然而，建立降维后的问题也需要形成 $Sb$。形成 $Sb$ 的成本没有明确给出，但可以以类似于形成 $SA$ 的方式从 $S$ 的性质中直接推导出。一个有能力的学生应该能够推导出这个成本。因此，该问题被认为是完整且适定的。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将基于所提供的模型和逻辑推导来得出解。\n\n### 运算计数的推导\n\n该问题要求计算两个不同的运算计数。\n\n**1. sketch-and-solve 方法的总运算次数**\n\n该方法的总浮点运算次数是三个部分的总和：\n(a) 形成降维后矩阵 $SA$ 的成本。\n(b) 形成降维后向量 $Sb$ 的成本。\n(c) 使用 Householder QR 分解求解降维后最小二乘问题的成本。\n\n(a) 形成 $SA$ 的成本：\nsketching 矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 每列有 $s$ 个非零元，其值为 $+1$ 或 $-1$。乘积 $SA$ 的形成可以从 $A$ 的非零元的角度来看。对于每个非零元 $A_{ij}$，它参与了 $SA$ 第 $j$ 列的计算。具体来说，$A_{ij}$ 的值与 $S$ 的第 $i$ 列相乘。由于 $S$ 的第 $i$ 列有 $s$ 个非零元，$A_{ij}$ 对 $SA$ 的第 $j$ 列中的 $s$ 个条目有贡献。每个这样的贡献都是形式为 $(SA)_{k,j} \\leftarrow (SA)_{k,j} + S_{k,i}A_{ij}$ 的更新。由于 $S_{k,i} \\in \\{-1, +1\\}$，这是一个加法或减法，计为一次浮点运算。因为 $A$ 中有 $\\operatorname{nnz}(A)$ 个非零元，总成本为：\n$$ \\text{Cost}(SA) = s \\cdot \\operatorname{nnz}(A) $$\n\n(b) 形成 $Sb$ 的成本：\n这个成本必须作为建立降维后问题的一部分被包含在内。向量 $b \\in \\mathbb{R}^n$ 通常是稠密的。乘积 $Sb$ 是通过将稀疏矩阵 $S$ 乘以向量 $b$ 来计算的。对于向量 $b$ 的每个元素 $b_i$（对于 $i=1, \\dots, n$），它与 $S$ 的第 $i$ 列相乘。该列有 $s$ 个非零元。因此，$b_i$ 被加到或减到结果向量 $Sb$ 中的 $s$ 个条目上。对 $b$ 的所有 $n$ 个元素重复此过程。总浮点运算次数为：\n$$ \\text{Cost}(Sb) = s \\cdot n $$\n\n(c) 对 $SA$ 进行 QR 求解的成本：\n矩阵 $SA$ 属于 $\\mathbb{R}^{m \\times d}$。问题明确提供了对此类矩阵进行 Householder QR 分解的成本为 $2md^{2} - \\frac{2}{3}d^{3}$。正如在验证阶段所论证的，我们用这个成本作为通过 QR “求解”系统的成本。\n$$ \\text{Cost}(\\text{QR on } SA) = 2md^{2} - \\frac{2}{3}d^{3} $$\n\n第一部分的总成本是这三个部分的总和：\n$$ \\text{Total Cost}_1 = \\text{Cost}(SA) + \\text{Cost}(Sb) + \\text{Cost}(\\text{QR on } SA) = s \\cdot \\operatorname{nnz}(A) + sn + 2md^{2} - \\frac{2}{3}d^{3} $$\n\n**2. 经典 Householder QR 方法的运算**\n\n问题要求计算对原始矩阵 $A \\in \\mathbb{R}^{n \\times d}$ 进行经典 Householder QR 分解的浮点运算次数。这个成本在问题陈述中直接给出为：\n$$ \\text{Total Cost}_2 = 2nd^{2} - \\frac{2}{3}d^{3} $$\n\n这两个表达式代表了问题两个部分的最终答案。它们将按要求以行矩阵的形式呈现。",
            "answer": "$$ \\boxed{\\begin{pmatrix} s \\operatorname{nnz}(A) + sn + 2md^{2} - \\frac{2}{3}d^{3}  2nd^{2} - \\frac{2}{3}d^{3} \\end{pmatrix}} $$"
        },
        {
            "introduction": "并非所有草图都是等效的；获得高质量近似解的关键通常在于以数据依赖的方式进行采样。本练习旨在探索杠杆分数采样的理论基础，这是一种优先考虑更具“影响力”数据点的强大技术。通过推导和比较杠杆分数采样与均匀采样所需的样本量，你将揭示其性能优势的根本原因，尤其是在数据具有高相干性的情况下。",
            "id": "3570168",
            "problem": "考虑一个满列秩为 $d$ 的高矩阵 $A \\in \\mathbb{R}^{n \\times d}$，其中 $n \\geq d$。令 $A = Q R$ 为其瘦QR分解，其中 $Q \\in \\mathbb{R}^{n \\times d}$ 具有标准正交列，$R \\in \\mathbb{R}^{d \\times d}$ 是可逆矩阵。定义杠杆分数 $\\ell_i = \\|Q_{i,:}\\|_2^2$（对于 $i \\in \\{1, \\dots, n\\}$）和相干性 $\\mu = \\max_{i} \\ell_i$。在一个随机化“素描-求解”最小二乘法中，通过使用分布 $p = (p_1, \\dots, p_n)$ 进行 $m$ 次有放回的行采样来形成一个素描，并进行重加权，使得素描矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 的行为 $e_{i_j}^{\\top} / \\sqrt{m p_{i_j}}$，其中 $e_{i_j}$ 是第 $i_j$ 个标准基向量，且对于 $j = 1, \\dots, m$，$i_j \\sim p$ 是独立同分布的。获得精确解的一个充分条件是，$S$ 是 $A$ 的列空间的一个 $(1 \\pm \\varepsilon)$ 子空间嵌入，即对于所有 $x \\in \\mathbb{R}^d$，\n$$(1 - \\varepsilon)\\|A x\\|_2^2 \\leq \\|S A x\\|_2^2 \\leq (1 + \\varepsilon)\\|A x\\|_2^2,$$\n成立，且失败概率至多为 $\\delta$。\n\n从以下基本事实出发：\n- $Q^{\\top} Q = I_d$，\n- $\\sum_{i=1}^{n} \\ell_i = d$，\n- $\\mathbb{E}\\!\\left[Q^{\\top} S^{\\top} S Q\\right] = I_d$，\n- 矩阵Chernoff不等式根据独立半正定随机矩阵谱范数和期望的一致界来控制这些矩阵之和的集中情况，\n\n对于一个通用常数 $c  0$，推导对于以下两种采样分布 $p$ 的选择，确保子空间嵌入性质的充分样本量 $m$：\n(a) 杠杆分数采样：$p_i = \\ell_i / \\sum_{j=1}^{n} \\ell_j$，\n(b) 均匀采样：$p_i = 1/n$。\n\n假设矩阵具有高相干性，即 $\\mu$ 接近 $1$，并表达出样本量对 $\\varepsilon$, $\\delta$, $n$, $d$ 和 $\\mu$ 的依赖关系。最后，计算并给出比率 $m_{\\mathrm{uniform}} / m_{\\mathrm{lev}}$ 作为 $n$, $d$ 和 $\\mu$ 的函数的简化符号表达式。最终答案必须是该比率的单个表达式。不需要数值近似。",
            "solution": "该问题要求推导使用两种不同采样分布的随机化最小二乘求解器的充分样本量，然后计算这些样本量的比率。该分析依赖于子空间嵌入的概念，并使用矩阵Chernoff集中不等式进行。\n\n首先，我们将子空间嵌入条件形式化。一个矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 是 $A \\in \\mathbb{R}^{n \\times d}$ 的列空间的一个 $(1 \\pm \\varepsilon)$ 子空间嵌入，如果对于所有 $x \\in \\mathbb{R}^d$，下式成立：\n$$ (1 - \\varepsilon)\\|A x\\|_2^2 \\leq \\|S A x\\|_2^2 \\leq (1 + \\varepsilon)\\|A x\\|_2^2 $$\n给定瘦QR分解 $A=QR$，其中 $Q \\in \\mathbb{R}^{n \\times d}$ 具有标准正交列，$R \\in \\mathbb{R}^{d \\times d}$ 是可逆的，我们可以进行变量替换。令 $y = Rx$。由于 $R$ 是可逆的，当 $x$ 遍历 $\\mathbb{R}^d$ 时，$y$ 也遍历 $\\mathbb{R}^d$。该条件可以重写为关于 $Q$ 和 $y$ 的形式：\n$$ \\|Ax\\|_2^2 = \\|QRx\\|_2^2 = \\|Qy\\|_2^2 = y^{\\top}Q^{\\top}Qy = y^{\\top}I_d y = \\|y\\|_2^2 $$\n$$ \\|SAx\\|_2^2 = \\|SQRx\\|_2^2 = \\|SQy\\|_2^2 = y^{\\top}Q^{\\top}S^{\\top}SQy $$\n将这些代入不等式得到：\n$$ (1 - \\varepsilon)\\|y\\|_2^2 \\leq y^{\\top}Q^{\\top}S^{\\top}SQy \\leq (1 + \\varepsilon)\\|y\\|_2^2 $$\n这必须对所有 $y \\in \\mathbb{R}^d$ 成立。这等价于声明矩阵 $X = Q^{\\top}S^{\\top}SQ$ 的所有特征值都在区间 $[1-\\varepsilon, 1+\\varepsilon]$ 内。用谱范数表示，这等价于 $\\|X - I_d\\|_2 \\le \\varepsilon$。\n\n接下来，我们分析随机矩阵 $X$ 的结构。素描矩阵 $S$ 是由 $m$ 次独立抽样形成的。具体来说，其第 $j$ 行（对于 $j \\in \\{1, \\dots, m\\}$）由 $\\frac{1}{\\sqrt{m p_{i_j}}} e_{i_j}^{\\top}$ 给出，其中 $i_j$ 是根据概率分布 $p=(p_1, \\dots, p_n)$ 从 $\\{1, \\dots, n\\}$ 中抽样得到的索引。矩阵 $S^{\\top}S$ 可以写成其行向量外积的和：\n$$ S^{\\top}S = \\sum_{j=1}^{m} \\left( \\frac{1}{\\sqrt{m p_{i_j}}} e_{i_j} \\right) \\left( \\frac{1}{\\sqrt{m p_{i_j}}} e_{i_j}^{\\top} \\right) = \\frac{1}{m} \\sum_{j=1}^{m} \\frac{e_{i_j}e_{i_j}^{\\top}}{p_{i_j}} $$\n那么，矩阵 $X$ 是：\n$$ X = Q^{\\top}S^{\\top}SQ = Q^{\\top} \\left( \\frac{1}{m} \\sum_{j=1}^{m} \\frac{e_{i_j}e_{i_j}^{\\top}}{p_{i_j}} \\right) Q = \\frac{1}{m} \\sum_{j=1}^{m} \\frac{Q^{\\top}e_{i_j}e_{i_j}^{\\top}Q}{p_{i_j}} $$\n令 $Q_{k,:}$ 表示 $Q$ 的第 $k$ 行。那么 $e_k^{\\top}Q = Q_{k,:}$。因此，我们可以将 $X$ 写成独立同分布随机矩阵的和：\n$$ X = \\sum_{j=1}^{m} X_j, \\quad \\text{其中} \\quad X_j = \\frac{1}{m p_{i_j}} (Q_{i_j,:})^{\\top} Q_{i_j,:} $$\n问题陈述中指出 $\\mathbb{E}[X] = I_d$，这是一个我们可以验证的关键性质：\n$$ \\mathbb{E}[X_j] = \\sum_{k=1}^{n} p_k \\left( \\frac{1}{m p_k} (Q_{k,:})^{\\top} Q_{k,:} \\right) = \\frac{1}{m} \\sum_{k=1}^{n} (Q_{k,:})^{\\top} Q_{k,:} = \\frac{1}{m} Q^{\\top}Q = \\frac{1}{m} I_d $$\n和的期望是 $\\mathbb{E}[X] = \\sum_{j=1}^m \\mathbb{E}[X_j] = m \\left( \\frac{1}{m} I_d \\right) = I_d$。\n\n为了界定 $X$ 与其均值 $I_d$ 的偏差，我们使用矩阵Chernoff集中不等式。对于独立半正定 (PSD) 随机矩阵 $X_j$ 的和，该不等式的一个标准版本指出，为了使失败概率至多为 $\\delta$，选择样本数量 $m$ 使得下式成立是充分的：\n$$ m \\ge c \\cdot \\frac{K}{\\varepsilon^2} \\ln(2d/\\delta) $$\n其中 $c  0$ 是某个通用常数，$K$ 是一个依赖于随机矩阵性质的参数。在这种情况下，参数 $K$ 与被求和的单个随机矩阵的最大谱范数有关。我们来分析 $X = \\frac{1}{m}\\sum_j Z_j$，其中 $Z_j = \\frac{1}{p_{i_j}} (Q_{i_j,:})^{\\top}Q_{i_j,:}$ 是独立同分布的，且 $\\mathbb{E}[Z_j]=I_d$。Chernoff界的相关参数是任意单个项 $Z_j$ 的最大谱范数。设此界为 $R$。\n$$ R = \\max_{i \\in \\{1,\\dots,n\\}} \\left\\| \\frac{1}{p_i} (Q_{i,:})^{\\top}Q_{i,:} \\right\\|_2 $$\n矩阵 $(Q_{i,:})^{\\top}Q_{i,:}$ 是一个秩为1的矩阵。其唯一的非零特征值是 $\\operatorname{Tr}((Q_{i,:})^{\\top}Q_{i,:}) = Q_{i,:}(Q_{i,:})^{\\top} = \\|Q_{i,:}\\|_2^2 = \\ell_i$。因此，其谱范数是 $\\ell_i$。\n所以，参数 $R$ 由下式给出：\n$$ R = \\max_{i \\in \\{1,\\dots,n\\}} \\frac{\\ell_i}{p_i} $$\n因此，一个充分的样本量为 $m = O\\left(\\frac{R \\ln(d/\\delta)}{\\varepsilon^2}\\right)$。使用题目提示中给出的常数 $c$：\n$$ m \\ge c \\cdot (\\max_i \\frac{\\ell_i}{p_i}) \\cdot \\frac{\\ln(d/\\delta)}{\\varepsilon^2} $$\n（注意：$\\ln(2d/\\delta)$ 中的常数 $2$ 被吸收到通用常数 $c$ 中）。我们现在将此公式应用于两种指定的采样分布。\n\n(a) 杠杆分数采样：\n采样概率定义为 $p_i = \\ell_i / \\sum_{j=1}^n \\ell_j$。根据已知事实，$\\sum_{j=1}^n \\ell_j = d$。因此，$p_i = \\ell_i / d$。\n我们计算参数 $R_{\\mathrm{lev}}$：\n$$ R_{\\mathrm{lev}} = \\max_i \\frac{\\ell_i}{p_i} = \\max_i \\frac{\\ell_i}{\\ell_i / d} = \\max_i d = d $$\n充分样本量 $m_{\\mathrm{lev}}$ 是：\n$$ m_{\\mathrm{lev}} = c \\frac{d \\ln(d/\\delta)}{\\varepsilon^2} $$\n\n(b) 均匀采样：\n采样概率为 $p_i = 1/n$，对所有 $i \\in \\{1, \\dots, n\\}$ 成立。\n我们计算参数 $R_{\\mathrm{uniform}}$：\n$$ R_{\\mathrm{uniform}} = \\max_i \\frac{\\ell_i}{p_i} = \\max_i \\frac{\\ell_i}{1/n} = n \\max_i \\ell_i $$\n问题将相干性定义为 $\\mu = \\max_i \\ell_i$。因此，$R_{\\mathrm{uniform}} = n\\mu$。\n充分样本量 $m_{\\mathrm{uniform}}$ 是：\n$$ m_{\\mathrm{uniform}} = c \\frac{n \\mu \\ln(d/\\delta)}{\\varepsilon^2} $$\n题目陈述中提到要考虑 $\\mu$ 接近 $1$ 的高相干性情况，这突显了与杠杆分数采样相比，均匀采样可能效率低下的场景。对 $\\mu$ 的依赖性捕捉了这一点。\n\n最后，我们计算比率 $m_{\\mathrm{uniform}} / m_{\\mathrm{lev}}$：\n$$ \\frac{m_{\\mathrm{uniform}}}{m_{\\mathrm{lev}}} = \\frac{c \\frac{n \\mu \\ln(d/\\delta)}{\\varepsilon^2}}{c \\frac{d \\ln(d/\\delta)}{\\varepsilon^2}} $$\n项 $c$、$\\varepsilon^2$ 和 $\\ln(d/\\delta)$ 被消掉，剩下：\n$$ \\frac{m_{\\mathrm{uniform}}}{m_{\\mathrm{lev}}} = \\frac{n\\mu}{d} $$\n这个比率量化了使用杠杆分数采样相对于均匀采样所获得的样本复杂度的改进。由于 $\\sum_i \\ell_i = d$，我们有 $d = \\sum_i \\ell_i \\le n \\max_i \\ell_i = n\\mu$，这意味着 $\\mu \\ge d/n$。因此，比率 $\\frac{n\\mu}{d} \\ge \\frac{n(d/n)}{d} = 1$，这证实了在这个理论界限下，杠杆分数采样总是至少与均匀采样一样有效。当相干性 $\\mu$ 远大于其可能的最小值 $d/n$ 时，这种改进是显著的。",
            "answer": "$$\n\\boxed{\\frac{n\\mu}{d}}\n$$"
        },
        {
            "introduction": "先前练习  中探讨的杠杆分数采样的理论优势，通过一个具体的例子可以得到更清晰的展示。在本次练习中，你将构建一个“最坏情况”下的设计矩阵，其中少数数据点具有不成比例的影响力，从而导致高相干性。通过从第一性原理出发计算其杠杆分数和相干性，你将把抽象的性能增益转化为一个具体的符号因子，从而巩固你对数据几何形状如何决定算法效率的理解。",
            "id": "3570188",
            "problem": "考虑一个超定最小二乘问题，其设计矩阵为 $A \\in \\mathbb{R}^{n \\times k}$，响应向量为 $b \\in \\mathbb{R}^{n}$，目标是计算 $x^{\\star} \\in \\arg\\min_{x \\in \\mathbb{R}^{k}} \\|A x - b\\|_{2}$。假设采用一种降维求解（sketch-and-solve）方法，其中使用一个采样与重加权矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 来构建一个降维问题 $\\min_{x \\in \\mathbb{R}^{k}} \\|S A x - S b\\|_{2}$。采样概率记为 $p_{i}$（其中 $i \\in \\{1,2,\\dots,n\\}$），每个被选中的行都通过因子 $(m p_{i})^{-1/2}$ 进行重加权。\n\n将行杠杆分数 $\\ell_{i}$ 定义为到 $A$ 的列空间的正交投影算子的对角线元素，等价地，$\\ell_{i} = \\|U_{i,:}\\|_{2}^{2}$，其中 $A = U R$ 是 $A$ 的细QR分解，$U \\in \\mathbb{R}^{n \\times k}$ 具有标准正交列，$R \\in \\mathbb{R}^{k \\times k}$ 是上三角矩阵。$A$ 的相干性定义为 $\\mu(A) = \\frac{n}{k} \\max_{i} \\ell_{i}$。\n\n使用多项式特征构建一个最坏情况相干性设计：取 $k = 2$，并令 $A$ 由1次单项式特征构成，也就是说，$A$ 有两列，分别对应函数 $x \\mapsto 1$ 和 $x \\mapsto x$。设 $n$ 个输入位置为 $x_{1}, \\dots, x_{n} \\in \\{-1, +1\\}$，其中恰好有一个位置等于 $-1$，其余 $n-1$ 个位置等于 $+1$。利用最小二乘、杠杆分数和相干性的基本定义，确定该设计的相干性 $\\mu(A)$。\n\n利用关于失真为 $(1 \\pm \\varepsilon)$ 且失败概率至多为 $\\delta$ 的子空间嵌入概念，以及标准的采样与重加权构造，从第一性原理出发，论证均匀采样（即对所有 $i$，$p_{i} = 1/n$）的最小充分样本量 $m_{\\mathrm{unif}}$ 的规模为 $m_{\\mathrm{unif}} \\propto k \\ln(k/\\delta) \\mu(A) \\varepsilon^{-2}$，而杠杆分数采样（即 $p_{i} = \\ell_{i}/k$）的最小充分样本量 $m_{\\mathrm{lev}}$ 的规模为 $m_{\\mathrm{lev}} \\propto k \\ln(k/\\delta) \\varepsilon^{-2}$。对于上述多项式设计，得出精确的渐近增益因子（定义为在相同 $(\\varepsilon, \\delta)$ 下的比率 $m_{\\mathrm{unif}}/m_{\\mathrm{lev}}$），并将你的最终答案表示为仅含 $n$ 的单个闭式解析表达式。不涉及物理单位。无需四舍五入。",
            "solution": "用户希望找到针对特定最小二乘问题，杠杆分数采样相对于均匀采样的渐近增益因子。\n\n### 步骤1：提取已知条件\n- 问题类型：超定最小二乘，$ \\min_{x \\in \\mathbb{R}^{k}} \\|A x - b\\|_{2}$。\n- 设计矩阵：$A \\in \\mathbb{R}^{n \\times k}$。\n- 响应向量：$b \\in \\mathbb{R}^{n}$。\n- 降维矩阵：$S \\in \\mathbb{R}^{m \\times n}$，一个采样与重加权矩阵。\n- 降维问题：$\\min_{x \\in \\mathbb{R}^{k}} \\|S A x - S b\\|_{2}$。\n- 采样概率：$p_{i}$，其中 $i \\in \\{1, 2, \\dots, n\\}$。\n- 重加权因子：$(m p_{i})^{-1/2}$。\n- 杠杆分数：$\\ell_{i} = \\|U_{i,:}\\|_{2}^{2}$，其中 $A = U R$ 是 $A$ 的细QR分解，$U \\in \\mathbb{R}^{n \\times k}$ 具有标准正交列。\n- 相干性：$\\mu(A) = \\frac{n}{k} \\max_{i} \\ell_{i}$。\n- 具体设计：\n    - $k=2$。\n    - $A$ 的列是基函数 $x \\mapsto 1$ 和 $x \\mapsto x$。\n    - 输入位置 $x_{1}, \\dots, x_{n} \\in \\{-1, +1\\}$。\n    - 恰好一个位置是 $-1$，其余 $n-1$ 个是 $+1$。令 $x_{1}=-1$ 且对于 $i=2, \\dots, n$，$x_{i}=+1$。\n- 在失真为 $(1 \\pm \\varepsilon)$、失败概率为 $\\delta$ 下的样本量规模：\n    - 均匀采样 ($p_{i} = 1/n$): $m_{\\mathrm{unif}} \\propto k \\ln(k/\\delta) \\mu(A) \\varepsilon^{-2}$。\n    - 杠杆分数采样 ($p_{i} = \\ell_{i}/k$): $m_{\\mathrm{lev}} \\propto k \\ln(k/\\delta) \\varepsilon^{-2}$。\n- 目标：确定精确的渐近增益因子，定义为比率 $m_{\\mathrm{unif}}/m_{\\mathrm{lev}}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上和数学上是合理的。它基于数值线性代数和随机算法中标准的、成熟的概念，包括最小二乘、QR分解、统计杠杆分数、相干性以及降维求解方法（特别是采样和重加权）。所提供的定义是该领域的标准定义。设计矩阵 $A$ 的设置是明确的，可以直接计算。问题提法清晰，要求一个特定的、可计算的量（相干性 $\\mu(A)$）以及一个基于既有理论结果的后续比率。该问题是自洽的，没有矛盾或歧义。因此，这是一个有效的问题。\n\n### 步骤3：进行求解\n\n解决方案包括三个主要部分：\n1.  构造矩阵 $A$ 并计算其细QR分解以找到矩阵 $U$。\n2.  使用 $U$ 的行计算杠杆分数 $\\ell_{i}$，然后计算相干性 $\\mu(A)$。\n3.  使用提供的样本量缩放定律来确定渐近增益因子 $m_{\\mathrm{unif}}/m_{\\mathrm{lev}}$。\n\n**第1部分：构造 $A$ 并求 $U$**\n\n矩阵 $A$ 有 $n$ 行和 $k=2$ 列。第一列是全1向量，对应于基函数 $x \\mapsto 1$。第二列对应于基函数 $x \\mapsto x$ 在点 $x_1 = -1, x_2 = 1, \\dots, x_n = 1$ 处的求值。\n$$\nA = \\begin{pmatrix}\n1  x_1 \\\\\n1  x_2 \\\\\n\\vdots  \\vdots \\\\\n1  x_n\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1  -1 \\\\\n1  1 \\\\\n1  1 \\\\\n\\vdots  \\vdots \\\\\n1  1\n\\end{pmatrix}\n$$\n设 $A$ 的列为 $a_1$ 和 $a_2$。我们使用Gram-Schmidt过程求 $A$ 的列空间的一组标准正交基，从而得到矩阵 $U$ 的列 $u_1, u_2$。\n\n$A$ 的第一列是 $a_1 = [1, 1, \\dots, 1]^T$。其二范数的平方是 $\\|a_1\\|_2^2 = \\sum_{i=1}^n 1^2 = n$。\n第一个标准正交向量 $u_1$ 是：\n$$\nu_1 = \\frac{a_1}{\\|a_1\\|_2} = \\frac{1}{\\sqrt{n}} \\begin{pmatrix} 1 \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix}\n$$\n$A$ 的第二列是 $a_2 = [-1, 1, \\dots, 1]^T$。我们首先求 $a_2$ 正交于 $u_1$ 的分量，记为 $w_2$。\n$$\nw_2 = a_2 - \\langle a_2, u_1 \\rangle u_1\n$$\n内积是：\n$$\n\\langle a_2, u_1 \\rangle = a_2^T u_1 = \\frac{1}{\\sqrt{n}} \\left( (-1)(1) + (n-1)(1)(1) \\right) = \\frac{n-2}{\\sqrt{n}}\n$$\n所以，$w_2$ 是：\n$$\nw_2 = a_2 - \\frac{n-2}{\\sqrt{n}} u_1 = a_2 - \\frac{n-2}{n} a_1 = \\begin{pmatrix} -1 \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix} - \\frac{n-2}{n} \\begin{pmatrix} 1 \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -1 - \\frac{n-2}{n} \\\\ 1 - \\frac{n-2}{n} \\\\ \\vdots \\\\ 1 - \\frac{n-2}{n} \\end{pmatrix} = \\begin{pmatrix} \\frac{-n-n+2}{n} \\\\ \\frac{n-n+2}{n} \\\\ \\vdots \\\\ \\frac{2}{n} \\end{pmatrix} = \\frac{2}{n} \\begin{pmatrix} 1-n \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix}\n$$\n接下来，我们将 $w_2$ 归一化以得到 $u_2$。$w_2$ 的二范数平方是：\n$$\n\\|w_2\\|_2^2 = \\left(\\frac{2}{n}\\right)^2 \\left( (1-n)^2 + \\sum_{i=2}^n 1^2 \\right) = \\frac{4}{n^2} \\left( (n-1)^2 + n-1 \\right) = \\frac{4}{n^2} (n-1)(n-1+1) = \\frac{4(n-1)n}{n^2} = \\frac{4(n-1)}{n}\n$$\n范数是 $\\|w_2\\|_2 = \\sqrt{\\frac{4(n-1)}{n}} = \\frac{2\\sqrt{n-1}}{\\sqrt{n}}$。\n第二个标准正交向量 $u_2$ 是：\n$$\nu_2 = \\frac{w_2}{\\|w_2\\|_2} = \\frac{\\frac{2}{n} \\begin{pmatrix} 1-n \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix}}{\\frac{2\\sqrt{n-1}}{\\sqrt{n}}} = \\frac{\\sqrt{n}}{n\\sqrt{n-1}} \\begin{pmatrix} 1-n \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{n(n-1)}} \\begin{pmatrix} 1-n \\\\ 1 \\\\ \\vdots \\\\ 1 \\end{pmatrix}\n$$\n具有标准正交列的矩阵 $U$ 是 $U = [u_1 | u_2]$。\n\n**第2部分：计算杠杆分数和相干性**\n\n杠杆分数 $\\ell_i$ 是 $U$ 的第 $i$ 行（记为 $U_{i,:}$）的欧几里得范数的平方。\n$U$ 的第一行，对应于 $x_1 = -1$，是：\n$$\nU_{1,:} = \\left( \\frac{1}{\\sqrt{n}}, \\frac{1-n}{\\sqrt{n(n-1)}} \\right)\n$$\n其杠杆分数 $\\ell_1$ 是：\n$$\n\\ell_1 = \\|U_{1,:}\\|_2^2 = \\left(\\frac{1}{\\sqrt{n}}\\right)^2 + \\left(\\frac{1-n}{\\sqrt{n(n-1)}}\\right)^2 = \\frac{1}{n} + \\frac{(1-n)^2}{n(n-1)} = \\frac{1}{n} + \\frac{(n-1)^2}{n(n-1)} = \\frac{1}{n} + \\frac{n-1}{n} = \\frac{n}{n} = 1\n$$\n对于任何其他行 $i \\in \\{2, \\dots, n\\}$，对应于 $x_i = 1$，$U$ 的行是：\n$$\nU_{i,:} = \\left( \\frac{1}{\\sqrt{n}}, \\frac{1}{\\sqrt{n(n-1)}} \\right)\n$$\n当 $i  1$ 时，杠杆分数 $\\ell_i$ 是：\n$$\n\\ell_i = \\|U_{i,:}\\|_2^2 = \\left(\\frac{1}{\\sqrt{n}}\\right)^2 + \\left(\\frac{1}{\\sqrt{n(n-1)}}\\right)^2 = \\frac{1}{n} + \\frac{1}{n(n-1)} = \\frac{n-1+1}{n(n-1)} = \\frac{n}{n(n-1)} = \\frac{1}{n-1}\n$$\n作为合理性检查，杠杆分数的总和必须等于秩 $k=2$：$\\sum_{i=1}^n \\ell_i = \\ell_1 + \\sum_{i=2}^n \\ell_i = 1 + (n-1) \\left(\\frac{1}{n-1}\\right) = 1+1=2$。这是正确的。\n\n现在，我们计算相干性 $\\mu(A)$。\n对于 $n \\ge 3$，我们有 $n-1 \\ge 2$，所以 $\\frac{1}{n-1} \\le \\frac{1}{2}  1$。对于 $n=2$，$\\frac{1}{n-1}=1$。因此，对于任何 $n \\ge 2$，$\\max_i \\ell_i = \\ell_1 = 1$。\n$$\n\\mu(A) = \\frac{n}{k} \\max_{i} \\ell_{i} = \\frac{n}{2} \\cdot 1 = \\frac{n}{2}\n$$\n\n**第3部分：确定渐近增益因子**\n\n问题给出了均匀采样和杠杆分数采样的充分样本量的规模关系。要求我们从第一性原理对此进行论证。论证的核心在于矩阵集中不等式。对于一个采样与重加权方案，实现子空间嵌入所需的样本复杂度 $m$ 主要由项 $m \\propto (\\max_i \\frac{\\ell_i}{p_i}) \\frac{\\log(k/\\delta)}{\\varepsilon^2}$ 决定。\n\n对于均匀采样，$p_i = 1/n$ 对所有 $i$ 成立。复杂度因子变为：\n$$\n\\max_i \\frac{\\ell_i}{p_i} = \\max_i \\frac{\\ell_i}{1/n} = n \\max_i \\ell_i\n$$\n使用相干性的定义 $\\mu(A) = \\frac{n}{k} \\max_i \\ell_i$，我们可以写出 $n \\max_i \\ell_i = k \\, \\mu(A)$。因此，$m_{\\mathrm{unif}} \\propto k \\, \\mu(A) \\frac{\\log(k/\\delta)}{\\varepsilon^2}$，这与问题陈述相符。\n\n对于杠杆分数采样，$p_i = \\ell_i / \\sum_j \\ell_j = \\ell_i/k$。复杂度因子变为：\n$$\n\\max_i \\frac{\\ell_i}{p_i} = \\max_i \\frac{\\ell_i}{\\ell_i/k} = \\max_i k = k\n$$\n因此，$m_{\\mathrm{lev}} \\propto k \\frac{\\log(k/\\delta)}{\\varepsilon^2}$，这也与问题陈述相符。\n\n渐近增益因子是比率 $m_{\\mathrm{unif}}/m_{\\mathrm{lev}}$。假设比例常数相同（在这类分析中这是标准做法），我们有：\n$$\n\\frac{m_{\\mathrm{unif}}}{m_{\\mathrm{lev}}} = \\frac{k \\ln(k/\\delta) \\mu(A) \\varepsilon^{-2}}{k \\ln(k/\\delta) \\varepsilon^{-2}} = \\mu(A)\n$$\n代入我们为指定的多项式设计计算出的 $\\mu(A)$ 的值：\n$$\n\\frac{m_{\\mathrm{unif}}}{m_{\\mathrm{lev}}} = \\mu(A) = \\frac{n}{2}\n$$\n对于这种最坏情况相干性设计，该比率表示为达到相同的近似保证，均匀采样比最优的杠杆分数采样需要多出的样本倍数。",
            "answer": "$$\n\\boxed{\\frac{n}{2}}\n$$"
        }
    ]
}