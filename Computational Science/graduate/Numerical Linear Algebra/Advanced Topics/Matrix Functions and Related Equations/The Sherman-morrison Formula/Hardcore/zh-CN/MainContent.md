## 引言
在科学与工程的众多计算问题中，大型矩阵及其逆矩阵的运算扮演着核心角色。然而，一个普遍存在的挑战是：当一个已知的可逆矩阵仅发生微小变化时，我们能否避免从头开始进行成本高昂的求逆计算？对于高维问题，直接重新计算的 $O(n^3)$ 复杂度往往是不可接受的，尤其是在需要实时响应或处理海量数据集的场景中。谢尔曼-莫里森公式精准地解决了这一难题，为一种特殊但极为重要的“[秩一更新](@entry_id:137543)”提供了一个优雅且计算高效的捷径。

本文旨在提供一份关于谢尔曼-莫里森公式的全面指南，引领读者从理论基础走向实际应用。接下来的内容将分为三个核心章节：
- **原理与机制**：我们将深入剖析该公式的数学推导，揭示其成立的内在条件，并探讨其与[舒尔补](@entry_id:142780)、[Woodbury恒等式](@entry_id:756745)等更广阔矩阵理论的深刻联系。
- **应用与跨学科联系**：本章将展示该公式的强大威力，探索其在[数值分析](@entry_id:142637)、[优化理论](@entry_id:144639)、机器学习和计算物理等多个前沿领域中扮演的关键角色。
- **动手实践**：最后，通过一系列精心设计的练习题，您将有机会亲手应用所学知识，从而巩固理解并建立解决实际问题的能力。

通过学习本文，您不仅能掌握谢尔曼-莫里森公式本身，更能领会其作为现代计算科学基石的重要意义。

## 原理与机制

在[数值线性代数](@entry_id:144418)中，我们经常遇到一个核心问题：如果一个[可逆矩阵](@entry_id:171829) $A$ 发生了微小的变化，我们能否利用已知的关于 $A$ 的信息（例如它的逆 $A^{-1}$ 或其[矩阵分解](@entry_id:139760)）来高效地计算变化后矩阵的逆？直接从头计算新[矩阵的逆](@entry_id:140380)通常计算成本高昂，尤其是在高维空间中。Sherman-Morrison 公式为这一问题提供了一个优雅而高效的解决方案，特别适用于一种特定但非常重要的变化类型：**[秩一更新](@entry_id:137543)**（rank-one update）。

### [秩一更新](@entry_id:137543)与 Sherman-Morrison 公式

首先，我们来定义何为[秩一更新](@entry_id:137543)。给定一个 $n \times n$ 矩阵 $A$ 以及两个 $n$ 维列向量 $u$ 和 $v$，对 $A$ 的[秩一更新](@entry_id:137543)是指构造一个新矩阵 $A + uv^T$。这里的 $uv^T$ 是 $u$ 和 $v$ 的**[外积](@entry_id:147029)**（outer product），它产生一个 $n \times n$ 矩阵。这个矩阵的秩最多为 1（当且仅当 $u$ 和 $v$ 都是非零向量时，秩恰好为 1），因此被称为**[秩一矩阵](@entry_id:199014)**。这个过程的本质是向原矩阵 $A$ 叠加一个秩一的扰动。

现在，我们的核心问题是：如果 $A$ 是可逆的，那么 $A + uv^T$ 的[逆矩阵](@entry_id:140380)是什么？我们能否用 $A^{-1}$、$u$ 和 $v$ 来表达它？Sherman-Morrison 公式给出了肯定的回答。推导该公式的一种直观方法是考虑求解相关的线性方程组。

假设我们需要[求解方程组](@entry_id:152624) $(A + uv^T)x = b$，其中 $b$ 是任意给定的向量。我们的目标是找到 $x$。利用[矩阵乘法](@entry_id:156035)的[分配律](@entry_id:144084)，我们可以将方程展开：
$$ Ax + u(v^T x) = b $$
这里的关键在于观察到 $v^T x$ 是一个标量，因为它是两个向量的[内积](@entry_id:158127)。让我们用希腊字母 $\alpha$ 来表示这个标量，即 $\alpha = v^T x$。于是方程变为：
$$ Ax + \alpha u = b $$
由于 $A$ 是可逆的，我们可以用 $A^{-1}$ 左乘等式两边来解出 $x$：
$$ A^{-1}(Ax + \alpha u) = A^{-1}b $$
$$ x + \alpha A^{-1}u = A^{-1}b $$
$$ x = A^{-1}b - \alpha (A^{-1}u) $$
这个表达式给出了 $x$ 的形式，但它依赖于我们尚未确定的标量 $\alpha$。为了求出 $\alpha$，我们可以将上面 $x$ 的表达式代入 $\alpha = v^T x$ 的定义中：
$$ \alpha = v^T (A^{-1}b - \alpha A^{-1}u) = v^T A^{-1}b - \alpha (v^T A^{-1}u) $$
现在，这是一个关于 $\alpha$ 的简单[线性方程](@entry_id:151487)。我们可以整理并解出 $\alpha$：
$$ \alpha + \alpha (v^T A^{-1}u) = v^T A^{-1}b $$
$$ \alpha (1 + v^T A^{-1}u) = v^T A^{-1}b $$
如果标量项 $1 + v^T A^{-1}u \neq 0$，我们就可以安全地两边相除，得到 $\alpha$ 的显式解：
$$ \alpha = \frac{v^T A^{-1}b}{1 + v^T A^{-1}u} $$
最后，将这个 $\alpha$ 的表达式代回我们之前得到的 $x$ 的方程中：
$$ x = A^{-1}b - \left( \frac{v^T A^{-1}b}{1 + v^T A^{-1}u} \right) A^{-1}u $$
通过重新[排列](@entry_id:136432)各项，并注意到 $(A^{-1}u)(v^T A^{-1}b)$ 可以写成矩阵-向量乘积 $(A^{-1}uv^T A^{-1})b$，我们可以将 $b$ 因子提取出来：
$$ x = \left( A^{-1} - \frac{A^{-1}uv^T A^{-1}}{1 + v^T A^{-1}u} \right) b $$
由于这个关系对所有向量 $b$ 都成立，括号内的矩阵表达式必定是 $(A + uv^T)^{-1}$。这就得到了 **Sherman-Morrison 公式**：

$$ (A + uv^T)^{-1} = A^{-1} - \frac{A^{-1}uv^T A^{-1}}{1 + v^T A^{-1}u} $$

这个公式优美地揭示了，一个[可逆矩阵](@entry_id:171829)经过[秩一更新](@entry_id:137543)后的逆，等于原矩阵的逆加上一个秩一的修正项。

### [可逆性](@entry_id:143146)的临界条件

从上述推导中我们看到，Sherman-Morrison 公式的成立依赖于一个关键条件：分母 $1 + v^T A^{-1}u$ 不得为零。这个条件不仅是公式能够计算的前提，它也深刻地决定了更新后的矩阵 $A + uv^T$ 本身是否可逆。

当 $1 + v^T A^{-1}u = 0$ 时，更新后的矩阵 $A + uv^T$ 是**奇异的**（即不可逆）。我们可以通过构造一个存在于其零空间（kernel）中的非零向量来证明这一点。考虑向量 $x_0 = A^{-1}u$。由于 $A$ 可逆且通常 $u \neq 0$，所以 $x_0$ 是一个非零向量。现在，我们用 $A + uv^T$ 左乘 $x_0$：
$$ (A + uv^T)x_0 = (A + uv^T)(A^{-1}u) = A(A^{-1}u) + u v^T(A^{-1}u) = u + u(v^T A^{-1}u) $$
$$ (A + uv^T)x_0 = u(1 + v^T A^{-1}u) $$
如果 $1 + v^T A^{-1}u = 0$，那么 $(A + uv^T)x_0 = u(0) = 0$。这意味着我们找到了一个非零向量 $x_0$，使得 $(A + uv^T)x_0 = 0$。根据线性代数的基本定义，这证明了矩阵 $A + uv^T$ 是奇异的。

因此，Sherman-Morrison 公式的分母所扮演的角色远不止于一个计算上的常数；它是判断[秩一更新](@entry_id:137543)后矩阵是否保持可逆性的“试金石”。

为了使这个[临界条件](@entry_id:201918)更加具体，我们可以构造一个例子。 考虑矩阵 $$A=\begin{pmatrix} 4 & 1 & 0 \\ 1 & 4 & 1 \\ 0 & 1 & 4 \end{pmatrix}$$ 和向量 $u=\begin{pmatrix} 1 \\ 0 \\ 1 \end{pmatrix}$。如果我们精心选择向量 $v$ 为 $v = -A^T w$，其中 $w = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$，那么可逆性条件中的标量 $s = 1+v^T A^{-1}u$ 会发生什么呢？
将 $v^T = -w^T A$ 代入，我们得到：
$$ s = 1 + (-w^T A) A^{-1} u = 1 - w^T (A A^{-1}) u = 1 - w^T u $$
计算 $w^T u = \begin{pmatrix} 1 & 0 & 0 \end{pmatrix} \begin{pmatrix} 1 \\ 0 \\ 1 \end{pmatrix} = 1$。因此，$s = 1 - 1 = 0$。
在这种情况下，[可逆性](@entry_id:143146)条件被破坏。Sherman-Morrison 公式会因除以零而失效，这恰恰反映了这样一个事实：对于这个特定的 $u$ 和 $v$，矩阵 $A+uv^T$ 已经变得奇异，不再存在[逆矩阵](@entry_id:140380)。

### 更深层次的视角：[舒尔补](@entry_id:142780)（Schur Complement）

Sherman-Morrison 公式中的临界条件 $1 + v^T A^{-1}u$ 并非凭空出现，它与[分块矩阵](@entry_id:148435)理论中的一个核心概念——**[舒尔补](@entry_id:142780)**——有着深刻的联系。

考虑如下的 $(n+1) \times (n+1)$ [分块矩阵](@entry_id:148435) $M$：
$$ M = \begin{pmatrix} A & u \\ -v^T & 1 \end{pmatrix} $$
我们可以通过左乘一个特殊构造的下三角[分块矩阵](@entry_id:148435)来进行块高斯消元，以消除 $M$ 的左下角块：
$$ \begin{pmatrix} I & 0 \\ v^T A^{-1} & 1 \end{pmatrix} \begin{pmatrix} A & u \\ -v^T & 1 \end{pmatrix} = \begin{pmatrix} A & u \\ v^T A^{-1}A - v^T & v^T A^{-1}u + 1 \end{pmatrix} = \begin{pmatrix} A & u \\ 0 & 1 + v^T A^{-1}u \end{pmatrix} $$
我们得到了一个上三角[分块矩阵](@entry_id:148435)。利用[行列式](@entry_id:142978)的性质 $\det(XY) = \det(X)\det(Y)$ 以及三角[矩阵的[行列](@entry_id:148198)式](@entry_id:142978)性质，我们可以推导出：
$$ \det(M) = \det(A) (1 + v^T A^{-1}u) $$
这个关系式揭示了 $M$ 的可逆性（即 $\det(M) \neq 0$）与 $1 + v^T A^{-1}u \neq 0$ 之间的直接联系。在[分块矩阵](@entry_id:148435)理论中，标量 $1 + v^T A^{-1}u$ 正是块 $A$ 在矩阵 $M$ 中的**舒尔补**。因此，Sherman-Morrison 公式的可逆性条件，本质上等同于这个扩展[分块矩阵](@entry_id:148435) $M$ 的可逆性条件（假设 $A$ 本身可逆）。这个视角为我们理解公式的结构提供了更广阔的理论背景。

### 推广：Woodbury 矩阵恒等式

Sherman-Morrison 公式是更广泛的 **Woodbury 矩阵恒等式** 的一个特例，后者处理的是秩为 $k$ 的更新。对于形如 $A + UCV^T$ 的更新，其中 $U$ 和 $V$ 是 $n \times k$ 矩阵，$C$ 是 $k \times k$ 可逆矩阵，其逆由 Woodbury 恒等式给出：
$$ (A + UCV^T)^{-1} = A^{-1} - A^{-1}U(C^{-1} + V^T A^{-1}U)^{-1}V^T A^{-1} $$
这个公式要求 $A$ 和 $C$ 以及 $k \times k$ 的“小”矩阵 $(C^{-1} + V^T A^{-1}U)$ 都是可逆的。

当 $k=1$ 时，我们可以进行如下的特殊化来恢复 Sherman-Morrison 公式：
- 令 $U$ 为列向量 $u$。
- 令 $V$ 为列向量 $v$（因此 $V^T$ 是行向量 $v^T$）。
- 令 $C$ 为 $1 \times 1$ 矩阵，即标量 $1$。

在这种情况下，$UCV^T$ 就变成了 $u(1)v^T = uv^T$。而 Woodbury 公式中需要求逆的 $k \times k$ 矩阵 $(C^{-1} + V^T A^{-1}U)$ 变成了一个标量 $(1 + v^T A^{-1}u)$。它的逆就是简单的倒数。代入这些，Woodbury 恒等式就精确地退化为 Sherman-Morrison 公式。 

### [计算效率](@entry_id:270255)与实际应用

Sherman-Morrison 公式的真正威力在于其计算效率，特别是在[求解线性方程组](@entry_id:169069)时。假设我们已经知道了关于 $A$ 的信息（例如它的逆 $A^{-1}$ 或其 LU 分解），现在需要求解 $(A + uv^T)x = b$。

一个直接但低效的方法是：首先计算 $n \times n$ 矩阵 $B = A + uv^T$，然后从头求解 $Bx=b$，例如通过计算 $B$ 的 LU 分解。形成 $B$ 就需要 $O(n^2)$ 次运算，而对其进行 LU 分解则需要 $O(n^3)$ 次运算。

相比之下，利用 Sherman-Morrison 公式可以设计出更高效的算法。我们并不需要显式地计算 $(A+uv^T)^{-1}$ 这个 $n \times n$ 矩阵。相反，我们利用之[前推](@entry_id:158718)导出的解的结构：
$$ x = A^{-1}b - \frac{v^T A^{-1}b}{1 + v^T A^{-1}u} (A^{-1}u) $$
这个表达式给出了一个高效的计算步骤：
1. 计算向量 $y = A^{-1}b$。
2. 计算向量 $z = A^{-1}u$。
3. 计算标量 $\alpha = v^T z$。
4. 计算标量 $\beta = v^T y$。
5. 计算最终解 $x = y - \frac{\beta}{1+\alpha} z$。

让我们分析其计算成本。
- **场景1：已知 $A^{-1}$**
  - 步骤1和2是矩阵-向量乘法，每个需要 $O(n^2)$ 次[浮点运算](@entry_id:749454)（flops）。
  - 步骤3和4是向量[内积](@entry_id:158127)，每个需要 $O(n)$ flops。
  - 步骤5是向量的[数乘](@entry_id:155971)和减法，需要 $O(n)$ flops。
  - 总成本主要由矩阵-向量乘法决定，为 $O(n^2)$。
- **场景2：已知 $A$ 的 LU 分解**
  - 步骤1和2通过前向替换和后向替换求解线性方程组，每个需要 $O(n^2)$ flops。
  - 其余步骤相同。
  - 总成本仍然是 $O(n^2)$。

在这两种场景下，总计算成本都是 $O(n^2)$，远低于从头计算所需的 $O(n^3)$。当 $n$很大时，这种效率提升是巨大的，使得 Sherman-Morrison 公式在[迭代算法](@entry_id:160288)、信号处理和机器学习等领域中成为一种不可或缺的工具。

### [数值稳定性](@entry_id:146550)与实现考量

虽然 Sherman-Morrison 公式在代数上非常强大，但在有限精度的浮点数运算中，我们必须仔细考虑其**数值稳定性**。

一个主要的顾虑是分母 $1 + v^T A^{-1}u$。如果这个值在计算中非常接近于零，那么即使它在精确算术中不为零，除法操作也会放大[舍入误差](@entry_id:162651)，导致结果的数值不稳定。这种情况通常表明更新后的矩阵 $A+uv^T$ 是**病态的**（ill-conditioned），即其[条件数](@entry_id:145150)非常大。在这种情况下，直接重新计算新矩阵的稳定分解（如带主元选择的 LU 分解）可能是更稳妥的选择。

然而，在某些重要的特殊情况下，这种不稳定性是可以避免的。例如，当 $A$ 是**对称正定**（Symmetric Positive Definite, SPD）矩阵，并且更新也是对称的（即 $v=u$），形成 $A+uu^T$ 时，分母变为 $1 + u^T A^{-1}u$。由于 $A$ 是 SPD，其逆 $A^{-1}$ 也是 SPD。因此，对于任何非零向量 $u$，$u^T A^{-1}u > 0$。这意味着分母 $1 + u^T A^{-1}u$ 总是大于 $1$，从而完全避免了除以一个接近零的数的风险。

尽管如此，数值分析的一个普遍原则是**避免显式地计算和存储逆矩阵**。反复应用 Sherman-Morrison 公式来更新一个显式存储的[逆矩阵](@entry_id:140380)，会让舍入误差不断累积，通常是一个数值不安全的操作。更稳健的实践是：
1.  **算子形式（Operator Form）**：如前一节所分析的，将公式仅用作求解线性方程组的一种方法，其中每次应用 $A^{-1}$ 都通过基于 $A$ 的稳定分解（如 LU 或 Cholesky）的求解器来完成。
2.  **更新分解（Factorization Update）**：直接更新矩阵 $A$ 的分解。例如，对于 SPD 矩阵 $A=LL^T$ 的更新 $A+uu^T$，存在 $O(n^2)$ 的算法可以直接计算出更新后的 Cholesky 因子 $\widehat{L}$，使得 $\widehat{L}\widehat{L}^T = A+uu^T$。这种方法在数值上非常稳健，并且能保持矩阵的[对称正定](@entry_id:145886)性。

对于需要用同一个更新后的矩阵求解多个[线性方程组](@entry_id:148943)的情况，一次性地计算出更新后的分解（如 $\widehat{L}$）然后重复使用它，通常比每次都使用算子形式的 Sherman-Morrison 公式更高效、更稳健。

在[高性能计算](@entry_id:169980)环境中，这些 $O(n^2)$ 的操作通常受限于内存带宽。为了获得极致性能，可以通过**批处理**（batching）多个[秩一更新](@entry_id:137543)，利用 Woodbury 恒等式将计算升级为计算密集型的 BLAS-3 操作（矩阵-矩阵乘法），从而更好地利用现代 CPU 的[缓存层次结构](@entry_id:747056)。此外，注意数据在内存中的布局（例如，[列主序](@entry_id:637645)存储）和在 NUMA 架构上的亲和性，对于降低[内存延迟](@entry_id:751862)和最大化计算[吞吐量](@entry_id:271802)至关重要。