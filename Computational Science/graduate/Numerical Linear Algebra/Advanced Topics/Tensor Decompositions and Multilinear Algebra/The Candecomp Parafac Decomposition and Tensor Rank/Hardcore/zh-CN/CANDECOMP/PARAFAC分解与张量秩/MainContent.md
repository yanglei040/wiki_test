## 引言
在数据科学和工程领域，我们面临的数据日益呈现出多维、多模态的结构，传统的[矩阵分析](@entry_id:204325)方法已不足以揭示其内在的复杂关联。张量，作为高阶的向量和矩阵，为表示和分析这类[多维数据](@entry_id:189051)提供了自然的框架。在众多[张量分解](@entry_id:173366)技术中，规范多元/[平行因子分析](@entry_id:753095)（CANDECOMP/[PARAFAC](@entry_id:753095), CP）分解因其模型的简洁性和结果的深刻可解释性而占据核心地位。

然而，从熟悉的矩阵世界过渡到张量领域并非一帆风顺。[张量秩](@entry_id:266558)的概念远比[矩阵秩](@entry_id:153017)复杂，其计算和性质充满了违反直觉的挑战，这构成了理解和有效应用[CP分解](@entry_id:203488)的主要障碍。

本文旨在系统性地扫清这些障碍。我们将从**第一章：原理与机制**出发，深入剖析[CP分解](@entry_id:203488)的数学定义、唯一性条件以及[张量秩](@entry_id:266558)的微妙特性。随后，在**第二章：应用与交叉学科联系**中，我们将展示这些理论如何在信号处理、化学计量学和机器学习等领域转化为解决实际问题的强大工具。最后，通过**第三章：动手实践**中的精选问题，您将有机会亲手应用所学知识，巩固对核心概念的理解。

通过这趟从理论到应用的旅程，您将建立起对[CP分解](@entry_id:203488)和[张量秩](@entry_id:266558)的坚实理解，为驾驭高维数据分析做好准备。

## 原理与机制

本章深入探讨规范多元分解/[平行因子分析](@entry_id:753095)（CANDECOMP/[PARAFAC](@entry_id:753095), CP）分解的核心原理。我们将从其基本定义出发，探索[张量秩](@entry_id:266558)这一核心概念的多个方面，并将其与更为人所熟知的[矩阵秩](@entry_id:153017)进行对比。随后，我们将阐明保证 CP 分解唯一性的条件，这对于模型的[可解释性](@entry_id:637759)至关重要。最后，我们将揭示[张量秩](@entry_id:266558)所固有的微妙且违反直觉的特性，例如[退化现象](@entry_id:183258)、边界秩，以及秩对底层数学域（实数域与复数域）的依赖性。

### 规范多元（CP）分解

#### 定义与元素级表示

CP 分解将一个[高阶张量](@entry_id:200122)表示为若干个**秩-1 张量** (rank-1 tensors) 的和。一个 $N$ 阶秩-1 张量是 $N$ 个向量的[外积](@entry_id:147029)。对于一个 $N$ 阶张量 $\mathcal{X} \in \mathbb{R}^{I_1 \times \cdots \times I_N}$，其 CP 分解形式如下：
$$
\mathcal{X} = \sum_{r=1}^{R} a_r^{(1)} \otimes a_r^{(2)} \otimes \cdots \otimes a_r^{(N)}
$$
其中 $R$ 是分解的项数，也是张量的**CP 秩**。对于每一个分量 $r \in \{1, \dots, R\}$，向量 $a_r^{(n)} \in \mathbb{R}^{I_n}$ 属于第 $n$ 个模态。符号 $\otimes$ 代表向量外积。

为了便于操作和分析，我们通常将每个模态的向量集合组成一个**因子矩阵** (factor matrix)。对于第 $n$ 个模态，其因子矩阵 $A^{(n)} \in \mathbb{R}^{I_n \times R}$ 的列是向量 $a_1^{(n)}, \dots, a_R^{(n)}$：
$$
A^{(n)} = \begin{pmatrix} a_1^{(n)}  a_2^{(n)}  \cdots  a_R^{(n)} \end{pmatrix}
$$
基于这些定义，我们可以推导出张量 $\mathcal{X}$ 中任意一个元素的表达式。根据张量加法和外积的定义，位于索引 $(i_1, i_2, \dots, i_N)$ 处的元素 $(\mathcal{X})_{i_1, \dots, i_N}$ 可以表示为各个秩-1 分量对应元素的和。而每个秩-1 分量 $(\mathcal{T}_r)_{i_1, \dots, i_N} = (a_r^{(1)} \otimes \cdots \otimes a_r^{(N)})_{i_1, \dots, i_N}$ 的元素是其构成向量对应元素的乘积。因此，我们可以得到如下的元素级表达式 ：
$$
(\mathcal{X})_{i_1, \dots, i_N} = \sum_{r=1}^{R} \left( \prod_{n=1}^{N} (a_r^{(n)})_{i_n} \right)
$$
注意到向量元素 $(a_r^{(n)})_{i_n}$ 正是因子矩阵 $A^{(n)}$ 中第 $i_n$ 行、第 $r$ 列的元素，记作 $(A^{(n)})_{i_n, r}$。于是，上述公式可以写成因子[矩阵元](@entry_id:186505)素的形式：
$$
(\mathcal{X})_{i_1, \dots, i_N} = \sum_{r=1}^{R} \prod_{n=1}^{N} (A^{(n)})_{i_n, r}
$$
这个公式是 CP 模型的核心，它将高维张量的元素与一系列因子矩阵的元素联系起来。

#### [矩阵化](@entry_id:751739)形式与 Khatri-Rao 积

尽管元素级表示法很精确，但在算法推导和理论分析中，将张量操作转化为我们熟悉的矩阵运算往往更为方便。这通过**[张量展开](@entry_id:755868)**（或称[矩阵化](@entry_id:751739)）得以实现。张量的**模态-$n$ 展开** (mode-$n$ unfolding)，记作 $X_{(n)}$，是将张量 $\mathcal{X}$ 重新[排列](@entry_id:136432)成一个矩阵，其行由第 $n$ 模态的索引 $i_n$ 决定，列则由所有其他模态的索引组合而成。具体来说，$X_{(n)}$ 的每一列都是一个**模态-$n$ 纤维**，即固定除 $i_n$ 外所有索引而得到的向量。

为了简洁地表示 CP 分解的[矩阵化](@entry_id:751739)形式，我们需要引入 **Khatri-Rao 积** (Khatri-Rao product)，它是一种特殊的矩阵乘法，通常用符号 $\odot$ 表示。对于两个具有相同列数的矩阵 $A \in \mathbb{R}^{I \times R}$ 和 $B \in \mathbb{R}^{J \times R}$，它们的 Khatri-Rao 积 $A \odot B \in \mathbb{R}^{(IJ) \times R}$ 是通过逐列计算克罗内克积 (Kronecker product) 得到的：
$$
(A \odot B)_{:,r} = A_{:,r} \otimes B_{:,r}
$$
这个定义可以推广到多个矩阵的连乘。

有了这些工具，CP 分解的模态-$n$ 展开可以表示为一个优雅的矩阵乘积。假设张量 $\mathcal{X}$ 的 CP 分解由因子矩阵 $A^{(1)}, \dots, A^{(N)}$ 给出，其模态-$n$ 展开 $X_{(n)}$ 可以表示为 ：
$$
X_{(n)} = A^{(n)} \left( A^{(N)} \odot \cdots \odot A^{(n+1)} \odot A^{(n-1)} \odot \cdots \odot A^{(1)} \right)^{\top}
$$
这个恒等式是许多 CP 分解计算算法（如[交替最小二乘法](@entry_id:746387)）的理论基础。它清晰地表明，展开矩阵 $X_{(n)}$ 的[列空间](@entry_id:156444)受限于因子矩阵 $A^{(n)}$ 的列空间。需要注意的是，Khatri-Rao 积中矩阵的顺序取决于展开时列索引的[排列](@entry_id:136432)约定。上述公式对应于一个常见的约定，即索引 $(i_N, \dots, i_{n+1}, i_{n-1}, \dots, i_1)$ 按字典序[排列](@entry_id:136432)，其中最右侧的索引 $i_1$ 变化最快。

### [张量秩](@entry_id:266558)的概念

#### CP 秩与[矩阵秩](@entry_id:153017)的辨析

**CP 秩**，或简称**[张量秩](@entry_id:266558)**，被定义为表示一个张量所需的最少秩-1 分量的数量 $R$。这是对[矩阵秩](@entry_id:153017)概念最直接的推广。然而，这种推广带来了巨大的复杂性。计算[张量秩](@entry_id:266558)是一个 NP-hard 问题，而且其性质也远比[矩阵秩](@entry_id:153017)更为复杂。

一个常见的误区是试图通过将[张量展开](@entry_id:755868)为矩阵，然后计算该[矩阵的秩](@entry_id:155507)来确定[张量秩](@entry_id:266558)。然而，这种方法是行不通的。一个张量的不同模态展开矩阵的秩通常是不同的，并且它们都只是张量 CP 秩的一个**下界**。

更深层次的问题在于，即便是对张量的展开矩阵进行精确的低秩[矩阵分解](@entry_id:139760)，也无法恢复出原张量的 CP 分解结构。考虑一个三阶张量 $\mathcal{X}$ 的模态-1 展开 $X_{(1)} = A (C \odot B)^{\top}$。如果我们忽略其张量结构，仅仅将其看作一个矩阵，并试图求解一个秩-$R$ 的[矩阵分解](@entry_id:139760)问题 $\min_{\widehat{A}, M} \| X_{(1)} - \widehat{A} M^{\top} \|_F$，我们将会丢失关键信息。

对于一个秩为 $R$ 的矩阵，其低秩分解存在固有的模糊性。任何满足 $X_{(1)} = \widehat{A} M^{\top}$ 的解 $(\widehat{A}, M)$，对于任意一个可逆矩阵 $Q \in \mathrm{GL}(R)$（$R \times R$ [可逆矩阵](@entry_id:171829)群），$(\widehat{A}Q, M Q^{-\top})$ 都是一个等价的解。然而，CP 分[解的唯一性](@entry_id:143619)（将在后续讨论）要严格得多，其模糊性通常仅限于对各分量进行[置换](@entry_id:136432)和缩放。

当我们将矩阵分解的解 $M$ 与 CP 结构中的 $(C \odot B)$ 对应起来时，问题就显现了。一般而言，对于一个泛型的[可逆矩阵](@entry_id:171829) $Q$，矩阵 $M = (C \odot B) Q^{-\top}$ 的列不再是两个向量的[克罗内克积](@entry_id:182766)。这意味着 $M$ 无法被分解回一个新的 Khatri-Rao 积 $\widetilde{C} \odot \widetilde{B}$ 的形式。只有当 $Q$ 是一个[置换矩阵](@entry_id:136841)和一个可逆对角矩阵的乘积时，这种结构才能得以保持。因此，单纯的[矩阵分解](@entry_id:139760)方法引入了额外的 $R^2 - R$ 个自由度（对应于 $\mathrm{GL}(R)$ 的维数 $R^2$ 减去对角矩阵群的维数 $R$），从而破坏了 CP 模型宝贵的可识别性 。

#### 多线性秩

为了更全面地描述张量的“秩”，学术界引入了另一个概念：**多线性秩** (multilinear rank)。一个 $N$ 阶张量 $\mathcal{X}$ 的多线性秩是一个包含 $N$ 个元素的元组 $(r_1, r_2, \dots, r_N)$，其中 $r_n$ 定义为模态-$n$ 展开[矩阵的秩](@entry_id:155507)，即 $r_n = \operatorname{rank}(X_{(n)})$。

多线性秩与另一种重要的[张量分解](@entry_id:173366)——[塔克分解](@entry_id:182831) (Tucker decomposition) 紧密相关。[塔克分解](@entry_id:182831)将张量 $\mathcal{X}$ 表示为一个[核心张量](@entry_id:747891) $\mathcal{G}$ 与一系列因子矩阵 $U^{(n)}$ 的多线性乘积。多线性秩 $(r_1, \dots, r_N)$ 恰好是能够精确表示 $\mathcal{X}$ 的最小[核心张量](@entry_id:747891) $\mathcal{G} \in \mathbb{R}^{r_1 \times \cdots \times r_N}$ 的维度 。

#### CP 秩与多线性秩的关系

CP 秩和多线性秩是两种不同的度量，但它们之间存在一定的关系。

首先，对于最简单的秩-1 张量，两者的关系非常明确。一个张量的 **CP 秩为 1 的充分必要条件是其多线性秩为 $(1, 1, \dots, 1)$** 。这意味着，如果一个张量是秩-1 的，那么它沿所有模态的展开矩阵都必须是秩-1 的。反之，如果一个张量沿所有模态的展开都是秩-1 的，那么它也必然是秩-1 的。

然而，需要特别注意的是，仅仅存在**某一个**模态的展开[矩阵秩](@entry_id:153017)为 1，并不能保证该张量的 CP 秩为 1。例如，考虑一个三阶张量 $\mathcal{X} = a_1 \otimes b \otimes c_1 + a_2 \otimes b \otimes c_2$，其中 $a_1, a_2$ [线性无关](@entry_id:148207)，$b$ 非零，且 $c_1, c_2$ 线性无关。它的模态-2 展开 $X_{(2)}$ 的秩为 1，因为其所有列向量都是 $b$ 的倍数。但是，由于 $a$ 和 $c$ 两个模态上的向量是[线性无关](@entry_id:148207)的，其模态-1 和模态-3 展开的秩均为 2。该张量的多线性秩为 $(2, 1, 2)$，CP 秩为 2，而非 1 。

对于一般情况，CP 秩 $R$ 和多线性秩 $(r_1, \dots, r_N)$ 之间存在如下的不等式关系 ：
$$
\max_{n} r_n \le R \le \prod_{n=1}^{N} r_n
$$
左边的下界表明，CP 秩至少不小于任何一个模态展开[矩阵的秩](@entry_id:155507)。这个下界在很多情况下是成立的，但并非总是如此。一个显著的例子是，一个泛型的 $3 \times 3 \times 3$ 复数张量的 CP 秩为 5，而其所有模态展开[矩阵的秩](@entry_id:155507)最大只能是 3。这揭示了[张量秩](@entry_id:266558)的一个深刻特性：**CP 秩可以严格大于所有模态展开[矩阵秩](@entry_id:153017)的最大值** 。

### CP 分[解的唯一性](@entry_id:143619)

CP 分解最吸引人的特性之一是其**唯一性**。与矩阵分解不同，在相当宽松的条件下，张量的 CP 分解是唯一的（在不影响整体求和结果的[置换](@entry_id:136432)和缩放模糊性之外）。这种唯一性使得 CP 分解在信号处理、[化学计量学](@entry_id:140916)和神经科学等领域成为一种强大的工具，因为它允许我们有意义地解释分解出的因子。

#### Kruskal 定理

关于 CP 分解唯一性的最著名的结果是 **Kruskal 定理**。该定理为三阶张量的唯一性提供了一个充分条件。为了陈述该定理，我们需要引入**k-秩** (k-rank) 的概念。一个矩阵 $A$ 的 k-秩，记作 $k(A)$，是指使得 $A$ 中**任意** $k$ 个列向量都线性无关的最大整数 $k$ 。注意，k-秩是一个比常规[矩阵秩](@entry_id:153017) $\operatorname{rank}(A)$ 更强的条件，满足 $k(A) \le \operatorname{rank}(A)$。

Kruskal 定理（针对三阶张量）指出，如果一个秩为 $R$ 的 CP 分解的三个因子矩阵 $A, B, C$ 的 k-秩之和满足以下条件：
$$
k(A) + k(B) + k(C) \ge 2R + 2
$$
那么该 CP 分解是**本质唯一**的。本质唯一性意味着，任何其他能够表示同一[张量的秩](@entry_id:204291)-$R$ 分解，其因子都必然是原始因子的一个[置换](@entry_id:136432)，并且每个分量内的向量存在缩放（例如，$(a_r, b_r, c_r)$ 变为 $(\alpha a_r, \beta b_r, \gamma c_r)$，其中 $\alpha\beta\gamma=1$）。

#### 应用示例

让我们通过一个具体的例子来说明 Kruskal 定理的应用。考虑一个由以下因子矩阵定义的秩 $R=2$ 的三阶张量 $\mathcal{X} \in \mathbb{R}^{3 \times 3 \times 2}$ ：
$$
A = \begin{pmatrix} 1  0 \\ 0  1 \\ 1  1 \end{pmatrix}, \quad B = \begin{pmatrix} 1  1 \\ 1  0 \\ 0  1 \end{pmatrix}, \quad C = \begin{pmatrix} 1  1 \\ 0  1 \end{pmatrix}
$$
为了检验唯一性，我们首先计算每个因子矩阵的 k-秩。
-   对于矩阵 $A$，它有两个列向量 $(1,0,1)^\top$ 和 $(0,1,1)^\top$。这两个向量是线性无关的。由于矩阵只有两列，任意 2 列（即所有列）组成的集合都是[线性无关](@entry_id:148207)的。因此，$k(A)=2$。
-   同理，矩阵 $B$ 的两列 $(1,1,0)^\top$ 和 $(1,0,1)^\top$ 是[线性无关](@entry_id:148207)的，所以 $k(B)=2$。
-   矩阵 $C$ 的两列 $(1,0)^\top$ 和 $(1,1)^\top$ 也是线性无关的，所以 $k(C)=2$。

现在，我们来验证 Kruskal 条件：
$$
k(A) + k(B) + k(C) = 2 + 2 + 2 = 6
$$
而条件要求的下界是：
$$
2R + 2 = 2(2) + 2 = 6
$$
由于 $6 \ge 6$，Kruskal 条件得到满足。因此，这个秩为 2 的张量的 CP 分解是本质唯一的。

### [张量秩](@entry_id:266558)的微妙之处与病态性质

[张量秩](@entry_id:266558)的行为常常与我们从[矩阵分析](@entry_id:204325)中获得的直觉相悖。本节将探讨其中两个最重要且最微妙的方面：边界秩与退化，以及秩对数学域的依赖性。

#### 边界秩与退化

在矩阵的世界里，秩为 $R$ 的矩阵集合在拓扑上是一个**[闭集](@entry_id:136446)**。这意味着，一列秩为 $R$ 的矩阵如果收敛，其极限点的秩必然小于或等于 $R$。然而，对于张量而言，**秩为 $R$ 的张量集合不是[闭集](@entry_id:136446)**。

这个事实引出了**边界秩** (border rank) 的概念。一个张量 $\mathcal{X}$ 的边界秩，记作 $\underline{\operatorname{rank}}(\mathcal{X})$，是指 $\mathcal{X}$ 可以被一系列秩至多为 $R$ 的张量逼近的最小整数 $R$ 。换句话说，$\underline{\operatorname{rank}}(\mathcal{X}) = R$ 意味着 $\mathcal{X}$ 位于所有秩不超过 $R$ 的张量构成的集合的拓扑闭包中。

由于秩-$R$ 集合不是[闭集](@entry_id:136446)，一个张量的 CP 秩可能严格大于其边界秩。这种现象的背后机制被称为**退化** (degeneracy)。退化指的是存在一个张量序列 $\{\mathcal{X}^{(n)}\}$，其中每个 $\mathcal{X}^{(n)}$ 的 CP 秩都小于等于 $R$，且该[序列收敛](@entry_id:143579)到一个极限张量 $\mathcal{X}^\star$。然而，在逼近过程中，用于构造 $\mathcal{X}^{(n)}$ 的 CP 分解的因子范数却趋向于无穷大。

一个经典的例子可以清晰地说明这一点。考虑如下张量：
$$
\mathcal{X} = e_2 \otimes e_1 \otimes e_1 + e_1 \otimes e_2 \otimes e_1 + e_1 \otimes e_1 \otimes e_2
$$
可以证明，这个张量的 CP 秩为 3。但是，我们可以构造一个参数为 $\varepsilon$ 的张量序列 $\mathcal{X}_{\varepsilon}$，其中每个[张量的秩](@entry_id:204291)都为 2：
$$
\mathcal{X}_{\varepsilon} = \frac{1}{\varepsilon} \left( (e_1 + \epsilon e_2) \otimes (e_1 + \epsilon e_2) \otimes (e_1 + \epsilon e_2) - e_1 \otimes e_1 \otimes e_1 \right)
$$
当 $\varepsilon \to 0$ 时，我们有 $\mathcal{X}_{\varepsilon} \to \mathcal{X}$。在极限过程中，分解中的某些因子范数会像 $1/\varepsilon$ 一样发散，但它们的无穷大部分恰好相互抵消，使得最终的和收敛到一个有限的张量。由于 $\mathcal{X}$ 可以被一系列秩为 2 的张量任意逼近，它的边界秩为 2。因此，我们得到了一个 $\underline{\operatorname{rank}}(\mathcal{X}) = 2$ 但 $\operatorname{rank}(\mathcal{X}) = 3$ 的例子。

这种秩与边界秩的分离现象有一个重要的实践后果：**最佳低秩近似问题可能无解**。对于上述张量 $\mathcal{X}$，我们试图寻找一个秩不超过 2 的张量 $Y$ 来最小化 $\|\mathcal{X} - Y\|_F$。由于 $\mathcal{X}$ 的边界秩为 2，它本身就是秩-2 张量[集合的极限点](@entry_id:137099)，这意味着这个最小距离（[下确界](@entry_id:140118)）为 0。然而，由于 $\mathcal{X}$ 本身的秩为 3，它不属于秩-2 张量的集合。因此，不存在任何一个秩为 2 的张量 $Y$ 能够使得 $\|\mathcal{X} - Y\|_F = 0$。这个最小值 0 无法达到，意味着最佳秩-2 近似不存在  。

#### 域依赖性与典型秩

[张量秩](@entry_id:266558)的另一个微妙之处在于它对底层数学域（通常是实数域 $\mathbb{R}$ 或复数域 $\mathbb{C}$）的依赖性。同一个张量，当被看作是实数张量或复数张量时，其秩可能会有所不同。

为了更好地描述在特定空间中“通常”会遇到的秩，我们引入**典型秩** (typical rank) 的概念。一个整数 $r$ 被称为在张量空间 $\mathbb{F}^{I_1 \times \cdots \times I_N}$ 上的一个典型秩，如果秩为 $r$ 的张量集合包含该空间中的一个非空开集（在标准的欧几里得拓扑下）。

-   在**复数域** $\mathbb{C}$（一个[代数闭域](@entry_id:151836)）上，情况相对简单。对于给定的张量维度，通常存在一个唯一的典型秩，称为**泛型秩** (generic rank)。这个秩在整个张量空间的一个稠密的开[子集](@entry_id:261956)上成立。对于 $2 \times 2 \times 2$ 的复数张量，泛型秩为 2。

-   在**实数域** $\mathbb{R}$ 上，情况则更为复杂。一个在复数域中不可约的代数簇在实数域中可能分解成多个连通分支。对于 $2 \times 2 \times 2$ 的实数张量，存在**两个**典型秩：2 和 3。这两个秩的区域由一个称为**[凯莱超行列式](@entry_id:201076)** (Cayley's hyperdeterminant) 的四次多项式 $\mathrm{Det}(\mathcal{X})$ 的符号所决定：
    -   如果 $\mathrm{Det}(\mathcal{X}) > 0$，则张量的实数秩为 2。
    -   如果 $\mathrm{Det}(\mathcal{X}) < 0$，则张量的实数秩为 3。
    -   如果 $\mathrm{Det}(\mathcal{X}) = 0$，则张量位于这两个区域的边界上，其秩可能是 1, 2 或 3。

由于满足 $\mathrm{Det}(\mathcal{X}) > 0$ 和 $\mathrm{Det}(\mathcal{X}) < 0$ 的张量集合都是非空开集，因此在 $\mathbb{R}^{2 \times 2 \times 2}$ 空间中，2 和 3 都是典型秩 。这一现象凸显了从矩阵到张量的过渡中出现的深刻结构性差异，并强调了在进行[张量分析](@entry_id:161423)时考虑底层数学域的重要性。