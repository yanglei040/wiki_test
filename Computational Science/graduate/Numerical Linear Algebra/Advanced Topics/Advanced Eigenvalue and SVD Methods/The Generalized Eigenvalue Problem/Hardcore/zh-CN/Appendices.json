{
    "hands_on_practices": [
        {
            "introduction": "广义特征值问题的核心，是理解矩阵束$A - \\lambda B$的内在结构。Weierstrass范式为此提供了一个完整而深刻的视角，它能够揭示所有谱信息，包括有限与无限特征值的结构。通过为一个具体矩阵束构建其Weierstrass范式，我们得以将抽象理论付诸实践，练习识别缺陷特征值、计算Jordan链，并理解无限特征值的本质。这项练习是深入分析广义特征值问题的基石。",
            "id": "3587871",
            "problem": "设 $A,B \\in \\mathbb{C}^{3\\times 3}$ 为广义特征值问题 $A x = \\lambda B x$ 定义了一个正则矩阵束 $A - \\lambda B$。仅从广义特征值、Jordan 链和 Weierstrass 范式的核心定义出发，分析以下具体矩阵对\n$$\nA \\;=\\; \\begin{pmatrix}\n2  1  0 \\\\\n0  2  0 \\\\\n0  0  1\n\\end{pmatrix},\n\\qquad\nB \\;=\\; \\begin{pmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  0\n\\end{pmatrix}.\n$$\n你的任务是：\n- 从基本定义出发，验证矩阵束 $A - \\lambda B$ 是正则的，并同时具有一个有限亏损特征值和一个无穷大特征值。\n- 通过显式地确定有限 Jordan 块和与无穷大特征值相关的幂零块，以及实现此范式的可逆变换，来确定该矩阵束的完整 Weierstrass 范式。\n- 确定并证明有限特征值的每个 Jordan 链的大小以及无穷部分的幂零指数。\n\n作为最后的计算，以不定元 $\\lambda$ 的单一封闭形式表达式，给出该矩阵束在其 Weierstrass 范式下有限部分的首一特征多项式。",
            "solution": "该问题要求对特定 $3 \\times 3$ 矩阵的广义特征值问题 $A x = \\lambda B x$ 进行详细分析\n$$\nA \\;=\\; \\begin{pmatrix}\n2  1  0 \\\\\n0  2  0 \\\\\n0  0  1\n\\end{pmatrix},\n\\qquad\nB \\;=\\; \\begin{pmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  0\n\\end{pmatrix}.\n$$\n分析将从基本原理出发，首先验证矩阵束的正则性及其特征值的性质。\n\n首先，我们验证矩阵束 $A - \\lambda B$ 是正则的。如果对于所有 $\\lambda \\in \\mathbb{C}$，$A - \\lambda B$ 的行列式不恒为零，则该矩阵束是正则的。我们构造矩阵 $A - \\lambda B$：\n$$\nA - \\lambda B = \\begin{pmatrix}\n2  1  0 \\\\\n0  2  0 \\\\\n0  0  1\n\\end{pmatrix} - \\lambda \\begin{pmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  0\n\\end{pmatrix} = \\begin{pmatrix}\n2 - \\lambda  1  0 \\\\\n0  2 - \\lambda  0 \\\\\n0  0  1\n\\end{pmatrix}.\n$$\n其行列式为\n$$\n\\det(A - \\lambda B) = (2 - \\lambda) \\det \\begin{pmatrix} 2 - \\lambda  0 \\\\ 0  1 \\end{pmatrix} - (1) \\det \\begin{pmatrix} 0  0 \\\\ 0  1 \\end{pmatrix} + 0 = (2 - \\lambda)(2 - \\lambda - 0) = (2 - \\lambda)^2.\n$$\n由于 $p(\\lambda) = \\det(A - \\lambda B) = (2 - \\lambda)^2$ 是一个非零多项式，因此矩阵束 $A - \\lambda B$ 是正则的。\n\n有限特征值是 $p(\\lambda) = 0$ 的根。令 $(2 - \\lambda)^2 = 0$ 得到一个唯一的有限特征值 $\\lambda_1 = 2$，其代数重数为 2。为了确定该特征值是否亏损，我们求其几何重数，即 $A - \\lambda_1 B$ 的零空间维数。\n对于 $\\lambda_1 = 2$，我们有\n$$\nA - 2B = \\begin{pmatrix}\n0  1  0 \\\\\n0  0  0 \\\\\n0  0  1\n\\end{pmatrix}.\n$$\n通过解 $(A - 2B)x = 0$ 来找到零空间：\n$$\n\\begin{pmatrix}\n0  1  0 \\\\\n0  0  0 \\\\\n0  0  1\n\\end{pmatrix} \\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} \\implies \\begin{cases} x_2 = 0 \\\\ x_3 = 0 \\end{cases}.\n$$\n解的形式为 $x = \\begin{pmatrix} x_1 \\\\ 0 \\\\ 0 \\end{pmatrix} = x_1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。零空间 $\\ker(A-2B)$ 由向量 $\\begin{pmatrix} 1  0  0 \\end{pmatrix}^T$ 张成。因此，$\\lambda_1 = 2$ 的几何重数为 $\\dim(\\ker(A-2B)) = 1$。由于几何重数（1）小于代数重数（2），有限特征值 $\\lambda_1 = 2$ 是亏损的。\n\n如果矩阵 $B$ 是奇异的，则存在无穷大特征值。我们计算其行列式：\n$$\n\\det(B) = \\det \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix} = 0.\n$$\n由于 $\\det(B) = 0$，存在一个无穷大特征值。无穷大特征值的代数重数由 $n - \\deg(p(\\lambda))$ 给出，其中 $n=3$ 是矩阵维数，$\\deg(p(\\lambda))=2$。所以，代数重数为 $3 - 2 = 1$。无穷大特征值的几何重数为 $\\dim(\\ker(B))$。\n$$\nB x = 0 \\implies \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} \\implies \\begin{cases} x_1 = 0 \\\\ x_2 = 0 \\end{cases}.\n$$\n零空间 $\\ker(B)$ 由 $\\begin{pmatrix} 0  0  1 \\end{pmatrix}^T$ 张成，所以其维数为 1。由于代数重数和几何重数都为 1，无穷大特征值不是亏损的。\n\n接下来，我们确定该矩阵束的 Weierstrass 范式 (WCF)。正则矩阵束 $A - \\lambda B$ 的 WCF 由两个块对角矩阵 $P A Q$ 和 $P B Q$ 组成，其中 $P$ 和 $Q$ 是某些可逆矩阵。其形式为 $P A Q = \\begin{pmatrix} J  0 \\\\ 0  I \\end{pmatrix}$ 和 $P B Q = \\begin{pmatrix} I  0 \\\\ 0  N \\end{pmatrix}$，其中 $J$ 包含有限特征值的 Jordan 块，而 $N$ 包含无穷大特征值的幂零块。\n我们的分析表明：\n- 一个大小为 $2 \\times 2$ 的有限部分，对应于亏损特征值 $\\lambda=2$。这必定是一个单一的 Jordan 块 $J_2(2)$。\n- 一个大小为 $1 \\times 1$ 的无穷部分。这对应于一个非亏损的无穷大特征值，所以幂零块是 $N_1 = (0)$。\n\n因此，范式结构由 $J = J_2(2) = \\begin{pmatrix} 2  1 \\\\ 0  2 \\end{pmatrix}$ 和 $N = (0)$ 给出。完整的范式矩阵为：\n$$\nA' = \\begin{pmatrix} J  0 \\\\ 0  I_1 \\end{pmatrix} = \\begin{pmatrix} 2  1  0 \\\\ 0  2  0 \\\\ 0  0  1 \\end{pmatrix}, \\qquad B' = \\begin{pmatrix} I_2  0 \\\\ 0  N \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix}.\n$$\n我们观察到 $A' = A$ 和 $B' = B$。给定的矩阵已经处于 Weierstrass 范式。这意味着变换矩阵可以选择为单位矩阵，即 $P = I$ 和 $Q = I$。\n\n为了证实这一点，我们必须确定构成 $Q$ 的列的 Jordan 链。\n对于有限特征值 $\\lambda=2$，我们需要一个长度为 2 的 Jordan 链 $\\{q_1, q_2\\}$，满足：\n$(A-2B)q_1 = 0$ (特征向量)\n$(A-2B)q_2 = Bq_1$ (广义特征向量)\n根据我们之前的计算，我们可以选择 $q_1 = \\begin{pmatrix} 1  0  0 \\end{pmatrix}^T = e_1$。\n然后，我们必须解 $(A-2B)q_2 = B e_1$。\n$B e_1 = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = e_1$。\n方程变为：\n$$\n\\begin{pmatrix} 0  1  0 \\\\ 0  0  0 \\\\ 0  0  1 \\end{pmatrix} q_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n这意味着 $q_2$ 的分量满足 $q_{2,2} = 1$ 和 $q_{2,3} = 0$。分量 $q_{2,1}$ 是任意的。我们可以选择最简单的解，$q_2 = \\begin{pmatrix} 0  1  0 \\end{pmatrix}^T = e_2$。\n因此，对于 $\\lambda=2$ 的 Jordan 链是 $\\{e_1, e_2\\}$，其大小为 2。\n\n对于无穷大特征值，我们需要一个以 $q_3$ 开始的向量链 $\\{q_3, \\dots\\}$，使得 $Bq_3=0$。根据我们之前的计算，我们可以选择 $q_3 = \\begin{pmatrix} 0  0  1 \\end{pmatrix}^T = e_3$。对于一个无穷大特征值，如果存在向量 $q_3, \\dots, q_{k+2}$ 使得 $B q_3=0, B q_4 = A q_3, \\dots, B q_{k+2}=A q_{k+1}$，并且 $A q_{k+2}$ 不在 $B$ 的值域内，则其链的长度为 $k$。这里我们检查该链是否可以延伸至长度 2。这需要解 $B x = A q_3$。\n$A q_3 = A e_3 = \\begin{pmatrix} 2  1  0 \\\\ 0  2  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = e_3$。\n方程为 $B x = e_3$：\n$$\n\\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}.\n$$\n最后一行导出一个矛盾 $0 = 1$。因此，无解，链不能被延伸。无穷大特征值的链是 $\\{e_3\\}$，其长度为 1。无穷部分的幂零指数是最大幂零块的大小，即 $1 \\times 1$。因此指数为 1。\n\n矩阵 $Q$ 由这些链向量构成：$Q = [q_1, q_2, q_3] = [e_1, e_2, e_3] = I$。当 $P=I$ 和 $Q=I$ 时，我们有 $PAQ=A$ 和 $PBQ=B$，证实了原始矩阵就是其范式。\n\n最后，题目要求我们给出该矩阵束在其 Weierstrass 范式下有限部分的首一特征多项式。矩阵束的有限部分由矩阵对 $(J, I_2)$ 描述，构成矩阵束 $J - \\lambda I_2$。有限 Jordan 块是 $J = \\begin{pmatrix} 2  1 \\\\ 0  2 \\end{pmatrix}$。特征多项式为：\n$$\n\\det(J - \\lambda I_2) = \\det \\begin{pmatrix} 2 - \\lambda  1 \\\\ 0  2 - \\lambda \\end{pmatrix} = (2 - \\lambda)^2.\n$$\n为了使该多项式成为首一多项式，我们乘以 $(-1)^2 = 1$：\n$$\n(\\lambda - 2)^2 = \\lambda^2 - 4\\lambda + 4.\n$$\n这就是所求的首一特征多项式。",
            "answer": "$$\n\\boxed{(\\lambda-2)^2}\n$$"
        },
        {
            "introduction": "对于稠密的广义特征值问题$A x = \\lambda B x$，QZ算法是现代数值计算的“主力军”。其精髓在于通过一系列酉变换，将矩阵束$(A, B)$稳定地化为上三角形式（广义Schur型），从而避免了计算可能病态的$B^{-1}A$。本练习聚焦于QZ算法中一个关键的微观操作——“凸起追逐”，你将亲手计算一个Givens旋转，以理解算法如何在保持数值稳定性的同时，逐步向目标结构迭代。",
            "id": "3587877",
            "problem": "考虑广义特征值问题 $A x = \\lambda B x$，其中 $A,B \\in \\mathbb{R}^{3 \\times 3}$。广义舒尔 (QZ) 分解旨在寻找酉矩阵 $Q,Z$，使得 $Q^{*} A Z = S$ 和 $Q^{*} B Z = T$，其中 $S$ 和 $T$ 是上（准）三角矩阵。在应用于海森伯-三角矩阵束 $(A,B)$ 的QZ算法的隐式单步位移步骤中，我们在前导的 $2 \\times 2$ 子块上引入一个酉旋转，以将经过位移修正的前导向量与第一个坐标轴对齐，这会产生一个单步扰动（一个“凸起”），然后通过交替的左右酉旋转来追逐这个凸起，同时保持 $T$ 的三角结构和 $S$ 的海森伯结构。\n\n设\n$$\nA = \\begin{pmatrix}\n4  5  0 \\\\\n1  3  2 \\\\\n0  2  1\n\\end{pmatrix},\\qquad\nB = \\begin{pmatrix}\n2  -1  0 \\\\\n0  1  1 \\\\\n0  0  1\n\\end{pmatrix},\n$$\n并且标量位移为 $\\mu = 1.3$。定义一个2维向量\n$$\nv = \\begin{pmatrix}\na_{11} - \\mu b_{11} \\\\\na_{21} - \\mu b_{21}\n\\end{pmatrix},\n$$\n并考虑一个由角度 $\\theta \\in \\mathbb{R}$ 参数化的实酉（正交）吉文斯旋转，该旋转从左侧作用于前两行，将 $v$ 映射为 $\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}$ 的倍数，从而引发待追逐的凸起，同时通过随后对前两列的右旋转保持 $T$ 为上三角矩阵。\n\n从这些数据出发，概念上执行第一次左旋转，并确定将 $v$ 与第一个坐标轴对齐的旋转角 $\\theta$（以弧度为单位）。将最终角度以弧度表示，并将您的答案四舍五入到四位有效数字。",
            "solution": "主要任务是计算从左侧应用于一个2维向量 $v$ 的吉文斯旋转的角度 $\\theta$，以将其第二个分量置零。这个向量 $v$ 是作为广义特征值问题隐式QZ迭代中的一个预备步骤构建的。\n\n问题将向量 $v$ 定义为：\n$$\nv = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = \\begin{pmatrix} a_{11} - \\mu b_{11} \\\\ a_{21} - \\mu b_{21} \\end{pmatrix}\n$$\n给定的矩阵是：\n$$\nA = \\begin{pmatrix}\n4  5  0 \\\\\n1  3  2 \\\\\n0  2  1\n\\end{pmatrix},\\qquad\nB = \\begin{pmatrix}\n2  -1  0 \\\\\n0  1  1 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n与计算相关的矩阵元素是 $a_{11}=4$, $a_{21}=1$, $b_{11}=2$, 和 $b_{21}=0$。给定的标量位移是 $\\mu = 1.3$。\n\n我们首先使用所提供的数据计算向量 $v$ 的分量：\n$$\nv_1 = a_{11} - \\mu b_{11} = 4 - (1.3)(2) = 4 - 2.6 = 1.4\n$$\n$$\nv_2 = a_{21} - \\mu b_{21} = 1 - (1.3)(0) = 1 - 0 = 1\n$$\n因此，要旋转的向量是 $v = \\begin{pmatrix} 1.4 \\\\ 1 \\end{pmatrix}$。\n\n一个作用于2维向量 $\\begin{pmatrix} x \\\\ y \\end{pmatrix}$ 以消除其第二个分量的实酉（正交）吉文斯旋转矩阵 $G(\\theta)$，通常写为：\n$$\nG(\\theta) = \\begin{pmatrix} \\cos(\\theta)  \\sin(\\theta) \\\\ -\\sin(\\theta)  \\cos(\\theta) \\end{pmatrix}\n$$\n我们记 $c = \\cos(\\theta)$ 和 $s = \\sin(\\theta)$。此旋转作用于向量 $v$ 必须产生一个与第一个坐标轴对齐的新向量，这意味着它的第二个分量为零：\n$$\nG(\\theta)v = \\begin{pmatrix} c  s \\\\ -s  c \\end{pmatrix} \\begin{pmatrix} 1.4 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} r \\\\ 0 \\end{pmatrix}\n$$\n其中 $r$ 是一个标量，等于 $v$ 的欧几里得范数，即 $r = \\sqrt{(1.4)^2 + 1^2}$。\n\n矩阵向量方程的第二行提供了确定角度所需的条件：\n$$\n-s \\cdot (1.4) + c \\cdot (1) = 0\n$$\n这暗示了 $c$ 和 $s$ 之间的一个关系：\n$$\nc = 1.4 s\n$$\n参数 $c$ 和 $s$ 也受到基本三角恒等式 $c^2 + s^2 = 1$ 的约束。将 $c$ 的表达式代入此恒等式，我们得到：\n$$\n(1.4s)^2 + s^2 = 1\n$$\n$$\n1.96s^2 + s^2 = 1\n$$\n$$\n2.96s^2 = 1\n$$\n$$\ns^2 = \\frac{1}{2.96} \\implies s = \\frac{1}{\\sqrt{2.96}}\n$$\n我们取 $s$ 的正根，这将角度 $\\theta$ 置于第一或第二象限。由于 $c = 1.4s$， $c$ 也将是正的，从而将 $\\theta$ 限制在第一象限。\n$$\nc = \\frac{1.4}{\\sqrt{2.96}}\n$$\n角度 $\\theta$ 可以从 $s$ 与 $c$ 的比值中求出：\n$$\n\\tan(\\theta) = \\frac{s}{c} = \\frac{1/\\sqrt{2.96}}{1.4/\\sqrt{2.96}} = \\frac{1}{1.4}\n$$\n为了以弧度为单位求出角度 $\\theta$，我们计算这个值的反正切：\n$$\n\\theta = \\arctan\\left(\\frac{1}{1.4}\\right)\n$$\n计算数值：\n$$\n\\theta \\approx \\arctan(0.714285714...) \\approx 0.62024948 \\text{ 弧度}\n$$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $6$、$2$、$0$ 和 $2$。第五位数字是 $4$，所以我们向下舍入。\n$$\n\\theta \\approx 0.6202\n$$",
            "answer": "$$\n\\boxed{0.6202}\n$$"
        },
        {
            "introduction": "理论与实践之间往往存在一道鸿沟，在数值计算中尤其如此。QZ算法的输出是一系列特征值对$(\\alpha_i, \\beta_i)$，理论上无限特征值对应$\\beta_i = 0$。然而，在浮点数运算中，我们如何区分一个极小的值是数值误差还是真正的零？本练习要求你设计一个稳健且尺度不变的准则，以从数值计算结果中准确地识别无限特征值。这项任务将锻炼你处理有限精度算法带来的挑战，并根据后向误差和机器精度$\\epsilon_{\\text{mach}}$设计可靠数值软件的核心能力。",
            "id": "3587883",
            "problem": "您的任务是基于矩阵束定义和广义 Schur 分解，为广义特征值问题中的无穷大特征值构建一个有原则的检测器和分离器。令 $A,B\\in\\mathbb{C}^{n\\times n}$ 定义一个矩阵束 $A-\\lambda B$。广义特征值是任意满足存在非零向量 $x$ 使得 $(A-\\lambda B)x=0$ 的 $\\lambda\\in\\mathbb{C}\\cup\\{\\infty\\}$。当 $B$ 是奇异矩阵时，该矩阵束可能存在无穷大特征值 $\\lambda=\\infty$。广义 Schur 分解（QZ分解）产生酉矩阵 $Q$ 和 $Z$ 以及上三角矩阵 $S$ 和 $T$，使得 $Q^{*}AZ=S$ 且 $Q^{*}BZ=T$。在复广义 Schur 型中，对角元素对 $(\\alpha,\\beta)=(S_{ii},T_{ii})$ 参数化了矩阵束的谱信息。您的任务是开发、论证并实现一个稳健的、尺度不变的准则，用以判断单个对 $(\\alpha,\\beta)$ 是否编码了一个无穷大特征值 $\\lambda=\\infty$，然后将谱分离为两个不相交的列表：有限特征值和无穷大特征值。该准则必须基于后向误差和机器精度的考量，而不是依赖于非尺度不变的绝对阈值。\n\n您的推导和算法应基于以下基本原理：\n- 广义特征值问题的定义：$(A-\\lambda B)x=0$。\n- 广义 Schur 分解的存在性：存在酉矩阵 $Q$ 和 $Z$ 使得 $Q^{*}AZ=S$ 且 $Q^{*}BZ=T$，其中 $S$ 和 $T$ 是上三角矩阵。\n- 酉变换和三角化在机器精度 $\\epsilon_{\\text{mach}}$ 水平上的数值后向稳定性。\n- 用对角元素对 $(\\alpha,\\beta)$ 表示广义特征值的尺度不变性。\n\n设计并实现一个程序，该程序能够：\n- 为每个测试矩阵束 $(A,B)$ 计算复广义 Schur 型 $(S,T)$，并提取对角元素对 $(\\alpha_i,\\beta_i)$。\n- 提出并使用一个尺度不变的决策规则，该规则基于对 $(\\alpha_i,\\beta_i)$ 的模对其进行归一化，并将归一化后的 $\\lvert\\beta_i\\rvert$ 与一个依赖于 $n$ 和 $\\epsilon_{\\text{mach}}$ 的容差进行比较，以判断 $\\lambda_i=\\infty$ 是否成立。\n- 将谱分离为两个列表：对于被判定为有限的索引，其有限特征值为 $\\lambda_i=\\alpha_i/\\beta_i$；对于被判定为无穷大的索引，其为无穷大特征值。对于有限特征值列表，要求当虚部在数值噪声范围内时，返回值应为实数；您必须舍弃虚部超过验证容差的特征值，并且仅当虚部小于该容差时才返回其实部（请在解决方案中论证您的容差选择）。\n- 验证您返回的有限特征值在与 $\\epsilon_{\\text{mach}}$ 一致的微小容差范围内是实数。\n\n测试套件。使用以下四个 $n=4$ 的矩阵束，它们涵盖了秩亏、满秩和近奇异的情况：\n- 情况 1：$A=\\operatorname{diag}(1,2,3,4)$，$B=\\operatorname{diag}(1,0,0,2)$。\n- 情况 2：$A=\\operatorname{diag}(4,3,2,1)$，$B=\\operatorname{diag}(5,4,3,2)$。\n- 情况 3：$A=\\operatorname{diag}(1,2,3,4)$，$B=\\operatorname{diag}(10^{-16},2,3,4)$。\n- 情况 4：$A=\\begin{bmatrix}2100\\\\1200\\\\0031\\\\0013\\end{bmatrix}$，$B=\\operatorname{diag}(0,2,2,2)$。\n\n对于每种情况，您的程序必须生成：\n- 检测为无穷大特征值的索引的整数计数。\n- 检测为有限特征值的索引的整数计数。\n- 一个有限特征值的浮点数列表，按非递减顺序排序，每个值四舍五入到 $6$ 位小数。\n- 一个布尔值，断言所有检测到的有限特征值的虚部都在您的验证容差范围内，并且所有检测到的无穷大索引都满足您的准则。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表，每个案例的结果是一个形如 $[k_{\\infty},k_{\\mathrm{fin}},[\\lambda_1,\\dots],\\text{boolean}]$ 的嵌套列表。例如，输出应类似于 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$。不允许外部输入，并且此任务不涉及物理单位。",
            "solution": "在广义特征值问题中检测和分离无穷大特征值是数值线性代数中的一个基本任务。我们首先建立理论框架，然后按要求推导出一个数值稳健的算法。\n\n对于一对矩阵（或一个矩阵束）$A-\\lambda B$，其中 $A, B \\in \\mathbb{C}^{n\\times n}$，广义特征值问题 (GEP) 是寻找标量 $\\lambda$ 和非零向量 $x$，使得 $(A-\\lambda B)x=0$。\n如果 $B$ 非奇异，该问题可以转换为标准特征值问题 $B^{-1}Ax = \\lambda x$。但是，如果 $B$ 奇异，则无法进行此转换。奇异矩阵 $B$ 可能导致一种新现象：无穷大特征值。为了妥善处理这种情况，我们使用一对齐次坐标 $(\\alpha, \\beta)$ 来表示特征值。GEP 被重写为 $\\beta A x = \\alpha B x$，或 $(\\beta A - \\alpha B)x = 0$。现在，一个特征值由任意一对允许存在非零解向量 $x$ 的 $(\\alpha, \\beta) \\neq (0,0)$ 表示。如果 $\\beta \\neq 0$，我们得到有限特征值 $\\lambda = \\alpha / \\beta$。如果 $\\beta = 0$ 且 $\\alpha \\neq 0$，方程变为 $\\alpha B x = 0$，对于 $\\alpha \\neq 0$ 这意味着 $B x = 0$。这表示 $x$ 位于 $B$ 的零空间中。对于这种情况，完整的 GEP 方程 $(A-\\lambda B)x=0$ 只有在 $\\lambda$ 无穷大时才能满足。因此，一对 $(\\alpha, 0)$（其中 $\\alpha \\neq 0$）对应一个无穷大特征值。\n\n求解 GEP 的标准数值稳定方法是广义 Schur（或 QZ）分解。该方法指出，对于任意矩阵对 $(A, B)$，存在酉矩阵 $Q$ 和 $Z$，使得 $S=Q^*AZ$ 和 $T=Q^*BZ$ 都是上三角矩阵。因此，矩阵束 $A-\\lambda B$ 酉等价于 $S-\\lambda T$。广义特征值在此变换下保持不变。对于三角矩阵束 $S-\\lambda T$，特征值由对角元素确定。条件 $\\text{det}(S-\\lambda T) = 0$ 变为 $\\prod_{i=1}^{n} (S_{ii} - \\lambda T_{ii}) = 0$。这意味着广义特征值由对 $(\\alpha_i, \\beta_i) = (S_{ii}, T_{ii})$给出，其中 $i=1, \\dots, n$。在精确算术中，无穷大特征值精确对应于 $\\beta_i = 0$ 且 $\\alpha_i \\neq 0$ 的情况。\n\n在有限精度的浮点运算中，真正的零很少被计算出来。一个理论上为零的值将被表示为一个与机器精度同数量级、并由问题范数缩放的小数。因此，像 $\\beta_i = 0$ 这样的简单检查是不稳健的。此外，$\\alpha_i$ 和 $\\beta_i$ 的大小取决于输入矩阵 $A$ 和 $B$ 的缩放。基于 $|\\beta_i|$ 的绝对阈值的准则将不是尺度不变的。例如，用 $c B$ 替换 $B$ 会将所有 $\\beta_i$ 缩放 $c$ 倍，这将破坏固定的阈值。\n\n为了设计一个稳健且尺度不变的准则，我们必须将对 $(\\alpha_i, \\beta_i)$ 视为表示一个比率。特征值 $\\lambda_i = \\alpha_i/\\beta_i$ 的尺度不变性表明，一个特征值的“无穷性”应仅取决于 $\\beta_i$ 与 $\\alpha_i$ 的比率，或者更稳健地说，取决于 $\\beta_i$ 在该对中所占的比例。我们可以通过其欧几里得范数对该对进行归一化：\n$$ (\\alpha'_i, \\beta'_i) = \\frac{(\\alpha_i, \\beta_i)}{\\sqrt{|\\alpha_i|^2 + |\\beta_i|^2}} $$\n这种归一化确保了 $|\\alpha'_i|^2 + |\\beta'_i|^2 = 1$。归一化后的值 $|\\beta'_i|$ 现在是尺度不变的。一个无穷大特征值，对应于理论上的对 $(\\alpha_i, 0)$，将导致计算出的对中 $|\\beta_i|$相对于$|\\alpha_i|$很小，因此 $|\\beta'_i|$ 将接近于零。\n问题变成了：$|\\beta'_i|$ 必须多小才能宣布该特征值为无穷大？QZ 算法是后向稳定的，这意味着计算出的 Schur 型 $S$ 和 $T$对于轻微扰动的矩阵 $A+E_A$ 和 $B+E_B$ 是精确的，其中 $\\|E_A\\|$ 和 $\\|E_B\\|$ 分别与 $\\epsilon_{\\text{mach}} \\|A\\|$ 和 $\\epsilon_{\\text{mach}} \\|B\\|$ 同数量级。这表明 $S$ 和 $T$ 元素的扰动与 $\\epsilon_{\\text{mach}}$ 乘以某个相关范数的数量级相同。数值线性代数中一个广泛接受的启发式方法是使用一个与问题规模 $n$ 和机器精度 $\\epsilon_{\\text{mach}}$ 成正比的容差。因此，我们提出以下准则：如果\n$$ |\\beta'_i| = \\frac{|\\beta_i|}{\\sqrt{|\\alpha_i|^2 + |\\beta_i|^2}}  n \\cdot \\epsilon_{\\text{mach}} $$\n则与对 $(\\alpha_i, \\beta_i)$ 对应的特征值 $\\lambda_i$ 被认为是无穷大。这个容差 $\\tau_{\\infty} = n \\cdot \\epsilon_{\\text{mach}}$ 与输入矩阵的缩放无关，并且能稳健地区分数值上很小和理论上为零的 $\\beta_i$ 值。\n\n对于被识别为对应有限特征值的索引 $i$（即 $|\\beta'_i| \\ge \\tau_{\\infty}$），特征值计算为 $\\lambda_i = \\alpha_i/\\beta_i$。问题规定输入矩阵是实数。理论上，所有特征值因此应该是实数或以复共轭对的形式出现。测试案例的结构使得所有真实特征值都是实数。然而，数值计算可能会引入微小的、虚假的虚部。问题要求我们筛选计算出的有限特征值，只保留那些“在数值噪声范围内是实数”的值。如果一个有限特征值 $\\lambda_i$ 的虚部足够小，它就被接受。我们为此检查建立一个验证容差。除法 $\\alpha_i/\\beta_i$ 中的误差传播可能会放大初始误差，因此需要一个稍微宽松一些的容差。一个保守但安全的选择是另一个基于问题规模和机器精度的启发式容差：\n$$ |\\text{Im}(\\lambda_i)|  \\tau_{\\text{imag}} $$\n其中我们定义 $\\tau_{\\text{imag}} = 100 \\cdot n \\cdot \\epsilon_{\\text{mach}}$。如果满足此条件，我们接受该特征值为数值上的实数，并保留其实部 $\\text{Re}(\\lambda_i)$。如果不满足条件，则从最终列表中丢弃该特征值。\n\n对于每个测试案例 $(A,B)$，最终算法流程如下：\n1. 设置维度 $n$ 和机器精度 $\\epsilon_{\\text{mach}}$。定义容差 $\\tau_{\\infty} = n \\cdot \\epsilon_{\\text{mach}}$ 和 $\\tau_{\\text{imag}} = 100 \\cdot n \\cdot \\epsilon_{\\text{mach}}$。\n2. 使用库函数计算复广义 Schur 分解 $S = Q^*AZ$ 和 $T = Q^*BZ$。\n3. 提取对角元素对 $(\\alpha_i, \\beta_i) = (S_{ii}, T_{ii})$，其中 $i=1, \\dots, n$。\n4. 初始化无穷大特征值计数器 $k_{\\infty}$ 和有限特征值列表 $\\Lambda_{\\text{fin}}$。\n5. 对于每对 $(\\alpha_i, \\beta_i)$：\n   a. 计算归一化后的 $|\\beta'_i| = |\\beta_i| / \\sqrt{|\\alpha_i|^2 + |\\beta_i|^2}$。处理范数为零的情况。\n   b. 如果 $|\\beta'_i|  \\tau_{\\infty}$，则增加 $k_{\\infty}$。\n   c. 否则，计算 $\\lambda_i = \\alpha_i / \\beta_i$。如果 $|\\text{Im}(\\lambda_i)|  \\tau_{\\text{imag}}$，则将 $\\text{Re}(\\lambda_i)$ 追加到 $\\Lambda_{\\text{fin}}$。\n6. 有限索引的计数为 $k_{\\text{fin}} = n - k_{\\infty}$。\n7. 将列表 $\\Lambda_{\\text{fin}}$ 按非递减顺序排序，并将其元素四舍五入到 $6$ 位小数。\n8. 验证布尔值断言所实现的逻辑是自洽的：所有被分类为无穷大的索引都满足无穷大准则，并且最终列表中包含的所有特征值都满足虚部检查。根据构造，此布尔值将为 `True`。\n此过程为分离和验证广义特征值问题的特征值提供了一个有原则且稳健的方法。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import qz\n\ndef solve():\n    \"\"\"\n    Solves the generalized eigenvalue problem for several test cases,\n    detecting and separating infinite eigenvalues based on a robust,\n    scale-invariant criterion derived from the generalized Schur decomposition.\n    \"\"\"\n    # Test suite of matrix pencils (A, B)\n    test_cases = [\n        # Case 1: A=diag(1,2,3,4), B=diag(1,0,0,2)\n        (np.diag([1., 2., 3., 4.]), np.diag([1., 0., 0., 2.])),\n        # Case 2: A=diag(4,3,2,1), B=diag(5,4,3,2)\n        (np.diag([4., 3., 2., 1.]), np.diag([5., 4., 3., 2.])),\n        # Case 3: A=diag(1,2,3,4), B=diag(1e-16,2,3,4)\n        (np.diag([1., 2., 3., 4.]), np.diag([1e-16, 2., 3., 4.])),\n        # Case 4: A=[[2,1,0,0],[1,2,0,0],[0,0,3,1],[0,0,1,3]], B=diag(0,2,2,2)\n        (np.array([[2., 1., 0., 0.], [1., 2., 0., 0.], [0., 0., 3., 1.], [0., 0., 1., 3.]]),\n         np.diag([0., 2., 2., 2.]))\n    ]\n\n    results = []\n    for A, B in test_cases:\n        n = A.shape[0]\n        eps = np.finfo(float).eps\n\n        # Define the scale-invariant tolerance for infinity detection\n        inf_tol = n * eps\n        # Define the validation tolerance for the imaginary part of finite eigenvalues\n        imag_tol = 100 * n * eps\n\n        # Compute the complex generalized Schur (QZ) decomposition\n        S, T, _, _ = qz(A, B, output='complex')\n        \n        # Extract diagonal pairs (alpha, beta)\n        alpha = np.diag(S)\n        beta = np.diag(T)\n\n        k_inf = 0\n        finite_eigs = []\n        is_classification_valid = True\n\n        for i in range(n):\n            alpha_i, beta_i = alpha[i], beta[i]\n            \n            # Normalize the pair (alpha_i, beta_i)\n            norm = np.sqrt(np.abs(alpha_i)**2 + np.abs(beta_i)**2)\n\n            # A zero norm corresponds to an ambiguous (0,0) pair, which is ill-defined.\n            # We treat it as finite by setting norm_beta large enough.\n            if norm == 0:\n                norm_beta = 1.0\n            else:\n                norm_beta = np.abs(beta_i) / norm\n\n            # Apply the criterion to detect infinite eigenvalues\n            if norm_beta  inf_tol:\n                k_inf += 1\n            else:\n                # This is a finite eigenvalue\n                # The check for beta_i != 0 is implicitly handled by norm_beta = inf_tol\n                lam = alpha_i / beta_i\n                \n                # Validate if the eigenvalue is numerically real\n                if np.abs(lam.imag)  imag_tol:\n                    finite_eigs.append(lam.real)\n                else:\n                    # This case would indicate a complex eigenvalue for a real pencil,\n                    # beyond numerical noise. Per problem, we discard it,\n                    # and the validation boolean, which checks the final output, remains True.\n                    pass\n\n        k_fin = n - k_inf\n\n        # Sort and round the valid finite eigenvalues\n        finite_eigs.sort()\n        rounded_eigs = [round(eig, 6) for eig in finite_eigs]\n\n        # By construction, the classification is self-consistent.\n        # All detected infinite eigenvalues satisfied the criterion,\n        # and all retained finite eigenvalues passed the imaginary part check.\n        is_valid = True\n\n        results.append([k_inf, k_fin, rounded_eigs, is_valid])\n\n    # Format the final output string as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}