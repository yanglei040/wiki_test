{
    "hands_on_practices": [
        {
            "introduction": "理解沙漏现象始于能够对其进行量化。本实践将指导您在一个使用减缩积分单元离散化的扭转杆模型中，计算伪模式的振幅。通过编程实现将一个已知的位移场投影到沙漏模式向量上，您将具体地理解某些变形是如何激发这些非物理响应的，从而为评估和控制沙漏效应打下基础 。",
            "id": "3602265",
            "problem": "考虑在三维线弹性问题中，使用单点（减缩）高斯积分的八节点三线性六面体单元（Hex8）。从虚功原理出发：内虚功由 $\\delta W_{\\text{int}} = \\int_{\\Omega} \\boldsymbol{\\varepsilon}(\\mathbf{u}) : \\mathbb{C} : \\boldsymbol{\\varepsilon}(\\delta \\mathbf{u}) \\, dV$ 给出，其中 $\\boldsymbol{\\varepsilon}(\\mathbf{u})$ 是小应变张量，$\\mathbb{C}$ 是四阶弹性张量，$\\Omega$ 是单元域。对于采用单点积分的 Hex8 单元，单元刚度矩阵近似为 $\\mathbf{K}_e \\approx \\mathbf{B}(\\xi_0,\\eta_0,\\zeta_0)^{\\top} \\mathbb{C} \\, \\mathbf{B}(\\xi_0,\\eta_0,\\zeta_0) \\, \\det \\mathbf{J}(\\xi_0,\\eta_0,\\zeta_0)$，在单个减缩积分点 $(\\xi_0,\\eta_0,\\zeta_0) = (0,0,0)$ 处求值。这种近似方法对于 Hex8 单元是秩亏的，并会产生伪零能模式（通常称为沙漏模式）。这些模式在积分点处产生零应变，因此在减缩积分法则下不消耗能量。这些伪模式可以通过定义在参考单元上的节点符号模式来表示。\n\n在六面体的八个角节点处定义参考参数坐标 $(r,s,t)\\in\\{-1,+1\\}^3$，其顺序如下：节点 $1$ 位于 $(r,s,t)=(-1,-1,-1)$，节点 $2$ 位于 $(+1,-1,-1)$，节点 $3$ 位于 $(+1,+1,-1)$，节点 $4$ 位于 $(-1,+1,-1)$，节点 $5$ 位于 $(-1,-1,+1)$，节点 $6$ 位于 $(+1,-1,+1)$，节点 $7$ 位于 $(+1,+1,+1)$，节点 $8$ 位于 $(-1,+1,+1)$。令 $h_i^{(1)}=r_i$，$h_i^{(2)}=s_i$，$h_i^{(3)}=t_i$ 和 $h_i^{(4)}=r_i s_i t_i$ 表示典型的沙漏形状模式（其中 $i=1,\\dots,8$，模式 $\\alpha=1,\\dots,4$）。对于给定单元，其在笛卡尔坐标方向 $a\\in\\{x,y,z\\}$ 上的节点位移分量为 $u_i^{(a)}$，通过离散投影定义模式 $\\alpha$ 和方向 $a$ 上的沙漏幅值\n$$\nq_{e}^{(\\alpha,a)} = \\frac{1}{8} \\sum_{i=1}^{8} h_i^{(\\alpha)} \\, u_i^{(a)}.\n$$\n这个 $q_{e}^{(\\alpha,a)}$ 是衡量单元的节点位移模式在单点积分下激发相应伪零能模式的强度。\n\n现在考虑一根长度为 $L$、与全局 $Z$ 轴对齐的直棱柱杆，其矩形截面沿全局 $X$ 轴和 $Y$ 轴的宽度分别为 $W_x$ 和 $W_y$。杆在 $Z=0$ 处被夹紧，并在 $Z=L$ 处受到一个小的末端扭转 $\\Theta$。采用小扭转运动学，其中每个横截面都围绕 $Z$ 轴刚性旋转一个角度 $\\theta(Z)=\\Theta \\, Z / L$。在笛卡尔坐标系中，施加的位移场为\n$$\nu_x(X,Y,Z) = -\\theta(Z) \\, Y = -\\frac{\\Theta}{L} \\, Z \\, Y,\\quad\nu_y(X,Y,Z) = \\theta(Z) \\, X = \\frac{\\Theta}{L} \\, Z \\, X,\\quad\nu_z(X,Y,Z) = 0.\n$$\n\n用 $X$、$Y$ 和 $Z$ 方向上分别为 $N_x \\times N_y \\times N_z$ 个 Hex8 单元的结构化网格对杆进行离散化。为了改变网格相对于全局坐标轴的方向，将每个单元的局部平面内坐标轴围绕 $Z$ 轴旋转一个角度 $\\beta$，使得局部方向 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$ 是通过将全局 $(X,Y)$ 轴旋转 $\\beta$ 得到的，而 $\\mathbf{e}_3$ 保持与 $Z$ 轴对齐。在每个单元内部，假设从 $(r,s,t)\\in[-1,1]^3$ 到全局坐标的仿射映射为：\n$$\n\\mathbf{x}(r,s,t) = \\mathbf{x}_c + \\mathbf{R}_z(\\beta) \\begin{bmatrix} \\frac{h_x}{2} r \\\\ \\frac{h_y}{2} s \\\\ \\frac{h_z}{2} t \\end{bmatrix},\n$$\n其中 $\\mathbf{x}_c$ 是单元中心的全局坐标，$h_x=W_x/N_x$，$h_y=W_y/N_y$，$h_z=L/N_z$，$\\mathbf{R}_z(\\beta)$ 是围绕 $Z$ 轴旋转角度 $\\beta$ 的标准旋转矩阵。\n\n对每个单元，通过代入 $(r_i,s_i,t_i)$ 来计算八个角的节点位置，然后计算这些节点坐标处的施加扭转位移 $(u_x,u_y,u_z)$。使用上述定义，计算 $\\alpha\\in\\{1,2,3,4\\}$ 和 $a\\in\\{x,y,z\\}$ 时的 $q_{e}^{(\\alpha,a)}$。作为每个网格的标量总结，定义最大绝对沙漏幅值\n$$\nQ_{\\max} = \\max_{e} \\max_{\\alpha\\in\\{1,2,3,4\\}} \\max_{a\\in\\{x,y,z\\}} \\left| q_{e}^{(\\alpha,a)} \\right|.\n$$\n这个 $Q_{\\max}$ 的单位是长度。您的任务是为一组参数化测试用例计算 $Q_{\\max}$，这些用例通过 $(N_x,N_y,N_z)$ 改变网格方向 $\\beta$、扭转角 $\\Theta$ 和单元纵横比。\n\n您必须实现一个程序，从第一性原理出发执行以下步骤：\n- 创建结构化网格的单元中心 $\\mathbf{x}_c$，覆盖 $X\\in[-W_x/2,W_x/2]$、$Y\\in[-W_y/2,W_y/2]$、$Z\\in[0,L]$，单元数量为 $N_x$、$N_y$、$N_z$。\n- 对每个单元，使用带有旋转 $\\beta$ 和尺寸 $(h_x,h_y,h_z)$ 的仿射映射生成其八个节点的坐标。\n- 在每个节点处计算施加的位移场。\n- 计算每个单元的四个沙漏模式幅值 $q_{e}^{(\\alpha,a)}$ 以及整个网格上的标量 $Q_{\\max}$。\n\n所有物理量均使用国际单位制。具体来说：\n- 所有长度 $L$、$W_x$、$W_y$ 必须以米为单位，输出的 $Q_{\\max}$ 必须以米为单位报告。\n- 角度 $\\Theta$ 必须以弧度为单位。\n- 网格方向角 $\\beta$ 在输入参数集中必须以度为单位给出，并在内部转换为弧度进行计算。\n\n测试套件：\n为以下四个测试用例计算 $Q_{\\max}$。每个案例是一个有序元组 $(L,W_x,W_y,N_x,N_y,N_z,\\Theta,\\beta)$，其单位和约定如上所述。\n- 案例 1：$(L,W_x,W_y,N_x,N_y,N_z,\\Theta,\\beta) = (2.0, 1.0, 0.6, 2, 1, 4, 0.1, 0.0)$。\n- 案例 2：$(L,W_x,W_y,N_x,N_y,N_z,\\Theta,\\beta) = (2.0, 1.0, 0.6, 2, 1, 4, 0.1, 45.0)$。\n- 案例 3：$(L,W_x,W_y,N_x,N_y,N_z,\\Theta,\\beta) = (2.0, 1.0, 0.6, 4, 1, 2, 0.1, 0.0)$。\n- 案例 4：$(L,W_x,W_y,N_x,N_y,N_z,\\Theta,\\beta) = (2.0, 1.0, 0.6, 2, 1, 4, 1.0\\times 10^{-6}, 30.0)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个案例的 $Q_{\\max}$ 值（单位为米），每个值格式化为小数点后恰好 $10$ 位，并以逗号分隔的列表形式用方括号括起来。例如，可接受的输出格式为 $[0.1234567890,0.2345678901,0.3456789012,0.4567890123]$。不应打印任何额外文本。",
            "solution": "用户提供了一个计算固体力学中有效且适定的问题。任务是计算一个受扭转的棱柱杆在几种离散化方案下的最大沙漏幅值，记为 $Q_{\\max}$。解决方案要求根据问题陈述中列出的第一性原理，对所提供的公式进行直接的数值实现。以下步骤详细说明了为单个测试用例计算 $Q_{\\max}$ 的过程。\n\n第一步是为给定的测试用例建立几何和运动学参数，该用例由元组 $(L, W_x, W_y, N_x, N_y, N_z, \\Theta, \\beta_{\\text{deg}})$ 定义。杆的物理尺寸是长度 $L$、宽度 $W_x$ 和深度 $W_y$。它被离散化为一个由 $N_x \\times N_y \\times N_z$ 个六面体单元组成的结构化网格。每个单元的尺寸为 $h_x = W_x / N_x$，$h_y = W_y / N_y$ 和 $h_z = L / N_z$。总扭转角为 $\\Theta$，单元方向角 $\\beta$ 通过将 $\\beta_{\\text{deg}}$ 从度数转换为弧度得到。\n\n计算的核心是遍历网格中的每一个单元。杆的域在 $X$-$Y$ 平面内居中，范围为 $X \\in [-W_x/2, W_x/2]$ 和 $Y \\in [-W_y/2, W_y/2]$，并沿 $Z$ 轴从 $Z=0$ 延伸到 $Z=L$。一个由 $(i,j,k)$ 索引的单元中心（其中 $i \\in \\{0, \\dots, N_x-1\\}$，$j \\in \\{0, \\dots, N_y-1\\}$，$k \\in \\{0, \\dots, N_z-1\\}$）位于全局坐标 $\\mathbf{x}_c = [X_c, Y_c, Z_c]^{\\top}$ 处，计算如下：\n$$\nX_c = -\\frac{W_x}{2} + (i + 0.5) h_x\n$$\n$$\nY_c = -\\frac{W_y}{2} + (j + 0.5) h_y\n$$\n$$\nZ_c = (k + 0.5) h_z\n$$\n对于每个单元，我们必须确定其八个节点的全局坐标。问题指定了从参考单元域 $(r,s,t) \\in [-1,1]^3$ 到全局坐标系 $\\mathbf{x}$ 的仿射映射：\n$$\n\\mathbf{x}(r,s,t) = \\mathbf{x}_c + \\mathbf{R}_z(\\beta) \\begin{bmatrix} \\frac{h_x}{2} r \\\\ \\frac{h_y}{2} s \\\\ \\frac{h_z}{2} t \\end{bmatrix}\n$$\n其中 $\\mathbf{R}_z(\\beta)$ 是围绕 $Z$ 轴的标准旋转矩阵：\n$$\n\\mathbf{R}_z(\\beta) = \\begin{bmatrix} \\cos\\beta  -\\sin\\beta  0 \\\\ \\sin\\beta  \\cos\\beta  0 \\\\ 0  0  1 \\end{bmatrix}\n$$\n八个节点的坐标 $\\mathbf{x}_i = [X_i, Y_i, Z_i]^{\\top}$（其中 $i=1,\\dots,8$）是通过将每个节点对应的参数坐标 $(r_i, s_i, t_i)$ 代入映射函数得到的。节点排序及其参数坐标 $(r_i, s_i, t_i)$ 给出如下：$1:(-1,-1,-1)$，$2:(+1,-1,-1)$，$3:(+1,+1,-1)$，$4:(-1,+1,-1)$，$5:(-1,-1,+1)$，$6:(+1,-1,+1)$，$7:(+1,+1,+1)$，$8:(-1,+1,+1)$。\n\n一旦八个节点的全局坐标 $(X_i, Y_i, Z_i)$ 都已知，就可以在这些位置上计算施加的位移场。小角度扭转的位移场为：\n$$\nu_x(X,Y,Z) = -\\frac{\\Theta}{L} Z Y, \\quad u_y(X,Y,Z) = \\frac{\\Theta}{L} Z X, \\quad u_z(X,Y,Z) = 0\n$$\n代入节点坐标 $(X_i, Y_i, Z_i)$ 即可得到节点位移分量 $(u_i^{(x)}, u_i^{(y)}, u_i^{(z)})$。\n\n计算出单元的节点位移后，下一步是计算沙漏模式幅值。这些幅值 $q_{e}^{(\\alpha,a)}$ 衡量了单元变形在伪零能模式上的投影。提供的公式为：\n$$\nq_{e}^{(\\alpha,a)} = \\frac{1}{8} \\sum_{i=1}^{8} h_i^{(\\alpha)} \\, u_i^{(a)}\n$$\n对四个沙漏模式 $\\alpha \\in \\{1,2,3,4\\}$ 中的每一个和笛卡尔坐标方向 $a \\in \\{x,y,z\\}$ 中的每一个都执行此计算。沙漏形状模式 $h_i^{(\\alpha)}$ 是基于节点参数坐标定义的：$h_i^{(1)}=r_i$，$h_i^{(2)}=s_i$，$h_i^{(3)}=t_i$ 和 $h_i^{(4)}=r_i s_i t_i$。这导致每个单元总共有 $4 \\times 3 = 12$ 个沙漏幅值。\n\n最后，通过在网格中所有单元的所有计算出的沙漏幅值中找到最大绝对值来确定总体度量 $Q_{\\max}$：\n$$\nQ_{\\max} = \\max_{e} \\max_{\\alpha\\in\\{1,2,3,4\\}} \\max_{a\\in\\{x,y,z\\}} |q_{e}^{(\\alpha,a)}|\n$$\n对问题中指定的每个测试用例重复此过程，并收集所得的 $Q_{\\max}$ 值。实现将使用矩阵和向量运算以提高效率，特别是在计算节点坐标和沙漏幅值公式中的乘积求和时。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_q_max(L, Wx, Wy, Nx, Ny, Nz, Theta, beta_deg):\n    \"\"\"\n    Computes the maximum absolute hourglass amplitude Q_max for a given set of parameters.\n    \"\"\"\n    # 1. Define constants and derived parameters\n    hx = Wx / Nx\n    hy = Wy / Ny\n    hz = L / Nz\n    beta_rad = np.deg2rad(beta_deg)\n    k0 = Theta / L\n\n    # 2. Pre-compute helper matrices\n    # Nodal parametric coordinates based on the specified ordering\n    r = np.array([-1, 1, 1, -1, -1, 1, 1, -1])\n    s = np.array([-1, -1, 1, 1, -1, -1, 1, 1])\n    t = np.array([-1, -1, -1, -1, 1, 1, 1, 1])\n\n    # Hourglass shape pattern vectors h_i^(alpha)\n    h1 = r\n    h2 = s\n    h3 = t\n    h4 = r * s * t\n    H = np.array([h1, h2, h3, h4])  # Shape (4, 8)\n\n    # Rotation matrix R_z(beta)\n    c, s_rot = np.cos(beta_rad), np.sin(beta_rad)\n    Rz = np.array([[c, -s_rot, 0], [s_rot, c, 0], [0, 0, 1]])\n\n    # Vector of local coordinates for the 8 nodes relative to the element center\n    nodes_local_coords = 0.5 * np.array([hx * r, hy * s, hz * t]) # Shape (3, 8)\n\n    global_q_max = 0.0\n\n    # 3. Iterate over all elements in the structured mesh\n    for i in range(Nx):\n        for j in range(Ny):\n            for k in range(Nz):\n                # 3.1. Calculate element center coordinates\n                Xc = -Wx / 2 + (i + 0.5) * hx\n                Yc = -Wy / 2 + (j + 0.5) * hy\n                Zc = (k + 0.5) * hz\n                elem_center = np.array([Xc, Yc, Zc])\n\n                # 3.2. Generate global coordinates for the 8 nodes of the element\n                # Use broadcasting: (3,1) + (3,3) @ (3,8) -> (3,8)\n                nodes_global_coords = elem_center[:, np.newaxis] + Rz @ nodes_local_coords\n                X_nodes = nodes_global_coords[0, :]\n                Y_nodes = nodes_global_coords[1, :]\n                Z_nodes = nodes_global_coords[2, :]\n\n                # 3.3. Evaluate the imposed displacement field at each node\n                ux_nodes = -k0 * Z_nodes * Y_nodes\n                uy_nodes = k0 * Z_nodes * X_nodes\n                uz_nodes = np.zeros(8)\n                U = np.array([ux_nodes, uy_nodes, uz_nodes]) # Shape (3, 8)\n\n                # 3.4. Compute the hourglass mode amplitudes for the element\n                # Q_e (4,3) = (1/8) * H(4,8) @ U.T(8,3)\n                Q_e = (1.0 / 8.0) * H @ U.T\n\n                # 3.5. Update the global maximum absolute amplitude\n                elem_q_max = np.max(np.abs(Q_e))\n                if elem_q_max > global_q_max:\n                    global_q_max = elem_q_max\n\n    return global_q_max\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Test suite: (L, Wx, Wy, Nx, Ny, Nz, Theta, beta_deg)\n    test_cases = [\n        (2.0, 1.0, 0.6, 2, 1, 4, 0.1, 0.0),\n        (2.0, 1.0, 0.6, 2, 1, 4, 0.1, 45.0),\n        (2.0, 1.0, 0.6, 4, 1, 2, 0.1, 0.0),\n        (2.0, 1.0, 0.6, 2, 1, 4, 1.0e-6, 30.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, Wx, Wy, Nx, Ny, Nz, Theta, beta_deg = case\n        q_max_result = calculate_q_max(L, Wx, Wy, Nx, Ny, Nz, Theta, beta_deg)\n        results.append(f\"{q_max_result:.10f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "像分片检验（patch test）这样的标准验证工具往往无法检测到沙漏不稳定性，这可能导致错误的结论。本练习将挑战您批判性地思考这些伪模式的数学本质，并设计一个能够有效激发沙漏模式的特制检验方案。通过这个过程，您将学会如何揭示减缩积分单元的潜在缺陷，而不是被其看似正确的表现所迷惑 。",
            "id": "3602258",
            "problem": "一个边长为 $2h$ 的方形弹性片被离散为一个 $2 \\times 2$ 的双线性四边形 ($Q4$) 单元网格。材料是线性弹性、均匀、各向同性的，处于平面应变状态，其杨氏模量为 $E$，泊松比为 $\\nu$。每个 $Q4$ 单元使用其形心处的一个高斯点进行积分（单点减缩积分）。设全局笛卡尔坐标为 $(x,y)$，弹性片的节点在 $(x_i,y_j)$ 处形成一个均匀的 $3 \\times 3$ 网格，其中 $x_i = i h$，$y_j = j h$，且 $i,j \\in \\{0,1,2\\}$。\n\n要求您设计一个基于位移的斑块检验，以揭示这种减缩积分离散化中的沙漏不稳定性（伪零能模式），并解释为什么标准线性（仿射）位移斑块检验未能检测到它们。使用以下内容作为基本依据：小应变张量的定义 $\\varepsilon = \\tfrac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}})$、虚功原理 $\\int_{\\Omega} \\boldsymbol{\\sigma}:\\delta \\boldsymbol{\\varepsilon} \\, \\mathrm{d}\\Omega = \\int_{\\partial \\Omega_t} \\bar{\\mathbf{t}} \\cdot \\delta \\mathbf{u} \\, \\mathrm{d}\\Gamma$、双线性 $Q4$ 形函数，以及单点求积仅在单元形心处对应变和应力进行采样这一事实。假设一个边长为 $h$ 的方形单元，具有标准等参映射 $(\\xi,\\eta) \\mapsto (x,y)$，其中对于规则网格，雅可比矩阵是常数对角矩阵，对角元为 $h/2$。\n\n考虑以下旨在揭示沙漏不稳定性的候选边界位移规定和诊断方法。在所有情况下，除非另有说明，均以 $u_x$ 和 $u_y$ 作为边界节点上规定的位移分量，并将任何未指定的位移分量设置为零。设 $\\Delta>0$ 为规定的位移幅值。位于 $(h,h)$ 的内部节点保持自由。\n\n哪个选项正确地指明了一个能够揭示这个 $2 \\times 2$ 弹性片中沙漏不稳定性的基于位移的斑块检验，并正确地解释了为什么标准线性场斑块检验未能检测到它们？\n\nA. 规定一个仿射边界位移场 $u_x = a x + b y$，$u_y = c x + d y$，其中 $a,b,c,d$ 为常数，并通过检查单元级常应变是否在单个高斯点处被再现来验证通过/失败。这能检测到沙漏，因为任何秩亏损都会表现为无法再现常应变。\n\nB. 对所有边界节点 $(i,j)$ 规定一个交替的“棋盘格”边界位移 $u_x(i,j) = \\Delta \\, (-1)^{i+j}$ 和 $u_y(i,j) = 0$，并通过在非零边界功的情况下出现零（或接近零）的反作用力来诊断沙漏。这揭示了沙漏，因为对于每个单元，围绕单元的节点 $u_x$ 模式 $[+,-,+,-]$ 在单点求积下产生零形心应变（因此内能为零），所以减缩积分刚度无法抵抗这种模式。标准线性场检验之所以失败，是因为仿射场引起的常应变在形心处被精确采样，因此尽管减缩积分 $Q4$ 单元易于出现沙漏，但它还是通过了检验。\n\nC. 在边界上规定一个刚体转动 $u_x = -\\theta y$，$u_y = \\theta x$，其中 $\\theta$ 为常数，并通过观察到零反作用力来检测沙漏。这揭示了沙漏，因为在非平凡位移下零反作用力意味着一个零能模式。线性场检验之所以失败，是因为它对转动不敏感。\n\nD. 仅在左右边缘规定一个交替的边界位移 $u_x(i,j) = \\Delta \\, (-1)^i$ 和 $u_y(i,j) = 0$，而上下边缘完全固定，并通过内部节点位移的非唯一性来诊断沙漏。这揭示了沙漏，因为交替模式将每个单元的形心应变减小到零。线性场检验失败的原因与选项 B 相同。\n\n选择唯一最佳选项。",
            "solution": "该问题要求评估候选的基于位移的斑块检验，以确定哪一个能正确揭示采用单点减缩积分的双线性四边形 ($Q4$) 单元 $2 \\times 2$ 网格中的沙漏不稳定性。问题陈述本身是科学合理的、适定的和客观的，为分析提供了有效的基础。\n\n首先，我们将确立单点积分 $Q4$ 单元的基本行为。单元内的位移场 $\\mathbf{u}(\\xi, \\eta)$ 是使用双线性形函数 $N_I(\\xi, \\eta) = \\frac{1}{4}(1+\\xi_I\\xi)(1+\\eta_I\\eta)$ 从其四个节点位移 $\\mathbf{d}_e$ 插值得到的，其中 $(\\xi, \\eta)$ 是在 $[-1, 1] \\times [-1, 1]$ 内的母单元坐标，$(\\xi_I, \\eta_I)$ 是节点 $I$ 的坐标。对于规则网格中边长为 $h$ 的方形单元，等参映射的雅可比矩阵是常数对角矩阵，$\\mathbf{J} = \\mathrm{diag}(h/2, h/2)$。\n\n应变张量分量由位移场的空间导数计算得出。例如，$\\varepsilon_{xx} = \\partial u_x / \\partial x$。使用链式法则，我们将空间导数与母单元域中的导数联系起来：\n$$ \\begin{Bmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\partial/\\partial \\xi \\\\ \\partial/\\partial \\eta \\end{Bmatrix} = \\begin{bmatrix} 2/h  0 \\\\ 0  2/h \\end{bmatrix} \\begin{Bmatrix} \\partial/\\partial \\xi \\\\ \\partial/\\partial \\eta \\end{Bmatrix} $$\n因此，应变分量可以用节点位移 $u_{xI}, u_{yI}$ 来表示。对于单点求积，这些应变仅在单元形心 $(\\xi, \\eta) = (0,0)$ 处进行计算。形函数在形心处的导数为：\n$$ \\frac{\\partial N_I}{\\partial \\xi}\\bigg|_{(0,0)} = \\frac{1}{4}\\xi_I \\quad \\text{和} \\quad \\frac{\\partial N_I}{\\partial \\eta}\\bigg|_{(0,0)} = \\frac{1}{4}\\eta_I $$\n设局部节点 $I=1,2,3,4$ 分别对应于母单元坐标 $(-1,-1), (1,-1), (1,1), (-1,1)$。形心处的应变分量变为：\n$$ \\varepsilon_{xx}|_{(0,0)} = \\sum_{I=1}^4 \\frac{\\partial N_I}{\\partial x}\\bigg|_{(0,0)} u_{xI} = \\frac{2}{h} \\sum_{I=1}^4 \\left(\\frac{1}{4}\\xi_I\\right) u_{xI} = \\frac{1}{2h}(-u_{x1} + u_{x2} + u_{x3} - u_{x4}) $$\n$$ \\varepsilon_{yy}|_{(0,0)} = \\sum_{I=1}^4 \\frac{\\partial N_I}{\\partial y}\\bigg|_{(0,0)} u_{yI} = \\frac{2}{h} \\sum_{I=1}^4 \\left(\\frac{1}{4}\\eta_I\\right) u_{yI} = \\frac{1}{2h}(-u_{y1} - u_{y2} + u_{y3} + u_{y4}) $$\n$$ \\gamma_{xy}|_{(0,0)} = \\sum_{I=1}^4 \\left( \\frac{\\partial N_I}{\\partial y}\\bigg|_{(0,0)} u_{xI} + \\frac{\\partial N_I}{\\partial x}\\bigg|_{(0,0)} u_{yI} \\right) = \\frac{1}{2h} [(-u_{x1}-u_{x2}+u_{x3}+u_{x4}) + (-u_{y1}+u_{y2}+u_{y3}-u_{y4})] $$\n伪零能模式，或称沙漏模式，是一种非刚体的节点位移模式，它在积分点处产生零应变。根据虚功原理，如果应变 $\\boldsymbol{\\varepsilon}$ 为零，则应力 $\\boldsymbol{\\sigma} = \\mathbf{C}\\boldsymbol{\\varepsilon}$ 也为零，导致内虚功为零，$\\int_{\\Omega} \\boldsymbol{\\sigma}:\\delta \\boldsymbol{\\varepsilon} \\, \\mathrm{d}\\Omega = 0$。这意味着单元刚度矩阵对此类变形模式没有抵抗力。\n\n一个经典的沙漏模式涉及形式为 $u_{xI} = \\Delta \\xi_I \\eta_I$ 和 $u_{yI} = 0$ 的位移。对于我们的节点排序，这对应于位移向量 $\\{u_{x1}, u_{x2}, u_{x3}, u_{x4}\\} = \\{\\Delta, -\\Delta, \\Delta, -\\Delta\\}$。将此代入应变方程：\n$$ \\varepsilon_{xx}|_{(0,0)} \\propto -(\\Delta) + (-\\Delta) + (\\Delta) - (-\\Delta) = 0 $$\n$$ \\gamma_{xy}|_{(0,0)} \\propto -(\\Delta) - (-\\Delta) + (\\Delta) + (-\\Delta) = 0 $$\n该位移模式是一种零能模式。这种模式是非物理的，是减缩积分方案的人为产物。\n\n标准斑块检验验证了单元精确再现常应变状态的能力。这对应于施加从仿射位移场 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_0 + \\mathbf{A}\\mathbf{x}$ 导出的边界条件。双线性 $Q4$ 单元可以精确表示任何线性多项式。因此，应变场在整个单元内将是恒定且精确的。在形心处计算该应变自然会得到正确的值。单元通过了检验。然而，这个检验对沙漏不稳定性是“盲目的”，因为常应变模式在数学上与更高阶的沙漏模式正交。一个旨在揭示沙漏的检验必须专门激发这些更高阶的模式。\n\n现在我们评估给定的选项。\n\n**A. 规定一个仿射边界位移场 $u_x = a x + b y$，$u_y = c x + d y$，其中 $a,b,c,d$ 为常数，并通过检查单元级常应变是否在单个高斯点处被再现来验证通过/失败。这能检测到沙漏，因为任何秩亏损都会表现为无法再现常应变。**\n\n这描述了标准线性位移斑块检验。如上所述，减缩积分 $Q4$ 单元*通过*了此检验。它正确地再现了常应变状态。该检验的成功证明了单元捕捉常应变的能力，但它完全未能探查沙漏。该检验能检测到沙漏的结论在事实上是错误的。因此，这个选项是不正确的。\n\n结论：**不正确**。\n\n**B. 对所有边界节点 $(i,j)$ 规定一个交替的“棋盘格”边界位移 $u_x(i,j) = \\Delta \\, (-1)^{i+j}$ 和 $u_y(i,j) = 0$，并通过在非零边界功的情况下出现零（或接近零）的反作用力来诊断沙漏。这揭示了沙漏，因为对于每个单元，围绕单元的节点 $u_x$ 模式 $[+,-,+,-]$ 在单点求积下产生零形心应变（因此内能为零），所以减缩积分刚度无法抵抗这种模式。标准线性场检验之所以失败，是因为仿射场引起的常应变在形心处被精确采样，因此尽管减缩积分 $Q4$ 单元易于出现沙漏，但它还是通过了检验。**\n\n让我们分析规定的位移。全局节点位于 $(x_i, y_j)$，其中 $i,j \\in \\{0,1,2\\}$。在整个网格上施加的位移 $u_x(i,j) = \\Delta (-1)^{i+j}$ 会在每个单元中激发沙漏模式。例如，考虑左下角的单元，其节点位于 $(0,0), (1,0), (1,1), (0,1)$。如果位于 $(1,1)$ 的自由中心节点位移为 $u_x(1,1) = \\Delta(-1)^{1+1} = \\Delta$，则该单元的 $u_x$ 节点位移，从节点 $(0,0)$ 开始逆时针移动，为 $\\{\\Delta, -\\Delta, \\Delta, -\\Delta\\}$。如初步分析所示，这种特定模式在单元形心处产生零应变。这对弹性片中的所有四个单元都成立。由于每个单元的应变为零，应力也为零，内能为零，因此从单元应力计算出的节点反作用力也为零。一个非平凡的规定位移场导致零反作用力，标志着一个零能模式，在本例中即为伪沙漏不稳定性。“非零边界功”这个说法略有不精确；功 $\\int \\bar{\\mathbf{t}} \\cdot \\mathbf{u} \\, \\mathrm{d}\\Gamma$ 为零，因为反作用力 $\\bar{\\mathbf{t}}$ 为零。关键的诊断标准是在非零规定位移下反作用力为零。关于此检验为何有效以及标准线性斑块检验为何失败的解释是完全正确的，并与有限元理论一致。\n\n结论：**正确**。\n\n**C. 在边界上规定一个刚体转动 $u_x = -\\theta y$，$u_y = \\theta x$，其中 $\\theta$ 为常数，并通过观察到零反作用力来检测沙漏。这揭示了沙漏，因为在非平凡位移下零反作用力意味着一个零能模式。线性场检验之所以失败，是因为它对转动不敏感。**\n\n一个由 $u_x = -\\theta y$ 和 $u_y = \\theta x$ 给出的小刚体转动是一个零应变状态：$\\varepsilon_{xx} = 0$, $\\varepsilon_{yy} = 0$, $\\gamma_{xy} = \\partial u_x/\\partial y + \\partial u_y/\\partial x = -\\theta + \\theta = 0$。任何有效的有限元列式都必须对任何刚体运动产生零应变和零应力。因此，观察到规定刚体转动下反作用力为零，仅仅证实了该单元能正确处理物理刚体模式。它并不能揭示像沙漏这样的*伪*模式。该陈述将物理零能模式与伪零能模式混为一谈。此外，“线性场检验之所以失败，是因为它对转动不敏感”的说法是错误的；刚体转动是仿射/线性场的一个特例，单元通过斑块检验的能力包括正确表示这种零应变状态。\n\n结论：**不正确**。\n\n**D. 仅在左右边缘规定一个交替的边界位移 $u_x(i,j) = \\Delta \\, (-1)^i$ 和 $u_y(i,j) = 0$，而上下边缘完全固定，并通过内部节点位移的非唯一性来诊断沙漏。这揭示了沙漏，因为交替模式将每个单元的形心应变减小到零。线性场检验失败的原因与选项 B 相同。**\n\n规定的边界条件是自相矛盾的。节点 $(0,0)$ 同时位于左边缘 ($i=0$) 和下边缘 ($j=0$)。左边缘规则规定 $u_x(0,0) = \\Delta(-1)^0 = \\Delta$，而下边缘规则要求其完全固定，即 $u_x(0,0)=0$。这些条件不能同时施加。此外，对于左边缘 ($i=0$) 的规定 $u_x(i,j) = \\Delta(-1)^i$ 意味着该边缘上所有节点的 $u_x$ 均为 $\\Delta$，这并非沿着边缘的“交替”模式。所提出的检验定义不清。即使我们试图重新解释其意图，其描述也因缺陷太多而不能被认为是正确的。\n\n结论：**不正确**。\n\n基于严谨的分析，选项 B 提供了唯一正确的、旨在揭示沙漏的斑块检验的描述，以及对其机理和标准线性斑块检验失败原因的正确解释。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "在实施沙漏控制方案后，验证其在真实世界场景中的可靠性至关重要。本实践引入“噪声分片检验”（noisy patch test），用于评估沙漏控制在非理想网格上的稳健性。通过在一个随机扰动的网格上测量残余力，您将评估您所采用的稳定化方法是否在抑制伪模式的同时保持了求解精度，这是开发可靠数值仿真工具的关键一步 。",
            "id": "3602244",
            "problem": "要求您构建并分析一个带噪声的薄片测试（noisy patch test），该测试用于二维、小应变、线弹性、四边形有限元离散化，并采用带有沙漏控制的减缩积分。薄片测试旨在检验当节点坐标受到小的、受控的噪声振幅扰动时，网格上是否能精确地（在离散弱形式意义上）再现线性位移场。您的任务是规范化该测试，计算稳健性度量与扰动振幅的关系，并报告指定测试套件的结果。\n\n您必须仅从基本原理出发：虚功原理、小应变运动学和线弹性本构行为。然后，您将实现一个算法，该算法在施加的线性位移场下，为有和没有几何扰动的四边形网格组装全局内力向量，并对每个减缩积分单元应用沙漏控制。您必须在平面应变条件下工作。本问题陈述中所有的物理量、数学实体、算子和数字均以 LaTeX 格式书写。\n\n基本原理：\n- 虚功原理：对于占据域 $\\Omega$ 且边界为 $\\partial \\Omega$ 的物体，在体力为零和边界 $\\partial \\Omega$ 上施加位移的情况下，其弱形式表述为\n$$\n\\int_{\\Omega} \\boldsymbol{\\sigma} : \\delta \\boldsymbol{\\varepsilon} \\, d\\Omega = 0 \\quad \\text{对所有容许的 } \\delta \\mathbf{u}。\n$$\n- 小应变运动学：线性化应变为\n$$\n\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\tfrac{1}{2}\\left( \\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{T} \\right).\n$$\n- 平面应变中的线弹性：应力-应变定律为\n$$\n\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon},\n$$\n其中 $\\mathbb{C}$ 是四阶弹性张量。在使用工程剪切应变 $\\gamma_{xy} = 2 \\varepsilon_{xy}$ 的矩阵形式中，平面应变的本构矩阵为\n$$\n\\mathbf{C} = \n\\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix},\n$$\n其中拉梅参数(Lamé parameters)为 $\\lambda = \\dfrac{E \\nu}{(1+\\nu)(1-2\\nu)}$ 和 $\\mu = \\dfrac{E}{2(1+\\nu)}$，$E$ 是杨氏模量(Young’s modulus)，$\\nu$ 是泊松比(Poisson’s ratio)。\n\n几何、网格和测试设置：\n- 考虑单位正方形 $\\Omega = [0,1]\\times[0,1]$，单位为米。使用 $N_x \\times N_y$ 个双线性($Q_1$)四边形单元的结构化网格对 $\\Omega$ 进行离散化，其中 $N_x = N_y = 4$。设节点 $a$ 的节点坐标向量为 $\\mathbf{x}_a = (x_a, y_a)$，单位为米。单元尺寸为 $h = 1/N_x$。\n- 定义一个线性位移场 $\\mathbf{u}^{\\text{lin}}(\\mathbf{x}) = \\mathbf{G}\\,\\mathbf{x}$，其中 $\\mathbf{G} \\in \\mathbb{R}^{2\\times 2}$。选择\n$$\n\\mathbf{G} = \n\\begin{bmatrix}\n0.01  0.02 \\\\\n-0.015  0.005\n\\end{bmatrix},\n$$\n因此 $u_x = 0.01\\,x + 0.02\\,y$ 且 $u_y = -0.015\\,x + 0.005\\,y$。这将在 $\\Omega$ 上产生恒定的应变和应力。\n- 将场 $\\mathbf{u}^{\\text{lin}}$ 作为指定位移施加在 $\\partial\\Omega$ 的所有边界节点上。不施加体力，也不施加面力；反作用力产生于 $\\partial\\Omega$ 上。\n- 使用每个单元单点减缩积分来组装全局节点内力向量 $\\mathbf{f}^{\\text{int}}(\\mathbf{u}^{\\text{lin}})$，以计算标准刚度贡献。在自然坐标 $(\\xi,\\eta)=(0,0)$ 处使用单个高斯点(Gauss point)，权重为 $w=4$。\n- 在单元级别上，通过对减缩积分沙漏模式进行简单的罚函数法来添加沙漏控制。对于一个节点逆时针排序的四节点四边形单元，定义两个标量沙漏模式向量\n$$\n\\mathbf{q}_1 = \\tfrac{1}{2}\\begin{bmatrix}1 \\\\ -1 \\\\ 1 \\\\ -1\\end{bmatrix}, \\quad\n\\mathbf{q}_2 = \\tfrac{1}{2}\\begin{bmatrix}1 \\\\ 1 \\\\ -1 \\\\ -1\\end{bmatrix}.\n$$\n设单元面积为 $A_e$。设 $\\mu$ 为剪切模量。选择沙漏控制系数 $\\gamma = 0.1$。每个单元的沙漏刚度贡献独立作用于两个位移分量，其表达式为\n$$\n\\mathbf{K}_e^{\\text{hg}} = \\gamma\\,\\mu\\,A_e\n\\begin{bmatrix}\n\\sum_{m=1}^{2}\\mathbf{q}_m \\mathbf{q}_m^{T}  \\mathbf{0} \\\\\n\\mathbf{0}  \\sum_{m=1}^{2}\\mathbf{q}_m \\mathbf{q}_m^{T}\n\\end{bmatrix}.\n$$\n总单元刚度是减缩积分弹性刚度与 $\\mathbf{K}_e^{\\text{hg}}$ 的和。\n- 不要扰动边界节点的坐标。仅通过向内部节点的坐标 $(x,y)$ 添加从 $[-\\epsilon h, \\epsilon h]$ 中抽取的独立均匀随机噪声 $(\\delta x, \\delta y)$ 来扰动它们，其中 $\\epsilon \\ge 0$ 是扰动振幅， $h$ 是单元尺寸。使用固定的伪随机种子以使扰动可复现。未扰动的网格对应于 $\\epsilon=0$。\n\n稳健性度量：\n- 离散薄片测试要求当 $\\mathbf{u}^{\\text{lin}}$ 施加在边界上时，内部节点的内力为零。用 $\\mathbf{r}_{\\text{free}}$ 表示 $\\mathbf{f}^{\\text{int}}(\\mathbf{u}^{\\text{lin}})$ 中仅限于所有内部自由度（即不在 $\\partial \\Omega$ 上的自由度）的子向量。定义稳健性度量\n$$\nR(\\epsilon) = \\frac{\\lVert \\mathbf{r}_{\\text{free}} \\rVert_2}{S_0\\,L_{\\partial \\Omega}},\n$$\n其中 $L_{\\partial \\Omega}=4$ 是总边界长度，单位为米，而 $S_0$ 是一个应力量纲，根据由 $\\mathbf{u}^{\\text{lin}}$ 引起的精确恒定平面内柯西应力(Cauchy stress) $\\boldsymbol{\\sigma}^{\\text{exact}}$ 计算得出。使用\n$$\n\\boldsymbol{\\varepsilon}^{\\text{exact}} = \\tfrac{1}{2}\\left(\\mathbf{G} + \\mathbf{G}^{T}\\right), \\quad \\gamma_{xy}^{\\text{exact}} = G_{12} + G_{21}, \\quad\n\\mathbf{e}^{\\text{eng}} =\n\\begin{bmatrix}\n\\varepsilon_{xx}^{\\text{exact}} \\\\ \\varepsilon_{yy}^{\\text{exact}} \\\\ \\gamma_{xy}^{\\text{exact}}\n\\end{bmatrix}, \\quad\n\\boldsymbol{\\sigma}^{\\text{exact}} =\n\\begin{bmatrix}\n\\sigma_{xx} \\\\ \\sigma_{yy} \\\\ \\sigma_{xy}\n\\end{bmatrix} = \\mathbf{C}\\, \\mathbf{e}^{\\text{eng}},\n$$\n并定义平面内应力大小\n$$\nS_0 = \\sqrt{\\sigma_{xx}^2 + \\sigma_{yy}^2 + 2\\,\\sigma_{xy}^2}.\n$$\n度量 $R(\\epsilon)$ 是无量纲的，必须以浮点数形式报告。\n\n材料参数和单位：\n- 使用平面应变条件，$E = 210\\times 10^{9}$ 帕斯卡，$\\nu = 0.3$。所有长度单位为米，力单位为牛顿，应力单位为帕斯卡。稳健性度量 $R(\\epsilon)$ 是无量纲的，报告时不得带单位。\n\n测试套件：\n- 使用 $N_x = N_y = 4$。\n- 使用以下扰动振幅（无量纲）：$\\epsilon \\in \\{ 0, 10^{-6}, 10^{-4}, 10^{-3}, 10^{-2}, 5\\times 10^{-2} \\}$。\n- 对于每个 $\\epsilon$，生成由 $\\epsilon$ 缩放的相同基础随机扰动模式（将随机种子固定为指定值）。\n\n任务：\n- 实现一个程序，该程序为测试套件中的每个 $\\epsilon$ 构建网格、施加扰动，组装带有沙漏控制的全局减缩积分刚度，在施加的边界位移 $\\mathbf{u}^{\\text{lin}}$ 下计算内力向量，提取 $\\mathbf{r}_{\\text{free}}$，计算 $R(\\epsilon)$，并按测试套件的顺序输出 $R(\\epsilon)$ 值的列表。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\dots]$）。每个 $r_i$ 必须是测试套件中对应 $\\epsilon_i$ 的 $R(\\epsilon_i)$ 的浮点值，并按指定顺序排列。\n\n角度单位不适用。除单行列表外，不要打印任何额外文本。稳健性度量是无量纲的，不应打印任何物理单位。",
            "solution": "此问题经评估有效。它在计算固体力学方面有科学依据，问题提法恰当、客观，并为带噪声的薄片测试分析提供了完整且一致的设置。因此，我们可以着手求解。\n\n### 1. 理论公式\n\n分析的基础是处于静力平衡状态物体的虚功原理。对于一个域为 $\\Omega$、体力为零且在边界 $\\partial\\Omega$ 上有指定位移的物体，该原理指出内部虚功等于外部虚功。在内部没有外力的情况下，弱形式为：\n$$\n\\int_{\\Omega} \\boldsymbol{\\sigma} : \\delta \\boldsymbol{\\varepsilon} \\, d\\Omega = 0\n$$\n对于所有在位移指定边界上为零的运动学容许虚位移 $\\delta\\mathbf{u}$。在有限元方法 (FEM) 的背景下，此积分方程在一个单元网格上被离散化。离散形式导致了一个关于节点未知数的代数方程组。对于本问题，施加了一个位移场，我们必须计算相应的节点内力。全局内力向量 $\\mathbf{f}^{\\text{int}}$ 由单元级贡献 $\\mathbf{f}_e^{\\text{int}}$ 组装而成：\n$$\n\\mathbf{f}^{\\text{int}} = \\underset{e}{\\mathbf{A}} \\, \\mathbf{f}_e^{\\text{int}}\n$$\n其中 $\\mathbf{A}$ 是组装算子。单元内力向量由下式给出：\n$$\n\\mathbf{f}_e^{\\text{int}} = \\int_{\\Omega_e} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, d\\Omega_e\n$$\n这里，$\\Omega_e$ 是单元域，$\\boldsymbol{\\sigma}$ 是柯西应力张量(Cauchy stress tensor)，$\\mathbf{B}$ 是连接节点位移 $\\mathbf{u}_e$ 与应变场 $\\boldsymbol{\\varepsilon} = \\mathbf{B}\\mathbf{u}_e$ 的应变-位移矩阵。\n\n### 2. 物理与本构模型\n\n我们在小应变运动学和平面应变状态下的线弹性假设下进行操作。\n应变-位移关系为 $\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$。\n本构定律为 $\\boldsymbol{\\sigma} = \\mathbb{C}:\\boldsymbol{\\varepsilon}$，其中 $\\mathbb{C}$ 是四阶弹性张量。使用带有工程剪切应变 $\\gamma_{xy} = 2\\varepsilon_{xy}$ 的 Voigt 记法，应力向量和应变向量分别为 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^T$ 和 $\\mathbf{e}^{\\text{eng}} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$。本构矩阵 $\\mathbf{C}$ 为：\n$$\n\\mathbf{C} =\n\\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix}\n$$\n拉梅参数(Lamé parameters) $\\lambda$ 和 $\\mu$ 由杨氏模量 $E = 210 \\times 10^9 \\, \\text{Pa}$ 和泊松比 $\\nu=0.3$ 计算得出：\n$$\n\\mu = \\frac{E}{2(1+\\nu)} \\approx 8.077 \\times 10^{10} \\, \\text{Pa}\n\\quad \\text{和} \\quad\n\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)} \\approx 1.212 \\times 10^{11} \\, \\text{Pa}\n$$\n\n### 3. 有限元离散化\n\n域 $\\Omega=[0,1]\\times[0,1]$ 被离散为 $4 \\times 4$ 个双线性四边形 ($Q_1$) 单元。\n对于一个有4个节点的 $Q_1$ 单元，几何场和位移场使用相同的形函数 $N_a(\\xi, \\eta)$ 从节点值进行插值，其中 $(\\xi, \\eta)$ 是 $[-1,1]\\times[-1,1]$ 中的自然坐标：\n$$\n\\mathbf{x}(\\xi, \\eta) = \\sum_{a=1}^4 N_a(\\xi, \\eta) \\mathbf{x}_a^e, \\quad \\mathbf{u}(\\xi, \\eta) = \\sum_{a=1}^4 N_a(\\xi, \\eta) \\mathbf{u}_a^e\n$$\n应变-位移矩阵 $\\mathbf{B}$ 由形函数的空间导数导出。所需的导数通过链式法则和等参映射的雅可比矩阵(Jacobian) $\\mathbf{J}$ 求得：\n$$\n\\begin{Bmatrix} \\partial N_a / \\partial x \\\\ \\partial N_a / \\partial y \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\partial N_a / \\partial \\xi \\\\ \\partial N_a / \\partial \\eta \\end{Bmatrix}\n$$\n\n### 4. 减缩积分与沙漏控制\n\n问题指定在单元中心 $(\\xi, \\eta) = (0,0)$ 处进行单点（减缩）积分，权重为 $w=4$。单元内力的积分近似为：\n$$\n\\mathbf{f}_e^{\\text{int}} = \\int_{\\Omega_e} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, d\\Omega_e \\approx A_e (\\mathbf{B}(0,0)^T \\boldsymbol{\\sigma}(0,0))\n$$\n其中 $A_e$ 是单元面积。使用单点积分，面积近似为 $A_e \\approx 4 \\det(\\mathbf{J}(0,0))$。中心的应力为 $\\boldsymbol{\\sigma}(0,0) = \\mathbf{C} \\mathbf{B}(0,0) \\mathbf{u}_e$。这给出了内力向量的标准部分：\n$$\n\\mathbf{f}_{e, \\text{std}}^{\\text{int}} = A_e \\mathbf{B}(0,0)^T \\mathbf{C} \\mathbf{B}(0,0) \\mathbf{u}_e\n$$\n减缩积分会引入伪零能模式，称为沙漏现象，必须对其进行稳定化处理。问题指定了一个基于罚函数的沙漏控制方案。沙漏刚度矩阵由下式给出：\n$$\n\\mathbf{K}_e^{\\text{hg}} = \\gamma\\,\\mu\\,A_e\n\\begin{bmatrix}\n\\mathbf{Q}  \\mathbf{0} \\\\\n\\mathbf{0}  \\mathbf{Q}\n\\end{bmatrix}, \\quad \\text{其中} \\quad \\mathbf{Q} = \\sum_{m=1}^{2}\\mathbf{q}_m \\mathbf{q}_m^{T}\n$$\n其中 $\\gamma=0.1$，沙漏模式向量为 $\\mathbf{q}_1 = \\tfrac{1}{2}[1, -1, 1, -1]^T$ 和 $\\mathbf{q}_2 = \\tfrac{1}{2}[1, 1, -1, -1]^T$。沙漏力的贡献是：\n$$\n\\mathbf{f}_{e, \\text{hg}}^{\\text{int}} = \\mathbf{K}_e^{\\text{hg}} \\mathbf{u}_e\n$$\n总单元内力向量是标准贡献和沙漏贡献之和：$\\mathbf{f}_e^{\\text{int}} = \\mathbf{f}_{e, \\text{std}}^{\\text{int}} + \\mathbf{f}_{e, \\text{hg}}^{\\text{int}}$。\n\n### 5. 薄片测试流程与稳健性度量\n\n薄片测试验证了该公式是否能精确再现恒定应变状态。一个线性位移场 $\\mathbf{u}^{\\text{lin}}(\\mathbf{x}) = \\mathbf{G}\\mathbf{x}$ 被施加到网格上，其中：\n$$\n\\mathbf{G} = \\begin{bmatrix} 0.01  0.02 \\\\ -0.015  0.005 \\end{bmatrix}\n$$\n该场对应于一个恒定应变状态。对于一个完美的（未扰动的）网格，所有内部节点的净内力应为零。“带噪声的”薄片测试通过扰动内部节点坐标来评估公式的稳健性。每个内部节点的坐标 $(x_a, y_a)$ 被移动到 $(x_a + \\delta x_a, y_a + \\delta y_a)$，其中 $\\delta x_a, \\delta y_a$ 从均匀分布 $U[-\\epsilon h, \\epsilon h]$ 中抽取，$\\epsilon$ 是扰动振幅，$h=0.25$ 是单元尺寸。\n\n稳健性由度量 $R(\\epsilon)$ 量化：\n$$\nR(\\epsilon) = \\frac{\\lVert \\mathbf{r}_{\\text{free}} \\rVert_2}{S_0\\,L_{\\partial \\Omega}}\n$$\n其中 $\\mathbf{r}_{\\text{free}}$ 是全局内力 $\\mathbf{f}^{\\text{int}}$ 中对应于内部节点自由度的子向量。$L_{\\partial\\Omega}=4\\,m$ 是边界长度。应力量纲 $S_0$ 从与 $\\mathbf{u}^{\\text{lin}}$ 对应的精确应力状态推导而来：\n1. 计算精确的工程应变向量：$\\mathbf{e}^{\\text{eng}} = [ G_{11}, G_{22}, G_{12}+G_{21} ]^T = [0.01, 0.005, 0.005]^T$。\n2. 计算精确的应力向量：$\\boldsymbol{\\sigma}^{\\text{exact}} = \\mathbf{C} \\mathbf{e}^{\\text{eng}} \\approx [3.433, 2.625, 0.404]^T \\times 10^9 \\, \\text{Pa}$。\n3. 计算应力大小：$S_0 = \\sqrt{\\sigma_{xx}^2 + \\sigma_{yy}^2 + 2\\sigma_{xy}^2} \\approx 4.359 \\times 10^9 \\, \\text{Pa}$。\n\n分母 $S_0 L_{\\partial \\Omega}$ 为残余力范数提供了一个一致的归一化因子。对于测试套件 $\\{0, 10^{-6}, 10^{-4}, 10^{-3}, 10^{-2}, 5\\times 10^{-2}\\}$ 中的每个 $\\epsilon$ 值，我们构建扰动后的网格，组装内力向量 $\\mathbf{f}^{\\text{int}}$，提取残差 $\\mathbf{r}_{\\text{free}}$，并计算 $R(\\epsilon)$。固定的随机种子确保噪声模式是可复现的，并且只受 $\\epsilon$ 缩放。\n\n当 $\\epsilon=0$ 时，网格是规则的，线性位移场应导致沙漏力为零，并且内部节点的标准内力完全平衡。因此，我们预期 $R(0) \\approx 0$（在浮点精度范围内）。当 $\\epsilon > 0$ 时，单元畸变会导致非零的残余力，且 $R(\\epsilon)$ 预计会随 $\\epsilon$ 的增大而增大。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes a noisy patch test for a 2D quadrilateral finite element\n    discretization with reduced integration and hourglass control.\n    \"\"\"\n    # 1. Define constants and parameters from the problem statement.\n    E = 210e9  # Young's modulus in Pascals\n    nu = 0.3  # Poisson's ratio\n    G_mat = np.array([[0.01, 0.02], [-0.015, 0.005]])  # Displacement gradient\n    Nx = 4  # Number of elements in x-direction\n    Ny = 4  # Number of elements in y-direction\n    gamma_hg = 0.1  # Hourglass control coefficient\n    epsilons = [0.0, 1e-6, 1e-4, 1e-3, 1e-2, 5e-2]  # Perturbation amplitudes\n    L_boundary = 4.0  # Total boundary length in meters\n    seed = 0  # Fixed pseudorandom seed for reproducibility\n\n    # 2. Pre-computation: Material properties and Stress Scale S0\n    mu = E / (2 * (1 + nu))\n    lambda_lame = E * nu / ((1 + nu) * (1 - 2 * nu))\n    C_mat = np.array([\n        [lambda_lame + 2 * mu, lambda_lame, 0],\n        [lambda_lame, lambda_lame + 2 * mu, 0],\n        [0, 0, mu]\n    ])\n\n    eps_exact_tensor = 0.5 * (G_mat + G_mat.T)\n    # Engineering strain vector [eps_xx, eps_yy, gamma_xy]\n    eps_exact_eng = np.array([\n        eps_exact_tensor[0, 0],\n        eps_exact_tensor[1, 1],\n        2 * eps_exact_tensor[0, 1]\n    ])\n    sigma_exact = C_mat @ eps_exact_eng\n    S0 = np.sqrt(sigma_exact[0]**2 + sigma_exact[1]**2 + 2 * sigma_exact[2]**2)\n\n    # 3. Define element-level quantities (hourglass, shape functions)\n    q1 = 0.5 * np.array([1, -1, 1, -1])\n    q2 = 0.5 * np.array([1, 1, -1, -1])\n    Q_hg = np.outer(q1, q1) + np.outer(q2, q2)\n    K_hg_block = gamma_hg * mu * Q_hg\n\n    # Shape function derivatives at (xi, eta) = (0,0) w.r.t. parent coords\n    dNdxi_eta_0 = 0.25 * np.array([\n        [-1, 1, 1, -1],  # dN/dxi for nodes 1-4\n        [-1, -1, 1, 1]   # dN/deta for nodes 1-4\n    ])\n\n    results = []\n\n    # 4. Generate base random perturbations to be scaled by epsilon\n    np.random.seed(seed)\n    num_interior_nodes = (Nx - 1) * (Ny - 1)\n    base_perturbations = np.random.uniform(-1.0, 1.0, (num_interior_nodes, 2))\n\n    # 5. Main loop over perturbation amplitudes\n    for epsilon in epsilons:\n        # a. Generate Mesh and Displacements\n        h = 1.0 / Nx\n        num_nodes_x = Nx + 1\n        num_nodes_y = Ny + 1\n        num_nodes = num_nodes_x * num_nodes_y\n        num_elements = Nx * Ny\n\n        coords = np.zeros((num_nodes, 2))\n        node_is_interior = np.zeros(num_nodes, dtype=bool)\n        \n        pert_idx = 0\n        for j in range(num_nodes_y):\n            for i in range(num_nodes_x):\n                node_id = j * num_nodes_x + i\n                coords[node_id, 0] = i * h\n                coords[node_id, 1] = j * h\n                if 0  i  Nx and 0  j  Ny:\n                    node_is_interior[node_id] = True\n                    perturb_vec = epsilon * h * base_perturbations[pert_idx, :]\n                    coords[node_id, :] += perturb_vec\n                    pert_idx += 1\n\n        elements = np.zeros((num_elements, 4), dtype=int)\n        for j in range(Ny):\n            for i in range(Nx):\n                el_id = j * Nx + i\n                n0 = j * num_nodes_x + i\n                n1 = n0 + 1\n                n2 = n1 + num_nodes_x\n                n3 = n0 + num_nodes_x\n                elements[el_id, :] = [n0, n1, n2, n3]\n\n        displacements_global = (G_mat @ coords.T).T\n\n        # b. Assemble Global Internal Force Vector\n        F_internal_global = np.zeros(2 * num_nodes)\n\n        for el_id in range(num_elements):\n            node_ids = elements[el_id, :]\n            elem_coords = coords[node_ids, :]\n            \n            u_e_x = displacements_global[node_ids, 0]\n            u_e_y = displacements_global[node_ids, 1]\n            u_e = np.hstack([u_e_x, u_e_y])\n\n            # Jacobian at element center (0,0)\n            J0 = dNdxi_eta_0 @ elem_coords\n            detJ0 = np.linalg.det(J0)\n            if detJ0 = 0:\n                # This should not happen for small perturbations\n                raise ValueError(f\"Element {el_id} has zero or negative Jacobian determinant.\")\n            \n            # Gradients of shape functions w.r.t. global coords (x,y)\n            dNdxy_0 = np.linalg.inv(J0) @ dNdxi_eta_0\n            \n            # Strain-displacement matrix B at (0,0)\n            B0 = np.zeros((3, 8))\n            for a in range(4):\n                B0[0, a]     = dNdxy_0[0, a]  # du_x/dx\n                B0[1, a + 4] = dNdxy_0[1, a]  # du_y/dy\n                B0[2, a]     = dNdxy_0[1, a]  # du_x/dy\n                B0[2, a + 4] = dNdxy_0[0, a]  # du_y/dx\n\n            # Element area approximation from 1-point quadrature with weight w=4\n            elem_area = detJ0 * 4.0\n            \n            # Internal forces from standard stiffness\n            eps_e_0 = B0 @ u_e\n            F_std_e = elem_area * (B0.T @ (C_mat @ eps_e_0))\n\n            # Internal forces from hourglass control\n            K_hg_full = np.block([\n                [K_hg_block * elem_area, np.zeros((4,4))],\n                [np.zeros((4,4)), K_hg_block * elem_area]\n            ])\n            F_hg_e = K_hg_full @ u_e\n\n            F_int_e = F_std_e + F_hg_e\n\n            # Assemble into global force vector\n            for a in range(4):\n                F_internal_global[2 * node_ids[a]]     += F_int_e[a]\n                F_internal_global[2 * node_ids[a] + 1] += F_int_e[a + 4]\n\n        # c. Compute Robustness Metric R(epsilon)\n        interior_dofs = []\n        for i in range(num_nodes):\n            if node_is_interior[i]:\n                interior_dofs.extend([2 * i, 2 * i + 1])\n        \n        r_free = F_internal_global[interior_dofs]\n        R_eps = np.linalg.norm(r_free) / (S0 * L_boundary)\n        results.append(R_eps)\n    \n    # 6. Final printout in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}