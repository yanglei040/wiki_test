{
    "hands_on_practices": [
        {
            "introduction": "Before writing a single line of code, a robust understanding of any numerical method begins with its mathematical foundation. This exercise guides you through the essential first-principles derivation of the Selective Reduced Integration (SRI) stiffness matrix. By starting from the split of the elastic strain energy into volumetric and deviatoric components, you will see how applying different quadrature rules to each part directly translates into the final element stiffness formulation . This practice solidifies the theoretical underpinnings of why SRI works.",
            "id": "3599144",
            "problem": "Consider a two-dimensional small-strain isotropic solid discretized by the Finite Element Method (FEM), using a single bilinear quadrilateral element ($Q_4$) that occupies the rectangular domain with nodes at $(0,0)$, $(a,0)$, $(a,b)$, and $(0,b)$ in physical coordinates. The stored energy density is split into volumetric and deviatoric parts according to\n$$\nW = \\tfrac{1}{2}K\\big(\\operatorname{tr}\\epsilon\\big)^{2} + \\mu\\,\\epsilon_{\\text{dev}}:\\epsilon_{\\text{dev}},\n$$\nwhere $K$ is the bulk modulus, $\\mu$ is the shear modulus, $\\epsilon$ is the small-strain tensor, and $\\epsilon_{\\text{dev}} = \\epsilon - \\tfrac{1}{2}(\\operatorname{tr}\\epsilon)\\,\\mathbf{I}$ is the two-dimensional deviatoric strain (with $\\mathbf{I}$ the identity). The parent-space bilinear shape functions $N_{i}(\\xi,\\eta)$, $i=1,\\dots,4$, are defined on $[-1,1]\\times[-1,1]$, and the isoparametric map for the rectangle is affine, with Jacobian determinant $|J|=ab/4$.\n\nStarting from this energy density and the principle of virtual work, derive the element-level stiffness matrix split into volumetric and deviatoric contributions and implement Selective Reduced Integration (SRI): evaluate the volumetric contribution with one-point Gauss quadrature at $(\\xi,\\eta)=(0,0)$ with weight $4$, and evaluate the deviatoric contribution with the $2\\times 2$ Gauss rule at $(\\xi,\\eta)=\\big(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3}\\big)$ with unit weights. Use the two-dimensional Voigt notation for strains and stresses, with the strain-displacement matrix $B(\\xi,\\eta)$ constructed from $N_{i,x}(\\xi,\\eta)$ and $N_{i,y}(\\xi,\\eta)$, where $N_{i,x}=(2/a)\\,N_{i,\\xi}$ and $N_{i,y}=(2/b)\\,N_{i,\\eta}$ and\n$$\nN_{1}=\\tfrac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_{2}=\\tfrac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_{3}=\\tfrac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_{4}=\\tfrac{1}{4}(1-\\xi)(1+\\eta),\n$$\nwith\n$$\nN_{1,\\xi}=-\\tfrac{1}{4}(1-\\eta),\\quad\nN_{2,\\xi}=\\tfrac{1}{4}(1-\\eta),\\quad\nN_{3,\\xi}=\\tfrac{1}{4}(1+\\eta),\\quad\nN_{4,\\xi}=-\\tfrac{1}{4}(1+\\eta),\n$$\nand\n$$\nN_{1,\\eta}=-\\tfrac{1}{4}(1-\\xi),\\quad\nN_{2,\\eta}=-\\tfrac{1}{4}(1+\\xi),\\quad\nN_{3,\\eta}=\\tfrac{1}{4}(1+\\xi),\\quad\nN_{4,\\eta}=\\tfrac{1}{4}(1-\\xi).\n$$\nExpress the final stiffness matrix as a single closed-form analytic expression in terms of $a$, $b$, $K$, $\\mu$, and the strain-displacement matrix $B(\\xi,\\eta)$. Your final answer must be a calculation, specifically the single analytic expression for the SRI-computed element stiffness. No numerical rounding is required.",
            "solution": "The problem asks for the derivation of the element-level stiffness matrix for a specific case of a two-dimensional, small-strain, isotropic solid discretized by a single bilinear quadrilateral ($Q_4$) element. The derivation must employ the technique of Selective Reduced Integration (SRI).\n\nThe general expression for the element stiffness matrix $k^e$ in the Finite Element Method for linear elasticity is obtained from the principle of virtual work and is given by the integral over the element's volume $\\Omega^e$:\n$$\nk^e = \\int_{\\Omega^e} B^T D B \\, d\\Omega\n$$\nwhere $B$ is the strain-displacement matrix, and $D$ is the constitutive matrix relating stress and strain in Voigt notation.\n\nFor an isoparametric element, this integral is transformed to the parent domain, which is a square $[-1,1]\\times[-1,1]$ in $(\\xi, \\eta)$ coordinates. The differential volume element becomes $d\\Omega = t|J|d\\xi d\\eta$, where $t$ is the element thickness (we assume $t=1$) and $|J|$ is the determinant of the Jacobian of the coordinate mapping. The problem specifies that for the given rectangular element, $|J| = ab/4$. The stiffness matrix integral is thus:\n$$\nk^e = \\int_{-1}^{1} \\int_{-1}^{1} B(\\xi, \\eta)^T D B(\\xi, \\eta) \\left(\\frac{ab}{4}\\right) d\\xi d\\eta\n$$\n\nThe problem specifies a decomposition of the stored energy density $W$ into volumetric and deviatoric parts:\n$$\nW = W_{vol} + W_{dev} = \\tfrac{1}{2}K\\big(\\operatorname{tr}\\epsilon\\big)^{2} + \\mu\\,\\epsilon_{\\text{dev}}:\\epsilon_{\\text{dev}}\n$$\nThis energy decomposition leads to a corresponding additive split of the constitutive matrix $D = D_{vol} + D_{dev}$. We derive these matrices for a 2D problem using Voigt notation with the strain vector $\\boldsymbol{\\epsilon} = [\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}]^T$, where $\\gamma_{xy} = 2\\epsilon_{xy}$ is the engineering shear strain.\n\nThe volumetric energy term is $W_{vol} = \\frac{1}{2}K(\\epsilon_{xx}+\\epsilon_{yy})^2$. In the quadratic form $\\frac{1}{2}\\boldsymbol{\\epsilon}^T D_{vol} \\boldsymbol{\\epsilon}$, this corresponds to the volumetric constitutive matrix:\n$$\nD_{vol} = K \\begin{pmatrix} 1 & 1 & 0 \\\\ 1 & 1 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n\nThe deviatoric energy term is $W_{dev} = \\mu\\,\\epsilon_{\\text{dev}}:\\epsilon_{\\text{dev}}$. For a 2D strain state, the deviatoric strain tensor is $\\epsilon_{dev} = \\epsilon - \\tfrac{1}{2}(\\operatorname{tr}\\epsilon)\\mathbf{I}$, and the term $\\epsilon_{dev}:\\epsilon_{dev}$ becomes $\\frac{1}{2}(\\epsilon_{xx}-\\epsilon_{yy})^2 + \\frac{1}{2}\\gamma_{xy}^2$. Thus, $W_{dev} = \\frac{\\mu}{2}\\left((\\epsilon_{xx}-\\epsilon_{yy})^2 + \\gamma_{xy}^2\\right)$. In the quadratic form $\\frac{1}{2}\\boldsymbol{\\epsilon}^T D_{dev} \\boldsymbol{\\epsilon}$, this corresponds to the deviatoric constitutive matrix:\n$$\nD_{dev} = \\mu \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nWith the constitutive matrix split, the stiffness matrix is also split:\n$$\nk^e = k^e_{vol} + k^e_{dev} = \\frac{ab}{4} \\int_{-1}^{1} \\int_{-1}^{1} B^T D_{vol} B \\, d\\xi d\\eta + \\frac{ab}{4} \\int_{-1}^{1} \\int_{-1}^{1} B^T D_{dev} B \\, d\\xi d\\eta\n$$\n\nThe Selective Reduced Integration (SRI) method evaluates these two integrals using different numerical quadrature rules.\n1.  The volumetric part, $k^e_{vol}$, is integrated using a one-point Gauss quadrature rule. The single quadrature point is $(\\xi_v, \\eta_v) = (0,0)$ with a weight of $w_v = 4$. The integral is approximated as:\n$$\nk^e_{vol} \\approx \\frac{ab}{4} \\left( w_v \\cdot B^T(0,0) D_{vol} B(0,0) \\right) = \\frac{ab}{4} \\left( 4 \\cdot B^T(0,0) D_{vol} B(0,0) \\right) = ab B^T(0,0) D_{vol} B(0,0)\n$$\n\n2.  The deviatoric part, $k^e_{dev}$, is integrated using a $2\\times2$ Gauss quadrature rule. This involves four quadrature points, denoted as $(\\xi_j, \\eta_j)$ for $j=1, \\dots, 4$, which are $(\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$. Each point has a weight of $w_j=1$. The integral is approximated by a sum over these four points:\n$$\nk^e_{dev} \\approx \\frac{ab}{4} \\sum_{j=1}^{4} \\left( w_j \\cdot B^T(\\xi_j, \\eta_j) D_{dev} B(\\xi_j, \\eta_j) \\right) = \\frac{ab}{4} \\sum_{j=1}^{4} B^T(\\xi_j, \\eta_j) D_{dev} B(\\xi_j, \\eta_j)\n$$\n\nCombining the two parts gives the final expression for the SRI-computed element stiffness matrix. The question asks for this expression in terms of the given parameters and the matrix $B(\\xi, \\eta)$. We substitute the derived matrices $D_{vol}$ and $D_{dev}$ into the expressions for $k^e_{vol}$ and $k^e_{dev}$. Let the set of four deviatoric quadrature points be $\\mathcal{Q}_{dev} = \\{(\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})\\}$. The final stiffness matrix is:\n$$\nk^e_{SRI} = ab \\, B^T(0,0) D_{vol} B(0,0) + \\frac{ab}{4} \\sum_{(\\xi,\\eta) \\in \\mathcal{Q}_{dev}} B^T(\\xi,\\eta) D_{dev} B(\\xi,\\eta)\n$$\nSubstituting the explicit forms of $D_{vol}$ and $D_{dev}$:\n$$\nk^e_{SRI} = ab \\cdot K \\cdot B^T(0,0) \\begin{pmatrix} 1 & 1 & 0 \\\\ 1 & 1 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} B(0,0) + \\frac{ab}{4} \\cdot \\mu \\sum_{j=1}^{4} B^T(\\xi_j, \\eta_j) \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} B(\\xi_j, \\eta_j)\n$$\nwhere the summation is over the four points $(\\xi_j, \\eta_j) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$. This is the single analytic expression for the stiffness matrix computed with the specified SRI scheme.",
            "answer": "$$\n\\boxed{ab K B^T(0,0) \\begin{pmatrix} 1 & 1 & 0 \\\\ 1 & 1 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} B(0,0) + \\frac{ab\\mu}{4} \\sum_{j=1}^{4} B^T(\\xi_j, \\eta_j) \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} B(\\xi_j, \\eta_j) \\quad \\text{where} \\quad (\\xi_j, \\eta_j) \\in \\{(\\pm\\frac{1}{\\sqrt{3}}, \\pm\\frac{1}{\\sqrt{3}})\\}}\n$$"
        },
        {
            "introduction": "With the theoretical derivation established, the next step is to observe the method in action and appreciate its practical utility. This hands-on coding exercise challenges you to implement and solve a classic boundary value problem where volumetric locking is notoriously severe, especially for nearly incompressible materials . By comparing the solution obtained using full integration against the one from SRI, you will be able to directly witness and quantitatively measure the dramatic improvement in accuracy that SRI provides, transforming an overly stiff, incorrect result into a physically meaningful one.",
            "id": "2592773",
            "problem": "Consider the two-dimensional small-strain, linear-elasticity boundary-value problem in plane strain on a rectangular domain $\\Omega = [0,W] \\times [0,H]$ with boundary $\\partial \\Omega = \\Gamma_u \\cup \\Gamma_t$, where the bottom edge $\\Gamma_u = \\{(x,0): 0 \\le x \\le W\\}$ is fixed with prescribed zero displacement, and the top edge $\\Gamma_t = \\{(x,H): 0 \\le x \\le W\\}$ is subjected to a uniform surface traction of magnitude $p$ acting in the negative $y$-direction. The left and right edges are traction-free. The governing weak form derived from the principle of virtual work is\n$$\n\\int_{\\Omega} \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) : \\mathbf{C} : \\boldsymbol{\\varepsilon}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega = \\int_{\\Gamma_t} \\boldsymbol{t} \\cdot \\boldsymbol{v} \\, \\mathrm{d}\\Gamma\n$$\nfor all admissible virtual displacements $\\boldsymbol{v}$ vanishing on $\\Gamma_u$, where $\\boldsymbol{u} = (u_x,u_y)$ is the displacement field, $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\tfrac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^\\top)$ is the small-strain tensor, $\\boldsymbol{t} = (0,-p)$ is the traction on $\\Gamma_t$, and $\\mathbf{C}$ is the fourth-order elasticity tensor for an isotropic solid in plane strain characterized by Young’s modulus $E$ and Poisson’s ratio $\\nu$. In Voigt notation with strain vector $\\boldsymbol{\\epsilon} = [\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}]^\\top$, where $\\gamma_{xy} = 2 \\epsilon_{xy}$, the stress-strain relation is $\\boldsymbol{\\sigma} = \\mathbf{D} \\, \\boldsymbol{\\epsilon}$ with\n$$\n\\mathbf{D} = \n\\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix},\n\\quad\n\\mu = \\frac{E}{2(1+\\nu)}, \n\\quad\n\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)},\n$$\nand the bulk modulus $\\kappa = \\lambda + \\tfrac{2}{3}\\mu$.\n\nUse isoparametric bilinear quadrilateral (Q4) finite elements with nodal shape functions\n$$\nN_1 = \\tfrac{1}{4}(1-\\xi)(1-\\eta), \\quad\nN_2 = \\tfrac{1}{4}(1+\\xi)(1-\\eta), \\quad\nN_3 = \\tfrac{1}{4}(1+\\xi)(1+\\eta), \\quad\nN_4 = \\tfrac{1}{4}(1-\\xi)(1+\\eta),\n$$\ndefined on the parent domain $(\\xi,\\eta) \\in [-1,1]^2$, and the standard isoparametric mapping to the physical element. Let $\\mathbf{B}(\\xi,\\eta)$ denote the $3\\times 8$ strain-displacement matrix such that $\\boldsymbol{\\epsilon} = \\mathbf{B} \\, \\mathbf{u}_e$ for element nodal displacement vector $\\mathbf{u}_e \\in \\mathbb{R}^8$.\n\nYou must implement two element integration strategies:\n\n1. Full integration (FI): assemble the element stiffness matrix\n$$\n\\mathbf{K}_e^{\\mathrm{FI}} = \\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D} \\, \\mathbf{B} \\, \\mathrm{d}\\Omega\n$$\nusing the tensor-product two-point Gaussian quadrature in each parent coordinate (i.e., $2 \\times 2$ Gauss points) with exact edge loads from two-point Gauss quadrature on the top edge.\n\n2. Selective Reduced Integration (SRI): split the constitutive operator into deviatoric and volumetric parts,\n$$\n\\mathbf{D} = \\mathbf{D}_{\\mathrm{dev}} + \\mathbf{D}_{\\mathrm{vol}},\n\\quad\n\\mathbf{D}_{\\mathrm{vol}} = \\kappa \\, \\mathbf{P}^\\top \\mathbf{P},\n\\quad\n\\mathbf{P} = \n\\begin{bmatrix}\n1 & 1 & 0\n\\end{bmatrix},\n\\quad\n\\mathbf{D}_{\\mathrm{dev}} = \\mathbf{D} - \\mathbf{D}_{\\mathrm{vol}},\n$$\nand assemble\n$$\n\\mathbf{K}_e^{\\mathrm{SRI}} = \\underbrace{\\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D}_{\\mathrm{dev}} \\, \\mathbf{B} \\, \\mathrm{d}\\Omega}_{\\text{integrated with } 2\\times 2 \\text{ Gauss}}\n+\n\\underbrace{\\int_{\\Omega_e} (\\mathbf{P}\\mathbf{B})^\\top \\kappa \\, (\\mathbf{P}\\mathbf{B}) \\, \\mathrm{d}\\Omega}_{\\text{integrated with } 1\\times 1 \\text{ Gauss at } (\\xi,\\eta)=(0,0)}.\n$$\nThe surface traction vector on the top edges should always be integrated exactly using two-point Gaussian quadrature along the edge.\n\nConstruct a structured mesh of $n_x \\times n_y$ Q4 elements over the rectangle $\\Omega$, enforce the homogeneous Dirichlet boundary condition $\\boldsymbol{u} = \\boldsymbol{0}$ on the bottom edge $\\Gamma_u$, assemble the global linear system, and solve for the nodal displacement vector. Let $\\bar{u}_y$ denote the average vertical displacement on the top edge, defined by\n$$\n\\bar{u}_y = \\frac{1}{|\\mathcal{N}_t|}\\sum_{a \\in \\mathcal{N}_t} (u_y)_a,\n$$\nwhere $\\mathcal{N}_t$ is the set of nodes lying on $y=H$. As a high-fidelity reference, for each test case defined below, compute $\\bar{u}_y^{\\mathrm{ref}}$ using the SRI method on a fine mesh with $N_x^{\\mathrm{ref}} = 32$ elements along the width and $N_y^{\\mathrm{ref}} = \\max\\{2, \\mathrm{round}(32 \\, H/W)\\}$ elements along the height.\n\nDefine the absolute error in the scalar response for a method $m \\in \\{\\mathrm{FI}, \\mathrm{SRI}\\}$ by\n$$\ne_m = \\left| \\bar{u}_y^{(m)} - \\bar{u}_y^{\\mathrm{ref}} \\right|.\n$$\nDefine the locking error reduction factor (dimensionless) of SRI relative to full integration as\n$$\n\\rho = \\frac{e_{\\mathrm{FI}} - e_{\\mathrm{SRI}}}{e_{\\mathrm{FI}}}.\n$$\nA positive value of $\\rho$ indicates that selective reduced integration decreases the locking-induced error in the computed response.\n\nImplement a program that computes $\\rho$ for the following test suite of four cases. All physical quantities must be handled in the International System of Units (SI), namely lengths in meters (m), stresses (including $E$ and $p$) in Pascals (Pa), and displacements in meters (m). No angles are used.\n\nTest suite:\n- Case 1 (nearly incompressible, moderate mesh): $W = 1\\,\\mathrm{m}$, $H = 1\\,\\mathrm{m}$, $E = 1000\\,\\mathrm{Pa}$, $\\nu = 0.4999$, $p = 1\\,\\mathrm{Pa}$, $n_x = 2$, $n_y = 2$.\n- Case 2 (nearly incompressible, very coarse mesh): $W = 1\\,\\mathrm{m}$, $H = 1\\,\\mathrm{m}$, $E = 1000\\,\\mathrm{Pa}$, $\\nu = 0.4999$, $p = 1\\,\\mathrm{Pa}$, $n_x = 1$, $n_y = 1$.\n- Case 3 (nearly incompressible, rectangular domain): $W = 2\\,\\mathrm{m}$, $H = 1\\,\\mathrm{m}$, $E = 1000\\,\\mathrm{Pa}$, $\\nu = 0.4999$, $p = 1\\,\\mathrm{Pa}$, $n_x = 4$, $n_y = 2$.\n- Case 4 (compressible, moderate mesh): $W = 1\\,\\mathrm{m}$, $H = 1\\,\\mathrm{m}$, $E = 1000\\,\\mathrm{Pa}$, $\\nu = 0.3$, $p = 1\\,\\mathrm{Pa}$, $n_x = 2$, $n_y = 2$.\n\nYour program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, in the order of the cases above. Each entry must be a real number (float) equal to the value of $\\rho$ for that case, rounded to six decimal places. For example, an output line should look like: \"[0.123456,0.234567,0.345678,0.456789]\".",
            "solution": "We derive the computational procedure from first principles. The starting point is the weak form of linear elasticity in plane strain:\n$$\n\\int_{\\Omega} \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) : \\mathbf{C} : \\boldsymbol{\\varepsilon}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega = \\int_{\\Gamma_t} \\boldsymbol{t} \\cdot \\boldsymbol{v} \\, \\mathrm{d}\\Gamma.\n$$\nDiscretization with isoparametric bilinear quadrilateral (Q4) elements uses the interpolation\n$$\n\\boldsymbol{u}(x,y) \\approx \\sum_{a=1}^{4} N_a(\\xi,\\eta) \\, \\boldsymbol{u}_a, \n\\quad \n\\boldsymbol{\\epsilon} = \\mathbf{B}(\\xi,\\eta)\\, \\mathbf{u}_e,\n$$\nwhere $(\\xi,\\eta)$ are the parent coordinates, $\\{N_a\\}$ are bilinear shape functions on $[-1,1]^2$, and $\\mathbf{B}$ maps nodal displacements to the Voigt strain vector $\\boldsymbol{\\epsilon} = [\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}]^\\top$ with $\\gamma_{xy} = \\partial u_x/\\partial y + \\partial u_y/\\partial x$. The isoparametric mapping from parent to physical coordinates is $x(\\xi,\\eta)=\\sum_a N_a(\\xi,\\eta) x_a$, $y(\\xi,\\eta)=\\sum_a N_a(\\xi,\\eta) y_a$, with Jacobian $\\mathbf{J} = \\begin{bmatrix}\\partial x/\\partial \\xi & \\partial y/\\partial \\xi \\\\ \\partial x/\\partial \\eta & \\partial y/\\partial \\eta \\end{bmatrix}$. Gradients $\\partial N_a/\\partial x$ and $\\partial N_a/\\partial y$ follow from $\\begin{bmatrix}\\partial N_a/\\partial x & \\partial N_a/\\partial y \\end{bmatrix} = \\begin{bmatrix}\\partial N_a/\\partial \\xi & \\partial N_a/\\partial \\eta\\end{bmatrix}\\mathbf{J}^{-1}$. Then, with plane strain isotropic elasticity, the element stiffness matrix is\n$$\n\\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D}\\, \\mathbf{B} \\, \\mathrm{d}\\Omega,\n$$\nand the element nodal force from the top-edge traction is\n$$\n\\mathbf{f}_e^{\\Gamma} = \\int_{\\Gamma_{t,e}} \\mathbf{N}^\\top \\boldsymbol{t} \\, \\mathrm{d}\\Gamma,\n$$\nwhere $\\mathbf{N} = \\mathrm{diag}(N_1,N_1,N_2,N_2,N_3,N_3,N_4,N_4)$ maps vector-valued shape functions, and $\\Gamma_{t,e}$ is the part of the top boundary intersecting the element. The boundary integral over a straight edge is evaluated via one-dimensional Gaussian quadrature on the parent edge $(\\xi\\in[-1,1], \\eta = +1)$ with the correct edge Jacobian factor $\\| \\partial \\boldsymbol{x}/\\partial \\xi \\|$.\n\nFor numerical integration in the volume, full integration for Q4 elements uses two-point Gaussian quadrature in each parent direction: points $\\{\\pm 1/\\sqrt{3}\\}$ with weights $\\{1,1\\}$, leading to $2\\times 2$ points in the square. Reduced integration uses a single point $(\\xi,\\eta)=(0,0)$ with weight $4$ (the product of one-dimensional weights $\\{2\\}$). However, using reduced integration for the entire stiffness matrix generally causes rank deficiency (hourglassing). To mitigate volumetric locking — the artificial stiffening observed when $\\nu \\to 1/2$ (nearly incompressible) — a stable compromise is Selective Reduced Integration (SRI). SRI leverages the standard decomposition of the elastic energy density into deviatoric and volumetric parts:\n$$\nW = \\mu\\, \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}:\\boldsymbol{\\varepsilon}_{\\mathrm{dev}} + \\frac{\\kappa}{2} (\\mathrm{tr}\\, \\boldsymbol{\\varepsilon})^2,\n$$\nwith shear modulus $\\mu$ and bulk modulus $\\kappa = \\lambda + \\tfrac{2}{3}\\mu$. In Voigt form restricted to in-plane components $(\\epsilon_{xx},\\epsilon_{yy},\\gamma_{xy})$, we approximate this split by\n$$\n\\mathbf{D}_{\\mathrm{vol}} = \\kappa \\, \\mathbf{P}^\\top \\mathbf{P}, \n\\quad \\mathbf{P} = \\begin{bmatrix}1 & 1 & 0\\end{bmatrix},\n\\quad\n\\mathbf{D}_{\\mathrm{dev}} = \\mathbf{D} - \\mathbf{D}_{\\mathrm{vol}}.\n$$\nThis choice retains the correct hydrostatic stiffness in the in-plane subspace while ensuring the deviatoric response is handled by $\\mathbf{D}_{\\mathrm{dev}}$. The SRI assembly then integrates the deviatoric part with $2\\times 2$ Gauss points and the volumetric part with a single Gauss point at $(\\xi,\\eta)=(0,0)$. This strategy avoids hourglass modes (because the deviatoric part is fully integrated) and alleviates volumetric locking (because the volumetric stiffness is integrated at reduced order, which softens the spurious constraints that arise under full integration when $\\nu$ is close to $1/2$).\n\nAlgorithmic design:\n1. Generate a structured mesh of $n_x \\times n_y$ Q4 elements over $[0,W]\\times[0,H]$ with nodal coordinates on a Cartesian grid. Each element connectivity follows the local node order: $(\\xi,\\eta)=(-1,-1)$ bottom-left, $(+1,-1)$ bottom-right, $(+1,+1)$ top-right, $(-1,+1)$ top-left.\n2. For each element, compute the element stiffness:\n   - Full Integration: $\\mathbf{K}_e^{\\mathrm{FI}} = \\sum_{i=1}^2 \\sum_{j=1}^2 \\mathbf{B}(\\xi_i,\\eta_j)^\\top \\mathbf{D} \\, \\mathbf{B}(\\xi_i,\\eta_j) \\, \\det\\mathbf{J}(\\xi_i,\\eta_j)$.\n   - SRI: $\\mathbf{K}_e^{\\mathrm{SRI}} = \\sum_{i=1}^2 \\sum_{j=1}^2 \\mathbf{B}^\\top \\mathbf{D}_{\\mathrm{dev}} \\mathbf{B} \\, \\det\\mathbf{J} + 4 \\, (\\mathbf{P}\\mathbf{B}(0,0))^\\top \\kappa \\, (\\mathbf{P}\\mathbf{B}(0,0)) \\, \\det\\mathbf{J}(0,0)$.\n   The factor $4$ in the volumetric term is the two-dimensional reduced Gauss weight corresponding to the area of the parent square.\n3. Assemble the global stiffness matrix in sparse Compressed Sparse Row (CSR) format by summing element contributions into the global degrees of freedom, where each node contributes two degrees of freedom $(u_x,u_y)$.\n4. Assemble the global load vector from the top-edge pressure by integrating each element edge lying on $y=H$ with two-point Gauss quadrature along the edge: $\\mathbf{f}_e^\\Gamma = \\sum_{k=1}^2 \\mathbf{N}^\\top(\\xi_k,\\eta=+1) \\, \\boldsymbol{t} \\, \\|\\partial \\boldsymbol{x}/\\partial \\xi\\| \\, w_k$.\n5. Impose homogeneous Dirichlet boundary conditions on the bottom edge $\\Gamma_u$ by extracting the free-degree-of-freedom submatrix and right-hand side and solving the reduced system. This is consistent with the weak form and avoids ill-conditioning from explicitly modifying rows and columns.\n6. Compute the scalar response $\\bar{u}_y$ as the average vertical displacement over all nodes with $y=H$.\n7. For each test case, compute the fine-mesh reference $\\bar{u}_y^{\\mathrm{ref}}$ using SRI with $N_x^{\\mathrm{ref}} = 32$ and $N_y^{\\mathrm{ref}} = \\max\\{2, \\mathrm{round}(32 \\, H/W)\\}$. Compute the absolute errors $e_{\\mathrm{FI}}$ and $e_{\\mathrm{SRI}}$, and finally the reduction factor $\\rho = (e_{\\mathrm{FI}} - e_{\\mathrm{SRI}})/e_{\\mathrm{FI}}$.\n8. Aggregate the four values of $\\rho$ corresponding to the test suite into a single list and print it on one line in the required format.\n\nWhy SRI reduces locking: As $\\nu \\to 1/2$, the Lamé parameter $\\lambda$ (and hence the bulk modulus $\\kappa$) grows without bound, which makes the volumetric part of the stiffness dominate under full integration, enforcing $\\mathrm{tr}\\, \\boldsymbol{\\epsilon} \\approx 0$ too strongly in a discrete sense and producing an overly stiff response (locking). By integrating the volumetric contribution at reduced order, SRI effectively reduces the discrete constraint intensity associated with the volumetric strain while preserving the deviatoric stiffness and stability. Consequently, for nearly incompressible materials, SRI typically yields a more compliant and accurate response on coarse meshes compared to full integration. For moderately compressible materials (e.g., $\\nu = 0.3$), both schemes give nearly identical results because volumetric stiffness does not dominate.\n\nThe program below implements this procedure, solves the test suite, and prints the four reduction factors as a single comma-separated list rounded to six decimal places, as required.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import coo_matrix, csr_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef constitutive_plane_strain(E, nu):\n    lam = E * nu / ((1.0 + nu) * (1.0 - 2.0 * nu))\n    mu = E / (2.0 * (1.0 + nu))\n    D = np.array([[lam + 2.0 * mu, lam, 0.0],\n                  [lam, lam + 2.0 * mu, 0.0],\n                  [0.0, 0.0, mu]], dtype=float)\n    kappa = lam + 2.0 * mu / 3.0\n    return D, lam, mu, kappa\n\ndef shape_Q4(ksi, eta):\n    N = np.array([\n        0.25 * (1 - ksi) * (1 - eta),\n        0.25 * (1 + ksi) * (1 - eta),\n        0.25 * (1 + ksi) * (1 + eta),\n        0.25 * (1 - ksi) * (1 + eta)\n    ], dtype=float)\n    dN_dksi = 0.25 * np.array([\n        -(1 - eta),\n        (1 - eta),\n        (1 + eta),\n        -(1 + eta)\n    ], dtype=float)\n    dN_deta = 0.25 * np.array([\n        -(1 - ksi),\n        -(1 + ksi),\n        (1 + ksi),\n        (1 - ksi)\n    ], dtype=float)\n    return N, dN_dksi, dN_deta\n\ndef B_matrix_Q4(xe, ksi, eta):\n    # xe: 4x2 nodal coordinates of the element (in order 1..4)\n    N, dN_dksi, dN_deta = shape_Q4(ksi, eta)\n    J = np.zeros((2, 2), dtype=float)\n    # Compute Jacobian J = [dx/dksi dy/dksi; dx/deta dy/deta]\n    J[0, 0] = np.dot(dN_dksi, xe[:, 0])\n    J[0, 1] = np.dot(dN_dksi, xe[:, 1])\n    J[1, 0] = np.dot(dN_deta, xe[:, 0])\n    J[1, 1] = np.dot(dN_deta, xe[:, 1])\n    detJ = np.linalg.det(J)\n    invJ = np.linalg.inv(J)\n    # Gradients with respect to x,y: grads[i,0]=dNi/dx, grads[i,1]=dNi/dy\n    grads = np.zeros((4, 2), dtype=float)\n    for i in range(4):\n        dN_parent = np.array([dN_dksi[i], dN_deta[i]])\n        dN_xy = invJ @ dN_parent\n        grads[i, 0] = dN_xy[0]\n        grads[i, 1] = dN_xy[1]\n    # Build B matrix (3x8) for plane strain with Voigt [exx, eyy, gxy]\n    B = np.zeros((3, 8), dtype=float)\n    for i in range(4):\n        Bi = np.array([\n            [grads[i, 0], 0.0],\n            [0.0, grads[i, 1]],\n            [grads[i, 1], grads[i, 0]]\n        ], dtype=float)\n        B[:, 2 * i:2 * i + 2] = Bi\n    return B, detJ\n\ndef element_stiffness_FI(xe, D):\n    # 2x2 Gauss integration\n    gp = 1.0 / np.sqrt(3.0)\n    ksi_list = [-gp, gp]\n    eta_list = [-gp, gp]\n    Ke = np.zeros((8, 8), dtype=float)\n    for ksi in ksi_list:\n        for eta in eta_list:\n            B, detJ = B_matrix_Q4(xe, ksi, eta)\n            Ke += (B.T @ D @ B) * detJ\n    return Ke\n\ndef element_stiffness_SRI(xe, D, kappa):\n    # D_dev = D - kappa * P^T P, with P = [1,1,0]\n    P = np.array([[1.0, 1.0, 0.0]], dtype=float)\n    D_vol = kappa * (P.T @ P)\n    D_dev = D - D_vol\n    # Deviatoric part with 2x2 Gauss\n    gp = 1.0 / np.sqrt(3.0)\n    ksi_list = [-gp, gp]\n    eta_list = [-gp, gp]\n    Ke = np.zeros((8, 8), dtype=float)\n    for ksi in ksi_list:\n        for eta in eta_list:\n            B, detJ = B_matrix_Q4(xe, ksi, eta)\n            Ke += (B.T @ D_dev @ B) * detJ\n    # Volumetric part with 1x1 Gauss at (0,0), weight = 4\n    Bc, detJc = B_matrix_Q4(xe, 0.0, 0.0)\n    Bvol = P @ Bc  # shape (1,8)\n    Ke += (Bvol.T @ (kappa * Bvol)) * detJc * 4.0\n    return Ke\n\ndef edge_load_top_Q4(xe, p):\n    # Compute consistent nodal load vector (8,) for top edge (eta=+1) traction t = (0,-p)\n    # 2-point Gauss along the edge\n    gp = 1.0 / np.sqrt(3.0)\n    s_list = [-gp, gp]\n    w_list = [1.0, 1.0]\n    fe = np.zeros(8, dtype=float)\n    eta = 1.0\n    for s, w in zip(s_list, w_list):\n        N, dN_dksi, dN_deta = shape_Q4(s, eta)\n        # Edge tangent vector dx/dksi at eta=+1\n        dx_dksi = np.dot(dN_dksi, xe[:, 0])\n        dy_dksi = np.dot(dN_dksi, xe[:, 1])\n        J_edge = np.sqrt(dx_dksi ** 2 + dy_dksi ** 2)\n        # Assemble contributions: only vertical traction\n        t = np.array([0.0, -p], dtype=float)\n        for i in range(4):\n            Ni = N[i]\n            fe[2 * i:2 * i + 2] += Ni * t * J_edge * w\n    return fe\n\ndef generate_mesh(W, H, nx, ny):\n    xs = np.linspace(0.0, W, nx + 1)\n    ys = np.linspace(0.0, H, ny + 1)\n    coords = np.array([(x, y) for y in ys for x in xs], dtype=float)\n    # Node numbering: row-major (x fastest), node index = j*(nx+1)+i\n    conn = []\n    for j in range(ny):\n        for i in range(nx):\n            n1 = j * (nx + 1) + i\n            n2 = n1 + 1\n            n3 = n1 + (nx + 1) + 1\n            n4 = n1 + (nx + 1)\n            conn.append([n1, n2, n3, n4])\n    conn = np.array(conn, dtype=int)\n    return coords, conn\n\ndef assemble_system(W, H, nx, ny, E, nu, p, method):\n    coords, conn = generate_mesh(W, H, nx, ny)\n    nnode = coords.shape[0]\n    ndof = 2 * nnode\n    D, lam, mu, kappa = constitutive_plane_strain(E, nu)\n\n    rows = []\n    cols = []\n    data = []\n    f = np.zeros(ndof, dtype=float)\n\n    # Assemble stiffness and traction\n    for e, nodes in enumerate(conn):\n        xe = coords[nodes, :]\n        if method == 'FI':\n            Ke = element_stiffness_FI(xe, D)\n        elif method == 'SRI':\n            Ke = element_stiffness_SRI(xe, D, kappa)\n        else:\n            raise ValueError(\"Unknown method\")\n        # Global dof indices\n        dofs = np.zeros(8, dtype=int)\n        for a_local, a in enumerate(nodes):\n            dofs[2 * a_local] = 2 * a\n            dofs[2 * a_local + 1] = 2 * a + 1\n        # Add to global COO\n        for i_local in range(8):\n            gi = dofs[i_local]\n            for j_local in range(8):\n                gj = dofs[j_local]\n                rows.append(gi)\n                cols.append(gj)\n                data.append(Ke[i_local, j_local])\n\n        # Top edge load if this element has its top edge on y=H\n        # Local top edge nodes are 3 (index 2) and 4 (index 3)\n        y3 = xe[2, 1]\n        y4 = xe[3, 1]\n        if np.isclose(y3, H) and np.isclose(y4, H):\n            fe = edge_load_top_Q4(xe, p)\n            for a_local, a in enumerate(nodes):\n                f[2 * a] += fe[2 * a_local]\n                f[2 * a + 1] += fe[2 * a_local + 1]\n\n    K = coo_matrix((data, (rows, cols)), shape=(ndof, ndof)).tocsr()\n\n    # Apply Dirichlet BCs on bottom edge: y=0, fix both u and v\n    bottom_nodes = np.where(np.isclose(coords[:, 1], 0.0))[0]\n    fixed_dofs = []\n    for n in bottom_nodes:\n        fixed_dofs.append(2 * n)     # u_x\n        fixed_dofs.append(2 * n + 1) # u_y\n    fixed_dofs = np.array(sorted(set(fixed_dofs)), dtype=int)\n\n    all_dofs = np.arange(ndof, dtype=int)\n    free_dofs = np.setdiff1d(all_dofs, fixed_dofs, assume_unique=False)\n\n    K_ff = K[free_dofs, :][:, free_dofs]\n    f_f = f[free_dofs]\n\n    u = np.zeros(ndof, dtype=float)\n    if K_ff.shape[0] > 0:\n        u_f = spsolve(K_ff, f_f)\n        u[free_dofs] = u_f\n\n    # Average vertical displacement on top edge\n    top_nodes = np.where(np.isclose(coords[:, 1], H))[0]\n    v_dofs = 2 * top_nodes + 1\n    avg_v = float(np.mean(u[v_dofs])) if v_dofs.size > 0 else 0.0\n    return avg_v\n\ndef compute_reduction_for_case(W, H, nx, ny, E, nu, p):\n    # Reference using SRI on fine mesh\n    Nx_ref = 32\n    Ny_ref = int(np.round(32.0 * H / W))\n    Ny_ref = max(2, Ny_ref)\n    uref = assemble_system(W, H, Nx_ref, Ny_ref, E, nu, p, method='SRI')\n\n    # Coarse solutions\n    u_fi = assemble_system(W, H, nx, ny, E, nu, p, method='FI')\n    u_sri = assemble_system(W, H, nx, ny, E, nu, p, method='SRI')\n\n    e_fi = abs(u_fi - uref)\n    e_sri = abs(u_sri - uref)\n    rho = (e_fi - e_sri) / e_fi if e_fi != 0.0 else 0.0\n    return rho\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Parameters: (W, H, nx, ny, E, nu, p)\n    test_cases = [\n        (1.0, 1.0, 2, 2, 1000.0, 0.4999, 1.0),\n        (1.0, 1.0, 1, 1, 1000.0, 0.4999, 1.0),\n        (2.0, 1.0, 4, 2, 1000.0, 0.4999, 1.0),\n        (1.0, 1.0, 2, 2, 1000.0, 0.3, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        W, H, nx, ny, E, nu, p = case\n        rho = compute_reduction_for_case(W, H, nx, ny, E, nu, p)\n        # Round to six decimal places\n        results.append(f\"{rho:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Mastery of a numerical technique extends beyond implementation to a critical understanding of its performance envelope. This advanced practice encourages a deeper investigation into the behavior of SRI, exploring how its accuracy, stability, and conditioning are affected by key parameters like material incompressibility (Poisson's ratio $\\nu$) and element distortion (aspect ratio $a/b$) . By performing a sensitivity analysis, you will develop a nuanced perspective on when SRI is not just effective but truly optimal, and learn to identify scenarios where it might require caution or stabilization.",
            "id": "3599191",
            "problem": "Consider a single, isoparametric, four-node bilinear quadrilateral element (Q4) in small-strain, linear elastic, plane strain. Let the element occupy a rectangular region in the physical space with dimensions $a$ in the $x$-direction and $b$ in the $y$-direction, with nodes at $(0,0)$, $(a,0)$, $(a,b)$, and $(0,b)$. The material is characterized by Young’s modulus $E$ and Poisson’s ratio $\\nu$, with Lamé parameters $\\lambda = \\dfrac{E \\nu}{(1+\\nu)(1-2\\nu)}$ and $\\mu = \\dfrac{E}{2(1+\\nu)}$. Use $E=1$ and treat all outputs as dimensionless.\n\nYou will implement Selective Reduced Integration (SRI) to alleviate locking by integrating the deviatoric and volumetric contributions to the element stiffness with different quadrature rules. Specifically, for the plane strain constitutive matrix in Voigt notation, use the decomposition\n$$\n\\boldsymbol{C} = \\boldsymbol{C}_{\\mathrm{dev}} + \\boldsymbol{C}_{\\mathrm{vol}},\n$$\nwith\n$$\n\\boldsymbol{C} =\n\\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix},\\quad\n\\boldsymbol{C}_{\\mathrm{vol}} = \\lambda\\, \\boldsymbol{v}\\boldsymbol{v}^{\\mathsf{T}},\\quad\n\\boldsymbol{v} = \\begin{bmatrix} 1 \\\\ 1 \\\\ 0 \\end{bmatrix},\\quad\n\\boldsymbol{C}_{\\mathrm{dev}} = \\boldsymbol{C} - \\boldsymbol{C}_{\\mathrm{vol}} =\n\\begin{bmatrix}\n2\\mu & 0 & 0 \\\\\n0 & 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix}.\n$$\nDefine the element stiffness matrix by\n$$\n\\boldsymbol{K} = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}}\\, \\boldsymbol{C}\\, \\boldsymbol{B}\\, \\mathrm{d}\\Omega,\n$$\nwhere $\\boldsymbol{B}$ is the standard strain-displacement matrix for the Q4 element and $\\Omega_e$ is the element domain. In SRI, approximate this integral by\n$$\n\\boldsymbol{K}_{\\mathrm{SRI}} \\approx \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}}\\, \\boldsymbol{C}_{\\mathrm{dev}}\\, \\boldsymbol{B}\\, \\mathrm{d}\\Omega \\Big|_{\\text{$2\\times 2$ Gauss}} + \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}}\\, \\boldsymbol{C}_{\\mathrm{vol}}\\, \\boldsymbol{B}\\, \\mathrm{d}\\Omega \\Big|_{\\text{$1\\times 1$ Gauss}},\n$$\nusing $2\\times 2$ Gauss quadrature for the deviatoric part and $1\\times 1$ Gauss quadrature (one point at the element center) for the volumetric part. For comparison, define the Full Integration (FI) stiffness\n$$\n\\boldsymbol{K}_{\\mathrm{FI}} \\approx \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}}\\, \\boldsymbol{C}\\, \\boldsymbol{B}\\, \\mathrm{d}\\Omega \\Big|_{\\text{$2\\times 2$ Gauss}},\n$$\nand a high-accuracy reference\n$$\n\\boldsymbol{K}_{\\mathrm{ref}} \\approx \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}}\\, \\boldsymbol{C}\\, \\boldsymbol{B}\\, \\mathrm{d}\\Omega \\Big|_{\\text{$5\\times 5$ Gauss}}.\n$$\n\nSensitivity analysis with respect to Poisson’s ratio and element aspect ratio: For a manufactured displacement field that excites both volumetric and deviatoric strains,\n$$\nu_x(x,y) = \\left(\\frac{x}{a}\\right)^2 + \\frac{1}{2}\\left(\\frac{x}{a}\\right)\\left(\\frac{y}{b}\\right),\\quad\nu_y(x,y) = \\left(\\frac{y}{b}\\right)^2 + \\frac{3}{10}\\left(\\frac{x}{a}\\right)\\left(\\frac{y}{b}\\right),\n$$\nassemble the nodal displacement vector $\\boldsymbol{u}$ of length $8$ in the standard Q4 node ordering. Define the discrete strain energy\n$$\n\\mathcal{E}(\\boldsymbol{K},\\boldsymbol{u}) = \\frac{1}{2}\\, \\boldsymbol{u}^{\\mathsf{T}}\\, \\boldsymbol{K}\\, \\boldsymbol{u}.\n$$\nCompute the relative energy errors\n$$\n\\varepsilon_{\\mathrm{SRI}} = \\frac{\\left|\\mathcal{E}(\\boldsymbol{K}_{\\mathrm{SRI}},\\boldsymbol{u}) - \\mathcal{E}(\\boldsymbol{K}_{\\mathrm{ref}},\\boldsymbol{u})\\right|}{\\mathcal{E}(\\boldsymbol{K}_{\\mathrm{ref}},\\boldsymbol{u})},\\quad\n\\varepsilon_{\\mathrm{FI}} = \\frac{\\left|\\mathcal{E}(\\boldsymbol{K}_{\\mathrm{FI}},\\boldsymbol{u}) - \\mathcal{E}(\\boldsymbol{K}_{\\mathrm{ref}},\\boldsymbol{u})\\right|}{\\mathcal{E}(\\boldsymbol{K}_{\\mathrm{ref}},\\boldsymbol{u})}.\n$$\n\nSpurious mode assessment: Let $\\lambda_i$ be the eigenvalues of the symmetric stiffness matrix $\\boldsymbol{K}$ of the free element (no boundary constraints). An unconstrained plane strain Q4 element should exhibit exactly three rigid body modes (two translations and one rotation), hence exactly three eigenvalues numerically near zero. Define a threshold based on the largest eigenvalue $\\lambda_{\\max}$; count near-zero eigenvalues as those satisfying $\\lambda_i \\leq \\tau_0 \\lambda_{\\max}$ with $\\tau_0$ a small tolerance, and flag negative eigenvalues if $\\lambda_i < -\\tau_n \\lambda_{\\max}$ with $\\tau_n$ a small tolerance. Compute the count of near-zero eigenvalues for $\\boldsymbol{K}_{\\mathrm{SRI}}$ and check for any negative eigenvalues. Define the stiffness matrix condition number\n$$\n\\kappa(\\boldsymbol{K}) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}^{+}},\n$$\nwhere $\\lambda_{\\min}^{+}$ is the smallest strictly positive eigenvalue, excluding the near-zero rigid body modes.\n\nClassification of optimality in the $(\\nu,a/b)$ plane: For each $(\\nu,a/b)$, deem SRI “optimal” if and only if all the following hold:\n- SRI accuracy is acceptable: $\\varepsilon_{\\mathrm{SRI}} \\leq \\beta$,\n- SRI does not introduce spurious modes: the near-zero eigenvalue count equals $3$ and there are no negative eigenvalues,\n- SRI improves conditioning relative to FI: $\\kappa(\\boldsymbol{K}_{\\mathrm{SRI}}) \\leq \\alpha\\, \\kappa(\\boldsymbol{K}_{\\mathrm{FI}})$, with $\\alpha<1$.\n\nUse $\\tau_0 = 10^{-9}$, $\\tau_n = 10^{-12}$, $\\beta = 0.25$, and $\\alpha = 0.95$.\n\nImplement the above for the following test suite, covering a “happy path,” near-incompressible, and extreme aspect ratio scenarios:\n- Test $1$: $(\\nu, a/b) = (0.3, 1)$,\n- Test $2$: $(\\nu, a/b) = (0.49, 1)$,\n- Test $3$: $(\\nu, a/b) = (0.49, 10)$,\n- Test $4$: $(\\nu, a/b) = (0.0, 2)$,\n- Test $5$: $(\\nu, a/b) = (0.499, 0.5)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry in this list corresponds to a test case and must itself be a list of the form $[\\varepsilon_{\\mathrm{SRI}}, \\varepsilon_{\\mathrm{FI}}, n_{\\mathrm{zero,SRI}}, \\text{optimal}]$, where $n_{\\mathrm{zero,SRI}}$ is the count of near-zero eigenvalues for $\\boldsymbol{K}_{\\mathrm{SRI}}$, and $\\text{optimal}$ is a boolean indicating whether the above criteria are met. For example, the output should look like $[[e_1,f_1,z_1,b_1],[e_2,f_2,z_2,b_2],\\dots]$, with numerical values rounded to six decimal places in the program output.",
            "solution": "The user has provided a well-posed problem in computational solid mechanics. The task is to analyze the performance of Selective Reduced Integration (SRI) for a four-node quadrilateral (Q4) element under plane strain conditions. This analysis will be conducted by comparing SRI to a standard Full Integration (FI) scheme and a high-accuracy reference solution, based on criteria of accuracy, stability (spurious zero-energy modes), and matrix conditioning.\n\nThe problem is validated as sound and self-contained. All necessary definitions, parameters, and analysis criteria are provided explicitly. The underlying physics and numerical methods are standard in the field of Finite Element Analysis (FEA).\n\nThe solution proceeds in several steps:\n1.  Formulation of the isoparametric Q4 element, including shape functions and the strain-displacement matrix $\\boldsymbol{B}$.\n2.  Numerical integration of the element stiffness matrix $\\boldsymbol{K}$ using Gauss quadrature.\n3.  Implementation of the three distinct stiffness matrices: $\\boldsymbol{K}_{\\mathrm{SRI}}$, $\\boldsymbol{K}_{\\mathrm{FI}}$, and $\\boldsymbol{K}_{\\mathrm{ref}}$.\n4.  Evaluation of analysis metrics: strain energy, relative error, eigenvalue spectrum for stability, and condition number.\n5.  Application of the methodology to the specified test cases and evaluation of the SRI \"optimality\" criteria.\n\n### 1. Isoparametric Q4 Element Formulation\n\nA four-node quadrilateral element is defined in a master or parent domain by coordinates $(\\xi, \\eta)$, where $\\xi, \\eta \\in [-1, 1]$. The four nodes are at $(\\xi_i, \\eta_i) = \\{(-1,-1), (1,-1), (1,1), (-1,1)\\}$ for $i=1,2,3,4$. The geometry and displacement field are interpolated from the nodal values using bilinear shape functions $N_i(\\xi, \\eta)$:\n$$\nN_i(\\xi, \\eta) = \\frac{1}{4}(1 + \\xi_i \\xi)(1 + \\eta_i \\eta)\n$$\nThe physical coordinates $(x,y)$ are mapped from the parent coordinates:\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) x_i, \\quad y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) y_i\n$$\nwhere $(x_i, y_i)$ are the nodal coordinates in the physical domain. For the specified rectangular element of size $a \\times b$, with nodes at $(0,0), (a,0), (a,b), (0,b)$, this mapping simplifies to:\n$$\nx = \\frac{a}{2}(1 + \\xi), \\quad y = \\frac{b}{2}(1 + \\eta)\n$$\nThe relationship between differential operators in the two coordinate systems is given by the Jacobian matrix $\\boldsymbol{J}$:\n$$\n\\boldsymbol{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} a/2 & 0 \\\\ 0 & b/2 \\end{bmatrix}\n$$\nThe determinant of the Jacobian, $\\det(\\boldsymbol{J}) = ab/4$, is constant, which simplifies the integration.\n\nThe displacement field $(u_x, u_y)$ is interpolated similarly:\n$$\nu_x(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) u_{ix}, \\quad u_y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) u_{iy}\n$$\nwhere $\\boldsymbol{u} = [u_{1x}, u_{1y}, u_{2x}, u_{2y}, u_{3x}, u_{3y}, u_{4x}, u_{4y}]^{\\mathsf{T}}$ is the vector of nodal displacements.\n\n### 2. Strain-Displacement Matrix $\\boldsymbol{B}$\n\nFor plane strain, the strain vector is $\\boldsymbol{\\epsilon} = [\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}]^{\\mathsf{T}}$. The strains are derived from displacements as:\n$$\n\\epsilon_{xx} = \\frac{\\partial u_x}{\\partial x}, \\quad \\epsilon_{yy} = \\frac{\\partial u_y}{\\partial y}, \\quad \\gamma_{xy} = \\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x}\n$$\nUsing the chain rule and the Jacobian inverse $\\boldsymbol{J}^{-1} = \\begin{bmatrix} 2/a & 0 \\\\ 0 & 2/b \\end{bmatrix}$:\n$$\n\\frac{\\partial}{\\partial x} = \\frac{2}{a} \\frac{\\partial}{\\partial \\xi}, \\quad \\frac{\\partial}{\\partial y} = \\frac{2}{b} \\frac{\\partial}{\\partial \\eta}\n$$\nThe strains can be related to the nodal displacement vector $\\boldsymbol{u}$ via the strain-displacement matrix $\\boldsymbol{B}$ such that $\\boldsymbol{\\epsilon} = \\boldsymbol{B} \\boldsymbol{u}$. The matrix $\\boldsymbol{B}$ is an $3 \\times 8$ matrix constructed by concatenating nodal contributions $\\boldsymbol{B}_i$:\n$$\n\\boldsymbol{B}(\\xi, \\eta) = [\\boldsymbol{B}_1, \\boldsymbol{B}_2, \\boldsymbol{B}_3, \\boldsymbol{B}_4], \\quad \\text{where} \\quad \\boldsymbol{B}_i = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x} \\end{bmatrix}\n$$\nThe spatial derivatives of the shape functions are computed as, for example, $\\frac{\\partial N_i}{\\partial x} = \\frac{\\partial N_i}{\\partial \\xi} \\frac{\\partial \\xi}{\\partial x} = \\frac{2}{a} \\frac{\\partial N_i}{\\partial \\xi}$.\n\n### 3. Element Stiffness Matrix and Numerical Integration\n\nThe element stiffness matrix $\\boldsymbol{K}$ is defined by the integral:\n$$\n\\boldsymbol{K} = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C} \\boldsymbol{B} \\, \\mathrm{d}\\Omega = \\int_{-1}^{1}\\int_{-1}^{1} \\boldsymbol{B}^{\\mathsf{T}}(\\xi,\\eta) \\boldsymbol{C} \\boldsymbol{B}(\\xi,\\eta) \\det(\\boldsymbol{J}) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\nThis integral is evaluated numerically using Gauss-Legendre quadrature. For a tensor product rule with $n_p$ points in each direction, the integral is approximated as:\n$$\n\\boldsymbol{K} \\approx \\sum_{i=1}^{n_p} \\sum_{j=1}^{n_p} w_i w_j \\left[ \\boldsymbol{B}^{\\mathsf{T}}(\\xi_i, \\eta_j) \\boldsymbol{C} \\boldsymbol{B}(\\xi_i, \\eta_j) \\det(\\boldsymbol{J}) \\right]\n$$\nwhere $(\\xi_i, \\eta_j)$ are the Gauss points and $w_i, w_j$ are the corresponding 1D weights.\n\nThe problem requires three different stiffness matrices:\n-   $\\boldsymbol{K}_{\\mathrm{FI}}$ (Full Integration): Uses a $2 \\times 2$ Gauss rule on the full constitutive matrix $\\boldsymbol{C}$. This is the standard rule for a Q4 element that exactly integrates the stiffness matrix for parallelepiped-shaped elements.\n-   $\\boldsymbol{K}_{\\mathrm{ref}}$ (Reference): Uses a high-order $5 \\times 5$ Gauss rule on $\\boldsymbol{C}$ to provide a highly accurate \"ground truth\" for the strain energy calculation.\n-   $\\boldsymbol{K}_{\\mathrm{SRI}}$ (Selective Reduced Integration): The stiffness contribution is split. The deviatoric part is integrated with a $2 \\times 2$ rule, and the volumetric part with a $1 \\times 1$ rule (one point at the center, $(\\xi, \\eta) = (0,0)$).\n    $$\n    \\boldsymbol{K}_{\\mathrm{SRI}} = \\boldsymbol{K}_{\\mathrm{dev}} + \\boldsymbol{K}_{\\mathrm{vol}}\n    $$\n    $$\n    \\boldsymbol{K}_{\\mathrm{dev}} = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C}_{\\mathrm{dev}} \\boldsymbol{B} \\, \\mathrm{d}\\Omega \\Big|_{\\text{$2\\times 2$ Gauss}} \\quad , \\quad \\boldsymbol{K}_{\\mathrm{vol}} = \\int_{\\Omega_e} \\boldsymbol{B}^{\\mathsf{T}} \\boldsymbol{C}_{\\mathrm{vol}} \\boldsymbol{B} \\, \\mathrm{d}\\Omega \\Big|_{\\text{$1\\times 1$ Gauss}}\n    $$\nThe material is defined by Young's modulus $E=1$ and Poisson's ratio $\\nu$. The Lamé parameters for plane strain are $\\lambda = \\frac{E \\nu}{(1+\\nu)(1-2\\nu)}$ and $\\mu = \\frac{E}{2(1+\\nu)}$. The constitutive matrices are given as:\n$$\n\\boldsymbol{C} = \\begin{bmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix}, \\quad \\boldsymbol{C}_{\\mathrm{vol}} = \\begin{bmatrix} \\lambda & \\lambda & 0 \\\\ \\lambda & \\lambda & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}, \\quad \\boldsymbol{C}_{\\mathrm{dev}} = \\begin{bmatrix} 2\\mu & 0 & 0 \\\\ 0 & 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix}\n$$\nThis decomposition correctly isolates the term responsible for volumetric strain energy, which is under-integrated in SRI to alleviate volumetric locking, a phenomenon that occurs in nearly incompressible materials ($\\nu \\to 0.5$).\n\n### 4. Analysis and Optimality Criteria\n\nTo analyze the performance of SRI, we first define a nodal displacement vector $\\boldsymbol{u}$ by evaluating the given manufactured solution at the four element nodes: $(0,0), (a,0), (a,b), (0,b)$. This results in $\\boldsymbol{u} = [0, 0, 1, 0, 1.5, 1.3, 0, 1]^{\\mathsf{T}}$.\n\nThe discrete strain energy is $\\mathcal{E}(\\boldsymbol{K}, \\boldsymbol{u}) = \\frac{1}{2} \\boldsymbol{u}^{\\mathsf{T}} \\boldsymbol{K} \\boldsymbol{u}$. The relative errors $\\varepsilon_{\\mathrm{SRI}}$ and $\\varepsilon_{\\mathrm{FI}}$ are calculated with respect to the energy from the reference stiffness matrix $\\boldsymbol{K}_{\\mathrm{ref}}$.\n\nFor stability analysis, we perform an eigenvalue decomposition on the symmetric stiffness matrix $\\boldsymbol{K}_{\\mathrm{SRI}}$. A free, unconstrained 2D element must have exactly three rigid body modes (two translations, one in-plane rotation), which correspond to three zero eigenvalues. In numerical computation, these are \"near-zero\". We count eigenvalues $\\lambda_i \\leq \\tau_0 \\lambda_{\\max}$ (with $\\tau_0 = 10^{-9}$) and check for negative eigenvalues $\\lambda_i < -\\tau_n \\lambda_{\\max}$ (with $\\tau_n = 10^{-12}$). Spurious zero-energy modes (hourglass modes) manifest as additional near-zero eigenvalues, which can destabilize the solution.\n\nThe condition number $\\kappa(\\boldsymbol{K})$ is computed as the ratio of the largest eigenvalue to the smallest strictly positive eigenvalue, which indicates the matrix's sensitivity to numerical errors.\n\nFinally, SRI is deemed \"optimal\" if it satisfies three criteria simultaneously:\n1.  Accuracy: $\\varepsilon_{\\mathrm{SRI}} \\leq 0.25$.\n2.  Stability: The number of near-zero eigenvalues is exactly $3$, with no significant negative eigenvalues.\n3.  Conditioning: $\\kappa(\\boldsymbol{K}_{\\mathrm{SRI}}) \\leq 0.95 \\cdot \\kappa(\\boldsymbol{K}_{\\mathrm{FI}})$, meaning SRI improves conditioning.\n\nThe implementation will systematically apply these steps to each $(\\nu, a/b)$ pair specified in the test suite.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef get_gauss_quadrature(n):\n    \"\"\"Returns n-point Gauss-Legendre quadrature points and weights.\"\"\"\n    if n <= 0:\n        return np.array([]), np.array([])\n    points, weights = np.polynomial.legendre.leggauss(n)\n    return points, weights\n\ndef get_shape_functions_derivatives(xi, eta):\n    \"\"\"\n    Computes derivatives of Q4 shape functions w.r.t. parent coordinates (xi, eta).\n    Node ordering: (-1,-1), (1,-1), (1,1), (-1,1)\n    \"\"\"\n    # dN/dxi\n    dN_dxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n    # dN/deta\n    dN_deta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n    return dN_dxi, dN_deta\n\ndef compute_stiffness_matrix(a, b, C, n_quad):\n    \"\"\"\n    Computes the element stiffness matrix for a Q4 element.\n    \"\"\"\n    K = np.zeros((8, 8))\n    det_J = (a * b) / 4.0\n\n    if n_quad == 0:\n        return K\n\n    xi_pts, w_xi = get_gauss_quadrature(n_quad)\n    eta_pts, w_eta = get_gauss_quadrature(n_quad)\n    \n    for i, xi in enumerate(xi_pts):\n        for j, eta in enumerate(eta_pts):\n            dN_dxi, dN_deta = get_shape_functions_derivatives(xi, eta)\n            \n            # Derivatives w.r.t. physical coordinates\n            # d/dx = (2/a) * d/dxi, d/dy = (2/b) * d/deta\n            dN_dx = dN_dxi * (2.0 / a)\n            dN_dy = dN_deta * (2.0 / b)\n            \n            B = np.zeros((3, 8))\n            for k in range(4):\n                B[0, 2*k] = dN_dx[k]\n                B[1, 2*k+1] = dN_dy[k]\n                B[2, 2*k] = dN_dy[k]\n                B[2, 2*k+1] = dN_dx[k]\n\n            weight = w_xi[i] * w_eta[j]\n            K += weight * (B.T @ C @ B) * det_J\n            \n    return K\n\ndef solve():\n    test_cases = [\n        (0.3, 1.0),\n        (0.49, 1.0),\n        (0.49, 10.0),\n        (0.0, 2.0),\n        (0.499, 0.5)\n    ]\n    \n    E = 1.0\n    beta = 0.25\n    alpha = 0.95\n    tau0 = 1e-9\n    tau_n = 1e-12\n\n    results = []\n\n    for nu, aspect_ratio in test_cases:\n        a = aspect_ratio\n        b = 1.0\n\n        # Nodal coordinates and manufactured displacement vector u\n        node_coords = np.array([[0, 0], [a, 0], [a, b], [0, b]])\n        u_vec = np.zeros(8)\n        for i, (x, y) in enumerate(node_coords):\n            x_norm, y_norm = (x / a if a != 0 else 0), (y / b if b != 0 else 0)\n            u_vec[2*i] = x_norm**2 + 0.5 * x_norm * y_norm\n            u_vec[2*i+1] = y_norm**2 + 0.3 * x_norm * y_norm\n\n        # Material properties and constitutive matrices\n        if 1 - 2*nu == 0:\n            # Handle the incompressible limit gracefully if needed, though not in test cases\n            lame_lambda = 1e12 # A large number\n        else:\n            lame_lambda = (E * nu) / ((1 + nu) * (1 - 2 * nu))\n        lame_mu = E / (2 * (1 + nu))\n\n        C = np.array([\n            [lame_lambda + 2 * lame_mu, lame_lambda, 0],\n            [lame_lambda, lame_lambda + 2 * lame_mu, 0],\n            [0, 0, lame_mu]\n        ])\n        \n        C_vol = np.array([\n            [lame_lambda, lame_lambda, 0],\n            [lame_lambda, lame_lambda, 0],\n            [0, 0, 0]\n        ])\n        \n        C_dev = np.array([\n            [2 * lame_mu, 0, 0],\n            [0, 2 * lame_mu, 0],\n            [0, 0, lame_mu]\n        ])\n\n        # Compute stiffness matrices\n        K_fi = compute_stiffness_matrix(a, b, C, n_quad=2)\n        K_ref = compute_stiffness_matrix(a, b, C, n_quad=5)\n        K_dev_sri = compute_stiffness_matrix(a, b, C_dev, n_quad=2)\n        K_vol_sri = compute_stiffness_matrix(a, b, C_vol, n_quad=1)\n        K_sri = K_dev_sri + K_vol_sri\n\n        # Compute energies and errors\n        E_ref = 0.5 * u_vec.T @ K_ref @ u_vec\n        E_fi = 0.5 * u_vec.T @ K_fi @ u_vec\n        E_sri = 0.5 * u_vec.T @ K_sri @ u_vec\n        \n        err_fi = abs(E_fi - E_ref) / abs(E_ref) if abs(E_ref) > 1e-15 else 0.0\n        err_sri = abs(E_sri - E_ref) / abs(E_ref) if abs(E_ref) > 1e-15 else 0.0\n\n        # Eigenvalue analysis for K_sri\n        eigvals_sri = eigh(K_sri, eigvals_only=True)\n        lambda_max_sri = eigvals_sri[-1]\n\n        near_zero_mask_sri = eigvals_sri = tau0 * lambda_max_sri\n        n_zero_sri = np.sum(near_zero_mask_sri)\n        has_negative_sri = np.any(eigvals_sri  -tau_n * lambda_max_sri)\n        \n        is_stable = (n_zero_sri == 3) and not has_negative_sri\n\n        # Condition number calculation\n        eigvals_sri_pos = eigvals_sri[~near_zero_mask_sri]\n        if len(eigvals_sri_pos) > 0:\n            lambda_min_plus_sri = eigvals_sri_pos[0]\n            kappa_sri = lambda_max_sri / lambda_min_plus_sri\n        else: # All eigenvalues are near-zero (unstable)\n            kappa_sri = np.inf\n\n        eigvals_fi = eigh(K_fi, eigvals_only=True)\n        lambda_max_fi = eigvals_fi[-1]\n        near_zero_mask_fi = eigvals_fi = tau0 * lambda_max_fi\n        eigvals_fi_pos = eigvals_fi[~near_zero_mask_fi]\n        if len(eigvals_fi_pos) > 0:\n            lambda_min_plus_fi = eigvals_fi_pos[0]\n            kappa_fi = lambda_max_fi / lambda_min_plus_fi\n        else:\n            kappa_fi = np.inf\n            \n        is_well_conditioned = kappa_sri = alpha * kappa_fi\n        is_accurate = err_sri = beta\n        is_optimal = is_accurate and is_stable and is_well_conditioned\n        \n        result_str = (\n            f\"[{err_sri:.6f},{err_fi:.6f},\"\n            f\"{n_zero_sri},{str(is_optimal).lower()}]\"\n        )\n        results.append(result_str)\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}