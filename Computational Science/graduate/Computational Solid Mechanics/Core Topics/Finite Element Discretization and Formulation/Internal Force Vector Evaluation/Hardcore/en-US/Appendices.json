{
    "hands_on_practices": [
        {
            "introduction": "The internal force vector, $\\mathbf{f}_{\\mathrm{int}}$, represents the nodal forces that are equivalent to the element's internal stress state. A fundamental requirement for any finite element formulation is that it must be able to exactly reproduce a state of constant strain. This exercise  guides you through the classic \"patch test,\" where you will derive the internal force vector for a bilinear element from first principles and verify that for a patch of elements subjected to a linear displacement field, the assembled internal forces correctly balance the external tractions, resulting in a zero residual.",
            "id": "3575060",
            "problem": "Consider a two-dimensional plane strain, four-node bilinear quadrilateral finite element that occupies the rectangular domain $\\Omega_{e} = \\{(x,y) \\, | \\, 0 \\le x \\le a, \\, 0 \\le y \\le b\\}$ in physical coordinates. The nodes are located at $(0,0)$, $(a,0)$, $(a,b)$, and $(0,b)$, labeled counterclockwise as nodes $1,2,3,4$. Let the displacement field within the element be approximated by the standard bilinear shape functions $N_{i}(x,y)$ so that $u(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, u_{i}$ and $v(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, v_{i}$, where $u_{i}$ and $v_{i}$ are the nodal displacement components. Assume an isotropic linear elastic solid under plane strain with Lamé parameters $\\lambda$ and $\\mu$ so that $\\boldsymbol{\\sigma} = 2 \\mu \\boldsymbol{\\varepsilon} + \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I}$. There are no body forces.\n\n1) A uniform (constant) strain state $\\boldsymbol{\\varepsilon}_{0}$ is imposed, with components $\\varepsilon_{0,xx}$, $\\varepsilon_{0,yy}$, and $\\varepsilon_{0,xy}$ (where $\\varepsilon_{0,xy}$ is the tensorial shear strain). Starting from the principle of virtual work and the kinematic definitions, derive the element internal force vector $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ corresponding to this uniform strain state. Express $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ explicitly in terms of $a$, $b$, $\\lambda$, $\\mu$, and the components of $\\boldsymbol{\\varepsilon}_{0}$.\n\n2) Now form a two-element patch by placing an identical second element adjacent to the first, creating the rectangular domain $\\Omega_{\\mathrm{patch}} = \\{(x,y) \\, | \\, 0 \\le x \\le 2a, \\, 0 \\le y \\le b\\}$, partitioned into the left element $\\Omega_{e}^{L} = [0,a] \\times [0,b]$ and the right element $\\Omega_{e}^{R} = [a,2a] \\times [0,b]$. Use the global node labeling: node $1 \\equiv (0,0)$, node $2 \\equiv (a,0)$, node $3 \\equiv (2a,0)$, node $4 \\equiv (2a,b)$, node $5 \\equiv (a,b)$, node $6 \\equiv (0,b)$. The left element uses nodes $(1,2,5,6)$ and the right element uses nodes $(2,3,4,5)$ in counterclockwise order. Prescribe on the outer boundary $\\partial \\Omega_{\\mathrm{patch}}$ the exact linear displacement field that corresponds to the same uniform strain $\\boldsymbol{\\varepsilon}_{0}$, namely $u(x,y) = \\varepsilon_{0,xx} \\, x + \\varepsilon_{0,xy} \\, y$ and $v(x,y) = \\varepsilon_{0,xy} \\, x + \\varepsilon_{0,yy} \\, y$, with no body forces. Using first principles, verify that the assembled residual vector $\\mathbf{r}$ over the two-element patch, defined as the sum of internal force vectors minus the equivalent nodal forces due to tractions implied by the prescribed boundary displacements, vanishes identically for all global degrees of freedom.\n\nReport as your final answer the assembled residual vector $\\mathbf{r}$ for the two-element patch, ordered by the global degrees of freedom as $\\big[u_{1}, v_{1}, u_{2}, v_{2}, u_{3}, v_{3}, u_{4}, v_{4}, u_{5}, v_{5}, u_{6}, v_{6}\\big]$. No rounding is required, and no units should be included in the final answer.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   **Element:** A 2D plane strain, four-node bilinear quadrilateral element on the domain $\\Omega_{e} = \\{(x,y) \\, | \\, 0 \\le x \\le a, \\, 0 \\le y \\le b\\}$.\n-   **Nodes (part 1):** Node 1: $(0,0)$, Node 2: $(a,0)$, Node 3: $(a,b)$, Node 4: $(0,b)$.\n-   **Displacement Approximation:** $u(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, u_{i}$, $v(x,y) = \\sum_{i=1}^{4} N_{i}(x,y) \\, v_{i}$.\n-   **Material Law:** Isotropic linear elastic, plane strain, $\\boldsymbol{\\sigma} = 2 \\mu \\boldsymbol{\\varepsilon} + \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I}$.\n-   **Forces:** No body forces.\n-   **Part 1 Condition:** A uniform strain state $\\boldsymbol{\\varepsilon}_{0}$ is imposed, with components $\\varepsilon_{0,xx}$, $\\varepsilon_{0,yy}$, and $\\varepsilon_{0,xy}$ (tensorial).\n-   **Part 1 Task:** Derive the element internal force vector $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ in terms of $a, b, \\lambda, \\mu$, and components of $\\boldsymbol{\\varepsilon}_{0}$.\n-   **Part 2 Setup:** A two-element patch on $\\Omega_{\\mathrm{patch}} = [0,2a] \\times [0,b]$. Left element $\\Omega_e^L$ on $[0,a]\\times[0,b]$, Right element $\\Omega_e^R$ on $[a,2a]\\times[0,b]$.\n-   **Global Nodes (part 2):** 1:$(0,0)$, 2:$(a,0)$, 3:$(2a,0)$, 4:$(2a,b)$, 5:$(a,b)$, 6:$(0,b)$.\n-   **Element Connectivity:** Left element $(1,2,5,6)$, Right element $(2,3,4,5)$.\n-   **Part 2 Boundary Condition:** On $\\partial\\Omega_{\\mathrm{patch}}$, a prescribed linear displacement field: $u(x,y) = \\varepsilon_{0,xx} \\, x + \\varepsilon_{0,xy} \\, y$ and $v(x,y) = \\varepsilon_{0,xy} \\, x + \\varepsilon_{0,yy} \\, y$.\n-   **Part 2 Task:** Verify that the assembled residual vector $\\mathbf{r}$, defined as the sum of internal forces minus external equivalent nodal forces, vanishes.\n-   **Final Answer:** Report the assembled residual vector $\\mathbf{r}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in computational solid mechanics, specifically the verification of a finite element formulation via the patch test.\n-   **Scientifically Grounded:** The problem uses fundamental principles of linear elasticity, the finite element method (FEM), and the principle of virtual work. All concepts and equations are standard and correct.\n-   **Well-Posed:** The problem is well-defined. Part 1 is a direct calculation. Part 2 is a patch test, which is a standard procedure with a known expected outcome for conforming elements, thus a unique and meaningful solution exists.\n-   **Objective:** The problem is stated in precise, mathematical language with no subjective or ambiguous terms.\nThe problem is free of any flaws listed in the validation checklist. It is a valid, well-posed problem in computational mechanics.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full solution will be provided.\n\n### Part 1: Derivation of the Element Internal Force Vector\n\nThe principle of virtual work states that the internal virtual work $\\delta W_{\\mathrm{int}}$ equals the external virtual work $\\delta W_{\\mathrm{ext}}$. In the absence of body forces, $\\delta W_{\\mathrm{ext}}$ is due to surface tractions. The internal virtual work is defined as:\n$$ \\delta W_{\\mathrm{int}} = \\int_{\\Omega_{e}} \\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon} \\, dV $$\nFor a 2D problem with unit thickness, $dV = dA$. The virtual work can be expressed in terms of nodal quantities. The vector of virtual nodal displacements is $\\delta\\mathbf{d}^{(e)}$ and the element internal force vector is $\\mathbf{f}_{\\mathrm{int}}^{(e)}$. Then $\\delta W_{\\mathrm{int}} = (\\delta\\mathbf{d}^{(e)})^T \\mathbf{f}_{\\mathrm{int}}^{(e)}$. The strain vector $\\boldsymbol{\\varepsilon}$ is related to the nodal displacement vector $\\mathbf{d}^{(e)}$ by the strain-displacement matrix $\\mathbf{B}$, so $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{d}^{(e)}$. The virtual strain is $\\delta\\boldsymbol{\\varepsilon} = \\mathbf{B} \\delta\\mathbf{d}^{(e)}$. Using Voigt notation, $\\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon}$ becomes $\\boldsymbol{\\sigma}^T\\delta\\boldsymbol{\\varepsilon}$.\nCombining these gives:\n$$ (\\delta\\mathbf{d}^{(e)})^T \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\int_{\\Omega_{e}} (\\mathbf{B} \\delta\\mathbf{d}^{(e)})^T \\boldsymbol{\\sigma} \\, dA = (\\delta\\mathbf{d}^{(e)})^T \\int_{\\Omega_{e}} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, dA $$\nSince this holds for any arbitrary $\\delta\\mathbf{d}^{(e)}$, we get the expression for the internal force vector:\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\int_{\\Omega_{e}} \\mathbf{B}^T \\boldsymbol{\\sigma} \\, dA $$\nThe problem imposes a uniform strain state $\\boldsymbol{\\varepsilon}_0$, which results in a uniform stress state $\\boldsymbol{\\sigma}_0$. Thus, $\\boldsymbol{\\sigma}_0$ can be taken out of the integral:\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\left(\\int_{\\Omega_{e}} \\mathbf{B}^T \\, dA\\right) \\boldsymbol{\\sigma}_0 $$\nThe bilinear shape functions for the rectangular element with nodes at $(0,0)$, $(a,0)$, $(a,b)$, $(0,b)$ are:\n$N_1 = (1 - \\frac{x}{a})(1 - \\frac{y}{b})$, $N_2 = \\frac{x}{a}(1 - \\frac{y}{b})$, $N_3 = \\frac{x}{a}\\frac{y}{b}$, $N_4 = (1 - \\frac{x}{a})\\frac{y}{b}$.\nThe strain-displacement matrix $\\mathbf{B}$ is partitioned as $\\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4]$, where for each node $i$, using engineering strain $\\gamma_{xy}=2\\varepsilon_{xy}$:\n$$ \\mathbf{B}_i = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x} \\end{bmatrix} $$\nThe integral of $\\mathbf{B}^T$ is computed term by term. For example, for node 1:\n$$ \\int_0^b \\int_0^a \\frac{\\partial N_1}{\\partial x} \\, dx \\, dy = \\int_0^b \\int_0^a -\\frac{1}{a}(1-\\frac{y}{b}) \\, dx \\, dy = \\int_0^b -(1-\\frac{y}{b}) \\, dy = -\\frac{b}{2} $$\n$$ \\int_0^b \\int_0^a \\frac{\\partial N_1}{\\partial y} \\, dx \\, dy = \\int_0^b \\int_0^a -\\frac{1}{b}(1-\\frac{x}{a}) \\, dx \\, dy = \\int_0^a -(1-\\frac{x}{a}) \\, dx = -\\frac{a}{2} $$\nBy repeating this for all shape functions, we obtain the integrated matrix:\n$$ \\int_{\\Omega_{e}} \\mathbf{B}^T \\, dA = \\frac{1}{2} \\begin{bmatrix}\n-b & 0 & -a \\\\\n0 & -a & -b \\\\\nb & 0 & -a \\\\\n0 & -a & b \\\\\nb & 0 & a \\\\\n0 & a & b \\\\\n-b & 0 & a \\\\\n0 & a & -b\n\\end{bmatrix} $$\nNext, we define the stress vector $\\boldsymbol{\\sigma}_0$ in Voigt notation $[\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^T$ from the strain state $\\boldsymbol{\\varepsilon}_0 = [\\varepsilon_{0,xx}, \\varepsilon_{0,yy}, \\gamma_{0,xy}]^T = [\\varepsilon_{0,xx}, \\varepsilon_{0,yy}, 2\\varepsilon_{0,xy}]^T$. For plane strain, the constitutive matrix $\\mathbf{C}$ is:\n$$ \\mathbf{C} = \\begin{bmatrix} \\lambda+2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda+2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix} $$\nSo $\\boldsymbol{\\sigma}_0 = \\mathbf{C} \\boldsymbol{\\varepsilon}_0$:\n$$ \\sigma_{0,xx} = (\\lambda+2\\mu)\\varepsilon_{0,xx} + \\lambda\\varepsilon_{0,yy} $$\n$$ \\sigma_{0,yy} = \\lambda\\varepsilon_{0,xx} + (\\lambda+2\\mu)\\varepsilon_{0,yy} $$\n$$ \\sigma_{0,xy} = \\mu\\gamma_{0,xy} = 2\\mu\\varepsilon_{0,xy} $$\nThe internal force vector $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ is obtained by multiplying the integrated $\\mathbf{B}^T$ matrix by the stress vector $\\boldsymbol{\\sigma}_0=[\\sigma_{0,xx}, \\sigma_{0,yy}, \\sigma_{0,xy}]^T$. For example, the forces at node 1 are:\n$$ f_{1x} = \\frac{1}{2}(-b \\sigma_{0,xx} - a \\sigma_{0,xy}) $$\n$$ f_{1y} = \\frac{1}{2}(-a \\sigma_{0,yy} - b \\sigma_{0,xy}) $$\nThe full vector is:\n$$ \\mathbf{f}_{\\mathrm{int}}^{(e)} = \\frac{1}{2} \\begin{pmatrix}\n-b \\sigma_{0,xx} - a \\sigma_{0,xy} \\\\\n-a \\sigma_{0,yy} - b \\sigma_{0,xy} \\\\\n b \\sigma_{0,xx} - a \\sigma_{0,xy} \\\\\n-a \\sigma_{0,yy} + b \\sigma_{0,xy} \\\\\n b \\sigma_{0,xx} + a \\sigma_{0,xy} \\\\\n a \\sigma_{0,yy} + b \\sigma_{0,xy} \\\\\n-b \\sigma_{0,xx} + a \\sigma_{0,xy} \\\\\n a \\sigma_{0,yy} - b \\sigma_{0,xy}\n\\end{pmatrix} $$\nSubstituting the stress components in terms of strain components completes the derivation for Part 1. For brevity in the next part, we will use the symbolic stress components.\n\n### Part 2: Patch Test Verification\n\nThe problem asks to verify that the assembled residual vector $\\mathbf{r} = \\mathbf{F}_{\\mathrm{int}} - \\mathbf{F}_{\\mathrm{ext}}$ is zero. $\\mathbf{F}_{\\mathrm{int}}$ is the assembled global internal force vector and $\\mathbf{F}_{\\mathrm{ext}}$ is the vector of equivalent nodal forces from prescribed tractions.\n\nFirst, we verify that the bilinear element reproduces the constant strain state exactly. The prescribed displacement field is $u(x,y) = \\varepsilon_{0,xx} x + \\varepsilon_{0,xy} y$ and $v(x,y) = \\varepsilon_{0,xy} x + \\varepsilon_{0,yy} y$. We evaluate these displacements at the nodes of the left element (nodes 1,2,5,6) to get the nodal displacements $u_i,v_i$. We then compute the strain field within the element from these nodal values, e.g., $\\varepsilon_{xx}(x,y) = \\sum_{i} \\frac{\\partial N_i}{\\partial x} u_i$. A detailed calculation (as performed in the thought process) confirms that this yields $\\varepsilon_{xx} = \\varepsilon_{0,xx}$, $\\varepsilon_{yy} = \\varepsilon_{0,yy}$, and $\\gamma_{xy} = 2\\varepsilon_{0,xy}$, all constant throughout the element. This is the essence of the patch test for a constant strain field.\n\nSince the strain is constant and equal to $\\boldsymbol{\\varepsilon}_0$ in both the left and right elements, the stress is also constant and equal to $\\boldsymbol{\\sigma}_0$ in both. Both elements are identical in size and orientation (after a translation for the right element), so their local internal force vectors are identical and equal to $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ derived in Part 1.\n\nThe global internal force vector $\\mathbf{F}_{\\mathrm{int}}$ is assembled by summing contributions from the two elements. The connectivity is: Left element nodes $(1,2,5,6)$ and Right element nodes $(2,3,4,5)$.\n$$ \\mathbf{F}_{\\mathrm{int},1} = \\mathbf{f}_{\\mathrm{int},1}^{(L)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},2} = \\mathbf{f}_{\\mathrm{int},2}^{(L)} + \\mathbf{f}_{\\mathrm{int},1}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},3} = \\mathbf{f}_{\\mathrm{int},2}^{(R)} $$\n$$ \\mathbf{F}_{\\mathrm{int},4} = \\mathbf{f}_{\\mathrm{int},3}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},5} = \\mathbf{f}_{\\mathrm{int},3}^{(L)} + \\mathbf{f}_{\\mathrm{int},4}^{(R)} \\quad ; \\quad \\mathbf{F}_{\\mathrm{int},6} = \\mathbf{f}_{\\mathrm{int},4}^{(L)} $$\nUsing the components of $\\mathbf{f}_{\\mathrm{int}}^{(e)}$ from Part 1 (let's denote them by $f_{ix}, f_{iy}$ for local node $i$):\n- $\\mathbf{F}_{\\mathrm{int},2} = \\begin{pmatrix} f_{2x} + f_{1x} \\\\ f_{2y} + f_{1y} \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} (b\\sigma_{0,xx}-a\\sigma_{0,xy}) + (-b\\sigma_{0,xx}-a\\sigma_{0,xy}) \\\\ (-a\\sigma_{0,yy}+b\\sigma_{0,xy}) + (-a\\sigma_{0,yy}-b\\sigma_{0,xy}) \\end{pmatrix} = \\begin{pmatrix} -a\\sigma_{0,xy} \\\\ -a\\sigma_{0,yy} \\end{pmatrix}$\n- $\\mathbf{F}_{\\mathrm{int},5} = \\begin{pmatrix} f_{3x} + f_{4x} \\\\ f_{3y} + f_{4y} \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} (b\\sigma_{0,xx}+a\\sigma_{0,xy}) + (-b\\sigma_{0,xx}+a\\sigma_{0,xy}) \\\\ (a\\sigma_{0,yy}+b\\sigma_{0,xy}) + (a\\sigma_{0,yy}-b\\sigma_{0,xy}) \\end{pmatrix} = \\begin{pmatrix} a\\sigma_{0,xy} \\\\ a\\sigma_{0,yy} \\end{pmatrix}$\nThe forces at other nodes are simply the corresponding local elemental forces.\n\nThe external force vector $\\mathbf{F}_{\\mathrm{ext}}$ is computed by integrating the traction $\\mathbf{t}=\\boldsymbol{\\sigma}_0\\mathbf{n}$ weighted by the shape functions over the boundary $\\partial\\Omega_{\\mathrm{patch}}$.\n$\\mathbf{F}_{\\mathrm{ext},i} = \\int_{\\partial\\Omega_{\\mathrm{patch}}} \\mathbf{N}_i^T \\mathbf{t} \\, dS$.\nLet's compute the external force for global node 2, which lies on the bottom boundary ($y=0$, $0 \\le x \\le 2a$). The outward normal is $\\mathbf{n}=(0,-1)^T$, so the traction is $\\mathbf{t}=(-\\sigma_{0,xy}, -\\sigma_{0,yy})^T$. The shape function for node 2 is piecewise linear along this edge: $N_2(x)=x/a$ for $x \\in [0,a]$ and $N_2(x)=(2a-x)/a$ for $x \\in [a,2a]$.\n$$ \\mathbf{F}_{\\mathrm{ext},2} = \\int_0^a \\begin{pmatrix} x/a & 0 \\\\ 0 & x/a \\end{pmatrix} \\mathbf{t} \\, dx + \\int_a^{2a} \\begin{pmatrix} (2a-x)/a & 0 \\\\ 0 & (2a-x)/a \\end{pmatrix} \\mathbf{t} \\, dx $$\n$$ \\mathbf{F}_{\\mathrm{ext},2} = \\left(\\frac{a}{2}\\right)\\mathbf{t} + \\left(\\frac{a}{2}\\right)\\mathbf{t} = a\\mathbf{t} = a \\begin{pmatrix} -\\sigma_{0,xy} \\\\ -\\sigma_{0,yy} \\end{pmatrix} = \\begin{pmatrix} -a\\sigma_{0,xy} \\\\ -a\\sigma_{0,yy} \\end{pmatrix} $$\nComparing this to the assembled internal force $\\mathbf{F}_{\\mathrm{int},2}$ calculated previously, we find they are identical. Therefore, the residual at node 2 is $\\mathbf{r}_2 = \\mathbf{F}_{\\mathrm{int},2} - \\mathbf{F}_{\\mathrm{ext},2} = \\mathbf{0}$.\n\nThis procedure is repeated for all nodes on the boundary (1, 2, 3, 4, 5, 6). Node 5 is on the top boundary. For internal nodes (none in this case), the external force would be zero.\n- For node 1: $\\mathbf{F}_{\\mathrm{ext},1}$ comes from edge 6-1 ($x=0$) and 1-2 ($y=0$). The calculation gives $\\mathbf{F}_{\\mathrm{ext},1} = \\frac{1}{2}(-b\\sigma_{0,xx} - a\\sigma_{0,xy}, -a\\sigma_{0,yy} - b\\sigma_{0,xy})^T$. This is identical to $\\mathbf{F}_{\\mathrm{int},1} = \\mathbf{f}_{\\mathrm{int},1}^{(L)}$. Thus $\\mathbf{r}_1=\\mathbf{0}$.\n- For node 3: $\\mathbf{F}_{\\mathrm{ext},3}$ is from edge 2-3 ($y=0$) and 3-4 ($x=2a$). The result is $\\mathbf{F}_{\\mathrm{ext},3} = \\frac{1}{2}(b\\sigma_{0,xx}-a\\sigma_{0,xy}, -a\\sigma_{0,yy}+b\\sigma_{0,xy})^T$, which equals $\\mathbf{F}_{\\mathrm{int},3}=\\mathbf{f}_{\\mathrm{int},2}^{(R)}$. Thus $\\mathbf{r}_3=\\mathbf{0}$.\n- For node 4: $\\mathbf{F}_{\\mathrm{ext},4}$ is from edge 3-4 ($x=2a$) and 4-5 ($y=b$). The result matches $\\mathbf{F}_{\\mathrm{int},4}=\\mathbf{f}_{\\mathrm{int},3}^{(R)}$. Thus $\\mathbf{r}_4=\\mathbf{0}$.\n- For node 5: $\\mathbf{F}_{\\mathrm{ext},5}$ is from the top edge $y=b$. It matches the assembled $\\mathbf{F}_{\\mathrm{int},5}$. Thus $\\mathbf{r}_5=\\mathbf{0}$.\n- For node 6: $\\mathbf{F}_{\\mathrm{ext},6}$ is from edge 5-6 ($y=b$) and 6-1 ($x=0$). It matches $\\mathbf{F}_{\\mathrm{int},6}=\\mathbf{f}_{\\mathrm{int},4}^{(L)}$. Thus $\\mathbf{r}_6=\\mathbf{0}$.\n\nSince the residual at every global degree of freedom is zero, the assembled residual vector $\\mathbf{r}$ for the entire patch is a vector containing twelve zeros. This verifies that the bilinear quadrilateral element passes the constant strain patch test, a fundamental requirement for convergence.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "To improve computational efficiency, especially in large-scale simulations, the integral for the internal force vector is often approximated using reduced-order quadrature. While effective, this can introduce non-physical, zero-energy deformation modes known as \"hourglassing.\" This practice  explores the theoretical basis of these modes and challenges you to derive the stabilization forces needed to suppress them, demonstrating how the standard internal force calculation is augmented to ensure physically meaningful results in under-integrated elements.",
            "id": "3575022",
            "problem": "Consider an eight-node trilinear hexahedral finite element with natural coordinates $\\left(\\xi,\\eta,\\zeta\\right) \\in [-1,1]^3$ and node positions at the eight corners $\\left(\\xi_i,\\eta_i,\\zeta_i\\right) \\in \\{-1,1\\}^3$, $i=1,\\dots,8$. The isoparametric mapping to the physical element is orthogonal and affine: $x = \\frac{L_x}{2}\\xi$, $y = \\frac{L_y}{2}\\eta$, $z = \\frac{L_z}{2}\\zeta$, with $L_x$, $L_y$, and $L_z$ denoting the element edge lengths, so the Jacobian is constant and the element volume is $V = L_x L_y L_z$. The material is homogeneous, isotropic, and obeys small-strain linear elasticity with Lamé parameters $\\lambda$ and $\\mu$.\n\nThe element is evaluated using one-point reduced integration at the element center $\\left(\\xi,\\eta,\\zeta\\right) = (0,0,0)$ for the internal force vector. The standard internal force contribution from the reduced integration vanishes for so-called hourglass deformation modes, which are displacement patterns that produce zero strain at the integration point but nonzero nodal work. One canonical hourglass mode basis (Flanagan–Belytschko type) can be constructed using nodal sign patterns derived from products of the natural coordinate signs. Consider the hourglass basis vector defined by the nodal weights\n$$\nw_i = \\xi_i\\,\\eta_i\\,\\zeta_i, \\quad i=1,\\dots,8,\n$$\nwhich yields the sequence $w_1=-1$, $w_2=+1$, $w_3=-1$, $w_4=+1$, $w_5=+1$, $w_6=-1$, $w_7=+1$, $w_8=-1$ for the conventional node ordering $\\left(-1,-1,-1\\right)$, $\\left(+1,-1,-1\\right)$, $\\left(+1,+1,-1\\right)$, $\\left(-1,+1,-1\\right)$, $\\left(-1,-1,+1\\right)$, $\\left(+1,-1,+1\\right)$, $\\left(+1,+1,+1\\right)$, and $\\left(-1,+1,+1\\right)$, respectively.\n\nNow prescribe a pure hourglass displacement field in the $x$-direction only, with nodal displacements\n$$\nu_i^{x} = q_x\\,w_i, \\quad u_i^{y} = 0, \\quad u_i^{z} = 0, \\quad i=1,\\dots,8,\n$$\nwhere $q_x$ is a scalar amplitude defining the generalized coordinate of the selected hourglass mode. Define the generalized coordinate by the projection\n$$\nq_x = \\frac{1}{8}\\sum_{i=1}^{8} w_i\\,u_i^{x}.\n$$\n\nTo regularize the hourglass deformation in one-point reduced integration, introduce hourglass control via either Enhanced Assumed Strain (EAS) or the Flanagan–Belytschko stabilization concept. Starting from the principle of virtual work, and requiring dimensional consistency and linear patch-test consistency, derive the stabilized internal hourglass force subvector in the $x$-direction at the nodes, expressed in terms of the shear modulus $\\mu$, the element volume $V$, the characteristic length $L_x$ associated with the $x$-direction, the stabilization parameter $\\alpha$ (a dimensionless tuning parameter), and the amplitude $q_x$.\n\nYour derivation must begin from first principles of virtual work and small-strain linear elasticity, explain why the reduced integration produces zero standard internal forces for this mode, and then introduce a stabilization energy consistent with the shear energy scaling that is quadratic in the hourglass amplitude. Explain qualitatively how the parameter $\\alpha$ affects consistency (e.g., satisfaction of the linear patch test) and accuracy (e.g., dispersion and spurious stiffness), including the role of the characteristic length $L_x$.\n\nProvide, as your final answer, the closed-form eight-component row vector of nodal hourglass control forces in the $x$-direction $\\left(f_1^{x}, f_2^{x}, \\dots, f_8^{x}\\right)$, symbolically in terms of $\\alpha$, $\\mu$, $V$, $L_x$, and $q_x$, using the specified $w_i$ pattern. No numerical evaluation is required, and no rounding is needed. Do not include units in the final boxed answer.",
            "solution": "The problem statement is evaluated to be scientifically grounded, well-posed, objective, and self-consistent. It describes a standard scenario in computational solid mechanics concerning hourglass instability in under-integrated finite elements and its stabilization. It is therefore deemed a valid problem.\n\nThe derivation of the stabilized internal hourglass force subvector begins from the principle of virtual work. The internal virtual work, $\\delta W_{\\text{int}}$, is given by the integral of the contraction between the stress tensor $\\boldsymbol{\\sigma}$ and the variation of the strain tensor $\\delta \\boldsymbol{\\varepsilon}$ over the element volume $V$:\n$$\n\\delta W_{\\text{int}} = \\int_V \\boldsymbol{\\sigma} : \\delta \\boldsymbol{\\varepsilon} \\, dV\n$$\nThe nodal internal forces $f_i$ are obtained from the relation $\\delta W_{\\text{int}} = \\sum_i \\delta u_i f_i$.\n\nFirst, we establish the kinematics of the prescribed hourglass mode. The displacement field $\\mathbf{u}$ within the element is interpolated from the nodal displacements $\\mathbf{u}_i$ using the trilinear shape functions $N_i(\\xi, \\eta, \\zeta) = \\frac{1}{8}(1+\\xi_i\\xi)(1+\\eta_i\\eta)(1+\\zeta_i\\zeta)$. The nodal displacements are given as $u_i^x = q_x w_i$, $u_i^y = 0$, and $u_i^z = 0$, where $w_i = \\xi_i\\eta_i\\zeta_i$. The displacement field in the $x$-direction is:\n$$\nu_x(\\xi, \\eta, \\zeta) = \\sum_{i=1}^{8} N_i(\\xi, \\eta, \\zeta) u_i^x = q_x \\sum_{i=1}^{8} \\frac{1}{8}(1+\\xi_i\\xi)(1+\\eta_i\\eta)(1+\\zeta_i\\zeta) (\\xi_i\\eta_i\\zeta_i)\n$$\nBy expanding the product and utilizing the orthogonality properties of the nodal coordinate vectors (e.g., $\\sum_i \\xi_i = 0$, $\\sum_i \\xi_i\\eta_i = 0$, etc.), this expression simplifies significantly. Alternatively, we can expand the displacement field in a basis of monomials of $\\xi, \\eta, \\zeta$. For the given nodal displacements, only the coefficient of the $\\xi\\eta\\zeta$ term is non-zero:\n$$\n\\frac{1}{8}\\sum_{i=1}^{8} (\\xi_i\\eta_i\\zeta_i) u_i^x = \\frac{1}{8}\\sum_{i=1}^{8} (\\xi_i\\eta_i\\zeta_i) (q_x \\xi_i\\eta_i\\zeta_i) = \\frac{q_x}{8}\\sum_{i=1}^{8} (\\xi_i\\eta_i\\zeta_i)^2 = \\frac{q_x}{8} \\sum_{i=1}^{8} 1 = q_x\n$$\nAll other coefficients, corresponding to lower-order terms, are zero. Thus, the displacement field within the element is purely trilinear:\n$$\nu_x(\\xi, \\eta, \\zeta) = q_x \\xi \\eta \\zeta, \\quad u_y=0, \\quad u_z=0\n$$\n\nNext, we calculate the small-strain tensor $\\boldsymbol{\\varepsilon} = \\frac{1}{2}(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$. The gradient operator in physical coordinates $(x,y,z)$ is related to the gradient in natural coordinates $(\\xi, \\eta, \\zeta)$ via the inverse of the Jacobian matrix of the isoparametric mapping. For the given affine mapping $x = \\frac{L_x}{2}\\xi$, $y = \\frac{L_y}{2}\\eta$, $z = \\frac{L_z}{2}\\zeta$, we have $\\frac{\\partial}{\\partial x} = \\frac{2}{L_x}\\frac{\\partial}{\\partial \\xi}$, $\\frac{\\partial}{\\partial y} = \\frac{2}{L_y}\\frac{\\partial}{\\partial \\eta}$, and $\\frac{\\partial}{\\partial z} = \\frac{2}{L_z}\\frac{\\partial}{\\partial \\zeta}$. The strain components are:\n$$\n\\varepsilon_{xx} = \\frac{\\partial u_x}{\\partial x} = \\frac{2}{L_x}\\frac{\\partial}{\\partial \\xi}(q_x\\xi\\eta\\zeta) = \\frac{2 q_x}{L_x}\\eta\\zeta\n$$\n$$\n\\varepsilon_{yy} = \\frac{\\partial u_y}{\\partial y} = 0, \\quad \\varepsilon_{zz} = \\frac{\\partial u_z}{\\partial z} = 0\n$$\n$$\n\\varepsilon_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x}\\right) = \\frac{1}{2}\\frac{\\partial u_x}{\\partial y} = \\frac{1}{2}\\frac{2}{L_y}\\frac{\\partial}{\\partial \\eta}(q_x\\xi\\eta\\zeta) = \\frac{q_x}{L_y}\\xi\\zeta\n$$\n$$\n\\varepsilon_{xz} = \\frac{1}{2}\\left(\\frac{\\partial u_x}{\\partial z} + \\frac{\\partial u_z}{\\partial x}\\right) = \\frac{1}{2}\\frac{\\partial u_x}{\\partial z} = \\frac{1}{2}\\frac{2}{L_z}\\frac{\\partial}{\\partial \\zeta}(q_x\\xi\\eta\\zeta) = \\frac{q_x}{L_z}\\xi\\eta\n$$\n$$\n\\varepsilon_{yz} = \\frac{1}{2}\\left(\\frac{\\partial u_y}{\\partial z} + \\frac{\\partial u_z}{\\partial y}\\right) = 0\n$$\n\nThe problem specifies Gauss quadrature using a single integration point at the element center, $(\\xi, \\eta, \\zeta) = (0, 0, 0)$. At this point, all components of the strain tensor are zero:\n$$\n\\boldsymbol{\\varepsilon}(0,0,0) = \\mathbf{0}\n$$\nFor a linear elastic material, the stress tensor is given by Hooke's Law, $\\boldsymbol{\\sigma} = \\mathbf{C}:\\boldsymbol{\\varepsilon}$, where $\\mathbf{C}$ is the tensor of elastic moduli. Since the strain is zero at the integration point, the stress is also zero: $\\boldsymbol{\\sigma}(0,0,0) = \\mathbf{0}$.\n\nThe internal force vector calculated using one-point integration is $\\mathbf{f}_{\\text{int}} = (\\mathbf{B}^T \\boldsymbol{\\sigma})|_{\\xi=0,\\eta=0,\\zeta=0} \\cdot V$, where $\\mathbf{B}$ is the strain-displacement matrix. Since $\\boldsymbol{\\sigma}(0,0,0) = \\mathbf{0}$, the resulting internal force vector is identically zero. This is the definition of an hourglass or zero-energy mode for this integration scheme: it is a non-rigid body deformation mode that produces zero strain energy when evaluated with reduced integration.\n\nTo counteract this instability, a stabilization term is added. This is formulated by defining a stabilization potential energy $\\Pi_{hg}$ that is quadratic in the hourglass mode amplitude $q_x$:\n$$\n\\Pi_{hg} = \\frac{1}{2} C_{hg} q_x^2\n$$\nwhere $C_{hg}$ is the hourglass stiffness coefficient. The generalized force $Q_x$ conjugate to the generalized coordinate $q_x$ is found by differentiating the potential:\n$$\nQ_x = \\frac{\\partial \\Pi_{hg}}{\\partial q_x} = C_{hg} q_x\n$$\nThe virtual work done by this generalized force is $\\delta W_{hg} = Q_x \\delta q_x$. The variation of the generalized coordinate is $\\delta q_x = \\frac{1}{8}\\sum_{i=1}^{8} w_i \\delta u_i^x$. The virtual work can also be expressed in terms of nodal forces $\\mathbf{f}_{hg}$ and nodal virtual displacements $\\delta \\mathbf{u}$:\n$$\n\\delta W_{hg} = (\\delta \\mathbf{u}^x)^T \\mathbf{f}_{hg}^x = \\sum_{i=1}^8 \\delta u^x_i f^x_{i,hg}\n$$\nBy equating the two expressions for $\\delta W_{hg}$, we find the nodal hourglass forces:\n$$\n\\sum_{i=1}^8 \\delta u^x_i f^x_{i,hg} = Q_x \\left( \\frac{1}{8}\\sum_{i=1}^{8} w_i \\delta u_i^x \\right) = \\sum_{i=1}^8 \\delta u_i^x \\left(\\frac{Q_x}{8} w_i \\right)\n$$\nThis implies that the hourglass force at node $i$ is:\n$$\nf_{i,hg}^x = \\frac{Q_x}{8} w_i = \\frac{C_{hg} q_x}{8} w_i\n$$\n\nThe final step is to determine the stiffness coefficient $C_{hg}$. The problem requires a form based on the shear modulus $\\mu$, element volume $V$, characteristic length $L_x$, and a dimensionless parameter $\\alpha$. Dimensional analysis requires $C_{hg}$ to have units of stiffness (Force/Length). The combination $\\mu V / L_x^2$ has the correct units: $(F/L^2) \\cdot L^3 / L^2 = F/L$. The use of the shear modulus $\\mu$ is physically motivated because this hourglass mode involves shear-like deformations (as evidenced by the non-zero $\\varepsilon_{xy}$ and $\\varepsilon_{xz}$ strains). The stabilization should restore the missing shear energy. The parameter $L_x$ is specified as the characteristic length for this mode. The dimensionless parameter $\\alpha$ serves as a tuning or scaling factor. Thus, we define the hourglass stiffness as:\n$$\nC_{hg} = \\alpha \\frac{\\mu V}{L_x^2}\n$$\n\nThe role of the parameter $\\alpha$ is to control the magnitude of the stabilization. For linear patch-test consistency, the hourglass stabilization force must vanish for any constant strain state. This is guaranteed by the construction of the hourglass vector $\\mathbf{w}$, which is orthogonal to linear displacement fields, a property independent of $\\alpha$. However, the accuracy of the element is highly dependent on $\\alpha$. An overly large $\\alpha$ introduces excessive artificial stiffness, leading to shear locking and an underestimation of deformation. An overly small $\\alpha$ may not be sufficient to suppress spurious hourglass oscillations. The characteristic length $L_x$ provides the correct scaling with element size. While a more rigorous derivation would result in a stiffness dependent on $L_y$ and $L_z$ for this mode, the problem statement mandates the use of $L_x$.\n\nSubstituting the expression for $C_{hg}$ into the nodal force equation, we get:\n$$\nf_{i,hg}^x = \\frac{1}{8} \\left( \\alpha \\frac{\\mu V}{L_x^2} \\right) q_x w_i = \\frac{\\alpha \\mu V q_x}{8 L_x^2} w_i\n$$\nThe vector of nodal hourglass control forces is $\\mathbf{f}_{hg}^x = (f_{1,hg}^x, f_{2,hg}^x, \\dots, f_{8,hg}^x)$. Using the given sequence for the nodal weights $w_i = (-1, +1, -1, +1, +1, -1, +1, -1)$ for nodes $i=1, \\dots, 8$, the force vector is:\n$$\n\\mathbf{f}_{hg}^x = \\frac{\\alpha \\mu V q_x}{8 L_x^2} \\begin{pmatrix} -1 & 1 & -1 & 1 & 1 & -1 & 1 & -1 \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\alpha \\mu V q_x}{8 L_x^2} & \\frac{\\alpha \\mu V q_x}{8 L_x^2} & -\\frac{\\alpha \\mu V q_x}{8 L_x^2} & \\frac{\\alpha \\mu V q_x}{8 L_x^2} & \\frac{\\alpha \\mu V q_x}{8 L_x^2} & -\\frac{\\alpha \\mu V q_x}{8 L_x^2} & \\frac{\\alpha \\mu V q_x}{8 L_x^2} & -\\frac{\\alpha \\mu V q_x}{8 L_x^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving beyond small-strain assumptions, the analysis of many engineering problems requires a finite strain formulation to account for both large deformations and material nonlinearities. In this comprehensive exercise , you will implement the internal force vector from first principles within a Total Lagrangian framework. This involves using work-conjugate stress and strain measures, like the Second Piola-Kirchhoff stress and Green-Lagrange strain, to correctly formulate and compute the internal forces in the reference configuration.",
            "id": "2597240",
            "problem": "Implement a complete and runnable program that, for a single four-node linear tetrahedral solid element in a Total Lagrangian formulation, computes the internal force vector and the element consistent tangent stiffness matrix decomposed into its material and geometric parts, for a specified family of homogeneous deformations. Your implementation must be derived from the following fundamental base.\n\n1. Start from the principle of virtual work for a hyperelastic continuum in the reference configuration: the internal virtual work is given by the work-conjugate pair of the Second Piola–Kirchhoff stress $S$ and the Green–Lagrange strain $E$, and the deformation gradient $F$ built from the nodal displacements in the reference (undeformed) configuration.\n2. Use the following well-tested and standard definitions:\n   - The deformation gradient is $F = I + \\nabla_0 u$, where $I$ is the identity, $\\nabla_0$ denotes the gradient with respect to reference coordinates, and $u$ is the displacement field approximated by nodal values and shape functions.\n   - The Green–Lagrange strain is $E = \\frac{1}{2}(F^T F - I)$.\n   - The Second Piola–Kirchhoff stress is specified via a stored energy function $W(E)$ by $S(E) = \\partial W/\\partial E$.\n   - The First Piola–Kirchhoff stress is $P = F S$.\n   - The internal force vector for an element is the consistent discretization of the internal virtual work functional.\n   - The consistent tangent stiffness matrix is the Fréchet derivative of the internal force vector with respect to the nodal displacement vector, and it admits a decomposition into a material part (arising from the constitutive tangent $dS/dE$) and a geometric part (arising from the stress contribution to the linearization of $P$).\n\nAssume a single linear tetrahedral element whose reference nodal coordinates are\n- Node $1$: $(0,0,0)$,\n- Node $2$: $(1,0,0)$,\n- Node $3$: $(0,1,0)$,\n- Node $4$: $(0,0,1)$.\n\nAll quantities are dimensionless. Angles, where applicable, must be interpreted in radians.\n\nUse the following constitutive model expressed in terms of the Green–Lagrange strain:\n- Stored energy density\n$$\nW(E) = \\frac{1}{2}\\lambda \\left(\\operatorname{tr} E\\right)^2 + \\mu\\, E:E + \\frac{\\alpha}{3}\\left(\\operatorname{tr} E\\right)^3,\n$$\nwhere $\\lambda$ and $\\mu$ are Lamé parameters, and $\\alpha$ is a scalar parameter introducing material nonlinearity depending on $\\operatorname{tr} E$.\n- Second Piola–Kirchhoff stress\n$$\nS(E) = \\lambda\\, \\operatorname{tr} E\\, I + 2\\mu\\, E + \\alpha \\left(\\operatorname{tr} E\\right)^2 I.\n$$\n\nYou must derive and implement the consistent element tangent stiffness matrix $K$ split into\n$$\nK = K_{\\mathrm{mat}} + K_{\\mathrm{geo}},\n$$\nwhere $K_{\\mathrm{mat}}$ is the material part associated with the algorithmic constitutive tangent $\\mathbb{C}_{\\mathrm{alg}} = dS/dE$ and $K_{\\mathrm{geo}}$ is the geometric (initial-stress) part associated with the current stress state. Your expressions must proceed from the first principles above without invoking unproven shortcut formulas. The final algorithm must use exact one-point integration for this linear tetrahedron, exploiting the fact that the gradients of the shape functions in the reference configuration are constant.\n\nTest Suite:\nImplement the program to evaluate the following five test cases, each defined by the material parameters $(\\lambda,\\mu,\\alpha)$ and a homogeneous deformation mapping $x = F X$. For each case, construct nodal displacements from the given $F$ via $d_a = F X_a - X_a$.\n\n- Case 1 (Undeformed reference): $\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = I$.\n- Case 2 (Rigid rotation about $z$): $\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = R_z(\\theta)$ with $\\theta = 0.5$ radians and\n  $\n  R_z(\\theta) = \\begin{bmatrix}\n  \\cos\\theta & -\\sin\\theta & 0\\\\\n  \\sin\\theta & \\cos\\theta & 0\\\\\n  0 & 0 & 1\n  \\end{bmatrix}.\n  $\n- Case 3 (Uniaxial stretch in $x$): $\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.0$, $F = \\operatorname{diag}(1.2,1,1)$.\n- Case 4 (Simple shear in $x$ along $y$): $\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.05$, $F = \\begin{bmatrix}1 & \\gamma & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}$ with $\\gamma=0.3$.\n- Case 5 (Volumetric expansion): $\\lambda=2.0$, $\\mu=1.0$, $\\alpha=0.1$, $F = \\operatorname{diag}(s,s,s)$ with $s=1.1$.\n\nFor each test case, compute:\n- The Euclidean norm of the internal force vector, $\\|f_{\\mathrm{int}}\\|_2$.\n- The Frobenius norm of the material stiffness matrix, $\\|K_{\\mathrm{mat}}\\|_F$.\n- The Frobenius norm of the geometric stiffness matrix, $\\|K_{\\mathrm{geo}}\\|_F$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for all five cases as a single flat list of $15$ floating-point numbers in the order\n$\n[\\|f\\|_2^{(1)}, \\|K_{\\mathrm{mat}}\\|_F^{(1)}, \\|K_{\\mathrm{geo}}\\|_F^{(1)}, \\ldots, \\|f\\|_2^{(5)}, \\|K_{\\mathrm{mat}}\\|_F^{(5)}, \\|K_{\\mathrm{geo}}\\|_F^{(5)}],\n$\nprinted as a comma-separated list enclosed in square brackets with no additional text.",
            "solution": "The problem is subjected to validation and is deemed valid. It is a well-posed, scientifically grounded problem in the field of computational nonlinear mechanics, providing all necessary data and definitions for a unique solution. We shall proceed with the derivation and implementation.\n\nThe core of the problem is to compute the internal force vector and the consistent tangent stiffness matrix for a four-node tetrahedral element under a specified homogeneous deformation. The formulation is Total Lagrangian, meaning all quantities are referred to the undeformed reference configuration.\n\n**1. Kinematics of the Linear Tetrahedron**\n\nThe element has four nodes with reference coordinates $X_a$. The specified coordinates are $X_1 = (0,0,0)^T$, $X_2 = (1,0,0)^T$, $X_3 = (0,1,0)^T$, and $X_4 = (0,0,1)^T$. The displacement field $u(X)$ is interpolated from nodal displacements $d_a$ using linear shape functions $N_a(X)$:\n$$ u(X) = \\sum_{a=1}^{4} N_a(X) d_a $$\nFor this specific reference tetrahedron, the shape functions are:\n$$ N_1(X) = 1 - X_1 - X_2 - X_3, \\quad N_2(X) = X_1, \\quad N_3(X) = X_2, \\quad N_4(X) = X_3 $$\nThe gradients of these shape functions, $\\nabla_0 N_a = \\partial N_a / \\partial X$, are constant within the element:\n$$ \\nabla_0 N_1 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}, \\quad \\nabla_0 N_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_0 N_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad \\nabla_0 N_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\nThe deformation gradient $F$ is defined as $F = I + \\nabla_0 u$. For a linear element, the displacement gradient $\\nabla_0 u$ is constant:\n$$ \\nabla_0 u = \\sum_{a=1}^{4} d_a \\otimes \\nabla_0 N_a = \\sum_{a=1}^{4} d_a (\\nabla_0 N_a)^T $$\nThe problem specifies a homogeneous deformation $x = FX$, where $F$ is a constant matrix. This implies a linear displacement field $u(X) = (F-I)X$. The nodal displacements are therefore $d_a = u(X_a) = (F-I)X_a$. As the displacement field is linear, its gradient is constant and is precisely $F-I$. Thus, $\\nabla_0 u = F-I$, and the interpolated deformation gradient is identical to the specified constant $F$.\n\nThe Green-Lagrange strain tensor $E$, which is also constant throughout the element, is given by:\n$$ E = \\frac{1}{2}(F^T F - I) $$\nThe volume of this reference element is $V_0 = 1/6$. Since all integrands will be constant, integration over the element volume $V_0$ simplifies to multiplication by $V_0$.\n\n**2. Internal Force Vector**\n\nThe principle of virtual work in the reference configuration states that the internal virtual work $\\delta W_{\\mathrm{int}}$ is:\n$$ \\delta W_{\\mathrm{int}} = \\int_{V_0} S : \\delta E \\, dV_0 $$\nwhere $S$ is the Second Piola-Kirchhoff stress tensor. This can be re-expressed in terms of the First Piola-Kirchhoff stress tensor $P = FS$:\n$$ S : \\delta E = S : \\frac{1}{2}(\\delta F^T F + F^T \\delta F) = (FS) : \\delta F = P : \\delta F $$\nThe variation of the deformation gradient is $\\delta F = \\sum_a \\delta d_a (\\nabla_0 N_a)^T$. The virtual work is also $\\delta W_{\\mathrm{int}} = \\sum_a \\delta d_a \\cdot f_{\\mathrm{int},a}$. Equating the two expressions for $\\delta W_{\\mathrm{int}}$:\n$$ \\sum_{a,i} \\delta d_{ia} f_{\\mathrm{int},ia} = \\int_{V_0} P_{ij} \\delta F_{ij} \\, dV_0 = \\int_{V_0} P_{ij} \\sum_{a,k} \\delta d_{ka} (\\nabla_0 N_a)_j \\delta_{ik} \\, dV_0 $$\n$$ \\sum_{a,i} \\delta d_{ia} f_{\\mathrm{int},ia} = \\sum_{a,i} \\delta d_{ia} \\int_{V_0} P_{ij} (\\nabla_0 N_a)_j \\, dV_0 $$\nBy equating coefficients of the arbitrary virtual displacements $\\delta d_{ia}$, we obtain the internal force vector for node $a$:\n$$ f_{\\mathrm{int},a} = \\int_{V_0} P^T (\\nabla_0 N_a) \\, dV_0 = V_0 P (\\nabla_0 N_a) $$\nThe full internal force vector $f_{\\mathrm{int}} \\in \\mathbb{R}^{12}$ is assembled by stacking the nodal force vectors $f_{\\mathrm{int},a} \\in \\mathbb{R}^3$.\n\n**3. Constitutive Law and Tangent Modulus**\n\nThe problem specifies a hyperelastic material model with stored energy function $W(E) = \\frac{1}{2}\\lambda (\\operatorname{tr} E)^2 + \\mu E:E + \\frac{\\alpha}{3}(\\operatorname{tr} E)^3$. The Second Piola-Kirchhoff stress $S = \\partial W / \\partial E$ is given as:\n$$ S = \\lambda (\\operatorname{tr} E) I + 2\\mu E + \\alpha (\\operatorname{tr} E)^2 I $$\nThe fourth-order material tangent stiffness tensor $\\mathbb{C} = \\partial S / \\partial E$ is found by differentiation:\n$$ \\mathbb{C}_{ijkl} = \\frac{\\partial S_{ij}}{\\partial E_{kl}} = \\lambda \\delta_{ij}\\delta_{kl} + \\mu(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk}) + 2\\alpha (\\operatorname{tr} E) \\delta_{ij}\\delta_{kl} $$\n\n**4. Consistent Tangent Stiffness Matrix**\n\nThe consistent tangent stiffness matrix $K$ is the derivative of the internal force vector $f_{\\mathrm{int}}$ with respect to the nodal displacement vector $d$. Its components are $K_{(ai)(bk)} = \\partial f_{\\mathrm{int},ia} / \\partial d_{kb}$.\n$$ \\delta f_{\\mathrm{int},a} = V_0 (\\delta P) (\\nabla_0 N_a) $$\nThe variation of the First Piola-Kirchhoff stress is $\\delta P = \\delta(FS) = (\\delta F)S + F(\\delta S)$. This splits the tangent matrix into a geometric part and a material part, $K = K_{\\mathrm{geo}} + K_{\\mathrm{mat}}$.\n\n**4.1. Geometric Stiffness Matrix ($K_{\\mathrm{geo}}$)**\nThe geometric part arises from the term $(\\delta F)S$:\n$$ \\delta f_{\\mathrm{int},a}^{(\\mathrm{geo})} = V_0 (\\delta F) S (\\nabla_0 N_a) $$\nSubstituting $\\delta F = \\sum_b \\delta d_b (\\nabla_0 N_b)^T$:\n$$ (\\delta f_{\\mathrm{int},a}^{(\\mathrm{geo})})_i = V_0 \\left( \\sum_b (\\delta d_b)_i (\\nabla_0 N_b)_j \\right) S_{jk} (\\nabla_0 N_a)_k $$\nThe component $K_{(ai)(bi)}$ is the coefficient of $(\\delta d_b)_i$. Due to the structure of $\\delta F$, there is no coupling between different displacement components, i.e., it is proportional to $\\delta_{ik}$.\n$$ K_{\\mathrm{geo},(ai)(bk)} = \\frac{\\partial f_{\\mathrm{int},ia}^{(\\mathrm{geo})}}{\\partial d_{kb}} = V_0 \\delta_{ik} \\left( (\\nabla_0 N_b)^T S (\\nabla_0 N_a) \\right) $$\nThis means the $3 \\times 3$ block matrix $K_{\\mathrm{geo},ab}$ is a scalar multiple of the identity matrix:\n$$ K_{\\mathrm{geo},ab} = V_0 \\left( (\\nabla_0 N_b)^T S (\\nabla_0 N_a) \\right) I_{3 \\times 3} $$\n\n**4.2. Material Stiffness Matrix ($K_{\\mathrm{mat}}$)**\nThe material part arises from the term $F(\\delta S)$:\n$$ \\delta f_{\\mathrm{int},a}^{(\\mathrm{mat})} = V_0 F (\\delta S) (\\nabla_0 N_a) $$\nHere, $\\delta S = \\mathbb{C} : \\delta E$. The variation of the Green-Lagrange strain is $\\delta E_{rs} = \\frac{1}{2}(\\delta F_{pr}F_{ps} + F_{pr}\\delta F_{ps})$. Substituting the expression for $\\delta F$ in terms of nodal displacements leads to a complex but derivable expression for the material stiffness matrix component $K_{(ai)(bk)}$:\n$$ K_{\\mathrm{mat},(ai)(bk)} = \\frac{\\partial f_{\\mathrm{int},ia}^{(\\mathrm{mat})}}{\\partial d_{kb}} = V_0 \\sum_{j,l,r,s} \\frac{1}{2} (\\nabla_0 N_a)_j F_{il} \\mathbb{C}_{ljrs} (F_{ks}(\\nabla_0 N_b)_r + F_{kr}(\\nabla_0 N_b)_s) $$\nThis expression, though cumbersome in index notation, can be efficiently implemented using Einstein summation conventions. A $4D$ tensor `K_mat_blocks[i, k, a, b]` can be computed, representing the $3 \\times 3$ sub-block for nodes $a$ and $b$.\n\n**5. Summary of the Algorithm**\n\nFor each test case with parameters $(\\lambda, \\mu, \\alpha)$ and deformation gradient $F$:\n1.  Establish element geometry: $V_0 = 1/6$ and the constant gradient matrix of shape functions, `grad_N_T` ($3 \\times 4$).\n2.  Compute strain: $E = \\frac{1}{2}(F^T F - I)$.\n3.  Compute stresses: $S = (\\lambda \\operatorname{tr} E + \\alpha (\\operatorname{tr}E)^2) I + 2\\mu E$ and $P = FS$.\n4.  Compute internal force vector: $f_{\\mathrm{int},a} = V_0 P (\\nabla_0 N_a)$ for each node $a$, then assemble into a $12 \\times 1$ vector $f_{\\mathrm{int}}$ and calculate its Euclidean norm $\\|f_{\\mathrm{int}}\\|_2$.\n5.  Compute geometric stiffness matrix $K_{\\mathrm{geo}}$: Construct the $4 \\times 4$ matrix $M_{ba} = (\\nabla_0 N_b)^T S (\\nabla_0 N_a)$, then form the $12 \\times 12$ matrix $K_{\\mathrm{geo}} = V_0 \\cdot (M \\otimes I_{3 \\times 3})$ and find its Frobenius norm $\\|K_{\\mathrm{geo}}\\|_F$.\n6.  Compute material stiffness matrix $K_{\\mathrm{mat}}$: First compute the tangent modulus tensor $\\mathbb{C}$. Then use the derived index formula to compute the $12 \\times 12$ matrix $K_{\\mathrm{mat}}$ and its Frobenius norm $\\|K_{\\mathrm{mat}}\\|_F$.\n\nThis procedure is implemented for each of the five test cases specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Computes internal forces and stiffness matrices for a 4-node tetrahedron.\n    \"\"\"\n\n    def get_rotation_matrix_z(theta):\n        \"\"\"Returns a 3x3 rotation matrix around the Z-axis.\"\"\"\n        c, s = np.cos(theta), np.sin(theta)\n        return np.array([[c, -s, 0], [s, c, 0], [0, 0, 1]])\n\n    # Define test cases: (lambda, mu, alpha, F_matrix)\n    test_cases = [\n        # Case 1: Undeformed reference\n        (2.0, 1.0, 0.0, np.eye(3)),\n        # Case 2: Rigid rotation about z\n        (2.0, 1.0, 0.0, get_rotation_matrix_z(0.5)),\n        # Case 3: Uniaxial stretch in x\n        (2.0, 1.0, 0.0, np.diag([1.2, 1.0, 1.0])),\n        # Case 4: Simple shear in x along y\n        (2.0, 1.0, 0.05, np.array([[1.0, 0.3, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]])),\n        # Case 5: Volumetric expansion\n        (2.0, 1.0, 0.1, np.diag([1.1, 1.1, 1.1]))\n    ]\n    \n    # Element properties for the reference tetrahedron (0,0,0), (1,0,0), (0,1,0), (0,0,1)\n    V0 = 1.0 / 6.0\n    \n    # Gradients of shape functions, arranged as a 3x4 matrix [grad(N1), grad(N2), grad(N3), grad(N4)]\n    grad_N_T = np.array([[-1., 1., 0., 0.],\n                         [-1., 0., 1., 0.],\n                         [-1., 0., 0., 1.]])\n    \n    # Transposed version for easier einsum: g[a,j] = (grad N_a)_j\n    g = grad_N_T.T\n\n    I_3 = np.eye(3)\n    delta = np.eye(3)\n\n    results = []\n\n    for params in test_cases:\n        lam, mu, alpha, F = params\n\n        # --- Compute Strain and Stresses ---\n        # Green-Lagrange strain tensor E\n        E = 0.5 * (F.T @ F - I_3)\n        tr_E = np.trace(E)\n\n        # Second Piola-Kirchhoff stress tensor S\n        S = lam * tr_E * I_3 + 2.0 * mu * E + alpha * (tr_E**2) * I_3\n\n        # First Piola-Kirchhoff stress tensor P\n        P = F @ S\n\n        # --- Compute Internal Force Vector ---\n        f_int = np.zeros(12)\n        for a in range(4):\n            # f_int_a = V0 * P @ grad(N_a)\n            f_int_a = V0 * P @ grad_N_T[:, a]\n            f_int[3*a : 3*a+3] = f_int_a\n        \n        norm_f_int = np.linalg.norm(f_int)\n\n        # --- Compute Geometric Stiffness Matrix K_geo ---\n        # M_ba = (grad N_b)^T @ S @ (grad N_a)\n        M = grad_N_T.T @ S @ grad_N_T\n        K_geo = V0 * np.kron(M, I_3)\n\n        norm_K_geo = np.linalg.norm(K_geo)\n\n        # --- Compute Material Stiffness Matrix K_mat ---\n        # 4th-order material tangent C_ijkl\n        C = (lam + 2.0 * alpha * tr_E) * np.einsum('ij,kl->ijkl', delta, delta) \\\n            + mu * (np.einsum('ik,jl->ijkl', delta, delta) + np.einsum('il,jk->ijkl', delta, delta))\n\n        # Using einsum to calculate K_mat from the derived formula:\n        # K_mat(ai,bk) = V0 * g_aj * F_il * C_ljrs * 0.5 * (F_ks*g_br + F_kr*g_bs)\n        # We split this into two terms for implementation.\n        term1 = np.einsum('aj,il,ljrs,ks,br->ikab', g, F, C, F, g, optimize='optimal')\n        term2 = np.einsum('aj,il,ljrs,kr,bs->ikab', g, F, C, F, g, optimize='optimal')\n        \n        # K_mat_blocks has shape (i,k,a,b) = (3,3,4,4)\n        K_mat_blocks = 0.5 * V0 * (term1 + term2)\n        \n        # Reshape to 12x12 matrix for K_mat[3a+i, 3b+k]\n        K_mat = K_mat_blocks.transpose(2, 0, 3, 1).reshape(12, 12)\n        \n        norm_K_mat = np.linalg.norm(K_mat)\n\n        results.extend([norm_f_int, norm_K_mat, norm_K_geo])\n\n    # Final print statement\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}