{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of implementing any hyperelastic model is the correct derivation of the stress and the algorithmic consistent tangent moduli. This first practice guides you through this fundamental process for a compressible Neo-Hookean material. By deriving the Second Piola-Kirchhoff stress and the fourth-order tangent tensor from the strain-energy function, and then verifying your analytical results against a numerical finite-difference approximation, you will build the most critical skill for developing robust constitutive models .",
            "id": "3543698",
            "problem": "Consider a three-dimensional hyperelastic body characterized by a strain-energy density function $W$ that depends on the Right Cauchy-Green tensor (RCG), defined as $\\boldsymbol{C} = \\boldsymbol{F}^{\\mathsf{T}} \\boldsymbol{F}$, where $\\boldsymbol{F}$ is the deformation gradient. Let the Green-Lagrange strain be $\\boldsymbol{E} = \\tfrac{1}{2}(\\boldsymbol{C} - \\boldsymbol{I})$, and denote the Second Piola-Kirchhoff stress (SPK) as $\\boldsymbol{S} = \\dfrac{\\partial W}{\\partial \\boldsymbol{E}}$. The algorithmic consistent moduli $\\boldsymbol{c}$ are defined as the fourth-order tensor $\\boldsymbol{c} = \\dfrac{\\partial^2 W}{\\partial \\boldsymbol{E} \\, \\partial \\boldsymbol{E}} = \\dfrac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}$. \n\nWork with the compressible Neo-Hookean model in three dimensions, with Lamé parameters $\\lambda$ and $\\mu$ (both in Pascals). The strain-energy density is given by\n$$\nW(\\boldsymbol{C}) = \\frac{\\mu}{2} (I_1 - 3) - \\mu \\ln J + \\frac{\\lambda}{2} (\\ln J)^2,\n$$\nwhere $I_1 = \\operatorname{tr}(\\boldsymbol{C})$, $J = \\det(\\boldsymbol{F})$, and $\\ln J$ is the natural logarithm of $J$. Note that $\\det(\\boldsymbol{C}) = J^2$, so $\\ln J = \\tfrac{1}{2} \\ln(\\det(\\boldsymbol{C}))$.\n\nYour tasks are:\n1. Starting from $W(\\boldsymbol{C})$, derive the Second Piola-Kirchhoff stress $\\boldsymbol{S}$ and the algorithmic consistent moduli $\\boldsymbol{c} = \\dfrac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}$ expressed as functions of $\\boldsymbol{C}$, $\\lambda$, and $\\mu$. Do not assume any shortcut formulas; base your derivation on fundamental differentiation rules, the chain rule, and the identity $\\mathrm{d}\\,\\boldsymbol{C}^{-1} = -\\boldsymbol{C}^{-1} (\\mathrm{d}\\,\\boldsymbol{C}) \\boldsymbol{C}^{-1}$.\n2. Implement a program that, for given $\\boldsymbol{F}$, $\\lambda$, and $\\mu$, computes:\n   - the analytic $\\boldsymbol{S}$ and $\\boldsymbol{c}$ derived in Task 1,\n   - finite-difference approximations to $\\dfrac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}$ by applying small symmetric perturbations $\\delta \\boldsymbol{E}$ to $\\boldsymbol{E}$ and using a central difference scheme.\n3. Quantify the relative error between the analytic derivative and its finite-difference approximation for each independent symmetric perturbation direction of $\\boldsymbol{E}$, and return the worst-case (maximum) relative error across these directions. Use the Frobenius norm for comparison:\n$$\ne = \\max_{n \\in \\{1,\\dots,6\\}} \\frac{\\left\\| \\left.\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}\\right|_{\\text{FD},n} - \\left.\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}\\right|_{\\text{analytic},n} \\right\\|_F}{\\max\\left(\\left\\| \\left.\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}\\right|_{\\text{analytic},n} \\right\\|_F, \\, \\varepsilon\\right)},\n$$\nwhere each $n$ corresponds to a symmetric basis direction of $\\boldsymbol{E}$ among $\\{(1,1),(2,2),(3,3),(1,2),(2,3),(1,3)\\}$, and $\\varepsilon$ is a small regularization constant to avoid division by zero (choose $\\varepsilon = 10^{-12}$). The central difference step size for the strain perturbation must be $h = 10^{-6}$ (dimensionless), and the perturbation must be applied to $\\boldsymbol{C}$ via $\\delta \\boldsymbol{C} = 2 \\, \\delta \\boldsymbol{E}$.\n\nPhysical units: use $\\lambda$ and $\\mu$ in Pascals (Pa). The deformation gradient $\\boldsymbol{F}$ is dimensionless. The relative error $e$ is dimensionless. Angles are not used in this problem.\n\nTest Suite:\n- Case 1 (general moderate deformation): \n  - $\\lambda = 1.20 \\times 10^{5}\\,\\text{Pa}$, $\\mu = 8.00 \\times 10^{4}\\,\\text{Pa}$,\n  - $\\boldsymbol{F} = \\begin{bmatrix} 1.1 & 0.2 & 0.0 \\\\ 0.0 & 0.9 & 0.1 \\\\ 0.0 & 0.0 & 1.05 \\end{bmatrix}$.\n- Case 2 (near-incompressible response with small volumetric change):\n  - $\\lambda = 1.00 \\times 10^{6}\\,\\text{Pa}$, $\\mu = 1.00 \\times 10^{4}\\,\\text{Pa}$,\n  - $\\boldsymbol{F} = \\begin{bmatrix} 1.02 & 0.0 & 0.0 \\\\ 0.0 & 0.98 & 0.0 \\\\ 0.0 & 0.0 & 1.00 \\end{bmatrix}$.\n- Case 3 (significant compression along one axis with shear):\n  - $\\lambda = 5.00 \\times 10^{4}\\,\\text{Pa}$, $\\mu = 2.00 \\times 10^{5}\\,\\text{Pa}$,\n  - $\\boldsymbol{F} = \\begin{bmatrix} 1.0 & 0.3 & 0.0 \\\\ 0.0 & 1.0 & 0.0 \\\\ 0.0 & 0.0 & 0.8 \\end{bmatrix}$.\n\nYour program should produce a single line of output containing, for the above three cases, the worst-case relative error $e$ as a comma-separated list enclosed in square brackets (for example, $[e_1,e_2,e_3]$). Each $e_i$ must be a floating-point number. No additional text should be printed.",
            "solution": "The problem is valid as it is well-posed, scientifically grounded in the principles of continuum mechanics, and provides a complete and consistent set of definitions and data for a standard verification procedure in computational hyperelasticity.\n\n### Task 1: Derivation of Stress and Moduli\n\nThe primary task is to derive the Second Piola-Kirchhoff (SPK) stress tensor $\\boldsymbol{S}$ and the fourth-order tensor of algorithmic consistent moduli $\\boldsymbol{c}$ for a compressible Neo-Hookean material. The derivation will proceed from the given strain-energy density function $W$.\n\nThe strain-energy density function is given by:\n$$\nW(\\boldsymbol{C}) = \\frac{\\mu}{2} (I_1 - 3) - \\mu \\ln J + \\frac{\\lambda}{2} (\\ln J)^2\n$$\nwhere $I_1 = \\operatorname{tr}(\\boldsymbol{C})$, $J = \\det(\\boldsymbol{F}) = \\sqrt{\\det(\\boldsymbol{C})}$, and $\\boldsymbol{C} = \\boldsymbol{F}^{\\mathsf{T}}\\boldsymbol{F}$ is the Right Cauchy-Green tensor. The Lamé parameters $\\lambda$ and $\\mu$ are material constants.\n\nThe Green-Lagrange strain tensor $\\boldsymbol{E}$ is defined as $\\boldsymbol{E} = \\frac{1}{2}(\\boldsymbol{C} - \\boldsymbol{I})$, where $\\boldsymbol{I}$ is the second-order identity tensor. This gives the relationship $\\boldsymbol{C} = 2\\boldsymbol{E} + \\boldsymbol{I}$. The differentials are related by $\\mathrm{d}\\boldsymbol{C} = 2 \\, \\mathrm{d}\\boldsymbol{E}$.\n\nThe SPK stress $\\boldsymbol{S}$ and the moduli $\\boldsymbol{c}$ are defined by derivatives with respect to $\\boldsymbol{E}$:\n$$\n\\boldsymbol{S} = \\frac{\\partial W}{\\partial \\boldsymbol{E}}, \\quad \\boldsymbol{c} = \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}} = \\frac{\\partial^2 W}{\\partial \\boldsymbol{E} \\partial \\boldsymbol{E}}\n$$\nUsing the chain rule, we can express these derivatives in terms of $\\boldsymbol{C}$:\n$$\n\\boldsymbol{S} = \\frac{\\partial W}{\\partial \\boldsymbol{E}} = \\frac{\\partial W}{\\partial \\boldsymbol{C}} : \\frac{\\partial \\boldsymbol{C}}{\\partial \\boldsymbol{E}} = 2 \\frac{\\partial W}{\\partial \\boldsymbol{C}}\n$$\n$$\n\\boldsymbol{c} = \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}} = \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}} : \\frac{\\partial \\boldsymbol{C}}{\\partial \\boldsymbol{E}} = 2 \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}}\n$$\nThe factor of $2$ arises from the definition of $\\boldsymbol{E}$.\n\n#### Derivation of the Second Piola-Kirchhoff Stress $\\boldsymbol{S}$\n\nFirst, we compute the derivative of $W$ with respect to $\\boldsymbol{C}$. This requires the derivatives of its constituent parts, $I_1$ and $\\ln J$.\n\n1.  **Derivative of $I_1 = \\operatorname{tr}(\\boldsymbol{C})$:**\n    The trace is a linear operator, $I_1 = \\boldsymbol{I}:\\boldsymbol{C}$. Its derivative is:\n    $$\n    \\frac{\\partial I_1}{\\partial \\boldsymbol{C}} = \\boldsymbol{I}\n    $$\n\n2.  **Derivative of $\\ln J$:**\n    We are given $\\ln J = \\frac{1}{2}\\ln(\\det(\\boldsymbol{C}))$. Using the chain rule and Jacobi's formula for the derivative of a determinant, $\\frac{\\partial(\\det \\boldsymbol{A})}{\\partial \\boldsymbol{A}} = (\\det \\boldsymbol{A}) \\boldsymbol{A}^{-\\mathsf{T}}$, we have (since $\\boldsymbol{C}$ is symmetric):\n    $$\n    \\frac{\\partial (\\ln J)}{\\partial \\boldsymbol{C}} = \\frac{\\partial}{\\partial \\boldsymbol{C}}\\left(\\frac{1}{2}\\ln(\\det(\\boldsymbol{C}))\\right) = \\frac{1}{2} \\frac{1}{\\det(\\boldsymbol{C})} \\frac{\\partial(\\det \\boldsymbol{C})}{\\partial \\boldsymbol{C}} = \\frac{1}{2 J^2} (J^2 \\boldsymbol{C}^{-1}) = \\frac{1}{2}\\boldsymbol{C}^{-1}\n    $$\n    \nNow we can differentiate $W$:\n$$\n\\frac{\\partial W}{\\partial \\boldsymbol{C}} = \\frac{\\partial}{\\partial \\boldsymbol{C}}\\left[ \\frac{\\mu}{2} (I_1 - 3) - \\mu \\ln J + \\frac{\\lambda}{2} (\\ln J)^2 \\right]\n$$\n$$\n\\frac{\\partial W}{\\partial \\boldsymbol{C}} = \\frac{\\mu}{2} \\frac{\\partial I_1}{\\partial \\boldsymbol{C}} - \\mu \\frac{\\partial (\\ln J)}{\\partial \\boldsymbol{C}} + \\lambda (\\ln J) \\frac{\\partial (\\ln J)}{\\partial \\boldsymbol{C}}\n$$\nSubstituting the derivatives found above:\n$$\n\\frac{\\partial W}{\\partial \\boldsymbol{C}} = \\frac{\\mu}{2} \\boldsymbol{I} - \\mu \\left(\\frac{1}{2}\\boldsymbol{C}^{-1}\\right) + \\lambda (\\ln J) \\left(\\frac{1}{2}\\boldsymbol{C}^{-1}\\right) = \\frac{\\mu}{2} \\boldsymbol{I} + \\frac{1}{2}(\\lambda \\ln J - \\mu) \\boldsymbol{C}^{-1}\n$$\nThe SPK stress $\\boldsymbol{S}$ is $2 \\frac{\\partial W}{\\partial \\boldsymbol{C}}$:\n$$\n\\boldsymbol{S} = 2 \\left[ \\frac{\\mu}{2} \\boldsymbol{I} + \\frac{1}{2}(\\lambda \\ln J - \\mu) \\boldsymbol{C}^{-1} \\right] = \\mu \\boldsymbol{I} + (\\lambda \\ln J - \\mu) \\boldsymbol{C}^{-1}\n$$\nThis is the analytical expression for the Second Piola-Kirchhoff stress.\n\n#### Derivation of the Algorithmic Consistent Moduli $\\boldsymbol{c}$\n\nThe algorithmic moduli tensor is $\\boldsymbol{c} = 2 \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}}$. We must differentiate the expression for $\\boldsymbol{S}$ with respect to $\\boldsymbol{C}$.\n$$\n\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}} = \\frac{\\partial}{\\partial \\boldsymbol{C}} \\left[ \\mu \\boldsymbol{I} + (\\lambda \\ln J - \\mu) \\boldsymbol{C}^{-1} \\right]\n$$\nThe first term $\\mu\\boldsymbol{I}$ is constant with respect to $\\boldsymbol{C}$, so its derivative is zero. For the second term, we apply the product rule for tensors: $(\\phi \\boldsymbol{A})' = \\phi' \\otimes \\boldsymbol{A} + \\phi \\boldsymbol{A}'$.\nLet $\\phi = \\lambda \\ln J - \\mu$ and $\\boldsymbol{A} = \\boldsymbol{C}^{-1}$.\n$$\n\\frac{\\partial}{\\partial \\boldsymbol{C}} \\left[ (\\lambda \\ln J - \\mu) \\boldsymbol{C}^{-1} \\right] = \\left(\\frac{\\partial (\\lambda \\ln J - \\mu)}{\\partial \\boldsymbol{C}}\\right) \\otimes \\boldsymbol{C}^{-1} + (\\lambda \\ln J - \\mu) \\frac{\\partial \\boldsymbol{C}^{-1}}{\\partial \\boldsymbol{C}}\n$$\nWe evaluate each part:\n\n1.  **First term:** The derivative of the scalar part is:\n    $$\n    \\frac{\\partial (\\lambda \\ln J - \\mu)}{\\partial \\boldsymbol{C}} = \\lambda \\frac{\\partial (\\ln J)}{\\partial \\boldsymbol{C}} = \\frac{\\lambda}{2} \\boldsymbol{C}^{-1}\n    $$\n    The first term of the product rule is therefore $\\frac{\\lambda}{2} \\boldsymbol{C}^{-1} \\otimes \\boldsymbol{C}^{-1}$. In index notation, this is a fourth-order tensor with components $\\frac{\\lambda}{2} C^{-1}_{ij} C^{-1}_{kl}$.\n\n2.  **Second term:** We need the derivative of the inverse tensor, $\\frac{\\partial \\boldsymbol{C}^{-1}}{\\partial \\boldsymbol{C}}$. Using the identity $\\mathrm{d}(\\boldsymbol{C}^{-1}) = -\\boldsymbol{C}^{-1}(\\mathrm{d}\\boldsymbol{C})\\boldsymbol{C}^{-1}$ and ensuring the resulting operator maps symmetric tensors to symmetric tensors, the derivative is the fourth-order tensor $\\boldsymbol{\\mathcal{K}}$ with components:\n    $$\n    \\mathcal{K}_{ijkl} = \\frac{\\partial C^{-1}_{ij}}{\\partial C_{kl}} = -\\frac{1}{2} \\left( C^{-1}_{ik} C^{-1}_{jl} + C^{-1}_{il} C^{-1}_{jk} \\right)\n    $$\n    The second term of the product rule is thus $(\\lambda \\ln J - \\mu) \\boldsymbol{\\mathcal{K}}$.\n\nCombining both terms, we get $\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}}$:\n$$\n\\left(\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}}\\right)_{ijkl} = \\frac{\\lambda}{2} C^{-1}_{ij} C^{-1}_{kl} - \\frac{\\lambda \\ln J - \\mu}{2} \\left( C^{-1}_{ik} C^{-1}_{jl} + C^{-1}_{il} C^{-1}_{jk} \\right)\n$$\nFinally, the moduli tensor $\\boldsymbol{c} = 2 \\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{C}}$ is obtained by multiplying by $2$:\n$$\nc_{ijkl} = \\lambda C^{-1}_{ij} C^{-1}_{kl} - (\\lambda \\ln J - \\mu) \\left( C^{-1}_{ik} C^{-1}_{jl} + C^{-1}_{il} C^{-1}_{jk} \\right)\n$$\nRearranging for a more conventional form:\n$$\nc_{ijkl} = \\lambda \\, C^{-1}_{ij} C^{-1}_{kl} + (\\mu - \\lambda \\ln J) \\left( C^{-1}_{ik} C^{-1}_{jl} + C^{-1}_{il} C^{-1}_{jk} \\right)\n$$\nThis is the analytical expression for the algorithmic consistent moduli, which possesses the required major and minor symmetries. These expressions for $\\boldsymbol{S}$ and $\\boldsymbol{c}$ will be implemented and verified numerically.\n\n### Task 2 & 3: Implementation and Error Quantification\n\nThe implementation involves computing $\\boldsymbol{S}$ and $\\boldsymbol{c}$ analytically using the derived formulas. Then, for verification, we approximate the action of the derivative $\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}$ on a set of basis vectors. For a basis direction $\\boldsymbol{\\Delta}_n$ in the space of symmetric second-order tensors, the finite difference approximation of the directional derivative is calculated using a central difference scheme with step size $h$:\n$$\n\\left.\\frac{\\partial \\boldsymbol{S}}{\\partial \\boldsymbol{E}}\\right|_{\\text{FD},n} = \\frac{\\boldsymbol{S}(\\boldsymbol{E} + h \\boldsymbol{\\Delta}_n) - \\boldsymbol{S}(\\boldsymbol{E} - h \\boldsymbol{\\Delta}_n)}{2h}\n$$\nSince $\\boldsymbol{S}$ is a function of $\\boldsymbol{C} = 2\\boldsymbol{E} + \\boldsymbol{I}$, a perturbation $\\delta\\boldsymbol{E} = h\\boldsymbol{\\Delta}_n$ corresponds to a perturbation $\\delta\\boldsymbol{C} = 2h\\boldsymbol{\\Delta}_n$. The finite difference calculation becomes:\n$$\n\\frac{\\boldsymbol{S}(\\boldsymbol{C} + 2h\\boldsymbol{\\Delta}_n) - \\boldsymbol{S}(\\boldsymbol{C} - 2h\\boldsymbol{\\Delta}_n)}{2h}\n$$\nThis numerical result is compared against the analytical one, which is the tensor contraction $\\boldsymbol{c}:\\boldsymbol{\\Delta}_n$, with components $(c_{ijkl})(\\Delta_n)_{kl}$. The maximum relative error over the $6$ basis directions of symmetric $3 \\times 3$ tensors is then reported for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_S(C, lam, mu):\n    \"\"\"\n    Computes the Second Piola-Kirchhoff stress tensor S.\n    \n    Args:\n        C (np.ndarray): 3x3 Right Cauchy-Green tensor.\n        lam (float): First Lamé parameter.\n        mu (float): Second Lamé parameter (shear modulus).\n    \n    Returns:\n        np.ndarray: 3x3 Second Piola-Kirchhoff stress tensor.\n    \"\"\"\n    det_C = np.linalg.det(C)\n    if det_C <= 0:\n        raise ValueError(\"Determinant of C must be positive.\")\n    \n    J = np.sqrt(det_C)\n    ln_J = np.log(J)\n    C_inv = np.linalg.inv(C)\n    I = np.identity(3)\n    \n    S = mu * I + (lam * ln_J - mu) * C_inv\n    return S\n\ndef calculate_analytical_c(C, lam, mu):\n    \"\"\"\n    Computes the analytical algorithmic consistent tangent moduli c.\n    \n    Args:\n        C (np.ndarray): 3x3 Right Cauchy-Green tensor.\n        lam (float): First Lamé parameter.\n        mu (float): Second Lamé parameter (shear modulus).\n\n    Returns:\n        np.ndarray: 3x3x3x3 fourth-order tangent moduli tensor.\n    \"\"\"\n    det_C = np.linalg.det(C)\n    if det_C <= 0:\n        raise ValueError(\"Determinant of C must be positive.\")\n        \n    J = np.sqrt(det_C)\n    ln_J = np.log(J)\n    C_inv = np.linalg.inv(C)\n\n    # c_ijkl = lambda_ * C_inv_ij * C_inv_kl + (mu - lambda_ * ln(J)) * (C_inv_ik*C_inv_jl + C_inv_il*C_inv_jk)\n    \n    # Term 1: lambda * (C_inv (x) C_inv)\n    term1 = lam * np.einsum('ij,kl->ijkl', C_inv, C_inv)\n    \n    # Term 2: (mu - lambda * ln(J)) * (I_symm(C_inv))\n    term2_factor = mu - lam * ln_J\n    term2_tensor = np.einsum('ik,jl->ijkl', C_inv, C_inv) + np.einsum('il,jk->ijkl', C_inv, C_inv)\n    \n    c_analytic = term1 + term2_factor * term2_tensor\n    return c_analytic\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute errors.\n    \"\"\"\n    test_cases = [\n        (1.20e5, 8.00e4, np.array([[1.1, 0.2, 0.0], [0.0, 0.9, 0.1], [0.0, 0.0, 1.05]])),\n        (1.00e6, 1.00e4, np.array([[1.02, 0.0, 0.0], [0.0, 0.98, 0.0], [0.0, 0.0, 1.00]])),\n        (5.00e4, 2.00e5, np.array([[1.0, 0.3, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 0.8]]))\n    ]\n\n    h = 1e-6\n    epsilon = 1e-12\n    max_errors = []\n\n    # Define the 6 independent symmetric perturbation basis directions for E.\n    perturbation_directions = []\n    # Diagonal directions (1,1), (2,2), (3,3)\n    for i in range(3):\n        delta = np.zeros((3, 3))\n        delta[i, i] = 1.0\n        perturbation_directions.append(delta)\n    # Off-diagonal directions (1,2), (2,3), (1,3)\n    for i, j in [(0, 1), (1, 2), (0, 2)]:\n        delta = np.zeros((3, 3))\n        delta[i, j] = 1.0\n        delta[j, i] = 1.0\n        perturbation_directions.append(delta)\n\n    for lam, mu, F in test_cases:\n        # Base calculation at the given deformation state\n        C = F.T @ F\n        \n        # 1. Compute analytical tangent moduli tensor c\n        c_analytic = calculate_analytical_c(C, lam, mu)\n        \n        errors_for_case = []\n        \n        # 2. Loop through perturbation directions to perform finite difference check\n        for delta_E_dir in perturbation_directions:\n            # Perturbation in C is 2 * delta_E\n            # The step size for delta_E is h\n            delta_C = 2 * h * delta_E_dir\n            \n            # Calculate S at perturbed states using central difference\n            C_plus = C + delta_C\n            C_minus = C - delta_C\n            \n            S_plus = calculate_S(C_plus, lam, mu)\n            S_minus = calculate_S(C_minus, lam, mu)\n            \n            # Finite difference approximation of (c : delta_E_dir)\n            # This is the directional derivative of S wrt E in direction delta_E_dir\n            c_colon_delta_fd = (S_plus - S_minus) / (2 * h)\n            \n            # Analytical result for comparison: contract c with the direction\n            c_colon_delta_analytic = np.einsum('ijkl, kl -> ij', c_analytic, delta_E_dir)\n\n            # 3. Quantify relative error for this direction\n            numerator = np.linalg.norm(c_colon_delta_fd - c_colon_delta_analytic, 'fro')\n            denominator = np.linalg.norm(c_colon_delta_analytic, 'fro')\n            \n            # Apply regularization to avoid division by zero\n            denominator = max(denominator, epsilon)\n            \n            relative_error = numerator / denominator\n            errors_for_case.append(relative_error)\n        \n        # Worst-case error for this test case\n        max_error = max(errors_for_case)\n        max_errors.append(max_error)\n        \n    print(f\"[{','.join(map(str, max_errors))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "For isotropic hyperelastic materials, formulating the constitutive equations in the principal basis of strain (a spectral decomposition) offers significant computational advantages. However, this approach introduces a numerical challenge when principal stretches become equal, leading to singularities in the standard expression for the tangent moduli. This exercise focuses on deriving the spectral tangent coefficients and analytically resolving the singularity for a state of repeated eigenvalues, a crucial technique for creating robust and efficient material models .",
            "id": "3543741",
            "problem": "Consider an isotropic, compressible neo-Hookean hyperelastic solid with strain-energy density per unit reference volume\n$$\nW(\\mathbf{C})=\\frac{\\mu}{2}\\left(I_{1}-3\\right)-\\mu \\ln J+\\frac{\\kappa}{2}\\left(\\ln J\\right)^{2},\n$$\nwhere $\\mathbf{C}=\\mathbf{F}^{\\mathsf{T}}\\mathbf{F}$ is the right Cauchy-Green tensor, $\\mathbf{F}$ is the deformation gradient, $I_{1}=\\operatorname{tr}\\mathbf{C}$, $J=\\det\\mathbf{F}$, $\\mu>0$ is the shear modulus, and $\\kappa>0$ is the bulk modulus. Let $\\lambda_{i}$ be the principal stretches, and define the principal logarithmic strains $\\varepsilon_{i}=\\ln\\lambda_{i}$. The Kirchhoff stress is $\\boldsymbol{\\tau}=J\\,\\boldsymbol{\\sigma}$, with principal values $\\tau_{i}$ aligned with the principal stretches.\n\nIn a Newton method for finite elements using a spectral formulation with principal logarithmic strains, the algorithmic consistent tangent in the principal basis is the linear map $d\\varepsilon_{j}\\mapsto d\\tau_{i}$ characterized by coefficients $A_{ij}$ such that $d\\tau_{i}=\\sum_{j}A_{ij}\\,d\\varepsilon_{j}$, accounting for both eigenvalue and eigenvector variations.\n\nFor a nearly equal-biaxial state $\\lambda_{1}\\approx\\lambda_{2}\\neq\\lambda_{3}$, derive the spectral consistent tangent coefficients $A_{ij}$ in terms of $\\mu$, $\\kappa$, and $\\lambda_{i}$ starting from fundamental definitions of hyperelastic response and spectral calculus of tensor functions. Then, by taking the appropriate limit to remove any potential numerical singularity due to the near-multiplicity $\\lambda_{1}\\to\\lambda_{2}$, compute the closed-form expression of the limiting off-diagonal coefficient\n$$\nA_{12}^{\\mathrm{lim}}=\\lim_{\\lambda_{2}\\to\\lambda_{1}}A_{12}\n$$\nin terms of $\\mu$ and the common value $\\lambda$ of the repeated stretch. Briefly explain why this limiting procedure removes the numerical singularity.\n\nProvide as your final answer the simplified symbolic expression for $A_{12}^{\\mathrm{lim}}$. You do not need to report units; provide only the expression.",
            "solution": "The problem requires the derivation of the consistent tangent coefficients for an isotropic, compressible neo-Hookean solid, and specifically, the computation of a limiting off-diagonal coefficient in a state of repeated principal stretches. The process involves several steps, beginning with the fundamental constitutive relations and culminating in a limit analysis to handle the singularity associated with repeated eigenvalues.\n\nFirst, we express the strain-energy density function $W$ in terms of the principal stretches $\\lambda_i$. The invariants $I_1$ and $J$ are given by:\n$$\nI_1 = \\operatorname{tr}(\\mathbf{C}) = \\lambda_1^2 + \\lambda_2^2 + \\lambda_3^2\n$$\n$$\nJ = \\det(\\mathbf{F}) = \\lambda_1 \\lambda_2 \\lambda_3\n$$\nSubstituting these into the given expression for $W$ yields:\n$$\nW(\\lambda_1, \\lambda_2, \\lambda_3) = \\frac{\\mu}{2}\\left(\\lambda_1^2 + \\lambda_2^2 + \\lambda_3^2 - 3\\right) - \\mu \\ln(\\lambda_1 \\lambda_2 \\lambda_3) + \\frac{\\kappa}{2}\\left(\\ln(\\lambda_1 \\lambda_2 \\lambda_3)\\right)^2\n$$\n\nFor an isotropic hyperelastic material, the principal values of the Kirchhoff stress tensor $\\boldsymbol{\\tau}$ are coaxial with the principal stretches and are given by the relation $\\tau_i = \\lambda_i \\frac{\\partial W}{\\partial \\lambda_i}$. We compute the partial derivative of $W$ with respect to $\\lambda_i$:\n$$\n\\frac{\\partial W}{\\partial \\lambda_i} = \\frac{\\mu}{2}(2\\lambda_i) - \\mu \\frac{1}{J} \\frac{\\partial J}{\\partial \\lambda_i} + \\frac{\\kappa}{2} (2 \\ln J) \\frac{1}{J} \\frac{\\partial J}{\\partial \\lambda_i}\n$$\nUsing $\\frac{\\partial J}{\\partial \\lambda_i} = \\frac{J}{\\lambda_i}$, we get:\n$$\n\\frac{\\partial W}{\\partial \\lambda_i} = \\mu\\lambda_i - \\mu\\frac{1}{\\lambda_i} + \\kappa \\frac{\\ln J}{\\lambda_i}\n$$\nTherefore, the principal Kirchhoff stresses are:\n$$\n\\tau_i = \\lambda_i \\left( \\mu\\lambda_i - \\frac{\\mu}{\\lambda_i} + \\kappa \\frac{\\ln J}{\\lambda_i} \\right) = \\mu(\\lambda_i^2 - 1) + \\kappa \\ln J.\n$$\n\nThe problem defines the algorithmic consistent tangent coefficients $A_{ij}$ as the components of the linear map from increments of principal logarithmic strains $d\\varepsilon_j = d(\\ln\\lambda_j)$ to increments of principal Kirchhoff stresses $d\\tau_i$. The formulation must account for variations of both eigenvalues and eigenvectors of the strain/stress tensors. In the context of spectral decomposition and consistent linearization for finite element analysis, for the case of distinct principal stretches ($\\lambda_i \\neq \\lambda_j$), the off-diagonal coefficients of this tangent matrix are given by:\n$$\nA_{ij} = \\frac{\\tau_i - \\tau_j}{\\varepsilon_i - \\varepsilon_j} \\quad \\text{for } i \\neq j\n$$\nThis expression becomes singular when $\\lambda_i \\to \\lambda_j$ (and thus $\\varepsilon_i \\to \\varepsilon_j$), as it approaches the indeterminate form $0/0$. The problem asks for the resolution of this singularity through a limiting procedure.\n\nLet us focus on the coefficient $A_{12}$ for a nearly equal-biaxial state where $\\lambda_1 \\approx \\lambda_2$. For $\\lambda_1 \\neq \\lambda_2$, the coefficient is:\n$$\nA_{12} = \\frac{\\tau_1 - \\tau_2}{\\varepsilon_1 - \\varepsilon_2}\n$$\nWe compute the numerator, $\\tau_1 - \\tau_2$:\n$$\n\\tau_1 - \\tau_2 = \\left[ \\mu(\\lambda_1^2 - 1) + \\kappa \\ln J \\right] - \\left[ \\mu(\\lambda_2^2 - 1) + \\kappa \\ln J \\right] = \\mu(\\lambda_1^2 - \\lambda_2^2)\n$$\nThe denominator is $\\varepsilon_1 - \\varepsilon_2 = \\ln\\lambda_1 - \\ln\\lambda_2 = \\ln(\\lambda_1/\\lambda_2)$. Thus, the coefficient is:\n$$\nA_{12} = \\frac{\\mu(\\lambda_1^2 - \\lambda_2^2)}{\\ln\\lambda_1 - \\ln\\lambda_2}\n$$\n\nTo find the coefficient for the case of repeated eigenvalues $\\lambda_1 = \\lambda_2$, we compute the limit $A_{12}^{\\mathrm{lim}}=\\lim_{\\lambda_{2}\\to\\lambda_{1}}A_{12}$.\n$$\nA_{12}^{\\mathrm{lim}} = \\lim_{\\lambda_2 \\to \\lambda_1} \\frac{\\mu(\\lambda_1^2 - \\lambda_2^2)}{\\ln\\lambda_1 - \\ln\\lambda_2}\n$$\nThis is an indeterminate form of the type $0/0$. We apply L'Hôpital's rule, treating $\\lambda_1$ as a constant and differentiating the numerator and the denominator with respect to the variable $\\lambda_2$:\n-   Let $f(\\lambda_2) = \\mu(\\lambda_1^2 - \\lambda_2^2)$. The derivative is $f'(\\lambda_2) = -2\\mu\\lambda_2$.\n-   Let $g(\\lambda_2) = \\ln\\lambda_1 - \\ln\\lambda_2$. The derivative is $g'(\\lambda_2) = -\\frac{1}{\\lambda_2}$.\n\nThe limit is then the ratio of these derivatives evaluated at $\\lambda_2 = \\lambda_1$:\n$$\nA_{12}^{\\mathrm{lim}} = \\lim_{\\lambda_2 \\to \\lambda_1} \\frac{f'(\\lambda_2)}{g'(\\lambda_2)} = \\lim_{\\lambda_2 \\to \\lambda_1} \\frac{-2\\mu\\lambda_2}{-1/\\lambda_2} = \\lim_{\\lambda_2 \\to \\lambda_1} 2\\mu\\lambda_2^2\n$$\nEvaluating the limit, we let $\\lambda$ be the common value $\\lambda = \\lambda_1 = \\lambda_2$:\n$$\nA_{12}^{\\mathrm{lim}} = 2\\mu\\lambda^2\n$$\n\nThis limiting procedure is necessary because the formula for $A_{12}$ is ill-defined when principal stretches are equal. Physically, when two principal stretches are equal, the corresponding principal directions (eigenvectors) are not unique but span a plane. A small perturbation in strain can cause a large, arbitrary rotation of the numerically computed eigenvectors within this plane. The expression for the tangent coefficients for distinct eigenvalues depends on the well-defined principal directions. Its singularity reflects this physical indeterminacy. By taking the analytical limit, we obtain a well-defined, stable value for the tangent coefficient that correctly describes the material's response to perturbations from a state with repeated eigenvalues, thus removing the numerical singularity that would otherwise occur in a computational implementation.",
            "answer": "$$\\boxed{2\\mu\\lambda^2}$$"
        },
        {
            "introduction": "An algorithmic tangent does not exist in a vacuum; it is a critical component of a nonlinear finite element solver. This advanced practice explores the interplay between the constitutive model and the element formulation, specifically how hourglass control stabilization in under-integrated elements can lead to a non-symmetric tangent. You will analyze this loss of minor symmetry, develop a symmetrization operator, and investigate the conditions under which the quadratic convergence of the Newton method can be preserved, providing deep insight into the practical aspects of high-performance simulation .",
            "id": "3543675",
            "problem": "You are asked to analyze and correct the minor symmetry loss of an algorithmic tangent moduli tensor introduced by stabilization typical of selective reduced integration with hourglass control in hyperelastic finite deformation. Your goal is to derive a consistent baseline, quantify symmetry loss due to a non-conservative stabilization, and design a symmetrization operator that restores minor symmetries while preserving the quadratic convergence of the Newton method under appropriate conditions. Work in three dimensions with tensors expressed in rectangular Cartesian components.\n\nLet the strain-energy density of a compressible Saint Venant–Kirchhoff hyperelastic solid be defined on the Green–Lagrange strain as\n$$\nW(\\mathbf{E}) = \\frac{\\lambda}{2} \\left(\\mathrm{tr}\\,\\mathbf{E}\\right)^2 + \\mu\\, \\mathrm{tr}\\left(\\mathbf{E}^2\\right),\n$$\nwhere $\\lambda$ and $\\mu$ are the Lamé parameters, $\\mathbf{E} = \\frac{1}{2}\\left(\\mathbf{C} - \\mathbf{I}\\right)$, and $\\mathbf{C} = \\mathbf{F}^\\mathsf{T}\\mathbf{F}$ is the right Cauchy–Green tensor. Let $\\mathbf{F}$ be the deformation gradient, $J = \\det\\mathbf{F}$, and $\\mathbf{I}$ the second-order identity tensor.\n\nTasks:\n\n1. Starting from the definition of $W(\\mathbf{E})$ and the second Piola–Kirchhoff stress $\\mathbf{S} = \\partial W/\\partial \\mathbf{E}$, derive the fourth-order material elasticity tensor in Lagrangian form,\n$$\n\\mathbb{C}_{IJKL} = \\frac{\\partial S_{IJ}}{\\partial E_{KL}},\n$$\nand express it explicitly in terms of $\\lambda$, $\\mu$, and the Kronecker deltas. Then, define a spatial algorithmic consistent tangent $\\mathbb{a}^{\\mathrm{cons}}$ obtained by a push-forward of $\\mathbb{C}$ to the current configuration using\n$$\n\\mathbb{a}^{\\mathrm{cons}}_{ijkl}(\\mathbf{F}) = \\frac{1}{J}\\,F_{iI} F_{jJ} F_{kK} F_{lL}\\,\\mathbb{C}_{IJKL}.\n$$\nShow that $\\mathbb{a}^{\\mathrm{cons}}$ possesses the minor symmetries $a^{\\mathrm{cons}}_{ijkl} = a^{\\mathrm{cons}}_{jikl} = a^{\\mathrm{cons}}_{ijlk}$.\n\n2. Model a non-conservative hourglass control contribution as a fourth-order tensor $\\mathbb{h}(\\mathbf{F})$ that adds to the consistent moduli, with components\n$$\n\\mathbb{h}_{ijkl}(\\mathbf{F}) = \\beta\\left(U_{ij}\\,V_{kl} - V_{ij}\\,U_{kl}\\right),\n$$\nwhere $\\beta$ is a scalar stabilization parameter, $\\mathbf{U} = \\mathbf{F} - \\mathbf{I}$, and $\\mathbf{V} = \\mathbf{F}^{-\\mathsf{T}} - \\mathbf{I}$. Define the stabilized (non-conservative) algorithmic moduli\n$$\n\\mathbb{a}(\\mathbf{F}) = \\mathbb{a}^{\\mathrm{cons}}(\\mathbf{F}) + \\mathbb{h}(\\mathbf{F}).\n$$\nProve that, for generic $\\mathbf{F}$ and $\\beta \\neq 0$, $\\mathbb{a}$ does not satisfy the minor symmetries.\n\n3. Define a quantitative measure of minor symmetry loss for any fourth-order tensor $\\mathbb{A}$ as\n$$\nm_{\\mathrm{rel}}(\\mathbb{A}) = \\frac{\\sqrt{\\left\\|\\mathbb{A} - \\mathbb{P}_{ij}(\\mathbb{A})\\right\\|_F^2 + \\left\\|\\mathbb{A} - \\mathbb{P}_{kl}(\\mathbb{A})\\right\\|_F^2}}{\\max\\left(\\left\\|\\mathbb{A}\\right\\|_F,\\varepsilon\\right)},\n$$\nwhere $\\left\\|\\cdot\\right\\|_F$ denotes the Frobenius norm, $\\varepsilon$ is a fixed small positive number to avoid division by zero, $\\mathbb{P}_{ij}$ denotes transposition of the first two indices, $\\left(\\mathbb{P}_{ij}(\\mathbb{A})\\right)_{ijkl} = \\mathbb{A}_{jikl}$, and $\\mathbb{P}_{kl}$ denotes transposition of the last two indices, $\\left(\\mathbb{P}_{kl}(\\mathbb{A})\\right)_{ijkl} = \\mathbb{A}_{ijlk}$.\n\n4. Propose a symmetrization operator $\\Pi_{\\mathrm{ms}}$ that is the orthogonal projector (in the Frobenius inner product) onto the subspace of fourth-order tensors possessing both minor symmetries. Prove that your operator is a projector (idempotent) and self-adjoint with respect to the Frobenius inner product, and thus yields the closest minor-symmetric tensor to $\\mathbb{A}$ in the least-squares sense. Apply it to $\\mathbb{a}$ to obtain $\\widetilde{\\mathbb{a}} = \\Pi_{\\mathrm{ms}}(\\mathbb{a})$.\n\n5. Explain, in the context of the Newton–Raphson method for solving the discrete nonlinear equilibrium equations, sufficient conditions under which replacing the exact Jacobian $\\mathbb{a}$ by the symmetrized $\\widetilde{\\mathbb{a}}$ preserves quadratic convergence of Newton’s method. Your explanation must be grounded in the theory of inexact Newton methods and should clearly state the condition on the antisymmetric part of $\\mathbb{a}$ relative to the residual near the solution.\n\n6. Implement a program that, for each test case below, computes the following, using the formulas you derived:\n   - The consistent push-forward tensor $\\mathbb{a}^{\\mathrm{cons}}(\\mathbf{F})$.\n   - The hourglass tensor $\\mathbb{h}(\\mathbf{F})$ and the stabilized tensor $\\mathbb{a}(\\mathbf{F}) = \\mathbb{a}^{\\mathrm{cons}} + \\mathbb{h}$.\n   - The symmetrized tensor $\\widetilde{\\mathbb{a}} = \\Pi_{\\mathrm{ms}}(\\mathbb{a})$.\n   - The relative minor symmetry loss $m_{\\mathrm{rel}}(\\mathbb{a})$ and $m_{\\mathrm{rel}}(\\widetilde{\\mathbb{a}})$.\n\nUse $\\varepsilon = 10^{-12}$. All quantities are to be treated as dimensionless. No physical units are required in the output.\n\nTest suite (each case is a tuple $\\left(\\mathbf{F}, \\lambda, \\mu, \\beta\\right)$ with $\\mathbf{F}$ given by its $3 \\times 3$ components):\n\n- Case 1 (general deformation, moderate stabilization): \n  $$\n  \\mathbf{F} = \\begin{bmatrix}\n  1.1 & 0.2 & 0.0\\\\\n  0.0 & 0.95 & 0.1\\\\\n  0.0 & 0.0 & 1.05\n  \\end{bmatrix},\\quad \\lambda = 120.0,\\quad \\mu = 40.0,\\quad \\beta = 0.6.\n  $$\n- Case 2 (off-diagonal perturbations, stronger stabilization):\n  $$\n  \\mathbf{F} = \\begin{bmatrix}\n  1.05 & 0.15 & -0.05\\\\\n  0.02 & 0.98 & 0.04\\\\\n  0.01 & -0.03 & 1.02\n  \\end{bmatrix},\\quad \\lambda = 50.0,\\quad \\mu = 30.0,\\quad \\beta = 1.2.\n  $$\n- Case 3 (diagonal stretch, no stabilization; boundary condition for zero loss):\n  $$\n  \\mathbf{F} = \\mathrm{diag}(1.2,\\,0.85,\\,1.1),\\quad \\lambda = 200.0,\\quad \\mu = 80.0,\\quad \\beta = 0.0.\n  $$\n- Case 4 (nearly incompressible, notable shear, moderate stabilization):\n  $$\n  \\mathbf{F} = \\begin{bmatrix}\n  1.0 & 0.3 & 0.0\\\\\n  0.0 & 1.0 & 0.2\\\\\n  0.0 & 0.0 & 1.0\n  \\end{bmatrix},\\quad \\lambda = 10000.0,\\quad \\mu = 10.0,\\quad \\beta = 0.8.\n  $$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[m_{\\mathrm{rel}}(\\mathbb{a})^{(1)},\\; m_{\\mathrm{rel}}(\\widetilde{\\mathbb{a}})^{(1)},\\; m_{\\mathrm{rel}}(\\mathbb{a})^{(2)},\\; m_{\\mathrm{rel}}(\\widetilde{\\mathbb{a}})^{(2)},\\; m_{\\mathrm{rel}}(\\mathbb{a})^{(3)},\\; m_{\\mathrm{rel}}(\\widetilde{\\mathbb{a}})^{(3)},\\; m_{\\mathrm{rel}}(\\mathbb{a})^{(4)},\\; m_{\\mathrm{rel}}(\\widetilde{\\mathbb{a}})^{(4)}\\right],\n$$\nwhere superscripts indicate the case number. Each entry must be a floating-point number. No other text should be printed.",
            "solution": "The problem posed is a comprehensive exercise in computational continuum mechanics, focusing on the treatment of algorithmic tangent moduli in hyperelasticity under non-conservative stabilization. The problem is scientifically grounded, well-posed, and all necessary information is provided. We shall proceed with a step-by-step derivation and analysis as requested.\n\n### 1. Derivation of Material and Spatial Tangent Moduli\n\nThe strain-energy density function for a Saint Venant–Kirchhoff material is given as:\n$$\nW(\\mathbf{E}) = \\frac{\\lambda}{2} \\left(\\mathrm{tr}\\,\\mathbf{E}\\right)^2 + \\mu\\, \\mathrm{tr}\\left(\\mathbf{E}^2\\right)\n$$\nIn rectangular Cartesian component notation, this is:\n$$\nW = \\frac{\\lambda}{2} E_{KK} E_{LL} + \\mu E_{KL} E_{LK}\n$$\nwhere summation over repeated indices is implied. Since the Green-Lagrange strain tensor $\\mathbf{E}$ is symmetric ($E_{KL} = E_{LK}$), we can write $\\mathrm{tr}(\\mathbf{E}^2) = E_{KL}E_{KL}$.\n\nThe second Piola-Kirchhoff stress tensor $\\mathbf{S}$ is the derivative of the strain energy density with respect to the Green-Lagrange strain tensor $\\mathbf{E}$:\n$$\nS_{IJ} = \\frac{\\partial W}{\\partial E_{IJ}}\n$$\nUsing the chain rule and properties of tensor derivatives ($\\partial E_{KL}/\\partial E_{IJ} = \\frac{1}{2}(\\delta_{IK}\\delta_{JL} + \\delta_{IL}\\delta_{JK})$ for symmetric $\\mathbf{E}$ represented by its components, or more simply, for independent components, $\\partial E_{KK}/\\partial E_{IJ} = \\delta_{IJ}$ and $\\partial E_{KL}/\\partial E_{IJ} = \\delta_{IK}\\delta_{JL}$ if we do not assume symmetry of $\\partial/\\partial \\mathbf{E}$ beforehand, followed by symmetrization), we find:\n$$\nS_{IJ} = \\frac{\\partial}{\\partial E_{IJ}} \\left( \\frac{\\lambda}{2} E_{KK} E_{LL} + \\mu E_{KL} E_{LK} \\right)\n$$\n$$\nS_{IJ} = \\frac{\\lambda}{2} \\left( \\delta_{IK}\\delta_{JK} E_{LL} + E_{KK} \\delta_{IL}\\delta_{JL} \\right) + \\mu \\left( \\delta_{IK}\\delta_{JL} E_{LK} + E_{KL} \\delta_{IL}\\delta_{JK} \\right)\n$$\n$$\nS_{IJ} = \\frac{\\lambda}{2} \\left( \\delta_{IJ} E_{LL} + E_{KK} \\delta_{IJ} \\right) + \\mu \\left( E_{JI} + E_{IJ} \\right)\n$$\n$$\nS_{IJ} = \\lambda \\left(\\mathrm{tr}\\,\\mathbf{E}\\right) \\delta_{IJ} + 2\\mu E_{IJ}\n$$\nIn tensor notation, this is $\\mathbf{S} = \\lambda (\\mathrm{tr}\\,\\mathbf{E}) \\mathbf{I} + 2\\mu \\mathbf{E}$.\n\nNext, we derive the fourth-order material elasticity tensor $\\mathbb{C}$ by differentiating $\\mathbf{S}$ with respect to $\\mathbf{E}$:\n$$\n\\mathbb{C}_{IJKL} = \\frac{\\partial S_{IJ}}{\\partial E_{KL}} = \\frac{\\partial}{\\partial E_{KL}} \\left( \\lambda E_{MM} \\delta_{IJ} + 2\\mu E_{IJ} \\right)\n$$\n$$\n\\mathbb{C}_{IJKL} = \\lambda \\delta_{IJ} \\frac{\\partial E_{MM}}{\\partial E_{KL}} + 2\\mu \\frac{\\partial E_{IJ}}{\\partial E_{KL}}\n$$\nRecognizing that $\\partial E_{MM}/\\partial E_{KL} = \\delta_{MK}\\delta_{ML} = \\delta_{KL}$ and $\\partial E_{IJ}/\\partial E_{KL} = \\frac{1}{2}(\\delta_{IK}\\delta_{JL} + \\delta_{IL}\\delta_{JK})$ because $\\mathbf{E}$ is symmetric, we obtain:\n$$\n\\mathbb{C}_{IJKL} = \\lambda \\delta_{IJ} \\delta_{KL} + 2\\mu \\left( \\frac{1}{2}(\\delta_{IK}\\delta_{JL} + \\delta_{IL}\\delta_{JK}) \\right)\n$$\n$$\n\\mathbb{C}_{IJKL} = \\lambda \\delta_{IJ} \\delta_{KL} + \\mu (\\delta_{IK}\\delta_{JL} + \\delta_{IL}\\delta_{JK})\n$$\nThis is the well-known isotropic elasticity tensor.\n\nThe spatial algorithmic consistent tangent $\\mathbb{a}^{\\mathrm{cons}}$ is obtained by the push-forward operation:\n$$\n\\mathbb{a}^{\\mathrm{cons}}_{ijkl}(\\mathbf{F}) = \\frac{1}{J}\\,F_{iI} F_{jJ} F_{kK} F_{lL}\\,\\mathbb{C}_{IJKL}\n$$\nTo prove that $\\mathbb{a}^{\\mathrm{cons}}$ possesses minor symmetries ($a^{\\mathrm{cons}}_{ijkl} = a^{\\mathrm{cons}}_{jikl}$ and $a^{\\mathrm{cons}}_{ijkl} = a^{\\mathrm{cons}}_{ijlk}$), we first examine the symmetries of $\\mathbb{C}$.\n-   First minor symmetry ($I \\leftrightarrow J$): $\\mathbb{C}_{JIKL} = \\lambda \\delta_{JI} \\delta_{KL} + \\mu (\\delta_{JK}\\delta_{IL} + \\delta_{JL}\\delta_{IK}) = \\lambda \\delta_{IJ} \\delta_{KL} + \\mu (\\delta_{IL}\\delta_{JK} + \\delta_{IK}\\delta_{JL}) = \\mathbb{C}_{IJKL}$.\n-   Second minor symmetry ($K \\leftrightarrow L$): $\\mathbb{C}_{IJLK} = \\lambda \\delta_{IJ} \\delta_{LK} + \\mu (\\delta_{IL}\\delta_{JK} + \\delta_{IK}\\delta_{JL}) = \\lambda \\delta_{IJ} \\delta_{KL} + \\mu (\\delta_{IK}\\delta_{JL} + \\delta_{IL}\\delta_{JK}) = \\mathbb{C}_{IJKL}$.\nSince $\\mathbb{C}$ possesses both minor symmetries, we can demonstrate the same for $\\mathbb{a}^{\\mathrm{cons}}$.\n-   $a^{\\mathrm{cons}}_{jikl} = \\frac{1}{J}\\,F_{jA} F_{iB} F_{kC} F_{lD}\\,\\mathbb{C}_{ABCD}$. Relabeling the summation indices $A \\to B'$ and $B \\to A'$, we get $\\frac{1}{J}\\,F_{jB'} F_{iA'} F_{kC} F_{lD}\\,\\mathbb{C}_{B'A'CD}$. As $\\mathbb{C}_{B'A'CD} = \\mathbb{C}_{A'B'CD}$, this becomes $\\frac{1}{J}\\,F_{iA'} F_{jB'} F_{kC} F_{lD}\\,\\mathbb{C}_{A'B'CD} = a^{\\mathrm{cons}}_{ijkl}$.\n-   A similar argument holds for the second pair of indices: $a^{\\mathrm{cons}}_{ijlk} = \\frac{1}{J}\\,F_{iA} F_{jB} F_{kC} F_{lD}\\,\\mathbb{C}_{ABDC}$. Since $\\mathbb{C}_{ABDC}=\\mathbb{C}_{ABCD}$, this equals $a^{\\mathrm{cons}}_{ijkl}$.\nThus, $\\mathbb{a}^{\\mathrm{cons}}$ inherits the minor symmetries from $\\mathbb{C}$.\n\n### 2. Analysis of Symmetry Loss in the Stabilized Moduli\n\nThe stabilized algorithmic moduli is defined as $\\mathbb{a}(\\mathbf{F}) = \\mathbb{a}^{\\mathrm{cons}}(\\mathbf{F}) + \\mathbb{h}(\\mathbf{F})$, with the hourglass contribution being:\n$$\n\\mathbb{h}_{ijkl}(\\mathbf{F}) = \\beta\\left(U_{ij}\\,V_{kl} - V_{ij}\\,U_{kl}\\right)\n$$\nwhere $\\mathbf{U} = \\mathbf{F} - \\mathbf{I}$ and $\\mathbf{V} = \\mathbf{F}^{-\\mathsf{T}} - \\mathbf{I}$. For $\\mathbb{a}$ to have minor symmetries, and given that $\\mathbb{a}^{\\mathrm{cons}}$ has them, $\\mathbb{h}$ must also have minor symmetries. We now test this for a general deformation $\\mathbf{F}$ and $\\beta \\neq 0$.\n\n-   Test for first minor symmetry ($h_{ijkl} = h_{jikl}$):\n    $$\n    h_{jikl} = \\beta(U_{ji}V_{kl} - V_{ji}U_{kl})\n    $$\n    The symmetry condition $h_{ijkl} = h_{jikl}$ requires $(U_{ij} - U_{ji})V_{kl} - (V_{ij} - V_{ji})U_{kl} = 0$.\n    The term $U_{ij} - U_{ji} = (F_{ij} - \\delta_{ij}) - (F_{ji} - \\delta_{ji}) = F_{ij} - F_{ji} = 2\\,\\mathrm{skw}(\\mathbf{F})_{ij}$.\n    The term $V_{ij} - V_{ji} = ((F^{-1})_{ji} - \\delta_{ij}) - ((F^{-1})_{ij} - \\delta_{ji}) = (F^{-1})_{ji} - (F^{-1})_{ij} = -2\\,\\mathrm{skw}(\\mathbf{F}^{-1})_{ij}$.\n    The condition becomes $2\\beta(\\mathrm{skw}(\\mathbf{F})_{ij} V_{kl} + \\mathrm{skw}(\\mathbf{F}^{-1})_{ij} U_{kl}) = 0$. For a general deformation, $\\mathbf{F}$ includes a rotational part, so $\\mathrm{skw}(\\mathbf{F}) \\neq \\mathbf{0}$. Also, $\\mathbf{U}$ and $\\mathbf{V}$ are generally non-zero. Thus, this expression is not identically zero.\n\n-   Test for second minor symmetry ($h_{ijkl} = h_{ijlk}$):\n    $$\n    h_{ijlk} = \\beta(U_{ij}V_{lk} - V_{ij}U_{lk})\n    $$\n    The symmetry condition $h_{ijkl} = h_{ijlk}$ requires $U_{ij}(V_{kl} - V_{lk}) - V_{ij}(U_{kl} - U_{lk}) = 0$.\n    The term $V_{kl} - V_{lk} = -2\\,\\mathrm{skw}(\\mathbf{F}^{-\\mathsf{T}})_{kl} = 2\\,\\mathrm{skw}(\\mathbf{F}^{-1})_{lk}$. Let's be careful. $V_{kl} - V_{lk} = (F^{-T})_{kl} - (F^{-T})_{lk} = (F^{-1})_{lk} - (F^{-1})_{kl}$.\n    The term $U_{kl} - U_{lk} = F_{kl} - F_{lk}$.\n    The condition is $\\beta[U_{ij}((F^{-1})_{lk} - (F^{-1})_{kl}) - V_{ij}(F_{kl} - F_{lk})] = 0$. Again, for a general non-symmetric $\\mathbf{F}$ and its inverse, this expression is not identically zero.\n\nSince $\\mathbb{h}$ generally lacks both minor symmetries, and $\\mathbb{a}^{\\mathrm{cons}}$ possesses them, their sum $\\mathbb{a} = \\mathbb{a}^{\\mathrm{cons}} + \\mathbb{h}$ will not satisfy the minor symmetries for a generic $\\mathbf{F}$ and $\\beta \\neq 0$.\n\n### 3. Quantitative Measure of Minor Symmetry Loss\n\nThe proposed measure $m_{\\mathrm{rel}}(\\mathbb{A})$ correctly quantifies the relative magnitude of the parts of the tensor that are anti-symmetric with respect to the first two and last two indices. The Frobenius norm is a standard tensor norm, and the use of $\\varepsilon$ provides numerical stability. The components of the difference tensors are $A_{ijkl} - A_{jikl}$ and $A_{ijkl} - A_{ijlk}$, which directly measure the violation of each minor symmetry. Squaring, summing, and taking the square root combines these violations in a root-mean-square sense. This measure will be implemented as defined.\n\n### 4. The Symmetrization Operator $\\Pi_{\\mathrm{ms}}$\n\nWe propose the following linear operator $\\Pi_{\\mathrm{ms}}$ to project any fourth-order tensor $\\mathbb{A}$ onto the subspace of tensors with minor symmetries:\n$$\n(\\Pi_{\\mathrm{ms}}(\\mathbb{A}))_{ijkl} = \\frac{1}{4} (A_{ijkl} + A_{jikl} + A_{ijlk} + A_{jilk})\n$$\nLet $\\mathbb{B} = \\Pi_{\\mathrm{ms}}(\\mathbb{A})$. We verify that $\\mathbb{B}$ has minor symmetries:\n-   $B_{jikl} = \\frac{1}{4} (A_{jikl} + A_{ijkl} + A_{jilk} + A_{ijlk}) = B_{ijkl}$.\n-   $B_{ijlk} = \\frac{1}{4} (A_{ijlk} + A_{jilk} + A_{ijkl} + A_{jikl}) = B_{ijkl}$.\nThe operator correctly maps into the desired subspace.\n\nNext, we prove it is an orthogonal projector by showing it is idempotent and self-adjoint.\n-   **Idempotency** ($\\Pi_{\\mathrm{ms}} \\circ \\Pi_{\\mathrm{ms}} = \\Pi_{\\mathrm{ms}}$):\n    Let $\\mathbb{B} = \\Pi_{\\mathrm{ms}}(\\mathbb{A})$. We apply the operator again: $(\\Pi_{\\mathrm{ms}}(\\mathbb{B}))_{ijkl} = \\frac{1}{4} (B_{ijkl} + B_{jikl} + B_{ijlk} + B_{jilk})$. Since $\\mathbb{B}$ has minor symmetries, $B_{jikl}=B_{ijlk}=B_{jilk}=B_{ijkl}$. Therefore, $(\\Pi_{\\mathrm{ms}}(\\mathbb{B}))_{ijkl} = \\frac{1}{4} (4 B_{ijkl}) = B_{ijkl}$. Thus, $\\Pi_{\\mathrm{ms}}(\\Pi_{\\mathrm{ms}}(\\mathbb{A})) = \\Pi_{\\mathrm{ms}}(\\mathbb{A})$.\n\n-   **Self-Adjointness** ($\\langle \\Pi_{\\mathrm{ms}}(\\mathbb{A}), \\mathbb{D} \\rangle_F = \\langle \\mathbb{A}, \\Pi_{\\mathrm{ms}}(\\mathbb{D}) \\rangle_F$):\n    The Frobenius inner product is $\\langle \\mathbb{A}, \\mathbb{D} \\rangle_F = \\sum_{i,j,k,l} A_{ijkl} D_{ijkl}$.\n    $$\n    \\langle \\Pi_{\\mathrm{ms}}(\\mathbb{A}), \\mathbb{D} \\rangle_F = \\sum_{i,j,k,l} \\frac{1}{4} (A_{ijkl} + A_{jikl} + A_{ijlk} + A_{jilk}) D_{ijkl}\n    $$\n    By relabeling summation indices, we can shift the index transpositions from $\\mathbb{A}$ to $\\mathbb{D}$:\n    $\\sum A_{jikl} D_{ijkl} = \\sum A_{abcd} D_{badc} = \\sum A_{ijkl} D_{jikl}$.\n    $\\sum A_{ijlk} D_{ijkl} = \\sum A_{abcd} D_{abdc} = \\sum A_{ijkl} D_{ijlk}$.\n    $\\sum A_{jilk} D_{ijkl} = \\sum A_{abcd} D_{badc} = \\sum A_{ijkl} D_{jilk}$.\n    Therefore,\n    $$\n    \\langle \\Pi_{\\mathrm{ms}}(\\mathbb{A}), \\mathbb{D} \\rangle_F = \\sum_{i,j,k,l} A_{ijkl} \\frac{1}{4} (D_{ijkl} + D_{jikl} + D_{ijlk} + D_{jilk}) = \\langle \\mathbb{A}, \\Pi_{\\mathrm{ms}}(\\mathbb{D}) \\rangle_F\n    $$\nSince the operator is idempotent and self-adjoint, it is an orthogonal projector. This guarantees that $\\widetilde{\\mathbb{a}} = \\Pi_{\\mathrm{ms}}(\\mathbb{a})$ is the closest minor-symmetric tensor to $\\mathbb{a}$ in the least-squares (Frobenius norm) sense.\n\n### 5. Sufficient Conditions for Quadratic Convergence\n\nThe Newton-Raphson method for solving a nonlinear system of equations $\\mathbf{R}(\\mathbf{u}) = \\mathbf{0}$ is given by the iteration $\\mathbf{u}_{k+1} = \\mathbf{u}_k - [\\mathbf{K}_T(\\mathbf{u}_k)]^{-1} \\mathbf{R}(\\mathbf{u}_k)$, where $\\mathbf{K}_T = \\partial \\mathbf{R}/\\partial \\mathbf{u}$ is the exact tangent stiffness matrix (Jacobian). The method exhibits asymptotic quadratic convergence if the Jacobian is computed correctly and is non-singular at the solution $\\mathbf{u}^*$.\n\nIn our problem, the \"exact\" tangent modulus is $\\mathbb{a}$, leading to the exact Jacobian $\\mathbf{K}_T$. We replace it with an approximate modulus $\\widetilde{\\mathbb{a}}$, yielding an approximate Jacobian $\\widetilde{\\mathbf{K}}_T$. This transforms the algorithm into an inexact Newton method.\n\nThe theory of inexact Newton methods (e.g., Dembo, Eisenstat, Steihaug) provides conditions for maintaining rapid convergence. Quadratic convergence is preserved if the error in the Jacobian step satisfies the condition:\n$$\n\\| (\\widetilde{\\mathbf{K}}_T(\\mathbf{u}_k) - \\mathbf{K}_T(\\mathbf{u}_k)) \\Delta\\mathbf{u}_k \\| = O(\\|\\mathbf{R}(\\mathbf{u}_k)\\|^2)\n$$\nwhere $\\Delta\\mathbf{u}_k = \\mathbf{u}_{k+1} - \\mathbf{u}_k$. The difference between the Jacobians, $\\widetilde{\\mathbf{K}}_T - \\mathbf{K}_T$, is assembled from the difference in the tangent moduli, $\\widetilde{\\mathbb{a}} - \\mathbb{a}$. This difference is:\n$$\n\\widetilde{\\mathbb{a}} - \\mathbb{a} = \\Pi_{\\mathrm{ms}}(\\mathbb{a}) - \\mathbb{a} = \\Pi_{\\mathrm{ms}}(\\mathbb{a}^{\\mathrm{cons}} + \\mathbb{h}) - (\\mathbb{a}^{\\mathrm{cons}} + \\mathbb{h}) = (\\mathbb{a}^{\\mathrm{cons}} + \\Pi_{\\mathrm{ms}}(\\mathbb{h})) - (\\mathbb{a}^{\\mathrm{cons}} + \\mathbb{h}) = \\Pi_{\\mathrm{ms}}(\\mathbb{h}) - \\mathbb{h}\n$$\nThis term represents the projection of $\\mathbb{h}$ onto the subspace orthogonal to the minor-symmetric tensors.\n\nA sufficient, albeit strong, condition to satisfy the requirement for quadratic convergence is that the approximate Jacobian becomes equal to the exact Jacobian at the solution. That is, $\\widetilde{\\mathbf{K}}_T(\\mathbf{u}^*) = \\mathbf{K}_T(\\mathbf{u}^*)$. This implies that at the continuum level, the tangent moduli must be equal at the solution state $\\mathbf{F}^*$:\n$$\n\\widetilde{\\mathbb{a}}(\\mathbf{F}^*) = \\mathbb{a}(\\mathbf{F}^*)\n$$\nThis equality holds if and only if $\\mathbb{a}(\\mathbf{F}^*)$ already possesses minor symmetries, meaning $\\Pi_{\\mathrm{ms}}(\\mathbb{a}(\\mathbf{F}^*)) = \\mathbb{a}(\\mathbf{F}^*)$. This requires the hourglass contribution $\\mathbb{h}(\\mathbf{F}^*)$ to be minor-symmetric at the solution. As shown in Part 2, $\\mathbb{h}$ has minor symmetries if theskew-symmetric parts of $\\mathbf{F}$ and $\\mathbf{F}^{-1}$ are zero. This occurs when $\\mathbf{F}$ is a symmetric tensor.\n\nTherefore, a sufficient condition to preserve the quadratic rate of convergence of the Newton method is that the deformation at the equilibrium solution, $\\mathbf{F}^*$, is a pure stretch, i.e., $\\mathbf{F}^*$ is a symmetric tensor. In this case, the non-conservative stabilization term $\\mathbb{h}(\\mathbf{F}^*)$ becomes minor-symmetric, the symmetrized tangent $\\widetilde{\\mathbb{a}}(\\mathbf{F}^*)$ equals the exact one $\\mathbb{a}(\\mathbf{F}^*)$, and the asymptotic convergence rate remains quadratic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the formatted result.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (\n            np.array([[1.1, 0.2, 0.0], [0.0, 0.95, 0.1], [0.0, 0.0, 1.05]]),\n            120.0, 40.0, 0.6\n        ),\n        # Case 2\n        (\n            np.array([[1.05, 0.15, -0.05], [0.02, 0.98, 0.04], [0.01, -0.03, 1.02]]),\n            50.0, 30.0, 1.2\n        ),\n        # Case 3\n        (\n            np.array([[1.2, 0.0, 0.0], [0.0, 0.85, 0.0], [0.0, 0.0, 1.1]]),\n            200.0, 80.0, 0.0\n        ),\n        # Case 4\n        (\n            np.array([[1.0, 0.3, 0.0], [0.0, 1.0, 0.2], [0.0, 0.0, 1.0]]),\n            10000.0, 10.0, 0.8\n        ),\n    ]\n\n    epsilon = 1e-12\n    results = []\n\n    for F_mat, lam, mu, beta in test_cases:\n        m_rel_a, m_rel_a_tilde = compute_for_case(F_mat, lam, mu, beta, epsilon)\n        results.extend([m_rel_a, m_rel_a_tilde])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_m_rel(A, epsilon):\n    \"\"\"\n    Computes the relative minor symmetry loss for a 4th-order tensor A.\n    \"\"\"\n    norm_A_F = np.linalg.norm(A)\n    \n    # Difference with respect to transposition of the first two indices\n    A_minus_Pij = A - A.transpose(1, 0, 2, 3)\n    norm_sq_Pij_diff = np.linalg.norm(A_minus_Pij)**2\n    \n    # Difference with respect to transposition of the last two indices\n    A_minus_Pkl = A - A.transpose(0, 1, 3, 2)\n    norm_sq_Pkl_diff = np.linalg.norm(A_minus_Pkl)**2\n    \n    numerator = np.sqrt(norm_sq_Pij_diff + norm_sq_Pkl_diff)\n    denominator = max(norm_A_F, epsilon)\n    \n    return numerator / denominator\n\ndef pi_ms(A):\n    \"\"\"\n    Applies the minor symmetrization operator Pi_ms to a 4th-order tensor A.\n    \"\"\"\n    A_jikl = A.transpose(1, 0, 2, 3)\n    A_ijlk = A.transpose(0, 1, 3, 2)\n    A_jilk = A.transpose(1, 0, 3, 2)\n    return 0.25 * (A + A_jikl + A_ijlk + A_jilk)\n\ndef compute_for_case(F, lam, mu, beta, epsilon):\n    \"\"\"\n    Performs all computations for a single test case.\n    \"\"\"\n    # 1. Compute material elasticity tensor C\n    delta = np.eye(3)\n    C = (lam * np.einsum('ij,kl->ijkl', delta, delta) +\n         mu * (np.einsum('ik,jl->ijkl', delta, delta) +\n               np.einsum('il,jk->ijkl', delta, delta)))\n\n    # 2. Compute consistent spatial tangent a_cons\n    J = np.linalg.det(F)\n    a_cons = (1.0 / J) * np.einsum('iI,jJ,kK,lL,IJKL->ijkl', F, F, F, F, C, optimize=True)\n\n    # 3. Compute hourglass tensor h\n    I = np.eye(3)\n    try:\n        F_inv = np.linalg.inv(F)\n    except np.linalg.LinAlgError:\n        # Handle singular F if it occurs, though not expected in test cases\n        print(\"Error: Singular deformation gradient F.\")\n        return float('nan'), float('nan')\n        \n    F_inv_T = F_inv.T\n    U = F - I\n    V = F_inv_T - I\n    \n    # h_ijkl = beta * (U_ij * V_kl - V_ij * U_kl)\n    h = beta * (np.einsum('ij,kl->ijkl', U, V) - np.einsum('ij,kl->ijkl', V, U))\n\n    # 4. Compute stabilized tensor a\n    a = a_cons + h\n    \n    # 5. Compute symmetrized tensor a_tilde\n    a_tilde = pi_ms(a)\n\n    # 6. Compute relative minor symmetry losses\n    m_rel_a = compute_m_rel(a, epsilon)\n    m_rel_a_tilde = compute_m_rel(a_tilde, epsilon)\n\n    return m_rel_a, m_rel_a_tilde\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}