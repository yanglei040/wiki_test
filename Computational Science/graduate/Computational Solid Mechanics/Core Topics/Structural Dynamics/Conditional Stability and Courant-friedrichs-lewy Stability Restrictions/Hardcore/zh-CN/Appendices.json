{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基础但至关重要的问题开始：如何从第一性原理出发，为显式时间积分格式推导出其稳定时间步长的上限。通过分析一个简单的、使用线性有限元离散的一维杆，您将亲手揭示材料属性（如杨氏模量 $E$ 和密度 $\\rho$）与网格尺寸 $h$ 是如何共同决定稳定极限的。这项练习是理解CFL条件物理本质和数学来源的基石。",
            "id": "3550116",
            "problem": "考虑一维小应变弹性动力学问题，研究对象为一根均匀细杆，其轴向位移场为 $u(x,t)$，横截面积为 $A$，杨氏模量为 $E$，质量密度为 $\\rho$。控制方程源于线性动量守恒和线性弹性固体的本构关系：轴向应力 $\\sigma$ 满足 $\\sigma=E\\,\\varepsilon$，其中轴向应变为 $\\varepsilon=\\partial u/\\partial x$；运动方程为 $\\rho A\\,\\partial^{2}u/\\partial t^{2}=\\partial(\\sigma A)/\\partial x$。沿杆的轴向，使用包含 $N$ 个尺寸为 $h$ 的线性两节点有限元的均匀网格对杆进行离散化，采用标准线性形函数和集中质量矩阵。假设在一个大的均匀网格中考虑内部节点，因此每个内部节点的方程都代表了这种空间重复结构。\n\n应用显式中心差分时间积分器于半离散有限元方程，通过分析离散运动方程和空间离散化所产生的谱，从第一性原理推导时间步长 $\\Delta t$ 的条件稳定性限制。以材料参数 $E$ 和 $\\rho$ 以及单元尺寸 $h$ 的函数形式，计算最大稳定时间步长 $\\Delta t_{\\max}$ 的闭合解，然后用杆中波速 $c=\\sqrt{E/\\rho}$ 表示该结果。解释您得出的边界与库朗-弗里德里希斯-列维 (CFL) 条件之间的关系。\n\n以秒为单位表示最终的时间步长。不需要数值；请给出 $\\Delta t_{\\max}$ 关于 $E$、$\\rho$、 $h$ 和 $c$ 的单一符号表达式。",
            "solution": "该问题陈述经评估是有效的，因为它具有科学依据，提法恰当，客观，并包含推导出唯一解所需的所有信息。它描述了计算固体力学中的一个标准问题。\n\n该问题要求推导一维弹性杆半离散运动方程在进行显式中心差分时间积分时的最大稳定时间步长 $\\Delta t_{\\max}$。该杆使用带有集中质量矩阵的线性两节点有限元进行空间离散化。\n\n首先，我们建立控制偏微分方程 (PDE)。运动方程为 $\\rho A \\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial(\\sigma A)}{\\partial x}$。对于均匀横截面 $A$、杨氏模量 $E$ 和质量密度 $\\rho$，应力为 $\\sigma=E\\varepsilon$，应变为 $\\varepsilon = \\frac{\\partial u}{\\partial x}$。将这些代入运动方程，得到：\n$$\n\\rho A \\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial}{\\partial x} \\left( E A \\frac{\\partial u}{\\partial x} \\right)\n$$\n由于 $E$ 和 $A$ 沿杆是均匀的，该方程可简化为一维波动方程：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = \\frac{E}{\\rho} \\frac{\\partial^2 u}{\\partial x^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中 $c = \\sqrt{E/\\rho}$ 是杆中纵波的传播速度。\n\n接下来，我们使用有限元法进行空间离散化。考虑一个连接节点 $i$ 和 $i+1$ 的长度为 $h$ 的通用线性单元。该单元内的位移场 $u^{(e)}(x)$ 通过线性形函数 $N_i(x)$ 和 $N_{i+1}(x)$ 从节点位移 $u_i$ 和 $u_{i+1}$ 插值得到。单元刚度矩阵 $\\mathbf{K}^{(e)}$ 由下式给出：\n$$\n\\mathbf{K}^{(e)} = \\int_{V^{(e)}} \\mathbf{B}^T E \\mathbf{B} \\, dV = A E \\int_{0}^{h} \\mathbf{B}^T \\mathbf{B} \\, dx\n$$\n其中 $\\mathbf{B} = \\left[ \\frac{dN_i}{dx}, \\frac{dN_{i+1}}{dx} \\right] = \\left[ -\\frac{1}{h}, \\frac{1}{h} \\right]$。在单元长度 $h$ 上积分得到：\n$$\n\\mathbf{K}^{(e)} = A E h \\begin{pmatrix} -1/h \\\\ 1/h \\end{pmatrix} \\begin{pmatrix} -1/h  1/h \\end{pmatrix} = \\frac{AE}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n问题指定了使用集中质量矩阵。对于线性单元，总质量 $\\rho A h$ 被平均分配到其两个节点上。因此，单元集中质量矩阵 $\\mathbf{M}_L^{(e)}$ 为：\n$$\n\\mathbf{M}_L^{(e)} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n现在我们为一个通用内部节点 $j$ 组装半离散运动方程，该节点与跨越节点 $(j-1, j)$ 的单元和跨越节点 $(j, j+1)$ 的单元相连。自由振动的常微分方程组 (ODEs) 为 $\\mathbf{M} \\ddot{\\mathbf{u}} + \\mathbf{K} \\mathbf{u} = \\mathbf{0}$。第 $j$ 个自由度的方程为：\n$$\nM_j \\ddot{u}_j + \\sum_k K_{jk} u_k = 0\n$$\n节点 $j$ 处的质量 $M_j$ 是来自两个相邻单元贡献的总和：$M_j = \\frac{\\rho A h}{2} + \\frac{\\rho A h}{2} = \\rho A h$。\n全局刚度矩阵第 $j$ 行的刚度贡献来自组装后的单元矩阵：\n($\\mathbf{K u}$ 的第 $j$ 行) = $K_{j,j-1}u_{j-1} + K_{j,j}u_j + K_{j,j+1}u_{j+1}$。\n根据 $\\mathbf{K}^{(e)}$ 的结构，我们发现：\n$K_{j,j-1} = -\\frac{AE}{h}$\n$K_{j,j} = \\frac{AE}{h} + \\frac{AE}{h} = \\frac{2AE}{h}$\n$K_{j,j+1} = -\\frac{AE}{h}$\n内部节点 $j$ 的半离散方程为：\n$$\n(\\rho A h) \\ddot{u}_j + \\frac{AE}{h} (2 u_j - u_{j-1} - u_{j+1}) = 0\n$$\n两边同除以 $\\rho A h$，我们得到：\n$$\n\\ddot{u}_j + \\frac{E}{\\rho h^2} (2 u_j - u_{j-1} - u_{j+1}) = 0\n$$\n该方程代表了一个耦合常微分方程组，每个内部节点对应一个方程。为了找到时间积分方案的稳定性极限，我们必须首先找到这个离散系统的最大自然频率 $\\omega_{\\max}$。自然频率可以通过假设一个 $u_j(t) = v_j e^{i\\omega t}$ 形式的谐波解来找到，这会导出一个广义特征值问题 $\\mathbf{K}\\mathbf{v} = \\omega^2 \\mathbf{M} \\mathbf{v}$。对于无限均匀网格，我们可以通过假设一个 $u_j(t) = \\hat{u} e^{i(k x_j - \\omega t)}$ 形式的空间振型来分析这个问题，其中 $x_j=jh$ 是节点 $j$ 的位置，$k$ 是波数。将此代入半离散方程：\n$$\n-\\omega^2 e^{ikjh} + \\frac{E}{\\rho h^2} (2 e^{ikjh} - e^{ik(j-1)h} - e^{ik(j+1)h}) = 0\n$$\n两边同除以 $e^{ikjh}$ 得到该数值格式的色散关系：\n$$\n\\omega^2 = \\frac{E}{\\rho h^2} (2 - e^{-ikh} - e^{ikh}) = \\frac{E}{\\rho h^2} (2 - 2\\cos(kh))\n$$\n使用半角三角恒等式 $1 - \\cos(\\theta) = 2 \\sin^2(\\theta/2)$：\n$$\n\\omega^2 = \\frac{2E}{\\rho h^2} (2 \\sin^2(kh/2)) = \\frac{4E}{\\rho h^2} \\sin^2(kh/2)\n$$\n因此，频率 $\\omega$ 由下式给出：\n$$\n\\omega(k) = \\frac{2}{h} \\sqrt{\\frac{E}{\\rho}} |\\sin(kh/2)| = \\frac{2c}{h} |\\sin(kh/2)|\n$$\n最大频率 $\\omega_{\\max}$ 出现在 $|\\sin(kh/2)| = 1$ 时。这对应于网格能表示的最高空间频率，其波长为 $\\lambda_{\\min} = 2h$。对于此模式，波数为 $k_{\\max} = 2\\pi/\\lambda_{\\min} = \\pi/h$，这使得 $k_{\\max}h/2 = \\pi/2$，确实有 $\\sin(\\pi/2)=1$。\n因此，离散系统的最大自然频率是：\n$$\n\\omega_{\\max} = \\frac{2c}{h} = \\frac{2}{h} \\sqrt{\\frac{E}{\\rho}}\n$$\n显式中心差分时间积分方案是条件稳定的。其稳定性条件将时间步长 $\\Delta t$ 与系统的最大频率联系起来：\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}}\n$$\n代入推导出的 $\\omega_{\\max}$ 值：\n$$\n\\Delta t \\le \\frac{2}{(2c/h)} = \\frac{h}{c}\n$$\n因此，最大稳定时间步长为：\n$$\n\\Delta t_{\\max} = \\frac{h}{c}\n$$\n这个结果可以用材料属性 $E$ 和 $\\rho$ 以及单元尺寸 $h$ 来表示：\n$$\n\\Delta t_{\\max} = \\frac{h}{\\sqrt{E/\\rho}} = h \\sqrt{\\frac{\\rho}{E}}\n$$\n这个稳定性极限与库朗-弗里德里希斯-列维 (CFL) 条件直接相关。CFL 条件是收敛的必要条件，它指出数值依赖域必须包含物理依赖域。对于一维波动方程，在时间间隔 $\\Delta t$ 内，波传播的距离为 $c \\Delta t$。在我们的数值格式中（对于这种均匀网格，它等价于一个二阶中心有限差分格式），节点 $(j, n+1)$ 的值依赖于之前时间步长节点 $j-1$、$j$ 和 $j+1$ 的数据。因此，信息传播的数值“速度”为 $h/\\Delta t$。CFL 条件要求物理波在单个时间步长内传播的距离不超过一个单元长度，以确保数值格式能够“捕捉”到物理现象。这可以转化为不等式 $c \\Delta t \\le h$，即 $\\Delta t \\le h/c$。我们推导出的稳定性极限 $\\Delta t_{\\max} = h/c$ 对应于库朗数 $\\mathcal{C} = c \\Delta t/h$ 等于其极限值 1 的情况。",
            "answer": "$$\n\\boxed{\\frac{h}{c}}\n$$"
        },
        {
            "introduction": "在真实的工程问题中，材料属性往往是不均匀的，网格尺寸也可能变化。在这种复杂情况下，精确求解整个系统的最大固有频率 $\\omega_{\\max}$ 可能非常耗时甚至不可行。这个练习将指导您使用Gershgorin圆盘定理这一强大的数学工具来估算 $\\omega_{\\max}$ 的上界，并据此计算出保证稳定的临界时间步长。通过将该理论估计值与基于局部单元的CFL估计值进行比较，您将体会到在复杂模型中进行高效、可靠稳定性评估的实用技术。",
            "id": "3550140",
            "problem": "给定一个一维非均匀弹性杆，使用线性两节点有限元法（FEM）轴向单元进行离散化，用于小振幅无阻尼纵向振动分析。节点位移的半离散运动方程形式为 $M \\ddot{u} + K u = 0$，其中 $K$ 是全局刚度矩阵，$M$ 是全局质量矩阵。考虑广义特征值问题 $K \\phi = \\omega^2 M \\phi$，它控制着固有频率 $\\omega$。您的任务是根据第一性原理构建 $(K, M)$，使用盖尔绍林圆盘定理（Gershgorin’s theorem）估计最大平方特征值的上界，将其转换为最大频率 $\\omega_{\\max}$ 的界限，计算相应的显式时间积分稳定性极限 $\\Delta t_{\\text{cr}} = 2 / \\omega_{\\max}$，并将其与基于网格尺寸的 Courant–Friedrichs–Lewy (CFL) 估计值进行比较。\n\n使用以下基本依据和数据：\n- 第 $e$ 个单元的长度为 $\\ell_e$（单位：$\\text{m}$），杨氏模量为 $E_e$（单位：$\\text{Pa}$），密度为 $\\rho_e$（单位：$\\text{kg}/\\text{m}^3$），以及恒定的横截面积 $A$（单位：$\\text{m}^2$）。在所有情况下，假设 $A = 1\\,\\text{m}^2$。该杆不受外力和约束；固有频率是根据自由-自由系统计算的。\n- $2 \\times 2$ 轴向变形单元刚度矩阵为 $k^{(e)} = \\dfrac{E_e A}{\\ell_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$。\n- 使用集总单元质量矩阵，节点质量 $m^{(e)} = \\dfrac{\\rho_e A \\ell_e}{2}$ 分配给单元 $e$ 的两个节点。将这些组装成一个全局对角质量矩阵 $M$。\n- 对于集总 $M$，考虑行对角缩放矩阵 $A = M^{-1} K$，其特征值是广义问题的固有频率平方 $\\lambda = \\omega^2$。对于 $A$ 的第 $i$ 行，定义盖尔绍林圆盘中心 $c_i = a_{ii}$ 和半径 $r_i = \\sum_{j \\neq i} |a_{ij}|$，并使用所得的界限 $\\lambda_{\\max} \\le \\max_i \\left(c_i + r_i\\right)$。设 $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$ 以及显式中心差分临界时间步长 $\\Delta t_{\\text{cr}} = 2 / \\omega_{\\max}$。\n- 独立地，使用每个单元的一维膨胀波速 $c_e = \\sqrt{E_e / \\rho_e}$ 和局部单元尺寸 $\\ell_e$ 定义一个基于网格尺寸的 CFL 估计值，即 $\\Delta t_{\\text{CFL}} = \\min_e \\dfrac{\\ell_e}{c_e}$。所有时间量均以秒表示。\n\n实现一个程序，该程序：\n1. 根据给定的单元数据组装全局刚度矩阵 $K$ 和全局集总质量矩阵 $M$。\n2. 使用 $M$ 的对角线形成 $A = M^{-1} K$。\n3. 计算 $\\lambda_{\\max}$ 的盖尔绍林上界，从而计算 $\\Delta t_{\\text{cr}} = 2/\\sqrt{\\lambda_{\\max}}$。\n4. 计算 $\\Delta t_{\\text{CFL}} = \\min_e \\ell_e / \\sqrt{E_e/\\rho_e}$。\n5. 为每个测试用例返回三个值：$\\Delta t_{\\text{cr}}$（单位：秒）、$\\Delta t_{\\text{CFL}}$（单位：秒）以及无量纲比率 $r = \\Delta t_{\\text{cr}} / \\Delta t_{\\text{CFL}}$。\n\n使用以下测试套件，所有量均采用国际单位制（SI）：\n- 情况1（均匀，类钢材料）：$N=10$ 个单元；所有 $e$ 的 $\\ell_e = 0.1$；$E_e = 2.10 \\times 10^{11}$；$\\rho_e = 7800$；$A = 1$。\n- 情况2（交替非均匀，类钢/铝材料）：$N=8$ 个单元；所有 $e$ 的 $\\ell_e = 0.125$；$E_e = [7.0 \\times 10^{10}, 2.10 \\times 10^{11}, 7.0 \\times 10^{10}, 2.10 \\times 10^{11}, 7.0 \\times 10^{10}, 2.10 \\times 10^{11}, 7.0 \\times 10^{10}, 2.10 \\times 10^{11}]$；$\\rho_e = [2700, 7800, 2700, 7800, 2700, 7800, 2700, 7800]$；$A = 1$。\n- 情况3（带有极小单元的非均匀网格）：$N=5$ 个单元；$\\ell_e = [0.5, 0.3, 0.15, 0.04, 0.01]$；所有 $e$ 的 $E_e = 2.00 \\times 10^{11}$；所有 $e$ 的 $\\rho_e = 8000$；$A = 1$。\n- 情况4（单个单元）：$N=1$ 个单元；$\\ell_e = [2.0]$；$E_e = [1.0 \\times 10^{9}]$；$\\rho_e = [1000]$；$A = 1$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔结果列表。按顺序连接所有测试用例的三元组。也就是说，输出必须是 $[\\Delta t_{\\text{cr}}^{(1)}, \\Delta t_{\\text{CFL}}^{(1)}, r^{(1)}, \\Delta t_{\\text{cr}}^{(2)}, \\Delta t_{\\text{CFL}}^{(2)}, r^{(2)}, \\ldots]$ 的形式，其中每个 $\\Delta t$ 以秒为单位，每个 $r$ 是无量纲的。",
            "solution": "用户希望解决一个计算固体力学问题。\n\n### 步骤1：提取已知条件\n- **控制方程**：节点位移的半离散运动方程为 $M \\ddot{u} + K u = 0$。\n- **特征值问题**：固有频率 $\\omega$ 由广义特征值问题 $K \\phi = \\omega^2 M \\phi$ 控制。\n- **单元属性**：单元 $e$ 的长度为 $\\ell_e$（m），杨氏模量为 $E_e$（Pa），密度为 $\\rho_e$（kg/m³）。\n- **横截面积**：面积 $A$ 是恒定的，等于 $1\\,\\text{m}^2$。\n- **边界条件**：该杆不受外力和约束（自由-自由系统）。\n- **单元刚度矩阵**：$k^{(e)} = \\dfrac{E_e A}{\\ell_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$。\n- **单元质量矩阵**：使用集总质量矩阵，单元 $e$ 的两个节点各分配节点质量 $m^{(e)} = \\dfrac{\\rho_e A \\ell_e}{2}$。全局质量矩阵 $M$ 是对角矩阵。\n- **分析用矩阵**：$A = M^{-1} K$，其特征值为 $\\lambda = \\omega^2$。\n- **盖尔绍林界**：$\\lambda_{\\max} \\le \\max_i \\left(c_i + r_i\\right)$，其中圆盘中心为 $c_i = a_{ii}$，半径为 $r_i = \\sum_{j \\neq i} |a_{ij}|$。\n- **临界时间步长（盖尔绍林）**：$\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$，以及 $\\Delta t_{\\text{cr}} = 2 / \\omega_{\\max}$。\n- **临界时间步长（CFL）**：$\\Delta t_{\\text{CFL}} = \\min_e \\dfrac{\\ell_e}{c_e}$，其中膨胀波速为 $c_e = \\sqrt{E_e / \\rho_e}$。\n- **输出**：对于每个测试用例，返回 $[\\Delta t_{\\text{cr}}, \\Delta t_{\\text{CFL}}, r]$，其中 $r = \\Delta t_{\\text{cr}} / \\Delta t_{\\text{CFL}}$。\n- **测试用例**：\n    1. 情况1（均匀）：$N=10$，$\\ell_e = 0.1$，$E_e = 2.10 \\times 10^{11}$，$\\rho_e = 7800$，$A = 1$。\n    2. 情况2（交替）：$N=8$，$\\ell_e = 0.125$，交替的 $E_e = [7.0 \\times 10^{10}, 2.10 \\times 10^{11}]$ 和 $\\rho_e = [2700, 7800]$，$A = 1$。\n    3. 情况3（非均匀网格）：$N=5$，$\\ell_e = [0.5, 0.3, 0.15, 0.04, 0.01]$，$E_e = 2.00 \\times 10^{11}$，$\\rho_e = 8000$，$A = 1$。\n    4. 情况4（单个单元）：$N=1$，$\\ell_e = [2.0]$，$E_e = [1.0 \\times 10^{9}]$，$\\rho_e = [1000]$，$A = 1$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据、适定且客观。\n- **科学合理性**：该问题是波传播有限元分析中的一个标准练习。控制方程、单元公式（线性轴向单元）、质量集总、盖尔绍林圆盘定理（Gershgorin's theorem）和CFL条件都是计算固体力学和数值分析中基本且正确陈述的概念。稳定性极限 $\\Delta t \\le 2/\\omega_{\\max}$ 是显式中心差分时间积分方案的正确条件，这里是隐式假设的。\n- **适定性**：问题是完全指定的。为每个测试用例构建唯一的数值解所需的所有必要数据和公式都已提供。自由-自由边界条件导致奇异刚度矩阵 $K$，这在物理上是正确的（它允许一个 $\\omega=0$ 的刚体模态）。这对计算没有问题，因为稳定性由最大频率 $\\omega_{\\max}$ 控制，该频率是明确定义且为正的。\n- **客观性**：问题以精确、定量的术语陈述，没有任何主观或模糊的语言。\n\n该问题没有任何无效缺陷。它是一个定义明确、可验证的计算工程问题。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解决方案。\n\n### 解决方案\n\n解决方案需要构建全局刚度矩阵和质量矩阵，应用盖尔绍林圆盘定理（Gershgorin's theorem）来估计最大特征值，并计算显式时间积分临界时间步长的两种不同估计值。\n\n一个离散为 $N$ 个线性单元的一维杆有 $N+1$ 个节点，索引从 $0$ 到 $N$。全局刚度矩阵 $K$ 和质量矩阵 $M$ 的大小为 $(N+1) \\times (N+1)$。\n\n**1. 矩阵组装**\n我们通过对每个单元的贡献求和来组装全局矩阵。对于连接节点 $i=e$ 和 $j=e+1$ 的单元 $e$，其刚度和质量被添加到全局矩阵中。\n\n**全局质量矩阵 ($M$)**：问题指定了一个集总质量矩阵。单元 $e$ 的质量 $\\rho_e A \\ell_e$ 在其两个节点之间平分。一个内部节点 $i$（对于 $i=1, \\ldots, N-1$）由单元 $i-1$ 和单元 $i$ 共享。其质量是来自两者的贡献之和：\n$$M_{ii} = \\frac{\\rho_{i-1} A \\ell_{i-1}}{2} + \\frac{\\rho_i A \\ell_i}{2}$$\n端点节点 $0$ 和 $N$ 各只连接一个单元：\n$$M_{00} = \\frac{\\rho_0 A \\ell_0}{2}, \\quad M_{NN} = \\frac{\\rho_{N-1} A \\ell_{N-1}}{2}$$\n由于 $M$ 是一个集总质量矩阵，所有非对角线项都为零，即当 $i \\neq j$ 时，$M_{ij}=0$。\n\n**全局刚度矩阵 ($K$)**：单元 $e$ 的单元刚度矩阵为 $k^{(e)} = \\frac{E_e A}{\\ell_e} \\begin{bsmallmatrix} 1  -1 \\\\ -1  1 \\end{bsmallmatrix}$。将所有单元的这些矩阵组装起来，一个内部对角项 $K_{ii}$ 从单元 $i-1$ 和 $i$ 获得刚度：\n$$K_{ii} = \\frac{E_{i-1} A}{\\ell_{i-1}} + \\frac{E_i A}{\\ell_i}$$\n端点节点对角项为：\n$$K_{00} = \\frac{E_0 A}{\\ell_0}, \\quad K_{NN} = \\frac{E_{N-1} A}{\\ell_{N-1}}$$\n对应于连接节点 $e$ 和 $e+1$ 的单元 $e$ 的非对角项为 $K_{e, e+1} = K_{e+1, e} = -\\frac{E_e A}{\\ell_e}$。\n\n**2. 盖尔绍林界和临界时间步长 ($\\Delta t_{\\text{cr}}$)**\n我们分析矩阵 $A = M^{-1}K$。由于 $M$ 是对角的， $M^{-1}$ 也是对角的，其项为 $(M^{-1})_{ii} = 1/M_{ii}$。$A$ 的项为 $a_{ij} = K_{ij} / M_{ii}$。\n\n盖尔绍林圆盘定理（Gershgorin's theorem）指出，$A$ 的所有特征值都位于复平面上圆盘 $D_i$ 的并集内，其中每个圆盘以 $c_i = a_{ii}$ 为中心，半径为 $r_i = \\sum_{j \\neq i} |a_{ij}|$。这提供了最大特征值的界限：$\\lambda_{\\max} \\le \\max_i(c_i + r_i)$。\n\n对于自由-自由系统，刚度矩阵的一个关键特性是其行（和列）和为零：$\\sum_j K_{ij} = 0$。由于所有非对角项 $K_{ij}$（$i \\neq j$）都是非正的，这意味着 $K_{ii} = -\\sum_{j \\neq i} K_{ij} = \\sum_{j \\neq i} |K_{ij}|$。\n\n利用这个特性，我们可以简化盖尔绍林半径 $r_i$ 的表达式：\n$$r_i = \\sum_{j \\neq i} |a_{ij}| = \\sum_{j \\neq i} \\frac{|K_{ij}|}{M_{ii}} = \\frac{1}{M_{ii}} \\sum_{j \\neq i} |K_{ij}| = \\frac{K_{ii}}{M_{ii}} = a_{ii} = c_i$$\n这个显著的结果，$r_i = c_i$，对于这个特定公式中的每个节点 $i$ 都成立。每行的盖尔绍林界限就是 $c_i + r_i = 2a_{ii}$。最大特征值的总界限是：\n$$\\lambda_{\\max} \\le \\max_i(2a_{ii})$$\n让我们分析一下 $a_{ii}$。对于一个端点节点，例如节点 $0$：\n$$a_{00} = \\frac{K_{00}}{M_{00}} = \\frac{E_0 A / \\ell_0}{\\rho_0 A \\ell_0 / 2} = \\frac{2 E_0}{\\rho_0 \\ell_0^2} = 2 \\frac{c_0^2}{\\ell_0^2}$$\n其中 $c_e = \\sqrt{E_e/\\rho_e}$ 是波速。此行得出的界限是 $2a_{00} = 4(c_0/\\ell_0)^2$。\n对于一个内部节点 $i$：\n$$a_{ii} = \\frac{K_{ii}}{M_{ii}} = \\frac{E_{i-1} A / \\ell_{i-1} + E_i A / \\ell_i}{(\\rho_{i-1} A \\ell_{i-1} + \\rho_i A \\ell_i) / 2} = 2 \\frac{E_{i-1}/\\ell_{i-1} + E_i/\\ell_i}{\\rho_{i-1}\\ell_{i-1} + \\rho_i\\ell_i}$$\n这个表达式是一个加权平均。设 $w_e = \\rho_e \\ell_e$ 和 $s_e^2 = c_e^2/\\ell_e^2 = E_e/(\\rho_e \\ell_e^2)$。那么 $E_e/\\ell_e = w_e s_e^2$。项 $2a_{ii}$ 变为：\n$$2a_{ii} = 4 \\frac{w_{i-1}s_{i-1}^2 + w_i s_i^2}{w_{i-1}+w_i}$$\n加权平均值的值受限于被平均值的最小值和最大值。因此，$2a_{ii} \\le 4 \\max(s_{i-1}^2, s_i^2)$。\n结合所有行（端点和内部）的界限，最大值由所有 $4s_e^2 = 4(c_e/\\ell_e)^2$ 项的最大值决定：\n$$\\max_i(2a_{ii}) = \\max_e \\left(4 \\frac{c_e^2}{\\ell_e^2}\\right) = 4 \\left(\\max_e \\frac{c_e}{\\ell_e}\\right)^2$$\n因此，$\\lambda_{\\max} = \\omega_{\\max}^2$ 的盖尔绍林界限是：\n$$\\lambda_{\\max} \\le 4 \\left(\\max_e \\frac{c_e}{\\ell_e}\\right)^2 \\implies \\omega_{\\max} \\le 2 \\left(\\max_e \\frac{c_e}{\\ell_e}\\right)$$\n临界时间步长是使用这个 $\\omega_{\\max}$ 的上界来计算的：\n$$\\Delta t_{\\text{cr}} = \\frac{2}{\\omega_{\\max, \\text{bound}}} = \\frac{2}{2 \\max_e (c_e/\\ell_e)} = \\frac{1}{\\max_e (c_e/\\ell_e)} = \\min_e \\left(\\frac{\\ell_e}{c_e}\\right)$$\n\n**3. 基于CFL的临界时间步长 ($\\Delta t_{\\text{CFL}}$)**\n问题将基于CFL的时间步长定义为：\n$$\\Delta t_{\\text{CFL}} = \\min_e \\frac{\\ell_e}{c_e}$$\n\n**4. 比较和比率**\n通过以上分析，我们发现对于带集总质量的一维线性有限元公式，从盖尔绍林圆盘定理（Gershgorin circle theorem）推导出的稳定性极限与经典的 CFL 稳定性极限相同。\n$$\\Delta t_{\\text{cr}} = \\Delta t_{\\text{CFL}}$$\n因此，我们预期在所有测试用例中，比率 $r = \\Delta t_{\\text{cr}} / \\Delta t_{\\text{CFL}}$ 在数值精度范围内将精确为 $1.0$。所提供的程序将通过显式构建矩阵并按指令应用定理来数值验证这一理论结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve_case(N, L, E, rho, A=1.0):\n    \"\"\"\n    Solves for dt_cr, dt_cfl, and their ratio for a single test case.\n\n    Args:\n        N (int): Number of elements.\n        L (list or np.ndarray): List of element lengths.\n        E (list or np.ndarray): List of element Young's moduli.\n        rho (list or np.ndarray): List of element densities.\n        A (float): Cross-sectional area.\n\n    Returns:\n        tuple: A tuple containing (dt_cr, dt_cfl, r).\n    \"\"\"\n    num_nodes = N + 1\n\n    # 1. Assemble the global stiffness K and lumped mass M matrices.\n    K = np.zeros((num_nodes, num_nodes))\n    M_diag = np.zeros(num_nodes)\n\n    for e in range(N):\n        le, Ee, rhoe = L[e], E[e], rho[e]\n        \n        # elemental stiffness value\n        k_val = Ee * A / le\n        \n        # elemental nodal mass\n        m_node = rhoe * A * le / 2.0\n        \n        # Node indices for element e are (e, e+1)\n        n1, n2 = e, e + 1\n        \n        # Assemble K\n        K[n1, n1] += k_val\n        K[n1, n2] -= k_val\n        K[n2, n1] -= k_val\n        K[n2, n2] += k_val\n        \n        # Assemble M (diagonal)\n        M_diag[n1] += m_node\n        M_diag[n2] += m_node\n\n    # 2. Form the matrix A = M^-1 * K.\n    # Since M is diagonal, M_inv is diagonal with 1/M_ii.\n    # We can compute A by dividing each row of K by the corresponding M_ii.\n    A_mat = np.zeros_like(K)\n    for i in range(num_nodes):\n        if M_diag[i] > 0:\n            A_mat[i, :] = K[i, :] / M_diag[i]\n\n    # 3. Compute Gershgorin upper bound on lambda_max and dt_cr.\n    lambda_max_bound = 0.0\n    for i in range(num_nodes):\n        # Gershgorin disc center c_i = a_ii\n        center = A_mat[i, i]\n        # Gershgorin disc radius r_i = sum of absolute values of off-diagonal elements in a row\n        radius = np.sum(np.abs(A_mat[i, :])) - np.abs(center)\n        \n        # The upper bound of the Gershgorin interval for row i\n        g_i = center + radius\n        if g_i > lambda_max_bound:\n            lambda_max_bound = g_i\n    \n    # Calculate dt_cr from the Gershgorin bound on the maximum frequency\n    if lambda_max_bound  1e-12:  # Avoid division by zero for cases with no stiffness\n        dt_cr = float('inf')\n    else:\n        omega_max_bound = np.sqrt(lambda_max_bound)\n        dt_cr = 2.0 / omega_max_bound\n        \n    # 4. Compute dt_CFL based on mesh size and wave speed.\n    E_arr, rho_arr, L_arr = np.array(E), np.array(rho), np.array(L)\n    c_e = np.sqrt(E_arr / rho_arr)\n    dt_local = L_arr / c_e\n    dt_cfl = np.min(dt_local)\n\n    # 5. Compute the ratio and return the results.\n    if dt_cfl == 0:\n        ratio = float('nan')\n    else:\n        ratio = dt_cr / dt_cfl\n    \n    return dt_cr, dt_cfl, ratio\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    A_const = 1.0\n\n    test_cases = [\n        # Case 1: Uniform, steel-like material\n        {'N': 10, 'L': [0.1] * 10, 'E': [2.10e11] * 10, 'rho': [7800] * 10},\n        \n        # Case 2: Alternating heterogeneity, steel/aluminum-like\n        {'N': 8, 'L': [0.125] * 8, \n         'E': [7.0e10, 2.10e11, 7.0e10, 2.10e11, 7.0e10, 2.10e11, 7.0e10, 2.10e11],\n         'rho': [2700, 7800, 2700, 7800, 2700, 7800, 2700, 7800]},\n        \n        # Case 3: Nonuniform mesh with a very small element\n        {'N': 5, 'L': [0.5, 0.3, 0.15, 0.04, 0.01], \n         'E': [2.00e11] * 5, 'rho': [8000] * 5},\n\n        # Case 4: Single element\n        {'N': 1, 'L': [2.0], 'E': [1.0e9], 'rho': [1000]}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        dt_cr, dt_cfl, r = solve_case(case['N'], case['L'], case['E'], case['rho'], A_const)\n        all_results.extend([dt_cr, dt_cfl, r])\n    \n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "知道了稳定性的边界在哪里固然重要，但理解越过这条边界会发生什么则更为关键。这个编程练习将带您直面数值不稳定的“狰狞面目”。通过故意选用一个略大于CFL极限的时间步长，您将通过代码量化由此产生的虚假能量增长率。这项实践不仅能加深您对不稳定性根本原因的理解，还能让您掌握诊断和识别显式动力学模拟中潜在稳定性问题的重要技能。",
            "id": "3550133",
            "problem": "考虑一根均匀棱柱杆的一维线性弹性动力学，其由偏微分方程 $\\rho \\, \\partial_{tt} u(x,t) = E \\, \\partial_{xx} u(x,t)$ 控制，其中 $\\rho$ 是质量密度，$E$ 是杨氏模量，$u(x,t)$ 是轴向位移。该杆支持速度为 $c = \\sqrt{E/\\rho}$ 的纵波。采用一致质量的均匀有限元空间离散化，得到半离散系统 $M \\, \\ddot{\\mathbf{u}}(t) + K \\, \\mathbf{u}(t) = \\mathbf{0}$，其中 $M$ 是对称正定矩阵，$K$ 是对称半正定矩阵。时间上采用标准的显式中心差分格式进行推进，该格式是条件稳定的。\n\n将 Courant 数定义为 $\\mathcal{C} = c \\, \\Delta t / h$，其中 $h$ 是单元长度，$\\Delta t$ 是时间步长。对于给定的空间离散化（网格阶数和均匀网格），存在一个最大允许 Courant 数 $\\mathcal{C}_{\\max}$，它与半离散算子的数值色散关系中的最高离散频率 $\\omega_{\\max}$ 相关联。中心差分格式是稳定的，当且仅当 $\\Delta t \\le 2/\\omega_{\\max}$，等价于 $\\mathcal{C} \\le \\mathcal{C}_{\\max}$。\n\n对 Courant-Friedrichs-Lewy (CFL) 限制的一个微小违反，即选择 $\\mathcal{C} = (1+\\epsilon) \\mathcal{C}_{\\max}$ 且 $\\epsilon  0$ 很小，会导致某些高频模式的伪指数增长。对于一个遵循 $\\ddot{y} + \\omega^2 y = 0$ 并由中心差分格式推进的模态坐标 $y(t)$，其单步放大因子 $r$ 满足 $r^2 - 2 \\alpha r + 1 = 0$，其中 $\\alpha = 1 - (\\omega \\Delta t)^2/2$。当 $|\\alpha| \\le 1$ 时（此时 $|r| = 1$），格式是稳定的；当 $|\\alpha|  1$ 时（此时 $|r|  1$），格式是不稳定的。对于一个不稳定模式，经过 $n$ 个时间步后，离散能量渐近地按 $|r|^{2n}$ 比例变化。将单位时间的能量增长率定义为 $\\gamma_E = \\frac{2}{\\Delta t} \\ln \\big(\\max_m |r_m|\\big)$，其中最大值取自半离散系统的所有离散模式。\n\n您的任务是编写一个完整的程序，该程序：\n- 使用网格阶数 $p \\in \\{1,2\\}$ 的均匀有限元，为长度为 $L$ 的杆的周期性环形离散化构建一致质量矩阵和刚度矩阵：\n  - 对于网格阶数 $p = 1$（线性单元），使用 $N$ 个单元和 $N$ 个节点。\n  - 对于网格阶数 $p = 2$（二次单元），使用 $N$ 个单元和 $2N$ 个节点；单元跨越两个节点间距，对于单元索引 $e$，局部连接关系为 $(2e, 2e+1, 2e+2)$。\n  - 使用一致质量矩阵。\n  - 通过在环上进行组装（环绕索引）来使用周期性边界条件。\n- 计算广义特征值问题 $K \\mathbf{u} = \\omega^2 M \\mathbf{u}$ 的特征值 $\\{\\omega_m^2\\}$，并确定 $\\omega_{\\max} = \\max_m \\omega_m$。\n- 对于给定的 $\\epsilon \\ge 0$，设置 $\\Delta t = (1+\\epsilon) \\cdot 2/\\omega_{\\max}$。\n- 根据中心差分格式的特征方程计算每个模式的放大因子模 $\\max_m |r_m|$，并返回以 $\\mathrm{s}^{-1}$ 为单位的能量增长率 $\\gamma_E = \\frac{2}{\\Delta t} \\ln \\big(\\max_m |r_m|\\big)$。\n\n对所有测试用例使用以下物理和数值参数：\n- 杆长 $L = 1 \\ \\mathrm{m}$。\n- 横截面积 $A = 1 \\ \\mathrm{m}^2$。\n- 密度 $\\rho = 1 \\ \\mathrm{kg/m^3}$。\n- 波速 $c = 1 \\ \\mathrm{m/s}$。\n- 杨氏模量 $E = \\rho c^2$。\n- 对于网格阶数 $p = 1$，使用 $N = 200$ 个单元。\n- 对于网格阶数 $p = 2$，使用 $N = 100$ 个单元。\n\n您必须实现单元级的一致质量和刚度矩阵，并将它们组装成全局矩阵：\n- 对于网格阶数 $p = 1$，单元长度 $h = L/N$，使用\n  - 单元刚度 $k^{(e)} = \\frac{E A}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$，\n  - 单元质量 $m^{(e)} = \\frac{\\rho A h}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix}$。\n- 对于网格阶数 $p = 2$，单元长度 $h = L/N$，使用（标准二次拉格朗日插值）\n  - 单元刚度 $k^{(e)} = \\frac{E A}{3 h} \\begin{bmatrix} 7  -8  1 \\\\ -8  16  -8 \\\\ 1  -8  7 \\end{bmatrix}$，\n  - 单元质量 $m^{(e)} = \\frac{\\rho A h}{30} \\begin{bmatrix} 4  2  -1 \\\\ 2  16  2 \\\\ -1  2  4 \\end{bmatrix}$。\n\n如上所述定义能量增长率 $\\gamma_E$。如果所有模式都稳定（例如 $\\epsilon = 0$），则精确定义 $\\gamma_E = 0$。\n\n测试套件：\n- 情况 1：$(p = 1, \\ \\epsilon = 0.0)$。\n- 情况 2：$(p = 1, \\ \\epsilon = 0.02)$。\n- 情况 3：$(p = 2, \\ \\epsilon = 0.02)$。\n- 情况 4：$(p = 2, \\ \\epsilon = 0.05)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个条目必须是能量增长率 $\\gamma_E$（单位为 $\\mathrm{s}^{-1}$），保留六位小数，并按测试套件的顺序列出。例如，输出格式必须与 $[\\gamma_1,\\gamma_2,\\gamma_3,\\gamma_4]$ 完全一样，不含空格。不需要用户输入；所有参数均按规定固定。所有角度（如有）都必须以弧度为单位。输出中的所有量纲量都必须按 $\\gamma_E$ 的规定以 $\\mathrm{s}^{-1}$ 为单位报告。",
            "solution": "我们从线性弹性杆中轴向运动的控制方程 $\\rho \\, \\partial_{tt} u(x,t) = E \\, \\partial_{xx} u(x,t)$ 开始，这是一个二阶双曲方程。波速为 $c = \\sqrt{E/\\rho}$。在均匀网格上使用带有一致质量的有限元法进行空间离散化，得到半离散系统 $M \\, \\ddot{\\mathbf{u}}(t) + K \\, \\mathbf{u}(t) = \\mathbf{0}$，其中 $M$ 和 $K$ 通过单元级贡献的标准组装获得。对于均匀网格和周期性结构，半离散算子允许 Bloch-Floquet 谐波模式，因此广义特征值问题 $K \\mathbf{\\phi} = \\omega^2 M \\mathbf{\\phi}$ 产生数值色散关系：对于每个离散波数，都有一个离散的圆频率 $\\omega$。\n\n对于网格阶数 $p = 1$（线性单元），单元长度为 $h$，单元级刚度矩阵和质量矩阵分别为 $k^{(e)} = \\frac{E A}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$ 和 $m^{(e)} = \\frac{\\rho A h}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix}$。在一个具有环绕连接性的均匀环上，组装这些矩阵并分析一个离散平面波 $u_j = \\hat{u} \\, e^{\\mathrm{i} j \\theta}$（其中 $\\theta \\in [0, 2\\pi)$），可以得到闭式色散关系\n$$\n\\omega^2(\\theta) \\;=\\; \\frac{4 E A}{h^2 \\rho A} \\cdot \\frac{3 \\, \\sin^2(\\theta/2)}{2 + \\cos \\theta} \\;=\\; \\frac{c^2}{h^2} \\cdot \\frac{12 \\, \\sin^2(\\theta/2)}{2 + \\cos \\theta} \\;=\\; \\frac{c^2}{h^2} \\cdot \\frac{4 \\, \\sin^2(\\theta/2)}{1 - \\frac{2}{3} \\sin^2(\\theta/2)}.\n$$\n该关系在 $\\sin^2(\\theta/2)$ 上是单调的，并在 $\\theta = \\pi$ 处达到最大值，得到 $\\omega_{\\max} = \\frac{2 \\sqrt{3} \\, c}{h}$。对于网格阶数 $p = 2$（二次单元），其单元级刚度矩阵为 $k^{(e)} = \\frac{E A}{3 h} \\begin{bmatrix} 7  -8  1 \\\\ -8  16  -8 \\\\ 1  -8  7 \\end{bmatrix}$，质量矩阵为 $m^{(e)} = \\frac{\\rho A h}{30} \\begin{bmatrix} 4  2  -1 \\\\ 2  16  2 \\\\ -1  2  4 \\end{bmatrix}$，在均匀环上进行周期性组装会得到一个块托普利兹（block-Toeplitz）算子，当通过一个原胞参数化时，该算子具有双支色散关系。尽管可以通过 Bloch 约简到一个 $2 \\times 2$（或 $3 \\times 3$）符号（取决于所选的原胞）来获得闭式解，但通过在周期性边界条件下组装全局矩阵并求解 $K \\mathbf{\\phi} = \\omega^2 M \\mathbf{\\phi}$ 来数值计算频谱，这样做更简单且完全等效。对于足够大的均匀网格，特征值集合会密集地采样数值色散曲线。\n\n对于遵循 $\\ddot{y} + \\omega^2 y = 0$ 的单个模式 $y(t)$，中心差分格式为\n$$\ny^{n+1} = 2 y^n - y^{n-1} - (\\omega \\Delta t)^2 y^n.\n$$\n设 $y^n = r^n$ 可得到特征多项式\n$$\nr^2 - 2 \\alpha r + 1 = 0, \\quad \\text{其中} \\quad \\alpha = 1 - \\frac{(\\omega \\Delta t)^2}{2}.\n$$\n其根为\n$$\nr_{\\pm} = \\alpha \\pm \\sqrt{\\alpha^2 - 1}.\n$$\n如果 $|\\alpha| \\le 1$（等价于 $\\omega \\Delta t \\le 2$），根是单位圆上的一对共轭复数，即 $|r_{\\pm}| = 1$，格式是临界稳定的（无增长）。如果 $|\\alpha|  1$（等价于 $\\omega \\Delta t  2$），根是实数，其大小满足 $|r_{+}| \\ge 1 \\ge |r_{-}|$，该模式会以 $|r_{+}|^n$ 的形式增长。对于模式的叠加，最坏情况下的增长由 $\\max_m |r_m|$ 控制，其中 $|r_m|$ 是根据相应的 $\\omega_m$ 计算得出的。定义一个模式的离散能量与振幅的平方成正比，则能量会渐近地以 $|r|^{2n}$ 的形式增长。因此，一个自然的单位时间能量增长率为\n$$\n\\gamma_E \\;=\\; \\frac{2}{\\Delta t} \\ln \\left( \\max_m |r_m| \\right).\n$$\n\n中心差分格式的最大允许时间步长是\n$$\n\\Delta t_{\\max} \\;=\\; \\frac{2}{\\omega_{\\max}},\n$$\n其中 $\\omega_{\\max}$ 是空间离散化系统的最大离散频率。通过取值\n$$\n\\Delta t \\;=\\; (1 + \\epsilon) \\, \\Delta t_{\\max}\n$$\n来施加一个 Courant 数违规参数 $\\epsilon \\ge 0$。当 $\\epsilon = 0$ 时，所有模式都满足 $\\omega \\Delta t \\le 2$，因此 $\\gamma_E = 0$。对于 $\\epsilon  0$，靠近 $\\omega_{\\max}$ 的模式满足 $\\omega \\Delta t  2$ 并导致增长，其增长率随 $\\epsilon$ 的增加而增加。\n\n算法设计：\n- 使用指定的单元矩阵和周期性环绕连接性来组装全局矩阵 $M$ 和 $K$。对于网格阶数 $p=1$，有 $N$ 个节点；单元为 $(e,e+1)$，其中 $e = 0,\\dots,N-1$，索引对 $N$ 取模。对于网格阶数 $p=2$，有 $2N$ 个节点，均匀间距为 $a = h/2$；每个单元 $e = 0,\\dots,N-1$ 连接节点 $(2e, 2e+1, 2e+2)$，索引对 $2N$ 取模。\n- 求解广义特征值问题 $K \\mathbf{\\phi} = \\omega^2 M \\mathbf{\\phi}$，并根据特征值 $\\lambda_m$ 计算 $\\omega_m = \\sqrt{\\lambda_m}$。最大的 $\\omega_m$ 即为 $\\omega_{\\max}$。\n- 设置 $\\Delta t = (1 + \\epsilon) \\cdot 2/\\omega_{\\max}$，并对每个 $\\omega_m$ 计算中心差分放大参数 $\\alpha_m = 1 - (\\omega_m \\Delta t)^2/2$。如果 $|\\alpha_m| \\le 1$，则设 $|r_m| = 1$。如果 $|\\alpha_m|  1$，则设 $|r_m| = |\\alpha_m| + \\sqrt{\\alpha_m^2 - 1}$，即不稳定根的模。\n- 计算 $\\gamma_E = \\frac{2}{\\Delta t} \\ln \\left( \\max_m |r_m| \\right)$。如果在数值公差范围内 $\\max_m |r_m| \\approx 1$，则精确报告 $\\gamma_E = 0$。\n- 单位：当 $c = 1 \\ \\mathrm{m/s}$、$L = 1 \\ \\mathrm{m}$、$A = 1 \\ \\mathrm{m}^2$、$\\rho = 1 \\ \\mathrm{kg/m^3}$ 和 $E = \\rho c^2$ 时，得到的 $\\gamma_E$ 的单位将是 $\\mathrm{s}^{-1}$。\n\n测试套件及覆盖理由：\n- 情况 1（$p = 1$, $\\epsilon = 0.0$）测试稳定性边界，预期增长率恰好为零。\n- 情况 2（$p = 1$, $\\epsilon = 0.02$）测试线性单元的轻微违规情况。\n- 情况 3（$p = 2$, $\\epsilon = 0.02$）在相同违规幅度下对比网格阶数对增长的影响。\n- 情况 4（$p = 2$, $\\epsilon = 0.05$）探究二次单元在更强违规情况下的表现。\n\n程序将四个保留六位小数的 $\\gamma_E$ 值汇总到单行中，格式为 $[\\gamma_1,\\gamma_2,\\gamma_3,\\gamma_4]$，不含空格。此输出纯为数值（浮点数），因此是可量化和可测试的。所有值均以 $\\mathrm{s}^{-1}$ 为单位报告。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef assemble_linear_FE(N, L, E, rho, A):\n    # Linear (p=1) elements with consistent mass on a periodic ring\n    h = L / N\n    ke = (E * A / h) * np.array([[1.0, -1.0],\n                                 [-1.0, 1.0]])\n    me = (rho * A * h / 6.0) * np.array([[2.0, 1.0],\n                                         [1.0, 2.0]])\n    ndof = N\n    K = np.zeros((ndof, ndof), dtype=float)\n    M = np.zeros((ndof, ndof), dtype=float)\n    for e in range(N):\n        n0 = e % N\n        n1 = (e + 1) % N\n        idx = [n0, n1]\n        K[np.ix_(idx, idx)] += ke\n        M[np.ix_(idx, idx)] += me\n    return K, M\n\ndef assemble_quadratic_FE(N, L, E, rho, A):\n    # Quadratic (p=2) elements with consistent mass on a periodic ring\n    # Element spans two node spacings; nodes per element = 3\n    h = L / N\n    # Standard quadratic Lagrange element matrices for axial bar\n    ke = (E * A / (3.0 * h)) * np.array([[7.0, -8.0, 1.0],\n                                         [-8.0, 16.0, -8.0],\n                                         [1.0, -8.0, 7.0]])\n    me = (rho * A * h / 30.0) * np.array([[4.0, 2.0, -1.0],\n                                          [2.0, 16.0, 2.0],\n                                          [-1.0, 2.0, 4.0]])\n    ndof = 2 * N  # nodes at spacing a = h/2\n    K = np.zeros((ndof, ndof), dtype=float)\n    M = np.zeros((ndof, ndof), dtype=float)\n    for e in range(N):\n        n0 = (2 * e) % ndof\n        n1 = (2 * e + 1) % ndof\n        n2 = (2 * e + 2) % ndof\n        idx = [n0, n1, n2]\n        K[np.ix_(idx, idx)] += ke\n        M[np.ix_(idx, idx)] += me\n    return K, M\n\ndef compute_growth_rate(K, M, eps):\n    # Solve generalized eigenproblem K phi = omega^2 M phi\n    # eigh returns eigenvalues in ascending order\n    # Ensure symmetry\n    Ksym = 0.5 * (K + K.T)\n    Msym = 0.5 * (M + M.T)\n    # Generalized symmetric definite eigenproblem\n    w2, _ = eigh(Ksym, Msym, overwrite_a=True, overwrite_b=True, check_finite=False)\n    # Numerical safety: clip small negatives to zero\n    w2 = np.maximum(w2, 0.0)\n    omega = np.sqrt(w2)\n    # Maximum discrete frequency\n    omega_max = np.max(omega)\n    if omega_max == 0:\n        return 0.0\n    dt_max = 2.0 / omega_max\n    dt = (1.0 + eps) * dt_max\n    # Compute per-mode amplification magnitudes and take maximum\n    s = omega * dt\n    alpha = 1.0 - 0.5 * s * s\n    # For stable modes (|alpha| = 1): |r| = 1\n    # For unstable modes (|alpha| > 1): |r| = |alpha| + sqrt(alpha^2 - 1)\n    abs_alpha = np.abs(alpha)\n    unstable = abs_alpha > 1.0 + 1e-12  # tolerance\n    rmag = np.ones_like(alpha)\n    if np.any(unstable):\n        aa = abs_alpha[unstable]\n        rmag[unstable] = aa + np.sqrt(aa * aa - 1.0)\n    rmax = np.max(rmag)\n    # Energy growth rate\n    if rmax = 1.0 + 1e-14:\n        return 0.0\n    gamma_E = (2.0 / dt) * np.log(rmax)\n    return float(gamma_E)\n\ndef solve():\n    # Physical parameters\n    L = 1.0  # m\n    A = 1.0  # m^2\n    rho = 1.0  # kg/m^3\n    c = 1.0  # m/s\n    E = rho * c * c  # Pa\n\n    results = []\n\n    # Test cases: (p, N, epsilon)\n    test_cases = [\n        (1, 200, 0.0),\n        (1, 200, 0.02),\n        (2, 100, 0.02),\n        (2, 100, 0.05),\n    ]\n\n    for p, N, eps in test_cases:\n        if p == 1:\n            K, M = assemble_linear_FE(N, L, E, rho, A)\n        elif p == 2:\n            K, M = assemble_quadratic_FE(N, L, E, rho, A)\n        else:\n            raise ValueError(\"Unsupported mesh order\")\n        gamma = compute_growth_rate(K, M, eps)\n        # Round to six decimal places\n        results.append(f\"{gamma:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}