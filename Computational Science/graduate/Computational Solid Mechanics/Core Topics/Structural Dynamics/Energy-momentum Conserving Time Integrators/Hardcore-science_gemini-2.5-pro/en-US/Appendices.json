{
    "hands_on_practices": [
        {
            "introduction": "The foundation of energy-preserving numerical methods lies in reformulating the laws of mechanics in a way that is compatible with discrete time steps. This exercise guides you through the construction of such a method from first principles, starting with the crucial concept of a discrete gradient . By deriving an integrator and proving its conservation properties, you will gain a fundamental understanding of how geometric integrators maintain the qualitative features of the underlying physical system.",
            "id": "3562093",
            "problem": "Consider a finite-dimensional conservative mechanical system with generalized coordinates $q \\in \\mathbb{R}^{n}$, symmetric positive definite mass matrix $M \\in \\mathbb{R}^{n \\times n}$, and smooth potential energy $V:\\mathbb{R}^{n} \\to \\mathbb{R}$. The motion is governed by the second-order ordinary differential equation $M \\ddot{q} + \\nabla V(q) = 0$. The continuous total energy is $H(q,\\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$, which is conserved along exact trajectories.\n\nYour tasks are:\n1. Starting from Newton's second law and the definition of total energy, introduce a discrete gradient $\\bar{\\nabla} V(q_{k},q_{k+1})$ that satisfies the discrete chain rule $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k},q_{k+1})^{\\top} (q_{k+1} - q_{k})$ and is consistent in the sense that $\\bar{\\nabla} V(q,q) = \\nabla V(q)$. Define one such $\\bar{\\nabla} V$ in closed form.\n2. Using the discrete gradient, construct a one-step, second-order accurate, time-reversible update for $(q_{k},v_{k})$ with $v_{k} \\approx \\dot{q}(t_{k})$ that preserves the discrete total energy exactly, where $H(q_{k},v_{k}) = \\frac{1}{2} v_{k}^{\\top} M v_{k} + V(q_{k})$.\n3. Prove, from first principles, that the constructed method preserves the discrete total energy and is second-order accurate in time. Your derivation must explicitly use the discrete chain rule and a local truncation error expansion based on Taylor series.\n4. For a one-dimensional system ($n=1$) with $M = 1$ and potential $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$, evaluate your discrete gradient $\\bar{\\nabla} V(q_{k},q_{k+1})$ at $q_{k} = 1$ and $q_{k+1} = 2$. Express your final numerical answer in exact form with no rounding and no units.",
            "solution": "The problem is valid as it is scientifically grounded in classical mechanics and numerical analysis, is well-posed with sufficient information, and is stated objectively. We proceed with the solution by addressing the four tasks in sequence.\n\nThe system under consideration is a finite-dimensional conservative mechanical system with generalized coordinates $q \\in \\mathbb{R}^{n}$, a symmetric positive definite mass matrix $M \\in \\mathbb{R}^{n \\times n}$, and a smooth potential energy function $V(q)$. The dynamics are described by Lagrange's equations of the second kind, which take the form of Newton's second law:\n$$ M \\ddot{q} + \\nabla V(q) = 0 $$\nThe total energy of the system, $H(q, \\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$, is a conserved quantity for exact solutions.\n\n**1. Definition of a Discrete Gradient**\n\nA discrete gradient, denoted $\\bar{\\nabla} V(q_{k}, q_{k+1})$, is a vector-valued function that approximates the continuous gradient $\\nabla V$ and is designed to satisfy a discrete analogue of the chain rule. The required properties are:\n1.  **Discrete Chain Rule:** $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k}, q_{k+1})^{\\top} (q_{k+1} - q_{k})$\n2.  **Consistency:** $\\bar{\\nabla} V(q, q) = \\nabla V(q)$\n\nA general and powerful way to define such a gradient is through the mean value theorem, leading to the **mean value discrete gradient**:\n$$ \\bar{\\nabla} V(q_{a}, q_{b}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi $$\nLet us verify that this definition satisfies the required properties.\nFor the discrete chain rule, consider the parametrized line segment $q(\\xi) = (1 - \\xi)q_{a} + \\xi q_{b}$ for $\\xi \\in [0, 1]$. The derivative of $q(\\xi)$ with respect to $\\xi$ is $q'(\\xi) = q_{b} - q_{a}$. By the fundamental theorem of calculus and the chain rule for multivariable functions:\n$$ V(q_{b}) - V(q_{a}) = V(q(1)) - V(q(0)) = \\int_{0}^{1} \\frac{d}{d\\xi} V(q(\\xi)) d\\xi $$\n$$ \\frac{d}{d\\xi} V(q(\\xi)) = \\nabla V(q(\\xi))^{\\top} q'(\\xi) = \\nabla V(q(\\xi))^{\\top} (q_{b} - q_{a}) $$\nSubstituting this into the integral gives:\n$$ V(q_{b}) - V(q_{a}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right)^{\\top} (q_{b} - q_{a}) d\\xi $$\nSince $(q_{b} - q_{a})$ is constant with respect to $\\xi$, we can move it outside the integral:\n$$ V(q_{b}) - V(q_{a}) = \\left( \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi \\right)^{\\top} (q_{b} - q_{a}) $$\nThis matches the discrete chain rule with our definition of $\\bar{\\nabla} V(q_{a}, q_{b})$.\n\nFor consistency, we set $q_a = q_b = q$:\n$$ \\bar{\\nabla} V(q, q) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q + \\xi q\\right) d\\xi = \\int_{0}^{1} \\nabla V(q) d\\xi = \\nabla V(q) \\int_{0}^{1} d\\xi = \\nabla V(q) $$\nThe definition is consistent. This is the closed-form definition we will use. For polynomial potentials, this integral can be evaluated analytically.\n\n**2. Construction of the Energy-Preserving Integrator**\n\nWe seek a one-step, second-order accurate, time-reversible update scheme. The class of integrators known as the Störmer-Verlet or Newmark family provides a basis. We use a specific implicit form, often called the average velocity method or a Gonzalez integrator, which is known to be energy-preserving when paired with a discrete gradient. Let the time step be $\\Delta t = t_{k+1} - t_k$. The integrator is defined by the following system of equations for the state $(q_{k+1}, v_{k+1})$ given $(q_k, v_k)$:\n\n1.  **Position Update:** This is a midpoint rule for the position:\n    $$ \\frac{q_{k+1} - q_k}{\\Delta t} = \\frac{v_{k+1} + v_k}{2} $$\n2.  **Momentum Update:** This discretizes Newton's second law using the discrete gradient for the force term:\n    $$ M \\frac{v_{k+1} - v_k}{\\Delta t} = - \\bar{\\nabla} V(q_k, q_{k+1}) $$\n\nThis system is implicit because $\\bar{\\nabla} V$ depends on the unknown $q_{k+1}$, and the first equation couples $q_{k+1}$ and $v_{k+1}$. It must be solved (usually by a nonlinear solver like Newton's method) at each time step to find $(q_{k+1}, v_{k+1})$. The method is time-reversible by construction, as shown by swapping indices $k \\leftrightarrow k+1$, replacing $\\Delta t \\to -\\Delta t$, and $v \\to -v$, which recovers the original equations.\n\n**3. Proof of Energy Preservation and Second-Order Accuracy**\n\n**Energy Preservation:**\nWe must prove that the discrete total energy $H(q_k, v_k) = \\frac{1}{2} v_k^{\\top} M v_k + V(q_k)$ is exactly conserved, i.e., $H(q_{k+1}, v_{k+1}) = H(q_k, v_k)$.\nThe change in energy is:\n$$ H_{k+1} - H_k = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} + V(q_{k+1})\\right) - \\left(\\frac{1}{2} v_k^{\\top} M v_k + V(q_k)\\right) $$\n$$ = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k\\right) + \\left(V(q_{k+1}) - V(q_k)\\right) $$\nLet's analyze the kinetic energy term first. Using the identity $a^{\\top}Ma - b^{\\top}Mb = (a-b)^{\\top}M(a+b)/2 + (a+b)^{\\top}M(a-b)/2$, and since $M$ is symmetric:\n$$ \\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k = \\frac{1}{2} (v_{k+1} - v_k)^{\\top} M (v_{k+1} + v_k) $$\nFrom the integrator equations, we substitute expressions for $(v_{k+1} - v_k)$ and $(v_{k+1} + v_k)$:\n-   From the momentum update: $v_{k+1} - v_k = -\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})$\n-   From the position update: $v_{k+1} + v_k = \\frac{2}{\\Delta t} (q_{k+1} - q_k)$\n\nSubstituting these into the kinetic energy change:\n$$ \\frac{1}{2} \\left(-\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})\\right)^{\\top} M \\left(\\frac{2}{\\Delta t} (q_{k+1} - q_k)\\right) $$\n$$ = \\frac{1}{2} (-\\Delta t) (\\bar{\\nabla} V)^{\\top} (M^{-1})^{\\top} M \\frac{2}{\\Delta t} (q_{k+1} - q_k) $$\nSince $M$ is symmetric, $M^{-1}$ is also symmetric, so $(M^{-1})^{\\top} = M^{-1}$.\n$$ = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} M^{-1} M (q_{k+1} - q_k) = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} (q_{k+1} - q_k) $$\nNow, consider the potential energy change, $V(q_{k+1}) - V(q_k)$. By the defining property of the discrete gradient (the discrete chain rule):\n$$ V(q_{k+1}) - V(q_k) = \\bar{\\nabla} V(q_k, q_{k+1})^{\\top} (q_{k+1} - q_k) $$\nCombining the changes in kinetic and potential energy:\n$$ H_{k+1} - H_k = \\left(- \\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) + \\left(\\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) = 0 $$\nThus, $H_{k+1} = H_k$, and the method exactly preserves the discrete total energy.\n\n**Second-Order Accuracy:**\nTo prove second-order accuracy, we analyze the local truncation error by substituting the exact solution $q(t)$ into the discrete equations. Let $q_k = q(t_k)$ and $v_k = \\dot{q}(t_k)$.\nThe truncation error for the position update is $\\tau_q$:\n$$ \\tau_q = \\frac{q(t_k+\\Delta t) - q(t_k)}{\\Delta t} - \\frac{\\dot{q}(t_k+\\Delta t) + \\dot{q}(t_k)}{2} $$\nExpanding $q(t_k+\\Delta t)$ and $\\dot{q}(t_k+\\Delta t)$ in Taylor series around $t_k$:\n$$ q(t_k+\\Delta t) = q_k + \\dot{q}_k \\Delta t + \\frac{1}{2} \\ddot{q}_k \\Delta t^2 + \\frac{1}{6} \\dddot{q}_k \\Delta t^3 + O(\\Delta t^4) $$\n$$ \\dot{q}(t_k+\\Delta t) = \\dot{q}_k + \\ddot{q}_k \\Delta t + \\frac{1}{2} \\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) $$\nSubstituting these into $\\tau_q$:\n$$ \\tau_q = \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{6} \\dddot{q}_k \\Delta t^2\\right) - \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{4} \\dddot{q}_k \\Delta t^2\\right) + O(\\Delta t^3) $$\n$$ \\tau_q = -\\frac{1}{12}\\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) = O(\\Delta t^2) $$\nThe truncation error for the momentum update is $\\tau_v$:\n$$ \\tau_v = M \\frac{\\dot{q}(t_k+\\Delta t) - \\dot{q}(t_k)}{\\Delta t} + \\bar{\\nabla} V(q(t_k), q(t_k+\\Delta t)) $$\nWe expand both terms around $t_k$.\n$$ M\\frac{\\dot{q}_{k+1}-\\dot{q}_k}{\\Delta t} = M(\\ddot{q}_k + \\frac{1}{2}\\dddot{q}_k \\Delta t + O(\\Delta t^2)) $$\nFor the discrete gradient, we expand around $q_k$:\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 \\nabla V(q_k + \\xi(q_{k+1}-q_k)) d\\xi $$\n$$ q_{k+1}-q_k = \\dot{q}_k \\Delta t + O(\\Delta t^2) $$\n$$ \\bar{\\nabla} V = \\int_0^1 \\left(\\nabla V(q_k) + \\xi \\nabla^2 V(q_k)(q_{k+1}-q_k) + O(\\Delta t^2)\\right) d\\xi $$\n$$ = \\nabla V(q_k) + \\frac{1}{2} \\nabla^2 V(q_k)(\\dot{q}_k \\Delta t) + O(\\Delta t^2) $$\nSubstituting these expansions into $\\tau_v$:\n$$ \\tau_v = \\left(M\\ddot{q}_k + \\frac{1}{2}M\\dddot{q}_k \\Delta t\\right) + \\left(\\nabla V(q_k) + \\frac{1}{2}\\nabla^2 V(q_k)\\dot{q}_k \\Delta t\\right) + O(\\Delta t^2) $$\n$$ = (M\\ddot{q}_k + \\nabla V(q_k)) + \\frac{\\Delta t}{2} (M\\dddot{q}_k + \\nabla^2 V(q_k)\\dot{q}_k) + O(\\Delta t^2) $$\nThe exact solution satisfies $M\\ddot{q} + \\nabla V(q) = 0$. Differentiating this with respect to time gives $M\\dddot{q} + \\nabla^2 V(q)\\dot{q} = 0$. Therefore, both the $O(1)$ and $O(\\Delta t)$ terms in the expression for $\\tau_v$ are zero. This means $\\tau_v = O(\\Delta t^2)$.\nSince the local truncation errors for both defining equations are $O(\\Delta t^2)$, the method is second-order accurate.\n\n**4. Evaluation of the Discrete Gradient**\n\nWe are given a one-dimensional system ($n=1$) with mass $M=1$ and potential $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$. The continuous gradient is $\\nabla V(q) = V'(q) = \\frac{4}{3} q^3 + \\frac{2}{3} q$. We need to evaluate the discrete gradient $\\bar{\\nabla} V(q_k, q_{k+1})$ for $q_k=1$ and $q_{k+1}=2$.\n\nUsing the mean value discrete gradient definition:\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 V'((1-\\xi)q_k + \\xi q_{k+1}) d\\xi $$\nSubstitute $q_k=1$ and $q_{k+1}=2$. The argument of $V'$ is $(1-\\xi) \\cdot 1 + \\xi \\cdot 2 = 1 - \\xi + 2\\xi = 1 + \\xi$.\n$$ \\bar{\\nabla} V(1, 2) = \\int_0^1 V'(1+\\xi) d\\xi = \\int_0^1 \\left(\\frac{4}{3}(1+\\xi)^3 + \\frac{2}{3}(1+\\xi)\\right) d\\xi $$\nWe perform the definite integration:\n$$ \\bar{\\nabla} V(1, 2) = \\left[ \\frac{4}{3} \\frac{(1+\\xi)^4}{4} + \\frac{2}{3} \\frac{(1+\\xi)^2}{2} \\right]_0^1 $$\n$$ = \\left[ \\frac{1}{3}(1+\\xi)^4 + \\frac{1}{3}(1+\\xi)^2 \\right]_0^1 $$\nEvaluate at the upper limit ($\\xi=1$):\n$$ \\frac{1}{3}(1+1)^4 + \\frac{1}{3}(1+1)^2 = \\frac{1}{3}(2)^4 + \\frac{1}{3}(2)^2 = \\frac{16}{3} + \\frac{4}{3} = \\frac{20}{3} $$\nEvaluate at the lower limit ($\\xi=0$):\n$$ \\frac{1}{3}(1+0)^4 + \\frac{1}{3}(1+0)^2 = \\frac{1}{3}(1)^4 + \\frac{1}{3}(1)^2 = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3} $$\nThe value of the integral is the difference:\n$$ \\bar{\\nabla} V(1, 2) = \\frac{20}{3} - \\frac{2}{3} = \\frac{18}{3} = 6 $$\nThe value of the discrete gradient is $6$.",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "The energy-preserving integrators we study are typically implicit, meaning they require solving a system of nonlinear algebraic equations at each time step. A robust and efficient way to do this is with the Newton-Raphson method, which in turn requires the derivative of the discrete force terms—the algorithmic tangent stiffness . This practice focuses on deriving this essential component for a nonlinear oscillator, connecting the stability of the numerical solver to the physical properties of the system's potential energy.",
            "id": "3562051",
            "problem": "Consider a single-degree-of-freedom conservative nonlinear elastic oscillator with generalized coordinate $q$, mass $m$, and stored energy (potential) $V(q)$ given by $V(q)=\\tfrac{1}{2} k q^{2}+\\tfrac{1}{4} \\beta q^{4}$, where $k \\ge 0$ and $\\beta \\ge 0$. There are no external forces. The governing equation of motion follows from Hamilton’s principle as $m \\ddot{q} + \\partial V/\\partial q = 0$. We seek a time-stepping scheme of step size $\\Delta t$ that preserves both total linear momentum and total mechanical energy at the discrete level. Use mid-point kinematics for the inertial term and enforce the exact discrete energy balance over a time step, consistent with energy-momentum conserving time integration in computational solid mechanics.\n\nStarting from these principles and without using any pre-given discrete force formulae, perform the following:\n\n- Derive the discrete internal force $f_{\\text{int}}^{\\text{alg}}(q_{k},q_{k+1})$ by imposing the exact discrete energy balance over the time step $[t_{k},t_{k+1}]$.\n- Construct the algorithmic tangent $K_{\\text{alg}}=\\partial f_{\\text{int}}^{\\text{alg}}/\\partial q_{k+1}$ needed for Newton iterations, expressed in closed form in terms of $k$, $\\beta$, $q_{k}$, and $q_{k+1}$.\n- Briefly discuss the symmetry and positive definiteness properties of $K_{\\text{alg}}$ for this model, relating them to the convexity of $V$.\n\nYour final answer must be the explicit closed-form analytic expression for $K_{\\text{alg}}(q_{k},q_{k+1})$ in terms of $k$, $\\beta$, $q_{k}$, and $q_{k+1}$. Do not include units in the final answer. No numerical rounding is required.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution within the framework of computational solid mechanics. It presents a standard, non-trivial derivation for a foundational energy-momentum conserving algorithm.\n\nThe system is a single-degree-of-freedom conservative oscillator with generalized coordinate $q$, mass $m$, and potential energy $V(q)$. The equation of motion is $m\\ddot{q} + f_{\\text{int}}(q) = 0$, where the continuous internal force is $f_{\\text{int}}(q) = \\partial V/\\partial q$. The total mechanical energy is $E = T+V = \\frac{1}{2}m\\dot{q}^2 + V(q)$.\n\nWe seek a discrete time-stepping algorithm that conserves energy exactly. We use a mid-point rule framework for the dynamics over a time step $[t_k, t_{k+1}]$ of duration $\\Delta t = t_{k+1}-t_k$. Let $q_k = q(t_k)$ and $p_k = m\\dot{q}(t_k)$ be the coordinate and linear momentum at time $t_k$.\n\nThe discrete updates for position and momentum are given by:\n1. A centered update for position, consistent with \"mid-point kinematics\":\n$$ \\frac{q_{k+1} - q_k}{\\Delta t} = \\frac{\\dot{q}_{k+1} + \\dot{q}_k}{2} = \\frac{p_{k+1} + p_k}{2m} $$\n2. A discrete version of Newton's second law, which defines the discrete algorithmic internal force, $f_{\\text{int}}^{\\text{alg}}$:\n$$ \\frac{p_{k+1} - p_k}{\\Delta t} = -f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) $$\nThis formulation ensures discrete conservation of linear momentum.\n\nTo ensure discrete energy conservation, the work done by the algorithmic force over the step must precisely balance the change in potential energy, i.e., $\\Delta T + \\Delta V = 0$. The change in kinetic energy is:\n$$ \\Delta T = T_{k+1} - T_k = \\frac{p_{k+1}^2}{2m} - \\frac{p_k^2}{2m} = \\frac{1}{2m}(p_{k+1} - p_k)(p_{k+1} + p_k) $$\nFrom the discrete kinematic and dynamic equations above, we can substitute for the terms $p_{k+1} - p_k$ and $p_{k+1} + p_k$:\n$$ p_{k+1} - p_k = -\\Delta t f_{\\text{int}}^{\\text{alg}} $$\n$$ p_{k+1} + p_k = \\frac{2m}{\\Delta t}(q_{k+1} - q_k) $$\nSubstituting these into the expression for $\\Delta T$:\n$$ \\Delta T = \\frac{1}{2m} (-\\Delta t f_{\\text{int}}^{\\text{alg}}) \\left( \\frac{2m}{\\Delta t}(q_{k+1} - q_k) \\right) = -f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) (q_{k+1} - q_k) $$\nThe change in kinetic energy is equal to the work done by the algorithmic internal force. The total energy conservation requirement $\\Delta T + \\Delta V = 0$ then becomes:\n$$ -f_{\\text{int}}^{\\text{alg}}(q_{k+1} - q_k) + (V(q_{k+1}) - V(q_k)) = 0 $$\nThis gives the fundamental defining equation for the energy-conserving algorithmic force.\n\n**Derivation of the Discrete Internal Force $f_{\\text{int}}^{\\text{alg}}$**\nFrom the discrete energy balance, assuming $q_{k+1} \\neq q_k$, we have:\n$$ f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) = \\frac{V(q_{k+1}) - V(q_k)}{q_{k+1} - q_k} $$\nIf $q_{k+1} = q_k$, the force is recovered in the limit as the continuous force, $f_{\\text{int}}(q_k) = V'(q_k)$.\nThe given potential is $V(q) = \\frac{1}{2} k q^{2} + \\frac{1}{4} \\beta q^{4}$.\nThe change in potential energy is:\n$$ V(q_{k+1}) - V(q_k) = \\left(\\frac{1}{2} k q_{k+1}^{2} + \\frac{1}{4} \\beta q_{k+1}^{4}\\right) - \\left(\\frac{1}{2} k q_k^{2} + \\frac{1}{4} \\beta q_k^{4}\\right) $$\n$$ = \\frac{1}{2} k (q_{k+1}^{2} - q_k^{2}) + \\frac{1}{4} \\beta (q_{k+1}^{4} - q_k^{4}) $$\nUsing the algebraic identities $a^2-b^2=(a-b)(a+b)$ and $a^4-b^4=(a-b)(a+b)(a^2+b^2)$:\n$$ V(q_{k+1}) - V(q_k) = \\frac{1}{2} k (q_{k+1} - q_k)(q_{k+1} + q_k) + \\frac{1}{4} \\beta (q_{k+1} - q_k)(q_{k+1} + q_k)(q_{k+1}^{2} + q_k^{2}) $$\nDividing by $(q_{k+1} - q_k)$ yields the algorithmic internal force:\n$$ f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1}) = \\frac{1}{2} k (q_k + q_{k+1}) + \\frac{1}{4} \\beta (q_k + q_{k+1})(q_k^2 + q_{k+1}^2) $$\n\n**Construction of the Algorithmic Tangent $K_{\\text{alg}}$**\nThe algorithmic tangent $K_{\\text{alg}}$ is required for solving the nonlinear algebraic equations of the time step using a Newton-Raphson method. It is defined as the derivative of the algorithmic force with respect to the end-of-step coordinate, $q_{k+1}$:\n$$ K_{\\text{alg}}(q_k, q_{k+1}) = \\frac{\\partial f_{\\text{int}}^{\\text{alg}}(q_k, q_{k+1})}{\\partial q_{k+1}} $$\nTo compute this, we differentiate our expression for $f_{\\text{int}}^{\\text{alg}}$ with respect to $q_{k+1}$, treating $q_k$ as a constant.\nLet's expand the term $(q_k + q_{k+1})(q_k^2 + q_{k+1}^2) = q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3$.\nSo, $f_{\\text{int}}^{\\text{alg}} = \\frac{k}{2}(q_k + q_{k+1}) + \\frac{\\beta}{4}(q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3)$.\nNow, we differentiate term by term:\n$$ \\frac{\\partial}{\\partial q_{k+1}} \\left[ \\frac{k}{2}(q_k + q_{k+1}) \\right] = \\frac{k}{2} $$\n$$ \\frac{\\partial}{\\partial q_{k+1}} \\left[ \\frac{\\beta}{4}(q_k^3 + q_k q_{k+1}^2 + q_{k+1} q_k^2 + q_{k+1}^3) \\right] = \\frac{\\beta}{4} (0 + 2q_k q_{k+1} + q_k^2 + 3q_{k+1}^2) $$\nCombining these results gives the algorithmic tangent:\n$$ K_{\\text{alg}} = \\frac{k}{2} + \\frac{\\beta}{4}(q_k^2 + 2q_k q_{k+1} + 3q_{k+1}^2) $$\n\n**Discussion of Symmetry and Positive Definiteness**\nFor a single-degree-of-freedom system, the algorithmic tangent $K_{\\text{alg}}$ is a scalar. As such, the property of symmetry is trivial. In a multi-DOF setting, the symmetry of the algorithmic tangent stiffness matrix is a desirable property for computational efficiency, and it holds if the algorithmic forces are derivable from a discrete potential, which is true for this class of integrators.\n\nFor positive definiteness, we must check if $K_{\\text{alg}} > 0$. We are given $k \\ge 0$ and $\\beta \\ge 0$.\nThe term involving $\\beta$ contains the quadratic expression $Q(q_k, q_{k+1}) = q_k^2 + 2q_k q_{k+1} + 3q_{k+1}^2$. We can analyze its sign by completing the square:\n$$ Q(q_k, q_{k+1}) = (q_k^2 + 2q_k q_{k+1} + q_{k+1}^2) + 2q_{k+1}^2 = (q_k + q_{k+1})^2 + 2q_{k+1}^2 $$\nSince $(q_k + q_{k+1})^2 \\ge 0$ and $2q_{k+1}^2 \\ge 0$, their sum $Q$ is always non-negative. $Q=0$ if and only if $q_{k+1}=0$ and $q_k+q_{k+1}=0$, which implies $q_k=q_{k+1}=0$.\nThus, $K_{\\text{alg}} = \\frac{k}{2} + \\frac{\\beta}{4}((q_k + q_{k+1})^2 + 2q_{k+1}^2) \\ge 0$.\nIf $k>0$, then $K_{\\text{alg}} > 0$ for all $q_k, q_{k+1}$. If $k=0$ and $\\beta>0$, $K_{\\text{alg}} > 0$ unless $q_k=q_{k+1}=0$. The algorithmic tangent is positive semi-definite, and generally positive definite away from the trivial state.\n\nThis property is directly related to the convexity of the potential $V(q)$. A function is convex if its second derivative is non-negative. For our potential, $V(q) = \\frac{1}{2} k q^2 + \\frac{1}{4} \\beta q^4$, the second derivative is:\n$$ V''(q) = \\frac{\\partial^2 V}{\\partial q^2} = k + 3\\beta q^2 $$\nGiven $k \\ge 0$ and $\\beta \\ge 0$, it is clear that $V''(q) \\ge 0$ for all $q$. Therefore, the potential function $V(q)$ is convex. The positive definiteness of the algorithmic tangent for this class of energy-conserving schemes is a direct consequence of the convexity of the underlying potential energy function. This ensures that the Newton-Raphson iterations to solve for $q_{k+1}$ are solving a convex optimization problem, which guarantees a unique solution and robust convergence.",
            "answer": "$$\n\\boxed{\\frac{k}{2} + \\frac{\\beta}{4}(q_{k}^{2} + 2q_{k}q_{k+1} + 3q_{k+1}^{2})}\n$$"
        },
        {
            "introduction": "Translating a theoretically perfect conservative algorithm from paper to a real-world finite element code is fraught with potential pitfalls that can silently break the desired conservation properties. This diagnostic exercise challenges you to act as a computational detective, identifying common but critical implementation mistakes that lead to a loss of energy and momentum conservation in a finite-strain simulation . Mastering this skill is essential for developing reliable and physically faithful simulation tools.",
            "id": "3562042",
            "problem": "Consider a finite-strain hyperelastic solid discretized by the finite element method (FEM), leading to the semi-discrete equations of motion\n$$\n\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\mathbf{f}_{\\text{int}}(\\mathbf{q}) = \\mathbf{0},\n$$\nwhere $\\mathbf{q}$ collects the nodal positions, $\\mathbf{M}(\\mathbf{q})$ is the (possibly configuration-dependent) mass matrix assembled from element contributions, and $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ is the internal force vector. For a closed system with no external loads and no constraints, the exact solution conserves total linear momentum\n$$\n\\mathbf{P} = \\mathbf{M}(\\mathbf{q})\\,\\dot{\\mathbf{q}},\n$$\nand total mechanical energy\n$$\nE(\\mathbf{q},\\dot{\\mathbf{q}}) = \\tfrac{1}{2}\\,\\dot{\\mathbf{q}}^{\\mathsf{T}} \\mathbf{M}(\\mathbf{q}) \\dot{\\mathbf{q}} + U(\\mathbf{q}),\n$$\nwhere $U(\\mathbf{q})$ is the discretized internal energy derived from a hyperelastic stored-energy density. Energy-momentum conserving time integrators can be derived from a discrete variational principle; when the discrete Lagrangian has the required symmetries (time-translation and space-translation/rotation invariance), the resulting method exactly preserves the corresponding discrete invariants up to the nonlinear solve tolerance.\n\nA developer implements an energy-momentum conserving midpoint-type scheme for the above semi-discrete system in the absence of external loads, damping, and constraints. Despite using a small uniform time step $h$, the developer observes a monotonic drift of total mechanical energy and a slow growth of total linear momentum. The following implementation details are confirmed:\n\n- Internal forces are assembled with $1$-point Gauss quadrature for $8$-node trilinear hexahedra to save cost, while the mass matrix uses full $2\\times 2\\times 2$ Gauss quadrature.\n- The Cauchy stress is updated with an objective co-rotational (Jaumann-rate-based) algorithm not explicitly derived as the gradient of a stored-energy function with respect to strain measures.\n- The configuration update uses the midpoint rule for $\\mathbf{q}$, but the velocity update uses forward Euler for $\\dot{\\mathbf{q}}$ within each time step.\n- The Newton–Raphson solver stops when the relative residual norm is below $10^{-3}$ each step.\n\nAssume periodic boundaries are used so that no external reactions appear, and there is no artificial damping.\n\nWhich of the following options correctly identify a specific implementation mistake that breaks energy and/or momentum conservation, together with an appropriate diagnostic and a correction that would restore the invariants to within solver tolerance? Select all that apply.\n\nA. Mistake: Using $1$-point quadrature for $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ but full $2\\times 2\\times 2$ quadrature for $\\mathbf{M}(\\mathbf{q})$ destroys discrete work-conjugacy and the exact null-space property of internal forces under rigid-body motion. Diagnostic: Run a rigid-body translation/rotation test and verify that the assembled internal force resultant $\\sum_{a} \\mathbf{f}_{\\text{int},a}$ is exactly $\\mathbf{0}$ and that $E$ is constant to machine precision. Correction: Assemble both $\\mathbf{M}(\\mathbf{q})$ and $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ from the same discrete Lagrangian with consistent quadrature, or use matching reduced integration and stabilization so that discrete rigid modes do no internal work.\n\nB. Mistake: Using an objective Jaumann-rate stress update that is not the gradient of a stored-energy function violates hyperelasticity at the algorithmic level, breaking the potential structure required by the variational integrator. Diagnostic: Check that the algorithmic tangent is symmetric and that the internal forces are the exact gradient of a discretized potential $U(\\mathbf{q})$ evaluated at the time step’s work-conjugate configuration; also verify path independence of $U$. Correction: Compute stresses and internal forces from a hyperelastic stored-energy density evaluated at the midpoint configuration and assemble $\\mathbf{f}_{\\text{int}}$ as $\\partial U/\\partial \\mathbf{q}$ with the consistent algorithmic tangent.\n\nC. Mistake: None; any observed drift is unrelated to the nonlinear solver tolerance. Diagnostic: None required. Correction: None; energy-momentum conservation should hold regardless of Newton tolerance provided the scheme is nominally conservative.\n\nD. Mistake: Updating $\\dot{\\mathbf{q}}$ with forward Euler while updating $\\mathbf{q}$ with the midpoint rule breaks the discrete variational structure and destroys the exact cancellation in the stepwise energy balance. Diagnostic: Compare the discrete energy increment $\\Delta E$ against the computed internal work over a step; a systematic nonzero defect indicates violation of the midpoint work-conjugacy. Correction: Update momenta with the midpoint rule so that both $\\mathbf{q}$ and $\\dot{\\mathbf{q}}$ are advanced consistently with the energy-momentum scheme.\n\nE. Mistake: Lack of numerical damping. Diagnostic: Observe that adding small Rayleigh damping reduces the energy drift to a plateau. Correction: Add small mass-proportional and stiffness-proportional damping to remove drift while preserving momentum and energy conservation properties.",
            "solution": "The problem statement is critically evaluated for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n-   **Governing Equation:** The semi-discrete equations of motion for a finite-strain hyperelastic solid are given as $\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\mathbf{f}_{\\text{int}}(\\mathbf{q}) = \\mathbf{0}$.\n-   **Variables:** $\\mathbf{q}$ is the vector of nodal positions, $\\mathbf{M}(\\mathbf{q})$ is the configuration-dependent mass matrix, and $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ is the internal force vector.\n-   **System Conditions:** The system is closed, with no external loads, no constraints, and no artificial damping. Periodic boundaries are used.\n-   **Conserved Quantities (Exact):** Total linear momentum $\\mathbf{P} = \\mathbf{M}(\\mathbf{q})\\,\\dot{\\mathbf{q}}$ and total mechanical energy $E(\\mathbf{q},\\dot{\\mathbf{q}}) = \\tfrac{1}{2}\\,\\dot{\\mathbf{q}}^{\\mathsf{T}} \\mathbf{M}(\\mathbf{q}) \\dot{\\mathbf{q}} + U(\\mathbf{q})$, where $U(\\mathbf{q})$ is the discretized internal energy.\n-   **Numerical Method:** An energy-momentum conserving midpoint-type scheme is intended.\n-   **Observation:** A monotonic drift of total mechanical energy and a slow growth of total linear momentum are observed with a small uniform time step $h$.\n-   **Implementation Details:**\n    1.  The internal force vector $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ is assembled using $1$-point Gauss quadrature for $8$-node trilinear hexahedra, while the mass matrix $\\mathbf{M}(\\mathbf{q})$ uses full $2\\times 2\\times 2$ Gauss quadrature.\n    2.  The Cauchy stress is updated via a co-rotational Jaumann-rate-based algorithm not derived from a stored-energy function.\n    3.  The configuration update for $\\mathbf{q}$ uses the midpoint rule, but the velocity update for $\\dot{\\mathbf{q}}$ uses forward Euler within each time step.\n    4.  The Newton–Raphson solver tolerance is a relative residual norm below $10^{-3}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically sound, well-posed, and objective. It is firmly grounded in the well-established field of computational solid mechanics, particularly the theory and practice of numerical integrators for nonlinear dynamics. All concepts—the finite element method (FEM), hyperelasticity, energy-momentum conservation, variational integrators, Gauss quadrature, and constitutive updates—are standard in this domain. The problem poses a realistic diagnostic challenge: identifying flaws in a numerical implementation that cause it to violate theoretical conservation properties. The provided details describe common and critical implementation mistakes. The problem is self-contained, and its terms are defined with sufficient precision for analysis. There are no contradictions, pseudoscientific claims, or subjective elements.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived by analyzing the provided implementation details against the principles of energy-momentum conserving integrators.\n\n### Solution Derivation\n\nAn energy-momentum conserving integrator for the equation $\\mathbf{M}(\\mathbf{q})\\,\\ddot{\\mathbf{q}} + \\nabla U(\\mathbf{q}) = \\mathbf{0}$ is derived from a discrete variational principle. The resulting discrete equations of motion are constructed to exactly preserve discrete analogs of energy and momentum, which are conserved in the continuous system due to time-translation and space-translation invariance of the Lagrangian, respectively (Noether's theorem). The observed drift in energy and momentum indicates that one or more of these required symmetries or structures have been broken at the implementation level. We analyze each of the reported implementation details.\n\n1.  **Quadrature Mismatch:** Momentum conservation stems from the invariance of the discrete Lagrangian to rigid-body translations. This requires that the potential energy $U(\\mathbf{q})$ be invariant and, consequently, that the internal forces $\\mathbf{f}_{\\text{int}} = -\\nabla U(\\mathbf{q})$ sum to zero and produce zero net torque for any rigid-body motion. These forces are computed via numerical quadrature over the elements. The mass matrix $\\mathbf{M}(\\mathbf{q})$, which defines the kinetic energy, is also computed via quadrature. If the quadrature rule for $\\mathbf{f}_{\\text{int}}$ (derived from $U(\\mathbf{q})$) is different from the rule for $\\mathbf{M}(\\mathbf{q})$, the discrete symmetries can be broken. Using $1$-point quadrature for the stiffness term and $2\\times 2\\times 2$ quadrature for the mass term creates an inconsistency. $1$-point quadrature for $8$-node hexahedra is known to introduce spurious zero-energy (\"hourglass\") modes. While the internal forces corresponding to these modes are zero, the mass matrix (using full quadrature) will associate kinetic energy with them. If these modes are excited, momentum and energy can be generated spuriously, leading to drift. This violates the required consistency for a discrete variational formulation.\n\n2.  **Non-conservative Constitutive Law:** Energy conservation in a variational integrator is predicated on the existence of a potential energy function $U(\\mathbf{q})$ such that the internal forces are its negative gradient, $\\mathbf{f}_{\\text{int}}(\\mathbf{q}) = -\\nabla U(\\mathbf{q})$. This condition is met if the material is hyperelastic, meaning its stress response is derivable from a stored-energy density function $W$. A Jaumann-rate-based objective stress update is a hypoelastic, not hyperelastic, constitutive law. Integrating such a rate-form law over a finite deformation path generally results in path-dependent work; the work done in a closed deformation cycle is non-zero. This means there is no underlying potential energy function $U(\\mathbf{q})$. Implementing such a law breaks the fundamental assumption of the energy-conserving scheme, which will then inevitably fail to conserve energy, leading to the observed monotonic drift.\n\n3.  **Inconsistent Time Integration Scheme:** A midpoint-type energy-momentum scheme is a specific, carefully constructed algorithm, typically implicit. For example, a standard midpoint rule solves for states at time $t_{n+1}$ using forces evaluated at the midpoint configuration $\\mathbf{q}_{n+1/2} = (\\mathbf{q}_n + \\mathbf{q}_{n+1})/2$. The updates for position and momentum are coupled, e.g., $\\mathbf{p}_{n+1} - \\mathbf{p}_n = -h \\mathbf{f}_{\\text{int}}(\\mathbf{q}_{n+1/2})$ and $\\mathbf{q}_{n+1} - \\mathbf{q}_n = h \\dot{\\mathbf{q}}_{n+1/2}$. Using a midpoint rule for position update but a forward Euler method for velocity update (e.g., $\\dot{\\mathbf{q}}_{n+1} = \\dot{\\mathbf{q}}_n + h \\ddot{\\mathbf{q}}_n$) constitutes a hybrid scheme that does not correspond to the discrete Euler-Lagrange equations of a single discrete Lagrangian. The forward Euler method is explicit and dissipative (or unstable), and its inclusion breaks the time-reversibility and symplectic structure of the midpoint rule, which are essential for long-term energy conservation. The precise cancellation of terms in the discrete energy balance proof will no longer hold.\n\n4.  **Solver Tolerance:** Conservation holds \"up to the nonlinear solve tolerance.\" A loose tolerance of $10^{-3}$ means the discrete equations of motion are not being solved accurately at each step. This necessarily introduces an error in the conserved quantities at every time step. These errors can accumulate, leading to drift. While this is a contributing factor, the other three points are fundamental structural flaws in the algorithm's formulation, which would cause drift even with a very tight tolerance.\n\n### Option-by-Option Analysis\n\n**A. Mistake: Using $1$-point quadrature for $\\mathbf{f}_{\\text{int}}(\\mathbf{q})$ but full $2\\times 2\\times 2$ quadrature for $\\mathbf{M}(\\mathbf{q})$...**\nThis option correctly identifies the issue with quadrature mismatch as discussed in point (1) above. Inconsistent quadrature breaks the discrete symmetries of the Lagrangian, which are necessary for momentum conservation. The terms \"discrete work-conjugacy\" and \"null-space property\" are appropriate. The diagnostic, a rigid-body motion test, is the standard procedure to check for violations of momentum conservation. The correction, using consistent quadrature or a properly stabilized reduced integration scheme, is the correct remedy.\n**Verdict: Correct**\n\n**B. Mistake: Using an objective Jaumann-rate stress update that is not the gradient of a stored-energy function...**\nThis option correctly identifies the issue with using a non-conservative constitutive model, as discussed in point (2). A variational integrator's energy conservation property is contingent on the mechanical system being potential-based (hyperelastic). Using a hypoelastic law violates this core requirement. The diagnostic of checking for a symmetric tangent and path independence is correct, as is the correction of using a proper hyperelastic model where forces are derived from a stored-energy function.\n**Verdict: Correct**\n\n**C. Mistake: None; any observed drift is unrelated to the nonlinear solver tolerance...**\nThis option is incorrect on two counts. First, it claims there is no mistake, but details (1), (2), and (3) are all severe implementation mistakes. Second, it claims drift is unrelated to solver tolerance. As noted in the problem statement itself and in point (4) of our analysis, the accuracy of conservation is directly limited by the nonlinear solver tolerance. A loose tolerance of $10^{-3}$ will certainly lead to inaccuracies that accumulate as drift. Thus, the premise of this option is false.\n**Verdict: Incorrect**\n\n**D. Mistake: Updating $\\dot{\\mathbf{q}}$ with forward Euler while updating $\\mathbf{q}$ with the midpoint rule...**\nThis option correctly identifies the flaw of mixing integration schemes, as discussed in point (3). This \"ad-hoc\" combination breaks the discrete variational structure that is the very foundation of the integrator's conservation properties. The energy balance, which relies on the specific symmetric structure of the midpoint updates for both position and momentum, is violated. The suggested diagnostic correctly targets the symptom of this violation (a defect in the discrete work-energy balance). The correction, using a consistent midpoint update for momenta as well, is the proper fix.\n**Verdict: Correct**\n\n**E. Mistake: Lack of numerical damping...**\nThis option fundamentally newpage\n the problem. The goal is to achieve energy and momentum *conservation*, not dissipation. The observed drift is a numerical artifact from a flawed implementation, not a physical phenomenon to be damped out. Adding damping (e.g., Rayleigh damping) is a method to *intentionally remove* energy from a system. The statement that adding damping \"preserves\" energy and momentum conservation properties is a contradiction in terms. Damping, by definition, makes the system non-conservative with respect to energy.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{ABD}$$"
        }
    ]
}