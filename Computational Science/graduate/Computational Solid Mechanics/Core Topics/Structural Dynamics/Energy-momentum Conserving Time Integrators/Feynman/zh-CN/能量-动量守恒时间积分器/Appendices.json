{
    "hands_on_practices": [
        {
            "introduction": "几何积分方法的核心思想是用离散的模拟量来代替连续的物理原理，其中“离散梯度”是实现能量守恒的关键工具。这项练习将指导您从离散梯度的概念出发，完成推导一个能量保持积分器的基本步骤。这有助于您巩固理解和创建此类积分器所需的理论基础。",
            "id": "3562093",
            "problem": "考虑一个有限维保守力学系统，其广义坐标为 $q \\in \\mathbb{R}^{n}$，质量矩阵 $M \\in \\mathbb{R}^{n \\times n}$ 为对称正定矩阵，势能 $V:\\mathbb{R}^{n} \\to \\mathbb{R}$ 为光滑函数。该系统的运动由二阶常微分方程 $M \\ddot{q} + \\nabla V(q) = 0$ 决定。连续总能量为 $H(q,\\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$，该能量沿精确轨道守恒。\n\n你的任务是：\n1. 从牛顿第二定律和总能量的定义出发，引入一个离散梯度 $\\bar{\\nabla} V(q_{k},q_{k+1})$，使其满足离散链式法则 $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k},q_{k+1})^{\\top} (q_{k+1} - q_{k})$，并且在 $\\bar{\\nabla} V(q,q) = \\nabla V(q)$ 的意义上是一致的。请以闭合形式定义一个这样的 $\\bar{\\nabla} V$。\n2. 使用该离散梯度，为 $(q_{k},v_{k})$（其中 $v_{k} \\approx \\dot{q}(t_{k})$）构建一个单步、二阶精确、时间可逆的更新格式，该格式能精确保守离散总能量 $H(q_{k},v_{k}) = \\frac{1}{2} v_{k}^{\\top} M v_{k} + V(q_{k})$。\n3. 从第一性原理证明，所构建的方法能保守离散总能量，并且在时间上是二阶精确的。你的推导过程必须明确使用离散链式法则和基于泰勒级数的局部截断误差展开。\n4. 对于一个一维系统 ($n=1$)，其中 $M = 1$ 且势能为 $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$，请计算你的离散梯度 $\\bar{\\nabla} V(q_{k},q_{k+1})$ 在 $q_{k} = 1$ 和 $q_{k+1} = 2$ 处的值。请以精确形式给出最终数值答案，不进行四舍五入，不带单位。",
            "solution": "该问题是有效的，因为它在经典力学和数值分析方面有科学依据，是适定的且信息充分，并且陈述客观。我们按顺序解决这四个任务来进行解答。\n\n所考虑的系统是一个有限维保守力学系统，其广义坐标为 $q \\in \\mathbb{R}^{n}$，质量矩阵 $M \\in \\mathbb{R}^{n \\times n}$ 为对称正定矩阵，势能函数 $V(q)$ 为光滑函数。其动力学由第二类拉格朗日方程描述，其形式为牛顿第二定律：\n$$ M \\ddot{q} + \\nabla V(q) = 0 $$\n系统的总能量 $H(q, \\dot{q}) = \\frac{1}{2} \\dot{q}^{\\top} M \\dot{q} + V(q)$ 是精确解的一个守恒量。\n\n**1. 离散梯度的定义**\n\n离散梯度，记作 $\\bar{\\nabla} V(q_{k}, q_{k+1})$，是一个向量值函数，它近似于连续梯度 $\\nabla V$，并被设计用以满足链式法则的离散模拟。所需性质如下：\n1.  **离散链式法则：** $V(q_{k+1}) - V(q_{k}) = \\bar{\\nabla} V(q_{k}, q_{k+1})^{\\top} (q_{k+1} - q_{k})$\n2.  **一致性：** $\\bar{\\nabla} V(q, q) = \\nabla V(q)$\n\n定义这种梯度的一种通用且强大的方法是通过中值定理，从而得到**中值离散梯度**：\n$$ \\bar{\\nabla} V(q_{a}, q_{b}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi $$\n让我们验证该定义是否满足所需性质。\n对于离散链式法则，考虑参数化线段 $q(\\xi) = (1 - \\xi)q_{a} + \\xi q_{b}$，其中 $\\xi \\in [0, 1]$。$q(\\xi)$ 关于 $\\xi$ 的导数为 $q'(\\xi) = q_{b} - q_{a}$。根据微积分基本定理和多元函数链式法则：\n$$ V(q_{b}) - V(q_{a}) = V(q(1)) - V(q(0)) = \\int_{0}^{1} \\frac{d}{d\\xi} V(q(\\xi)) d\\xi $$\n$$ \\frac{d}{d\\xi} V(q(\\xi)) = \\nabla V(q(\\xi))^{\\top} q'(\\xi) = \\nabla V(q(\\xi))^{\\top} (q_{b} - q_{a}) $$\n将此代入积分，得到：\n$$ V(q_{b}) - V(q_{a}) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right)^{\\top} (q_{b} - q_{a}) d\\xi $$\n由于 $(q_{b} - q_{a})$ 相对于 $\\xi$ 是常数，我们可以将其移到积分号外：\n$$ V(q_{b}) - V(q_{a}) = \\left( \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q_{a} + \\xi q_{b}\\right) d\\xi \\right)^{\\top} (q_{b} - q_{a}) $$\n这与我们定义的 $\\bar{\\nabla} V(q_{a}, q_{b})$ 所满足的离散链式法则相符。\n\n为验证一致性，我们设 $q_a = q_b = q$：\n$$ \\bar{\\nabla} V(q, q) = \\int_{0}^{1} \\nabla V\\left((1 - \\xi)q + \\xi q\\right) d\\xi = \\int_{0}^{1} \\nabla V(q) d\\xi = \\nabla V(q) \\int_{0}^{1} d\\xi = \\nabla V(q) $$\n该定义是一致的。这就是我们将使用的闭合形式定义。对于多项式势能，此积分可以解析地计算。\n\n**2. 保能积分器的构建**\n\n我们寻求一种单步、二阶精确、时间可逆的更新格式。被称为 Störmer-Verlet 或 Newmark 族的积分器为此提供了一个基础。我们使用一种特定的隐式形式，通常称为平均速度法或 Gonzalez 积分器，当与离散梯度配对使用时，这种方法以其保能性而闻名。设时间步长为 $\\Delta t = t_{k+1} - t_k$。给定状态 $(q_k, v_k)$，积分器由以下关于状态 $(q_{k+1}, v_{k+1})$ 的方程组定义：\n\n1.  **位置更新：** 这是对位置的中点法则：\n    $$ \\frac{q_{k+1} - q_k}{\\Delta t} = \\frac{v_{k+1} + v_k}{2} $$\n2.  **动量更新：** 这使用离散梯度作为力项来离散化牛顿第二定律：\n    $$ M \\frac{v_{k+1} - v_k}{\\Delta t} = - \\bar{\\nabla} V(q_k, q_{k+1}) $$\n\n这个系统是隐式的，因为 $\\bar{\\nabla} V$ 依赖于未知量 $q_{k+1}$，并且第一个方程耦合了 $q_{k+1}$ 和 $v_{k+1}$。在每个时间步，必须（通常通过像牛顿法这样的非线性求解器）求解该系统以找到 $(q_{k+1}, v_{k+1})$。该方法从其构造上就是时间可逆的，这可以通过交换下标 $k \\leftrightarrow k+1$，替换 $\\Delta t \\to -\\Delta t$ 和 $v \\to -v$ 来证明，这些操作可以恢复原始方程。\n\n**3. 保能性和二阶精确性的证明**\n\n**保能性：**\n我们必须证明离散总能量 $H(q_k, v_k) = \\frac{1}{2} v_k^{\\top} M v_k + V(q_k)$ 是精确保守的，即 $H(q_{k+1}, v_{k+1}) = H(q_k, v_k)$。\n能量的变化为：\n$$ H_{k+1} - H_k = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} + V(q_{k+1})\\right) - \\left(\\frac{1}{2} v_k^{\\top} M v_k + V(q_k)\\right) $$\n$$ = \\left(\\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k\\right) + \\left(V(q_{k+1}) - V(q_k)\\right) $$\n让我们首先分析动能项。使用恒等式 $a^{\\top}Ma - b^{\\top}Mb = (a-b)^{\\top}M(a+b)/2 + (a+b)^{\\top}M(a-b)/2$，并且由于 $M$ 是对称的：\n$$ \\frac{1}{2} v_{k+1}^{\\top} M v_{k+1} - \\frac{1}{2} v_k^{\\top} M v_k = \\frac{1}{2} (v_{k+1} - v_k)^{\\top} M (v_{k+1} + v_k) $$\n从积分器方程中，我们代入 $(v_{k+1} - v_k)$ 和 $(v_{k+1} + v_k)$ 的表达式：\n-   从动量更新： $v_{k+1} - v_k = -\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})$\n-   从位置更新： $v_{k+1} + v_k = \\frac{2}{\\Delta t} (q_{k+1} - q_k)$\n\n将这些代入动能变化中：\n$$ \\frac{1}{2} \\left(-\\Delta t M^{-1} \\bar{\\nabla} V(q_k, q_{k+1})\\right)^{\\top} M \\left(\\frac{2}{\\Delta t} (q_{k+1} - q_k)\\right) $$\n$$ = \\frac{1}{2} (-\\Delta t) (\\bar{\\nabla} V)^{\\top} (M^{-1})^{\\top} M \\frac{2}{\\Delta t} (q_{k+1} - q_k) $$\n由于 $M$ 是对称的，$M^{-1}$ 也是对称的，所以 $(M^{-1})^{\\top} = M^{-1}$。\n$$ = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} M^{-1} M (q_{k+1} - q_k) = -(\\bar{\\nabla} V(q_k, q_{k+1}))^{\\top} (q_{k+1} - q_k) $$\n现在，考虑势能变化 $V(q_{k+1}) - V(q_k)$。根据离散梯度的定义性质（离散链式法则）：\n$$ V(q_{k+1}) - V(q_k) = \\bar{\\nabla} V(q_k, q_{k+1})^{\\top} (q_{k+1} - q_k) $$\n结合动能和势能的变化：\n$$ H_{k+1} - H_k = \\left(- \\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) + \\left(\\bar{\\nabla} V^{\\top} (q_{k+1} - q_k)\\right) = 0 $$\n因此，$H_{k+1} = H_k$，该方法精确保守离散总能量。\n\n**二阶精确性：**\n为证明二阶精确性，我们通过将精确解 $q(t)$ 代入离散方程来分析局部截断误差。设 $q_k = q(t_k)$ 且 $v_k = \\dot{q}(t_k)$。\n位置更新的截断误差为 $\\tau_q$：\n$$ \\tau_q = \\frac{q(t_k+\\Delta t) - q(t_k)}{\\Delta t} - \\frac{\\dot{q}(t_k+\\Delta t) + \\dot{q}(t_k)}{2} $$\n将 $q(t_k+\\Delta t)$ 和 $\\dot{q}(t_k+\\Delta t)$ 在 $t_k$ 附近进行泰勒级数展开：\n$$ q(t_k+\\Delta t) = q_k + \\dot{q}_k \\Delta t + \\frac{1}{2} \\ddot{q}_k \\Delta t^2 + \\frac{1}{6} \\dddot{q}_k \\Delta t^3 + O(\\Delta t^4) $$\n$$ \\dot{q}(t_k+\\Delta t) = \\dot{q}_k + \\ddot{q}_k \\Delta t + \\frac{1}{2} \\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) $$\n将这些代入 $\\tau_q$：\n$$ \\tau_q = \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{6} \\dddot{q}_k \\Delta t^2\\right) - \\left(\\dot{q}_k + \\frac{1}{2} \\ddot{q}_k \\Delta t + \\frac{1}{4} \\dddot{q}_k \\Delta t^2\\right) + O(\\Delta t^3) $$\n$$ \\tau_q = -\\frac{1}{12}\\dddot{q}_k \\Delta t^2 + O(\\Delta t^3) = O(\\Delta t^2) $$\n动量更新的截断误差为 $\\tau_v$：\n$$ \\tau_v = M \\frac{\\dot{q}(t_k+\\Delta t) - \\dot{q}(t_k)}{\\Delta t} + \\bar{\\nabla} V(q(t_k), q(t_k+\\Delta t)) $$\n我们将两项都在 $t_k$ 附近展开。\n$$ M\\frac{\\dot{q}_{k+1}-\\dot{q}_k}{\\Delta t} = M(\\ddot{q}_k + \\frac{1}{2}\\dddot{q}_k \\Delta t + O(\\Delta t^2)) $$\n对于离散梯度，我们在 $q_k$ 附近展开：\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 \\nabla V(q_k + \\xi(q_{k+1}-q_k)) d\\xi $$\n$$ q_{k+1}-q_k = \\dot{q}_k \\Delta t + O(\\Delta t^2) $$\n$$ \\bar{\\nabla} V = \\int_0^1 \\left(\\nabla V(q_k) + \\xi \\nabla^2 V(q_k)(q_{k+1}-q_k) + O(\\Delta t^2)\\right) d\\xi $$\n$$ = \\nabla V(q_k) + \\frac{1}{2} \\nabla^2 V(q_k)(\\dot{q}_k \\Delta t) + O(\\Delta t^2) $$\n将这些展开式代入 $\\tau_v$：\n$$ \\tau_v = \\left(M\\ddot{q}_k + \\frac{1}{2}M\\dddot{q}_k \\Delta t\\right) + \\left(\\nabla V(q_k) + \\frac{1}{2}\\nabla^2 V(q_k)\\dot{q}_k \\Delta t\\right) + O(\\Delta t^2) $$\n$$ = (M\\ddot{q}_k + \\nabla V(q_k)) + \\frac{\\Delta t}{2} (M\\dddot{q}_k + \\nabla^2 V(q_k)\\dot{q}_k) + O(\\Delta t^2) $$\n精确解满足 $M\\ddot{q} + \\nabla V(q) = 0$。对此式关于时间求导，得到 $M\\dddot{q} + \\nabla^2 V(q)\\dot{q} = 0$。因此，$\\tau_v$ 表达式中的 $O(1)$ 项和 $O(\\Delta t)$ 项都为零。这意味着 $\\tau_v = O(\\Delta t^2)$。\n由于两个定义方程的局部截断误差均为 $O(\\Delta t^2)$，该方法是二阶精确的。\n\n**4. 离散梯度的计算**\n\n给定一个一维系统 ($n=1$)，其质量 $M=1$，势能为 $V(q) = \\frac{1}{3} q^{4} + \\frac{1}{3} q^{2}$。其连续梯度为 $\\nabla V(q) = V'(q) = \\frac{4}{3} q^3 + \\frac{2}{3} q$。我们需要计算离散梯度 $\\bar{\\nabla} V(q_k, q_{k+1})$ 在 $q_k=1$ 和 $q_{k+1}=2$ 时的值。\n\n使用中值离散梯度的定义：\n$$ \\bar{\\nabla} V(q_k, q_{k+1}) = \\int_0^1 V'((1-\\xi)q_k + \\xi q_{k+1}) d\\xi $$\n代入 $q_k=1$ 和 $q_{k+1}=2$。$V'$ 的自变量是 $(1-\\xi) \\cdot 1 + \\xi \\cdot 2 = 1 - \\xi + 2\\xi = 1 + \\xi$。\n$$ \\bar{\\nabla} V(1, 2) = \\int_0^1 V'(1+\\xi) d\\xi = \\int_0^1 \\left(\\frac{4}{3}(1+\\xi)^3 + \\frac{2}{3}(1+\\xi)\\right) d\\xi $$\n我们进行定积分计算：\n$$ \\bar{\\nabla} V(1, 2) = \\left[ \\frac{4}{3} \\frac{(1+\\xi)^4}{4} + \\frac{2}{3} \\frac{(1+\\xi)^2}{2} \\right]_0^1 $$\n$$ = \\left[ \\frac{1}{3}(1+\\xi)^4 + \\frac{1}{3}(1+\\xi)^2 \\right]_0^1 $$\n在上限 ($\\xi=1$) 处求值：\n$$ \\frac{1}{3}(1+1)^4 + \\frac{1}{3}(1+1)^2 = \\frac{1}{3}(2)^4 + \\frac{1}{3}(2)^2 = \\frac{16}{3} + \\frac{4}{3} = \\frac{20}{3} $$\n在下限 ($\\xi=0$) 处求值：\n$$ \\frac{1}{3}(1+0)^4 + \\frac{1}{3}(1+0)^2 = \\frac{1}{3}(1)^4 + \\frac{1}{3}(1)^2 = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3} $$\n积分的值是二者之差：\n$$ \\bar{\\nabla} V(1, 2) = \\frac{20}{3} - \\frac{2}{3} = \\frac{18}{3} = 6 $$\n离散梯度的值为 $6$。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "一个优秀的积分器除了需要保持能量外，还必须具备稳定性和准确性，而线性稳定性和频散分析是评估这些性质的标准工具。本练习将能量保持积分器应用于一个简谐振子，使您能够分析其稳定性和相位准确度。这是理解数值解的长期行为和比较不同算法的关键一步。",
            "id": "3562090",
            "problem": "考虑一个单自由度无阻尼线性振子，其运动由二阶运动方程 $m \\ddot{q} + k q = 0$ 控制，其中 $m>0$ 且 $k>0$。引入正则动量 $p = m \\dot{q}$ 和哈密顿量 $H(q,p) = \\tfrac{1}{2m} p^{2} + \\tfrac{1}{2} k q^{2}$。相关的哈密顿系统为 $\\dot{q} = \\partial H / \\partial p$ 和 $\\dot{p} = - \\partial H / \\partial q$。定义自然角频率 $\\omega = \\sqrt{k/m}$。离散时间步长为 $h>0$。\n\nA部分：从哈密顿形式和上述定义出发，考虑应用于正则系统的隐式中点时间积分法，\n$$\nq_{n+1} = q_{n} + h \\, \\frac{p_{n} + p_{n+1}}{2m}, \\quad\np_{n+1} = p_{n} - h \\, \\frac{k \\, (q_{n} + q_{n+1})}{2},\n$$\n其中 $q_{n}$ 和 $p_{n}$ 表示在时间 $t_{n}$ 的离散位置和动量。推导将 $(q_{n}, p_{n})$ 映射到 $(q_{n+1}, p_{n+1})$ 的线性放大矩阵，分析其对于任意 $h>0$ 的线性稳定性，并通过提取决定振子每步相位推进的离散角频率 $\\omega_{d}(h)$ 来获得色散关系。\n\nB部分：从二阶形式 $m \\ddot{q} + k q = 0$ 和基本运动学关系出发，写出采用平均加速度参数 $\\gamma = 1/2$ 和 $\\beta = 1/4$ 的 Newmark 方法，\n$$\nq_{n+1} = q_{n} + h \\, \\dot{q}_{n} + h^{2} \\left( \\tfrac{1}{2} - \\beta \\right) \\ddot{q}_{n} + \\beta h^{2} \\ddot{q}_{n+1}, \\quad\n\\dot{q}_{n+1} = \\dot{q}_{n} + h \\left( (1 - \\gamma) \\ddot{q}_{n} + \\gamma \\ddot{q}_{n+1} \\right),\n$$\n其中 $\\ddot{q} = - \\omega^{2} q$。推导相应的将 $(q_{n}, \\dot{q}_{n})$ 映射到 $(q_{n+1}, \\dot{q}_{n+1})$ 的线性放大矩阵，分析其对于任意 $h>0$ 的线性稳定性，并获得离散角频率 $\\omega_{d}(h)$。\n\nC部分：通过对 $\\omega_{d}(h)$ 在 $h = 0$ 附近进行级数展开，直到并包括 $h^{4}$ 阶项，比较两种方法的相位精度。确定相对于精确角频率 $\\omega$ 的主阶相位误差项。然后，提供两种方法产生的离散角频率 $\\omega_{d}(h)$ 的闭式解析表达式，该表达式以 $\\omega$ 和 $h$ 表示，单位为弧度/单位时间。不需要进行数值计算或四舍五入。你的最终答案必须是单个闭式表达式。",
            "solution": "该问题被验证为具有科学依据、问题明确且客观。这是一个计算力学中的标准问题，将按所述进行求解。\n\n该问题研究了简谐振子的两种数值积分方案，其运动方程为 $m \\ddot{q} + k q = 0$，其中质量 $m>0$，刚度 $k>0$。自然角频率为 $\\omega = \\sqrt{k/m}$。\n\nA部分：隐式中点时间积分法\n\n隐式中点法应用于哈密顿系统 $\\dot{q} = p/m$ 和 $\\dot{p} = -kq$。在一个时间步长 $h>0$ 内的离散更新方程如下：\n$$\nq_{n+1} = q_{n} + h \\, \\frac{p_{n} + p_{n+1}}{2m} \\\\\np_{n+1} = p_{n} - h \\, \\frac{k \\, (q_{n} + q_{n+1})}{2}\n$$\n为了推导放大矩阵，我们首先重新整理这些方程，以将时间步 $n+1$ 时的状态（由向量 $\\mathbf{x}_{n+1} = (q_{n+1}, p_{n+1})^T$ 表示）用时间步 $n$ 时的状态 $\\mathbf{x}_{n} = (q_{n}, p_{n})^T$ 来表示。\n方程可以改写为：\n$$\nq_{n+1} - \\frac{h}{2m} p_{n+1} = q_{n} + \\frac{h}{2m} p_{n} \\\\\n\\frac{hk}{2} q_{n+1} + p_{n+1} = p_{n} - \\frac{hk}{2} q_{n}\n$$\n以矩阵形式表示，即 $\\mathbf{L} \\mathbf{x}_{n+1} = \\mathbf{R} \\mathbf{x}_{n}$，其中\n$$\n\\mathbf{L} = \\begin{pmatrix} 1 & -\\frac{h}{2m} \\\\ \\frac{hk}{2} & 1 \\end{pmatrix}, \\quad\n\\mathbf{R} = \\begin{pmatrix} 1 & \\frac{h}{2m} \\\\ -\\frac{hk}{2} & 1 \\end{pmatrix}\n$$\n线性放大矩阵 $\\mathbf{A}$ 由 $\\mathbf{x}_{n+1} = \\mathbf{A} \\mathbf{x}_{n}$ 定义，因此 $\\mathbf{A} = \\mathbf{L}^{-1}\\mathbf{R}$。\n$\\mathbf{L}$ 的行列式为 $\\det(\\mathbf{L}) = (1)(1) - (-\\frac{h}{2m})(\\frac{hk}{2}) = 1 + \\frac{h^2 k}{4m} = 1 + \\frac{(\\omega h)^2}{4}$。\n$\\mathbf{L}$ 的逆矩阵为：\n$$\n\\mathbf{L}^{-1} = \\frac{1}{1 + \\frac{(\\omega h)^2}{4}} \\begin{pmatrix} 1 & \\frac{h}{2m} \\\\ -\\frac{hk}{2} & 1 \\end{pmatrix}\n$$\n现在我们计算放大矩阵 $\\mathbf{A}$：\n$$\n\\mathbf{A} = \\frac{1}{1 + \\frac{(\\omega h)^2}{4}} \\begin{pmatrix} 1 & \\frac{h}{2m} \\\\ -\\frac{hk}{2} & 1 \\end{pmatrix} \\begin{pmatrix} 1 & \\frac{h}{2m} \\\\ -\\frac{hk}{2} & 1 \\end{pmatrix}\n$$\n$$\n\\mathbf{A} = \\frac{1}{1 + \\frac{(\\omega h)^2}{4}} \\begin{pmatrix} 1 - \\frac{h^2 k}{4m} & \\frac{h}{m} \\\\ -hk & 1 - \\frac{h^2 k}{4m} \\end{pmatrix}\n= \\frac{1}{1 + \\frac{(\\omega h)^2}{4}} \\begin{pmatrix} 1 - \\frac{(\\omega h)^2}{4} & \\frac{h}{m} \\\\ -m \\omega^2 h & 1 - \\frac{(\\omega h)^2}{4} \\end{pmatrix}\n$$\n对于线性稳定性分析，我们从特征方程 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$ 中求解 $\\mathbf{A}$ 的特征值 $\\lambda$。\n$$\n\\left( \\frac{1 - \\frac{(\\omega h)^2}{4}}{1 + \\frac{(\\omega h)^2}{4}} - \\lambda \\right)^2 + \\frac{m \\omega^2 h^2/m}{(1 + \\frac{(\\omega h)^2}{4})^2} = 0\n$$\n$$\n\\left( \\lambda - \\frac{1 - \\frac{(\\omega h)^2}{4}}{1 + \\frac{(\\omega h)^2}{4}} \\right)^2 = - \\frac{(\\omega h)^2}{(1 + \\frac{(\\omega h)^2}{4})^2}\n$$\n特征值是一对复共轭：\n$$\n\\lambda = \\frac{1 - \\frac{(\\omega h)^2}{4}}{1 + \\frac{(\\omega h)^2}{4}} \\pm i \\frac{\\omega h}{1 + \\frac{(\\omega h)^2}{4}}\n$$\n特征值的模为：\n$$\n|\\lambda| = \\sqrt{\\left(\\frac{1 - \\frac{(\\omega h)^2}{4}}{1 + \\frac{(\\omega h)^2}{4}}\\right)^2 + \\left(\\frac{\\omega h}{1 + \\frac{(\\omega h)^2}{4}}\\right)^2} = \\frac{\\sqrt{1 - \\frac{(\\omega h)^2}{2} + \\frac{(\\omega h)^4}{16} + (\\omega h)^2}}{1 + \\frac{(\\omega h)^2}{4}} = \\frac{\\sqrt{1 + \\frac{(\\omega h)^2}{2} + \\frac{(\\omega h)^4}{16}}}{1 + \\frac{(\\omega h)^2}{4}} = \\frac{\\sqrt{(1 + \\frac{(\\omega h)^2}{4})^2}}{1 + \\frac{(\\omega h)^2}{4}} = 1\n$$\n由于对于任意 $h>0$ 的选择，都有 $|\\lambda|=1$，因此该方法是无条件稳定的，并且不会引入数值阻尼。\n\n通过将特征值与每步的数值相位推进 $\\theta_d = \\omega_d h$ 联系起来，可以找到色散关系。特征值的形式为 $\\lambda = e^{\\pm i \\theta_d} = \\cos(\\theta_d) \\pm i \\sin(\\theta_d)$。\n通过比较 $\\lambda$ 的实部和虚部，我们得到：\n$$\n\\cos(\\theta_d) = \\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4}, \\quad \\sin(\\theta_d) = \\frac{\\omega h}{1 + (\\omega h)^2/4}\n$$\n使用半角正切恒等式 $\\tan(\\theta_d/2) = \\sin(\\theta_d) / (1+\\cos(\\theta_d))$：\n$$\n\\tan\\left(\\frac{\\omega_d h}{2}\\right) = \\frac{\\frac{\\omega h}{1 + (\\omega h)^2/4}}{1 + \\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4}} = \\frac{\\omega h}{1 + (\\omega h)^2/4 + 1 - (\\omega h)^2/4} = \\frac{\\omega h}{2}\n$$\n这给出了离散角频率：\n$$\n\\omega_d(h) = \\frac{2}{h} \\arctan\\left(\\frac{\\omega h}{2}\\right)\n$$\n\nB部分：采用平均加速度的 Newmark 方法\n\n参数为 $\\gamma = 1/2$ 和 $\\beta=1/4$ 的 Newmark 方法（平均加速度法）由下式给出：\n$$\nq_{n+1} = q_{n} + h \\, \\dot{q}_{n} + h^{2} \\left( \\tfrac{1}{2} - \\beta \\right) \\ddot{q}_{n} + \\beta h^{2} \\ddot{q}_{n+1} \\\\\n\\dot{q}_{n+1} = \\dot{q}_{n} + h \\left( (1 - \\gamma) \\ddot{q}_{n} + \\gamma \\ddot{q}_{n+1} \\right)\n$$\n代入 $\\gamma=1/2$、$\\beta=1/4$ 以及运动方程 $\\ddot{q} = -\\omega^2 q$：\n$$\nq_{n+1} = q_n + h \\dot{q}_n + \\frac{h^2}{4}(-\\omega^2 q_n) + \\frac{h^2}{4}(-\\omega^2 q_{n+1}) \\\\\n\\dot{q}_{n+1} = \\dot{q}_n + \\frac{h}{2}(-\\omega^2 q_n) + \\frac{h}{2}(-\\omega^2 q_{n+1})\n$$\n我们求解 $(q_{n+1}, \\dot{q}_{n+1})$，用 $(q_n, \\dot{q}_n)$ 表示。从第一个方程：\n$$\nq_{n+1}\\left(1 + \\frac{(\\omega h)^2}{4}\\right) = q_n\\left(1 - \\frac{(\\omega h)^2}{4}\\right) + h \\dot{q}_n\n$$\n$$\nq_{n+1} = \\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4} q_n + \\frac{h}{1 + (\\omega h)^2/4} \\dot{q}_n\n$$\n将此式代入第二个方程求解 $\\dot{q}_{n+1}$：\n$$\n\\dot{q}_{n+1} = \\dot{q}_n - \\frac{h \\omega^2}{2} q_n - \\frac{h \\omega^2}{2} \\left( \\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4} q_n + \\frac{h}{1 + (\\omega h)^2/4} \\dot{q}_n \\right)\n$$\n对 $q_n$ 和 $\\dot{q}_n$ 的系数进行分组：\n$$\n\\dot{q}_{n+1} = \\left(-\\frac{h \\omega^2}{2} - \\frac{h \\omega^2}{2}\\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4}\\right) q_n + \\left(1 - \\frac{h^2 \\omega^2/2}{1 + (\\omega h)^2/4}\\right) \\dot{q}_n\n$$\n$$\n\\dot{q}_{n+1} = \\left(-\\frac{h \\omega^2}{1 + (\\omega h)^2/4}\\right) q_n + \\left(\\frac{1 - (\\omega h)^2/4}{1 + (\\omega h)^2/4}\\right) \\dot{q}_n\n$$\n状态向量 $(q_n, \\dot{q}_n)^T$ 的放大矩阵 $\\mathbf{A}_{Newmark}$ 为：\n$$\n\\mathbf{A}_{Newmark} = \\frac{1}{1 + \\frac{(\\omega h)^2}{4}} \\begin{pmatrix} 1 - \\frac{(\\omega h)^2}{4} & h \\\\ -\\omega^2 h & 1 - \\frac{(\\omega h)^2}{4} \\end{pmatrix}\n$$\n$\\mathbf{A}_{Newmark}$ 的特征方程为：\n$$\n\\left( \\frac{1 - \\frac{(\\omega h)^2}{4}}{1 + \\frac{(\\omega h)^2}{4}} - \\lambda \\right)^2 + \\frac{\\omega^2 h^2}{(1 + \\frac{(\\omega h)^2}{4})^2} = 0\n$$\n这与 A 部分中找到的特征方程相同（在考虑了基变量从 $(q,p)$ 到 $(q, \\dot{q})$ 的变化之后）。因此，特征值相同，稳定性属性（$|\\lambda|=1$ 的无条件稳定性）也相同，并且得到的离散角频率 $\\omega_d(h)$ 也完全相同：\n$$\n\\omega_d(h) = \\frac{2}{h} \\arctan\\left(\\frac{\\omega h}{2}\\right)\n$$\n\nC部分：相位精度比较\n\n隐式中点法和参数为 $\\gamma=1/2$、$\\beta=1/4$ 的 Newmark 方法都产生相同的离散角频率 $\\omega_d(h)$。因此，它们的相位精度是相同的。为了分析此精度，我们对 $\\omega_d(h)$ 在 $h=0$ 附近进行泰勒级数展开。\n$\\arctan(x)$ 的泰勒级数为 $\\arctan(x) = x - \\frac{x^3}{3} + \\frac{x^5}{5} - O(x^7)$。\n设 $x = \\frac{\\omega h}{2}$。\n$$\n\\omega_d(h) = \\frac{2}{h} \\left[ \\left(\\frac{\\omega h}{2}\\right) - \\frac{1}{3}\\left(\\frac{\\omega h}{2}\\right)^3 + \\frac{1}{5}\\left(\\frac{\\omega h}{2}\\right)^5 - O(h^7) \\right]\n$$\n$$\n\\omega_d(h) = \\frac{2}{h} \\left[ \\frac{\\omega h}{2} - \\frac{\\omega^3 h^3}{24} + \\frac{\\omega^5 h^5}{160} - O(h^7) \\right]\n$$\n$$\n\\omega_d(h) = \\omega - \\frac{\\omega^3 h^2}{12} + \\frac{\\omega^5 h^4}{80} - O(h^6)\n$$\n相对于精确频率 $\\omega$ 的相位误差为 $\\omega_d(h) - \\omega$。主阶相位误差项为：\n$$\n\\omega_d(h) - \\omega \\approx -\\frac{\\omega^3 h^2}{12}\n$$\n这表明两种方法在相位上都是二阶精度的。负号表示相位滞后，意味着数值解的周期略长于精确周期（周期延长）。\n\n两种方法产生的离散角频率 $\\omega_d(h)$ 的闭式解析表达式（单位为弧度/单位时间）与 A 部分和 B 部分推导出的表达式相同。",
            "answer": "$$\n\\boxed{\\frac{2}{h} \\arctan\\left(\\frac{\\omega h}{2}\\right)}\n$$"
        },
        {
            "introduction": "能量-动量方法的真正威力体现在复杂非线性模拟中，例如有限应变弹塑性问题，这要求将积分器与先进的本构模型和基于流形的更新算法相结合。这项综合性练习旨在挑战您为一个有限应变塑性模型实现一个完整的模拟程序。它将能量-动量守恒的核心概念与非欧几里得流形上材料建模的复杂性相结合，提供了一次全面的动手编程体验。",
            "id": "3562097",
            "problem": "考虑一个均质的二维可变形体，该物体经历仿射运动，其变形梯度为 $F(t) \\in \\mathrm{GL}^+(2)$，其中 $\\mathrm{GL}^+(2)$ 表示行列式为正的 $2 \\times 2$ 矩阵构成的一般线性群。该物体被建模为单个质点，其构型是在一个归一化域上的均匀变形梯度 $F$，该域的二阶矩张量为 $J \\in \\mathbb{R}^{2 \\times 2}$，$J = J^\\top$，$J \\succ 0$。该物体表现出有限应变弹塑性行为，其变形梯度可乘法分解为 $F = F_e F_p$，其中 $F_e \\in \\mathrm{GL}^+(2)$ 是弹性部分，$F_p \\in \\mathrm{GL}^+(2)$ 是塑性部分。塑性是各向同性的，带有一个标量硬化变量 $\\alpha \\in \\mathbb{R}$。\n\n动能定义为\n$$\nT = \\tfrac{1}{2} \\rho \\, \\mathrm{tr}\\big(\\dot{F} J \\dot{F}^\\top\\big),\n$$\n其中 $\\rho > 0$ 是质量密度。弹性应变能密度由可压缩 Neo-Hookean 模型给出，以弹性变形梯度 $F_e$ 表示，\n$$\nW(F_e) = \\tfrac{\\mu}{2} \\big( \\mathrm{tr}(C_e) - 2 \\big) - \\mu \\ln(J_e) + \\tfrac{\\lambda}{2} \\big(\\ln(J_e)\\big)^2,\n$$\n其中 $C_e = F_e^\\top F_e$，$J_e = \\det(F_e)$，$\\mu > 0$ 和 $\\lambda > 0$ 分别是剪切模量和体积模量。第一 Piola-Kirchhoff 弹性应力为 $P_e = \\tau_e F_e^{-\\top}$，其中 Kirchhoff 应力为 $\\tau_e = \\mu (B_e - I) + \\lambda \\ln(J_e) I$，而 $B_e = F_e F_e^\\top$。\n\n塑性流动通过塑性右 Cauchy-Green 张量 $C_p = F_p^\\top F_p \\in \\mathrm{Sym}^+(2)$ 在对称正定矩阵的非欧几里得流形 $\\mathrm{Sym}^+(2)$ 上进行描述。通过矩阵对数定义塑性度量 $Y_p = \\log(C_p) \\in \\mathrm{Sym}(2)$，以便通过指数映射使更新保持在流形上。弹性行为通过从极分解 $F_e = R_e U_e$ 得到的弹性右拉伸张量 $U_e$ 来表征，其中 $R_e \\in \\mathrm{SO}(2)$ 且 $U_e \\in \\mathrm{Sym}^+(2)$。弹性 Hencky 应变为 $e = \\log(U_e)$，其偏量部分为 $\\mathrm{dev}(e) = e - \\tfrac{1}{2}\\mathrm{tr}(e) I$，von Mises 等效度量为\n$$\ns_\\mathrm{eq} = 2 \\mu \\sqrt{\\tfrac{3}{2}} \\, \\|\\mathrm{dev}(e)\\|.\n$$\n各向同性硬化遵循 $\\sigma_y(\\alpha) = \\sigma_0 + H \\alpha$，其中初始屈服应力 $\\sigma_0 \\ge 0$，硬化模量 $H \\ge 0$。假设在 Hencky 应变空间中采用径向返回映射：如果试探状态违反了屈服准则 $s_\\mathrm{eq} > \\sigma_y(\\alpha)$，则沿偏量方向 $N = \\mathrm{dev}(e)/\\|\\mathrm{dev}(e)\\|$ 更新塑性变量，塑性增量 $\\Delta \\gamma$ 定义为\n$$\n\\Delta \\gamma = \\frac{A S - B}{A + C}, \\quad A = 2 \\mu \\sqrt{\\tfrac{3}{2}}, \\quad S = \\|\\mathrm{dev}(e)\\|, \\quad B = \\sigma_0 + H \\alpha, \\quad C = H \\sqrt{\\tfrac{2}{3}},\n$$\n并设置 $Y_p \\leftarrow Y_p + 2 \\Delta \\gamma N$，$C_p \\leftarrow \\exp(Y_p)$，$F_p \\leftarrow \\sqrt{C_p}$ (主平方根)，以及 $\\alpha \\leftarrow \\alpha + \\sqrt{\\tfrac{2}{3}} \\Delta \\gamma$。此更新通过约束 $Y_p$ 为偏张量来保持 $F_p$ 的体积。\n\n力学部分需要使用能量-动量守恒积分方法。将时间以大小为 $\\Delta t > 0$ 的均匀步长离散化，并设计一种基于中点法则和弹性能力散梯度的能量-动量方法，该方法能保证在没有塑性流动和外载荷的情况下，总机械能（动能加弹性势能）的精确守恒，以及绕原点的角动量的精确守恒（由能量的客观性和在叠加刚体运动下的不变性所致）。将 $W$ 关于 $F$ 在两个连续状态 $F_n$ 和 $F_{n+1}$ 下的离散梯度 $f^\\mathrm{DG}$ 表示如下。令\n$$\nP(F,F_p) = P_e(F F_p^{-1}) F_p^{-\\top}\n$$\n是 $W$ 关于 $F$ 的梯度。定义\n$$\n\\mathrm{DG}(F_n,F_{n+1};F_p) = \\tfrac{1}{2}\\big(P(F_n,F_p) + P(F_{n+1},F_p)\\big),\n$$\n和\n$$\nf^\\mathrm{DG} = \\mathrm{DG} + \\frac{W(F_{n+1}F_p^{-1}) - W(F_n F_p^{-1}) - \\langle \\mathrm{DG}, F_{n+1}-F_n \\rangle}{\\|F_{n+1}-F_n\\|_F^2} \\, (F_{n+1}-F_n),\n$$\n其中 $\\langle A,B \\rangle = \\mathrm{tr}(A^\\top B)$ 且 $\\|\\cdot\\|_F$ 是 Frobenius 范数。能量-动量更新公式为\n$$\nV_{n+1} = V_n - \\Delta t \\, \\mathcal{M}^{-1}(f^\\mathrm{DG}), \\quad F_{n+1} = F_n + \\Delta t \\, \\tfrac{1}{2}(V_n + V_{n+1}),\n$$\n其中机械速度为 $V = \\dot{F}$，质量算子 $\\mathcal{M}$ 定义为 $\\mathcal{M}(A) = \\rho A J$，因此 $\\mathcal{M}^{-1}(A) = \\tfrac{1}{\\rho} A J^{-1}$。在塑性修正步中，保持 $F$ 不变，同时通过 Hencky 应变空间中的径向返回映射更新 $F_p$ 和 $\\alpha$。\n\n平面内绕原点的角动量定义为\n$$\nL_z = \\rho \\, \\mathrm{tr}(S V J), \\quad S = \\begin{bmatrix} 0 & -1 \\\\ 1 & 0 \\end{bmatrix},\n$$\n当 $W$ 是客观的且没有施加外载荷时，该量在能量-动量步中是守恒的。\n\n您的任务是实现一个完整的、自包含的程序，该程序：\n- 编码上述模型并执行时间步进，每个时间步包含一个能量-动量力学更新，随后是通过指数映射在流形 $\\mathrm{Sym}^+(2)$ 上进行的各向同性硬化塑性修正。\n- 使用可压缩 Neo-Hookean 能量和 Hencky 应变空间中的径向返回映射。\n- 为以下测试计算不变量，并以无量纲单位输出所要求的浮点数残差。\n\n测试套件参数和要求输出：\n- 测试 1 (弹性，理想情况): $\\mu = 10$, $\\lambda = 5$, $\\rho = 2$, $J = \\mathrm{diag}(1,1)$, 初始 $F_0 = R(\\theta) \\, \\mathrm{diag}(1.1,0.9)$ (其中 $\\theta = 0.3$ 弧度)，初始 $V_0 = \\omega S + \\mathrm{diag}(0.05,-0.05)$ (其中 $\\omega = 0.2$)，$F_{p,0} = I$, $\\alpha_0 = 0$, $\\sigma_0 = 10^6$ (以使塑性不被激活)，$\\Delta t = 0.05$，步数 $N = 50$。计算绝对机械能漂移 $|E_N - E_0|$，其中 $E_n = T_n + W(F_{e,n})$，并将其作为浮点数输出。\n- 测试 2 (塑性，带各向同性硬化): $\\mu = 8$, $\\lambda = 2$, $\\rho = 2$, $J = \\mathrm{diag}(1,1)$, 初始 $F_0 = R(\\theta) \\, \\mathrm{diag}(1.3,0.7)$ (其中 $\\theta = 0.2$ 弧度)，初始 $V_0 = \\omega S + \\mathrm{diag}(0.02,-0.02)$ (其中 $\\omega = 0.1$)，$F_{p,0} = I$, $\\alpha_0 = 0$, $\\sigma_0 = 0.5$, $H = 5$, $\\Delta t = 0.02$，步数 $N = 100$。计算绝对角动量漂移 $|L_{z,N} - L_{z,0}|$，并将其作为浮点数输出。\n- 测试 3 (弹性，近不可压缩边界情况): $\\mu = 10$, $\\lambda = 1000$, $\\rho = 2$, $J = \\mathrm{diag}(1,1)$, 初始 $F_0 = R(\\theta) \\, \\mathrm{diag}(1.02,0.98)$ (其中 $\\theta = 0.1$ 弧度)，初始 $V_0 = \\omega S + \\mathrm{diag}(0.01,-0.01)$ (其中 $\\omega = 0.15$)，$F_{p,0} = I$, $\\alpha_0 = 0$, $\\sigma_0 = 10^6$, $\\Delta t = 0.01$，步数 $N = 60$。计算绝对机械能漂移 $|E_N - E_0|$，并将其作为浮点数输出。\n\n所有量均视为无量纲。您的程序应生成单行输出，其中包含按测试顺序排列的结果，格式为方括号内的逗号分隔列表，例如 $[r_1,r_2,r_3]$，其中每个 $r_i$ 是一个浮点数。\n\n基本依据和约束：\n- 从拉格朗日力学、能量的客观性以及角动量的定义出发，推导能量-动量时间积分器。\n- 使用质量算子 $\\mathcal{M}(A) = \\rho A J$ 及其逆 $\\mathcal{M}^{-1}(A) = \\tfrac{1}{\\rho} A J^{-1}$。\n- 不要引入任何未从指定基本依据推导出的快捷公式。\n- 通过使用极分解、矩阵对数、指数映射和主平方根，确保所有矩阵保持在 $\\mathrm{GL}^+(2)$ 和 $\\mathrm{Sym}^+(2)$ 中，以保证科学真实性。\n- 塑性修正器必须通过对偏塑性增量进行指数化来更新 $\\mathrm{Sym}^+(2)$ 上的 $C_p$，并通过 $C_p$ 的主平方根来更新 $F_p$。\n- 离散梯度必须满足能量恒等式 $\\langle F_{n+1} - F_n, f^\\mathrm{DG} \\rangle = W(F_{e,n+1}) - W(F_{e,n})$。\n\n您的输出必须是严格的单行格式 $[r_1,r_2,r_3]$，其中 $r_1$、$r_2$ 和 $r_3$ 分别是测试 1 到测试 3 的浮点数残差。",
            "solution": "任务是为一个二维可变形体的有限应变弹塑性模型实现一个时间步进算法。该算法必须基于一个用于力学部分的能量-动量守恒格式，以及一个在 Hencky 应变空间中使用径向返回映射的塑性修正步。该解决方案需要仔细实现所提供的数学框架，包括流形上的矩阵微积分和隐式时间积分格式。\n\n系统的动力学由拉格朗日量 $L = T - W$ 控制，其中 $T$ 是动能，$W$ 是弹性应变能。关于变形梯度 $F$ 的 Euler-Lagrange 方程是 $\\frac{d}{dt}\\frac{\\partial L}{\\partial \\dot{F}} - \\frac{\\partial L}{\\partial F} = 0$。\n动能为 $T = \\tfrac{1}{2} \\rho \\, \\mathrm{tr}\\big(\\dot{F} J \\dot{F}^\\top\\big)$，由此可得与 $F$ 共轭的广义动量为 $\\Pi = \\frac{\\partial T}{\\partial \\dot{F}} = \\rho \\dot{F} J$。质量算子 $\\mathcal{M}$ 由此关系定义，$\\Pi = \\mathcal{M}(\\dot{F})$。力由势能导出，$f = -\\frac{\\partial W}{\\partial F}$。在塑性情况下，力源于弹性势能，使得运动方程为 $\\dot{\\Pi} + P(F, F_p) = 0$，其中 $P(F, F_p) = \\frac{\\partial W(F F_p^{-1})}{\\partial F}$ 是第一 Piola-Kirchhoff 应力。\n\n使用算子分裂法构建时间步进算法，在每个时间步 $\\Delta t = t_{n+1} - t_n$ 内将力学演化与塑性材料响应分开。\n\n首先，力学预测步将构型从 $(F_n, V_n)$推进到试探状态 $(F_{n+1}, V_{n+1})$，同时将塑性变量 $(F_p, \\alpha)$ 保持在第 $n$ 步的值不变。为实现能量和动量守恒，我们使用基于中点法则的能量-动量积分器。离散的运动方程为：\n$$\n\\frac{F_{n+1} - F_n}{\\Delta t} = \\frac{V_n + V_{n+1}}{2}\n$$\n$$\n\\frac{\\mathcal{M}(V_{n+1}) - \\mathcal{M}(V_n)}{\\Delta t} = -f^\\mathrm{DG}(F_n, F_{n+1}, F_{p,n})\n$$\n其中 $V = \\dot{F}$ 是材料速度，$f^\\mathrm{DG}$ 是势能 $W$ 的离散梯度。离散梯度被精心构造以满足离散能量关系 $\\langle F_{n+1} - F_n, f^\\mathrm{DG} \\rangle = W(F_{e,n+1}) - W(F_{e,n})$，这保证了在没有塑性耗散发生时（对力学部分）能量的精确守恒。其具体形式为：\n$$\nf^\\mathrm{DG} = \\mathrm{DG} + \\frac{W(F_{n+1}F_{p,n}^{-1}) - W(F_n F_{p,n}^{-1}) - \\langle \\mathrm{DG}, F_{n+1}-F_n \\rangle}{\\|F_{n+1}-F_n\\|_F^2} \\, (F_{n+1}-F_n)\n$$\n其中 $\\mathrm{DG} = \\tfrac{1}{2}\\big(P(F_n,F_{p,n}) + P(F_{n+1},F_{p,n})\\big)$。将第二个方程中的 $V_{n+1}$ 代入第一个方程，得到关于 $F_{n+1}$ 的非线性代数系统：\n$$\nF_{n+1} + \\frac{\\Delta t^2}{2} \\mathcal{M}^{-1}(f^\\mathrm{DG}(F_n, F_{n+1}, F_{p,n})) - (F_n + \\Delta t V_n) = 0\n$$\n这个关于 $F_{n+1}$ 的隐式方程必须在每个时间步求解，为此我们采用数值求根算法（例如，拟牛顿法）。一旦求得 $F_{n+1}$，$V_{n+1}$ 就可以直接计算出来。\n\n其次，塑性修正步更新塑性变量 $(F_p, \\alpha)$，同时保持总变形梯度 $F_{n+1}$ 固定。此步骤强制执行塑性流动法则和硬化定律。该过程基于 Hencky（对数）弹性应变空间中的径向返回算法。\n1. 计算试探弹性变形梯度：$F_{e}^\\text{trial} = F_{n+1} (F_{p,n})^{-1}$。\n2. 执行极分解 $F_{e}^\\text{trial} = R_e U_e$ 以找到弹性右拉伸张量 $U_e \\in \\mathrm{Sym}^+(2)$。\n3. 计算试探 Hencky 应变 $e^\\text{trial} = \\log(U_e)$，其中 $\\log$ 是矩阵对数。对于对称正定矩阵 $U_e$，此操作可通过特征值分解稳健地执行。\n4. 计算 von Mises 等效应力度量 $s_\\mathrm{eq} = 2 \\mu \\sqrt{\\tfrac{3}{2}} \\, \\|\\mathrm{dev}(e^\\text{trial})\\|$，其中 $\\mathrm{dev}(e) = e - \\tfrac{1}{2}\\mathrm{tr}(e) I$。\n5. 检查屈服条件：$f_\\text{yield} = s_\\mathrm{eq} - (\\sigma_0 + H\\alpha_n) \\le 0$。\n6. 如果 $f_\\text{yield} \\le 0$，则该步为弹性步，无需进行塑性更新：$F_{p, n+1} = F_{p,n}$ 且 $\\alpha_{n+1} = \\alpha_n$。\n7. 如果 $f_\\text{yield} > 0$，则发生塑性流动。计算塑性增量 $\\Delta\\gamma$ 并更新塑性变量。\n   - 塑性应变度量 $Y_p = \\log(C_p)$（其中 $C_p = F_p^\\top F_p$）沿方向 $N = \\mathrm{dev}(e^\\text{trial})/\\|\\mathrm{dev}(e^\\text{trial})\\|$ 更新为 $Y_{p,n+1} = Y_{p,n} + 2\\Delta\\gamma N$。由于 $\\mathrm{tr}(N)=0$，此更新保持 $\\mathrm{tr}(Y_p)$ 不变，确保塑性流动是保体积的，这是对金属的常见假设。\n   - 新的塑性右 Cauchy-Green 张量通过矩阵指数求得，$C_{p,n+1} = \\exp(Y_{p,n+1})$。\n   - 新的塑性变形梯度是其主平方根，$F_{p,n+1} = \\sqrt{C_{p,n+1}}$。这些流形运算（log, exp, sqrt）通过特征值分解执行，以确保结果保持在 $\\mathrm{Sym}^+(2)$ 内。\n   - 硬化变量更新为：$\\alpha_{n+1} = \\alpha_n + \\sqrt{\\tfrac{2}{3}}\\Delta\\gamma$。\n\n从 $n$ 到 $n+1$ 的一个时间步的整体算法如下：\n1. 使用状态 $(F_n, V_n, F_{p,n}, \\alpha_n)$，求解关于 $F_{n+1}$ 的隐式力学预测方程。\n2. 计算相应的速度 $V_{n+1}$。\n3. 使用 $F_{n+1}$、$F_{p,n}$ 和 $\\alpha_n$ 执行塑性修正步，求得 $F_{p,n+1}$ 和 $\\alpha_{n+1}$。\n4. 该步结束时的状态为 $(F_{n+1}, V_{n+1}, F_{p,n+1}, \\alpha_{n+1})$。\n\n对于指定的测试，我们必须计算两个不变量。机械能为 $E = T + W(F_e)$，其漂移为弹性测试计算。角动量为 $L_z = \\rho \\, \\mathrm{tr}(S V J)$，其中 $S = \\begin{bmatrix} 0 & -1 \\\\ 1 & 0 \\end{bmatrix}$，其漂移为塑性测试计算。能量-动量格式保证了 $L_z$ 即使在有塑性的情况下也能守恒到机器精度，因为所实现的算子分裂仅在动量守恒的力学步中更新速度。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import inv, det, norm, polar\nfrom scipy.optimize import root\n\n# --- Robust matrix functions for symmetric matrices ---\n\ndef eigh_safe(A):\n    \"\"\"Performs eigenvalue decomposition for a symmetric matrix, ensuring orthogonality.\"\"\"\n    # Symmetrize to handle minor floating point inaccuracies\n    A_sym = (A + A.T) / 2\n    return np.linalg.eigh(A_sym)\n\ndef logm_spd(A):\n    \"\"\"Logarithm of a symmetric positive-definite matrix via eigenvalue decomposition.\"\"\"\n    w, v = eigh_safe(A)\n    if np.any(w = 0):\n        # This should ideally not be reached with a correct physical model and stable numerics.\n        # A small positive threshold can prevent log of zero/negative.\n        w[w = 0] = 1e-12\n    return v @ np.diag(np.log(w)) @ v.T\n\ndef expm_sym(A):\n    \"\"\"Exponential of a symmetric matrix via eigenvalue decomposition.\"\"\"\n    w, v = eigh_safe(A)\n    return v @ np.diag(np.exp(w)) @ v.T\n\ndef sqrtm_spd(A):\n    \"\"\"Principal square root of a symmetric positive-definite matrix via eigenvalue decomposition.\"\"\"\n    w, v = eigh_safe(A)\n    if np.any(w  0):\n        # Handle cases where matrix is not strictly positive semi-definite due to precision.\n        w[w  0] = 0\n    return v @ np.diag(np.sqrt(w)) @ v.T\n\n# --- Model setup ---\n\nI = np.identity(2)\nS_mat = np.array([[0.0, -1.0], [1.0, 0.0]])\n\ndef get_rotation_matrix(theta):\n    c, s = np.cos(theta), np.sin(theta)\n    return np.array([[c, -s], [s, c]])\n\n# --- Constitutive and integrator functions ---\n\ndef neo_hookean_energy(Fe, mu, lamb):\n    Je = det(Fe)\n    if Je = 1e-12: return np.inf\n    Ce = Fe.T @ Fe\n    return 0.5 * mu * (np.trace(Ce) - 2) - mu * np.log(Je) + 0.5 * lamb * (np.log(Je))**2\n\ndef pk1_stress_from_F(F, Fp, mu, lamb):\n    try:\n        Fp_inv = inv(Fp)\n        Fe = F @ Fp_inv\n        Je = det(Fe)\n        if Je = 1e-12: return np.full((2, 2), 1e12)\n        Be = Fe @ Fe.T\n        tau_e = mu * (Be - I) + lamb * np.log(Je) * I\n        Pe = tau_e @ inv(Fe).T\n        return Pe @ Fp_inv.T\n    except np.linalg.LinAlgError:\n        return np.full((2, 2), 1e12)\n\ndef discrete_gradient(Fn, Fnp1, Fp, mu, lamb):\n    diff_F = Fnp1 - Fn\n    norm_diff_F_sq = norm(diff_F, 'fro')**2\n\n    if norm_diff_F_sq  1e-24:\n        return pk1_stress_from_F(Fn, Fp, mu, lamb)\n    \n    P_n = pk1_stress_from_F(Fn, Fp, mu, lamb)\n    P_np1 = pk1_stress_from_F(Fnp1, Fp, mu, lamb)\n    DG_bar = 0.5 * (P_n + P_np1)\n    \n    try:\n        Fp_inv = inv(Fp)\n        Fe_n = Fn @ Fp_inv\n        Fe_np1 = Fnp1 @ Fp_inv\n        W_n = neo_hookean_energy(Fe_n, mu, lamb)\n        W_np1 = neo_hookean_energy(Fe_np1, mu, lamb)\n        num = W_np1 - W_n - np.trace(DG_bar.T @ diff_F)\n        correction = (num / norm_diff_F_sq) * diff_F\n        return DG_bar + correction\n    except np.linalg.LinAlgError:\n        return np.full((2,2), 1e12)\n\ndef plastic_corrector(F_trial, Fp_n, alpha_n, mu, sigma0, H):\n    try:\n        Fe_trial = F_trial @ inv(Fp_n)\n        _, Ue = polar(Fe_trial, side='right')\n    except np.linalg.LinAlgError:\n        return Fp_n, alpha_n\n        \n    e_trial = logm_spd(Ue)\n    \n    dev_e = e_trial - 0.5 * np.trace(e_trial) * I\n    S_norm = norm(dev_e, 'fro')\n\n    if S_norm  1e-12:\n        return Fp_n, alpha_n\n\n    A = 2 * mu * np.sqrt(1.5)\n    s_eq = A * S_norm\n    sigma_y = sigma0 + H * alpha_n\n    f_yield = s_eq - sigma_y\n\n    if f_yield = 0:\n        return Fp_n, alpha_n\n    else:\n        C = H * np.sqrt(2.0/3.0)\n        delta_gamma = f_yield / (A + C)\n        N = dev_e / S_norm\n        \n        Cp_n = Fp_n.T @ Fp_n\n        Yp_n = logm_spd(Cp_n)\n        \n        Yp_new = Yp_n + 2 * delta_gamma * N\n        Cp_new = expm_sym(Yp_new)\n        Fp_new = sqrtm_spd(Cp_new)\n        \n        alpha_new = alpha_n + np.sqrt(2.0/3.0) * delta_gamma\n        \n        return Fp_new, alpha_new\n\n# --- Invariant calculation ---\n\ndef get_energy(F, V, Fp, rho, J, mu, lamb):\n    kinetic = 0.5 * rho * np.trace(V @ J @ V.T)\n    potential = neo_hookean_energy(F @ inv(Fp), mu, lamb)\n    return kinetic + potential\n\ndef get_angular_momentum(V, rho, J):\n    return rho * np.trace(S_mat @ V @ J)\n\n# --- Main simulation loop ---\n\ndef run_simulation(params):\n    mu, lamb, rho = params['mu'], params['lamb'], params['rho']\n    J, sigma0, H = params['J'], params['sigma0'], params['H']\n    F0, V0, Fp0, alpha0 = params['F0'], params['V0'], params['Fp0'], params['alpha0']\n    dt, N_steps = params['dt'], params['N_steps']\n    J_inv = inv(J)\n\n    F, V, Fp, alpha = F0.copy(), V0.copy(), Fp0.copy(), alpha0\n\n    E0 = get_energy(F, V, Fp, rho, J, mu, lamb)\n    Lz0 = get_angular_momentum(V, rho, J)\n\n    for _ in range(N_steps):\n        # 1. Mechanical Predictor\n        def residual_fn(F_np1_flat, F_n, V_n, Fp_n):\n            F_np1 = F_np1_flat.reshape((2, 2))\n            f_dg = discrete_gradient(F_n, F_np1, Fp_n, mu, lamb)\n            M_inv_f_dg = (1.0/rho) * f_dg @ J_inv\n            res = F_np1 - (F_n + dt * V_n - 0.5 * dt**2 * M_inv_f_dg)\n            return res.flatten()\n\n        F_guess = F + dt * V\n        sol = root(residual_fn, F_guess.flatten(), args=(F, V, Fp), method='hybr', tol=1e-10)\n        F_trial = sol.x.reshape((2, 2))\n        \n        f_dg_final = discrete_gradient(F, F_trial, Fp, mu, lamb)\n        V_trial = V - dt * (1.0/rho) * f_dg_final @ J_inv\n\n        # 2. Plastic Corrector\n        Fp_new, alpha_new = plastic_corrector(F_trial, Fp, alpha, mu, sigma0, H)\n        \n        # 3. Update State\n        F, V, Fp, alpha = F_trial, V_trial, Fp_new, alpha_new\n\n    E_N = get_energy(F, V, Fp, rho, J, mu, lamb)\n    Lz_N = get_angular_momentum(V, rho, J)\n\n    if params['output'] == 'energy_drift':\n        return abs(E_N - E0)\n    elif params['output'] == 'Lz_drift':\n        return abs(Lz_N - Lz0)\n    return None\n\ndef solve():\n    test_cases = [\n        {\n            'mu': 10.0, 'lamb': 5.0, 'rho': 2.0, 'J': np.identity(2),\n            'F0': get_rotation_matrix(0.3) @ np.diag([1.1, 0.9]),\n            'V0': 0.2 * S_mat + np.diag([0.05, -0.05]),\n            'Fp0': np.identity(2), 'alpha0': 0.0,\n            'sigma0': 1e6, 'H': 0.0, 'dt': 0.05, 'N_steps': 50,\n            'output': 'energy_drift'\n        },\n        {\n            'mu': 8.0, 'lamb': 2.0, 'rho': 2.0, 'J': np.identity(2),\n            'F0': get_rotation_matrix(0.2) @ np.diag([1.3, 0.7]),\n            'V0': 0.1 * S_mat + np.diag([0.02, -0.02]),\n            'Fp0': np.identity(2), 'alpha0': 0.0,\n            'sigma0': 0.5, 'H': 5.0, 'dt': 0.02, 'N_steps': 100,\n            'output': 'Lz_drift'\n        },\n        {\n            'mu': 10.0, 'lamb': 1000.0, 'rho': 2.0, 'J': np.identity(2),\n            'F0': get_rotation_matrix(0.1) @ np.diag([1.02, 0.98]),\n            'V0': 0.15 * S_mat + np.diag([0.01, -0.01]),\n            'Fp0': np.identity(2), 'alpha0': 0.0,\n            'sigma0': 1e6, 'H': 0.0, 'dt': 0.01, 'N_steps': 60,\n            'output': 'energy_drift'\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}