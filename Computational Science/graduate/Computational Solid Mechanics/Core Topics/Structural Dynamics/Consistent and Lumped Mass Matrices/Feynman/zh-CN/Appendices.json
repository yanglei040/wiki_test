{
    "hands_on_practices": [
        {
            "introduction": "理论知识需要通过实践来巩固。我们的第一个练习将从最基本的应用——一维杆的振动——开始。这个练习旨在强化从控制方程的弱形式出发，推导单元刚度矩阵和质量矩阵的过程，并直接对比使用一致质量矩阵与集总质量矩阵所产生的结果。通过解析求解这个问题 ，您将对这两种质量表示方法如何影响系统的预测动态行为（特别是自然频率）有一个具体而深刻的理解。",
            "id": "3551458",
            "problem": "考虑一根沿空间坐标 $x \\in [0, L]$ 放置的均匀直杆，其长度为 $L$，横截面积为 $A$，杨氏模量为 $E$，质量密度为 $\\rho$。假设为小应变线性弹性、一维轴向运动，且无外部载荷。$x=0$ 处的边界为固定边界（位移 $u(0,t)=0$），$x=L$ 处的边界为无面力边界（自然边界条件）。连续系统的控制原理是线性动量守恒，有限维模型将使用有限元法（Finite Element Method, FEM）构建。\n\n将杆离散为 $2$ 个等长的双节点线性单元。从控制方程的强形式出发，通过乘以一个容许的测试函数并在全域上积分，得到其弱形式（变分形式），然后使用标准线性形函数的 Galerkin 投影来：\n\n- 通过对每个单元上的动能项进行积分，推导单元级一致质量矩阵。\n- 通过节点质量求和（行和法）对角化单元质量，构建单元级集中质量矩阵。\n- 为该双单元网格组装全局刚度矩阵和质量矩阵。\n- 在 $x=0$ 处施加本质边界条件，以获得关于保留节点自由度的降阶广义特征值问题。\n\n令 $\\omega_{\\text{cons}}$ 表示使用一致质量矩阵从降阶广义特征值问题中得到的最小（基频）角频率，令 $\\omega_{\\text{lump}}$ 表示使用集中质量矩阵得到的最小角频率。计算比值\n$$\nR \\equiv \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}\n$$\n将 $R$ 表示为无量纲量，并以根式形式给出尽可能简化的精确解析表达式。无需数值取整；请给出精确的最终答案。",
            "solution": "用户要求我扮演一位严谨的理工科教授，使用有限元法解决一个关于杆轴向振动的问题。\n\n### 问题验证\n\n首先，我将验证所提供的问题陈述。\n\n**步骤 1：提取已知条件**\n- **系统**：一根均匀直杆。\n- **参数**：长度 $L$、横截面积 $A$、杨氏模量 $E$、质量密度 $\\rho$。\n- **域**：空间坐标 $x \\in [0, L]$。\n- **物理背景**：一维轴向小应变线性弹性振动，无外部载荷。\n- **边界条件**：$x=0$ 处固定（$u(0,t)=0$），$x=L$ 处无面力。\n- **方法**：有限元法（FEM），使用 $2$ 个等长的双节点线性单元进行离散。\n- **任务**：\n    1. 推导单元级一致质量矩阵。\n    2. 通过节点质量求和构建单元级集中质量矩阵。\n    3. 组装全局刚度矩阵和质量矩阵。\n    4. 在 $x=0$ 处施加本质边界条件以获得降阶广义特征值问题。\n    5. 从一致质量公式中求出最小角频率 $\\omega_{\\text{cons}}$。\n    6. 从集中质量公式中求出最小角频率 $\\omega_{\\text{lump}}$。\n    7. 计算比值 $R \\equiv \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}$。\n- **输出要求**：比值 $R$ 必须是一个精确、简化、以根式表示的闭式解析表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题基于连续介质力学、结构动力学和有限元法的成熟原理。一致质量矩阵和集中质量矩阵的构建是计算力学中的一个标准课题。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的物理参数（$L, A, E, \\rho$）、边界条件和离散化细节（$2$ 个线性单元），从而可以为离散频率得到唯一解。固定边界条件防止了刚体运动，确保了振动频率不为零。\n- **客观性**：问题陈述使用了工程学和数学中精确、客观和标准的术语。没有主观或模糊的陈述。\n\n**步骤 3：结论与行动**\n该问题在科学上是合理的、适定的且客观的，因此是有效的。我将继续进行完整的求解推导。\n\n### 求解推导\n\n使用有限元法分析弹性体的自由振动，会得到以下广义特征值问题：\n$$(\\mathbf{K} - \\omega^2 \\mathbf{M})\\mathbf{d} = \\mathbf{0}$$\n其中 $\\mathbf{K}$ 是全局刚度矩阵，$\\mathbf{M}$ 是全局质量矩阵，$\\omega$ 是振动角频率，$\\mathbf{d}$ 是节点位移幅值向量。\n\n**1. 单元离散化与形函数**\n长度为 $L$ 的杆被离散成 $2$ 个等长单元。单元长度为 $h_e = L/2$。节点位于 $x_1=0$，$x_2=L/2$ 和 $x_3=L$。\n\n对于一个长度为 $h_e$ 的标准双节点线性单元，其轴向位移场 $u(x)$ 通过节点位移 $u_1$ 和 $u_2$ 以及线性形函数 $N_1(x)$ 和 $N_2(x)$ 进行插值。在局部坐标系 $\\xi \\in [-1, 1]$ 中，形函数为：\n$$N_1(\\xi) = \\frac{1-\\xi}{2}, \\quad N_2(\\xi) = \\frac{1+\\xi}{2}$$\n全局坐标 $x$（在单元内，从 $0$ 到 $h_e$）与局部坐标 $\\xi$ 之间的关系是 $x = \\frac{h_e}{2}(1+\\xi)$，这给出了 $dx = \\frac{h_e}{2}d\\xi$。微分算子变换为 $\\frac{d}{dx} = \\frac{d\\xi}{dx}\\frac{d}{d\\xi} = \\frac{2}{h_e}\\frac{d}{d\\xi}$。\n\n**2. 单元刚度矩阵**\n单元刚度矩阵 $\\mathbf{k}^e$ 由下式给出：\n$$k^e_{ij} = \\int_{0}^{h_e} E A \\frac{dN_i}{dx}\\frac{dN_j}{dx} dx$$\n形函数对 $x$ 的导数为：\n$$\\frac{dN_1}{dx} = -\\frac{1}{h_e}, \\quad \\frac{dN_2}{dx} = \\frac{1}{h_e}$$\n积分得到一维杆单元的著名刚度矩阵：\n$$\\mathbf{k}^e = E A \\int_{0}^{h_e} \\begin{pmatrix} (-1/h_e)^2  (-1/h_e)(1/h_e) \\\\ (1/h_e)(-1/h_e)  (1/h_e)^2 \\end{pmatrix} dx = \\frac{EA}{h_e} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$$\n由于 $h_e = L/2$，两个单元的单元刚度矩阵均为：\n$$\\mathbf{k}^e = \\frac{2EA}{L} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$$\n\n**3. 单元一致质量矩阵**\n单元一致质量矩阵 $\\mathbf{m}^e_{\\text{cons}}$ 由下式给出：\n$$m^e_{\\text{cons}, ij} = \\int_{0}^{h_e} \\rho A N_i(x) N_j(x) dx = \\int_{-1}^{1} \\rho A N_i(\\xi) N_j(\\xi) \\frac{h_e}{2} d\\xi$$\n积分计算结果为：\n$$\\int_{-1}^{1} N_1^2(\\xi) \\frac{h_e}{2} d\\xi = \\frac{h_e}{2} \\int_{-1}^{1} \\left(\\frac{1-\\xi}{2}\\right)^2 d\\xi = \\frac{h_e}{3}$$\n$$\\int_{-1}^{1} N_1(\\xi) N_2(\\xi) \\frac{h_e}{2} d\\xi = \\frac{h_e}{2} \\int_{-1}^{1} \\frac{1-\\xi^2}{4} d\\xi = \\frac{h_e}{6}$$\n因此，单元一致质量矩阵为：\n$$\\mathbf{m}^e_{\\text{cons}} = \\frac{\\rho A h_e}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$$\n当 $h_e = L/2$ 时，该矩阵变为：\n$$\\mathbf{m}^e_{\\text{cons}} = \\frac{\\rho A L}{12} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$$\n\n**4. 单元集中质量矩阵**\n集中质量矩阵通常通过将总单元质量 $M_e = \\rho A h_e$ 分配到节点来形成。一种常用方法，即行和集中法，包括将一致质量矩阵的每一行的元素求和，并将结果放在相应的对角线位置上。\n$$m^e_{\\text{lump}, ii} = \\sum_{j} m^e_{\\text{cons}, ij}$$\n第 1 行之和：$\\frac{\\rho A h_e}{6} (2+1) = \\frac{\\rho A h_e}{2}$。\n第 2 行之和：$\\frac{\\rho A h_e}{6} (1+2) = \\frac{\\rho A h_e}{2}$。\n这给出了一个对角矩阵：\n$$\\mathbf{m}^e_{\\text{lump}} = \\frac{\\rho A h_e}{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$$\n当 $h_e = L/2$ 时，该矩阵变为：\n$$\\mathbf{m}^e_{\\text{lump}} = \\frac{\\rho A L}{4} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$$\n\n**5. 全局矩阵的组装**\n全局矩阵是通过叠加单元 1（连接节点 1 和 2）和单元 2（连接节点 2 和 3）的贡献来组装的。全局系统有 3 个自由度（$u_1, u_2, u_3$）。\n\n全局刚度矩阵 $\\mathbf{K}$：\n$$\\mathbf{K} = \\frac{2EA}{L} \\begin{pmatrix} 1  -1  0 \\\\ -1  1+1  -1 \\\\ 0  -1  1 \\end{pmatrix} = \\frac{2EA}{L} \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix}$$\n全局一致质量矩阵 $\\mathbf{M}_{\\text{cons}}$：\n$$\\mathbf{M}_{\\text{cons}} = \\frac{\\rho AL}{12} \\begin{pmatrix} 2  1  0 \\\\ 1  2+2  1 \\\\ 0  1  2 \\end{pmatrix} = \\frac{\\rho AL}{12} \\begin{pmatrix} 2  1  0 \\\\ 1  4  1 \\\\ 0  1  2 \\end{pmatrix}$$\n全局集中质量矩阵 $\\mathbf{M}_{\\text{lump}}$：\n$$\\mathbf{M}_{\\text{lump}} = \\frac{\\rho AL}{4} \\begin{pmatrix} 1  0  0 \\\\ 0  1+1  0 \\\\ 0  0  1 \\end{pmatrix} = \\frac{\\rho AL}{4} \\begin{pmatrix} 1  0  0 \\\\ 0  2  0 \\\\ 0  0  1 \\end{pmatrix}$$\n\n**6. 施加边界条件**\n本质边界条件 $u(0,t)=0$ 对应于 $u_1=0$。通过从全局矩阵中移除第一行和第一列来施加此条件。剩余的自由度是 $u_2$ 和 $u_3$。\n\n降阶刚度矩阵 $\\mathbf{K}_{\\text{red}}$：\n$$\\mathbf{K}_{\\text{red}} = \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix}$$\n降阶一致质量矩阵 $\\mathbf{M}_{\\text{cons,red}}$：\n$$\\mathbf{M}_{\\text{cons,red}} = \\frac{\\rho AL}{12} \\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix}$$\n降阶集中质量矩阵 $\\mathbf{M}_{\\text{lump,red}}$：\n$$\\mathbf{M}_{\\text{lump,red}} = \\frac{\\rho AL}{4} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}$$\n\n**7. 求解特征值问题**\n现在我们必须对两种质量矩阵公式求解降阶特征值问题 $\\det(\\mathbf{K}_{\\text{red}} - \\omega^2 \\mathbf{M}_{\\text{red}}) = 0$。令 $\\lambda = \\omega^2$。\n\n**情况 A：一致质量**\n特征值问题为 $\\det(\\mathbf{K}_{\\text{red}} - \\lambda_{\\text{cons}} \\mathbf{M}_{\\text{cons,red}}) = 0$。\n$$\\det\\left( \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix} - \\lambda_{\\text{cons}} \\frac{\\rho AL}{12} \\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix} \\right) = 0$$\n令 $\\alpha = \\frac{2EA}{L}$ 且 $\\beta_c = \\frac{\\rho AL}{12}$。\n$$\\det \\begin{pmatrix} 2\\alpha - 4\\lambda_{\\text{cons}}\\beta_c  -\\alpha - \\lambda_{\\text{cons}}\\beta_c \\\\ -\\alpha - \\lambda_{\\text{cons}}\\beta_c  \\alpha - 2\\lambda_{\\text{cons}}\\beta_c \\end{pmatrix} = 0$$\n$$(2\\alpha - 4\\lambda_{\\text{cons}}\\beta_c)(\\alpha - 2\\lambda_{\\text{cons}}\\beta_c) - (-\\alpha - \\lambda_{\\text{cons}}\\beta_c)^2 = 0$$\n$$(2\\alpha^2 - 8\\alpha\\beta_c\\lambda_{\\text{cons}} + 8\\beta_c^2\\lambda_{\\text{cons}}^2) - (\\alpha^2 + 2\\alpha\\beta_c\\lambda_{\\text{cons}} + \\beta_c^2\\lambda_{\\text{cons}}^2) = 0$$\n$$7\\beta_c^2\\lambda_{\\text{cons}}^2 - 10\\alpha\\beta_c\\lambda_{\\text{cons}} + \\alpha^2 = 0$$\n$\\lambda_{\\text{cons}}$ 的根是：\n$$\\lambda_{\\text{cons}} = \\frac{10\\alpha\\beta_c \\pm \\sqrt{100\\alpha^2\\beta_c^2 - 4(7\\beta_c^2)(\\alpha^2)}}{14\\beta_c^2} = \\frac{\\alpha}{\\beta_c} \\frac{10 \\pm \\sqrt{72}}{14} = \\frac{\\alpha}{\\beta_c} \\frac{10 \\pm 6\\sqrt{2}}{14} = \\frac{\\alpha}{\\beta_c} \\frac{5 \\pm 3\\sqrt{2}}{7}$$\n基频对应于较小的特征值：\n$$\\omega_{\\text{cons}}^2 = \\lambda_{\\text{cons,min}} = \\frac{\\alpha}{\\beta_c} \\frac{5 - 3\\sqrt{2}}{7} = \\frac{2EA/L}{\\rho AL/12} \\frac{5 - 3\\sqrt{2}}{7} = \\frac{24E}{\\rho L^2} \\frac{5 - 3\\sqrt{2}}{7}$$\n\n**情况 B：集中质量**\n特征值问题为 $\\det(\\mathbf{K}_{\\text{red}} - \\lambda_{\\text{lump}} \\mathbf{M}_{\\text{lump,red}}) = 0$。\n$$\\det\\left( \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix} - \\lambda_{\\text{lump}} \\frac{\\rho AL}{4} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\right) = 0$$\n令 $\\beta_l = \\frac{\\rho AL}{4}$。\n$$\\det \\begin{pmatrix} 2\\alpha - 2\\lambda_{\\text{lump}}\\beta_l  -\\alpha \\\\ -\\alpha  \\alpha - \\lambda_{\\text{lump}}\\beta_l \\end{pmatrix} = 0$$\n$$(2\\alpha - 2\\lambda_{\\text{lump}}\\beta_l)(\\alpha - \\lambda_{\\text{lump}}\\beta_l) - \\alpha^2 = 0$$\n$$2\\alpha^2 - 4\\alpha\\beta_l\\lambda_{\\text{lump}} + 2\\beta_l^2\\lambda_{\\text{lump}}^2 - \\alpha^2 = 0$$\n$$2\\beta_l^2\\lambda_{\\text{lump}}^2 - 4\\alpha\\beta_l\\lambda_{\\text{lump}} + \\alpha^2 = 0$$\n$\\lambda_{\\text{lump}}$ 的根是：\n$$\\lambda_{\\text{lump}} = \\frac{4\\alpha\\beta_l \\pm \\sqrt{16\\alpha^2\\beta_l^2 - 4(2\\beta_l^2)(\\alpha^2)}}{4\\beta_l^2} = \\frac{\\alpha}{\\beta_l} \\frac{4 \\pm \\sqrt{8}}{4} = \\frac{\\alpha}{\\beta_l} \\frac{4 \\pm 2\\sqrt{2}}{4} = \\frac{\\alpha}{\\beta_l} \\frac{2 \\pm \\sqrt{2}}{2}$$\n基频对应于较小的特征值：\n$$\\omega_{\\text{lump}}^2 = \\lambda_{\\text{lump,min}} = \\frac{\\alpha}{\\beta_l} \\frac{2 - \\sqrt{2}}{2} = \\frac{2EA/L}{\\rho AL/4} \\frac{2 - \\sqrt{2}}{2} = \\frac{8E}{\\rho L^2} \\frac{2 - \\sqrt{2}}{2} = \\frac{4E}{\\rho L^2} (2 - \\sqrt{2})$$\n\n**8. 计算比值 R**\n所需的比值为 $R = \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}$。先计算 $R^2$ 会更简单。\n$$R^2 = \\frac{\\omega_{\\text{cons}}^2}{\\omega_{\\text{lump}}^2} = \\frac{\\frac{24E}{\\rho L^2} \\frac{5 - 3\\sqrt{2}}{7}}{\\frac{4E}{\\rho L^2} (2 - \\sqrt{2})} = \\frac{24}{4} \\frac{5 - 3\\sqrt{2}}{7(2 - \\sqrt{2})} = \\frac{6}{7} \\frac{5 - 3\\sqrt{2}}{2 - \\sqrt{2}}$$\n为简化分数，我们将分母有理化：\n$$\\frac{5 - 3\\sqrt{2}}{2 - \\sqrt{2}} = \\frac{(5 - 3\\sqrt{2})(2 + \\sqrt{2})}{(2 - \\sqrt{2})(2 + \\sqrt{2})} = \\frac{10 + 5\\sqrt{2} - 6\\sqrt{2} - 3(2)}{4 - 2} = \\frac{4 - \\sqrt{2}}{2}$$\n将此结果代回到 $R^2$ 的表达式中：\n$$R^2 = \\frac{6}{7} \\left( \\frac{4 - \\sqrt{2}}{2} \\right) = \\frac{3(4 - \\sqrt{2})}{7}$$\n最后，取平方根得到比值 $R$：\n$$R = \\sqrt{\\frac{3(4 - \\sqrt{2})}{7}}$$\n这就是该比值的精确、简化、闭式解析表达式。",
            "answer": "$$\\boxed{\\sqrt{\\frac{3(4 - \\sqrt{2})}{7}}}$$"
        },
        {
            "introduction": "在理想的一维模型之后，我们转向一个在二维情况下更现实的挑战：单元几何畸变。这项实践探讨了等参映射的雅可比矩阵（Jacobian）与集总质量方案中节点质量分布之间的联系，您将看到当使用朴素的行和法时，严重的单元扭曲如何导致不合理的质量分布。这项编码练习  提供了诊断与网格质量相关的数值病态问题的实践经验，并让您学习实施稳定化技术，如雅可比行列式平均化和裁剪，以确保获得一个稳健且物理上有意义的集总质量矩阵。",
            "id": "3551430",
            "problem": "考虑二维计算固体力学中的一个四节点双线性四边形有限元。从线性动量守恒和伽辽金法出发，节点位移向量 $\\mathbf{u}(t)$ 的半离散运动方程为\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{f}(t),\n$$\n其中 $\\mathbf{M}$ 是质量矩阵，$\\mathbf{K}$ 是刚度矩阵，$\\mathbf{f}(t)$ 是外力向量。对于一个四节点双线性四边形单元，其一致质量矩阵 $\\mathbf{M}_c$ 由以下域积分给出\n$$\n\\mathbf{M}_c = \\int_{\\Omega_e} \\rho\\,t\\, \\mathbf{N}^\\top \\mathbf{N}\\,\\mathrm{d}\\Omega,\n$$\n其中 $\\rho$ 是质量密度， $t$ 是厚度，$\\mathbf{N} = [N_1,N_2,N_3,N_4]$ 包含了双线性形函数，$\\Omega_e$ 是物理空间中的单元域。通过从具有坐标 $(\\xi,\\eta)$ 的参考正方形 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 到物理单元的等参映射 $\\mathbf{x}(\\xi,\\eta)$，该积分变换为\n$$\n\\mathbf{M}_c = \\int_{\\hat{\\Omega}} \\rho\\,t\\, \\mathbf{N}^\\top(\\xi,\\eta) \\mathbf{N}(\\xi,\\eta)\\, \\det(\\mathbf{J}(\\xi,\\eta))\\, \\mathrm{d}\\xi\\,\\mathrm{d}\\eta,\n$$\n其中 $\\mathbf{J}(\\xi,\\eta) = \\dfrac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)}$ 是映射的雅可比矩阵。集中质量矩阵 $\\mathbf{M}_\\ell$ 是 $\\mathbf{M}_c$ 的一种对角近似，其定义旨在保持单元总质量，同时将其重新分配到各个节点上。在高度扭曲的单元中，映射的雅可比矩阵 $\\mathbf{J}(\\xi,\\eta)$ 可能具有很大的条件数，如果朴素地计算，这可能会导致 $\\mathbf{M}_\\ell$ 出现病态的节点质量分布。您的任务是：\n- 推导一种通过在 $\\hat{\\Omega}$ 上使用双线性形函数和等参雅可比矩阵 $\\mathbf{J}(\\xi,\\eta)$ 进行数值积分来计算 $\\mathbf{M}_c$ 的算法。\n- 通过对 $\\mathbf{M}_c$ 应用行和集中法，构建一个对角集中质量矩阵 $\\mathbf{M}_\\ell$，并检验其节点质量分布。\n- 评估雅可比矩阵在 $2$-范数下的条件数 $\\kappa(\\mathbf{J}(\\xi,\\eta))$，其定义为 $\\kappa(\\mathbf{J}) = \\sigma_{\\max}(\\mathbf{J}) / \\sigma_{\\min}(\\mathbf{J})$，其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 是通过奇异值分解 (SVD) 获得的最大和最小奇异值。\n- 提出并实现两种缩放技术，用以在大的 $\\kappa(\\mathbf{J})$ 条件下稳定化集中质量矩阵 $\\mathbf{M}_\\ell$：\n  1. 行列式平均法 (均匀集中)：在集中过程中，用其单元平均值 $\\overline{\\det(\\mathbf{J})}$ 替换变量 $\\det(\\mathbf{J}(\\xi,\\eta))$，以获得均衡的节点质量，同时保持总质量不变。\n  2. 带重归一化的行列式裁剪：在积分点上逐点将 $\\det(\\mathbf{J}(\\xi,\\eta))$ 裁剪到区间 $[\\alpha\\,\\overline{\\det(\\mathbf{J})},\\,\\beta\\,\\overline{\\det(\\mathbf{J})}]$ 内，根据裁剪后的行列式构建对角矩阵 $\\mathbf{M}_\\ell$，然后重归一化该对角矩阵，使其总质量与 $\\mathbf{M}_c$ 的总质量相等。\n\n对于节点排序 $\\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$，在 $\\hat{\\Omega}$ 上使用以下双线性形函数：\n$$\nN_1(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_2(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_3(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_4(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta).\n$$\n等参映射为 $\\mathbf{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,\\mathbf{x}_i$，其中 $\\mathbf{x}_i$ 是物理节点坐标。雅可比矩阵为\n$$\n\\mathbf{J}(\\xi,\\eta) = \n\\begin{bmatrix}\n\\sum_{i=1}^{4} \\dfrac{\\partial N_i}{\\partial \\xi}(\\xi,\\eta)\\,x_i  \\sum_{i=1}^{4} \\dfrac{\\partial N_i}{\\partial \\eta}(\\xi,\\eta)\\,x_i \\\\\n\\sum_{i=1}^{4} \\dfrac{\\partial N_i}{\\partial \\xi}(\\xi,\\eta)\\,y_i  \\sum_{i=1}^{4} \\dfrac{\\partial N_i}{\\partial \\eta}(\\xi,\\eta)\\,y_i\n\\end{bmatrix}.\n$$\n\n数值设置：\n- 使用质量密度 $\\rho = 7800\\,\\mathrm{kg/m^3}$ 和厚度 $t = 0.01\\,\\mathrm{m}$。\n- 为计算 $\\mathbf{M}_c$，使用一个 $2\\times 2$ 点的张量积高斯-勒让德积分，积分点位于 $\\xi,\\eta \\in \\{\\pm 1/\\sqrt{3}\\}$，且在参考域中的权重为单位权重。\n- 为评估 $\\kappa(\\mathbf{J})$，在 $\\hat{\\Omega}$ 上采样一个 $9\\times 9$ 的均匀网格，并报告最大采样条件数。\n- 对于行列式裁剪，使用 $\\alpha = 0.5$ 和 $\\beta = 2.0$.\n\n测试套件：\n为以下四个单元计算所需量，其物理节点坐标（单位：米）按 $\\mathbf{x}_1,\\mathbf{x}_2,\\mathbf{x}_3,\\mathbf{x}_4$ 的顺序给出，对应于参考节点 $\\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$：\n- 案例 A (基准正方形): $\\mathbf{x}_1 = (0, 0)$, $\\mathbf{x}_2 = (1, 0)$, $\\mathbf{x}_3 = (1, 1)$, $\\mathbf{x}_4 = (0, 1)$.\n- 案例 B (严重倾斜的梯形): $\\mathbf{x}_1 = (0, 0)$, $\\mathbf{x}_2 = (100, 0)$, $\\mathbf{x}_3 = (100, 1)$, $\\mathbf{x}_4 = (0, 0.02)$.\n- 案例 C (高度扭曲的梯形): $\\mathbf{x}_1 = (0, 0)$, $\\mathbf{x}_2 = (2, 0)$, $\\mathbf{x}_3 = (1.6, 0.02)$, $\\mathbf{x}_4 = (0.1, 0.98)$.\n- 案例 D (近简并顶边): $\\mathbf{x}_1 = (0, 0)$, $\\mathbf{x}_2 = (1, 0)$, $\\mathbf{x}_3 = (1, 0.01)$, $\\mathbf{x}_4 = (0, 1)$.\n\n对于每种情况，计算：\n- 在 $9\\times 9$ 网格上的最大采样雅可比矩阵条件数 $\\kappa_{\\max}$。\n- 一致质量矩阵的 $2$-范数条件数 $\\kappa(\\mathbf{M}_c)$。\n- 行和集中法得到的 $\\mathbf{M}_\\ell$ 的比率 $r_{\\text{naive}} = \\max_i (M_{\\ell,ii}) / \\min_i (M_{\\ell,ii})$。\n- 行列式平均法 (均匀集中) 的比率 $r_{\\text{uniform}}$。\n- 带重归一化的行列式裁剪法的比率 $r_{\\text{clipped}}$。\n\n所有比率和条件数都是无量纲的。您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个案例对应一个包含五个浮点数的内部列表，这些浮点数按 $[\\kappa_{\\max}, \\kappa(\\mathbf{M}_c), r_{\\text{naive}}, r_{\\text{uniform}}, r_{\\text{clipped}}]$ 的顺序排列，并四舍五入到六位小数。例如，输出格式必须类似于 $[[a_1,a_2,a_3,a_4,a_5],[b_1,b_2,b_3,b_4,b_5],[c_1,c_2,c_3,c_4,c_5],[d_1,d_2,d_3,d_4,d_5]]$。",
            "solution": "该问题要求计算和分析一个四节点双线性四边形有限元的一致质量矩阵和集中质量矩阵，特别关注对具有显著几何畸变的单元的稳定化技术。解决方案涉及实现质量矩阵的有限元公式，评估畸变和稳定性的度量指标，并应用校正算法。\n\n### 1. 预备知识：双线性四边形单元\n\n分析在一个四节点四边形单元上进行。单元的几何形状和位移场通过等参映射从其节点值插值得到。从具有局部坐标 $(\\xi,\\eta)$ 的参考正方形域 $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ 到具有全局坐标 $\\mathbf{x}=(x,y)$ 的物理域 $\\Omega_e$ 的映射由下式给出：\n$$ \\mathbf{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,\\mathbf{x}_i $$\n其中 $\\mathbf{x}_i$ 是四个节点的坐标，而 $N_i(\\xi,\\eta)$ 是双线性形函数。对于节点排序为 $\\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$ 的形函数为：\n$$\n\\begin{aligned}\nN_1(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1-\\eta) \\\\\nN_2(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta) \\\\\nN_3(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1+\\eta) \\\\\nN_4(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta)\n\\end{aligned}\n$$\n这些形函数的一个关键特性是它们构成了单位分解，即对于所有的 $(\\xi,\\eta)$，都有 $\\sum_{i=1}^{4} N_i(\\xi,\\eta) = 1$。\n\n该变换由雅可比矩阵 $\\mathbf{J}$ 进行局部描述，它关联了物理坐标系和参考坐标系中的导数：\n$$\n\\mathbf{J}(\\xi,\\eta) = \\frac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)} = \n\\begin{bmatrix}\n\\partial x/\\partial \\xi  \\partial x/\\partial \\eta \\\\\n\\partial y/\\partial \\xi  \\partial y/\\partial \\eta\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} x_i  \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} x_i \\\\\n\\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} y_i  \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} y_i\n\\end{bmatrix}\n$$\n微分面积元变换为 $\\mathrm{d}\\Omega = \\det(\\mathbf{J}(\\xi,\\eta))\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$。非均匀的 $\\det(\\mathbf{J})$ 意味着几何畸变。\n\n### 2. 一致质量矩阵及其条件数\n\n一致质量矩阵 $\\mathbf{M}_c$ 是从运动方程弱形式中的动能项推导出来的。对于一个标量场（如温度，或作为矢量位移场的基础），$4\\times 4$ 的一致质量矩阵为：\n$$ \\mathbf{M}_c = \\int_{\\Omega_e} \\rho t \\mathbf{N}^\\top \\mathbf{N} \\, \\mathrm{d}\\Omega = \\int_{-1}^{1}\\int_{-1}^{1} \\rho t \\mathbf{N}^\\top(\\xi,\\eta) \\mathbf{N}(\\xi,\\eta) \\det(\\mathbf{J}(\\xi,\\eta)) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta $$\n其中 $\\rho$ 是密度， $t$ 是厚度，$\\mathbf{N} = [N_1, N_2, N_3, N_4]$。该积分使用 $2 \\times 2$ 的高斯-勒让德求积法则进行数值计算。积分点为 $(\\xi_q, \\eta_q)$（对于 $q=1, \\dots, 4$ 位于坐标 $(\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$），并且所有权重 $w_q$ 均为 $1$。该矩阵近似为：\n$$ \\mathbf{M}_c \\approx \\rho t \\sum_{q=1}^{4} w_q \\left[ \\mathbf{N}^\\top(\\xi_q, \\eta_q) \\mathbf{N}(\\xi_q, \\eta_q) \\det(\\mathbf{J}(\\xi_q, \\eta_q)) \\right] $$\n条件数 $\\kappa(\\mathbf{M}_c)$ 使用矩阵的 $2$-范数计算，即其最大奇异值与最小奇异值之比（由于 $\\mathbf{M}_c$ 是对称正定矩阵，也即最大与最小特征值之比）。大的条件数表明矩阵接近奇异，这可能导致数值问题。\n\n### 3. 雅可比矩阵条件数\n\n雅可比矩阵的条件数 $\\kappa(\\mathbf{J}) = \\sigma_{\\max}(\\mathbf{J}) / \\sigma_{\\min}(\\mathbf{J})$ 度量了从参考正方形到物理单元映射的畸变程度。$\\kappa(\\mathbf{J})=1$ 的值对应于局部保持形状的映射（即旋转和均匀缩放），而大的值则表示严重的剪切或拉伸。我们在 $\\hat{\\Omega}$ 中的一个 $9 \\times 9$ 点网格上评估该量，并报告其最大值 $\\kappa_{\\max}$。\n\n### 4. 质量集中技术\n\n对于显式时间积分格式，对角（集中）质量矩阵是非常理想的，因为其求逆过程微不足道。\n\n#### 4.1. 朴素行和集中法\n这是最常见的集中技术。集中质量矩阵 $\\mathbf{M}_\\ell$ 的对角线元素是一致质量矩阵 $\\mathbf{M}_c$ 的行和：\n$$ M_{\\ell,ii} = \\sum_{j=1}^{4} M_{c,ij} $$\n利用单位分解特性（$\\sum_j N_j = 1$），这可以简化为一个高效的计算：\n$$ M_{\\ell,ii} = \\int_{\\Omega_e} \\rho t N_i \\left( \\sum_{j=1}^{4} N_j \\right) \\mathrm{d}\\Omega = \\int_{\\Omega_e} \\rho t N_i \\mathrm{d}\\Omega = \\int_{\\hat{\\Omega}} \\rho t N_i(\\xi, \\eta) \\det(\\mathbf{J}(\\xi,\\eta)) \\,\\mathrm{d}\\xi \\mathrm{d}\\eta $$\n数值上：\n$$ M_{\\ell,ii}^{(\\text{naive})} = \\rho t \\sum_{q=1}^{4} w_q N_i(\\xi_q, \\eta_q) \\det(\\mathbf{J}(\\xi_q, \\eta_q)) $$\n在高度畸变的单元中，$\\det(\\mathbf{J})$ 的变化可能导致质量分布不佳，甚至可能在节点上出现不符合物理规律的负质量，尽管对于双线性形函数和非反转单元而言，这种情况不会发生。比率 $r_{\\text{naive}} = \\max_i(M_{\\ell,ii}) / \\min_i(M_{\\ell,ii})$ 度量了这种分布的不均匀性。\n\n#### 4.2. 稳定化集中法 1：行列式平均法\n为了抵消变化的雅可比行列式的影响，该方法用其在单元上的平均值 $\\overline{\\det(\\mathbf{J})} = A_e / A_{\\hat{\\Omega}}$ 来代替逐点的行列式 $\\det(\\mathbf{J})$，其中 $A_e$ 是物理单元面积，$A_{\\hat{\\Omega}}=4$ 是参考单元面积。\n物理面积为 $A_e = \\int_{\\hat{\\Omega}} \\det(\\mathbf{J}) \\,\\mathrm{d}\\xi\\mathrm{d}\\eta \\approx \\sum_q w_q \\det(\\mathbf{J}_q)$。\n因此，$\\overline{\\det(\\mathbf{J})} \\approx \\frac{1}{4}\\sum_q w_q \\det(\\mathbf{J}_q)$。则节点质量为：\n$$ M_{\\ell,ii}^{(\\text{uniform})} = \\rho t \\sum_{q=1}^{4} w_q N_i(\\xi_q, \\eta_q) \\overline{\\det(\\mathbf{J})} = \\rho t \\overline{\\det(\\mathbf{J})} \\sum_{q=1}^{4} w_q N_i(\\xi_q, \\eta_q) $$\n由于 $2 \\times 2$ 高斯积分能够精确地对参考域上的双线性形函数进行积分，$\\sum_q w_q N_i(\\xi_q, \\eta_q) = \\int_{\\hat{\\Omega}} N_i \\,\\mathrm{d}\\xi\\mathrm{d}\\eta = 1$。\n这可以简化为 $M_{\\ell,ii}^{(\\text{uniform})} = \\rho t \\overline{\\det(\\mathbf{J})} = \\rho t A_e / 4$。所有节点质量相等，从而得到比率 $r_{\\text{uniform}} = 1$。此方法保持了总质量。\n\n#### 4.3. 稳定化集中法 2：行列式裁剪与重归一化\n该方法在朴素法和均匀平均法之间提供了一种折衷。它限制了 $\\det(\\mathbf{J})$ 极端局部变化的影响，同时仍保留了一些局部特征。\n1.  **裁剪**：在每个积分点 $q$ 处，行列式 $\\det(\\mathbf{J}_q)$ 被裁剪到由平均行列式的因子 $\\alpha$ 和 $\\beta$ 定义的范围内：\n    $$ \\det(\\mathbf{J}_q)^{\\text{clipped}} = \\max(\\alpha \\overline{\\det(\\mathbf{J})}, \\min(\\det(\\mathbf{J}_q), \\beta \\overline{\\det(\\mathbf{J})})) $$\n2.  **预计算**：使用这些裁剪后的行列式计算未缩放的集中质量：\n    $$ \\tilde{M}_{\\ell,ii}^{(\\text{clipped})} = \\rho t \\sum_{q=1}^{4} w_q N_i(\\xi_q, \\eta_q) \\det(\\mathbf{J}_q)^{\\text{clipped}} $$\n3.  **重归一化**：此过程得到的总质量 $\\tilde{M}_{\\text{total}} = \\sum_i \\tilde{M}_{\\ell,ii}^{(\\text{clipped})}$ 通常与真实的单元质量 $M_{\\text{total}} = \\rho t A_e$ 不匹配。计算一个缩放因子 $\\gamma = M_{\\text{total}} / \\tilde{M}_{\\text{total}}$ 并应用它来强制质量守恒：\n    $$ M_{\\ell,ii}^{(\\text{clipped})} = \\gamma \\, \\tilde{M}_{\\ell,ii}^{(\\text{clipped})} $$\n然后根据这些最终的质量值计算比率 $r_{\\text{clipped}}$。该方案在调节质量分布的同时，严格保持了单元的总质量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases and print results.\n    \"\"\"\n\n    def compute_element_properties(coords, rho, t, alpha, beta):\n        \"\"\"\n        Computes the required quantities for a single quadrilateral element.\n\n        Args:\n            coords (np.ndarray): 4x2 array of nodal coordinates.\n            rho (float): Mass density.\n            t (float): Element thickness.\n            alpha (float): Lower bound factor for determinant clipping.\n            beta (float): Upper bound factor for determinant clipping.\n\n        Returns:\n            tuple: A 5-tuple containing [k_max_J, k_Mc, r_naive, r_uniform, r_clipped].\n        \"\"\"\n\n        # Quadrature points (2x2 Gauss-Legendre)\n        gp_val = 1.0 / np.sqrt(3.0)\n        gauss_points = np.array([\n            [-gp_val, -gp_val],\n            [gp_val, -gp_val],\n            [gp_val, gp_val],\n            [-gp_val, gp_val]\n        ])\n        gauss_weights = np.array([1.0, 1.0, 1.0, 1.0])\n        num_gp = len(gauss_points)\n\n        def shape_functions(xi, eta):\n            N = np.zeros(4)\n            N[0] = 0.25 * (1 - xi) * (1 - eta)\n            N[1] = 0.25 * (1 + xi) * (1 - eta)\n            N[2] = 0.25 * (1 + xi) * (1 + eta)\n            N[3] = 0.25 * (1 - xi) * (1 + eta)\n            return N\n\n        def shape_function_derivatives(xi, eta):\n            dNdxi = np.zeros(4)\n            dNdeta = np.zeros(4)\n            dNdxi[0] = -0.25 * (1 - eta)\n            dNdxi[1] = 0.25 * (1 - eta)\n            dNdxi[2] = 0.25 * (1 + eta)\n            dNdxi[3] = -0.25 * (1 + eta)\n            dNdeta[0] = -0.25 * (1 - xi)\n            dNdeta[1] = -0.25 * (1 + xi)\n            dNdeta[2] = 0.25 * (1 + xi)\n            dNdeta[3] = 0.25 * (1 - xi)\n            return dNdxi, dNdeta\n\n        def jacobian(xi, eta, node_coords):\n            dNdxi, dNdeta = shape_function_derivatives(xi, eta)\n            J = np.zeros((2, 2))\n            J[0, 0] = np.dot(dNdxi, node_coords[:, 0])  # dx/dxi\n            J[0, 1] = np.dot(dNdeta, node_coords[:, 0]) # dx/deta\n            J[1, 0] = np.dot(dNdxi, node_coords[:, 1])  # dy/dxi\n            J[1, 1] = np.dot(dNdeta, node_coords[:, 1]) # dy/deta\n            return J\n\n        # --- 1. Max Jacobian Condition Number ---\n        grid_points = np.linspace(-1, 1, 9)\n        kappa_J_values = []\n        for xi in grid_points:\n            for eta in grid_points:\n                J = jacobian(xi, eta, coords)\n                singular_values = np.linalg.svd(J, compute_uv=False)\n                if singular_values[1]  1e-12:\n                    # Handle singular or near-singular case\n                    kappa_J = np.inf\n                else:\n                    kappa_J = singular_values[0] / singular_values[1]\n                kappa_J_values.append(kappa_J)\n        k_max_J = np.max(kappa_J_values)\n        \n        # --- Pre-computation at Gauss points ---\n        N_at_gp = np.array([shape_functions(gp[0], gp[1]) for gp in gauss_points])\n        detJ_at_gp = np.array([np.linalg.det(jacobian(gp[0], gp[1], coords)) for gp in gauss_points])\n\n        # --- 2. Consistent Mass Matrix Condition Number ---\n        M_c = np.zeros((4, 4))\n        for q in range(num_gp):\n            N_q = N_at_gp[q, :].reshape(4, 1)\n            M_c += rho * t * (N_q @ N_q.T) * detJ_at_gp[q] * gauss_weights[q]\n        k_Mc = np.linalg.cond(M_c)\n\n        # Total element area and mass\n        area = np.sum(detJ_at_gp * gauss_weights)\n        total_mass = rho * t * area\n\n        # --- 3. Naive Row-Sum Lumping ---\n        M_l_naive = np.zeros(4)\n        for i in range(4):\n            M_l_naive[i] = rho * t * np.sum(N_at_gp[:, i] * detJ_at_gp * gauss_weights)\n        \n        if np.min(M_l_naive) > 1e-12:\n             r_naive = np.max(M_l_naive) / np.min(M_l_naive)\n        else:\n             r_naive = np.inf\n\n        # --- 4. Uniform Lumping ---\n        # All nodal masses are equal (total_mass / 4), so ratio is 1.0\n        r_uniform = 1.0\n\n        # --- 5. Determinant Clipping with Renormalization ---\n        detJ_avg = area / np.sum(gauss_weights)\n        detJ_min_clip = alpha * detJ_avg\n        detJ_max_clip = beta * detJ_avg\n        \n        detJ_clipped = np.clip(detJ_at_gp, detJ_min_clip, detJ_max_clip)\n\n        M_l_clipped_unscaled = np.zeros(4)\n        for i in range(4):\n            M_l_clipped_unscaled[i] = rho * t * np.sum(N_at_gp[:, i] * detJ_clipped * gauss_weights)\n\n        total_mass_clipped = np.sum(M_l_clipped_unscaled)\n        \n        renorm_factor = 1.0\n        if total_mass_clipped > 1e-12:\n            renorm_factor = total_mass / total_mass_clipped\n        \n        M_l_clipped = M_l_clipped_unscaled * renorm_factor\n        \n        if np.min(M_l_clipped) > 1e-12:\n            r_clipped = np.max(M_l_clipped) / np.min(M_l_clipped)\n        else:\n            r_clipped = np.inf\n\n        return k_max_J, k_Mc, r_naive, r_uniform, r_clipped\n\n    # Numerical settings from problem statement\n    RHO = 7800.0  # kg/m^3\n    T = 0.01     # m\n    ALPHA = 0.5\n    BETA = 2.0\n\n    # Test cases: physical node coordinates (x1, x2, x3, x4)\n    test_cases = [\n        # Case A: Baseline square\n        np.array([[0, 0], [1, 0], [1, 1], [0, 1]]),\n        # Case B: Severely slanted trapezoid\n        np.array([[0, 0], [100, 0], [100, 1], [0, 0.02]]),\n        # Case C: Highly skewed trapezoid\n        np.array([[0, 0], [2, 0], [1.6, 0.02], [0.1, 0.98]]),\n        # Case D: Near-degenerate top edge\n        np.array([[0, 0], [1, 0], [1, 0.01], [0, 1]]),\n    ]\n    \n    results = []\n    for coords in test_cases:\n        case_results = compute_element_properties(coords, RHO, T, ALPHA, BETA)\n        formatted_results = [f\"{val:.6f}\" for val in case_results]\n        results.append(f\"[{','.join(formatted_results)}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们将分析尺度提升至一个完整的三维问题，其中包含非均匀材料，这是工程设计中的常见情景。这个问题将理论与计算紧密结合，要求您首先基于矩阵微扰理论推导集总质量的理论误差界，然后通过计算进行验证。这项练习  突显了材料的非均匀性如何影响集总质量近似的精度。完成这项练习将培养您在理论误差分析和有限元分析（FEA）实际实现方面的技能，并展示如何在复杂的三维模拟中量化计算效率（集总矩阵）与精度（一致矩阵）之间的权衡。",
            "id": "3551420",
            "problem": "考虑一个使用八节点六面体有限元通过有限元法（FEM）离散的三维弹性固体的自由振动。小振幅线性弹性动力学的控制方程源自 Newton 第二定律和 Cauchy 动量平衡。在无外部体力的情况下，其强形式由下式给出\n$$\n\\rho(\\mathbf{x}) \\, \\ddot{\\mathbf{u}}(\\mathbf{x},t) = \\nabla \\cdot \\boldsymbol{\\sigma}(\\mathbf{x},t) \\quad \\text{in} \\quad \\Omega ,\n$$\n其线性弹性本构关系为\n$$\n\\boldsymbol{\\sigma}(\\mathbf{x},t) = \\mathbf{C} : \\boldsymbol{\\varepsilon}(\\mathbf{x},t), \\quad \\boldsymbol{\\varepsilon}(\\mathbf{x},t) = \\frac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right) ,\n$$\n其中 $\\rho(\\mathbf{x})$ 是质量密度场，$\\mathbf{u}(\\mathbf{x},t)$ 是位移，$\\boldsymbol{\\varepsilon}$ 是小应变张量，$\\boldsymbol{\\sigma}$ 是 Cauchy 应力张量，$\\mathbf{C}$ 是各向同性材料的四阶 Hooke 张量，其杨氏模量为 $E$，泊松比为 $\\nu$。利用虚功原理得到的弱形式，可推导出半离散有限元方程\n$$\n\\mathbf{M}\\, \\ddot{\\mathbf{d}}(t) + \\mathbf{K}\\,\\mathbf{d}(t) = \\mathbf{0},\n$$\n其中 $\\mathbf{d}(t)$ 是 $\\mathbb{R}^{n}$ 中的节点位移向量，$\\mathbf{K} \\in \\mathbb{R}^{n \\times n}$ 是对称正定刚度矩阵，$\\mathbf{M} \\in \\mathbb{R}^{n \\times n}$ 是对称正定质量矩阵。自由振动模态满足广义特征值问题\n$$\n\\mathbf{K} \\, \\boldsymbol{\\phi}_i = \\omega_i^2 \\, \\mathbf{M} \\, \\boldsymbol{\\phi}_i ,\n$$\n其中 $\\omega_i$ 是固有圆频率，$\\boldsymbol{\\phi}_i$ 是振型。\n\n在采用八节点六面体单元和线性插值函数的有限元法中，一致质量矩阵 $\\mathbf{M}_c$ 定义为\n$$\n(\\mathbf{M}_c)_{IJ} = \\int_{\\Omega} \\rho(\\mathbf{x}) \\, \\mathbf{N}_I(\\mathbf{x})^{\\top} \\mathbf{N}_J(\\mathbf{x}) \\, \\mathrm{d}\\Omega ,\n$$\n其中 $\\mathbf{N}_I(\\mathbf{x}) \\in \\mathbb{R}^{3 \\times 3}$ 表示节点 $I$ 的块对角向量值形函数矩阵。行和集中质量矩阵 $\\mathbf{M}_{\\ell}$ 的定义是将 $\\mathbf{M}_c$ 的行和置于对角线上，即\n$$\n(\\mathbf{M}_{\\ell})_{II} = \\sum_{J=1}^{n} (\\mathbf{M}_c)_{IJ}, \\quad (\\mathbf{M}_{\\ell})_{IJ} = 0 \\ \\text{for} \\ I \\neq J.\n$$\n\n任务 A（推导）：从上述弱形式和定义出发，推导一个关于密度场 $\\rho(\\mathbf{x})$ 的条件，以保证使用 $\\mathbf{M}_c$ 和 $\\mathbf{M}_{\\ell}$ 计算出的前 $k$ 个固有频率保持在指定的相对容差 $\\tau \\in (0,1)$ 内；即，\n$$\n\\max_{1 \\le i \\le k} \\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} \\le \\tau .\n$$\n您的条件必须以一个可计算的界的形式陈述，该界涉及扰动 $\\Delta \\mathbf{M} := \\mathbf{M}_{\\ell} - \\mathbf{M}_c$ 以及从 $\\rho(\\mathbf{x})$、形函数和网格几何中导出的量。您可以在推导过程中使用广义特征值问题的标准对称矩阵扰动结果，但必须清楚地指明所有假设。使用在离散系统上标准且可计算的范数来表示任何界。不要使用或假设任何目标答案公式；相反，应从第一性原理和经过充分检验的事实出发进行推导。\n\n任务 B（计算与比较）：实现一个程序，构建并分析一个三维矩形块 $\\Omega = [0,L_x] \\times [0,L_y] \\times [0,L_z]$，其中 $L_x = 1 \\ \\mathrm{m}$，$L_y = 0.1 \\ \\mathrm{m}$，$L_z = 0.1 \\ \\mathrm{m}$，该矩形块通过一个具有 $2 \\times 1 \\times 1$ 个八节点单元的结构化六面体网格进行离散。材料为线性弹性各向同性，其 $E = 70 \\times 10^9 \\ \\mathrm{Pa}$ 且 $\\nu = 0.34$。在 $x = 0 \\ \\mathrm{m}$ 的面上施加齐次 Dirichlet 边界条件（完全固支），并使所有其他面无牵引力。使用标准的 $2 \\times 2 \\times 2$ Gauss 积分来组装全局刚度矩阵 $\\mathbf{K}$。对于质量矩阵，组装：\n- 使用相同的积分方法组装完全一致质量矩阵 $\\mathbf{M}_c$，以及\n- 通过将 $\\mathbf{M}_c$ 的每一行求和到其对角线来获得的行和集中质量矩阵 $\\mathbf{M}_{\\ell}$。\n\n对于每个指定的密度场 $\\rho(\\mathbf{x})$，分别使用 $\\mathbf{M}_c$ 和 $\\mathbf{M}_{\\ell}$ 求解广义对称特征值问题，以得到前 $k$ 个最小正频率，并计算前 $k$ 个频率的相对误差。两者使用相同的 $\\mathbf{K}$。频率单位为弧度/秒，但您无需报告它们；仅需报告相对误差和布尔检查，因此不需要报告单位。\n\n任务 C（测试套件与输出）：使用以下三个密度场作为测试套件，每个密度场均以 $\\mathrm{kg/m^3}$ 为单位表示：\n- 情况1：每个单元上分段常数，值为 $[7800, 7800]$。\n- 情况2：每个单元上分段常数，值为 $[7800, 8190]$。\n- 情况3：每个单元上分段常数，值为 $[7800, 19500]$。\n\n对所有情况，使用 $k = 5$ 和 $\\tau = 0.08$ 作为目标容差。对于每种情况，计算一个布尔值：当且仅当使用 $\\mathbf{M}_{\\ell}$ 计算的前 $k$ 个频率满足相对于使用 $\\mathbf{M}_c$ 计算的频率的容差条件时，该值为 $true$，否则为 $false$。此外，请确保您的实现在内部计算基于谱范数的质量扰动度量\n$$\n\\epsilon_M := \\left\\| \\mathbf{M}_c^{-1/2} \\, \\Delta \\mathbf{M} \\, \\mathbf{M}_c^{-1/2} \\right\\|_2 ,\n$$\n（您无需打印它），因为它出现在您任务 A 的推导中。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\text{true},\\text{false},\\text{true}]$），按上面列出的顺序对应三种情况。输出值必须是小写的布尔字面量 $true$ 或 $false$。\n\n所有物理输入必须以国际单位制（SI）处理。如果需要，角度必须以弧度为单位。百分比必须表示为小数，而不是使用百分号。最终输出必须严格遵循指定格式的单行文本，不得包含任何额外文本。",
            "solution": "这个问题的全面解决方案包括两个主要部分：质量集总误差界的理论推导（任务 A）和一个计算实现，用于针对一个具体的工程问题验证此关系（任务 B 和 C）。\n\n### A部分：频率误差界的推导\n\n此任务的目标是推导一个关于材料密度场 $\\rho(\\mathbf{x})$ 的条件，该条件保证使用集中质量矩阵 ($\\mathbf{M}_{\\ell}$) 计算的固有频率与使用一致质量矩阵 ($\\mathbf{M}_c$) 计算的固有频率之间的差异保持在指定的相对容差 $\\tau$ 内。\n\n自由振动分析由广义特征值问题描述：\n$$\n\\mathbf{K} \\boldsymbol{\\phi}_i = \\omega_i^2 \\mathbf{M} \\boldsymbol{\\phi}_i\n$$\n其中 $\\mathbf{K}$ 是刚度矩阵，$\\mathbf{M}$ 是质量矩阵，$\\omega_i$ 是固有频率，$\\boldsymbol{\\phi}_i$ 是振型。令 $\\lambda_i = \\omega_i^2$。我们有两个不同的系统：\n1.  **一致系统**： $\\mathbf{K} \\boldsymbol{\\phi}_i^{(c)} = \\lambda_i^{(c)} \\mathbf{M}_c \\boldsymbol{\\phi}_i^{(c)}$\n2.  **集总系统**： $\\mathbf{K} \\boldsymbol{\\phi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} \\mathbf{M}_{\\ell} \\boldsymbol{\\phi}_i^{(\\ell)}$\n\n在这里，$\\mathbf{K}$ 是对称半正定的（在施加边界条件后，在容许位移空间上是正定的），对于一个具有正密度 $\\rho(\\mathbf{x})  0$ 的物理现实系统，$\\mathbf{M}_c$ 和 $\\mathbf{M}_{\\ell}$ 都是对称正定的。集中质量矩阵通过 $\\mathbf{M}_{\\ell} = \\mathbf{M}_c + \\Delta\\mathbf{M}$ 与一致质量矩阵相关联，其中 $\\Delta\\mathbf{M}$ 是扰动矩阵。\n\n为了分析扰动 $\\Delta\\mathbf{M}$ 的影响，我们可以将广义特征值问题转换为标准形式。由于 $\\mathbf{M}_c$ 是对称正定的，它允许进行 Cholesky 分解 $\\mathbf{M}_c = \\mathbf{L}\\mathbf{L}^{\\top}$，其中 $\\mathbf{L}$ 是一个下三角矩阵。我们也可以使用矩阵平方根 $\\mathbf{M}_c^{1/2}$，它也是对称正定的。让 $\\mathbf{M}_c^{1/2}$ 表示这个矩阵平方根。\n\n对一致系统应用变换 $\\boldsymbol{\\phi} = \\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}$ 得到：\n$$\n\\mathbf{K} (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(c)}) = \\lambda_i^{(c)} \\mathbf{M}_c (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(c)})\n$$\n左乘 $\\mathbf{M}_c^{-1/2}$ 给出标准对称特征值问题：\n$$\n(\\mathbf{M}_c^{-1/2} \\mathbf{K} \\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(c)} = \\lambda_i^{(c)} \\boldsymbol{\\psi}_i^{(c)} \\implies \\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(c)} = \\lambda_i^{(c)} \\boldsymbol{\\psi}_i^{(c)}\n$$\n其中 $\\tilde{\\mathbf{K}} = \\mathbf{M}_c^{-1/2} \\mathbf{K} \\mathbf{M}_c^{-1/2}$ 是对称的。\n\n对集总系统应用相同的变换：\n$$\n\\mathbf{K} (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(\\ell)}) = \\lambda_i^{(\\ell)} (\\mathbf{M}_c + \\Delta\\mathbf{M}) (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(\\ell)})\n$$\n左乘 $\\mathbf{M}_c^{-1/2}$：\n$$\n\\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} (\\mathbf{M}_c^{-1/2}(\\mathbf{M}_c + \\Delta\\mathbf{M})\\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(\\ell)}\n$$\n$$\n\\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} (\\mathbf{I} + \\mathbf{M}_c^{-1/2} \\Delta\\mathbf{M} \\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(\\ell)}\n$$\n令 $\\Delta\\tilde{\\mathbf{M}} = \\mathbf{M}_c^{-1/2} \\Delta\\mathbf{M} \\mathbf{M}_c^{-1/2}$。集总系统等价于广义特征值问题 $\\tilde{\\mathbf{K}} \\boldsymbol{\\psi} = \\lambda_{\\ell} (\\mathbf{I} + \\Delta\\tilde{\\mathbf{M}}) \\boldsymbol{\\psi}$。\n\nCourant-Fischer 极小极大定理提供了特征值的刻画。对于原始的矩阵束，特征值由 Rayleigh 商给出：\n$$\n\\lambda_i^{(c)} = \\min_{\\text{dim}(S)=i} \\max_{\\mathbf{d} \\in S \\setminus \\{0\\}} \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\n\\quad \\text{and} \\quad\n\\lambda_i^{(\\ell)} = \\min_{\\text{dim}(S)=i} \\max_{\\mathbf{d} \\in S \\setminus \\{0\\}} \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}\n$$\n我们可以将这两个 Rayleigh 商联系起来。让我们分析分母的比率：\n$$\n\\frac{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = \\frac{\\mathbf{d}^{\\top}(\\mathbf{M}_c + \\Delta\\mathbf{M})\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = 1 + \\frac{\\mathbf{d}^{\\top}\\Delta\\mathbf{M}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\n$$\n通过令 $\\mathbf{y} = \\mathbf{M}_c^{1/2}\\mathbf{d}$，第二项变成了 $\\Delta\\tilde{\\mathbf{M}}$ 的 Rayleigh 商：\n$$\n\\frac{\\mathbf{d}^{\\top}\\Delta\\mathbf{M}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = \\frac{(\\mathbf{M}_c^{-1/2}\\mathbf{y})^{\\top} \\Delta\\mathbf{M} (\\mathbf{M}_c^{-1/2}\\mathbf{y})}{(\\mathbf{M}_c^{-1/2}\\mathbf{y})^{\\top} \\mathbf{M}_c (\\mathbf{M}_c^{-1/2}\\mathbf{y})} = \\frac{\\mathbf{y}^{\\top}(\\mathbf{M}_c^{-1/2}\\Delta\\mathbf{M}\\mathbf{M}_c^{-1/2})\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}} = \\frac{\\mathbf{y}^{\\top}\\Delta\\tilde{\\mathbf{M}}\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}}\n$$\n这个 Rayleigh 商的值由 $\\Delta\\tilde{\\mathbf{M}}$ 的最小和最大特征值界定。令 $\\epsilon_M = \\|\\Delta\\tilde{\\mathbf{M}}\\|_2 = \\max(|\\lambda_{\\min}(\\Delta\\tilde{\\mathbf{M}})|, |\\lambda_{\\max}(\\Delta\\tilde{\\mathbf{M}})|)$。那么对于任何 $\\mathbf{y} \\ne 0$：\n$$\n-\\epsilon_M \\le \\lambda_{\\min}(\\Delta\\tilde{\\mathbf{M}}) \\le \\frac{\\mathbf{y}^{\\top}\\Delta\\tilde{\\mathbf{M}}\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}} \\le \\lambda_{\\max}(\\Delta\\tilde{\\mathbf{M}}) \\le \\epsilon_M\n$$\n因此，我们得到了质量矩阵二次型比率的界：\n$$\n1 - \\epsilon_M \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} \\le 1 + \\epsilon_M\n$$\n这假设 $\\epsilon_M  1$ 以确保 $\\mathbf{M}_{\\ell}$ 保持正定。取倒数：\n$$\n\\frac{1}{1 + \\epsilon_M} \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} \\le \\frac{1}{1 - \\epsilon_M}\n$$\n现在，我们可以界定集总系统的 Rayleigh 商：\n$$\n\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} = \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right) \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}\\right)\n$$\n应用这些界：\n$$\n\\frac{1}{1 + \\epsilon_M} \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right) \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} \\le \\frac{1}{1 - \\epsilon_M} \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right)\n$$\n将极小极大定理应用于此不等式（一个被称为关于合同变换的 Ostrowski 定理的结果），我们获得了特征值的界：\n$$\n\\frac{1}{1 + \\epsilon_M} \\lambda_i^{(c)} \\le \\lambda_i^{(\\ell)} \\le \\frac{1}{1 - \\epsilon_M} \\lambda_i^{(c)}\n$$\n由于 $\\omega_i = \\sqrt{\\lambda_i}$，我们可以界定固有频率的比率：\n$$\n\\frac{1}{\\sqrt{1 + \\epsilon_M}} \\le \\frac{\\omega_i^{(\\ell)}}{\\omega_i^{(c)}} \\le \\frac{1}{\\sqrt{1 - \\epsilon_M}}\n$$\n频率的相对误差为 $\\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} = \\left|\\frac{\\omega_i^{(\\ell)}}{\\omega_i^{(c)}} - 1\\right|$。此误差的最大值由下式界定：\n$$\n\\max \\left( 1 - \\frac{1}{\\sqrt{1 + \\epsilon_M}}, \\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1 \\right)\n$$\n对于 $\\epsilon_M > 0$，第二项更大。因此，对于所有的 $i$：\n$$\n\\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} \\le \\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1\n$$\n我们要求对于 $i=1, \\dots, k$，这个最大相对误差不超过容差 $\\tau$。一个充分条件是：\n$$\n\\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1 \\le \\tau\n$$\n解出 $\\epsilon_M$：\n$$\n\\frac{1}{\\sqrt{1-\\epsilon_M}} \\le 1 + \\tau \\implies \\sqrt{1 - \\epsilon_M} \\ge \\frac{1}{1 + \\tau} \\implies 1 - \\epsilon_M \\ge \\frac{1}{(1+\\tau)^2}\n$$\n$$\n\\epsilon_M \\le 1 - \\frac{1}{(1+\\tau)^2} = \\frac{(1+\\tau)^2 - 1}{(1+\\tau)^2} = \\frac{1 + 2\\tau + \\tau^2 - 1}{(1+\\tau)^2} = \\frac{\\tau(2+\\tau)}{(1+\\tau)^2}\n$$\n最终条件是，密度场 $\\rho(\\mathbf{x})$ 通过其对质量矩阵的影响，必须满足：\n$$\n\\epsilon_M := \\left\\| \\mathbf{M}_c^{-1/2} (\\mathbf{M}_{\\ell} - \\mathbf{M}_c) \\mathbf{M}_c^{-1/2} \\right\\|_2 \\le \\frac{\\tau(2+\\tau)}{(1+\\tau)^2}\n$$\n这个条件将物理属性 $\\rho(\\mathbf{x})$（它决定了 $\\mathbf{M}_c$ 和 $\\mathbf{M}_{\\ell}$）与计算频率的准确性联系起来。$\\rho(\\mathbf{x})$ 的空间变化将改变 $\\mathbf{M}_c$ 的结构，从而改变 $\\Delta\\mathbf{M}$ 和 $\\epsilon_M$ 的值。\n\n### B部分和C部分：计算过程与分析\n\n计算任务要求实现一个有限元（FE）模型来分析三维悬臂梁的自由振动。关键步骤如下：\n1.  **网格与几何**：为域 $\\Omega = [0, 1] \\times [0, 0.1] \\times [0, 0.1]$ 米创建一个 $2 \\times 1 \\times 1$ 的八节点六面体单元的结构化网格。这在施加边界条件之前会产生12个独立节点和36个自由度（DOF）。\n2.  **单元级计算**：对每个单元，使用 $2\\times2\\times2$ Gauss 积分计算其刚度矩阵 $\\mathbf{k}^e$ 和一致质量矩阵 $\\mathbf{m}_c^e$。\n    - 单元刚度矩阵为 $\\mathbf{k}^e = \\int_{V_e} \\mathbf{B}^{\\top}\\mathbf{D}\\mathbf{B} \\, \\mathrm{d}V$，其中 $\\mathbf{B}$ 是应变-位移矩阵，$\\mathbf{D}$ 是各向同性材料的本构矩阵，材料参数为 $E=70 \\times 10^9$ Pa 和 $\\nu=0.34$。\n    - 单元一致质量矩阵为 $\\mathbf{m}_c^e = \\int_{V_e} \\rho_e \\mathbf{N}^{\\top}\\mathbf{N} \\, \\mathrm{d}V$，其中 $\\mathbf{N}$ 是向量形函数矩阵，$\\rho_e$ 是单元的密度。\n3.  **组装**：基于单元连接性，将单元矩阵组装成全局矩阵 $\\mathbf{K}$ 和 $\\mathbf{M}_c$。通过改变两个单元的密度，考虑了三种不同的情况。\n4.  **质量集总**：使用全局一致质量矩阵 $\\mathbf{M}_c$ 来计算全局集中质量矩阵 $\\mathbf{M}_{\\ell}$，方法是将每行的条目求和并将其置于相应的对角线项上。\n5.  **边界条件**：在 $x=0$ 的面上施加齐次 Dirichlet 边界条件（固支）。这涉及到固定此面上4个节点相关的12个自由度。然后系统被简化为24个自由度。\n6.  **特征系统求解**：对于每种密度情况，求解两个广义特征值问题 $\\mathbf{K}_{red} \\boldsymbol{\\phi} = \\omega^2 \\mathbf{M}_{c,red} \\boldsymbol{\\phi}$ 和 $\\mathbf{K}_{red} \\boldsymbol{\\phi} = \\omega^2 \\mathbf{M}_{\\ell,red} \\boldsymbol{\\phi}$，对简化后（施加边界条件后）的矩阵进行求解，以获得频率集 $\\{\\omega_i^{(c)}\\}$ 和 $\\{\\omega_i^{(\\ell)}\\}$。\n7.  **误差分析**：比较两种方法得到的前 $k=5$ 个固有频率。计算最大相对误差并与容差 $\\tau=0.08$ 进行比较。如果满足容差，结果为布尔值 `true`，否则为 `false`。收集三种密度情况的结果作为最终输出。作为分析的一部分，还在内部为每种情况计算谱扰动范数 $\\epsilon_M$。\n\n下面的 Python 代码实现了这个过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh, inv, sqrtm\n\ndef solve():\n    \"\"\"\n    Solves the FEM vibration problem for a 3D cantilever beam with different density distributions.\n    \"\"\"\n    # Problem Constants\n    Lx, Ly, Lz = 1.0, 0.1, 0.1\n    E = 70.0e9  # Pa\n    nu = 0.34\n    k = 5\n    tau = 0.08\n    \n    # Test cases: piecewise constant densities [rho_elem1, rho_elem2] in kg/m^3\n    test_cases = [\n        [7800.0, 7800.0],\n        [7800.0, 8190.0],\n        [7800.0, 19500.0]\n    ]\n\n    # Constitutive matrix for 3D isotropic material (Voigt notation)\n    c1 = E / ((1.0 + nu) * (1.0 - 2.0 * nu))\n    c2 = (1.0 - nu)\n    c3 = nu\n    c4 = (1.0 - 2.0 * nu) / 2.0\n    D_mat = c1 * np.array([\n        [c2, c3, c3, 0, 0, 0],\n        [c3, c2, c3, 0, 0, 0],\n        [c3, c3, c2, 0, 0, 0],\n        [0, 0, 0, c4, 0, 0],\n        [0, 0, 0, 0, c4, 0],\n        [0, 0, 0, 0, 0, c4]\n    ])\n\n    # Mesh definition for a 2x1x1 hexahedral grid\n    nx, ny, nz = 2, 1, 1\n    node_coords_x = np.linspace(0, Lx, nx + 1)\n    node_coords_y = np.linspace(0, Ly, ny + 1)\n    node_coords_z = np.linspace(0, Lz, nz + 1)\n    \n    nodes = []\n    for z in node_coords_z:\n        for y in node_coords_y:\n            for x in node_coords_x:\n                nodes.append([x, y, z])\n    nodes = np.array(nodes) # 12 nodes total\n\n    # Element connectivity (0-based node indices)\n    # Standard hex element node ordering\n    connectivity = []\n    for i in range(nx):\n        for j in range(ny):\n            for k_ in range(nz):\n                n0 = k_ * (nx + 1) * (ny + 1) + j * (nx + 1) + i\n                n1 = n0 + 1\n                n2 = n0 + (nx + 1)\n                n3 = n1 + (nx + 1)\n                \n                connectivity.append([n0, n1, n3, n2, n0+(nx+1)*(ny+1), n1+(nx+1)*(ny+1), n3+(nx+1)*(ny+1), n2+(nx+1)*(ny+1)])\n\n    # 8-node hexahedron shape functions and their derivatives in parent coordinates\n    def shape_functions(xi, eta, zeta):\n        N = 0.125 * np.array([\n            (1 - xi) * (1 - eta) * (1 - zeta),\n            (1 + xi) * (1 - eta) * (1 - zeta),\n            (1 + xi) * (1 + eta) * (1 - zeta),\n            (1 - xi) * (1 + eta) * (1 - zeta),\n            (1 - xi) * (1 - eta) * (1 + zeta),\n            (1 + xi) * (1 - eta) * (1 + zeta),\n            (1 + xi) * (1 + eta) * (1 + zeta),\n            (1 - xi) * (1 + eta) * (1 + zeta)\n        ])\n        return N\n\n    def shape_function_derivatives(xi, eta, zeta):\n        dNdxi = 0.125 * np.array([\n            [-(1 - eta) * (1 - zeta), (1 - eta) * (1 - zeta), (1 + eta) * (1 - zeta), -(1 + eta) * (1 - zeta), -(1 - eta) * (1 + zeta), (1 - eta) * (1 + zeta), (1 + eta) * (1 + zeta), -(1 + eta) * (1 + zeta)],\n            [-(1 - xi) * (1 - zeta), -(1 + xi) * (1 - zeta), (1 + xi) * (1 - zeta), (1 - xi) * (1 - zeta), -(1 - xi) * (1 + zeta), -(1 + xi) * (1 + zeta), (1 + xi) * (1 + zeta), (1 - xi) * (1 + zeta)],\n            [-(1 - xi) * (1 - eta), -(1 + xi) * (1 - eta), -(1 + xi) * (1 + eta), -(1 - xi) * (1 + eta), (1 - xi) * (1 - eta), (1 + xi) * (1 - eta), (1 + xi) * (1 + eta), (1 - xi) * (1 + eta)]\n        ])\n        return dNdxi\n\n    # Gauss quadrature points and weights for 2x2x2\n    gp_val = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gp_val, -gp_val, -gp_val), (gp_val, -gp_val, -gp_val), (gp_val, gp_val, -gp_val), (-gp_val, gp_val, -gp_val),\n        (-gp_val, -gp_val, gp_val), (gp_val, -gp_val, gp_val), (gp_val, gp_val, gp_val), (-gp_val, gp_val, gp_val)\n    ]\n    gauss_weights = [1.0] * 8\n\n    # Main loop over test cases\n    boolean_results = []\n    for densities in test_cases:\n        num_nodes = len(nodes)\n        num_dofs = num_nodes * 3\n        K_global = np.zeros((num_dofs, num_dofs))\n        Mc_global = np.zeros((num_dofs, num_dofs))\n\n        # Assemble global matrices\n        for elem_idx, elem_nodes in enumerate(connectivity):\n            rho_elem = densities[elem_idx]\n            elem_coords = nodes[elem_nodes]\n            Ke_local = np.zeros((24, 24))\n            Mce_local = np.zeros((24, 24))\n\n            for i in range(len(gauss_points)):\n                xi, eta, zeta = gauss_points[i]\n                weight = gauss_weights[i]\n\n                N_vals = shape_functions(xi, eta, zeta)\n                dNdxi_vals = shape_function_derivatives(xi, eta, zeta)\n                \n                J = np.dot(dNdxi_vals, elem_coords)\n                detJ = np.linalg.det(J)\n                invJ = np.linalg.inv(J)\n                \n                dNdxyz = np.dot(invJ, dNdxi_vals)\n                \n                B_mat = np.zeros((6, 24))\n                N_mat = np.zeros((3, 24))\n                for node_idx in range(8):\n                    # B matrix\n                    B_mat[0, node_idx*3] = dNdxyz[0, node_idx]\n                    B_mat[1, node_idx*3+1] = dNdxyz[1, node_idx]\n                    B_mat[2, node_idx*3+2] = dNdxyz[2, node_idx]\n                    B_mat[3, node_idx*3] = dNdxyz[1, node_idx]\n                    B_mat[3, node_idx*3+1] = dNdxyz[0, node_idx]\n                    B_mat[4, node_idx*3+1] = dNdxyz[2, node_idx]\n                    B_mat[4, node_idx*3+2] = dNdxyz[1, node_idx]\n                    B_mat[5, node_idx*3] = dNdxyz[2, node_idx]\n                    B_mat[5, node_idx*3+2] = dNdxyz[0, node_idx]\n                    # N matrix\n                    N_mat[0, node_idx*3] = N_vals[node_idx]\n                    N_mat[1, node_idx*3+1] = N_vals[node_idx]\n                    N_mat[2, node_idx*3+2] = N_vals[node_idx]\n\n                Ke_local += B_mat.T @ D_mat @ B_mat * detJ * weight\n                Mce_local += rho_elem * N_mat.T @ N_mat * detJ * weight\n            \n            # Assemble into global matrices\n            dof_indices = []\n            for node in elem_nodes:\n                dof_indices.extend([3 * node, 3 * node + 1, 3 * node + 2])\n            \n            K_global[np.ix_(dof_indices, dof_indices)] += Ke_local\n            Mc_global[np.ix_(dof_indices, dof_indices)] += Mce_local\n\n        # Lumped mass matrix\n        Ml_global = np.diag(Mc_global.sum(axis=1))\n\n        # Apply Boundary Conditions (clamped at x=0)\n        clamped_nodes = np.where(nodes[:, 0] == 0.0)[0]\n        fixed_dofs = []\n        for node in clamped_nodes:\n            fixed_dofs.extend([3 * node, 3 * node + 1, 3 * node + 2])\n        \n        all_dofs = np.arange(num_dofs)\n        free_dofs = np.setdiff1d(all_dofs, fixed_dofs)\n\n        K_red = K_global[np.ix_(free_dofs, free_dofs)]\n        Mc_red = Mc_global[np.ix_(free_dofs, free_dofs)]\n        Ml_red = Ml_global[np.ix_(free_dofs, free_dofs)]\n\n        # Compute mass perturbation metric epsilon_M\n        delta_M_red = Ml_red - Mc_red\n        # Using eigh for robust matrix square root inverse\n        eigvals_mc, eigvecs_mc = eigh(Mc_red)\n        Mc_inv_sqrt = eigvecs_mc @ np.diag(1.0 / np.sqrt(eigvals_mc)) @ eigvecs_mc.T\n        \n        E_M_matrix = Mc_inv_sqrt @ delta_M_red @ Mc_inv_sqrt\n        epsilon_M = np.linalg.norm(E_M_matrix, 2)\n\n        # Solve eigenvalue problems\n        # Ensure eigenvalues are real and sorted. eigh handles this for symmetric definite pencils.\n        eigvals_c, _ = eigh(K_red, Mc_red)\n        eigvals_l, _ = eigh(K_red, Ml_red)\n        \n        # Frequencies are sqrt of eigenvalues. Get first k.\n        omega_c = np.sqrt(eigvals_c[:k])\n        omega_l = np.sqrt(eigvals_l[:k])\n        \n        # Calculate relative errors and check tolerance\n        rel_errors = np.abs(omega_l - omega_c) / omega_c\n        max_rel_error = np.max(rel_errors)\n        \n        boolean_results.append(str(max_rel_error = tau).lower())\n\n    # Print final results\n    print(f\"[{','.join(boolean_results)}]\")\n\nsolve()\n```"
        }
    ]
}