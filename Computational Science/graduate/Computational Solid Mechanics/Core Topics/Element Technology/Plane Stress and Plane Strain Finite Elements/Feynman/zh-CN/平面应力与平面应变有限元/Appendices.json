{
    "hands_on_practices": [
        {
            "introduction": "有限元分析的核心在于建立将节点位移与节点力联系起来的单元刚度矩阵。这个练习将引导您从虚功原理这一基本出发点，推导四节点双线性（Q4）单元的刚度矩阵。通过运用等参格式，我们将学习如何将物理空间中的积分转换到规则的父单元上进行计算，并探讨保证数值积分精确性的条件。这个基础性的推导实践对于深刻理解有限元方法的理论基础，以及材料属性和几何形状如何影响单元行为至关重要。",
            "id": "3588803",
            "problem": "考虑一个厚度为 $t$ 的均匀四节点双线性等参四边形（$\\mathrm{Q4}$）有限元，该单元用于模拟处于平面应力状态下的均质、线弹性各向同性材料。节点按逆时针顺序排列，单元在物理坐标系中占据一个矩形区域，其在 $x$ 和 $y$ 方向的边长均为 $a$。从母单元空间 $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ 到物理空间 $(x,y)$ 的映射是无畸变且仿射的。泊松比为 $\\nu$，杨氏模量为 $E$。使用有限元法（FEM），从虚功原理和小应变运动学出发，采用母单元空间中的 $2\\times 2$ 高斯求积，推导平面应力状态下的 $\\mathrm{Q4}$ 单元刚度矩阵。\n\n清晰阐述对于一个无畸变的等参四边形单元，采用 $2\\times 2$ 高斯求积能够精确积分其刚度矩阵的条件。\n\n最后，对于同一个无畸变的正方形单元，报告通过 $2\\times 2$ 高斯求积得到的单元刚度矩阵的第 $(1,1)$ 个元素（对应于节点1的 $x$ 方向位移自由度）的封闭形式符号表达式。最终答案仅用 $E$、$\\nu$ 和 $t$ 表示。不需要进行数值计算。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 单元类型：四节点双线性等参四边形（$\\mathrm{Q4}$）\n- 几何形状：物理坐标系中的矩形区域，在 $x$ 和 $y$ 方向的边长均为 $a$。\n- 厚度：均匀，记为 $t$。\n- 材料属性：均质、线弹性各向同性，杨氏模量为 $E$，泊松比为 $\\nu$。\n- 应力状态：平面应力。\n- 映射：从母单元空间 $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ 到物理空间 $(x,y)$ 是无畸变且仿射的。\n- 节点排序：逆时针。\n- 数值积分：$2 \\times 2$ 高斯求积。\n- 任务 1：推导平面应力状态下的 $\\mathrm{Q4}$ 单元刚度矩阵。\n- 任务 2：阐述对于无畸变的等参四边形，使用 $2 \\times 2$ 高斯求积能够精确积分刚度矩阵的条件。\n- 任务 3：报告指定正方形单元的单元刚度矩阵第 $(1,1)$ 个元素 $k_{11}$ 的封闭形式符号表达式。答案应以 $E$、$\\nu$ 和 $t$ 表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该问题是计算固体力学和有限元法（FEM）领域的标准、典型问题。所有概念，包括平面应力、线弹性、等参格式和高斯求积，都是基础且科学合理的。\n- **适定性：** 该问题定义明确。它提供了所有必要的材料属性（$E, \\nu$）、几何参数（$a, t$）和程序细节（平面应力、$\\mathrm{Q4}$ 单元、$2 \\times 2$ 高斯求积），以推导出刚度矩阵及其特定分量的唯一且有意义的解。\n- **客观性：** 问题以精确、客观的语言陈述，没有任何主观或模糊的术语。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它具有科学依据、适定性且客观。它没有违反任何指定的无效标准。因此，将提供一个合理的解答。\n\n***\n\n对于二维连续体单元，单元刚度矩阵 $\\mathbf{K}^e$ 源自虚功原理。它由应变-位移矩阵 $\\mathbf{B}$、本构矩阵 $\\mathbf{D}$ 和应变-位移矩阵的转置 $\\mathbf{B}^{\\mathsf{T}}$ 的乘积在单元体积 $V^e$ 上的积分给出。对于厚度均匀为 $t$ 的单元，该积分变为：\n$$ \\mathbf{K}^e = \\int_{V^e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B} \\, dV = t \\int_{A^e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B} \\, dA $$\n其中 $A^e$ 是单元在物理坐标系 $(x,y)$ 中的面积。\n\n等参格式将此积分映射到母单元域 $(\\xi, \\eta) \\in [-1, 1] \\times [-1, 1]$：\n$$ \\mathbf{K}^e = t \\int_{-1}^{1} \\int_{-1}^{1} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B} J \\, d\\xi \\, d\\eta $$\n其中 $J$ 是雅可比矩阵 $\\mathbf{J}$ 的行列式。\n\n该公式的组成部分如下：\n\n**1. 本构矩阵（$\\mathbf{D}$）：**\n对于平面应力条件下的线弹性各向同性材料，联系应力矢量 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^{\\mathsf{T}}$ 与应变矢量 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\mathsf{T}}$ 的本构矩阵为：\n$$ \\mathbf{D} = \\frac{E}{1-\\nu^2} \\begin{pmatrix} 1 & \\nu & 0 \\\\ \\nu & 1 & 0 \\\\ 0 & 0 & \\frac{1-\\nu}{2} \\end{pmatrix} $$\n\n**2. 应变-位移矩阵（$\\mathbf{B}$）：**\n应变通过应变-位移矩阵 $\\mathbf{B}$ 与节点位移 $\\mathbf{d}^e = [u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]^{\\mathsf{T}}$ 相关联，其中 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{d}^e$。$\\mathbf{B}$ 矩阵由各节点的贡献 $\\mathbf{B}_i$ 组装而成：\n$$ \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4], \\quad \\text{其中} \\quad \\mathbf{B}_i = \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x} \\end{pmatrix} $$\n量 $N_i$ 是 $\\mathrm{Q4}$ 单元的双线性形函数：\n$$ N_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta) \\quad N_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta) $$\n$$ N_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta) \\quad N_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta) $$\n\n**3. 变换的雅可比矩阵（$\\mathbf{J}$）：**\n形函数对物理坐标 $(x,y)$ 的导数通过链式法则求得，该法则涉及到雅可比矩阵 $\\mathbf{J}$：\n$$ \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{Bmatrix} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{Bmatrix} = \\mathbf{J} \\begin{Bmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{Bmatrix} $$\n$\\mathbf{J}$ 的分量由单元几何 $x(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) x_i$ 和 $y(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) y_i$ 计算得出。对于指定的边长为 $a$ 的正方形单元，我们可以将其中心置于原点，得到节点坐标：$P_1(-a/2, -a/2)$、$P_2(a/2, -a/2)$、$P_3(a/2, a/2)$ 和 $P_4(-a/2, a/2)$。映射关系变为：\n$$ x = \\frac{a}{2}\\xi \\quad \\text{和} \\quad y = \\frac{a}{2}\\eta $$\n因此，雅可比矩阵是常数：\n$$ \\mathbf{J} = \\begin{pmatrix} a/2 & 0 \\\\ 0 & a/2 \\end{pmatrix} $$\n雅可比矩阵的行列式为 $J = \\det(\\mathbf{J}) = \\frac{a^2}{4}$，它也是一个常数。雅可比矩阵的逆矩阵是：\n$$ \\mathbf{J}^{-1} = \\begin{pmatrix} 2/a & 0 \\\\ 0 & 2/a \\end{pmatrix} $$\n\n**精确积分的条件：**\n刚度矩阵使用数值求积进行评估：\n$$ \\mathbf{K}^e = t \\sum_{i=1}^{n} \\sum_{j=1}^{n} w_i w_j \\left[ \\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B} J \\right]_{(\\xi_i, \\eta_j)} $$\n其中 $(\\xi_i, \\eta_j)$ 是高斯点，$w_i, w_j$ 是对应的权。一个 $2 \\times 2$ 的高斯求积方案（$n=2$）对于每个变量 $\\xi$ 和 $\\eta$ 中最高为 $2n-1 = 3$ 次的多项式是精确的。\n我们来考察被积函数 $\\mathbf{F}(\\xi, \\eta) = \\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B} J$。矩阵 $\\mathbf{D}$ 是常数。对于几何形状为平行四边形（包括矩形、菱形等）的单元，其映射是仿射的，雅可比矩阵 $\\mathbf{J}$ 及其行列式 $J$ 是常数。\n形函数对母单元坐标的导数（例如 $\\frac{\\partial N_i}{\\partial \\xi}$）是另一个母单元坐标的线性函数。由于 $\\mathbf{J}^{-1}$ 是常数，因此对物理坐标的导数（例如 $\\frac{\\partial N_i}{\\partial x}$）也是 $\\xi$ 或 $\\eta$ 的线性函数。\n因此，$\\mathbf{B}$ 的元素是 $\\xi$ 和 $\\eta$ 的线性函数。乘积 $\\mathbf{B}^{\\mathsf{T}} \\mathbf{D} \\mathbf{B}$ 将因此包含在 $\\xi$ 和 $\\eta$ 中最高为 2 次的多项式项（例如，像 $\\xi^2, \\eta^2, \\xi\\eta, \\xi, \\eta$ 这样的项）。\n由于被积函数是最高 2 次的多项式，而 $2 \\times 2$ 高斯求积对最高 3 次的多项式是精确的，因此它将能精确地积分刚度矩阵。\n**因此，$2 \\times 2$ 高斯求积能够精确积分等参四边形单元刚度矩阵的条件是，单元在物理坐标系中的几何形状必须是平行四边形，这确保了雅可比矩阵 $\\mathbf{J}$ 是常数。**\n\n**刚度矩阵分量 $k_{11}$ 的计算：**\n我们需要求解单元刚度矩阵 $\\mathbf{K}^e$ 的第 $(1,1)$ 个元素，它对应于自由度 $u_1$（节点 1 的 $x$ 方向位移）。这由子矩阵 $\\mathbf{k}_{11} = t \\int_{A^e} \\mathbf{B}_1^{\\mathsf{T}} \\mathbf{D} \\mathbf{B}_1 dA$ 的第 $(1,1)$ 个元素给出。\n设 $\\mathbf{B}_1$ 的列为 $\\mathbf{b}_{1u}$ 和 $\\mathbf{b}_{1v}$。所求项为：\n$$ k_{11} = t \\int_{A^e} \\mathbf{b}_{1u}^{\\mathsf{T}} \\mathbf{D} \\mathbf{b}_{1u} \\, dA = t \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{b}_{1u}^{\\mathsf{T}} \\mathbf{D} \\mathbf{b}_{1u} J \\, d\\xi d\\eta $$\n内积为：\n$$ \\mathbf{b}_{1u}^{\\mathsf{T}} \\mathbf{D} \\mathbf{b}_{1u} = \\begin{pmatrix} \\frac{\\partial N_1}{\\partial x} & 0 & \\frac{\\partial N_1}{\\partial y} \\end{pmatrix} \\frac{E}{1-\\nu^2} \\begin{pmatrix} 1 & \\nu & 0 \\\\ \\nu & 1 & 0 \\\\ 0 & 0 & \\frac{1-\\nu}{2} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ 0 \\\\ \\frac{\\partial N_1}{\\partial y} \\end{pmatrix} = \\frac{E}{1-\\nu^2} \\left[ \\left(\\frac{\\partial N_1}{\\partial x}\\right)^2 + \\frac{1-\\nu}{2}\\left(\\frac{\\partial N_1}{\\partial y}\\right)^2 \\right] $$\n我们求 $N_1$ 的导数：\n$$ \\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta), \\quad \\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi) $$\n$$ \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial x} \\\\ \\frac{\\partial N_1}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial N_1}{\\partial \\xi} \\\\ \\frac{\\partial N_1}{\\partial \\eta} \\end{Bmatrix} = \\begin{pmatrix} 2/a & 0 \\\\ 0 & 2/a \\end{pmatrix} \\begin{Bmatrix} -\\frac{1}{4}(1-\\eta) \\\\ -\\frac{1}{4}(1-\\xi) \\end{Bmatrix} = \\begin{Bmatrix} -\\frac{1}{2a}(1-\\eta) \\\\ -\\frac{1}{2a}(1-\\xi) \\end{Bmatrix} $$\n将这些以及 $J=a^2/4$ 代入 $k_{11}$ 的表达式中：\n$$ k_{11} = t \\int_{-1}^{1}\\int_{-1}^{1} \\frac{E}{1-\\nu^2} \\left[ \\left(\\frac{-(1-\\eta)}{2a}\\right)^2 + \\frac{1-\\nu}{2} \\left(\\frac{-(1-\\xi)}{2a}\\right)^2 \\right] \\frac{a^2}{4} \\, d\\xi d\\eta $$\n$$ k_{11} = \\frac{Et}{1-\\nu^2} \\frac{a^2}{4} \\frac{1}{4a^2} \\int_{-1}^{1}\\int_{-1}^{1} \\left[ (1-\\eta)^2 + \\frac{1-\\nu}{2} (1-\\xi)^2 \\right] \\, d\\xi d\\eta $$\n$$ k_{11} = \\frac{Et}{16(1-\\nu^2)} \\int_{-1}^{1}\\int_{-1}^{1} \\left[ (1-2\\eta+\\eta^2) + \\frac{1-\\nu}{2} (1-2\\xi+\\xi^2) \\right] \\, d\\xi d\\eta $$\n由于 $2 \\times 2$ 高斯求积是精确的，我们可以进行解析积分。我们使用标准积分 $\\int_{-1}^{1} 1\\,dz = 2$、$\\int_{-1}^{1} z\\,dz = 0$ 和 $\\int_{-1}^{1} z^2\\,dz = 2/3$。\n$$ \\int_{-1}^{1}\\int_{-1}^{1} (1-2\\eta+\\eta^2) \\, d\\xi d\\eta = \\int_{-1}^{1} d\\xi \\int_{-1}^{1} (1-2\\eta+\\eta^2) \\, d\\eta = (2) \\left(2-0+\\frac{2}{3}\\right) = 2 \\cdot \\frac{8}{3} = \\frac{16}{3} $$\n$$ \\int_{-1}^{1}\\int_{-1}^{1} \\frac{1-\\nu}{2} (1-2\\xi+\\xi^2) \\, d\\xi d\\eta = \\frac{1-\\nu}{2} \\int_{-1}^{1} d\\eta \\int_{-1}^{1} (1-2\\xi+\\xi^2) \\, d\\xi = \\frac{1-\\nu}{2} (2) \\left(\\frac{8}{3}\\right) = \\frac{8(1-\\nu)}{3} $$\n将结果相加：\n$$ k_{11} = \\frac{Et}{16(1-\\nu^2)} \\left[ \\frac{16}{3} + \\frac{8(1-\\nu)}{3} \\right] = \\frac{Et}{16(1-\\nu^2)} \\frac{8}{3} [2 + (1-\\nu)] $$\n$$ k_{11} = \\frac{Et}{6(1-\\nu^2)} (3-\\nu) $$\n这就是刚度矩阵第 $(1,1)$ 个元素的符号表达式。",
            "answer": "$$\\boxed{\\frac{Et(3-\\nu)}{6(1-\\nu^2)}}$$"
        },
        {
            "introduction": "在实践中，单元刚度矩阵的积分几乎总是通过高斯求积等数值方法完成的，而积分方案的选择不仅仅影响计算精度，更对单元的力学行为产生深远影响。本练习旨在探讨全积分（对于Q4单元为$2 \\times 2$高斯求积）与减缩积分（$1 \\times 1$高斯求积）之间的权衡。通过分析，您将接触到“剪切自锁”（使单元在弯曲中表现得过于刚硬）和“沙漏模式”（由积分不足引起的伪零能模式）等关键概念，这些是低阶单元中常见的数值问题。",
            "id": "3588763",
            "problem": "考虑一个二维、小应变、线性弹性连续体，在平面应力或平面应变假设下，用双线性等参四边形单元（通常称为$Q4$单元）进行离散。设单个无畸变单元是物理$(x,y)$平面上的一个平行四边形，它是由$(\\xi,\\eta)$坐标系中的标准方形父单元通过仿射映射得到的。材料是均匀且各向同性的，其杨氏模量$E>0$，泊松比$0 < \\nu < 0.5$；假设$\\nu=0.3$，因此不存在近不可压缩效应。单元的变形主要特征是弯曲（即，以曲率为主导的应变，伴随着整个单元片上非均匀的应力分布），而不受体积约束的支配。\n\n您的任务是比较使用$1\\times 1$高斯求积（一个积分点在$(\\xi,\\eta)=(0,0)$）与$2\\times 2$高斯求积（四个积分点在标准位置）计算单元刚度矩阵的后果。单元刚度根据虚功原理计算，\n$$\n\\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^T \\mathbf{D} \\,\\mathbf{B}\\, \\mathrm{d}\\Omega,\n$$\n其中$\\mathbf{B}$是从双线性形函数和等参映射导出的应变-位移矩阵，$\\mathbf{D}$是平面应力或平面应变的弹性本构矩阵，$\\Omega_e$是单元域。数值积分通过在选定的高斯点上使用适当的权重进行求积求和来代替该积分。\n\n从以下事实出发：(i) 对于平行四边形单元，等参双线性映射是仿射的；(ii) 在仿射映射下，雅可比矩阵$\\mathbf{J}$是常数，且$\\mathbf{B}$的分量最多是$(\\xi,\\eta)$的线性函数；(iii) 被积函数$\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$因此最多是$(\\xi,\\eta)$的二次函数。请基于这些事实，论证对于一个以弯曲为主的单元片，这两种求积选择在定性刚度和精度上的差异。特别地，考虑$\\mathbf{K}_e$的秩性质、对伪零能（沙漏）模式的敏感性，以及求积方法精确积分应变能密度的能力。\n\n哪个选项最能描述预期的定性差异？\n\nA. 使用$1\\times 1$高斯求积会产生一个积分不足且秩亏的刚度矩阵，带有伪零能沙漏模式，导致人为的柔性弯曲响应和降低的应力精度；使用$2\\times 2$高斯求积会产生一个满秩的刚度矩阵，对于仿射$Q4$单元能精确积分二次应变能密度，从而得到更刚、更精确的弯曲响应。\n\nB. 使用$1\\times 1$高斯求积比$2\\times 2$产生更刚的弯曲响应，因为在单元中心进行计算抑制了曲率，从而相对于完全积分提高了精度。\n\nC. 对于一个无畸变的矩形$Q4$单元在弯曲情况下， $1\\times 1$和$2\\times 2$高斯求积给出相同的刚度，因为应变能密度是恒定的，使得两种求积都是精确的。\n\nD. 在平面应力条件下，当$\\nu=0.3$时，使用$2\\times 2$高斯求积会导致体积锁定和弯曲时过度的刚度，而$1\\times 1$高斯求积能缓解锁定并在此情况下提供最准确的变形。\n\nE. 使用$1\\times 1$高斯求积通过滤除$\\mathbf{B}$的高阶变化来提高弯曲精度，而$2\\times 2$高斯求积过分强调了这些变化，因此对于实体$Q4$单元中曲率主导的问题，减缩积分是更可取的。",
            "solution": "用户要求对使用$1\\times1$与$2\\times2$高斯求积对双线性等参四边形单元（$Q4$）在弯曲作用下的刚度矩阵的影响进行批判性分析。\n\n### 步骤1：问题验证\n\n**1.1. 提取已知条件**\n\n*   **模型**：二维、小应变、线性弹性连续体。\n*   **假设**：平面应力或平面应变。\n*   **单元类型**：双线性等参四边形单元（$Q4$）。\n*   **单元几何**：单个无畸变平行四边形，由父单元的仿射映射得到。\n*   **材料**：均匀且各向同性。\n*   **材料属性**：杨氏模量$E>0$，泊松比$0 < \\nu < 0.5$。问题指定假设$\\nu=0.3$。\n*   **加载条件**：变形以弯曲为主。体积约束不占主导地位。\n*   **目标**：比较使用$1\\times1$高斯求积与$2\\times2$高斯求积对单元刚度矩阵$\\mathbf{K}_e$的影响。\n*   **刚度矩阵公式**：$\\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^T \\mathbf{D} \\,\\mathbf{B}\\, \\mathrm{d}\\Omega$。\n*   **已知事实**：\n    1.  对于平行四边形单元，等参映射是仿射的。\n    2.  在仿射映射下，雅可比矩阵$\\mathbf{J}$是常数，应变-位移矩阵$\\mathbf{B}$的分量最多是父坐标$(\\xi, \\eta)$的线性函数。\n    3.  被积函数$\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$最多是$(\\xi, \\eta)$的二次函数。\n\n**1.2. 验证分析**\n\n*   **科学依据**：该问题基于固体力学中有限元法（FEM）的标准、公认的原理。所有定义，包括刚度矩阵积分、双线性形函数、等参映射和高斯求积，都是正确且是该主题的基础。完全积分和减缩积分之间的区别以及由此产生的现象，如沙漏和锁定，是计算力学中的核心概念。\n*   **适定性**：该问题是适定的。它要求对两种不同且标准的数值程序进行定性比较。所提供的信息足以基于有限元理论的第一性原理进行这种比较。\n*   **客观性**：问题以精确、客观、技术性的语言陈述，没有主观或模糊的术语。\n*   **一致性与完整性**：问题陈述内部一致。事实(i)正确地导出了事实(ii)和(iii)。假设$\\nu=0.3$是一个合理的选择，将分析重点放在弯曲行为和剪切效应上，而不是近不可压缩性（体积锁定），后者是另一个虽相关但独立的问题。该设置对于所要求的定性分析是完整的。\n\n**1.3. 结论**\n\n问题陈述有效。它在科学上是合理的、适定的、客观的并且是自洽的。可以进行分析。\n\n### 步骤2：推导与选项分析\n\n**从第一性原理推导**\n\n单元刚度矩阵由下式给出：\n$$\n\\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^T \\mathbf{D} \\,\\mathbf{B}\\, \\mathrm{d}\\Omega\n$$\n在等参公式中，该积分被转换到父域$(\\xi, \\eta) \\in [-1, 1] \\times [-1, 1]$：\n$$\n\\mathbf{K}_e = \\int_{-1}^{1} \\int_{-1}^{1} \\mathbf{B}(\\xi, \\eta)^T \\mathbf{D} \\,\\mathbf{B}(\\xi, \\eta)\\, |\\det(\\mathbf{J})| \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta\n$$\n这里，$\\mathbf{B}$是应变-位移矩阵，$\\mathbf{D}$是本构矩阵，$\\mathbf{J}$是从父坐标到物理坐标映射的雅可比矩阵。\n\n1.  **被积函数分析**：\n    *   问题指出单元是一个平行四边形，这是方形父单元的仿射映射。对于仿射映射，雅可比矩阵$\\mathbf{J}$是常数，因此其行列式$|\\det(\\mathbf{J})|$也是常数。\n    *   材料是均匀且各向同性的，所以本构矩阵$\\mathbf{D}$是常数。\n    *   应变-位移矩阵$\\mathbf{B}$关联了应变与节点位移。对于$Q4$单元，形函数$N_i(\\xi, \\eta)$是双线性的。它们对父坐标的导数，$\\partial N_i/\\partial\\xi$和$\\partial N_i/\\partial\\eta$，是线性函数。$\\mathbf{B}$的分量由这些导数和雅可比矩阵的逆$\\mathbf{J}^{-1}$导出。由于$\\mathbf{J}^{-1}$是常数，$\\mathbf{B}$的分量最多是$(\\xi, \\eta)$的线性函数。这在事实(ii)中被正确陈述。$\\mathbf{B}$中的一般项形式为$a+b\\xi+c\\eta$。\n    *   项$\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$是映射到父单元的应变能密度的被积函数。由于$\\mathbf{D}$是常数，且$\\mathbf{B}$的分量在$\\xi$和$\\eta$中是线性的，矩阵乘积$\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$的元素将是$\\xi$和$\\eta$中最高二次的多项式（例如，$(a+b\\xi+c\\eta)^2 = a^2+b^2\\xi^2+c^2\\eta^2+2ab\\xi+2ac\\eta+2bc\\xi\\eta$）。这在事实(iii)中被正确陈述。\n\n2.  **求积法则分析**：\n    *   **$2 \\times 2$高斯求积**：一维的2点高斯法则能精确积分最高为$2n-1 = 2(2)-1 = 3$次的多项式。因此，二维的张量积$2 \\times 2$法则能精确积分多项式$\\xi^p \\eta^q$，其中$p, q \\le 3$。由于我们的被积函数最多是二次的（2次），$2 \\times 2$法则将**精确地**计算刚度矩阵的积分。这对于平行四边形$Q4$单元被称为“完全积分”。\n    *   **$1 \\times 1$高斯求积**：一维的1点高斯法则（$n=1$）能精确积分最高为$2(1)-1=1$次的多项式。被积函数中的二次项（例如$\\xi^2$）不能被精确积分。例如，$\\int_{-1}^1 \\xi^2 \\,d\\xi = 2/3$，但1点法则（在$\\xi=0$处以权重$2$求值）给出$2 \\times (0)^2 = 0$。这代表了一个显著的误差，被称为“积分不足”或“减缩积分”。\n\n3.  **对单元行为的影响**：\n    *   **$2 \\times 2$求积**：由于积分是精确的，所得的刚度矩阵$\\mathbf{K}_e$具有与单元运动学相对应的正确秩。对于一个8自由度的$Q4$单元，在二维中有3个刚体模式，所以$\\mathbf{K}_e$的秩必须是$8-3=5$。$2\\times2$法则产生的矩阵秩为$5$。它不包含伪零能模式。所得刚度正确地表示了与所有可用双线性形函数表达的可变形模式相关的应变能。虽然由于剪切锁定（该单元在弯曲下公式化的固有缺陷），这可能导致在粗网格中表现出过刚的行为，但刚度矩阵本身是正确计算的。计算出的应力场将在单元上呈线性变化。\n    *   **$1 \\times 1$求积**：积分仅在单元中心$(\\xi, \\eta) = (0, 0)$处执行。任何在此单点产生零应变的变形模式将产生零应变能，因此不会遇到任何刚度。这些被称为伪“零能模式”或“沙漏模式”。一个$Q4$单元有8个自由度。单个积分点提供了3个应变约束（$\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}$）。这留下了$8-3=5$个潜在的零能模式。其中，3个是物理刚体模式。剩下的2个是伪沙漏模式。所得$\\mathbf{K}_e$的秩是亏损的（秩为3而不是5）。这些模式的存在使得单元人为地柔顺（软），尤其是在弯曲时，并且可能导致不稳定、振荡的解，除非通过“沙漏控制”算法进行稳定。应力场在整个单元内是恒定的，这对于弯曲主导的问题是一个很差的近似。\n\n**逐项分析选项**\n\n*   **A. 使用$1\\times 1$高斯求积会产生一个积分不足且秩亏的刚度矩阵，带有伪零能沙漏模式，导致人为的柔性弯曲响应和降低的应力精度；使用$2\\times 2$高斯求积会产生一个满秩的刚度矩阵，对于仿射$Q4$单元能精确积分二次应变能密度，从而得到更刚、更精确的弯曲响应。**\n    *   该陈述是对推导出的后果的完整且准确的总结。$1\\times1$法则导致积分不足、秩亏（沙漏模式）、人为柔顺（软）和差的应力结果。$2\\times2$法则对于平行四边形$Q4$单元给出了精确的积分，一个满秩的刚度矩阵，因此比病态软的$1\\times1$单元更刚、更精确。\n    *   **结论：正确。**\n\n*   **B. 使用$1\\times 1$高斯求积比$2\\times 2$产生更刚的弯曲响应，因为在单元中心进行计算抑制了曲率，从而相对于完全积分提高了精度。**\n    *   这是不正确的。积分不足（$1\\times1$法则）产生人为柔顺（更软）而非更刚的响应，因为它未能计及与弯曲相关的应变能。\n    *   **结论：不正确。**\n\n*   **C. 对于一个无畸变的矩形$Q4$单元在弯曲情况下， $1\\times 1$和$2\\times 2$高斯求积给出相同的刚度，因为应变能密度是恒定的，使得两种求积都是精确的。**\n    *   这是不正确的。在弯曲模式下，应变能密度*不是*恒定的。弯曲内在地涉及应变梯度。对于$Q4$单元，应变线性变化，应变能密度（$\\propto \\epsilon^2$）二次变化。由于被积函数不是常数，所以$1\\times1$和$2\\times2$法则会给出不同的结果。\n    *   **结论：不正确。**\n\n*   **D. 在平面应力条件下，当$\\nu=0.3$时，使用$2\\times 2$高斯求积会导致体积锁定和弯曲时过度的刚度，而$1\\times 1$高斯求积能缓解锁定并在此情况下提供最准确的变形。**\n    *   这个陈述有几个不准确之处。首先，“体积锁定”是与近不可压缩材料（$\\nu \\to 0.5$）相关的现象。问题指定$\\nu=0.3$并声明体积效应不占主导。与$Q4$单元在弯曲中相关的锁定现象是*剪切锁定*。其次，声称$1\\times1$单元提供“最准确”的变形是错误的；它引入了严重的沙漏不稳定性，这是一个主要的误差来源。虽然减缩积分是一种对抗剪切锁定的技术，但这个选项错误地识别了锁定类型，并夸大了所得（不稳定）单元的准确性。\n    *   **结论：不正确。**\n\n*   **E. 使用$1\\times 1$高斯求积通过滤除$\\mathbf{B}$的高阶变化来提高弯曲精度，而$2\\times 2$高斯求积过分强调了这些变化，因此对于实体$Q4$单元中曲率主导的问题，减缩积分是更可取的。**\n    *   这提供了一个有缺陷的理由。$\\mathbf{B}$的变化是线性的，不是“高阶”的，并且对于表示单元的弯曲刚度至关重要。$2\\times2$法则不是“过分强调”它们，而是精确地积分它们。$1\\times1$法则不是以有益的方式“滤除”它们，而是错误地忽略了它们对应变能的贡献，导致了沙漏模式。声称减缩积分“更可取”是一个危险的过度简化，没有沙漏控制这一关键背景，并且所提供的理由在物理上是不正确的。\n    *   **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "有限元计算直接得到的应力场通常在单元边界上是不连续的，并且节点处的精度低于单元内部的特定积分点（高斯点）。为了获得更准确、更平滑的应力分布，必须采用后处理技术。本练习将指导您通过编程实践，实现一种经典且强大的应力后处理方法——Zienkiewicz-Zhu（ZZ）应力恢复技術。您将学习如何利用围绕节点的单元片（patch）中的高斯点应力值（这些值具有超收敛性），通过局部最小二乘拟合来构建一个连续的多项式应力场，从而显著提升分析结果的质量。",
            "id": "3588781",
            "problem": "本任务要求实现一个用于平面应变有限元网格的 Zienkiewicz–Zhu (ZZ) 补片恢复法，并推导将线性应力场拟合至高斯点数据的局部最小二乘代数系统。从计算固体力学的基本原理出发。使用小应变运动学、线性弹性本构律和等参双线性四节点四边形有限元。对于网格中的每个节点，ZZ 恢复法在该节点的单元补片上，构建一个在最小二乘意义下最能拟合高斯点采样应力值的多项式应力场。\n\n基本出发点：\n- 运动学：无穷小应变-位移关系为 $ \\boldsymbol{\\varepsilon} = \\nabla^{s} \\mathbf{u} $，其中 $\\nabla^{s}$ 表示对称梯度。在二维情况下，使用笛卡尔坐标 $x$ 和 $y$，以 Voigt 标记法表示的应变向量为 $ \\boldsymbol{\\varepsilon} = [ \\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy} ]^{\\mathsf{T}} $，其中 $\\gamma_{xy} = \\partial u_x / \\partial y + \\partial u_y / \\partial x$。\n- 平面应变条件下的线性弹性本构律：$ \\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon} $，其中 $ \\boldsymbol{\\sigma} = [ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} ]^{\\mathsf{T}} $ 且\n$$\n\\mathbf{D} =\n\\begin{bmatrix}\n\\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} & \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} & 0 \\\\\n\\frac{E\\nu}{(1+\\nu)(1-2\\nu)} & \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} & 0 \\\\\n0 & 0 & \\frac{E}{2(1+\\nu)}\n\\end{bmatrix},\n$$\n其中 $E$ 为杨氏模量，$\\nu$ 为泊松比。\n- 等参双线性四边形单元：在父域 $[-1,1]\\times[-1,1]$ 上的节点 $i=1,\\dots,4$ 具有形函数 $N_i(\\xi,\\eta)$；雅可比矩阵 $ \\mathbf{J} $ 将导数从父坐标 $(\\xi,\\eta)$ 映射到物理坐标 $(x,y)$；应变-位移矩阵 $\\mathbf{B}$ 通过 $ \\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}^e $ 将节点位移与应变关联起来，其中 $ \\mathbf{u}^e $ 是单元节点位移向量。\n\n待推导的局部最小二乘拟合模型：\n- 对每个应力分量，假设在物理坐标中存在一个线性多项式模型：\n$$\ns(x,y) = a_0 + a_1 x + a_2 y,\n$$\n其中 $s$ 代表 $ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} $ 之一，$ \\mathbf{a} = [a_0, a_1, a_2]^{\\mathsf{T}} $ 是该补片的未知系数。给定高斯点数据 $\\{ (x_i, y_i, s_i, w_i) \\}_{i=1}^{n}$，建立加权最小二乘问题 $ \\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i \\left( a_0 + a_1 x_i + a_2 y_i - s_i \\right)^2 $ 并推导其正规方程。\n\n编程任务：\n1. 在方形域 $[0,2] \\times [0,2]$ 上构建一个 $2 \\times 2$ 的单元网格，九个节点位于整数坐标 $(x,y) \\in \\{0,1,2\\} \\times \\{0,1,2\\}$。四个双线性四边形单元连接这些节点：\n   - 单元 $e_0$：节点 $(0,0)\\text{-}(1,0)\\text{-}(1,1)\\text{-}(0,1)$，\n   - 单元 $e_1$：节点 $(1,0)\\text{-}(2,0)\\text{-}(2,1)\\text{-}(1,1)$，\n   - 单元 $e_2$：节点 $(0,1)\\text{-}(1,1)\\text{-}(1,2)\\text{-}(0,2)$，\n   - 单元 $e_3$：节点 $(1,1)\\text{-}(2,1)\\text{-}(2,2)\\text{-}(1,2)$。\n2. 使用材料参数 $E = 210 \\times 10^9$ (帕斯卡) 和 $\\nu = 0.3$ (无量纲)。\n3. 从双线性场中采样，指定节点位移：\n   $$\n   u_x(x,y) = a x + b y + c x y, \\quad u_y(x,y) = d x + e y + f x y\n   $$\n   其中系数为 $a = 1.0 \\times 10^{-3}$, $b = 2.0 \\times 10^{-3}$, $c = 3.0 \\times 10^{-3}$, $d = -1.0 \\times 10^{-3}$, $e = 1.5 \\times 10^{-3}$, $f = -2.0 \\times 10^{-3}$，单位为米，使用网格节点的物理坐标。\n4. 对每个单元，在标准的 $2 \\times 2$ 高斯点 $(\\xi,\\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ 处，计算 $ \\boldsymbol{\\sigma}(\\xi,\\eta) = \\mathbf{D} \\mathbf{B}(\\xi,\\eta) \\mathbf{u}^e $，并通过 $ (x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta) (x_i,y_i)$ 记录每个高斯点的物理坐标 $(x,y)$。\n5. 实现 Zienkiewicz–Zhu (ZZ) 补片恢复：对于给定的节点 $n$，从共享该节点的所有单元中收集高斯点数据 $(x_i, y_i, s_i, w_i)$。对于每个应力分量 $ s \\in \\{ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} \\} $，使用加权最小二乘法将线性模型 $ s(x,y) = a_0 + a_1 x + a_2 y $ 拟合到高斯数据。其中权重 $ w_i = \\det(\\mathbf{J}(\\xi_i,\\eta_i)) $ 是每个高斯点处从父坐标到物理坐标映射的雅可比行列式。求解正规方程，并在节点坐标 $(x_n,y_n)$ 处计算恢复的应力，即 $ s^{\\text{rec}}(x_n,y_n) = a_0 + a_1 x_n + a_2 y_n $。\n6. 为测试数值鲁棒性，仅向单元 $e_0$ 的高斯点应力注入一个小的确定性噪声：将 $\\delta$ 添加到 $e_0$ 中的每个高斯点应力分量上，其中 $ \\delta = \\alpha \\, s $，$s$ 是该点该分量的值，$ \\alpha = 5.0 \\times 10^{-3} $。所有其他单元保持无噪声。使用与第5项中相同的权重 $ w_i $。\n\n测试套件：\n- 案例1 (内部补片)：位于 $(1,1)$ 的节点属于四个单元；恢复并报告在 $(1,1)$ 处计算的三个应力分量 $ \\sigma_{xx}, \\sigma_{yy}, \\tau_{xy} $。\n- 案例2 (边界补片)：位于 $(0,1)$ 的节点属于两个单元；恢复并报告在 $(0,1)$ 处计算的 $ \\sigma_{xx} $。\n- 案例3 (带噪声数据的角点补片)：位于 $(0,0)$ 的节点属于一个单元 ($e_0$)；恢复并报告在 $(0,0)$ 处计算的 $ \\tau_{xy} $。\n\n答案规格：\n- 所有报告的应力必须以帕斯卡 $(\\text{Pa})$ 为单位表示。\n- 最终的程序输出必须是单行，包含一个由方括号括起来的逗号分隔列表，顺序如下\n$[ \\sigma_{xx}(1,1), \\sigma_{yy}(1,1), \\tau_{xy}(1,1), \\sigma_{xx}(0,1), \\tau_{xy}(0,0) ]$。\n不应打印任何其他文本。\n\n您的程序必须是自包含的，不得读取任何输入，并且必须实现完整的工作流程：单元高斯点应力计算、补片组装、各节点的加权最小二乘恢复，以及在指定节点上的求值。请完全按照描述使用指定的执行环境和库。",
            "solution": "该问题是有效的。它提出了一个计算固体力学领域中定义明确、有科学依据的任务，该任务是完整且可验证的。所有必要的参数、方程和步骤都已明确定义。\n\n任务是为有限元网格实现 Zienkiewicz-Zhu (ZZ) 补片恢复法。此方法是一种后处理技术，用于从有限元法 (FEM) 通常计算出的不连续、精度较低的应力场中，获得一个更精确、连续的应力场。其核心思想是在围绕特定节点的单元“补片”内，将一个单一、连续的多项式函数拟合到高斯积分点处的高精度应力值。\n\n### 1. 双线性四边形单元的有限元列式\n\n我们从平面应变条件下等参四节点四边形单元的标准列式开始。\n\n#### 1.1. 等参映射与形函数\n单元内的几何形状和位移场使用同一组形函数 $N_i$ 从节点值插值得到。对于定义在父域 $(\\xi, \\eta) \\in [-1,1]\\times[-1,1]$ 上的双线性单元，其形函数为：\n$$\nN_i(\\xi, \\eta) = \\frac{1}{4}(1+\\xi_i\\xi)(1+\\eta_i\\eta), \\quad i=1, \\dots, 4\n$$\n其中 $(\\xi_i, \\eta_i)$ 是单元局部节点的坐标 (例如, $(-1,-1), (1,-1), (1,1), (-1,1)$)。\n\n单元内任意点的物理坐标 $(x,y)$ 通过这些形函数和单元的节点坐标 $(x_i, y_i)$ 从父坐标 $(\\xi,\\eta)$ 映射而来：\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) x_i, \\quad y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) y_i\n$$\n\n#### 1.2. 雅可比矩阵和应变-位移矩阵\n为计算应变，我们需要位移对物理坐标 $(x,y)$ 的导数。通过链式法则，这些导数经由雅可比矩阵 $\\mathbf{J}$ 与父域中的导数联系起来：\n$$\n\\mathbf{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\sum_i \\frac{\\partial N_i}{\\partial \\xi} x_i & \\sum_i \\frac{\\partial N_i}{\\partial \\xi} y_i \\\\ \\sum_i \\frac{\\partial N_i}{\\partial \\eta} x_i & \\sum_i \\frac{\\partial N_i}{\\partial \\eta} y_i \\end{bmatrix}\n$$\n对于一个函数 $f$，其导数关系为：\n$$\n\\begin{Bmatrix} \\frac{\\partial f}{\\partial x} \\\\ \\frac{\\partial f}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial f}{\\partial \\xi} \\\\ \\frac{\\partial f}{\\partial \\eta} \\end{Bmatrix}\n$$\n位移场 $\\mathbf{u}(x,y) = [u_x(x,y), u_y(x,y)]^{\\mathsf{T}}$ 也被插值：$\\mathbf{u}(\\xi,\\eta) = \\sum_{i=1}^4 N_i(\\xi,\\eta)\\mathbf{u}_i$，其中 $\\mathbf{u}_i = [u_{ix}, u_{iy}]^{\\mathsf{T}}$ 是节点位移。应变-位移关系 $\\boldsymbol{\\varepsilon} = \\nabla^s \\mathbf{u}$ 以矩阵形式表示为 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}^e$，其中 $\\mathbf{u}^e$ 是单元所有节点位移的向量。矩阵 $\\mathbf{B}$ 由形函数对物理坐标的导数构成：\n$$\n\\mathbf{B}_i = \\begin{bmatrix}\n\\frac{\\partial N_i}{\\partial x} & 0 \\\\\n0 & \\frac{\\partial N_i}{\\partial y} \\\\\n\\frac{\\partial N_i}{\\partial y} & \\frac{\\partial N_i}{\\partial x}\n\\end{bmatrix}, \\quad \\text{且} \\quad \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4]\n$$\n导数 $\\frac{\\partial N_i}{\\partial x}$ 和 $\\frac{\\partial N_i}{\\partial y}$ 是使用 $\\mathbf{J}^{-1}$ 以及导数 $\\frac{\\partial N_i}{\\partial \\xi}$ 和 $\\frac{\\partial N_i}{\\partial \\eta}$ 计算得出的。\n\n#### 1.3. 应力计算\n在高斯点计算出应变向量 $\\boldsymbol{\\varepsilon}$ 后，相应的应力向量 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^{\\mathsf{T}}$ 可通过平面应变的线性弹性本构律 $\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$ 求得。矩阵 $\\mathbf{D}$ 如下所示：\n$$\n\\mathbf{D} =\n\\frac{E}{(1+\\nu)(1-2\\nu)}\n\\begin{bmatrix}\n1-\\nu & \\nu & 0 \\\\\n\\nu & 1-\\nu & 0 \\\\\n0 & 0 & \\frac{1-2\\nu}{2}\n\\end{bmatrix}\n$$\n其中 $E$ 是杨氏模量，$\\nu$ 是泊松比。这些在高斯点计算出的应力是恢复过程的输入数据。\n\n### 2. 用于补片恢复的加权最小二乘法\n\n对于一个给定的节点，我们组装一个由所有与之相连的单元构成的补片。然后，我们收集该补片内所有高斯点 $i=1, \\dots, n$ 处某个应力分量（例如 $\\sigma_{xx}$）的应力值 $s_i$。每个高斯点都关联着其物理坐标 $(x_i, y_i)$ 和一个权重 $w_i$。\n\n#### 2.1. 局部应力模型与最小化\n我们假设一个局部的、恢复的应力场 $s^{\\text{rec}}(x,y)$ 是物理坐标下的一个线性多项式：\n$$\ns^{\\text{rec}}(x,y) = a_0 + a_1 x + a_2 y = \\mathbf{P}(x,y) \\mathbf{a}\n$$\n其中 $\\mathbf{P}(x,y) = [1, x, y]$ 且 $\\mathbf{a} = [a_0, a_1, a_2]^{\\mathsf{T}}$ 是未知系数向量。ZZ 方法通过最小化恢复场与高斯点应力之间的加权残差平方和来找到最佳拟合系数 $\\mathbf{a}$：\n$$\n\\min_{\\mathbf{a}} F(\\mathbf{a}) = \\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i \\left( s^{\\text{rec}}(x_i, y_i) - s_i \\right)^2 = \\min_{\\mathbf{a}} \\sum_{i=1}^{n} w_i \\left( a_0 + a_1 x_i + a_2 y_i - s_i \\right)^2\n$$\n问题指定权重 $w_i$ 为相应高斯点处的雅可比行列式 $w_i = \\det(\\mathbf{J}_i)$。\n\n#### 2.2. 正规方程的推导\n为求最小值，我们将 $F(\\mathbf{a})$ 对每个系数 $a_j$ 求偏导数，并令其为零：\n$$\n\\frac{\\partial F}{\\partial a_0} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) = 0\n$$\n$$\n\\frac{\\partial F}{\\partial a_1} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) x_i = 0\n$$\n$$\n\\frac{\\partial F}{\\partial a_2} = \\sum_{i=1}^{n} 2 w_i (a_0 + a_1 x_i + a_2 y_i - s_i) y_i = 0\n$$\n整理这些方程可以得到一个 $3 \\times 3$ 的对称线性正规方程组 $\\mathbf{M} \\mathbf{a} = \\mathbf{f}$：\n$$\n\\left[ \\sum_{i=1}^{n} w_i\n\\begin{bmatrix}\n1 & x_i & y_i \\\\\nx_i & x_i^2 & x_i y_i \\\\\ny_i & x_i y_i & y_i^2\n\\end{bmatrix} \\right]\n\\begin{Bmatrix} a_0 \\\\ a_1 \\\\ a_2 \\end{Bmatrix} =\n\\left[ \\sum_{i=1}^{n} w_i s_i\n\\begin{Bmatrix} 1 \\\\ x_i \\\\ y_i \\end{Bmatrix} \\right]\n$$\n该系统可以简写为 $(\\sum_{i=1}^n w_i \\mathbf{P}_i^{\\mathsf{T}} \\mathbf{P}_i) \\mathbf{a} = (\\sum_{i=1}^n w_i \\mathbf{P}_i^{\\mathsf{T}} s_i)$。求解此方程组可得到系数 $\\mathbf{a}$。然后在任意点 $(x_n, y_n)$（例如目标节点）处的恢复应力即为 $s^{\\text{rec}}(x_n, y_n) = a_0 + a_1 x_n + a_2 y_n$。\n\n### 3. 实现策略\n\n解题步骤如下：\n1.  **初始化**：定义材料常数、网格几何（节点和单元连接关系）以及指定的位移场系数。\n2.  **位移计算**：在 9 个网格节点中的每一个上计算解析位移函数，以获得节点位移向量。\n3.  **高斯点数据生成**：对于四个单元中的每一个：\n    *   遍历四个 $2 \\times 2$ 高斯点 $(\\xi, \\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$。\n    *   计算形函数 $N_i$ 及其导数 $\\partial N_i/\\partial\\xi, \\partial N_i/\\partial\\eta$。\n    *   计算雅可比矩阵 $\\mathbf{J}$、其行列式 $\\det(\\mathbf{J})$ 及其逆矩阵 $\\mathbf{J}^{-1}$。\n    *   使用 $\\mathbf{J}^{-1}$ 构建应变-位移矩阵 $\\mathbf{B}$。\n    *   计算应变向量 $\\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}^e$。\n    *   计算应力向量 $\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$。\n    *   对于单元 $e_0$，施加乘性噪声：$\\sigma_{ij}^{\\text{noisy}} = \\sigma_{ij}(1 + \\alpha)$。\n    *   存储每个高斯点的物理坐标 $(x,y)$、（可能带噪声的）应力分量和权重 $w = \\det(\\mathbf{J})$。\n4.  **测试案例的补片恢复**：对于每个指定的节点：\n    *   识别构成节点周围补片的单元。\n    *   聚合补片中所有单元存储的高斯点数据。\n    *   对每个所需的应力分量，为系数 $\\mathbf{a}$ 组装并求解 $3 \\times 3$ 的正规方程。\n    *   在节点坐标处计算恢复的应力 $s^{\\text{rec}}$。\n5.  **输出**：收集所有测试案例计算出的应力值，并以指定的逗号分隔格式打印它们。\n\n由于指定的位移场是双线性的，且网格由矩形单元组成，因此等参映射是线性的。这意味着通过有限元法程序计算出的应变在每个单元内将是 $(x,y)$ 的线性函数。由于精确应力场也是线性的，并且 ZZ 恢复法拟合的是线性多项式，因此在无噪声的情况下，恢复的应力预计将非常精确，在浮点精度范围内与解析解匹配。带噪声的案例则可以观察该方法在数据受扰动时的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the Zienkiewicz-Zhu (ZZ) patch recovery method for a 2x2\n    plane strain finite element mesh.\n    \"\"\"\n    # Define problem parameters\n    E = 210e9  # Young's modulus in Pascals\n    nu = 0.3   # Poisson's ratio\n    \n    # Coefficients for the prescribed displacement field\n    a, b, c = 1.0e-3, 2.0e-3, 3.0e-3\n    d, e, f = -1.0e-3, 1.5e-3, -2.0e-3\n    \n    # Noise factor for element e0\n    alpha_noise = 5.0e-3\n\n    # Define mesh geometry\n    nodes = np.array([\n        [0.0, 0.0], [1.0, 0.0], [2.0, 0.0],\n        [0.0, 1.0], [1.0, 1.0], [2.0, 1.0],\n        [0.0, 2.0], [1.0, 2.0], [2.0, 2.0]\n    ])\n    \n    elements = {\n        0: [0, 1, 4, 3],  # Element e0\n        1: [1, 2, 5, 4],  # Element e1\n        2: [3, 4, 7, 6],  # Element e2\n        3: [4, 5, 8, 7]   # Element e3\n    }\n    \n    # Define a function for the analytical displacement field\n    def get_displacements(x, y):\n        ux = a * x + b * y + c * x * y\n        uy = d * x + e * y + f * x * y\n        return np.array([ux, uy])\n\n    # Calculate displacements at each node\n    nodal_displacements = np.array([get_displacements(x, y) for x, y in nodes])\n\n    # Constitutive matrix D for plane strain\n    d_factor = E / ((1 + nu) * (1 - 2 * nu))\n    D = d_factor * np.array([\n        [1 - nu, nu, 0],\n        [nu, 1 - nu, 0],\n        [0, 0, (1 - 2 * nu) / 2]\n    ])\n\n    # Define 2x2 Gauss quadrature points in parent coordinates\n    gp_val = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gp_val, -gp_val), (gp_val, -gp_val),\n        (gp_val, gp_val), (-gp_val, gp_val)\n    ]\n    \n    # Helper functions for Q4 element shape functions and their derivatives\n    def shape_functions(xi, eta):\n        N = 0.25 * np.array([\n            (1 - xi) * (1 - eta),\n            (1 + xi) * (1 - eta),\n            (1 + xi) * (1 + eta),\n            (1 - xi) * (1 + eta)\n        ])\n        return N\n\n    def shape_derivatives(xi, eta):\n        # Derivatives with respect to parent coordinates (xi, eta)\n        dNd_xi_eta = 0.25 * np.array([\n            [-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)],  # dN/d_xi\n            [-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)]    # dN/d_eta\n        ])\n        return dNd_xi_eta\n\n    # Store computed Gauss point data (stresses, coordinates, weights) for all elements\n    gauss_data = {}\n\n    for elem_id, node_indices in elements.items():\n        gauss_data[elem_id] = []\n        elem_coords = nodes[node_indices]\n        elem_disps_vec = nodal_displacements[node_indices].flatten()\n\n        for xi, eta in gauss_points:\n            dNd_xi_eta = shape_derivatives(xi, eta)\n            \n            # Jacobian matrix\n            J = dNd_xi_eta @ elem_coords\n            detJ = np.linalg.det(J)\n            invJ = np.linalg.inv(J)\n\n            # Derivatives of shape functions w.r.t. physical coordinates (x, y)\n            dNd_xy = invJ @ dNd_xi_eta\n            \n            # Strain-displacement matrix B\n            B = np.zeros((3, 8))\n            for i in range(4):\n                B[0, 2 * i] = dNd_xy[0, i]\n                B[1, 2 * i + 1] = dNd_xy[1, i]\n                B[2, 2 * i] = dNd_xy[1, i]\n                B[2, 2 * i + 1] = dNd_xy[0, i]\n            \n            # Compute strains and then stresses at the Gauss point\n            strains = B @ elem_disps_vec\n            stresses = D @ strains\n\n            # Apply deterministic noise for element e0 as specified\n            if elem_id == 0:\n                stresses_with_noise = stresses * (1.0 + alpha_noise)\n            else:\n                stresses_with_noise = stresses\n\n            # Map Gauss point to physical coordinates\n            N_vals = shape_functions(xi, eta)\n            physical_coords = N_vals @ elem_coords\n\n            gauss_data[elem_id].append({\n                'coords': physical_coords,\n                'stresses': stresses_with_noise,\n                'weight': detJ # Weight for least-squares is det(J)\n            })\n\n    def perform_zz_recovery(patch_data, target_node_coord, stress_index):\n        \"\"\"Performs weighted least-squares fit for one stress component.\"\"\"\n        # stress_index: 0 for sigma_xx, 1 for sigma_yy, 2 for tau_xy\n\n        # Assemble the normal equations for the least-squares system M*a = f\n        M = np.zeros((3, 3))\n        f = np.zeros(3)\n\n        for gp in patch_data:\n            x, y = gp['coords']\n            s_val = gp['stresses'][stress_index]\n            w = gp['weight']\n            p = np.array([1, x, y])\n            \n            M += w * np.outer(p, p)\n            f += w * s_val * p\n\n        # Solve for coefficients a = [a0, a1, a2]\n        a_coeffs = np.linalg.solve(M, f)\n        \n        # Evaluate recovered stress at the target node coordinates\n        p_node = np.array([1, target_node_coord[0], target_node_coord[1]])\n        recovered_stress = p_node @ a_coeffs\n        \n        return recovered_stress\n\n    final_results = []\n    \n    # Case 1: Interior patch at node (1,1)\n    node_coord_1 = (1.0, 1.0)\n    patch_elements_1 = [0, 1, 2, 3] # All four elements\n    patch_data_1 = []\n    for elem_id in patch_elements_1:\n        patch_data_1.extend(gauss_data[elem_id])\n    \n    s_xx_1 = perform_zz_recovery(patch_data_1, node_coord_1, 0)\n    s_yy_1 = perform_zz_recovery(patch_data_1, node_coord_1, 1)\n    t_xy_1 = perform_zz_recovery(patch_data_1, node_coord_1, 2)\n    final_results.extend([s_xx_1, s_yy_1, t_xy_1])\n\n    # Case 2: Edge patch at node (0,1)\n    node_coord_2 = (0.0, 1.0)\n    patch_elements_2 = [0, 2] # Elements e0 and e2\n    patch_data_2 = []\n    for elem_id in patch_elements_2:\n        patch_data_2.extend(gauss_data[elem_id])\n        \n    s_xx_2 = perform_zz_recovery(patch_data_2, node_coord_2, 0)\n    final_results.append(s_xx_2)\n    \n    # Case 3: Corner patch (with noise) at node (0,0)\n    node_coord_3 = (0.0, 0.0)\n    patch_elements_3 = [0] # Only element e0\n    patch_data_3 = []\n    for elem_id in patch_elements_3:\n        patch_data_3.extend(gauss_data[elem_id])\n\n    t_xy_3 = perform_zz_recovery(patch_data_3, node_coord_3, 2)\n    final_results.append(t_xy_3)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}