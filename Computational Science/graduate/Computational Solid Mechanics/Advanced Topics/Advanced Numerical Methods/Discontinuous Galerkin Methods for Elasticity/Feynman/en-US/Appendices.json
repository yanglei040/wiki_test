{
    "hands_on_practices": [
        {
            "introduction": "The central idea of Discontinuous Galerkin methods is the use of numerical fluxes to communicate information between adjacent, disconnected elements. This exercise provides a concrete, step-by-step application of the Symmetric Interior Penalty Galerkin (SIPG) formulation, a popular choice for elliptic problems like elasticity. By manually calculating the contribution of an interior face to the weak form for a prescribed displacement field , you will gain a deeper, tangible understanding of how consistency, symmetry, and penalty terms work together to enforce the physical behavior of a continuous solid.",
            "id": "3558973",
            "problem": "Consider linear elasticity in two dimensions under plane strain. Let two adjacent elements $K^{-}$ and $K^{+}$ share a straight interior face $F$ of length $|F| = 2$ with unit normal $n$ pointing from $K^{-}$ to $K^{+}$. Assume non-dimensionalization has been performed so that all quantities are dimensionless. The constitutive law on each element is linear and isotropic with stiffness tensor $\\mathbb{C}^{\\pm}$ defined by the Lamé parameters $\\lambda^{\\pm}$ and $\\mu^{\\pm}$ via $\\sigma(u) = \\mathbb{C} : \\varepsilon(u) = \\lambda\\, \\operatorname{tr}(\\varepsilon(u))\\, I + 2 \\mu\\, \\varepsilon(u)$, where $\\varepsilon(u) = \\tfrac{1}{2}(\\nabla u + (\\nabla u)^{\\top})$ is the symmetric strain. The unit vectors $n$ and $t$ are orthonormal, with $n = (\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}})$ and $t = (-\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}})$. The elements have Lamé parameters $\\lambda^{-} = 2$, $\\mu^{-} = 1$ and $\\lambda^{+} = 3$, $\\mu^{+} = 2$.\n\nLet the trial displacement field $u_{h}$ and the test displacement field $v_{h}$ be affine on each element, with gradients and traces on $F$ specified as follows. On $K^{-}$ and $K^{+}$, the gradients are\n$\\nabla u_{h}^{-} = a_{u}^{-}\\, n \\otimes n$, $\\nabla u_{h}^{+} = a_{u}^{+}\\, n \\otimes n$, with $a_{u}^{-} = 0.5$, $a_{u}^{+} = -0.2$,\nand\n$\\nabla v_{h}^{-} = a_{v}^{-}\\, n \\otimes n$, $\\nabla v_{h}^{+} = a_{v}^{+}\\, n \\otimes n$, with $a_{v}^{-} = 0.6$, $a_{v}^{+} = -0.1$.\nAssume the face $F$ passes through the origin so that the restrictions of the affine fields to $F$ are equal to the constant vectors $b_{u}^{\\pm}$ and $b_{v}^{\\pm}$, respectively:\n$b_{u}^{-} = -0.15\\, n + 0.05\\, t$, $b_{u}^{+} = 0.15\\, n - 0.05\\, t$, and $b_{v}^{-} = 0.2\\, n - 0.1\\, t$, $b_{v}^{+} = -0.2\\, n + 0.1\\, t$.\nHence the jumps on $F$ are $\\llbracket u_{h}\\rrbracket = b_{u}^{+} - b_{u}^{-} = 0.3\\, n - 0.1\\, t$ and $\\llbracket v_{h}\\rrbracket = b_{v}^{+} - b_{v}^{-} = -0.4\\, n + 0.2\\, t$.\n\nUsing the Discontinuous Galerkin (DG) method and adopting the symmetric interior penalty numerical flux with penalty parameter $\\eta = 5$, proceed as follows:\n1. Starting from the balance of linear momentum and the constitutive law, derive the interior face contribution to the bilinear residual $R_{F}(u_{h}, v_{h})$ on $F$ in terms of the average traction $\\{\\{\\sigma(u_{h})\\}\\} n$, the jump $\\llbracket\\cdot\\rrbracket$, and the penalty parameter $\\eta$. Use outward normals $n^{-} = n$ on $K^{-}$ and $n^{+} = -n$ on $K^{+}$, and the standard average $\\{\\{q\\}\\} = \\tfrac{1}{2}(q^{-} + q^{+})$ and jump $\\llbracket w\\rrbracket = w^{+} - w^{-}$.\n2. Evaluate $R_{F}(u_{h}, v_{h})$ numerically for the given data.\n\nReport the final value of $R_{F}(u_{h}, v_{h})$ as a single real number. No rounding is required. Since the setting is non-dimensionalized, express the final answer without units.",
            "solution": "The problem is valid as it is scientifically grounded in the theory of computational solid mechanics, specifically the Discontinuous Galerkin (DG) method for linear elasticity. All provided data is self-contained, consistent, and sufficient for performing the required calculations.\n\nThe solution is presented in two parts as requested. First, we derive the general form of the interior face contribution for the Symmetric Interior Penalty Galerkin (SIPG) method. Second, we evaluate this contribution numerically using the provided data.\n\n### Part 1: Derivation of the Interior Face Contribution $R_{F}(u_{h}, v_{h})$\n\nThe DG method starts from the weak form of the balance of linear momentum, $-\\nabla \\cdot \\sigma(u) = 0$ (assuming no body forces), on each element $K$. For a test function $v_h$, we have:\n$$ \\int_K (-\\nabla \\cdot \\sigma(u_h)) \\cdot v_h \\, dK = 0 $$\nIntegrating by parts on each element $K \\in \\{K^{-}, K^{+}\\}$ yields:\n$$ \\int_K \\sigma(u_h) : \\nabla v_h \\, dK - \\int_{\\partial K} (\\sigma(u_h) n_{\\partial K}) \\cdot v_h \\, dS = 0 $$\nwhere $n_{\\partial K}$ is the outward-pointing unit normal to the boundary $\\partial K$. Since the stress tensor $\\sigma(u_h)$ is symmetric, we can replace $\\nabla v_h$ with the symmetric strain tensor $\\varepsilon(v_h)$:\n$$ \\int_K \\sigma(u_h) : \\varepsilon(v_h) \\, dK - \\int_{\\partial K} (\\sigma(u_h) n_{\\partial K}) \\cdot v_h \\, dS = 0 $$\nSumming over the two adjacent elements $K^{-}$ and $K^{+}$, the contribution from the shared interior face $F$ arises from the boundary integral terms. The outward normal for $K^{-}$ on $F$ is $n^{-} = n$, and for $K^{+}$ it is $n^{+} = -n$. The sum of the boundary integrals over $F$ is:\n$$ -\\int_F (\\sigma(u_h^{-}) n^{-}) \\cdot v_h^{-} \\, dS - \\int_F (\\sigma(u_h^{+}) n^{+}) \\cdot v_h^{+} \\, dS = -\\int_F \\left( (\\sigma(u_h^{-}) n) \\cdot v_h^{-} - (\\sigma(u_h^{+}) n) \\cdot v_h^{+} \\right) dS $$\nUsing the jump operator $\\llbracket w\\rrbracket = w^{+} - w^{-}$ and the average operator $\\{\\{q\\}\\} = \\frac{1}{2}(q^{-} + q^{+})$, the term inside the integral can be rewritten as $(\\sigma(u_h^{+}) n) \\cdot v_h^{+} - (\\sigma(u_h^{-}) n) \\cdot v_h^{-}$. A standard identity relates this to jumps and averages:\n$$ a^{+} \\cdot b^{+} - a^{-} \\cdot b^{-} = \\{\\{a\\}\\} \\cdot \\llbracket b\\rrbracket + \\llbracket a\\rrbracket \\cdot \\{\\{b\\}\\} $$\nApplying this with $a = \\sigma(u_h)n$ and $b = v_h$, the integral becomes:\n$$ \\int_F \\left( \\{\\{\\sigma(u_h)n\\}\\} \\cdot \\llbracket v_h\\rrbracket + \\llbracket \\sigma(u_h)n\\rrbracket \\cdot \\{\\{v_h\\}\\} \\right) dS $$\nIn the DG method, this term is replaced by numerical flux terms to ensure consistency, stability, and symmetry. For the Symmetric Interior Penalty Galerkin (SIPG) method, the bilinear interior face contribution $R_F(u_h, v_h)$ is defined as:\n$$ R_F(u_h, v_h) = \\int_F \\left( -\\{\\{\\sigma(u_h)n\\}\\} \\cdot \\llbracket v_h\\rrbracket - \\{\\{\\sigma(v_h)n\\}\\} \\cdot \\llbracket u_h\\rrbracket + \\eta \\llbracket u_h\\rrbracket \\cdot \\llbracket v_h\\rrbracket \\right) dS $$\nThis form consists of three terms:\n1.  The consistency term, $-\\int_F \\{\\{\\sigma(u_h)n\\}\\} \\cdot \\llbracket v_h\\rrbracket \\, dS$, ensures that a sufficiently smooth exact solution satisfies the discrete equations.\n2.  The symmetry term, $-\\int_F \\{\\{\\sigma(v_h)n\\}\\} \\cdot \\llbracket u_h\\rrbracket \\, dS$, is added to make the bilinear form symmetric, i.e., $R_F(u_h, v_h) = R_F(v_h, u_h)$.\n3.  The penalty (or stabilization) term, $\\int_F \\eta \\llbracket u_h\\rrbracket \\cdot \\llbracket v_h\\rrbracket \\, dS$, penalizes the jump in the displacement field across the face, which provides stability and coercivity for the overall numerical scheme. The parameter $\\eta > 0$ must be chosen large enough.\n\n### Part 2: Numerical Evaluation of $R_{F}(u_{h}, v_{h})$\n\nWe need to compute the terms in the expression for $R_F(u_h, v_h)$. Since all fields are either constant or have constant gradients, their traces and the resulting tractions are constant on face $F$. Therefore, the integral is simply the value of the integrand multiplied by the length of the face, $|F|=2$.\n$$ R_F(u_h, v_h) = |F| \\left( -\\{\\{\\sigma(u_h)n\\}\\} \\cdot \\llbracket v_h\\rrbracket - \\{\\{\\sigma(v_h)n\\}\\} \\cdot \\llbracket u_h\\rrbracket + \\eta \\llbracket u_h\\rrbracket \\cdot \\llbracket v_h\\rrbracket \\right) $$\nLet's first compute the traction vectors $\\sigma(w)n$ for a generic field $w$ with gradient $\\nabla w = a_w n \\otimes n$.\nThe strain tensor is $\\varepsilon(w) = \\frac{1}{2}(\\nabla w + (\\nabla w)^{\\top}) = \\frac{1}{2}(a_w n \\otimes n + a_w n \\otimes n) = a_w n \\otimes n$.\nThe trace of the strain is $\\operatorname{tr}(\\varepsilon(w)) = \\operatorname{tr}(a_w n \\otimes n) = a_w \\operatorname{tr}(n \\otimes n) = a_w |n|^2 = a_w$.\nThe stress tensor is given by $\\sigma(w) = \\lambda \\operatorname{tr}(\\varepsilon(w)) I + 2\\mu \\varepsilon(w) = \\lambda a_w I + 2\\mu a_w n \\otimes n = a_w(\\lambda I + 2\\mu n \\otimes n)$.\nThe traction vector on a surface with normal $n$ is:\n$$ \\sigma(w)n = a_w(\\lambda I + 2\\mu n \\otimes n)n = a_w(\\lambda In + 2\\mu (n \\otimes n)n) $$\nUsing $In=n$ and $(n\\otimes n)n = n(n \\cdot n) = n$, we get:\n$$ \\sigma(w)n = a_w(\\lambda n + 2\\mu n) = a_w(\\lambda + 2\\mu)n $$\nNow we apply this formula to the trial function $u_h$ and test function $v_h$ on elements $K^{-}$ and $K^{+}$.\n\n**Traction vectors for $u_h$:**\nOn $K^{-}$: $\\lambda^{-} = 2$, $\\mu^{-} = 1$, $a_u^{-} = 0.5$.\n$$ \\sigma(u_h^{-})n = a_u^{-} (\\lambda^{-} + 2\\mu^{-}) n = 0.5(2 + 2 \\cdot 1)n = 0.5(4)n = 2n $$\nOn $K^{+}$: $\\lambda^{+} = 3$, $\\mu^{+} = 2$, $a_u^{+} = -0.2$.\n$$ \\sigma(u_h^{+})n = a_u^{+} (\\lambda^{+} + 2\\mu^{+}) n = -0.2(3 + 2 \\cdot 2)n = -0.2(7)n = -1.4n $$\n\n**Traction vectors for $v_h$:**\nOn $K^{-}$: $\\lambda^{-} = 2$, $\\mu^{-} = 1$, $a_v^{-} = 0.6$.\n$$ \\sigma(v_h^{-})n = a_v^{-} (\\lambda^{-} + 2\\mu^{-}) n = 0.6(2 + 2 \\cdot 1)n = 0.6(4)n = 2.4n $$\nOn $K^{+}$: $\\lambda^{+} = 3$, $\\mu^{+} = 2$, $a_v^{+} = -0.1$.\n$$ \\sigma(v_h^{+})n = a_v^{+} (\\lambda^{+} + 2\\mu^{+}) n = -0.1(3 + 2 \\cdot 2)n = -0.1(7)n = -0.7n $$\n\n**Average tractions:**\n$$ \\{\\{\\sigma(u_h)n\\}\\} = \\frac{1}{2}(\\sigma(u_h^{-})n + \\sigma(u_h^{+})n) = \\frac{1}{2}(2n - 1.4n) = \\frac{1}{2}(0.6n) = 0.3n $$\n$$ \\{\\{\\sigma(v_h)n\\}\\} = \\frac{1}{2}(\\sigma(v_h^{-})n + \\sigma(v_h^{+})n) = \\frac{1}{2}(2.4n - 0.7n) = \\frac{1}{2}(1.7n) = 0.85n $$\n\n**Jumps (given):**\n$$ \\llbracket u_h\\rrbracket = 0.3n - 0.1t $$\n$$ \\llbracket v_h\\rrbracket = -0.4n + 0.2t $$\nThe vectors $n$ and $t$ are orthonormal, so $n \\cdot n = 1$, $t \\cdot t = 1$, and $n \\cdot t = 0$.\n\nNow we compute the three terms of the integrand:\n1.  **Consistency term contribution:**\n    $$ -\\{\\{\\sigma(u_h)n\\}\\} \\cdot \\llbracket v_h\\rrbracket = -(0.3n) \\cdot (-0.4n + 0.2t) = -0.3(-0.4)(n \\cdot n) - 0.3(0.2)(n \\cdot t) = 0.12 $$\n2.  **Symmetry term contribution:**\n    $$ -\\{\\{\\sigma(v_h)n\\}\\} \\cdot \\llbracket u_h\\rrbracket = -(0.85n) \\cdot (0.3n - 0.1t) = -0.85(0.3)(n \\cdot n) - 0.85(-0.1)(n \\cdot t) = -0.255 $$\n3.  **Penalty term contribution:** ($\\eta = 5$)\n    $$ \\eta \\llbracket u_h\\rrbracket \\cdot \\llbracket v_h\\rrbracket = 5 (0.3n - 0.1t) \\cdot (-0.4n + 0.2t) $$\n    $$ = 5( (0.3)(-0.4)(n \\cdot n) + (0.3)(0.2)(n \\cdot t) - (0.1)(-0.4)(t \\cdot n) - (0.1)(0.2)(t \\cdot t) ) $$\n    $$ = 5( -0.12 + 0 - 0 - 0.02 ) = 5(-0.14) = -0.7 $$\n\nThe sum of these contributions is $0.12 - 0.255 - 0.7 = -0.135 - 0.7 = -0.835$.\nFinally, we multiply by the face length $|F| = 2$:\n$$ R_F(u_h, v_h) = |F| \\times (-0.835) = 2 \\times (-0.835) = -1.67 $$",
            "answer": "$$\\boxed{-1.67}$$"
        },
        {
            "introduction": "Moving from theory to a functional computer code often reveals subtle but critical implementation challenges. In DG methods, a common hurdle is ensuring that the degrees of freedom on a shared face are consistently ordered between neighboring elements, especially when their local reference coordinate systems are oriented differently. This practice  presents a thought experiment to derive the permutation needed to align face data, highlighting the careful bookkeeping required for accurate numerical flux evaluation in a real-world DG solver.",
            "id": "3558954",
            "problem": "Consider the small-strain linear elasticity equations on a two-dimensional domain, where the Cauchy stress tensor $\\boldsymbol{\\sigma}$ satisfies $\\boldsymbol{\\sigma} = \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} + 2 \\mu \\, \\boldsymbol{\\varepsilon}$ with Lamé parameters $\\lambda$ and $\\mu$, the strain tensor is $\\boldsymbol{\\varepsilon} = \\tfrac{1}{2} \\left( \\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^{\\top} \\right)$, and $\\mathbf{u}$ is the displacement field. In a Discontinuous Galerkin (DG) method, the weak formulation employs interface terms on interior faces that depend on tractions and jumps of displacements, evaluated consistently at face quadrature points.\n\nTwo bilinear quadrilateral elements $E_{L}$ and $E_{R}$ share a vertical interior face $\\Gamma$ along their common boundary. Each element is mapped from its own reference square with local coordinates $(\\xi,\\eta) \\in [-1,1]^2$. The left element $E_{L}$ has its interior face at $\\xi = 1$ with outward unit normal $\\mathbf{n}_{L} = (1,0)$. The right element $E_{R}$ has its interior face at $\\xi = -1$ with outward unit normal $\\mathbf{n}_{R} = (-1,0) = -\\mathbf{n}_{L}$. The interface numerical flux on $\\Gamma$ is implemented by choosing the canonical face normal $\\mathbf{n} := \\mathbf{n}_{L}$ and expressing data from $E_{R}$ in a local parametrization consistent with $E_{L}$.\n\nOn each face, the trace space is spanned by a Lagrange basis associated with the polynomial degree $p \\geq 1$ along the face direction. The face degrees of freedom are tied to the $p+1$ Legendre–Gauss–Lobatto (LGL) points on $[-1,1]$ in the face parameter. For $E_{L}$, the face parameter is $\\eta$ on $\\xi=1$ and the face degrees of freedom are ordered by increasing $\\eta$, i.e., indices $m = 0,1,\\dots,p$ correspond to strictly increasing LGL nodes $\\eta_{m}$ with $\\eta_{0} = -1$, $\\eta_{p} = 1$. For $E_{R}$, the local face parameter is denoted by $\\eta'$ on $\\xi=-1$, and due to its local node ordering convention, the face degrees of freedom are ordered by increasing $\\eta'$ but the geometric orientation along $\\Gamma$ is opposite to that of $E_{L}$ as seen from the global parametrization induced by $\\mathbf{n} = \\mathbf{n}_{L}$. Specifically, the consistent parametrization for flux evaluation satisfies the orientation-reversing relation $\\eta' = -\\eta$ along $\\Gamma$.\n\nAssume quadrature is performed exactly at the LGL nodes and that the Lagrange trace basis functions are the canonical interpolants associated with these nodes on each face. To correctly evaluate the numerical flux, the degrees of freedom from $E_{R}$ must be permuted so that their ordering matches that of $E_{L}$ under the orientation-consistent face parameter. Using only first principles of the DG formulation and the reference-to-physical mapping along faces, derive the closed-form permutation $\\pi(m)$ of the right element’s face degree-of-freedom index $m \\in \\{0,1,\\dots,p\\}$ that aligns $E_{R}$’s trace data with $E_{L}$’s orientation for flux evaluation on $\\Gamma$.\n\nProvide your final result as a single analytic expression $\\pi(m)$ in terms of $m$ and $p$. No numerical approximation is required, and no units are involved.",
            "solution": "The problem requires the derivation of a permutation $\\pi(m)$ that realigns the degrees of freedom (DoFs) on the face of element $E_R$ to match the geometric orientation of the shared face on element $E_L$. This is a necessary step for the correct evaluation of numerical fluxes in a Discontinuous Galerkin (DG) method.\n\nLet us begin by formalizing the provided information. We have two elements, $E_L$ (left) and $E_R$ (right), sharing a face $\\Gamma$.\nThe calculation of the numerical flux on $\\Gamma$ is performed in a coordinate system consistent with $E_L$'s orientation, defined by the canonical normal $\\mathbf{n} = \\mathbf{n}_L$.\n\nThe face DoFs for both elements are located at the $p+1$ Legendre-Gauss-Lobatto (LGL) nodes on the reference interval $[-1, 1]$. Let us denote this ordered set of LGL nodes as $\\{\\zeta_j\\}_{j=0}^{p}$, where $-1 = \\zeta_0 < \\zeta_1 < \\dots < \\zeta_p = 1$. A fundamental property of these nodes is their symmetry about the origin, which is expressed as:\n$$\n\\zeta_j = -\\zeta_{p-j} \\quad \\text{for } j \\in \\{0, 1, \\dots, p\\}\n$$\n\nFor element $E_L$, the face parameter is $\\eta \\in [-1, 1]$. The DoFs are indexed by $m \\in \\{0, 1, \\dots, p\\}$, and their locations $\\eta_m$ are ordered to be strictly increasing with $m$. This directly corresponds to the standard ordering of the LGL nodes. Thus, the coordinate of the $m$-th DoF on the face of $E_L$ is:\n$$\n\\eta_m = \\zeta_m\n$$\n\nFor element $E_R$, the local face parameter is $\\eta' \\in [-1, 1]$. The problem states that its local DoF ordering convention is also based on increasing values of the face parameter. Let the index for $E_R$'s DoFs be $k \\in \\{0, 1, \\dots, p\\}$. The coordinate of the $k$-th DoF on the face of $E_R$ is:\n$$\n\\eta'_k = \\zeta_k\n$$\n\nThe crucial piece of information is the relationship between the two parametrizations at any given physical point on the shared face $\\Gamma$. Due to the opposite orientation of the faces in their respective local reference elements, this relationship is given as:\n$$\n\\eta' = -\\eta\n$$\n\nOur objective is to find a permutation $\\pi(m)$ such that the permuted vector of DoFs from $E_R$, let's call it $\\mathbf{d}'_R$, is aligned with the DoF locations of $E_L$. This means that the $m$-th component of $\\mathbf{d}'_R$, denoted $(\\mathbf{d}'_R)_m$, must correspond to the value from $E_R$ at the same physical point as the $m$-th DoF of $E_L$.\n\nLet's consider the $m$-th DoF of $E_L$. Its location is at $\\eta = \\eta_m = \\zeta_m$.\nTo find the corresponding value from $E_R$, we must find the coordinate on $E_R$'s face that corresponds to this same physical point. Using the orientation-reversing relation, this coordinate is:\n$$\n\\eta' = -\\eta = -\\zeta_m\n$$\n\nNow, we must identify which of $E_R$'s original DoFs is located at this coordinate $\\eta'$. Let this be the DoF with index $k$. Its location is given by $\\eta'_k = \\zeta_k$. We therefore require:\n$$\n\\zeta_k = \\eta' = -\\zeta_m\n$$\n\nUsing the symmetry property of LGL nodes, $\\zeta_{p-m} = -\\zeta_m$. By substituting this into the previous equation, we get:\n$$\n\\zeta_k = \\zeta_{p-m}\n$$\n\nSince the LGL nodes $\\zeta_j$ are distinct for $j \\in \\{0, 1, \\dots, p\\}$, the equality of the node coordinates implies the equality of their indices:\n$$\nk = p-m\n$$\n\nThis result tells us that the trace data value for the aligned $m$-th DoF position must be fetched from the $k = (p-m)$-th DoF of the original (unpermuted) data from element $E_R$. A permutation $\\pi(m)$ is defined as the function that maps a destination index $m$ in the permuted array to the source index $\\pi(m)$ in the original array.\nTherefore, the desired permutation is:\n$$\n\\pi(m) = p-m\n$$\nwhere $m \\in \\{0, 1, \\dots, p\\}$. This permutation effectively reverses the order of the degrees of freedom from element $E_R$ to align them with the orientation of element $E_L$. For instance, for the first DoF of the aligned set ($m=0$), we take the last DoF of the original set ($k=p$). For the last aligned DoF ($m=p$), we take the first original DoF ($k=0$). If $p$ is even, the central DoF ($m=p/2$) maps to itself.",
            "answer": "$$\\boxed{\\pi(m) = p-m}$$"
        },
        {
            "introduction": "One of the significant advantages of the DG framework is its natural suitability for a posteriori error estimation, which guides adaptive mesh refinement (AMR). Since the discrete solution is inherently discontinuous, the jumps in physical quantities across element faces provide a direct measure of the solution's error. This exercise  puts this concept into practice by having you implement a residual-based error estimator that quantifies the local equilibrium imbalance and traction discontinuities, forming the foundation for building efficient, adaptive solvers for complex elasticity problems.",
            "id": "3558961",
            "problem": "Consider two-dimensional small-strain linear elasticity on a polygonal domain, with the strong form of static equilibrium given by the balance of linear momentum and traction continuity. The fundamental basis is:\n- Balance in each subdomain: $\\nabla \\cdot \\sigma + f = 0$.\n- Traction continuity across internal faces: the traction $t = \\sigma n$ is continuous, where $n$ is the unit normal.\n- Stress symmetry: $\\sigma = \\sigma^{\\top}$.\n\nIn a Discontinuous Galerkin (DG) method, the discrete stress field $\\sigma_h$ and the discrete displacement field are discontinuous across element interfaces. A jump-based residual a posteriori estimator for the error guided by equilibrium residuals and traction jumps is classically composed of:\n$$\n\\eta^2 \\;=\\; \\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} h_F \\,\\lVert \\llbracket \\sigma_h n \\rrbracket \\rVert_{F}^2 \\;+\\; \\sum_{K \\in \\mathcal{T}_h} h_K^2 \\,\\lVert f + \\nabla \\cdot \\sigma_h \\rVert_{K}^2,\n$$\nwhere $\\llbracket \\sigma_h n\\rrbracket$ denotes the jump of the traction across an interior face $F$, $h_F$ is a face length scale, and $h_K$ is an element length scale. The norm $\\lVert \\cdot \\rVert_F$ is the $L^2$-norm on the face, and $\\lVert \\cdot \\rVert_K$ is the $L^2$-norm on the element. The goal is to develop and implement this estimator, using only the equilibrium equation and traction continuity as the fundamental basis, without using any shortcut formulas beyond these principles.\n\nImplementation assumptions to make the computation concrete and universally applicable:\n- Geometry: Each element $K$ is a rectangle aligned with the coordinate axes, defined by a bounding box $[x_0,x_1]\\times[y_0,y_1]$.\n- Stress approximation on each element $K$: A symmetric linear polynomial field\n$$\n\\begin{aligned}\n\\sigma_{xx}(x,y) &= a_0 + a_1 x + a_2 y, \\\\\n\\sigma_{yy}(x,y) &= b_0 + b_1 x + b_2 y, \\\\\n\\sigma_{xy}(x,y) &= c_0 + c_1 x + c_2 y,\n\\end{aligned}\n$$\nwith $\\sigma_{xy}=\\sigma_{yx}$.\n- Body force on each element $K$: A constant vector $f = (f_x,f_y)$.\n- Heterogeneous material: Each element $K$ is assigned Lamé parameters $(\\lambda,\\mu)$ that may vary between elements. These parameters are part of the description to reflect heterogeneity, but the estimator formula above employs only $\\sigma_h$ and $f$ explicitly. Treat all quantities as dimensionless.\n- Numerical quadrature for norms: Use midpoint quadrature on faces and element centroids to define computable surrogates for the $L^2$ norms:\n  - For a face $F$ with endpoints $(x_0,y_0)$ and $(x_1,y_1)$, let its length be $|F| = \\sqrt{(x_1-x_0)^2 + (y_1-y_0)^2}$, midpoint $m_F$, and outward unit normal from the $K^+$ side be $n_F$. Define\n$$\n\\lVert \\llbracket \\sigma_h n\\rrbracket \\rVert_F^2 \\approx |F| \\,\\big\\lVert (\\sigma_h^+(m_F) n_F) + (\\sigma_h^-(m_F)(-n_F)) \\big\\rVert_2^2,\n$$\n    where $-$ denotes the $K^-$ side and the jump is $t^+ + t^-$ with outward normals on each side.\n  - For an element $K$ with area $|K|$ and centroid $m_K$, since $\\nabla\\cdot\\sigma_h$ is constant for the adopted linear stress, define\n$$\n\\lVert f + \\nabla \\cdot \\sigma_h \\rVert_K^2 \\approx |K| \\,\\big\\lVert f + \\nabla \\cdot \\sigma_h \\big\\rVert_2^2.\n$$\n- Mesh scales: Set $h_F = |F|$ for faces and $h_K = \\sqrt{|K|}$ for elements.\n- Traction evaluation: For any unit normal $n=(n_x,n_y)$,\n$$\n\\sigma n = \n\\begin{bmatrix}\n\\sigma_{xx} & \\sigma_{xy}\\\\\n\\sigma_{xy} & \\sigma_{yy}\n\\end{bmatrix}\n\\begin{bmatrix} n_x\\\\ n_y \\end{bmatrix}\n=\n\\begin{bmatrix}\n\\sigma_{xx} n_x + \\sigma_{xy} n_y \\\\\n\\sigma_{xy} n_x + \\sigma_{yy} n_y\n\\end{bmatrix}.\n$$\n- Divergence of the linear stress on each element $K$ is constant and given by\n$$\n\\nabla\\cdot\\sigma_h = \n\\begin{bmatrix}\n\\partial_x \\sigma_{xx} + \\partial_y \\sigma_{xy} \\\\\n\\partial_x \\sigma_{xy} + \\partial_y \\sigma_{yy}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\na_1 + c_2\\\\\nc_1 + b_2\n\\end{bmatrix}.\n$$\n\nTest suite. Implement a program that computes $\\eta^2$ for the following three test cases. In all cases, the output should be a single line with the three results in order, rounded to six decimal places, as a comma-separated list in square brackets.\n\n- Test case $1$ (two horizontally adjacent rectangles):\n  - Elements:\n    - $K_0 = [0,0.5]\\times[0,1]$, Lamé $(\\lambda,\\mu)=(2,1)$, stress coefficients\n      $\\sigma_{xx} = 2 + 1\\cdot x + 0\\cdot y$,\n      $\\sigma_{yy} = 1 + 0\\cdot x + (-1)\\cdot y$,\n      $\\sigma_{xy} = 0 + 0.5\\cdot x + 0.2\\cdot y$.\n      Body force $f=(-0.2,\\,0.5)$.\n    - $K_1 = [0.5,1]\\times[0,1]$, Lamé $(\\lambda,\\mu)=(10,5)$, stress coefficients\n      $\\sigma_{xx} = 1 + (-1)\\cdot x + 0\\cdot y$,\n      $\\sigma_{yy} = 2 + 0\\cdot x + 1\\cdot y$,\n      $\\sigma_{xy} = 0 + (-0.3)\\cdot x + 0.4\\cdot y$.\n      Body force $f=(0.1,\\,-0.2)$.\n  - Interior face $F$ is the vertical segment at $x=0.5$ from $y=0$ to $y=1$, with $K^+=K_0$, $K^-=K_1$, and $n_F=(1,0)$ outward from $K^+$.\n\n- Test case $2$ (single rectangle in exact equilibrium):\n  - Elements:\n    - $K_0 = [0,1]\\times[0,1]$, Lamé $(\\lambda,\\mu)=(3,2)$, stress coefficients\n      $\\sigma_{xx} = 0 + 1\\cdot x + 0\\cdot y$,\n      $\\sigma_{yy} = 0 + 0\\cdot x + 1\\cdot y$,\n      $\\sigma_{xy} = 0 + 0\\cdot x + 0\\cdot y$,\n      Body force $f=(-1,\\,-1)$.\n  - No interior faces.\n\n- Test case $3$ (two vertically stacked rectangles):\n  - Elements:\n    - $K_0 = [0,1]\\times[0,0.4]$, Lamé $(\\lambda,\\mu)=(1,0.5)$, stress coefficients\n      $\\sigma_{xx} = 1 + 0\\cdot x + 0.1\\cdot y$,\n      $\\sigma_{yy} = 2 + (-0.2)\\cdot x + 0\\cdot y$,\n      $\\sigma_{xy} = 0 + 0.3\\cdot x + (-0.1)\\cdot y$,\n      Body force $f=(0,\\,0)$.\n    - $K_1 = [0,1]\\times[0.4,1]$, Lamé $(\\lambda,\\mu)=(50,20)$, stress coefficients\n      $\\sigma_{xx} = 1 + 0\\cdot x + (-0.2)\\cdot y$,\n      $\\sigma_{yy} = 1 + 0.3\\cdot x + 0\\cdot y$,\n      $\\sigma_{xy} = 0 + (-0.2)\\cdot x + 0.4\\cdot y$,\n      Body force $f=(0,\\,0.1)$.\n  - Interior face $F$ is the horizontal segment at $y=0.4$ from $x=0$ to $x=1$, with $K^+=K_0$, $K^-=K_1$, and $n_F=(0,1)$ outward from $K^+$.\n\nComputational requirements:\n- Implement the estimator $\\eta^2$ exactly as specified above using the midpoint and centroid quadrature rules, with $h_F=|F|$ and $h_K=\\sqrt{|K|}$.\n- Use the traction jump definition $\\llbracket\\sigma_h n\\rrbracket=\\sigma_h^+ n_F + \\sigma_h^-(-n_F)$ at the face midpoint.\n- For each test case, compute a single scalar $\\eta^2$.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, with each result rounded to six decimal places (e.g., $[r_1,r_2,r_3]$). No additional text should be printed.",
            "solution": "The user-provided problem statement has been analyzed and validated. It is found to be scientifically grounded, well-posed, and contains all necessary information for a unique solution. The problem requires the computation of a residual-based a posteriori error estimator, $\\eta^2$, for a Discontinuous Galerkin (DG) method applied to two-dimensional linear elasticity. The calculations will proceed for three distinct test cases as specified.\n\nThe error estimator is given by the formula:\n$$\n\\eta^2 \\;=\\; \\sum_{F \\in \\mathcal{F}_{\\mathrm{int}}} h_F \\,\\lVert \\llbracket \\sigma_h n \\rrbracket \\rVert_{F}^2 \\;+\\; \\sum_{K \\in \\mathcal{T}_h} h_K^2 \\,\\lVert f + \\nabla \\cdot \\sigma_h \\rVert_{K}^2\n$$\nThe problem provides specific implementations for the terms involved. With $h_F = |F|$, $h_K = \\sqrt{|K|}$, and the specified quadrature rules, the contributions are computed as:\n- Element contribution: $\\eta_K^2 = h_K^2 \\lVert f + \\nabla \\cdot \\sigma_h \\rVert_K^2 \\approx |K| \\left( |K| \\lVert f + \\nabla \\cdot \\sigma_h(m_K) \\rVert_2^2 \\right) = |K|^2 \\lVert f + \\nabla \\cdot \\sigma_h(m_K) \\rVert_2^2$.\n- Face contribution: $\\eta_F^2 = h_F \\lVert \\llbracket \\sigma_h n \\rrbracket \\rVert_F^2 \\approx |F| \\left( |F| \\lVert \\llbracket \\sigma_h n \\rrbracket_{m_F} \\rVert_2^2 \\right) = |F|^2 \\lVert \\llbracket \\sigma_h n \\rrbracket_{m_F} \\rVert_2^2$.\nThe traction jump $\\llbracket \\sigma_h n \\rrbracket$ is defined as $\\sigma_h^+ n_F + \\sigma_h^- (-n_F) = (\\sigma_h^+ - \\sigma_h^-) n_F$.\n\nThe stress field $\\sigma_h$ on each element $K$ is given by linear polynomials:\n$$\n\\begin{aligned}\n\\sigma_{xx}(x,y) &= a_0 + a_1 x + a_2 y \\\\\n\\sigma_{yy}(x,y) &= b_0 + b_1 x + b_2 y \\\\\n\\sigma_{xy}(x,y) &= c_0 + c_1 x + c_2 y\n\\end{aligned}\n$$\nThe divergence of this stress field is a constant vector on $K$:\n$$\n\\nabla\\cdot\\sigma_h = \n\\begin{bmatrix}\na_1 + c_2 \\\\\nc_1 + b_2\n\\end{bmatrix}\n$$\nThe traction vector on a surface with unit normal $n=(n_x, n_y)$ is $t = \\sigma n$:\n$$\nt = \n\\begin{bmatrix}\n\\sigma_{xx} n_x + \\sigma_{xy} n_y \\\\\n\\sigma_{xy} n_x + \\sigma_{yy} n_y\n\\end{bmatrix}\n$$\n\nWe will now calculate $\\eta^2$ for each test case.\n\n### Test Case 1: Two Horizontally Adjacent Rectangles\n\n- **Elements:** $K_0 = [0,0.5]\\times[0,1]$, $K_1 = [0.5,1]\\times[0,1]$.\n- **Interior Face:** $F$ is the segment at $x=0.5$ from $y=0$ to $y=1$.\n  - Face geometry: $|F|=1$, midpoint $m_F=(0.5, 0.5)$.\n  - Normal vector: $n_F=(1,0)$ (outward from $K_0=K^+$).\n\n**1. Elemental Contributions**\n- **Element $K_0$ ($|K_0|=0.5$):**\n  - Divergence: $\\nabla\\cdot\\sigma_{h_0} = \\begin{pmatrix} 1+0.2 \\\\ 0.5-1 \\end{pmatrix} = \\begin{pmatrix} 1.2 \\\\ -0.5 \\end{pmatrix}$.\n  - Body force: $f_0 = \\begin{pmatrix} -0.2 \\\\ 0.5 \\end{pmatrix}$.\n  - Residual: $R_0 = f_0 + \\nabla\\cdot\\sigma_{h_0} = \\begin{pmatrix} -0.2+1.2 \\\\ 0.5-0.5 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 0.0 \\end{pmatrix}$.\n  - Contribution: $\\eta_{K_0}^2 = |K_0|^2 \\lVert R_0 \\rVert_2^2 = (0.5)^2 (1.0^2+0.0^2) = 0.25$.\n- **Element $K_1$ ($|K_1|=0.5$):**\n  - Divergence: $\\nabla\\cdot\\sigma_{h_1} = \\begin{pmatrix} -1+0.4 \\\\ -0.3+1 \\end{pmatrix} = \\begin{pmatrix} -0.6 \\\\ 0.7 \\end{pmatrix}$.\n  - Body force: $f_1 = \\begin{pmatrix} 0.1 \\\\ -0.2 \\end{pmatrix}$.\n  - Residual: $R_1 = f_1 + \\nabla\\cdot\\sigma_{h_1} = \\begin{pmatrix} 0.1-0.6 \\\\ -0.2+0.7 \\end{pmatrix} = \\begin{pmatrix} -0.5 \\\\ 0.5 \\end{pmatrix}$.\n  - Contribution: $\\eta_{K_1}^2 = |K_1|^2 \\lVert R_1 \\rVert_2^2 = (0.5)^2 ((-0.5)^2+0.5^2) = 0.25 \\cdot 0.5 = 0.125$.\n\nTotal elemental contribution: $\\sum \\eta_K^2 = 0.25 + 0.125 = 0.375$.\n\n**2. Face Contribution**\n- **Face $F$:**\n  - Stress on $K_0$ side at $m_F(0.5, 0.5)$:\n    $\\sigma^+_{xx} = 2.5$, $\\sigma^+_{yy} = 0.5$, $\\sigma^+_{xy} = 0.35$.\n    $\\sigma_h^+(m_F) = \\begin{pmatrix} 2.5 & 0.35 \\\\ 0.35 & 0.5 \\end{pmatrix}$.\n  - Stress on $K_1$ side at $m_F(0.5, 0.5)$:\n    $\\sigma^-_{xx} = 0.5$, $\\sigma^-_{yy} = 2.5$, $\\sigma^-_{xy} = 0.05$.\n    $\\sigma_h^-(m_F) = \\begin{pmatrix} 0.5 & 0.05 \\\\ 0.05 & 2.5 \\end{pmatrix}$.\n  - Stress difference: $\\Delta\\sigma = \\sigma_h^+ - \\sigma_h^- = \\begin{pmatrix} 2.0 & 0.3 \\\\ 0.3 & -2.0 \\end{pmatrix}$.\n  - Traction jump vector: $J_F = \\Delta\\sigma \\cdot n_F = \\begin{pmatrix} 2.0 \\\\ 0.3 \\end{pmatrix}$.\n  - Contribution: $\\eta_F^2 = |F|^2 \\lVert J_F \\rVert_2^2 = (1)^2 (2.0^2+0.3^2) = 4.09$.\n\n**Total Estimator for Case 1:** $\\eta^2 = 0.375 + 4.09 = 4.465$.\n\n### Test Case 2: Single Rectangle in Exact Equilibrium\n\n- **Element:** $K_0 = [0,1]\\times[0,1]$.\n- **Interior Faces:** None.\n\n**1. Elemental Contribution**\n- **Element $K_0$ ($|K_0|=1.0$):**\n  - Divergence: $\\nabla\\cdot\\sigma_{h_0} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$.\n  - Body force: $f_0 = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}$.\n  - Residual: $R_0 = f_0 + \\nabla\\cdot\\sigma_{h_0} = \\begin{pmatrix} 0.0 \\\\ 0.0 \\end{pmatrix}$.\n  - Contribution: $\\eta_{K_0}^2 = |K_0|^2 \\lVert R_0 \\rVert_2^2 = (1.0)^2 (0.0^2+0.0^2) = 0.0$.\n\n**2. Face Contribution**\n- Since there are no interior faces, the contribution is $0$.\n\n**Total Estimator for Case 2:** $\\eta^2 = 0.0 + 0.0 = 0.0$.\n\n### Test Case 3: Two Vertically Stacked Rectangles\n\n- **Elements:** $K_0 = [0,1]\\times[0,0.4]$, $K_1 = [0,1]\\times[0.4,1]$.\n- **Interior Face:** $F$ is the segment at $y=0.4$ from $x=0$ to $x=1$.\n  - Face geometry: $|F|=1$, midpoint $m_F=(0.5, 0.4)$.\n  - Normal vector: $n_F=(0,1)$ (outward from $K_0=K^+$).\n\n**1. Elemental Contributions**\n- **Element $K_0$ ($|K_0|=0.4$):**\n  - Divergence: $\\nabla\\cdot\\sigma_{h_0} = \\begin{pmatrix} -0.1 \\\\ 0.3 \\end{pmatrix}$.\n  - Body force: $f_0 = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$.\n  - Residual: $R_0 = \\begin{pmatrix} -0.1 \\\\ 0.3 \\end{pmatrix}$.\n  - Contribution: $\\eta_{K_0}^2 = (0.4)^2 ((-0.1)^2+0.3^2) = 0.16 \\cdot 0.1 = 0.016$.\n- **Element $K_1$ ($|K_1|=0.6$):**\n  - Divergence: $\\nabla\\cdot\\sigma_{h_1} = \\begin{pmatrix} 0.4 \\\\ -0.2 \\end{pmatrix}$.\n  - Body force: $f_1 = \\begin{pmatrix} 0 \\\\ 0.1 \\end{pmatrix}$.\n  - Residual: $R_1 = f_1 + \\nabla\\cdot\\sigma_{h_1} = \\begin{pmatrix} 0.4 \\\\ -0.1 \\end{pmatrix}$.\n  - Contribution: $\\eta_{K_1}^2 = (0.6)^2 (0.4^2+(-0.1)^2) = 0.36 \\cdot 0.17 = 0.0612$.\n\nTotal elemental contribution: $\\sum \\eta_K^2 = 0.016 + 0.0612 = 0.0772$.\n\n**2. Face Contribution**\n- **Face $F$:**\n  - Stress on $K_0$ side at $m_F(0.5, 0.4)$:\n    $\\sigma^+_{xx} = 1.04$, $\\sigma^+_{yy} = 1.9$, $\\sigma^+_{xy} = 0.11$.\n    $\\sigma_h^+(m_F) = \\begin{pmatrix} 1.04 & 0.11 \\\\ 0.11 & 1.9 \\end{pmatrix}$.\n  - Stress on $K_1$ side at $m_F(0.5, 0.4)$:\n    $\\sigma^-_{xx} = 0.92$, $\\sigma^-_{yy} = 1.15$, $\\sigma^-_{xy} = 0.06$.\n    $\\sigma_h^-(m_F) = \\begin{pmatrix} 0.92 & 0.06 \\\\ 0.06 & 1.15 \\end{pmatrix}$.\n  - Stress difference: $\\Delta\\sigma = \\sigma_h^+ - \\sigma_h^- = \\begin{pmatrix} 0.12 & 0.05 \\\\ 0.05 & 0.75 \\end{pmatrix}$.\n  - Traction jump vector: $J_F = \\Delta\\sigma \\cdot n_F = \\begin{pmatrix} 0.05 \\\\ 0.75 \\end{pmatrix}$.\n  - Contribution: $\\eta_F^2 = (1)^2 (0.05^2+0.75^2) = 0.565$.\n\n**Total Estimator for Case 3:** $\\eta^2 = 0.0772 + 0.565 = 0.6422$.\n\nSummary of results:\n- Case 1: $4.465$\n- Case 2: $0.0$\n- Case 3: $0.6422$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the a posteriori error estimator eta^2 for three test cases\n    in 2D linear elasticity using a Discontinuous Galerkin formulation.\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1\n        {\n            \"elements\": [\n                {\n                    \"id\": 0,\n                    \"bbox\": [0, 0.5, 0, 1],\n                    \"stress_coeffs\": {\n                        \"xx\": [2.0, 1.0, 0.0],  # a0, a1, a2\n                        \"yy\": [1.0, 0.0, -1.0], # b0, b1, b2\n                        \"xy\": [0.0, 0.5, 0.2],  # c0, c1, c2\n                    },\n                    \"body_force\": np.array([-0.2, 0.5]),\n                },\n                {\n                    \"id\": 1,\n                    \"bbox\": [0.5, 1, 0, 1],\n                    \"stress_coeffs\": {\n                        \"xx\": [1.0, -1.0, 0.0],\n                        \"yy\": [2.0, 0.0, 1.0],\n                        \"xy\": [0.0, -0.3, 0.4],\n                    },\n                    \"body_force\": np.array([0.1, -0.2]),\n                },\n            ],\n            \"faces\": [\n                {\n                    \"endpoints\": [np.array([0.5, 0]), np.array([0.5, 1])],\n                    \"k_plus_id\": 0,\n                    \"k_minus_id\": 1,\n                    \"normal\": np.array([1, 0]),\n                }\n            ],\n        },\n        # Test Case 2\n        {\n            \"elements\": [\n                {\n                    \"id\": 0,\n                    \"bbox\": [0, 1, 0, 1],\n                    \"stress_coeffs\": {\n                        \"xx\": [0.0, 1.0, 0.0],\n                        \"yy\": [0.0, 0.0, 1.0],\n                        \"xy\": [0.0, 0.0, 0.0],\n                    },\n                    \"body_force\": np.array([-1.0, -1.0]),\n                }\n            ],\n            \"faces\": [],\n        },\n        # Test Case 3\n        {\n            \"elements\": [\n                {\n                    \"id\": 0,\n                    \"bbox\": [0, 1, 0, 0.4],\n                    \"stress_coeffs\": {\n                        \"xx\": [1.0, 0.0, 0.1],\n                        \"yy\": [2.0, -0.2, 0.0],\n                        \"xy\": [0.0, 0.3, -0.1],\n                    },\n                    \"body_force\": np.array([0.0, 0.0]),\n                },\n                {\n                    \"id\": 1,\n                    \"bbox\": [0, 1, 0.4, 1],\n                    \"stress_coeffs\": {\n                        \"xx\": [1.0, 0.0, -0.2],\n                        \"yy\": [1.0, 0.3, 0.0],\n                        \"xy\": [0.0, -0.2, 0.4],\n                    },\n                    \"body_force\": np.array([0.0, 0.1]),\n                },\n            ],\n            \"faces\": [\n                {\n                    \"endpoints\": [np.array([0, 0.4]), np.array([1, 0.4])],\n                    \"k_plus_id\": 0,\n                    \"k_minus_id\": 1,\n                    \"normal\": np.array([0, 1]),\n                }\n            ],\n        },\n    ]\n\n    def eval_stress_tensor(x, y, coeffs):\n        a0, a1, a2 = coeffs[\"xx\"]\n        b0, b1, b2 = coeffs[\"yy\"]\n        c0, c1, c2 = coeffs[\"xy\"]\n        s_xx = a0 + a1 * x + a2 * y\n        s_yy = b0 + b1 * x + b2 * y\n        s_xy = c0 + c1 * x + c2 * y\n        return np.array([[s_xx, s_xy], [s_xy, s_yy]])\n\n    def eval_div_stress(coeffs):\n        _, a1, a2 = coeffs[\"xx\"]\n        _, _, b2 = coeffs[\"yy\"]\n        _, c1, c2 = coeffs[\"xy\"]\n        div_x = a1 + c2\n        div_y = c1 + b2\n        return np.array([div_x, div_y])\n\n    results = []\n    for case in test_cases:\n        eta_squared = 0.0\n        \n        elements_by_id = {elem[\"id\"]: elem for elem in case[\"elements\"]}\n\n        # Calculate element contributions\n        for elem in case[\"elements\"]:\n            x0, x1, y0, y1 = elem[\"bbox\"]\n            area = (x1 - x0) * (y1 - y0)\n            \n            div_sigma = eval_div_stress(elem[\"stress_coeffs\"])\n            residual = elem[\"body_force\"] + div_sigma\n            \n            residual_norm_sq = np.dot(residual, residual)\n            eta_squared += area**2 * residual_norm_sq\n\n        # Calculate face contributions\n        for face in case[\"faces\"]:\n            p0, p1 = face[\"endpoints\"]\n            face_len = np.linalg.norm(p1 - p0)\n            midpoint = (p0 + p1) / 2.0\n            x_m, y_m = midpoint\n\n            k_plus = elements_by_id[face[\"k_plus_id\"]]\n            k_minus = elements_by_id[face[\"k_minus_id\"]]\n            \n            sigma_plus = eval_stress_tensor(x_m, y_m, k_plus[\"stress_coeffs\"])\n            sigma_minus = eval_stress_tensor(x_m, y_m, k_minus[\"stress_coeffs\"])\n            \n            delta_sigma = sigma_plus - sigma_minus\n            normal = face[\"normal\"]\n            \n            jump_vector = delta_sigma @ normal\n            jump_norm_sq = np.dot(jump_vector, jump_vector)\n            \n            eta_squared += face_len**2 * jump_norm_sq\n            \n        results.append(f\"{eta_squared:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}