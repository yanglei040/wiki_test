{
    "hands_on_practices": [
        {
            "introduction": "基于残差的后验误差估计的核心是计算局部残差的能力。本练习提供了一个具体的、分步的计算实践，要求您为一个非线性材料模型计算误差指示子的两个基本组成部分——单元内部残差和单元间边界跳跃残差。掌握这一计算是实现和理解自适应有限元方法的第一步。",
            "id": "3595950",
            "problem": "考虑一个二维参考构型，由坐标为 $(X,Y) \\in [0,1] \\times [0,1]$ 的单位正方形给出。该正方形被从 $(0,0)$ 到 $(1,1)$ 的对角边分割成两个三角形有限元：\n- 单元 $K_{1}$ 的顶点为 $(0,0)$、$(1,0)$、$(1,1)$。\n- 单元 $K_{2}$ 的顶点为 $(0,0)$、$(0,1)$、$(1,1)$。\n令 $E_{0}$ 表示 $K_{1}$ 和 $K_{2}$ 从 $(0,0)$ 到 $(1,1)$ 共享的内部边。\n\n材料为可压缩 Neo-Hookean 固体，其储存能量密度为\n$$\nW(F) = \\frac{\\mu}{2}\\big(\\mathrm{tr}(C)-3\\big) - \\mu \\ln J + \\frac{\\lambda}{2}(\\ln J)^{2},\n$$\n其中 $F$ 是变形梯度，$C = F^{\\top}F$ 是右 Cauchy-Green 张量，$J = \\det(F)$，$\\mu, \\lambda$ 是 Lamé 参数。假设为平面应变运动学。第一 Piola-Kirchhoff 应力（FPK 应力）$P(F)$ 定义为 $P(F) = \\partial W/\\partial F$。\n\n假设一个分片仿射有限元位移场，其梯度是分片常数，并等于以下值：\n$$\nF_{h}\\big|_{K_{1}} = \\begin{pmatrix} 1.1 & 0 \\\\ 0 & 1.0 \\end{pmatrix}, \\qquad\nF_{h}\\big|_{K_{2}} = \\begin{pmatrix} 0.9 & 0 \\\\ 0 & 1.0 \\end{pmatrix}.\n$$\n取材料参数 $\\mu = 80\\,\\mathrm{kPa}$ 和 $\\lambda = 120\\,\\mathrm{kPa}$。令体力在参考构型中为常数，$b = (0.4,-0.2)\\,\\mathrm{kN/m}^{3}$，并令外边界上的给定面力为零，即在所有 Neumann 边界段上 $t = (0,0)$。\n\n从参考构型中的动量平衡强形式出发，\n$$\n\\mathrm{Div}\\,P(F) + b = 0 \\quad \\text{在域内},\n$$\n以及 Neumann 边界上的面力边界条件，\n$$\nP(F)\\,n = t \\quad \\text{在边界上},\n$$\n推导用以评估单元残差和边跳跃的表达式，这两者为分片常数 $F_{h}$ 定义了基于残差的误差指示子：\n- 单元 $K$ 上的单元残差是矢量场 $R_{K} = \\mathrm{Div}\\,P(F_{h}) + b$。\n- 跨越由单元 $K^{+}$ 和 $K^{-}$ 共享的内部边 $E$ 的跳跃是矢量场 $J_{E} = P(F_{h}^{+})\\,n^{+} + P(F_{h}^{-})\\,n^{-}$, 其中 $n^{\\pm}$ 是 $K^{\\pm}$ 在 $E$ 上的外向き单位法向量。\n\n使用以下尺寸度量：\n- 对每个单元，$h_{K}$ 是单元直径（$K$ 中任意两点之间的最长距离）。\n- 对内部边 $E_{0}$，$h_{E_{0}}$ 是边长。\n\n将基于残差的指示子定义为\n$$\nr_{K} = h_{K}\\,\\|R_{K}\\|_{L^{2}(K)}, \\qquad\nj_{E_{0}} = h_{E_{0}}^{1/2}\\,\\|J_{E_{0}}\\|_{L^{2}(E_{0})},\n$$\n其中 $\\|\\cdot\\|_{L^{2}}$ 表示在指定集合上的 $L^{2}$ 范数。对于此构型，使用在 $E_{0}$ 上从 $K_{1}$ 指向外部的单位法向量为 $n^{+} = \\frac{1}{\\sqrt{2}}(-1,\\,1)$，因此从 $K_{2}$ 指向外部的法向量为 $n^{-} = -n^{+}$。\n\n使用这些定义，计算总指示子\n$$\n\\eta = \\Big(r_{K_{1}}^{2} + r_{K_{2}}^{2} + j_{E_{0}}^{2}\\Big)^{1/2}.\n$$\n以 $\\mathrm{kN/m}$ 为单位表示 $\\eta$ 的最终值，并将您的答案四舍五入到四位有效数字。",
            "solution": "用户在计算固体力学领域提供了一个定义明确的问题。该问题具有科学依据、内容自洽，且所有提供的数据均一致。因此，该问题被视为有效，可以提供完整解答。\n\n目标是计算总的基于残差的误差指示子 $\\eta = \\Big(r_{K_{1}}^{2} + r_{K_{2}}^{2} + j_{E_{0}}^{2}\\Big)^{1/2}$。这需要计算单元指示子 $r_{K}$ 和边指示子 $j_{E_{0}}$。\n\n第一 Piola-Kirchhoff (FPK) 应力 $P$ 是从储存能量密度 $W(F)$ 导出的，即 $P(F) = \\partial W/\\partial F$。对于给定的可压缩 Neo-Hookean 模型，\n$$\nW(F) = \\frac{\\mu}{2}\\big(\\mathrm{tr}(C)-3\\big) - \\mu \\ln J + \\frac{\\lambda}{2}(\\ln J)^{2}\n$$\nFPK 应力由标准公式给出：\n$$\nP(F) = \\mu F + (\\lambda \\ln J - \\mu) F^{-T}\n$$\n其中 $F$ 是变形梯度，$J = \\det(F)$，$\\mu, \\lambda$ 是 Lamé 参数。\n\n首先，我们计算单元残差指示子 $r_{K_1}$ 和 $r_{K_2}$。单元残差定义为 $R_{K} = \\mathrm{Div}\\,P(F_{h}) + b$。问题指定了分片常数的变形梯度 $F_h$。因此，应力张量 $P(F_h)$ 在每个单元内也是分片常数。常数张量的散度为零，即在每个单元 $K$ 的内部 $\\mathrm{Div}\\,P(F_{h}) = 0$。因此，单元残差简化为体力：\n$$\nR_{K_1} = b \\quad \\text{和} \\quad R_{K_2} = b\n$$\n体力给定为 $b = (0.4, -0.2)\\,\\mathrm{kN/m}^{3}$。因此，其大小的平方为：\n$$\n|b|^2 = (0.4)^2 + (-0.2)^2 = 0.16 + 0.04 = 0.20 \\, (\\mathrm{kN/m}^3)^2\n$$\n单元指示子为 $r_{K} = h_{K}\\,\\|R_{K}\\|_{L^{2}(K)}$。由于 $R_K=b$ 在单元上是常数，其 $L^2$ 范数为 $\\|R_K\\|_{L^2(K)} = \\left(\\int_K |b|^2 dA\\right)^{1/2} = |b| \\sqrt{\\text{Area}(K)}$。\n单元 $K_1$ 和 $K_2$ 分别是顶点为 $(0,0), (1,0), (1,1)$ 和 $(0,0), (0,1), (1,1)$ 的直角三角形。两者的面积均为 $1/2$。\n$$\n\\text{Area}(K_1) = \\text{Area}(K_2) = \\frac{1}{2} \\cdot 1 \\cdot 1 = \\frac{1}{2} \\, \\mathrm{m}^2\n$$\n直角三角形的直径 $h_K$ 是其斜边的长度。$K_1$ 的顶点为 $(0,0)$、$(1,0)$、$(1,1)$。边长分别为 $1$、$1$ 和 $\\sqrt{(1-0)^2 + (1-0)^2} = \\sqrt{2}$。因此直径为 $h_{K_1}=\\sqrt{2}\\,\\mathrm{m}$。类似地，对于顶点为 $(0,0)$、$(0,1)$、$(1,1)$ 的 $K_2$，其直径为 $h_{K_2}=\\sqrt{2}\\,\\mathrm{m}$。\n我们现在可以计算单元指示子的平方：\n$$\nr_{K}^2 = h_{K}^2 \\|R_K\\|_{L^2(K)}^2 = h_K^2 |b|^2 \\text{Area}(K)\n$$\n对于单元 $K_1$ 和 $K_2$ 两者：\n$$\nr_{K_1}^2 = r_{K_2}^2 = (\\sqrt{2})^2 \\cdot 0.20 \\cdot \\frac{1}{2} = 2 \\cdot 0.20 \\cdot 0.5 = 0.20 \\, (\\mathrm{kN/m})^2\n$$\n\n接下来，我们计算内部边指示子 $j_{E_0}$。跳跃为 $J_{E_{0}} = P(F_{h}^{+})\\,n^{+} + P(F_{h}^{-})\\,n^{-}$。设 $K_1=K^+$，$K_2=K^-$，$F_1=F_h^+$，$F_2=F_h^-$，以及 $n^- = -n^+$，则表达式变为：\n$$\nJ_{E_0} = (P(F_1) - P(F_2))n^+\n$$\n让我们使用 $\\mu = 80\\,\\mathrm{kPa}$ 和 $\\lambda = 120\\,\\mathrm{kPa}$ 来计算应力张量 $P_1 = P(F_1)$ 和 $P_2 = P(F_2)$。\n\n对于单元 $K_1$：\n$F_1 = \\begin{pmatrix} 1.1 & 0 \\\\ 0 & 1.0 \\end{pmatrix}$。因此，$J_1 = \\det(F_1) = 1.1$ 且 $F_1^{-T} = \\begin{pmatrix} 1/1.1 & 0 \\\\ 0 & 1 \\end{pmatrix}$。\n$$\nP_1 = 80 \\begin{pmatrix} 1.1 & 0 \\\\ 0 & 1 \\end{pmatrix} + (120 \\ln(1.1) - 80) \\begin{pmatrix} 1/1.1 & 0 \\\\ 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 88 + \\frac{120\\ln(1.1)-80}{1.1} & 0 \\\\ 0 & 120\\ln(1.1) \\end{pmatrix}\n$$\n\n对于单元 $K_2$：\n$F_2 = \\begin{pmatrix} 0.9 & 0 \\\\ 0 & 1.0 \\end{pmatrix}$。因此，$J_2 = \\det(F_2) = 0.9$ 且 $F_2^{-T} = \\begin{pmatrix} 1/0.9 & 0 \\\\ 0 & 1 \\end{pmatrix}$。\n$$\nP_2 = 80 \\begin{pmatrix} 0.9 & 0 \\\\ 0 & 1 \\end{pmatrix} + (120 \\ln(0.9) - 80) \\begin{pmatrix} 1/0.9 & 0 \\\\ 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 72 + \\frac{120\\ln(0.9)-80}{0.9} & 0 \\\\ 0 & 120\\ln(0.9) \\end{pmatrix}\n$$\n应力差为 $\\Delta P = P_1 - P_2 = \\text{diag}(\\Delta P_{11}, \\Delta P_{22})$：\n$$\n\\Delta P_{11} = \\left(88 + \\frac{120\\ln(1.1)-80}{1.1}\\right) - \\left(72 + \\frac{120\\ln(0.9)-80}{0.9}\\right) \\approx 56.60716\\,\\mathrm{kPa}\n$$\n$$\n\\Delta P_{22} = 120\\ln(1.1) - 120\\ln(0.9) = 120\\ln\\left(\\frac{1.1}{0.9}\\right) \\approx 24.08048\\,\\mathrm{kPa}\n$$\n法向量为 $n^+ = \\frac{1}{\\sqrt{2}}(-1, 1)^T$。跳跃向量沿该边为常数：\n$$\nJ_{E_0} = \\Delta P n^+ = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -\\Delta P_{11} \\\\ \\Delta P_{22} \\end{pmatrix}\n$$\n跳跃向量大小的平方为：\n$$\n|J_{E_0}|^2 = \\frac{1}{2}(\\Delta P_{11}^2 + \\Delta P_{22}^2) \\approx \\frac{1}{2}((56.60716)^2 + (24.08048)^2) \\approx 1892.122 \\, (\\mathrm{kPa})^2\n$$\n内部边指示子为 $j_{E_0} = h_{E_0}^{1/2} \\|J_{E_0}\\|_{L^2(E_0)}$。由于 $J_{E_0}$ 是常数，$\\|J_{E_0}\\|_{L^2(E_0)} = |J_{E_0}| \\sqrt{h_{E_0}}$。边 $E_0$ 的长度为 $h_{E_0} = \\sqrt{2}\\,\\mathrm{m}$。\n所以，$j_{E_0} = h_{E_0}^{1/2} (|J_{E_0}| h_{E_0}^{1/2}) = h_{E_0} |J_{E_0}|$。该指示子的平方为：\n$$\nj_{E_0}^2 = h_{E_0}^2 |J_{E_0}|^2 = (\\sqrt{2})^2 \\cdot |J_{E_0}|^2 = 2 \\cdot \\frac{1}{2}(\\Delta P_{11}^2 + \\Delta P_{22}^2) = \\Delta P_{11}^2 + \\Delta P_{22}^2\n$$\n这个量的单位是 $\\mathrm{m}^2 \\cdot (\\mathrm{kPa})^2 = \\mathrm{m}^2 \\cdot (\\mathrm{kN/m^2})^2 = (\\mathrm{kN/m})^2$。\n$$\nj_{E_0}^2 \\approx (56.60716)^2 + (24.08048)^2 \\approx 3204.375 + 579.870 \\approx 3784.245 \\, (\\mathrm{kN/m})^2\n$$\n\n最后，计算总指示子 $\\eta$：\n$$\n\\eta^2 = r_{K_1}^2 + r_{K_2}^2 + j_{E_0}^2 \\approx 0.20 + 0.20 + 3784.245 = 3784.645 \\, (\\mathrm{kN/m})^2\n$$\n$$\n\\eta = \\sqrt{3784.645} \\approx 61.519468 \\, \\mathrm{kN/m}\n$$\n四舍五入到四位有效数字，我们得到 $\\eta = 61.52\\,\\mathrm{kN/m}$。",
            "answer": "$$\n\\boxed{61.52}\n$$"
        },
        {
            "introduction": "一个可靠的误差估计必须考虑所有误差来源，而不仅仅是离散解本身带来的误差。本练习探讨了“载荷数据振荡”这一概念，它源于对精确载荷项的近似。通过本练习，您将理解为何该项是完整误差分析中必不可少的一部分，并实践其计算，从而加深对总数值误差不同来源的理解。",
            "id": "3595892",
            "problem": "考虑一个在区间 $\\Omega = (0,1)$ 上提出的具有齐次狄利克雷边界条件的无量纲化一维小应变线性弹性代理问题，其中位移场 $u$ 满足从力平衡推导出的弱形式：求 $u \\in H^{1}_{0}(\\Omega)$，使得对于所有容许的检验函数 $v \\in H^{1}_{0}(\\Omega)$，均有 $\\int_{\\Omega} u'(x) v'(x) \\,\\mathrm{d}x = \\int_{\\Omega} f(x) v(x) \\,\\mathrm{d}x$。假设一个次数为 $p = 1$ 的协调分片多项式有限元空间，并令 $u_{h}$ 表示相应的有限元解。在基于残差的后验误差估计中，单元 $K$ 上的单元残差定义为离散解与载荷之间的强形式失配。在实践中，为了与离散多项式结构保持一致，体力 $f$ 通过其在单元上次数为 $q \\leq p-1$ 的逐单元多项式投影 $f_{h}$ 来近似。\n\n从弱形式和基于残差的指示子的定义出发，推导在单元 $K$ 上用 $f_{h}$ 替换 $f$ 所关联的载荷数据振荡项，并解释为什么此项对于基于残差的误差指示子的局部有效性是必要的。然后，对于单元尺寸为 $h_{K} = \\tfrac{1}{4}$ 的特定单元 $K = (0, \\tfrac{1}{4})$，取精确体力为 $f(x) = \\sin(\\pi x)$，并令 $f_{h}$ 为 $f$ 在 $K$ 上到次数为 $q = 0$ 的多项式（即分片常数）上的逐单元 $L^{2}$-投影。计算在 $K$ 上由下式定义的载荷数据振荡项\n$$\n\\mathrm{osc}_{K} := h_{K} \\left\\| f - f_{h} \\right\\|_{L^{2}(K)} ,\n$$\n并将你的最终答案以单一的、精确的、闭式解析表达式的形式报告。无舍入要求。所有量都是无量纲的，因此不需要物理单位。",
            "solution": "该问题包含两部分。第一部分是关于基于残差的后验误差估计中载荷数据振荡项的理论推导和解释。第二部分是针对给定情景对此项的具体计算。\n\n### 第一部分：载荷数据振荡项的推导与必要性\n\n我们从问题的弱形式和有限元近似的定义开始。精确解 $u \\in H^1_0(\\Omega)$ 满足：\n$$\n\\int_{\\Omega} u'(x) v'(x) \\,\\mathrm{d}x = \\int_{\\Omega} f(x) v(x) \\,\\mathrm{d}x \\quad \\forall v \\in H^1_0(\\Omega)\n$$\n在实践中，载荷函数 $f$ 通常在每个单元上被多项式近似 $f_h$ 所取代。对于本问题，$f_h$ 是一个通过 $L^2$-投影得到的分片常数函数（次数 $q=0$）。来自连续分片线性多项式空间 $V_h \\subset H^1_0(\\Omega)$ 的有限元解 $u_h$ 由下式计算得出：\n$$\n\\int_{\\Omega} u_h'(x) v_h'(x) \\,\\mathrm{d}x = \\int_{\\Omega} f_h(x) v_h(x) \\,\\mathrm{d}x \\quad \\forall v_h \\in V_h\n$$\n误差定义为 $e(x) = u(x) - u_h(x)$。误差函数 $e$ 属于 $H^1_0(\\Omega)$。从精确弱形式（其中 $v$ 被替换为 $v_h$）中减去有限元方程，得到关于 $f_h$ 的伽辽金正交性条件：\n$$\n\\int_{\\Omega} (u' - u_h') v_h' \\,\\mathrm{d}x = \\int_{\\Omega} (f - f_h) v_h \\,\\mathrm{d}x \\implies \\int_{\\Omega} e' v_h' \\,\\mathrm{d}x = \\int_{\\Omega} (f - f_h) v_h \\,\\mathrm{d}x \\quad \\forall v_h \\in V_h\n$$\n后验误差估计的目标是界定误差，通常是在能量范数中，其定义为 $\\|e\\|_E^2 := \\int_{\\Omega} (e'(x))^2 \\,\\mathrm{d}x$。我们从误差的能量范数的定义开始：\n$$\n\\|e\\|_E^2 = \\int_{\\Omega} e' e' \\,\\mathrm{d}x = \\int_{\\Omega} u' e' \\,\\mathrm{d}x - \\int_{\\Omega} u_h' e' \\,\\mathrm{d}x\n$$\n使用精确解 $u$ 的弱形式（检验函数为 $v=e$），我们有：\n$$\n\\|e\\|_E^2 = \\int_{\\Omega} f e \\,\\mathrm{d}x - \\int_{\\Omega} u_h' e' \\,\\mathrm{d}x\n$$\n该方程是推导基于残差的估计子的起点。我们将定义域 $\\Omega$ 上的积分分解为有限元网格 $\\mathcal{T}_h$ 中所有单元 $K$ 上的和：\n$$\n\\|e\\|_E^2 = \\sum_{K \\in \\mathcal{T}_h} \\int_K f e \\,\\mathrm{d}x - \\sum_{K \\in \\mathcal{T}_h} \\int_K u_h' e' \\,\\mathrm{d}x\n$$\n对每个单元 $K$ 上的第二项应用分部积分：\n$$\n\\int_K u_h' e' \\,\\mathrm{d}x = \\int_K (-u_h'') e \\,\\mathrm{d}x + [u_h' e]_{\\partial K}\n$$\n由于 $u_h$ 在每个单元 $K$ 上是线性多项式（次数 $p=1$），其二阶导数 $u_h''$ 在每个单元内部为零。方程变为：\n$$\n\\|e\\|_E^2 = \\sum_{K \\in \\mathcal{T}_h} \\int_K f e \\,\\mathrm{d}x - \\sum_{K \\in \\mathcal{T}_h} [u_h' e]_{\\partial K}\n$$\n在单元 $K = (x_L, x_R)$ 上的边界项 $[u_h' e]_{\\partial K}$ 是 $u_h'(x_R)e(x_R) - u_h'(x_L)e(x_L)$。当对所有单元求和时，这些项在单元交界面（节点）处被计算。由于 $e \\in H^1_0(\\Omega)$，因此 $e(0)=e(1)=0$。在内部节点 $z$ 处，来自两个相邻单元 $K_L$ 和 $K_R$ 的贡献是 $-u_h'|_{K_L}(z)e(z)$ 和 $+u_h'|_{K_R}(z)e(z)$，其和为 $\\llbracket u_h' \\rrbracket_z e(z)$，其中 $\\llbracket u_h' \\rrbracket_z = u_h'|_{K_R}(z) - u_h'|_{K_L}(z)$ 是 $u_h$ 导数在节点 $z$ 处的跳跃。为了与标准文献匹配，反转分部积分中使用的符号约定，单元边界上的和变为内部面（节点）$\\mathcal{E}_I$ 上的和：\n$$\n\\|e\\|_E^2 = \\sum_{K \\in \\mathcal{T}_h} \\int_K f e \\,\\mathrm{d}x + \\sum_{z \\in \\mathcal{E}_I} \\llbracket u_h' \\rrbracket_z e(z)\n$$\n这就是误差恒等式。为了分离数据近似的贡献，我们写下 $f = f_h + (f - f_h)$:\n$$\n\\|e\\|_E^2 = \\sum_{K \\in \\mathcal{T}_h} \\int_K f_h e \\,\\mathrm{d}x + \\sum_{z \\in \\mathcal{E}_I} \\llbracket u_h' \\rrbracket_z e(z) + \\sum_{K \\in \\mathcal{T}_h} \\int_K (f - f_h) e \\,\\mathrm{d}x\n$$\n右侧的前两项构成了离散解相对于近似载荷 $f_h$ 的残差。单元残差为 $R_K := f_h$（因为 $-u_h''=0$），跳跃残差为 $J_z := \\llbracket u_h' \\rrbracket_z$。这些都是可计算的量。通过应用柯西-施瓦茨不等式和插值估计，这部分可以被每个单元的可计算误差指示子 $\\eta_K$ 所界定，其中 $\\eta_K^2 \\approx h_K^2 \\|R_K\\|_{L^2(K)}^2 + h_K \\|J_K\\|_{L^2(\\partial K)}^2$。\n\n第三项 $\\sum_{K \\in \\mathcal{T}_h} \\int_K (f - f_h) e \\,\\mathrm{d}x$ 取决于真实载荷 $f$ 与其近似 $f_h$ 之间的差异。该项产生了载荷数据振荡。使用柯西-施瓦茨不等式，其绝对值有界：\n$$\n\\left| \\int_K (f - f_h) e \\,\\mathrm{d}x \\right| \\le \\|f - f_h\\|_{L^2(K)} \\|e\\|_{L^2(K)}\n$$\n使用庞加莱型不等式，$\\|e\\|_{L^2(K)} \\le C h_K \\|e'\\|_{L^2(K)}$。因此，该项被一个与 $h_K \\|f - f_h\\|_{L^2(K)}$ 成比例的量所界定，这正是振荡项 $\\mathrm{osc}_K$ 的定义。\n最终的误差界（可靠性）形式为：\n$$\n\\|e\\|_E^2 \\le C \\left( \\sum_{K \\in \\mathcal{T}_h} \\eta_K^2 + \\sum_{K \\in \\mathcal{T}_h} \\mathrm{osc}_K^2 \\right)\n$$\n这表明总误差由两个来源控制：离散化误差（由残差指示子 $\\eta_K$ 衡量）和数据近似误差（由振荡项 $\\mathrm{osc}_K$ 衡量）。\n\n振荡项对于局部有效性的必要性至关重要。局部有效性要求局部指示子 $\\eta_K$ 被局部误差所界定，即 $\\eta_K \\le C_{\\text{eff}} \\|e\\|_{E(\\omega_K)}$，其中 $\\omega_K$ 是围绕 $K$ 的单元片。如果我们将指示子定义为仅包含残差部分 $\\eta_K$，则可以构造一个场景，其中 $\\eta_K$ 非常小，但真实的局部误差很大。\n考虑一个在单元 $K$ 尺度上高度振荡的载荷函数 $f(x)$。例如，$f(x) = \\sin(N \\pi x/h_K)$，其中 $N$ 是一个大整数。它到常数上的 $L^2$-投影 $f_h$ 可能非常接近于零。因此，依赖于 $f_h$ 的残差指示子 $\\eta_K$ 将会很小。然而，精确解 $u$ 将反映 $f$ 的振荡性质。在粗网格上的分片线性近似 $u_h$ 无法捕捉这些振荡，导致产生大的误差 $e=u-u_h$。在这种情况下，$\\|e\\|_{E(\\omega_K)}$ 会很大，而 $\\eta_K$ 很小，这违反了有效性原则。\n这种情况下的大误差是由于无法精确表示源项 $f$ 所致，而这被振荡项 $\\|f-f_h\\|_{L^2(K)}$ 所捕捉。局部有效性界被正确地表述为 $\\eta_K^2 \\le C_{\\text{eff}} \\left( \\|e'\\|_{L^2(\\omega_K)}^2 + \\sum_{K' \\subset \\omega_K} \\mathrm{osc}_{K'}^2 \\right)$。这表明残差指示子 $\\eta_K$ 仅将误差控制在数据振荡的水平上。因此，任何稳健的误差控制策略都必须考虑振荡项，因为它代表了一个独立于离散解残差的基本误差来源。\n\n### 第二部分：载荷数据振荡项的计算\n\n我们需要为给定数据计算 $\\mathrm{osc}_{K} := h_{K} \\left\\| f - f_{h} \\right\\|_{L^{2}(K)}$。\n已知条件为：\n- 单元：$K = (0, \\frac{1}{4})$\n- 单元尺寸：$h_K = \\frac{1}{4}$\n- 体力：$f(x) = \\sin(\\pi x)$\n- 载荷近似：$f_h$ 是 $f$ 在 $K$ 上到次数为 $q=0$ 的多项式（即 $K$ 上的常数函数空间）的 $L^2$-投影。\n\n首先，我们求出常数 $f_h$。它是 $f(x)$ 在单元 $K$ 上的平均值：\n$$\nf_h = \\frac{1}{\\mathrm{meas}(K)} \\int_K f(x) \\,\\mathrm{d}x = \\frac{1}{1/4} \\int_0^{1/4} \\sin(\\pi x) \\,\\mathrm{d}x\n$$\n我们计算该积分：\n$$\n\\int_0^{1/4} \\sin(\\pi x) \\,\\mathrm{d}x = \\left[ -\\frac{\\cos(\\pi x)}{\\pi} \\right]_0^{1/4} = -\\frac{1}{\\pi} \\left( \\cos\\left(\\frac{\\pi}{4}\\right) - \\cos(0) \\right) = -\\frac{1}{\\pi} \\left( \\frac{\\sqrt{2}}{2} - 1 \\right) = \\frac{1}{\\pi} \\left( 1 - \\frac{\\sqrt{2}}{2} \\right)\n$$\n因此，$f_h$ 在 $K$ 上的常数值为：\n$$\nf_h = 4 \\cdot \\frac{1}{\\pi} \\left( 1 - \\frac{\\sqrt{2}}{2} \\right) = \\frac{4 - 2\\sqrt{2}}{\\pi}\n$$\n接下来，我们计算范数的平方 $\\| f - f_{h} \\|_{L^{2}(K)}^2$。根据 $L^2$ 投影的性质，我们有正交分解 $\\|f\\|_{L^2(K)}^2 = \\|f - f_h\\|_{L^2(K)}^2 + \\|f_h\\|_{L^2(K)}^2$。因此，计算下式很方便：\n$$\n\\| f - f_{h} \\|_{L^{2}(K)}^2 = \\| f \\|_{L^{2}(K)}^2 - \\| f_h \\|_{L^{2}(K)}^2\n$$\n我们计算右侧的每一项。\n1.  $\\| f \\|_{L^{2}(K)}^2$:\n    $$\n    \\| f \\|_{L^{2}(K)}^2 = \\int_0^{1/4} (\\sin(\\pi x))^2 \\,\\mathrm{d}x = \\int_0^{1/4} \\frac{1 - \\cos(2\\pi x)}{2} \\,\\mathrm{d}x\n    $$\n    $$\n    = \\frac{1}{2} \\left[ x - \\frac{\\sin(2\\pi x)}{2\\pi} \\right]_0^{1/4} = \\frac{1}{2} \\left[ \\left(\\frac{1}{4} - \\frac{\\sin(\\pi/2)}{2\\pi}\\right) - (0 - 0) \\right] = \\frac{1}{2} \\left( \\frac{1}{4} - \\frac{1}{2\\pi} \\right) = \\frac{1}{8} - \\frac{1}{4\\pi}\n    $$\n2.  $\\| f_h \\|_{L^{2}(K)}^2$:\n    由于 $f_h$ 在 $K$ 上是常数，此项即为 $f_h^2 \\cdot \\mathrm{meas}(K)$。\n    $$\n    \\| f_h \\|_{L^{2}(K)}^2 = \\left( \\frac{4 - 2\\sqrt{2}}{\\pi} \\right)^2 \\cdot \\frac{1}{4} = \\frac{16 - 16\\sqrt{2} + 4(2)}{4\\pi^2} = \\frac{24 - 16\\sqrt{2}}{4\\pi^2} = \\frac{6 - 4\\sqrt{2}}{\\pi^2}\n    $$\n现在，我们计算差值：\n$$\n\\| f - f_{h} \\|_{L^{2}(K)}^2 = \\left( \\frac{1}{8} - \\frac{1}{4\\pi} \\right) - \\frac{6 - 4\\sqrt{2}}{\\pi^2}\n$$\n为了将它们合并成一个分数，我们使用公分母 $8\\pi^2$:\n$$\n\\| f - f_{h} \\|_{L^{2}(K)}^2 = \\frac{\\pi^2 - 2\\pi}{8\\pi^2} - \\frac{8(6 - 4\\sqrt{2})}{8\\pi^2} = \\frac{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}{8\\pi^2}\n$$\n最后，我们计算振荡项 $\\mathrm{osc}_K$:\n$$\n\\mathrm{osc}_{K} = h_{K} \\left\\| f - f_{h} \\right\\|_{L^{2}(K)} = \\frac{1}{4} \\sqrt{\\frac{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}{8\\pi^2}}\n$$\n我们可以简化这个表达式：\n$$\n\\mathrm{osc}_{K} = \\frac{1}{4} \\frac{\\sqrt{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}}{\\sqrt{8}\\pi} = \\frac{\\sqrt{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}}{4 \\cdot 2\\sqrt{2} \\pi} = \\frac{\\sqrt{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}}{8\\sqrt{2}\\pi}\n$$\n这是单元 $K$ 上载荷数据振荡项的最终精确解析表达式。",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{\\pi^2 - 2\\pi - 48 + 32\\sqrt{2}}}{8\\sqrt{2}\\pi}}\n$$"
        },
        {
            "introduction": "后验误差估计的最终目标不仅是度量误差，更是通过指导网格自适应来控制误差。本练习通过要求您基于残差的局部衰减率来设计一个$hp$自适应策略，从而将理论与应用联系起来。通过观察残差如何随多项式阶次的增加而变化，您将学会设计一种能够自动选择最有效加密策略（$h$加密或$p$加密）的智能算法，这是现代计算工程的基石。",
            "id": "3595939",
            "problem": "考虑一个占据域 $[0,L]$ 的杆件的一维小应变线性弹性问题。该杆件的杨氏模量为 $E(x)$，横截面积为 $A(x)$，体力密度为 $b(x)$。在 $x=0$ 处有指定位移 $u=0$，在 $x=L$ 处有指定面力 $t(L)$。在无惯性项的情况下，线性动量平衡的强形式为\n$$\n-\\frac{d}{dx}\\big(E(x)A(x)\\frac{du}{dx}\\big)=b(x) \\quad \\text{for } x\\in(0,L),\n$$\n其面力边界条件为\n$$\nE(L)A(L)\\frac{du}{dx}(L)=t(L).\n$$\n设 $u_{h,p}$ 表示在尺寸为 $h$ 的网格上，$p$ 阶多项式空间中的有限元近似解；设 $u_{h,p+1}$ 表示在同一网格上，在给定单元上将多项式阶次增加1后的相应近似解。作用于检验函数 $v$ 的残差泛函 $R(u_{h,p})$ 可以通过将强形式逐单元分部积分写为\n$$\nR(u_{h,p};v)=\\sum_{K}\\int_{K}\\left(b(x)+\\frac{d}{dx}\\big(E(x)A(x)\\frac{du_{h,p}}{dx}\\big)\\right)v(x)\\,dx+\\sum_{e\\in\\mathcal{E}_h}\\int_{e}\\big(\\llbracket E(x)A(x)\\frac{du_{h,p}}{dx} \\rrbracket - t(x)\\big)v(x)\\,ds,\n$$\n其中 $\\mathcal{E}_h$ 表示单元面的集合，$\\llbracket \\cdot \\rrbracket$ 是内部面上的跳跃量，$t(x)$ 是在诺伊曼边界上施加的面力。一种基于残差的后验误差指示器利用该残差的范数来估计离散误差。对每个单元 $K$，定义一个残差范数的可计算代理 $\\|R_K(u_{h,p})\\|$（例如，体内平衡残差的 $L^2$-范数加上面跳跃项的贡献，并按局部网格尺寸进行缩放），对 $\\|R_K(u_{h,p+1})\\|$ 也作类似定义。\n\n从残差的定义以及弱形式中残差范数与能量误差之间的基本联系出发，推导一个决策准则。该准则利用多项式增阶下残差范数的局部衰减作为光滑度指示器。具体来说，请从第一性原理出发进行论证，说明为什么对于在单元 $K$ 上足够光滑的精确解，在多项式增阶下，比值\n$$\n\\rho_K=\\frac{\\|R_K(u_{h,p+1})\\|}{\\|R_K(u_{h,p})\\|}\n$$\n趋于远小于1；而对于正则性较低的解（例如，在 $K$ 上未被良好解析的奇异点或陡峭梯度），$\\rho_K$ 衰减缓慢并保持接近于1。利用这一点，构建一个鲁棒的 $hp$自适应决策策略，对每个单元 $K$ 有三种结果：\n- 当 $\\rho_K$ 表明衰减足够快时，选择 $p$加密（增加多项式阶次），\n- 当 $\\rho_K$ 表明衰减缓慢时，选择 $h$加密（细分网格），\n- 当单元已充分收敛，无需进一步加密时，选择不加密。\n\n你的算法必须仅使用作为输入的局部标量代理 $\\|R_K(u_{h,p})\\|$ 和 $\\|R_K(u_{h,p+1})\\|$ 来实现，而不能访问完整的场。为使决策定量化，你必须引入：\n- 一个衰减阈值参数 $\\theta_p\\in(0,1)$，它规定了指示足够光滑度的最小相对衰减，\n- 一个残差下限 $\\varepsilon_{\\min}>0$，使得如果 $\\|R_K(u_{h,p})\\|\\le \\varepsilon_{\\min}$，则认为该单元已收敛，不应再进行加密。\n\n你的任务是：\n1. 从弱形式和基于残差的误差估计原理出发，论证该决策规则的结构，不得使用任何预设最终规则的简化公式。\n2. 实现一个程序，该程序给定逐单元的残差范数对 $(\\|R_K(u_{h,p})\\|,\\|R_K(u_{h,p+1})\\|)$ 以及 $\\theta_p$ 和 $\\varepsilon_{\\min}$，输出一个以整数编码的逐单元决策：输出 $1$ 表示 $p$加密， $0$ 表示 $h$加密， $2$ 表示不加密。\n\n使用以下测试套件，该套件旨在探测光滑度检测、奇异行为、接近收敛以及边界情况：\n- 测试用例1（两个单元，类似光滑解的衰减）：$\\theta_p=0.6$, $\\varepsilon_{\\min}=10^{-7}$, $\\|R_K(u_{h,p})\\|=[10^{-1},2\\cdot 10^{-1}]$, $\\|R_K(u_{h,p+1})\\|=[2\\cdot 10^{-2},5\\cdot 10^{-2}]$。\n- 测试用例2（两个单元，衰减缓慢，表明非光滑）：$\\theta_p=0.6$, $\\varepsilon_{\\min}=10^{-7}$, $\\|R_K(u_{h,p})\\|=[1,5\\cdot 10^{-1}]$, $\\|R_K(u_{h,p+1})\\|=[9\\cdot 10^{-1},4.5\\cdot 10^{-1}]$。\n- 测试用例3（两个单元，接近收敛）：$\\theta_p=0.6$, $\\varepsilon_{\\min}=10^{-7}$, $\\|R_K(u_{h,p})\\|=[10^{-8},5\\cdot 10^{-9}]$, $\\|R_K(u_{h,p+1})\\|=[10^{-9},2\\cdot 10^{-9}]$。\n- 测试用例4（三个单元，包括零残差和混合行为）：$\\theta_p=0.6$, $\\varepsilon_{\\min}=10^{-6}$, $\\|R_K(u_{h,p})\\|=[0,10^{-4},10^{-2}]$, $\\|R_K(u_{h,p+1})\\|=[0,5\\cdot 10^{-5},9\\cdot 10^{-3}]$。\n\n对每个测试用例，按顺序计算每个单元的决策，并将从测试用例1到测试用例4的所有决策连接成一个单一列表。最终的程序输出必须是包含此连接列表的单行整数，以逗号分隔，不含空格，并用方括号括起来（例如，$[\\dots]$）。输出中没有物理单位；输出是按规定格式的一列整数。",
            "solution": "任务是基于残差范数代理的局部衰减，为 $hp$自适应有限元分析推导并实现一个决策算法。对每个单元 $K$ 的决策可以是h加密（细分）、p加密（多项式增阶）或不加密。该决策基于所提供的局部残差范数代理 $\\|R_K(u_{h,p})\\|$ 和 $\\|R_K(u_{h,p+1})\\|$，以及两个参数：衰减阈值 $\\theta_p$ 和残差下限 $\\varepsilon_{\\min}$。\n\n推导过程遵循有限元法（FEM）和后验误差估计的基本原理。\n\n**1. 残差在误差估计中的作用**\n\n出发点是控制该一维弹性问题的弱形式。精确解 $u$ 满足变分方程：\n$$\na(u,v) = L(v) \\quad \\forall v \\in V\n$$\n其中 $V$ 是一个合适的无限维检验函数空间，$a(\\cdot, \\cdot)$ 是代表内虚功的能量双线性形式，$L(\\cdot)$ 是代表外虚功的线性泛函。对于此问题，\n$$\na(w,z) = \\int_{0}^{L} E(x)A(x)\\frac{dw}{dx}\\frac{dz}{dx}\\,dx\n$$\n且\n$$\nL(v) = \\int_{0}^{L} b(x)v(x)\\,dx + t(L)v(L)\n$$\n有限元近似解 $u_{h,p}$ 在一个有限维子空间 $V_{h,p} \\subset V$ 中求解，并由伽辽金方程定义：\n$$\na(u_{h,p}, v_h) = L(v_h) \\quad \\forall v_h \\in V_{h,p}\n$$\n离散误差定义为 $e = u - u_{h,p}$。从精确弱形式（其中 $v=v_h$）中减去伽辽金方程，我们得到伽辽金正交性：\n$$\na(e, v_h) = a(u-u_{h,p}, v_h) = 0 \\quad \\forall v_h \\in V_{h,p}\n$$\n现在，考虑用任意函数 $v \\in V$ 来检验误差 $e$。我们有：\n$$\na(e,v) = a(u,v) - a(u_{h,p}, v) = L(v) - a(u_{h,p}, v)\n$$\n右端项 $L(v) - a(u_{h,p}, v)$ 定义了残差泛函 $R(u_{h,p};v)$ 在检验函数 $v$ 上的作用。在每个单元 $K$ 上对 $a(u_{h,p}, v)$ 进行分部积分，可以恢复问题描述中给出的残差表达式。这就得到了精确的误差方程：\n$$\na(e,v) = R(u_{h,p};v) \\quad \\forall v \\in V\n$$\n这个基本方程确立了误差 $e$ 是由残差 $R(u_{h,p})$ 驱动的。后验误差分析中的一个关键结果是，误差的能量范数 $\\|e\\|_{E} = \\sqrt{a(e,e)}$ 与残差泛函的某个适当范数是等价的。这种等价性允许我们使用残差的可计算范数作为真实误差的估计（一个指示器）。问题中提供了 $\\|R_K(u_{h,p})\\|$ 作为在每个单元 $K$ 上该范数的一个可计算的局部代理。全局误差则通过对局部贡献求和来估计：$\\|e\\|_{E}^2 \\approx \\sum_{K} \\|R_K(u_{h,p})\\|^2$。\n\n**2. 误差收敛性与解的正则性**\n\n$hp$自适应的核心思想是选择局部最高效的加密类型（$h$ 或 $p$）。这个选择取决于精确解 $u$ 的局部正则性（光滑度）。\n\n-   **光滑解（高正则性）：** 如果精确解 $u$ 在一个单元 $K$ 上是解析的（无限可微），那么增加近似解的多项式阶次 $p$ 会导致误差的指数收敛。单元 $K$ 上的能量范数误差表现为：\n    $$\n    \\|e\\|_{E,K} \\sim \\exp(-\\gamma p)\n    $$\n    其中某个常数 $\\gamma > 0$ 取决于 $u$ 的解析性质。这被称为谱收敛，速度极快。因此，作为误差估计的残差范数代理 $\\|R_K(u_{h,p})\\|$ 预计会随 $p$ 指数衰减。\n\n-   **非光滑解（低正则性）：** 如果解 $u$ 在单元 $K$ 上存在奇异性（例如，由于尖角、材料属性的突变或点载荷，尽管这些没有明确出现在这个一维问题中，但它们是通用动机），其正则性就很低。对于这类解，$p$加密只能产生缓慢且会饱和的代数收敛率。更有效的策略是 $h$加密，它通过细分单元来隔离奇异点。这使得在新生成的更小单元上，解的光滑部分可以用多项式有效逼近，从而恢复相对于网格尺寸 $h$ 的最优代数收敛率。\n\n**3. 决策准则**\n\n局部衰减比 $\\rho_K$ 就是为探测量这种收敛行为而设计的。\n$$\n\\rho_K = \\frac{\\|R_K(u_{h,p+1})\\|}{\\|R_K(u_{h,p})\\|}\n$$\n这个比值量化了将多项式阶次从 $p$ 增加到 $p+1$ 时，局部残差（也即误差）减小了多少。\n\n-   如果解是局部光滑的，我们期望指数收敛。连续残差的比值将近似为一个远小于1的常数：\n    $$\n    \\rho_K \\approx \\frac{C \\exp(-\\gamma(p+1))}{C \\exp(-\\gamma p)} = \\exp(-\\gamma) \\ll 1\n    $$\n    较小的 $\\rho_K$ 值表明 $p$加密非常有效。\n\n-   如果解是局部非光滑的，$p$加密效率低下。残差将缓慢衰减，比值 $\\rho_K$ 会接近1。较大的 $\\rho_K$ 值表明 $p$加密不是最优选择，通过排除法，应首选 $h$加密。\n\n这一推理直接导出了决策算法的结构。\n\n**算法：**\n对每个单元 $K$ 的决策采用两步分层逻辑。\n\n**步骤1：检查收敛性**\n自适应算法必须有一个停止准则，以避免对误差已经足够小的单元进行加密。残差下限 $\\varepsilon_{\\min}$ 正是用于此目的。第一步检查总是：\n-   如果 $\\|R_K(u_{h,p})\\| \\le \\varepsilon_{\\min}$，则该单元对总误差的贡献可以忽略不计，无需进一步加密。\n    -   决策：**不加密**（编码为2）。\n\n**步骤2：选择加密类型**\n如果单元尚未收敛（即 $\\|R_K(u_{h,p})\\| > \\varepsilon_{\\min}$），我们必须在 h加密和 p加密之间做出选择。此时便要使用光滑度指示器 $\\rho_K$ 和衰减阈值 $\\theta_p$。\n-   我们计算比值 $\\rho_K$。注意，由于 $\\|R_K(u_{h,p})\\| > \\varepsilon_{\\min}$ 且题目给出 $\\varepsilon_{\\min} > 0$，因此可以保证分母 $\\|R_K(u_{h,p})\\|$ 不为零。\n-   我们将 $\\rho_K$ 与阈值 $\\theta_p \\in (0,1)$ 进行比较：\n    -   如果 $\\rho_K  \\theta_p$：观测到的衰减“快”，表明解是局部光滑的，并能从多项式增阶中受益。\n        -   决策：**p加密**（编码为1）。\n    -   如果 $\\rho_K \\ge \\theta_p$：观测到的衰减“慢”，表明正则性低，$p$加密效率不高。\n        -   决策：**h加密**（编码为0）。\n\n这个逻辑顺序——首先检查收敛性，然后对未收敛的单元评估光滑度——为 $hp$自适应加密提供了一个鲁棒且有物理动机的策略。对于 $\\|R_K(u_{h,p})\\|=0$ 的特殊情况，第一步能正确处理，因为对于任何 $\\varepsilon_{\\min}0$ 都有 $0 \\le \\varepsilon_{\\min}$，从而导致“不加密”的决策，这对于初始残差为零的单元是合适的。```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements an hp-adaptive decision policy for finite element analysis.\n\n    The function processes a series of test cases, each containing element-wise\n    residual norm proxies for polynomial degrees p and p+1. Based on a decay\n    threshold (theta_p) and a residual floor (eps_min), it decides for each\n    element whether to perform p-refinement, h-refinement, or no refinement.\n\n    Decision Logic:\n    - 2 (No Refinement): If the initial residual norm ||R_K(u_h,p)|| is below eps_min.\n    - 1 (p-refinement): If not converged and the decay ratio rho_K is less than theta_p.\n    - 0 (h-refinement): If not converged and the decay ratio rho_K is not less than theta_p.\n\n    The decay ratio is rho_K = ||R_K(u_h,p+1)|| / ||R_K(u_h,p)||.\n    \"\"\"\n    test_cases = [\n        {\n            \"theta_p\": 0.6,\n            \"eps_min\": 1e-7,\n            \"R_p\": [1e-1, 2e-1],\n            \"R_p1\": [2e-2, 5e-2]\n        },\n        {\n            \"theta_p\": 0.6,\n            \"eps_min\": 1e-7,\n            \"R_p\": [1.0, 5e-1],\n            \"R_p1\": [9e-1, 4.5e-1]\n        },\n        {\n            \"theta_p\": 0.6,\n            \"eps_min\": 1e-7,\n            \"R_p\": [1e-8, 5e-9],\n            \"R_p1\": [1e-9, 2e-9]\n        },\n        {\n            \"theta_p\": 0.6,\n            \"eps_min\": 1e-6,\n            \"R_p\": [0.0, 1e-4, 1e-2],\n            \"R_p1\": [0.0, 5e-5, 9e-3]\n        }\n    ]\n\n    all_decisions = []\n    for case in test_cases:\n        theta_p = case[\"theta_p\"]\n        eps_min = case[\"eps_min\"]\n        R_p_list = case[\"R_p\"]\n        R_p1_list = case[\"R_p1\"]\n\n        for R_p, R_p1 in zip(R_p_list, R_p1_list):\n            # Step 1: Check for convergence.\n            if R_p = eps_min:\n                decision = 2  # No refinement\n            else:\n                # Step 2: Decide between h- and p-refinement.\n                # Since R_p > eps_min > 0, R_p is guaranteed to be non-zero.\n                rho_K = R_p1 / R_p\n                \n                if rho_K  theta_p:\n                    decision = 1  # p-refinement (fast decay)\n                else:\n                    decision = 0  # h-refinement (slow decay)\n            \n            all_decisions.append(decision)\n\n    # The final output must be a single string representing the list of integers.\n    print(f\"[{','.join(map(str, all_decisions))}]\")\n\nsolve()\n```",
            "answer": "[1,1,0,0,2,2,2,1,0]"
        }
    ]
}