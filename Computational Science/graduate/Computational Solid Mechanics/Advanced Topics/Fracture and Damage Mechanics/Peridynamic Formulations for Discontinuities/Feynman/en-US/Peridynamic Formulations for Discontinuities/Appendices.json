{
    "hands_on_practices": [
        {
            "introduction": "The majority of peridynamic simulations employ explicit time integration schemes due to their computational efficiency, but this choice comes with a critical constraint on numerical stability. The size of the simulation time step, $\\Delta t$, is limited by the highest frequency of the discretized system, which is analogous to the Courant-Friedrichs-Lewy (CFL) condition. This exercise guides you through a foundational analysis to derive the maximum stable timestep for a one-dimensional peridynamic bar, connecting material properties and discretization parameters directly to the stability of your simulation .",
            "id": "3587117",
            "problem": "Consider a one-dimensional ($1\\mathrm{D}$) bond-based peridynamic solid discretized on a uniform periodic lattice with node spacing $h$, mass density $\\rho$, cross-sectional area $A$, and lumped mass $m = \\rho A h$ per node. The peridynamic horizon $\\delta$ is assumed to span $N_b$ neighbor layers on each side, with $\\delta = N_b h$, where $N_b$ is a positive odd integer. Within the horizon, each bond exerts a linear pairwise force with a constant micromodulus $c$, and the spatial integral of the peridynamic internal force is approximated by a uniform quadrature with weight $h$ for each bonded neighbor. The resulting semi-discrete equation of motion at node $i$ can be written as\n$$\nm\\,\\ddot{u}_i(t) + \\sum_{s=1}^{N_b} c h \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0,\n$$\nwhere $u_i(t)$ is the displacement at node $i$, and periodic boundary conditions ensure that indices wrap around the lattice.\n\nYou are to analyze the explicit central-difference (CD) time integration scheme applied to the mass-normalized system and determine the stability constraint in terms of the largest eigenvalue of the mass-normalized stiffness operator. Then, for the described uniform $1\\mathrm{D}$ discretization, compute the largest eigenvalue $\\lambda_{\\max}$ of the mass-normalized stiffness operator by performing a modal (Fourier) analysis on the periodic lattice and identify the wavenumber that maximizes the eigenvalue.\n\nUsing these results, provide a single closed-form analytic expression for the maximum admissible timestep $\\Delta t_{\\max}$ of the explicit CD scheme in terms of $\\rho$, $A$, $c$, and $N_b$, assuming $N_b$ is odd. Express the maximum admissible timestep in seconds. The final answer must be a single closed-form expression.",
            "solution": "The problem requires the derivation of the maximum stable timestep, $\\Delta t_{\\max}$, for the explicit central-difference (CD) time integration scheme applied to a one-dimensional bond-based peridynamic model. The derivation proceeds in several steps: first, analyzing the stability of the CD scheme in relation to the system's eigenvalues; second, calculating these eigenvalues via a modal analysis of the provided equation of motion; third, determining the maximum eigenvalue; and finally, substituting this maximum eigenvalue into the stability criterion to find $\\Delta t_{\\max}$.\n\nThe semi-discrete equation of motion at node $i$ is given as:\n$$\nm\\,\\ddot{u}_i(t) + \\sum_{s=1}^{N_b} c h \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0\n$$\nwhere $m = \\rho A h$ is the lumped mass at each node, $\\rho$ is the mass density, $A$ is the cross-sectional area, $h$ is the node spacing, $c$ is the constant micromodulus, and $N_b$ is the number of neighbor layers in the horizon on each side.\n\nFirst, we formulate the mass-normalized equation of motion. Dividing the given equation by the mass $m$:\n$$\n\\ddot{u}_i(t) + \\frac{ch}{m} \\sum_{s=1}^{N_b} \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0\n$$\nSubstituting the expression for the mass, $m = \\rho A h$:\n$$\n\\ddot{u}_i(t) + \\frac{ch}{\\rho A h} \\sum_{s=1}^{N_b} \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0\n$$\nThe node spacing $h$ cancels out, yielding:\n$$\n\\ddot{u}_i(t) + \\frac{c}{\\rho A} \\sum_{s=1}^{N_b} \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0\n$$\nThis system of coupled ordinary differential equations can be written in matrix form as $\\ddot{\\mathbf{u}}(t) + \\mathbf{K}_m \\mathbf{u}(t) = \\mathbf{0}$, where $\\mathbf{K}_m$ is the mass-normalized stiffness matrix.\n\nThe stability of the explicit central-difference scheme for a system of the form $\\ddot{\\mathbf{u}} + \\mathbf{K}_m \\mathbf{u} = \\mathbf{0}$ is governed by the Courant-Friedrichs-Lewy (CFL) condition, which requires the timestep $\\Delta t$ to satisfy:\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}} = \\frac{2}{\\sqrt{\\lambda_{\\max}}}\n$$\nwhere $\\omega_{\\max}$ is the highest natural frequency of the discrete system, and $\\lambda_{\\max} = \\omega_{\\max}^2$ is the largest eigenvalue of the mass-normalized stiffness matrix $\\mathbf{K}_m$.\n\nTo find the eigenvalues of $\\mathbf{K}_m$, we perform a modal (Fourier) analysis. We assume a traveling wave solution (a Fourier mode) for the displacement on the periodic lattice:\n$$\nu_j(t) = \\tilde{u}(k) \\exp(i(kjh - \\omega t))\n$$\nwhere $j$ is the node index, $k$ is the wavenumber, and $\\omega$ is the angular frequency. The second time derivative is $\\ddot{u}_j(t) = -\\omega^2 u_j(t)$. Substituting this into the mass-normalized equation of motion:\n$$\n-\\omega^2 u_i(t) + \\frac{c}{\\rho A} \\sum_{s=1}^{N_b} \\left( 2 u_i(t) - u_{i+s}(t) - u_{i-s}(t) \\right) = 0\n$$\nSubstituting the modal form and canceling the common factor $\\tilde{u}(k)\\exp(i(kih - \\omega t))$:\n$$\n-\\omega^2 + \\frac{c}{\\rho A} \\sum_{s=1}^{N_b} \\left( 2 - e^{iksh} - e^{-iksh} \\right) = 0\n$$\nThe eigenvalues $\\lambda(k)$ of $\\mathbf{K}_m$ are the values of $\\omega^2(k)$, which gives the dispersion relation:\n$$\n\\lambda(k) = \\omega^2(k) = \\frac{c}{\\rho A} \\sum_{s=1}^{N_b} \\left( 2 - (e^{iksh} + e^{-iksh}) \\right)\n$$\nUsing the identity $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$, this becomes:\n$$\n\\lambda(k) = \\frac{2c}{\\rho A} \\sum_{s=1}^{N_b} \\left( 1 - \\cos(ksh) \\right)\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\n\\lambda(k) = \\frac{4c}{\\rho A} \\sum_{s=1}^{N_b} \\sin^2\\left(\\frac{ksh}{2}\\right)\n$$\nTo find the maximum eigenvalue $\\lambda_{\\max}$, we must find the wavenumber $k$ that maximizes $\\lambda(k)$. For a discrete lattice, the unique wavenumbers lie in the first Brillouin zone, $k \\in [-\\pi/h, \\pi/h]$. The function $\\lambda(k)$ is maximized at the boundary of the Brillouin zone, specifically at $k = \\pi/h$. This corresponds to the highest frequency mode where adjacent nodes move in opposite directions, maximizing the stretch in the bonds.\n\nWe evaluate $\\lambda(k)$ at $k = \\pi/h$:\n$$\n\\lambda_{\\max} = \\lambda(\\pi/h) = \\frac{4c}{\\rho A} \\sum_{s=1}^{N_b} \\sin^2\\left(\\frac{(\\pi/h)sh}{2}\\right) = \\frac{4c}{\\rho A} \\sum_{s=1}^{N_b} \\sin^2\\left(\\frac{s\\pi}{2}\\right)\n$$\nThe term $\\sin^2(s\\pi/2)$ evaluates to $1$ if $s$ is an odd integer and $0$ if $s$ is an even integer. The problem states that $N_b$ is a positive odd integer. The sum is over $s \\in \\{1, 2, \\dots, N_b\\}$. The number of odd integers in this range is $\\frac{N_b+1}{2}$. Therefore, the sum is:\n$$\n\\sum_{s=1}^{N_b} \\sin^2\\left(\\frac{s\\pi}{2}\\right) = 1 \\times (\\text{number of odd } s) + 0 \\times (\\text{number of even } s) = \\frac{N_b+1}{2}\n$$\nSubstituting this result back into the expression for $\\lambda_{\\max}$:\n$$\n\\lambda_{\\max} = \\frac{4c}{\\rho A} \\left( \\frac{N_b+1}{2} \\right) = \\frac{2c(N_b+1)}{\\rho A}\n$$\nFinally, we substitute this maximum eigenvalue into the stability criterion to find the maximum admissible timestep, $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\sqrt{\\lambda_{\\max}}} = \\frac{2}{\\sqrt{\\frac{2c(N_b+1)}{\\rho A}}}\n$$\nSimplifying the expression:\n$$\n\\Delta t_{\\max} = 2 \\sqrt{\\frac{\\rho A}{2c(N_b+1)}} = \\sqrt{\\frac{4\\rho A}{2c(N_b+1)}} = \\sqrt{\\frac{2\\rho A}{c(N_b+1)}}\n$$\nThis closed-form expression gives the maximum stable timestep in terms of the specified parameters $\\rho$, $A$, $c$, and $N_b$. A dimensional analysis confirms the result has units of time (seconds).",
            "answer": "$$\\boxed{\\sqrt{\\frac{2\\rho A}{c(N_b+1)}}}$$"
        },
        {
            "introduction": "A key challenge in peridynamics is the proper treatment of boundaries and internal discontinuities, where material points have truncated interaction neighborhoods. This leads to a well-known artifact called the \"surface effect,\" a spurious reduction in stiffness that can compromise the accuracy of predictions near cracks or surfaces. Through this analytical exercise, you will quantify this stiffness reduction for a half-space and derive a correction factor, providing a fundamental understanding of how to mitigate boundary effects in peridynamic models .",
            "id": "3587105",
            "problem": "Consider a three-dimensional half-space occupying the region $x \\geq 0$ composed of a bond-based peridynamic material described by the Prototype Microelastic Brittle (PMB) model. The material has a constant micro-modulus $c$ and a constant influence function $\\omega(|\\boldsymbol{\\xi}|) = 1$, with a spherical interaction horizon of radius $\\delta$. Let $\\boldsymbol{x}$ denote a material point at depth $x$ from the free surface $x=0$, and let $\\boldsymbol{\\xi} = \\boldsymbol{x}' - \\boldsymbol{x}$ denote the bond vector to a neighbor $\\boldsymbol{x}'$.\n\nAssume a small uniform uniaxial strain field with engineering strain $\\varepsilon$ applied along the $x$ direction, so that the classical small-strain tensor is $\\boldsymbol{\\varepsilon} = \\mathrm{diag}(\\varepsilon, 0, 0)$. In the PMB model, the pairwise bond stretch under small strain is $s(\\boldsymbol{\\xi}) \\approx \\boldsymbol{n} \\cdot \\boldsymbol{\\varepsilon} \\, \\boldsymbol{n}$, where $\\boldsymbol{n} = \\boldsymbol{\\xi}/|\\boldsymbol{\\xi}|$ is the bond orientation, and the peridynamic strain energy density at $\\boldsymbol{x}$ is\n$$\nW_{\\mathrm{pd}}(\\boldsymbol{x}) = \\frac{1}{2} \\, c \\int_{H(\\boldsymbol{x})} s(\\boldsymbol{\\xi})^{2} \\, \\omega(|\\boldsymbol{\\xi}|) \\, \\mathrm{d}V',\n$$\nwith $H(\\boldsymbol{x}) = \\{ \\boldsymbol{\\xi} \\in \\mathbb{R}^{3}: |\\boldsymbol{\\xi}| \\leq \\delta, \\, x + \\xi_{x} \\geq 0 \\}$ the horizon truncated by the free surface.\n\nDefine the spurious stiffness reduction factor $R(\\alpha)$ at depth $x$ as the ratio of the peridynamic energy density at $\\boldsymbol{x}$ to the bulk peridynamic energy density for an interior point far from boundaries, with $\\alpha = x/\\delta \\in [0,1]$. The bulk energy density corresponds to $H(\\boldsymbol{x}) = \\{ \\boldsymbol{\\xi}: |\\boldsymbol{\\xi}| \\leq \\delta \\}$ (no truncation).\n\nStarting from the definitions given above, derive a closed-form analytic expression for $R(\\alpha)$ for $0 \\leq \\alpha \\leq 1$ under the stated uniform uniaxial strain. Then, assume the micro-modulus $c$ has been calibrated so that the peridynamic bulk energy density equals the classical continuum energy density with target modulus $E_{0}$, that is, $W_{\\mathrm{pd,bulk}} = \\frac{1}{2} E_{0} \\varepsilon^{2}$. Determine a multiplicative correction factor $\\beta(\\alpha)$ applied to the micro-modulus within the boundary layer $0 \\leq x \\leq \\delta$ such that the corrected peridynamic energy density at each depth matches the target continuum energy density to within a tolerance of $t = 10^{-3}$.\n\nExpress your final answer as dimensionless functions of $\\alpha$, with no units. No numerical rounding is required; provide exact analytic expressions.",
            "solution": "The problem requires the derivation of two quantities related to the surface effect in a bond-based peridynamic half-space: the stiffness reduction factor $R(\\alpha)$ and a corresponding correction factor $\\beta(\\alpha)$. The solution proceeds in two main parts.\n\nFirst, we derive the spurious stiffness reduction factor $R(\\alpha)$. By definition, this factor is the ratio of the peridynamic strain energy density at a depth $x$ from the free surface, $W_{\\mathrm{pd}}(x)$, to the strain energy density in the bulk material, $W_{\\mathrm{pd,bulk}}$. The depth is parameterized by the dimensionless quantity $\\alpha = x/\\delta$, where $\\delta$ is the peridynamic horizon radius.\n\n$R(\\alpha) = \\frac{W_{\\mathrm{pd}}(x)}{W_{\\mathrm{pd,bulk}}}$\n\nThe peridynamic strain energy density is given by:\n$$W_{\\mathrm{pd}}(\\boldsymbol{x}) = \\frac{1}{2} \\, c \\int_{H(\\boldsymbol{x})} s(\\boldsymbol{\\xi})^{2} \\, \\omega(|\\boldsymbol{\\xi}|) \\, \\mathrm{d}V'$$\nThe influence function is $\\omega(|\\boldsymbol{\\xi}|) = 1$. The bond stretch $s(\\boldsymbol{\\xi})$ for a small uniaxial strain $\\varepsilon$ in the $x$-direction is $s(\\boldsymbol{\\xi}) \\approx \\boldsymbol{n} \\cdot \\boldsymbol{\\varepsilon} \\, \\boldsymbol{n}$. Let $\\boldsymbol{\\xi} = (\\xi_x, \\xi_y, \\xi_z)$ and $|\\boldsymbol{\\xi}| = \\rho$. The unit vector along the bond is $\\boldsymbol{n} = \\boldsymbol{\\xi}/\\rho$. The classical strain tensor is $\\boldsymbol{\\varepsilon} = \\mathrm{diag}(\\varepsilon, 0, 0)$.\nThe bond stretch is calculated as:\n$s(\\boldsymbol{\\xi}) = \\frac{\\boldsymbol{\\xi}}{\\rho} \\cdot \\begin{pmatrix} \\varepsilon & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} \\frac{\\boldsymbol{\\xi}}{\\rho} = \\frac{1}{\\rho^2} (\\xi_x, \\xi_y, \\xi_z) \\begin{pmatrix} \\varepsilon \\xi_x \\\\ 0 \\\\ 0 \\end{pmatrix} = \\varepsilon \\frac{\\xi_x^2}{\\rho^2}$.\nThe term to be integrated is $s(\\boldsymbol{\\xi})^2 = \\varepsilon^2 \\frac{\\xi_x^4}{\\rho^4}$.\n\nTo perform the volume integral, we use spherical coordinates for the bond vector $\\boldsymbol{\\xi}$, centered at the material point $\\boldsymbol{x}$. We align the polar axis with the $x$-direction for convenience. Let $\\xi_x = \\rho \\cos\\phi$, $\\xi_y = \\rho \\sin\\phi \\cos\\theta$, $\\xi_z = \\rho \\sin\\phi \\sin\\theta$, where $\\rho = |\\boldsymbol{\\xi}|$ is the radial distance, $\\phi \\in [0, \\pi]$ is the polar angle from the positive $x$-axis, and $\\theta \\in [0, 2\\pi]$ is the azimuthal angle. The volume element is $\\mathrm{d}V' = \\rho^2 \\sin\\phi \\, \\mathrm{d}\\rho \\, \\mathrm{d}\\phi \\, \\mathrm{d}\\theta$.\nIn these coordinates, $s(\\boldsymbol{\\xi})^2 = \\varepsilon^2 (\\frac{\\rho \\cos\\phi}{\\rho})^2 = \\varepsilon^2 \\cos^4\\phi$.\n\nNext, we calculate the bulk energy density, $W_{\\mathrm{pd,bulk}}$. For a point far from any boundary, the horizon of interaction $H(\\boldsymbol{x})$ is a full sphere of radius $\\delta$, denoted $B(\\delta)$.\n$W_{\\mathrm{pd,bulk}} = \\frac{1}{2} c \\varepsilon^2 \\int_{B(\\delta)} \\cos^4\\phi \\, \\mathrm{d}V' = \\frac{1}{2} c \\varepsilon^2 \\int_0^{2\\pi} \\mathrm{d}\\theta \\int_0^\\pi \\mathrm{d}\\phi \\int_0^\\delta \\mathrm{d}\\rho \\, (\\cos^4\\phi)(\\rho^2\\sin\\phi)$.\nThe integral separates:\n$\\int_0^{2\\pi} \\mathrm{d}\\theta = 2\\pi$.\n$\\int_0^\\delta \\rho^2 \\, \\mathrm{d}\\rho = \\frac{\\delta^3}{3}$.\n$\\int_0^\\pi \\cos^4\\phi \\sin\\phi \\, \\mathrm{d}\\phi$. Let $u = \\cos\\phi$, $\\mathrm{d}u = -\\sin\\phi \\, \\mathrm{d}\\phi$. The limits change from $[0, \\pi]$ to $[1, -1]$.\n$\\int_1^{-1} u^4 (-\\mathrm{d}u) = \\int_{-1}^1 u^4 \\, \\mathrm{d}u = \\left[\\frac{u^5}{5}\\right]_{-1}^1 = \\frac{1}{5} - \\frac{-1}{5} = \\frac{2}{5}$.\nCombining these results, the total integral is $(2\\pi) (\\frac{\\delta^3}{3}) (\\frac{2}{5}) = \\frac{4\\pi\\delta^3}{15}$.\nThus, $W_{\\mathrm{pd,bulk}} = \\frac{1}{2} c \\varepsilon^2 \\left(\\frac{4\\pi\\delta^3}{15}\\right) = \\frac{2\\pi c \\delta^3 \\varepsilon^2}{15}$.\n\nNow, we calculate the energy density $W_{\\mathrm{pd}}(x)$ for a point at depth $x$ where $0 \\le x \\le \\delta$. The integration domain is the truncated horizon $H(\\boldsymbol{x}) = \\{ \\boldsymbol{\\xi} \\in \\mathbb{R}^{3}: |\\boldsymbol{\\xi}| \\leq \\delta, \\, x + \\xi_{x} \\geq 0 \\}$.\nThe constraint in our spherical coordinates is $x + \\rho\\cos\\phi \\ge 0$, or $\\rho\\cos\\phi \\ge -x$. Using $\\alpha=x/\\delta$, this becomes $\\rho\\cos\\phi \\ge -\\alpha\\delta$.\nThe integral for $W_{\\mathrm{pd}}(x)$ is:\n$W_{\\mathrm{pd}}(x) = \\frac{1}{2} c \\varepsilon^2 \\int_0^{2\\pi} \\mathrm{d}\\theta \\int_0^\\pi \\mathrm{d}\\phi \\int_0^{\\rho_{max}(\\phi)} \\mathrm{d}\\rho \\, (\\cos^4\\phi)(\\rho^2\\sin\\phi)$,\nwhere $\\rho_{max}(\\phi)$ is determined by the constraints $\\rho \\le \\delta$ and $\\rho\\cos\\phi \\ge -\\alpha\\delta$.\nFor $\\phi \\in [0, \\pi/2]$, $\\cos\\phi \\ge 0$, so $\\rho\\cos\\phi \\ge 0 \\ge -\\alpha\\delta$. The condition is always satisfied, thus $\\rho_{max}(\\phi)=\\delta$.\nFor $\\phi \\in (\\pi/2, \\pi]$, $\\cos\\phi < 0$. The condition is $\\rho \\le -\\alpha\\delta/\\cos\\phi$. So $\\rho_{max}(\\phi) = \\min(\\delta, -\\alpha\\delta/\\cos\\phi)$.\nThe boundary between these two cases for $\\rho_{max}$ occurs when $\\delta = -\\alpha\\delta/\\cos\\phi$, which gives $\\cos\\phi = -\\alpha$. Let $\\phi_c = \\arccos(-\\alpha)$, where $\\phi_c \\in [\\pi/2, \\pi]$ for $\\alpha \\in [0, 1]$.\n- For $\\phi \\in [0, \\phi_c]$, we have $\\cos\\phi \\ge -\\alpha$, so $-\\alpha/\\cos\\phi \\ge 1$ (since $\\cos\\phi<0$ for $\\phi \\in (\\pi/2,\\phi_c)$), which implies $-\\alpha\\delta/\\cos\\phi \\ge \\delta$. So $\\rho_{max}(\\phi)=\\delta$.\n- For $\\phi \\in (\\phi_c, \\pi]$, we have $\\cos\\phi < -\\alpha$, so $-\\alpha/\\cos\\phi < 1$, which implies $-\\alpha\\delta/\\cos\\phi < \\delta$. So $\\rho_{max}(\\phi) = -\\alpha\\delta/\\cos\\phi$.\n\nThe volume integral splits into two parts:\n$I(x) = \\int_0^{2\\pi} \\mathrm{d}\\theta \\left[ \\int_0^{\\phi_c} \\cos^4\\phi \\sin\\phi \\left(\\int_0^\\delta \\rho^2 \\mathrm{d}\\rho\\right) \\mathrm{d}\\phi + \\int_{\\phi_c}^\\pi \\cos^4\\phi \\sin\\phi \\left(\\int_0^{-\\alpha\\delta/\\cos\\phi} \\rho^2 \\mathrm{d}\\rho\\right) \\mathrm{d}\\phi \\right]$\n$I(x) = 2\\pi \\left[ \\frac{\\delta^3}{3} \\int_0^{\\phi_c} \\cos^4\\phi \\sin\\phi \\, \\mathrm{d}\\phi + \\int_{\\phi_c}^\\pi \\cos^4\\phi \\sin\\phi \\left(\\frac{1}{3} \\frac{(-\\alpha\\delta)^3}{\\cos^3\\phi}\\right) \\mathrm{d}\\phi \\right]$\n$I(x) = \\frac{2\\pi\\delta^3}{3} \\left[ \\int_0^{\\phi_c} \\cos^4\\phi \\sin\\phi \\, \\mathrm{d}\\phi - \\alpha^3 \\int_{\\phi_c}^\\pi \\cos\\phi \\sin\\phi \\, \\mathrm{d}\\phi \\right]$\nEvaluating the integrals:\n$\\int_0^{\\phi_c} \\cos^4\\phi \\sin\\phi \\, \\mathrm{d}\\phi = \\left[-\\frac{\\cos^5\\phi}{5}\\right]_0^{\\phi_c} = -\\frac{\\cos^5\\phi_c}{5} + \\frac{1}{5} = \\frac{1-(-\\alpha)^5}{5} = \\frac{1+\\alpha^5}{5}$.\n$\\int_{\\phi_c}^\\pi \\cos\\phi \\sin\\phi \\, \\mathrm{d}\\phi = \\left[\\frac{\\sin^2\\phi}{2}\\right]_{\\phi_c}^\\pi = \\frac{\\sin^2\\pi - \\sin^2\\phi_c}{2} = -\\frac{\\sin^2\\phi_c}{2}$.\nSince $\\sin^2\\phi_c = 1 - \\cos^2\\phi_c = 1 - (-\\alpha)^2 = 1-\\alpha^2$, this integral is $-\\frac{1-\\alpha^2}{2} = \\frac{\\alpha^2-1}{2}$.\nSubstituting back into the expression for $I(x)$:\n$I(x) = \\frac{2\\pi\\delta^3}{3} \\left[ \\frac{1+\\alpha^5}{5} - \\alpha^3\\left(\\frac{\\alpha^2-1}{2}\\right) \\right] = \\frac{2\\pi\\delta^3}{3} \\left[ \\frac{2(1+\\alpha^5) - 5\\alpha^3(\\alpha^2-1)}{10} \\right] = \\frac{2\\pi\\delta^3}{30} [2+2\\alpha^5 - 5\\alpha^5 + 5\\alpha^3] = \\frac{\\pi\\delta^3}{15} (2+5\\alpha^3-3\\alpha^5)$.\nThen $W_{\\mathrm{pd}}(x) = \\frac{1}{2} c \\varepsilon^2 I(x) = \\frac{\\pi c \\varepsilon^2 \\delta^3}{30} (2+5\\alpha^3-3\\alpha^5)$.\n\nFinally, we compute the ratio $R(\\alpha)$:\n$R(\\alpha) = \\frac{W_{\\mathrm{pd}}(x)}{W_{\\mathrm{pd,bulk}}} = \\frac{\\frac{\\pi c \\varepsilon^2 \\delta^3}{30} (2+5\\alpha^3-3\\alpha^5)}{\\frac{2 \\pi c \\delta^3 \\varepsilon^2}{15}} = \\frac{\\frac{\\pi c \\varepsilon^2 \\delta^3}{30} (2+5\\alpha^3-3\\alpha^5)}{\\frac{4 \\pi c \\delta^3 \\varepsilon^2}{30}} = \\frac{2+5\\alpha^3-3\\alpha^5}{4}$.\n$R(\\alpha) = \\frac{1}{2} + \\frac{5}{4}\\alpha^3 - \\frac{3}{4}\\alpha^5$.\n\nSecond, we derive the correction factor $\\beta(\\alpha)$. The goal is to modify the micro-modulus $c$ to $c' = \\beta(\\alpha) c$ such that the corrected energy density $W_{\\mathrm{pd,corr}}(x)$ matches the target continuum energy density. The problem states this target energy density is equal to the bulk peridynamic energy density $W_{\\mathrm{pd,bulk}}$. The corrected energy density at depth $x$ is:\n$W_{\\mathrm{pd,corr}}(x) = \\beta(\\alpha) W_{\\mathrm{pd}}(x)$.\nWe require this to be equal to the target energy, $W_{\\mathrm{pd,bulk}}$.\n$\\beta(\\alpha) W_{\\mathrm{pd}}(x) = W_{\\mathrm{pd,bulk}}$.\nSolving for $\\beta(\\alpha)$:\n$\\beta(\\alpha) = \\frac{W_{\\mathrm{pd,bulk}}}{W_{\\mathrm{pd}}(x)} = \\frac{1}{R(\\alpha)}$.\nThe problem specifies that the match should be within a tolerance $t=10^{-3}$. Choosing $\\beta(\\alpha) = 1/R(\\alpha)$ results in a perfect match, $W_{\\mathrm{pd,corr}}(x) = W_{\\mathrm{pd,bulk}}$, so the error is $0$, which is less than the specified tolerance. This provides the exact analytical correction factor.\n$\\beta(\\alpha) = \\frac{1}{\\frac{1}{2} + \\frac{5}{4}\\alpha^3 - \\frac{3}{4}\\alpha^5} = \\frac{4}{2 + 5\\alpha^3 - 3\\alpha^5}$.\n\nThe two derived dimensionless functions of $\\alpha \\in [0,1]$ are the stiffness reduction factor $R(\\alpha)$ and the corresponding correction factor $\\beta(\\alpha)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2} + \\frac{5}{4}\\alpha^{3} - \\frac{3}{4}\\alpha^{5} & \\frac{4}{2 + 5\\alpha^{3} - 3\\alpha^{5}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A simulation is only as reliable as its verification, and for dynamic fracture, nothing is more fundamental than the conservation of energy. As a crack propagates, elastic strain energy is converted into kinetic energy and the energy required to create new surfaces. This coding practice challenges you to implement a rigorous energy balance audit for a dynamic peridynamic simulation, meticulously tracking all energy components and quantifying sources of numerical dissipation to build confidence in the physical realism of your model .",
            "id": "3587038",
            "problem": "Consider a one-dimensional bond-based peridynamic formulation for a uniform bar, discretized into $N$ material points with uniform spacing. The peridynamic equation of motion follows directly from Newton's second law and the pairwise peridynamic force function. Your task is to implement an explicit central-difference time integrator for the microelastic brittle model with irreversible bond breaking, and to perform a rigorous energy balance check including kinetic energy, elastic (pairwise bond) energy, and fracture work accumulated due to broken bonds. Additionally, you must quantify the numerical dissipation attributable to two sources: explicit time integration and stepwise neighbor (bond) updates upon breaking.\n\nFundamental base:\n- Newton's second law: for each material point $i$ with mass $m_i$, the acceleration is given by the net internal peridynamic force, i.e., $m_i \\, \\ddot{y}_i(t) = \\sum_{j \\in \\mathcal{H}_i} f_{ij}(t)$, where $\\mathcal{H}_i$ denotes the set of neighbors of $i$ within the horizon in the reference configuration.\n- Bond-based microelastic brittle peridynamics in one dimension with constant micromodulus $c$ and unit influence function: for a bond between points $i$ and $j$, the reference separation is $r_{0,ij} = x_j - x_i > 0$, the current separation is $r_{ij}(t) = y_j(t) - y_i(t)$, and the stretch is $s_{ij}(t) = \\dfrac{r_{ij}(t) - r_{0,ij}}{r_{0,ij}}$. The pairwise scalar force contribution along the bond is $f_{ij}(t) = c \\, s_{ij}(t) \\, V_i V_j$, acting positively on point $i$ and negatively on point $j$, where $V_i$ and $V_j$ are the associated point volumes. A bond irreversibly breaks when $s_{ij}(t) \\ge s_{\\mathrm{crit}}$.\n- Energetics: The kinetic energy is $E_{\\mathrm{kin}}(t) = \\sum_i \\dfrac{1}{2} m_i v_i(t)^2$, with $v_i(t)$ the material point velocity. The elastic energy stored in all unbroken bonds is $E_{\\mathrm{el}}(t) = \\sum_{(i,j) \\in \\mathcal{B}(t)} \\dfrac{1}{2} c \\, r_{0,ij} \\, s_{ij}(t)^2 \\, V_i V_j$, where $\\mathcal{B}(t)$ is the current set of unbroken bonds (each bond counted once). The fracture work accumulated due to broken bonds is $E_{\\mathrm{frac}}(t) = \\sum_{(i,j) \\in \\mathcal{F}(t)} \\dfrac{1}{2} c \\, r_{0,ij} \\, s_{\\mathrm{crit}}^2 \\, V_i V_j$, where $\\mathcal{F}(t)$ is the set of bonds that have broken up to time $t$.\n- Energy balance check: In the absence of external work, the ideal energy balance is $E_{\\mathrm{tot}}(t) = E_{\\mathrm{kin}}(t) + E_{\\mathrm{el}}(t) + E_{\\mathrm{frac}}(t) = \\mathrm{constant}$. Any deviation from constancy is due to numerical artifacts. Define the total numerical dissipation at a given time $t$ as $D_{\\mathrm{tot}}(t) = E_{\\mathrm{tot}}(0) - E_{\\mathrm{tot}}(t)$. When a bond is detected as broken at a discrete update time, the bond stretch may overshoot beyond $s_{\\mathrm{crit}}$; the associated overshoot energy that is not accounted by $E_{\\mathrm{frac}}$ is $D_{\\mathrm{nbr}}(t) = \\sum_{\\text{break events}} \\dfrac{1}{2} c \\, r_{0,ij} \\, \\left( s_{ij}(t)^2 - s_{\\mathrm{crit}}^2 \\right) \\, V_i V_j$, evaluated at the detection time. Attribute this quantity to stepwise neighbor (bond) update dissipation. Then attribute the remainder $D_{\\mathrm{time}}(t) = D_{\\mathrm{tot}}(t) - D_{\\mathrm{nbr}}(t)$ to explicit time integration error.\n\nGeometry and discretization:\n- A uniform one-dimensional bar of length $L$ is discretized into $N$ material points. The reference positions are $x_i = i \\, \\Delta x$ for $i = 0, 1, \\dots, N-1$, with $\\Delta x = L/(N-1)$. The point volume is $V_i = \\Delta x$ for all $i$. The mass of each point is $m_i = \\rho \\, A \\, V_i$, where $A$ is the cross-sectional area and $\\rho$ is the mass density. Use $A = 1$ and $\\rho = 1$ (non-dimensional consistent units).\n- The peridynamic horizon is $h$. The neighbor set in the reference configuration includes all pairs $(i,j)$ with $j > i$ and $x_j - x_i \\le h$. The influence function is unity for all bonds, so there is no additional weighting.\n\nTime integration and bond breaking:\n- Use explicit central difference updates with velocities stored at half time steps: $v_i^{n+\\frac{1}{2}} = v_i^{n-\\frac{1}{2}} + \\dfrac{F_i^n}{m_i} \\, \\Delta t$, and $y_i^{n+1} = y_i^n + v_i^{n+\\frac{1}{2}} \\, \\Delta t$, where $F_i^n$ is the net internal force computed from the unbroken bonds at configuration $y^n$. Initialize with $y_i^0 = x_i$ and $v_i^{\\frac{1}{2}} = v_i^0$ (since $F_i^0 = 0$ for $s_{ij}^0 = 0$).\n- After updating to $y^{n+1}$, detect all bonds with $s_{ij}^{n+1} \\ge s_{\\mathrm{crit}}$. For each such bond, accumulate the fracture work increment $\\Delta E_{\\mathrm{frac}} = \\dfrac{1}{2} c \\, r_{0,ij} \\, s_{\\mathrm{crit}}^2 \\, V_i V_j$, compute the overshoot dissipation increment $\\Delta D_{\\mathrm{nbr}} = \\dfrac{1}{2} c \\, r_{0,ij} \\, \\left( s_{ij}^{n+1}{}^2 - s_{\\mathrm{crit}}^2 \\right) \\, V_i V_j$, and mark the bond as broken so that it contributes no force or elastic energy thereafter. Note that the detection is done at discrete times and no sub-stepping is used; therefore, $\\Delta D_{\\mathrm{nbr}} \\ge 0$ when an overshoot occurs.\n\nInitial conditions:\n- The initial displacements are zero, $y_i^0 = x_i$. The initial velocities are a linear ramp $v_i^0 = v_{\\mathrm{amp}} \\, \\dfrac{x_i}{L}$, producing a uniform stretch rate across all bonds for small times. This choice results in a uniform initial stretch rate $ \\dot{s}_{ij}(0) \\approx \\dfrac{v_{\\mathrm{amp}}}{L}$ for all bonds within the horizon while $s_{ij}$ remains small.\n\nRequired outputs and units:\n- All quantities are non-dimensional (unitless consistent system). No physical unit conversion is required.\n- For each test case, compute at the final simulation time $T$ the following floats: $D_{\\mathrm{tot}}(T)$, $D_{\\mathrm{nbr}}(T)$, and $D_{\\mathrm{time}}(T)$. Additionally, compute the maximum total dissipation magnitude over the entire simulation, $D_{\\max} = \\max_{0 \\le t \\le T} \\left| D_{\\mathrm{tot}}(t) \\right|$, using values sampled at each time step.\n\nTest suite:\nImplement three test cases with the following parameter sets. In all cases, use $N = 101$, $L = 1$, $\\rho = 1$, $A = 1$, horizon $h = 3 \\Delta x$, micromodulus $c = 0.5$, and critical stretch $s_{\\mathrm{crit}} = 0.02$.\n1. Happy path: moderate time step and velocity amplitude, expecting some bond breaking and moderate overshoot.\n   - $\\Delta t = 2.0 \\times 10^{-4}$, $T = 5.0 \\times 10^{-2}$, $v_{\\mathrm{amp}} = 0.5$.\n2. Near-conservative boundary: small time step, expecting very low explicit integration error and reduced overshoot.\n   - $\\Delta t = 5.0 \\times 10^{-5}$, $T = 5.0 \\times 10^{-2}$, $v_{\\mathrm{amp}} = 0.5$.\n3. Edge case: large time step, expecting larger overshoot-induced dissipation and noticeable integration error.\n   - $\\Delta t = 8.0 \\times 10^{-4}$, $T = 5.0 \\times 10^{-2}$, $v_{\\mathrm{amp}} = 0.5$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case yields a list of four floats in order $[D_{\\mathrm{tot}}(T), D_{\\mathrm{nbr}}(T), D_{\\mathrm{time}}(T), D_{\\max}]$. The overall output is thus a list of three such lists, one per test case, e.g., $[[d_{1,\\mathrm{tot}}, d_{1,\\mathrm{nbr}}, d_{1,\\mathrm{time}}, d_{1,\\max}], [d_{2,\\mathrm{tot}}, d_{2,\\mathrm{nbr}}, d_{2,\\mathrm{time}}, d_{2,\\max}], [d_{3,\\mathrm{tot}}, d_{3,\\mathrm{nbr}}, d_{3,\\mathrm{time}}, d_{3,\\max}]]$.",
            "solution": "The problem requires the implementation of a one-dimensional, bond-based peridynamic simulation for a microelastic brittle bar. The objective is to perform a detailed energy balance analysis, quantifying numerical dissipation from two distinct sources: the explicit time integration scheme and the discrete nature of bond-breaking updates.\n\nThis solution begins by discretizing the one-dimensional bar of length $L$ into $N$ material points. The reference position of each point $i$ is $x_i = i \\Delta x$, where $i \\in \\{0, 1, \\dots, N-1\\}$ and the uniform spacing is $\\Delta x = L/(N-1)$. Each point has a volume $V_i = \\Delta x$ and mass $m_i = \\rho A V_i$, where $\\rho$ is the mass density and $A$ is the cross-sectional area. For this problem, we use $\\rho=1$ and $A=1$.\n\nThe peridynamic model is bond-based, meaning that material points interact through pairwise forces within a finite radius called the horizon, $h$. A bond is established between any two points $i$ and $j$ if their initial separation $r_{0,ij} = |x_j - x_i|$ is less than or equal to $h$. For implementation, we consider only pairs where $i < j$, so $r_{0,ij} = x_j - x_i$. This set of bonds is pre-computed and stored. The state of each bond (active or broken) is tracked throughout the simulation.\n\nThe dynamics of the system are governed by Newton's second law for each material point $i$:\n$$m_i \\ddot{y}_i(t) = F_i(t)$$\nwhere $y_i(t)$ is the current position of point $i$ and $F_i(t)$ is the net peridynamic force acting on it. The force is the sum of contributions from all bonds connected to point $i$. Based on the problem's definitions, a bond between points $i$ and $j$ (with $i<j$) exerts a force of magnitude $f_{ij} = c \\, s_{ij} \\, V_i V_j$ on point $i$ in the positive direction and on point $j$ in the negative direction, assuming tension ($s_{ij} > 0$). The stretch $s_{ij}$ is defined as $s_{ij}(t) = (r_{ij}(t) - r_{0,ij}) / r_{0,ij}$, where $r_{ij}(t) = y_j(t) - y_i(t)$ is the current separation. The net force on a point $k$ is the sum of forces from all bonds it participates in:\n$$F_k(t) = \\sum_{i<k, \\text{bond }(i,k)} f_{ik}(t) - \\sum_{j>k, \\text{bond } (k,j)} f_{kj}(t)$$\nHere, $f_{ab} = c \\, s_{ab} \\, V_a V_b$. This formulation is consistent with the negative gradient of the provided elastic potential energy, $F_k = -\\partial E_{\\mathrm{el}} / \\partial y_k$.\n\nThe time evolution is simulated using an explicit central-difference (leapfrog) method. Velocities are evaluated at half-integer time steps ($t_{n+1/2}$), while positions are evaluated at integer time steps ($t_n$). The update equations are:\n$$v_i^{n+1/2} = v_i^{n-1/2} + \\frac{F_i^n}{m_i} \\Delta t$$\n$$y_i^{n+1} = y_i^n + v_i^{n+1/2} \\Delta t$$\nwhere the superscript $n$ denotes the time step $t_n = n \\Delta t$. The simulation starts with initial conditions $y_i^0 = x_i$ and an initial velocity profile $v_i^0 = v_{\\mathrm{amp}} x_i / L$. Since the initial forces $F_i^0$ are zero (as $s_{ij}^0 = 0$), the half-step velocity is initialized as $v_i^{1/2} = v_i^0$.\n\nA crucial part of the model is the irreversible breaking of bonds. After each position update to $y^{n+1}$, the stretch $s_{ij}^{n+1}$ of every active bond is checked against a critical stretch, $s_{\\mathrm{crit}}$. If $s_{ij}^{n+1} \\ge s_{\\mathrm{crit}}$, the bond is marked as permanently broken. At this discretely detected moment of failure, two energy quantities are updated:\n1.  The fracture work, $E_{\\mathrm{frac}}$, which represents the energy consumed to create the new fracture surface. It is incremented by $\\Delta E_{\\mathrm{frac}} = \\frac{1}{2} c \\, r_{0,ij} \\, s_{\\mathrm{crit}}^2 \\, V_i V_j$.\n2.  The numerical dissipation due to bond-breaking overshoot, $D_{\\mathrm{nbr}}$. Since the check occurs at discrete time intervals, the stretch at detection, $s_{ij}^{n+1}$, can exceed $s_{\\mathrm{crit}}$. The excess elastic energy released at this moment is unaccounted for by the ideal fracture work and is considered a source of numerical dissipation. It is incremented by $\\Delta D_{\\mathrm{nbr}} = \\frac{1}{2} c \\, r_{0,ij} \\left( (s_{ij}^{n+1})^2 - s_{\\mathrm{crit}}^2 \\right) V_i V_j$.\n\nThe energy balance check requires computing the total energy of the system, $E_{\\mathrm{tot}}(t) = E_{\\mathrm{kin}}(t) + E_{\\mathrm{el}}(t) + E_{\\mathrm{frac}}(t)$, at each time step.\n-   The kinetic energy is $E_{\\mathrm{kin}}(t) = \\sum_i \\frac{1}{2} m_i v_i(t)^2$. To compute the velocity at an integer time step, $v_i^n$, we average the half-step velocities: $v_i^n = \\frac{1}{2}(v_i^{n-1/2} + v_i^{n+1/2})$. This provides a second-order accurate estimate.\n-   The elastic energy stored in all currently active bonds is $E_{\\mathrm{el}}(t_n) = \\sum_{(i,j) \\in \\mathcal{B}(t_n)} \\frac{1}{2} c \\, r_{0,ij} \\, (s_{ij}^n)^2 \\, V_i V_j$.\n-   The accumulated fracture work, $E_{\\mathrm{frac}}$, is the sum of all increments from broken bonds up to time $t$.\n\nThe total numerical dissipation at time $t$ is the deviation from the initial total energy: $D_{\\mathrm{tot}}(t) = E_{\\mathrm{tot}}(0) - E_{\\mathrm{tot}}(t)$. This total dissipation is then decomposed into two parts as per the problem statement: the previously calculated overshoot dissipation $D_{\\mathrm{nbr}}(t)$, and the residual dissipation attributed to the time integration scheme, $D_{\\mathrm{time}}(t) = D_{\\mathrm{tot}}(t) - D_{\\mathrm{nbr}}(t)$. The maximum absolute total dissipation, $D_{\\max} = \\max_{0 \\le t \\le T} |D_{\\mathrm{tot}}(t)|$, is also tracked throughout the simulation.\n\nThe algorithm proceeds by iterating through time steps. In each step $n$, it computes forces $F^n$ from positions $y^n$, updates velocities to $v^{n+1/2}$, calculates energies at $t_n$, updates positions to $y^{n+1}$, and finally checks for and processes any bond failures. This cycle repeats until the final time $T$ is reached. A final energy calculation is performed at time $T$ to obtain the required output values.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the peridynamic simulation for the specified test cases\n    and print the results in the required format.\n    \"\"\"\n\n    def run_simulation(N, L, rho, A, c, scrit, h, dt, T, v_amp):\n        \"\"\"\n        Executes a single peridynamic simulation with a given set of parameters.\n\n        Returns a list of floats: [D_tot(T), D_nbr(T), D_time(T), D_max].\n        \"\"\"\n        # 1. Discretization and Initialization\n        dx = L / (N - 1)\n        m = rho * A * dx\n        V2 = dx * dx  # Pre-calculate V_i * V_j as it's constant\n\n        x = np.linspace(0, L, N, dtype=np.float64)\n        y_n = np.copy(x)\n\n        # Initial velocities\n        v_0 = v_amp * x / L\n        \n        # Central difference scheme uses velocities at half-time steps.\n        # v_n_minus_half represents v^{n-1/2}.\n        # For initialization, v^{1/2} = v^0 since F^0 is zero.\n        v_n_minus_half = np.copy(v_0)\n\n        # 2. Bond Setup\n        bonds = []\n        for i in range(N):\n            for j in range(i + 1, N):\n                dist = x[j] - x[i]\n                if dist <= h + 1e-9: # Add tolerance for float comparison\n                    bonds.append({'i': i, 'j': j, 'r0': dist, 'active': True})\n        \n        # 3. Energy Initialization\n        E_frac = 0.0\n        D_nbr = 0.0\n        \n        # Initial kinetic energy at t=0. v(0) = v_0.\n        E_kin_0 = 0.5 * m * np.sum(v_0**2)\n        # Initial elastic and fracture energies are zero.\n        E_tot_0 = E_kin_0\n\n        D_max = 0.0\n        \n        num_steps = int(round(T / dt))\n\n        # 4. Time-stepping Loop\n        for n in range(num_steps):\n            # A. Compute forces F^n from positions y^n\n            F_n = np.zeros(N, dtype=np.float64)\n            s_n_values = {}  # Store stretches s^n for energy calculation\n\n            for k, bond in enumerate(bonds):\n                if bond['active']:\n                    i, j = bond['i'], bond['j']\n                    r_n = y_n[j] - y_n[i]\n                    s_n = (r_n - bond['r0']) / bond['r0']\n                    s_n_values[k] = s_n\n                    \n                    f = c * s_n * V2\n                    F_n[i] += f\n                    F_n[j] -= f\n\n            # B. Update velocities from v^{n-1/2} to v^{n+1/2}\n            v_n_plus_half = v_n_minus_half + (F_n / m) * dt\n\n            # C. Energy calculation at time t_n\n            # v^n = (v^{n-1/2} + v^{n+1/2}) / 2\n            v_n = 0.5 * (v_n_minus_half + v_n_plus_half)\n            E_kin_n = 0.5 * m * np.sum(v_n**2)\n            \n            E_el_n = 0.0\n            for k, bond in enumerate(bonds):\n                if bond['active']:\n                    s_n = s_n_values[k]\n                    E_el_n += 0.5 * c * bond['r0'] * s_n**2 * V2\n\n            E_tot_n = E_kin_n + E_el_n + E_frac\n            D_tot_n = E_tot_0 - E_tot_n\n            D_max = max(D_max, abs(D_tot_n))\n\n            # D. Update positions from y^n to y^{n+1}\n            y_n_plus_1 = y_n + v_n_plus_half * dt\n            \n            # E. Check for bond breaks based on new positions y^{n+1}\n            # The accumulated E_frac, D_nbr will be used in the next step's energy calc\n            for k, bond in enumerate(bonds):\n                if bond['active']:\n                    i, j = bond['i'], bond['j']\n                    r_np1 = y_n_plus_1[j] - y_n_plus_1[i]\n                    s_np1 = (r_np1 - bond['r0']) / bond['r0']\n                    \n                    if s_np1 >= scrit:\n                        bond['active'] = False\n                        \n                        E_frac += 0.5 * c * bond['r0'] * scrit**2 * V2\n                        D_nbr += 0.5 * c * bond['r0'] * (s_np1**2 - scrit**2) * V2\n            \n            # F. Prepare for the next iteration\n            y_n = y_n_plus_1\n            v_n_minus_half = v_n_plus_half\n    \n        # 5. Post-loop: Final calculation at time T\n        # Current state: y_n = y^{N_steps}, v_n_minus_half = v^{N_steps-1/2}\n        \n        # Final force calculation at t_N = T\n        F_N = np.zeros(N, dtype=np.float64)\n        s_N_values = {}\n        for k, bond in enumerate(bonds):\n            if bond['active']:\n                i, j = bond['i'], bond['j']\n                r_N = y_n[j] - y_n[i]\n                s_N = (r_N - bond['r0']) / bond['r0']\n                s_N_values[k] = s_N\n                \n                f = c * s_N * V2\n                F_N[i] += f\n                F_N[j] -= f\n\n        # Final velocity updates to get v at time T\n        v_N_plus_half = v_n_minus_half + (F_N / m) * dt\n        v_N = 0.5 * (v_n_minus_half + v_N_plus_half)\n        \n        # Final energy calculation\n        E_kin_T = 0.5 * m * np.sum(v_N**2)\n        \n        E_el_T = 0.0\n        for k, bond in enumerate(bonds):\n            if bond['active']:\n                s_N = s_N_values[k]\n                E_el_T += 0.5 * c * bond['r0'] * s_N**2 * V2\n\n        # E_frac and D_nbr are their final accumulated values\n        E_tot_T = E_kin_T + E_el_T + E_frac\n        D_tot_T = E_tot_0 - E_tot_T\n        D_time_T = D_tot_T - D_nbr\n        \n        D_max = max(D_max, abs(D_tot_T))\n        \n        return [D_tot_T, D_nbr, D_time_T, D_max]\n\n    # --- Main execution ---\n    # Common parameters\n    N = 101\n    L = 1.0\n    rho = 1.0\n    A = 1.0\n    c = 0.5\n    scrit = 0.02\n    dx = L / (N - 1)\n    h = 3.0 * dx\n    \n    test_cases = [\n        # (dt, T, v_amp)\n        (2.0e-4, 5.0e-2, 0.5), # Case 1: Happy path\n        (5.0e-5, 5.0e-2, 0.5), # Case 2: Near-conservative\n        (8.0e-4, 5.0e-2, 0.5)  # Case 3: Edge case (large dt)\n    ]\n\n    results = []\n    for dt, T, v_amp in test_cases:\n        case_results = run_simulation(N, L, rho, A, c, scrit, h, dt, T, v_amp)\n        results.append(case_results)\n\n    # Format the final output string exactly as required\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}