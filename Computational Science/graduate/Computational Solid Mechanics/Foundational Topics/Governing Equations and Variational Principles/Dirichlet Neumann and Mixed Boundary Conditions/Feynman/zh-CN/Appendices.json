{
    "hands_on_practices": [
        {
            "introduction": "在求解复杂的力学问题之前，理解一个“适定”的边值问题是如何构成的，是至关重要的一步。本练习  引入了“制造解方法”(Method of Manufactured Solutions)，这是一种用于验证仿真代码准确性的强大技术。通过从一个预设的位移场出发，你将反向推导出为维持该位移场所需施加的体力项和边界条件，从而深刻理解一个完整边值问题中各个组成部分之间的内在联系。",
            "id": "3558541",
            "problem": "考虑一个处于平面应变状态的二维固体，其占据开单位正方形域 $\\Omega = (0,1) \\times (0,1)$。该材料是均匀、各向同性的线性弹性体，其杨氏模量为 $E$，泊松比为 $\\nu$。拉梅参数为 $\\lambda = \\dfrac{E \\nu}{(1+\\nu)(1-2\\nu)}$ 和 $\\mu = \\dfrac{E}{2(1+\\nu)}$。控制方程为静态线性动量平衡方程和针对小应变的线性本构关系，其中柯西应力 $\\sigma$ 通过 $\\sigma = \\lambda \\,\\operatorname{tr}(\\varepsilon)\\, I + 2 \\mu\\, \\varepsilon$ 与对称小应变张量 $\\varepsilon$ 相关联，平衡方程为 $-\\nabla \\cdot \\sigma = b$（在 $\\Omega$ 内），其中 $b$ 是体力。\n\n为了构造用于代码验证的制造解，我们指定位移场 $u(x,y) = \\begin{pmatrix} u_{1}(x,y) \\\\ u_{2}(x,y) \\end{pmatrix}$，其分量为 $u_{1}(x,y) = x^{2} y + x y$ 和 $u_{2}(x,y) = - x y^{2} + x + y$。将边界划分为狄利克雷(Dirichlet)和诺伊曼(Neumann)边界段，定义为 $\\Gamma_{D} = \\{(0,y) \\,|\\, y \\in [0,1]\\} \\cup \\{(x,1) \\,|\\, x \\in [0,1]\\}$ 和 $\\Gamma_{N} = \\{(x,0) \\,|\\, x \\in [0,1]\\} \\cup \\{(1,y) \\,|\\, y \\in [0,1]\\}$，其中每个边界段上的外单位法向量用于计算面力。\n\n任务：\n- 从小应变张量 $\\varepsilon = \\dfrac{1}{2}\\left(\\nabla u + (\\nabla u)^{\\top}\\right)$ 和本构定律 $\\sigma = \\lambda \\,\\operatorname{tr}(\\varepsilon)\\, I + 2 \\mu\\, \\varepsilon$ 的定义出发，计算使位移场 $u(x,y)$ 在 $\\Omega$ 内满足平衡方程所需的体力场 $b(x,y)$。\n- 确定诺伊曼边界 $\\Gamma_{N}$ 上的面力矢量 $\\bar{t} = \\sigma n$，其中 $n$ 表示外单位法向量。\n- 通过将 $u(x,y)$ 限制在狄利克雷边界 $\\Gamma_{D}$ 上，提供相应的狄利克雷数据 $\\bar{u}$。\n\n将最终答案表示为关于 $x$、$y$、$\\lambda$ 和 $\\mu$ 的体力矢量 $b(x,y)$ 的闭合形式解析表达式。最终表达式中无需进行数值舍入，也无需报告单位。",
            "solution": "该问题是有效的，因为它是线性弹性力学中一个适定的、有科学依据的练习，特别是使用了制造解方法进行代码验证。所有必要的数据和定义均已提供，不存在矛盾或模糊之处。\n\n目标是计算与指定位移场 $u(x,y)$ 相对应的体力场 $b(x,y)$、诺伊曼边界 $\\Gamma_{N}$ 上的面力矢量 $\\bar{t}$ 以及狄利克雷边界 $\\Gamma_{D}$ 上的位移数据 $\\bar{u}$。要求的最终答案是体力 $b(x,y)$ 的表达式。\n\n指定的位移场分量如下：\n$$\nu_{1}(x,y) = x^{2} y + x y\n$$\n$$\nu_{2}(x,y) = - x y^{2} + x + y\n$$\n\n首先，我们计算位移场的梯度 $\\nabla u$：\n$$\n\\nabla u = \\begin{pmatrix} \\frac{\\partial u_{1}}{\\partial x} & \\frac{\\partial u_{1}}{\\partial y} \\\\ \\frac{\\partial u_{2}}{\\partial x} & \\frac{\\partial u_{2}}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} 2xy + y & x^{2} + x \\\\ -y^{2} + 1 & -2xy + 1 \\end{pmatrix}\n$$\n\n接下来，我们计算对称小应变张量 $\\varepsilon = \\frac{1}{2}\\left(\\nabla u + (\\nabla u)^{\\top}\\right)$ 的分量：\n$$\n\\varepsilon_{11} = \\frac{\\partial u_{1}}{\\partial x} = 2xy + y\n$$\n$$\n\\varepsilon_{22} = \\frac{\\partial u_{2}}{\\partial y} = -2xy + 1\n$$\n$$\n\\varepsilon_{12} = \\varepsilon_{21} = \\frac{1}{2}\\left(\\frac{\\partial u_{1}}{\\partial y} + \\frac{\\partial u_{2}}{\\partial x}\\right) = \\frac{1}{2}\\left((x^{2} + x) + (-y^{2} + 1)\\right) = \\frac{1}{2}(x^{2} + x - y^{2} + 1)\n$$\n\n对于二维平面应变情况，应变张量的迹为：\n$$\n\\operatorname{tr}(\\varepsilon) = \\varepsilon_{11} + \\varepsilon_{22} = (2xy + y) + (-2xy + 1) = y + 1\n$$\n\n现在，我们使用本构定律 $\\sigma = \\lambda \\,\\operatorname{tr}(\\varepsilon)\\, I + 2 \\mu\\, \\varepsilon$ 来求解柯西应力张量 $\\sigma$ 的分量：\n$$\n\\sigma_{11} = \\lambda \\operatorname{tr}(\\varepsilon) + 2\\mu\\varepsilon_{11} = \\lambda(y + 1) + 2\\mu(2xy + y)\n$$\n$$\n\\sigma_{22} = \\lambda \\operatorname{tr}(\\varepsilon) + 2\\mu\\varepsilon_{22} = \\lambda(y + 1) + 2\\mu(-2xy + 1)\n$$\n$$\n\\sigma_{12} = \\sigma_{21} = 2\\mu\\varepsilon_{12} = 2\\mu \\left(\\frac{1}{2}(x^{2} + x - y^{2} + 1)\\right) = \\mu(x^{2} + x - y^{2} + 1)\n$$\n\n体力矢量 $b$ 由平衡方程 $b = -\\nabla \\cdot \\sigma$ 确定。应力张量散度的分量为 $(\\nabla \\cdot \\sigma)_{1} = \\frac{\\partial \\sigma_{11}}{\\partial x} + \\frac{\\partial \\sigma_{12}}{\\partial y}$ 和 $(\\nabla \\cdot \\sigma)_{2} = \\frac{\\partial \\sigma_{21}}{\\partial x} + \\frac{\\partial \\sigma_{22}}{\\partial y}$。首先，我们计算应力分量的偏导数：\n$$\n\\frac{\\partial \\sigma_{11}}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\lambda(y + 1) + 2\\mu(2xy + y) \\right] = 4\\mu y\n$$\n$$\n\\frac{\\partial \\sigma_{12}}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ \\mu(x^{2} + x - y^{2} + 1) \\right] = -2\\mu y\n$$\n$$\n\\frac{\\partial \\sigma_{21}}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\mu(x^{2} + x - y^{2} + 1) \\right] = \\mu(2x + 1)\n$$\n$$\n\\frac{\\partial \\sigma_{22}}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ \\lambda(y + 1) + 2\\mu(-2xy + 1) \\right] = \\lambda + 2\\mu(-2x) = \\lambda - 4\\mu x\n$$\n\n现在，我们组合体力矢量 $b = \\begin{pmatrix} b_{1} \\\\ b_{2} \\end{pmatrix}$ 的分量：\n$$\nb_{1} = -\\left( \\frac{\\partial \\sigma_{11}}{\\partial x} + \\frac{\\partial \\sigma_{12}}{\\partial y} \\right) = -(4\\mu y - 2\\mu y) = -2\\mu y\n$$\n$$\nb_{2} = -\\left( \\frac{\\partial \\sigma_{21}}{\\partial x} + \\frac{\\partial \\sigma_{22}}{\\partial y} \\right) = -(\\mu(2x + 1) + (\\lambda - 4\\mu x)) = -(\\lambda + \\mu + 2\\mu x - 4\\mu x) = -(\\lambda + \\mu - 2\\mu x) = 2\\mu x - \\lambda - \\mu\n$$\n因此，体力场为 $b(x,y) = \\begin{pmatrix} -2\\mu y \\\\ 2\\mu x - \\lambda - \\mu \\end{pmatrix}$。这是所要求的最终答案。\n\n为了完整起见，我们还推导了边界条件。\n诺伊曼边界为 $\\Gamma_{N} = \\{(x,0) \\,|\\, x \\in [0,1]\\} \\cup \\{(1,y) \\,|\\, y \\in [0,1]\\}$。面力矢量为 $\\bar{t} = \\sigma n$。\n\n在 $y=0$ 且 $x \\in [0,1]$ 的边界段上，外法向量为 $n = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。面力为：\n$$\n\\bar{t}(x,0) = \\begin{pmatrix} \\sigma_{11} & \\sigma_{12} \\\\ \\sigma_{21} & \\sigma_{22} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -\\sigma_{12}(x,0) \\\\ -\\sigma_{22}(x,0) \\end{pmatrix}\n$$\n计算 $y=0$ 时的应力分量：\n$\\sigma_{12}(x,0) = \\mu(x^{2} + x + 1)$\n$\\sigma_{22}(x,0) = \\lambda(1) + 2\\mu(1) = \\lambda + 2\\mu$\n因此，$\\bar{t}(x,0) = \\begin{pmatrix} -\\mu(x^{2} + x + 1) \\\\ -(\\lambda + 2\\mu) \\end{pmatrix}$。\n\n在 $x=1$ 且 $y \\in [0,1]$ 的边界段上，外法向量为 $n = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。面力为：\n$$\n\\bar{t}(1,y) = \\begin{pmatrix} \\sigma_{11} & \\sigma_{12} \\\\ \\sigma_{21} & \\sigma_{22} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\sigma_{11}(1,y) \\\\ \\sigma_{21}(1,y) \\end{pmatrix}\n$$\n计算 $x=1$ 时的应力分量：\n$\\sigma_{11}(1,y) = \\lambda(y+1) + 2\\mu(2y+y) = \\lambda(y+1) + 6\\mu y$\n$\\sigma_{21}(1,y) = \\mu(1^{2} + 1 - y^{2} + 1) = \\mu(3 - y^{2})$\n因此，$\\bar{t}(1,y) = \\begin{pmatrix} \\lambda(y+1) + 6\\mu y \\\\ \\mu(3-y^{2}) \\end{pmatrix}$。\n\n狄利克雷边界为 $\\Gamma_{D} = \\{(0,y) \\,|\\, y \\in [0,1]\\} \\cup \\{(x,1) \\,|\\, x \\in [0,1]\\}$。狄利克雷数据 $\\bar{u}$ 是在 $\\Gamma_D$ 上求值的指定位移场。\n\n在 $x=0$ 且 $y \\in [0,1]$ 的边界段上：\n$$\n\\bar{u}(0,y) = \\begin{pmatrix} u_{1}(0,y) \\\\ u_{2}(0,y) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ y \\end{pmatrix}\n$$\n\n在 $y=1$ 且 $x \\in [0,1]$ 的边界段上：\n$$\n\\bar{u}(x,1) = \\begin{pmatrix} u_{1}(x,1) \\\\ u_{2}(x,1) \\end{pmatrix} = \\begin{pmatrix} x^{2}+x \\\\ -x(1)^{2}+x+1 \\end{pmatrix} = \\begin{pmatrix} x^{2}+x \\\\ 1 \\end{pmatrix}\n$$\n这些结果定义了一个完整的边值问题，给定的位移场是其精确解。该问题特别要求将体力矢量作为最终答案。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -2\\mu y \\\\ 2\\mu x - \\lambda - \\mu \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "掌握了如何构造一个问题之后，下一步便是亲手求解它。本练习  呈现了一个经典的、同时包含狄利克雷(Dirichlet)和诺伊曼(Neumann)条件的混合边值问题——一维杆的拉伸。你将通过此实践获得有限元方法(FEM)中全局系统组装的直接经验，并学习如何应用罚函数法，这是一种在有限元程序中施加本质(狄利克雷)边界条件的常用数值技术。",
            "id": "3558610",
            "problem": "建立一个长度为 $L=1$ 米的棱柱杆的小应变、线弹性、准静态轴向变形模型。其横截面积为 $A=0.01$ 平方米，杨氏模量为 $E=200$ 帕斯卡。一维空间上的控制强形式为 $-\\frac{d}{dx}\\!\\left(EA\\,\\frac{du}{dx}\\right)=0$，对于 $0  x  L$。边界条件为：在 $x=0$ 处施加狄利克雷条件 $u(0)=\\bar{u}=0.001$ 米，在 $x=L$ 处施加诺伊曼条件 $\\sigma(L)=\\bar{\\sigma}=20$ 帕斯卡，其中 $\\sigma$ 是轴向应力。使用包含两个等长线性有限元的有限元法 (FEM) 离散化该杆。利用罚函数法施加狄利克雷边界条件，其中罚参数取为 $\\alpha=1000 \\times \\max(|K_{ij}|)$，其中 $\\mathbf{K}$ 是全局刚度矩阵。\n\n计算该杆在 $x=0.5$ 米处的轴向位移 $u$（以米为单位）。将最终答案四舍五入到四位有效数字。",
            "solution": "本问题要求使用包含两个线性单元的有限元法 (FEM) 和罚函数法来求解一个一维杆的轴向变形问题，并确定杆中点 $x=0.5$ 处的位移。\n\n### 第 1 步：问题参数与解析解\n\n首先，我们从问题陈述中提取参数并推导解析解以供后续验证。\n- **几何与材料属性：** 杆长 $L=1$ m，杨氏模量 $E=200$ Pa，横截面积 $A=0.01$ m²。因此，$EA = 200 \\times 0.01 = 2$ N。\n- **边界条件：**\n    - 狄利克雷 (本质) 条件：在 $x=0$ 处，位移被指定为 $\\bar{u} = u(0) = 0.001$ m。\n    - 诺伊曼 (自然) 条件：在 $x=L=1$ 处，轴向应力被指定为 $\\bar{\\sigma} = \\sigma(L) = 20$ Pa。这对应一个大小为 $F = \\bar{\\sigma} A = 20 \\times 0.01 = 0.2$ N 的拉力。\n- **控制方程：** $\\frac{d}{dx}\\!\\left(EA\\,\\frac{du}{dx}\\right)=0$。由于 $EA$ 是常数，方程简化为 $\\frac{d^2u}{dx^2}=0$。\n- **解析解：** 上述方程的通解为 $u(x) = C_1 x + C_2$。\n    - 应用狄利克雷条件 $u(0)=0.001$，我们得到 $C_2 = 0.001$。\n    - 应用诺伊曼条件 $\\sigma(L) = E \\frac{du}{dx}|_{x=L} = E C_1 = 20$，我们得到 $C_1 = \\frac{20}{E} = \\frac{20}{200} = 0.1$。\n    - 因此，精确的解析解为 $u(x) = 0.1x + 0.001$。\n    - 在中点 $x=0.5$ 处的精确位移为 $u(0.5) = 0.1(0.5) + 0.001 = 0.051$ m。\n\n### 第 2 步：有限元离散化\n\n我们将杆离散为两个等长的线性有限元。\n- **节点：** 节点 1 在 $x=0$，节点 2 在 $x=0.5$，节点 3 在 $x=1$。\n- **单元：** 单元 1 连接节点 1 和 2，单元 2 连接节点 2 和 3。每个单元的长度为 $L_e = 0.5$ m。\n- **单元刚度矩阵：** 对于一维线性杆单元，单元刚度矩阵为 $k^{(e)} = \\frac{EA}{L_e} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\frac{2}{0.5} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\begin{pmatrix} 4  -4 \\\\ -4  4 \\end{pmatrix}$。\n- **全局刚度矩阵与力向量：** 组装两个单元的贡献，得到全局系统 $\\mathbf{K} \\mathbf{u} = \\mathbf{F}$：\n$$\n\\begin{pmatrix} 4  -4  0 \\\\ -4  8  -4 \\\\ 0  -4  4 \\end{pmatrix} \\begin{pmatrix} u_1 \\\\ u_2 \\\\ u_3 \\end{pmatrix} = \\begin{pmatrix} F_1 \\\\ F_2 \\\\ F_3 \\end{pmatrix}\n$$\n其中 $u_i$ 是节点 $i$ 的位移。外力只施加在节点 3 上，大小为 $F_3 = 0.2$ N。因此，力向量为 $\\mathbf{F} = \\begin{pmatrix} R_1 \\\\ 0 \\\\ 0.2 \\end{pmatrix}$，其中 $R_1$ 是在节点 1 处的未知反力。\n\n### 第 3 步：应用罚函数法\n\n我们将使用罚函数法来施加狄利克雷边界条件 $u_1 = \\bar{u} = 0.001$。\n- **罚参数：** 我们选择一个大的罚参数 $\\alpha$。根据题目要求，$\\alpha = 1000 \\times \\max(|K_{ij}|) = 1000 \\times 8 = 8000$。\n- **修改后的系统：** 罚函数法修改了与约束自由度（此处为第 1 个自由度）相关的刚度矩阵对角线项和力向量的对应项。\n    - $K_{11} \\to K_{11} + \\alpha = 4 + 8000 = 8004$\n    - $F_1 \\to F_1 + \\alpha \\bar{u} = 0 + 8000 \\times 0.001 = 8$\n- **待求解的线性系统：**\n$$\n\\begin{pmatrix} 8004  -4  0 \\\\ -4  8  -4 \\\\ 0  -4  4 \\end{pmatrix} \\begin{pmatrix} u_1 \\\\ u_2 \\\\ u_3 \\end{pmatrix} = \\begin{pmatrix} 8 \\\\ 0 \\\\ 0.2 \\end{pmatrix}\n$$\n\n### 第 4 步：求解系统\n\n我们求解上述 $3 \\times 3$ 系统。\n- 从第 3 行：$-4u_2 + 4u_3 = 0.2 \\implies u_3 = u_2 + 0.05$。\n- 从第 2 行：$-4u_1 + 8u_2 - 4u_3 = 0 \\implies -u_1 + 2u_2 - u_3 = 0$。代入 $u_3$ 的表达式：$-u_1 + 2u_2 - (u_2 + 0.05) = 0 \\implies u_2 = u_1 + 0.05$。\n- 从第 1 行：$8004u_1 - 4u_2 = 8$。代入 $u_2$ 的表达式：$8004u_1 - 4(u_1 + 0.05) = 8 \\implies 8000u_1 - 0.2 = 8 \\implies 8000u_1 = 8.2 \\implies u_1 = 0.001025$ m。\n- 最后，计算 $u_2$：$u_2 = u_1 + 0.05 = 0.001025 + 0.05 = 0.051025$ m。\n\n中点 $x=0.5$ 处的位移 $u_2$ 的计算结果为 $0.051025$ m，这与解析解 $0.051$ m 非常接近，验证了罚函数法的有效性。将结果四舍五入到四位有效数字为 $0.05103$ m。",
            "answer": "$$\\boxed{5.103 \\times 10^{-2}}$$"
        },
        {
            "introduction": "如果一个结构没有被固定，会发生什么？本练习  探讨了一个关键问题：在仅施加诺伊曼(Neumann)边界条件（即只施加载荷，不固定位置）的问题中出现的刚体模态。通过分析刚度矩阵的特性，你将理解为什么这类问题是“不适定”的，并动手实践几种标准的数值技术来施加最小约束，以消除刚体运动，确保获得唯一且具有物理意义的解。",
            "id": "3558482",
            "problem": "考虑一个承受小应变的静力二维线性弹性体，占据以米为单位的域 $\\Omega = [0,1] \\times [0,1]$，其边界为 $\\partial \\Omega$。假设材料是均质、各向同性的，并遵循平面应力条件下的线性弹性本构关系，其杨氏模量为 $E$，泊松比为 $\\nu$。设该物体的单位厚度为 $h=1$ 米。其控制方程由线性动量平衡和柯西应力-应变关系导出：平衡方程 $\\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{b} = \\mathbf{0}$ 在 $\\Omega$ 内成立（体力 $\\mathbf{b}=\\mathbf{0}$），运动学关系 $\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top})$，以及本构关系 $\\boldsymbol{\\sigma} = \\mathbf{D} \\, \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{D}$ 是各向同性平面应力弹性矩阵。在整个边界 $\\partial \\Omega$ 上，仅施加形式为 $\\boldsymbol{\\sigma} \\mathbf{n} = \\bar{\\mathbf{t}}$ 的诺伊曼边界条件，其中 $\\mathbf{n}$ 是外单位法向量，$\\bar{\\mathbf{t}}$ 是单位面积上给定的面力。为确保合力为零，使用静水压力荷载 $\\bar{\\mathbf{t}} = -p \\, \\mathbf{n}$，其中 $p$ 是以帕斯卡为单位的恒定压力，这在物理上对应于均匀的压缩压力。\n\n有限元法 (FEM) 近似采用线性的三节点常应变三角形 (CST) 单元构建。利用虚功原理，离散系统可写作 $\\mathbf{K} \\, \\mathbf{u} = \\mathbf{f}$，其中 $\\mathbf{K}$ 是由单元贡献 $\\mathbf{K}^{(e)} = h \\, A^{(e)} \\, \\mathbf{B}^{\\top} \\mathbf{D} \\, \\mathbf{B}$ 组装而成的全局对称刚度矩阵，$A^{(e)}$ 是单元面积，$\\mathbf{B}$ 是三角形单元的常应变-位移矩阵。荷载向量 $\\mathbf{f}$ 由边界边上的面力积分 $\\int_{\\Gamma_e} \\mathbf{N}^{\\top} \\bar{\\mathbf{t}} \\, ds$ 组装而成。对于均匀面力和线性形函数，该积分简化为每个长度为 $L_e$ 的边界边上的 $\\tfrac{L_e}{2} h \\, \\bar{\\mathbf{t}}$，由该边的两个节点平分。在仅有诺伊曼边界条件的情况下，刚度矩阵 $\\mathbf{K}$ 是半正定的，其零空间由刚体模态组成。在二维情况下，若无位移约束，刚体零空间的维度预计为 $3$（两个平动和一个平面内转动）。\n\n您的任务是编写一个程序，为具有均匀结构化三角剖分的单位正方形组装有限元刚度矩阵 $\\mathbf{K}$ 和边界荷载向量 $\\mathbf{f}$，然后研究在不同最小约束策略下刚体模态的消除情况。使用材料参数 $E = 210 \\times 10^9$ 帕斯卡和 $\\nu = 0.3$。每个方向上的网格分辨率为 $N_e = 4$ 个单元，形成一个结构化网格，其中每个正方形沿对角线分裂成三角形。在所有边界上施加静水压力 $p = 1 \\times 10^6$ 帕斯卡，使得在 $\\partial \\Omega$ 上有 $\\bar{\\mathbf{t}} = -p \\, \\mathbf{n}$。如果计算位移，请以米为单位表示。\n\n定义以下四个测试用例来研究离散算子的零空间：\n\n- 测试用例 1 (纯诺伊曼问题)：不施加任何位移约束。计算 $\\mathbf{K}$ 的近零奇异值数量，该数量解释为对应于刚体模态的零空间维度。\n\n- 测试用例 2 (最小约束，单节点)：在单个角节点上施加狄利克雷约束 $\\mathbf{u} = \\mathbf{0}$（固定该节点的两个分量）。计算通过消除受约束自由度所得到的降阶刚度矩阵的近零奇异值数量。\n\n- 测试用例 3 (最小约束，消除转动)：在同一角节点上施加狄利克雷约束 $\\mathbf{u} = \\mathbf{0}$，并额外约束第二个角节点的竖向位移为零。计算降阶刚度矩阵的近零奇异值数量。\n\n- 测试用例 4 (通过拉格朗日乘子施加平均约束)：在两个方向上施加零平均位移约束，即 $\\tfrac{1}{|\\Omega|}\\int_{\\Omega} u_x \\, d\\Omega = 0$ 和 $\\tfrac{1}{|\\Omega|}\\int_{\\Omega} u_y \\, d\\Omega = 0$，在离散系统中使用拉格朗日乘子。在实践中，这通过约束矩阵 $\\mathbf{C}$ 实现，使得增广系统为 $\\begin{bmatrix} \\mathbf{K}  \\mathbf{C}^{\\top} \\\\ \\mathbf{C}  \\mathbf{0} \\end{bmatrix} \\begin{bmatrix} \\mathbf{u} \\\\ \\boldsymbol{\\lambda} \\end{bmatrix} = \\begin{bmatrix} \\mathbf{f} \\\\ \\mathbf{0} \\end{bmatrix}$，其中 $\\mathbf{C}$ 的一行由对应所有 x-位移自由度位置上为1的元素构成，另一行则对应所有 y-位移自由度。计算此增广算子的近零奇异值数量。\n\n对于每个测试用例，通过计算算子（$\\mathbf{K}$、降阶 $\\mathbf{K}$ 或增广算子）的奇异值 $\\sigma_i$ 中满足 $\\sigma_i  \\varepsilon \\, \\max_j \\sigma_j$ （容差 $\\varepsilon = 10^{-9}$）的数量来估计零空间维度。在每种情况下，对相应的矩阵使用奇异值分解。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如, $[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是测试用例 $i$ 的近零奇异值的整数计数。此输出无单位。程序必须是自包含的，并且不得需要任何用户输入或外部文件。材料参数和荷载的数值必须与上面给出的完全一致，单位也如所述；最终输出纯粹是所描述的整数列表，无单位。",
            "solution": "用户提供了计算固体力学领域一个有效且适定的问题陈述。该问题具有科学依据，客观，并包含了进行求解所需的所有必要信息。任务是分析二维线性弹性体在不同约束策略下有限元刚度矩阵的零空间。\n\n求解过程如下：首先，我们为指定问题构建有限元法 (FEM) 模型。这包括生成网格、定义单元属性以及组装全局刚度矩阵 $\\mathbf{K}$。随后，我们通过操作或增广该矩阵来处理四个测试用例中的每一个，然后使用奇异值分解 (SVD) 确定其零空间的维度。\n\n**1. 有限元离散化**\n\n该问题涉及一个处于平面应力条件下的二维线性弹性体。其域为单位正方形 $\\Omega = [0,1] \\times [0,1]$。材料由杨氏模量 $E = 210 \\times 10^9 \\, \\text{Pa}$ 和泊松比 $\\nu = 0.3$ 定义。物体的单位厚度为 $h = 1 \\, \\text{m}$。\n\n应力向量 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^{\\top}$ 和应变向量 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, 2\\varepsilon_{xy}]^{\\top}$ 之间的本构关系由 $\\boldsymbol{\\sigma} = \\mathbf{D} \\boldsymbol{\\varepsilon}$ 给出。对于各向同性平面应力，弹性矩阵 $\\mathbf{D}$ 为：\n$$\n\\mathbf{D} = \\frac{E}{1 - \\nu^2}\n\\begin{bmatrix}\n1  \\nu  0 \\\\\n\\nu  1  0 \\\\\n0  0  \\frac{1 - \\nu}{2}\n\\end{bmatrix}\n$$\n\n该域使用线性的三节点常应变三角形 (CST) 单元的结构化网格进行离散化。网格每边有 $N_e = 4$ 个划分，从而形成一个 $(N_e+1) \\times (N_e+1) = 5 \\times 5 = 25$ 个节点的网格。$N_e^2 = 16$ 个正方形单元中的每一个都被划分为两个三角形，总共有 $32$ 个单元。总自由度 (DOFs) 数量为每个节点 $2$ 个（一个水平位移，一个竖向位移），总计 $2 \\times 25 = 50$ 个自由度。\n\n对于节点坐标为 $(x_1, y_1)$、$(x_2, y_2)$ 和 $(x_3, y_3)$ 的 CST 单元，应变-位移矩阵 $\\mathbf{B}$ 在单元内是恒定的，由下式给出：\n$$\n\\mathbf{B} = \\frac{1}{2A^{(e)}}\n\\begin{bmatrix}\ny_2-y_3  0  y_3-y_1  0  y_1-y_2  0 \\\\\n0  x_3-x_2  0  x_1-x_3  0  x_2-x_1 \\\\\nx_3-x_2  y_2-y_3  x_1-x_3  y_3-y_1  x_2-x_1  y_1-y_2\n\\end{bmatrix}\n$$\n其中 $A^{(e)}$ 是单元的面积。单元刚度矩阵 $\\mathbf{K}^{(e)}$ 是一个 $6 \\times 6$ 矩阵，通过在单元体积上对 $\\mathbf{B}^{\\top} \\mathbf{D} \\mathbf{B}$ 进行积分计算得出：\n$$\n\\mathbf{K}^{(e)} = h A^{(e)} \\mathbf{B}^{\\top} \\mathbf{D} \\mathbf{B}\n$$\n\n全局刚度矩阵 $\\mathbf{K}$（一个 $50 \\times 50$ 矩阵）是通过将所有 $32$ 个单元刚度矩阵 $\\mathbf{K}^{(e)}$ 的贡献累加到其对应的全局自由度位置上组装而成的。\n\n**2. 算子零空间分析**\n\n一个在整个边界上仅指定了诺伊曼边界条件的问题，在物理上可以自由进行刚体运动（平动和转动），而不会引起任何应变，因此也没有应力。这反映在全局刚度矩阵 $\\mathbf{K}$ 是奇异的（半正定的）。其零空间对应于这些刚体模态。对于二维问题，存在三种这样的模态：两个平动和一个平面内转动。\n\n为了数值上确定矩阵 $\\mathbf{M}$ 的零空间维度（即秩亏），我们使用其奇异值分解 (SVD)。为零的奇异值 $\\sigma_i$ 的数量对应于零度。由于有限精度算术，我们计算数值上接近于零的奇异值的数量。按照规定，如果一个奇异值 $\\sigma_i$ 满足 $\\sigma_i  \\varepsilon \\cdot \\max_j \\sigma_j$（容差为 $\\varepsilon = 10^{-9}$），则认为其是近零的。\n\n**3. 测试用例的实现**\n\n**测试用例 1：纯诺伊曼问题**\n不施加位移约束。要分析的算子是原始的全局刚度矩阵 $\\mathbf{K}$。我们预期找到对应于三个刚体模态的零度。\n$$\n\\text{Nullity}(\\mathbf{K}) = 3\n$$\n\n**测试用例 2：最小约束（单节点）**\n在单个角节点上施加位移约束 $\\mathbf{u} = \\mathbf{0}$，例如在 $(0,0)$ 处的节点。这对应于将前两个自由度（节点0处的 u_x 和 u_y）设置为零。这通过从全局矩阵 $\\mathbf{K}$ 中移除与这些自由度对应的行和列来实现，得到一个降阶矩阵 $\\mathbf{K}_{red}$。固定单个节点可以阻止两种平动模态。然而，物体仍然可以围绕该固定点旋转。因此，我们预期降阶系统会剩下一个刚体模态。\n$$\n\\text{Nullity}(\\mathbf{K}_{red}) = 1\n$$\n\n**测试用例 3：最小约束（消除转动）**\n除了像用例2中那样固定 $(0,0)$ 处的节点外，还约束第二个角节点（例如在 $(1,0)$ 处）的竖向位移为零。这三个约束的集合足以消除所有三个刚体模态：通过固定第一个节点消除了两个平动，而对第二个节点的最终约束阻止了任何围绕第一个节点的转动。由此产生的降阶矩阵 $\\mathbf{K}_{red}$ 应该是（正定）非奇异的。\n$$\n\\text{Nullity}(\\mathbf{K}_{red}) = 0\n$$\n\n**测试用例 4：通过拉格朗日乘子施加平均约束**\n此用例通过强制域上的平均位移为零来消除刚体平动，即 $\\int_{\\Omega} u_x d\\Omega = 0$ 和 $\\int_{\\Omega} u_y d\\Omega = 0$。在离散系统中，这由两个约束方程近似。根据问题描述，这些方程是 $\\sum u_{x,i} = 0$ 和 $\\sum u_{y,i} = 0$，其中求和遍历所有节点。这些约束通过使用拉格朗日乘子引入，从而得到增广的鞍点系统：\n$$\n\\begin{bmatrix} \\mathbf{K}  \\mathbf{C}^{\\top} \\\\ \\mathbf{C}  \\mathbf{0} \\end{bmatrix} \\begin{bmatrix} \\mathbf{u} \\\\ \\boldsymbol{\\lambda} \\end{bmatrix} = \\begin{bmatrix} \\mathbf{f} \\\\ \\mathbf{0} \\end{bmatrix}\n$$\n此处，$\\mathbf{C}$ 是一个 $2 \\times 50$ 的矩阵，其第一行在对应于 x-自由度的位置上为1，其余为0，第二行对 y-自由度做同样的处理。要分析的算子是增广矩阵 $\\mathbf{M} = \\begin{bmatrix} \\mathbf{K}  \\mathbf{C}^{\\top} \\\\ \\mathbf{C}  \\mathbf{0} \\end{bmatrix}$。这两个约束有效地消除了两个平动模态。转动模态不受此公式的约束，因为围绕物体几何中心的纯转动导致的净位移为零。因此，我们预期增广算子的零度为一。\n$$\n\\text{Nullity}(\\mathbf{M}) = 1\n$$\n\n以下程序实现了计算这四个用例中每种情况的零度的完整过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import svdvals\n\ndef solve():\n    \"\"\"\n    Solves the FEM problem for rigid-body mode analysis.\n    \"\"\"\n    \n    # Material and problem parameters\n    E = 210e9  # Young's modulus in Pa\n    nu = 0.3   # Poisson's ratio\n    h = 1.0    # Thickness in m\n    Ne = 4     # Number of elements per side\n    \n    # Derived parameters\n    n_nodes_per_side = Ne + 1\n    n_nodes = n_nodes_per_side**2\n    n_dofs = 2 * n_nodes\n    \n    # 1. Mesh Generation (Nodes and Elements)\n    nodes = np.zeros((n_nodes, 2))\n    for i in range(n_nodes_per_side):\n        for j in range(n_nodes_per_side):\n            node_idx = i * n_nodes_per_side + j\n            nodes[node_idx] = [j / Ne, i / Ne]\n\n    elements = []\n    for i in range(Ne):\n        for j in range(Ne):\n            n1 = i * n_nodes_per_side + j         # Bottom-left\n            n2 = i * n_nodes_per_side + j + 1     # Bottom-right\n            n3 = (i + 1) * n_nodes_per_side + j + 1 # Top-right\n            n4 = (i + 1) * n_nodes_per_side + j     # Top-left\n            # Split square cell along the n1-n3 diagonal\n            elements.append([n1, n2, n3])\n            elements.append([n1, n3, n4])\n    elements = np.array(elements)\n\n    # 2. FEM Assembly\n    # Plane stress constitutive matrix D\n    D_factor = E / (1 - nu**2)\n    D = D_factor * np.array([[1, nu, 0],\n                             [nu, 1, 0],\n                             [0, 0, (1 - nu) / 2]])\n\n    # Global stiffness matrix K\n    K = np.zeros((n_dofs, n_dofs))\n\n    for el_nodes in elements:\n        # Node coordinates for the element\n        x1, y1 = nodes[el_nodes[0]]\n        x2, y2 = nodes[el_nodes[1]]\n        x3, y3 = nodes[el_nodes[2]]\n\n        # Area of the element\n        A_e = 0.5 * np.abs(x1 * (y2 - y3) + x2 * (y3 - y1) + x3 * (y1 - y2))\n\n        # Strain-displacement matrix B\n        B = (1 / (2 * A_e)) * np.array([\n            [y2 - y3, 0, y3 - y1, 0, y1 - y2, 0],\n            [0, x3 - x2, 0, x1 - x3, 0, x2 - x1],\n            [x3 - x2, y2 - y3, x1 - x3, y3 - y1, x2 - x1, y1 - y2]\n        ])\n\n        # Element stiffness matrix Ke\n        Ke = h * A_e * (B.T @ D @ B)\n\n        # Assemble Ke into global K\n        dof_map = np.array([2 * n for n in el_nodes for _ in range(2)])\n        dof_map[1::2] += 1\n        \n        K[np.ix_(dof_map, dof_map)] += Ke\n\n    # 3. Nullspace Analysis for each Test Case\n    \n    def count_nullity(matrix, epsilon=1e-9):\n        \"\"\"\n        Calculates the nullity of a matrix by counting near-zero singular values.\n        \"\"\"\n        s = svdvals(matrix)\n        # svdvals returns sorted values, s[0] is the maximum\n        max_sv = s[0]\n        if np.isclose(max_sv, 0):\n            return matrix.shape[0]  # Zero matrix case\n        \n        tolerance = epsilon * max_sv\n        return np.sum(s  tolerance)\n\n    results = []\n\n    # Test Case 1: Pure Neumann problem\n    nullity1 = count_nullity(K)\n    results.append(nullity1)\n\n    # Test Case 2: Minimal constraints, single node fixed\n    all_dofs = np.arange(n_dofs)\n    # Fix node 0 at (0,0) -> DOFs 0 (u_x) and 1 (u_y)\n    constrained_dofs_2 = [0, 1]\n    free_dofs_2 = np.setdiff1d(all_dofs, constrained_dofs_2)\n    K_red_2 = K[np.ix_(free_dofs_2, free_dofs_2)]\n    nullity2 = count_nullity(K_red_2)\n    results.append(nullity2)\n\n    # Test Case 3: Minimal constraints, rotation removed\n    # Fix node 0 at (0,0) and u_y at node located at (1,0)\n    # Node at (1,0) corresponds to grid indices i=0, j=Ne. \n    # Node index = 0 * (Ne+1) + Ne = Ne\n    node_idx_for_rot_constraint = Ne\n    dof_for_rot_constraint = 2 * node_idx_for_rot_constraint + 1\n    \n    constrained_dofs_3 = [0, 1, dof_for_rot_constraint]\n    free_dofs_3 = np.setdiff1d(all_dofs, constrained_dofs_3)\n    K_red_3 = K[np.ix_(free_dofs_3, free_dofs_3)]\n    nullity3 = count_nullity(K_red_3)\n    results.append(nullity3)\n\n    # Test Case 4: Average constraints via Lagrange multipliers\n    C = np.zeros((2, n_dofs))\n    C[0, 0::2] = 1.0  # Constraint on sum of u_x\n    C[1, 1::2] = 1.0  # Constraint on sum of u_y\n\n    augmented_size = n_dofs + 2\n    M = np.zeros((augmented_size, augmented_size))\n    M[:n_dofs, :n_dofs] = K\n    M[:n_dofs, n_dofs:] = C.T\n    M[n_dofs:, :n_dofs] = C\n    \n    nullity4 = count_nullity(M)\n    results.append(nullity4)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}