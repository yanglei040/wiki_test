{
    "hands_on_practices": [
        {
            "introduction": "在有限元方法 (FEM) 中，计算单元矩阵（如质量矩阵和刚度矩阵）是核心步骤。这个练习  提供了一个具体的例子，展示了如何使用等参映射和高斯求积来精确计算一维线性单元的一致质量矩阵项。通过这个过程，你将亲身体验数值积分如何为多项式形函数得到精确解，这是连接理论与实际计算的关键一步。",
            "id": "3567628",
            "problem": "考虑一个用于计算固体力学中的有限元法 (FEM) 的一维、双节点、线性等参有限元，其物理坐标为 $x \\in [x_{1}, x_{2}]$，单元长度为 $h = x_{2} - x_{1} > 0$。设 $N_{1}(x)$ 和 $N_{2}(x)$ 表示线性拉格朗日形函数，它们在节点处精确插值一个标量场，并满足 $N_{1}(x_{1}) = 1$, $N_{1}(x_{2}) = 0$, $N_{2}(x_{1}) = 0$ 和 $N_{2}(x_{2}) = 1$。从参考坐标 $\\xi \\in [-1, 1]$ 到物理坐标 $x \\in [x_{1}, x_{2}]$ 的仿射等参映射用于将积分从物理域转换到参考域。使用参考区间 $[-1, 1]$ 上的标准两点高斯求积法则和仿射映射，精确计算一致质量矩阵项\n$$\nM_{11} = \\int_{x_{1}}^{x_{2}} N_{1}(x)^{2} \\, dx,\n$$\n并将您的最终答案表示为关于 $x_{1}$ 和 $x_{2}$ 的单个闭式解析表达式。最终表达式无需进行数值舍入，也不应包含任何物理单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n**步骤 1：提取已知条件**\n- 单元类型：一维、双节点、线性等参有限元。\n- 物理域：$x \\in [x_{1}, x_{2}]$。\n- 单元长度：$h = x_{2} - x_{1} > 0$。\n- 形函数：线性拉格朗日形函数 $N_{1}(x)$ 和 $N_{2}(x)$。\n- 节点条件：$N_{1}(x_{1}) = 1$, $N_{1}(x_{2}) = 0$, $N_{2}(x_{1}) = 0$ 和 $N_{2}(x_{2}) = 1$。\n- 参考域：$\\xi \\in [-1, 1]$。\n- 映射：从 $\\xi$ 到 $x$ 的仿射等参映射。\n- 积分方法：参考区间 $[-1, 1]$ 上的标准两点高斯求积法则。\n- 待计算量：一致质量矩阵项 $M_{11} = \\int_{x_{1}}^{x_{2}} N_{1}(x)^{2} \\, dx$。\n- 要求：计算必须精确。\n- 输出格式：关于 $x_{1}$ 和 $x_{2}$ 的单个闭式解析表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n1.  **科学依据**：该问题基于有限元法 (FEM) 的基本和标准原理，包括等参映射、形函数和高斯求积。这些是计算固体力学的核心概念。该问题在科学上是合理的。\n2.  **适定性**：该问题是适定的。它要求使用指定方法精确计算一个特定积分。一个潜在的问题可能是要求从数值求积法则得到“精确”结果。然而，一个两点高斯求积法则能精确积分最高 $2n-1 = 2(2)-1 = 3$ 次的多项式。被积函数转换到参考域后是 $(N_{1}(\\xi))^{2}J$，其中 $N_1(\\xi)$ 是 $\\xi$ 的线性函数，对于线性单元，雅可比 $J$ 是常数。因此，被积函数是关于 $\\xi$ 的二次多项式（2次），次数小于3。所以，两点高斯求积将得到积分的精确值，不存在矛盾。\n3.  **客观性**：该问题使用精确、客观和标准的数学与工程术语陈述。\n4.  **完整性**：所有必要的信息（单元类型、形函数性质、域、映射类型、积分法则）都已提供。该问题是自洽的。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整的解答。\n\n### 解答\n目标是使用等参映射和两点高斯求积法则计算一致质量矩阵项 $M_{11} = \\int_{x_{1}}^{x_{2}} N_{1}(x)^{2} \\, dx$。\n\n首先，我们在参考单元上定义线性拉格朗日形函数，该单元覆盖域 $\\xi \\in [-1, 1]$。对应于节点 $\\xi = -1$ 和 $\\xi = 1$ 的形函数是：\n$$\nN_{1}(\\xi) = \\frac{1 - \\xi}{2}\n$$\n$$\nN_{2}(\\xi) = \\frac{1 + \\xi}{2}\n$$\n这些函数满足所需性质：$N_{1}(-1) = 1$, $N_{1}(1) = 0$, $N_{2}(-1) = 0$ 和 $N_{2}(1) = 1$。\n\n等参映射使用这些相同的形函数，将物理坐标 $x$ 表示为参考坐标 $\\xi$ 的函数：\n$$\nx(\\xi) = N_{1}(\\xi)x_{1} + N_{2}(\\xi)x_{2} = \\frac{1 - \\xi}{2}x_{1} + \\frac{1 + \\xi}{2}x_{2}\n$$\n这是一个仿射映射。为了将积分从物理域转换到参考域，我们需要变换的雅可比 $J$：\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{d}{d\\xi} \\left( \\frac{x_{1} + x_{2}}{2} + \\xi \\frac{x_{2} - x_{1}}{2} \\right) = \\frac{x_{2} - x_{1}}{2}\n$$\n微分元变换为 $dx = J \\, d\\xi$。\n\n现在可以在参考坐标系中重写 $M_{11}$ 的积分。根据等参单元的定义，在点 $x(\\xi)$ 处求值的形函数 $N_{1}(x)$ 等价于参考形函数 $N_{1}(\\xi)$。\n$$\nM_{11} = \\int_{x_{1}}^{x_{2}} N_{1}(x)^{2} \\, dx = \\int_{-1}^{1} (N_{1}(x(\\xi)))^{2} J \\, d\\xi = \\int_{-1}^{1} (N_{1}(\\xi))^{2} J \\, d\\xi\n$$\n让我们将参考域中的被积函数定义为 $f(\\xi)$：\n$$\nf(\\xi) = (N_{1}(\\xi))^{2} J = \\left( \\frac{1 - \\xi}{2} \\right)^{2} \\left( \\frac{x_{2} - x_{1}}{2} \\right) = \\frac{x_{2} - x_{1}}{8} (1 - \\xi)^{2}\n$$\n这个被积函数是关于 $\\xi$ 的 2 次多项式。\n\n问题指定使用两点高斯求积法则来计算该积分。高斯求积的一般形式是：\n$$\n\\int_{-1}^{1} f(\\xi) \\, d\\xi \\approx \\sum_{i=1}^{n} w_{i} f(\\xi_{i})\n$$\n其中 $\\xi_i$ 是求积点（横坐标），$w_i$ 是相应的权重。对于 $n=2$，求积点和权重是：\n- 求积点：$\\xi_{1} = -\\frac{1}{\\sqrt{3}}$，$\\xi_{2} = \\frac{1}{\\sqrt{3}}$\n- 权重：$w_{1} = 1$，$w_{2} = 1$\n\n一个两点高斯法则对于次数最高为 $2n-1 = 2(2)-1 = 3$ 的多项式被积函数能提供精确结果。由于我们的被积函数 $f(\\xi)$ 是一个 2 次多项式，因此求积将是精确计算，而不是近似。\n$$\nM_{11} = \\sum_{i=1}^{2} w_{i} f(\\xi_{i}) = w_{1} f(\\xi_{1}) + w_{2} f(\\xi_{2})\n$$\n代入求积点和权重的值：\n$$\nM_{11} = (1) \\cdot f\\left(-\\frac{1}{\\sqrt{3}}\\right) + (1) \\cdot f\\left(\\frac{1}{\\sqrt{3}}\\right)\n$$\n现在我们在两个高斯点上计算函数 $f(\\xi)$ 的值：\n在 $\\xi_1 = -1/\\sqrt{3}$ 处：\n$$\nf\\left(-\\frac{1}{\\sqrt{3}}\\right) = \\frac{x_{2} - x_{1}}{8} \\left(1 - \\left(-\\frac{1}{\\sqrt{3}}\\right)\\right)^{2} = \\frac{x_{2} - x_{1}}{8} \\left(1 + \\frac{1}{\\sqrt{3}}\\right)^{2}\n$$\n在 $\\xi_2 = 1/\\sqrt{3}$ 处：\n$$\nf\\left(\\frac{1}{\\sqrt{3}}\\right) = \\frac{x_{2} - x_{1}}{8} \\left(1 - \\frac{1}{\\sqrt{3}}\\right)^{2}\n$$\n将这两项相加得到 $M_{11}$：\n$$\nM_{11} = \\frac{x_{2} - x_{1}}{8} \\left[ \\left(1 + \\frac{1}{\\sqrt{3}}\\right)^{2} + \\left(1 - \\frac{1}{\\sqrt{3}}\\right)^{2} \\right]\n$$\n让我们化简方括号中的表达式。使用恒等式 $(a+b)^{2} + (a-b)^{2} = 2(a^{2} + b^{2})$，其中 $a=1$，$b=1/\\sqrt{3}$：\n$$\n\\left(1 + \\frac{1}{\\sqrt{3}}\\right)^{2} + \\left(1 - \\frac{1}{\\sqrt{3}}\\right)^{2} = 2 \\left(1^{2} + \\left(\\frac{1}{\\sqrt{3}}\\right)^{2}\\right) = 2 \\left(1 + \\frac{1}{3}\\right) = 2 \\left(\\frac{4}{3}\\right) = \\frac{8}{3}\n$$\n将此结果代回到 $M_{11}$ 的表达式中：\n$$\nM_{11} = \\frac{x_{2} - x_{1}}{8} \\left( \\frac{8}{3} \\right)\n$$\n化简后得到：\n$$\nM_{11} = \\frac{x_{2} - x_{1}}{3}\n$$\n这就是质量矩阵项 $M_{11}$ 的精确值，表示为关于节点坐标 $x_1$ 和 $x_2$ 的闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{x_{2} - x_{1}}{3}}\n$$"
        },
        {
            "introduction": "从一维问题过渡到高维问题时，我们通常使用张量积法则来构建求积点。这个练习  旨在训练一项关键技能：如何为给定的被积函数选择保证精确积分所需的最少高斯点数，这对于计算效率至关重要。通过求解这个问题，你将加深对高斯求积“精确度”概念的理解，并学会如何将其应用于二维矩形区域。",
            "id": "3567549",
            "problem": "在计算固体力学中，对等参单元的积分通常被映射到参考域，并使用高斯求积法进行计算。考虑参考方形域 $\\Omega = [-1,1]\\times [-1,1]$ 和标量场 $f(x,y) = x^{3} y^{4}$。使用在 $\\Omega$ 上的张量积高斯-勒让德求积，完成以下任务：\n\n- 在 $x$ 方向上选择一个有 $n_{x}$ 个点的，在 $y$ 方向上选择一个有 $n_{y}$ 个点的张量积高斯-勒让德法则，该法则是最小的，其意义在于它基于高斯-勒让德求积的一维精确度阶性质，保证了对 $f(x,y)$ 的精确积分，而不依赖于 $f(x,y)$ 的任何偶然对称性。\n- 通过援引一维高斯-勒让德法则的精确度阶概念以及二维张量积的构造，证明您选择的 $(n_{x},n_{y})$ 是最小的。\n- 明确说明在每个方向上使用的一维求积节点和权重，构建张量积法则，并通过执行您所选法则隐含的有限求和来计算二重积分\n$$\nI \\;=\\; \\int_{-1}^{1} \\int_{-1}^{1} x^{3} y^{4} \\, dx \\, dy\n$$\n\n将 $I$ 的最终值以精确实数形式报告。不要在最终答案框中提供中间表达式。",
            "solution": "用户希望解决这个问题，因此我首先将进行一个初步验证。该问题是一个涉及高斯-勒让德求积的标准数值分析练习。它问题明确，科学上合理，并包含了所有必要的信息。其约束条件，例如找到一个不利用对称性的最小法则，是清晰的，并考验了基本理解。该问题被认为是有效的。\n\n该问题要求使用一个最小的张量积高斯-勒让德求积法则来计算二重积分\n$$\nI = \\int_{-1}^{1} \\int_{-1}^{1} x^{3} y^{4} \\, dx \\, dy\n$$\n该法则的选择必须基于精确度阶性质来保证精确性，而不是基于被积函数的偶然性质。\n\n在区间 $[-1, 1]$ 上的一个一维 $n$ 点高斯-勒让德求积法则可以精确地积分最高为 $2n-1$ 次的多项式。对于在域 $\\Omega = [-1,1]\\times [-1,1]$ 上，$x$ 方向有 $n_x$ 个点，$y$ 方向有 $n_y$ 个点的张量积法则，可分离函数 $f(x,y) = g(x)h(y)$ 的积分为\n$$\n\\int_{-1}^{1} \\int_{-1}^{1} g(x)h(y) \\, dx \\, dy = \\left( \\int_{-1}^{1} g(x) \\, dx \\right) \\left( \\int_{-1}^{1} h(y) \\, dy \\right)\n$$\n数值近似为\n$$\nI \\approx \\left( \\sum_{i=1}^{n_x} w_i^x g(x_i) \\right) \\left( \\sum_{j=1}^{n_y} w_j^y h(y_j) \\right)\n$$\n如果 $n_x$ 点法则对 $g(x)$ 是精确的，并且 $n_y$ 点法则对 $h(y)$ 是精确的，则此近似是精确的。\n\n在本问题中，被积函数为 $f(x,y) = x^3 y^4$。我们可以确定 $g(x) = x^3$ 和 $h(y) = y^4$。\n\n1.  **确定 $x$ 方向的最小法则 ($n_x$)：**\n    需要积分的函数是 $g(x) = x^3$，这是一个次数为 $d_x = 3$ 的多项式。为保证精确积分，求积法则的精确度阶必须至少为 $3$。因此，我们要求：\n    $$\n    2n_x - 1 \\ge 3\n    $$\n    $$\n    2n_x \\ge 4\n    $$\n    $$\n    n_x \\ge 2\n    $$\n    最小的整数点数为 $n_x=2$。尽管 $x^3$ 在 $[-1,1]$ 上的积分为零，并且以 $x=0$ 为中心的 $1$ 点法则会得到正确的结果，但这将是利用被积函数的奇对称性，而问题陈述明确禁止了这一点。*保证*对任何 $3$ 次多项式都精确的最小法则是 $2$ 点法则。\n\n2.  **确定 $y$ 方向的最小法则 ($n_y$)：**\n    需要积分的函数是 $h(y) = y^4$，这是一个次数为 $d_y = 4$ 的多项式。为保证精确积分，我们要求：\n    $$\n    2n_y - 1 \\ge 4\n    $$\n    $$\n    2n_y \\ge 5\n    $$\n    $$\n    n_y \\ge 2.5\n    $$\n    由于点数必须是整数，最小的点数为 $n_y=3$。\n\n因此，保证精确性的最小张量积求积法则是 $(n_x, n_y) = (2, 3)$ 点法则。\n\n接下来，我们陈述所选一维法则的节点和权重。\n\n**对于 $x$ 方向的 $2$ 点法则 ($n_x=2$)：**\n节点是 $2$ 次勒让德多项式 $P_2(x) = \\frac{1}{2}(3x^2-1)$ 的根。\n根为 $x_1 = -\\frac{1}{\\sqrt{3}}$ 和 $x_2 = \\frac{1}{\\sqrt{3}}$。\n相应的权重为 $w_1^x = 1$ 和 $w_2^x = 1$。\n所以，节点集为 {$x_1, x_2$} = $\\{-\\frac{1}{\\sqrt{3}}, \\frac{1}{\\sqrt{3}}\\}$，权重集为 {$w_1^x, w_2^x$} = $\\{1, 1\\}$。\n\n**对于 $y$ 方向的 $3$ 点法则 ($n_y=3$)：**\n节点是 $3$ 次勒让德多项式 $P_3(y) = \\frac{1}{2}(5y^3-3y)$ 的根。\n根为 $y_1 = -\\sqrt{\\frac{3}{5}}$，$y_2 = 0$ 和 $y_3 = \\sqrt{\\frac{3}{5}}$。\n相应的权重为 $w_1^y = \\frac{5}{9}$，$w_2^y = \\frac{8}{9}$ 和 $w_3^y = \\frac{5}{9}$。\n所以，节点集为 {$y_1, y_2, y_3$} = $\\{-\\sqrt{\\frac{3}{5}}, 0, \\sqrt{\\frac{3}{5}}\\}$，权重集为 {$w_1^y, w_2^y, w_3^y$} = $\\{\\frac{5}{9}, \\frac{8}{9}, \\frac{5}{9}\\}$。\n\n最后，我们通过应用张量积法则来计算积分。该积分通过以下求和精确计算：\n$$\nI = \\sum_{i=1}^{2} \\sum_{j=1}^{3} w_i^x w_j^y f(x_i, y_j) = \\sum_{i=1}^{2} \\sum_{j=1}^{3} w_i^x w_j^y (x_i^3 y_j^4)\n$$\n由于被积函数和求和的可分离性，我们可以将其写成两个独立求和的乘积：\n$$\nI = \\left( \\sum_{i=1}^{2} w_i^x x_i^3 \\right) \\left( \\sum_{j=1}^{3} w_j^y y_j^4 \\right)\n$$\n让我们分别计算每个求和。\n\n$x$ 方向的求和为：\n$$\n\\sum_{i=1}^{2} w_i^x x_i^3 = w_1^x x_1^3 + w_2^x x_2^3 = (1)\\left(-\\frac{1}{\\sqrt{3}}\\right)^3 + (1)\\left(\\frac{1}{\\sqrt{3}}\\right)^3 = -\\frac{1}{3\\sqrt{3}} + \\frac{1}{3\\sqrt{3}} = 0\n$$\n\n$y$ 方向的求和为：\n$$\n\\sum_{j=1}^{3} w_j^y y_j^4 = w_1^y y_1^4 + w_2^y y_2^4 + w_3^y y_3^4\n$$\n$$\n= \\left(\\frac{5}{9}\\right) \\left(-\\sqrt{\\frac{3}{5}}\\right)^4 + \\left(\\frac{8}{9}\\right) (0)^4 + \\left(\\frac{5}{9}\\right) \\left(\\sqrt{\\frac{3}{5}}\\right)^4\n$$\n$$\n= \\left(\\frac{5}{9}\\right) \\left(\\frac{3}{5}\\right)^2 + 0 + \\left(\\frac{5}{9}\\right) \\left(\\frac{3}{5}\\right)^2 = \\left(\\frac{5}{9}\\right) \\left(\\frac{9}{25}\\right) + \\left(\\frac{5}{9}\\right) \\left(\\frac{9}{25}\\right)\n$$\n$$\n= \\frac{5}{25} + \\frac{5}{25} = \\frac{1}{5} + \\frac{1}{5} = \\frac{2}{5}\n$$\n（这与解析积分 $\\int_{-1}^{1} y^4 dy = [\\frac{y^5}{5}]_{-1}^{1} = \\frac{1}{5} - (-\\frac{1}{5}) = \\frac{2}{5}$ 的结果相符，符合预期）。\n\n综合结果，积分 $I$ 的值为：\n$$\nI = (0) \\times \\left(\\frac{2}{5}\\right) = 0\n$$\n积分值恰好为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在实际工程问题中，选择求积方案不仅关乎精度和效率，还会深刻影响单元的力学行为。这个编程练习  探讨了一个经典的权衡：完全积分可能导致“剪切自锁”现象，而减缩积分虽然计算成本更低且能避免自锁，却可能引入不稳定的“沙漏模式”。通过完成这个任务，你将模拟一个真实的计算力学分析过程，理解不同积分方案的优劣，并学会如何通过沙漏控制等技术来获得可靠的数值解。",
            "id": "3567617",
            "problem": "您必须编写一个完整、可运行的程序，该程序使用有限元法 (FEM) 四边形单元，在两种数值积分方案下计算并比较二维、小应变、线弹性弯曲主导的斑块检验的应变能精度。这两种方案分别是：完全 $2\\times 2$ Gauss-Legendre 积分和带有沙漏稳定的减缩 $1\\times 1$ Gauss-Legendre 积分。该比较必须表示为相对于为指定的纯弯曲位移场解析推导的应变能的相对误差。所有内部物理计算必须使用国际单位制 (SI)。最终输出为无量纲小数（无单位）。程序必须生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。\n\n域是 $x$-$y$ 平面内的一个矩形板，沿 $x$ 方向的长度为 $L$，沿 $y$ 方向的高度为 $H$。该板在面外方向（$z$ 方向）的厚度为 $t$。假设平面应力条件、小应变和线弹性，杨氏模量为 $E$，泊松比为 $\\nu$。该板使用 $N_x\\times N_y$ 个双线性四节点四边形单元进行离散化（每个单元都是与坐标轴对齐的矩形）。节点排列在覆盖矩形 $[0,L]\\times[-H/2,H/2]$ 的结构化网格上，采用标准的单元局部节点排序：节点 1 左下，节点 2 右下，节点 3 右上，节点 4 左上。\n\n指定一个纯弯曲位移场，旨在表示曲率为 $\\kappa$ 的绕 $z$ 轴的 Euler-Bernoulli 型弯曲：\n- $u_x(x,y) = -\\kappa x y$，\n- $u_y(x,y) = \\frac{1}{2}\\kappa x^2$。\n根据小应变运动学，该位移引起的精确应变场主要由 $ \\varepsilon_{xx}(x,y)=\\frac{\\partial u_x}{\\partial x}=-\\kappa y$ 决定，其中 $ \\varepsilon_{yy}(x,y)=\\frac{\\partial u_y}{\\partial y}=0$ 且 $ \\varepsilon_{xy}(x,y)=\\frac{1}{2}\\left(\\frac{\\partial u_x}{\\partial y}+\\frac{\\partial u_y}{\\partial x}\\right)=0$。对于平面应力，本构律为 $ \\boldsymbol{\\sigma}=\\mathbf{D}\\boldsymbol{\\varepsilon}$，其中在 Voigt 标记法中，$ \\boldsymbol{\\varepsilon}=[\\varepsilon_{xx},\\varepsilon_{yy},\\gamma_{xy}]^T$，且 $ \\gamma_{xy}=2\\varepsilon_{xy}$ 和\n$$\n\\mathbf{D}=\\begin{bmatrix}\n\\frac{E}{1-\\nu^2} & \\frac{\\nu E}{1-\\nu^2} & 0 \\\\\n\\frac{\\nu E}{1-\\nu^2} & \\frac{E}{1-\\nu^2} & 0 \\\\\n0 & 0 & \\frac{E}{2(1+\\nu)}\n\\end{bmatrix}.\n$$\n\n在母单元正方形 $(-1\\le \\xi \\le 1, -1\\le \\eta \\le 1)$ 上，双线性四边形单元的形函数是标准的双线性函数 $N_i(\\xi,\\eta)$，其中 $i=1,\\dots,4$。从 $(\\xi,\\eta)$ 到 $(x,y)$ 的等参映射使用单元的节点坐标进行双线性插值，应变-位移矩阵 $\\mathbf{B}$ 通过对形函数求导并将导数通过雅可比矩阵 $\\mathbf{J}$ 映射到物理坐标来获得。您必须使用 Gauss-Legendre 求积法：\n- 在一维中，1 点法则的横坐标在 $0$ 处，权重为 $2$；2 点法则的横坐标在 $\\pm 1/\\sqrt{3}$ 处，权重为 $1$。\n- 在二维中，通过一维法则的张量积构成。对于 $2\\times 2$，四个点是 $(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3})$，权重为单位值；对于 $1\\times 1$，单点是 $(0,0)$，权重为 $4$。\n\n将应变能定义为\n$$\nU=\\frac{1}{2}\\int_{\\Omega} \\boldsymbol{\\varepsilon}^T \\mathbf{D}\\,\\boldsymbol{\\varepsilon}\\, \\mathrm{d}\\Omega,\n$$\n其中 $ \\Omega$ 是三维体积。在平面应力且厚度 $t$ 恒定的情况下，这简化为一个乘以 $t$ 的二维面积分。必须通过直接在矩形域上使用精确应变场对能量密度进行积分，从第一性原理推导出指定弯曲场的精确解析能量。以焦耳为单位表示精确应变能。\n\n对于减缩 $1\\times 1$ 积分，需用沙漏稳定能在单元级别增强计算出的应变能，以控制双线性四边形单元中减缩积分典型的伪零能模式。为每个单元定义面积 $A$ 和特征长度 $\\ell=\\sqrt{A}$。设单元节点位移向量为 $ \\mathbf{d}_e=[u_{1x},u_{1y},u_{2x},u_{2y},u_{3x},u_{3y},u_{4x},u_{4y}]^T$。定义四个沙漏坐标：\n- $q_{1x}=u_{1x}-u_{2x}+u_{3x}-u_{4x}$，\n- $q_{2x}=u_{1x}+u_{2x}-u_{3x}-u_{4x}$，\n- $q_{1y}=u_{1y}-u_{2y}+u_{3y}-u_{4y}$，\n- $q_{2y}=u_{1y}+u_{2y}-u_{3y}-u_{4y}$。\n设剪切模量为 $ G=\\frac{E}{2(1+\\nu)}$。单元沙漏稳定能为\n$$\nU_{\\mathrm{hg}}=\\frac{1}{2}\\,c_{\\mathrm{hg}}\\,G\\,t\\,A\\,\\frac{q_{1x}^2+q_{2x}^2+q_{1y}^2+q_{2y}^2}{\\ell^2},\n$$\n其中 $ c_{\\mathrm{hg}}$ 是一个无量纲的稳定系数。使用 $ c_{\\mathrm{hg}}=0.1$。\n\n您的程序必须：\n- 构建结构化网格，并根据指定的弯曲场评估节点位移。\n- 通过组装单元贡献来计算总应变能，使用：\n  - 无需稳定的完全 $2\\times 2$ Gauss-Legendre 求积。\n  - 在 $(\\xi,\\eta)=(0,0)$ 处使用权重为 $4$ 的减缩 $1\\times 1$ Gauss-Legendre 求积，并加上每个单元的沙漏稳定能 $ U_{\\mathrm{hg}}$。\n- 根据上述精确应变场定义，计算域的精确解析应变能。\n- 报告每种积分方案的相对误差，如下所示\n$$\n\\varepsilon_{\\mathrm{full}}=\\frac{U_{\\mathrm{full}}-U_{\\mathrm{exact}}}{U_{\\mathrm{exact}}},\\qquad\n\\varepsilon_{\\mathrm{red}}=\\frac{U_{\\mathrm{red+hg}}-U_{\\mathrm{exact}}}{U_{\\mathrm{exact}}}.\n$$\n\n使用以下参数值测试套件（均为国际单位制单位）：\n- 情况 1（正常情况）：$E=70\\times 10^{9}$，$\\nu=0.25$，$L=1.0$，$H=0.2$，$t=0.01$，$\\kappa=5.0$，$N_x=4$，$N_y=2$。\n- 情况 2（粗网格边缘情况）：$E=210\\times 10^{9}$，$\\nu=0.3$，$L=1.0$，$H=0.2$，$t=0.01$，$\\kappa=5.0$，$N_x=1$，$N_y=1$。\n- 情况 3（细长弯曲主导）：$E=210\\times 10^{9}$，$\\nu=0.3$，$L=2.0$，$H=0.05$，$t=0.005$，$\\kappa=10.0$，$N_x=8$，$N_y=1$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 $[\\varepsilon_{\\mathrm{full},1},\\varepsilon_{\\mathrm{red},1},\\varepsilon_{\\mathrm{full},2},\\varepsilon_{\\mathrm{red},2},\\varepsilon_{\\mathrm{full},3},\\varepsilon_{\\mathrm{red},3}]$，其中下标表示情况编号。每个条目必须是一个十进制数。",
            "solution": "用户希望评估两种有限元积分方案在纯弯曲载荷下对平面应力四边形单元的精度。评估是通过将数值计算的应变能与精确的解析解进行比较来执行的。这两种方案是完全 $2 \\times 2$ Gauss-Legendre 求积和带有沙漏稳定的减缩 $1 \\times 1$ Gauss-Legendre 求积。\n\n### 步骤 1：解析应变能 ($U_{\\mathrm{exact}}$)\n\n问题定义了一个纯弯曲位移场：\n- $u_x(x,y) = -\\kappa x y$\n- $u_y(x,y) = \\frac{1}{2}\\kappa x^2$\n\n相应的小应变张量分量为：\n- $\\varepsilon_{xx} = \\frac{\\partial u_x}{\\partial x} = -\\kappa y$\n- $\\varepsilon_{yy} = \\frac{\\partial u_y}{\\partial y} = 0$\n- $\\gamma_{xy} = 2\\varepsilon_{xy} = \\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x} = (-\\kappa x) + (\\kappa x) = 0$\n\n在平面应力的 Voigt 标记法中，应变向量为 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T = [-\\kappa y, 0, 0]^T$。材料本构矩阵 $\\mathbf{D}$ 由下式给出：\n$$\n\\mathbf{D}=\\frac{E}{1-\\nu^2}\\begin{bmatrix}\n1 & \\nu & 0 \\\\\n\\nu & 1 & 0 \\\\\n0 & 0 & \\frac{1-\\nu}{2}\n\\end{bmatrix}\n$$\n应变能密度 $W$ 计算为 $W = \\frac{1}{2}\\boldsymbol{\\varepsilon}^T \\mathbf{D} \\boldsymbol{\\varepsilon}$。\n$$\nW = \\frac{1}{2} \\begin{bmatrix} -\\kappa y & 0 & 0 \\end{bmatrix} \\left( \\frac{E}{1-\\nu^2}\\begin{bmatrix}\n1 & \\nu & 0 \\\\\n\\nu & 1 & 0 \\\\\n0 & 0 & \\frac{1-\\nu}{2}\n\\end{bmatrix} \\right) \\begin{bmatrix} -\\kappa y \\\\ 0 \\\\ 0 \\end{bmatrix} = \\frac{1}{2} \\frac{E \\kappa^2 y^2}{1-\\nu^2}\n$$\n总精确应变能 $U_{\\mathrm{exact}}$ 是能量密度在板的体积 $\\Omega = [0,L] \\times [-H/2, H/2] \\times [0, t]$ 上的积分。\n$$\nU_{\\mathrm{exact}} = \\int_{\\Omega} W \\, d\\Omega = t \\int_{0}^{L} \\int_{-H/2}^{H/2} \\frac{1}{2} \\frac{E \\kappa^2 y^2}{1-\\nu^2} \\, dy \\, dx\n$$\n$$\nU_{\\mathrm{exact}} = \\frac{t E \\kappa^2}{2(1-\\nu^2)} \\int_{0}^{L} \\left[ \\frac{y^3}{3} \\right]_{-H/2}^{H/2} \\, dx = \\frac{t E \\kappa^2}{2(1-\\nu^2)} \\int_{0}^{L} \\frac{H^3}{12} \\, dx\n$$\n$$\nU_{\\mathrm{exact}} = \\frac{t E \\kappa^2 H^3}{24(1-\\nu^2)} [x]_0^L = \\frac{E \\kappa^2 L H^3 t}{24(1-\\nu^2)}\n$$\n这是应变能的解析参考值，单位为焦耳。\n\n### 步骤 2：有限元公式\n\n域被离散化为一个由 $N_x \\times N_y$ 个矩形双线性四边形单元组成的结构化网格。对每个单元，数值计算其应变能并求和。\n\n**单元公式：**\n使用标准的四节点等参四边形单元。对于一个宽度为 $h_x$、高度为 $h_y$ 的矩形单元，从母坐标 $(\\xi, \\eta) \\in [-1, 1]\\times[-1, 1]$ 到物理坐标 $(x,y)$ 的映射是线性的，并且该变换的雅可比矩阵是常数对角矩阵：\n$$ \\mathbf{J} = \\begin{bmatrix} h_x/2 & 0 \\\\ 0 & h_y/2 \\end{bmatrix}, \\quad \\det(\\mathbf{J}) = \\frac{h_x h_y}{4} = \\frac{A_e}{4} $$\n其中 $A_e$ 是单元面积。应变-位移矩阵 $\\mathbf{B}(\\xi, \\eta)$ 将单元的节点位移 $\\mathbf{d}_e$ 与单元内任意点 $(\\xi, \\eta)$ 处的应变联系起来：$\\boldsymbol{\\varepsilon}(\\xi, \\eta) = \\mathbf{B}(\\xi, \\eta) \\mathbf{d}_e$。矩阵 $\\mathbf{B}$ 是由形函数 $N_i$ 的导数推导出来的。\n\n**单元应变能计算：**\n单元的应变能 $U_e$ 通过数值求积计算：\n$$ U_e = \\int_{A_e} \\frac{t}{2} \\boldsymbol{\\varepsilon}^T \\mathbf{D} \\boldsymbol{\\varepsilon} \\, dA = \\frac{t}{2} \\int_{-1}^1 \\int_{-1}^1 (\\mathbf{B}\\mathbf{d}_e)^T \\mathbf{D} (\\mathbf{B}\\mathbf{d}_e) \\det(\\mathbf{J}) \\, d\\xi d\\eta $$\n$$ U_e = \\frac{t}{2} \\sum_{p=1}^{N_{gp}} (\\mathbf{B}(\\xi_p, \\eta_p)\\mathbf{d}_e)^T \\mathbf{D} (\\mathbf{B}(\\xi_p, \\eta_p)\\mathbf{d}_e) \\det(\\mathbf{J}) w_p $$\n其中 $(\\xi_p, \\eta_p)$ 是 Gauss 点坐标，$w_p$ 是相应的权重。\n\n**完全积分 ($2\\times 2$)：**\n此方案使用位于 $(\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ 的四个 Gauss 点，每个点的权重为 $w_p=1$。此规则可以在每个坐标方向上精确积分最高 3 次的多项式。双线性单元公式可能导致伪剪切应变 $\\gamma_{xy}$，该应变在 $\\xi$ 中是线性的。这种现象，即剪切锁定，被 $2 \\times 2$ 积分规则捕捉到，导致人为的刚性响应和对应变能的过高估计。\n\n**减缩积分 ($1\\times 1$)：**\n此方案在单元中心 $(\\xi, \\eta)=(0,0)$ 使用单个 Gauss 点，权重为 $w_p=4$。在这个特定点，矩形单元在纯弯曲下的伪剪切应变为零。因此，减缩积分避免了剪切锁定。然而，它可能无法检测到某些称为沙漏模式（零能模式）的变形模式，使得单元过于灵活，并可能导致数值不稳定。\n\n### 步骤 3：沙漏稳定\n\n为了抵消减缩积分的伪柔度，在单元的应变能上增加一个稳定能 $U_{\\mathrm{hg}}$。该能量惩罚沙漏模式。对于每个单元，节点位移 $\\mathbf{d}_e$ 用于计算沙漏坐标 $q$。\n- $q_{1x}=u_{1x}-u_{2x}+u_{3x}-u_{4x}$\n- $q_{2x}=u_{1x}+u_{2x}-u_{3x}-u_{4x}$\n- $q_{1y}=u_{1y}-u_{2y}+u_{3y}-u_{4y}$\n- $q_{2y}=u_{1y}+u_{2y}-u_{3y}-u_{4y}$\n\n这些仅在单个 Gauss 点无法“看到”的非物理、振荡位移模式下才非零。单元的稳定能为：\n$$ U_{\\mathrm{hg}} = \\frac{1}{2}\\,c_{\\mathrm{hg}}\\,G\\,t\\,A\\,\\frac{q_{1x}^2+q_{2x}^2+q_{1y}^2+q_{2y}^2}{\\ell^2} $$\n当 $c_{\\mathrm{hg}}=0.1$，$\\ell^2=A$ 且 $G=\\frac{E}{2(1+\\nu)}$ 时，这简化为：\n$$ U_{\\mathrm{hg}} = \\frac{1}{2}\\,c_{\\mathrm{hg}}\\,G\\,t\\,(q_{1x}^2+q_{2x}^2+q_{1y}^2+q_{2y}^2) $$\n减缩积分方案的总应变能为 $U_{\\mathrm{red+hg}} = \\sum_e (U_{e, \\mathrm{red}} + U_{e, \\mathrm{hg}})$。\n\n### 步骤 4：实现算法\n\n程序将对每个测试用例执行以下步骤：\n1.  使用推导的公式计算精确的解析应变能 $U_{\\mathrm{exact}}$。\n2.  生成网格：为 $N_x \\times N_y$ 网格定义节点坐标和单元连接性。\n3.  在每个节点处评估指定的位移场 $(u_x, u_y)$ 以获得全局位移向量。\n4.  初始化总能量 $U_{\\mathrm{full}} = 0$ 和 $U_{\\mathrm{red+hg}} = 0$。\n5.  遍历网格中的每个单元：\n    a. 提取单元的节点位移 $\\mathbf{d}_e$。\n    b. 使用 $2 \\times 2$ Gauss 规则计算单元应变能 $U_{e, \\mathrm{full}}$，并将其加到 $U_{\\mathrm{full}}$。\n    c. 使用 $1 \\times 1$ Gauss 规则计算单元应变能 $U_{e, \\mathrm{red}}$。\n    d. 计算单元的沙漏稳定能 $U_{e, \\mathrm{hg}}$。\n    e. 将总和 $(U_{e, \\mathrm{red}} + U_{e, \\mathrm{hg}})$ 加到 $U_{\\mathrm{red+hg}}$。\n6.  计算最终的相对误差 $\\varepsilon_{\\mathrm{full}} = (U_{\\mathrm{full}}-U_{\\mathrm{exact}})/U_{\\mathrm{exact}}$ 和 $\\varepsilon_{\\mathrm{red}} = (U_{\\mathrm{red+hg}}-U_{\\mathrm{exact}})/U_{\\mathrm{exact}}$。\n7.  存储结果并将其格式化为最终输出。\n\n此过程在以下 Python 代码中实现。",
            "answer": "```python\nimport numpy as np\n\ndef get_B_matrix(xi, eta, hx, hy):\n    \"\"\"\n    Computes the strain-displacement matrix (B-matrix) for a 4-node\n    quadrilateral element at a specific point (xi, eta) in the parent domain.\n    Assumes a rectangular element aligned with the coordinate axes.\n    Node ordering is counter-clockwise: BL, BR, TR, TL.\n    \"\"\"\n    # Derivatives of bilinear shape functions w.r.t. parent coordinates (xi, eta)\n    # N1 = 0.25 * (1-xi)*(1-eta)\n    # N2 = 0.25 * (1+xi)*(1-eta)\n    # N3 = 0.25 * (1+xi)*(1+eta)\n    # N4 = 0.25 * (1-xi)*(1+eta)\n    \n    dNdxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n    dNdeta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n    \n    # Using inverse of Jacobian for a rectangular element to find derivatives w.r.t (x,y)\n    # J_inv = [[2/hx, 0], [0, 2/hy]]\n    dNdx = dNdxi * (2.0 / hx)\n    dNdy = dNdeta * (2.0 / hy)\n    \n    B = np.zeros((3, 8))\n    for i in range(4):\n        B[0, 2 * i] = dNdx[i]\n        B[1, 2 * i + 1] = dNdy[i]\n        B[2, 2 * i] = dNdy[i]\n        B[2, 2 * i + 1] = dNdx[i]\n        \n    return B\n\ndef compute_element_energy(elem_disp, hx, hy, t, D):\n    \"\"\"\n    Computes strain energy for one element using both full (2x2) and reduced (1x1)\n    Gauss-Legendre quadrature.\n    \"\"\"\n    # Full 2x2 Gauss quadrature\n    U_full = 0.0\n    gp_pos = 1.0 / np.sqrt(3.0)\n    gp_coords = [(-gp_pos, -gp_pos), (gp_pos, -gp_pos),\n                 (gp_pos, gp_pos), (-gp_pos, gp_pos)]\n    gp_weights = [1.0, 1.0, 1.0, 1.0]\n    \n    detJ = hx * hy / 4.0\n\n    for i in range(4):\n        xi, eta = gp_coords[i]\n        w = gp_weights[i]\n        B = get_B_matrix(xi, eta, hx, hy)\n        strain = B @ elem_disp\n        # Energy = 0.5 * integral(strain^T * D * strain * t) dArea\n        U_full += 0.5 * (strain.T @ D @ strain) * detJ * w * t\n\n    # Reduced 1x1 Gauss quadrature\n    xi_red, eta_red = 0.0, 0.0\n    w_red = 4.0\n    B_center = get_B_matrix(xi_red, eta_red, hx, hy)\n    strain_center = B_center @ elem_disp\n    U_red = 0.5 * (strain_center.T @ D @ strain_center) * detJ * w_red * t\n    \n    return U_full, U_red\n\ndef compute_hourglass_energy(elem_disp, hx, hy, t, E, nu, c_hg):\n    \"\"\"\n    Computes hourglass stabilization energy for one element.\n    \"\"\"\n    # Extract x and y components of nodal displacements\n    u_disp = elem_disp[0::2] # [u1x, u2x, u3x, u4x]\n    v_disp = elem_disp[1::2] # [u1y, u2y, u3y, u4y]\n    \n    # Hourglass vectors\n    h1_vec = np.array([1.0, -1.0, 1.0, -1.0])\n    h2_vec = np.array([1.0, 1.0, -1.0, -1.0])\n\n    # Hourglass coordinates\n    q1x = h1_vec @ u_disp\n    q2x = h2_vec @ u_disp\n    q1y = h1_vec @ v_disp\n    q2y = h2_vec @ v_disp\n    \n    G = E / (2.0 * (1.0 + nu))\n    A_e = hx * hy\n    # From problem: characteristic length squared ell^2 = A, so A/ell^2 = 1.\n    U_hg = 0.5 * c_hg * G * t * (q1x**2 + q2x**2 + q1y**2 + q2y**2)\n    \n    return U_hg\n\ndef solve():\n    test_cases = [\n        # (E, nu, L, H, t, kappa, Nx, Ny) in SI units\n        (70e9, 0.25, 1.0, 0.2, 0.01, 5.0, 4, 2),\n        (210e9, 0.3, 1.0, 0.2, 0.01, 5.0, 1, 1),\n        (210e9, 0.3, 2.0, 0.05, 0.005, 10.0, 8, 1)\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        E, nu, L, H, t, kappa, Nx, Ny = case\n        \n        # 1. Analytical strain energy\n        U_exact = (E * kappa**2 * L * H**3 * t) / (24.0 * (1.0 - nu**2))\n        \n        # 2. Material constitutive matrix for plane stress\n        D_factor = E / (1.0 - nu**2)\n        D = D_factor * np.array([[1.0, nu, 0.0],\n                                 [nu, 1.0, 0.0],\n                                 [0.0, 0.0, (1.0 - nu) / 2.0]])\n\n        # 3. Mesh generation\n        hx = L / Nx\n        hy = H / Ny\n        \n        num_nodes_x = Nx + 1\n        num_nodes_y = Ny + 1\n        num_nodes = num_nodes_x * num_nodes_y\n        \n        node_coords = np.zeros((num_nodes, 2))\n        for j in range(num_nodes_y):\n            for i in range(num_nodes_x):\n                node_id = j * num_nodes_x + i\n                node_coords[node_id, 0] = i * hx\n                node_coords[node_id, 1] = j * hy - H / 2.0\n                \n        elements = []\n        for j in range(Ny):\n            for i in range(Nx):\n                n1 = j * num_nodes_x + i       # Bottom-left\n                n2 = j * num_nodes_x + (i + 1) # Bottom-right\n                n3 = (j + 1) * num_nodes_x + (i + 1) # Top-right\n                n4 = (j + 1) * num_nodes_x + i # Top-left\n                elements.append([n1, n2, n3, n4])\n\n        # 4. Prescribed nodal displacements\n        nodal_disps = np.zeros((num_nodes, 2))\n        for i in range(num_nodes):\n            x, y = node_coords[i, 0], node_coords[i, 1]\n            nodal_disps[i, 0] = -kappa * x * y\n            nodal_disps[i, 1] = 0.5 * kappa * x**2\n\n        # 5. FEM strain energy computation by summing over elements\n        U_full_total = 0.0\n        U_red_hg_total = 0.0\n        c_hg = 0.1\n        \n        for elem_nodes in elements:\n            # Assemble element displacement vector [u1x, u1y, u2x, u2y, ...]\n            elem_disp_vec = np.zeros(8)\n            for i, node_id in enumerate(elem_nodes):\n                elem_disp_vec[2 * i] = nodal_disps[node_id, 0]\n                elem_disp_vec[2 * i + 1] = nodal_disps[node_id, 1]\n\n            # Compute element energies\n            U_elem_full, U_elem_red = compute_element_energy(elem_disp_vec, hx, hy, t, D)\n            U_elem_hg = compute_hourglass_energy(elem_disp_vec, hx, hy, t, E, nu, c_hg)\n            \n            # Accumulate total energies\n            U_full_total += U_elem_full\n            U_red_hg_total += U_elem_red + U_elem_hg\n\n        # 6. Compute relative errors\n        eps_full = (U_full_total - U_exact) / U_exact\n        eps_red = (U_red_hg_total - U_exact) / U_exact\n        \n        results.append(eps_full)\n        results.append(eps_red)\n        \n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}