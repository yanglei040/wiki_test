{
    "hands_on_practices": [
        {
            "introduction": "本练习将基础理论与具体应用联系起来。您将从麦克斯韦积分方程出发，推导理想电导体（PEC）表面的磁场边界条件。然后，您将把这个条件应用于一个经典场景——平面波反射——以确定导体上感应出的表面电流密度。这项练习旨在加深对边界条件物理意义的理解，并阐明其在解决电磁问题中的作用 。",
            "id": "3290423",
            "problem": "一个时间依赖关系为 $\\exp(\\mathrm{j}\\omega t)$（已省略）的时谐电磁场入射到一个平面界面上。该界面分隔了占据 $z>0$ 区域的均匀、各向同性、无损耗的外部介质与占据 $z<0$ 区域的理想电导体 (PEC)。外部介质的介电常数为 $\\epsilon_{1}$，磁导率为 $\\mu_{1}$，本征阻抗为 $\\eta_{1}=\\sqrt{\\mu_{1}/\\epsilon_{1}}$。单位法向量 $\\hat{n}$ 从 PEC 指向外部介质，因此在 $z=0$ 处 $\\hat{n}=\\hat{z}$。\n\n第一部分：从麦克斯韦方程组的积分形式出发，并对一个跨越界面的、厚度趋于零的矩形安培环路采用物理上合理的极限论证，推导连接界面处磁场切向分量与 PEC 上感生表面电流密度的边界关系。您的推导必须从基本定律开始，即包含自由电流密度和位移电流的安培-麦克斯韦定律的积分形式，并通过在环路垂直于界面的厚度趋于零时，对环路积分和通量项进行一致的计算来展开。\n\n第二部分：考虑一个横电 (TE) 平面波从外部介质入射到位于 $z=0$ 的 PEC 上。入射电场为\n$$\\mathbf{E}_{\\mathrm{i}}(\\mathbf{r})=E_{0}\\,\\hat{y}\\,\\exp\\!\\big(\\mathrm{j}\\,k_{1}(\\sin\\theta\\,x-\\cos\\theta\\,z)\\big),$$\n其中 $E_{0}>0$ 是实值振幅，$k_{1}=\\omega\\sqrt{\\mu_{1}\\epsilon_{1}}$ 是外部介质中的波数，$\\theta\\in(0,\\pi/2)$ 是从正 $z$ 轴朝向正 $x$ 轴测量的入射角。令 $\\mathbf{k}_{\\mathrm{i}}=k_{1}(\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z})$ 表示入射传播矢量，并假设在均匀介质中电场和磁场之间满足标准的平面波关系。PEC 反射该波，使得在 $z=0$ 处的总切向电场为零。利用第一部分建立的边界关系，并强制 $z=0$ 处的切向电场为零，确定 $z=0$ 处的感生表面电流密度 $\\mathbf{K}_{s}$，用 $E_{0}$、$\\eta_{1}$ 和 $\\theta$ 表示。\n\n答案规格：以行向量 $(K_{sx},K_{sy},K_{sz})$ 的形式，为 $\\mathbf{K}_{s}$ 的笛卡尔分量提供一个单一的闭式解析表达式。不需要进行数值计算或四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题经验证是自洽的、有科学依据的、且定义良好的。这是经典电磁学中的一个标准问题。\n\n第一部分：PEC 界面上磁场切向分量的边界条件推导。\n\n我们从时谐场的安培-麦克斯韦定律的积分形式开始，其中时间依赖关系为 $\\exp(\\mathrm{j}\\omega t)$，因此时间导数 $\\frac{\\partial}{\\partial t}$ 被替换为 $\\mathrm{j}\\omega$：\n$$ \\oint_C \\mathbf{H} \\cdot d\\mathbf{l} = \\int_S (\\mathbf{J}_f + \\mathrm{j}\\omega\\mathbf{D}) \\cdot d\\mathbf{S} $$\n此处，$C$ 是一个闭合路径，$S$ 是以 $C$ 为边界的任意曲面，$\\mathbf{H}$ 是磁场强度，$\\mathbf{J}_f$ 是自由体电流密度，$\\mathbf{D}$ 是电位移场。\n\n我们考虑一个位于 $z=0$ 的平面界面，它分隔了一个通用介质（区域 1，$z>0$）和一个理想电导体 (PEC)（区域 2，$z<0$）。从区域 2 指向区域 1 的单位法向量是 $\\hat{n}=\\hat{z}$。为了推导边界条件，我们构建一个跨越界面的微小矩形安培环路 $C$。该环路平行于界面的宽度为 $\\Delta w$，垂直于界面的高度为 $\\Delta h$，并以 $z=0$ 为中心。设其方向使得长度为 $\\Delta w$ 的边平行于任意切向方向 $\\hat{\\tau}$，长度为 $\\Delta h$ 的边平行于法向 $\\hat{n}$。\n\n我们在环路高度趋于零的极限下，即 $\\Delta h \\to 0$ 时，计算线积分 $\\oint_C \\mathbf{H} \\cdot d\\mathbf{l}$。该积分由矩形四条边的贡献组成。假设磁场强度 $\\mathbf{H}$ 是有限的，那么两条长度为 $\\Delta h$ 的竖直边的贡献与 $\\Delta h$ 成正比，并在 $\\Delta h \\to 0$ 时消失。顶部和底部的水平边的贡献则保留下来。顶边位于区域 1 中的 $z=+\\Delta h/2$ 处，底边位于区域 2 中的 $z=-\\Delta h/2$ 处。\n$$ \\lim_{\\Delta h \\to 0} \\oint_C \\mathbf{H} \\cdot d\\mathbf{l} = \\mathbf{H}_1 \\cdot (\\Delta w \\hat{\\tau}) + \\mathbf{H}_2 \\cdot (-\\Delta w \\hat{\\tau}) = (\\mathbf{H}_{1,t} - \\mathbf{H}_{2,t}) \\cdot \\hat{\\tau} \\Delta w $$\n这里，$\\mathbf{H}_1$ 和 $\\mathbf{H}_2$ 分别是区域 1 和区域 2 中界面处的磁场强度，而 $\\mathbf{H}_{1,t}$ 和 $\\mathbf{H}_{2,t}$ 是它们沿表面切向的分量。\n\n接下来，我们计算等式右边的面积分。由环路界定的曲面 $S$ 的面积为 $\\Delta w \\Delta h$。位移电流项的通量 $\\int_S \\mathrm{j}\\omega\\mathbf{D} \\cdot d\\mathbf{S}$ 与面积 $\\Delta w \\Delta h$ 成正比。假设 $\\mathbf{D}$ 是有限的，当 $\\Delta h \\to 0$ 时，该项消失。自由电流项 $\\int_S \\mathbf{J}_f \\cdot d\\mathbf{S}$ 代表穿过环路的总自由电流。如果界面上存在表面电流密度 $\\mathbf{K}_s$，则体电流密度 $\\mathbf{J}_f$ 在 $z=0$ 处变为奇异的。该积分给出总电流，在 $\\Delta h \\to 0$ 的极限下，它等于 $\\mathbf{K}_s$ 垂直于边 $\\Delta w$ 的分量与长度 $\\Delta w$ 的乘积。设环路所在平面的法向量为 $\\hat{t} = \\hat{\\tau} \\times \\hat{n}$。穿过环路的电流为 $(\\mathbf{K}_s \\cdot \\hat{t}) \\Delta w$。\n\n令线积分和面积分相等，我们得到：\n$$ (\\mathbf{H}_{1,t} - \\mathbf{H}_{2,t}) \\cdot \\hat{\\tau} \\Delta w = (\\mathbf{K}_s \\cdot (\\hat{\\tau} \\times \\hat{n})) \\Delta w $$\n使用标量三重积恒等式 $\\mathbf{A} \\cdot (\\mathbf{B} \\times \\mathbf{C}) = -(\\mathbf{A} \\times \\mathbf{B}) \\cdot \\mathbf{C}$，我们得到：\n$$ (\\mathbf{H}_{1,t} - \\mathbf{H}_{2,t}) \\cdot \\hat{\\tau} = -(\\mathbf{K}_s \\times \\hat{\\tau}) \\cdot \\hat{n} $$\n一个更直接和标准的推导以矢量形式陈述了该关系。该分量关系必须对切平面中环路的任何方向都成立。这导出了通用的矢量边界条件：\n$$ \\hat{n} \\times (\\mathbf{H}_1 - \\mathbf{H}_2) = \\mathbf{K}_s $$\n在 PEC（区域 2）内部，电磁场恒为零，因此 $\\mathbf{H}_2 = \\mathbf{0}$。因此，PEC 表面的边界条件简化为：\n$$ \\mathbf{K}_s = \\hat{n} \\times \\mathbf{H}_1 $$\n其中 $\\mathbf{H}_1$ 是导体外的磁场强度。\n\n第二部分：表面电流密度的计算。\n\n给定外部介质（$z>0$）中一个 TE 极化的入射平面波：\n$$ \\mathbf{E}_{\\mathrm{i}}(\\mathbf{r})=E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}(k_{1}x\\sin\\theta - k_{1}z\\cos\\theta)) $$\n入射波矢量为 $\\mathbf{k}_{\\mathrm{i}} = k_{1}(\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z})$。相应的入射磁场强度 $\\mathbf{H}_{\\mathrm{i}}$ 可通过平面波关系 $\\mathbf{H} = (\\eta^{-1}) \\hat{k} \\times \\mathbf{E}$ 求得：\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{1}{\\eta_{1}} \\frac{\\mathbf{k}_{\\mathrm{i}}}{k_{1}} \\times \\mathbf{E}_{\\mathrm{i}} = \\frac{1}{\\eta_{1}} (\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z}) \\times \\big(E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{i}}\\cdot\\mathbf{r})\\big) $$\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{E_{0}}{\\eta_{1}} \\big(\\sin\\theta(\\hat{x}\\times\\hat{y}) - \\cos\\theta(\\hat{z}\\times\\hat{y})\\big) \\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{i}}\\cdot\\mathbf{r}) $$\n使用 $\\hat{x}\\times\\hat{y}=\\hat{z}$ 和 $\\hat{z}\\times\\hat{y}=-\\hat{x}$，我们得到：\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} + \\sin\\theta\\,\\hat{z}) \\exp(\\mathrm{j}(k_{1}x\\sin\\theta - k_{1}z\\cos\\theta)) $$\n在 PEC 边界（$z=0$）处，总切向电场必须为零。总场是入射场和反射场的和，$\\mathbf{E} = \\mathbf{E}_{\\mathrm{i}} + \\mathbf{E}_{\\mathrm{r}}$。\n$$ \\mathbf{E}_{\\mathrm{tan}}(x,y,0) = \\mathbf{E}_{\\mathrm{i,tan}}(x,y,0) + \\mathbf{E}_{\\mathrm{r,tan}}(x,y,0) = \\mathbf{0} $$\n入射电场 $\\mathbf{E}_{\\mathrm{i}}$ 完全是切向的（在 $\\hat{y}$ 方向上）。在 $z=0$ 处：\n$$ \\mathbf{E}_{\\mathrm{i}}(x,y,0) = E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n因此，边界处的反射电场必须为：\n$$ \\mathbf{E}_{\\mathrm{r}}(x,y,0) = -E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n反射波从界面传播离开，进入区域 1。根据相位匹配，其波矢量的切向分量与入射波相同，而法向分量反向：$\\mathbf{k}_{\\mathrm{r}} = k_{1}(\\sin\\theta\\,\\hat{x}+\\cos\\theta\\,\\hat{z})$。因此，反射电场为：\n$$ \\mathbf{E}_{\\mathrm{r}}(\\mathbf{r}) = -E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}(k_{1}x\\sin\\theta + k_{1}z\\cos\\theta)) $$\n反射磁场强度 $\\mathbf{H}_{\\mathrm{r}}$ 为：\n$$ \\mathbf{H}_{\\mathrm{r}} = \\frac{1}{\\eta_{1}} \\frac{\\mathbf{k}_{\\mathrm{r}}}{k_{1}} \\times \\mathbf{E}_{\\mathrm{r}} = \\frac{1}{\\eta_{1}} (\\sin\\theta\\,\\hat{x}+\\cos\\theta\\,\\hat{z}) \\times \\big(-E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{r}}\\cdot\\mathbf{r})\\big) $$\n$$ \\mathbf{H}_{\\mathrm{r}} = -\\frac{E_{0}}{\\eta_{1}} \\big(\\sin\\theta(\\hat{x}\\times\\hat{y}) + \\cos\\theta(\\hat{z}\\times\\hat{y})\\big) \\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{r}}\\cdot\\mathbf{r}) $$\n$$ \\mathbf{H}_{\\mathrm{r}} = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} - \\sin\\theta\\,\\hat{z}) \\exp(\\mathrm{j}(k_{1}x\\sin\\theta + k_{1}z\\cos\\theta)) $$\n在界面 $z=0$ 处计算总磁场强度 $\\mathbf{H} = \\mathbf{H}_{\\mathrm{i}} + \\mathbf{H}_{\\mathrm{r}}$：\n$$ \\mathbf{H}(x,y,0) = \\mathbf{H}_{\\mathrm{i}}(x,y,0) + \\mathbf{H}_{\\mathrm{r}}(x,y,0) $$\n$$ \\mathbf{H}(x,y,0) = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} + \\sin\\theta\\,\\hat{z})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) + \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} - \\sin\\theta\\,\\hat{z})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n$$ \\mathbf{H}(x,y,0) = \\frac{E_{0}}{\\eta_{1}} (2\\cos\\theta\\,\\hat{x})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{x}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n现在我们使用第一部分得到的边界关系来求解感生表面电流密度 $\\mathbf{K}_s$。当 $\\hat{n}=\\hat{z}$ 且 $\\mathbf{H}_1=\\mathbf{H}(x,y,0)$ 时：\n$$ \\mathbf{K}_s = \\hat{n} \\times \\mathbf{H}_1 = \\hat{z} \\times \\left(\\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{x}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta)\\right) $$\n使用 $\\hat{z}\\times\\hat{x} = \\hat{y}$，我们得到：\n$$ \\mathbf{K}_s = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n题目要求的是表面电流密度的笛卡尔分量。从上述表达式中，我们有：\n$K_{sx} = 0$\n$K_{sy} = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta)$\n$K_{sz} = 0$\n这些分量可以写成一个行向量 $(K_{sx}, K_{sy}, K_{sz})$。",
            "answer": "$$\\boxed{\n\\begin{pmatrix}\n0 & \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) & 0\n\\end{pmatrix}\n}$$"
        },
        {
            "introduction": "数值模拟必须尊重其背后的物理原理，尤其是在材料界面处。本动手练习将揭示一个常见的陷阱：在处理变化的磁导率时，对静磁问题的朴素离散化会导致非物理的“伪磁荷”的产生。您将实现一个有缺陷的方案和一个“散度清理”修正方案，从而清晰、实际地理解为何在计算电磁学中正确实施法向磁通密度的连续性是至关重要的 。",
            "id": "3290469",
            "problem": "考虑一个二维无源静磁场配置，其定义在单位正方形域上，笛卡尔坐标为 $(x,y) \\in [0,1] \\times [0,1]$。磁通量密度 $\\mathbf{B}$ 和磁场强度 $\\mathbf{H}$ 遵循静磁学的麦克斯韦方程组：$\\nabla \\cdot \\mathbf{B} = 0$ 和 $\\nabla \\times \\mathbf{H} = \\mathbf{0}$，其本构关系为 $\\mathbf{B} = \\mu(x,y)\\,\\mathbf{H}$。在无源区域中，磁场强度是无旋的，可以表示为标量势 $\\phi$ 的形式，即 $\\mathbf{H} = -\\nabla \\phi$。因此，该标量势满足一个变系数椭圆守恒律 $\\nabla \\cdot (\\mu(x,y)\\,\\nabla \\phi) = 0$，此定律确保了 $\\mathbf{B}$ 的法向分量在材料界面上是连续的。\n\n我们研究一个在 $x = 0.5$ 处具有尖銳界面的分段常数磁导率场 $\\mu(x,y)$：\n- 当 $x  0.5$ 时，设 $\\mu(x,y) = \\mu_1$。\n- 当 $x \\ge 0.5$ 时，设 $\\mu(x,y) = \\mu_2$。\n\n磁导率值使用真空磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$ 亨利/米来定义，即 $\\mu_1 = \\mu_0$ 和 $\\mu_2 = \\mu_r\\,\\mu_0$，其中 $\\mu_r$ 是一个无量纲的相对磁导率对比度参数。对 $\\phi$ 施加 Dirichlet 边界条件，使得 $\\phi(0, y) = 0$ 安培，$\\phi(1, y) = 1$ 安培，$\\phi(x, 0) = 0$ 安培，以及 $\\phi(x, 1) = 0$ 安培。\n\n目标是量化一个忽略 $\\mu$ 空间变化的离散格式如何在界面附近产生伪磁荷，并提出一种混合格式来减轻这些电荷。具体来说，您必须：\n\n1. 从上述基本定律出发，使用常系数拉普拉斯方程 $\\nabla^2 \\phi = 0$ 和给定的 Dirichlet 边界条件，在均匀的笛卡尔网格上离散化并求解标量势 $\\phi$。然后在同一网格上计算离散磁通量密度 $\\mathbf{B}_{\\text{naive}} = -\\mu(x,y)\\,\\nabla \\phi$。接下来，使用中心差分计算域内部 $\\mathbf{B}_{\\text{naive}}$ 的离散散度。报告内部网格点上散度绝对值的最大值，该值代表了这种朴素格式引入的伪磁荷密度 $\\rho_m = \\nabla \\cdot \\mathbf{B}$ 的大小。\n\n2. 提出并实现一种混合格式，通过拉格朗日乘子场以弱形式施加 $\\nabla \\cdot \\mathbf{B} = 0$ 约束来减轻伪磁荷。一种实际的实现是散度清理投影：找到一个标量场 $u$，使得在域内满足 $\\Delta u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$，并在边界 $\\partial \\Omega$ 上具有齐次 Dirichlet 边界条件 $u=0$，然后定义校正后的场 $\\mathbf{B}_{\\text{mixed}} = \\mathbf{B}_{\\text{naive}} - \\nabla u$。计算 $\\mathbf{B}_{\\text{mixed}}$ 的离散散度，并报告内部网格点上其绝对值的最大值。\n\n您的程序必须在 $[0,1]^2$ 上使用一个 $N_x = 64$ 和 $N_y = 64$ 个节点的均匀网格，间距为 $\\Delta x = 1/(N_x-1)$ 和 $\\Delta y = 1/(N_y-1)$。离散梯度和散度应在内部节点上使用中心差分，边界处仅在梯度计算时使用单边差分（散度统计量应在内部节点上评估）。所有量必须使用以下物理单位进行一致计算：\n- $\\mu$ 单位为亨利/米 (H/m)，\n- $\\phi$ 单位为安培 (A)，\n- $\\mathbf{H}$ 单位为安培/米 (A/m)，\n- $\\mathbf{B}$ 单位为特斯拉 (T)，\n- $\\nabla \\cdot \\mathbf{B}$ 单位为特斯拉/米 (T/m)。\n\n测试套件：\n评估该格式在三种相对磁导率对比度下的表现：\n- 情况 1 (基线，无对比度): $\\mu_r = 1$，\n- 情况 2 (中等对比度): $\\mu_r = 10$，\n- 情况 3 (高对比度): $\\mu_r = 1000$。\n\n对于每种情况，计算两个浮点数结果：\n- $\\mathbf{B}_{\\text{naive}}$ 在内部的最大绝对散度，单位为 T/m。\n- $\\mathbf{B}_{\\text{mixed}}$ 在内部的最大绝对散度，单位为 T/m。\n\n您的程序应生成单行输出，其中包含六个结果，以逗号分隔列表的形式包含在方括号中，顺序为 [naive_case1, naive_case2, naive_case3, mixed_case1, mixed_case2, mixed_case3]。例如，确切的输出格式必须匹配：“[r1,r2,r3,r4,r5,r6]”。所有六个条目都必须是浮点数，单位为特斯拉/米 (T/m)。",
            "solution": "用户提供的问题是计算电磁学中一个有效且适定的练习。它要求演示并随后减轻在对带有材料界面的静磁问题进行朴素离散化时产生的伪磁荷。该问题在科学上是合理的，包含了所有必要信息，其目标清晰且可形式化。\n\n解决方案针对每个指定的材料对比度参数 $\\mu_r$ 分为两个主要部分，遵循问题描述。所有计算都在一个均匀的 $N_x \\times N_y$ 网格上执行，其中 $N_x=N_y=64$。\n\n### 第 1 部分：朴素格式与伪磁荷\n\n在具有可变磁导率 $\\mu(x,y)$ 的无源区域中，磁标量势 $\\phi$ 的正确控制方程是守恒律 $\\nabla \\cdot (\\mu \\nabla\\phi) = 0$。该方程确保了磁通量密度 $\\mathbf{B}$ 的法向分量在材料界面上是连续的。\n\n问题中定义的“朴素”格式将其简化为常系数拉普拉斯方程 $\\nabla^2 \\phi = 0$。这种简化忽略了位于 $x=0.5$ 的材料界面上磁导率的跳跃。\n\n1.  **$\\phi$ 的离散化与求解**：我们在网格的内部节点上离散化拉普拉斯方程 $\\nabla^2 \\phi = 0$。使用中心五点有限差分模板，内部网格点 $(i,j)$ 处的方程变为：\n    $$\n    \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{(\\Delta x)^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{(\\Delta y)^2} = 0\n    $$\n    由于 $\\Delta x = \\Delta y = h$，这可以简化为：\n    $$\n    \\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4\\phi_{i,j} = 0\n    $$\n    对所有 $(N_x-2) \\times (N_y-2)$ 个内部点构建这组线性方程。给定的 Dirichlet 边界条件——$\\phi(0,y)=0$、$\\phi(x,0)=0$、$\\phi(x,1)=0$ 和 $\\phi(1,y)=1$——被并入线性系统的右侧。求解得到的稀疏线性系统 $\\mathbf{A}\\vec{\\phi}_{int} = \\vec{b}$，以获得内部势值向量 $\\vec{\\phi}_{int}$。然后，通过将解出的内部值与已知的边界值相结合，组装出完整的势场 $\\phi$。\n\n2.  **计算 $\\mathbf{B}_{\\text{naive}}$**：朴素磁通量密度计算为 $\\mathbf{B}_{\\text{naive}} = -\\mu(x,y)\\,\\nabla\\phi$。\n    - 分段常数磁导率场 $\\mu(x,y)$ 在网格上定义为：当 $x  0.5$ 时 $\\mu=\\mu_1$，当 $x \\ge 0.5$ 时 $\\mu=\\mu_2$。\n    - 使用中心差分计算内部点的梯度 $\\nabla\\phi$，在边界处使用单边差分。\n\n3.  **计算伪磁荷密度 $\\rho_m$**：伪磁荷密度是计算场的散度，即 $\\rho_m = \\nabla\\cdot\\mathbf{B}_{\\text{naive}}$。该散度在内部网格点上使用中心差分格式计算：\n    $$\n    (\\nabla \\cdot \\mathbf{B})_{i,j} \\approx \\frac{(B_x)_{i+1,j} - (B_x)_{i-1,j}}{2\\Delta x} + \\frac{(B_y)_{i,j+1} - (B_y)_{i,j-1}}{2\\Delta y}\n    $$\n    这个离散散度在域内部的最大 absolute 值 $\\max|\\nabla \\cdot \\mathbf{B}_{\\text{naive}}|$，量化了数值误差的严重程度。此误差的产生是因为朴素的 $\\phi$ 解在界面上具有连续的导数，因此当乘以不连续的 $\\mu$ 时，得到的 $\\mathbf{B}_{\\text{naive}}$ 具有不连续的法向分量，从而违反了 $\\nabla \\cdot \\mathbf{B} = 0$。\n\n### 第 2 部分：用于散度清理的混合格式\n\n为了修正这个误差，采用了一种散度清理程序。这是一种以弱形式施加散度约束的投影方法。\n\n1.  **求解修正泊松方程**：通过求解泊松方程 $\\Delta u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$ 来找到一个修正势 $u$，其中源项是上一步计算出的伪磁荷密度。该方程服从齐次 Dirichlet 边界条件（在所有边界上 $u=0$）。我们使用与求解 $\\phi$ 相同的基于有限差分的线性系统求解器来求解此方程。\n\n2.  **计算校正场 $\\mathbf{B}_{\\text{mixed}}$**：计算修正势的梯度 $\\nabla u$。然后将校正后的磁通量密度定义为：\n    $$\n    \\mathbf{B}_{\\text{mixed}} = \\mathbf{B}_{\\text{naive}} - \\nabla u\n    $$\n\n3.  **验证校正**：计算校正后场的散度。根据构造：\n    $$\n    \\nabla \\cdot \\mathbf{B}_{\\text{mixed}} = \\nabla \\cdot (\\mathbf{B}_{\\text{naive}} - \\nabla u) = \\nabla \\cdot \\mathbf{B}_{\\text{naive}} - \\nabla^2 u\n    $$\n    由于我们求解了 $\\nabla^2 u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$，校正后场的散度应在数值精度范围内为零。我们在内部网格上计算 $\\max|\\nabla \\cdot \\mathbf{B}_{\\text{mixed}}|$ 以验证清理程序的有效性。\n\n下面的程序为三种指定的相对磁导率对比度 $\\mu_r$ 值实现了这整个过程。它为离散拉普拉斯算子组装稀疏矩阵，求解 $\\phi$ 和 $u$ 的线性系统，并计算所需的散度统计量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve\n\ndef _solve_for_contrast(mu_r, Nx, Ny):\n    \"\"\"\n    Solves the magnetostatics problem for a given permeability contrast,\n    calculating the max divergence for both naive and mixed formulations.\n    \n    Args:\n        mu_r (float): The relative permeability contrast.\n        Nx (int): Number of grid points in the x-direction.\n        Ny (int): Number of grid points in the y-direction.\n\n    Returns:\n        tuple: A tuple containing:\n            - max_div_naive (float): Max absolute divergence of B_naive.\n            - max_div_mixed (float): Max absolute divergence of B_mixed.\n    \"\"\"\n    # 1. SETUP: Constants, Grid, and Operators\n    \n    # Physical constants and material properties in SI units\n    MU0 = 4.0 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    mu1 = MU0\n    mu2 = mu_r * MU0\n    \n    # Grid parameters\n    Lx, Ly = 1.0, 1.0\n    dx = Lx / (Nx - 1)\n    dy = Ly / (Ny - 1)\n    h = dx  # Grid spacing is uniform\n\n    # Interior grid dimensions\n    Mx, My = Nx - 2, Ny - 2\n    \n    # Construct the 2D discrete Laplacian operator, L_2D, for interior nodes\n    # such that (L_2D @ u_flat) approximates (nabla^2 u) without the h^2 scaling.\n    L_1D = sparse.diags([1, -2, 1], [-1, 0, 1], shape=(Mx, Mx), format='csr')\n    I_M = sparse.identity(Mx, format='csr')\n    # Operator built for row-major (C-style) flattening of the 2D grid\n    L_2D = sparse.kron(I_M, L_1D) + sparse.kron(L_1D, I_M)\n\n    # 2. NAIVE SCHEME: Solve Laplace's equation for phi\n    \n    # Set up the Right-Hand Side (RHS) vector for the potential phi.\n    # The non-zero boundary condition phi(1, y) = 1 affects the last column of interior nodes.\n    b_phi_matrix = np.zeros((My, Mx))\n    b_phi_matrix[:, -1] = -1.0  # Contribution from phi_{i+1,j} where phi_{i+1,j}=1\n    b_phi_flat = b_phi_matrix.ravel()\n\n    # Solve the linear system L_2D * phi = b for interior phi values\n    phi_int_flat = spsolve(L_2D, b_phi_flat)\n    phi_int = phi_int_flat.reshape((My, Mx))\n\n    # Assemble the full potential field, including boundaries\n    phi = np.zeros((Ny, Nx))\n    phi[1:-1, 1:-1] = phi_int\n    phi[:, -1] = 1.0  # Set phi(1, y) = 1 A\n\n    # Compute the naive magnetic flux density B_naive = -mu(x,y) * grad(phi)\n    mu = np.full((Ny, Nx), mu1)\n    # The interface is at x = 0.5. Grid points i where x[i] >= 0.5 get mu2.\n    interface_idx = int(np.ceil(0.5 / dx))\n    mu[:, interface_idx:] = mu2\n    \n    # Compute the gradient of phi using centered differences in the interior\n    grad_phi_y, grad_phi_x = np.gradient(phi, dy, dx)\n\n    B_naive_x = -mu * grad_phi_x\n    B_naive_y = -mu * grad_phi_y\n\n    # Compute the divergence of B_naive on the interior grid\n    div_B_naive_x = (B_naive_x[1:-1, 2:] - B_naive_x[1:-1, :-2]) / (2 * dx)\n    div_B_naive_y = (B_naive_y[2:, 1:-1] - B_naive_y[:-2, 1:-1]) / (2 * dy)\n    div_B_naive = div_B_naive_x + div_B_naive_y\n    max_div_naive = np.max(np.abs(div_B_naive))\n\n    # 3. MIXED FORMULATION: Divergence cleaning\n    \n    # Solve the Poisson equation: Delta u = div(B_naive) with homogeneous Dirichlet BCs\n    # The RHS is scaled by h^2 to match the unscaled L_2D operator.\n    b_u_flat = (h**2) * div_B_naive.ravel()\n    \n    u_int_flat = spsolve(L_2D, b_u_flat)\n    u_int = u_int_flat.reshape((My, Mx))\n\n    # Assemble the full correction potential field with zero boundaries\n    u = np.zeros((Ny, Nx))\n    u[1:-1, 1:-1] = u_int\n\n    # Compute the corrected field B_mixed = B_naive - grad(u)\n    grad_u_y, grad_u_x = np.gradient(u, dy, dx)\n    B_mixed_x = B_naive_x - grad_u_x\n    B_mixed_y = B_naive_y - grad_u_y\n\n    # Compute the divergence of B_mixed on the interior grid\n    div_B_mixed_x = (B_mixed_x[1:-1, 2:] - B_mixed_x[1:-1, :-2]) / (2 * dx)\n    div_B_mixed_y = (B_mixed_y[2:, 1:-1] - B_mixed_y[:-2, 1:-1]) / (2 * dy)\n    div_B_mixed = div_B_mixed_x + div_B_mixed_y\n    max_div_mixed = np.max(np.abs(div_B_mixed))\n\n    return max_div_naive, max_div_mixed\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        1.0,      # Case 1: no contrast\n        10.0,     # Case 2: moderate contrast\n        1000.0,   # Case 3: high contrast\n    ]\n    Nx, Ny = 64, 64\n\n    results_naive = []\n    results_mixed = []\n    \n    for mu_r in test_cases:\n        naive_div, mixed_div = _solve_for_contrast(mu_r, Nx, Ny)\n        results_naive.append(naive_div)\n        results_mixed.append(mixed_div)\n\n    # Combine results in the required order: [naive_all_cases, mixed_all_cases]\n    final_results = results_naive + results_mixed\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6e}' for r in final_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在固定的笛卡尔网格上精确模拟弯曲几何体，是诸如时域有限差分（FDTD）等方法中的一个重大挑战。这项高级练习介绍了一种强大的解决方案：通过子像素平均实现共形建模。您将推导并实现一个各向异性的有效介电常数张量，该张量能在一个被电介质界面切割的网格单元内正确地体现边界条件，从而证明其优于简单的平均方案，并阐明现代共形算法背后的原理 。",
            "id": "3290499",
            "problem": "您的任务是为横磁 (TM) 模式下的二维弯曲介电质界面设计并验证一种共形时域有限差分 (FDTD) 格式。目标是推导一种亚像素平均方法，该方法能在弯曲界面上施加正确的材料界面边界条件，并避免当界面穿过计算单元时产生的阶梯误差。您的设计必须基于麦克斯韦方程组所蕴含的边界条件，并以适合在离散算法中实现的形式表达。\n\n从以下基础出发：\n- 线性、无损耗介电质中的麦克斯韦方程组，其本构关系为 $\\mathbf{D} = \\varepsilon \\mathbf{E}$，其中 $\\varepsilon$ 是介电常数。\n- 无自由表面电荷的介电质的界面边界条件：电通量密度 $\\mathbf{D}$ 的法向分量跨界面连续，电场强度 $\\mathbf{E}$ 的切向分量跨界面连续。\n- Yee 元胞式离散化，其中被弯曲界面穿过的元胞内的面心场分量必须使用有效介电常数进行更新。\n\n您的任务：\n- 从第一性原理出发，为一个被两种介电常数（$\\varepsilon_1$ 和 $\\varepsilon_2$）材料之间的光滑介电质界面切割的单个 Yee 元胞，推导出一个有效的亚像素介电常数表示法。设 $f \\in [0,1]$ 表示元胞内材料 1 的面积分数，$1-f$ 表示材料 2 的面积分数。设局部界面法向为单位向量 $\\mathbf{n} = (\\cos\\theta, \\sin\\theta)$，其中角度 $\\theta$ 以弧度给出。\n- 证明正确施加边界条件意味着元胞内存在方向依赖的均匀化，并将得到的有效介电常数表示为笛卡尔坐标系 $(x,y)$ 下的对称 $2 \\times 2$ 张量。推导必须严格基于界面边界条件，并适用于任意的 $\\theta$ 和 $f$。\n- 将这种共形的、方向依赖的平均方法与简单的各向同性算术平均方法（即对所有方向都赋予 $\\varepsilon_{\\text{iso}} = f \\varepsilon_1 + (1-f)\\varepsilon_2$）进行对比，并解释当场在界面法向上有非零投影时阶梯误差的来源。\n\n实现要求：\n- 实现一个程序，对于给定的 $(f, \\varepsilon_1, \\varepsilon_2, \\theta, \\mathbf{E})$ 和测试电场矢量 $\\mathbf{E}$，计算：\n  $1.$ 从边界条件推导出的各向异性有效介电常数张量 $\\boldsymbol{\\varepsilon}_{\\text{eff}}$。\n  $2.$ 简单的各向同性平均值 $\\boldsymbol{\\varepsilon}_{\\text{iso}}$。\n  $3.$ 电通量密度矢量 $\\mathbf{D}_{\\text{aniso}} = \\boldsymbol{\\varepsilon}_{\\text{eff}} \\mathbf{E}$ 和 $\\mathbf{D}_{\\text{iso}} = \\boldsymbol{\\varepsilon}_{\\text{iso}} \\mathbf{E}$。\n  $4.$ 相对于由边界条件所蕴含的理论上正确的法向通量响应的法向分量误差，定义为\n  $$\\delta_{\\text{n,aniso}} = \\frac{\\left| \\mathbf{n} \\cdot \\mathbf{D}_{\\text{aniso}} - \\varepsilon_{\\text{n,theory}} \\, (\\mathbf{n} \\cdot \\mathbf{E}) \\right|}{\\max\\left(\\left| \\varepsilon_{\\text{n,theory}} \\, (\\mathbf{n} \\cdot \\mathbf{E}) \\right|, 10^{-15}\\right)},$$\n  $$\\delta_{\\text{n,iso}} = \\frac{\\left| \\mathbf{n} \\cdot \\mathbf{D}_{\\text{iso}} - \\varepsilon_{\\text{n,theory}} \\, (\\mathbf{n} \\cdot \\mathbf{E}) \\right|}{\\max\\left(\\left| \\varepsilon_{\\text{n,theory}} \\, (\\mathbf{n} \\cdot \\mathbf{E}) \\right|, 10^{-15}\\right)},$$\n  其中 $\\varepsilon_{\\text{n,theory}}$ 是由您推导的边界条件所决定的、理论上正确的界面法向有效介电常数。\n- 此外，在 $f=0$ 和 $f=1$ 的边缘情况下，通过测试以下公式来验证各向异性和各向同性两种方案均退化为基础材料的介电常数：\n  $$\\delta_{\\text{cell,aniso}} = \\frac{\\left\\| \\mathbf{D}_{\\text{aniso}} - \\varepsilon_{\\star} \\mathbf{E} \\right\\|_2}{\\max\\left(\\left\\| \\varepsilon_{\\star} \\mathbf{E} \\right\\|_2, 10^{-15}\\right)}, \\quad \\delta_{\\text{cell,iso}} = \\frac{\\left\\| \\mathbf{D}_{\\text{iso}} - \\varepsilon_{\\star} \\mathbf{E} \\right\\|_2}{\\max\\left(\\left\\| \\varepsilon_{\\star} \\mathbf{E} \\right\\|_2, 10^{-15}\\right)},$$\n  其中，当 $f=0$ 时 $\\varepsilon_{\\star} = \\varepsilon_2$，当 $f=1$ 时 $\\varepsilon_{\\star} = \\varepsilon_1$。\n\n单位和常数：\n- 所有介电常数必须以法拉每米 (F/m) 为单位表示。如果需要，使用 $\\varepsilon_0 = 8.854187817 \\times 10^{-12}$ F/m 作为自由空间介电常数。\n- 所有角度 $\\theta$ 都以弧度为单位提供。\n\n测试套件：\n- 您的程序必须评估以下测试用例，每个用例指定为 $(f, \\varepsilon_1, \\varepsilon_2, \\theta, \\mathbf{E})$：\n  $1.$ $(0.3, 1 \\varepsilon_0, 12 \\varepsilon_0, 0, (1, 0))$.\n  $2.$ $(0.7, 2 \\varepsilon_0, 8 \\varepsilon_0, \\pi/2, (1, 0))$.\n  $3.$ $(0.5, 2 \\varepsilon_0, 10 \\varepsilon_0, \\pi/3, (1, 0))$.\n  $4.$ $(0, 4 \\varepsilon_0, 9 \\varepsilon_0, \\pi/4, (1, 0))$.\n  $5.$ $(1, 5 \\varepsilon_0, 7 \\varepsilon_0, \\pi/4, (1, 0))$.\n\n对每个测试用例，按如下方式计算布尔值：\n- 对于测试用例 1 和 3：输出两个布尔值，分别表示 $\\delta_{\\text{n,aniso}} \\le 10^{-12}$ 是否成立以及 $\\delta_{\\text{n,iso}} > 10^{-6}$ 是否成立。\n- 对于测试用例 2：输出两个布尔值，分别表示 $\\delta_{\\text{n,aniso}} \\le 10^{-12}$ 是否成立以及 $\\delta_{\\text{n,iso}} \\le 10^{-12}$ 是否成立。\n- 对于测试用例 4：输出两个布尔值，分别表示 $\\delta_{\\text{cell,aniso}} \\le 10^{-12}$ 是否成立以及 $\\delta_{\\text{cell,iso}} \\le 10^{-12}$ 是否成立。\n- 对于测试用例 5：输出两个布尔值，分别表示 $\\delta_{\\text{cell,aniso}} \\le 10^{-12}$ 是否成立以及 $\\delta_{\\text{cell,iso}} \\le 10^{-12}$ 是否成立。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。该列表必须严格包含按上述顺序排列的十个布尔值，对应于测试 $(1\\text{ aniso}, 1\\text{ iso}, 2\\text{ aniso}, 2\\text{ iso}, 3\\text{ aniso}, 3\\text{ iso}, 4\\text{ aniso}, 4\\text{ iso}, 5\\text{ aniso}, 5\\text{ iso})$。例如，输出可能如下所示：$[\\text{True},\\text{False},\\text{True},\\text{True},\\text{True},\\text{False},\\text{True},\\text{True},\\text{True},\\text{True}]$。",
            "solution": "该问题是有效的，因为它以麦克斯韦方程组为科学基础，提法明确且提供了所有必要信息，并且表述客观。我们着手推导共形亚像素平均方案。\n\n此推导的基础在于在亚网格尺度上跨介电质界面施加电磁边界条件。在一个被界面穿过的单个计算元胞内，我们假设平均电场 $\\langle \\mathbf{E} \\rangle$ 和平均电通量密度 $\\langle \\mathbf{D} \\rangle$ 通过一个有效介电常数张量 $\\boldsymbol{\\varepsilon}_{\\text{eff}}$ 相关联，使得 $\\langle \\mathbf{D} \\rangle = \\boldsymbol{\\varepsilon}_{\\text{eff}} \\langle \\mathbf{E} \\rangle$。该平均是在元胞的面积上进行的。\n\n设元胞包含两种介电常数分别为 $\\varepsilon_1$ 和 $\\varepsilon_2$ 的线性、各向同性、无损耗介电材料。材料 1 的面积分数为 $f$，材料 2 的面积分数为 $1-f$。该界面局部由单位法向向量 $\\mathbf{n}$ 和单位切向向量 $\\mathbf{t}$ 表征。任何矢量场都可以分解为相对于此界面的法向和切向分量。\n\n无自由表面电荷的介电质界面上的边界条件规定：\n$1$. 电场强度 $\\mathbf{E}$ 的切向分量是连续的：$E_{t,1} = E_{t,2} \\equiv E_t$。\n$2$. 电通量密度 $\\mathbf{D}$ 的法向分量是连续的：$D_{n,1} = D_{n,2} \\equiv D_n$。\n\n元胞内的平均场是每种材料中场的面积加权和：\n$$ \\langle \\mathbf{E} \\rangle = f \\mathbf{E}_1 + (1-f) \\mathbf{E}_2 $$\n$$ \\langle \\mathbf{D} \\rangle = f \\mathbf{D}_1 + (1-f) \\mathbf{D}_2 $$\n\n我们现在分析这些平均场的各个分量。\n\n首先，考虑切向分量。平均切向电场为：\n$$ \\langle E_t \\rangle = \\langle \\mathbf{E} \\rangle \\cdot \\mathbf{t} = f (\\mathbf{E}_1 \\cdot \\mathbf{t}) + (1-f) (\\mathbf{E}_2 \\cdot \\mathbf{t}) = f E_{t,1} + (1-f) E_{t,2} $$\n使用连续性条件 $E_{t,1} = E_{t,2} = E_t$，这简化为：\n$$ \\langle E_t \\rangle = f E_t + (1-f) E_t = E_t $$\n平均切向电通量密度为：\n$$ \\langle D_t \\rangle = \\langle \\mathbf{D} \\rangle \\cdot \\mathbf{t} = f (\\mathbf{D}_1 \\cdot \\mathbf{t}) + (1-f) (\\mathbf{D}_2 \\cdot \\mathbf{t}) = f D_{t,1} + (1-f) D_{t,2} $$\n使用本构关系 $D_{t,1} = \\varepsilon_1 E_{t,1}$ 和 $D_{t,2} = \\varepsilon_2 E_{t,2}$，我们得到：\n$$ \\langle D_t \\rangle = f \\varepsilon_1 E_t + (1-f) \\varepsilon_2 E_t = (f \\varepsilon_1 + (1-f) \\varepsilon_2) E_t $$\n由于 $E_t = \\langle E_t \\rangle$，我们发现关系式 $\\langle D_t \\rangle = \\varepsilon_{\\text{eff}, t} \\langle E_t \\rangle$，其中有效切向介电常数是算术平均值：\n$$ \\varepsilon_{\\text{eff}, t} = f \\varepsilon_1 + (1-f) \\varepsilon_2 $$\n这种排列方式类似于电容器并联。\n\n接下来，考虑法向分量。平均法向电通量密度为：\n$$ \\langle D_n \\rangle = \\langle \\mathbf{D} \\rangle \\cdot \\mathbf{n} = f (\\mathbf{D}_1 \\cdot \\mathbf{n}) + (1-f) (\\mathbf{D}_2 \\cdot \\mathbf{n}) = f D_{n,1} + (1-f) D_{n,2} $$\n使用连续性条件 $D_{n,1} = D_{n,2} = D_n$，这简化为：\n$$ \\langle D_n \\rangle = f D_n + (1-f) D_n = D_n $$\n平均法向电场为：\n$$ \\langle E_n \\rangle = \\langle \\mathbf{E} \\rangle \\cdot \\mathbf{n} = f (\\mathbf{E}_1 \\cdot \\mathbf{n}) + (1-f) (\\mathbf{E}_2 \\cdot \\mathbf{n}) = f E_{n,1} + (1-f) E_{n,2} $$\n使用本构关系 $E_{n,1} = D_{n,1} / \\varepsilon_1$ 和 $E_{n,2} = D_{n,2} / \\varepsilon_2$，我们得到：\n$$ \\langle E_n \\rangle = f \\frac{D_n}{\\varepsilon_1} + (1-f) \\frac{D_n}{\\varepsilon_2} = D_n \\left( \\frac{f}{\\varepsilon_1} + \\frac{1-f}{\\varepsilon_2} \\right) $$\n由于 $D_n = \\langle D_n \\rangle$，我们可以写出 $\\langle E_n \\rangle = \\langle D_n \\rangle / \\varepsilon_{\\text{eff}, n}$。这给出了有效法向介电常数是调和平均值：\n$$ \\varepsilon_{\\text{eff}, n} = \\left( \\frac{f}{\\varepsilon_1} + \\frac{1-f}{\\varepsilon_2} \\right)^{-1} $$\n这种排列方式类似于电容器串联。问题中将此称为 $\\varepsilon_{\\text{n,theory}}$。\n\n在由 $(\\mathbf{n}, \\mathbf{t})$ 定义的局部坐标系中，有效介电常数张量是对角阵：\n$$ \\boldsymbol{\\varepsilon}'_{\\text{eff}} = \\begin{pmatrix} \\varepsilon_{\\text{eff}, n}  0 \\\\ 0  \\varepsilon_{\\text{eff}, t} \\end{pmatrix} $$\n为了在笛卡尔 $(x,y)$ 基中表示此张量，我们使用到法向和切向方向的投影算子 $\\mathbf{P}_n = \\mathbf{n} \\otimes \\mathbf{n}$ 和 $\\mathbf{P}_t = \\mathbf{t} \\otimes \\mathbf{t}$，其中 $\\otimes$ 表示外积。该张量由下式给出：\n$$ \\boldsymbol{\\varepsilon}_{\\text{eff}} = \\varepsilon_{\\text{eff}, n} (\\mathbf{n} \\otimes \\mathbf{n}) + \\varepsilon_{\\text{eff}, t} (\\mathbf{t} \\otimes \\mathbf{t}) $$\n给定法向向量 $\\mathbf{n} = (\\cos\\theta, \\sin\\theta)^T$ 和切向向量 $\\mathbf{t} = (-\\sin\\theta, \\cos\\theta)^T$，张量分量为：\n$$ \\boldsymbol{\\varepsilon}_{\\text{eff}} = \\begin{pmatrix} \\varepsilon_{\\text{eff}, n} \\cos^2\\theta + \\varepsilon_{\\text{eff}, t} \\sin^2\\theta  (\\varepsilon_{\\text{eff}, n} - \\varepsilon_{\\text{eff}, t}) \\cos\\theta \\sin\\theta \\\\ (\\varepsilon_{\\text{eff}, n} - \\varepsilon_{\\text{eff}, t}) \\cos\\theta \\sin\\theta  \\varepsilon_{\\text{eff}, n} \\sin^2\\theta + \\varepsilon_{\\text{eff}, t} \\cos^2\\theta \\end{pmatrix} $$\n这就是共形的、方向依赖的有效介电常数张量。\n\n相比之下，简单的各向同性平均方案为元胞分配一个单一的标量介电常数：\n$$ \\varepsilon_{\\text{iso}} = f \\varepsilon_1 + (1-f)\\varepsilon_2 $$\n这对应于一个各向同性张量 $\\boldsymbol{\\varepsilon}_{\\text{iso}} = \\varepsilon_{\\text{iso}} \\mathbf{I}$，其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。我们观察到 $\\varepsilon_{\\text{iso}} = \\varepsilon_{\\text{eff}, t}$。\n\n阶梯误差源于对垂直于界面的电场分量的错误处理。各向同性模型假设关系为 $\\langle D_n \\rangle = \\varepsilon_{\\text{iso}} \\langle E_n \\rangle$，而物理上正确的关系是 $\\langle D_n \\rangle = \\varepsilon_{\\text{eff}, n} \\langle E_n \\rangle$。根据算术平均-调和平均不等式，$\\varepsilon_{\\text{iso}} \\ge \\varepsilon_{\\text{eff}, n}$（仅当 $\\varepsilon_1 = \\varepsilon_2$ 时等号成立）。因此，各向同性模型系统性地高估了法向方向的介电常数，在时域仿真中导致界面上虚假表面电荷的错误累积。这表现为伪反射和数值不稳定性，是经典阶梯 FDTD 近似的一个关键人为误差。\n\n问题中定义的误差度量 $\\delta_{\\text{n,aniso}}$ 和 $\\delta_{\\text{n,iso}}$ 旨在量化这种差异。对于各向异性模型，$\\mathbf{n} \\cdot \\mathbf{D}_{\\text{aniso}} = \\mathbf{n} \\cdot (\\boldsymbol{\\varepsilon}_{\\text{eff}} \\mathbf{E}) = \\varepsilon_{\\text{eff}, n} (\\mathbf{n} \\cdot \\mathbf{E}) = \\varepsilon_{\\text{n,theory}} (\\mathbf{n} \\cdot \\mathbf{E})$，因此 $\\delta_{\\text{n,aniso}}$ 在浮点精度范围内应为零。对于各向同性模型，$\\mathbf{n} \\cdot \\mathbf{D}_{\\text{iso}} = \\varepsilon_{\\text{iso}} (\\mathbf{n} \\cdot \\mathbf{E})$，这通常与理论值不同，导致非零的 $\\delta_{\\text{n,iso}}$。$f=0$ 和 $f=1$ 的边缘情况用作合理性检查，此时元胞被单一材料填充，两种模型都应退化为正确的标量介电常数（分别为 $\\varepsilon_2$ 或 $\\varepsilon_1$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and validates a conformal FDTD scheme for curved dielectric interfaces.\n    \"\"\"\n    # Define the constant for permittivity of free space\n    EPS0 = 8.854187817e-12\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (f, eps1_rel, eps2_rel, theta, E_vec)\n    test_cases = [\n        (0.3, 1.0, 12.0, 0.0, (1, 0)),\n        (0.7, 2.0, 8.0, np.pi / 2, (1, 0)),\n        (0.5, 2.0, 10.0, np.pi / 3, (1, 0)),\n        (0.0, 4.0, 9.0, np.pi / 4, (1, 0)),\n        (1.0, 5.0, 7.0, np.pi / 4, (1, 0)),\n    ]\n\n    all_results = []\n\n    for i, case in enumerate(test_cases):\n        f, eps1_rel, eps2_rel, theta, E_vec = case\n        \n        eps1 = eps1_rel * EPS0\n        eps2 = eps2_rel * EPS0\n        E = np.array(E_vec, dtype=float)\n\n        # Handle edge cases f=0 and f=1 (Cases 4 and 5)\n        if f == 0.0 or f == 1.0:\n            eps_star = eps2 if f == 0.0 else eps1\n            \n            # For a homogeneous cell, both models should be exact and identical.\n            # Anisotropic model tensor\n            eps_aniso_tensor = np.identity(2) * eps_star\n            # Isotropic model scalar\n            eps_iso_scalar = eps_star\n\n            D_aniso = eps_aniso_tensor @ E\n            D_iso = eps_iso_scalar * E\n            D_star = eps_star * E\n\n            # Calculate cell errors\n            norm_D_star = np.linalg.norm(D_star)\n            denom_error = max(norm_D_star, 1e-15)\n\n            delta_cell_aniso = np.linalg.norm(D_aniso - D_star) / denom_error\n            delta_cell_iso = np.linalg.norm(D_iso - D_star) / denom_error\n\n            # Append boolean results for the checks\n            all_results.append(delta_cell_aniso = 1e-12)\n            all_results.append(delta_cell_iso = 1e-12)\n            continue\n\n        # General case for 0  f  1 (Cases 1, 2, 3)\n\n        # 1. Compute anisotropic effective permittivity tensor\n        # Effective permittivities in the interface-aligned frame\n        eps_t = f * eps1 + (1 - f) * eps2  # Tangential (arithmetic mean)\n        eps_n = 1.0 / (f / eps1 + (1 - f) / eps2) # Normal (harmonic mean)\n\n        # Construct the tensor in Cartesian coordinates\n        c, s = np.cos(theta), np.sin(theta)\n        eps_xx = eps_n * c**2 + eps_t * s**2\n        eps_yy = eps_n * s**2 + eps_t * c**2\n        eps_xy = (eps_n - eps_t) * c * s\n        eps_aniso_tensor = np.array([[eps_xx, eps_xy], [eps_xy, eps_yy]])\n\n        # 2. Compute naive isotropic average permittivity\n        eps_iso_scalar = eps_t\n        eps_iso_tensor = np.identity(2) * eps_iso_scalar\n\n        # 3. Compute D vectors\n        D_aniso = eps_aniso_tensor @ E\n        D_iso = eps_iso_tensor @ E\n\n        # 4. Compute normal component errors\n        n_vec = np.array([c, s])\n        E_dot_n = np.dot(n_vec, E)\n        \n        eps_n_theory = eps_n\n        D_n_theory_val = eps_n_theory * E_dot_n\n        \n        D_aniso_dot_n = np.dot(n_vec, D_aniso)\n        D_iso_dot_n = np.dot(n_vec, D_iso)\n\n        denom_error = max(abs(D_n_theory_val), 1e-15)\n        delta_n_aniso = abs(D_aniso_dot_n - D_n_theory_val) / denom_error\n        delta_n_iso = abs(D_iso_dot_n - D_n_theory_val) / denom_error\n\n        # Append boolean results based on the specific test case checks\n        if i == 0 or i == 2: # Cases 1 and 3\n            all_results.append(delta_n_aniso = 1e-12)\n            all_results.append(delta_n_iso > 1e-6)\n        elif i == 1: # Case 2\n            all_results.append(delta_n_aniso = 1e-12)\n            all_results.append(delta_n_iso = 1e-12)\n\n    # Final print statement in the exact required format.\n    # The order of tests in output is (1 aniso, 1 iso, 2 aniso, 2 iso, 3 aniso, 3 iso, 4 aniso, 4 iso, 5 aniso, 5 iso)\n    # The loop processes them in order 1,2,3,4,5. The list `all_results` will be in the correct order.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}