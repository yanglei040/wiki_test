{
    "hands_on_practices": [
        {
            "introduction": "波导是约束和引导电磁波能量的基本结构。本练习将超越全理想电导体（PEC）边界的标准情况，通过分析一个由PEC和理想磁导体（PMC）混合构成的波导，来深化您对边界条件的理解。通过从第一性原理推导其色散关系，您将直接看到边界条件如何决定波导支持的传播模式，这是分析和设计新型波导结构的一项核心分析技能 。",
            "id": "3338766",
            "problem": "一个无损耗、无源、均匀、各向同性的矩形波导占据区域 $0 \\le x \\le a$，$0 \\le y \\le b$，并沿 $z$ 轴无限延伸。位于 $x=0$ 和 $y=0$ 的壁是理想电导体 (PEC)，而位于 $x=a$ 和 $y=b$ 的相对壁是理想磁导体 (PMC)，在角点处形成 PEC 和 PMC 之间的四个线结。假设时谐场，其相量表示法为 $\\exp(j \\omega t)$，材料参数为自由空间参数 $\\epsilon_0$ 和 $\\mu_0$。考虑相对于 $z$ 轴的横磁 (TM$_z$) 模，其中 $H_z=0$ 且 $E_z \\neq 0$。\n\n从麦克斯韦方程组和 PEC/PMC 边界条件出发，推导横截面上 $E_z(x,y)$ 的标量边值问题，并证明在这种混合边界波导中，TM$_z$ 模的色散关系具有以下形式：\n$$\\beta^2 \\;=\\; k^2 \\;-\\; \\lambda_x^2 \\;-\\; \\lambda_y^2,$$\n其中横向分离常数 $\\lambda_x$ 和 $\\lambda_y$ 由 PEC/PMC 壁所隐含的混合狄利克雷-诺伊曼边界条件确定。然后，对于对应于最小正 $\\lambda_x$ 和 $\\lambda_y$ 的最低阶 TM$_z$ 模，当 $a = 1.00 \\times 10^{-2}$ m 且 $b = 2.00 \\times 10^{-2}$ m 时，计算在真空中频率为 $f = 15.0 \\times 10^9$ Hz 时的传播常数 $\\beta$。以弧度/米为单位表示最终的 $\\beta$ 值，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导在具有混合理想电导体 (PEC) 和理想磁导体 (PMC) 壁的矩形波导中 TM$_z$ 模的色散关系，并计算在特定条件下最低阶模的传播常数 $\\beta$。\n\n分析始于在无源、均匀、各向同性介质 ($\\epsilon_0$, $\\mu_0$) 中的时谐麦克斯韦方程组：\n$$ \\nabla \\times \\mathbf{E} = -j\\omega\\mu_0 \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j\\omega\\epsilon_0 \\mathbf{E} $$\n对于沿 z 轴的波传播，假定场的相量依赖形式为 $\\exp(-j\\beta z)$，其中 $\\beta$ 是传播常数。这意味着对 z 的偏导数可以用乘以 $-j\\beta$ 来代替。\n\n对于横磁 (TM$_z$) 模，轴向磁场分量为零，$H_z = 0$，而轴向电场分量 $E_z$ 非零。电场的波动方程为 $(\\nabla^2 + k^2)\\mathbf{E} = 0$，其中 $k^2 = \\omega^2 \\mu_0 \\epsilon_0$。该矢量波动方程的 z 分量给出了 $E_z$ 的标量亥姆霍兹方程：\n$$ (\\nabla^2 + k^2) E_z = 0 $$\n展开拉普拉斯算子 $\\nabla^2 = \\nabla_t^2 + \\frac{\\partial^2}{\\partial z^2}$，其中 $\\nabla_t^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ 是横向拉普拉斯算子，并使用 $\\frac{\\partial^2}{\\partial z^2} = (-j\\beta)^2 = -\\beta^2$，我们得到波导横截面上 $E_z(x,y)$ 的控制偏微分方程 (PDE)：\n$$ \\frac{\\partial^2 E_z}{\\partial x^2} + \\frac{\\partial^2 E_z}{\\partial y^2} + (k^2 - \\beta^2) E_z = 0 $$\n这是一个二维标量亥姆霍兹方程。我们使用分离变量法求解，令 $E_z(x,y) = X(x)Y(y)$。将其代入 PDE 中得到：\n$$ Y(y)\\frac{d^2X}{dx^2} + X(x)\\frac{d^2Y}{dy^2} + (k^2 - \\beta^2)X(x)Y(y) = 0 $$\n两边同除以 $X(x)Y(y)$ 可分离变量：\n$$ \\frac{1}{X}\\frac{d^2X}{dx^2} + \\frac{1}{Y}\\frac{d^2Y}{dy^2} = -(k^2 - \\beta^2) $$\n左侧由一个只依赖于 x 的项和一个只依赖于 y 的项组成。要使它们的和为常数，每一项都必须是常数。我们定义分离常数 $-\\lambda_x^2$ 和 $-\\lambda_y^2$：\n$$ \\frac{1}{X}\\frac{d^2X}{dx^2} = -\\lambda_x^2 \\implies \\frac{d^2X}{dx^2} + \\lambda_x^2 X = 0 $$\n$$ \\frac{1}{Y}\\frac{d^2Y}{dy^2} = -\\lambda_y^2 \\implies \\frac{d^2Y}{dy^2} + \\lambda_y^2 Y = 0 $$\n将这些代入分离后的方程中得到 $-\\lambda_x^2 - \\lambda_y^2 = -(k^2 - \\beta^2)$。重新整理，我们得到色散关系：\n$$ \\beta^2 = k^2 - \\lambda_x^2 - \\lambda_y^2 $$\n这证实了问题陈述的第一部分。$\\lambda_x$ 和 $\\lambda_y$ 的值由边界条件确定。\n\n接下来，我们确定 $E_z(x,y)$ 的边界条件。\n1.  **PEC 壁** ($x=0$, $y=0$): 电场的切向分量必须为零。轴向场 $E_z$ 与所有四个壁都相切。\n    -   在 $x=0$ 处：$E_z(0, y) = 0$。这是一个狄利克雷条件。\n    -   在 $y=0$ 处：$E_z(x, 0) = 0$。这是一个狄利克雷条件。\n2.  **PMC 壁** ($x=a$, $y=b$): 磁场的切向分量必须为零。对于 TM$_z$ 模，横向场可以用 $E_z$ 表示：\n    $$ \\mathbf{E}_t = -\\frac{j\\beta}{k_c^2} \\nabla_t E_z $$\n    $$ \\mathbf{H}_t = -\\frac{j\\omega\\epsilon_0}{k_c^2} \\hat{z} \\times \\nabla_t E_z $$\n    其中 $k_c^2 = k^2 - \\beta^2 = \\lambda_x^2 + \\lambda_y^2$。展开 $\\mathbf{H}_t = H_x\\hat{x} + H_y\\hat{y}$ 和 $\\nabla_t E_z = \\frac{\\partial E_z}{\\partial x}\\hat{x} + \\frac{\\partial E_z}{\\partial y}\\hat{y}$：\n    $$ \\mathbf{H}_t = -\\frac{j\\omega\\epsilon_0}{k_c^2} \\left( \\hat{z} \\times \\left( \\frac{\\partial E_z}{\\partial x}\\hat{x} + \\frac{\\partial E_z}{\\partial y}\\hat{y} \\right) \\right) = -\\frac{j\\omega\\epsilon_0}{k_c^2} \\left( \\frac{\\partial E_z}{\\partial x}\\hat{y} - \\frac{\\partial E_z}{\\partial y}\\hat{x} \\right) $$\n    -   在 $x=a$ 处：$\\mathbf{H}$ 的切向分量是 $H_y$。PMC 条件是 $H_y(a, y) = 0$。从 $\\mathbf{H}_t$ 的表达式可知，这意味着 $\\frac{\\partial E_z}{\\partial x}(a, y) = 0$。这是一个诺伊曼条件。\n    -   在 $y=b$ 处：$\\mathbf{H}$ 的切向分量是 $H_x$。PMC 条件是 $H_x(x, b) = 0$。这意味着 $\\frac{\\partial E_z}{\\partial y}(x, b) = 0$。这是一个诺伊曼条件。\n\n现在，我们用这些混合边界条件求解 $X(x)$ 和 $Y(y)$ 的常微分方程。\n对于 $X(x)$：通解是 $X(x) = C_1 \\cos(\\lambda_x x) + C_2 \\sin(\\lambda_x x)$。\n-   $X(0) = 0 \\implies C_1 = 0$，所以 $X(x) = C_2 \\sin(\\lambda_x x)$。\n-   $\\frac{dX}{dx}(a) = 0 \\implies C_2 \\lambda_x \\cos(\\lambda_x a) = 0$。对于非平凡解（$C_2 \\neq 0, \\lambda_x \\neq 0$），必须有 $\\cos(\\lambda_x a) = 0$。\n-   这得出 $\\lambda_x a = \\frac{(2m-1)\\pi}{2}$，其中 $m = 1, 2, 3, \\ldots$。因此，$\\lambda_x = \\frac{(2m-1)\\pi}{2a}$。\n\n对于 $Y(y)$：通解是 $Y(y) = D_1 \\cos(\\lambda_y y) + D_2 \\sin(\\lambda_y y)$。\n-   $Y(0) = 0 \\implies D_1 = 0$，所以 $Y(y) = D_2 \\sin(\\lambda_y y)$。\n-   $\\frac{dY}{dy}(b) = 0 \\implies D_2 \\lambda_y \\cos(\\lambda_y b) = 0$。对于非平凡解（$D_2 \\neq 0, \\lambda_y \\neq 0$），必须有 $\\cos(\\lambda_y b) = 0$。\n-   这得出 $\\lambda_y b = \\frac{(2n-1)\\pi}{2}$，其中 $n = 1, 2, 3, \\ldots$。因此，$\\lambda_y = \\frac{(2n-1)\\pi}{2b}$。\n\n最低阶 TM$_z$ 模对应于 $\\lambda_x$ 和 $\\lambda_y$ 的最小正值，这在 $m=1$ 和 $n=1$ 时出现。\n$$ \\lambda_x = \\frac{\\pi}{2a} \\quad \\text{和} \\quad \\lambda_y = \\frac{\\pi}{2b} $$\n传播常数 $\\beta$ 由下式给出：\n$$ \\beta = \\sqrt{k^2 - \\lambda_x^2 - \\lambda_y^2} = \\sqrt{\\left(\\frac{2\\pi f}{c_0}\\right)^2 - \\left(\\frac{\\pi}{2a}\\right)^2 - \\left(\\frac{\\pi}{2b}\\right)^2} $$\n其中 $c_0 = 1/\\sqrt{\\mu_0\\epsilon_0}$ 是真空中的光速。\n\n现在，我们用给定的参数计算 $\\beta$ 的数值：\n-   频率 $f = 15.0 \\times 10^9$ Hz\n-   尺寸 $a = 1.00 \\times 10^{-2}$ m\n-   尺寸 $b = 2.00 \\times 10^{-2}$ m\n-   光速 $c_0 = 299792458$ m/s\n\n首先，我们计算平方根内的各项：\n$$ k^2 = \\left(\\frac{2\\pi f}{c_0}\\right)^2 = \\left(\\frac{2\\pi \\times 15.0 \\times 10^9}{299792458}\\right)^2 \\approx 98822.93 \\text{ rad}^2/\\text{m}^2 $$\n$$ \\lambda_x^2 = \\left(\\frac{\\pi}{2a}\\right)^2 = \\left(\\frac{\\pi}{2 \\times 1.00 \\times 10^{-2}}\\right)^2 = (50\\pi)^2 \\approx 24674.01 \\text{ rad}^2/\\text{m}^2 $$\n$$ \\lambda_y^2 = \\left(\\frac{\\pi}{2b}\\right)^2 = \\left(\\frac{\\pi}{2 \\times 2.00 \\times 10^{-2}}\\right)^2 = (25\\pi)^2 \\approx 6168.50 \\text{ rad}^2/\\text{m}^2 $$\n截止波数的平方为 $k_c^2 = \\lambda_x^2 + \\lambda_y^2 \\approx 30842.51 \\text{ rad}^2/\\text{m}^2$。\n由于 $k^2 > k_c^2$，该模式是传播模。\n\n现在，我们计算 $\\beta^2$：\n$$ \\beta^2 = k^2 - k_c^2 \\approx 98822.93 - 30842.51 = 67980.42 \\text{ rad}^2/\\text{m}^2 $$\n最后，我们通过取平方根来计算 $\\beta$：\n$$ \\beta = \\sqrt{67980.42} \\approx 260.7305 \\text{ rad/m} $$\n将结果四舍五入到四位有效数字得到 $260.7$。\n\n最终值：将 $260.7305$ 四舍五入到四位有效数字为 $260.7$。",
            "answer": "$$\\boxed{260.7}$$"
        },
        {
            "introduction": "在研究了开放结构中的行波之后，我们将注意力转向封闭谐振腔中的驻波。本练习探讨了腔体本征模谱的一个深刻物理现象：简并解除。您将通过计算比较全PEC腔与混合PEC-PMC腔的谐振频率，亲眼见证边界条件的改变如何破坏系统对称性，并使原本频率相同的模式发生分裂 。这项实践还将引导您通过数值验证电磁对偶性，从而巩固对这一基本对称性的理解。",
            "id": "3338758",
            "problem": "考虑一个二维矩形电磁谐振腔，其尺寸为 $a$ (沿 $x$ 方向) 和 $b$ (沿 $y$ 方向)，腔内填充均匀、各向同性的真空，其介电常数为 $\\varepsilon_0$，磁导率为 $\\mu_0$。假设场为时谐场，角频率为 $\\omega$，并使用工程相量表示法 $e^{j \\omega t}$。谐振腔的壁施加理想化的边界条件，可以是理想电导体 (PEC) 或理想磁导体 (PMC)。根据定义，在 PEC 表面，电场的切向分量为零；在 PMC 表面，磁场的切向分量为零。在矩形几何结构的横向电磁分解中，定义关于 z 轴的横磁 (TM$_z$) 极化为纵向电场分量 $E_z$ 非零而纵向磁场分量 $H_z$ 为零的情形；定义关于 z 轴的横电 (TE$_z$) 极化为纵向磁场分量 $H_z$ 非零而纵向电场分量 $E_z$ 为零的情形。\n\n从频域中的麦克斯韦方程组和适当的边界条件出发，纵向场分量满足一个关于横向坐标的标量亥姆霍兹方程，其边界条件映射为纵向标量势上的 Dirichlet 或 Neumann 类型，具体取决于极化方式和壁的类型。你的任务是：\n\n- 从第一性原理出发，推导对于 TM$_z$ 和 TE$_z$ 极化，在每个壁上纵向标量势适用哪种边界类型（Dirichlet 或 Neumann），推导过程需从频域麦克斯韦方程组、本构关系以及 PEC 和 PMC 的定义开始，不得依赖快捷公式。\n- 对标量亥姆霍兹方程使用分离变量法，构建在 $x$ 和 $y$ 方向上允许的横向波数谱，适用于下面测试套件中出现的所有壁类型组合。结合这些波数谱，得到谐振角频率 $\\omega$ 及相应的线性频率 $f = \\omega/(2\\pi)$（单位：赫兹）。使用 $c = \\frac{1}{\\sqrt{\\varepsilon_0 \\mu_0}} = 299\\,792\\,458\\,\\mathrm{m/s}$。\n- 实现一个程序，对于测试套件中的每种几何结构，计算 TM$_z$ 和 TE$_z$ 极化下最低的 $K$ 个不同的线性频率 $f$，并按升序排列。频率的独特性必须通过对落在绝对容差 $\\tau$ 内的频率进行聚类来确定；每个聚类的代表值可取为该聚类中的最小元素。\n- 将简并度大于 1 的聚类定义为一个简并群。对于测试套件中的每种几何结构，计算最低的 $K$ 个不同 TM$_z$ 频率中有多少个简并群，适用于以下两种情况：\n  1. 一个基准腔，其所有 $x$ 方向壁和 $y$ 方向壁均为 PEC。\n  2. 一个混合腔，其中一个 $x$ 方向壁为 PEC，相对的另一个 $x$ 方向壁为 PMC，而两个 $y$ 方向壁均为 PEC。\n- 通过比较基准腔和混合腔中简并群的数量来识别简并解除；数量的减少表明混合壁配置导致了简并解除。\n- 通过构建对偶几何结构来验证电磁对偶性，在对偶几何中所有壁类型都进行交换 (PEC $\\leftrightarrow$ PMC)，并比较其频谱：数值上确认原始混合壁腔的 TM$_z$ 频谱在容差 $\\tau$ 内等于其对偶腔的 TE$_z$ 频谱，验证范围为最低的 $K$ 个不同频率。如果等式对所有 $K$ 个值都成立，则报告一个布尔值 $true$，否则报告 $false$。\n\n你的程序应为每个测试用例输出一个包含三个值的列表：基准腔中最低 $K$ 个不同 TM$_z$ 频率的简并群整数数量，混合腔中最低 $K$ 个不同 TM$_z$ 频率的简并群整数数量，以及一个布尔值，指示对偶性等式是否对最低 $K$ 个不同频率成立。将所有测试用例的结果汇总成单行输出，该行输出包含一个由逗号分隔的列表，并用方括号括起来。\n\n使用以下测试套件，所有尺寸单位为米，频率单位为赫兹：\n\n- 测试用例 1：$a = 0.20$，$b = 0.20$，$K = 10$，$\\tau = 1\\times 10^{-9}$。混合腔壁：在 $x=0$ 处为 PEC，在 $x=a$ 处为 PMC，在 $y=0$ 和 $y=b$ 处为 PEC。基准腔的所有四个壁均为 PEC。\n- 测试用例 2：$a = 0.30$，$b = 0.50$，$K = 10$，$\\tau = 1\\times 10^{-9}$。混合腔壁：在 $x=0$ 处为 PEC，在 $x=a$ 处为 PMC，在 $y=0$ 和 $y=b$ 处为 PEC。基准腔的所有四个壁均为 PEC。\n- 测试用例 3：$a = 0.25$，$b = 0.25$，$K = 12$，$\\tau = 1\\times 10^{-9}$。混合腔壁：在 $x=0$ 处为 PEC，在 $x=a$ 处为 PMC，在 $y=0$ 和 $y=b$ 处为 PEC。基准腔的所有四个壁均为 PEC。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个由逗号分隔的列表并用方括号括起来的结果，每个测试用例的结果本身就是一个形如 $[d_{\\mathrm{baseline}}, d_{\\mathrm{mixed}}, \\mathrm{duality\\_ok}]$ 的列表，例如 $[[2,1,true],[0,0,true],[3,1,true]]$。",
            "solution": "该问题经验证有效，要求对二维矩形谐振腔的模式进行全面分析，包括边界条件推导、频谱计算、简并性分析和对偶性验证。\n\n### 1. 边界条件推导\n\n纵向标量势 $\\psi$（对于TM$_z$为$E_z$，对于TE$_z$为$H_z$）的边界条件类型源于PEC和PMC的定义。\n\n- **TM$_z$ 极化 ($\\psi = E_z$)**\n  - **PEC壁**: 定义要求切向电场为零 ($\\mathbf{E}_{tan} = \\mathbf{0}$)。由于$E_z$分量与平行于z轴的壁相切，因此在PEC壁上 $E_z = 0$。这是一个**狄利克雷 (Dirichlet)** 条件。\n  - **PMC壁**: 定义要求切向磁场为零 ($\\mathbf{H}_{tan} = \\mathbf{0}$)。横向磁场由 $\\mathbf{H}_t = \\frac{j}{\\omega \\mu_0} (\\hat{z} \\times \\nabla_t E_z)$ 给出。在壁处，法向为 $\\mathbf{n}$，切向磁场为 $\\mathbf{H}_t - (\\mathbf{H}_t \\cdot \\mathbf{n})\\mathbf{n}$。对于垂直于 $x$ 或 $y$ 轴的壁，$\\mathbf{H}_t$ 的一个分量将是切向的。该分量为零的要求最终转化为 $E_z$ 的法向导数为零，即 $\\frac{\\partial E_z}{\\partial n} = 0$。这是一个**诺伊曼 (Neumann)** 条件。\n\n- **TE$_z$ 极化 ($\\psi = H_z$)**\n  - **PEC壁**: 定义要求切向电场为零。横向电场由 $\\mathbf{E}_t = -\\frac{j}{\\omega \\varepsilon_0} (\\hat{z} \\times \\nabla_t H_z)$ 给出。与TM$_z$情况下的PMC壁类似，这导致了 $H_z$ 的法向导数为零，$\\frac{\\partial H_z}{\\partial n} = 0$。这是一个**诺伊曼 (Neumann)** 条件。\n  - **PMC壁**: 定义要求切向磁场为零。由于$H_z$分量本身与壁相切，因此在PMC壁上 $H_z = 0$。这是一个**狄利克雷 (Dirichlet)** 条件。\n\n### 2. 分离变量与频谱\n标量势 $\\psi$ 满足亥姆霍兹方程 $(\\nabla_t^2 + k_c^2)\\psi = 0$，其中 $k_c^2 = k_x^2 + k_y^2 = (\\omega/c)^2$。使用分离变量法 $\\psi(x,y) = X(x)Y(y)$，我们得到两个常微分方程，其解和允许的波数 $k_x, k_y$ 由边界条件确定：\n- **Dirichlet-Dirichlet (DD)** on $[0,a]$: $X(x) \\propto \\sin(k_x x)$ with $k_x = m\\pi/a, m=1,2,\\dots$\n- **Dirichlet-Neumann (DN)** on $[0,a]$: $X(x) \\propto \\sin(k_x x)$ with $k_x = (m-1/2)\\pi/a, m=1,2,\\dots$\n\n对于每对模式指数 $(m, n)$，谐振频率为 $f_{mn} = \\frac{c}{2\\pi} \\sqrt{k_x(m)^2 + k_y(n)^2}$。\n\n### 3. 算法设计\n该程序实现了以下逻辑：\n- **频谱计算**: 根据极化和腔壁类型，确定 $x$ 和 $y$ 方向的边界条件组合（DD或DN）。然后，通过在足够大的 $(m,n)$ 索引网格上进行迭代来生成频率。排除 $k_c=0$ 的非谐振情况。\n- **简并性分析**: 将计算出的频率按升序排序。通过将落在彼此绝对容差 $\\tau$ 范围内的频率分组来对频率进行聚类。每个聚类代表一个独特的谐振频率。如果一个聚类包含多个频率（例如，由于对称性，TM$_{mn}$ 和 TM$_{nm}$ 模式的频率相同），则它被计为一个简并群。\n- **对偶性验证**:\n  - **原始混合腔 (TM$_z$)**: 壁是PEC($x=0$), PMC($x=a$)；PEC($y=0,b$)。$E_z$ 的BCs是 $x$ 方向的DN和 $y$ 方向的DD。\n  - **对偶腔 (TE$_z$)**: 壁是PMC($x=0$), PEC($x=a$)；PMC($y=0,b$)。$H_z$ 的BCs是：在 $x$ 方向上，PMC为Dirichlet，PEC为Neumann (DN)；在 $y$ 方向上，PMC为Dirichlet (DD)。\n  - 由于两种情况下的标量亥姆霍兹问题在数学上是相同的，它们的频谱也必须相同。程序通过计算这两个频谱并验证它们的前 $K$ 个元素在容差 $\\tau$ 内是否一致来确认这一点。\n\n所提供的Python代码正确实现了这一逻辑，为每个测试用例计算简并群的数量和对偶性验证布尔值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef get_spectrum_stats(a, b, x_bc_type, y_bc_type, K, tau):\n    \"\"\"\n    Computes the K lowest distinct frequencies and degeneracy count for a given cavity configuration.\n\n    Args:\n        a (float): Cavity dimension along x.\n        b (float): Cavity dimension along y.\n        x_bc_type (str): Boundary condition type on x-walls ('DD', 'DN', etc.).\n        y_bc_type (str): Boundary condition type on y-walls.\n        K (int): Number of lowest distinct frequencies to find.\n        tau (float): Absolute tolerance for clustering frequencies.\n\n    Returns:\n        tuple: A tuple containing:\n            - list: The K lowest distinct frequencies.\n            - int: The number of degeneracy groups among these K frequencies.\n    \"\"\"\n    c = 299792458.0  # Speed of light in m/s\n\n    kx_func, m_min = None, 0\n    if x_bc_type == 'DD':\n        kx_func = lambda m_val: m_val * np.pi / a\n        m_min = 1\n    elif x_bc_type == 'DN':\n        kx_func = lambda m_val: (m_val - 0.5) * np.pi / a\n        m_min = 1\n\n    ky_func, n_min = None, 0\n    if y_bc_type == 'DD':\n        ky_func = lambda n_val: n_val * np.pi / b\n        n_min = 1\n    elif y_bc_type == 'DN':\n        ky_func = lambda n_val: (n_val - 0.5) * np.pi / b\n        n_min = 1\n\n    # Generate frequencies using an expanding grid of (m, n) indices\n    # to ensure we capture at least K distinct frequencies.\n    # An index range up to 3*K is a safe upper bound for typical mode densities.\n    max_idx = int(3 * K)\n    m_range = np.arange(m_min, max_idx)\n    n_range = np.arange(n_min, max_idx)\n    \n    m_grid, n_grid = np.meshgrid(m_range, n_range)\n\n    kx_grid = kx_func(m_grid)\n    ky_grid = ky_func(n_grid)\n\n    kc_sq_grid = kx_grid**2 + ky_grid**2\n    # Exclude non-resonant modes (k_c = 0)\n    valid_indices = kc_sq_grid > 1e-12 \n    \n    freqs = (c / (2 * np.pi)) * np.sqrt(kc_sq_grid[valid_indices])\n    sorted_freqs = np.sort(freqs)\n\n    # Cluster frequencies\n    if len(sorted_freqs) == 0:\n        return [], 0\n    \n    clusters = []\n    current_cluster = [sorted_freqs[0]]\n    for f in sorted_freqs[1:]:\n        if f - current_cluster[0] = tau:\n            current_cluster.append(f)\n        else:\n            clusters.append(current_cluster)\n            current_cluster = [f]\n    clusters.append(current_cluster)\n\n    k_clusters = clusters[:K]\n    \n    distinct_freqs = [cl[0] for cl in k_clusters]\n    degeneracy_count = sum(1 for cl in k_clusters if len(cl) > 1)\n\n    return distinct_freqs, degeneracy_count\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and generate final output.\n    \"\"\"\n    test_cases = [\n        {'a': 0.20, 'b': 0.20, 'K': 10, 'tau': 1e-9},\n        {'a': 0.30, 'b': 0.50, 'K': 10, 'tau': 1e-9},\n        {'a': 0.25, 'b': 0.25, 'K': 12, 'tau': 1e-9}\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        a, b, K, tau = case['a'], case['b'], case['K'], case['tau']\n\n        # 1. Baseline cavity: all PEC, TMz polarization\n        # PEC -> E_tan = 0 -> E_z = 0 (Dirichlet)\n        # So, BCs are D-D for x-walls and D-D for y-walls.\n        _, d_baseline = get_spectrum_stats(a, b, 'DD', 'DD', K, tau)\n\n        # 2. Mixed cavity: PEC at x=0, PMC at x=a, PEC at y=0,b. TMz polarization.\n        # x-walls: PEC at x=0 (Dirichlet), PMC at x=a (Neumann) -> D-N\n        # y-walls: PEC at y=0,b (Dirichlet) -> D-D\n        distinct_freqs_mixed_tm, d_mixed = get_spectrum_stats(a, b, 'DN', 'DD', K, tau)\n        \n        # 3. Duality check: Dual of mixed cavity, TEz polarization.\n        # Dual cavity walls: PMC at x=0, PEC at x=a, PMC at y=0,b.\n        # TEz polarization on dual cavity:\n        # x-walls: PMC at x=0 (H_z=0, Dirichlet), PEC at x=a (d(H_z)/dn=0, Neumann) -> D-N\n        # y-walls: PMC at y=0,b (H_z=0, Dirichlet) -> D-D\n        # The formulation is identical to the mixed cavity TMz case.\n        distinct_freqs_dual_te, _ = get_spectrum_stats(a, b, 'DN', 'DD', K, tau)\n\n        # Compare spectra for duality\n        duality_ok = np.allclose(distinct_freqs_mixed_tm, distinct_freqs_dual_te, rtol=0, atol=tau)\n\n        all_results.append([d_baseline, d_mixed, duality_ok])\n\n    # Format the final output string exactly as required\n    str_results = []\n    for r in all_results:\n        str_results.append(f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\")\n    \n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了获得对波传播更直观的认识，我们将视角从频域切换到时域。本练习将指导您实现一个一维时域有限差分（FDTD）仿真，这是一种在计算电磁学中极为强大的工具，用于模拟脉冲在具有混合PEC-PMC边界的腔体内的动态行为。通过将您的仿真结果与镜像理论的解析预测进行对比，您将在抽象的物理模型与具体的数值实现和验证之间建立起关键的联系 。",
            "id": "3338736",
            "problem": "考虑一个一维时域电磁传播问题，该问题发生在一个沿空间坐标 $x \\in [0,L]$ 的无损、源激励线段上。该线段左端 $x=0$ 处为理想电导体 (PEC) 边界，右端 $x=L$ 处为理想磁导体 (PMC) 边界。介质为自由空间，其介电常数为 $\\epsilon_0$，磁导率为 $\\mu_0$，因此相速度为 $v = c_0 = 1/\\sqrt{\\epsilon_0 \\mu_0}$。使用时域有限差分 (FDTD) 方法来推进横电磁 (TEM) 配置下的耦合场：一个仅在 $x$ 和 $t$ 上变化的电场分量 $E_y(x,t)$ 和一个磁场分量 $H_z(x,t)$。强制执行边界条件 $E_y(0,t) = 0$ (PEC) 和 $H_z(L,t) = 0$ (PMC)。\n\n从无源、线性、各向同性、均匀介质中的麦克斯韦方程组微分形式出发，\n$$\\nabla \\times \\mathbf{E} = -\\mu_0 \\frac{\\partial \\mathbf{H}}{\\partial t}, \\quad \\nabla \\times \\mathbf{H} = \\epsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t},$$\n将其特化为一维情况，其中 $E_y$ 和 $H_z$ 非零且是 $x$ 和 $t$ 的函数，并推导出一个交错网格 (Yee 型) 更新方案。通过在每个时间步向单个网格位置 $x=x_s$ 处的电场添加一个随时间变化的激励 $s(t)$ 来实现软源注入。设激励为 Ricker 子波\n$$s(t) = \\left(1 - 2\\pi^2 f_0^2 (t - t_0)^2\\right) \\exp\\left(-\\pi^2 f_0^2 (t - t_0)^2\\right),$$\n其中 $f_0$ 是中心频率（单位 $\\mathrm{Hz}$），$t_0$ 是中心时间（单位 $\\mathrm{s}$）。使用满足 Courant 稳定性的时间步长 $ \\Delta t = S \\, \\Delta x / c_0$，其中 Courant 因子 $S \\in (0,1]$，空间步长 $\\Delta x$ 均匀。\n\n将观测到的瞬态场模式通过电磁镜像理论与虚拟镜像源联系起来。在一维混合 PEC/PMC 终端的情况下，虚拟源位置的集合是通过将物理源 $x_s$ 跨越边界反复镜像生成的，从而得到无限集合\n$$x_{\\text{img}} = 2 m L \\pm x_s, \\quad m \\in \\mathbb{Z},$$\n以及在观测点 $x=x_o$ 处相应的到达时间为\n$$t_{\\text{arr}} = t_0 + \\frac{|x_o - x_{\\text{img}}|}{c_0}。$$\n尽管在 PEC 和 PMC 处的反射符号会改变振幅和极性，但在这种一维设置中，时间的到达纯粹由路径长度决定。\n\n您的程序必须：\n- 为 $E_y$ 和 $H_z$ 构建一维 Yee 晶格，实现与麦克斯韦旋度方程以及指定的 PEC 和 PMC 边界条件一致的 FDTD 时间步进，并在 $x=x_s$ 处注入 $s(t)$。\n- 在整个模拟过程中记录观测坐标 $x_o$ 处的电场 $E_y(x_o,t)$。\n- 从记录的轨迹中，提取前 $K$ 个到达时间，即 $|E_y(x_o,t)|$ 中高于数据自适应阈值的前 $K$ 个最早的局部最大值，以秒为单位表示。\n- 根据镜像理论计算解析到达时间，即不超过总模拟时间窗口的最早的 $K$ 个 $t_{\\text{arr}}$ 值。\n\n为进行比较，将每个测试用例的结果声明为一个布尔值，其计算方式如下：当且仅当检测到的到达次数至少为 $K$ 次，并且每个模拟到达时间与其对应的解析到达时间（按升序配对）之间的绝对差值小于指定的容差 $\\delta_t$ 时，该值为真。设置容差为 $\\delta_t = 5 \\Delta t$。所有计算出的时间均以秒为单位，所有容差均基于秒。\n\n用自由空间值 $\\epsilon_0$ 和 $\\mu_0$ 实现该程序，并使用以下参数集的测试套件。所有空间量必须以米 ($\\mathrm{m}$) 为单位，时间以秒 ($\\mathrm{s}$) 为单位，频率以赫兹 ($\\mathrm{Hz}$) 为单位。对于每种情况，使用 Courant 因子 $S = 0.99$。\n\n- 情况 A（常规检查）：$L = 1.0\\,\\mathrm{m}$，$N = 401$ 个 $E_y$ 网格点，$x_s = 0.22\\,\\mathrm{m}$，$x_o = 0.77\\,\\mathrm{m}$，$f_0 = 1.2 \\times 10^8\\,\\mathrm{Hz}$，$t_0 = 5.0 \\times 10^{-9}\\,\\mathrm{s}$，总模拟时间 $T = 3.5 \\times 10^{-8}\\,\\mathrm{s}$，$K = 6$ 次到达。\n- 情况 B（较短线段，偏离中心的观测）：$L = 0.5\\,\\mathrm{m}$，$N = 401$，$x_s = 0.10\\,\\mathrm{m}$，$x_o = 0.45\\,\\mathrm{m}$，$f_0 = 8.0 \\times 10^7\\,\\mathrm{Hz}$，$t_0 = 3.0 \\times 10^{-9}\\,\\mathrm{s}$，$T = 2.5 \\times 10^{-8}\\,\\mathrm{s}$，$K = 6$。\n- 情况 C（中等长度，观测点在源左侧）：$L = 0.8\\,\\mathrm{m}$，$N = 301$，$x_s = 0.30\\,\\mathrm{m}$，$x_o = 0.20\\,\\mathrm{m}$，$f_0 = 1.0 \\times 10^8\\,\\mathrm{Hz}$，$t_0 = 4.0 \\times 10^{-9}\\,\\mathrm{s}$，$T = 3.0 \\times 10^{-8}\\,\\mathrm{s}$，$K = 5$。\n\n您的程序应生成一行输出，其中包含三个案例的结果，格式为方括号内以逗号分隔的列表，例如 $[r_A,r_B,r_C]$，其中每个 $r_\\cdot$ 是一个布尔值，表示在所述容差下，模拟到达时间是否与解析到达时间一致。最终输出必须严格采用 $[result1,result2,result3]$ 的形式。",
            "solution": "该问题要求根据基于镜像理论的解析模型，验证一维腔中电磁波模拟到达时间的有效性。模拟将使用时域有限差分 (FDTD) 方法求解麦克斯韦方程组。\n\n### 问题验证\n问题陈述经过严格审查，被确定为**有效的**。它在科学上基于麦克斯韦理论和标准的计算电磁学技术（FDTD、Yee 网格）。它是一个适定的问题，提供了所有必要的物理参数、边界条件、源定义以及明确的验证标准。指定的常数、参数以及边界条件是自洽且物理上合理的。\n\n### FDTD 公式\n该模拟处理的是沿 $x$ 轴传播的一维横电磁 (TEM) 波，其场分量为 $E_y(x,t)$ 和 $H_z(x,t)$。在无源、无损介质中，控制性的麦克斯韦方程组简化为：\n$$ \\frac{\\partial E_y}{\\partial x} = -\\mu_0 \\frac{\\partial H_z}{\\partial t} $$\n$$ \\frac{\\partial H_z}{\\partial x} = -\\epsilon_0 \\frac{\\partial E_y}{\\partial t} $$\n我们采用 Yee 交错网格，其中 $E_y$ 和 $H_z$ 在空间和时间上均相互错开。\n- 电场 $E_y$ 在空间位置 $x_i = i \\Delta x$（其中 $i=0, \\dots, N-1$）和整数时间步长 $t_n = n \\Delta t$ 处采样，表示为 $E_y^n[i]$。\n- 磁场 $H_z$ 在空间位置 $x_{i+1/2} = (i+0.5) \\Delta x$（其中 $i=0, \\dots, N-2$）和半整数时间步长 $t_{n+1/2} = (n+0.5) \\Delta t$ 处采样，表示为 $H_z^{n+1/2}[i]$。\n\n对导数应用中心差分近似，得到 FDTD 更新方程：\n1.  **磁场 ($H_z$) 更新**：\n    $$ H_z^{n+1/2}[i] = H_z^{n-1/2}[i] - \\frac{\\Delta t}{\\mu_0 \\Delta x} \\left( E_y^n[i+1] - E_y^n[i] \\right) $$\n2.  **电场 ($E_y$) 更新**：\n    $$ E_y^{n+1}[i] = E_y^n[i] - \\frac{\\Delta t}{\\epsilon_0 \\Delta x} \\left( H_z^{n+1/2}[i] - H_z^{n+1/2}[i-1] \\right) $$\n\n该方案的稳定性由 Courant 因子 $S=0.99$ 保证。\n\n### 边界与源条件\n1.  **$x=0$ 处的理想电导体 (PEC)**：条件 $E_y(0,t)=0$ 通过在所有时间步长 $n$ 设置 $E_y^n[0] = 0$ 来强制执行。\n\n2.  **$x=L$ 处的理想磁导体 (PMC)**：条件 $H_z(L,t)=0$ 在交错网格上的实现需要特别处理。$E_y$ 在 $i=N-1$ 处的更新需要 $H_z$ 在 $i=N-2$ 和一个“鬼点” $i=N-1$ 处的值。PMC 条件 $H_z(L,t)=0$ 通过在该点（位于 $H_z[N-2]$ 和鬼点 $H_z[N-1]$ 之间）强制 $H_z$ 为零来实现。这可以通过设置 $H_z^{n+1/2}[N-1] = -H_z^{n+1/2}[N-2]$ （反对称性）来实现。将此代入 $E_y[N-1]$ 的更新方程得到：\n    $$ E_y^{n+1}[N-1] = E_y^n[N-1] - \\frac{\\Delta t}{\\epsilon_0 \\Delta x} \\left( (-H_z^{n+1/2}[N-2]) - H_z^{n+1/2}[N-2] \\right) $$\n    $$ E_y^{n+1}[N-1] = E_y^n[N-1] + \\frac{2 \\Delta t}{\\epsilon_0 \\Delta x} H_z^{n+1/2}[N-2] $$\n    这与代码中实现的更新规则一致。\n\n3.  **软源注入**：在每个时间步的 $E_y$ 更新之后，将 Ricker 子波源 $s(t)$ 的值加到源位置 $k_s$ 处的电场上：$E_y^{n+1}[k_s] \\mathrel{+}= s((n+1)\\Delta t)$。\n\n### 解析到达时间与验证\n解析模型使用镜像理论。对于一个由 $x=0$ 处的 PEC 和 $x=L$ 处的 PMC 界定的腔体，物理源在 $x_s$ 处产生的无限镜像源集合位于 $x_{\\text{img}} = 2 m L \\pm x_s$（对于所有整数 $m \\in \\mathbb{Z}$）的位置。来自镜像源的脉冲到达观察者位置 $x_o$ 的时间为 $t_{\\text{arr}} = t_0 + \\frac{|x_o - x_{\\text{img}}|}{c_0}$。问题明确指出，验证仅关心到达时间，而非脉冲的振幅或极性。\n\n验证过程包括：\n1.  运行 FDTD 模拟并记录 $E_y(x_o,t)$。\n2.  通过在 $|E_y(x_o,t)|$ 中寻找超过数据自适应阈值的前 $K$ 个局部最大值来提取模拟到达时间。\n3.  计算前 $K$ 个理论到达时间并按升序排序。\n4.  如果模拟中检测到的到达次数至少为 $K$ 次，并且每对相应的模拟到达时间与解析到达时间之间的绝对差值小于容差 $\\delta_t = 5 \\Delta t$，则验证为 `True`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\nfrom scipy.signal import find_peaks\n\ndef ricker_wavelet(t, t0, f0):\n    \"\"\"\n    Computes the Ricker wavelet s(t) at time t.\n\n    Args:\n        t (float or np.ndarray): Time(s) in seconds.\n        t0 (float): Center time of the wavelet in seconds.\n        f0 (float): Central frequency of the wavelet in Hz.\n\n    Returns:\n        float or np.ndarray: The value of the Ricker wavelet.\n    \"\"\"\n    arg = (np.pi**2) * (f0**2) * ((t - t0)**2)\n    return (1.0 - 2.0 * arg) * np.exp(-arg)\n\ndef calculate_analytical_arrivals(L, xs, xo, t0, c0, T_total, K):\n    \"\"\"\n    Calculates analytical arrival times using image theory for a PEC-PMC cavity.\n\n    Args:\n        L (float): Length of the cavity in meters.\n        xs (float): Source position in meters.\n        xo (float): Observer position in meters.\n        t0 (float): Center time of the source wavelet in seconds.\n        c0 (float): Speed of light in meters per second.\n        T_total (float): Total simulation time in seconds.\n        K (int): Number of arrivals to compute.\n\n    Returns:\n        list: A sorted list of the first K analytical arrival times.\n    \"\"\"\n    arrivals = []\n    # A sufficiently large range for m to find all arrivals within T_total\n    m_range = int(T_total * c0 / (2.0 * L)) + 5\n\n    for m in range(-m_range, m_range + 1):\n        # Image sources at 2*m*L +/- xs\n        x_img1 = 2.0 * m * L + xs\n        x_img2 = 2.0 * m * L - xs\n        \n        t_arr1 = t0 + np.abs(xo - x_img1) / c0\n        t_arr2 = t0 + np.abs(xo - x_img2) / c0\n        \n        if t_arr1 = T_total:\n            arrivals.append(t_arr1)\n        if t_arr2 = T_total:\n            arrivals.append(t_arr2)\n    \n    # Remove duplicates, sort, and take the first K\n    unique_arrivals = sorted(list(set(arrivals)))\n    return unique_arrivals[:K]\n\ndef run_fdtd_simulation(L, N, xs, xo, f0, t0, T, K):\n    \"\"\"\n    Runs a single 1D FDTD simulation case and validates the results against theory.\n    \"\"\"\n    # Physical constants\n    epsilon0 = constants.epsilon_0\n    mu0 = constants.mu_0\n    c0 = constants.c\n\n    # Grid parameters\n    S = 0.99  # Courant factor\n    dx = L / (N - 1)\n    dt = S * dx / c0\n    num_steps = int(np.ceil(T / dt))\n\n    # Field arrays\n    Ey = np.zeros(N, dtype=np.float64)\n    Hz = np.zeros(N - 1, dtype=np.float64)\n    \n    # Source and observer grid indices\n    ks = int(round(xs / dx))\n    ko = int(round(xo / dx))\n\n    # FDTD update coefficients\n    ce = dt / (epsilon0 * dx)\n    ch = dt / (mu0 * dx)\n\n    # Store observed field\n    Ey_observed = np.zeros(num_steps, dtype=np.float64)\n    time_vec = np.arange(num_steps) * dt\n\n    # FDTD time-stepping loop\n    for n in range(num_steps):\n        # Update H-field from E-field (indices 0 to N-2)\n        Hz[:] = Hz[:] - ch * (Ey[1:] - Ey[:-1])\n\n        # Update E-field from H-field (bulk nodes, indices 1 to N-2)\n        Ey[1:-1] = Ey[1:-1] - ce * (Hz[1:] - Hz[:-1])\n\n        # PEC boundary at x=0 (Ey[0]) is kept at 0\n        \n        # PMC boundary at x=L (Ey[N-1])\n        # The update for E_y[N-1] uses a ghost value for H, where H_ghost = -H[N-2]\n        Ey[-1] = Ey[-1] + 2.0 * ce * Hz[-1]\n\n        # Inject source\n        t_current = (n + 1) * dt\n        source_val = ricker_wavelet(t_current, t0, f0)\n        Ey[ks] += source_val\n        \n        # Record field at observer\n        Ey_observed[n] = Ey[ko]\n\n    # Post-processing: Find simulated arrivals from recorded data\n    Ey_abs = np.abs(Ey_observed)\n    # Data-adaptive threshold for peak finding based on signal prominence.\n    max_amp = np.max(Ey_abs)\n    peak_prominence = 0.05 * max_amp if max_amp > 0 else 1.0\n\n    sim_peak_indices, _ = find_peaks(Ey_abs, prominence=peak_prominence)\n    sim_arrivals = sim_peak_indices * dt\n    \n    # Calculate analytical arrivals using the actual discretized grid positions\n    xs_actual = ks * dx\n    xo_actual = ko * dx\n    ana_arrivals = calculate_analytical_arrivals(L, xs_actual, xo_actual, t0, c0, T, K)\n\n    # Validation check\n    if len(sim_arrivals)  K or len(ana_arrivals)  K:\n        return False\n        \n    tolerance = 5.0 * dt\n    \n    for i in range(K):\n        if np.abs(sim_arrivals[i] - ana_arrivals[i]) > tolerance:\n            return False\n\n    return True\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {'L': 1.0, 'N': 401, 'xs': 0.22, 'xo': 0.77, 'f0': 1.2e8, 't0': 5.0e-9, 'T': 3.5e-8, 'K': 6},\n        # Case B\n        {'L': 0.5, 'N': 401, 'xs': 0.10, 'xo': 0.45, 'f0': 8.0e7, 't0': 3.0e-9, 'T': 2.5e-8, 'K': 6},\n        # Case C\n        {'L': 0.8, 'N': 301, 'xs': 0.30, 'xo': 0.20, 'f0': 1.0e8, 't0': 4.0e-9, 'T': 3.0e-8, 'K': 5},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = run_fdtd_simulation(**case_params)\n        results.append(str(result).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}