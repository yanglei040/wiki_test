{
    "hands_on_practices": [
        {
            "introduction": "电磁势的非唯一性是规范理论的核心概念。本练习旨在通过一个具体实例，即一个均匀静磁场，来动手构建两个不同的、但物理上等效的磁矢量势 $\\mathbf{A}$。通过完成此练习 ，你将深入理解规范自由度的实际含义，并学会如何利用规范条件（如库仑规范 $\\nabla \\cdot \\mathbf{A} = 0$）来选择满足特定对称性要求的势函数。",
            "id": "3310127",
            "problem": "一个静止的、空间均匀的磁场被指定为 $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$，其中 $B_{0}$ 是一个常数。在国际单位制（SI）中，电磁场可以用标量势和矢量势 $(\\phi,\\mathbf{A})$ 来表示，它们满足 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ 和 $\\mathbf{E} = -\\nabla \\phi - \\partial \\mathbf{A}/\\partial t$。势的规范变换通过引入一个标量规范函数 $\\chi$ 来定义，使得 $\\mathbf{A}' = \\mathbf{A} + \\nabla \\chi$ 和 $\\phi' = \\phi - \\partial \\chi/\\partial t$，这使得物理场 $\\mathbf{E}$ 和 $\\mathbf{B}$ 保持不变。\n\n从这些基本定义出发，完成以下任务：\n\n1. 施加库仑规范 $\\nabla \\cdot \\mathbf{A} = 0$，并为 $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ 构造一个矢量势 $\\mathbf{A}_{\\mathrm{sym}}(\\mathbf{r})$，该矢量势是空间坐标的线性函数，并表现出绕 $\\hat{\\mathbf{z}}$ 轴的旋转对称性。\n\n2. 在相同的库仑规范下，为 $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ 构造第二个矢量势 $\\mathbf{A}_{\\mathrm{tran}}(\\mathbf{r})$，该矢量势沿 $\\hat{\\mathbf{x}}$ 轴具有平移不变性，其分量不依赖于 $x$ 或 $z$，仅依赖于 $y$。\n\n3. 使用规范变换关系，确定将 $\\mathbf{A}_{\\mathrm{sym}}$ 变换为 $\\mathbf{A}_{\\mathrm{tran}}$ 的标量规范函数 $\\chi(x,y,z)$，并验证此规范函数保持库仑规范，即在 $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$ 的条件下，有 $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$。\n\n假设全程不依赖于时间（静场），因此 $\\partial \\chi/\\partial t = 0$，并且 $\\phi$ 可视为常数。将您的最终答案表示为标量规范函数 $\\chi(x,y,z)$ 的显式解析表达式。最终表达式中无需进行数值四舍五入，也无需报告单位。",
            "solution": "该问题要求为均匀磁场构造两个不同的矢量势，并确定将一个矢量势变换为另一个的标量规范函数。如问题陈述中所概述，该过程分为三个部分。\n\n磁场 $\\mathbf{B}$ 与磁矢量势 $\\mathbf{A}$ 之间的基本关系由 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ 给出。假设场是静止的，因此所有时间导数均为零。\n\n给定的磁场为 $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$，其中 $B_{0}$ 是一个常数。在笛卡尔坐标系中，这意味着我们必须找到一个矢量势 $\\mathbf{A}(x,y,z) = A_{x}\\hat{\\mathbf{x}} + A_{y}\\hat{\\mathbf{y}} + A_{z}\\hat{\\mathbf{z}}$，使其旋度为 $\\mathbf{B}$：\n$$ \\nabla \\times \\mathbf{A} = \\left(\\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z}\\right)\\hat{\\mathbf{x}} + \\left(\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x}\\right)\\hat{\\mathbf{y}} + \\left(\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\\right)\\hat{\\mathbf{z}} = B_{0}\\hat{\\mathbf{z}} $$\n这意味着以下分量方程：\n$$(1) \\quad \\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z} = 0$$\n$$(2) \\quad \\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0$$\n$$(3) \\quad \\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = B_{0}$$\n\n**第1部分：对称矢量势 $\\mathbf{A}_{\\mathrm{sym}}$ 的构造**\n\n我们需要找到一个矢量势 $\\mathbf{A}_{\\mathrm{sym}}$，它满足库仑规范条件 $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$，是空间坐标 $(x,y,z)$ 的线性函数，并表现出绕 $\\hat{\\mathbf{z}}$ 轴的旋转对称性。\n\n绕 $\\hat{\\mathbf{z}}$ 轴的旋转对称性条件表明，$\\mathbf{A}$ 的形式应与 $\\mathbf{r} \\times \\hat{\\mathbf{z}} = (x\\hat{\\mathbf{x}} + y\\hat{\\mathbf{y}}) \\times \\hat{\\mathbf{z}} = y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}$ 成正比。让我们为一个常数 $C$ 提出一个形式为 $\\mathbf{A}_{\\mathrm{sym}} = C(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}})$ 的试探解。这种形式是坐标的线性函数。\n\n让我们检查这个试探解的旋度：\n$$ \\nabla \\times \\mathbf{A}_{\\mathrm{sym}} = \\nabla \\times (C y\\hat{\\mathbf{x}} - C x\\hat{\\mathbf{y}}) = \\hat{\\mathbf{z}}\\left(\\frac{\\partial(-Cx)}{\\partial x} - \\frac{\\partial(Cy)}{\\partial y}\\right) = \\hat{\\mathbf{z}}(-C - C) = -2C\\hat{\\mathbf{z}} $$\n为了匹配给定的磁场 $\\mathbf{B} = B_{0}\\hat{\\mathbf{z}}$，我们必须有 $-2C = B_{0}$，这得出 $C = -B_{0}/2$。\n\n因此，矢量势为 $\\mathbf{A}_{\\mathrm{sym}} = -\\frac{B_{0}}{2}(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}) = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})$。\n让我们验证这是否满足库仑规范条件 $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$：\n$$ \\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{B_{0}}{2}x\\right) + \\frac{\\partial}{\\partial z}(0) = 0 + 0 + 0 = 0 $$\n条件得到满足。所以，对称矢量势是：\n$$ \\mathbf{A}_{\\mathrm{sym}} = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}}) $$\n\n**第2部分：平移不变矢量势 $\\mathbf{A}_{\\mathrm{tran}}$ 的构造**\n\n接下来，我们寻找一个不同的矢量势 $\\mathbf{A}_{\\mathrm{tran}}$，它也处于库仑规范中（$\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$），但具有不同的对称性：它必须沿 $\\hat{\\mathbf{x}}$ 轴平移不变，并且其分量仅依赖于坐标 $y$。\n\n这些约束意味着 $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{tran}}(y)$，即 $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial x = 0$ 和 $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial z = 0$。让我们写出 $\\mathbf{A}_{\\mathrm{tran}}(y) = A_{x}(y)\\hat{\\mathbf{x}} + A_{y}(y)\\hat{\\mathbf{y}} + A_{z}(y)\\hat{\\mathbf{z}}$。\n\n库仑规范条件 $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$ 变为：\n$$ \\frac{\\partial A_x}{\\partial x} + \\frac{\\partial A_y}{\\partial y} + \\frac{\\partial A_z}{\\partial z} = 0 + \\frac{d A_y}{d y} + 0 = 0 $$\n这意味着 $A_y(y)$ 是一个常数。通过减去一个简单的附加常数矢量势（一种规范变换），我们可以将此常数设置为零，所以 $A_{y} = 0$。\n\n现在我们应用旋度条件 $\\nabla \\times \\mathbf{A}_{\\mathrm{tran}} = B_{0}\\hat{\\mathbf{z}}$：\n从方程(1)可知：$\\frac{d A_z}{d y} - \\frac{\\partial A_y}{\\partial z} = \\frac{d A_z}{d y} - 0 = 0$，这意味着 $A_z(y)$ 也是一个常数。我们可以将此常数设置为零，所以 $A_{z} = 0$。\n从方程(2)可知：$\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0 - 0 = 0$。此条件得到满足。\n从方程(3)可知：$\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = 0 - \\frac{d A_x}{d y} = B_{0}$。这得出 $\\frac{d A_x}{d y} = -B_{0}$。\n\n对 $y$ 积分，我们得到 $A_{x}(y) = -B_{0}y + K$，其中 $K$ 是积分常数。在势的一个分量上加上一个常数不会改变磁场，因此为简单起见，我们可以选择 $K=0$。\n\n因此，平移不变矢量势是：\n$$ \\mathbf{A}_{\\mathrm{tran}} = -B_{0}y \\hat{\\mathbf{x}} $$\n\n**第3部分：标量规范函数 $\\chi$ 的确定**\n\n两个矢量势 $\\mathbf{A}_{\\mathrm{sym}}$ 和 $\\mathbf{A}_{\\mathrm{tran}}$ 描述了相同的磁场，并通过规范变换相关联。这意味着存在一个标量函数 $\\chi(x,y,z)$，使得 $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{sym}} + \\nabla\\chi$。我们需要找到这个函数 $\\chi$。\n\n重新排列变换方程，我们得到 $\\nabla\\chi = \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}}$。\n让我们计算差矢量：\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = (-B_{0}y\\hat{\\mathbf{x}}) - \\left(\\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})\\right) $$\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = \\left(-B_{0}y + \\frac{B_{0}}{2}y\\right)\\hat{\\mathbf{x}} + \\left(0 - \\frac{B_{0}}{2}x\\right)\\hat{\\mathbf{y}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}} $$\n所以，我们有 $\\nabla\\chi = \\frac{\\partial \\chi}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial \\chi}{\\partial y}\\hat{\\mathbf{y}} + \\frac{\\partial \\chi}{\\partial z}\\hat{\\mathbf{z}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}}$。\n\n这给了我们 $\\chi$ 的偏导数：\n$$ \\frac{\\partial \\chi}{\\partial x} = -\\frac{B_{0}}{2}y $$\n$$ \\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x $$\n$$ \\frac{\\partial \\chi}{\\partial z} = 0 $$\n从第三个方程可知，$\\chi$ 与 $z$ 无关，所以 $\\chi = \\chi(x,y)$。\n对第一个方程关于 $x$ 积分：\n$$ \\chi(x,y) = \\int \\left(-\\frac{B_{0}}{2}y\\right) dx = -\\frac{B_{0}}{2}xy + f(y) $$\n其中 $f(y)$ 是一个只依赖于 $y$ 的积分函数。\n\n为了找到 $f(y)$，我们将这个 $\\chi$ 的表达式对 $y$ 求导，并使其等于第二个偏导数方程：\n$$ \\frac{\\partial \\chi}{\\partial y} = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}xy + f(y)\\right) = -\\frac{B_{0}}{2}x + \\frac{df}{dy} $$\n将此与 $\\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x$ 比较，我们看到 $\\frac{df}{dy} = 0$。这意味着 $f(y)$ 是一个常数，我们可以将其设置为零，因为它不影响梯度 $\\nabla\\chi$。\n因此，所求的标量规范函数是：\n$$ \\chi(x,y,z) = -\\frac{B_{0}}{2}xy $$\n\n最后，我们必须验证此规范变换是否保持库仑规范。从 $\\mathbf{A}$ 到 $\\mathbf{A}' = \\mathbf{A} + \\nabla\\chi$ 的规范变换保持库仑规范（$\\nabla \\cdot \\mathbf{A} = 0 \\implies \\nabla \\cdot \\mathbf{A}' = 0$）的充分必要条件是规范函数 $\\chi$ 满足拉普拉斯方程 $\\nabla^2\\chi=0$。\n让我们计算我们的函数 $\\chi$ 的拉普拉斯算子：\n$$ \\nabla^2\\chi = \\frac{\\partial^2 \\chi}{\\partial x^2} + \\frac{\\partial^2 \\chi}{\\partial y^2} + \\frac{\\partial^2 \\chi}{\\partial z^2} $$\n$$ \\frac{\\partial^2}{\\partial x^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial y^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}x\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial z^2}\\left(-\\frac{B_{0}}{2}xy\\right) = 0 $$\n所以，$\\nabla^2\\chi = 0+0+0 = 0$。条件得到满足，这证实了由于 $\\mathbf{A}_{\\mathrm{sym}}$ 处于库仑规范中，$\\mathbf{A}_{\\mathrm{tran}}$ 也必定如此。这与我们在第2部分中的独立验证是一致的。",
            "answer": "$$ \\boxed{-\\frac{B_{0}}{2}xy} $$"
        },
        {
            "introduction": "从静态解析问题过渡到动态计算领域，规范条件在数值模拟的稳定性和准确性中扮演着至关重要的角色。本练习要求你通过编写一个时域有限差分（FDTD）程序，来验证洛伦兹规范条件 $\\nabla \\cdot \\mathbf{A} + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$ 与电荷守恒定律 $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot \\mathbf{J} = 0$ 之间的深刻联系。通过这项实践 ，你将亲眼看到，在离散层面上未能保持电荷守恒将如何直接导致规范条件的破坏，从而体会到在计算电磁学中严格执行物理守恒律的必要性。",
            "id": "3310124",
            "problem": "给定一维周期性空间网格和 Lorenz 规范下的电磁势的二阶显式时间推进格式。目标是设计并实现一个诊断程序，该程序测量所选规范条件的离散残差，并将其与该格式中的离散连续性方程联系起来。您必须实现一个完整的程序，该程序在多个测试案例中计算规范残差和连续性残差，并为每个案例输出一个量化诊断结果。\n\n从以下物理和数学基础开始：\n- 使用势的麦克斯韦方程组将电场和磁场定义为 $E = -\\nabla \\phi - \\partial A / \\partial t$ 和 $B = \\nabla \\times A$，其中 $A$ 是磁矢量势，$\\phi$ 是电标量势。\n- Lorenz 规范条件为 $\\nabla \\cdot A + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$。\n- 施加 Lorenz 规范会得到势的解耦波动方程：$\\Box \\phi = -\\rho / \\varepsilon_0$ 和 $\\Box A = -\\mu_0 J$，其中 $\\Box = \\frac{1}{c^2} \\frac{\\partial^2}{\\partial t^2} - \\nabla^2$，$\\rho$ 是电荷密度，$J$ 是电流密度。使用 $c^2 = 1 / (\\mu_0 \\varepsilon_0)$ 可得 $\\frac{\\partial^2 \\phi}{\\partial t^2} - c^2 \\nabla^2 \\phi = - \\frac{c^2}{\\varepsilon_0} \\rho$ 和 $\\frac{\\partial^2 A}{\\partial t^2} - c^2 \\nabla^2 A = - \\frac{1}{\\varepsilon_0} J$。\n- 连续性方程为 $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot J = 0$。\n\n通过设置 $c = 1$、$\\varepsilon_0 = 1$ 和 $\\mu_0 = 1$，完全在无量纲单位中工作。在这些单位中，所有量都是无量纲的，您的输出必须是无量纲的浮点数。\n\n使用 $N$ 个等距点离散化长度为 $L$ 的一维空间域，网格间距为 $\\Delta x = L/N$，并采用周期性边界条件。在空间和时间上使用二阶中心有限差分格式。设 $t_n = n \\Delta t$ 表示离散时间。设 $f_i^n$ 表示场 $f$ 在网格点 $x_i$ 和时间 $t_n$ 的值。定义以下离散算子：\n- 场 $u$ 的离散中心空间导数（一维离散散度）：\n$$\n\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}.\n$$\n- 离散拉普拉斯算子：\n$$\n\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}.\n$$\n- 离散中心时间导数：\n$$\n\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}.\n$$\n- 离散二阶时间差分：\n$$\n\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}.\n$$\n\n在无量纲单位中，实现 Lorenz 规范下势的显式时间推进更新：\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n - \\rho_i^n \\right),\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n - J_i^n \\right).\n$$\n对所有 $i$，初始化 $\\phi_i^0 = 0$、$\\phi_i^1 = 0$、$A_i^0 = 0$ 和 $A_i^1 = 0$。\n\n设计并实现以下离散诊断：\n- 时间 $n$ 的离散规范残差：\n$$\ng_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n.\n$$\n- 时间 $n$ 的离散连续性残差：\n$$\nr_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n.\n$$\n定义场 $q$ 在时间 $n$ 的空间离散 $L^2$ 范数为\n$$\n\\| q^n \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} \\left(q_i^n\\right)^2 }.\n$$\n\n需要检验的关系是，在 $\\phi$ 和 $A$ 的波动方程更新下，离散 Lorenz 规范残差 $g_i^n$ 是由离散连续性残差 $r_i^n$ 驱动的。您的程序应计算最终诊断时间的规范残差的 $L^2$ 范数，并为每个测试案例报告该值。为了使诊断集中于中心差分，请在时间索引 $n = T - 2$ 处使用 $\\left(\\delta_t \\cdot \\right)^n$ 的定义来评估残差，其中 $T$ 是总时间步数，以确保所有需要的时间层级都存在。\n\n在旨在满足离散连续性方程的案例中，要构建源项，请通过强制满足\n$$\n\\left(\\nabla_h \\cdot J\\right)_i^n = - \\left(\\delta_t \\rho \\right)_i^n\n$$\n来从给定的 $\\rho_i^n$ 计算 $J_i^n$，这需要使用周期性离散傅里叶变换和离散中心导数符号。设 $k_m = \\frac{2\\pi m}{L}$（其中 $m = 0, 1, \\dots, N-1$）表示离散波数，并设中心差分导数符号为 $\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$。在傅里叶空间中，对于 $\\sigma(k_m) \\neq 0$ 的模式，设置 $\\widehat{J}(k_m)^n = - \\widehat{s}(k_m)^n / (i \\, \\sigma(k_m))$；对于 $\\sigma(k_m) = 0$ 的模式，设置 $\\widehat{J}(k_m)^n = 0$，其中 $s_i^n = \\left(\\delta_t \\rho \\right)_i^n$，帽子符号表示离散傅里叶变换。通过逆变换回到实空间以获得 $J_i^n$。\n\n实现以下测试套件，其中 $N$ 是网格点数，$L$ 是域长度，$\\Delta t$ 是时间步长，$T$ 是总时间步数，$k$ 是空间频率，$\\Omega$ 是电荷密度中的时间角频率。所有量都是无量纲的。对于所有案例，使用周期性边界条件，并报告时间 $n = T - 2$ 时规范残差的离散 $L^2$ 范数。\n\n- 案例 1 (一致性，稳定 Courant 数)：$N = 128$，$L = 1.0$，$\\Delta t = 0.8 \\Delta x$，$T = 50$，$k = 2 \\pi$（在域上一个空间周期），$\\Omega = 1.5$。定义 $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$，并使用上述谱方法强制满足离散连续性方程来计算 $J_i^n$。\n- 案例 2 (违反连续性)：参数与案例 1 相同，但对所有 $i,n$ 设置 $J_i^n = 0$，同时保持 $\\rho_i^n$ 不变。\n- 案例 3 (零源)：$N = 128$，$L = 1.0$，$\\Delta t = 0.8 \\Delta x$，$T = 50$。对所有 $i,n$ 设置 $\\rho_i^n = 0$ 和 $J_i^n = 0$。\n- 案例 4 (接近 Courant 极限，一致性)：$N = 128$，$L = 1.0$，$\\Delta t = 0.99 \\Delta x$，$T = 50$，$k = 4 \\pi$（在域上两个空间周期），$\\Omega = 2.0$。定义 $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$，并使用上述谱方法强制满足离散连续性方程来计算 $J_i^n$。\n\n您的程序必须：\n- 实现对 $n = 1, 2, \\dots, T-2$ 的 $\\phi$ 和 $A$ 的更新，并在最后计算规范残差 $g_i^{T-2}$。\n- 计算并报告每个案例的空间离散 $L^2$ 范数 $\\| g^{T-2} \\|_{2,h}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如，\"[result1,result2,result3,result4]\"。每个结果必须是一个浮点数，表示相应测试案例在时间 $n = T - 2$ 时的规范残差的离散 $L^2$ 范数。所有输出都必须是无量纲实数。您不得打印任何额外文本。\n\n您必须使用时域有限差分 (FDTD) 方法在无量纲单位中实现您的解决方案，并严格遵守指定的离散化和测试套件。",
            "solution": "该问题要求设计并实现一个数值诊断程序，以在二阶时域有限差分 (FDTD) 格式中探究 Lorenz 规范条件与电荷连续性方程之间的关系。该问题设定在一维空间中，具有周期性边界条件，并使用无量纲单位，其中光速 $c=1$，真空介电常数 $\\varepsilon_0=1$，真空磁导率 $\\mu_0=1$。\n\n控制该系统的基本物理定律是麦克斯韦方程组。用磁矢量势 $A$ 和电标量势 $\\phi$ 表示，电场和磁场分别为 $E = -\\nabla \\phi - \\partial A / \\partial t$ 和 $B = \\nabla \\times A$。当施加 Lorenz 规范条件 $\\nabla \\cdot A + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$ 时，势的动力学由产生的非齐次波动方程控制。在指定的无量纲单位中，这些方程为：\n$$\n\\frac{\\partial^2 \\phi}{\\partial t^2} - \\nabla^2 \\phi = -\\rho\n$$\n$$\n\\frac{\\partial^2 A}{\\partial t^2} - \\nabla^2 A = -J\n$$\n其中 $\\rho$ 是电荷密度，$J$ 是电流密度。这些源必须满足连续性方程 $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot J = 0$。\n\n数值解构建在长度为 $L$ 的域上的一个包含 $N$ 个点的均匀一维网格上，空间步长为 $\\Delta x = L/N$，时间步长为 $\\Delta t$。函数 $f(x,t)$ 被离散化为 $f_i^n = f(x_i, t_n)$，其中 $x_i = i \\Delta x$，$t_n = n \\Delta t$。问题指定了用于空间和时间导数的二阶中心有限差分算子：\n- 离散散度：$\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}$\n- 离散拉普拉斯算子：$\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}$\n- 离散时间导数：$\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}$\n- 离散二阶时间导数：$\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}$\n\n使用这些算子，连续波动方程被离散化，得到显式时间推进更新规则（一种蛙跳格式）：\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n - \\rho_i^n \\right)\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n - J_i^n \\right)\n$$\n这些更新构成了 FDTD 模拟的核心，从初始条件 $\\phi_i^0 = \\phi_i^1 = 0$ 和 $A_i^0 = A_i^1 = 0$ 开始，对时间步 $n=1, 2, \\dots, T-2$ 应用。\n\n核心任务是分析离散 Lorenz 规范条件。离散规范残差定义为 $g_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n$。类似地，离散连续性残差为 $r_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n$。该数值格式的一个关键属性是规范残差由连续性残差驱动。为了看到这一点，我们可以对规范残差 $g^n$ 应用离散波动算子 $(\\delta_{tt} - \\nabla_h^2)$，并假设离散算子是可交换的：\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = (\\delta_{tt} - \\nabla_h^2) (\\nabla_h \\cdot A^n + \\delta_t \\phi^n)\n= \\nabla_h \\cdot ((\\delta_{tt} - \\nabla_h^2) A^n) + \\delta_t ((\\delta_{tt} - \\nabla_h^2) \\phi^n)\n$$\n代入 FDTD 更新规则，可写为 $(\\delta_{tt} - \\nabla_h^2) \\phi^n = -\\rho^n$ 和 $(\\delta_{tt} - \\nabla_h^2) A^n = -J^n$，我们得到：\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = \\nabla_h \\cdot (-J^n) + \\delta_t (-\\rho^n) = -(\\nabla_h \\cdot J^n + \\delta_t \\rho^n) = -r^n\n$$\n这个结果 $(\\delta_{tt} - \\nabla_h^2) g^n = -r^n$ 是规范残差 $g^n$ 的一个离散波动方程，其源项是连续性残差 $-r^n$。这意味着如果离散连续性方程得到满足（即 $r^n=0$），规范残差将满足齐次波动方程。在适当的初始条件下，它应保持很小（理想情况下为零，取决于浮点精度）。如果离散连续性方程被违反（$r^n \\neq 0$），规范残差预计会增长。\n\n该实现将测试这种关系。对于要求满足离散连续性方程的测试案例，电流密度 $J_i^n$ 是从给定的电荷密度 $\\rho_i^n$ 构建的。需要强制满足的条件是 $(\\nabla_h \\cdot J)_i^n = - (\\delta_t \\rho)_i^n$。这通过使用离散傅里叶变换 (DFT) 的算法来实现。令 $s_i^n = (\\delta_t \\rho)_i^n$。在傅里叶空间中，方程变为 $i \\sigma(k_m) \\widehat{J}(k_m)^n = -\\widehat{s}(k_m)^n$，其中 $\\widehat{\\cdot}$ 表示 DFT，$k_m$ 是离散波数，$\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$ 是中心差分算子 $\\nabla_h$ 的谱符号。求解 $\\widehat{J}(k_m)^n$ 可得：\n$$\n\\widehat{J}(k_m)^n = - \\frac{\\widehat{s}(k_m)^n}{i \\sigma(k_m)}\n$$\n此除法对所有 $\\sigma(k_m) \\neq 0$ 的模式执行。对于 $\\sigma(k_m) = 0$ 的模式（直流分量 $m=0$ 和奈奎斯特模式 $m=N/2$ 如果 $N$ 是偶数），$\\widehat{J}(k_m)^n$ 被设置为 $0$。然后通过逆 DFT 恢复实空间中的电流密度 $J_i^n$。\n\n总体算法如下：\n1. 对于每个测试案例，设置空间网格、时间步长以及所有需要时间的源项 $\\rho_i^n$。\n2. 如果测试案例要求，使用上述谱方法计算 $n \\in [1, T-2]$ 的电流密度 $J_i^n$，以确保离散连续性方程 $r_i^n=0$ 得到满足。否则，按指定设置 $J_i^n$（例如，设置为零）。\n3. 将时间步 $n=0$ 和 $n=1$ 的势场 $\\phi$ 和 $A$ 初始化为零。\n4. 执行从 $n=1$ 到 $n=T-2$ 的 FDTD 时间推进循环，使用蛙跳格式更新 $\\phi_i^{n+1}$ 和 $A_i^{n+1}$。周期性边界条件通过对空间拉普拉斯算子使用循环移位来处理。\n5. 循环结束后，在最终诊断时间 $n_{diag} = T-2$，计算规范残差 $g_i^{n_{diag}} = (\\nabla_h \\cdot A)_i^{n_{diag}} + (\\delta_t \\phi)_i^{n_{diag}}$。这需要时间 $T-1$、$T-2$ 和 $T-3$ 的场值，所有这些值都已计算得到。\n6. 计算最终的诊断量，即规范残差的离散空间 $L^2$ 范数 $\\| g^{T-2} \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} (g_i^{T-2})^2 }$。\n\n此过程应用于四个测试案例中的每一个，并报告所得的 $L^2$ 范数。案例 3 具有零源和零初始条件，将产生零势，因此规范残差为零，可作为基线。案例 1 和案例 4 强制满足连续性，因此预计会产生非常小的残差。案例 2 明确违反了连续性，这应导致一个大得多的非零规范残差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, L, cfl_factor, T, k, Omega, use_spectral_J):\n    \"\"\"\n    Runs a single FDTD simulation for the given parameters.\n    \"\"\"\n    # 1. Grid and parameter setup\n    dx = L / N\n    dt = cfl_factor * dx\n    x = np.arange(N) * dx\n    t = np.arange(T) * dt\n\n    # 2. Source term generation\n    xx, tt = np.meshgrid(x, t)\n    rho = np.zeros((T, N))\n    J = np.zeros((T, N))\n\n    if k is not None and Omega is not None:\n        rho = np.sin(k * xx) * np.cos(Omega * tt)\n\n    if use_spectral_J:\n        # Enforce discrete continuity equation r=0 using spectral method\n        s = np.zeros_like(rho)\n        # Compute s = delta_t(rho) for n=1,...,T-2\n        for n in range(1, T - 1):\n            s[n, :] = (rho[n + 1, :] - rho[n - 1, :]) / (2 * dt)\n\n        # Wavenumbers and discrete derivative symbol\n        k_m = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n        sigma = np.sin(k_m * dx) / dx\n        \n        # Denominator for Fourier-space division\n        den = 1j * sigma\n        zero_modes = np.abs(sigma)  1e-15\n        # Avoid division by zero warning, these modes are handled separately\n        den[zero_modes] = 1.0 \n\n        for n in range(1, T - 1):\n            s_hat = np.fft.fft(s[n, :])\n            # J_hat = - s_hat / (i * sigma)\n            J_hat = -s_hat / den\n            J_hat[zero_modes] = 0.0\n            J[n, :] = np.fft.ifft(J_hat).real\n\n    # 3. Initialization of potentials\n    # phi^0 = 0, phi^1 = 0. A^0 = 0, A^1 = 0\n    phi = np.zeros((T, N))\n    A = np.zeros((T, N))\n\n    # 4. FDTD time-marching loop\n    for n in range(1, T - 1):\n        # Get fields at time n\n        phi_n = phi[n, :]\n        A_n = A[n, :]\n\n        # Compute discrete Laplacians with periodic boundaries\n        phi_lap = (np.roll(phi_n, -1) - 2 * phi_n + np.roll(phi_n, 1)) / dx**2\n        A_lap = (np.roll(A_n, -1) - 2 * A_n + np.roll(A_n, 1)) / dx**2\n\n        # Update fields to time n+1\n        phi[n + 1, :] = 2 * phi_n - phi[n - 1, :] + dt**2 * (phi_lap - rho[n, :])\n        A[n + 1, :] = 2 * A_n - A[n - 1, :] + dt**2 * (A_lap - J[n, :])\n\n    # 5. Diagnostic calculation at n = T-2\n    n_diag = T - 2\n    \n    # Discrete divergence of A\n    div_A_diag = (np.roll(A[n_diag, :], -1) - np.roll(A[n_diag, :], 1)) / (2 * dx)\n    \n    # Discrete time derivative of phi\n    dt_phi_diag = (phi[n_diag + 1, :] - phi[n_diag - 1, :]) / (2 * dt)\n\n    # Gauge residual g = div(A) + dt(phi)\n    g = div_A_diag + dt_phi_diag\n\n    # 6. Compute L2 norm of the gauge residual\n    g_norm = np.sqrt(dx * np.sum(g**2))\n    \n    return g_norm\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite, then prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (consistency, stable Courant number)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': True},\n        # Case 2 (violate continuity)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': False},\n        # Case 3 (zero sources)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': None, 'Omega': None, 'use_spectral_J': False},\n        # Case 4 (near Courant limit, consistency)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.99, 'T': 50, 'k': 4 * np.pi, 'Omega': 2.0, 'use_spectral_J': True},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            N=case['N'],\n            L=case['L'],\n            cfl_factor=case['cfl_factor'],\n            T=case['T'],\n            k=case['k'],\n            Omega=case['Omega'],\n            use_spectral_J=case['use_spectral_J']\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "规范理论的强大之处不仅在于处理数学上的冗余，更在于它为描述具有非平凡拓扑结构的物理场提供了基本工具。狄拉克磁单极子便是一个著名的例子，它无法用一个单一的、全局光滑的矢量势来描述。本练习  将引导你实现一种“分片”解法，在球面的不同区域上定义不同的势函数，并通过规范变换将它们在重叠区域上平滑地连接起来。这个过程有力地揭示了规范变换的几何与拓扑内涵。",
            "id": "3310180",
            "problem": "您需要实现、分析并验证一个在单位球面上表示 Dirac 磁单极子的双片区规范表示，该方法常用于计算电磁学 (CEM) 中。您应从基本原理出发，不依赖任何预先给定的势函数公式。您可以使用的基础理论包括：静磁学，其中磁场 $\\mathbf{B}$ 通过磁矢量势 $\\mathbf{A}$ 定义为 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$；带有磁荷 $g$ 的磁单极子所满足的散度条件 $\\nabla \\cdot \\mathbf{B} = 4 \\pi g \\, \\delta^{3}(\\mathbf{r})$；以及物理场必须是全局良定义的，而势函数可以分片定义，且在不同片区之间通过形如 $\\mathbf{A}' = \\mathbf{A} + \\nabla \\chi$ 的规范变换相关联的要求。几何背景为嵌入在三维欧几里得空间中的单位球面 $S^{2}$，其球面角 $\\theta \\in [0,\\pi]$ 和 $\\phi \\in [0, 2\\pi)$ 以弧度为单位。所有角度都必须使用弧度。所有物理量均为无量纲，不使用物理单位。\n\n您将使用两个覆盖 $S^{2}$ 的重叠规范片区，每个片区排除一个作为狄拉克弦的极轴。用 $\\mathcal{U}_{N}$ 表示排除南极轴（位于负 $z$ 轴上的弦）的片区，用 $\\mathcal{U}_{S}$ 表示排除北极轴（位于正 $z$ 轴上的弦）的片区。在每个片区上，定义一个矢量势 $\\mathbf{A}_{N}$ 和 $\\mathbf{A}_{S}$。这两个势函数应在各自的片区内是光滑的，并在远离弦和原点磁单极子的地方产生相同的磁场 $\\mathbf{B}$。在重叠区域 $\\mathcal{U}_{N}\\cap \\mathcal{U}_{S}$ 上，这两个势函数必须相差一个纯规范项，即必须存在一个标量函数 $\\chi$ 使得在重叠区域上 $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla \\chi$。\n\n您的程序必须实现以下内容，并遵循从上述原理出发的推导和算法设计：\n\n1. 推导出在片区 $\\mathcal{U}_{N}$ 上的矢量势 $\\mathbf{A}_{N}$ 和在片区 $\\mathcal{U}_{S}$ 上的矢量势 $\\mathbf{A}_{S}$ 的显式表达式，以及一个标量规范函数 $\\chi$ 使得在重叠区域上 $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla \\chi$。推导中只考虑仅依赖于 $\\theta$（无显式的 $\\phi$ 依赖）并且在球坐标基 $\\{\\hat{\\mathbf{e}}_{r}, \\hat{\\mathbf{e}}_{\\theta}, \\hat{\\mathbf{e}}_{\\phi}\\}$ 中表示时是纯方位角方向的势，即在 $r=1$ 上具有形式 $\\mathbf{A} = A_{\\phi}(\\theta) \\, \\hat{\\mathbf{e}}_{\\phi}$。确保每个势函数在自己的片区上是正则的，且仅在其指定的弦上是奇异的。\n\n2. 在单位球面上使用一个离散网格，角度范围为 $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 和 $\\phi \\in [0, 2\\pi)$，间距为均匀的 $\\Delta \\theta$ 和 $\\Delta \\phi$，在重叠区域上数值验证规范一致性条件：计算整个网格上 $\\mathbf{A}_{N} - \\mathbf{A}_{S}$ 的 $\\phi$ 分量与 $\\nabla \\chi$ 的 $\\phi$ 分量之间的最大绝对不匹配值。通过选择一个正的缓冲值 $\\theta_{\\min}$ 来排除弦。您必须将此最大不匹配值报告为单个浮点数。\n\n3. 使用适用于球坐标系中方位角势的有限差分格式，从 $\\mathbf{A}_{N}$ 数值近似磁场 $\\mathbf{B}$，并计算所计算出的径向分量 $B_{r}^{\\mathrm{num}}(\\theta)$ 与由磁荷为 $g$ 的磁单极子的散度定律及 $\\mathbf{B}$ 是径向且仅依赖于 $r$ 这一事实所确定的精确径向分量 $B_{r}^{\\mathrm{exact}}(\\theta)$ 之间的最大绝对误差。将此计算限制在相同的排除弦的带状区域 $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 内，并使用均匀的 $\\theta$ 间距。对于数值旋度，对内部点使用关于 $\\theta$ 的中心有限差分，并且由于 $\\mathbf{A}$ 的方位角形式假设，仅关注径向分量 $B_{r}(\\theta)$。报告不同网格尺寸下的最大绝对误差，以检验收敛性。\n\n4. 包含一个 $g=0$ 的边界情况，以验证您的实现能够产生零场，并且在数值旋度离散化中误差为零。\n\n网格设计与角度约定：\n- 使用单位球面 $r=1$，因此所有计算都在 $r=1$ 上进行。\n- 所有角度 $\\theta$ 和 $\\phi$ 必须以弧度为单位。\n- 选择一个大于零的弦排除缓冲值 $\\theta_{\\min}  0$，以避免奇异轴 $\\theta = 0$ 和 $\\theta = \\pi$。\n- 在 $\\theta$ 方向上使用均匀网格；在方位角假设下，对 $\\phi$ 方向的旋度计算没有特定约束。\n\n测试套件规范：\n- 测试用例 $\\#1$ (规范重叠一致性)：磁荷 $g = 1.0$，缓冲值 $\\theta_{\\min} = 0.05$ 弧度，$\\theta$ 网格有 $N_{\\theta} = 181$ 个点，均匀分布在 $[\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 区间内，$\\phi$ 网格有 $N_{\\phi} = 360$ 个点，均匀分布在 $[0, 2\\pi)$ 区间内。输出在整个网格上 $\\mathbf{A}_{N} - \\mathbf{A}_{S}$ 的 $\\phi$ 分量与 $\\nabla \\chi$ 的 $\\phi$ 分量之间的最大绝对不匹配值，结果为一个浮点数。\n- 测试用例 $\\#2$ 到 $\\#4$ (旋度收敛性)：磁荷 $g = 1.0$，缓冲值 $\\theta_{\\min} = 0.05$ 弧度，$\\theta$ 网格尺寸 $N_{\\theta} \\in \\{33, 65, 129\\}$，每个网格均均匀分布在 $[\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 区间内。对于每个 $N_{\\theta}$，计算径向旋度分量与由散度定律在 $r=1$ 上所确定的精确值之间的最大绝对误差 $\\max_{\\theta}$，并将每个误差报告为一个单独的浮点数。\n- 测试用例 $\\#5$ (边界情况)：磁荷 $g = 0.0$，缓冲值 $\\theta_{\\min} = 0.05$ 弧度，$\\theta$ 网格尺寸 $N_{\\theta} = 65$。计算并报告径向旋度分量的最大绝对误差。理想情况下，此值应为零。\n\n最终输出格式：\n- 您的程序必须生成单行输出，其中包含五个测试用例的结果，形式为用方括号括起来的逗号分隔的浮点数列表，顺序如下：$[\\text{gauge\\_mismatch}, \\text{curl\\_err}_{33}, \\text{curl\\_err}_{65}, \\text{curl\\_err}_{129}, \\text{curl\\_err}_{g=0}]$。\n- 不应打印任何其他文本。\n\n角度单位：\n- 所有角度必须以弧度为单位。\n\n物理单位：\n- 所有量均为无量纲；不使用物理单位。\n\n您的程序必须是自包含的，无需用户输入，并遵守指定的运行时环境约束。",
            "solution": "此问题要求推导并数值验证单位球面上 Dirac 磁单极子的双片区规范势表示。解答分为三部分：第一，从基本原理出发推导磁场和分片矢量势；第二，推导在重叠区域上关联不同势的规范变换；第三，设计用于验证这些理论构造的数值算法。\n\n### 1. 磁场和矢量势的推导\n\n出发点是位于原点 $\\mathbf{r}=\\mathbf{0}$、磁荷为 $g$ 的静磁单极子所产生的磁场 $\\mathbf{B}$ 的基本方程：\n$$ \\nabla \\cdot \\mathbf{B} = 4 \\pi g \\, \\delta^{3}(\\mathbf{r}) $$\n其中 $\\delta^{3}(\\mathbf{r})$ 是三维 Dirac delta 函数。通过与静电学中的高斯定律类比，该方程的解是一个按 $1/r^2$ 衰减的纯径向场：\n$$ \\mathbf{B}(\\mathbf{r}) = g \\frac{\\hat{\\mathbf{e}}_{r}}{r^2} $$\n此处，$\\hat{\\mathbf{e}}_{r}$ 是径向单位矢量。在 $r=1$ 的单位球面上，该场简化为一个恒定的径向场 $\\mathbf{B} = g\\hat{\\mathbf{e}}_{r}$。因此，对于所有角度 $(\\theta, \\phi)$，其径向分量为 $B_{r}^{\\mathrm{exact}} = g$。\n\n接下来，我们寻求一个磁矢量势 $\\mathbf{A}$，使得 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$。问题指定寻找一个纯方位角方向且仅依赖于 $\\theta$（以及 $r$）的解，形式为 $\\mathbf{A} = A_{\\phi}(r, \\theta) \\hat{\\mathbf{e}}_{\\phi}$。对于这样的势，其在球坐标系下的旋度表达式简化为：\n$$ \\nabla \\times \\mathbf{A} = \\frac{1}{r \\sin\\theta} \\frac{\\partial}{\\partial\\theta}(\\sin\\theta A_{\\phi}) \\hat{\\mathbf{e}}_{r} - \\frac{1}{r} \\frac{\\partial}{\\partial r}(r A_{\\phi}) \\hat{\\mathbf{e}}_{\\theta} $$\n为了匹配纯径向磁场 $\\mathbf{B} = (g/r^2) \\hat{\\mathbf{e}}_{r}$，旋度的 $\\hat{\\mathbf{e}}_{\\theta}$ 分量必须为零，这意味着 $\\frac{\\partial}{\\partial r}(r A_{\\phi}) = 0$。这表示 $r A_{\\phi}$ 仅是 $\\theta$ 的函数，因此 $A_{\\phi}(r, \\theta) = f(\\theta)/r$，其中 $f(\\theta)$ 是某个函数。令径向分量相等，可得：\n$$ \\frac{1}{r \\sin\\theta} \\frac{\\partial}{\\partial\\theta}\\left(\\sin\\theta \\frac{f(\\theta)}{r}\\right) = \\frac{g}{r^2} $$\n两边乘以 $r^2 \\sin\\theta$ 得到关于 $f(\\theta)$ 的微分方程：\n$$ \\frac{d}{d\\theta}(f(\\theta) \\sin\\theta) = g \\sin\\theta $$\n对 $\\theta$ 积分得到 $f(\\theta)\\sin\\theta = -g\\cos\\theta + C$，其中 $C$ 是一个积分常数。因此，势函数的一般形式为：\n$$ A_{\\phi}(r, \\theta) = \\frac{1}{r} \\frac{C - g\\cos\\theta}{\\sin\\theta} $$\n这个势函数在极点 $\\theta=0$ 和 $\\theta=\\pi$ 处是奇异的，因为在这些点 $\\sin\\theta=0$。为了构建一个有物理意义的理论，我们在两个重叠的片区上定义势函数，每个片区排除一个极点。常数 $C$ 的选择决定了势函数在哪一个极点是正则的。\n\n**在片区 $\\mathcal{U}_{N}$ 上的势 $\\mathbf{A}_{N}$ (北极正则):**\n片区 $\\mathcal{U}_{N}$ 包含北极 ($\\theta=0$) 但排除南极 ($\\theta=\\pi$)。为了使 $A_{\\phi}$ 在 $\\theta=0$ 处是正则的，当 $\\theta \\to 0$ 时分子必须为零。由于当 $\\theta \\to 0$ 时 $\\cos\\theta \\to 1$，我们必须有 $C-g=0$，因此 $C=g$。所以在 $\\mathcal{U}_{N}$ 上的势为：\n$$ (A_{N})_{\\phi}(r, \\theta) = \\frac{g(1 - \\cos\\theta)}{r \\sin\\theta} $$\n此表达式在 $\\theta=0$ 处是正则的，但在 $\\theta=\\pi$ 处是奇异的。\n\n**在片区 $\\mathcal{U}_{S}$ 上的势 $\\mathbf{A}_{S}$ (南极正则):**\n片区 $\\mathcal{U}_{S}$ 包含南极 ($\\theta=\\pi$) 但排除北极 ($\\theta=0$)。为了使 $A_{\\phi}$ 在 $\\theta=\\pi$ 处是正则的，当 $\\theta \\to \\pi$ 时分子必须为零。由于当 $\\theta \\to \\pi$ 时 $\\cos\\theta \\to -1$，我们必须有 $C-g(-1)=0$，因此 $C=-g$。所以在 $\\mathcal{U}_{S}$ 上的势为：\n$$ (A_{S})_{\\phi}(r, \\theta) = \\frac{-g(1 + \\cos\\theta)}{r \\sin\\theta} $$\n此表达式在 $\\theta=\\pi$ 处是正则的，但在 $\\theta=0$ 处是奇异的。\n\n对于所有后续在单位球面上的数值计算，我们都设置 $r=1$。\n\n### 2. 重叠区域上的规范变换\n\n在重叠区域 $\\mathcal{U}_{N} \\cap \\mathcal{U}_{S}$（即排除了两个极点的球面）上，两个势必须通过规范变换相关联，即 $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla\\chi$，其中 $\\chi$ 是某个标量规范函数。我们在单位球面 ($r=1$)上计算这两个势的差值：\n$$ (A_{N})_{\\phi} - (A_{S})_{\\phi} = g \\frac{1 - \\cos\\theta}{\\sin\\theta} - \\left(-g \\frac{1 + \\cos\\theta}{\\sin\\theta}\\right) = \\frac{g(1 - \\cos\\theta + 1 + \\cos\\theta)}{\\sin\\theta} = \\frac{2g}{\\sin\\theta} $$\n差矢量为 $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\frac{2g}{\\sin\\theta} \\hat{\\mathbf{e}}_{\\phi}$。现在我们寻找 $\\chi$ 使得 $\\nabla\\chi$ 等于此矢量。球坐标系中的梯度为 $\\nabla\\chi = \\frac{\\partial\\chi}{\\partial r}\\hat{\\mathbf{e}}_{r} + \\frac{1}{r}\\frac{\\partial\\chi}{\\partial\\theta}\\hat{\\mathbf{e}}_{\\theta} + \\frac{1}{r\\sin\\theta}\\frac{\\partial\\chi}{\\partial\\phi}\\hat{\\mathbf{e}}_{\\phi}$。匹配各分量可得：\n$$ \\frac{\\partial\\chi}{\\partial r} = 0, \\quad \\frac{\\partial\\chi}{\\partial\\theta} = 0, \\quad \\frac{1}{r\\sin\\theta}\\frac{\\partial\\chi}{\\partial\\phi} = \\frac{2g}{r\\sin\\theta} $$\n前两个方程意味着 $\\chi$ 仅是 $\\phi$ 的函数。第三个方程变为 $\\frac{d\\chi}{d\\phi} = 2g$。积分得到规范函数：\n$$ \\chi(\\phi) = 2g\\phi $$\n（不失一般性地，积分常数取为零）。在单位球面上，$\\chi$ 的梯度的 $\\phi$ 分量是 $(\\nabla\\chi)_{\\phi} = \\frac{1}{\\sin\\theta}\\frac{\\partial(2g\\phi)}{\\partial\\phi} = \\frac{2g}{\\sin\\theta}$。这与差值 $(A_{N})_{\\phi} - (A_{S})_{\\phi}$ 完全匹配。\n\n### 3. 数值验证算法\n\n**规范一致性验证：**\n第一个数值任务是在离散网格上验证差值 $(A_{N})_{\\phi} - (A_{S})_{\\phi}$ 是否与 $(\\nabla\\chi)_{\\phi}$ 匹配。网格覆盖范围为 $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 和 $\\phi \\in [0, 2\\pi)$。由于所涉及的所有量 $(A_N)_\\phi$、$(A_S)_\\phi$ 和 $(\\nabla\\chi)_\\phi$ 都只依赖于 $\\theta$，验证可以在一维 $\\theta$ 网格上进行。\n1. 为 $\\theta$ 定义一个从 $\\theta_{\\min}$ 到 $\\pi - \\theta_{\\min}$ 的包含 $N_{\\theta}$ 个点的均匀网格。\n2. 在网格上为每个 $\\theta$ 计算矢量 $(A_{N})_{\\phi}$。\n3. 在网格上为每个 $\\theta$ 计算矢量 $(A_{S})_{\\phi}$。\n4. 计算差值矢量 $\\mathbf{D}_{\\mathbf{A}} = (A_{N})_{\\phi} - (A_{S})_{\\phi}$。\n5. 计算梯度分量矢量 $\\mathbf{G}_{\\chi} = (\\nabla\\chi)_{\\phi} = 2g/\\sin\\theta$。\n6. 在每个网格点计算绝对不匹配值 $|D_{\\mathbf{A}, i} - G_{\\chi, i}|$。\n7. 结果是该不匹配值在整个网格上的最大值。在精确算术中，此不匹配值为零。在数值上，它将是一个与机器精度同量级的小值。\n\n**旋度计算与误差分析：**\n第二个任务是数值计算 $\\mathbf{B} = \\nabla\\times \\mathbf{A}_{N}$ 的径向分量，并将其与精确值 $B_r^{\\mathrm{exact}} = g$ 进行比较。径向分量由 $B_r = \\frac{1}{r\\sin\\theta} \\frac{\\partial}{\\partial\\theta}(\\sin\\theta A_{\\phi})$ 给出。在单位球面 $r=1$ 上，我们计算 $B_{r} = \\frac{1}{\\sin\\theta} \\frac{d}{d\\theta}(\\sin\\theta (A_{N})_{\\phi})$。\n1. 为 $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ 定义一个包含 $N_{\\theta}$ 个点的均匀网格，间距为 $\\Delta\\theta$。\n2. 在每个网格点计算 $(A_{N})_{\\phi}(\\theta)$。\n3. 构造函数 $F(\\theta) = \\sin\\theta (A_{N})_{\\phi}(\\theta)$。根据我们的推导，这可以简化为 $F(\\theta) = g(1-\\cos\\theta)$。\n4. 使用二阶中心有限差分格式在内部网格点 $\\theta_i$（其中 $i=1, \\dots, N_{\\theta}-2$）上近似导数 $\\frac{dF}{d\\theta}$：\n   $$ \\left.\\frac{dF}{d\\theta}\\right|_{\\theta_i} \\approx \\frac{F(\\theta_{i+1}) - F(\\theta_{i-1})}{2\\Delta\\theta} $$\n5. 对内部点计算数值磁场分量 $B_{r}^{\\mathrm{num}}(\\theta_i) = \\frac{1}{\\sin\\theta_i} \\left(\\frac{F_{i+1} - F_{i-1}}{2\\Delta\\theta}\\right)$。\n6. 在每个内部点计算绝对误差 $|B_{r}^{\\mathrm{num}}(\\theta_i) - g|$。\n7. 结果是这些误差在所有内部点上的最大值。对不同的 $N_{\\theta}$ 值重复此过程以观察收敛性。中心差分格式具有二阶精度，因此误差预期会随 $\\Delta\\theta$ 平方减小，即与 $1/N_{\\theta}^2$ 成正比。对于边界情况 $g=0$，势 $\\mathbf{A}_N$ 恒等于零，导致数值计算出的场为零，因此误差也为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_gauge_consistency(g, theta_min, N_theta, N_phi):\n    \"\"\"\n    Numerically verifies the gauge consistency condition.\n    \n    Computes the maximum absolute mismatch between the phi-components of\n    A_N - A_S and grad(chi) on a spherical grid patch. Note that N_phi is\n    specified by the problem but not needed for the calculation as all\n    quantities are independent of phi.\n    \n    Args:\n        g (float): Magnetic charge.\n        theta_min (float): Buffer angle in radians to exclude poles.\n        N_theta (int): Number of grid points for theta.\n        N_phi (int): Number of grid points for phi.\n        \n    Returns:\n        float: Maximum absolute mismatch.\n    \"\"\"\n    # Create a uniform grid for theta, excluding the poles.\n    theta = np.linspace(theta_min, np.pi - theta_min, N_theta)\n    \n    sin_theta = np.sin(theta)\n    cos_theta = np.cos(theta)\n    \n    # Calculate the phi-component of the vector potentials A_N and A_S on r=1.\n    # A_N is regular at the North Pole (theta=0).\n    # A_S is regular at the South Pole (theta=pi).\n    AN_phi = g * (1 - cos_theta) / sin_theta\n    AS_phi = -g * (1 + cos_theta) / sin_theta\n    \n    # Calculate the difference of the potential components.\n    # In exact arithmetic, this is 2*g / sin_theta.\n    diff_A_phi = AN_phi - AS_phi\n    \n    # Calculate the phi-component of the gradient of the gauge function chi = 2*g*phi.\n    # (grad chi)_phi = (1/sin(theta)) * d/d_phi (2*g*phi) = 2*g / sin_theta.\n    grad_chi_phi = 2 * g / sin_theta\n    \n    # Compute the mismatch. This should be close to machine epsilon.\n    mismatch = np.abs(diff_A_phi - grad_chi_phi)\n    \n    return np.max(mismatch)\n\ndef solve_curl_error(g, theta_min, N_theta):\n    \"\"\"\n    Computes the maximum absolute error in the numerical curl calculation.\n    \n    Args:\n        g (float): Magnetic charge.\n        theta_min (float): Buffer angle in radians to exclude poles.\n        N_theta (int): Number of grid points for theta.\n        \n    Returns:\n        float: Maximum absolute error between numerical and exact B_r.\n    \"\"\"\n    # Create the theta grid.\n    theta = np.linspace(theta_min, np.pi - theta_min, N_theta)\n    delta_theta = theta[1] - theta[0]\n    \n    # Calculate the potential A_N (or A_S, either works on this grid).\n    sin_theta = np.sin(theta)\n    cos_theta = np.cos(theta)\n    \n    A_phi = np.zeros_like(theta)\n    # Only calculate for non-zero g to avoid 0/0. If g=0, A_phi is 0.\n    if g != 0.0:\n        A_phi = g * (1 - cos_theta) / sin_theta\n        \n    # We need to compute the derivative of F(theta) = sin(theta) * A_phi\n    # Analytically, F(theta) = g * (1 - cos(theta))\n    F = sin_theta * A_phi\n    \n    # Use a centered finite difference for interior points of the grid.\n    # This approximates dF/dtheta at theta[1:-1].\n    dF_dtheta_num = (F[2:] - F[:-2]) / (2 * delta_theta)\n    \n    # Corresponding interior theta values.\n    theta_interior = theta[1:-1]\n    \n    # Compute numerical B_r = (1/sin(theta)) * dF/dtheta.\n    B_r_num = (1 / np.sin(theta_interior)) * dF_dtheta_num\n    \n    # The exact value of the radial magnetic field is B_r = g.\n    B_r_exact = g\n    \n    # Compute the maximum absolute error over the interior grid points.\n    error = np.abs(B_r_num - B_r_exact)\n    \n    # If there are no interior points (N_theta  3), return 0.0.\n    if error.size == 0:\n        return 0.0\n        \n    return np.max(error)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Test case #1: Gauge overlap consistency\n    g1 = 1.0\n    theta_min1 = 0.05\n    N_theta1 = 181\n    N_phi1 = 360\n    gauge_mismatch = solve_gauge_consistency(g1, theta_min1, N_theta1, N_phi1)\n\n    # Test cases #2 to #4: Curl convergence\n    g2 = 1.0\n    theta_min2 = 0.05\n    N_theta_list_curl = [33, 65, 129]\n    curl_errors = []\n    for N_theta in N_theta_list_curl:\n        err = solve_curl_error(g2, theta_min2, N_theta)\n        curl_errors.append(err)\n    \n    curl_err_33, curl_err_65, curl_err_129 = curl_errors\n\n    # Test case #5: Boundary case g=0\n    g3 = 0.0\n    theta_min3 = 0.05\n    N_theta3 = 65\n    curl_err_g0 = solve_curl_error(g3, theta_min3, N_theta3)\n\n    results = [\n        gauge_mismatch, \n        curl_err_33, \n        curl_err_65, \n        curl_err_129, \n        curl_err_g0\n    ]\n\n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}