{
    "hands_on_practices": [
        {
            "introduction": "在计算电磁学中，选择数值方法通常意味着在局部性和全局性之间做出权衡。像有限元法（FEM）这样的方法利用局部基函数，产生稀疏矩阵，而像矩量法（MoM）这样的方法使用全局格林函数，导致稠密矩阵。这项练习旨在通过推导两种情况下存储系统矩阵所需内存的精确表达式，来量化这种结构差异的实际影响 ()。",
            "id": "3329223",
            "problem": "在频域计算电磁学中，麦克斯韦方程组的旋度-旋度公式，加上适当的本构关系和边界条件，会产生一个形如 $A x = b$ 的线性系统，其中 $A$ 是系统矩阵，$x$ 集合了所选基函数的展开系数。考虑该问题的两种标准离散化方法：三维非均匀域中的有限元法 (FEM) 和用于曲面积分方程的矩量法 (MoM)。\n\n对于有限元法，假设采用相容伽辽金离散化，其节点或边基函数的支撑域局限于单元内，由于互易性和双线性形式的局域性，会产生一个对称稀疏刚度矩阵 $A \\in \\mathbb{C}^{n \\times n}$。设 $n$ 表示未知量的总数，并假设网格的连通性使得平均每个自由度通过单元邻接直接与其他 $d$ 个自由度耦合。您需要使用压缩稀疏行 (CSR) 格式来存储 $A$，但利用其对称性，仅存储上三角部分（包括对角线）。在 CSR 格式中，您必须存储三个数组：数值数组（每个存储的非零元对应一个值）、列索引数组（每个存储的非零元对应一个索引）以及长度为 $n+1$ 的行指针数组。假设每个复数值占用 $b_{c}$ 字节，每个整数索引占用 $b_{i}$ 字节。根据这些定义以及有限元法相互作用的局域性，推导出一个用 $n$、$d$、$b_{c}$ 和 $b_{i}$ 表示的精确符号表达式，用于计算以字节为单位、在 CSR 上三角格式中存储对称稀疏有限元矩阵所需的总内存。\n\n对于矩量法，假设采用标准的伽辽金离散化，处理由自由空间格林函数构建的边界积分算子。由于每个自由度都通过非局域核与其他所有自由度相互作用，因此得到的阻抗矩阵 $Z \\in \\mathbb{C}^{n \\times n}$ 是稠密的。假设该稠密矩阵以连续的二维复数值数组形式存储，没有任何额外的索引数组，并且每个复数值占用 $b_{c}$ 字节。根据这些定义以及矩量法相互作用的非局域性，推导出一个用 $n$ 和 $b_{c}$ 表示的精确符号表达式，用于计算以字节为单位存储稠密矩量法矩阵所需的总内存。\n\n不要假设任一矩阵具有托普利兹结构；处理一般情况。请使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境，将您的最终答案表示为一个包含两个条目的单行矩阵，其中第一个条目是上三角压缩稀疏行 (CSR) 格式的对称稀疏有限元矩阵的总内存，第二个条目是稠密矩量法 (MoM) 矩阵的总内存。请用 $n$、$d$、$b_{c}$ 和 $b_{i}$ 纯符号形式表示您的结果，并且不要在最终答案中包含任何单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于计算电磁学和数值线性代数的原理，问题设定适定，信息充分且一致，并且表述客观。任务是推导存储由两种不同离散化方法——有限元法 (FEM) 和矩量法 (MoM)——产生的矩阵所需的内存的符号表达式。\n\n首先，我们推导对称稀疏有限元矩阵所需的内存表达式。\n矩阵 $A$ 的大小为 $n \\times n$ 且对称。存储方案是压缩稀疏行 (CSR) 格式，仅用于存储矩阵的上三角部分，包括主对角线。这种对称 CSR 格式包含三个数组：\n$1$. 一个 `values` 数组，包含存储的复数非零矩阵元。\n$2$. 一个 `col_indices` 数组，包含每个对应值的列索引。\n$3$. 一个长度为 $n+1$ 的 `row_ptr` 数组，指示每行数据在另外两个数组中的起始位置。\n\n为了计算总内存，我们必须首先确定被存储的非零元数量 $N_{nz}$。我们存储的是满足 $i \\le j$ 且 $A_{ij} \\neq 0$ 的元素 $A_{ij}$。\n问题陈述指出，平均每个自由度与其他 $d$ 个自由度耦合。这对应于完整矩阵 $A$ 中每行的平均非对角线非零元数量。\n在整个对称矩阵 $A$ 中，非对角线非零元的总数为 $n \\times d$。由于对于每个非零元 $A_{ij}$（其中 $i \\neq j$），都有一个对应的非零元 $A_{ji}$，因此计算 $n \\times d$ 会重复计算连接。所以，唯一的非对角线相互作用对 $(i, j)$ 的数量是 $\\frac{n \\times d}{2}$。\n矩阵的上三角部分包含了所有这些唯一的非对角线相互作用。因此，存储的非对角线非零元数量为 $\\frac{nd}{2}$。\n此外，我们必须存储主对角线上的 $n$ 个元素。我们假设所有对角元素都非零，这是对此类系统的标准假设。\n存储的非零元总数 $N_{nz}$ 是对角线元素和上三角部分非对角线元素之和：\n$$N_{nz} = n + \\frac{nd}{2} = n\\left(1 + \\frac{d}{2}\\right)$$\n现在我们计算三个 CSR 数组各自所需的内存。\n`values` 数组存储 $N_{nz}$ 个复数。每个复数值占用 $b_c$ 字节。此数组所需的内存为：\n$$M_{\\text{values}} = N_{nz} \\times b_c = n\\left(1 + \\frac{d}{2}\\right) b_c$$\n`col_indices` 数组存储 $N_{nz}$ 个整数。每个整数索引占用 $b_i$ 字节。此数组所需的内存为：\n$$M_{\\text{col\\_indices}} = N_{nz} \\times b_i = n\\left(1 + \\frac{d}{2}\\right) b_i$$\n`row_ptr` 数组的固定长度为 $n+1$。每个条目是一个整数索引，占用 $b_i$ 字节。此数组所需的内存为：\n$$M_{\\text{row\\_ptr}} = (n+1) b_i$$\n有限元矩阵的总内存 $M_{FEM}$ 是这三个数组内存的总和：\n$$M_{FEM} = M_{\\text{values}} + M_{\\text{col\\_indices}} + M_{\\text{row\\_ptr}}$$\n$$M_{FEM} = n\\left(1 + \\frac{d}{2}\\right) b_c + n\\left(1 + \\frac{d}{2}\\right) b_i + (n+1) b_i$$\n合并含有 $b_i$ 的项：\n$$M_{FEM} = n\\left(1 + \\frac{d}{2}\\right) b_c + \\left[ n\\left(1 + \\frac{d}{2}\\right) + n + 1 \\right] b_i$$\n$$M_{FEM} = n\\left(1 + \\frac{d}{2}\\right) b_c + \\left( n + \\frac{nd}{2} + n + 1 \\right) b_i$$\n$$M_{FEM} = n\\left(1 + \\frac{d}{2}\\right) b_c + \\left( 2n + \\frac{nd}{2} + 1 \\right) b_i$$\n\n接下来，我们推导稠密矩量法矩阵所需的内存表达式。\n阻抗矩阵 $Z$ 的大小为 $n \\times n$ 并且是稠密的。这意味着它的所有元素都被认为是非零的，并且必须被存储。\n矩阵中的总元素数量为 $n \\times n = n^2$。\n该矩阵以连续的二维数组形式存储。每个元素是一个复数值，占用 $b_c$ 字节。对于稠密矩阵，不使用额外的索引数组。\n矩量法矩阵的总内存 $M_{MoM}$ 是总元素数乘以每个元素的大小：\n$$M_{MoM} = n^2 \\times b_c = n^2 b_c$$\n这就得出了两个所需的符号表达式。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} n \\left(1 + \\frac{d}{2}\\right) b_c + \\left( 2n + \\frac{nd}{2} + 1 \\right) b_i  n^2 b_c \\end{pmatrix} } $$"
        },
        {
            "introduction": "稀疏矩阵的结构并非随机，而是底层物理和所选离散化方案的直接体现。通过深入研究一个具体的例子——在结构化网格上对麦克斯韦旋度-旋度方程进行有限差分离散，我们可以揭示这种联系。这项练习将引导你从偏微分方程（PDE）出发，构建出系统矩阵中特定一行所对应的非零耦合模式，即“计算模板” ()。",
            "id": "3329230",
            "problem": "考虑在一个波数 $k$ 为常数的均匀、各向同性介质中的时谐麦克斯韦旋度-旋度方程：\n$$\\nabla \\times \\nabla \\times \\mathbf{E} - k^{2} \\mathbf{E} = \\mathbf{f},$$\n其中 $\\mathbf{E}(\\mathbf{x}) \\in \\mathbb{R}^{3}$ 是电场，$\\mathbf{f}$ 是给定的源。我们在一个三维均匀结构化网格上进行计算，其在 $x$、$y$ 和 $z$ 方向上的网格间距分别为 $h_{x}$、$h_{y}$ 和 $h_{z}$。在有限差分频域（FDFD）方法中采用同位离散化，将 $\\mathbf{E}$ 的所有三个分量都置于相同的网格节点上。使用二阶中心差分来离散化所有的一阶和二阶导数。仅考虑内部节点（忽略边界条件），并假设整个区域内的系数为常数。对未知数使用块-字典序排序，其中每个节点的三个分量 $(E_{x}, E_{y}, E_{z})$ 在全局向量中被组合在一起。\n\n从矢量微积分恒等式\n$$\\nabla \\times \\nabla \\times \\mathbf{E} = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^{2} \\mathbf{E},$$\n出发，并对每个导数使用二阶中心差分，构建与一个代表性内部节点 $(i,j,k)$ 上的 $x$ 分量 $E_{x}$ 对应的内部自由度相关联的稀疏系统矩阵行的邻接模式（图）。在您的构建过程中，请明确指出在这种离散化下，哪些相邻节点以及这些节点上的哪些场分量会耦合到 $E_{x}(i,j,k)$ 所在的行中。\n\n模板宽度的定义如下：对于出现在该行非零耦合中的网格偏移集合 $(\\Delta i, \\Delta j, \\Delta k)$，模板宽度 $w$ 是所有这些偏移上的最大切比雪夫距离 $w = \\max\\{|\\Delta i|, |\\Delta j|, |\\Delta k|\\}$。每行的非零元数量是在上述假设下，内部 $E_{x}$ 行的不同耦合（包括对角线元素）的总数。\n\n计算模板宽度和每行的非零元数量。请将您的最终答案表示为一个二元行矩阵 $\\begin{pmatrix} w  \\text{nnz} \\end{pmatrix}$。无需四舍五入。",
            "solution": "该问题基于电磁学的基本原理和标准数值方法，科学上合理、适定且客观。确定内部节点的模板性质所需的所有信息均已提供。因此，该问题是有效的。\n\n我们从给定的时谐麦克斯韦旋度-旋度方程开始：\n$$ \\nabla \\times \\nabla \\times \\mathbf{E} - k^{2} \\mathbf{E} = \\mathbf{f} $$\n问题要求我们使用矢量微积分恒等式 $\\nabla \\times \\nabla \\times \\mathbf{E} = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^{2} \\mathbf{E}$。将其代入方程得到：\n$$ \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^{2} \\mathbf{E} - k^{2} \\mathbf{E} = \\mathbf{f} $$\n我们需要分析系统矩阵中与一个代表性内部网格节点 $(i,j,k)$ 上的电场 $x$ 分量 $E_{x}$ 相对应的行。让我们写出该矢量方程的 $x$ 分量：\n$$ (\\nabla(\\nabla \\cdot \\mathbf{E}))_{x} - (\\nabla^{2} \\mathbf{E})_{x} - k^{2} E_{x} = f_{x} $$\n首先，我们展开矢量算子。$\\mathbf{E}$ 的散度为：\n$$ \\nabla \\cdot \\mathbf{E} = \\frac{\\partial E_{x}}{\\partial x} + \\frac{\\partial E_{y}}{\\partial y} + \\frac{\\partial E_{z}}{\\partial z} $$\n该标量场的梯度的 $x$ 分量是：\n$$ (\\nabla(\\nabla \\cdot \\mathbf{E}))_{x} = \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial E_{x}}{\\partial x} + \\frac{\\partial E_{y}}{\\partial y} + \\frac{\\partial E_{z}}{\\partial z} \\right) = \\frac{\\partial^{2} E_{x}}{\\partial x^{2}} + \\frac{\\partial^{2} E_{y}}{\\partial x \\partial y} + \\frac{\\partial^{2} E_{z}}{\\partial x \\partial z} $$\n矢量拉普拉斯算子 $\\nabla^2 \\mathbf{E}$ 的 $x$ 分量就是作用于 $E_x$ 的标量拉普拉斯算子：\n$$ (\\nabla^{2} \\mathbf{E})_{x} = \\nabla^{2} E_{x} = \\frac{\\partial^{2} E_{x}}{\\partial x^{2}} + \\frac{\\partial^{2} E_{x}}{\\partial y^{2}} + \\frac{\\partial^{2} E_{x}}{\\partial z^{2}} $$\n将这些展开式代入场的 $x$ 分量方程：\n$$ \\left( \\frac{\\partial^{2} E_{x}}{\\partial x^{2}} + \\frac{\\partial^{2} E_{y}}{\\partial x \\partial y} + \\frac{\\partial^{2} E_{z}}{\\partial x \\partial z} \\right) - \\left( \\frac{\\partial^{2} E_{x}}{\\partial x^{2}} + \\frac{\\partial^{2} E_{x}}{\\partial y^{2}} + \\frac{\\partial^{2} E_{x}}{\\partial z^{2}} \\right) - k^{2} E_{x} = f_{x} $$\n项 $\\frac{\\partial^{2} E_{x}}{\\partial x^{2}}$ 被消掉，得到关于 $E_x$ 的简化偏微分方程：\n$$ - \\frac{\\partial^{2} E_{x}}{\\partial y^{2}} - \\frac{\\partial^{2} E_{x}}{\\partial z^{2}} + \\frac{\\partial^{2} E_{y}}{\\partial x \\partial y} + \\frac{\\partial^{2} E_{z}}{\\partial x \\partial z} - k^{2} E_{x} = f_{x} $$\n接下来，我们在间距为 $h_x, h_y, h_z$ 的均匀网格上，使用二阶中心差分来离散化每个导数。令 $E_c(i,j,k)$ 表示在网格节点 $(x_i, y_j, z_k)$ 上分量 $c \\in \\{x,y,z\\}$ 的值。\n\n$E_x$ 的二阶偏导数近似为：\n$$ \\frac{\\partial^{2} E_{x}}{\\partial y^{2}} \\bigg|_{(i,j,k)} \\approx \\frac{E_{x}(i,j+1,k) - 2E_{x}(i,j,k) + E_{x}(i,j-1,k)}{h_{y}^{2}} $$\n$$ \\frac{\\partial^{2} E_{x}}{\\partial z^{2}} \\bigg|_{(i,j,k)} \\approx \\frac{E_{x}(i,j,k+1) - 2E_{x}(i,j,k) + E_{x}(i,j,k-1)}{h_{z}^{2}} $$\n混合偏导数通过依次应用中心差分来近似：\n$$ \\frac{\\partial^{2} E_{y}}{\\partial x \\partial y} \\bigg|_{(i,j,k)} \\approx \\frac{1}{4h_{x}h_{y}} [E_{y}(i+1,j+1,k) - E_{y}(i-1,j+1,k) - E_{y}(i+1,j-1,k) + E_{y}(i-1,j-1,k)] $$\n$$ \\frac{\\partial^{2} E_{z}}{\\partial x \\partial z} \\bigg|_{(i,j,k)} \\approx \\frac{1}{4h_{x}h_{z}} [E_{z}(i+1,j,k+1) - E_{z}(i-1,j,k+1) - E_{z}(i+1,j,k-1) + E_{z}(i-1,j,k-1)] $$\n将这些有限差分近似代入 $E_x$ 的简化偏微分方程，得到关于未知数 $E_x(i,j,k)$ 的离散方程。该方程揭示了耦合关系，这些关系构成了相应矩阵行的邻接模式。\n\n与自由度 $E_x(i,j,k)$ 对应的矩阵行与以下未知数耦合：\n1.  **与 $E_x$ 分量的耦合：**\n    - 来自 $-\\frac{\\partial^2 E_x}{\\partial y^2}$ 的离散化：$E_x(i,j-1,k)$、$E_x(i,j,k)$、$E_x(i,j+1,k)$。\n    - 来自 $-\\frac{\\partial^2 E_x}{\\partial z^2}$ 的离散化：$E_x(i,j,k-1)$、$E_x(i,j,k)$、$E_x(i,j,k+1)$。\n    - 来自 $-k^2 E_x$ 项：$E_x(i,j,k)$。\n    综合这些，未知数包括 $E_x(i,j,k)$（对角线元素）、$E_x(i,j-1,k)$、$E_x(i,j+1,k)$、$E_x(i,j,k-1)$ 和 $E_x(i,j,k+1)$。\n    这相当于涉及 $E_x$ 分量的 $5$ 个不同耦合。\n\n2.  **与 $E_y$ 分量的耦合：**\n    - 来自 $\\frac{\\partial^2 E_y}{\\partial x \\partial y}$ 的离散化：$E_y(i+1,j+1,k)$、$E_y(i-1,j+1,k)$、$E_y(i+1,j-1,k)$ 和 $E_y(i-1,j-1,k)$。\n    这相当于涉及 $E_y$ 分量的 $4$ 个不同耦合。\n\n3.  **与 $E_z$ 分量的耦合：**\n    - 来自 $\\frac{\\partial^2 E_z}{\\partial x \\partial z}$ 的离散化：$E_z(i+1,j,k+1)$、$E_z(i-1,j,k+1)$、$E_z(i+1,j,k-1)$ 和 $E_z(i-1,j,k-1)$。\n    这相当于涉及 $E_z$ 分量的 $4$ 个不同耦合。\n\n每行的非零元数量，记为 $\\text{nnz}$，是不同耦合的总数。\n$$ \\text{nnz} = (\\text{与 } E_x \\text{ 的耦合数}) + (\\text{与 } E_y \\text{ 的耦合数}) + (\\text{与 } E_z \\text{ 的耦合数}) $$\n$$ \\text{nnz} = 5 + 4 + 4 = 13 $$\n\n为了找到模板宽度 $w$，我们考察所有耦合节点相对于中心节点 $(i,j,k)$ 的网格偏移 $(\\Delta i, \\Delta j, \\Delta k)$。偏移集合为：\n- 对于 $E_x$：$\\{(0,0,0), (0,1,0), (0,-1,0), (0,0,1), (0,0,-1)\\}$\n- 对于 $E_y$：$\\{(1,1,0), (-1,1,0), (1,-1,0), (-1,-1,0)\\}$\n- 对于 $E_z$：$\\{(1,0,1), (-1,0,1), (1,0,-1), (-1,0,-1)\\}$\n\n模板宽度 $w$ 是所有这些偏移上的最大切比雪夫距离：对于一个偏移 $(\\Delta i, \\Delta j, \\Delta k)$，其切比雪夫距离是 $\\max \\{ |\\Delta i|, |\\Delta j|, |\\Delta k| \\}$。我们需要在所有这些偏移上找到该距离的最大值。\n对于上面列出的所有偏移，任何分量的最大绝对值都是 $1$。例如，对于偏移 $(1,1,0)$，切比雪夫距离是 $\\max\\{|1|,|1|,|0|\\} = 1$。对于偏移 $(0,0,-1)$，距离是 $\\max\\{|0|,|0|,|-1|\\} = 1$。因此，整个集合上的最大值是 $1$。\n$$ w = 1 $$\n模板宽度为 $w=1$，每行的非零元数量为 $\\text{nnz}=13$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1  13 \\end{pmatrix}}$$"
        }
    ]
}