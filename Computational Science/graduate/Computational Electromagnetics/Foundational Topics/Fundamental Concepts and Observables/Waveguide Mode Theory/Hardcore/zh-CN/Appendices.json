{
    "hands_on_practices": [
        {
            "introduction": "从麦克斯韦方程组出发，推导特定几何形状中波导模式的结构和特性，是一项基本功。本练习  将指导你完成对圆形波导的完整分析。你将需要在圆柱坐标系下求解亥姆霍兹方程，施加理想电导体（PEC）边界条件，并最终确定横电（TE）和横磁（TM）模的截止频率。这项实践旨在加深你对波导截止现象物理本质的理解，并熟练掌握处理贝塞尔函数在电磁场边值问题中的应用。",
            "id": "3360771",
            "problem": "一个半径为 $a=1.50\\,\\mathrm{cm}$ 的理想电导体 (PEC) 圆形波导，完全填充有均匀、各向同性、无损耗的介质，其相对介电常数为 $\\varepsilon_{r}=2.25$，相对磁导率为 $\\mu_{r}=1$。假设场为角频率为 $\\omega$ 的时谐场，并沿波导轴具有 $\\exp(-j\\beta z)$ 的纵向相关性。从无源麦克斯韦方程组和切向电场在壁上为零的理想电导体边界条件出发，在不引用任何已知的色散或截止频率公式的情况下，执行以下步骤：\n\n- 在柱坐标系下建立纵向场分量的本征值问题，确定其控制微分方程，并通过施加轴上正则性条件来选取容许的径向解。\n- 在 $\\rho=a$ 处施加理想电导体边界条件，以获得确定横磁 (TM) 模和横电 (TE) 模族容许的横向波数的特征方程。\n- 根据这些特征方程，确定圆形波导中哪个模族和方位角指数对应于基模（最低截止频率模式），然后根据给定的 $a$、$\\varepsilon_{r}$ 和 $\\mu_{r}$ 数值计算该基模的截止频率。\n\n使用真空中的光速 $c=2.99792458\\times 10^{8}\\,\\mathrm{m/s}$。将最终数值答案四舍五入至四位有效数字，并以 $\\mathrm{GHz}$ 为单位表示。最终答案必须仅为数值。",
            "solution": "分析始于线性、各向同性、均匀介质中的无源时谐麦克斯韦方程组，该介质的介电常数为 $\\varepsilon = \\varepsilon_0\\varepsilon_r$，磁导率为 $\\mu = \\mu_0\\mu_r$。假设时间依赖关系为 $\\exp(j\\omega t)$，则这些方程为：\n$$ \\nabla \\times \\mathbf{E} = -j\\omega\\mu\\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j\\omega\\varepsilon\\mathbf{E} $$\n问题指定了沿波导轴的纵向场依赖关系为 $\\exp(-j\\beta z)$，这意味着算子 $\\frac{\\partial}{\\partial z}$ 可以用 $-j\\beta$ 替换。场可以分解为横向分量（$\\mathbf{E}_t, \\mathbf{H}_t$）和纵向分量（$E_z, H_z$）：$\\mathbf{E} = \\mathbf{E}_t + E_z\\hat{\\mathbf{z}}$ 和 $\\mathbf{H} = \\mathbf{H}_t + H_z\\hat{\\mathbf{z}}$。类似地，旋度算子分解为 $\\nabla = \\nabla_t - j\\beta\\hat{\\mathbf{z}}$。\n\n将这些代入麦克斯韦方程组并分离横向和纵向分量，可以得到用纵向场表示的横向场：\n$$ \\mathbf{E}_t = -\\frac{j}{k_c^2} \\left( \\beta \\nabla_t E_z - \\omega\\mu (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) \\right) $$\n$$ \\mathbf{H}_t = -\\frac{j}{k_c^2} \\left( \\beta \\nabla_t H_z + \\omega\\varepsilon (\\hat{\\mathbf{z}} \\times \\nabla_t E_z) \\right) $$\n其中 $k_c^2 = \\omega^2\\mu\\varepsilon - \\beta^2$ 是横向波数的平方。可以发现，纵向分量 $E_z$ 和 $H_z$ 满足二维标量亥姆霍兹方程：\n$$ (\\nabla_t^2 + k_c^2)E_z = 0 $$\n$$ (\\nabla_t^2 + k_c^2)H_z = 0 $$\n这构成了纵向场分量的本征值问题，其中 $k_c^2$ 是本征值，纵向场是本征函数。在柱坐标系 $(\\rho, \\phi, z)$ 中，横向拉普拉斯算子为 $\\nabla_t^2 = \\frac{1}{\\rho}\\frac{\\partial}{\\partial\\rho}(\\rho\\frac{\\partial}{\\partial\\rho}) + \\frac{1}{\\rho^2}\\frac{\\partial^2}{\\partial\\phi^2}$。对于一个通用的纵向场分量 $\\Psi(\\rho, \\phi)$，其控制微分方程为：\n$$ \\frac{1}{\\rho}\\frac{\\partial}{\\partial\\rho}\\left(\\rho\\frac{\\partial \\Psi}{\\partial\\rho}\\right) + \\frac{1}{\\rho^2}\\frac{\\partial^2 \\Psi}{\\partial\\phi^2} + k_c^2\\Psi = 0 $$\n使用分离变量法，我们令 $\\Psi(\\rho, \\phi) = R(\\rho)\\Phi(\\phi)$。这会得到两个常微分方程：\n$$ \\frac{d^2\\Phi}{d\\phi^2} + n^2\\Phi = 0 $$\n$$ \\rho^2\\frac{d^2 R}{d\\rho^2} + \\rho\\frac{dR}{d\\rho} + (k_c^2\\rho^2 - n^2)R = 0 $$\n常数 $n^2$ 来自于分离变量。为了使场在 $\\phi$ 方向上是单值的，$n$ 必须是整数，$n=0, 1, 2, \\dots$。$\\Phi(\\phi)$ 的解是 $\\cos(n\\phi)$ 和 $\\sin(n\\phi)$ 的线性组合。径向方程是贝塞尔方程。其通解是第一类贝塞尔函数 $J_n(k_c\\rho)$ 和第二类贝塞尔函数 $Y_n(k_c\\rho)$ 的线性组合。\n为了施加轴上 ($\\rho=0$) 的正则性条件，我们必须确保场是有限的。由于 $Y_n(k_c\\rho)$ 在 $\\rho \\to 0$ 时发散，其系数必须为零。因此，容许的径向解的形式为 $J_n(k_c\\rho)$。\n纵向分量的通解是以下形式的模式的叠加：\n$E_z(\\rho, \\phi) = A_{n} J_n(k_c\\rho) \\cos(n\\phi+\\phi_0)$\n$H_z(\\rho, \\phi) = B_{n} J_n(k_c\\rho) \\cos(n\\phi+\\psi_0)$\n\n接下来，我们在 $\\rho=a$ 处施加理想电导体 (PEC) 壁的边界条件。电场的切向分量在导体表面必须为零。切向分量是 $E_z$ 和 $E_\\phi$。\n$$ E_z(\\rho=a, \\phi) = 0 $$\n$$ E_\\phi(\\rho=a, \\phi) = 0 $$\n波导模式分为两族：横磁 (TM) 模和横电 (TE) 模。\n\n对于横磁 (TM) 模，根据定义有 $H_z=0$。边界条件 $E_z(a, \\phi) = 0$ 意味着：\n$$ A_n J_n(k_c a) \\cos(n\\phi+\\phi_0) = 0 $$\n为了得到非平凡解 ($A_n \\neq 0$)，该式必须对所有 $\\phi$ 成立，这要求 $J_n(k_c a) = 0$。另一个关于 $E_\\phi$ 的边界条件是自动满足的，因为 $E_\\phi = -\\frac{j\\beta}{k_c^2\\rho}\\frac{\\partial E_z}{\\partial \\phi}$ 且对于所有 $\\phi$ 都有 $E_z(a, \\phi)=0$。因此，TM$_{nm}$ 模的特征方程是：\n$$ J_n(k_c a) = 0 $$\n$k_c$ 的容许值由 $k_c = p_{nm}/a$ 给出，其中 $p_{nm}$ 是贝塞尔函数 $J_n(x)$ 的第 $m$ 个根。\n\n对于横电 (TE) 模，根据定义有 $E_z=0$。因此边界条件 $E_z(a, \\phi)=0$ 是自然满足的。我们必须应用条件 $E_\\phi(a, \\phi)=0$。对于 TE 模，$E_\\phi$ 的表达式简化为：\n$$ E_\\phi = -\\frac{j\\omega\\mu}{k_c^2} \\frac{\\partial H_z}{\\partial \\rho} $$\n代入 $H_z$ 的解：\n$$ E_\\phi(\\rho,\\phi) = -\\frac{j\\omega\\mu}{k_c^2} B_n \\frac{d}{d\\rho}[J_n(k_c\\rho)] \\cos(n\\phi+\\psi_0) = -\\frac{j\\omega\\mu}{k_c} B_n J_n'(k_c\\rho) \\cos(n\\phi+\\psi_0) $$\n其中 $J_n'(x)$ 是 $J_n(x)$ 对其自变量 $x$ 的导数。边界条件 $E_\\phi(a, \\phi)=0$ 要求：\n$$ J_n'(k_c a) = 0 $$\n这是 TE$_{nm}$ 模的特征方程。 $k_c$ 的容许值是 $k_c = p'_{nm}/a$，其中 $p'_{nm}$ 是导数 $J_n'(x)$ 的第 $m$ 个根。\n\n基模是截止频率最低的模式。截止频率 $f_c$ 发生在传播常数 $\\beta=0$ 时。根据色散关系 $k_c^2 = \\omega^2\\mu\\varepsilon - \\beta^2$，我们得到 $\\omega_c = k_c/\\sqrt{\\mu\\varepsilon}$。截止频率为 $f_c = \\omega_c/(2\\pi) = k_c / (2\\pi\\sqrt{\\mu\\varepsilon})$。最低的 $f_c$ 对应于 $k_c$ 的最小可能值，这又对应于 $J_n(k_ca)=0$ 或 $J_n'(k_ca)=0$ 的最小根。我们考察小 $n$ 值的前几个根 ($m=1$)：\n$J_n(x)=0$ 的根 (对于 TM 模)：\n$p_{01} \\approx 2.405$ (TM$_{01}$ 模)\n$p_{11} \\approx 3.832$ (TM$_{11}$ 模)\n$p_{21} \\approx 5.136$ (TM$_{21}$ 模)\n\n$J_n'(x)=0$ 的根 (对于 TE 模)：\n$J_0'(x) = -J_1(x)$，所以 $p'_{01}=p_{11} \\approx 3.832$ (TE$_{01}$ 模)\n$p'_{11} \\approx 1.841$ (TE$_{11}$ 模)\n$p'_{21} \\approx 3.054$ (TE$_{21}$ 模)\n（注意：对于 $n \\ge 1$ 的 $p'_{n0}=0$ 和 $J_0'(0)=0$ 是对应于 $k_c=0$ 的平凡根，它们在这种类型的波导中不是传播模式。）\n\n比较所列出的非零根，最小值是 $p'_{11} \\approx 1.841$。因此，基模是 TE$_{11}$ 模，它属于方位角指数 $n=1$ 的 TE 模族。\n\n基模的截止频率由下式给出：\n$$ f_c = \\frac{p'_{11} c}{2\\pi a \\sqrt{\\mu_r \\varepsilon_r}} $$\n其中 $c=1/\\sqrt{\\mu_0\\varepsilon_0}$ 是真空中的光速。给定的参数是：\n$a = 1.50\\,\\mathrm{cm} = 1.50 \\times 10^{-2}\\,\\mathrm{m}$\n$\\varepsilon_r = 2.25$\n$\\mu_r = 1$\n$c = 2.99792458 \\times 10^8\\,\\mathrm{m/s}$\n根的值是 $p'_{11} \\approx 1.84118378$。\n\n将这些值代入公式：\n$$ f_c = \\frac{1.84118378 \\times (2.99792458 \\times 10^8\\,\\mathrm{m/s})}{2\\pi (1.50 \\times 10^{-2}\\,\\mathrm{m}) \\sqrt{1 \\times 2.25}} $$\n$$ f_c = \\frac{1.84118378 \\times 2.99792458 \\times 10^8}{2\\pi \\times 1.50 \\times 10^{-2} \\times 1.5} $$\n$$ f_c = \\frac{5.519780 \\times 10^8}{0.14137167} \\approx 3.904481 \\times 10^9\\,\\mathrm{Hz} $$\n转换为 GHz 并四舍五入到四位有效数字：\n$$ f_c \\approx 3.904\\,\\mathrm{GHz} $$",
            "answer": "$$\\boxed{3.904}$$"
        },
        {
            "introduction": "在掌握了均匀波导中的单个模式之后，下一个关键步骤是分析模式在不连续界面处的行为。本练习  探讨了模式匹配法——一种用于分析波导连接和材料突变的强大技术。通过在介质交界面上施加切向电场和磁场的连续性条件，并利用波导模式的正交性，你可以精确求解每个模式的反射和透射系数。这项实践不仅揭示了能量在传播与倏逝模式间的转换，也为理解和设计滤波器、转换器等微波器件奠定了基础。",
            "id": "3360782",
            "problem": "考虑两个半无限、理想导电的矩形波导，它们共享相同的横截面，但填充有不同种类的均匀、各向同性、无损介质。介质之间的界面位于平面 $z=0$ 处。横截面是一个沿 $x$ 轴宽为 $a$、沿 $y$ 轴高为 $b$ 的矩形，其壁为理想电导体 (PEC)。在区域 1 ($z0$) 中，介质的介电常数为 $\\epsilon_1$，磁导率为 $\\mu_1$；在区域 2 ($z>0$) 中，介质的介电常数为 $\\epsilon_2$，磁导率为 $\\mu_2$。波导由一个来自 $z=-\\infty$ 的单位振幅的单一前向传播模式激励。假设场为时谐场，遵循 $\\exp(j \\omega t)$ 约定，角频率为 $\\omega$。\n\n您的任务是，从第一性原理出发，在波导模式理论的意义下，通过模式匹配方法推导介质不连续处的散射。推导过程和最终的算法必须从频域中的麦克斯韦方程组以及在 PEC 壁和材料界面处的边界条件开始。仅使用构成计算电磁学和波导模式理论基础的事实和定义。不要在问题陈述中引入快捷公式。\n\n推导和算法设计中需包含的要求：\n- 从频域麦克斯韦方程组 $\\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E}$，以及金属壁上的 PEC 边界条件和 $z=0$ 界面处切向场的连续性出发。\n- 通过分离变量法，求出矩形 PEC 波导中横电 (TE) 和横磁 (TM) 模式的横向场本征函数，并定义模式指数 $(m,n)$、截止波数 $k_c$ 和轴向传播常数 $\\beta$，区分传播（$\\beta$ 为实数）和倏逝（$\\beta$ 为虚数）两种情况。\n- 根据场关系和功率流，定义 TE 和 TM 模式的模式特性阻抗，并使其与横截面上的正交性积分所隐含的归一化一致。\n- 通过强制切向电场和磁场在界面 $z=0$ 处的连续性，建立并求解模式匹配问题。在区域 1 和区域 2 横截面相同的特殊情况下，论证本征函数的正交性和完备性导致对角耦合（无交叉模式转换），因此每个入射模式仅散射到界面对面的同指数 $(m,n)$ 模式。\n- 从连续性关系中，推导出单个激励模式的反射和透射振幅，用两侧的模式阻抗表示。\n- 将振幅转换为由前向传播的透射模式和后向传播的反射模式所携带的功率分数。阐明如何处理透射模式为倏逝波（无净功率传输）的情况，并说明能量守恒意味着反射功率分数为 1 的条件。\n\n实现任务：\n- 编写一个完整、可运行的程序，对于一组给定的参数 $(a,b,\\epsilon_1,\\mu_1,\\epsilon_2,\\mu_2,\\omega,\\text{模式类型},m,n)$，计算从区域 1 中 $z=-\\infty$ 处入射的唯一模式 $(m,n)$ 的反射功率分数 $\\mathcal{R}$ 和透射功率分数 $\\mathcal{T}$。\n- 在适当情况下使用真空介电常数 $\\epsilon_0$ 和真空磁导率 $\\mu_0$，其中 $\\epsilon_0$ 和 $\\mu_0$ 为给定常数。如果指定了相对介电常数 $\\epsilon_r$，则取 $\\epsilon=\\epsilon_r \\epsilon_0$。对于以下所有测试用例，假设 $\\mu_1=\\mu_2=\\mu_0$。\n- 所有几何长度以米为单位，所有频率以赫兹为单位，并以小数形式生成无量纲的功率分数。不使用角度单位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序由测试套件指定。\n\n算法所需的定义（需在解答中推导和使用，而非作为问题陈述中的快捷方式给出）：\n- 矩形波导本征值问题得出 $k_c$ 作为 $(m,n,a,b)$ 的函数，轴向传播常数 $\\beta$ 作为 $(\\omega,\\epsilon,\\mu,k_c)$ 的函数，以及 TE 和 TM 模式的模式阻抗作为 $(\\omega,\\epsilon,\\mu,\\beta)$ 的函数。使用这些推导出的关系来计算 $\\mathcal{R}$ 和 $\\mathcal{T}$。\n\n测试套件：\n对于每个测试用例，计算指定单个入射模式的反射和透射功率分数。在单行输出中按 $[\\mathcal{R}_1,\\mathcal{T}_1,\\mathcal{R}_2,\\mathcal{T}_2,\\mathcal{R}_3,\\mathcal{T}_3]$ 的顺序以浮点数报告结果。\n\n- 测试用例 1（一般传播情况）：\n  - 几何结构：$a = 0.02286\\,\\mathrm{m}$，$b = 0.01016\\,\\mathrm{m}$。\n  - 材料：$\\epsilon_1 = \\epsilon_0$，$\\mu_1 = \\mu_0$；$\\epsilon_2 = 2.25\\,\\epsilon_0$，$\\mu_2 = \\mu_0$。\n  - 频率：$f = 10\\times 10^9\\,\\mathrm{Hz}$（因此 $\\omega = 2\\pi f$）。\n  - 入射模式：TE 模式，$(m,n)=(1,0)$。\n  - 两侧对于此模式均在截止频率以上。以小数分数输出 $\\mathcal{R}_1$ 和 $\\mathcal{T}_1$。\n\n- 测试用例 2（透射进入倏逝波情况）：\n  - 几何结构：$a = 0.02286\\,\\mathrm{m}$，$b = 0.01016\\,\\mathrm{m}$。\n  - 材料：$\\epsilon_1 = 2.25\\,\\epsilon_0$，$\\mu_1 = \\mu_0$；$\\epsilon_2 = \\epsilon_0$，$\\mu_2 = \\mu_0$。\n  - 频率：$f = 5.5\\times 10^9\\,\\mathrm{Hz}$（因此 $\\omega = 2\\pi f$）。\n  - 入射模式：TE 模式，$(m,n)=(1,0)$。\n  - 区域 1 在截止频率以上；区域 2 在截止频率以下。以小数分数输出 $\\mathcal{R}_2$ 和 $\\mathcal{T}_2$，由于没有净透射功率，$\\mathcal{T}_2$ 等于 $0$。\n\n- 测试用例 3（相同介质，边界条件情况）：\n  - 几何结构：$a = 0.02286\\,\\mathrm{m}$，$b = 0.01016\\,\\mathrm{m}$。\n  - 材料：$\\epsilon_1 = \\epsilon_0$，$\\mu_1 = \\mu_0$；$\\epsilon_2 = \\epsilon_0$，$\\mu_2 = \\mu_0$。\n  - 频率：$f = 14\\times 10^9\\,\\mathrm{Hz}$（因此 $\\omega = 2\\pi f$）。\n  - 入射模式：TE 模式，$(m,n)=(2,0)$。\n  - 两侧均在截止频率以上且相同；以小数分数输出 $\\mathcal{R}_3$ 和 $\\mathcal{T}_3$，在理想情况下应为 $\\mathcal{R}_3=0$ 和 $\\mathcal{T}_3=1$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为 $[\\mathcal{R}_1,\\mathcal{T}_1,\\mathcal{R}_2,\\mathcal{T}_2,\\mathcal{R}_3,\\mathcal{T}_3]$。例如，一个有效的输出行看起来像 $[0.1,0.9,1.0,0.0,0.0,1.0]$。",
            "solution": "此问题旨在分析均匀矩形波导内平面介质界面上单个波导模式的散射。分析应从第一性原理，即麦克斯韦方程组开始。\n\n我们从无源、均匀、各向同性、线性介质中时谐形式的麦克斯韦方程组开始，假设时间依赖性为 $\\exp(j \\omega t)$：\n$$ \\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E} $$\n其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 是电场和磁场的复数相量，$\\omega$ 是角频率，$\\epsilon$ 和 $\\mu$ 分别是介质的介电常数和磁导率。\n\n对第一个方程取旋度，并代入第二个方程，可得到关于 $\\mathbf{E}$ 的矢量波动方程：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = -j \\omega \\mu (\\nabla \\times \\mathbf{H}) = -j \\omega \\mu (j \\omega \\epsilon \\mathbf{E}) = \\omega^2 \\mu \\epsilon \\mathbf{E} $$\n利用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ 以及在无源区中 $\\nabla \\cdot \\mathbf{D} = \\epsilon \\nabla \\cdot \\mathbf{E} = 0$ 的事实，我们得到矢量亥姆霍兹方程：\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0 $$\n其中 $k^2 = \\omega^2 \\mu \\epsilon$ 是介质中波数的平方。对于 $\\mathbf{H}$ 也存在类似的方程。\n\n对于沿 $z$ 轴方向的波导，我们寻求形式为 $\\mathbf{E}(x,y,z) = \\mathbf{e}(x,y) e^{-j\\beta z}$ 的模式解，其中 $\\mathbf{e}(x,y)$ 是横向模式分布，$\\beta$ 是纵向传播常数。算子 $\\nabla^2$ 可以分离为横向和纵向部分：$\\nabla^2 = \\nabla_t^2 + \\frac{\\partial^2}{\\partial z^2}$。将模式形式代入亥姆霍兹方程得到：\n$$ (\\nabla_t^2 - \\beta^2 + k^2) \\mathbf{e}(x,y) = 0 $$\n这是一个关于横向算子 $\\nabla_t^2$ 的本征值方程。我们定义截止波数 $k_c$，使得 $k_c^2 = k^2 - \\beta^2$。由此得出传播常数的色散关系：\n$$ \\beta = \\sqrt{k^2 - k_c^2} = \\sqrt{\\omega^2 \\mu \\epsilon - k_c^2} $$\n如果 $k > k_c$，$\\beta$ 是实数且为正，对应于传播模式。如果 $k  k_c$，$\\beta$ 是纯虚数。我们选择 $\\beta = -j\\alpha$，其中 $\\alpha = \\sqrt{k_c^2 - k^2}$ 是一个实数正值，这对应于在 $+z$ 方向上衰减的倏逝模式。\n\n波导内的场被分为横电 (TE) 模式（其中 $E_z=0$）和横磁 (TM) 模式（其中 $H_z=0$）。横向场分量 $(\\mathbf{E}_t, \\mathbf{H}_t)$ 可以用纵向分量 $(E_z, H_z)$ 表示，从而得到两组独立的解。\n\n对于在 $x=0,a$ 和 $y=0,b$ 处具有理想电导体 (PEC) 壁的矩形波导，边界条件要求壁上的切向电场为零。\n\n对于 TM 模式 ($H_z=0$)，我们求解 $\\nabla_t^2 E_z + k_c^2 E_z = 0$，边界条件为在所有四个壁上 $E_z=0$。分离变量法得到本征函数：\n$$ E_z(x,y) = E_{mn} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right), \\quad m,n = 1,2,3,... $$\n相应的截止波数为 $k_{c,mn}^2 = \\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2$。\n\n对于 TE 模式 ($E_z=0$)，我们求解 $\\nabla_t^2 H_z + k_c^2 H_z = 0$。切向电场的边界条件意味着 $H_z$ 在壁上的法向导数为零，即 $\\partial H_z / \\partial n = 0$。这给出了本征函数：\n$$ H_z(x,y) = H_{mn} \\cos\\left(\\frac{m\\pi x}{a}\\right) \\cos\\left(\\frac{n\\pi y}{b}\\right), \\quad m,n = 0,1,2,... \\text{ (m, n 不同时为零)} $$\n截止波数 $k_{c,mn}$ 的表达式与 TM 模式相同。\n\n横向场通过模式特性阻抗相关联，其定义为前向传播波的 $|\\mathbf{E}_t|/|\\mathbf{H}_t|$。对于给定模式，该比率在波导横截面上是恒定的。对于前向传播波，关系式为 $\\mathbf{H}_t = (1/Z_{\\text{mode}})(\\hat{\\mathbf{z}} \\times \\mathbf{E}_t)$。从麦克斯韦方程组推导出的表达式是：\n$$ Z_{TE} = \\frac{\\omega\\mu}{\\beta} $$\n$$ Z_{TM} = \\frac{\\beta}{\\omega\\epsilon} $$\n对于传播模式（$\\beta$ 为实数），这些阻抗是实数。对于倏逝模式（$\\beta = -j\\alpha$），$Z_{TE}$ 是感性的（正虚部），$Z_{TM}$ 是容性的（负虚部）。\n\n现在，考虑 $z=0$ 处的界面。区域 1 ($z0$) 的属性为 $(\\epsilon_1, \\mu_1)$，区域 2 ($z>0$) 的属性为 $(\\epsilon_2, \\mu_2)$。一个类型为 $(m,n)$ 的入射模式，具有单位振幅，从 $z=-\\infty$ 向界面传播。两个区域中的总横向场可以表示为所有可能模式的叠加。\n在区域 1 ($z0$) 中：\n$$ \\mathbf{E}_{t,1}(x,y,z) = \\mathbf{e}_{inc}(x,y)e^{-j\\beta_{inc,1}z} + \\sum_p R_p \\mathbf{e}_{p,1}(x,y)e^{+j\\beta_{p,1}z} $$\n$$ \\mathbf{H}_{t,1}(x,y,z) = \\frac{1}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc}e^{-j\\beta_{inc,1}z} - \\sum_p \\frac{R_p}{Z_{p,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{p,1}e^{+j\\beta_{p,1}z} $$\n在区域 2 ($z>0$) 中：\n$$ \\mathbf{E}_{t,2}(x,y,z) = \\sum_p T_p \\mathbf{e}_{p,2}(x,y)e^{-j\\beta_{p,2}z} $$\n$$ \\mathbf{H}_{t,2}(x,y,z) = \\sum_p \\frac{T_p}{Z_{p,2}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{p,2}e^{-j\\beta_{p,2}z} $$\n这里，$R_p$ 和 $T_p$ 是模式 $p$ 的反射和透射振幅。反射磁场项中的负号说明了功率向后流动。\n\n在界面 $z=0$ 处，切向场分量必须连续：\n1. $\\mathbf{E}_{t,1}(x,y,0) = \\mathbf{E}_{t,2}(x,y,0)$\n2. $\\mathbf{H}_{t,1}(x,y,0) = \\mathbf{H}_{t,2}(x,y,0)$\n\n由于波导横截面在两侧是相同的，所以区域 1 和区域 2 的横向模式本征函数 $\\mathbf{e}_p(x,y)$ 是相同的，即 $\\mathbf{e}_{p,1} = \\mathbf{e}_{p,2} = \\mathbf{e}_p$。这些函数在横截面上构成一个完备的正交集。\n在 $z=0$ 处 $\\mathbf{E}_t$ 的连续性给出：\n$$ (\\mathbf{e}_{inc} + R_{inc}\\mathbf{e}_{inc}) + \\sum_{p \\neq inc} R_p \\mathbf{e}_p = T_{inc}\\mathbf{e}_{inc} + \\sum_{p \\neq inc} T_p \\mathbf{e}_p $$\n通过将此方程投影到每个基函数 $\\mathbf{e}_q$ 上（即，取内积 $\\int_S (\\cdot) \\cdot \\mathbf{e}_q^* dA$）并利用正交性（$\\int_S \\mathbf{e}_p \\cdot \\mathbf{e}_q^* dA = N_p \\delta_{pq}$），我们独立地获得每个模式的方程：\n$$ (1+R_{inc})\\delta_{q,inc} + R_q(1-\\delta_{q,inc}) = T_q $$\n这意味着：\n对于入射模式 ($q=inc$)：$1 + R_{inc} = T_{inc}$。\n对于所有其他模式 ($q \\neq inc$)：$R_q = T_q$。\n\n在 $z=0$ 处 $\\mathbf{H}_t$ 的连续性给出：\n$$ \\left(\\frac{1}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc} - \\frac{R_{inc}}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc}\\right) - \\sum_{p \\neq inc} \\frac{R_p}{Z_{p,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_p = \\sum_p \\frac{T_p}{Z_{p,2}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_p $$\n再次援引正交性：\n对于入射模式 ($q=inc$)：$\\frac{1}{Z_{inc,1}}(1 - R_{inc}) = \\frac{T_{inc}}{Z_{inc,2}}$。\n对于所有其他模式 ($q \\neq inc$)：$-\\frac{R_q}{Z_{q,1}} = \\frac{T_q}{Z_{q,2}}$。\n将 $R_q = T_q$ 代入第二个方程得到 $T_q(-\\frac{1}{Z_{q,1}} - \\frac{1}{Z_{q,2}}) = 0$，这意味着对于所有 $q \\neq inc$，$T_q=R_q=0$。这证明了在均匀波导中的平面界面上不存在模式转换。入射模式只散射到相同类型的模式中。\n\n令 $R=R_{inc}$ 和 $T=T_{inc}$，并令该模式的阻抗为 $Z_1$ 和 $Z_2$。我们有一个由两个方程组成的方程组：\n$$ 1 + R = T $$\n$$ \\frac{1}{Z_1}(1 - R) = \\frac{T}{Z_2} $$\n求解该方程组得到反射和透射振幅：\n$$ R = \\frac{Z_2 - Z_1}{Z_2 + Z_1} $$\n$$ T = \\frac{2Z_2}{Z_2 + Z_1} $$\n\n模式所传输的时间平均功率与 $\\text{Re}(1/Z^*)$ 成正比。反射功率分数 $\\mathcal{R}$ 和透射功率分数 $\\mathcal{T}$ 由下式给出：\n$$ \\mathcal{R} = \\frac{P_{\\text{refl}}}{P_{\\text{inc}}} = |R|^2 = \\left| \\frac{Z_2 - Z_1}{Z_2 + Z_1} \\right|^2 $$\n$$ \\mathcal{T} = \\frac{P_{\\text{trans}}}{P_{\\text{inc}}} = |T|^2 \\frac{\\text{Re}(1/Z_2^*)}{\\text{Re}(1/Z_1^*)} $$\n\n如果透射模式是传播模式，$Z_1$ 和 $Z_2$ 均为实数。表达式简化为：\n$$ \\mathcal{R} = \\left(\\frac{Z_2 - Z_1}{Z_2 + Z_1}\\right)^2 $$\n$$ \\mathcal{T} = \\left(\\frac{2Z_2}{Z_2 + Z_1}\\right)^2 \\frac{1/Z_2}{1/Z_1} = \\frac{4 Z_2^2}{(Z_2 + Z_1)^2} \\frac{Z_1}{Z_2} = \\frac{4Z_1 Z_2}{(Z_1 + Z_2)^2} $$\n很容易验证 $\\mathcal{R} + \\mathcal{T} = 1$，满足能量守恒。\n\n如果区域 2 中的透射模式是倏逝的 ($k_2  k_{c}$)，其阻抗 $Z_2$ 是纯虚数。因此，$\\text{Re}(1/Z_2^*) = 0$，意味着没有净功率传输。因此，$\\mathcal{T} = 0$。对于反射系数，设 $Z_1$ 为实数，而 $Z_2 = jX$。则\n$$ \\mathcal{R} = |R|^2 = \\left| \\frac{jX - Z_1}{jX + Z_1} \\right|^2 = \\frac{|jX - Z_1|^2}{|jX + Z_1|^2} = \\frac{X^2 + (-Z_1)^2}{X^2 + Z_1^2} = 1 $$\n这表示全反射，正如当透射波非传播时能量守恒所预期的那样。\n\n因此，算法如下：\n1. 对于给定的模式 $(m,n)$，计算截止波数 $k_c$。\n2. 对于区域 1 和区域 2，计算介质波数 $k_i = \\omega \\sqrt{\\mu_i \\epsilon_i}$。\n3. 对于每个区域，确定模式是传播的 ($k_i > k_c$) 还是倏逝的 ($k_i  k_c$)。给定的入射模式是传播的。\n4. 计算模式阻抗 $Z_1$ 和 $Z_2$。\n5. 如果区域 2 中的模式是倏逝的，则 $\\mathcal{R}=1$ 且 $\\mathcal{T}=0$。\n6. 如果区域 2 中的模式是传播的，$Z_1$ 和 $Z_2$ 均为实数。使用推导出的实数阻抗公式计算 $\\mathcal{R}$ 和 $\\mathcal{T}$。",
            "answer": "```python\nimport numpy as np\n\n# Define physical constants using exact relations for precision.\nMU_0 = 4 * np.pi * 1e-7\nC_0 = 299792458.0\nEPSILON_0 = 1 / (MU_0 * C_0**2)\n\ndef calculate_mode_properties(a, b, epsilon, mu, omega, m, n, mode_type):\n    \"\"\"\n    Calculates the modal impedance and propagation status for a given mode.\n\n    Args:\n        a (float): Waveguide width (x-dimension).\n        b (float): Waveguide height (y-dimension).\n        epsilon (float): Permittivity of the medium.\n        mu (float): Permeability of the medium.\n        omega (float): Angular frequency.\n        m (int): Mode index for x-dimension.\n        n (int): Mode index for y-dimension.\n        mode_type (str): 'TE' or 'TM'.\n\n    Returns:\n        tuple: (impedance, is_propagating)\n               impedance (complex): The modal characteristic impedance.\n               is_propagating (bool): True if the mode is propagating, False if evanescent.\n    \"\"\"\n    if (mode_type == 'TM' and (m == 0 or n == 0)) or \\\n       (mode_type == 'TE' and m == 0 and n == 0):\n        raise ValueError(f\"Invalid mode indices ({m},{n}) for {mode_type} mode.\")\n\n    k_c_sq = (m * np.pi / a)**2 + (n * np.pi / b)**2\n    k_sq = omega**2 * mu * epsilon\n\n    if k_sq > k_c_sq:\n        # Propagating mode\n        is_propagating = True\n        beta = np.sqrt(k_sq - k_c_sq)\n        if mode_type == 'TE':\n            impedance = (omega * mu) / beta\n        else:  # TM\n            impedance = beta / (omega * epsilon)\n    else:\n        # Evanescent mode\n        is_propagating = False\n        alpha = np.sqrt(k_c_sq - k_sq)\n        if mode_type == 'TE':\n            # Z_TE = omega*mu / (-j*alpha) = j * (omega*mu/alpha)\n            impedance = 1j * (omega * mu) / alpha\n        else:  # TM\n            # Z_TM = (-j*alpha) / (omega*epsilon)\n            impedance = -1j * alpha / (omega * epsilon)\n\n    return impedance, is_propagating\n\ndef solve():\n    \"\"\"\n    Solves the reflection and transmission problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 1.0, 'eps_r2': 2.25, \n         'f': 10e9, 'mode_type': 'TE', 'm': 1, 'n': 0},\n        # Test case 2\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 2.25, 'eps_r2': 1.0, \n         'f': 5.5e9, 'mode_type': 'TE', 'm': 1, 'n': 0},\n        # Test case 3\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 1.0, 'eps_r2': 1.0, \n         'f': 14e9, 'mode_type': 'TE', 'm': 2, 'n': 0},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        a, b = case['a'], case['b']\n        eps1, eps2 = case['eps_r1'] * EPSILON_0, case['eps_r2'] * EPSILON_0\n        mu1, mu2 = MU_0, MU_0  # As per problem statement mu_1=mu_2=mu_0\n        omega = 2 * np.pi * case['f']\n        mode_type, m, n = case['mode_type'], case['m'], case['n']\n\n        # Calculate properties for Region 1 (z0)\n        Z1, is_prop_1 = calculate_mode_properties(a, b, eps1, mu1, omega, m, n, mode_type)\n        \n        # Calculate properties for Region 2 (z>0)\n        Z2, is_prop_2 = calculate_mode_properties(a, b, eps2, mu2, omega, m, n, mode_type)\n\n        # Incident mode must be propagating\n        if not is_prop_1:\n            raise ValueError(\"Incident mode is evanescent, which contradicts the problem setup.\")\n\n        if not is_prop_2:\n            # Total reflection as transmitted mode is evanescent\n            R_power = 1.0\n            T_power = 0.0\n        else:\n            # Both modes are propagating, impedances are real.\n            Z1_real = np.real(Z1)\n            Z2_real = np.real(Z2)\n            \n            # Reflection power fraction\n            R_power = ((Z2_real - Z1_real) / (Z2_real + Z1_real))**2\n            \n            # Transmission power fraction from energy conservation\n            T_power = 1.0 - R_power\n\n        results.extend([R_power, T_power])\n\n    # Format the output as specified\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "尽管解析方法对于标准几何形状非常有效，但面对任意横截面或非均匀填充的复杂波导，它们便显得力不从心。本练习  引入了一种强大的数值技术——基于变分原理的瑞利-里兹法。通过将求解波动方程的边值问题转化为寻找瑞利商泛函的驻点，该方法能够近似计算出复杂结构中的模式截止频率。完成这项计算实践，将为你打开计算电磁学的大门，并为理解如有限元法（FEM）等更高级数值方法的思想精髓打下坚实基础。",
            "id": "3360822",
            "problem": "考虑一个无限长、笔直、均匀的波导的二维横截面，其壁是完美电导体。令横截面区域表示为 $\\Omega \\subset \\mathbb{R}^2$，其边界为 $\\partial \\Omega$。波导内部的材料是线性的、各向同性的，并且可能是不均匀的，具有空间变化的介电常数 $\\epsilon(x,y) > 0$ 和恒定的磁导率 $\\mu > 0$。假设时谐场具有角频率 $\\omega$，遵循 $e^{-j\\omega t}$ 约定下的麦克斯韦方程组。目标是推导并利用变分原理，使用 Rayleigh–Ritz 方法来近似横磁模式的波导截止频率。\n\n从无源麦克斯韦旋度方程和在 $\\partial \\Omega$ 上施加切向电场为零的完美电导体边界条件出发，通过证明泛函\n$$\n\\mathcal{R}(\\mathbf{E}) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\mathbf{E} \\right\\rvert^2 \\, dA}\n$$\n在一个容许函数空间上的驻值对应于旋度-旋度算子的特征值，来推导波导本征模式的截止角频率 $\\omega_c$ 的变分表征。并将此特化为横磁情况，其中 $\\mathbf{E}(x,y) = \\hat{\\mathbf{z}}\\, E_z(x,y)$ 且 $E_z(x,y)$ 在 $\\partial \\Omega$ 上为零。证明在这种特化下，变分问题简化为标量 Rayleigh 商\n$$\n\\mathcal{R}(E_z) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla E_z \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert E_z \\right\\rvert^2 \\, dA}\n$$\n其驻值给出 $\\omega_c^2$，且其最小化函数满足带狄利克雷边界条件的标量特征值问题。\n\n在矩形域 $\\Omega = [0,a] \\times [0,b]$ 上，通过使用由一组满足狄利克雷边界条件的基函数（例如，对于整数 $m,n \\geq 1$，$\\phi_{mn}(x,y) = \\sin\\!\\big(\\frac{m\\pi x}{a}\\big)\\sin\\!\\big(\\frac{n\\pi y}{b}\\big)$）张成的有限维子空间，实现 Rayleigh–Ritz 方法来近似横磁谱的最小截止角频率。构建广义特征值问题\n$$\n\\mathbf{A}\\mathbf{c} \\;=\\; \\omega^2 \\,\\mathbf{B}\\mathbf{c},\n$$\n其中\n$$\nA_{ij} \\;=\\; \\int_{\\Omega} \\mu^{-1} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, dA, \\qquad\nB_{ij} \\;=\\; \\int_{\\Omega} \\epsilon \\, \\phi_i \\phi_j \\, dA,\n$$\n并确定最小的特征值 $\\omega_c^2$ 以获得以赫兹 (Hz) 为单位的截止频率 $f_c = \\omega_c / (2\\pi)$。对于空间恒定的介电常数和磁导率，这些积分有闭合形式解；对于空间变化的介电常数 $\\epsilon(x,y)$，使用中点采样在矩形网格上通过均匀张量积求积来近似积分。\n\n使用以下参数值测试套件计算每种情况下最低的横磁截止频率 $f_c$。所有频率必须以赫兹 (Hz) 表示，并四舍五入到六位有效数字。对于每种情况，使用由指定的 $\\phi_{mn}$（其中 $1 \\leq m \\leq M$ 和 $1 \\leq n \\leq N$）张成的 Rayleigh–Ritz 子空间。\n\n- 情况1（均匀真空矩形波导）：$a = 0.02286\\,\\text{m}$，$b = 0.01016\\,\\text{m}$，$\\epsilon_r = 1.0$，$\\mu_r = 1.0$，$M = 3$，$N = 3$。\n- 情况2（均匀介质填充矩形波导）：$a = 0.02286\\,\\text{m}$，$b = 0.01016\\,\\text{m}$，$\\epsilon_r = 2.25$，$\\mu_r = 1.0$，$M = 3$，$N = 3$。\n- 情况3（均匀真空方形波导）：$a = 0.030\\,\\text{m}$，$b = 0.030\\,\\text{m}$，$\\epsilon_r = 1.0$，$\\mu_r = 1.0$，$M = 4$，$N = 4$。\n- 情况4（均匀真空，窄高度）：$a = 0.020\\,\\text{m}$，$b = 0.0020\\,\\text{m}$，$\\epsilon_r = 1.0$，$\\mu_r = 1.0$，$M = 3$，$N = 3$。\n- 情况5（带中心圆形夹杂物的不均匀真空背景）：$a = 0.040\\,\\text{m}$，$b = 0.040\\,\\text{m}$，背景 $\\epsilon_r = 1.0$，带一个半径为 $r = 0.010\\,\\text{m}$ 的中心圆形夹杂物，夹杂物介电常数 $\\epsilon_r = 2.25$，$\\mu_r = 1.0$，$M = 4$，$N = 4$。对不均匀积分在均匀的 $201 \\times 201$ 网格上使用中点求积。\n\n您的程序必须计算每种情况下以赫兹为单位的最低截止频率 $f_c$，并四舍五入到六位有效数字。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，`[result1,result2,result3,result4,result5]`）。",
            "solution": "问题要求推导和应用一种变分方法，特别是 Rayleigh-Ritz 方法，来计算均匀波导中横磁 (TM) 模式的截止频率。\n\n### 变分原理推导\n\n我们从时谐、无源的麦克斯韦旋度方程开始，假设时谐因子为 $e^{-j\\omega t}$：\n$$\n\\nabla \\times \\mathbf{E} \\;=\\; j\\omega\\mu\\mathbf{H} \\quad (1)\n$$\n$$\n\\nabla \\times \\mathbf{H} \\;=\\; -j\\omega\\epsilon\\mathbf{E} \\quad (2)\n$$\n在这里，$\\mathbf{E}$ 是电场相量，$\\mathbf{H}$ 是磁场相量，$\\omega$ 是角频率，$\\mu$ 是磁导率（恒定），$\\epsilon(x,y)$ 是介电常数（可能随空间变化）。\n\n为了推导电场的波动方程，我们对(1)式取旋度，乘以 $\\mu^{-1}$，然后代入(2)式：\n$$\n\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) \\;=\\; j\\omega \\nabla \\times \\mathbf{H} \\;=\\; j\\omega(-j\\omega\\epsilon\\mathbf{E})\n$$\n这就得到了 $\\mathbf{E}$ 的矢量波动方程：\n$$\n\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) - \\omega^2 \\epsilon \\mathbf{E} \\;=\\; 0 \\quad (3)\n$$\n这是一个特征值问题，其中算子为 $\\mathbf{L} = \\epsilon^{-1}\\nabla \\times (\\mu^{-1} \\nabla \\times \\cdot)$，特征值为 $\\omega^2$。场必须满足完美电导体 (PEC) 的边界条件，即电场的切向分量在边界 $\\partial\\Omega$ 上为零：$\\hat{\\mathbf{n}} \\times \\mathbf{E}|_{\\partial\\Omega} = \\mathbf{0}$，其中 $\\hat{\\mathbf{n}}$ 是边界上的外法向矢量。\n\n现在，考虑 Rayleigh 商泛函 $\\mathcal{R}(\\mathbf{E})$：\n$$\n\\mathcal{R}(\\mathbf{E}) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\mathbf{E} \\right\\rvert^2 \\, dA}\n$$\n该泛函的驻点对应于(3)式中特征值问题的解。为了证明这一点，我们通过考虑一个试探函数 $\\mathbf{E} + \\delta \\mathbf{F}$ 来求 $\\mathcal{R}$ 的一阶变分，其中 $\\delta$ 是一个小参数，$\\mathbf{F}$ 是一个满足与 $\\mathbf{E}$ 相同边界条件的任意但可容许的测试函数。将一阶变分 $\\delta\\mathcal{R}$ 置为零，即可得到该泛函的欧拉-拉格朗日方程。变分法中的一个著名结果是，形式为 $\\frac{\\langle \\mathbf{L_A}u, u \\rangle}{\\langle \\mathbf{L_B}u, u \\rangle}$ 的 Rayleigh 商的驻值条件会产生广义特征值问题 $\\mathbf{L_A}u = \\lambda \\mathbf{L_B}u$。在我们的例子中，这个过程正好得到(3)式，其中 $\\omega^2 = \\mathcal{R}(\\mathbf{E})$，从而证实了该泛函的驻值就是截止角频率的平方。\n\n### 特化为横磁 (TM) 模式\n\n对于 TM 模式，磁场完全横向于传播方向（$z$ 轴），意味着 $H_z = 0$。在截止频率处，模式停止传播，场变得与 $z$ 无关。TM 模式的电场形式为 $\\mathbf{E}(x,y) = \\hat{\\mathbf{z}}\\, E_z(x,y)$。PEC 边界条件 $\\mathbf{E}_{tan}|_{\\partial\\Omega} = \\mathbf{0}$ 直接意味着 $E_z$ 必须在边界上为零：$E_z|_{\\partial\\Omega} = 0$。\n\n我们现在将矢量泛函 $\\mathcal{R}(\\mathbf{E})$ 特化为这种形式的 $\\mathbf{E}$：\n$\\mathbf{E}$ 的旋度为：\n$$\n\\nabla \\times \\mathbf{E} \\;=\\; \\nabla \\times (\\hat{\\mathbf{z}} E_z(x,y)) \\;=\\; \\frac{\\partial E_z}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial E_z}{\\partial x}\\hat{\\mathbf{y}} \\;=\\; \\nabla E_z \\times \\hat{\\mathbf{z}}\n$$\n旋度的平方模为：\n$$\n\\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\;=\\; \\left(\\frac{\\partial E_z}{\\partial x}\\right)^2 + \\left(\\frac{\\partial E_z}{\\partial y}\\right)^2 \\;=\\; \\left\\lvert \\nabla E_z \\right\\rvert^2\n$$\n电场的平方模为：\n$$\n\\left\\lvert \\mathbf{E} \\right\\rvert^2 \\;=\\; \\left\\lvert \\hat{\\mathbf{z}} E_z \\right\\rvert^2 \\;=\\; \\left\\lvert E_z \\right\\rvert^2\n$$\n将这些表达式代入矢量 Rayleigh 商，得到 $E_z$ 的标量 Rayleigh 商：\n$$\n\\mathcal{R}(E_z) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla E_z \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert E_z \\right\\rvert^2 \\, dA}\n$$\n该泛函的驻值是截止角频率的平方 $\\omega_c^2$。使该商最小化的函数 $E_z$ 是基态本征函数，对应于最低的截止频率。这个最小化函数满足欧拉-拉格朗日方程，即标量椭圆特征值问题 $\\nabla \\cdot (\\mu^{-1} \\nabla E_z) + \\omega^2 \\epsilon E_z = 0$，并带有狄利克雷边界条件 $E_z|_{\\partial\\Omega} = 0$。\n\n### Rayleigh–Ritz 方法实现\n\nRayleigh-Ritz 方法通过基函数 $\\phi_j(x,y)$ 的有限线性组合来近似解 $E_z$：\n$$\nE_z(x,y) \\approx \\sum_{j=1}^{K} c_j \\phi_j(x,y)\n$$\n其中 $c_j$ 是未知系数。基函数必须选择满足狄利克雷边界条件 $\\phi_j|_{\\partial\\Omega} = 0$。对于矩形域 $\\Omega = [0,a] \\times [0,b]$，函数 $\\phi_{mn}(x,y) = \\sin(\\frac{m\\pi x}{a})\\sin(\\frac{n\\pi y}{b})$（其中整数 $m,n \\ge 1$）构成一个合适的基。我们使用由单个索引 $j=1, \\dots, K$ 索引的这组函数，其中每个 $j$ 对应一对 $(m,n)$，满足 $1 \\le m \\le M$ 和 $1 \\le n \\le N$。\n\n将 $E_z$ 的展开式代入标量 Rayleigh 商中，得到：\n$$\n\\omega^2 \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\sum_{i} c_i \\nabla\\phi_i \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\sum_{j} c_j \\phi_j \\right\\rvert^2 \\, dA} \\;=\\; \\frac{\\sum_{i,j} c_i c_j \\int_{\\Omega} \\mu^{-1} (\\nabla\\phi_i \\cdot \\nabla\\phi_j) \\, dA}{\\sum_{i,j} c_i c_j \\int_{\\Omega} \\epsilon (\\phi_i \\phi_j) \\, dA}\n$$\n这可以写成矩阵形式：\n$$\n\\omega^2 \\;=\\; \\frac{\\mathbf{c}^T \\mathbf{A} \\mathbf{c}}{\\mathbf{c}^T \\mathbf{B} \\mathbf{c}}\n$$\n其中 $\\mathbf{c}$ 是系数向量 $[c_1, \\dots, c_K]^T$，矩阵 $\\mathbf{A}$ 和 $\\mathbf{B}$ 的元素为：\n$$\nA_{ij} \\;=\\; \\int_{\\Omega} \\mu^{-1} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, dA, \\qquad\nB_{ij} \\;=\\; \\int_{\\Omega} \\epsilon \\, \\phi_i \\phi_j \\, dA\n$$\n为了找到该表达式的驻值，我们对每个系数 $c_k$ 求导，并将结果设为零。这个过程会导出广义特征值问题：\n$$\n\\mathbf{A}\\mathbf{c} \\;=\\; \\omega^2 \\mathbf{B}\\mathbf{c}\n$$\n该系统的特征值 $\\omega^2$ 是截止角频率平方的 Ritz 近似值。最小的特征值对应于最小的截止频率。\n\n#### 矩阵元素计算\n\n**均匀情况（情况 1、2、3、4）：**\n对于恒定的 $\\epsilon = \\epsilon_r\\epsilon_0$ 和 $\\mu = \\mu_r\\mu_0$， $A_{ij}$ 和 $B_{ij}$ 的积分可以解析求解。令 $\\phi_i = \\sin(\\frac{m_i\\pi x}{a})\\sin(\\frac{n_i\\pi y}{b})$ 和 $\\phi_j = \\sin(\\frac{m_j\\pi x}{a})\\sin(\\frac{n_j\\pi y}{b})$。由于正弦和余弦函数在区间上的正交性，矩阵 $\\mathbf{A}$ 和 $\\mathbf{B}$ 变为对角矩阵。仅当 $i=j$（即 $m_i=m_j$ 和 $n_i=n_j$）时才会出现非零元素。对角元素为：\n$$\nA_{ii} \\;=\\; \\mu^{-1} \\frac{ab}{4} \\left[ \\left(\\frac{m_i\\pi}{a}\\right)^2 + \\left(\\frac{n_i\\pi}{b}\\right)^2 \\right]\n$$\n$$\nB_{ii} \\;=\\; \\epsilon \\frac{ab}{4}\n$$\n特征值就是比值 $A_{ii}/B_{ii}$，这给出了已知的精确解析结果：\n$$\n\\omega_{m_i,n_i}^2 = \\frac{1}{\\mu\\epsilon} \\left[ \\left(\\frac{m_i\\pi}{a}\\right)^2 + \\left(\\frac{n_i\\pi}{b}\\right)^2 \\right]\n$$\n最低截止角频率 $\\omega_c$ 对应于这些值的最小值，它在 $(m,n)=(1,1)$ 时出现。因此，$f_c = \\frac{\\omega_{1,1}}{2\\pi} = \\frac{1}{2\\sqrt{\\mu\\epsilon}}\\sqrt{(\\frac{1}{a})^2 + (\\frac{1}{b})^2}$。\n\n**不均匀情况（情况 5）：**\n对于空间变化的 $\\epsilon(x,y)$，矩阵 $\\mathbf{A}$ 和 $\\mathbf{B}$ 通常不是对角矩阵，积分必须进行数值计算。按照规定，我们使用带中点采样的均匀张量积网格。积分通过在网格点 $(x_k, y_l)$ 上的求和来近似：\n$$\nA_{ij} \\approx \\mu^{-1} \\sum_{k,l} (\\nabla \\phi_i \\cdot \\nabla \\phi_j)|_{(x_k,y_l)} \\Delta x \\Delta y\n$$\n$$\nB_{ij} \\approx \\sum_{k,l} \\epsilon(x_k,y_l) (\\phi_i \\phi_j)|_{(x_k,y_l)} \\Delta x \\Delta y\n$$\n其中 $\\Delta x=a/N_{grid_x}$ 和 $\\Delta y=b/N_{grid_y}$ 是网格间距。然后将这些稠密的对称矩阵用于数值广义特征值求解器中，以找到特征值 $\\omega^2$。最小的特征值给出了 $\\omega_c^2$ 的近似值，由此可以计算出最低截止频率 $f_c = \\sqrt{\\omega_c^2}/(2\\pi)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom scipy.constants import c, epsilon_0, mu_0\n\ndef solve():\n    \"\"\"\n    Main function to compute and print waveguide cutoff frequencies for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (homogeneous vacuum rectangular waveguide)\n        {'a': 0.02286, 'b': 0.01016, 'er': 1.0, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 2 (homogeneous dielectric-filled rectangular waveguide)\n        {'a': 0.02286, 'b': 0.01016, 'er': 2.25, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 3 (homogeneous vacuum square waveguide)\n        {'a': 0.030, 'b': 0.030, 'er': 1.0, 'mur': 1.0, 'M': 4, 'N': 4},\n        # Case 4 (homogeneous vacuum, narrow height)\n        {'a': 0.020, 'b': 0.0020, 'er': 1.0, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 5 (inhomogeneous)\n        {'a': 0.040, 'b': 0.040, 'er': {'bg': 1.0, 'inc': 2.25, 'r': 0.010}, 'mur': 1.0, 'M': 4, 'N': 4, 'grid': 201},\n    ]\n\n    results = []\n    for case in test_cases:\n        if isinstance(case['er'], (int, float)):\n            fc = compute_homogeneous_fc(case)\n        else:\n            fc = compute_inhomogeneous_fc(case)\n        results.append(f\"{fc:.6g}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_homogeneous_fc(params):\n    \"\"\"\n    Computes the lowest TM cutoff frequency for a homogeneous rectangular waveguide.\n    The Rayleigh-Ritz method with the chosen basis functions yields the exact analytical\n    result, so the generalized eigenvalue problem is diagonal. The lowest eigenvalue\n    corresponds to the TM11 mode.\n    \"\"\"\n    a, b, er, mur = params['a'], params['b'], params['er'], params['mur']\n    \n    # Speed of light in the medium\n    v = c / np.sqrt(er * mur)\n    \n    # Lowest TM mode is TM11\n    m, n = 1, 1\n    \n    # Cutoff frequency formula\n    fc = (v / 2.0) * np.sqrt((m / a)**2 + (n / b)**2)\n    \n    return fc\n\ndef compute_inhomogeneous_fc(params):\n    \"\"\"\n    Computes the lowest TM cutoff frequency for an inhomogeneous rectangular waveguide\n    using the Rayleigh-Ritz method with numerical quadrature.\n    \"\"\"\n    a, b, mur, M, N = params['a'], params['b'], params['mur'], params['M'], params['N']\n    er_params = params['er']\n    grid_res = params['grid']\n    \n    mu = mur * mu_0\n    basis_size = M * N\n    \n    # Create grid for numerical integration (midpoint rule)\n    nx, ny = grid_res, grid_res\n    dx = a / nx\n    dy = b / ny\n    x_pts = (np.arange(nx) + 0.5) * dx\n    y_pts = (np.arange(ny) + 0.5) * dy\n\n    # Matrix construction\n    A = np.zeros((basis_size, basis_size))\n    B = np.zeros((basis_size, basis_size))\n\n    # Single-index to (m, n) mapping\n    m_indices = np.array([(i // N) + 1 for i in range(basis_size)])\n    n_indices = np.array([(i % N) + 1 for i in range(basis_size)])\n\n    # Permittivity function over the grid\n    X, Y = np.meshgrid(x_pts, y_pts)\n    is_inclusion = ((X - a / 2)**2 + (Y - b / 2)**2) = er_params['r']**2\n    eps_grid = np.full_like(X, er_params['bg'] * epsilon_0)\n    eps_grid[is_inclusion] = er_params['inc'] * epsilon_0\n\n    # Basis function args\n    mx_a = m_indices[:, np.newaxis, np.newaxis] * np.pi * x_pts[np.newaxis, np.newaxis, :] / a\n    ny_b = n_indices[:, np.newaxis, np.newaxis] * np.pi * y_pts[np.newaxis, :, np.newaxis] / b\n    \n    # Precompute sin and cos values on the grid for all basis functions\n    sin_mx = np.sin(mx_a)\n    cos_mx = np.cos(mx_a)\n    sin_ny = np.sin(ny_b)\n    cos_ny = np.cos(ny_b)\n    \n    # Iterate over grid points to build matrices A and B\n    for k in range(nx):\n        for l in range(ny):\n            # Values of basis functions and their gradients at (x_k, y_l)\n            # phi_i = sin(m_i*pi*x/a) * sin(n_i*pi*y/b)\n            phi_vals = sin_mx[:, 0, k] * sin_ny[:, l, 0]\n            \n            # grad_phi_i = [ m_i*pi/a * cos(...)sin(...), n_i*pi/b * sin(...)cos(...) ]\n            grad_x = (m_indices * np.pi / a) * cos_mx[:, 0, k] * sin_ny[:, l, 0]\n            grad_y = (n_indices * np.pi / b) * sin_mx[:, 0, k] * cos_ny[:, l, 0]\n            \n            # Update A and B using outer products for efficiency\n            grad_dot_prod_matrix = np.outer(grad_x, grad_x) + np.outer(grad_y, grad_y)\n            phi_prod_matrix = np.outer(phi_vals, phi_vals)\n            \n            A += grad_dot_prod_matrix\n            B += eps_grid[l, k] * phi_prod_matrix\n            \n    # Final scaling of matrices with constants and area element\n    area_element = dx * dy\n    A *= (1 / mu) * area_element\n    B *= area_element\n    \n    # Solve the generalized eigenvalue problem A*c = omega^2 * B*c\n    # eigh returns sorted eigenvalues\n    eigenvalues_sq, _ = eigh(A, B)\n    \n    # Smallest eigenvalue is omega_c^2\n    omega_c_sq = eigenvalues_sq[0]\n    \n    # Check for non-physical results\n    if omega_c_sq  0:\n        # If numerically unstable, take abs, as omega^2 must be positive\n        omega_c = np.sqrt(np.abs(omega_c_sq))\n    else:\n        omega_c = np.sqrt(omega_c_sq)\n        \n    fc = omega_c / (2 * np.pi)\n    \n    return fc\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}