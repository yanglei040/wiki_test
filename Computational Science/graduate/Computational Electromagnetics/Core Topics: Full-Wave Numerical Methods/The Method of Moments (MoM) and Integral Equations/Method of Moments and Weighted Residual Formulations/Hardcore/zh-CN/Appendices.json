{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在阐明两种基本加权余量法——配置法和伽辽金法之间的核心差异。通过将这两种方法应用于一个具有已知格林函数的简单一维积分方程，您将获得构建离散矩阵系统并分析比较其数值稳定性的实践经验。这项练习对于深入理解矩量法实现中所涉及的选择与权衡至关重要。",
            "id": "3330345",
            "problem": "考虑单位区间上的标量第二类 Fredholm 积分方程，\n$$\nu(x) - \\lambda \\int_{0}^{1} G(x,s)\\,u(s)\\,\\mathrm{d}s \\;=\\; g(x), \\quad x \\in (0,1),\n$$\n其中 $G(x,s)$ 是 $(0,1)$ 上拉普拉斯算子的一维狄利克雷问题的格林核，即，\n$$\nG(x,s) \\;=\\; \\min\\{x,s\\} \\,-\\, x\\,s.\n$$\n该核函数在静电学中是接地线段上单位源产生的电势，也是采用加权残差公式的矩量法 (Method of Moments, MoM) 处理的一个标准起点。设近似空间为 $N$ 个正弦基函数张成的空间，\n$$\n\\phi_{n}(x) \\;=\\; \\sin(n \\pi x), \\quad n = 1,2,\\dots,N.\n$$\n定义线性算子\n$$\nL(u)(x) \\;=\\; u(x) \\,-\\, \\lambda \\int_{0}^{1} G(x,s)\\,u(s)\\,\\mathrm{d}s.\n$$\n\na) 从 $G(x,s)$ 的定义和一维狄利克雷拉普拉斯算子的本征结构出发，推导积分算子 $\\displaystyle T u(x) = \\int_{0}^{1}G(x,s)\\,u(s)\\,\\mathrm{d}s$ 在正弦基上的作用，并证明存在实数 $\\alpha_{n}$ 使得\n$$\n\\int_{0}^{1} G(x,s)\\,\\sin(n \\pi s)\\,\\mathrm{d}s \\;=\\; \\alpha_{n}\\,\\sin(n \\pi x),\n$$\n并确定 $\\alpha_{n}$ 的显式闭合形式。\n\nb) 通过强制施加\n$$\nL(u_{N})(x_{i}) \\;=\\; g(x_{i}), \\quad x_{i} \\;=\\; \\frac{i}{N+1}, \\quad i = 1,2,\\dots,N,\n$$\n来为矩量法近似 $u_{N}(x) = \\sum_{n=1}^{N} a_{n}\\,\\sin(n \\pi x)$ 构建配置加权残差法。证明得到的线性系统可以写成矩阵形式\n$$\nA_{\\mathrm{col}}\\,\\mathbf{a} \\;=\\; \\mathbf{g}_{\\mathrm{nodes}}, \\quad A_{\\mathrm{col}} \\;=\\; S\\,D,\n$$\n其中 $S \\in \\mathbb{R}^{N \\times N}$ 的元素为 $S_{i n} = \\sin(n \\pi x_{i})$，$D \\in \\mathbb{R}^{N \\times N}$ 是对角矩阵，其元素为 $D_{n n} = 1 - \\lambda \\alpha_{n}$，$\\mathbf{g}_{\\mathrm{nodes}} \\in \\mathbb{R}^{N}$ 的元素为 $g(x_{i})$。\n\nc) 使用相同的正弦函数作为测试函数，构建伽辽金 (Galerkin) 加权残差法，并证明得到的线性系统可以写成\n$$\nA_{\\mathrm{gal}}\\,\\mathbf{a} \\;=\\; \\mathbf{b}, \\quad A_{\\mathrm{gal}} \\;=\\; \\frac{1}{2}\\,D,\n$$\n其中 $\\mathbf{b} \\in \\mathbb{R}^{N}$ 的元素为 $b_{m} = \\int_{0}^{1} \\sin(m \\pi x)\\,g(x)\\,\\mathrm{d}x$。\n\nd) 采用二范数下的谱条件数 $\\kappa_{2}(A) = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$ 作为稳健性的一个代理指标。利用 (b) 和 (c) 部分建立的代数结构，以及在配置点上正弦基所需的任何离散正交性，计算比率的精确值\n$$\n\\frac{\\kappa_{2}\\!\\left(A_{\\mathrm{col}}\\right)}{\\kappa_{2}\\!\\left(A_{\\mathrm{gal}}\\right)}.\n$$\n将最终答案表示为一个实数。不需要单位。不需要四舍五入。",
            "solution": "用户提供了一个关于矩量法 (MoM)应用于第二类 Fredholm 积分方程的多部分问题。该问题需要被验证，如果有效，则进行求解。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   积分方程：$u(x) - \\lambda \\int_{0}^{1} G(x,s)\\,u(s)\\,\\mathrm{d}s = g(x)$，对于 $x \\in (0,1)$。\n-   核函数：$G(x,s) = \\min\\{x,s\\} - xs$。\n-   基函数：$\\phi_{n}(x) = \\sin(n \\pi x)$，对于 $n = 1, 2, \\dots, N$。\n-   线性算子：$L(u)(x) = u(x) - \\lambda \\int_{0}^{1} G(x,s)\\,u(s)\\,\\mathrm{d}s$。\n-   (a) 部分任务：证明 $\\int_{0}^{1} G(x,s)\\,\\sin(n \\pi s)\\,\\mathrm{d}s = \\alpha_{n}\\,\\sin(n \\pi x)$ 并确定 $\\alpha_{n}$。\n-   (b) 部分任务 (配置法)：使用 $u_{N}(x) = \\sum_{n=1}^{N} a_{n}\\,\\sin(n \\pi x)$ 和在配置点 $x_{i} = \\frac{i}{N+1}$（其中 $i = 1, \\dots, N$）处的条件 $L(u_{N})(x_{i}) = g(x_{i})$。证明得到的系统为 $A_{\\mathrm{col}}\\,\\mathbf{a} = \\mathbf{g}_{\\mathrm{nodes}}$，其中 $A_{\\mathrm{col}} = S D$，$S_{in} = \\sin(n \\pi x_{i})$ 且 $D$ 为对角矩阵，其对角元素为 $D_{nn} = 1 - \\lambda \\alpha_{n}$。\n-   (c) 部分任务 (Galerkin法)：使用测试函数 $\\psi_{m}(x) = \\sin(m \\pi x)$。证明得到的系统为 $A_{\\mathrm{gal}}\\,\\mathbf{a} = \\mathbf{b}$，其中 $A_{\\mathrm{gal}} = \\frac{1}{2} D$。\n-   (d) 部分任务：计算谱条件数之比 $\\frac{\\kappa_{2}(A_{\\mathrm{col}})}{\\kappa_{2}(A_{\\mathrm{gal}})}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题是积分方程数值分析中的一个标准练习，这是计算科学与工程（特别是在电磁学中）的核心课题。一维狄利克雷拉普拉斯算子的格林函数被正确指定。使用本征函数（正弦函数）作为基是一种成熟的技术（谱方法）。该问题在科学上和数学上是合理的。\n-   **适定性**：该问题被构造成一系列逻辑步骤。每个部分都定义清晰，并建立在前面部分的基础上。所有必要的定义（基函数、配置点等）都已提供。该问题是适定的。\n-   **客观性**：语言是形式化和数学化的，没有任何主观或模棱两可的陈述。\n\n**步骤 3：结论与行动**\n该问题是有效的。它是一个在数值分析领域中表述清晰、自成体系的问题。可以继续求解过程。\n\n### 解答\n\n**a) 积分算子在正弦基上的作用**\n\n设 $T$ 为积分算子 $T u(x) = \\int_{0}^{1} G(x,s) u(s) \\mathrm{d}s$。我们需要计算 $T(\\sin(n \\pi s))(x)$。核函数 $G(x,s)$ 是在 $(0,1)$ 上带有狄利克雷边界条件 $u(0)=u(1)=0$ 的算子 $-\\frac{d^2}{dx^2}$ 的格林函数。函数 $\\phi_n(x) = \\sin(n \\pi x)$ 是这个微分算子的本征函数：\n$$\n-\\frac{d^2}{dx^2} \\sin(n \\pi x) = (n \\pi)^2 \\sin(n \\pi x).\n$$\n积分算子 $T$ 是微分算子 $-\\frac{d^2}{dx^2}$ 的逆算子。因此，$T$ 的本征函数必须与 $-\\frac{d^2}{dx^2}$ 的本征函数相同，而本征值必须是倒数关系。所以，\n$$\nT(\\sin(n \\pi s))(x) = \\int_{0}^{1} G(x,s)\\,\\sin(n \\pi s)\\,\\mathrm{d}s = \\frac{1}{(n \\pi)^2} \\sin(n \\pi x).\n$$\n这就证明了函数 $\\sin(n\\pi x)$ 确实是该积分算子的本征函数，其本征值为 $\\alpha_n$。$\\alpha_n$ 的显式形式是：\n$$\n\\alpha_n = \\frac{1}{(n \\pi)^2}.\n$$\n我们可以通过直接积分来验证这个结果。\n$$\n\\int_{0}^{1} G(x,s)\\,\\sin(n \\pi s)\\,\\mathrm{d}s = \\int_{0}^{1} (\\min\\{x,s\\} - xs)\\,\\sin(n \\pi s)\\,\\mathrm{d}s\n$$\n$$\n= \\int_{0}^{x} (s - xs)\\,\\sin(n \\pi s)\\,\\mathrm{d}s + \\int_{x}^{1} (x - xs)\\,\\sin(n \\pi s)\\,\\mathrm{d}s\n$$\n$$\n= (1-x) \\int_{0}^{x} s\\,\\sin(n \\pi s)\\,\\mathrm{d}s + x \\int_{x}^{1} (1-s)\\,\\sin(n \\pi s)\\,\\mathrm{d}s.\n$$\n使用分部积分法，我们找到原函数：\n$$\n\\int s\\,\\sin(k s)\\,\\mathrm{d}s = -\\frac{s}{k}\\cos(k s) + \\frac{1}{k^2}\\sin(k s)\n$$\n$$\n\\int (1-s)\\,\\sin(k s)\\,\\mathrm{d}s = \\frac{s-1}{k}\\cos(k s) - \\frac{1}{k^2}\\sin(k s)\n$$\n令 $k=n\\pi$ 并计算定积分，证实了之前从算子理论推导出的结果 $\\frac{1}{(n \\pi)^2} \\sin(n \\pi x)$。\n\n**b) 配置法公式**\n\n$u(x)$ 的近似为 $u_N(x) = \\sum_{n=1}^N a_n \\phi_n(x) = \\sum_{n=1}^N a_n \\sin(n\\pi x)$。将算子 $L$ 应用于 $u_N(x)$：\n$$\nL(u_N)(x) = u_N(x) - \\lambda \\int_0^1 G(x,s) u_N(s) ds\n$$\n$$\n= \\sum_{n=1}^N a_n \\sin(n\\pi x) - \\lambda \\int_0^1 G(x,s) \\left(\\sum_{n=1}^N a_n \\sin(n\\pi s)\\right) ds.\n$$\n根据线性性质，我们可以交换求和与积分：\n$$\nL(u_N)(x) = \\sum_{n=1}^N a_n \\sin(n\\pi x) - \\lambda \\sum_{n=1}^N a_n \\left(\\int_0^1 G(x,s) \\sin(n\\pi s) ds\\right).\n$$\n使用 (a) 部分的结果：\n$$\nL(u_N)(x) = \\sum_{n=1}^N a_n \\sin(n\\pi x) - \\lambda \\sum_{n=1}^N a_n (\\alpha_n \\sin(n\\pi x)) = \\sum_{n=1}^N a_n (1 - \\lambda \\alpha_n) \\sin(n\\pi x).\n$$\n配置法在一组离散点 $x_i = \\frac{i}{N+1}$（其中 $i = 1,2,\\dots,N$）上强制执行残差方程：\n$$\nL(u_N)(x_i) = g(x_i) \\implies \\sum_{n=1}^N a_n (1 - \\lambda \\alpha_n) \\sin(n\\pi x_i) = g(x_i).\n$$\n这是一个关于 $N$ 个未知系数 $a_n$ 的 $N$ 个线性方程组。第 $i$ 个方程是：\n$$\n\\sum_{n=1}^N \\left[ \\sin(n\\pi x_i) (1 - \\lambda \\alpha_n) \\right] a_n = g(x_i).\n$$\n系数矩阵 $A_{\\mathrm{col}}$ 的元素为 $(A_{\\mathrm{col}})_{in} = \\sin(n\\pi x_i) (1 - \\lambda \\alpha_n)$。\n我们已知 $S_{in} = \\sin(n \\pi x_i)$ 且 $D$ 是一个对角矩阵，其对角元素为 $D_{nn} = 1 - \\lambda \\alpha_n$。让我们计算乘积 $S D$：\n$$\n(S D)_{in} = \\sum_{k=1}^N S_{ik} D_{kn} = S_{in} D_{nn} = \\sin(n\\pi x_i) (1 - \\lambda \\alpha_n).\n$$\n这恰好是 $(A_{\\mathrm{col}})_{in}$。因此，线性系统为 $A_{\\mathrm{col}}\\,\\mathbf{a} = \\mathbf{g}_{\\mathrm{nodes}}$，其中 $A_{\\mathrm{col}} = S D$。\n\n**c) Galerkin 法公式**\n\nGalerkin 法要求残差与每个测试函数 $\\psi_m(x) = \\sin(m\\pi x)$（其中 $m=1,2,\\dots,N$）正交：\n$$\n\\int_0^1 \\psi_m(x) L(u_N)(x) dx = \\int_0^1 \\psi_m(x) g(x) dx.\n$$\n右边是 $b_m$ 的定义。左边是：\n$$\n\\int_0^1 \\sin(m\\pi x) \\left( \\sum_{n=1}^N a_n (1-\\lambda\\alpha_n) \\sin(n\\pi x) \\right) dx.\n$$\n交换积分和求和：\n$$\n\\sum_{n=1}^N a_n (1-\\lambda\\alpha_n) \\int_0^1 \\sin(m\\pi x) \\sin(n\\pi x) dx.\n$$\n正弦函数在区间 $(0,1)$ 上是正交的：\n$$\n\\int_0^1 \\sin(m\\pi x) \\sin(n\\pi x) dx = \\frac{1}{2} \\delta_{mn},\n$$\n其中 $\\delta_{mn}$ 是克罗内克 (Kronecker) delta。将此代入方程得到：\n$$\n\\sum_{n=1}^N a_n (1-\\lambda\\alpha_n) \\left(\\frac{1}{2} \\delta_{mn}\\right) = b_m.\n$$\n求和塌陷，只剩下 $n=m$ 的项：\n$$\na_m (1-\\lambda\\alpha_m) \\frac{1}{2} = b_m.\n$$\n这表示系统 $A_{\\mathrm{gal}}\\,\\mathbf{a} = \\mathbf{b}$ 的第 $m$ 个方程。因此矩阵 $A_{\\mathrm{gal}}$ 是对角矩阵，其元素为：\n$$\n(A_{\\mathrm{gal}})_{mm} = \\frac{1}{2}(1 - \\lambda \\alpha_m).\n$$\n这正好对应于矩阵 $\\frac{1}{2}D$，其中 $D$ 是 (b) 部分的对角矩阵。\n\n**d) 条件数之比**\n\n谱条件数是 $\\kappa_2(A) = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$，其中 $\\sigma(A)$ 是 $A$ 的奇异值。\n\n对于 Galerkin 矩阵 $A_{\\mathrm{gal}} = \\frac{1}{2}D$：\n因为 $A_{\\mathrm{gal}}$ 是一个对角元素为实数 $\\frac{1}{2} D_{nn}$ 的对角矩阵，其奇异值是其对角元素的绝对值：\n$$\n\\sigma_n(A_{\\mathrm{gal}}) = \\left| \\frac{1}{2} D_{nn} \\right| = \\frac{1}{2} |1 - \\lambda \\alpha_n|.\n$$\n条件数是这些值的最大值与最小值之比：\n$$\n\\kappa_2(A_{\\mathrm{gal}}) = \\frac{\\max_{n=1,\\dots,N} \\sigma_n(A_{\\mathrm{gal}})}{\\min_{n=1,\\dots,N} \\sigma_n(A_{\\mathrm{gal}})} = \\frac{\\frac{1}{2} \\max_n |1 - \\lambda \\alpha_n|}{\\frac{1}{2} \\min_n |1 - \\lambda \\alpha_n|} = \\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|}.\n$$\n\n对于配置矩阵 $A_{\\mathrm{col}} = SD$：\n$A_{\\mathrm{col}}$ 的奇异值是 $(A_{\\mathrm{col}})^T A_{\\mathrm{col}}$ 的特征值的平方根。\n$$\n(A_{\\mathrm{col}})^T A_{\\mathrm{col}} = (SD)^T(SD) = D^T S^T S D.\n$$\n由于 $D$ 是对角矩阵，所以 $D^T=D$。我们需要计算 $S^T S$。$S$ 的元素是 $S_{in} = \\sin(n\\pi x_i) = \\sin(\\frac{in\\pi}{N+1})$。$S^T S$ 的 $(m,k)$ 项是：\n$$\n(S^T S)_{mk} = \\sum_{i=1}^N (S^T)_{mi} S_{ik} = \\sum_{i=1}^N S_{im} S_{ik} = \\sum_{i=1}^N \\sin\\left(\\frac{im\\pi}{N+1}\\right) \\sin\\left(\\frac{ik\\pi}{N+1}\\right).\n$$\n这个和是一个标准的离散正弦变换正交关系：\n$$\n\\sum_{i=1}^{M-1} \\sin\\left(\\frac{ij\\pi}{M}\\right) \\sin\\left(\\frac{ik\\pi}{M}\\right) = \\frac{M}{2}\\delta_{jk}.\n$$\n当 $M=N+1$ 时，我们的和变成：\n$$\n\\sum_{i=1}^{N} \\sin\\left(\\frac{im\\pi}{N+1}\\right) \\sin\\left(\\frac{ik\\pi}{N+1}\\right) = \\frac{N+1}{2}\\delta_{mk}.\n$$\n因此，$S^T S = \\frac{N+1}{2} I$，其中 $I$ 是 $N \\times N$ 的单位矩阵。\n将此代回 $(A_{\\mathrm{col}})^T A_{\\mathrm{col}}$ 的表达式中：\n$$\n(A_{\\mathrm{col}})^T A_{\\mathrm{col}} = D \\left(\\frac{N+1}{2} I\\right) D = \\frac{N+1}{2} D^2.\n$$\n这是一个对角矩阵，其对角元素为 $\\frac{N+1}{2} (D_{nn})^2$。这些是 $(A_{\\mathrm{col}})^T A_{\\mathrm{col}}$ 的特征值。$A_{\\mathrm{col}}$ 的奇异值是这些特征值的平方根：\n$$\n\\sigma_n(A_{\\mathrm{col}}) = \\sqrt{\\frac{N+1}{2} (D_{nn})^2} = \\sqrt{\\frac{N+1}{2}} |D_{nn}|.\n$$\n$A_{\\mathrm{col}}$ 的条件数则为：\n$$\n\\kappa_2(A_{\\mathrm{col}}) = \\frac{\\max_n \\sigma_n(A_{\\mathrm{col}})}{\\min_n \\sigma_n(A_{\\mathrm{col}})} = \\frac{\\sqrt{\\frac{N+1}{2}} \\max_n |D_{nn}|}{\\sqrt{\\frac{N+1}{2}} \\min_n |D_{nn}|} = \\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|}.\n$$\n比较两个条件数：\n$$\n\\kappa_2(A_{\\mathrm{col}}) = \\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|} \\quad \\text{和} \\quad \\kappa_2(A_{\\mathrm{gal}}) = \\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|}.\n$$\n它们是相同的。因此，它们的比值为 $1$。\n\n$$\n\\frac{\\kappa_{2}(A_{\\mathrm{col}})}{\\kappa_{2}(A_{\\mathrm{gal}})} = \\frac{\\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|}}{\\frac{\\max_n |D_{nn}|}{\\min_n |D_{nn}|}} = 1.\n$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "实现像电场积分方程 (EFIE) 这类积分方程方法的一个核心挑战是，当源点和观察点重合时，如何精确计算产生的奇异积分。本练习将引导您分析处理三角基元上 $1/R$ 奇异性的方法，这是现代面积分方程求解器的基石。掌握这种主值正则化技术对于开发稳健且精确的计算电磁学代码至关重要。",
            "id": "3330384",
            "problem": "考虑一个通过矩量法 (MoM) 离散化的理想电导体、无限薄的平面三角形贴片上的电场积分方程 (EFIE)，其核函数涉及自由空间标量格林函数的静态部分。核函数的弱奇异性由因子 $1/R$ 决定，其中 $R = \\|\\mathbf{r} - \\mathbf{r}'\\|$。为了给配置方案定义一个自项，采用主值正则化方法，即在位于单元上的观测点 $\\mathbf{r}$ 处排除一个半径为 $\\rho$ 的圆盘，然后令 $\\rho \\to 0^{+}$。具体来说，定义\n$$\nI(\\rho) \\equiv \\int_{T \\setminus B_{\\rho}(\\mathbf{r})} \\frac{1}{\\|\\mathbf{r} - \\mathbf{r}'\\|} \\, dS' ,\n$$\n其中 $T$ 是平面三角形单元，$B_{\\rho}(\\mathbf{r})$ 是以 $\\mathbf{r}$ 为中心、半径为 $\\rho$ 的开圆盘，两者都位于同一平面内。使用加权余量观点和核函数的第一性原理渐近分析，证明当 $\\rho \\to 0^{+}$ 时，\n$$\nI(\\rho) = I_{0} - 2\\pi \\rho + o(\\rho) ,\n$$\n其中 $I_0$ 是一个与 $\\rho$ 无关的有限值。然后，对于 $T$ 是一个边长为 $a$ 的等边三角形，且观测点 $\\mathbf{r}$ 是该三角形的形心的特定情况，计算主值有限部分\n$$\nI_{0} \\equiv \\lim_{\\rho \\to 0^{+}} \\left[ \\int_{T \\setminus B_{\\rho}(\\mathbf{r})} \\frac{1}{\\|\\mathbf{r} - \\mathbf{r}'\\|} \\, dS' + 2\\pi \\rho \\right]\n$$\n以 $a$ 的函数形式给出其闭合解。所有角度都应以弧度为单位。将您的最终答案仅用 $a$ 来表示。最终答案必须是单一的闭合形式解析表达式；不要提供中间步骤。无需四舍五入。",
            "solution": "首先根据指定标准对问题进行验证。\n\n**步骤 1：提取已知条件**\n-   所考虑的积分是 $I(\\rho) \\equiv \\int_{T \\setminus B_{\\rho}(\\mathbf{r})} \\frac{1}{\\|\\mathbf{r} - \\mathbf{r}'\\|} \\, dS'$，它出现在电场积分方程 (EFIE) 的矩量法 (MoM) 处理中。\n-   $T$ 是一个平坦、无限薄的平面三角形单元。\n-   $\\mathbf{r}$ 是位于单元 $T$ 上的观测点。\n-   $\\mathbf{r}'$ 是积分源点。\n-   $B_{\\rho}(\\mathbf{r})$ 是以 $\\mathbf{r}$ 为中心、半径为 $\\rho$ 的开圆盘。\n-   核函数奇异性为 $1/R$，其中 $R = \\|\\mathbf{r} - \\mathbf{r}'\\|$。\n-   任务1：证明当 $\\rho \\to 0^{+}$ 时，该积分具有渐近形式 $I(\\rho) = I_{0} - 2\\pi \\rho + o(\\rho)$，其中 $I_0$ 是一个与 $\\rho$ 无关的有限常数。\n-   任务2：对于 $T$ 是边长为 $a$ 的等边三角形且 $\\mathbf{r}$ 是其形心的特定情况，计算定义为 $I_{0} \\equiv \\lim_{\\rho \\to 0^{+}} \\left[ I(\\rho) + 2\\pi \\rho \\right]$ 的主值有限部分。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题在计算电磁学和应用数学领域有坚实的基础。边界元法（如 MoM）中奇异核函数的分析是一个标准和基础的课题。$1/R$ 位核及其正则化是该领域的核心。\n-   **适定性**：该问题定义清晰，有特定的积分、定义的极限过程以及为最终计算所描述的清晰几何形状。预期存在唯一解。\n-   **客观性**：该问题以精确的数学语言陈述，没有任何主观性。\n-   问题设置完整、一致、科学合理且可形式化。它提出了一个与其所述领域相关的实质性的、非平凡的问题。\n\n**步骤 3：结论与行动**\n该问题有效。将提供完整解答。\n\n根据题目要求，解答分为两部分。\n\n**第一部分：$I(\\rho)$ 的渐近分析**\n需要分析的积分是\n$$\nI(\\rho) = \\int_{T \\setminus B_{\\rho}(\\mathbf{r})} \\frac{1}{\\|\\mathbf{r} - \\mathbf{r}'\\|} \\, dS'\n$$\n为了分析当 $\\rho \\to 0^{+}$ 时该积分的行为，我们在观测点 $\\mathbf{r}$ 处引入一个极坐标系 $(s, \\phi)$。在此坐标系中，从源点 $\\mathbf{r}'$ 到观测点 $\\mathbf{r}$ 的距离就是径向坐标 $s$，即 $\\|\\mathbf{r} - \\mathbf{r}'\\| = s$。此平面坐标系中的面积微元为 $dS' = s \\, ds \\, d\\phi$。\n\n将这些代入积分表达式，我们得到：\n$$\nI(\\rho) = \\int_{\\text{domain}} \\frac{1}{s} (s \\, ds \\, d\\phi) = \\int_{\\text{domain}} ds \\, d\\phi\n$$\n$\\mathbf{r}'$ 的积分域是三角形 $T$ 除去圆盘 $B_{\\rho}(\\mathbf{r})$。在我们的极坐标中，这对应于 $s \\ge \\rho$ 且对应于 $(s, \\phi)$ 的点在 $T$ 内部。设三角形 $T$ 的边界在这些极坐标中由函数 $s = R_T(\\phi)$ 描述。\n\n题目暗示 $\\mathbf{r}$ 是 $T$ 的一个内点。这是因为渐近项是 $-2\\pi\\rho$，对应于排除一个角度为 $2\\pi$ 的完整圆盘。对于足够小的 $\\rho$，圆盘 $B_{\\rho}(\\mathbf{r})$ 完全包含在 $T$ 内部。因此，对角度 $\\phi$ 的积分覆盖了从 $0$ 到 $2\\pi$ 的整个范围。对径向坐标 $s$ 的积分从被排除圆盘的边界 $s=\\rho$ 到三角形的边界 $s=R_T(\\phi)$。\n\n积分变为：\n$$\nI(\\rho) = \\int_{0}^{2\\pi} \\left( \\int_{\\rho}^{R_T(\\phi)} ds \\right) d\\phi\n$$\n计算关于 $s$ 的内层积分：\n$$\n\\int_{\\rho}^{R_T(\\phi)} ds = [s]_{\\rho}^{R_T(\\phi)} = R_T(\\phi) - \\rho\n$$\n将此结果代回外层积分：\n$$\nI(\\rho) = \\int_{0}^{2\\pi} (R_T(\\phi) - \\rho) \\, d\\phi = \\int_{0}^{2\\pi} R_T(\\phi) \\, d\\phi - \\int_{0}^{2\\pi} \\rho \\, d\\phi\n$$\n第一项 $\\int_{0}^{2\\pi} R_T(\\phi) \\, d\\phi$ 是一个仅取决于 $T$ 的几何形状和 $\\mathbf{r}$ 位置的常数。它是有限的且与 $\\rho$ 无关。该项即为主值积分 $I_0$。第二项是：\n$$\n\\int_{0}^{2\\pi} \\rho \\, d\\phi = \\rho \\int_{0}^{2\\pi} d\\phi = 2\\pi\\rho\n$$\n因此，我们已经证明对于内点 $\\mathbf{r}$，\n$$\nI(\\rho) = \\int_{0}^{2\\pi} R_T(\\phi) \\, d\\phi - 2\\pi\\rho\n$$\n定义 $I_0 = \\int_{0}^{2\\pi} R_T(\\phi) \\, d\\phi$，我们有 $I(\\rho) = I_0 - 2\\pi\\rho$。这符合 $I(\\rho) = I_0 - 2\\pi\\rho + o(\\rho)$ 的形式，其中高阶项 $o(\\rho)$ 在这种理想化的平面情况下恰好为零。这完成了问题的第一部分。\n\n**第二部分：等边三角形的 $I_0$ 计算**\n我们被要求计算当 $T$ 为边长为 $a$ 的等边三角形，且观测点 $\\mathbf{r}$ 在其形心时 $I_0$ 的值。\n$$\nI_0 = \\int_{0}^{2\\pi} R_T(\\phi) \\, d\\phi\n$$\n我们将形心置于笛卡尔坐标系的原点 $(0,0)$。等边三角形的高为 $h = a\\sqrt{3}/2$。从形心到每条边的距离（边心距）是 $h/3 = a\\sqrt{3}/6$，到每个顶点的距离是 $2h/3 = a\\sqrt{3}/3$。\n为了简化边界的描述，我们将三角形的一条边置于水平位置。顶点位于：\n$V_1 = (-a/2, -a\\sqrt{3}/6)$，$V_2 = (a/2, -a\\sqrt{3}/6)$，以及 $V_3 = (0, a\\sqrt{3}/3)$。\n\n三角形关于形心具有3重旋转对称性。我们可以计算其中一个相同扇形区域上的积分，然后将结果乘以3。我们考虑连接顶点 $V_2$ 和 $V_3$ 的边所对应的扇形区域。$V_2$ 的极角是 $\\phi_2 = \\arctan\\left(\\frac{-a\\sqrt{3}/6}{a/2}\\right) = \\arctan(-1/\\sqrt{3}) = -\\pi/6$。$V_3$ 的极角是 $\\phi_3 = \\pi/2$。因此这条边的角度范围是 $\\phi \\in [-\\pi/6, \\pi/2]$。\n\n线段 $V_2V_3$ 经过 $(a/2, -a\\sqrt{3}/6)$ 和 $(0, a\\sqrt{3}/3)$。斜率为 $m = \\frac{a\\sqrt{3}/3 - (-a\\sqrt{3}/6)}{0 - a/2} = \\frac{a\\sqrt{3}/2}{-a/2} = -\\sqrt{3}$。直线方程为 $y - a\\sqrt{3}/3 = -\\sqrt{3}x$，化简为 $\\sqrt{3}x + y = a\\sqrt{3}/3$。\n\n为了求出该线段的 $R_T(\\phi)$，我们通过代入 $x = s\\cos\\phi$ 和 $y = s\\sin\\phi$ 将直线方程转换为极坐标：\n$$\n\\sqrt{3}s\\cos\\phi + s\\sin\\phi = \\frac{a\\sqrt{3}}{3}\n$$\n提出因子 $s$ 得到 $s(\\sqrt{3}\\cos\\phi + \\sin\\phi) = a\\sqrt{3}/3$。我们使用辅助角公式来合并三角函数项：\n$$\ns \\cdot 2 \\left( \\frac{\\sqrt{3}}{2}\\cos\\phi + \\frac{1}{2}\\sin\\phi \\right) = s \\cdot 2 \\left( \\cos(\\pi/6)\\cos\\phi + \\sin(\\pi/6)\\sin\\phi \\right) = 2s\\cos(\\phi - \\pi/6)\n$$\n所以，方程变为 $2s\\cos(\\phi - \\pi/6) = a\\sqrt{3}/3$。解出 $s$，即我们的 $R_T(\\phi)$，得到：\n$$\nR_T(\\phi) = \\frac{a\\sqrt{3}}{6\\cos(\\phi - \\pi/6)}\n$$\n这个表达式在 $\\phi \\in [-\\pi/6, \\pi/2]$ 上有效。\n根据对称性，总积分 $I_0$ 是这个扇形区域上积分的三倍：\n$$\nI_0 = 3 \\int_{-\\pi/6}^{\\pi/2} \\frac{a\\sqrt{3}}{6\\cos(\\phi - \\pi/6)} \\, d\\phi\n$$\n我们进行换元，令 $u = \\phi - \\pi/6$。则 $du = d\\phi$。积分限从 $\\phi = -\\pi/6 \\to u = -\\pi/3$ 和 $\\phi = \\pi/2 \\to u = \\pi/3$ 改变。积分变为：\n$$\nI_0 = 3 \\cdot \\frac{a\\sqrt{3}}{6} \\int_{-\\pi/3}^{\\pi/3} \\frac{1}{\\cos u} \\, du = \\frac{a\\sqrt{3}}{2} \\int_{-\\pi/3}^{\\pi/3} \\sec u \\, du\n$$\n由于 $\\sec u$ 是偶函数，我们可以化简积分为：\n$$\nI_0 = \\frac{a\\sqrt{3}}{2} \\cdot 2 \\int_{0}^{\\pi/3} \\sec u \\, du = a\\sqrt{3} \\int_{0}^{\\pi/3} \\sec u \\, du\n$$\n$\\sec u$ 的标准积分是 $\\ln|\\sec u + \\tan u|$。计算该定积分：\n$$\nI_0 = a\\sqrt{3} \\left[ \\ln|\\sec u + \\tan u| \\right]_{0}^{\\pi/3}\n$$\n在上限处，$u=\\pi/3$：$\\sec(\\pi/3) = 2$ 且 $\\tan(\\pi/3) = \\sqrt{3}$。\n在下限处，$u=0$：$\\sec(0) = 1$ 且 $\\tan(0) = 0$。\n代入这些值：\n$$\nI_0 = a\\sqrt{3} \\left( \\ln|2 + \\sqrt{3}| - \\ln|1 + 0| \\right) = a\\sqrt{3} (\\ln(2 + \\sqrt{3}) - \\ln(1))\n$$\n因为 $\\ln(1) = 0$，最终结果是：\n$$\nI_0 = a\\sqrt{3} \\ln(2 + \\sqrt{3})\n$$\n这就是积分有限部分的闭合形式解析表达式，是边长 $a$ 的函数。",
            "answer": "$$\n\\boxed{a\\sqrt{3}\\ln(2 + \\sqrt{3})}\n$$"
        },
        {
            "introduction": "高级的矩量法不仅能施加边界条件，还可以融合基本物理定律以提升解的精度和物理一致性。本练习要求您通过一个惩罚项来增强标准电场积分方程 (EFIE)，以强制满足关于功率守恒的坡印廷定理，这会导出一个非线性问题，您需要通过推导迭代格式来求解。这个练习展示了如何将抽象的场论与实用的、基于物理的数值算法联系起来。",
            "id": "3330371",
            "problem": "考虑一个位于无源均匀介质中、边界为 $\\Gamma$ 的理想电导体 (PEC) 的电场积分方程 (EFIE)。在角频率为 $\\omega$ 的时谐条件下，EFIE 强制 $\\Gamma$ 上的总切向电场为零。在采用 $\\Gamma$ 上的 $N$ 个实值脉冲基函数 $\\{b_n\\}_{n=1}^N$ 和点选配法的矩量法 (MoM) 离散化中，设离散化的未知电流向量为 $\\mathbf{i} \\in \\mathbb{R}^N$，系统矩阵为 $\\mathbf{Z} \\in \\mathbb{R}^{N \\times N}$，入射场激励为 $\\mathbf{v} \\in \\mathbb{R}^N$，则残差 $\\mathbf{r}(\\mathbf{i})$ 由下式给出\n$$\n\\mathbf{r}(\\mathbf{i}) = \\mathbf{Z}\\,\\mathbf{i} - \\mathbf{v}.\n$$\n假设在加权残差法中，权重由一个对称正定矩阵 $\\mathbf{W} \\in \\mathbb{R}^{N \\times N}$ 表示，并定义残差泛函\n$$\nJ_{\\text{EFIE}}(\\mathbf{i}) = \\left\\|\\mathbf{W}^{1/2}\\,\\mathbf{r}(\\mathbf{i})\\right\\|_2^2.\n$$\n时间平均的坡印亭矢量 $\\mathbf{S}$ 由 $\\mathbf{S} = \\frac{1}{2}\\,\\text{Re}\\{\\mathbf{E} \\times \\mathbf{H}^*\\}$ 给出，穿过 $\\Gamma$ 的净向外能流为\n$$\nP_{\\text{out}}(\\mathbf{i}) = \\int_{\\Gamma} \\mathbf{S} \\cdot \\hat{\\mathbf{n}} \\,\\mathrm{d}\\Gamma.\n$$\n在一个电阻性（辐射性）部分占主导地位的一致性低电抗区域中，将离散的净向外功率流近似为\n$$\nP_{\\text{out}}(\\mathbf{i}) \\approx \\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i},\n$$\n其中 $\\mathbf{R} \\in \\mathbb{R}^{N \\times N}$ 是一个对称半正定矩阵，用于模拟 $\\Gamma$ 上的离散辐射电阻算子。设 $P_{\\text{in}} \\in \\mathbb{R}$ 为穿过 $\\Gamma$ 的指定入射功率（当预期为净向外通量时为正），并定义坡印亭失配\n$$\n\\Delta P(\\mathbf{i}) = \\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i} - P_{\\text{in}}.\n$$\n您的任务是构建一个残差加权策略，通过在目标函数中惩罚失配项 $\\Delta P(\\mathbf{i})$ 来强制执行离散的坡印亭定理。具体来说，考虑带有标量惩罚参数 $\\lambda \\ge 0$ 的加权残差最小化问题：\n$$\nJ(\\mathbf{i}) = J_{\\text{EFIE}}(\\mathbf{i}) + \\lambda\\,\\left[\\Delta P(\\mathbf{i})\\right]^2.\n$$\n从基本电磁学原理出发，推导一个基于标量惩罚项的原则性线性化的算法，该算法通过求解一系列线性系统来产生 $\\mathbf{i}$ 的迭代更新。您的推导必须：\n- 从 EFIE 残差和时间平均坡印亭定理的定义开始。\n- 在低电抗区域中，根据第一性原理证明离散近似 $P_{\\text{out}}(\\mathbf{i}) \\approx \\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i}$ 的合理性。\n- 将 $\\mathbf{i}$ 视为实值，以分离电阻性功率的作用并避免复变函数微积分，并使用不依赖于快捷公式的可靠优化原理，推导更新方向的线性化法向方程。\n- 最后给出一个显式的迭代方案，以及一个基于所推导的物理和数值原理的停止准则。\n\n您的程序必须实现所推导的算法，并对包含五个测试用例的测试套件评估坡印亭失配。在所有情况下，答案以瓦特 (W) 为单位，并打印四舍五入到六位小数的结果。在所有案例中共享使用以下离散参数：\n- 几何离散化大小：$N = 5$。\n- 系统矩阵元素：\n  $$\n  Z_{mn} = \\begin{cases}\n  2.0,   m = n,\\\\\n  \\dfrac{0.3}{|m-n|},  m \\ne n,\n  \\end{cases}\n  $$\n  对于 $m,n \\in \\{1,2,3,4,5\\}$。\n- 权重矩阵：$\\mathbf{W} = \\mathbf{I}$（$5 \\times 5$ 的单位矩阵）。\n- 辐射电阻矩阵：$\\mathbf{R} = 0.8\\,\\mathbf{Z}$。\n- 入射激励向量分量：\n  $$\n  v_n = 1.0 + 0.5\\,\\cos\\left(\\frac{2\\pi\\,n}{N}\\right), \\quad n = 1,2,3,4,5.\n  $$\n\n评估以下五个测试用例，它们涵盖了残差加权和能流强制执行的不同方面：\n- 案例 A（无惩罚，理想路径 EFIE）：$P_{\\text{in}} = 1.0$，$\\lambda = 0.0$。\n- 案例 B（中等惩罚）：$P_{\\text{in}} = 1.0$，$\\lambda = 0.2$。\n- 案例 C（强惩罚）：$P_{\\text{in}} = 1.0$，$\\lambda = 2.0$。\n- 案例 D（极强惩罚，边界强制）：$P_{\\text{in}} = 1.0$，$\\lambda = 20.0$。\n- 案例 E（零入射功率边界情况）：$P_{\\text{in}} = 0.0$，$\\lambda = 2.0$。\n\n算法要求：\n- 在无惩罚的最小二乘 EFIE 解 $\\mathbf{i}^{(0)} = \\mathbf{Z}^{-1}\\mathbf{v}$ 处初始化迭代方案。\n- 最多使用 $20$ 次迭代，当更新的欧几里得范数 $\\|\\delta \\mathbf{i}\\|_2$ 低于 $10^{-10}$ 时提前终止。\n- 收敛后，计算每种情况下的坡印亭失配 $\\Delta P(\\mathbf{i})$，以瓦特 (W) 为单位表示。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含五个结果，以逗号分隔的列表形式包含在方括号中，每个结果四舍五入到六位小数，并以瓦特 (W) 为单位表示，例如：\"[resultA,resultB,resultC,resultD,resultE]\"。",
            "solution": "用户提供了一个问题陈述，要求推导并实现一个迭代算法，以求解电场积分方程 (EFIE) 的一个惩罚加权残差公式。对此问题陈述的验证是强制性的第一步。\n\n所提供的问题在科学上基于计算电磁学的原理，特别是矩量法 (MoM) 和功率守恒定律（坡印亭定理）。其数学公式涉及通过惩罚方法最小化一个复合目标函数，这是优化和科学计算中的一种标准且严谨的方法。该问题是适定的：所有矩阵（$\\mathbf{Z}$、$\\mathbf{R}$、$\\mathbf{W}$）都有明确定义，并具有确保线性子问题存在唯一解的性质（例如，$\\mathbf{Z}$ 是对称正定的）。参数和测试用例的规定是完整和一致的，没有缺失信息或矛盾。所要求的基于原则性线性化的推导是解决非线性最小二乘问题的标准技术（特别是高斯-牛顿法）。该问题是客观且可形式化的。因此，该问题被认定为有效，并将提供完整的解决方案。\n\n问题的核心是设计一个算法来找到使目标函数最小化的电流向量 $\\mathbf{i} \\in \\mathbb{R}^N$：\n$$\nJ(\\mathbf{i}) = J_{\\text{EFIE}}(\\mathbf{i}) + \\lambda\\,\\left[\\Delta P(\\mathbf{i})\\right]^2\n$$\n这个函数代表了两个物理要求之间的平衡。第一项 $J_{\\text{EFIE}}(\\mathbf{i})$ 是 EFIE 残差的平方范数。最小化此项强制执行了电磁边界条件，即理想电导体表面上的总切向电场必须为零。在给定的权重矩阵 $\\mathbf{W} = \\mathbf{I}$（单位矩阵）下，它由下式给出：\n$$\nJ_{\\text{EFIE}}(\\mathbf{i}) = \\left\\|\\mathbf{Z}\\mathbf{i} - \\mathbf{v}\\right\\|_2^2 = (\\mathbf{Z}\\mathbf{i} - \\mathbf{v})^\\top (\\mathbf{Z}\\mathbf{i} - \\mathbf{v})\n$$\n第二项 $\\lambda\\,\\left[\\Delta P(\\mathbf{i})\\right]^2$ 是一个惩罚项。它强制执行一个从关于功率守恒的坡印亭定理推导出的全局物理约束。坡印亭失配 $\\Delta P(\\mathbf{i})$ 表示对离散功率平衡的违背，定义为辐射功率 $P_{\\text{out}}(\\mathbf{i})$ 与物体吸收的入射功率 $P_{\\text{in}}$ 之间的差值：\n$$\n\\Delta P(\\mathbf{i}) = P_{\\text{out}}(\\mathbf{i}) - P_{\\text{in}} = \\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i} - P_{\\text{in}}\n$$\n在这里，矩阵 $\\mathbf{R}$ 代表离散辐射电阻算子，而二次型 $\\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i}$ 是由电流 $\\mathbf{i}$ 所代表的表面电流辐射的总时间平均功率的离散近似。参数 $\\lambda \\ge 0$ 控制了相对于边界条件强制执行，此功率守恒强制执行的强度。\n\n完整的目标函数是：\n$$\nJ(\\mathbf{i}) = (\\mathbf{Z}\\mathbf{i} - \\mathbf{v})^\\top (\\mathbf{Z}\\mathbf{i} - \\mathbf{v}) + \\lambda \\left( \\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i} - P_{\\text{in}} \\right)^2\n$$\n由于平方惩罚项产生的四次项，该函数相对于 $\\mathbf{i}$ 是非线性的。直接求解是不可行的。因此，我们将推导一个基于原则性线性化的迭代算法，特别是高斯-牛顿法，它非常适合解决非线性最小二乘问题。\n\n设 $\\mathbf{i}^{(k)}$ 是第 $k$ 次迭代时电流向量的估计值。我们寻求一个更新量 $\\delta\\mathbf{i}$，使得下一个估计值 $\\mathbf{i}^{(k+1)} = \\mathbf{i}^{(k)} + \\delta\\mathbf{i}$ 更接近 $J(\\mathbf{i})$ 的最小值。我们通过在当前估计值 $\\mathbf{i}^{(k)}$ 周围对 $J(\\mathbf{i})$ 中的各项关于 $\\delta\\mathbf{i}$ 进行线性化来实现这一点。\n\nEFIE 残差项变为：\n$$\n\\mathbf{Z}\\mathbf{i} - \\mathbf{v} = \\mathbf{Z}(\\mathbf{i}^{(k)} + \\delta\\mathbf{i}) - \\mathbf{v} = (\\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}) + \\mathbf{Z}\\delta\\mathbf{i}\n$$\n设 $\\mathbf{r}^{(k)} = \\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}$ 为第 $k$ 次迭代时的残差。该表达式为 $\\mathbf{r}^{(k)} + \\mathbf{Z}\\delta\\mathbf{i}$。\n\n坡印亭失配项 $\\Delta P(\\mathbf{i})$ 使用在 $\\mathbf{i}^{(k)}$ 周围的一阶泰勒展开进行线性化：\n$$\n\\Delta P(\\mathbf{i}^{(k)} + \\delta\\mathbf{i}) \\approx \\Delta P(\\mathbf{i}^{(k)}) + \\left(\\nabla_{\\mathbf{i}} \\Delta P(\\mathbf{i}) \\Big|_{\\mathbf{i}^{(k)}}\\right)^\\top \\delta\\mathbf{i}\n$$\n$\\Delta P(\\mathbf{i})$ 的梯度是 $\\nabla_{\\mathbf{i}} (\\frac{1}{2}\\,\\mathbf{i}^\\top \\mathbf{R}\\,\\mathbf{i} - P_{\\text{in}}) = \\mathbf{R}\\mathbf{i}$，因为 $\\mathbf{R}$ 是对称的。因此，线性化的失配为：\n$$\n\\Delta P(\\mathbf{i}^{(k)} + \\delta\\mathbf{i}) \\approx \\Delta P(\\mathbf{i}^{(k)}) + (\\mathbf{R}\\mathbf{i}^{(k)})^\\top\\delta\\mathbf{i} = \\Delta P(\\mathbf{i}^{(k)}) + (\\mathbf{i}^{(k)})^\\top\\mathbf{R}\\delta\\mathbf{i}\n$$\n\n将这些线性化形式代回目标函数 $J(\\mathbf{i})$，得到关于更新量 $\\delta\\mathbf{i}$ 的二次目标函数：\n$$\nL(\\delta\\mathbf{i}) = \\left\\|\\mathbf{r}^{(k)} + \\mathbf{Z}\\delta\\mathbf{i}\\right\\|_2^2 + \\lambda \\left[\\Delta P(\\mathbf{i}^{(k)}) + (\\mathbf{i}^{(k)})^\\top\\mathbf{R}\\delta\\mathbf{i}\\right]^2\n$$\n为了找到最优更新量 $\\delta\\mathbf{i}$，我们通过将其关于 $\\delta\\mathbf{i}$ 的梯度设为零来最小化 $L(\\delta\\mathbf{i})$。这是一个线性最小二乘问题。我们可以通过定义以下各项，将其表述为标准形式 $\\min_{\\mathbf{x}} \\left\\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}\\right\\|_2^2$：\n$$\n\\mathbf{x} = \\delta\\mathbf{i}, \\quad\n\\mathbf{A} = \\begin{pmatrix} \\mathbf{Z} \\\\ \\sqrt{\\lambda} \\, (\\mathbf{i}^{(k)})^\\top\\mathbf{R} \\end{pmatrix}, \\quad\n\\mathbf{b} = \\begin{pmatrix} -\\mathbf{r}^{(k)} \\\\ -\\sqrt{\\lambda} \\, \\Delta P(\\mathbf{i}^{(k)}) \\end{pmatrix}\n$$\n这个最小二乘问题的解由法向方程 $\\mathbf{A}^\\top\\mathbf{A}\\mathbf{x} = \\mathbf{A}^\\top\\mathbf{b}$ 给出。我们来计算其分量：\n$$\n\\mathbf{A}^\\top\\mathbf{A} = \\begin{pmatrix} \\mathbf{Z}^\\top  \\sqrt{\\lambda}\\,\\mathbf{R}^\\top\\mathbf{i}^{(k)} \\end{pmatrix} \\begin{pmatrix} \\mathbf{Z} \\\\ \\sqrt{\\lambda}\\,(\\mathbf{i}^{(k)})^\\top\\mathbf{R} \\end{pmatrix} = \\mathbf{Z}^\\top\\mathbf{Z} + \\lambda\\,\\mathbf{R}\\mathbf{i}^{(k)}(\\mathbf{i}^{(k)})^\\top\\mathbf{R}\n$$\n$$\n\\mathbf{A}^\\top\\mathbf{b} = \\begin{pmatrix} \\mathbf{Z}^\\top  \\sqrt{\\lambda}\\,\\mathbf{R}\\mathbf{i}^{(k)} \\end{pmatrix} \\begin{pmatrix} -\\mathbf{r}^{(k)} \\\\ -\\sqrt{\\lambda}\\,\\Delta P(\\mathbf{i}^{(k)}) \\end{pmatrix} = -\\mathbf{Z}^\\top\\mathbf{r}^{(k)} - \\lambda\\,\\Delta P(\\mathbf{i}^{(k)})\\mathbf{R}\\mathbf{i}^{(k)}\n$$\n代入 $\\mathbf{r}^{(k)} = \\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}$，等式右边变为 $-\\mathbf{Z}^\\top(\\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}) - \\lambda\\,\\Delta P(\\mathbf{i}^{(k)})\\mathbf{R}\\mathbf{i}^{(k)}$。\n\n因此，在每次迭代 $k$ 中，我们求解以下线性系统以获得更新量 $\\delta\\mathbf{i}$：\n$$\n\\left[ \\mathbf{Z}^\\top\\mathbf{Z} + \\lambda\\,\\left(\\mathbf{R}\\mathbf{i}^{(k)}\\right)\\left(\\mathbf{R}\\mathbf{i}^{(k)}\\right)^\\top \\right] \\delta\\mathbf{i} = -\\mathbf{Z}^\\top(\\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}) - \\lambda\\,\\Delta P(\\mathbf{i}^{(k)})\\mathbf{R}\\mathbf{i}^{(k)}\n$$\n左侧的矩阵 $\\mathbf{H}^{(k)} = \\mathbf{Z}^\\top\\mathbf{Z} + \\lambda\\,(\\mathbf{R}\\mathbf{i}^{(k)})(\\mathbf{R}\\mathbf{i}^{(k)})^\\top$ 是 $J(\\mathbf{i})$ 的海森矩阵的高斯-牛顿近似。由于 $\\mathbf{Z}^\\top\\mathbf{Z}$ 是正定的，而秩一项 $\\lambda\\,(\\mathbf{R}\\mathbf{i}^{(k)})(\\mathbf{R}\\mathbf{i}^{(k)})^\\top$ 是半正定的，因此 $\\mathbf{H}^{(k)}$ 是正定的，这确保了每一步都存在 $\\delta\\mathbf{i}$ 的唯一解。\n\n完整的迭代算法如下：\n\n1.  **初始化 ($k=0$)**：\n    -   将初始电流向量计算为 EFIE 的无惩罚最小二乘解：$\\mathbf{i}^{(0)} = (\\mathbf{Z}^\\top\\mathbf{Z})^{-1}\\mathbf{Z}^\\top\\mathbf{v}$。由于 $\\mathbf{Z}$ 可逆，这可简化为 $\\mathbf{i}^{(0)} = \\mathbf{Z}^{-1}\\mathbf{v}$。\n\n2.  **迭代优化 (对于 $k = 0, 1, ..., k_{\\text{max}}-1$)**：\n    a.  使用当前估计值计算坡印亭失配：\n        $\\Delta P(\\mathbf{i}^{(k)}) = \\frac{1}{2}(\\mathbf{i}^{(k)})^\\top\\mathbf{R}\\mathbf{i}^{(k)} - P_{\\text{in}}$。\n    b.  组装系统矩阵（高斯-牛顿海森矩阵）：\n        $\\mathbf{H}^{(k)} = \\mathbf{Z}^\\top\\mathbf{Z} + \\lambda\\,\\mathbf{R}\\mathbf{i}^{(k)}(\\mathbf{i}^{(k)})^\\top\\mathbf{R}$。\n    c.  组装右侧向量（在 $\\delta\\mathbf{i}=\\mathbf{0}$ 处线性化目标函数的负梯度）：\n        $\\mathbf{f}^{(k)} = -\\mathbf{Z}^\\top(\\mathbf{Z}\\mathbf{i}^{(k)} - \\mathbf{v}) - \\lambda\\,\\Delta P(\\mathbf{i}^{(k)})\\mathbf{R}\\mathbf{i}^{(k)}$。\n    d.  求解线性系统 $\\mathbf{H}^{(k)}\\delta\\mathbf{i} = \\mathbf{f}^{(k)}$ 以获得更新向量 $\\delta\\mathbf{i}$。\n    e.  更新电流向量：$\\mathbf{i}^{(k+1)} = \\mathbf{i}^{(k)} + \\delta\\mathbf{i}$。\n    f.  检查收敛性：如果 $\\|\\delta\\mathbf{i}\\|_2  \\epsilon_{\\text{tol}}$（例如 $10^{-10}$），则终止迭代。\n\n3.  **最终确定**：\n    -   收敛或达到最大迭代次数后，最终电流向量为 $\\mathbf{i}_{\\text{final}} = \\mathbf{i}^{(k+1)}$。\n    -   计算最终的坡印亭失配 $\\Delta P(\\mathbf{i}_{\\text{final}})$。\n\n该算法为解决所提出的问题提供了一种鲁棒的、基于物理和数学原理的方法。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an iterative algorithm to solve a penalized\n    EFIE formulation that enforces a discrete Poynting theorem.\n    \"\"\"\n\n    # --- 1. Define Shared Discrete Parameters ---\n    N = 5\n    MAX_ITER = 20\n    TOL = 1e-10\n\n    # Construct the system matrix Z\n    Z = np.zeros((N, N))\n    for m in range(N):\n        for n in range(N):\n            if m == n:\n                Z[m, n] = 2.0\n            else:\n                Z[m, n] = 0.3 / abs((m + 1) - (n + 1))\n    \n    # Define the radiation resistance matrix R\n    R = 0.8 * Z\n\n    # Define the incident excitation vector v\n    n_vals = np.arange(1, N + 1)\n    v = 1.0 + 0.5 * np.cos(2 * np.pi * n_vals / N)\n\n    # --- 2. Define Test Cases ---\n    test_cases = [\n        # Case A: P_in = 1.0, lambda = 0.0\n        (1.0, 0.0),\n        # Case B: P_in = 1.0, lambda = 0.2\n        (1.0, 0.2),\n        # Case C: P_in = 1.0, lambda = 2.0\n        (1.0, 2.0),\n        # Case D: P_in = 1.0, lambda = 20.0\n        (1.0, 20.0),\n        # Case E: P_in = 0.0, lambda = 2.0\n        (0.0, 2.0),\n    ]\n\n    results = []\n\n    # --- 3. Pre-compute matrix products for efficiency ---\n    ZtZ = Z.T @ Z\n\n    # --- 4. Process Each Test Case ---\n    for P_in, lambda_val in test_cases:\n        # a. Initialization\n        # i_k is the current iterate for the current vector i\n        i_k = np.linalg.solve(Z, v)\n\n        if lambda_val > 0.0:\n            for _ in range(MAX_ITER):\n                # b. Calculate Poynting mismatch\n                delta_P_k = 0.5 * i_k.T @ R @ i_k - P_in\n\n                # c. Assemble the system matrix for the update\n                # This corresponds to the Gauss-Newton Hessian approximation\n                R_ik = R @ i_k\n                H_k = ZtZ + lambda_val * np.outer(R_ik, R_ik)\n                \n                # d. Assemble the right-hand side vector\n                # This corresponds to the negative gradient of the objective\n                f_k = -Z.T @ (Z @ i_k - v) - lambda_val * delta_P_k * R_ik\n                \n                # e. Solve for the update delta_i\n                delta_i = np.linalg.solve(H_k, f_k)\n\n                # f. Update the current vector\n                i_k = i_k + delta_i\n\n                # g. Check for convergence\n                if np.linalg.norm(delta_i)  TOL:\n                    break\n        \n        # After convergence (or if lambda=0), i_final = i_k\n        i_final = i_k\n        \n        # h. Compute the final Poynting mismatch\n        final_poynting_mismatch = 0.5 * i_final.T @ R @ i_final - P_in\n        results.append(final_poynting_mismatch)\n\n    # --- 5. Format and Print the Final Output ---\n    # The output format must exactly match the specification.\n    # Each result is rounded to six decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}