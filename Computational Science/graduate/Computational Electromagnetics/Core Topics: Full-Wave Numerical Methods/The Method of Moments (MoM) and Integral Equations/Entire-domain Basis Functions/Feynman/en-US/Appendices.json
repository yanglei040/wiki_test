{
    "hands_on_practices": [
        {
            "introduction": "The journey into any advanced numerical method is best started with a problem that is both physically meaningful and analytically tractable. This practice provides exactly that by tackling the canonical problem of electromagnetic scattering from a perfectly conducting circular cylinder . By implementing an entire-domain Method of Moments with Fourier basis functions, you will see firsthand how a well-chosen basis can diagonalize the integral operator, leading to a solution that perfectly matches the analytical result and provides a solid foundation for understanding more complex applications.",
            "id": "3305813",
            "problem": "You are asked to validate an entire-domain Method of Moments solution for a canonical two-dimensional scattering problem in computational electromagnetics using analytical results. Consider time-harmonic Transverse Magnetic with electric field along the $z$-axis (TM$_z$) scattering by a perfectly electrically conducting (PEC) circular cylinder of radius $a$ in free space. The incident field is a unit-amplitude plane wave $E_z^{\\text{inc}}(r,\\phi) = e^{i k r \\cos(\\phi)}$ propagating along the $x$-axis. The speed of light is $c = 299\\,792\\,458$ meters per second. All angles must be treated in radians, all lengths in meters, all frequencies in Hertz, and the final numerical outputs are dimensionless.\n\nStart from the scalar Helmholtz equation for TM$_z$ in two dimensions,\n$$\n\\nabla^2 E_z + k^2 E_z = 0,\n$$\nwith the free-space wavenumber $k = \\frac{2\\pi f}{c}$ and the total field boundary condition on the PEC,\n$$\nE_z^{\\text{tot}}(r=a,\\phi) = 0.\n$$\nRepresent the scattered field outside the cylinder as a single-layer potential over the circular boundary using the two-dimensional free-space Green's function $G(\\mathbf{r},\\mathbf{r}') = \\frac{i}{4} H_0^{(1)}(k|\\mathbf{r}-\\mathbf{r}'|)$, where $H_\\nu^{(1)}(\\cdot)$ is the Hankel function of the first kind,\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, d\\phi',\n$$\nwith $\\mathbf{r}'$ constrained to the circle $r'=a$, and $q(\\phi')$ an unknown equivalent source density. Enforce the boundary condition $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$ on $r = a$ in a Galerkin sense using the entire-domain Fourier basis functions $b_n(\\phi) = e^{i n \\phi}$ indexed by all integers $n \\in \\mathbb{Z}$. Use Graf's addition theorem to diagonalize the integral operator on the circle,\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r_>) J_m(k r_<) e^{i m (\\phi - \\phi')},\n$$\nwith $r_> = \\max(r,r')$ and $r_< = \\min(r,r')$, and $J_\\nu(\\cdot)$ the Bessel function of the first kind. Show that the single-layer operator acting on $b_n(\\phi')$ yields\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} \\int_0^{2\\pi} H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, b_n(\\phi') d\\phi' = \\lambda_n b_n(\\phi),\n$$\nwith diagonal eigenvalues\n$$\n\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a).\n$$\nUse the Jacobi–Anger expansion of the incident field on the boundary,\n$$\nE_z^{\\text{inc}}(a,\\phi) = \\sum_{n=-\\infty}^{\\infty} i^n J_n(k a) e^{i n \\phi},\n$$\nto derive the Galerkin solution for the source density coefficients $q_n$,\n$$\n\\lambda_n q_n + i^n J_n(k a) = 0 \\quad \\Rightarrow \\quad q_n = - \\frac{i^n J_n(k a)}{\\lambda_n}.\n$$\nShow that the scattered field expansion outside the cylinder takes the form\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\sum_{n=-\\infty}^{\\infty} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\nwhere projection of the single-layer potential yields\n$$\nA_n = \\frac{i}{4} (2\\pi a) q_n J_n(k a) = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\nThe last equality provides the analytical scattering coefficients by enforcing the Dirichlet boundary condition $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$ mode-by-mode, and simultaneously validates the entire-domain Fourier–Galerkin Method of Moments solution via the single-layer potential.\n\nImplement a program that computes and compares the numerical entire-domain Method of Moments coefficients to the analytical coefficients, and validates the scattered field against the analytical field. Use Bessel functions $J_n(\\cdot)$ and Hankel functions $H_n^{(1)}(\\cdot)$, and take $n$ from $-N$ to $N$ for a given truncation order $N$. For evaluating scattered fields, use\n$$\nE_z^{\\text{scat}}(r,\\phi) \\approx \\sum_{n=-N}^{N} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\nwith the above analytical $A_n$ and the Method of Moments-derived $A_n$ via $q_n$ and the single-layer projection.\n\nYour program must compute the following three test cases, each producing one floating-point result that will be aggregated and printed as a single line:\n\n1. Coefficient validation (happy path). Parameters: $a = 0.5$ meters, $f = 3.0 \\times 10^8$ Hertz, truncation $N = 40$. Compute the maximum relative error across all modes $n \\in \\{-N,\\dots,N\\}$ between numerical entire-domain $A_n$ and analytical $A_n$, defined as\n$$\n\\max_{-N \\le n \\le N} \\frac{\\left|A_n^{\\text{MoM}} - A_n^{\\text{analytical}}\\right|}{\\max\\left(\\left|A_n^{\\text{analytical}}\\right|, \\varepsilon\\right)},\n$$\nwith $\\varepsilon = 10^{-15}$.\n\n2. Field validation at a finite observation radius (coverage beyond coefficients). Parameters: $a = 0.35$ meters, $f = 1.2 \\times 10^9$ Hertz, truncation $N = 60$, observation radius $r_{\\text{obs}} = 10 a$, angles $\\phi_m = \\frac{2\\pi m}{16}$ for $m = 0,1,\\dots,15$ (in radians). Compute the maximum relative error across all angles between $E_z^{\\text{scat}}(r_{\\text{obs}},\\phi)$ built from numerical entire-domain $A_n$ and the analytical $A_n$,\n$$\n\\max_m \\frac{\\left|E_z^{\\text{scat,MoM}}(r_{\\text{obs}},\\phi_m) - E_z^{\\text{scat,analytical}}(r_{\\text{obs}},\\phi_m)\\right|}{\\max\\left(\\left|E_z^{\\text{scat,analytical}}(r_{\\text{obs}},\\phi_m)\\right|, \\varepsilon\\right)}.\n$$\n\n3. Boundary-condition residual under truncation (edge case). Parameters: $a = 0.02$ meters, choose $f$ such that $k a = 0.5$ (i.e., $f = \\frac{0.5\\, c}{2\\pi a}$ Hertz), truncation $N = 5$. Using the analytical coefficients truncated to $n \\in \\{-N,\\dots,N\\}$, compute the normalized maximum residual of the boundary condition over angles $\\phi_m = \\frac{2\\pi m}{64}$ for $m = 0,1,\\dots,63$,\n$$\n\\max_m \\frac{\\left|E_z^{\\text{inc}}(a,\\phi_m) + \\sum_{n=-N}^{N} A_n^{\\text{analytical}} H_n^{(1)}(k a) e^{i n \\phi_m}\\right|}{\\max_m \\left|E_z^{\\text{inc}}(a,\\phi_m)\\right|}.\n$$\n\nYour program should produce a single line of output containing the three numerical results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3]\"). Each result must be a floating-point number. Use the specified physical units (meters for $a$, Hertz for $f$), and use radians for all angles.",
            "solution": "We begin from the two-dimensional scalar Helmholtz equation for the $z$-directed electric field in Transverse Magnetic polarization, $E_z$, given by $\\nabla^2 E_z + k^2 E_z = 0$ outside the scatterer. For a perfectly electrically conducting (PEC) boundary at $r=a$, the Dirichlet boundary condition enforces that the total tangential electric field vanish at the surface, $E_z^{\\text{tot}}(r=a,\\phi) = 0$. The total field equals the sum of the incident field and the scattered field, $E_z^{\\text{tot}} = E_z^{\\text{inc}} + E_z^{\\text{scat}}$.\n\nWe represent the scattered field using a single-layer potential over the boundary curve $\\Gamma$ (the circle of radius $a$), with density $q(\\phi')$ and the two-dimensional free-space Green's function,\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_{\\Gamma} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) ds' = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, d\\phi',\n$$\nwhere $H_0^{(1)}(\\cdot)$ is the zeroth-order Hankel function of the first kind and $ds' = a\\, d\\phi'$ is the differential arc length on the circle.\n\nOn the boundary $r=a$, enforcing $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$ yields the Electric Field Integral Equation (EFIE) for TM$_z$ under the single-layer representation. To solve this equation using entire-domain basis functions, we expand the unknown $q(\\phi')$ in Fourier series,\n$$\nq(\\phi') = \\sum_{n=-\\infty}^{\\infty} q_n e^{i n \\phi'},\n$$\nand test the EFIE with the same family $b_n(\\phi) = e^{i n \\phi}$ (Galerkin approach). The integral operator on the circle is diagonalized by Fourier harmonics due to the circular symmetry. Using Graf's addition theorem,\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r_>) J_m(k r_<) e^{i m (\\phi - \\phi')},\n$$\nsetting $r=r'=a$ yields\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right)\\bigg|_{r=r'=a} = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k a) J_m(k a) e^{i m (\\phi - \\phi')}.\n$$\nApplying the single-layer operator to $b_n(\\phi')$ and integrating over $\\phi'$ gives\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} \\int_0^{2\\pi} \\left[\\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k a) J_m(k a) e^{i m (\\phi - \\phi')}\\right] a\\, e^{i n \\phi'} d\\phi'.\n$$\nInterchanging sum and integral and using orthogonality,\n$$\n\\int_0^{2\\pi} e^{i (n - m) \\phi'} d\\phi' = 2\\pi \\delta_{n m},\n$$\nwe find\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} a \\left[2\\pi H_n^{(1)}(k a) J_n(k a)\\right] e^{i n \\phi} = \\lambda_n b_n(\\phi),\n$$\nwith eigenvalues\n$$\n\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a).\n$$\nThus, the EFIE projected onto $b_n$ becomes\n$$\n\\lambda_n q_n + \\langle b_n, E_z^{\\text{inc}}(a,\\cdot) \\rangle = 0,\n$$\nwhere the bracket denotes Fourier coefficient extraction. Using the Jacobi–Anger expansion for the incident plane wave on the boundary,\n$$\nE_z^{\\text{inc}}(a,\\phi) = e^{i k a \\cos \\phi} = \\sum_{n=-\\infty}^{\\infty} i^n J_n(k a) e^{i n \\phi},\n$$\nwe identify the incident Fourier coefficients as $E_{n}^{\\text{inc}} = i^n J_n(k a)$. Therefore, the source density coefficients are\n$$\nq_n = - \\frac{i^n J_n(k a)}{\\lambda_n} = - \\frac{i^n J_n(k a)}{\\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a)} = - \\frac{2}{i \\pi a} \\frac{i^n}{H_n^{(1)}(k a)}.\n$$\n\nTo obtain the scattered field away from the boundary $(r>a)$ in the same harmonic basis, we expand the single-layer potential using Graf's addition theorem for $r>a$ ($r_>=r$, $r_<=a$), yielding\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') \\left[\\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r) J_m(k a) e^{i m (\\phi - \\phi')}\\right] a\\, d\\phi' = \\sum_{n=-\\infty}^{\\infty} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\nwhere the scattered-field modal amplitudes are\n$$\nA_n = \\frac{i}{4} \\left(2\\pi a\\right) q_n J_n(k a).\n$$\nSubstituting $q_n$,\n$$\nA_n = \\frac{i}{4} \\left(2\\pi a\\right) \\left[- \\frac{i^n J_n(k a)}{\\lambda_n}\\right] J_n(k a) = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\nThis last expression is precisely the analytical coefficient obtained by enforcing the boundary condition $E_z^{\\text{inc}}(a,\\phi) + \\sum_n A_n H_n^{(1)}(k a) e^{i n \\phi} = 0$ mode-by-mode, since the orthogonality ensures\n$$\ni^n J_n(k a) + A_n H_n^{(1)}(k a) = 0 \\quad \\Rightarrow \\quad A_n = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\nConsequently, the entire-domain Fourier–Galerkin Method of Moments solution using the single-layer potential is validated against the exact analytical solution for a PEC circular cylinder.\n\nAlgorithmic design:\n1. For given $a$ and $f$, compute $k = \\frac{2\\pi f}{c}$ and $k a$.\n2. For truncation $N$, enumerate $n \\in \\{-N, -N+1, \\dots, N\\}$.\n3. Compute $J_n(k a)$ and $H_n^{(1)}(k a)$ for each $n$ using reliable special function libraries.\n4. Compute the Galerkin single-layer eigenvalues $\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a)$.\n5. Compute the source density coefficients $q_n = - \\frac{i^n J_n(k a)}{\\lambda_n}$.\n6. Compute Method of Moments scattered-field coefficients $A_n^{\\text{MoM}} = \\frac{i}{4} (2\\pi a) q_n J_n(k a)$.\n7. Compute analytical coefficients $A_n^{\\text{analytical}} = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}$.\n8. Validate:\n   a. Coefficient validation: compute $\\max_n$ of the relative difference between $A_n^{\\text{MoM}}$ and $A_n^{\\text{analytical}}$ using a small $\\varepsilon$ to guard against division by zero.\n   b. Field validation: for prescribed angles and $r_{\\text{obs}}$, compute $E_z^{\\text{scat}}(r_{\\text{obs}},\\phi)$ from both sets of $A_n$ and take the maximum relative difference across angles.\n   c. Boundary-condition residual: for angles on the boundary, compute the residual $E_z^{\\text{inc}}(a,\\phi) + \\sum_{n=-N}^{N} A_n^{\\text{analytical}} H_n^{(1)}(k a) e^{i n \\phi}$ and normalize by the maximum incident magnitude across angles.\n\nNumerical considerations:\n- Use complex arithmetic for $A_n$, $H_n^{(1)}$, and $E_z^{\\text{scat}}$.\n- Exploit the symmetry $J_{-n}(x) = (-1)^n J_n(x)$ and $H_{-n}^{(1)}(x) = (-1)^n H_n^{(1)}(x)$; however, direct evaluation for negative integer orders is acceptable.\n- Choose $\\varepsilon = 10^{-15}$ to stabilize relative error divisions in the presence of near-zero denominators.\n\nThe program will compute three floating-point results for the specified test cases and print them in a single line as a comma-separated list in square brackets, for example, \"[1.0e-15,2.0e-15,0.0123]\". All angles are treated in radians, lengths in meters, frequencies in Hertz, and outputs are dimensionless.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, hankel1\n\nc = 299_792_458.0  # speed of light in m/s\n\ndef compute_coefficients(a, f, N):\n    \"\"\"\n    Compute MoM and analytical scattered-field coefficients A_n for n in [-N, N].\n    Returns arrays of n, A_mom, A_analytic, and ka.\n    \"\"\"\n    k = 2.0 * np.pi * f / c\n    ka = k * a\n    ns = np.arange(-N, N+1, dtype=int)\n    # Precompute Bessel and Hankel at ka for all n\n    J = np.array([jv(n, ka) for n in ns], dtype=np.complex128)\n    H = np.array([hankel1(n, ka) for n in ns], dtype=np.complex128)\n    # Eigenvalues of single-layer operator on the circle\n    lam = 1j * np.pi * a / 2.0 * J * H\n    # Incident coefficients: i^n J_n(ka)\n    i_pow_n = np.array([(1j)**n for n in ns], dtype=np.complex128)\n    Einc_n = i_pow_n * J\n    # Source density coefficients q_n from Galerkin EFIE\n    # Guard against division by zero in pathological cases\n    q = -Einc_n / lam\n    # MoM scattered-field coefficients via single-layer projection\n    A_mom = (1j / 4.0) * (2.0 * np.pi * a) * q * J\n    # Analytical coefficients from boundary condition\n    # A_n = - i^n J_n(ka) / H_n^{(1)}(ka)\n    A_analytic = -Einc_n / H\n    return ns, A_mom, A_analytic, ka, k\n\ndef coeff_validation_case(a, f, N, eps=1e-15):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    denom = np.maximum(np.abs(A_analytic), eps)\n    rel_err = np.abs(A_mom - A_analytic) / denom\n    return float(np.max(rel_err))\n\ndef field_validation_case(a, f, N, r_obs, angles, eps=1e-15):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    # Compute Hankel at observation radius\n    kr = k * r_obs\n    H_obs = np.array([hankel1(n, kr) for n in ns], dtype=np.complex128)\n    # Evaluate scattered fields for both methods\n    errs = []\n    for phi in angles:\n        exp_nphi = np.array([np.exp(1j * n * phi) for n in ns], dtype=np.complex128)\n        Es_mom = np.sum(A_mom * H_obs * exp_nphi)\n        Es_ana = np.sum(A_analytic * H_obs * exp_nphi)\n        denom = max(np.abs(Es_ana), eps)\n        errs.append(np.abs(Es_mom - Es_ana) / denom)\n    return float(np.max(errs))\n\ndef boundary_residual_case(a, f, N, angles):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    # Residual using analytical coefficients truncated to N at the boundary\n    # Residual(phi) = E_inc(a,phi) + sum_{n=-N}^N A_n H_n(ka) e^{i n phi}\n    H_boundary = np.array([hankel1(n, ka) for n in ns], dtype=np.complex128)\n    max_inc_mag = 0.0\n    max_resid = 0.0\n    for phi in angles:\n        E_inc = np.exp(1j * ka * np.cos(phi))\n        # Compute truncated field sum at boundary\n        exp_nphi = np.array([np.exp(1j * n * phi) for n in ns], dtype=np.complex128)\n        sum_trunc = np.sum(A_analytic * H_boundary * exp_nphi)\n        resid = E_inc + sum_trunc\n        max_inc_mag = max(max_inc_mag, np.abs(E_inc))\n        max_resid = max(max_resid, np.abs(resid))\n    # Normalize residual by max incident magnitude\n    if max_inc_mag == 0.0:\n        return float(max_resid)\n    return float(max_resid / max_inc_mag)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Coefficient validation (happy path)\n        {\n            \"type\": \"coeff\",\n            \"a\": 0.5,          # meters\n            \"f\": 3.0e8,        # Hz\n            \"N\": 40\n        },\n        # Case 2: Field validation at finite observation radius\n        {\n            \"type\": \"farfield\",\n            \"a\": 0.35,         # meters\n            \"f\": 1.2e9,        # Hz\n            \"N\": 60,\n            \"r_obs_multiplier\": 10.0,\n            \"angles\": [2.0*np.pi*m/16.0 for m in range(16)]\n        },\n        # Case 3: Boundary-condition residual under truncation (edge case)\n        {\n            \"type\": \"boundary\",\n            \"a\": 0.02,         # meters\n            \"ka_target\": 0.5,  # choose f so that k*a = 0.5\n            \"N\": 5,\n            \"angles\": [2.0*np.pi*m/64.0 for m in range(64)]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[\"type\"] == \"coeff\":\n            a = case[\"a\"]\n            f = case[\"f\"]\n            N = case[\"N\"]\n            result = coeff_validation_case(a, f, N)\n            results.append(result)\n        elif case[\"type\"] == \"farfield\":\n            a = case[\"a\"]\n            f = case[\"f\"]\n            N = case[\"N\"]\n            r_obs = case[\"r_obs_multiplier\"] * a\n            angles = case[\"angles\"]\n            result = field_validation_case(a, f, N, r_obs, angles)\n            results.append(result)\n        elif case[\"type\"] == \"boundary\":\n            a = case[\"a\"]\n            ka_target = case[\"ka_target\"]\n            # f = (ka_target * c) / (2*pi*a)\n            f = (ka_target * c) / (2.0 * np.pi * a)\n            N = case[\"N\"]\n            angles = case[\"angles\"]\n            result = boundary_residual_case(a, f, N, angles)\n            results.append(result)\n        else:\n            results.append(float(\"nan\"))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving beyond fixed basis sets, the real power of modern numerical methods lies in their ability to adapt to the problem at hand, placing computational effort only where it is needed most. This practice explores the construction of hierarchical, entire-domain vector basis functions, which are essential for representing surface currents in full-wave electromagnetic problems . You will derive a residual-based a posteriori error estimator, a critical tool that quantifies the error in your solution and guides an adaptive refinement strategy, paving the way for highly efficient and accurate solvers.",
            "id": "3305820",
            "problem": "Consider a smooth closed surface $S$ equal to the unit sphere embedded in free space, and a time-harmonic electromagnetic illumination at angular frequency $\\omega$ with wavenumber $k$. Let the surface be a Perfect Electric Conductor (PEC). The total electric field $\\mathbf{E}_{\\text{tot}}$ satisfies the PEC boundary condition $\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{tot}} = \\mathbf{0}$ on $S$, where $\\hat{\\mathbf{n}}$ is the outward unit normal. Using the Electric Field Integral Equation (EFIE), the scattered field due to a tangential surface current density $\\mathbf{J}$ is written as $\\mathbf{E}_{\\text{scat}} = \\mathcal{L}_k \\mathbf{J}$, with the boundary equation $\\mathcal{L}_k \\mathbf{J} = -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}$, where $\\mathcal{L}_k$ is the EFIE boundary integral operator on $S$ and $\\mathbf{E}_{\\text{inc}}$ is the incident field.\n\nYou will construct a hierarchical entire-domain basis for $\\mathbf{J}$ on $S$ that is tangentially conforming, and derive a residual-based a posteriori error estimator guiding global degree elevation (i.e., $p$-adaptivity) across the whole surface. Work in dimensionless normalized units in which the inner products are scaled to make the basis orthonormal and the operator $\\mathcal{L}_k$ acts diagonally on the chosen basis with dimensionless eigenvalues.\n\nTasks:\n1) Starting from spherical harmonics $Y_{l}^{m}$ on the unit sphere and the surface gradient operator $\\nabla_{S}$, define two families of tangential entire-domain vector basis functions\n$$\n\\mathbf{T}_{l m} := \\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}, \\qquad\n\\mathbf{P}_{l m} := \\nabla_{S} Y_{l}^{m},\n$$\nfor integers $l \\geq 1$ and $-l \\leq m \\leq l$, where $\\hat{\\mathbf{r}}$ is the radial unit vector. Explain why these functions are tangential on $S$ and describe the hierarchy with respect to the degree $l$ that enables $p$-adaptivity. Assume the sets $\\{\\mathbf{T}_{l m}\\}$ and $\\{\\mathbf{P}_{l m}\\}$ are orthonormal in the chosen inner product and span nested spaces $V_{p}$ as $p$ increases.\n\n2) Using the PEC boundary condition and the EFIE, define the Galerkin problem for $\\mathbf{J}_{p} \\in V_{p}$ and the residual $\\mathbf{R}_{p} := -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}} - \\mathcal{L}_k \\mathbf{J}_{p}$. Under the assumption that $\\mathcal{L}_k$ is diagonal in the above basis, with eigenvalues $\\alpha_{l}$ on $\\mathbf{T}_{l m}$ and $\\beta_{l}$ on $\\mathbf{P}_{l m}$ (both depending on $k$ and $l$), derive from first principles an a posteriori estimator for the error in the energy norm induced by $\\mathcal{L}_k$, expressed entirely in terms of the expansion coefficients of $\\mathbf{R}_{p}$ in the enrichment space $V_{p+1} \\setminus V_{p}$. Your derivation must start from the EFIE and boundary condition and proceed to the estimator without introducing any target shortcut formulas.\n\n3) Consider $p = 2$, and suppose the nonzero residual coefficients at level $l = 3$ are limited to three toroidal and three poloidal modes:\n$$\nr^{T}_{3,-1} = 0.03,\\quad r^{T}_{3,0} = -0.04,\\quad r^{T}_{3,1} = 0.05,\n$$\n$$\nr^{P}_{3,-1} = 0.02,\\quad r^{P}_{3,0} = -0.01,\\quad r^{P}_{3,1} = 0.00,\n$$\nwith all other $r^{T}_{3,m}$ and $r^{P}_{3,m}$ equal to $0$. Assume the diagonal action of $\\mathcal{L}_k$ on the level $l = 3$ modes is given by\n$$\n\\mathcal{L}_k \\mathbf{T}_{3 m} = \\alpha_{3} \\mathbf{T}_{3 m},\\quad \\alpha_{3} = 5, \\qquad\n\\mathcal{L}_k \\mathbf{P}_{3 m} = \\beta_{3} \\mathbf{P}_{3 m},\\quad \\beta_{3} = 6.\n$$\nUsing your estimator from Task 2, evaluate the global a posteriori error estimator (energy-norm of the error) associated with elevating the polynomial degree from $p = 2$ to include the $l = 3$ modes. Round your final answer to four significant figures. Because all quantities are normalized, report the estimator as a dimensionless number.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and internally consistent. It presents a canonical problem in computational electromagnetics involving the method of moments with entire-domain basis functions on a sphere. The assumptions, such as the diagonality of the integral operator with respect to the vector spherical harmonic basis, are correct for the specified geometry. We may, therefore, proceed with a full solution.\n\n### Task 1: Basis Functions and Hierarchy\n\nThe problem defines two families of vector basis functions on the unit sphere $S$ using spherical harmonics $Y_{l}^{m}$:\n$$\n\\mathbf{T}_{l m} := \\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}\n$$\n$$\n\\mathbf{P}_{l m} := \\nabla_{S} Y_{l}^{m}\n$$\nwhere $l \\geq 1$ and $-l \\leq m \\leq l$. Here, $\\hat{\\mathbf{r}}$ is the radial unit vector, which is equivalent to the outward unit normal $\\hat{\\mathbf{n}}$ for the unit sphere, and $\\nabla_{S}$ is the surface gradient operator. These functions are, up to normalization constants, the vector spherical harmonics.\n\nA vector field $\\mathbf{V}$ is tangential to the sphere $S$ if its radial component is zero, i.e., if $\\hat{\\mathbf{r}} \\cdot \\mathbf{V} = 0$. We verify this condition for both families.\n\nFor the poloidal functions $\\mathbf{P}_{l m}$:\nThe surface gradient operator $\\nabla_{S}$ on a sphere, when applied to a scalar field, produces a vector field that is, by definition, everywhere tangent to the sphere's surface. Therefore, the vector field $\\mathbf{P}_{l m} = \\nabla_{S} Y_{l}^{m}$ is inherently tangential, and $\\hat{\\mathbf{r}} \\cdot \\mathbf{P}_{l m} = 0$.\n\nFor the toroidal functions $\\mathbf{T}_{l m}$:\nThe function $\\mathbf{T}_{l m}$ is defined by the cross product $\\hat{\\mathbf{r}} \\times \\mathbf{P}_{l m}$. The resulting vector from a cross product is orthogonal to both of the original vectors. Thus, $\\mathbf{T}_{l m}$ must be orthogonal to $\\hat{\\mathbf{r}}$. We can show this explicitly using the scalar triple product property:\n$$\n\\hat{\\mathbf{r}} \\cdot \\mathbf{T}_{l m} = \\hat{\\mathbf{r}} \\cdot (\\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}) = (\\hat{\\mathbf{r}} \\times \\hat{\\mathbf{r}}) \\cdot \\nabla_{S} Y_{l}^{m} = \\mathbf{0} \\cdot \\nabla_{S} Y_{l}^{m} = 0\n$$\nSince the radial component is zero, $\\mathbf{T}_{l m}$ is also a tangential vector field on the surface $S$.\n\nThese two families of functions, $\\{\\mathbf{T}_{l m}\\}$ and $\\{\\mathbf{P}_{l m}\\}$, form a complete, orthogonal basis for tangential vector fields on the sphere.\n\nThe hierarchy for $p$-adaptivity is established through the degree $l$ of the spherical harmonics. We can define a sequence of nested finite-dimensional vector spaces $V_p$ by including all basis functions up to a certain maximum degree $p$. Specifically, for a given polynomial order $p$, the space $V_p$ is defined as:\n$$\nV_p = \\text{span} \\left\\{ \\mathbf{T}_{l'm}, \\mathbf{P}_{l'm} \\mid 1 \\leq l' \\leq p, -l' \\leq m \\leq l' \\right\\}\n$$\nThis construction ensures that $V_1 \\subset V_2 \\subset \\dots \\subset V_p \\subset V_{p+1} \\subset \\dots$. The process of $p$-refinement, or degree elevation, consists of enriching the approximation space from $V_p$ to $V_{p+1}$ by adding the set of basis functions corresponding to the degree $l = p+1$. The error estimator to be derived will quantify the expected improvement from this enrichment.\n\n### Task 2: Derivation of the A Posteriori Error Estimator\n\nThe Electric Field Integral Equation (EFIE) boundary condition for the surface current $\\mathbf{J}$ on the PEC surface $S$ is given by:\n$$\n\\mathcal{L}_k \\mathbf{J} = -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}\n$$\nLet us denote the right-hand side, which is the known forcing function, as $\\mathbf{f} \\equiv -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}$. The problem is to find $\\mathbf{J}$ such that $\\mathcal{L}_k \\mathbf{J} = \\mathbf{f}$.\n\nIn the Galerkin method, we seek an approximate solution $\\mathbf{J}_p$ in the finite-dimensional space $V_p$. The Galerkin projection of the equation onto $V_p$ requires that the residual is orthogonal to the trial space. We define the inner product on the surface as $\\langle \\mathbf{A}, \\mathbf{B} \\rangle = \\int_S \\mathbf{A}^*(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r}) dS$. The Galerkin problem is: find $\\mathbf{J}_p \\in V_p$ such that\n$$\n\\langle \\mathbf{v}_p, \\mathcal{L}_k \\mathbf{J}_p \\rangle = \\langle \\mathbf{v}_p, \\mathbf{f} \\rangle \\qquad \\forall \\mathbf{v}_p \\in V_p\n$$\nThe residual of the approximation $\\mathbf{J}_p$ is defined as $\\mathbf{R}_p := \\mathbf{f} - \\mathcal{L}_k \\mathbf{J}_p$. The Galerkin condition is equivalent to stating that the residual is orthogonal to the space $V_p$:\n$$\n\\langle \\mathbf{v}_p, \\mathbf{R}_p \\rangle = 0 \\qquad \\forall \\mathbf{v}_p \\in V_p\n$$\nThe error in the solution is $\\mathbf{e}_p := \\mathbf{J} - \\mathbf{J}_p$. Applying the operator $\\mathcal{L}_k$ to the error yields the error-residual equation:\n$$\n\\mathcal{L}_k \\mathbf{e}_p = \\mathcal{L}_k (\\mathbf{J} - \\mathbf{J}_p) = \\mathcal{L}_k \\mathbf{J} - \\mathcal{L}_k \\mathbf{J}_p = \\mathbf{f} - \\mathcal{L}_k \\mathbf{J}_p = \\mathbf{R}_p\n$$\nThe energy norm of the error is defined as $\\|\\mathbf{e}_p\\|_{\\mathcal{L}_k}^2 = \\langle \\mathcal{L}_k \\mathbf{e}_p, \\mathbf{e}_p \\rangle$. Assuming the operator $\\mathcal{L}_k$ is self-adjoint, we can write:\n$$\n\\|\\mathbf{e}_p\\|_{\\mathcal{L}_k}^2 = \\langle \\mathbf{R}_p, \\mathbf{e}_p \\rangle\n$$\nThe core principle of a posteriori error estimation is to approximate the unknown error $\\mathbf{e}_p$ using information available from the computed solution. We approximate $\\mathbf{e}_p$ by its projection onto the enrichment space $W_p := V_{p+1} \\ominus V_p$. Let this approximation be $\\delta\\mathbf{J} \\in W_p$. We determine $\\delta\\mathbf{J}$ by solving a local problem in $W_p$, which is a Galerkin projection of the error-residual equation onto $W_p$:\n$$\n\\langle \\mathbf{w}, \\mathcal{L}_k \\delta\\mathbf{J} \\rangle = \\langle \\mathbf{w}, \\mathbf{R}_p \\rangle \\qquad \\forall \\mathbf{w} \\in W_p\n$$\nThe space $W_p$ is spanned by the orthonormal basis functions $\\{\\mathbf{T}_{(p+1)m}, \\mathbf{P}_{(p+1)m} \\mid - (p+1) \\leq m \\leq p+1\\}$. Let's denote these basis functions generally by $\\{\\psi_j\\}$. We expand the error approximation $\\delta\\mathbf{J}$ and the residual $\\mathbf{R}_p$ in this basis:\n$$\n\\delta\\mathbf{J} = \\sum_{j} c_j \\psi_j \\qquad \\text{and} \\qquad \\mathbf{R}_p = \\sum_{j} r_j \\psi_j + (\\text{higher order terms})\n$$\nThe residual coefficients $r_j$ are computable since $\\mathbf{R}_p$ is known: $r_j = \\langle \\psi_j, \\mathbf{R}_p \\rangle$. Note that the expansion of $\\mathbf{R}_p$ has no components in $V_p$ due to Galerkin orthogonality.\n\nSubstituting the expansions into the local problem for $\\delta\\mathbf{J}$ gives:\n$$\n\\left\\langle \\psi_i, \\mathcal{L}_k \\sum_j c_j \\psi_j \\right\\rangle = \\left\\langle \\psi_i, \\sum_j r_j \\psi_j \\right\\rangle\n$$\nUsing the linearity of the inner product and the operator, and the orthonormality of the basis $\\{\\psi_j\\}$:\n$$\n\\sum_j c_j \\langle \\psi_i, \\mathcal{L}_k \\psi_j \\rangle = \\sum_j r_j \\langle \\psi_i, \\psi_j \\rangle = r_i\n$$\nThe problem states that the operator $\\mathcal{L}_k$ is diagonal in this basis, so $\\mathcal{L}_k \\psi_j = \\lambda_j \\psi_j$, where $\\lambda_j$ is the corresponding eigenvalue ($\\alpha_{p+1}$ or $\\beta_{p+1}$).\n$$\n\\sum_j c_j \\lambda_j \\langle \\psi_i, \\psi_j \\rangle = \\sum_j c_j \\lambda_j \\delta_{ij} = c_i \\lambda_i = r_i\n$$\nThus, the coefficients of the error approximation are $c_i = r_i / \\lambda_i$.\n\nThe a posteriori error estimator $\\eta_p$ is defined as the energy norm of this error approximation $\\delta\\mathbf{J}$:\n$$\n\\eta_p^2 := \\|\\delta\\mathbf{J}\\|_{\\mathcal{L}_k}^2 = \\langle \\mathcal{L}_k \\delta\\mathbf{J}, \\delta\\mathbf{J} \\rangle = \\left\\langle \\mathcal{L}_k \\sum_j c_j \\psi_j, \\sum_i c_i \\psi_i \\right\\rangle\n$$\n$$\n\\eta_p^2 = \\sum_i \\sum_j c_j c_i^* \\langle \\mathcal{L}_k \\psi_j, \\psi_i \\rangle = \\sum_i \\sum_j c_j c_i^* \\lambda_j \\langle \\psi_j, \\psi_i \\rangle\n$$\nAssuming the eigenvalues are real, and using orthonormality:\n$$\n\\eta_p^2 = \\sum_j |c_j|^2 \\lambda_j\n$$\nSubstituting $c_j = r_j / \\lambda_j$:\n$$\n\\eta_p^2 = \\sum_j \\left| \\frac{r_j}{\\lambda_j} \\right|^2 \\lambda_j = \\sum_j \\frac{|r_j|^2}{\\lambda_j}\n$$\nThis sum is taken over all basis functions in the enrichment space $W_p$. Separating the sum into the toroidal and poloidal contributions from degree $l=p+1$:\n$$\n\\eta_p^2 = \\sum_{m=-(p+1)}^{p+1} \\frac{| \\langle \\mathbf{T}_{(p+1)m}, \\mathbf{R}_p \\rangle |^2}{\\alpha_{p+1}} + \\sum_{m=-(p+1)}^{p+1} \\frac{| \\langle \\mathbf{P}_{(p+1)m}, \\mathbf{R}_p \\rangle |^2}{\\beta_{p+1}}\n$$\nWith the notation $r^{T}_{(p+1)m} = \\langle \\mathbf{T}_{(p+1)m}, \\mathbf{R}_p \\rangle$ and $r^{P}_{(p+1)m} = \\langle \\mathbf{P}_{(p+1)m}, \\mathbf{R}_p \\rangle$, the estimator for the squared energy norm of the error is:\n$$\n\\eta_p^2 = \\frac{1}{\\alpha_{p+1}} \\sum_{m=-(p+1)}^{p+1} |r^{T}_{(p+1)m}|^2 + \\frac{1}{\\beta_{p+1}} \\sum_{m=-(p+1)}^{p+1} |r^{P}_{(p+1)m}|^2\n$$\n\n### Task 3: Calculation\n\nWe are asked to evaluate the global a posteriori error estimator $\\eta_p$ for $p=2$. This requires using the residual coefficients projected onto the enrichment space $W_2$, which is spanned by the basis functions with degree $l=p+1=3$. The formula derived in Task 2 becomes:\n$$\n\\eta_2^2 = \\frac{1}{\\alpha_{3}} \\sum_{m=-3}^{3} |r^{T}_{3m}|^2 + \\frac{1}{\\beta_{3}} \\sum_{m=-3}^{3} |r^{P}_{3m}|^2\n$$\nThe provided data are:\n- Nonzero toroidal residual coefficients for $l=3$: $r^{T}_{3,-1} = 0.03$, $r^{T}_{3,0} = -0.04$, $r^{T}_{3,1} = 0.05$.\n- Nonzero poloidal residual coefficients for $l=3$: $r^{P}_{3,-1} = 0.02$, $r^{P}_{3,0} = -0.01$, $r^{P}_{3,1} = 0.00$.\n- Eigenvalues for $l=3$: $\\alpha_{3} = 5$ and $\\beta_{3} = 6$.\n\nFirst, we compute the sum of the squared magnitudes of the coefficients for each family:\nSum for toroidal modes:\n$$\n\\sum_{m=-3}^{3} |r^{T}_{3m}|^2 = |0.03|^2 + |-0.04|^2 + |0.05|^2 = 0.0009 + 0.0016 + 0.0025 = 0.0050\n$$\nSum for poloidal modes:\n$$\n\\sum_{m=-3}^{3} |r^{P}_{3m}|^2 = |0.02|^2 + |-0.01|^2 + |0.00|^2 = 0.0004 + 0.0001 + 0.0000 = 0.0005\n$$\nNow, substitute these sums into the expression for $\\eta_2^2$:\n$$\n\\eta_2^2 = \\frac{0.0050}{5} + \\frac{0.0005}{6} = 0.0010 + 0.00008333\\overline{3} = 0.00108333\\overline{3}\n$$\nThe error estimator $\\eta_2$ is the square root of this value:\n$$\n\\eta_2 = \\sqrt{0.00108333\\overline{3}} \\approx 0.032914028...\n$$\nRounding this result to four significant figures gives $0.03291$.",
            "answer": "$$\\boxed{0.03291}$$"
        },
        {
            "introduction": "A frequent and significant challenge in using integral equations for scattering problems is the severe ill-conditioning that can arise, particularly at low frequencies or when fine details are modeled. This advanced practice uses the spectral viewpoint afforded by entire-domain bases on a sphere to analyze the source of this instability . By deriving the eigenvalues of the fundamental boundary integral operators, you will explore how the profound mathematical structure of Calderón identities can be leveraged to formulate a naturally well-conditioned system, a technique known as Calderón preconditioning that is indispensable for robust, large-scale simulations.",
            "id": "3305837",
            "problem": "Consider time-harmonic scalar wave scattering in three dimensions governed by the Helmholtz equation. Let $\\Gamma$ be the surface of a sphere of radius $a>0$, and let $k>0$ be the free-space wavenumber. Define the following boundary integral operators on $\\Gamma$ built from the Helmholtz Green’s function $G_k(\\mathbf{x},\\mathbf{y}) = \\exp(i k \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)/(4\\pi \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)$:\n\n- The single-layer operator $S_k$ acting on a surface density $\\varphi$ via $(S_k \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x},\\mathbf{y}) \\,\\varphi(\\mathbf{y}) \\, dS_{\\mathbf{y}}$.\n- The adjoint double-layer operator $K_k'$ acting through the averaged normal derivative of the single-layer potential.\n- The hypersingular operator $W_k$ acting on boundary traces of potentials.\n\nOn a sphere, the spherical harmonics $Y_{\\ell}^m(\\theta,\\phi)$ for $\\ell \\in \\{0,1,2,\\dots\\}$ and $m \\in \\{-\\ell,\\dots,\\ell\\}$ form an orthonormal entire-domain basis that diagonalizes the operators $S_k$, $K_k'$, and $W_k$. Let $L$ be a nonnegative integer truncation index. Denote by $v_{\\ell}$ the eigenvalues of $S_k$ and by $\\kappa_{\\ell}'$ the eigenvalues of $K_k'$ corresponding to the subspace spanned by all $Y_{\\ell}^m$ with a fixed $\\ell$ (the eigenvalues do not depend on $m$). The Calderón identities state that these operators satisfy composition relations on smooth closed surfaces, in particular that $W_k S_k = K_k'^2 - \\tfrac{1}{4} I$ in the appropriate functional setting.\n\nStarting only from the fundamental laws and core definitions listed below, you must derive from first principles the spectral forms of the operators on the sphere $\\Gamma$ and design a numerically stable algorithm to evaluate:\n- the condition number of the truncated single-layer operator,\n- the condition number of the Calderón-regularized operator built from the composition $W_k S_k + \\tfrac{1}{4} I$.\n\nBase set of fundamental laws and definitions to use:\n- The Helmholtz equation $\\Delta u + k^2 u = 0$ for radiating solutions and its representation via boundary layer potentials constructed from $G_k$.\n- The addition theorem for spherical harmonics and separation of variables for spherical geometry.\n- The jump relations for the normal derivatives of layer potentials across $\\Gamma$.\n- The spherical Bessel and Hankel functions as the radial parts of separable solutions in spherical coordinates, and their basic Wronskian identity.\n\nYour program must implement the following, using the entire-domain basis $\\{Y_{\\ell}^m\\}$ truncated at degree $L$:\n1. Compute the eigenvalues $\\{v_{\\ell}\\}_{\\ell=0}^L$ of the single-layer operator $S_k$ on the sphere of radius $a$.\n2. Compute the eigenvalues $\\{\\kappa_{\\ell}'\\}_{\\ell=0}^L$ of the adjoint double-layer operator $K_k'$ on the same sphere.\n3. Form the Calderón-regularized operator whose eigenvalues are $\\{\\kappa_{\\ell}'^{\\,2}\\}_{\\ell=0}^L$, using the identity $W_k S_k = K_k'^2 - \\tfrac{1}{4} I$ to eliminate $W_k$.\n4. For each test case below, report:\n   - the condition number of $S_k$ on the truncated basis, defined as $\\max_{\\ell \\in \\{0,\\dots,L\\}} |v_{\\ell}| \\big/ \\min_{\\ell \\in \\{0,\\dots,L\\}} |v_{\\ell}|$,\n   - the condition number of the Calderón-regularized operator $W_k S_k + \\tfrac{1}{4} I = K_k'^2$, defined as $\\max_{\\ell \\in \\{0,\\dots,L\\}} |\\kappa_{\\ell}'|^2 \\big/ \\min_{\\ell \\in \\{0,\\dots,L\\}} |\\kappa_{\\ell}'|^2$,\n   - the improvement factor, defined as the ratio of the two condition numbers.\n\nAll quantities in this problem are dimensionless or combinations of $a$ and $k$ appearing in the dimensionless product $k a$, so no physical unit is required in the output. Angles, where needed internally, are understood to be in radians.\n\nTest suite to implement, where each test case is a triple $(a,k,L)$:\n- Test 1 (happy path): $(1.0,\\,0.3,\\,8)$\n- Test 2 (moderate frequency, larger truncation): $(1.0,\\,2.0,\\,20)$\n- Test 3 (high frequency, higher truncation): $(1.0,\\,10.0,\\,35)$\n- Test 4 (boundary truncation case): $(1.0,\\,0.5,\\,0)$\n\nYour program should produce a single line of output containing the results for the four test cases as a comma-separated list of lists enclosed in square brackets, where each inner list contains three floating-point numbers in the order [condition_number_S, condition_number_regularized, improvement_factor]. For example, the output format must be like:\n[[cS1,cR1,imp1],[cS2,cR2,imp2],[cS3,cR3,imp3],[cS4,cR4,imp4]]",
            "solution": "The problem statement is a well-posed and scientifically sound exercise in the spectral theory of boundary integral operators for the Helmholtz equation in a spherical geometry. It requires the derivation of eigenvalues for the single-layer and adjoint double-layer operators using an entire-domain basis of spherical harmonics. The problem is valid and we may proceed with the solution.\n\nThe core of the problem is to determine the eigenvalues of the operators $S_k$ and $K_k'$ on a sphere $\\Gamma$ of radius $a$. These operators are diagonalized by the basis of spherical harmonics, $\\{Y_{\\ell}^m\\}$. We derive the corresponding eigenvalues, denoted $v_{\\ell}$ and $\\kappa_{\\ell}'$, from first principles.\n\n**1. Eigenvalues of the Single-Layer Operator ($S_k$)**\n\nThe single-layer operator $S_k$ acts on a surface density $\\varphi$ as:\n$$ (S_k \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x},\\mathbf{y}) \\,\\varphi(\\mathbf{y}) \\, dS_{\\mathbf{y}} $$\nwhere $G_k(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp(i k \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)}{4\\pi \\lVert \\mathbf{x}-\\mathbf{y} \\rVert}$ is the free-space Green's function for the Helmholtz equation. To find the eigenvalues $v_{\\ell}$, we let $\\varphi$ be a spherical harmonic, $\\varphi(\\mathbf{y}) = Y_{\\ell}^m(\\hat{\\mathbf{y}})$, where $\\hat{\\mathbf{y}}$ is the direction vector for the point $\\mathbf{y}$ on the sphere.\n\nFor both $\\mathbf{x}$ and $\\mathbf{y}$ on the sphere $\\Gamma$ ($|\\mathbf{x}| = |\\mathbf{y}| = a$), the Green's function can be expanded using the addition theorem for spherical waves:\n$$ G_k(\\mathbf{x},\\mathbf{y}) = ik \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\overline{Y_n^p(\\hat{\\mathbf{y}})} $$\nwhere $j_n$ and $h_n^{(1)}$ are the spherical Bessel and Hankel functions of the first kind, respectively.\n\nSubstituting this expansion into the operator definition, with $\\varphi(\\mathbf{y}) = Y_{\\ell}^m(\\hat{\\mathbf{y}})$ and the surface element $dS_{\\mathbf{y}} = a^2 d\\Omega_{\\mathbf{y}}$:\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = \\int_{\\Omega} \\left( ik \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\overline{Y_n^p(\\hat{\\mathbf{y}})} \\right) Y_{\\ell}^m(\\hat{\\mathbf{y}}) \\, a^2 d\\Omega_{\\mathbf{y}} $$\nwhere the integral is over the unit sphere's solid angle $\\Omega$. Interchanging summation and integration:\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = ik a^2 \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\int_{\\Omega} \\overline{Y_n^p(\\hat{\\mathbf{y}})} Y_{\\ell}^m(\\hat{\\mathbf{y}}) d\\Omega_{\\mathbf{y}} $$\nBy the orthonormality of spherical harmonics, $\\int_{\\Omega} \\overline{Y_n^p} Y_{\\ell}^m d\\Omega = \\delta_{n\\ell} \\delta_{pm}$. The double summation collapses to a single term where $n=\\ell$ and $p=m$:\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = \\left( ik a^2 j_{\\ell}(ka) h_{\\ell}^{(1)}(ka) \\right) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\nThus, the eigenvalues $v_{\\ell}$ of the single-layer operator $S_k$, which are independent of the index $m$, are:\n$$ v_{\\ell} = ik a^2 j_{\\ell}(ka) h_{\\ell}^{(1)}(ka) $$\n\n**2. Eigenvalues of the Adjoint Double-Layer Operator ($K_k'$)**\n\nThe operator $K_k'$ is defined via the averaged normal derivative of the single-layer potential $u = S_k \\varphi$. Let $\\varphi = Y_{\\ell}^m$. The potential $u(\\mathbf{x}) = (S_k Y_{\\ell}^m)(\\mathbf{x})$ is a radiating solution to the Helmholtz equation for $|\\mathbf{x}| > a$ and a regular solution for $|\\mathbf{x}| < a$. Using separation of variables, the potential can be expressed as:\n$$ u(\\mathbf{x}) = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) \\begin{cases} j_{\\ell}(ka) h_{\\ell}^{(1)}(kr) & r > a \\\\ h_{\\ell}^{(1)}(ka) j_{\\ell}(kr) & r < a \\end{cases} $$\nwhere $r=|\\mathbf{x}|$. The outward unit normal is $\\mathbf{n} = \\hat{\\mathbf{r}}$, so the normal derivative is $\\frac{\\partial}{\\partial n} = \\frac{\\partial}{\\partial r}$. The exterior (+) and interior (-) limits of the normal derivative on $\\Gamma$ are:\n$$ \\frac{\\partial u}{\\partial n}\\bigg|_{+} = \\frac{\\partial u}{\\partial r}\\bigg|_{r=a^+} = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) j_{\\ell}(ka) \\left[k \\frac{d}{d(kr)} h_{\\ell}^{(1)}(kr)\\right]_{r=a} = ik^2 a^2 j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\n$$ \\frac{\\partial u}{\\partial n}\\bigg|_{-} = \\frac{\\partial u}{\\partial r}\\bigg|_{r=a^-} = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) h_{\\ell}^{(1)}(ka) \\left[k \\frac{d}{d(kr)} j_{\\ell}(kr)\\right]_{r=a} = ik^2 a^2 h_{\\ell}^{(1)}(ka) j_{\\ell}^{\\prime}(ka) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\nwhere the prime denotes differentiation with respect to the argument. The operator $K_k'$ is the average of these two limits:\n$$ (K_k' Y_{\\ell}^m)(\\mathbf{x}) = \\frac{1}{2} \\left(\\frac{\\partial u}{\\partial n}\\bigg|_{+} + \\frac{\\partial u}{\\partial n}\\bigg|_{-}\\right) $$\nSubstituting the derivative expressions yields:\n$$ (K_k' Y_{\\ell}^m)(\\mathbf{x}) = \\left( \\frac{1}{2} ik^2 a^2 \\left[ j_{\\ell}'(ka) h_{\\ell}^{(1)}(ka) + j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) \\right] \\right) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\nThe eigenvalues $\\kappa_{\\ell}'$ of the adjoint double-layer operator $K_k'$ are therefore:\n$$ \\kappa_{\\ell}' = \\frac{1}{2} i (ka)^2 \\left[ j_{\\ell}'(ka) h_{\\ell}^{(1)}(ka) + j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) \\right] $$\n\n**3. Calderón Regularization and Condition Numbers**\n\nThe problem requires analyzing the operator $W_k S_k + \\frac{1}{4}I$. The provided Calderón identity states $W_k S_k = K_k'^2 - \\frac{1}{4}I$. Therefore, the regularized operator is simply $K_k'^2$. Since $Y_{\\ell}^m$ are eigenfunctions of $K_k'$ with eigenvalues $\\kappa_{\\ell}'$, they are also eigenfunctions of $K_k'^2$ with eigenvalues $(\\kappa_{\\ell}')^2$.\n\nThe condition number of a linear operator represented as a matrix is the ratio of its largest to smallest singular values. In the basis $\\{Y_{\\ell}^m\\}_{\\ell=0,..,L}$, the operators $S_k$ and $K_k'^2$ are represented by diagonal matrices with entries $\\{v_{\\ell}\\}$ and $\\{(\\kappa_{\\ell}')^2\\}$, respectively (with multiplicities $2\\ell+1$). The singular values are the magnitudes of these eigenvalues.\n\nThe condition number of the truncated single-layer operator $S_k$ is:\n$$ \\text{cond}(S_k) = \\frac{\\max_{\\ell \\in \\{0, \\dots, L\\}} |v_{\\ell}|}{\\min_{\\ell \\in \\{0, \\dots, L\\}} |v_{\\ell}|} $$\n\nThe condition number of the Calderón-regularized operator $K_k'^2$ is:\n$$ \\text{cond}(K_k'^2) = \\frac{\\max_{\\ell \\in \\{0, \\dots, L\\}} |(\\kappa_{\\ell}')^2|}{\\min_{\\ell \\in \\{0, \\dots, L\\}} |(\\kappa_{\\ell}')^2|} = \\frac{\\left(\\max_{\\ell \\in \\{0, \\dots, L\\}} |\\kappa_{\\ell}'|\\right)^2}{\\left(\\min_{\\ell \\in \\{0, \\dots, L\\}} |\\kappa_{\\ell}'|\\right)^2} $$\n\nThe improvement factor is the ratio of these two condition numbers, $\\text{cond}(S_k) / \\text{cond}(K_k'^2)$.\n\n**4. Algorithmic Implementation**\n\nThe numerical evaluation proceeds as follows:\nFor each test case $(a, k, L)$:\n1.  Define the argument $z = ka$.\n2.  For each integer order $\\ell$ from $0$ to $L$:\n    a. Compute the spherical Bessel functions $j_{\\ell}(z)$, $j_{\\ell}'(z)$ and the spherical Neumann functions $y_{\\ell}(z)$, $y_{\\ell}'(z)$ using a robust library such as `scipy.special`.\n    b. Construct the spherical Hankel functions $h_{\\ell}^{(1)}(z) = j_{\\ell}(z) + i y_{\\ell}(z)$ and their derivatives $h_{\\ell}^{(1)\\prime}(z) = j_{\\ell}'(z) + i y_{\\ell}'(z)$.\n    c. Evaluate the eigenvalues $v_{\\ell}$ and $\\kappa_{\\ell}'$ using the derived formulas.\n3.  Form the arrays of absolute values $|v_0|, \\dots, |v_L|$ and $|\\kappa'_0|^2, \\dots, |\\kappa'_L|^2$.\n4.  Compute the condition numbers by finding the maximum and minimum values in these arrays and taking their ratios.\n5.  Compute the improvement factor.\n\nFor the special case $L=0$, the basis consists of a single function. The resulting operator matrices are $1 \\times 1$, and their condition numbers are trivially $1$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing condition numbers for boundary integral operators on a sphere.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (a, k, L).\n    test_cases = [\n        (1.0, 0.3, 8),\n        (1.0, 2.0, 20),\n        (1.0, 10.0, 35),\n        (1.0, 0.5, 0),\n    ]\n\n    results = []\n    for a, k, L in test_cases:\n        # For L=0, the basis contains a single function space. The condition\n        # number of any operator represented in this basis is trivially 1.\n        if L == 0:\n            results.append([1.0, 1.0, 1.0])\n            continue\n\n        # Wavenumber-radius product\n        z = k * a\n        # Array of spherical harmonic degrees\n        ells = np.arange(L + 1)\n\n        # Compute spherical Bessel and Neumann functions of orders 0 to L\n        # The sph_jn(L, z) call returns an array of values for n=0..L\n        j_l = spherical_jn(ells, z)\n        y_l = spherical_yn(ells, z)\n\n        # Compute derivatives of spherical Bessel and Neumann functions\n        # The derivative call in scipy requires a loop over orders.\n        j_l_prime = np.array([spherical_jn(l, z, derivative=True) for l in ells])\n        y_l_prime = np.array([spherical_yn(l, z, derivative=True) for l in ells])\n\n        # Construct spherical Hankel functions and their derivatives\n        # h_l^(1)(z) = j_l(z) + i * y_l(z)\n        h1_l = j_l + 1j * y_l\n        h1_l_prime = j_l_prime + 1j * y_l_prime\n\n        # 1. Compute eigenvalues {v_l} of the single-layer operator S_k\n        # v_l = i * k * a^2 * j_l(ka) * h_l^(1)(ka)\n        v_l_vals = 1j * k * a**2 * j_l * h1_l\n\n        # 2. Compute eigenvalues {kappa'_l} of the adjoint double-layer operator K'_k\n        # kappa'_l = 0.5 * i * (ka)^2 * (j_l'(ka)h_l^(1)(ka) + j_l(ka)h_l^(1)'(ka))\n        k_prime_l_vals = 0.5 * 1j * z**2 * (j_l_prime * h1_l + j_l * h1_l_prime)\n        \n        # 3. Form eigenvalues of Calderon-regularized operator, { (kappa'_l)^2 }\n        # These are simply the square of the eigenvalues of K'_k.\n\n        # 4. Compute condition numbers and improvement factor\n        \n        # Magnitudes of eigenvalues of S_k\n        abs_v = np.abs(v_l_vals)\n        # Magnitudes of eigenvalues of K'_k^2, which is |kappa'_l|^2\n        abs_k_sq = np.abs(k_prime_l_vals)**2\n\n        # Condition number of S_k\n        cond_S = np.max(abs_v) / np.min(abs_v)\n        \n        # Condition number of K'_k^2\n        cond_R = np.max(abs_k_sq) / np.min(abs_k_sq)\n        \n        # Improvement factor\n        improvement = cond_S / cond_R\n\n        results.append([cond_S, cond_R, improvement])\n\n    # Format the final output string as specified\n    formatted_results = [f\"[{','.join(map(str, r))}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}