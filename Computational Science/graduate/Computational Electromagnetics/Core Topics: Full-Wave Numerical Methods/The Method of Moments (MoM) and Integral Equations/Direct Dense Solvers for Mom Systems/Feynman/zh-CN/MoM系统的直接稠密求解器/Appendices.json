{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的算法实现之前，对问题规模和计算可行性进行快速估算是计算科学家的一项基本技能。本练习将引导你完成一个典型的“纸面”计算，通过分析LU分解背后的基本浮点运算，来估算求解一个大规模矩量法（MoM）系统所需的时间和内存资源。这项实践旨在让你对稠密直接求解器的 $O(N^3)$ 计算复杂度和 $O(N^2)$ 内存复杂度有一个具体而量化的认识。",
            "id": "3299502",
            "problem": "一个稠密的矩量法（MoM）阻抗矩阵产生于对自由空间中理想导电散射体的频域电场积分方程进行离散化。由此产生的线性系统为 $Z I = V$，其中 $Z \\in \\mathbb{C}^{N \\times N}$ 是一个稠密的非厄米矩阵。考虑使用带有部分主元法的高斯消元法（原地 LU 分解）的直接稠密求解器来求解该系统。\n\n从以下基本依据出发：\n- 在高斯消元法中，在第 $k$ 列选择一个主元后，对大小为 $(N-k) \\times (N-k)$ 的尾随子矩阵的更新是一种形式为 $A \\leftarrow A - u v^{T}$ 的外积（秩-1）更新。\n- 一次复数乘法消耗 $6$ 次实数浮点运算，一次复数加法或减法消耗 $2$ 次实数浮点运算。\n- 对于大的 $N$，与三次方的尾随更新成本相比，主元搜索、除法和置换带来的低阶成本可以忽略不计。\n\n推导一个稠密的 $N \\times N$ 复数双精度矩阵进行 LU 分解所需的主阶实数浮点运算次数。然后，对于 $N = 5000$ 的情况，在一个每秒可维持 $1 \\times 10^{12}$ 次双精度实数浮点运算的单个计算节点上，估计进行分解所需的墙上时钟时间。接下来，假设每个复数双精度数占用 $16$ 字节，并忽略低阶工作空间，估计以吉比字节（GiB）为单位存储稠密复数矩阵及其原地 LU 因子的内存占用。简要评估在一个拥有 $64\\,\\mathrm{GiB}$ 内存的节点上进行此分解是否可行。\n\n将最终时间以秒为单位表示，并将您的最终数值答案四舍五入到三位有效数字。作为您的最终数值答案，仅报告以秒为单位的估计分解时间。",
            "solution": "该问题已经过验证并被认为是有效的。它具有科学依据、自洽且适定，是计算科学和数值线性代数领域的一个标准问题。因此，我们可以进行形式化的求解。\n\n任务是确定对一个稠密的非厄米复数矩阵 $Z \\in \\mathbb{C}^{N \\times N}$ 进行 LU 分解的计算成本和内存需求，并针对特定的矩阵大小和硬件配置评估此操作的可行性。\n\n首先，我们推导 LU 分解的主阶实数浮点运算（FLOP）次数。该算法是高斯消元法，分 $N-1$ 步进行。在第 $k$ 步（$k$ 从 $1$ 到 $N-1$），主要的计算工作是更新大小为 $(N-k) \\times (N-k)$ 的尾随子矩阵。问题陈述指明这是一个形式为 $A \\leftarrow A - u v^{T}$ 的秩-1 更新，其中 $A$ 是尾随子矩阵，$u, v$ 是长度为 $N-k$ 的复向量。\n\n让我们分析第 $k$ 步更新的成本。子矩阵的大小为 $M \\times M$，其中 $M = N-k$。\n1.  外积 $u v^{T}$ 得到一个 $M \\times M$ 的矩阵。其 $M^2$ 个元素中的每一个都是来自 $u$ 的一个复数与来自 $v$ 的一个复数的乘积。这需要 $M^2$ 次复数乘法。\n2.  将此结果矩阵从子矩阵 $A$ 中减去需要 $M^2$ 次复数减法。\n\n问题给出了这些复数运算以实数浮点运算表示的成本：\n-   一次复数乘法耗费 $6$ 次实数 FLOP。\n-   一次复数减法耗费 $2$ 次实数 FLOP。\n\n因此，在第 $k$ 步进行秩-1 更新的总成本是：\n$$ \\text{成本}_k = (N-k)^2 \\times (\\text{复数乘法成本}) + (N-k)^2 \\times (\\text{复数减法成本}) $$\n$$ \\text{成本}_k = (N-k)^2 \\times 6 + (N-k)^2 \\times 2 = 8(N-k)^2 \\text{ 次实数 FLOP} $$\n\n分解的总运算次数是所有步骤（从 $k=1$ 到 $N-1$）成本的总和。我们被指示只考虑大 $N$ 情况下的主阶成本，这使得忽略主元法和除法带来的成本是合理的。\n$$ \\text{总 FLOP 次数} = \\sum_{k=1}^{N-1} \\text{成本}_k = \\sum_{k=1}^{N-1} 8(N-k)^2 $$\n让我们进行变量替换，令 $j = N-k$。当 $k$ 从 $1$ 取到 $N-1$ 时，$j$ 从 $N-1$ 取到 $1$。\n$$ \\text{总 FLOP 次数} = 8 \\sum_{j=1}^{N-1} j^2 $$\n我们使用著名公式——前 $m$ 个平方数的和：$\\sum_{j=1}^{m} j^2 = \\frac{m(m+1)(2m+1)}{6}$。当 $m = N-1$ 时：\n$$ \\text{总 FLOP 次数} = 8 \\left( \\frac{(N-1)N(2N-1)}{6} \\right) = \\frac{4}{3}N(N-1)(2N-1) $$\n对于大的 $N$，我们可以通过只保留 $N$ 的最高次幂来找到主阶项：\n$$ \\text{总 FLOP 次数} \\approx \\frac{4}{3}N(N)(2N) = \\frac{8}{3}N^3 $$\n这是对一个稠密的 $N \\times N$ 复数矩阵进行 LU 分解的主阶实数浮点运算次数。\n\n接下来，我们将此公式应用于 $N = 5000$ 的情况。\n$$ N = 5 \\times 10^3 $$\n$$ \\text{总 FLOP 次数} = \\frac{8}{3} (5 \\times 10^3)^3 = \\frac{8}{3} (125 \\times 10^9) = \\frac{1000}{3} \\times 10^9 \\approx 3.333... \\times 10^{11} \\text{ 次实数 FLOP} $$\n\n该计算节点性能维持在 $P = 1 \\times 10^{12}$ 次每秒实数浮点运算（FLOPS）。分解的估计墙上时钟时间 $T$ 为：\n$$ T = \\frac{\\text{总 FLOP 次数}}{P} = \\frac{\\frac{1000}{3} \\times 10^9}{1 \\times 10^{12}} = \\frac{10^{3} \\times 10^9}{3 \\times 10^{12}} = \\frac{10^{12}}{3 \\times 10^{12}} = \\frac{1}{3} \\text{ 秒} $$\n四舍五入到三位有效数字，时间为 $0.333$ 秒。\n\n现在，我们估计存储该矩阵的内存占用。分解是“原地”执行的，因此 $L$ 和 $U$ 因子的内存会覆盖原始矩阵 $Z$。所以，我们只需要考虑存储一个 $N \\times N$ 复数矩阵的内存。\n该矩阵有 $N^2$ 个元素。每个元素是一个复数双精度数，占用 $16$ 字节。\n$$ N = 5000 $$\n$$ \\text{内存（字节）} = N^2 \\times 16 = (5000)^2 \\times 16 = (25 \\times 10^6) \\times 16 = 400 \\times 10^6 \\text{ 字节} $$\n为了将其表示为吉比字节（GiB），我们使用转换关系 $1 \\text{ GiB} = 2^{30}$ 字节。\n$$ \\text{内存（GiB）} = \\frac{400 \\times 10^6}{2^{30}} = \\frac{400,000,000}{1,073,741,824} \\approx 0.3725 \\text{ GiB} $$\n\n最后，我们评估在一个具有 $64\\,\\mathrm{GiB}$ 可用内存的计算节点上进行此分解的可行性。\n所需内存约为 $0.373\\,\\mathrm{GiB}$，远小于可用的 $64\\,\\mathrm{GiB}$（$0.373 \\ll 64$）。估计时间小于一秒。因此，内存占用和计算时间都完全在指定计算节点的能力范围之内。该分解是完全可行的。",
            "answer": "$$\n\\boxed{0.333}\n$$"
        },
        {
            "introduction": "理论估算为我们提供了对计算成本的宏观认识，而动手实践则让我们直面算法实现的细节。在这个练习中，你将为一个简化的电磁问题——自由空间中的细直导线——构建并求解其矩量法（MoM）线性系统。除了实现求解过程，本练习的核心目标是教会你如何评估数值解的可靠性，通过计算残差和后向误差来验证LU分解求解器的数值稳定性，这是确保数值模拟结果物理意义的关键一步。",
            "id": "3299537",
            "problem": "考虑一个线性系统，该系统源于在自由空间中，通过矩量法（MoM）求解的细直导线的简化电场积分方程（EFIE）离散化。长度为 $L$ 的导线沿 $x$ 轴放置，并被离散为 $N$ 个长度为 $\\Delta l = L/N$ 的均匀脉冲基函数，其中心位于 $x_i = (i + 1/2)\\Delta l$，其中 $i = 0, 1, \\dots, N-1$。自由空间的电磁常数是磁导率 $\\mu_0$ 和介电常数 $\\epsilon_0$，光速为 $c = 1/\\sqrt{\\mu_0 \\epsilon_0}$。设角频率为 $\\omega = 2\\pi f$，波数量为 $k = \\omega \\sqrt{\\mu_0 \\epsilon_0}$。在一种用于脉冲测试的细导线 EFIE 的常用近似中，稠密 MoM 阻抗矩阵 $Z \\in \\mathbb{C}^{N \\times N}$ 定义为\n$$\nZ_{ij} = j \\, \\omega \\, \\mu_0 \\, \\frac{e^{-j k R_{ij}}}{4\\pi R_{ij}} \\, (\\Delta l)^2,\n$$\n其中，当 $i \\neq j$ 时，$R_{ij} = |x_i - x_j|$，自耦项 $R_{ii}$ 使用有限正则化 $R_{ii} = \\Delta l/2 + a$，其中小半径参数 $a$ 严格为正且远小于 $\\Delta l$。激励是与导线相切的均匀平面波电场，其振幅为 $E_0$（单位 V/m），这导致右端向量 $\\mathbf{b} \\in \\mathbb{C}^N$ 的各项为\n$$\nb_i = E_0 \\, \\Delta l.\n$$\n由此得到 MoM 线性系统\n$$\nZ \\mathbf{x} = \\mathbf{b}.\n$$\n\n您将使用基于带部分主元法的下上三角（LU）分解的直接稠密求解器计算数值解 $\\hat{\\mathbf{x}}$，并通过残差范数和后向误差分析验证其数值稳定性。从自由空间中的线性时谐麦克斯韦方程组导出 EFIE、再通过离散化得到线性系统的基本原理出发，使用经过充分检验的自由空间格林函数公式和标准范数定义。在不使用任何针对解本身的捷径公式的情况下，对每个测试案例执行以下步骤：\n\n1. 使用给定的 $N, L, f$ 以及一个满足 $a \\ll \\Delta l$ 但 $a > 0$ 的小参数 $a$，根据上述定义构建矩阵 $Z$ 和向量 $\\mathbf{b}$。\n2. 通过 LU 分解求解 $Z \\mathbf{x} = \\mathbf{b}$，并计算 $\\hat{\\mathbf{x}}$。\n3. 计算残差向量 $\\mathbf{r} = Z \\hat{\\mathbf{x}} - \\mathbf{b}$ 及其二范数 $\\|\\mathbf{r}\\|_2$。将 $\\|\\mathbf{r}\\|_2$ 以伏特（V）为单位表示。\n4. 计算矩阵的谱二范数 $\\|Z\\|_2$、向量范数 $\\|\\hat{\\mathbf{x}}\\|_2$ 和 $\\|\\mathbf{b}\\|_2$，以及二范数条件数\n$$\n\\kappa_2(Z) = \\|Z\\|_2 \\, \\|Z^{-1}\\|_2.\n$$\n5. 计算范数后向误差度量\n$$\n\\eta = \\frac{\\| \\mathbf{r} \\|_2}{\\|Z\\|_2 \\, \\|\\hat{\\mathbf{x}}\\|_2 + \\|\\mathbf{b}\\|_2}.\n$$\n6. 令 $u$ 为 IEEE 754 双精度机器精度。如果满足以下条件，则声明求解过程为数值稳定：\n$$\n\\eta \\le 10 \\, N \\, u.\n$$\n\n您的程序必须为以下测试套件实现上述步骤，该套件被选来覆盖一般情况、低频边缘情况、具有更多自由度的高频情况以及具有最少离散化的边界情况：\n- 案例 1：$N = 10$， $L = 0.5$ 米， $f = 300 \\times 10^6$ 赫兹， $E_0 = 1.0$ V/m。\n- 案例 2：$N = 6$， $L = 0.5$ 米， $f = 1 \\times 10^3$ 赫兹， $E_0 = 1.0$ V/m。\n- 案例 3：$N = 30$， $L = 0.5$ 米， $f = 3 \\times 10^9$ 赫兹， $E_0 = 1.0$ V/m。\n- 案例 4：$N = 1$， $L = 0.5$ 米， $f = 300 \\times 10^6$ 赫兹， $E_0 = 1.0$ V/m。\n\n科学真实性要求：\n- 使用 $\\mu_0 = 4\\pi \\times 10^{-7}$ 亨利/米 和 $\\epsilon_0 = 1/(\\mu_0 c^2)$ 法拉/米，其中 $c = 299{,}792{,}458$ 米/秒。\n- 小半径参数必须满足 $a = L/(1000 N)$。\n- 所有适用的计算都必须在复数算术中执行。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试案例必须生成一个列表 $[\\|\\mathbf{r}\\|_2, \\eta, \\kappa_2(Z), \\text{stable}]$，其中 $\\|\\mathbf{r}\\|_2$ 是一个以伏特为单位的浮点数，$\\eta$ 是一个浮点数，$\\kappa_2(Z)$ 是一个浮点数，而 $\\text{stable}$ 是一个布尔值。最后一行必须将四个测试案例的结果汇总到一个列表中，例如 $[[r_1,\\eta_1,\\kappa_1,s_1],[r_2,\\eta_2,\\kappa_2,s_2],[r_3,\\eta_3,\\kappa_3,s_3],[r_4,\\eta_4,\\kappa_4,s_4]]$，不含空格。",
            "solution": "经过全面审查，该问题被认定为有效。它在科学上基于计算电磁学的原理，特别是将矩量法（MoM）应用于电场积分方程（EFIE）。该问题是适定的，具有一套完整且一致的定义、参数和物理常数，从而能够得到唯一且有意义的解。所有术语都得到了客观且无歧义的定义。\n\n求解过程通过为每个指定的测试案例实施问题陈述中概述的步骤来进行。问题的核心是求解稠密复线性系统 $Z \\mathbf{x} = \\mathbf{b}$，该系统由细导线天线的 EFIE 离散化产生。\n\n首先，我们建立物理和数学框架。该系统由自由空间中的时谐麦克斯韦方程组控制。对于沿 $x$ 轴放置的细导线，EFIE 指出导线表面的总切向电场必须为零。这个总场是由导线上的感应电流 $I(x')$ 产生的入射场 $E_{\\text{inc}}$ 和散射场 $E_{\\text{scat}}$ 之和。这可以表示为：\n$$\n-E_{\\text{inc}, x}(x) = (j \\omega A_x(x) + \\frac{d\\Phi}{dx}(x))_{\\text{tan}}\n$$\n其中 $A_x$ 是磁矢量势，$\\Phi$ 是标量电势，两者都由导线上的电流产生。MoM 被应用于数值求解该积分方程。长度为 $L$ 的导线被离散为 $N$ 个长度为 $\\Delta l = L/N$ 的段。未知电流被近似为分段常数函数，使用一组 $N$ 个脉冲基函数。通过在每个段的中心测试方程（一个称为点匹配或配置的过程），该积分方程被转换为一个线性代数方程组 $Z \\mathbf{x} = \\mathbf{b}$。\n\n矩阵 $Z \\in \\mathbb{C}^{N \\times N}$ 是阻抗矩阵。其元素 $Z_{ij}$ 表示由于 $j$ 段上的单位电流在 $i$ 段中心感应出的电压。所提供的公式，\n$$\nZ_{ij} = j \\, \\omega \\, \\mu_0 \\, \\frac{e^{-j k R_{ij}}}{4\\pi R_{ij}} \\, (\\Delta l)^2\n$$\n是基于自由空间格林函数 $G(R) = e^{-jkR}/(4\\pi R)$ 的一个成熟的近似，该格林函数是亥姆霍兹方程 $(\\nabla^2 + k^2)G = -\\delta(\\mathbf{r})$ 的解。这里，$k = \\omega/c$ 是波数，$\\omega = 2\\pi f$ 是角频率，$c = 1/\\sqrt{\\mu_0 \\epsilon_0}$ 是光速，$R_{ij}=|x_i-x_j|$ 是 $i$ 段和 $j$ 段中心之间的距离。对于对角元素（$i=j$），格林函数的奇异性通过使用正则化距离 $R_{ii} = \\Delta l/2 + a$ 来处理，其中 $a=L/(1000N)$ 是细导线的有效半径。这种正则化对于获得物理上有意义的自阻抗至关重要。所用常数是自由空间磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$ H/m 和自由空间介电常数 $\\epsilon_0 = 1/(\\mu_0 c^2)$ F/m。\n\n右端向量 $\\mathbf{b} \\in \\mathbb{C}^N$ 代表激励。对于振幅为 $E_0$ 的均匀切向平面波入射场，在每个 $i$ 段上感应的电压近似为 $b_i = E_0 \\Delta l$。未知向量 $\\mathbf{x}$ 包含脉冲基函数的系数，这些系数对应于每个段上的复电流幅值。\n\n对于每个测试案例，我们首先使用这些公式构建矩阵 $Z$ 和向量 $\\mathbf{b}$。然后，求解线性系统 $Z \\mathbf{x} = \\mathbf{b}$ 以找到数值解 $\\hat{\\mathbf{x}}$。这是通过使用基于带部分主元法的 LU 分解的直接求解器来完成的，这是一种用于稠密矩阵的鲁棒且标准的算法，在 SciPy 等库中可用。\n\n求解之后，我们进行数值稳定性分析。残差向量计算为 $\\mathbf{r} = Z \\hat{\\mathbf{x}} - \\mathbf{b}$。残差的欧几里得范数 $\\|\\mathbf{r}\\|_2$ 衡量了计算出的解在多大程度上未能满足原始方程。小的残差范数是精确解的必要但不充分指标。\n\n为了提供更严格的评估，我们计算范数后向误差：\n$$\n\\eta = \\frac{\\| \\mathbf{r} \\|_2}{\\|Z\\|_2 \\, \\|\\hat{\\mathbf{x}}\\|_2 + \\|\\mathbf{b}\\|_2}\n$$\n这个值回答了这样一个问题：使得 $\\hat{\\mathbf{x}}$ 是扰动系统 $(Z + \\Delta Z)\\mathbf{x} = (\\mathbf{b} + \\Delta \\mathbf{b})$ 精确解的最小扰动 $(\\Delta Z, \\Delta \\mathbf{b})$ 是什么？一个小的 $\\eta$ 值意味着算法找到了一个邻近问题的近似精确解，这表明了后向稳定性。所使用的稳定性准则是 $\\eta \\le 10 \\, N \\, u$，其中 $u$ 是双精度浮点运算的机器精度。这是一个常见的启发式规则，它表明后向误差应与问题规模 $N$ 乘以单位舍入误差的量级相当。\n\n我们还计算矩阵的谱条件数 $\\kappa_2(Z) = \\|Z\\|_2 \\|Z^{-1}\\|_2$。条件数通过不等式 $\\frac{\\|\\hat{\\mathbf{x}} - \\mathbf{x}\\|_2}{\\|\\mathbf{x}\\|_2} \\lesssim \\kappa_2(Z) \\eta$ 将后向误差与前向误差联系起来。大的条件数表明问题是病态的，意味着输入数据（$Z$ 或 $\\mathbf{b}$）的微小变化可能导致解 $\\mathbf{x}$ 的巨大变化。\n\n该实现为每个测试案例计算这些量，并将结果——$\\|\\mathbf{r}\\|_2$、$\\eta$、$\\kappa_2(Z)$ 和布尔稳定性标志——汇总到指定的输出格式中。所有计算均按要求使用复数运算执行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General case, half-wave wire\n        (10, 0.5, 300e6, 1.0),\n        # Case 2: Low-frequency edge case\n        (6, 0.5, 1e3, 1.0),\n        # Case 3: High-frequency case, electrically long wire\n        (30, 0.5, 3e9, 1.0),\n        # Case 4: Boundary case, minimal discretization\n        (1, 0.5, 300e6, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        result = compute_metrics(case)\n        results.append(result)\n\n    # Format the final output string as per the requirement:\n    # [[r_1,eta_1,kappa_1,s_1],[r_2,eta_2,kappa_2,s_2],...] with no spaces.\n    output_parts = []\n    for res_list in results:\n        item_strs = []\n        for item in res_list:\n            if isinstance(item, bool):\n                item_strs.append(str(item).lower())\n            else:\n                item_strs.append(f\"{item}\")\n        output_parts.append(f\"[{','.join(item_strs)}]\")\n    \n    final_output_string = f\"[{','.join(output_parts)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\ndef compute_metrics(params):\n    \"\"\"\n    Computes all required metrics for a single test case.\n    \n    Args:\n        params: A tuple (N, L, f, E0) containing the problem parameters.\n        \n    Returns:\n        A list containing [||r||_2, eta, kappa_2(Z), stable].\n    \"\"\"\n    N, L, f, E0 = params\n\n    # Scientific constants\n    mu0 = 4 * np.pi * 1e-7\n    c = 299792458.0\n    # No need to explicitly use eps0 as k = omega/c.\n    \n    # Machine epsilon for IEEE 754 double precision\n    # Calculations are complex, so use complex double precision epsilon.\n    u = np.finfo(np.complex128).eps\n\n    # Derived parameters\n    delta_l = L / N\n    a = L / (1000.0 * N)\n    omega = 2 * np.pi * f\n    k = omega / c\n\n    # 1. Construct the matrix Z and vector b\n    x_coords = np.array([(i + 0.5) * delta_l for i in range(N)])\n    Z = np.zeros((N, N), dtype=np.complex128)\n    b = np.full(N, E0 * delta_l, dtype=np.complex128)\n\n    for i in range(N):\n        for j in range(N):\n            if i == j:\n                # Self-term with regularization\n                R = delta_l / 2.0 + a\n            else:\n                # Off-diagonal term\n                R = np.abs(x_coords[i] - x_coords[j])\n            \n            common_factor = 1j * omega * mu0 / (4 * np.pi * R)\n            Z[i, j] = common_factor * np.exp(-1j * k * R) * (delta_l**2)\n\n    # 2. Solve Zx = b via LU factorization\n    # scipy.linalg.solve uses LU decomposition with partial pivoting by default.\n    x_hat = linalg.solve(Z, b)\n\n    # 3. Compute the residual vector r and its two-norm\n    r = Z @ x_hat - b\n    r_norm2 = linalg.norm(r, 2)\n\n    # 4. Compute the required norms and condition number\n    Z_norm2 = linalg.norm(Z, 2)\n    x_hat_norm2 = linalg.norm(x_hat, 2)\n    b_norm2 = linalg.norm(b, 2)\n    kappa_2_Z = np.linalg.cond(Z, 2)\n\n    # 5. Compute the normwise backward error\n    eta_denom = Z_norm2 * x_hat_norm2 + b_norm2\n    # The denominator should not be zero for the given test cases as E0 > 0.\n    if eta_denom == 0:\n        eta = 0.0 if r_norm2 == 0.0 else np.inf\n    else:\n        eta = r_norm2 / eta_denom\n\n    # 6. Check for numerical stability\n    stable = eta = 10 * N * u\n    \n    return [r_norm2, eta, kappa_2_Z, stable]\n\n\nsolve()\n```"
        },
        {
            "introduction": "在使用矩量法（MoM）时，尤其是在处理低频问题或精细结构时，我们经常会遇到病态的阻抗矩阵，这会导致数值解的精度严重下降。本练习将介绍一种强大的高级技术——迭代精化，它能够利用高精度计算的残差来逐步修正低精度求解得到的解。通过推导其误差递推关系并预测收敛性，你将理解该技术如何在不显著增加计算成本的情况下，将一个不可靠的解恢复到接近机器精度的水平。",
            "id": "3299513",
            "problem": "一个稠密的矩量法 (Method of Moments, MoM) 阻抗矩阵 $Z \\in \\mathbb{C}^{N \\times N}$ 源于对理想导电散射体的曲面积分方程进行的频域离散化。考虑使用带部分主元法的下上 (LU) 分解，在双精度算术下通过直接分解求解线性系统 $Z x = b$。然后执行经典迭代求精，其中残差在更高精度的算术下计算。\n\n迭代求精过程如下：从通过双精度 LU 因子进行前向和后向代换得到的初始解 $x^{(0)}$ 开始，对 $k = 0, 1, 2, \\dots$：在更高精度算术下计算残差 $r^{(k)} = b - Z x^{(k)}$；使用预先计算的 LU 因子，在双精度下求解 $Z \\delta x^{(k)} = r^{(k)}$；在双精度下更新解 $x^{(k+1)} = x^{(k)} + \\delta x^{(k)}$。假设使用标准浮点舍入模型，双精度的单位舍入误差为 $u_{\\mathrm{d}} = 2^{-53}$，用于残差计算的更高精度的单位舍入误差为 $u_{\\mathrm{h}} = 2^{-113}$。假设 $Z$ 是非奇异的，且其 2-范数条件数 $\\kappa_{2}(Z)$ 已知。\n\n从带部分主元法的 LU 分解的后向稳定性的第一性原理以及条件数的定义出发，推导一个2-范数下的迭代求精的范数误差递推式，其形式为 $e_{k+1} \\le \\gamma e_{k} + \\beta u_{\\mathrm{d}}$，其中 $e_{k} = \\|x^{(k)} - x^{*}\\|_{2} / \\|x^{*}\\|_{2}$ 且 $x^{*}$ 是精确解。并确定 $\\gamma$ 如何依赖于 $\\kappa_{2}(Z)$ 和所使用的精度。使用此模型，预测收敛性，并确定在特定情况下，为使相对前向误差满足 $e_{k} \\le 10 u_{\\mathrm{d}}$ 所需的最小整数求精步数 $k$。\n$$\n\\kappa_{2}(Z) = 5.0 \\times 10^{15}, \\quad u_{\\mathrm{d}} = 2^{-53}, \\quad u_{\\mathrm{h}} = 2^{-113}.\n$$\n将您的最终答案表示为最小整数 $k$；除了整数性之外，不需要其他舍入规范。",
            "solution": "问题要求关于求解线性系统 $Z x = b$ 的迭代求精的两个主要结果。首先，推导一个范数误差递推式；其次，应用此模型找到对于给定的问题实例，达到指定精度所需的迭代次数。\n\n### 问题验证\n问题陈述描述了数值线性代数中的一个标准场景：使用 LU 分解和随后的迭代求精来求解一个由矩量法 (MoM) 产生的病态线性系统。使用混合精度（分解和求解用双精度，残差计算用更高精度）是提高精度的一种成熟技术。为条件数 $\\kappa_2(Z)$ 以及双精度 ($u_{\\mathrm{d}}$) 和更高精度 ($u_{\\mathrm{h}}$) 的单位舍入误差所提供的参数是合理的。该问题有科学依据、适定、客观且内部一致。因此，该问题是有效的，我们可以继续求解。\n\n### 第1部分：误差递推式的推导\n\n设 $x^*$ 是系统 $Z x = b$ 的精确解，其中 $Z \\in \\mathbb{C}^{N \\times N}$ 是非奇异的。设 $x^{(k)}$ 是经过 $k$ 步迭代求精后的近似解。绝对前向误差为 $E_k = x^{(k)} - x^*$，相对前向误差为 $e_k = \\|E_k\\|_2 / \\|x^*\\|_2$。迭代求精过程从初始解 $x^{(0)}$ 开始，由以下步骤定义：\n\n1.  在更高精度 ($u_{\\mathrm{h}}$) 下计算残差：$r^{(k)} = b - Z x^{(k)}$。\n2.  在双精度 ($u_{\\mathrm{d}}$) 下求解修正量：$Z \\delta x^{(k)} = r^{(k)}$。\n3.  在双精度 ($u_{\\mathrm{d}}$) 下更新解：$x^{(k+1)} = x^{(k)} + \\delta x^{(k)}$。\n\n我们分析在每个计算步驟中引入的误差。令 $fl(\\cdot)$ 表示浮点计算的结果。\n\n计算出的残差 $\\widehat{r^{(k)}} = fl(b - Z x^{(k)})$ 是在精度 $u_{\\mathrm{h}}$ 下计算的。根据矩阵-向量乘积和向量减法的标准浮点算术模型，这个计算出的残差满足：\n$$\n\\widehat{r^{(k)}} = b - Z x^{(k)} + f_k\n$$\n其中 $f_k$ 是舍入误差。该误差的范数，在一阶近似下，其界为\n$$\n\\|f_k\\|_2 \\le C_f u_{\\mathrm{h}} (\\|b\\|_2 + \\|Z\\|_2 \\|x^{(k)}\\|_2)\n$$\n对于某个 $O(N)$ 阶的常数 $C_f$。由于 $b = Zx^*$ 并且对于收敛的迭代有 $\\|x^{(k)}\\|_2 \\approx \\|x^*\\|_2$，我们可以将此界简化为 $\\|f_k\\|_2 \\le C_f' u_{\\mathrm{h}} \\|Z\\|_2 \\|x^*\\|_2$，其中 $C_f'$ 是某个常数。为简化模型，我们将常数合并为一个单一常数 $C_r$ 并使用以下界：\n$$\n\\|f_k\\|_2 \\le C_r u_{\\mathrm{h}} \\|Z\\|_2 \\|x^*\\|_2\n$$\n\n修正方程 $Z \\delta x^{(k)} = r^{(k)}$ 使用预先计算的 $Z$ 的双精度 LU 因子求解。使用带部分主元法的 LU 分解求解线性系统的后向稳定性意味着，计算出的修正量 $\\widehat{\\delta x^{(k)}}$ 是一个扰动系统的精确解：\n$$\n(Z + \\Delta Z_k) \\widehat{\\delta x^{(k)}} = \\widehat{r^{(k)}}\n$$\n其中扰动 $\\Delta Z_k$ 包含了初始 LU 分解和前向/后向代换中的误差。该扰动的范数有界：\n$$\n\\|\\Delta Z_k\\|_2 \\le C_{LU} u_{\\mathrm{d}} \\|Z\\|_2\n$$\n其中 $C_{LU}$ 是一个依赖于矩阵维度 $N$ 和增长因子的常数。在这个理想化模型中，我们假设 $C_{LU}$ 是一个 1 阶的常数。\n\n解在双精度下更新：$x^{(k+1)} = fl(x^{(k)} + \\widehat{\\delta x^{(k)}})$。这引入了另一个误差 $g_k$：\n$$\nx^{(k+1)} = x^{(k)} + \\widehat{\\delta x^{(k)}} + g_k\n$$\n其中 $\\|g_k\\|_2 \\le u_{\\mathrm{d}} \\|x^{(k)} + \\widehat{\\delta x^{(k)}}\\|_2$。由于 $\\widehat{\\delta x^{(k)}}$ 是一个小的修正量，我们有 $\\|g_k\\|_2 \\le u_{\\mathrm{d}} \\|x^{(k+1)}\\|_2 \\approx u_{\\mathrm{d}} \\|x^*\\|_2$。\n\n现在，我们结合这些关系来找到误差 $E_{k+1} = x^{(k+1)} - x^*$ 的递推式：\n$$\nE_{k+1} = (x^{(k)} - x^*) + \\widehat{\\delta x^{(k)}} + g_k = E_k + \\widehat{\\delta x^{(k)}} + g_k\n$$\n从修正量的扰动系统，我们有 $\\widehat{\\delta x^{(k)}} = (Z + \\Delta Z_k)^{-1} \\widehat{r^{(k)}}$。代入 $\\widehat{r^{(k)}}$ 的表达式：\n$$\n\\widehat{\\delta x^{(k)}} = (Z + \\Delta Z_k)^{-1} (b - Z x^{(k)} + f_k) = (Z + \\Delta Z_k)^{-1} (-Z E_k + f_k)\n$$\n使用恒等式 $(Z + \\Delta Z_k)^{-1} = (I + Z^{-1}\\Delta Z_k)^{-1}Z^{-1}$，我们得到：\n$$\n\\widehat{\\delta x^{(k)}} = (I + Z^{-1}\\Delta Z_k)^{-1} (-E_k + Z^{-1}f_k)\n$$\n对于一个收敛过程，$\\|Z^{-1}\\Delta Z_k\\|_2 \\le \\|Z^{-1}\\|_2 \\|\\Delta Z_k\\|_2 \\le \\kappa_2(Z) C_{LU} u_{\\mathrm{d}}  1$。我们可以使用一阶近似 $(I + A)^{-1} \\approx I - A$。\n$$\n\\widehat{\\delta x^{(k)}} \\approx (I - Z^{-1}\\Delta Z_k) (-E_k + Z^{-1}f_k) = -E_k + Z^{-1}\\Delta Z_k E_k + Z^{-1}f_k - (Z^{-1}\\Delta Z_k Z^{-1}f_k)\n$$\n将此代入 $E_{k+1}$ 的方程，并只保留误差量的一阶项：\n$$\nE_{k+1} \\approx E_k + (-E_k + Z^{-1}\\Delta Z_k E_k + Z^{-1}f_k) + g_k = (Z^{-1}\\Delta Z_k) E_k + Z^{-1}f_k + g_k\n$$\n取 2-范数：\n$$\n\\|E_{k+1}\\|_2 \\le \\|Z^{-1}\\Delta Z_k E_k\\|_2 + \\|Z^{-1}f_k\\|_2 + \\|g_k\\|_2\n$$\n$$\n\\|E_{k+1}\\|_2 \\le \\|Z^{-1}\\|_2 \\|\\Delta Z_k\\|_2 \\|E_k\\|_2 + \\|Z^{-1}\\|_2 \\|f_k\\|_2 + \\|g_k\\|_2\n$$\n现在，代入 $\\|\\Delta Z_k\\|_2$、$\\|f_k\\|_2$ 和 $\\|g_k\\|_2$ 的界：\n$$\n\\|E_{k+1}\\|_2 \\le \\|Z^{-1}\\|_2 (C_{LU} u_{\\mathrm{d}} \\|Z\\|_2) \\|E_k\\|_2 + \\|Z^{-1}\\|_2 (C_r u_{\\mathrm{h}} \\|Z\\|_2 \\|x^*\\|_2) + u_{\\mathrm{d}} \\|x^*\\|_2\n$$\n除以 $\\|x^*\\|_2$ 得到相对误差 $e_{k+1} = \\|E_{k+1}\\|_2/\\|x^*\\|_2$：\n$$\ne_{k+1} \\le (C_{LU} u_{\\mathrm{d}} \\kappa_2(Z)) \\frac{\\|E_k\\|_2}{\\|x^*\\|_2} + (C_r u_{\\mathrm{h}} \\kappa_2(Z)) + u_{\\mathrm{d}}\n$$\n$$\ne_{k+1} \\le (C_{LU} u_{\\mathrm{d}} \\kappa_2(Z)) e_k + (C_r \\kappa_2(Z) \\frac{u_{\\mathrm{h}}}{u_{\\mathrm{d}}} + 1) u_{\\mathrm{d}}\n$$\n这就是所期望的误差递推式 $e_{k+1} \\le \\gamma e_k + \\beta u_{\\mathrm{d}}$。系数 $\\gamma$ 由下式给出：\n$$\n\\gamma = C_{LU} u_{\\mathrm{d}} \\kappa_2(Z)\n$$\n这表明 $\\gamma$ 与条件数 $\\kappa_2(Z)$ 和工作精度的单位舍入误差 $u_{\\mathrm{d}}$ 成正比。它不依赖于更高精度 $u_{\\mathrm{h}}$。系数 $\\beta$ 由下式给出：\n$$\n\\beta = C_r \\kappa_2(Z) \\frac{u_{\\mathrm{h}}}{u_{\\mathrm{d}}} + 1\n$$\n\n### 第2部分：对特定情况的应用\n\n给定 $\\kappa_2(Z) = 5.0 \\times 10^{15}$，$u_{\\mathrm{d}} = 2^{-53}$ 以及 $u_{\\mathrm{h}} = 2^{-113}$。对于此模型，我们假设常数 $C_{LU}$ 和 $C_r$ 是 1 阶的，因此在计算中我们将它们设为 1。\n\n收敛因子为：\n$$\n\\gamma = \\kappa_2(Z) u_{\\mathrm{d}} = (5.0 \\times 10^{15}) \\times 2^{-53}\n$$\n使用 $2^{-53} \\approx 1.110223 \\times 10^{-16}$，我们得到：\n$$\n\\gamma \\approx (5.0 \\times 10^{15}) \\times (1.110223 \\times 10^{-16}) \\approx 0.5551115\n$$\n由于 $\\gamma  1$，预测迭代求精过程会收敛。\n\n通过直接 LU 求解得到的解 $x^{(0)}$ 的初始误差 $e_0$ 的界为 $e_0 \\le C_0 u_{\\mathrm{d}} \\kappa_2(Z)$，其中 $C_0$ 是某个常数。假设 $C_0=1$，我们取 $e_0 \\approx \\gamma \\approx 0.5551115$。\n\n递推式为 $e_{k+1} \\le \\gamma e_k + \\beta u_{\\mathrm{d}}$。极限误差 $e_{\\infty}$ 可以通过在相应的等式中设 $e_{k+1}=e_k=e_{\\infty}$ 来找到，这得到 $e_{\\infty} = \\frac{\\beta u_{\\mathrm{d}}}{1-\\gamma}$。\n首先，我们计算 $\\beta$：\n$$\n\\beta = \\kappa_2(Z) \\frac{u_{\\mathrm{h}}}{u_{\\mathrm{d}}} + 1 = (5.0 \\times 10^{15}) \\frac{2^{-113}}{2^{-53}} + 1 = (5.0 \\times 10^{15}) \\times 2^{-60} + 1\n$$\n使用 $2^{-60} \\approx 8.6736 \\times 10^{-19}$：\n$$\n\\beta \\approx (5.0 \\times 10^{15}) \\times (8.6736 \\times 10^{-19}) + 1 = 0.0043368 + 1 = 1.0043368\n$$\n极限相对误差为：\n$$\ne_{\\infty} \\approx \\frac{1.0043368 \\times u_{\\mathrm{d}}}{1 - 0.5551115} = \\frac{1.0043368}{0.4448885} u_{\\mathrm{d}} \\approx 2.25749 u_{\\mathrm{d}}\n$$\n递推不等式 $e_k \\le \\gamma e_{k-1} + \\beta u_{\\mathrm{d}}$ 的解为 $e_k \\le \\gamma^k e_0 + \\beta u_{\\mathrm{d}} \\sum_{i=0}^{k-1}\\gamma^i = \\gamma^k e_0 + e_{\\infty}(1-\\gamma^k)$，可以写成：\n$$\ne_k \\le \\gamma^k (e_0 - e_{\\infty}) + e_{\\infty}\n$$\n我们需要找到满足 $e_k \\le 10 u_{\\mathrm{d}}$ 的最小整数 $k$。\n$$\n\\gamma^k (e_0 - e_{\\infty}) + e_{\\infty} \\le 10 u_{\\mathrm{d}}\n$$\n$$\n\\gamma^k (e_0 - e_{\\infty}) \\le 10 u_{\\mathrm{d}} - e_{\\infty}\n$$\n代入数值 $e_0 \\approx \\gamma \\approx 0.5551115$ 和 $e_{\\infty} \\approx 2.25749 u_{\\mathrm{d}}$：\n$$\n\\gamma^k (0.5551115 - 2.25749 u_{\\mathrm{d}}) \\le (10 - 2.25749) u_{\\mathrm{d}}\n$$\n由于 $u_{\\mathrm{d}}$ 非常小，$e_0 - e_{\\infty} \\approx e_0 \\approx \\gamma$。不等式变为：\n$$\n\\gamma^k \\cdot \\gamma \\le 7.74251 u_{\\mathrm{d}} \\implies \\gamma^{k+1} \\le 7.74251 u_{\\mathrm{d}}\n$$\n对两边取自然对数：\n$$\n(k+1) \\ln(\\gamma) \\le \\ln(7.74251 u_{\\mathrm{d}})\n$$\n由于 $\\gamma  1$，$\\ln(\\gamma)$ 是负数。除以 $\\ln(\\gamma)$ 会使不等号反向：\n$$\nk+1 \\ge \\frac{\\ln(7.74251 u_{\\mathrm{d}})}{\\ln(\\gamma)} = \\frac{\\ln(7.74251) + \\ln(2^{-53})}{\\ln(\\gamma)} = \\frac{\\ln(7.74251) - 53\\ln(2)}{\\ln(\\kappa_2(Z) u_{\\mathrm{d}})}\n$$\n使用 $\\ln(2) \\approx 0.693147$，$\\ln(7.74251) \\approx 2.04680$ 和 $\\ln(\\gamma) \\approx -0.588588$：\n$$\n\\ln(7.74251 u_{\\mathrm{d}}) \\approx 2.04680 - 53 \\times 0.693147 = 2.04680 - 36.736801 = -34.6900\n$$\n$$\nk+1 \\ge \\frac{-34.6900}{-0.588588} \\approx 58.937\n$$\n$$\nk \\ge 57.937\n$$\n最小整数求精步数 $k$ 为 58。\n\n我们来检验 $k=58$ 的情况。误差界给出 $e_{58} \\le \\gamma^{58}(e_0 - e_{\\infty}) + e_{\\infty}$。\n$k=58$ 是求精的步数，这意味着我们计算 $x^{(58)}$。这对应于我们公式中的 $k$。\n从 $k \\ge 57.937$ 可知，最小整数为 $k=58$。\n在第 $k=58$ 步，相对误差为 $e_{58}$。我们来验证误差水平。\n$k=58 > 57.937$。不等式 $e_{58} \\le 10u_d$ 成立。\n对于 $k=57  57.937$，此分析不保证不等式 $e_{57} \\le 10u_d$ 成立。\n因此，最小步数为 58。",
            "answer": "$$\\boxed{58}$$"
        }
    ]
}