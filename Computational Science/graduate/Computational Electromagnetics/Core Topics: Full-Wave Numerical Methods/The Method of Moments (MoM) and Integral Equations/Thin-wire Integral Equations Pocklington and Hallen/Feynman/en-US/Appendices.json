{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of proficiency in computational electromagnetics is the ability to build a numerical solver and rigorously verify its correctness. This first practice guides you through the complete process of implementing the Method of Moments (MoM) for the Pocklington integral equation. By solving for the current on a thin-wire antenna, you will then verify that the solution correctly enforces the fundamental perfect electric conductor (PEC) boundary condition, ensuring the total tangential electric field vanishes on the wire's surface .",
            "id": "3355348",
            "problem": "Consider a straight, perfectly electrically conducting (PEC) thin circular wire of length $L$ and radius $a$, centered on the $z$-axis from $z=-L/2$ to $z=+L/2$ in an unbounded homogeneous medium of free space with permeability $\\mu_0$ and permittivity $\\epsilon_0$. Work in the frequency domain with time dependence $e^{j\\omega t}$, angular frequency $\\omega=2\\pi f$, and wavenumber $k=\\omega\\sqrt{\\mu_0\\epsilon_0}$. The wire is center-fed at $z=0$ by an infinitesimal gap that imposes a specified voltage $V_{\\mathrm{gap}}$ across the feed.\n\nStarting from Maxwell’s equations in the frequency domain in free space and the PEC boundary condition that the tangential electric field vanishes on the conductor surface except across the gap, derive a one-dimensional electric field integral equation (EFIE) for the unknown axial current $I(z)$ along the wire. Your derivation must use the thin-wire approximation with a finite wire radius $a$ to regularize the axial Green-function singularity through the finite source-to-observer distance on the cylindrical surface, and enforce the PEC boundary condition everywhere on the wire surface except the feed gap. Use a delta-gap model of the feed such that the impressed electric field is nonzero only within a single collocation cell at $z=0$ and integrates to the specified voltage $V_{\\mathrm{gap}}$.\n\nDiscretize the resulting integral equation using the Method of Moments (MoM) with pulse (piecewise constant) basis functions on $N$ uniform segments of length $\\Delta z=L/N$ and point matching at segment midpoints. In assembling the system, evaluate the segment-to-segment interaction integrals by accurate numerical quadrature. Solve the linear system for the segment currents $\\{I_n\\}_{n=1}^N$, then compute the near electric field’s axial (tangential) component on the cylindrical wire surface at the collocation points by applying the same discretized operator used in the EFIE to the solved currents.\n\nUsing the solved currents and the discretized operator, verify the PEC boundary condition numerically by computing the total tangential electric field on the wire surface at the collocation points (the sum of the scattered field due to the solved current and the impressed field from the delta-gap source). Exclude a small neighborhood around the feed and the physical ends of the wire from the verification set to avoid the singular feed region and endpoint modeling artifacts. Report, for each test, the maximum absolute value of the total tangential electric field over the verification set.\n\nUse the following physical parameters and units:\n- Free-space constants: $\\mu_0=4\\pi\\times 10^{-7}\\,\\mathrm{H/m}$ and $\\epsilon_0=1/(\\mu_0 c^2)$ with $c=299{,}792{,}458\\,\\mathrm{m/s}$.\n- Choose the frequency such that the free-space wavelength is $\\lambda=1\\,\\mathrm{m}$; that is, $k=2\\pi/\\lambda=2\\pi\\,\\mathrm{rad/m}$ and $f=c/\\lambda$.\n- Geometry: $L=0.5\\,\\mathrm{m}$, $a=1.0\\times 10^{-3}\\,\\mathrm{m}$, center-fed at $z=0$.\n- Excitation: $V_{\\mathrm{gap}}=1.0\\,\\mathrm{V}$ across the delta gap at $z=0$.\n- Angle units are radians throughout.\n- Express the final reported electric field magnitudes in $\\mathrm{V/m}$ as decimal floats.\n\nDesign the verification to quantify discretization error by varying the number of segments $N$ while keeping all other parameters fixed. Use Gaussian–Legendre quadrature of a fixed order for all segment interaction integrals. For the verification set at each discretization, exclude the feed segment and its immediate neighbors, and exclude the two segments nearest to each wire end. Then compute the maximum absolute value of the total tangential electric field at the remaining collocation points.\n\nTest Suite:\n- Case $1$: $N=11$ segments, quadrature order $Q=8$.\n- Case $2$: $N=21$ segments, quadrature order $Q=8$.\n- Case $3$: $N=41$ segments, quadrature order $Q=8$.\n\nYour program must:\n- Derive from first principles in your solution the expressions necessary to implement the EFIE kernel consistently with the thin-wire model and finite radius.\n- Assemble and solve the MoM system for each test case.\n- Compute the maximum absolute total tangential field over the verification set for each case.\n- Output a single line containing the three results as a comma-separated Python list, in the exact format $[r_1,r_2,r_3]$, where each $r_i$ is the computed maximum absolute electric field magnitude in $\\mathrm{V/m}$ for the corresponding case.\n\nThe output must be a single line with the list, for example $[0.123,0.0456,0.00789]$.",
            "solution": "We begin from Maxwell’s equations in the frequency domain in free space with time dependence $e^{j\\omega t}$:\n$$\n\\nabla\\times \\mathbf{E} = -j\\omega \\mu_0 \\mathbf{H},\\quad\n\\nabla\\times \\mathbf{H} = \\mathbf{J} + j\\omega \\epsilon_0 \\mathbf{E}.\n$$\nIntroduce the magnetic vector potential $\\mathbf{A}$ and scalar potential $\\phi$ in the Lorenz gauge, satisfying $\\nabla\\cdot \\mathbf{A} = -j\\omega \\mu_0 \\epsilon_0 \\phi$. Fields are given by\n$$\n\\mathbf{E} = -j\\omega \\mathbf{A} - \\nabla \\phi,\\quad\n\\mathbf{H} = \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{A}.\n$$\nThe potentials satisfy inhomogeneous Helmholtz equations driven by the sources:\n$$\n(\\nabla^2 + k^2)\\mathbf{A} = -\\mu_0 \\mathbf{J},\\quad\n(\\nabla^2 + k^2)\\phi = -\\frac{\\rho}{\\epsilon_0},\n$$\nwith $k=\\omega\\sqrt{\\mu_0\\epsilon_0}$. The continuity equation enforces $j\\omega \\rho + \\nabla\\cdot \\mathbf{J} = 0$.\n\nFor a thin, straight wire aligned with the $z$ axis, we model the conduction current density as purely axial and concentrated along the wire axis, i.e., $\\mathbf{J}(\\mathbf{r}') \\approx \\hat{\\mathbf{z}} I(z') \\delta(x')\\delta(y')$, with the understanding that the surface current on the actual cylindrical surface is approximated by this axial filament with finite wire radius $a$ used to regularize source-observer distance. The appropriate scalar Green’s function for the three-dimensional Helmholtz operator is\n$$\nG(\\mathbf{r},\\mathbf{r}') = \\frac{e^{-jk R}}{4\\pi R},\\quad R=\\|\\mathbf{r}-\\mathbf{r}'\\|.\n$$\nOn the wire cylindrical surface, at a given axial coordinate $z$, the distance to a source point $z'$ on the axis is $R=\\sqrt{(z-z')^2 + a^2}$ due to the finite radius $a$.\n\nThe vector potential due to the thin-wire axial current is\n$$\n\\mathbf{A}(\\mathbf{r}) = \\hat{\\mathbf{z}}\\mu_0 \\int_{-L/2}^{L/2} I(z') G(\\mathbf{r}, \\mathbf{r}')\\, dz'.\n$$\nFrom the Lorenz gauge and potentials, the scattered electric field's axial component can be expressed as:\n$$\nE_z^{\\text{scat}}(z) = -\\frac{1}{j\\omega\\epsilon_0} \\int_{-L/2}^{L/2} I(z') \\left(k^2 + \\frac{\\partial^2}{\\partial z^2}\\right) G(R)\\, dz',\n$$\nwhere $R = \\sqrt{(z-z')^2+a^2}$.\n\nEnforcing the PEC boundary condition for the axial (tangential) component of the total electric field on the wire surface everywhere except an infinitesimal feed gap at $z=0$ yields the electric field integral equation (EFIE):\n$$\nE^{\\mathrm{scat}}_z(z) + E^{\\mathrm{inc}}_z(z) = 0,\\quad z\\in(-L/2, L/2),\\ \\text{except in the feed gap},\n$$\nThe impressed (incident) field $E^{\\mathrm{inc}}_z(z)$ models a delta-gap excitation: it vanishes on the metal except within an infinitesimal region around $z=0$ and has an integral across that region equal to the specified gap voltage $V_{\\mathrm{gap}}$. In a discrete MoM setting using pulse basis and point matching, a practical model is to assign a constant impressed field in the feed segment such that its integral equals $V_{\\mathrm{gap}}$, i.e., $E^{\\mathrm{inc}}_z \\approx V_{\\mathrm{gap}}/\\Delta z$ in the feed segment and zero elsewhere.\n\nTo discretize, partition the interval $[-L/2, L/2]$ into $N$ equal segments of length $\\Delta z=L/N$ with centers $z_i$, $i=1,\\dots,N$. Approximate $I(z)$ by pulse basis functions: $I(z)\\approx \\sum_{n=1}^N I_n p_n(z)$, where $p_n$ is $1$ in segment $n$ and $0$ elsewhere. Point-match the EFIE at the collocation points $z_i$ on the wire surface. The resulting linear system is\n$$\n\\sum_{n=1}^N Z_{in} I_n = -V_i,\\quad i=1,\\dots,N,\n$$\nwhere $V_i=E^{\\mathrm{inc}}_z(z_i)$ are the impressed field samples and the impedance matrix entries are\n$$\nZ_{in} = -\\frac{1}{j\\omega\\epsilon_0} \\int_{z\\in \\text{segment }n} \\left(k^2 + \\frac{\\partial^2}{\\partial z_i^2}\\right) \\frac{e^{-jk \\sqrt{(z_i-z)^2+a^2}}}{4\\pi \\sqrt{(z_i-z)^2+a^2}}\\, dz.\n$$\nWe denote $u=z_i-z$, $R(u)=\\sqrt{u^2+a^2}$, and define the univariate Green’s function $G(u)=e^{-jk R(u)}/(4\\pi R(u))$. To evaluate the operator $\\left[k^2 + \\frac{\\partial^2}{\\partial z_i^2}\\right] G$ we require the second derivative with respect to $u$ (since $\\partial/\\partial z_i=\\partial/\\partial u$). Use the chain rule with $dR/du = u/R$. First derivatives:\n$$\n\\frac{dG}{dR} = \\frac{e^{-jk R}}{4\\pi}\\left(-\\frac{1}{R^2} - \\frac{jk}{R}\\right),\\quad\n\\frac{dG}{du} = \\frac{u}{R}\\frac{dG}{dR}.\n$$\nSecond derivatives:\n$$\n\\frac{d^2 G}{dR^2} = \\frac{e^{-jk R}}{4\\pi}\\left(\\frac{2jk}{R^2} + \\frac{2}{R^3} - \\frac{k^2}{R}\\right),\n$$\nand using $d/du\\left(\\frac{u}{R}\\right)=\\frac{a^2}{R^3}$,\n$$\n\\frac{d^2 G}{du^2} = \\frac{a^2}{R^3}\\frac{dG}{dR} + \\frac{u^2}{R^2}\\frac{d^2 G}{dR^2}.\n$$\nTherefore the Pocklington kernel along the wire is\n$$\n\\mathcal{P}(u) = k^2 G(u) + \\frac{d^2 G}{du^2}.\n$$\nWith this, the matrix entries become\n$$\nZ_{in} = -\\frac{1}{j\\omega\\epsilon_0} \\int_{z\\in \\text{segment }n} \\mathcal{P}(z_i - z)\\, dz.\n$$\nWe evaluate the segment integral by Gaussian–Legendre quadrature of fixed order $Q$ after mapping from the canonical interval $[-1,1]$ to each segment. Because $a>0$, $R(u)\\ge a$ and the integrals are finite without special singular-term extraction; the finite radius regularizes the kernel.\n\nTo model the delta-gap, choose the feed segment index $i_0=(N+1)/2$ for odd $N$ at $z=0$. Set $V_i=V_{\\mathrm{gap}}/\\Delta z$ for $i=i_0$ and $V_i=0$ otherwise. Solve the linear system for $I_n$. The scattered electric field samples at the collocation points are\n$$\nE^{\\mathrm{scat}}_i = \\sum_{n=1}^N Z_{in} I_n.\n$$\nThe total tangential field samples are $E^{\\mathrm{tot}}_i = E^{\\mathrm{scat}}_i + V_i$. For a PEC, away from the feed gap the boundary condition requires $E^{\\mathrm{tot}}_i=0$. Numerical residuals arise due to truncation and quadrature errors. We verify that these residuals decrease with refinement of $N$.\n\nVerification set selection: exclude the feed segment and its immediate neighbors, and exclude the two segments nearest to each end. Let the index set be\n$$\n\\mathcal{I} = \\{i\\in\\{1,\\dots,N\\} : i\\notin \\{1,2,N-1,N,i_0-1,i_0,i_0+1\\}\\}.\n$$\nCompute for each test case the quantity\n$$\nr = \\max_{i\\in \\mathcal{I}} |E^{\\mathrm{tot}}_i|.\n$$\nWe expect $r$ to decrease as $N$ increases, reflecting convergence of the MoM discretization. All field magnitudes are in $\\mathrm{V/m}$ because $V_i$ has units of $\\mathrm{V/m}$ and $Z_{in}$ maps current in $\\mathrm{A}$ to field in $\\mathrm{V/m}$.\n\nImplementation details:\n- Use $L=0.5\\,\\mathrm{m}$, $a=1.0\\times 10^{-3}\\,\\mathrm{m}$, $\\lambda=1\\,\\mathrm{m}$ so $k=2\\pi\\,\\mathrm{rad/m}$ and $f=c/\\lambda$.\n- Use $V_{\\mathrm{gap}}=1.0\\,\\mathrm{V}$ so the impressed field in the feed cell is $V_{\\mathrm{gap}}/\\Delta z$.\n- Gaussian–Legendre quadrature order $Q=8$.\n- Test cases: $N\\in\\{11,21,41\\}$.\n\nAlgorithm summary:\n1. For each $N$, form the grid and collocation points $z_i$.\n2. Build the dense impedance matrix $Z$ using $Q$-point Gaussian–Legendre quadrature for each segment-to-collocation interaction with the derived $\\mathcal{P}(u)$.\n3. Build the impressed field vector $V$ with a single nonzero entry $V_{i_0}=V_{\\mathrm{gap}}/\\Delta z$.\n4. Solve $Z \\mathbf{I} = -\\mathbf{V}$ for $\\mathbf{I}$.\n5. Compute $\\mathbf{E}^{\\mathrm{scat}}=Z\\mathbf{I}$ and $\\mathbf{E}^{\\mathrm{tot}}=\\mathbf{E}^{\\mathrm{scat}}+\\mathbf{V}$.\n6. Form the verification index set $\\mathcal{I}$ and compute $r=\\max_{i\\in\\mathcal{I}}|E^{\\mathrm{tot}}_i|$.\n7. Output the three $r$ values for the test suite in a single Python list on one line.\n\nThis construction directly enforces the boundary condition on the wire surface in the discretized sense and provides a principled way to quantify residual tangential fields away from the feed. The residuals decrease with increasing $N$ due to reduced discretization error; any nonzero values are attributed to numerical quadrature and finite-segment approximations inherent in the pulse–point MoM scheme.",
            "answer": "```python\nimport numpy as np\n\n# Physical constants\nmu0 = 4.0e-7 * np.pi  # H/m\nc0 = 299_792_458.0    # m/s\neps0 = 1.0 / (mu0 * c0**2)\n\ndef gauss_legendre(n):\n    # Nodes and weights on [-1,1]\n    return np.polynomial.legendre.leggauss(n)\n\ndef pocklington_kernel(u, a, k):\n    \"\"\"\n    Compute the Pocklington kernel P(u) = k^2*G(u) + d^2G/du^2\n    where G(u) = exp(-j k R) / (4*pi*R) with R = sqrt(u^2 + a^2).\n    Returns complex array of same shape as u.\n    \"\"\"\n    R = np.sqrt(u*u + a*a)\n    # Avoid division issues; a > 0 ensures R > 0\n    exp_term = np.exp(-1j * k * R)\n    G = exp_term / (4.0 * np.pi * R)\n    # Derivatives wrt R\n    dG_dR = exp_term * (-1.0 / (R**2) - 1j * k / R) / (4.0 * np.pi)\n    d2G_dR2 = exp_term * (2j * k / (R**2) + 2.0 / (R**3) - k**2 / R) / (4.0 * np.pi)\n    # Chain rule for d^2G/du^2\n    # d/du(u/R) = a^2 / R^3\n    d2G_du2 = (a*a / (R**3)) * dG_dR + (u*u / (R**2)) * d2G_dR2\n    P = k**2 * G + d2G_du2\n    return P\n\ndef build_impedance_matrix(N, L, a, k, omega, quad_order=8):\n    \"\"\"\n    Build the dense MoM impedance matrix Z of size N x N for a straight thin-wire PEC.\n    Z_{ij} = -1/(j*omega*eps0) * \\int_{segment j} P(z_i - z') dz'\n    with collocation points at segment centers z_i.\n    \"\"\"\n    dz = L / N\n    # Collocation points (segment centers)\n    z_centers = np.linspace(-L/2 + dz/2, L/2 - dz/2, N)\n    Z = np.zeros((N, N), dtype=complex)\n    # Quadrature nodes and weights on [-1, 1]\n    xi, wi = gauss_legendre(quad_order)\n    half = 0.5 * dz\n    # Loop over observation and source segments\n    for i in range(N):\n        zi = z_centers[i]\n        for j in range(N):\n            zj = z_centers[j]\n            # Map quadrature to source segment j\n            z_prime = zj + half * xi\n            u = zi - z_prime\n            P = pocklington_kernel(u, a, k)\n            integral = np.sum(wi * P) * half\n            Z[i, j] = -1.0 / (1j * omega * eps0) * integral\n    return Z, z_centers, dz\n\ndef compute_residual_for_case(N, L, a, k, omega, Vgap, quad_order=8):\n    Z, zc, dz = build_impedance_matrix(N, L, a, k, omega, quad_order=quad_order)\n    # Delta-gap impressed field: V_i = Vgap/dz at the feed segment (center closest to 0)\n    feed_index = N // 2  # for odd N, this is the center index\n    V = np.zeros(N, dtype=complex)\n    V[feed_index] = Vgap / dz\n    # Solve Z I = -V\n    I = np.linalg.solve(Z, -V)\n    # Scattered and total fields at collocation points\n    E_scat = Z @ I\n    E_tot = E_scat + V\n    # Exclude indices near ends and around the feed: {0,1,N-2,N-1, feed-1, feed, feed+1}\n    exclude = set([0, 1, N-2, N-1, feed_index])\n    if feed_index - 1 >= 0:\n        exclude.add(feed_index - 1)\n    if feed_index + 1 = N - 1:\n        exclude.add(feed_index + 1)\n    mask = np.ones(N, dtype=bool)\n    for idx in exclude:\n        mask[idx] = False\n    # Compute max absolute total E over verification set\n    if mask.any():\n        resid = np.max(np.abs(E_tot[mask]))\n    else:\n        resid = float('nan')\n    return float(resid)\n\ndef solve():\n    # Fixed physical setup\n    L = 0.5  # meters\n    a = 1.0e-3  # meters\n    lam = 1.0  # meters\n    k = 2.0 * np.pi / lam  # rad/m\n    f = c0 / lam\n    omega = 2.0 * np.pi * f\n    Vgap = 1.0  # Volts\n    quad_order = 8\n\n    # Test cases: N segments\n    test_cases = [11, 21, 41]\n\n    results = []\n    for N in test_cases:\n        r = compute_residual_for_case(N, L, a, k, omega, Vgap, quad_order=quad_order)\n        results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "A valid numerical solution for the current $I(z)$ must satisfy not only the governing integral equation but also other fundamental physical laws, such as the conservation of charge. This exercise focuses on post-processing the computed current to derive the corresponding linear charge density $\\lambda(z)$ using the continuity equation. You will develop a robust numerical procedure to handle this calculation and perform a critical consistency check to verify global charge neutrality, a vital step in validating any electromagnetic simulation .",
            "id": "3355298",
            "problem": "You are given a straight, perfectly electrically conducting thin wire of length $L$ centered on the origin and aligned with the $z$-axis in free space. A time-harmonic delta-gap voltage source at $z=0$ excites the wire, resulting in an axial current $I(z)$ that has been obtained numerically (for example, from the Pocklington integral equation or the Hallen integral equation). Assume the time-harmonic convention $e^{\\mathrm{j}\\omega t}$, where $\\omega$ is the angular frequency. The wire is thin enough that the axial current $I(z)$ is a valid one-dimensional representation, and the linear charge density $\\lambda(z)$ along the wire is well-defined.\n\nStarting from the conservation of charge and the time-harmonic assumption, derive an expression that links the linear charge density $\\lambda(z)$ to the axial current $I(z)$ along the wire. Then, design a robust numerical procedure to compute $\\lambda(z)$ from discrete samples of $I(z)$ on a uniform grid $\\{z_i\\}$ spanning $[-L/2,L/2]$. Your procedure must include:\n- A differentiation method suitable for noisy data that avoids amplifying high-frequency noise when estimating $\\frac{dI}{dz}$.\n- A method to compute the total charge on the wire, $Q$, by numerically integrating $\\lambda(z)$ over $z\\in[-L/2,L/2]$.\n- An independent consistency check for $Q$ based on boundary currents at the wire ends.\n- A global neutrality test that evaluates whether the total charge magnitude $|Q|$ is below a specified tolerance.\n\nScientific basis and constraints:\n- Begin from fundamental laws, specifically the continuity equation implied by Maxwell’s equations, and the time-harmonic assumption. Do not use or state shortcut formulas directly in the problem statement.\n- The numerical differentiation method must be stable and suitable for advanced graduate-level computational electromagnetics practice.\n- Assume free-space speed of light $c=299{,}792{,}458\\ \\mathrm{m/s}$, and an excitation frequency $f$ with angular frequency $\\omega=2\\pi f$.\n- The positions $z_i$ are uniformly spaced with spacing $\\Delta z$ over $[-L/2,L/2]$.\n\nUnits and outputs:\n- Express the linear charge density $\\lambda(z)$ in $\\mathrm{C/m}$ and the total charge $Q$ in $\\mathrm{C}$.\n- Angles and phases, if any, must be handled in radians.\n- The neutrality decision must be a boolean value.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sublist $[Q\\_\\text{mag},\\ \\text{consistency\\_error},\\ \\text{neutral}]$. Here $Q\\_\\text{mag}$ is the magnitude $|Q|$ in $\\mathrm{C}$, $\\text{consistency\\_error}$ is the magnitude of the difference between the integrated-charge estimate and the boundary-current-based estimate of $Q$ (in $\\mathrm{C}$), and $\\text{neutral}$ is a boolean indicating whether $|Q|\\le \\tau$ for a specified tolerance $\\tau$.\n\nTest suite:\nUse the following three test cases to validate your procedure. In all cases, let $N=1001$ uniformly spaced samples on $[-L/2,L/2]$, $c=299{,}792{,}458\\ \\mathrm{m/s}$, and $I_0=1\\ \\mathrm{A}$.\n\n1. Happy path (center-fed half-wave dipole-like current): Let $f=300\\times 10^{6}\\ \\mathrm{Hz}$, $k=\\frac{2\\pi f}{c}$, and $L=\\frac{\\pi}{k}$ so that $L=\\frac{\\lambda}{2}$. Define $I(z)=I_0\\cos(k z)$ for $z\\in[-L/2,L/2]$.\n\n2. Noisy data (robustness test): Use the same $f$, $k$, and $L$ as in case $1$, and define $I(z)=I_0\\cos(k z)\\left(1+\\epsilon n(z)\\right)$, where $\\epsilon=0.02$ and $n(z)$ is a zero-mean unit-variance Gaussian sequence. Use a fixed random seed to ensure reproducibility.\n\n3. Non-neutral boundary currents (edge case): Use the same $f$, $k$, and $L$ as in case $1$, and define $I(z)=I_0\\sin(k z)$.\n\nFor all cases, compute:\n- The linear charge density $\\lambda(z)$ in $\\mathrm{C/m}$ from the derived relation connecting $I(z)$ and $\\lambda(z)$.\n- The total charge $Q$ by numerical integration over $z\\in[-L/2,L/2]$.\n- An independent estimate $Q_{\\text{bc}}$ from the boundary currents at $z=-L/2$ and $z=+L/2$.\n- The magnitude $|Q|$ and the consistency error $|Q-Q_{\\text{bc}}|$ in $\\mathrm{C}$.\n- A neutrality boolean with tolerance $\\tau=10^{-8}\\ \\mathrm{C}$.\n\nFinal output format:\nYour program should produce a single line of output containing a list with three sublists corresponding to the three test cases, each sublist of the form $[Q\\_\\text{mag},\\ \\text{consistency\\_error},\\ \\text{neutral}]$. For example: $[[a_1,b_1,\\text{True}],[a_2,b_2,\\text{True}],[a_3,b_3,\\text{False}]]$, with all $a_i$ and $b_i$ in $\\mathrm{C}$.",
            "solution": "The problem requires the derivation of the relationship between the linear charge density $\\lambda(z)$ and the axial current $I(z)$ on a thin wire under time-harmonic conditions, and the design of a robust numerical procedure to compute $\\lambda(z)$ and the total charge $Q$ from discrete samples of $I(z)$.\n\n### Theoretical Derivation\n\nThe foundation for relating charge and current is the principle of conservation of charge, mathematically expressed by the continuity equation:\n$$ \\nabla \\cdot \\mathbf{J} + \\frac{\\partial \\rho}{\\partial t} = 0 $$\nwhere $\\mathbf{J}$ is the current density and $\\rho$ is the volume charge density.\n\nFor a thin wire oriented along the $z$-axis, we can integrate this equation over a cross-sectional area $A$ of the wire. This simplifies the three-dimensional problem to a one-dimensional one. The axial current is $I(z, t) = \\int_A \\mathbf{J} \\cdot \\hat{\\mathbf{z}} \\, dA$, and the linear charge density is $\\lambda(z, t) = \\int_A \\rho \\, dA$. The continuity equation then becomes:\n$$ \\frac{\\partial I(z, t)}{\\partial z} + \\frac{\\partial \\lambda(z, t)}{\\partial t} = 0 $$\nThis equation states that any spatial change in current along the wire must be balanced by a temporal change in the linear charge density.\n\nThe problem specifies a time-harmonic regime with the phasor convention $e^{\\mathrm{j}\\omega t}$, where $\\omega$ is the angular frequency. The time-domain quantities can be represented by their complex phasors $I(z)$ and $\\lambda(z)$ as:\n$$ I(z, t) = \\text{Re}\\{I(z) e^{\\mathrm{j}\\omega t}\\} $$\n$$ \\lambda(z, t) = \\text{Re}\\{\\lambda(z) e^{\\mathrm{j}\\omega t}\\} $$\nTaking the time derivative of $\\lambda(z, t)$ gives:\n$$ \\frac{\\partial \\lambda(z, t)}{\\partial t} = \\frac{\\partial}{\\partial t} \\text{Re}\\{\\lambda(z) e^{\\mathrm{j}\\omega t}\\} = \\text{Re}\\{\\mathrm{j}\\omega \\lambda(z) e^{\\mathrm{j}\\omega t}\\} $$\nThe spatial derivative of current is:\n$$ \\frac{\\partial I(z, t)}{\\partial z} = \\frac{\\partial}{\\partial z} \\text{Re}\\{I(z) e^{\\mathrm{j}\\omega t}\\} = \\text{Re}\\left\\{\\frac{dI(z)}{dz} e^{\\mathrm{j}\\omega t}\\right\\} $$\nSubstituting these expressions back into the 1D continuity equation yields:\n$$ \\text{Re}\\left\\{\\frac{dI(z)}{dz} e^{\\mathrm{j}\\omega t}\\right\\} + \\text{Re}\\{\\mathrm{j}\\omega \\lambda(z) e^{\\mathrm{j}\\omega t}\\} = 0 $$\n$$ \\text{Re}\\left\\{\\left(\\frac{dI(z)}{dz} + \\mathrm{j}\\omega \\lambda(z)\\right) e^{\\mathrm{j}\\omega t}\\right\\} = 0 $$\nFor this equation to hold for all time $t$, the complex quantity in the parentheses must be zero. This gives the fundamental relationship between the phasors for current and charge density:\n$$ \\frac{dI(z)}{dz} + \\mathrm{j}\\omega \\lambda(z) = 0 $$\nSolving for the linear charge density $\\lambda(z)$, we obtain the desired expression:\n$$ \\lambda(z) = -\\frac{1}{\\mathrm{j}\\omega} \\frac{dI(z)}{dz} = \\frac{\\mathrm{j}}{\\omega} \\frac{dI(z)}{dz} $$\nThis equation is the starting point for our numerical procedure.\n\n### Numerical Procedure Design\n\nGiven a set of discrete current samples $I(z_i)$ on a uniform grid $\\{z_i\\}$ for $i=0, 1, \\dots, N-1$ spanning $[-L/2, L/2]$, our procedure is as follows:\n\n1.  **Numerical Differentiation**: To compute $\\frac{dI}{dz}$, we must use a method that is robust to noise, as stipulated. Simple finite difference schemes (e.g., central difference) are known to amplify high-frequency noise. A superior method for this task is the Savitzky-Golay (SG) filter. The SG filter works by fitting a low-degree polynomial to a small window of adjacent data points using the method of linear least squares. The derivative of the data at the center point of the window is then calculated from the derivative of the fitted polynomial. This process effectively smooths the data while computing the derivative, making it stable for noisy signals. We will employ the `scipy.signal.savgol_filter` function, which implements this technique. For the given problem with $N=1001$ points, a window length of $101$ and a polynomial order of $3$ provide a good balance between smoothing and accurately capturing the underlying function's derivative. The derivative is computed as $dI/dz \\approx \\texttt{savgol_filter}(I, \\text{window\\_length}=101, \\text{polyorder}=3, \\text{deriv}=1, \\text{delta}=\\Delta z)$.\n\n2.  **Linear Charge Density Calculation**: With the numerical derivative $(dI/dz)_i$ at each grid point $z_i$, the discrete charge density $\\lambda(z_i)$ is computed directly from the derived formula:\n    $$ \\lambda(z_i) = \\frac{\\mathrm{j}}{\\omega} \\left(\\frac{dI}{dz}\\right)_i $$\n    where $\\omega = 2\\pi f$.\n\n3.  **Total Charge Integration**: The total charge $Q$ on the wire is the integral of the linear charge density over its length:\n    $$ Q = \\int_{-L/2}^{L/2} \\lambda(z) dz $$\n    Given the discrete samples $\\lambda(z_i)$ on a uniform grid, this integral can be accurately approximated using the trapezoidal rule, which is implemented in the `numpy.trapz` function:\n    $$ Q \\approx \\sum_{i=0}^{N-2} \\frac{\\lambda(z_{i+1}) + \\lambda(z_i)}{2} \\Delta z $$\n    where $\\Delta z$ is the spacing between grid points.\n\n4.  **Consistency Check**: An independent estimate for the total charge, $Q_{\\text{bc}}$, can be derived from the boundary currents. Integrating the time-harmonic continuity equation over the entire length of the wire gives:\n    $$ \\int_{-L/2}^{L/2} \\left(\\frac{dI(z)}{dz} + \\mathrm{j}\\omega \\lambda(z)\\right) dz = 0 $$\n    $$ \\int_{-L/2}^{L/2} \\frac{dI(z)}{dz} dz + \\mathrm{j}\\omega \\int_{-L/2}^{L/2} \\lambda(z) dz = 0 $$\n    Applying the fundamental theorem of calculus:\n    $$ [I(z)]_{-L/2}^{L/2} + \\mathrm{j}\\omega Q = 0 $$\n    $$ I(L/2) - I(-L/2) + \\mathrm{j}\\omega Q = 0 $$\n    Solving for $Q$ yields the boundary-current-based estimate:\n    $$ Q_{\\text{bc}} = \\frac{-(I(L/2) - I(-L/2))}{\\mathrm{j}\\omega} = \\frac{\\mathrm{j}}{\\omega} (I(L/2) - I(-L/2)) $$\n    The consistency of the numerical procedure can be quantified by the error $|Q - Q_{\\text{bc}}|$. This error reflects the combined accuracy of the numerical differentiation and integration steps. For an exact analytical calculation, this error would be zero.\n\n5.  **Global Neutrality Test**: Finally, a global neutrality test is performed by comparing the magnitude of the integrated total charge, $|Q|$, against a given tolerance $\\tau$. The wire is considered globally neutral if $|Q| \\le \\tau$. This results in a boolean value. For an ideally isolated wire, the current at the endpoints must be zero, $I(\\pm L/2) = 0$, which from the consistency check implies $Q=0$. Test cases with non-zero endpoint currents will result in a non-zero total charge.\n\nThis comprehensive procedure allows for the robust calculation of charge distribution from current data, including a self-consistency check that validates the numerical methods employed.",
            "answer": "```python\nimport numpy as np\nfrom scipy.signal import savgol_filter\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases, computes charge density,\n    total charge, and performs consistency and neutrality checks.\n    \"\"\"\n    \n    # Define constants and test suite parameters\n    N = 1001\n    C = 299792458.0  # Speed of light in m/s\n    I0 = 1.0  # Amplitude of current in A\n    TAU = 1.0e-8  # Neutrality tolerance in C\n\n    # Test cases: (case_name, current_function_type)\n    # Types: 1=cos(kz), 2=noisy cos(kz), 3=sin(kz)\n    test_cases_params = [\n        (\"Happy path\", 1),\n        (\"Noisy data\", 2),\n        (\"Non-neutral boundary\", 3),\n    ]\n\n    all_results = []\n    \n    # Common parameters for all test cases\n    f = 300.0e6  # Frequency in Hz\n    omega = 2.0 * np.pi * f\n    k = omega / C\n    L = np.pi / k  # Half-wavelength\n    \n    # Create the uniform grid\n    z = np.linspace(-L / 2.0, L / 2.0, N)\n    delta_z = L / (N - 1)\n\n    # Initialize a reproducible random number generator for the noisy case\n    rng = np.random.default_rng(42)\n\n    for _, case_type in test_cases_params:\n        \n        # 1. Generate the current I(z) for the specific case\n        if case_type == 1:\n            # Case 1: I(z) = I0 * cos(kz)\n            I_z = I0 * np.cos(k * z)\n        elif case_type == 2:\n            # Case 2: Noisy version of Case 1\n            epsilon = 0.02\n            noise = rng.normal(0, 1, N)\n            I_z = I0 * np.cos(k * z) * (1.0 + epsilon * noise)\n        elif case_type == 3:\n            # Case 3: I(z) = I0 * sin(kz)\n            I_z = I0 * np.sin(k * z)\n        else:\n            raise ValueError(\"Invalid case type\")\n\n        # 2. Numerical differentiation using Savitzky-Golay filter\n        # This method is robust against noise.\n        # Window length must be odd and less than N.\n        # Polyorder must be less than window length.\n        window_length = 101\n        polyorder = 3\n        dIdz = savgol_filter(I_z, window_length, polyorder, deriv=1, delta=delta_z)\n\n        # 3. Calculate linear charge density lambda(z)\n        # lambda(z) = (j/omega) * dI/dz\n        lambda_z = (1j / omega) * dIdz\n\n        # 4. Calculate total charge Q by numerical integration (trapezoidal rule)\n        Q_integrated = np.trapz(lambda_z, z)\n\n        # 5. Calculate total charge Q_bc from boundary currents for consistency check\n        # Q_bc = (j/omega) * (I(L/2) - I(-L/2))\n        # Note: I_z[0] is I(-L/2) and I_z[-1] is I(L/2)\n        Q_boundary = (1j / omega) * (I_z[-1] - I_z[0])\n        \n        # 6. Compute required outputs\n        # Magnitude of the integrated charge\n        Q_mag = np.abs(Q_integrated)\n        \n        # Consistency error between the two methods of calculating Q\n        consistency_error = np.abs(Q_integrated - Q_boundary)\n        \n        # Neutrality test\n        is_neutral = (Q_mag = TAU)\n        \n        all_results.append([Q_mag, consistency_error, is_neutral])\n\n    # Format the final output string\n    # E.g., [[a_1,b_1,True],[a_2,b_2,True],[a_3,b_3,False]]\n    result_str = \"[\"\n    for i, res in enumerate(all_results):\n        # Format numbers to avoid excessive precision in output, while maintaining accuracy\n        result_str += f\"[{res[0]},{res[1]},{str(res[2]).lower()}]\"\n        if i  len(all_results) - 1:\n            result_str += \",\"\n    result_str += \"]\"\n    \n    print(result_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond simple analysis, a validated computational model becomes a powerful tool for engineering design and optimization. This advanced practice demonstrates how to extend the Method of Moments framework to perform a sensitivity analysis. You will learn to quantify how an antenna's input impedance, $Z_{\\text{in}}$, responds to small variations in its physical dimensions, a crucial skill for understanding manufacturing tolerances and performing gradient-based design optimization .",
            "id": "3355310",
            "problem": "You are to derive and implement a sensitivity-based perturbation of the input impedance for a center-fed, perfectly electrically conducting, straight thin-wire antenna of finite length using a reduced-kernel Electric Field Integral Equation (EFIE) discretized by the Method of Moments (MoM) with pulse basis and point matching. The wire is aligned along the $z$-axis, has radius $a$, total length $\\ell$, and is center-fed by an idealized delta-gap source of fixed voltage $V_{0}$ located at the mid-segment. The surrounding medium is homogeneous, isotropic, and lossless free space with permeability $\\mu_{0}$ and permittivity $\\varepsilon_{0}$, and the source is time-harmonic with angular frequency $\\omega=2\\pi f$ and implicit time dependence $\\mathrm{e}^{j\\omega t}$. Your task is to derive from first principles a matrix-sensitivity expression for the perturbation of the input impedance with respect to small changes in the wire radius and length, and then implement it.\n\nStart from the frequency-domain Maxwell equations and the definition of the scalar Green’s function of free space to justify a reduced one-dimensional thin-wire kernel for the axial field. Use the following discretization assumptions to define the MoM impedance matrix entries:\n- Divide the wire into $N$ uniform segments of length $\\Delta=\\ell/N$. Let the center of segment $m$ be at $z_{m}=\\ell\\,s_{m}$ where $s_{m}=\\frac{m+0.5}{N}-\\frac{1}{2}$ for $m\\in\\{0,1,\\dots,N-1\\}$.\n- Adopt the reduced thin-wire kernel that regularizes the filamentary singularity by the wire radius in the separation:\n$$\nR_{mn}=\\sqrt{\\left(z_{m}-z_{n}\\right)^{2}+a^{2}},\n$$\nand the free-space scalar Green’s function\n$$\nG(R)=\\frac{\\mathrm{e}^{-jkR}}{4\\pi R},\\quad k=\\omega\\sqrt{\\mu_{0}\\varepsilon_{0}}.\n$$\n- Use a pulse basis and point matching quadrature approximation to define the impedance matrix as\n$$\nA_{mn}=j\\omega\\mu_{0}\\,\\Delta^{2}\\,G\\!\\left(R_{mn}\\right),\n$$\nfor all $m,n\\in\\{0,1,\\dots,N-1\\}$.\n\nDefine the excitation vector $\\mathbf{V}$ to represent a center-fed delta-gap source of fixed voltage $V_{0}$ such that\n$$\nV_{n}=\\begin{cases}\nV_{0},  n=n_{0},\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nwhere $n_{0}=\\lfloor N/2\\rfloor$. The current vector $\\mathbf{I}$ satisfies\n$$\n\\mathbf{A}\\,\\mathbf{I}=\\mathbf{V}.\n$$\nDefine the input impedance in ohms as\n$$\nZ_{\\text{in}}=\\frac{V_{0}}{I_{n_{0}}}.\n$$\n\nNow, consider small parametric perturbations $\\delta a$ and $\\delta \\ell$ with fixed $N$ and fixed feed index $n_{0}$. Derive, using matrix calculus and the chain rule, an expression for the first-order perturbation of $Z_{\\text{in}}$ in terms of the derivatives of the MoM matrix with respect to the parameters:\n- Show that\n$$\n\\frac{\\partial \\mathbf{I}}{\\partial p}=-\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I}+\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{V}}{\\partial p},\n$$\nand further obtain\n$$\n\\frac{\\partial Z_{\\text{in}}}{\\partial p}=\\frac{V_{0}}{I_{n_{0}}^{2}}\\left[\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I}-\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{V}}{\\partial p}\\right)\\right],\n$$\nfor any parameter $p\\in\\{a,\\ell\\}$. Here $\\mathbf{e}_{n_{0}}$ is the canonical basis vector with a $1$ at index $n_{0}$ and $0$ elsewhere. Assume that $V_{0}$ and the feed index do not change with $a$ or $\\ell$, so that $\\partial \\mathbf{V}/\\partial p=\\mathbf{0}$.\n- Derive analytic expressions for $\\frac{\\partial \\mathbf{A}}{\\partial a}$ and $\\frac{\\partial \\mathbf{A}}{\\partial \\ell}$ starting from the given definitions of $A_{mn}$, $R_{mn}$, and $\\Delta$. You must explicitly account for the dependence of $\\Delta$ and $z_{m}$ on $\\ell$ with fixed $N$.\n\nFinally, implement a program that:\n1) Constructs $\\mathbf{A}$ and $\\mathbf{V}$, solves for $\\mathbf{I}$, and computes $Z_{\\text{in}}$.\n2) Constructs $\\frac{\\partial \\mathbf{A}}{\\partial a}$ and $\\frac{\\partial \\mathbf{A}}{\\partial \\ell}$ analytically.\n3) Computes $\\frac{\\partial Z_{\\text{in}}}{\\partial a}$ and $\\frac{\\partial Z_{\\text{in}}}{\\partial \\ell}$ using the derived expressions by solving auxiliary linear systems, and then forms the first-order perturbations\n$$\n\\delta Z_{\\text{in},a}\\approx \\frac{\\partial Z_{\\text{in}}}{\\partial a}\\,\\delta a,\\qquad\n\\delta Z_{\\text{in},\\ell}\\approx \\frac{\\partial Z_{\\text{in}}}{\\partial \\ell}\\,\\delta \\ell.\n$$\nReport the real and imaginary parts of these complex perturbations in ohms.\n\nPhysical constants and units:\n- Use $\\mu_{0}=4\\pi\\times 10^{-7}\\,\\mathrm{H/m}$ and $\\varepsilon_{0}=1/(\\mu_{0}c_{0}^{2})$ with $c_{0}=299\\,792\\,458\\,\\mathrm{m/s}$. Frequency $f$ in $\\mathrm{Hz}$, length and radius in $\\mathrm{m}$, and output impedances in $\\mathrm{\\Omega}$.\n\nAngle units: if any angle arises, use radians.\n\nTest suite:\nUse the following four test cases, each specified as a tuple $\\left(f,\\,a,\\,\\ell,\\,N,\\,\\delta a,\\,\\delta \\ell\\right)$ in SI units:\n- Case $1$: $(300\\times 10^{6},\\,0.001,\\,0.50,\\,41,\\,1.0\\times 10^{-5},\\,1.0\\times 10^{-3})$.\n- Case $2$: $(300\\times 10^{6},\\,0.001,\\,0.10,\\,41,\\,1.0\\times 10^{-5},\\,2.0\\times 10^{-4})$.\n- Case $3$: $(200\\times 10^{6},\\,0.0005,\\,1.125,\\,61,\\,5.0\\times 10^{-6},\\,1.0\\times 10^{-3})$.\n- Case $4$: $(600\\times 10^{6},\\,0.0015,\\,0.24,\\,41,\\,1.0\\times 10^{-5},\\,5.0\\times 10^{-4})$.\n\nRequired final output format:\nYour program should produce a single line of output containing a flat list of $16$ floating-point numbers arranged, for each case in order, as\n$$\n\\left[\\Re\\{\\delta Z_{\\text{in},a}\\},\\,\\Im\\{\\delta Z_{\\text{in},a}\\},\\,\\Re\\{\\delta Z_{\\text{in},\\ell}\\},\\,\\Im\\{\\delta Z_{\\text{in},\\ell}\\},\\,\\dots\\right],\n$$\nwith values in $\\mathrm{\\Omega}$, concatenated across the four test cases. Print the list exactly as a comma-separated list enclosed in square brackets with no extra text.",
            "solution": "The problem requires the derivation and implementation of a sensitivity analysis for the input impedance of a center-fed thin-wire antenna. The analysis is based on a Method of Moments (MoM) discretization of a reduced-kernel Electric Field Integral Equation (EFIE). We will first validate the problem, then present the theoretical derivations, and finally outline the computational implementation.\n\n### **Problem Validation**\n\n**Step 1: Extracted Givens**\n- **Antenna Model:** Perfectly electrically conducting (PEC), straight thin wire of length $\\ell$ and radius $a$, aligned with the $z$-axis.\n- **Medium:** Free space with permeability $\\mu_{0}$ and permittivity $\\varepsilon_{0}$.\n- **Source:** Time-harmonic ($\\mathrm{e}^{j\\omega t}$) with angular frequency $\\omega=2\\pi f$, idealized delta-gap at the center with fixed voltage $V_{0}$.\n- **Discretization (MoM):**\n    - $N$ uniform segments of length $\\Delta = \\ell/N$.\n    - Segment centers: $z_{m}=\\ell\\,s_{m}$ with $s_{m}=\\frac{m+0.5}{N}-\\frac{1}{2}$ for $m\\in\\{0, 1, \\dots, N-1\\}$.\n    - Basis functions: Pulse basis.\n    - Testing: Point matching (collocation).\n- **Mathematical Definitions:**\n    - Free-space wavenumber: $k=\\omega\\sqrt{\\mu_{0}\\varepsilon_{0}}$.\n    - Scalar Green’s function: $G(R)=\\frac{\\mathrm{e}^{-jkR}}{4\\pi R}$.\n    - Separation distance: $R_{mn}=\\sqrt{(z_{m}-z_{n})^{2}+a^{2}}$.\n    - Impedance matrix entries: $A_{mn}=j\\omega\\mu_{0}\\,\\Delta^{2}\\,G(R_{mn})$.\n    - Excitation vector: $V_{n}=V_{0}\\,\\delta_{n, n_{0}}$, where $n_{0}=\\lfloor N/2\\rfloor$ and $\\delta_{n,n_0}$ is the Kronecker delta.\n    - Linear system: $\\mathbf{A}\\,\\mathbf{I}=\\mathbf{V}$.\n    - Input impedance: $Z_{\\text{in}}=V_{0}/I_{n_{0}}$.\n- **Task:**\n    1. Derive the sensitivity expression: $\\frac{\\partial Z_{\\text{in}}}{\\partial p}=\\frac{V_{0}}{I_{n_{0}}^{2}}\\left[\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I}-\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{V}}{\\partial p}\\right)\\right]$, for $p \\in \\{a, \\ell\\}$.\n    2. Derive analytic expressions for $\\frac{\\partial \\mathbf{A}}{\\partial a}$ and $\\frac{\\partial \\mathbf{A}}{\\partial \\ell}$.\n    3. Implement a program to compute the first-order perturbations $\\delta Z_{\\text{in},a}$ and $\\delta Z_{\\text{in},\\ell}$.\n\n**Step 2: Validation Using Extracted Givens**\n- **Scientific Grounding:** The problem is firmly rooted in computational electromagnetics. The use of an EFIE, MoM with pulse basis and point matching, and a reduced thin-wire kernel are all standard, well-established techniques for analyzing wire antennas. Sensitivity analysis using matrix calculus is a valid and powerful mathematical method.\n- **Well-Posedness:** The problem is well-posed. The MoM formulation leads to a dense linear system $\\mathbf{A}\\,\\mathbf{I}=\\mathbf{V}$. For the given parameters, the matrix $\\mathbf{A}$ is invertible, guaranteeing a unique solution for the current vector $\\mathbf{I}$ and consequently a unique value for $Z_{\\text{in}}$ and its sensitivities.\n- **Objectivity:** The problem is expressed in precise, objective mathematical language, free from ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. It presents a standard, non-trivial task in antenna analysis and design. No invalidating flaws are identified. We proceed with the solution.\n\n### **Theoretical Derivation**\n\n**1. Integral Equation Formulation**\nThe foundation of this problem is the frequency-domain Electric Field Integral Equation (EFIE) for a thin wire. For a PEC wire aligned along the $z$-axis, the total tangential electric field on its surface must be zero. The total field is the sum of the incident field $E_z^{\\text{inc}}$ (from the source) and the scattered field $E_z^{\\text{scat}}$ (from the induced currents on the wire).\n$$E_z^{\\text{inc}}(z) + E_z^{\\text{scat}}(z) = 0 \\quad \\text{on the wire surface}$$\nThe scattered field is related to the antenna current $I(z')$ through the vector and scalar potentials, which are themselves integrals of the current weighted by the Green's function. The problem provides a simplified, discretized form of the resulting integral equation (specifically, a Pocklington-type EFIE) obtained via the Method of Moments (MoM). The current $I(z)$ is approximated as a piecewise constant (pulse) function over $N$ segments, and the integral equation is enforced at the center of each segment (point matching). This process transforms the continuous integral equation into the matrix system $\\mathbf{A}\\,\\mathbf{I}=\\mathbf{V}$, where $\\mathbf{I}$ is the vector of unknown current coefficients on each segment. The matrix $\\mathbf{A}$ and vector $\\mathbf{V}$ are as defined in the problem statement.\n\n**2. Derivation of Input Impedance Sensitivity**\nWe are tasked with deriving the sensitivity of the input impedance $Z_{\\text{in}}$ with respect to a generic parameter $p$.\nThe fundamental linear system is:\n$$\\mathbf{A}\\,\\mathbf{I} = \\mathbf{V}$$\nDifferentiating both sides with respect to $p$ using the product rule yields:\n$$\\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I} + \\mathbf{A}\\,\\frac{\\partial \\mathbf{I}}{\\partial p} = \\frac{\\partial \\mathbf{V}}{\\partial p}$$\nAssuming $\\mathbf{A}$ is invertible, we can solve for the sensitivity of the current vector, $\\frac{\\partial \\mathbf{I}}{\\partial p}$:\n$$\\mathbf{A}\\,\\frac{\\partial \\mathbf{I}}{\\partial p} = \\frac{\\partial \\mathbf{V}}{\\partial p} - \\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I}$$\n$$\\frac{\\partial \\mathbf{I}}{\\partial p} = \\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{V}}{\\partial p} - \\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I}\\right) = -\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I} + \\mathbf{A}^{-1}\\frac{\\partial \\mathbf{V}}{\\partial p}$$\nThis confirms the first expression provided in the problem statement.\n\nNext, we find the sensitivity of the input impedance, defined as $Z_{\\text{in}} = V_{0} / I_{n_{0}}$. Using the quotient rule:\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = \\frac{\\partial}{\\partial p}\\left(\\frac{V_{0}}{I_{n_{0}}}\\right) = \\frac{(\\frac{\\partial V_{0}}{\\partial p})I_{n_{0}} - V_{0}(\\frac{\\partial I_{n_{0}}}{\\partial p})}{I_{n_{0}}^2}$$\nThe problem states that $V_{0}$ is a fixed voltage, so $\\frac{\\partial V_{0}}{\\partial p}=0$.\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = -\\frac{V_{0}}{I_{n_{0}}^2}\\frac{\\partial I_{n_{0}}}{\\partial p}$$\nThe term $\\frac{\\partial I_{n_{0}}}{\\partial p}$ is the $n_{0}$-th component of the vector $\\frac{\\partial \\mathbf{I}}{\\partial p}$. We can extract this component using the canonical basis vector $\\mathbf{e}_{n_{0}}$ (which has a $1$ at index $n_{0}$ and $0$ elsewhere):\n$$\\frac{\\partial I_{n_{0}}}{\\partial p} = \\mathbf{e}_{n_{0}}^{T}\\frac{\\partial \\mathbf{I}}{\\partial p} = \\mathbf{e}_{n_{0}}^{T}\\left(-\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I} + \\mathbf{A}^{-1}\\frac{\\partial \\mathbf{V}}{\\partial p}\\right)$$\nSubstituting this back into the expression for $\\frac{\\partial Z_{\\text{in}}}{\\partial p}$:\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = -\\frac{V_{0}}{I_{n_{0}}^2}\\left(-\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\,\\mathbf{I} + \\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{V}}{\\partial p}\\right)$$\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = \\frac{V_{0}}{I_{n_{0}}^2}\\left[\\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I} - \\mathbf{e}_{n_{0}}^{T}\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{V}}{\\partial p}\\right)\\right]$$\nThis confirms the second expression. The problem specifies that the parameters are antenna radius $a$ and length $\\ell$. The excitation vector $\\mathbf{V}$ depends on $V_{0}$ and the feed index $n_{0}$, both of which are fixed. Thus, $\\mathbf{V}$ is independent of $a$ and $\\ell$, which means $\\frac{\\partial \\mathbf{V}}{\\partial p} = \\mathbf{0}$. The final sensitivity expression is:\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = \\frac{V_{0}}{I_{n_{0}}^2}\\,\\mathbf{e}_{n_{0}}^{T}\\,\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I}$$\n\n**3. Derivation of Parametric Matrix Derivatives**\nWe must now find the analytical expressions for the entries of the matrices $\\frac{\\partial \\mathbf{A}}{\\partial a}$ and $\\frac{\\partial \\mathbf{A}}{\\partial \\ell}$.\nThe impedance matrix entry is given by $A_{mn}=j\\omega\\mu_{0}\\,\\Delta^{2}\\,G(R_{mn}) = \\frac{j\\omega\\mu_{0}}{4\\pi}\\,\\Delta^{2}\\,\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}$.\n\n**Derivative with respect to radius $a$:**\nThe terms $\\Delta = \\ell/N$ and $z_m, z_n$ are independent of $a$. Only $R_{mn} = \\sqrt{(z_m-z_n)^2 + a^2}$ depends on $a$. We use the chain rule:\n$$\\frac{\\partial A_{mn}}{\\partial a} = \\frac{\\partial A_{mn}}{\\partial R_{mn}} \\frac{\\partial R_{mn}}{\\partial a}$$\nFirst, $\\frac{\\partial R_{mn}}{\\partial a} = \\frac{1}{2 R_{mn}} (2a) = \\frac{a}{R_{mn}}$.\nSecond, $\\frac{\\partial A_{mn}}{\\partial R_{mn}} = \\frac{j\\omega\\mu_{0}\\Delta^2}{4\\pi} \\frac{\\partial}{\\partial R_{mn}}\\left(\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right)$.\nUsing the quotient rule on $\\frac{\\mathrm{e}^{-jkR}}{R}$:\n$$\\frac{\\partial}{\\partial R}\\left(\\frac{\\mathrm{e}^{-jkR}}{R}\\right) = \\frac{(-jk\\mathrm{e}^{-jkR})R - \\mathrm{e}^{-jkR}(1)}{R^2} = -\\frac{\\mathrm{e}^{-jkR}}{R^2}(1+jkR)$$\nSo, $\\frac{\\partial A_{mn}}{\\partial R_{mn}} = A_{mn} \\left(-\\frac{1+jkR_{mn}}{R_{mn}}\\right) / \\Delta^2$. The expression in the text is for $G(R)$, let's re-write more carefully.\n$\\frac{\\partial A_{mn}}{\\partial R_{mn}} = j\\omega\\mu_0\\Delta^2 \\frac{\\partial G(R_{mn})}{\\partial R_{mn}} = j\\omega\\mu_0\\Delta^2 G(R_{mn}) \\left(-\\frac{1+jkR_{mn}}{R_{mn}}\\right) = A_{mn} \\left(-\\frac{1+jkR_{mn}}{R_{mn}}\\right)$.\nCombining the parts:\n$$\\frac{\\partial A_{mn}}{\\partial a} = A_{mn} \\left(-\\frac{1+jkR_{mn}}{R_{mn}}\\right) \\left(\\frac{a}{R_{mn}}\\right) = -A_{mn} \\frac{a(1+jkR_{mn})}{R_{mn}^2}$$\n\n**Derivative with respect to length $\\ell$:**\nThis is more involved as $\\Delta=\\ell/N$, $z_m=\\ell s_m$, and $R_{mn}$ all depend on $\\ell$. Let $z_{mn} = z_m - z_n = \\ell(s_m-s_n)$.\n$$A_{mn} = K \\ell^2 \\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}, \\quad \\text{where } K=\\frac{j\\omega\\mu_{0}}{4\\pi N^2} \\text{ is a constant wrt } \\ell$$\nUsing the product rule and chain rule:\n$$\\frac{\\partial A_{mn}}{\\partial \\ell} = \\frac{\\partial}{\\partial \\ell} \\left(K \\ell^2 \\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right) = K\\left(2\\ell \\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}} + \\ell^2 \\frac{\\partial}{\\partial \\ell}\\left(\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right)\\right)$$\nThe first term is $\\frac{2}{\\ell} \\left(K \\ell^2 \\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right) = \\frac{2}{\\ell} A_{mn}$.\nFor the second term: $\\quad \\frac{\\partial}{\\partial \\ell}\\left(\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right) = \\frac{\\partial}{\\partial R_{mn}}\\left(\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right) \\frac{\\partial R_{mn}}{\\partial \\ell}$.\nWe already know $\\frac{\\partial}{\\partial R}\\left(\\frac{\\mathrm{e}^{-jkR}}{R}\\right) = -\\frac{\\mathrm{e}^{-jkR}}{R^2}(1+jkR)$.\nWe need $\\frac{\\partial R_{mn}}{\\partial \\ell}$:\n$$R_{mn}^2 = z_{mn}^2 + a^2 = \\ell^2(s_m-s_n)^2 + a^2$$\n$$2 R_{mn} \\frac{\\partial R_{mn}}{\\partial \\ell} = 2\\ell(s_m-s_n)^2 = \\frac{2z_{mn}^2}{\\ell} \\implies \\frac{\\partial R_{mn}}{\\partial \\ell} = \\frac{z_{mn}^2}{\\ell R_{mn}}$$\nPutting it all together for the second part of the derivative:\n$\\ell^2 \\left[K \\frac{\\partial}{\\partial\\ell}(\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}})\\right] = \\ell^2 \\left[K \\left(-\\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}^2}(1+jkR_{mn})\\right) \\left(\\frac{z_{mn}^2}{\\ell R_{mn}}\\right) \\right] = \\left(K \\ell^2 \\frac{\\mathrm{e}^{-jkR_{mn}}}{R_{mn}}\\right) \\left(-\\frac{z_{mn}^2(1+jkR_{mn})}{\\ell R_{mn}^2}\\right) = -A_{mn}\\frac{z_{mn}^2(1+jkR_{mn})}{\\ell R_{mn}^2}$.\nCombining both parts:\n$$\\frac{\\partial A_{mn}}{\\partial \\ell} = \\frac{2}{\\ell}A_{mn} - A_{mn}\\frac{z_{mn}^2(1+jkR_{mn})}{\\ell R_{mn}^2} = A_{mn}\\left[\\frac{2}{\\ell} - \\frac{z_{mn}^2(1+jkR_{mn})}{\\ell R_{mn}^2}\\right]$$\n\n**4. Computational Strategy**\nThe sensitivity expression $\\frac{\\partial Z_{\\text{in}}}{\\partial p} = \\frac{V_{0}}{I_{n_{0}}^2}\\,\\mathbf{e}_{n_{0}}^{T}\\,\\mathbf{A}^{-1}\\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I}$ requires the calculation of $\\mathbf{A}^{-1}$ acting on a vector. A direct computation of $\\mathbf{A}^{-1}$ is numerically expensive and unstable. A more efficient approach is to solve auxiliary linear systems.\n\nSince $\\mathbf{I} = \\mathbf{A}^{-1}\\mathbf{V} = V_0 \\mathbf{A}^{-1}\\mathbf{e}_{n_0}$, we can write $\\mathbf{A}^{-1}\\mathbf{e}_{n_0} = \\mathbf{I}/V_0$.\nThe sensitivity becomes:\n$$\\frac{\\partial Z_{\\text{in}}}{\\partial p} = \\frac{V_{0}}{I_{n_{0}}^2}\\,\\left(\\frac{\\mathbf{I}}{V_0}\\right)^T \\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I} = \\frac{1}{I_{n_{0}}^2}\\,\\mathbf{I}^T \\left(\\frac{\\partial \\mathbf{A}}{\\partial p}\\right)\\mathbf{I}$$\nBecause $\\mathbf{A}$ is symmetric ($A_{mn}=A_{nm}$), $\\frac{\\partial \\mathbf{A}}{\\partial p}$ is also symmetric. Therefore, this expression is valid. However, the provided code implements an even more efficient approach based on the adjoint variable method. Let's trace that. Let $\\mathbf{J} = \\mathbf{A}^{-1}\\mathbf{e}_{n_0}$ (current for unit voltage). Then $I_{n_0} = V_0 J_{n_0}$ and $Z_{in} = V_0/I_{n_0} = 1/J_{n_0}$.\n$$\\frac{\\partial Z_{in}}{\\partial p} = -\\frac{1}{J_{n_0}^2}\\frac{\\partial J_{n_0}}{\\partial p} = -Z_{in}^2 \\frac{\\partial J_{n_0}}{\\partial p}$$\nFrom $\\mathbf{A}\\mathbf{J}=\\mathbf{e}_{n_0}$, we differentiate wrt $p$: $\\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J} + \\mathbf{A}\\frac{\\partial \\mathbf{J}}{\\partial p} = \\mathbf{0}$.\nSo, $\\frac{\\partial \\mathbf{J}}{\\partial p} = -\\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J}$.\nAnd $\\frac{\\partial J_{n_0}}{\\partial p} = \\mathbf{e}_{n_0}^T \\frac{\\partial \\mathbf{J}}{\\partial p} = -\\mathbf{e}_{n_0}^T \\mathbf{A}^{-1}\\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J}$.\nUsing symmetry of $\\mathbf{A}^{-1}$, $\\mathbf{e}_{n_0}^T \\mathbf{A}^{-1} = (\\mathbf{A}^{-1}\\mathbf{e}_{n_0})^T = \\mathbf{J}^T$.\nSo, $\\frac{\\partial J_{n_0}}{\\partial p} = -\\mathbf{J}^T \\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J}$.\nFinally, $\\frac{\\partial Z_{in}}{\\partial p} = -Z_{in}^2 (-\\mathbf{J}^T \\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J}) = Z_{in}^2 \\mathbf{J}^T \\frac{\\partial \\mathbf{A}}{\\partial p}\\mathbf{J}$. This confirms the method used in the provided code.\n\nThe algorithm is as follows:\n1. For each test case, define physical and geometric parameters.\n2. Construct the MoM impedance matrix $\\mathbf{A}$ and the derivative matrices $\\frac{\\partial \\mathbf{A}}{\\partial a}$ and $\\frac{\\partial \\mathbf{A}}{\\partial \\ell}$ using the derived analytical expressions.\n3. Define the excitation vector $\\mathbf{e}_{n_{0}}$.\n4. Solve the auxiliary system $\\mathbf{A}\\mathbf{J}=\\mathbf{e}_{n_0}$ for the vector $\\mathbf{J}$.\n5. Calculate the baseline input impedance $Z_{\\text{in}} = 1/J_{n_0}$.\n6. Calculate the impedance sensitivities $\\frac{\\partial Z_{\\text{in}}}{\\partial a} = Z_{\\text{in}}^2 \\mathbf{J}^T (\\frac{\\partial \\mathbf{A}}{\\partial a}) \\mathbf{J}$ and $\\frac{\\partial Z_{\\text{in}}}{\\partial \\ell} = Z_{\\text{in}}^2 \\mathbf{J}^T (\\frac{\\partial \\mathbf{A}}{\\partial \\ell}) \\mathbf{J}$.\n7. Compute the first-order perturbations: $\\delta Z_{\\text{in},a} = \\frac{\\partial Z_{\\text{in}}}{\\partial a} \\delta a$ and $\\delta Z_{\\text{in},\\ell} = \\frac{\\partial Z_{\\text{in}}}{\\partial \\ell} \\delta \\ell$.\n8. Report the real and imaginary parts of these complex-valued perturbations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the first-order perturbation of the input impedance of a thin-wire\n    antenna with respect to changes in its radius and length.\n    \"\"\"\n    \n    # Physical constants\n    MU0 = 4 * np.pi * 1e-7  # Permeability of free space (H/m)\n    C0 = 299792458.0      # Speed of light in vacuum (m/s)\n\n    # Test cases: (f, a, l, N, da, dl)\n    test_cases = [\n        (300e6, 0.001, 0.50, 41, 1.0e-5, 1.0e-3),\n        (300e6, 0.001, 0.10, 41, 1.0e-5, 2.0e-4),\n        (200e6, 0.0005, 1.125, 61, 5.0e-6, 1.0e-3),\n        (600e6, 0.0015, 0.24, 41, 1.0e-5, 5.0e-4),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        f, a, l, N, da, dl = case\n        \n        # --- 1. Define parameters ---\n        omega = 2 * np.pi * f\n        k = omega / C0\n        delta_l_seg = l / N\n        n0 = int(np.floor(N / 2)) # Feed segment index\n        \n        # --- 2. Construct mesh and matrices ---\n        m_indices = np.arange(N)\n        s_m = (m_indices + 0.5) / N - 0.5\n        z_m = l * s_m\n        \n        # Vectorized matrix construction\n        # z_m is (N,), z_m[:, None] is (N, 1), z_m[None, :] is (1, N)\n        # Broadcasting creates an (N, N) matrix of differences\n        z_mn = z_m[:, None] - z_m[None, :]\n        \n        # R_mn matrix\n        R_mn = np.sqrt(z_mn**2 + a**2)\n        \n        # Green's function\n        G_mn = np.exp(-1j * k * R_mn) / (4 * np.pi * R_mn)\n        \n        # Impedance matrix A\n        A = 1j * omega * MU0 * delta_l_seg**2 * G_mn\n        \n        # --- 3. Construct derivative matrices dA/da and dA/dl ---\n        \n        # dA/da\n        factor_a = -a * (1 + 1j * k * R_mn) / (R_mn**2)\n        dA_da = A * factor_a\n        \n        # dA/dl\n        factor_l = (2 / l) - (z_mn**2 * (1 + 1j * k * R_mn)) / (l * R_mn**2)\n        dA_dl = A * factor_l\n        \n        # --- 4. Solve for auxiliary vector J and Z_in ---\n        e_n0 = np.zeros(N, dtype=np.complex128)\n        e_n0[n0] = 1.0\n        \n        # Solve the auxiliary system A*J = e_n0\n        J = np.linalg.solve(A, e_n0)\n        \n        # Calculate input impedance\n        Z_in = 1.0 / J[n0]\n        \n        # --- 5. Compute impedance sensitivities ---\n        \n        # dZ_in/da\n        dZ_in_da = Z_in**2 * np.dot(J.conj(), dA_da @ J)\n        \n        # dZ_in/dl\n        dZ_in_dl = Z_in**2 * np.dot(J.conj(), dA_dl @ J)\n\n        # --- 6. Compute perturbations ---\n        delta_Z_in_a = dZ_in_da * da\n        delta_Z_in_l = dZ_in_dl * dl\n        \n        # --- 7. Store results ---\n        results.extend([\n            delta_Z_in_a.real, delta_Z_in_a.imag,\n            delta_Z_in_l.real, delta_Z_in_l.imag\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.8f}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}