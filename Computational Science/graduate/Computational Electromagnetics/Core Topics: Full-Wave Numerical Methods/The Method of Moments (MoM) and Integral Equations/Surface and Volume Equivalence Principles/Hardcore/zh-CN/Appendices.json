{
    "hands_on_practices": [
        {
            "introduction": "表面等效原理将电磁散射问题转化为求解边界上的等效电流，这通常涉及到求解表面积分方程 (SIE)。在数值实现中，一个核心挑战是如何处理源点和场点重合时出现的奇异性。本练习  将引导您通过局部坐标变换来解析地处理这种奇异性，这是确保基于积分方程的计算方法精度的基本功。",
            "id": "3352217",
            "problem": "考虑计算电磁学中的表面等效原理：散射体外部的场可以用边界表面上的等效面电流来表示。在频域中，相应的积分算子涉及亥姆霍兹方程的自由空间标量格林函数，其在源点和观测点重合附近的领先阶奇异结构由因子 $1/|\\mathbf{r}-\\mathbf{r}'|$ 决定。对此类奇异面积分进行精确的数值积分，需要将被积函数转换到曲面上的局部坐标系中，以便明确地处理奇异性。\n\n从麦克斯韦方程组和亥姆霍兹算子的自由空间标量格林函数定义出发，分析积分\n$$\nI[\\phi](\\mathbf{r}) \\equiv \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\, dS',\n$$\n的局部奇异行为，其中 $S$ 是 $\\mathbb{R}^3$ 中的一个光滑可定向曲面，$\\phi(\\mathbf{r}')$ 是由表面等效原理在 $S$ 上感生的等效面电流密度所导出的一个足够光滑的标量权函数。在点 $\\mathbf{r}_0 \\in S$ 处引入一个局部标准正交切框架及在 $\\mathbf{r}_0$ 邻域内相应的局部坐标图 $(u,v)$，将被积函数的奇异部分转换到切平面上的局部极坐标 $(\\rho,\\theta)$ 中，并论证这种方法为何能实现对奇异贡献的有限解析计算。\n\n然后，通过一个基准几何结构来验证该变换及其解析计算：设 $S$ 是一个半径为 $a0$ 的平面圆盘，位于 $z=0$ 平面内，以原点为中心，并设观测点为圆盘中心的 $\\mathbf{r}=\\mathbf{0}$。选择常数权函数 $\\phi(\\mathbf{r}') \\equiv 1$，并通过转换到圆盘上的局部极坐标来精确计算该奇异积分\n$$\nI(a) \\equiv \\int_{S} \\frac{1}{|\\mathbf{r}'|} \\, dS'\n$$\n请以包含 $a$ 的闭式解析表达式给出最终答案。不要进行任何数值近似或四舍五入。",
            "solution": "该问题陈述内部一致，科学上基于电磁学和势论的原理，并且是适定的。分析和具体计算所需的所有数据和定义均已提供。因此，该问题是有效的。\n\n该问题要求完成两项任务：首先，对一个特定面积分算子的奇异行为进行一般性分析；其次，对一个基准情况下的该积分进行精确计算。\n\n第一部分：奇异性的一般性分析\n\n所讨论的积分是单层势算子，由下式给出\n$$\nI[\\phi](\\mathbf{r}) \\equiv \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\, dS'\n$$\n其中 $S$ 是 $\\mathbb{R}^3$ 中的一个光滑可定向曲面，$\\phi(\\mathbf{r}')$ 是一个光滑标量函数，$\\mathbf{r}$ 是观测点，$\\mathbf{r}'$ 是 $S$ 上的源点。该积分算子出现在使用边界积分方程方法求解拉普拉斯方程或亥姆霍兹方程的过程中，这些方法通过表面等效原理成为计算电磁学的核心。\n\n当观测点 $\\mathbf{r}$ 与曲面 $S$ 上的源点 $\\mathbf{r}'$ 重合时，被积函数呈现出奇异性。我们来分析当 $\\mathbf{r} = \\mathbf{r}_0 \\in S$ 时积分的行为。该积分变为一个瑕积分：\n$$\nI[\\phi](\\mathbf{r}_0) = \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}_0-\\mathbf{r}'|} \\, dS'\n$$\n为了确定该积分是否收敛并对其进行求值，我们必须分析其奇异性。这通常通过转换到以奇异点 $\\mathbf{r}_0$ 为中心的局部坐标系来完成。\n\n我们在 $\\mathbf{r}_0$ 处引入一个局部坐标系。在 $\\mathbf{r}_0$ 的邻域内，曲面 $S$ 可以用其在该点的切平面来近似。我们可以定义一个局部标准正交基 $\\{\\hat{\\mathbf{u}}, \\hat{\\mathbf{v}}, \\hat{\\mathbf{n}}\\}$，其中 $\\hat{\\mathbf{u}}$ 和 $\\hat{\\mathbf{v}}$ 是张成 $\\mathbf{r}_0$ 处切平面的切向量，$\\hat{\\mathbf{n}}$ 是单位法向量。曲面上靠近 $\\mathbf{r}_0$ 的一点 $\\mathbf{r}'$ 可以通过其在切平面上的投影来近似：\n$$\n\\mathbf{r}' - \\mathbf{r}_0 \\approx u \\hat{\\mathbf{u}} + v \\hat{\\mathbf{v}}\n$$\n其中 $(u,v)$ 是切平面中的局部笛卡尔坐标。在此近似下，距离向量为 $\\mathbf{r}' - \\mathbf{r}_0$，其大小为 $|\\mathbf{r}' - \\mathbf{r}_0| \\approx \\sqrt{u^2+v^2}$。曲面上的微分面元 $dS'$ 近似为切平面上的微分面积元，$dS' \\approx du \\, dv$。\n\n由于标量权函数 $\\phi(\\mathbf{r}')$ 假定为足够光滑，在 $\\mathbf{r}_0$ 的一个小邻域内，我们可以用其在 $\\mathbf{r}_0$ 处的值来近似，即 $\\phi(\\mathbf{r}') \\approx \\phi(\\mathbf{r}_0)$。此近似的误差贡献了积分的一个正则、非奇异部分。奇异行为通过将此领先阶项在切平面上围绕 $\\mathbf{r}_0$ 的一个小片（例如半径为 $\\epsilon$ 的圆盘 $D_\\epsilon$）上积分来捕捉。因此，奇异贡献可近似为：\n$$\n\\int_{D_\\epsilon} \\frac{\\phi(\\mathbf{r}_0)}{\\sqrt{u^2 + v^2}} \\, du \\, dv\n$$\n为了计算这个积分，我们将局部笛卡尔坐标 $(u,v)$ 变换为局部极坐标 $(\\rho, \\theta)$，其中 $u = \\rho \\cos\\theta$，$v = \\rho \\sin\\theta$。径向距离为 $\\rho = \\sqrt{u^2+v^2}$。该变换的雅可比行列式为 $\\rho$，因此面积元变为 $du \\, dv = \\rho \\, d\\rho \\, d\\theta$。对于圆盘 $D_\\epsilon$，积分限为 $\\rho \\in [0, \\epsilon]$ 和 $\\theta \\in [0, 2\\pi]$。\n\n将这些代入积分中，我们得到：\n$$\n\\int_0^{2\\pi} \\int_0^\\epsilon \\frac{\\phi(\\mathbf{r}_0)}{\\rho} (\\rho \\, d\\rho \\, d\\theta) = \\int_0^{2\\pi} \\int_0^\\epsilon \\phi(\\mathbf{r}_0) \\, d\\rho \\, d\\theta\n$$\n这个变换是关键步骤。来自格林函数核的 $1/\\rho$ 奇异性被极坐标变换的雅可比因子 $\\rho$ 完全抵消。得到的被积函数 $\\phi(\\mathbf{r}_0)$ 相对于 $\\rho$ 和 $\\theta$ 是常数。积分现在是正则的，可以直接计算：\n$$\n\\phi(\\mathbf{r}_0) \\int_0^{2\\pi} \\left[ \\rho \\right]_0^\\epsilon \\, d\\theta = \\phi(\\mathbf{r}_0) \\int_0^{2\\pi} \\epsilon \\, d\\theta = \\phi(\\mathbf{r}_0) (\\epsilon [ \\theta ]_0^{2\\pi}) = 2\\pi\\epsilon\\phi(\\mathbf{r}_0)\n$$\n这个结果是有限的，表明该奇异性是可积的（通常称为“弱奇异性”）。变换到以奇异点为中心的局部极坐标系，明确地使被积函数正则化，从而允许对其进行解析或精确的数值计算。这一原理是边界积分方程数值解中使用的奇异性减除和抵消技术的基础。\n\n第二部分：基准计算\n\n我们被要求通过为一个确定的几何结构计算一个特定的积分来验证此过程。该积分为：\n$$\nI(a) \\equiv \\int_{S} \\frac{1}{|\\mathbf{r}'|} \\, dS'\n$$\n曲面 $S$ 是一个半径为 $a  0$ 的平面圆盘，位于 $z=0$ 平面内，以原点为中心。观测点被指定为 $\\mathbf{r}=\\mathbf{0}$，即圆盘的中心。这意味着我们是在源分布的中心（即观测点处）计算积分，这是一个如上文分析的奇异情况。问题设定了权函数 $\\phi(\\mathbf{r}') \\equiv 1$，观测点 $\\mathbf{r}$ 位于原点，因此被积函数为 $\\frac{1}{|\\mathbf{0}-\\mathbf{r}'|} = \\frac{1}{|\\mathbf{r}'|}$。\n\n这个几何结构是上述一般原理的直接应用。曲面 $S$ 本身就是一个平面，因此圆盘上任意一点的切平面就是圆盘所在的平面（$z=0$ 平面）。我们可以立即在该平面上应用极坐标来计算积分。\n\n圆盘上的一点 $\\mathbf{r}'$ 可以用极坐标 $(\\rho, \\theta)$ 表示，其中 $\\rho$ 是距原点的径向距离，$\\theta$ 是方位角。其笛卡尔坐标为 $x' = \\rho\\cos\\theta$ 和 $y' = \\rho\\sin\\theta$。从原点到点 $\\mathbf{r}'$ 的距离是 $|\\mathbf{r}'| = \\rho$。在极坐标中，微分面元是 $dS' = \\rho \\, d\\rho \\, d\\theta$。对于半径为 $a$ 的圆盘，积分域为 $\\rho \\in [0, a]$ 和 $\\theta \\in [0, 2\\pi]$。\n\n将这些代入 $I(a)$ 的积分表达式中：\n$$\nI(a) = \\int_0^{2\\pi} \\int_0^a \\frac{1}{\\rho} (\\rho \\, d\\rho \\, d\\theta)\n$$\n如同在一般性分析中，奇异性 $1/\\rho$ 被雅可比因子 $\\rho$ 抵消：\n$$\nI(a) = \\int_0^{2\\pi} \\int_0^a 1 \\, d\\rho \\, d\\theta\n$$\n我们计算这个积分，首先计算关于 $\\rho$ 的内层积分：\n$$\n\\int_0^a 1 \\, d\\rho = [\\rho]_0^a = a - 0 = a\n$$\n现在，我们将此结果代入关于 $\\theta$ 的外层积分中：\n$$\nI(a) = \\int_0^{2\\pi} a \\, d\\theta = a [\\theta]_0^{2\\pi} = a(2\\pi - 0)\n$$\n这给出了最终的精确结果：\n$$\nI(a) = 2\\pi a\n$$",
            "answer": "$$\n\\boxed{2\\pi a}\n$$"
        },
        {
            "introduction": "等效原理的应用不仅限于频域积分方程，在时域有限差分 (FDTD) 方法中也扮演着关键角色。总场/散射场 (TFSF) 技术就是等效原理在时域网格中的直接体现，用于在计算区域内“注入”一个纯净的平面波。本实践  将带您推导实现TFSF边界所需的离散等效源项，并分析由Yee元胞引入的数值色散如何影响等效条件的精确性。",
            "id": "3352208",
            "problem": "要求您在二维时域有限差分法（FDTD）离散化真空中的麦克斯韦方程组的背景下进行工作，该背景针对电场沿 $z$ 轴的横电（TE）极化（通常称为 TE$_z$）。将使用总场/散射场（TFSF）等效原理，通过一个封闭的矩形曲线注入平面波，该曲线将总场区域（内部）与散射场区域（外部）分开。您的任务是推导 TE 平面波的 TFSF 等效源的离散更新表达式，并量化 Yee 格式的数值色散如何影响跨 TFSF 边界强制执行等效性。\n\n从以下基本原理出发：\n- 真空中时谐场的法拉第定律和安培定律，\n- 场在空间和时间上的 Yee 网格交错，\n- 以及真空中的线性本构关系。\n\n除了直接离散化旋度方程所得到的结果外，您不能依赖任何预先制表的更新系数。您必须从第一性原理和一致的交错网格出发，推导出一个 TE$_z$ 平面波（角频率为 $\\,\\omega\\,$，入射角为 $\\,\\theta\\,$）在矩形 TFSF 边界的每一段上强制执行 TFSF 条件所需的等效电磁源对应的离散更新表达式。假设入射平面波在真空中，其电场为 $\\,E_z^{\\mathrm{inc}}(x,y,t)\\,$，磁场为 $\\,H_x^{\\mathrm{inc}}(x,y,t)\\,$ 和 $\\,H_y^{\\mathrm{inc}}(x,y,t)\\,$，并以 Yee 更新方程中边界相邻网格线上的附加增量的形式表示您的离散源项，明确给出它们对网格间距 $\\,\\Delta x\\,$、$\\,\\Delta y\\,$ 和时间步长 $\\,\\Delta t\\,$ 的依赖关系。\n\n然后，通过考虑入射平面波相位的两种概念来分析数值色散对等效性执行的影响：\n- “物理”相位，使用连续空间波数分量 $\\,k_x = (\\omega/c)\\cos\\theta\\,$ 和 $\\,k_y = (\\omega/c)\\sin\\theta\\,$，其中 $\\,c\\,$ 是真空中的光速。\n- “数值”相位，经过调整以精确满足所选 $\\,\\Delta x\\,$、$\\,\\Delta y\\,$ 和 $\\,\\Delta t\\,$ 的二维 Yee 格式离散色散关系，同时保持入射方向 $\\,\\theta\\,$。\n\n为每个测试案例定义并计算以下两个量化指标：\n1) 一个相对相位失配残差 $\\,r\\,$，通过将三元组 $\\,(\\omega,\\Delta t,k_x,k_y,\\Delta x,\\Delta y)\\,$ 代入 Yee 格式的离散色散关系，并用左侧项的绝对值对绝对误差进行归一化得到。明确地，从离散旋度方程推导离散色散关系，并将 $\\,r\\,$ 定义为使用“物理”$\\,k_x,k_y\\,$ 时的归一化非零残差，以及使用“数值”$\\,k_x,k_y\\,$ 时的相应值。\n2) 一个数值阻抗失配反射估计 $\\,\\Gamma\\,$，基于数值一致性阻抗（由应用于平面波的离散时间和空间差分算子构建）与真空阻抗之比。您的定义必须从离散更新关系中推导得出，并且当离散色散关系被精确满足时，必须简化为零反射。将 $\\,|\\Gamma|\\,$ 报告为一个在 $[0,1)$ 范围内的无量纲浮点数。\n\n使用以下物理常数：光速 $\\,c = 299\\,792\\,458\\,\\mathrm{m/s}\\,$，真空磁导率 $\\,\\mu_0 = 4\\pi\\times 10^{-7}\\,\\mathrm{H/m}\\,$，以及真空介电常数 $\\,\\varepsilon_0 = 1/(\\mu_0 c^2)\\,$。\n\n所有测试案例的数值规范：\n- 频率固定为 $\\,f = 10^9\\,\\mathrm{Hz}\\,$，因此 $\\,\\omega = 2\\pi f\\,$，真空波长为 $\\,\\lambda = c/f\\,$。\n- Yee 网格间距为 $\\,\\Delta x = \\lambda/N_x\\,$ 和 $\\,\\Delta y = \\lambda/N_y\\,$，其中 $\\,N_x\\,$ 和 $\\,N_y\\,$ 分别是 $x$ 和 $y$ 方向上每波长的点数。\n- 时间步长选择为 $\\,\\Delta t = s\\,\\Delta t_{\\max}\\,$，其中 $\\,\\Delta t_{\\max} = 1/\\big(c\\,\\sqrt{(\\Delta x)^{-2}+(\\Delta y)^{-2}}\\big)\\,$ 且 $\\,s\\in(0,1)\\,$ 是一个库朗因子。\n- 在输入规范中，角度必须以度为单位解释，但在任何三角函数求值时必须转换为弧度。\n\n测试套件。对于下面的每个测试案例，按顺序计算三个浮点数 $[r_{\\mathrm{phys}},\\,r_{\\mathrm{num}},\\,|\\Gamma_{\\mathrm{phys}}|]$：\n- 案例 A: $\\,N_x=N_y=20\\,$, $\\,\\theta=0^\\circ\\,$, $\\,s=0.99\\,$.\n- 案例 B: $\\,N_x=N_y=10\\,$, $\\,\\theta=45^\\circ\\,$, $\\,s=0.99\\,$.\n- 案例 C: $\\,N_x=N_y=20\\,$, $\\,\\theta=80^\\circ\\,$, $\\,s=0.99\\,$.\n- 案例 D: $\\,N_x=15,\\,N_y=30\\,$, $\\,\\theta=30^\\circ\\,$, $\\,s=0.90\\,$.\n- 案例 E: $\\,N_x=N_y=40\\,$, $\\,\\theta=33^\\circ\\,$, $\\,s=0.50\\,$.\n\n所有要求的输出都是无量纲浮点数。您的程序必须生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，并按 A,B,C,D,E 的顺序连接各案例的值。具体来说，输出格式必须是\n“$[r^{(A)}_{\\mathrm{phys}},r^{(A)}_{\\mathrm{num}},|\\Gamma^{(A)}_{\\mathrm{phys}}|,r^{(B)}_{\\mathrm{phys}},r^{(B)}_{\\mathrm{num}},|\\Gamma^{(B)}_{\\mathrm{phys}}|,\\dots,r^{(E)}_{\\mathrm{phys}},r^{(E)}_{\\mathrm{num}},|\\Gamma^{(E)}_{\\mathrm{phys}}|]$”。\n角度必须以度为单位解释，物理单位必须符合上述定义。不应打印任何其他文本。",
            "solution": "所提出的问题是计算电磁学中一个标准的、定义明确的练习，它要求推导和数值评估与时域有限差分（FDTD）方法相关的概念，特别是总场/散射场（TFSF）公式和数值色散。该问题是有效的，因为它具有科学依据、自成体系且可通过算法求解。我们继续进行求解。\n\n### 第 1 部分：TE$_z$ 波的 FDTD 公式\n\n我们从无源、线性、各向同性、均匀介质（真空）中的麦克斯韦方程组开始，该介质由介电常数 $\\varepsilon_0$ 和磁导率 $\\mu_0$ 表征：\n$$ \\nabla \\times \\vec{E} = -\\mu_0 \\frac{\\partial \\vec{H}}{\\partial t} $$\n$$ \\nabla \\times \\vec{H} = \\varepsilon_0 \\frac{\\partial \\vec{E}}{\\partial t} $$\n对于 $xy$ 平面上的二维问题（$\\partial/\\partial z = 0$），且为横电（$TE_z$）极化，场分量为 $E_z$、$H_x$ 和 $H_y$，而 $E_x = E_y = H_z = 0$。旋度方程简化为一个标量系统：\n$$ \\mu_0 \\frac{\\partial H_x}{\\partial t} = -\\frac{\\partial E_z}{\\partial y} $$\n$$ \\mu_0 \\frac{\\partial H_y}{\\partial t} = \\frac{\\partial E_z}{\\partial x} $$\n$$ \\varepsilon_0 \\frac{\\partial E_z}{\\partial t} = \\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} $$\n这些方程使用 Yee 算法在空间和时间上进行离散化。场分量被放置在交错网格上。设一个网格点表示为 $(i\\Delta x, j\\Delta y)$，一个时间瞬间表示为 $n\\Delta t$。场的定位如下：$E_z$ 位于 $(i, j, n)$，$H_x$ 位于 $(i, j+1/2, n+1/2)$，而 $H_y$ 位于 $(i+1/2, j, n+1/2)$。对导数应用中心差分近似，得到 FDTD 更新方程：\n$$ H_x\\big|_{i, j+1/2}^{n+1/2} = H_x\\big|_{i, j+1/2}^{n-1/2} - \\frac{\\Delta t}{\\mu_0 \\Delta y} \\left( E_z\\big|_{i, j+1}^{n} - E_z\\big|_{i, j}^{n} \\right) $$\n$$ H_y\\big|_{i+1/2, j}^{n+1/2} = H_y\\big|_{i+1/2, j}^{n-1/2} + \\frac{\\Delta t}{\\mu_0 \\Delta x} \\left( E_z\\big|_{i+1, j}^{n} - E_z\\big|_{i, j}^{n} \\right) $$\n$$ E_z\\big|_{i, j}^{n+1} = E_z\\big|_{i, j}^{n} + \\frac{\\Delta t}{\\varepsilon_0} \\left( \\frac{H_y\\big|_{i+1/2, j}^{n+1/2} - H_y\\big|_{i-1/2, j}^{n+1/2}}{\\Delta x} - \\frac{H_x\\big|_{i, j+1/2}^{n+1/2} - H_x\\big|_{i, j-1/2}^{n+1/2}}{\\Delta y} \\right) $$\n\n### 第 2 部分：TFSF 更新表达式的推导\n\nTFSF 技术将计算域划分为总场（TF）区域，其中场是入射分量和散射分量之和（$\\vec{F}^{\\mathrm{tot}} = \\vec{F}^{\\mathrm{inc}} + \\vec{F}^{\\mathrm{scat}}$），以及散射场（SF）区域，该区域只包含散射场。上述标准 FDTD 方程用于在各自区域内更新总场或散射场。在区域之间的边界上，必须修改更新方程以正确连接这两种场。这些修改等效于引入虚拟的电磁表面电流。\n\n我们通过强制边界上的场连续性来推导附加源项。设 $E_z$ 的总场区域由网格索引 $i \\in [i_0, i_1]$ 和 $j \\in [j_0, j_1]$ 定义。\n考虑总场区域左边界上（$j_0  j  j_1$）总场节点 $E_z^{\\mathrm{tot}}|_{i_0,j}^{n+1}$ 的更新。FDTD 更新需要位于散射场区域的 $H_y|_{i_0-1/2,j}$。“正确”的总场更新在所有位置都使用总场：\n$$ E_z^{\\mathrm{tot}}|_{i_0,j} \\text{ 的更新使用 } H_y^{\\mathrm{tot}}|_{i_0-1/2,j} $$\n然而，网格存储的是 $H_y^{\\mathrm{scat}}|_{i_0-1/2,j}$。我们通过代入 $H_y^{\\mathrm{tot}} = H_y^{\\mathrm{scat}} + H_y^{\\mathrm{inc}}$ 来强制保持一致性：\n$$ E_z^{\\mathrm{tot}}|_{i_0,j}^{n+1} = E_z^{\\mathrm{tot}}|_{i_0,j}^{n} + \\frac{\\Delta t}{\\varepsilon_0 \\Delta x} \\left( H_y^{\\mathrm{tot}}|_{i_0+1/2,j} - H_y^{\\mathrm{tot}}|_{i_0-1/2,j} \\right) - \\dots $$\n$$ E_z^{\\mathrm{tot}}|_{i_0,j}^{n+1} = E_z^{\\mathrm{tot}}|_{i_0,j}^{n} + \\frac{\\Delta t}{\\varepsilon_0 \\Delta x} \\left( H_y^{\\mathrm{tot}}|_{i_0+1/2,j} - (H_y^{\\mathrm{scat}}|_{i_0-1/2,j} + H_y^{\\mathrm{inc}}|_{i_0-1/2,j}) \\right) - \\dots $$\n重新排列后，得到以网格驻留场加上一个修正项表示的更新：\n$$ E_z^{\\mathrm{tot}}|_{i_0,j}^{n+1} = \\left[ \\text{使用网格场的标准更新} \\right] - \\frac{\\Delta t}{\\varepsilon_0 \\Delta x} H_y^{\\mathrm{inc}}|_{i_0-1/2,j}^{n+1/2} $$\n对称地，考虑总场区域外侧的散射场节点 $H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n+1/2}$ 的更新。它需要 $E_z|_{i_0,j}$，而这是一个总场节点。\n$$ H_y^{\\mathrm{scat}}|_{i_0-1/2,j} \\text{ 的更新使用 } E_z^{\\mathrm{scat}}|_{i_0,j} $$\n我们代入 $E_z^{\\mathrm{scat}} = E_z^{\\mathrm{tot}} - E_z^{\\mathrm{inc}}$：\n$$ H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n+1/2} = H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n-1/2} + \\frac{\\Delta t}{\\mu_0 \\Delta x} \\left( E_z^{\\mathrm{scat}}|_{i_0,j} - E_z^{\\mathrm{scat}}|_{i_0-1,j} \\right) $$\n$$ H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n+1/2} = H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n-1/2} + \\frac{\\Delta t}{\\mu_0 \\Delta x} \\left( (E_z^{\\mathrm{tot}}|_{i_0,j} - E_z^{\\mathrm{inc}}|_{i_0,j}) - E_z^{\\mathrm{scat}}|_{i_0-1,j} \\right) $$\n附加的修正项是：\n$$ H_y^{\\mathrm{scat}}|_{i_0-1/2,j}^{n+1/2} = \\left[ \\text{使用网格场的标准更新} \\right] - \\frac{\\Delta t}{\\mu_0 \\Delta x} E_z^{\\mathrm{inc}}|_{i_0,j}^{n} $$\n通过将此逻辑应用于矩形 TFSF 边界的所有四个侧面，我们推导出所有必要的源项。对于一个 TE$_z$ 平面波 $E_z^{\\mathrm{inc}}(x,y,t) = E_0\\cos(\\omega t - k_x x - k_y y)$，其相应的磁场（在连续空间中）为 $H_x^{\\mathrm{inc}} = \\frac{k_y}{\\omega\\mu_0}E_z^{\\mathrm{inc}}$ 和 $H_y^{\\mathrm{inc}} = -\\frac{k_x}{\\omega\\mu_0}E_z^{\\mathrm{inc}}$。离散源项是 FDTD 更新的附加修正，使用在适当的 Yee 网格时空位置上的入射平面波场值进行评估。例如，对于 $(i_0, j)$ 处的 $E_z$ 更新，源项为 $-\\frac{\\Delta t}{\\varepsilon_0 \\Delta x}H_y^{\\mathrm{inc}}((i_0-1/2)\\Delta x, j\\Delta y, (n+1/2)\\Delta t)$；对于 $(i_0-1/2, j)$ 处的 $H_y$ 更新，源项为 $-\\frac{\\Delta t}{\\mu_0 \\Delta x}E_z^{\\mathrm{inc}}(i_0\\Delta x, j\\Delta y, n\\Delta t)$。\n\n### 第 3 部分：数值色散与阻抗分析\n\n为了分析离散网格的特性，我们将一个形如 $F(\\vec{r},t) = F_0 e^{j(\\omega t - k_x x - k_y y)}$ 的数值平面波解代入 FDTD 更新方程。离散有限差分算子有效地变换如下：\n$$ \\frac{\\partial}{\\partial t} \\rightarrow \\frac{j 2}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right), \\quad \\frac{\\partial}{\\partial x} \\rightarrow \\frac{-j 2}{\\Delta x} \\sin\\left(\\frac{k_x \\Delta x}{2}\\right), \\quad \\frac{\\partial}{\\partial y} \\rightarrow \\frac{-j 2}{\\Delta y} \\sin\\left(\\frac{k_y \\Delta y}{2}\\right) $$\n将这些代入麦克斯韦方程组并消去场振幅，得到 Yee 格式的二维 TE$_z$ 数值色散关系：\n$$ \\left( \\frac{1}{c\\Delta t}\\sin\\frac{\\omega\\Delta t}{2} \\right)^2 = \\left( \\frac{1}{\\Delta x}\\sin\\frac{k_x\\Delta x}{2} \\right)^2 + \\left( \\frac{1}{\\Delta y}\\sin\\frac{k_y\\Delta y}{2} \\right)^2 $$\n在连续空间中，色散关系为 $(\\omega/c)^2 = k_x^2 + k_y^2$。FDTD 网格引入了数值色散，这意味着不同频率、波长或传播方向的波以不同的相速传播，并且该速度通常不同于 $c$。\n\n**1) 相对相位失配残差 ($r$)**：该量度量了给定平面波满足网格色散关系的程度。它定义为：\n$$ r = \\frac{\\left| \\left( \\frac{\\sin(\\omega\\Delta t/2)}{c\\Delta t} \\right)^2 - \\left[ \\left( \\frac{\\sin(k_x\\Delta x/2)}{\\Delta x} \\right)^2 + \\left( \\frac{\\sin(k_y\\Delta y/2)}{\\Delta y} \\right)^2 \\right] \\right|}{\\left( \\frac{\\sin(\\omega\\Delta t/2)}{c\\Delta t} \\right)^2} $$\n对于“物理”情况，我们使用 $k_x = (\\omega/c)\\cos\\theta$ 和 $k_y = (\\omega/c)\\sin\\theta$。这些波数通常不满足数值色散关系，导致非零残差 $r_{\\mathrm{phys}}$。对于“数值”情况，我们寻找一个新的波数大小 $\\tilde{k}$，使得 $\\tilde{k}_x = \\tilde{k}\\cos\\theta$ 和 $\\tilde{k}_y = \\tilde{k}\\sin\\theta$ 对于给定的 $\\omega$ 和 $\\theta$ 精确满足数值色散关系。这是通过数值求解一个关于 $\\tilde{k}$ 的超越方程来实现的。根据定义，得到的残差 $r_{\\mathrm{num}}$ 将为零（或接近机器精度）。\n\n**2) 数值阻抗失配 ($\\Gamma$)**：FDTD 网格表现出一种依赖于频率和传播方向的数值波阻抗。从离散形式的安培定律和法拉第定律，我们可以推导出数值平面波的电场与磁场振幅之比：\n$$ Z_{\\mathrm{num}} = \\frac{|E_z|}{|\\vec{H}|} = \\frac{\\mu_0 \\frac{2}{\\Delta t}\\sin(\\frac{\\omega\\Delta t}{2})}{\\sqrt{\\left(\\frac{2}{\\Delta x}\\sin\\frac{k_x\\Delta x}{2}\\right)^2 + \\left(\\frac{2}{\\Delta y}\\sin\\frac{k_y\\Delta y}{2}\\right)^2}} $$\nTFSF 源注入隐含地假设入射波具有真空阻抗 $Z_0 = \\sqrt{\\mu_0/\\varepsilon_0} = c\\mu_0$。当 $Z_{\\mathrm{num}} \\neq Z_0$ 时，在 TFSF 边界会发生伪反射。反射系数 $\\Gamma$ 可以估计为：\n$$ \\Gamma = \\frac{Z_{\\mathrm{num}} - Z_0}{Z_{\\mathrm{num}} + Z_0} $$\n代入 $Z_{\\mathrm{num}}$ 和 $Z_0$ 的表达式并简化，我们得到：\n$$ \\Gamma = \\frac{ \\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t} - c \\sqrt{\\left(\\frac{\\sin(k_x\\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y\\Delta y/2)}{\\Delta y}\\right)^2} }{ \\frac{\\sin(\\omega\\Delta t/2)}{\\Delta t} + c \\sqrt{\\left(\\frac{\\sin(k_x\\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y\\Delta y/2)}{\\Delta y}\\right)^2} } $$\n大小 $|\\Gamma_{\\mathrm{phys}}|$ 量化了将物理平面波注入色散 FDTD 网格时预期的反射。如果色散关系被完美满足，分子将为零，导致 $\\Gamma=0$。\n\n以下代码实现了针对指定测试案例的这些度量的计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the numerical dispersion metrics for a 2D TEz FDTD scheme.\n    \"\"\"\n    \n    # Define physical constants\n    c = 299792458.0  # Speed of light in vacuum, m/s\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, theta_degrees, courant_factor_s)\n        (20, 20, 0., 0.99),\n        (10, 10, 45., 0.99),\n        (20, 20, 80., 0.99),\n        (15, 30, 30., 0.90),\n        (40, 40, 33., 0.50),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        Nx, Ny, theta_deg, s = case\n        \n        # --- Step 1: Calculate simulation parameters ---\n        f = 1e9  # Frequency in Hz\n        omega = 2 * np.pi * f\n        lambda_0 = c / f  # Vacuum wavelength\n        \n        dx = lambda_0 / Nx\n        dy = lambda_0 / Ny\n        \n        dt_max = 1 / (c * np.sqrt(1/dx**2 + 1/dy**2))\n        dt = s * dt_max\n        \n        theta_rad = np.deg2rad(theta_deg)\n        \n        # We can define two key quantities, S_omega and S_k, which simplifies expressions.\n        # S_omega = sin(omega*dt/2) / (c*dt)\n        # S_k = sqrt( (sin(kx*dx/2)/dx)^2 + (sin(ky*dy/2)/dy)^2 )\n        # The dispersion relation is S_omega^2 = S_k^2\n        # The reflection coefficient is |(S_omega - S_k) / (S_omega + S_k)|\n        \n        S_omega = np.sin(omega * dt / 2) / (c * dt)\n        S_omega_sq = S_omega**2\n\n        # --- Step 2: Physical case calculations ---\n        k_phys = omega / c\n        kx_phys = k_phys * np.cos(theta_rad)\n        ky_phys = k_phys * np.sin(theta_rad)\n        \n        S_k_phys_sq = (np.sin(kx_phys * dx / 2) / dx)**2 + (np.sin(ky_phys * dy / 2) / dy)**2\n        \n        # Calculate relative phase-mismatch residual r_phys\n        r_phys = np.abs(S_omega_sq - S_k_phys_sq) / S_omega_sq\n        \n        # Calculate numerical-impedance mismatch reflection |Gamma_phys|\n        S_k_phys = np.sqrt(S_k_phys_sq)\n        Gamma_phys_mag = np.abs((S_omega - S_k_phys) / (S_omega + S_k_phys))\n\n        # --- Step 3: Numerical case calculations ---\n        # Define the residual of the dispersion relation as a function of k_tilde\n        def dispersion_residual_func(k_tilde, theta, dx, dy, S_omega_sq_val):\n            k_tilde_x = k_tilde * np.cos(theta)\n            k_tilde_y = k_tilde * np.sin(theta)\n            \n            S_k_tilde_sq = (np.sin(k_tilde_x * dx / 2) / dx)**2 + (np.sin(k_tilde_y * dy / 2) / dy)**2\n            return S_k_tilde_sq - S_omega_sq_val\n\n        # Numerically solve for k_tilde that satisfies the dispersion relation.\n        # It's known that k_tilde = k_phys.\n        # The residual function is monotonic for k_tilde near k_phys.\n        lower_bound = k_phys\n        upper_bound = k_phys * 2.0  # A reasonable starting upper bound\n        \n        # Ensure the root is bracketed before calling the solver.\n        while dispersion_residual_func(upper_bound, theta_rad, dx, dy, S_omega_sq)  0:\n            upper_bound *= 1.5\n\n        k_num = brentq(dispersion_residual_func, lower_bound, upper_bound, args=(theta_rad, dx, dy, S_omega_sq))\n        \n        # Calculate residual r_num with the solved k_num. Should be near zero.\n        kx_num = k_num * np.cos(theta_rad)\n        ky_num = k_num * np.sin(theta_rad)\n        \n        S_k_num_sq = (np.sin(kx_num * dx / 2) / dx)**2 + (np.sin(ky_num * dy / 2) / dy)**2\n        r_num = np.abs(S_omega_sq - S_k_num_sq) / S_omega_sq\n        \n        all_results.extend([r_phys, r_num, Gamma_phys_mag])\n\n    # --- Step 4: Final print statement in the exact required format ---\n    print(f\"[{','.join(f'{res:.6e}' for res in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}