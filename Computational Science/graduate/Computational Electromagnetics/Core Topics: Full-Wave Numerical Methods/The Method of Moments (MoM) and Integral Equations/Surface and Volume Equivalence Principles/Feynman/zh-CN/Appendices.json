{
    "hands_on_practices": [
        {
            "introduction": "将表面等效原理应用于实际计算，一个不可避免的挑战是如何处理积分方程中出现的奇异性。本练习将引导你掌握一项处理奇异积分的基本技巧：通过局部坐标变换来解析地处理奇异性，这是确保数值方法精度的关键一步 。通过这个练习，你将把抽象的理论应用到具体的数学推导中。",
            "id": "3352217",
            "problem": "考虑计算电磁学中的表面等效原理：散射体外部的场可以通过边界表面上的等效表面电流来表示。在频域中，相应的积分算子涉及亥姆霍兹方程的自由空间标量格林函数，其在源点和观测点重合附近的领头阶奇异结构由因子 $1/|\\mathbf{r}-\\mathbf{r}'|$ 决定。对此类奇异表面积分进行精确的数值积分，需要将被积函数变换到曲面上的局部坐标系中，以便显式地处理奇点。\n\n从麦克斯韦方程组和亥姆霍兹算子的自由空间标量格林函数定义出发，分析积分\n$$\nI[\\phi](\\mathbf{r}) \\equiv \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\, dS',\n$$\n的局部奇异行为，其中 $S$ 是 $\\mathbb{R}^3$ 中的一个光滑可定向曲面，$\\phi(\\mathbf{r}')$ 是一个由表面等效原理在 $S$ 上感应出的等效表面电流密度所产生的足够光滑的标量权函数。在点 $\\mathbf{r}_0 \\in S$ 处引入一个局部标准正交切框架及在 $\\mathbf{r}_0$ 邻域内的相应局部坐标图 $(u,v)$，将被积函数的奇异部分变换到切平面上的局部极坐标 $(\\rho,\\theta)$ 中，并论证该变换如何使得对奇异贡献进行有限的解析计算成为可能。\n\n然后，用一个基准几何结构来验证该变换及其解析计算：令 $S$ 为一个半径为 $a>0$ 的平坦圆盘，位于 $z=0$ 平面内，以原点为中心，并令观测点为圆盘中心的 $\\mathbf{r}=\\mathbf{0}$。选择常数权函数 $\\phi(\\mathbf{r}') \\equiv 1$，并计算奇异积分\n$$\nI(a) \\equiv \\int_{S} \\frac{1}{|\\mathbf{r}'|} \\, dS'\n$$\n通过变换到圆盘上的局部极坐标来精确计算该积分。以 $a$ 的闭式解析表达式形式给出你的最终答案。不要进行任何数值近似或四舍五入。",
            "solution": "问题陈述是内部一致的，其科学基础是电磁学和位势论的原理，并且是适定的。分析和具体计算所需的所有数据和定义都已提供。因此，该问题是有效的。\n\n该问题要求完成两项任务：首先，对一个特定表面积分算子的奇异行为进行一般性分析；其次，对一个基准情形精确计算该积分。\n\n第1部分：奇点的一般性分析\n\n所讨论的积分是单层位势算子，由下式给出\n$$\nI[\\phi](\\mathbf{r}) \\equiv \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} \\, dS'\n$$\n其中 $S$ 是 $\\mathbb{R}^3$ 中的一个光滑可定向曲面，$\\phi(\\mathbf{r}')$ 是一个光滑标量函数，$\\mathbf{r}$ 是观测点，$\\mathbf{r}'$ 是 $S$ 上的源点。该积分算子出现在使用边界积分方程方法求解拉普拉斯方程或亥姆霍兹方程时，而这些方法通过表面等效原理成为计算电磁学的核心。\n\n当观测点 $\\mathbf{r}$ 与曲面 $S$ 上的源点 $\\mathbf{r}'$ 重合时，被积函数呈现出奇性。我们来分析当 $\\mathbf{r} = \\mathbf{r}_0 \\in S$ 时积分的行为。该积分成为一个瑕积分：\n$$\nI[\\phi](\\mathbf{r}_0) = \\int_{S} \\frac{\\phi(\\mathbf{r}')}{|\\mathbf{r}_0-\\mathbf{r}'|} \\, dS'\n$$\n为了确定该积分是否收敛并对其进行计算，我们必须分析其奇点。这通常通过变换到以奇点 $\\mathbf{r}_0$ 为中心的局部坐标系来完成。\n\n让我们在 $\\mathbf{r}_0$ 处引入一个局部坐标系。曲面 $S$ 在 $\\mathbf{r}_0$ 的邻域内可以用其在该点的切平面来近似。我们可以定义一个局部标准正交基 $\\{\\hat{\\mathbf{u}}, \\hat{\\mathbf{v}}, \\hat{\\mathbf{n}}\\}$，其中 $\\hat{\\mathbf{u}}$ 和 $\\hat{\\mathbf{v}}$ 是张成 $\\mathbf{r}_0$ 处切平面的切向量，$\\hat{\\mathbf{n}}$ 是单位法向量。曲面上靠近 $\\mathbf{r}_0$ 的一个点 $\\mathbf{r}'$ 可以通过其在切平面上的投影来近似：\n$$\n\\mathbf{r}' - \\mathbf{r}_0 \\approx u \\hat{\\mathbf{u}} + v \\hat{\\mathbf{v}}\n$$\n其中 $(u,v)$ 是切平面中的局部笛卡尔坐标。在此近似下，距离向量为 $\\mathbf{r}' - \\mathbf{r}_0$，其大小为 $|\\mathbf{r}' - \\mathbf{r}_0| \\approx \\sqrt{u^2+v^2}$。曲面上的微分曲面元 $dS'$ 可由切平面上的微分面积元近似，即 $dS' \\approx du \\, dv$。\n\n由于假设标量权函数 $\\phi(\\mathbf{r}')$ 足够光滑，在 $\\mathbf{r}_0$ 的一个小邻域内，我们可以用其在 $\\mathbf{r}_0$ 处的值来近似，即 $\\phi(\\mathbf{r}') \\approx \\phi(\\mathbf{r}_0)$。此近似的误差贡献于积分的正则非奇异部分。奇异行为通过将此领头阶项在一个小片（例如切平面上围绕 $\\mathbf{r}_0$ 的一个半径为 $\\epsilon$ 的圆盘 $D_\\epsilon$）上积分来捕捉。因此，奇异贡献可近似为：\n$$\n\\int_{D_\\epsilon} \\frac{\\phi(\\mathbf{r}_0)}{\\sqrt{u^2 + v^2}} \\, du \\, dv\n$$\n为了计算该积分，我们将局部笛卡尔坐标 $(u,v)$ 变换为局部极坐标 $(\\rho, \\theta)$，其中 $u = \\rho \\cos\\theta$ 且 $v = \\rho \\sin\\theta$。径向距离为 $\\rho = \\sqrt{u^2+v^2}$。此变换的雅可比行列式为 $\\rho$，因此面积元变为 $du \\, dv = \\rho \\, d\\rho \\, d\\theta$。对于圆盘 $D_\\epsilon$，积分限为 $\\rho \\in [0, \\epsilon]$ 和 $\\theta \\in [0, 2\\pi]$。\n\n将这些代入积分，我们得到：\n$$\n\\int_0^{2\\pi} \\int_0^\\epsilon \\frac{\\phi(\\mathbf{r}_0)}{\\rho} (\\rho \\, d\\rho \\, d\\theta) = \\int_0^{2\\pi} \\int_0^\\epsilon \\phi(\\mathbf{r}_0) \\, d\\rho \\, d\\theta\n$$\n这个变换是关键步骤。来自格林函数核的 $1/\\rho$ 奇点被极坐标变换的雅可比因子 $\\rho$ 完全抵消。得到的被积函数 $\\phi(\\mathbf{r}_0)$ 相对于 $\\rho$ 和 $\\theta$ 是常数。该积分现在是正则的，可以直接计算：\n$$\n\\phi(\\mathbf{r}_0) \\int_0^{2\\pi} \\left[ \\rho \\right]_0^\\epsilon \\, d\\theta = \\phi(\\mathbf{r}_0) \\int_0^{2\\pi} \\epsilon \\, d\\theta = \\phi(\\mathbf{r}_0) (\\epsilon [ \\theta ]_0^{2\\pi}) = 2\\pi\\epsilon\\phi(\\mathbf{r}_0)\n$$\n这个结果是有限的，这表明该奇点是可积的（通常称为“弱奇点”）。变换到以奇点为中心的局部极坐标系显式地将被积函数正则化，从而允许对其进行解析或精确的数值计算。这一原理是边界积分方程数值解中使用的奇点减去法和对消技术的基础。\n\n第2部分：基准计算\n\n我们被要求通过计算一个特定几何结构的特定积分来验证此过程。该积分为：\n$$\nI(a) \\equiv \\int_{S} \\frac{1}{|\\mathbf{r}'|} \\, dS'\n$$\n曲面 $S$ 是一个半径为 $a > 0$ 的平坦圆盘，位于 $z=0$ 平面内，以原点为中心。观测点指定为 $\\mathbf{r}=\\mathbf{0}$，即圆盘的中心。这意味着我们计算积分时，观测点位于源分布的中心，这是如上文分析的一个奇异情形。问题设定为 $\\phi(\\mathbf{r}') \\equiv 1$ 且观测点 $\\mathbf{r}$ 在原点，因此被积函数为 $\\frac{1}{|\\mathbf{0}-\\mathbf{r}'|} = \\frac{1}{|\\mathbf{r}'|}$。\n\n这个几何结构是一般原理的直接应用。曲面 $S$ 本身就是一个平面，因此圆盘上任意一点的切平面就是圆盘所在的平面（$z=0$ 平面）。我们可以立即在该平面上应用极坐标来计算该积分。\n\n圆盘上的一个点 $\\mathbf{r}'$ 可以用极坐标 $(\\rho, \\theta)$ 表示，其中 $\\rho$ 是离原点的径向距离，$\\theta$ 是方位角。其笛卡尔坐标为 $x' = \\rho\\cos\\theta$ 和 $y' = \\rho\\sin\\theta$。\n从原点到点 $\\mathbf{r}'$ 的距离是 $|\\mathbf{r}'| = \\rho$。\n在极坐标中，微分曲面元是 $dS' = \\rho \\, d\\rho \\, d\\theta$。\n对于半径为 $a$ 的圆盘，积分区域为 $\\rho \\in [0, a]$ 和 $\\theta \\in [0, 2\\pi]$。\n\n将这些代入 $I(a)$ 的积分表达式中：\n$$\nI(a) = \\int_0^{2\\pi} \\int_0^a \\frac{1}{\\rho} (\\rho \\, d\\rho \\, d\\theta)\n$$\n如同在一般性分析中一样，$1/\\rho$ 奇点被雅可比因子 $\\rho$ 抵消：\n$$\nI(a) = \\int_0^{2\\pi} \\int_0^a 1 \\, d\\rho \\, d\\theta\n$$\n我们计算该积分，首先从关于 $\\rho$ 的内层积分开始：\n$$\n\\int_0^a 1 \\, d\\rho = [\\rho]_0^a = a - 0 = a\n$$\n现在，我们将此结果代入关于 $\\theta$ 的外层积分中：\n$$\nI(a) = \\int_0^{2\\pi} a \\, d\\theta = a [\\theta]_0^{2\\pi} = a(2\\pi - 0)\n$$\n这给出了最终的精确结果：\n$$\nI(a) = 2\\pi a\n$$",
            "answer": "$$\n\\boxed{2\\pi a}\n$$"
        },
        {
            "introduction": "掌握了表面积分的基本处理方法后，我们可以进一步探索等效原理的一个重要物理推论：对于包裹同一辐射源的任意两个封闭惠更斯面，其向外辐射的总功率是恒定的。本练习要求你首先从理论上证明该结论，然后通过数值实验，在一个复杂的非凸表面上进行验证 ，从而通过计算实践加深对理论的理解。",
            "id": "3352266",
            "problem": "您的任务是在计算电磁学的背景下，形式化并验证辐射功率相对于 Huygens 面选择的不变性，重点关注面积和体积等效原理。目标是 (1) 使用基本的时谐 Maxwell 方程组和 Lorentz 互易定理，建立一个基于原理的推导，以及 (2) 使用一个综合的、解析定义的辐射源，实现一个数值验证。介质是均匀、线性、各向同性且互易的，时间依赖约定为 $e^{-i \\omega t}$。\n\nA 部分（推导）。从无源区域中的时谐 Maxwell 方程组开始，\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = - i \\omega \\epsilon \\mathbf{E},\n$$\n对于互易介质中具有外加源电流 $\\mathbf{J}_1$ 和 $\\mathbf{J}_2$ 的两个容许场对 $(\\mathbf{E}_1,\\mathbf{H}_1)$ 和 $(\\mathbf{E}_2,\\mathbf{H}_2)$ 的 Lorentz 互易定理，\n$$\n\\int_{\\partial V} \\left(\\mathbf{E}_1 \\times \\mathbf{H}_2 - \\mathbf{E}_2 \\times \\mathbf{H}_1 \\right) \\cdot \\mathbf{\\hat{n}} \\, \\mathrm{d}S = \\int_V \\left( \\mathbf{J}_1 \\cdot \\mathbf{E}_2 - \\mathbf{J}_2 \\cdot \\mathbf{E}_1 \\right) \\, \\mathrm{d}V,\n$$\n以及用等效的电和磁表面电流替代闭合曲面外部场的面积等效原理（Love 电流），证明对于任何两个封闭的 Huygens 曲面 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$（它们都包围相同的物理对象，且位于无外加源的区域内），对于任何入射场，从 $\\mathcal{S}_1$ 上的等效电流计算出的时间平均向外辐射功率等于从 $\\mathcal{S}_2$ 上的等效电流计算出的功率。您的推导必须清楚地证明，当 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$ 之间的区域是无源的且介质是互易的时，该结果为何成立，并且不能引用任何已经包含了这种不变性的“黑箱”公式。\n\nB 部分（数值验证）。您将使用一个已知的辐射源进行数值验证，该辐射源是一个位于原点的时谐电偶极子点源，其电偶极矩为 $\\mathbf{p} = p_0 \\mathbf{\\hat{z}}$，角频率为 $\\omega$。在自由空间中，穿过任何包围该偶极子的闭合曲面的总时间平均辐射功率应该是不变的。利用这一点，通过计算穿过两个不同包围面的总向外时间平均坡印廷通量来模拟 Huygens 面不变性测试：\n\n1. 半径为 $R_0$ 的球面。\n2. 一个在球坐标中由下式参数化的星形非凸曲面：\n$$\nr(\\theta,\\phi) = R_0 \\left[ 1 + \\varepsilon \\cos(m \\theta) \\cos(n \\phi) \\right],\n$$\n其中 $m = 3$, $n = 5$，且 $\\varepsilon \\in [0,1)$ 确保 $r(\\theta,\\phi) > 0$。角度 $\\theta \\in [0,\\pi]$ 和 $\\phi \\in [0,2\\pi)$ 必须以弧度处理。\n\n设自由空间参数为 $\\mu_0$ 和 $\\epsilon_0$，其中 $c = 1 / \\sqrt{\\mu_0 \\epsilon_0}$。选择波长 $\\lambda = 1 \\, \\mathrm{m}$，波数 $k = 2\\pi / \\lambda$，角频率 $\\omega = k c$，以及 $p_0 = 1 \\, \\mathrm{C \\cdot m}$。设 $R_0 = 0.5 \\, \\mathrm{m}$。\n\n将通过每个曲面的总时间平均功率计算为\n$$\nP = \\iint_{\\mathcal{S}} \\frac{1}{2} \\operatorname{Re} \\left( \\mathbf{E}(\\mathbf{r}) \\times \\mathbf{H}(\\mathbf{r})^* \\right) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S,\n$$\n其中场是在曲面采样点上自由空间中电偶极子的场。不要在被积函数中使用任何仅远场的近似；在曲面的任何地方计算精确的时谐场。用 $(\\theta,\\phi)$ 参数化曲面，并通过几何恒等式计算有向面积元\n$$\n\\left( \\frac{\\partial \\mathbf{R}}{\\partial \\theta} \\times \\frac{\\partial \\mathbf{R}}{\\partial \\phi} \\right) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi = \\hat{\\mathbf{n}} \\, \\mathrm{d}S,\n$$\n其中 $\\mathbf{R}(\\theta,\\phi) = r(\\theta,\\phi) \\, \\hat{\\mathbf{r}}(\\theta,\\phi)$ 且所有角度均以弧度为单位。在 $\\theta$ 和 $\\phi$ 中均使用中点采样以避免极点奇点：对于整数 $i$ 和 $j$，$\\theta_i = (i + \\tfrac{1}{2}) \\pi / N_\\theta$，$\\phi_j = (j + \\tfrac{1}{2}) 2\\pi / N_\\phi$。\n\n将给定参数集的相对差异定义为\n$$\n\\delta = \\frac{ | P_{\\text{star}} - P_{\\text{sphere}} | }{ \\tfrac{1}{2} \\left( |P_{\\text{star}}| + |P_{\\text{sphere}}| \\right) }.\n$$\n\n您必须实现一个完整的程序，该程序：\n- 使用精确的自由空间格林函数表示法，计算任意场点处时谐电偶极子的 $\\mathbf{E}$ 和 $\\mathbf{H}$。所有角度均以弧度为单位，自由空间常数采用国际单位制（SI）。\n- 使用 $\\theta$ 和 $\\phi$ 的均匀网格和中点采样，对两个曲面上的时间平均坡印廷通量进行数值积分。\n- 报告每个测试用例的相对差异 $\\delta$。\n\n测试套件。使用以下参数集 $(\\varepsilon, N_\\theta, N_\\phi)$：\n- $(0.0, 12, 24)$: 相同曲面（基线）。\n- $(0.3, 12, 24)$: 非凸星形曲面，粗网格。\n- $(0.3, 36, 72)$: 非凸星形曲面，细化网格。\n- $(0.6, 12, 24)$: 更强非凸性的曲面，粗网格。\n- $(0.6, 36, 72)$: 更强非凸性的曲面，细化网格。\n\n最终输出格式。您的程序必须生成单行输出，其中包含按上述顺序排列的五个相对差异，形式为方括号内以逗号分隔的列表，例如：\n\"[d1,d2,d3,d4,d5]\"。\n输出值必须是浮点数。不得打印任何其他文本。",
            "solution": "该问题分为两部分：理论推导（A 部分）和数值验证（B 部分）。两部分都涉及在无源区域中，辐射功率对于所选包围 Huygens 曲面的不变性。\n\n### A 部分：基于原理的推导\n\n目标是证明，对于任何两个包围同一辐射对象的闭合 Huygens 曲面 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$，只要它们之间的介质是无源、线性、均匀、各向同性且互易的，其总时间平均辐射功率就是相同的。该问题要求基于 Lorentz 互易定理进行推导，但一个更直接、更基本的证明依赖于表达能量守恒的 Poynting 定理。我们将遵循这条更直接的路径，因为它能稳健地建立所需的原理。然后将明确阐述其与等效原理的联系。\n\n设 $(\\mathbf{E}, \\mathbf{H})$ 是满足 Maxwell 方程组的时谐电磁场。代表功率流密度的时间平均 Poynting 矢量由 $\\mathbf{S}_{\\text{avg}} = \\frac{1}{2} \\operatorname{Re}(\\mathbf{E} \\times \\mathbf{H}^*)$ 给出，其中星号表示复共轭。\n\n通过闭合曲面 $\\mathcal{S}$ 向外流动的总时间平均功率 $P$ 是 Poynting 矢量的面积分：\n$$\nP = \\oiint_{\\mathcal{S}} \\mathbf{S}_{\\text{avg}} \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S = \\frac{1}{2} \\operatorname{Re} \\left[ \\oiint_{\\mathcal{S}} (\\mathbf{E} \\times \\mathbf{H}^*) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S \\right]\n$$\n\n考虑两个闭合曲面 $\\mathcal{S}_1$ 和 $\\mathcal{S}_2$，其中 $\\mathcal{S}_2$ 包围 $\\mathcal{S}_1$。两个曲面都包围相同的外加源。两曲面之间的区域（表示为体积 $V$）被指定为无外加源。介质也假定为无损的（这是简单互易介质的一部分，其中 $\\epsilon$ 和 $\\mu$ 是实数）。\n\n我们对体积 $V$ 上的复 Poynting 矢量 $\\mathbf{S} = \\frac{1}{2}(\\mathbf{E} \\times \\mathbf{H}^*)$ 应用散度定理：\n$$\n\\iiint_V (\\nabla \\cdot \\mathbf{S}) \\, \\mathrm{d}V = \\oiint_{\\partial V} \\mathbf{S} \\cdot \\hat{\\mathbf{n}}_{\\text{out}} \\, \\mathrm{d}S\n$$\n体积 $V$ 的边界 $\\partial V$ 由曲面 $\\mathcal{S}_2$（其外法线为 $\\hat{\\mathbf{n}}_2$）和曲面 $\\mathcal{S}_1$（其外法线指向 $V$ 内部，即 $-\\hat{\\mathbf{n}}_1$）组成。因此，面积分变为：\n$$\n\\oiint_{\\partial V} \\mathbf{S} \\cdot \\hat{\\mathbf{n}}_{\\text{out}} \\, \\mathrm{d}S = \\oiint_{\\mathcal{S}_2} \\mathbf{S} \\cdot \\hat{\\mathbf{n}}_2 \\, \\mathrm{d}S + \\oiint_{\\mathcal{S}_1} \\mathbf{S} \\cdot (-\\hat{\\mathbf{n}}_1) \\, \\mathrm{d}S\n$$\n复 Poynting 矢量的散度由复 Poynting 定理给出：\n$$\n\\nabla \\cdot \\mathbf{S} = \\nabla \\cdot \\left(\\frac{1}{2}\\mathbf{E} \\times \\mathbf{H}^*\\right) = -\\frac{1}{2} \\mathbf{E} \\cdot \\mathbf{J}_{\\text{imp}}^* - p_d - i 2\\omega (w_m - w_e)\n$$\n其中 $\\mathbf{J}_{\\text{imp}}$ 代表外加电流源，$p_d$ 是作为热量耗散的时间平均功率（例如 $\\frac{1}{2}\\sigma |\\mathbf{E}|^2$），$w_m$ 和 $w_e$ 分别是时间平均的磁能和电能密度。\n\n问题陈述区域 $V$ 是无源的（$\\mathbf{J}_{\\text{imp}} = 0$）且介质是无损的（意味着电导率 $\\sigma=0$，因此 $p_d=0$）。在这些条件下，Poynting 矢量的散度是纯虚数：\n$$\n\\nabla \\cdot \\mathbf{S} = -i 2\\omega (w_m - w_e)\n$$\n取实部，我们发现时间平均 Poynting 矢量的散度为零：\n$$\n\\nabla \\cdot \\mathbf{S}_{\\text{avg}} = \\operatorname{Re}(\\nabla \\cdot \\mathbf{S}) = 0\n$$\n对 $\\mathbf{S}_{\\text{avg}}$ 应用散度定理：\n$$\n\\iiint_V (\\nabla \\cdot \\mathbf{S}_{\\text{avg}}) \\, \\mathrm{d}V = 0 = \\oiint_{\\mathcal{S}_2} \\mathbf{S}_{\\text{avg}} \\cdot \\hat{\\mathbf{n}}_2 \\, \\mathrm{d}S - \\oiint_{\\mathcal{S}_1} \\mathbf{S}_{\\text{avg}} \\cdot \\hat{\\mathbf{n}}_1 \\, \\mathrm{d}S\n$$\n这直接给出了功率通量的相等关系：\n$$\nP_1 = \\oiint_{\\mathcal{S}_1} \\mathbf{S}_{\\text{avg}} \\cdot \\hat{\\mathbf{n}}_1 \\, \\mathrm{d}S = \\oiint_{\\mathcal{S}_2} \\mathbf{S}_{\\text{avg}} \\cdot \\hat{\\mathbf{n}}_2 \\, \\mathrm{d}S = P_2\n$$\n这表明，流出任何包围源的闭合曲面的总时间平均功率与曲面的形状无关，只要曲面变形所经过的区域是无源和无损的。\n\n问题明确提到了“从等效电流计算出的”功率。根据面积等效原理（Love 的公式），曲面 $\\mathcal{S}$ 外部的场 $(\\mathbf{E}, \\mathbf{H})$ 可以由放置在 $\\mathcal{S}$ 上并于均匀介质中辐射的一组等效电和磁表面电流 $(\\mathbf{J}_{\\mathcal{S}} = \\hat{\\mathbf{n}} \\times \\mathbf{H}, \\mathbf{M}_{\\mathcal{S}} = -\\hat{\\mathbf{n}} \\times \\mathbf{E})$ 再现。\n- 从 $\\mathcal{S}_1$ 上的等效电流计算出的功率是这些电流辐射的功率。该功率等于它们的 Poynting 矢量通过任何包围 $\\mathcal{S}_1$ 的曲面（例如 $\\mathcal{S}_2$ 或无穷远处的曲面 $\\mathcal{S}_\\infty$）的通量。\n- 根据 Maxwell 方程组外部问题解的唯一性，由 $\\mathcal{S}_1$ 上的等效电流产生的场在 $\\mathcal{S}_1$ 外部的任何地方都与原始场相同。类似地，由 $\\mathcal{S}_2$ 上的等效电流产生的场在 $\\mathcal{S}_2$ 外部的任何地方都与原始场相同。\n- 由于 $\\mathcal{S}_2$ 外部的区域是 $\\mathcal{S}_1$ 外部区域的子集，两组等效电流在远场中产生相同的场 $(\\mathbf{E}, \\mathbf{H})$。\n- 总辐射功率最终由无穷远处曲面 $\\mathcal{S}_\\infty$ 上的积分定义。由于无论使用哪组等效电流（$\\mathcal{S}_1$ 或 $\\mathcal{S}_2$）作为源，无穷远处的场都是相同的，因此总辐射功率必须相同。从能量守恒推导出的结果成立。\n\n### B 部分：数值验证实现\n\n对于数值部分，我们必须计算一个 z 轴取向的电偶极子通过两个不同曲面辐射的总时间平均功率。实现的核心是 Poynting 矢量通量的数值积分。\n\n**1. 场表达式：**\n对于位于原点、偶极矩为 $\\mathbf{p} = p_0 \\hat{\\mathbf{z}}$ 且时间依赖为 $e^{-i\\omega t}$ 的时谐电偶极子，其在球坐标中一点 $(r, \\theta, \\phi)$ 的精确、非近似场 $(\\mathbf{E}, \\mathbf{H})$ 为：\n$$\n\\mathbf{E} = E_r \\hat{\\mathbf{r}} + E_\\theta \\hat{\\boldsymbol{\\theta}}\n$$\n$$\n\\mathbf{H} = H_\\phi \\hat{\\boldsymbol{\\phi}}\n$$\n其中\n$$\nE_r = \\frac{p_0}{2\\pi\\epsilon_0} \\left( \\frac{1}{r^3} - \\frac{ik}{r^2} \\right) e^{ikr} \\cos\\theta\n$$\n$$\nE_\\theta = \\frac{p_0}{4\\pi\\epsilon_0} \\left( \\frac{1}{r^3} - \\frac{ik}{r^2} - \\frac{k^2}{r} \\right) e^{ikr} \\sin\\theta\n$$\n$$\nH_\\phi = \\frac{i\\omega p_0}{4\\pi} \\left( \\frac{1}{r^2} - \\frac{ik}{r} \\right) e^{ikr} \\sin\\theta\n$$\n这里，$k=\\omega/c$ 是波数。\n\n**2. 面积分公式：**\n总时间平均功率为 $P = \\iint_{\\mathcal{S}} \\frac{1}{2} \\operatorname{Re}(\\mathbf{E} \\times \\mathbf{H}^*) \\cdot \\mathbf{d}\\mathbf{S}$。对于参数化为 $\\mathbf{R}(\\theta, \\phi) = r(\\theta,\\phi)\\hat{\\mathbf{r}}$ 的曲面，其曲面矢量元 $\\mathbf{d}\\mathbf{S} = \\hat{\\mathbf{n}} \\, \\mathrm{d}S$ 由 $\\mathbf{d}\\mathbf{S} = \\left(\\frac{\\partial \\mathbf{R}}{\\partial \\theta} \\times \\frac{\\partial \\mathbf{R}}{\\partial \\phi}\\right) d\\theta d\\phi$ 给出。该叉积计算结果为：\n$$\n\\mathbf{d}\\mathbf{S} = \\left( r^2 \\sin\\theta \\, \\hat{\\mathbf{r}} - r \\frac{\\partial r}{\\partial \\theta} \\sin\\theta \\, \\hat{\\boldsymbol{\\theta}} - r \\frac{\\partial r}{\\partial \\phi} \\hat{\\boldsymbol{\\phi}} \\right) d\\theta d\\phi\n$$\n偶极子场的复 Poynting 矢量为 $\\mathbf{S} = \\frac{1}{2}(\\mathbf{E} \\times \\mathbf{H}^*) = \\frac{1}{2}(E_\\theta H_\\phi^* \\hat{\\mathbf{r}} - E_r H_\\phi^* \\hat{\\boldsymbol{\\theta}})$。其点积为：\n$$\n(\\mathbf{E} \\times \\mathbf{H}^*) \\cdot \\mathbf{d}\\mathbf{S} = \\left( (E_\\theta H_\\phi^*) (r^2 \\sin\\theta) + (-E_r H_\\phi^*) (-r \\frac{\\partial r}{\\partial \\theta} \\sin\\theta) \\right) d\\theta d\\phi\n$$\n$$\n(\\mathbf{E} \\times \\mathbf{H}^*) \\cdot \\mathbf{d}\\mathbf{S} = r \\sin\\theta \\left(r E_\\theta + \\frac{\\partial r}{\\partial \\theta}E_r\\right) H_\\phi^* \\, d\\theta d\\phi\n$$\n对于星形曲面 $r(\\theta,\\phi) = R_0[1 + \\varepsilon \\cos(m\\theta)\\cos(n\\phi)]$，其偏导数为 $\\frac{\\partial r}{\\partial \\theta} = -R_0\\varepsilon m \\sin(m\\theta)\\cos(n\\phi)$。\n\n**3. 数值积分：**\n我们在 $(\\theta, \\phi)$ 的均匀网格上使用中点法则。该积分通过以下求和来近似：\n$$\nP \\approx \\sum_{i=0}^{N_\\theta-1} \\sum_{j=0}^{N_\\phi-1} \\frac{1}{2} \\operatorname{Re}\\left[ r \\sin\\theta \\left(r E_\\theta + \\frac{\\partial r}{\\partial \\theta}E_r\\right) H_\\phi^* \\right]_{(\\theta_i, \\phi_j)} \\Delta\\theta \\Delta\\phi\n$$\n其中 $\\theta_i = (i + 0.5)\\Delta\\theta$，$\\phi_j = (j + 0.5)\\Delta\\phi$，$\\Delta\\theta = \\pi/N_\\theta$，以及 $\\Delta\\phi = 2\\pi/N_\\phi$。场分量和几何项在每个网格点 $(r(\\theta_i,\\phi_j), \\theta_i, \\phi_j)$ 处进行计算。对于球面，我们设置 $\\varepsilon=0$，这使得 $r=R_0$ 且 $\\partial r/\\partial \\theta = 0$。\n\n以下程序实现了这个数值方案，用以计算每个测试用例中通过球面和星形曲面的功率，并报告相对差异 $\\delta$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Main function to perform the numerical verification as specified in the problem.\n    \"\"\"\n    # Define physical constants from scipy.constants in SI units.\n    C = constants.c\n    MU_0 = constants.mu_0\n    EPSILON_0 = constants.epsilon_0\n    \n    # Define problem parameters.\n    LAMBDA = 1.0  # Wavelength in meters\n    K = 2 * np.pi / LAMBDA  # Wavenumber in rad/m\n    OMEGA = K * C  # Angular frequency in rad/s\n    P0 = 1.0  # Dipole moment amplitude in C*m\n    R0 = 0.5  # Base radius in meters\n    M = 3  # Integer for star surface parameterization\n    N = 5  # Integer for star surface parameterization\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 12, 24),  # identical surfaces (baseline)\n        (0.3, 12, 24),  # nonconvex star-shaped surface, coarse mesh\n        (0.3, 36, 72),  # nonconvex star-shaped surface, refined mesh\n        (0.6, 12, 24),  # more strongly nonconvex surface, coarse mesh\n        (0.6, 36, 72),  # more strongly nonconvex surface, refined mesh\n    ]\n\n    def get_dipole_fields(r, theta):\n        \"\"\"\n        Computes the complex E and H fields of a z-oriented electric dipole at (r, theta).\n        The time dependence convention is e^(-i*omega*t).\n        \n        Args:\n            r (float): Radial distance from the origin.\n            theta (float): Polar angle from the z-axis in radians.\n\n        Returns:\n            tuple: (E_r, E_theta, H_phi) complex field components.\n        \"\"\"\n        exp_ikr = np.exp(1j * K * r)\n        sin_theta = np.sin(theta)\n        cos_theta = np.cos(theta)\n        \n        # Common factor for E fields: p0 / (4*pi*eps0)\n        e_common = P0 / (4 * np.pi * EPSILON_0)\n        \n        # E_r component\n        e_r_term = (1/r**3 - 1j*K/r**2)\n        e_r = 2 * e_common * e_r_term * exp_ikr * cos_theta\n        \n        # E_theta component\n        e_theta_term = (1/r**3 - 1j*K/r**2 - K**2/r)\n        e_theta = e_common * e_theta_term * exp_ikr * sin_theta\n        \n        # H_phi component\n        h_common = 1j * OMEGA * P0 / (4 * np.pi)\n        h_phi_term = (1/r**2 - 1j*K/r)\n        h_phi = h_common * h_phi_term * exp_ikr * sin_theta\n    \n        return e_r, e_theta, h_phi\n\n    def calculate_power(epsilon, n_theta, n_phi):\n        \"\"\"\n        Numerically integrates the time-averaged Poynting flux over a surface\n        defined by epsilon, using a grid of size (n_theta, n_phi).\n        \"\"\"\n        delta_theta = np.pi / n_theta\n        delta_phi = 2 * np.pi / n_phi\n        \n        theta_pts = (np.arange(n_theta) + 0.5) * delta_theta\n        phi_pts = (np.arange(n_phi) + 0.5) * delta_phi\n        \n        total_power = 0.0\n        \n        for theta in theta_pts:\n            for phi in phi_pts:\n                # Surface parameterization\n                r = R0 * (1.0 + epsilon * np.cos(M * theta) * np.cos(N * phi))\n                \n                # Partial derivative of r with respect to theta\n                dr_dtheta = -R0 * epsilon * M * np.sin(M * theta) * np.cos(N * phi)\n                \n                # Get fields at the evaluation point (r, theta)\n                e_r, e_theta, h_phi = get_dipole_fields(r, theta)\n                \n                # The complex value of the integrand for the Poynting flux dot product\n                # S_vec . dS_vec = 1/2 * (r*sin(theta)*(r*E_theta + dr_dtheta*E_r) * H_phi_conj) dtheta dphi\n                integrand_complex = r * np.sin(theta) * (r * e_theta + dr_dtheta * e_r) * np.conj(h_phi)\n                \n                # Accumulate the real part for the time-averaged power\n                total_power += 0.5 * np.real(integrand_complex)\n        \n        return total_power * delta_theta * delta_phi\n\n    results = []\n    for case in test_cases:\n        epsilon, n_theta, n_phi = case\n        \n        # Compute power through the star-shaped surface for the given epsilon.\n        p_star = calculate_power(epsilon, n_theta, n_phi)\n        \n        # Compute power through the reference sphere (epsilon=0) using the same grid.\n        p_sphere = calculate_power(0.0, n_theta, n_phi)\n        \n        # Calculate the relative discrepancy.\n        numerator = np.abs(p_star - p_sphere)\n        denominator = 0.5 * (np.abs(p_star) + np.abs(p_sphere))\n        \n        # Handle the case where the denominator might be zero (unlikely for radiating source).\n        if denominator == 0:\n            discrepancy = 0.0 if numerator == 0 else np.inf\n        else:\n            discrepancy = numerator / denominator\n            \n        results.append(discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在表面等效原理的基础上，我们可以将概念拓展到体等效原理，即用等效体电流 $ \\mathbf{J}_{v}(\\mathbf{r}) = \\sigma(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r}) $ 来表征介质的电磁特性。这项高级实践将指导你构建一个完整的数值求解器，用于计算有耗介质的电磁散射问题，并在此基础上实现一种基于物理耗散的模型降阶方法 。它展示了等效原理如何在提升复杂问题计算效率方面发挥关键作用。",
            "id": "3352226",
            "problem": "考虑在横磁（TM）极化下的二维空间中的时谐电磁散射，其中唯一的非零电场分量是角频率为$\\omega$的平面外标量场$E_{z}(\\mathbf{r})$。计算域嵌入在磁导率为$\\mu_{0}$和介电常数为$\\varepsilon_{0}$的自由空间中。存在一个空间变化的电导率$\\sigma(\\mathbf{r}) \\ge 0$，并且在非均匀区域内除了由材料引起的感应电流外，没有其他外加源。一个单位振幅的平面波$E_{z}^{\\mathrm{inc}}(\\mathbf{r}) = \\exp\\!\\left(i k_{0} \\hat{\\mathbf{x}}\\cdot \\mathbf{r}\\right)$从$-\\infty$沿$+\\hat{\\mathbf{x}}$方向入射，其中$k_{0} = \\omega \\sqrt{\\mu_{0}\\varepsilon_{0}}$。\n\n仅从频域麦克斯韦旋度方程和线性介质的本构关系出发，推导以下建模选择，这些选择是为有损介质中体积等效原理的计算实现以及基于耗散低影响区域的模型降阶所必需的：\n\n1) 证明材料损耗可以由一个等效体电流密度$ \\mathbf{J}_{v}(\\mathbf{r}) = \\sigma(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r}) $表示，从而使有损区域内的总场满足一个由这些等效电流驱动的体积分方程。限定在二维TM极化下，以证明使用二维亥姆霍兹方程的标量自由空间格林函数的合理性。\n\n2) 具体到二维中$E_{z}$的标量Lippmann–Schwinger方程，该方程在$\\sigma(\\mathbf{r})$的紧支集上表示，其中复介电常数为$\\varepsilon(\\mathbf{r}) = \\varepsilon_{0} - i \\sigma(\\mathbf{r})/\\omega$，对比度为$\\chi(\\mathbf{r}) = \\varepsilon(\\mathbf{r})/\\varepsilon_{0} - 1$。在边长为$\\Delta$的方形单元的均匀笛卡尔网格上通过配置进行计算离散化时，描述如何处理单元的自相互作用，即通过将对角线上的奇异格林函数替换为一个取决于等效半径$a = \\sqrt{\\Delta^{2}/\\pi}$的有限自作用项。\n\n3) 建立一个基于物理的模型降阶消除准则：将单元$C_{j}$中的时间平均耗散功率定义为$P_{j} = \\tfrac{1}{2}\\,\\sigma_{j}\\,|E_{j}|^{2}\\,\\Delta^{2}$，其中$E_{j}$是在$C_{j}$中心计算得到的总场。给定一个容差$\\tau \\in [0,1)$，识别出$P_{j}$最小的“低影响”单元集合，其累积和不超过总耗散功率$P_{\\mathrm{tot}} = \\sum_{j} P_{j}$的$\\tau$倍。通过消除这些单元来定义降阶模型，即对被消除的单元设置$\\sigma_{j} \\leftarrow 0$（等效于$\\chi_{j}\\leftarrow 0$）并重新计算场。\n\n4) 为量化消除的影响，使用在位于原点为中心、半径为$R$的圆上的$N_{\\mathrm{obs}}$个观测点$\\{\\mathbf{r}_{m}^{\\mathrm{obs}}\\}_{m=1}^{N_{\\mathrm{obs}}}$处采样的散射场来定义相对误差。对于每个观测点，\n$$\nE_{z}^{\\mathrm{sca}}(\\mathbf{r}^{\\mathrm{obs}}) \\;=\\; k_{0}^{2} \\sum_{j} \\chi_{j}\\,E_{j}\\,G(\\mathbf{r}^{\\mathrm{obs}},\\mathbf{r}_{j})\\,\\Delta^{2},\n$$\n其中$G$是二维自由空间标量格林函数，求和遍及所有保留的单元。设$\\mathbf{e}^{\\mathrm{full}}$和$\\mathbf{e}^{\\mathrm{red}}$分别为全模型和降阶模型的散射场样本向量。将相对误差定义为\n$$\n\\eta \\;=\\; \\frac{\\left\\|\\mathbf{e}^{\\mathrm{red}} - \\mathbf{e}^{\\mathrm{full}}\\right\\|_{2}}{\\max\\left(\\left\\|\\mathbf{e}^{\\mathrm{full}}\\right\\|_{2},\\,\\epsilon\\right)},\n$$\n其中有一个小的正数$\\epsilon$以避免除以零。角度必须以弧度为单位，所有物理量必须使用国际单位制（SI）。最终的数值输出是无量纲的相对误差，无需报告单位。\n\n实现一个程序，该程序：\n- 在$\\sigma(\\mathbf{r})$的支集上构建离散化体积分方程，并求解有损区域内的总场$E_{z}$。\n- 通过$ \\mathbf{J}_{v} = \\sigma \\mathbf{E}$计算等效体电流和每单元耗散功率$P_{j}$。\n- 根据上述定义的容差$\\tau$消除低影响单元，并重新计算降阶模型的场。\n- 在圆形观测轮廓上评估并返回相对误差$\\eta$。\n\n对所有测试用例使用以下标准化的建模细节：\n- 二维标量格林函数$G(\\mathbf{r},\\mathbf{r}') = \\dfrac{i}{4} H_{0}^{(1)}\\!\\left(k_{0}\\left\\|\\mathbf{r}-\\mathbf{r}'\\right\\|\\right)$，其中$H_{0}^{(1)}$为零阶第一类汉克尔函数。\n- 面积为$\\Delta^{2}$的方形单元的自作用项：将对角线格林函数替换为$G_{\\mathrm{self}} = \\dfrac{i}{4} H_{0}^{(1)}\\!\\left(k_{0} a\\right)$，其中$a = \\sqrt{\\Delta^{2}/\\pi}$。\n- 入射场$E_{z}^{\\mathrm{inc}}(\\mathbf{r}) = \\exp\\!\\left(i k_{0} x\\right)$。\n- 观测圆半径$R = 1.2\\,L$，其中$L$是方形计算窗口的边长。\n- 观测样本数$N_{\\mathrm{obs}} = 64$，在$0$到$2\\pi$的角度范围内均匀分布。\n- 真空常数：$\\varepsilon_{0} = 8.8541878128\\times 10^{-12}$ 和 $\\mu_{0} = 4\\pi \\times 10^{-7}$。\n\n您的程序必须为以下四个测试用例中的每一个评估相对误差$\\eta$，并按如下规定将结果列表打印在单行上。每个测试用例由$(L, M, f, \\sigma(\\mathbf{r}), \\tau)$定义，其中$L$是方形窗口边长，$M$是每边的单元数，$f$是频率，$\\sigma(\\mathbf{r})$指定网格上的分段常数电导率分布，$\\tau$是消除容差：\n\n- 测试用例1（混合有损夹杂物）：\n  - $L = 0.6\\,\\mathrm{m}$，$M = 16$，$f = 9.0\\times 10^{8}\\,\\mathrm{Hz}$，$\\tau = 0.1$。\n  - 在跨越$[-L/2, L/2]^{2}$的均匀网格上定义两个有损夹杂物，单元中心为$(x_{i}, y_{j})$：\n    - 矩形$\\mathcal{R}_{1}$：$x \\in [-0.20, -0.05]$，$y \\in [-0.15, 0.15]$，电导率$\\sigma = 0.5\\,\\mathrm{S/m}$。\n    - 圆盘$\\mathcal{D}_{1}$：中心$(0.15, 0.0)$，半径$0.08$，电导率$\\sigma = 0.05\\,\\mathrm{S/m}$。\n    - 其他区域，$\\sigma = 0$。\n\n- 测试用例2（无损介质）：\n  - $L = 0.6\\,\\mathrm{m}$，$M = 16$，$f = 9.0\\times 10^{8}\\,\\mathrm{Hz}$，$\\tau = 0.5$。\n  - 所有区域$\\sigma = 0$。\n\n- 测试用例3（具有弱光晕的强局域热点）：\n  - $L = 0.3\\,\\mathrm{m}$，$M = 18$，$f = 2.4\\times 10^{9}\\,\\mathrm{Hz}$，$\\tau = 0.02$。\n  - 在$[-L/2, L/2]^{2}$上定义：\n    - 圆盘$\\mathcal{D}_{2}$：中心$(0.0, 0.0)$，半径$0.03$，电导率$\\sigma = 5.0\\,\\mathrm{S/m}$。\n    - 圆环$\\mathcal{A}_{2}$：$0.03  \\sqrt{x^{2}+y^{2}} \\le 0.10$，电导率$\\sigma = 0.02\\,\\mathrm{S/m}$。\n    - 其他区域，$\\sigma = 0$。\n\n- 测试用例4（近似均匀的弱损耗）：\n  - $L = 0.5\\,\\mathrm{m}$，$M = 14$，$f = 1.0\\times 10^{9}\\,\\mathrm{Hz}$，$\\tau = 0.8$。\n  - 在$[-L/2, L/2]^{2}$内的所有区域，$\\sigma = 0.01\\,\\mathrm{S/m}$。\n\n数值要求和输出格式：\n- 在$\\sigma(\\mathbf{r})$的支集上求解离散化体积分方程以获得总场$E_{z}$，计算每单元耗散功率，根据$\\tau$执行消除，重新计算降阶模型，并为每个测试用例在观测圆上评估$\\eta$。\n- 所有计算必须使用国际单位制，所有角度量必须使用弧度。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔的结果列表。每个相对误差必须四舍五入到小数点后恰好六位。例如，一个有效的输出格式是$[\\eta_{1},\\eta_{2},\\eta_{3},\\eta_{4}]$，其中每个$\\eta_{k}$都四舍五入到小数点后六位。",
            "solution": "用户提供了一个计算电磁学中有效的、良态的问题陈述。该任务涉及理论推导和数值实现。以下文本提供了所要求的推导和计算模型的解释，满足了用户请求的第一部分。\n\n该问题研究了在横磁（TM）极化下，二维有损非磁性物体的时谐电磁散射。目标是推导控制积分方程、其数值实现方法、一个基于物理的模型降阶方案以及一个量化降阶影响的误差度量。\n\n**1. 标量体积分方程的推导**\n\n我们从时谐麦克斯韦旋度方程开始，假设并抑制了一个$\\exp(i\\omega t)$的时间依赖性：\n$$\n\\nabla \\times \\mathbf{E}(\\mathbf{r}) = -i\\omega\\mathbf{B}(\\mathbf{r})\n$$\n$$\n\\nabla \\times \\mathbf{H}(\\mathbf{r}) = \\mathbf{J}_{\\text{total}}(\\mathbf{r})\n$$\n对于线性、各向同性、非磁性介质，本构关系为$\\mathbf{B}(\\mathbf{r}) = \\mu_0\\mathbf{H}(\\mathbf{r})$和$\\mathbf{D}(\\mathbf{r}) = \\varepsilon(\\mathbf{r})\\mathbf{E}(\\mathbf{r})$。总电流$\\mathbf{J}_{\\text{total}}$由传导电流$\\mathbf{J}(\\mathbf{r}) = \\sigma(\\mathbf{r})\\mathbf{E}(\\mathbf{r})$和位移电流$i\\omega\\mathbf{D}(\\mathbf{r})$组成。然而，用单个复介电常数来构建问题更为方便。第二个旋度方程变为：\n$$\n\\nabla \\times \\mathbf{H}(\\mathbf{r}) = \\sigma(\\mathbf{r})\\mathbf{E}(\\mathbf{r}) + i\\omega\\varepsilon_0\\mathbf{E}(\\mathbf{r}) = i\\omega \\left(\\varepsilon_0 - \\frac{i\\sigma(\\mathbf{r})}{\\omega}\\right) \\mathbf{E}(\\mathbf{r})\n$$\n这里，我们假设背景相对介电常数为1，并且所有材料效应都由电导率$\\sigma(\\mathbf{r})$捕捉。我们定义与位置相关的复介电常数为$\\varepsilon_c(\\mathbf{r}) = \\varepsilon_0 - i\\sigma(\\mathbf{r})/\\omega$。\n\n对第一个麦克斯韦方程取旋度并代入其他方程，我们得到矢量波动方程：\n$$\n\\nabla \\times \\nabla \\times \\mathbf{E}(\\mathbf{r}) - \\omega^2\\mu_0\\varepsilon_c(\\mathbf{r})\\mathbf{E}(\\mathbf{r}) = 0\n$$\n对于二维TM极化，电场只有一个平面外分量$\\mathbf{E}(\\mathbf{r}) = E_z(x,y)\\hat{\\mathbf{z}}$，并且沿z轴不变。算子$\\nabla \\times \\nabla \\times$得以简化。由于在非均匀介质中$\\nabla \\cdot \\mathbf{E} = 0$通常不成立，我们使用恒等式$\\nabla \\times \\nabla \\times \\mathbf{E} = \\nabla(\\nabla\\cdot\\mathbf{E}) - \\nabla^2\\mathbf{E}$。对于形式为$E_z(x,y)\\hat{\\mathbf{z}}$的场，$\\nabla \\cdot \\mathbf{E}=0$，矢量拉普拉斯算子变为$\\nabla^2\\mathbf{E} = (\\partial_x^2 + \\partial_y^2)E_z \\hat{\\mathbf{z}}$。因此，矢量波动方程简化为标量亥姆霍兹方程：\n$$\n\\nabla^2 E_z(x,y) + k_c^2(x,y)E_z(x,y) = 0\n$$\n其中$k_c^2(x,y) = \\omega^2\\mu_0\\varepsilon_c(x,y) = k_0^2(1 - i\\sigma(x,y)/(\\omega\\varepsilon_0))$，$k_0 = \\omega\\sqrt{\\mu_0\\varepsilon_0}$是自由空间波数。\n\n为了构建积分方程，我们采用体等效原理。我们重新排列亥姆霍兹方程，将自由空间波算子隔离在左侧：\n$$\n\\nabla^2 E_z + k_0^2 E_z = -k_0^2 \\left(\\frac{\\varepsilon_c}{\\varepsilon_0} - 1\\right) E_z\n$$\n括号中的项是材料对比度，$\\chi(\\mathbf{r}) = \\varepsilon_c(\\mathbf{r})/\\varepsilon_0 - 1 = -i\\sigma(\\mathbf{r})/(\\omega\\varepsilon_0)$。方程变为：\n$$\n(\\nabla^2 + k_0^2) E_z(\\mathbf{r}) = -k_0^2 \\chi(\\mathbf{r}) E_z(\\mathbf{r})\n$$\n这是一个非齐次亥姆霍兹方程，其右侧充当一个等效源分布，该源仅在$\\chi(\\mathbf{r}) \\neq 0$的地方存在。该源项与等效体电流密度$\\mathbf{J}_v = \\sigma\\mathbf{E}$直接相关，因为$-k_0^2 \\chi E_z = -\\omega^2\\mu_0\\varepsilon_0 (-i\\sigma/(\\omega\\varepsilon_0)) E_z = i\\omega\\mu_0\\sigma E_z = i\\omega\\mu_0J_{v,z}$。这证实了由$\\sigma$表示的材料损耗通过等效电流驱动散射过程。\n\n该方程的解是齐次解（入射场$E_z^{\\text{inc}}$）与通过将源与二维亥姆霍兹算子的格林函数进行卷积得到的特解之和。因此，总场由Lippmann-Schwinger方程给出：\n$$\nE_z(\\mathbf{r}) = E_z^{\\text{inc}}(\\mathbf{r}) + k_0^2 \\iint_{S_\\sigma} \\chi(\\mathbf{r}') E_z(\\mathbf{r}') G(\\mathbf{r}, \\mathbf{r}') \\,dS'\n$$\n其中$S_\\sigma$是$\\sigma(\\mathbf{r})$的支集，$G(\\mathbf{r}, \\mathbf{r}')$是二维标量格林函数，$G(\\mathbf{r}, \\mathbf{r}') = \\frac{i}{4} H_0^{(1)}(k_0|\\mathbf{r}-\\mathbf{r}'|)$。这就是所求的体积分方程。\n\n**2. 离散化与自相互作用**\n\n为数值求解此积分方程，我们采用矩量法（MoM）和配置法。散射体的支集$S_\\sigma$被离散化为$N$个面积为$\\Delta^2$的方形单元$C_j$。我们假设场$E_z$和对比度$\\chi$在每个单元内是常数，取其单元中心的值$E_j$和$\\chi_j$。通过在每个单元的中心$\\mathbf{r}_i$强制执行积分方程，它变成一个代数方程：\n$$\nE_z(\\mathbf{r}_i) = E_z^{\\text{inc}}(\\mathbf{r}_i) + k_0^2 \\sum_{j=1}^N \\chi_j E_j \\int_{C_j} G(\\mathbf{r}_i, \\mathbf{r}') \\,dS'\n$$\n我们使用中点法则来近似积分：$\\int_{C_j} G(\\mathbf{r}_i, \\mathbf{r}') \\,dS' \\approx G(\\mathbf{r}_i, \\mathbf{r}_j)\\Delta^2$。对所有$i=1,\\dots,N$强制执行此式：\n$$\nE_i = E_i^{\\text{inc}} + k_0^2 \\Delta^2 \\sum_{j=1}^N \\chi_j G_{ij} E_j\n$$\n其中$G_{ij} = G(\\mathbf{r}_i, \\mathbf{r}_j)$。这可以写成一个线性系统$\\mathbf{A}\\mathbf{E} = \\mathbf{E}^{\\text{inc}}$，其中$\\mathbf{E}$和$\\mathbf{E}^{\\text{inc}}$是单元中心的场向量，矩阵$\\mathbf{A}$的元素为$A_{ij} = \\delta_{ij} - k_0^2\\Delta^2 \\chi_j G_{ij}$。\n\n对角项（$i=j$）出现了一个问题，因为格林函数$G(\\mathbf{r}_i, \\mathbf{r}_i)$是奇异的。简单的中点近似无效。按照规定，我们用一个正则化的自作用项$G_{\\text{self}}$替换奇异值$G_{ii}$，该项通过在等效半径$a=\\sqrt{\\Delta^2/\\pi}$处（对应于与方形单元面积相同的圆）评估格林函数得到。\n$$\nG_{ii} \\rightarrow G_{\\text{self}} = \\frac{i}{4} H_0^{(1)}(k_0 a)\n$$\n通过此修正，矩阵$\\mathbf{A}$完全确定，可以求解该系统以获得未知场$E_j$。\n\n**3. 通过功率耗散进行模型降阶**\n\n求解线性系统的计算成本与有损单元的数量$N$成比例。模型降阶旨在通过消除对整体散射场影响可忽略的单元来减少$N$。识别此类单元的一个物理动机准则是它们的耗散功率。单元$C_j$中的时间平均耗散功率为：\n$$\nP_j = \\frac{1}{2} \\int_{C_j} \\operatorname{Re}\\left(\\mathbf{E} \\cdot \\mathbf{J}^*\\right) dV = \\frac{1}{2} \\int_{C_j} \\sigma(\\mathbf{r}) |\\mathbf{E}(\\mathbf{r})|^2 dV\n$$\n对于二维TM情况，考虑单位长度的功率并使用我们的离散模型，这近似为：\n$$\nP_j = \\frac{1}{2} \\sigma_j |E_j|^2 \\Delta^2\n$$\n总耗散功率为$P_{\\text{tot}} = \\sum_j P_j$。降阶算法如下进行：首先，求解全模型以找到所有$E_j$。然后，计算所有有损单元的$P_j$。给定一个容差$\\tau \\in [0,1)$，我们通过将单元按$P_j$升序排序，并找到其累积功率不超过$\\tau P_{\\text{tot}}$的最大子集，来识别“低影响”单元集。然后从模型中消除这些单元（通过将其$\\sigma_j$及$\\chi_j$设为零），并在较小的、降阶的单元集上重新求解积分方程。\n\n**4. 误差量化**\n\n为评估降阶模型的质量，我们将其预测的散射场与全模型的散射场进行比较。观测点$\\mathbf{r}^{\\text{obs}}$处的散射场通过辐射积分从已解出的内部场$E_j$计算得出：\n$$\nE_{z}^{\\mathrm{sca}}(\\mathbf{r}^{\\mathrm{obs}}) = k_0^2 \\sum_{j} \\chi_j E_j G(\\mathbf{r}^{\\mathrm{obs}}, \\mathbf{r}_j) \\Delta^2\n$$\n其中求和遍及模型中保留的单元（全模型或降阶模型）。我们在环绕散射体的圆上的$N_{\\text{obs}}$个点上计算该场，得到两个复数样本向量$\\mathbf{e}^{\\text{full}}$和$\\mathbf{e}^{\\text{red}}$。相对误差$\\eta$定义为它们差的归一化$L_2$范数：\n$$\n\\eta = \\frac{\\|\\mathbf{e}^{\\text{red}} - \\mathbf{e}^{\\text{full}}\\|_2}{\\max(\\|\\mathbf{e}^{\\text{full}}\\|_2, \\epsilon)}\n$$\n其中$\\|\\mathbf{v}\\|_2 = \\sqrt{\\sum_m |v_m|^2}$，$\\epsilon$是一个小的正则化常数，以防止在零散射情况下出现除以零。该度量提供了一个稳健的衡量标准，用于评估消除低功率单元所引入的远场误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import hankel1\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Define physical constants\n    EPS0 = 8.8541878128e-12\n    MU0 = 4 * np.pi * 1e-7\n    C0 = 1 / np.sqrt(EPS0 * MU0)\n    \n    # Epsilon for error normalization stability\n    epsilon_norm = 1e-16\n\n    # Test Case 1 Sigma Distribution\n    def sigma_tc1(x, y):\n        sigma = np.zeros_like(x)\n        rect1 = (-0.20 = x)  (x = -0.05)  (-0.15 = y)  (y = 0.15)\n        disk1 = (x - 0.15)**2 + y**2 = 0.08**2\n        sigma[rect1] = 0.5\n        sigma[disk1] = 0.05\n        return sigma\n\n    # Test Case 2 Sigma Distribution\n    def sigma_tc2(x, y):\n        return np.zeros_like(x)\n\n    # Test Case 3 Sigma Distribution\n    def sigma_tc3(x, y):\n        sigma = np.zeros_like(x)\n        r_sq = x**2 + y**2\n        disk2 = r_sq = 0.03**2\n        annulus2 = (r_sq > 0.03**2)  (r_sq = 0.10**2)\n        sigma[disk2] = 5.0\n        sigma[annulus2] = 0.02\n        return sigma\n\n    # Test Case 4 Sigma Distribution\n    def sigma_tc4(x, y):\n        return np.full(x.shape, 0.01)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.6, 16, 9.0e8, sigma_tc1, 0.1, epsilon_norm),\n        (0.6, 16, 9.0e8, sigma_tc2, 0.5, epsilon_norm),\n        (0.3, 18, 2.4e9, sigma_tc3, 0.02, epsilon_norm),\n        (0.5, 14, 1.0e9, sigma_tc4, 0.8, epsilon_norm),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_error_for_case(case, C0, EPS0)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef solve_vie(k0, delta, cell_coords, chi_vec, inc_field_vec, self_term):\n    \"\"\"\n    Solves the volume integral equation for the total field inside the scatterer.\n    \"\"\"\n    N = len(cell_coords)\n    if N == 0:\n        return np.array([])\n    \n    # Build the Green's function matrix G_ij = G(r_i, r_j)\n    G_matrix = np.zeros((N, N), dtype=np.complex128)\n    dists = np.linalg.norm(cell_coords[:, np.newaxis, :] - cell_coords[np.newaxis, :, :], axis=2)\n    \n    with np.errstate(divide='ignore', invalid='ignore'):\n         G_matrix = (1j / 4) * hankel1(0, k0 * dists)\n    \n    np.fill_diagonal(G_matrix, self_term)\n\n    # Construct the system matrix A for (I - K)E = E_inc\n    # A_ij = delta_ij - k0^2 * delta^2 * G_ij * chi_j\n    A = np.identity(N, dtype=np.complex128) - (k0**2 * delta**2) * (G_matrix * chi_vec)\n    \n    total_field_vec = np.linalg.solve(A, inc_field_vec)\n    return total_field_vec\n\ndef calculate_error_for_case(case_params, C0, EPS0):\n    \"\"\"\n    Performs the full simulation pipeline for a single test case.\n    \"\"\"\n    L, M, f, sigma_dist_func, tau, epsilon = case_params\n    \n    # 1. Setup grid and physical parameters\n    omega = 2 * np.pi * f\n    k0 = omega / C0\n    delta = L / M\n\n    cell_centers_1d = np.linspace(-L / 2 + delta / 2, L / 2 - delta / 2, M)\n    xx, yy = np.meshgrid(cell_centers_1d, cell_centers_1d)\n    grid_coords = np.vstack([xx.ravel(), yy.ravel()]).T\n\n    # 2. Define sigma and chi on the grid\n    sigma_grid = sigma_dist_func(grid_coords[:, 0], grid_coords[:, 1])\n    chi_grid = np.zeros_like(sigma_grid, dtype=np.complex128)\n    if omega > 0:\n      non_zero_sigma = sigma_grid > 0\n      chi_grid[non_zero_sigma] = -1j * sigma_grid[non_zero_sigma] / (omega * EPS0)\n\n    full_model_indices = np.where(sigma_grid > 0)[0]\n    \n    if len(full_model_indices) == 0:\n        return 0.0\n\n    # 3. Solve for the full model\n    full_cell_coords = grid_coords[full_model_indices]\n    full_chi_vec = chi_grid[full_model_indices]\n    inc_field_at_cells_full = np.exp(1j * k0 * full_cell_coords[:, 0])\n    a_eff = delta / np.sqrt(np.pi)\n    g_self = (1j / 4) * hankel1(0, k0 * a_eff)\n    e_full_vec = solve_vie(k0, delta, full_cell_coords, full_chi_vec, inc_field_at_cells_full, g_self)\n    \n    # 4. Perform model reduction\n    power_j = 0.5 * sigma_grid[full_model_indices] * np.abs(e_full_vec)**2 * delta**2\n    p_total = np.sum(power_j)\n\n    if p_total == 0:\n        return 0.0\n\n    sorted_power_indices_local = np.argsort(power_j)\n    sorted_powers = power_j[sorted_power_indices_local]\n    cumulative_power = np.cumsum(sorted_powers)\n    power_threshold = tau * p_total\n    num_to_eliminate = np.sum(cumulative_power = power_threshold)\n    elimination_indices_local = sorted_power_indices_local[:num_to_eliminate]\n    eliminated_cell_original_indices = full_model_indices[elimination_indices_local]\n    reduced_model_indices = np.setdiff1d(full_model_indices, eliminated_cell_original_indices, assume_unique=True)\n\n    # 5. Solve for reduced model\n    e_red_vec = np.array([])\n    if len(reduced_model_indices) > 0:\n        red_cell_coords = grid_coords[reduced_model_indices]\n        red_chi_vec = chi_grid[reduced_model_indices]\n        inc_field_at_cells_red = np.exp(1j * k0 * red_cell_coords[:, 0])\n        e_red_vec = solve_vie(k0, delta, red_cell_coords, red_chi_vec, inc_field_at_cells_red, g_self)\n        \n    # 6. Calculate scattered fields\n    N_obs = 64\n    R_obs = 1.2 * L\n    angles = np.linspace(0, 2 * np.pi, N_obs, endpoint=False)\n    obs_coords = R_obs * np.vstack([np.cos(angles), np.sin(angles)]).T\n    \n    # Full model scattered field\n    term_full = full_chi_vec * e_full_vec\n    dist_obs_full = np.linalg.norm(obs_coords[:, np.newaxis, :] - full_cell_coords[np.newaxis, :, :], axis=2)\n    G_obs_full = (1j / 4) * hankel1(0, k0 * dist_obs_full)\n    e_sca_full_vec = (k0**2 * delta**2) * (G_obs_full @ term_full)\n\n    # Reduced model scattered field\n    e_sca_red_vec = np.zeros(N_obs, dtype=np.complex128)\n    if len(reduced_model_indices) > 0:\n        term_red = red_chi_vec * e_red_vec\n        dist_obs_red = np.linalg.norm(obs_coords[:, np.newaxis, :] - red_cell_coords[np.newaxis, :, :], axis=2)\n        G_obs_red = (1j / 4) * hankel1(0, k0 * dist_obs_red)\n        e_sca_red_vec = (k0**2 * delta**2) * (G_obs_red @ term_red)\n    \n    # 7. Compute relative error\n    norm_e_full = np.linalg.norm(e_sca_full_vec)\n    norm_diff = np.linalg.norm(e_sca_red_vec - e_sca_full_vec)\n    eta = norm_diff / max(norm_e_full, epsilon)\n    \n    return eta\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}