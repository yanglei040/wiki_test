{
    "hands_on_practices": [
        {
            "introduction": "为了正确地模拟散射现象，解必须表示从散射体向外辐射的波，这一要求被称为索末菲辐射条件（Sommerfeld radiation condition）。体积积分方程通过选择正确的出射格林函数来强制执行此条件。在本实践中 ，您将探索选择不正确的格林函数所带来的后果，并研究数值伪影（如有限域截断）如何引入违反此关键条件的非物理反射。",
            "id": "3359707",
            "problem": "考虑电磁波在均匀背景下从弱非均匀、各向同性电介质中进行的频域散射，该问题通过体积分方程（Volume Integral Equation, VIE）进行建模。从频域中的麦克斯韦方程组出发，可以得到关于电场的 Lippmann–Schwinger 型体积分方程，其中并矢格林函数强制施加了 Sommerfeld 辐射条件。在一个一维简化模型中，我们研究标量亥姆霍兹方程，该模型捕捉了本质行为，同时在计算上易于处理。该方程涉及场 $u(x)$ 和背景波数 $k$，以及一个代表弱介电常数对比度的紧支集电极化率分布 $\\chi(x)$。在一阶玻恩近似下的标量体积分方程可以写为\n$$\nu_{\\text{scat}}(x) \\approx k^2 \\int_{-\\infty}^{\\infty} \\chi(x')\\, u_{\\text{inc}}(x')\\, G(x - x')\\, \\mathrm{d}x',\n$$\n其中 $u_{\\text{inc}}(x) = e^{i k x}$ 是入射平面波，$G(\\cdot)$ 是与一维亥姆霍兹算子相关的标量格林函数。为了正确强制施加 Sommerfeld 辐射条件，需要使用出射基本解\n$$\nG_{\\text{out}}(x) = \\frac{i}{2k}\\, e^{i k |x|},\n$$\n该解满足 $\\frac{\\mathrm{d}^2 G}{\\mathrm{d}x^2} + k^2 G = -\\delta(x)$ 并且从源向外辐射。通过取出射解的实部，可以构造一个非辐射（驻波）的选择\n$$\nG_{\\text{stand}}(x) = \\operatorname{Re}\\left(\\frac{i}{2k} e^{i k |x|}\\right) = -\\frac{1}{2k}\\, \\sin(k |x|),\n$$\n该解在分布意义上也满足 $\\frac{\\mathrm{d}^2 G}{\\mathrm{d}x^2} + k^2 G = -\\delta(x)$，但它通过叠加入射和出射分量而违反了辐射条件。\n\n在数值实践中，人们常常截断计算域或应用加窗近似来加速体积分方程算子的计算。这种有限域截断可以通过引入周期为 $L_{\\text{box}}$ 的周期性镜像来模拟，实际上是用一个周期性镜像和来替换自由空间格林函数\n$$\nG_{\\text{per}}(x;\\,L_{\\text{box}},P) = \\sum_{p=-P}^{P} G_{\\text{out}}(x + p L_{\\text{box}}),\n$$\n这会引入由散射体镜像引起的伪交互作用，并可能在观测区域中表现为人为的入射波（反射）。\n\n您的任务是实现一个程序，该程序：\n1. 将电极化率离散化为高斯函数，\n$$\n\\chi(x) = \\chi_0 \\exp\\!\\left(-\\frac{x^2}{2 \\sigma^2}\\right),\n$$\n在有限区间 $[-L_{\\text{scat}}/2,\\, L_{\\text{scat}}/2]$（单位：米）上进行数值支持，采用均匀网格间距 $\\Delta x$。\n2. 在右侧观测窗口 $x \\in [x_{\\min}, x_{\\max}]$ 上，使用三种算子选择来计算散射场 $u_{\\text{scat}}(x)$：\n   - 出射自由空间格林函数 $G_{\\text{out}}$（强制执行辐射条件）。\n   - 驻波格林函数 $G_{\\text{stand}}$（违反辐射条件）。\n   - 出射周期性镜像和 $G_{\\text{per}}$，使用指定的 $L_{\\text{box}}$ 和镜像数量 $P$（有限域截断）。\n3. 通过将观测窗口上的散射场拟合到一个双模模型中，来量化右侧的伪反射，\n$$\nu_{\\text{scat}}(x) \\approx A_{\\text{out}}\\, e^{i k x} + A_{\\text{in}}\\, e^{-i k x},\n$$\n拟合通过复数最小二乘法进行，并输出反射比\n$$\nr = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|},\n$$\n这是一个无量纲的浮点数。该比率分离出对应于从右侧 $+\\infty$ 处传来的入射波分量。\n\n除非在测试用例中被覆盖，否则请使用以下固定的物理和数值设置：距离单位是米，波数单位是弧度/米。设背景波数为 $k = 10$（弧度/米）。使用 $\\chi_0 = 0.05$（无量纲），$\\sigma = 0.2$ 米，$L_{\\text{scat}} = 2.0$ 米，$\\Delta x = 0.002$ 米，$x_{\\min} = 5.0$ 米，$x_{\\max} = 6.0$ 米，并以与 $\\Delta x$ 兼容的分辨率对观测窗口进行均匀采样。\n\n设计一个鲁棒且数值稳定的算法，该算法：\n- 通过对所选格林函数在 $|x - x'|$ 上进行向量化求值，乘以 $k^2 \\chi(x') u_{\\text{inc}}(x') \\Delta x$，并对源点 $x'$ 求和，来组装离散的玻恩算子。\n- 对于周期性镜像情况，使用在 $(x - x') + p L_{\\text{box}}$ 处求值的出射核在镜像 $p = -P,\\ldots,P$ 上的和，来模拟有限域截断。\n- 执行复数最小二乘拟合来估计 $A_{\\text{out}}$ 和 $A_{\\text{in}}$，并返回 $r$。\n\n测试套件和输出规范：\n为以下四个测试用例计算并报告反射比 $r$，这些用例旨在探究辐射条件的执行情况以及有限域截断的影响：\n\n- 情况1（理想路径，强制执行辐射条件）：$G = G_{\\text{out}}$。\n- 情况2（违反辐射条件）：$G = G_{\\text{stand}}$。\n- 情况3（有限域截断，轻微）：$G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 20.0$ 米， $P = 1$。\n- 情况4（有限域截断，严重）：$G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 8.0$ 米， $P = 3$。\n\n您的程序的最终输出必须是单行文本，其中包含由方括号括起来的、以逗号分隔的四个反射比，例如，\n$$\n[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4],\n$$\n每个 $\\text{r}_j$ 都报告为浮点数（无量纲）。不应打印任何额外文本。所有角度均以弧度度量，距离以米度量；输出的比率是无量纲的，不需要单位转换或四舍五入到特定有效位数，但它们必须是有效的浮点值。",
            "solution": "首先评估用户问题的有效性。\n\n### 步骤1：提取给定信息\n-   **控制方程**：一阶玻恩近似下的标量体积分方程（VIE）给出的散射场 $u_{\\text{scat}}(x)$ 为 $u_{\\text{scat}}(x) \\approx k^2 \\int_{-\\infty}^{\\infty} \\chi(x')\\, u_{\\text{inc}}(x')\\, G(x - x')\\, \\mathrm{d}x'$。\n-   **入射场**：入射平面波为 $u_{\\text{inc}}(x) = e^{i k x}$。\n-   **电极化率**：电极化率分布是一个高斯函数，$\\chi(x) = \\chi_0 \\exp\\!\\left(-\\frac{x^2}{2 \\sigma^2}\\right)$，在区间 $[-L_{\\text{scat}}/2,\\, L_{\\text{scat}}/2]$ 上进行数值支持。\n-   **格林函数**：\n    1.  出射（自由空间）：$G_{\\text{out}}(x) = \\frac{i}{2k}\\, e^{i k |x|}$。\n    2.  驻波：$G_{\\text{stand}}(x) = -\\frac{1}{2k}\\, \\sin(k |x|)$。\n    3.  周期性（用于模拟域截断）：$G_{\\text{per}}(x;\\,L_{\\text{box}},P) = \\sum_{p=-P}^{P} G_{\\text{out}}(x + p L_{\\text{box}})$。\n-   **分析模型**：观测窗口中的散射场被拟合到模型 $u_{\\text{scat}}(x) \\approx A_{\\text{out}}\\, e^{i k x} + A_{\\text{in}}\\, e^{-i k x}$。\n-   **要计算的量**：反射比 $r = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|}$。\n-   **物理和数值参数**：\n    -   背景波数：$k = 10$ rad/m。\n    -   电极化率峰值：$\\chi_0 = 0.05$。\n    -   高斯宽度：$\\sigma = 0.2$ m。\n    -   散射体支持长度：$L_{\\text{scat}} = 2.0$ m。\n    -   网格间距：$\\Delta x = 0.002$ m。\n    -   观测窗口：$[x_{\\min}, x_{\\max}] = [5.0, 6.0]$ m。\n-   **测试用例**：\n    1.  $G = G_{\\text{out}}$。\n    2.  $G = G_{\\text{stand}}$。\n    3.  $G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 20.0$ m, $P = 1$。\n    4.  $G = G_{\\text{per}}$，其中 $L_{\\text{box}} = 8.0$ m, $P = 3$。\n\n### 步骤2：使用提取的给定信息进行验证\n该问题在科学上基于波散射理论和计算电磁学的原理。数学表述，包括 Lippmann-Schwinger 方程、亥姆霍兹格林函数和玻恩近似，都是标准且正确的。问题是适定的，提供了构建数值解所需的所有必要参数和定义。语言客观而精确。测试用例旨在探究一个基本的物理概念——Sommerfeld 辐射条件——和一个常见的数值赝像，使得该问题成为一个有意义的练习，而非琐碎的计算。参数在物理上是合理的，并使得任务在计算上是可行的。\n\n### 步骤3：结论与行动\n问题是**有效的**。将开发一个解决方案。\n\n### 基于原理的解决方案设计\n\n该解决方案包括三个主要阶段：离散化体积分方程、针对不同的格林函数计算散射场，以及分析所得场以量化伪反射。\n\n**1. 积分方程的离散化**\n问题的核心是体积分方程 $u_{\\text{scat}}(x) \\approx \\int_{-\\infty}^{\\infty} G(x - x')\\, J(x')\\, \\mathrm{d}x'$，其中我们定义源密度为 $J(x') = k^2 \\chi(x') u_{\\text{inc}}(x')$。为了数值求解，我们采用标准的矩量法，并使用点匹配（配置）和脉冲基函数，这简化为黎曼和。\n\n首先，我们定义两个离散网格：\n-   一个源网格 $x'_j$，用于采样散射体区域 $[-L_{\\text{scat}}/2, L_{\\text{scat}}/2]$。点以步长 $\\Delta x = 0.002$ m 均匀分布。\n-   一个观测网格 $x_i$，用于采样观测窗口 $[x_{\\min}, x_{\\max}] = [5.0, 6.0]$ m，也采用间距 $\\Delta x$。\n\n连续积分近似为求和：\n$$\nu_{\\text{scat}}(x_i) \\approx \\sum_j G(x_i - x'_j)\\, J(x'_j)\\, \\Delta x\n$$\n这可以表示为矩阵-向量乘积。令 $\\mathbf{u}_{\\text{scat}}$ 为在点 $x_i$ 处散射场值的列向量，$\\mathbf{J}$ 为在点 $x'_j$ 处源密度值 $J(x'_j)$ 的列向量。方程变为：\n$$\n\\mathbf{u}_{\\text{scat}} = \\mathbf{G} \\cdot \\mathbf{J} \\cdot \\Delta x\n$$\n其中 $\\mathbf{G}$ 是一个矩阵，其元素为 $G_{ij} = G(x_i - x'_j)$。\n\n**2. 组装算子矩阵 $\\mathbf{G}$**\n该算法为四个测试用例中的每一个计算不同的 $\\mathbf{G}$ 矩阵。\n\n-   **情况1：出射格林函数 ($G_{\\text{out}}$)**\n    矩阵元素使用正确辐射解的公式填充：\n    $G_{ij} = G_{\\text{out}}(x_i - x'_j) = \\frac{i}{2k} e^{i k |x_i - x'_j|}$。在物理上，这确保了从任何源点 $x'_j$ 散射的能量都向外传播，远离源，满足 Sommerfeld 辐射条件。\n\n-   **情况2：驻波格林函数 ($G_{\\text{stand}}$)**\n    矩阵元素使用非辐射核：\n    $G_{ij} = G_{\\text{stand}}(x_i - x'_j) = -\\frac{1}{2k} \\sin(k |x_i - x'_j|)$。\n    该格林函数是 $G_{\\text{out}}$ 的实部，代表一个出射波和一个等幅入射波的叠加。使用它违反了辐射条件，预计会产生一个具有显著非物理入射分量的散射场。\n\n-   **情况3和4：周期性格林函数 ($G_{\\text{per}}$)**\n    此公式模拟了将无限域截断为有限周期域的效果。矩阵元素通过对主源及其周期性镜像的贡献求和来计算：\n    $G_{ij} = G_{\\text{per}}(x_i - x'_j; L_{\\text{box}}, P) = \\sum_{p=-P}^{P} G_{\\text{out}}((x_i - x'_j) + p L_{\\text{box}})$。\n    每个 $p \\neq 0$ 的项代表与散射体的周期性副本的伪交互作用。这些交互作用表现为从与真实散射体辐射方向不一致的方向到达观测窗口的波，从而产生人为的反射。情况3，周期较大 $L_{\\text{box}} = 20.0$ m，应显示较小的反射。情况4，周期较小 $L_{\\text{box}} = 8.0$ m 且镜像更多，应显示严重的反射赝像。\n\n**3. 用于反射比的最小二乘分析**\n在计算给定情况下的离散散射场向量 $\\mathbf{u}_{\\text{scat}}$ 后，我们需要量化反射。观测窗口中的散射场（位于散射体右侧的远场区域）被建模为右行（出射）波和左行（入射）波的叠加：\n$$\nu_{\\text{scat}}(x_i) \\approx A_{\\text{out}}\\, e^{i k x_i} + A_{\\text{in}}\\, e^{-i k x_i}\n$$\n这是一个关于未知复振幅 $A_{\\text{out}}$ 和 $A_{\\text{in}}$ 的线性模型。我们可以为所有观测点将其写成线性系统 $\\mathbf{M} \\mathbf{a} \\approx \\mathbf{u}_{\\text{scat}}$，其中：\n-   $\\mathbf{a} = [A_{\\text{out}}, A_{\\text{in}}]^T$ 是未知系数的向量。\n-   $\\mathbf{M}$ 是一个 $N_{\\text{obs}} \\times 2$ 的矩阵，其列是在观测点处求值的基函数，即 $M_{i1} = e^{i k x_i}$ 和 $M_{i2} = e^{-i k x_i}$。\n\n通过在复数最小二乘意义上求解该系统来找到系数 $A_{\\text{out}}$ 和 $A_{\\text{in}}$，这会最小化残差的范数 $||\\mathbf{M} \\mathbf{a} - \\mathbf{u}_{\\text{scat}}||^2$。为此使用 `numpy.linalg.lstsq` 函数。\n\n最后，反射比 $r$ 计算为入射波和出射波振幅的模之比：\n$$\nr = \\frac{|A_{\\text{in}}|}{|A_{\\text{out}}|}\n$$\n该值提供了对违反辐射条件的定量度量。对于一个完美的出射波，$r = 0$。对于一个纯驻波，$r = 1$。周期性情况将根据伪反射的严重程度产生中间值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious reflection ratios for 1D electromagnetic scattering\n    using different Green's function formulations in a Volume Integral Equation.\n    \"\"\"\n\n    def calculate_reflection_ratio(G_type, G_params={}):\n        \"\"\"\n        Calculates the reflection ratio for a single numerical experiment.\n\n        Args:\n            G_type (str): The type of Green's function to use ('out', 'stand', 'per').\n            G_params (dict): Parameters for the Green's function, e.g., L_box and P.\n\n        Returns:\n            float: The computed reflection ratio r = |A_in| / |A_out|.\n        \"\"\"\n        # Define fixed physical and numerical settings\n        k = 10.0          # Wavenumber (rad/m)\n        chi0 = 0.05       # Peak susceptibility (dimensionless)\n        sigma = 0.2       # Gaussian width of susceptibility (m)\n        L_scat = 2.0      # Length of scatterer support (m)\n        dx = 0.002        # Grid spacing (m)\n        x_min_obs = 5.0   # Start of observation window (m)\n        x_max_obs = 6.0   # End of observation window (m)\n\n        # 1. Discretize domains\n        # Source grid (where the scatterer exists)\n        num_pts_scat = int(round(L_scat / dx)) + 1\n        x_prime = np.linspace(-L_scat / 2, L_scat / 2, num_pts_scat)\n\n        # Observation grid (where the scattered field is measured)\n        num_pts_obs = int(round((x_max_obs - x_min_obs) / dx)) + 1\n        x_obs = np.linspace(x_min_obs, x_max_obs, num_pts_obs)\n\n        # 2. Define the source density J(x') = k^2 * chi(x') * u_inc(x')\n        chi_profile = chi0 * np.exp(-x_prime**2 / (2 * sigma**2))\n        u_inc = np.exp(1j * k * x_prime)\n        source = k**2 * chi_profile * u_inc\n\n        # 3. Assemble the discrete Green's function operator matrix G\n        # G_ij = G(x_obs[i] - x_prime[j])\n        z = x_obs[:, None] - x_prime[None, :]\n\n        if G_type == 'out':\n            # Outgoing (radiating) Green's function\n            G_matrix = (1j / (2 * k)) * np.exp(1j * k * np.abs(z))\n        elif G_type == 'stand':\n            # Standing-wave (non-radiating) Green's function\n            G_matrix = (-1 / (2 * k)) * np.sin(k * np.abs(z))\n        elif G_type == 'per':\n            # Periodic sum of outgoing Green's functions\n            L_box = G_params['L_box']\n            P = G_params['P']\n            G_matrix = np.zeros_like(z, dtype=np.complex128)\n            p_range = np.arange(-P, P + 1)\n            for p in p_range:\n                z_shifted = z + p * L_box\n                G_matrix += (1j / (2 * k)) * np.exp(1j * k * np.abs(z_shifted))\n        else:\n            raise ValueError(f\"Unknown Green's function type: {G_type}\")\n\n        # 4. Compute the scattered field via discrete convolution\n        # u_scat = integral G(x-x') J(x') dx' -> sum_j G_ij * J_j * dx\n        u_scat = G_matrix @ source * dx\n\n        # 5. Perform least-squares fit to find A_out and A_in\n        # Model: u_scat(x) = A_out * exp(ikx) + A_in * exp(-ikx)\n        # This is a linear system: M * [A_out, A_in]^T = u_scat\n        M = np.stack([\n            np.exp(1j * k * x_obs),   # Basis function for outgoing wave\n            np.exp(-1j * k * x_obs)  # Basis function for incoming wave\n        ], axis=1)\n\n        # Solve for the coefficients [A_out, A_in]\n        coeffs, _, _, _ = np.linalg.lstsq(M, u_scat, rcond=None)\n        A_out, A_in = coeffs[0], coeffs[1]\n\n        # 6. Calculate the reflection ratio\n        # A_out should be non-zero for a non-trivial scatterer\n        if np.abs(A_out) == 0:\n            return np.inf if np.abs(A_in) > 0 else 0.0\n        \n        r = np.abs(A_in) / np.abs(A_out)\n        return r\n\n    # Define the test suite\n    test_cases = [\n        {'type': 'out', 'params': {}},\n        {'type': 'stand', 'params': {}},\n        {'type': 'per', 'params': {'L_box': 20.0, 'P': 1}},\n        {'type': 'per', 'params': {'L_box': 8.0, 'P': 3}}\n    ]\n\n    # Run all test cases and collect results\n    results = []\n    for case in test_cases:\n        ratio = calculate_reflection_ratio(case['type'], case['params'])\n        results.append(ratio)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "实现体积积分方程的一个重大挑战是处理当源点和观察点重合时格林函数的奇异行为。本练习  介绍了杜菲变换（Duffy transform），这是一种强大的坐标映射技术，能够对四面体单元上的这些奇异积分进行正则化，使其适用于标准的数值积分方法。通过实施此方法，您将获得开发稳健、准确的VIE求解器所需的先进而关键技术的实践经验。",
            "id": "3359660",
            "problem": "考虑自由空间中的时谐麦克斯韦方程组及其相关的自由空间并矢格林函数。自由空间标量格林函数定义为 $g_k(\\mathbf{r}) = \\dfrac{e^{ik\\|\\mathbf{r}\\|}}{4\\pi\\|\\mathbf{r}\\|}$，在静态极限 $k \\to 0$ 下，它简化为 $g_0(\\mathbf{r}) = \\dfrac{1}{4\\pi\\|\\mathbf{r}\\|}$。自由空间并矢格林函数由 $\\mathbf{G}_k(\\mathbf{r}) = \\left(\\mathbf{I} + \\dfrac{1}{k^2}\\nabla\\nabla\\right) g_k(\\mathbf{r})$ 给出，其中 $\\mathbf{I}$ 是单位并矢，$\\nabla\\nabla$ 表示Hessian算子。在体积分方程的公式中，当源点 $\\mathbf{r}_0$ 位于四面体单元 $T$ 内部时，会出现形如 $\\displaystyle \\int_T g_0(\\mathbf{r}-\\mathbf{r}_0)\\,\\mathrm{d}V$ 的积分以及与 $\\nabla\\nabla g_0$ 在 $T$ 上的并矢运算，这导致在 $\\mathbf{r}=\\mathbf{r}_0$ 处产生一个弱奇异性。\n\n您的任务是在四面体单元上实现Duffy变换，以正则化标量核 $g_0(\\mathbf{r})$ 在自项（源点位于顶点）情况下的弱奇异积分。具体来说，处理一个由顶点 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$ 定义的四面体 $T$，奇异点位于顶点 $\\mathbf{v}_0$，边为 $\\mathbf{a}_1=\\mathbf{v}_1-\\mathbf{v}_0$，$\\mathbf{a}_2=\\mathbf{v}_2-\\mathbf{v}_0$，$\\mathbf{a}_3=\\mathbf{v}_3-\\mathbf{v}_0$。使用Duffy映射\n$$\n\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3,\n$$\n其中 $u\\in[0,1]$, $v\\in[0,1]$, $w\\in[0,1]$，以及雅可比行列式\n$$\nJ(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|.\n$$\n令 $\\mathbf{s}(v,w) = \\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3$，因此 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$。\n\n1) 从第一性原理推导在静态极限下标量核在 $T$ 上的正则化积分，\n$$\nI_{\\text{full}} = \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V,\n$$\n证明在Duffy变换下，这会变成一个在 $[0,1]^3$ 上的光滑积分，并明确地用 $u$、$v$、$w$、$\\mathbf{s}(v,w)$ 和 $\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$ 表示出被积函数。\n\n2) 考虑通过排除 $\\mathbf{v}_0$ 周围一个半径为 $\\varepsilon$ 的小球形邻域，并仅在由射线 $\\mathbf{a}_1$、$\\mathbf{a}_2$、$\\mathbf{a}_3$ 定义的三面锥上积分得到的解析自项。令 $\\hat{\\mathbf{a}}_i = \\mathbf{a}_i / \\|\\mathbf{a}_i\\|$ 为定义顶点处三面锥的单位方向向量。此锥体的立体角为\n$$\n\\Omega = 2\\,\\arctan\\!\\left(\\frac{\\left|\\det\\left[\\hat{\\mathbf{a}}_1\\ \\hat{\\mathbf{a}}_2\\ \\hat{\\mathbf{a}}_3\\right]\\right|}{1 + \\hat{\\mathbf{a}}_1\\cdot\\hat{\\mathbf{a}}_2 + \\hat{\\mathbf{a}}_2\\cdot\\hat{\\mathbf{a}}_3 + \\hat{\\mathbf{a}}_3\\cdot\\hat{\\mathbf{a}}_1}\\right),\n$$\n角度以弧度为单位。证明对于与三面锥相交的被排除球形区域内的标量核，其解析自项为\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}.\n$$\n\n3) 使用Duffy变换，将三面锥内且满足 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$ 的区域的贡献表示为数值积分\n$$\nI_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) = \\int_0^1\\!\\!\\int_0^1 \\left[\\int_0^{u_{\\max}(v,w)} \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|}\\, u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|\\,\\mathrm{d}u \\right] \\mathrm{d}v\\,\\mathrm{d}w,\n$$\n其中 $u_{\\max}(v,w) = \\min\\!\\left(1,\\,\\dfrac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$。简化关于 $u$ 的内层积分，以获得一个便于数值计算的表达式。类似地，写出\n$$\nI_{\\text{rest}}^{\\text{numeric}}(\\varepsilon) = \\int_0^1\\!\\!\\int_0^1 \\left[\\int_{u_{\\max}(v,w)}^{1} \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|}\\, u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|\\,\\mathrm{d}u \\right] \\mathrm{d}v\\,\\mathrm{d}w,\n$$\n并数值验证对于小的 $\\varepsilon$，近似式 $I_{\\text{full}} \\approx I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$ 能以高精度成立。\n\n您的程序必须使用映射到 $[0,1]$ 上的高斯-勒让德法则在 $v$ 和 $w$ 上实现高阶数值积分，并使用推导出的表达式在Duffy正则化后解析地执行 $u$ 积分。\n\n测试套件：\n使用以下四面体和排除半径 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3,\\varepsilon)$：\n- 案例1（类正四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (1,0,0)$,\n  - $\\mathbf{v}_2 = \\left(\\dfrac{1}{2}, \\dfrac{\\sqrt{3}}{2}, 0\\right)$,\n  - $\\mathbf{v}_3 = \\left(\\dfrac{1}{2}, \\dfrac{\\sqrt{3}}{6}, \\sqrt{\\dfrac{2}{3}}\\right)$,\n  - $\\varepsilon = 0.05$.\n- 案例2（偏斜四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (2.0, 0.1, 0.0)$,\n  - $\\mathbf{v}_2 = (0.2, 1.5, -0.1)$,\n  - $\\mathbf{v}_3 = (-0.1, 0.3, 0.9)$,\n  - $\\varepsilon = 0.02$.\n- 案例3（小四面体）：\n  - $\\mathbf{v}_0 = (0,0,0)$,\n  - $\\mathbf{v}_1 = (10^{-3}, 0, 0)$,\n  - $\\mathbf{v}_2 = (0, 10^{-3}, 0)$,\n  - $\\mathbf{v}_3 = (0, 0, 2\\cdot 10^{-3})$,\n  - $\\varepsilon = 10^{-5}$.\n\n最终输出：\n您的程序应生成一行输出，其中包含六个浮点数，按顺序对应于每种情况的绝对误差：\n$[E_{1}^{(1)},E_{2}^{(1)},E_{1}^{(2)},E_{2}^{(2)},E_{1}^{(3)},E_{2}^{(3)}]$,\n其中对于案例 $i$，\n- $E_{1}^{(i)} = \\left|I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) - I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon)\\right|$,\n- $E_{2}^{(i)} = \\left|I_{\\text{full}} - \\left(I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)\\right)\\right|$.\n所有角度必须以弧度处理。不需要物理单位；所有量都是由所选坐标和 $\\varepsilon$ 产生的无量纲值。您的程序应生成一行输出，包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,...]”）。",
            "solution": "在进行求解之前，需要对问题进行验证。\n\n### 步骤1：提取给定条件\n- **标量格林函数（静态极限）**：$g_0(\\mathbf{r}) = \\dfrac{1}{4\\pi\\|\\mathbf{r}\\|}$。\n- **待求积分**：$I_{\\text{full}} = \\displaystyle \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V$，其中 $T$ 是一个顶点为 $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$ 的四面体，奇异点在 $\\mathbf{v}_0$。\n- **边向量**：$\\mathbf{a}_1=\\mathbf{v}_1-\\mathbf{v}_0$, $\\mathbf{a}_2=\\mathbf{v}_2-\\mathbf{v}_0$, $\\mathbf{a}_3=\\mathbf{v}_3-\\mathbf{v}_0$。\n- **Duffy映射**：$\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3$，对于 $u,v,w \\in[0,1]$。\n- **雅可比行列式**：$J(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$。\n- **辅助向量和距离**：$\\mathbf{s}(v,w) = \\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3$，使得 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$。\n- **立体角公式**：$\\Omega = 2\\,\\arctan\\!\\left(\\frac{\\left|\\det\\left[\\hat{\\mathbf{a}}_1\\ \\hat{\\mathbf{a}}_2\\ \\hat{\\mathbf{a}}_3\\right]\\right|}{1 + \\hat{\\mathbf{a}}_1\\cdot\\hat{\\mathbf{a}}_2 + \\hat{\\mathbf{a}}_2\\cdot\\hat{\\mathbf{a}}_3 + \\hat{\\mathbf{a}}_3\\cdot\\hat{\\mathbf{a}}_1}\\right)$，其中 $\\hat{\\mathbf{a}}_i = \\mathbf{a}_i / \\|\\mathbf{a}_i\\|$。\n- **解析自项**：$I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}$。\n- **数值积分定义**：$I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon)$ 和 $I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$ 在由 $u_{\\max}(v,w) = \\min\\!\\left(1,\\,\\dfrac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$ 定义的子域上。\n- **测试案例和误差度量**：提供了三组四面体顶点和排除半径 $\\varepsilon$。需要计算两个误差度量 $E_{1}$ 和 $E_{2}$。\n\n### 步骤2：使用提取的给定条件进行验证\n根据验证标准分析问题陈述。\n- **科学依据**：该问题基于计算电磁学的既定原理，特别是边界元法和体积分方程。Duffy变换是正则化单纯形上奇异积分的标准、数学上合理的技术。格林函数和立体角的公式是正确的。\n- **适定性**：提供了所有必要的信息。定义、变换和目标清晰、精确，并导向一个唯一的、可计算的解。\n- **客观性**：语言正式且无偏见。该问题要求数学推导和数值计算，而非主观解释。\n\n未发现任何缺陷。该问题是完整的、一致的且科学有效的。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将提供完整解答。\n\n### 解法推导与数值策略\n\n解法分为三部分，对应问题陈述中列出的任务。\n\n**第1部分：使用Duffy变换对全积分进行正则化**\n\n目标是正则化弱奇异积分\n$$\nI_{\\text{full}} = \\int_T g_0(\\mathbf{r}-\\mathbf{v}_0)\\,\\mathrm{d}V = \\int_T \\frac{1}{4\\pi\\|\\mathbf{r}-\\mathbf{v}_0\\|}\\,\\mathrm{d}V.\n$$\n奇异点发生在 $\\mathbf{r} = \\mathbf{v}_0$ 处，此时分母为零。我们应用给定的Duffy坐标变换，将 $(\\mathbf{r})$ 空间中的四面体 $T$ 映射到 $(u,v,w)$ 空间中的单位立方体 $[0,1]^3$。\n变换为 $\\mathbf{r}(u,v,w) = \\mathbf{v}_0 + u\\,\\mathbf{a}_1 + u\\,v\\,\\mathbf{a}_2 + u\\,v\\,w\\,\\mathbf{a}_3$。\n相对于奇异点的位矢是 $\\mathbf{r}-\\mathbf{v}_0 = u(\\mathbf{a}_1 + v\\,\\mathbf{a}_2 + v\\,w\\,\\mathbf{a}_3) = u\\,\\mathbf{s}(v,w)$。\n因此，到奇异点的距离为 $\\|\\mathbf{r}-\\mathbf{v}_0\\| = u\\,\\|\\mathbf{s}(v,w)\\|$，对于 $u \\ge 0$。\n微分体积元根据 $\\mathrm{d}V = |J(u,v,w)|\\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w$ 进行变换，其中雅可比行列式为 $J(u,v,w) = u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|$。它在积分域上是非负的。\n\n将这些代入积分表达式：\n$$\nI_{\\text{full}} = \\int_0^1 \\int_0^1 \\int_0^1 \\frac{1}{4\\pi u\\|\\mathbf{s}(v,w)\\|} \\left( u^2 v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right| \\right) \\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w.\n$$\n分母中的因子 $u$ 与雅可比行列式中 $u^2$ 项的一个因子 $u$ 相消。得到的被积函数是：\n$$\n\\text{Integrand} = \\frac{u\\,v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|}.\n$$\n现在这个被积函数是正则的。$u=0$ 处的潜在奇异点已被消除，因为现在被积函数在 $u=0$ 时为零。对于一个非退化的四面体，$\\|\\mathbf{s}(v,w)\\|>0$ 在积分域上成立，因此分母表现良好。积分变为：\n$$\nI_{\\text{full}} = \\int_0^1 \\int_0^1 \\int_0^1 \\frac{u\\,v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|} \\,\\mathrm{d}u\\,\\mathrm{d}v\\,\\mathrm{d}w.\n$$\n这是一个在单位立方体上的光滑积分，适合进行数值积分。\n\n**第2部分：小球形邻域内的解析自项**\n\n我们被要求证明 $g_0(\\mathbf{r}-\\mathbf{v}_0)$ 在一个以 $\\mathbf{v}_0$ 为中心、半径为 $\\varepsilon$ 的球体与四面体顶点构成的三面锥的交集区域上的积分等于 $I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\frac{\\varepsilon^2}{2}\\,\\frac{\\Omega}{4\\pi}$。\n\n令积分区域为 $V_\\varepsilon$，它是球 $B_\\varepsilon(\\mathbf{v}_0)$ 内部且位于锥体内的部分。我们使用以 $\\mathbf{v}_0$ 为中心的球坐标系 $(\\rho, \\theta, \\phi)$，所以 $\\rho = \\|\\mathbf{r}-\\mathbf{v}_0\\|$。微分体积元是 $\\mathrm{d}V = \\rho^2 \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\rho^2 \\mathrm{d}\\Omega'$，其中 $\\mathrm{d}\\Omega'$ 是微分立体角。\n积分为：\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\int_{V_\\varepsilon} \\frac{1}{4\\pi\\rho} \\mathrm{d}V = \\int_{\\text{cone}} \\left( \\int_0^\\varepsilon \\frac{1}{4\\pi\\rho} \\rho^2\\,\\mathrm{d}\\rho \\right) \\mathrm{d}\\Omega'.\n$$\n首先，我们计算径向积分：\n$$\n\\int_0^\\varepsilon \\frac{\\rho}{4\\pi}\\,\\mathrm{d}\\rho = \\frac{1}{4\\pi} \\left[ \\frac{\\rho^2}{2} \\right]_0^\\varepsilon = \\frac{\\varepsilon^2}{8\\pi}.\n$$\n这个结果相对于角向积分是一个常数。现在，我们在锥体的立体角 $\\Omega$ 上积分：\n$$\nI_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) = \\int_{\\text{cone}} \\frac{\\varepsilon^2}{8\\pi} \\mathrm{d}\\Omega' = \\frac{\\varepsilon^2}{8\\pi} \\int_{\\text{cone}} \\mathrm{d}\\Omega' = \\frac{\\varepsilon^2}{8\\pi} \\Omega.\n$$\n这可以写成 $\\frac{\\varepsilon^2}{2} \\frac{\\Omega}{4\\pi}$，从而证实了给定的公式。\n\n**第3部分：数值评估与验证**\n\n积分 $I_{\\text{full}}$ 可以分为两部分：一部分在区域 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$（球内，$I_{\\text{ball}}$）上，另一部分在区域 $\\|\\mathbf{r}-\\mathbf{v}_0\\| > \\varepsilon$（剩余体积，$I_{\\text{rest}}$）上。在Duffy坐标系中，条件 $\\|\\mathbf{r}-\\mathbf{v}_0\\| \\le \\varepsilon$ 变为 $u\\|\\mathbf{s}(v,w)\\| \\le \\varepsilon$，或 $u \\le \\varepsilon/\\|\\mathbf{s}(v,w)\\|$。由于我们还要求 $u \\le 1$，球形区域的积分上限是 $u_{\\max}(v,w) = \\min\\left(1, \\frac{\\varepsilon}{\\|\\mathbf{s}(v,w)\\|}\\right)$。\n\n关于 $u$ 的积分可以解析地进行。令 $C(v,w) = \\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{4\\pi \\|\\mathbf{s}(v,w)\\|}$。被积函数为 $C(v,w) u$。\n\n对于 $I_{\\text{full}}$，我们将 $u$ 从 $0$ 积分到 $1$：\n$$\n\\int_0^1 C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_0^1 = \\frac{C(v,w)}{2}.\n$$\n因此，$I_{\\text{full}}$ 的 $(v,w)$ 求积的被积函数是 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|}$。\n\n对于 $I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon)$，我们将 $u$ 从 $0$ 积分到 $u_{\\max}$：\n$$\n\\int_0^{u_{\\max}} C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_0^{u_{\\max}} = \\frac{C(v,w)}{2} (u_{\\max})^2.\n$$\n$(v,w)$ 求积的被积函数是 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|} \\left(u_{\\max}(v,w)\\right)^2$。\n\n对于 $I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$，我们将 $u$ 从 $u_{\\max}$ 积分到 $1$：\n$$\n\\int_{u_{\\max}}^1 C(v,w) u\\,\\mathrm{d}u = C(v,w) \\left[\\frac{u^2}{2}\\right]_{u_{\\max}}^1 = \\frac{C(v,w)}{2} (1 - (u_{\\max})^2).\n$$\n$(v,w)$ 求积的被积函数是 $\\frac{v\\,\\left|\\det\\left[\\mathbf{a}_1\\ \\mathbf{a}_2\\ \\mathbf{a}_3\\right]\\right|}{8\\pi \\|\\mathbf{s}(v,w)\\|} \\left(1 - \\left(u_{\\max}(v,w)\\right)^2\\right)$。\n\n剩余的在 $(v,w) \\in [0,1]^2$ 上的二维积分是光滑的，可以使用高阶高斯-勒让德求积法则精确计算。根据构造，数值计算将精确满足 $I_{\\text{full}}^{\\text{numeric}} = I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)$ 直到机器精度。因此，要计算的两个误差度量\n$$\nE_1 = \\left|I_{\\text{ball}}^{\\text{numeric}}(\\varepsilon) - I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon)\\right|\n$$\n$$\nE_2 = \\left|I_{\\text{full}}^{\\text{numeric}} - \\left(I_{\\text{ball}}^{\\text{analytic}}(\\varepsilon) + I_{\\text{rest}}^{\\text{numeric}}(\\varepsilon)\\right)\\right|\n$$\n也将在机器精度范围内相同，因为\n$E_2 = \\left|(I_{\\text{ball}}^{\\text{numeric}} + I_{\\text{rest}}^{\\text{numeric}}) - (I_{\\text{ball}}^{\\text{analytic}} + I_{\\text{rest}}^{\\text{numeric}})\\right| = \\left|I_{\\text{ball}}^{\\text{numeric}} - I_{\\text{ball}}^{\\text{analytic}}\\right| = E_1$。\n这些误差的大小表明基于立体角的近场贡献解析公式与稳健的数值积分方法的结果匹配得有多好。一个小的误差验证了解析公式和数值实现的正确性。\n该实现将使用映射到区间 $[0,1]$ 的32点高斯-勒让德法则的二维张量积。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_legendre\n\ndef get_gauss_legendre_quadrature(n):\n    \"\"\"\n    Returns points and weights for Gauss-Legendre quadrature on [0, 1].\n    \n    Args:\n        n (int): The number of quadrature points.\n        \n    Returns:\n        tuple: A tuple containing:\n            - np.ndarray: Quadrature points in [0, 1].\n            - np.ndarray: Quadrature weights for the [0, 1] interval.\n    \"\"\"\n    points, weights = roots_legendre(n)\n    # Map from [-1, 1] to [0, 1]\n    mapped_points = (points + 1.0) / 2.0\n    mapped_weights = weights / 2.0\n    return mapped_points, mapped_weights\n\ndef compute_errors(v0, v1, v2, v3, eps, Np=32):\n    \"\"\"\n    Computes the integral errors E1 and E2 for a given tetrahedron.\n    \n    Args:\n        v0, v1, v2, v3 (tuple): Coordinates of the tetrahedron vertices.\n        eps (float): Radius of the exclusion sphere.\n        Np (int): Number of points for Gauss-Legendre quadrature.\n        \n    Returns:\n        tuple: A tuple containing the errors (E1, E2).\n    \"\"\"\n    # Define edge vectors a_i from the singular vertex v0\n    a1 = np.array(v1) - np.array(v0)\n    a2 = np.array(v2) - np.array(v0)\n    a3 = np.array(v3) - np.array(v0)\n    \n    # The matrix A is formed by the edge vectors as columns\n    A_matrix = np.array([a1, a2, a3]).T\n    det_A = np.linalg.det(A_matrix)\n    \n    # === Part 1: Analytic Ball Integral Calculation ===\n    \n    # Normalize edge vectors\n    norm_a1 = np.linalg.norm(a1)\n    norm_a2 = np.linalg.norm(a2)\n    norm_a3 = np.linalg.norm(a3)\n    \n    a1_hat = a1 / norm_a1 if norm_a1 > 0 else a1\n    a2_hat = a2 / norm_a2 if norm_a2 > 0 else a2\n    a3_hat = a3 / norm_a3 if norm_a3 > 0 else a3\n\n    # Determinant of normalized vectors\n    A_hat_matrix = np.array([a1_hat, a2_hat, a3_hat]).T\n    det_A_hat = np.linalg.det(A_hat_matrix)\n    \n    # Dot products for the solid angle formula\n    dot12 = np.dot(a1_hat, a2_hat)\n    dot23 = np.dot(a2_hat, a3_hat)\n    dot31 = np.dot(a3_hat, a1_hat)\n    \n    # Solid angle calculation using the given formula\n    omega_numerator = np.abs(det_A_hat)\n    omega_denominator = 1.0 + dot12 + dot23 + dot31\n    if omega_denominator == 0:\n        # This case should not happen for a valid, convex trihedral angle\n        solid_angle_Omega = np.pi if omega_numerator > 0 else 0\n    else:\n        solid_angle_Omega = 2.0 * np.arctan(omega_numerator / omega_denominator)\n    \n    i_ball_analytic = (eps**2 / 2.0) * (solid_angle_Omega / (4.0 * np.pi))\n\n    # === Part 2: Numerical Integration using Duffy Transform ===\n    \n    points, weights = get_gauss_legendre_quadrature(Np)\n    v_points, w_points = points, points\n    v_weights, w_weights = weights, weights\n    \n    i_full_numeric = 0.0\n    i_ball_numeric = 0.0\n    i_rest_numeric = 0.0\n    \n    for i in range(Np):\n        v = v_points[i]\n        wv = v_weights[i]\n        for j in range(Np):\n            w = w_points[j]\n            ww = w_weights[j]\n            \n            # Calculate s(v, w) and its norm\n            s_vec = a1 + v * a2 + v * w * a3\n            norm_s = np.linalg.norm(s_vec)\n            \n            # Common factor from analytic integration over u\n            common_factor = v * np.abs(det_A) / (8.0 * np.pi * norm_s)\n            \n            # Integrand for I_full (after u-integration)\n            # The original u-integral is C * u, from 0 to 1, giving C * 1/2.\n            # C = v * |det| / (4 * pi * ||s||), so C/2 = common_factor\n            integrand_full = common_factor\n            i_full_numeric += wv * ww * integrand_full\n            \n            # Calculate u_max for splitting the integral\n            u_max = min(1.0, eps / norm_s)\n            \n            # Add contributions to ball and rest integrals\n            i_ball_numeric += wv * ww * (common_factor * u_max**2)\n            i_rest_numeric += wv * ww * (common_factor * (1.0 - u_max**2))\n            \n    # === Part 3: Error Calculation ===\n    \n    e1 = np.abs(i_ball_numeric - i_ball_analytic)\n    e2 = np.abs(i_full_numeric - (i_ball_analytic + i_rest_numeric))\n    \n    return e1, e2\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (regular-like tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (1.0, 0.0, 0.0),\n            \"v2\": (0.5, np.sqrt(3.0)/2.0, 0.0),\n            \"v3\": (0.5, np.sqrt(3.0)/6.0, np.sqrt(2.0/3.0)),\n            \"eps\": 0.05\n        },\n        # Case 2 (skew tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (2.0, 0.1, 0.0),\n            \"v2\": (0.2, 1.5, -0.1),\n            \"v3\": (-0.1, 0.3, 0.9),\n            \"eps\": 0.02\n        },\n        # Case 3 (small tetrahedron)\n        {\n            \"v0\": (0.0, 0.0, 0.0),\n            \"v1\": (1.0e-3, 0.0, 0.0),\n            \"v2\": (0.0, 1.0e-3, 0.0),\n            \"v3\": (0.0, 0.0, 2.0e-3),\n            \"eps\": 1.0e-5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        e1, e2 = compute_errors(\n            case[\"v0\"], case[\"v1\"], case[\"v2\"], case[\"v3\"], case[\"eps\"]\n        )\n        results.extend([e1, e2])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}