{
    "hands_on_practices": [
        {
            "introduction": "The standard FDTD algorithm is elegantly simple but assumes that material properties like permittivity are constant with frequency. To model realistic materials, whose response is often frequency-dependent (dispersive), we must extend the basic update equations. This practice  guides you through a foundational derivation for a Debye relaxation medium, a ubiquitous model for materials from biological tissues to polar liquids. By combining Maxwell's equations with the material's constitutive relation for the polarization $\\mathbf{P}(t)$, you will derive the explicit FDTD update equations from first principles, a core skill for any developer in computational electromagnetics.",
            "id": "3331618",
            "problem": "Consider a nonmagnetic linear isotropic dielectric modeled by a single-pole Debye relaxation, simulated with the Finite-Difference Time-Domain (FDTD) method on a staggered Yee time grid. Let the electric field be updated at integer times $t^{n} = n \\,\\Delta t$ and the magnetic field at half-integer times $t^{n+\\frac{1}{2}} = \\left(n+\\tfrac{1}{2}\\right)\\Delta t$. The constitutive relation is $ \\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t) $, where $\\epsilon_{\\infty}$ is the high-frequency permittivity and $\\mathbf{P}(t)$ is the polarization density obeying the Debye ordinary differential equation\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\,\\mathbf{E}(t) - \\frac{1}{\\tau}\\,\\mathbf{P}(t),\n$$\nwith $\\Delta \\epsilon = \\epsilon_{s} - \\epsilon_{\\infty} \\ge 0$ the static increment of permittivity and $\\tau  0$ the relaxation time. The medium may be lossy with uniform electric conductivity $\\sigma \\ge 0$, producing a conduction current density $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$. Neglect any impressed sources.\n\nStarting from Maxwell–Ampère’s law in the time domain,\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}},\n$$\nderive a fully explicit update for the electric field $\\mathbf{E}^{n+1}$ at time $t^{n+1}$ in terms of known quantities at time levels $t^{n}$ and $t^{n+\\frac{1}{2}}$ under the following modeling and discretization assumptions, all of which must be used and justified in your derivation:\n\n- Treat the polarization dynamics by exact time integration over the interval $[t^{n}, t^{n+1}]$ under the assumption that the electric field is piecewise constant in time over this interval at its staggered update level $t^{n}$.\n- Discretize Maxwell–Ampère’s law in time over $[t^{n}, t^{n+1}]$ in a form consistent with the Yee grid staggering, such that the discrete curl of $\\mathbf{H}$ is evaluated at $t^{n+\\frac{1}{2}}$ and the remaining terms are expressed at integer times.\n- To maintain second-order accuracy in the presence of conduction, approximate the conduction current over the interval by the trapezoidal rule in time, i.e., use the average of $\\mathbf{E}^{n}$ and $\\mathbf{E}^{n+1}$.\n\nYour final update must have the affine form\n$$\n\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n},\n$$\nwith scalar coefficients $C_{E}$, $C_{H}$, and $C_{P}$ expressed in closed form as functions of $\\epsilon_{\\infty}$, $\\Delta \\epsilon$, $\\tau$, $\\sigma$, and $\\Delta t$. Report the three coefficients as a single row vector. No numerical values are to be substituted; provide exact analytical expressions only. The answer must be unitless and must be expressed exactly, with no rounding. In your derivation, start from the laws and definitions stated above and do not invoke any pre-derived update shortcuts not obtained from these first principles.",
            "solution": "The problem requires the derivation of an explicit finite-difference time-domain (FDTD) update equation for the electric field $\\mathbf{E}$ in a lossy, dispersive dielectric medium characterized by a single-pole Debye relaxation. The derivation must start from Maxwell's equations and adhere to specific discretization assumptions.\n\nThe validation steps confirm that the problem is scientifically grounded, well-posed, objective, and complete. It presents a standard, non-trivial task in computational electromagnetics. Therefore, we proceed with the solution.\n\nThe derivation begins with Maxwell–Ampère’s law, given as:\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}}\n$$\nHere, $\\mathbf{D}$ is the electric displacement field, $\\mathbf{H}$ is the magnetic field, and $\\mathbf{J}_{\\mathrm{c}}$ is the conduction current density. To discretize this equation in time, we integrate it over the time interval $[t^{n}, t^{n+1}]$, where $t^n = n \\Delta t$.\n$$\n\\int_{t^{n}}^{t^{n+1}} \\frac{\\partial \\mathbf{D}}{\\partial t} dt = \\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt - \\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}} dt\n$$\nThe left-hand side is evaluated exactly by the fundamental theorem of calculus:\n$$\n\\mathbf{D}(t^{n+1}) - \\mathbf{D}(t^{n}) = \\mathbf{D}^{n+1} - \\mathbf{D}^{n}\n$$\nFor the terms on the right-hand side, we apply the specified discretization rules.\nFirst, the magnetic field term is discretized consistently with the Yee grid, where $\\mathbf{H}$ is evaluated at half-integer time steps. The integral is approximated using the midpoint rule, which is second-order accurate in $\\Delta t$, by assuming the integrand is constant at its value at the midpoint of the interval, $t^{n+\\frac{1}{2}}$:\n$$\n\\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt \\approx (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t\n$$\nSecond, the conduction current term integral is approximated using the trapezoidal rule, as specified in the problem statement. This is also second-order accurate. Given $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$, we have:\n$$\n\\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}}(t) dt \\approx \\frac{\\Delta t}{2} \\left(\\mathbf{J}_{\\mathrm{c}}^{n} + \\mathbf{J}_{\\mathrm{c}}^{n+1}\\right) = \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\nSubstituting these approximations into the integrated Maxwell-Ampère law yields:\n$$\n\\mathbf{D}^{n+1} - \\mathbf{D}^{n} = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\nNext, we introduce the constitutive relation for the Debye medium: $\\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t)$. Applying this at time steps $n$ and $n+1$:\n$$\n\\mathbf{D}^n = \\epsilon_{\\infty} \\mathbf{E}^n + \\mathbf{P}^n\n$$\n$$\n\\mathbf{D}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}\n$$\nSubstituting these into the discretized Maxwell's equation gives:\n$$\n(\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}) - (\\epsilon_{\\infty} \\mathbf{E}^{n} + \\mathbf{P}^{n}) = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} (\\mathbf{E}^{n} + \\mathbf{E}^{n+1})\n$$\nThis equation involves the unknown polarization $\\mathbf{P}^{n+1}$. To find an expression for it, we must solve the Debye ordinary differential equation for the polarization density $\\mathbf{P}(t)$:\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t) - \\frac{1}{\\tau}\\mathbf{P}(t) \\implies \\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t)\n$$\nThe problem requires an exact integration of this ODE over $[t^n, t^{n+1}]$ under the assumption that the electric field $\\mathbf{E}(t)$ is piecewise constant over this interval, taking its value at the beginning of the interval, i.e., $\\mathbf{E}(t) = \\mathbf{E}^n$ for $t \\in [t^n, t^{n+1}]$. With this assumption, the ODE becomes a first-order linear differential equation with a constant forcing term:\n$$\n\\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}^n\n$$\nThe general solution for an ODE of the form $y'(t) + a y(t) = C$ with initial condition $y(t_0) = y_0$ is $y(t) = (y_0 - C/a) \\exp(-a(t-t_0)) + C/a$. Here, $y(t) = \\mathbf{P}(t)$, $a = 1/\\tau$, $C = (\\Delta \\epsilon / \\tau) \\mathbf{E}^n$, and the initial condition is $\\mathbf{P}(t^n) = \\mathbf{P}^n$. The term $C/a$ is $\\Delta \\epsilon \\mathbf{E}^n$.\nThe solution for $\\mathbf{P}(t)$ in the interval is:\n$$\n\\mathbf{P}(t) = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{t-t^n}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\nWe need $\\mathbf{P}^{n+1} = \\mathbf{P}(t^{n+1})$, which is found by setting $t = t^{n+1} = t^n + \\Delta t$:\n$$\n\\mathbf{P}^{n+1} = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\nRearranging this gives an update equation for the polarization:\n$$\n\\mathbf{P}^{n+1} = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nNow we substitute this expression for $\\mathbf{P}^{n+1}$ back into the main discretized equation. First, we rearrange the main equation to isolate terms containing $\\mathbf{E}^{n+1}$:\n$$\n\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n} - \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\mathbf{P}^n - \\mathbf{P}^{n+1}\n$$\nLet's compute the term $\\mathbf{P}^n - \\mathbf{P}^{n+1}$:\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\mathbf{P}^n - \\left[ \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n \\right]\n$$\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nSubstituting this into the equation for $\\mathbf{E}^{n+1}$:\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nNow, we group the coefficients of $\\mathbf{E}^n$ on the right-hand side:\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left[ \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\right] \\mathbf{E}^{n} + \\Delta t (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n\n$$\nFinally, we solve for $\\mathbf{E}^{n+1}$ by dividing by the factor on the left-hand side to obtain the desired affine form $\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n}$.\nThe coefficients are identified as:\n$$\nC_{E} = \\frac{\\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{H} = \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{P} = \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\nThese are the three scalar coefficients for the explicit update equation for $\\mathbf{E}^{n+1}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2} - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having the correct update equations is only half the battle; applying them accurately to complex geometries is the other. In practice, material interfaces rarely align perfectly with the Cartesian FDTD grid, forcing us to assign effective material parameters like $\\epsilon$ and $\\sigma$ to the cells they cut through. This coding exercise  allows you to investigate this crucial step by comparing two common averaging schemes, quantifying their error in enforcing the physical continuity of the normal electric displacement field $\\mathbf{D}$, and gaining intuition for why more sophisticated subgridding methods are often necessary.",
            "id": "3331577",
            "problem": "Consider a single two-dimensional Yee cell used in the Finite-Difference Time-Domain (FDTD) method, which is a staggered-grid algorithm for solving Maxwell’s equations in time domain. The square cell has side length $\\Delta$ with corners at $(\\pm \\Delta/2, \\pm \\Delta/2)$ in the $(x,y)$-plane. A planar material interface cuts the cell along the straight line $\\hat{\\mathbf{n}}\\cdot \\mathbf{r} = 0$ that passes through the cell center, where the unit normal is $\\hat{\\mathbf{n}} = (\\cos \\theta, \\sin \\theta)$ and $\\theta$ is the angle (in radians) of the normal with respect to the $x$-axis. The medium on the side where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ has permittivity $\\epsilon_1$ and conductivity $\\sigma_1$, and the medium where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ has permittivity $\\epsilon_2$ and conductivity $\\sigma_2$. Assume a time-harmonic field at angular frequency $\\omega = 2\\pi f$ with frequency $f$ in $\\mathrm{Hz}$, and define the complex permittivity $\\epsilon_c = \\epsilon - i \\sigma/\\omega$ to unify lossless and lossy materials.\n\nIn the Yee cell for two-dimensional transverse-magnetic configuration with out-of-plane magnetic field, the in-plane electric field is represented by components located on the centers of the four edges of the square: the top edge at $y = \\Delta/2$, the bottom edge at $y = -\\Delta/2$, the left edge at $x = -\\Delta/2$, and the right edge at $x = \\Delta/2$. When an interface cuts a cell, assigning material properties for the edge-centered electric field updates requires an interpolation strategy. Two strategies are considered:\n\n1. Volume-weighted interpolation: assign a single effective complex permittivity for all edges by weighting $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$ according to the area fractions of the two media inside the cell. For a straight interface passing through the center of the square, the area fraction of each medium is $1/2$, so the effective complex permittivity is $\\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}$.\n\n2. Edge-weighted interpolation: assign an effective complex permittivity for each edge by weighting $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$ according to the edge-length fraction of that edge lying in each medium. For a given edge $e$ with endpoints $\\mathbf{r}_1$ and $\\mathbf{r}_2$, define the signed values $s_1 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_1$ and $s_2 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_2$. The fraction of the edge length lying in the $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ medium, denoted $f_e$, is $f_e = 1$ if $s_1  0$ and $s_2  0$, $f_e = 0$ if $s_1  0$ and $s_2  0$, and if $s_1$ and $s_2$ have opposite signs then $f_e$ equals the fraction of the segment for which $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$, namely $f_e = s_2/(s_2 - s_1)$ if $s_2  0$ and $f_e = -s_1/(s_2 - s_1)$ if $s_1  0$. If $s_1 = s_2 = 0$, set $f_e = 1/2$. The edge-weighted effective complex permittivity for edge $e$ is then $\\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}$.\n\nEnforcement of boundary conditions at oblique angles is quantified via the normal-flux continuity condition with no free surface charge, namely the continuity of the generalized normal flux $\\epsilon_c E_n$ across the interface, where $E_n$ is the normal component of the electric field with respect to $\\hat{\\mathbf{n}}$. If the true fields in the two media are $\\mathbf{E}_1 = E_t \\hat{\\mathbf{t}} + E_{n,1} \\hat{\\mathbf{n}}$ and $\\mathbf{E}_2 = E_t \\hat{\\mathbf{t}} + E_{n,2} \\hat{\\mathbf{n}}$, with $\\hat{\\mathbf{t}} = (-\\sin \\theta, \\cos \\theta)$ the unit tangent, the exact continuity yields $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$ while the tangential component $E_t$ is continuous. A discrete Yee edge variable on an edge $e$ crossing both media cannot represent a jump in the normal component; instead, a single edge value implicitly represents the weighted average across the edge: $E_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}$. Define the reference normal flux $D_{n,0} = \\epsilon_{c,1} E_{n,1}$, which equals $\\epsilon_{c,2} E_{n,2}$ by continuity. Under a chosen interpolation strategy that assigns $\\epsilon_{c,\\mathrm{eff}}$ to the edge, the discretized normal flux on edge $e$ is $\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$. The normalized residual on edge $e$ is\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{D_{n,0}} - 1 \\right|,\n$$\nwhere $|\\cdot|$ denotes magnitude of a complex number. Aggregate the enforcement error across all four edges by the root-mean-square value\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }.\n$$\nCompute $R_{\\mathrm{vol}}$ for the volume-weighted strategy and $R_{\\mathrm{edge}}$ for the edge-weighted strategy, using $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$ for all edges in the former and the per-edge $\\epsilon_{c,\\mathrm{edge}}(e)$ in the latter. Use $E_{n,1} = 1$ in $\\mathrm{V}/\\mathrm{m}$ so that $D_{n,0} = \\epsilon_{c,1}$.\n\nDesign a program that, for a given set of parameters $(\\Delta,\\theta,\\epsilon_1,\\sigma_1,\\epsilon_2,\\sigma_2,f)$, computes $R_{\\mathrm{vol}}$ and $R_{\\mathrm{edge}}$ as dimensionless floats. Angles must be provided in radians, permittivities in $\\mathrm{F}/\\mathrm{m}$, conductivities in $\\mathrm{S}/\\mathrm{m}$, frequency in $\\mathrm{Hz}$, and $\\Delta$ in $\\mathrm{m}$.\n\nTest Suite:\nUse the vacuum permittivity $\\epsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F}/\\mathrm{m}$. Let $\\Delta = 1\\,\\mathrm{m}$ in all cases. Evaluate the following four test cases:\n\n1. Oblique, moderate contrast, weak loss: $\\theta = \\pi/4$, $\\epsilon_1 = 2.5 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 6 \\epsilon_0$, $\\sigma_2 = 0.01$, $f = 1\\times 10^{9}$.\n\n2. Interface normal along $x$-axis, lossless: $\\theta = 0$, $\\epsilon_1 = 1 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 4 \\epsilon_0$, $\\sigma_2 = 0$, $f = 5\\times 10^{9}$.\n\n3. Interface normal along $y$-axis, asymmetric loss: $\\theta = \\pi/2$, $\\epsilon_1 = 2 \\epsilon_0$, $\\sigma_1 = 0.1$, $\\epsilon_2 = 10 \\epsilon_0$, $\\sigma_2 = 0$, $f = 1\\times 10^{8}$.\n\n4. Highly oblique ($80^\\circ$), high contrast and loss: $\\theta = 80\\pi/180$, $\\epsilon_1 = 1.5 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 12 \\epsilon_0$, $\\sigma_2 = 0.5$, $f = 2\\times 10^{9}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing a list of four elements, one per test case, where each element is a two-element list $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$ in that order. For example, the printed output must have the form $[[r_{1,\\mathrm{vol}},r_{1,\\mathrm{edge}}],[r_{2,\\mathrm{vol}},r_{2,\\mathrm{edge}}],[r_{3,\\mathrm{vol}},r_{3,\\mathrm{edge}}],[r_{4,\\mathrm{vol}},r_{4,\\mathrm{edge}}]]$, with all values dimensionless floats.",
            "solution": "The problem requires an analysis and comparison of two different material parameter interpolation schemes used in the Finite-Difference Time-Domain (FDTD) method for computational electromagnetics. The comparison is based on a metric that quantifies the violation of the electromagnetic boundary condition for the normal component of the electric field at a planar dielectric interface that cuts through a single Yee cell.\n\n### Fundamental Principle: Boundary Conditions\n\nAt a planar interface between two media with no free surface charge, Maxwell's equations impose continuity conditions on the electric field $\\mathbf{E}$ and the electric displacement field $\\mathbf{D} = \\epsilon \\mathbf{E}$. The component of the electric field tangential to the interface, $E_t$, is continuous. The component of the electric displacement field normal to the interface, $D_n$, is also continuous. For time-harmonic fields with angular frequency $\\omega$, in a lossy medium with permittivity $\\epsilon$ and conductivity $\\sigma$, these properties are conveniently described using the complex permittivity $\\epsilon_c = \\epsilon - i \\sigma/\\omega$. The electric displacement field becomes $\\mathbf{D} = \\epsilon_c \\mathbf{E}$.\n\nThe continuity of the normal component of $\\mathbf{D}$ across the interface between medium $1$ and medium $2$ is expressed as $D_{n,1} = D_{n,2}$, which implies:\n$$\n\\epsilon_{c,1} E_{n,1} = \\epsilon_{c,2} E_{n,2}\n$$\nHere, $E_{n,1}$ and $E_{n,2}$ are the normal components of the electric field on either side of the interface. This relation shows that the normal electric field component $E_n$ is generally discontinuous. The reference value for the normal displacement flux is taken as $D_{n,0} = \\epsilon_{c,1} E_{n,1}$. The problem sets $E_{n,1} = 1\\,\\mathrm{V/m}$, so $D_{n,0} = \\epsilon_{c,1}$.\n\n### Numerical Discretization and Averaging\n\nThe FDTD method discretizes space on a staggered grid (the Yee grid). In a $2$D Transverse-Magnetic (TM) simulation, electric field components ($E_x$, $E_y$) are located at the centers of the cell edges. When an interface cuts through a cell, a single discrete field value on an edge must represent the field behavior in two different media. This necessitates an effective material parameter for the FDTD update equation at that location.\n\nThe problem defines two strategies to determine the effective complex permittivity, $\\epsilon_{c,\\mathrm{eff}}$, for the electric field components on the four edges of a square Yee cell of side length $\\Delta$. The interface passes through the cell center $(0,0)$ and is defined by $\\hat{\\mathbf n} \\cdot \\mathbf r = 0$, where $\\hat{\\mathbf n} = (\\cos\\theta, \\sin\\theta)$.\n\n### Interpolation Strategies\n\n1.  **Volume-weighted average:** A single effective permittivity is computed based on the area fractions of the two media within the cell. Since the interface passes through the center, the areas are equal.\n    $$\n    \\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}\n    $$\n    This value is used for all four edges, regardless of how they are cut by the interface.\n\n2.  **Edge-weighted average:** A separate effective permittivity is computed for each edge, based on the fraction of the edge's length that lies in each medium. For an edge $e$, let $f_e$ be the fraction of its length in medium $2$ (where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$). The effective permittivity for that edge is:\n    $$\n    \\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}\n    $$\n    The fraction $f_e$ is determined by evaluating $s = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}$ at the edge's endpoints, $\\mathbf{r}_1$ and $\\mathbf{r}_2$. Let $s_1 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_1$ and $s_2 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_2$. If the edge is cut, the intersection point divides it into segments. The fraction $f_e$ is the ratio of the length of the segment in medium $2$ to the total edge length. This can be calculated using linear interpolation.\n\n### Error Metric Formulation\n\nA discrete field variable on an edge that crosses the interface cannot represent the discontinuous jump in the normal field component $E_n$. The problem models the effective normal field on the edge as a weighted average:\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}\n$$\nUsing the continuity condition $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$ and setting $E_{n,1}=1$, this becomes:\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}}\n$$\nThe discretized normal flux on the edge is then $D_{n,\\mathrm{discr}}(e) = \\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$. The quality of an interpolation scheme is measured by how well this discretized flux approximates the true, continuous flux $D_{n,0} = \\epsilon_{c,1}$. The normalized residual for an edge $e$ is defined as:\n$$\nr_e = \\left| \\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} - 1 \\right| = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{\\epsilon_{c,1}} - 1 \\right|\n$$\nSubstituting the expression for $E_{n,\\mathrm{edge}}(e)$:\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e)}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\n\nFor the **volume-weighted** scheme, $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$ for all edges, and the residual $r_{e,\\mathrm{vol}}$ is calculated per edge using the corresponding $f_e$.\n\nFor the **edge-weighted** scheme, $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{edge}}(e)$. The term for the residual becomes:\n$$\nr_{e,\\mathrm{edge}} = \\left| \\frac{(1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\nLetting $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$, the expression simplifies:\n$$\n\\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} = \\left( (1 - f_e) + f_e \\eta \\right) \\left( (1 - f_e) + f_e \\frac{1}{\\eta} \\right)\n$$\nExpanding this product gives:\n$$\n(1 - f_e)^2 + f_e(1 - f_e)\\frac{1}{\\eta} + f_e(1 - f_e)\\eta + f_e^2 = 1 - 2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right)\n$$\nThe residual is the magnitude of the difference from $1$:\n$$\nr_{e,\\mathrm{edge}} = \\left| -2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right) \\right| = \\left| f_e(1 - f_e) \\left( -2 + \\eta + \\frac{1}{\\eta} \\right) \\right|\n$$\nThis leads to the more insightful form:\n$$\nr_{e,\\mathrm{edge}} = \\left| f_e(1 - f_e) \\frac{(\\eta - 1)^2}{\\eta} \\right|\n$$\nThis shows that the error for the edge-weighted scheme is zero if the edge is not cut ($f_e=0$ or $f_e=1$) or if there is no material contrast ($\\eta=1$), and is maximized for edges bisected by the interface ($f_e=0.5$).\n\n### Computational Algorithm\n\nThe overall error for each scheme is the root-mean-square (RMS) of the residuals over the four cell edges:\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }\n$$\n\nThe algorithm proceeds as follows for each test case:\n1.  Calculate the angular frequency $\\omega = 2\\pi f$ and the complex permittivities $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$.\n2.  Define the geometry: the normal vector $\\hat{\\mathbf n}$ and the endpoints of the four cell edges.\n3.  For each edge $e$:\n    a. Compute the signed distances $s_1$ and $s_2$ of the endpoints from the interface.\n    b. Calculate the fraction $f_e$ based on the signs and values of $s_1$ and $s_2$.\n    c. Calculate the residual $r_{e,\\mathrm{vol}}$ using $\\epsilon_{c,\\mathrm{vol}} = (\\epsilon_{c,1}+\\epsilon_{c,2})/2$.\n    d. Calculate the residual $r_{e,\\mathrm{edge}}$ using the derived formula based on $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$ and $f_e$.\n4.  Compute the RMS errors $R_{\\mathrm{vol}}$ and $R_{\\mathrm{edge}}$ by taking the square root of the average of the squared residuals.\n5.  Return the pair $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$.\n\nThis procedure is implemented for each of the provided test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the FDTD interface modeling problem for the given test suite.\n    \"\"\"\n    \n    # Physical constant for permittivity of vacuum\n    epsilon_0 = 8.854187817e-12  # F/m\n\n    def compute_errors_for_case(delta, theta, eps1, sig1, eps2, sig2, f):\n        \"\"\"\n        Computes R_vol and R_edge for a single set of parameters.\n        \"\"\"\n        # Step 1: Calculate complex permittivities\n        omega = 2.0 * np.pi * f\n        # Handle potential division by zero if omega is zero, though not in test cases\n        if omega == 0:\n            # In a static case, conductivity term would dominate. This problem assumes time-harmonic fields.\n            # We can assign a very large number for the imaginary part if sigma is non-zero.\n            # However, problem constraints ensure f > 0.\n            pass\n        \n        eps_c1 = eps1 - 1j * sig1 / omega\n        eps_c2 = eps2 - 1j * sig2 / omega\n\n        # Step 2: Define geometry\n        n_hat = np.array([np.cos(theta), np.sin(theta)])\n        half_delta = delta / 2.0\n\n        edges = [\n            (np.array([-half_delta,  half_delta]), np.array([half_delta,  half_delta])),  # Top\n            (np.array([-half_delta, -half_delta]), np.array([half_delta, -half_delta])), # Bottom\n            (np.array([-half_delta, -half_delta]), np.array([-half_delta,  half_delta])), # Left\n            (np.array([ half_delta, -half_delta]), np.array([ half_delta,  half_delta]))   # Right\n        ]\n\n        r_vol_sq_sum = 0.0\n        r_edge_sq_sum = 0.0\n\n        # Step 3: Loop over the four edges\n        for r1, r2 in edges:\n            # 3a. Compute signed distances\n            s1 = np.dot(n_hat, r1)\n            s2 = np.dot(n_hat, r2)\n            \n            # 3b. Calculate f_e\n            # Use small tolerance for floating point comparisons to zero\n            tol = 1e-12 \n            if abs(s1)  tol and abs(s2)  tol:\n                f_e = 0.5\n            elif s1 >= -tol and s2 >= -tol:\n                f_e = 1.0\n            elif s1 = tol and s2 = tol:\n                f_e = 0.0\n            else: # Edge is cut by the interface\n                # Intersection parameter alpha along segment from r1 to r2\n                # is alpha = -s1 / (s2 - s1)\n                if s2 > s1: # s2 > 0, s1  0\n                    f_e = s2 / (s2 - s1)\n                else: # s1 > 0, s2  0\n                    f_e = s1 / (s1 - s2)\n            \n            # 3c-d. Calculate residuals for both schemes\n            ratio_eps = eps_c1 / eps_c2\n            e_n_term = (1.0 - f_e) + f_e * ratio_eps\n\n            # Volume-weighted residual\n            eps_c_vol = 0.5 * (eps_c1 + eps_c2)\n            r_vol = np.abs((eps_c_vol / eps_c1) * e_n_term - 1.0)\n            r_vol_sq_sum += r_vol**2\n\n            # Edge-weighted residual\n            eta = eps_c2 / eps_c1\n            if abs(eta - 1.0)  tol or f_e * (1.0 - f_e) == 0:\n                r_edge = 0.0\n            else:\n                # Use numerically stable and insightful formula\n                r_edge = np.abs(f_e * (1.0 - f_e) * ((eta - 1.0)**2 / eta))\n            \n            r_edge_sq_sum += r_edge**2\n\n        # Step 4: Compute RMS errors\n        R_vol = np.sqrt(r_vol_sq_sum / 4.0)\n        R_edge = np.sqrt(r_edge_sq_sum / 4.0)\n        \n        # Step 5: Return result\n        return [R_vol, R_edge]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, np.pi/4.0, 2.5 * epsilon_0, 0.0, 6.0 * epsilon_0, 0.01, 1.0e9),\n        (1.0, 0.0, 1.0 * epsilon_0, 0.0, 4.0 * epsilon_0, 0.0, 5.0e9),\n        (1.0, np.pi/2.0, 2.0 * epsilon_0, 0.1, 10.0 * epsilon_0, 0.0, 1.0e8),\n        (1.0, 80.0*np.pi/180.0, 1.5 * epsilon_0, 0.0, 12.0 * epsilon_0, 0.5, 2.0e9)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_errors_for_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Convert list of lists to string and remove spaces for compact representation.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "The simplest approach to modeling a curved or slanted boundary is the 'staircase' approximation, but this geometric simplification can lead to significant, non-physical artifacts in the simulation results. This practice  explores the far-reaching consequences of this approximation by analyzing its effect on a key physical observable: the reflection coefficient from a slanted interface. You will not only quantify the error of the naïve staircase model but also derive and implement a powerful conformal correction technique, revealing how a more careful homogenization of boundary conditions can restore first-order accuracy to the simulation.",
            "id": "3331600",
            "problem": "A Transverse Electric (TE) plane wave is normally incident on a planar dielectric interface in free space, but the planar interface is slanted with respect to the Cartesian grid used by a Finite-Difference Time-Domain (FDTD) solver. The slanted interface is approximated on a coarse grid by a staircase of axis-aligned micro-facets. Consider a two-dimensional geometry with the interface lying in the $x$–$y$ plane and the electric field along $z$ (TE$_z$ polarization). Assume non-magnetic media, so that $\\mu_1 = \\mu_2 = \\mu_0$. Use the time-harmonic convention $e^{+j \\omega t}$ so that lossy permittivity is modeled as $\\epsilon_c = \\epsilon' - j \\sigma/\\omega$. Let the interface be between material $1$ with complex permittivity $\\epsilon_{c1}$ and material $2$ with complex permittivity $\\epsilon_{c2}$. The true interface normal $\\hat{\\mathbf{n}}$ makes an angle $\\alpha \\in (0,\\pi/2)$ with the $+\\hat{\\mathbf{x}}$ axis. A coarse staircase approximation replaces the oblique interface by a periodic sequence of axis-aligned micro-facets with outward normals alternately along $+\\hat{\\mathbf{x}}$ and $+\\hat{\\mathbf{y}}$, with relative fractions determined by co-prime integers $(r,s)$ such that $\\tan \\alpha = r/s$. Thus, the fraction of $x$-normal facets is $w_x = s/(r+s)$ and the fraction of $y$-normal facets is $w_y = r/(r+s)$. The incident plane wave is normal to the true interface (i.e., its propagation direction is $\\hat{\\mathbf{n}}$).\n\nStarting only from Maxwell’s equations and the boundary conditions that the tangential components of the electric and magnetic fields are continuous across the interface, and the definition of intrinsic impedance $\\eta_i = \\sqrt{\\mu_i/\\epsilon_{ci}}$, carry out the following steps:\n\n1) Derive the exact TE Fresnel reflection coefficient for normal incidence on a planar interface between two homogeneous, isotropic media. Your derivation must begin from the plane-wave solutions of Maxwell’s equations and the continuity of tangential fields. Express the final exact reflection coefficient $r_{\\mathrm{exact}}$ in terms of the intrinsic impedances $\\eta_1$ and $\\eta_2$ of medium $1$ and medium $2$, respectively.\n\n2) Model the coarse-grid staircasing error by approximating the oblique interface as a homogenized periodic array of axis-aligned facets. For a TE wave at normal incidence with respect to the true interface, the local incidence angle relative to an $x$-normal facet is $\\theta_x = \\alpha$ and relative to a $y$-normal facet is $\\theta_y = \\frac{\\pi}{2} - \\alpha$. Using the TE oblique-incidence Fresnel coefficient derived from the same principles in step $1$ (no shortcut formulas may be introduced without derivation), define the facet reflection coefficients $r_{\\mathrm{TE}}(\\theta_x)$ and $r_{\\mathrm{TE}}(\\theta_y)$ using Snell’s law to express the transmitted angle. Construct a “naïve staircase reflection” model by a coherent area-weighted sum\n$$\nr_{\\mathrm{stair}} = w_x\\, r_{\\mathrm{TE}}(\\theta_x) + w_y\\, r_{\\mathrm{TE}}(\\theta_y),\n$$\nand define the reflection magnitude error\n$$\n\\Delta_{\\mathrm{stair}} = \\left|\\,|r_{\\mathrm{stair}}| - |r_{\\mathrm{exact}}|\\,\\right|.\n$$\nAll angles must be used in radians.\n\n3) Propose a conformal correction that enforces first-order accuracy by homogenizing the boundary condition in terms of tangential admittance rather than reflection coefficients. Specifically, define the TE tangential admittance on a facet in medium $i$ as $Y_{i,\\mathrm{TE}}(\\theta) = \\cos\\theta / \\eta_i$. Then define the averaged admittances\n$$\n\\bar{Y}_1 = w_x \\frac{\\cos\\theta_x}{\\eta_1} + w_y \\frac{\\cos\\theta_y}{\\eta_1}, \\quad\n\\bar{Y}_2 = w_x \\frac{\\cos\\theta_x}{\\eta_2} + w_y \\frac{\\cos\\theta_y}{\\eta_2}.\n$$\nUse the boundary condition on the averaged tangential fields to derive a corrected reflection coefficient\n$$\nr_{\\mathrm{conf}} = \\frac{\\bar{Y}_1 - \\bar{Y}_2}{\\bar{Y}_1 + \\bar{Y}_2},\n$$\nand prove that $r_{\\mathrm{conf}}$ reduces to $r_{\\mathrm{exact}}$ for normal incidence on the true interface, independent of $(r,s)$, thereby achieving first-order accuracy in the facet size. Define the corrected reflection magnitude error as\n$$\n\\Delta_{\\mathrm{conf}} = \\left|\\,|r_{\\mathrm{conf}}| - |r_{\\mathrm{exact}}|\\,\\right|.\n$$\n\nImplementation task: Write a complete, runnable program that computes $\\Delta_{\\mathrm{stair}}$ and $\\Delta_{\\mathrm{conf}}$ for each of the following three test cases. You must use the physical constants $\\epsilon_0 = 8.854187817\\times 10^{-12}\\ \\mathrm{F/m}$ and $\\mu_0 = 4\\pi\\times 10^{-7}\\ \\mathrm{H/m}$. The intrinsic impedances must be computed using $\\eta_i = \\sqrt{\\mu_i/\\epsilon_{ci}}$ with complex permittivity $\\epsilon_{ci} = \\epsilon_i - j \\sigma_i/\\omega$, where $\\omega = 2\\pi f$. For oblique incidence, you must compute the transmitted angle using Snell’s law $n_1 \\sin\\theta_i = n_2 \\sin\\theta_t$ with complex refractive index $n_i = \\sqrt{\\mu_i \\epsilon_{ci}}$. Angles provided in degrees in the test suite must be converted to radians for computation. The final errors $\\Delta_{\\mathrm{stair}}$ and $\\Delta_{\\mathrm{conf}}$ are dimensionless and must be output as decimal floating-point numbers.\n\nTest suite:\n- Case $1$ (happy path, lossless, moderate slope): $\\epsilon_1 = \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 4\\,\\epsilon_0$, $\\sigma_2 = 0$, $f = 3.0\\times 10^{9}\\ \\mathrm{Hz}$, with $r = 1, s = 2$.\n- Case $2$ (lossy medium $2$, symmetric slope): $\\epsilon_1 = \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 4\\,\\epsilon_0$, $\\sigma_2 = 5.0\\times 10^{-2}\\ \\mathrm{S/m}$, $f = 1.0\\times 10^{9}\\ \\mathrm{Hz}$, $\\alpha = 45$ degrees, with $r = 1, s = 1$.\n- Case $3$ (lossless, steep slope, high contrast): $\\epsilon_1 = \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 12\\,\\epsilon_0$, $\\sigma_2 = 0$, $f = 6.0\\times 10^{9}\\ \\mathrm{Hz}$, with $r = 10, s = 1$.\n\nYour program should produce a single line of output containing the six results as a comma-separated list enclosed in square brackets in the order\n$$\n[\\Delta_{\\mathrm{stair}}^{(1)},\\Delta_{\\mathrm{conf}}^{(1)},\\Delta_{\\mathrm{stair}}^{(2)},\\Delta_{\\mathrm{conf}}^{(2)},\\Delta_{\\mathrm{stair}}^{(3)},\\Delta_{\\mathrm{conf}}^{(3)}],\n$$\nwhere the superscript denotes the test case number. All outputs must be decimal floating-point numbers with no units.",
            "solution": "The solution is presented in three parts as requested: derivation of the exact reflection coefficient, analysis of the naïve staircase model, and analysis of the conformal correction model.\n\n### 1. Exact TE Reflection Coefficient ($r_{\\mathrm{exact}}$) for Normal Incidence\n\nWe begin from the time-harmonic Maxwell's equations, with the time-dependence convention $e^{+j \\omega t}$:\n$$ \\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j \\omega \\epsilon_c \\mathbf{E} $$\nwhere $\\mathbf{E}$ is the electric field, $\\mathbf{H}$ is the magnetic field, $\\omega$ is the angular frequency, $\\mu$ is the magnetic permeability, and $\\epsilon_c$ is the complex permittivity given by $\\epsilon_c = \\epsilon' - j\\sigma/\\omega$.\n\nThe problem specifies a plane wave normally incident on the true planar interface. Let us align a local coordinate system $(x', y', z')$ such that the interface lies in the $z' = 0$ plane, and the wave propagates along the $+\\hat{\\mathbf{z}}'$ direction. The incident wave is in medium $1$ ($z'0$) and transmits into medium $2$ ($z'0$). For a Transverse Electric (TE) wave, the electric field is perpendicular to the plane of incidence. Since for normal incidence the plane of incidence is not uniquely defined, we can simply choose the electric field to be polarized along the $\\hat{\\mathbf{x}}'$ direction, $\\mathbf{E} = E_{x'}(z') \\hat{\\mathbf{x}}'$.\n\nIn medium $1$, the total electric field is the sum of the incident and reflected waves:\n$$ \\mathbf{E}_1(z') = \\left( E_i e^{-j k_1 z'} + E_r e^{+j k_1 z'} \\right) \\hat{\\mathbf{x}}' $$\nwhere $E_i$ and $E_r$ are the complex amplitudes of the incident and reflected fields, respectively, and $k_1 = \\omega \\sqrt{\\mu_1 \\epsilon_{c1}}$ is the wave number in medium $1$.\n\nThe corresponding magnetic field $\\mathbf{H}_1$ is found from Faraday's law: $\\mathbf{H}_1 = \\frac{1}{-j\\omega\\mu_1} (\\nabla \\times \\mathbf{E}_1)$.\n$$ \\mathbf{H}_1(z') = \\frac{1}{-j\\omega\\mu_1} \\frac{\\partial E_{x'}}{\\partial z'} \\hat{\\mathbf{y}}' = \\frac{1}{-j\\omega\\mu_1} \\left( (-j k_1) E_i e^{-j k_1 z'} + (j k_1) E_r e^{+j k_1 z'} \\right) \\hat{\\mathbf{y}}' $$\n$$ \\mathbf{H}_1(z') = \\left( \\frac{k_1}{\\omega\\mu_1} E_i e^{-j k_1 z'} - \\frac{k_1}{\\omega\\mu_1} E_r e^{+j k_1 z'} \\right) \\hat{\\mathbf{y}}' $$\nUsing the definition of intrinsic impedance $\\eta_1 = \\sqrt{\\mu_1/\\epsilon_{c1}} = \\omega\\mu_1/k_1$, we get:\n$$ \\mathbf{H}_1(z') = \\frac{1}{\\eta_1} \\left( E_i e^{-j k_1 z'} - E_r e^{+j k_1 z'} \\right) \\hat{\\mathbf{y}}' $$\n\nIn medium $2$, there is only a transmitted wave propagating in the $+\\hat{\\mathbf{z}}'$ direction:\n$$ \\mathbf{E}_2(z') = E_t e^{-j k_2 z'} \\hat{\\mathbf{x}}' $$\n$$ \\mathbf{H}_2(z') = \\frac{1}{\\eta_2} E_t e^{-j k_2 z'} \\hat{\\mathbf{y}}' $$\nwhere $E_t, k_2, \\eta_2$ are the amplitude, wave number, and impedance in medium $2$.\n\nThe boundary conditions at the interface $z'=0$ require the tangential components of $\\mathbf{E}$ and $\\mathbf{H}$ to be continuous. Here, $E_{x'}$ and $H_{y'}$ are tangential.\n1.  $E_{x'1}(0) = E_{x'2}(0) \\implies E_i + E_r = E_t$\n2.  $H_{y'1}(0) = H_{y'2}(0) \\implies \\frac{1}{\\eta_1}(E_i - E_r) = \\frac{1}{\\eta_2}E_t$\n\nSubstituting the first equation into the second:\n$$ \\frac{1}{\\eta_1}(E_i - E_r) = \\frac{1}{\\eta_2}(E_i + E_r) $$\n$$ E_i \\left( \\frac{1}{\\eta_1} - \\frac{1}{\\eta_2} \\right) = E_r \\left( \\frac{1}{\\eta_1} + \\frac{1}{\\eta_2} \\right) $$\nThe reflection coefficient $r_{\\mathrm{exact}} = E_r / E_i$ is therefore:\n$$ r_{\\mathrm{exact}} = \\frac{1/\\eta_1 - 1/\\eta_2}{1/\\eta_1 + 1/\\eta_2} = \\frac{\\eta_2 - \\eta_1}{\\eta_2 + \\eta_1} $$\nThis is the exact Fresnel reflection coefficient for normal incidence, valid for the specified geometry where the incident wave is normal to the true interface.\n\n### 2. Naïve Staircase Reflection Model ($r_{\\mathrm{stair}}$)\n\nThis model approximates the reflection from the slanted interface by coherently summing the reflections from its constituent axis-aligned micro-facets. This requires the TE reflection coefficient for oblique incidence, $r_{\\mathrm{TE}}(\\theta_i)$.\n\nLet us derive $r_{\\mathrm{TE}}(\\theta_i)$ for an interface at $z=0$, with incident angle $\\theta_i$ in the $x-z$ plane. The TE electric field is polarized along $\\hat{\\mathbf{y}}$.\nThe total electric fields in medium $1$ ($z0$) and medium $2$ ($z0$) are:\n$$ \\mathbf{E}_1 = \\left( E_i e^{-j(k_{1x}x + k_{1z}z)} + E_r e^{-j(k_{1x}x - k_{1z}z)} \\right) \\hat{\\mathbf{y}} $$\n$$ \\mathbf{E}_2 = E_t e^{-j(k_{2x}x + k_{2z}z)} \\hat{\\mathbf{y}} $$\nwhere $k_{1x} = k_1 \\sin\\theta_i$, $k_{1z} = k_1 \\cos\\theta_i$, $k_{2x} = k_2 \\sin\\theta_t$, and $k_{2z} = k_2 \\cos\\theta_t$.\n\nThe tangential magnetic field component, $H_x$, is found from $\\mathbf{H} = \\frac{j}{\\omega\\mu} \\nabla \\times \\mathbf{E}$:\n$$ H_{x1} = \\frac{\\cos\\theta_i}{\\eta_1} \\left( E_i e^{-j(k_{1x}x + k_{1z}z)} - E_r e^{-j(k_{1x}x - k_{1z}z)} \\right) $$\n$$ H_{x2} = \\frac{\\cos\\theta_t}{\\eta_2} E_t e^{-j(k_{2x}x + k_{2z}z)} $$\nContinuity of tangential $E_y$ and $H_x$ at $z=0$ requires phase-matching, $k_{1x}=k_{2x}$, which gives Snell's Law: $k_1 \\sin\\theta_i = k_2 \\sin\\theta_t$. With non-magnetic media, this is also $n_1 \\sin\\theta_i = n_2 \\sin\\theta_t$, where $n_i = c_0 \\sqrt{\\mu_0 \\epsilon_{ci}}$ is the complex refractive index. The boundary conditions on the amplitudes at $z=0$ are:\n1.  $E_i + E_r = E_t$\n2.  $\\frac{\\cos\\theta_i}{\\eta_1}(E_i - E_r) = \\frac{\\cos\\theta_t}{\\eta_2} E_t$\n\nSubstituting $E_t$ from (1) into (2) and solving for $r_{\\mathrm{TE}}(\\theta_i) = E_r/E_i$ yields:\n$$ r_{\\mathrm{TE}}(\\theta_i) = \\frac{\\eta_2 \\cos\\theta_i - \\eta_1 \\cos\\theta_t}{\\eta_2 \\cos\\theta_i + \\eta_1 \\cos\\theta_t} $$\nwhere $\\theta_t$ is the transmitted angle found from Snell's law, $\\sin\\theta_t = (n_1/n_2)\\sin\\theta_i$, and $\\cos\\theta_t = \\sqrt{1 - \\sin^2\\theta_t}$. The branch of the square root is chosen such that $\\text{Re}(\\cos\\theta_t) \\ge 0$.\n\nThe staircase model uses this formula for the two facet types. The local incidence angle on an $x$-normal facet is $\\theta_x = \\alpha$, and on a $y$-normal facet is $\\theta_y = \\pi/2 - \\alpha$. The weighted sum is then:\n$$ r_{\\mathrm{stair}} = w_x r_{\\mathrm{TE}}(\\theta_x) + w_y r_{\\mathrm{TE}}(\\theta_y) $$\nwhere $w_x = s/(r+s)$ and $w_y = r/(r+s)$. The associated error magnitude is:\n$$ \\Delta_{\\mathrm{stair}} = \\left|\\,|r_{\\mathrm{stair}}| - |r_{\\mathrm{exact}}|\\,\\right| $$\n\n### 3. Conformal Reflection Model ($r_{\\mathrm{conf}}$)\n\nThis model uses a homogenization of boundary conditions based on tangential admittances. The TE tangential admittance on a facet in medium $i$ is $Y_{i,\\mathrm{TE}}(\\theta) = \\cos\\theta / \\eta_i$. The model defines averaged admittances for the incident and transmitted regions as:\n$$ \\bar{Y}_1 = w_x \\frac{\\cos\\theta_x}{\\eta_1} + w_y \\frac{\\cos\\theta_y}{\\eta_1} = \\frac{1}{\\eta_1} (w_x \\cos\\theta_x + w_y \\cos\\theta_y) $$\n$$ \\bar{Y}_2 = w_x \\frac{\\cos\\theta_x}{\\eta_2} + w_y \\frac{\\cos\\theta_y}{\\eta_2} = \\frac{1}{\\eta_2} (w_x \\cos\\theta_x + w_y \\cos\\theta_y) $$\nThe corrected reflection coefficient is defined as if it were for a normal-incidence reflection between two effective media with characteristic admittances $\\bar{Y}_1$ and $\\bar{Y}_2$:\n$$ r_{\\mathrm{conf}} = \\frac{\\bar{Y}_1 - \\bar{Y}_2}{\\bar{Y}_1 + \\bar{Y}_2} $$\nWe are asked to prove that this reduces to $r_{\\mathrm{exact}}$. Substituting the expressions for $\\bar{Y}_1$ and $\\bar{Y}_2$:\n$$ r_{\\mathrm{conf}} = \\frac{\\frac{1}{\\eta_1} (w_x \\cos\\theta_x + w_y \\cos\\theta_y) - \\frac{1}{\\eta_2} (w_x \\cos\\theta_x + w_y \\cos\\theta_y)}{\\frac{1}{\\eta_1} (w_x \\cos\\theta_x + w_y \\cos\\theta_y) + \\frac{1}{\\eta_2} (w_x \\cos\\theta_x + w_y \\cos\\theta_y)} $$\nThe term $(w_x \\cos\\theta_x + w_y \\cos\\theta_y)$ is a common factor in the numerator and denominator. Since $\\alpha \\in (0, \\pi/2)$, $\\theta_x = \\alpha$ and $\\theta_y = \\pi/2-\\alpha$ are in $(0, \\pi/2)$, so their cosines are positive. The weights $w_x, w_y$ are also positive. Thus, the common factor is non-zero and can be cancelled:\n$$ r_{\\mathrm{conf}} = \\frac{1/\\eta_1 - 1/\\eta_2}{1/\\eta_1 + 1/\\eta_2} = \\frac{\\eta_2 - \\eta_1}{\\eta_2 + \\eta_1} $$\nThis is identical to the expression for $r_{\\mathrm{exact}}$.\n$$ r_{\\mathrm{conf}} = r_{\\mathrm{exact}} $$\nThis proof demonstrates that this specific conformal model, under its stated assumptions, analytically reproduces the exact reflection coefficient for normal incidence on the true interface, independent of the staircase granulation parameters $(r,s)$. Consequently, the corrected reflection magnitude error must be zero:\n$$ \\Delta_{\\mathrm{conf}} = \\left|\\,|r_{\\mathrm{conf}}| - |r_{\\mathrm{exact}}|\\,\\right| = \\left|\\,|r_{\\mathrm{exact}}| - |r_{\\mathrm{exact}}|\\,\\right| = 0 $$\nThis indicates that the model provides a \"zeroth-order\" error, which is an even stronger condition than the \"first-order accuracy\" mentioned in the problem, a common term of art for such methods which generally reduce, but do not necessarily eliminate, gridding errors.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the electromagnetics problem for staircasing errors in FDTD.\n    Computes the error for a naive staircase model and a conformal model\n    for three distinct test cases.\n    \"\"\"\n    \n    # Physical constants\n    EPS_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n    MU_0 = 4 * np.pi * 1e-7   # Vacuum permeability in H/m\n    C_0 = 1 / np.sqrt(EPS_0 * MU_0) # Speed of light in vacuum\n\n    # Test cases defined in the problem statement\n    # Each tuple contains: (eps_r1, sig1, eps_r2, sig2, f, r, s, alpha_deg)\n    test_cases = [\n        (1.0, 0.0, 4.0, 0.0, 3.0e9, 1, 2, None),\n        (1.0, 0.0, 4.0, 5.0e-2, 1.0e9, 1, 1, 45.0),\n        (1.0, 0.0, 12.0, 0.0, 6.0e9, 10, 1, None),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        eps_r1, sig1, eps_r2, sig2, f, r, s, alpha_deg = case\n        \n        # --- Parameter Calculations ---\n        \n        # Angular frequency\n        omega = 2 * np.pi * f\n        \n        # Absolute and complex permittivities\n        eps1 = eps_r1 * EPS_0\n        eps2 = eps_r2 * EPS_0\n        eps_c1 = eps1 - 1j * sig1 / omega\n        eps_c2 = eps2 - 1j * sig2 / omega\n        \n        # Complex intrinsic impedances (non-magnetic media, mu = mu_0)\n        eta1 = np.sqrt(MU_0 / eps_c1)\n        eta2 = np.sqrt(MU_0 / eps_c2)\n        \n        # Complex refractive indices\n        n1 = C_0 * np.sqrt(MU_0 * eps_c1)\n        n2 = C_0 * np.sqrt(MU_0 * eps_c2)\n        \n        # Interface geometry from r and s\n        if alpha_deg is not None:\n            alpha = np.deg2rad(alpha_deg)\n        else:\n            alpha = np.arctan(r / s)\n\n        w_x = s / (r + s)\n        w_y = r / (r + s)\n        \n        # --- 1. Exact Reflection Coefficient ---\n        r_exact = (eta2 - eta1) / (eta2 + eta1)\n        \n        # --- 2. Naïve Staircase Model ---\n        \n        # Incidence angles on micro-facets\n        theta_x = alpha\n        theta_y = np.pi/2 - alpha\n        \n        # TE reflection coefficient function\n        def get_r_TE(theta_i, n1, n2, eta1, eta2):\n            # Snell's Law to find transmitted angle sine\n            sin_theta_t = (n1 / n2) * np.sin(theta_i)\n            # Transmitted angle cosine, ensuring Re(cos) >= 0\n            cos_theta_t = np.sqrt(1 - sin_theta_t**2)\n            \n            # Fresnel TE reflection coefficient\n            num = eta2 * np.cos(theta_i) - eta1 * cos_theta_t\n            den = eta2 * np.cos(theta_i) + eta1 * cos_theta_t\n            return num / den\n\n        # Calculate reflection from each facet type\n        r_TE_x = get_r_TE(theta_x, n1, n2, eta1, eta2)\n        r_TE_y = get_r_TE(theta_y, n1, n2, eta1, eta2)\n        \n        # Coherent weighted sum for staircase reflection\n        r_stair = w_x * r_TE_x + w_y * r_TE_y\n        \n        # Error for staircase model\n        delta_stair = np.abs(np.abs(r_stair) - np.abs(r_exact))\n        \n        # --- 3. Conformal Model ---\n        \n        # As proven in the solution, r_conf is analytically identical to r_exact\n        r_conf = r_exact\n        \n        # Error for conformal model (should be zero)\n        delta_conf = np.abs(np.abs(r_conf) - np.abs(r_exact))\n        \n        results.extend([delta_stair, delta_conf])\n        \n    # Format and print the final output as a single line\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}