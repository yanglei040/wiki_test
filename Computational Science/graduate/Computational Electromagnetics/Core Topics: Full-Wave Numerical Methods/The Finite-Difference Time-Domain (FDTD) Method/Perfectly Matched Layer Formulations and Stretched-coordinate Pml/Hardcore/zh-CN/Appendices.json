{
    "hands_on_practices": [
        {
            "introduction": "理论联系实践的第一步是量化完美匹配层（PML）的核心功能：波吸收。本练习将引导您从麦克斯韦方程组和复坐标伸缩理论出发，推导并计算波在穿过离散的PML单元时所经历的衰减。通过为给定的电导率剖面计算每个单元的衰减系数 ，您将深入理解连续的坐标伸缩概念如何转化为具体的离散化实现，这是设计高效PML吸收边界的基础。",
            "id": "3339137",
            "problem": "考虑在自由空间中由拉伸坐标完美匹配层 (Stretched-Coordinate Perfectly Matched Layer, SC-PML) 实现的一维吸收边界。一个法向入射的平面波沿 $x$ 轴传播，进入占据 $0 \\le x \\le L$ 的 SC-PML 区域。沿 $x$ 方向的坐标拉伸由 $s_x(x)$ 定义，其中 $\\kappa_x=1$ 且无低频阻尼参数，因此唯一可变的剖面是电导率 $\\sigma(x)$。要实现的 SC-PML 剖面被渐变设置为 $\\sigma(x) = \\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$，其中 $x \\in [0,L]$ 且阶数 $m \\ge 0$ 为整数。自由空间参数为 $\\mu_0$ 和 $\\varepsilon_0$。\n\n从频域中的麦克斯韦方程和 SC-PML 复坐标拉伸出发，推导一个法向入射的均匀平面波在穿过 SC-PML 内厚度为 $\\Delta x$ 的单个离散单元时所经历的衰减因子幅值的表达式。然后，使用该表达式，在一个由 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元组成的离散方案中实现该渐变剖面，其中第 $i$ 个单元的范围是 $\\left[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}\\right] = \\left[\\left(i-1\\right)\\Delta x, i\\,\\Delta x\\right]$，$i=1,2,\\dots,N$。您的程序必须为每个单元计算波幅在穿过该单元时所经历的衰减因子幅值（一个介于 0 和 1 之间的无量纲数），并以浮点数形式表示。假设在所有地方都是法向入射和自由空间。\n\n在您的推导中必须使用的基本依据：\n- 无源、线性、均匀介质中频域的麦克斯韦方程，以及 SC-PML 复坐标拉伸的定义。\n- 均匀介质中的平面波解及其在复坐标拉伸下的修正。\n\n要使用和报告的物理常数和单位：\n- 使用 $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ 和 $\\varepsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F/m}$。\n- 频率 $f$ 的单位是 $\\mathrm{Hz}$；角频率为 $\\omega = 2\\pi f$。\n- 长度 $L$ 和 $\\Delta x$ 的单位是 $\\mathrm{m}$。\n- 电导率 $\\sigma_{\\max}$ 的单位是 $\\mathrm{S/m}$。\n- 衰减因子幅值是无单位的浮点数。\n\n实现离散渐变剖面 $\\sigma(x)=\\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$，并为以下测试套件计算每个单元的衰减因子幅值。对于每个测试用例，计算一个长度为 $N$ 的列表，其中按顺序列出单元 $i=1,2,\\dots,N$ 的衰减因子幅值。\n\n测试套件参数集 $(f, L, N, \\sigma_{\\max}, m)$:\n1. $(f = 2\\times 10^9, L = 2.0\\times 10^{-2}, N = 8, \\sigma_{\\max} = 9.781, m = 3)$\n2. $(f = 1.0\\times 10^9, L = 5.0\\times 10^{-3}, N = 1, \\sigma_{\\max} = 100.0, m = 1)$\n3. $(f = 5.0\\times 10^9, L = 1.0\\times 10^{-2}, N = 5, \\sigma_{\\max} = 50.0, m = 2)$\n4. $(f = 5.0\\times 10^8, L = 1.0\\times 10^{-2}, N = 5, \\sigma_{\\max} = 50.0, m = 2)$\n5. $(f = 3.0\\times 10^9, L = 1.0\\times 10^{-2}, N = 4, \\sigma_{\\max} = 25.0, m = 0)$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素本身都是一个对应于一个测试用例的浮点数列表，例如，类似 $[[a_{1},a_{2},\\dots,a_{N_1}],[b_{1},\\dots],[\\dots]]$ 的形式，不需要空格。最终输出必须是仅包含此方括号表示法的单行内容。角度单位不适用。任何地方都不要使用百分比；所有报告的量都是浮点数或浮点数列表。",
            "solution": "该问题要求推导并实现一个平面波在穿过拉伸坐标完美匹配层 (SC-PML) 内的离散单元时的衰减因子。推导始于无源、线性和均匀介质中的频域麦克斯韦方程，假设时间谐波形式为 $e^{j\\omega t}$：\n$$ \\nabla \\times \\vec{E} = -j\\omega\\mu_0 \\vec{H} $$\n$$ \\nabla \\times \\vec{H} = j\\omega\\varepsilon_0 \\vec{E} $$\n\n对于一个极化为 $\\vec{E} = E_y(x)\\hat{y}$ 和 $\\vec{H} = H_z(x)\\hat{z}$ 并沿 $x$ 轴传播的平面波，这些方程简化为：\n$$ \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 H_z $$\n$$ \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 E_y $$\n\nSC-PML 是通过在传播方向上引入复坐标拉伸来实现的。在频域中，算子 $\\frac{\\partial}{\\partial x}$ 被替换为 $\\frac{1}{s_x(x)}\\frac{\\partial}{\\partial x}$。根据问题陈述，拉伸因子 $s_x(x)$ 定义为：\n$$ s_x(x) = \\kappa_x + \\frac{\\sigma(x)}{j\\omega\\varepsilon_0} $$\n利用给定的参数 $\\kappa_x=1$ 和电导率剖面 $\\sigma(x)$，这变为：\n$$ s_x(x) = 1 + \\frac{\\sigma(x)}{j\\omega\\varepsilon_0} $$\n\n将此变换应用于麦克斯韦方程，得到 PML 内的修正方程：\n$$ \\frac{1}{s_x(x)} \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 H_z \\implies \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 s_x(x) H_z $$\n$$ \\frac{1}{s_x(x)} \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 E_y \\implies \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 s_x(x) E_y $$\n这些方程等效于波在具有有效介电常数 $\\varepsilon_{\\text{eff}}(x) = \\varepsilon_0 s_x(x)$ 和有效磁导率 $\\mu_{\\text{eff}}(x) = \\mu_0 s_x(x)$ 的介质中的传播。局部波阻抗为 $Z(x) = \\sqrt{\\frac{\\mu_{\\text{eff}}(x)}{\\varepsilon_{\\text{eff}}(x)}} = \\sqrt{\\frac{\\mu_0 s_x(x)}{\\varepsilon_0 s_x(x)}} = \\sqrt{\\frac{\\mu_0}{\\varepsilon_0}} = \\eta_0$，即自由空间的本征阻抗。对于 $\\sigma(0)=0$ 的连续剖面，这种阻抗匹配确保了在 PML 界面处没有反射。\n\nPML 介质中的局部波数由下式给出：\n$$ k_{\\text{pml}}(x) = \\omega \\sqrt{\\mu_{\\text{eff}}(x) \\varepsilon_{\\text{eff}}(x)} = \\omega \\sqrt{(\\mu_0 s_x(x))(\\varepsilon_0 s_x(x))} = \\omega\\sqrt{\\mu_0\\varepsilon_0} s_x(x) = k_0 s_x(x) $$\n其中 $k_0 = \\omega\\sqrt{\\mu_0\\varepsilon_0}$ 是自由空间波数。\n\n一个从 $x_1$ 传播到 $x_2$ 的平面波累积的相位因子由 $\\exp\\left(-j \\int_{x_1}^{x_2} k_{\\text{pml}}(x') dx'\\right)$ 给出。指数的宗量为：\n$$ -j \\int_{x_1}^{x_2} k_0 s_x(x') dx' = -j \\int_{x_1}^{x_2} k_0 \\left(1 + \\frac{\\sigma(x')}{j\\omega\\varepsilon_0}\\right) dx' $$\n$$ = -j k_0 \\int_{x_1}^{x_2} dx' - \\frac{k_0}{\\omega\\varepsilon_0} \\int_{x_1}^{x_2} \\sigma(x') dx' $$\n第一项 $-j k_0 (x_2-x_1)$ 是纯虚数，代表相位旋转。第二项是纯实数，代表衰减。传播因子的幅值由这个实数项决定。让我们计算常数因子：\n$$ \\frac{k_0}{\\omega\\varepsilon_0} = \\frac{\\omega\\sqrt{\\mu_0\\varepsilon_0}}{\\omega\\varepsilon_0} = \\sqrt{\\frac{\\mu_0}{\\varepsilon_0}} = \\eta_0 $$\n因此，波穿过从 $x_1$ 到 $x_2$ 区域的衰减因子幅值 $A$ 为：\n$$ A = \\exp\\left(-\\eta_0 \\int_{x_1}^{x_2} \\sigma(x') dx'\\right) $$\n值得注意的是，这个表达式与波的频率 $f$ 无关。\n\n问题要求计算每个离散单元 $i$ 的这个因子，其范围是区间 $[(i-1)\\Delta x, i\\Delta x]$，其中 $\\Delta x = L/N$。单元 $i$ 的衰减因子，记为 $A_i$，为：\n$$ A_i = \\exp\\left(-\\eta_0 \\int_{(i-1)\\Delta x}^{i\\Delta x} \\sigma(x') dx'\\right) $$\n电导率剖面由 $\\sigma(x) = \\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$ 给出。我们现在必须计算第 $i$ 个单元的积分。\n$$ \\int_{(i-1)\\Delta x}^{i\\Delta x} \\sigma_{\\max}\\left(\\frac{x'}{L}\\right)^m dx' = \\frac{\\sigma_{\\max}}{L^m} \\int_{(i-1)\\Delta x}^{i\\Delta x} (x')^m dx' $$\n对于 $m \\ge 0$，积分为：\n$$ \\frac{\\sigma_{\\max}}{L^m} \\left[\\frac{(x')^{m+1}}{m+1}\\right]_{(i-1)\\Delta x}^{i\\Delta x} = \\frac{\\sigma_{\\max}}{L^m(m+1)} \\left[ (i\\Delta x)^{m+1} - ((i-1)\\Delta x)^{m+1} \\right] $$\n代入 $\\Delta x = L/N$，我们得到：\n$$ \\frac{\\sigma_{\\max}}{L^m(m+1)} \\frac{L^{m+1}}{N^{m+1}} \\left[ i^{m+1} - (i-1)^{m+1} \\right] = \\frac{\\sigma_{\\max} L}{(m+1)N^{m+1}} \\left[ i^{m+1} - (i-1)^{m+1} \\right] $$\n该表达式代表在单元 $i$ 上的电导率积分。我们称这个积分为 $I_i$。\n单元 $i$ 的衰减因子幅值的最终表达式为：\n$$ A_i = \\exp\\left(-\\eta_0 I_i\\right) = \\exp\\left(-\\eta_0 \\frac{\\sigma_{\\max} L}{(m+1)N^{m+1}} \\left( i^{m+1} - (i-1)^{m+1} \\right)\\right) $$\n这就是要为每个单元 $i=1, 2, \\dots, N$ 实现的公式。对于 $m=0$ 的特殊情况，剖面是常数 $\\sigma(x) = \\sigma_{\\max}$，积分简化为 $I_i = \\sigma_{\\max}\\Delta x = \\sigma_{\\max}L/N$。我们的通用公式在 $m=0$ 时得出：$I_i = \\frac{\\sigma_{\\max}L}{(1)N^1}(i^1 - (i-1)^1) = \\frac{\\sigma_{\\max}L}{N}$，这是一致的。\n实现将为每个测试用例中的每个单元计算这个值 $A_i$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the per-cell attenuation factor magnitude for a plane wave in an SC-PML.\n    \"\"\"\n    # Define physical constants\n    MU_0 = 4 * np.pi * 1e-7  # Permeability of free space (H/m)\n    EPSILON_0 = 8.854187817e-12  # Permittivity of free space (F/m)\n    ETA_0 = np.sqrt(MU_0 / EPSILON_0)  # Intrinsic impedance of free space (Ohms)\n\n    # Test suite parameter sets: (f, L, N, sigma_max, m)\n    test_cases = [\n        (2e9, 2.0e-2, 8, 9.781, 3),\n        (1.0e9, 5.0e-3, 1, 100.0, 1),\n        (5.0e9, 1.0e-2, 5, 50.0, 2),\n        (5.0e8, 1.0e-2, 5, 50.0, 2),\n        (3.0e9, 1.0e-2, 4, 25.0, 0),\n    ]\n\n    all_results = []\n    \n    for _, L, N, sigma_max, m in test_cases:\n        case_results = []\n        m_plus_1 = m + 1\n        \n        # Pre-compute the constant factor for the conductivity integral.\n        # The integral over cell i is: factor * (i^(m+1) - (i-1)^(m+1))\n        # Note: per the problem, m = 0, so m+1 is always = 1.\n        integral_const_factor = (sigma_max * L) / (m_plus_1 * (N ** m_plus_1))\n\n        for i in range(1, N + 1):\n            # Calculate the integrated conductivity over the i-th cell\n            integral_sigma = integral_const_factor * (i**m_plus_1 - (i - 1)**m_plus_1)\n            \n            # Calculate the attenuation factor magnitude\n            # A_i = exp(-eta_0 * integral_sigma)\n            attenuation_factor = np.exp(-ETA_0 * integral_sigma)\n            case_results.append(attenuation_factor)\n            \n        all_results.append(case_results)\n\n    # Format the output string to be a dense list of lists of floats.\n    # e.g., [[0.1,0.2],[0.3,0.4]]\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "一个理想的数值PML不仅应有效吸收能量，还应以最小的失真传播波。本练习将深入探讨在PML区域内，由FDTD Yee网格离散化所引入的数值色散效应。通过推导和分析由离散化引起的相速度和群速度误差 ，您将洞察模拟的准确性，并理解在PML设计中离散化所带来的内在权衡。",
            "id": "3339168",
            "problem": "使用拉伸坐标系公式对一个无限、均匀的完美匹配层（PML）区域进行建模，其中坐标拉伸因子为常数和实数，记为 $s_x$、$s_y$ 和 $s_z$，且满足 $s_x  0$、$s_y  0$ 和 $s_z  0$。背景材料为真空，其介电常数为 $\\epsilon_0$，磁导率为 $\\mu_0$，光速为 $c = 1/\\sqrt{\\mu_0 \\epsilon_0}$。三维时域有限差分（FDTD）离散化采用标准 Yee 格式，在均匀的笛卡尔网格上进行，网格间距为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$，时间步长为 $\\Delta t$。在 Maxwell 旋度方程中，通过根据规则 $\\partial/\\partial x \\mapsto (1/s_x)\\,\\partial/\\partial x$、$\\partial/\\partial y \\mapsto (1/s_y)\\,\\partial/\\partial y$ 和 $\\partial/\\partial z \\mapsto (1/s_z)\\,\\partial/\\partial z$ 替换空间导数来实现拉伸坐标 PML（SC-PML），同时保持 $\\epsilon_0$ 和 $\\mu_0$ 不变。\n\n从 Maxwell 旋度方程和 Yee 离散化出发，推导在该均匀 SC-PML 区域中，对于形式为 $\\exp\\!\\big(i (k_x x + k_y y + k_z z - \\omega t)\\big)$ 的场（其中 $k_x$、$k_y$、$k_z$ 和 $\\omega$ 为常数）成立的离散平面波色散关系。然后，将问题具体化到 $x$–$y$ 平面内的二维斜入射情况，采用 z 方向横电（TE$_z$）极化，其中 $s_z = 1$，$\\Delta x = \\Delta y = \\Delta$，且 Courant 数为 $S = c\\,\\Delta t/\\Delta$，满足 $0  S  1/\\sqrt{2}$。在这个二维特例中，设波矢为 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$，其中角度 $\\theta \\in (0,\\pi/2)$ 和大小 $k > 0$ 为固定值。\n\n使用在 $k \\Delta \\ll 1$ 时有效的长波长展开，计算在固定 $(k,\\theta)$ 下，由 SC-PML 内部的 Yee 离散化引入的领先阶相对相速度误差和领先阶相对群速度误差：\n- 相对相速度误差是 $(\\omega_{\\mathrm{d}}/\\omega) - 1$ 的领先非平凡阶，其中 $\\omega_{\\mathrm{d}}$ 是 FDTD 色散关系预测的离散角频率，$\\omega$ 是对于相同 $(k_x,k_y)$ 的精确连续 SC-PML 角频率。\n- 相对群速度误差是 $(v_{g,\\mathrm{d}}/v_g) - 1$ 的领先非平凡阶，其中 $v_{g,\\mathrm{d}} = \\partial \\omega_{\\mathrm{d}}/\\partial k$（在固定 $\\theta$ 下）和 $v_g = \\partial \\omega/\\partial k$（在固定 $\\theta$ 下）。\n\n将您的最终答案表示为关于 $k$、$\\Delta$、$S$、$s_x$、$s_y$ 和 $\\theta$ 的封闭形式解析表达式。以二元行矩阵的形式提供这两个误差，顺序为 $\\big[(\\omega_{\\mathrm{d}}/\\omega) - 1,\\; (v_{g,\\mathrm{d}}/v_g) - 1\\big]$。不需要进行数值计算。最终答案必须是精确的符号表达式。",
            "solution": "问题要求推导在二维 TE$_z$ 系统中，使用时域有限差分（FDTD）方法和拉伸坐标完美匹配层（SC-PML）离散化后，平面波的领先阶相对相速度和群速度误差。拉伸因子 $s_x$ 和 $s_y$ 是实常数。\n\n出发点是在无源、非导电介质中的 Maxwell 旋度方程：\n$$ \\nabla \\times \\mathbf{E} = -\\mu_0 \\frac{\\partial \\mathbf{H}}{\\partial t} $$\n$$ \\nabla \\times \\mathbf{H} = \\epsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t} $$\n\n在拉伸坐标公式中，空间导数被缩放：对于 $u \\in \\{x,y,z\\}$，有 $\\frac{\\partial}{\\partial u} \\to \\frac{1}{s_u} \\frac{\\partial}{\\partial u}$。这导致修正的旋度算子为 $\\nabla_s = \\left(\\hat{x}\\frac{1}{s_x}\\frac{\\partial}{\\partial x}, \\hat{y}\\frac{1}{s_y}\\frac{\\partial}{\\partial y}, \\hat{z}\\frac{1}{s_z}\\frac{\\partial}{\\partial z}\\right)$。\n\n对于在 $x$-$y$ 平面传播的 TE$_z$ 波，场分量为 $E_z$、$H_x$ 和 $H_y$，并且沿 $z$ 方向没有变化（即 $\\partial/\\partial z = 0$）。问题指定 $s_z=1$，这是一致的。相关方程变为：\n$$ \\frac{1}{s_y}\\frac{\\partial E_z}{\\partial y} = -\\mu_0 \\frac{\\partial H_x}{\\partial t} $$\n$$ -\\frac{1}{s_x}\\frac{\\partial E_z}{\\partial x} = -\\mu_0 \\frac{\\partial H_y}{\\partial t} $$\n$$ \\frac{1}{s_x}\\frac{\\partial H_y}{\\partial x} - \\frac{1}{s_y}\\frac{\\partial H_x}{\\partial y} = \\epsilon_0 \\frac{\\partial E_z}{\\partial t} $$\n\n首先，我们将形式为 $F = F_0 \\exp(i(k_x x + k_y y - \\omega t))$ 的平面波解代入这些方程，以推导精确的连续色散关系。算子变换为 $\\partial/\\partial x \\to i k_x$、$\\partial/\\partial y \\to i k_y$ 和 $\\partial/\\partial t \\to -i \\omega$。\n$$ \\frac{i k_y}{s_y} E_z = i \\omega \\mu_0 H_x $$\n$$ -\\frac{i k_x}{s_x} E_z = i \\omega \\mu_0 H_y $$\n$$ \\frac{i k_x}{s_x} H_y - \\frac{i k_y}{s_y} H_x = -i \\omega \\epsilon_0 E_z $$\n从前两个方程解出 $H_x$ 和 $H_y$ 并代入第三个方程，得到：\n$$ \\frac{k_x}{s_x} \\left( -\\frac{k_x}{\\omega \\mu_0 s_x} E_z \\right) - \\frac{k_y}{s_y} \\left( \\frac{k_y}{\\omega \\mu_0 s_y} E_z \\right) = -\\omega \\epsilon_0 E_z $$\n$$ -\\frac{1}{\\omega \\mu_0} \\left( \\frac{k_x^2}{s_x^2} + \\frac{k_y^2}{s_y^2} \\right) = -\\omega \\epsilon_0 $$\n使用 $c = 1/\\sqrt{\\mu_0 \\epsilon_0}$，精确的连续色散关系为：\n$$ \\frac{\\omega^2}{c^2} = \\frac{k_x^2}{s_x^2} + \\frac{k_y^2}{s_y^2} $$\n\n接下来，我们从网格间距为 $\\Delta x = \\Delta y = \\Delta$、时间步长为 $\\Delta t$ 的 Yee 离散化 FDTD 方程推导离散色散关系。在 Yee 格式中，使用中心有限差分算子。对于平面波，这些算子变换如下：\n$$ \\delta_t F \\to \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega_d \\Delta t}{2}\\right) F $$\n$$ \\delta_x F \\to \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_x \\Delta}{2}\\right) F $$\n$$ \\delta_y F \\to \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_y \\Delta}{2}\\right) F $$\n将这些应用于离散化的 Maxwell 方程（注意场分量的交错排列，这在平面波分析中被隐式处理）得到：\n$$ \\frac{1}{s_y} \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_y \\Delta}{2}\\right) E_z = - \\mu_0 \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega_d \\Delta t}{2}\\right) H_x $$\n$$ -\\frac{1}{s_x} \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_x \\Delta}{2}\\right) E_z = - \\mu_0 \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega_d \\Delta t}{2}\\right) H_y $$\n$$ \\frac{1}{s_x} \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_x \\Delta}{2}\\right) H_y - \\frac{1}{s_y} \\frac{2i}{\\Delta} \\sin\\left(\\frac{k_y \\Delta}{2}\\right) H_x = \\epsilon_0 \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega_d \\Delta t}{2}\\right) E_z $$\n解出 $H_x$ 和 $H_y$ 并代入第三个方程，与连续情况类似，得到离散色散关系：\n$$ \\frac{1}{s_x^2} \\left(\\frac{\\sin(k_x\\Delta/2)}{\\Delta/2}\\right)^2 + \\frac{1}{s_y^2} \\left(\\frac{\\sin(k_y\\Delta/2)}{\\Delta/2}\\right)^2 = \\frac{1}{c^2} \\left(\\frac{\\sin(\\omega_d\\Delta t/2)}{\\Delta t/2}\\right)^2 $$\n使用 Courant 数 $S = c \\Delta t / \\Delta$，我们可以将其写为：\n$$ \\frac{1}{S^2} \\sin^2\\left(\\frac{\\omega_d \\Delta t}{2}\\right) = \\frac{1}{s_x^2} \\sin^2\\left(\\frac{k_x \\Delta}{2}\\right) + \\frac{1}{s_y^2} \\sin^2\\left(\\frac{k_y \\Delta}{2}\\right) $$\n这是角频率 $\\omega_d$ 的离散色散关系。\n\n对于长波长展开（$k \\Delta \\ll 1$），我们使用泰勒级数 $\\sin(u) \\approx u - u^3/6$。\n$$ \\frac{1}{S^2} \\left(\\frac{\\omega_d \\Delta t}{2} - \\frac{(\\omega_d \\Delta t)^3}{48}\\right)^2 \\approx \\frac{1}{s_x^2} \\left(\\frac{k_x \\Delta}{2} - \\frac{(k_x \\Delta)^3}{48}\\right)^2 + \\frac{1}{s_y^2} \\left(\\frac{k_y \\Delta}{2} - \\frac{(k_y \\Delta)^3}{48}\\right)^2 $$\n展开平方项并保留小量的四阶项：\n$$ \\frac{(\\omega_d \\Delta t)^2}{4S^2} \\left(1 - \\frac{(\\omega_d \\Delta t)^2}{12}\\right) \\approx \\frac{(k_x \\Delta)^2}{4s_x^2} \\left(1 - \\frac{(k_x \\Delta)^2}{12}\\right) + \\frac{(k_y \\Delta)^2}{4s_y^2} \\left(1 - \\frac{(k_y \\Delta)^2}{12}\\right) $$\n代入 $\\Delta t = S \\Delta/c$：\n$$ \\frac{\\omega_d^2 \\Delta^2}{4c^2} \\left(1 - \\frac{\\omega_d^2 S^2 \\Delta^2}{12c^2}\\right) \\approx \\frac{\\Delta^2}{4} \\left( \\frac{k_x^2}{s_x^2} - \\frac{k_x^4 \\Delta^2}{12s_x^2} + \\frac{k_y^2}{s_y^2} - \\frac{k_y^4 \\Delta^2}{12s_y^2} \\right) $$\n$$ \\frac{\\omega_d^2}{c^2} \\approx \\left( \\frac{k_x^2}{s_x^2} + \\frac{k_y^2}{s_y^2} \\right) - \\frac{\\Delta^2}{12} \\left( \\frac{k_x^4}{s_x^2} + \\frac{k_y^4}{s_y^2} \\right) + \\frac{\\omega_d^4 S^2\\Delta^2}{12c^4} $$\n在误差项中，我们可以用连续频率 $\\omega$ 来近似 $\\omega_d$，其中 $\\omega^2/c^2 = k_x^2/s_x^2 + k_y^2/s_y^2$。\n$$ \\frac{\\omega_d^2}{c^2} \\approx \\frac{\\omega^2}{c^2} - \\frac{\\Delta^2}{12} \\left(\\frac{k_x^4}{s_x^2} + \\frac{k_y^4}{s_y^2}\\right) + \\frac{\\omega^4 S^2 \\Delta^2}{12 c^4} $$\n除以 $\\omega^2/c^2 = k_x^2/s_x^2 + k_y^2/s_y^2$：\n$$ \\frac{\\omega_d^2}{\\omega^2} \\approx 1 - \\frac{c^2 \\Delta^2}{12 \\omega^2} \\left(\\frac{k_x^4}{s_x^2} + \\frac{k_y^4}{s_y^2}\\right) + \\frac{\\omega^2 S^2 \\Delta^2}{12 c^2} $$\n$$ \\frac{\\omega_d^2}{\\omega^2} \\approx 1 + \\frac{\\Delta^2}{12} \\left( S^2 \\frac{\\omega^2}{c^2} - \\frac{k_x^4/s_x^2 + k_y^4/s_y^2}{\\omega^2/c^2} \\right) $$\n$$ \\frac{\\omega_d^2}{\\omega^2} \\approx 1 + \\frac{\\Delta^2}{12} \\left( S^2 \\left(\\frac{k_x^2}{s_x^2} + \\frac{k_y^2}{s_y^2}\\right) - \\frac{k_x^4/s_x^2 + k_y^4/s_y^2}{k_x^2/s_x^2 + k_y^2/s_y^2} \\right) $$\n相对相速度误差为 $(\\omega_d/\\omega) - 1$。对于一个小的误差项 $X$，有 $\\sqrt{1+X} \\approx 1+X/2$。\n$$ \\frac{\\omega_d}{\\omega} - 1 \\approx \\frac{\\Delta^2}{24} \\left( S^2 \\left(\\frac{k_x^2}{s_x^2} + \\frac{k_y^2}{s_y^2}\\right) - \\frac{k_x^4/s_x^2 + k_y^4/s_y^2}{k_x^2/s_x^2 + k_y^2/s_y^2} \\right) $$\n代入 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$：\n$$ \\frac{\\omega_d}{\\omega} - 1 \\approx \\frac{(k\\Delta)^2}{24} \\left( S^2 \\left(\\frac{\\cos^2\\theta}{s_x^2} + \\frac{\\sin^2\\theta}{s_y^2}\\right) - \\frac{\\cos^4\\theta/s_x^2 + \\sin^4\\theta/s_y^2}{\\cos^2\\theta/s_x^2 + \\sin^2\\theta/s_y^2} \\right) $$\n此表达式给出了领先阶相对相速度误差。\n\n对于群速度，$v_g = \\partial \\omega / \\partial k$。从连续关系式可知，$\\omega = c k \\sqrt{\\frac{\\cos^2\\theta}{s_x^2} + \\frac{\\sin^2\\theta}{s_y^2}}$。\n由于对于固定的 $\\theta$，$ \\omega$ 与 $k$ 是线性关系，群速度为 $v_g = \\partial\\omega/\\partial k = \\omega/k$。\n设相速度误差为 $(\\omega_d/\\omega) - 1 = C (k\\Delta)^2$，其中 $C$ 是上面推导出的项，与 $k$ 无关。\n那么 $\\omega_d \\approx \\omega (1 + C k^2 \\Delta^2) = (k v_g)(1 + C k^2 \\Delta^2) = v_g k + C v_g \\Delta^2 k^3$。\n离散群速度为 $v_{g,d} = \\partial \\omega_d / \\partial k$：\n$$ v_{g,d} = \\frac{\\partial}{\\partial k} (v_g k + C v_g \\Delta^2 k^3) = v_g + 3 C v_g \\Delta^2 k^2 = v_g(1 + 3 C k^2 \\Delta^2) $$\n相对群速度误差为：\n$$ \\frac{v_{g,d}}{v_g} - 1 \\approx 3 C (k\\Delta)^2 = 3 \\left(\\frac{\\omega_d}{\\omega} - 1\\right) $$\n$$ \\frac{v_{g,d}}{v_g} - 1 \\approx \\frac{(k\\Delta)^2}{8} \\left( S^2 \\left(\\frac{\\cos^2\\theta}{s_x^2} + \\frac{\\sin^2\\theta}{s_y^2}\\right) - \\frac{\\cos^4\\theta/s_x^2 + \\sin^4\\theta/s_y^2}{\\cos^2\\theta/s_x^2 + \\sin^2\\theta/s_y^2} \\right) $$\n\n因此，两个所求的误差都已确定。\n第一个误差是相对相速度误差 $(\\omega_d/\\omega)-1$。\n第二个误差是相对群速度误差 $(v_{g,d}/v_g)-1$。\n我们将它们表示为一个二元行矩阵。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{(k\\Delta)^{2}}{24} \\left[ S^{2} \\left( \\frac{\\cos^{2}\\theta}{s_x^{2}} + \\frac{\\sin^{2}\\theta}{s_y^{2}} \\right) - \\frac{\\frac{\\cos^{4}\\theta}{s_x^{2}} + \\frac{\\sin^{4}\\theta}{s_y^{2}}}{\\frac{\\cos^{2}\\theta}{s_x^{2}} + \\frac{\\sin^{2}\\theta}{s_y^{2}}} \\right],  \\frac{(k\\Delta)^{2}}{8} \\left[ S^{2} \\left( \\frac{\\cos^{2}\\theta}{s_x^{2}} + \\frac{\\sin^{2}\\theta}{s_y^{2}} \\right) - \\frac{\\frac{\\cos^{4}\\theta}{s_x^{2}} + \\frac{\\sin^{4}\\theta}{s_y^{2}}}{\\frac{\\cos^{2}\\theta}{s_x^{2}} + \\frac{\\sin^{2}\\theta}{s_y^{2}}} \\right] \\end{pmatrix} } $$"
        },
        {
            "introduction": "设计不当的PML本身可能成为误差的来源，甚至导致灾难性的数值不稳定性，使得场量指数增长而非衰减。本练习将探究一种典型的PML失效模式——在各向异性网格上产生的后期不稳定性，并研究几种实用的修正方案。此实践强调了稳定性分析的重要性，通过运用冯·诺依曼 (von Neumann) 方法检验FDTD更新矩阵的谱特性 ，这是计算科学家必须掌握的一项关键技能。",
            "id": "3339149",
            "problem": "考虑一个二维横电（$\\mathrm{TE}_z$）极化的麦克斯韦真空系统，该系统在一个均匀的Yee网格上进行离散化，空间步长为 $\\Delta x$ 和 $\\Delta y$，时间步长为 $\\Delta t$。设介电常数和磁导率归一化为 $\\varepsilon = 1$ 和 $\\mu = 1$，因此在这些单位下光速为 $c = 1$。使用拉伸坐标方法应用完美匹配层，其中每个空间方向的坐标拉伸由复数拉伸系数 $s_x$ 和 $s_y$ 表示。具有拉伸坐标完美匹配层（SC-PML）耦合的 $\\mathrm{TE}_z$ 方程的半离散形式（无显式物理电导率项）按如下蛙跳格式构建：磁场分量 $H_x$ 和 $H_y$ 在半整数时间步通过与整数时间步的电场 $E_z$ 耦合进行更新，而电场则由随后的半步中的磁场进行更新。\n\n定义平面波模式的离散波数为\n$$S_x(\\theta_x) = \\frac{2}{\\Delta x} \\sin(\\theta_x), \\qquad S_y(\\theta_y) = \\frac{2}{\\Delta y} \\sin(\\theta_y),$$\n其中 $\\theta_x \\in [0,\\pi]$ 和 $\\theta_y \\in [0,\\pi]$ 代表 von Neumann 模态分析的布里渊区参数。一个时间步长 $\\Delta t$ 的显式蛙跳更新可以写成一个线性映射\n$$\\mathbf{u}^{n+1} = \\mathbf{U}(\\theta_x,\\theta_y)\\mathbf{u}^{n},$$\n其中 $\\mathbf{u}^{n} = \\big[H_x^{n-\\frac{1}{2}}, H_y^{n-\\frac{1}{2}}, E_z^{n}\\big]^\\top$，且 $\\mathbf{U}(\\theta_x,\\theta_y)$ 取决于如何在交错网格上对拉伸系数进行采样的选择。在“朴素”采样中，处处使用相同的 $s_x$ 和 $s_y$。在“交错拉伸”采样中，电场 $E_z$ 更新使用包含考虑空间交错的因子的有效耦合，因此 $E_z$ 更新使用\n$$\\frac{S_x(\\theta_x)}{s_x}\\cos\\left(\\theta_y\\right) \\quad \\text{和} \\quad \\frac{S_y(\\theta_y)}{s_y}\\cos\\left(\\theta_x\\right)$$\n来代替 $S_x(\\theta_x)/s_x$ 和 $S_y(\\theta_y)/s_y$。最后，考虑一个可选的谱高频滤波器，它将模态更新乘以一个标量因子\n$$g(\\theta_x,\\theta_y) = 1 - \\beta\\left[\\sin^4\\left(\\theta_x\\right) + \\sin^4\\left(\\theta_y\\right)\\right],$$\n其中 $\\beta \\ge 0$，该滤波器均匀地应用于更新后的状态，以阻尼网格尺度的各向异性模式。\n\n从麦克斯韦方程组和Yee网格蛙跳离散化出发，为真空中有SC-PML耦合的 $\\mathrm{TE}_z$ 模式构建显式的 $3\\times 3$ 更新矩阵 $\\mathbf{U}(\\theta_x,\\theta_y)$，同时考虑朴素采样和交错拉伸采样两种情况。使用离散 von Neumann 分析，定义模态谱半径\n$$\\rho_{\\max} = \\max_{\\theta_x \\in [0,\\pi],\\,\\theta_y \\in [0,\\pi]} \\rho\\left(\\mathbf{U}(\\theta_x,\\theta_y)\\right),$$\n其中 $\\rho(\\cdot)$ 表示谱半径（特征值的最大绝对值）。对于有滤波器的情况，有效更新矩阵为 $\\mathbf{U}_\\mathrm{filt}(\\theta_x,\\theta_y) = g(\\theta_x,\\theta_y)\\mathbf{U}(\\theta_x,\\theta_y)$，其谱半径的计算方式类似。如果 $\\rho_{\\max}  1$，则认为SC-PML是离散能量衰减的。\n\n您的任务是：\n\n- 从第一性原理出发，以麦克斯韦旋度方程和Yee蛙跳格式为起点，推导 $\\mathbf{U}(\\theta_x,\\theta_y)$ 的显式形式，展示 $S_x(\\theta_x)$、$S_y(\\theta_y)$ 及 $s_x, s_y$ 如何进入耦合项。\n- 解释网格各向异性（即 $\\Delta x \\ne \\Delta y$）如何在固定 $\\Delta t$ 的情况下导致朴素采样的 $\\rho_{\\max} \\ge 1$，以及交错拉伸采样或谱滤波器如何能恢复 $\\rho_{\\max}  1$。\n\n我们全程采用归一化的无量纲单位（输出中不需要物理单位）。实现一个程序，通过在 $[0,\\pi]$ 上扫描 $\\theta_x$ 和 $\\theta_y$ 值的均匀网格，为以下每个测试用例计算 $\\rho_{\\max}$：\n\n- 测试用例1（理想情况）：各向同性网格，朴素SC-PML采样。参数：$\\Delta x = 1$, $\\Delta y = 1$, $\\Delta t = 0.5$, $s_x = 1 + 0.1\\mathrm{i}$, $s_y = 1 + 0.1\\mathrm{i}$, 无滤波器（$\\beta = 0$）。\n- 测试用例2（各向异性压力）：各向异性网格，朴素SC-PML采样。参数：$\\Delta x = 0.2$, $\\Delta y = 1$, $\\Delta t = 0.5$, $s_x = 1 + 0.1\\mathrm{i}$, $s_y = 1 + 0.1\\mathrm{i}$, 无滤波器（$\\beta = 0$）。\n- 测试用例3（交错拉伸补救）：各向异性网格，采用交错拉伸SC-PML采样。参数：与测试用例2相同，但在 $E_z$ 更新中使用如上所述的交错拉伸耦合，无滤波器（$\\beta = 0$）。\n- 测试用例4（谱滤波器补救）：各向异性网格，朴素SC-PML采样，带滤波器。参数：与测试用例2相同，但应用谱滤波器，$\\beta = 0.9$。\n\n对每个测试用例，将 $\\rho_{\\max}$ 计算为浮点数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），每个结果是按上述顺序列出的测试用例对应的 $\\rho_{\\max}$。不需要外部输入，程序必须是自包含的并且可以直接运行。解决方案必须仅依赖于指定的运行时环境和库。",
            "solution": "用户希望分析一个用于TEz波的二维FDTD方案在有拉伸坐标完美匹配层（SC-PML）时的稳定性。这包括：\n1. 从第一性原理推导 $3 \\times 3$ 模态更新矩阵 $\\mathbf{U}(\\theta_x, \\theta_y)$。\n2. 解释数值不稳定性的来源以及所提出补救措施的机制。\n3. 实现一个程序来为四个特定的测试用例计算最大谱半径 $\\rho_{\\max}$。\n\n### 第1部分：更新矩阵的推导\n\n我们从二维无源介质中横电（$\\mathrm{TE}_z$）波的麦克斯韦方程组开始，并结合拉伸坐标PML公式。场分量为 $E_z$、$H_x$ 和 $H_y$。控制方程为：\n$$\n\\frac{\\partial H_x}{\\partial t} = -\\frac{1}{\\mu s_y} \\frac{\\partial E_z}{\\partial y}\n$$\n$$\n\\frac{\\partial H_y}{\\partial t} = \\frac{1}{\\mu s_x} \\frac{\\partial E_z}{\\partial x}\n$$\n$$\n\\frac{\\partial E_z}{\\partial t} = \\frac{1}{\\varepsilon s_x} \\frac{\\partial H_y}{\\partial x} - \\frac{1}{\\varepsilon s_y} \\frac{\\partial H_x}{\\partial y}\n$$\n在本问题中，我们使用归一化单位，其中 $\\varepsilon=1$ 和 $\\mu=1$。复数拉伸系数为 $s_x$ 和 $s_y$。我们使用时间步长为 $\\Delta t$ 的蛙跳时间步进格式在Yee网格上对这些方程进行离散化：\n$$\n\\frac{H_x^{n+1/2} - H_x^{n-1/2}}{\\Delta t} = - \\frac{1}{s_y} \\left( \\frac{\\partial E_z}{\\partial y} \\right)^n\n$$\n$$\n\\frac{H_y^{n+1/2} - H_y^{n-1/2}}{\\Delta t} = \\frac{1}{s_x} \\left( \\frac{\\partial E_z}{\\partial x} \\right)^n\n$$\n$$\n\\frac{E_z^{n+1} - E_z^n}{\\Delta t} = \\frac{1}{s_x} \\left( \\frac{\\partial H_y}{\\partial x} \\right)^{n+1/2} - \\frac{1}{s_y} \\left( \\frac{\\partial H_x}{\\partial y} \\right)^{n+1/2}\n$$\n为了进行 von Neumann 稳定性分析，我们假设平面波解的形式为 $F(j\\Delta x, l\\Delta y, n\\Delta t) = \\tilde{F} e^{i(k_x j \\Delta x + k_y l \\Delta y)}$，其中 $\\tilde{F}$ 是模态振幅。空间导数算子作用于这些模式时，会变成乘以复数因子。问题将这些因子的大小定义为 $S_x(\\theta_x) = \\frac{2}{\\Delta x} \\sin(\\theta_x)$ 和 $S_y(\\theta_y) = \\frac{2}{\\Delta y} \\sin(\\theta_y)$，其中 $\\theta_x = k_x \\Delta x$ 且 $\\theta_y = k_y \\Delta y$。Yee网格上的中心有限差分算子对应于乘以 $iS_x$ 和 $iS_y$。请注意，$S_x$ 和 $S_y$ 的这些定义对于Yee网格FDTD是非标准的（通常会涉及 $\\sin(\\theta/2)$），但我们必须遵循问题陈述。\n\n在模态（傅里叶）域中，离散化的方程变为：\n$$\n\\tilde{H}_x^{n+1/2} = \\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\n$$\n$$\n\\tilde{H}_y^{n+1/2} = \\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\n$$\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x}{s_x} \\tilde{H}_y^{n+1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{H}_x^{n+1/2}\n$$\n状态向量定义为 $\\mathbf{u}^n = [\\tilde{H}_x^{n-1/2}, \\tilde{H}_y^{n-1/2}, \\tilde{E}_z^n]^\\top$。我们寻求更新矩阵 $\\mathbf{U}$，使得 $\\mathbf{u}^{n+1} = \\mathbf{U} \\mathbf{u}^n$，其中 $\\mathbf{u}^{n+1} = [\\tilde{H}_x^{n+1/2}, \\tilde{H}_y^{n+1/2}, \\tilde{E}_z^{n+1}]^\\top$。\n\n$\\mathbf{U}$ 的前两行可以直接从 $H$ 场更新中写出。对于第三行，我们将 $\\tilde{H}_x^{n+1/2}$ 和 $\\tilde{H}_y^{n+1/2}$ 的表达式代入 $\\tilde{E}_z$ 更新方程中：\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x}{s_x} \\left(\\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\\right) - \\frac{i \\Delta t S_y}{s_y} \\left(\\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\\right)\n$$\n按 $\\mathbf{u}^n$ 的分量对各项进行分组：\n$$\n\\tilde{E}_z^{n+1} = \\left(-\\frac{i \\Delta t S_y}{s_y}\\right) \\tilde{H}_x^{n-1/2} + \\left(\\frac{i \\Delta t S_x}{s_x}\\right) \\tilde{H}_y^{n-1/2} + \\left(1 - (\\Delta t)^2\\left[\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right]\\right) \\tilde{E}_z^n\n$$\n\n#### 朴素采样\n对于朴素采样，上述推导直接成立。更新矩阵 $\\mathbf{U}_{\\text{naive}}$ 为：\n$$\n\\mathbf{U}_{\\text{naive}} = \n\\begin{pmatrix}\n1  0  -\\frac{i \\Delta t S_y}{s_y} \\\\\n0  1  \\frac{i \\Delta t S_x}{s_x} \\\\\n-\\frac{i \\Delta t S_y}{s_y}  \\frac{i \\Delta t S_x}{s_x}  1 - (\\Delta t)^2\\left(\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right)\n\\end{pmatrix}\n$$\n这个矩阵是对称的。\n\n#### 交错拉伸采样\n在此方案中，$H$ 场更新保持不变，但 $E_z$ 更新耦合项按规定修改：$\\frac{S_x}{s_x} \\to \\frac{S_x \\cos(\\theta_y)}{s_x}$ 和 $\\frac{S_y}{s_y} \\to \\frac{S_y \\cos(\\theta_x)}{s_y}$。仅将这些替换应用于初始的 $E_z$ 更新方程：\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x} \\tilde{H}_y^{n+1/2} - \\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y} \\tilde{H}_x^{n+1/2}\n$$\n我们将未修改的 $H$ 场更新代入这个修改后的 $E_z$ 更新中：\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x} \\left(\\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\\right) - \\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y} \\left(\\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\\right)\n$$\n$\\tilde{E}_z^n$ 的系数变为 $1 - (\\Delta t)^2\\left(\\frac{S_x^2 \\cos(\\theta_y)}{s_x^2} + \\frac{S_y^2 \\cos(\\theta_x)}{s_y^2}\\right)$。$H$ 场的系数也发生变化。最终的更新矩阵 $\\mathbf{U}_{\\text{stag}}$ 是：\n$$\n\\mathbf{U}_{\\text{stag}} = \n\\begin{pmatrix}\n1  0  -\\frac{i \\Delta t S_y}{s_y} \\\\\n0  1  \\frac{i \\Delta t S_x}{s_x} \\\\\n-\\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y}  \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x}  1 - (\\Delta t)^2\\left(\\frac{S_x^2 \\cos(\\theta_y)}{s_x^2} + \\frac{S_y^2 \\cos(\\theta_x)}{s_y^2}\\right)\n\\end{pmatrix}\n$$\n由于 $\\cos(\\theta_x)$ 和 $\\cos(\\theta_y)$ 因子仅出现在第三行，这个矩阵是不对称的。\n\n### 第2部分：不稳定性与补救措施\n\n方案的稳定性由更新矩阵的谱半径 $\\rho(\\mathbf{U}) = \\max_i |\\lambda_i|$ 决定。如果对于任何模式 $(\\theta_x, \\theta_y)$ 有 $\\rho(\\mathbf{U})  1$，则该方案不稳定。$\\mathbf{U}_{\\text{naive}}$ 的特征值 $\\lambda$ 是特征多项式的根。其中一个特征值总是 $\\lambda=1$，对应于静电场模式。另外两个特征值是以下二次方程的根：\n$$\n\\lambda^2 - (2 - \\Omega^2)\\lambda + 1 = 0\n$$\n其中 $\\Omega^2 = (\\Delta t)^2 \\left(\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right)$。在没有PML的情况下（$s_x=s_y=1$），$\\Omega^2$ 是实数且为正，稳定性条件（$|\\lambda|\\le 1$）简化为 Courant-Friedrichs-Lewy (CFL) 条件，$|\\Omega| \\le 2$。\n\n**各向异性引起的不稳定性**：当在各向异性网格（$\\Delta x \\neq \\Delta y$）上引入PML（$s_x, s_y$ 为复数）时，项 $\\Omega^2$ 变为复数。空间各向异性意味着 $S_x \\propto 1/\\Delta x$ 和 $S_y \\propto 1/\\Delta y$ 的最大值可能非常不同。对于以特定角度传播的模式，特别是 $S_x$ 或 $S_y$ 很大的高频模式，离散化和PML之间的相互作用可能导致违反无源性，从而引起 $|\\lambda|1$。朴素采样方案已知容易出现此类不稳定性，因为它没有在交错离散网格上正确地模拟连续无源PML介质的行为。当一个波数分量大而另一个分量小时，不稳定性最为显著，这种情况会因网格各向异性而加剧。\n\n**交错拉伸补救措施**：规定的交错拉伸方案修改了 $E_z$ 更新中的耦合项。因子 $\\cos(\\theta_x)$ 和 $\\cos(\\theta_y)$ 起到阻尼器的作用。例如，考虑一个具有较大 $\\theta_x \\approx \\pi/2$（$x$ 方向的高频分量）和较小 $\\theta_y \\approx 0$（$y$ 方向的低频分量）的模式。朴素方案在这里可能不稳定。交错方案将 $S_y$ 项乘以 $\\cos(\\theta_x) \\approx 0$，将 $S_x$ 项乘以 $\\cos(\\theta_y) \\approx 1$。这有选择地阻尼了某些相互作用，并可能通过改变问题模式的更新矩阵的特征值来恢复稳定性。尽管给出的公式不对应于标准的可证明稳定的方法（如CPML），但它旨在减轻大波数分量的影响。\n\n**谱滤波器补救措施**：该滤波器将一个乘法因子 $g(\\theta_x, \\theta_y) = 1 - \\beta(\\sin^4\\theta_x + \\sin^4\\theta_y)$ 应用于整个更新后的状态向量。有效谱半径变为 $\\rho_{\\text{filt}} = |g(\\theta_x,\\theta_y)|\\,\\rho(\\mathbf{U})$。当 $\\rho(\\mathbf{U})  1$ 时会发生不稳定性。如果在这些区域中 $|g|$ 足够小，能迫使 $|g|\\rho(\\mathbf{U})  1$，则滤波器可以恢复稳定性。朴素PML中的不稳定性通常发生在高频模式。指定的滤波器在 $\\theta_x=\\pi/2$ 和 $\\theta_y=\\pi/2$ 处施加最大阻尼，在这些地方 $\\sin\\theta_x, \\sin\\theta_y$ 为最大值，相应地 $S_x, S_y$ 也为最大值。通过减小这些问题模式的特征值的幅度，滤波器可以抑制数值增长并确保 $\\rho_{\\max}  1$。",
            "answer": "```python\nimport numpy as np\n\ndef compute_rho_max(dx, dy, dt, sx, sy, beta, sampling_type):\n    \"\"\"\n    Computes the maximum spectral radius of the FDTD update matrix.\n\n    Args:\n        dx (float): Grid spacing in x.\n        dy (float): Grid spacing in y.\n        dt (float): Time step.\n        sx (complex): PML stretch coefficient in x.\n        sy (complex): PML stretch coefficient in y.\n        beta (float): Spectral filter coefficient.\n        sampling_type (str): 'naive' or 'staggered'.\n\n    Returns:\n        float: The maximum spectral radius over the Brillouin zone.\n    \"\"\"\n    # Create a grid for the Brillouin zone parameters theta_x, theta_y\n    # A 201x201 grid is a reasonable balance of accuracy and speed.\n    n_points = 201\n    theta_vals = np.linspace(0, np.pi, n_points)\n    thx_grid, thy_grid = np.meshgrid(theta_vals, theta_vals)\n\n    # Calculate discrete wavenumber magnitudes S_x and S_y\n    # Using the non-standard definition from the problem statement.\n    Sx = (2.0 / dx) * np.sin(thx_grid)\n    Sy = (2.0 / dy) * np.sin(thy_grid)\n\n    # Initialize the update matrix U\n    U = np.zeros((n_points, n_points, 3, 3), dtype=np.complex128)\n\n    # Fill the first two rows, common to both sampling schemes\n    U[:, :, 0, 0] = 1.0\n    U[:, :, 1, 1] = 1.0\n    U[:, :, 0, 2] = -1j * dt * Sy / sy\n    U[:, :, 1, 2] = 1j * dt * Sx / sx\n\n    # Fill the third row based on the sampling type\n    if sampling_type == 'naive':\n        U[:, :, 2, 0] = -1j * dt * Sy / sy\n        U[:, :, 2, 1] = 1j * dt * Sx / sx\n        U[:, :, 2, 2] = 1.0 - dt**2 * (Sx**2 / sx**2 + Sy**2 / sy**2)\n    elif sampling_type == 'staggered':\n        cos_thx = np.cos(thx_grid)\n        cos_thy = np.cos(thy_grid)\n        U[:, :, 2, 0] = -1j * dt * Sy * cos_thx / sy\n        U[:, :, 2, 1] = 1j * dt * Sx * cos_thy / sx\n        U[:, :, 2, 2] = 1.0 - dt**2 * (Sx**2 * cos_thy / sx**2 + Sy**2 * cos_thx / sy**2)\n\n    # Calculate eigenvalues for each point in the theta grid\n    # The numpy stacking and linalg.eigvals is vectorized for efficiency.\n    # U is (N, N, 3, 3), we reshape to (N*N, 3, 3) and then transpose\n    # for eigvals which expects the last two dimensions to be the matrices.\n    eigvals = np.linalg.eigvals(U.reshape(-1, 3, 3))\n\n    # Calculate the spectral radius for each mode\n    rho_grid = np.max(np.abs(eigvals), axis=1).reshape(n_points, n_points)\n\n    # Apply the spectral filter if beta > 0\n    if beta > 0:\n        g = 1.0 - beta * (np.sin(thx_grid)**4 + np.sin(thy_grid)**4)\n        rho_grid *= np.abs(g)\n\n    # Find the maximum spectral radius over all modes\n    max_rho = np.max(rho_grid)\n    \n    return max_rho\n\ndef solve():\n    \"\"\"\n    Solves the problem for the four specified test cases.\n    \"\"\"\n    test_cases = [\n        # TC1: Isotropic, naive\n        {'dx': 1.0, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'naive'},\n        # TC2: Anisotropic, naive\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'naive'},\n        # TC3: Anisotropic, staggered-stretch\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'staggered'},\n        # TC4: Anisotropic, naive, with filter\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.9, 'sampling_type': 'naive'}\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_max = compute_rho_max(**case)\n        results.append(rho_max)\n    \n    # Format the final output as specified\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}