{
    "hands_on_practices": [
        {
            "introduction": "The theoretical elegance of the stretched-coordinate PML must ultimately be translated into a practical, discrete algorithm. This first exercise bridges that gap by focusing on the fundamental task of implementing a spatially graded conductivity profile, $\\sigma(x)$, within a finite-difference grid. You will derive how the continuous profile dictates the wave attenuation on a cell-by-cell basis, providing a direct link between the continuous theory and the tangible absorption achieved in a numerical simulation. ",
            "id": "3339137",
            "problem": "Consider a one-dimensional absorbing boundary in free space implemented by the Stretched-Coordinate Perfectly Matched Layer (SC-PML). A plane wave at normal incidence propagates along the $x$-axis into the SC-PML region occupying $0 \\le x \\le L$. The coordinate stretching along $x$ is defined by $s_x(x)$ with $\\kappa_x=1$ and no low-frequency damping parameter, so that the only free profile is the conductivity $\\sigma(x)$. The SC-PML profile to be implemented is graded as $\\sigma(x) = \\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$ for $x \\in [0,L]$ and integer grade $m \\ge 0$. The free-space parameters are $\\mu_0$ and $\\varepsilon_0$.\n\nStarting from Maxwell’s equations in the frequency domain and the SC-PML complex coordinate stretching, derive the expression for the attenuation factor magnitude experienced by a normally incident homogeneous plane wave as it traverses one discrete cell of thickness $\\Delta x$ within the SC-PML. Then, using that expression, implement the graded profile in a discrete scheme of $N$ uniform cells of width $\\Delta x = L/N$ where the $i$-th cell spans $\\left[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}\\right] = \\left[(i-1)\\Delta x, i\\,\\Delta x\\right]$ for $i=1,2,\\dots,N$. Your program must compute, for each cell, the attenuation factor magnitude (a dimensionless number between $0$ and $1$) experienced by the wave amplitude when traversing that cell, expressed as a float. Assume normal incidence and free space everywhere.\n\nFundamental base you must use in your derivation:\n- Maxwell’s equations in the frequency domain in source-free, linear, homogeneous media, and the definition of the SC-PML complex coordinate stretching.\n- The plane-wave solution in homogeneous media and its modification under complex coordinate stretching.\n\nPhysical constants and units to be used and reported:\n- Use $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ and $\\varepsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F/m}$.\n- Frequency $f$ is in $\\mathrm{Hz}$; the angular frequency is $\\omega = 2\\pi f$.\n- Lengths $L$ and $\\Delta x$ are in $\\mathrm{m}$.\n- Conductivity $\\sigma_{\\max}$ is in $\\mathrm{S/m}$.\n- The attenuation factor magnitudes are unitless floats.\n\nImplement the discrete graded profile $\\sigma(x)=\\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$ and compute the attenuation factor magnitude per cell for the following test suite. For each test case, compute a list of length $N$ that contains the attenuation factor magnitudes for cells $i=1,2,\\dots,N$ in order.\n\nTest suite parameter sets $(f, L, N, \\sigma_{\\max}, m)$:\n1. $(f = 2\\times 10^9, L = 2.0\\times 10^{-2}, N = 8, \\sigma_{\\max} = 9.781, m = 3)$\n2. $(f = 1.0\\times 10^9, L = 5.0\\times 10^{-3}, N = 1, \\sigma_{\\max} = 100.0, m = 1)$\n3. $(f = 5.0\\times 10^9, L = 1.0\\times 10^{-2}, N = 5, \\sigma_{\\max} = 50.0, m = 2)$\n4. $(f = 5.0\\times 10^8, L = 1.0\\times 10^{-2}, N = 5, \\sigma_{\\max} = 50.0, m = 2)$\n5. $(f = 3.0\\times 10^9, L = 1.0\\times 10^{-2}, N = 4, \\sigma_{\\max} = 25.0, m = 0)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list of floats corresponding to one test case, for example, something like $[[a_{1},a_{2},\\dots,a_{N_1}],[b_{1},\\dots],[\\dots]]$ with no spaces required. The final output must be a single line containing only this bracketed representation. Angle units do not apply. Percentages are not to be used anywhere; all reported quantities are floats or lists of floats.",
            "solution": "The problem requires the derivation and implementation of the attenuation factor for a plane wave traversing a discrete cell within a Stretched-Coordinate Perfectly Matched Layer (SC-PML). The derivation begins with Maxwell’s equations in the frequency domain for a source-free, linear, and homogeneous medium, assuming a time-harmonic convention of $e^{j\\omega t}$:\n$$ \\nabla \\times \\vec{E} = -j\\omega\\mu_0 \\vec{H} $$\n$$ \\nabla \\times \\vec{H} = j\\omega\\varepsilon_0 \\vec{E} $$\n\nFor a plane wave polarized with $\\vec{E} = E_y(x)\\hat{y}$ and $\\vec{H} = H_z(x)\\hat{z}$ propagating along the $x$-axis, these equations reduce to:\n$$ \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 H_z $$\n$$ \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 E_y $$\n\nThe SC-PML is introduced through a complex coordinate stretching in the direction of propagation. In the frequency domain, the operator $\\frac{\\partial}{\\partial x}$ is replaced by $\\frac{1}{s_x(x)}\\frac{\\partial}{\\partial x}$. The stretching factor $s_x(x)$ is defined based on the problem statement as:\n$$ s_x(x) = \\kappa_x + \\frac{\\sigma(x)}{j\\omega\\varepsilon_0} $$\nWith the given parameters $\\kappa_x=1$ and the conductivity profile $\\sigma(x)$, this becomes:\n$$ s_x(x) = 1 + \\frac{\\sigma(x)}{j\\omega\\varepsilon_0} $$\n\nApplying this transformation to Maxwell's equations yields the modified equations within the PML:\n$$ \\frac{1}{s_x(x)} \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 H_z \\implies \\frac{\\partial E_y}{\\partial x} = -j\\omega\\mu_0 s_x(x) H_z $$\n$$ \\frac{1}{s_x(x)} \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 E_y \\implies \\frac{\\partial H_z}{\\partial x} = -j\\omega\\varepsilon_0 s_x(x) E_y $$\nThese equations are equivalent to wave propagation in a medium with effective permittivity $\\varepsilon_{\\text{eff}}(x) = \\varepsilon_0 s_x(x)$ and effective permeability $\\mu_{\\text{eff}}(x) = \\mu_0 s_x(x)$. The local wave impedance is $Z(x) = \\sqrt{\\frac{\\mu_{\\text{eff}}(x)}{\\varepsilon_{\\text{eff}}(x)}} = \\sqrt{\\frac{\\mu_0 s_x(x)}{\\varepsilon_0 s_x(x)}} = \\sqrt{\\frac{\\mu_0}{\\varepsilon_0}} = \\eta_0$, the intrinsic impedance of free space. This impedance matching ensures no reflection at the PML interface for a continuous profile where $\\sigma(0)=0$.\n\nThe local wave number in the PML medium is given by:\n$$ k_{\\text{pml}}(x) = \\omega \\sqrt{\\mu_{\\text{eff}}(x) \\varepsilon_{\\text{eff}}(x)} = \\omega \\sqrt{(\\mu_0 s_x(x))(\\varepsilon_0 s_x(x))} = \\omega\\sqrt{\\mu_0\\varepsilon_0} s_x(x) = k_0 s_x(x) $$\nwhere $k_0 = \\omega\\sqrt{\\mu_0\\varepsilon_0}$ is the free-space wave number.\n\nA plane wave propagating from $x_1$ to $x_2$ accumulates a phase factor given by $\\exp\\left(-j \\int_{x_1}^{x_2} k_{\\text{pml}}(x') dx'\\right)$. The argument of the exponential is:\n$$ -j \\int_{x_1}^{x_2} k_0 s_x(x') dx' = -j \\int_{x_1}^{x_2} k_0 \\left(1 + \\frac{\\sigma(x')}{j\\omega\\varepsilon_0}\\right) dx' $$\n$$ = -j k_0 \\int_{x_1}^{x_2} dx' - \\frac{k_0}{\\omega\\varepsilon_0} \\int_{x_1}^{x_2} \\sigma(x') dx' $$\nThe first term, $-j k_0 (x_2-x_1)$, is purely imaginary and represents phase rotation. The second term is purely real and represents attenuation. The magnitude of the propagation factor is determined by this real term. Let us evaluate the constant factor:\n$$ \\frac{k_0}{\\omega\\varepsilon_0} = \\frac{\\omega\\sqrt{\\mu_0\\varepsilon_0}}{\\omega\\varepsilon_0} = \\sqrt{\\frac{\\mu_0}{\\varepsilon_0}} = \\eta_0 $$\nThus, the attenuation factor magnitude, $A$, for a wave traversing the region from $x_1$ to $x_2$ is:\n$$ A = \\exp\\left(-\\eta_0 \\int_{x_1}^{x_2} \\sigma(x') dx'\\right) $$\nNotably, this expression is independent of the wave frequency $f$.\n\nThe problem requires this factor for each discrete cell $i$, which spans the interval $[(i-1)\\Delta x, i\\Delta x]$, where $\\Delta x = L/N$. The attenuation factor for cell $i$, denoted $A_i$, is:\n$$ A_i = \\exp\\left(-\\eta_0 \\int_{(i-1)\\Delta x}^{i\\Delta x} \\sigma(x') dx'\\right) $$\nThe conductivity profile is given as $\\sigma(x) = \\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m$. We must now evaluate the integral for the $i$-th cell.\n$$ \\int_{(i-1)\\Delta x}^{i\\Delta x} \\sigma_{\\max}\\left(\\frac{x'}{L}\\right)^m dx' = \\frac{\\sigma_{\\max}}{L^m} \\int_{(i-1)\\Delta x}^{i\\Delta x} (x')^m dx' $$\nFor $m \\ge 0$, the integral is:\n$$ \\frac{\\sigma_{\\max}}{L^m} \\left[\\frac{(x')^{m+1}}{m+1}\\right]_{(i-1)\\Delta x}^{i\\Delta x} = \\frac{\\sigma_{\\max}}{L^m(m+1)} \\left[ (i\\Delta x)^{m+1} - ((i-1)\\Delta x)^{m+1} \\right] $$\nSubstituting $\\Delta x = L/N$, we get:\n$$ \\frac{\\sigma_{\\max}}{L^m(m+1)} \\frac{L^{m+1}}{N^{m+1}} \\left[ i^{m+1} - (i-1)^{m+1} \\right] = \\frac{\\sigma_{\\max} L}{(m+1)N^{m+1}} \\left[ i^{m+1} - (i-1)^{m+1} \\right] $$\nThis expression represents the integrated conductivity over cell $i$. Let's call this integral $I_i$.\nThe final expression for the attenuation factor magnitude for cell $i$ is:\n$$ A_i = \\exp\\left(-\\eta_0 I_i\\right) = \\exp\\left(-\\eta_0 \\frac{\\sigma_{\\max} L}{(m+1)N^{m+1}} \\left( i^{m+1} - (i-1)^{m+1} \\right)\\right) $$\nThis is the formula to be implemented for each cell $i=1, 2, \\dots, N$. For the special case $m=0$, the profile is constant, $\\sigma(x) = \\sigma_{\\max}$, and the integral simplifies to $I_i = \\sigma_{\\max}\\Delta x = \\sigma_{\\max}L/N$. Our general formula yields for $m=0$: $I_i = \\frac{\\sigma_{\\max}L}{(1)N^1}(i^1 - (i-1)^1) = \\frac{\\sigma_{\\max}L}{N}$, which is consistent.\nThe implementation will calculate this value $A_i$ for each cell in each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the per-cell attenuation factor magnitude for a plane wave in an SC-PML.\n    \"\"\"\n    # Define physical constants\n    MU_0 = 4 * np.pi * 1e-7  # Permeability of free space (H/m)\n    EPSILON_0 = 8.854187817e-12  # Permittivity of free space (F/m)\n    ETA_0 = np.sqrt(MU_0 / EPSILON_0)  # Intrinsic impedance of free space (Ohms)\n\n    # Test suite parameter sets: (f, L, N, sigma_max, m)\n    test_cases = [\n        (2e9, 2.0e-2, 8, 9.781, 3),\n        (1.0e9, 5.0e-3, 1, 100.0, 1),\n        (5.0e9, 1.0e-2, 5, 50.0, 2),\n        (5.0e8, 1.0e-2, 5, 50.0, 2),\n        (3.0e9, 1.0e-2, 4, 25.0, 0),\n    ]\n\n    all_results = []\n    \n    for _, L, N, sigma_max, m in test_cases:\n        case_results = []\n        m_plus_1 = m + 1\n        \n        # Pre-compute the constant factor for the conductivity integral.\n        # The integral over cell i is: factor * (i^(m+1) - (i-1)^(m+1))\n        # Note: per the problem, m >= 0, so m+1 is always >= 1.\n        integral_const_factor = (sigma_max * L) / (m_plus_1 * (N ** m_plus_1))\n\n        for i in range(1, N + 1):\n            # Calculate the integrated conductivity over the i-th cell\n            integral_sigma = integral_const_factor * (i**m_plus_1 - (i - 1)**m_plus_1)\n            \n            # Calculate the attenuation factor magnitude\n            # A_i = exp(-eta_0 * integral_sigma)\n            attenuation_factor = np.exp(-ETA_0 * integral_sigma)\n            case_results.append(attenuation_factor)\n            \n        all_results.append(case_results)\n\n    # Format the output string to be a dense list of lists of floats.\n    # e.g., [[0.1,0.2],[0.3,0.4]]\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "While simple conductivity profiles are instructive, modern PML formulations like the Convolutional PML (CPML) offer superior absorption over a wide range of frequencies and angles. This performance, however, comes at the cost of storing and computing time-domain convolutions, which can be resource-intensive. This practice delves into a critical aspect of efficient PML design: approximating the ideal, complex CPML kernel with a computationally cheaper recursive filter. By minimizing the approximation error, you will navigate a realistic engineering trade-off between numerical accuracy and computational efficiency. ",
            "id": "3339157",
            "problem": "A one-dimensional transverse electromagnetic plane wave is simulated with a Finite-Difference Time-Domain (FDTD) scheme in a homogeneous, isotropic medium with electric permittivity $\\varepsilon$ and magnetic permeability $\\mu$. A Perfectly Matched Layer (PML) is implemented on the $x$ boundary using stretched-coordinate PML, where the constitutive derivative along $x$ is modified via the complex coordinate stretch $s_x(\\omega) = \\kappa_x + \\frac{\\sigma_x}{\\alpha_x + j \\omega}$, with $\\kappa_x > 0$, $\\sigma_x \\ge 0$, and $\\alpha_x \\ge 0$ constant. In the time domain, this yields a Convolutional Perfectly Matched Layer (CPML) correction that can be written as a convolution of a causal impulse response $h(t)$ with the relevant field derivative.\n\nTo reduce memory, the CPML convolution is approximated by a single-pole Recursive Convolution (RC) filter of the form $h_{\\text{RC}}(t) = c \\exp(-b t)$, for $t \\ge 0$, with parameters $b > 0$ and $c > 0$. In this configuration, the frequency-domain target response arising from the stretched coordinate and its discretization is represented by a two-pole real-rational function whose time-domain impulse response is\n$$\nh(t) = A \\exp(-\\alpha t) + B \\exp(-\\beta t),\n$$\nwith $A > 0$, $B > 0$, $\\alpha > 0$, and $\\beta > 0$ determined by the PML profile and digital discretization. The approximation quality is quantified by the squared $L_2([0,\\infty))$ norm of the impulse-response error on $[0,\\infty)$,\n$$\nJ(c,b) = \\int_{0}^{\\infty} \\left( c \\exp(-b t) - h(t) \\right)^{2} \\, dt,\n$$\nand the design objective is to choose $b$ (with associated optimal $c$) to minimize $J$.\n\nStarting from Maxwell’s equations and the stretched-coordinate formulation, justify the convolutional form and the rational approximation of $h(t)$ as above. Then, using first principles of least-squares approximation in $L_2([0,\\infty))$, derive the stationarity condition for the optimal decay rate $b^{\\star}$ when $c$ is chosen to minimize $J$ for a given $b$. Finally, for the specific PML parameters\n$$\nA = 1.5, \\quad B = 0.5, \\quad \\alpha = 1.0 \\;\\text{s}^{-1}, \\quad \\beta = 4.0 \\;\\text{s}^{-1},\n$$\ncompute the optimal decay rate $b^{\\star}$ that minimizes $J$ and present its value. Express your final answer in $\\text{s}^{-1}$ and round your answer to four significant figures.",
            "solution": "The problem asks for three main tasks: first, to justify the convolutional form of the Perfectly Matched Layer (PML) and the rational approximation of its impulse response; second, to derive the stationarity condition for the optimal decay rate $b^{\\star}$ of a single-pole recursive filter used to approximate the PML kernel; and third, to compute the value of $b^{\\star}$ for a specific set of parameters.\n\n**Part 1: Justification of the Convolutional Form and Rational Approximation**\n\nLet's begin with Maxwell's equations in a source-free, homogeneous, isotropic medium. For a one-dimensional transverse electromagnetic (TEM) wave propagating along the $x$-axis with electric field in the $z$-direction ($E_z$) and magnetic field in the $y$-direction ($H_y$), the relevant equations are:\n$$\n\\varepsilon \\frac{\\partial E_z}{\\partial t} = \\frac{\\partial H_y}{\\partial x}\n$$\n$$\n\\mu \\frac{\\partial H_y}{\\partial t} = \\frac{\\partial E_z}{\\partial x}\n$$\nIn the frequency domain, with the time-harmonic convention $e^{j \\omega t}$, these become:\n$$\nj \\omega \\varepsilon E_z(\\omega) = \\frac{d H_y(\\omega)}{d x}\n$$\n$$\nj \\omega \\mu H_y(\\omega) = \\frac{d E_z(\\omega)}{d x}\n$$\nThe stretched-coordinate PML formulation modifies the spatial derivative operator $\\frac{\\partial}{\\partial x}$ in the PML region. The operator is replaced by $\\frac{1}{s_x(\\omega)} \\frac{\\partial}{\\partial x}$, where $s_x(\\omega)$ is the complex stretching factor. The problem specifies this factor as:\n$$\ns_x(\\omega) = \\kappa_x + \\frac{\\sigma_x}{\\alpha_x + j \\omega}\n$$\nHere, $\\kappa_x \\ge 1$ is a real stretching factor, $\\sigma_x \\ge 0$ provides the loss, and $\\alpha_x \\ge 0$ is a parameter controlling the frequency dependence of the loss. Applying this transformation to the first Maxwell's equation gives:\n$$\nj \\omega \\varepsilon E_z(\\omega) = \\frac{1}{s_x(\\omega)} \\frac{d H_y(\\omega)}{d x}\n$$\nThis equation establishes the convolutional relationship. In the time domain, multiplication in the frequency domain becomes a convolution. Let $f(t) = \\frac{\\partial H_y(t)}{\\partial x}$ and $S(\\omega) = \\frac{1}{s_x(\\omega)}$. Then the time-domain equation is:\n$$\n\\varepsilon \\frac{\\partial E_z(t)}{\\partial t} = \\mathcal{F}^{-1}\\{S(\\omega)\\} * f(t) = s(t) * f(t)\n$$\nwhere $*$ denotes convolution and $s(t)$ is the inverse Fourier transform of $S(\\omega)$. This justifies the convolutional form.\n\nOften, to facilitate a recursive implementation in the time domain (known as Recursive Convolution or RC), the term is split. We can write $S(\\omega) = \\frac{1}{s_x(\\omega)}$ as:\n$$\nS(\\omega) = \\frac{1}{\\kappa_x + \\frac{\\sigma_x}{\\alpha_x + j \\omega}} = \\frac{1}{\\kappa_x} \\left( \\frac{1}{1 + \\frac{\\sigma_x/\\kappa_x}{\\alpha_x+j\\omega}} \\right)\n$$\nFor implementation, it is common to use the auxiliary differential equation (ADE) method that arises from this structure. However, the problem statement indicates that the target impulse response $h(t)$ for the \"CPML correction\" arises from both the continuous-time stretched coordinate and its discretization in the FDTD scheme. The discretization process, particularly how the time derivatives and integrals are approximated (e.g., using semi-implicit schemes for the ADEs), transforms the single-pole continuous-time response into a more complex discrete-time response. When this discrete-time response is mapped back to a continuous-time equivalent for analysis and design, it can be accurately represented by a multi-pole rational function. The problem states this effective kernel is well-approximated by a two-pole system whose impulse response is a sum of two real exponentials:\n$$\nh(t) = A \\exp(-\\alpha t) + B \\exp(-\\beta t)\n$$\nThis form is a standard and justifiable premise in the advanced analysis of FDTD-based CPML implementations.\n\n**Part 2: Derivation of the Stationarity Condition for $b^{\\star}$**\n\nThe objective is to find parameters $c > 0$ and $b > 0$ for the approximating function $h_{\\text{RC}}(t) = c \\exp(-b t)$ that minimize the squared $L_2$ error norm:\n$$\nJ(c,b) = \\int_{0}^{\\infty} \\left( c \\exp(-b t) - h(t) \\right)^{2} \\, dt\n$$\nFirst, for a fixed value of $b$, we find the optimal $c$ by setting the partial derivative of $J$ with respect to $c$ to zero:\n$$\n\\frac{\\partial J}{\\partial c} = \\int_{0}^{\\infty} 2 \\left( c \\exp(-b t) - h(t) \\right) \\exp(-b t) \\, dt = 0\n$$\n$$\nc \\int_{0}^{\\infty} \\exp(-2b t) \\, dt = \\int_{0}^{\\infty} h(t) \\exp(-b t) \\, dt\n$$\nThe integral on the left is $\\int_{0}^{\\infty} \\exp(-2b t) \\, dt = \\left[ -\\frac{1}{2b} \\exp(-2bt) \\right]_0^\\infty = \\frac{1}{2b}$ for $b>0$. The integral on the right is the Laplace transform of $h(t)$ evaluated at $s=b$, which we denote as $\\hat{h}(b)$.\n$$\nc \\left( \\frac{1}{2b} \\right) = \\hat{h}(b) \\implies c(b) = 2b \\, \\hat{h}(b)\n$$\nThis gives the optimal $c$ as a function of $b$. We substitute this back into the expression for $J$ to obtain a function of $b$ alone:\n$$\nJ(b) = \\int_{0}^{\\infty} \\left( (2b \\, \\hat{h}(b)) \\exp(-b t) - h(t) \\right)^{2} \\, dt\n$$\nExpanding the square:\n$$\nJ(b) = (2b \\, \\hat{h}(b))^2 \\int_{0}^{\\infty} \\exp(-2bt) dt - 2(2b \\, \\hat{h}(b)) \\int_{0}^{\\infty} h(t) \\exp(-bt) dt + \\int_{0}^{\\infty} h(t)^2 dt\n$$\n$$\nJ(b) = (4b^2 \\hat{h}(b)^2) \\left(\\frac{1}{2b}\\right) - 4b \\, \\hat{h}(b) (\\hat{h}(b)) + \\int_{0}^{\\infty} h(t)^2 dt\n$$\n$$\nJ(b) = 2b \\, \\hat{h}(b)^2 - 4b \\, \\hat{h}(b)^2 + \\int_{0}^{\\infty} h(t)^2 dt = -2b \\, \\hat{h}(b)^2 + \\int_{0}^{\\infty} h(t)^2 dt\n$$\nTo minimize $J(b)$, we need to maximize the term $b \\, \\hat{h}(b)^2$ (since the second term is a constant with respect to $b$). We find the stationary points by setting the derivative with respect to $b$ to zero:\n$$\n\\frac{dJ}{db} = -2\\frac{d}{db} \\left[ b \\, (\\hat{h}(b))^2 \\right] = 0\n$$\nUsing the product rule:\n$$\n\\frac{d}{db} \\left[ b \\, (\\hat{h}(b))^2 \\right] = 1 \\cdot (\\hat{h}(b))^2 + b \\cdot \\left[ 2 \\hat{h}(b) \\frac{d\\hat{h}(b)}{db} \\right] = 0\n$$\nAssuming a non-trivial approximation where $\\hat{h}(b) \\neq 0$, we can divide by $\\hat{h}(b)$:\n$$\n\\hat{h}(b) + 2b \\, \\frac{d\\hat{h}(b)}{db} = 0\n$$\nLetting $\\hat{h}'(b) = \\frac{d\\hat{h}(b)}{db}$, the stationarity condition for the optimal decay rate $b^{\\star}$ is:\n$$\n\\hat{h}(b^{\\star}) + 2b^{\\star} \\hat{h}'(b^{\\star}) = 0\n$$\n\n**Part 3: Computation of the Optimal Decay Rate $b^{\\star}$**\n\nWe are given the target impulse response:\n$$\nh(t) = A \\exp(-\\alpha t) + B \\exp(-\\beta t)\n$$\nwith parameters $A = 1.5$, $B = 0.5$, $\\alpha = 1.0 \\;\\text{s}^{-1}$, and $\\beta = 4.0 \\;\\text{s}^{-1}$. First, we compute its Laplace transform $\\hat{h}(b)$:\n$$\n\\hat{h}(b) = \\int_0^\\infty (A e^{-\\alpha t} + B e^{-\\beta t}) e^{-bt} dt = A \\int_0^\\infty e^{-(\\alpha+b)t} dt + B \\int_0^\\infty e^{-(\\beta+b)t} dt \n$$\n$$\n\\hat{h}(b) = \\frac{A}{\\alpha+b} + \\frac{B}{\\beta+b}\n$$\nNext, we compute its derivative with respect to $b$:\n$$\n\\hat{h}'(b) = -\\frac{A}{(\\alpha+b)^2} - \\frac{B}{(\\beta+b)^2}\n$$\nSubstituting these into the stationarity condition:\n$$\n\\left( \\frac{A}{\\alpha+b} + \\frac{B}{\\beta+b} \\right) + 2b \\left( -\\frac{A}{(\\alpha+b)^2} - \\frac{B}{(\\beta+b)^2} \\right) = 0\n$$\nGrouping terms by $A$ and $B$:\n$$\nA \\left( \\frac{1}{\\alpha+b} - \\frac{2b}{(\\alpha+b)^2} \\right) + B \\left( \\frac{1}{\\beta+b} - \\frac{2b}{(\\beta+b)^2} \\right) = 0\n$$\n$$\nA \\left( \\frac{(\\alpha+b)-2b}{(\\alpha+b)^2} \\right) + B \\left( \\frac{(\\beta+b)-2b}{(\\beta+b)^2} \\right) = 0\n$$\n$$\nA \\frac{\\alpha-b}{(\\alpha+b)^2} + B \\frac{\\beta-b}{(\\beta+b)^2} = 0\n$$\nNow, we substitute the given numerical values:\n$$\n1.5 \\frac{1.0-b}{(1.0+b)^2} + 0.5 \\frac{4.0-b}{(4.0+b)^2} = 0\n$$\nTo simplify, we multiply the equation by $2$:\n$$\n3 \\frac{1-b}{(1+b)^2} + \\frac{4-b}{(4+b)^2} = 0\n$$\nTo solve for $b$, we clear the denominators:\n$$\n3(1-b)(4+b)^2 + (4-b)(1+b)^2 = 0\n$$\nExpanding the squared terms: $(4+b)^2 = 16+8b+b^2$ and $(1+b)^2 = 1+2b+b^2$.\n$$\n3(1-b)(16+8b+b^2) + (4-b)(1+2b+b^2) = 0\n$$\n$$\n3(16+8b+b^2-16b-8b^2-b^3) + (4+8b+4b^2-b-2b^2-b^3) = 0\n$$\n$$\n3(16-8b-7b^2-b^3) + (4+7b+2b^2-b^3) = 0\n$$\n$$\n48 - 24b - 21b^2 - 3b^3 + 4 + 7b + 2b^2 - b^3 = 0\n$$\nCombining like terms yields a cubic equation for $b$:\n$$\n-4b^3 - 19b^2 - 17b + 52 = 0\n$$\nOr, multiplying by $-1$:\n$$\n4b^3 + 19b^2 + 17b - 52 = 0\n$$\nWe seek the positive real root of this polynomial. Let $F(b) = 4b^3 + 19b^2 + 17b - 52$. Evaluating at integer points:\n$F(1) = 4(1)^3 + 19(1)^2 + 17(1) - 52 = 4+19+17-52 = -12$.\n$F(2) = 4(2)^3 + 19(2)^2 + 17(2) - 52 = 32+76+34-52 = 90$.\nSince $F(1) < 0$ and $F(2) > 0$, a root $b^{\\star}$ exists in the interval $(1, 2)$. We can find this root using a numerical method such as Newton's method.\nLet's iterate starting with $b_0 = 1.2$:\n$F(1.2) = 4(1.728) + 19(1.44) + 17(1.2) - 52 = 6.912 + 27.36 + 20.4 - 52 = 54.672 - 52 = 2.672$.\nLet's use a numerical solver or iterative method like Newton's method on the polynomial $P(b) = 4b^3 + 19b^2 + 17b - 52$.\n$P'(b) = 12b^2 + 38b + 17$.\nStarting with $b_0 = 1.2$:\n$P(1.2) = 2.672$.\n$P'(1.2) = 12(1.44) + 38(1.2) + 17 = 17.28 + 45.6 + 17 = 79.88$.\n$b_1 = 1.2 - 2.672/79.88 \\approx 1.2 - 0.03345 = 1.16655$.\nLet's perform another iteration with $b_1 = 1.166$:\n$P(1.166) = 4(1.166)^3 + 19(1.166)^2 + 17(1.166) - 52 \\approx 6.3410 + 25.8316 + 19.822 - 52 \\approx -0.0054$.\nThe value has converged. Rounding to four significant figures gives $b^{\\star} = 1.166$. The units are inherited from $\\alpha$ and $\\beta$, which are $\\text{s}^{-1}$.",
            "answer": "$$\\boxed{1.166}$$"
        },
        {
            "introduction": "A PML that is perfectly absorbing in theory can become catastrophically unstable in practice, especially when implemented on anisotropic grids. This final exercise confronts this critical challenge of numerical stability, a paramount concern in long-running simulations. Using the powerful technique of von Neumann analysis, you will construct the system's discrete update matrix and analyze its eigenvalues to diagnose potential instabilities. This practice not only reveals the subtle mechanisms by which instabilities arise but also explores practical remedies, providing you with the essential tools to build robust and reliable simulation models. ",
            "id": "3339149",
            "problem": "Consider a two-dimensional transverse-electric polarization ($\\mathrm{TE}_z$) Maxwell system in vacuum, discretized on a uniform Yee grid with spatial steps $\\Delta x$ and $\\Delta y$ and time step $\\Delta t$. Let the permittivity and permeability be normalized to $\\varepsilon = 1$ and $\\mu = 1$, so that the speed of light is $c = 1$ in these units. A perfectly matched layer is applied using the stretched-coordinate approach, in which coordinate stretching in each spatial direction is represented by complex stretch coefficients $s_x$ and $s_y$. The semidiscrete form of the $\\mathrm{TE}_z$ equations with stretched-coordinate perfectly matched layer (SC-PML) couplings (no explicit physical conductivity terms) is constructed in a leapfrog manner as follows: the magnetic field components $H_x$ and $H_y$ are updated at half-integer time steps by coupling to the electric field $E_z$ at integer time steps, and the electric field is updated from the magnetic field at the subsequent half step.\n\nDefine the discrete wavenumbers for a plane wave mode by\n$$S_x(\\theta_x) = \\frac{2}{\\Delta x} \\sin\\left(\\theta_x\\right), \\qquad S_y(\\theta_y) = \\frac{2}{\\Delta y} \\sin\\left(\\theta_y\\right),$$\nwith $\\theta_x \\in [0,\\pi]$ and $\\theta_y \\in [0,\\pi]$ representing the Brillouin-zone parameters of the von Neumann modal analysis. The explicit leapfrog update for one time step $\\Delta t$ can be written as a linear map\n$$\\mathbf{u}^{n+1} = \\mathbf{U}(\\theta_x,\\theta_y)\\,\\mathbf{u}^{n},$$\nwhere $\\mathbf{u}^{n} = \\big[H_x^{n-\\frac{1}{2}},\\,H_y^{n-\\frac{1}{2}},\\,E_z^{n}\\big]^\\top$, and $\\mathbf{U}(\\theta_x,\\theta_y)$ depends on the choice of how the stretch coefficients are sampled on the staggered grid. In the \"naive\" sampling, one uses the same $s_x$ and $s_y$ everywhere. In a \"staggered-stretch\" sampling, one uses effective couplings for the electric-field update that include factors accounting for the spatial staggering, so that the $E_z$ update uses\n$$\\frac{S_x(\\theta_x)}{s_x}\\cos\\left(\\theta_y\\right) \\quad \\text{and} \\quad \\frac{S_y(\\theta_y)}{s_y}\\cos\\left(\\theta_x\\right)$$\nin place of $S_x(\\theta_x)/s_x$ and $S_y(\\theta_y)/s_y$. Finally, consider an optional spectral high-frequency filter that multiplies the modal update by a scalar factor\n$$g(\\theta_x,\\theta_y) = 1 - \\beta\\left[\\sin^4(\\theta_x) + \\sin^4(\\theta_y)\\right],$$\nwith $\\beta \\ge 0$, applied uniformly to the updated state to damp grid-scale anisotropic modes.\n\nStarting from Maxwell’s equations and the Yee-grid leapfrog discretization, construct the explicit $3\\times 3$ update matrix $\\mathbf{U}(\\theta_x,\\theta_y)$ for the $\\mathrm{TE}_z$ mode in vacuum with SC-PML couplings, for both naive sampling and staggered-stretch sampling. Using a discrete von Neumann analysis, define the modal spectral radius\n$$\\rho_{\\max} = \\max_{\\theta_x \\in [0,\\pi],\\,\\theta_y \\in [0,\\pi]} \\rho\\left(\\mathbf{U}(\\theta_x,\\theta_y)\\right),$$\nwhere $\\rho(\\cdot)$ denotes the spectral radius (the maximum absolute value of the eigenvalues). For the filtered case, the effective update matrix is $\\mathbf{U}_\\mathrm{filt}(\\theta_x,\\theta_y) = g(\\theta_x,\\theta_y)\\,\\mathbf{U}(\\theta_x,\\theta_y)$, and its spectral radius is computed analogously. The SC-PML is considered discretely energy-decaying if $\\rho_{\\max}  1$.\n\nYour task is to:\n\n- Derive the explicit form of $\\mathbf{U}(\\theta_x,\\theta_y)$ from first principles, starting at Maxwell’s curl equations and the Yee leapfrog scheme, showing how $S_x(\\theta_x)$, $S_y(\\theta_y)$ and $s_x, s_y$ enter into the couplings.\n- Explain how grid anisotropy (i.e., $\\Delta x \\ne \\Delta y$) can lead to $\\rho_{\\max} \\ge 1$ at fixed $\\Delta t$ for naive sampling, and how staggered-stretch sampling or the spectral filter can restore $\\rho_{\\max}  1$.\n\nWe adopt normalized, dimensionless units throughout (no physical units are required in the output). Implement a program that computes $\\rho_{\\max}$ by scanning a uniform grid of $\\theta_x$ and $\\theta_y$ values over $[0,\\pi]$ for each of the following test cases:\n\n- Test Case 1 (happy path): isotropic grid, naive SC-PML sampling. Parameters: $\\Delta x = 1$, $\\Delta y = 1$, $\\Delta t = 0.5$, $s_x = 1 + 0.1j$, $s_y = 1 + 0.1j$, no filter ($\\beta = 0$).\n- Test Case 2 (anisotropy stress): anisotropic grid, naive SC-PML sampling. Parameters: $\\Delta x = 0.2$, $\\Delta y = 1$, $\\Delta t = 0.5$, $s_x = 1 + 0.1j$, $s_y = 1 + 0.1j$, no filter ($\\beta = 0$).\n- Test Case 3 (staggered-stretch remedy): anisotropic grid with staggered-stretch SC-PML sampling. Parameters: same as Test Case 2, but use the staggered-stretch couplings in the $E_z$ update as described above, no filter ($\\beta = 0$).\n- Test Case 4 (spectral filter remedy): anisotropic grid, naive SC-PML sampling, with filter. Parameters: same as Test Case 2, but apply the spectral filter with $\\beta = 0.9$.\n\nFor each test case, compute $\\rho_{\\max}$ as a floating-point number. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), with each result being the corresponding $\\rho_{\\max}$ for the test cases in the order listed above. No external input is required, and the program must be self-contained and runnable as is. The solution must rely solely on the specified runtime environment and libraries.",
            "solution": "The user wants to analyze the stability of a 2D FDTD scheme for TEz waves with a stretched-coordinate perfectly matched layer (SC-PML). This involves:\n1.  Deriving the $3 \\times 3$ modal update matrix $\\mathbf{U}(\\theta_x, \\theta_y)$ from first principles.\n2.  Explaining the sources of numerical instability and the mechanisms of the proposed remedies.\n3.  Implementing a program to calculate the maximum spectral radius $\\rho_{\\max}$ for four specific test cases.\n\n### Part 1: Derivation of the Update Matrix\n\nWe begin with Maxwell's equations for a transverse-electric ($\\mathrm{TE}_z$) wave in a 2D source-free medium, incorporating the stretched-coordinate PML formulation. The field components are $E_z$, $H_x$, and $H_y$. The governing equations are:\n$$\n\\frac{\\partial H_x}{\\partial t} = -\\frac{1}{\\mu s_y} \\frac{\\partial E_z}{\\partial y}\n$$\n$$\n\\frac{\\partial H_y}{\\partial t} = \\frac{1}{\\mu s_x} \\frac{\\partial E_z}{\\partial x}\n$$\n$$\n\\frac{\\partial E_z}{\\partial t} = \\frac{1}{\\varepsilon s_x} \\frac{\\partial H_y}{\\partial x} - \\frac{1}{\\varepsilon s_y} \\frac{\\partial H_x}{\\partial y}\n$$\nIn the problem, we use normalized units where $\\varepsilon=1$ and $\\mu=1$. The complex stretch coefficients are $s_x$ and $s_y$. We discretize these equations using a leapfrog time-stepping scheme on a Yee grid with time step $\\Delta t$:\n$$\n\\frac{H_x^{n+1/2} - H_x^{n-1/2}}{\\Delta t} = - \\frac{1}{s_y} \\left( \\frac{\\partial E_z}{\\partial y} \\right)^n\n$$\n$$\n\\frac{H_y^{n+1/2} - H_y^{n-1/2}}{\\Delta t} = \\frac{1}{s_x} \\left( \\frac{\\partial E_z}{\\partial x} \\right)^n\n$$\n$$\n\\frac{E_z^{n+1} - E_z^n}{\\Delta t} = \\frac{1}{s_x} \\left( \\frac{\\partial H_y}{\\partial x} \\right)^{n+1/2} - \\frac{1}{s_y} \\left( \\frac{\\partial H_x}{\\partial y} \\right)^{n+1/2}\n$$\nTo perform a von Neumann stability analysis, we assume plane-wave solutions of the form $F(j\\Delta x, l\\Delta y, n\\Delta t) = \\tilde{F} e^{i(k_x j \\Delta x + k_y l \\Delta y)}$, where $\\tilde{F}$ is the modal amplitude. The spatial derivative operators, when acting on these modes, become multiplications by complex factors. The problem defines the magnitudes of these factors as $S_x(\\theta_x) = \\frac{2}{\\Delta x} \\sin(\\theta_x)$ and $S_y(\\theta_y) = \\frac{2}{\\Delta y} \\sin(\\theta_y)$, where $\\theta_x = k_x \\Delta x$ and $\\theta_y = k_y \\Delta y$. The centered finite difference operators on the Yee grid correspond to multiplication by $iS_x$ and $iS_y$. Note that these definitions of $S_x$ and $S_y$ are non-standard for Yee-grid FDTD, but we must adhere to the problem statement.\n\nThe discretized equations in the modal (Fourier) domain become:\n$$\n\\tilde{H}_x^{n+1/2} = \\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\n$$\n$$\n\\tilde{H}_y^{n+1/2} = \\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\n$$\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x}{s_x} \\tilde{H}_y^{n+1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{H}_x^{n+1/2}\n$$\nThe state vector is defined as $\\mathbf{u}^n = [\\tilde{H}_x^{n-1/2}, \\tilde{H}_y^{n-1/2}, \\tilde{E}_z^n]^\\top$. We seek the update matrix $\\mathbf{U}$ such that $\\mathbf{u}^{n+1} = \\mathbf{U} \\mathbf{u}^n$, where $\\mathbf{u}^{n+1} = [\\tilde{H}_x^{n+1/2}, \\tilde{H}_y^{n+1/2}, \\tilde{E}_z^{n+1}]^\\top$.\n\nThe first two rows of $\\mathbf{U}$ can be written directly from the $H$-field updates. For the third row, we substitute the expressions for $\\tilde{H}_x^{n+1/2}$ and $\\tilde{H}_y^{n+1/2}$ into the $\\tilde{E}_z$ update equation:\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x}{s_x} \\left(\\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\\right) - \\frac{i \\Delta t S_y}{s_y} \\left(\\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\\right)\n$$\nGrouping terms by the components of $\\mathbf{u}^n$:\n$$\n\\tilde{E}_z^{n+1} = \\left(-\\frac{i \\Delta t S_y}{s_y}\\right) \\tilde{H}_x^{n-1/2} + \\left(\\frac{i \\Delta t S_x}{s_x}\\right) \\tilde{H}_y^{n-1/2} + \\left(1 - (\\Delta t)^2\\left[\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right]\\right) \\tilde{E}_z^n\n$$\n\n#### Naive Sampling\nFor naive sampling, the above derivation holds directly. The update matrix $\\mathbf{U}_{\\text{naive}}$ is:\n$$\n\\mathbf{U}_{\\text{naive}} = \n\\begin{pmatrix}\n1  0  -\\frac{i \\Delta t S_y}{s_y} \\\\\n0  1  \\frac{i \\Delta t S_x}{s_x} \\\\\n-\\frac{i \\Delta t S_y}{s_y}  \\frac{i \\Delta t S_x}{s_x}  1 - (\\Delta t)^2\\left(\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right)\n\\end{pmatrix}\n$$\nThis matrix is symmetric.\n\n#### Staggered-Stretch Sampling\nIn this scheme, the $H$-field updates remain unchanged, but the $E_z$ update coupling terms are modified as specified: $\\frac{S_x}{s_x} \\to \\frac{S_x \\cos(\\theta_y)}{s_x}$ and $\\frac{S_y}{s_y} \\to \\frac{S_y \\cos(\\theta_x)}{s_y}$. Applying these substitutions only to the initial $E_z$ update equation:\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x} \\tilde{H}_y^{n+1/2} - \\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y} \\tilde{H}_x^{n+1/2}\n$$\nWe substitute the unmodified $H$-field updates into this modified $E_z$ update:\n$$\n\\tilde{E}_z^{n+1} = \\tilde{E}_z^n + \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x} \\left(\\tilde{H}_y^{n-1/2} + \\frac{i \\Delta t S_x}{s_x} \\tilde{E}_z^n\\right) - \\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y} \\left(\\tilde{H}_x^{n-1/2} - \\frac{i \\Delta t S_y}{s_y} \\tilde{E}_z^n\\right)\n$$\nThe coefficient of $\\tilde{E}_z^n$ becomes $1 - (\\Delta t)^2\\left(\\frac{S_x^2 \\cos(\\theta_y)}{s_x^2} + \\frac{S_y^2 \\cos(\\theta_x)}{s_y^2}\\right)$. The coefficients of the $H$-fields also change. The resulting update matrix $\\mathbf{U}_{\\text{stag}}$ is:\n$$\n\\mathbf{U}_{\\text{stag}} = \n\\begin{pmatrix}\n1  0  -\\frac{i \\Delta t S_y}{s_y} \\\\\n0  1  \\frac{i \\Delta t S_x}{s_x} \\\\\n-\\frac{i \\Delta t S_y \\cos(\\theta_x)}{s_y}  \\frac{i \\Delta t S_x \\cos(\\theta_y)}{s_x}  1 - (\\Delta t)^2\\left(\\frac{S_x^2 \\cos(\\theta_y)}{s_x^2} + \\frac{S_y^2 \\cos(\\theta_x)}{s_y^2}\\right)\n\\end{pmatrix}\n$$\nThis matrix is not symmetric due to the $\\cos(\\theta_x)$ and $\\cos(\\theta_y)$ factors appearing only in the third row.\n\n### Part 2: Instability and Remedies\n\nThe stability of the scheme is determined by the spectral radius of the update matrix, $\\rho(\\mathbf{U}) = \\max_i |\\lambda_i|$. If $\\rho(\\mathbf{U}) > 1$ for any mode $(\\theta_x, \\theta_y)$, the scheme is unstable. The eigenvalues $\\lambda$ of $\\mathbf{U}_{\\text{naive}}$ are the roots of the characteristic polynomial. One eigenvalue is always $\\lambda=1$, corresponding to a static field mode. The other two eigenvalues are roots of the quadratic equation:\n$$\n\\lambda^2 - (2 - \\Omega^2)\\lambda + 1 = 0, \\quad \\text{where} \\quad \\Omega^2 = (\\Delta t)^2 \\left(\\frac{S_x^2}{s_x^2} + \\frac{S_y^2}{s_y^2}\\right)\n$$\nIn the absence of PML ($s_x=s_y=1$), $\\Omega^2$ is real and positive, and the condition for stability ($|\\lambda|\\le 1$) reduces to the Courant-Friedrichs-Lewy (CFL) condition, $|\\Omega| \\le 2$.\n\n**Anisotropy-Induced Instability**: When a PML is introduced ($s_x, s_y$ are complex) on an anisotropic grid ($\\Delta x \\neq \\Delta y$), the term $\\Omega^2$ becomes complex. The spatial anisotropy means the maximum values of $S_x \\propto 1/\\Delta x$ and $S_y \\propto 1/\\Delta y$ can be very different. For modes propagating at certain angles, particularly high-frequency modes where $S_x$ or $S_y$ are large, the interaction between the discretization and the PML can lead to a violation of passivity, causing $|\\lambda|>1$. The naive sampling scheme is known to be susceptible to such instabilities, because it does not correctly model the behavior of a continuously passive PML medium on the staggered discrete grid. The instability is most pronounced for modes where one wavenumber component is large and the other is small, a condition exacerbated by grid anisotropy.\n\n**Staggered-Stretch Remedy**: The prescribed staggered-stretch scheme modifies the coupling terms in the $E_z$ update. The factors $\\cos(\\theta_x)$ and $\\cos(\\theta_y)$ act as dampers. For instance, consider a mode with large $\\theta_x \\approx \\pi/2$ (a high-frequency component in $x$) and small $\\theta_y \\approx 0$ (a low-frequency component in $y$). The naive scheme might be unstable here. The staggered scheme multiplies the $S_y$ term by $\\cos(\\theta_x) \\approx 0$ and the $S_x$ term by $\\cos(\\theta_y) \\approx 1$. This selectively dampens certain interactions and can potentially restore stability by altering the eigenvalues of the update matrix for problematic modes. Although the formulation given does not correspond to standard, provably stable methods like CPML, it is designed to mitigate the effect of large wavenumber components.\n\n**Spectral Filter Remedy**: The filter applies a multiplicative factor $g(\\theta_x, \\theta_y) = 1 - \\beta(\\sin^4\\theta_x + \\sin^4\\theta_y)$ to the entire updated state vector. The effective spectral radius becomes $\\rho_{\\text{filt}} = |g(\\theta_x,\\theta_y)|\\,\\rho(\\mathbf{U})$. An instability occurs where $\\rho(\\mathbf{U}) > 1$. The filter can restore stability if $|g|$ is small enough in these regions to force $|g|\\rho(\\mathbf{U})  1$. The instability in naive PML often occurs for high-frequency modes. The specified filter applies maximum damping at $\\theta_x=\\pi/2$ and $\\theta_y=\\pi/2$, where $\\sin\\theta_x, \\sin\\theta_y$ are maximal and correspondingly $S_x, S_y$ are maximal. By reducing the magnitude of the eigenvalues for these problematic modes, the filter can suppress the numerical growth and ensure $\\rho_{\\max}  1$.",
            "answer": "```python\nimport numpy as np\n\ndef compute_rho_max(dx, dy, dt, sx, sy, beta, sampling_type):\n    \"\"\"\n    Computes the maximum spectral radius of the FDTD update matrix.\n\n    Args:\n        dx (float): Grid spacing in x.\n        dy (float): Grid spacing in y.\n        dt (float): Time step.\n        sx (complex): PML stretch coefficient in x.\n        sy (complex): PML stretch coefficient in y.\n        beta (float): Spectral filter coefficient.\n        sampling_type (str): 'naive' or 'staggered'.\n\n    Returns:\n        float: The maximum spectral radius over the Brillouin zone.\n    \"\"\"\n    # Create a grid for the Brillouin zone parameters theta_x, theta_y\n    # A 201x201 grid is a reasonable balance of accuracy and speed.\n    n_points = 201\n    theta_vals = np.linspace(0, np.pi, n_points)\n    thx_grid, thy_grid = np.meshgrid(theta_vals, theta_vals)\n\n    # Calculate discrete wavenumber magnitudes S_x and S_y\n    # Using the definition from the problem statement.\n    Sx = (2.0 / dx) * np.sin(thx_grid)\n    Sy = (2.0 / dy) * np.sin(thy_grid)\n\n    # Initialize the update matrix U\n    U = np.zeros((n_points, n_points, 3, 3), dtype=np.complex128)\n\n    # Fill the first two rows, common to both sampling schemes\n    U[:, :, 0, 0] = 1.0\n    U[:, :, 1, 1] = 1.0\n    U[:, :, 0, 2] = -1j * dt * Sy / sy\n    U[:, :, 1, 2] = 1j * dt * Sx / sx\n\n    # Fill the third row based on the sampling type\n    if sampling_type == 'naive':\n        U[:, :, 2, 0] = -1j * dt * Sy / sy\n        U[:, :, 2, 1] = 1j * dt * Sx / sx\n        U[:, :, 2, 2] = 1.0 - dt**2 * (Sx**2 / sx**2 + Sy**2 / sy**2)\n    elif sampling_type == 'staggered':\n        cos_thx = np.cos(thx_grid)\n        cos_thy = np.cos(thy_grid)\n        U[:, :, 2, 0] = -1j * dt * Sy * cos_thx / sy\n        U[:, :, 2, 1] = 1j * dt * Sx * cos_thy / sx\n        U[:, :, 2, 2] = 1.0 - dt**2 * (Sx**2 * cos_thy / sx**2 + Sy**2 * cos_thx / sy**2)\n\n    # Calculate eigenvalues for each point in the theta grid\n    # The numpy stacking and linalg.eigvals is vectorized for efficiency.\n    # U is (N, N, 3, 3), we reshape to (N*N, 3, 3) and then transpose\n    # for eigvals which expects the last two dimensions to be the matrices.\n    eigvals = np.linalg.eigvals(U.reshape(-1, 3, 3))\n\n    # Calculate the spectral radius for each mode\n    rho_grid = np.max(np.abs(eigvals), axis=1).reshape(n_points, n_points)\n\n    # Apply the spectral filter if beta  0\n    if beta  0:\n        g = 1.0 - beta * (np.sin(thx_grid)**4 + np.sin(thy_grid)**4)\n        rho_grid *= np.abs(g)\n\n    # Find the maximum spectral radius over all modes\n    max_rho = np.max(rho_grid)\n    \n    return max_rho\n\ndef solve():\n    \"\"\"\n    Solves the problem for the four specified test cases.\n    \"\"\"\n    test_cases = [\n        # TC1: Isotropic, naive\n        {'dx': 1.0, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'naive'},\n        # TC2: Anisotropic, naive\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'naive'},\n        # TC3: Anisotropic, staggered-stretch\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.0, 'sampling_type': 'staggered'},\n        # TC4: Anisotropic, naive, with filter\n        {'dx': 0.2, 'dy': 1.0, 'dt': 0.5, 'sx': 1 + 0.1j, 'sy': 1 + 0.1j, 'beta': 0.9, 'sampling_type': 'naive'}\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_max = compute_rho_max(**case)\n        results.append(rho_max)\n    \n    # Format the final output as specified\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}