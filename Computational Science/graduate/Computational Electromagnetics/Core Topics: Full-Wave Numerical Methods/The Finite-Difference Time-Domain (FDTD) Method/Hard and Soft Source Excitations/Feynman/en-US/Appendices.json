{
    "hands_on_practices": [
        {
            "introduction": "This practice grounds the abstract concepts of hard and soft sources in the familiar language of circuit theory. By deriving the impedance extraction formulas for Thévenin (hard) and Norton (soft) equivalent sources, you will solidify your understanding of how these models are implemented in computational solvers for practical tasks like port de-embedding. This exercise  bridges the gap between theoretical source definitions and their application in extracting device characteristics.",
            "id": "3313071",
            "problem": "You are modeling a single-port terminal in a linear, time-harmonic full-wave computational solver using circuit embeddings. The port is excited in two different ways that correspond to two classic equivalent source models: a hard source corresponding to a Thévenin representation and a soft source corresponding to a Norton representation. The solver is assumed to be linear and time-invariant in the frequency domain, and the device under test is characterized at the port by an input impedance function denoted by $Z_{in}(\\omega)$ at angular frequency $\\omega$. The port series impedance is denoted by $Z_{s}$ and is taken to be real and positive.\n\nStarting only from the linear circuit laws of Kirchhoff and the definition that the port terminal quantities satisfy $V(\\omega) = Z_{in}(\\omega)\\,I(\\omega)$ for a one-port, derive explicit expressions for extracting $Z_{in}(\\omega)$ in each of the following two excitation modes:\n- Hard (Thévenin) excitation: a voltage source of phasor amplitude $V_{s}$ in series with $Z_{s}$. Assume that the solver directly returns the complex phasor current into the device, denoted by $I_{meas}$, when driven by the hard source.\n- Soft (Norton) excitation: a current source of phasor amplitude $I_{s}$ in parallel with $Z_{s}$. Assume that the solver directly returns the complex phasor voltage across the device, denoted by $V_{meas}$, when driven by the soft source.\n\nUse the above to obtain, from first principles, formulas that compute $Z_{in}(\\omega)$ purely from the measurable pairs $\\{V_{s}, I_{meas}\\}$ and $\\{I_{s}, V_{meas}\\}$ and the known $Z_{s}$, respectively. Provide a concise justification of why each formula is correct by applying Kirchhoff’s Voltage Law and Kirchhoff’s Current Law to the corresponding equivalent source connection.\n\nThen, implement a program that, for a specified test suite, constructs synthetic solver measurements using the true $Z_{in}(\\omega)$ in each case and then applies your derived extraction formulas to recover estimates $\\widehat{Z}_{in}(\\omega)$ under both excitations. For each test case, compute the dimensionless relative magnitude error for each excitation mode, defined as\n$$\n\\varepsilon = \\frac{\\left|\\widehat{Z}_{in} - Z_{in}\\right|}{\\max\\!\\left(1,\\left|Z_{in}\\right|\\right)}.\n$$\nThe final outputs are these error values. No physical units are required for the outputs because $\\varepsilon$ is dimensionless.\n\nUse the following fixed source and port parameters in all test cases:\n- Source impedance: $Z_{s} = 50\\,\\Omega$.\n- Thévenin source amplitude: $V_{s} = 1\\,\\mathrm{V}$.\n- Norton source amplitude chosen to be the exact Norton equivalent of the above: $I_{s} = V_{s}/Z_{s}$.\n\nUse the following test suite of six device-under-test scenarios (each defines the true $Z_{in}$ used to generate synthetic measurements):\n\n- Case $1$ (matched resistive load): $Z_{in} = 50\\,\\Omega$.\n- Case $2$ (near-open circuit): $Z_{in} = 10^{9}\\,\\Omega$.\n- Case $3$ (near-short circuit): $Z_{in} = 10^{-9}\\,\\Omega$.\n- Case $4$ (series R-L-C away from resonance): $Z_{in}(\\omega) = R + j\\left(\\omega L - \\dfrac{1}{\\omega C}\\right)$ with $R = 10\\,\\Omega$, $L = 100\\,\\mathrm{nH}$, $C = 10\\,\\mathrm{pF}$, and frequency $f = 100\\,\\mathrm{MHz}$, so $\\omega = 2\\pi f$.\n- Case $5$ (series R-L-C at resonance): same $R$, $L$, $C$ as Case $4$ and frequency $f = \\dfrac{1}{2\\pi\\sqrt{LC}}$, so that the reactive part cancels and $Z_{in} = R$.\n- Case $6$ (series R-L-C above resonance): same $R$, $L$, $C$ as Case $4$ and frequency $f = 300\\,\\mathrm{MHz}$, so $\\omega = 2\\pi f$.\n\nFor each case, proceed as follows:\n- Generate synthetic solver measurements under hard (Thévenin) excitation by computing the phasor current $I_{meas}$ that flows into the device when driven by $V_{s}$ in series with $Z_{s}$.\n- Generate synthetic solver measurements under soft (Norton) excitation by computing the phasor voltage $V_{meas}$ across the device when driven by $I_{s}$ in parallel with $Z_{s}$.\n- Apply your derived formulas to obtain $\\widehat{Z}_{in}$ separately for the hard and soft excitations.\n- Compute the error metric $\\varepsilon$ for each excitation.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[\\varepsilon_{\\text{hard},1},\\varepsilon_{\\text{soft},1},\\varepsilon_{\\text{hard},2},\\varepsilon_{\\text{soft},2},\\ldots,\\varepsilon_{\\text{hard},6},\\varepsilon_{\\text{soft},6}\\right].\n$$\nAll intermediate physical quantities must be handled in the International System of Units (SI), but the output errors are dimensionless and require no units. Angles, where applicable, are in radians. The program must be self-contained and require no user input. Ensure numerical stability in cases where denominators approach zero by relying on the exact values specified above, which keep all divisions well-defined for the given finite near-open and near-short cases. No additional rounding is required in the output.",
            "solution": "The problem requires the derivation of formulas to extract the input impedance $Z_{in}(\\omega)$ of a one-port device under two different excitation schemes in a computational solver: a hard (Thévenin) source and a soft (Norton) source. This derivation must be based on first principles, namely Kirchhoff's circuit laws. Subsequently, a numerical validation is to be performed by implementing these formulas to recover $Z_{in}(\\omega)$ from synthetically generated measurement data, and the accuracy is to be quantified using a specified error metric $\\varepsilon$.\n\nThe analysis is conducted in the frequency domain using complex phasors for all time-harmonic electrical quantities (voltage and current). The device under test is characterized by its input impedance $Z_{in}(\\omega)$, which relates the phasor voltage $V(\\omega)$ across its terminals to the phasor current $I(\\omega)$ flowing into it via the relation $V(\\omega) = Z_{in}(\\omega) I(\\omega)$. The source impedance $Z_s$ is given as a real, positive quantity.\n\n### Derivation for Hard (Thévenin) Excitation\n\nThe hard source excitation is modeled by a Thévenin equivalent circuit. This consists of an ideal voltage source with phasor amplitude $V_s$ in series with the source impedance $Z_s$. This series combination is connected to the terminals of the device under test, which presents the load impedance $Z_{in}$. The entire circuit forms a single closed loop.\n\nThe solver is stated to return the complex phasor current $I_{meas}$ flowing into the device. In this series circuit, the same current flows through all components. To derive the formula for $Z_{in}$, we apply Kirchhoff's Voltage Law (KVL), which states that the sum of the voltage rises and drops around any closed loop must be zero.\n\nApplying KVL to the loop, we equate the source voltage to the sum of the voltage drops across the source impedance and the input impedance:\n$$V_s = V_{Z_s} + V_{Z_{in}}$$\nwhere $V_{Z_s}$ is the voltage drop across $Z_s$ and $V_{Z_{in}}$ is the voltage drop across $Z_{in}$.\n\nUsing Ohm's Law for each component (in phasor form), the voltage drops are given by:\n$$V_{Z_s} = I_{meas} Z_s$$\n$$V_{Z_{in}} = I_{meas} Z_{in}$$\n\nSubstituting these expressions into the KVL equation yields:\n$$V_s = I_{meas} Z_s + I_{meas} Z_{in}$$\n\nOur objective is to solve for $Z_{in}$. We can rearrange the equation by isolating the term containing $Z_{in}$:\n$$I_{meas} Z_{in} = V_s - I_{meas} Z_s$$\n\nDividing by $I_{meas}$ (which must be non-zero for any finite load impedance), we obtain the expression for $Z_{in}$. The resulting formula for the estimated impedance, $\\widehat{Z}_{in}$, is:\n$$\\widehat{Z}_{in} = \\frac{V_s}{I_{meas}} - Z_s$$\nThis formula correctly allows for the extraction of the device impedance $Z_{in}$ from the known source parameters $V_s$ and $Z_s$, and the \"measured\" current $I_{meas}$.\n\n### Derivation for Soft (Norton) Excitation\n\nThe soft source excitation is modeled by a Norton equivalent circuit. This consists of an ideal current source with phasor amplitude $I_s$ in parallel with the source impedance $Z_s$. This parallel source combination is then connected to the device under test, $Z_{in}$, which is also in parallel with the source elements.\n\nThe solver is stated to return the complex phasor voltage $V_{meas}$ across the device. In this parallel circuit configuration, the voltage across each of the three parallel branches (the current source, $Z_s$, and $Z_{in}$) is the same, and is equal to $V_{meas}$.\n\nTo derive the formula for $Z_{in}$, we apply Kirchhoff's Current Law (KCL) at either of the two nodes connecting the parallel elements. KCL states that the sum of currents entering a node must equal the sum of currents leaving it. The current $I_s$ from the source splits into two paths: one through the source impedance $Z_s$, denoted $I_{Z_s}$, and the other into the device under test, $Z_{in}$, denoted $I_{Z_{in}}$.\n\nThe KCL equation at the top node is:\n$$I_s = I_{Z_s} + I_{Z_{in}}$$\n\nUsing Ohm's Law for each parallel branch, we can express the currents $I_{Z_s}$ and $I_{Z_{in}}$ in terms of the common voltage $V_{meas}$:\n$$I_{Z_s} = \\frac{V_{meas}}{Z_s}$$\n$$I_{Z_{in}} = \\frac{V_{meas}}{Z_{in}}$$\n\nSubstituting these expressions into the KCL equation gives:\n$$I_s = \\frac{V_{meas}}{Z_s} + \\frac{V_{meas}}{Z_{in}}$$\n\nTo solve for $Z_{in}$, we rearrange the equation to isolate the term with $Z_{in}$:\n$$\\frac{V_{meas}}{Z_{in}} = I_s - \\frac{V_{meas}}{Z_s}$$\n\nTaking the reciprocal of both sides to solve for $Z_{in}$ yields the final extraction formula for the estimated impedance, $\\widehat{Z}_{in}$:\n$$\\widehat{Z}_{in} = \\frac{1}{\\frac{I_s}{V_{meas}} - \\frac{1}{Z_s}}$$\nAn alternative algebraic form is $\\widehat{Z}_{in} = V_{meas} / (I_s - V_{meas}/Z_s)$. This formula allows the extraction of $Z_{in}$ from the known source parameters $I_s$ and $Z_s$, and the \"measured\" voltage $V_{meas}$. The problem specifies that $I_s = V_s/Z_s$, establishing the Thévenin-Norton equivalence between the two sources.\n\n### Numerical Validation Procedure\n\nThe problem requires a program to validate these derivations. The procedure for each test case involves two main steps:\n\n$1$. **Synthesis of Measurements**: For a given \"true\" impedance $Z_{in, \\text{true}}$, the ideal solver outputs ($I_{meas}$ and $V_{meas}$) are calculated.\n    - For the hard source, the total impedance of the series circuit is $Z_{tot} = Z_s + Z_{in, \\text{true}}$. The current is found using Ohm's law: $I_{meas} = V_s / (Z_s + Z_{in, \\text{true}})$.\n    - For the soft source, the two parallel impedances $Z_s$ and $Z_{in, \\text{true}}$ have an equivalent impedance $Z_{eq} = (Z_s^{-1} + Z_{in, \\text{true}}^{-1})^{-1}$. The voltage is found using Ohm's law: $V_{meas} = I_s \\cdot Z_{eq}$.\n\n$2$. **Extraction and Error Calculation**: The derived formulas are used to calculate the estimated impedances $\\widehat{Z}_{in, \\text{hard}}$ and $\\widehat{Z}_{in, \\text{soft}}$ from the synthesized measurements.\n    - $\\widehat{Z}_{in, \\text{hard}} = V_s/I_{meas} - Z_s$\n    - $\\widehat{Z}_{in, \\text{soft}} = 1 / (I_s/V_{meas} - 1/Z_s)$\n    In ideal arithmetic, $\\widehat{Z}_{in} = Z_{in, \\text{true}}$. The numerical error $\\varepsilon$, arising from finite-precision floating-point arithmetic, is then calculated for each excitation type using the given formula:\n    $$\\varepsilon = \\frac{\\left|\\widehat{Z}_{in} - Z_{in, \\text{true}}\\right|}{\\max\\!\\left(1,\\left|Z_{in, \\text{true}}\\right|\\right)}$$\nThis process is repeated for all specified test cases. The results will demonstrate that the derived formulas correctly recover the input impedance, with errors being close to machine precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and validates impedance extraction formulas for hard and soft\n    source excitations in a computational electromagnetics context.\n    \"\"\"\n    # Define fixed source and port parameters\n    Z_s = 50.0  # Source impedance in Ohms\n    V_s = 1.0   # Thévenin source voltage in Volts\n    I_s = V_s / Z_s  # Norton source current in Amperes\n\n    # Define a complex unit for convenience\n    j = 1j\n\n    # Define test cases for the device under test (DUT)\n    # Each case is a tuple (name, function_to_calculate_Zin)\n    \n    def get_case1_zin():\n        # Case 1: Matched resistive load\n        return 50.0\n\n    def get_case2_zin():\n        # Case 2: Near-open circuit\n        return 1e9\n\n    def get_case3_zin():\n        # Case 3: Near-short circuit\n        return 1e-9\n\n    def get_case4_zin():\n        # Case 4: Series R-L-C away from resonance\n        R, L, C = 10.0, 100e-9, 10e-12\n        f = 100e6  # 100 MHz\n        omega = 2 * np.pi * f\n        return R + j * (omega * L - 1 / (omega * C))\n\n    def get_case5_zin():\n        # Case 5: Series R-L-C at resonance\n        R, L, C = 10.0, 100e-9, 10e-12\n        # At resonance, omega*L = 1/(omega*C), so reactive part is zero\n        f_res = 1 / (2 * np.pi * np.sqrt(L * C))\n        omega_res = 2 * np.pi * f_res\n        return R + j * (omega_res * L - 1 / (omega_res * C)) # Should be R\n\n    def get_case6_zin():\n        # Case 6: Series R-L-C above resonance\n        R, L, C = 10.0, 100e-9, 10e-12\n        f = 300e6  # 300 MHz\n        omega = 2 * np.pi * f\n        return R + j * (omega * L - 1 / (omega * C))\n\n    test_cases_funcs = [\n        get_case1_zin, get_case2_zin, get_case3_zin,\n        get_case4_zin, get_case5_zin, get_case6_zin,\n    ]\n\n    results = []\n\n    for get_zin_func in test_cases_funcs:\n        # Get the true impedance for the current test case\n        Z_in_true = get_zin_func()\n        \n        # In case 5, ensure it's purely real due to potential floating point inaccuracies\n        if get_zin_func.__name__ == 'get_case5_zin':\n            Z_in_true = np.real(Z_in_true)\n\n        # --- Hard (Thévenin) Source Simulation ---\n        # 1. Synthesize the \"measured\" current I_meas\n        # For a series circuit: I = V_total / Z_total\n        I_meas = V_s / (Z_s + Z_in_true)\n\n        # 2. Extract the impedance using the derived formula\n        # Z_in_hat = V_s / I_meas - Z_s\n        Z_in_hat_hard = V_s / I_meas - Z_s\n\n        # 3. Calculate the relative magnitude error\n        err_mag_hard = np.abs(Z_in_hat_hard - Z_in_true)\n        denominator = np.maximum(1.0, np.abs(Z_in_true))\n        eps_hard = err_mag_hard / denominator\n        results.append(eps_hard)\n\n        # --- Soft (Norton) Source Simulation ---\n        # 1. Synthesize the \"measured\" voltage V_meas\n        # For parallel circuit: V = I_total * Z_equivalent\n        # Z_eq = 1 / (1/Z_s + 1/Z_in)\n        if Z_in_true == 0:\n            Z_eq_soft = 0.0\n        else:\n            Z_eq_soft = 1.0 / (1.0/Z_s + 1.0/Z_in_true)\n        V_meas = I_s * Z_eq_soft\n\n        # 2. Extract the impedance using the derived formula\n        # Z_in_hat = 1 / (I_s/V_meas - 1/Z_s)\n        # Handle V_meas=0 edge case for perfect short\n        if V_meas == 0:\n            Z_in_hat_soft = 0.0\n        else:\n            Z_in_hat_soft = 1.0 / (I_s / V_meas - 1.0 / Z_s)\n\n        # 3. Calculate the relative magnitude error\n        err_mag_soft = np.abs(Z_in_hat_soft - Z_in_true)\n        # Denominator is the same as for the hard source case\n        eps_soft = err_mag_soft / denominator\n        results.append(eps_soft)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.17e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving beyond lumped-element analogies, this exercise explores the profound impact of a source's physical structure on the fields it generates within a guided-wave structure. You will investigate how a \"soft\" magnetic current source and a \"hard\" electric field source selectively excite distinct mode families (TM vs. TE) in a parallel-plate waveguide. This practice  demonstrates that the choice of source is a critical design decision for achieving mode purity and controlling the field distribution in complex electromagnetic systems.",
            "id": "3313123",
            "problem": "Consider a lossless, homogeneous, vacuum-filled parallel-plate waveguide bounded by perfect electric conductors (PEC) at transverse coordinates $y=0$ and $y=a$, infinite in the $x$-direction, and with the longitudinal propagation direction along $z$. Let the angular frequency be $\\omega=2\\pi f$ with $f$ in $\\mathrm{Hz}$, and define $k=\\omega\\sqrt{\\mu_0\\epsilon_0}$, where $\\mu_0$ and $\\epsilon_0$ are the permeability and permittivity of free space, respectively, in SI units. The plates are perfect conductors, so the tangential electric field on $y=0$ and $y=a$ vanishes. The waveguide supports two families of non-transverse electromagnetic (non-TEM) modes: transverse magnetic to $z$ (TM$_z$) with nonzero $E_z$ and zero $H_z$, and transverse electric to $z$ (TE$_z$) with nonzero $H_z$ and zero $E_z$. The transverse wavenumber for mode index $m\\in\\mathbb{N}$ is $k_{c,m}=m\\pi/a$, and a mode is propagating if and only if $k>k_{c,m}$.\n\nYou will compare two distinct source models often used in computational electromagnetics:\n\n- A soft magnetic current loop source: an impressed magnetic surface current density $M_x(y)$ tangential to the plates, localized in the interior, that does not overwrite the ambient fields (it adds to Maxwell’s equations as an impressed source).\n- A hard electric field source at the boundary: an impressed electric surface current density $J_x(y)$ localized adjacent to the PEC wall (near $y=0$), intended to enforce a strong tangential electric field in a narrow region touching the boundary (conceptually akin to an enforced Dirichlet excitation on the tangential electric field, which in discrete time-domain methods can overwrite field components).\n\nYour program must quantify, at a given frequency, how purely each source excites the TM$_z$ family versus producing TE$_z$ “contamination,” using the following fundamental base:\n\n- Maxwell’s equations in frequency domain in source-free regions: $\\nabla\\times \\mathbf{E}=-j\\omega\\mu_0\\mathbf{H}$ and $\\nabla\\times \\mathbf{H}=j\\omega\\epsilon_0\\mathbf{E}$.\n- Perfect electric conductor boundary condition: the tangential electric field vanishes on the PEC walls.\n- Separation of variables for the parallel-plate geometry implies the following transverse field polarizations for non-TEM modes:\n  - TM$_z$ modes have transverse magnetic field $\\mathbf{H}_t\\parallel \\hat{\\mathbf{x}}$ and transverse electric field $\\mathbf{E}_t\\parallel \\hat{\\mathbf{y}}$.\n  - TE$_z$ modes have transverse electric field $\\mathbf{E}_t\\parallel \\hat{\\mathbf{x}}$ and transverse magnetic field $\\mathbf{H}_t\\parallel \\hat{\\mathbf{y}}$.\n- Mode orthogonality and Lorentz reciprocity imply that, for an excitation at plane $z=0$ by transverse electric and magnetic surface current densities $\\mathbf{J}_t$ and $\\mathbf{M}_t$, the forward modal coupling amplitude $a_m^+$ into a mode with normalized transverse fields $(\\mathbf{E}_{m,t},\\mathbf{H}_{m,t})$ is proportional to the overlap integral $I_m=\\int_0^a \\left(\\mathbf{E}_{m,t}^*(y)\\cdot \\mathbf{J}_t(y)+\\mathbf{H}_{m,t}^*(y)\\cdot \\mathbf{M}_t(y)\\right)\\,dy$. You must use this overlap structure to compute relative coupling strengths and thus a quantitative measure of “mode purity.”\n\nDefine the following precise excitation models and purity metric:\n\n- Soft magnetic current loop source: $\\mathbf{M}_t(y)=\\hat{\\mathbf{x}}\\,M_0\\,\\left(y-\\frac{a}{2}\\right)\\exp\\!\\left(-\\frac{(y-\\frac{a}{2})^2}{w^2}\\right)$ and $\\mathbf{J}_t(y)=\\mathbf{0}$, where $M_0$ is any real scaling constant and $w>0$ is a width parameter in $\\mathrm{m}$. This distribution is chosen to be odd about $y=\\frac{a}{2}$ to avoid coupling to the transverse electromagnetic (TEM) mode; your computation must only sum over propagating non-TEM modes with $m\\ge 1$ and $k>k_{c,m}$.\n- Hard electric field source at the boundary: $\\mathbf{J}_t(y)=\\hat{\\mathbf{x}}\\,J_0\\,\\exp\\!\\left(-\\frac{y^2}{w^2}\\right)$ and $\\mathbf{M}_t(y)=\\mathbf{0}$, where $J_0$ is any real scaling constant. This models an enforced tangential electric field in the vicinity of the PEC wall at $y=0$; because the TE$_z$ transverse electric field is $\\hat{\\mathbf{x}}$-polarized, this excitation aligns with TE$_z$ polarization and misaligns with TM$_z$.\n- For non-TEM modes in a parallel-plate waveguide, you may take the transverse modal field shapes (up to a frequency-dependent normalization that cancels in the requested purity ratio) as:\n  - TM$_z$ family: $\\mathbf{H}_{m,t}(y)\\propto \\hat{\\mathbf{x}}\\cos\\!\\left(\\frac{m\\pi y}{a}\\right)$ and $\\mathbf{E}_{m,t}(y)\\propto \\hat{\\mathbf{y}}\\cos\\!\\left(\\frac{m\\pi y}{a}\\right)$ for $m\\in\\mathbb{N}$.\n  - TE$_z$ family: $\\mathbf{E}_{m,t}(y)\\propto \\hat{\\mathbf{x}}\\sin\\!\\left(\\frac{m\\pi y}{a}\\right)$ and $\\mathbf{H}_{m,t}(y)\\propto \\hat{\\mathbf{y}}\\sin\\!\\left(\\frac{m\\pi y}{a}\\right)$ for $m\\in\\mathbb{N}$.\n- For a given source, define the unnormalized coupling strengths\n  - $C^{\\mathrm{TM}}=\\sum_{m\\in\\mathcal{P}}\\left|\\int_0^a \\mathbf{H}_{m,t}^*(y)\\cdot \\mathbf{M}_t(y)\\,dy+\\int_0^a \\mathbf{E}_{m,t}^*(y)\\cdot \\mathbf{J}_t(y)\\,dy\\right|^2$ restricted to the TM$_z$ family,\n  - $C^{\\mathrm{TE}}=\\sum_{m\\in\\mathcal{P}}\\left|\\int_0^a \\mathbf{H}_{m,t}^*(y)\\cdot \\mathbf{M}_t(y)\\,dy+\\int_0^a \\mathbf{E}_{m,t}^*(y)\\cdot \\mathbf{J}_t(y)\\,dy\\right|^2$ restricted to the TE$_z$ family,\n  where $\\mathcal{P}=\\{m\\in\\mathbb{N}: k>k_{c,m}\\}$ is the set of propagating non-TEM modes. Then define the TM-mode purity as the dimensionless ratio $\\eta=C^{\\mathrm{TM}}/\\left(C^{\\mathrm{TM}}+C^{\\mathrm{TE}}\\right)$.\n\nImplement a program that:\n- Accepts no input and uses the following test suite of parameter sets, each given as $(a,f,w)$:\n  1. $(a,f,w)=\\left(0.010\\,\\mathrm{m},\\,40\\times 10^9\\,\\mathrm{Hz},\\,0.0015\\,\\mathrm{m}\\right)$\n  2. $(a,f,w)=\\left(0.010\\,\\mathrm{m},\\,20\\times 10^9\\,\\mathrm{Hz},\\,0.0020\\,\\mathrm{m}\\right)$\n  3. $(a,f,w)=\\left(0.005\\,\\mathrm{m},\\,80\\times 10^9\\,\\mathrm{Hz},\\,0.0005\\,\\mathrm{m}\\right)$\n- For each parameter set:\n  - Determines the set $\\mathcal{P}$ of propagating indices $m$ such that $k>k_{c,m}$.\n  - Numerically evaluates the overlap integrals over $y\\in[0,a]$ using a sufficiently fine uniform discretization to approximate the integrals.\n  - Computes the purity $\\eta_{\\mathrm{soft}}$ for the soft magnetic current loop source and $\\eta_{\\mathrm{hard}}$ for the hard electric field boundary source as defined above.\n- Produces a single line of output containing a comma-separated Python list of six floating-point numbers in the order $[\\eta_{\\mathrm{soft},1},\\eta_{\\mathrm{hard},1},\\eta_{\\mathrm{soft},2},\\eta_{\\mathrm{hard},2},\\eta_{\\mathrm{soft},3},\\eta_{\\mathrm{hard},3}]$. No units are required for these dimensionless purity values. Numbers should be expressed in standard decimal form.\n\nScientific realism and constraints:\n- Use $\\mu_0=4\\pi\\times 10^{-7}\\,\\mathrm{H/m}$ and $\\epsilon_0\\approx 8.854187817\\times 10^{-12}\\,\\mathrm{F/m}$. Assume vacuum filling everywhere.\n- Assume unit extent in $x$ for integration so that transverse integrals reduce to one-dimensional integrals over $y$.\n- Angles, if any trigonometric functions are evaluated, are in radians.\n- You must not rely on any analytic simplifications beyond the polarization alignments and shape functions stated above; the integrals must be evaluated numerically on $y\\in[0,a]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,r_3,r_4,r_5,r_6]$).",
            "solution": "The problem is valid as it is scientifically grounded in electromagnetic waveguide theory, well-posed with all necessary information provided, and objective in its definitions and goals. The solution proceeds by implementing the specified calculations.\n\nThe core of the problem is to compute the transverse magnetic (TM) mode purity, $\\eta$, for two different source excitations in a parallel-plate waveguide. The purity is defined as the ratio of power coupled into propagating TM$_z$ modes to the total power coupled into all propagating non-TEM modes (both TM$_z$ and TE$_z$). The formula is $\\eta = C^{\\mathrm{TM}} / (C^{\\mathrm{TM}} + C^{\\mathrm{TE}})$.\n\nFirst, for each parameter set $(a, f, w)$, we determine the set of propagating modes. The free-space wavenumber is $k = \\omega/c_0 = 2\\pi f / c_0$, where $c_0 = (\\mu_0 \\epsilon_0)^{-1/2}$ is the speed of light in vacuum. The constants are given as $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ and $\\epsilon_0 \\approx 8.854187817 \\times 10^{-12}\\,\\mathrm{F/m}$. A mode with index $m \\in \\mathbb{N}$ has a cutoff wavenumber $k_{c,m} = m\\pi/a$. The mode propagates if and only if $k > k_{c,m}$, which implies $m < ka/\\pi$. The set of propagating mode indices is thus $\\mathcal{P} = \\{m \\in \\mathbb{N} \\mid 1 \\le m \\le \\lfloor ka/\\pi \\rfloor\\}$.\n\nNext, we calculate the unnormalized coupling strengths $C^{\\mathrm{TM}}$ and $C^{\\mathrm{TE}}$. These are defined by summing the squared magnitudes of overlap integrals over all propagating modes $m \\in \\mathcal{P}$. The overlap integral for a mode $m$ is $I_m = \\int_0^a (\\mathbf{E}_{m,t}^* \\cdot \\mathbf{J}_t + \\mathbf{H}_{m,t}^* \\cdot \\mathbf{M}_t) dy$. The arbitrary source amplitudes $M_0$ and $J_0$ can be set to $1$ because they appear as a common factor in $C^{\\mathrm{TM}}$ and $C^{\\mathrm{TE}}$ and thus cancel in the ratio $\\eta$. The analysis is performed for each source type.\n\n**1. Soft Magnetic Current Loop Source**\n\nThe source is defined by $\\mathbf{M}_t(y) = \\hat{\\mathbf{x}}\\,(y - a/2)\\exp(-(y - a/2)^2/w^2)$ and $\\mathbf{J}_t(y) = \\mathbf{0}$. We evaluate the overlap integrals for both mode families.\n\n- **TM$_z$ Coupling**: The transverse modal magnetic field is $\\mathbf{H}_{m,t,\\mathrm{TM}}(y) \\propto \\hat{\\mathbf{x}}\\cos(m\\pi y/a)$. The source current $\\mathbf{M}_t$ is also $\\hat{\\mathbf{x}}$-polarized. Their dot product is non-zero. The transverse modal electric field $\\mathbf{E}_{m,t,\\mathrm{TM}}(y)$ is $\\hat{\\mathbf{y}}$-polarized, so its dot product with $\\mathbf{J}_t = \\mathbf{0}$ is zero. The overlap integral is:\n$$I_{m, \\mathrm{soft}}^{\\mathrm{TM}} = \\int_0^a \\mathbf{H}_{m,t,\\mathrm{TM}}^* \\cdot \\mathbf{M}_t \\,dy = \\int_0^a \\cos\\left(\\frac{m\\pi y}{a}\\right) \\left(y - \\frac{a}{2}\\right) \\exp\\left(-\\frac{(y - a/2)^2}{w^2}\\right) dy$$\n\n- **TE$_z$ Coupling**: The transverse modal magnetic field is $\\mathbf{H}_{m,t,\\mathrm{TE}}(y) \\propto \\hat{\\mathbf{y}}\\sin(m\\pi y/a)$. Since $\\mathbf{M}_t(y)$ is purely $\\hat{\\mathbf{x}}$-polarized, the dot product $\\mathbf{H}_{m,t,\\mathrm{TE}}^* \\cdot \\mathbf{M}_t = 0$ for all $y$. The term involving $\\mathbf{J}_t$ is also zero. Consequently, the overlap integral is identically zero:\n$$I_{m, \\mathrm{soft}}^{\\mathrm{TE}} = \\int_0^a 0 \\,dy = 0$$\n\nThe total TE$_z$ coupling strength is $C^{\\mathrm{TE}}_{\\mathrm{soft}} = \\sum_{m \\in \\mathcal{P}} |I_{m, \\mathrm{soft}}^{\\mathrm{TE}}|^2 = 0$.\nThe TM$_z$ coupling strength $C^{\\mathrm{TM}}_{\\mathrm{soft}} = \\sum_{m \\in \\mathcal{P}} |I_{m, \\mathrm{soft}}^{\\mathrm{TM}}|^2$ will be non-zero as long as there is at least one propagating mode $m$ for which the integral $I_{m, \\mathrm{soft}}^{\\mathrm{TM}}$ is non-zero. This occurs for all odd $m$, and all test cases include the propagating mode $m=1$.\nThe purity is therefore $\\eta_{\\mathrm{soft}} = C^{\\mathrm{TM}}_{\\mathrm{soft}} / (C^{\\mathrm{TM}}_{\\mathrm{soft}} + 0) = 1$. The numerical computation will confirm this by evaluating the integrals.\n\n**2. Hard Electric Field Source**\n\nThe source is defined by $\\mathbf{J}_t(y) = \\hat{\\mathbf{x}}\\,\\exp(-y^2/w^2)$ and $\\mathbf{M}_t(y) = \\mathbf{0}$.\n\n- **TM$_z$ Coupling**: The transverse modal electric field is $\\mathbf{E}_{m,t,\\mathrm{TM}}(y) \\propto \\hat{\\mathbf{y}}\\cos(m\\pi y/a)$. Since the source current $\\mathbf{J}_t(y)$ is purely $\\hat{\\mathbf{x}}$-polarized, their dot product $\\mathbf{E}_{m,t,\\mathrm{TM}}^* \\cdot \\mathbf{J}_t = 0$ for all $y$. The term involving $\\mathbf{M}_t$ is also zero. The overlap integral is therefore identically zero:\n$$I_{m, \\mathrm{hard}}^{\\mathrm{TM}} = \\int_0^a 0 \\,dy = 0$$\n\n- **TE$_z$ Coupling**: The transverse modal electric field is $\\mathbf{E}_{m,t,\\mathrm{TE}}(y) \\propto \\hat{\\mathbf{x}}\\sin(m\\pi y/a)$. The source current $\\mathbf{J}_t$ is also $\\hat{\\mathbf{x}}$-polarized. Their dot product is non-zero. The overlap integral is:\n$$I_{m, \\mathrm{hard}}^{\\mathrm{TE}} = \\int_0^a \\mathbf{E}_{m,t,\\mathrm{TE}}^* \\cdot \\mathbf{J}_t \\,dy = \\int_0^a \\sin\\left(\\frac{m\\pi y}{a}\\right) \\exp\\left(-\\frac{y^2}{w^2}\\right) dy$$\n\nThe total TM$_z$ coupling strength is $C^{\\mathrm{TM}}_{\\mathrm{hard}} = \\sum_{m \\in \\mathcal{P}} |I_{m, \\mathrm{hard}}^{\\mathrm{TM}}|^2 = 0$.\nThe TE$_z$ coupling strength $C^{\\mathrm{TE}}_{\\mathrm{hard}}$ is non-zero, as the integrand for $I_{m, \\mathrm{hard}}^{\\mathrm{TE}}$ is positive for $y \\in (0, a)$ and there is at least one propagating mode in each test case.\nThe purity is therefore $\\eta_{\\mathrm{hard}} = 0 / (0 + C^{\\mathrm{TE}}_{\\mathrm{hard}}) = 0$.\n\nThe program implements these calculations numerically for each test case as required, using `scipy.integrate.quad` to evaluate the definite integrals. The results from the numerical implementation will match the analytical conclusions, yielding $\\eta_{\\mathrm{soft}} \\approx 1.0$ and $\\eta_{\\mathrm{hard}} \\approx 0.0$ up to numerical precision.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main solver function to calculate and print the mode purity for the given test cases.\n    \"\"\"\n    # Define physical constants as per the problem statement\n    mu_0 = 4 * np.pi * 1e-7  # Permeability of free space in H/m\n    eps_0 = 8.854187817e-12    # Permittivity of free space in F/m\n    c0 = 1 / np.sqrt(mu_0 * eps_0)  # Speed of light in vacuum in m/s\n\n    # Test suite of parameter sets (a, f, w)\n    test_cases = [\n        # (a in m, f in Hz, w in m)\n        (0.010, 40e9, 0.0015),\n        (0.010, 20e9, 0.0020),\n        (0.005, 80e9, 0.0005),\n    ]\n\n    results = []\n    for a, f, w in test_cases:\n        # Calculate purity for the soft magnetic current loop source\n        eta_soft = calculate_purity(a, f, w, 'soft', c0)\n        results.append(eta_soft)\n\n        # Calculate purity for the hard electric field boundary source\n        eta_hard = calculate_purity(a, f, w, 'hard', c0)\n        results.append(eta_hard)\n\n    # Format and print the final output list\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_purity(a, f, w, source_type, c0):\n    \"\"\"\n    Calculates the TM-mode purity eta for a given set of parameters and source type.\n    \"\"\"\n    k = 2 * np.pi * f / c0  # Free-space wavenumber\n\n    # Determine the maximum index for propagating non-TEM modes\n    # A mode 'm' propagates if k > k_c,m = m*pi/a, so m < k*a/pi\n    m_max = int(np.floor(k * a / np.pi))\n\n    if m_max  1:\n        # No propagating non-TEM modes. In this case, C_TM and C_TE are both zero.\n        # The ratio eta is 0/0. We can define it as 0 or NaN.\n        # Problem statement implies this case will not occur with the given test data.\n        return 0.0\n\n    C_tm = 0.0\n    C_te = 0.0\n    \n    # Sum contributions from all propagating modes with m >= 1\n    for m in range(1, m_max + 1):\n        if source_type == 'soft':\n            # Soft source: M_t is x-polarized, J_t is zero.\n            # It couples to H_t of TM modes (x-polarized) but not H_t of TE modes (y-polarized).\n            \n            # Integrand for TM coupling\n            integrand_tm = lambda y: np.cos(m * np.pi * y / a) * \\\n                                     (y - a / 2) * np.exp(-((y - a / 2)**2) / w**2)\n            \n            # Integrand for TE coupling (analytically zero due to polarization mismatch)\n            integrand_te = lambda y: 0.0\n            \n        elif source_type == 'hard':\n            # Hard source: J_t is x-polarized, M_t is zero.\n            # It couples to E_t of TE modes (x-polarized) but not E_t of TM modes (y-polarized).\n            \n            # Integrand for TM coupling (analytically zero due to polarization mismatch)\n            integrand_tm = lambda y: 0.0\n            \n            # Integrand for TE coupling\n            integrand_te = lambda y: np.sin(m * np.pi * y / a) * \\\n                                     np.exp(-(y**2) / w**2)\n        else:\n            raise ValueError(\"Unknown source type\")\n\n        # Numerically evaluate the overlap integrals\n        I_tm_val, _ = quad(integrand_tm, 0, a)\n        I_te_val, _ = quad(integrand_te, 0, a)\n\n        # Add the squared magnitude of the coupling to the total\n        C_tm += I_tm_val**2\n        C_te += I_te_val**2\n\n    # Calculate the TM-mode purity ratio\n    denominator = C_tm + C_te\n    if denominator == 0:\n        # This case is not expected with the test data but handled for robustness.\n        return 0.0\n    \n    eta = C_tm / denominator\n    return eta\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "This final practice delves into the temporal and spectral characteristics of source excitations, a critical consideration for time-domain simulation methods like FDTD. You will design a \"hard\" source with a specific temporal shape and optimize its parameters to control the resulting frequency spectrum, minimizing unwanted artifacts while accounting for numerical grid dispersion. This advanced problem  highlights the practical engineering task of source signal design for efficient and accurate time-domain computational experiments.",
            "id": "3313072",
            "problem": "You are to analyze a one-dimensional hard source excitation in the Finite-Difference Time-Domain (FDTD) method and compute an optimal time constant that minimizes spurious low-frequency content outside a specified passband. A hard source enforces the electric field value directly at a grid point, which can generate undesired spectral content. Consider a ramped hard source of the form $E(t) = E_0\\left(1 - e^{-t/\\tau}\\right)$ for $t \\ge 0$, where $E_0$ is a constant amplitude and $\\tau$ is a positive time constant. We seek to choose $\\tau$ to minimize the relative out-of-band low-frequency content (below $[\\omega_1,\\omega_2]$), while accounting for the Yee-grid numerical dispersion.\n\nBase the derivation on the following fundamentals:\n- Maxwell's equations in free space and their standard Yee discretization yield the one-dimensional numerical dispersion relation for the Yee scheme,\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = S \\, \\sin\\left(\\frac{k \\Delta x}{2}\\right),\n$$\nwhere $\\Delta x$ is the spatial step, $\\Delta t$ is the time step, $S = \\frac{c \\Delta t}{\\Delta x}$ is the Courant number, $c$ is the speed of light in vacuum, $\\omega$ is angular frequency (in radians per second), and $k$ is the wavenumber (in radians per meter).\n- The group velocity on the grid is\n$$\nv_g(\\omega) = \\frac{d\\omega}{dk} = c \\, \\frac{\\cos\\left(\\frac{k \\Delta x}{2}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)},\n$$\nfor propagating modes that satisfy $\\left|\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)/S\\right| \\le 1$. For frequencies that do not satisfy this condition, there is no propagating mode and the contribution can be considered zero in a radiation metric.\n- The hard source signal has a direct current (DC) component $E_0$. Radiation is governed by the transient part, which is the deviation from the steady value. Define the transient as $E_{\\text{tr}}(t) = E(t) - E_0 = -E_0 e^{-t/\\tau}$ for $t \\ge 0$. Its Fourier transform magnitude squared (excluding singular DC components) is proportional to\n$$\n\\left|F(\\omega;\\tau)\\right|^2 \\propto \\frac{\\tau^2}{1 + (\\omega \\tau)^2}.\n$$\n\nDefine a dispersion-aware cost functional that penalizes low-frequency energy relative to the desired band as\n$$\nJ(\\tau) = \\frac{\\displaystyle \\int_{0}^{\\omega_1} w_{\\text{disp}}(\\omega) \\, \\left|F(\\omega;\\tau)\\right|^2 \\, d\\omega}{\\displaystyle \\int_{\\omega_1}^{\\omega_2} w_{\\text{disp}}(\\omega) \\, \\left|F(\\omega;\\tau)\\right|^2 \\, d\\omega},\n$$\nwhere the grid-dispersion weight $w_{\\text{disp}}(\\omega)$ is the normalized group velocity,\n$$\nw_{\\text{disp}}(\\omega) = \n\\begin{cases}\n\\max\\left(0, \\dfrac{v_g(\\omega)}{c} \\right) = \\max\\left(0, \\dfrac{\\cos\\left(\\frac{k \\Delta x}{2}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)} \\right),  \\text{if } \\left|\\dfrac{\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)}{S}\\right| \\le 1,\\\\[8pt]\n0,  \\text{otherwise,}\n\\end{cases}\n$$\nwith $k(\\omega)$ obtained by inverting the dispersion relation,\n$$\n\\frac{k \\Delta x}{2} = \\arcsin\\left(\\frac{1}{S} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right),\n$$\non the principal branch.\n\nYour task is to write a program that, for each test case, computes the value $\\tau^\\star$ (in seconds) that minimizes $J(\\tau)$ over the bounded domain $\\tau \\in [\\tau_{\\min}, \\tau_{\\max}]$, with\n$$\n\\tau_{\\min} = \\frac{0.05}{\\omega_2}, \\quad \\tau_{\\max} = \\frac{5}{\\omega_1}.\n$$\nUse numerical quadrature (for example, a trapezoidal rule) to evaluate the integrals and a univariate bounded optimizer to determine $\\tau^\\star$.\n\nAngles must be in radians. The speed of light is $c = 299792458\\,\\text{m/s}$. The hard source amplitude $E_0$ cancels, so you may set $E_0 = 1$ without loss of generality.\n\nImplement the following test suite. In each case, compute $\\Delta t = S \\, \\Delta x / c$ and ensure that the dispersion relation is used as specified.\n\n- Test case $1$ (general broadband):\n  - $\\omega_1 = 2\\pi \\times 1\\times 10^9\\,\\text{rad/s}$,\n  - $\\omega_2 = 2\\pi \\times 5\\times 10^9\\,\\text{rad/s}$,\n  - $\\Delta x = 1\\times 10^{-3}\\,\\text{m}$,\n  - $S = 0.9$.\n\n- Test case $2$ (narrow band near upper propagating limit):\n  - $\\omega_1 = 2\\pi \\times 3\\times 10^9\\,\\text{rad/s}$,\n  - $\\omega_2 = 2\\pi \\times 3.5\\times 10^9\\,\\text{rad/s}$,\n  - $\\Delta x = 5\\times 10^{-3}\\,\\text{m}$,\n  - $S = 0.99$.\n\n- Test case $3$ (low-frequency band on a coarser grid):\n  - $\\omega_1 = 2\\pi \\times 1\\times 10^8\\,\\text{rad/s}$,\n  - $\\omega_2 = 2\\pi \\times 5\\times 10^8\\,\\text{rad/s}$,\n  - $\\Delta x = 1\\times 10^{-2}\\,\\text{m}$,\n  - $S = 0.8$.\n\nYour program should:\n- Construct a sufficiently dense frequency grid over $[0,\\omega_2]$ for each case,\n- Compute $w_{\\text{disp}}(\\omega)$ from the Yee dispersion relation and the group velocity,\n- Evaluate $J(\\tau)$ using the specified integrals,\n- Numerically minimize $J(\\tau)$ over $[\\tau_{\\min},\\tau_{\\max}]$.\n\nReport, for each test case, the optimal $\\tau^\\star$ in seconds, as a floating-point number. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\tau_1,\\tau_2,\\tau_3]$. Express the final $\\tau$ values in seconds, formatted in scientific notation with six significant figures.",
            "solution": "The problem requires us to determine the optimal time constant $\\tau^\\star$ for a ramped hard source in a one-dimensional Finite-Difference Time-Domain (FDTD) simulation. The goal is to minimize spurious low-frequency radiation. This is accomplished by minimizing a specially designed cost functional, $J(\\tau)$, which quantifies the ratio of undesired low-frequency energy to desired in-band energy, accounting for the numerical dispersion of the Yee grid.\n\nThe solution methodology involves three main parts: defining the cost functional and its components, detailing the calculation of the dispersion-aware weight, and specifying the numerical procedure for optimization.\n\nFirst, we define the cost functional $J(\\tau)$. It is given as the ratio of two integrals:\n$$\nJ(\\tau) = \\frac{\\displaystyle \\int_{0}^{\\omega_1} w_{\\text{disp}}(\\omega) \\, \\left|F(\\omega;\\tau)\\right|^2 \\, d\\omega}{\\displaystyle \\int_{\\omega_1}^{\\omega_2} w_{\\text{disp}}(\\omega) \\, \\left|F(\\omega;\\tau)\\right|^2 \\, d\\omega}\n$$\nThe numerator represents the total radiated power in the unwanted low-frequency band $[0, \\omega_1]$, while the denominator represents the total radiated power in the desired passband $[\\omega_1, \\omega_2]$. The function is to be minimized with respect to $\\tau$ over the interval $[\\tau_{\\min}, \\tau_{\\max}]$, where $\\tau_{\\min} = 0.05/\\omega_2$ and $\\tau_{\\max} = 5/\\omega_1$.\n\nThe integrand in $J(\\tau)$ comprises two functions: the source's power spectrum, $|F(\\omega;\\tau)|^2$, and a dispersion-aware weight, $w_{\\text{disp}}(\\omega)$.\n\nThe source is a ramped signal $E(t) = E_0\\left(1 - e^{-t/\\tau}\\right)$. The radiation is produced by its transient component, $E_{\\text{tr}}(t) = -E_0 e^{-t/\\tau}$. The power spectrum of this transient component is proportional to:\n$$\n\\left|F(\\omega;\\tau)\\right|^2 \\propto \\frac{\\tau^2}{1 + (\\omega \\tau)^2}\n$$\nThis spectral shape depends on $\\tau$. A small $\\tau$ (fast ramp) results in a broad spectrum, while a large $\\tau$ (slow ramp) concentrates the energy at low frequencies. Since the proportionality constant $E_0^2$ cancels in the ratio $J(\\tau)$, we can set it to $1$ for the calculation.\n\nThe second component of the integrand is the dispersion-aware weight, $w_{\\text{disp}}(\\omega)$. This term accounts for the fact that on a numerical grid, the efficiency of radiation depends on frequency. It is defined as the normalized group velocity:\n$$\nw_{\\text{disp}}(\\omega) = \\frac{v_g(\\omega)}{c}\n$$\nfor propagating modes. The group velocity $v_g = d\\omega/dk$ is derived from the FDTD numerical dispersion relation for the $1$D Yee scheme:\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = S \\, \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nwhere $S = c \\Delta t / \\Delta x$ is the Courant number. By implicit differentiation, one finds the group velocity:\n$$\nv_g(\\omega) = c \\, \\frac{\\cos\\left(\\frac{k \\Delta x}{2}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)}\n$$\nTo express this solely in terms of $\\omega$, we invert the dispersion relation to find $\\frac{k\\Delta x}{2} = \\arcsin\\left(\\frac{1}{S} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right)$. Then, using the identity $\\cos(\\arcsin(x)) = \\sqrt{1-x^2}$, we get:\n$$\n\\cos\\left(\\frac{k \\Delta x}{2}\\right) = \\sqrt{1 - \\left(\\frac{1}{S} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right)^2}\n$$\nThus, the weight becomes:\n$$\nw_{\\text{disp}}(\\omega) = \\frac{\\sqrt{1 - \\frac{1}{S^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right)}}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)}\n$$\nThis expression is valid only for propagating modes, which exist when the argument of the arcsin is within $[-1, 1]$. This imposes an upper frequency limit (the grid cutoff frequency) beyond which $w_{\\text{disp}}(\\omega)$ is zero:\n$$\n\\left|\\frac{1}{S} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right| \\le 1\n$$\nFor frequencies below this cutoff, $w_{\\text{disp}}(\\omega)$ quantifies how effectively a frequency component propagates away from the source.\n\nThe optimization problem is to find $\\tau^\\star = \\text{arg min}_{\\tau} J(\\tau)$. Since $J(\\tau)$ is a complex function, we resort to a numerical solution. The procedure is as follows:\n$1.$ For each test case, the parameters $\\omega_1$, $\\omega_2$, $\\Delta x$, and $S$ are given. The speed of light is $c = 299792458\\,\\text{m/s}$. The time step is calculated as $\\Delta t = S \\Delta x / c$.\n$2.$ A function is constructed to compute $J(\\tau)$. This function performs the following steps:\n    a. A fine, uniform frequency grid is established over the range $[0, \\omega_2]$. The number of points must be large enough to ensure the accuracy of the numerical integration.\n    b. At each point $\\omega$ on this grid, the values of the source spectrum term $|F(\\omega;\\tau)|^2 = \\frac{\\tau^2}{1 + (\\omega\\tau)^2}$ and the dispersion weight $w_{\\text{disp}}(\\omega)$ are calculated.\n    c. The full integrand, $I(\\omega, \\tau) = w_{\\text{disp}}(\\omega) |F(\\omega;\\tau)|^2$, is formed.\n    d. The integrals in the numerator and denominator of $J(\\tau)$ are computed using a numerical quadrature method, such as the trapezoidal rule, over the respective frequency sub-intervals $[0, \\omega_1]$ and $[\\omega_1, \\omega_2]$.\n    e. The function returns the ratio of the two computed integrals.\n$3.$ The optimization bounds are calculated: $\\tau_{\\min} = 0.05 / \\omega_2$ and $\\tau_{\\max} = 5 / \\omega_1$.\n$4.$ A numerical optimizer for single-variable, bounded functions is used to find the value $\\tau^\\star$ in $[\\tau_{\\min}, \\tau_{\\max}]$ that minimizes the value returned by the function for $J(\\tau)$.\n\nThis procedure is applied to each of the three test cases provided in the problem statement to find the respective optimal time constants. The final results are then formatted as required.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import trapezoid\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Computes the optimal time constant for a hard source in 1D FDTD\n    for several test cases.\n    \"\"\"\n    c = 299792458.0  # Speed of light in m/s\n\n    test_cases = [\n        # Test case 1 (general broadband)\n        {\n            \"w1\": 2 * np.pi * 1e9,\n            \"w2\": 2 * np.pi * 5e9,\n            \"dx\": 1e-3,\n            \"S\": 0.9,\n        },\n        # Test case 2 (narrow band near upper propagating limit)\n        {\n            \"w1\": 2 * np.pi * 3e9,\n            \"w2\": 2 * np.pi * 3.5e9,\n            \"dx\": 5e-3,\n            \"S\": 0.99,\n        },\n        # Test case 3 (low-frequency band on a coarser grid)\n        {\n            \"w1\": 2 * np.pi * 1e8,\n            \"w2\": 2 * np.pi * 5e8,\n            \"dx\": 1e-2,\n            \"S\": 0.8,\n        },\n    ]\n\n    results = []\n    \n    # Use a fixed number of points for numerical integration for consistency.\n    N_POINTS = 20000 \n\n    for case in test_cases:\n        w1 = case[\"w1\"]\n        w2 = case[\"w2\"]\n        dx = case[\"dx\"]\n        S = case[\"S\"]\n\n        dt = S * dx / c\n        \n        # Create a dense grid of frequencies for integration.\n        omega_grid = np.linspace(0, w2, N_POINTS, endpoint=True)\n\n        def get_w_disp(omega, dt, S):\n            \"\"\"\n            Calculates the dispersion-aware weight w_disp(omega).\n            \"\"\"\n            # Argument for the sine function in the dispersion relation\n            sin_arg = omega * dt / 2\n            \n            # Avoid numerical issues at omega = 0\n            if sin_arg[0] == 0:\n                sin_arg[0] = 1e-15\n            \n            # Argument for the arcsin in the inversion of the dispersion relation\n            arcsin_arg = np.sin(sin_arg) / S\n\n            # Propagating modes exist where |arcsin_arg| = 1\n            mask = np.abs(arcsin_arg) = 1.0\n            \n            w_d = np.zeros_like(omega)\n            \n            # Calculate w_disp only for propagating frequencies\n            if np.any(mask):\n                valid_arcsin_arg = arcsin_arg[mask]\n                \n                # Use np.sqrt(1 - x^2) for cos(arcsin(x))\n                cos_k_dx_half = np.sqrt(1.0 - valid_arcsin_arg**2)\n                cos_omega_dt_half = np.cos(sin_arg[mask])\n\n                # Handle potential division by zero if cos(omega*dt/2) is zero\n                # This occurs at the Nyquist frequency, omega_nyquist = pi/dt\n                cos_omega_dt_half[cos_omega_dt_half == 0] = 1e-15\n\n                w_d[mask] = cos_k_dx_half / cos_omega_dt_half\n\n            return np.maximum(0, w_d)\n\n        w_disp_vals = get_w_disp(omega_grid, dt, S)\n        \n        # Define masks for the integration ranges\n        num_mask = (omega_grid >= 0)  (omega_grid = w1)\n        den_mask = (omega_grid > w1)  (omega_grid = w2)\n\n        def cost_function_J(tau):\n            \"\"\"\n            Computes the cost functional J(tau).\n            \"\"\"\n            # The spectrum of the transient component |F(omega; tau)|^2\n            # Proportionality constant is irrelevant as it cancels.\n            F2_vals = tau**2 / (1.0 + (omega_grid * tau)**2)\n            \n            # The full integrand\n            integrand = w_disp_vals * F2_vals\n            \n            # Numerator: Integral from 0 to w1\n            num_integral = trapezoid(integrand[num_mask], omega_grid[num_mask])\n            \n            # Denominator: Integral from w1 to w2\n            den_integral = trapezoid(integrand[den_mask], omega_grid[den_mask])\n            \n            if den_integral = 1e-30: # Avoid division by zero/small numbers\n                # If in-band energy is zero, cost is infinite (or very large)\n                return np.inf\n\n            return num_integral / den_integral\n\n        # Define optimization bounds for tau\n        tau_min = 0.05 / w2\n        tau_max = 5.0 / w1\n\n        # Perform the bounded optimization\n        res = minimize_scalar(\n            cost_function_J,\n            bounds=(tau_min, tau_max),\n            method='bounded'\n        )\n\n        tau_star = res.x\n        results.append(tau_star)\n\n    # Format the results as specified\n    formatted_results = [f\"{r:.6e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}