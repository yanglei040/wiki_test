{
    "hands_on_practices": [
        {
            "introduction": "在计算电磁学中，特别是在使用弯曲网格的有限元法 (FEM) 中，一个核心挑战是如何正确地将参考单元上的数学公式转换到物理单元上。本练习聚焦于电磁波问题的关键——旋度-旋度算子。通过推导其弱形式在坐标变换下的表达式，并进行数值诊断，您将亲手验证能量范数在从参考单元到物理单元的映射过程中保持不变，这是任何有效的 FEM 实现都必须满足的关键物理守恒定律。",
            "id": "3324818",
            "problem": "考虑一个三维计算域，该域通过一个从单位参考六面体出发的光滑、保向映射得到。设参考坐标为 $\\boldsymbol{\\xi} = (\\xi,\\eta,\\zeta) \\in \\widehat{\\Omega} = [0,1]^3$，物理坐标为 $\\mathbf{x} = \\mathbf{X}(\\boldsymbol{\\xi}) \\in \\Omega$。记雅可比矩阵为 $J(\\boldsymbol{\\xi}) = \\frac{\\partial \\mathbf{X}}{\\partial \\boldsymbol{\\xi}}$，雅可比行列式为 $\\det J(\\boldsymbol{\\xi})$，对称度量张量为 $g(\\boldsymbol{\\xi}) = J(\\boldsymbol{\\xi})^{\\top} J(\\boldsymbol{\\xi})$。假设磁导率 $\\mu > 0$ 为常数。\n\n在采用有限元法（FEM）的计算电磁学中，电场的旋度-旋度弱形式是一个双线性泛函\n$$\na(\\mathbf{E},\\mathbf{v}) = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{v}\\right)\\,d\\Omega,\n$$\n其中 $\\mathbf{E}$ 是试探场，$\\mathbf{v}$ 是测试场，两者都属于适当的切向连续函数空间（例如，N\\'ed\\'elec $H(\\mathrm{curl})$ 空间）。在从参考域到物理域的映射下，$H(\\mathrm{curl})$ 场通过协变 Piola 变换进行转换：若 $\\widehat{\\mathbf{E}}(\\boldsymbol{\\xi})$ 和 $\\widehat{\\mathbf{v}}(\\boldsymbol{\\xi})$ 是定义在 $\\widehat{\\Omega}$ 上的场，则它们对应的物理场为\n$$\n\\mathbf{E}(\\mathbf{x}) = J(\\boldsymbol{\\xi})^{-\\top}\\,\\widehat{\\mathbf{E}}(\\boldsymbol{\\xi}), \\qquad\n\\mathbf{v}(\\mathbf{x}) = J(\\boldsymbol{\\xi})^{-\\top}\\,\\widehat{\\mathbf{v}}(\\boldsymbol{\\xi}),\n$$\n其中 $\\mathbf{x}=\\mathbf{X}(\\boldsymbol{\\xi})$。\n\n任务1（推导）：从积分的变量替换定理、导数的链式法则以及协变 Piola 变换出发，推导旋度-旋度双线性泛函变换后的参考域弱形式表达式，该表达式应完全用参考场和几何映射量 $J$、$\\det J$ 以及 $g=J^{\\top}J$ 来表示。您的推导必须展示物理域积分\n$$\n\\int_{\\Omega} \\mu^{-1} \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{v}\\right)\\,d\\Omega\n$$\n是如何在参考域 $\\widehat{\\Omega}$ 上仅使用 $\\widehat{\\mathbf{E}}$、$\\widehat{\\mathbf{v}}$、$J$、$\\det J$ 和 $g$ 来表示的。\n\n任务2（诊断设计与实现）：设计一个数值诊断，用于验证能量范数在不同映射下的等价性。一个场的能量范数定义为\n$$\n\\left\\|\\mathbf{E}\\right\\|_{\\mu^{-1}\\mathrm{curl}}^2 = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\,d\\Omega.\n$$\n使用推导出的变换后的参考域表达式来计算映射后场的此范数，并通过映射下已知的旋度变换重写的物理域表达式计算相同量。验证对于一组曲元映射，这两个独立计算的量在数值积分误差范围内是一致的。使用相对误差来量化其一致性\n$$\n\\varepsilon = \\frac{\\left|I_{\\mathrm{phys}} - I_{\\mathrm{ref}}\\right|}{\\max\\left(1,\\left|I_{\\mathrm{ref}}\\right|\\right)},\n$$\n其中 $I_{\\mathrm{phys}}$ 是以物理域形式计算的能量积分，$I_{\\mathrm{ref}}$ 是变换后的参考域积分。\n\n实现规格：\n- 使用以下从 $\\widehat{\\Omega}$ 到 $\\Omega$ 的光滑三线性加双线性映射，其参数为 $(a,b,c)$：\n$$\n\\begin{aligned}\nX_1(\\xi,\\eta,\\zeta) = \\xi + a\\,\\xi\\,\\eta,\\\\\nX_2(\\xi,\\eta,\\zeta) = \\eta + b\\,\\eta\\,\\zeta,\\\\\nX_3(\\xi,\\eta,\\zeta) = \\zeta + c\\,\\xi\\,\\zeta,\n\\end{aligned}\n$$\n其雅可比矩阵为\n$$\nJ(\\xi,\\eta,\\zeta) = \n\\begin{bmatrix}\n1+a\\eta & a\\xi & 0\\\\\n0 & 1+b\\zeta & b\\eta\\\\\nc\\zeta & 0 & 1+c\\xi\n\\end{bmatrix}.\n$$\n- 使用恒定的磁导率 $\\mu = 2.0$（国际单位制）；由于只输出无量纲的相对误差，数值不需要单位标注。\n- 使用参考场\n$$\n\\widehat{\\mathbf{E}}(\\xi,\\eta,\\zeta) = \\begin{bmatrix}\\xi^2+\\eta\\\\ \\eta^2+\\zeta\\\\ \\zeta^2+\\xi\\end{bmatrix},\n$$\n且对于能量范数诊断，设置测试场等于试探场，即 $\\widehat{\\mathbf{v}}=\\widehat{\\mathbf{E}}$。\n- 在 $\\widehat{\\Omega}$ 上使用足够高阶的张量积 Gauss–Legendre 求积实现数值积分，以捕捉映射的非线性。不涉及角度；不需要角度单位。\n\n测试套件：\n计算以下四种映射的相对误差 $\\varepsilon$（每种映射为一个三元组 $(a,b,c)$）：\n1. $(0.0,\\,0.0,\\,0.0)$，恒等映射（理想情况）。\n2. $(0.2,\\,0.1,\\,0.15)$，轻度弯曲的单元。\n3. $(0.0,\\,0.6,\\,0.0)$，沿 $\\eta$–$\\zeta$ 方向的各向异性曲率。\n4. $(0.5,\\,0.4,\\,0.3)$，强弯曲但良态的单元（达到剧烈曲率边界但未退化）。\n\n最终输出格式：\n您的程序应生成单行输出，包含四个测试用例的相对误差，形式为逗号分隔并用方括号括起来的列表（例如，\"[e1,e2,e3,e4]\"）。每个 $e_i$ 必须是一个浮点数。",
            "solution": "该问题被评估为有效，因为它在科学上基于计算电磁学的原理，在数学上是适定且自洽的，并以客观、正式的语言表述。所提供的数据和条件对于推导唯一解是完整和充分的。\n\n### 任务1：参考域弱形式的推导\n\n目标是将旋度-旋度双线性泛函从物理域 $\\Omega$ 变换到参考域 $\\widehat{\\Omega} = [0,1]^3$。出发点是物理域的表达式：\n$$\na(\\mathbf{E},\\mathbf{v}) = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{v}\\right)\\,d\\Omega\n$$\n变换分三步进行：变换积分测度、变换旋度算子以及组装最终表达式。\n\n1.  **积分测度的变换**：根据变量替换定理，物理域中的微分体积元 $d\\Omega$ 与参考域中的微分体积元 $d\\widehat{\\Omega}$ 通过雅可比行列式 $\\det J$ 相关联。\n    $$\n    d\\Omega = \\det J(\\boldsymbol{\\xi}) \\,d\\widehat{\\Omega}\n    $$\n    将此应用于双线性形式得到：\n    $$\n    a(\\mathbf{E},\\mathbf{v}) = \\int_{\\widehat{\\Omega}} \\mu^{-1} \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{v}\\right)\\,\\det J(\\boldsymbol{\\xi})\\,d\\widehat{\\Omega}\n    $$\n\n2.  **旋度算子的变换**：试探场 $\\mathbf{E}$ 和测试场 $\\mathbf{v}$ 是 $H(\\mathrm{curl})$ 函数空间的成员。问题规定，参考域上的场 $\\widehat{\\mathbf{E}}$ 和 $\\widehat{\\mathbf{v}}$ 通过协变 Piola 变换映射到它们对应的物理场：\n    $$\n    \\mathbf{E}(\\mathbf{X}(\\boldsymbol{\\xi})) = J(\\boldsymbol{\\xi})^{-\\top}\\,\\widehat{\\mathbf{E}}(\\boldsymbol{\\xi})\n    $$\n    对于以这种方式变换的场，微分几何中有一个基本恒等式，它将物理坐标下的旋度（$\\nabla_{\\mathbf{x}} \\times$）与参考坐标下的旋度（$\\nabla_{\\boldsymbol{\\xi}} \\times$）联系起来：\n    $$\n    \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)(\\mathbf{X}(\\boldsymbol{\\xi})) = \\frac{J(\\boldsymbol{\\xi})}{\\det J(\\boldsymbol{\\xi})} \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}(\\boldsymbol{\\xi})\\right)\n    $$\n    同样的关系也适用于测试函数 $\\mathbf{v}$ 及其参考对应 $\\widehat{\\mathbf{v}}$。\n\n3.  **变换后被积函数的组装**：现在，我们将变换后的旋度表达式代入积分内的点积中。\n    $$\n    \\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)\\cdot\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{v}\\right) = \\left[ \\frac{J}{\\det J} \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\right] \\cdot \\left[ \\frac{J}{\\det J} \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{v}}\\right) \\right]\n    $$\n    化简得：\n    $$\n    = \\frac{1}{(\\det J)^2} \\left[ J \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\right] \\cdot \\left[ J \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{v}}\\right) \\right]\n    $$\n    利用向量恒等式 $(A\\mathbf{u}) \\cdot (A\\mathbf{w}) = (A\\mathbf{u})^{\\top}(A\\mathbf{w}) = \\mathbf{u}^{\\top} A^{\\top} A \\mathbf{w} = \\mathbf{u} \\cdot (A^{\\top}A\\mathbf{w})$，并回顾度量张量 $g = J^{\\top}J$ 的定义，点积变为：\n    $$\n    = \\frac{1}{(\\det J)^2} \\left[ \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\cdot \\left(g \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{v}}\\right)\\right) \\right]\n    $$\n    最后，将此点积表达式和变换后的积分测度代入双线性形式，得到完整的参考域弱形式：\n    $$\n    a(\\mathbf{E},\\mathbf{v}) = \\int_{\\widehat{\\Omega}} \\mu^{-1} \\left\\{ \\frac{1}{(\\det J)^2} \\left[ \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\cdot \\left(g \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{v}}\\right)\\right) \\right] \\right\\} \\det J \\,d\\widehat{\\Omega}\n    $$\n    一个 $\\det J$ 因子被消去，得到最终结果：\n    $$\n    a(\\mathbf{E},\\mathbf{v}) = \\int_{\\widehat{\\Omega}} \\mu^{-1} \\frac{1}{\\det J} \\left[ \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\cdot \\left(g \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{v}}\\right)\\right) \\right] \\,d\\widehat{\\Omega}\n    $$\n\n### 任务2：诊断设计\n\n诊断任务是验证在不同但解析上等价的公式下，能量范数的计算结果是否等价。能量范数的平方由 $\\|\\mathbf{E}\\|_{\\mu^{-1}\\mathrm{curl}}^2 = a(\\mathbf{E},\\mathbf{E})$ 给出。我们用两种方法计算这个值。\n\n1.  **参考域公式 ($I_{\\mathrm{ref}}$)**：此方法直接实现推导出的参考域表达式，其中 $\\widehat{\\mathbf{v}}=\\widehat{\\mathbf{E}}$：\n    $$\n    I_{\\mathrm{ref}} = \\int_{\\widehat{\\Omega}} \\mu^{-1} \\frac{1}{\\det J} \\left[ \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\cdot \\left(g \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right)\\right) \\right] \\,d\\widehat{\\Omega}\n    $$\n\n2.  **物理域公式 ($I_{\\mathrm{phys}}$)**：此方法从物理域定义出发，并将其变换以便在参考网格上计算：\n    $$\n    I_{\\mathrm{phys}} = \\int_{\\Omega} \\mu^{-1} \\lvert\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\rvert^2 \\,d\\Omega = \\int_{\\widehat{\\Omega}} \\mu^{-1} \\lvert\\left(\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\right)(\\mathbf{X}(\\boldsymbol{\\xi}))\\rvert^2 \\det J \\,d\\widehat{\\Omega}\n    $$\n    使用旋度变换恒等式，被积函数计算如下：\n    $$\n    \\lvert\\nabla_{\\mathbf{x}} \\times \\mathbf{E}\\rvert^2 = \\left\\lvert \\frac{J}{\\det J} \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\right\\rvert^2 = \\frac{1}{(\\det J)^2} \\left[ J \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\right] \\cdot \\left[ J \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\right] = \\frac{1}{(\\det J)^2} \\left[ \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right) \\cdot \\left(g \\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}}\\right)\\right) \\right]\n    $$\n    将此代入 $I_{\\mathrm{phys}}$ 的表达式，证明了其与 $I_{\\mathrm{ref}}$ 的解析等价性。数值诊断使用它们各自不同的计算公式独立计算 $I_{\\mathrm{ref}}$ 和 $I_{\\mathrm{phys}}$，并验证它们的一致性。\n\n对于给定的参考场 $\\widehat{\\mathbf{E}}(\\xi,\\eta,\\zeta) = [\\xi^2+\\eta, \\eta^2+\\zeta, \\zeta^2+\\xi]^{\\top}$，其在参考坐标下的旋度是一个常向量：\n$$\n\\nabla_{\\boldsymbol{\\xi}} \\times \\widehat{\\mathbf{E}} = \\begin{bmatrix} \\frac{\\partial}{\\partial\\eta}(\\zeta^2+\\xi) - \\frac{\\partial}{\\partial\\zeta}(\\eta^2+\\zeta) \\\\ \\frac{\\partial}{\\partial\\zeta}(\\xi^2+\\eta) - \\frac{\\partial}{\\partial\\xi}(\\zeta^2+\\xi) \\\\ \\frac{\\partial}{\\partial\\xi}(\\eta^2+\\zeta) - \\frac{\\partial}{\\partial\\eta}(\\xi^2+\\eta) \\end{bmatrix} = \\begin{bmatrix} 0-1 \\\\ 0-1 \\\\ 0-1 \\end{bmatrix} = \\begin{bmatrix} -1 \\\\ -1 \\\\ -1 \\end{bmatrix}\n$$\n$I_{\\mathrm{ref}}$ 和 $I_{\\mathrm{phys}}$ 的积分通过在参考立方体 $\\widehat{\\Omega}=[0,1]^3$ 上使用张量积 Gauss-Legendre 求积法则进行数值计算。两个计算值之间的一致性通过相对误差来衡量：\n$$\n\\varepsilon = \\frac{\\left|I_{\\mathrm{phys}} - I_{\\mathrm{ref}}\\right|}{\\max\\left(1,\\left|I_{\\mathrm{ref}}\\right|\\right)}\n$$\n一个接近机器精度的微小 $\\varepsilon$ 值，证实了几何映射量和变换公式实现的正确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative error between two methods of calculating the\n    curl-curl energy norm for a set of test cases.\n    \"\"\"\n    \n    # Test cases defined as tuples (a, b, c)\n    test_cases = [\n        (0.0, 0.0, 0.0),\n        (0.2, 0.1, 0.15),\n        (0.0, 0.6, 0.0),\n        (0.5, 0.4, 0.3),\n    ]\n\n    # Global parameters\n    mu = 2.0\n    quad_order = 10  # Sufficiently high for the rational integrand\n\n    # The curl of the reference field is a constant vector.\n    # E_hat = [xi^2+eta, eta^2+zeta, zeta^2+xi]\n    # curl(E_hat) = [d(E3)/d(eta) - d(E2)/d(zeta), d(E1)/d(zeta) - d(E3)/d(xi), d(E2)/d(xi) - d(E1)/d(eta)]\n    #             = [0 - 1, 0 - 1, 0 - 1] = [-1, -1, -1]\n    C_hat = np.array([-1.0, -1.0, -1.0])\n\n    results = []\n    for a, b, c in test_cases:\n        error = compute_error_for_mapping(a, b, c, mu, C_hat, quad_order)\n        results.append(f\"{error:.15e}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef get_jacobian(xi, eta, zeta, a, b, c):\n    \"\"\"\n    Computes the Jacobian matrix of the mapping at a point (xi, eta, zeta).\n    \"\"\"\n    J = np.zeros((3, 3))\n    J[0, 0] = 1.0 + a * eta\n    J[0, 1] = a * xi\n    J[1, 1] = 1.0 + b * zeta\n    J[1, 2] = b * eta\n    J[2, 0] = c * zeta\n    J[2, 2] = 1.0 + c * xi\n    return J\n\ndef compute_error_for_mapping(a, b, c, mu, C_hat, quad_order):\n    \"\"\"\n    Computes I_ref, I_phys and the relative error for a given mapping.\n    \"\"\"\n    # Get Gauss-Legendre quadrature points and weights for [-1, 1]\n    points, weights = np.polynomial.legendre.leggauss(quad_order)\n    \n    # Scale points and weights for the interval [0, 1]\n    q_points = 0.5 * (points + 1.0)\n    q_weights = 0.5 * weights\n    \n    I_ref = 0.0\n    I_phys = 0.0\n    \n    for i in range(quad_order):\n        xi = q_points[i]\n        wi = q_weights[i]\n        for j in range(quad_order):\n            eta = q_points[j]\n            wj = q_weights[j]\n            for k in range(quad_order):\n                zeta = q_points[k]\n                wk = q_weights[k]\n                \n                # Compute geometric quantities at the quadrature point\n                J = get_jacobian(xi, eta, zeta, a, b, c)\n                detJ = np.linalg.det(J)\n                g = J.T @ J\n\n                # --- Calculation for I_ref ---\n                # Integrand: (1/mu) * (1/detJ) * [ C_hat . (g @ C_hat) ]\n                g_C_hat = g @ C_hat\n                C_g_C = C_hat @ g_C_hat\n                integrand_ref = (1.0 / mu) * (1.0 / detJ) * C_g_C\n                I_ref += integrand_ref * wi * wj * wk\n\n                # --- Calculation for I_phys ---\n                # Integrand: (1/mu) * | (J @ C_hat) / detJ |^2 * detJ\n                C_phys = (1.0 / detJ) * (J @ C_hat)\n                norm_sq_C_phys = C_phys @ C_phys\n                integrand_phys = (1.0 / mu) * norm_sq_C_phys * detJ\n                I_phys += integrand_phys * wi * wj * wk\n\n    # Compute relative error\n    error = np.abs(I_phys - I_ref) / np.max([1.0, np.abs(I_ref)])\n    return error\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "几何映射中的微小误差在物理上意味着什么？本练习将引导您从一个更深刻的视角——变换光学，来理解这个问题。您将 analytically证明，在数值计算中引入的一个微小的雅可比矩阵误差，其效果等价于在一个完美几何中引入了各向异性的材料扰动。通过运用微扰理论，您将能够量化这种几何近似对电磁本征模式频率产生的偏移，从而将抽象的数值误差与可测量的物理后果联系起来。",
            "id": "3324727",
            "problem": "考虑在均匀、各向同性的介质中，时间依赖关系为 $\\exp(-i \\omega t)$ 的频域无源麦克斯韦旋度方程，该介质的介电常数为标量 $\\varepsilon$，磁导率为标量 $\\mu$：\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = - i \\omega \\varepsilon \\mathbf{E}, \\quad \\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0, \\quad \\nabla \\cdot (\\mu \\mathbf{H}) = 0.\n$$\n在曲线坐标离散化中，一种常见的计算策略是在局部坐标 $\\boldsymbol{\\xi}$ 中进行计算，局部坐标通过光滑映射 $\\mathbf{x} = \\mathbf{F}(\\boldsymbol{\\xi})$ 与全局坐标 $\\mathbf{x}$ 相关联，其雅可比矩阵为 $J = \\partial \\mathbf{x}/\\partial \\boldsymbol{\\xi}$。从麦克斯韦方程在光滑坐标变换下的不变性以及由此产生的几何结构和材料分布之间的等效性出发。\n\n假设精确的几何结构是平凡的（单位映射），但数值映射引入了一个小的常数雅可比误差 $J = I + \\eta S$，其中 $I$ 是单位矩阵，$0 < |\\eta| \\ll 1$ 是一个无量纲小参数，$S$ 是一个常对角矩阵 $S = \\mathrm{diag}(\\alpha, \\beta, \\gamma)$，其元素 $\\alpha$、$\\beta$ 和 $\\gamma$ 为实数。\n\n任务：\n1. 仅使用第一性原理（即上述旋度方程和坐标变换不变性），证明映射误差 $J = I + \\eta S$ 在 $\\eta$ 的一阶近似下，等效于原始全局坐标系中的一个等效各向异性材料微扰 $(\\delta \\varepsilon, \\delta \\mu)$。将 $\\delta \\varepsilon$ 和 $\\delta \\mu$ 用 $\\varepsilon$、$\\mu$、$\\alpha$、$\\beta$ 和 $\\gamma$ 明确表示至 $\\eta$ 的一阶。\n2. 从关于 $\\mathbf{E}$ 的无源广义本征问题出发，并使用与麦克斯韦方程一致的变分或基于能量的论证，推导由小的材料微扰 $(\\delta \\varepsilon, \\delta \\mu)$ 引起的无损电磁本征模式的相对频率偏移 $\\delta \\omega / \\omega$ 的一阶微扰理论表达式。\n3. 将你的结果应用于体积为 $V$ 的周期性盒子中的以下特定本征模式：一个横电磁平面波，其波矢为 $\\mathbf{k} = (0, 0, k_0)$，电场极化为 $\\mathbf{E}(\\mathbf{x}) = E_0 \\hat{\\mathbf{x}} \\exp(i k_0 z)$，相应的磁场为 $\\mathbf{H}(\\mathbf{x}) = H_0 \\hat{\\mathbf{y}} \\exp(i k_0 z)$，色散关系为 $k_0 = \\omega \\sqrt{\\varepsilon \\mu}$。未受微扰的介质是原始的均匀各向同性介质 $(\\varepsilon, \\mu)$，而微扰完全是通过你在第1部分得到的结果，由映射误差产生。\n给出主阶相对频率偏移 $\\delta \\omega / \\omega$ 关于 $\\eta$、$\\alpha$、$\\beta$ 和 $\\gamma$ 的最终闭式解析表达式。不需要进行数值计算。将最终答案表示为单个闭式解析表达式。由于 $\\delta \\omega / \\omega$ 是无量纲的，所以不需要单位。",
            "solution": "用户提供了一个有效且适定的问题。解决方案将按顺序解决这三个任务。未受微扰的介质由标量介电常数 $\\varepsilon$ 和磁导率 $\\mu$ 表征。微扰源于坐标映射雅可比矩阵中的一个小误差。\n\n**第1部分：等效各向异性材料微扰**\n\n问题陈述了麦克斯韦方程在光滑坐标变换 $\\mathbf{x} = \\mathbf{F}(\\boldsymbol{\\xi})$ 下是不变的。这种不变性意味着坐标系的变换等效于材料本构参数的变换。对于在原始坐标 $\\mathbf{x}$ 中具有标量参数 $(\\varepsilon, \\mu)$ 的各向同性介质，在同一坐标系中，对应于从一个雅可比矩阵为 $J = \\partial \\mathbf{x}/\\partial \\boldsymbol{\\xi}$ 的新坐标系 $\\boldsymbol{\\xi}$ 进行的映射，其等效介电常数和磁导率张量 $(\\varepsilon', \\mu')$ 由著名的变换光学公式给出：\n$$\n\\varepsilon' = \\frac{J J^T}{\\det(J)} \\varepsilon, \\quad \\mu' = \\frac{J J^T}{\\det(J)} \\mu\n$$\n问题指定了受微扰的雅可比矩阵 $J = I + \\eta S$，其中 $I$ 是 $3 \\times 3$ 单位矩阵，$\\eta$ 是一个 xAxis小参数，$S = \\mathrm{diag}(\\alpha, \\beta, \\gamma)$ 是一个常对角矩阵。我们需要求出在 $\\eta$ 的一阶近似下的材料微扰 $\\delta\\varepsilon = \\varepsilon' - \\varepsilon I$ 和 $\\delta\\mu = \\mu' - \\mu I$。\n\n首先，我们计算 $J J^T$ 项：\n$$\nJ J^T = (I + \\eta S)(I + \\eta S)^T\n$$\n由于 $S$ 是对角矩阵，所以它是对称的，即 $S^T = S$。\n$$\nJ J^T = (I + \\eta S)(I + \\eta S) = I + 2\\eta S + \\eta^2 S^2\n$$\n在 $\\eta$ 的一阶近似下，这变为：\n$$\nJ J^T \\approx I + 2\\eta S\n$$\n接下来，我们计算 $J$ 的行列式：\n$$\n\\det(J) = \\det(I + \\eta S) = \\det(\\mathrm{diag}(1+\\eta\\alpha, 1+\\eta\\beta, 1+\\eta\\gamma))\n$$\n$$\n\\det(J) = (1+\\eta\\alpha)(1+\\eta\\beta)(1+\\eta\\gamma) = 1 + \\eta(\\alpha+\\beta+\\gamma) + O(\\eta^2)\n$$\n项 $\\alpha+\\beta+\\gamma$ 是 $S$ 的迹，记为 $\\mathrm{Tr}(S)$。因此，在 $\\eta$ 的一阶近似下：\n$$\n\\det(J) \\approx 1 + \\eta \\mathrm{Tr}(S)\n$$\n行列式的倒数，在一阶近似下为：\n$$\n\\frac{1}{\\det(J)} \\approx \\frac{1}{1 + \\eta \\mathrm{Tr}(S)} \\approx 1 - \\eta \\mathrm{Tr}(S)\n$$\n现在我们结合这些结果来求等效介电常数张量 $\\varepsilon'$：\n$$\n\\varepsilon' = \\varepsilon \\frac{J J^T}{\\det(J)} \\approx \\varepsilon (I + 2\\eta S)(1 - \\eta \\mathrm{Tr}(S))\n$$\n展开并只保留到 $\\eta$ 的一阶项：\n$$\n\\varepsilon' \\approx \\varepsilon (I + 2\\eta S - \\eta \\mathrm{Tr}(S) I) = \\varepsilon I + \\eta\\varepsilon(2S - \\mathrm{Tr}(S)I)\n$$\n介电常数的一阶微扰为 $\\delta\\varepsilon = \\varepsilon' - \\varepsilon I$：\n$$\n\\delta\\varepsilon = \\eta\\varepsilon(2S - \\mathrm{Tr}(S)I)\n$$\n代入 $S = \\mathrm{diag}(\\alpha, \\beta, \\gamma)$ 和 $\\mathrm{Tr}(S) = \\alpha+\\beta+\\gamma$：\n$$\n\\delta\\varepsilon = \\eta\\varepsilon \\left( 2\\begin{pmatrix} \\alpha & 0 & 0 \\\\ 0 & \\beta & 0 \\\\ 0 & 0 & \\gamma \\end{pmatrix} - (\\alpha+\\beta+\\gamma) \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\right)\n$$\n$$\n\\delta\\varepsilon = \\eta\\varepsilon \\begin{pmatrix} \\alpha-\\beta-\\gamma & 0 & 0 \\\\ 0 & \\beta-\\alpha-\\gamma & 0 \\\\ 0 & 0 & \\gamma-\\alpha-\\beta \\end{pmatrix}\n$$\n磁导率微扰 $\\delta\\mu$ 的推导是相同的：\n$$\n\\delta\\mu = \\eta\\mu(2S - \\mathrm{Tr}(S)I) = \\eta\\mu \\begin{pmatrix} \\alpha-\\beta-\\gamma & 0 & 0 \\\\ 0 & \\beta-\\alpha-\\gamma & 0 \\\\ 0 & 0 & \\gamma-\\alpha-\\beta \\end{pmatrix}\n$$\n这些就是等效材料微扰的显式一阶表达式。\n\n**第2部分：频率偏移的一阶微扰理论**\n\n我们从无源麦克斯韦旋度方程出发，这些方程可以组合成关于电场 $\\mathbf{E}$ 的一个广义厄米本征问题：\n$$\n\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) = \\omega^2 \\varepsilon \\mathbf{E}\n$$\n设未受微扰的系统为 $(\\varepsilon_0, \\mu_0, \\omega_0, \\mathbf{E}_0, \\mathbf{H}_0)$，受微扰的系统为 $(\\varepsilon, \\mu, \\omega, \\mathbf{E}, \\mathbf{H})$。对于本问题，为了与问题的符号匹配，我们使用 $(\\varepsilon, \\mu)$ 表示未受微扰的状态。因此，微扰为 $(\\delta\\varepsilon, \\delta\\mu)$，导致频率偏移 $\\delta\\omega$。受微扰的系统是 $\\varepsilon' = \\varepsilon + \\delta\\varepsilon$ 和 $\\mu' = \\mu + \\delta\\mu$。新的频率是 $\\omega' = \\omega + \\delta\\omega$。\n\n未受微扰的本征问题是 $\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) = \\omega^2 \\varepsilon \\mathbf{E}$。\n受微扰的本征问题是 $\\nabla \\times \\left((\\mu+\\delta\\mu)^{-1} \\nabla \\times \\mathbf{E'}\\right) = (\\omega+\\delta\\omega)^2 (\\varepsilon+\\delta\\varepsilon) \\mathbf{E'}$。\n在一阶近似下，$(\\mu+\\delta\\mu)^{-1} \\approx \\mu^{-1} - \\mu^{-1}\\delta\\mu\\mu^{-1}$。由于未受微扰的介质是各向同性的，$\\mu$ 是一个标量，所以这可以简化为 $\\mu^{-1}(I - \\mu^{-1}\\delta\\mu) \\approx \\mu^{-1}(1 - \\delta\\mu/\\mu) \\approx \\mu^{-1} - \\mu^{-2}\\delta\\mu$。\n\n让我们使用广义本征问题 $A\\mathbf{x} = \\lambda B\\mathbf{x}$ 的标准一阶微扰理论。频率偏移由应用于一阶微扰方程的 Fredholm 择一条件给出。这导出了著名的公式：\n$$\n\\frac{\\delta\\omega}{\\omega} = - \\frac{\\int_V (\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} + \\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H}) \\, dV}{2 \\int_V (\\mathbf{E}^* \\cdot \\varepsilon \\mathbf{E}) \\, dV}\n$$\n这个公式也可以从一个能量论证中导出，其中相对频率偏移等于由微扰引起的、存储在未受微扰场中的总能量的相对变化的负值。时间平均的存储电能是 $W_e = \\frac{1}{4} \\int_V \\mathbf{E}^* \\cdot (\\varepsilon \\mathbf{E}) \\, dV$，磁能是 $W_m = \\frac{1}{4} \\int_V \\mathbf{H}^* \\cdot (\\mu \\mathbf{H}) \\, dV$。对于一个本征模式，$W_e=W_m$。能量的微扰是 $\\delta W = \\delta W_e + \\delta W_m = \\frac{1}{4} \\int_V (\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} + \\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H}) \\, dV$。总的未受微扰能量是 $U = W_e + W_m = 2W_e = \\frac{1}{2} \\int_V \\mathbf{E}^* \\cdot \\varepsilon \\mathbf{E} \\, dV$。结果由 $\\delta\\omega/\\omega = -\\delta U / U$ 得出。在我们的符号体系中，这就是 $\\delta\\omega/\\omega = -(\\delta W_e+\\delta W_m)/(W_e+W_m)$。\n\n**第3部分：应用于TEM平面波**\n\n我们将第2部分推导出的微扰公式应用于给定的具体情况。\n未受微扰的场是：\n$\\mathbf{E}(\\mathbf{x}) = E_0 \\hat{\\mathbf{x}} \\exp(i k_0 z)$\n$\\mathbf{H}(\\mathbf{x}) = H_0 \\hat{\\mathbf{y}} \\exp(i k_0 z)$\n其中 $E_0$ 和 $H_0$ 代表振幅。根据麦克斯韦方程，振幅通过介质的本征阻抗 $Z = \\sqrt{\\mu/\\varepsilon}$ 相关联，使得 $E_0 = Z H_0$，或者 $H_0 = E_0/\\sqrt{\\mu/\\varepsilon} = E_0\\sqrt{\\varepsilon/\\mu}$。假设 $E_0$ 是实数，则 $H_0$ 也是实数，且 $H_0^2 = (\\varepsilon/\\mu)E_0^2$。\n\n微扰公式的分母是：\n$$\n2 \\int_V \\mathbf{E}^* \\cdot \\varepsilon \\mathbf{E} \\, dV = 2 \\int_V (E_0 \\hat{\\mathbf{x}} e^{-ik_0z}) \\cdot (\\varepsilon E_0 \\hat{\\mathbf{x}} e^{ik_0z}) \\, dV = 2 \\int_V \\varepsilon E_0^2 \\, dV\n$$\n由于 $\\varepsilon$ 和 $E_0$ 是常数，积分结果为 $2 \\varepsilon E_0^2 V$，其中 $V$ 是周期性盒子的体积。\n\n分子需要计算 $\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E}$ 和 $\\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H}$ 这两项。\n电场 $\\mathbf{E}$ 在 $\\hat{\\mathbf{x}}$ 方向上极化，因此它只探测介电常数微扰张量的 $\\delta\\varepsilon_{xx}$ 分量。\n$\\mathbf{E} = E_0 e^{ik_0z} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n$$\n\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} = (E_0 e^{-ik_0z} \\begin{pmatrix} 1 & 0 & 0 \\end{pmatrix}) (\\delta\\varepsilon) (E_0 e^{ik_0z} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}) = E_0^2 \\delta\\varepsilon_{xx}\n$$\n根据第1部分，$\\delta\\varepsilon_{xx} = \\eta\\varepsilon(\\alpha-\\beta-\\gamma)$。所以，$\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} = E_0^2 \\eta\\varepsilon(\\alpha-\\beta-\\gamma)$。\n\n磁场 $\\mathbf{H}$ 在 $\\hat{\\mathbf{y}}$ 方向上极化，因此它只探测 $\\delta\\mu_{yy}$ 分量。\n$\\mathbf{H} = H_0 e^{ik_0z} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n$$\n\\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H} = (H_0 e^{-ik_0z} \\begin{pmatrix} 0 & 1 & 0 \\end{pmatrix}) (\\delta\\mu) (H_0 e^{ik_0z} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}) = H_0^2 \\delta\\mu_{yy}\n$$\n根据第1部分，$\\delta\\mu_{yy} = \\eta\\mu(\\beta-\\alpha-\\gamma)$。所以，$\\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H} = H_0^2 \\eta\\mu(\\beta-\\alpha-\\gamma)$。\n代入 $H_0^2 = (\\varepsilon/\\mu)E_0^2$：\n$$\n\\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H} = \\left(\\frac{\\varepsilon}{\\mu}E_0^2\\right) \\eta\\mu(\\beta-\\alpha-\\gamma) = E_0^2 \\eta\\varepsilon(\\beta-\\alpha-\\gamma)\n$$\n分子中的被积函数是这两项之和，这两项在整个体积内是常数：\n$$\n\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} + \\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H} = E_0^2 \\eta\\varepsilon(\\alpha-\\beta-\\gamma) + E_0^2 \\eta\\varepsilon(\\beta-\\alpha-\\gamma)\n$$\n$$\n= E_0^2 \\eta\\varepsilon [(\\alpha-\\beta-\\gamma) + (\\beta-\\alpha-\\gamma)] = E_0^2 \\eta\\varepsilon (-2\\gamma) = -2\\gamma\\eta\\varepsilon E_0^2\n$$\n那么分子中的积分就是这个常数被积函数乘以体积 $V$：\n$$\n\\int_V (\\mathbf{E}^* \\cdot \\delta\\varepsilon \\mathbf{E} + \\mathbf{H}^* \\cdot \\delta\\mu \\mathbf{H}) \\, dV = -2\\gamma\\eta\\varepsilon E_0^2 V\n$$\n最后，我们计算相对频率偏移：\n$$\n\\frac{\\delta\\omega}{\\omega} = - \\frac{-2\\gamma\\eta\\varepsilon E_0^2 V}{2 \\varepsilon E_0^2 V} = \\frac{2\\gamma\\eta\\varepsilon E_0^2 V}{2 \\varepsilon E_0^2 V}\n$$\n$$\n\\frac{\\delta\\omega}{\\omega} = \\eta\\gamma\n$$\n结果表明，对于一个在 $z$ 方向传播的 TEM 平面波，由指定的雅可比误差引起的主阶相对频率偏移与对应于传播方向的雅可比误差系数 $\\gamma$ 成正比。",
            "answer": "$$\n\\boxed{\\eta \\gamma}\n$$"
        }
    ]
}