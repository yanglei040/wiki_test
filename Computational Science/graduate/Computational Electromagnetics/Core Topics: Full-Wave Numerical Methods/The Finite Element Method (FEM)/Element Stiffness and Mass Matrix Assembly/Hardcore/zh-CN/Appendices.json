{
    "hands_on_practices": [
        {
            "introduction": "任何有限元方法（FEM）代码的核心都是计算单元刚度矩阵 $K_e$ 和质量矩阵 $M_e$。这个练习提供了一个具体的“纸笔”推导过程，针对一个标准的二维双线性单元，帮助你理解这一基本步骤。通过该练习 ，你将亲手实践如何使用数值积分（高斯求积）来计算这些矩阵，并量化不同积分阶数对计算精度的影响，从而深刻理解数值积分在有限元分析中的关键作用。",
            "id": "3305143",
            "problem": "考虑二维时谐横电（TE）标量亥姆霍兹公式，该公式使用有限元法（FEM）在单个等参双线性四边形（$p=1$，$Q_{1}$）单元上进行离散。该单元在物理空间中是一个轴对齐的矩形，边长分别为 $a$ 和 $b$（单位：米）。介质是均匀且各向同性的，具有恒定的介电常数 $\\varepsilon$ 和磁导率 $\\mu$，角频率为 $\\omega$。设参考单元为方形区域 $[-1,1] \\times [-1,1]$，其标准双线性形函数为 $N_{i}(\\xi,\\eta)$，$i=1,\\dots,4$，并且到物理单元的仿射映射的雅可比行列式为 $\\det J = ab/4$。\n\n在此TE标量设置中，局部单元刚度矩阵和质量矩阵定义为\n$$\n(K_{e})_{ij} \\;=\\; \\int_{\\Omega_{e}} \\frac{1}{\\mu} \\nabla N_{i} \\cdot \\nabla N_{j} \\, \\mathrm{d}\\Omega, \n\\qquad\n(M_{e})_{ij} \\;=\\; \\int_{\\Omega_{e}} \\omega^{2} \\varepsilon \\, N_{i} N_{j} \\, \\mathrm{d}\\Omega.\n$$\n\n任务：\n1. 从上述弱形式定义和等参映射出发，将 $K_{e}$ 和 $M_{e}$ 表示为 $[-1,1]^{2}$ 上的参考积分，并使用 $2 \\times 2$ Gauss–Legendre 法则（每个方向上的节点为 $\\pm 1/\\sqrt{3}$，单位权重）进行精确计算。给出用 $a$、$b$、$\\mu$、$\\varepsilon$ 和 $\\omega$ 表示的精确单元矩阵。\n\n2. 使用 $1 \\times 1$ Gauss 法则（在 $[-1,1]^{2}$ 上，单个节点位于 $(0,0)$，权重为 $4$），计算相应的求积近似值 $K_{e}^{(1\\times 1)}$ 和 $M_{e}^{(1\\times 1)}$。\n\n3. 对于 $K_{e}$ 和 $M_{e}$，使用相对 Frobenius 范数误差来量化由 $1 \\times 1$ 法则引起的求积误差\n$$\nE_{K} \\;=\\; \\frac{\\|\\,K_{e}^{(1\\times 1)} - K_{e}\\,\\|_{F}}{\\|\\,K_{e}\\,\\|_{F}},\n\\qquad\nE_{M} \\;=\\; \\frac{\\|\\,M_{e}^{(1\\times 1)} - M_{e}\\,\\|_{F}}{\\|\\,M_{e}\\,\\|_{F}}.\n$$\n\n对于 $a = 0.3$，$b = 0.2$ 计算这些误差。将最终答案表示为行向量 $(E_{K}, E_{M})$，并将您的答案四舍五入到四位有效数字。将最终答案报告为无量纲数。",
            "solution": "首先对问题进行验证程序。\n\n### 步骤1：提取已知条件\n- **公式**：二维时谐横电（TE）标量亥姆霍兹方程。\n- **方法**：有限元法（FEM）。\n- **单元**：单个等参双线性四边形（$p=1$, $Q_1$）单元。\n- **物理域**：边长为 $a$ 和 $b$（单位：米）的轴对齐矩形 $\\Omega_e$。\n- **参考域**：坐标 $(\\xi, \\eta)$ 中的方形区域 $\\hat{\\Omega} = [-1,1] \\times [-1,1]$。\n- **映射**：从参考单元到物理单元的仿射映射，雅可比行列式为 $\\det J = ab/4$。\n- **材料属性**：均匀且各向同性的介质，具有恒定的介电常数 $\\varepsilon$ 和磁导率 $\\mu$。\n- **频率**：角频率 $\\omega$。\n- **形函数**：标准双线性形函数 $N_{i}(\\xi,\\eta)$，$i=1, \\dots, 4$。\n- **单元矩阵定义**：\n  - 刚度矩阵：$(K_{e})_{ij} = \\int_{\\Omega_{e}} \\frac{1}{\\mu} \\nabla N_{i} \\cdot \\nabla N_{j} \\, \\mathrm{d}\\Omega$\n  - 质量矩阵：$(M_{e})_{ij} = \\int_{\\Omega_{e}} \\omega^{2} \\varepsilon \\, N_{i} N_{j} \\, \\mathrm{d}\\Omega$\n- **任务1求积**：使用 $2 \\times 2$ Gauss-Legendre 求积法进行精确计算。\n- **任务2求积**：使用 $1 \\times 1$ Gauss 求积法进行近似计算。\n- **任务3误差度量**：相对 Frobenius 范数误差，$E_X = \\|\\,X_{e}^{(1\\times 1)} - X_{e}\\,\\|_{F}/\\|\\,X_{e}\\,\\|_{F}$，对于 $X \\in \\{K, M\\}$。\n- **任务3参数**：$a = 0.3$，$b = 0.2$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是有限元法在亥姆霍兹方程上的标准应用，而亥姆霍兹方程是计算电磁学的基石。刚度矩阵和质量矩阵的定义对于TE标量公式是正确的。等参映射是标准的。对于从 $2 \\times 2$ 正方形到 $a \\times b$ 矩形的仿射映射，指定的雅可比行列式是正确的。在参考单元上，刚度矩阵和质量矩阵的被积函数是关于每个变量（$\\xi$ 和 $\\eta$）次数最多为 $2$ 的多项式。一个 $2 \\times 2$ 的 Gauss-Legendre 求积法则可以精确地积分每个变量次数高达 $2 \\times 2 - 1 = 3$ 的多项式。因此，该法则提供精确计算的说法是正确的。该问题是适定的、客观的、自洽的，并且所有数据在物理上和数学上都是一致的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n求解过程首先将积分从物理单元 $\\Omega_e$ 转换到参考单元 $\\hat{\\Omega}$，然后计算这些积分以求得矩阵，最后计算指定的误差。\n\n**1. 等参映射和积分变换**\n设物理坐标为 $(x,y)$，参考坐标为 $(\\xi,\\eta)$。对于一个角点在原点的轴对齐矩形，仿射映射为 $x = \\frac{a}{2}(1+\\xi)$ 和 $y = \\frac{b}{2}(1+\\eta)$。此变换的雅可比矩阵为\n$$\nJ = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{a}{2} & 0 \\\\ 0 & \\frac{b}{2} \\end{pmatrix}\n$$\n行列式为 $\\det(J) = \\frac{ab}{4}$，逆雅可比矩阵为 $J^{-1} = \\begin{pmatrix} 2/a & 0 \\\\ 0 & 2/b \\end{pmatrix}$。\n物理坐标中的梯度算子变换如下：\n$$\n\\nabla_{(x,y)} = \\begin{pmatrix} \\frac{\\partial}{\\partial x} \\\\ \\frac{\\partial}{\\partial y} \\end{pmatrix} = (J^{-1})^T \\begin{pmatrix} \\frac{\\partial}{\\partial \\xi} \\\\ \\frac{\\partial}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{a} \\frac{\\partial}{\\partial \\xi} \\\\ \\frac{2}{b} \\frac{\\partial}{\\partial \\eta} \\end{pmatrix}\n$$\n面积微元变换为 $\\mathrm{d}\\Omega = \\det(J) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta = \\frac{ab}{4} \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$。\n\n双线性形函数为：\n$N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$，$N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$，$N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$，$N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$。\n\n**任务1：精确单元矩阵 ($K_e$, $M_e$)**\n\n质量矩阵积分变换到参考单元上：\n$$\n(M_e)_{ij} = \\int_{-1}^{1} \\int_{-1}^{1} \\omega^2 \\varepsilon N_i N_j \\left(\\frac{ab}{4}\\right) \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{\\omega^2 \\varepsilon ab}{4} \\int_{-1}^{1} \\int_{-1}^{1} N_i N_j \\, \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n设 $M_{ij}^{\\text{ref}} = \\int_{-1}^{1} \\int_{-1}^{1} N_i N_j \\, \\mathrm{d}\\xi \\mathrm{d}\\eta$。精确积分（或等效的 $2 \\times 2$ Gauss 法则）得出众所周知的参考质量矩阵：\n$$\nM^{\\text{ref}} = \\frac{1}{9} \\begin{pmatrix} 4 & 2 & 1 & 2 \\\\ 2 & 4 & 2 & 1 \\\\ 1 & 2 & 4 & 2 \\\\ 2 & 1 & 2 & 4 \\end{pmatrix}\n$$\n因此，精确的单元质量矩阵为：\n$$\nM_e = \\frac{\\omega^2 \\varepsilon ab}{36} \\begin{pmatrix} 4 & 2 & 1 & 2 \\\\ 2 & 4 & 2 & 1 \\\\ 1 & 2 & 4 & 2 \\\\ 2 & 1 & 2 & 4 \\end{pmatrix}\n$$\n\n刚度矩阵积分变换为：\n$$\n(K_e)_{ij} = \\int_{-1}^{1} \\int_{-1}^{1} \\frac{1}{\\mu} (\\nabla_{(x,y)} N_i \\cdot \\nabla_{(x,y)} N_j) \\left(\\frac{ab}{4}\\right) \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n点积为 $\\nabla N_i \\cdot \\nabla N_j = \\frac{4}{a^2} \\frac{\\partial N_i}{\\partial \\xi}\\frac{\\partial N_j}{\\partial \\xi} + \\frac{4}{b^2} \\frac{\\partial N_i}{\\partial \\eta}\\frac{\\partial N_j}{\\partial \\eta}$。\n$$\n(K_e)_{ij} = \\frac{ab}{4\\mu} \\int_{-1}^{1} \\int_{-1}^{1} \\left( \\frac{4}{a^2} \\frac{\\partial N_i}{\\partial \\xi}\\frac{\\partial N_j}{\\partial \\xi} + \\frac{4}{b^2} \\frac{\\partial N_i}{\\partial \\eta}\\frac{\\partial N_j}{\\partial \\eta} \\right) \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{b}{a\\mu} K_{ij}^\\xi + \\frac{a}{b\\mu} K_{ij}^\\eta\n$$\n其中 $K_{ij}^\\xi = \\int_{-1}^1 \\int_{-1}^1 \\frac{\\partial N_i}{\\partial \\xi}\\frac{\\partial N_j}{\\partial \\xi} \\mathrm{d}\\xi \\mathrm{d}\\eta$ 且 $K_{ij}^\\eta = \\int_{-1}^1 \\int_{-1}^1 \\frac{\\partial N_i}{\\partial \\eta}\\frac{\\partial N_j}{\\partial \\eta} \\mathrm{d}\\xi \\mathrm{d}\\eta$。\n精确积分给出标准参考矩阵：\n$$\nK^{\\xi} = \\frac{1}{6} \\begin{pmatrix} 2 & -2 & -1 & 1 \\\\ -2 & 2 & 1 & -1 \\\\ -1 & 1 & 2 & -2 \\\\ 1 & -1 & -2 & 2 \\end{pmatrix}, \\quad K^{\\eta} = \\frac{1}{6} \\begin{pmatrix} 2 & 1 & -1 & -2 \\\\ 1 & 2 & -2 & -1 \\\\ -1 & -2 & 2 & 1 \\\\ -2 & -1 & 1 & 2 \\end{pmatrix}\n$$\n结合这些，精确的单元刚度矩阵为：\n$$\nK_e = \\frac{1}{6\\mu} \\left[ \\frac{b}{a} \\begin{pmatrix} 2 & -2 & -1 & 1 \\\\ -2 & 2 & 1 & -1 \\\\ -1 & 1 & 2 & -2 \\\\ 1 & -1 & -2 & 2 \\end{pmatrix} + \\frac{a}{b} \\begin{pmatrix} 2 & 1 & -1 & -2 \\\\ 1 & 2 & -2 & -1 \\\\ -1 & -2 & 2 & 1 \\\\ -2 & -1 & 1 & 2 \\end{pmatrix} \\right]\n$$\n\n**任务2：使用 $1 \\times 1$ Gauss 法则的近似矩阵 ($K_e^{(1\\times 1)}$, $M_e^{(1\\times 1)}$)**\n\n$\\hat{\\Omega}$ 上的 $1 \\times 1$ Gauss 法则将积分近似为 $\\int_{-1}^1 \\int_{-1}^1 f(\\xi,\\eta) \\mathrm{d}\\xi\\mathrm{d}\\eta \\approx 4 f(0,0)$。\n在 $(\\xi,\\eta)=(0,0)$ 处，对所有 $i=1,\\dots,4$，有 $N_i(0,0) = 1/4$。\n参考质量矩阵的被积函数变为 $N_i(0,0)N_j(0,0) = 1/16$。\n$$\n(M_{e}^{(1\\times 1)})_{ij} = \\frac{\\omega^2 \\varepsilon ab}{4} \\left( 4 \\times N_i(0,0)N_j(0,0) \\right) = \\frac{\\omega^2 \\varepsilon ab}{4} \\left( 4 \\times \\frac{1}{16} \\right) = \\frac{\\omega^2 \\varepsilon ab}{16}\n$$\n这导致一个常数矩阵：\n$$\nM_e^{(1\\times 1)} = \\frac{\\omega^2 \\varepsilon ab}{16} \\begin{pmatrix} 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\n$$\n对于刚度矩阵，我们计算在 $(0,0)$ 处的形函数导数：\n$\\frac{\\partial N_1}{\\partial\\xi}=-\\frac{1}{4}, \\frac{\\partial N_2}{\\partial\\xi}=\\frac{1}{4}, \\frac{\\partial N_3}{\\partial\\xi}=\\frac{1}{4}, \\frac{\\partial N_4}{\\partial\\xi}=-\\frac{1}{4}$\n$\\frac{\\partial N_1}{\\partial\\eta}=-\\frac{1}{4}, \\frac{\\partial N_2}{\\partial\\eta}=-\\frac{1}{4}, \\frac{\\partial N_3}{\\partial\\eta}=\\frac{1}{4}, \\frac{\\partial N_4}{\\partial\\eta}=\\frac{1}{4}$\n用 $1 \\times 1$ 法则近似 $K^\\xi$ 和 $K^\\eta$：\n$(K^{\\xi, (1\\times 1)})_{ij} = 4 \\frac{\\partial N_i}{\\partial \\xi}(0,0) \\frac{\\partial N_j}{\\partial \\xi}(0,0)$。这给出：\n$$\nK^{\\xi, (1\\times 1)} = \\frac{4}{16} \\begin{pmatrix} -1 \\\\ 1 \\\\ 1 \\\\ -1 \\end{pmatrix} \\begin{pmatrix} -1 & 1 & 1 & -1 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 1 & -1 & -1 & 1 \\\\ -1 & 1 & 1 & -1 \\\\ -1 & 1 & 1 & -1 \\\\ 1 & -1 & -1 & 1 \\end{pmatrix}\n$$\n类似地，\n$$\nK^{\\eta, (1\\times 1)} = \\frac{4}{16} \\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix} \\begin{pmatrix} -1 & -1 & 1 & 1 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 1 & 1 & -1 & -1 \\\\ 1 & 1 & -1 & -1 \\\\ -1 & -1 & 1 & 1 \\\\ -1 & -1 & 1 & 1 \\end{pmatrix}\n$$\n近似刚度矩阵为 $K_e^{(1\\times 1)} = \\frac{b}{a\\mu}K^{\\xi, (1\\times 1)} + \\frac{a}{b\\mu}K^{\\eta, (1\\times 1)}$，即：\n$$\nK_e^{(1\\times 1)} = \\frac{1}{4\\mu} \\left[ \\frac{b}{a} \\begin{pmatrix} 1 & -1 & -1 & 1 \\\\ -1 & 1 & 1 & -1 \\\\ -1 & 1 & 1 & -1 \\\\ 1 & -1 & -1 & 1 \\end{pmatrix} + \\frac{a}{b} \\begin{pmatrix} 1 & 1 & -1 & -1 \\\\ 1 & 1 & -1 & -1 \\\\ -1 & -1 & 1 & 1 \\\\ -1 & -1 & 1 & 1 \\end{pmatrix} \\right]\n$$\n\n**任务3：求积误差评估**\n\n相对 Frobenius 范数误差为 $E_X = \\frac{\\|X_e^{(1\\times 1)} - X_e\\|_F}{\\|X_e\\|_F}$。注意，公共标量因子会抵消。\n\n对于质量矩阵，$E_M = \\frac{\\|\\frac{\\omega^2 \\varepsilon ab}{16} J_4 - \\frac{\\omega^2 \\varepsilon ab}{4} M^{\\text{ref}}\\|_F}{\\|\\frac{\\omega^2 \\varepsilon ab}{4} M^{\\text{ref}}\\|_F} = \\frac{\\|\\frac{1}{4} J_4 - M^{\\text{ref}}\\|_F}{\\|M^{\\text{ref}}\\|_F}$，其中 $J_4$ 是 $4 \\times 4$ 的全一矩阵。\n设 $\\Delta M = \\frac{1}{4} J_4 - M^{\\text{ref}} = \\frac{1}{36} \\left( 9 J_4 - 4 \\begin{pmatrix} 4 & 2 & 1 & 2 \\\\ \\dots \\end{pmatrix} \\right) = \\frac{1}{36} \\begin{pmatrix} -7 & 1 & 5 & 1 \\\\ 1 & -7 & 1 & 5 \\\\ 5 & 1 & -7 & 1 \\\\ 1 & 5 & 1 & -7 \\end{pmatrix}$。\n$\\|\\Delta M\\|_F^2 = (\\frac{1}{36})^2 \\left( 4 \\times ((-7)^2 + 1^2 + 5^2 + 1^2) \\right) = (\\frac{1}{36})^2 (4 \\times 76) = \\frac{304}{1296}$。\n$\\|M^{\\text{ref}}\\|_F^2 = (\\frac{1}{9})^2 \\left( 4 \\times (4^2+2^2+1^2+2^2) \\right) = (\\frac{1}{81}) (4 \\times 25) = \\frac{100}{81}$。\n$E_M^2 = \\frac{304/1296}{100/81} = \\frac{304}{1296} \\frac{81}{100} = \\frac{304}{16 \\times 100} = \\frac{19}{100} = 0.19$。\n$E_M = \\sqrt{0.19} \\approx 0.435889...$\n这个误差与 $a$ 和 $b$ 无关。\n\n对于刚度矩阵，我们设 $\\alpha = a/b$ 和 $\\beta = b/a$。因子 $1/\\mu$ 会抵消。\n设 $K'_e = 6\\mu K_e = \\beta(6K^\\xi) + \\alpha(6K^\\eta)$ 和 $K'^{(1\\times 1)}_e = 4\\mu K_e^{(1\\times 1)} = \\beta(4K^{\\xi,(1\\times 1)}) + \\alpha(4K^{\\eta,(1\\times 1)})$。缩放比例不同。我们使用 $K_e' = \\mu K_e$ 和 $K_e'^{(1\\times 1)} = \\mu K_e^{(1\\times 1)}$ 进行计算。\n$\\Delta K' = K_e'^{(1\\times 1)} - K_e' = \\beta(K^{\\xi,(1\\times 1)}-K^\\xi) + \\alpha(K^{\\eta,(1\\times 1)}-K^\\eta)$。\n$K^{\\xi,(1\\times 1)}-K^\\xi = \\frac{1}{4} \\begin{pmatrix} 1 & \\dots \\end{pmatrix} - \\frac{1}{6} \\begin{pmatrix} 2 & \\dots \\end{pmatrix} = \\frac{1}{12} \\begin{pmatrix} -1 & 1 & -1 & 1 \\\\ 1 & -1 & 1 & -1 \\\\ -1 & 1 & -1 & 1 \\\\ 1 & -1 & 1 & -1 \\end{pmatrix} = \\frac{1}{12}U$。\n可以证明 $K^{\\eta,(1\\times 1)}-K^\\eta = \\frac{1}{12}U$ 也成立。\n所以，$\\Delta K' = \\beta(\\frac{1}{12}U) + \\alpha(\\frac{1}{12}U) = \\frac{\\alpha+\\beta}{12}U$。\n$\\|\\Delta K'\\|_F^2 = \\left(\\frac{\\alpha+\\beta}{12}\\right)^2 \\|U\\|_F^2 = \\left(\\frac{\\alpha+\\beta}{12}\\right)^2 \\times 16 = \\frac{(\\alpha+\\beta)^2}{9}$。\n分母是 $\\|K'_e\\|_F^2 = \\|\\beta K^\\xi + \\alpha K^\\eta\\|_F^2 = \\beta^2\\|K^\\xi\\|_F^2 + \\alpha^2\\|K^\\eta\\|_F^2 + 2\\alpha\\beta \\langle K^\\xi, K^\\eta \\rangle_F$。\n$\\|K^\\xi\\|_F^2 = \\|K^\\eta\\|_F^2 = (\\frac{1}{6})^2(40) = \\frac{40}{36} = \\frac{10}{9}$。\n$\\langle K^\\xi, K^\\eta \\rangle_F = (\\frac{1}{6})^2 \\sum (6K^\\xi)_{ij}(6K^\\eta)_{ij} = \\frac{1}{36}(4) = \\frac{1}{9}$。\n$\\|K'_e\\|_F^2 = \\beta^2(\\frac{10}{9}) + \\alpha^2(\\frac{10}{9}) + 2\\alpha\\beta(\\frac{1}{9}) = \\frac{2}{9}(5\\alpha^2+5\\beta^2+\\alpha\\beta)$。\n$E_K^2 = \\frac{\\|\\Delta K'\\|_F^2}{\\|K'_e\\|_F^2} = \\frac{(\\alpha+\\beta)^2/9}{ \\frac{2}{9}(5\\alpha^2+5\\beta^2+\\alpha\\beta) } = \\frac{(\\alpha+\\beta)^2}{2(5\\alpha^2+5\\beta^2+\\alpha\\beta)}$。\n\n现在，我们代入 $a=0.3$ 和 $b=0.2$。\n$\\alpha = a/b = 1.5 = 3/2$。$\\beta = b/a = 2/3$。\n$\\alpha\\beta = 1$。$\\alpha+\\beta = 3/2 + 2/3 = 13/6$。$\\alpha^2 = 9/4$。$\\beta^2=4/9$。\n$E_K^2 = \\frac{(13/6)^2}{2(5(9/4) + 5(4/9) + 1)} = \\frac{169/36}{2(45/4 + 20/9 + 1)} = \\frac{169/36}{2((405+80+36)/36)} = \\frac{169}{2(521)} = \\frac{169}{1042}$。\n$E_K = \\sqrt{169/1042} = 13/\\sqrt{1042} \\approx 0.402720...$\n\n最终误差，四舍五入到四位有效数字，为：\n$E_K \\approx 0.4027$\n$E_M \\approx 0.4359$\n\n最终答案是行向量 $(E_K, E_M)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} 0.4027 & 0.4359 \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了单个单元矩阵的计算之后，下一步自然是将这些单元矩阵组装成一个全局系统。这个编码练习  将指导你完成这一过程，你需要为一个简单的一维问题构建全局刚度矩阵和质量矩阵。更重要的是，你将分析一个关键的数值特性——算子 $M^{-1}K$ 的条件数，并观察它如何随着网格的细化而变化，这对于理解离散系统的稳定性和求解效率至关重要。",
            "id": "3305124",
            "problem": "考虑理想导电腔体中横电模的 Maxwell 方程组的一维时谐简化形式，在区间域 $[0,1]$ 上，其齐次 Dirichlet 边界条件（$E(0)=0$ 和 $E(1)=0$）下的问题可以表示为以下弱形式的标量特征值问题：寻找 $u \\neq 0$ 于 $H_0^1(0,1)$ 中，使得\n$$\\int_{0}^{1} \\frac{d u}{d x} \\frac{d v}{d x} \\, dx = \\lambda \\int_{0}^{1} u \\, v \\, dx \\quad \\text{对所有 } v \\in H_0^1(0,1),$$\n其中 $\\lambda$ 是一个非负特征值。使用有限元法 (FEM)，通过协调的分片多项式基函数进行离散化，会产生一个对称正定的刚度矩阵 $K$ 和一个对称正定的质量矩阵 $M$，从而得到离散的广义特征值问题：\n$$K \\, \\mathbf{u} = \\lambda \\, M \\, \\mathbf{u},$$\n其中 $\\mathbf{u}$ 是离散场的系数向量。由 $M$-内积诱导的算子 $M^{-1}K$ 的条件数 (CN) 等于矩阵对 $(K,M)$ 的最大广义特征值 $\\lambda$ 与最小广义特征值之比：\n$$\\kappa(M^{-1}K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}}.$$\n您的任务是：使用固定的多项式阶数 $p=1$ 的标准、连续、分片线性 Lagrange 基函数，为 $[0,1]$ 上的一系列均匀加密的网格组装全局单元刚度矩阵和质量矩阵，施加齐次 Dirichlet 边界条件，并计算每个网格的 $\\kappa(M^{-1}K)$ 的数值。\n\n您必须从上述弱形式出发，并遵循以下基本的建模和离散化步骤，不得引入任何跳过这些步骤的简化公式：\n- 在 $[0,1]$ 上定义一个包含 $N$ 个单元的均匀网格，节点位于 $x_i = i h$ (其中 $i = 0,1,\\dots,N$, $h = 1/N$) 。\n- 在每个单元上，使用两个局部的、连续的、分片线性的 Lagrange 基函数，它们张成局部逼近空间，并将它们映射到物理单元上。\n- 通过计算每个单元上基函数及其导数的乘积的积分，精确计算局部单元刚度和质量的贡献。\n- 将这些局部贡献组装成与网格拓扑一致的全局刚度矩阵 $K$ 和质量矩阵 $M$。\n- 通过移除与边界节点 $x=0$ 和 $x=1$ 相关联的自由度 (DOF) 来施加齐次 Dirichlet 边界条件，从而得到大小为 $(N-1) \\times (N-1)$ 的简化矩阵。\n- 计算简化系统的矩阵对 $(K,M)$ 的广义特征值，然后计算 $\\kappa(M^{-1}K)$ 作为最大特征值与最小特征值之比。\n\n科学真实性要求：该模型是无量纲的，所有量都在单位区间 $[0,1]$ 上以一致的无量纲单位计算。\n\n设计一个程序，执行上述步骤，并为以下均匀网格测试套件计算 $\\kappa(M^{-1}K)$：\n- 正常路径：$N = 16$, $N = 32$。\n- 边界类最小内部自由度情况：$N = 2$。\n- 中等程度加密：$N = 4$, $N = 8$。\n- 加密趋势的显著边界情况：$N = 64$, $N = 128$。\n\n您的程序应生成单行输出，其中包含这些网格的条件数，按 $[N=2,N=4,N=8,N=16,N=32,N=64,N=128]$ 的顺序排列，形式为方括号括起来的逗号分隔列表（例如，$[a_1,a_2,\\dots,a_7]$），其中每个 $a_i$ 是一个浮点数，表示相应 $N$ 的 $\\kappa(M^{-1}K)$ 值。",
            "solution": "该问题要求计算一维特征值问题有限元离散化的条件数 $\\kappa(M^{-1}K)$。分析过程遵循有限元法 (FEM) 的指定步骤。\n\n该特征值问题的弱形式是寻找一个非平凡函数 $u \\in H_0^1(0,1)$ 和一个对应的特征值 $\\lambda \\ge 0$，使得：\n$$ \\int_{0}^{1} \\frac{d u}{d x} \\frac{d v}{d x} \\, dx = \\lambda \\int_{0}^{1} u \\, v \\, dx $$\n对所有测试函数 $v \\in H_0^1(0,1)$ 成立。空间 $H_0^1(0,1)$ 由在区间 $[0,1]$ 上一阶导数平方可积且在边界 $x=0$ 和 $x=1$ 处为零的函数组成。\n\n该问题的离散形式是广义矩阵特征值问题 $K \\mathbf{u} = \\lambda M \\mathbf{u}$，其中 $K$ 是刚度矩阵，$M$ 是质量矩阵。条件数定义为最大特征值与最小特征值之比，即 $\\kappa = \\lambda_{\\max}/\\lambda_{\\min}$。\n\n**1. 离散化与基函数**\n将区域 $[0,1]$ 离散化为包含 $N$ 个单元的均匀网格，每个单元的长度为 $h = 1/N$。节点位于 $x_i = i h$ (其中 $i \\in \\{0, 1, \\dots, N\\}$)。我们使用连续的分片线性 ($p=1$) Lagrange 基函数。在参考单元 $\\hat{I} = [0, 1]$ 上，两个局部基函数为：\n$$ \\hat{\\phi}_1(\\hat{x}) = 1 - \\hat{x} $$\n$$ \\hat{\\phi}_2(\\hat{x}) = \\hat{x} $$\n它们关于参考坐标 $\\hat{x}$ 的导数为：\n$$ \\frac{d\\hat{\\phi}_1}{d\\hat{x}} = -1 \\quad \\text{和} \\quad \\frac{d\\hat{\\phi}_2}{d\\hat{x}} = 1 $$\n\n**2. 单元矩阵**\n一个仿射映射将参考单元坐标 $\\hat{x} \\in [0,1]$ 变换到长度为 $h$ 的单元 $I_e = [x_{i-1}, x_i]$ 中的物理坐标 $x$：\n$$ x(\\hat{x}) = x_{i-1} + h\\hat{x} $$\n积分的变量替换为 $dx = h \\, d\\hat{x}$，导数的链式法则给出 $\\frac{d\\phi}{dx} = \\frac{d\\hat{\\phi}}{d\\hat{x}}\\frac{d\\hat{x}}{dx} = \\frac{1}{h}\\frac{d\\hat{\\phi}}{d\\hat{x}}$。\n\n局部的 $2 \\times 2$ 单元刚度矩阵 $K^e$ 的元素由下式给出：\n$$ K^e_{ij} = \\int_{I_e} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} \\, dx = \\int_{0}^{1} \\left(\\frac{1}{h}\\frac{d\\hat{\\phi}_i}{d\\hat{x}}\\right) \\left(\\frac{1}{h}\\frac{d\\hat{\\phi}_j}{d\\hat{x}}\\right) h \\, d\\hat{x} = \\frac{1}{h} \\int_{0}^{1} \\frac{d\\hat{\\phi}_i}{d\\hat{x}}\\frac{d\\hat{\\phi}_j}{d\\hat{x}} \\, d\\hat{x} $$\n对 $i,j \\in \\{1,2\\}$ 计算该积分，得到：\n$$ K^e = \\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\n局部的 $2 \\times 2$ 单元质量矩阵 $M^e$ 的元素由下式给出：\n$$ M^e_{ij} = \\int_{I_e} \\phi_i \\phi_j \\, dx = \\int_{0}^{1} \\hat{\\phi}_i(\\hat{x}) \\hat{\\phi}_j(\\hat{x}) h \\, d\\hat{x} = h \\int_{0}^{1} \\hat{\\phi}_i(\\hat{x})\\hat{\\phi}_j(\\hat{x}) \\, d\\hat{x} $$\n计算该积分得到：\n$$ M^e = \\frac{h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} $$\n\n**3. 全局组装**\n全局刚度矩阵 $K$ 和质量矩阵 $M$ 的大小均为 $(N+1) \\times (N+1)$，对应于网格中的 $N+1$ 个节点。它们是通过将 $N$ 个局部单元矩阵的贡献相加来组装的。对于连接节点 $i-1$ 和 $i$ 的单元，其局部矩阵的元素被加到相应的全局矩阵位置上。此过程会产生以下对称三对角全局矩阵（在施加边界条件之前）：\n$$ K = \\frac{1}{h} \\begin{pmatrix} 1 & -1 & & \\\\ -1 & 2 & -1 & \\\\ & \\ddots & \\ddots & \\ddots & \\\\ & & -1 & 2 & -1 \\\\ & & & -1 & 1 \\end{pmatrix}, \\quad M = \\frac{h}{6} \\begin{pmatrix} 2 & 1 & & \\\\ 1 & 4 & 1 & \\\\ & \\ddots & \\ddots & \\ddots & \\\\ & & 1 & 4 & 1 \\\\ & & & 1 & 2 \\end{pmatrix} $$\n\n**4. 边界条件施加**\n齐次 Dirichlet 边界条件 $u(0)=0$ 和 $u(1)=0$ 意味着与边界节点（节点 $0$ 和节点 $N$）相关的解系数为零。通过从全局矩阵中移除第一行（索引为 $0$）和最后一行（索引为 $N$）以及第一列和最后一列，可以从系统中消除这些自由度。这将产生简化的刚度矩阵 $K_{red}$ 和质量矩阵 $M_{red}$，两者的大小均为 $(N-1) \\times (N-1)$，对应于内部节点 $1, 2, \\dots, N-1$。\n$$ K_{red} = \\frac{1}{h} \\begin{pmatrix} 2 & -1 & & \\\\ -1 & 2 & -1 & \\\\ & \\ddots & \\ddots & \\ddots \\\\ & & -1 & 2 & -1 \\\\ & & & -1 & 2 \\end{pmatrix}_{(N-1) \\times (N-1)} $$\n$$ M_{red} = \\frac{h}{6} \\begin{pmatrix} 4 & 1 & & \\\\ 1 & 4 & 1 & \\\\ & \\ddots & \\ddots & \\ddots \\\\ & & 1 & 4 & 1 \\\\ & & & 1 & 4 \\end{pmatrix}_{(N-1) \\times (N-1)} $$\n\n**5. 广义特征值问题与条件数**\n最后一步是求解简化的广义特征值问题 $K_{red}\\mathbf{u}_{int} = \\lambda M_{red}\\mathbf{u}_{int}$，以得到 $N-1$ 个特征值 $\\{\\lambda_j\\}$。这些特征值是数值计算得出的。然后通过计算这些特征值中的最大值与最小值之比来得到条件数：\n$$ \\kappa(M^{-1}K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} $$\n下面的算法为指定的 $N$ 值实现了此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Computes the condition number of the FEM operator M^-1 K for a 1D\n    eigenvalue problem on a series of uniformly refined meshes.\n    \"\"\"\n    # Define the test cases from the problem statement, ordered as required for output.\n    test_cases = [2, 4, 8, 16, 32, 64, 128]\n\n    results = []\n    for N in test_cases:\n        # Mesh parameter\n        h = 1.0 / N\n        \n        # Reduced system size (number of interior nodes)\n        # N elements, N+1 total nodes, N-1 interior nodes\n        size_reduced = N - 1\n\n        if size_reduced == 0:\n            # If N=1, there are no interior nodes, the problem is ill-defined.\n            # For N=2, size_reduced is 1, a valid 1x1 system.\n            # All test cases have N >= 2.\n            raise ValueError(\"Number of elements N must be >= 2 for interior DOFs.\")\n\n        # Step 1: Define local element stiffness and mass matrices.\n        # These are computed from the integrals of basis functions and their\n        # derivatives over a reference element.\n        K_local = (1.0 / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n        M_local = (h / 6.0) * np.array([[2.0, 1.0], [1.0, 2.0]])\n\n        # Step 2: Assemble global matrices.\n        # Global matrices are of size (N+1)x(N+1) corresponding to all nodes.\n        size_global = N + 1\n        K_global = np.zeros((size_global, size_global))\n        M_global = np.zeros((size_global, size_global))\n\n        # Loop over elements and add local contributions to global matrices.\n        for i in range(N):\n            # Element `i` connects nodes `i` and `i+1`.\n            # The local 2x2 matrix is added to the corresponding block \n            # of the global matrix.\n            K_global[i:i+2, i:i+2] += K_local\n            M_global[i:i+2, i:i+2] += M_local\n\n        # Step 3: Enforce homogeneous Dirichlet boundary conditions.\n        # This is done by removing the rows and columns corresponding to the\n        # boundary nodes (node 0 and node N). The reduced matrices correspond\n        # to the interior nodes (1, 2, ..., N-1).\n        K_reduced = K_global[1:N, 1:N]\n        M_reduced = M_global[1:N, 1:N]\n\n        # Step 4: Compute the generalized eigenvalues.\n        # eigh is used because the matrices are symmetric and positive-definite.\n        # It solves the problem A*x = lambda*B*x.\n        eigenvalues = eigh(K_reduced, M_reduced, eigvals_only=True)\n        \n        # Step 5: Compute the condition number.\n        # For a single eigenvalue (case N=2), max and min are the same.\n        lambda_min = np.min(eigenvalues)\n        lambda_max = np.max(eigenvalues)\n        \n        condition_number = lambda_max / lambda_min\n        results.append(condition_number)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际应用中，尤其是在时域仿真中，为了提高计算效率，我们常常用对角化的“集中质量矩阵”代替“一致质量矩阵”。这个最后的编码练习  旨在探讨这一实用选择所带来的后果。你将通过分析和编程，比较这两种质量矩阵对系统数值色散的影响，而数值色散是衡量波在离散网格中传播保真度的关键指标。",
            "id": "3305148",
            "problem": "考虑在间距为 $h$ 的均匀网格上，使用周期性边界条件，在波速 $c = 1$ 的无量纲单位下，对 Maxwell 方程组进行无损、无源的一维 ($1$D) 横向电磁 (TEM) 简化。从 Faraday 定律和 Ampère 定律中消去磁场，可得到关于电场分量 $E(x,t)$ 的二阶波动方程，\n$$\n\\frac{\\partial^2 E}{\\partial t^2} = c^2 \\frac{\\partial^2 E}{\\partial x^2}.\n$$\n在均匀网格上，使用 Galerkin 有限元法 (FEM) 和连续分段线性基函数，通过在整个网格上组合单元的贡献，得到的半离散系统为\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中 $\\mathbf{u}(t)$ 是电场的节点值，$\\mathbf{M}$ 是单元组合质量矩阵，$\\mathbf{K}$ 是单元组合刚度矩阵。定义两种质量矩阵的变体：\n- 一致质量矩阵 $\\mathbf{M}_{\\mathrm{c}}$，通过精确的单元积分得到。\n- 集中质量矩阵 $\\mathbf{M}_{\\mathrm{l}}$，通过对一致矩阵进行行和集中得到。\n\n使用步长为 $\\Delta t$ 的显式中心差分格式在时间上进行推进，\n$$\n\\mathbf{M}\\,\\frac{\\mathbf{u}^{n+1} - 2\\,\\mathbf{u}^{n} + \\mathbf{u}^{n-1}}{\\Delta t^2} + \\mathbf{K}\\,\\mathbf{u}^{n} = \\mathbf{0},\n$$\n其中 $\\mathbf{u}^{n}$ 表示在时间层 $t^n = n\\,\\Delta t$ 的节点向量。\n\n您的任务：\n- 从上述基本定律和定义出发，推导在长度为 $h$ 的区间上的单个线性有限元的单元矩阵，以及在均匀周期性网格上组合得到的 $\\mathbf{M}_{\\mathrm{c}}$、$\\mathbf{M}_{\\mathrm{l}}$ 和 $\\mathbf{K}$ 的三对角形式。\n- 在无限均匀网格上使用 Fourier (von Neumann) 分析，推导连接无量纲时间频率 $\\Omega$、无量纲空间相位增量 $\\theta = k\\,h$、时间步长 $\\Delta t$ 以及组合算子 ($\\mathbf{M}_{\\mathrm{c}}$ 和 $\\mathbf{M}_{\\mathrm{l}}$ 两者) 的 Fourier 符号的离散色散关系。\n- 将离散相速度定义为\n$$\nc_{\\mathrm{ph}}^{\\mathrm{num}}(\\theta,\\Delta t) = \\frac{(\\Omega/\\Delta t)}{(k)} = \\frac{h\\,\\Omega}{\\Delta t\\,\\theta},\n$$\n- 将相对相速度误差定义为\n$$\ne(\\theta,\\Delta t) = \\left|\\,c_{\\mathrm{ph}}^{\\mathrm{num}}(\\theta,\\Delta t) - 1\\,\\right|.\n$$\n- 为确保在共同的稳定性限制下进行公平比较，选择时间步长为\n$$\n\\Delta t = \\alpha\\,\\frac{h}{c}\\,\\sqrt{\\frac{1}{3}},\n$$\n其中用户选择的类 Courant 因子 $\\alpha \\in (0,1)$ 同样地应用于 $\\mathbf{M}_{\\mathrm{c}}$ 和 $\\mathbf{M}_{\\mathrm{l}}$。\n\n实现一个程序，该程序：\n- 对于下面指定的每个测试用例，使用从组合单元矩阵和显式格式推导出的色散关系，分别计算一致质量矩阵和集中质量矩阵的相对相速度误差 $e_{\\mathrm{c}}$ 和 $e_{\\mathrm{l}}$。\n- 将结果汇总为一个对偶列表 $[e_{\\mathrm{c}}, e_{\\mathrm{l}}]$（每个测试用例一对），并以 Python 风格的列表形式在单行上打印出来。\n\n使用以下测试套件，其中每个用例指定了 $(h, \\theta, \\alpha)$：\n- 用例 1: $h = 0.1$, $\\theta = \\pi/16$, $\\alpha = 0.2$。\n- 用例 2: $h = 0.1$, $\\theta = \\pi/2$, $\\alpha = 0.9$。\n- 用例 3: $h = 0.1$, $\\theta = 7\\pi/8$, $\\alpha = 0.9$。\n- 用例 4: $h = 0.1$, $\\theta = \\pi$, $\\alpha = 0.99$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用逗号分隔并用方括号括起来的列表，每个子列表对应一个测试用例，顺序与上述相同，例如 $[[e_{\\mathrm{c},1}, e_{\\mathrm{l},1}],[e_{\\mathrm{c},2}, e_{\\mathrm{l},2}],\\dots]$。\n- 每个 $e_{\\mathrm{c}}$ 和 $e_{\\mathrm{l}}$ 必须是浮点数。\n- 角度以弧度为单位，不使用物理单位（无量纲公式）。",
            "solution": "该问题被评估为有效，因为它在科学上基于计算电磁学和数值分析的原理，其定义完整且一致，问题本身是适定的，并且用客观、正式的语言表述。因此，我们可以继续进行推导和求解。\n\n主要目标是分析波速 $c=1$ 的一维波动方程的 Galerkin 有限元法 (FEM) 解的数值色散特性。该分析在使用显式中心差分时间积分格式时，比较了质量矩阵的两种变体：一致质量矩阵 ($\\mathbf{M}_{\\mathrm{c}}$) 和集中质量矩阵 ($\\mathbf{M}_{\\mathrm{l}}$)。\n\n**1. 弱形式与单元矩阵的推导**\n\nGalerkin 有限元法从控制方程的弱（或变分）形式开始。我们将波动方程乘以一个测试函数 $\\phi(x)$，并在空间域上进行积分。对空间导数项进行分部积分后，半离散弱形式为：寻找电场近似解 $E_h(x,t) = \\sum_j u_j(t) \\phi_j(x)$，使得对于每个基函数 $\\phi_i$ 都满足，\n$$\n\\int \\phi_i \\frac{\\partial^2 E_h}{\\partial t^2} dx + \\int c^2 \\frac{\\partial \\phi_i}{\\partial x} \\frac{\\partial E_h}{\\partial x} dx = 0.\n$$\n将 $E_h$ 的展开式代入，并设 $c=1$，得到矩阵系统 $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}$，其中全局质量矩阵 $\\mathbf{M}$ 和刚度矩阵 $\\mathbf{K}$ 的各项是由单元级的贡献组合而成的：\n$$\nM_{ij} = \\int \\phi_i \\phi_j dx \\quad \\text{和} \\quad K_{ij} = \\int \\frac{\\partial \\phi_i}{\\partial x} \\frac{\\partial \\phi_j}{\\partial x} dx.\n$$\n我们考虑一个定义在局部区间 $[0, h]$ 上、长度为 $h$ 的单个有限元。该单元节点 $1$ 和 $2$ 的连续分段线性基函数（帽函数）为：\n$$\n\\phi_1(x) = 1 - \\frac{x}{h}, \\quad \\phi_2(x) = \\frac{x}{h} \\quad \\text{for } x \\in [0, h].\n$$\n它们的导数为 $\\frac{d\\phi_1}{dx} = -\\frac{1}{h}$ 和 $\\frac{d\\phi_2}{dx} = \\frac{1}{h}$。\n\n单元刚度矩阵 $\\mathbf{K}^{(e)}$ 计算如下：\n$$\nK_{ij}^{(e)} = \\int_0^h \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} dx \\implies \\mathbf{K}^{(e)} = \\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}.\n$$\n单元一致质量矩阵 $\\mathbf{M}_{\\mathrm{c}}^{(e)}$ 通过对基函数的乘积进行积分计算得出：\n$$\nM_{c,ij}^{(e)} = \\int_0^h \\phi_i(x) \\phi_j(x) dx \\implies \\mathbf{M}_{\\mathrm{c}}^{(e)} = \\frac{h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}.\n$$\n\n**2. 组合算子与集中化**\n\n对于均匀周期性网格，全局矩阵是循环矩阵。这种矩阵作用于一个向量的效果，可以通过在每个节点 $j$ 应用一个重复的模板来描述。该模板由共享节点 $j$ 的两个单元 $[x_{j-1}, x_j]$ 和 $[x_j, x_{j+1}]$ 的贡献组合而成。\n刚度算子 $\\mathbf{K}$ 作用于节点 $j$ 的节点向量 $\\mathbf{u}$ 的模板是：\n$$\n(\\mathbf{K}\\mathbf{u})_j = \\frac{1}{h}(-u_{j-1} + 2u_j - u_{j+1}), \\quad \\text{模板: } \\frac{1}{h}[-1, 2, -1].\n$$\n一致质量算子 $\\mathbf{M}_{\\mathrm{c}}$ 的模板是：\n$$\n(\\mathbf{M}_{\\mathrm{c}}\\ddot{\\mathbf{u}})_j = \\frac{h}{6}(\\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1}), \\quad \\text{模板: } \\frac{h}{6}[1, 4, 1].\n$$\n集中质量矩阵 $\\mathbf{M}_{\\mathrm{l}}$ 是通过将 $\\mathbf{M}_{\\mathrm{c}}$ 的每一行的元素求和，并将结果置于对角线上得到的。对于模板 $\\frac{h}{6}[1, 4, 1]$，行和为 $\\frac{h}{6}(1+4+1) = h$。这产生一个对角矩阵 $\\mathbf{M}_{\\mathrm{l}} = h\\mathbf{I}$，其中 $\\mathbf{I}$ 是单位矩阵。其算子作用很简单：\n$$\n(\\mathbf{M}_{\\mathrm{l}}\\ddot{\\mathbf{u}})_j = h\\ddot{u}_j.\n$$\n\n**3. Fourier 分析与算子符号**\n\n我们通过将离散平面波解 $u_j^n = \\hat{u} e^{i(k x_j - \\Omega t^n)}$ 代入完全离散化的中心差分格式来进行 Fourier 分析：\n$$\n\\mathbf{M}\\,\\frac{\\mathbf{u}^{n+1} - 2\\,\\mathbf{u}^{n} + \\mathbf{u}^{n-1}}{\\Delta t^2} + \\mathbf{K}\\,\\mathbf{u}^{n} = \\mathbf{0}.\n$$\n令 $\\theta = kh$ 为每个单元的无量纲空间相位增量。一个基于模板的算子作用于这个波，就变成了乘以其 Fourier 符号。\n刚度算子的 Fourier 符号 $\\hat{K}(\\theta)$ 是：\n$$\n\\hat{K}(\\theta) = \\frac{1}{h}(-e^{-i\\theta} + 2 - e^{i\\theta}) = \\frac{1}{h}(2 - 2\\cos\\theta) = \\frac{4\\sin^2(\\theta/2)}{h}.\n$$\n一致质量算子的 Fourier 符号 $\\hat{M}_{\\mathrm{c}}(\\theta)$ 是：\n$$\n\\hat{M}_{\\mathrm{c}}(\\theta) = \\frac{h}{6}(e^{-i\\theta} + 4 + e^{i\\theta}) = \\frac{h}{6}(4 + 2\\cos\\theta) = \\frac{h}{3}(2 + \\cos\\theta).\n$$\n集中质量算子的 Fourier 符号 $\\hat{M}_{\\mathrm{l}}(\\theta)$ 仅仅是 $\\hat{M}_{\\mathrm{l}}(\\theta) = h$。\n时间差分算子变为：\n$$\n\\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{\\Delta t^2} \\rightarrow \\frac{e^{-i\\Omega} - 2 + e^{i\\Omega}}{\\Delta t^2} = \\frac{2(\\cos\\Omega - 1)}{\\Delta t^2} = -\\frac{4\\sin^2(\\Omega/2)}{\\Delta t^2}.\n$$\n\n**4. 离散色散关系的推导**\n\n将这些符号代入变换后的离散方程，得到：\n$$\n\\hat{M}(\\theta) \\left( -\\frac{4\\sin^2(\\Omega/2)}{\\Delta t^2} \\right) + \\hat{K}(\\theta) = 0 \\implies \\sin^2\\left(\\frac{\\Omega}{2}\\right) = \\frac{\\Delta t^2}{4} \\frac{\\hat{K}(\\theta)}{\\hat{M}(\\theta)}.\n$$\n这给出了一般色散关系：\n$$\n\\Omega = 2 \\arcsin\\left(\\frac{\\Delta t}{2} \\sqrt{\\frac{\\hat{K}(\\theta)}{\\hat{M}(\\theta)}}\\right).\n$$\n我们现在针对两种质量矩阵将此公式具体化。\n\n对于一致质量矩阵 ($\\mathbf{M}_{\\mathrm{c}}$)：\n$$\n\\frac{\\hat{K}(\\theta)}{\\hat{M}_{\\mathrm{c}}(\\theta)} = \\frac{4\\sin^2(\\theta/2)/h}{h/3(2+\\cos\\theta)} = \\frac{12\\sin^2(\\theta/2)}{h^2(2+\\cos\\theta)} = \\frac{12\\sin^2(\\theta/2)}{h^2(3-2\\sin^2(\\theta/2))}.\n$$\n对于集中质量矩阵 ($\\mathbf{M}_{\\mathrm{l}}$)：\n$$\n\\frac{\\hat{K}(\\theta)}{\\hat{M}_{\\mathrm{l}}(\\theta)} = \\frac{4\\sin^2(\\theta/2)/h}{h} = \\frac{4\\sin^2(\\theta/2)}{h^2}.\n$$\n将这些比率代入 $\\Omega$ 的方程，得到 $\\Omega_{\\mathrm{c}}$ 和 $\\Omega_{\\mathrm{l}}$ 的特定色散关系。\n\n**5. 数值相速度与误差**\n\n问题指定时间步长为 $\\Delta t = \\alpha \\frac{h}{c} \\sqrt{\\frac{1}{3}} = \\alpha h \\sqrt{1/3}$，因为 $c=1$。\n数值相速度定义为 $c_{\\mathrm{ph}}^{\\mathrm{num}} = \\frac{\\Omega/\\Delta t}{k} = \\frac{h\\Omega}{\\theta\\Delta t}$。代入 $\\Delta t$ 的表达式：\n$$\nc_{\\mathrm{ph}}^{\\mathrm{num}} = \\frac{h\\Omega}{\\theta (\\alpha h \\sqrt{1/3})} = \\frac{\\sqrt{3}\\,\\Omega}{\\alpha\\,\\theta}.\n$$\n对于**一致质量矩阵**，将相应的比率代入 $\\Omega$ 的公式：\n$$\n\\Omega_{\\mathrm{c}} = 2 \\arcsin\\left( \\frac{\\alpha h \\sqrt{1/3}}{2} \\sqrt{\\frac{12\\sin^2(\\theta/2)}{h^2(3-2\\sin^2(\\theta/2))}} \\right) = 2 \\arcsin\\left( \\frac{\\alpha \\sin(\\theta/2)}{\\sqrt{3-2\\sin^2(\\theta/2)}} \\right).\n$$\n因此相速度为：\n$$\nc_{\\mathrm{ph}, \\mathrm{c}}^{\\mathrm{num}} = \\frac{2\\sqrt{3}}{\\alpha\\,\\theta} \\arcsin\\left( \\frac{\\alpha \\sin(\\theta/2)}{\\sqrt{3-2\\sin^2(\\theta/2)}} \\right).\n$$\n对于**集中质量矩阵**，推导过程类似：\n$$\n\\Omega_{\\mathrm{l}} = 2 \\arcsin\\left( \\frac{\\alpha h \\sqrt{1/3}}{2} \\sqrt{\\frac{4\\sin^2(\\theta/2)}{h^2}} \\right) = 2 \\arcsin\\left( \\frac{\\alpha}{\\sqrt{3}} \\sin(\\theta/2) \\right).\n$$\n其相速度为：\n$$\nc_{\\mathrm{ph}, \\mathrm{l}}^{\\mathrm{num}} = \\frac{2\\sqrt{3}}{\\alpha\\,\\theta} \\arcsin\\left( \\frac{\\alpha}{\\sqrt{3}} \\sin(\\theta/2) \\right).\n$$\n每种情况的相对相速度误差计算为 $e = |c_{\\mathrm{ph}}^{\\mathrm{num}} - 1|$。这些是在程序中实现的最终公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative phase-velocity errors for a 1D FEM wave equation\n    simulation using consistent and lumped mass matrices.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (h, theta, alpha)\n    test_cases = [\n        (0.1, np.pi / 16.0, 0.2),\n        (0.1, np.pi / 2.0, 0.9),\n        (0.1, 7.0 * np.pi / 8.0, 0.9),\n        (0.1, np.pi, 0.99),\n    ]\n\n    results = []\n    for h, theta, alpha in test_cases:\n        # The mesh spacing 'h' is not needed in the final algebraic expressions\n        # for the normalized phase velocity, but is kept for contextual clarity.\n        \n        # Common terms\n        sin_theta_half = np.sin(theta / 2.0)\n        sqrt3 = np.sqrt(3.0)\n\n        # --- Consistent Mass Matrix Calculation ---\n        \n        # Argument of arcsin for the numerical frequency Omega_c\n        arg_c_arcsin = (alpha * sin_theta_half) / np.sqrt(3.0 - 2.0 * sin_theta_half**2)\n        \n        # The argument must be = 1 for a stable, non-dissipative scheme.\n        if arg_c_arcsin > 1.0:\n            arg_c_arcsin = 1.0 # Cap at stability limit for a real result\n            \n        # Numerical frequency Omega_c\n        omega_c = 2.0 * np.arcsin(arg_c_arcsin)\n        \n        # Numerical phase velocity c_ph_c\n        # Formula: c_ph = (sqrt(3) * Omega) / (alpha * theta)\n        c_ph_c = (sqrt3 * omega_c) / (alpha * theta)\n        \n        # Relative phase velocity error e_c\n        e_c = np.abs(c_ph_c - 1.0)\n        \n        # --- Lumped Mass Matrix Calculation ---\n        \n        # Argument of arcsin for the numerical frequency Omega_l\n        arg_l_arcsin = (alpha * sin_theta_half) / sqrt3\n\n        # The argument must be = 1 for stability.\n        if arg_l_arcsin > 1.0:\n            arg_l_arcsin = 1.0\n\n        # Numerical frequency Omega_l\n        omega_l = 2.0 * np.arcsin(arg_l_arcsin)\n        \n        # Numerical phase velocity c_ph_l\n        c_ph_l = (sqrt3 * omega_l) / (alpha * theta)\n\n        # Relative phase velocity error e_l\n        e_l = np.abs(c_ph_l - 1.0)\n\n        results.append([e_c, e_l])\n\n    # Format the output string as a Python-style list of lists,\n    # with no spaces within sublists, e.g., [[e_c1,e_l1],[e_c2,e_l2]].\n    output_str = f\"[{','.join(f'[{ec},{el}]' for ec, el in results)}]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}