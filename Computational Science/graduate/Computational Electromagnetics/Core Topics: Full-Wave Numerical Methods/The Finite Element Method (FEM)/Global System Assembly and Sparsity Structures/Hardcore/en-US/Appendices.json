{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the finite element method lies in assembling a large global system from small, local element matrices. This exercise provides a concrete, step-by-step walkthrough of this process for a minimal mesh, revealing how the choice of numerical formulation—in this case, an interior penalty discontinuous Galerkin method—directly dictates which degrees of freedom become coupled in the final global matrix . By manually constructing the sparsity pattern, you will gain a tangible understanding of how local element connectivity translates into a global sparse structure.",
            "id": "3312154",
            "problem": "Consider the frequency-domain Maxwell curl-curl formulation for Transverse Electric (TE) polarization in two spatial dimensions, where the in-plane electric field $\\mathbf{E}(x,y)$ satisfies the variational problem with uniform material parameters: magnetic permeability $\\mu > 0$ and electric permittivity $\\epsilon > 0$. Let the computational domain be the unit square $\\Omega=[0,1]\\times[0,1]$, partitioned into two triangles $\\mathcal{T}_{1}$ and $\\mathcal{T}_{2}$ that exactly tile the square: $\\mathcal{T}_{1}$ with vertices $\\mathbf{v}_{1}=(0,0)$, $\\mathbf{v}_{2}=(1,0)$, $\\mathbf{v}_{3}=(0,1)$, and $\\mathcal{T}_{2}$ with vertices $\\mathbf{v}_{4}=(1,1)$, $\\mathbf{v}_{5}=(0,1)$, $\\mathbf{v}_{6}=(1,0)$. The interior edge shared by $\\mathcal{T}_{1}$ and $\\mathcal{T}_{2}$ is the segment joining $(1,0)$ and $(0,1)$.\n\nAdopt the lowest-order Nédélec first-kind edge elements on each triangle, with three edge-based basis functions per triangle, and define the degrees of freedom associated with each oriented geometric edge by the line integral of the tangential component of $\\mathbf{E}$ over that edge. On each triangle $\\mathcal{T}$ with barycentric coordinates $\\lambda_{1}$, $\\lambda_{2}$, $\\lambda_{3}$ and constant gradients $\\nabla\\lambda_{i}$, use the canonical edge basis functions associated with edge $\\mathbf{v}_{i}\\mathbf{v}_{j}$:\n$$\n\\mathbf{N}_{ij}=\\lambda_{i}\\nabla\\lambda_{j}-\\lambda_{j}\\nabla\\lambda_{i},\\quad i\\neq j,\\quad i,j\\in\\{1,2,3\\}.\n$$\nDiscretize the TE variational problem in a broken $H(\\mathrm{curl})$ space and employ an interior penalty discontinuous Galerkin formulation on the internal edge only, with a symmetric consistent numerical flux and penalty parameter $\\sigma > 0$, so that the global system retains all per-element edge degrees of freedom without conforming identification across the interface. Assume that the boundary is perfectly matched with no external coupling terms added to the bilinear form so that only the interior-edge numerical flux contributes inter-element coupling.\n\nNumber the six global degrees of freedom by assigning the three edge degrees of freedom of $\\mathcal{T}_{1}$ first and those of $\\mathcal{T}_{2}$ second, in the following order: for $\\mathcal{T}_{1}$, DOF 1 is the bottom edge from $(0,0)$ to $(1,0)$, DOF 2 is the left edge from $(0,0)$ to $(0,1)$, and DOF 3 is the interior diagonal edge from $(1,0)$ to $(0,1)$ as seen by $\\mathcal{T}_{1}$; for $\\mathcal{T}_{2}$, DOF 4 is the top edge from $(0,1)$ to $(1,1)$, DOF 5 is the interior diagonal edge from $(1,0)$ to $(0,1)$ as seen by $\\mathcal{T}_{2}$, and DOF 6 is the right edge from $(1,0)$ to $(1,1)$.\n\nStarting from Maxwell's equations and the definition of the lowest-order Nédélec first-kind basis functions, explicitly construct the $3\\times 3$ element stiffness matrix $A_{e}$ for each triangle, expressing each entry symbolically in terms of $\\mu$, $\\epsilon$, the angular frequency $\\omega$, the triangle area $|\\mathcal{T}|$, and the constant quantities $\\nabla\\lambda_{i}$ for that triangle. Then perform global assembly in the broken $H(\\mathrm{curl})$ interior penalty formulation described above and determine the sparsity structure of the resulting $6\\times 6$ global stiffness matrix under the degree-of-freedom numbering specified. Provide the final sparsity pattern as a $0$-$1$ matrix, where an entry is $1$ if and only if the corresponding matrix entry is structurally nonzero and $0$ otherwise. Express your final answer as a single $6\\times 6$ matrix. No rounding is required. No units are to be included in the final answer.",
            "solution": "The problem asks for the sparsity structure of a $6 \\times 6$ global stiffness matrix resulting from a discontinuous Galerkin finite element discretization of the 2D vector Helmholtz equation. The process involves analyzing the structure of the element matrices and the coupling terms introduced by the interior penalty method.\n\n### Step 1: Problem Validation\n\nThe problem is validated by extracting the givens and assessing them against the criteria of scientific soundness, well-posedness, and objectivity.\n\n**Extracted Givens:**\n-   **Equation:** Frequency-domain Maxwell curl-curl formulation for TE polarization, $\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) - \\omega^2 \\epsilon \\mathbf{E} = 0$.\n-   **Domain:** Unit square $\\Omega=[0,1]\\times[0,1]$.\n-   **Mesh:** Two triangles, $\\mathcal{T}_{1}$ with vertices $(0,0), (1,0), (0,1)$ and $\\mathcal{T}_{2}$ with vertices $(1,1), (0,1), (1,0)$.\n-   **Shared Edge:** The segment joining $(1,0)$ and $(0,1)$.\n-   **Discretization:** Lowest-order Nédélec first-kind edge elements, $\\mathbf{N}_{ij}=\\lambda_{i}\\nabla\\lambda_{j}-\\lambda_{j}\\nabla\\lambda_{i}$.\n-   **Formulation:** Broken $H(\\mathrm{curl})$ space with a symmetric, consistent interior penalty discontinuous Galerkin (IPDG) method on the internal edge only.\n-   **Degrees of Freedom (DOFs):** Non-conforming, with 6 total DOFs.\n    -   $\\mathcal{T}_{1}$ DOFs: 1: $(0,0)\\to(1,0)$, 2: $(0,0)\\to(0,1)$, 3: $(1,0)\\to(0,1)$.\n    -   $\\mathcal{T}_{2}$ DOFs: 4: $(0,1)\\to(1,1)$, 5: $(1,0)\\to(0,1)$, 6: $(1,0)\\to(1,1)$.\n\n**Validation Verdict:**\nThe problem is scientifically grounded, rooted in the standard finite element analysis of Maxwell's equations. The formulation, including Nédélec elements and IPDG, is a well-established topic in computational electromagnetics. The problem is well-posed, providing a detailed and self-consistent setup that leads to a unique sparsity pattern. The language is objective and precise. The problem is deemed **valid**.\n\n### Step 2: Derivation of the Sparsity Pattern\n\nThe global matrix $A$ is assembled from contributions from each element and the interior edge. The entry $A_{ij}$ is computed from a bilinear form $a_h(\\mathbf{N}_j, \\mathbf{N}_i)$, where $\\mathbf{N}_k$ is the global basis function for DOF $k$.\n$$\na_h(\\mathbf{U}, \\mathbf{V}) = \\sum_{k=1}^{2} \\int_{\\mathcal{T}_k} \\left( \\frac{1}{\\mu} (\\nabla \\times \\mathbf{U}) (\\nabla \\times \\mathbf{V}) - \\omega^2 \\epsilon \\mathbf{U} \\cdot \\mathbf{V} \\right) d\\mathbf{x} + j_{e}(\\mathbf{U}, \\mathbf{V})\n$$\nwhere $j_e$ is the IPDG term on the interior edge $e$.\n\n**Element Matrix Structure**\n\nFor each triangle $\\mathcal{T}$, the local element matrix $A_e$ has entries $A_{e,ij} = a_{\\mathcal{T}}(\\mathbf{N}_j, \\mathbf{N}_i)$, where $a_{\\mathcal{T}}$ is the part of the bilinear form integrated over $\\mathcal{T}$.\n$A_e = \\frac{1}{\\mu} K_e - \\omega^2 \\epsilon M_e$, with\n$$\nK_{e,ij} = \\int_{\\mathcal{T}} (\\nabla \\times \\mathbf{N}_i) (\\nabla \\times \\mathbf{N}_j) d\\mathbf{x}\n$$\n$$\nM_{e,ij} = \\int_{\\mathcal{T}} \\mathbf{N}_i \\cdot \\mathbf{N}_j d\\mathbf{x}\n$$\nFor the lowest-order Nédélec basis function $\\mathbf{N}_{uv} = \\lambda_u\\nabla\\lambda_v - \\lambda_v\\nabla\\lambda_u$, its curl is a constant on the triangle: $\\nabla \\times \\mathbf{N}_{uv} = 2 \\det(\\nabla\\lambda_u, \\nabla\\lambda_v)$. It can be shown that for any pair of vertices $u,v,w,z$ on a triangle, $\\det(\\nabla\\lambda_u, \\nabla\\lambda_v) = \\pm\\det(\\nabla\\lambda_w, \\nabla\\lambda_z)$. Therefore, for the three basis functions on a single triangle, the curl is a constant $C_{\\mathcal{T}}$ (up to a sign, which squares out). The stiffness matrix entries are $K_{e,ij} = C_{\\mathcal{T}}^2 |\\mathcal{T}| / \\mu$, which are all non-zero. The stiffness matrix $K_e$ is a dense $3 \\times 3$ matrix.\n\nThe mass matrix entries $M_{e,ij}$ involve integrals of products of different basis functions. These basis functions are not orthogonal, and for a general triangle, $\\int_{\\mathcal{T}} \\mathbf{N}_i \\cdot \\mathbf{N}_j d\\mathbf{x} \\neq 0$ for $i \\neq j$. Thus, $M_e$ is also a dense $3 \\times 3$ matrix.\n\nConsequently, the element matrix $A_e$ is a dense $3 \\times 3$ matrix. This means the diagonal blocks of the global matrix, $A(1:3, 1:3)$ and $A(4:6, 4:6)$, are dense.\n\n**IPDG Coupling Structure**\n\nThe off-diagonal blocks of the global matrix are populated exclusively by the IPDG terms on the interior edge $e$. The IPDG bilinear form $j_e$ is given by\n$$\nj_e(\\mathbf{U}, \\mathbf{V}) = - \\int_e \\left( \\{\\!\\{ \\frac{1}{\\mu} \\nabla \\times \\mathbf{U} \\}\\!\\}_z [\\![ \\mathbf{V} \\times \\mathbf{n} ]\\!]_z + \\{\\!\\{ \\frac{1}{\\mu} \\nabla \\times \\mathbf{V} \\}\\!\\}_z [\\![ \\mathbf{U} \\times \\mathbf{n} ]\\!]_z \\right) ds + \\int_e \\sigma [\\![ \\mathbf{U} \\times \\mathbf{n} ]\\!]_z [\\![ \\mathbf{V} \\times \\mathbf{n} ]\\!]_z ds\n$$\nwhere $\\{\\!\\{ \\cdot \\}\\!\\}_z$ is the average of the scalar z-component of the curl, and $[\\![ \\cdot \\times \\mathbf{n} ]\\!]_z$ is the jump of the tangential component. Let $\\mathbf{t}$ be the unit tangent to $e$. The jump is $[\\![ \\mathbf{U} \\cdot \\mathbf{t} ]\\!] = \\mathbf{U}_1 \\cdot \\mathbf{t} - \\mathbf{U}_2 \\cdot \\mathbf{t}$.\nA coupling term $A_{ij}$ between a DOF $i$ on $\\mathcal{T}_1$ and a DOF $j$ on $\\mathcal{T}_2$ is non-zero only if $j_e(\\mathbf{N}_j, \\mathbf{N}_i) \\neq 0$. This requires the tangential traces of both $\\mathbf{N}_i$ and $\\mathbf{N}_j$ to be non-zero on the edge $e$.\n\n**Analysis of Basis Functions on the Interface**\n\nLet's analyze the tangential trace of each basis function on the interface edge $e$, which is the segment from $(1,0)$ to $(0,1)$ with equation $x+y=1$. The tangent vector is $\\mathbf{t} = (-1/\\sqrt{2}, 1/\\sqrt{2})$.\n\nFor $\\mathcal{T}_1$ (vertices $\\mathbf{v}_1=(0,0), \\mathbf{v}_2=(1,0), \\mathbf{v}_3=(0,1)$):\nThe barycentric coordinates are $\\lambda_1 = 1-x-y$, $\\lambda_2 = x$, $\\lambda_3 = y$. The interface is edge $\\mathbf{v}_2\\mathbf{v}_3$.\n-   **DOF 1 (edge $\\mathbf{v}_1\\mathbf{v}_2$):** Basis $\\mathbf{N}_1 \\propto \\mathbf{N}_{12} = \\lambda_1\\nabla\\lambda_2 - \\lambda_2\\nabla\\lambda_1 = (1-y, x)$. On $e$, $y=1-x$, so $\\mathbf{N}_1|_e = (x,x)$. The tangential component is $\\mathbf{N}_1|_e \\cdot \\mathbf{t} = (x,x) \\cdot (-1/\\sqrt{2}, 1/\\sqrt{2}) = 0$.\n-   **DOF 2 (edge $\\mathbf{v}_1\\mathbf{v}_3$):** Basis $\\mathbf{N}_2 \\propto \\mathbf{N}_{13} = \\lambda_1\\nabla\\lambda_3 - \\lambda_3\\nabla\\lambda_1 = (y, 1-x)$. On $e$, $\\mathbf{N}_2|_e = (1-x, 1-x)$. The tangential component is $\\mathbf{N}_2|_e \\cdot \\mathbf{t} = (1-x, 1-x) \\cdot (-1/\\sqrt{2}, 1/\\sqrt{2}) = 0$.\n-   **DOF 3 (edge $\\mathbf{v}_2\\mathbf{v}_3$):** Basis $\\mathbf{N}_3 \\propto \\mathbf{N}_{23} = \\lambda_2\\nabla\\lambda_3 - \\lambda_3\\nabla\\lambda_2 = (-y, x)$. On $e$, $\\mathbf{N}_3|_e = (x-1, x)$. The tangential component is $\\mathbf{N}_3|_e \\cdot \\mathbf{t} = (x-1, x) \\cdot (-1/\\sqrt{2}, 1/\\sqrt{2}) = (1-x+x)/\\sqrt{2} = 1/\\sqrt{2} \\neq 0$.\n\nFor $\\mathcal{T}_2$ (vertices $\\mathbf{v}_4=(1,1), \\mathbf{v}_5=(0,1), \\mathbf{v}_6=(1,0)$):\nThe interface is edge $\\mathbf{v}_6\\mathbf{v}_5$.\n-   **DOF 4 (edge $\\mathbf{v}_5\\mathbf{v}_4$):** By symmetry with DOF 2 (both are horizontal/vertical legs of a right triangle, evaluated on the hypotenuse), the tangential component on $e$ is zero.\n-   **DOF 5 (edge $\\mathbf{v}_6\\mathbf{v}_5$):** This is the interface edge itself. By analogy with DOF 3, its basis function $\\mathbf{N}_5$ will have a non-zero tangential component on $e$.\n-   **DOF 6 (edge $\\mathbf{v}_6\\mathbf{v}_4$):** By symmetry with DOF 1, the tangential component on $e$ is zero.\n\nThe crucial finding is that only basis functions associated with the interface edge itself (DOF 3 and DOF 5) have a non-zero tangential trace on that interface. Therefore, the IPDG formulation only creates coupling between DOF 3 and DOF 5. All other off-diagonal block entries are zero.\n\n**Global Sparsity Pattern Construction**\n\n1.  The submatrix for DOFs on $\\mathcal{T}_1$, $A(1:3, 1:3)$, is dense due to the element matrix being dense.\n2.  The submatrix for DOFs on $\\mathcal{T}_2$, $A(4:6, 4:6)$, is dense for the same reason.\n3.  The off-diagonal coupling $A_{ij}$ for $i \\in \\{1,2,3\\}, j \\in \\{4,5,6\\}$ is non-zero only if $i=3$ and $j=5$.\n4.  Similarly, $A_{ji}$ is non-zero only if $j=5$ and $i=3$.\n\nThis leads to the following sparsity pattern, where $1$ denotes a structurally non-zero entry and $0$ denotes a zero entry:\n-   Rows/Cols 1, 2, 3 form a dense block.\n-   Rows/Cols 4, 5, 6 form a dense block.\n-   Coupling exists only at entries $(3,5)$ and $(5,3)$.\n\nThe resulting $6 \\times 6$ sparsity matrix is:\n$$\n\\begin{pmatrix}\n1 & 1 & 1 & 0 & 0 & 0 \\\\\n1 & 1 & 1 & 0 & 0 & 0 \\\\\n1 & 1 & 1 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1 & 1 & 1 \\\\\n0 & 0 & 1 & 1 & 1 & 1 \\\\\n0 & 0 & 0 & 1 & 1 & 1\n\\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 1 & 1 & 0 & 0 & 0 \\\\\n1 & 1 & 1 & 0 & 0 & 0 \\\\\n1 & 1 & 1 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1 & 1 & 1 \\\\\n0 & 0 & 1 & 1 & 1 & 1 \\\\\n0 & 0 & 0 & 1 & 1 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While direct assembly is instructive, for large-scale simulations, we must be able to predict matrix structure from mesh topology alone. This practice challenges you to derive a general rule for the sparsity of a finite element matrix by analyzing the local connectivity around an arbitrary interior edge in a tetrahedral mesh . The resulting formula, which connects the number of nonzero entries per row to the number of tetrahedra sharing an edge, is a powerful tool for estimating the memory and computational costs of a simulation based on local mesh characteristics.",
            "id": "3312149",
            "problem": "Consider the frequency-domain Maxwell curl-curl operator assembled by the Finite Element Method (FEM) using first-order Nédélec edge elements (first family) on a conforming tetrahedral mesh of a simply connected domain with constant magnetic permeability. The bilinear form is\n$$\na(\\mathbf{u},\\mathbf{v})=\\int_{\\Omega} (\\nabla\\times \\mathbf{u})\\cdot(\\nabla\\times \\mathbf{v})\\,\\mathrm{d}\\Omega,\n$$\nand the global stiffness matrix $K$ is obtained by standard element-wise assembly over tetrahedra. Each tetrahedron has $6$ edge-associated basis functions and contributes a $6\\times 6$ local matrix to $K$. For an interior edge, the associated edge basis function has support on all tetrahedra incident to that edge.\n\nAssume a regular tetrahedralization around a given interior edge $\\{v_{0},v_{1}\\}$, in the sense that the set of tetrahedra incident to $\\{v_{0},v_{1}\\}$ consists of $m$ tetrahedra of the form $\\{v_{0},v_{1},w_{i},w_{i+1}\\}$, with indices $i$ taken modulo $m$, and the vertices $\\{w_{i}\\}_{i=1}^{m}$ are distinct and form a cyclic ring around the edge. Under these conditions, estimate the average number of nonzero entries in the interior row of $K$ corresponding to the degree of freedom (DOF) associated with the edge $\\{v_{0},v_{1}\\}$, counting the diagonal entry and counting distinct coupled DOFs only once.\n\nProvide your answer as a closed-form expression in terms of $m$. No rounding is required and no physical units are needed.",
            "solution": "The problem asks for the number of nonzero entries in a row of the global stiffness matrix $K$ assembled using the Finite Element Method (FEM) for the Maxwell curl-curl operator. The matrix entry $K_{ij}$ is given by the bilinear form $a(\\mathbf{N}_j, \\mathbf{N}_i)$, where $\\mathbf{N}_i$ and $\\mathbf{N}_j$ are the vector basis functions associated with degrees of freedom (DOFs) $i$ and $j$, respectively. In this case, the DOFs are associated with the edges of a tetrahedral mesh, and the basis functions are first-order Nédélec edge elements.\n\nA matrix entry $K_{ij}$ is non-zero if and only if the supports of the basis functions $\\mathbf{N}_i$ and $\\mathbf{N}_j$ have a non-empty intersection, and the integral of their curls over this intersection is non-zero. For first-order Nédélec elements on a tetrahedron $T$, the basis function $\\mathbf{N}_e$ associated with an edge $e$ is non-zero within $T$ if and only if $e$ is one of the edges of $T$. The global bilinear form is a sum of integrals over all tetrahedra in the mesh $\\Omega$:\n$$\nK_{ij} = a(\\mathbf{N}_j, \\mathbf{N}_i) = \\sum_{T \\in \\Omega} \\int_T (\\nabla \\times \\mathbf{N}_j) \\cdot (\\nabla \\times \\mathbf{N}_i) \\, \\mathrm{d}V\n$$\nThe integral over a specific tetrahedron $T$ is non-zero only if both $\\mathbf{N}_i$ and $\\mathbf{N}_j$ are non-zero within $T$. This means that both edges $e_i$ and $e_j$ must be edges of the tetrahedron $T$. Consequently, $K_{ij}$ is non-zero if and only if there exists at least one tetrahedron in the mesh that contains both edge $e_i$ and edge $e_j$.\n\nWe are interested in the number of non-zero entries in the row of $K$ corresponding to a specific interior edge, which we denote as $e_0 = \\{v_0, v_1\\}$. This is equivalent to counting the number of edges $e_j$ (including $e_0$ itself) that share at least one tetrahedron with $e_0$.\n\nThe problem states that the local mesh structure around $e_0$ is a 'regular tetrahedralization' consisting of $m$ tetrahedra incident to $e_0$. These tetrahedra are given by $T_i = \\{v_0, v_1, w_i, w_{i+1}\\}$ for $i = 1, \\dots, m$, where the indices on $w$ are taken modulo $m$ (so $w_{m+1} = w_1$). The set of tetrahedra containing $e_0$ is $\\mathcal{T}(e_0) = \\{T_1, T_2, \\dots, T_m\\}$.\n\nAn edge $e_j$ will be coupled with $e_0$ (i.e., $K_{0j} \\neq 0$) if $e_j$ is an edge of any tetrahedron $T_i \\in \\mathcal{T}(e_0)$. Therefore, our task is to find the total number of unique edges that are part of the geometric complex formed by the union of these $m$ tetrahedra, $\\bigcup_{i=1}^m T_i$.\n\nWe can classify all edges in this complex into four distinct groups:\n1.  The central edge itself: This is the edge $e_0 = \\{v_0, v_1\\}$. It is shared by all $m$ tetrahedra. This accounts for $1$ edge, which corresponds to the diagonal entry of the matrix row.\n\n2.  Edges connecting the vertex $v_0$ to the ring of vertices $\\{w_i\\}_{i=1}^m$: These are the \"spoke\" edges of the form $\\{v_0, w_i\\}$. Since the $m$ vertices $w_i$ are distinct, this gives $m$ distinct edges: $\\{v_0, w_1\\}, \\{v_0, w_2\\}, \\dots, \\{v_0, w_m\\}$. Each edge $\\{v_0, w_i\\}$ is shared by two adjacent tetrahedra in the fan, namely $T_{i-1} = \\{v_0, v_1, w_{i-1}, w_i\\}$ and $T_i = \\{v_0, v_1, w_i, w_{i+1}\\}$. This group contributes $m$ unique edges.\n\n3.  Edges connecting the vertex $v_1$ to the ring of vertices $\\{w_i\\}_{i=1}^m$: Similarly, these are spoke edges of the form $\\{v_1, w_i\\}$. This gives another $m$ distinct edges: $\\{v_1, w_1\\}, \\{v_1, w_2\\}, \\dots, \\{v_1, w_m\\}$. Each edge $\\{v_1, w_i\\}$ is also shared by two adjacent tetrahedra, $T_{i-1}$ and $T_i$. This group contributes another $m$ unique edges.\n\n4.  Edges forming the outer ring: These edges connect consecutive vertices in the ring $\\{w_i\\}_{i=1}^m$. They are of the form $\\{w_i, w_{i+1}\\}$ for $i=1, \\dots, m$. Each such edge belongs to exactly one tetrahedron in the local complex, namely $T_i = \\{v_0, v_1, w_i, w_{i+1}\\}$. This gives $m$ distinct edges: $\\{w_1, w_2\\}, \\{w_2, w_3\\}, \\dots, \\{w_m, w_1\\}$. This group contributes a final $m$ unique edges.\n\nThese four sets of edges are mutually disjoint. An edge is defined by its two endpoint vertices. The vertices involved are $v_0$, $v_1$, and $\\{w_i\\}$.\n- An edge from group 2, $\\{v_0, w_i\\}$, cannot be in group 3, $\\{v_1, w_j\\}$, since $v_0 \\neq v_1$.\n- An edge from group 2 or 3 cannot be in group 4, $\\{w_j, w_k\\}$, since neither $v_0$ nor $v_1$ are in the set of $w$ vertices.\n- The central edge $\\{v_0, v_1\\}$ is distinct from all other groups, as they all involve at least one $w$ vertex.\n\nThe total number of unique edges coupled to $e_0$ is the sum of the counts from these four disjoint groups.\nTotal number of coupled edges = (central edge) + (spokes from $v_0$) + (spokes from $v_1$) + (ring edges)\nTotal number = $1 + m + m + m = 3m + 1$.\n\nThis is the number of non-zero entries in the row of the stiffness matrix $K$ corresponding to the degree of freedom associated with the interior edge $\\{v_0, v_1\\}$. The phrase \"average number\" in the problem statement, in the context of a perfectly \"regular tetrahedralization\", is interpreted as the deterministic count for this idealized configuration.",
            "answer": "$$\n\\boxed{3m+1}\n$$"
        },
        {
            "introduction": "The ideal, regular meshes of theoretical analysis are rarely achieved in practice; real-world models often contain defects or missing components. This advanced computational exercise explores the profound impact of such topological defects on the algebraic properties of the assembled discrete operator, guiding you to discover the \"percolation threshold\" where the system's underlying connectivity breaks down . By observing the link between the removal of mesh faces and the growing dimension of the matrix kernel, you will gain insight into critical challenges that arise in preconditioning and solving linear systems from imperfectly connected domains.",
            "id": "3312144",
            "problem": "Consider a two-dimensional periodic rectangular lattice modeling a toroidal discretization of a domain used in Computational Electromagnetics (CEM). The lattice has $N_x$ cells in the horizontal direction and $N_y$ cells in the vertical direction, with periodic boundary conditions in both directions. The mesh is represented by a cell complex with nodes, oriented edges, and oriented faces. The oriented edges are of two types: horizontal edges aligned with the $x$-direction and vertical edges aligned with the $y$-direction. Let the total number of edges be $E = 2 N_x N_y$ and the total number of faces be $F = N_x N_y$. A defect pattern is introduced by removing a subset of faces to model missing cells. This is a standard abstraction in global system assembly where entries of the global operator arise from local contributions associated with mesh entities; missing faces remove local contributions, modifying the sparsity and topological connectivity.\n\nStarting from Maxwell's equations and the differential operator definitions, one can define a discrete curl operator on the edge space. The discrete curl maps edge degrees of freedom to face circulations by summing the oriented edge values around each face boundary. The face-edge incidence matrix $C \\in \\mathbb{R}^{F \\times E}$ encodes these oriented sums, and the discrete curl–curl operator on edges with unit Hodge weights is $A = C^\\top C \\in \\mathbb{R}^{E \\times E}$. When faces are removed, the corresponding rows are removed from $C$, inducing changes in $A$ such as altered sparsity and connectivity. The kernel of $A$ is equal to the kernel of $C$, and its dimension is $E - \\operatorname{rank}(C)$.\n\nThe objective is to assemble $A$ for periodic but defective connectivity (missing faces), and to study the percolation threshold at which the edge adjacency graph induced by $A$ becomes disconnected. At this threshold, the kernel dimension of $A$ increases, complicating preconditioning. The adjacency graph is defined on the set of edges, where two distinct edges are adjacent if the corresponding off-diagonal entry of $A$ is nonzero. The number of connected components of this graph quantifies disconnection. The percolation threshold is defined here as the minimal fraction $p \\in [0,1]$ of faces removed such that the adjacency graph has more than one connected component.\n\nYour program must implement the following steps for each test case:\n1. Construct the periodic lattice with given $N_x$ and $N_y$ and enumerate the horizontal and vertical oriented edges and faces.\n2. Assemble the face-edge incidence matrix $C$ by assigning orientations so that each face’s row equals the algebraic sum of its four boundary edges in counterclockwise order, with the appropriate signs for orientation consistency.\n3. Initialize with no missing faces, then remove faces one by one in a random order (with a specified random seed for reproducibility), recomputing $C$ and $A = C^\\top C$ after each removal.\n4. After each removal, compute:\n   - The number of connected components in the edge adjacency graph induced by the off-diagonal nonzero pattern of $A$.\n   - The kernel dimension $E - \\operatorname{rank}(C)$ using a numerically stable singular value decomposition with a tolerance threshold $t = 10^{-10}$ for singular values considered zero.\n5. Stop when the graph becomes disconnected (number of components strictly greater than $1$), report the minimal fraction removed $p$ at disconnection, and report the number of connected components and kernel dimension at that threshold.\n\nYou must start from the fundamental base consisting of:\n- Maxwell’s equations and the definition of the curl operator.\n- The definition of oriented incidence in cell complexes.\n- The discrete operator assembly principle whereby global operators are formed by summing local contributions associated with mesh entities.\n\nThe program must produce a single line of output containing the aggregated results for all test cases as a comma-separated list enclosed in square brackets, where each test result is itself a list of `[p, components, nullity]` with `$p$` a float and the other entries integers. No physical units are involved in this problem.\n\nUse the following test suite:\n- Test case $1$: $N_x = 3$, $N_y = 3$, random seed $s = 7$.\n- Boundary test case $2$: $N_x = 1$, $N_y = 1$, random seed $s = 42$.\n- Test case $3$: $N_x = 5$, $N_y = 3$, random seed $s = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[[p_1, c_1, n_1],[p_2, c_2, n_2],[p_3, c_3, n_3]]`, with each `$p_k$` in decimal form and each `$c_k$` and `$n_k$` integers.",
            "solution": "The problem posed is a valid, well-defined exercise in computational electromagnetics, grounded in the principles of discrete exterior calculus (DEC). It concerns the assembly of discrete operators on a periodic lattice and the analysis of their algebraic and topological properties as the domain is altered. We will proceed with a rigorous, step-by-step solution.\n\nThe foundation of this problem lies in the discretization of Maxwell's curl equations on a cellular complex, which here is a two-dimensional toroidal rectangular lattice. The geometric entities of this complex are a set of $0$-cells (nodes or vertices), $1$-cells (oriented edges), and $2$-cells (oriented faces). The physical degrees of freedom, such as a component of the electric field, are associated with these entities.\n\nLet the lattice have $N_x$ cells in the horizontal direction and $N_y$ cells in the vertical direction. Due to periodic boundary conditions, the lattice is topologically a torus. The number of faces (or $2$-cells) is $F = N_x N_y$, the number of vertices ($0$-cells) is $V = N_x N_y$, and the number of edges ($1$-cells) is $E = 2 N_x N_y$.\n\nThe relationship between these entities is captured by boundary operators. The discrete curl operator is represented by the face-edge incidence matrix, denoted as $C \\in \\mathbb{R}^{F \\times E}$. This matrix is a discrete representation of the continuous curl operator, mapping vector fields (represented by values on edges, i.e., $1$-forms) to scalar fields (represented by circulations on faces, i.e., $2$-forms).\n\nThe assembly of $C$ follows from the definition of the boundary of a face. We establish a consistent enumeration and orientation.\nLet faces be indexed by $k \\in \\{0, \\dots, F-1\\}$, and edges by $m \\in \\{0, \\dots, E-1\\}$. The entry $C_{km}$ is non-zero only if edge $m$ is part of the boundary of face $k$. Specifically, for a face $f_k$ with a counter-clockwise orientation, its boundary $\\partial f_k$ is a formal sum of its four boundary edges. The value of $C_{km}$ is $+1$ if edge $m$ is part of $\\partial f_k$ and its orientation matches the counter-clockwise traversal, and $-1$ if its orientation is opposite.\n\nTo implement this, we define a coordinate system $(i, j)$ for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_y-1\\}$.\n- A face at $(i,j)$ is indexed $k = j \\cdot N_x + i$.\n- A horizontal edge starting at node $(i,j)$ is indexed $m = j \\cdot N_x + i$, for $m \\in \\{0, \\dots, F-1\\}$.\n- A vertical edge starting at node $(i,j)$ is indexed $m = F + j \\cdot N_x + i$, for $m \\in \\{F, \\dots, E-1\\}$.\nAll spatial indices $i$ and $j$ are taken modulo $N_x$ and $N_y$ respectively, to enforce periodicity.\n\nThe four oriented edges bounding face $(i,j)$ are:\n1. Bottom: horizontal edge at $(i,j)$, sign $+1$.\n2. Right: vertical edge at $(i+1, j)$, sign $+1$.\n3. Top: horizontal edge at $(i, j+1)$, sign $-1$ (since CCW traversal is right-to-left, opposite to edge orientation).\n4. Left: vertical edge at $(i, j)$, sign $-1$ (since CCW traversal is top-to-bottom, opposite to edge orientation).\nThese rules define the non-zero entries for each row of $C$.\n\nFrom $C$, we construct the discrete curl-curl operator $A = C^\\top C$, an $E \\times E$ matrix. An off-diagonal entry $A_{uv} = (C^\\top C)_{uv} = \\sum_k C_{ku} C_{kv}$ is non-zero if and only if edges $u$ and $v$ share at least one common face. This matrix $A$ can thus be interpreted as the adjacency matrix (up to its diagonal) of a graph where the nodes are the edges of the lattice.\n\nThe problem investigates the effect of removing faces, which models defects in the material or domain. Removing a face $f_k$ is equivalent to removing the $k$-th row from the matrix $C$. This alters $A = C^\\top C$, breaking connections in the edge-adjacency graph. The primary objective is to find the percolation threshold: the minimal fraction $p$ of randomly removed faces that disconnects this graph.\n\nThe algorithmic procedure is as follows:\n1. For a given $N_x$, $N_y$, and random seed $s$, we first assemble the full incidence matrix $C$ for the complete toroidal lattice.\n2. A random permutation of the face indices $\\{0, \\dots, F-1\\}$ is generated using the seed $s$ to ensure reproducibility.\n3. We iterate, starting with $k=0$ faces removed (the initial state), up to $k=F$. In each step, we construct the reduced incidence matrix $C_k$ by keeping only the rows corresponding to the faces that have not been removed.\n4. For each $C_k$, we compute the curl-curl matrix $A_k = C_k^\\top C_k$.\n5. We then determine the number of connected components in the graph represented by $A_k$. This is accomplished using a standard graph traversal algorithm, such as one available in `scipy.sparse.csgraph.connected_components`.\n6. The iteration stops as soon as the number of connected components becomes strictly greater than $1$.\n7. At this stopping point, we report three quantities:\n    a. The fraction of removed faces, $p = k/F$.\n    b. The number of connected components.\n    c. The nullity (kernel dimension) of the operator $A_k$. Since $\\ker(A_k) = \\ker(C_k)$, the nullity is given by $\\dim(\\ker(C_k)) = E - \\operatorname{rank}(C_k)$. The rank is computed numerically from the singular value decomposition (SVD) of $C_k$, counting the number of singular values exceeding a tolerance $t = 10^{-10}$.\n\nFor non-degenerate grids (where $N_x > 1$ and $N_y > 1$), the initial graph is fully connected. For degenerate \"tori\" where $N_x=1$ or $N_y=1$, the initial graph is already disconnected, and the algorithm correctly identifies the percolation threshold as $p=0$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csr_matrix\nfrom scipy.sparse.csgraph import connected_components\n\ndef run_simulation(Nx, Ny, seed):\n    \"\"\"\n    Simulates face percolation on a toroidal grid and finds the disconnection threshold.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        seed (int): Random seed for reproducibility.\n\n    Returns:\n        list: [p, components, nullity] at the percolation threshold.\n    \"\"\"\n    F = Nx * Ny\n    E = 2 * F\n\n    if F == 0:\n        return [0.0, 0, 0]\n\n    # Step 1: Enumerate entities\n    def h_edge_idx(i, j):\n        return j * Nx + i\n\n    def v_edge_idx(i, j):\n        return F + (j * Nx + i)\n\n    # Step 2: Assemble the full face-edge incidence matrix C\n    # Using LIL format for efficient incremental construction\n    C_lil = lil_matrix((F, E), dtype=np.int8)\n    for j in range(Ny):\n        for i in range(Nx):\n            face_idx = j * Nx + i\n            \n            # Boundary edges in CCW order with signs\n            # Bottom edge: h(i, j), sign +1\n            C_lil[face_idx, h_edge_idx(i, j)] += 1\n            \n            # Right edge: v(i+1, j), sign +1\n            C_lil[face_idx, v_edge_idx((i + 1) % Nx, j)] += 1\n            \n            # Top edge: h(i, j+1), sign -1\n            C_lil[face_idx, h_edge_idx(i, (j + 1) % Ny)] -= 1\n            \n            # Left edge: v(i, j), sign -1\n            C_lil[face_idx, v_edge_idx(i, j)] -= 1\n            \n    full_C = C_lil.tocsr()\n    \n    # Step 3: Prepare for iterative removal\n    rng = np.random.default_rng(seed)\n    face_permutation = rng.permutation(F)\n\n    # Loop through number of removed faces, k, from 0 to F.\n    for k in range(F + 1):\n        p = k / F\n        \n        if k == F:\n            # All faces removed, C is empty\n            C_current = csr_matrix((0, E), dtype=np.int8)\n        else:\n            # Get indices of faces that are kept\n            kept_indices = face_permutation[k:]\n            C_current = full_C[kept_indices, :]\n\n        # Step 4: Compute A and graph components\n        A_k = C_current.transpose().dot(C_current)\n        \n        num_comps, _ = connected_components(\n            csgraph=A_k, directed=False, connection='weak'\n        )\n        \n        # Step 5: Check for disconnection and report\n        if num_comps > 1:\n            # Calculate rank and nullity\n            if C_current.shape[0] == 0:\n                rank = 0\n            else:\n                # SVD is reliable for rank of small-to-medium matrices\n                s = np.linalg.svd(C_current.toarray(), compute_uv=False)\n                rank = np.sum(s > 1e-10)\n            \n            nullity = E - int(rank)\n            \n            return [p, num_comps, nullity]\n\n    # This fallback should not be reached for E > 0, as a zero matrix A\n    # (when all faces are removed) results in E components.\n    return [1.0, E, E]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (3, 3, 7),   # Test case 1\n        (1, 1, 42),  # Boundary test case 2\n        (5, 3, 0),   # Test case 3\n    ]\n\n    results = []\n    for Nx, Ny, seed in test_cases:\n        result = run_simulation(Nx, Ny, seed)\n        results.append(result)\n        \n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}