{
    "hands_on_practices": [
        {
            "introduction": "掌握混合有限元方法的第一步是理解其基本构件。本练习将引导你亲手构建二维电磁问题中最核心的一种稳定离散对——用于电场 $\\mathbf{E}$ 的最低阶Nédélec单元和用于拉格朗日乘子 $p$ 的分片常数单元。通过分析它们的局部多项式空间并验证其与de Rham复形的一致性，你将为后续更复杂的应用奠定坚实的理论基础 。",
            "id": "3331117",
            "problem": "考虑一个单连通多边形域 $\\Omega \\subset \\mathbb{R}^{2}$，其上有一个协调的三角剖分 $\\mathcal{T}_{h}$。设 $\\mathbf{E}$ 表示在Sobolev空间 $H(\\operatorname{curl};\\Omega)$（该空间中的函数及其标量旋度均平方可积）中求解的向量场，并设 $p$ 表示在 $L^{2}(\\Omega)$ 中的一个标量拉格朗日乘子，引入它是为了确保一个与二维de Rham序列一致的混合有限元结构。从连续序列 $H^{1}(\\Omega) \\xrightarrow{\\nabla} H(\\operatorname{curl};\\Omega) \\xrightarrow{\\operatorname{curl}} L^{2}(\\Omega)$ 出发，通过在每个三角形 $K \\in \\mathcal{T}_{h}$ 上为 $\\mathbf{E}$ 选择零阶第一类Nédélec边元，并为 $p$ 选择分片常数，来构建一个最低阶的混合有限元离散化。您的构造必须满足以下条件：\n\n- 明确指出在单个三角形 $K$ 上零阶第一类Nédélec形函数的局部多项式表示，以及 $p$ 的局部多项式空间。\n- 叙述在每个 $K$ 上 $\\mathbf{E}_{h}$ 各分量以及 $p_{h}$ 的相关多项式次数。\n- 通过解释任何 $\\mathbf{E}_{h}$ 的单元标量旋度如何位于为 $p_{h}$ 选择的离散空间内，以及线性多项式的梯度如何嵌入到所选的 $\\mathbf{E}_{h}$ 空间且旋度为零，来论证与离散de Rham结构的一致性。\n\n最后，在单个三角形 $K$ 上，计算限制在零阶第一类Nédélec空间上的离散标量旋度算子的单元核的精确维数，即计算\n$$\n\\dim\\left\\{\\mathbf{v}_{h} \\in \\mathcal{N}_{0}(K) : \\operatorname{curl}\\,\\mathbf{v}_{h} = 0\\right\\}.\n$$\n请以单个整数形式提供最终答案。无需四舍五入，不涉及物理单位。",
            "solution": "所述问题具有科学依据、提法恰当、客观且内部一致。它代表了计算电磁学中混合有限元方法理论的一个标准练习。我将提供完整的解答。\n\n该问题要求在一个三角形 $K$ 上为二维问题构建并分析一个最低阶混合有限元离散化。该离散化基于de Rham序列：\n$$\nH^{1}(\\Omega) \\xrightarrow{\\nabla} H(\\operatorname{curl};\\Omega) \\xrightarrow{\\operatorname{curl}} L^{2}(\\Omega) \\rightarrow 0\n$$\n在三角单元 $K \\in \\mathcal{T}_h$ 上，为向量场 $\\mathbf{E}_h$ 提议的离散空间是零阶第一类Nédélec空间，为标量场 $p_h$ 提议的离散空间是分片常数函数空间。我们分别将局部空间表示为 $\\mathbf{V}_h(K)$ 和 $Q_h(K)$。\n\n首先，我们明确指出局部多项式表示。\n对于向量场 $\\mathbf{E}_h$，所选空间是零阶第一类Nédélec空间，我们将其表示为 $\\mathcal{N}_0(K)$。一个向量场 $\\mathbf{v}_h \\in \\mathcal{N}_0(K)$ 由以下多项式表示定义：\n$$\n\\mathbf{v}_h(x, y) = \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} a_1 \\\\ a_2 \\end{pmatrix} + b \\begin{pmatrix} -y \\\\ x \\end{pmatrix} = \\begin{pmatrix} a_1 - by \\\\ a_2 + bx \\end{pmatrix}\n$$\n其中 $a_1, a_2, b \\in \\mathbb{R}$ 是常数。这个空间也被称为最低阶旋转Raviart-Thomas空间，即 $RT_0^{\\perp}(K)$。该空间的维数是 $3$。其自由度通常定义为向量场沿三角形 $K$ 三条边的常数切向分量。\n\n对于标量拉格朗日乘子 $p_h$，所选空间是 $K$ 上的分片常数空间。这是零次多项式空间，记为 $\\mathcal{P}_0(K)$。一个标量函数 $q_h \\in \\mathcal{P}_0(K)$ 具有以下形式：\n$$\nq_h(x, y) = c\n$$\n其中 $c \\in \\mathbb{R}$ 是一个常数。该空间的维数是 $1$。\n\n接下来，我们叙述相关的多项式次数。\n对于向量场 $\\mathbf{E}_h \\in \\mathcal{N}_0(K)$，其分量为 $E_x(x,y) = a_1 - by$ 和 $E_y(x,y) = a_2 + bx$。两个分量都是关于 $x$ 和 $y$ 的线性多项式。因此，$\\mathbf{E}_h$ 分量的多项式次数是 $1$。\n对于标量场 $p_h \\in \\mathcal{P}_0(K)$，该函数是一个常数，所以其多项式次数是 $0$。\n\n现在我们论证与离散de Rham结构的一致性。在单元 $K$ 上，连续序列的离散模拟是：\n$$\n\\mathcal{P}_1(K) \\xrightarrow{\\nabla} \\mathcal{N}_0(K) \\xrightarrow{\\operatorname{curl}} \\mathcal{P}_0(K)\n$$\n这里，$\\mathcal{P}_1(K)$ 是线性多项式空间，它是 $H^1(\\Omega)$ 的最低阶协调有限元空间。我们必须验证两个性质：\n$1.$ 算子 $\\operatorname{curl}$ 将 $\\mathcal{N}_0(K)$ 映射到 $\\mathcal{P}_0(K)$ 中。设 $\\mathbf{v}_h \\in \\mathcal{N}_0(K)$ 由 $\\mathbf{v}_h(x, y) = (a_1 - by, a_2 + bx)$ 给出。二维中标量旋度定义为 $\\operatorname{curl} \\mathbf{v}_h = \\frac{\\partial v_y}{\\partial x} - \\frac{\\partial v_x}{\\partial y}$。将其应用于 $\\mathbf{v}_h$：\n$$\n\\operatorname{curl} \\mathbf{v}_h = \\frac{\\partial}{\\partial x}(a_2 + bx) - \\frac{\\partial}{\\partial y}(a_1 - by) = b - (-b) = 2b\n$$\n因为 $b$ 是一个常数，所以结果 $2b$ 也是一个常数。因此，$\\operatorname{curl} \\mathbf{v}_h \\in \\mathcal{P}_0(K)$。这表明在旋度算子作用下，$\\mathcal{N}_0(K)$ 的像位于为拉格朗日乘子选择的空间之内。\n\n$2.$ 来自前一个空间 $\\mathcal{P}_1(K)$ 的函数的梯度是无旋的，并且属于 $\\mathcal{N}_0(K)$。设 $\\phi_h \\in \\mathcal{P}_1(K)$。那么 $\\phi_h$ 可以写成 $\\phi_h(x, y) = c_0 + c_1x + c_2y$，其中 $c_0, c_1, c_2 \\in \\mathbb{R}$ 是常数。$\\phi_h$ 的梯度是：\n$$\n\\nabla \\phi_h = \\begin{pmatrix} \\frac{\\partial \\phi_h}{\\partial x} \\\\ \\frac{\\partial \\phi_h}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}\n$$\n这是一个常向量场。一个常向量场 $\\mathbf{w} = (c_1, c_2)$ 可以通过设置 $a_1=c_1$, $a_2=c_2$, 和 $b=0$ 来表示成 $\\mathcal{N}_0(K)$ 中元的形式。因此，$\\nabla \\mathcal{P}_1(K) \\subset \\mathcal{N}_0(K)$。此外，任何此类梯度场的旋度恒为零：\n$$\n\\operatorname{curl}(\\nabla \\phi_h) = \\operatorname{curl}\\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix} = \\frac{\\partial c_2}{\\partial x} - \\frac{\\partial c_1}{\\partial y} = 0 - 0 = 0\n$$\n这证实了离散梯度算子的像包含在离散旋度算子的核中，即 $\\operatorname{Im}(\\nabla|_{\\mathcal{P}_1(K)}) \\subseteq \\ker(\\operatorname{curl}|_{\\mathcal{N}_0(K)})$，从而确认了这对单元的复形性质。\n\n最后，我们计算离散标量旋度算子的单元核的维数。我们需要求的是 $\\dim\\left\\{\\mathbf{v}_{h} \\in \\mathcal{N}_{0}(K) : \\operatorname{curl}\\,\\mathbf{v}_{h} = 0\\right\\}$。\n如上所示，对于任意具有表示 $\\mathbf{v}_h(x, y) = \\begin{pmatrix} a_1 - by \\\\ a_2 + bx \\end{pmatrix}$ 的 $\\mathbf{v}_h \\in \\mathcal{N}_0(K)$，其旋度为 $\\operatorname{curl} \\mathbf{v}_h = 2b$。\n因此，条件 $\\operatorname{curl} \\mathbf{v}_h = 0$ 等价于条件 $2b = 0$，这意味着 $b=0$。\n因此，在 $\\mathcal{N}_0(K)$ 中旋度为零的向量场集合是所有具有以下形式的场的集合：\n$$\n\\mathbf{v}_h(x, y) = \\begin{pmatrix} a_1 \\\\ a_2 \\end{pmatrix}\n$$\n其中 $a_1$ 和 $a_2$ 是任意实常数。这恰好是 $K$ 上的常向量场空间，即 $(\\mathcal{P}_0(K))^2$。这是一个二维向量空间，一组可能的基是 $\\left\\{ \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} \\right\\}$。\n因此，该核的维数是 $2$。\n这个结果与应用于梯度算子 $\\nabla: \\mathcal{P}_1(K) \\to \\mathcal{N}_0(K)$ 的秩-零度定理是一致的。$\\mathcal{P}_1(K)$ 的维数是 $3$。$\\nabla$ 的核由常数函数组成，所以 $\\dim(\\ker(\\nabla)) = 1$。$\\nabla$ 的像是常向量场空间，即 $\\operatorname{Im}(\\nabla)$，其维数为 $\\dim(\\mathcal{P}_1(K)) - \\dim(\\ker(\\nabla)) = 3-1=2$。由于对于这对有限元，离散de Rham序列在单元层面上是正合的，我们有 $\\ker(\\operatorname{curl}|_{\\mathcal{N}_0(K)}) = \\operatorname{Im}(\\nabla|_{\\mathcal{P}_1(K)})$，因此旋度算子核的维数确实是 $2$。",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "在定义了离散单元后，我们需将其组装成一个全局系统并分析其性质。本练习深入探讨了混合公式产生的鞍点系统的结构，这是开发高效求解器的关键。你将通过推导舒尔补并利用傅里叶分析其谱特性，来洞察该系统的条件数如何受物理参数和网格尺寸影响，从而深刻理解离散系统背后的数学物理原理 。",
            "id": "3331082",
            "problem": "考虑一个在三维环面 $\\Omega = (0,2\\pi)^{3}$ 上的单连通、有源、均匀真空中的时谐麦克斯韦系统，其具有周期性边界条件，其中电场 $\\boldsymbol{E}$ 满足散度约束。设角频率为 $\\omega>0$，并假设电容率 $\\varepsilon=1$ 和磁导率 $\\mu=1$。为了在混合格式中施加散度约束，引入一个标量拉格朗日乘子 $p$，使得强形式为\n$$\n\\nabla\\times\\nabla\\times \\boldsymbol{E} - \\omega^{2}\\boldsymbol{E} + \\nabla p = \\boldsymbol{f},\\qquad \\nabla\\cdot \\boldsymbol{E} = 0\\quad\\text{in }\\Omega,\n$$\n其中 $\\boldsymbol{f}$ 是一个给定的平方可积源。相应的弱混合格式是在 $\\boldsymbol{H}(\\mathrm{curl};\\Omega)\\times H^{1}(\\Omega)$ 空间中求解 $(\\boldsymbol{E},p)$，使得对于相同空间中的所有测试函数 $(\\boldsymbol{v},q)$，\n$$\n(\\nabla\\times \\boldsymbol{E},\\nabla\\times \\boldsymbol{v}) - \\omega^{2}(\\boldsymbol{E},\\boldsymbol{v}) + (\\nabla p,\\boldsymbol{v}) = (\\boldsymbol{f},\\boldsymbol{v}),\\qquad -(\\boldsymbol{E},\\nabla q)=0,\n$$\n其中 $(\\cdot,\\cdot)$ 表示 $L^{2}(\\Omega)$ 内积。设有限元方法 (FEM) 在一致、形状规则的网格上，使用 Nédélec 边元离散化 $\\boldsymbol{E}$，并使用连续 Lagrange 元离散化 $p$，从而得到如下形式的鞍点线性系统\n$$\n\\begin{pmatrix}\n\\boldsymbol{A} & \\boldsymbol{B}^{\\top} \\\\\n\\boldsymbol{B} & \\boldsymbol{0}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\boldsymbol{e}\\\\\n\\boldsymbol{p}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\boldsymbol{f}\\\\\n\\boldsymbol{0}\n\\end{pmatrix},\n$$\n其中 $\\boldsymbol{A}$ 离散化算子 $\\nabla\\times\\nabla\\times - \\omega^{2}\\boldsymbol{I}$，$\\boldsymbol{B}$ 离散化 $-(\\cdot,\\nabla \\cdot)$。\n\n从这些基本定义和定律出发，完成以下任务：\n1. 通过从混合系统中代数消去拉格朗日乘子 $p$ 来推导 Schur 补，并确定该 Schur 补所离散化的连续算子。\n2. 使用在带周期性边界条件的 $\\Omega$ 上的傅里叶分析，刻画连续 Schur 补算子的谱，并确定当网格尺寸 $h\\to 0$ 时其离散对应物的条件数。\n3. 特别地，对于波矢为 $\\boldsymbol{\\xi}\\in \\mathbb{Z}^{3}\\setminus\\{\\boldsymbol{0}\\}$ 的单个傅里叶模态 $\\exp(i\\boldsymbol{\\xi}\\cdot\\boldsymbol{x})$，确定作用在标量场 $p$ 上的连续 Schur 补算子的傅里叶符号 $\\sigma(\\boldsymbol{\\xi})$。\n\n给出傅里叶符号 $\\sigma(\\boldsymbol{\\xi})$ 的单个解析表达式作为最终答案。无需进行数值计算。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 步骤 1：提取已知条件\n- **区域**：$\\Omega = (0,2\\pi)^{3}$，一个具有周期性边界条件的三维环面。\n- **控制方程（强形式）**：对于电场 $\\boldsymbol{E}$ 和拉格朗日乘子 $p$：\n  $$\n  \\nabla\\times\\nabla\\times \\boldsymbol{E} - \\omega^{2}\\boldsymbol{E} + \\nabla p = \\boldsymbol{f}\n  $$\n  $$\n  \\nabla\\cdot \\boldsymbol{E} = 0\n  $$\n- **常数和源**：角频率 $\\omega > 0$。电容率 $\\varepsilon=1$。磁导率 $\\mu=1$。源 $\\boldsymbol{f}$ 是一个平方可积矢量场。\n- **弱形式**：求解 $(\\boldsymbol{E},p) \\in \\boldsymbol{H}(\\mathrm{curl};\\Omega)\\times H^{1}(\\Omega)$，使得对于所有测试函数 $(\\boldsymbol{v},q) \\in \\boldsymbol{H}(\\mathrm{curl};\\Omega)\\times H^{1}(\\Omega)$：\n  $$\n  (\\nabla\\times \\boldsymbol{E},\\nabla\\times \\boldsymbol{v}) - \\omega^{2}(\\boldsymbol{E},\\boldsymbol{v}) + (\\nabla p,\\boldsymbol{v}) = (\\boldsymbol{f},\\boldsymbol{v})\n  $$\n  $$\n  -(\\boldsymbol{E},\\nabla q)=0\n  $$\n  其中 $(\\cdot,\\cdot)$ 是 $L^2(\\Omega)$ 内积。\n- **有限元离散化**：\n  - $\\boldsymbol{E}$ 使用 Nédélec 边元进行离散化。\n  - $p$ 使用连续 Lagrange 元进行离散化。\n  - 得到的矩阵系统是一个鞍点问题：\n    $$\n    \\begin{pmatrix}\n    \\boldsymbol{A} & \\boldsymbol{B}^{\\top} \\\\\n    \\boldsymbol{B} & \\boldsymbol{0}\n    \\end{pmatrix}\n    \\begin{pmatrix}\n    \\boldsymbol{e}\\\\\n    \\boldsymbol{p}\n    \\end{pmatrix}\n    =\n    \\begin{pmatrix}\n    \\boldsymbol{f}\\\\\n    \\boldsymbol{0}\n    \\end{pmatrix}\n    $$\n  - $\\boldsymbol{A}$ 离散化算子 $\\nabla\\times\\nabla\\times - \\omega^{2}\\boldsymbol{I}$。\n  - $\\boldsymbol{B}$ 离散化算子映射 $-(\\cdot,\\nabla \\cdot)$。\n- **任务**：\n  1. 推导 Schur 补并确定其对应的连续算子。\n  2. 刻画连续 Schur 补算子的谱，并确定当网格尺寸 $h\\to 0$ 时其离散对应物的条件数。\n  3. 对于波矢为 $\\boldsymbol{\\xi}\\in \\mathbb{Z}^{3}\\setminus\\{\\boldsymbol{0}\\}$ 的模态 $\\exp(i\\boldsymbol{\\xi}\\cdot\\boldsymbol{x})$，确定连续 Schur 补算子的傅里叶符号 $\\sigma(\\boldsymbol{\\xi})$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了时谐麦克斯韦方程组的标准混合有限元格式。使用拉格朗日乘子施加散度约束、指定的函数空间（$\\boldsymbol{H}(\\mathrm{curl})$, $H^1$）以及 Nédélec/Lagrange 元的选择，在计算电磁学领域都是成熟且正确的。\n- **适定性**：该问题是一个陈述清晰的理论练习。它要求进行对此类系统而言是标准的特定推导和分析。\n- **客观性**：语言是精确的、数学化的，并且没有任何主观或非科学的主张。\n- **完整性和一致性**：该问题为执行所需的傅里叶分析和推导提供了所有必要的方程、定义和背景（例如，环面上的周期性边界条件）。该提法是自洽的。\n- **不存在其他缺陷。** 该问题在科学上是合理的、适定的、客观的和完整的。\n\n### 步骤 3：结论和行动\n该问题是有效的。将提供完整的解答。\n\n### 解答推导\n\n解答过程通过解决问题陈述中概述的三个任务来进行。\n\n**1. Schur 补的推导**\n\n离散线性系统为：\n$$\n\\boldsymbol{A}\\boldsymbol{e} + \\boldsymbol{B}^{\\top}\\boldsymbol{p} = \\boldsymbol{f} \\quad (1)\n$$\n$$\n\\boldsymbol{B}\\boldsymbol{e} = \\boldsymbol{0} \\quad (2)\n$$\n假设矩阵 $\\boldsymbol{A}$ 是可逆的，我们可以从方程 (1) 中解出 $\\boldsymbol{e}$：\n$$\n\\boldsymbol{e} = \\boldsymbol{A}^{-1}(\\boldsymbol{f} - \\boldsymbol{B}^{\\top}\\boldsymbol{p})\n$$\n将 $\\boldsymbol{e}$ 的这个表达式代入方程 (2) 得到：\n$$\n\\boldsymbol{B} \\left( \\boldsymbol{A}^{-1}(\\boldsymbol{f} - \\boldsymbol{B}^{\\top}\\boldsymbol{p}) \\right) = \\boldsymbol{0}\n$$\n整理各项，我们得到关于未知向量 $\\boldsymbol{p}$ 的 Schur 补系统：\n$$\n(\\boldsymbol{B}\\boldsymbol{A}^{-1}\\boldsymbol{B}^{\\top})\\boldsymbol{p} = \\boldsymbol{B}\\boldsymbol{A}^{-1}\\boldsymbol{f}\n$$\nSchur 补矩阵为 $\\boldsymbol{S} = \\boldsymbol{B}\\boldsymbol{A}^{-1}\\boldsymbol{B}^{\\top}$。\n\n为了确定相应的连续算子，我们对连续微分方程的强形式执行相同的消去操作。与 $\\boldsymbol{A}$ 对应的算子是 $\\mathcal{A} = \\nabla\\times\\nabla\\times - \\omega^2\\boldsymbol{I}$。与 $\\boldsymbol{B}$ 的作用对应的算子是 $-\\nabla\\cdot$，其伴随算子（对应于 $\\boldsymbol{B}^\\top$）是 $\\nabla$。\n\n连续系统为：\n$$\n\\mathcal{A}\\boldsymbol{E} + \\nabla p = \\boldsymbol{f} \\quad (1')\n$$\n$$\n-\\nabla\\cdot\\boldsymbol{E} = 0 \\quad (2')\n$$\n从 (1')，假设 $\\mathcal{A}^{-1}$ 存在，我们有：\n$$\n\\boldsymbol{E} = \\mathcal{A}^{-1}(\\boldsymbol{f} - \\nabla p)\n$$\n将此代入 (2')：\n$$\n-\\nabla\\cdot \\left( \\mathcal{A}^{-1}(\\boldsymbol{f} - \\nabla p) \\right) = 0\n$$\n这就得到了关于拉格朗日乘子 $p$ 的连续方程：\n$$\n(\\nabla\\cdot \\mathcal{A}^{-1} \\nabla) p = \\nabla\\cdot \\mathcal{A}^{-1} \\boldsymbol{f}\n$$\n因此，连续 Schur 补算子为 $\\mathcal{S} = \\nabla\\cdot \\mathcal{A}^{-1} \\nabla = \\nabla\\cdot (\\nabla\\times\\nabla\\times - \\omega^2\\boldsymbol{I})^{-1} \\nabla$。离散 Schur 补矩阵 $\\boldsymbol{S}$ 是该算子 $-\\mathcal{S}$ 的一个有限元离散。符号上的差异源于弱形式中 $\\boldsymbol{B}$ 的定义，该定义通过分部积分引入了一个负号。\n\n**2. 谱分析与条件数**\n\n我们使用在环面 $\\Omega=(0,2\\pi)^3$ 上的傅里叶分析来分析算子 $\\mathcal{S}$。$\\Omega$ 上的任何足够正则的函数都可以用其傅里叶级数表示。我们考虑单个傅里叶模态 $\\exp(i\\boldsymbol{\\xi}\\cdot\\boldsymbol{x})$，其中波矢 $\\boldsymbol{\\xi} \\in \\mathbb{Z}^3$。在傅里叶空间中，微分算子变为代数算子（它们的傅里叶符号）：\n$$\n\\nabla \\rightarrow i\\boldsymbol{\\xi}, \\quad \\nabla\\cdot \\rightarrow i\\boldsymbol{\\xi}\\cdot, \\quad \\nabla\\times \\rightarrow i\\boldsymbol{\\xi}\\times\n$$\n算子 $\\mathcal{A} = \\nabla\\times\\nabla\\times - \\omega^2\\boldsymbol{I}$ 的符号是一个 $3\\times 3$ 矩阵 $\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})$，通过将 $\\mathcal{A}$ 作用于矢量场 $\\boldsymbol{E}_{\\boldsymbol{\\xi}}\\exp(i\\boldsymbol{\\xi}\\cdot\\boldsymbol{x})$ 得到：\n$$\n\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})\\boldsymbol{E}_{\\boldsymbol{\\xi}} = (i\\boldsymbol{\\xi})\\times(i\\boldsymbol{\\xi}\\times \\boldsymbol{E}_{\\boldsymbol{\\xi}}) - \\omega^2\\boldsymbol{E}_{\\boldsymbol{\\xi}} = -\\boldsymbol{\\xi}\\times(\\boldsymbol{\\xi}\\times \\boldsymbol{E}_{\\boldsymbol{\\xi}}) - \\omega^2\\boldsymbol{E}_{\\boldsymbol{\\xi}}\n$$\n使用矢量三重积恒等式 $\\boldsymbol{a}\\times(\\boldsymbol{b}\\times\\boldsymbol{c}) = \\boldsymbol{b}(\\boldsymbol{a}\\cdot\\boldsymbol{c}) - \\boldsymbol{c}(\\boldsymbol{a}\\cdot\\boldsymbol{b})$，我们得到：\n$$\n\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})\\boldsymbol{E}_{\\boldsymbol{\\xi}} = -(\\boldsymbol{\\xi}(\\boldsymbol{\\xi}\\cdot\\boldsymbol{E}_{\\boldsymbol{\\xi}}) - \\boldsymbol{E}_{\\boldsymbol{\\xi}}|\\boldsymbol{\\xi}|^2) - \\omega^2\\boldsymbol{E}_{\\boldsymbol{\\xi}} = (|\\boldsymbol{\\xi}|^2\\boldsymbol{I} - \\boldsymbol{\\xi}\\boldsymbol{\\xi}^\\top)\\boldsymbol{E}_{\\boldsymbol{\\xi}} - \\omega^2\\boldsymbol{E}_{\\boldsymbol{\\xi}}\n$$\n因此，$\\mathcal{A}$ 的符号是矩阵 $\\hat{\\mathcal{A}}(\\boldsymbol{\\xi}) = (|\\boldsymbol{\\xi}|^2 - \\omega^2)\\boldsymbol{I} - \\boldsymbol{\\xi}\\boldsymbol{\\xi}^\\top$。\n\nSchur 补算子 $\\mathcal{S}$ 的傅里叶符号 $\\sigma(\\boldsymbol{\\xi})$ 通过将 $\\mathcal{S}$ 作用于标量模态 $p_{\\boldsymbol{\\xi}}\\exp(i\\boldsymbol{\\xi}\\cdot\\boldsymbol{x})$ 得到：\n$$\n\\mathcal{S} p \\rightarrow (i\\boldsymbol{\\xi}\\cdot) \\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1} (i\\boldsymbol{\\xi} p_{\\boldsymbol{\\xi}}) = -(\\boldsymbol{\\xi}^\\top \\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1} \\boldsymbol{\\xi}) p_{\\boldsymbol{\\xi}}\n$$\n因此，$\\sigma(\\boldsymbol{\\xi}) = -\\boldsymbol{\\xi}^\\top \\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1} \\boldsymbol{\\xi}$，这将在下一节中详细推导。\n结果是 $\\sigma(\\boldsymbol{\\xi}) = |\\boldsymbol{\\xi}|^2/\\omega^2$。\n\n连续算子 $\\mathcal{S}$ 的谱是这些符号值在所有可能波矢上的集合：\n$$\n\\mathrm{Spec}(\\mathcal{S}) = \\left\\{ \\frac{|\\boldsymbol{\\xi}|^2}{\\omega^2} \\mid \\boldsymbol{\\xi} \\in \\mathbb{Z}^3 \\setminus \\{\\boldsymbol{0}\\} \\right\\}\n$$\n该谱是正的、实的和无界的，从 $1/\\omega^2$ (对于 $|\\boldsymbol{\\xi}|^2 = 1$) 开始并趋于无穷大。\n\n离散 Schur 补矩阵 $\\boldsymbol{S}_h$ 的特征值近似于 $-\\mathcal{S}$ 的特征值，直至达到由网格尺寸 $h$ 决定的某个最大频率。$-\\boldsymbol{S}_h$ 的最小特征值（按绝对值）将近似于最小 $|\\boldsymbol{\\xi}|^2=1$ 时的 $-\\sigma(\\boldsymbol{\\xi})$：$\\lambda_{\\min}(-\\boldsymbol{S}_h) \\approx -1/\\omega^2$。最大特征值对应于网格可分辨的最高频率，其中 $|\\boldsymbol{\\xi}|_{\\max} \\propto h^{-1}$。因此，$\\lambda_{\\max}(-\\boldsymbol{S}_h) \\propto -(h^{-1})^2/\\omega^2 = -h^{-2}/\\omega^2$。\n离散 Schur 补矩阵 $\\boldsymbol{S}_h$ 的条件数是其最大特征值与最小特征值绝对值之比：\n$$\n\\kappa(\\boldsymbol{S}_h) = \\frac{|\\lambda_{\\max}|}{|\\lambda_{\\min}|} \\approx \\frac{C h^{-2}/\\omega^2}{1/\\omega^2} = C h^{-2}\n$$\n离散 Schur 补系统的条件数很差，随着网格的加密，条件数以 $O(h^{-2})$ 的速度增长。\n\n**3. Schur 补算子的傅里叶符号**\n\n最后的任务是找到傅里叶符号 $\\sigma(\\boldsymbol{\\xi})$ 的显式表达式。如前所述，$\\sigma(\\boldsymbol{\\xi}) = -\\boldsymbol{\\xi}^\\top \\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1} \\boldsymbol{\\xi}$。我们需要计算逆矩阵 $\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1}$ 对向量 $\\boldsymbol{\\xi}$ 的作用。这等价于求解线性系统 $\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})\\boldsymbol{y} = \\boldsymbol{\\xi}$ 来得到 $\\boldsymbol{y}$。\n\n让我们尝试一个形式为 $\\boldsymbol{y} = c\\boldsymbol{\\xi}$ 的解，其中 $c$ 是某个标量。\n$$\n\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})(c\\boldsymbol{\\xi}) = c \\left[ (|\\boldsymbol{\\xi}|^2 - \\omega^2)\\boldsymbol{I} - \\boldsymbol{\\xi}\\boldsymbol{\\xi}^\\top \\right] \\boldsymbol{\\xi}\n$$\n$$\n= c \\left[ (|\\boldsymbol{\\xi}|^2 - \\omega^2)\\boldsymbol{\\xi} - \\boldsymbol{\\xi}(\\boldsymbol{\\xi}^\\top\\boldsymbol{\\xi}) \\right]\n$$\n$$\n= c \\left[ (|\\boldsymbol{\\xi}|^2 - \\omega^2)\\boldsymbol{\\xi} - \\boldsymbol{\\xi}|\\boldsymbol{\\xi}|^2 \\right]\n$$\n$$\n= c [ (|\\boldsymbol{\\xi}|^2 - \\omega^2 - |\\boldsymbol{\\xi}|^2)\\boldsymbol{\\xi} ] = c(-\\omega^2\\boldsymbol{\\xi})\n$$\n我们希望这个结果等于 $\\boldsymbol{\\xi}$。所以，$c(-\\omega^2\\boldsymbol{\\xi}) = \\boldsymbol{\\xi}$。因为 $\\omega>0$ 且 $\\boldsymbol{\\xi} \\neq \\boldsymbol{0}$，我们可以解出 $c$：\n$$\nc = -\\frac{1}{\\omega^2}\n$$\n这意味着 $\\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1}\\boldsymbol{\\xi} = -\\frac{1}{\\omega^2}\\boldsymbol{\\xi}$。这个结果对所有 $\\boldsymbol{\\xi} \\in \\mathbb{Z}^3 \\setminus \\{\\boldsymbol{0}\\}$ 和 $\\omega>0$ 都有效。\n\n现在我们可以计算符号 $\\sigma(\\boldsymbol{\\xi})$：\n$$\n\\sigma(\\boldsymbol{\\xi}) = -\\boldsymbol{\\xi}^\\top \\left( \\hat{\\mathcal{A}}(\\boldsymbol{\\xi})^{-1} \\boldsymbol{\\xi} \\right) = -\\boldsymbol{\\xi}^\\top \\left( -\\frac{1}{\\omega^2}\\boldsymbol{\\xi} \\right)\n$$\n$$\n= \\frac{1}{\\omega^2} (\\boldsymbol{\\xi}^\\top\\boldsymbol{\\xi}) = \\frac{|\\boldsymbol{\\xi}|^2}{\\omega^2}\n$$\n这就是对于波矢 $\\boldsymbol{\\xi} \\in \\mathbb{Z}^3 \\setminus \\{\\boldsymbol{0}\\}$ 的连续 Schur 补算子 $\\mathcal{S}$ 的傅里叶符号。",
            "answer": "$$\n\\boxed{\\frac{|\\boldsymbol{\\xi}|^2}{\\omega^2}}\n$$"
        },
        {
            "introduction": "理论的严谨性在实际计算中至关重要，本练习通过一个数值实验来揭示这一点。你将模拟一种被称为“变分犯罪”的常见数值错误，即由于积分不精确而导致的离散约束被破坏。通过观察非物理的“伪模式”是如何因此产生的，你将直观地理解为何必须严格遵守混合有限元方法的数学框架，以确保计算结果的物理真实性 。",
            "id": "3331121",
            "problem": "考虑一个单连通、均匀、各向同性域中的无源频域麦克斯韦特征问题，其中电场 $\\mathbf{E}$ 满足从无源法拉第定律和安培定律推导出的旋度-旋度公式。连续混合公式引入一个标量拉格朗日乘子 $p$，以弱形式强制施加无散约束。在无量纲形式下，单位磁导率和单位介电常数时，该混合特征问题表述为：寻找 $(\\mathbf{E}, p)$ 和 $\\lambda \\ge 0$ 使得\n$$\n(\\nabla \\times \\mathbf{E}, \\nabla \\times \\mathbf{v}) + (\\nabla p, \\mathbf{v}) = \\lambda (\\mathbf{E}, \\mathbf{v}),\n$$\n对于索伯列夫空间 $H(\\mathrm{curl})$ 中的所有 $\\mathbf{v}$ 成立，同时\n$$\n(\\mathbf{E}, \\nabla q) = 0,\n$$\n对于索伯列夫空间 $H^1$ 中的所有 $q$ 成立。在精确序列的设定下，这抑制了电场谱中的伪梯度场。\n\n在计算电磁学的混合有限元公式中，通过选择合适的基于边的基（例如，Nédélec 单元），可以保证电场在单元界面上的切向连续性，并且弱形式积分通过求积进行计算。如果用于计算双线性形式的求积不一致，就会产生“变分犯罪”，从而扰动了维持精确序列结构的约束。在本问题中，您将在一个结构化四边形网格上构建一个离散混合特征问题，然后通过一个参数化求积误差来刻意扰动约束内积，该误差模拟了弱形式下对切向连续性强制的违背。您将探究其对伪特征模式（梯度污染的特征向量）和离散对 $(\\mathbf{E}, p)$ 中约束违背的影响。\n\n从麦克斯韦方程组的基本基础和混合弱形式出发，完全使用无量纲单位实现以下离散模型和分析：\n\n1. 在单位正方形上定义一个结构化网格，其中 $x$ 方向有 $N_x = 4$ 个节点，$y$ 方向有 $N_y = 4$ 个节点。对电场 $\\mathbf{E}$ 使用基于边的离散化，自由度（DOF）位于水平边（$E_x$ 分量）和垂直边（$E_y$ 分量）上，标量拉格朗日乘子 $p$ 的自由度位于节点上。设水平边、垂直边和节点的数量与此结构化网格保持一致。\n\n2. 通过前向差分构建将节点自由度映射到边自由度的离散梯度算子 $G$：\n   - 对于节点 $(i,j)$ 和 $(i+1,j)$ 之间的水平边，其对应的边自由度等于 $p_{i+1,j} - p_{i,j}$。\n   - 对于节点 $(i,j)$ 和 $(i,j+1)$ 之间的垂直边，其对应的边自由度等于 $p_{i,j+1} - p_{i,j}$。\n   所有索引必须与网格连通性一致。按规定使用 $N_x = 4$ 和 $N_y = 4$。\n\n3. 构建将边自由度映射到单元中心标量自由度（$\\nabla \\times \\mathbf{E}$ 的平面外分量）的离散旋度算子 $C$，在每个索引为 $(i,j)$ 的单元上使用标准有限差分格式：\n$$\n(\\nabla \\times \\mathbf{E})_{i,j} \\approx E_y(i+1,j) - E_y(i,j) - \\big(E_x(i,j+1) - E_x(i,j)\\big),\n$$\n这对应于单元 $(i,j)$ 处的 $(\\partial E_y / \\partial x) - (\\partial E_x / \\partial y)$。为所有内部单元相应地组装 $C$。\n\n4. 定义对角类质量矩阵：\n   - 边质量矩阵 $M_e$ 使用从网格步长 $h_x = 1/(N_x - 1)$ 和 $h_y = 1/(N_y - 1)$ 导出的均匀边权重。将边权重 $h_x$ 分配给水平边，将 $h_y$ 分配给垂直边，形成一个维度等于总边数的对角矩阵。\n   - 单元权重矩阵 $W$ 在对角线上使用均匀的单元面积权重 $h_x h_y$。\n   然后定义离散旋度-旋度刚度矩阵 $A = C^\\top W C$。\n\n5. 定义精确离散约束耦合矩阵 $B = G^\\top M_e$。这在由 $M_e$ 导出的离散内积中编码了双线性形式 $(\\mathbf{E}, \\nabla q)$。\n\n6. 通过修改边权重来模拟求积引起的变分犯罪，该修改采用带符号的对角扰动。设 $Q_e$ 是一个对角矩阵，其元素在边自由度上按固定的确定性模式在 $+1$ 和 $-1$ 之间交替。对于给定的标量参数 $\\eta$，定义扰动约束矩阵\n$$\nB_\\eta = G^\\top M_e (I + \\eta Q_e),\n$$\n其中 $I$ 是维度等于总边数的单位矩阵。这模拟了一种求积误差，该误差改变了在强制弱切向连续性和精确序列耦合时单个边的贡献。\n\n7. 通过组装分块矩阵来形成广义对称混合特征问题\n$$\nK_\\eta = \\begin{bmatrix}\nA & B_\\eta^\\top \\\\\nB_\\eta & -\\gamma I_p\n\\end{bmatrix}, \\qquad\nM_\\alpha = \\begin{bmatrix}\nM_e & 0 \\\\\n0 & \\alpha I_p\n\\end{bmatrix},\n$$\n其中 $I_p$ 是大小等于节点自由度数量的单位矩阵，$\\gamma = 10^{-8}$ 是一个用于 $p$ 的小稳定化参数，$\\alpha = 10^{-8}$ 是一个用于 $p$ 的小质量缩放。通过使用 $M_\\alpha^{-1/2}$ 将其转换为对称标准特征问题来求解广义特征问题 $K_\\eta x = \\lambda M_\\alpha x$：\n$$\nM_\\alpha^{-1/2} K_\\eta M_\\alpha^{-1/2} y = \\lambda y, \\quad x = M_\\alpha^{-1/2} y.\n$$\n\n8. 对于下面定义的测试套件中的每个 $\\eta$，计算最小的 $k = 10$ 个正特征值及其从 $x$ 中提取的相应特征向量 $(\\mathbf{E}, p)$。对于每个特征对，计算以下诊断指标：\n   - 旋度比 $r_{\\mathrm{curl}} = \\|\\nabla \\times \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$，其中离散的 $\\nabla \\times \\mathbf{E}$ 是 $C \\mathbf{E}$，范数为欧几里得范数。\n   - 如果 $r_{\\mathrm{curl}}  \\varepsilon_{\\mathrm{curl}}$ 且 $\\varepsilon_{\\mathrm{curl}} = 10^{-3}$，则将一个特征对分类为伪梯度污染模式。\n   - 对于物理模式（未被分类为伪模式的模式）的离散散度污染度量，定义为物理特征对的 $\\|B_\\eta \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$ 的平均值。\n\n9. 通过约束中扰动的相对算子2-范数来量化变分犯罪量级：\n$$\n\\mathrm{crime\\_norm}(\\eta) = \\frac{\\|B_\\eta - B\\|_2}{\\|B\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示矩阵谱范数（最大奇异值）。\n\n10. 测试套件。对以下 $\\eta$ 值进行评估输出：\n   - $\\eta = 0.0$ (无犯罪，基准情况)，\n   - $\\eta = 10^{-3}$ (小扰动)，\n   - $\\eta = 10^{-1}$ (中等扰动)，\n   - $\\eta = 0.5$ (大扰动)，\n   - $\\eta = -0.3$ (负扰动，测试欠积分偏差)。\n\n11. 最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个形如 $[\\text{spurious\\_count}, \\text{divergence\\_pollution}, \\text{crime\\_norm}]$ 的列表。例如，总输出必须看起来像\n$$\n[\\,[s_1,d_1,c_1],[s_2,d_2,c_2],[s_3,d_3,c_3],[s_4,d_4,c_4],[s_5,d_5,c_5]\\,],\n$$\n其中 $s_i$ 是一个整数，$d_i$ 和 $c_i$ 是浮点数。所有量都是无量纲的。\n\n此任务要求从第一性原理出发推导离散公式，实现它，并计算诊断指标，这些指标用于探究在指定的测试套件上，求积引起的变分犯罪对 $(\\mathbf{E}, p)$ 中伪特征模式和离散散度污染的影响。最终输出必须严格遵守指定的单行格式。",
            "solution": "用户的请求是解决一个计算电磁学问题，该问题涉及“变分犯罪”对麦克斯韦特征问题混合有限元公式的影响。该问题是数值分析领域中一个有效、适定且具有科学依据的练习。\n\n### 问题验证\n\n#### 步骤 1：提取已知条件\n- **连续公式**：\n  - 寻找 $(\\mathbf{E}, p)$ 和 $\\lambda \\ge 0$。\n  - $(\\nabla \\times \\mathbf{E}, \\nabla \\times \\mathbf{v}) + (\\nabla p, \\mathbf{v}) = \\lambda (\\mathbf{E}, \\mathbf{v})$ 对所有 $\\mathbf{v} \\in H(\\mathrm{curl})$ 成立。\n  - $(\\mathbf{E}, \\nabla q) = 0$ 对所有 $q \\in H^1$ 成立。\n- **离散化与网格**：\n  - 域：单位正方形。\n  - 网格：结构化网格，$x$ 方向 $N_x = 4$ 个节点，$y$ 方向 $N_y = 4$ 个节点。\n  - 自由度：电场 $\\mathbf{E}$ 在边上，拉格朗日乘子 $p$ 在节点上。\n- **离散算子**：\n  - 梯度算子 $G$：通过前向差分将节点自由度映射到边自由度。\n    - 水平边：$p_{i+1,j} - p_{i,j}$。\n    - 垂直边：$p_{i,j+1} - p_{i,j}$。\n  - 旋度算子 $C$：将边自由度映射到单元自由度。\n    - $(\\nabla \\times \\mathbf{E})_{i,j} \\approx E_y(i+1,j) - E_y(i,j) - \\big(E_x(i,j+1) - E_x(i,j)\\big)$。\n- **矩阵**：\n  - 边质量矩阵 $M_e$：对角矩阵，水平边权重为 $h_x = 1/(N_x - 1)$，垂直边权重为 $h_y = 1/(N_y - 1)$。\n  - 单元权重矩阵 $W$：对角矩阵，权重为 $h_x h_y$。\n  - 刚度矩阵 $A = C^\\top W C$。\n  - 精确约束矩阵 $B = G^\\top M_e$。\n- **变分犯罪模型**：\n  - 扰动矩阵 $Q_e$：对角矩阵，元素在 $+1$ 和 $-1$ 之间交替。\n  - 扰动约束矩阵 $B_\\eta = G^\\top M_e (I + \\eta Q_e)$，其中 $\\eta$ 为标量。\n- **广义特征问题**：\n  - $K_\\eta x = \\lambda M_\\alpha x$，其中 $x = [\\mathbf{E}, p]^\\top$。\n  - $K_\\eta = \\begin{bmatrix} A  B_\\eta^\\top \\\\ B_\\eta  -\\gamma I_p \\end{bmatrix}$，其中 $\\gamma = 10^{-8}$。\n  - $M_\\alpha = \\begin{bmatrix} M_e  0 \\\\ 0  \\alpha I_p \\end{bmatrix}$，其中 $\\alpha = 10^{-8}$。\n- **求解方法**：\n  - 转换为标准特征问题：$M_\\alpha^{-1/2} K_\\eta M_\\alpha^{-1/2} y = \\lambda y$，其中 $x = M_\\alpha^{-1/2} y$。\n- **分析与诊断**：\n  - 计算最小的 $k=10$ 个正特征值。\n  - 旋度比：$r_{\\mathrm{curl}} = \\|\\nabla \\times \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$，其中离散的 $\\nabla \\times \\mathbf{E} = C \\mathbf{E}$。\n  - 伪模式：如果 $r_{\\mathrm{curl}}  \\varepsilon_{\\mathrm{curl}} = 10^{-3}$ 则分类为伪模式。\n  - 散度污染：物理模式上 $\\|B_\\eta \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$ 的均值。\n  - 犯罪范数：$\\mathrm{crime\\_norm}(\\eta) = \\|B_\\eta - B\\|_2 / \\|B\\|_2$。\n- **测试套件**：$\\eta \\in \\{0.0, 10^{-3}, 10^{-1}, 0.5, -0.3\\}$。\n- **输出格式**：单行 `[[s1,d1,c1],[s2,d2,c2],...]`。\n\n#### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是计算电磁学混合有限元方法中的一个标准课题。它是适定的，所有参数、矩阵和方法都得到了明确的规定。不存在矛盾、缺失数据或主观因素。该问题是一个形式化且可验证的数值实验。\n\n#### 步骤 3：结论与行动\n问题是**有效**的。将提供一个解决方案。\n\n### 求解推导与实现\n解决方案涉及以编程方式实现混合特征问题的离散表示。该过程分为以下几个步骤：定义网格、构建离散微分算子、组装系统矩阵、为每个扰动参数 $\\eta$ 求解广义特征问题，最后计算所需的诊断指标。\n\n1.  **网格与自由度定义**：\n    首先，我们根据网格参数 $N_x=4$ 和 $N_y=4$ 确定问题的维度。这定义了节点、水平边、垂直边和单元的数量。\n    - $p$ 的节点数：$N_p = N_x \\times N_y = 4 \\times 4 = 16$。\n    - $E_x$ 的水平边数：$N_{h} = (N_x - 1) \\times N_y = 3 \\times 4 = 12$。\n    - $E_y$ 的垂直边数：$N_{v} = N_x \\times (N_y - 1) = 4 \\times 3 = 12$。\n    - $\\mathbf{E}$ 的总边数：$N_{e} = N_{h} + N_{v} = 24$。\n    - 单元数：$N_{c} = (N_x - 1) \\times (N_y - 1) = 3 \\times 3 = 9$。\n    我们定义一个一致的索引方案，将自由度的二维网格位置映射到一维向量索引。\n\n2.  **离散算子构建**：\n    - **梯度算子 $G$**：构建一个大小为 $N_e \\times N_p$ 的矩阵。每一行对应一条边，其非零项表示与该边相关的有限差分 $p_{end} - p_{start}$，从而实现离散梯度。\n    - **旋度算子 $C$**：构建一个大小为 $N_c \\times N_e$ 的矩阵。每一行对应一个单元，其非零项（值为 $+1$ 或 $-1$）表示构成该单元边界的四个边自由度的系数，从而实现离散环路积分 $\\oint \\mathbf{E} \\cdot d\\mathbf{l}$。\n\n3.  **系统矩阵组装**：\n    - **质量矩阵**：形成对角矩阵 $M_e$ 和 $W$。$M_e$（大小为 $N_e \\times N_e$）在其对角线上包含边的长度（$h_x$ 或 $h_y$），用于加权基于边的内积。$W$（大小为 $N_c \\times N_c$）包含单元面积（$h_x h_y$），用于加权基于单元的内积。\n    - **刚度与约束矩阵**：\n        - 离散旋度-旋度刚度矩阵为 $A = C^\\top W C$（大小为 $N_e \\times N_e$）。\n        - 精确离散约束矩阵为 $B = G^\\top M_e$（大小为 $N_p \\times N_e$）。该矩阵在弱公式中表示散度算子的离散版本。\n    - **扰动**：对于测试套件中的每个 $\\eta$，我们构建扰动约束矩阵 $B_\\eta = G^\\top M_e (I + \\eta Q_e)$，其中 $Q_e$ 是一个交替符号的对角矩阵。\n\n4.  **特征问题的公式化与求解**：\n    - 根据问题规范组装分块矩阵 $K_\\eta$ 和 $M_\\alpha$。\n    - 广义特征问题 $K_\\eta x = \\lambda M_\\alpha x$ 是一个鞍点问题。为了使用标准的对称特征求解器求解它，我们将其转换为 $K' y = \\lambda y$，其中 $K' = M_\\alpha^{-1/2} K_\\eta M_\\alpha^{-1/2}$ 且 $x = M_\\alpha^{-1/2} y$。由于 $M_\\alpha$ 是对角且正定的，因此 $M_\\alpha^{-1/2}$ 的计算非常简单。\n    - 使用 `numpy.linalg.eigh` 求解对称矩阵 $K'$ 的特征值 $\\lambda$ 和特征向量 $y$。恢复原始特征向量 $x$。\n\n5.  **后处理与诊断**：\n    - 对每个 $\\eta$，分析得到的特征谱。我们筛选出最小的 $k=10$ 个正特征值。\n    - 对于每个对应的特征向量 $x = [\\mathbf{E}, p]^\\top$：\n        - 计算旋度比 $r_{\\mathrm{curl}} = \\|C \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$。如果 $r_{\\mathrm{curl}}  10^{-3}$，则该模式被分类为伪模式。\n        - 如果模式是物理的，则计算其对散度污染的贡献，即 $\\|B_\\eta \\mathbf{E}\\|_2 / \\|\\mathbf{E}\\|_2$。\n    - 对每个 $\\eta$，计算所有物理模式的平均散度污染。\n    - 通过算子扰动的相对谱范数量化变分犯罪的量级，即 $\\mathrm{crime\\_norm}(\\eta) = \\|B_\\eta - B\\|_2 / \\|B\\|_2$。\n    - 收集每个 $\\eta$ 的结果（伪模式计数、平均散度污染、犯罪范数），并将其格式化为所需的输出字符串。\n\n实现精确地遵循这些步骤，提供了一个关于特定变分犯罪——弱强制切向连续性中的扰动——如何将非物理散度引入计算出的电场特征模式并影响离散特征谱结构的定量分析。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the mixed finite element formulation of the Maxwell eigenproblem\n    with a modeled variational crime, and analyzes its effects.\n    \"\"\"\n    # Define problem parameters\n    Nx, Ny = 4, 4\n    gamma = 1e-8\n    alpha = 1e-8\n    k = 10\n    eps_curl = 1e-3\n    test_etas = [0.0, 1e-3, 1e-1, 0.5, -0.3]\n\n    # Mesh parameters\n    hx = 1.0 / (Nx - 1)\n    hy = 1.0 / (Ny - 1)\n    \n    # Degrees of freedom counts\n    n_nodes = Nx * Ny\n    n_h_edges = (Nx - 1) * Ny\n    n_v_edges = Nx * (Ny - 1)\n    n_edges = n_h_edges + n_v_edges\n    n_cells = (Nx - 1) * (Ny - 1)\n\n    # 1. Construct discrete gradient operator G (size: n_edges x n_nodes)\n    G = np.zeros((n_edges, n_nodes))\n    # Horizontal edges\n    for j in range(Ny):\n        for i in range(Nx - 1):\n            h_edge_idx = i + j * (Nx - 1)\n            node_idx_left = i + j * Nx\n            node_idx_right = (i + 1) + j * Nx\n            G[h_edge_idx, node_idx_left] = -1.0\n            G[h_edge_idx, node_idx_right] = 1.0\n    # Vertical edges\n    for j in range(Ny - 1):\n        for i in range(Nx):\n            v_edge_idx = n_h_edges + i + j * Nx\n            node_idx_bottom = i + j * Nx\n            node_idx_top = i + (j + 1) * Nx\n            G[v_edge_idx, node_idx_bottom] = -1.0\n            G[v_edge_idx, node_idx_top] = 1.0\n\n    # 2. Construct discrete curl operator C (size: n_cells x n_edges)\n    C = np.zeros((n_cells, n_edges))\n    for j in range(Ny - 1):\n        for i in range(Nx - 1):\n            cell_idx = i + j * (Nx - 1)\n            \n            h_edge_bottom_idx = i + j * (Nx - 1)\n            h_edge_top_idx = i + (j + 1) * (Nx - 1)\n            v_edge_left_idx = n_h_edges + i + j * Nx\n            v_edge_right_idx = n_h_edges + (i + 1) + j * Nx\n            \n            # Curl is implemented as a discrete line integral around the cell.\n            # (dEy/dx - dEx/dy) ~ (E_y(right) - E_y(left)) - (E_x(top) - E_x(bottom))\n            C[cell_idx, v_edge_right_idx] = 1.0\n            C[cell_idx, v_edge_left_idx] = -1.0\n            C[cell_idx, h_edge_top_idx] = -1.0\n            C[cell_idx, h_edge_bottom_idx] = 1.0\n\n    # 3. Define mass-like matrices\n    me_diag = np.concatenate([np.full(n_h_edges, hx), np.full(n_v_edges, hy)])\n    M_e = np.diag(me_diag)\n    w_diag = np.full(n_cells, hx * hy)\n    W = np.diag(w_diag)\n\n    # 4. Define discrete curl-curl stiffness and exact constraint matrices\n    A = C.T @ W @ C\n    B = G.T @ M_e\n\n    # 5. Define perturbation matrix Q_e\n    qe_diag = np.array([(-1)**i for i in range(n_edges)])\n    Q_e = np.diag(qe_diag)\n    \n    # 6. Define mass matrix M_alpha for the mixed system\n    m_alpha_diag = np.concatenate([me_diag, np.full(n_nodes, alpha)])\n    M_alpha_inv_sqrt = np.diag(1.0 / np.sqrt(m_alpha_diag))\n\n    all_results = []\n    \n    for eta in test_etas:\n        # a. Construct perturbed constraint matrix B_eta\n        B_eta = G.T @ M_e @ (np.eye(n_edges) + eta * Q_e)\n\n        # b. Assemble the mixed system matrix K_eta\n        K_eta = np.block([\n            [A, B_eta.T],\n            [B_eta, -gamma * np.eye(n_nodes)]\n        ])\n\n        # c. Transform to a standard symmetric eigenproblem and solve\n        K_tilde = M_alpha_inv_sqrt @ K_eta @ M_alpha_inv_sqrt\n        eigenvalues, eigenvectors_y = np.linalg.eigh(K_tilde)\n\n        # d. Analyze the smallest k positive eigenpairs\n        positive_indices = np.where(eigenvalues > 1e-12)[0]\n        sorted_positive_indices = positive_indices[np.argsort(eigenvalues[positive_indices])]\n        indices_to_analyze = sorted_positive_indices[:k]\n\n        spurious_count = 0\n        physical_mode_div_pollutions = []\n\n        for idx in indices_to_analyze:\n            y = eigenvectors_y[:, idx]\n            x = M_alpha_inv_sqrt @ y\n            E_vec = x[:n_edges]\n            \n            norm_E = np.linalg.norm(E_vec)\n            if norm_E  1e-12:\n                continue\n\n            # Calculate curl ratio\n            curl_E = C @ E_vec\n            norm_curl_E = np.linalg.norm(curl_E)\n            r_curl = norm_curl_E / norm_E\n            \n            # Classify mode and compute diagnostics\n            if r_curl  eps_curl:\n                spurious_count += 1\n            else:\n                div_pollution = np.linalg.norm(B_eta @ E_vec) / norm_E\n                physical_mode_div_pollutions.append(div_pollution)\n        \n        # Calculate mean divergence pollution over physical modes\n        mean_div_pollution = np.mean(physical_mode_div_pollutions) if physical_mode_div_pollutions else 0.0\n\n        # e. Calculate variational crime norm\n        B_eta_minus_B = B_eta - B\n        norm_B = np.linalg.norm(B, ord=2)\n        crime_norm = np.linalg.norm(B_eta_minus_B, ord=2) / norm_B if norm_B > 1e-12 else np.linalg.norm(B_eta_minus_B, ord=2)\n\n        all_results.append([spurious_count, mean_div_pollution, crime_norm])\n    \n    # Format and print the final output\n    result_strings = [f\"[{s},{d:.6e},{c:.6e}]\" for s, d, c in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}