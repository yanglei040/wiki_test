## 引言
间断Galerkin（DG）方法作为一种高阶数值技术，在计算电磁学及其他科学与工程领域获得了广泛应用。其核心优势在于允许解在网格单元之间存在间断，从而为处理复杂几何、[非均匀网格](@entry_id:752607)和p-自适应提供了极大的灵活性。然而，这种自由也带来了一个根本性的挑战：如何跨越这些间断来传递信息，以确保数值解既稳定又准确地逼近物理现实？这个问题的答案，便是“数值通量”（numerical flux）。

[数值通量](@entry_id:752791)是DG方法的基石，它是在单元边界上精心设计的数学公式，用以取代物理上因解的间断而变得模糊不清的通量项。它不仅是连接离散单元的“胶水”，更是将物理定律（如[能量守恒](@entry_id:140514)、[阻抗匹配](@entry_id:151450)）注入离散格式的关键机制。本文旨在系统性地揭示[数值通量](@entry_id:752791)的奥秘，解决其“为何必要”以及“如何构造”的核心问题。

在接下来的章节中，您将踏上一段从理论到实践的旅程。在“原理与机制”一章中，我们将深入探讨[数值通量](@entry_id:752791)的基本性质、从简单的一阶[双曲系统](@entry_id:260647)（如时域麦克斯韦方程）的[中心通量](@entry_id:747204)和[迎风通量](@entry_id:143931)，到[二阶椭圆问题](@entry_id:754613)的内部罚函数法，并分析其背后的稳定性与精度权衡。随后，在“应用与交叉学科联系”一章中，我们将展示数值通量在处理物理边界、复杂[材料建模](@entry_id:751724)、几何复杂性乃至跨学科问题时的强大威力。最后，“动手实践”部分将提供具体的编程练习，让您亲手实现并验证所学到的理论知识，从而将抽象概念转化为切实的计算能力。

## 原理与机制

在上一章中，我们介绍了间断Galerkin（DG）方法的基本思想，即在网格单元上允许解存在间断。这种选择为我们带来了巨大的灵活性，但也引入了一个核心挑战：如何跨越这些间断的边界来耦合相邻的单元，以确保解的全局一致性和稳定性。这个耦合机制的核心就是**[数值通量](@entry_id:752791) (numerical flux)**。本章将深入探讨数值通量的基本原理、不同类型的构造及其在麦克斯韦方程离散化中的关键作用。

### [DG方法](@entry_id:748369)中[数值通量](@entry_id:752791)的基本概念

要理解数值通量的必要性，我们首先要回顾DG方法的[弱形式](@entry_id:142897)推导。以一阶时域[麦克斯韦方程组](@entry_id:150940)为例：
$$
\partial_t(\varepsilon\mathbf{E}) - \nabla \times \mathbf{H} = \mathbf{0}
$$
$$
\partial_t(\mu\mathbf{H}) + \nabla \times \mathbf{E} = \mathbf{0}
$$

当我们在单个单元 $K$ 内，用[检验函数](@entry_id:166589) $\mathbf{v}$ 对第一个方程进行[Galerkin投影](@entry_id:145611)并分部积分时，会得到如下形式的边界积分项：
$$
\int_K (\nabla \times \mathbf{H}) \cdot \mathbf{v} \, dV = \int_{\partial K} (\mathbf{H} \times \mathbf{v}) \cdot \mathbf{n} \, dS + \int_K \mathbf{H} \cdot (\nabla \times \mathbf{v}) \, dV = \int_{\partial K} (\mathbf{n} \times \mathbf{H}) \cdot \mathbf{v} \, dS + \int_K \mathbf{H} \cdot (\nabla \times \mathbf{v}) \, dV
$$
这里的 $\mathbf{n}$ 是单元 $K$ 的外法向单位向量。半离散弱形式变为：
$$
\int_K \varepsilon \partial_t \mathbf{E}_h \cdot \mathbf{v}_h \, dV - \int_K \mathbf{H}_h \cdot (\nabla \times \mathbf{v}_h) \, dV - \int_{\partial K} (\mathbf{n} \times \mathbf{H}) \cdot \mathbf{v}_h \, dS = 0
$$
问题在于，由于DG解 $\mathbf{H}_h$ 在单元边界 $\partial K$ 上是间断的，其值是双值的（取决于从哪个单元逼近边界）。因此，表达式中的物理通量 $\mathbf{n} \times \mathbf{H}$ 没有唯一的定义。数值通量的任务正是为此提供一个确定的、单值的替代，我们记为 $(\mathbf{n} \times \mathbf{H})^*$。类似地，第二个方程会引入数值通量 $(\mathbf{n} \times \mathbf{E})^*$。

一个有效且可靠的[数值通量](@entry_id:752791)必须满足两个基本性质：**相容性 (consistency)** 和 **守恒性 (conservation)**。

#### 核心性质：相容性与守恒性

**相容性** 是连接[数值格式](@entry_id:752822)与原始[偏微分方程](@entry_id:141332)的桥梁。它要求，当数值解在某个界面上恰好连续时，数值通量必须退化为物理通量。也就是说，如果界面两侧的场迹（traces）相等，即 $\mathbf{E}^+ = \mathbf{E}^-$ 且 $\mathbf{H}^+ = \mathbf{H}^-$，那么必须有 $(\mathbf{n} \times \mathbf{E})^* = \mathbf{n} \times \mathbf{E}^\pm$ 和 $(\mathbf{n} \times \mathbf{H})^* = \mathbf{n} \times \mathbf{H}^\pm$。这一性质保证了如果我们的数值解收敛到物理上光滑的精确解时，我们的离散格式能够正确地再现原始的PDE。

物理上，在没有[表面电流](@entry_id:261791)或[表面电荷](@entry_id:160539)的介质交界面上，麦克斯韦方程的积分形式要求电场和磁场的切向分量是连续的。例如，通过在界面上构造一个无穷小的矩形回路，并应用法拉第电磁感应定律，可以证明 $\mathbf{n} \times (\mathbf{E}^+ - \mathbf{E}^-) = \mathbf{0}$。同理，应用[安培-麦克斯韦定律](@entry_id:266368)可得 $\mathbf{n} \times (\mathbf{H}^+ - \mathbf{H}^-) = \mathbf{0}$。DG方法的相容性条件正是这些物理连续性条件的离散体现。

**守恒性** 则与全局物理量的[守恒定律](@entry_id:269268)相关。在[DG方法](@entry_id:748369)中，守恒性通过巧妙的构造得以实现。[数值通量](@entry_id:752791) $(\mathbf{n} \times \mathbf{E})^*$ 和 $(\mathbf{n} \times \mathbf{H})^*$ 在每个内部界面上被定义为单值函数。考虑共享一个面 $F$ 的两个相邻单元 $K^+$ 和 $K^-$。$K^+$ 的外法向为 $\mathbf{n}^+ = \mathbf{n}$，而 $K^-$ 的外法向为 $\mathbf{n}^- = -\mathbf{n}$。在全局[弱形式](@entry_id:142897)中，来自面 $F$ 的总边界积分为：
$$
\int_F (\mathbf{n}^+ \times \mathbf{H})^* \cdot \mathbf{v}_h^+ \, dS + \int_F (\mathbf{n}^- \times \mathbf{H})^* \cdot \mathbf{v}_h^- \, dS
$$
由于[数值通量](@entry_id:752791)是单值的，并且法向相反，即 $(\mathbf{n}^- \times \mathbf{H})^* = (-\mathbf{n} \times \mathbf{H})^* = -(\mathbf{n} \times \mathbf{H})^*$，当检验函数连续时，这两项会精确抵消。这种局部抵消的特性确保了当我们在整个计算域上对所有单元的方程求和时，所有内部界面的通量贡献都将消失，从而离散地保持了全局守恒律。

### 一阶[双曲系统](@entry_id:260647)的通量

对于麦克斯韦方程这样的一阶[双曲系统](@entry_id:260647)，有多种构造数值通量的方法，其中最基本和最常用的是[中心通量](@entry_id:747204)和[迎风通量](@entry_id:143931)。为方便讨论，我们定义界面上任意场量 $\mathbf{q}$ 的平均和跳跃算子：
$$
\{\mathbf{q}\} := \frac{1}{2}(\mathbf{q}^+ + \mathbf{q}^-), \qquad [\![\mathbf{q}]\!] := \mathbf{q}^+ - \mathbf{q}^-
$$

#### [中心通量](@entry_id:747204)：简单的算术平均

最直观的数值通量构造方法是对界面两侧的场值取算术平均。这就是**[中心通量](@entry_id:747204) (central flux)**：
$$
(\mathbf{n} \times \mathbf{E})^* = \mathbf{n} \times \{\mathbf{E}\}, \qquad (\mathbf{n} \times \mathbf{H})^* = \mathbf{n} \times \{\mathbf{H}\}
$$
这种通量显然是相容和守恒的。它的一个非常重要的特性是**非[耗散性](@entry_id:162959) (non-dissipative)**。在一个无损介质中，使用[中心通量](@entry_id:747204)的DG[半离散格式](@entry_id:165671)在理论上精确地守恒离散能量。我们可以通过分析界面对总能量变化率的贡献来证明这一点。对于一维麦克斯韦方程，界面对能量变化率的贡献可以被推导为：
$$
\frac{d}{dt}W_h^{\text{interface}} = (E^{-} - E^{+})\hat{H} + (H^{-} - H^{+})\hat{E} - (E^{-}H^{-} - E^{+}H^{+})
$$
将[中心通量](@entry_id:747204) $\hat{E} = (E^{-} + E^{+})/2$ 和 $\hat{H} = (H^{-} + H^{+})/2$ 代入，经过简单的代数运算，我们发现上式恒等于零。
$$
\frac{d}{dt}W_h^{\text{interface}} = (E^{-}H^{-} - E^{+}H^{+}) - (E^{-}H^{-} - E^{+}H^{+}) = 0
$$
这意味着能量不会因为通过数值界面而产生或损失。然而，这种完美的[能量守恒](@entry_id:140514)是一把双刃剑。它意味着该格式无法抑制数值计算中可能出现的非物理性高频[振荡](@entry_id:267781)。在某些情况下，这些[振荡](@entry_id:267781)的能量会累积，最终导致计算发散。因此，纯[中心通量](@entry_id:747204)格式通常被认为是弱不稳定的。

#### [迎风通量](@entry_id:143931)：引入波动物理

为了克服[中心通量](@entry_id:747204)的稳定性问题，我们需要引入一种机制来耗散掉非物理的数值噪声。**迎風通量 (upwind flux)** 正是为此而生。它基于求解界面处的局部一维黎曼问题，其思想是根据[波的传播](@entry_id:144063)方向来选择通量的值。对于麦克斯韦方程，这导致在[中心通量](@entry_id:747204)的基础上增加一个与场的跳跃成正比的耗散项：
$$
(\mathbf{n} \times \mathbf{E})^* = \mathbf{n} \times \{\mathbf{E}\} + \frac{Z}{2} \mathbf{n} \times (\mathbf{n} \times [\![\mathbf{H}]\!])
$$
$$
(\mathbf{n} \times \mathbf{H})^* = \mathbf{n} \times \{\mathbf{H}\} - \frac{1}{2Z} \mathbf{n} \times (\mathbf{n} \times [\![\mathbf{E}]\!])
$$
其中 $Z = \sqrt{\mu/\varepsilon}$ 是介质的[波阻抗](@entry_id:276571)。这个新增的项被称为**罚项 (penalty term)** 或**[人工耗散](@entry_id:746522)项 (artificial dissipation)**。当界面两侧的场值存在差异（即 $[\![\mathbf{E}]\!] \neq \mathbf{0}$ 或 $[\![\mathbf{H}]\!] \neq \mathbf{0}$）时，这个项就会起作用，它会从数值解中移除能量，其效果类似于物理上的阻尼。这种耗散保证了[DG格式](@entry_id:178043)的[L2稳定性](@entry_id:751097)，使其在实际计算中更加鲁棒。

值得注意的是，由于耗散项与跳跃 $[\![\cdot]\!]$ 成正比，当解在界面处连续时，它会自动消失，因此[迎风通量](@entry_id:143931)同样满足**相容性**。同时，它的构造也保证了**守恒性**。

#### 精度与物理保真度

一个自然的问题是：引入[数值通量](@entry_id:752791)这种人工构造是否会污染物理结果？答案是，一个精心设计的[数值通量](@entry_id:752791)不仅不会破坏物理，反而能精确地再现物理。

例如，考虑一个平面波垂直入射到两种不同介质的交界面上。物理上，这会产生反射和透射，其系数由菲涅尔方程给出。如果我们用[迎风通量](@entry_id:143931)来模拟这个界面，在离散解收敛到物理精确解的极限下，可以证明[迎风通量](@entry_id:143931)所强制的[界面条件](@entry_id:750725)恰好能导出经典的菲涅尔反射和透射系数：
$$
r_E = \frac{Z_2 - Z_1}{Z_1 + Z_2}, \qquad t_E = \frac{2Z_2}{Z_1 + Z_2}
$$
这表明[迎风通量](@entry_id:143931)内嵌了正确的物理阻抗匹配条件。

另一个担忧是，[DG方法](@entry_id:748369)在每个单元边界都引入了一个“数值界面”，这是否会产生非物理的虚假反射？考虑一个均匀介质，我们用DG网格将其离散化。在理想情况下，一个平面波应该无反射地穿过这些数值界面。分析表明，对于精确表示的[平面波](@entry_id:189798)，无论是[中心通量](@entry_id:747204)还是[迎风通量](@entry_id:143931)，在DG界面上产生的[数值反射](@entry_id:752819)系数都精确为零。这消除了我们的担忧，并增强了我们对DG方法物理保真度的信心。

### 通量设计与分析的高级主题

#### [色散](@entry_id:263750)与耗散：稳定性与精度的权衡

除了稳定性，[数值通量](@entry_id:752791)的选择还深刻影响着数值解的精度，特别是对于波传播问题，我们关心的是**数值色散 (numerical dispersion)** 和**[数值耗散](@entry_id:168584) (numerical dissipation)**。数值色散是指数值格式计算出的[波速](@entry_id:186208)依赖于波的频率（或波数），导致波包在传播过程中变形。[数值耗散](@entry_id:168584)则指波的振幅随传播而衰减。

[DG方法](@entry_id:748369)的一个显著优点是其[高阶精度](@entry_id:750325)和低[色散](@entry_id:263750)特性。对于使用p阶多项式的[DG方法](@entry_id:748369)，其相位速度误差具有**超收敛 (superconvergence)** 性质。对于小的无量纲波数 $\kappa = kh$（其中 $h$ 是单元尺寸），其误差阶为 $\mathcal{O}(\kappa^{2p+2})$。这意味着，例如，一个线性元（$p=1$）的DG方法具有四阶的[色散](@entry_id:263750)精度 $\mathcal{O}(\kappa^4)$，而一个三次元（$p=3$）的方法具有惊人的八阶精度 $\mathcal{O}(\kappa^8)$。

比较[中心通量](@entry_id:747204)和[迎风通量](@entry_id:143931)：
- **[色散](@entry_id:263750)精度**：两者具有相同的误差阶 $\mathcal{O}(\kappa^{2p+2})$。然而，[中心通量](@entry_id:747204)的[误差常数](@entry_id:168754)更小，意味着在同等分辨率下，它的[色散误差](@entry_id:748555)略低于[迎风通量](@entry_id:143931)。
- **耗散**：[中心通量](@entry_id:747204)是无耗散的，而[迎风通量](@entry_id:143931)的耗散误差阶为 $\mathcal{O}(\kappa^{2p+1})$。

这揭示了[数值通量](@entry_id:752791)设计中的一个基本**权衡 (trade-off)**：[迎风通量](@entry_id:143931)通过引入耗散增强了方法的稳定性和鲁棒性，但代价是牺牲了微小的精度，并使物理上无损的波在数值上产生衰减。[中心通量](@entry_id:747204)精度更高且无耗散，但其稳定性较差。在实践中，[迎风通量](@entry_id:143931)及其变体因其鲁棒性而更受欢迎。

此外，[DG方法](@entry_id:748369)的一个独特之处在于其谱特性。由于单元之间是间断耦合的，DG离散算子除了拥有近似物理传播模式的“[声学](@entry_id:265335)分支”外，还存在一系列与单元内部[振荡](@entry_id:267781)相关的高频、非物理的“光学分支”。这些模式是数值伪影。[迎风通量](@entry_id:143931)的耗散作用对于抑制这些寄生模式尤其有效，而这正是连续[Galerkin方法](@entry_id:260906)（CG）所没有的问题和机制。

#### [复杂介质](@entry_id:164088)中的通量：物理方法与代数方法

当我们将[DG方法](@entry_id:748369)应用于更复杂的介质，如各向异性或有损介质时，数值通量的设计变得更具挑战性。此时，简单的标量阻抗 $Z$ 不再适用，波的物理特性变得错综复杂。在这种情况下，构造稳定通量主要有两种思路：

1.  **物理波[迎风](@entry_id:756372) (Physical-wave upwinding)**：这种方法坚持从物理第一性原理出发。它利用坡印亭矢量 $\mathbf{S} = \mathbf{E} \times \mathbf{H}$ 来判断能量在界面处的流动方向，从而区分入射波和出射波。只要介质是无源的（即材料参数张量 $\boldsymbol{\epsilon}$, $\boldsymbol{\mu}$, $\boldsymbol{\sigma}$ 满足物理上的[正定性](@entry_id:149643)），基于[能量流](@entry_id:142770)的通量构造就能保证数值格式的[能量稳定性](@entry_id:748991)。在[各向异性介质](@entry_id:187796)中，切向[电场和[磁](@entry_id:261347)场](@entry_id:153296)的关系由一个 $2 \times 2$ 的[阻抗矩阵](@entry_id:274892) $\mathbf{Z}(\mathbf{n})$ 描述，该矩阵依赖于界面法向和[材料张量](@entry_id:196294)。

2.  **代数特征分裂 (Algebraic characteristic splitting)**：这种方法则更加抽象，它试图从纯代数的角度分裂一维通量矩阵 $\mathbf{A}_n$。目标是将其分解为具有正[特征值](@entry_id:154894)谱和负[特征值](@entry_id:154894)谱的两部分，$\mathbf{A}_n = \mathbf{A}_n^+ + \mathbf{A}_n^-$，分别对应于“右行”和“左行”的特征波。在理想的各向同性无损介质中，这种分裂是清晰的。然而，在[复杂介质](@entry_id:164088)中，$\mathbf{A}_n$ 的特征结构可能变得非常病态：它可能是**亏损的 (defective)**（即无法对角化），或者其[特征向量](@entry_id:151813)在能量范数下非正交。盲目地使用基于[特征分解](@entry_id:181333)的耗散项 $| \mathbf{A}_n | = \mathbf{Q} |\mathbf{\Lambda}| \mathbf{Q}^{-1}$ 可能会导致耗散矩阵 $\mathcal{M} |\mathbf{A}_n|$ 不再是半正定的，从而引入非物理的“数值增益”，破坏稳定性。

为了克服代数方法的脆弱性，可以使用更鲁棒的工具，如**[矩阵符号函数](@entry_id:751764) (matrix sign function)**。它可以构造出所需的[子空间](@entry_id:150286)[投影算子](@entry_id:154142) $\frac{1}{2}(\mathbf{I} \pm \operatorname{sign}(\mathbf{A}_n))$，而无需直接计算[特征向量](@entry_id:151813)，从而在面对病态特征结构时表现出更好的稳定性。在简单介质中，这种方法与物理波迎风方法是等价的。

### 二阶系统的通量：内部[罚函数法](@entry_id:636090)

前面的讨论都集中于一阶[双曲系统](@entry_id:260647)。然而，在[频域](@entry_id:160070)电磁学中，我们经常求解关于[电场](@entry_id:194326)的二阶**[旋度-旋度方程](@entry_id:748113) (curl-curl equation)**：
$$
\nabla \times (\mu^{-1} \nabla \times \mathbf{E}) - \omega^2 \epsilon \mathbf{E} = \mathbf{f}
$$
这是一个椭圆型（或[不定型](@entry_id:150990)）的[偏微分方程](@entry_id:141332)，其数学性质与一阶[双曲系统](@entry_id:260647)截然不同。因此，基于黎曼问题的[迎风通量](@entry_id:143931)不再适用。对于这类二阶问题，DG社区发展了**内部[罚函数](@entry_id:638029) (Interior Penalty, IP)** 方法，其中最常用的是**[对称内部罚](@entry_id:755719)函数Galerkin (Symmetric Interior Penalty Galerkin, SIPG)** 方法。

在SIPG的推导中，对旋度项进行两次[分部积分](@entry_id:136350)，会产生两种类型的边界项：一种涉及场本身的迹 $\mathbf{n} \times \mathbf{E}$，另一种涉及其“[法向导数](@entry_id:169511)”的迹，即 $\mu^{-1} \nabla \times \mathbf{E}$。SIPG通量通过以下三个部分的组合来处理这些边界项：

1.  **相容性项 (Consistency term)**：形式为 $-\int_F \{\!\{\mu^{-1} \nabla \times \mathbf{E}_h\}\!\} \cdot \llbracket \mathbf{n} \times \mathbf{v}_h \rrbracket \, dS$。它将“[法向导数](@entry_id:169511)”的平均值与场的切向跳跃耦合起来，确保了格式的相容性。

2.  **对称性项 (Symmetry term)**：形式为 $-\int_F \{\!\{\mu^{-1} \nabla \times \mathbf{v}_h\}\!\} \cdot \llbracket \mathbf{n} \times \mathbf{E}_h \rrbracket \, dS$。它是相容性项的[伴随形式](@entry_id:747524)，它的引入使得最终的离散[双线性形式](@entry_id:746794)是对称的，这对于保证离散算子的自伴性至关重要。

3.  **罚项 (Penalty term)**：形式为 $+\int_F \tau_F \llbracket \mathbf{n} \times \mathbf{E}_h \rrbracket \cdot \llbracket \mathbf{n} \times \mathbf{v}_h \rrbracket \, dS$。这是[SIPG方法](@entry_id:754927)的核心。它惩罚了场 $\mathbf{E}_h$ 的切向分量在界面上的跳跃，从而[弱形式](@entry_id:142897)地强制了切向连续性。更重要的是，这一项为离散系统提供了**[矫顽性](@entry_id:159399) (coercivity)**，这是保证[数值格式稳定性](@entry_id:752825)和收敛性的关键。

罚参数 $\tau_F$ 的选择至关重要。它必须足够大以抵消来自相容性项的“[负能量](@entry_id:161542)”贡献，从而保证整个双线性形式是正定的。通过应用多项式**[逆迹不等式](@entry_id:750809) (inverse trace inequality)**，可以进行严格的数学分析，以确定保证稳定性的罚参数的最小尺度。分析结果表明，为了确保稳定性，罚参数必须与多项式次数的平方成正比，并与单元尺寸成反比：
$$
\tau_F \ge C \frac{p^2}{h_F}
$$
这里的 $C$ 是一个依赖于网格形状和材料属性的常数。这个罚项确保了即使在解是间断的情况下，DG方法对于二阶问题也能构建一个稳定且收敛的离散格式。它与CG方法中为增强稳定性而添加的罚项（如CIP）有相似之处，但它在DG框架中是不可或缺的，是连接间断单元的根本。

综上所述，[数值通量](@entry_id:752791)是DG方法的核心部件。从简单的[中心通量](@entry_id:747204)到物理驱动的[迎风通量](@entry_id:143931)，再到为二阶问题量身定制的内部罚函数法，每一种通量的设计都蕴含着对稳定性、精度和物理保真度的深刻理解与精妙平衡。正是这些灵活而强大的数值通量，使得DG方法能够成功地应用于从简单波动到复杂[介质电磁学](@entry_id:276901)等广泛的问题。