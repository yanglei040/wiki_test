{
    "hands_on_practices": [
        {
            "introduction": "The remarkable efficiency of the $p$-version Finite Element Method stems from its ability to achieve exponential convergence rates for problems with smooth (analytic) solutions. This practice delves into the theoretical heart of this phenomenon. By analyzing a simple one-dimensional wave problem, you will use principles from complex approximation theory, specifically the Bernstein ellipse technique, to explicitly derive the constants governing this exponential error decay . This exercise provides a concrete understanding of why $p$-refinement is so powerful in regions where the electromagnetic field is well-behaved.",
            "id": "3314615",
            "problem": "Consider a one-dimensional proxy of a time-harmonic electromagnetic field in a homogeneous, lossless medium, where the exact complex electric field component is given by the analytic function $u(x) = \\exp(\\mathrm{i}\\kappa x)$ on the closed interval $\\Omega = [-1,1]$, with real wavenumber $\\kappa > 0$. The field is to be approximated by a single-element $hp$-finite element method (Finite Element Method (FEM)) on $\\Omega$ using a trial space of polynomials of degree at most $p$ defined on the reference element, i.e., a fixed $h$ and variable $p$ refinement strategy (a limiting case of $hp$-refinement). Assume the error is measured in the uniform norm $\\|\\cdot\\|_{L^{\\infty}(\\Omega)}$.\n\nUse as foundational facts the analyticity of $u$ together with standard approximation theory of analytic functions on the interval $[-1,1]$ via polynomial spaces and the Bernstein ellipse technique. In particular, recall that for a function analytic in and on a Bernstein ellipse $\\mathcal{E}_{\\rho}$ with parameter $\\rho > 1$ (the image of the circle $|w|=\\rho$ under the Joukowski map $z=\\frac{1}{2}(w+w^{-1})$), with maximum modulus $M_{\\rho} = \\max_{z\\in \\mathcal{E}_{\\rho}}|u(z)|$, the best degree-$p$ polynomial approximation error on $[-1,1]$ admits an upper bound of the form $\\frac{2M_{\\rho}}{\\rho - 1}\\rho^{-p}$ in the $L^{\\infty}$ norm.\n\nFor the specified analytic field $u(x) = \\exp(\\mathrm{i}\\kappa x)$ and the single-element discretization (which is a trivial mesh grading scheme with a single element of length $2$), set the Bernstein ellipse parameter to the explicit value $\\rho = 2$. Treat the discrete solution $u_{hp}$ as the best approximation in the polynomial trial space (which provides a rigorous upper bound for any Galerkin solution due to quasi-optimality in norms equivalent to $L^{\\infty}$ under analyticity).\n\nCompute explicit constants $C$ and $\\alpha$ such that the following bound holds for all polynomial degrees $p \\in \\mathbb{N}$:\n$$\n\\|u - u_{hp}\\|_{L^{\\infty}(\\Omega)} \\le C \\exp(-\\alpha p).\n$$\nExpress the final answer as a closed-form analytic expression in terms of $\\kappa$ only. No numerical rounding is required and no physical units are to be reported. The angle unit is radians.",
            "solution": "### Solution Derivation\n\nThe objective is to determine the constants $C$ and $\\alpha$ in the error bound $\\|u - u_{hp}\\|_{L^{\\infty}(\\Omega)} \\le C \\exp(-\\alpha p)$. The problem states that the discrete solution $u_{hp}$ can be treated as the best polynomial approximation of degree $p$, denoted $u_p$. We are given the theoretical bound for the error of the best approximation:\n$$ \\|u - u_p\\|_{L^{\\infty}([-1,1])} \\le \\frac{2M_{\\rho}}{\\rho - 1}\\rho^{-p} $$\nWe are given $\\rho = 2$. Substituting this value into the bound gives:\n$$ \\|u - u_p\\|_{L^{\\infty}([-1,1])} \\le \\frac{2M_{2}}{2 - 1}2^{-p} = 2 M_2 2^{-p} $$\nThe next step is to calculate $M_2$, which is the maximum modulus of the analytic continuation of $u(x)$ on the Bernstein ellipse $\\mathcal{E}_2$. The function is $u(x) = \\exp(\\mathrm{i}\\kappa x)$. Its analytic continuation into the complex plane is $u(z) = \\exp(\\mathrm{i}\\kappa z)$ for $z \\in \\mathbb{C}$.\n\nWe need to compute $M_2 = \\max_{z \\in \\mathcal{E}_2} |u(z)|$. Let $z = x + \\mathrm{i}y$. The modulus of $u(z)$ is:\n$$ |u(z)| = |\\exp(\\mathrm{i}\\kappa(x + \\mathrm{i}y))| = |\\exp(\\mathrm{i}\\kappa x - \\kappa y)| = |\\exp(\\mathrm{i}\\kappa x)| \\cdot |\\exp(-\\kappa y)| = 1 \\cdot \\exp(-\\kappa y) = \\exp(-\\kappa y) $$\nSince the wavenumber $\\kappa$ is given as positive ($\\kappa > 0$), the function $\\exp(-\\kappa y)$ is a strictly decreasing function of $y$. Therefore, its maximum value on the ellipse $\\mathcal{E}_2$ will occur at the point where the imaginary part $y$ is minimum.\n\nA Bernstein ellipse $\\mathcal{E}_{\\rho}$ is defined by the Joukowski map $z = \\frac{1}{2}(w + w^{-1})$ applied to the circle $|w| = \\rho$ in the complex $w$-plane. Let $w = \\rho \\exp(\\mathrm{i}\\theta)$ for $\\theta \\in [0, 2\\pi)$. Then $z$ is given by:\n$$ z(\\theta) = \\frac{1}{2} \\left(\\rho \\exp(\\mathrm{i}\\theta) + \\frac{1}{\\rho} \\exp(-\\mathrm{i}\\theta) \\right) $$\nExpanding the complex exponentials:\n$$ z(\\theta) = \\frac{1}{2} \\left( \\rho(\\cos\\theta + \\mathrm{i}\\sin\\theta) + \\frac{1}{\\rho}(\\cos\\theta - \\mathrm{i}\\sin\\theta) \\right) $$\n$$ z(\\theta) = \\frac{1}{2} \\left(\\rho + \\frac{1}{\\rho}\\right)\\cos\\theta + \\mathrm{i} \\frac{1}{2}\\left(\\rho - \\frac{1}{\\rho}\\right)\\sin\\theta $$\nThe imaginary part of $z$ is $y(\\theta) = \\frac{1}{2}(\\rho - \\frac{1}{\\rho})\\sin\\theta$. Since $\\rho > 1$, the term $(\\rho - \\frac{1}{\\rho})$ is positive. The minimum value of $y(\\theta)$ occurs when $\\sin\\theta = -1$, which gives:\n$$ y_{\\min} = -\\frac{1}{2}\\left(\\rho - \\frac{1}{\\rho}\\right) $$\nNow we can evaluate $M_{\\rho}$:\n$$ M_{\\rho} = \\max_{z \\in \\mathcal{E}_{\\rho}} \\exp(-\\kappa y) = \\exp(-\\kappa y_{\\min}) = \\exp\\left(\\kappa \\frac{1}{2}\\left(\\rho - \\frac{1}{\\rho}\\right)\\right) $$\nFor the specific case $\\rho = 2$, the minimum value of $y$ is:\n$$ y_{\\min} = -\\frac{1}{2}\\left(2 - \\frac{1}{2}\\right) = -\\frac{1}{2}\\left(\\frac{3}{2}\\right) = -\\frac{3}{4} $$\nAnd the maximum modulus $M_2$ is:\n$$ M_2 = \\exp(-\\kappa y_{\\min}) = \\exp\\left(-\\kappa \\left(-\\frac{3}{4}\\right)\\right) = \\exp\\left(\\frac{3\\kappa}{4}\\right) $$\nSubstituting this expression for $M_2$ into our error bound:\n$$ \\|u - u_p\\|_{L^{\\infty}([-1,1])} \\le 2 \\exp\\left(\\frac{3\\kappa}{4}\\right) 2^{-p} $$\nTo match the target form $C \\exp(-\\alpha p)$, we rewrite the term $2^{-p}$ using the natural exponential function:\n$$ 2^{-p} = (e^{\\ln 2})^{-p} = \\exp(-p \\ln 2) $$\nThe error bound thus becomes:\n$$ \\|u - u_p\\|_{L^{\\infty}([-1,1])} \\le 2 \\exp\\left(\\frac{3\\kappa}{4}\\right) \\exp(-(\\ln 2)p) $$\nComparing this to the form $C \\exp(-\\alpha p)$, we can identify the constants $C$ and $\\alpha$:\n$$ C = 2 \\exp\\left(\\frac{3\\kappa}{4}\\right) $$\n$$ \\alpha = \\ln 2 $$\nThese constants are expressed in terms of $\\kappa$ as required.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 \\exp\\left(\\frac{3\\kappa}{4}\\right) & \\ln(2)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Beyond theoretical convergence rates, a crucial aspect of numerical simulation is controlling practical error metrics like numerical dispersion, which manifests as a phase error in wave propagation. This exercise bridges theory and application by asking you to determine the minimum polynomial degree $p$ required to keep the phase error below a specified tolerance for a given wavenumber-mesh-size product $kh$ . You will leverage the established superconvergence property of the FEM, where the phase error for the continuous Galerkin method scales as $\\mathcal{O}((kh)^{2p})$, to make an informed engineering decision, demonstrating how to design a simulation for a desired level of fidelity.",
            "id": "3314679",
            "problem": "Consider a one-dimensional time-harmonic electromagnetic field propagating in a homogeneous, lossless medium, so that the relevant field component satisfies the scalar Helmholtz equation $u''(x) + k^2 u(x) = 0$ with real wavenumber $k>0$. Discretize this equation on a uniform mesh of spacing $h>0$ using the continuous Galerkin finite element method (FEM) of polynomial degree $p \\in \\mathbb{N}$ on each element. For a periodic Bloch wave ansatz $u_j = \\exp(i j t)$ at grid nodes indexed by $j \\in \\mathbb{Z}$, the discretization admits a discrete Bloch wavenumber $k_h = t/h$, which in general differs from the exact $k$. Define the phase error as the relative wavenumber error $\\eta_p(kh) := |k_h - k|/k$.\n\nStarting from the standard variational formulation and the associated assembled nodal equations on a uniform mesh, perform a dispersion (Bloch/Fourier) analysis to determine the leading-order small-$kh$ dependence of $\\eta_p(kh)$. Use first principles to establish the power of $kh$ in the leading term and identify an explicit, $p$-independent constant $C>0$ that provides a conservative upper bound for the family of continuous Galerkin methods across all $p \\ge 1$ on a fixed small-$kh$ interval. Then, using that bound, determine the minimal polynomial degree $p$ that guarantees the target phase error threshold $\\eta_p(kh) \\le \\varepsilon$ for the specific values $kh = 0.5$ and $\\varepsilon = 1.0 \\times 10^{-3}$. Report the minimal integer $p$ that satisfies this guarantee. The final answer must be a single integer with no units.",
            "solution": "### Solution Derivation\n\nThe problem requires a dispersion analysis of the continuous Galerkin FEM for the 1D Helmholtz equation, $u'' + k^2 u = 0$.\n\n**2.1. Variational Formulation and Discretization**\nThe weak form of the Helmholtz equation is obtained by multiplying by a test function $v(x)$ and integrating over the domain. After integration by parts, the global variational problem is: Find $u \\in H^1(\\mathbb{R})$ such that\n$$ \\int_{-\\infty}^{\\infty} (-u'(x)v'(x) + k^2 u(x)v(x)) \\, dx = 0 $$\nfor all suitable test functions $v(x)$.\n\nWe discretize this using the continuous Galerkin method of degree $p$ on a uniform mesh of size $h$. The trial and test functions are continuous, piecewise polynomials of degree $p$. The assembled system of linear equations relates the values of the numerical solution at the mesh nodes. For a uniform mesh, the equation at any interior node $j$ takes the form of a stencil:\n$$ \\sum_{m} A_m u_{j+m} = 0 $$\nwhere $u_j$ is the solution at node $x_j=jh$. For a standard FEM assembly, this stencil couples adjacent nodes. Due to the symmetry of the uniform grid and basis functions, the stencil is symmetric. For a degree-$p$ method, only the endpoint nodal values are coupled globally, leading to a three-point stencil for the nodal values, after static condensation of interior-element degrees of freedom. The generic form of this stencil equation is:\n$$ A U_{j-1} + B U_j + A U_{j+1} = 0 $$\nwhere $U_j$ are the nodal values and the coefficients $A, B$ depend on $k, h, p$.\n\n**2.2. Dispersion Analysis**\nWe substitute the Bloch wave ansatz, $U_j=\\exp(i j t)$ where $t = k_h h$, into the stencil equation:\n$$ A \\exp(i(j-1)t) + B \\exp(ijt) + A \\exp(i(j+1)t) = 0 $$\nDividing by $A \\exp(ijt)$ yields $e^{-it} + B/A + e^{it} = 0$, which simplifies to the numerical dispersion relation:\n$$ 2\\cos(t) + B/A = 0 \\implies \\cos(k_h h) = -B/(2A) $$\nThe coefficients $A$ and $B$ are derived from the element stiffness and mass matrices. Let's derive these for the simplest case, $p=1$ (linear elements), using a reference element $\\xi \\in [-1, 1]$.\nThe shape functions are $\\phi_0(\\xi) = (1-\\xi)/2$ and $\\phi_1(\\xi) = (1+\\xi)/2$.\nThe reference stiffness and mass matrices are:\n$$ \\tilde{S}_{mn} = \\int_{-1}^{1} \\phi_m'(\\xi) \\phi_n'(\\xi) \\, d\\xi \\implies \\tilde{S} = \\begin{pmatrix} 1/2 & -1/2 \\\\ -1/2 & 1/2 \\end{pmatrix} $$\n$$ \\tilde{M}_{mn} = \\int_{-1}^{1} \\phi_m(\\xi) \\phi_n(\\xi) \\, d\\xi \\implies \\tilde{M} = \\begin{pmatrix} 2/3 & 1/3 \\\\ 1/3 & 2/3 \\end{pmatrix} $$\nThe element matrix is $K^e = -\\frac{2}{h}\\tilde{S} + k^2\\frac{h}{2}\\tilde{M}$.\nThe assembled equation for a node involves contributions from the two adjacent elements. The coefficients $A$ and $B$ are given by combinations of the entries of $K^e$. Specifically, $A$ is the off-diagonal coupling term and $B$ is the sum of diagonal terms.\n$A = K^e_{01} = -\\frac{2}{h}\\tilde{S}_{01} + k^2\\frac{h}{2}\\tilde{M}_{01} = -\\frac{2}{h}(-\\frac{1}{2}) + k^2\\frac{h}{2}(\\frac{1}{3}) = \\frac{1}{h} + \\frac{k^2h}{6}$.\nThe diagonal contribution to a node from one element is $K^e_{00}$ or $K^e_{11}$. So, $B = 2 K^e_{00} = 2(-\\frac{2}{h}\\tilde{S}_{00} + k^2\\frac{h}{2}\\tilde{M}_{00}) = 2(-\\frac{2}{h}(\\frac{1}{2}) + k^2\\frac{h}{2}(\\frac{2}{3})) = -\\frac{2}{h} + \\frac{2k^2h}{3}$.\nThe dispersion relation is $\\cos(k_h h) = -B/(2A) = -(-\\frac{2}{h} + \\frac{2k^2h}{3}) / (2(\\frac{1}{h} + \\frac{k^2h}{6})) = \\frac{1/h - k^2h/3}{1/h + k^2h/6}$.\nMultiplying numerator and denominator by $h$:\n$$ \\cos(k_h h) = \\frac{1 - (kh)^2/3}{1 + (kh)^2/6} $$\nTo find the phase error for small $kh$, we expand both sides. Let $z = (kh)^2$ and $t=k_h h$.\nRHS: $(1-z/3)(1+z/6)^{-1} = (1-z/3)(1 - z/6 + z^2/36 - \\dots) = 1 - z/2 + z^2/12 - \\dots$\nLHS: $\\cos(t) = 1 - t^2/2 + t^4/24 - \\dots$\nEquating the two series:\n$1 - t^2/2 + t^4/24 - \\dots = 1 - z/2 + z^2/12 - \\dots$\nComparing terms, we find $t^2/2 \\approx z/2$, so $t \\approx \\sqrt{z} = kh$ to leading order.\nFor the next order:\n$t^2 - t^4/12 + \\dots = z - z^2/6 + \\dots$\n$t^2 = z - z^2/6 + t^4/12 + \\dots \\approx z - z^2/6 + (kh)^4/12 = z - z^2/12$.\n$t^2 = (kh)^2 - (kh)^4/12 = (kh)^2(1 - (kh)^2/12)$.\n$t = k_h h = kh \\sqrt{1 - (kh)^2/12} \\approx kh(1 - (kh)^2/24)$.\nThe relative phase error for $p=1$ is:\n$$ \\eta_1(kh) = \\frac{|k_h - k|}{k} = \\frac{|k(1-(kh)^2/24) - k|}{k} = \\frac{(kh)^2}{24} $$\n\n**2.3. Generalization to Arbitrary p and Conservative Bound**\nFor general polynomial degree $p$, a similar (though more complex) analysis shows that the error is dominated by a single term for small $kh$. This is a well-known result in FEM theory (superconvergence).\nThe power of $kh$ in the leading error term is $2p$:\n$$ \\eta_p(kh) = |C_p|(kh)^{2p} + O((kh)^{2p+2}) $$\nThe constants $|C_p|$ are known to be a rapidly decreasing sequence for $p \\ge 1$. For continuous Galerkin FEM with Lagrange basis elements, the first few are $|C_1|=1/24$, $|C_2|=1/5760$, etc. Since $|C_p| \\le |C_1|$ for all $p \\ge 1$, we can establish a conservative (i.e., pessimistic) upper bound for the phase error that is valid for all $p \\ge 1$ by using the largest coefficient, $|C_1|$.\nThus, the first part of the problem asks to establish the power as $2p$. The second part asks for a $p$-independent constant $C$. We identify this as the upper bound on the coefficient, $C = |C_1| = 1/24$. This constant provides a conservative prefactor for the error formula.\nThe resulting conservative error bound for any $p \\ge 1$ is:\n$$ \\eta_p(kh) \\le \\frac{1}{24}(kh)^{2p} $$\nThis expression uses the $p$-independent constant $C=1/24$ and incorporates the correct $p$-dependent error order $(kh)^{2p}$.\n\n**2.4. Minimal Polynomial Degree Calculation**\nWe must find the minimal integer $p \\ge 1$ that satisfies the condition $\\eta_p(kh) \\le \\varepsilon$ for $kh = 0.5$ and $\\varepsilon = 1.0 \\times 10^{-3}$, using the conservative bound derived above.\n$$ \\frac{1}{24}(0.5)^{2p} \\le 1.0 \\times 10^{-3} $$\n$$ (0.5)^{2p} \\le 24 \\times 1.0 \\times 10^{-3} $$\n$$ (0.5^2)^p \\le 0.024 $$\n$$ (0.25)^p \\le 0.024 $$\nTo solve for $p$, we take the natural logarithm of both sides:\n$$ p \\ln(0.25) \\le \\ln(0.024) $$\nSince $\\ln(0.25) = \\ln(1/4) = -\\ln(4)$ is a negative number, we must reverse the inequality sign when dividing:\n$$ p \\ge \\frac{\\ln(0.024)}{\\ln(0.25)} $$\nUsing numerical values:\n$$ p \\ge \\frac{-3.7297}{-1.3863} \\approx 2.6904 $$\nSince the polynomial degree $p$ must be an integer, the minimal degree that satisfies this condition is $p=3$.\n\nLet's check the bound for $p=2$ and $p=3$.\nFor $p=2$: $\\eta_2(0.5) \\le \\frac{1}{24}(0.5)^4 = \\frac{1}{24 \\times 16} = \\frac{1}{384} \\approx 2.60 \\times 10^{-3}$. This is greater than $\\varepsilon$.\nFor $p=3$: $\\eta_3(0.5) \\le \\frac{1}{24}(0.5)^6 = \\frac{1}{24 \\times 64} = \\frac{1}{1536} \\approx 6.51 \\times 10^{-4}$. This is less than $\\varepsilon$.\nThus, the minimal integer polynomial degree required is $p=3$.",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "The true power of $hp$-FEM is realized in adaptive algorithms that automatically choose the best local refinement strategy: subdividing an element ($h$-refinement) or increasing its polynomial degree ($p$-refinement). This decision depends on the local regularity of the solution. This final practice guides you through implementing a sophisticated, modern $hp$-indicator based on a posteriori information from the solution itself . By analyzing the decay of hierarchical basis coefficients to estimate local smoothness, you will build a decision-making algorithm that compares the predicted efficiency of each refinement type, providing a hands-on experience with the logic at the core of advanced adaptive solvers.",
            "id": "3314673",
            "problem": "Consider the time-harmonic Maxwell equations in $2$ dimensions for a piecewise homogeneous dielectric wedge with interior angle $\\Theta \\in (0,\\pi)$, where the complex electric field $\\mathbf{E}$ satisfies\n$$\n\\nabla \\times \\mathbf{H} = -\\mathrm{i}\\,\\omega\\,\\epsilon\\,\\mathbf{E}, \\quad \\nabla \\times \\mathbf{E} = \\mathrm{i}\\,\\omega\\,\\mu\\,\\mathbf{H},\n$$\nwith angular frequency $\\omega = 2\\pi f$ and wavenumber $k = \\omega \\sqrt{\\mu \\epsilon}$. Assume a Transverse Magnetic (TM) polarization and standard boundary conditions so that a variational formulation is posed on $H(\\mathrm{curl})$ with Nédélec elements of polynomial degree $p$ on a triangular mesh. Around the wedge apex, the electromagnetic field exhibits corner singularities whose local regularity influences the error behavior of the finite element approximation.\n\nIn the context of $hp$-refinement, the canonical decision at each element is between mesh refinement ($h$-refinement by bisection) and local polynomial enrichment ($p \\to p+1$). A practical decision rule can be driven by an a posteriori saturation test that compares predicted error reductions per unit computational cost for the two actions, based on a computationally cheap proxy that leverages hierarchical modal information from the current solution.\n\nStarting from the following foundational facts:\n- For functions with local Sobolev regularity exponent $s>0$, $h$-refinement at fixed polynomial degree $p$ yields an error reduction proportional to $h^s$ in appropriate energy norms; for analytic functions, error in $p$-refinement decays exponentially with $p$, and for algebraic singularities of order $s$, error decays algebraically like $p^{-s}$.\n- Hierarchical finite element bases on each element provide modal coefficients $a_n$ whose asymptotic decay with respect to the local polynomial degree index $n$ reflects local regularity: for algebraic singularities, $|a_n| \\sim n^{-(\\nu+1)}$ with local regularity exponent $\\nu>0$.\n\nDefine the following cheap local proxies for the element $j$:\n- A measured hierarchical coefficient ratio $q_j = \\frac{|a_{p_j}|}{|a_{p_j-1}|}$ for the current polynomial degree $p_j$, with $0<q_j<1$ indicating decay.\n- An effective regularity exponent derived from $q_j$,\n$$\n\\nu_j = \\max\\left(0.1, -1 - \\frac{\\ln(q_j)}{\\ln\\left(\\frac{p_j}{p_j-1}\\right)}\\right),\n$$\nfor $p_j \\ge 2$ and $0<q_j<1$, with a fallback $\\nu_j = 0.5$ otherwise.\n- A predicted saturation factor for $p$-enrichment,\n$$\n\\gamma^{(p)}_j = \\left(\\frac{p_j}{p_j+1}\\right)^{\\nu_j},\n$$\nobtained by modeling algebraic convergence of order $\\nu_j$ when moving from degree $p_j$ to $p_j+1$.\n- A predicted saturation factor for element bisection ($h$-refinement at fixed $p_j$),\n$$\n\\gamma^{(h)}_j = 2^{-s_j}, \\quad\\text{with}\\quad s_j = \\min\\{p_j, \\nu_j\\},\n$$\nreflecting that halving the element size reduces the error by a factor consistent with the local regularity, and never exceeding the polynomial order.\n\nLet $\\eta_j>0$ be the current local a posteriori residual-based indicator (proportional to the error in the energy norm) on element $j$. Predicted error reductions for the two actions are\n$$\n\\Delta^{(p)}_j = \\eta_j \\left(1 - \\gamma^{(p)}_j\\right), \\quad \\Delta^{(h)}_j = \\eta_j \\left(1 - \\gamma^{(h)}_j\\right).\n$$\nTo compare per-unit computational cost, use a cost proxy based on degrees of freedom (DOFs) for two-dimensional Nédélec first-kind elements on triangles. A typical DOF count per element is\n$$\nd(p) = p^2 + 2p + 3,\n$$\nso the incremental cost for $p$-enrichment is\n$$\n\\mathrm{cost}^{(p)}_j = d(p_j+1) - d(p_j) = 2p_j + 3,\n$$\nwhile the incremental cost for bisection (adding one more element of degree $p_j$ in the local patch) is approximated by\n$$\n\\mathrm{cost}^{(h)}_j = d(p_j) = p_j^2 + 2p_j + 3.\n$$\nDefine the efficiency (error reduction per unit cost) for each action:\n$$\n\\mathrm{eff}^{(p)}_j = \\frac{\\Delta^{(p)}_j}{\\mathrm{cost}^{(p)}_j}, \\quad \\mathrm{eff}^{(h)}_j = \\frac{\\Delta^{(h)}_j}{\\mathrm{cost}^{(h)}_j}.\n$$\nThe $hp$ decision is to choose $p$ if $\\mathrm{eff}^{(p)}_j \\ge \\mathrm{eff}^{(h)}_j$ and $h$ otherwise.\n\nImplement a program that, for each test case, computes $\\nu_j$, $\\gamma^{(p)}_j$, $\\gamma^{(h)}_j$, $\\mathrm{eff}^{(p)}_j$, and $\\mathrm{eff}^{(h)}_j$, and returns the efficiency values together with the decision encoded as an integer ($1$ for $p$-enrichment, $0$ for $h$-bisection). The electromagnetic parameters are used to compute the wavenumber $k$ for completeness and consistency, although the decision rule here is driven by the modal proxy. Use the vacuum constants $\\epsilon_0 = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$ and $\\mu_0 = 4\\pi\\times 10^{-7}\\,\\mathrm{H/m}$.\n\nPhysical and numerical units:\n- All lengths ($h_j$, $r_j$) are in meters.\n- Frequency $f$ is in Hertz.\n- Angles (wedge interior angle $\\Theta$) are in radians.\n- Relative permittivities $\\epsilon_{r,1}$ and $\\epsilon_{r,2}$ and relative permeability $\\mu_r$ are dimensionless.\n\nTest suite:\nProvide the following five test cases, each as a tuple $(\\Theta, \\epsilon_{r,1}, \\epsilon_{r,2}, \\mu_r, f, h_j, r_j, p_j, q_j, \\eta_j)$:\n- Case $1$ (smooth region, moderate order): $(\\frac{\\pi}{2},\\,2.0,\\,1.0,\\,1.0,\\,1.0\\times 10^9,\\,0.05,\\,0.50,\\,4,\\,0.20,\\,0.15)$.\n- Case $2$ (near apex, weak modal decay): $(\\frac{\\pi}{3},\\,4.0,\\,1.0,\\,1.0,\\,2.0\\times 10^9,\\,0.10,\\,0.02,\\,3,\\,0.90,\\,0.40)$.\n- Case $3$ (higher order, moderate decay): $(\\frac{\\pi}{4},\\,2.0,\\,2.5,\\,1.0,\\,5.0\\times 10^9,\\,0.02,\\,0.30,\\,6,\\,0.40,\\,0.08)$.\n- Case $4$ (boundary case low order): $(\\frac{3\\pi}{4},\\,1.0,\\,3.0,\\,1.0,\\,0.5\\times 10^9,\\,0.20,\\,0.05,\\,1,\\,0.95,\\,0.30)$.\n- Case $5$ (very smooth region): $(\\frac{\\pi}{2},\\,1.0,\\,1.0,\\,1.0,\\,1.0\\times 10^8,\\,0.15,\\,1.00,\\,2,\\,0.05,\\,0.12)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list $[E_p, E_h, D]$ where $E_p$ and $E_h$ are the efficiency values $\\mathrm{eff}^{(p)}_j$ and $\\mathrm{eff}^{(h)}_j$ rounded to six decimal places, and $D$ is the integer decision ($1$ or $0$). The final output must therefore be a single line of the form\n$$\n\\left[[E_{p,1},E_{h,1},D_1],[E_{p,2},E_{h,2},D_2],[E_{p,3},E_{h,3},D_3],[E_{p,4},E_{h,4},D_4],[E_{p,5},E_{h,5},D_5]\\right].\n$$",
            "solution": "The problem requires the implementation of a decision algorithm for $hp$-refinement in the context of the Finite Element Method (FEM) for $2$D time-harmonic Maxwell's equations. The decision logic is based on a heuristic comparison of the predicted efficiency of two refinement actions: local polynomial enrichment ($p$-refinement) and local mesh bisection ($h$-refinement). The core task is to compute the predicted efficiencies for a set of given test cases and determine the optimal action based on these predictions.\n\nThe decision strategy is founded on well-established principles of FEM convergence theory. The efficiency of a refinement action is defined as the ratio of the predicted error reduction to the incremental computational cost.\n\nThe first key component is the estimation of local solution regularity, which dictates the convergence rate. The problem leverages hierarchical basis functions, where the magnitudes of the coefficients for higher-order modes provide insight into the local smoothness of the solution. For a solution exhibiting an algebraic singularity, the hierarchical modal coefficients $a_n$ decay asymptotically as $|a_n| \\sim n^{-(\\nu+1)}$, where $\\nu>0$ is the local regularity exponent in the Sobolev scale. From this, a ratio of the last two coefficients, $q_j = |a_{p_j}|/|a_{p_j-1}|$ for an element $j$ at polynomial degree $p_j$, can be used to estimate $\\nu$. Taking the logarithm of the ratio $|a_{p_j}|/|a_{p_j-1}| \\approx (p_j/(p_j-1))^{-(\\nu+1)}$ leads to the formula for the effective regularity exponent $\\nu_j$:\n$$\n\\nu_j = -1 - \\frac{\\ln(q_j)}{\\ln\\left(\\frac{p_j}{p_j-1}\\right)}\n$$\nTo ensure the model remains physically meaningful (as regularity exponents are positive) and robust against measurement noise in $q_j$, the problem defines a practical proxy with a lower bound:\n$$\n\\nu_j = \\max\\left(0.1, -1 - \\frac{\\ln(q_j)}{\\ln\\left(\\frac{p_j}{p_j-1}\\right)}\\right)\n$$\nThis formula is applicable for $p_j \\ge 2$ and $0 < q_j < 1$. For cases that do not meet these criteria (e.g., for linear elements where $p_j=1$), a fallback value of $\\nu_j = 0.5$ is assigned, representing a default assumption of moderate regularity.\n\nThe second component is the prediction of error reduction. Standard FEM theory states that for a solution with regularity $\\nu$, the error in the energy norm behaves as $\\mathcal{O}(p^{-\\nu})$ for $p$-refinement and $\\mathcal{O}(h^{\\min(p, \\nu)})$ for $h$-refinement. The predicted error after a refinement step is related to the current error by a saturation factor.\nFor $p$-enrichment from degree $p_j$ to $p_j+1$, the predicted saturation factor models the algebraic decay:\n$$\n\\gamma^{(p)}_j = \\left(\\frac{p_j}{p_j+1}\\right)^{\\nu_j}\n$$\nFor $h$-refinement by bisection (halving the element size $h_j$), the convergence order is $s_j = \\min\\{p_j, \\nu_j\\}$, limited by both the polynomial degree and the solution regularity. This gives a saturation factor:\n$$\n\\gamma^{(h)}_j = 2^{-s_j}\n$$\nGiven a local a posteriori error indicator $\\eta_j$ (which is proportional to the local error), the predicted error reductions are $\\Delta^{(p)}_j = \\eta_j (1 - \\gamma^{(p)}_j)$ and $\\Delta^{(h)}_j = \\eta_j (1 - \\gamma^{(h)}_j)$.\n\nThe third component is the computational cost model. The cost is approximated by the number of degrees of freedom (DOFs). The problem provides a proxy for the DOFs per element of degree $p$ for $2$D Nédélec elements as $d(p) = p^2 + 2p + 3$.\nThe incremental cost for $p$-enrichment is the addition of new DOFs:\n$$\n\\mathrm{cost}^{(p)}_j = d(p_j+1) - d(p_j) = ((p_j+1)^2 + 2(p_j+1) + 3) - (p_j^2 + 2p_j + 3) = 2p_j + 3\n$$\nThe incremental cost for $h$-bisection is approximated as the cost of adding one new element of the same degree $p_j$:\n$$\n\\mathrm{cost}^{(h)}_j = d(p_j) = p_j^2 + 2p_j + 3\n$$\nFinally, the efficiencies are computed by combining these components:\n$$\n\\mathrm{eff}^{(p)}_j = \\frac{\\Delta^{(p)}_j}{\\mathrm{cost}^{(p)}_j}, \\quad \\mathrm{eff}^{(h)}_j = \\frac{\\Delta^{(h)}_j}{\\mathrm{cost}^{(h)}_j}\n$$\nThe decision rule is to select the action with the greater efficiency. $p$-enrichment is chosen if $\\mathrm{eff}^{(p)}_j \\ge \\mathrm{eff}^{(h)}_j$ (encoded as decision $D=1$), and $h$-bisection is chosen otherwise ($D=0$).\n\nThe specific physical and geometric parameters of each test case ($\\Theta$, $\\epsilon_{r,1}$, $\\epsilon_{r,2}$, $\\mu_r$, $f$, $h_j$, $r_j$) provide context for a realistic FEM simulation scenario but are not directly used in the provided decision logic, which relies solely on the numerical parameters $(p_j, q_j, \\eta_j)$. The algorithm is implemented by applying these formulas sequentially for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the hp-refinement decision logic for the given test cases.\n    \"\"\"\n\n    # Test cases as tuples of:\n    # (Theta, eps_r1, eps_r2, mu_r, f, h_j, r_j, p_j, q_j, eta_j)\n    test_cases = [\n        # Case 1 (smooth region, moderate order)\n        (np.pi/2, 2.0, 1.0, 1.0, 1.0e9, 0.05, 0.50, 4, 0.20, 0.15),\n        # Case 2 (near apex, weak modal decay)\n        (np.pi/3, 4.0, 1.0, 1.0, 2.0e9, 0.10, 0.02, 3, 0.90, 0.40),\n        # Case 3 (higher order, moderate decay)\n        (np.pi/4, 2.0, 2.5, 1.0, 5.0e9, 0.02, 0.30, 6, 0.40, 0.08),\n        # Case 4 (boundary case low order)\n        (3*np.pi/4, 1.0, 3.0, 1.0, 0.5e9, 0.20, 0.05, 1, 0.95, 0.30),\n        # Case 5 (very smooth region)\n        (np.pi/2, 1.0, 1.0, 1.0, 1.0e8, 0.15, 1.00, 2, 0.05, 0.12),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        _, _, _, _, _, _, _, p_j, q_j, eta_j = case\n\n        # Step 1: Calculate the effective regularity exponent nu_j\n        if p_j >= 2 and 0  q_j  1:\n            nu_expr = -1 - np.log(q_j) / np.log(p_j / (p_j - 1))\n            nu_j = max(0.1, nu_expr)\n        else:\n            nu_j = 0.5\n\n        # Step 2: Calculate predicted saturation factors\n        # For p-enrichment\n        gamma_p_j = (p_j / (p_j + 1))**nu_j\n        \n        # For h-refinement\n        s_j = min(p_j, nu_j)\n        gamma_h_j = 2**(-s_j)\n\n        # Step 3: Calculate predicted error reductions\n        delta_p_j = eta_j * (1 - gamma_p_j)\n        delta_h_j = eta_j * (1 - gamma_h_j)\n\n        # Step 4: Calculate costs\n        cost_p_j = 2 * p_j + 3\n        cost_h_j = p_j**2 + 2 * p_j + 3\n\n        # Step 5: Calculate efficiencies\n        eff_p_j = delta_p_j / cost_p_j\n        eff_h_j = delta_h_j / cost_h_j\n\n        # Step 6: Make decision\n        # D=1 for p-enrichment, D=0 for h-bisection\n        decision = 1 if eff_p_j >= eff_h_j else 0\n\n        # Store results rounded to six decimal places\n        results.append([round(eff_p_j, 6), round(eff_h_j, 6), decision])\n\n    # Final print statement in the exact required format\n    # The repr() function on a list naturally formats it with spaces,\n    # and join combines them with commas as required.\n    print(f\"[{','.join(repr(res) for res in results)}]\")\n\nsolve()\n```"
        }
    ]
}