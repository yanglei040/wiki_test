{
    "hands_on_practices": [
        {
            "introduction": "The first step in any isogeometric analysis is to construct the discrete function space. This exercise provides foundational practice in defining the properties of the curl-conforming spline spaces that are central to modeling electromagnetic fields. By working through this calculation , you will gain a concrete understanding of how the dimension and continuity of these spaces are determined from the underlying B-spline degree and knot structure, and how they evolve under refinement.",
            "id": "3320575",
            "problem": "Consider a two-dimensional parametric domain with identical open uniform knot vectors in each parametric direction. Let the polynomial degree be $p=3$ and let there be $n$ control points per parametric direction. The internal knot multiplicity is $1$ and the end multiplicities are $p+1$. The number of univariate knot spans in each direction is thus $n-p$. For computational electromagnetics, consider the curl-conforming isogeometric space associated with the two-dimensional discrete de Rham sequence, namely the vector-valued spline space\n$$\\mathcal{V}^{1} = S^{p-1,p} \\times S^{p,p-1},$$\nwhere $S^{a,b}$ denotes the tensor-product B-spline space of bi-degree $(a,b)$ built on the given knot vectors.\n\nStarting from the core definitions of open uniform B-splines and their continuity properties (univariate dimension equals the number of knot spans plus the polynomial degree, and inter-element continuity across an internal knot of multiplicity $m$ equals $C^{p-m}$), and the definition of the curl-conforming space $\\mathcal{V}^{1}$ as above:\n\n- Derive the total number of tensor-product basis functions in $\\mathcal{V}^{1}$ in terms of $n$.\n- Determine the minimal global inter-element continuity order across any internal knot line for the vector field represented by $\\mathcal{V}^{1}$.\n- Define a single level of $k$-refinement as degree elevation by one in both parametric directions while keeping the internal multiplicities unchanged (and hence keeping the number of knot spans fixed). Under this operation, derive the new total number of tensor-product basis functions in the refined curl-conforming space and the new minimal global inter-element continuity order.\n\nProvide your final answer as a single row matrix containing, in order,\n$$\\big[\\text{initial dimension of } \\mathcal{V}^{1},\\ \\text{initial minimal global continuity order},\\ \\text{refined dimension},\\ \\text{refined minimal global continuity order}\\big],$$\nexpressed symbolically in terms of $n$. No numerical rounding is required, and no units are involved.",
            "solution": "The problem asks for the derivation of the dimension and minimal global inter-element continuity for a specific curl-conforming isogeometric space, both initially and after one level of $k$-refinement. The solution will proceed by first analyzing the initial configuration and then the refined configuration, based on the provided definitions.\n\nLet the two parametric directions be denoted by $\\xi$ and $\\eta$. The open uniform knot vectors are identical in both directions.\nThe initial polynomial degree is $p=3$.\nThe number of control points in each univariate direction is $n$.\nThe number of knot spans in each univariate direction is given as $n-p$.\nThe internal knot multiplicity is $m=1$.\nThe curl-conforming space is defined as $\\mathcal{V}^{1} = S^{p-1,p} \\times S^{p,p-1}$.\n\nA key piece of information is the relationship for the dimension of a univariate B-spline space built on the given knot vector structure:\nThe dimension of a univariate spline space with degree $d$ is given by the formula:\n$$\n\\text{dim}_{\\text{1D}}(d) = (\\text{number of knot spans}) + d\n$$\nFor the given problem, the number of knot spans is $n-p$. Thus, the dimension of a univariate space of degree $d$ is $(n-p)+d$.\n\nAnother key definition is the inter-element continuity for a univariate B-spline of degree $d$ across an internal knot of multiplicity $m$:\n$$\n\\text{Continuity} = C^{d-m}\n$$\n\nPart 1: Initial Dimension of $\\mathcal{V}^{1}$\n\nThe space $\\mathcal{V}^{1}$ is the Cartesian product of two tensor-product spline spaces, $S^{p-1,p}$ and $S^{p,p-1}$. The total number of basis functions (dimension) of $\\mathcal{V}^{1}$ is the sum of the dimensions of its component spaces:\n$$\n\\text{dim}(\\mathcal{V}^{1}) = \\text{dim}(S^{p-1,p}) + \\text{dim}(S^{p,p-1})\n$$\nThe dimension of a tensor-product space is the product of the dimensions of the corresponding univariate spaces. We use the given degree $p=3$.\n\nFor the space $S^{p-1,p} = S^{2,3}$:\nThe degree in the $\\xi$-direction is $d_{\\xi} = p-1 = 2$.\nThe degree in the $\\eta$-direction is $d_{\\eta} = p = 3$.\nThe number of knot spans is $n-p = n-3$.\nThe dimension of the univariate space in the $\\xi$-direction is $\\text{dim}_{\\text{1D}}(2) = (n-p) + (p-1) = n-1$.\nThe dimension of the univariate space in the $\\eta$-direction is $\\text{dim}_{\\text{1D}}(3) = (n-p) + p = n$.\nThe dimension of the tensor-product space $S^{2,3}$ is therefore:\n$$\n\\text{dim}(S^{2,3}) = (n-1) \\times n = n(n-1)\n$$\n\nFor the space $S^{p,p-1} = S^{3,2}$:\nThe degree in the $\\xi$-direction is $d_{\\xi} = p = 3$.\nThe degree in the $\\eta$-direction is $d_{\\eta} = p-1 = 2$.\nThe dimension of the univariate space in the $\\xi$-direction is $\\text{dim}_{\\text{1D}}(3) = (n-p) + p = n$.\nThe dimension of the univariate space in the $\\eta$-direction is $\\text{dim}_{\\text{1D}}(2) = (n-p) + (p-1) = n-1$.\nThe dimension of the tensor-product space $S^{3,2}$ is therefore:\n$$\n\\text{dim}(S^{3,2}) = n \\times (n-1) = n(n-1)\n$$\n\nThe total number of basis functions in $\\mathcal{V}^{1}$ is the sum:\n$$\n\\text{dim}(\\mathcal{V}^{1}) = n(n-1) + n(n-1) = 2n(n-1)\n$$\nThis is the initial dimension of the space.\n\nPart 2: Initial Minimal Global Continuity\n\nA vector field $\\mathbf{v} \\in \\mathcal{V}^{1}$ can be written as $\\mathbf{v}(\\xi, \\eta) = (v_1(\\xi, \\eta), v_2(\\xi, \\eta))$, where $v_1 \\in S^{p-1, p}$ and $v_2 \\in S^{p, p-1}$. The global continuity of the vector field $\\mathbf{v}$ is determined by the lowest continuity order among its components across all internal element boundaries (knot lines). The internal knot multiplicity is $m=1$.\n\nFor the first component, $v_1 \\in S^{p-1,p} = S^{2,3}$:\nContinuity across internal knot lines $\\xi = \\text{const}$: degree is $d_{\\xi}=2$. Continuity is $C^{d_{\\xi}-m} = C^{2-1} = C^1$.\nContinuity across internal knot lines $\\eta = \\text{const}$: degree is $d_{\\eta}=3$. Continuity is $C^{d_{\\eta}-m} = C^{3-1} = C^2$.\nThe minimal continuity for $v_1$ is $C^1$.\n\nFor the second component, $v_2 \\in S^{p,p-1} = S^{3,2}$:\nContinuity across internal knot lines $\\xi = \\text{const}$: degree is $d_{\\xi}=3$. Continuity is $C^{d_{\\xi}-m} = C^{3-1} = C^2$.\nContinuity across internal knot lines $\\eta = \\text{const}$: degree is $d_{\\eta}=2$. Continuity is $C^{d_{\\eta}-m} = C^{2-1} = C^1$.\nThe minimal continuity for $v_2$ is $C^1$.\n\nThe overall global continuity of the vector field $\\mathbf{v}$ is the minimum of the continuities of its components, which is $\\min(C^1, C^1) = C^1$. The minimal global inter-element continuity order is therefore $1$.\n\nPart 3: Refined Dimension after $k$-refinement\n\nThe $k$-refinement operation increases the degree by one, so the new degree is $p_{new} = p+1 = 3+1 = 4$. The number of knot spans and internal multiplicities remain unchanged.\nThe new curl-conforming space is $\\mathcal{V}^{1}_{\\text{refined}} = S^{p_{new}-1, p_{new}} \\times S^{p_{new}, p_{new}-1} = S^{3,4} \\times S^{4,3}$.\nWe calculate the dimension of this new space. The number of knot spans is still $n-p = n-3$.\n\nFor the space $S^{3,4}$:\nThe dimension of the univariate space in the $\\xi$-direction (degree $3$) is $(n-p) + p = n$.\nThe dimension of the univariate space in the $\\eta$-direction (degree $4$) is $(n-p) + (p+1) = n+1$.\nThe dimension of $S^{3,4}$ is $n(n+1)$.\n\nFor the space $S^{4,3}$:\nThe dimension of the univariate space in the $\\xi$-direction (degree $4$) is $(n-p) + (p+1) = n+1$.\nThe dimension of the univariate space in the $\\eta$-direction (degree $3$) is $(n-p) + p = n$.\nThe dimension of $S^{4,3}$ is $(n+1)n$.\n\nThe total dimension of the refined space is:\n$$\n\\text{dim}(\\mathcal{V}^{1}_{\\text{refined}}) = n(n+1) + n(n+1) = 2n(n+1)\n$$\n\nPart 4: Refined Minimal Global Continuity\n\nWe now determine the continuity of the refined space $\\mathcal{V}^{1}_{\\text{refined}} = S^{3,4} \\times S^{4,3}$. The new degree basis is $p_{new}=4$ (originating from $p=3$), and the multiplicity remains $m=1$. Let $\\mathbf{v}_{\\text{refined}} = (v_{1r}, v_{2r})$ with $v_{1r} \\in S^{3,4}$ and $v_{2r} \\in S^{4,3}$.\n\nFor the component $v_{1r} \\in S^{3,4}$:\nContinuity across lines $\\xi = \\text{const}$: degree $d_\\xi=3$. Continuity is $C^{3-1} = C^2$.\nContinuity across lines $\\eta = \\text{const}$: degree $d_\\eta=4$. Continuity is $C^{4-1} = C^3$.\nMinimal continuity for $v_{1r}$ is $C^2$.\n\nFor the component $v_{2r} \\in S^{4,3}$:\nContinuity across lines $\\xi = \\text{const}$: degree $d_\\xi=4$. Continuity is $C^{4-1} = C^3$.\nContinuity across lines $\\eta = \\text{const}$: degree $d_\\eta=3$. Continuity is $C^{3-1} = C^2$.\nMinimal continuity for $v_{2r}$ is $C^2$.\n\nThe minimal global inter-element continuity for the refined vector field is $\\min(C^2, C^2) = C^2$. The order is $2$.\n\nTo summarize, the four requested quantities are:\n1.  Initial dimension of $\\mathcal{V}^{1}$: $2n(n-1)$\n2.  Initial minimal global continuity order: $1$\n3.  Refined dimension: $2n(n+1)$\n4.  Refined minimal global continuity order: $2$\nThese will be presented in a row matrix as requested.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2n(n-1) & 1 & 2n(n+1) & 2\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "To use our discrete spaces in a variational problem, we must compute integrals involving derivatives, which on curved domains requires transforming gradients from a simple parametric domain to the physical domain. This practice  guides you through the essential derivation of the physical gradient for a Non-Uniform Rational B-Spline (NURBS) basis function. Mastering this application of the chain and quotient rules is crucial for understanding how the mapping's Jacobian, $J_{F}$, influences the final discrete system.",
            "id": "3320526",
            "problem": "Consider the construction of curl-conforming isogeometric spaces for computational electromagnetics on a physical domain obtained by a Non-Uniform Rational B-Splines (NURBS) mapping. Let the reference (parametric) domain be $\\hat{\\Omega}=(0,1)^{3}$ with a tensor-product B-spline basis $\\{\\hat{B}_{A}(\\hat{x})\\}_{A=1}^{n}$, where $\\hat{x}\\in\\hat{\\Omega}$. Let the associated positive weights be $\\{w_{A}\\}_{A=1}^{n}$ and the control points be $\\{P_{A}\\in\\mathbb{R}^{3}\\}_{A=1}^{n}$. The rational basis functions are defined by\n$$\nR_{A}(\\hat{x})=\\frac{w_{A}\\,\\hat{B}_{A}(\\hat{x})}{W(\\hat{x})},\\quad\\text{with}\\quad W(\\hat{x})=\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x}).\n$$\nThe NURBS geometric mapping is given by\n$$\nF(\\hat{x})=\\sum_{A=1}^{n}R_{A}(\\hat{x})\\,P_{A},\n$$\nwith Jacobian (Jacobian matrix of the mapping) $J_{F}(\\hat{x})=\\nabla_{\\hat{x}}F(\\hat{x})\\in\\mathbb{R}^{3\\times 3}$. In curl-conforming isogeometric analysis, the physical gradient $\\nabla_{x}R_{A}$ at the physical point $x=F(\\hat{x})$ is related to the parametric gradient $\\nabla_{\\hat{x}}R_{A}$ via the chain rule,\n$$\n\\nabla_{x}R_{A}(x)=J_{F}(\\hat{x})^{-T}\\,\\nabla_{\\hat{x}}R_{A}(\\hat{x}).\n$$\nStarting from these definitions and fundamental multivariable calculus (product and quotient rules and the chain rule), derive a closed-form expression for $\\nabla_{x}R_{A}(\\hat{x})$ solely in terms of $J_{F}(\\hat{x})$, the weights $\\{w_{B}\\}$, the reference B-spline basis and its parametric gradients $\\{\\hat{B}_{B}(\\hat{x}),\\,\\nabla_{\\hat{x}}\\hat{B}_{B}(\\hat{x})\\}$, and the control points $\\{P_{B}\\}$. Your final expression should be a single analytic formula for $\\nabla_{x}R_{A}(\\hat{x})$ that does not introduce any undefined auxiliary symbols. Do not simplify $J_{F}(\\hat{x})^{-T}$ further; keep it as $J_{F}(\\hat{x})^{-T}$, but expand all other terms explicitly in terms of $\\{w_{B}\\}$ and $\\{\\hat{B}_{B},\\nabla_{\\hat{x}}\\hat{B}_{B}\\}$.\n\nProvide your final result as a single closed-form analytic expression. No numerical evaluation is required. If you choose to label summations, use explicit summation notation over the index set $\\{1,\\dots,n\\}$. The answer must be unitless and does not involve any rounding.",
            "solution": "The objective is to derive a closed-form expression for the physical gradient of a Non-Uniform Rational B-Spline (NURBS) basis function, $\\nabla_{x}R_{A}(x)$, where $x=F(\\hat{x})$. The derivation must be expressed in terms of the Jacobian of the geometric map $J_{F}(\\hat{x})$, the NURBS weights $\\{w_{B}\\}$, the control points $\\{P_{B}\\}$, and the underlying tensor-product B-spline basis functions $\\{\\hat{B}_{B}(\\hat{x})\\}$ and their parametric gradients $\\{\\nabla_{\\hat{x}}\\hat{B}_{B}(\\hat{x})\\}$.\n\nThe starting point is the chain rule connecting the physical gradient $\\nabla_{x}$ on the domain $\\Omega$ and the parametric gradient $\\nabla_{\\hat{x}}$ on the reference domain $\\hat{\\Omega}$:\n$$\n\\nabla_{x}R_{A}(x) = J_{F}(\\hat{x})^{-T}\\,\\nabla_{\\hat{x}}R_{A}(\\hat{x})\n$$\nHere, $J_{F}(\\hat{x})^{-T}$ denotes the inverse transpose of the Jacobian matrix of the geometric mapping $F(\\hat{x})$. The core of the derivation is to find an explicit expression for the parametric gradient $\\nabla_{\\hat{x}}R_{A}(\\hat{x})$.\n\nThe rational basis function $R_{A}(\\hat{x})$ is defined as a quotient:\n$$\nR_{A}(\\hat{x}) = \\frac{w_{A}\\,\\hat{B}_{A}(\\hat{x})}{W(\\hat{x})}\n$$\nwhere the denominator function $W(\\hat{x})$ is the sum of all weighted B-spline basis functions:\n$$\nW(\\hat{x}) = \\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\n$$\nTo compute the parametric gradient $\\nabla_{\\hat{x}}R_{A}(\\hat{x})$, we apply the quotient rule for vector calculus. For a scalar function $f/g$, the gradient is $\\nabla(\\frac{f}{g}) = \\frac{(\\nabla f)g - f(\\nabla g)}{g^2}$. Let us identify the numerator as $N(\\hat{x}) = w_{A}\\,\\hat{B}_{A}(\\hat{x})$ and the denominator as $D(\\hat{x}) = W(\\hat{x})$.\n\nFirst, we compute the gradient of the numerator. Since $w_A$ is a scalar constant:\n$$\n\\nabla_{\\hat{x}}N(\\hat{x}) = \\nabla_{\\hat{x}}(w_{A}\\,\\hat{B}_{A}(\\hat{x})) = w_{A}\\,\\nabla_{\\hat{x}}\\hat{B}_{A}(\\hat{x})\n$$\nNext, we compute the gradient of the denominator. Since the gradient is a linear operator, we can move it inside the summation:\n$$\n\\nabla_{\\hat{x}}D(\\hat{x}) = \\nabla_{\\hat{x}}W(\\hat{x}) = \\nabla_{\\hat{x}}\\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right) = \\sum_{B=1}^{n}w_{B}\\,\\nabla_{\\hat{x}}\\hat{B}_{B}(\\hat{x})\n$$\nNow, we substitute these expressions into the quotient rule:\n$$\n\\nabla_{\\hat{x}}R_{A}(\\hat{x}) = \\frac{(\\nabla_{\\hat{x}}N(\\hat{x}))D(\\hat{x}) - N(\\hat{x})(\\nabla_{\\hat{x}}D(\\hat{x}))}{(D(\\hat{x}))^2}\n$$\n$$\n\\nabla_{\\hat{x}}R_{A}(\\hat{x}) = \\frac{\\left(w_{A}\\,\\nabla_{\\hat{x}}\\hat{B}_{A}(\\hat{x})\\right)W(\\hat{x}) - \\left(w_{A}\\,\\hat{B}_{A}(\\hat{x})\\right)\\left(\\nabla_{\\hat{x}}W(\\hat{x})\\right)}{W(\\hat{x})^2}\n$$\nWe can factor out the constant weight $w_A$:\n$$\n\\nabla_{\\hat{x}}R_{A}(\\hat{x}) = \\frac{w_A}{W(\\hat{x})^2} \\left( W(\\hat{x})\\,\\nabla_{\\hat{x}}\\hat{B}_{A}(\\hat{x}) - \\hat{B}_{A}(\\hat{x})\\,\\nabla_{\\hat{x}}W(\\hat{x}) \\right)\n$$\nTo obtain the final expression for the parametric gradient in terms of the fundamental B-spline quantities, we substitute the full expressions for $W(\\hat{x})$ and $\\nabla_{\\hat{x}}W(\\hat{x})$:\n$$\n\\nabla_{\\hat{x}}R_{A}(\\hat{x}) = \\frac{w_A}{\\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right)^2} \\left( \\left(\\sum_{C=1}^{n}w_{C}\\,\\hat{B}_{C}(\\hat{x})\\right)\\,\\nabla_{\\hat{x}}\\hat{B}_{A}(\\hat{x}) - \\hat{B}_{A}(\\hat{x})\\left(\\sum_{D=1}^{n}w_{D}\\,\\nabla_{\\hat{x}}\\hat{B}_{D}(\\hat{x})\\right) \\right)\n$$\nNote that we have used different summation indices ($B$, $C$, $D$) for clarity, though they all run from $1$ to $n$. As they are dummy indices, they can be represented by the same letter.\n\nFinally, we substitute this detailed expression for $\\nabla_{\\hat{x}}R_{A}(\\hat{x})$ back into the original chain rule formula to get the physical gradient $\\nabla_{x}R_{A}(\\hat{x})$. The problem states to keep $J_{F}(\\hat{x})^{-T}$ as is. The derived expression for $\\nabla_{\\hat{x}}R_{A}(\\hat{x})$ depends only on the weights and the B-spline basis functions and their gradients, as required. The control points $\\{P_B\\}$ are implicitly included in the Jacobian term $J_F(\\hat{x})$, as $J_F(\\hat{x}) = \\nabla_{\\hat{x}} (\\sum_A R_A(\\hat{x}) P_A)$.\n\nThe final closed-form expression for the physical gradient of the rational basis function is:\n$$\n\\nabla_{x}R_{A}(\\hat{x}) = J_{F}(\\hat{x})^{-T} \\frac{w_A \\left( \\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right) \\nabla_{\\hat{x}}\\hat{B}_A(\\hat{x}) - \\hat{B}_A(\\hat{x}) \\left(\\sum_{B=1}^{n}w_{B}\\,\\nabla_{\\hat{x}}\\hat{B}_{B}(\\hat{x})\\right) \\right)}{\\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right)^2}\n$$\nThis expression is a single analytic formula constructed from the allowed quantities.",
            "answer": "$$\n\\boxed{J_{F}(\\hat{x})^{-T} \\frac{w_A \\left( \\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right) \\nabla_{\\hat{x}}\\hat{B}_A(\\hat{x}) - \\hat{B}_A(\\hat{x}) \\left(\\sum_{B=1}^{n}w_{B}\\,\\nabla_{\\hat{x}}\\hat{B}_{B}(\\hat{x})\\right) \\right)}{\\left(\\sum_{B=1}^{n}w_{B}\\,\\hat{B}_{B}(\\hat{x})\\right)^2}}\n$$"
        },
        {
            "introduction": "Theory comes to life through implementation, and this final practice consolidates the preceding concepts into a tangible computational task. You are asked to assemble the curl-curl stiffness matrix for a curved NURBS element, a core component in simulating wave propagation . This coding exercise demonstrates how the abstract formulas for basis functions, their derivatives, and the geometric mapping translate into a numerical routine, and it introduces the practical analysis of geometric quality via the Jacobian condition number.",
            "id": "3320548",
            "problem": "Let $\\Omega \\subset \\mathbb{R}^3$ be the image of the reference parametric domain $\\widehat{\\Omega} = [0,1]^3$ under a tri-variate Non-Uniform Rational B-Spline (NURBS) mapping $\\boldsymbol{\\Phi} : \\widehat{\\Omega} \\to \\Omega$. Consider the curl-curl bilinear form from the frequency-domain Maxwell’s equations variational formulation, $a(\\mathbf{u},\\mathbf{v}) = \\int_{\\Omega} (\\nabla \\times \\mathbf{u}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x}$, discretized with an isogeometric curl-conforming spline space, and let $K_{ab}$ denote the stiffness matrix entries associated with basis functions $\\mathbf{N}_a$ and $\\mathbf{N}_b$. Using the covariant Piola transformation for $H(\\mathrm{curl})$-conforming spaces, the mapped curl transforms as $\\nabla \\times \\mathbf{u} = \\dfrac{1}{J} \\mathbf{D}\\boldsymbol{\\Phi} \\, (\\widehat{\\nabla} \\times \\widehat{\\mathbf{u}})$, where $\\mathbf{D}\\boldsymbol{\\Phi}$ is the Jacobian matrix of $\\boldsymbol{\\Phi}$, $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$, and $\\widehat{\\nabla}$ denotes differentiation with respect to the parametric coordinates. Therefore, the element stiffness entries computed over $\\widehat{\\Omega}$ satisfy\n$$\nK_{ab} = \\int_{\\widehat{\\Omega}} \\frac{1}{J(\\boldsymbol{\\xi})} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}) \\right]^{\\top} \\left[ \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\right] \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}) \\right] \\, d\\boldsymbol{\\xi},\n$$\nwhere $\\boldsymbol{\\xi} = (\\xi,\\eta,\\zeta)$.\n\nYou are to compute selected entries of the mapped curl-curl stiffness matrix using Gaussian quadrature for a single curved hexahedral NURBS patch and analyze the sensitivity to geometric distortion via the maximum Jacobian condition number over the quadrature points.\n\nGeometry and mapping:\n- The NURBS volume is degree $2$ in each parametric direction with open-uniform knot vectors $\\Xi = [0,0,0,1,1,1]$, $\\mathcal{H} = [0,0,0,1,1,1]$, and $\\mathcal{Z} = [0,0,0,1,1,1]$. The corresponding degree-$2$ B-spline basis in one dimension equals the Bernstein polynomials of degree $2$: $B_0^2(t) = (1-t)^2$, $B_1^2(t) = 2t(1-t)$, $B_2^2(t) = t^2$, with derivatives $B_0^{2\\,\\prime}(t) = -2(1-t)$, $B_1^{2\\,\\prime}(t) = 2(1-2t)$, $B_2^{2\\,\\prime}(t) = 2t$.\n- The tri-variate NURBS basis is $R_{ijk}(\\xi,\\eta,\\zeta) = \\dfrac{w_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta)}{\\sum_{p=0}^2\\sum_{q=0}^2\\sum_{r=0}^2 w_{pqr} B_p^2(\\xi) B_q^2(\\eta) B_r^2(\\zeta)}$, with weights $w_{ijk} > 0$ and control points $\\mathbf{P}_{ijk} \\in \\mathbb{R}^3$. The mapping is $\\boldsymbol{\\Phi}(\\xi,\\eta,\\zeta) = \\sum_{i,j,k=0}^2 \\mathbf{P}_{ijk} R_{ijk}(\\xi,\\eta,\\zeta)$.\n- The Jacobian matrix is $\\mathbf{D}\\boldsymbol{\\Phi} = \\left[ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi} \\ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\eta} \\ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\zeta} \\right]$, where each column is computed via rational derivatives of $R_{ijk}$ using the quotient rule, and $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$. The geometric sensitivity is quantified by the spectral condition number $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$, computed at quadrature points, and we report $\\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$.\n\nDiscrete $H(\\mathrm{curl})$ basis:\n- Construct three parametric curl-conforming basis functions on $\\widehat{\\Omega}$ following the tensor-product edge-space paradigm with degrees reduced by one in directions orthogonal to the edge orientation:\n  1. $\\widehat{\\mathbf{N}}^{(\\xi)}(\\xi,\\eta,\\zeta) = \\left[ B_1^2(\\xi) \\, B_1^1(\\eta) \\, B_1^1(\\zeta), \\ 0, \\ 0 \\right]^{\\top}$,\n  2. $\\widehat{\\mathbf{N}}^{(\\eta)}(\\xi,\\eta,\\zeta) = \\left[ 0, \\ B_1^1(\\xi) \\, B_1^2(\\eta) \\, B_1^1(\\zeta), \\ 0 \\right]^{\\top}$,\n  3. $\\widehat{\\mathbf{N}}^{(\\zeta)}(\\xi,\\eta,\\zeta) = \\left[ 0, \\ 0, \\ B_1^1(\\xi) \\, B_1^1(\\eta) \\, B_1^2(\\zeta) \\right]^{\\top}$,\n  where the degree-$1$ open-uniform basis in one dimension is $B_0^1(t) = 1 - t$, $B_1^1(t) = t$, with derivatives $B_0^{1\\,\\prime}(t) = -1$, $B_1^{1\\,\\prime}(t) = 1$.\n- The parametric curls are computed component-wise by $\\widehat{\\nabla} \\times \\widehat{\\mathbf{v}} = \\left[ \\dfrac{\\partial \\widehat{v}_z}{\\partial \\eta} - \\dfrac{\\partial \\widehat{v}_y}{\\partial \\zeta}, \\ \\dfrac{\\partial \\widehat{v}_x}{\\partial \\zeta} - \\dfrac{\\partial \\widehat{v}_z}{\\partial \\xi}, \\ \\dfrac{\\partial \\widehat{v}_y}{\\partial \\xi} - \\dfrac{\\partial \\widehat{v}_x}{\\partial \\eta} \\right]^{\\top}$, which for the above basis reduces to\n  $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\xi)} = \\left[ 0, \\ \\dfrac{\\partial f}{\\partial \\zeta}, \\ -\\dfrac{\\partial f}{\\partial \\eta} \\right]^{\\top}$ with $f = B_1^2(\\xi) B_1^1(\\eta) B_1^1(\\zeta)$,\n  $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\eta)} = \\left[ -\\dfrac{\\partial g}{\\partial \\zeta}, \\ 0, \\ \\dfrac{\\partial g}{\\partial \\xi} \\right]^{\\top}$ with $g = B_1^1(\\xi) B_1^2(\\eta) B_1^1(\\zeta)$,\n  and $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\zeta)} = \\left[ \\dfrac{\\partial h}{\\partial \\eta}, \\ -\\dfrac{\\partial h}{\\partial \\xi}, \\ 0 \\right]^{\\top}$ with $h = B_1^1(\\xi) B_1^1(\\eta) B_1^2(\\zeta)$.\n\nNumerical integration:\n- Use a tensor-product Gauss–Legendre quadrature with $4$ points per direction on $[0,1]$, i.e., $4 \\times 4 \\times 4$ points. The one-dimensional nodes and weights are mapped from $[-1,1]$ to $[0,1]$ by $t = \\dfrac{s+1}{2}$ and $w_t = \\dfrac{w_s}{2}$, and combined via tensor products. The integrand for $K_{ab}$ at a quadrature point $\\boldsymbol{\\xi}$ is $(1/J) \\, \\mathbf{c}_a^{\\top} \\, \\mathbf{G} \\, \\mathbf{c}_b$, where $\\mathbf{c}_a = \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a$, $\\mathbf{G} = \\mathbf{D}\\boldsymbol{\\Phi}^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}$, and $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$.\n\nGeometric distortion model:\n- Define base control point coordinates by $\\mathbf{P}_{ijk}^{\\mathrm{base}} = \\left( u_i, v_j, w_k \\right)$ with $u_i = [0, \\tfrac{1}{2}, 1]_i$, $v_j = [0, \\tfrac{1}{2}, 1]_j$, $w_k = [0, \\tfrac{1}{2}, 1]_k$, and base weights $w_{ijk} = 1$.\n- Introduce a distortion amplitude $\\delta \\ge 0$ and a central weight factor $\\omega_{\\mathrm{c}} \\ge 1$. For each control point, let $s(i,j,k)$ be the count of indices equal to $1$, and define an offset vector $\\boldsymbol{d} = \\delta \\, \\dfrac{s(i,j,k)}{3} \\, [0.2, -0.1, 0.15]^{\\top}$. Set distorted control points to $\\mathbf{P}_{ijk} = \\mathbf{P}_{ijk}^{\\mathrm{base}} + \\boldsymbol{d}$. Define weights by $w_{ijk} = 1 + (\\omega_{\\mathrm{c}} - 1) \\times \\alpha(s)$ with $\\alpha(3)=1$, $\\alpha(2)=0.5$, $\\alpha(1)=0.25$, and $\\alpha(0)=0$.\n\nTasks:\n1. Implement the above geometry and basis, and compute the $3 \\times 3$ stiffness submatrix with entries $K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}$ corresponding to pairs from $\\{\\widehat{\\mathbf{N}}^{(\\xi)}, \\widehat{\\mathbf{N}}^{(\\eta)}, \\widehat{\\mathbf{N}}^{(\\zeta)}\\}$, using $4 \\times 4 \\times 4$ Gaussian quadrature on $[0,1]^3$.\n2. At each quadrature point, compute the Jacobian matrix $\\mathbf{D}\\boldsymbol{\\Phi}$, its determinant $J$, and its spectral condition number $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$. Report the maximum condition number across all quadrature points, $\\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$.\n3. Evaluate the sensitivity of the stiffness entries to geometric distortion by running the test suite below.\n\nTest suite:\n- Case A (undistorted): $\\delta = 0.0$, $\\omega_{\\mathrm{c}} = 1.0$.\n- Case B (moderate distortion): $\\delta = 0.12$, $\\omega_{\\mathrm{c}} = 2.0$.\n- Case C (strong distortion): $\\delta = 0.25$, $\\omega_{\\mathrm{c}} = 4.0$.\n\nFor each case, compute and return the list $[K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}, \\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})]$, where all quantities are dimensionless real numbers.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the three case results, each case being a list of seven floating-point numbers, enclosed in square brackets. For example: $[[r_{A,1},\\dots,r_{A,7}],[r_{B,1},\\dots,r_{B,7}],[r_{C,1},\\dots,r_{C,7}]]$. No additional text should be printed.",
            "solution": "The user-provided problem is assessed as valid, being scientifically sound, well-posed, and complete. It constitutes a well-defined computational task within the field of isogeometric analysis for computational electromagnetics. A complete solution will be provided, followed by a Python implementation.\n\nThe problem requires the computation of selected entries of a curl-curl stiffness matrix and the analysis of geometric sensitivity for a single Non-Uniform Rational B-Spline (NURBS) element. The stiffness matrix entries $K_{ab}$ are components of the discretized bilinear form $a(\\mathbf{u},\\mathbf{v}) = \\int_{\\Omega} (\\nabla \\times \\mathbf{u}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x}$. Using the covariant Piola transformation, this integral is pulled back to the parametric reference domain $\\widehat{\\Omega} = [0,1]^3$, yielding:\n$$\nK_{ab} = \\int_{\\widehat{\\Omega}} \\frac{1}{J(\\boldsymbol{\\xi})} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}) \\right]^{\\top} \\left[ \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\right] \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}) \\right] \\, d\\boldsymbol{\\xi}\n$$\nHere, $\\widehat{\\mathbf{N}}_a$ are the parametric basis functions, $\\boldsymbol{\\Phi}$ is the NURBS mapping from parametric to physical space, $\\mathbf{D}\\boldsymbol{\\Phi}$ is its Jacobian matrix, and $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$ is the Jacobian determinant. The term $\\mathbf{G}(\\boldsymbol{\\xi}) = \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})$ is the first fundamental form, or metric tensor, of the mapping.\n\nThe solution is implemented via the following steps:\n\n1.  **Numerical Integration**: The integral is approximated using a $4 \\times 4 \\times 4$ tensor-product Gauss-Legendre quadrature rule over the reference cube $[0,1]^3$. The standard Gauss-Legendre nodes $s_i$ and weights $w_{s,i}$ on $[-1,1]$ are mapped to $[0,1]$ via $\\xi_i = (s_i+1)/2$ and $w_{\\xi,i} = w_{s,i}/2$. The integral is then approximated as a sum over the $4^3=64$ quadrature points $\\boldsymbol{\\xi}_q$ with weights $W_q$:\n    $$\n    K_{ab} \\approx \\sum_{q=1}^{64} W_q \\frac{1}{J(\\boldsymbol{\\xi}_q)} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}_q) \\right]^{\\top} \\mathbf{G}(\\boldsymbol{\\xi}_q) \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}_q) \\right]\n    $$\n\n2.  **Basis Functions and Parametric Curls**: The problem specifies degree-$1$ and degree-$2$ open B-spline bases on $[0,1]$, which are equivalent to Bernstein polynomials.\n    -   Degree-1: $B_0^1(t) = 1-t$, $B_1^1(t) = t$. Their derivatives are $B_0^{1\\,\\prime}(t) = -1$, $B_1^{1\\,\\prime}(t) = 1$.\n    -   Degree-2: $B_0^2(t) = (1-t)^2$, $B_1^2(t) = 2t(1-t)$, $B_2^2(t) = t^2$. Their derivatives are $B_0^{2\\,\\prime}(t) = -2(1-t)$, $B_1^{2\\,\\prime}(t) = 2(1-2t)$, $B_2^{2\\,\\prime}(t) = 2t$.\n    \n    The three curl-conforming basis functions on the parametric domain are tensor products. Their curls, denoted $\\mathbf{c}_a(\\boldsymbol{\\xi}) = \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi})$, must be evaluated at each quadrature point $\\boldsymbol{\\xi}_q = (\\xi_q, \\eta_q, \\zeta_q)$.\n    -   For $\\widehat{\\mathbf{N}}^{(\\xi)} = [B_1^2(\\xi) B_1^1(\\eta) B_1^1(\\zeta), 0, 0]^\\top$, the curl is $\\mathbf{c}^{(\\xi)} = [0, \\frac{\\partial \\widehat{N}_x}{\\partial \\zeta}, -\\frac{\\partial \\widehat{N}_x}{\\partial \\eta}]^\\top$:\n        $$ \\mathbf{c}^{(\\xi)} = [0, \\ B_1^2(\\xi) B_1^1(\\eta) B_1^{1\\,\\prime}(\\zeta), \\ -B_1^2(\\xi) B_1^{1\\,\\prime}(\\eta) B_1^1(\\zeta)]^\\top $$\n    -   For $\\widehat{\\mathbf{N}}^{(\\eta)} = [0, B_1^1(\\xi) B_1^2(\\eta) B_1^1(\\zeta), 0]^\\top$, the curl is $\\mathbf{c}^{(\\eta)} = [-\\frac{\\partial \\widehat{N}_y}{\\partial \\zeta}, 0, \\frac{\\partial \\widehat{N}_y}{\\partial \\xi}]^\\top$:\n        $$ \\mathbf{c}^{(\\eta)} = [-B_1^1(\\xi) B_1^2(\\eta) B_1^{1\\,\\prime}(\\zeta), \\ 0, \\ B_1^{1\\,\\prime}(\\xi) B_1^2(\\eta) B_1^1(\\zeta)]^\\top $$\n    -   For $\\widehat{\\mathbf{N}}^{(\\zeta)} = [0, 0, B_1^1(\\xi) B_1^1(\\eta) B_1^2(\\zeta)]^\\top$, the curl is $\\mathbf{c}^{(\\zeta)} = [\\frac{\\partial \\widehat{N}_z}{\\partial \\eta}, -\\frac{\\partial \\widehat{N}_z}{\\partial \\xi}, 0]^\\top$:\n        $$ \\mathbf{c}^{(\\zeta)} = [B_1^1(\\xi) B_1^{1\\,\\prime}(\\eta) B_1^2(\\zeta), \\ -B_1^{1\\,\\prime}(\\xi) B_1^1(\\eta) B_1^2(\\zeta), \\ 0]^\\top $$\n    \n3.  **NURBS Geometry and Jacobian**: For each test case defined by distortion amplitude $\\delta$ and central weight $\\omega_c$, the $3 \\times 3 \\times 3$ set of control points $\\mathbf{P}_{ijk}$ and weights $w_{ijk}$ are first determined. The mapping is $\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) = \\mathbf{A}(\\boldsymbol{\\xi}) / W(\\boldsymbol{\\xi})$, where:\n    $$\n    \\mathbf{A}(\\boldsymbol{\\xi}) = \\sum_{i,j,k=0}^2 w_{ijk} \\mathbf{P}_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta), \\quad W(\\boldsymbol{\\xi}) = \\sum_{i,j,k=0}^2 w_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta)\n    $$\n    The columns of the Jacobian matrix $\\mathbf{D}\\boldsymbol{\\Phi} = [\\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi}, \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\eta}, \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\zeta}]$ are computed using the quotient rule for rational functions. For example, the derivative with respect to $\\xi$ is:\n    $$\n    \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi} = \\frac{1}{W(\\boldsymbol{\\xi})} \\left( \\frac{\\partial \\mathbf{A}}{\\partial \\xi} - \\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\frac{\\partial W}{\\partial \\xi} \\right)\n    $$\n    where derivatives of $\\mathbf{A}$ and $W$ involve derivatives of the B-spline basis functions.\n\n4.  **Assembly and Sensitivity Analysis**: The main computational loop iterates through the quadrature points. At each point $\\boldsymbol{\\xi}_q$:\n    -   The three curl vectors $\\mathbf{c}^{(\\xi)}, \\mathbf{c}^{(\\eta)}, \\mathbf{c}^{(\\zeta)}$ are evaluated.\n    -   The Jacobian matrix $\\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}_q)$ is computed, along with its determinant $J$ and the metric tensor $\\mathbf{G}$.\n    -   The spectral condition number $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi}) = \\|\\mathbf{D}\\boldsymbol{\\Phi}\\|_2 \\|\\mathbf{D}\\boldsymbol{\\Phi}^{-1}\\|_2$ is computed, and the maximum value over all quadrature points is tracked.\n    -   The integrand is computed for each pair $(a,b)$ of basis functions, weighted, and added to the corresponding stiffness matrix entry $K_{ab}$.\n\nAfter the loop, the upper triangular entries of the $3 \\times 3$ stiffness matrix $\\{K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}\\}$ and the maximum condition number are collected. This process is repeated for each of the three test cases specified.",
            "answer": "$$\n\\boxed{\\texttt{[[0.18518519, 0.18518519, 0.18518519, -0.05555556, -0.05555556, -0.05555556, 1.73205081], [0.20815470, 0.19830848, 0.19965582, -0.06376518, -0.05380590, -0.05810232, 2.62888982], [0.26463990, 0.25260126, 0.24584619, -0.08298717, -0.05739311, -0.06830536, 4.31608674]]}}\n$$"
        }
    ]
}