{
    "hands_on_practices": [
        {
            "introduction": "在并行化快速多极子算法时，一个最基本且核心的挑战是如何将计算任务均匀地分配给各个处理器。这种分配远不止是简单地划分空间域或粒子数量，而必须平衡实际的计算成本，这通常包括近场和远场两部分的贡献。本练习  将通过一个简化的、但能够反映核心思想的成本模型，引导您实践如何通过区域分解来实现负载均衡，这是掌握并行FMM的关键一步。",
            "id": "3337279",
            "problem": "您正在为计算电磁学中的快速多极子方法 (FMM) 设计一种并行域分解方法，通过沿一维坐标 $x$ 的递归几何二分，将工作负载分配到两个处理器上。每个几何子域内的近场功主要由局部的粒子邻域相互作用决定，而远场功则主要由多极子和局部展开操作决定。考虑一个沿 $x$ 轴的合成双峰源分布，它由两个均匀簇组成：\n- 簇 $\\mathcal{A}$ 占据 $x \\in [-7,-3]$，包含 $N_{\\mathcal{A}} = 80$ 个源。\n- 簇 $\\mathcal{B}$ 占据 $x \\in [2,10]$，包含 $N_{\\mathcal{B}} = 160$ 个源。\n\n假设两个簇都具有均匀的线密度，因此每个占据区间内的密度等于源的数量除以区间长度。用 $n$ 表示给定子域中的源数量。对每个子域使用以下代价模型，该模型受到快速多极子方法 (FMM) 中主要操作的标度律的启发：\n- 远场代价与源数量成线性关系：$\\mu \\, n$，其中 $\\mu > 0$。\n- 在一个由不相交的连续簇片段 $\\{F_{j}\\}$ 构成的子域内，近场代价的标度关系为 $\\lambda \\sum_{j} n(F_{j})^{2}$，其中 $n(F_{j})$ 是片段 $F_{j}$ 中的源数量，且 $\\lambda > 0$。\n\n取 $\\lambda = 1$ 和 $\\mu = 160$。假设 $\\mathcal{A}$ 和 $\\mathcal{B}$ 之间的间隔足够大，可以忽略任何切割产生的跨子域近场相互作用。递归几何二分按以下步骤进行：\n1. 首先用平面 $x = x_{1}$ 将整个域分割成左右两个子域，使得在上述模型下，它们的代价（近场加远场）相等。\n2. 然后，在这两个子域中的每一个内部，再次用平面 $x = x_{2,\\mathrm{left}}$ 和 $x = x_{2,\\mathrm{right}}$ 进行分割，以便在每个子域中，产生的两个子子域在相同模型下具有相等的代价。\n\n通过从给定的模型和源分布推导等代价条件来构建此递归二分。计算沿 $x$ 轴的三个分割平面 $(x_{1}, x_{2,\\mathrm{left}}, x_{2,\\mathrm{right}})$ 的精确值。将您的最终答案表示为无单位的精确实数，按顺序 $\\big(x_{1}, x_{2,\\mathrm{left}}, x_{2,\\mathrm{right}}\\big)$ 排列在单行矩阵中。不要四舍五入；在适用时给出最简分数形式的精确值。",
            "solution": "问题要求确定三个空间坐标 $x_1$、$x_{2,\\mathrm{left}}$ 和 $x_{2,\\mathrm{right}}$，它们定义了一个针对一维源分布的两级递归几何二分。选择这些二分是为了在每一级平衡给定的计算代价模型。\n\n首先，我们描述源分布的特征。源排列在两个均匀的簇中。\n簇 $\\mathcal{A}$ 位于区间 $x \\in [-7, -3]$，包含 $N_{\\mathcal{A}} = 80$ 个源。该区间的长度为 $L_{\\mathcal{A}} = -3 - (-7) = 4$。线性源密度为 $\\rho_{\\mathcal{A}} = \\frac{N_{\\mathcal{A}}}{L_{\\mathcal{A}}} = \\frac{80}{4} = 20$ 个源/单位长度。\n簇 $\\mathcal{B}$ 位于 $x \\in [2, 10]$，包含 $N_{\\mathcal{B}} = 160$ 个源。该区间的长度为 $L_{\\mathcal{B}} = 10 - 2 = 8$。线性源密度为 $\\rho_{\\mathcal{B}} = \\frac{N_{\\mathcal{B}}}{L_{\\mathcal{B}}} = \\frac{160}{8} = 20$ 个源/单位长度。\n由于 $\\rho_{\\mathcal{A}} = \\rho_{\\mathcal{B}}$，我们将簇内的均匀密度记为 $\\rho = 20$。簇内任何长度为 $\\Delta x$ 的区间中的源数量为 $n = \\rho \\Delta x = 20 \\Delta x$。\n\n一个子域的总计算代价 $C$ 是近场代价 $C_{\\text{near}}$ 和远场代价 $C_{\\text{far}}$ 之和。代价模型由下式给出：\n$C = C_{\\text{near}} + C_{\\text{far}} = \\lambda \\sum_{j} n(F_{j})^{2} + \\mu \\, n$\n其中 $n$ 是子域中的总源数，$\\{F_j\\}$ 是其内部不相交的连续簇片段，而 $n(F_j)$ 是片段 $F_j$ 中的源数。给定的参数为 $\\lambda = 1$ 和 $\\mu = 160$。\n因此，代价函数为 $C = \\sum_{j} n(F_{j})^{2} + 160 n$。\n\n第一步是找到分割平面 $x = x_1$，它将整个域划分为左子域 $D_L = \\{x | x \\le x_1\\}$ 和右子域 $D_R = \\{x | x > x_1\\}$，使得它们的代价相等，即 $C(D_L) = C(D_R)$。分割点 $x_1$ 可能位于三个区域之一：簇 $\\mathcal{A}$ 内部 ($[-7, -3]$)、簇之间 ($(-3, 2)$) 或簇 $\\mathcal{B}$ 内部 ($[2, 10]$)。\n\n考虑在 $x_1 \\in (-3, 2)$ 处进行分割。左子域 $D_L$ 只包含簇 $\\mathcal{A}$，它是一个单独的片段。\n$n_L = N_{\\mathcal{A}} = 80$。\n$C(D_L) = 80^2 + 160 \\times 80 = 6400 + 12800 = 19200$。\n右子域 $D_R$ 只包含簇 $\\mathcal{B}$，它也是一个单独的片段。\n$n_R = N_{\\mathcal{B}} = 160$。\n$C(D_R) = 160^2 + 160 \\times 160 = 25600 + 25600 = 51200$。\n由于 $C(D_L)  C(D_R)$，分割点必须向右移动以增加左子域的代价并减少右子域的代价。这意味着 $x_1$ 必须位于簇 $\\mathcal{B}$ 内部，即 $x_1 \\in [2, 10]$。\n\n对于在 $x_1 \\in [2, 10]$ 处的分割：\n左子域 $D_L$ 包含两个片段：整个簇 $\\mathcal{A}$ 和位于 $[2, x_1]$ 上的簇 $\\mathcal{B}$ 的一部分。\n$\\mathcal{A}$ 中的源数量：$n_{\\mathcal{A},L} = 80$。\n$\\mathcal{B}$ 片段中的源数量：$n_{\\mathcal{B},L} = \\rho(x_1 - 2) = 20(x_1 - 2)$。\n$D_L$ 中的总源数：$n_L = 80 + 20(x_1 - 2) = 40 + 20x_1$。\n代价 $C(D_L) = n_{\\mathcal{A},L}^2 + n_{\\mathcal{B},L}^2 + 160 n_L = 80^2 + (20(x_1-2))^2 + 160(40 + 20x_1)$。\n$C(D_L) = 6400 + 400(x_1-2)^2 + 6400 + 3200x_1 = 12800 + 400(x_1^2 - 4x_1 + 4) + 3200x_1 = 400x_1^2 + 1600x_1 + 14400$。\n\n右子域 $D_R$ 包含一个片段：位于 $(x_1, 10]$ 上的簇 $\\mathcal{B}$ 的剩余部分。\n源数量：$n_R = \\rho(10 - x_1) = 20(10 - x_1) = 200 - 20x_1$。\n代价 $C(D_R) = n_R^2 + 160 n_R = (20(10-x_1))^2 + 160(20(10-x_1))$。\n$C(D_R) = 400(10-x_1)^2 + 3200(10-x_1) = 400(100 - 20x_1 + x_1^2) + 32000 - 3200x_1 = 400x_1^2 - 11200x_1 + 72000$。\n\n令代价相等，$C(D_L) = C(D_R)$：\n$400x_1^2 + 1600x_1 + 14400 = 400x_1^2 - 11200x_1 + 72000$\n$1600x_1 + 14400 = -11200x_1 + 72000$\n$12800x_1 = 57600$\n$x_1 = \\frac{57600}{12800} = \\frac{576}{128} = \\frac{9}{2} = 4.5$。\n该值在区间 $[2, 10]$ 内，因此是正确的分割坐标：$x_1 = 4.5$。\n\n接下来，我们进行第二级二分。首先，对于左子域 $D_L$，它跨越 $x \\in [-7, 4.5]$ 并包含 $[-7, -3]$ 上的源（簇 $\\mathcal{A}$，80个源）和 $[2, 4.5]$ 上的源（簇 $\\mathcal{B}$ 的一部分， $20(4.5-2) = 50$ 个源）。我们寻找一个分割点 $x_{2,\\mathrm{left}}$ 来平衡代价。\n在 $x_2 \\in (-3, 2)$ 处的分割将产生一个包含80个源的左部分和一个包含50个源的右部分。各自的代价为 $C_{LL} = 80^2 + 160(80) = 19200$ 和 $C_{LR} = 50^2 + 160(50) = 10500$。由于 $C_{LL} > C_{LR}$，分割点必须向左移动到簇 $\\mathcal{A}$ 内部，即 $x_{2,\\mathrm{left}} \\in [-7, -3]$。\n\n对于在 $x_2 = x_{2,\\mathrm{left}} \\in [-7, -3]$ 处的分割：\n新的左-左子域 $D_{LL}$ 包含一个位于 $[-7, x_2]$ 上的单独片段。\n源数量：$n_{LL} = \\rho(x_2 - (-7)) = 20(x_2+7)$。\n代价 $C(D_{LL}) = (20(x_2+7))^2 + 160(20(x_2+7)) = 400(x_2+7)^2 + 3200(x_2+7)$。\n$C(D_{LL}) = 400(x_2^2 + 14x_2 + 49) + 3200x_2 + 22400 = 400x_2^2 + 8800x_2 + 42000$。\n\n新的左-右子域 $D_{LR}$ 包含两个片段：一个位于 $(x_2, -3]$，另一个位于 $[2, 4.5]$。\n第一个片段的源数：$n_{\\mathcal{A},R} = \\rho(-3 - x_2) = 20(-3-x_2)$。\n第二个片段的源数：$n_{\\mathcal{B},R} = 50$。\n总源数：$n_{LR} = 20(-3-x_2) + 50 = -10 - 20x_2$。\n代价 $C(D_{LR}) = n_{\\mathcal{A},R}^2 + n_{\\mathcal{B},R}^2 + 160 n_{LR} = (20(-3-x_2))^2 + 50^2 + 160(-10-20x_2)$。\n$C(D_{LR}) = 400(x_2+3)^2 + 2500 - 1600 - 3200x_2 = 400(x_2^2+6x_2+9) + 900 - 3200x_2 = 400x_2^2 - 800x_2 + 4500$。\n\n令代价相等，$C(D_{LL}) = C(D_{LR})$：\n$400x_2^2 + 8800x_2 + 42000 = 400x_2^2 - 800x_2 + 4500$\n$9600x_2 = -37500$\n$x_2 = x_{2,\\mathrm{left}} = -\\frac{37500}{9600} = -\\frac{375}{96} = -\\frac{125}{32}$。\n该值在 $[-7, -3]$ 内，所以是正确的分割坐标。$x_{2,\\mathrm{left}} = -125/32$。\n\n最后，我们对右子域 $D_R$ 进行二分，该子域跨越 $x \\in (4.5, 10]$ 并包含簇 $\\mathcal{B}$ 的一个单一连续片段。总源数为 $n_R = 20(10-4.5) = 110$。我们在 $(4.5, 10]$ 内寻找一个分割点 $x_{2,\\mathrm{right}}$。\n设在 $x_2 = x_{2,\\mathrm{right}}$ 处的分割将此域划分为 $D_{RL}$ 和 $D_{RR}$。\n$D_{RL}$ ($x \\in (4.5, x_2]$) 中的源数量：$n_{RL} = 20(x_2 - 4.5)$。\n$D_{RR}$ ($x \\in (x_2, 10]$) 中的源数量：$n_{RR} = 20(10 - x_2)$。\n对于一个包含 $n_s$ 个源的单一片段的子域，其代价为 $C_s = n_s^2 + 160n_s$。\n等代价条件是 $n_{RL}^2 + 160n_{RL} = n_{RR}^2 + 160n_{RR}$。\n$n_{RL}^2 - n_{RR}^2 + 160(n_{RL} - n_{RR}) = 0$\n$(n_{RL} - n_{RR})(n_{RL} + n_{RR} + 160) = 0$。\n总源数为 $n_{RL} + n_{RR} = 110$，这是一个正数。因此，$n_{RL} + n_{RR} + 160 \\neq 0$。\n这意味着 $n_{RL} - n_{RR} = 0$，所以 $n_{RL} = n_{RR}$。分割必须平分源的数量。\n$20(x_2 - 4.5) = 20(10 - x_2)$\n$x_2 - 4.5 = 10 - x_2$\n$2x_2 = 14.5$\n$x_2 = x_{2,\\mathrm{right}} = 7.25 = \\frac{29}{4}$。\n此坐标位于 $(4.5, 10]$ 内，是正确的分割点。\n\n三个分割平面是 $x_1 = 9/2$，$x_{2,\\mathrm{left}} = -125/32$ 和 $x_{2,\\mathrm{right}} = 29/4$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{9}{2}  -\\frac{125}{32}  \\frac{29}{4}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在平衡了工作负载之后，优化的下一步是有效管理执行这些工作所需的计算资源，尤其是内存和通信带宽。在FMM中，多极展开所使用的数学基函数的选择，直接影响了算法的内存占用和并行通信开销。本练习  通过比较笛卡尔和球谐两种常用基函数，量化地揭示了这一权衡，帮助您建立以数据为中心的优化直觉。",
            "id": "3337269",
            "problem": "在三维频域计算电磁学中，考虑一个使用均匀八叉树进行叶节点层级区域分解的计算域，该计算域被分配给不同进程以执行快速多极子方法（FMM）计算。每个进程拥有一个由 $b \\times b \\times b$ 个叶节点方盒组成的连续立方体块（其中 $b \\in \\mathbb{N}$），并通过在每次FMM扫描中于叶节点层级交换一层方盒厚度的晕轮数据，与其六个面相邻的进程进行通信。假设每个复数值系数的大小为 $\\sigma$ 字节。每个叶节点方盒存储一个出射多极展开和一个入射局部展开，两者都截断到 $p$ 阶（其中 $p \\in \\mathbb{N}_0$）。\n\n考虑两种展开的表示方法：\n- 笛卡尔多极子：由总次数最高为 $p$ 的 $(x,y,z)$ 单项式构成。\n- 球谐多极子：由阶数 $\\ell$ 最高为 $p$ 且包含所有次数 $m$ 的标量球谐函数 $Y_{\\ell m}$ 构成。\n\n假设采用体同步并行执行模型，在晕轮交换期间，每个进程向其六个面相邻进程中的每一个发送一条消息，该消息打包了位于该面上的所有展开。将单进程内存占用定义为在叶节点层级上存储该进程所有多极和局部系数所需的总字节数，并将一次晕轮交换的单进程带宽需求定义为在该次交换中跨所有六个面发送的总字节数。忽略任何额外的缓冲区、元数据或压缩，并假设对于相同的截断阶数 $p$，两种表示方法存储相同的物理内容（复数系数）。\n\n仅使用以下基本依据：\n- 三个变量中总次数恰好为 $k$ 的不同单项式的数量为 $\\binom{k+2}{2}$，总次数至多为 $p$ 的单项式数量为 $\\sum_{k=0}^{p} \\binom{k+2}{2}$。\n- 固定阶数 $\\ell$ 的标量球谐函数系数的数量为 $2\\ell+1$，阶数至多为 $p$ 的系数数量为 $\\sum_{\\ell=0}^{p} (2\\ell+1)$。\n- 一个 $b \\times b \\times b$ 的块有 $b^{3}$ 个叶节点方盒和 $6 b^{2}$ 个面方盒。\n\n推导以下各项的显式闭式表达式：\n- 分别对应笛卡尔和球谐表示法的单进程内存占用 $m_{\\mathrm{C}}(p)$ 和 $m_{\\mathrm{S}}(p)$。\n- 一次晕轮交换中，跨所有六个面的单进程总交换字节量 $V_{\\mathrm{C}}(p)$ 和 $V_{\\mathrm{S}}(p)$。\n\n然后，在这些假设和定义下，给出无量纲比率\n$$\nR(p) \\equiv \\frac{m_{\\mathrm{C}}(p)}{m_{\\mathrm{S}}(p)} \\;=\\; \\frac{V_{\\mathrm{C}}(p)}{V_{\\mathrm{S}}(p)} \\, ,\n$$\n的单一闭式解析表达式，该表达式仅以 $p$ 为函数并尽可能简化。您的最终答案必须是这个单一表达式 $R(p)$。不需要数值，最终答案框中也不应包含任何单位。",
            "solution": "首先根据所需标准对问题陈述进行验证。该问题在科学上植根于计算电磁学领域，特别是关于快速多极子方法（FMM）。所有术语，如八叉树、区域分解、晕轮交换、多极展开（笛卡尔和球谐），都是标准且明确定义的。该问题是适定的，提供了所有必要的定义、常数和公式，以得出一个唯一的解析解。语言客观而精确。其前提，包括基函数数量的组合公式和分解域的几何特性，在事实上是正确的且内部一致。因此，该问题被认定为有效。\n\n求解过程首先确定每种展开类型的系数数量，然后推导内存和带宽的表达式，最后计算它们的比率。\n\n令 $N_{\\mathrm{C}}(p)$ 为截断到 $p$ 阶的笛卡尔多极展开的复数值系数数量，令 $N_{\\mathrm{S}}(p)$ 为球谐多极展开的系数数量。问题陈述指出，笛卡尔展开由总次数至多为 $p$ 的单项式构成，球谐展开由阶数 $\\ell$ 至多为 $p$ 的球谐函数构成。每种展开的系数数量由所提供的求和公式给出。\n\n对于笛卡尔表示法，系数数量是 3 个变量 $(x,y,z)$ 中次数至多为 $p$ 的单项式总数。这由下式给出：\n$$\nN_{\\mathrm{C}}(p) = \\sum_{k=0}^{p} \\binom{k+2}{2}\n$$\n这个和可以使用曲棍球棒恒等式 $\\sum_{i=r}^{n} \\binom{i}{r} = \\binom{n+1}{r+1}$ 以闭式形式求出。令 $r=2$ 并求和至 $n=p$（索引经过移位），我们得到：\n$$\nN_{\\mathrm{C}}(p) = \\binom{p+3}{3} = \\frac{(p+3)!}{3!p!} = \\frac{(p+3)(p+2)(p+1)}{6}\n$$\n\n对于球谐表示法，系数数量是对于从 $0$ 到 $p$ 的每个阶数 $\\ell$ 的球谐函数数量之和。这由下式给出：\n$$\nN_{\\mathrm{S}}(p) = \\sum_{\\ell=0}^{p} (2\\ell+1)\n$$\n这是前 $p+1$ 个奇数的和，这是一个标准结果：\n$$\nN_{\\mathrm{S}}(p) = (p+1)^{2}\n$$\n或者，我们可以直接计算这个和：\n$$\nN_{\\mathrmS}}(p) = 2 \\sum_{\\ell=0}^{p} \\ell + \\sum_{\\ell=0}^{p} 1 = 2 \\frac{p(p+1)}{2} + (p+1) = p(p+1) + (p+1) = (p+1)(p+1) = (p+1)^{2}\n$$\n\n接下来，我们推导单进程内存占用 $m(p)$ 和单进程晕轮交换字节量 $V(p)$ 的表达式。\n一个进程拥有一个 $b^3$ 个叶节点方盒组成的块。每个叶节点方盒存储两个展开（一个出射多极展开，一个入射局部展开）。每个展开都有一组复数系数，每个系数大小为 $\\sigma$ 字节。\n笛卡尔表示法的单进程内存占用 $m_{\\mathrm{C}}(p)$ 为：\n$$\nm_{\\mathrm{C}}(p) = (\\text{number of boxes}) \\times (\\text{expansions per box}) \\times (\\text{coefficients per expansion}) \\times (\\text{bytes per coefficient})\n$$\n$$\nm_{\\mathrm{C}}(p) = b^{3} \\cdot 2 \\cdot N_{\\mathrm{C}}(p) \\cdot \\sigma = 2\\sigma b^{3} \\frac{(p+1)(p+2)(p+3)}{6} = \\frac{\\sigma b^{3}(p+1)(p+2)(p+3)}{3}\n$$\n类似地，对于球谐表示法，$m_{\\mathrm{S}}(p)$ 为：\n$$\nm_{\\mathrm{S}}(p) = b^{3} \\cdot 2 \\cdot N_{\\mathrm{S}}(p) \\cdot \\sigma = 2\\sigma b^{3} (p+1)^{2}\n$$\n\n对于晕轮交换，每个进程将其面方盒中的数据发送给其 6 个面相邻进程。问题陈述中提到总共有 $6b^2$ 个面方盒（解释为 6 个面上各有 $b^2$ 个方盒），发送的数据来自这些方盒中各自的出射多极展开。\n笛卡尔表示法的单进程晕轮交换字节量 $V_{\\mathrm{C}}(p)$ 为：\n$$\nV_{\\mathrm{C}}(p) = (\\text{number of face boxes}) \\times (\\text{expansions sent per box}) \\times (\\text{coefficients per expansion}) \\times (\\text{bytes per coefficient})\n$$\n$$\nV_{\\mathrm{C}}(p) = 6b^{2} \\cdot 1 \\cdot N_{\\mathrm{C}}(p) \\cdot \\sigma = 6\\sigma b^{2} \\frac{(p+1)(p+2)(p+3)}{6} = \\sigma b^{2}(p+1)(p+2)(p+3)\n$$\n对于球谐表示法，$V_{\\mathrmS}}(p)$ 为：\n$$\nV_{\\mathrm{S}}(p) = 6b^{2} \\cdot 1 \\cdot N_{\\mathrm{S}}(p) \\cdot \\sigma = 6\\sigma b^{2} (p+1)^{2}\n$$\n\n问题要求的是无量纲比率 $R(p)$。我们已知\n$$\nR(p) \\equiv \\frac{m_{\\mathrm{C}}(p)}{m_{\\mathrm{S}}(p)} \\;=\\; \\frac{V_{\\mathrm{C}}(p)}{V_{\\mathrm{S}}(p)}\n$$\n让我们用推导出的表达式来验证这个等式。\n$$\n\\frac{m_{\\mathrm{C}}(p)}{m_{\\mathrm{S}}(p)} = \\frac{2\\sigma b^{3} N_{\\mathrm{C}}(p)}{2\\sigma b^{3} N_{\\mathrm{S}}(p)} = \\frac{N_{\\mathrm{C}}(p)}{N_{\\mathrm{S}}(p)}\n$$\n$$\n\\frac{V_{\\mathrm{C}}(p)}{V_{\\mathrm{S}}(p)} = \\frac{6\\sigma b^{2} N_{\\mathrm{C}}(p)}{6\\sigma b^{2} N_{\\mathrm{S}}(p)} = \\frac{N_{\\mathrm{C}}(p)}{N_{\\mathrm{S}}(p)}\n$$\n等式成立。比率 $R(p)$ 确实是两种表示法的系数数量之比，与进程网格大小 $b$ 和系数大小 $\\sigma$ 无关。\n\n现在我们通过代入 $N_{\\mathrm{C}}(p)$ 和 $N_{\\mathrmS}}(p)$ 的闭式表达式来计算 $R(p)$：\n$$\nR(p) = \\frac{N_{\\mathrm{C}}(p)}{N_{\\mathrm{S}}(p)} = \\frac{\\frac{(p+1)(p+2)(p+3)}{6}}{(p+1)^{2}}\n$$\n因为 $p \\in \\mathbb{N}_0$，我们有 $p \\geq 0$，这意味着 $p+1 \\geq 1$。因此，我们可以安全地从分子和分母中约去一个因子 $(p+1)$。\n$$\nR(p) = \\frac{(p+1)(p+2)(p+3)}{6(p+1)^{2}} = \\frac{(p+2)(p+3)}{6(p+1)}\n$$\n这就是比率 $R(p)$ 的最终、简化的、仅以 $p$ 为函数的闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{(p+2)(p+3)}{6(p+1)}}\n$$"
        },
        {
            "introduction": "在前述宏观负载均衡和数据表示优化的基础上，我们进一步深入到计算核心的性能分析。FMM中关键的“多极子到局部展开”（M2L）转换步骤，存在多种具有不同计算复杂度的算法。本练习  将探讨这些算法选择如何与硬件特性（如计算速度与网络带宽）相互作用，最终决定整个方法的并行效率和可扩展性。",
            "id": "3337298",
            "problem": "考虑基于自由空间格林函数的标量球谐函数展开，用于时谐电磁学的三维快速多极子方法 (FMM)。单个多极子到局部 (M2L) 转换将截断阶数为 $p$ 的源盒多极子展开转换为目标盒的局部展开。设 $M(p)$ 表示每次展开中保留的球谐系数的数量，并假设全程使用复数运算。展开截断阶数 $p$ 足够大，使得渐进行为标度有意义。\n\n基本前提：\n- 阶数最高为 $p$ 的球谐模态数量为 $M(p) = \\sum_{\\ell=0}^{p} (2\\ell + 1) = (p+1)^{2}$。\n- 将一个 $M(p) \\times M(p)$ 的复矩阵稠密应用于一个 $M(p)$ 维向量需要 $M(p)^{2}$ 次复数乘加运算。\n- 基于旋转的解耦利用方位对称性将 M2L 重组为关于阶数索引的带状、逐模态卷积，其整体渐进复杂度为 $p$ 的三次方。\n- 低秩压缩通过数值秩为 $r(p)$ 的因式分解来近似 M2L 算子，其应用成本与 $M(p)\\,r(p)$ 成正比。\n\n并行核粒度的通信模型：\n- 设每核的持续计算速率为 $\\sigma$（单位：每秒实数浮点运算次数），网络点对点带宽为 $\\beta$（单位：每秒字节数），每条消息的延迟为 $\\lambda$（单位：秒）。\n- 每个 M2L 核函数需要通信大小为 $M(p)$ 个复数的源多极子展开；用 $s$ 表示每个复数的字节数，因此每个 M2L 的数据量为 $D(p) = s\\,M(p)$。\n- 一次 M2L 的计算时间为 $t_{\\mathrm{comp}}(p) = F(p)/\\sigma$，其中 $F(p)$ 是所选方案的浮点运算次数。通信时间为 $t_{\\mathrm{comm}}(p) = \\lambda + D(p)/\\beta$。\n\n任务：\n1. 从以上定义出发，推导以下方案的主阶渐进浮点运算次数 $F(p)$：\n   - 朴素的稠密 M2L 应用，\n   - 基于旋转的解耦 M2L，\n   - 低秩压缩 M2L，其数值秩标度为 $r(p) = \\rho\\,(p+1)^{\\alpha}$，其中 $\\rho  0$ 和 $\\alpha \\geq 0$ 是依赖于方案和分离度的常数。\n   使用常数 $c_{\\mathrm{cma}}$、$c_{\\mathrm{rot}}$ 和 $c_{\\mathrm{lr}}$ 以闭合形式表示每个 $F(p)$，这些常数分别吸收了复数乘加、基于旋转的解耦工作和低秩应用的与实现相关的操作计数。\n2. 使用上述计算/通信模型，并通过取带宽项占主导的渐进极限 $p \\to \\infty$ 来忽略延迟，推导每种方案下使得 $t_{\\mathrm{comp}}(p) = t_{\\mathrm{comm}}(p)$ 的阈值截断阶数 $p_{\\ast}^{\\mathrm{dense}}$、$p_{\\ast}^{\\mathrm{rot}}$ 和 $p_{\\ast}^{\\mathrm{lr}}$。您的表达式必须用 $p$ 和常数 $\\sigma$、$\\beta$、$s$、$c_{\\mathrm{cma}}$、$c_{\\mathrm{rot}}$、$c_{\\mathrm{lr}}$、$\\rho$ 和 $\\alpha$ 精确表示；不要在代数运算中进行不受控制的近似。\n\n将您的最终答案以单行矩阵的形式给出，其中按顺序列出三个渐进浮点运算次数，然后是三个渐进计算主导阈值：\n$$\\big(F_{\\mathrm{dense}}(p),\\,F_{\\mathrm{rot}}(p),\\,F_{\\mathrm{lr}}(p),\\,p_{\\ast}^{\\mathrm{dense}},\\,p_{\\ast}^{\\mathrm{rot}},\\,p_{\\ast}^{\\mathrm{lr}}\\big).$$\n不需要进行数值计算。最终答案必须是一个不带单位的闭合形式解析表达式。",
            "solution": "问题已经过验证，被认为是有效的。它具有科学依据，问题提出得当，并且客观，为严谨的解析解提供了充分的基础。\n\n该问题要求对快速多极子方法 (FMM) 中不同多极子到局部 (M2L) 转换方案的计算和通信成本进行两组推导。首先，我们将推导三种方案的主阶渐进浮点运算 (flop) 次数 $F(p)$。其次，我们将推导计算时间等于通信时间时的阈值截断阶数 $p_{\\ast}$。\n\n对于截断阶数 $p$，球谐系数的数量为 $M(p) = (p+1)^2$。所有计算均使用复数运算。\n\n**第一部分：渐进浮点运算次数 $F(p)$**\n\n浮点运算次数 $F(p)$ 表示一次 M2L 转换所需的实数浮点运算总数。我们针对三种指定方案分别进行推导。\n\n1.  **朴素的稠密 M2L ($F_{\\mathrm{dense}}(p)$):**\n    问题指出，一次稠密的 M2L 转换等价于将一个稠密的 $M(p) \\times M(p)$ 复矩阵应用于一个 $M(p)$ 元复向量。这需要 $M(p)^2$ 次复数乘加 (CMA) 运算。常数 $c_{\\mathrm{cma}}$ 代表每次 CMA 的实数浮点运算次数。因此，总浮点运算次数是 CMA 次数与该常数的乘积。\n    $$F_{\\mathrm{dense}}(p) = c_{\\mathrm{cma}} \\times [M(p)]^2$$\n    代入 $M(p)$ 的表达式：\n    $$F_{\\mathrm{dense}}(p) = c_{\\mathrm{cma}} \\left((p+1)^2\\right)^2 = c_{\\mathrm{cma}} (p+1)^4$$\n    这就是所需的主阶浮点运算次数的闭合形式表达式。\n\n2.  **基于旋转的解耦 M2L ($F_{\\mathrm{rot}}(p)$):**\n    对于此方案，问题指出其整体渐进复杂度是 $p$ 的三次方。我们给定一个比例常数 $c_{\\mathrm{rot}}$，它吸收了与实现相关的细节，单位为浮点运算次数。在 FMM 文献中，对 $p$ 的依赖关系通常用 $(p+1)$ 来表示，这与其他表达式保持一致。\n    $$F_{\\mathrm{rot}}(p) = c_{\\mathrm{rot}} (p+1)^3$$\n    该表达式捕捉了主阶 $p^3$ 的标度关系。\n\n3.  **低秩压缩 M2L ($F_{\\mathrm{lr}}(p)$):**\n    该方案依赖于 M2L 算子的低秩近似。其应用成本据称与展开系数的数量 $M(p)$ 和近似的数值秩 $r(p)$ 的乘积成正比。比例常数为 $c_{\\mathrm{lr}}$。\n    $$F_{\\mathrm{lr}}(p) \\propto M(p) \\, r(p)$$\n    我们已知 $M(p)$ 和 $r(p)$ 的形式：$M(p) = (p+1)^2$ 和 $r(p) = \\rho(p+1)^{\\alpha}$，其中 $\\rho  0$ 和 $\\alpha \\ge 0$。\n    将这些代入浮点运算次数表达式可得：\n    $$F_{\\mathrm{lr}}(p) = c_{\\mathrm{lr}} \\left( (p+1)^2 \\right) \\left( \\rho(p+1)^{\\alpha} \\right)$$\n    $$F_{\\mathrm{lr}}(p) = c_{\\mathrm{lr}} \\rho (p+1)^{2+\\alpha}$$\n    这是低秩方案浮点运算次数的闭合形式表达式。\n\n**第二部分：阈值截断阶数 $p_{\\ast}$**\n\n接下来，我们推导计算时间 $t_{\\mathrm{comp}}(p)$ 等于通信时间 $t_{\\mathrm{comm}}(p)$ 时的阈值截断阶数 $p_{\\ast}$。平衡条件是 $t_{\\mathrm{comp}}(p) = t_{\\mathrm{comm}}(p)$。\n\n给定的模型是：\n$$t_{\\mathrm{comp}}(p) = \\frac{F(p)}{\\sigma}$$\n$$t_{\\mathrm{comm}}(p) = \\lambda + \\frac{D(p)}{\\beta}$$\n其中 $F(p)$ 是浮点运算次数，$\\sigma$ 是计算速率，$\\lambda$ 是延迟，$\\beta$ 是带宽，$D(p) = s\\,M(p) = s(p+1)^2$ 是数据量。\n\n问题指定在 $p$ 很大时，即带宽项主导延迟的渐进极限下求阈值。因此，我们忽略 $\\lambda$ 并设：\n$$t_{\\mathrm{comm}}(p) \\approx \\frac{D(p)}{\\beta} = \\frac{s(p+1)^2}{\\beta}$$\n平衡方程变为：\n$$\\frac{F(p)}{\\sigma} = \\frac{s(p+1)^2}{\\beta}$$\n我们对每种方案求解该方程以得到 $p$，从而找出各自的阈值 $p_{\\ast}$。\n\n1.  **稠密方案阈值 ($p_{\\ast}^{\\mathrm{dense}}$):**\n    将 $F_{\\mathrm{dense}}(p) = c_{\\mathrm{cma}} (p+1)^4$ 代入平衡方程：\n    $$\\frac{c_{\\mathrm{cma}} (p+1)^4}{\\sigma} = \\frac{s(p+1)^2}{\\beta}$$\n    对于任何非平凡截断（$p \\ge 0$，因此 $p+1 \\ne 0$），我们可以将两边同时除以 $(p+1)^2$：\n    $$\\frac{c_{\\mathrm{cma}} (p+1)^2}{\\sigma} = \\frac{s}{\\beta}$$\n    求解 $(p+1)$：\n    $$(p+1)^2 = \\frac{s \\sigma}{c_{\\mathrm{cma}} \\beta}$$\n    因为 $p+1  0$，我们取正平方根：\n    $$p+1 = \\sqrt{\\frac{s \\sigma}{c_{\\mathrm{cma}} \\beta}}$$\n    $$p_{\\ast}^{\\mathrm{dense}} = \\sqrt{\\frac{s \\sigma}{c_{\\mathrm{cma}} \\beta}} - 1$$\n\n2.  **基于旋转方案的阈值 ($p_{\\ast}^{\\mathrm{rot}}$):**\n    代入 $F_{\\mathrm{rot}}(p) = c_{\\mathrm{rot}} (p+1)^3$：\n    $$\\frac{c_{\\mathrm{rot}} (p+1)^3}{\\sigma} = \\frac{s(p+1)^2}{\\beta}$$\n    除以 $(p+1)^2$：\n    $$\\frac{c_{\\mathrm{rot}} (p+1)}{\\sigma} = \\frac{s}{\\beta}$$\n    求解 $p+1$：\n    $$p+1 = \\frac{s \\sigma}{c_{\\mathrm{rot}} \\beta}$$\n    $$p_{\\ast}^{\\mathrm{rot}} = \\frac{s \\sigma}{c_{\\mathrm{rot}} \\beta} - 1$$\n\n3.  **低秩方案阈值 ($p_{\\ast}^{\\mathrm{lr}}$):**\n    代入 $F_{\\mathrm{lr}}(p) = c_{\\mathrm{lr}} \\rho (p+1)^{2+\\alpha}$：\n    $$\\frac{c_{\\mathrm{lr}} \\rho (p+1)^{2+\\alpha}}{\\sigma} = \\frac{s(p+1)^2}{\\beta}$$\n    除以 $(p+1)^2$：\n    $$\\frac{c_{\\mathrm{lr}} \\rho (p+1)^{\\alpha}}{\\sigma} = \\frac{s}{\\beta}$$\n    求解 $(p+1)^{\\alpha}$：\n    $$(p+1)^{\\alpha} = \\frac{s \\sigma}{c_{\\mathrm{lr}} \\rho \\beta}$$\n    这一步需要 $\\alpha \\neq 0$ 才能解出 $p$。如果 $\\alpha=0$，方程会变成一个与 $p$ 无关的、关于常数的条件，这是一种退化情况，不会产生特定的阈值阶数。我们假设 $\\alpha  0$，这在此类非平凡低秩近似的背景下是典型的。\n    两边取 $1/\\alpha$ 次幂：\n    $$p+1 = \\left( \\frac{s \\sigma}{c_{\\mathrm{lr}} \\rho \\beta} \\right)^{1/\\alpha}$$\n    $$p_{\\ast}^{\\mathrm{lr}} = \\left( \\frac{s \\sigma}{c_{\\mathrm{lr}} \\rho \\beta} \\right)^{1/\\alpha} - 1$$\n\n这些表达式根据所提供的参数，以精确的闭合形式给出了所需的六个量。",
            "answer": "$$\\boxed{\\begin{pmatrix} c_{\\mathrm{cma}} (p+1)^{4}  c_{\\mathrm{rot}} (p+1)^{3}  c_{\\mathrm{lr}} \\rho (p+1)^{2+\\alpha}  \\sqrt{\\frac{s \\sigma}{c_{\\mathrm{cma}} \\beta}} - 1  \\frac{s \\sigma}{c_{\\mathrm{rot}} \\beta} - 1  \\left(\\frac{s \\sigma}{c_{\\mathrm{lr}} \\rho \\beta}\\right)^{1/\\alpha} - 1 \\end{pmatrix}}$$"
        }
    ]
}