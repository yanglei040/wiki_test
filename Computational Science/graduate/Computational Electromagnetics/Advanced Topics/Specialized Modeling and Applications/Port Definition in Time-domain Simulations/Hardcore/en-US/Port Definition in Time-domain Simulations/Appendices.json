{
    "hands_on_practices": [
        {
            "introduction": "Before using computational ports for complex analysis, it is crucial to verify their adherence to first principles. This foundational exercise provides a \"null test\" for a time-domain port, confirming that it correctly implements power normalization based on the Poynting theorem and transmission-line theory. By launching a pulse with a prescribed power into a perfectly matched load, you will verify that the numerically integrated energy delivered matches the analytical prediction, reinforcing the core concepts of incident power and reflectionless termination .",
            "id": "3342260",
            "problem": "Design a verification experiment for a time-domain port in computational electromagnetics that confirms power normalization by launching a pulse with specified incident power and measuring the integrated energy delivered to a matched load. Work entirely in the one-dimensional Transverse Electromagnetic (TEM) transmission-line abstraction and use the following fundamental bases: Maxwell’s equations, the Poynting theorem, and the transmission-line decomposition into forward (incident) and backward (reflected) traveling waves.\n\nYou must start from first principles. Consider a lossless, dispersionless, uniform TEM transmission line characterized by real characteristic impedance $Z_0$ and wave speed $c$. In a time-domain port model, the total voltage $v(t)$ and current $i(t)$ at the port can be decomposed into incident and reflected traveling-wave components $v^{+}(t)$ and $v^{-}(t)$ by the relations\n$$\nv(t) = v^{+}(t) + v^{-}(t), \\quad i(t) = \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right).\n$$\nA matched load at the port is one whose impedance equals the characteristic impedance $Z_0$, which implies zero reflection $v^{-}(t) = 0$ for any incident waveform.\n\nFrom the Poynting theorem and the transmission-line correspondence between the cross-sectional Poynting flux and the product $v(t)i(t)$, the instantaneous power delivered into the load is\n$$\np(t) = v(t)i(t).\n$$\nUnder a matched termination, $v(t) = v^{+}(t)$ and $i(t) = \\frac{v^{+}(t)}{Z_0}$, so\n$$\np(t) = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0}.\n$$\n\nYour task is to verify, in discrete time, that a port normalized to launch an incident pulse of prescribed instantaneous power indeed delivers the corresponding energy into a matched load. Specifically, launch a rectangular-top pulse with constant incident power $P_0 = 1\\,\\text{W}$ over a duration $T$ and zero elsewhere. Let the discrete-time step be $\\Delta t$, and let the number of pulse samples be $N$ so that $T = N\\,\\Delta t$. Use the left Riemann sum interpretation of discrete-time power samples as interval-averaged values to compute the delivered energy:\n$$\nE_{\\text{deliv}} \\approx \\sum_{n=0}^{N-1} p[n]\\,\\Delta t.\n$$\nFor a matched load and ideal port normalization, the theoretical energy is\n$$\nE_{\\text{theory}} = \\int_{0}^{T} P_0\\,dt = P_0 T = P_0 N \\Delta t.\n$$\nTo realize the incident power $P_0$ in a time-domain port, choose the incident voltage waveform on the matched line as\n$$\nv^{+}[n] = \\sqrt{Z_0 P_0}\\,u_{\\text{rect}}[n],\n$$\nwhere $u_{\\text{rect}}[n]$ equals $1$ on the $N$ samples of the pulse and $0$ elsewhere. Under a matched load, the total port fields satisfy $v[n] = v^{+}[n]$ and $i[n] = \\frac{v[n]}{Z_0}$.\n\nImplement a program that constructs $v[n]$ and $i[n]$ as above for each test case, computes $E_{\\text{deliv}}$ using the left Riemann sum, and returns the absolute error\n$$\n\\varepsilon = \\left|E_{\\text{deliv}} - E_{\\text{theory}}\\right|\n$$\nin joules. All physical answers must be expressed in joules. Angles do not appear in this problem. Do not express any value as a percentage.\n\nTest suite and required units:\n- Use $P_0 = 1\\,\\text{W}$ in all cases and express energy in joules.\n- Each test case is specified by ($Z_0$, $\\Delta t$, $N$), with $Z_0$ in ohms, $\\Delta t$ in seconds, $N$ dimensionless.\n- Test cases:\n    - Case 1 (happy path): $Z_0 = 50\\,\\Omega$, $\\Delta t = 1\\times 10^{-12}\\,\\text{s}$, $N = 1000$.\n    - Case 2 (coverage: different $Z_0$ and step): $Z_0 = 377\\,\\Omega$, $\\Delta t = 2\\times 10^{-12}\\,\\text{s}$, $N = 500$.\n    - Case 3 (coverage: longer pulse and different $Z_0$): $Z_0 = 75\\,\\Omega$, $\\Delta t = 5\\times 10^{-12}\\,\\text{s}$, $N = 1000$.\n    - Case 4 (edge: very short pulse): $Z_0 = 200\\,\\Omega$, $\\Delta t = 1\\times 10^{-11}\\,\\text{s}$, $N = 3$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases. The $k$-th entry must be the absolute energy error $\\varepsilon$ in joules for case $k$. For example, a valid output string has the form \"[result_case1,result_case2,result_case3,result_case4]\".",
            "solution": "The problem asks for the design and implementation of a numerical verification experiment for a time-domain port model in computational electromagnetics. The experiment aims to confirm that the port correctly normalizes a launched pulse to a specified incident power. This is achieved by computing the total energy delivered to a matched load and comparing it to the theoretical value. The framework for this problem is the one-dimensional, lossless, dispersionless Transverse Electromagnetic (TEM) transmission line model, which is a fundamental abstraction derived from Maxwell's equations.\n\nThe core principle of this verification lies in the traveling-wave decomposition on a transmission line. The total voltage $v(t)$ and current $i(t)$ at any point, such as a port, can be expressed as the superposition of a forward-propagating (incident) wave and a backward-propagating (reflected) wave. The relationships are given by:\n$$\nv(t) = v^{+}(t) + v^{-}(t)\n$$\n$$\ni(t) = \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right)\n$$\nHere, $v^{+}(t)$ and $v^{-}(t)$ represent the incident and reflected voltage waves, respectively, and $Z_0$ is the characteristic impedance of the transmission line.\n\nThe instantaneous power $p(t)$ flowing into a load connected at the port is given by the product of the total voltage and current, $p(t) = v(t)i(t)$, which is the transmission-line equivalent of the integrated Poynting flux over the cross-section.\n\nThe problem specifies a matched load, which is a critical condition. A matched load has an impedance equal to the characteristic impedance $Z_0$ of the line. By Ohm's law at the load, $v(t) = Z_0 i(t)$. Substituting the wave decomposition into this condition yields:\n$$\nv^{+}(t) + v^{-}(t) = Z_0 \\left( \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right) \\right) = v^{+}(t) - v^{-}(t)\n$$\nThis simplifies to $2v^{-}(t) = 0$, which implies $v^{-}(t) = 0$. A matched load perfectly absorbs the incident wave and produces no reflection. Consequently, the total voltage and current at the port simplify to $v(t) = v^{+}(t)$ and $i(t) = v^{+}(t)/Z_0$. The power delivered to the matched load is then:\n$$\np(t) = v(t)i(t) = v^{+}(t) \\cdot \\frac{v^{+}(t)}{Z_0} = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0}\n$$\n\nThe verification experiment is designed around a specific incident pulse: one with a constant instantaneous power $P_0$ over a duration $T$. To achieve this, we must construct the corresponding incident voltage waveform $v^{+}(t)$. From the power relation, we require:\n$$\nP_0 = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0} \\quad \\text{for } t \\in [0, T]\n$$\nSolving for $v^{+}(t)$ gives the necessary amplitude for the incident voltage pulse:\n$$\nv^{+}(t) = \\sqrt{Z_0 P_0} \\quad \\text{for } t \\in [0, T]\n$$\nand $v^{+}(t) = 0$ elsewhere.\n\nThe total theoretical energy $E_{\\text{theory}}$ delivered by this pulse is the time integral of the constant power $P_0$ over the duration $T$:\n$$\nE_{\\text{theory}} = \\int_{0}^{T} P_0\\,dt = P_0 T\n$$\nIn the discrete-time domain used for numerical simulation, the time duration $T$ is represented by $N$ time steps of size $\\Delta t$, so $T = N \\Delta t$. Thus, the theoretical energy is:\n$$\nE_{\\text{theory}} = P_0 N \\Delta t\n$$\nThe numerical simulation calculates the delivered energy, $E_{\\text{deliv}}$, by summing the discrete power samples. Using the specified left Riemann sum interpretation:\n$$\nE_{\\text{deliv}} = \\sum_{n=0}^{N-1} p[n]\\,\\Delta t\n$$\nwhere $p[n]$ is the instantaneous power at time step $n$. Following the model, we first construct the discrete incident voltage $v^{+}[n] = \\sqrt{Z_0 P_0}$ for $n=0, 1, \\dots, N-1$. Since the load is matched, the total fields are $v[n] = v^{+}[n]$ and $i[n] = v[n]/Z_0$. The discrete instantaneous power is:\n$$\np[n] = v[n]i[n] = \\frac{(v[n])^2}{Z_0} = \\frac{(\\sqrt{Z_0 P_0})^2}{Z_0} = \\frac{Z_0 P_0}{Z_0} = P_0\n$$\nThis holds for each time step $n$ where the pulse is active. Substituting this constant power into the summation for $E_{\\text{deliv}}$ yields:\n$$\nE_{\\text{deliv}} = \\sum_{n=0}^{N-1} P_0\\,\\Delta t = P_0 \\Delta t \\sum_{n=0}^{N-1} 1 = P_0 N \\Delta t\n$$\nAnalytically, we find that $E_{\\text{deliv}} = E_{\\text{theory}}$. This is a \"null test\" or \"zero test\": the purpose is to verify that a numerical implementation of these formulas correctly reproduces this analytical identity. The metric for this verification is the absolute error $\\varepsilon = |E_{\\text{deliv}} - E_{\\text{theory}}|$. Based on our derivation, this error is expected to be zero, or a very small value on the order of machine precision due to the nature of floating-point arithmetic.\n\nThe algorithm for each test case ($Z_0, \\Delta t, N$) with $P_0 = 1\\,\\text{W}$ is as follows:\n1.  Calculate the theoretical energy: $E_{\\text{theory}} = P_0 N \\Delta t$.\n2.  From the problem's physical model, the instantaneous power $p[n]$ delivered to a matched load from a port normalized for incident power $P_0$ is, by definition, $p[n]=P_0$.\n3.  Calculate the delivered energy numerically by summing these power contributions: $E_{\\text{deliv}} = \\sum_{n=0}^{N-1} P_0 \\Delta t = P_0 N \\Delta t$.\n4.  Compute the absolute error $\\varepsilon = |E_{\\text{deliv}} - E_{\\text{theory}}|$. Given the direct calculation, the error will be fundamentally zero, limited only by the precision of the floating-point representation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a verification experiment for a time-domain port model\n    in computational electromagnetics.\n\n    The experiment verifies that a port normalized to launch an incident pulse\n    of prescribed power (P_0) delivers the correct total energy into a\n    matched load. The absolute error between the numerically computed\n    delivered energy and the theoretical energy is calculated.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Z_0 in ohms, Delta_t in seconds, N dimensionless)\n    test_cases = [\n        (50.0, 1e-12, 1000),  # Case 1\n        (377.0, 2e-12, 500),   # Case 2\n        (75.0, 5e-12, 1000),   # Case 3\n        (200.0, 1e-11, 3),     # Case 4\n    ]\n\n    # Incident power is constant for all test cases.\n    P_0 = 1.0  # W\n\n    results = []\n    for case in test_cases:\n        Z_0, delta_t, N = case\n\n        # 1. Calculate the theoretical total energy delivered.\n        # E_theory = integral(P_0 dt) from 0 to T, where T = N * delta_t.\n        # For a constant P_0, this is simply P_0 * T.\n        E_theory = P_0 * N * delta_t\n\n        # 2. Simulate the physical process in discrete time.\n        # A port normalized for incident power P_0 is defined such that it would\n        # deliver P_0 to a matched load at every instant the source is active.\n        # For a rectangular pulse of duration T, the instantaneous power p[n]\n        # delivered to the matched load is P_0 for n = 0, ..., N-1.\n        \n        # We can explicitly follow the steps laid out in the problem to demonstrate this:\n        # a. Define the incident voltage waveform to produce power P_0.\n        # p_inc(t) = (v+(t))^2 / Z_0 = v+(t) = sqrt(Z_0 * p_inc(t))\n        # For p_inc(t) = P_0, the voltage amplitude is constant.\n        v_plus_amplitude = np.sqrt(Z_0 * P_0)\n        \n        # b. For a matched load, v(t) = v+(t) and i(t) = v+(t) / Z_0.\n        v_total_amplitude = v_plus_amplitude\n        i_total_amplitude = v_total_amplitude / Z_0\n        \n        # c. Calculate the instantaneous power p[n] = v[n] * i[n] for each step.\n        # Since v and i amplitudes are constant, the power is constant.\n        p_n = v_total_amplitude * i_total_amplitude\n        # Analytically, p_n = sqrt(Z_0*P_0) * (sqrt(Z_0*P_0)/Z_0) = (Z_0*P_0)/Z_0 = P_0.\n        # The numerical calculation should yield a value extremely close to P_0.\n\n        # 3. Calculate the total delivered energy using a left Riemann sum.\n        # E_deliv = sum(p[n] * delta_t for n=0 to N-1)\n        # Since p[n] is constant over the pulse duration:\n        E_deliv = N * p_n * delta_t\n        \n        # 4. Compute the absolute error between delivered and theoretical energy.\n        # This is a \"null test\" where the error should be zero or at the level\n        # of machine floating-point precision.\n        error = abs(E_deliv - E_theory)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    # The output should be a list of zeros, reflecting the analytic identity.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The abstract concept of a port must be translated into a concrete numerical implementation, and different choices can lead to different results. This practice investigates the subtle but significant impact of the port's spatial definition on measured circuit parameters, specifically comparing a local \"lumped\" port to a \"modal\" waveport . By developing a model for non-uniform fields at a microstrip bend, you will quantify how the port's field-sampling region can introduce a systematic bias into the extracted value of a discontinuity capacitance, highlighting the importance of understanding your tool's underlying definitions.",
            "id": "3342286",
            "problem": "Consider a right-angle microstrip bend modeled in a quasi-static, quasi-transverse electromagnetic setting. Two different port definitions are used to excite and measure the line in the time domain: a local voltage/current-based lumped port of finite lateral extent and a distributed modal waveport that performs a full cross-sectional mode extraction. You will compare how each port’s field sampling region biases the perceived shunt discontinuity capacitance when using a time-domain reflectometry step response extractor.\n\nBase the derivation on the following accepted foundations:\n- Maxwell’s equations in differential form, the constitutive relations, and charge continuity.\n- The small-signal scattering of a shunt admittance inserted between two identical lossless transmission lines of characteristic impedance $Z_0$: if the normalized shunt admittance is $y = Y Z_0$, then the reflection coefficient is $S_{11} = -\\dfrac{y}{2 + y}$, which for $|y| \\ll 1$ reduces to $S_{11} \\approx - \\dfrac{y}{2}$.\n- The time-domain reflectometry relation for a shunt capacitance $C_{\\mathrm{d}}$ embedded symmetrically between two identical, matched, lossless lines: for a unit-amplitude forward step $v^{+}(t)$, the small-signal reflected wave is $v^{-}(t) = - \\dfrac{Z_0 C_{\\mathrm{d}}}{2} \\dfrac{d v_{\\mathrm{disc}}(t)}{d t}$, so the area under the reflection kernel, normalized to a unit step, equals $- \\dfrac{Z_0 C_{\\mathrm{d}}}{2}$.\n\nYou will model how the port’s finite field sampling region modifies the measured relationship between the discontinuity’s local voltage and the port’s reported voltage. Let the microstrip width be $w$ and introduce a lateral coordinate $x \\in [0,w]$ with $x=0$ at the inner bend edge. Let the dimensionless quasi-static field concentration profile across the width be\n$$\ng(x;\\sigma) \\triangleq \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2}, \\quad \\text{with} \\quad K \\ \\text{chosen so that} \\ \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1.\n$$\nThis normalization enforces that the cross-sectional average of $g$ is unity, so that the distributed modal waveport’s line voltage, defined as the cross-sectional average potential difference, equals the effective voltage across the discontinuity. For a lumped port that measures voltage as a spatial average of the electric field over a finite lateral sampling interval of width $w_{\\mathrm{s}}$ starting at $x_0$ (so the sampling region is $[x_0, x_0 + w_{\\mathrm{s}}] \\subset [0,w]$), the measured voltage is proportional to the local average of $g$ over that interval. Define\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) \\triangleq \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} g(x;\\sigma) \\, dx, \\qquad G_{\\mathrm{avg}}(\\sigma,w) \\triangleq \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1.\n$$\n\nUsing the small-signal time-domain relation $v^{-}(t) = - \\dfrac{Z_0 C_{\\mathrm{d}}}{2} \\dfrac{d v_{\\mathrm{disc}}(t)}{d t}$ with $v_{\\mathrm{disc}}(t)$ the effective discontinuity voltage, show that:\n- For the distributed modal waveport, $v_{\\mathrm{disc}}(t) = v_{\\mathrm{wave}}(t)$ by construction, so the area-under-impulse method yields $C_{\\mathrm{est,\\,wave}} = C_{\\mathrm{d}}$.\n- For the lumped port, $v_{\\mathrm{disc}}(t) = \\dfrac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} v_{\\mathrm{lump}}(t) = \\dfrac{1}{G_{\\mathrm{local}}} v_{\\mathrm{lump}}(t)$, so the same area-under-impulse extractor that divides by $Z_0$ returns\n$$\nC_{\\mathrm{est,\\,lump}} = \\frac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} \\, C_{\\mathrm{d}} = \\frac{C_{\\mathrm{d}}}{G_{\\mathrm{local}}}.\n$$\n\nTasks:\n1. Starting only from the foundations listed above, derive the expressions for $K$, $G_{\\mathrm{local}}$, and the bias formulas $C_{\\mathrm{est,\\,wave}}$ and $C_{\\mathrm{est,\\,lump}}$ in terms of ($w,\\sigma,w_{\\mathrm{s}},x_0,C_{\\mathrm{d}}$).\n2. Implement a program that, for each test case specified below, computes $C_{\\mathrm{est,\\,wave}}$ and $C_{\\mathrm{est,\\,lump}}$ using the derived formulas. Use the closed-form antiderivative of $g(x;\\sigma)$ to compute $G_{\\mathrm{local}}$ precisely (do not use numerical quadrature). Express all capacitances in farads.\n\nUse the following test suite (all lengths must be interpreted in millimeters, capacitances in farads, and characteristic impedances in ohms; angles in any internal arctangent evaluation are in radians):\n- Test 1 (happy path, moderate field concentration, central sampling): $w = 1.0\\,\\text{mm}$, $\\sigma = 0.05\\,\\text{mm}$, $w_{\\mathrm{s}} = 0.2\\,\\text{mm}$, $x_0 = 0.4\\,\\text{mm}$, $Z_0 = 50\\,\\Omega$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}\\,\\text{F}$.\n- Test 2 (edge sampling near inner bend, stronger local field, underestimation expected): $w = 1.0\\,\\text{mm}$, $\\sigma = 0.05\\,\\text{mm}$, $w_{\\mathrm{s}} = 0.1\\,\\text{mm}$, $x_0 = 0.0\\,\\text{mm}$, $Z_0 = 50\\,\\Omega$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}\\,\\text{F}$.\n- Test 3 (sampling spans full width, unbiased): $w = 1.0\\,\\text{mm}$, $\\sigma = 0.05\\,\\text{mm}$, $w_{\\mathrm{s}} = 1.0\\,\\text{mm}$, $x_0 = 0.0\\,\\text{mm}$, $Z_0 = 50\\,\\Omega$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}\\,\\text{F}$.\n- Test 4 (extreme field concentration and very narrow edge sampling, strong underestimation): $w = 1.0\\,\\text{mm}$, $\\sigma = 0.01\\,\\text{mm}$, $w_{\\mathrm{s}} = 0.02\\,\\text{mm}$, $x_0 = 0.0\\,\\text{mm}$, $Z_0 = 50\\,\\Omega$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}\\,\\text{F}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, for each test in order, first $C_{\\mathrm{est,\\,wave}}$ then $C_{\\mathrm{est,\\,lump}}$, both in farads. For the four tests above, the output must therefore be a flat list of eight floating-point values in farads: $[C_{\\mathrm{est,\\,wave}}^{(1)},C_{\\mathrm{est,\\,lump}}^{(1)},C_{\\mathrm{est,\\,wave}}^{(2)},C_{\\mathrm{est,\\,lump}}^{(2)},C_{\\mathrm{est,\\,wave}}^{(3)},C_{\\mathrm{est,\\,lump}}^{(3)},C_{\\mathrm{est,\\,wave}}^{(4)},C_{\\mathrm{est,\\,lump}}^{(4)}]$.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in established principles of electromagnetism and transmission line theory, well-posed with a clear objective and sufficient data, and free from subjective or contradictory statements. The task is a formal derivation and subsequent calculation based on the provided physical model.\n\nThe derivation and solution proceed as follows, adhering to the principles and tasks outlined in the problem.\n\n### 1. Derivation of the Normalization Constant $K$\n\nThe dimensionless quasi-static field concentration profile is given by:\n$$\ng(x;\\sigma) \\triangleq \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2}\n$$\nThe constant $K$ is determined by the normalization condition that the cross-sectional average of $g(x;\\sigma)$ over the microstrip width $w$ is unity. This is expressed as:\n$$\nG_{\\mathrm{avg}}(\\sigma,w) = \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1\n$$\nSubstituting the expression for $g(x;\\sigma)$:\n$$\n\\frac{1}{w} \\int_{0}^{w} \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = 1\n$$\nTo solve for $K$, we first evaluate the integral. The antiderivative of the integrand is known:\n$$\n\\int \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right)\n$$\nApplying the limits of integration from $0$ to $w$:\n$$\n\\int_{0}^{w} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\left[ \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right) \\right]_{0}^{w} = \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right) - \\sigma \\arctan(0) = \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right)\n$$\nSubstituting this result back into the normalization equation:\n$$\n\\frac{K}{w} \\left( \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right) \\right) = 1\n$$\nSolving for $K$ yields the final expression for the normalization constant:\n$$\nK = \\frac{w}{\\sigma \\arctan\\left(\\dfrac{w}{\\sigma}\\right)}\n$$\n\n### 2. Derivation of the Local Averaging Function $G_{\\mathrm{local}}$\n\nThe function $G_{\\mathrm{local}}$ represents the average value of the field profile $g(x;\\sigma)$ over a finite sampling interval $[x_0, x_0 + w_{\\mathrm{s}}]$. It is defined as:\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) \\triangleq \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} g(x;\\sigma) \\, dx\n$$\nSubstituting the expression for $g(x;\\sigma)$:\n$$\nG_{\\mathrm{local}} = \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\frac{K}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx\n$$\nUsing the same antiderivative as before and applying the new limits of integration:\n$$\n\\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\left[ \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right) \\right]_{x_0}^{x_0+w_{\\mathrm{s}}} = \\sigma \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\nSubstituting this integral result into the expression for $G_{\\mathrm{local}}$:\n$$\nG_{\\mathrm{local}} = \\frac{K \\sigma}{w_{\\mathrm{s}}} \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\nFinally, substituting the derived expression for $K$:\n$$\nG_{\\mathrm{local}} = \\frac{1}{w_{\\mathrm{s}}} \\left( \\frac{w}{\\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right)} \\right) \\sigma \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\nSimplifying this expression yields the closed form for $G_{\\mathrm{local}}$:\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) = \\frac{w}{w_{\\mathrm{s}} \\arctan\\left(\\frac{w}{\\sigma}\\right)} \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\n\n### 3. Derivation of the Estimated Capacitance Formulas\n\nThe analysis starts from the time-domain reflectometry (TDR) relation for a small shunt capacitance $C_{\\mathrm{d}}$: the reflected voltage wave $v^-(t)$ is proportional to the time derivative of the voltage across the discontinuity, $v_{\\mathrm{disc}}(t)$.\n$$\nv^{-}(t) = - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\frac{d v_{\\mathrm{disc}}(t)}{d t}\n$$\nA TDR measurement algorithm estimates the capacitance by integrating the reflected pulse and normalizing by the assumed incident step amplitude and characteristic impedance $Z_0$. Assuming a unit-amplitude step stimulus, the area under the reflected pulse $v^-(t)$ is:\n$$\n\\int_{0}^{\\infty} v^{-}(t) \\, dt = \\int_{0}^{\\infty} \\left( - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\frac{d v_{\\mathrm{disc}}(t)}{d t} \\right) dt = - \\frac{Z_0 C_{\\mathrm{d}}}{2} [v_{\\mathrm{disc}}(t)]_{0}^{\\infty} = - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\Delta v_{\\mathrm{disc}}\n$$\nwhere $\\Delta v_{\\mathrm{disc}}$ is the amplitude of the voltage step across the discontinuity. The algorithm computes the estimated capacitance $C_{\\mathrm{est}}$ using the amplitude of the step voltage measured at the port, $\\Delta v_{\\mathrm{port}}$, as the reference:\n$$\nC_{\\mathrm{est}} = - \\frac{2}{Z_0 \\Delta v_{\\mathrm{port}}} \\int_{0}^{\\infty} v^{-}(t) \\, dt = - \\frac{2}{Z_0 \\Delta v_{\\mathrm{port}}} \\left( - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\Delta v_{\\mathrm{disc}} \\right) = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{port}}}\n$$\nThe bias in the estimated capacitance arises from the discrepancy between the true discontinuity voltage step $\\Delta v_{\\mathrm{disc}}$ and the port's measured voltage step $\\Delta v_{\\mathrm{port}}$. By construction, the true discontinuity voltage is proportional to the full cross-sectional average field, scaled by $G_{\\mathrm{avg}}=1$. The port voltage is proportional to the field average over its sampling region, scaled by $G_{\\mathrm{local}}$. Thus, their ratio is:\n$$\n\\frac{v_{\\mathrm{port}}(t)}{v_{\\mathrm{disc}}(t)} = \\frac{G_{\\mathrm{local}}}{G_{\\mathrm{avg}}} = G_{\\mathrm{local}} \\quad \\implies \\quad \\frac{\\Delta v_{\\mathrm{port}}}{\\Delta v_{\\mathrm{disc}}} = G_{\\mathrm{local}}\n$$\n\n**Case A: Distributed Modal Waveport**\nA distributed modal waveport definition is designed to extract the voltage of the fundamental transmission line mode, which corresponds to the cross-sectional average potential. Therefore, by its definition:\n$$\nv_{\\mathrm{wave}}(t) = v_{\\mathrm{disc}}(t) \\quad \\implies \\quad \\Delta v_{\\mathrm{wave}} = \\Delta v_{\\mathrm{disc}}\n$$\nSubstituting this into the general formula for $C_{\\mathrm{est}}$:\n$$\nC_{\\mathrm{est,\\,wave}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{wave}}} = C_{\\mathrm{d}} \\cdot 1 = C_{\\mathrm{d}}\n$$\nThe estimated capacitance is unbiased and equals the true discontinuity capacitance.\n\n**Case B: Lumped Port**\nA lumped port measures voltage by averaging the field over a finite sub-region $[x_0, x_0+w_s]$. The measured voltage is therefore related to the true discontinuity voltage by the local averaging factor:\n$$\nv_{\\mathrm{lump}}(t) = G_{\\mathrm{local}} \\cdot v_{\\mathrm{disc}}(t) \\quad \\implies \\quad \\Delta v_{\\mathrm{lump}} = G_{\\mathrm{local}} \\cdot \\Delta v_{\\mathrm{disc}}\n$$\nSubstituting this into the general formula for $C_{\\mathrm{est}}$:\n$$\nC_{\\mathrm{est,\\,lump}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{lump}}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{G_{\\mathrm{local}} \\cdot \\Delta v_{\\mathrm{disc}}} = \\frac{C_{\\mathrm{d}}}{G_{\\mathrm{local}}}\n$$\nAs $G_{\\mathrm{avg}} = 1$, this is identical to the requested form $C_{\\mathrm{est,\\,lump}} = \\frac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} C_{\\mathrm{d}}$. This shows that the estimated capacitance is biased by the inverse of the local field averaging factor. If the port samples a region of stronger-than-average field ($G_{\\mathrm{local}}  1$), the capacitance is underestimated. If it samples a region of weaker-than-average field ($G_{\\mathrm{local}}  1$), the capacitance is overestimated.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the estimated waveport and lumped-port discontinuity capacitances for a series of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (w, sigma, w_s, x_0, Z_0, C_d)\n    # Units: mm for lengths, Ohms for impedance, Farads for capacitance.\n    test_cases = [\n        # Test 1: happy path, moderate field concentration, central sampling\n        (1.0, 0.05, 0.2, 0.4, 50, 1.0e-13),\n        # Test 2: edge sampling near inner bend, stronger local field, underestimation expected\n        (1.0, 0.05, 0.1, 0.0, 50, 1.0e-13),\n        # Test 3: sampling spans full width, unbiased\n        (1.0, 0.05, 1.0, 0.0, 50, 1.0e-13),\n        # Test 4: extreme field concentration and very narrow edge sampling, strong underestimation\n        (1.0, 0.01, 0.02, 0.0, 50, 1.0e-13),\n    ]\n\n    results = []\n    for case in test_cases:\n        w, sigma, w_s, x_0, _, C_d = case\n\n        # The estimated capacitance for a distributed modal waveport is always unbiased.\n        # C_est,wave = C_d\n        c_est_wave = C_d\n\n        # Calculate G_local, the local field averaging factor.\n        # The formulas are derived from the integrals provided in the problem statement.\n        # Since w, sigma, w_s, and x_0 are all in mm, the units cancel out\n        # in the calculation of the dimensionless factor G_local.\n\n        # Special case: if sampling width w_s is zero, the integral is zero.\n        # To avoid division by zero, we handle this, although it's not in the test suite.\n        if w_s == 0:\n            # The value of g at a single point x_0.\n            # This requires computing K first.\n            if sigma == 0: # Avoid division by zero in arctan\n                g_local = 0.0 # Or some other defined behavior for this singularity\n            else:\n                K = w / (sigma * np.arctan(w / sigma))\n                g_local = K / (1 + (x_0 / sigma)**2)\n\n        elif sigma == 0: # Avoid division by zero in arctan\n            g_local = 0.0 # Or some other defined behavior\n\n        else:\n            # Full formula for G_local for w_s  0\n            # G_local = (w / (w_s * arctan(w/sigma))) * (arctan((x_0+w_s)/sigma) - arctan(x_0/sigma))\n            \n            # Use np.arctan for arctangent calculation (angles are in radians)\n            term_w_over_sigma = w / sigma\n            arctan_w_over_sigma = np.arctan(term_w_over_sigma)\n\n            term_x0_plus_ws_over_sigma = (x_0 + w_s) / sigma\n            arctan_x0_plus_ws_over_sigma = np.arctan(term_x0_plus_ws_over_sigma)\n\n            term_x0_over_sigma = x_0 / sigma\n            arctan_x0_over_sigma = np.arctan(term_x0_over_sigma)\n            \n            # Check for denominator becoming zero\n            if arctan_w_over_sigma == 0:\n                 # This would happen if w/sigma is 0, which implies w=0.\n                 # This case is physically not a microstrip.\n                 g_local = 1.0 # Or handle as an error\n            else:\n                factor1 = w / (w_s * arctan_w_over_sigma)\n                factor2 = arctan_x0_plus_ws_over_sigma - arctan_x0_over_sigma\n                g_local = factor1 * factor2\n\n        # The estimated capacitance for the lumped port is biased by 1/G_local.\n        # C_est,lump = C_d / G_local\n        # If G_local is zero, it implies sampling in a null, leading to infinite C_est.\n        if g_local == 0:\n            c_est_lump = float('inf')\n        else:\n            c_est_lump = C_d / g_local\n\n        results.append(c_est_wave)\n        results.append(c_est_lump)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from guided-wave structures to open-region radiation problems introduces new challenges for port definition and accuracy. This exercise tackles the practical limitations of \"radiation ports\" used to measure power flowing into free space in a finite computational domain . You will derive and implement a model that quantifies two primary sources of distortion: the effect of reflections from an imperfect absorbing boundary (PML) and the error introduced by measuring power through a truncated aperture that is smaller than the true radiating source.",
            "id": "3342254",
            "problem": "Consider a time-domain Finite-Difference Time-Domain (FDTD) simulation of electromagnetic radiation from a planar open aperture port in free space. The aperture lies in the plane $z = 0$ and radiates into the half-space $z  0$. The computational domain employs a Perfectly Matched Layer (PML) absorbing boundary at a normal distance $L$ from the aperture plane. The port is defined as the integral of the time-averaged Poynting vector through an aperture window of area $A_{\\text{trunc}}$ that may be smaller than the physical radiating area $A_{\\text{true}}$. The primary interest is the extracted radiated power versus frequency, and how it is distorted by aperture truncation and by non-ideal impedance matching at the absorbing boundary. Use the International System of Units (SI): length in meters, time in seconds, and frequency in Hertz. Angles must be measured in radians.\n\nStarting from Maxwell’s equations in a source-free, homogeneous, isotropic medium (free space), the plane-wave constitutive relations, and the definition of the time-averaged Poynting vector, derive the following elements purely from first principles:\n\n1. The expression for the true radiated power through the aperture in the ideal case where the absorbing boundary is perfectly matched and does not reflect. Assume a normally propagating, linearly polarized, time-harmonic plane wave field with electric field amplitude $E_0$ uniform over the aperture. Carefully justify every step using Maxwell’s equations and boundary conditions.\n\n2. When the absorbing boundary located at distance $L$ has a wave impedance $Z_b(f)$ that differs from the free-space impedance $Z_0$, derive the reflection coefficient at the boundary in terms of the impedances and explain how the reflected field contributes to the total field at the aperture plane. Use the propagation constant $k(f)$ of free space. Show how the phase accumulated by the round trip $z=0 \\to z=L \\to z=0$ enters the aperture field. Do not skip intermediate steps; explicitly connect the interference mechanism to Maxwell’s equations.\n\n3. Incorporate aperture truncation by expressing the measured port power through the truncated window of area $A_{\\text{trunc}}$ and compare it to the true radiated power through $A_{\\text{true}}$. Define the distortion ratio $D(f)$ as the ratio of the measured power to the true power, and express $D(f)$ in terms of $A_{\\text{trunc}}$, $A_{\\text{true}}$, the reflection coefficient magnitude and phase, and the propagation constant.\n\n4. For a computationally convenient parametric model of the absorbing boundary impedance error, take\n$$\nZ_b(f) = Z_0 \\left(1 + \\delta_0 \\left(\\frac{f}{f_{\\text{ref}}}\\right)^p\\right),\n$$\nwhere $\\delta_0$ is a dimensionless mismatch amplitude, $f_{\\text{ref}}$ is a reference frequency within the analysis band, and $p$ is a nonnegative real number modeling dispersion of the mismatch. Explain how to compute $D(f)$ over a frequency band $[f_{\\min}, f_{\\max}]$ sampled at $N$ uniformly spaced frequencies, and define a single scalar metric for distortion severity as the root-mean-square (RMS) of $D(f) - 1$ over the band:\n$$\n\\text{RMS} = \\sqrt{\\frac{1}{N} \\sum_{n=1}^{N} \\left(D(f_n) - 1\\right)^2}.\n$$\nThis RMS metric is dimensionless and must be reported as a decimal.\n\nConstants to be used:\n- Free-space speed of light $c = 299792458\\,\\text{m/s}$.\n- Free-space wave impedance $Z_0 = 376.730313668\\,\\Omega$.\n\nYour program must implement the derived formulas to compute the RMS distortion metric for each of the following test cases. In all cases, use the reference frequency $f_{\\text{ref}}$ equal to the midpoint of the analysis band:\n$$\nf_{\\text{ref}} = \\frac{f_{\\min} + f_{\\max}}{2}.\n$$\n\nTest suite (each tuple lists ($f_{\\min}, f_{\\max}, N, L, \\tau, \\delta_0, p$) where $\\tau = A_{\\text{trunc}}/A_{\\text{true}}$ is the truncation ratio):\n- Case 1 (happy path, no distortion): ($1.0 \\times 10^{9}\\,\\text{Hz}, 10.0 \\times 10^{9}\\,\\text{Hz}, 2001, 0.3\\,\\text{m}, 1.0, 0.0, 0$).\n- Case 2 (moderate mismatch and truncation): ($2.0 \\times 10^{9}\\,\\text{Hz}, 8.0 \\times 10^{9}\\,\\text{Hz}, 1601, 0.5\\,\\text{m}, 0.8, 0.05, 0$).\n- Case 3 (dispersive mismatch, stronger truncation, shorter boundary distance): ($0.5 \\times 10^{9}\\,\\text{Hz}, 5.0 \\times 10^{9}\\,\\text{Hz}, 2001, 0.1\\,\\text{m}, 0.6, 0.1, 1$).\n- Case 4 (edge case: boundary at the aperture plane, negative mismatch): ($1.0 \\times 10^{9}\\,\\text{Hz}, 10.0 \\times 10^{9}\\,\\text{Hz}, 2001, 0.0\\,\\text{m}, 0.9, -0.05, 0$).\n\nAll distances $L$ are in meters. All frequencies are in Hertz. Angles are in radians. The final output must be a single line containing the RMS distortion results for the four cases, as a comma-separated list enclosed in square brackets. For example:\n[rms_1,rms_2,rms_3,rms_4].\nEach $\\text{rms}_i$ must be a decimal number (dimensionless). No other text should be printed.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in Maxwell's theory, well-posed with a complete and consistent set of givens, and objective in its formulation. We proceed with a solution derived from first principles.\n\n### Part 1: True Radiated Power in the Ideal Case\n\nWe begin with the time-harmonic form of Maxwell's equations in a source-free, homogeneous, isotropic medium (free space with permittivity $\\epsilon_0$ and permeability $\\mu_0$):\n$$ \\nabla \\times \\vec{E} = -j\\omega\\vec{B} = -j\\omega\\mu_0\\vec{H} $$\n$$ \\nabla \\times \\vec{H} = j\\omega\\vec{D} = j\\omega\\epsilon_0\\vec{E} $$\nThe problem specifies a normally propagating, linearly polarized plane wave traveling in the $+z$ direction. We can write the electric field phasor as $\\vec{E}(z) = \\hat{x} E_0 e^{-jkz}$, where $E_0$ is the real amplitude, $\\omega = 2\\pi f$ is the angular frequency, and $k = \\omega\\sqrt{\\mu_0\\epsilon_0} = \\omega/c$ is the free-space wavenumber.\n\nFrom Faraday's law, we derive the magnetic field $\\vec{H}$:\n$$ \\nabla \\times \\vec{E} = \\hat{y} \\frac{\\partial E_x}{\\partial z} = \\hat{y} (-jk E_0 e^{-jkz}) $$\nEquating this to $-j\\omega\\mu_0\\vec{H}$, we get:\n$$ \\vec{H} = \\frac{-jk E_0 e^{-jkz}}{-j\\omega\\mu_0} \\hat{y} = \\frac{k}{\\omega\\mu_0} E_0 e^{-jkz} \\hat{y} $$\nThe ratio of the magnitudes of $\\vec{E}$ and $\\vec{H}$ for a plane wave is the intrinsic impedance of the medium. In free space, this is $Z_0 = \\sqrt{\\mu_0/\\epsilon_0} = \\omega\\mu_0/k$. Thus, the magnetic field is:\n$$ \\vec{H}(z) = \\hat{y} \\frac{E_0}{Z_0} e^{-jkz} $$\nThe time-averaged Poynting vector, representing power flow density, is given by $\\vec{S}_{\\text{avg}} = \\frac{1}{2} \\text{Re}\\{\\vec{E} \\times \\vec{H}^*\\}$, where $*$ denotes the complex conjugate.\n$$ \\vec{S}_{\\text{avg}} = \\frac{1}{2} \\text{Re} \\{ (\\hat{x} E_0 e^{-jkz}) \\times (\\hat{y} \\frac{E_0}{Z_0} e^{jkz}) \\} = \\frac{1}{2} \\text{Re} \\{ \\hat{z} \\frac{E_0^2}{Z_0} \\} = \\hat{z} \\frac{E_0^2}{2Z_0} $$\nThis power density is real and uniform. The ideal or \"true\" radiated power, $P_{\\text{true}}$, is the integral of this Poynting vector over the true physical aperture area, $A_{\\text{true}}$, at the plane $z=0$. The boundary is assumed to be perfectly matched, so there are no reflections.\n$$ P_{\\text{true}} = \\iint_{A_{\\text{true}}} \\vec{S}_{\\text{avg}} \\cdot d\\vec{A} = \\iint_{A_{\\text{true}}} \\left(\\hat{z} \\frac{E_0^2}{2Z_0}\\right) \\cdot (\\hat{z} dA) = \\frac{E_0^2}{2Z_0} A_{\\text{true}} $$\nThis is the reference power against which distortion is measured.\n\n### Part 2: Reflection from a Mismatched Boundary\n\nWhen the absorbing boundary at $z=L$ has an impedance $Z_b(f) \\neq Z_0$, a portion of the incident wave is reflected. The total field in the region $0 \\le z \\le L$ is a superposition of a forward wave (incident on the boundary) and a backward wave (reflected from the boundary).\n$$ E_x(z) = E_{\\text{inc}}(z) + E_{\\text{ref}}(z) = E_{\\text{fwd}} e^{-jkz} + E_{\\text{bwd}} e^{jkz} $$\nThe reflection coefficient $\\Gamma(f)$ at the boundary $z=L$ is the ratio of the reflected to incident electric field phasors. From transmission line theory, for normal incidence, this is:\n$$ \\Gamma(f) = \\frac{Z_b(f) - Z_0}{Z_b(f) + Z_0} $$\nThe reflected wave's amplitude at $z=L$ is $E_{\\text{ref}}(L) = \\Gamma(f) E_{\\text{inc}}(L)$. The total field at the aperture plane ($z=0$) is the sum of the incident wave, which we identify with the source field $E_0$, and the reflected wave which has traveled a round-trip distance of $2L$:\n$$ E_{x, \\text{aperture}}(f) = E_{\\text{inc}}(0) + E_{\\text{ref}}(0) = E_0 e^{-jk(0)} + [E_{\\text{ref}}(L) e^{-jkL}] e^{-jkL} $$\n$$ E_{x, \\text{aperture}}(f) = E_0 + [\\Gamma(f) E_{\\text{inc}}(L)] e^{-j2kL} = E_0 + [\\Gamma(f) (E_0 e^{-jkL})] e^{-jkL} = E_0 (1 + \\Gamma(f) e^{-j2kL}) $$\nThis expression shows how interference between the source wave and the reflected wave modifies the total field at the aperture. The phase factor $e^{-j2kL}$ arises from the round-trip propagation $z=0 \\to z=L \\to z=0$. The corresponding magnetic field at the aperture is $H_{y, \\text{aperture}}(f) = \\frac{E_0}{Z_0} (1 - \\Gamma(f) e^{-j2kL})$.\n\n### Part 3: Port Power Distortion Ratio\n\nThe definition of \"measured power\" in a time-domain simulation port can be ambiguous. While the net power flow is given by integrating $\\frac{1}{2}\\text{Re}\\{E \\times H^*\\}$, the problem's requirement to express the distortion $D(f)$ in terms of the phase of $\\Gamma(f)$ and the propagation constant $k(f)$ suggests a different interpretation. A common practice in FDTD analysis is to use a field probe and define the \"power\" as a quantity proportional to the squared magnitude of the total electric field, $|E_{x, \\text{aperture}}|^2$. This metric captures the standing wave effects. Adopting this interpretation, the measured power $P_{\\text{meas}}(f)$ through the truncated aperture $A_{\\text{trunc}}$ is:\n$$ P_{\\text{meas}}(f) \\propto A_{\\text{trunc}} |E_{x, \\text{aperture}}(f)|^2 = A_{\\text{trunc}} |E_0 (1 + \\Gamma(f) e^{-j2kL})|^2 $$\nTo find the constant of proportionality, we require that for the ideal case ($\\Gamma=0$, $A_{\\text{trunc}}=A_{\\text{true}}$), the measured power equals the true power.\n$$ P_{\\text{true}} = \\text{const} \\cdot A_{\\text{true}} |E_0|^2 \\implies \\frac{E_0^2 A_{\\text{true}}}{2Z_0} = \\text{const} \\cdot A_{\\text{true}} E_0^2 \\implies \\text{const} = \\frac{1}{2Z_0} $$\nSo, the model for measured power is $P_{\\text{meas}}(f) = \\frac{A_{\\text{trunc}}}{2Z_0} |E_0 (1 + \\Gamma(f) e^{-j2kL})|^2$.\nThe distortion ratio $D(f)$ is the ratio of measured power to true power:\n$$ D(f) = \\frac{P_{\\text{meas}}(f)}{P_{\\text{true}}} = \\frac{\\frac{A_{\\text{trunc}}}{2Z_0} E_0^2 |1 + \\Gamma(f) e^{-j2kL}|^2}{\\frac{A_{\\text{true}}}{2Z_0} E_0^2} $$\nLetting $\\tau = A_{\\text{trunc}}/A_{\\text{true}}$ be the truncation ratio, we get:\n$$ D(f) = \\tau |1 + \\Gamma(f) e^{-j2k(f)L}|^2 $$\nLet $\\Gamma(f) = |\\Gamma(f)|e^{j\\phi_{\\Gamma}(f)}$. The term inside the magnitude squared can be expanded:\n$$ |1 + \\Gamma e^{-j2kL}|^2 = |1 + |\\Gamma|e^{j\\phi_{\\Gamma}}e^{-j2kL}|^2 = |1 + |\\Gamma|e^{j(\\phi_{\\Gamma} - 2kL)}|^2 $$\n$$ = (1 + |\\Gamma|\\cos(\\phi_{\\Gamma} - 2kL))^2 + (|\\Gamma|\\sin(\\phi_{\\Gamma} - 2kL))^2 $$\n$$ = 1 + 2|\\Gamma|\\cos(\\phi_{\\Gamma} - 2kL) + |\\Gamma|^2\\cos^2(\\phi_{\\Gamma} - 2kL) + |\\Gamma|^2\\sin^2(\\phi_{\\Gamma} - 2kL) $$\n$$ = 1 + |\\Gamma|^2 + 2|\\Gamma|\\cos(\\phi_{\\Gamma}(f) - \\frac{4\\pi f L}{c}) $$\nThe final expression for the distortion ratio is:\n$$ D(f) = \\tau \\left[ 1 + |\\Gamma(f)|^2 + 2|\\Gamma(f)|\\cos\\left(\\phi_{\\Gamma}(f) - \\frac{4\\pi f L}{c}\\right) \\right] $$\n\n### Part 4: Parametric Model and RMS Algorithm\n\nThe boundary impedance is given by the parametric model $Z_b(f) = Z_0 (1 + \\delta_0 (f/f_{\\text{ref}})^p)$. The reflection coefficient is:\n$$ \\Gamma(f) = \\frac{Z_0 (1 + \\delta_0 (f/f_{\\text{ref}})^p) - Z_0}{Z_0 (1 + \\delta_0 (f/f_{\\text{ref}})^p) + Z_0} = \\frac{\\delta_0 (f/f_{\\text{ref}})^p}{2 + \\delta_0 (f/f_{\\text{ref}})^p} $$\nSince $\\delta_0$ and $p$ are given as real numbers, $\\Gamma(f)$ is real for all $f$. Its phase $\\phi_{\\Gamma}(f)$ is therefore either $0$ (if $\\Gamma(f)  0$) or $\\pi$ (if $\\Gamma(f)  0$).\n\nThe distortion severity over the frequency band $[f_{\\min}, f_{\\max}]$ is quantified by the RMS metric:\n$$ \\text{RMS} = \\sqrt{\\frac{1}{N} \\sum_{n=1}^{N} \\left(D(f_n) - 1\\right)^2} $$\nThe algorithm to compute this metric is as follows:\n1.  Define the constants $c = 299792458\\,\\text{m/s}$.\n2.  For a given test case ($f_{\\min}, f_{\\max}, N, L, \\tau, \\delta_0, p$):\n3.  Create an array of $N$ frequencies $f_n$ uniformly spaced from $f_{\\min}$ to $f_{\\max}$.\n4.  Calculate the reference frequency $f_{\\text{ref}} = (f_{\\min} + f_{\\max})/2$.\n5.  For each frequency $f_n$, calculate $M(f_n) = \\delta_0 (f_n/f_{\\text{ref}})^p$.\n6.  Calculate the reflection coefficient array $\\Gamma(f_n) = M(f_n) / (2 + M(f_n))$.\n7.  Determine the magnitude $|\\Gamma(f_n)|$ and phase $\\phi_{\\Gamma}(f_n)$ (either $0$ or $\\pi$).\n8.  Calculate the distortion ratio array $D(f_n)$ using the formula derived in Part 3.\n9.  Compute the error term $(D(f_n) - 1)$.\n10. Calculate the mean of the squared errors and take the square root to find the RMS value.\nThis procedure is implemented in the provided Python code.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RMS distortion metric for port power measurements in an FDTD simulation\n    for a series of test cases.\n    \"\"\"\n    # Define physical constants\n    c = 299792458.0  # Speed of light in vacuum, m/s\n\n    # Each tuple lists (f_min, f_max, N, L, tau, delta_0, p)\n    # tau is the truncation ratio A_trunc / A_true\n    test_cases = [\n        # Case 1 (happy path, no distortion)\n        (1.0e9, 10.0e9, 2001, 0.3, 1.0, 0.0, 0),\n        # Case 2 (moderate mismatch and truncation)\n        (2.0e9, 8.0e9, 1601, 0.5, 0.8, 0.05, 0),\n        # Case 3 (dispersive mismatch, stronger truncation, shorter boundary distance)\n        (0.5e9, 5.0e9, 2001, 0.1, 0.6, 0.1, 1),\n        # Case 4 (edge case: boundary at the aperture plane, negative mismatch)\n        (1.0e9, 10.0e9, 2001, 0.0, 0.9, -0.05, 0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        f_min, f_max, N, L, tau, delta_0, p = case\n\n        # Step 1: Create frequency vector\n        freqs = np.linspace(f_min, f_max, N)\n        \n        # Step 2: Calculate reference frequency\n        f_ref = (f_min + f_max) / 2.0\n\n        # Step 3: Calculate the frequency-dependent reflection coefficient Gamma(f)\n        # Handle the case where the happy path has delta_0 = 0.\n        if delta_0 == 0.0:\n            Gamma_f = np.zeros_like(freqs)\n        else:\n            # Parametric model term M(f)\n            # Handle f_ref=0 case to avoid division by zero, though not hit by test cases.\n            if f_ref == 0:\n                 f_ratio = np.zeros_like(freqs)\n            else:\n                 f_ratio = freqs / f_ref\n            \n            M_f = delta_0 * (f_ratio ** p)\n            Gamma_f = M_f / (2.0 + M_f)\n        \n        # Step 4: Calculate magnitude and phase of Gamma\n        Gamma_mag = np.abs(Gamma_f)\n        # Phase is 0 if Gamma is positive, pi if Gamma is negative\n        phi_Gamma = np.where(Gamma_f  0, np.pi, 0.0)\n\n        # Step 5: Calculate the distortion ratio D(f)\n        # Phase delay term due to round trip propagation\n        # k = 2*pi*f/c, so 2*k*L = 4*pi*f*L/c\n        phase_term = phi_Gamma - (4.0 * np.pi * freqs * L / c)\n        \n        # D(f) = tau * |1 + Gamma * exp(-j*2*k*L)|^2\n        #      = tau * (1 + |Gamma|^2 + 2*|Gamma|*cos(phi_Gamma - 2*k*L))\n        D_f = tau * (1.0 + Gamma_mag**2 + 2.0 * Gamma_mag * np.cos(phase_term))\n        \n        # Step 6: Calculate the RMS distortion metric\n        errors = D_f - 1.0\n        rms_distortion = np.sqrt(np.mean(errors**2))\n        \n        results.append(rms_distortion)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}