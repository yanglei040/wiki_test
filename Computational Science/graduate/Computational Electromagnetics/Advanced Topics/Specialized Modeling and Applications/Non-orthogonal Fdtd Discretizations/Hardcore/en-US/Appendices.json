{
    "hands_on_practices": [
        {
            "introduction": "Understanding non-orthogonal discretizations begins with mastering how continuous differential operators are translated into discrete forms. This first practice provides a concrete, hands-on exercise in constructing the fundamental building blocks of discrete calculus on a simple 2D skewed cell. By creating the incidence matrices that represent the discrete gradient and curl, you will gain a practical understanding of how geometric connectivity and orientation are encoded, a crucial first step before tackling full 3D simulations. ",
            "id": "3334470",
            "problem": "Consider a two-dimensional non-orthogonal cell used in Finite-Difference Time-Domain (FDTD) discretizations on skewed grids. The cell is a single convex quadrilateral with labeled nodes, edges, and one face. The nodes are labeled counterclockwise and have Cartesian coordinates\n$$\nn_1=(0,0),\\quad n_2=(2,0.5),\\quad n_3=(2.2,1.7),\\quad n_4=(0,1.5).\n$$\nDefine four oriented edges along the polygon boundary,\n$$\ne_1: n_1 \\to n_2,\\quad e_2: n_2 \\to n_3,\\quad e_3: n_3 \\to n_4,\\quad e_4: n_4 \\to n_1,\n$$\nand let the single face be oriented counterclockwise so that its boundary orientation is $n_1 \\to n_2 \\to n_3 \\to n_4 \\to n_1$. \n\n1) Construct explicitly the node–edge incidence matrix $G$ that maps a node-based scalar field to oriented edge differences, and the face–edge incidence matrix $C$ that maps oriented edge values to the oriented boundary sum around the face. Use the stated orientations and ordering $\\{n_1,n_2,n_3,n_4\\}$ for nodes, $\\{e_1,e_2,e_3,e_4\\}$ for edges, and the single face $\\{f_1\\}$.\n\n2) Starting from Faraday’s law in integral form and Stokes’ theorem, explain how the average out-of-plane component of the discrete curl of the electric field over the face can be computed from the oriented circulation around the boundary divided by the face area.\n\nNow suppose the edge field represents the line-integrated tangential electric field (voltage) along each oriented edge, given (in volts) by\n$$\ne_1=3.0,\\quad e_2=-1.5,\\quad e_3=0.8,\\quad e_4=2.7.\n$$\nCompute the average out-of-plane discrete curl over the face using these edge values and the stated orientation conventions. Express your final numerical answer in $\\mathrm{V}\\,\\mathrm{m}^{-2}$ and round your answer to four significant figures.",
            "solution": "The problem statement has been validated and found to be scientifically sound, well-posed, and objective. It is grounded in the established principles of computational electromagnetics and discrete calculus on manifolds. The provided data is complete and consistent, allowing for a unique and meaningful solution. We may therefore proceed.\n\nThe problem is addressed in three parts: construction of incidence matrices, theoretical explanation of the discrete curl, and numerical computation.\n\n**1) Construction of Incidence Matrices**\n\nThe problem requires the construction of two incidence matrices, $G$ and $C$, which represent discrete differential operators (gradient and curl, respectively) on the given quadrilateral cell.\n\nThe node–edge incidence matrix, $G$, maps a scalar potential field defined on the nodes to a vector field of differences defined on the oriented edges. It is often referred to as the discrete gradient operator. The matrix $G$ has dimensions $N_e \\times N_n$, where $N_e=4$ is the number of edges and $N_n=4$ is the number of nodes. The entry $G_{ij}$ is $+1$ if node $j$ is the head of edge $i$, $-1$ if it is the tail, and $0$ otherwise. The nodes are ordered $\\{n_1, n_2, n_3, n_4\\}$ and the edges are ordered $\\{e_1, e_2, e_3, e_4\\}$.\n\n- For edge $e_1: n_1 \\to n_2$, the corresponding row vector is $(-1, 1, 0, 0)$.\n- For edge $e_2: n_2 \\to n_3$, the corresponding row vector is $(0, -1, 1, 0)$.\n- For edge $e_3: n_3 \\to n_4$, the corresponding row vector is $(0, 0, -1, 1)$.\n- For edge $e_4: n_4 \\to n_1$, the corresponding row vector is $(1, 0, 0, -1)$.\n\nAssembling these rows gives the node–edge incidence matrix $G$:\n$$\nG = \\begin{pmatrix}\n-1 & 1 & 0 & 0 \\\\\n0 & -1 & 1 & 0 \\\\\n0 & 0 & -1 & 1 \\\\\n1 & 0 & 0 & -1\n\\end{pmatrix}\n$$\n\nThe face–edge incidence matrix, $C$, maps an oriented edge field to a scalar field on the faces, representing the oriented boundary sum (circulation) for each face. It is related to the discrete curl operator. The matrix $C$ has dimensions $N_f \\times N_e$, where $N_f=1$ is the number of faces and $N_e=4$ is the number of edges. The entry $C_{ij}$ is $+1$ if edge $j$ has the same orientation as the boundary of face $i$, $-1$ if it has the opposite orientation, and $0$ if it is not on the boundary.\n\nWe have one face, $f_1$, with a counterclockwise boundary orientation $n_1 \\to n_2 \\to n_3 \\to n_4 \\to n_1$. We compare the orientation of each edge to this boundary traversal:\n- Edge $e_1: n_1 \\to n_2$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_2: n_2 \\to n_3$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_3: n_3 \\to n_4$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_4: n_4 \\to n_1$ matches the boundary orientation. The entry is $+1$.\n\nThus, the face–edge incidence matrix $C$ is a $1 \\times 4$ row matrix:\n$$\nC = \\begin{pmatrix}\n1 & 1 & 1 & 1\n\\end{pmatrix}\n$$\n\n**2) Discrete Curl from Stokes' Theorem**\n\nFaraday's law of induction in integral form states that the circulation of the electric field $\\mathbf{E}$ around a closed loop $\\partial\\Sigma$ is equal to the negative time rate of change of the magnetic flux through the surface $\\Sigma$ bounded by the loop:\n$$\n\\oint_{\\partial\\Sigma} \\mathbf{E} \\cdot d\\mathbf{l} = - \\frac{d}{dt} \\iint_{\\Sigma} \\mathbf{B} \\cdot d\\mathbf{S}\n$$\nBy the classical Stokes' theorem, the circulation of a vector field is also equal to the flux of its curl through the enclosed surface:\n$$\n\\oint_{\\partial\\Sigma} \\mathbf{E} \\cdot d\\mathbf{l} = \\iint_{\\Sigma} (\\nabla \\times \\mathbf{E}) \\cdot d\\mathbf{S}\n$$\nIn the context of a discrete FDTD grid, these continuum integrals are approximated. For a single planar face $f$ in the $xy$-plane with area $A_f$, the surface integral of the curl's component normal to the face (the out-of-plane or $z$-component) is approximated by the product of the average value of this component over the face and the face area:\n$$\n\\iint_{f} (\\nabla \\times \\mathbf{E}) \\cdot d\\mathbf{S} = \\iint_{f} (\\nabla \\times \\mathbf{E})_z dA \\approx \\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f A_f\n$$\nThe line integral, or circulation, is approximated by summing the line-integrated tangential electric field components along each bounding edge. The problem provides these values directly as the edge fields $e_i$. The sum must account for the orientation of each edge relative to the counterclockwise boundary traversal of the face.\n$$\n\\oint_{\\partial f} \\mathbf{E} \\cdot d\\mathbf{l} \\approx \\sum_{i} s_i e_i\n$$\nwhere $s_i = +1$ if edge $i$ is aligned with the boundary path and $s_i = -1$ if it is opposed. This sum is precisely the circulation, which can be computed as the matrix product of $C$ and the column vector of edge fields.\n\nEquating the discrete approximations of the two sides of Stokes' theorem yields:\n$$\n\\text{Circulation} = \\sum_{i} s_i e_i \\approx \\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f A_f\n$$\nTherefore, the average out-of-plane component of the discrete curl of the electric field over the face is computed as the ratio of the total oriented circulation around the face boundary to the area of the face:\n$$\n\\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f = \\frac{\\text{Circulation}}{A_f}\n$$\n\n**3) Numerical Computation**\n\nFirst, we compute the circulation around the face using the given edge field values: $e_1=3.0\\,\\mathrm{V}$, $e_2=-1.5\\,\\mathrm{V}$, $e_3=0.8\\,\\mathrm{V}$, $e_4=2.7\\,\\mathrm{V}$. As established in Part 1, all edges $e_1, e_2, e_3, e_4$ are oriented in the same direction as the counterclockwise boundary of the face. Thus, the circulation is the direct sum of the edge values:\n$$\n\\text{Circulation} = e_1 + e_2 + e_3 + e_4 = 3.0 - 1.5 + 0.8 + 2.7 = 5.0\\,\\mathrm{V}\n$$\nNext, we compute the area of the quadrilateral face defined by the nodes $n_1=(0,0)$, $n_2=(2,0.5)$, $n_3=(2.2,1.7)$, and $n_4=(0,1.5)$. We use the shoelace formula for the area of a polygon with vertices $(x_i, y_i)$:\n$$\nA_f = \\frac{1}{2} |(x_1y_2 + x_2y_3 + x_3y_4 + x_4y_1) - (y_1x_2 + y_2x_3 + y_3x_4 + y_4x_1)|\n$$\nSubstituting the node coordinates, and assuming the coordinates are in meters ($\\mathrm{m}$), we get:\n$$\nx_1y_2 = 0 \\times 0.5 = 0\n\\quad\nx_2y_3 = 2 \\times 1.7 = 3.4\n\\quad\nx_3y_4 = 2.2 \\times 1.5 = 3.3\n\\quad\nx_4y_1 = 0 \\times 0 = 0\n$$\n$$\ny_1x_2 = 0 \\times 2 = 0\n\\quad\ny_2x_3 = 0.5 \\times 2.2 = 1.1\n\\quad\ny_3x_4 = 1.7 \\times 0 = 0\n\\quad\ny_4x_1 = 1.5 \\times 0 = 0\n$$\nThe area is then:\n$$\nA_f = \\frac{1}{2} |(0 + 3.4 + 3.3 + 0) - (0 + 1.1 + 0 + 0)| = \\frac{1}{2} |6.7 - 1.1| = \\frac{1}{2} (5.6) = 2.8\\,\\mathrm{m}^2\n$$\nFinally, we compute the average out-of-plane discrete curl:\n$$\n\\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f = \\frac{5.0\\,\\mathrm{V}}{2.8\\,\\mathrm{m}^2} = \\frac{50}{28}\\,\\mathrm{V}\\,\\mathrm{m}^{-2} = \\frac{25}{14}\\,\\mathrm{V}\\,\\mathrm{m}^{-2} \\approx 1.785714...\\,\\mathrm{V}\\,\\mathrm{m}^{-2}\n$$\nRounding the result to four significant figures as requested gives $1.786\\,\\mathrm{V}\\,\\mathrm{m}^{-2}$.",
            "answer": "$$\\boxed{1.786}$$"
        },
        {
            "introduction": "After defining the discrete curl, the next step is to verify its correctness, a crucial practice in computational methods development. This exercise extends the concept of discrete curl to a 3D parallelepiped and introduces a powerful verification technique using a manufactured solution. By comparing the result of your discrete operator against a known analytical solution, you will not only confirm your implementation but also gain insight into the geometric exactness of the discrete Stokes' theorem for polynomial fields. ",
            "id": "3334394",
            "problem": "Consider a single hexahedral cell in a non-orthogonal Finite-Difference Time-Domain (FDTD) discretization. The cell is assumed to be a parallelepiped defined by three linearly independent edge vectors $ \\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3 \\in \\mathbb{R}^3 $ emanating from a base point $ \\mathbf{r}_0 \\in \\mathbb{R}^3 $. Let the three oriented faces adjacent to $ \\mathbf{r}_0 $ be the parallelograms spanned by the ordered pairs $ (\\mathbf{a}_2,\\mathbf{a}_3) $, $ (\\mathbf{a}_3,\\mathbf{a}_1) $, and $ (\\mathbf{a}_1,\\mathbf{a}_2) $. For any ordered pair $ (\\mathbf{u},\\mathbf{v}) $ spanning a face, define the (not necessarily unit) face normal as $ \\mathbf{n} = \\mathbf{u} \\times \\mathbf{v} $.\n\nYour tasks are:\n\n- Derive, from first principles, a discrete curl operator on an oblique cell that maps edge line integrals of a vector field $ \\mathbf{A}(\\mathbf{r}) $ to the face-normal average of $ \\nabla \\times \\mathbf{A} $ on each face. Start from vector calculus and integral laws that are fundamental to computational electromagnetics, without assuming any orthogonality of $ \\mathbf{a}_i $. Express the result in terms of oriented line integrals of $ \\mathbf{A} $ around each face and the face normal $ \\mathbf{n} $, making all geometric dependencies explicit.\n\n- Implement the resulting discrete operator to compute, for each face, the scalar face-normal average\n$$ \\bar{c} \\equiv \\frac{1}{\\lVert \\mathbf{n} \\rVert} \\iint_{\\text{face}} \\left( \\nabla \\times \\mathbf{A}(\\mathbf{r}) \\right) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S, $$\nwhere $ \\hat{\\mathbf{n}} = \\mathbf{n} / \\lVert \\mathbf{n} \\rVert $, using the oriented boundary line integral of $ \\mathbf{A} $ and Stokes' theorem. The boundary orientation must be consistent with the right-hand rule relative to $ \\mathbf{n} $.\n\n- Verify the accuracy of your discrete curl by applying it to a known solenoidal field constructed as $ \\mathbf{E} = \\nabla \\times \\mathbf{A} $ for a specific polynomial vector potential $ \\mathbf{A}(\\mathbf{r}) $. Use\n$$ \\mathbf{A}(\\mathbf{r}) = \\begin{bmatrix} \\alpha \\, x y \\\\ \\beta \\, y z \\\\ \\gamma \\, z x \\end{bmatrix}, $$\nso that\n$$ \\mathbf{E}(\\mathbf{r}) = \\nabla \\times \\mathbf{A}(\\mathbf{r}) = \\begin{bmatrix} - \\beta \\, y \\\\ - \\gamma \\, z \\\\ - \\alpha \\, x \\end{bmatrix}. $$\nFor a planar face, this $ \\mathbf{E}(\\mathbf{r}) $ is linear in $ \\mathbf{r} $, so its exact face-normal average equals its value at the face centroid. Thus, for each face with centroid $ \\mathbf{r}_c $, the exact average is\n$$ \\bar{c}_{\\text{exact}} = \\mathbf{E}(\\mathbf{r}_c) \\cdot \\hat{\\mathbf{n}}. $$\n\n- For each cell listed in the test suite below, compute the maximum absolute error over the three faces adjacent to $ \\mathbf{r}_0 $,\n$$ \\varepsilon_{\\max} = \\max_{j \\in \\{1,2,3\\}} \\left| \\bar{c}_{\\text{disc},j} - \\bar{c}_{\\text{exact},j} \\right|, $$\nwhere $ \\bar{c}_{\\text{disc},j} $ is obtained from your discrete curl via the oriented boundary integral divided by the face area magnitude $ \\lVert \\mathbf{n}_j \\rVert $. Report one floating-point number $ \\varepsilon_{\\max} $ per test case.\n\nFundamental base you must use:\n\n- Vector calculus identity (Stokes' theorem): For sufficiently smooth $ \\mathbf{A} $, and any oriented smooth surface $ S $ with boundary $ \\partial S $, \n$$ \\iint_{S} (\\nabla \\times \\mathbf{A}) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S = \\oint_{\\partial S} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l}. $$\n\n- Geometry of a parallelogram face with spanning vectors $ \\mathbf{u}, \\mathbf{v} $: the (not unit) normal is $ \\mathbf{n} = \\mathbf{u} \\times \\mathbf{v} $, the area magnitude is $ \\lVert \\mathbf{n} \\rVert $, the centroid is located at $ \\mathbf{r}_c = \\mathbf{r}_\\text{base} + \\tfrac{1}{2}\\mathbf{u} + \\tfrac{1}{2}\\mathbf{v} $ for any base point $ \\mathbf{r}_\\text{base} $ on the face, and the positive boundary orientation follows the right-hand rule relative to $ \\mathbf{n} $.\n\nImplementation instructions:\n\n- Use the oriented boundary consisting of four straight edges for each face spanned by $ (\\mathbf{u},\\mathbf{v}) $ with base point $ \\mathbf{r}_\\text{base} $:\n    - Edge $ \\mathbf{e}_1 $: from $ \\mathbf{r}_\\text{base} $ along $ \\mathbf{u} $,\n    - Edge $ \\mathbf{e}_2 $: from $ \\mathbf{r}_\\text{base} + \\mathbf{u} $ along $ \\mathbf{v} $,\n    - Edge $ \\mathbf{e}_3 $: from $ \\mathbf{r}_\\text{base} + \\mathbf{u} + \\mathbf{v} $ along $ -\\mathbf{u} $,\n    - Edge $ \\mathbf{e}_4 $: from $ \\mathbf{r}_\\text{base} + \\mathbf{v} $ along $ -\\mathbf{v} $.\n  The discrete face-normal average is the scalar\n  $$ \\bar{c}_{\\text{disc}} = \\frac{1}{\\lVert \\mathbf{u} \\times \\mathbf{v} \\rVert} \\sum_{k=1}^{4} \\int_{0}^{1} \\mathbf{A}\\big(\\mathbf{r}_k(t)\\big) \\cdot \\mathbf{v}_k \\, \\mathrm{d}t, $$\n  where $ \\mathbf{r}_k(t) = \\mathbf{p}_k + t \\, \\mathbf{v}_k $ parametrizes edge $ k $ with start point $ \\mathbf{p}_k $ and direction $ \\mathbf{v}_k $.\n\n- Use the parameters $ \\alpha = 1.3 $, $ \\beta = -0.7 $, and $ \\gamma = 0.9 $.\n\nTest suite:\n\nFor each case, you are given $ \\mathbf{r}_0 $, $ \\mathbf{a}_1 $, $ \\mathbf{a}_2 $, $ \\mathbf{a}_3 $. For each case, compute $ \\varepsilon_{\\max} $ over the three faces adjacent to $ \\mathbf{r}_0 $: $ (\\mathbf{a}_2,\\mathbf{a}_3) $, $ (\\mathbf{a}_3,\\mathbf{a}_1) $, $ (\\mathbf{a}_1,\\mathbf{a}_2) $.\n\n- Case $ 1 $ (general oblique):\n  - $ \\mathbf{r}_0 = (0.2, -0.1, 0.3) $,\n  - $ \\mathbf{a}_1 = (0.7, 0.1, 0.0) $,\n  - $ \\mathbf{a}_2 = (0.2, 0.8, 0.1) $,\n  - $ \\mathbf{a}_3 = (0.1, 0.0, 0.9) $.\n\n- Case $ 2 $ (orthogonal cube):\n  - $ \\mathbf{r}_0 = (0.0, 0.0, 0.0) $,\n  - $ \\mathbf{a}_1 = (1.0, 0.0, 0.0) $,\n  - $ \\mathbf{a}_2 = (0.0, 1.0, 0.0) $,\n  - $ \\mathbf{a}_3 = (0.0, 0.0, 1.0) $.\n\n- Case $ 3 $ (highly skewed but non-degenerate):\n  - $ \\mathbf{r}_0 = (-0.3, 0.4, -0.2) $,\n  - $ \\mathbf{a}_1 = (1.0, 0.0, 0.0) $,\n  - $ \\mathbf{a}_2 = (0.999, 0.001, 0.0) $,\n  - $ \\mathbf{a}_3 = (0.001, 0.002, 1.0) $.\n\n- Case $ 4 $ (scaled and oblique):\n  - $ \\mathbf{r}_0 = (0.5, -0.6, 0.1) $,\n  - $ \\mathbf{a}_1 = (2.0, 0.5, 0.3) $,\n  - $ \\mathbf{a}_2 = (-0.1, 3.0, 0.4) $,\n  - $ \\mathbf{a}_3 = (0.2, 0.1, 1.5) $.\n\nRequired program output format:\n\n- Your program should produce a single line of output containing a list with the four $ \\varepsilon_{\\max} $ values for Cases $ 1 $ through $ 4 $ in order, as a comma-separated list enclosed in square brackets, for example $ [\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4] $. The entries must be floating-point numbers. No additional text or lines should be printed.",
            "solution": "The task is to derive and implement a discrete curl operator for a non-orthogonal hexahedral cell face and to verify its accuracy using a specific vector potential for which an exact analytical solution is known. The process begins with the fundamental integral form of Stokes' theorem.\n\n### Derivation of the Discrete Curl Operator\n\nLet $S$ be a planar, oriented surface, which in this problem is a parallelogram face of the cell, with a boundary curve $\\partial S$. For a sufficiently smooth vector field $\\mathbf{A}(\\mathbf{r})$, Stokes' theorem states:\n$$ \\iint_{S} (\\nabla \\times \\mathbf{A}) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S = \\oint_{\\partial S} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} $$\nwhere $\\hat{\\mathbf{n}}$ is the unit normal vector to the surface $S$, and the orientation of the boundary path $\\partial S$ is determined by the right-hand rule with respect to $\\hat{\\mathbf{n}}$.\n\nThe problem requests the scalar face-normal average of the curl, defined as:\n$$ \\bar{c} \\equiv \\frac{1}{\\lVert \\mathbf{n} \\rVert} \\iint_{S} \\left( \\nabla \\times \\mathbf{A}(\\mathbf{r}) \\right) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S $$\nHere, the non-unit normal is $\\mathbf{n} = \\mathbf{u} \\times \\mathbf{v}$ for a face spanned by vectors $\\mathbf{u}$ and $\\mathbf{v}$. The area of the face is $A = \\lVert \\mathbf{n} \\rVert$, and $\\hat{\\mathbf{n}} = \\mathbf{n} / \\lVert \\mathbf{n} \\rVert$. Substituting Stokes' theorem into this definition yields a discrete representation of the average curl based on a line integral around the face boundary:\n$$ \\bar{c}_{\\text{disc}} = \\frac{1}{\\lVert \\mathbf{n} \\rVert} \\oint_{\\partial S} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} $$\nThis expression forms the basis of the discrete curl operator in many finite difference and finite volume methods, including the non-orthogonal FDTD method. The boundary $\\partial S$ of a parallelogram face is composed of four straight edges. Let the face be spanned by vectors $\\mathbf{u}$ and $\\mathbf{v}$ originating from a base point $\\mathbf{r}_{\\text{base}}$. The vertices are $\\mathbf{p}_0 = \\mathbf{r}_{\\text{base}}$, $\\mathbf{p}_1 = \\mathbf{r}_{\\text{base}} + \\mathbf{u}$, $\\mathbf{p}_2 = \\mathbf{r}_{\\text{base}} + \\mathbf{u} + \\mathbf{v}$, and $\\mathbf{p}_3 = \\mathbf{r}_{\\text{base}} + \\mathbf{v}$. The oriented boundary path, consistent with the normal $\\mathbf{n} = \\mathbf{u} \\times \\mathbf{v}$, is $\\mathbf{p}_0 \\to \\mathbf{p}_1 \\to \\mathbf{p}_2 \\to \\mathbf{p}_3 \\to \\mathbf{p}_0$.\n\nThe line integral is the sum of integrals over the four edges:\n$$ \\oint_{\\partial S} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} = \\int_{\\mathbf{p}_0}^{\\mathbf{p}_1} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} + \\int_{\\mathbf{p}_1}^{\\mathbf{p}_2} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} + \\int_{\\mathbf{p}_2}^{\\mathbf{p}_3} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} + \\int_{\\mathbf{p}_3}^{\\mathbf{p}_0} \\mathbf{A} \\cdot \\mathrm{d}\\mathbf{l} $$\nTo compute each integral, we parametrize a generic edge starting at $\\mathbf{p}_{\\text{start}}$ with direction vector $\\mathbf{v}_{\\text{edge}}$ as $\\mathbf{r}(t) = \\mathbf{p}_{\\text{start}} + t \\mathbf{v}_{\\text{edge}}$ for $t \\in [0, 1]$. The integral becomes:\n$$ \\int_{0}^{1} \\mathbf{A}(\\mathbf{p}_{\\text{start}} + t \\mathbf{v}_{\\text{edge}}) \\cdot \\mathbf{v}_{\\text{edge}} \\, \\mathrm{d}t $$\nThe given vector potential is $\\mathbf{A}(\\mathbf{r}) = [\\alpha xy, \\beta yz, \\gamma zx]^T$. Substituting the parametrization $\\mathbf{r}(t) = (x(t), y(t), z(t))$ where $x(t)$, $y(t)$, and $z(t)$ are linear functions of $t$, the components of $\\mathbf{A}$ become quadratic functions of $t$. The integrand $\\mathbf{A}(\\mathbf{r}(t)) \\cdot \\mathbf{v}_{\\text{edge}}$ is therefore a quadratic polynomial in $t$, of the form $C_2 t^2 + C_1 t + C_0$. The definite integral can be calculated exactly:\n$$ \\int_0^1 (C_2 t^2 + C_1 t + C_0) \\, \\mathrm{d}t = \\frac{C_2}{3} + \\frac{C_1}{2} + C_0 $$\nwhere the coefficients $C_0, C_1, C_2$ are derived from the components of $\\mathbf{p}_{\\text{start}}$ and $\\mathbf{v}_{\\text{edge}}$.\n\n### Verification Using an Exact Solution\n\nThe accuracy of this discrete operator is verified using a case where the exact average curl is known. The curl of the given vector potential is:\n$$ \\mathbf{E}(\\mathbf{r}) = \\nabla \\times \\mathbf{A}(\\mathbf{r}) = \\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ \\frac{\\partial}{\\partial x} & \\frac{\\partial}{\\partial y} & \\frac{\\partial}{\\partial z} \\\\ \\alpha xy & \\beta yz & \\gamma zx \\end{vmatrix} = [-\\beta y, -\\gamma z, -\\alpha x]^T $$\nThis field $\\mathbf{E}(\\mathbf{r})$ is a linear function of the spatial coordinates $(x, y, z)$. For any planar region, the integral of a linear function over the region is exactly equal to the function's value at the region's centroid multiplied by the region's area. Therefore, the exact average of the normal component of $\\mathbf{E}(\\mathbf{r})$ over the face $S$ is:\n$$ \\bar{c}_{\\text{exact}} = \\frac{1}{\\lVert \\mathbf{n} \\rVert} \\iint_{S} \\mathbf{E}(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}} \\, \\mathrm{d}S = \\mathbf{E}(\\mathbf{r}_c) \\cdot \\hat{\\mathbf{n}} $$\nwhere $\\mathbf{r}_c$ is the centroid of the parallelogram face. For a face spanned by $\\mathbf{u}$ and $\\mathbf{v}$ from base $\\mathbf{r}_{\\text{base}}$, the centroid is $\\mathbf{r}_c = \\mathbf{r}_{\\text{base}} + \\frac{1}{2}(\\mathbf{u}+\\mathbf{v})$.\n\nSince Stokes' theorem is an exact identity, and since the line integral of $\\mathbf{A}$ is calculated analytically, the discrete value $\\bar{c}_{\\text{disc}}$ should be exactly equal to the true surface integral of $\\nabla \\times \\mathbf{A}$. Because this surface integral itself is exactly $\\mathbf{E}(\\mathbf{r}_c) \\cdot \\hat{\\mathbf{n}} \\lVert \\mathbf{n} \\rVert$, we must have $\\bar{c}_{\\text{disc}} = \\bar{c}_{\\text{exact}}$. The numerical test, therefore, serves to verify the correct implementation of both calculations, with any resulting non-zero error $\\varepsilon = |\\bar{c}_{\\text{disc}} - \\bar{c}_{\\text{exact}}|$ attributable to floating-point precision limits.\n\n### Algorithm Summary\n\nFor each test case defined by ($\\mathbf{r}_0, \\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$):\n$1$. Identify the three faces adjacent to $\\mathbf{r}_0$: Face $1$ spanned by $(\\mathbf{a}_2, \\mathbf{a}_3)$, Face $2$ by $(\\mathbf{a}_3, \\mathbf{a}_1)$, and Face $3$ by $(\\mathbf{a}_1, \\mathbf{a}_2)$.\n$2$. For each face, spanned by a generic pair $(\\mathbf{u}, \\mathbf{v})$ with base $\\mathbf{r}_0$:\n    a. Calculate $\\bar{c}_{\\text{disc}}$:\n        i. Determine the four vertices and four edge vectors of the parallelogram boundary.\n        ii. For each of the four edges, analytically compute the line integral $\\int \\mathbf{A} \\cdot d\\mathbf{l}$.\n        iii. Sum the four integrals to obtain $\\oint \\mathbf{A} \\cdot d\\mathbf{l}$.\n        iv. Compute the face normal $\\mathbf{n} = \\mathbf{u} \\times \\mathbf{v}$ and its magnitude (area) $\\lVert \\mathbf{n} \\rVert$.\n        v. Divide the total line integral by the area: $\\bar{c}_{\\text{disc}} = (\\oint \\mathbf{A} \\cdot d\\mathbf{l}) / \\lVert \\mathbf{n} \\rVert$.\n    b. Calculate $\\bar{c}_{\\text{exact}}$:\n        i. Compute the face centroid $\\mathbf{r}_c = \\mathbf{r}_0 + \\frac{1}{2}(\\mathbf{u}+\\mathbf{v})$.\n        ii. Evaluate the field $\\mathbf{E}(\\mathbf{r}_c) = [-\\beta y_c, -\\gamma z_c, -\\alpha x_c]^T$.\n        iii. Compute the unit normal $\\hat{\\mathbf{n}} = \\mathbf{n} / \\lVert \\mathbf{n} \\rVert$.\n        iv. Calculate the dot product: $\\bar{c}_{\\text{exact}} = \\mathbf{E}(\\mathbf{r}_c) \\cdot \\hat{\\mathbf{n}}$.\n    c. Compute the absolute error for the face: $|\\bar{c}_{\\text{disc}} - \\bar{c}_{\\text{exact}}|$.\n$3$. Determine the maximum absolute error, $\\varepsilon_{\\max}$, among the three faces.\n$4$. Report $\\varepsilon_{\\max}$ for the test case. This is repeated for all four cases.\nThe constants used are $\\alpha=1.3$, $\\beta=-0.7$, and $\\gamma=0.9$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum absolute error of a discrete curl operator for several test cases.\n    \"\"\"\n    # Define the constants from the problem statement.\n    alpha = 1.3\n    beta = -0.7\n    gamma = 0.9\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general oblique)\n        {\n            \"r0\": np.array([0.2, -0.1, 0.3]),\n            \"a1\": np.array([0.7, 0.1, 0.0]),\n            \"a2\": np.array([0.2, 0.8, 0.1]),\n            \"a3\": np.array([0.1, 0.0, 0.9]),\n        },\n        # Case 2 (orthogonal cube)\n        {\n            \"r0\": np.array([0.0, 0.0, 0.0]),\n            \"a1\": np.array([1.0, 0.0, 0.0]),\n            \"a2\": np.array([0.0, 1.0, 0.0]),\n            \"a3\": np.array([0.0, 0.0, 1.0]),\n        },\n        # Case 3 (highly skewed but non-degenerate)\n        {\n            \"r0\": np.array([-0.3, 0.4, -0.2]),\n            \"a1\": np.array([1.0, 0.0, 0.0]),\n            \"a2\": np.array([0.999, 0.001, 0.0]),\n            \"a3\": np.array([0.001, 0.002, 1.0]),\n        },\n        # Case 4 (scaled and oblique)\n        {\n            \"r0\": np.array([0.5, -0.6, 0.1]),\n            \"a1\": np.array([2.0, 0.5, 0.3]),\n            \"a2\": np.array([-0.1, 3.0, 0.4]),\n            \"a3\": np.array([0.2, 0.1, 1.5]),\n        },\n    ]\n\n    def line_integral_A_dl(p_start, v_edge):\n        \"\"\"\n        Analytically computes the line integral of A along a straight edge.\n        The integrand A(r(t)) . v_edge is a quadratic polynomial C2*t^2 + C1*t + C0.\n        The integral from t=0 to 1 is C0 + C1/2 + C2/3.\n        \"\"\"\n        px, py, pz = p_start\n        vx, vy, vz = v_edge\n\n        # Zeroth-order term C0\n        C0 = alpha * vx * px * py + beta * vy * py * pz + gamma * vz * pz * px\n\n        # First-order term C1\n        C1 = alpha * vx * (px * vy + py * vx) + \\\n             beta * vy * (py * vz + pz * vy) + \\\n             gamma * vz * (pz * vx + px * vz)\n\n        # Second-order term C2\n        C2 = alpha * vx * vx * vy + \\\n             beta * vy * vy * vz + \\\n             gamma * vz * vz * vx\n\n        return C0 + C1 / 2.0 + C2 / 3.0\n\n    results = []\n    for case in test_cases:\n        r0, a1, a2, a3 = case[\"r0\"], case[\"a1\"], case[\"a2\"], case[\"a3\"]\n\n        # The three faces adjacent to r0 are spanned by (a2, a3), (a3, a1), (a1, a2)\n        faces_spanned_by = [(a2, a3), (a3, a1), (a1, a2)]\n        face_errors = []\n\n        for u, v in faces_spanned_by:\n            # --- Calculate discrete curl average (c_disc) via line integrals ---\n            \n            # Vertices of the parallelogram face\n            p0 = r0\n            p1 = r0 + u\n            p2 = r0 + u + v\n            p3 = r0 + v\n\n            # Edge vectors for the closed loop p0 -> p1 -> p2 -> p3 -> p0\n            v1 = u\n            v2 = v\n            v3 = -u\n            v4 = -v\n\n            # Line integrals along the four edges\n            I1 = line_integral_A_dl(p0, v1)\n            I2 = line_integral_A_dl(p1, v2)\n            I3 = line_integral_A_dl(p2, v3)\n            I4 = line_integral_A_dl(p3, v4)\n            \n            total_line_integral = I1 + I2 + I3 + I4\n\n            # Face normal and area\n            n = np.cross(u, v)\n            area = np.linalg.norm(n)\n            \n            c_disc = total_line_integral / area if area > 0 else 0.0\n\n            # --- Calculate exact curl average (c_exact) at face centroid ---\n            \n            # Centroid of the face\n            r_c = r0 + 0.5 * (u + v)\n            xc, yc, zc = r_c\n\n            # E = curl(A) at the centroid\n            E_at_c = np.array([-beta * yc, -gamma * zc, -alpha * xc])\n            \n            # Unit normal vector\n            n_hat = n / area if area > 0 else np.zeros(3)\n\n            c_exact = np.dot(E_at_c, n_hat)\n\n            # --- Compute absolute error for the face ---\n            face_errors.append(np.abs(c_disc - c_exact))\n\n        # Find the maximum error for the current cell\n        epsilon_max = max(face_errors)\n        results.append(epsilon_max)\n\n    # Format output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The elegance of non-orthogonal methods lies in their ability to preserve fundamental physical conservation laws at the discrete level. This final practice explores one of the most important of these, the identity $\\nabla \\cdot (\\nabla \\times \\mathbf{E}) = 0$, from a fundamental topological perspective and then examines the practical accuracy of a common numerical scheme. By first proving the exactness of the discrete 'div-curl' operator and then analyzing the numerical error for plane wave propagation, you will connect the abstract beauty of discrete exterior calculus to the practical performance of a generalized Yee algorithm. ",
            "id": "3334437",
            "problem": "You are to work in the setting of computational electromagnetics on a non-orthogonal uniform Bravais lattice and use the language of Discrete Exterior Calculus (DEC) to connect the fundamental exactness property to a generalized Yee-type curl on an oblique grid. Your task has two parts: a derivation and an implementation. All lengths are in meters, all wave vectors are in radians per meter, and angles are in radians.\n\nPart A (principle). Start from the integral form of Maxwell’s equations, Stokes’ theorem, and the Discrete Exterior Calculus (DEC) definition of the exterior derivative on a cell complex. In DEC, discrete fields are cochains on a primal complex and its dual, the discrete exterior derivative is realized by incidence matrices between oriented cells, and the metric enters only through Hodge star operators. Use the following principles as the fundamental base:\n- The definition of the exterior derivative as the pullback of integration on oriented chains, i.e., for a smooth differential form, Stokes’ theorem relates the integral of its exterior derivative over a domain to the integral of the form over the boundary of the domain.\n- The topological identity that the boundary of a boundary is zero, expressed algebraically as the chain complex relation that the composition of boundary operators vanishes.\n- The identification in DEC that the discrete curl is the coboundary map from primal edges to primal faces, and the discrete divergence of a primal 2-cochain is the coboundary map from primal faces to primal 3-cells.\n\nFrom these principles derive, in a coordinate-free manner, that the discrete divergence of the discrete curl is identically zero on any well-oriented cell complex, independent of the metric or skewness of the cells. Express your derivation entirely in terms of oriented chains, cochains, and the composition of incidence matrices, and conclude that the discrete operator corresponding to $d_2 \\circ d_1$ must be the zero map. Do not use or quote any specialized formula for a particular grid.\n\nPart B (plane-wave comparison for generalized Yee curl). Consider a uniform non-orthogonal lattice with primitive vectors $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$ forming a parallelepiped cell with vertices at $\\mathbf{0}$, $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$, $\\mathbf{a}_1+\\mathbf{a}_2$, $\\mathbf{a}_1+\\mathbf{a}_3$, $\\mathbf{a}_2+\\mathbf{a}_3$, $\\mathbf{a}_1+\\mathbf{a}_2+\\mathbf{a}_3$. Let $\\mathbf{E}(\\mathbf{x})=\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot \\mathbf{x}}$ be a time-harmonic plane wave with angular frequency $ \\omega $ suppressed; here $ \\mathbf{E}_0 \\in \\mathbb{C}^3 $ is constant and $\\mathbf{k}\\in\\mathbb{R}^3$ is the wave vector.\n\nDefine the exact face-integrated curl on the three faces attached to the origin by Stokes’ theorem as the circulation of $\\mathbf{E}$ around each face:\n- Face spanned by $\\mathbf{a}_1$ and $\\mathbf{a}_2$ at $\\mathbf{0}$.\n- Face spanned by $\\mathbf{a}_2$ and $\\mathbf{a}_3$ at $\\mathbf{0}$.\n- Face spanned by $\\mathbf{a}_3$ and $\\mathbf{a}_1$ at $\\mathbf{0}$.\n\nFor each face, compute:\n- The exact circulation by summing exact line integrals along the four oriented edges of the face, where each line integral is computed exactly as $\\int_0^1 \\mathbf{E}_0\\cdot \\mathbf{v}\\ e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + s \\mathbf{v})}\\ ds$, with edge vector $\\mathbf{v}$ and starting point $\\mathbf{r}_s$.\n- The generalized Yee approximation by replacing each exact line integral with the midpoint approximation $\\mathbf{E}(\\mathbf{r}_s+\\mathbf{v}/2)\\cdot \\mathbf{v}$.\n\nFor each face, define the relative error as the ratio of the magnitude of the difference between the approximate circulation and the exact circulation to the magnitude of the exact circulation. If the magnitude of the exact circulation is smaller than a numerical threshold, normalize by that threshold to avoid division by zero. Report, for a given lattice and plane wave $(\\mathbf{a}_1,\\mathbf{a}_2,\\mathbf{a}_3,\\mathbf{k},\\mathbf{E}_0)$, the maximum of the three face-wise relative errors. Angles are in radians.\n\nProgramming task. Implement a program that:\n1) Constructs the oriented incidence matrix from edges to faces for the single skewed parallelepiped cell described above, and then computes a consistent face-to-cell incidence row such that the product of these incidence arrays is the zero row. Return a boolean indicating whether the Euclidean norm of this product is smaller than $10^{-12}$, thereby numerically verifying the exactness relation $d_2 d_1=0$.\n2) For each of the following test parameter sets, computes the maximum relative error across the three origin-attached faces for the generalized Yee circulation approximation compared with the exact circulation for the plane wave:\n- Test 1 (happy path, moderately skewed, long wavelength): $\\mathbf{a}_1=(1.0,0.0,0.0)$, $\\mathbf{a}_2=(0.3,0.9,0.0)$, $\\mathbf{a}_3=(0.1,0.2,1.1)$, $\\mathbf{k}=(0.2,0.1,0.15)$, $\\mathbf{E}_0=(1.0,0.7,-0.4)$.\n- Test 2 (boundary case near Nyquist along $\\mathbf{a}_1$): $\\mathbf{a}_1=(1.0,0.0,0.0)$, $\\mathbf{a}_2=(0.3,0.9,0.0)$, $\\mathbf{a}_3=(0.1,0.2,1.1)$, $\\mathbf{k}=(\\pi,0.0,0.0)$, $\\mathbf{E}_0=(1.0,0.7,-0.4)$.\n- Test 3 (strongly skewed lattice, moderate wavelength): $\\mathbf{a}_1=(1.0,0.2,0.1)$, $\\mathbf{a}_2=(0.9,1.1,0.3)$, $\\mathbf{a}_3=(0.2,0.4,0.95)$, $\\mathbf{k}=(1.2,-0.8,0.6)$, $\\mathbf{E}_0=(0.4,1.0,0.2)$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets: first the boolean exactness verification, followed by the three floating-point relative errors for Tests 1–3, in that order, e.g., \"[True,0.00123,0.4567,0.089]\". The relative errors are dimensionless real numbers.\n\nDeliverables. Your derivation in Part A and Part B must be included in your written solution. Your program must implement the computations exactly as described, with no external input or files, and must adhere to the specified output format. The numerical tolerance for the exactness check must be $10^{-12}$, and use a normalization threshold of $10^{-12}$ when computing relative errors to avoid division by zero in degenerate cases. Angles must be interpreted in radians throughout.",
            "solution": "The problem is evaluated as valid. It is scientifically grounded in computational electromagnetics and Discrete Exterior Calculus (DEC), well-posed, objective, and contains all necessary information for a solution.\n\n### Part A: Derivation of the Exactness Property\n\nThe core of this derivation rests on the fundamental principles of algebraic topology as applied to a cell complex through the framework of Discrete Exterior Calculus (DEC).\n\nLet our computational domain be discretized into a cell complex, which is a collection of oriented k-cells (vertices for $k=0$, edges for $k=1$, faces for $k=2$, volumes for $k=3$). The space of formal linear combinations of $k$-cells is the chain group $C_k$.\n\nThe boundary operator, $\\partial_k: C_k \\rightarrow C_{k-1}$, maps a $k$-chain to its $(k-1)$-dimensional boundary. For an individual $k$-cell $\\sigma_k$, its boundary $\\partial_k \\sigma_k$ is a $(k-1)$-chain consisting of the $(k-1)$-cells on its surface, with orientations induced by the orientation of $\\sigma_k$. A fundamental property of any cell complex is that the boundary of a boundary is empty. This is expressed algebraically as the composition of two successive boundary operators being the zero map:\n$$\n\\partial_{k-1} \\circ \\partial_k = 0 \\quad \\text{for all } k > 0\n$$\nThis is a purely topological statement, independent of any metric or coordinate system.\n\nIn DEC, physical fields are represented by discrete differential forms, or cochains. A $k$-cochain, denoted $\\alpha^k$, is a linear map from the space of $k$-chains to the real or complex numbers, $\\alpha^k: C_k \\rightarrow \\mathbb{C}$. This map represents the integral of the corresponding continuous differential form over a chain. For a $k$-cochain $\\alpha^k$ and a $k$-chain $c_k = \\sum_i a_i \\sigma_k^i$, its action is $\\alpha^k(c_k) = \\sum_i a_i \\int_{\\sigma_k^i} \\omega^k$, where $\\omega^k$ is the continuous $k$-form.\n\nThe discrete exterior derivative, $d_k: C^k \\rightarrow C^{k+1}$, is the operator that maps $k$-cochains to $(k+1)$-cochains. It is defined as the dual (transpose) of the boundary operator $\\partial_{k+1}$. This relationship is encapsulated by the generalized Stokes' theorem for cochains. For any $k$-cochain $\\alpha^k$ and any $(k+1)$-chain $\\sigma_{k+1}$, the action of the $(k+1)$-cochain $d_k \\alpha^k$ on $\\sigma_{k+1}$ is defined as:\n$$\n(d_k \\alpha^k)(\\sigma_{k+1}) := \\alpha^k(\\partial_{k+1} \\sigma_{k+1})\n$$\nThis is the discrete version of Stokes' theorem, $\\int_{\\Omega} d\\omega = \\int_{\\partial\\Omega} \\omega$, where evaluating the cochain on the chain corresponds to integration.\n\nThe problem requires us to show that the discrete divergence of the discrete curl is identically zero.\nIn $3D$ electromagnetism, the electric field is represented as a $1$-cochain $e^1$ (values on primal edges), and the magnetic flux density is represented as a $2$-cochain $b^2$ (values on primal faces).\nThe discrete curl operator maps $1$-cochains to $2$-cochains. This is the discrete exterior derivative $d_1: C^1 \\rightarrow C^2$.\nThe discrete divergence of a flux field (represented by a $2$-cochain) maps $2$-cochains to $3$-cochains (values in primal volumes). This is the discrete exterior derivative $d_2: C^2 \\rightarrow C^3$.\n\nWe must show that the composition $d_2 \\circ d_1$ is the zero map from $C^1$ to $C^3$. Let $e^1$ be an arbitrary $1$-cochain. We want to evaluate the $3$-cochain $d_2(d_1 e^1)$. To do this, we evaluate its action on an arbitrary $3$-cell (volume) $V_3 \\in C_3$.\n\nUsing the definition of the discrete exterior derivative $d_2$:\n$$\n(d_2 (d_1 e^1))(V_3) = (d_1 e^1)(\\partial_3 V_3)\n$$\nHere, $\\partial_3 V_3$ is a $2$-chain, representing the collection of oriented faces that form the boundary of the volume $V_3$.\n\nNext, we apply the definition of the discrete exterior derivative $d_1$ to the $2$-chain $\\partial_3 V_3$:\n$$\n(d_1 e^1)(\\partial_3 V_3) = e^1(\\partial_2 (\\partial_3 V_3))\n$$\nHere, $\\partial_2(\\partial_3 V_3)$ is the $1$-chain representing the boundary of the boundary of the volume $V_3$.\n\nCombining these two steps, we get:\n$$\n(d_2 (d_1 e^1))(V_3) = e^1(\\partial_2 \\circ \\partial_3 (V_3))\n$$\nFrom the fundamental topological identity $\\partial_2 \\circ \\partial_3 = 0$, the argument to the cochain $e^1$ is the zero $1$-chain. Since a cochain is a linear map, its action on the zero chain is zero: $e^1(\\mathbf{0}) = 0$.\n\nSince this holds for any arbitrary $1$-cochain $e^1$ and any arbitrary $3$-cell $V_3$, the operator $d_2 \\circ d_1$ must be the zero operator.\n\nIn terms of matrix representations, if the boundary operator $\\partial_k$ is represented by an incidence matrix $M_k$, then the coboundary operator $d_{k-1}$ is represented by its transpose, $M_k^T$.\n- The discrete curl $d_1: C^1 \\to C^2$ is represented by the matrix $M_2^T$, where $M_2$ is the face-to-edge incidence matrix for $\\partial_2$.\n- The discrete divergence $d_2: C^2 \\to C^3$ is represented by the matrix $M_3^T$, where $M_3$ is the volume-to-face incidence matrix for $\\partial_3$.\n\nThe composition $d_2 \\circ d_1$ is represented by the matrix product $(M_3^T)(M_2^T)$. Using the property $(AB)^T = B^T A^T$, this is equivalent to $(M_2 M_3)^T$. The product $M_2 M_3$ represents the composition of boundary operators $\\partial_2 \\circ \\partial_3$, which is the zero operator. Thus, $M_2 M_3 = 0$ (the zero matrix), and its transpose is also the zero matrix. This confirms $(d_2 \\circ d_1) = 0$. This entire derivation is based on the topological structure of the cell complex and is independent of the geometry (metric) or skewness of the cells.\n\n### Part B: Plane-Wave Comparison for Generalized Yee Curl\n\nWe analyze the circulation of a plane wave $\\mathbf{E}(\\mathbf{x})=\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot \\mathbf{x}}$ around the boundary of a face of a parallelepiped cell. Let the face be defined by an oriented loop of four edges $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3, \\mathbf{v}_4$ with corresponding start points $\\mathbf{r}_{s1}, \\mathbf{r}_{s2}, \\mathbf{r}_{s3}, \\mathbf{r}_{s4}$. The circulation is $\\oint \\mathbf{E} \\cdot d\\mathbf{l} = \\sum_{j=1}^4 \\int_{\\text{edge }j} \\mathbf{E} \\cdot d\\mathbf{l}$.\n\nFor a single edge represented by vector $\\mathbf{v}$ starting at $\\mathbf{r}_s$, the path is $\\mathbf{r}(s) = \\mathbf{r}_s + s\\mathbf{v}$ for $s \\in [0,1]$.\nThe exact line integral is given by:\n$$\n\\int_0^1 \\mathbf{E}(\\mathbf{r}_s + s\\mathbf{v}) \\cdot \\mathbf{v} ds = \\int_0^1 (\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + s \\mathbf{v})}) \\cdot \\mathbf{v} ds = (\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} \\int_0^1 e^{i (\\mathbf{k} \\cdot \\mathbf{v}) s} ds\n$$\nThe integral term evaluates to:\n$$\nI(\\mathbf{k}, \\mathbf{v}) = \\int_0^1 e^{i (\\mathbf{k} \\cdot \\mathbf{v}) s} ds = \\begin{cases} \\frac{e^{i (\\mathbf{k} \\cdot \\mathbf{v})} - 1}{i (\\mathbf{k} \\cdot \\mathbf{v})} & \\text{if } \\mathbf{k} \\cdot \\mathbf{v} \\neq 0 \\\\ 1 & \\text{if } \\mathbf{k} \\cdot \\mathbf{v} = 0 \\end{cases}\n$$\nSo the exact contribution from one edge is $(\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} I(\\mathbf{k}, \\mathbf{v})$.\n\nThe generalized Yee approximation replaces the integral with a midpoint rule evaluation:\n$$\n\\int_{\\text{edge}} \\mathbf{E} \\cdot d\\mathbf{l} \\approx \\mathbf{E}(\\mathbf{r}_s + \\mathbf{v}/2) \\cdot \\mathbf{v} = (\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + \\mathbf{v}/2)}) \\cdot \\mathbf{v} = (\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} e^{i (\\mathbf{k} \\cdot \\mathbf{v}) / 2}\n$$\nThe exact circulation for a face, $\\Phi_{\\text{exact}}$, is the sum of the four exact edge contributions. The approximate circulation, $\\Phi_{\\text{approx}}$, is the sum of the four approximate edge contributions.\nThe relative error for one face is computed as:\n$$\n\\epsilon = \\frac{|\\Phi_{\\text{approx}} - \\Phi_{\\text{exact}}|}{ \\max(|\\Phi_{\\text{exact}}|, 10^{-12}) }\n$$\nThe final reported value for each test case is the maximum of the three relative errors computed for the three faces attached to the origin: the face spanned by $(\\mathbf{a}_1, \\mathbf{a}_2)$, the face by $(\\mathbf{a}_2, \\mathbf{a}_3)$, and the face by $(\\mathbf{a}_3, \\mathbf{a}_1)$.\n\nFor the face spanned by $\\mathbf{a}_1$ and $\\mathbf{a}_2$, the oriented boundary is composed of four edges:\n1. $\\mathbf{v} = \\mathbf{a}_1$, $\\mathbf{r}_s = \\mathbf{0}$\n2. $\\mathbf{v} = \\mathbf{a}_2$, $\\mathbf{r}_s = \\mathbf{a}_1$\n3. $\\mathbf{v} = -\\mathbf{a}_1$, $\\mathbf{r}_s = \\mathbf{a}_1+\\mathbf{a}_2$\n4. $\\mathbf{v} = -\\mathbf{a}_2$, $\\mathbf{r}_s = \\mathbf{a}_2$\n\nThe calculations for the other two faces follow this same pattern with cyclically permuted basis vectors.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to perform the two tasks required by the problem.\n    1. Numerically verify the exactness property d2*d1=0 for a single cell.\n    2. Compute the maximum relative error of the generalized Yee curl approximation for three test cases.\n    \"\"\"\n\n    def verify_exactness():\n        \"\"\"\n        Constructs incidence matrices for a parallelepiped and verifies d2*d1=0.\n        \n        The cell complex for a single parallelepiped has 1 volume, 6 faces, 12 edges, and 8 vertices.\n        d1 (curl) is the 6x12 edge-to-face coboundary matrix.\n        d2 (div) is the 1x6 face-to-volume coboundary matrix.\n        We verify that the product d2 @ d1 is the zero vector.\n        \n        Orientations:\n        - Edges: 12 edges oriented along a1, a2, a3 directions.\n          - Indices 0-3: along a1, from vertices with smaller i-index to larger.\n          - Indices 4-7: along a2, from vertices with smaller j-index to larger.\n          - Indices 8-11: along a3, from vertices with smaller k-index to larger.\n        - Faces: 6 faces with normals pointing outwards from the cell.\n        - Volume: 1 volume with positive orientation.\n        \"\"\"\n        # d1: Edge-to-face coboundary matrix (curl operator), size 6x12\n        D1 = np.zeros((6, 12), dtype=np.int8)\n\n        # Faces are indexed as [x=0, x=1, y=0, y=1, z=0, z=1] faces.\n        # Outward normals are assumed.\n        # Face at x=0 (normal is -a^1 direction, boundary is anti-clockwise w.r.t normal)\n        D1[0, [4, 8, 6, 9]] = [1, -1, -1, 1] \n        # Face at x=1 (normal is +a^1 direction)\n        D1[1, [5, 11, 7, 8]] = [-1, -1, 1, 1] # Mistake found during implementation, should be:\n        D1[1, [5, 11, 7, 9]] = [1, 1, -1, -1] # Corrected path: 100->101->111->110->100\n        # No, let's fix the first one based on a clear convention.\n        # Face normals pointing outward, boundary orientation by right-hand-rule.\n        # Vertex ijk: i*a1+j*a2+k*a3\n        # Edge indices:\n        # a1-dir: [(0,0,0)->(1,0,0)],[(0,1,0)->(1,1,0)],[(0,0,1)->(1,0,1)],[(0,1,1)->(1,1,1)] -> 0,1,2,3\n        # a2-dir: [(0,0,0)->(0,1,0)],[(1,0,0)->(1,1,0)],[(0,0,1)->(0,1,1)],[(1,0,1)->(1,1,1)] -> 4,5,6,7\n        # a3-dir: [(0,0,0)->(0,0,1)],[(1,0,0)->(1,0,1)],[(0,1,0)->(0,1,1)],[(1,1,0)->(1,1,1)] -> 8,9,10,11\n        D1 = np.zeros((6, 12), dtype=np.int8)\n        # Face x=0 (-a^1 normal): 000->001->011->010->000. Edges: e3_00, e2_01, -e3_01, -e2_00. Indices: 8, 6, 10, 4\n        D1[0, [8, 6, 10, 4]] = [1, 1, -1, -1]\n        # Face x=1 (+a^1 normal): 100->110->111->101->100. Edges: e2_10, e3_11, -e2_11, -e3_10. Indices: 5, 11, 7, 9\n        D1[1, [5, 11, 7, 9]] = [1, 1, -1, -1]\n        # Face y=0 (-a^2 normal): 000->100->101->001->000. Edges: e1_00, e3_10, -e1_01, -e3_00. Indices: 0, 9, 2, 8\n        D1[2, [0, 9, 2, 8]] = [1, 1, -1, -1]\n        # Face y=1 (+a^2 normal): 010->011->111->110->010. Edges: e3_01, e1_11, -e3_11, -e1_10. Indices: 10, 3, 11, 1\n        D1[3, [10, 3, 11, 1]] = [1, 1, -1, -1]\n        # Face z=0 (-a^3 normal): 000->010->110->100->000. Edges: e2_00, e1_10, -e2_10, -e1_00. Indices: 4, 1, 5, 0\n        D1[4, [4, 1, 5, 0]] = [1, 1, -1, -1]\n        # Face z=1 (+a^3 normal): 001->101->111->011->001. Edges: e1_01, e2_11, -e1_11, -e2_01. Indices: 2, 7, 3, 6\n        D1[5, [2, 7, 3, 6]] = [1, 1, -1, -1]\n        \n        # d2: Face-to-volume coboundary matrix (divergence operator), size 1x6\n        # With outward pointing face normals, the boundary of the volume is the sum of all faces.\n        D2 = np.ones((1, 6), dtype=np.int8)\n\n        # The composition d2*d1 must be a zero matrix (here, a 1x12 zero vector).\n        product = D2 @ D1\n        norm = np.linalg.norm(product)\n        return norm < 1e-12\n\n    def calculate_relative_error(test_case):\n        \"\"\"\n        Calculates the max relative error for a given lattice and plane wave.\n        \"\"\"\n        a1, a2, a3, k, E0 = [np.array(v) for v in test_case]\n        \n        faces = [\n            # Face 1: span a1, a2\n            [(a1, np.array([0,0,0])), (a2, a1), (-a1, a1+a2), (-a2, a2)],\n            # Face 2: span a2, a3\n            [(a2, np.array([0,0,0])), (a3, a2), (-a2, a2+a3), (-a3, a3)],\n            # Face 3: span a3, a1\n            [(a3, np.array([0,0,0])), (a1, a3), (-a3, a3+a1), (-a1, a1)]\n        ]\n        \n        face_errors = []\n        \n        for face_edges in faces:\n            exact_circulation = 0j\n            approx_circulation = 0j\n            \n            for v, rs in face_edges:\n                E0_dot_v = np.dot(E0, v)\n                k_dot_rs = np.dot(k, rs)\n                k_dot_v = np.dot(k, v)\n                \n                exp_k_rs = np.exp(1j * k_dot_rs)\n                \n                # Exact integral term\n                if np.abs(k_dot_v) < 1e-9:\n                    # Taylor expansion for (e^{ix}-1)/ix around x=0 is 1 + ix/2 - x^2/6 ...\n                    # We use the first few terms for stability.\n                    x = 1j * k_dot_v\n                    integral_factor = 1 + x/2 + x**2/6 + x**3/24\n                else:\n                    integral_factor = (np.exp(1j * k_dot_v) - 1) / (1j * k_dot_v)\n                \n                exact_circulation += E0_dot_v * exp_k_rs * integral_factor\n                \n                # Approximate (midpoint) term\n                approx_circulation += E0_dot_v * exp_k_rs * np.exp(1j * k_dot_v / 2)\n                \n            error_norm = np.abs(approx_circulation - exact_circulation)\n            exact_norm = np.abs(exact_circulation)\n            \n            relative_error = error_norm / max(exact_norm, 1e-12)\n            face_errors.append(relative_error)\n            \n        return max(face_errors)\n\n    # --- Main Execution ---\n    \n    # Part 1: Exactness Verification\n    is_exact = verify_exactness()\n    \n    results = [is_exact]\n    \n    # Part 2: Relative Error Calculation for Test Cases\n    test_cases = [\n        # Test 1\n        ((1.0, 0.0, 0.0), (0.3, 0.9, 0.0), (0.1, 0.2, 1.1), (0.2, 0.1, 0.15), (1.0, 0.7, -0.4)),\n        # Test 2\n        ((1.0, 0.0, 0.0), (0.3, 0.9, 0.0), (0.1, 0.2, 1.1), (np.pi, 0.0, 0.0), (1.0, 0.7, -0.4)),\n        # Test 3\n        ((1.0, 0.2, 0.1), (0.9, 1.1, 0.3), (0.2, 0.4, 0.95), (1.2, -0.8, 0.6), (0.4, 1.0, 0.2))\n    ]\n    \n    for case in test_cases:\n        error = calculate_relative_error(case)\n        results.append(error)\n        \n    bool_str = str(results[0])\n    float_strs = [f\"{x:.6g}\" for x in results[1:]]\n    \n    print(f\"[{bool_str},{','.join(float_strs)}]\")\n\nsolve()\n```"
        }
    ]
}