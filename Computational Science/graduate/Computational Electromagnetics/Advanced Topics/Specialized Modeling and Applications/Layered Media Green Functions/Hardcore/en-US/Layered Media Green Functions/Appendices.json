{
    "hands_on_practices": [
        {
            "introduction": "The foundation of analyzing layered media lies in constructing the Green's function, which represents the field response to a point source. This first practice guides you through the fundamental derivation for a single interface using the spectral domain method, also known as the Sommerfeld integral representation . By working from Maxwell's equations and taking the static limit, you will see how this rigorous full-wave solution elegantly reduces to the familiar and intuitive result from electrostatic image theory, bridging the gap between wave phenomena and statics.",
            "id": "3316450",
            "problem": "Consider two homogeneous, isotropic half-spaces separated by the planar interface at $z=0$. Region $1$ is $z0$ with permittivity $\\varepsilon_{1}$ and permeability $\\mu_{1}$, and region $2$ is $z0$ with permittivity $\\varepsilon_{2}$ and permeability $\\mu_{2}$. Let $\\omega$ be the angular frequency, and define the wavenumbers $k_{i}=\\omega\\sqrt{\\mu_{i}\\varepsilon_{i}}$ for $i\\in\\{1,2\\}$. For a time-harmonic point source located at $\\mathbf{r}'=(0,0,h)$ with $h0$, the layered-medium scalar Green’s function $G(\\mathbf{r}|\\mathbf{r}')$ for the transverse-magnetic-reduced scalar problem in region $i$ is defined to satisfy\n$$(\\nabla^{2}+k_{i}^{2})\\,G_{i}(\\mathbf{r}|\\mathbf{r}')=-\\frac{\\delta(\\mathbf{r}-\\mathbf{r}')}{\\varepsilon_{i}},$$\nwith the boundary conditions at $z=0$ that $G$ is continuous and $\\varepsilon\\,\\partial G/\\partial z$ is continuous. Assume the time dependence $\\exp(j\\omega t)$, and take the radiation condition that fields decay as $|z|\\to\\infty$ in their respective half-spaces.\n\nStarting from the two-dimensional Fourier transform in $x,y$,\n$$\\widetilde{G}_{i}(k_{x},k_{y},z|\\mathbf{r}')=\\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty}G_{i}(x,y,z|\\mathbf{r}')\\,\\exp\\!\\big(-j(k_{x}x+k_{y}y)\\big)\\,dx\\,dy,$$\nderive the ordinary differential equation in $z$, solve it in each region subject to the above boundary and radiation conditions, determine the spectral-domain reflection coefficient, and perform the inverse transform to obtain the exact Sommerfeld-type integral representation for $G_{1}(\\mathbf{r}|\\mathbf{r}')$ when the observation point is in region $1$. Then, take the static limit $\\omega\\to 0$ and show that the integral reduces to the superposition of a free-space Coulombic term and an image-source term consistent with image theory, identifying the image coefficient in terms of $\\varepsilon_{1}$ and $\\varepsilon_{2}$.\n\nLet $\\rho=\\sqrt{x^{2}+y^{2}}$ and take the observation point $\\mathbf{r}=(x,y,z)$ with $z0$. Express the final answer as a single closed-form analytical expression for the static-limit Green’s function $G_{1}(\\rho,z|h)$ in terms of $\\rho$, $z$, $h$, $\\varepsilon_{1}$, and $\\varepsilon_{2}$. No numerical evaluation is required. Do not include units in your final expression.",
            "solution": "The analysis begins by validating the problem statement. The problem is a standard exercise in computational electromagnetics involving the derivation of the layered-medium Green's function, its representation as a Sommerfeld integral, and its connection to the electrostatic method of images in the static limit. All givens, including the governing partial differential equation, the boundary conditions, and the source definition, are self-contained, mathematically consistent, and scientifically sound. The problem is well-posed and objective. Therefore, the problem is deemed valid and a full solution can be derived.\n\nThe problem is to find the scalar Green's function $G_{1}(\\mathbf{r}|\\mathbf{r}')$ in region $1$ ($z0$) for a point source at $\\mathbf{r}'=(0,0,h)$ with $h0$. The governing equations are:\n$$(\\nabla^{2}+k_{1}^{2})\\,G_{1}(\\mathbf{r}|\\mathbf{r}')=-\\frac{\\delta(\\mathbf{r}-\\mathbf{r}')}{\\varepsilon_{1}} \\quad \\text{for } z0$$\n$$(\\nabla^{2}+k_{2}^{2})\\,G_{2}(\\mathbf{r}|\\mathbf{r}')=0 \\quad \\text{for } z0$$\nThe boundary conditions at the interface $z=0$ are continuity of $G$ and $\\varepsilon\\,\\partial G/\\partial z$.\n\nWe start by applying the two-dimensional Fourier transform with respect to the transverse coordinates $(x,y)$:\n$$\\widetilde{G}_{i}(k_{x},k_{y},z)=\\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty}G_{i}(x,y,z)\\,\\exp\\!\\big(-j(k_{x}x+k_{y}y)\\big)\\,dx\\,dy$$\nThe Laplacian operator $\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2} + \\frac{\\partial^2}{\\partial z^2}$ transforms to $-k_x^2 - k_y^2 + \\frac{d^2}{dz^2}$. Let $k_{\\rho}^{2}=k_{x}^{2}+k_{y}^{2}$. The transformed Laplacian operator is $\\frac{d^2}{dz^2} - k_{\\rho}^{2}$.\nThe source term $\\delta(\\mathbf{r}-\\mathbf{r}') = \\delta(x)\\delta(y)\\delta(z-h)$ transforms to $\\delta(z-h)$.\nThe transformed equations (ordinary differential equations in $z$) are:\n$$\\left(\\frac{d^2}{dz^2} - k_{\\rho}^{2} + k_{1}^{2}\\right)\\,\\widetilde{G}_{1}(k_{\\rho},z) = -\\frac{\\delta(z-h)}{\\varepsilon_{1}}$$\n$$\\left(\\frac{d^2}{dz^2} - k_{\\rho}^{2} + k_{2}^{2}\\right)\\,\\widetilde{G}_{2}(k_{\\rho},z) = 0$$\nLet us define the vertical propagation constants $\\gamma_{i} = \\sqrt{k_{\\rho}^{2}-k_{i}^{2}}$. To satisfy the radiation condition for $|z|\\to\\infty$, we must choose the branch of the square root such that $\\text{Re}(\\gamma_{i}) \\ge 0$. The ODEs become:\n$$\\left(\\frac{d^2}{dz^2} - \\gamma_{1}^{2}\\right)\\,\\widetilde{G}_{1}(z) = -\\frac{\\delta(z-h)}{\\varepsilon_{1}}$$\n$$\\left(\\frac{d^2}{dz^2} - \\gamma_{2}^{2}\\right)\\,\\widetilde{G}_{2}(z) = 0$$\n\nThe solution in region $2$ ($z0$) must decay as $z \\to -\\infty$, so it has the form:\n$$\\widetilde{G}_{2}(z) = T \\exp(\\gamma_{2}z)$$\nwhere $T$ is a transmission coefficient.\n\nIn region $1$ ($z0$), the solution is composed of a primary (incident) part from the source and a reflected part from the interface. The primary part is the solution in a homogeneous space with wavenumber $k_1$, which is the one-dimensional Green's function for the operator $\\frac{d^2}{dz^2}-\\gamma_1^2$:\n$$\\widetilde{G}_{\\text{primary}}(z) = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}\\exp(-\\gamma_{1}|z-h|)$$\nThe reflected part must be a solution to the homogeneous equation in region $1$ and must propagate away from the interface at $z=0$ into the region $z0$. It therefore has the form:\n$$\\widetilde{G}_{\\text{reflected}}(z) = A \\exp(-\\gamma_{1}z)$$\nThe total spectral-domain Green's function in region $1$ is the sum:\n$$\\widetilde{G}_{1}(z) = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}\\exp(-\\gamma_{1}|z-h|) + A \\exp(-\\gamma_{1}z)$$\nFor an observer in region $1$ ($z0$), we can write this as:\n$$ \\widetilde{G}_{1}(z) = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}\\left( \\exp(-\\gamma_{1}|z-h|) + R \\exp(-\\gamma_{1}(z+h)) \\right) $$\nThis form is chosen because the reflected field appears to originate from an image source at $z=-h$. Here, $A = R \\frac{\\exp(-\\gamma_1 h)}{2\\varepsilon_1\\gamma_1}$. The coefficient $R$ is the unknown spectral reflection coefficient we must determine from the boundary conditions. For $z0$, the field incident upon the boundary is $\\frac{1}{2\\varepsilon_1\\gamma_1} \\exp(-\\gamma_1(h-z))$ for $zh$. At the boundary $z=0$, this incident field has a down-going exponential dependence $\\exp(\\gamma_1 z)$, while the reflected field has an up-going dependence $\\exp(-\\gamma_1 z)$.\n\nLet's apply the boundary conditions at $z=0$:\n1.  Continuity of $\\widetilde{G}$: $\\widetilde{G}_{1}(0) = \\widetilde{G}_{2}(0)$\n    $$ \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}\\left( \\exp(-\\gamma_{1}h) + R \\exp(-\\gamma_{1}h) \\right) = T $$\n2.  Continuity of $\\varepsilon\\frac{d\\widetilde{G}}{dz}$: $\\varepsilon_{1}\\frac{d\\widetilde{G}_{1}}{dz}\\Big|_{z=0} = \\varepsilon_{2}\\frac{d\\widetilde{G}_{2}}{dz}\\Big|_{z=0}$\n    $$ \\frac{d\\widetilde{G}_{1}}{dz}\\Big|_{z=0} = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}} \\left( \\gamma_{1}\\exp(-\\gamma_{1}h) - R\\gamma_{1}\\exp(-\\gamma_{1}h) \\right) $$\n    $$ \\frac{d\\widetilde{G}_{2}}{dz}\\Big|_{z=0} = T\\gamma_{2} $$\n    Substituting these gives:\n    $$ \\varepsilon_{1} \\frac{\\gamma_{1}}{2\\varepsilon_{1}\\gamma_{1}} (1-R)\\exp(-\\gamma_{1}h) = \\varepsilon_{2} T \\gamma_{2} $$\n    $$ \\frac{1}{2}(1-R)\\exp(-\\gamma_{1}h) = \\varepsilon_{2}T\\gamma_{2} $$\nFrom the first boundary condition, we have $T = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}(1+R)\\exp(-\\gamma_{1}h)$. Substituting this into the second condition:\n$$ \\frac{1}{2}(1-R)\\exp(-\\gamma_{1}h) = \\varepsilon_{2} \\gamma_{2} \\left[ \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}(1+R)\\exp(-\\gamma_{1}h) \\right] $$\n$$ (1-R) = \\frac{\\varepsilon_{2}\\gamma_{2}}{\\varepsilon_{1}\\gamma_{1}}(1+R) $$\n$$ \\varepsilon_{1}\\gamma_{1}(1-R) = \\varepsilon_{2}\\gamma_{2}(1+R) $$\n$$ \\varepsilon_{1}\\gamma_{1} - \\varepsilon_{1}\\gamma_{1}R = \\varepsilon_{2}\\gamma_{2} + \\varepsilon_{2}\\gamma_{2}R $$\n$$ \\varepsilon_{1}\\gamma_{1} - \\varepsilon_{2}\\gamma_{2} = R(\\varepsilon_{1}\\gamma_{1} + \\varepsilon_{2}\\gamma_{2}) $$\nThe spectral reflection coefficient for the transverse-magnetic (TM) case is:\n$$ R^{\\text{TM}} = \\frac{\\varepsilon_{1}\\gamma_{1} - \\varepsilon_{2}\\gamma_{2}}{\\varepsilon_{1}\\gamma_{1} + \\varepsilon_{2}\\gamma_{2}} $$\nThe problem is for the TM-reduced scalar problem, and these boundary conditions on $G$ yield this reflection coefficient. Note that the standard TM reflection coefficient for the magnetic field is $\\frac{\\varepsilon_2\\gamma_1 - \\varepsilon_1\\gamma_2}{\\varepsilon_2\\gamma_1 + \\varepsilon_1\\gamma_2}$. Our reflection coefficient is for the scalar potential $G$.\n\nThe spectral-domain Green's function for $z0$ is thus:\n$$ \\widetilde{G}_{1}(k_{\\rho},z) = \\frac{1}{2\\varepsilon_{1}\\gamma_{1}}\\left( \\exp(-\\gamma_{1}|z-h|) + \\frac{\\varepsilon_{1}\\gamma_{1} - \\varepsilon_{2}\\gamma_{2}}{\\varepsilon_{1}\\gamma_{1} + \\varepsilon_{2}\\gamma_{2}} \\exp(-\\gamma_{1}(z+h)) \\right) $$\nTo find the spatial-domain Green's function $G_{1}$, we perform the inverse Fourier transform:\n$$ G_{1}(\\mathbf{r}|\\mathbf{r}') = \\frac{1}{(2\\pi)^2} \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\widetilde{G}_{1}(k_x, k_y, z) e^{j(k_x x + k_y y)} dk_x dk_y $$\nUsing polar coordinates in both spatial $(\\rho,\\phi)$ and spectral $(k_\\rho,\\alpha)$ domains, where $\\rho=\\sqrt{x^2+y^2}$ and $k_\\rho=\\sqrt{k_x^2+k_y^2}$, the integral simplifies due to azimuthal symmetry:\n$$ G_{1}(\\rho,z;h) = \\frac{1}{2\\pi} \\int_{0}^{\\infty} \\widetilde{G}_{1}(k_{\\rho},z) J_{0}(k_{\\rho}\\rho) k_{\\rho} dk_{\\rho} $$\nwhere $J_{0}$ is the Bessel function of the first kind of order zero. This yields the Sommerfeld-type integral representation:\n$$ G_{1}(\\rho,z;h) = \\frac{1}{4\\pi\\varepsilon_{1}} \\int_{0}^{\\infty} \\frac{k_{\\rho}}{\\gamma_{1}} \\left( e^{-\\gamma_{1}|z-h|} + R^{\\text{TM}} e^{-\\gamma_{1}(z+h)} \\right) J_{0}(k_{\\rho}\\rho) dk_{\\rho} $$\n\nNow, we take the static limit, $\\omega \\to 0$. In this limit:\n$k_{i} = \\omega\\sqrt{\\mu_{i}\\varepsilon_{i}} \\to 0$.\n$\\gamma_{i} = \\sqrt{k_{\\rho}^{2}-k_{i}^{2}} \\to \\sqrt{k_{\\rho}^{2}} = k_{\\rho}$.\nThe reflection coefficient simplifies to:\n$$ R^{\\text{TM}} \\to \\frac{\\varepsilon_{1}k_{\\rho} - \\varepsilon_{2}k_{\\rho}}{\\varepsilon_{1}k_{\\rho} + \\varepsilon_{2}k_{\\rho}} = \\frac{\\varepsilon_{1} - \\varepsilon_{2}}{\\varepsilon_{1} + \\varepsilon_{2}} $$\nThis is the static image coefficient for a charge near a dielectric interface.\nThe Green's function integral in the static limit becomes:\n$$ G_{1}^{\\text{static}} = \\frac{1}{4\\pi\\varepsilon_{1}} \\int_{0}^{\\infty} \\frac{k_{\\rho}}{k_{\\rho}} \\left( e^{-k_{\\rho}|z-h|} + \\frac{\\varepsilon_{1} - \\varepsilon_{2}}{\\varepsilon_{1} + \\varepsilon_{2}} e^{-k_{\\rho}(z+h)} \\right) J_{0}(k_{\\rho}\\rho) dk_{\\rho} $$\n$$ G_{1}^{\\text{static}} = \\frac{1}{4\\pi\\varepsilon_{1}} \\left[ \\int_{0}^{\\infty} e^{-k_{\\rho}|z-h|} J_{0}(k_{\\rho}\\rho) dk_{\\rho} + \\left(\\frac{\\varepsilon_{1}-\\varepsilon_{2}}{\\varepsilon_{1}+\\varepsilon_{2}}\\right) \\int_{0}^{\\infty} e^{-k_{\\rho}(z+h)} J_{0}(k_{\\rho}\\rho) dk_{\\rho} \\right] $$\nThese integrals are of the form known as the Weber-Schafheitlin integral or a special case of the Laplace transform of a Bessel function:\n$$ \\int_{0}^{\\infty} e^{-a t} J_{0}(b t) dt = \\frac{1}{\\sqrt{a^2+b^2}} $$\nFor the first integral, we set $t=k_{\\rho}$, $a=|z-h|$, and $b=\\rho$. The result is $\\frac{1}{\\sqrt{\\rho^2+(z-h)^2}}$.\nFor the second integral, we set $t=k_{\\rho}$, $a=(z+h)$, and $b=\\rho$. The result is $\\frac{1}{\\sqrt{\\rho^2+(z+h)^2}}$.\nSubstituting these results, the static Green's function is:\n$$ G_{1}(\\rho,z|h) = \\frac{1}{4\\pi\\varepsilon_{1}} \\left( \\frac{1}{\\sqrt{\\rho^2+(z-h)^2}} + \\frac{\\varepsilon_{1} - \\varepsilon_{2}}{\\varepsilon_{1} + \\varepsilon_{2}} \\frac{1}{\\sqrt{\\rho^2+(z+h)^2}} \\right) $$\nThis expression represents the superposition of the free-space potential from the original source at $(0,0,h)$ and the potential from an image source at $(0,0,-h)$. The first term is the potential of a point source of strength unity in a medium of permittivity $\\varepsilon_1$, equivalent to the Coulomb potential term. The second term is the potential from an image source, with its strength modified by the image coefficient $K_{12} = \\frac{\\varepsilon_1 - \\varepsilon_2}{\\varepsilon_1 + \\varepsilon_2}$. This result reproduces the classic solution from the method of images in electrostatics.",
            "answer": "$$ \\boxed{ \\frac{1}{4\\pi\\varepsilon_{1}} \\left( \\frac{1}{\\sqrt{\\rho^2 + (z-h)^2}} + \\frac{\\varepsilon_{1} - \\varepsilon_{2}}{\\varepsilon_{1} + \\varepsilon_{2}} \\frac{1}{\\sqrt{\\rho^2 + (z+h)^2}} \\right) } $$"
        },
        {
            "introduction": "The spectral representation of the Green's function is more than just a mathematical tool; its features encode the rich physics of wave interactions in layered media. This exercise focuses on interpreting the poles that appear in the spectral integrand of the Sommerfeld integral . You will derive the dispersion relation for a transverse magnetic (TM) surface wave and discover how the pole locations directly correspond to the propagation constants of these bound modes, which are guided along the material interface.",
            "id": "3323164",
            "problem": "Consider two homogeneous, isotropic, planar half-spaces separated by the plane $z=0$. Medium $1$ occupies $z0$ and has permittivity $\\varepsilon_{1}$ and permeability $\\mu_{1}$; medium $2$ occupies $z0$ and has permittivity $\\varepsilon_{2}$ and permeability $\\mu_{2}$. Assume time-harmonic fields with phasing $\\exp(j \\omega t)$ and define the free-space wavenumber $k_0 = \\omega \\sqrt{\\mu_0 \\varepsilon_0}$. A point electric dipole source located at $z=d0$ excites the layered system. In computational electromagnetics, the layered medium Green function for this configuration can be represented as a Sommerfeld-type spectral integral over the transverse (radial) spectral variable $k_{\\rho}$, whose integrand involves vertical wavenumbers $k_{iz} = \\sqrt{k_i^2 - k_{\\rho}^2}$ with $k_i = \\omega \\sqrt{\\mu_i \\varepsilon_i}$ for $i \\in \\{1,2\\}$ and appropriate branch cuts. Poles of the integrand in the complex $k_{\\rho}$-plane correspond to discrete bound surface wave modes, while branch cuts arise from the square-root definitions and encode the continuous spectrum.\n\nStarting from Maxwell’s equations in the frequency domain, $\\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = j \\omega \\varepsilon \\mathbf{E}$, and the interface boundary conditions at $z=0$ (continuity of tangential $\\mathbf{E}$ and $\\mathbf{H}$ in the absence of surface currents and charges), derive the dispersion relation for a transverse magnetic (TM) bound surface wave supported at the interface. Use a physically consistent choice of the square-root branches for $k_{1z}$ and $k_{2z}$ such that the fields decay away from the interface into both half-spaces. Explain how the pole in the TM spectral Green function arises from this dispersion relation and indicate the role of branch points and branch cuts in defining the Riemann sheet on which the pole resides.\n\nThen, specialize to the nonmagnetic case $\\mu_{1}=\\mu_{2}=\\mu_{0}$ with relative permittivities $\\varepsilon_{r1} = 1$ and $\\varepsilon_{r2} = -2$, where $\\varepsilon_{1} = \\varepsilon_{0} \\varepsilon_{r1}$ and $\\varepsilon_{2} = \\varepsilon_{0} \\varepsilon_{r2}$. Determine the closed-form expression for the TM surface-wave pole location $k_{\\rho p}$ in terms of $k_0$. Express your final answer as a single analytic expression in terms of $k_0$ with no numerical substitution.",
            "solution": "The problem is valid as it is scientifically grounded in Maxwellian electromagnetics, well-posed, objective, and contains a complete and consistent set of givens for deriving the dispersion relation of a surface wave and solving for its wavenumber in a specific case.\n\nWe begin by considering a transverse magnetic (TM) wave, which by definition has a zero magnetic field component in the direction of stratification, here $H_z=0$. We seek a source-free solution to Maxwell's equations that is bound to the interface at $z=0$ and propagates along the interface. Without loss of generality, we assume propagation in the $x$-direction, so the fields have a spatial dependence of the form $\\mathbf{F}(z) \\exp(j k_\\rho x)$, where $k_\\rho$ is the surface wave propagation constant to be determined. The time-harmonic dependence $\\exp(j \\omega t)$ is assumed.\n\nIn a source-free, homogeneous, and isotropic medium with constitutive parameters $(\\varepsilon_i, \\mu_i)$, the Maxwell's curl equations are $\\nabla \\times \\mathbf{E} = -j \\omega \\mu_i \\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = j \\omega \\varepsilon_i \\mathbf{E}$. For a TM wave with components $(E_x, E_z, H_y)$, these equations relate the field components:\n$$\n\\frac{\\partial H_y}{\\partial z} = j \\omega \\varepsilon_i E_x\n$$\n$$\nj k_\\rho H_y = j \\omega \\varepsilon_i E_z \\implies E_z = \\frac{k_\\rho}{\\omega \\varepsilon_i} H_y\n$$\nThe fields must also satisfy the wave equation. For $H_y$, it is $(\\nabla^2 + k_i^2) H_y = 0$, where $k_i^2 = \\omega^2 \\mu_i \\varepsilon_i$. With the assumed propagation, this reduces to an ordinary differential equation in $z$:\n$$\n\\left(\\frac{d^2}{dz^2} - k_\\rho^2 + k_i^2\\right) H_y(z) = 0\n$$\nWe define a decay constant $\\alpha_i = \\sqrt{k_\\rho^2 - k_i^2}$ for each medium $i \\in \\{1, 2\\}$. The equation becomes $\\frac{d^2}{dz^2} H_y(z) - \\alpha_i^2 H_y(z) = 0$.\n\nFor a bound surface wave, the fields must decay to zero as $|z| \\to \\infty$. This requires selecting the appropriate solutions in each half-space. We must choose the branch of the square root for $\\alpha_i$ such that $\\text{Re}(\\alpha_i)  0$.\nIn medium $1$ ($z0$), the solution must decay as $z \\to +\\infty$:\n$$\n\\begin{align*}\nH_{1y}(x,z) = A_1 \\exp(j k_\\rho x) \\exp(-\\alpha_1 z) \\\\\nE_{1x}(x,z) = \\frac{1}{j \\omega \\varepsilon_1} \\frac{\\partial H_{1y}}{\\partial z} = \\frac{-\\alpha_1}{j \\omega \\varepsilon_1} H_{1y}\n\\end{align*}\n$$\nIn medium $2$ ($z0$), the solution must decay as $z \\to -\\infty$:\n$$\n\\begin{align*}\nH_{2y}(x,z) = A_2 \\exp(j k_\\rho x) \\exp(+\\alpha_2 z) \\\\\nE_{2x}(x,z) = \\frac{1}{j \\omega \\varepsilon_2} \\frac{\\partial H_{2y}}{\\partial z} = \\frac{\\alpha_2}{j \\omega \\varepsilon_2} H_{2y}\n\\end{align*}\n$$\nAt the interface $z=0$, the tangential field components ($H_y$ and $E_x$) must be continuous.\nContinuity of $H_y$ at $z=0$ gives $A_1 = A_2$. Let us call this constant $A$.\nContinuity of $E_x$ at $z=0$ gives:\n$$\n\\frac{-\\alpha_1}{j \\omega \\varepsilon_1} A = \\frac{\\alpha_2}{j \\omega \\varepsilon_2} A\n$$\nFor a non-trivial solution ($A \\neq 0$), we must have:\n$$\n-\\frac{\\alpha_1}{\\varepsilon_1} = \\frac{\\alpha_2}{\\varepsilon_2} \\implies \\frac{\\alpha_1}{\\varepsilon_1} + \\frac{\\alpha_2}{\\varepsilon_2} = 0\n$$\nThis is the dispersion relation for TM surface waves. Substituting $\\alpha_i = \\sqrt{k_\\rho^2 - k_i^2}$, we get:\n$$\n\\frac{\\sqrt{k_\\rho^2 - k_1^2}}{\\varepsilon_1} + \\frac{\\sqrt{k_\\rho^2 - k_2^2}}{\\varepsilon_2} = 0\n$$\nFor a bound wave to exist, we need $\\text{Re}(\\alpha_1)0$ and $\\text{Re}(\\alpha_2)0$. This implies that a solution is possible only if $\\varepsilon_1$ and $\\varepsilon_2$ have opposite signs.\n\nThe connection to the layered medium Green's function is established via the plane-wave spectral representation (Sommerfeld integral). The Green's function is constructed by summing up all possible plane waves, including those reflected from the interface. The integrand of this spectral integral contains the reflection coefficient for a plane wave incident on the interface. For a TM-polarized wave, the reflection coefficient is:\n$$\nR^{TM}(k_\\rho) = \\frac{Z_2^{TM} - Z_1^{TM}}{Z_2^{TM} + Z_1^{TM}}\n$$\nwhere $Z_i^{TM} = k_{iz}/(\\omega \\varepsilon_i)$ is the TM wave impedance in medium $i$, and $k_{iz} = \\sqrt{k_i^2 - k_\\rho^2}$ is the vertical wavenumber. The fields in the Sommerfeld integral involve terms like $R^{TM}(k_\\rho) \\exp(-j k_{1z} z)$. A pole in the integrand occurs when the denominator of $R^{TM}$ is zero, which would cause the integral to diverge (contour deformation is needed). This condition is $Z_2^{TM} + Z_1^{TM} = 0$, or:\n$$\n\\frac{k_{1z}}{\\varepsilon_1} + \\frac{k_{2z}}{\\varepsilon_2} = 0\n$$\nThis is the same dispersion relation. The vertical wavenumbers $k_{iz}$ are related to the decay constants by $\\alpha_i = -j k_{iz}$ for $z0$ and $\\alpha_i = +j k_{iz}$ for $z0$, with specific branch choices. The functions $k_{iz}(k_\\rho)$ are multi-valued, with branch points at $k_\\rho = \\pm k_i$. Branch cuts are introduced in the complex $k_\\rho$-plane to define a single-valued Riemann surface. A pole $k_{\\rho p}$ that corresponds to a physical, bound surface wave must lie on the \"proper\" Riemann sheet, which is the sheet where the conditions for field decay away from the interface are satisfied, i.e., $\\operatorname{Im}(k_{1z}) \\le 0$ and $\\operatorname{Im}(k_{2z}) \\le 0$ (with our chosen $e^{j\\omega t}$ convention) or equivalently $\\text{Re}(\\alpha_1)0$ and $\\text{Re}(\\alpha_2)0$.\n\nNow we specialize to the given case: $\\mu_1 = \\mu_2 = \\mu_0$, $\\varepsilon_1 = \\varepsilon_0 \\varepsilon_{r1} = \\varepsilon_0$, and $\\varepsilon_2 = \\varepsilon_0 \\varepsilon_{r2} = -2\\varepsilon_0$.\nFirst, we determine the wavenumbers $k_1$ and $k_2$:\n$$\nk_1^2 = \\omega^2 \\mu_1 \\varepsilon_1 = \\omega^2 \\mu_0 \\varepsilon_0 = k_0^2\n$$\n$$\nk_2^2 = \\omega^2 \\mu_2 \\varepsilon_2 = \\omega^2 \\mu_0 (-2\\varepsilon_0) = -2 k_0^2\n$$\nWe substitute these into the dispersion relation, which we rearrange as $\\frac{\\alpha_1}{\\varepsilon_1} = -\\frac{\\alpha_2}{\\varepsilon_2}$:\n$$\n\\frac{\\sqrt{k_\\rho^2 - k_1^2}}{\\varepsilon_0} = -\\frac{\\sqrt{k_\\rho^2 - k_2^2}}{-2\\varepsilon_0} = \\frac{\\sqrt{k_\\rho^2 - k_2^2}}{2\\varepsilon_0}\n$$\nThis implies $2\\sqrt{k_\\rho^2 - k_1^2} = \\sqrt{k_\\rho^2 - k_2^2}$. Squaring both sides:\n$$\n4(k_\\rho^2 - k_1^2) = k_\\rho^2 - k_2^2\n$$\n$$\n3k_\\rho^2 = 4k_1^2 - k_2^2\n$$\nNow, substituting the expressions for $k_1^2$ and $k_2^2$:\n$$\n3k_\\rho^2 = 4(k_0^2) - (-2k_0^2) = 4k_0^2 + 2k_0^2 = 6k_0^2\n$$\n$$\nk_\\rho^2 = 2k_0^2\n$$\nThe surface-wave pole is located at a value of $k_\\rho$, which we denote $k_{\\rho p}$, given by:\n$$\nk_{\\rho p} = \\sqrt{2} k_0\n$$\nWe must verify that this solution corresponds to a bound mode by checking if $\\text{Re}(\\alpha_1)  0$ and $\\text{Re}(\\alpha_2)  0$.\n$$\n\\alpha_1 = \\sqrt{k_{\\rho p}^2 - k_1^2} = \\sqrt{2k_0^2 - k_0^2} = \\sqrt{k_0^2} = k_0\n$$\n$$\n\\alpha_2 = \\sqrt{k_{\\rho p}^2 - k_2^2} = \\sqrt{2k_0^2 - (-2k_0^2)} = \\sqrt{4k_0^2} = 2k_0\n$$\nSince $k_0 = \\omega/c  0$, both $\\alpha_1$ and $\\alpha_2$ are real and positive. Thus, the solution represents a physically valid, non-radiating TM surface wave (a surface plasmon-polariton).\nThe closed-form expression for the pole location is $k_{\\rho p} = \\sqrt{2} k_0$.",
            "answer": "$$\\boxed{\\sqrt{2} k_0}$$"
        },
        {
            "introduction": "While the single-interface problem is pedagogically crucial, real-world applications often involve complex multilayer stacks. This practice moves from analytical derivation to computational implementation, introducing the powerful admittance transfer matrix method . By developing a recursive algorithm based on a transmission-line analogy, you will build a tool to calculate the reflection coefficient for an arbitrary number of layers, a cornerstone technique in the design and analysis of devices like antennas, radomes, and optical filters.",
            "id": "3323152",
            "problem": "You are to derive and implement the computation of the transverse magnetic reflection coefficient in the spectral domain for a planar stratified medium using transfer and impedance/admittance matrices, starting from Maxwell's equations and electromagnetic boundary conditions. Your implementation must handle an arbitrary number of homogeneous, isotropic, planar layers, each specified by its relative permittivity, electrical conductivity, magnetic permeability, and physical thickness, with semi-infinite half-spaces at the top and bottom. The quantities must be computed for specified angular frequency and transverse wavenumbers. Your program must then evaluate, for a given test suite, the magnitude of the transverse magnetic reflection coefficient as seen from the top semi-infinite half-space into the stack, for a set of transverse wavenumbers sampled across propagating and evanescent regimes. All outputs are to be expressed as unitless decimal floats.\n\nFundamental base for derivation: Use only the frequency-domain Maxwell's equations, electromagnetic boundary conditions at planar interfaces, the spectral plane-wave decomposition in a homogeneous layer, and the definitions of transverse electric and transverse magnetic wave admittances in homogeneous isotropic media. You must not assume any pre-derived multilayer recursion formula; all recursions must be justified from these bases.\n\nDefinitions and constraints to be used in your derivation and implementation:\n- The angular frequency is $\\,\\omega = 2\\pi f\\,$ for frequency $\\,f\\,$ in $\\mathrm{Hz}$.\n- The free-space permittivity is $\\,\\epsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F/m}\\,$ and the free-space permeability is $\\,\\mu_0 = 4\\pi\\times 10^{-7}\\,\\mathrm{H/m}\\,$.\n- For a layer with relative permittivity $\\,\\epsilon_r\\,$, relative permeability $\\,\\mu_r\\,$, and conductivity $\\,\\sigma\\,$ in $\\mathrm{S/m}$, the complex permittivity is $\\,\\epsilon_c = \\epsilon_0 \\epsilon_r - j \\sigma/\\omega\\,$ and the permeability is $\\,\\mu = \\mu_0 \\mu_r\\,$.\n- The free-space wavenumber is $\\,k_0 = \\omega\\sqrt{\\mu_0 \\epsilon_0}\\,$.\n- For a given transverse wavenumber magnitude $\\,k_\\rho\\,$, the layer wavenumber is $\\,k_i = \\omega\\sqrt{\\mu \\epsilon_c}\\,$ and the longitudinal spectral component is $\\,k_{z,i} = \\sqrt{k_i^2 - k_\\rho^2}\\,$, with the branch chosen such that $\\,\\operatorname{Im}\\{k_{z,i}\\} \\ge 0\\,$ for physical boundedness.\n- For each polarization, define the spectral wave admittances in layer $\\,i\\,$ as $\\,Y_i^{\\mathrm{TE}} = \\frac{k_{z,i}}{\\omega \\mu}\\,$ and $\\,Y_i^{\\mathrm{TM}} = \\frac{\\omega \\epsilon_c}{k_{z,i}}\\,$. These come from the constitutive relations and plane-wave field relations. Use the transverse magnetic admittance $\\,Y_i^{\\mathrm{TM}}\\,$ for all requested outputs below.\n- Given a finite-thickness layer with thickness $\\,d_i\\,$, its axial propagation constant is $\\,\\gamma_i = j k_{z,i}\\,$.\n- The input admittance of a semi-infinite half-space is simply its wave admittance for the polarization of interest.\n\nTask to compute: For each test case below and for each specified value of $\\,k_\\rho\\,$, compute the magnitude of the transverse magnetic reflection coefficient $\\,\\Gamma^{\\mathrm{TM}}(k_\\rho)\\,$ at the interface between the top semi-infinite half-space and the rest of the stack, as seen looking into the stack from that top half-space. Your derivation must justify how to obtain $\\,\\Gamma^{\\mathrm{TM}}(k_\\rho)\\,$ using transmission-line analogies consistent with Maxwell's equations and boundary conditions. Express the outputs as unitless decimal floats.\n\nTest suite and parameters:\n- Physical constants to be used are exactly as given above. All material parameters are frequency-independent within each test case. Thicknesses $\\,d_i\\,$ must be in $\\mathrm{m}$, conductivities $\\,\\sigma\\,$ in $\\mathrm{S/m}$, and frequencies $\\,f\\,$ in $\\mathrm{Hz}$.\n\n- Test Case A (two-layer over a conductive half-space):\n  - Frequency: $\\,f = 10\\times 10^{9}\\,\\mathrm{Hz}\\,$.\n  - Top half-space (region $\\,0\\,$): $\\,\\epsilon_r = 1\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$.\n  - Finite layer $\\,1\\,$: $\\,\\epsilon_r = 4\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$, $\\,d_1 = 1.0\\times 10^{-2}\\,\\mathrm{m}\\,$.\n  - Bottom half-space (region $\\,2\\,$): $\\,\\epsilon_r = 1\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 5.8\\times 10^{7}\\,\\mathrm{S/m}\\,$.\n  - Transverse wavenumbers: $\\,k_\\rho \\in \\{ 0\\cdot k_0,\\; 0.999\\cdot k_0,\\; 1.5\\cdot k_0 \\}\\,$, where $\\,k_0\\,$ is defined above.\n\n- Test Case B (single interface to a lossy half-space):\n  - Frequency: $\\,f = 100\\times 10^{6}\\,\\mathrm{Hz}\\,$.\n  - Top half-space (region $\\,0\\,$): $\\,\\epsilon_r = 1\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$.\n  - No finite layers.\n  - Bottom half-space (region $\\,1\\,$): $\\,\\epsilon_r = 15\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 1.0\\times 10^{-2}\\,\\mathrm{S/m}\\,$.\n  - Transverse wavenumbers: $\\,k_\\rho \\in \\{ 0.5\\cdot k_0,\\; 1.001\\cdot k_0,\\; 3.0\\cdot k_0 \\}\\,$.\n\n- Test Case C (three-layer stack over a conductive half-space):\n  - Frequency: $\\,f = 3.0\\times 10^{9}\\,\\mathrm{Hz}\\,$.\n  - Top half-space (region $\\,0\\,$): $\\,\\epsilon_r = 1\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$.\n  - Finite layer $\\,1\\,$: $\\,\\epsilon_r = 2.5\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$, $\\,d_1 = 5.0\\times 10^{-3}\\,\\mathrm{m}\\,$.\n  - Finite layer $\\,2\\,$: $\\,\\epsilon_r = 9.8\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 0\\,\\mathrm{S/m}\\,$, $\\,d_2 = 2.0\\times 10^{-3}\\,\\mathrm{m}\\,$.\n  - Bottom half-space (region $\\,3\\,$): $\\,\\epsilon_r = 1\\,$, $\\,\\mu_r = 1\\,$, $\\,\\sigma = 5.8\\times 10^{7}\\,\\mathrm{S/m}\\,$.\n  - Transverse wavenumbers: $\\,k_\\rho \\in \\{ 0.0\\cdot k_0,\\; 0.8\\cdot k_0,\\; 1.2\\cdot k_0 \\}\\,$.\n\nProgram requirements:\n- Implement a program that, for each test case and each listed value of $\\,k_\\rho\\,$, computes the magnitude $\\,|\\Gamma^{\\mathrm{TM}}(k_\\rho)|\\,$ using the impedance/admittance transfer approach that follows from the fundamental base above.\n- The final output must aggregate the nine resulting magnitudes (three per test case) in the order: Test Case A values in the order listed for $\\,k_\\rho\\,$, followed by Test Case B values in the order listed, followed by Test Case C values in the order listed.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,...]\"). The results are unitless floats.\n\nAngle units are not required in this problem. Do not include any units in the numerical output; all requested outputs are unitless magnitudes as specified.",
            "solution": "The problem requires the derivation and implementation of a method to compute the transverse magnetic (TM) spectral reflection coefficient for a planar stratified medium. The derivation must originate from Maxwell's equations and electromagnetic boundary conditions, justifying the use of an admittance transfer method.\n\nThe structure of the medium consists of a top semi-infinite half-space (region $\\,0\\,$), $\\,N-1\\,$ finite layers (regions $\\,1, \\dots, N-1\\,$), and a bottom semi-infinite half-space (region $\\,N\\,$). The layers are homogeneous, isotropic, and planar, located at $\\,z=\\text{constant}\\,$ planes.\n\nWe begin with the frequency-domain, source-free Maxwell's equations, assuming an $\\,e^{j\\omega t}\\,$ time convention:\n$$ \\nabla \\times \\vec{E} = -j\\omega\\mu \\vec{H} $$\n$$ \\nabla \\times \\vec{H} = j\\omega\\epsilon_c \\vec{E} $$\nHere, $\\,\\vec{E}\\,$ and $\\,\\vec{H}\\,$ are the complex electric and magnetic field phasors, $\\,\\omega\\,$ is the angular frequency, $\\,\\mu\\,$ is the magnetic permeability, and $\\,\\epsilon_c = \\epsilon - j\\sigma/\\omega\\,$ is the complex permittivity, where $\\,\\epsilon = \\epsilon_0\\epsilon_r\\,$ and $\\,\\sigma\\,$ is the electrical conductivity.\n\nFor a planar stratified medium where properties only vary with the $\\,z\\,$ coordinate, we can perform a spatial Fourier transform in the transverse $\\,(x,y)\\,$ plane. This decomposes the fields into a continuous spectrum of plane waves. A generic field component $\\,\\psi(x,y,z)\\,$ can be written as:\n$$ \\psi(x,y,z) = \\frac{1}{(2\\pi)^2} \\iint_{-\\infty}^{\\infty} \\tilde{\\psi}(k_x, k_y, z) e^{-j(k_x x + k_y y)} dk_x dk_y $$\nDue to rotational symmetry, the physics only depends on the magnitude of the transverse wavevector, $\\,k_\\rho = \\sqrt{k_x^2 + k_y^2}\\,$. Within any homogeneous layer $\\,i\\,$, Maxwell's equations lead to a wave equation for the field components. For the chosen spectral component $\\,e^{-j(k_x x + k_y y)}\\,$, the wave equation for any field component $\\,\\tilde{\\psi}(z)\\,$ becomes:\n$$ \\left( \\frac{d^2}{dz^2} + k_i^2 - k_\\rho^2 \\right) \\tilde{\\psi}(z) = 0 $$\n$$ \\implies \\left( \\frac{d^2}{dz^2} + k_{z,i}^2 \\right) \\tilde{\\psi}(z) = 0 $$\nwhere $\\,k_i = \\omega\\sqrt{\\mu_i \\epsilon_{c,i}}\\,$ is the wavenumber in layer $\\,i\\,$, and $\\,k_{z,i} = \\sqrt{k_i^2 - k_\\rho^2}\\,$ is the longitudinal component of the wavevector. The problem specifies that the branch for the square root must be chosen such that $\\,\\operatorname{Im}\\{k_{z,i}\\} \\ge 0\\,$ to ensure physically bounded fields (decaying evanescent waves).\n\nThe general solution for $\\,\\tilde{\\psi}(z)\\,$ in layer $\\,i\\,$ is a superposition of downward-propagating ($\\,e^{-jk_{z,i}z}\\,$) and upward-propagating ($\\,e^{+jk_{z,i}z}\\,$) waves.\n\nThe electromagnetic fields can be decoupled into transverse electric (TE, with $\\,E_z=0\\,$) and transverse magnetic (TM, with $\\,H_z=0\\,$) modes. The problem concerns TM waves. For TM waves, the transverse field components (e.g., $\\,\\tilde{E}_x(z)\\,$ and $\\,\\tilde{H}_y(z)\\,$ if we align $\\,\\mathbf{k}_\\rho\\,$ with $\\,\\hat{x}\\,$) are sufficient to describe the wave behavior and satisfy boundary conditions.\n\nFor a single downward-propagating plane wave in layer $\\,i\\,$, the ratio of the transverse magnetic field to the transverse electric field defines the TM wave admittance:\n$$ Y_i^{\\mathrm{TM}} = \\frac{\\tilde{H}_y^+}{\\tilde{E}_x^+} = \\frac{\\omega \\epsilon_{c,i}}{k_{z,i}} $$\nFor an upward-propagating wave, the ratio is $\\,\\tilde{H}_y^-/\\tilde{E}_x^- = -Y_i^{\\mathrm{TM}}\\,$. The negative sign arises from the Poynting vector direction.\n\nThis allows us to model wave propagation in each layer using a transmission line analogy. The transverse electric field $\\,\\tilde{E}_x(z)\\,$ is analogous to voltage $\\,V(z)\\,$, and the transverse magnetic field $\\,\\tilde{H}_y(z)\\,$ is analogous to current $\\,I(z)\\,$. The layer itself acts as a transmission line segment with characteristic admittance $\\,Y_{0,i} = Y_i^{\\mathrm{TM}}\\,$.\n\nWe can now derive the recursive relation for the input admittance. Consider a single finite layer $\\,i\\,$ with thickness $\\,d_i\\,$, situated above a structure (layers $\\,i+1, \\dots, N\\,$) that presents a \"load\" admittance $\\,Y_L\\,$ at the interface $\\,z = z_{i+1}\\,$. We wish to find the input admittance $\\,Y_{\\text{in}}\\,$ at the top of layer $\\,i\\,$, at $\\,z = z_i\\,$.\n\nWithin layer $\\,i\\,$ (with a local coordinate $\\,z'\\,$ starting from $\\,0\\,$ at the top of the layer), the fields are:\n$$ V(z') = V_i^+ e^{-jk_{z,i}z'} + V_i^- e^{+jk_{z,i}z'} $$\n$$ I(z') = Y_i^{\\mathrm{TM}} (V_i^+ e^{-jk_{z,i}z'} - V_i^- e^{+jk_{z,i}z'}) $$\nAt the bottom of the layer ($\\,z' = d_i\\,$), the admittance is the load admittance $\\,Y_L\\,$:\n$$ Y_L = \\frac{I(d_i)}{V(d_i)} = Y_i^{\\mathrm{TM}} \\frac{V_i^+ e^{-jk_{z,i}d_i} - V_i^- e^{+jk_{z,i}d_i}}{V_i^+ e^{-jk_{z,i}d_i} + V_i^- e^{+jk_{z,i}d_i}} $$\nThe input admittance at the top of the layer ($\\,z' = 0\\,$) is:\n$$ Y_{\\text{in}} = \\frac{I(0)}{V(0)} = Y_i^{\\mathrm{TM}} \\frac{V_i^+ - V_i^-}{V_i^+ + V_i^-} $$\nLet's define the reflection coefficient at the load as $\\,\\Gamma_L = V_i^-/V_i^+\\,$. From the $\\,Y_L\\,$ expression, we can solve for the reflection ratio at $\\,z'=d_i\\,$ and relate it back. A more direct derivation, standard in transmission line theory and derived from these very field equations, gives the input admittance $\\,Y_{\\text{in}}\\,$ at a distance $\\,d_i\\,$ from a load $\\,Y_L\\,$ on a line with characteristic admittance $\\,Y_i^{\\mathrm{TM}}\\,$ and propagation constant $\\,\\gamma_i = j k_{z,i}\\,$:\n$$ Y_{\\text{in}} = Y_i^{\\mathrm{TM}} \\frac{Y_L + Y_i^{\\mathrm{TM}} \\tanh(\\gamma_i d_i)}{Y_i^{\\mathrm{TM}} + Y_L \\tanh(\\gamma_i d_i)} $$\nThis is the required admittance transfer formula, justified by its direct derivation from the wave solutions to Maxwell's equations.\n\nThis formula allows for a recursive calculation of the input admittance of the entire stack.\n1.  **Initialization**: At the bottom of the stack, we have the semi-infinite region $\\,N\\,$. Since there are no upward-propagating waves in this region, the input admittance looking into it is simply its characteristic wave admittance. Let this be our initial load, $\\,Y_L = Y_{\\text{in}}^{(N)} = Y_N^{\\mathrm{TM}}\\,$.\n2.  **Recursion**: We iterate upwards from the last finite layer ($\\,i = N-1\\,$) to the first ($\\,i=1\\,$). In each step $\\,i\\,$, we calculate the input admittance $\\,Y_{\\text{in}}^{(i)}\\,$ at the top of layer $\\,i\\,$ using the transfer formula, where $\\,Y_L = Y_{\\text{in}}^{(i+1)}\\,$ (the result from the previous step), $\\,Y_i^{\\mathrm{TM}}\\,$ and $\\,d_i\\,$ are the parameters of layer $\\,i\\,$.\n$$ Y_{\\text{in}}^{(i)} = Y_i^{\\mathrm{TM}} \\frac{Y_{\\text{in}}^{(i+1)} + Y_i^{\\mathrm{TM}} \\tanh(j k_{z,i} d_i)}{Y_i^{\\mathrm{TM}} + Y_{\\text{in}}^{(i+1)} \\tanh(j k_{z,i} d_i)} $$\n3.  **Termination**: After iterating through all finite layers, the final calculated admittance, $\\,Y_{\\text{in}}^{(1)}\\,$, is the total input admittance of the stack as seen from the top half-space (region $\\,0\\,$).\n\nFinally, we compute the reflection coefficient $\\,\\Gamma^{\\mathrm{TM}}\\,$ at the interface between the top half-space and the stack. This interface is between a medium with characteristic admittance $\\,Y_0^{\\mathrm{TM}}\\,$ and a load with admittance $\\,Y_{\\text{in}}^{(1)}\\,$. The reflection coefficient for a wave incident from region $\\,0\\,$ is given by the standard formula:\n$$ \\Gamma^{\\mathrm{TM}}(k_\\rho) = \\frac{Y_0^{\\mathrm{TM}} - Y_{\\text{in}}^{(1)}}{Y_0^{\\mathrm{TM}} + Y_{\\text{in}}^{(1)}} $$\nThe problem asks for the magnitude of this complex quantity, $\\,|\\Gamma^{\\mathrm{TM}}(k_\\rho)|\\,$.\n\nThe overall algorithm for each test case and $\\,k_\\rho\\,$ value is:\n1.  For the given frequency $\\,f\\,$, calculate the angular frequency $\\,\\omega = 2\\pi f\\,$ and free-space wavenumber $\\,k_0 = \\omega\\sqrt{\\mu_0\\epsilon_0}\\,$.\n2.  For each layer $\\,i\\,$ (including the half-spaces), calculate its properties: complex permittivity $\\,\\epsilon_{c,i}\\,$ and permeability $\\,\\mu_i\\,$, then the layer wavenumber $\\,k_i = \\omega\\sqrt{\\mu_i\\epsilon_{c,i}}\\,$.\n3.  For the specified $\\,k_\\rho\\,$, calculate the longitudinal wavenumber for each layer $\\,k_{z,i}=\\sqrt{k_i^2 - k_\\rho^2}\\,$, ensuring the branch cut is chosen so that $\\,\\operatorname{Im}\\{k_{z,i}\\} \\ge 0\\,$.\n4.  Calculate the TM wave admittance for each layer, $\\,Y_i^{\\mathrm{TM}} = \\omega\\epsilon_{c,i}/k_{z,i}\\,$.\n5.  Initialize the load admittance with that of the bottom half-space: $\\,Y_L = Y_N^{\\mathrm{TM}}\\,$.\n6.  Iterate backwards through the finite layers, applying the admittance transfer formula to update $\\,Y_L\\,$ at each step.\n7.  Using the final $\\,Y_L\\,$ (which is $\\,Y_{\\text{in}}^{(1)}\\,$) and the top half-space admittance $\\,Y_0^{\\mathrm{TM}}\\,$, calculate the reflection coefficient $\\,\\Gamma^{\\mathrm{TM}}\\,$.\n8.  The result is the magnitude $\\,|\\Gamma^{\\mathrm{TM}}|\\,$. This procedure will be implemented to solve the test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It computes the TM reflection coefficient magnitude for several stratified media configurations.\n    \"\"\"\n    \n    # Fundamental Constants\n    EPS_0 = 8.854187817e-12  # F/m\n    MU_0 = 4 * np.pi * 1e-7    # H/m\n\n    def get_layer_params(layer_props, f, k_rho):\n        \"\"\"\n        Calculates key wave parameters for a single layer.\n        \n        Args:\n            layer_props (dict): Dictionary with 'er', 'mur', 'sigma'.\n            f (float): Frequency in Hz.\n            k_rho (float): Transverse wavenumber in rad/m.\n            \n        Returns:\n            dict: Dictionary with calculated parameters 'kz' and 'Y_tm'.\n        \"\"\"\n        er = layer_props['er']\n        mur = layer_props['mur']\n        sigma = layer_props['sigma']\n        \n        omega = 2 * np.pi * f\n        \n        eps_c = EPS_0 * er - 1j * sigma / omega\n        mu = MU_0 * mur\n        \n        k_sq = omega**2 * mu * eps_c\n        kz_sq = k_sq - k_rho**2\n        \n        # Branch cut for kz: Im{kz} >= 0\n        kz = np.sqrt(kz_sq)\n        if kz.imag  0:\n            kz = -kz\n        \n        # Handle the case kz=0 to avoid division by zero, though test cases avoid it.\n        if kz == 0:\n            # Y_tm would be infinite. In practice, the admittance transfer has a\n            # well-defined limit, but this case is not expected here.\n            # Using a very small number to prevent runtime errors if encountered.\n            # However this may lead to numerical inaccuracies.\n            # A more robust implementation would switch to impedance matrices here.\n            Y_tm = np.inf\n        else:\n            Y_tm = omega * eps_c / kz\n        \n        return {'kz': kz, 'Y_tm': Y_tm}\n\n    def calculate_reflection_coefficient(f, layers, k_rho_val):\n        \"\"\"\n        Calculates the magnitude of the TM reflection coefficient for a stratified medium.\n        \n        Args:\n            f (float): Frequency in Hz.\n            layers (list): A list of dictionaries, each describing a layer from top to bottom.\n                           The first and last are semi-infinite half-spaces.\n            k_rho_val (float): The specific transverse wavenumber for this calculation.\n            \n        Returns:\n            float: The magnitude of the TM reflection coefficient.\n        \"\"\"\n        top_hs = layers[0]\n        finite_layers = layers[1:-1]\n        bottom_hs = layers[-1]\n\n        # Step 1: Initialize load admittance with the bottom half-space's characteristic admittance.\n        params_bottom = get_layer_params(bottom_hs, f, k_rho_val)\n        Y_load = params_bottom['Y_tm']\n        \n        # Step 2: Recursively transfer admittance through finite layers from bottom to top.\n        for layer_props in reversed(finite_layers):\n            d = layer_props['d']\n            params_layer = get_layer_params(layer_props, f, k_rho_val)\n            Y_char = params_layer['Y_tm']\n            kz = params_layer['kz']\n\n            gamma_d = 1j * kz * d\n            tanh_gamma_d = np.tanh(gamma_d)\n            \n            # Admittance transfer formula\n            numerator = Y_load + Y_char * tanh_gamma_d\n            denominator = Y_char + Y_load * tanh_gamma_d\n            \n            # Avoid division by zero if denominator is zero\n            if denominator == 0:\n                # This corresponds to a resonance (pole in the input admittance).\n                # The input impedance is zero, so admittance is infinite.\n                Y_load = np.inf\n            else:\n                Y_load = Y_char * (numerator / denominator)\n\n        # Step 3: Calculate reflection coefficient at the top interface.\n        params_top = get_layer_params(top_hs, f, k_rho_val)\n        Y_top = params_top['Y_tm']\n        \n        if Y_top + Y_load == 0:\n            # Pole in the reflection coefficient. Magnitude is infinite.\n            gamma_tm = np.inf\n        else:\n            gamma_tm = (Y_top - Y_load) / (Y_top + Y_load)\n        \n        return np.abs(gamma_tm)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"f\": 10e9,\n            \"layers\": [\n                {'er': 1.0, 'mur': 1.0, 'sigma': 0.0}, # Top half-space\n                {'er': 4.0, 'mur': 1.0, 'sigma': 0.0, 'd': 1.0e-2}, # Layer 1\n                {'er': 1.0, 'mur': 1.0, 'sigma': 5.8e7} # Bottom half-space\n            ],\n            \"k_rho_factors\": [0.0, 0.999, 1.5]\n        },\n        {\n            \"f\": 100e6,\n            \"layers\": [\n                {'er': 1.0, 'mur': 1.0, 'sigma': 0.0}, # Top half-space\n                {'er': 15.0, 'mur': 1.0, 'sigma': 1.0e-2} # Bottom half-space (no finite layers)\n            ],\n            \"k_rho_factors\": [0.5, 1.001, 3.0]\n        },\n        {\n            \"f\": 3.0e9,\n            \"layers\": [\n                {'er': 1.0, 'mur': 1.0, 'sigma': 0.0}, # Top half-space\n                {'er': 2.5, 'mur': 1.0, 'sigma': 0.0, 'd': 5.0e-3}, # Layer 1\n                {'er': 9.8, 'mur': 1.0, 'sigma': 0.0, 'd': 2.0e-3}, # Layer 2\n                {'er': 1.0, 'mur': 1.0, 'sigma': 5.8e7} # Bottom half-space\n            ],\n            \"k_rho_factors\": [0.0, 0.8, 1.2]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        f = case['f']\n        layers = case['layers']\n        k_rho_factors = case['k_rho_factors']\n        \n        omega = 2 * np.pi * f\n        k0 = omega * np.sqrt(MU_0 * EPS_0)\n        \n        for factor in k_rho_factors:\n            k_rho_val = factor * k0\n            result = calculate_reflection_coefficient(f, layers, k_rho_val)\n            results.append(f\"{result:.10f}\") # Format to a reasonable precision\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}