{
    "hands_on_practices": [
        {
            "introduction": "The power of Generalized Sheet Transition Conditions (GSTCs) lies in their ability to directly link a metasurface's microscopic properties to its macroscopic wave-transforming function. This first practice provides a quintessential example of this link by tasking you with designing a beam-steering metasurface. You will derive the relationship between the surface susceptibility gradient and the refraction angle, and then go a step further to analyze a crucial engineering question: how sensitive is the device's performance to unavoidable fabrication errors? ",
            "id": "3311086",
            "problem": "Consider a monoanisotropic, spatially varying Huygens metasurface occupying the plane $z=0$ in free space, designed to steer a normally incident transverse electromagnetic plane wave. The metasurface is characterized by tangential electric and magnetic surface susceptibility tensors $\\overline{\\overline{\\chi}}_{ee}(x)$ and $\\overline{\\overline{\\chi}}_{mm}(x)$, respectively, and has no magnetoelectric coupling. The incident wave propagates along $+\\hat{z}$ with electric field polarized along $\\hat{x}$ and magnetic field along $\\hat{y}$. Assume time-harmonic fields with the $\\exp(j \\omega t)$ convention, free-space wavenumber $k_{0} = \\omega \\sqrt{\\mu_{0} \\varepsilon_{0}}$, and free-space impedance $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$.\n\nStarting from Maxwell’s equations and the Generalized Sheet Transition Conditions (GSTCs), derive the transmission coefficient for a spatially uniform sheet. Then, using that local uniform-sheet result under the standard slowly varying approximation (locally uniform metasurface) and invoking the conservation of tangential wave momentum with a phase discontinuity, obtain the generalized refraction relation linking the local transmission phase gradient to the transmitted angle $\\theta_{t}$. Assume a reflectionless design achieved by local balance of tangential responses aligned with the incident fields, i.e., $\\chi_{ee}^{xx}(x) = \\chi_{mm}^{yy}(x) \\equiv \\chi(x)$, with all other tensor entries zero.\n\nDefine the beam-steering sensitivity to fabrication error via the Jacobian of the transmitted angle with respect to the susceptibility tensor entries aligned and misaligned with the polarization, evaluated at the balanced design point. Compute the Jacobian entries\n- $\\partial \\theta_{t}/\\partial \\chi_{ee}^{xx}$,\n- $\\partial \\theta_{t}/\\partial \\chi_{mm}^{yy}$,\n- $\\partial \\theta_{t}/\\partial \\chi_{ee}^{yy}$,\n- $\\partial \\theta_{t}/\\partial \\chi_{mm}^{xx}$,\nas analytic expressions in terms of $k_{0}$, the local susceptibility $\\chi(x)$, and its spatial derivative $\\partial \\chi/\\partial x$. Treat $\\chi$ as a scalar function with physical dimension of length, and assume the gradients are sufficiently small to preclude multi-order diffraction. Express your final Jacobian as a single row vector using symbolic variables only. The angle $\\theta_{t}$ must be expressed in radians. No numerical rounding is required.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and self-contained. The provided information is sufficient and consistent for deriving a unique solution based on the fundamental principles of electromagnetics.\n\nThe problem requires a multi-step derivation for a Huygens metasurface. The convention used is that susceptibilities $\\chi$ have units of length, and the GSTCs take the form:\n$$\n\\hat{n} \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = j\\omega\\epsilon_0\\overline{\\overline{\\chi}}_{ee} \\cdot \\mathbf{E}_{\\mathrm{avg}}\n$$\n$$\n\\hat{n} \\times (\\mathbf{E}_2 - \\mathbf{E}_1) = -j\\omega\\mu_0\\overline{\\overline{\\chi}}_{mm} \\cdot \\mathbf{H}_{\\mathrm{avg}}\n$$\nThe incident wave is a normally incident TEM plane wave:\n$$\n\\mathbf{E}_i = E_0 \\hat{x} \\exp(-jk_0 z) \\quad, \\quad \\mathbf{H}_i = \\frac{E_0}{\\eta_0} \\hat{y} \\exp(-jk_0 z)\n$$\nThe total fields for $z  0$ include reflected waves ($R$) and for $z  0$ consist of transmitted waves ($T$):\n$$\n\\mathbf{E}_r = R E_0 \\hat{x} \\exp(jk_0 z) \\quad, \\quad \\mathbf{H}_r = -R \\frac{E_0}{\\eta_0} \\hat{y} \\exp(jk_0 z)\n$$\n$$\n\\mathbf{E}_t = T E_0 \\hat{x} \\exp(-jk_0 z) \\quad, \\quad \\mathbf{H}_t = T \\frac{E_0}{\\eta_0} \\hat{y} \\exp(-jk_0 z)\n$$\nAt the interface $z=0$, the fields are:\n$\\mathbf{E}_{z=0^-} = (1+R)E_0\\hat{x}$, $\\mathbf{H}_{z=0^-} = (1-R)\\frac{E_0}{\\eta_0}\\hat{y}$\n$\\mathbf{E}_{z=0^+} = T E_0\\hat{x}$, $\\mathbf{H}_{z=0^+} = T \\frac{E_0}{\\eta_0}\\hat{y}$\n\nThe average fields at $z=0$ are:\n$\\mathbf{E}_{\\text{avg}} = \\frac{1}{2}(T+1+R)E_0\\hat{x}$\n$\\mathbf{H}_{\\text{avg}} = \\frac{1}{2}(T+1-R)\\frac{E_0}{\\eta_0}\\hat{y}$\n\nSubstitute these into the GSTCs. For the E-field jump:\n$\\hat{z} \\times (\\mathbf{E}_{z=0^+} - \\mathbf{E}_{z=0^-}) = (T-1-R)E_0\\hat{y}$\n$-j\\omega\\mu_0\\overline{\\overline{\\chi}}_{mm} \\cdot \\mathbf{H}_{\\text{avg}} = -j k_0 \\eta_0 \\chi_{mm}^{yy} \\frac{1}{2}(T+1-R)\\frac{E_0}{\\eta_0}\\hat{y}$\nEquating these gives:\n$$\nT - 1 - R = -j\\frac{k_0 \\chi_{mm}^{yy}}{2} (T-R+1) \\quad (1)\n$$\nFor the H-field jump:\n$\\hat{z} \\times (\\mathbf{H}_{z=0^+} - \\mathbf{H}_{z=0^-}) = -(T+R-1)\\frac{E_0}{\\eta_0}\\hat{x}$\n$j\\omega\\epsilon_0\\overline{\\overline{\\chi}}_{ee} \\cdot \\mathbf{E}_{\\text{avg}} = j \\frac{k_0}{\\eta_0} \\chi_{ee}^{xx} \\frac{1}{2}(T+1+R)E_0\\hat{x}$\nEquating these gives:\n$$\n-(T+R-1) = j\\frac{k_0 \\chi_{ee}^{xx}}{2} (T+R+1) \\implies 1 - T - R = j\\frac{k_0 \\chi_{ee}^{xx}}{2} (T+R+1) \\quad (2)\n$$\nThis is a system of two linear equations for $R$ and $T$. A reflectionless design ($R=0$) requires both equations to be satisfied.\nSet $R=0$:\nFrom (1): $T-1 = -j\\frac{k_0 \\chi_{mm}^{yy}}{2}(T+1)$\nFrom (2): $1-T = j\\frac{k_0 \\chi_{ee}^{xx}}{2}(T+1) \\implies T-1 = -j\\frac{k_0 \\chi_{ee}^{xx}}{2}(T+1)$\nFor these to be consistent, we must have $\\chi_{ee}^{xx} = \\chi_{mm}^{yy}$. This is the Huygens' condition for this polarization. Let $\\chi_{ee}^{xx} = \\chi_{mm}^{yy} \\equiv \\chi(x)$.\nThe transmission coefficient is then found by solving $T-1 = -j\\frac{k_0 \\chi}{2}(T+1)$:\n$T(1+j\\frac{k_0\\chi}{2}) = 1-j\\frac{k_0\\chi}{2} \\implies T = \\frac{1-j\\frac{k_0\\chi}{2}}{1+j\\frac{k_0\\chi}{2}}$.\nThis is a pure phase term. The transmission phase $\\phi_t$ is its argument:\n$$\n\\phi_t(x) = \\arg(T(x)) = -2 \\arctan\\left(\\frac{k_0 \\chi(x)}{2}\\right)\n$$\nUnder the slowly varying approximation, the generalized Snell's law gives the refraction angle $\\theta_t$:\n$$\nk_0 \\sin(\\theta_t) = \\frac{d\\phi_t}{dx}\n$$\nSo $\\theta_t = \\arcsin\\left(\\frac{1}{k_0}\\frac{d\\phi_t}{dx}\\right)$.\nFor the sensitivity analysis, we need the derivative of $\\theta_t$ with respect to the susceptibility components. Using the chain rule:\n$$\n\\frac{\\partial \\theta_t}{\\partial \\chi_{ij}} = \\frac{\\partial \\theta_t}{\\partial \\sin\\theta_t} \\frac{\\partial \\sin\\theta_t}{\\partial \\phi_t} \\frac{\\partial \\phi_t}{\\partial \\chi_{ij}} = \\frac{1}{\\cos\\theta_t} \\frac{1}{k_0} \\frac{d}{dx}\\left(\\frac{\\partial \\phi_t}{\\partial \\chi_{ij}}\\right)\n$$\nwhere we assume we can swap the order of differentiation. To find $\\partial \\phi_t / \\partial \\chi_{ij}$, we must use the general expression for $T$ before applying the balance condition.\nThe general expression for $T$ is $T = \\frac{1 + k_0^2 \\chi_{ee}^{xx} \\chi_{mm}^{yy}/4}{1 + j \\frac{k_0}{2} (\\chi_{ee}^{xx}+\\chi_{mm}^{yy}) - k_0^2 \\chi_{ee}^{xx} \\chi_{mm}^{yy}/4}$.\nThe phase is $\\phi_t = \\arg(T) = \\arctan\\left(\\frac{-\\text{Im}(T)}{\\text{Re}(T)}\\right) = \\arctan\\left( \\frac{-2k_0(\\chi_{ee}^{xx}+\\chi_{mm}^{yy})}{4 - k_0^2 \\chi_{ee}^{xx} \\chi_{mm}^{yy}} \\right)$.\nThe derivative with respect to $\\chi_{ee}^{xx}$, evaluated at the balanced point $\\chi_{ee}^{xx}=\\chi_{mm}^{yy}=\\chi(x)$, is:\n$$\n\\frac{\\partial \\phi_t}{\\partial \\chi_{ee}^{xx}}\\bigg|_{\\text{bal}} = \\frac{-2k_0}{4+k_0^2\\chi^2}\n$$\nBy symmetry, the derivative with respect to $\\chi_{mm}^{yy}$ is identical.\nNow, we take the spatial derivative:\n$$\n\\frac{d}{dx}\\left(\\frac{\\partial \\phi_t}{\\partial \\chi_{ee}^{xx}}\\right) = \\frac{d}{dx}\\left(\\frac{-2k_0}{4+k_0^2\\chi(x)^2}\\right) = \\frac{4k_0^3 \\chi \\frac{\\partial\\chi}{\\partial x}}{(4+k_0^2\\chi^2)^2}\n$$\nAt the balanced point, the phase gradient is:\n$\\frac{d\\phi_t}{dx} = \\frac{d}{dx}\\left(-2\\arctan\\left(\\frac{k_0\\chi}{2}\\right)\\right) = \\frac{-4k_0\\frac{\\partial\\chi}{\\partial x}}{4+k_0^2\\chi^2}$.\nSo, $\\sin\\theta_t = \\frac{1}{k_0}\\frac{d\\phi_t}{dx} = \\frac{-4\\frac{\\partial\\chi}{\\partial x}}{4+k_0^2\\chi^2}$.\nAnd $\\cos\\theta_t = \\sqrt{1-\\sin^2\\theta_t} = \\frac{\\sqrt{(4+k_0^2\\chi^2)^2 - 16(\\frac{\\partial\\chi}{\\partial x})^2}}{4+k_0^2\\chi^2}$.\nAssembling the derivative $\\partial \\theta_t / \\partial \\chi_{ee}^{xx}$:\n$$\n\\frac{\\partial \\theta_t}{\\partial \\chi_{ee}^{xx}} = \\frac{1}{k_0 \\cos\\theta_t} \\frac{d}{dx}\\left(\\frac{\\partial \\phi_t}{\\partial \\chi_{ee}^{xx}}\\right) = \\frac{1}{k_0} \\frac{4+k_0^2\\chi^2}{\\sqrt{(4+k_0^2\\chi^2)^2 - 16(\\frac{\\partial\\chi}{\\partial x})^2}} \\frac{4k_0^3 \\chi \\frac{\\partial\\chi}{\\partial x}}{(4+k_0^2\\chi^2)^2} = \\frac{4k_0^2 \\chi \\frac{\\partial\\chi}{\\partial x}}{(4+k_0^2\\chi^2)\\sqrt{(4+k_0^2\\chi^2)^2 - 16(\\frac{\\partial\\chi}{\\partial x})^2}}\n$$\nThe result for $\\partial \\theta_t / \\partial \\chi_{mm}^{yy}$ is identical.\nFor the misaligned components, $\\chi_{ee}^{yy}$ and $\\chi_{mm}^{xx}$, their effect on the $\\hat{x}$-polarized incident wave must be analyzed. At the balanced design point, the susceptibility tensor is diagonal. The incident electric field is purely $\\hat{x}$-polarized, and the magnetic field is $\\hat{y}$-polarized. The GSTCs show that $\\Delta H_y$ depends on $E_x$ via $\\chi_{ee}^{xx}$, and $\\Delta E_x$ depends on $H_y$ via $\\chi_{mm}^{yy}$. The components $\\chi_{ee}^{yy}$ and $\\chi_{mm}^{xx}$ couple to $E_y$ and $H_x$ respectively. Since these field components are zero for the incident wave and are not excited by the primary interaction, a small perturbation in $\\chi_{ee}^{yy}$ or $\\chi_{mm}^{xx}$ has no first-order effect on the transmission coefficient $T$ for the original polarization.\nTherefore, $\\frac{\\partial \\phi_t}{\\partial \\chi_{ee}^{yy}} = 0$ and $\\frac{\\partial \\phi_t}{\\partial \\chi_{mm}^{xx}} = 0$.\nConsequently, their contributions to the Jacobian are zero.\nThe Jacobian is a row vector of these four partial derivatives.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{4k_{0}^{2} \\chi(x) \\frac{\\partial \\chi}{\\partial x}}{\\left(4+k_{0}^{2}\\chi(x)^{2}\\right)\\sqrt{\\left(4+k_{0}^{2}\\chi(x)^{2}\\right)^{2} - 16\\left(\\frac{\\partial \\chi}{\\partial x}\\right)^{2}}}  \\frac{4k_{0}^{2} \\chi(x) \\frac{\\partial \\chi}{\\partial x}}{\\left(4+k_{0}^{2}\\chi(x)^{2}\\right)\\sqrt{\\left(4+k_{0}^{2}\\chi(x)^{2}\\right)^{2} - 16\\left(\\frac{\\partial \\chi}{\\partial x}\\right)^{2}}}  0  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "After designing a theoretical metasurface, the next logical step is to consider how one might characterize it experimentally. This exercise shifts the perspective to the inverse problem: instead of predicting behavior from known properties, you will determine what measurements are required to retrieve the unknown properties of a metasurface. By establishing the minimal set of illuminations and polarizations needed, you will derive the fundamental identifiability conditions for a magnetoelectric sheet, a cornerstone concept in electromagnetic metrology. ",
            "id": "3311113",
            "problem": "Consider a zero-thickness planar metasurface located at $z=0$ in free space, modeled by Generalized Sheet Transition Conditions (GSTCs). Assume time-harmonic fields with the phasor convention $\\exp(j \\omega t)$, and that the metasurface is anisotropic and possibly nonreciprocal, but its only nonzero sheet susceptibility is the tangential magnetoelectric cross-susceptibility tensor $\\overline{\\overline{\\chi}}_{em}$ (i.e., $\\overline{\\overline{\\chi}}_{ee}=\\overline{\\overline{\\chi}}_{mm}=\\overline{\\overline{\\chi}}_{me}=\\overline{\\overline{0}}$). The tensor $\\overline{\\overline{\\chi}}_{em}$ is a $2 \\times 2$ complex-valued matrix acting on tangential field components.\n\nYou can illuminate the sheet from $z0$ with time-harmonic plane waves of arbitrary incidence angle and polarization, and you can measure the complex tangential electromagnetic fields immediately above ($z=0^{+}$) and below ($z=0^{-}$) the sheet. Define the tangential field jump and average vectors\n$$\n\\Delta \\mathbf{H}_{t} \\triangleq \\mathbf{H}_{t}(0^{+}) - \\mathbf{H}_{t}(0^{-}), \\qquad \\mathbf{H}_{\\text{avg},t} \\triangleq \\frac{\\mathbf{H}_{t}(0^{+}) + \\mathbf{H}_{t}(0^{-})}{2},\n$$\nwith an analogous definition for the tangential electric field. Let $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$ be the unit normal.\n\nStarting from Maxwell’s equations and standard electromagnetic boundary relations, specialize the GSTCs to this magnetoelectric-only sheet and derive the linear relation between $\\Delta \\mathbf{H}_{t}$, $\\mathbf{H}_{\\text{avg},t}$, and $\\overline{\\overline{\\chi}}_{em}$. Use this relation to formulate the inverse problem of retrieving all four complex entries of $\\overline{\\overline{\\chi}}_{em}$ from plane-wave illuminations. Treat each distinct polarization state as one “excitation,” and each distinct incidence direction (angle and side) as one “illumination.” You may assume all measured quantities (including complex phases) are known without error.\n\nDetermine the minimal number of illuminations and the minimal number of polarization excitations required to uniquely retrieve the full $\\overline{\\overline{\\chi}}_{em}$ for the anisotropic, possibly nonreciprocal sheet, and rigorously derive the identifiability conditions on the chosen excitations that guarantee a unique solution. Express your final numerical answer as a row matrix $\\begin{pmatrix}N_{\\text{illum}}  N_{\\text{pol}}\\end{pmatrix}$, where $N_{\\text{illum}}$ is the minimal number of illuminations and $N_{\\text{pol}}$ is the minimal number of polarization excitations. No rounding is required, and no units are needed in the final numerical answer.",
            "solution": "The problem asks for the minimum number of plane-wave illuminations and polarization excitations required to uniquely determine the four complex entries of the tangential magnetoelectric susceptibility tensor $\\overline{\\overline{\\chi}}_{em}$ of a zero-thickness planar metasurface.\n\nFirst, we establish the relevant boundary conditions by specializing the Generalized Sheet Transition Conditions (GSTCs). The GSTCs relate the discontinuities in the tangential fields across a surface to the effective surface polarization densities ($\\mathbf{P}_s$) and magnetization densities ($\\mathbf{M}_s$) induced on the sheet. These densities are, in turn, related to the average tangential fields. The boundary conditions derived from the integral form of Maxwell's equations are:\n$$\n\\hat{\\mathbf{n}} \\times (\\mathbf{E}(0^+) - \\mathbf{E}(0^-)) = -\\mathbf{J}_m\n$$\n$$\n\\hat{\\mathbf{n}} \\times (\\mathbf{H}(0^+) - \\mathbf{H}(0^-)) = \\mathbf{J}_e\n$$\nwhere $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$ is the unit normal to the sheet at $z=0$, and $\\mathbf{J}_e$ and $\\mathbf{J}_m$ are the effective surface electric and magnetic current densities, respectively. The field jumps are defined as $\\Delta \\mathbf{F} \\triangleq \\mathbf{F}(0^+) - \\mathbf{F}(0^-)$. The surface currents are related to the surface polarization and magnetization densities by $\\mathbf{J}_e = j\\omega \\mathbf{P}_s$ and $\\mathbf{J}_m = j\\omega \\mathbf{M}_s^{\\text{eff}}$ for time-harmonic fields $\\exp(j \\omega t)$.\n\nThe surface densities are constitutively related to the average tangential fields, $\\mathbf{E}_{\\text{avg},t} \\triangleq (\\mathbf{E}_t(0^+) + \\mathbf{E}_t(0^-))/2$ and $\\mathbf{H}_{\\text{avg},t} \\triangleq (\\mathbf{H}_t(0^+) + \\mathbf{H}_t(0^-))/2$, through the susceptibility tensors:\n$$\n\\mathbf{P}_s = \\epsilon_0 \\left( \\overline{\\overline{\\chi}}_{ee} \\cdot \\mathbf{E}_{\\text{avg},t} + \\overline{\\overline{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t} \\right)\n$$\n$$\n\\mathbf{M}_s = \\mu_0 \\left( \\overline{\\overline{\\chi}}_{me} \\cdot \\mathbf{E}_{\\text{avg},t} + \\overline{\\overline{\\chi}}_{mm} \\cdot \\mathbf{H}_{\\text{avg},t} \\right)\n$$\nThe problem states that only the tangential magnetoelectric susceptibility $\\overline{\\overline{\\chi}}_{em}$ is non-zero, i.e., $\\overline{\\overline{\\chi}}_{ee} = \\overline{\\overline{\\chi}}_{mm} = \\overline{\\overline{\\chi}}_{me} = \\overline{\\overline{0}}$. Substituting these into the constitutive relations gives:\n$$\n\\mathbf{P}_s = \\epsilon_0 \\overline{\\overline{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t} \\implies \\mathbf{J}_e = j\\omega\\epsilon_0 \\overline{\\overline{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t}\n$$\n$$\n\\mathbf{M}_s = \\overline{\\overline{0}} \\implies \\mathbf{J}_m = \\overline{\\overline{0}}\n$$\nSubstituting these specialized currents into the boundary conditions yields:\n1. For the electric field: $\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{E}_t = -\\mathbf{J}_m = \\mathbf{0}$. Since $\\Delta \\mathbf{E}_t$ is a tangential vector, this implies $\\Delta \\mathbf{E}_t = \\mathbf{0}$. The tangential electric field is continuous across the sheet.\n2. For the magnetic field: $\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = \\mathbf{J}_e$. Substituting the expression for $\\mathbf{J}_e$, we get:\n$$\n\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = j\\omega\\epsilon_0 \\overline{\\overline{\\chi}}_{em} \\cdot \\mathbf{H}_{\\text{avg},t}\n$$\nThis vector equation represents the desired linear relationship between the measurable quantities $\\Delta \\mathbf{H}_t$ and $\\mathbf{H}_{\\text{avg},t}$, and the unknown tensor $\\overline{\\overline{\\chi}}_{em}$.\n\nTo formulate the inverse problem, we express this relation in matrix form. Let the tangential vectors be represented by $2 \\times 1$ column vectors in the $(\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}})$ basis.\n$\\Delta \\mathbf{H}_t = \\Delta H_x \\hat{\\mathbf{x}} + \\Delta H_y \\hat{\\mathbf{y}}$.\nThe cross product with $\\hat{\\mathbf{z}}$ is $\\hat{\\mathbf{z}} \\times \\Delta \\mathbf{H}_t = \\Delta H_y \\hat{\\mathbf{x}} - \\Delta H_x \\hat{\\mathbf{y}}$.\nLet the unknown $2 \\times 2$ complex tensor be $\\overline{\\overline{\\chi}}_{em} = \\begin{pmatrix} \\chi_{xx}  \\chi_{xy} \\\\ \\chi_{yx}  \\chi_{yy} \\end{pmatrix}$.\nThe vector equation becomes:\n$$\n\\begin{pmatrix} \\Delta H_y \\\\ -\\Delta H_x \\end{pmatrix} = j\\omega\\epsilon_0 \\begin{pmatrix} \\chi_{xx}  \\chi_{xy} \\\\ \\chi_{yx}  \\chi_{yy} \\end{pmatrix} \\begin{pmatrix} H_{\\text{avg},x} \\\\ H_{\\text{avg},y} \\end{pmatrix}\n$$\nThis system provides two complex linear equations for the four complex unknowns of $\\overline{\\overline{\\chi}}_{em}$.\n$$\n\\Delta H_y = j\\omega\\epsilon_0 (\\chi_{xx} H_{\\text{avg},x} + \\chi_{xy} H_{\\text{avg},y})\n$$\n$$\n-\\Delta H_x = j\\omega\\epsilon_0 (\\chi_{yx} H_{\\text{avg},x} + \\chi_{yy} H_{\\text{avg},y})\n$$\nThe system decouples into two independent problems: one for the first row of $\\overline{\\overline{\\chi}}_{em}$ $(\\chi_{xx}, \\chi_{xy})$ and one for the second row $(\\chi_{yx}, \\chi_{yy})$. Let's analyze the first problem:\n$$\n\\frac{\\Delta H_y}{j\\omega\\epsilon_0} = \\chi_{xx} H_{\\text{avg},x} + \\chi_{xy} H_{\\text{avg},y}\n$$\nThis is one linear equation with two unknowns. To solve for $\\chi_{xx}$ and $\\chi_{xy}$, we need a second, linearly independent equation. This requires a second measurement, denoted by superscript $(2)$, obtained from a different excitation.\n$$\nH_{\\text{avg},x}^{(1)} \\chi_{xx} + H_{\\text{avg},y}^{(1)} \\chi_{xy} = \\frac{\\Delta H_y^{(1)}}{j\\omega\\epsilon_0}\n$$\n$$\nH_{\\text{avg},x}^{(2)} \\chi_{xx} + H_{\\text{avg},y}^{(2)} \\chi_{xy} = \\frac{\\Delta H_y^{(2)}}{j\\omega\\epsilon_0}\n$$\nThis system can be written in matrix form as:\n$$\n\\begin{pmatrix} H_{\\text{avg},x}^{(1)}  H_{\\text{avg},y}^{(1)} \\\\ H_{\\text{avg},x}^{(2)}  H_{\\text{avg},y}^{(2)} \\end{pmatrix} \\begin{pmatrix} \\chi_{xx} \\\\ \\chi_{xy} \\end{pmatrix} = \\frac{1}{j\\omega\\epsilon_0} \\begin{pmatrix} \\Delta H_y^{(1)} \\\\ \\Delta H_y^{(2)} \\end{pmatrix}\n$$\nA unique solution for $(\\chi_{xx}, \\chi_{xy})$ exists if and only if the matrix of coefficients is invertible. This requires its determinant to be non-zero: $H_{\\text{avg},x}^{(1)} H_{\\text{avg},y}^{(2)} - H_{\\text{avg},y}^{(1)} H_{\\text{avg},x}^{(2)} \\neq 0$. This is the condition that the two tangential vectors $\\mathbf{H}_{\\text{avg},t}^{(1)}$ and $\\mathbf{H}_{\\text{avg},t}^{(2)}$ are linearly independent. The same two measurements, under the same condition, will allow for the unique determination of $(\\chi_{yx}, \\chi_{yy})$ from the second decoupled system.\nThus, the identifiability condition for retrieving the full tensor $\\overline{\\overline{\\chi}}_{em}$ is that we must perform at least two measurements that generate two linearly independent average tangential magnetic field vectors.\n\nNow we relate $\\mathbf{H}_{\\text{avg},t}$ to the incident plane wave. For a plane wave incident from $z0$, the total tangential fields at $z=0^-$ are the sum of incident (i) and reflected (r) components, $\\mathbf{H}_t(0^-) = \\mathbf{H}_{i,t} + \\mathbf{H}_{r,t}$. At $z=0^+$, the field is the transmitted (t) component, $\\mathbf{H}_t(0^+) = \\mathbf{H}_{t,t}$. The wave admittance tensor $\\overleftrightarrow{Y}$ relates tangential magnetic and electric fields, $\\mathbf{H}_t = \\overleftrightarrow{Y} \\cdot \\mathbf{E}_t$. For a wave propagating in the $+z$ direction, $\\mathbf{H}_t = \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_t$, and for one in the $-z$ direction, $\\mathbf{H}_t = -\\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_t$.\nThus, we have $\\mathbf{H}_{i,t} = \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{i,t}$, $\\mathbf{H}_{r,t} = -\\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{r,t}$, and $\\mathbf{H}_{t,t} = \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{t,t}$.\nThe average tangential magnetic field is:\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2}\\left(\\mathbf{H}_t(0^+) + \\mathbf{H}_t(0^-)\\right) = \\frac{1}{2}\\left(\\mathbf{H}_{t,t} + \\mathbf{H}_{i,t} + \\mathbf{H}_{r,t}\\right)\n$$\nUsing the admittances:\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2}\\left(\\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{t,t} + \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{i,t} - \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{r,t}\\right) = \\frac{1}{2} \\overleftrightarrow{Y}_i \\cdot (\\mathbf{E}_{t,t} + \\mathbf{E}_{i,t} - \\mathbf{E}_{r,t})\n$$\nThe continuity of the tangential electric field, $\\Delta \\mathbf{E}_t = \\mathbf{0}$, means $\\mathbf{E}_t(0^+) = \\mathbf{E}_t(0^-)$, which implies $\\mathbf{E}_{t,t} = \\mathbf{E}_{i,t} + \\mathbf{E}_{r,t}$. Substituting $\\mathbf{E}_{r,t} = \\mathbf{E}_{t,t} - \\mathbf{E}_{i,t}$ into the expression for $\\mathbf{H}_{\\text{avg},t}$:\n$$\n\\mathbf{H}_{\\text{avg},t} = \\frac{1}{2} \\overleftrightarrow{Y}_i \\cdot (\\mathbf{E}_{t,t} + \\mathbf{E}_{i,t} - (\\mathbf{E}_{t,t} - \\mathbf{E}_{i,t})) = \\frac{1}{2} \\overleftrightarrow{Y}_i \\cdot (2\\mathbf{E}_{i,t}) = \\overleftrightarrow{Y}_i \\cdot \\mathbf{E}_{i,t} = \\mathbf{H}_{i,t}\n$$\nThis crucial result shows that the average tangential magnetic field is equal to the incident tangential magnetic field. Therefore, the identifiability condition simplifies: to retrieve $\\overline{\\overline{\\chi}}_{em}$, we must illuminate the sheet with two excitations that produce two linearly independent incident tangential magnetic field vectors, $\\mathbf{H}_{i,t}^{(1)}$ and $\\mathbf{H}_{i,t}^{(2)}$.\n\nA single illumination is defined by a fixed incident wavevector $\\mathbf{k}_i$. For any such illumination (either normal or oblique incidence), we can choose two orthogonal polarization states. For example, for an oblique incidence in the $xz$-plane, one can use a TE-polarized wave (s-pol, $\\mathbf{E}_i \\propto \\hat{\\mathbf{y}}$) and a TM-polarized wave (p-pol, $\\mathbf{H}_i \\propto \\hat{\\mathbf{y}}$).\n- For the TE case, $\\mathbf{H}_{i,t}$ will have components along $\\hat{\\mathbf{x}}$.\n- For the TM case, $\\mathbf{H}_{i,t}$ will be along $\\hat{\\mathbf{y}}$.\nThese two vectors $\\mathbf{H}_{i,t}^{(TE)}$ and $\\mathbf{H}_{i,t}^{(TM)}$ are orthogonal and thus linearly independent. The same conclusion holds for normal incidence using two orthogonal linear polarizations (e.g., $x$- and $y$-polarized). Thus, the two required measurements can be achieved with a single illumination direction by using two different polarization excitations.\n\nThe minimal number of illuminations is therefore $N_{\\text{illum}} = 1$.\nThe minimal number of polarization excitations required for that illumination is $N_{\\text{pol}} = 2$.\nThis constitutes a minimal set of two total measurements.\n\nThe final identifiability condition is that the chosen set of excitations must produce a set of incident tangential magnetic field vectors $\\{\\mathbf{H}_{i,t}^{(k)}\\}$ that spans the 2D tangential plane. For the minimal case of two excitations, this means that the vectors $\\mathbf{H}_{i,t}^{(1)}$ and $\\mathbf{H}_{i,t}^{(2)}$ must be linearly independent.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  2\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Translating analytical models into robust numerical simulations is a core task in computational electromagnetics. This problem guides you through the process of integrating GSTCs into a powerful frequency-domain numerical technique: the boundary integral equation (BIE) method solved with the Method of Moments (MoM). You will not only derive the integral equation that governs scattering from the metasurface but also confront and solve the challenge of ill-conditioning by implementing a sophisticated regularization scheme based on a Calderón identity, ensuring your numerical model is both accurate and stable. ",
            "id": "3311059",
            "problem": "You are asked to derive, discretize, and analyze a boundary integral formulation for a two-dimensional transverse-electric scattering problem involving a zero-thickness metasurface described by Generalized Sheet Transition Conditions (GSTCs). Your task is to (i) start from Maxwell's equations and GSTCs to obtain a scalar Helmholtz boundary integral equation with an added singular surface operator, (ii) introduce a Calderón-based regularization using a known identity, (iii) implement a spectral Method of Moments (MoM) on a circular contour where the operators diagonalize in the Fourier basis, and (iv) compute and report condition numbers that quantify the effect of regularization.\n\nAssumptions and fundamental base:\n- The background medium is homogeneous, isotropic, and non-dispersive free space, with permittivity $\\epsilon_0$, permeability $\\mu_0$, and speed of light $c_0 = \\frac{1}{\\sqrt{\\mu_0 \\epsilon_0}}$. Use $c_0 = 299792458\\,\\text{m/s}$ exactly.\n- Time dependence is $e^{j \\omega t}$, where $\\omega = 2 \\pi f$ and the free-space wavenumber is $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0} = \\frac{2 \\pi f}{c_0}$.\n- Consider two-dimensional transverse-electric (TE) polarization with the nonzero electric field component $E_z(\\mathbf{r})$, which we denote by $u(\\mathbf{r})$, satisfying the scalar Helmholtz equation $\\nabla^2 u + k_0^2 u = 0$ away from the sheet.\n- The metasurface lies on a smooth, closed, zero-thickness contour $\\Gamma$ (a circle of radius $a$), and is characterized by a purely electric surface susceptibility $\\chi_{\\mathrm{ee}}$ (dimensionless), with no magnetic susceptibility. The Generalized Sheet Transition Conditions (GSTCs) for this case reduce to continuity of the tangential electric field across the sheet and a jump in tangential magnetic field proportional to the average tangential electric field. For TE in two dimensions, this yields the scalar conditions on $\\Gamma$: $u^+ = u^-$ and $\\partial_n u^+ - \\partial_n u^- = - k_0^2 \\chi_{\\mathrm{ee}} u$, where $\\partial_n$ denotes the normal derivative and $+$/$-$ denote limits from the two sides of $\\Gamma$.\n- Use the free-space two-dimensional Green's function $G(\\mathbf{r},\\mathbf{r}') = \\frac{j}{4} H_0^{(1)}(k_0 |\\mathbf{r}-\\mathbf{r}'|)$, where $H_0^{(1)}$ is the Hankel function of the first kind and order zero, for the scalar Helmholtz equation.\n\nDerivation target (do not use any shortcut formulas in the problem statement; derive them in your solution):\n1. Represent the scattered field $u_{\\mathrm{sc}}$ by the single-layer potential $S[\\varphi](\\mathbf{r}) = \\int_{\\Gamma} G(\\mathbf{r},\\mathbf{r}') \\varphi(\\mathbf{r}') \\, \\mathrm{d}s'$, where $\\varphi$ is an unknown density. Use the jump relations associated with the single-layer potential and the GSTC to derive a boundary integral equation of the form\n   $$\n   \\left(I + \\alpha S\\right) \\varphi = g,\n   $$\n   where $I$ is the identity operator on $\\Gamma$, $S$ is the single-layer boundary operator, $\\alpha$ is a parameter depending on $k_0$ and $\\chi_{\\mathrm{ee}}$, and $g$ depends on the incident field restricted to $\\Gamma$. This equation must explicitly show the addition of a singular surface operator to the identity.\n2. Introduce a Calderón-based regularization by applying the hypersingular-single-layer composition that is known to satisfy the Calderón identity on smooth closed curves:\n   $$\n   N S = -\\tfrac{1}{4} I + K'^2,\n   $$\n   where $N$ is the hypersingular boundary operator (mapping Dirichlet data to Neumann data), and $K'$ is the adjoint double-layer boundary operator. Use this identity to define a left-multiplied regularized operator\n   $$\n   \\mathcal{C} \\left(I + \\alpha S\\right),\n   $$\n   where $\\mathcal{C} = -\\tfrac{1}{4} I + K'^2$. You must argue why this multiplication improves conditioning in a Method of Moments discretization.\n3. For a circle of radius $a$ parameterized by the polar angle $\\theta \\in [0, 2\\pi)$, use Graf's addition theorem to show that in the Fourier basis $\\{ e^{j n \\theta} \\}_{n \\in \\mathbb{Z}}$, the operators $S$ and $K'$ are diagonal, and derive expressions for their Fourier eigenvalues:\n   - For $S$, show that $S[e^{j n \\theta}] = s_n e^{j n \\theta}$ with $s_n$ depending on $k_0 a$.\n   - For $K'$, show that $K'[e^{j n \\theta}] = k'_n e^{j n \\theta}$ with $k'_n$ depending on $k_0 a$ and derivatives of Bessel and Hankel functions. Then show that $\\mathcal{C}$ is also diagonal with eigenvalues $c_n = -\\tfrac{1}{4} + (k'_n)^2$.\n4. Using the Fourier spectral MoM (truncating to modes $n = -M, \\ldots, M$ for some nonnegative integer $M$), compute the condition numbers\n   $$\n   \\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_n |1 + \\alpha s_n|}{\\min_n |1 + \\alpha s_n|}, \\quad \\kappa\\left(\\mathcal{C}(I + \\alpha S)\\right) = \\frac{\\max_n |c_n (1 + \\alpha s_n)|}{\\min_n |c_n (1 + \\alpha s_n)|}.\n   $$\n   The condition numbers are to be computed as spectral condition numbers in the truncated Fourier basis.\n\nImplementation requirements:\n- Constants and units: Use $c_0 = 299792458\\,\\text{m/s}$, frequency $f$ in $\\text{Hz}$, radius $a$ in $\\text{m}$, and susceptibility $\\chi_{\\mathrm{ee}}$ dimensionless. Angles are in radians. The outputs (condition numbers) are dimensionless real numbers.\n- Numerical specification for operators in the circular Fourier basis:\n  - Let $x = k_0 a$. For each integer mode $n$, the eigenvalues must be implemented as\n    $$\n    s_n = j \\frac{\\pi a}{2} H_n^{(1)}(x) J_n(x),\n    $$\n    $$\n    k'_n = j \\frac{\\pi a k_0}{4} \\left[ H_n^{(1)\\,'}(x) J_n(x) + H_n^{(1)}(x) J_n'(x) \\right],\n    $$\n    $$\n    c_n = -\\frac{1}{4} + \\left(k'_n\\right)^2,\n    $$\n    where $J_n$ and $J_n'$ are the Bessel function of the first kind and its derivative, and $H_n^{(1)}$ and $H_n^{(1)\\,'}$ are the Hankel function of the first kind and its derivative.\n  - Use $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$.\n  - Truncate to modes $n = -M, \\ldots, M$ and use symmetry as needed to compute condition numbers accurately.\n- Test suite: Your program must compute condition numbers for the following parameter sets, each specified as a quadruple $(f, a, \\chi_{\\mathrm{ee}}, M)$:\n  - Test $1$ (happy path): $(1.0 \\times 10^9, 0.5, 0.01, 20)$.\n  - Test $2$ (boundary case with no metasurface): $(1.0 \\times 10^9, 0.5, 0.0, 20)$.\n  - Test $3$ (edge case with stronger sheet and more modes): $(6.0 \\times 10^9, 0.5, 0.05, 40)$.\n- Required output: Your program should produce a single line of output containing a comma-separated list enclosed in square brackets with $2$ floats per test case, ordered as\n  $$\n  [\\kappa(I + \\alpha S)\\_{\\text{test }1}, \\kappa(\\mathcal{C}(I + \\alpha S))\\_{\\text{test }1}, \\kappa(I + \\alpha S)\\_{\\text{test }2}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }2}, \\kappa(I + \\alpha S)\\_{\\text{test }3}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }3}].\n  $$\nAll outputs are to be provided as plain decimal floats with no units and no additional text besides the bracketed list on a single line.",
            "solution": "We begin from time-harmonic Maxwell's equations in free space with time dependence $e^{j \\omega t}$ and consider two-dimensional transverse-electric (TE) polarization with electric field $E_z(\\mathbf{r})$ independent of the out-of-plane coordinate. Denoting $u(\\mathbf{r}) = E_z(\\mathbf{r})$, the field obeys the scalar Helmholtz equation $\\nabla^2 u + k_0^2 u = 0$ in regions away from sources and the sheet, where $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0} = \\frac{2 \\pi f}{c_0}$ and $c_0 = 299792458\\,\\text{m/s}$.\n\nA zero-thickness metasurface on a smooth, closed contour $\\Gamma$ described by Generalized Sheet Transition Conditions (GSTCs) introduces relations between field jumps and averages across the sheet. For a purely electric metasurface with electric susceptibility $\\chi_{\\mathrm{ee}}$ and no magnetic susceptibility, the GSTCs (for tangential fields) reduce to the continuity of the tangential electric field and a jump in the tangential magnetic field proportional to the average tangential electric field. In two-dimensional TE polarization, using the relations between $u$ and the magnetic field components, these GSTCs imply the boundary conditions on $\\Gamma$\n$$\nu^+ = u^-,\n\\quad\n\\partial_n u^+ - \\partial_n u^- = - k_0^2 \\chi_{\\mathrm{ee}} \\, u,\n$$\nwhere $\\partial_n$ denotes the derivative along the outward normal to $\\Gamma$, and $+$ and $-$ denote limits from the two sides of the sheet. The factor $- k_0^2$ arises because $\\Delta H_t = j \\omega \\epsilon_0 \\chi_{\\mathrm{ee}} \\, u_{\\mathrm{avg}}$ and $H_t = \\frac{1}{j \\omega \\mu_0} \\partial_n u$ in TE, together with $k_0^2 = \\omega^2 \\mu_0 \\epsilon_0$. Continuity $u^+ = u^-$ yields $u_{\\mathrm{avg}} = u$ on $\\Gamma$.\n\nWe represent the scattered field by the single-layer potential\n$$\nu_{\\mathrm{sc}}(\\mathbf{r}) = S[\\varphi](\\mathbf{r}) = \\int_{\\Gamma} G(\\mathbf{r},\\mathbf{r}') \\, \\varphi(\\mathbf{r}') \\, \\mathrm{d}s',\n\\quad\nG(\\mathbf{r},\\mathbf{r}') = \\frac{j}{4} H_0^{(1)}\\!\\left(k_0 |\\mathbf{r}-\\mathbf{r}'|\\right).\n$$\nThe single-layer potential is continuous across $\\Gamma$ while its normal derivative exhibits a jump given by the density. Let $u = u_{\\mathrm{inc}} + u_{\\mathrm{sc}}$ denote the total field with an incident field $u_{\\mathrm{inc}}$ satisfying the Helmholtz equation in the background medium. The GSTC for the jump of the normal derivative becomes\n$$\n\\left(\\partial_n u_{\\mathrm{sc}}^+ - \\partial_n u_{\\mathrm{sc}}^-\\right) = - k_0^2 \\chi_{\\mathrm{ee}} \\, \\left(u_{\\mathrm{inc}} + u_{\\mathrm{sc}}\\right) \\quad \\text{on } \\Gamma.\n$$\nUsing the jump relation for the single-layer potential,\n$$\n\\partial_n S[\\varphi]^+ - \\partial_n S[\\varphi]^- = \\varphi \\quad \\text{on } \\Gamma,\n$$\nand the continuity of $S[\\varphi]$ on $\\Gamma$, we obtain\n$$\n\\varphi + k_0^2 \\chi_{\\mathrm{ee}} \\, S[\\varphi] = - k_0^2 \\chi_{\\mathrm{ee}} \\, u_{\\mathrm{inc}}|_{\\Gamma}.\n$$\nDefine $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$. Then the boundary integral equation on $\\Gamma$ reads\n$$\n\\left(I + \\alpha S\\right) \\varphi = g,\n\\quad\ng = - \\alpha \\, u_{\\mathrm{inc}}|_{\\Gamma}.\n$$\nThe operator $S$ is a weakly singular integral operator (logarithmic singularity in two dimensions), i.e., a singular surface operator added to the identity. The equation is of the second kind (identity plus compact) for smooth closed $\\Gamma$.\n\nTo improve numerical conditioning in a Method of Moments (MoM) discretization, we apply a Calderón-based regularization. The Calderón identity for smooth closed curves in two dimensions states\n$$\nN S = -\\tfrac{1}{4} I + K'^2,\n$$\nwhere $N$ is the hypersingular operator and $K'$ is the adjoint double-layer operator. Left-multiplying the equation by $\\mathcal{C} = -\\tfrac{1}{4} I + K'^2$ yields the regularized system\n$$\n\\mathcal{C} \\left(I + \\alpha S\\right) \\varphi = \\mathcal{C} \\, g.\n$$\nSince $\\mathcal{C}$ equals $N S$, this composition replaces the compact $S$ contribution by $N S$, which is of order zero (pseudo-differential operator of order zero), and turns the left-hand side into a form whose principal part is coercive and boundedly invertible for smooth $\\Gamma$, yielding improved eigenvalue clustering and condition number behavior.\n\nWe now specialize to $\\Gamma$ being a circle of radius $a$ parameterized by $\\theta \\in [0, 2 \\pi)$, and use the Fourier basis $\\{ e^{j n \\theta} \\}_{n \\in \\mathbb{Z}}$. By Graf's addition theorem,\n$$\nH_0^{(1)}\\!\\left(k_0 |\\mathbf{r}-\\mathbf{r}'|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k_0 r_) J_m(k_0 r_) e^{j m (\\theta - \\theta')},\n$$\nwhere $r_ = \\max(r, r')$, $r_ = \\min(r, r')$, $J_m$ is the Bessel function of the first kind of order $m$, and $H_m^{(1)}$ is the Hankel function of the first kind of order $m$. For points on the same circle, $r = r' = a$, and the single-layer boundary operator $S$ diagonalizes in the Fourier basis. Acting on a single Fourier mode $e^{j n \\theta'}$ and integrating over $\\theta'$, one finds\n$$\nS\\left[e^{j n \\theta}\\right] = s_n e^{j n \\theta},\n\\quad\ns_n = j \\frac{\\pi a}{2} H_n^{(1)}(x) J_n(x),\n\\quad x = k_0 a.\n$$\nSimilarly, the adjoint double-layer operator $K'$ is diagonal in this basis, with eigenvalues obtained by taking the average of the exterior and interior limiting normal derivatives of the single-layer potential. The resulting eigenvalues are\n$$\nK'\\left[e^{j n \\theta}\\right] = k'_n e^{j n \\theta},\n\\quad\nk'_n = j \\frac{\\pi a k_0}{4} \\left[ H_n^{(1)\\,'}(x) J_n(x) + H_n^{(1)}(x) J_n'(x) \\right],\n$$\nwhere $J_n'$ and $H_n^{(1)\\,'}$ denote derivatives with respect to the argument $x = k_0 a$. Therefore,\n$$\n\\mathcal{C}\\left[e^{j n \\theta}\\right] = c_n e^{j n \\theta},\n\\quad\nc_n = -\\frac{1}{4} + \\left(k'_n\\right)^2.\n$$\nIn the truncated Fourier spectral MoM with modes $n = -M, \\ldots, M$, both $I + \\alpha S$ and $\\mathcal{C}$ are represented by diagonal matrices with diagonal entries $1 + \\alpha s_n$ and $c_n$, respectively. Consequently, the spectral condition numbers are\n$$\n\\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_{-M \\le n \\le M} |1 + \\alpha s_n|}{\\min_{-M \\le n \\le M} |1 + \\alpha s_n|},\n\\quad\n\\kappa\\left(\\mathcal{C} (I + \\alpha S)\\right) = \\frac{\\max_{-M \\le n \\le M} |c_n (1 + \\alpha s_n)|}{\\min_{-M \\le n \\le M} |c_n (1 + \\alpha s_n)|}.\n$$\nAlgorithmic steps:\n1. For each test case $(f, a, \\chi_{\\mathrm{ee}}, M)$, compute $k_0 = \\frac{2 \\pi f}{c_0}$ and $x = k_0 a$, and set $\\alpha = k_0^2 \\chi_{\\mathrm{ee}}$.\n2. For $n = -M, \\ldots, M$, evaluate $J_n(x)$, $J_n'(x)$, $H_n^{(1)}(x)$, and $H_n^{(1)\\,'}(x)$ using numerically stable special functions. Then compute $s_n$, $k'_n$, and $c_n$ as above.\n3. Form arrays of eigenvalues $A_n = 1 + \\alpha s_n$ for $I + \\alpha S$ and $R_n = c_n A_n$ for $\\mathcal{C}(I + \\alpha S)$.\n4. Compute the condition numbers as\n$$\n\\kappa\\left(I + \\alpha S\\right) = \\frac{\\max_n |A_n|}{\\min_n |A_n|}, \\quad \\kappa\\left(\\mathcal{C} (I + \\alpha S)\\right) = \\frac{\\max_n |R_n|}{\\min_n |R_n|}.\n$$\nThe absolute values ensure nonnegative real condition numbers.\n5. Report the six floats for the specified test suite:\n   - Test $1$: $(f, a, \\chi_{\\mathrm{ee}}, M) = (1.0 \\times 10^9, 0.5, 0.01, 20)$,\n   - Test $2$: $(f, a, \\chi_{\\mathrm{ee}}, M) = (1.0 \\times 10^9, 0.5, 0.0, 20)$,\n   - Test $3$: $(f, a, \\chi_{\\mathrm{ee}}, M) = (6.0 \\times 10^9, 0.5, 0.05, 40)$.\nThe outputs are dimensionless and must be printed as a single bracketed list on one line in the order\n$$\n[\\kappa(I + \\alpha S)_{\\text{test }1}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }1}, \\kappa(I + \\alpha S)_{\\text{test }2}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }2}, \\kappa(I + \\alpha S)_{\\text{test }3}, \\kappa(\\mathcal{C}(I + \\alpha S))_{\\text{test }3}].\n$$\nDiscussion of conditioning:\n- When $\\chi_{\\mathrm{ee}} = 0$, the unregularized operator is exactly the identity and $\\kappa(I + \\alpha S) = 1$. The regularized operator reduces to $\\mathcal{C}$ whose condition number reflects the spectrum of $N S$; it is generally greater than $1$, highlighting that Calderón regularization is intended to balance first-kind formulations or identity-plus-compact systems dominated by the compact part, not to improve over a pure identity.\n- For nonzero $\\chi_{\\mathrm{ee}}$, the operator $I + \\alpha S$ can become ill-conditioned if $|\\alpha s_n|$ approaches $1$ with a phase opposite to $1$ for some $n$. Multiplying by $\\mathcal{C}$ replaces the compact single-layer contribution by $N S$, leading to improved eigenvalue clustering and typically reduced condition numbers as $M$ increases, reflecting discretization robustness in the Method of Moments. The Fourier diagonalization on the circle makes these effects transparent and numerically stable to evaluate.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, jvp, hankel1, h1vp\n\ndef eigenvalues_single_layer_and_Kprime(k0, a, M):\n    \"\"\"\n    Compute the Fourier eigenvalues s_n of the single-layer operator S\n    and k'_n of the adjoint double-layer operator K' on a circle of radius a,\n    for modes n = -M, ..., M, at wavenumber k0.\n\n    s_n = j * (pi * a / 2) * H_n^{(1)}(x) * J_n(x)\n    k'_n = j * (pi * a * k0 / 4) * [ H_n^{(1)'}(x) * J_n(x) + H_n^{(1)}(x) * J_n'(x) ]\n    where x = k0 * a.\n    \"\"\"\n    x = k0 * a\n    ns = np.arange(-M, M+1, dtype=int)\n    # Compute Bessel and Hankel functions for each n\n    J = np.array([jv(n, x) for n in ns], dtype=complex)\n    Jp = np.array([jvp(n, x, 1) for n in ns], dtype=complex)\n    H = np.array([hankel1(n, x) for n in ns], dtype=complex)\n    Hp = np.array([h1vp(n, x, 1) for n in ns], dtype=complex)\n\n    s = 1j * (np.pi * a / 2.0) * H * J\n    kprime = 1j * (np.pi * a * k0 / 4.0) * (Hp * J + H * Jp)\n    return ns, s, kprime\n\ndef condition_numbers_for_case(f_hz, a_m, chi_ee, M):\n    c0 = 299792458.0  # m/s\n    omega = 2.0 * np.pi * f_hz\n    k0 = omega / c0\n    alpha = (k0 ** 2) * chi_ee\n\n    ns, s, kprime = eigenvalues_single_layer_and_Kprime(k0, a_m, M)\n    # Calderón operator eigenvalues: C = -1/4 I + K'^2\n    C = -0.25 + (kprime ** 2)\n\n    A = 1.0 + alpha * s\n    # Avoid division by zero: ensure no zero eigenvalues in the truncated set\n    absA = np.abs(A)\n    absCA = np.abs(C * A)\n\n    # Remove any near-zero modes robustly by adding a tiny epsilon if needed\n    eps = 1e-30\n    min_absA = np.max([np.min(absA), eps])\n    min_absCA = np.max([np.min(absCA), eps])\n\n    kappa_A = np.max(absA) / min_absA\n    kappa_CA = np.max(absCA) / min_absCA\n    # Return as real floats\n    return float(np.real_if_close(kappa_A)), float(np.real_if_close(kappa_CA))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each is (frequency in Hz, radius in m, chi_ee (dimensionless), M modes)\n    test_cases = [\n        (1.0e9, 0.5, 0.01, 20),  # Test 1: happy path\n        (1.0e9, 0.5, 0.0, 20),   # Test 2: boundary (no metasurface)\n        (6.0e9, 0.5, 0.05, 40),  # Test 3: edge (stronger sheet, more modes)\n    ]\n\n    results = []\n    for case in test_cases:\n        f_hz, a_m, chi_ee, M = case\n        kappa_unreg, kappa_reg = condition_numbers_for_case(f_hz, a_m, chi_ee, M)\n        results.append(kappa_unreg)\n        results.append(kappa_reg)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}