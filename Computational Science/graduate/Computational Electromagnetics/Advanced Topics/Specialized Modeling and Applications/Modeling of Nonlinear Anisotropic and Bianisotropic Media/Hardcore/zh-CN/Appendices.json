{
    "hands_on_practices": [
        {
            "introduction": "在我们对一种材料进行计算建模之前，必须首先理解其本构关系的数学形式。这种形式并非任意，而是由材料内在的物理对称性决定的。本练习旨在提供应用诺依曼原理（Neumann's principle）来确定特定晶体类别的二阶磁化率张量 $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ 结构的实践，这是非线性光学领域的一项关键技能。",
            "id": "3331971",
            "problem": "一个属于三方点群（具有三重旋转和镜面对称性，记为 $3m$，也称为 $C_{3v}$）的单轴晶体被用于倍频（二次谐波产生）。设晶体学（光学）轴与笛卡尔坐标轴 $z$ 重合，并设 $(x,y)$ 张成基面。在频域中，二阶非线性极化强度 $\\mathbf{P}^{(2)}(2\\omega)$ 通过二阶电极化率张量 $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ 由本构关系定义：\n$$\nP^{(2)}_{i}(2\\omega) \\;=\\; \\varepsilon_{0}\\,\\chi^{(2)}_{ijk}(-2\\omega;\\omega,\\omega)\\,E_{j}(\\omega)\\,E_{k}(\\omega),\n$$\n其中 $i,j,k\\in\\{x,y,z\\}$ 并使用爱因斯坦求和约定。假设非共振 Kleinman 对称性成立，因此 $\\chi^{(2)}_{ijk}=\\chi^{(2)}_{ikj}$。\n\n1) 从 Neumann 原理（“晶体任何物理性质的对称元素必须包括晶体点群的对称元素”）出发，对 $3m$ 群的生成元施加 $\\chi^{(2)}_{ijk}$ 的不变性要求：绕 $z$ 轴旋转 $120^{\\circ}$ 和通过一个包含 $z$ 轴的垂直平面的镜面反射。对于每个生成元，使用带有正交矩阵 $\\bar{\\bar{R}}$ 的张量变换定律\n$$\n\\chi^{(2)}_{ijk} \\;=\\; R_{ii'}\\,R_{jj'}\\,R_{kk'}\\,\\chi^{(2)}_{i'j'k'}\n$$\n以及后两个指标的内在置换对称性，来确定哪些笛卡尔分量 $\\chi^{(2)}_{ijk}$ 可以非零，并确定独立的最小系数集及其间的任何相等关系。不要参考列表结果；通过对称性论证每次的消除或相等关系。\n\n2) 引入收缩记法，其中二次场组合被收集为\n$$\nS \\;=\\; \\big(E_{x}^{2},\\,E_{y}^{2},\\,E_{z}^{2},\\,2E_{y}E_{z},\\,2E_{x}E_{z},\\,2E_{x}E_{y}\\big),\n$$\n并且 $3\\times 6$ 矩阵 $\\bar{\\bar{d}}$ 定义为\n$$\nP^{(2)}_{i}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\sum_{\\ell=1}^{6} d_{i\\ell}\\,S_{\\ell}.\n$$\n使用 $3m$ 类的常规晶体学取向，以这种收缩的 $d$-张量形式表示 $3m$ 晶体的 $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$，明确写出 $3\\times 6$ 矩阵 $\\bar{\\bar{d}}$ 并用其独立系数表示。\n\n3) 现在考虑一个频率为 $\\omega$ 的单色平面波，沿着 $+z$ 轴传播，其电场为\n$$\n\\mathbf{E}(\\omega) \\;=\\; E_{0}\\,\\big(\\cos\\phi\\,\\hat{\\mathbf{x}} \\;+\\; \\sin\\phi\\,\\hat{\\mathbf{y}}\\big),\n$$\n其中 $E_{0}0$ 且角度 $\\phi\\in[0,2\\pi)$ 是从基面中的 $x$ 轴测量的。使用第2部分的结果，计算归一化的纵向二次谐波极化强度\n$$\n\\frac{P^{(2)}_{z}(2\\omega)}{\\varepsilon_{0}\\,E_{0}^{2}}\n$$\n，用 $\\bar{\\bar{d}}$ 的独立系数和角度 $\\phi$ 表示成一个单一的封闭形式解析表达式，并完全化简。将此归一化的标量作为你的最终答案。不需要进行数值计算，最终答案中也不应包含单位。",
            "solution": "该问题提法得当，具有科学依据且内部一致。这是一个非线性光学中的标准问题，涉及应用晶体对称性来确定二阶极化率张量的形式。\n\n根据题目要求，解答分为三个部分。\n\n### 第 1 部分：确定 $3m$ 群的 $\\chi^{(2)}$ 张量形式\n\n点群 $3m$ ($C_{3v}$) 的特征是存在一个三重旋转轴和一个平行于该轴的镜面。我们将笛卡尔坐标系的 $z$ 轴与三重旋转轴对齐。对于镜面，我们选择 $xz$ 平面，这是一个常规选择。因此，该群的生成元是绕 $z$ 轴旋转 $\\theta = 2\\pi/3$ 的旋转操作 $C_3$ 和跨越 $xz$ 平面的反射操作 $\\sigma_v$。\n\n根据 Neumann 原理，极化率张量 $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ 在这些对称操作下必须保持不变。张量变换定律由 $\\chi^{(2)}_{ijk} = R_{ii'}R_{jj'}R_{kk'}\\chi^{(2)}_{i'j'k'}$ 给出，其中 $\\bar{\\bar{R}}$ 是表示对称操作的矩阵。\n\n**A. 在反射 $\\sigma_v$（在 $xz$ 平面内）下的不变性**\n\n反射操作将坐标变换为 $(x, y, z) \\to (x, -y, z)$。相应的变换矩阵是：\n$$\n\\bar{\\bar{R}}_{\\sigma_v} = \\begin{pmatrix} 1  0  0 \\\\ 0  -1  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n不变性条件是 $\\chi^{(2)}_{ijk} = (R_{\\sigma_v})_{ii'}(R_{\\sigma_v})_{jj'}(R_{\\sigma_v})_{kk'}\\chi^{(2)}_{i'j'k'}$。由于 $\\bar{\\bar{R}}_{\\sigma_v}$ 是对角矩阵，这可以简化为 $\\chi^{(2)}_{ijk} = (R_{\\sigma_v})_{ii}(R_{\\sigma_v})_{jj}(R_{\\sigma_v})_{kk}\\chi^{(2)}_{ijk}$（无求和）。要使分量 $\\chi^{(2)}_{ijk}$ 非零，我们必须有 $(R_{\\sigma_v})_{ii}(R_{\\sigma_v})_{jj}(R_{\\sigma_v})_{kk} = 1$。\n该乘积等于 $(-1)^{N_y}$，其中 $N_y$ 是指标 $y$ 在 $(i,j,k)$ 中出现的次数。因此，要使 $\\chi^{(2)}_{ijk}$ 非零，$N_y$ 必须是偶数（$0$ 或 $2$）。\n\n这消除了所有具有奇数个 $y$ 指标的分量。例如：\n- $N_y=1$：$\\chi_{yxx}$、$\\chi_{xxy}$、$\\chi_{xyz}$ 等都必须为零。\n- $N_y=3$：$\\chi_{yyy}$ 必须为零。\n\n幸存的分量（在应用 $C_3$ 对称性并考虑 Kleinman 对称性 $\\chi^{(2)}_{ijk}=\\chi^{(2)}_{ikj}$ 之前）是那些 $N_y=0$ 或 $N_y=2$ 的分量。\n- $N_y=0$：所有指标都来自 $\\{x, z\\}$，例如 $\\chi_{xxx}, \\chi_{xxz}, \\chi_{zxz}, \\chi_{zzz}$。\n- $N_y=2$：两个指标是 $y$，一个来自 $\\{x, z\\}$，例如 $\\chi_{xyy}, \\chi_{yxy}, \\chi_{yyx}, \\chi_{zyy}$。\n\n**B. 在旋转 $C_3$（绕 $z$ 轴旋转 $120^\\circ$）下的不变性**\n\n对于被动变换（坐标系旋转），旋转角为 $\\theta = 2\\pi/3$ 的旋转矩阵指定为：\n$$\n\\bar{\\bar{R}}_{C_3} = \\begin{pmatrix} \\cos\\theta  \\sin\\theta  0 \\\\ -\\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} -1/2  \\sqrt{3}/2  0 \\\\ -\\sqrt{3}/2  -1/2  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n设 $c = \\cos\\theta = -1/2$ 和 $s = \\sin\\theta = \\sqrt{3}/2$。我们将不变性条件 $\\chi^{(2)}_{ijk} = R_{ii'}R_{jj'}R_{kk'}\\chi^{(2)}_{i'j'k'}$ 应用于在 $\\sigma_v$ 反射对称性下幸存的分量。\n\n1.  **只涉及 $z$ 的分量：**\n    $\\chi'_{zzz} = R_{zz}R_{zz}R_{zz}\\chi_{zzz} = (1)^3 \\chi_{zzz} = \\chi_{zzz}$。所以 $\\chi_{zzz}$ 是一个独立的非零分量。\n\n2.  **将 $\\{x,y\\}$ 与 $z$ 关联的分量：**\n    考虑 $\\chi_{zxx}$。变换后的分量是 $\\chi'_{zxx} = R_{zi'} R_{xj'} R_{xk'} \\chi_{i'j'k'}$。由于 $R_{zi'}=\\delta_{zi'}$，这变为 $\\chi'_{zxx} = R_{xj'} R_{xk'} \\chi_{zj'k'}$。在 $j', k' \\in \\{x,y\\}$ 上展开（因为在这种旋转下 $z$ 分量不与 $xy$ 混合）：\n    $\\chi'_{zxx} = R_{xx}^2 \\chi_{zxx} + R_{xy}^2 \\chi_{zyy} + R_{xx}R_{xy}(\\chi_{zxy}+\\chi_{zyx})$。\n    根据 $\\sigma_v$ 对称性，$\\chi_{zxy}$ 和 $\\chi_{zyx}$ 为零 ($N_y=1$)。\n    $\\chi'_{zxx} = c^2 \\chi_{zxx} + s^2 \\chi_{zyy}$。不变性要求 $\\chi_{zxx} = c^2 \\chi_{zxx} + s^2 \\chi_{zyy}$，这给出 $\\chi_{zxx}(1-c^2) = s^2 \\chi_{zyy}$。由于 $s^2=1-c^2$，这简化为 $\\chi_{zxx} = \\chi_{zyy}$。\n    对 $\\chi'_{zyy}$ 进行类似的计算可证实此关系。\n\n    考虑 $\\chi_{xxz}$。由于 Kleinman 对称性，$\\chi_{xxz} = \\chi_{xzx}$。\n    $\\chi'_{xxz} = R_{xi'}R_{xj'}R_{zk'} \\chi_{i'j'k'} = R_{xi'}R_{xj'} \\chi_{i'j'z}$。\n    $\\chi'_{xxz} = R_{xx}^2 \\chi_{xxz} + R_{xy}^2 \\chi_{yyz} + R_{xx}R_{xy}(\\chi_{xyz}+\\chi_{yxz})$。含有一个 $y$ 的分量为零，所以 $\\chi'_{xxz} = c^2 \\chi_{xxz} + s^2 \\chi_{yyz}$。不变性给出 $\\chi_{xxz} = \\chi_{yyz}$。\n\n    考虑 $\\chi_{xzz}$。$\\chi'_{xzz} = R_{xi'}R_{zj'}R_{zk'} \\chi_{i'zz} = R_{xi'} \\chi_{i'zz} = c\\chi_{xzz} + s\\chi_{yzz}$。根据 $\\sigma_v$，$\\chi_{yzz}=0$ ($N_y=1$)。所以 $\\chi'_{xzz} = c\\chi_{xzz}$。由于 $c \\ne 1$，这要求 $\\chi_{xzz}=0$。\n\n    考虑 $\\chi_{zxz}$。$\\chi'_{zxz} = R_{zi'}R_{xj'}R_{zk'} \\chi_{i'j'k'} = R_{xj'} \\chi_{zj'z} = c\\chi_{zxz} + s\\chi_{zyz}$。根据 $\\sigma_v$，$\\chi_{zyz}=0$ ($N_y=1$)。所以 $\\chi'_{zxz} = c\\chi_{zxz}$，这意味着 $\\chi_{zxz}=0$。\n\n3.  **只涉及 $x, y$ 的分量：**\n    考虑 $\\chi_{xxx}, \\chi_{xyy}, \\chi_{yyx}$ 的系统（注意根据 Kleinman 对称性 $\\chi_{yxy}=\\chi_{yyx}$，而其他分量如 $\\chi_{xxy}$ 根据 $\\sigma_v$ 对称性为零）。\n    $\\chi'_{xxx} = c^3 \\chi_{xxx} + cs^2(\\chi_{xyy} + 2\\chi_{yyx})$。不变性给出 $\\chi_{xxx}(1-c^3) = cs^2(\\chi_{xyy} + 2\\chi_{yyx})$。当 $c=-1/2, s^2=3/4$ 时，这变为 $3\\chi_{xxx} = -(\\chi_{xyy} + 2\\chi_{yyx})$。\n    $\\chi'_{xyy} = cs^2\\chi_{xxx} + c^3\\chi_{xyy} - 2cs^2\\chi_{yyx}$。不变性给出 $\\chi_{xyy}(1-c^3) = cs^2\\chi_{xxx} - 2cs^2\\chi_{yyx}$，这变为 $3\\chi_{xyy} = -\\chi_{xxx} + 2\\chi_{yyx}$。\n    解这个二元线性方程组：\n    从第二个方程得到 $\\chi_{xxx} = 2\\chi_{yyx} - 3\\chi_{xyy}$。代入第一个方程：\n    $3(2\\chi_{yyx} - 3\\chi_{xyy}) = -\\chi_{xyy} - 2\\chi_{yyx} \\implies 6\\chi_{yyx} - 9\\chi_{xyy} = -\\chi_{xyy} - 2\\chi_{yyx}$。\n    $8\\chi_{yyx} = 8\\chi_{xyy} \\implies \\chi_{yyx} = \\chi_{xyy}$。\n    代回：$\\chi_{xxx} = 2\\chi_{xyy} - 3\\chi_{xyy} = -\\chi_{xyy}$。\n\n**$\\chi^{(2)}$ 的独立非零分量总结：**\n我们选择独立系数集为 $\\chi_{xxx}$、$\\chi_{xxz}$、$\\chi_{zxx}$ 和 $\\chi_{zzz}$。所有其他非零分量都与这些分量相关：\n- $\\chi_{xyy} = -\\chi_{xxx}$\n- $\\chi_{yyx} = \\chi_{yxy} = \\chi_{xyy} = -\\chi_{xxx}$\n- $\\chi_{yyz} = \\chi_{yzy} = \\chi_{xxz}$\n- $\\chi_{zyy} = \\chi_{zxx}$\n- 所有其他分量均为零，包括 $\\chi_{xzz}=0$、$\\chi_{zxz}=0$。\n\n### 第 2 部分：收缩的 $d$-张量形式\n\n$\\chi^{(2)}_{ijk}$ 张量和 $d_{i\\ell}$ 矩阵之间的关系是通过比较本构关系的两种形式并遵守 Kleinman 对称性给出的。\n$P_i = \\varepsilon_{0} \\sum_{j,k} \\chi_{ijk} E_j E_k = \\varepsilon_0 (\\chi_{ixx}E_x^2 + \\chi_{iyy}E_y^2 + \\chi_{izz}E_z^2 + 2\\chi_{iyz}E_yE_z + 2\\chi_{ixz}E_xE_z + 2\\chi_{ixy}E_xE_y)$\n$P_i = 2\\varepsilon_{0} \\sum_{\\ell} d_{i\\ell} S_{\\ell} = 2\\varepsilon_0 (d_{i1}E_x^2 + d_{i2}E_y^2 + d_{i3}E_z^2 + 2d_{i4}E_yE_z + 2d_{i5}E_xE_z + 2d_{i6}E_xE_y)$\n比较系数得到映射关系：\n$\\chi_{ixx}=2d_{i1}$, $\\chi_{iyy}=2d_{i2}$, $\\chi_{izz}=2d_{i3}$\n$\\chi_{iyz}=2d_{i4}$, $\\chi_{ixz}=2d_{i5}$, $\\chi_{ixy}=2d_{i6}$\n\n使用第 1 部分中为 $\\chi^{(2)}_{ijk}$ 推导出的关系：\n- $\\chi_{xxx} = 2d_{11}$\n- $\\chi_{xyy} = 2d_{12} \\implies 2d_{12} = -\\chi_{xxx} = -2d_{11} \\implies d_{12}=-d_{11}$.\n- $\\chi_{xzz} = 2d_{13} \\implies 2d_{13} = 0 \\implies d_{13}=0$.\n- $\\chi_{yyz} = 2d_{24}$ 且 $\\chi_{xxz} = 2d_{15}$。关系 $\\chi_{xxz}=\\chi_{yyz}$ 意味着 $d_{15}=d_{24}$。\n- $\\chi_{ixy} = 2d_{i6}$。所以 $\\chi_{yxy} = 2d_{26}$。我们有 $\\chi_{yxy} = -\\chi_{xxx}$，所以 $2d_{26} = -2d_{11} \\implies d_{26}=-d_{11}$。\n- $\\chi_{zxx} = 2d_{31}$ 且 $\\chi_{zyy} = 2d_{32}$。关系 $\\chi_{zxx}=\\chi_{zyy}$ 意味着 $d_{31}=d_{32}$。\n- $\\chi_{zxz} = 2d_{35}$ (通过 Kleinman 对称性 $\\chi_{zxz}=\\chi_{zzx}$)。我们发现 $\\chi_{zxz}=0$，所以 $d_{35}=0$。\n- $\\chi_{zzz}=2d_{33}$ 是一个独立系数。\n- 基于 $\\sigma_v$ 对称性的零值，所有其他系数都为零。例如，$d_{14} \\propto \\chi_{xyz}=0$，$d_{21} \\propto \\chi_{yxx}=0$，$d_{22} \\propto \\chi_{yyy}=0$。\n\n将这些结果组合成 $3 \\times 6$ 矩阵 $\\bar{\\bar{d}}$：\n$$\n\\bar{\\bar{d}} = \\begin{pmatrix} d_{11}  d_{12}  d_{13}  d_{14}  d_{15}  d_{16} \\\\ d_{21}  d_{22}  d_{23}  d_{24}  d_{25}  d_{26} \\\\ d_{31}  d_{32}  d_{33}  d_{34}  d_{35}  d_{36} \\end{pmatrix} = \\begin{pmatrix} d_{11}  -d_{11}  0  0  d_{15}  0 \\\\ 0  0  0  d_{15}  0  -d_{11} \\\\ d_{31}  d_{31}  d_{33}  0  0  0 \\end{pmatrix}\n$$\n独立的最小系数集可以表示为 $d_{11}$、$d_{15}$、$d_{31}$ 和 $d_{33}$。\n\n### 第 3 部分：归一化纵向极化强度的计算\n\n入射电场给定为 $\\mathbf{E}(\\omega) = E_{0}(\\cos\\phi\\,\\hat{\\mathbf{x}} + \\sin\\phi\\,\\hat{\\mathbf{y}})$。场分量为：\n$E_x=E_0\\cos\\phi$, $E_y=E_0\\sin\\phi$, $E_z=0$.\n\n二次场组合矢量 $\\bar{S}$ 是：\n$S_1 = E_x^2 = E_0^2 \\cos^2\\phi$\n$S_2 = E_y^2 = E_0^2 \\sin^2\\phi$\n$S_3 = E_z^2 = 0$\n$S_4 = 2E_yE_z = 0$\n$S_5 = 2E_xE_z = 0$\n$S_6 = 2E_xE_y = 2E_0^2\\cos\\phi\\sin\\phi = E_0^2\\sin(2\\phi)$\n\n我们需要计算纵向二次谐波极化强度 $P^{(2)}_z(2\\omega)$。公式为：\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\sum_{\\ell=1}^{6} d_{3\\ell}\\,S_{\\ell}\n$$\n使用推导出的 $\\bar{\\bar{d}}$ 矩阵的第三行，即 $(d_{31}, d_{31}, d_{33}, 0, 0, 0)$：\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,(d_{31}S_1 + d_{31}S_2 + d_{33}S_3 + 0\\cdot S_4 + 0\\cdot S_5 + 0\\cdot S_6)\n$$\n代入 $S_\\ell$ 的表达式：\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\left(d_{31}(E_0^2 \\cos^2\\phi) + d_{31}(E_0^2 \\sin^2\\phi) + d_{33}(0)\\right)\n$$\n提取公因式：\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,d_{31}E_0^2 (\\cos^2\\phi + \\sin^2\\phi)\n$$\n使用三角恒等式 $\\cos^2\\phi+\\sin^2\\phi=1$：\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,d_{31}E_0^2\n$$\n结果与极化角 $\\phi$ 无关。这是绕 $z$ 轴的三重对称性的直接结果，该对称性要求在产生 $P_z^{(2)}$ 时，$E_x^2$ ($d_{31}$) 和 $E_y^2$ ($d_{32}$) 的系数相等。\n\n最后，我们计算所需的归一化量：\n$$\n\\frac{P^{(2)}_{z}(2\\omega)}{\\varepsilon_{0}\\,E_{0}^{2}} = \\frac{2\\,\\varepsilon_{0}\\,d_{31}E_0^2}{\\varepsilon_{0}\\,E_{0}^{2}} = 2d_{31}\n$$",
            "answer": "$$\n\\boxed{2d_{31}}\n$$"
        },
        {
            "introduction": "在确定了本构张量的形式之后，下一步是模拟场在这样的介质中如何随时间演化。这个实践问题将引导您从理论走向计算，为一个克尔（Kerr）型非线性各向异性材料开发一个时域有限差分（FDTD）方案。您将解决计算物理学中的关键挑战，包括使用牛顿法实现非线性材料更新，以及分析该模拟的数值稳定性。",
            "id": "3331925",
            "problem": "在计算电磁学中，考虑一个具有周期性边界条件的一维横电配置，其中电场分量 $E_y(x,t)$ 与磁场分量 $H_z(x,t)$ 相互耦合。该材料是克尔型各向异性的，其电位移 $\\mathbf{D}$ 通过张量值介电常数 $\\boldsymbol{\\epsilon}(\\mathbf{E})=\\boldsymbol{\\epsilon}_0+\\alpha\\,\\mathrm{diag}(E_x^2,E_y^2,E_z^2)$ 非线性地、分量地依赖于 $\\mathbf{E}$。在当前的一维横电配置中，假设 $E_x=0$ 且 $E_z=0$，因此唯一的非零位移分量是 $D_y(x,t)$，其本构关系为 $D_y=\\epsilon_y(E_y)\\,E_y$ 且\n$$\n\\epsilon_y(E_y)=\\epsilon_y+\\alpha E_y^2,\n$$\n其中 $\\epsilon_y$ 是沿 $y$ 轴的恒定基线介电常数（各向异性基线张量 $\\boldsymbol{\\epsilon}_0$ 的一个分量），$\\alpha$ 是克尔非线性系数。磁响应是线性和各向同性的，关系为 $B_z=\\mu_0 H_z$，其中 $\\mu_0$ 是真空磁导率。\n\n从微分形式的 Maxwell 方程组出发，\n$$\n\\nabla \\times \\mathbf{E}=-\\frac{\\partial \\mathbf{B}}{\\partial t},\\qquad \\nabla \\times \\mathbf{H}=\\frac{\\partial \\mathbf{D}}{\\partial t},\n$$\n为 $(E_y,H_z)$ 对，在一个长度为 $L$、具有周期性边界条件的域上，由 $N_x$ 个点组成的均匀网格上，推导一个类 Yee 氏时域有限差分格式。在时间上使用蛙跳交错格式，使得 $H_z$ 在半时间步长处更新，$D_y$ 在整数时间步长处更新。具体要求如下：\n\n- 用空间有限差分（间距为 $\\Delta x=L/N_x$）和时间步长 $\\Delta t$ 来表示 $H_z$ 和 $D_y$ 的离散更新，确保与一维空间中的旋度关系保持一致。\n\n- 由于本构关系 $D_y=\\epsilon_y(E_y) E_y=\\epsilon_y E_y + \\alpha E_y^3$ 对 $E_y$ 是非线性的，需要在每个网格点上构建并实现一个牛顿预测-校正步，以从已更新的 $D_y^{n+1}$ 计算 $E_y^{n+1}$。也就是说，对每个节点，求解标量非线性方程\n$$\nf(E)=\\alpha E^3+\\epsilon_y E - D_y^{n+1}=0\n$$\n使用：\n  1. 一个预测子，通过从前一个电场迭代值 $E_y^n$ 开始的一次牛顿迭代获得，以及\n  2. 一个校正子，通过继续牛顿迭代直至满足预设容差获得。\n\n对此带有非线性更新的类 Yee 氏格式进行稳定性分析，方法是将本构关系在一个非零工作场振幅 $E_0$ 附近线性化，以定义一个有效介电常数\n$$\n\\epsilon_{\\mathrm{eff}}(E_0)=\\epsilon_y+3\\alpha E_0^2,\n$$\n然后推导一个关于 $\\Delta t$ 的 Courant–Friedrichs–Lewy (CFL) 界限，使得离散能量\n$$\n\\mathcal{E}^n=\\sum_{i=0}^{N_x-1}\\frac{1}{2}\\left(E_{y,i}^n D_{y,i}^n+\\mu_0 H_{z,i}^{n+\\frac{1}{2}} H_{z,i}^{n+\\frac{1}{2}}\\right)\\Delta x\n$$\n保持有界。从 Maxwell 方程组和离散更新结构出发，提供论证，以 $\\Delta x$、$\\mu_0$ 和 $\\epsilon_{\\mathrm{eff}}$ 的一个可接受界限来阐述适当的时间步长限制。\n\n将上述格式实现为一个可运行的程序，为一组测试用例执行以下数值实验。对于每个测试用例，将 $E_y(x,0)$ 初始化为一个以 $x=L/2$ 为中心、振幅为 $A$、宽度为 $w=L/10$ 的高斯脉冲，即\n$$\nE_y(x,0)=A\\exp\\left(-\\frac{(x-L/2)^2}{w^2}\\right),\n$$\n并设置 $H_z(x,-\\Delta t/2)=0$。初始化 $D_y(x,0)=\\epsilon_y E_y(x,0)+\\alpha E_y(x,0)^3$。使用带有牛顿预测-校正规则的类 Yee 氏更新，将解推进 $N_{\\mathrm{steps}}$ 步。为每次运行定义稳定性如下：如果所有场值保持有限，并且在所有时间步长上的最大离散能量小于初始能量的 1.5 倍，则运行是稳定的，否则是不稳定的。\n\n使用国际单位制，其中 $\\Delta x$ 以米表示，$\\Delta t$ 以秒表示，场振幅以伏特/米表示，介电常数以法拉/米表示，磁导率以亨利/米表示。真空常数为 $\\epsilon_0=8.854187817\\times10^{-12}\\,\\mathrm{F/m}$ 和 $\\mu_0=4\\pi\\times10^{-7}\\,\\mathrm{H/m}$。基线各向异性介电常数分量 $\\epsilon_y$ 由 $\\epsilon_y=\\epsilon_0 \\epsilon_{r,y}$ 给出，其中 $\\epsilon_{r,y}$ 是沿 $y$ 轴的无量纲相对介电常数。\n\n测试套件：\n对于每个测试用例，程序必须根据基于 $\\epsilon_y$ 的线性 CFL 界限，通过一个指定的缩放因子 $s$ 来构造 $\\Delta t$，即\n$$\n\\Delta t = s\\frac{\\Delta x}{v_{\\mathrm{base}}},\\qquad v_{\\mathrm{base}}=\\frac{1}{\\sqrt{\\mu_0 \\epsilon_y}}.\n$$\n为每个用例运行指定的步数 $N_{\\mathrm{steps}}$ 并报告其稳定性。\n\n- 用例 1（正常路径）：$N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=+1.0\\times 10^{-24}\\,\\mathrm{F\\cdot m/V^2}$, $A=1.0\\times 10^{6}\\,\\mathrm{V/m}$, $s=0.90$, $N_{\\mathrm{steps}}=800$。\n\n- 用例 2（违反CFL，预期不稳定）：$N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=+1.0\\times 10^{-24}\\,\\mathrm{F\\cdot m/V^2}$, $A=1.0\\times 10^{6}\\,\\mathrm{V/m}$, $s=1.10$, $N_{\\mathrm{steps}}=600$。\n\n- 用例 3（负非线性，保守步长）：$N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=-5.0\\times 10^{-25}\\,\\mathrm{F\\cdot m/V^2}$, $A=4.0\\times 10^{6}\\,\\mathrm{V/m}$, $s=0.50$, $N_{\\mathrm{steps}}=800$。\n\n- 用例 4（负非线性，激进步长，预期不稳定）：$N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=-5.0\\times 10^{-25}\\,\\mathrm{F\\cdot m/V^2}$, $A=4.0\\times 10^{6}\\,\\mathrm{V/m}$, $s=0.95$, $N_{\\mathrm{steps}}=800$。\n\n您的程序应生成单行输出，其中包含四个测试用例的稳定性结果，格式为方括号内以逗号分隔的列表（例如，\"[True,False,True,False]\"）。",
            "solution": "该问题具有科学依据，提法明确且客观。它指定了一个计算电磁学中的标准数值实验，涉及使用时域有限差分 (FDTD) 方法模拟一个非线性、各向异性的介质。所有参数、方程和条件都已明确定义。我将提供一个完整的解决方案。\n\n该解决方案分为三个部分：首先，从 Maxwell 方程组推导 FDTD 更新方程；其次，对所得格式进行稳定性分析；第三，解释数值实现。\n\n### 1. FDTD 格式的推导\n\n我们从无源介质中的 Maxwell 旋度方程组开始：\n$$\n\\nabla \\times \\mathbf{E} = -\\frac{\\partial \\mathbf{B}}{\\partial t}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\frac{\\partial \\mathbf{D}}{\\partial t}\n$$\n问题指定了一个一维横电 (TE) 配置，其中场仅在 $x$ 方向上变化。非零场分量为 $E_y(x,t)$ 和 $H_z(x,t)$，因此 $\\mathbf{E} = E_y \\hat{\\mathbf{y}}$ 且 $\\mathbf{H} = H_z \\hat{\\mathbf{z}}$。本构关系为 $B_z = \\mu_0 H_z$ 和 $D_y = (\\epsilon_y + \\alpha E_y^2) E_y$。\n\n在这些条件下，旋度算子得以简化。\n对于第一个方程（法拉第定律）：\n$$\n\\nabla \\times \\mathbf{E} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\\n\\partial_x  \\partial_y  \\partial_z \\\\\n0  E_y  0\n\\end{vmatrix}\n= -\\frac{\\partial E_y}{\\partial x} \\hat{\\mathbf{z}}\n$$\n令 $\\hat{\\mathbf{z}}$ 分量相等并代入 $B_z = \\mu_0 H_z$，我们得到：\n$$\n-\\frac{\\partial E_y}{\\partial x} = -\\mu_0 \\frac{\\partial H_z}{\\partial t} \\implies \\mu_0 \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_y}{\\partial x}\n$$\n对于第二个方程（安培定律）：\n$$\n\\nabla \\times \\mathbf{H} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\\n\\partial_x  \\partial_y  \\partial_z \\\\\n0  0  H_z\n\\end{vmatrix}\n= -\\frac{\\partial H_z}{\\partial x} \\hat{\\mathbf{y}}\n$$\n令 $\\hat{\\mathbf{y}}$ 分量相等，我们得到：\n$$\n\\frac{\\partial D_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x}\n$$\n现在，我们在均匀网格上离散化这两个耦合的偏微分方程。遵循类 Yee 氏蛙跳格式，我们在整数空间网格点 $i$ 和整数时间步长 $n$ 处计算 $E_y$ 和 $D_y$，记为 $E_{y,i}^n$ 和 $D_{y,i}^n$。磁场 $H_z$ 在半整数空间点 $i+1/2$ 和半整数时间步长 $n+1/2$ 处计算，记为 $H_{z,i+1/2}^{n+1/2}$。网格间距为 $\\Delta x=L/N_x$，时间步长为 $\\Delta t$。\n\n使用中心差分近似：\n$H_z$ 更新方程通过在 $(i+1/2, n)$ 处计算法拉第定律得到：\n$$\n\\mu_0 \\frac{H_{z,i+1/2}^{n+1/2} - H_{z,i+1/2}^{n-1/2}}{\\Delta t} = \\frac{E_{y,i+1}^n - E_{y,i}^n}{\\Delta x}\n$$\n这得出了 $H_z$ 的更新规则：\n$$\nH_{z,i+1/2}^{n+1/2} = H_{z,i+1/2}^{n-1/2} + \\frac{\\Delta t}{\\mu_0 \\Delta x} (E_{y,i+1}^n - E_{y,i}^n)\n$$\n$D_y$ 更新方程通过在 $(i, n+1/2)$ 处计算安培定律得到：\n$$\n\\frac{D_{y,i}^{n+1} - D_{y,i}^n}{\\Delta t} = - \\frac{H_{z,i+1/2}^{n+1/2} - H_{z,i-1/2}^{n+1/2}}{\\Delta x}\n$$\n这得出了 $D_y$ 的更新规则：\n$$\nD_{y,i}^{n+1} = D_{y,i}^n - \\frac{\\Delta t}{\\Delta x} (H_{z,i+1/2}^{n+1/2} - H_{z,i-1/2}^{n+1/2})\n$$\n在获得 $D_{y,i}^{n+1}$ 后，我们必须通过求解非线性标量三次方程来找到对应的 $E_{y,i}^{n+1}$：\n$$\nf(E) = \\alpha E^3 + \\epsilon_y E - D_{y,i}^{n+1} = 0\n$$\n这通过牛顿法完成，该方法对根的猜测值 $E_k$ 进行迭代优化：\n$$\nE_{k+1} = E_k - \\frac{f(E_k)}{f'(E_k)} = E_k - \\frac{\\alpha E_k^3 + \\epsilon_y E_k - D_{y,i}^{n+1}}{3\\alpha E_k^2 + \\epsilon_y}\n$$\n按照要求，该格式使用预测-校正方法。预测子是第一次迭代，从 $E_k = E_{y,i}^n$ 开始。校正子由后续的迭代组成，直到变化量 $|E_{k+1} - E_k|$ 小于指定的容差。\n\n### 2. 稳定性分析\n\n为了推导 Courant–Friedrichs–Lewy (CFL) 条件，我们将系统响应在一个恒定的工作场振幅 $E_0$ 附近线性化。本构关系为 $D_y = \\epsilon_y E_y + \\alpha E_y^3$。小信号（微分）介电常数为：\n$$\n\\epsilon_{\\mathrm{eff}} = \\frac{dD_y}{dE_y} \\bigg|_{E_0} = \\epsilon_y + 3\\alpha E_0^2\n$$\n这个 $\\epsilon_{\\mathrm{eff}}$ 控制着小扰动的传播速度，$v_{\\mathrm{eff}} = 1/\\sqrt{\\mu_0 \\epsilon_{\\mathrm{eff}}}$。\n为了使 FDTD 格式稳定，数值传播速度 $\\Delta x / \\Delta t$ 必须至少等于系统中任何波的物理传播速度。稳定性由可能的最大波速决定，这对应于 $\\epsilon_{\\mathrm{eff}}$ 的最小正值。\n$$\n\\frac{\\Delta x}{\\Delta t} \\ge \\max(v_{\\mathrm{eff}}) = \\frac{1}{\\sqrt{\\mu_0 \\min(\\epsilon_{\\mathrm{eff}})}}\n$$\n这意味着对时间步长的 CFL 条件：\n$$\n\\Delta t \\le \\Delta x \\sqrt{\\mu_0 \\min(\\epsilon_{\\mathrm{eff}})}\n$$\n$\\min(\\epsilon_{\\mathrm{eff}})$ 的值取决于非线性系数 $\\alpha$ 的符号：\n- 如果 $\\alpha  0$，$\\epsilon_{\\mathrm{eff}}(E_y) = \\epsilon_y + 3\\alpha E_y^2$ 总是大于或等于 $\\epsilon_y$。最小值为 $\\epsilon_{\\mathrm{eff}}(0) = \\epsilon_y$。CFL 条件变为 $\\Delta t \\le \\Delta x \\sqrt{\\mu_0 \\epsilon_y}$。时间步长被给出为 $\\Delta t = s \\Delta x \\sqrt{\\mu_0 \\epsilon_y}$，因此稳定性要求 $s \\le 1$。\n- 如果 $\\alpha  0$，$\\epsilon_{\\mathrm{eff}}(E_y)$ 随着 $|E_y|$ 的增加而减小。$\\epsilon_{\\mathrm{eff}}$ 的最小值将出现在峰值场振幅 $E_{\\max}$ 处。稳定性条件是 $\\Delta t \\le \\Delta x \\sqrt{\\mu_0 (\\epsilon_y + 3\\alpha E_{\\max}^2)}$。这可以用缩放因子 $s$ 重写为：\n$$\ns \\le \\sqrt{1 + \\frac{3\\alpha E_{\\max}^2}{\\epsilon_y}}\n$$\n一个关键的推论是，如果场振幅 $E_y$ 足够大，以至于 $\\epsilon_y + 3\\alpha E_y^2 \\le 0$，有效介电常数将变为非正值。这对应于调制不稳定性这一物理现象，即介质本身变得不稳定。在这种情况下，对于任何实数 $\\Delta t$，线性化的 CFL 条件都无法满足，我们预计无论时间步长选择为何，模拟都将变得不稳定。\n\n在非线性格式中，离散能量 $\\mathcal{E}^n = \\sum_i \\frac{1}{2} (E_{y,i}^n D_{y,i}^n + \\mu_0 H_{z,i}^{n+1/2} H_{z,i}^{n+1/2}) \\Delta x$ 并非严格守恒。然而，该能量的有界性是数值稳定性的一个实用指标。上面推导的 CFL 条件确保误差不会指数级增长，从而使离散能量保持有界。违反此条件会导致数值不稳定性，场值会无限制地增长，导致能量发散。\n\n### 3. 实现细节\n\nFDTD 格式通过使用 `numpy` 库进行高效数组运算的 Python 程序实现。主模拟循环遍历所有测试用例。对于每个用例：\n1.  从给定的输入计算仿真参数（$\\Delta x, \\epsilon_y, \\Delta t$ 等）。\n2.  初始化 $E_y$、$H_z$ 和 $D_y$ 的数组。$H_z$ 的初始条件是 $H_z(x, -\\Delta t/2)=0$。\n3.  根据问题的公式计算初始能量 $\\mathcal{E}^0$，这需要从 $E_y(x,0)$ 预先计算一个步长的 $H_z(x, \\Delta t/2)$。该值存储为 `E_initial`，并初始化一个运行最大值 `E_max`。\n4.  主 FDTD 循环执行 $N_{\\mathrm{steps}}$ 次。在每次迭代 $n$ 中：\n    -   使用时间 $n$ 的 $E_y$ 将 $H_z$ 从时间 $n-1/2$ 更新到 $n+1/2$。周期性边界条件使用 `numpy.roll` 处理。\n    -   计算离散能量 $\\mathcal{E}^n$ 并更新 `E_max`。根据 $1.5 \\times \\mathcal{E}^0$ 的标准进行稳定性检查。\n    -   使用时间 $n+1/2$ 的 $H_z$ 将 $D_y$ 从时间 $n$ 更新到 $n+1$。\n    -   通过对每个网格点使用向量化的牛顿法，数值求解非线性三次方程，将 $E_y$ 从时间 $n$ 更新到 $n+1$。值 $E_y^n$ 用作初始猜测。\n    -   每次更新后都会检查是否存在 `NaN` 或 `inf` 值，以检测灾难性的发散。\n5.  如果循环完成时能量未超过阈值且未发生数值溢出，则认为运行是稳定的 (`True`)；否则是不稳定的 (`False`)。\n6.  收集所有测试用例的稳定性结果，并以指定的列表格式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to run the FDTD simulations for a suite of test cases.\n    \"\"\"\n    # Physical Constants\n    EPSILON_0 = 8.854187817e-12  # F/m\n    MU_0 = 4 * np.pi * 1e-7      # H/m\n    \n    # Test cases from the problem statement\n    test_cases = [\n        # (Nx, L, eps_r_y, alpha, A, s, N_steps)\n        (400, 1.0, 2.25, 1.0e-24, 1.0e6, 0.90, 800), # Case 1\n        (400, 1.0, 2.25, 1.0e-24, 1.0e6, 1.10, 600), # Case 2\n        (400, 1.0, 2.25, -5.0e-25, 4.0e6, 0.50, 800), # Case 3\n        (400, 1.0, 2.25, -5.0e-25, 4.0e6, 0.95, 800), # Case 4\n    ]\n\n    results = []\n    for params in test_cases:\n        is_stable = run_simulation(params, EPSILON_0, MU_0)\n        results.append(is_stable)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_newton(Dy, Ey_guess, epsilon_y, alpha, tol=1e-9, max_iter=10):\n    \"\"\"\n    Solves for Ey from Dy using Newton's method.\n    The equation to solve is f(Ey) = alpha * Ey^3 + epsilon_y * Ey - Dy = 0.\n    This is performed element-wise for all grid points.\n    \n    Args:\n        Dy (np.ndarray): Array of electric displacement values D_y^{n+1}.\n        Ey_guess (np.ndarray): Initial guess for E_y^{n+1}, typically E_y^n.\n        epsilon_y (float): Linear permittivity.\n        alpha (float): Kerr nonlinearity coefficient.\n        tol (float): Convergence tolerance.\n        max_iter (int): Maximum number of iterations.\n\n    Returns:\n        np.ndarray: The solved electric field E_y^{n+1}.\n    \"\"\"\n    Ey = Ey_guess.copy()\n    for _ in range(max_iter):\n        f = alpha * Ey**3 + epsilon_y * Ey - Dy\n        f_prime = 3 * alpha * Ey**2 + epsilon_y\n        \n        # Add a small stabilization term to prevent division by zero,\n        # although this is extremely unlikely to be exactly zero.\n        # If f_prime is negative, it's a sign of potential physical instability,\n        # but Newton's method can still converge.\n        update = f / (f_prime + 1e-99)\n        Ey -= update\n        \n        if np.max(np.abs(update))  tol:\n            break\n            \n    return Ey\n\ndef run_simulation(params, epsilon_0, mu_0):\n    \"\"\"\n    Runs a single FDTD simulation case and determines its stability.\n    \n    Args:\n        params (tuple): A tuple containing simulation parameters\n                        (Nx, L, eps_r_y, alpha, A, s, N_steps).\n        epsilon_0 (float): Vacuum permittivity.\n        mu_0 (float): Vacuum permeability.\n\n    Returns:\n        bool: True if the simulation is stable, False otherwise.\n    \"\"\"\n    Nx, L, eps_r_y, alpha, A, s, N_steps = params\n    \n    # Derived parameters\n    dx = L / Nx\n    epsilon_y = eps_r_y * epsilon_0\n    v_base = 1.0 / np.sqrt(mu_0 * epsilon_y)\n    dt = s * dx / v_base\n\n    # Spatial grid\n    # x = np.linspace(0, L, Nx, endpoint=False)\n    # The explicit x-grid is not strictly needed for the updates, but for ICs\n    x_coords = dx * np.arange(Nx)\n\n    # Initial conditions\n    Ey = A * np.exp(-((x_coords - L / 2)**2) / (L / 10)**2)  # Ey at t=0\n    Hz = np.zeros(Nx)                                     # Hz at t=-dt/2\n    Dy = epsilon_y * Ey + alpha * Ey**3                   # Dy at t=0\n\n    # For the energy calculation at n=0, we need H at t=dt/2.\n    # Perform the first half-step update for H.\n    Hz_half = Hz + (dt / (mu_0 * dx)) * (np.roll(Ey, -1) - Ey)\n    \n    # Initial energy calculation as per problem statement: E^n uses E^n, D^n, H^{n+1/2}\n    # For n=0, we use E_0, D_0, H_{1/2}\n    E_initial = 0.5 * np.sum(Ey * Dy + mu_0 * Hz_half**2) * dx\n    if E_initial == 0: E_initial = 1e-30 # Avoid division by zero if initial energy is zero\n    E_max = E_initial\n    \n    # Set the state for the main FDTD loop. The H-field is a half-step behind.\n    H = Hz \n    \n    for _ in range(N_steps):\n        # State at loop start: Ey is E^n, Dy is D^n, H is H^{n-1/2}\n        \n        # --- Update H-field to H^{n+1/2} ---\n        H = H + (dt / (mu_0 * dx)) * (np.roll(Ey, -1) - Ey)\n\n        # Check for immediate numerical instability\n        if not np.all(np.isfinite(H)):\n            return False\n\n        # --- Energy check and stability criterion ---\n        # Calculate energy at step n, using E^n, D^n, and the newly computed H^{n+1/2}\n        current_energy = 0.5 * np.sum(Ey * Dy + mu_0 * H**2) * dx\n        E_max = max(E_max, current_energy)\n\n        if E_max > 1.5 * E_initial:\n            return False\n        \n        # --- Update D-field to D^{n+1} ---\n        Dy = Dy - (dt / dx) * (H - np.roll(H, 1))\n\n        # --- Update E-field to E^{n+1} ---\n        Ey = solve_newton(Dy, Ey, epsilon_y, alpha)\n\n        # Check for numerical instability from the nonlinear solve\n        if not np.all(np.isfinite(Ey)):\n            return False\n            \n    return True\n\nsolve()\n\n```"
        },
        {
            "introduction": "虽然理论模型和模拟功能强大，但它们需要能反映真实材料的准确参数。本练习通过解决材料参数化问题，弥合了理论与实验之间的鸿沟。您将开发一个程序，将一个物理上有效的、频率相关的洛伦兹（Lorentz）模型拟合到合成的“测量”数据中，同时确保最终模型遵循对称性和无源性等基本约束，这是创建可靠模拟的一项关键任务。",
            "id": "3331898",
            "problem": "你的任务是编写一个完整的程序，该程序针对一组表示相对介电常数的、与频率相关的复对称张量测量数据，确定在强制施加物理约束的同时，以指定的相对误差近似数据所需的最小洛伦兹共振数。建模背景是计算电磁学中的各向异性与双各向异性介质。\n\n该问题基于以下基础：\n\n- 无源介质在频域中的线性电磁响应是因果的，并遵循麦克斯韦方程组，从而得到关于角频率 $ \\omega $ 的解析本构关系。\n- 对于线性各向异性介质，电位移满足 $ \\mathbf{D}(\\omega) = \\bar{\\bar{\\epsilon}}(\\omega) \\mathbf{E}(\\omega) $，其中 $ \\bar{\\bar{\\epsilon}}(\\omega) $ 是一个复对称相对介电常数张量（在本任务中为 $ 2 \\times 2 $），是 $ \\omega $ 的函数。\n- 无源性意味着损耗矩阵，即介电常数张量的虚部 $ \\operatorname{Im} \\{ \\bar{\\bar{\\epsilon}}(\\omega) \\} $，对于所有 $ \\omega  0 $ 都必须是半正定的。\n- 因果性和无源性与通过有限数量的、具有对称半正定耦合矩阵的洛伦兹共振来表示是相容的。\n\n你的程序必须实现一个复对称 $ 2 \\times 2 $ 相对介电常数张量的参数化模型类，通过参数化选择，在所有频率上强制对称性，并在所有频率上强制损耗矩阵为半正定。目标是用能够达到指定相对误差容限的最小共振数量来拟合测量数据。程序不得接受任何输入，并且必须为所提供的测试套件打印最终结果。\n\n建模与计算要求：\n\n- 角频率 $ \\omega $ 必须以弧度/秒为单位。\n- 介电常数张量 $ \\bar{\\bar{\\epsilon}}(\\omega) $ 是无量纲的（相对介电常数）。\n- 拟合必须通过构造来强制满足：\n  1. 在所有 $ \\omega $ 下 $ \\bar{\\bar{\\epsilon}}(\\omega) $ 的对称性。\n  2. 在所有 $ \\omega $ 下 $ \\operatorname{Im} \\{ \\bar{\\bar{\\epsilon}}(\\omega) \\} $ 的半正定性。\n\n- 待使用的误差度量是聚合的平方弗罗贝尼乌斯范数之比的平方根：\n  $$ \\mathcal{E} = \\left( \\frac{ \\sum_{k} \\left\\| \\bar{\\bar{\\epsilon}}_{\\text{model}}(\\omega_k) - \\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k) \\right\\|_F^2 }{ \\sum_{k} \\left\\| \\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k) \\right\\|_F^2 } \\right)^{1/2}, $$\n  其中 $ \\| \\cdot \\|_F $ 表示 $ 2 \\times 2 $ 矩阵的弗罗贝尼乌斯范数，求和遍历所有采样角频率 $ \\omega_k $。\n\n- 程序必须在模型阶数 $ N \\in \\{0,1,2\\} $ 的洛伦兹共振中搜索，并对于给定的容差 $ \\tau $，选择满足 $ \\mathcal{E} \\le \\tau $ 的最小 $ N $。\n\n- 算法必须是确定性的，并且不依赖于随机的用户输入。\n\n测试套件规范：\n\n- 使用一个公共角频率网格 $ \\omega_k $，其中 $ k = 0,1,\\dots,63 $，在频带 $ [\\omega_{\\min}, \\omega_{\\max}] $ 上均匀定义，其中 $ \\omega_{\\min} = 5.0 \\times 10^{10} $ 弧度/秒，$ \\omega_{\\max} = 4.5 \\times 10^{11} $ 弧度/秒。所有测试案例均使用此网格。\n\n- 对于每个测试案例，必须从物理一致的参数生成合成的“测量”数据 $ \\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k) $，然后进行轻微扰动并对称化。扰动后，通过在每个 $ \\omega_k $ 处将虚部投影到半正定锥上来强制损耗为半正定。\n\n- 每个测试案例提供：\n  1. 一个下三角矩阵 $ U $，使得静态张量为 $ \\bar{\\bar{\\epsilon}}_{\\infty} = U U^{\\mathsf{T}} $。\n  2. 一个洛伦兹共振参数列表，其中每个共振由一个三元组 $ (\\omega_{0}, \\gamma, L) $ 定义，包括共振角频率 $ \\omega_0  0 $，阻尼 $ \\gamma  0 $，以及下三角矩阵 $ L $，使得耦合（留数）矩阵为 $ A = L L^{\\mathsf{T}} $。\n  3. 一个容差 $ \\tau $。\n  4. 一个以无量纲振幅 $ \\eta $ 指定的轻微扰动水平。\n\n- 四个测试案例是：\n\n  - 案例1（恒定各向异性介电常数，无共振）：\n    - $ U = \\begin{bmatrix} 1.2  0 \\\\ 0.10  1.0 \\end{bmatrix} $，\n    - 无洛伦兹共振，\n    - $ \\tau = 0.05 $，\n    - $ \\eta = 0.005 $。\n\n  - 案例2（一个共振，中等各向异性）：\n    - $ U = \\begin{bmatrix} 1.0  0 \\\\ 0.15  0.90 \\end{bmatrix} $，\n    - 一个共振，其参数为\n      $ \\omega_{0} = 2.2 \\times 10^{11} $，$ \\gamma = 3.0 \\times 10^{9} $，\n      $ L = \\begin{bmatrix} 0.40  0 \\\\ 0.25  0.35 \\end{bmatrix} $，\n    - $ \\tau = 0.02 $，\n    - $ \\eta = 0.003 $。\n\n  - 案例3（两个共振，显著的色散特征）：\n    - $ U = \\begin{bmatrix} 0.90  0 \\\\ 0.20  1.10 \\end{bmatrix} $，\n    - 两个共振：\n      1. $ \\omega_{0,1} = 1.2 \\times 10^{11} $，$ \\gamma_{1} = 5.0 \\times 10^{9} $，$ L_{1} = \\begin{bmatrix} 0.50  0 \\\\ 0.10  0.20 \\end{bmatrix} $，\n      2. $ \\omega_{0,2} = 3.6 \\times 10^{11} $，$ \\gamma_{2} = 8.0 \\times 10^{9} $，$ L_{2} = \\begin{bmatrix} 0.30  0 \\\\ 0.25  0.40 \\end{bmatrix} $，\n    - $ \\tau = 0.02 $，\n    - $ \\eta = 0.003 $。\n\n  - 案例4（一个带外共振，微弱的色散）：\n    - $ U = \\begin{bmatrix} 1.60  0 \\\\ 0.05  1.30 \\end{bmatrix} $，\n    - 一个共振，其参数为\n      $ \\omega_{0} = 5.5 \\times 10^{11} $，$ \\gamma = 3.0 \\times 10^{9} $，\n      $ L = \\begin{bmatrix} 0.35  0 \\\\ 0.05  0.25 \\end{bmatrix} $，\n    - $ \\tau = 0.01 $，\n    - $ \\eta = 0.003 $。\n\n你的程序必须：\n\n- 按照描述为每个案例生成合成的测量数据，使用从第一性原理推导出的物理有效表示。\n- 对于每个案例，通过拟合参数以最小化 $ \\mathcal{E} $，在 $ N \\in \\{0,1,2\\} $ 上执行模型阶数选择，并通过参数化选择确保对称性和半正定损耗。\n- 如果为保证鲁棒性需要多次初始化，这些初始化必须是确定性的。\n- 生成一行输出，其中包含为每个案例找到的最小 $ N $，形式为方括号括起来的逗号分隔列表，例如 $ [n_1,n_2,n_3,n_4] $。\n\n最终输出必须是严格的一行，格式为 $ [n_1,n_2,n_3,n_4] $。",
            "solution": "用户提供的问题是有效的，因为它在科学上基于电磁学中线性响应理论的既定原理，问题定义良好，具有明确的目标和约束，并且规范正式。\n\n任务是确定所需的洛伦兹共振的最小数量 $N$，以便在指定的误差容限 $\\tau$ 内对合成的频率相关 $2 \\times 2$ 相对介电常数张量数据 $\\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega)$ 进行建模。此过程称为模型阶数选择。模型必须遵循基本的物理约束：对称性和无源性。\n\n相对介电常数张量 $\\bar{\\bar{\\epsilon}}(\\omega)$ 作为角频率 $\\omega$ 的函数，其基础物理模型是一个恒定的高频贡献 $\\bar{\\bar{\\epsilon}}_{\\infty}$ 与一系列 $N$ 个洛伦兹振子之和：\n$$\n\\bar{\\bar{\\epsilon}}(\\omega) = \\bar{\\bar{\\epsilon}}_{\\infty} + \\sum_{j=1}^N \\frac{A_j}{\\omega_{0,j}^2 - \\omega^2 - i\\omega\\gamma_j}\n$$\n这里，对于每个共振 $j$，$\\omega_{0,j}$ 是共振频率，$\\gamma_j$ 是阻尼率，$A_j$ 是耦合强度矩阵（或留数矩阵）。\n\n模型必须在所有频率下满足两个物理约束：\n1.  **对称性**：张量必须是对称的，$\\bar{\\bar{\\epsilon}}(\\omega) = \\bar{\\bar{\\epsilon}}(\\omega)^T$。如果构成张量 $\\bar{\\bar{\\epsilon}}_{\\infty}$ 和所有 $A_j$ 都是对称的，则可以保证这一点。\n2.  **无源性**：介质不能自发产生能量。对于线性电介质，这意味着表示损耗的介电常数张量的虚部，对于所有正频率 $\\omega  0$ 必须是半正定的（PSD）。模型的虚部是：\n    $$\n    \\operatorname{Im}\\{\\bar{\\bar{\\epsilon}}(\\omega)\\} = \\operatorname{Im}\\{\\bar{\\bar{\\epsilon}}_{\\infty}\\} + \\sum_{j=1}^N \\operatorname{Im}\\left\\{\\frac{A_j}{\\omega_{0,j}^2 - \\omega^2 - i\\omega\\gamma_j}\\right\\}\n    $$\n    假设 $\\bar{\\bar{\\epsilon}}_{\\infty}$ 是实数（在无限频率下无损耗），其虚部为零。求和的虚部变为：\n    $$\n    \\operatorname{Im}\\{\\bar{\\bar{\\epsilon}}(\\omega)\\} = \\sum_{j=1}^N \\frac{\\omega\\gamma_j}{(\\omega_{0,j}^2 - \\omega^2)^2 + (\\omega\\gamma_j)^2} A_j\n    $$\n    对于 $\\omega  0$ 和 $\\gamma_j  0$，每个 $A_j$ 的标量系数都是正的。因此，总损耗矩阵为半正定的一个充分条件是每个耦合矩阵 $A_j$ 都是半正定的。\n\n为了在数值优化过程中通过构造来强制执行这些约束，我们使用类 Cholesky 分解对对称半正定矩阵进行参数化。我们定义 $\\bar{\\bar{\\epsilon}}_{\\infty} = UU^T$ 和 $A_j = L_j L_j^T$，其中 $U$ 和 $L_j$ 是实数下三角矩阵。这些三角矩阵的元素，连同正定标量参数 $\\omega_{0,j}$ 和 $\\gamma_j$，成为我们优化问题中的变量。这种参数化从本质上保证了 $\\bar{\\bar{\\epsilon}}_{\\infty}$ 和所有 $A_j$ 都是对称且半正定的。\n\n算法流程如下：\n首先，对于每个测试案例，根据问题规范生成合成的“测量”数据 $\\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k)$。这包括计算真实的张量值，添加具有固定随机种子的复高斯噪声以确保确定性，对称化结果，最后将每个频率下张量的虚部投影到半正定锥上，以确保合成数据在物理上是一致的。\n\n接下来，对于每个数据集，我们在 $N \\in \\{0, 1, 2\\}$ 上执行迭代模型阶数选择搜索。对于给定的阶数 $N$，我们寻求使相对误差度量 $\\mathcal{E}$ 最小化的模型参数：\n$$\n\\mathcal{E} = \\left( \\frac{ \\sum_{k} \\left\\| \\bar{\\bar{\\epsilon}}_{\\text{model}}(\\omega_k) - \\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k) \\right\\|_F^2 }{ \\sum_{k} \\left\\| \\bar{\\bar{\\epsilon}}_{\\text{meas}}(\\omega_k) \\right\\|_F^2 } \\right)^{1/2}\n$$\n最小化 $\\mathcal{E}$ 等价于最小化残差的弗罗贝尼乌斯范数的平方和，这是一个非线性最小二乘问题。我们采用 L-BFGS-B 算法执行最小化，这是一种支持箱式约束的拟牛顿方法。使用约束来强制 $\\omega_{0,j}  0$ 和 $\\gamma_j  0$。\n\n为确保过程的确定性和鲁棒性，使用了一种特定的初始化策略。对于 $N=0$ 模型，$U$ 元素的初始猜测值源自 $\\bar{\\epsilon}_{\\text{meas}}$ 频率平均实部的 Cholesky 分解。对于 $N  0$ 的模型，使用 $N=0$ 拟合得到的收敛参数 $U$作为高频部分的初始猜测，而初始共振参数（$\\omega_{0,j}, \\gamma_j, L_j$）则设置为跨越相关频率范围的固定的确定性值。\n\n搜索从 $N=0$ 开始。如果优化后的模型达到误差 $\\mathcal{E} \\le \\tau$，则 $N=0$ 是最小阶数，我们记录此结果。否则，我们继续进行 $N=1$ 并重复拟合。如此继续，直到满足误差标准或达到最大阶数 $N=2$。第一个满足容差的 $N$ 即为该测试案例的答案。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom numpy.linalg import norm\n\ndef solve():\n    \"\"\"\n    Main function to solve the model order selection problem for the given test suite.\n    \"\"\"\n    #\n    # --- Problem Constants and Setup ---\n    #\n    W_MIN, W_MAX, N_W = 5.0e10, 4.5e11, 64\n    OMEGAS = np.linspace(W_MIN, W_MAX, N_W)\n    RNG = np.random.default_rng(42)  # Fixed seed for deterministic noise generation\n\n    #\n    # --- Physical Model and Parameter Handling ---\n    #\n    def pack_params(U, resonances):\n        \"\"\"Packs structured parameters into a flat vector for the optimizer.\"\"\"\n        x_U = [U[0, 0], U[1, 0], U[1, 1]]\n        x_res = []\n        for res in resonances:\n            L = res['L']\n            x_res.extend([L[0, 0], L[1, 0], L[1, 1], res['w0'], res['gamma']])\n        return np.concatenate([x_U, x_res])\n\n    def unpack_params(x, N):\n        \"\"\"Unpacks the flat parameter vector x into structured parameters.\"\"\"\n        p = {}\n        u11, u21, u22 = x[0], x[1], x[2]\n        p['U'] = np.array([[u11, 0], [u21, u22]])\n        \n        resonances = []\n        offset = 3\n        for _ in range(N):\n            l11, l21, l22, w0, g = x[offset], x[offset+1], x[offset+2], x[offset+3], x[offset+4]\n            resonances.append({\n                'L': np.array([[l11, 0], [l21, l22]]),\n                'w0': w0,\n                'gamma': g\n            })\n            offset += 5\n        p['resonances'] = resonances\n        return p\n\n    def calculate_epsilon_model(omegas, x, N):\n        \"\"\"Calculates the permittivity tensor model from a flat parameter vector.\"\"\"\n        params = unpack_params(x, N)\n        eps_inf = params['U'] @ params['U'].T\n        eps_model = np.tile(eps_inf, (len(omegas), 1, 1)).astype(np.complex128)\n        \n        for res in params['resonances']:\n            A = res['L'] @ res['L'].T\n            w0, gamma = res['w0'], res['gamma']\n            denominator = w0**2 - omegas**2 - 1j * omegas * gamma\n            term = A[None, :, :] / denominator[:, None, None]\n            eps_model += term\n            \n        return eps_model\n\n    #\n    # --- Synthetic Data Generation ---\n    #\n    def generate_measured_data(U_true, resonances_true, eta):\n        \"\"\"Generates synthetic 'measured' data with noise and physical constraints.\"\"\"\n        x_true = pack_params(U_true, resonances_true)\n        N_true = len(resonances_true)\n        eps_true = calculate_epsilon_model(OMEGAS, x_true, N_true)\n\n        noise_real = RNG.standard_normal(size=(N_W, 2, 2))\n        noise_imag = RNG.standard_normal(size=(N_W, 2, 2))\n        eps_noisy = eps_true + eta * (noise_real + 1j * noise_imag)\n        \n        eps_symm = 0.5 * (eps_noisy + eps_noisy.transpose(0, 2, 1))\n        \n        im_eps = eps_symm.imag\n        eigvals, eigvecs = np.linalg.eigh(im_eps)\n        eigvals_clipped = np.maximum(0, eigvals)\n        im_eps_psd = (eigvecs * eigvals_clipped[..., None, :]) @ eigvecs.transpose(0, 2, 1).conj()\n        \n        return eps_symm.real + 1j * im_eps_psd\n\n    #\n    # --- Optimization Setup ---\n    #\n    def project_to_psd(matrix):\n        \"\"\"Projects a 2x2 matrix onto the cone of positive semidefinite matrices.\"\"\"\n        symm_matrix = 0.5 * (matrix + matrix.T)\n        eigvals, eigvecs = np.linalg.eigh(symm_matrix)\n        eigvals_clipped = np.maximum(eigvals, 1e-12)\n        return eigvecs @ np.diag(eigvals_clipped) @ eigvecs.T\n\n    def get_initial_guess_and_bounds(N, eps_meas, fit_results_N0):\n        \"\"\"Provides a deterministic initial guess and bounds for the optimizer.\"\"\"\n        if N == 0:\n            mean_eps_real = np.mean(eps_meas.real, axis=0)\n            psd_mean = project_to_psd(mean_eps_real)\n            U0 = np.linalg.cholesky(psd_mean)\n            x0 = [U0[0, 0], U0[1, 0], U0[1, 1]]\n            bounds = [(-np.inf, np.inf)] * 3\n            return np.array(x0), bounds\n\n        x0_U = fit_results_N0\n        bounds_U = [(-np.inf, np.inf)] * 3\n        \n        common_res_bounds = [(-np.inf, np.inf)]*3 + [(W_MIN*0.5, W_MAX*1.5), (1e8, W_MAX-W_MIN)]\n        \n        if N == 1:\n            x0_res1 = [0.1, 0.1, 0.1, W_MIN + (W_MAX-W_MIN)*0.5, (W_MAX-W_MIN)*0.1]\n            x0 = np.concatenate([x0_U, x0_res1])\n            bounds = bounds_U + common_res_bounds\n            return x0, bounds\n\n        if N == 2:\n            x0_res1 = [0.1, 0.1, 0.1, W_MIN+(W_MAX-W_MIN)/3., (W_MAX-W_MIN)*0.1]\n            x0_res2 = [0.1, 0.1, 0.1, W_MIN+2*(W_MAX-W_MIN)/3., (W_MAX-W_MIN)*0.1]\n            x0 = np.concatenate([x0_U, x0_res1, x0_res2])\n            bounds = bounds_U + common_res_bounds + common_res_bounds\n            return x0, bounds\n        \n        return None, None # Should not be reached\n\n    #\n    # --- Main Execution Logic ---\n    #\n    test_cases = [\n        {\"U\": np.array([[1.2, 0], [0.10, 1.0]]), \"resonances\": [], \"tau\": 0.05, \"eta\": 0.005},\n        {\"U\": np.array([[1.0, 0], [0.15, 0.90]]), \"resonances\": [{\"w0\": 2.2e11, \"gamma\": 3.0e9, \"L\": np.array([[0.40, 0], [0.25, 0.35]])}], \"tau\": 0.02, \"eta\": 0.003},\n        {\"U\": np.array([[0.90, 0], [0.20, 1.10]]), \"resonances\": [{\"w0\": 1.2e11, \"gamma\": 5.0e9, \"L\": np.array([[0.50, 0], [0.10, 0.20]])}, {\"w0\": 3.6e11, \"gamma\": 8.0e9, \"L\": np.array([[0.30, 0], [0.25, 0.40]])}], \"tau\": 0.02, \"eta\": 0.003},\n        {\"U\": np.array([[1.60, 0], [0.05, 1.30]]), \"resonances\": [{\"w0\": 5.5e11, \"gamma\": 3.0e9, \"L\": np.array([[0.35, 0], [0.05, 0.25]])}], \"tau\": 0.01, \"eta\": 0.003}\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        eps_meas = generate_measured_data(case[\"U\"], case[\"resonances\"], case[\"eta\"])\n        tau = case[\"tau\"]\n        \n        denom_err_sq = np.sum(norm(eps_meas, ord='fro', axis=(1, 2))**2)\n        fit_results_N0 = None\n\n        for N in range(3):  # Test model orders N = 0, 1, 2\n            def objective_func(x):\n                eps_model = calculate_epsilon_model(OMEGAS, x, N)\n                num_err_sq = np.sum(norm(eps_model - eps_meas, ord='fro', axis=(1, 2))**2)\n                return num_err_sq\n\n            x0, bounds = get_initial_guess_and_bounds(N, eps_meas, fit_results_N0)\n            \n            res = minimize(\n                objective_func,\n                x0,\n                method='L-BFGS-B',\n                bounds=bounds,\n                options={'ftol': 1e-12, 'gtol': 1e-8, 'maxiter': 2000}\n            )\n\n            if N == 0:\n                fit_results_N0 = res.x\n\n            error = np.sqrt(res.fun / denom_err_sq)\n            \n            if error = tau:\n                final_results.append(N)\n                break\n        else:\n            final_results.append(2)\n            \n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}