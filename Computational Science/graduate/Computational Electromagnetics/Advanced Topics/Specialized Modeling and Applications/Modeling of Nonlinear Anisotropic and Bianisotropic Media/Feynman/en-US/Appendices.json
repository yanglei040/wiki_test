{
    "hands_on_practices": [
        {
            "introduction": "The macroscopic response of a nonlinear crystal is fundamentally constrained by its microscopic symmetry. This exercise provides foundational practice in applying Neumann's principle to determine the structure of the second-order susceptibility tensor, $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$. By systematically imposing symmetry operations on the tensor components, you will bridge the gap between abstract group theory and the concrete mathematical form used in nonlinear optical simulations, a critical skill for modeling anisotropic materials .",
            "id": "3331971",
            "problem": "A uniaxial crystal belonging to the trigonal point group with threefold rotation and mirror symmetry, denoted $3m$ (also known as $C_{3v}$), is used for frequency doubling (second-harmonic generation). Let the crystallographic (optical) axis coincide with the Cartesian axis $z$, and let $(x,y)$ span the basal plane. In the frequency-domain, the second-order nonlinear polarization $\\mathbf{P}^{(2)}(2\\omega)$ is defined by the second-order electric susceptibility tensor $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ via the constitutive relation\n$$\nP^{(2)}_{i}(2\\omega) \\;=\\; \\varepsilon_{0}\\,\\sum_{j,k} \\chi^{(2)}_{ijk}(-2\\omega;\\omega,\\omega)\\,E_{j}(\\omega)\\,E_{k}(\\omega),\n$$\nwhere $i,j,k\\in\\{x,y,z\\}$ and the Einstein summation convention is used. Assume the nonresonant Kleinman symmetry holds so that $\\chi^{(2)}_{ijk}=\\chi^{(2)}_{ikj}$.\n\n1) Starting from Neumann’s principle (“the symmetry elements of any physical property of a crystal must include the symmetry elements of the crystal’s point group”), impose invariance of $\\chi^{(2)}_{ijk}$ under the generators of $3m$: a rotation by $120^{\\circ}$ about the $z$-axis and a mirror reflection through a vertical plane containing the $z$-axis. Use the tensor transformation law\n$$\n\\chi'^{(2)}_{ijk} \\;=\\; R_{ii'}\\,R_{jj'}\\,R_{kk'}\\,\\chi^{(2)}_{i'j'k'}\n$$\nfor each generator with orthogonal matrix $\\bar{\\bar{R}}$, and the intrinsic permutation symmetry in the last two indices, to determine which Cartesian components $\\chi^{(2)}_{ijk}$ can be nonzero and to identify the minimal set of independent coefficients together with any equalities among them. Do not refer to tabulated results; justify each elimination or equality by symmetry.\n\n2) Introduce the contracted notation in which the quadratic field combinations are collected as\n$$\n\\mathbf{S} \\;=\\; \\big(E_{x}^{2},\\,E_{y}^{2},\\,E_{z}^{2},\\,2E_{y}E_{z},\\,2E_{x}E_{z},\\,2E_{x}E_{y}\\big),\n$$\nand the $3\\times 6$ matrix $\\bar{\\bar{d}}$ is defined by\n$$\nP^{(2)}_{i}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\sum_{\\ell=1}^{6} d_{i\\ell}\\,S_{\\ell}.\n$$\nExpress $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ for the $3m$ crystal in this contracted $d$-tensor form using the conventional crystallographic orientation for class $3m$, explicitly writing the $3\\times 6$ matrix $\\bar{\\bar{d}}$ in terms of its independent coefficients.\n\n3) Now consider a monochromatic plane wave at frequency $\\omega$ propagating along the $+z$-axis with electric field\n$$\n\\mathbf{E}(\\omega) \\;=\\; E_{0}\\,\\big(\\cos\\phi\\,\\hat{\\mathbf{x}} \\;+\\; \\sin\\phi\\,\\hat{\\mathbf{y}}\\big),\n$$\nwith $E_{0}>0$ and angle $\\phi\\in[0,2\\pi)$ measured from the $x$-axis in the basal plane. Using your result from part 2, compute the normalized longitudinal second-harmonic polarization\n$$\n\\frac{P^{(2)}_{z}(2\\omega)}{\\varepsilon_{0}\\,E_{0}^{2}}\n$$\nas a single closed-form analytic expression in terms of the independent coefficients of $\\bar{\\bar{d}}$ and the angle $\\phi$, and simplify fully. Provide this normalized scalar as your final answer. No numerical evaluation is required, and no units should be included in your final answer.",
            "solution": "The problem is well-posed, scientifically grounded, and internally consistent. It is a standard problem in nonlinear optics concerning the application of crystal symmetry to determine the form of the second-order susceptibility tensor.\n\nThe solution is divided into three parts as requested by the problem statement.\n\n### Part 1: Determination of the $\\chi^{(2)}$ Tensor Form for Group $3m$\n\nThe point group $3m$ ($C_{3v}$) is characterized by a threefold rotation axis and a mirror plane parallel to that axis. We align the Cartesian $z$-axis with the threefold rotation axis. For the mirror plane, we choose the $xz$-plane, which is a conventional choice. The generators for the group are thus a rotation $C_3$ by $\\theta = 2\\pi/3$ about the $z$-axis and a reflection $\\sigma_v$ across the $xz$-plane.\n\nAccording to Neumann's principle, the susceptibility tensor $\\bar{\\bar{\\bar{\\chi}}}^{(2)}$ must be invariant under these symmetry operations. The tensor transformation law is given by $\\chi'^{(2)}_{ijk} = R_{ii'}R_{jj'}R_{kk'}\\chi^{(2)}_{i'j'k'}$, where $\\bar{\\bar{R}}$ is the matrix representing the symmetry operation.\n\n**A. Invariance under Reflection $\\sigma_v$ (in the $xz$-plane)**\n\nThe reflection operation transforms coordinates as $(x, y, z) \\to (x, -y, z)$. The corresponding transformation matrix is:\n$$\n\\bar{\\bar{R}}_{\\sigma_v} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & -1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThe invariance condition is $\\chi^{(2)}_{ijk} = (R_{\\sigma_v})_{ii'}(R_{\\sigma_v})_{jj'}(R_{\\sigma_v})_{kk'}\\chi^{(2)}_{i'j'k'}$. Since $\\bar{\\bar{R}}_{\\sigma_v}$ is diagonal, this simplifies to $\\chi^{(2)}_{ijk} = (R_{\\sigma_v})_{ii}(R_{\\sigma_v})_{jj}(R_{\\sigma_v})_{kk}\\chi^{(2)}_{ijk}$ (no summation). For a component $\\chi^{(2)}_{ijk}$ to be non-zero, we must have $(R_{\\sigma_v})_{ii}(R_{\\sigma_v})_{jj}(R_{\\sigma_v})_{kk} = 1$.\nThe product is equal to $(-1)^{N_y}$, where $N_y$ is the number of times the index $y$ appears in $(i,j,k)$. Therefore, for $\\chi^{(2)}_{ijk}$ to be non-zero, $N_y$ must be an even number ($0$ or $2$).\n\nThis eliminates all components with an odd number of $y$ indices. For instance:\n- $N_y=1$: $\\chi^{(2)}_{yxx}$, $\\chi^{(2)}_{xxy}$, $\\chi^{(2)}_{xyz}$, etc., must all be zero.\n- $N_y=3$: $\\chi^{(2)}_{yyy}$ must be zero.\n\nThe surviving components (prior to applying $C_3$ symmetry and considering Kleinman symmetry $\\chi^{(2)}_{ijk}=\\chi^{(2)}_{ikj}$) are those with $N_y=0$ or $N_y=2$.\n- $N_y=0$: all indices are from $\\{x, z\\}$, e.g., $\\chi^{(2)}_{xxx}, \\chi^{(2)}_{xxz}, \\chi^{(2)}_{zxz}, \\chi^{(2)}_{zzz}$.\n- $N_y=2$: two indices are $y$, one is from $\\{x, z\\}$, e.g., $\\chi^{(2)}_{xyy}, \\chi^{(2)}_{yxy}, \\chi^{(2)}_{yyx}, \\chi^{(2)}_{zyy}$.\n\n**B. Invariance under Rotation $C_3$ (by $120^\\circ$ about $z$-axis)**\n\nThe rotation matrix for a passive transformation (rotation of the coordinate system) by $\\theta = 2\\pi/3$ is specified as:\n$$\n\\bar{\\bar{R}}_{C_3} = \\begin{pmatrix} \\cos\\theta & \\sin\\theta & 0 \\\\ -\\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} = \\begin{pmatrix} -1/2 & \\sqrt{3}/2 & 0 \\\\ -\\sqrt{3}/2 & -1/2 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nLet $c = \\cos\\theta = -1/2$ and $s = \\sin\\theta = \\sqrt{3}/2$. We apply the invariance condition $\\chi^{(2)}_{ijk} = R_{ii'}R_{jj'}R_{kk'}\\chi^{(2)}_{i'j'k'}$ to the components that survived the $\\sigma_v$ reflection symmetry.\n\n1.  **Components involving only $z$:**\n    $\\chi'^{(2)}_{zzz} = R_{zz}R_{zz}R_{zz}\\chi^{(2)}_{zzz} = (1)^3 \\chi^{(2)}_{zzz} = \\chi^{(2)}_{zzz}$. So $\\chi^{(2)}_{zzz}$ is an independent, non-zero component.\n\n2.  **Components relating $\\{x,y\\}$ to $z$:**\n    Consider $\\chi^{(2)}_{zxx}$. The transformed component is $\\chi'^{(2)}_{zxx} = R_{zi'} R_{xj'} R_{xk'} \\chi^{(2)}_{zi'j'k'}$. Since $R_{zi'}=\\delta_{zi'}$, this is $\\chi'^{(2)}_{zxx} = R_{xj'} R_{xk'} \\chi^{(2)}_{zj'k'}$. Expanding over $j', k' \\in \\{x,y\\}$ (as $z$ components do not mix with $xy$ under this rotation):\n    $\\chi'^{(2)}_{zxx} = R_{xx}^2 \\chi^{(2)}_{zxx} + R_{xy}^2 \\chi^{(2)}_{zyy} + R_{xx}R_{xy}(\\chi^{(2)}_{zxy}+\\chi^{(2)}_{zyx})$.\n    From $\\sigma_v$ symmetry, $\\chi^{(2)}_{zxy}$ and $\\chi^{(2)}_{zyx}$ are zero ($N_y=1$).\n    $\\chi'^{(2)}_{zxx} = c^2 \\chi^{(2)}_{zxx} + s^2 \\chi^{(2)}_{zyy}$. Invariance requires $\\chi^{(2)}_{zxx} = c^2 \\chi^{(2)}_{zxx} + s^2 \\chi^{(2)}_{zyy}$, which gives $\\chi^{(2)}_{zxx}(1-c^2) = s^2 \\chi^{(2)}_{zyy}$. Since $s^2=1-c^2$, this simplifies to $\\chi^{(2)}_{zxx} = \\chi^{(2)}_{zyy}$.\n    A similar calculation for $\\chi'^{(2)}_{zyy}$ confirms this relationship.\n\n    Consider $\\chi^{(2)}_{xxz}$. Due to Kleinman symmetry, $\\chi^{(2)}_{xxz} = \\chi^{(2)}_{xzx}$.\n    $\\chi'^{(2)}_{xxz} = R_{xi'}R_{xj'}R_{zk'} \\chi^{(2)}_{i'j'k'} = R_{xi'}R_{xj'} \\chi^{(2)}_{i'j'z}$.\n    $\\chi'^{(2)}_{xxz} = R_{xx}^2 \\chi^{(2)}_{xxz} + R_{xy}^2 \\chi^{(2)}_{yyz} + R_{xx}R_{xy}(\\chi^{(2)}_{xyz}+\\chi^{(2)}_{yxz})$. Components with one $y$ are zero, so $\\chi'^{(2)}_{xxz} = c^2 \\chi^{(2)}_{xxz} + s^2 \\chi^{(2)}_{yyz}$. Invariance gives $\\chi^{(2)}_{xxz} = \\chi^{(2)}_{yyz}$.\n\n    Consider $\\chi^{(2)}_{xzz}$. $\\chi'^{(2)}_{xzz} = R_{xi'}R_{zj'}R_{zk'} \\chi^{(2)}_{i'zz} = R_{xi'} \\chi^{(2)}_{i'zz} = c\\chi^{(2)}_{xzz} + s\\chi^{(2)}_{yzz}$. From $\\sigma_v$, $\\chi^{(2)}_{yzz}=0$ ($N_y=1$). So $\\chi'^{(2)}_{xzz} = c\\chi^{(2)}_{xzz}$. Since $c \\ne 1$, this requires $\\chi^{(2)}_{xzz}=0$.\n\n    Consider $\\chi^{(2)}_{zxz}$. $\\chi'^{(2)}_{zxz} = R_{zi'}R_{xj'}R_{zk'} \\chi^{(2)}_{i'j'k'} = R_{xj'} \\chi^{(2)}_{zj'z} = c\\chi^{(2)}_{zxz} + s\\chi^{(2)}_{zyz}$. From $\\sigma_v$, $\\chi^{(2)}_{zyz}=0$ ($N_y=1$). So $\\chi'^{(2)}_{zxz} = c\\chi^{(2)}_{zxz}$, which implies $\\chi^{(2)}_{zxz}=0$.\n\n3.  **Components involving only $x, y$:**\n    Consider the system for $\\chi^{(2)}_{xxx}, \\chi^{(2)}_{xyy}, \\chi^{(2)}_{yyx}$ (note $\\chi^{(2)}_{yxy}=\\chi^{(2)}_{yyx}$ by Kleinman, and others like $\\chi^{(2)}_{xxy}$ are zero from $\\sigma_v$).\n    $\\chi'^{(2)}_{xxx} = c^3 \\chi^{(2)}_{xxx} + cs^2(\\chi^{(2)}_{xyy} + 2\\chi^{(2)}_{yyx})$. Invariance gives $\\chi^{(2)}_{xxx}(1-c^3) = cs^2(\\chi^{(2)}_{xyy} + 2\\chi^{(2)}_{yyx})$. With $c=-1/2, s^2=3/4$, this becomes $3\\chi^{(2)}_{xxx} = -(\\chi^{(2)}_{xyy} + 2\\chi^{(2)}_{yyx})$.\n    $\\chi'^{(2)}_{xyy} = cs^2\\chi^{(2)}_{xxx} + c^3\\chi^{(2)}_{xyy} - 2cs^2\\chi^{(2)}_{yyx}$. Invariance gives $\\chi^{(2)}_{xyy}(1-c^3) = cs^2\\chi^{(2)}_{xxx} - 2cs^2\\chi^{(2)}_{yyx}$, which becomes $3\\chi^{(2)}_{xyy} = -\\chi^{(2)}_{xxx} + 2\\chi^{(2)}_{yyx}$.\n    Solving this system of two linear equations:\n    From the second equation, $\\chi^{(2)}_{xxx} = 2\\chi^{(2)}_{yyx} - 3\\chi^{(2)}_{xyy}$. Substituting into the first:\n    $3(2\\chi^{(2)}_{yyx} - 3\\chi^{(2)}_{xyy}) = -\\chi^{(2)}_{xyy} - 2\\chi^{(2)}_{yyx} \\implies 6\\chi^{(2)}_{yyx} - 9\\chi^{(2)}_{xyy} = -\\chi^{(2)}_{xyy} - 2\\chi^{(2)}_{yyx}$.\n    $8\\chi^{(2)}_{yyx} = 8\\chi^{(2)}_{xyy} \\implies \\chi^{(2)}_{yyx} = \\chi^{(2)}_{xyy}$.\n    Substituting this back: $\\chi^{(2)}_{xxx} = 2\\chi^{(2)}_{xyy} - 3\\chi^{(2)}_{xyy} = -\\chi^{(2)}_{xyy}$.\n\n**Summary of independent non-zero components of $\\chi^{(2)}$:**\nWe choose the set of independent coefficients to be $\\chi^{(2)}_{xxx}$, $\\chi^{(2)}_{xxz}$, $\\chi^{(2)}_{zxx}$, and $\\chi^{(2)}_{zzz}$. All other non-zero components are related to these:\n- $\\chi^{(2)}_{xyy} = -\\chi^{(2)}_{xxx}$\n- $\\chi^{(2)}_{yyx} = \\chi^{(2)}_{yxy} = \\chi^{(2)}_{xyy} = -\\chi^{(2)}_{xxx}$\n- $\\chi^{(2)}_{yyz} = \\chi^{(2)}_{yzy} = \\chi^{(2)}_{xxz}$\n- $\\chi^{(2)}_{zyy} = \\chi^{(2)}_{zxx}$\n- All other components are zero, including $\\chi^{(2)}_{xzz}=0$, $\\chi^{(2)}_{zxz}=0$.\n\n### Part 2: Contracted $d$-Tensor Form\n\nThe relation between the $\\chi^{(2)}_{ijk}$ tensor and the $d_{i\\ell}$ matrix is given by comparing the two forms of the constitutive relation, respecting Kleinman symmetry.\n$P_i = \\varepsilon_{0} \\sum_{j,k} \\chi^{(2)}_{ijk} E_j E_k = \\varepsilon_0 (\\chi^{(2)}_{ixx}E_x^2 + \\chi^{(2)}_{iyy}E_y^2 + \\chi^{(2)}_{izz}E_z^2 + 2\\chi^{(2)}_{iyz}E_yE_z + 2\\chi^{(2)}_{ixz}E_xE_z + 2\\chi^{(2)}_{ixy}E_xE_y)$\n$P_i = 2\\varepsilon_{0} \\sum_{\\ell} d_{i\\ell} S_{\\ell} = 2\\varepsilon_0 (d_{i1}E_x^2 + d_{i2}E_y^2 + d_{i3}E_z^2 + 2d_{i4}E_yE_z + 2d_{i5}E_xE_z + 2d_{i6}E_xE_y)$\nComparing coefficients gives the mapping:\n$\\chi^{(2)}_{ixx}=2d_{i1}$, $\\chi^{(2)}_{iyy}=2d_{i2}$, $\\chi^{(2)}_{izz}=2d_{i3}$\n$\\chi^{(2)}_{iyz}=2d_{i4}$, $\\chi^{(2)}_{ixz}=2d_{i5}$, $\\chi^{(2)}_{ixy}=2d_{i6}$\n\nUsing the relationships derived in Part 1 for $\\chi^{(2)}_{ijk}$:\n- $\\chi^{(2)}_{xxx} = 2d_{11}$\n- $\\chi^{(2)}_{xyy} = 2d_{12} \\implies 2d_{12} = -\\chi^{(2)}_{xxx} = -2d_{11} \\implies d_{12}=-d_{11}$.\n- $\\chi^{(2)}_{xzz} = 2d_{13} \\implies 2d_{13} = 0 \\implies d_{13}=0$.\n- $\\chi^{(2)}_{yyz} = 2d_{24}$ and $\\chi^{(2)}_{xxz} = 2d_{15}$. The relation $\\chi^{(2)}_{xxz}=\\chi^{(2)}_{yyz}$ implies $d_{15}=d_{24}$.\n- $\\chi^{(2)}_{yxy} = 2d_{26}$. We have $\\chi^{(2)}_{yxy} = -\\chi^{(2)}_{xxx}$, so $2d_{26} = -2d_{11} \\implies d_{26}=-d_{11}$.\n- $\\chi^{(2)}_{zxx} = 2d_{31}$ and $\\chi^{(2)}_{zyy} = 2d_{32}$. The relation $\\chi^{(2)}_{zxx}=\\chi^{(2)}_{zyy}$ implies $d_{31}=d_{32}$.\n- $\\chi^{(2)}_{zxz} = 2d_{35}$ (via Kleinman $\\chi^{(2)}_{zxz}=\\chi^{(2)}_{zzx}$). We found $\\chi^{(2)}_{zxz}=0$, so $d_{35}=0$.\n- $\\chi^{(2)}_{zzz}=2d_{33}$ is an independent coefficient.\n- All other coefficients are zero based on the $\\sigma_v$ symmetry zeros. For example, $d_{14} \\propto \\chi^{(2)}_{xyz}=0$, $d_{21} \\propto \\chi^{(2)}_{yxx}=0$, $d_{22} \\propto \\chi^{(2)}_{yyy}=0$.\n\nAssembling these results into the $3 \\times 6$ matrix $\\bar{\\bar{d}}$:\n$$\n\\bar{\\bar{d}} = \\begin{pmatrix} d_{11} & d_{12} & d_{13} & d_{14} & d_{15} & d_{16} \\\\ d_{21} & d_{22} & d_{23} & d_{24} & d_{25} & d_{26} \\\\ d_{31} & d_{32} & d_{33} & d_{34} & d_{35} & d_{36} \\end{pmatrix} = \\begin{pmatrix} d_{11} & -d_{11} & 0 & 0 & d_{15} & 0 \\\\ 0 & 0 & 0 & d_{15} & 0 & -d_{11} \\\\ d_{31} & d_{31} & d_{33} & 0 & 0 & 0 \\end{pmatrix}\n$$\nThe minimal set of independent coefficients can be denoted as $d_{11}$, $d_{15}$, $d_{31}$, and $d_{33}$.\n\n### Part 3: Calculation of Normalized Longitudinal Polarization\n\nThe incident electric field is given as $\\mathbf{E}(\\omega) = E_{0}(\\cos\\phi\\,\\hat{\\mathbf{x}} + \\sin\\phi\\,\\hat{\\mathbf{y}})$. The field components are:\n$E_x=E_0\\cos\\phi$, $E_y=E_0\\sin\\phi$, $E_z=0$.\n\nThe quadratic field combinations vector $\\mathbf{S}$ is:\n$S_1 = E_x^2 = E_0^2 \\cos^2\\phi$\n$S_2 = E_y^2 = E_0^2 \\sin^2\\phi$\n$S_3 = E_z^2 = 0$\n$S_4 = 2E_yE_z = 0$\n$S_5 = 2E_xE_z = 0$\n$S_6 = 2E_xE_y = 2E_0^2\\cos\\phi\\sin\\phi = E_0^2\\sin(2\\phi)$\n\nWe need to compute the longitudinal second-harmonic polarization, $P^{(2)}_z(2\\omega)$. The formula is:\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\sum_{\\ell=1}^{6} d_{3\\ell}\\,S_{\\ell}\n$$\nUsing the third row of the derived $\\bar{\\bar{d}}$ matrix, which is $(d_{31}, d_{31}, d_{33}, 0, 0, 0)$:\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,(d_{31}S_1 + d_{31}S_2 + d_{33}S_3 + 0\\cdot S_4 + 0\\cdot S_5 + 0\\cdot S_6)\n$$\nSubstituting the expressions for $S_\\ell$:\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,\\left(d_{31}(E_0^2 \\cos^2\\phi) + d_{31}(E_0^2 \\sin^2\\phi) + d_{33}(0)\\right)\n$$\nFactoring out common terms:\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,d_{31}E_0^2 (\\cos^2\\phi + \\sin^2\\phi)\n$$\nUsing the trigonometric identity $\\cos^2\\phi+\\sin^2\\phi=1$:\n$$\nP^{(2)}_{z}(2\\omega) \\;=\\; 2\\,\\varepsilon_{0}\\,d_{31}E_0^2\n$$\nThe result is independent of the polarization angle $\\phi$. This is a direct consequence of the threefold symmetry about the $z$-axis, which requires the coefficients for $E_x^2$ ($d_{31}$) and $E_y^2$ ($d_{32}$) to be equal in the generation of $P_z^{(2)}$.\n\nFinally, we compute the required normalized quantity:\n$$\n\\frac{P^{(2)}_{z}(2\\omega)}{\\varepsilon_{0}\\,E_{0}^{2}} = \\frac{2\\,\\varepsilon_{0}\\,d_{31}E_0^2}{\\varepsilon_{0}\\,E_{0}^{2}} = 2d_{31}\n$$",
            "answer": "$$\n\\boxed{2d_{31}}\n$$"
        },
        {
            "introduction": "Moving from the static tensor description to dynamic simulation requires a robust time-stepping algorithm. This practice guides you through the implementation of a Finite-Difference Time-Domain (FDTD) scheme for a Kerr-type nonlinear medium, a common model for third-order effects. You will confront the challenge of solving the implicit nonlinear constitutive relation at each time step, employing a Newton-Raphson iterative solver and analyzing the numerical stability of the complete scheme .",
            "id": "3331925",
            "problem": "Consider a one-dimensional transverse electric configuration in computational electromagnetics with periodic boundary conditions, where the electric field component $E_y(x,t)$ is coupled to the magnetic field component $H_z(x,t)$. The material is Kerr-type anisotropic in the sense that its electric displacement $\\mathbf{D}$ depends nonlinearly and componentwise on $\\mathbf{E}$ through a tensor-valued permittivity $\\bar{\\bar{\\epsilon}}(\\mathbf{E})=\\bar{\\bar{\\epsilon}}_0+\\alpha\\,\\mathrm{diag}(E_x^2,E_y^2,E_z^2)$. In the present one-dimensional transverse electric configuration, assume $E_x=0$ and $E_z=0$ so that the only nonzero displacement component is $D_y(x,t)$, with the constitutive relation $D_y=\\epsilon_y(E_y)\\,E_y$ and\n$$\n\\epsilon_y(E_y)=\\epsilon_y+\\alpha E_y^2,\n$$\nwhere $\\epsilon_y$ is the constant baseline permittivity along the $y$ axis (a component of the anisotropic baseline tensor $\\bar{\\bar{\\epsilon}}_0$) and $\\alpha$ is the Kerr nonlinearity coefficient. The magnetic response is linear and isotropic with $B_z=\\mu_0 H_z$, where $\\mu_0$ is the vacuum permeability.\n\nStarting from Maxwell’s equations in differential form,\n$$\n\\nabla \\times \\mathbf{E}=-\\frac{\\partial \\mathbf{B}}{\\partial t},\\qquad \\nabla \\times \\mathbf{H}=\\frac{\\partial \\mathbf{D}}{\\partial t},\n$$\nderive a Yee-like finite-difference time-domain scheme for the pair $(E_y,H_z)$ on a uniform grid of $N_x$ points over a domain of length $L$ with periodic boundary conditions. Use a leapfrog staggering in time so that $H_z$ is updated at half time-steps and $D_y$ at integer time-steps. Specifically:\n\n- Express the discrete updates for $H_z$ and $D_y$ in terms of spatial finite differences with spacing $\\Delta x=L/N_x$ and time step $\\Delta t$, ensuring consistency with the curl relations in one spatial dimension.\n\n- Because the constitutive relation $D_y=\\epsilon_y(E_y) E_y=\\epsilon_y E_y + \\alpha E_y^3$ is nonlinear in $E_y$, formulate and implement a Newton predictor-corrector step at each grid point to compute $E_y^{n+1}$ from the updated $D_y^{n+1}$. That is, for each node, solve the scalar nonlinear equation\n$$\nf(E)=\\alpha E^3+\\epsilon_y E - D_y^{n+1}=0\n$$\nusing:\n  1. A predictor obtained by one Newton iteration starting from the previous electric field iterate $E_y^n$, and\n  2. A corrector obtained by continuing Newton iterations until a prescribed tolerance is met.\n\nPresent a stability analysis for this Yee-like scheme with the nonlinear update, by linearizing the constitutive relation about a nonzero operating field amplitude $E_0$ to define an effective permittivity\n$$\n\\epsilon_{\\mathrm{eff}}(E_0)=\\epsilon_y+3\\alpha E_0^2,\n$$\nand then deriving a Courant–Friedrichs–Lewy (CFL) bound on $\\Delta t$ such that the discrete energy\n$$\n\\mathcal{E}^n=\\sum_{i=0}^{N_x-1}\\frac{1}{2}\\left(E_{y,i}^n D_{y,i}^n+\\mu_0 H_{z,i}^{n+\\frac{1}{2}} H_{z,i}^{n+\\frac{1}{2}}\\right)\\Delta x\n$$\nremains bounded. Provide the reasoning from Maxwell’s equations and the discrete update structure to argue the appropriate time-step restriction in terms of $\\Delta x$, $\\mu_0$, and an admissible bound on $\\epsilon_{\\mathrm{eff}}$.\n\nImplement the above scheme as a runnable program that performs the following numerical experiment for a set of test cases. For each test case, initialize $E_y(x,0)$ as a Gaussian pulse centered at $x=L/2$ with amplitude $A$ and width $w=L/10$, that is,\n$$\nE_y(x,0)=A\\exp\\left(-\\frac{(x-L/2)^2}{w^2}\\right),\n$$\nand set $H_z(x,-\\Delta t/2)=0$. Initialize $D_y(x,0)=\\epsilon_y E_y(x,0)+\\alpha E_y(x,0)^3$. Advance the solution for $N_{\\mathrm{steps}}$ steps using the Yee-like updates with the Newton predictor-corrector rule. Define stability for each run as follows: the run is stable if all field values remain finite and the maximum discrete energy over all time steps is less than $1.5$ times the initial energy, and unstable otherwise.\n\nUse the International System of Units, with $\\Delta x$ expressed in meters, $\\Delta t$ in seconds, field amplitudes in volts per meter, permittivities in farads per meter, and permeabilities in henries per meter. The vacuum constants are $\\epsilon_0=8.854187817\\times10^{-12}\\,F/m$ and $\\mu_0=4\\pi\\times10^{-7}\\,H/m$. The baseline anisotropic permittivity component $\\epsilon_y$ is given by $\\epsilon_y=\\epsilon_0 \\epsilon_{r,y}$, where $\\epsilon_{r,y}$ is a dimensionless relative permittivity along $y$.\n\nTest Suite:\nFor each test case, the program must construct $\\Delta t$ from a specified scaling factor $s$ relative to the linear CFL bound based on $\\epsilon_y$, namely\n$$\n\\Delta t = s\\frac{\\Delta x}{v_{\\mathrm{base}}},\\qquad v_{\\mathrm{base}}=\\frac{1}{\\sqrt{\\mu_0 \\epsilon_y}}.\n$$\nRun each case for the specified number of steps $N_{\\mathrm{steps}}$ and report stability.\n\n- Case 1 (happy path): $N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=+1.0\\times 10^{-24}\\,F\\cdot m/V^2$, $A=1.0\\times 10^{6}\\,V/m$, $s=0.90$, $N_{\\mathrm{steps}}=800$.\n\n- Case 2 (violated CFL, expect instability): $N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=+1.0\\times 10^{-24}\\,F\\cdot m/V^2$, $A=1.0\\times 10^{6}\\,V/m$, $s=1.10$, $N_{\\mathrm{steps}}=600$.\n\n- Case 3 (negative nonlinearity, conservative step): $N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=-5.0\\times 10^{-25}\\,F\\cdot m/V^2$, $A=4.0\\times 10^{6}\\,V/m$, $s=0.50$, $N_{\\mathrm{steps}}=800$.\n\n- Case 4 (negative nonlinearity, aggressive step, expect instability): $N_x=400$, $L=1.0$ m, $\\epsilon_{r,y}=2.25$, $\\alpha=-5.0\\times 10^{-25}\\,F\\cdot m/V^2$, $A=4.0\\times 10^{6}\\,V/m$, $s=0.95$, $N_{\\mathrm{steps}}=800$.\n\nYour program should produce a single line of output containing the stability results for the four test cases as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,False]\").",
            "solution": "The problem is scientifically grounded, well-posed, and objective. It specifies a standard numerical experiment in computational electromagnetics, involving the simulation of a nonlinear, anisotropic medium using the Finite-Difference Time-Domain (FDTD) method. All parameters, equations, and conditions are clearly defined. I will proceed with a full solution.\n\nThe solution is presented in three parts: first, the derivation of the FDTD update equations from Maxwell's equations; second, a stability analysis of the resulting scheme; and third, an explanation of the numerical implementation.\n\n### 1. Derivation of the FDTD Scheme\n\nWe begin with Maxwell's curl equations in a source-free medium:\n$$\n\\nabla \\times \\mathbf{E} = -\\frac{\\partial \\mathbf{B}}{\\partial t}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\frac{\\partial \\mathbf{D}}{\\partial t}\n$$\nThe problem specifies a one-dimensional transverse electric (TE) configuration, where fields vary only in the $x$ direction. The nonzero field components are $E_y(x,t)$ and $H_z(x,t)$, so $\\mathbf{E} = E_y \\hat{\\mathbf{y}}$ and $\\mathbf{H} = H_z \\hat{\\mathbf{z}}$. The constitutive relations are given as $B_z = \\mu_0 H_z$ and $D_y = (\\epsilon_y + \\alpha E_y^2) E_y$.\n\nUnder these conditions, the curl operators simplify.\nFor the first equation (Faraday's Law):\n$$\n\\nabla \\times \\mathbf{E} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\\n\\partial_x & \\partial_y & \\partial_z \\\\\n0 & E_y & 0\n\\end{vmatrix}\n= -\\frac{\\partial E_y}{\\partial x} \\hat{\\mathbf{z}}\n$$\nEquating the $\\hat{\\mathbf{z}}$ components and substituting $B_z = \\mu_0 H_z$, we get:\n$$\n-\\frac{\\partial E_y}{\\partial x} = -\\mu_0 \\frac{\\partial H_z}{\\partial t} \\implies \\mu_0 \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_y}{\\partial x}\n$$\nFor the second equation (Ampere's Law):\n$$\n\\nabla \\times \\mathbf{H} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\\n\\partial_x & \\partial_y & \\partial_z \\\\\n0 & 0 & H_z\n\\end{vmatrix}\n= -\\frac{\\partial H_z}{\\partial x} \\hat{\\mathbf{y}}\n$$\nEquating the $\\hat{\\mathbf{y}}$ components, we get:\n$$\n\\frac{\\partial D_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x}\n$$\nWe now discretize these two coupled partial differential equations on a uniform grid. Following the Yee-like leapfrog scheme, we evaluate $E_y$ and $D_y$ at integer spatial-grid points $i$ and integer time-steps $n$, denoted $E_{y,i}^n$ and $D_{y,i}^n$. The magnetic field $H_z$ is evaluated at half-integer spatial points $i+1/2$ and half-integer time-steps $n+1/2$, denoted $H_{z,i+1/2}^{n+1/2}$. The grid spacing is $\\Delta x=L/N_x$ and the time step is $\\Delta t$.\n\nUsing central difference approximations:\nThe $H_z$ update equation is derived by evaluating Faraday's Law at $(i+1/2, n)$:\n$$\n\\mu_0 \\frac{H_{z,i+1/2}^{n+1/2} - H_{z,i+1/2}^{n-1/2}}{\\Delta t} = \\frac{E_{y,i+1}^n - E_{y,i}^n}{\\Delta x}\n$$\nThis yields the update rule for $H_z$:\n$$\nH_{z,i+1/2}^{n+1/2} = H_{z,i+1/2}^{n-1/2} + \\frac{\\Delta t}{\\mu_0 \\Delta x} (E_{y,i+1}^n - E_{y,i}^n)\n$$\nThe $D_y$ update equation is derived by evaluating Ampere's Law at $(i, n+1/2)$:\n$$\n\\frac{D_{y,i}^{n+1} - D_{y,i}^n}{\\Delta t} = - \\frac{H_{z,i+1/2}^{n+1/2} - H_{z,i-1/2}^{n+1/2}}{\\Delta x}\n$$\nThis yields the update rule for $D_y$:\n$$\nD_{y,i}^{n+1} = D_{y,i}^n - \\frac{\\Delta t}{\\Delta x} (H_{z,i+1/2}^{n+1/2} - H_{z,i-1/2}^{n+1/2})\n$$\nAfter obtaining $D_{y,i}^{n+1}$, we must find the corresponding $E_{y,i}^{n+1}$ by solving the nonlinear scalar cubic equation:\n$$\nf(E) = \\alpha E^3 + \\epsilon_y E - D_{y,i}^{n+1} = 0\n$$\nThis is done using Newton's method, which iteratively refines a guess $E_k$ for the root:\n$$\nE_{k+1} = E_k - \\frac{f(E_k)}{f'(E_k)} = E_k - \\frac{\\alpha E_k^3 + \\epsilon_y E_k - D_{y,i}^{n+1}}{3\\alpha E_k^2 + \\epsilon_y}\n$$\nAs required, the scheme uses a predictor-corrector approach. The predictor is the first iteration, starting with $E_k = E_{y,i}^n$. The corrector consists of subsequent iterations until the change $|E_{k+1} - E_k|$ falls below a specified tolerance.\n\n### 2. Stability Analysis\n\nTo derive the Courant–Friedrichs–Lewy (CFL) condition, we linearize the system's response around a constant operating field amplitude $E_0$. The constitutive relation is $D_y = \\epsilon_y E_y + \\alpha E_y^3$. The small-signal (differential) permittivity is:\n$$\n\\epsilon_{\\mathrm{eff}} = \\frac{dD_y}{dE_y} \\bigg|_{E_0} = \\epsilon_y + 3\\alpha E_0^2\n$$\nThis $\\epsilon_{\\mathrm{eff}}$ governs the propagation speed of small perturbations, $v_{\\mathrm{eff}} = 1/\\sqrt{\\mu_0 \\epsilon_{\\mathrm{eff}}}$.\nFor the FDTD scheme to be stable, the numerical propagation speed, $\\Delta x / \\Delta t$, must be at least as great as the physical propagation speed of any wave in the system. The stability is dictated by the highest possible wave speed, which corresponds to the minimum positive value of $\\epsilon_{\\mathrm{eff}}$.\n$$\n\\frac{\\Delta x}{\\Delta t} \\ge \\max(v_{\\mathrm{eff}}) = \\frac{1}{\\sqrt{\\mu_0 \\min(\\epsilon_{\\mathrm{eff}})}}\n$$\nThis implies the CFL condition on the time step:\n$$\n\\Delta t \\le \\Delta x \\sqrt{\\mu_0 \\min(\\epsilon_{\\mathrm{eff}})}\n$$\nThe value of $\\min(\\epsilon_{\\mathrm{eff}})$ depends on the sign of the nonlinearity coefficient $\\alpha$:\n- If $\\alpha > 0$, $\\epsilon_{\\mathrm{eff}}(E_y) = \\epsilon_y + 3\\alpha E_y^2$ is always greater than or equal to $\\epsilon_y$. The minimum is $\\epsilon_{\\mathrm{eff}}(0) = \\epsilon_y$. The CFL condition becomes $\\Delta t \\le \\Delta x \\sqrt{\\mu_0 \\epsilon_y}$. The time step is given as $\\Delta t = s \\Delta x \\sqrt{\\mu_0 \\epsilon_y}$, so stability requires $s \\le 1$.\n- If $\\alpha < 0$, $\\epsilon_{\\mathrm{eff}}(E_y)$ decreases as $|E_y|$ increases. The minimum value of $\\epsilon_{\\mathrm{eff}}$ will occur at the peak field amplitude, $E_{\\max}$. The stability condition is $\\Delta t \\le \\Delta x \\sqrt{\\mu_0 (\\epsilon_y + 3\\alpha E_{\\max}^2)}$. This can be rewritten in terms of the scaling factor $s$:\n$$\ns \\le \\sqrt{1 + \\frac{3\\alpha E_{\\max}^2}{\\epsilon_y}}\n$$\nA crucial consequence is that if the field amplitude $E_y$ is large enough such that $\\epsilon_y + 3\\alpha E_y^2 \\le 0$, the effective permittivity becomes non-positive. This corresponds to the physical phenomenon of modulational instability, where the medium itself becomes unstable. In this regime, the linearized CFL condition cannot be satisfied for any real $\\Delta t$, and we expect the simulation to become unstable, regardless of the time step.\n\nThe discrete energy $\\mathcal{E}^n = \\sum_i \\frac{1}{2} (E_{y,i}^n D_{y,i}^n + \\mu_0 H_{z,i}^{n+1/2} H_{z,i}^{n+1/2}) \\Delta x$ is not strictly conserved in a nonlinear scheme. However, boundedness of this energy is a practical indicator of numerical stability. The CFL condition derived above ensures that errors do not grow exponentially, which in turn keeps the discrete energy bounded. Violation of this condition leads to numerical instability, where field values grow without bound, causing the energy to diverge.\n\n### 3. Implementation Details\n\nThe FDTD scheme is implemented in a Python program using the `numpy` library for efficient array operations. The main simulation loop iterates through the test cases. For each case:\n1.  Simulation parameters ($\\Delta x, \\epsilon_y, \\Delta t$, etc.) are calculated from the given inputs.\n2.  Arrays for $E_y$, $H_z$, and $D_y$ are initialized. The initial condition for $H_z$ is $H_z(x, -\\Delta t/2)=0$.\n3.  The initial energy $\\mathcal{E}^0$ is calculated according to the problem's formula, which requires a pre-step calculation of $H_z(x, \\Delta t/2)$ from $E_y(x,0)$. This value is stored as `E_initial`, and a running maximum `E_max` is initialized.\n4.  The main FDTD loop executes for $N_{\\mathrm{steps}}$. In each iteration $n$:\n    -   $H_z$ is updated from time $n-1/2$ to $n+1/2$ using $E_y$ at time $n$. Periodic boundary conditions are handled using `numpy.roll`.\n    -   The discrete energy $\\mathcal{E}^n$ is computed and `E_max` is updated. A stability check is performed against the $1.5 \\times \\mathcal{E}^0$ criterion.\n    -   $D_y$ is updated from time $n$ to $n+1$ using $H_z$ at time $n+1/2$.\n    -   $E_y$ is updated from time $n$ to $n+1$ by numerically solving the nonlinear cubic equation for each grid point using the vectorized Newton's method. The value $E_y^n$ serves as the initial guess.\n    -   A check for `NaN` or `inf` values is performed after each update to detect catastrophic divergence.\n5.  If the loop completes without the energy exceeding the threshold or a numerical overflow, the run is deemed stable (`True`); otherwise, it is unstable (`False`).\n6.  The stability results for all test cases are collected and printed in the specified list format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the FDTD simulations for a suite of test cases.\n    \"\"\"\n    # Physical Constants\n    EPSILON_0 = 8.854187817e-12  # F/m\n    MU_0 = 4 * np.pi * 1e-7      # H/m\n    \n    # Test cases from the problem statement\n    test_cases = [\n        # (Nx, L, eps_r_y, alpha, A, s, N_steps)\n        (400, 1.0, 2.25, 1.0e-24, 1.0e6, 0.90, 800), # Case 1\n        (400, 1.0, 2.25, 1.0e-24, 1.0e6, 1.10, 600), # Case 2\n        (400, 1.0, 2.25, -5.0e-25, 4.0e6, 0.50, 800), # Case 3\n        (400, 1.0, 2.25, -5.0e-25, 4.0e6, 0.95, 800), # Case 4\n    ]\n\n    results = []\n    for params in test_cases:\n        is_stable = run_simulation(params, EPSILON_0, MU_0)\n        results.append(is_stable)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_newton(Dy, Ey_guess, epsilon_y, alpha, tol=1e-9, max_iter=10):\n    \"\"\"\n    Solves for Ey from Dy using Newton's method.\n    The equation to solve is f(Ey) = alpha * Ey^3 + epsilon_y * Ey - Dy = 0.\n    This is performed element-wise for all grid points.\n    \n    Args:\n        Dy (np.ndarray): Array of electric displacement values D_y^{n+1}.\n        Ey_guess (np.ndarray): Initial guess for E_y^{n+1}, typically E_y^n.\n        epsilon_y (float): Linear permittivity.\n        alpha (float): Kerr nonlinearity coefficient.\n        tol (float): Convergence tolerance.\n        max_iter (int): Maximum number of iterations.\n\n    Returns:\n        np.ndarray: The solved electric field E_y^{n+1}.\n    \"\"\"\n    Ey = Ey_guess.copy()\n    for _ in range(max_iter):\n        f = alpha * Ey**3 + epsilon_y * Ey - Dy\n        f_prime = 3 * alpha * Ey**2 + epsilon_y\n        \n        # Add a small stabilization term to prevent division by zero,\n        # although this is extremely unlikely to be exactly zero.\n        # If f_prime is negative, it's a sign of potential physical instability,\n        # but Newton's method can still converge.\n        update = f / (f_prime + 1e-99)\n        Ey -= update\n        \n        if np.max(np.abs(update)) < tol:\n            break\n            \n    return Ey\n\ndef run_simulation(params, epsilon_0, mu_0):\n    \"\"\"\n    Runs a single FDTD simulation case and determines its stability.\n    \n    Args:\n        params (tuple): A tuple containing simulation parameters\n                        (Nx, L, eps_r_y, alpha, A, s, N_steps).\n        epsilon_0 (float): Vacuum permittivity.\n        mu_0 (float): Vacuum permeability.\n\n    Returns:\n        bool: True if the simulation is stable, False otherwise.\n    \"\"\"\n    Nx, L, eps_r_y, alpha, A, s, N_steps = params\n    \n    # Derived parameters\n    dx = L / Nx\n    epsilon_y = eps_r_y * epsilon_0\n    v_base = 1.0 / np.sqrt(mu_0 * epsilon_y)\n    dt = s * dx / v_base\n\n    # Spatial grid\n    # x = np.linspace(0, L, Nx, endpoint=False)\n    # The explicit x-grid is not strictly needed for the updates, but for ICs\n    x_coords = dx * np.arange(Nx)\n\n    # Initial conditions\n    Ey = A * np.exp(-((x_coords - L / 2)**2) / (L / 10)**2)  # Ey at t=0\n    Hz = np.zeros(Nx)                                     # Hz at t=-dt/2\n    Dy = epsilon_y * Ey + alpha * Ey**3                   # Dy at t=0\n\n    # For the energy calculation at n=0, we need H at t=dt/2.\n    # Perform the first half-step update for H.\n    Hz_half = Hz + (dt / (mu_0 * dx)) * (np.roll(Ey, -1) - Ey)\n    \n    # Initial energy calculation as per problem statement: E^n uses E^n, D^n, H^{n+1/2}\n    # For n=0, we use E_0, D_0, H_{1/2}\n    E_initial = 0.5 * np.sum(Ey * Dy + mu_0 * Hz_half**2) * dx\n    if E_initial == 0: E_initial = 1e-30 # Avoid division by zero if initial energy is zero\n    E_max = E_initial\n    \n    # Set the state for the main FDTD loop. The H-field is a half-step behind.\n    H = Hz \n    \n    for _ in range(N_steps):\n        # State at loop start: Ey is E^n, Dy is D^n, H is H^{n-1/2}\n        \n        # --- Update H-field to H^{n+1/2} ---\n        H = H + (dt / (mu_0 * dx)) * (np.roll(Ey, -1) - Ey)\n\n        # Check for immediate numerical instability\n        if not np.all(np.isfinite(H)):\n            return False\n\n        # --- Energy check and stability criterion ---\n        # Calculate energy at step n, using E^n, D^n, and the newly computed H^{n+1/2}\n        current_energy = 0.5 * np.sum(Ey * Dy + mu_0 * H**2) * dx\n        E_max = max(E_max, current_energy)\n\n        if E_max > 1.5 * E_initial:\n            return False\n        \n        # --- Update D-field to D^{n+1} ---\n        Dy = Dy - (dt / dx) * (H - np.roll(H, 1))\n\n        # --- Update E-field to E^{n+1} ---\n        Ey = solve_newton(Dy, Ey, epsilon_y, alpha)\n\n        # Check for numerical instability from the nonlinear solve\n        if not np.all(np.isfinite(Ey)):\n            return False\n            \n    return True\n\nsolve()\n\n```"
        },
        {
            "introduction": "Implementing a general anisotropic material on a standard Yee grid introduces a significant challenge: the electric field and flux density components are not collocated, yet the material tensor couples them all. This problem asks you to critically evaluate several common implementation strategies and identify the one that correctly preserves fundamental physical and numerical properties like reciprocity and energy conservation. Mastering this concept is essential for developing stable and accurate FDTD solvers for arbitrarily oriented anisotropic media .",
            "id": "3331985",
            "problem": "A lossless, spatially varying, rotated anisotropic dielectric is modeled in a three-dimensional Finite-Difference Time-Domain (FDTD) scheme on a standard Yee grid with uniform spacings $\\,\\Delta x\\,$, $\\,\\Delta y\\,$, and $\\,\\Delta z\\,$. In each grid cell, the constitutive relation is $\\,\\mathbf{D}(\\mathbf{r},t)=\\boldsymbol{\\varepsilon}(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r},t)\\,$, where $\\,\\boldsymbol{\\varepsilon}(\\mathbf{r})\\,$ is symmetric and positive definite. The material principal axes are rotated relative to the grid, with a cell-centered orthogonal rotation matrix $\\,\\mathbf{R}(\\mathbf{r})\\,$ and principal permittivities $\\,\\varepsilon_1(\\mathbf{r}),\\varepsilon_2(\\mathbf{r}),\\varepsilon_3(\\mathbf{r})\\,$, so that $\\,\\boldsymbol{\\varepsilon}(\\mathbf{r})=\\mathbf{R}(\\mathbf{r})\\,\\mathrm{diag}(\\varepsilon_1,\\varepsilon_2,\\varepsilon_3)\\,\\mathbf{R}(\\mathbf{r})^{\\mathsf{T}}\\,$ at each cell center. The electric flux density $\\,\\mathbf{D}\\,$ and electric field $\\,\\mathbf{E}\\,$ are stored on the Yee grid edges, staggered in space from the magnetic field $\\,\\mathbf{H}\\,$.\n\nStarting from Maxwell’s curl equations and the constitutive relation, together with the electromagnetic energy density $\\,u(\\mathbf{r},t)=\\tfrac{1}{2}\\big(\\mathbf{E}\\cdot\\mathbf{D}+\\mathbf{H}\\cdot\\mathbf{B}\\big)\\,$ and assuming no impressed sources and no conductivity, derive the structural requirements on the discrete constitutive update that map edge-staggered $\\,\\mathbf{D}\\,$ to edge-staggered $\\,\\mathbf{E}\\,$ so that:\n- the discrete electric constitutive operator is symmetric positive definite (SPD), ensuring a nonincreasing discrete total energy in the absence of sources;\n- discrete reciprocity is preserved under grid rotations;\n- the rotational anisotropy is correctly captured without spurious decoupling of field components.\n\nYou are to choose which of the following implementation strategies meets these requirements for general rotated anisotropy on a Yee grid.\n\nA. Precompute cell-centered $\\,\\boldsymbol{\\varepsilon}\\,$ and interpolate its components to each edge location. At each edge, compute $\\,\\mathbf{D}=\\boldsymbol{\\varepsilon}\\,\\mathbf{E}\\,$ by multiplying the interpolated tensor with the local edge field, but evaluate only the matching component to avoid noncollocation, that is, compute $\\,D_x=\\varepsilon_{xx}E_x\\,$ at $\\,x$-edges, $\\,D_y=\\varepsilon_{yy}E_y\\,$ at $\\,y$-edges, and $\\,D_z=\\varepsilon_{zz}E_z\\,$ at $\\,z$-edges.\n\nB. Precompute, at every cell center, the inverse permittivity tensor $\\,\\boldsymbol{\\alpha}=\\boldsymbol{\\varepsilon}^{-1}=\\mathbf{R}\\,\\mathrm{diag}(\\varepsilon_1^{-1},\\varepsilon_2^{-1},\\varepsilon_3^{-1})\\,\\mathbf{R}^{\\mathsf{T}}\\,$. Define a linear gather operator $\\,\\mathbf{S}\\,$ that forms a cell-centered $\\,\\mathbf{D}\\,$ vector by averaging the four edge samples of each component around the cell (for each component, a uniform weight of $\\,\\tfrac{1}{4}\\,$ per edge). Apply the constitutive mapping at the cell center to obtain $\\,\\mathbf{E}\\,$ at the cell center, then scatter back to edges using the adjoint $\\,\\mathbf{S}^{\\mathsf{T}}\\,$ of the gather (distributing each cell-centered component equally to its four corresponding edges). Use these precomputed $\\,\\boldsymbol{\\alpha}\\,$ and the adjoint pair $\\,\\mathbf{S},\\mathbf{S}^{\\mathsf{T}}\\,$ to build the edge-to-edge constitutive update at every step.\n\nC. Precompute cell-centered $\\,\\boldsymbol{\\varepsilon}\\,$ and its rotations. At each edge, rotate the local edge field component by applying $\\,\\mathbf{R}^{\\mathsf{T}}\\,$ to the single stored component to obtain a pseudo-principal component, scale it by the corresponding principal permittivity, and rotate back by $\\,\\mathbf{R}\\,$, all performed independently for $\\,x$-, $\\,y$-, and $\\,z$-edges, without forming a collocated vector.\n\nD. Precompute cell-centered $\\,\\boldsymbol{\\alpha}=\\boldsymbol{\\varepsilon}^{-1}\\,$. For each edge, interpolate only the corresponding row of $\\,\\boldsymbol{\\alpha}\\,$ to that edge by arithmetic averaging of neighboring cells. At the edge, assemble a local $\\,\\mathbf{D}\\,$ vector by interpolating the two noncollocated components from their native edges by simple arithmetic averages of the four nearest edges per component. Then compute the edge field component by the row-vector contraction, for example, $\\,E_x=\\boldsymbol{\\alpha}_{x:}\\cdot\\mathbf{D}\\,$ at $\\,x$-edges. Enforce symmetry by replacing the interpolated edge tensor with its symmetrized form $\\,\\tfrac{1}{2}\\big(\\tilde{\\boldsymbol{\\alpha}}+\\tilde{\\boldsymbol{\\alpha}}^{\\mathsf{T}}\\big)\\,$ at each edge.\n\nE. Precompute face-centered $\\,\\boldsymbol{\\alpha}\\,$ on each of the $\\,6\\,$ faces of every cell. For each face, collocate the two tangential components of $\\,\\mathbf{D}\\,$ onto the face center by averaging, apply a $\\,2\\times 2\\,$ tangential block of $\\,\\boldsymbol{\\alpha}\\,$ to obtain the face-centered tangential $\\,\\mathbf{E}\\,$, and then distribute the two tangential components back to the four surrounding edges. Ignore coupling to the normal component to avoid noncollocation.\n\nSelect the option that satisfies all stated requirements for general rotated anisotropic media on the Yee grid. Justify your choice by reasoning from Maxwell’s equations, the discrete energy identity, and the necessity of preserving symmetry and positive definiteness in the discrete constitutive mapping.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in computational electromagnetics, well-posed, and uses precise, objective language. The setup describes a standard, non-trivial problem in the field: the stable and accurate modeling of general anisotropic materials within the Finite-Difference Time-Domain (FDTD) framework. All necessary information is provided.\n\nThe core of the problem lies in discretizing the constitutive relation $\\mathbf{D} = \\boldsymbol{\\varepsilon} \\mathbf{E}$ on a Yee grid. In continuous space, this is a point-wise relation. On the Yee grid, the Cartesian components of $\\mathbf{E}$ and $\\mathbf{D}$ are located on the centers of the grid edges and are therefore not collocated. For instance, at the location of an $x$-directed edge where $E_x$ and $D_x$ are defined, the $E_y$ and $E_z$ components are not available. A general anisotropic permittivity tensor $\\boldsymbol{\\varepsilon}$ couples all components, e.g., $D_x = \\varepsilon_{xx} E_x + \\varepsilon_{xy} E_y + \\varepsilon_{xz} E_z$. A naive update is thus impossible. Any valid numerical scheme must employ a consistent interpolation or averaging procedure to handle this non-collocation.\n\nThe problem requires the discrete update from $\\mathbf{D}$ to $\\mathbf{E}$, which corresponds to the inverse constitutive relation $\\mathbf{E} = \\boldsymbol{\\varepsilon}^{-1} \\mathbf{D} = \\boldsymbol{\\alpha} \\mathbf{D}$. Let the global vectors containing all discrete edge components of $\\mathbf{E}$ and $\\mathbf{D}$ be denoted by $\\mathbb{E}$ and $\\mathbb{D}$, respectively. The FDTD update requires a discrete operator $\\mathbf{A}$ such that $\\mathbb{E} = \\mathbf{A} \\mathbb{D}$. The requirements placed upon this operator are:\n\n1.  **Symmetric Positive Definite (SPD):** The discrete energy in the electric field is given by a quadratic form, $\\mathcal{E}_e = \\tfrac{1}{2} \\mathbb{D}^{\\mathsf{T}} \\mathbb{E} = \\tfrac{1}{2} \\mathbb{D}^{\\mathsf{T}} \\mathbf{A} \\mathbb{D}$. For the total discrete energy of the system to be non-increasing in a source-free, lossless medium (a condition for numerical stability), the operator $\\mathbf{A}$ must be symmetric and positive definite (SPD). Symmetry of the operator also ensures that the discrete system upholds the principle of reciprocity, inherited from the symmetric continuous tensor $\\boldsymbol{\\varepsilon}$.\n2.  **Preservation of Reciprocity under Grid Rotations:** This implies the scheme's structure should not be fundamentally tied to the grid axes in a way that breaks the physical principle of reciprocity, a property guaranteed by a symmetric discrete operator.\n3.  **Correctly Capturing Rotational Anisotropy:** The scheme must account for all components of the tensor $\\boldsymbol{\\alpha}$ (or $\\boldsymbol{\\varepsilon}$), including the off-diagonal terms that are non-zero for a generally rotated anisotropic material. Schemes that ignore these terms will produce physically incorrect results.\n\nWith these principles established, we evaluate each option.\n\n**Option A Evaluation**\nThis option proposes computing $D_x = \\varepsilon_{xx} E_x$ at $x$-edges, $D_y = \\varepsilon_{yy} E_y$ at $y$-edges, and $D_z = \\varepsilon_{zz} E_z$ at $z$-edges. This constitutes a purely diagonal update scheme. It completely ignores the off-diagonal elements of the permittivity tensor, such as $\\varepsilon_{xy}$, which are responsible for the coupling between different field components in a rotated anisotropic medium. This scheme only works correctly if the principal axes of the material are aligned with the grid axes, a special case not covered by \"general rotated anisotropy\". By ignoring the coupling terms, it leads to \"spurious decoupling of field components.\"\n**Verdict: Incorrect.** This method fails requirement #3.\n\n**Option B Evaluation**\nThis option describes a gather-scatter procedure, also known as a volume-averaging or material-averaging scheme. The steps are:\n1.  **Gather:** A linear operator $\\mathbf{S}$ averages the edge-staggered $\\mathbf{D}$ components to produce a collocated, cell-centered $\\mathbf{D}_{cc}$ vector. In matrix form, $\\mathbb{D}_{cc} = \\mathbf{S} \\mathbb{D}$.\n2.  **Apply Constitutive Law:** At the cell center, all components are collocated. The inverse permittivity tensor $\\boldsymbol{\\alpha}(\\mathbf{r})$ is applied directly: $\\mathbf{E}_{cc}(\\mathbf{r}) = \\boldsymbol{\\alpha}(\\mathbf{r}) \\mathbf{D}_{cc}(\\mathbf{r})$. Let $\\mathbf{A}_{cc}$ be the block-diagonal matrix containing all the local $3 \\times 3$ tensors $\\boldsymbol{\\alpha}(\\mathbf{r})$ for each cell. Since $\\boldsymbol{\\varepsilon}$ is SPD, its inverse $\\boldsymbol{\\alpha}$ is also SPD, and thus $\\mathbf{A}_{cc}$ is an SPD matrix. The update is $\\mathbb{E}_{cc} = \\mathbf{A}_{cc} \\mathbb{D}_{cc}$.\n3.  **Scatter:** The resulting cell-centered field $\\mathbf{E}_{cc}$ is distributed back to the grid edges using the adjoint operator $\\mathbf{S}^{\\mathsf{T}}$. The final edge field vector is $\\mathbb{E} = \\mathbf{S}^{\\mathsf{T}} \\mathbb{E}_{cc}$.\n\nCombining these steps, the full edge-to-edge update operator $\\mathbf{A}$ is given by $\\mathbb{E} = (\\mathbf{S}^{\\mathsf{T}} \\mathbf{A}_{cc} \\mathbf{S}) \\mathbb{D}$, so $\\mathbf{A} = \\mathbf{S}^{\\mathsf{T}} \\mathbf{A}_{cc} \\mathbf{S}$.\nLet us check the requirements:\n1.  **SPD:** This construction mathematically guarantees that the global operator $\\mathbf{A}$ is symmetric and positive semidefinite, since $\\mathbf{A}^{\\mathsf{T}} = (\\mathbf{S}^{\\mathsf{T}} \\mathbf{A}_{cc} \\mathbf{S})^{\\mathsf{T}} = \\mathbf{S}^{\\mathsf{T}} \\mathbf{A}_{cc}^{\\mathsf{T}} (\\mathbf{S}^{\\mathsf{T}})^{\\mathsf{T}} = \\mathbf{S}^{\\mathsf{T}} \\mathbf{A}_{cc} \\mathbf{S} = \\mathbf{A}$ (because $\\mathbf{A}_{cc}$ is symmetric). It is positive definite if $\\mathbf{S}$ has a trivial null space, which is true for the proposed averaging. This structure ensures a stable, energy-conserving scheme.\n2.  **Reciprocity:** The symmetry of $\\mathbf{A}$ guarantees discrete reciprocity.\n3.  **Anisotropy:** The full tensor $\\boldsymbol{\\alpha}$ is used at the cell center, correctly accounting for all coupling between field components.\nThis method correctly and robustly models the physics.\n**Verdict: Correct.**\n\n**Option C Evaluation**\nThis option describes a procedure to be performed independently on each edge. For an $x$-edge, it suggests applying a rotation $\\mathbf{R}^{\\mathsf{T}}$ to \"the single stored component\". Applying a $3 \\times 3$ matrix to a scalar is not well-defined. A plausible interpretation is to form a vector $(E_x, 0, 0)$, rotate it, scale the components by the principal permittivities, and rotate back. This would yield $\\mathbf{D} = \\mathbf{R} \\, \\mathrm{diag}(\\varepsilon_1, \\varepsilon_2, \\varepsilon_3) \\, \\mathbf{R}^{\\mathsf{T}} (E_x, 0, 0)^{\\mathsf{T}} = \\boldsymbol{\\varepsilon} (E_x, 0, 0)^{\\mathsf{T}}$. The $x$-component would then be $D_x = \\varepsilon_{xx} E_x$. This reduces to the flawed diagonal scheme of Option A. Any scheme that computes updates \"independently\" for each edge orientation cannot properly couple the field components as required by the off-diagonal tensor elements.\n**Verdict: Incorrect.** This method is either ill-defined or, under a reasonable interpretation, equivalent to Option A, failing requirement #3.\n\n**Option D Evaluation**\nThis option describes a common but problematic approach based on direct interpolation of both tensor and field components at the edge locations. To find $E_x$, one first interpolates the necessary tensor-row components $(\\alpha_{xx}, \\alpha_{xy}, \\alpha_{xz})$ to the $E_x$ location, and also interpolates the non-collocated field components $D_y$ and $D_z$ to that same location. While this does incorporate the off-diagonal tensor terms, the construction of the global operator $\\mathbf{A}$ is ad-hoc. The averaging stencils used to bring $D_y$ to an $x$-edge location and $D_x$ to a $y$-edge location are generally not adjoints of each other. This leads to a global operator $\\mathbf{A}$ that is not symmetric. The proposal to enforce symmetry locally via $\\tfrac{1}{2}(\\tilde{\\boldsymbol{\\alpha}}+\\tilde{\\boldsymbol{\\alpha}}^{\\mathsf{T}})$ does not fix the asymmetry of the global operator $\\mathbf{A}$ that arises from the interpolation stencils. A non-symmetric operator does not guarantee energy conservation and can lead to late-time instabilities.\n**Verdict: Incorrect.** This method fails requirement #1, as it does not produce a provably SPD operator.\n\n**Option E Evaluation**\nThis method proposes a $2 \\times 2$ update on each cell face, considering only tangential field components. For example, on a face normal to the $z$-axis, it would update tangential fields $(E_x, E_y)$ using tangential fluxes $(D_x, D_y)$ and the upper-left $2 \\times 2$ block of $\\boldsymbol{\\alpha}$. Crucially, it states to \"Ignore coupling to the normal component\". This means that for a general rotated material, terms like $\\alpha_{xz}$ and $\\alpha_{yz}$ in the update for $E_x$ and $E_y$ are neglected. This is a physical simplification that is only valid if the tensor is block-diagonal with respect to the grid planes, which is not the general case for rotated anisotropy.\n**Verdict: Incorrect.** This method fails requirement #3 by incorrectly decoupling tangential and normal components.\n\nIn summary, only the gather-scatter approach described in Option B systematically constructs a discrete constitutive operator that is guaranteed to be symmetric positive definite while correctly incorporating the full physics of the anisotropic material.",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}