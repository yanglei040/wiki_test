{
    "hands_on_practices": [
        {
            "introduction": "卡尔德龙预处理的核心优势在于它能够将病态的积分方程转化为良态的第二类方程。这种转化将算子的谱聚集在特定的常数附近，这是连续算子卡尔德龙恒等式的直接结果。本练习将抽象的算子理论与具体的数值结果联系起来，让你首先从第一性原理推导出理论上的特征值簇中心()，然后在一个简化的离散模型中观察到这一关键的谱聚集现象。",
            "id": "3291128",
            "problem": "考虑自由空间中的时谐麦克斯韦方程组，其角频率为 $\\omega$，波数为 $k = \\omega \\sqrt{\\mu_0 \\epsilon_0}$，其中 $\\mu_0$ 和 $\\epsilon_0$ 分别是自由空间的磁导率和介电常数。对于一个半径为 $a$（单位：米）的理想导电球体，边界积分方程方法在球面 $\\Gamma$ 上引入了迹算子和边界积分算子。在光滑闭合曲面上使用标准切向场公式，可以构造出满足卡尔德龙算子理论的边界积分算子。特别地，边界位跨越 $\\Gamma$ 的跳跃关系导出了卡尔德龙投影算子，而卡尔德龙预处理产生了一个第二类算子，其谱是单位算子常数倍的一个紧扰动。因此，卡尔德龙预处理算子的特征值会聚集在特定的常数处，这些常数可以从基本跳跃关系和投影算子恒等式推导得出。\n\nA 部分（球体上的连续模型）：从时谐麦克斯韦方程组和光滑 $\\Gamma$ 上的边界迹跳跃关系出发，使用卡尔德龙算子理论来确定连续卡尔德龙预处理算子特征值聚集的常数。您必须从第一性原理出发推导这些常数（无捷径，不直接使用目标公式）。您的推导应依赖于积分表示所蕴含的切向和法向分量的跳跃关系，以及由边界积分算子构造的卡尔德龙投影算子的幂等性。将这些常数作为预期的聚集中心报告。这些常数不带任何单位，它们是无量纲的。\n\nB 部分（与 Rao-Wilton-Glisson-Buffa-Christiansen 配对的离散比较）：在计算电磁学中，Rao-Wilton-Glisson (RWG) 基和 Buffa-Christiansen (BC) 基为三角化曲面上的混合边界积分离散化构成了一个稳定的原始-对偶配对。在单位球面上（取 $a = 1$ 米），使用 RWG-BC 配对形成的离散卡尔德龙预处理算子在连续聚集中心附近表现出特征值聚集，其偏差随着分辨率和模式指数的增加而减小。对于一个捕捉球面上这种行为的模型离散算子，假设其特征值分为两个族（代表横电和横磁切向模式），每个族都由 A 部分中推导出的连续聚集中心周围的一个扰动给出。对于模式指数 $\\ell \\in \\{1,2,\\dots,L_{\\max}\\}$、网格分辨率参数 $N$（一个与三角形数量成正比的正整数）和波数 $k$（单位：$\\mathrm{m}^{-1}$），通过以下公式定义一个合成离散特征值模型：\n$$\n\\lambda_{\\ell}^{(\\pm)}(k,N) = c_{\\pm} + \\delta_{\\ell}(k,N),\n$$\n其中 $c_{+}$ 和 $c_{-}$ 是在 A 部分中获得的连续聚集中心，而 $\\delta_{\\ell}(k,N)$ 是一个随 $\\ell$ 和 $N$ 衰减的微小光滑扰动。为此数值模型问题，取\n$$\n\\delta_{\\ell}(k,N) = \\alpha(k,a)\\,\\big(\\ell + \\beta N\\big)^{-1},\n$$\n其中 $a=1$ 米，$\\beta$ 是一个正的无量纲常数，而 $\\alpha(k,a)$ 是一个依赖于 $k a$ 的无量纲缩放因子，其值被一个小数限制，并反映了光滑的、非共振的频率依赖性。您必须使用第一类球贝塞尔函数计算 $\\alpha(k,a)$，其计算方式需与对 $k a$ 的平滑依赖性一致，并确保 $\\alpha(k,a)$ 很小。对于此问题，您必须实现\n$$\n\\alpha(k,a) = \\min\\left(0.1,\\ \\left|\\mathrm{j}_1(k a)\\right|\\right),\n$$\n其中 $\\mathrm{j}_1$ 是一阶第一类球贝塞尔函数，并取 $\\beta = \\sqrt{2}$。\n\n对于下面测试套件中指定的每个参数集 $(k,N,L_{\\max})$，生成离散特征值 $\\{\\lambda_{\\ell}^{(+)}(k,N)\\}_{\\ell=1}^{L_{\\max}}$ 和 $\\{\\lambda_{\\ell}^{(-)}(k,N)\\}_{\\ell=1}^{L_{\\max}}$，通过简单平均计算“$+$”和“$-$”族的经验聚集中心，\n$$\n\\bar{\\lambda}^{(+)}(k,N) = \\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\lambda_{\\ell}^{(+)}(k,N),\\qquad\n\\bar{\\lambda}^{(-)}(k,N) = \\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\lambda_{\\ell}^{(-)}(k,N),\n$$\n并将它们与 A 部分中获得的连续聚集中心 $c_{+}$ 和 $c_{-}$ 进行比较，计算绝对差\n$$\n\\Delta^{(+)}(k,N) = \\left|\\bar{\\lambda}^{(+)}(k,N) - c_{+}\\right|,\\qquad\n\\Delta^{(-)}(k,N) = \\left|\\bar{\\lambda}^{(-)}(k,N) - c_{-}\\right|.\n$$\n这些差值是无量纲的浮点数。\n\n测试套件：\n- 情况 1: $(k, N, L_{\\max}) = (0.01\\ \\mathrm{m}^{-1},\\ 24,\\ 8)$.\n- 情况 2: $(k, N, L_{\\max}) = (1.0\\ \\mathrm{m}^{-1},\\ 48,\\ 12)$.\n- 情况 3: $(k, N, L_{\\max}) = (5.0\\ \\mathrm{m}^{-1},\\ 96,\\ 20)$.\n- 情况 4 (边界情况，极低的模态截断): $(k, N, L_{\\max}) = (0.5\\ \\mathrm{m}^{-1},\\ 8,\\ 2)$.\n- 情况 5 (更精细的网格，中等频率): $(k, N, L_{\\max}) = (2.5\\ \\mathrm{m}^{-1},\\ 160,\\ 30)$.\n\n您的程序必须：\n- 推导并使用 A 部分的连续聚集中心 $c_{+}$ 和 $c_{-}$。\n- 使用指定的 $\\alpha(k,a)$ 和 $\\beta$，并设 $a=1$ 米，实现 B 部分的合成离散特征值模型。\n- 对于每个测试用例，计算并记录两个浮点数 $\\Delta^{(+)}(k,N)$ 和 $\\Delta^{(-)}(k,N)$。\n- 生成单行输出，其中包含五个测试用例的所有结果，按顺序聚合，格式为方括号内的逗号分隔列表（例如，$[\\text{case1\\_plus},\\text{case1\\_minus},\\dots,\\text{case5\\_plus},\\text{case5\\_minus}]$）。这些浮点数是无量纲的，应以标准十进制表示法打印。\n\n如果您的推导中出现任何角度，则必须以弧度为单位；然而，此问题要求的输出是无量纲的浮点数，因此不需要进行角度的单位转换。所有物理量都应使用上面指定的单位，最终输出必须是无量纲的。",
            "solution": "用户提供的问题是有效的，因为它在科学上基于已建立的麦克斯韦方程组边界积分方程理论，并且是适定的、客观的、自洽的。该问题需要一个分为两部分的解决方案：首先是对连续算子的特征值聚集中心进行理论推导，然后是基于这些中心对离散模型进行数值实现。\n\n### A 部分：连续聚集中心的推导\n\n卡尔德龙预处理算子特征值聚集的常数可以从时谐麦克斯韦方程组的边界积分算子的基本性质中推导出来。该推导关键在于卡尔德龙算子的投影性质。\n\n设 $\\Gamma$ 是一个光滑、闭合且有界的曲面，将 $\\mathbb{R}^3$ 分为一个内部域 $\\Omega_-$ 和一个外部域 $\\Omega_+$。在 $\\Omega_+$ 中，时谐麦克斯韦方程组的一个辐射解 $(\\mathbf{E}, \\mathbf{H})$ 可以通过 Stratton-Chu 公式用电场和磁场在 $\\Gamma$ 上的切向迹来表示。这些迹被称为柯西数据。我们定义一个矢量场 $\\mathbf{F}$ 的切向迹算子为 $\\gamma_t \\mathbf{F} = \\mathbf{n} \\times \\mathbf{F} \\times \\mathbf{n}$ 和 $\\gamma_D\\mathbf{F} = \\mathbf{n} \\times \\mathbf{F}$，其中 $\\mathbf{n}$ 是指向 $\\Gamma$ 外部的单位法向量。我们考虑 $\\Gamma$ 上的切向迹对 $(\\mathbf{n} \\times \\mathbf{E}, \\mathbf{n} \\times \\mathbf{H})$。\n\n场 $(\\mathbf{E}, \\mathbf{H})$ 是由分别位于 $\\Gamma$ 上的电和磁表面电流密度 $\\mathbf{J}$ 和 $\\mathbf{M}$ 产生的。跨越 $\\Gamma$ 的切向迹的跳跃关系是：\n$$\n\\mathbf{n} \\times \\mathbf{E}^+ - \\mathbf{n} \\times \\mathbf{E}^- = -\\mathbf{M}\n$$\n$$\n\\mathbf{n} \\times \\mathbf{H}^+ - \\mathbf{n} \\times \\mathbf{H}^- = \\mathbf{J}\n$$\n其中上标 $+$ 和 $-$ 分别表示从 $\\Omega_+$ 和 $\\Omega_-$ 取极限。\n\n边界积分算子将表面电流 $(\\mathbf{J}, \\mathbf{M})$ 映射到 $\\Gamma$ 上的平均切向迹。我们定义柯西数据对 $\\mathbf{v} = (\\mathbf{M}, \\mathbf{J})^T$。相关的迹算子，即卡尔德龙算子 $\\mathcal{C}$，将这对数据映射到 $\\Gamma$ 上迹 $(\\mathbf{n} \\times \\mathbf{E}, \\mathbf{n} \\times \\mathbf{H})$ 的主值（平均值）。用矩阵形式表示为：\n$$\n\\begin{pmatrix} \\mathbf{n} \\times \\mathbf{E}_{\\text{avg}} \\\\ \\mathbf{n} \\times \\mathbf{H}_{\\text{avg}} \\end{pmatrix} = \\mathcal{C} \\begin{pmatrix} \\mathbf{M} \\\\ \\mathbf{J} \\end{pmatrix} = \\begin{pmatrix} -K  S \\\\ T  K' \\end{pmatrix} \\begin{pmatrix} \\mathbf{M} \\\\ \\mathbf{J} \\end{pmatrix}\n$$\n这里，$S$ 是电-电单层算子，$K$ 是磁-电双层算子，$T$ 是磁-磁超奇异算子，$K'$ 是电-磁双层算子。\n\n使用平均迹和跳跃关系，外部（$+$）和内部（$-$）的迹可以写成：\n$$\n\\begin{pmatrix} \\mathbf{n} \\times \\mathbf{E}^+ \\\\ \\mathbf{n} \\times \\mathbf{H}^+ \\end{pmatrix} = (\\mathcal{C} + \\frac{1}{2}I) \\begin{pmatrix} \\mathbf{M} \\\\ \\mathbf{J} \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} \\mathbf{n} \\times \\mathbf{E}^- \\\\ \\mathbf{n} \\times \\mathbf{H}^- \\end{pmatrix} = (\\mathcal{C} - \\frac{1}{2}I) \\begin{pmatrix} \\mathbf{M} \\\\ \\mathbf{J} \\end{pmatrix}\n$$\n其中 $I$ 是单位算子。\n\n算子 $P^+ = \\mathcal{C} + \\frac{1}{2}I$ 和 $P^- = \\mathcal{C} - \\frac{1}{2}I$ 分别是到对应于 $\\Omega_+$ 中辐射场和 $\\Omega_-$ 中正则场的柯西数据空间的卡尔德龙投影算子。这些投影算子的一个基本性质是它们是幂等的，即 $(P^\\pm)^2 = P^\\pm$。让我们对 $P^+$ 使用这个性质：\n$$\n(P^+)^2 = P^+ \\implies (\\mathcal{C} + \\frac{1}{2}I)^2 = \\mathcal{C} + \\frac{1}{2}I\n$$\n$$\n\\mathcal{C}^2 + \\mathcal{C} + \\frac{1}{4}I^2 = \\mathcal{C} + \\frac{1}{2}I\n$$\n从两边减去 $\\mathcal{C}$ 并化简，得到著名的卡尔德龙恒等式：\n$$\n\\mathcal{C}^2 = \\frac{1}{4}I\n$$\n对于光滑曲面，此关系精确成立；而对于非光滑曲面，它成立的条件是相差一个紧算子，即 $\\mathcal{C}^2 = \\frac{1}{4}I + \\mathcal{K}$，其中 $\\mathcal{K}$ 是一个紧算子。\n\n算子 $\\mathcal{C}$ 的特征值与此恒等式直接相关。设 $\\lambda$ 是 $\\mathcal{C}$ 的一个特征值，其对应的特征向量为 $\\mathbf{v} \\neq \\mathbf{0}$，使得 $\\mathcal{C}\\mathbf{v} = \\lambda\\mathbf{v}$。再次应用 $\\mathcal{C}$ 得到：\n$$\n\\mathcal{C}^2\\mathbf{v} = \\mathcal{C}(\\lambda\\mathbf{v}) = \\lambda(\\mathcal{C}\\mathbf{v}) = \\lambda^2\\mathbf{v}\n$$\n代入卡尔德龙恒等式，我们得到：\n$$\n\\frac{1}{4}I\\mathbf{v} = \\lambda^2\\mathbf{v} \\implies \\frac{1}{4}\\mathbf{v} = \\lambda^2\\mathbf{v}\n$$\n因为 $\\mathbf{v}$ 是一个非零特征向量，我们必须有：\n$$\n\\lambda^2 = \\frac{1}{4} \\implies \\lambda = \\pm\\frac{1}{2}\n$$\n对于一般的平滑曲面，$\\mathcal{C}$ 的谱并非纯离散的，但其本质谱是 $\\{ -1/2, 1/2 \\}$。这意味着任何 $\\mathcal{C}$ 的协调离散化的特征值都将聚集在这两个值上。问题中提到的“卡尔德龙预处理算子”，在此上下文中指其谱性质由卡尔德龙算子 $\\mathcal{C}$ 控制的算子。这两族特征值，通常与横电（TE）和横磁（TM）模式相关联，会聚集在这两个推导出的常数周围。\n\n因此，特征值聚集的常数是：\n$$\nc_+ = \\frac{1}{2} \\quad \\text{and} \\quad c_- = -\\frac{1}{2}\n$$\n这些是问题所要求的无量纲常数。\n\n### B 部分：离散特征值模型与比较\n\n对于 B 部分，我们使用推导出的连续聚集中心 $c_+ = 0.5$ 和 $c_- = -0.5$ 来实现合成离散特征值模型。离散特征值的模型由下式给出：\n$$\n\\lambda_{\\ell}^{(\\pm)}(k,N) = c_{\\pm} + \\delta_{\\ell}(k,N)\n$$\n其中扰动 $\\delta_{\\ell}(k,N)$ 对于 '+' 和 '$-$' 两族特征值是相同的。经验聚集中心通过平均计算得出：\n$$\n\\bar{\\lambda}^{(\\pm)}(k,N) = \\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\lambda_{\\ell}^{(\\pm)}(k,N) = c_{\\pm} + \\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\delta_{\\ell}(k,N)\n$$\n经验中心和连续中心之间的绝对差 $\\Delta^{(\\pm)}$ 为：\n$$\n\\Delta^{(\\pm)}(k,N) = \\left|\\bar{\\lambda}^{(\\pm)}(k,N) - c_{\\pm}\\right| = \\left|\\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\delta_{\\ell}(k,N)\\right|\n$$\n扰动定义为 $\\delta_{\\ell}(k,N) = \\alpha(k,a)\\big(\\ell + \\beta N\\big)^{-1}$。缩放因子 $\\alpha(k,a) = \\min\\left(0.1, \\left|\\mathrm{j}_1(k a)\\right|\\right)$ 是非负的，且 $\\delta_{\\ell}$ 中的所有其他项都是正的。因此，$\\delta_{\\ell}(k,N) \\geq 0$，可以去掉绝对值符号。'+' 和 '$-$' 族的差值是相同的：\n$$\n\\Delta^{(+)}(k,N) = \\Delta^{(-)}(k,N) = \\frac{1}{L_{\\max}}\\sum_{\\ell=1}^{L_{\\max}} \\frac{\\alpha(k,a)}{\\ell + \\beta N} = \\frac{\\alpha(k,a)}{L_{\\max}} \\sum_{\\ell=1}^{L_{\\max}} \\frac{1}{\\ell + \\beta N}\n$$\n其中 $a=1\\,\\mathrm{m}$，$\\beta=\\sqrt{2}$，$\\mathrm{j}_1$ 是一阶第一类球贝塞尔函数。\n\n程序将遍历五个测试用例。对于每个用例 $(k, N, L_{\\max})$，它使用 `scipy.special.spherical_jn` 函数计算 $\\alpha(k,a)$，然后计算总和，最终确定 $\\Delta = \\Delta^{(+)} = \\Delta^{(-)}$ 的值。该值在最终输出列表中为每个测试用例记录两次。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn\n\ndef solve():\n    \"\"\"\n    Computes differences between empirical and continuous eigenvalue cluster centers\n    for a synthetic model of a Calderón-preconditioned operator in computational electromagnetics.\n    \"\"\"\n    # Part A: The derivation from the Calderón calculus shows the continuous cluster centers are\n    # c_+ = 0.5 and c_- = -0.5. These are not explicitly needed in the final calculation\n    # as the difference Delta_pm = | mean(c_pm + delta) - c_pm | = |mean(delta)|.\n    \n    # Part B: Parameters for the discrete model\n    a = 1.0  # radius of the sphere in meters\n    beta = np.sqrt(2)  # dimensionless constant\n\n    # Test suite of parameters (k, N, L_max)\n    test_cases = [\n        (0.01, 24, 8),   # Case 1\n        (1.0, 48, 12),  # Case 2\n        (5.0, 96, 20),  # Case 3\n        (0.5, 8, 2),    # Case 4\n        (2.5, 160, 30), # Case 5\n    ]\n\n    results = []\n    for k, N, L_max in test_cases:\n        # Calculate the dimensionless scaling factor alpha(k,a)\n        # ka is dimensionless (in radians)\n        ka = k * a\n        \n        # spherical_jn(1, 0) correctly returns 0, so no special check for ka=0 is needed.\n        abs_j1_ka = np.abs(spherical_jn(1, ka))\n        alpha = min(0.1, abs_j1_ka)\n\n        # Calculate the perturbation sum.\n        # ell is a dimensionless mode index.\n        ell_values = np.arange(1, L_max + 1)\n        # The term (ell + beta*N) is dimensionless.\n        perturbation_sum = np.sum(1.0 / (ell_values + beta * N))\n\n        # Calculate the average perturbation, which is the absolute difference Delta.\n        # The perturbation delta_l is independent of the +/- family, so Delta^(+) = Delta^(-).\n        # The result delta_avg is dimensionless.\n        delta_avg = (alpha / L_max) * perturbation_sum\n\n        # For each case, we report two identical floats: Delta^(+) and Delta^(-).\n        results.append(delta_avg)\n        results.append(delta_avg)\n\n    # Final print statement in the exact required format.\n    # The output format is a single line, comma-separated list of floats in standard decimal notation.\n    # Using f-string with 'f' format specifier ensures decimal notation, not scientific.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "实现像卡尔德龙预处理这样的高级技术会带来额外的计算开销。一个成功的预条件子不仅要减少迭代次数，其单次迭代的成本也不能过高，否则将抵消迭代次数减少带来的收益。本练习要求你进行一次切实的复杂度分析()，比较带与不带无矩阵预条件子的求解器。通过推导两种方法的成本“盈亏平衡点”，你将掌握评估算法权衡的关键技能，以判断一个复杂方法在何种情况下才真正具有计算优势。",
            "id": "3291131",
            "problem": "您的任务是构造、分析并数值验证一个离散能量范数，在该范数下，一个经过卡尔德龙预处理的电场积分方程 (EFIE) 变得对称正定，从而能够使用共轭梯度 (CG) 迭代法。其科学基础植根于时谐麦克斯韦方程组和边界积分公式。在计算电磁学中，众所周知EFIE是第一类方程，并且在标准欧几里得范数下是病态的。卡尔德龙预处理将EFIE与从卡尔德龙投影算子派生的算子复合，以获得一个第二类强制算子。您的目标是在一个受控的离散环境中，证明一个适当的能量范数能使预处理后的算子变为自伴和正定的。\n\n基本原理：\n- EFIE源于时谐麦克斯韦方程组及相关的散射场边界积分表示。在封闭光滑边界上的基本算子将表面电流密度映射到切向电场或磁场，并涉及单层算子和超奇异算子。\n- 卡尔德龙恒等式指出，边界积分算子的复合会产生投影算子，这些投影算子消除了第一类方程的不适定性，并导出第二类强制算子（单位算子加紧扰动）。\n- 强制性意味着算子在相关的能量范数上有一个严格为正的下界，这在对称性成立时保证了稳定性，并使得共轭梯度法得以应用。\n\n待实现的离散代理模型：\n1. 考虑一个维度为 $n$ 的对称正定矩阵族，记为 $S \\in \\mathbb{C}^{n \\times n}$，它模拟离散单层算子并诱导出能量内积。通过酉离散傅里叶变换基来构造 $S$：\n$$\nS = U^\\ast \\Lambda U,\n$$\n其中 $U \\in \\mathbb{C}^{n \\times n}$ 是酉矩阵，其元素为 $U_{jk} = \\frac{1}{\\sqrt{n}} \\exp\\left(\\mathrm{i} \\frac{2\\pi jk}{n}\\right)$，对于下标 $j,k \\in \\{0,1,\\dots,n-1\\}$，并且 $\\Lambda = \\mathrm{diag}(\\lambda_0,\\dots,\\lambda_{n-1})$ 的元素为\n$$\n\\lambda_k = \\frac{1}{(1 + |m_k|)^p},\n$$\n其中 $p > 0$，$m_k \\in \\mathbb{Z}$ 由映射到整数模态指数的标准离散傅里叶频率给出，满足 $m_k \\in \\{-\\lfloor n/2 \\rfloor, \\dots, \\lfloor n/2 \\rfloor\\}$，且 $|m_k|$ 是模态数的绝对值。这种构造强制使 $S$ 成为一个-p阶的平滑算子，类似于电磁学中的离散$H^{-1/2}$能量内积。\n\n2. 通过在相同的傅里叶基中对角化来构造一个与 $S$ 对易的紧的、埃尔米特半正定扰动 $K \\in \\mathbb{C}^{n \\times n}$，\n$$\nK = U^\\ast \\mathrm{diag}(\\kappa_0,\\dots,\\kappa_{n-1}) U,\n$$\n其中 $\\kappa_k \\ge 0$ 仅对于对应于 $r$ 个最小 $|m_k|$ 值（包括 $m=0$）的 $r$ 个下标为非零，其余为零。为简单起见，设 $\\kappa_k \\in \\{0,\\alpha\\}$，其中 $\\alpha \\ge 0$ 是一个标量强度参数。这模拟了能量空间中卡尔德龙预处理EFIE算子的紧部分，并保持了对易结构。\n\n3. 形成一个离散EFIE代理算子 $A = S + K$，并应用类卡尔德龙预处理器 $T = S^{-1}$ 以获得预处理算子\n$$\nP = T A = S^{-1} (S + K) = I + S^{-1} K.\n$$\n\n4. 定义由 $S$ 诱导的离散能量内积为\n$$\n\\langle x, y \\rangle_M = x^\\ast M y, \\quad \\text{其中} \\quad M = S,\n$$\n并数值验证以下性质：\n- 关于 $\\langle \\cdot, \\cdot \\rangle_M$ 的对称性：如果 $P^\\ast M = M P$，则算子 $P$ 在 $M$-内积下是自伴的。数值上，评估弗罗贝尼乌斯范数残差\n$$\n\\| P^\\ast M - M P \\|_F,\n$$\n并将此结果报告为一个实值浮点数。\n- 正定性（强制性）：评估埃尔米特矩阵的最小特征值\n$$\nH = S^{1/2} P S^{1/2},\n$$\n其中 $S^{1/2} = U^\\ast \\mathrm{diag}(\\sqrt{\\lambda_0},\\dots,\\sqrt{\\lambda_{n-1}}) U$。算子 $P$ 在 $M$-内积下是对称正定的，当且仅当 $H$ 在欧几里得意义下是对称正定的。数值上，报告：\n    - 一个布尔值，指示 $H$ 的所有特征值是否在数值容差内严格为正。\n    - H的最小特征值（强制性常数），作为一个浮点数。\n\n实现要求：\n- 使用上述构造，矩阵为复值，但通过对计算出的量取实部（如适用），为残差和强制性返回实数浮点数。\n- 不需要物理单位；所有量都是无量纲的。\n- 指数中使用的角度以弧度为单位。\n\n测试套件：\n实现您的程序以运行以下测试用例，每个用例由一个四元组 $(n, p, r, \\alpha)$ 指定：\n- 用例 1 (一般成功路径): $(n, p, r, \\alpha) = (32, 1.0, 3, 0.1)$\n- 用例 2 (边界情况，单位算子): $(n, p, r, \\alpha) = (32, 1.0, 0, 0.0)$\n- 用例 3 (强紧致项): $(n, p, r, \\alpha) = (64, 1.5, 1, 5.0)$\n- 用例 4 (弱平滑，较大秩): $(n, p, r, \\alpha) = (16, 0.5, 8, 0.01)$\n- 用例 5 (近机器精度扰动): $(n, p, r, \\alpha) = (8, 2.0, 4, 10^{-12})$\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例必须产生一个包含三个条目的列表：对称性残差浮点数、SPD布尔标志和强制性浮点数。例如，输出必须如下所示\n$$\n[\\,[\\text{res}_1,\\text{spd}_1,\\text{coer}_1],\\,[\\text{res}_2,\\text{spd}_2,\\text{coer}_2],\\,\\dots\\,]\n$$\n请确保您的实现是自包含的，只使用允许的库，并且不读取任何输入。",
            "solution": "该问题要求对一个经过卡尔德龙预处理的电场积分方程 (EFIE) 的离散代理模型进行数值构造和验证。主要目标是证明通过适当的能量范数，预处理后的离散算子变得对称且正定，这是使用共轭梯度 (CG) 方法的必要条件。\n\n该方法论分四个主要步骤进行：\n1.  **离散算子的构造**：我们使用稠密矩阵来模拟连续积分算子，这些矩阵的性质在离散傅里叶域中定义。这是分析平移不变算子的标准技术，因为它使它们对角化，从而使其性质（如谱、对易性）变得清晰。\n    -   离散单层算子，记为 $S \\in \\mathbb{C}^{n \\times n}$，提供了能量内积。它被构造成一个对称正定 (SPD) 的平滑算子。其定义 $S = U^\\ast \\Lambda U$，其中 $U$ 是酉离散傅里叶变换 (DFT) 矩阵，$\\Lambda$ 是特征值 $\\lambda_k > 0$ 构成的对角矩阵，保证了这些性质。特征值 $\\lambda_k = (1 + |m_k|)^{-p}$ 基于整数模态指数 $m_k$ 定义，其中 $p>0$，导致 $\\lambda_k$ 随频率升高而衰减。这模拟了连续索博列夫空间映射（如 $H^{1/2} \\to H^{-1/2}$）的行为。\n    -   紧扰动 $K \\in \\mathbb{C}^{n \\times n}$ 在相同的傅里叶基中构造：$K = U^\\ast \\mathrm{diag}(\\kappa_0,\\dots,\\kappa_{n-1}) U$。特征值 $\\kappa_k$ 是非负的，并且仅对少数（$r$ 个）低频模态非零。这模拟了一个紧算子。在相同基中构造 $S$ 和 $K$ 的一个关键结果是它们对易：$[S, K] = SK - KS = 0$。\n\n2.  **预处理**：离散EFIE代理是 $A = S + K$。这代表了一个第一类积分方程算子。类卡尔德龙预处理器是 $T = S^{-1}$。从左侧应用它得到预处理算子 $P = T A = S^{-1}(S + K) = I + S^{-1}K$。这是一个第二类弗雷德霍姆算子（$I$ 加上一个紧项 $S^{-1}K$）的离散模拟。\n\n3.  **对称性验证**：我们必须验证 $P$ 在由 $M=S$ 诱导的能量内积（定义为 $\\langle x, y \\rangle_S = x^\\ast S y$）下是自伴（对称）的。自伴性的条件是对于所有 $x, y \\in \\mathbb{C}^n$，$\\langle Px, y \\rangle_S = \\langle x, Py \\rangle_S$ 成立。这转化为矩阵恒等式 $P^\\ast S = S P$。\n    我们可以解析地验证这一点。由于 $S$ 和 $K$ 是埃尔米特矩阵且对易，因此 $S^{-1}$ 和 $K$ 也对易。\n    -   左侧：$P^\\ast S = (I + S^{-1}K)^\\ast S = (I + (S^{-1}K)^\\ast)S = (I + K^\\ast (S^{-1})^\\ast)S = (I + K S^{-1})S = S+K$。\n    -   右侧：$S P = S(I + S^{-1}K) = S+K$。\n    由于左侧=右侧，该性质成立。数值任务是计算残差的弗罗贝尼乌斯范数 $\\| P^\\ast S - S P \\|_F$，它应该在浮点精度范围内为零。\n\n4.  **正定性验证**：我们必须验证 $P$ 在 $S$-内积下是正定的，即对于所有非零 $x$，$\\langle Px, x \\rangle_S > 0$。这等价于算子的强制性。问题指导我们分析埃尔米特矩阵 $H = S^{1/2} P S^{1/2}$。\n    -   我们可以简化这个表达式：$H = S^{1/2} (I + S^{-1}K) S^{1/2} = S^{1/2}I S^{1/2} + S^{1/2}S^{-1}K S^{1/2} = S + S^{-1/2}K S^{1/2}$。\n    -   因为 $S$ 和 $K$ 对易，所以 $S$ 的任何函数（如 $S^{-1/2}$）也与 $K$ 对易。因此，$S^{-1/2}K S^{1/2} = K S^{-1/2} S^{1/2} = K$。\n    -   这得到了一个显著的简化：$H = S+K = A$。\n    -   寻找 $H$ 的特征值问题简化为寻找 $A=S+K$ 的特征值。由于 $S$ 和 $K$ 在傅里叶基中都是对角的，它们的和在该基中也是对角的。因此，$H=A$ 的特征值就是 $\\lambda_k + \\kappa_k$。\n    -   $P$ 在 $S$-内积下的正定性等价于 $H$ 的标准正定性。$H$ 的特征值 $\\lambda_k + \\kappa_k$ 都是严格为正的，因为 $\\lambda_k > 0$ 且 $\\kappa_k \\ge 0$。这证实了 $H$ 是对称正定的。$H$ 的最小特征值 $\\min_k(\\lambda_k + \\kappa_k)$ 是需要报告的量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes a discrete surrogate model for a Calderón-preconditioned\n    Electric Field Integral Equation (EFIE).\n    \"\"\"\n\n    # Test cases defined by (n, p, r, alpha)\n    # n: matrix dimension\n    # p: smoothing order for S\n    # r: rank of compact perturbation K\n    # alpha: strength of perturbation K\n    test_cases = [\n        (32, 1.0, 3, 0.1),\n        (32, 1.0, 0, 0.0),\n        (64, 1.5, 1, 5.0),\n        (16, 0.5, 8, 0.01),\n        (8, 2.0, 4, 1e-12),\n    ]\n\n    results = []\n    # A small tolerance for numerically checking strict positivity of eigenvalues\n    positivity_tolerance = 1e-15\n\n    for n, p, r, alpha in test_cases:\n        # Step 1: Define discrete Fourier modes and operator eigenvalues in the Fourier domain.\n        \n        # Standard integer mode indices corresponding to numpy's FFT order.\n        m_k = np.fft.fftfreq(n) * n\n        abs_m_k = np.abs(m_k)\n        \n        # Eigenvalues of the discrete single-layer operator S.\n        lambda_k = 1.0 / np.power(1.0 + abs_m_k, p)\n        \n        # Eigenvalues of the compact perturbation K.\n        kappa_k = np.zeros(n, dtype=float)\n        if r > 0:\n            # The perturbation is non-zero only for r modes with the smallest |m_k|.\n            pert_indices = np.argsort(abs_m_k)[:r]\n            kappa_k[pert_indices] = alpha\n\n        # Step 2: Construct dense matrices S and P.\n        \n        # Construct the unitary Discrete Fourier Transform (DFT) matrix U.\n        # The entry U_jk is (1/sqrt(n)) * exp(i*2*pi*j*k/n). This matrix corresponds\n        # to the inverse DFT operation in numpy's convention.\n        j_indices, k_indices = np.meshgrid(np.arange(n), np.arange(n), sparse=True, indexing='ij')\n        U = (1.0 / np.sqrt(n)) * np.exp(2j * np.pi * j_indices * k_indices / n)\n\n        # Construct S = U^* Lambda U, where Lambda is diag(lambda_k).\n        # U is unitary, so U^* = U^-1. S is diagonal in the basis formed by columns of U^*.\n        S = U.conj().T @ np.diag(lambda_k) @ U\n        \n        # Construct P = I + S^-1 K. P is diagonal in the same basis with eigenvalues 1 + kappa_k/lambda_k.\n        p_eigvals = 1.0 + kappa_k / lambda_k\n        P = U.conj().T @ np.diag(p_eigvals) @ U\n        \n        # Step 3: Verify the symmetry property.\n        # Check if P is self-adjoint in the S-inner product by computing the residual\n        # norm || P^* S - S P ||_F. Analytically, this is zero because S and P commute.\n        # Numerically, it will be on the order of machine precision.\n        residual_matrix = P.conj().T @ S - S @ P\n        symmetry_residual = np.linalg.norm(residual_matrix, 'fro')\n\n        # Step 4: Verify the positive definiteness property.\n        # This involves analyzing the matrix H = S^(1/2) P S^(1/2). As derived, this simplifies\n        # to H = S + K because S and K commute. The eigenvalues of H are therefore lambda_k + kappa_k.\n        H_eigenvalues = lambda_k + kappa_k\n        \n        # The smallest eigenvalue of H is the quantity to be reported.\n        min_H_eigenvalue = np.min(H_eigenvalues)\n        \n        # P is positive definite in the S-inner product if and only if H is positive definite\n        # in the standard Euclidean sense. Since lambda_k > 0 and kappa_k >= 0,\n        # all eigenvalues of H are strictly positive.\n        is_spd = bool(min_H_eigenvalue > positivity_tolerance)\n        \n        results.append([float(symmetry_residual), is_spd, float(min_H_eigenvalue)])\n\n    # Format the final output string exactly as specified in the problem statement.\n    # The output is a list of lists, represented as a single-line string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "实现像卡尔德龙预处理这样的高级技术会带来额外的计算开销。一个成功的预条件子不仅要减少迭代次数，其单次迭代的成本也不能过高，否则将抵消迭代次数减少带来的收益。本练习要求你进行一次切实的复杂度分析()，比较带与不带无矩阵预条件子的求解器。通过推导两种方法的成本“盈亏平衡点”，你将掌握评估算法权衡的关键技能，以判断一个复杂方法在何种情况下才真正具有计算优势。",
            "id": "3291149",
            "problem": "您正在使用 Rao-Wilton-Glisson (RWG) 基函数对理想电导散射体的电场积分方程 (EFIE) 进行离散化，得到一个规模为 $N$ 的边界积分方程。所得到的线性系统通过重启参数为 $m$ 的广义最小残差 (GMRES) 方法进行迭代求解。该系统算子采用快速多极子方法 (FMM) 类型的加速以无矩阵方式应用。\n\n请采纳以下建模假设，这些假设已由计算电磁学的标准实践证明是合理的：\n- 使用快速多极子方法 (FMM) 加速的 EFIE 算子进行单次矩阵向量乘积的主阶复杂度为 $a\\,N \\log N$ 次运算，其中 $a>0$ 是一个与实现相关的常数，涵盖了核函数求值、平移和近场成本。\n- 带有重启参数 $m$ 的重启 GMRES 的一次迭代使用修正的 Gram–Schmidt 正交化处理 $m$ 个基向量，其主阶成本为 $4\\,m\\,N$ 次乘加运算（用于内积和向量更新）。\n- 一个无矩阵的卡尔德龙乘性预处理器在右侧应用，它由算子复合构成，每次迭代需要 $p$ 次额外的 FMM 加速算子应用（具有相同的渐近成本常数 $a$），其中 $p \\in \\mathbb{N}$ 是固定的且与 $N$ 无关。\n- 在 $N$ 很大的渐近状态下，与无预处理的情况相比，该预处理器将达到固定容差所需的 GMRES 迭代次数减少了一个与 $N$ 无关的因子 $\\eta \\in (0,1)$。\n- FMM 使用的辅助内存与 $N$ 呈线性关系，并被系统算子和预处理器复用。无矩阵预处理器需要常数个长度为 $N$ 的额外工作向量。\n\n任务：\n1) 从 GMRES 和修正 Gram–Schmidt 的定义，以及给定的 FMM 算子应用的渐近成本出发，推导以下两种情况每次 GMRES 迭代的主阶计算复杂度：\n   - 无预处理的求解器，\n   - 带无矩阵卡尔德龙预处理器的右预处理求解器。\n\n2) 推导两种求解器的主阶渐近内存占用，用 $N$ 和 $m$ 表示，并明确指出与 Krylov 子空间存储和预处理器所需的任何额外工作向量相关的主导项。\n\n3) 使用每次迭代的成本和迭代次数减少因子 $\\eta$，将渐近临界问题规模 $N_{\\star}$ 定义为这样一个网格规模：在该规模下，有无预处理器时，达到固定容差所需的总主阶计算成本相同。求解 $N_{\\star}$，得到一个以 $a$、$m$、$p$ 和 $\\eta$ 表示的闭式解析表达式。您的最终答案应为 $N_{\\star}$ 的这个表达式。不包括单位。如果出现对数，请使用自然对数，并将 $N_{\\star}$ 表示为显式函数（而不是通过方程隐式表示）。",
            "solution": "该问题要求分析用于电场积分方程 (EFIE) 的无预处理和有预处理迭代求解器的计算成本和内存占用，并最终推导出临界问题规模 $N_{\\star}$。解答过程遵循所提供的建模假设。\n\n令 $N$ 为自由度数量（与 RWG 基函数的数量成正比）。令 $m$ 为 GMRES 的重启参数。常数 $a > 0$ 表征快速多极子方法 (FMM) 应用的成本，$p \\in \\mathbb{N}$ 是预处理器所需的辅助算子应用次数，$\\eta \\in (0,1)$ 是迭代次数减少因子。\n\n**1) 每次迭代的计算复杂度**\n\n每次 GMRES 迭代的计算复杂度是单次矩阵向量乘积（或其预处理等效形式）的成本与正交化过程成本之和。\n\n**无预处理求解器：**\n对于系统 $A\\mathbf{x} = \\mathbf{b}$，无预处理 GMRES 求解器的一次迭代包括：\n- 一次由 FMM 加速的矩阵向量乘积，$\\mathbf{v} = A\\mathbf{u}$。此操作的主阶成本为 $C_{FMM} = a N \\ln N$。\n- 使用修正的 Gram-Schmidt 方法将新向量与 Krylov 基中的 $m$ 个向量进行正交化，以及随后的向量更新。主阶成本为 $C_{MGS} = 4 m N$。\n\n每次迭代的总主阶计算复杂度 $C_{\\text{iter,unprec}}$ 是这些成本的总和：\n$$C_{\\text{iter,unprec}} = a N \\ln N + 4 m N$$\n\n**右预处理求解器：**\n该求解器求解右预处理系统 $(AP^{-1})\\mathbf{y} = \\mathbf{b}$，其中 $\\mathbf{x} = P^{-1}\\mathbf{y}$。应用于此系统的 GMRES 的一次迭代需要：\n- 将复合算子 $AP^{-1}$ 应用于向量 $\\mathbf{u}$ 一次。这分两步进行：\n    1.  应用预处理器的逆：$\\mathbf{v} = P^{-1}\\mathbf{u}$。此步骤的成本是 $p$ 次额外的 FMM 加速算子应用。因此，成本为 $C_{\\text{prec\\_app}} = p \\cdot (a N \\ln N) = p a N \\ln N$。\n    2.  应用系统算子：$\\mathbf{w} = A\\mathbf{v}$。其成本为单次标准 FMM 加速应用的成本，即 $C_{FMM} = a N \\ln N$。\n等效矩阵向量乘积的总成本是这两者之和，即 $(p a N \\ln N) + (a N \\ln N) = (p+1)a N \\ln N$。\n- 正交化成本与无预处理的情况相同，因为它仅取决于重启参数 $m$ 和问题规模 $N$。成本为 $C_{MGS} = 4 m N$。\n\n有预处理求解器的每次迭代的总主阶计算复杂度 $C_{\\text{iter,prec}}$ 为：\n$$C_{\\text{iter,prec}} = (p+1)a N \\ln N + 4 m N$$\n\n**2) 渐近内存占用**\n\n内存占用由 Krylov 子空间基向量、FMM 数据结构和任何其他工作向量所需的存储空间决定。假设一个大小为 $N$ 的向量占用 $N$ 个单位的存储空间。\n\n**无预处理求解器：**\n- 重启 GMRES(m) 必须存储 Krylov 子空间的标准正交基。在一个周期的 $m$ 次迭代过程中的任何时刻，内存中最多保存 $m+1$ 个向量（$m$ 个基向量和正在生成并进行正交化的新向量）。这些向量的存储量为 $(m+1)N$。\n- FMM 需要辅助数据结构，其内存使用量与 $N$ 呈线性关系。设其为 $M_{FMM} = c_1 N$，其中 $c_1$ 为某个常数。\n- 用于右端项、解向量和临时结果的额外向量需要 $c_2 N$ 的存储空间，其中 $c_2$ 是一个小常数。\n总内存占用 $M_{\\text{unprec}}$ 是这些部分的总和。以 $N$ 和 $m$ 表示的主导项为：\n$$M_{\\text{unprec}}(N, m) = (m+1)N + c_{\\text{aux}}N = (m+1+c_{\\text{aux}})N$$\n其中 $c_{\\text{aux}}$ 合并了所有与 Krylov 基大小无关的、与 $N$ 呈线性的存储成本。与 Krylov 子空间明确相关的项是 $(m+1)N$。\n\n**右预处理求解器：**\n- 用于 Krylov 基的 GMRES 存储需求仍然是 $(m+1)N$。\n- FMM 内存被预处理器应用复用。\n- 问题陈述指出，预处理器需要常数个（我们称之为 $c_p$）长度为 $N$ 的额外工作向量。这会使内存占用增加 $c_p N$。\n有预处理求解器的总内存占用 $M_{\\text{prec}}$ 为：\n$$M_{\\text{prec}}(N, m) = (m+1)N + c_p N + c_{\\text{aux}}N = (m+1+c_p+c_{\\text{aux}})N$$\n与无预处理求解器相比，存储量增加了 $c_p N$。\n\n**3) 临界问题规模 $N_{\\star}$**\n\n临界问题规模 $N_{\\star}$ 是指在规模 $N$ 下，两种求解器达到固定容差的总计算成本相等的点。\n\n令 $K_{\\text{unprec}}$ 为无预处理求解器所需的迭代次数。总成本为 $T_{\\text{unprec}} = K_{\\text{unprec}} \\cdot C_{\\text{iter,unprec}}$。\n$$T_{\\text{unprec}} = K_{\\text{unprec}} (a N \\ln N + 4 m N)$$\n\n对于有预处理的求解器，迭代次数减少为 $K_{\\text{prec}} = \\eta K_{\\text{unprec}}$。总成本为 $T_{\\text{prec}} = K_{\\text{prec}} \\cdot C_{\\text{iter,prec}}$。\n$$T_{\\text{prec}} = (\\eta K_{\\text{unprec}}) ((p+1)a N \\ln N + 4 m N)$$\n\n临界点 $N_{\\star}$ 通过在 $N=N_{\\star}$ 时令 $T_{\\text{unprec}} = T_{\\text{prec}}$ 来找到。\n$$K_{\\text{unprec}} (a N_{\\star} \\ln N_{\\star} + 4 m N_{\\star}) = \\eta K_{\\text{unprec}} ((p+1)a N_{\\star} \\ln N_{\\star} + 4 m N_{\\star})$$\n\n因为 $K_{\\text{unprec}} > 0$ 且我们寻求 $N_{\\star} > 0$ 的解，所以可以将两边同除以 $K_{\\text{unprec}}N_{\\star}$：\n$$a \\ln N_{\\star} + 4 m = \\eta ((p+1)a \\ln N_{\\star} + 4 m)$$\n$$a \\ln N_{\\star} + 4 m = \\eta(p+1)a \\ln N_{\\star} + 4 m \\eta$$\n\n现在我们通过重新整理各项来求解 $\\ln N_{\\star}$：\n$$4 m - 4 m \\eta = \\eta(p+1)a \\ln N_{\\star} - a \\ln N_{\\star}$$\n$$4 m (1 - \\eta) = a \\ln N_{\\star} (\\eta(p+1) - 1)$$\n\n求解 $\\ln N_{\\star}$：\n$$\\ln N_{\\star} = \\frac{4 m (1 - \\eta)}{a (\\eta(p+1) - 1)}$$\n为了使 $N_{\\star}$ 成为一个大于 1 的有意义的临界点，我们必须有 $\\ln N_{\\star} > 0$。由于 $a>0$，$m>0$ 且 $1-\\eta>0$，分子是正的。因此，分母也必须是正的：\n$$\\eta(p+1) - 1 > 0 \\implies \\eta(p+1) > 1$$\n该条件意味着有预处理求解器的每次迭代渐近成本更高，这允许存在一个交叉点：从 MGS 成本占主导的区域（此时由于 $\\eta  1$，预处理器是有效的）过渡到 FMM 成本占主导的区域（此时由于因子 $\\eta(p+1)>1$，预处理器效果较差）。\n\n为了求得 $N_{\\star}$，我们对 $\\ln N_{\\star}$ 的表达式取指数：\n$$N_{\\star} = \\exp\\left(\\frac{4 m (1 - \\eta)}{a (\\eta(p+1) - 1)}\\right)$$\n这就是临界问题规模的闭式解析表达式。",
            "answer": "$$\\boxed{\\exp\\left(\\frac{4m(1-\\eta)}{a(\\eta(p+1) - 1)}\\right)}$$"
        }
    ]
}