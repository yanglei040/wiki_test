{
    "hands_on_practices": [
        {
            "introduction": "The standard artificial viscosity formulation in SPH contains two key components, often denoted by coefficients $\\alpha$ and $\\beta$. This exercise challenges you to explore the fundamental physics behind this structure. By analyzing the momentum balance in a strong shock, you will justify why both a linear and a quadratic term are necessary and determine the conditions under which one dominates the other, providing crucial insight into tuning viscosity for different Mach number regimes .",
            "id": "3465341",
            "problem": "In cosmological shock capturing for gas dynamics modeled with Smoothed Particle Hydrodynamics (SPH), the compressible Euler equations,\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}) = 0, \\qquad\n\\frac{\\partial (\\rho \\mathbf{v})}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}\\mathbf{v} + P \\mathbf{I}) = 0,\n$$\nlack physical viscosity and therefore do not dissipate the kinetic energy flux at a shock. To stabilize shocks and prevent particle interpenetration, an artificial viscosity is introduced that damps approaching motions. Consider a pair of equal-mass SPH particles with separation vector $\\mathbf{r}_{ij}$ and approaching radial speed $v_{r} \\equiv -\\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij} > 0$ (where $\\hat{\\mathbf{r}}_{ij} \\equiv \\mathbf{r}_{ij}/r_{ij}$). The artificial viscosity is built from a dimensionless approach measure,\n$$\n\\mu_{ij} \\equiv \\frac{h v_{r}}{r_{ij}},\n$$\nwhere $h$ is the local smoothing length, and two contributions often referred to as a linear term and a quadratic term with coefficients $\\alpha$ and $\\beta$. Let the characteristic sound speed be $c_{s}$ and the Mach number be $\\mathcal{M} \\equiv v_{r}/c_{s}$.\n\nUsing the compressible Euler equations as the fundamental base and arguing from momentum flux balance across a shock, justify why a quadratic-in-velocity dissipation is required at high Mach number to prevent particle interpenetration, and deduce the Mach-number threshold $\\mathcal{M}_{\\star}$ above which the quadratic contribution (proportional to $\\beta \\mu_{ij}^{2}$) dominates the linear contribution (proportional to $\\alpha c_{s} \\mu_{ij}$). Express $\\mathcal{M}_{\\star}$ in terms of $\\alpha$, $\\beta$, and $h/r_{ij}$, assuming $v_{r} > 0$ and neglecting any small regularization terms.\n\nThen, for typical cosmological SPH configurations in which neighboring particles are separated by a distance comparable to the smoothing length, take $\\alpha = 1$, $\\beta = 2$, and $h/r_{ij} = 1$ to estimate a numerical value of $\\mathcal{M}_{\\star}$. Express your final answer as a pure number (dimensionless) and round your estimate to three significant figures.",
            "solution": "The problem requires a two-part analysis: first, a physical justification for the quadratic viscosity term in high Mach number shocks, and second, the derivation of the Mach number threshold where this term becomes dominant, followed by a numerical estimation.\n\nFirst, we address the justification for a quadratic-in-velocity dissipation term. In an ideal, inviscid fluid, the momentum flux across a shock front must be conserved. This is described by the Rankine-Hugoniot jump conditions. For a strong shock, the incoming ram pressure ($\\rho v^2$) is much larger than the thermal pressure. To halt the supersonic flow, the shock must generate a pressure jump that is proportional to this incoming ram pressure, i.e., $\\Delta P \\propto \\rho v^2$.\n\nAn effective artificial viscosity must be able to generate a pressure that scales in the same way with velocity. The SPH artificial viscosity is constructed from two components:\n1.  A linear term, which contributes a viscous pressure proportional to $\\alpha c_s \\mu_{ij} \\propto v_r$.\n2.  A quadratic term, which contributes a viscous pressure proportional to $\\beta \\mu_{ij}^2 \\propto v_r^2$.\n\nComparing these scaling relations to the physical requirement, it is clear that the quadratic term, with its $v_r^2$ dependence, has the correct functional form to handle strong, high-Mach-number shocks. The linear term alone would be insufficient to prevent particles from unphysically passing through each other in such conditions. The quadratic term is therefore essential for providing the necessary bulk viscosity.\n\nNext, we deduce the Mach-number threshold $\\mathcal{M}_{\\star}$ where the quadratic contribution begins to dominate the linear contribution. This threshold is found by equating the magnitudes of the two terms:\n$$\n\\beta \\mu_{ij}^{2} = \\alpha c_{s} \\mu_{ij}\n$$\nSince the particles are approaching, $\\mu_{ij} > 0$, so we can divide by $\\mu_{ij}$:\n$$\n\\beta \\mu_{ij} = \\alpha c_{s}\n$$\nSubstitute the definition of $\\mu_{ij} = \\frac{h v_{r}}{r_{ij}}$:\n$$\n\\beta \\left( \\frac{h v_{r}}{r_{ij}} \\right) = \\alpha c_{s}\n$$\nThe Mach number is $\\mathcal{M} = v_{r}/c_{s}$. We rearrange the equation to solve for this ratio at the threshold, which we call $\\mathcal{M}_{\\star}$:\n$$\n\\mathcal{M}_{\\star} = \\frac{v_{r}}{c_{s}} = \\frac{\\alpha}{\\beta} \\frac{r_{ij}}{h} = \\frac{\\alpha}{\\beta} \\left( \\frac{h}{r_{ij}} \\right)^{-1}\n$$\nThis expression gives the threshold Mach number. For Mach numbers $\\mathcal{M} > \\mathcal{M}_{\\star}$, the quadratic term will dominate.\n\nFinally, we estimate a numerical value for $\\mathcal{M}_{\\star}$ using the typical values provided: $\\alpha = 1$, $\\beta = 2$, and $h/r_{ij} = 1$.\n$$\n\\mathcal{M}_{\\star} = \\frac{1}{2} \\left( 1 \\right)^{-1} = 0.5\n$$\nRounding to three significant figures, the numerical value is $0.500$.",
            "answer": "$$\\boxed{0.500}$$"
        },
        {
            "introduction": "While essential for capturing shocks, artificial viscosity can introduce unwanted numerical dissipation in purely rotational or shearing flows. This practice guides you through the design of a \"viscosity switch,\" a common technique to make dissipation more intelligent. You will construct a function based on physical principles that automatically suppresses viscosity in regions of high vorticity, ensuring that kinetic energy is more accurately conserved in non-compressive flows .",
            "id": "3465306",
            "problem": "In cosmological Smoothed Particle Hydrodynamics (SPH), artificial viscosity is introduced to capture shocks while avoiding spurious dissipation in vortical or shear-dominated flows. A common strategy is to modulate the artificial viscosity coefficient by a switch factor that suppresses viscosity in regions where vorticity dominates over compression. Consider a switch function $f$ that multiplies a base artificial viscosity coefficient $\\alpha$, so that the effective coefficient is $f \\alpha$. The switch $f$ should satisfy the following principles derived from first principles and dimensional analysis:\n\n- It depends only on kinematic invariants that distinguish compression from rotation, namely the divergence magnitude $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and the vorticity magnitude $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n- It is dimensionless, bounded between $0$ and $1$, increases monotonically with $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\times \\mathbf{v}\\right|$, and decreases monotonically with $\\left|\\nabla \\times \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\cdot \\mathbf{v}\\right|$.\n- It remains well-defined in quiescent flows by including a regularizing term constructed from the local signal speed $c$ and smoothing length $h$, combined with a small dimensionless parameter $\\epsilon>0$, such that the combination has the same dimensions as $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n\n(a) Using these requirements, construct the simplest admissible form of $f$ built from nonnegative linear contributions of the admissible invariants that respects the stated monotonicity, boundedness, and dimensional constraints.\n\n(b) For a locally vortical flow in a cosmological SPH calculation with $\\left|\\nabla \\cdot \\mathbf{v}\\right|=0.01$, $\\left|\\nabla \\times \\mathbf{v}\\right|=10$, $c=1$, $h=0.05$, $\\epsilon=0.1$, and base coefficient $\\alpha=1$, evaluate the switch $f$ and the effective artificial viscosity coefficient $f\\alpha$.\n\nRound your numerical results for $f$ and $f\\alpha$ to four significant figures. Report your final answers as two numbers without units in the order $\\left(f, f\\alpha\\right)$.",
            "solution": "(a) The problem asks for the simplest form of a switch function $f$ that is dimensionless, bounded between 0 and 1, and distinguishes between compression (divergence, $|\\nabla \\cdot \\mathbf{v}|$) and rotation (vorticity, $|\\nabla \\times \\mathbf{v}|$). The function should increase with compression and decrease with rotation. A rational function of the form\n$$ f = \\frac{|\\nabla \\cdot \\mathbf{v}|}{|\\nabla \\cdot \\mathbf{v}| + |\\nabla \\times \\mathbf{v}|} $$\nsatisfies these criteria. It is dimensionless, as both divergence and vorticity have units of inverse time. It is bounded between 0 and 1 for non-negative inputs. It correctly approaches 1 for pure compression ($|\\nabla \\times \\mathbf{v}| \\to 0$) and 0 for pure rotation ($|\\nabla \\cdot \\mathbf{v}| \\to 0$).\n\nTo prevent division by zero in quiescent flows where both terms might vanish, a regularization term is required. This term must have the same dimensions as divergence, $[T^{-1}]$. Using the provided quantities—signal speed $c$ ($[LT^{-1}]$), smoothing length $h$ ($[L]$), and dimensionless parameter $\\epsilon$—the only combination with the correct dimensions is $\\epsilon c/h$. Adding this term to the denominator for stability, the final form of the switch function is:\n$$ f = \\frac{|\\nabla \\cdot \\mathbf{v}|}{|\\nabla \\cdot \\mathbf{v}| + |\\nabla \\times \\mathbf{v}| + \\epsilon \\frac{c}{h}} $$\n\n(b) We are given the following values: $|\\nabla \\cdot \\mathbf{v}| = 0.01$, $|\\nabla \\times \\mathbf{v}| = 10$, $c = 1$, $h = 0.05$, $\\epsilon = 0.1$, and $\\alpha = 1$.\n\nFirst, we calculate the value of the regularization term:\n$$ \\epsilon \\frac{c}{h} = (0.1) \\frac{1}{0.05} = 2 $$\nNow, we substitute all values into the expression for $f$:\n$$ f = \\frac{0.01}{0.01 + 10 + 2} = \\frac{0.01}{12.01} \\approx 0.000832639467... $$\nRounding to four significant figures, $f = 0.0008326$.\n\nThe effective artificial viscosity coefficient is $f\\alpha$. Since $\\alpha = 1$:\n$$ f\\alpha = (0.0008326) \\times 1 = 0.0008326 $$\nThe requested values are $(f, f\\alpha) = (0.0008326, 0.0008326)$. This low value correctly shows that the viscosity is strongly suppressed in this vorticity-dominated flow.",
            "answer": "$$\\boxed{0.0008326, 0.0008326}$$"
        },
        {
            "introduction": "Implementing a physical model in a numerical simulation often comes with computational costs and stability constraints. This exercise connects the concept of artificial viscosity directly to the practical challenge of time integration in an SPH code. You will derive how the signal speed associated with artificial viscosity dictates the maximum allowable time step via the Courant–Friedrichs–Lewy (CFL) condition, a critical consideration for the stability and efficiency of any cosmological simulation .",
            "id": "3465304",
            "problem": "In Smoothed Particle Hydrodynamics (SPH; Smoothed Particle Hydrodynamics) used for numerical cosmology, artificial viscosity introduces a characteristic pairwise signal velocity that bounds the speed at which compressive disturbances propagate between neighbors. For an explicitly time-integrated method, stability and causality impose that information must not traverse more than an order-unity fraction of the local resolution scale in a single time step, a requirement commonly captured by the Courant–Friedrichs–Lewy (CFL; Courant–Friedrichs–Lewy) condition. Consider a single SPH particle evolving under hydrodynamics and gravity in a cosmological setting, with local smoothing length $h$ and an estimate of the maximum pairwise artificial-viscosity signal speed over its neighbors, $v_{\\text{sig}}$. Assume a standard explicit scheme in which the only relevant bound is that set by finite signal propagation over the kernel scale, modulated by a dimensionless Courant factor $C_{\\text{CFL}} \\in (0,1)$.\n\nStarting from these principles and definitions, derive a general expression for the particle’s maximum allowed time step $\\Delta t_{\\max}$ in terms of $h$, $v_{\\text{sig}}$, and $C_{\\text{CFL}}$. Then evaluate this maximum time step for a particle with $h = 0.005$, neighbor-maximum $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$. All quantities are given in consistent code units so that the resulting time step is in code time units. Round your final numerical answer to $4$ significant figures. Finally, based on your derivation, discuss the implications of this bound for local time-stepping strategies in cosmological simulations, particularly in regions with strong shocks and large density contrasts. Your final reported answer must be the single numerical value of $\\Delta t_{\\max}$ in code time units.",
            "solution": "The relevant starting point is the stability constraint for explicit time integration in hyperbolic systems with finite signal propagation speeds. In such systems, the Courant–Friedrichs–Lewy (CFL) condition enforces that in one time step, the fastest signal should not traverse more than an order-unity fraction of the local resolution scale. In Smoothed Particle Hydrodynamics (SPH), the local resolution scale is set by the smoothing length $h$, while the maximal neighbor-to-neighbor propagation speed of compressive disturbances in the presence of artificial viscosity is captured by an estimate $v_{\\text{sig}}$.\n\nThe fundamental requirement is that the distance traversed by the fastest relevant signal during a time step $\\Delta t$ is bounded by a fraction of the resolution length. Writing this causality and stability constraint,\n$$\nv_{\\text{sig}} \\, \\Delta t \\le C_{\\text{CFL}} \\, h,\n$$\nwhere $C_{\\text{CFL}} \\in (0,1)$ is a dimensionless Courant factor that encodes the geometric constants of the kernel support, details of the explicit scheme, and a safety margin for nonlinearities and multi-dimensional effects. Solving this for the time step bound gives the general expression\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\n\nThis follows directly from (i) the definition of the SPH smoothing length $h$ as the characteristic kernel scale over which interactions are resolved, (ii) the identification of $v_{\\text{sig}}$ as an upper bound to the neighbor-to-neighbor information speed introduced by artificial viscosity to capture compressive shocks, and (iii) the stability requirement of explicit methods that the domain of dependence of the discrete scheme must contain that of the continuum problem.\n\nWe now evaluate this expression for the specified particle data. Given $h = 0.005$, $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$, all in consistent code units, we substitute into\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\nCompute the numerator:\n$$\nC_{\\text{CFL}} \\, h = 0.25 \\times 0.005 = 0.00125.\n$$\nDivide by $v_{\\text{sig}}$:\n$$\n\\Delta t_{\\max} = \\frac{0.00125}{30} = 0.000041666\\ldots = 4.166666\\ldots \\times 10^{-5}.\n$$\nRounding to $4$ significant figures yields\n$$\n\\Delta t_{\\max} = 4.167 \\times 10^{-5},\n$$\nin code time units.\n\nImplications for local time-stepping in cosmological simulations: The derived bound shows that $\\Delta t_{\\max} \\propto h / v_{\\text{sig}}$. In cosmological structure formation, high-density regions such as virialized halos and shock fronts typically have smaller $h$ (due to Lagrangian adaptivity concentrating resolution) and larger $v_{\\text{sig}}$ (due to enhanced sound speeds and relative velocities across compressive flows that trigger stronger artificial viscosity). Consequently, $\\Delta t_{\\max}$ can decrease by orders of magnitude in these regions compared to the diffuse intergalactic medium. Local time-stepping schemes exploit this by assigning smaller time steps only where needed, thus maintaining accuracy and stability near shocks while avoiding a global time step limited by a tiny subset of particles. However, this introduces challenges: synchronization between hydrodynamics and long-range gravity solvers, conservation errors if neighboring particles evolve with disparate time steps, and the need for time-step limiters to prevent large disparities across interacting neighbors. In comoving formulations, care must also be taken that $v_{\\text{sig}}$ and $h$ are consistently defined in the same (physical or comoving) frame so that the CFL bound remains meaningful. Overall, the scaling $\\Delta t_{\\max} \\sim h / v_{\\text{sig}}$ motivates hierarchical local time-stepping with neighbor-aware limiters in realistic cosmological flows.",
            "answer": "$$\\boxed{4.167 \\times 10^{-5}}$$"
        }
    ]
}