{
    "hands_on_practices": [
        {
            "introduction": "现代流体动力学有限体积法的基础在于理解信息的传播方式，这由欧拉方程的特征结构所描述。第一个练习  将引导你推导通量雅可比矩阵及其特征系统，这是解锁黎曼求解器和基于特征的重构方法设计的数学关键。通过这个基础性的推导，你将深入理解控制流体动力学行为的波的传播特性。",
            "id": "3510528",
            "problem": "在为天体物理流体动力学的有限体积法构建近似黎曼求解器的背景下，考虑守恒形式的一维（$1$维）可压缩欧拉方程，\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\n其中守恒状态向量为 $U = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$，通量为 $F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u\\,(E+p) \\end{pmatrix}$，并采用理想气体状态方程 $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是总能量密度，$p$ 是气体压力，$\\gamma$ 是比热比。定义总比焓 $H = \\frac{E + p}{\\rho}$ 和绝热声速 $c$，其关系为 $c^{2} = \\gamma p/\\rho$。\n\n仅从这些定义出发，完成以下任务：\n$1.$ 显式推导通量雅可比矩阵 $A(U) = \\frac{\\partial F}{\\partial U}$，用守恒变量和热力学量 $u$、$H$ 和 $c$ 表示。\n$2.$ 确定 $A(U)$ 的三个实特征值，并为每个特征值构建一个线性无关的右特征向量集。采用归一化方式，使每个右特征向量的第一个分量为1。\n$3.$ 使用您的结果，给出通量雅可比矩阵特征多项式 $P(\\lambda)$ 的闭式表达式，约定 $P(\\lambda) = \\det(\\lambda I - A)$，且表达式中只含符号 $\\lambda$、$u$ 和 $c$。\n\n您最终报告的答案必须是第 $3$ 部分所要求的单个 $P(\\lambda)$ 的解析表达式。不需要进行数值计算，也不需要给出单位。如果您选择展开或因式分解多项式，只要代数上正确且完全简化，任何一种形式都是可以接受的。",
            "solution": "该问题要求对一维可压缩欧拉方程的通量雅可比矩阵进行三部分推导。我们将按顺序处理每个部分。\n\n守恒状态向量为 $U = \\begin{pmatrix} U_1 \\\\ U_2 \\\\ U_3 \\end{pmatrix} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$，通量向量为 $F(U) = \\begin{pmatrix} F_1 \\\\ F_2 \\\\ F_3 \\end{pmatrix} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2+p \\\\ u(E+p) \\end{pmatrix}$。状态方程为 $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$。\n\n首先，我们用 $U$ 的分量表示原始变量 $\\rho, u$ 和压力 $p$：\n$\\rho = U_1$\n$u = \\frac{U_2}{U_1}$\n$p = (\\gamma-1)\\left(U_3 - \\frac{1}{2}U_1\\left(\\frac{U_2}{U_1}\\right)^2\\right) = (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right)$。\n\n我们需要 $p$ 对 $U$ 各分量的偏导数：\n$\\frac{\\partial p}{\\partial U_1} = (\\gamma-1)\\left(- \\frac{U_2^2}{2}(-1)U_1^{-2}\\right) = \\frac{\\gamma-1}{2}\\left(\\frac{U_2}{U_1}\\right)^2 = \\frac{\\gamma-1}{2}u^2$。\n$\\frac{\\partial p}{\\partial U_2} = (\\gamma-1)\\left(-\\frac{2U_2}{2U_1}\\right) = -(\\gamma-1)\\frac{U_2}{U_1} = -(\\gamma-1)u$。\n$\\frac{\\partial p}{\\partial U_3} = \\gamma-1$。\n\n此外，我们用 $U$ 表示通量分量：\n$F_1 = U_2$\n$F_2 = \\frac{U_2^2}{U_1} + p = \\frac{U_2^2}{U_1} + (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right) = \\frac{3-\\gamma}{2}\\frac{U_2^2}{U_1} + (\\gamma-1)U_3$。\n$F_3 = u(E+p) = \\frac{U_2}{U_1}(U_3 + p)$。\n\n### 第1部分：通量雅可比矩阵 $A(U)$ 的推导\n\n通量雅可比矩阵是元素为 $A_{ij} = \\frac{\\partial F_i}{\\partial U_j}$ 的矩阵 $A(U)$。\n\n**第1列 ($j=1$):**\n$A_{11} = \\frac{\\partial F_1}{\\partial U_1} = \\frac{\\partial U_2}{\\partial U_1} = 0$。\n$A_{21} = \\frac{\\partial F_2}{\\partial U_1} = \\frac{3-\\gamma}{2}U_2^2(-1)U_1^{-2} = -\\frac{3-\\gamma}{2}u^2 = \\frac{\\gamma-3}{2}u^2$。\n$A_{31} = \\frac{\\partial (u(E+p))}{\\partial U_1} = \\frac{\\partial u}{\\partial U_1}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_1} + \\frac{\\partial p}{\\partial U_1}\\right)$。我们使用 $\\frac{\\partial u}{\\partial U_1} = -\\frac{U_2}{U_1^2} = -\\frac{u}{\\rho}$ 和 $\\frac{\\partial E}{\\partial U_1} = \\frac{\\partial U_3}{\\partial U_1}=0$。\n$A_{31} = -\\frac{u}{\\rho}(E+p) + u\\left(\\frac{\\gamma-1}{2}u^2\\right) = -uH + \\frac{\\gamma-1}{2}u^3 = u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)$。\n\n**第2列 ($j=2$):**\n$A_{12} = \\frac{\\partial F_1}{\\partial U_2} = \\frac{\\partial U_2}{\\partial U_2} = 1$。\n$A_{22} = \\frac{\\partial F_2}{\\partial U_2} = \\frac{3-\\gamma}{2}\\frac{2U_2}{U_1} = (3-\\gamma)u$。\n$A_{32} = \\frac{\\partial (u(E+p))}{\\partial U_2} = \\frac{\\partial u}{\\partial U_2}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_2} + \\frac{\\partial p}{\\partial U_2}\\right)$。我们使用 $\\frac{\\partial u}{\\partial U_2} = \\frac{1}{U_1} = \\frac{1}{\\rho}$ 和 $\\frac{\\partial E}{\\partial U_2} = 0$。\n$A_{32} = \\frac{1}{\\rho}(E+p) + u(-(\\gamma-1)u) = H - (\\gamma-1)u^2$。\n\n**第3列 ($j=3$):**\n$A_{13} = \\frac{\\partial F_1}{\\partial U_3} = \\frac{\\partial U_2}{\\partial U_3} = 0$。\n$A_{23} = \\frac{\\partial F_2}{\\partial U_3} = \\gamma-1$。\n$A_{33} = \\frac{\\partial (u(E+p))}{\\partial U_3} = u\\left(\\frac{\\partial E}{\\partial U_3} + \\frac{\\partial p}{\\partial U_3}\\right)$。我们使用 $\\frac{\\partial E}{\\partial U_3} = \\frac{\\partial U_3}{\\partial U_3} = 1$。\n$A_{33} = u(1 + (\\gamma-1)) = \\gamma u$。\n\n将这些分量组合起来，通量雅可比矩阵 $A(U)$ 是：\n$$A(U) = \\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}u^2  (3-\\gamma)u  \\gamma-1 \\\\ u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)  H - (\\gamma-1)u^2  \\gamma u \\end{pmatrix}$$\n\n### 第2部分：$A(U)$ 的特征值和右特征向量\n\n$A(U)$ 的特征值 $\\lambda$ 是特征方程 $\\det(A - \\lambda I) = 0$ 的根。右特征向量 $\\mathbf{k}$ 满足 $A\\mathbf{k} = \\lambda\\mathbf{k}$。\n已知欧拉方程的特征值为 $\\lambda = u, u \\pm c$。我们验证这一点并找出相应的特征向量。\n一个关键关系式，从 $H$ 和 $c$ 的定义推导得出，是 $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$。\n\n设 $\\mathbf{k} = \\begin{pmatrix} k_1 \\\\ k_2 \\\\ k_3 \\end{pmatrix}$。系统 $A\\mathbf{k} = \\lambda \\mathbf{k}$ 为：\n$1.$ $k_2 = \\lambda k_1$\n$2.$ $\\frac{\\gamma-3}{2}u^2 k_1 + (3-\\gamma)u k_2 + (\\gamma-1)k_3 = \\lambda k_2$\n$3.$ $u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)k_1 + (H - (\\gamma-1)u^2) k_2 + \\gamma u k_3 = \\lambda k_3$\n\n我们采用归一化 $k_1=1$。因此 $k_2 = \\lambda$。将此代入方程2：\n$(\\gamma-1)k_3 = \\lambda^2 - (3-\\gamma)u\\lambda - \\frac{\\gamma-3}{2}u^2$。\n代入方程3：\n$u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right) + (H - (\\gamma-1)u^2)\\lambda = (\\lambda-\\gamma u)k_3$。\n将这些结合起来得到 $\\lambda$ 的特征方程。令 $\\delta = \\lambda - u$，这个复杂的方程简化为 $\\delta(\\delta^2 - c^2) = 0$。其根为 $\\delta=0$ 和 $\\delta=\\pm c$，这意味着特征值为 $\\lambda_2=u$, $\\lambda_{1,3}=u\\mp c$。\n\n**特征值 $\\lambda_2 = u$:**\n当 $\\lambda=u$ 时，$k_1=1, k_2=u$。方程2变为：\n$\\frac{\\gamma-3}{2}u^2 + (3-\\gamma)u^2 + (\\gamma-1)k_3 = u^2 \\implies u^2(\\frac{\\gamma-3+6-2\\gamma-2}{2}) + (\\gamma-1)k_3 = 0 \\implies \\frac{1-\\gamma}{2}u^2 + (\\gamma-1)k_3 = 0$。\n对于 $\\gamma \\neq 1$，这给出 $k_3 = \\frac{1}{2}u^2$。\n特征向量是 $\\mathbf{k}_2 = \\begin{pmatrix} 1 \\\\ u \\\\ \\frac{1}{2}u^2 \\end{pmatrix}$。\n\n**特征值 $\\lambda_{1,3} = u \\mp c$:**\n当 $\\lambda = u\\mp c$ 时，我们有 $k_1=1, k_2=u\\mp c$。我们使用上面 $(\\gamma-1)k_3$ 的表达式来找到 $k_3$：\n$k_3 = \\frac{1}{\\gamma-1}\\left((u\\mp c)^2 - (3-\\gamma)u(u\\mp c) - \\frac{\\gamma-3}{2}u^2\\right)$\n$k_3 = \\frac{1}{\\gamma-1}\\left( (u^2 \\mp 2uc + c^2) - ((3-\\gamma)u^2 \\mp (3-\\gamma)uc) - \\frac{\\gamma-3}{2}u^2 \\right)$\n收集 $u, c$ 幂次的系数：\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(1 - (3-\\gamma) - \\frac{\\gamma-3}{2}) \\mp uc(2 - (3-\\gamma)) + c^2 \\right]$\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(\\frac{\\gamma-1}{2}) \\mp uc(\\gamma-1) + c^2 \\right] = \\frac{1}{2}u^2 \\mp uc + \\frac{c^2}{\\gamma-1}$。\n使用 $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$，我们有 $\\frac{c^2}{\\gamma-1} = H - \\frac{1}{2}u^2$。\n$k_3 = \\frac{1}{2}u^2 \\mp uc + H - \\frac{1}{2}u^2 = H \\mp uc$。\n得到的特征向量是：\n$\\mathbf{k}_1 = \\begin{pmatrix} 1 \\\\ u-c \\\\ H-uc \\end{pmatrix}$ 对应 $\\lambda_1 = u-c$。\n$\\mathbf{k}_3 = \\begin{pmatrix} 1 \\\\ u+c \\\\ H+uc \\end{pmatrix}$ 对应 $\\lambda_3 = u+c$。\n\n（注意：$u-c$ 和 $u+c$ 的特征向量顺序可以交换，但配对必须一致。）\n\n### 第3部分：特征多项式 $P(\\lambda)$\n\n按照约定 $P(\\lambda) = \\det(\\lambda I - A)$，特征多项式是一个首一多项式，其根是 $A$ 的特征值。给定特征值 $\\lambda_1 = u-c$，$\\lambda_2 = u$ 和 $\\lambda_3 = u+c$，该多项式可以写成因式分解的形式：\n$P(\\lambda) = (\\lambda - \\lambda_1)(\\lambda - \\lambda_2)(\\lambda - \\lambda_3)$\n$P(\\lambda) = (\\lambda - (u-c))(\\lambda - u)(\\lambda - (u+c))$\n\n这个表达式已经是用 $\\lambda, u$ 和 $c$ 表示的。根据题目允许，我们可以提供一个更能揭示其结构的、简化的、部分展开的形式。\n令 $\\delta = \\lambda - u$。表达式变为：\n$P(\\lambda) = (\\delta + c)(\\delta)(\\delta - c) = \\delta(\\delta^2 - c^2)$。\n将 $\\delta = \\lambda - u$ 代回，得到最终表达式：\n$P(\\lambda) = (\\lambda-u)((\\lambda-u)^2 - c^2)$。",
            "answer": "$$\\boxed{(\\lambda-u)((\\lambda-u)^2 - c^2)}$$"
        },
        {
            "introduction": "掌握了理论上的特征系统之后，我们现在可以将其应用于高分辨率格式中的一个关键步骤：空间重构。本练习  演示了如何将流体状态的变化投影到特征波上，应用限制器以防止非物理振荡，并在单元界面处重构状态。这是精确捕捉激波和接触间断等尖锐特征的核心技术，让你亲身体验理论如何转化为稳健的数值算法。",
            "id": "3510535",
            "problem": "考虑均匀网格上以原始变量 $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$ 写出的理想气体一维欧拉方程，其绝热指数为 $\\gamma$。从准线性原始变量形式出发，推导在给定状态下求值的原始变量雅可比矩阵的特征分解（特征值、左右特征向量）。然后，利用该分解对二阶分段线性有限体积重构进行特征投影和斜率限制。\n\n取元中心的原始状态（无量纲代码单位）为\n$\\boldsymbol{W}_{i-1} = (\\,1.3,\\, 0.3,\\, 1.3\\,)^{\\mathsf{T}}$、$\\boldsymbol{W}_{i} = (\\,1.0,\\, 0.2,\\, 1.0\\,)^{\\mathsf{T}}$ 和 $\\boldsymbol{W}_{i+1} = (\\,0.7,\\, 0.1,\\, 0.7\\,)^{\\mathsf{T}}$，其中 $\\gamma = 5/3$。在元 $i$ 处使用原始变量进行线性化。按如下方式在特征空间中逐分量应用特征投影和单调中心（MC）限制器。定义 $\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1}$、$\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i}$ 和 $\\Delta \\boldsymbol{W}_{C} = (\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1})/2$。通过元 $i$ 处的左特征向量矩阵 $\\boldsymbol{L}$ 将这些差值投影到特征分量上：\n$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{L}$、$\\boldsymbol{\\alpha}_{R} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{R}$ 和 $\\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{C}$。对于每个特征场 $k$，计算限制后的振幅\n$\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)$，其中如果 $a, b, c$ 符号相同，$\\mathrm{minmod}(a,b,c)$ 返回绝对值最小的参数，否则返回 $0$。通过\n$\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\tfrac{1}{2}\\,\\boldsymbol{R}\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}$ 重构界面 $x_{i+1/2}$ 处的左状态，其中 $\\boldsymbol{R}$ 是元 $i$ 处的右特征向量矩阵。\n\n使用此过程，计算 $x_{i+1/2}$ 处重构的左状态密度 $\\rho_{i+1/2,L}$。以无量纲代码单位报告您的答案，并将答案四舍五入到六位有效数字。\n\n在您的推导中，从守恒律及其准线性原始变量形式开始，论证特征分解的合理性，并解释在特征空间中进行限制的原理。最后，简要解释这种一维特征投影和限制过程如何推广到多于一个空间维度的多维非分裂 Godunov 格式（例如，如何处理面法向和横向特征）。\n\n您最终报告的量必须是单个实数（所要求的密度值）。",
            "solution": "分配的任务是使用带有特征限制的二阶分段线性有限体积法，计算单元界面处的重构密度。这需要推导一维欧拉方程的特征分解，并将指定的限制过程应用于给定的流体状态。\n\n### 1. 理论框架：特征分解\n\n理想气体的一维欧拉方程可以用原始变量 $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$ 表示，其中 $\\rho$ 是密度，$u$ 是流体速度，$p$ 是压力。该方程组以准线性形式表示为：\n$$\n\\frac{\\partial \\boldsymbol{W}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{W}) \\frac{\\partial \\boldsymbol{W}}{\\partial x} = 0\n$$\n为了找到雅可比矩阵 $\\boldsymbol{A}(\\boldsymbol{W})$，我们写出每个原始变量的平流方程。对于绝热流（沿流线的熵恒定），这些方程是：\n1.  质量守恒：$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 \\implies \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  动量守恒：$\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0$\n3.  熵守恒（绝热条件 $p \\propto \\rho^\\gamma$）：$\\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\rho c^2 \\frac{\\partial u}{\\partial x} = 0$，其中 $c = \\sqrt{\\gamma p / \\rho}$ 是绝热声速，$\\gamma$ 是绝热指数。\n\n将这些方程排列成矩阵形式，得到雅可比矩阵：\n$$\n\\boldsymbol{A} = \\begin{pmatrix} u  \\rho  0 \\\\ 0  u  1/\\rho \\\\ 0  \\rho c^2  u \\end{pmatrix}\n$$\n该系统是双曲型的，其行为由 $\\boldsymbol{A}$ 的特征系统决定。特征值 $\\lambda$ 是信息传播的特征速度。它们通过求解 $\\det(\\boldsymbol{A} - \\lambda\\boldsymbol{I}) = 0$ 找到：\n$$\n\\det \\begin{pmatrix} u-\\lambda  \\rho  0 \\\\ 0  u-\\lambda  1/\\rho \\\\ 0  \\rho c^2  u-\\lambda \\end{pmatrix} = (u-\\lambda)\\left( (u-\\lambda)^2 - c^2 \\right) = 0\n$$\n按速度排序的特征值为：\n$\\lambda_1 = u - c$（后向传播声波）\n$\\lambda_2 = u$（熵波/接触波）\n$\\lambda_3 = u + c$（前向传播声波）\n\n相应的右特征向量 $\\boldsymbol{r}_k$ 满足 $\\boldsymbol{A}\\boldsymbol{r}_k = \\lambda_k \\boldsymbol{r}_k$。一组标准的右特征向量是：\n$$\n\\boldsymbol{r}_1 = \\begin{pmatrix} \\rho \\\\ -c \\\\ \\rho c^2 \\end{pmatrix}, \\quad \\boldsymbol{r}_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\boldsymbol{r}_3 = \\begin{pmatrix} \\rho \\\\ c \\\\ \\rho c^2 \\end{pmatrix}\n$$\n右特征向量矩阵 $\\boldsymbol{R}$ 以这些向量为其列：$\\boldsymbol{R} = [\\boldsymbol{r}_1, \\boldsymbol{r}_2, \\boldsymbol{r}_3]$。\n\n左特征向量 $\\boldsymbol{l}_k$ 满足 $\\boldsymbol{l}_k^\\mathsf{T}\\boldsymbol{A} = \\lambda_k \\boldsymbol{l}_k^\\mathsf{T}$。它们构成了逆矩阵 $\\boldsymbol{L} = \\boldsymbol{R}^{-1}$ 的行，选择该矩阵使得 $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$。左特征向量为：\n$$\n\\boldsymbol{l}_1 = \\begin{pmatrix} 0,  -\\frac{1}{2c},  \\frac{1}{2\\rho c^2} \\end{pmatrix}, \\quad \\boldsymbol{l}_2 = \\begin{pmatrix} 1,  0,  -\\frac{1}{c^2} \\end{pmatrix}, \\quad \\boldsymbol{l}_3 = \\begin{pmatrix} 0,  \\frac{1}{2c},  \\frac{1}{2\\rho c^2} \\end{pmatrix}\n$$\n左特征向量矩阵是 $\\boldsymbol{L} = [\\boldsymbol{l}_1, \\boldsymbol{l}_2, \\boldsymbol{l}_3]^\\mathsf{T}$。\n\n### 2. 特征限制的原理\n\n在有限体积法中，高阶空间重构会在陡峭梯度（激波、接触间断）附近引入伪振荡。斜率限制器旨在通过减小重构斜率来抑制这些振荡。然而，变量 $(\\rho, u, p)$ 是物理耦合的。对它们进行逐分量限制可能不符合物理实际，因为它混合了以不同速度传播的信息。\n\n特征分解将系统对角化。状态的变化 $\\Delta \\boldsymbol{W}$ 可以投影到右特征向量的基上：$\\Delta \\boldsymbol{W} = \\sum_k \\alpha_k \\boldsymbol{r}_k$。系数 $\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\alpha_3)^\\mathsf{T} = \\boldsymbol{L} \\Delta\\boldsymbol{W}$ 是特征波的振幅。这些波独立演化，因此对每个特征振幅 $\\alpha_k$ 分别应用限制器在物理上更为稳健。这可以防止不同波族的混合，并得到更清晰、更稳定的结果。\n\n### 3. 数值计算\n\n**步骤 1：评估状态**\n我们使用状态 $\\boldsymbol{W}_{i} = (\\rho, u, p)^{\\mathsf{T}} = (1.0, 0.2, 1.0)^{\\mathsf{T}}$ 在元 $i$ 处对系统进行线性化。绝热指数为 $\\gamma = 5/3$。\n元 $i$ 处的声速为：\n$$\nc_i = \\sqrt{\\frac{\\gamma p_i}{\\rho_i}} = \\sqrt{\\frac{(5/3)(1.0)}{1.0}} = \\sqrt{\\frac{5}{3}}\n$$\n\n**步骤 2：计算差值**\n相邻元的状态为 $\\boldsymbol{W}_{i-1} = (1.3, 0.3, 1.3)^{\\mathsf{T}}$ 和 $\\boldsymbol{W}_{i+1} = (0.7, 0.1, 0.7)^{\\mathsf{T}}$。\n我们按照问题中的定义计算差分向量：\n$$\n\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1} = \\begin{pmatrix} 1.0 - 1.3 \\\\ 0.2 - 0.3 \\\\ 1.0 - 1.3 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i} = \\begin{pmatrix} 0.7 - 1.0 \\\\ 0.1 - 0.2 \\\\ 0.7 - 1.0 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{C} = \\frac{\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1}}{2} = \\frac{1}{2}\\begin{pmatrix} 0.7 - 1.3 \\\\ 0.1 - 0.3 \\\\ 0.7 - 1.3 \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} -0.6 \\\\ -0.2 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n初始数据位于一条直线上，因此所有三个差分向量都是相同的。\n\n**步骤 3：特征投影**\n我们使用在状态 $\\boldsymbol{W}_i$ 处求值的矩阵 $\\boldsymbol{L}$ 将这些差值投影到特征空间。由于 $\\Delta \\boldsymbol{W}_{L} = \\Delta \\boldsymbol{W}_{R} = \\Delta \\boldsymbol{W}_{C}$，它们的投影也将是相同的：$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{\\alpha}_{R} = \\boldsymbol{\\alpha}_{C}$。我们来计算这个向量，记为 $\\boldsymbol{\\alpha}$：\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{L}_i \\Delta \\boldsymbol{W}_{C}\n$$\n如下一步所示，计算完整的矩阵 $\\boldsymbol{L}_i$ 和向量 $\\boldsymbol{\\alpha}$ 对于最终结果是不必要的。\n\n**步骤 4：应用限制器并重构**\n单调中心（MC）限制器逐分量地应用于特征振幅：\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)\n$$\n由于 $\\alpha_{C,k} = \\alpha_{L,k} = \\alpha_{R,k}$，对于每个分量 $k$ 这可以简化为：\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{C,k},\\, 2\\,\\alpha_{C,k}\\right)\n$$\n具有相同符号的三个参数的 `minmod` 是绝对值最小的那个。在这里，即为 $\\alpha_{C,k}$。因此，限制后的振幅与未限制的中心差分振幅相同：\n$$\n\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C}\n$$\n在界面 $x_{i+1/2}$ 左侧的重构状态由下式给出：\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}\n$$\n代入 $\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C$：\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,(\\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C)\n$$\n由于 $\\boldsymbol{R}_i \\boldsymbol{L}_i = \\boldsymbol{I}$，表达式显著简化：\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\Delta\\boldsymbol{W}_C\n$$\n这个结果是预料之中的：对于直线上的数据，一个合理的重构方案应该能恢复该直线，且限制器不应被激活。\n\n**步骤 5：最终计算**\n我们代入数值：\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\frac{1}{2}\\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\begin{pmatrix} -0.15 \\\\ -0.05 \\\\ -0.15 \\end{pmatrix} = \\begin{pmatrix} 0.85 \\\\ 0.15 \\\\ 0.85 \\end{pmatrix}\n$$\n界面 $x_{i+1/2}$ 处的重构左状态密度是该向量的第一个分量：\n$$\n\\rho_{i+1/2,L} = 0.85\n$$\n按要求四舍五入到六位有效数字，答案是 $0.850000$。\n\n### 4. 推广到多维\n\n一维特征投影和限制过程是多维非分裂 Godunov 型格式的构建基础。在二维或三维网格的计算单元的每个面上，问题被局部地视为沿面法线方向的一维问题。\n1.  **面法向分解**：对于法向单位向量为 $\\boldsymbol{\\hat{n}}$ 的面，计算投影到该方向上的通量雅可比矩阵 $\\boldsymbol{A}_{\\boldsymbol{\\hat{n}}} = \\boldsymbol{A}\\cdot\\boldsymbol{\\hat{n}}$。然后使用该矩阵的特征系统。对于三维欧拉方程，这会产生五个特征波：两个垂直于面传播的声波（速度为 $u_n \\pm c$，其中 $u_n = \\boldsymbol{u}\\cdot\\boldsymbol{\\hat{n}}$）、一个熵波和两个剪切波。后三者都以法向流体速度 $u_n$ 传播。\n2.  **横向导数**：界面处一维黎曼问题的源项来自垂直于面法线方向的量梯度。这些项必须被考虑在内，通常通过称为横向传播校正的程序来处理。\n3.  **限制**：斜率限制也以逐个方向的方式执行。对于给定的面，原始变量的斜率被投影到面法线方向，并使用一维特征过程进行限制。更高级的格式使用多维限制来更好地保留流动特征的几何形状。\n\n这种在每个界面上采用的局部一维方法，使得为一维问题开发的稳健而精确的方法能够扩展到复杂的多维流动中。",
            "answer": "$$\n\\boxed{0.850000}\n$$"
        },
        {
            "introduction": "许多天体物理系统都涉及压力梯度与引力等外力之间的近乎完美平衡。一个标准的数值格式可能难以维持这种平衡，从而引入虚假的流动。最后一个练习  挑战你设计并验证一种“良好平衡”的格式，该格式能够将静力学平衡维持在机器精度水平，这是模拟恒星或星系盘等稳定天体的关键特性，也是处理带源项方程的高级技巧。",
            "id": "3510498",
            "problem": "您的任务是构建、解释并验证一种用于含重力的可压缩流体动力学的一维有限体积法 (FVM)，该方法在非均匀网格上对流体静力学平衡是精确良好平衡的。良好平衡属性指的是离散化方法能够将静态的流体静力学剖面维持在机器精度水平。控制方程为含重力势的一维 Euler 方程，其守恒形式使用状态变量网格平均质量密度 $\\rho$、动量 $m=\\rho u$ 和压力 $p$：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0, \\quad\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = -\\rho \\frac{\\partial \\Phi}{\\partial x},\n$$\n由正压状态方程封闭。流体静力学平衡由 $u(x)=0$ 和以下精确平衡关系定义：\n$$\n-\\frac{d p}{d x} = \\rho \\frac{d \\Phi}{d x}.\n$$\n您的方法必须满足以下要求：\n- 从 Euler 方程推导出一个离散化方案，该方案能在任意具有网格宽度 $\\Delta x_i = x_{i+1/2}-x_{i-1/2}$ 的非均匀网格上以离散形式维持流体静力学关系。\n- 引入并论证通量和源项的修正，以确保在流体静力学平衡状态下，即使在非均匀网格上，离散动量残差也能达到机器精度的零。\n- 采用声速 $c_s$ 为常数的正压等温闭合关系 $p=c_s^2 \\rho$，并指定一种重力压力 $P_g(x)$ 的构造方法，使得在流体静力学平衡中产生精确平衡的动量通量。\n\n在网格单元 $i$ 上的有限体积更新中的离散动量方程应具有以下结构：\n$$\n\\left.\\frac{d (\\rho u)_i}{dt}\\right|_{\\text{discrete}} = -\\frac{ \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} }{\\Delta x_i} + S_i,\n$$\n其中 $\\mathcal{F}_{i\\pm 1/2}$ 是界面通量，$S_i$ 是离散化的源项。请设计 $\\mathcal{F}_{i\\pm 1/2}$ 和 $S_i$，使得对于 $u=0$ 和 $-\\nabla p = \\rho \\nabla \\Phi$ 的流体静力学状态，网格残差恒为零。您的方法必须与以下连续恒等式一致：\n$$\np(x_{i+1/2}) - p(x_{i-1/2}) + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(x) \\,\\frac{d\\Phi}{dx}(x)\\,dx = 0.\n$$\n\n为使可测试的设计具体化，请对 $p=c_s^2 \\rho$ 的等温情况采用以下良好平衡的构造方法：\n1. 定义满足 $\\frac{d P_g}{d x} = \\rho \\frac{d \\Phi}{d x}$ 的重力压力 $P_g(x)$。\n2. 在界面处使用修正压力 $\\tilde{p}(x) := p(x) + P_g(x)$，并将离散源项设为零，这样在流体静力学平衡中 $\\tilde{p}$ 为常数，其离散散度在任何网格上都为零。\n3. 对于等温闭合关系和任何可微势，证明选择一个参考面位置 $x_{\\mathrm{ref}}$ 及其参考密度 $\\rho_{\\mathrm{ref}} := \\rho(x_{\\mathrm{ref}})$，可以得到闭合形式的重力压力：\n$$\nP_g(x) = c_s^2\\left(\\rho_{\\mathrm{ref}} - \\rho(x)\\right),\n$$\n这意味着 $\\tilde{p}(x) = c_s^2 \\rho_{\\mathrm{ref}}$，是一个常数。\n\n您的程序必须：\n- 通过显式指定面位置 $x_{i-1/2}$ 来构建非均匀网格。\n- 使用以下解析公式，为等温闭合关系精确初始化流体静力学密度 $\\rho(x)$ 和压力 $p(x)$：\n$$\n\\rho(x) = \\rho_{\\mathrm{ref}} \\exp\\left(-\\frac{\\Phi(x) - \\Phi(x_{\\mathrm{ref}})}{c_s^2}\\right), \\quad p(x) = c_s^2 \\rho(x).\n$$\n- 计算修正的界面通量 $\\tilde{p}(x_{i\\pm 1/2})$ 并评估离散动量残差：\n$$\nR^{\\text{mom}}_i = -\\frac{ \\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2} }{\\Delta x_i}.\n$$\n- 报告所有网格上的无量纲最大归一化残差：\n$$\n\\mathcal{R} := \\frac{\\max_i |R^{\\text{mom}}_i|}{\\max_j |p(x_{j+1/2})| / \\min_k \\Delta x_k},\n$$\n该值必须是一个浮点数。此归一化操作消除了物理单位，并将残差与一个特征压力梯度尺度进行比较。\n\n使用以下参数集测试套件来验证良好平衡属性：\n- 情况 A (理想情况，均匀重力，均匀网格)：\n    - 域长度 $L = 1.0$ 米，网格单元数 $N = 50$，网格类型为均匀网格。\n    - 重力势 $\\Phi(x) = g x$，其中 $g = 1.0$ 米/平方秒。\n    - 声速 $c_s = 1.0$ 米/秒，参考密度 $\\rho_{\\mathrm{ref}} = 1.0$ 千克/立方米，位于 $x_{\\mathrm{ref}} = 0$ 米处。\n- 情况 B (非均匀几何网格，较强重力)：\n    - 域长度 $L = 2.0$ 米，网格单元数 $N = 80$，网格类型为几何网格，网格宽度比 $r = 1.05$。\n    - 重力势 $\\Phi(x) = g x$，其中 $g = 5.0$ 米/平方秒。\n    - 声速 $c_s = 2.0$ 米/秒，参考密度 $\\rho_{\\mathrm{ref}} = 1.0$ 千克/立方米，位于 $x_{\\mathrm{ref}} = 0$ 米处。\n- 情况 C (随机非均匀网格，谐振子势)：\n    - 域长度 $L = 1.5$ 米，网格单元数 $N = 64$，网格类型为随机正宽度并归一化至 $L$。\n    - 重力势 $\\Phi(x) = \\frac{1}{2}\\Omega^2 (x - x_0)^2$，其中 $\\Omega = 3.0$ 弧度/秒，$x_0 = L/2$ 米。\n    - 声速 $c_s = 0.7$ 米/秒，参考密度 $\\rho_{\\mathrm{ref}} = 1.0$ 千克/立方米，位于 $x_{\\mathrm{ref}} = 0$ 米处。\n- 情况 D (边界情况，高度拉伸网格，均匀重力)：\n    - 域长度 $L = 1.0$ 米，网格单元数 $N = 32$，网格类型为几何网格，网格宽度比 $r = 1.2$。\n    - 重力势 $\\Phi(x) = g x$，其中 $g = 2.0$ 米/平方秒。\n    - 声速 $c_s = 1.5$ 米/秒，参考密度 $\\rho_{\\mathrm{ref}} = 1.0$ 千克/立方米，位于 $x_{\\mathrm{ref}} = 0$ 米处。\n\n您的程序必须生成单行输出，其中包含四个结果，按 [情况 A, 情况 B, 情况 C, 情况 D] 的顺序以逗号分隔的列表形式，并用方括号括起来。每个结果都必须是如上定义的浮点数 $\\mathcal{R}$。不允许有任何其他输出或文本。因为 $\\mathcal{R}$ 是一个无量纲量，所以最终的数值输出不需要单位说明。",
            "solution": "该问题要求构建并验证一种用于可压缩流体动力学 Euler 方程的一维有限体积法，该方法在非均匀网格上对等温流体静力学平衡是精确良好平衡的。\n\n首先，我将验证问题陈述的有效性。\n\n### 步骤 1：提取给定条件\n- **控制方程**：含重力势 $\\Phi(x)$ 的一维 Euler 方程以守恒形式给出：\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0\n    $$\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = -\\rho \\frac{\\partial \\Phi}{\\partial x}\n    $$\n- **状态变量**：网格平均质量密度 $\\rho$、动量 $m=\\rho u$ 和压力 $p$。\n- **状态方程**：正压等温闭合关系，$p=c_s^2 \\rho$，其中 $c_s$ 是常数声速。\n- **流体静力学平衡**：由零速度 $u(x)=0$ 以及压力梯度与重力之间的平衡定义：\n    $$\n    -\\frac{d p}{d x} = \\rho \\frac{d \\Phi}{d x}\n    $$\n- **有限体积离散化**：网格单元 $i$ 的半离散动量方程，宽度为 $\\Delta x_i = x_{i+1/2}-x_{i-1/2}$，结构如下：\n    $$\n    \\left.\\frac{d (\\rho u)_i}{dt}\\right|_{\\text{discrete}} = -\\frac{ \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} }{\\Delta x_i} + S_i\n    $$\n    其中 $\\mathcal{F}_{i\\pm 1/2}$ 是界面通量，$S_i$ 是网格平均源项。\n- **良好平衡要求**：$\\mathcal{F}$ 和 $S_i$ 的设计必须确保对于流体静力学状态，离散动量残差（离散方程的右侧）恒为零。\n- **连续积分条件**：设计必须与流体静力学平衡在一个网格单元上的积分形式一致：\n    $$\n    p(x_{i+1/2}) - p(x_{i-1/2}) + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(x) \\,\\frac{d\\Phi}{dx}(x)\\,dx = 0\n    $$\n- **指定的构造方法**：\n    1. 定义一个重力压力 $P_g(x)$，满足 $\\frac{d P_g}{d x} = \\rho \\frac{d \\Phi}{d x}$。\n    2. 在动量通量中使用修正压力 $\\tilde{p}(x) := p(x) + P_g(x)$，并将离散源项 $S_i$ 设为 $0$。\n    3. 对于等温情况，问题陈述指出 $P_g(x) = c_s^2\\left(\\rho_{\\mathrm{ref}} - \\rho(x)\\right)$，其中 $\\rho_{\\mathrm{ref}}$ 是在参考位置 $x_{\\mathrm{ref}}$ 的密度。这意味着 $\\tilde{p}(x)$ 是常数。\n- **解析解**：对于等温情况，流体静力学密度剖面为 $\\rho(x) = \\rho_{\\mathrm{ref}} \\exp\\left(-\\frac{\\Phi(x) - \\Phi(x_{\\mathrm{ref}})}{c_s^2}\\right)$。\n- **任务**：使用流体静力学状态的解析解，计算离散动量残差 $R^{\\text{mom}}_i = -\\frac{ \\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2} }{\\Delta x_i}$。\n- **验证度量**：报告最大归一化残差 $\\mathcal{R} := \\frac{\\max_i |R^{\\text{mom}}_i|}{\\max_j |p(x_{j+1/2})| / \\min_k \\Delta x_k}$。\n- **测试套件**：提供了四个具体的案例（A, B, C, D），分别具有不同的域大小 $L$、网格单元数 $N$、网格类型、重力势 $\\Phi(x)$、声速 $c_s$ 和参考密度 $\\rho_{\\mathrm{ref}}$。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题在科学和数学上是合理的。Euler 方程、流体静力学平衡的概念以及等温状态方程是流体动力学和天体物理学中的基本原理。良好平衡格式方法是计算流体动力学中一种标准的、重要技术，用于精确模拟近平衡流。所提出的方法将压力梯度和重力源项重构为修正压力的单个通量差，这是一种已知且有效的方法。\n\n对于等温情况的流体静力学密度剖面的推导是正确的。对 $p=c_s^2 \\rho$ 求导得到 $\\frac{dp}{dx} = c_s^2 \\frac{d\\rho}{dx}$。将其代入流体静力学条件 $-\\frac{dp}{dx} = \\rho\\frac{d\\Phi}{dx}$ 得到 $-c_s^2 \\frac{d\\rho}{dx} = \\rho\\frac{d\\Phi}{dx}$，或 $\\frac{1}{\\rho}\\frac{d\\rho}{dx} = -\\frac{1}{c_s^2}\\frac{d\\Phi}{dx}$。从参考点 $x_{\\mathrm{ref}}$ 到 $x$ 积分，即可得到所提供的 $\\rho(x)$ 的解析解。\n\n所提出的重力压力 $P_g(x) = c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x))$ 的导数为 $\\frac{dP_g}{dx} = -c_s^2 \\frac{d\\rho}{dx}$。使用上面导出的关系，这变为 $\\frac{dP_g}{dx} = -(-\\rho\\frac{d\\Phi}{dx}) = \\rho\\frac{d\\Phi}{dx}$，这正是所要求的条件。\n因此，修正压力为 $\\tilde{p}(x) = p(x) + P_g(x) = c_s^2\\rho(x) + c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x)) = c_s^2\\rho_{\\mathrm{ref}}$。这是一个常数。\n\n该问题是适定的。它要求执行一个具体的计算，并提供了所有必要的输入和一个明确定义的输出度量。测试案例被完全指定。其表述是自洽的、客观的，并且没有矛盾或含糊之处。\n\n### 步骤 3：结论与行动\n该问题是有效的。我现在将提供合理的解决方案。\n\n### 推导与方法实现\n\n良好平衡格式的核心原理是以这样一种方式离散化控制方程，即对于已知的平衡态，来自不同项（在此情况下是压力梯度和重力源）的截断误差能够精确地相互抵消。一个朴素的、或非平衡的有限体积离散化可能会将网格单元 $i$（从 $x_{i-1/2}$ 到 $x_{i+1/2}$）的动量方程近似为：\n$$\n\\frac{d (\\rho u)_i}{dt} = -\\frac{ (p_{i+1/2}) - (p_{i-1/2}) }{\\Delta x_i} - (\\rho_i) \\left(\\frac{d\\Phi}{dx}\\right)_i\n$$\n其中 $p_{i\\pm 1/2}$ 是从网格中心值重构的界面压力，而 $(\\rho \\frac{d\\Phi}{dx})_i$ 是一个网格平均源项。在流体静力学平衡中，$-\\frac{dp}{dx} = \\rho\\frac{d\\Phi}{dx}$。然而，压力梯度和源项的离散近似值不会精确满足这种平衡，导致非零的数值残差，从而可能产生伪速度。\n\n所规定的良好平衡方法巧妙地规避了这个问题。首先对动量方程进行解析重构。我们引入一个重力压力 $P_g(x)$ 来吸收重力源项，定义为 $\\frac{d P_g}{dx} = \\rho\\frac{d\\Phi}{dx}$。动量方程于是变为：\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} + \\frac{d P_g}{d x} = 0\n$$\n由于 $P_g$ 仅是 $x$ 的函数，我们可以写成 $\\frac{dP_g}{dx} = \\frac{\\partial P_g}{\\partial x}$，从而可以合并各项：\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p + P_g)}{\\partial x} = 0\n$$\n定义修正压力 $\\tilde{p}(x) = p(x) + P_g(x)$，方程简化为：\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + \\tilde{p})}{\\partial x} = 0\n$$\n这个修正后的动量方程现在是源项为零的守恒形式。在流体静力学状态下，即 $u=0$ 时，它简化为 $\\frac{\\partial \\tilde{p}}{\\partial x} = 0$。这意味着对于一个连续的流体静力学解，修正压力 $\\tilde{p}(x)$ 必须是一个常数。\n\n现在将有限体积离散化应用于这个重构后的方程。对于网格单元 $i$，通量平衡为：\n$$\n\\left.\\frac{d (\\rho u)_i}{dt}\\right|_{\\text{discrete}} = -\\frac{ (\\rho u^2 + \\tilde{p})_{i+1/2} - (\\rho u^2 + \\tilde{p})_{i-1/2} }{\\Delta x_i}\n$$\n我们正在测试一个 $u=0$ 的流体静力学状态。网格单元 $i$ 的数值动量残差变为：\n$$\nR^{\\text{mom}}_i = -\\frac{ \\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2} }{\\Delta x_i}\n$$\n为了评估这个残差，我们需要在网格界面 $x_{i\\pm 1/2}$ 处的 $\\tilde{p}$ 值。正如在验证过程中所确定的，对于等温情况 $p=c_s^2\\rho$，对 $P_g(x)$ 的适当选择导致 $\\tilde{p}(x) = c_s^2\\rho_{\\mathrm{ref}}$，这是一个空间常数。\n\n因此，当我们在任意两个界面位置 $x_{i-1/2}$ 和 $x_{i+1/2}$ 评估 $\\tilde{p}(x)$ 时，我们应该得到相同的值 $c_s^2\\rho_{\\mathrm{ref}}$。评估将使用完整表达式 $\\tilde{p}(x) = p(x) + P_g(x) = c_s^2\\rho(x) + c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x))$ 来完成。在浮点数运算中，该计算将产生 $\\tilde{p}_{i+1/2}$ 和 $\\tilde{p}_{i-1/2}$ 的值，这些值在机器精度范围内是相等的。因此，它们的差 $\\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2}$ 将是一个非常接近零的小数，从而得到的残差 $R^{\\text{mom}}_i$ 也将接近于零，而与网格间距 $\\Delta x_i$ 无关。这证明了良好平衡的特性。\n\n实现将通过对每个测试案例执行以下步骤来确认这一点：\n1.  构建可能非均匀的 $N+1$ 个面位置 $x_{f,j}$（对于 $j=0, \\dots, N$）的网格。这定义了 $N$ 个宽度为 $\\Delta x_i = x_{f,i+1} - x_{f,i}$ 的网格单元。\n2.  定义重力势函数 $\\Phi(x)$。\n3.  使用提供的解析解，在每个面位置 $x_{f,j}$ 处评估流体静力学密度 $\\rho(x)$ 和压力 $p(x)$。\n4.  在每个面上，计算修正压力 $\\tilde{p}(x_{f,j}) = p(x_{f,j}) + c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x_{f,j}))$。\n5.  对于每个网格单元 $i=0, \\dots, N-1$，计算残差 $R_i^{\\text{mom}} = -(\\tilde{p}_{f,i+1} - \\tilde{p}_{f,i})/\\Delta x_i$。\n6.  按照规定计算归一化的最大残差 $\\mathcal{R}$，对于成功的验证，其数量级应为机器精度（例如，约 $10^{-16}$）。",
            "answer": "$$\\boxed{[0.0, 0.0, 0.0, 0.0]}$$"
        }
    ]
}