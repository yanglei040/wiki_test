{
    "hands_on_practices": [
        {
            "introduction": "The foundation of modern Godunov-type schemes lies in understanding the wave structure inherent in the Euler equations. This practice is a foundational pen-and-paper exercise to derive the eigenvalues and eigenvectors of the flux Jacobian . Mastering this derivation provides direct insight into the physical nature of information propagation in a fluid—as sound waves and a contact wave—which is the key to constructing physically-motivated Riemann solvers.",
            "id": "3510528",
            "problem": "In the context of constructing approximate Riemann solvers for a finite volume method for astrophysical hydrodynamics, consider the one-dimensional compressible Euler equations in conservative form,\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\nwith conservative state vector $U = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$, flux $F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u\\,(E+p) \\end{pmatrix}$, and an ideal-gas equation of state $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$, where $\\rho$ is the mass density, $u$ is the velocity, $E$ is the total energy density, $p$ is the gas pressure, and $\\gamma$ is the ratio of specific heats. Define the total specific enthalpy $H = \\frac{E + p}{\\rho}$ and the adiabatic sound speed $c$ via $c^{2} = \\gamma p/\\rho$.\n\nStarting from these definitions alone, do the following:\n$1.$ Derive the flux Jacobian $A(U) = \\frac{\\partial F}{\\partial U}$ explicitly in terms of the conservative variables and the thermodynamic quantities $u$, $H$, and $c$.\n$2.$ Determine the three real eigenvalues of $A(U)$ and construct a linearly independent set of right eigenvectors corresponding to each eigenvalue. Adopt the normalization where the first component of each right eigenvector is unity.\n$3.$ Using your results, provide a closed-form expression for the characteristic polynomial $P(\\lambda)$ of the flux Jacobian in the convention $P(\\lambda) = \\det(\\lambda I - A)$, expressed solely in terms of the symbols $\\lambda$, $u$, and $c$.\n\nYour final reported answer must be the single analytic expression for $P(\\lambda)$ requested in part $3$. No numerical evaluation is required, and no units are to be given. If you choose to expand or factor the polynomial, either form is acceptable as long as it is algebraically correct and fully simplified.",
            "solution": "The problem requires a three-part derivation concerning the flux Jacobian of the one-dimensional compressible Euler equations. We will address each part in sequence.\n\nThe conservative state vector is $U = \\begin{pmatrix} U_1 \\\\ U_2 \\\\ U_3 \\end{pmatrix} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$, and the flux vector is $F(U) = \\begin{pmatrix} F_1 \\\\ F_2 \\\\ F_3 \\end{pmatrix} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2+p \\\\ u(E+p) \\end{pmatrix}$. The equation of state is $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$.\n\nFirst, we express the primitive variables $\\rho, u$ and the pressure $p$ in terms of the components of $U$:\n$\\rho = U_1$\n$u = \\frac{U_2}{U_1}$\n$p = (\\gamma-1)\\left(U_3 - \\frac{1}{2}U_1\\left(\\frac{U_2}{U_1}\\right)^2\\right) = (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right)$.\n\nWe will need the partial derivatives of $p$ with respect to the components of $U$:\n$\\frac{\\partial p}{\\partial U_1} = (\\gamma-1)\\left(- \\frac{U_2^2}{2}(-1)U_1^{-2}\\right) = \\frac{\\gamma-1}{2}\\left(\\frac{U_2}{U_1}\\right)^2 = \\frac{\\gamma-1}{2}u^2$.\n$\\frac{\\partial p}{\\partial U_2} = (\\gamma-1)\\left(-\\frac{2U_2}{2U_1}\\right) = -(\\gamma-1)\\frac{U_2}{U_1} = -(\\gamma-1)u$.\n$\\frac{\\partial p}{\\partial U_3} = \\gamma-1$.\n\nAlso, we express the flux components in terms of $U$:\n$F_1 = U_2$\n$F_2 = \\frac{U_2^2}{U_1} + p = \\frac{U_2^2}{U_1} + (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right) = \\frac{3-\\gamma}{2}\\frac{U_2^2}{U_1} + (\\gamma-1)U_3$.\n$F_3 = u(E+p) = \\frac{U_2}{U_1}(U_3 + p)$.\n\n### Part 1: Derivation of the Flux Jacobian $A(U)$\n\nThe flux Jacobian is the matrix $A(U)$ with elements $A_{ij} = \\frac{\\partial F_i}{\\partial U_j}$.\n\n**Column 1 ($j=1$):**\n$A_{11} = \\frac{\\partial F_1}{\\partial U_1} = \\frac{\\partial U_2}{\\partial U_1} = 0$.\n$A_{21} = \\frac{\\partial F_2}{\\partial U_1} = \\frac{3-\\gamma}{2}U_2^2(-1)U_1^{-2} = -\\frac{3-\\gamma}{2}u^2 = \\frac{\\gamma-3}{2}u^2$.\n$A_{31} = \\frac{\\partial (u(E+p))}{\\partial U_1} = \\frac{\\partial u}{\\partial U_1}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_1} + \\frac{\\partial p}{\\partial U_1}\\right)$. We use $\\frac{\\partial u}{\\partial U_1} = -\\frac{U_2}{U_1^2} = -\\frac{u}{\\rho}$ and $\\frac{\\partial E}{\\partial U_1} = \\frac{\\partial U_3}{\\partial U_1}=0$.\n$A_{31} = -\\frac{u}{\\rho}(E+p) + u\\left(\\frac{\\gamma-1}{2}u^2\\right) = -uH + \\frac{\\gamma-1}{2}u^3 = u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)$.\n\n**Column 2 ($j=2$):**\n$A_{12} = \\frac{\\partial F_1}{\\partial U_2} = \\frac{\\partial U_2}{\\partial U_2} = 1$.\n$A_{22} = \\frac{\\partial F_2}{\\partial U_2} = \\frac{3-\\gamma}{2}\\frac{2U_2}{U_1} = (3-\\gamma)u$.\n$A_{32} = \\frac{\\partial (u(E+p))}{\\partial U_2} = \\frac{\\partial u}{\\partial U_2}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_2} + \\frac{\\partial p}{\\partial U_2}\\right)$. We use $\\frac{\\partial u}{\\partial U_2} = \\frac{1}{U_1} = \\frac{1}{\\rho}$ and $\\frac{\\partial E}{\\partial U_2} = 0$.\n$A_{32} = \\frac{1}{\\rho}(E+p) + u(-(\\gamma-1)u) = H - (\\gamma-1)u^2$.\n\n**Column 3 ($j=3$):**\n$A_{13} = \\frac{\\partial F_1}{\\partial U_3} = \\frac{\\partial U_2}{\\partial U_3} = 0$.\n$A_{23} = \\frac{\\partial F_2}{\\partial U_3} = \\gamma-1$.\n$A_{33} = \\frac{\\partial (u(E+p))}{\\partial U_3} = u\\left(\\frac{\\partial E}{\\partial U_3} + \\frac{\\partial p}{\\partial U_3}\\right)$. We use $\\frac{\\partial E}{\\partial U_3} = \\frac{\\partial U_3}{\\partial U_3} = 1$.\n$A_{33} = u(1 + (\\gamma-1)) = \\gamma u$.\n\nAssembling these components, the flux Jacobian $A(U)$ is:\n$$A(U) = \\begin{pmatrix} 0  1  0 \\\\ \\frac{\\gamma-3}{2}u^2  (3-\\gamma)u  \\gamma-1 \\\\ u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)  H - (\\gamma-1)u^2  \\gamma u \\end{pmatrix}$$\n\n### Part 2: Eigenvalues and Right Eigenvectors of $A(U)$\n\nThe eigenvalues $\\lambda$ of $A(U)$ are the roots of the characteristic equation $\\det(A - \\lambda I) = 0$. The right eigenvectors $\\mathbf{k}$ satisfy $A\\mathbf{k} = \\lambda\\mathbf{k}$.\nThe eigenvalues of the Euler equations are known to be $\\lambda = u, u \\pm c$. We verify this and find the corresponding eigenvectors.\nA key relation, derived from the definitions of $H$ and $c$, is $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$.\n\nLet $\\mathbf{k} = \\begin{pmatrix} k_1 \\\\ k_2 \\\\ k_3 \\end{pmatrix}$. The system $A\\mathbf{k} = \\lambda \\mathbf{k}$ is:\n$1.$ $k_2 = \\lambda k_1$\n$2.$ $\\frac{\\gamma-3}{2}u^2 k_1 + (3-\\gamma)u k_2 + (\\gamma-1)k_3 = \\lambda k_2$\n$3.$ $u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)k_1 + (H - (\\gamma-1)u^2) k_2 + \\gamma u k_3 = \\lambda k_3$\n\nWe adopt the normalization $k_1=1$. Thus $k_2 = \\lambda$. Substituting this into equation $2$:\n$(\\gamma-1)k_3 = \\lambda^2 - (3-\\gamma)u\\lambda - \\frac{\\gamma-3}{2}u^2$.\nSubstituting into equation $3$:\n$u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right) + (H - (\\gamma-1)u^2)\\lambda = (\\lambda-\\gamma u)k_3$.\nCombining these gives the characteristic equation for $\\lambda$. Letting $\\delta = \\lambda - u$, this complicated equation simplifies to $\\delta(\\delta^2 - c^2) = 0$. The roots are $\\delta=0$ and $\\delta=\\pm c$, which gives the three eigenvalues $\\lambda_1=u-c$, $\\lambda_2=u$, and $\\lambda_3=u+c$.\n\n**Eigenvalue $\\lambda_2 = u$:**\nWith $\\lambda=u$, $k_1=1, k_2=u$. Equation $2$ becomes:\n$\\frac{\\gamma-3}{2}u^2 + (3-\\gamma)u^2 + (\\gamma-1)k_3 = u^2 \\implies u^2(\\frac{\\gamma-3+6-2\\gamma-2}{2}) + (\\gamma-1)k_3 = 0 \\implies \\frac{1-\\gamma}{2}u^2 + (\\gamma-1)k_3 = 0$.\nFor $\\gamma \\neq 1$, this gives $k_3 = \\frac{1}{2}u^2$.\nThe eigenvector is $\\mathbf{k}_2 = \\begin{pmatrix} 1 \\\\ u \\\\ \\frac{1}{2}u^2 \\end{pmatrix}$.\n\n**Eigenvalues $\\lambda_{1,3} = u \\mp c$:**\nWith $\\lambda = u\\mp c$, we have $k_1=1, k_2=u\\mp c$. We find $k_3$ using the expression for $(\\gamma-1)k_3$ above:\n$k_3 = \\frac{1}{\\gamma-1}\\left((u\\mp c)^2 - (3-\\gamma)u(u\\mp c) - \\frac{\\gamma-3}{2}u^2\\right)$\n$k_3 = \\frac{1}{\\gamma-1}\\left( (u^2 \\mp 2uc + c^2) - ((3-\\gamma)u^2 \\mp (3-\\gamma)uc) - \\frac{\\gamma-3}{2}u^2 \\right)$\nCollecting coefficients for powers of $u, c$:\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(1 - (3-\\gamma) - \\frac{\\gamma-3}{2}) \\mp uc(2 - (3-\\gamma)) + c^2 \\right]$\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(\\frac{\\gamma-1}{2}) \\mp uc(\\gamma-1) + c^2 \\right] = \\frac{1}{2}u^2 \\mp uc + \\frac{c^2}{\\gamma-1}$.\nUsing $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$, we have $\\frac{c^2}{\\gamma-1} = H - \\frac{1}{2}u^2$.\n$k_3 = \\frac{1}{2}u^2 \\mp uc + H - \\frac{1}{2}u^2 = H \\mp uc$.\nThe resulting eigenvectors are:\n$\\mathbf{k}_1 = \\begin{pmatrix} 1 \\\\ u-c \\\\ H-uc \\end{pmatrix}$ for $\\lambda_1 = u-c$.\n$\\mathbf{k}_3 = \\begin{pmatrix} 1 \\\\ u+c \\\\ H+uc \\end{pmatrix}$ for $\\lambda_3 = u+c$.\n\n### Part 3: Characteristic Polynomial $P(\\lambda)$\n\nThe characteristic polynomial, in the convention $P(\\lambda) = \\det(\\lambda I - A)$, is a monic polynomial whose roots are the eigenvalues of $A$. Given the eigenvalues $\\lambda_1 = u-c$, $\\lambda_2 = u$, and $\\lambda_3 = u+c$, the polynomial can be written in factored form as:\n$P(\\lambda) = (\\lambda - \\lambda_1)(\\lambda - \\lambda_2)(\\lambda - \\lambda_3)$\n$P(\\lambda) = (\\lambda - (u-c))(\\lambda - u)(\\lambda - (u+c))$\n\nThis expression is already in terms of $\\lambda, u,$ and $c$. As allowed, we can provide a simplified, partially expanded form which is more revealing of its structure.\nLet $\\delta = \\lambda - u$. The expression becomes:\n$P(\\lambda) = (\\delta + c)(\\delta)(\\delta - c) = \\delta(\\delta^2 - c^2)$.\nSubstituting $\\delta = \\lambda - u$ back gives the final expression:\n$P(\\lambda) = (\\lambda-u)((\\lambda-u)^2 - c^2)$.",
            "answer": "$$\\boxed{(\\lambda-u)((\\lambda-u)^2 - c^2)}$$"
        },
        {
            "introduction": "Building on the theoretical foundation of characteristic waves, this exercise transitions to a key practical challenge in high-order schemes: maintaining stability without sacrificing accuracy. You will apply the characteristic decomposition to perform slope limiting, a technique to prevent spurious oscillations near sharp features like shocks . This hands-on calculation demonstrates why limiting the amplitudes of the fundamental wave families independently is more physically robust than limiting the primitive variables directly.",
            "id": "3510535",
            "problem": "Consider the one-dimensional Euler equations for an ideal gas with adiabatic index $\\gamma$ written in primitive variables $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$ on a uniform mesh. Starting from the quasi-linear primitive-variable form, derive the characteristic decomposition (eigenvalues, right and left eigenvectors) of the primitive-variable Jacobian evaluated at a given state. Then use this to perform characteristic projection and slope limiting for a second-order, piecewise-linear, finite-volume reconstruction.\n\nTake the cell-centered primitive states (in dimensionless code units) to be\n$\\boldsymbol{W}_{i-1} = (\\,1.3,\\, 0.3,\\, 1.3\\,)^{\\mathsf{T}}$, $\\boldsymbol{W}_{i} = (\\,1.0,\\, 0.2,\\, 1.0\\,)^{\\mathsf{T}}$, and $\\boldsymbol{W}_{i+1} = (\\,0.7,\\, 0.1,\\, 0.7\\,)^{\\mathsf{T}}$, with $\\gamma = 5/3$. Work in primitive variables and linearize at cell $i$. Use characteristic projection and the Monotonized Central (MC) limiter applied componentwise in characteristic space as follows. Define $\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1}$, $\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i}$, and $\\Delta \\boldsymbol{W}_{C} = (\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1})/2$. Project these differences onto characteristic components via the left eigenvector matrix $\\boldsymbol{L}$ at cell $i$:\n$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{L}$, $\\boldsymbol{\\alpha}_{R} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{R}$, and $\\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{C}$. For each characteristic field $k$, compute the limited amplitude\n$\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)$, where $\\mathrm{minmod}(a,b,c)$ returns the argument of smallest magnitude if $a, b, c$ have the same sign, and returns $0$ otherwise. Reconstruct the left state at the interface $x_{i+1/2}$ by\n$\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\tfrac{1}{2}\\,\\boldsymbol{R}\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}$, where $\\boldsymbol{R}$ is the right eigenvector matrix at cell $i$.\n\nUsing this procedure, compute the reconstructed left-state density $\\rho_{i+1/2,L}$ at $x_{i+1/2}$. Report your answer in dimensionless code units and round your answer to six significant figures.\n\nIn your derivation, begin from the conservation laws and their quasi-linear primitive-variable form, justify the characteristic decomposition, and explain the rationale for limiting in characteristic space. Briefly explain, at the end, how this one-dimensional characteristic projection and limiting procedure generalizes to multidimensional unsplit Godunov schemes in more than one spatial dimension (for example, how to treat face-normal and transverse characteristics).\n\nYour final reported quantity must be a single real number (the requested density value).",
            "solution": "The assigned task is to compute a reconstructed density at a cell interface using a second-order, piecewise-linear, finite-volume method with characteristic limiting. This requires deriving the characteristic decomposition of the 1D Euler equations and applying the specified limiting procedure to the given fluid states.\n\n### 1. Theoretical Framework: Characteristic Decomposition\n\nThe one-dimensional Euler equations for an ideal gas can be written in terms of primitive variables $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$, where $\\rho$ is the density, $u$ is the fluid velocity, and $p$ is the pressure. The system is expressed in quasi-linear form as:\n$$\n\\frac{\\partial \\boldsymbol{W}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{W}) \\frac{\\partial \\boldsymbol{W}}{\\partial x} = 0\n$$\nTo find the Jacobian matrix $\\boldsymbol{A}(\\boldsymbol{W})$, we write out the advection equations for each primitive variable. For an adiabatic flow (constant entropy along streamlines), these are:\n1.  Mass conservation: $\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 \\implies \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  Momentum conservation: $\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0$\n3.  Entropy conservation (adiabatic condition $p \\propto \\rho^\\gamma$): $\\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\rho c^2 \\frac{\\partial u}{\\partial x} = 0$, where $c = \\sqrt{\\gamma p / \\rho}$ is the adiabatic sound speed and $\\gamma$ is the adiabatic index.\n\nArranging these into matrix form gives the Jacobian:\n$$\n\\boldsymbol{A} = \\begin{pmatrix} u  \\rho  0 \\\\ 0  u  1/\\rho \\\\ 0  \\rho c^2  u \\end{pmatrix}\n$$\nThe system is hyperbolic, and its behavior is governed by the eigensystem of $\\boldsymbol{A}$. The eigenvalues $\\lambda$ are the characteristic speeds at which information propagates. They are found by solving $\\det(\\boldsymbol{A} - \\lambda\\boldsymbol{I}) = 0$:\n$$\n\\det \\begin{pmatrix} u-\\lambda  \\rho  0 \\\\ 0  u-\\lambda  1/\\rho \\\\ 0  \\rho c^2  u-\\lambda \\end{pmatrix} = (u-\\lambda)\\left( (u-\\lambda)^2 - c^2 \\right) = 0\n$$\nThe eigenvalues, ordered by speed, are:\n$\\lambda_1 = u - c$ (backward-propagating acoustic wave)\n$\\lambda_2 = u$ (entropy/contact wave)\n$\\lambda_3 = u + c$ (forward-propagating acoustic wave)\n\nThe corresponding right eigenvectors $\\boldsymbol{r}_k$ satisfy $\\boldsymbol{A}\\boldsymbol{r}_k = \\lambda_k \\boldsymbol{r}_k$. A standard set of right eigenvectors is:\n$$\n\\boldsymbol{r}_1 = \\begin{pmatrix} \\rho \\\\ -c \\\\ \\rho c^2 \\end{pmatrix}, \\quad \\boldsymbol{r}_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\boldsymbol{r}_3 = \\begin{pmatrix} \\rho \\\\ c \\\\ \\rho c^2 \\end{pmatrix}\n$$\nThe matrix of right eigenvectors, $\\boldsymbol{R}$, has these vectors as its columns: $\\boldsymbol{R} = [\\boldsymbol{r}_1, \\boldsymbol{r}_2, \\boldsymbol{r}_3]$.\n\nThe left eigenvectors $\\boldsymbol{l}_k^\\mathsf{T}$ satisfy $\\boldsymbol{l}_k^\\mathsf{T}\\boldsymbol{A} = \\lambda_k \\boldsymbol{l}_k^\\mathsf{T}$. They form the rows of the inverse matrix $\\boldsymbol{L} = \\boldsymbol{R}^{-1}$, chosen such that $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$. The matrix of left eigenvectors is:\n$$\n\\boldsymbol{L} = \\begin{pmatrix} 0  -\\frac{1}{2c}  \\frac{1}{2\\rho c^2} \\\\ 1  0  -\\frac{1}{c^2} \\\\ 0  \\frac{1}{2c}  \\frac{1}{2\\rho c^2} \\end{pmatrix}\n$$\n\n### 2. Rationale for Characteristic Limiting\n\nIn finite volume methods, high-order spatial reconstruction can introduce spurious oscillations near sharp gradients (shocks, contacts). Slope limiters are designed to suppress these oscillations by reducing the reconstruction slope. However, the variables $(\\rho, u, p)$ are physically coupled. Limiting them component-wise can be unphysical, as it mixes information that propagates at different speeds.\n\nThe characteristic decomposition diagonalizes the system. A change in the state $\\Delta \\boldsymbol{W}$ can be projected onto the basis of right eigenvectors: $\\Delta \\boldsymbol{W} = \\sum_k \\alpha_k \\boldsymbol{r}_k$. The coefficients $\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\alpha_3)^\\mathsf{T} = \\boldsymbol{L} \\Delta\\boldsymbol{W}$ are the amplitudes of the characteristic waves. These waves evolve independently, so it is more physically robust to apply the limiter to each characteristic amplitude $\\alpha_k$ separately. This prevents mixing of different wave families and leads to sharper, more stable results.\n\n### 3. Numerical Calculation\n\n**Step 1: Evaluate State**\nWe linearize the system at cell $i$ using the state $\\boldsymbol{W}_{i} = (\\rho, u, p)^{\\mathsf{T}} = (1.0, 0.2, 1.0)^{\\mathsf{T}}$. The adiabatic index is $\\gamma = 5/3$.\nThe sound speed at cell $i$ is:\n$$\nc_i = \\sqrt{\\frac{\\gamma p_i}{\\rho_i}} = \\sqrt{\\frac{(5/3)(1.0)}{1.0}} = \\sqrt{\\frac{5}{3}}\n$$\n\n**Step 2: Compute Differences**\nThe neighboring cell states are $\\boldsymbol{W}_{i-1} = (1.3, 0.3, 1.3)^{\\mathsf{T}}$ and $\\boldsymbol{W}_{i+1} = (0.7, 0.1, 0.7)^{\\mathsf{T}}$.\nWe compute the difference vectors as defined in the problem:\n$$\n\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1} = \\begin{pmatrix} 1.0 - 1.3 \\\\ 0.2 - 0.3 \\\\ 1.0 - 1.3 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i} = \\begin{pmatrix} 0.7 - 1.0 \\\\ 0.1 - 0.2 \\\\ 0.7 - 1.0 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{C} = \\frac{\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1}}{2} = \\frac{1}{2}\\begin{pmatrix} 0.7 - 1.3 \\\\ 0.1 - 0.3 \\\\ 0.7 - 1.3 \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} -0.6 \\\\ -0.2 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\nThe initial data lie on a straight line, so all three difference vectors are identical.\n\n**Step 3: Characteristic Projection**\nWe project these differences into characteristic space using the matrix $\\boldsymbol{L}$ evaluated at state $\\boldsymbol{W}_i$. Since $\\Delta \\boldsymbol{W}_{L} = \\Delta \\boldsymbol{W}_{R} = \\Delta \\boldsymbol{W}_{C}$, their projections will also be identical:\n$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{\\alpha}_{R} = \\boldsymbol{\\alpha}_{C}$. Let's compute this vector, denoted $\\boldsymbol{\\alpha}$:\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{L}_i \\Delta \\boldsymbol{W}_{C}\n$$\nThe full calculation of this vector is unnecessary for the final result, as shown in the next step.\n\n**Step 4: Apply Limiter and Reconstruct**\nThe Monotonized Central (MC) limiter is applied component-wise to the characteristic amplitudes:\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)\n$$\nSince $\\alpha_{C,k} = \\alpha_{L,k} = \\alpha_{R,k}$, this simplifies for each component $k$:\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{C,k},\\, 2\\,\\alpha_{C,k}\\right)\n$$\nThe `minmod` of three arguments with the same sign is the one with the smallest magnitude. Here, that is $\\alpha_{C,k}$. Therefore, the limited amplitudes are identical to the unlimited central difference amplitudes:\n$$\n\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C}\n$$\nThe reconstructed state at the left side of the interface $x_{i+1/2}$ is given by:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}\n$$\nSubstituting $\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C$:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,(\\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C)\n$$\nSince $\\boldsymbol{R}_i \\boldsymbol{L}_i = \\boldsymbol{I}$, the expression simplifies significantly:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\Delta\\boldsymbol{W}_C\n$$\nThis result is expected: for data on a straight line, a reasonable reconstruction scheme should recover that line, and the limiter should not activate.\n\n**Step 5: Final Calculation**\nWe substitute the numerical values:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\frac{1}{2}\\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\begin{pmatrix} -0.15 \\\\ -0.05 \\\\ -0.15 \\end{pmatrix} = \\begin{pmatrix} 0.85 \\\\ 0.15 \\\\ 0.85 \\end{pmatrix}\n$$\nThe reconstructed left-state density at interface $x_{i+1/2}$ is the first component of this vector:\n$$\n\\rho_{i+1/2,L} = 0.85\n$$\nRounding to six significant figures as requested, the answer is $0.850000$.\n\n### 4. Generalization to Multiple Dimensions\n\nThe one-dimensional characteristic projection and limiting procedure is the building block for multidimensional unsplit Godunov-type schemes. At each face of a computational cell in a 2D or 3D mesh, the problem is treated locally as one-dimensional along the direction normal to the face.\n1.  **Face-Normal Decomposition**: For a face with normal unit vector $\\boldsymbol{\\hat{n}}$, one computes the flux Jacobian projected onto this direction, $\\boldsymbol{A}_{\\boldsymbol{\\hat{n}}} = \\boldsymbol{A}\\cdot\\boldsymbol{\\hat{n}}$. The eigensystem of this matrix is then used. For the 3D Euler equations, this results in five characteristic waves: two acoustic waves propagating normal to the face (with speeds $u_n \\pm c$, where $u_n = \\boldsymbol{u}\\cdot\\boldsymbol{\\hat{n}}$), an entropy wave, and two shear waves. The latter three all propagate with the normal fluid velocity $u_n$.\n2.  **Transverse Derivatives**: The source terms for the 1D Riemann problem at the interface arise from the gradients of quantities in the directions transverse to the face normal. These terms must be accounted for, often through a procedure known as transverse propagation correction.\n3.  **Limiting**: Slope limiting is also performed in a direction-by-direction manner. For a given face, the slopes of the primitive variables are projected onto the face-normal direction and limited using the 1D characteristic procedure. More advanced schemes use multidimensional limiting to better preserve the geometry of flow features.\n\nThis local, one-dimensional approach at each interface allows the robust and accurate methods developed for 1D problems to be extended to complex multidimensional flows.",
            "answer": "$$\n\\boxed{0.850000}\n$$"
        },
        {
            "introduction": "Astrophysical systems are often dominated by a near-perfect balance between pressure gradients and gravity. This practice tackles the advanced challenge of creating a \"well-balanced\" numerical scheme that can preserve this hydrostatic equilibrium to machine precision, a critical feature for stable, long-term simulations of stars and accretion disks . Through a guided coding exercise, you will implement and validate a method that reformulates the pressure flux and gravitational source term to eliminate the numerical errors that plague naive discretizations.",
            "id": "3510498",
            "problem": "You are asked to construct, explain, and validate a one-dimensional finite volume method (FVM) for compressible hydrodynamics with gravity that is exactly well-balanced for hydrostatic equilibrium on nonuniform grids. The well-balanced property means the discretization keeps stationary hydrostatic profiles to machine precision. The governing equations are the one-dimensional Euler equations with a gravitational potential, in conservative form with state variables cell-averaged mass density $\\rho$, momentum $m=\\rho u$, and pressure $p$:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0, \\quad\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = -\\rho \\frac{\\partial \\Phi}{\\partial x},\n$$\nclosed by a barotropic equation of state. Hydrostatic equilibrium is defined by $u(x)=0$ and the exact balance\n$$\n-\\frac{d p}{d x} = \\rho \\frac{d \\Phi}{d x}.\n$$\nYour method must satisfy the following requirements:\n- Derive from the Euler equations a discretization that maintains the hydrostatic relation in discrete form on an arbitrary nonuniform grid with cell widths $\\Delta x_i = x_{i+1/2}-x_{i-1/2}$.\n- Introduce and justify flux and source term modifications that ensure the discrete momentum residual vanishes in hydrostatic equilibrium to machine precision, even on nonuniform grids.\n- Adopt the barotropic isothermal closure $p=c_s^2 \\rho$ with constant sound speed $c_s$ and specify a construction of a gravitational pressure $P_g(x)$ that yields an exactly balanced momentum flux in hydrostatic equilibrium.\n\nThe discrete momentum equation in a finite volume update over cell $i$ should have the structure\n$$\n\\left.\\frac{d (\\rho u)_i}{dt}\\right|_{\\text{discrete}} = -\\frac{ \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} }{\\Delta x_i} + S_i,\n$$\nwhere $\\mathcal{F}_{i\\pm 1/2}$ are interface fluxes and $S_i$ is a discretized source. Design $\\mathcal{F}_{i\\pm 1/2}$ and $S_i$ so that for hydrostatic states with $u=0$ and $-\\frac{dp}{dx} = \\rho \\frac{d\\Phi}{dx}$, the cell-wise residual is identically zero. Your approach must be consistent with the continuous identity\n$$\np(x_{i+1/2}) - p(x_{i-1/2}) + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(x) \\,\\frac{d\\Phi}{dx}(x)\\,dx = 0.\n$$\n\nTo make the testable design concrete, employ the following well-balanced construction for the isothermal case $p=c_s^2 \\rho$:\n1. Define a gravitational pressure $P_g(x)$ satisfying $\\frac{d P_g}{d x} = \\rho \\frac{d \\Phi}{d x}$.\n2. Use the modified momentum flux $\\tilde{p}(x) := p(x) + P_g(x)$ at interfaces and set the discrete source to zero, so that in hydrostatic equilibrium $\\tilde{p}$ is constant and its discrete divergence vanishes on any grid.\n3. For the isothermal closure and any differentiable potential, show that choosing a reference face position $x_{\\mathrm{ref}}$ with reference density $\\rho_{\\mathrm{ref}} := \\rho(x_{\\mathrm{ref}})$ gives the closed-form gravitational pressure\n$$\nP_g(x) = c_s^2\\left(\\rho_{\\mathrm{ref}} - \\rho(x)\\right),\n$$\nwhich implies $\\tilde{p}(x) = c_s^2 \\rho_{\\mathrm{ref}}$, a constant.\n\nYour program must:\n- Construct nonuniform grids by explicit face positions $x_{i-1/2}$.\n- Initialize hydrostatic $\\rho(x)$ and $p(x)$ exactly for the isothermal closure using the analytical formula\n$$\n\\rho(x) = \\rho_{\\mathrm{ref}} \\exp\\left(-\\frac{\\Phi(x) - \\Phi(x_{\\mathrm{ref}})}{c_s^2}\\right), \\quad p(x) = c_s^2 \\rho(x).\n$$\n- Compute the modified interface flux $\\tilde{p}(x_{i\\pm 1/2})$ and evaluate the discrete momentum residual\n$$\nR^{\\text{mom}}_i = -\\frac{ \\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2} }{\\Delta x_i}.\n$$\n- Report the dimensionless maximum normalized residual over cells\n$$\n\\mathcal{R} := \\frac{\\max_i |R^{\\text{mom}}_i|}{\\max_j |p(x_{j+1/2})| / \\min_k \\Delta x_k},\n$$\nwhich must be a float. This normalization removes physical units and compares the residual to a characteristic pressure gradient scale.\n\nUse the following test suite of parameter sets to validate the well-balanced property:\n- Case A (happy path, uniform gravity, uniform grid):\n    - Domain length $L = 1.0$ meters, number of cells $N = 50$, grid type uniform.\n    - Gravitational potential $\\Phi(x) = g x$ with $g = 1.0$ meters per second squared.\n    - Sound speed $c_s = 1.0$ meters per second, reference density $\\rho_{\\mathrm{ref}} = 1.0$ kilograms per cubic meter at $x_{\\mathrm{ref}} = 0$ meters.\n- Case B (nonuniform geometric grid, stronger gravity):\n    - Domain length $L = 2.0$ meters, number of cells $N = 80$, grid type geometric with ratio $r = 1.05$ for cell widths.\n    - Gravitational potential $\\Phi(x) = g x$ with $g = 5.0$ meters per second squared.\n    - Sound speed $c_s = 2.0$ meters per second, reference density $\\rho_{\\mathrm{ref}} = 1.0$ kilograms per cubic meter at $x_{\\mathrm{ref}} = 0$ meters.\n- Case C (random nonuniform grid, harmonic potential):\n    - Domain length $L = 1.5$ meters, number of cells $N = 64$, grid type random positive widths normalized to $L$.\n    - Gravitational potential $\\Phi(x) = \\frac{1}{2}\\Omega^2 (x - x_0)^2$ with $\\Omega = 3.0$ radians per second and $x_0 = L/2$ meters.\n    - Sound speed $c_s = 0.7$ meters per second, reference density $\\rho_{\\mathrm{ref}} = 1.0$ kilograms per cubic meter at $x_{\\mathrm{ref}} = 0$ meters.\n- Case D (edge case, highly stretched grid, uniform gravity):\n    - Domain length $L = 1.0$ meters, number of cells $N = 32$, grid type geometric with ratio $r = 1.2$ for cell widths.\n    - Gravitational potential $\\Phi(x) = g x$ with $g = 2.0$ meters per second squared.\n    - Sound speed $c_s = 1.5$ meters per second, reference density $\\rho_{\\mathrm{ref}} = 1.0$ kilograms per cubic meter at $x_{\\mathrm{ref}} = 0$ meters.\n\nYour program must produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C, Case D]. Each result must be the float $\\mathcal{R}$ as defined above. No other output or text is permitted. Because $\\mathcal{R}$ is a dimensionless quantity, no unit specification is required for the final numerical outputs.",
            "solution": "### Derivation and Method Implementation\n\nThe core principle of a well-balanced scheme is to discretize the governing equations in a way that the truncation errors from different terms (in this case, the pressure gradient and the gravitational source) cancel each other out exactly for a known equilibrium state. A naive, or un-balanced, finite volume discretization might approximate the momentum equation for cell $i$ (from $x_{i-1/2}$ to $x_{i+1/2}$) as:\n$$\n\\frac{d (\\rho u)_i}{dt} = -\\frac{ (p_{i+1/2}) - (p_{i-1/2}) }{\\Delta x_i} - (\\rho_i) \\left(\\frac{d\\Phi}{dx}\\right)_i\n$$\nwhere $p_{i\\pm 1/2}$ are interface pressures reconstructed from cell-centered values, and $(\\rho \\frac{d\\Phi}{dx})_i$ is a cell-averaged source. In hydrostatic balance, $-\\frac{dp}{dx} = \\rho\\frac{d\\Phi}{dx}$. However, the discrete approximations for the pressure gradient and the source term will not satisfy this balance exactly, leading to a non-zero numerical residual that can generate spurious velocities.\n\nThe prescribed well-balanced approach elegantly circumvents this issue. The momentum equation is first analytically reformulated. We introduce a gravitational pressure $P_g(x)$ that absorbs the gravitational source term, defined by $\\frac{d P_g}{dx} = \\rho\\frac{d\\Phi}{dx}$. The momentum equation then becomes:\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} + \\frac{d P_g}{d x} = 0\n$$\nSince $P_g$ is a function of $x$ only, we can write $\\frac{dP_g}{dx} = \\frac{\\partial P_g}{\\partial x}$, allowing us to combine terms:\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p + P_g)}{\\partial x} = 0\n$$\nDefining the modified pressure $\\tilde{p}(x) = p(x) + P_g(x)$, the equation simplifies to:\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + \\tilde{p})}{\\partial x} = 0\n$$\nThis modified momentum equation is now in conservation form with a zero source term. In a hydrostatic state, where $u=0$, it reduces to $\\frac{\\partial \\tilde{p}}{\\partial x} = 0$. This implies that for a continuous hydrostatic solution, the modified pressure $\\tilde{p}(x)$ must be a constant.\n\nThe finite volume discretization is now applied to this reformulated equation. For cell $i$, the flux balance is:\n$$\n\\left.\\frac{d (\\rho u)_i}{dt}\\right|_{\\text{discrete}} = -\\frac{ (\\rho u^2 + \\tilde{p})_{i+1/2} - (\\rho u^2 + \\tilde{p})_{i-1/2} }{\\Delta x_i}\n$$\nWe are testing a hydrostatic state where $u=0$. The numerical momentum residual for cell $i$ becomes:\n$$\nR^{\\text{mom}}_i = -\\frac{ \\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2} }{\\Delta x_i}\n$$\nTo evaluate this residual, we need the value of $\\tilde{p}$ at the cell interfaces $x_{i\\pm 1/2}$. For the isothermal case $p=c_s^2\\rho$, an appropriate choice for $P_g(x)$ leads to $\\tilde{p}(x) = c_s^2\\rho_{\\mathrm{ref}}$, which is\na spatial constant.\n\nTherefore, when we evaluate $\\tilde{p}(x)$ at any two interface locations, $x_{i-1/2}$ and $x_{i+1/2}$, we should obtain the same value, $c_s^2\\rho_{\\mathrm{ref}}$. The evaluation will be done using the full expression $\\tilde{p}(x) = p(x) + P_g(x) = c_s^2\\rho(x) + c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x))$. In floating-point arithmetic, this calculation will yield values for $\\tilde{p}_{i+1/2}$ and $\\tilde{p}_{i-1/2}$ that are equal to within machine precision. Consequently, their difference, $\\tilde{p}_{i+1/2} - \\tilde{p}_{i-1/2}$, will be a very small number close to zero, and the resulting residual $R^{\\text{mom}}_i$ will be close to zero, regardless of the grid spacing $\\Delta x_i$. This demonstrates the well-balanced property.\n\nThe implementation will confirm this by performing the following steps for each test case:\n1.  Construct the possibly nonuniform grid of $N+1$ face positions $x_{f,j}$ for $j=0, \\dots, N$. This defines $N$ cells with widths $\\Delta x_i = x_{f,i+1} - x_{f,i}$.\n2.  Define the gravitational potential function $\\Phi(x)$.\n3.  Evaluate the hydrostatic density $\\rho(x)$ and pressure $p(x)$ at each face position $x_{f,j}$ using the provided analytical solution.\n4.  At each face, compute the modified pressure $\\tilde{p}(x_{f,j}) = p(x_{f,j}) + c_s^2(\\rho_{\\mathrm{ref}} - \\rho(x_{f,j}))$.\n5.  For each cell $i=0, \\dots, N-1$, compute the residual $R_i^{\\text{mom}} = -(\\tilde{p}_{f,i+1} - \\tilde{p}_{f,i})/\\Delta x_i$.\n6.  Calculate the normalized maximum residual $\\mathcal{R}$ as specified, which should be on the order of machine precision (e.g., $\\approx 10^{-16}$) for a successful validation.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residual(L, N, grid_type, grid_params, potential_func, cs, rho_ref, x_ref):\n    \"\"\"\n    Constructs a grid, initializes a hydrostatic state, and computes the \n    normalized momentum residual for a well-balanced scheme.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of cells.\n        grid_type (str): Type of grid ('uniform', 'geometric', 'random').\n        grid_params (dict): Parameters for the grid (e.g., geometric ratio 'r').\n        potential_func (callable): Gravitational potential function Phi(x).\n        cs (float): Isothermal sound speed.\n        rho_ref (float): Reference density.\n        x_ref (float): Reference position.\n\n    Returns:\n        float: The dimensionless maximum normalized residual, R.\n    \"\"\"\n    # Step 1: Construct the grid faces and cell widths.\n    # We define N cells, which means N+1 faces.\n    # The domain is [0, L]. Faces are at x_face[0], ..., x_face[N].\n    # Cell i is the interval [x_face[i], x_face[i+1]].\n    if grid_type == 'uniform':\n        x_face = np.linspace(0.0, L, N + 1, dtype=np.float64)\n    elif grid_type == 'geometric':\n        r = grid_params['r']\n        if r == 1.0:\n            # Fallback to uniform for r=1\n            cell_widths = np.full(N, L / N, dtype=np.float64)\n        else:\n            # dx_i = dx_0 * r^i. Sum dx_i = L.\n            dx0 = L * (r - 1) / (r**N - 1)\n            powers = np.arange(N, dtype=np.float64)\n            cell_widths = dx0 * r**powers\n        x_face = np.concatenate(([0.0], np.cumsum(cell_widths)))\n    elif grid_type == 'random':\n        # Use a fixed seed for reproducible randomness.\n        rng = np.random.RandomState(42)\n        random_widths = rng.rand(N)\n        cell_widths = (L / np.sum(random_widths)) * random_widths\n        x_face = np.concatenate(([0.0], np.cumsum(cell_widths)))\n    else:\n        raise ValueError(\"Unknown grid type\")\n    \n    # Ensure final face is exactly at L due to potential float precision issues\n    x_face[-1] = L\n    cell_widths = x_face[1:] - x_face[:-1]\n\n    # Step 2: Evaluate hydrostatic state and modified pressure at faces.\n    phi_ref_val = potential_func(np.array([x_ref], dtype=np.float64))[0]\n    \n    # Evaluate potential at face locations\n    phi_face = potential_func(x_face)\n    \n    # Evaluate density and pressure at faces using the exact hydrostatic solution\n    rho_face = rho_ref * np.exp(-(phi_face - phi_ref_val) / cs**2)\n    p_face = cs**2 * rho_face\n\n    # Step 3: Compute the modified pressure at each face.\n    # As derived, p_tilde(x) = p(x) + P_g(x) should be a constant analytically.\n    # We compute it numerically to test the cancellation.\n    # P_g(x) = c_s^2 * (rho_ref - rho(x))\n    # p_tilde(x) = p(x) + c_s^2 * (rho_ref - rho(x))\n    p_tilde_face = p_face + cs**2 * (rho_ref - rho_face)\n\n    # Step 4: Compute the momentum residuals for each cell.\n    # R_i = -(p_tilde_face[i+1] - p_tilde_face[i]) / dx_i\n    residuals = -(p_tilde_face[1:] - p_tilde_face[:-1]) / cell_widths\n\n    # Step 5: Compute the final dimensionless normalized residual metric R.\n    max_abs_residual = np.max(np.abs(residuals))\n    \n    # Normalization factor: characteristic pressure gradient\n    max_abs_p_face = np.max(np.abs(p_face))\n    min_dx = np.min(cell_widths)\n    \n    # Handle edge cases to prevent division by zero.\n    if min_dx = 0.0:\n        # This should not happen with a valid grid.\n        return np.inf\n    \n    norm_factor = max_abs_p_face / min_dx\n    \n    if norm_factor == 0.0:\n        # If pressure is zero everywhere (not true for these cases),\n        # the residual must also be zero for a finite result.\n        mathcal_R = 0.0 if max_abs_residual == 0.0 else np.inf\n    else:\n        mathcal_R = max_abs_residual / norm_factor\n        \n    return mathcal_R\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define test cases from the problem statement\n    test_cases = [\n        # Case A: happy path, uniform gravity, uniform grid\n        {\n            \"L\": 1.0, \"N\": 50, \"grid_type\": \"uniform\", \"grid_params\": {},\n            \"potential_func\": lambda x, g=1.0: g * x,\n            \"cs\": 1.0, \"rho_ref\": 1.0, \"x_ref\": 0.0\n        },\n        # Case B: nonuniform geometric grid, stronger gravity\n        {\n            \"L\": 2.0, \"N\": 80, \"grid_type\": \"geometric\", \"grid_params\": {\"r\": 1.05},\n            \"potential_func\": lambda x, g=5.0: g * x,\n            \"cs\": 2.0, \"rho_ref\": 1.0, \"x_ref\": 0.0\n        },\n        # Case C: random nonuniform grid, harmonic potential\n        {\n            \"L\": 1.5, \"N\": 64, \"grid_type\": \"random\", \"grid_params\": {},\n            \"potential_func\": lambda x, L=1.5, Omega=3.0: 0.5 * Omega**2 * (x - L/2)**2,\n            \"cs\": 0.7, \"rho_ref\": 1.0, \"x_ref\": 0.0\n        },\n        # Case D: edge case, highly stretched grid, uniform gravity\n        {\n            \"L\": 1.0, \"N\": 32, \"grid_type\": \"geometric\", \"grid_params\": {\"r\": 1.2},\n            \"potential_func\": lambda x, g=2.0: g * x,\n            \"cs\": 1.5, \"rho_ref\": 1.0, \"x_ref\": 0.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_residual(**case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}