{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的状态方程之前，我们必须首先掌握表征恒星气体的基本任务。平均分子量 $\\mu$ 提供了宏观质量密度与粒子数密度之间的关键联系，这对于应用理想气体定律至关重要。本练习  将指导您计算中性和完全电离状态下典型恒星成分的 $\\mu$ 值，展示电离状态如何显著改变气体性质。",
            "id": "3517168",
            "problem": "考虑一个类太阳混合物，其质量分数分别为：氢 $X=0.70$，氦 $Y=0.28$，以及所有更重元素（金属）$Z=0.02$。假设该气体遵循理想气体状态方程 (EOS)，并通过关系式 $P=\\rho k_{B} T / (\\mu m_{u})$ 定义每个粒子的平均分子量 $\\mu$。其中，$P$ 是气体压强，$\\rho$ 是质量密度，$T$ 是温度，$k_{B}$ 是玻尔兹曼常数，$m_{u}$ 是原子质量常数。通过 $n_{e}=\\rho/(\\mu_{e} m_{u})$ 定义电子平均分子量 $\\mu_{e}$，其中 $n_{e}$ 是自由电子数密度。定义中性极限为所有物质均为中性原子，完全电离极限为所有物质均为完全被剥离的原子核加上自由电子。对于重元素混合物，采用单一代表性物质，其原子质量数为 $A_{Z}=16$，核电荷数为 $Z_{Z}=8$，这与太阳丰度中典型的以氧为主的金属混合物一致。\n\n从上述定义和多组分混合物单位质量的粒子计数出发，推导在中性极限和完全电离极限下 $\\mu$ 的表达式，以及在这两种极限下 $\\mu_{e}$ 的表达式。然后，根据给定的 $X$、$Y$、$Z$、$A_{Z}$ 和 $Z_{Z}$ 对这些表达式进行数值计算。按 $(\\mu_{\\mathrm{neutral}}, \\mu_{\\mathrm{ionized}}, \\mu_{e,\\mathrm{neutral}}, \\mu_{e,\\mathrm{ionized}})$ 的顺序报告你的答案。将最终答案表示为无量纲数。将你的有限数值答案四舍五入到四位有效数字。",
            "solution": "问题要求我们推导并数值计算在两种极限情况（中性和完全电离）下，特定恒星气体混合物的每个粒子的平均分子量 $\\mu$ 和每个电子的平均分子量 $\\mu_e$。\n\n首先，我们必须验证问题陈述的有效性。\n**步骤1：提取已知条件**\n- 气体混合物质质量分数：氢 $X=0.70$，氦 $Y=0.28$，金属 $Z=0.02$。\n- 状态方程 (EOS)：$P=\\rho k_{B} T / (\\mu m_{u})$。\n- $\\mu_e$ 的定义：$n_{e}=\\rho/(\\mu_{e} m_{u})$。\n- 极限情况：中性（所有原子都是中性的）和完全电离（所有原子都被完全剥离）。\n- 代表性金属物质：原子质量数 $A_{Z}=16$，核电荷数 $Z_{Z}=8$。\n- 常数：玻尔兹曼常数 $k_B$，原子质量常数 $m_u$。\n- 要求输出：$(\\mu_{\\mathrm{neutral}}, \\mu_{\\mathrm{ionized}}, \\mu_{e,\\mathrm{neutral}}, \\mu_{e,\\mathrm{ionized}})$ 的数值，四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，使用了恒星天体物理学的标准定义。所提供的质量分数之和为 $1$ ($0.70+0.28+0.02=1.00$)，确保了自洽性。在天体物理模型中，用单一物质（氧）来代表金属组分是一种常见且有效的简化方法。所有必要信息都已提供，问题提法得当、客观，没有科学缺陷或歧义。\n\n**结论：** 问题有效。\n\n**表达式推导**\n\n平均分子量 $\\mu$ 由理想气体定律 $P = n_{total} k_B T$ 定义，其中 $n_{total}$ 是所有粒子（原子、原子核、电子）的总数密度。给定的状态方程 $P = \\frac{\\rho k_B T}{\\mu m_u}$ 意味着 $n_{total} = \\frac{\\rho}{\\mu m_u}$。因此，单位质量的粒子数为 $N_{total} = \\frac{n_{total}}{\\rho} = \\frac{1}{\\mu m_u}$。\n\n总粒子数密度可以写成重粒子（原子或原子核）数密度 $n_I$ 和自由电子数密度 $n_e$ 的和：\n$n_{total} = n_I + n_e$。\n除以质量密度 $\\rho$，我们得到单位质量的粒子数：\n$\\frac{n_{total}}{\\rho} = \\frac{n_I}{\\rho} + \\frac{n_e}{\\rho}$。\n使用 $\\mu$ 和 $\\mu_e$ 的定义，我们可以将其写为：\n$\\frac{1}{\\mu m_u} = \\frac{1}{\\mu_I m_u} + \\frac{1}{\\mu_e m_u}$，其中我们定义了重粒子的平均分子量 $\\mu_I$。\n这可以简化为一个关键关系式：\n$$ \\frac{1}{\\mu} = \\frac{1}{\\mu_I} + \\frac{1}{\\mu_e} $$\n\n对于质量分数为 $X_i$、原子质量数为 $A_i$ 的组分 $i$，其原子核的数密度为 $n_i = \\frac{X_i \\rho}{A_i m_u}$。重粒子（原子或原子核）的总数密度为 $n_I = \\sum_i n_i$。\n因此，$\\frac{n_I}{\\rho} = \\sum_i \\frac{X_i}{A_i m_u} = \\frac{1}{\\mu_I m_u}$。这给出了 $\\mu_I$ 的表达式：\n$$ \\frac{1}{\\mu_I} = \\sum_i \\frac{X_i}{A_i} $$\n这个表达式对中性和完全电离两种情况都有效，因为它只计算原子核（或原子）的数量。对于我们的氢 ($H$)、氦 ($He$) 和金属 ($Z$) 混合物，我们有：\n$$ \\frac{1}{\\mu_I} = \\frac{X}{A_H} + \\frac{Y}{A_{He}} + \\frac{Z}{A_Z} $$\n我们将使用氢 ($A_H \\approx 1$) 和氦 ($A_{He} \\approx 4$) 原子质量数的标准近似值。问题指定 $A_Z=16$。\n$$ \\frac{1}{\\mu_I} \\approx X + \\frac{Y}{4} + \\frac{Z}{16} $$\n\n现在我们推导所要求的四个量的表达式。\n\n**1. 中性极限下的平均分子量 ($\\mu_{\\mathrm{neutral}}$)**\n在中性极限下，没有自由电子，因此 $n_e=0$。根据定义 $n_e = \\rho/(\\mu_e m_u)$，这意味着 $1/\\mu_e = 0$。\n总粒子数仅由中性原子组成。因此，重粒子平均分子量 $\\mu_I$ 等于总平均分子量 $\\mu_{\\mathrm{neutral}}$。\n$$ \\frac{1}{\\mu_{\\mathrm{neutral}}} = \\frac{1}{\\mu_I} = X + \\frac{Y}{4} + \\frac{Z}{16} $$\n\n**2. 中性极限下的电子平均分子量 ($\\mu_{e,\\mathrm{neutral}}$)**\n如前所述，在中性极限下 $n_e=0$。这意味着单位质量的自由电子数为零。形式上，$1/\\mu_{e,\\mathrm{neutral}}=0$，这意味着 $\\mu_{e,\\mathrm{neutral}}$ 是无穷大。\n$$ \\mu_{e,\\mathrm{neutral}} \\to \\infty $$\n\n**3. 完全电离极限下的电子平均分子量 ($\\mu_{e,\\mathrm{ionized}}$)**\n在完全电离极限下，每个核电荷数为 $Z_i$ 的物质 $i$ 的原子核贡献 $Z_i$ 个自由电子。由物质 $i$ 贡献的单位质量的自由电子数为 $Z_i \\frac{X_i}{A_i m_u}$。\n单位质量的总自由电子数为 $\\frac{n_e}{\\rho} = \\sum_i \\frac{X_i Z_i}{A_i m_u}$。\n使用定义 $\\frac{n_e}{\\rho} = \\frac{1}{\\mu_e m_u}$，我们得到：\n$$ \\frac{1}{\\mu_{e,\\mathrm{ionized}}} = \\sum_i \\frac{X_i Z_i}{A_i} $$\n对于我们的混合物，其中 $Z_H=1$, $Z_{He}=2$, $Z_Z=8$：\n$$ \\frac{1}{\\mu_{e,\\mathrm{ionized}}} = \\frac{X Z_H}{A_H} + \\frac{Y Z_{He}}{A_{He}} + \\frac{Z Z_Z}{A_Z} \\approx \\frac{X(1)}{1} + \\frac{Y(2)}{4} + \\frac{Z(8)}{16} = X + \\frac{Y}{2} + \\frac{Z}{2} $$\n由于 $X+Y+Z=1$，这可以简化为：\n$$ \\frac{1}{\\mu_{e,\\mathrm{ionized}}} = X + \\frac{1-X}{2} = \\frac{2X+1-X}{2} = \\frac{1+X}{2} $$\n因此：\n$$ \\mu_{e,\\mathrm{ionized}} = \\frac{2}{1+X} $$\n\n**4. 完全电离极限下的平均分子量 ($\\mu_{\\mathrm{ionized}}$)**\n使用一般关系式 $\\frac{1}{\\mu} = \\frac{1}{\\mu_I} + \\frac{1}{\\mu_e}$，我们可以结合我们对 $\\mu_I$ (即 $1/\\mu_{\\mathrm{neutral}}$) 和 $\\mu_{e, \\mathrm{ionized}}$ 的结果。\n$$ \\frac{1}{\\mu_{\\mathrm{ionized}}} = \\frac{1}{\\mu_I} + \\frac{1}{\\mu_{e,\\mathrm{ionized}}} = \\left(X + \\frac{Y}{4} + \\frac{Z}{16}\\right) + \\left(X + \\frac{Y}{2} + \\frac{Z}{2}\\right) $$\n合并各项：\n$$ \\frac{1}{\\mu_{\\mathrm{ionized}}} = 2X + \\frac{3Y}{4} + \\frac{9Z}{16} $$\n这个表达式正确地考虑了原子核和自由电子。\n\n**数值计算**\n给定数值：$X=0.70$, $Y=0.28$, $Z=0.02$。我们还使用 $A_H=1$, $A_{He}=4$, $A_Z=16$, $Z_H=1$, $Z_{He}=2$ 和 $Z_Z=8$。\n\n- **$\\mu_{\\mathrm{neutral}}$**：\n$$ \\frac{1}{\\mu_{\\mathrm{neutral}}} = 0.70 + \\frac{0.28}{4} + \\frac{0.02}{16} = 0.70 + 0.07 + 0.00125 = 0.77125 $$\n$$ \\mu_{\\mathrm{neutral}} = \\frac{1}{0.77125} \\approx 1.296596... $$\n四舍五入到四位有效数字，$\\mu_{\\mathrm{neutral}} \\approx 1.297$。\n\n- **$\\mu_{\\mathrm{ionized}}$**：\n$$ \\frac{1}{\\mu_{\\mathrm{ionized}}} = 2(0.70) + \\frac{3(0.28)}{4} + \\frac{9(0.02)}{16} = 1.40 + \\frac{0.84}{4} + \\frac{0.18}{16} = 1.40 + 0.21 + 0.01125 = 1.62125 $$\n$$ \\mu_{\\mathrm{ionized}} = \\frac{1}{1.62125} \\approx 0.616808... $$\n四舍五入到四位有效数字，$\\mu_{\\mathrm{ionized}} \\approx 0.6168$。\n\n- **$\\mu_{e,\\mathrm{neutral}}$**：\n根据推导，该值为无穷大。\n$$ \\mu_{e,\\mathrm{neutral}} = \\infty $$\n\n- **$\\mu_{e,\\mathrm{ionized}}$**：\n使用简化表达式：\n$$ \\mu_{e,\\mathrm{ionized}} = \\frac{2}{1+X} = \\frac{2}{1+0.70} = \\frac{2}{1.7} \\approx 1.17647... $$\n四舍五入到四位有效数字，$\\mu_{e,\\mathrm{ionized}} \\approx 1.176$。\n\n按指定顺序 $(\\mu_{\\mathrm{neutral}}, \\mu_{\\mathrm{ionized}}, \\mu_{e,\\mathrm{neutral}}, \\mu_{e,\\mathrm{ionized}})$ 报告的最终数值为 $(1.297, 0.6168, \\infty, 1.176)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.297  0.6168  \\infty  1.176\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理想气体定律是一个常见的起点，它假设粒子自由运动，没有明显的相互作用。然而，在恒星内部的致密热等离子体中，这个假设可能会失效。本练习  介绍了库仑耦合参数 $\\Gamma$，这是一个强大的无量纲量，用于衡量静电势能与动能之比。通过它，您可以定量评估等离子体是处于弱耦合还是强耦合状态，并判断像德拜-休克尔这样的简单理论是否适用。",
            "id": "3517146",
            "problem": "一个富氦的恒星内部区域可以被建模为一个由氦核和电子组成的完全电离的经典等离子体。考虑一个由完全电离的氦组成的均匀等离子体，其电荷数 $Z=2$，质量数 $A=4$，质量密度 $\\rho=10^{5}\\,\\mathrm{g\\,cm^{-3}}$，温度 $T=10^{7}\\,\\mathrm{K}$。从离子库仑耦合参数的定义出发，即平均离子间距处特征离子-离子库仑势能与单个粒子热能之比，推导离子库仑耦合参数 $\\Gamma$ 用 $Z$、$\\rho$、$A$、$T$ 和基本常数表示的表达式。然后，假设电磁学采用高斯厘米-克-秒单位制，并且等离子体是完全电离的，对指定的等离子体数值计算 $\\Gamma$。最后，根据 $\\Gamma$ 的大小，评估德拜-休克尔（DH）理论在这些条件下对离子关联的适用性。\n\n将 $\\Gamma$ 的最终数值表示为一个无量纲数，并四舍五入到三位有效数字。",
            "solution": "问题陈述已经过验证，被认为是合理的。这是一个在计算天体物理学领域中提法恰当、有科学依据的问题，涉及与恒星内部条件相关的经典等离子体的状态方程。所有必要的参数都已提供，所提问题明确无误。\n\n该问题需要分三部分作答：首先，推导离子库仑耦合参数 $\\Gamma$ 的表达式；其次，根据给定条件对其进行数值计算；第三，根据计算结果评估德拜-休克尔（DH）理论的有效性。\n\n**第一部分：库仑耦合参数 $\\Gamma$ 的推导**\n\n离子的库仑耦合参数 $\\Gamma$ 定义为特征离子-离子库仑势能与特征单粒子热能之比。\n$$\n\\Gamma = \\frac{\\text{特征库仑势能}}{\\text{特征热能}}\n$$\n让我们分别分析分子和分母。\n\n在温度为 $T$ 的等离子体中，一个粒子的特征热能由 $k_B T$ 给出，其中 $k_B$ 是玻尔兹曼常数。\n\n特征库仑势能是两个离子在平均离子间距（我们记为 $r_s$）处的静电势能。该等离子体由完全电离的氦核组成，因此每个离子的电荷为 $q_i = Ze$，其中 $Z$ 是电荷数，$e$ 是元电荷。在高斯CGS单位制中，两个相距为 $r_s$ 的此类离子之间的库仑势能 $U$ 为：\n$$\nU = \\frac{(Ze)^2}{r_s}\n$$\n为了求出平均离子间距 $r_s$，我们首先确定离子数密度 $n_i$。等离子体的总质量密度为 $\\rho$。由于电子的质量与原子核的质量相比可以忽略不计，我们可以近似认为质量密度完全由离子贡献。单个氦离子的质量约为 $A m_u$，其中 $A$ 是质量数，$m_u$ 是原子质量单位。因此，离子数密度为：\n$$\nn_i = \\frac{\\rho}{A m_u}\n$$\n平均离子间距的一个标准约定是维格纳-赛兹半径 $r_s$，它是一个球体的半径，该球体的体积等于每个离子的体积 $1/n_i$。\n$$\n\\frac{4}{3}\\pi r_s^3 = \\frac{1}{n_i}\n$$\n解出 $r_s$ 得：\n$$\nr_s = \\left(\\frac{3}{4\\pi n_i}\\right)^{1/3}\n$$\n将 $n_i$ 的表达式代入 $r_s$ 的方程：\n$$\nr_s = \\left(\\frac{3 A m_u}{4\\pi \\rho}\\right)^{1/3}\n$$\n现在我们组合出 $\\Gamma$ 的表达式：\n$$\n\\Gamma = \\frac{U}{k_B T} = \\frac{(Ze)^2}{r_s k_B T}\n$$\n代入 $r_s$ 的表达式：\n$$\n\\Gamma = \\frac{(Ze)^2}{k_B T} \\left(\\frac{4\\pi \\rho}{3 A m_u}\\right)^{1/3}\n$$\n这就是所要求的用给定物理量和基本常数表示的离子库仑耦合参数 $\\Gamma$ 的表达式。\n\n**第二部分：$\\Gamma$ 的数值计算**\n\n给定以下数值：\n- 电荷数：$Z=2$\n- 质量数：$A=4$\n- 质量密度：$\\rho = 10^5 \\, \\mathrm{g\\,cm^{-3}}$\n- 温度：$T = 10^7 \\, \\mathrm{K}$\n\n我们使用以下CGS单位制下的基本常数：\n- 元电荷：$e \\approx 4.8032 \\times 10^{-10} \\, \\mathrm{esu}$\n- 玻尔兹曼常数：$k_B \\approx 1.3807 \\times 10^{-16} \\, \\mathrm{erg\\,K^{-1}}$\n- 原子质量单位：$m_u \\approx 1.6605 \\times 10^{-24} \\, \\mathrm{g}$\n\n首先，我们计算 $(Ze)^2 / (k_B T)$ 这一项：\n$$\n\\frac{(Ze)^2}{k_B T} = \\frac{(2 \\times 4.8032 \\times 10^{-10})^2 \\mathrm{erg}^2 \\mathrm{cm}^2}{(1.3807 \\times 10^{-16} \\, \\mathrm{erg\\,K^{-1}}) \\times (10^7 \\, \\mathrm{K})} \\approx \\frac{9.2283 \\times 10^{-19} \\, \\mathrm{erg\\,cm}}{1.3807 \\times 10^{-9} \\, \\mathrm{erg}} \\approx 6.6836 \\times 10^{-10} \\, \\mathrm{cm}\n$$\n接下来，我们计算与离子密度相关的项：\n$$\n\\left(\\frac{4\\pi \\rho}{3 A m_u}\\right)^{1/3} = \\left(\\frac{4\\pi \\times (10^5 \\, \\mathrm{g\\,cm^{-3}})}{3 \\times 4 \\times (1.6605 \\times 10^{-24} \\, \\mathrm{g})}\\right)^{1/3} = \\left(\\frac{4\\pi \\times 10^5}{12 \\times 1.6605 \\times 10^{-24}}\\right)^{1/3} \\, \\mathrm{cm^{-1}}\n$$\n$$\n\\approx \\left(\\frac{1.2566 \\times 10^6}{1.9926 \\times 10^{-23}}\\right)^{1/3} \\, \\mathrm{cm^{-1}} \\approx (6.3065 \\times 10^{28})^{1/3} \\, \\mathrm{cm^{-1}} \\approx 3.9804 \\times 10^9 \\, \\mathrm{cm^{-1}}\n$$\n最后，我们将这两个结果相乘得到 $\\Gamma$：\n$$\n\\Gamma \\approx (6.6836 \\times 10^{-10} \\, \\mathrm{cm}) \\times (3.9804 \\times 10^9 \\, \\mathrm{cm^{-1}}) \\approx 2.6603\n$$\n四舍五入到三位有效数字，数值为 $\\Gamma \\approx 2.66$。\n\n**第三部分：德拜-休克尔理论的适用性**\n\n德拜-休克尔（DH）理论是一种平均场理论，用于描述等离子体和电解质中的静电相互作用效应。DH理论的一个基本假设是系统是弱耦合的。这意味着粒子间的相互作用势能远小于它们的动能。\n\n库仑耦合参数 $\\Gamma$正是这个比率的精确度量。德拜-休克尔理论的有效性条件是 $\\Gamma \\ll 1$。\n\n在指定的氦等离子体案例中，我们计算出 $\\Gamma \\approx 2.66$。这个值并不远小于1；实际上，它大于1。这表明该等离子体不是弱耦合的。相反，它处于中度耦合区，其中离子间的平均库仑势能是其平均热动能的两倍多。\n\n因此，由于条件 $\\Gamma \\ll 1$ 被严重违反，德拜-休克尔理论的基本假设不成立。该理论不适用于描述这些等离子体条件下的离子关联。要准确描述等离子体的热力学性质，将需要更高级的理论模型或数值模拟，例如蒙特卡洛或分子动力学方法。",
            "answer": "$$\\boxed{2.66}$$"
        },
        {
            "introduction": "不透明度决定了辐射如何在恒星中流动，因此是恒星模型的关键组成部分。由于不透明度对频率有很强的依赖性，因此使用平均不透明度来简化辐射转移计算。这个高级练习  将挑战您探索普朗克和罗斯兰平均不透明度的物理意义，通过推导光学薄和光学厚区域的温度剖面，并通过计算验证哪种平均不透明度适用于各自的极限情况。",
            "id": "3517132",
            "problem": "要求您编写一个完整、可运行的程序，比较在一个球对称、静态、包围着中央黑体源的辐射包层中，分别在光学薄和光学厚极限下，使用 Planck 平均不透明度和 Rosseland 平均不透明度所产生的温度剖面。您的程序必须实现一个程序，为每个测试用例诊断在哪种平均不透明度下，在指定的光学深度条件下，能产生正确的径向温度剖面，并为每个测试用例返回一个表示诊断结果的整数代码。\n\n在恒星内部微观物理的背景下，假设以下物理标准设置和定义：\n\n- 假设依赖于频率的不透明度为幂律 $\\,\\kappa_{\\nu}(\\nu) = \\kappa_{0}\\left(\\nu/\\nu_{0}\\right)^{\\beta}\\,$，指数 $\\,\\beta > 0\\,$，其中 $\\,\\kappa_{0}\\,$ 和 $\\,\\nu_{0}\\,$ 是常数。气体密度剖面为 $\\,\\rho(r) = \\rho_{0}\\left(r/R_{\\mathrm{in}}\\right)^{-p}\\,$，指数 $\\,p \\ge 0\\,$，归一化常数 $\\,\\rho_{0}\\,$ 将由光学深度约束确定。半径范围为 $\\,r \\in [R_{\\mathrm{in}}, R_{\\mathrm{out}}]\\,$，其中 $\\,R_{\\mathrm{in}} > 0\\,$。\n- Planck 平均不透明度 $\\,\\kappa_{\\mathrm{P}}(T)\\,$ 定义为 $\\,\\kappa_{\\mathrm{P}}(T) = \\frac{\\int_{0}^{\\infty}\\kappa_{\\nu}(\\nu) B_{\\nu}(T)\\,d\\nu}{\\int_{0}^{\\infty}B_{\\nu}(T)\\,d\\nu}\\,$，其中 $\\,B_{\\nu}(T)\\,$ 是 Planck 函数。Rosseland 平均不透明度 $\\,\\kappa_{\\mathrm{R}}(T)\\,$ 定义为 $\\,\\frac{1}{\\kappa_{\\mathrm{R}}(T)} = \\frac{\\int_{0}^{\\infty}\\frac{1}{\\kappa_{\\nu}(\\nu)}\\,\\frac{\\partial B_{\\nu}(T)}{\\partial T}\\,d\\nu}{\\int_{0}^{\\infty}\\frac{\\partial B_{\\nu}(T)}{\\partial T}\\,d\\nu}\\,$。\n- 位于 $\\,r=0\\,$ 处的中央黑体源的光度为 $\\,L\\,$，有效温度为 $\\,T_{\\star}\\,$。真空光速为 $\\,c\\,$，辐射常数为 $\\,a\\,$，Stefan–Boltzmann 常数为 $\\,\\sigma = a c / 4\\,$。恒星半径 $\\,R_{\\star}\\,$ 满足 $\\,L = 4\\pi R_{\\star}^{2}\\sigma T_{\\star}^{4}\\,$。\n\n在两个独立的渐近区域中强制执行辐射平衡：\n\n- 在光学薄极限下，在每个半径 $\\,r\\,$ 处，对稀释的恒星辐射的吸收与局域热发射相平衡，吸收和发射均使用 Planck 平均不透明度，并使用适用于中央黑体源的几何稀释因子。该平衡是从辐射平衡和角稀释的第一性原理推导出来的。\n- 在光学厚极限下，辐射能通过扩散进行输运，其通量与辐射能量密度的梯度成正比，与 Rosseland 平均不透明度成反比。光度不随半径变化。\n\n对于每个测试用例，您必须执行以下操作：\n\n1. 使用指定的目标光学深度 $\\,\\tau_{\\mathrm{tot}}\\,$（相对于在固定参考温度 $\\,T_{\\mathrm{ref}}\\,$ 下计算的 Rosseland 平均值定义）来确定归一化常数 $\\,\\rho_{0}\\,$，通过施加\n$$\n\\tau_{\\mathrm{tot}} \\equiv \\int_{R_{\\mathrm{in}}}^{R_{\\mathrm{out}}}\\kappa_{\\mathrm{R}}(T_{\\mathrm{ref}})\\,\\rho(r)\\,dr.\n$$\n对于数值计算，假设在所有情况下 $\\,\\kappa_{\\mathrm{R}}(T_{\\mathrm{ref}}) = \\kappa_{\\mathrm{ref}}\\,$，其中 $\\,\\kappa_{\\mathrm{ref}} = 1\\,\\mathrm{cm^{2}\\,g^{-1}}\\,$。以 $\\mathrm{g\\,cm^{-3}}$ 为单位表示 $\\,\\rho_{0}\\,$。\n\n2. 在 $\\,r\\,$ 的对数间隔网格上计算两个温度剖面：\n   - 基于 Planck 平均不透明度和来自中央源的稀释黑体辐射场的光学薄辐射平衡剖面 $\\,T_{\\mathrm{thin}}(r)\\,$。\n   - 基于 Rosseland 平均不透明度和恒定光度的光学厚扩散剖面 $\\,T_{\\mathrm{thick}}(r)\\,$。\n\n   在两种情况下，都使用上述基本定律推导渐近幂律依赖关系 $\\,T(r) \\propto r^{-q}\\,$。然后，在 $\\,r \\in [R_{\\mathrm{in}}, R_{\\mathrm{out}}]\\,$ 上用任意但有限的归一化（斜率 $\\,q\\,$ 必须来自您的推导；归一化在估计斜率时会抵消）实例化合成剖面。至少使用 $\\,N = 128\\,$ 个径向网格点。\n\n3. 从每个剖面中，通过在网格上对 $\\,\\log_{10} T\\,$ 与 $\\,\\log_{10} r\\,$ 进行线性回归来估计斜率 $\\,q\\,$。\n\n4. 单独地，从第一性原理出发，仅用 $\\,\\beta\\,$ 和 $\\,p\\,$ 表示，推导解析的薄极限斜率 $\\,q_{\\mathrm{thin}}\\,$ 和解析的厚极限斜率 $\\,q_{\\mathrm{thick}}\\,$，假设 $\\,\\kappa_{\\nu}(\\nu) \\propto \\nu^{\\beta}\\,$ 和 $\\,\\rho(r) \\propto r^{-p}\\,$。\n\n5. 使用总 Rosseland 光学深度 $\\,\\tau_{\\mathrm{tot}}\\,$ 定义诊断规则：\n   - 如果 $\\,\\tau_{\\mathrm{tot}} \\le 0.1\\,$，则将该情况视为光学薄；计算绝对误差 $\\,\\varepsilon_{\\mathrm{P}} = \\left|q_{\\mathrm{thin,fit}} - q_{\\mathrm{thin}}\\right|\\,$ 和 $\\,\\varepsilon_{\\mathrm{R}} = \\left|q_{\\mathrm{thick,fit}} - q_{\\mathrm{thin}}\\right|\\,$，如果 $\\,\\varepsilon_{\\mathrm{P}}  \\varepsilon_{\\mathrm{R}}\\,$ 则返回整数 $\\,1\\,$，如果 $\\,\\varepsilon_{\\mathrm{R}}  \\varepsilon_{\\mathrm{P}}\\,$ 则返回整数 $\\,{-1}\\,$，如果 $\\,\\varepsilon_{\\mathrm{P}} = \\varepsilon_{\\mathrm{R}}\\,$ 则返回整数 $\\,0\\,$。\n   - 如果 $\\,\\tau_{\\mathrm{tot}} \\ge 10\\,$，则将该情况视为光学厚；计算 $\\,\\varepsilon_{\\mathrm{P}} = \\left|q_{\\mathrm{thin,fit}} - q_{\\mathrm{thick}}\\right|\\,$ 和 $\\,\\varepsilon_{\\mathrm{R}} = \\left|q_{\\mathrm{thick,fit}} - q_{\\mathrm{thick}}\\right|\\,$，如果 $\\,\\varepsilon_{\\mathrm{R}}  \\varepsilon_{\\mathrm{P}}\\,$ 则返回 $\\,{-1}\\,$，如果 $\\,\\varepsilon_{\\mathrm{P}}  \\varepsilon_{\\mathrm{R}}\\,$ 则返回 $\\,1\\,$，如果相等则返回 $\\,0\\,$。\n   - 如果 $\\,0.1  \\tau_{\\mathrm{tot}}  10\\,$，则返回 $\\,0\\,$（未确定），不进行斜率比较。\n\n物理和数值常数及单位：\n\n- 全程使用 cgs 单位制：长度单位 $\\,\\mathrm{cm}\\,$，质量密度单位 $\\,\\mathrm{g\\,cm^{-3}}\\,$，光度单位 $\\,\\mathrm{erg\\,s^{-1}}\\,$，温度单位 $\\,\\mathrm{K}\\,$，不透明度单位 $\\,\\mathrm{cm^{2}\\,g^{-1}}\\,$，时间单位 $\\,\\mathrm{s}\\,$。中央源的数值为 $\\,L = 3.828\\times 10^{33}\\,\\mathrm{erg\\,s^{-1}}\\,$，$\\,T_{\\star} = 5772\\,\\mathrm{K}\\,$。辐射常数为 $\\,a = 7.5657\\times 10^{-15}\\,\\mathrm{erg\\,cm^{-3}\\,K^{-4}}\\,$，光速为 $\\,c = 2.99792458\\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}\\,$。Stefan–Boltzmann 常数为 $\\,\\sigma = a c / 4\\,$。如果需要，您可以通过 $\\,L = 4\\pi R_{\\star}^{2}\\sigma T_{\\star}^{4}\\,$ 计算 $\\,R_{\\star}\\,$。\n\n测试套件：\n\n对于所有情况，使用 $\\,R_{\\mathrm{in}} = 10^{12}\\,\\mathrm{cm}\\,$，$\\,R_{\\mathrm{out}} = 10^{15}\\,\\mathrm{cm}\\,$，以及 $\\,\\kappa_{\\mathrm{ref}} = 1\\,\\mathrm{cm^{2}\\,g^{-1}}\\,$。测试用例以元组 $\\,(\\beta, p, \\tau_{\\mathrm{tot}}, T_{\\mathrm{ref}})\\,$ 的形式指定：\n\n- 情况 $\\,1\\,$（光学薄，理想情况）：$\\,(\\beta, p, \\tau_{\\mathrm{tot}}, T_{\\mathrm{ref}}) = (1.5, 1.0, 10^{-3}, 100)\\,$。\n- 情况 $\\,2\\,$（光学厚，理想情况）：$\\,(\\beta, p, \\tau_{\\mathrm{tot}}, T_{\\mathrm{ref}}) = (1.0, 2.0, 100, 1000)\\,$。\n- 情况 $\\,3\\,$（中间值，边界情况）：$\\,(\\beta, p, \\tau_{\\mathrm{tot}}, T_{\\mathrm{ref}}) = (2.0, 1.5, 1.0, 300)\\,$。\n- 情况 $\\,4\\,$（边界，厚极限阈值）：$\\,(\\beta, p, \\tau_{\\mathrm{tot}}, T_{\\mathrm{ref}}) = (1.0, 1.5, 10, 300)\\,$。\n\n答案规范：\n\n- 对于每个测试用例，输出必须是单个整数：如果根据指定的光学深度规则，Planck 平均不透明度的诊断更优，则为 $\\,1\\,$；如果 Rosseland 平均不透明度的诊断更优，则为 $\\,{-1}\\,$；如果未确定或相等，则为 $\\,0\\,$。\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$\\,\\left[\\mathrm{result}_{1},\\mathrm{result}_{2},\\mathrm{result}_{3},\\mathrm{result}_{4}\\right]\\,$）。不应打印任何其他文本。\n\n重要提示：推导必须从上面给出的定义以及基本的辐射平衡和扩散定律开始。不要假设任何非物理行为。所有量都必须使用指定的单位进行处理。最终输出是纯整数，因此在最终打印的行中是无单位的。确保数值稳定性，并为径向拟合使用至少 $\\,N = 128\\,$ 个网格点。",
            "solution": "我们从基本定义和守恒原理开始。微观不透明度假设遵循 $\\,\\kappa_{\\nu}(\\nu) = \\kappa_{0}(\\nu/\\nu_{0})^{\\beta}\\,$，其中 $\\,\\beta  0\\,$。Planck 平均不透明度为\n$$\n\\kappa_{\\mathrm{P}}(T) = \\frac{\\int_{0}^{\\infty}\\kappa_{\\nu}(\\nu) B_{\\nu}(T)\\,d\\nu}{\\int_{0}^{\\infty} B_{\\nu}(T)\\,d\\nu},\n$$\nRosseland 平均不透明度为\n$$\n\\frac{1}{\\kappa_{\\mathrm{R}}(T)} = \\frac{\\int_{0}^{\\infty}\\kappa_{\\nu}^{-1}(\\nu)\\,\\frac{\\partial B_{\\nu}(T)}{\\partial T}\\,d\\nu}{\\int_{0}^{\\infty}\\frac{\\partial B_{\\nu}(T)}{\\partial T}\\,d\\nu}.\n$$\nPlanck 函数是 $\\,B_{\\nu}(T) = \\frac{2 h \\nu^{3}}{c^{2}}\\left[\\exp\\left(\\frac{h\\nu}{k_{\\mathrm{B}}T}\\right) - 1\\right]^{-1}\\,$，其中 $\\,h\\,$ 是 Planck 常数，$\\,k_{\\mathrm{B}}\\,$ 是 Boltzmann 常数，$\\,c\\,$ 是光速。\n\n幂律不透明度的关键标度关系：定义 $\\,x \\equiv h\\nu/(k_{\\mathrm{B}}T)\\,$。那么 $\\,\\nu = (k_{\\mathrm{B}}T/h)\\,x\\,$ 并且 $\\,d\\nu \\propto T\\,dx\\,$。对于 $\\,\\kappa_{\\nu} \\propto \\nu^{\\beta}\\,$，$\\,\\kappa_{\\mathrm{P}}(T)\\,$ 和 $\\,\\kappa_{\\mathrm{R}}(T)\\,$ 都与 $\\,T^{\\beta}\\,$ 成比例，因为对 $\\,x\\,$ 的积分会分解出一个 $\\,T^{\\beta}\\,$ 的依赖关系，而 $\\,x\\,$ 的无量纲积分与 $\\,T\\,$ 无关。因此，\n$$\n\\kappa_{\\mathrm{P}}(T) \\propto T^{\\beta},\\quad \\kappa_{\\mathrm{R}}(T) \\propto T^{\\beta}.\n$$\n比例常数不同，但下面推导指数只需要温度标度关系。\n\n光学薄辐射平衡：在半径 $\\,r \\gg R_{\\star}\\,$ 处，由中央黑体引起的平均强度为 $\\,J_{\\nu}(r) \\approx W(r)\\,B_{\\nu}(T_{\\star})\\,$，其中 $\\,W(r)\\,$ 是几何稀释因子，对于 $\\,r \\gg R_{\\star}\\,$，$\\,W(r) \\approx \\left(R_{\\star}/2r\\right)^{2}\\,$。在光学薄极限下，一个气体微元的辐射平衡表明，对外部辐射的吸收等于发射：\n$$\n\\int_{0}^{\\infty} \\kappa_{\\nu}(\\nu)\\,4\\pi J_{\\nu}(r)\\,d\\nu = \\int_{0}^{\\infty} \\kappa_{\\nu}(\\nu)\\,4\\pi B_{\\nu}(T)\\,d\\nu.\n$$\n使用 Planck 平均不透明度的定义，上式变为\n$$\n4\\pi\\,\\kappa_{\\mathrm{P}}(T_{\\star})\\,J(r) = 4\\pi\\,\\kappa_{\\mathrm{P}}(T)\\,B(T),\n$$\n其中 $\\,J(r) = \\int_{0}^{\\infty}J_{\\nu}(r)\\,d\\nu = W(r)\\,\\int_{0}^{\\infty}B_{\\nu}(T_{\\star})\\,d\\nu = W(r)\\,\\frac{\\sigma}{\\pi}T_{\\star}^{4}\\,$ 且 $\\,B(T) = \\int_{0}^{\\infty} B_{\\nu}(T)\\,d\\nu = \\frac{\\sigma}{\\pi}T^{4}\\,$。消去公因数得到\n$$\n\\kappa_{\\mathrm{P}}(T_{\\star})\\,W(r)\\,T_{\\star}^{4} = \\kappa_{\\mathrm{P}}(T)\\,T^{4}.\n$$\n使用 $\\,\\kappa_{\\mathrm{P}}(T) \\propto T^{\\beta}\\,$ 和 $\\,W(r) \\propto r^{-2}\\,$，我们发现\n$$\nT^{4+\\beta} \\propto r^{-2}\\,T_{\\star}^{4+\\beta},\n$$\n因此，光学薄渐近温度剖面标度关系为\n$$\nT_{\\mathrm{thin}}(r) \\propto r^{-q_{\\mathrm{thin}}},\\quad q_{\\mathrm{thin}} = \\frac{2}{4+\\beta}.\n$$\n\n光学厚扩散：在扩散近似中，辐射通量为 $\\,F = -\\frac{c}{3\\kappa_{\\mathrm{R}}(T)\\rho(r)}\\nabla E_{\\mathrm{rad}}\\,$，其中辐射能量密度 $\\,E_{\\mathrm{rad}} = aT^{4}\\,$。在球对称且光度恒为 $\\,L = 4\\pi r^{2}F\\,$ 的情况下，我们有\n$$\nL = -4\\pi r^{2}\\,\\frac{c}{3\\kappa_{\\mathrm{R}}(T)\\rho(r)}\\,\\frac{d}{dr}\\left(aT^{4}\\right) = -\\frac{16\\pi a c r^{2}}{3\\kappa_{\\mathrm{R}}(T)\\rho(r)}\\,T^{3}\\,\\frac{dT}{dr}.\n$$\n设 $\\,\\kappa_{\\mathrm{R}}(T) \\propto T^{\\beta}\\,$ 且 $\\,\\rho(r) \\propto r^{-p}\\,$。寻找幂律解 $\\,T(r) \\propto r^{-q}\\,$，这意味着 $\\,dT/dr = -q\\,T/r\\,$。代入后我们发现\n$$\nL = \\frac{16\\pi a c}{3}\\,\\frac{q}{\\kappa_{\\mathrm{R}}(T)\\rho(r)}\\,r\\,T^{4} \\propto r\\,\\frac{T^{4-\\beta}}{r^{-p}} = r^{1+p}\\,T^{4-\\beta}.\n$$\n为了使 $\\,L\\,$ 与 $\\,r\\,$ 无关，我们需要 $\\,r^{1+p}\\,T^{4-\\beta} = \\mathrm{const}\\,$，因此\n$$\nT_{\\mathrm{thick}}(r) \\propto r^{-q_{\\mathrm{thick}}},\\quad q_{\\mathrm{thick}} = \\frac{1+p}{4-\\beta}.\n$$\n\n光学深度归一化：在固定参考温度 $\\,T_{\\mathrm{ref}}\\,$ 下，总 Rosseland 光学深度为\n$$\n\\tau_{\\mathrm{tot}} = \\int_{R_{\\mathrm{in}}}^{R_{\\mathrm{out}}}\\kappa_{\\mathrm{R}}(T_{\\mathrm{ref}})\\,\\rho_{0}\\left(\\frac{r}{R_{\\mathrm{in}}}\\right)^{-p}\\,dr = \\kappa_{\\mathrm{R}}(T_{\\mathrm{ref}})\\,\\rho_{0}\\,R_{\\mathrm{in}}\\,\\int_{1}^{R_{\\mathrm{out}}/R_{\\mathrm{in}}} x^{-p}\\,dx,\n$$\n其中 $\\,x \\equiv r/R_{\\mathrm{in}}\\,$。对于 $\\,p \\ne 1\\,$，积分为 $\\,\\left[(x^{1-p}-1)/(1-p)\\right]\\,$；对于 $\\,p=1\\,$，积分为 $\\,\\ln(x)\\,$。给定 $\\,\\kappa_{\\mathrm{R}}(T_{\\mathrm{ref}}) = \\kappa_{\\mathrm{ref}}\\,$，我们解出 $\\,\\rho_{0}\\,$：\n$$\n\\rho_{0} = \\frac{\\tau_{\\mathrm{tot}}}{\\kappa_{\\mathrm{ref}}\\,R_{\\mathrm{in}}\\,I_{p}},\\quad I_{p} =\n\\begin{cases}\n\\frac{(R_{\\mathrm{out}}/R_{\\mathrm{in}})^{1-p}-1}{1-p},  p \\ne 1,\\\\\n\\ln\\left(R_{\\mathrm{out}}/R_{\\mathrm{in}}\\right),  p=1.\n\\end{cases}\n$$\n\n程序的算法设计：\n\n1. 对每个测试用例，根据 $\\,\\tau_{\\mathrm{tot}}\\,$, $\\,\\kappa_{\\mathrm{ref}}\\,$, $\\,R_{\\mathrm{in}}\\,$, $\\,R_{\\mathrm{out}}\\,$ 和 $\\,p\\,$ 使用上述积分计算 $\\,\\rho_{0}\\,$。这以物理上一致的方式确认了每个用例的光学深度区域。\n\n2. 在 $\\,r\\,$ 上构建一个具有 $\\,N \\ge 128\\,$ 个点的对数间隔网格。使用推导出的指数 $\\,q_{\\mathrm{thin}} = 2/(4+\\beta)\\,$ 和 $\\,q_{\\mathrm{thick}} = (1+p)/(4-\\beta)\\,$，实例化两个合成的幂律剖面\n$$\nT_{\\mathrm{thin}}(r) = T_{0,\\mathrm{thin}}\\left(\\frac{r}{R_{\\mathrm{in}}}\\right)^{-q_{\\mathrm{thin}}},\\quad\nT_{\\mathrm{thick}}(r) = T_{0,\\mathrm{thick}}\\left(\\frac{r}{R_{\\mathrm{in}}}\\right)^{-q_{\\mathrm{thick}}},\n$$\n使用任意有限的归一化常数 $\\,T_{0,\\mathrm{thin}}\\,$ 和 $\\,T_{0,\\mathrm{thick}}\\,$（例如 $\\,T_{0,\\mathrm{thin}} = T_{0,\\mathrm{thick}} = T_{\\mathrm{ref}}\\,$）。因为我们通过在双对数空间中进行回归来估计斜率，所以归一化常数会抵消。\n\n3. 对两个剖面进行 $\\,\\log_{10} T\\,$ 对 $\\,\\log_{10} r\\,$ 的线性回归，以获得拟合斜率 $\\,q_{\\mathrm{thin,fit}}\\,$ 和 $\\,q_{\\mathrm{thick,fit}}\\,$（斜率的大小是绝对值；因为 $\\,T\\,$ 随 $\\,r\\,$ 减小，原始斜率为负，所以我们比较其大小）。\n\n4. 从上述表达式计算解析指数 $\\,q_{\\mathrm{thin}}\\,$ 和 $\\,q_{\\mathrm{thick}}\\,$。\n\n5. 应用诊断规则：\n   - 如果 $\\,\\tau_{\\mathrm{tot}} \\le 0.1\\,$，将两个拟合斜率与 $\\,q_{\\mathrm{thin}}\\,$ 进行比较，如果基于 Planck 的薄剖面更接近，则返回 $\\,1\\,$；如果基于 Rosseland 的厚剖面更接近，则返回 $\\,{-1}\\,$；如果相等，则返回 $\\,0\\,$。\n   - 如果 $\\,\\tau_{\\mathrm{tot}} \\ge 10\\,$，将两个拟合斜率与 $\\,q_{\\mathrm{thick}}\\,$ 进行比较，如果基于 Rosseland 的厚剖面更接近，则返回 $\\,{-1}\\,$；如果基于 Planck 的薄剖面更接近，则返回 $\\,1\\,$；如果相等，则返回 $\\,0\\,$。\n   - 如果 $\\,0.1  \\tau_{\\mathrm{tot}}  10\\,$，则返回 $\\,0\\,$（未确定）。\n\n给定测试套件的评估：\n\n- 情况 $\\,1\\,$：$\\,\\beta = 1.5\\,$, $\\,p = 1.0\\,$。则 $\\,q_{\\mathrm{thin}} = 2/(4+1.5) = 2/5.5 \\approx 0.363636\\,$ 且 $\\,q_{\\mathrm{thick}} = (1+1)/(4-1.5) = 2/2.5 = 0.8\\,$。由于 $\\,\\tau_{\\mathrm{tot}} = 10^{-3} \\le 0.1\\,$，我们与 $\\,q_{\\mathrm{thin}}\\,$ 比较；根据构造，基于 Planck 的薄剖面精确地再现了 $\\,q_{\\mathrm{thin}}\\,$，而基于 Rosseland 的厚剖面给出 $\\,0.8\\,$，因此诊断返回 $\\,1\\,$。\n\n- 情况 $\\,2\\,$：$\\,\\beta = 1.0\\,$, $\\,p = 2.0\\,$。则 $\\,q_{\\mathrm{thin}} = 2/(4+1) = 0.4\\,$ 且 $\\,q_{\\mathrm{thick}} = (1+2)/(4-1) = 3/3 = 1.0\\,$。由于 $\\,\\tau_{\\mathrm{tot}} = 100 \\ge 10\\,$，我们与 $\\,q_{\\mathrm{thick}}\\,$ 比较；基于 Rosseland 的厚剖面再现了 $\\,1.0\\,$，而基于 Planck 的薄剖面给出 $\\,0.4\\,$，因此诊断返回 $\\,{-1}\\,$。\n\n- 情况 $\\,3\\,$：$\\,\\beta = 2.0\\,$, $\\,p = 1.5\\,$。则 $\\,q_{\\mathrm{thin}} = 2/(4+2) = 1/3 \\approx 0.333333\\,$ 且 $\\,q_{\\mathrm{thick}} = (1+1.5)/(4-2) = 2.5/2 = 1.25\\,$。由于 $\\,\\tau_{\\mathrm{tot}} = 1.0\\,$，严格位于 $\\,0.1\\,$ 和 $\\,10\\,$ 之间，我们根据规则返回 $\\,0\\,$。\n\n- 情况 $\\,4\\,$：$\\,\\beta = 1.0\\,$, $\\,p = 1.5\\,$。则 $\\,q_{\\mathrm{thin}} = 2/(4+1) = 0.4\\,$ 且 $\\,q_{\\mathrm{thick}} = (1+1.5)/(4-1) = 2.5/3 \\approx 0.833333\\,$。由于 $\\,\\tau_{\\mathrm{tot}} = 10 \\ge 10\\,$，我们与 $\\,q_{\\mathrm{thick}}\\,$ 比较；基于 Rosseland 的厚剖面更接近（实际上是精确的），所以我们返回 $\\,{-1}\\,$。\n\n因此，四个案例的预期诊断整数序列是 $\\,\\left[1, -1, 0, -1\\right]\\,$。程序实现了所有计算，在具有 $\\,N = 128\\,$ 个点的对数网格上执行斜率拟合，并精确打印所需的单行输出。单位始终为 cgs，根据定义，最终打印的整数是无单位的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_rho0_from_tau(tau_tot, kappa_ref, Rin, Rout, p):\n    # Compute Ip = \\int_{Rin}^{Rout} (r/Rin)^{-p} dr / Rin\n    xout = Rout / Rin\n    if np.isclose(p, 1.0):\n        Ip = np.log(xout)\n    else:\n        Ip = (xout**(1.0 - p) - 1.0) / (1.0 - p)\n    rho0 = tau_tot / (kappa_ref * Rin * Ip)\n    return rho0\n\ndef generate_powerlaw_profile(Rin, Rout, N, q, T0):\n    r = np.logspace(np.log10(Rin), np.log10(Rout), N)\n    T = T0 * (r / Rin) ** (-q)\n    return r, T\n\ndef fit_loglog_slope(r, T):\n    # Fit log10(T) = A + B * log10(r); slope magnitude is |B|\n    x = np.log10(r)\n    y = np.log10(T)\n    # Using polynomial fit of degree 1\n    B, A = np.polyfit(x, y, 1)\n    return abs(B)\n\ndef diagnose_case(beta, p, tau_tot, Tref, Rin, Rout, kappa_ref=1.0, N=128):\n    # Step 1: normalize density from tau_tot\n    rho0 = compute_rho0_from_tau(tau_tot, kappa_ref, Rin, Rout, p)\n\n    # Step 2: derive analytic exponents from first principles\n    q_thin = 2.0 / (4.0 + beta)\n    q_thick = (1.0 + p) / (4.0 - beta)\n\n    # Step 3: synthesize profiles with arbitrary normalization T0 = Tref\n    r_grid, T_thin = generate_powerlaw_profile(Rin, Rout, N, q_thin, Tref)\n    _, T_thick = generate_powerlaw_profile(Rin, Rout, N, q_thick, Tref)\n\n    # Step 4: fit slopes from synthetic profiles\n    q_thin_fit = fit_loglog_slope(r_grid, T_thin)\n    q_thick_fit = fit_loglog_slope(r_grid, T_thick)\n\n    # Step 5: apply diagnosis rule\n    # thresholds: thin if tau = 0.1; thick if tau >= 10; intermediate otherwise\n    if tau_tot = 0.1:\n        err_P = abs(q_thin_fit - q_thin)     # Planck-based thin vs thin reference\n        err_R = abs(q_thick_fit - q_thin)    # Rosseland-based thick vs thin reference\n        if err_P  err_R:\n            code = 1\n        elif err_R  err_P:\n            code = -1\n        else:\n            code = 0\n    elif tau_tot >= 10.0:\n        err_P = abs(q_thin_fit - q_thick)    # Planck-based thin vs thick reference\n        err_R = abs(q_thick_fit - q_thick)   # Rosseland-based thick vs thick reference\n        if err_R  err_P:\n            code = -1\n        elif err_P  err_R:\n            code = 1\n        else:\n            code = 0\n    else:\n        code = 0\n\n    # Return integer diagnosis; rho0 is computed to ensure physical consistency, but not printed.\n    _ = rho0  # placeholder to indicate usage\n    return code\n\ndef solve():\n    # Physical constants (cgs), included for completeness\n    a = 7.5657e-15          # radiation constant [erg cm^-3 K^-4]\n    c = 2.99792458e10       # speed of light [cm s^-1]\n    sigma = a * c / 4.0     # Stefan-Boltzmann constant [erg cm^-2 s^-1 K^-4]\n    L = 3.828e33            # luminosity [erg s^-1]\n    T_star = 5772.0         # stellar effective temperature [K]\n    # Stellar radius from L = 4 pi R_*^2 sigma T_*^4 (not directly used in slope fits)\n    R_star = np.sqrt(L / (4.0 * np.pi * sigma * T_star**4))\n\n    # Define the test cases from the problem statement.\n    # Each case: (beta, p, tau_tot, Tref)\n    Rin = 1e12  # cm\n    Rout = 1e15 # cm\n    kappa_ref = 1.0  # cm^2 g^-1\n    test_cases = [\n        (1.5, 1.0, 1e-3, 100.0),   # Case 1: thin\n        (1.0, 2.0, 100.0, 1000.0), # Case 2: thick\n        (2.0, 1.5, 1.0, 300.0),    # Case 3: intermediate\n        (1.0, 1.5, 10.0, 300.0),   # Case 4: boundary thick\n    ]\n\n    results = []\n    for beta, p, tau_tot, Tref in test_cases:\n        code = diagnose_case(beta, p, tau_tot, Tref, Rin, Rout, kappa_ref=kappa_ref, N=128)\n        results.append(int(code))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}