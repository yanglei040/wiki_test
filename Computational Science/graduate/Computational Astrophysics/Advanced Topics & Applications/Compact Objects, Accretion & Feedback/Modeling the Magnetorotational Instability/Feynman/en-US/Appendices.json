{
    "hands_on_practices": [
        {
            "introduction": "Before writing any code for a complex problem like the magnetorotational instability (MRI), it is crucial to select the right numerical architecture. This exercise challenges you to think like a code developer, evaluating different numerical strategies for ideal magnetohydrodynamics. The key is to find a combination that both preserves the divergence-free condition of the magnetic field ($\\nabla \\cdot \\mathbf{B} = 0$) to machine precision and accurately resolves the full spectrum of MHD waves that govern the instability's growth and saturation .",
            "id": "3521889",
            "problem": "You are implementing a finite-volume Godunov method for ideal magnetohydrodynamics (MHD) to study the Magnetorotational Instability (MRI) in a local shearing-box domain. The governing laws are conservation of mass, momentum, and total energy, together with Faraday’s law and Gauss’s law for magnetism. In ideal MHD, the electric field satisfies $\\,\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}\\,$. Your goal is to choose a scheme that, at the discrete level, preserves $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ to machine precision over time, while accurately capturing the characteristic wave families that control MRI growth and non-linear saturation.\n\nStarting from the principles that finite-volume methods update cell-averaged conserved quantities by flux differences through faces, and that Faraday’s law converts to a curl of the electric field update for the magnetic field when integrated over faces and edges (by Gauss’s and Stokes’ theorems), select the option that correctly outlines:\n\n- a spatial and temporal discretization that maintains $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ exactly in the discrete sense, and\n- a suitable approximate Riemann solver that resolves the relevant ideal MHD wave structure for accurate MRI dynamics.\n\nAssume an unsplit update in $\\,\\mathbf{x}\\in\\mathbb{R}^3\\,$ with a Courant-Friedrichs-Lewy (CFL) time step set by the maximum characteristic speed, and an ideal MHD closure. Choose the single best option.\n\nA. Use a finite-volume Godunov update for the conserved variables stored at cell centers and store magnetic field components on faces. Reconstruct primitive variables to faces with a total variation diminishing limiter, predict to half-time, and solve the face-normal Riemann problems with the Harten-Lax-van Leer-Discontinuities (HLLD) approximate Riemann solver to obtain upwinded mass, momentum, energy fluxes and face-centered transverse fluxes of the magnetic field. Compute edge-centered electric fields by upwinding $-\\mathbf{v}\\times\\mathbf{B}$ using transverse face states or a two-dimensional Riemann construction, then update face-centered magnetic fields by the constrained transport (CT) curl of the edge-centered electric fields. Advance cell-centered conserved variables with the Godunov fluxes in an unsplit manner. This preserves the discrete divergence of the face-centered magnetic field to machine precision and captures Alfvén, slow, contact, and fast waves important for MRI.\n\nB. Store all conserved variables, including the magnetic field, at cell centers and update them by flux differences using the Harten-Lax-van Leer-Contact (HLLC) approximate Riemann solver designed for hydrodynamics, treating the magnetic field as passively advected. After each step, apply a scalar potential projection that solves a Poisson equation to enforce $\\,\\nabla\\cdot\\mathbf{B}=0\\,$; this guarantees exact solenoidality and accurate wave capturing without the need for constrained transport.\n\nC. Use face-centered magnetic fields and constrained transport, but compute edge-centered electric fields as the arithmetic average of the four neighboring cell-centered values of $-\\mathbf{v}\\times\\mathbf{B}$ without any upwinding or multidimensional coupling. For the fluid and magnetic fluxes through faces, use a local Lax-Friedrichs central flux or a Harten-Lax-van Leer (HLL) solver that lumps all intermediate waves. The method will maintain $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ and is sufficiently accurate for MRI wave dynamics due to the inherent dissipation stabilizing the scheme.\n\nD. Use a finite-volume Godunov update with magnetic fields at cell centers. Employ the Generalized Lagrange Multiplier (GLM) divergence cleaning formulation with a hyperbolic/parabolic cleaning wave speed to advect and damp divergence errors, and solve face-normal Riemann problems with HLLD. This avoids the complexity of constrained transport while still maintaining $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ to machine precision and accurately capturing MHD waves.\n\nE. Use a linearized Roe solver for MHD with characteristic decomposition and piecewise-linear reconstruction of primitive variables. Update the magnetic field at faces by taking the discrete divergence of the magnetic fluxes through the surrounding faces, rather than a curl of edge-centered electric fields, to ensure compatibility with the finite-volume update. This maintains $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ discretely and fully resolves all wave families relevant to MRI.\n\nSelect the correct option.",
            "solution": "The user wants me to act as a STEM professor. My task is to first validate the problem statement according to a strict protocol. If the problem is valid, I must provide a detailed solution deriving the correct answer and evaluating all options. If it is invalid, I must explain the flaws and terminate.\n\n### Step 1: Extract Givens\n- **Methodology:** Finite-volume Godunov method for ideal magnetohydrodynamics (MHD).\n- **Application:** Study of the Magnetorotational Instability (MRI) in a local shearing-box domain.\n- **Governing Equations:**\n    - Conservation of mass, momentum, and total energy.\n    - Faraday’s law.\n    - Gauss’s law for magnetism: $\\nabla\\cdot\\mathbf{B}=0$.\n- **Ideal MHD Condition:** Electric field $\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}$.\n- **Primary Goals:**\n    1.  Choose a scheme that preserves $\\nabla\\cdot\\mathbf{B}=0$ to machine precision at the discrete level.\n    2.  Choose a scheme that accurately captures characteristic wave families relevant to MRI dynamics.\n- **Underlying Principles:**\n    - Finite-volume methods update cell-averaged quantities via flux differences.\n    - Faraday’s law (via Stokes' theorem) implies the update for magnetic field on a face is related to the curl of the electric field along its edges.\n- **Assumptions:**\n    - Unsplit update in three spatial dimensions ($\\mathbf{x}\\in\\mathbb{R}^3$).\n    - Courant-Friedrichs-Lewy (CFL) time step limited by the maximum characteristic speed.\n    - Ideal MHD equation of state.\n- **Question:** Select the option that correctly describes:\n    - a discretization maintaining $\\nabla\\cdot\\mathbf{B}=0$ exactly (discretely).\n    - a suitable approximate Riemann solver for MRI dynamics.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is firmly grounded in computational astrophysics and numerical methods for plasma physics. The governing equations are the standard equations of ideal MHD. The MRI, shearing box, Godunov methods, constrained transport (CT), various divergence-control techniques (GLM, projection), and approximate Riemann solvers (HLL, HLLD, Roe) are all standard, well-established concepts in the field.\n2.  **Well-Posed:** The problem is a well-posed multiple-choice question asking to identify the correct description of a state-of-the-art numerical method for a specific, well-defined physical problem. A unique correct answer exists based on established knowledge in computational MHD.\n3.  **Objective:** The language is technical, precise, and free of subjectivity. The criteria for success (machine-precision divergence preservation, accurate wave capture) are objective and measurable properties of a numerical scheme.\n4.  **Incomplete or Contradictory Setup:** The problem provides sufficient information to evaluate the options. The context, goals, and underlying physical and numerical principles are clearly stated and consistent.\n5.  **Unrealistic or Infeasible:** The scenario described is a standard setup for theoretical and computational studies of accretion disk physics. All proposed methods (even the incorrect ones) are based on real numerical techniques, although their descriptions or applicability might be flawed in the options.\n6.  **Ill-Posed or Poorly Structured:** The question is clearly structured and asks for a specific combination of numerical techniques that satisfy two distinct but related criteria.\n7.  **Pseudo-Profound, Trivial, or Tautological:** The problem is non-trivial and requires expert knowledge of numerical MHD to distinguish between the subtle and significant differences in the proposed schemes. The options describe distinct, competing methodologies.\n8.  **Outside Scientific Verifiability:** The claims made within each option can be verified against the peer-reviewed literature on computational MHD.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. It is a well-formulated, scientifically sound question in computational astrophysics. I will now proceed with a full solution and evaluation of the options.\n\nThe problem requires identifying a numerical scheme that satisfies two key requirements for accurate MRI simulations:\n1.  **Divergence-Free Constraint:** The magnetic field $\\mathbf{B}$ must satisfy $\\nabla \\cdot \\mathbf{B} = 0$. Failure to maintain this at the discrete level introduces unphysical forces proportional to the local divergence error, which can corrupt the solution and generate numerical instabilities. A method that maintains this condition to machine precision (i.e., due to floating-point round-off error only) is highly desirable.\n2.  **Wave Resolution:** The MRI is a linear instability whose growth is mediated by magnetic tension and whose non-linear saturation involves complex turbulence. The dynamics are governed by the MHD wave families: fast and slow magnetosonic waves, Alfvén waves, and an entropy/contact mode. An accurate simulation requires a numerical flux function (i.e., an approximate Riemann solver) that can resolve the essential waves, particularly the Alfvén and slow waves which are critical for the MRI itself.\n\nLet us analyze the presented options based on these two criteria.\n\n**Divergence-Control Methods:**\n- **Cell-centered schemes with cleaning:** These methods store all components of $\\mathbf{B}$ at cell centers along with other fluid variables. Since the standard finite-volume update $\\frac{d\\mathbf{B}_i}{dt} = -\\frac{1}{V_i}\\sum_f (\\mathbf{F_B} \\cdot \\mathbf{A})_f$ does not guarantee a discretely divergence-free field, an additional mechanism is needed.\n    - **Projection Method:** Solves a Poisson equation to project the magnetic field back onto the divergence-free subspace at the end of each timestep. This is computationally expensive and non-local. It does not maintain $\\nabla \\cdot \\mathbf{B} = 0$ during the step, but rather corrects it post-hoc.\n    - **Generalized Lagrange Multiplier (GLM):** Introduces a scalar field that helps transport and damp divergence errors. It does not maintain $\\nabla \\cdot \\mathbf{B} = 0$ to machine precision, but controls the error to the level of the scheme's truncation error.\n- **Constrained Transport (CT):** This method maintains the divergence-free condition to machine precision by construction. It uses a staggered grid where the normal components of the magnetic field are stored on cell faces. The discrete divergence operator on this grid is the exact discrete analogue of the continuous one and yields a telescoping sum that is identically zero for a closed volume. The magnetic field is updated via Stokes' theorem using electric fields $\\mathbf{E}$ defined at cell edges: $\\frac{d}{dt} \\int_{face} \\mathbf{B} \\cdot d\\mathbf{A} = -\\oint_{edges} \\mathbf{E} \\cdot d\\mathbf{l}$. The crucial part is accurately computing the edge-centered $\\mathbf{E}$.\n\n**Riemann Solvers:**\n- **HLL (Harten-Lax-van Leer):** A robust but highly dissipative solver that only captures the fastest inward and outward-propagating waves, smearing out all intermediate structure (Alfvén, slow, contact waves). Generally inadequate for MRI.\n- **HLLD (Harten-Lax-van Leer-Discontinuities):** A sophisticated MHD solver that resolves not only the fast magnetosonic waves but also the contact mode and, critically, the rotational discontinuities (Alfvén waves). This makes it an excellent choice for MRI simulations.\n- **Roe Solver:** A linearized solver that resolves all characteristic waves. It is very accurate but can be less robust than HLL-family solvers and may require entropy fixes.\n\nWith this background, let's evaluate each option.\n\n**A. Use a finite-volume Godunov update for the conserved variables stored at cell centers and store magnetic field components on faces. Reconstruct primitive variables to faces with a total variation diminishing limiter, predict to half-time, and solve the face-normal Riemann problems with the Harten-Lax-van Leer-Discontinuities (HLLD) approximate Riemann solver to obtain upwinded mass, momentum, energy fluxes and face-centered transverse fluxes of the magnetic field. Compute edge-centered electric fields by upwinding $-\\mathbf{v}\\times\\mathbf{B}$ using transverse face states or a two-dimensional Riemann construction, then update face-centered magnetic fields by the constrained transport (CT) curl of the edge-centered electric fields. Advance cell-centered conserved variables with the Godunov fluxes in an unsplit manner. This preserves the discrete divergence of the face-centered magnetic field to machine precision and captures Alfvén, slow, contact, and fast waves important for MRI.**\n\n-   **Divergence Control:** This option describes the Constrained Transport (CT) method perfectly. It correctly identifies the staggered grid (`magnetic field components on faces`), the update mechanism (`curl of the edge-centered electric fields`), and the result (`preserves the discrete divergence ... to machine precision`). It also correctly highlights the need for a sophisticated, upwinded calculation of the edge electric fields.\n-   **Wave Resolution:** It specifies the HLLD Riemann solver, which is an excellent choice for accurately capturing the MHD wave structure, including the Alfvén waves crucial for the MRI.\n-   **Overall Description:** This option provides a complete and accurate description of a modern, high-fidelity numerical scheme for ideal MHD, such as that used in codes like Athena, PLUTO, or RAMSES.\n-   **Verdict:** **Correct**.\n\n**B. Store all conserved variables, including the magnetic field, at cell centers and update them by flux differences using the Harten-Lax-van Leer-Contact (HLLC) approximate Riemann solver designed for hydrodynamics, treating the magnetic field as passively advected. After each step, apply a scalar potential projection that solves a Poisson equation to enforce $\\,\\nabla\\cdot\\mathbf{B}=0\\,$; this guarantees exact solenoidality and accurate wave capturing without the need for constrained transport.**\n\n-   **Divergence Control:** It describes the projection method. However, the claim that it `guarantees exact solenoidality` is misleading in the context of a time-dependent simulation. The field is *corrected* to be divergence-free, but it does not *remain* so during the update, unlike CT.\n-   **Wave Resolution:** It suggests using an HLLC solver `designed for hydrodynamics`. This is fundamentally incorrect for an MHD problem. MHD requires a dedicated MHD solver that accounts for magnetic forces and waves.\n-   **Physics:** The statement `treating the magnetic field as passively advected` is a critical scientific error. The Lorentz force, $\\mathbf{J} \\times \\mathbf{B}$, is central to MHD and is the driver of the MRI. A passively advected field exerts no force.\n-   **Verdict:** **Incorrect**. This option contains multiple severe flaws in physics and numerical methodology.\n\n**C. Use face-centered magnetic fields and constrained transport, but compute edge-centered electric fields as the arithmetic average of the four neighboring cell-centered values of $-\\mathbf{v}\\times\\mathbf{B}$ without any upwinding or multidimensional coupling. For the fluid and magnetic fluxes through faces, use a local Lax-Friedrichs central flux or a Harten-Lax-van Leer (HLL) solver that lumps all intermediate waves. The method will maintain $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ and is sufficiently accurate for MRI wave dynamics due to the inherent dissipation stabilizing the scheme.**\n\n-   **Divergence Control:** The framework is CT (`face-centered magnetic fields`), which is good. However, the method for computing edge E-fields (`arithmetic average`) is a naive, known-to-be-unstable approach that lacks proper upwinding information from the Riemann solvers on adjacent faces.\n-   **Wave Resolution:** It proposes using Lax-Friedrichs or HLL solvers. Both are excessively dissipative and are known to be poor choices for resolving the detailed wave structures of the MRI. The high numerical diffusion would damp the physical instability, rendering the simulation inaccurate. The justification that dissipation `stabiliz[es] the scheme` is true but misleads by ignoring that this same dissipation destroys the physical accuracy needed.\n-   **Verdict:** **Incorrect**. While it starts with the correct CT framework, it pairs it with a poor E-field calculation and an inadequate, overly diffusive Riemann solver, making the resulting scheme unsuitable for the stated scientific goal.\n\n**D. Use a finite-volume Godunov update with magnetic fields at cell centers. Employ the Generalized Lagrange Multiplier (GLM) divergence cleaning formulation with a hyperbolic/parabolic cleaning wave speed to advect and damp divergence errors, and solve face-normal Riemann problems with HLLD. This avoids the complexity of constrained transport while still maintaining $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ to machine precision and accurately capturing MHD waves.**\n\n-   **Divergence Control:** It describes the GLM method. While GLM is a valid technique, the statement that it maintains `$\\nabla\\cdot\\mathbf{B}=0$ to machine precision` is false. GLM is designed to keep the divergence error on the order of the scheme's truncation error by propagating and damping it away. Only CT achieves machine-precision conservation of zero divergence.\n-   **Wave Resolution:** The choice of HLLD is appropriate.\n-   **Conclusion:** The central claim about the precision of the divergence control is incorrect, which makes the entire option description faulty. It misrepresents the properties of the GLM method.\n-   **Verdict:** **Incorrect**.\n\n**E. Use a linearized Roe solver for MHD with characteristic decomposition and piecewise-linear reconstruction of primitive variables. Update the magnetic field at faces by taking the discrete divergence of the magnetic fluxes through the surrounding faces, rather than a curl of edge-centered electric fields, to ensure compatibility with the finite-volume update. This maintains $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ discretely and fully resolves all wave families relevant to MRI.**\n\n-   **Divergence Control:** This option describes a completely nonsensical update for a face-centered magnetic field. Faraday's law in integral form, via Stokes' theorem, unequivocally leads to a curl-of-E formulation for the update of face-centered fields in CT. Taking the `discrete divergence of the magnetic fluxes` is mathematically gibberish in this context. Magnetic flux through a face is a scalar; you cannot take its divergence. This appears to confuse the update for a cell-centered vector component (which involves the divergence of a flux tensor) with the update for a face-centered scalar component.\n-   **Wave Resolution:** A Roe solver is a valid, high-fidelity choice, but it cannot fix the fundamentally flawed description of the magnetic field update.\n-   **Verdict:** **Incorrect**. The proposed update rule for the face-centered magnetic field is conceptually and mathematically wrong.\n\nBased on the analysis, Option A provides the only correct and complete description of a standard, robust, and accurate numerical method for studying the magnetorotational instability.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "After choosing a numerical framework, the next step is to implement the core solver. In the shearing-box approximation, this involves not only the standard MHD flux-divergence but also unique source terms that model Coriolis forces and background shear. A robust solver must conserve total energy, which requires deriving and implementing the correct energy source terms that account for the work done by these forces . This practice guides you through implementing a conservative update and verifying its energy balance, a critical step in building a reliable simulation tool.",
            "id": "3521855",
            "problem": "You are to design and implement a conservative finite-volume discretization for compressible ideal Magnetohydrodynamics (MHD) in a local shearing-box model of an accretion disk to verify balanced energy exchange among kinetic, magnetic, and thermal components while correctly applying shear source terms that model magnetorotational instability (MRI) physics. Your solution must start from first principles: write the conservative one-dimensional ideal MHD system along the radial coordinate, derive fluxes from the conservation laws, and construct source terms consistent with the shearing-box approximation and energy accounting. Then implement the resulting update in code and quantitatively assess discrete energy balance for a test suite.\n\nBegin from the conservation form of ideal MHD and the shearing-box equations. In a local frame co-rotating with angular velocity $\\Omega$, with shear parameter $q$, define the conservative state vector per cell as $U = [\\rho, m_x, m_y, m_z, B_x, B_y, B_z, E]$, where $\\rho$ is mass density, $\\boldsymbol{m} = \\rho \\boldsymbol{v}$ is momentum density, $\\boldsymbol{B}$ is magnetic field, and $E$ is total energy density. The thermodynamic pressure $p$ is recovered from the internal energy density $e_{\\mathrm{th}}$ via an ideal gas relation $p = (\\gamma - 1) e_{\\mathrm{th}}$, with adiabatic index $\\gamma$. The total energy density is $E = e_{\\mathrm{th}} + \\tfrac{1}{2}\\rho |\\boldsymbol{v}|^2 + \\tfrac{1}{2}|\\boldsymbol{B}|^2$. The equations are discretized in a finite-volume sense along the $x$ (radial) direction with periodic boundary conditions and no external boundaries.\n\nUse a local Riemann solver approximation that is consistent with the conservative integral form. A robust choice is a Lax–Friedrichs (Rusanov) flux, where an inter-cell numerical flux $F_{i+\\tfrac{1}{2}}$ between cells $i$ and $i+1$ is computed from the left and right states $U_L$ and $U_R$ using the physical MHD fluxes and a single dissipation speed $a_{\\max}$ that exceeds all characteristic wave speeds. The update for each cell $i$ over a time step $\\Delta t$ is given by a conservative flux-divergence term and physically motivated source terms,\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right) + \\Delta t\\, S(U_i^n).\n$$\n\nModel the shearing box source terms that represent Coriolis and tidal effects on momentum, and the effect of background shear on induction. In the shearing-box approximation with local angular velocity $\\Omega$ and shear parameter $q$, the momentum source terms are\n$$\nS_{m_x} = 2 \\rho \\Omega v_y,\\quad\nS_{m_y} = - (2 - q)\\rho \\Omega v_x,\\quad\nS_{m_z} = 0,\n$$\nand the induction source term that represents background shear is\n$$\nS_{B_y} = - q \\Omega B_x, \\quad S_{B_x} = 0,\\quad S_{B_z} = 0.\n$$\nEnsure total energy consistency by including the corresponding work terms in the energy source,\n$$\nS_E = \\boldsymbol{v}\\cdot \\boldsymbol{S}_m + \\boldsymbol{B}\\cdot \\boldsymbol{S}_B.\n$$\nNote that the Coriolis force does no work, i.e., $\\boldsymbol{v}\\cdot(2\\boldsymbol{\\Omega}\\times\\boldsymbol{v}) = 0$, and that the magnetic energy source must be $S_{E,\\mathrm{mag}} = \\boldsymbol{B}\\cdot \\boldsymbol{S}_B$ to capture the work done by background shear on the magnetic field. You must derive the physical fluxes for one-dimensional ideal MHD along the $x$-direction from the conservation laws and use them in the numerical flux.\n\nAll variables are nondimensionalized and expressed in code units, so no physical unit conversion is required. Angles do not appear explicitly, so no angle unit specification is required.\n\nImplement the algorithm in a single program using a uniform grid of $N$ cells, domain length $L$, and periodic boundaries. Use a global time step $\\Delta t$ that satisfies a Courant condition based on the maximum estimated fast signal speed and is also small enough to stably integrate the source terms. Perform a single explicit time step from initial conditions to evaluate the discrete energy balance. For each test case, compute the residual energy imbalance defined as\n$$\nR = \\left(\\sum_i E_i^{n+1}\\right) - \\left(\\sum_i E_i^{n}\\right) - \\Delta t \\left(\\sum_i S_{E,i}\\right),\n$$\nwhich should be approximately zero if the discretization balances energy exchange among kinetic, magnetic, and thermal components and the source work is applied consistently. Express the residuals as floating-point numbers.\n\nTest Suite:\nUse the following four test cases to probe different aspects of the discretization. All quantities are in nondimensional code units, and $L = 1$ and periodic boundary conditions are used in all cases. In each case, use $N = 64$ cells, $\\gamma = \\tfrac{5}{3}$, and compute $\\Delta t$ from a Courant factor $C = 0.3$ with the maximum characteristic speed, additionally limited by the source time scales.\n\n- Case $1$ (happy path, no shear): $\\Omega = 1$, $q = 0$. Uniform initial state with $\\rho = 1$, $p = 1$, $v_x = 0.3$, $v_y = 0.2$, $v_z = 0$, $B_x = 0$, $B_y = 0$, $B_z = 0$.\n- Case $2$ (shear induction with magnetic energy work): $\\Omega = 1$, $q = \\tfrac{3}{2}$. Uniform initial state with $\\rho = 1$, $p = 1$, $v_x = 0$, $v_y = 0$, $v_z = 0$, $B_x = 0.5$, $B_y = 0.3$, $B_z = 0$.\n- Case $3$ (pressure work exchange, hydrodynamic compressive flow): $\\Omega = 0$, $q = 0$. Initial state with $\\rho(x) = 1$, $p(x) = 1$, $B_x = 0$, $B_y = 0$, $B_z = 0$, $v_x(x) = 0.5\\sin(2\\pi x)$, $v_y(x) = 0$, $v_z(x) = 0$.\n- Case $4$ (magnetic tension exchange): $\\Omega = 0$, $q = 0$. Initial state with $\\rho(x) = 1$, $p(x) = 1$, $v_x(x) = 0$, $v_y(x) = 0.3\\cos(2\\pi x)$, $v_z(x) = 0$, $B_x = 0.5$, $B_y(x) = 0.2\\sin(2\\pi x)$, $B_z(x) = 0$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the residual energy imbalances for the four test cases as a comma-separated list enclosed in square brackets, in the order of the cases listed above. For example, the output must look like\n$$\n[\\text{residual}_1,\\text{residual}_2,\\text{residual}_3,\\text{residual}_4].\n$$\nEach residual must be a floating-point number. No other text should be printed.",
            "solution": "The problem is well-posed, scientifically grounded, and provides all necessary information to construct a numerical solution. It represents a standard verification test for a magnetohydrodynamics (MHD) code incorporating shearing-box source terms. The task is to implement a one-dimensional finite-volume scheme and verify its energy conservation properties. We will first derive the necessary equations from first principles and then outline the algorithm for implementation.\n\n### 1. Ideal MHD Equations and Shearing-Box Model\n\nThe problem is defined in a local, co-rotating Cartesian frame $(x, y, z)$ corresponding to the radial, azimuthal, and vertical directions in an accretion disk. The ideal MHD equations are expressed in conservative form, $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F}{\\partial x} = S$, where $U$ is the vector of conserved quantities, $F$ is the flux vector in the $x$-direction, and $S$ is the source term vector.\n\nThe state vector of conserved quantities per unit volume is given by:\n$$\nU = [\\rho, m_x, m_y, m_z, B_x, B_y, B_z, E]^T\n$$\nwhere $\\rho$ is the mass density, $\\boldsymbol{m} = \\rho\\boldsymbol{v}$ is the momentum density, $\\boldsymbol{B}$ is the magnetic field, and $E$ is the total energy density.\n\nThe primitive variables $(\\rho, \\boldsymbol{v}, p, \\boldsymbol{B})$ are recovered from the conserved state $U$ as follows:\n- Mass density: $\\rho = U_1$\n- Velocity: $\\boldsymbol{v} = (v_x, v_y, v_z) = (\\frac{m_x}{\\rho}, \\frac{m_y}{\\rho}, \\frac{m_z}{\\rho}) = (\\frac{U_2}{U_1}, \\frac{U_3}{U_1}, \\frac{U_4}{U_1})$\n- Magnetic field: $\\boldsymbol{B} = (B_x, B_y, B_z) = (U_5, U_6, U_7)$\n\nThe total energy density $E$ is the sum of internal (thermal), kinetic, and magnetic energies:\n$$\nE = e_{\\mathrm{th}} + \\frac{1}{2}\\rho|\\boldsymbol{v}|^2 + \\frac{1}{2}|\\boldsymbol{B}|^2 = e_{\\mathrm{th}} + \\frac{|\\boldsymbol{m}|^2}{2\\rho} + \\frac{|\\boldsymbol{B}|^2}{2}\n$$\nThe internal energy density $e_{\\mathrm{th}}$ can thus be calculated from $U$:\n$$\ne_{\\mathrm{th}} = E - \\frac{m_x^2 + m_y^2 + m_z^2}{2\\rho} - \\frac{B_x^2 + B_y^2 + B_z^2}{2}\n$$\nThe system is closed with an ideal gas equation of state, relating the thermal pressure $p$ to the internal energy density:\n$$\np = (\\gamma - 1)e_{\\mathrm{th}}\n$$\nwhere $\\gamma$ is the adiabatic index. The total pressure is $p_{\\mathrm{tot}} = p + \\frac{1}{2}|\\boldsymbol{B}|^2$.\n\n### 2. Physical Fluxes and Source Terms\n\nThe physical flux vector $F(U)$ in the $x$-direction for the ideal MHD equations is:\n$$\nF(U) = \\begin{pmatrix}\n\\rho v_x \\\\\n\\rho v_x^2 + p_{\\mathrm{tot}} - B_x^2 \\\\\n\\rho v_x v_y - B_x B_y \\\\\n\\rho v_x v_z - B_x B_z \\\\\n0 \\\\\nv_y B_x - v_x B_y \\\\\nv_z B_x - v_x B_z \\\\\n(E + p_{\\mathrm{tot}})v_x - (\\boldsymbol{v} \\cdot \\boldsymbol{B})B_x\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nm_x \\\\\n\\frac{m_x^2}{\\rho} + p + \\frac{1}{2}(B_y^2 + B_z^2 - B_x^2) \\\\\n\\frac{m_x m_y}{\\rho} - B_x B_y \\\\\n\\frac{m_x m_z}{\\rho} - B_x B_z \\\\\n0 \\\\\n\\frac{m_y B_x - m_x B_y}{\\rho} \\\\\n\\frac{m_z B_x - m_x B_z}{\\rho} \\\\\n(E + p + \\frac{1}{2}|\\boldsymbol{B}|^2)\\frac{m_x}{\\rho} - \\frac{m_x B_x + m_y B_y + m_z B_z}{\\rho} B_x\n\\end{pmatrix}\n$$\nNote that for 1D flow along $x$, the divergence-free condition $\\nabla \\cdot \\boldsymbol{B} = 0$ implies $\\frac{\\partial B_x}{\\partial x} = 0$, making $B_x$ spatially uniform. The induction equation $\\frac{\\partial B_x}{\\partial t} = 0$ for 1D flows means the corresponding physical flux component is zero.\n\nThe shearing-box source terms $S(U)$ are given for momentum and induction. We must derive the energy source term $S_E$ to ensure conservation.\nThe specified momentum and magnetic source terms are:\n$$\nS_m = \\begin{pmatrix} S_{m_x} \\\\ S_{m_y} \\\\ S_{m_z} \\end{pmatrix} = \\begin{pmatrix} 2 \\rho \\Omega v_y \\\\ -(2-q)\\rho \\Omega v_x \\\\ 0 \\end{pmatrix}, \\quad\nS_B = \\begin{pmatrix} S_{B_x} \\\\ S_{B_y} \\\\ S_{B_z} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -q \\Omega B_x \\\\ 0 \\end{pmatrix}\n$$\nwhere $\\Omega$ is the local orbital frequency and $q$ is the shear parameter.\nThe total energy source term $S_E$ is the rate of work done by these source terms: $S_E = \\boldsymbol{v} \\cdot S_m + \\boldsymbol{B} \\cdot S_B$.\n$$\nS_E = v_x (2 \\rho \\Omega v_y) + v_y (-(2-q)\\rho \\Omega v_x) + v_z(0) + B_x(0) + B_y(-q \\Omega B_x) + B_z(0)\n$$\n$$\nS_E = (2 - (2-q))\\rho\\Omega v_x v_y - q\\Omega B_x B_y = q\\rho\\Omega v_x v_y - q\\Omega B_x B_y\n$$\nIn terms of conservative variables:\n$$\nS_E = q\\Omega\\left(\\frac{m_x m_y}{\\rho} - B_x B_y\\right)\n$$\nThe complete source vector is:\n$$\nS(U) = [0, S_{m_x}, S_{m_y}, 0, 0, S_{B_y}, 0, S_E]^T\n$$\n\n### 3. Numerical Discretization\n\nWe use a finite-volume method on a uniform grid of $N$ cells of width $\\Delta x = L/N$. The cell-averaged state is updated via:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right) + \\Delta t S(U_i^n)\n$$\nThe numerical flux $F_{i+\\frac{1}{2}}$ at the interface between cells $i$ and $i+1$ is approximated using the Lax-Friedrichs (Rusanov) formula:\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}a_{\\max}\\left(U_R - U_L\\right)\n$$\nHere, $U_L = U_i$ and $U_R = U_{i+1}$ are the states to the left and right of the interface. $a_{\\max}$ is an estimate of the maximum signal speed across the entire grid, ensuring numerical stability. It is given by the maximum of $|v_x| + c_{f,x}$ over all cells, where $c_{f,x}$ is the fast magnetosonic speed in the $x$-direction:\n$$\nc_{f,x}^2 = \\frac{1}{2} \\left[ (c_s^2 + v_A^2) + \\sqrt{(c_s^2 + v_A^2)^2 - 4 c_s^2 v_{Ax}^2} \\right]\n$$\nwith sound speed $c_s^2 = \\frac{\\gamma p}{\\rho}$, total Alfvén speed $v_A^2 = \\frac{|\\boldsymbol{B}|^2}{\\rho}$, and x-component Alfvén speed $v_{Ax}^2 = \\frac{B_x^2}{\\rho}$.\n\nThe time step $\\Delta t$ is constrained by both the Courant-Friedrichs-Lewy (CFL) condition for the hyperbolic fluxes and the stability of the source-term integration:\n$$\n\\Delta t = C \\min\\left(\\frac{\\Delta x}{a_{\\max}}, \\tau_{\\text{source}}\\right)\n$$\nwhere $C=0.3$ is the Courant factor. A reasonable choice for the source term timescale is $\\tau_{\\text{source}} = 1/|\\Omega|$ when $\\Omega \\neq 0$.\n\n### 4. Energy Balance Verification\n\nWith periodic boundary conditions, the sum of flux differences over the entire domain telescopes to zero: $\\sum_i (F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}) = 0$. Summing the update equation over all cells $i$ gives:\n$$\n\\sum_i U_i^{n+1} = \\sum_i U_i^n + \\Delta t \\sum_i S(U_i^n)\n$$\nFocusing on the energy component (the last element of $U$), this implies:\n$$\n\\sum_i E_i^{n+1} = \\sum_i E_i^n + \\Delta t \\sum_i S_{E,i}\n$$\nThe problem asks to compute the residual energy imbalance, defined as:\n$$\nR = \\left(\\sum_i E_i^{n+1}\\right) - \\left(\\sum_i E_i^{n}\\right) - \\Delta t \\left(\\sum_i S_{E,i}\\right)\n$$\nBased on the discrete conservation property, this residual $R$ should be zero up to floating-point precision. The calculation serves as a stringent test of the code's correctness, especially the consistent implementation of the energy source term.\n\n### 5. Algorithm Summary\n\nFor each test case:\n1.  Initialize a uniform grid with $N=64$ cells over the domain $L=1$.\n2.  Set the initial state vector $U^n$ in each cell based on the given primitive variables.\n3.  Compute the initial total energy $\\mathcal{E}^n = \\sum_i E_i^n$.\n4.  Calculate primitive variables and wave speeds for all cells. Determine the global maximum signal speed $a_{\\max}$.\n5.  Calculate the time step $\\Delta t$ using the CFL and source term constraints.\n6.  Compute the source vector $S(U_i^n)$ for all cells and the total energy source contribution $\\Delta t \\sum_i S_{E,i}$.\n7.  For each interface $i+\\frac{1}{2}$ (from $i=0$ to $N-1$, with periodic wrapping), compute the Rusanov flux $F_{i+\\frac{1}{2}}$.\n8.  Update the state in each cell to $U^{n+1}$ using the conservative finite-volume formula.\n9.  Compute the final total energy $\\mathcal{E}^{n+1} = \\sum_i E_i^{n+1}$.\n10. Calculate the residual $R = \\mathcal{E}^{n+1} - \\mathcal{E}^n - \\Delta t \\sum_i S_{E,i}$.\n\nThis procedure will be applied to all four specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Note: scipy is permitted but not required for this problem.\n\n# Global constant for adiabatic index\nGAMMA = 5.0 / 3.0\n\ndef cons_to_prim(U):\n    \"\"\"\n    Convert an array of conservative state vectors to primitive variables.\n    U: (N, 8) array of [rho, mx, my, mz, Bx, By, Bz, E]\n    Returns: rho, v, B, p - each as a numpy array.\n    \"\"\"\n    rho = U[:, 0]\n    # Ensure density is positive to avoid division by zero\n    rho_inv = 1.0 / np.maximum(rho, 1e-100)\n    \n    vx = U[:, 1] * rho_inv\n    vy = U[:, 2] * rho_inv\n    vz = U[:, 3] * rho_inv\n    v = np.stack((vx, vy, vz), axis=-1)\n    \n    Bx = U[:, 4]\n    By = U[:, 5]\n    Bz = U[:, 6]\n    B = np.stack((Bx, By, Bz), axis=-1)\n    \n    v_sq = np.sum(v**2, axis=1)\n    B_sq = np.sum(B**2, axis=1)\n    \n    e_th = U[:, 7] - 0.5 * rho * v_sq - 0.5 * B_sq\n    p = (GAMMA - 1.0) * e_th\n    \n    return rho, v, B, p\n\ndef get_physical_flux(U, prim_vars):\n    \"\"\"\n    Calculate the physical MHD flux vector in the x-direction.\n    U: (N, 8) array of conservative variables.\n    prim_vars: tuple of (rho, v, B, p) arrays.\n    Returns: F, an (N, 8) array of physical fluxes.\n    \"\"\"\n    rho, v, B, p = prim_vars\n    vx, vy, vz = v[:, 0], v[:, 1], v[:, 2]\n    Bx, By, Bz = B[:, 0], B[:, 1], B[:, 2]\n    \n    B_sq = np.sum(B**2, axis=1)\n    p_tot = p + 0.5 * B_sq\n    \n    F = np.zeros_like(U)\n    F[:, 0] = rho * vx\n    F[:, 1] = rho * vx**2 + p_tot - Bx**2\n    F[:, 2] = rho * vx * vy - Bx * By\n    F[:, 3] = rho * vx * vz - Bx * Bz\n    F[:, 4] = 0.0\n    F[:, 5] = vy * Bx - vx * By\n    F[:, 6] = vz * Bx - vx * Bz\n    \n    v_dot_B = np.sum(v * B, axis=1)\n    F[:, 7] = (U[:, 7] + p_tot) * vx - v_dot_B * Bx\n    \n    return F\n\ndef get_source_terms(U, prim_vars, q, Omega):\n    \"\"\"\n    Calculate the shearing-box source terms.\n    U: (N, 8) array of conservative variables.\n    prim_vars: tuple of (rho, v, B, p) arrays.\n    q, Omega: shear parameter and angular velocity.\n    Returns: S, an (N, 8) array of source terms.\n    \"\"\"\n    if Omega == 0.0:\n        return np.zeros_like(U)\n\n    rho, v, B, _ = prim_vars\n    vx, vy = v[:, 0], v[:, 1]\n    Bx, By = B[:, 0], B[:, 1]\n    \n    S = np.zeros_like(U)\n    \n    # Momentum sources\n    S[:, 1] = 2.0 * rho * Omega * vy\n    S[:, 2] = -(2.0 - q) * rho * Omega * vx\n    \n    # Induction sources\n    S[:, 5] = -q * Omega * Bx\n    \n    # Energy source (work done by other sources)\n    # S_E = q * rho * Omega * vx * vy - q * Omega * Bx * By\n    S[:, 7] = q * Omega * (U[:, 1] * U[:, 2] / rho - U[:, 4] * U[:, 5])\n\n    return S\n\ndef get_max_wave_speed(prim_vars):\n    \"\"\"\n    Calculate the maximum characteristic wave speed over the grid.\n    prim_vars: tuple of (rho, v, B, p) arrays.\n    Returns: a_max, a scalar float.\n    \"\"\"\n    rho, v, B, p = prim_vars\n    # Ensure positivity for stability\n    rho_safe = np.maximum(rho, 1e-100)\n    p_safe = np.maximum(p, 1e-100)\n\n    c_s_sq = GAMMA * p_safe / rho_safe\n    v_A_sq = np.sum(B**2, axis=1) / rho_safe\n    v_Ax_sq = B[:, 0]**2 / rho_safe\n    \n    radicand = (c_s_sq + v_A_sq)**2 - 4.0 * c_s_sq * v_Ax_sq\n    radicand = np.maximum(radicand, 0.0) # Ensure non-negative\n    \n    c_f_sq = 0.5 * (c_s_sq + v_A_sq + np.sqrt(radicand))\n    c_f = np.sqrt(c_f_sq)\n    \n    signal_speeds = np.abs(v[:, 0]) + c_f\n    return np.max(signal_speeds)\n\ndef run_simulation_step(N, L, q, Omega, C, initial_conditions_func):\n    \"\"\"\n    Performs a single time step for a given test case and computes the energy residual.\n    \"\"\"\n    dx = L / N\n    x = (np.arange(N) + 0.5) * dx\n    \n    # 1. Set up initial conditions\n    rho, v, B, p = initial_conditions_func(x)\n    \n    U = np.zeros((N, 8))\n    U[:, 0] = rho\n    U[:, 1:4] = rho[:, np.newaxis] * v\n    U[:, 4:7] = B\n    e_th = p / (GAMMA - 1.0)\n    U[:, 7] = e_th + 0.5 * rho * np.sum(v**2, axis=1) + 0.5 * np.sum(B**2, axis=1)\n    \n    # 2. Compute total initial energy and primitives\n    total_energy_initial = np.sum(U[:, 7])\n    prim_vars = cons_to_prim(U)\n    \n    # 3. Compute time step\n    a_max = get_max_wave_speed(prim_vars)\n    dt_cfl = dx / a_max\n    \n    if Omega != 0.0:\n        dt_source = 1.0 / np.abs(Omega)\n        dt = C * min(dt_cfl, dt_source)\n    else:\n        dt = C * dt_cfl\n        \n    # 4. Compute source terms and total energy source work\n    S = get_source_terms(U, prim_vars, q, Omega)\n    total_energy_source_work = dt * np.sum(S[:, 7])\n    \n    # 5. Compute numerical fluxes (Rusanov)\n    F_physical = get_physical_flux(U, prim_vars)\n    F_hat = np.zeros((N, 8))\n    \n    for i in range(N):\n        i_right = (i + 1) % N\n        U_L, U_R = U[i, :], U[i_right, :]\n        F_L, F_R = F_physical[i, :], F_physical[i_right, :]\n        \n        F_hat[i, :] = 0.5 * (F_L + F_R) - 0.5 * a_max * (U_R - U_L)\n        \n    # 6. Update conservative state vector\n    U_new = np.copy(U)\n    for i in range(N):\n        i_left_flux = (i - 1 + N) % N\n        flux_divergence = (F_hat[i, :] - F_hat[i_left_flux, :]) / dx\n        U_new[i, :] = U[i, :] - dt * flux_divergence + dt * S[i, :]\n        \n    # 7. Compute final total energy\n    total_energy_final = np.sum(U_new[:, 7])\n    \n    # 8. Compute and return residual\n    residual = total_energy_final - total_energy_initial - total_energy_source_work\n    return residual\n\ndef solve():\n    N = 64\n    L = 1.0\n    C = 0.3\n    \n    # Test case definitions\n    test_cases_params = [\n        {'q': 0.0, 'Omega': 1.0},\n        {'q': 1.5, 'Omega': 1.0},\n        {'q': 0.0, 'Omega': 0.0},\n        {'q': 0.0, 'Omega': 0.0},\n    ]\n\n    def ic_case1(x):\n        N_pts = len(x)\n        rho = np.full(N_pts, 1.0)\n        p = np.full(N_pts, 1.0)\n        v = np.zeros((N_pts, 3))\n        v[:, 0] = 0.3\n        v[:, 1] = 0.2\n        B = np.zeros((N_pts, 3))\n        return rho, v, B, p\n\n    def ic_case2(x):\n        N_pts = len(x)\n        rho = np.full(N_pts, 1.0)\n        p = np.full(N_pts, 1.0)\n        v = np.zeros((N_pts, 3))\n        B = np.zeros((N_pts, 3))\n        B[:, 0] = 0.5\n        B[:, 1] = 0.3\n        return rho, v, B, p\n\n    def ic_case3(x):\n        N_pts = len(x)\n        rho = np.full(N_pts, 1.0)\n        p = np.full(N_pts, 1.0)\n        v = np.zeros((N_pts, 3))\n        v[:, 0] = 0.5 * np.sin(2.0 * np.pi * x)\n        B = np.zeros((N_pts, 3))\n        return rho, v, B, p\n\n    def ic_case4(x):\n        N_pts = len(x)\n        rho = np.full(N_pts, 1.0)\n        p = np.full(N_pts, 1.0)\n        v = np.zeros((N_pts, 3))\n        v[:, 1] = 0.3 * np.cos(2.0 * np.pi * x)\n        B = np.zeros((N_pts, 3))\n        B[:, 0] = 0.5\n        B[:, 1] = 0.2 * np.sin(2.0 * np.pi * x)\n        return rho, v, B, p\n\n    initial_conditions_funcs = [ic_case1, ic_case2, ic_case3, ic_case4]\n    \n    results = []\n    for i in range(len(test_cases_params)):\n        params = test_cases_params[i]\n        ic_func = initial_conditions_funcs[i]\n        \n        residual = run_simulation_step(\n            N=N, L=L, q=params['q'], Omega=params['Omega'], C=C,\n            initial_conditions_func=ic_func\n        )\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Every numerical scheme, no matter how sophisticated, introduces a small amount of dissipation at the grid scale. This numerical dissipation acts like an effective resistivity ($\\eta_{\\mathrm{num}}$) and viscosity ($\\nu_{\\mathrm{num}}$), which can significantly influence the physics of the MRI. This practice provides a powerful, hands-on method to measure these coefficients directly from your code by analyzing the decay rate of linear MHD waves . By quantifying your solver's implicit dissipation, you can better understand its behavior and determine the effective numerical magnetic Prandtl number ($\\mathrm{Pm}_{\\mathrm{num}} = \\nu_{\\mathrm{num}} / \\eta_{\\mathrm{num}}$), a critical parameter governing MRI turbulence.",
            "id": "3521904",
            "problem": "You are asked to design and implement a program that infers the effective numerical magnetic diffusivity (resistivity) and kinematic viscosity introduced by a given discretization in Magnetohydrodynamics (MHD), by measuring decay rates of small-amplitude linear waves. This is directly relevant to modeling the Magnetorotational Instability (MRI), where the numerical magnetic Prandtl number controls linear growth and saturation. Your program must be based on first principles of linear resistive-viscous MHD, not on empirically guessed formulas, and must be logically deduced from fundamental equations.\n\nConsider a uniform, electrically conducting, compressible fluid with constant mass density $\\rho_0$ and uniform background magnetic field magnitude $B_0$. Let $\\mu_0$ denote the vacuum magnetic permeability, and $c_s$ the isothermal sound speed. The numerical discretization of a conservative MHD scheme can be modeled as adding effective Laplacian terms with constant coefficients to the linearized equations: an effective kinematic viscosity $\\nu_{\\mathrm{num}}$ acting on the velocity field, and an effective resistivity $\\eta_{\\mathrm{num}}$ acting on the magnetic field. For small-amplitude plane waves of wavenumber $k$ and angular frequency $\\omega$, the wave amplitude $A(t)$ decays exponentially in time, $A(t) \\propto \\exp(-\\gamma t)$, where $\\gamma$ is the decay rate. The aim is to derive from first principles explicit formulas that relate $\\gamma$ to $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$ for two specific geometries:\n\n1. A transverse Alfvén wave propagating parallel to the background magnetic field ($\\boldsymbol{k} \\parallel \\boldsymbol{B}_0$). This mode is incompressible and has ideal phase speed $v_A = B_0/\\sqrt{\\mu_0 \\rho_0}$.\n\n2. A fast magnetosonic compressive wave propagating perpendicular to the background magnetic field ($\\boldsymbol{k} \\perp \\boldsymbol{B}_0$). This mode has ideal phase speed $c_f = \\sqrt{c_s^2 + v_A^2}$.\n\nStarting from the fundamental resistive-viscous MHD equations, linearize about the uniform background, and use plane-wave ansatz to derive the relationships linking the decay rate $\\gamma$ to $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$ for each of the above two wave geometries. Your derivation must be based solely on conservation laws and linear mode energetics; you must not use any pre-memorized shortcut formulas. Your result should express $\\gamma$ in terms of $k$, $\\nu_{\\mathrm{num}}$, $\\eta_{\\mathrm{num}}$, $c_s$, and $v_A$ for each wave type. You will then construct an algorithm that, given measured $\\gamma$ values for both wave types at the same $k$ and the same background state $(\\rho_0, B_0, c_s)$, solves for $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$, and reports the numerical magnetic Prandtl number, defined as $\\mathrm{Pm}_{\\mathrm{num}} = \\nu_{\\mathrm{num}} / \\eta_{\\mathrm{num}}$.\n\nUnits and conventions:\n- Use the International System of Units (SI). All inputs must be interpreted as SI quantities. You must compute and report $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$ in $\\mathrm{m}^2/\\mathrm{s}$ internally, and report the final $\\mathrm{Pm}_{\\mathrm{num}}$ as a dimensionless float.\n- Angles, if any, must be in radians. In this problem, you will use $\\theta = 0$ for the Alfvén wave and $\\theta = \\pi/2$ for the fast magnetosonic wave.\n\nTest suite:\nYou must apply your algorithm to the following five test cases. In each case, the background parameters $(\\rho_0, B_0, c_s)$, the wavenumber $k$, and the measured decay rates $(\\gamma_A, \\gamma_F)$ are provided. The Alfvén decay rate $\\gamma_A$ corresponds to the transverse Alfvén wave with $\\boldsymbol{k} \\parallel \\boldsymbol{B}_0$, and the fast magnetosonic decay rate $\\gamma_F$ corresponds to the compressive fast mode with $\\boldsymbol{k} \\perp \\boldsymbol{B}_0$. All quantities are in SI units; decay rates are in $\\mathrm{s}^{-1}$, wavenumbers are in $\\mathrm{m}^{-1}$, $B_0$ is in $\\mathrm{T}$, $\\rho_0$ in $\\mathrm{kg}/\\mathrm{m}^3$, and $c_s$ in $\\mathrm{m}/\\mathrm{s}$.\n\n- Case 1 (gas-pressure-dominated):\n  $\\rho_0 = 1.0 \\times 10^{-6}$, $B_0 = 1.0 \\times 10^{-3}$, $c_s = 1.0 \\times 10^{4}$, $k = 1.0 \\times 10^{-6}$,\n  measured $\\gamma_A = 3.500000 \\times 10^{-12}$, measured $\\gamma_F = 2.507943 \\times 10^{-12}$.\n\n- Case 2 (magnetically dominated):\n  $\\rho_0 = 1.0 \\times 10^{-8}$, $B_0 = 3.0 \\times 10^{-3}$, $c_s = 2.0 \\times 10^{3}$, $k = 5.0 \\times 10^{-7}$,\n  measured $\\gamma_A = 1.375000 \\times 10^{-12}$, measured $\\gamma_F = 1.368375 \\times 10^{-12}$.\n\n- Case 3 (near balance $v_A \\sim c_s$):\n  $\\rho_0 = 5.0 \\times 10^{-7}$, $B_0 = 2.0 \\times 10^{-3}$, $c_s = 3.0 \\times 10^{3}$, $k = 2.0 \\times 10^{-6}$,\n  measured $\\gamma_A = 9.000000 \\times 10^{-12}$, measured $\\gamma_F = 5.484375 \\times 10^{-12}$.\n\n- Case 4 (very gas-pressure-dominated):\n  $\\rho_0 = 2.0 \\times 10^{-6}$, $B_0 = 5.0 \\times 10^{-4}$, $c_s = 2.0 \\times 10^{4}$, $k = 1.5 \\times 10^{-6}$,\n  measured $\\gamma_A = 2.812500 \\times 10^{-12}$, measured $\\gamma_F = 2.250140 \\times 10^{-12}$.\n\n- Case 5 (extremely magnetically dominated):\n  $\\rho_0 = 1.0 \\times 10^{-9}$, $B_0 = 5.0 \\times 10^{-3}$, $c_s = 1.0 \\times 10^{3}$, $k = 8.0 \\times 10^{-7}$,\n  measured $\\gamma_A = 3.360000 \\times 10^{-13}$, measured $\\gamma_F = 3.359946 \\times 10^{-13}$.\n\nAlgorithmic requirements:\n- From first principles, derive the two decay-rate formulas and the resulting inversion expressions for $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$ in terms of the measured $\\gamma_A$ and $\\gamma_F$ and the known $(k, c_s, v_A)$.\n- Implement a robust solver that, for each test case, computes $v_A = B_0/\\sqrt{\\mu_0 \\rho_0}$, inverts the measured decay rates to estimate $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$, and computes $\\mathrm{Pm}_{\\mathrm{num}}$.\n- If the algebraic inversion becomes ill-conditioned due to $1 - v_A^2/(c_s^2 + v_A^2)$ being extremely small, you must still return a finite float based on double-precision arithmetic, provided the denominator is strictly positive. If the denominator is non-positive, treat the case as invalid and return a Not-a-Number value encoded as a floating-point NaN.\n\nFinal output specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is the dimensionless numerical magnetic Prandtl number for the corresponding test case, rounded to six decimal places. For example, the output format must look like \"[x1,x2,x3,x4,x5]\" where each xi is a decimal float with six digits after the decimal point, in the same order as the test suite above.",
            "solution": "The problem statement is scientifically sound, self-contained, and well-posed. It describes a standard method in computational astrophysics for quantifying numerical dissipation. I will proceed with a solution based on first principles.\n\nThe starting point is the set of linearized, compressible, resistive, and viscous magnetohydrodynamic (MHD) equations for perturbations about a static, uniform background with density $\\rho_0$, magnetic field $\\boldsymbol{B}_0$, and isothermal sound speed $c_s$. The numerical scheme's dissipative effects are modeled by an effective kinematic viscosity $\\nu_{\\mathrm{num}}$ and an effective magnetic resistivity $\\eta_{\\mathrm{num}}$. The equations are:\n\n1.  Continuity: $\\frac{\\partial \\rho_1}{\\partial t} + \\rho_0 \\nabla \\cdot \\boldsymbol{v}_1 = 0$\n2.  Momentum: $\\rho_0 \\frac{\\partial \\boldsymbol{v}_1}{\\partial t} = -c_s^2 \\nabla \\rho_1 + \\frac{1}{\\mu_0} (\\nabla \\times \\boldsymbol{b}_1) \\times \\boldsymbol{B}_0 + \\rho_0 \\nu_{\\mathrm{num}} \\nabla^2 \\boldsymbol{v}_1$\n3.  Induction: $\\frac{\\partial \\boldsymbol{b}_1}{\\partial t} = \\nabla \\times (\\boldsymbol{v}_1 \\times \\boldsymbol{B}_0) + \\eta_{\\mathrm{num}} \\nabla^2 \\boldsymbol{b}_1$\n\nHere, $\\rho_1$, $\\boldsymbol{v}_1$, and $\\boldsymbol{b}_1$ are the small-amplitude perturbations in density, velocity, and magnetic field, respectively. $\\mu_0$ is the vacuum permeability. We adopt a plane-wave ansatz for all perturbed quantities, of the form $f_1 \\propto \\exp[i(\\boldsymbol{k} \\cdot \\boldsymbol{r} - \\omega t)]$, where $\\boldsymbol{k}$ is the wavevector and $\\omega$ is the complex angular frequency. This substitution transforms the differential operators as $\\frac{\\partial}{\\partial t} \\rightarrow -i\\omega$ and $\\nabla \\rightarrow i\\boldsymbol{k}$. A complex frequency $\\omega = \\omega_r + i\\omega_i$ with a negative imaginary part $\\omega_i  0$ corresponds to a temporal decay $e^{\\omega_i t}$. The problem defines the decay rate as $\\gamma = -\\omega_i  0$.\n\n### Case 1: Transverse Alfvén Wave ($\\boldsymbol{k} \\parallel \\boldsymbol{B}_0$)\nFor this geometry, we can align the coordinate system such that $\\boldsymbol{B}_0 = B_0 \\hat{\\boldsymbol{z}}$ and $\\boldsymbol{k} = k \\hat{\\boldsymbol{z}}$. This wave mode is incompressible, meaning $\\nabla \\cdot \\boldsymbol{v}_1 = 0$, which implies $\\boldsymbol{k} \\cdot \\boldsymbol{v}_1 = 0$. From the continuity equation, this also means $\\rho_1 = 0$ (for a non-zero frequency $\\omega$). The momentum equation thus loses its pressure gradient term. The linearized equations become:\n$$ -i\\omega \\rho_0 \\boldsymbol{v}_1 = \\frac{1}{\\mu_0} (i\\boldsymbol{k} \\times \\boldsymbol{b}_1) \\times \\boldsymbol{B}_0 - \\rho_0 \\nu_{\\mathrm{num}} k^2 \\boldsymbol{v}_1 $$\n$$ -i\\omega \\boldsymbol{b}_1 = i\\boldsymbol{k} \\times (\\boldsymbol{v}_1 \\times \\boldsymbol{B}_0) - \\eta_{\\mathrm{num}} k^2 \\boldsymbol{b}_1 $$\nUsing the vector identity for the triple cross product and the conditions $\\boldsymbol{k} \\parallel \\boldsymbol{B}_0$ and $\\boldsymbol{k} \\cdot \\boldsymbol{v}_1 = 0$, these simplify to a coupled system for the transverse perturbations $\\boldsymbol{v}_1$ and $\\boldsymbol{b}_1$:\n$$ (-i\\omega + \\nu_{\\mathrm{num}} k^2) \\rho_0 \\boldsymbol{v}_1 = \\frac{i}{\\mu_0} (\\boldsymbol{k} \\cdot \\boldsymbol{B}_0) \\boldsymbol{b}_1 $$\n$$ (-i\\omega + \\eta_{\\mathrm{num}} k^2) \\boldsymbol{b}_1 = i (\\boldsymbol{k} \\cdot \\boldsymbol{B}_0) \\boldsymbol{v}_1 $$\nFor a non-trivial solution to exist, the determinant of the coefficients must be zero. This yields the dispersion relation:\n$$ (-i\\omega + \\nu_{\\mathrm{num}} k^2) (-i\\omega + \\eta_{\\mathrm{num}} k^2) = \\frac{(\\boldsymbol{k} \\cdot \\boldsymbol{B}_0)^2}{\\mu_0 \\rho_0} = k^2 v_A^2 $$\nwhere $v_A = B_0 / \\sqrt{\\mu_0 \\rho_0}$ is the ideal Alfvén speed. To find the decay rate, we assume dissipation is weak, so the frequency is a small perturbation from the ideal frequency $\\omega_0 = k v_A$. Let $\\omega = \\omega_0 - i\\gamma_A = k v_A - i\\gamma_A$, where $\\gamma_A$ is small. Substituting this into the dispersion relation and keeping only first-order terms in $\\nu_{\\mathrm{num}}$, $\\eta_{\\mathrm{num}}$, and $\\gamma_A$:\n$$ (-i(k v_A - i\\gamma_A) + \\nu_{\\mathrm{num}} k^2) (-i(k v_A - i\\gamma_A) + \\eta_{\\mathrm{num}} k^2) \\approx -k^2 v_A^2 $$\n$$ (-\\gamma_A - ik v_A + \\nu_{\\mathrm{num}} k^2) (-\\gamma_A - ik v_A + \\eta_{\\mathrm{num}} k^2) \\approx -k^2 v_A^2 $$\nExpanding and linearizing gives:\n$$ (-ik v_A)^2 - ik v_A(\\nu_{\\mathrm{num}}k^2 - \\gamma_A) - ik v_A(\\eta_{\\mathrm{num}}k^2 - \\gamma_A) \\approx -k^2 v_A^2 $$\n$$ -k^2 v_A^2 - ik^3 v_A (\\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}}) + 2i k v_A \\gamma_A \\approx -k^2 v_A^2 $$\n$$ 2 \\gamma_A = k^2 (\\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}}) $$\nThis gives our first relation for the decay rate of the Alfvén wave:\n$$ \\gamma_A = \\frac{1}{2} k^2 (\\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}}) $$\n\n### Case 2: Fast Magnetosonic Wave ($\\boldsymbol{k} \\perp \\boldsymbol{B}_0$)\nFor this case, we choose $\\boldsymbol{B}_0 = B_0 \\hat{\\boldsymbol{z}}$ and $\\boldsymbol{k} = k \\hat{\\boldsymbol{x}}$, so $\\boldsymbol{k} \\cdot \\boldsymbol{B}_0 = 0$. The wave is compressive, so $\\rho_1 \\ne 0$. The linearized equations become:\n$$ \\omega \\rho_1 = \\rho_0 (k v_{1x}) $$\n$$ (-i\\omega + \\nu_{\\mathrm{num}} k^2) \\rho_0 \\boldsymbol{v}_1 = -i c_s^2 \\boldsymbol{k} \\rho_1 - \\frac{i}{\\mu_0} (\\boldsymbol{b}_1 \\cdot \\boldsymbol{B}_0) \\boldsymbol{k} $$\n$$ (-i\\omega + \\eta_{\\mathrm{num}} k^2) \\boldsymbol{b}_1 = -i (\\boldsymbol{k} \\cdot \\boldsymbol{v}_1) \\boldsymbol{B}_0 $$\nThe induction equation shows that the magnetic perturbation $\\boldsymbol{b}_1$ is parallel to $\\boldsymbol{B}_0$. The momentum equation's force terms are all directed along $\\boldsymbol{k}$, so the velocity perturbation is longitudinal, $\\boldsymbol{v}_1 = v_{1x} \\hat{\\boldsymbol{x}}$. Combining these gives the dispersion relation:\n$$ (-i\\omega + \\nu_{\\mathrm{num}} k^2) = \\frac{c_s^2 k^2}{-i\\omega} + \\frac{v_A^2 k^2}{-i\\omega + \\eta_{\\mathrm{num}} k^2} $$\nAgain, we perturb around the ideal solution, whose frequency $\\omega_0$ satisfies $\\omega_0^2 = (c_s^2 + v_A^2)k^2 = c_f^2 k^2$. Let $\\omega = \\omega_0 - i\\gamma_F$. Substituting and linearizing yields:\n$$ \\gamma_F = \\frac{1}{2} k^2 \\left( \\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}} \\frac{v_A^2}{c_s^2 + v_A^2} \\right) $$\n\n### Inversion for $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$\nWe now have a system of two linear equations for the two unknowns $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$ based on the measured decay rates $\\gamma_A$ and $\\gamma_F$:\n1. $2\\gamma_A / k^2 = \\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}}$\n2. $2\\gamma_F / k^2 = \\nu_{\\mathrm{num}} + \\eta_{\\mathrm{num}} \\frac{v_A^2}{c_s^2 + v_A^2}$\n\nLet $\\Gamma_A = 2\\gamma_A/k^2$ and $\\Gamma_F = 2\\gamma_F/k^2$. Let $f = v_A^2 / (c_s^2 + v_A^2)$.\nSubtracting the second equation from the first gives:\n$\\Gamma_A - \\Gamma_F = \\eta_{\\mathrm{num}}(1-f)$\nNoting that $1-f = 1 - \\frac{v_A^2}{c_s^2+v_A^2} = \\frac{c_s^2}{c_s^2+v_A^2}$, we solve for $\\eta_{\\mathrm{num}}$:\n$$ \\eta_{\\mathrm{num}} = \\frac{\\Gamma_A - \\Gamma_F}{1 - f} = \\frac{2(\\gamma_A - \\gamma_F)}{k^2} \\left( \\frac{c_s^2 + v_A^2}{c_s^2} \\right) $$\nWe can then find $\\nu_{\\mathrm{num}}$ from the first equation: $\\nu_{\\mathrm{num}} = \\Gamma_A - \\eta_{\\mathrm{num}}$. This can be expressed as:\n$$ \\nu_{\\mathrm{num}} = \\frac{\\Gamma_F - f \\Gamma_A}{1 - f} = \\frac{2}{k^2 c_s^2} \\left[ \\gamma_F(c_s^2+v_A^2) - \\gamma_A v_A^2 \\right] $$\nThe numerical magnetic Prandtl number is $\\mathrm{Pm}_{\\mathrm{num}} = \\nu_{\\mathrm{num}} / \\eta_{\\mathrm{num}}$. Dividing the expressions for $\\nu_{\\mathrm{num}}$ and $\\eta_{\\mathrm{num}}$:\n$$ \\mathrm{Pm}_{\\mathrm{num}} = \\frac{\\nu_{\\mathrm{num}}}{\\eta_{\\mathrm{num}}} = \\frac{\\gamma_F(c_s^2+v_A^2) - \\gamma_A v_A^2}{(\\gamma_A - \\gamma_F)(c_s^2+v_A^2)} $$\nThis is the final expression implemented in the program.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Infers effective numerical magnetic diffusivity and kinematic viscosity\n    by measuring decay rates of small-amplitude linear MHD waves. It then\n    calculates the numerical magnetic Prandtl number.\n    \"\"\"\n    \n    # Use the precise value of mu_0 from scipy.constants as required for the\n    # test cases, which are designed around this standard value.\n    mu_0 = constants.mu_0\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains: (rho_0, B_0, c_s, k, gamma_A, gamma_F)\n    # All values are in SI units.\n    test_cases = [\n        # Case 1 (gas-pressure-dominated)\n        (1.0e-6, 1.0e-3, 1.0e4, 1.0e-6, 3.5e-12, 2.507943e-12),\n        # Case 2 (magnetically dominated)\n        (1.0e-8, 3.0e-3, 2.0e3, 5.0e-7, 1.375e-12, 1.368375e-12),\n        # Case 3 (near balance v_A ~ c_s)\n        (5.0e-7, 2.0e-3, 3.0e3, 2.0e-6, 9.0e-12, 5.484375e-12),\n        # Case 4 (very gas-pressure-dominated)\n        (2.0e-6, 5.0e-4, 2.0e4, 1.5e-6, 2.8125e-12, 2.250140e-12),\n        # Case 5 (extremely magnetically dominated)\n        (1.0e-9, 5.0e-3, 1.0e3, 8.0e-7, 3.36e-13, 3.359946e-13),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_0, B_0, c_s, k, gamma_A, gamma_F = case\n\n        # Calculate squared speeds: Alfvén, sound, and fast magnetosonic\n        v_A_sq = B_0**2 / (mu_0 * rho_0)\n        c_s_sq = c_s**2\n        c_f_sq = c_s_sq + v_A_sq\n\n        # The term c_s^2 is the denominator in the inversion for nu_num and eta_num.\n        # The problem asks to return NaN if a denominator is non-positive.\n        # For all test cases, c_s  0, so c_s^2  0.\n        if c_s_sq = 0:\n            results.append(np.nan)\n            continue\n        \n        # Calculate the numerical magnetic Prandtl number, Pm_num = nu_num / eta_num,\n        # using the derived formula:\n        # Pm_num = (gamma_F * c_f^2 - gamma_A * v_A^2) / ((gamma_A - gamma_F) * c_f^2)\n        # This form is robust when implemented with double-precision floats.\n        numerator = gamma_F * c_f_sq - gamma_A * v_A_sq\n        denominator = (gamma_A - gamma_F) * c_f_sq\n        \n        # Avoid division by zero, which physically corresponds to eta_num = 0,\n        # leading to an infinite Prandtl number.\n        if abs(denominator)  1e-40:\n             pm_num = np.inf\n        else:\n             pm_num = numerator / denominator\n        \n        results.append(pm_num)\n\n    # Format the results as a list of strings with 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}