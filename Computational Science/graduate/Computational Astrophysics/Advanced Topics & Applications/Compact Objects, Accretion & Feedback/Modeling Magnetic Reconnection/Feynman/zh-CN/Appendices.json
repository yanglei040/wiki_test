{
    "hands_on_practices": [
        {
            "introduction": "磁重联的核心问题之一是确定其速率。本练习将指导您从基本物理原理出发，构建一个简化的稳态重联模型，即 Sweet-Parker 模型。通过这个实践，您将推导并实现决定重联率和电流片结构的关键标度律，并探索引导场（guide field）和三维效应对重联过程（如能量耗散和粒子加速）的影响 。",
            "id": "3519794",
            "problem": "您的任务是开发一个完整、可运行的程序，该程序为一个带有均匀引导场的哈里斯电流片实现一个简化的稳态磁重联模型。您的目标是比较二维和三维几何结构中，作为引导场比率函数的重联率和能量分布指标。您必须从标准的电磁和流体方程开始推导，并构建一个最小但科学上一致的模型，该模型能够为一组指定的测试套件提供以下输出。\n\n建模框架与假设：\n- 使用麦克斯韦方程组和磁流体力学（MHD）的电阻形式作为基本基础。具体来说，使用电阻性MHD中的欧姆定律 $\\,\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta_{\\mathrm{eff}} \\mathbf{J}\\,$，安培定律 $\\,\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}\\,$，以及坡印亭定理将 $\\,\\mathbf{J}\\cdot \\mathbf{E}\\,$ 与能量转换联系起来。\n- 考虑一个哈里斯片平衡，其重联场为 $\\,B_x(y) = B_0 \\tanh(y/a)\\,$，均匀引导场为 $\\,B_z = B_g\\,$。取上游重联场的大小 $\\,B_{\\mathrm{up}} = B_0\\,$ 和等离子体质量密度 $\\,\\rho = m_i n\\,$ 来定义阿尔芬速度 $\\,V_A = B_{\\mathrm{up}}/\\sqrt{\\mu_0 \\rho}\\,$。\n- 假设一个稳态、不可压缩的类 Sweet–Parker 平衡，以关联流入速度、片层厚度和X点处的重联电场，仅使用所述的基本定律和守恒原理（不要假设任何经验性的重联率常数）。\n- 通过有效电阻率模型来区分几何结构：\n  - 对于二维几何结构：$\\,\\eta_{\\mathrm{eff}} = \\eta_0\\,$。\n  - 对于三维几何结构：包含一个依赖于引导场的异常贡献 $\\,\\eta_{\\mathrm{eff}} = \\eta_0 \\left[1 + \\alpha \\left(B_g/B_0\\right)^2\\right]\\,$，其中 $\\,\\alpha\\,$ 是一个给定的无量纲常数，用于捕捉三维中由湍流引起的增强效应。这是一个参数化闭合，必须在推导和计算中保持一致使用。\n- 定义一个稳态电流片半长 $\\,L\\,$，并根据类 Sweet-Parker 平衡自洽地计算半厚度 $\\,\\delta\\,$。使用 $\\,\\delta\\,$ 来估计峰值电流密度 $\\,J_{\\mathrm{peak}} \\approx B_{\\mathrm{up}}/(\\mu_0 \\delta)\\,$。\n- 对于引导场方向上单位跨度的片内积分耗散（即沿 $\\,z\\,$ 方向的单位长度功率，单位为瓦/米），使用类哈里斯形状 $\\,J_z(y) \\propto \\mathrm{sech}^2(y/\\delta)\\,$ 来近似\n  $$P' \\equiv \\int \\eta_{\\mathrm{eff}} J^2 \\, dA \\approx \\eta_{\\mathrm{eff}} J_{\\mathrm{peak}}^2 \\times \\frac{8 L \\delta}{3},$$\n  其中因子 $\\,4\\delta/3\\,$ 来自于 $\\,\\int_{-\\infty}^{\\infty} \\mathrm{sech}^4(y/\\delta)\\, dy = 4\\delta/3\\,$，面积为 $\\,2L \\times (2\\delta)\\,$。\n- 将 X 点处的重联电场定义为 $\\,E_{\\mathrm{rec}}\\,$，无量纲重联率定义为 $\\,R \\equiv E_{\\mathrm{rec}}/(B_{\\mathrm{up}} V_A)\\,$。\n- 为表征平行电场，评估在位置 $\\,y=\\delta\\,$ 处平行于磁场的重联电场的分量。在该位置，使用 $\\,B_x(\\delta) = B_0 \\tanh(1)\\,$，因此局部磁场大小为 $\\,|\\mathbf{B}| = \\sqrt{B_g^2 + \\left[B_0 \\tanh(1)\\right]^2}\\,$，并设置\n  $$E_{\\parallel} = E_{\\mathrm{rec}} \\times \\frac{|B_g|}{\\sqrt{B_g^2 + \\left[B_0 \\tanh(1)\\right]^2}}.$$\n- 为量化可归因于平行电场的耗散部分，近似该分数\n  $$f_{\\parallel} = \\frac{B_g^2}{B_g^2 + \\left[B_0 \\tanh(1)\\right]^2},$$\n  并计算由于平行场而在 $\\,z\\,$ 方向上单位跨度对应的粒子能量化代理指标为 $\\,P'_{\\parallel} = f_{\\parallel} \\, P'.$\n\n使用的物理常数和参数，全部采用国际单位制（SI）：\n- 真空磁导率 $\\,\\mu_0 = 4\\pi \\times 10^{-7}\\,$。\n- 重联场 $\\,B_0 = 10^{-2}\\,$ 特斯拉。\n- 数密度 $\\,n = 10^{15}\\,$ 每立方米。\n- 离子质量 $\\,m_i = 1.6726219 \\times 10^{-27}\\,$ 千克。\n- 半长 $\\,L = 10^{4}\\,$ 米。\n- 基准电阻率 $\\,\\eta_0 = 10^{-6}\\,$ 欧姆-米。\n- 三维异常系数 $\\,\\alpha = 0.3\\,$（无量纲）。\n\n每个测试用例需要计算的量：\n- 无量纲重联率 $\\,R\\,$。\n- $\\,z\\,$ 方向上单位跨度的片内积分耗散 $\\,P'\\,$，单位为瓦/米。\n- 在 $\\,y=\\delta\\,$ 处的平行电场大小 $\\,E_{\\parallel}\\,$，单位为伏特/米。\n- 平行场粒子能量化代理指标 $\\,P'_{\\parallel}\\,$，单位为瓦/米。\n\n角度使用：\n- 函数 $\\,\\tanh(1)\\,$ 是无量纲的，并使用标准的数学双曲正切函数；不涉及角度单位。\n\n测试套件：\n使用以下包含六个测试用例的有序列表，每个用例由几何结构和引导场比率 $\\,B_g/B_0\\,$ 指定：\n1. 二维几何结构，$\\,B_g/B_0 = 0.0\\,$。\n2. 二维几何结构，$\\,B_g/B_0 = 0.5\\,$。\n3. 二维几何结构，$\\,B_g/B_0 = 2.0\\,$。\n4. 三维几何结构，$\\,B_g/B_0 = 0.0\\,$。\n5. 三维几何结构，$\\,B_g/B_0 = 0.5\\,$。\n6. 三维几何结构，$\\,B_g/B_0 = 2.0\\,$。\n\n输出规范：\n- 对于每个测试用例，输出一个包含六个条目的列表：\n  - 一个整数几何标识符，二维为 $\\,2\\,$，三维为 $\\,3\\,$。\n  - 引导场比率 $\\,B_g/B_0\\,$，为浮点数。\n  - 无量纲重联率 $\\,R\\,$，为浮点数。\n  - 单位跨度耗散 $\\,P'\\,$，单位为瓦/米，为浮点数。\n  - 平行电场 $\\,E_{\\parallel}\\,$，单位为伏特/米，为浮点数。\n  - 平行场粒子能量化代理指标 $\\,P'_{\\parallel}\\,$，单位为瓦/米，为浮点数。\n- 按相同顺序将六个测试用例的列表聚合到一个单一列表中。\n- 您的程序应生成单行输出，包含此聚合列表，采用类 Python 的列表语法，例如：\n  $$[\\,[\\ldots], [\\ldots], \\ldots\\,].$$\n- 所有物理量均按规定使用国际单位制（SI）表示。所有浮点数打印时四舍五入至六位有效数字。\n\n您的程序必须是一个单一、完整、可运行的脚本，无需输入，并严格使用上面给出的常数和参数，同时根据所述的有效电阻率规则区分二维和三维几何结构。程序必须实现您从基本原理构建的推导，并生成所描述的精确格式的单行输出。",
            "solution": "建模始于电磁场理论和磁流体力学（MHD）的电阻形式。使用的基本关系是：\n1. 电阻性 MHD 中的欧姆定律：$\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta_{\\mathrm{eff}} \\mathbf{J}$，其中 $\\eta_{\\mathrm{eff}}$ 是有效电阻率。\n2. 安培定律（准静态，在重联尺度上可忽略位移电流）：$\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$，这允许在电流密度和磁场梯度之间建立关系。\n3. 形式为 $\\partial_t \\left( \\frac{B^2}{2\\mu_0} + \\varepsilon_0 \\frac{E^2}{2} \\right) + \\nabla \\cdot \\mathbf{S} + \\mathbf{J}\\cdot \\mathbf{E} = 0$ 的坡印亭定理，它将 $\\mathbf{J}\\cdot \\mathbf{E}$ 确定为场能量转换为等离子体内能和动能的局部速率。\n\n几何结构与场：\n我们采用一个哈里斯片，其重联场为 $B_x(y) = B_0 \\tanh(y/a)$，均匀引导场为 $B_z = B_g$。上游重联分量为 $B_{\\mathrm{up}} = B_0$，等离子体质量密度为 $\\rho = m_i n$。由此，阿尔芬速度为 $V_A = B_{\\mathrm{up}}/\\sqrt{\\mu_0 \\rho}$。\n\n重联电场与重联率：\n在稳态下，通过将流入电场与 X 点处的电阻场相等，并在出流区强制质量守恒，获得一个类 Sweet–Parker 的能量和通量平衡：\n- X 点处的重联电场满足 $E_{\\mathrm{rec}} \\approx \\eta_{\\mathrm{eff}} J_z|_{\\mathrm{X}}$，因为对流项 $\\mathbf{v}\\times\\mathbf{B}$ 在重联分量的零点处消失。对于半厚度为 $\\delta$ 的电流片，安培定律意味着 $J_z \\sim B_{\\mathrm{up}}/(\\mu_0 \\delta)$。\n- 长度为 $L$ 的出流区的质量守恒给出 $v_{\\mathrm{in}} L \\sim v_{\\mathrm{out}} \\delta$。基于重联分量和上游密度，出流速度为 $v_{\\mathrm{out}} \\sim V_A$，我们得到 $v_{\\mathrm{in}} \\sim V_A \\delta/L$。\n- 重联电场的定义也从流入区的理想感应得出 $E_{\\mathrm{rec}} \\sim v_{\\mathrm{in}} B_{\\mathrm{up}}$。\n\n结合 $E_{\\mathrm{rec}} = \\eta_{\\mathrm{eff}} B_{\\mathrm{up}}/(\\mu_0 \\delta)$ 与 $E_{\\mathrm{rec}} = v_{\\mathrm{in}} B_{\\mathrm{up}}$ 和 $v_{\\mathrm{in}} = V_A \\delta/L$ 得到\n$$ \\frac{\\eta_{\\mathrm{eff}} B_{\\mathrm{up}}}{\\mu_0 \\delta} = \\frac{V_A \\delta}{L} B_{\\mathrm{up}}, $$\n简化为\n$$ \\delta^2 = \\frac{\\eta_{\\mathrm{eff}} L}{\\mu_0 V_A}, \\qquad \\delta = \\sqrt{\\frac{\\eta_{\\mathrm{eff}} L}{\\mu_0 V_A}}. $$\n流入速度为 $v_{\\mathrm{in}} = V_A \\delta/L = \\sqrt{\\frac{\\eta_{\\mathrm{eff}} V_A}{\\mu_0 L}}$，重联电场为 $E_{\\mathrm{rec}} = v_{\\mathrm{in}} B_{\\mathrm{up}}$。因此，无量纲重联率为\n$$ R \\equiv \\frac{E_{\\mathrm{rec}}}{B_{\\mathrm{up}} V_A} = \\frac{v_{\\mathrm{in}}}{V_A} = \\sqrt{\\frac{\\eta_{\\mathrm{eff}}}{\\mu_0 L V_A}}. $$\n\n有效电阻率模型与几何结构：\n为了比较二维和三维几何结构，我们修改有效电阻率：\n- 二维：$\\eta_{\\mathrm{eff}} = \\eta_0$。\n- 三维：$\\eta_{\\mathrm{eff}} = \\eta_0\\left[1 + \\alpha \\left(B_g/B_0\\right)^2\\right]$，这表示由于三维湍流引起的参数化增强，该增强随引导场强度的增加而增加。\n\n电流密度与耗散：\n使用 Sweet–Parker 厚度，峰值电流密度为 $J_{\\mathrm{peak}} \\approx B_{\\mathrm{up}}/(\\mu_0 \\delta) = B_0/(\\mu_0 \\delta)$。通过哈里斯形式 $J_z(y) \\propto \\mathrm{sech}^2(y/\\delta)$ 近似电流片上的电流剖面，$z$方向上单位跨度的片内积分耗散为\n$$ P' \\equiv \\int \\eta_{\\mathrm{eff}} J^2 \\, dA \\approx \\eta_{\\mathrm{eff}} J_{\\mathrm{peak}}^2 \\times \\left( 2L \\right) \\times \\left( \\int_{-\\infty}^{\\infty} \\mathrm{sech}^4\\left(\\frac{y}{\\delta}\\right) dy \\right). $$\n使用 $\\int_{-\\infty}^{\\infty} \\mathrm{sech}^4(u)\\, du = 4/3$ 并代入 $u=y/\\delta$ 得到 $\\int \\mathrm{sech}^4(y/\\delta)\\, dy = 4\\delta/3$。因此\n$$ P' \\approx \\eta_{\\mathrm{eff}} J_{\\mathrm{peak}}^2 \\times \\frac{8 L \\delta}{3}. $$\n\n平行电场及其分数：\n重联电场 $E_{\\mathrm{rec}}$ 沿着电流密度方向（$z$ 方向）。在 $y=\\delta$ 附近的局部磁场为 $\\mathbf{B}(\\delta) = \\left( B_0 \\tanh(1),\\, 0,\\, B_g \\right)$。其大小为 $|\\mathbf{B}| = \\sqrt{B_g^2 + \\left[ B_0 \\tanh(1) \\right]^2}$。在 $y=\\delta$ 处电场平行分量的大小为\n$$ E_{\\parallel} = E_{\\mathrm{rec}} \\frac{|B_g|}{\\sqrt{B_g^2 + \\left[ B_0 \\tanh(1) \\right]^2}}. $$\n可归因于平行场的欧姆耗散分数的一个代理指标，由在 $y=\\delta$ 处 $\\mathbf{J}$（平行于 $\\hat{\\mathbf{z}}$）和 $\\mathbf{B}$ 之间夹角的余弦平方给出：\n$$ f_{\\parallel} = \\frac{B_g^2}{B_g^2 + \\left[ B_0 \\tanh(1) \\right]^2}, \\qquad P'_{\\parallel} = f_{\\parallel} \\, P'. $$\n\n常数与参数：\n我们使用 $\\mu_0 = 4\\pi\\times 10^{-7}$， $B_0 = 10^{-2}$， $n=10^{15}$， $m_i = 1.6726219\\times 10^{-27}$， $L=10^{4}$， $\\eta_0=10^{-6}$，以及 $\\alpha=0.3$，全部采用国际单位制（SI）。阿尔芬速度是 $V_A = B_0/\\sqrt{\\mu_0 m_i n}$，重联率使用与几何结构和引导场比率相对应的 $\\eta_{\\mathrm{eff}}$ 计算。\n\n程序中实现的算法步骤：\n1. 计算 $\\rho = m_i n$ 和 $V_A = B_0/\\sqrt{\\mu_0 \\rho}$。\n2. 对于每个测试用例，其几何标识符为 $g \\in \\{2,3\\}$，引导场比率为 $r = B_g/B_0$：\n   - 如果 $g=2$，设置 $\\eta_{\\mathrm{eff}} = \\eta_0$，否则如果 $g=3$，设置 $\\eta_{\\mathrm{eff}} = \\eta_0 \\left(1 + \\alpha r^2\\right)$。\n   - 计算 $R = \\sqrt{\\eta_{\\mathrm{eff}} / (\\mu_0 L V_A)}$ 和 $E_{\\mathrm{rec}} = R B_0 V_A$。\n   - 计算 $\\delta = R L$ 和 $J_{\\mathrm{peak}} = B_0/(\\mu_0 \\delta)$。\n   - 计算 $P' = \\eta_{\\mathrm{eff}} J_{\\mathrm{peak}}^2 \\times \\frac{8 L \\delta}{3}$。\n   - 计算 $c \\equiv \\tanh(1)$ 和 $E_{\\parallel} = E_{\\mathrm{rec}} \\cdot \\frac{|r|}{\\sqrt{r^2 + c^2}}$。\n   - 计算 $f_{\\parallel} = \\frac{r^2}{r^2 + c^2}$ 和 $P'_{\\parallel} = f_{\\parallel} P'$。\n3. 对于每个测试用例，输出列表 $[g, r, R, P', E_{\\parallel}, P'_{\\parallel}]$，其中浮点值四舍五入至六位有效数字。\n4. 按顺序将六个列表聚合到一个单一列表中，并以类 Python 列表语法的单行形式打印。\n\n单位与输出：\n- $R$ 是无量纲的。\n- $P'$ 和 $P'_{\\parallel}$ 的单位是瓦/米。\n- $E_{\\parallel}$ 的单位是伏特/米。\n- 输出以国际单位制（SI）表示，并以六位有效数字呈现，以确保可复现性。\n\n此构建基于麦克斯韦方程组和电阻性MHD，使用类 Sweet–Parker 的稳态平衡来获得重联率和电流片厚度，并采用基于哈里斯剖面的积分来估计单位跨度的耗散。三维扩展通过一个依赖于引导场的异常电阻率以参数化、科学上合理的方式表示，以便于在一系列引导场比率下对二维和三维情况进行定量比较。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef sweet_parker_results(geom_id: int, bg_over_b0: float,\n                         mu0: float, B0: float, n: float, mi: float,\n                         L: float, eta0: float, alpha: float):\n    \"\"\"\n    Compute reconnection metrics for a Harris sheet with a guide field using a resistive MHD Sweet-Parker model.\n\n    Parameters:\n        geom_id: 2 for 2D, 3 for 3D.\n        bg_over_b0: B_g / B_0 guide-field ratio (dimensionless).\n        mu0: Vacuum permeability (H/m).\n        B0: Reconnecting magnetic field (T).\n        n: Number density (1/m^3).\n        mi: Ion mass (kg).\n        L: Half-length of the current sheet (m).\n        eta0: Baseline resistivity (Ohm*m).\n        alpha: 3D anomalous coefficient (dimensionless).\n\n    Returns:\n        (R, P_per_width, E_parallel, P_parallel_per_width)\n        R: dimensionless reconnection rate.\n        P_per_width: sheet-integrated dissipation per unit span in z (W/m).\n        E_parallel: parallel electric field at y=delta (V/m).\n        P_parallel_per_width: parallel-field particle-energization proxy per unit span (W/m).\n    \"\"\"\n    rho = mi * n  # mass density (kg/m^3)\n    VA = B0 / np.sqrt(mu0 * rho)  # Alfvén speed (m/s)\n    # Effective resistivity\n    if geom_id == 2:\n        eta_eff = eta0\n    elif geom_id == 3:\n        eta_eff = eta0 * (1.0 + alpha * (bg_over_b0 ** 2))\n    else:\n        raise ValueError(\"geom_id must be 2 (2D) or 3 (3D).\")\n\n    # Dimensionless reconnection rate R = sqrt(eta_eff / (mu0 * L * VA))\n    R = np.sqrt(eta_eff / (mu0 * L * VA))\n\n    # Reconnection electric field\n    E_rec = R * B0 * VA  # V/m\n\n    # Sweet-Parker half-thickness\n    delta = R * L  # m\n\n    # Peak current density\n    J_peak = B0 / (mu0 * delta)  # A/m^2\n\n    # Integrated dissipation per unit span (W/m)\n    P_per_width = eta_eff * (J_peak ** 2) * (8.0 * L * delta / 3.0)\n\n    # Parallel electric field at y = delta\n    c = np.tanh(1.0)  # tanh(1) constant\n    # Avoid division by zero: if bg_over_b0=0, then E_parallel=0 via factor below.\n    denom = np.sqrt(bg_over_b0 ** 2 + c ** 2)\n    E_parallel = E_rec * (abs(bg_over_b0) / denom)\n\n    # Fraction of dissipation attributable to parallel fields\n    f_parallel = (bg_over_b0 ** 2) / (bg_over_b0 ** 2 + c ** 2)\n    P_parallel_per_width = f_parallel * P_per_width\n\n    return R, P_per_width, E_parallel, P_parallel_per_width\n\ndef format_value(x):\n    # Format floats to six significant figures, keep integers as-is strings\n    if isinstance(x, (int, np.integer)):\n        return str(int(x))\n    # Handle NaN or inf explicitly if they appear (should not in this model)\n    if not np.isfinite(x):\n        return str(x)\n    return f\"{x:.6g}\"\n\ndef solve():\n    # Physical constants and parameters (SI units)\n    mu0 = 4.0 * np.pi * 1e-7      # H/m\n    B0 = 1.0e-2                   # T\n    n = 1.0e15                    # 1/m^3\n    mi = 1.6726219e-27            # kg\n    L = 1.0e4                     # m\n    eta0 = 1.0e-6                 # Ohm*m\n    alpha = 0.3                   # dimensionless\n\n    # Test suite: (geometry_id, Bg/B0)\n    test_cases = [\n        (2, 0.0),\n        (2, 0.5),\n        (2, 2.0),\n        (3, 0.0),\n        (3, 0.5),\n        (3, 2.0),\n    ]\n\n    results = []\n    for geom_id, r in test_cases:\n        R, Pp, Epar, Pp_par = sweet_parker_results(\n            geom_id, r, mu0, B0, n, mi, L, eta0, alpha\n        )\n        # Build per-case result as specified: [geom_id, Bg/B0, R, P', E_parallel, P'_parallel]\n        case_result = [\n            geom_id,\n            r,\n            R,\n            Pp,\n            Epar,\n            Pp_par\n        ]\n        results.append(case_result)\n\n    # Format the aggregate list with six significant figures for floats\n    # Construct a string that looks like a Python list of lists.\n    formatted_rows = []\n    for row in results:\n        formatted_row = \"[\" + \",\".join(format_value(x) for x in row) + \"]\"\n        formatted_rows.append(formatted_row)\n    output = \"[\" + \",\".join(formatted_rows) + \"]\"\n\n    # Final print statement in the exact required format (single line)\n    print(output)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在计算模拟中，准确诊断物理量是验证模型和理解现象的关键。本练习将让您实践一种标准的磁重联率诊断技术：通过对非理想区域内的重联电场进行积分来计算磁通量的传输率。您将通过编程实现这一计算，并将其与基于理想磁流体动力学（MHD）的上游入流估算值进行比较，从而深入理解法拉第定律在重联诊断中的应用 。",
            "id": "3519733",
            "problem": "您必须编写一个完整且可运行的程序，在一个二维、平面不变的磁流体力学重联背景下，实现并验证跨越预定切面的磁通量传输率的一致性检查。目标是利用电场计算跨越垂直切面的磁通量传输率，并将其与一个独立的估计值进行比较，该估计值由流入速度乘以其上游磁场构建而成，在理想磁流体力学（MHD）条件下，这提供了重联电场的第二种度量方法。对于一小组参数选择的测试套件，必须以实值差异的形式返回结果。\n\n从以下基本原理开始：\n- 法拉第定律：$\\partial \\mathbf{B} / \\partial t = - \\nabla \\times \\mathbf{E}$，其中 $\\mathbf{B}$ 是磁场，$\\mathbf{E}$ 是电场。\n- 理想欧姆定律（在任何非理想区域之外的理想MHD极限）：$\\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B}$，其中 $\\mathbf{v}$ 是等离子体速度。\n- 在沿 $z$ 轴不变的二维重联中，可以使用磁矢量势 $\\mathbf{A} = A_z(x,y,t) \\hat{\\mathbf{z}}$，其中 $\\mathbf{B} = \\nabla \\times \\mathbf{A} = (\\partial_y A_z, -\\partial_x A_z, 0)$ 且 $E_z = - \\partial_t A_z$（在标量势没有 $z$ 依赖的规范中）。在 $B_y = 0$ 和 $v_x = 0$ 的对称中线上，理想欧姆定律在理想区域简化为 $E_z = v_y B_x$。\n\n本问题的定义：\n- 考虑在 $x = 0$ 处的一个垂直切面 $\\mathcal{C}$，从 $y = -Y_c$ 到 $y = +Y_c$，长度为 $2 Y_c$。\n- 定义跨越切面沿 $z$ 方向单位长度的通量传输率为\n$$\n\\dot{\\Phi}_{\\mathrm{cut}}(t) \\equiv \\int_{-Y_c}^{Y_c} E_z(x=0,y,t) \\, dy,\n$$\n这可由法拉第定律沿一个矩形回路积分得到，该回路使用 $\\mathcal{C}$ 作为其内部分段，并位于切向电场除 $\\mathcal{C}$ 之外可忽略不计的区域。在足够上游的理想区域中， $E_z$ 等于流入度量 $v_{\\mathrm{in}} B$，其中 $v_{\\mathrm{in}}$ 是朝向电流片的流入速度， $B$ 是重联的上游磁场分量。\n- 在测试配置中，采用一个由矢量势 $A_0(y)$ 导出的静态初始磁场构型，使得在时间 $t=0$ 时，重联磁场分量为 $B_x(y,0) = \\partial_y A_0(y) = B_0 \\tanh(y/\\delta)$，其中 $B_0 > 0$ 和 $\\delta > 0$ 是常数。\n- 在 $t=0$ 时，规定一个形式如下的电场剖面 $E_z(y)$\n$$\nE_z(y) = E_0 + E_1 \\exp\\!\\left(-\\left(\\frac{y}{w}\\right)^2\\right),\n$$\n其中包含常数 $E_0$（背景，理想贡献）、$E_1$（非理想局域修正）和 $w>0$（局域宽度）。如果取 $A_z(x,y,t) = A_0(y) - E_z(y) t$，则该选择与 $E_z = - \\partial_t A_z$ 一致，此时 $B_x(y,t) = B_0 \\tanh(y/\\delta) - t \\, \\partial_y E_z(y)$；您需要在 $t=0$ 时计算所有量，因此 $B_x(y,0) = B_0 \\tanh(y/\\delta)$。\n- 定义一个“上游”采样位置 $y_{\\mathrm{up}}$，满足 $|y_{\\mathrm{up}}| \\le Y_c$ 但离 $y=0$ 足够远，以至于 $B_x(y_{\\mathrm{up}},0) \\neq 0$。在上游的理想区域，流入关系给出\n$$\nE_{\\mathrm{up}} \\equiv \\left[v_{\\mathrm{in}}(y_{\\mathrm{up}}) \\, B_x(y_{\\mathrm{up}},0)\\right] = E_z(y_{\\mathrm{up}}),\n$$\n因此，假设沿切面均匀分布，预测的通量传输率为\n$$\n\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c \\, E_{\\mathrm{up}}.\n$$\n\n您的任务：\n- 对于下面测试套件中的每一组参数，数值计算定义 $\\dot{\\Phi}_{\\mathrm{cut}}$ 的积分和乘积 $\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c E_z(y_{\\mathrm{up}})$。\n- 计算绝对相对差异\n$$\nr = \\frac{\\left|\\dot{\\Phi}_{\\mathrm{cut}} - \\dot{\\Phi}_{\\mathrm{pred}}\\right|}{\\max\\!\\left(10^{-12}, \\left|\\dot{\\Phi}_{\\mathrm{cut}}\\right|\\right)},\n$$\n该值为无量纲。一个小的 $r$ 值表示基于直接切面的通量传输率与流入估计值之间具有一致性。\n\n使用的物理单位：\n- 磁场 $B$ 单位为特斯拉 (T)，\n- 长度 $y, Y_c, \\delta, w, y_{\\mathrm{up}}$ 单位为米 (m)，\n- 电场 $E$ 单位为伏特每米 (V/m)，\n- 速率 $\\dot{\\Phi}$ 的单位为伏特 (V)，因为它是 $E_z$ 沿 $y$ 长度的积分除以单位 $z$ 长度。\n\n数值测试套件：\n- 使用以下四个参数集，每个参数集指定为 $(B_0, \\delta, E_0, E_1, w, Y_c, y_{\\mathrm{up}})$，所有量均采用上述指定单位：\n    1. $(2.0 \\times 10^{-8}, \\; 5.0 \\times 10^{4}, \\; 1.0 \\times 10^{-3}, \\; 0.0, \\; 2.5 \\times 10^{4}, \\; 5.0 \\times 10^{5}, \\; 1.5 \\times 10^{5})$\n    2. $(2.0 \\times 10^{-8}, \\; 5.0 \\times 10^{4}, \\; 1.0 \\times 10^{-3}, \\; 5.0 \\times 10^{-4}, \\; 2.5 \\times 10^{4}, \\; 5.0 \\times 10^{5}, \\; 1.5 \\times 10^{5})$\n    3. $(2.0 \\times 10^{-8}, \\; 5.0 \\times 10^{4}, \\; 1.0 \\times 10^{-3}, \\; -5.0 \\times 10^{-4}, \\; 1.0 \\times 10^{5}, \\; 5.0 \\times 10^{5}, \\; 1.5 \\times 10^{5})$\n    4. $(2.0 \\times 10^{-8}, \\; 5.0 \\times 10^{4}, \\; 1.0 \\times 10^{-3}, \\; 2.0 \\times 10^{-4}, \\; 1.0 \\times 10^{4}, \\; 5.0 \\times 10^{5}, \\; 5.0 \\times 10^{2})$\n\n程序要求：\n- 实现一个函数，对于每个测试用例，按规定定义 $E_z(y)$ 和 $B_x(y,0)$，并通过在 $y \\in [-Y_c, Y_c]$ 上进行数值积分来计算 $\\dot{\\Phi}_{\\mathrm{cut}}$。\n- 计算 $\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c E_z(y_{\\mathrm{up}})$，然后计算如上定义的差异 $r$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3,r4]”），其中每个条目是按上文所列顺序对应测试用例的 $r$ 值。这些条目必须是无单位的浮点数。\n\n科学真实性与约束条件：\n- 磁场剖面 $B_x(y,0) = B_0 \\tanh(y/\\delta)$ 是重联研究中使用的电流片的典型模型。\n- 电场剖面 $E_z(y)$ 包含一个均匀的理想贡献 $E_0$ 和一个局域化的非理想修正 $E_1 \\exp[-(y/w)^2]$，以便测试理想一致性情况以及由非理想效应引起的偏差。\n- 流入估计值 $v_{\\mathrm{in}} B$ 是在理想假设下，在上游采样点处作为 $E_z(y_{\\mathrm{up}})$ 来评估的。在存在局域化非理想项的情况下，此估计值可能与沿切面积分的 $\\dot{\\Phi}_{\\mathrm{cut}}$ 不匹配，而差异 $r$ 量化了这种不一致性。\n\n此问题不涉及角度单位。所有要打印的数值结果都是纯数字（无量纲差异）。",
            "solution": "我们推导出一个可实现的表达式，用于计算跨越垂直切面的磁通量传输率及其基于理想流入的代理值，然后提供一个数值计划来评估和比较它们。\n\n基本原理和几何结构：\n- 从法拉第定律 $\\partial \\mathbf{B} / \\partial t = - \\nabla \\times \\mathbf{E}$ 和理想欧姆定律 $\\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B}$ 开始，后者在理想区域有效。\n- 在一个沿 $z$ 轴不变的二维系统中，令 $\\mathbf{A} = A_z(x,y,t) \\hat{\\mathbf{z}}$，$\\mathbf{B} = \\nabla \\times \\mathbf{A} = (\\partial_y A_z, -\\partial_x A_z, 0)$，以及 $E_z = -\\partial_t A_z$。\n- 考虑在 $x=0$ 处从 $y=-Y_c$ 到 $y=+Y_c$ 的一个垂直切面 $\\mathcal{C}$。通过考虑一个矩形回路，可以获得跨越该切面单位 $z$ 长度的磁通量传输率。该回路以 $\\mathcal{C}$ 为一边，并在切向电场可忽略不计的区域闭合。根据积分形式的法拉第定律，$d\\Phi/dt = - \\oint \\mathbf{E} \\cdot d\\mathbf{l}$。如果沿闭合路径的贡献消失（或在理想区域内可以忽略不计），则剩余的贡献是沿 $\\mathcal{C}$ 的线积分：\n$$\n\\dot{\\Phi}_{\\mathrm{cut}}(t) = \\int_{-Y_c}^{Y_c} E_z(x=0,y,t) \\, dy.\n$$\n当切面穿过非理想区域时，这是二维重联率的标准诊断方法。\n\n理想流入代理：\n- 在对称中线上，通常有 $B_y = 0$ 和 $v_x = 0$。理想欧姆定律的 $z$ 分量在理想区域简化为 $E_z = v_y B_x$。在一个非理想效应可忽略不计的上游位置 $y_{\\mathrm{up}}$ 进行采样，可得\n$$\nE_{\\mathrm{up}} \\equiv v_{\\mathrm{in}}(y_{\\mathrm{up}}) \\, B_x(y_{\\mathrm{up}},0) = E_z(y_{\\mathrm{up}}).\n$$\n假设 $E_z$ 在沿切面的非理想层中近似均匀（这是稳态二维重联中的一个常见性质），则预测的通量传输率为\n$$\n\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c \\, E_{\\mathrm{up}}.\n$$\n在 $E_z$ 严格均匀的情况下，$\\dot{\\Phi}_{\\mathrm{cut}} = \\dot{\\Phi}_{\\mathrm{pred}}$ 完全相等；在存在局域化非理想增强或减弱的情况下，它们可能会有所不同。\n\n测试套件的模型场：\n- 我们规定在 $t=0$ 时的重联磁场由下式给出\n$$\nB_x(y,0) = \\partial_y A_0(y) = B_0 \\tanh\\!\\left(\\frac{y}{\\delta}\\right),\n$$\n其中常数 $B_0 > 0$ 且 $\\delta > 0$。这是一个在重联建模中广泛使用的电流片剖面。\n- 我们规定在 $t=0$ 时的电场剖面\n$$\nE_z(y) = E_0 + E_1 \\exp\\!\\left(-\\left(\\frac{y}{w}\\right)^2\\right),\n$$\n其中常数 $E_0$，$E_1$，$w > 0$。如果取 $A_z(x,y,t) = A_0(y) - E_z(y) t$，则由 $E_z = -\\partial_t A_z$ 可确保与法拉第定律的一致性，因此 $B_x(y,t) = B_0 \\tanh(y/\\delta) - t \\, \\partial_y E_z(y)$。我们仅在 $t=0$ 时进行评估，因此相关磁场为 $B_x(y,0) = B_0 \\tanh(y/\\delta)$。\n\n计算定义：\n- $t=0$ 时基于直接切面的速率为\n$$\n\\dot{\\Phi}_{\\mathrm{cut}} = \\int_{-Y_c}^{Y_c} \\left[E_0 + E_1 \\exp\\!\\left(-\\left(\\frac{y}{w}\\right)^2\\right)\\right] dy.\n$$\n- 流入代理使用上游采样值，\n$$\nE_{\\mathrm{up}} = E_z(y_{\\mathrm{up}}) = E_0 + E_1 \\exp\\!\\left(-\\left(\\frac{y_{\\mathrm{up}}}{w}\\right)^2\\right),\n$$\n并预测\n$$\n\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c \\, E_{\\mathrm{up}}.\n$$\n- 要报告的差异是绝对相对误差\n$$\nr = \\frac{\\left|\\dot{\\Phi}_{\\mathrm{cut}} - \\dot{\\Phi}_{\\mathrm{pred}}\\right|}{\\max\\!\\left(10^{-12}, \\left|\\dot{\\Phi}_{\\mathrm{cut}}\\right|\\right)}.\n$$\n\n算法计划：\n- 对于每个测试用例，如上定义 $E_z(y)$，并使用稳健的求积法在 $y \\in [-Y_c, Y_c]$ 上数值计算 $\\dot{\\Phi}_{\\mathrm{cut}}$ 的积分。\n- 评估 $E_{\\mathrm{up}} = E_z(y_{\\mathrm{up}})$ 并计算 $\\dot{\\Phi}_{\\mathrm{pred}} = 2 Y_c E_{\\mathrm{up}}$。\n- 按定义计算 $r$。\n- 按所提供测试套件的顺序汇总结果 $[r_1, r_2, r_3, r_4]$。\n\n解释：\n- 情况 1 中 $E_1 = 0$，因此 $E_z(y)$ 是均匀的，两种度量在数值积分误差范围内一致；$r$ 应接近于 $0$。\n- 情况 2 和 3 包含局域化的非理想修正（$E_1 \\neq 0$），这些修正在 $y$ 方向上变化，因此 $\\dot{\\Phi}_{\\mathrm{cut}}$ 会累积这些变化，而 $\\dot{\\Phi}_{\\mathrm{pred}}$ 仅反映上游的值；非零的 $r$ 量化了这种不一致性。\n- 情况 4 使用了一个非常小的、$y_{\\mathrm{up}}$ 靠近中性线；尽管 $E_{\\mathrm{up}}$ 保持有限，但这可以探测在离电流片太近处采样时的灵敏度，提供了一个边界情况检查。\n\n所有计算都将使用指定的单位执行，但按要求打印的输出 $r_i$ 是无量纲的实数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef ez_profile(y, E0, E1, w):\n    # Electric field profile E_z(y) = E0 + E1 * exp(-(y/w)^2)\n    if w == 0:\n        return E0\n    return E0 + E1 * np.exp(- (y / w)**2)\n\ndef bx_profile(y, B0, delta):\n    # Reconnecting magnetic field at t=0: B_x(y,0) = B0 * tanh(y/delta)\n    return B0 * np.tanh(y / delta)\n\ndef compute_dotPhi_cut(E0, E1, w, Yc):\n    # Numerically integrate E_z over y in [-Yc, Yc]\n    integrand = lambda yy: ez_profile(yy, E0, E1, w)\n    # Use high-accuracy quadrature\n    val, err = integrate.quad(integrand, -Yc, Yc, epsabs=1e-12, epsrel=1e-12, limit=200)\n    return val\n\ndef compute_discrepancy(case):\n    # Unpack parameters: (B0, delta, E0, E1, w, Yc, y_up)\n    B0, delta, E0, E1, w, Yc, y_up = case\n\n    # Direct cut-based flux-transfer rate\n    dotPhi_cut = compute_dotPhi_cut(E0, E1, w, Yc)\n\n    # Upstream E_z at y_up (ideal proxy v_in * B_up)\n    E_up = ez_profile(y_up, E0, E1, w)\n\n    # Predicted rate assuming uniform E_z across the cut\n    dotPhi_pred = 2.0 * Yc * E_up\n\n    # Discrepancy (absolute relative error)\n    denom = max(1e-12, abs(dotPhi_cut))\n    r = abs(dotPhi_cut - dotPhi_pred) / denom\n    return r\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple is (B0, delta, E0, E1, w, Yc, y_up)\n    test_cases = [\n        (2.0e-8, 5.0e4, 1.0e-3, 0.0,       2.5e4, 5.0e5, 1.5e5),\n        (2.0e-8, 5.0e4, 1.0e-3, 5.0e-4,    2.5e4, 5.0e5, 1.5e5),\n        (2.0e-8, 5.0e4, 1.0e-3, -5.0e-4,   1.0e5, 5.0e5, 1.5e5),\n        (2.0e-8, 5.0e4, 1.0e-3, 2.0e-4,    1.0e4, 5.0e5, 5.0e2),\n    ]\n\n    results = []\n    for case in test_cases:\n        r = compute_discrepancy(case)\n        # Format with reasonable precision to ensure a clean single-line output\n        results.append(f\"{r:.12g}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "二维模型中的 X 点在三维空间中演变为更复杂的拓扑结构。本练习将引导您进入三维重联的世界，学习一种强大的拓扑分析工具——磁压挤因子（squashing factor）$Q$。通过数值积分磁力线并计算场线映射的雅可比矩阵，您将能够识别出被称为准分离层（Quasi-Separatrix Layers, QSLs）的强梯度区域，这些区域正是三维磁重联最可能发生的场所 。",
            "id": "3519769",
            "problem": "考虑一个磁流体力学（MHD）磁场 $\\mathbf{B}(\\mathbf{r})$，它位于一个坐标为 $(x,y,z)$ 的单连通笛卡尔盒子中，其中 $z$ 是开放磁力线映射的优选方向。假设在整个区域内 $\\nabla \\cdot \\mathbf{B} = 0$ 且 $B_z(x,y,z) > 0$，因此磁力线从下边界 $z=0$ 单调地连接到上边界 $z=L$。通过追踪从 $(x_0,y_0,0)$ 开始的磁力线，直到它在 $(X,Y,L)$ 处与平面 $z=L$ 相交，定义磁力线映射 $\\mathcal{F}: (x_0,y_0) \\mapsto (X(x_0,y_0),Y(x_0,y_0))$。在一个足点 $(x_0,y_0,0)$ 处的挤压因子 $Q$ 由该映射的 $2\\times 2$ 雅可比矩阵 $D\\mathcal{F}$ 定义，\n$$\nD\\mathcal{F}(x_0,y_0) \\equiv \n\\begin{pmatrix}\n\\frac{\\partial X}{\\partial x_0} & \\frac{\\partial X}{\\partial y_0} \\\\\n\\frac{\\partial Y}{\\partial x_0} & \\frac{\\partial Y}{\\partial y_0}\n\\end{pmatrix},\n$$\n以及\n$$\nQ(x_0,y_0) \\equiv \\frac{\\left\\| D\\mathcal{F}(x_0,y_0) \\right\\|_F^2}{\\left| \\det D\\mathcal{F}(x_0,y_0) \\right|} = \\frac{\\left(\\frac{\\partial X}{\\partial x_0}\\right)^2 + \\left(\\frac{\\partial X}{\\partial y_0}\\right)^2 + \\left(\\frac{\\partial Y}{\\partial x_0}\\right)^2 + \\left(\\frac{\\partial Y}{\\partial y_0}\\right)^2}{\\left| \\frac{\\partial X}{\\partial x_0}\\frac{\\partial Y}{\\partial y_0} - \\frac{\\partial X}{\\partial y_0}\\frac{\\partial Y}{\\partial x_0} \\right|}。\n$$\n$Q$ 的高值表示准分离层（QSLs），这些是可能发生磁重联的位置。\n\n您的任务是编写一个完整、可运行的程序，该程序能够：\n- 对 $z=0$ 上的足点 $(x_0,y_0)$ 网格，通过数值积分磁力线来计算 $\\mathcal{F}$。\n- 使用每个足点周围的有限差分来近似 $D\\mathcal{F}$。\n- 计算每个足点处的 $Q$。\n- 将 $Q \\ge Q_{\\mathrm{thr}}$ 的足点识别为可能的重联位置。\n\n使用以 $z$ 为自变量的磁力线方程：\n$$\n\\frac{dx}{dz} = \\frac{B_x(x,y,z)}{B_z(x,y,z)}, \\qquad \\frac{dy}{dz} = \\frac{B_y(x,y,z)}{B_z(x,y,z)},\n$$\n从 $z=0$ 积分到 $z=L$，初始条件为 $(x(0),y(0))=(x_0,y_0)$，以确定 $(X,Y)=(x(L),y(L))$。对所有测试用例，使用具有均匀步数 $M$ 的显式四阶 Runge–Kutta 方法。\n\n对于数值微分，使用增量为 $\\varepsilon$ 的对称两点模板：\n$$\n\\frac{\\partial X}{\\partial x_0} \\approx \\frac{X(x_0+\\varepsilon,y_0)-X(x_0-\\varepsilon,y_0)}{2\\varepsilon}, \\quad\n\\frac{\\partial X}{\\partial y_0} \\approx \\frac{X(x_0,y_0+\\varepsilon)-X(x_0,y_0-\\varepsilon)}{2\\varepsilon},\n$$\n对于 $\\partial Y/\\partial x_0$ 和 $\\partial Y/\\partial y_0$ 也类似。\n\n场位形。对于以下所有测试用例，采用从一个磁通函数和一个均匀引导场导出的无散平面内场：\n$$\nB_x(x,y,z) = a\\,x + s\\,\\sin(\\pi x)\\cos(\\pi y), \\quad\nB_y(x,y,z) = -a\\,y - s\\,\\cos(\\pi x)\\sin(\\pi y), \\quad\nB_z(x,y,z) = B_0,\n$$\n其中 $a$、$s$ 和 $B_0$ 是常数（无量纲）。这满足 $\\nabla\\cdot\\mathbf{B}=0$ 和 $B_z(x,y,z)=B_0 > 0$。\n\n所有测试共有的数值要求：\n- 积分器：在 $z\\in[0,L]$ 上采用 $M$ 步的显式四阶 Runge–Kutta。\n- 有限差分增量：$\\varepsilon = 10^{-6}$。\n- $z=0$ 上的足点网格是一个在 $[x_{\\min},x_{\\max}]\\times[y_{\\min},y_{\\max}]$ 上的均匀 $N\\times N$ 笛卡尔网格，包括端点。\n\n测试套件。实现以下三个测试用例，每个用例由 $(a,s,B_0,L,N,x_{\\min},x_{\\max},y_{\\min},y_{\\max},Q_{\\mathrm{thr}},M)$ 指定：\n- 测试 A（理想情况，线性双曲磁通管）：$(a,s,B_0,L,N,x_{\\min},x_{\\max},y_{\\min},y_{\\max},Q_{\\mathrm{thr}},M)=(1,0,1,1,15,-1,1,-1,1,5,400)$。预期 $Q$ 在空间上均匀且大于 $Q_{\\mathrm{thr}}$。\n- 测试 B（边界情况，均匀场）：$(a,s,B_0,L,N,x_{\\min},x_{\\max},y_{\\min},y_{\\max},Q_{\\mathrm{thr}},M)=(0,0,1,1,9,-1,1,-1,1,2.5,400)$。预期 $Q$ 在空间上均匀且小于 $Q_{\\mathrm{thr}}$。\n- 测试 C（双曲管的非线性微扰）：$(a,s,B_0,L,N,x_{\\min},x_{\\max},y_{\\min},y_{\\max},Q_{\\mathrm{thr}},M)=(1,0.3,1,1,13,-0.9,0.9,-0.9,0.9,10,400)$。预期 $Q$ 在空间上变化并有局部增强。\n\n输出。对于每个测试用例，您的程序必须计算：\n- 网格上的最大挤压因子 $\\max Q$，作为一个四舍五入到 $6$ 位小数的浮点值。\n- $Q \\ge Q_{\\mathrm{thr}}$ 的网格点数量，作为一个整数。\n\n最终输出格式。您的程序应生成单行输出，其中包含所有三个测试的结果，格式为逗号分隔的列表的列表：\n$$\n\\big[\\,[\\max Q_A,\\ \\mathrm{count}_A],\\ [\\max Q_B,\\ \\mathrm{count}_B],\\ [\\max Q_C,\\ \\mathrm{count}_C]\\,\\big]\n$$\n其中每个 $\\max Q$ 都四舍五入到 $6$ 位小数。没有物理单位，因为根据构造，所有量都是无量纲的。",
            "solution": "该问题要求开发一个数值代码，以在给定的磁场位形中识别磁重联的潜在位置。这是通过计算磁力线足点网格上的磁挤压因子 $Q$ 来实现的。$Q$ 的高值与准分离层（QSLs）相关，在这些层中很可能发生磁重联。解决方案涉及数值追踪磁力线，近似磁力线映射的雅可比矩阵，然后计算 $Q$。\n\n磁力线是一条曲线 $\\mathbf{r}(l)$，其切线处处平行于磁场矢量 $\\mathbf{B}$，即 $d\\mathbf{r}/dl \\propto \\mathbf{B}$。问题指定了一个笛卡尔域，其中 $B_z > 0$，这使我们能够使用 $z$ 坐标作为追踪磁力线的自变量。因此，磁力线方程由以下常微分方程组（ODEs）给出：\n$$\n\\frac{dx}{dz} = \\frac{B_x(x,y,z)}{B_z(x,y,z)}, \\qquad \\frac{dy}{dz} = \\frac{B_y(x,y,z)}{B_z(x,y,z)}\n$$\n让我们将状态向量表示为 $\\mathbf{p}(z) = (x(z), y(z))^T$。该 ODE 系统可以抽象地写为 $\\frac{d\\mathbf{p}}{dz} = \\mathbf{f}(z, \\mathbf{p})$，其中 $\\mathbf{f} = (B_x/B_z, B_y/B_z)^T$。\n\n为了数值求解该系统，我们采用显式四阶 Runge-Kutta (RK4) 方法。给定第 $n$ 步的初始位置 $\\mathbf{p}_n = \\mathbf{p}(z_n)$，下一步 $z_{n+1} = z_n + h$ 的位置近似为：\n$$\n\\mathbf{p}_{n+1} = \\mathbf{p}_n + \\frac{h}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\n其中 $h$ 是步长，阶段 $\\mathbf{k}_i$ 为：\n$$\n\\begin{aligned}\n\\mathbf{k}_1 = \\mathbf{f}(z_n, \\mathbf{p}_n) \\\\\n\\mathbf{k}_2 = \\mathbf{f}(z_n + \\frac{h}{2}, \\mathbf{p}_n + \\frac{h}{2}\\mathbf{k}_1) \\\\\n\\mathbf{k}_3 = \\mathbf{f}(z_n + \\frac{h}{2}, \\mathbfp_n + \\frac{h}{2}\\mathbf{k}_2) \\\\\n\\mathbf{k}_4 = \\mathbf{f}(z_n + h, \\mathbf{p}_n + h\\mathbf{k}_3)\n\\end{aligned}\n$$\n我们使用 $M$ 个均匀步长从 $z=0$ 积分到 $z=L$，因此步长为 $h = L/M$。\n\n磁力线映射 $\\mathcal{F}$ 将磁力线在 $z=0$ 边界的起始坐标 $(x_0, y_0)$ 与其在 $z=L$ 边界的结束坐标 $(X, Y)$ 相关联。这可以正式写为 $(X, Y) = \\mathcal{F}(x_0, y_0)$。该映射是通过积分具有初始条件 $(x(0), y(0)) = (x_0, y_0)$ 的磁力线方程来计算，以找到 $(X, Y) = (x(L), y(L))$。\n\n挤压因子 $Q$ 是基于此映射的 $2 \\times 2$ 雅可比矩阵 $D\\mathcal{F}$ 定义的：\n$$\nD\\mathcal{F}(x_0,y_0) \\equiv \n\\begin{pmatrix}\n\\frac{\\partial X}{\\partial x_0} & \\frac{\\partial X}{\\partial y_0} \\\\\n\\frac{\\partial Y}{\\partial x_0} & \\frac{\\partial Y}{\\partial y_0}\n\\end{pmatrix}\n$$\n由于通常无法获得 $\\mathcal{F}$ 的解析表达式，我们使用对称两点有限差分公式来近似雅可比矩阵中的偏导数。对于一个小的位移 $\\varepsilon$，导数计算如下：\n$$\n\\begin{aligned}\n\\frac{\\partial X}{\\partial x_0} \\approx \\frac{X(x_0+\\varepsilon, y_0) - X(x_0-\\varepsilon, y_0)}{2\\varepsilon}, & \\quad \\frac{\\partial X}{\\partial y_0} \\approx \\frac{X(x_0, y_0+\\varepsilon) - X(x_0, y_0-\\varepsilon)}{2\\varepsilon} \\\\\n\\frac{\\partial Y}{\\partial x_0} \\approx \\frac{Y(x_0+\\varepsilon, y_0) - Y(x_0-\\varepsilon, y_0)}{2\\varepsilon}, & \\quad \\frac{\\partial Y}{\\partial y_0} \\approx \\frac{Y(x_0, y_0+\\varepsilon) - Y(x_0, y_0-\\varepsilon)}{2\\varepsilon}\n\\end{aligned}\n$$\n这要求对每个需要评估雅可比矩阵的足点 $(x_0, y_0)$ 进行四次独立的磁力线积分。\n\n利用雅可比矩阵的元素，我们使用其定义计算挤压因子 $Q$：\n$$\nQ(x_0,y_0) = \\frac{\\left\\| D\\mathcal{F}(x_0,y_0) \\right\\|_F^2}{\\left| \\det D\\mathcal{F}(x_0,y_0) \\right|} = \\frac{\\left(\\frac{\\partial X}{\\partial x_0}\\right)^2 + \\left(\\frac{\\partial X}{\\partial y_0}\\right)^2 + \\left(\\frac{\\partial Y}{\\partial x_0}\\right)^2 + \\left(\\frac{\\partial Y}{\\partial y_0}\\right)^2}{\\left| \\frac{\\partial X}{\\partial x_0}\\frac{\\partial Y}{\\partial y_0} - \\frac{\\partial X}{\\partial y_0}\\frac{\\partial Y}{\\partial x_0} \\right|}\n$$\n分子是雅可比矩阵的弗罗贝尼乌斯范数的平方，分母是其行列式的绝对值。\n\n对于每个测试用例，总体算法如下：\n1. 在域 $[x_{\\min}, x_{\\max}] \\times [y_{\\min}, y_{\\max}]$ 上的 $z=0$ 平面上定义 $N \\times N$ 的足点 $(x_0, y_0)$ 网格。\n2. 初始化最大 $Q$ 的变量 $\\max Q = 0$，以及一个用于统计超过阈值的点的计数器 $\\mathrm{count} = 0$。\n3. 对于网格中的每个足点 $(x_0, y_0)$：\n    a. 执行四次 RK4 积分，以找到初始条件为 $(x_0 \\pm \\varepsilon, y_0, 0)$ 和 $(x_0, y_0 \\pm \\varepsilon, 0)$ 的终点。\n    b. 使用有限差分公式计算雅可比矩阵 $D\\mathcal{F}$ 的四个元素。\n    c. 根据雅可比矩阵的元素计算 $Q$ 的值。\n    d. 如果 $Q > \\max Q$，更新 $\\max Q = Q$。\n    e. 如果 $Q \\ge Q_{\\mathrm{thr}}$，则增加 $\\mathrm{count}$。\n4. 遍历所有网格点后，存储最终的 $\\max Q$（四舍五入到 $6$ 位小数）和 $\\mathrm{count}$。\n5. 处理完所有测试用例后，将结果格式化为表示列表的列表的单行字符串。\n对于特定的磁场 $\\mathbf{B} = (a\\,x + s\\,\\sin(\\pi x)\\cos(\\pi y), -a\\,y - s\\,\\cos(\\pi x)\\sin(\\pi y), B_0)$，由于 $B_z$ 是常数，ODE 的右端项是 $\\mathbf{f} = \\frac{1}{B_0}(B_x, B_y)^T$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef dz_derivs(z, pos, a, s, B0):\n    \"\"\"\n    Computes the RHS of the field-line ODEs, d(x,y)/dz.\n    z is formally an argument but is unused since B is z-independent.\n    \"\"\"\n    x, y = pos\n    # Bx = a*x + s*sin(pi*x)*cos(pi*y)\n    # By = -a*y - s*cos(pi*x)*sin(pi*y)\n    # Bz = B0\n    # dx/dz = Bx/Bz, dy/dz = By/Bz\n    bx = a * x + s * np.sin(np.pi * x) * np.cos(np.pi * y)\n    by = -a * y - s * np.cos(np.pi * x) * np.sin(np.pi * y)\n    return np.array([bx, by]) / B0\n\ndef trace_field_line(x0, y0, L, M, a, s, B0):\n    \"\"\"\n    Integrates a magnetic field line from (x0, y0, 0) to z=L.\n    Uses the 4th-order Runge-Kutta method.\n    \"\"\"\n    pos = np.array([x0, y0], dtype=np.float64)\n    z = 0.0\n    h = L / M\n\n    for _ in range(M):\n        k1 = dz_derivs(z, pos, a, s, B0)\n        k2 = dz_derivs(z + h/2, pos + h/2 * k1, a, s, B0)\n        k3 = dz_derivs(z + h/2, pos + h/2 * k2, a, s, B0)\n        k4 = dz_derivs(z + h, pos + h * k3, a, s, B0)\n        pos += (h/6) * (k1 + 2*k2 + 2*k3 + k4)\n        z += h\n    return pos\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, s, B0, L, N, x_min, x_max, y_min, y_max, Q_thr, M)\n        # Test A (happy path, linear hyperbolic flux tube)\n        (1, 0, 1, 1, 15, -1, 1, -1, 1, 5, 400),\n        # Test B (boundary case, uniform field)\n        (0, 0, 1, 1, 9, -1, 1, -1, 1, 2.5, 400),\n        # Test C (nonlinear perturbation of hyperbolic tube)\n        (1, 0.3, 1, 1, 13, -0.9, 0.9, -0.9, 0.9, 10, 400)\n    ]\n\n    all_results = []\n    # Finite-difference increment\n    eps = 1e-6\n\n    for case_params in test_cases:\n        a, s, B0, L, N, x_min, x_max, y_min, y_max, Q_thr, M = case_params\n\n        x_grid = np.linspace(x_min, x_max, N, dtype=np.float64)\n        y_grid = np.linspace(y_min, y_max, N, dtype=np.float64)\n\n        max_q = 0.0\n        q_count = 0\n\n        for y0 in y_grid:\n            for x0 in x_grid:\n                # Main logic to calculate the result for one grid point\n                # Trace four field lines for finite differences\n                pos_px = trace_field_line(x0 + eps, y0, L, M, a, s, B0)\n                pos_mx = trace_field_line(x0 - eps, y0, L, M, a, s, B0)\n                pos_py = trace_field_line(x0, y0 + eps, L, M, a, s, B0)\n                pos_my = trace_field_line(x0, y0 - eps, L, M, a, s, B0)\n\n                # Compute Jacobian elements\n                dX_dx0 = (pos_px[0] - pos_mx[0]) / (2 * eps)\n                dY_dx0 = (pos_px[1] - pos_mx[1]) / (2 * eps)\n                \n                dX_dy0 = (pos_py[0] - pos_my[0]) / (2 * eps)\n                dY_dy0 = (pos_py[1] - pos_my[1]) / (2 * eps)\n\n                # Compute squashing factor Q\n                norm_sq = dX_dx0**2 + dX_dy0**2 + dY_dx0**2 + dY_dy0**2\n                det = dX_dx0 * dY_dy0 - dX_dy0 * dY_dx0\n\n                q_val = 0.0\n                if abs(det) > 1e-15: # Avoid division by zero\n                    q_val = norm_sq / abs(det)\n                else:\n                    # If determinant is zero, Q is infinite (true separatrix)\n                    # unless norm_sq is also zero (trivial mapping)\n                    q_val = np.inf if norm_sq > 1e-15 else 2.0\n\n                if q_val >= Q_thr:\n                    q_count += 1\n                \n                if q_val > max_q:\n                    max_q = q_val\n        \n        # Store rounded max Q and the integer count\n        all_results.append([round(max_q, 6), q_count])\n\n    # Final print statement in the exact required format without spaces\n    sub_strings = [f\"[{r[0]},{r[1]}]\" for r in all_results]\n    print(f\"[{','.join(sub_strings)}]\")\n\nsolve()\n```"
        }
    ]
}