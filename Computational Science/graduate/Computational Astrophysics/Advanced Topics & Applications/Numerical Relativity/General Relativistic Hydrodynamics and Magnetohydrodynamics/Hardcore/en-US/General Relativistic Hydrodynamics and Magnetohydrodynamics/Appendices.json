{
    "hands_on_practices": [
        {
            "introduction": "Numerical simulations of general relativistic phenomena are typically performed using a $3+1$ decomposition of spacetime, which separates time and space in a way that depends on the chosen observer. A crucial first step in building or analyzing a simulation is understanding how to translate between the covariant four-dimensional quantities of theory and the three-dimensional variables seen by this computational 'Eulerian' observer. This exercise  provides essential practice in this translation, guiding you to derive the 3+1 metric components from a given spacetime and use them to decompose a fluid's four-velocity $u^{\\mu}$ into its corresponding three-velocity $v^i$ and Lorentz factor $W$.",
            "id": "3512023",
            "problem": "Consider the Schwarzschild spacetime written in ingoing Kerr–Schild spherical coordinates with line element\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\nAdopt the $3+1$ decomposition with lapse $\\alpha$, shift $\\beta^{i}$, and spatial metric $\\gamma_{ij}$, defined by\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right),\n$$\nand let the Eulerian observer be the unit normal to the spatial hypersurfaces. At the event specified by $M=1$, $r=8$, and $\\theta = \\frac{\\pi}{2}$, suppose a fluid element has contravariant four-velocity components\n$$\nu^{t} = \\frac{10}{\\sqrt{71}}, \\quad u^{r} = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}, \\quad u^{\\theta} = 0, \\quad u^{\\phi} = 0.\n$$\nStarting from the definitions of the $3+1$ decomposition and the normalization condition $u^{\\mu} u_{\\mu} = -1$, perform the following:\n\n- Derive $\\alpha$, $\\beta^{r}$, and $\\gamma_{rr}$ at the specified event.\n- Using only these geometric quantities and the given $u^{\\mu}$, compute the Lorentz factor $W = \\alpha u^{t}$ and the three-velocity components $v^{i}$ measured by the Eulerian observer, where $v^{i}$ satisfies $u^{\\mu} = W\\left(n^{\\mu} + v^{\\mu}\\right)$ with $n^{\\mu}$ the Eulerian observer’s four-velocity and $v^{\\mu}$ purely spatial.\n- Verify from first principles that\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}.\n$$\n\nExpress the final value of the Lorentz factor $W$ as a real number rounded to four significant figures. No units are required for $W$.",
            "solution": "The problem is well-posed and scientifically grounded in the principles of general relativity and the $3+1$ formalism. All provided data and definitions are self-consistent and sufficient for a unique solution.\n\nFirst, we derive the $3+1$ quantities (lapse $\\alpha$, shift vector $\\beta^i$, and spatial metric $\\gamma_{ij}$) by comparing the given Schwarzschild metric in ingoing Kerr–Schild coordinates with the general $3+1$ line element.\n\nThe given metric is:\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right)\n$$\nThe general $3+1$ line element is:\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right) = (-\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j)dt^2 + 2\\gamma_{ij}\\beta^i dx^j dt + \\gamma_{ij}dx^i dx^j\n$$\nLet the spatial coordinates be $(x^1, x^2, x^3) = (r, \\theta, \\phi)$. By comparing the coefficients of the differentials in both line elements, we identify the components of the metric tensor $g_{\\mu\\nu}$.\n\nThe spatial part of the metric gives the spatial metric $\\gamma_{ij}$:\n$g_{ij} = \\gamma_{ij}$.\nFrom the given line element, we have a diagonal spatial metric:\n$$\n\\gamma_{rr} = g_{rr} = 1 + \\frac{2M}{r}\n$$\n$$\n\\gamma_{\\theta\\theta} = g_{\\theta\\theta} = r^2\n$$\n$$\n\\gamma_{\\phi\\phi} = g_{\\phi\\phi} = r^2 \\sin^2\\theta\n$$\nAll off-diagonal components $\\gamma_{ij}$ are zero.\n\nThe mixed time-space components $g_{ti}$ give the shift vector $\\beta^i$:\n$g_{ti} = \\gamma_{ij}\\beta^j$.\nIn our case, the only non-zero component is $g_{tr} = \\frac{2M}{r}$. Because $\\gamma_{ij}$ is diagonal, the relation for $i=r$ simplifies to:\n$g_{tr} = \\gamma_{rr}\\beta^r$.\nSolving for $\\beta^r$:\n$$\n\\beta^r = \\frac{g_{tr}}{\\gamma_{rr}} = \\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}} = \\frac{2M}{r+2M}\n$$\nSince $g_{t\\theta}=0$ and $g_{t\\phi}=0$, the other components of the shift vector are $\\beta^\\theta = 0$ and $\\beta^\\phi = 0$.\n\nThe time-time component $g_{tt}$ gives the lapse function $\\alpha$:\n$g_{tt} = -\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j$.\nWith only $\\beta^r$ being non-zero, this becomes:\n$g_{tt} = -\\alpha^2 + \\gamma_{rr}(\\beta^r)^2$.\nSolving for $\\alpha^2$:\n$$\n\\alpha^2 = -g_{tt} + \\gamma_{rr}(\\beta^r)^2 = -\\left[-\\left(1 - \\frac{2M}{r}\\right)\\right] + \\left(1 + \\frac{2M}{r}\\right)\\left(\\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}}\\right)^2\n$$\n$$\n\\alpha^2 = \\left(1 - \\frac{2M}{r}\\right) + \\frac{\\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{\\left(1 - \\frac{2M}{r}\\right)\\left(1 + \\frac{2M}{r}\\right) + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1 - \\left(\\frac{2M}{r}\\right)^2 + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1}{1 + \\frac{2M}{r}}\n$$\nThus, the lapse function is $\\alpha = \\frac{1}{\\sqrt{1 + \\frac{2M}{r}}}$.\n\nNow we evaluate these quantities at the specified event: $M=1$, $r=8$, $\\theta = \\frac{\\pi}{2}$.\nFirst, calculate the common term $\\frac{2M}{r} = \\frac{2(1)}{8} = \\frac{1}{4}$.\n$$\n\\alpha = \\frac{1}{\\sqrt{1 + \\frac{1}{4}}} = \\frac{1}{\\sqrt{\\frac{5}{4}}} = \\frac{2}{\\sqrt{5}} = \\frac{2\\sqrt{5}}{5}\n$$\n$$\n\\beta^r = \\frac{\\frac{1}{4}}{1 + \\frac{1}{4}} = \\frac{\\frac{1}{4}}{\\frac{5}{4}} = \\frac{1}{5}\n$$\n$$\n\\gamma_{rr} = 1 + \\frac{1}{4} = \\frac{5}{4}\n$$\n\nNext, we compute the Lorentz factor $W$ and the three-velocity $v^i$.\nThe Lorentz factor is defined as $W = \\alpha u^t$. Using the given value $u^t = \\frac{10}{\\sqrt{71}}$:\n$$\nW = \\alpha u^t = \\frac{2}{\\sqrt{5}} \\cdot \\frac{10}{\\sqrt{71}} = \\frac{20}{\\sqrt{355}} = \\frac{20}{\\sqrt{5}\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\nThe three-velocity $v^i$ is defined through the decomposition $u^{\\mu} = W(n^{\\mu} + v^{\\mu})$, where $n^\\mu = (\\frac{1}{\\alpha}, -\\frac{\\beta^i}{\\alpha})$ is the four-velocity of the Eulerian observer and $v^\\mu = (0, v^i)$ is a purely spatial vector in this coordinate system.\nFrom the spatial components of the decomposition, $u^i = W(n^i + v^i) = W(-\\frac{\\beta^i}{\\alpha} + v^i)$, we solve for $v^i$:\n$$\nv^i = \\frac{u^i}{W} + \\frac{\\beta^i}{\\alpha}\n$$\nThe only non-zero component is for $i=r$. We have $u^r = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}$.\n$$\nv^r = \\frac{u^r}{W} + \\frac{\\beta^r}{\\alpha} = \\left(\\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}\\right) \\left(\\frac{\\sqrt{5}\\sqrt{71}}{20}\\right) + \\frac{\\frac{1}{5}}{\\frac{2}{\\sqrt{5}}}\n$$\n$$\nv^r = \\frac{(6\\sqrt{5} - 10)\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{6(5) - 10\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{30 - 10\\sqrt{5}}{100} + \\frac{10\\sqrt{5}}{100} = \\frac{30}{100} = \\frac{3}{10}\n$$\nSince $u^\\theta=0$, $u^\\phi=0$, $\\beta^\\theta=0$, and $\\beta^\\phi=0$, the other components are $v^\\theta=0$ and $v^\\phi=0$.\n\nFinally, we verify the relation $W = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}$ from first principles and then with our calculated values.\nThe normalization of the four-velocity is $u^\\mu u_\\mu = -1$. Substituting the decomposition $u^\\mu = W(n^\\mu + v^\\mu)$:\n$$\n-1 = g_{\\mu\\nu}u^\\mu u^\\nu = W^2 g_{\\mu\\nu}(n^\\mu+v^\\mu)(n^\\nu+v^\\nu) = W^2(g_{\\mu\\nu}n^\\mu n^\\nu + 2g_{\\mu\\nu}n^\\mu v^\\nu + g_{\\mu\\nu}v^\\mu v^\\nu)\n$$\nWe know that $n^\\mu n_\\mu = g_{\\mu\\nu}n^\\mu n^\\nu = -1$.\nThe term $g_{\\mu\\nu}n^\\mu v^\\nu = n_\\nu v^\\nu = n_t v^t + n_i v^i$. Since we use the ADM chart where $n_i=0$ and the definition where $v^t=0$, this product is $n_\\nu v^\\nu = 0$.\nThe final term is $g_{\\mu\\nu}v^\\mu v^\\nu$. Since $v^t=0$, this becomes $g_{ij}v^i v^j = \\gamma_{ij}v^i v^j$.\nSubstituting these back into the normalization condition:\n$$\n-1 = W^2(-1 + 0 + \\gamma_{ij}v^i v^j)\n$$\n$$\n1 = W^2(1 - \\gamma_{ij}v^i v^j) \\implies W^2 = \\frac{1}{1 - \\gamma_{ij}v^i v^j}\n$$\nTaking the positive square root for the Lorentz factor gives the desired expression:\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij}v^i v^j}}\n$$\nThis verifies the formula from first principles.\n\nNow we perform the numerical verification. We calculate the right-hand side using our values for $\\gamma_{rr}$ and $v^r$:\n$$\n\\gamma_{ij}v^i v^j = \\gamma_{rr}(v^r)^2 = \\left(\\frac{5}{4}\\right)\\left(\\frac{3}{10}\\right)^2 = \\frac{5}{4} \\cdot \\frac{9}{100} = \\frac{45}{400} = \\frac{9}{80}\n$$\nPlugging this into the formula:\n$$\n\\frac{1}{\\sqrt{1-\\gamma_{ij}v^i v^j}} = \\frac{1}{\\sqrt{1 - \\frac{9}{80}}} = \\frac{1}{\\sqrt{\\frac{71}{80}}} = \\sqrt{\\frac{80}{71}} = \\frac{\\sqrt{16 \\cdot 5}}{\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\nThis result matches our earlier calculation of $W = \\alpha u^t = \\frac{4\\sqrt{5}}{\\sqrt{71}}$. The verification is successful.\n\nThe problem asks for the numerical value of $W$ rounded to four significant figures.\n$$\nW = \\frac{4\\sqrt{5}}{\\sqrt{71}} \\approx 1.06149000...\n$$\nRounding to four significant figures gives $1.061$.",
            "answer": "$$\n\\boxed{1.061}\n$$"
        },
        {
            "introduction": "The dynamics of astrophysical fluids are governed not only by gravity but also by their intrinsic thermodynamic properties, encapsulated in the Equation of State (EOS). The EOS relates pressure, density, and internal energy, and from it, we can derive the sound speed $c_s$, a quantity that dictates how pressure waves propagate. This practice  challenges you to work with a tabulated EOS—a common scenario for realistic nuclear matter—to compute key thermodynamic quantities and verify the system's hyperbolicity, a fundamental condition ensuring that the GRHD equations are well-posed and can be solved as an initial value problem.",
            "id": "3512082",
            "problem": "Design and implement a complete, runnable program that, for a given tabulated Equation of State (EOS) segment, computes the specific relativistic enthalpy $h$, the adiabatic sound speed $c_s$, and verifies the hyperbolicity of the General Relativistic Hydrodynamics (GRHD) system by checking that all characteristic speeds along a chosen direction are real and strictly subluminal. The program must use only the definitions and first principles stated below, with the computation carried out numerically from the provided table without relying on any closed-form shortcuts.\n\nAssumptions and physical units:\n- Work in flat spacetime (Minkowski metric), with the speed of light set to $c = 1$. All velocities are therefore dimensionless and must satisfy $|v| < 1$.\n- Adopt units where rest-mass energy per unit rest mass is $1$, so that the total energy density per unit volume is $e = \\rho (1 + \\epsilon)$, where $\\rho$ is the rest-mass density and $\\epsilon$ is the specific internal energy.\n\nFundamental bases to use:\n- Specific enthalpy per unit rest mass is defined by\n$$\nh \\equiv \\frac{e + p}{\\rho} \\, ,\n$$\nwith $e = \\rho (1 + \\epsilon)$, so that\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho} \\, .\n$$\n- The adiabatic sound speed is defined thermodynamically as the isentropic derivative\n$$\nc_s^2 \\equiv \\left(\\frac{\\partial p}{\\partial e}\\right)_s \\, .\n$$\nSince the tabulated EOS segment lies along a single isentrope, you must compute $c_s^2$ numerically at a queried state by using finite differences along the tabulated curve. Use the chain rule along the isentrope to write\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho} \\, ,\n$$\nwith derivatives evaluated numerically from the table. Use a centered difference at interior points and a one-sided difference at endpoints.\n- For one-dimensional propagation along the $x$-direction in flat spacetime, the characteristic speeds are those of sound waves seen in the laboratory frame, obtained from relativistic kinematics: sound waves move at $\\pm c_s$ in the fluid rest frame and must be combined with the fluid transport velocity by the Einstein velocity addition law to obtain laboratory-frame propagation speeds. The entropy/contact mode advects with the fluid. Use these principles to obtain the set of characteristic speeds along $x$, and verify that they are real and strictly less than the speed of light in magnitude.\n\nInterpolation and differentiation requirements:\n- The EOS is given as a tabulated segment of $(\\rho_i,\\epsilon_i,p_i)$ at monotonically increasing $\\rho_i$. To evaluate $h$ at a queried density $\\rho_\\star$, first obtain $\\epsilon(\\rho_\\star)$ and $p(\\rho_\\star)$ by piecewise-linear interpolation in $\\rho$. Then compute $h(\\rho_\\star)$ from its definition. For the sound speed, compute $c_s^2(\\rho_\\star)$ using finite differences of $p(\\rho)$ and $e(\\rho) = \\rho (1 + \\epsilon(\\rho))$ from the tabulated data; use a centered stencil where possible, and a one-sided stencil otherwise. Then set $c_s(\\rho_\\star) = \\sqrt{c_s^2(\\rho_\\star)}$ if $c_s^2(\\rho_\\star) \\ge 0$; otherwise treat the case as non-hyperbolic.\n\nEOS table:\n- The tabulated EOS segment is along a single isentrope and is provided as $9$ triplets $(\\rho_i,\\epsilon_i,p_i)$ at the following densities. All quantities are dimensionless in units with $c=1$.\n  - $(\\rho, \\epsilon, p) = ($$0.05$$, $$0.007368062997280766$$, $$0.00012280104995467942$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.1$$, $$0.009283177667225558$$, $$0.00030943925557418527$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.2$$, $$0.011696070952851467$$, $$0.0007797380635234311$$)$\n  - $(\\rho, \\epsilon, p) = ($$0.5$$, $$0.015874010519681995$$, $$0.0026456684199469994$$)$\n  - $(\\rho, \\epsilon, p) = ($$1.0$$, $$0.02$$, $$0.006666666666666667$$)$\n  - $(\\rho, \\epsilon, p) = ($$2.0$$, $$0.025198420997897465$$, $$0.016798947331931643$$)$\n  - $(\\rho, \\epsilon, p) = ($$5.0$$, $$0.03419951893353394$$, $$0.05699919822255657$$)$\n  - $(\\rho, \\epsilon, p) = ($$10.0$$, $$0.04308869380063768$$, $$0.143628979335459$$)$\n  - $(\\rho, \\epsilon, p) = ($$20.0$$, $$0.05428835233189813$$, $$0.36192234887932087$$)$\n\nCharacteristic speed check:\n- For each queried state $(\\rho_\\star, v_x)$ with $|v_x| < 1$, construct the full set of one-dimensional characteristic speeds along $x$ and check that all are real and strictly subluminal in magnitude. Conclude the system is hyperbolic at that state if and only if all characteristic speeds satisfy these conditions.\n\nTest suite:\n- Use the following $5$ test cases, each given as $(\\rho_\\star, v_x)$:\n  - Case A: $(\\rho_\\star, v_x) = ($$1.0$$, $$0.3$$)$\n  - Case B: $(\\rho_\\star, v_x) = ($$0.1$$, $$0.0$$)$\n  - Case C: $(\\rho_\\star, v_x) = ($$10.0$$, $$0.9$$)$\n  - Case D: $(\\rho_\\star, v_x) = ($$20.0$$, $$0.5$$)$\n  - Case E: $(\\rho_\\star, v_x) = ($$0.05$$, $$0.2$$)$\n\nProgram requirements:\n- For each test case, compute and return a list $[h, c_s, \\mathrm{hyper}]$, where $h$ and $c_s$ are floats rounded to exactly eight digits after the decimal point, and $\\mathrm{hyper}$ is an integer equal to $1$ if the characteristic speeds are all real and strictly subluminal, and $0$ otherwise.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the three-element list corresponding to one test case, in the order A, B, C, D, E. For example, the output must look like\n$$\n[\\,[h_A,c_{s,A},\\mathrm{hyper}_A],\\,[h_B,c_{s,B},\\mathrm{hyper}_B],\\,[h_C,c_{s,C},\\mathrm{hyper}_C],\\,[h_D,c_{s,D},\\mathrm{hyper}_D],\\,[h_E,c_{s,E},\\mathrm{hyper}_E]\\,]\n$$\nwith $h_\\cdot$ and $c_{s,\\cdot}$ printed to exactly eight digits after the decimal point, and $\\mathrm{hyper}_\\cdot$ as either $1$ or $0$.",
            "solution": "The problem requires the computation of several key quantities in relativistic hydrodynamics—specific enthalpy $h$, adiabatic sound speed $c_s$, and a hyperbolicity check—for a set of states, using a provided tabulated Equation of State (EOS). The procedure must adhere to first principles and specified numerical methods.\n\nFirst, the validity of the problem statement is confirmed. It is scientifically grounded in the established principles of special relativistic hydrodynamics. The definitions for thermodynamic quantities like specific enthalpy $h=1+\\epsilon+p/\\rho$ and total energy density $e=\\rho(1+\\epsilon)$ are standard. The thermodynamic definition of the adiabatic sound speed $c_s^2 = (\\partial p / \\partial e)_s$ and its numerical evaluation via the chain rule $c_s^2 = (\\mathrm{d}p/\\mathrm{d}\\rho)/(\\mathrm{d}e/\\mathrm{d}\\rho)$ along a given isentrope are correct. The derivation of characteristic speeds from the Einstein velocity addition formula is also a standard textbook procedure. The problem is well-posed, providing all necessary data (the EOS table) and clear, unambiguous instructions for numerical computations (finite differences, handling of endpoints). The provided data appears physically consistent. Therefore, the problem is deemed valid and a solution can be formulated.\n\nThe solution proceeds as follows: for each given test case, specified by a rest-mass density $\\rho_\\star$ and a fluid velocity $v_x$, we compute the required quantities.\n\n**1. Data Representation and Pre-computation**\n\nThe provided EOS is a table of $N=9$ discrete points $(\\rho_i, \\epsilon_i, p_i)$ along a single isentrope. For numerical differentiation involving the total energy density $e$, it is efficient to first pre-compute the list of $e_i = \\rho_i(1+\\epsilon_i)$ for all $i \\in \\{1, \\dots, N\\}$. The test cases provide query densities $\\rho_\\star$ that are all present in the tabulated $\\rho_i$ values. This simplifies the task, as no interpolation is needed; we can directly identify the index $i$ such that $\\rho_i = \\rho_\\star$ and use the corresponding values $(\\epsilon_i, p_i)$.\n\n**2. Calculation of Specific Enthalpy ($h$)**\n\nThe specific relativistic enthalpy per unit rest mass, $h$, is defined as $h \\equiv (e+p)/\\rho$. Substituting the definition of $e=\\rho(1+\\epsilon)$, this becomes:\n$$\nh = \\frac{\\rho(1+\\epsilon) + p}{\\rho} = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\nFor a queried density $\\rho_\\star$ corresponding to the grid point $i$, the enthalpy is calculated directly using the tabulated values:\n$$\nh(\\rho_i) = 1 + \\epsilon_i + \\frac{p_i}{\\rho_i}\n$$\n\n**3. Calculation of Adiabatic Sound Speed ($c_s$)**\n\nThe adiabatic sound speed squared, $c_s^2$, is computed numerically from the tabulated data. The problem specifies using the formula derived from the chain rule along the isentropic curve:\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho}\n$$\nThe derivatives are approximated using finite differences.\nLet the tabulated data points be indexed from $i=0$ to $N-1=8$.\n\nFor an interior point ($0 < i < N-1$), we use a second-order centered difference stencil:\n$$\n\\left(\\frac{\\mathrm{d}p}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{p_{i+1} - p_{i-1}}{\\rho_{i+1} - \\rho_{i-1}} \\quad \\text{and} \\quad \\left(\\frac{\\mathrm{d}e}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{e_{i+1} - e_{i-1}}{\\rho_{i+1} - \\rho_{i-1}}\n$$\nSubstituting these into the expression for $c_s^2$ yields:\n$$\nc_s^2(\\rho_i) \\approx \\frac{(p_{i+1} - p_{i-1})/(\\rho_{i+1} - \\rho_{i-1})}{(e_{i+1} - e_{i-1})/(\\rho_{i+1} - \\rho_{i-1})} = \\frac{p_{i+1} - p_{i-1}}{e_{i+1} - e_{i-1}}\n$$\n\nFor the left endpoint ($i=0$), we use a first-order forward difference stencil:\n$$\nc_s^2(\\rho_0) \\approx \\frac{(p_1 - p_0)/(\\rho_1 - \\rho_0)}{(e_1 - e_0)/(\\rho_1 - \\rho_0)} = \\frac{p_1 - p_0}{e_1 - e_0}\n$$\n\nFor the right endpoint ($i=N-1$), we use a first-order backward difference stencil:\n$$\nc_s^2(\\rho_{N-1}) \\approx \\frac{(p_{N-1} - p_{N-2})/(\\rho_{N-1} - \\rho_{N-2})}{(e_{N-1} - e_{N-2})/(\\rho_{N-1} - \\rho_{N-2})} = \\frac{p_{N-1} - p_{N-2}}{e_{N-1} - e_{N-2}}\n$$\n\nAfter obtaining a value for $c_s^2$, we calculate the sound speed $c_s$. For a physically valid system, we expect $c_s^2 \\ge 0$. The sound speed is then $c_s = \\sqrt{c_s^2}$. If $c_s^2 < 0$, the sound speed is imaginary, which is a condition for instability, and the hyperbolicity of the governing equations is broken.\n\n**4. Hyperbolicity Verification**\n\nThe system of special relativistic hydrodynamic equations is hyperbolic if and only if its characteristic wave speeds are all real and distinct. For one-dimensional flow along the $x$-direction, in the fluid's rest frame, there are three characteristic modes: two sound waves propagating at speeds $\\pm c_s$ and one contact/entropy wave propagating at speed $0$.\n\nTo find the speeds in the laboratory frame, where the fluid moves with velocity $v_x$, we use the Einstein velocity addition formula. The speeds are:\n1.  Contact/Entropy mode: $\\lambda_0 = v_x$\n2.  Forward-propagating sound mode: $\\lambda_+ = \\frac{v_x + c_s}{1 + v_x c_s}$\n3.  Backward-propagating sound mode: $\\lambda_- = \\frac{v_x - c_s}{1 - v_x c_s}$\n\nFor the system to be hyperbolic and for causality to be respected, all characteristic speeds $\\lambda_k$ must be real and strictly subluminal, i.e., $|\\lambda_k| < 1$ (since $c=1$).\n- The condition $|\\lambda_0| < 1$ requires $|v_x|<1$, which is given for all test cases.\n- For $\\lambda_{\\pm}$ to be real, $c_s$ must be real, which implies $c_s^2 \\ge 0$.\n- The condition $|\\lambda_{\\pm}| < 1$ can be shown to be equivalent to the condition $c_s^2 < 1$, given that $|v_x|<1$. The derivation proceeds as:\n  $$ \\left| \\frac{v_x \\pm c_s}{1 \\pm v_x c_s} \\right| < 1 \\iff (v_x \\pm c_s)^2 < (1 \\pm v_x c_s)^2 $$\n  $$ \\iff v_x^2 \\pm 2v_x c_s + c_s^2 < 1 \\pm 2v_x c_s + v_x^2 c_s^2 $$\n  $$ \\iff v_x^2 + c_s^2 < 1 + v_x^2 c_s^2 \\iff v_x^2 - v_x^2 c_s^2 - 1 + c_s^2 < 0 $$\n  $$ \\iff (v_x^2 - 1)(1 - c_s^2) < 0 $$\nSince $|v_x|<1$, the term $(v_x^2 - 1)$ is negative. For the inequality to hold, the term $(1-c_s^2)$ must be positive, which means $c_s^2 < 1$.\n\nTherefore, the complete set of conditions for hyperbolicity in this context simplifies to the requirement that the adiabatic sound speed is real and subluminal:\n$$\n0 \\le c_s^2 < 1\n$$\nThe program will evaluate this condition. If it is met, the hyperbolicity flag `hyper` is set to $1$; otherwise, it is set to $0$.\n\nThe implementation will process each test case $(\\rho_\\star, v_x)$ by first locating the corresponding index in the EOS table, then sequentially computing $h$, $c_s^2$, $c_s$, and the hyperbolicity flag, and finally formatting the results as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes specific enthalpy, sound speed, and verifies hyperbolicity for GRHD\n    states based on a tabulated equation of state.\n    \"\"\"\n    \n    # EOS table provided in the problem statement.\n    # Columns: rho, epsilon, p\n    eos_data = [\n        (0.05, 0.007368062997280766, 0.00012280104995467942),\n        (0.1,  0.009283177667225558, 0.00030943925557418527),\n        (0.2,  0.011696070952851467, 0.0007797380635234311),\n        (0.5,  0.015874010519681995, 0.0026456684199469994),\n        (1.0,  0.02,                   0.006666666666666667),\n        (2.0,  0.025198420997897465, 0.016798947331931643),\n        (5.0,  0.03419951893353394,  0.05699919822255657),\n        (10.0, 0.04308869380063768,  0.143628979335459),\n        (20.0, 0.05428835233189813,  0.36192234887932087),\n    ]\n\n    rho = np.array([row[0] for row in eos_data])\n    epsilon = np.array([row[1] for row in eos_data])\n    p = np.array([row[2] for row in eos_data])\n\n    # Pre-compute total energy density e = rho * (1 + epsilon)\n    e = rho * (1 + epsilon)\n    \n    # Map rho values to their indices for quick lookup\n    rho_to_index = {val: i for i, val in enumerate(rho)}\n    \n    # Test suite provided in the problem statement.\n    test_cases = [\n        (1.0,  0.3),  # Case A\n        (0.1,  0.0),  # Case B\n        (10.0, 0.9),  # Case C\n        (20.0, 0.5),  # Case D\n        (0.05, 0.2),  # Case E\n    ]\n\n    results = []\n    for rho_star, vx in test_cases:\n        if rho_star not in rho_to_index:\n            # This case should not occur based on the problem statement\n            # but is good practice to handle.\n            raise ValueError(f\"Queried density rho_star={rho_star} not in EOS table.\")\n        \n        idx = rho_to_index[rho_star]\n        \n        # 1. Calculate specific enthalpy h = 1 + epsilon + p/rho\n        h_val = 1 + epsilon[idx] + p[idx] / rho[idx]\n        \n        # 2. Calculate sound speed squared (cs2)\n        cs2 = 0.0\n        if idx == 0:\n            # Forward difference for the first point\n            dp = p[idx+1] - p[idx]\n            de = e[idx+1] - e[idx]\n            cs2 = dp / de if de != 0 else float('inf')\n        elif idx == len(rho) - 1:\n            # Backward difference for the last point\n            dp = p[idx] - p[idx-1]\n            de = e[idx] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n        else:\n            # Centered difference for interior points\n            dp = p[idx+1] - p[idx-1]\n            de = e[idx+1] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n            \n        # 3. Calculate sound speed (cs) and check hyperbolicity\n        cs_val = 0.0\n        is_hyperbolic = 0 # Corresponds to the 'hyper' flag\n        \n        if 0 = cs2  1:\n            # Condition for hyperbolicity: 0 = cs^2  1 (since c=1)\n            is_hyperbolic = 1\n            cs_val = np.sqrt(cs2)\n        elif cs2 >= 1:\n            # Subluminal sound speed is violated\n            is_hyperbolic = 0\n            cs_val = np.sqrt(cs2)\n        else: # cs2  0\n            # Real sound speed is violated (stability issue)\n            is_hyperbolic = 0\n            cs_val = 0.0 # Cannot compute real sqrt, return 0 as per robust plan\n\n        # Format and append results\n        # h and cs are rounded to exactly 8 decimal places\n        # hyper is an integer (1 or 0)\n        h_formatted = f\"{h_val:.8f}\"\n        cs_formatted = f\"{cs_val:.8f}\"\n        \n        results.append([float(h_formatted), float(cs_formatted), is_hyperbolic])\n\n    # Format the final output string exactly as required\n    # e.g., [[1.0, 2.0, 1], [3.0, 4.0, 0]]\n    list_of_strs = [str(item) for item in results]\n    final_output = f\"[{','.join(list_of_strs)}]\"\n    \n    # Custom formatting to remove spaces for stricter compliance.\n    # This generates output like [[1.0,2.0,1],[3.0,4.0,0]]\n    sublist_strs = []\n    for res in results:\n        h_str = f\"{res[0]:.8f}\"\n        cs_str = f\"{res[1]:.8f}\"\n        hyper_str = str(res[2])\n        sublist_strs.append(f\"[{h_str},{cs_str},{hyper_str}]\")\n    final_output_no_space = f\"[{','.join(sublist_strs)}]\"\n\n    print(final_output_no_space)\n\nsolve()\n```"
        },
        {
            "introduction": "When magnetic fields are included, we enter the realm of General Relativistic Magnetohydrodynamics (GRMHD), which introduces a new and critical constraint: the magnetic field must remain divergence-free ($\\partial_i(\\sqrt{\\gamma}B^i) = 0$) at all times. Naive numerical methods often fail to uphold this law, leading to unphysical behavior and simulation crashes. This exercise  delves into Constrained Transport (CT), the standard, elegant solution to this problem, requiring you to implement a staggered-grid scheme that preserves the divergence-free condition to machine precision by construction, even in the strongly curved spacetime near a black hole's event horizon.",
            "id": "3512085",
            "problem": "Implement a discrete constrained transport scheme for the homogeneous Maxwell equations in a curved spacetime corresponding to the Schwarzschild black hole written in ingoing Kerr–Schild spherical–polar coordinates. Work in the time-independent, axisymmetric setting so that only the spatial divergence constraint must be demonstrated. The goal is twofold: to show numerically that the discrete divergence of the magnetic field vanishes to roundoff error everywhere in the domain, including cells that straddle the event horizon, and to measure how a non-conservative, naive estimate of the divergence scales with resolution.\n\nBegin from the homogeneous Maxwell equations in the standard $3+1$ split of General Relativity, where the spatial magnetic field is represented by its contravariant components $B^i$ and the spatial metric has determinant $\\gamma$. The magnetic field satisfies the divergence constraint\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right)=0,\n$$\nwhere $\\partial_i$ denotes the partial derivative with respect to the spatial coordinates. In constrained transport, one represents the face-centered magnetic flux density (also called the magnetic induction density)\n$$\n\\Phi^i \\equiv \\sqrt{\\gamma}\\,B^i\n$$\nas a discrete curl of an edge-centered vector potential $A_i$ in terms of the Levi–Civita symbol density $\\,\\varepsilon^{ijk}$:\n$$\n\\Phi^i = \\varepsilon^{ijk}\\,\\partial_j A_k,\n$$\nso that the discrete divergence of $\\Phi^i$ vanishes identically to roundoff by the discrete analog of the vector identity that the divergence of a curl is zero.\n\nUse the Schwarzschild spacetime in ingoing Kerr–Schild spherical–polar coordinates $(t,r,\\theta,\\phi)$ in geometrized units where the gravitational constant $G$ and the speed of light $c$ are set to unity. Let the black hole mass be $M=1$, so the event horizon radius is $r_H=2M=2$. In this coordinate system, the spatial metric on $t=\\text{constant}$ slices is diagonal, with\n$$\n\\gamma_{rr} = 1 + \\frac{2M}{r},\\quad \\gamma_{\\theta\\theta} = r^2,\\quad \\gamma_{\\phi\\phi} = r^2\\sin^2\\theta,\n$$\nand determinant\n$$\n\\gamma = \\left(1+\\frac{2M}{r}\\right) r^4 \\sin^2\\theta,\\quad \\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+\\frac{2M}{r}}.\n$$\n\nConstruct a uniform spherical–polar grid in $r\\in[r_{\\min},r_{\\max}]$ and $\\theta\\in[\\theta_{\\min},\\theta_{\\max}]$ with $N_r$ and $N_\\theta$ cells, respectively. Use\n$$\nr_{\\min}=1.6,\\quad r_{\\max}=10.0,\\quad \\theta_{\\min}=0.05,\\quad \\theta_{\\max}=\\pi-0.05,\n$$\nso that the domain strictly includes zones on both sides of the event horizon while avoiding the coordinate singularity at the poles. Assume axisymmetry and suppress the $\\phi$-direction (equivalently, $N_\\phi=1$ with no variation).\n\nDefine the only nonzero component of the vector potential to be the covariant azimuthal component $A_\\phi$, sampled at the edges that run along the $\\phi$-direction. Place these edges at the intersections of the $r$- and $\\theta$-face locations, i.e., at $(r_{i+\\frac{1}{2}},\\theta_{j+\\frac{1}{2}})$ for $i=0,\\dots,N_r-1$ and $j=0,\\dots,N_\\theta-1$. Use the smooth, localized, horizon-crossing field\n$$\nA_\\phi(r,\\theta) = A_0\\, r^2 \\sin^2\\theta \\,\\exp\\!\\left(-\\left(\\frac{r}{r_0}\\right)^2\\right),\n$$\nwith $A_0=1$ and $r_0=4$.\n\nImplement discrete constrained transport in these coordinates by defining the face-centered flux densities\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta},\n$$\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\,\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r},\n$$\nand $\\Phi^\\phi=0$. Here $\\Delta r=(r_{\\max}-r_{\\min})/N_r$ and $\\Delta\\theta=(\\theta_{\\max}-\\theta_{\\min})/N_\\theta$, and indices $i$ and $j$ refer to cell-centered indices in $r$ and $\\theta$. This is the discrete representation of $\\Phi^i = \\varepsilon^{ijk}\\partial_j A_k$ in spherical–polar coordinates under the axisymmetric assumption.\n\nDefine the discrete divergence of the flux density at cell centers $(i,j)$ by\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}.\n$$\nAccording to the constrained transport construction, this discrete divergence is expected to vanish to roundoff everywhere, including cells intersecting the horizon.\n\nFor comparison, also compute a non-conservative, naive estimate of the curved-space divergence that mimics a common non-staggered discretization. First recover face-centered magnetic field components $B^r=\\Phi^r/\\sqrt{\\gamma}$ and $B^\\theta=\\Phi^\\theta/\\sqrt{\\gamma}$ using $\\sqrt{\\gamma}$ evaluated at the corresponding face locations, then average these to cell centers to obtain $B^r_{c}$ and $B^\\theta_{c}$. Next compute the cell-centered approximation of\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive}} \\equiv \\frac{1}{\\sqrt{\\gamma}}\\left[\\partial_r\\left(\\sqrt{\\gamma}\\,B^r\\right) + \\partial_\\theta\\left(\\sqrt{\\gamma}\\,B^\\theta\\right)\\right]\n$$\nusing second-order centered finite differences for the derivatives on the cell-centered arrays and $\\sqrt{\\gamma}$ at cell centers. Restrict this naive divergence estimate to interior cells so that centered stencils are available.\n\nImplement both estimators on the same grids and report the following two scalar error measures for each resolution:\n- The maximum absolute value of the constrained transport discrete divergence over all cells,\n$$\nE_{\\mathrm{CT}} \\equiv \\max_{i,j} \\left|\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij}\\right|.\n$$\n- The root-mean-square of the naive divergence over interior cells,\n$$\nE_{\\mathrm{naive}} \\equiv \\sqrt{\\frac{1}{N_{\\mathrm{int}}}\\sum_{\\text{interior }(i,j)} \\left(\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive},ij}\\right)^2 },\n$$\nwhere $N_{\\mathrm{int}}$ is the number of interior cells used by the centered stencil. These are dimensionless numbers in the code units used.\n\nTest suite. Run the program for the following three resolutions:\n- Case A (happy path): $N_r=48$, $N_\\theta=48$.\n- Case B (refinement): $N_r=96$, $N_\\theta=96$.\n- Case C (further refinement): $N_r=192$, $N_\\theta=192$.\n\nYour program should produce a single line of output containing the six results in the order\n$$\n\\left[E_{\\mathrm{CT}}^{(A)},\\,E_{\\mathrm{naive}}^{(A)},\\,E_{\\mathrm{CT}}^{(B)},\\,E_{\\mathrm{naive}}^{(B)},\\,E_{\\mathrm{CT}}^{(C)},\\,E_{\\mathrm{naive}}^{(C)}\\right],\n$$\nprinted as a comma-separated list enclosed in square brackets, with each floating-point number in scientific notation with six significant digits. No other text should be printed. All calculations are to be carried out in geometrized units and angles in radians. The expected qualitative behavior is that $E_{\\mathrm{CT}}$ is at the level of roundoff for all resolutions and that $E_{\\mathrm{naive}}$ decreases approximately like the square of the grid spacing as the resolution increases.",
            "solution": "The problem requires the implementation and validation of a discrete constrained transport (CT) scheme for the homogeneous Maxwell equations in the curved spacetime of a Schwarzschild black hole. The goal is to demonstrate that the CT scheme preserves the divergence-free constraint of the magnetic field to machine precision and to compare its accuracy against a more straightforward, non-conservative numerical approach. The context is axisymmetric, so we consider a two-dimensional grid in spherical-polar coordinates $(r, \\theta)$.\n\nThe governing physical principle is the divergence constraint on the magnetic field $\\mathbf{B}$, which in the $3+1$ formalism of general relativity is expressed in terms of the spatial metric determinant $\\gamma$ and the contravariant components of the magnetic field $B^i$ as:\n$$\n\\partial_i \\left( \\sqrt{\\gamma} B^i \\right) = 0\n$$\nwhere summation over the repeated index $i \\in \\{r, \\theta, \\phi\\}$ is implied. The quantity $\\Phi^i \\equiv \\sqrt{\\gamma} B^i$ is the magnetic flux density.\n\nTo numerically enforce this constraint, the constrained transport method represents the magnetic flux density as the curl of a vector potential, $A_k$. In this problem, we are given a discrete representation inspired by the continuous relation $\\Phi^i = \\varepsilon^{ijk} \\partial_j A_k$, where $\\varepsilon^{ijk}$ is the Levi-Civita symbol density. The key idea is that the divergence of a curl is identically zero. A discrete implementation that correctly mimics this property will preserve the divergence-free condition to the level of floating-point roundoff error.\n\nThe numerical implementation is performed on a staggered grid. We define a uniform grid of $N_r \\times N_\\theta$ cells in the domain $(r, \\theta)$. The fundamental quantities are located as follows:\n-   Cell centers are at $(r_i, \\theta_j)$, for $i \\in \\{0, \\dots, N_r-1\\}, j \\in \\{0, \\dots, N_\\theta-1\\}$.\n-   Vertical faces (constant $r$) are at $r_{i \\pm 1/2}$, and horizontal faces (constant $\\theta$) are at $\\theta_{j \\pm 1/2}$.\n-   The vector potential $A_\\phi$ is defined at the cell corners (or edges, oriented in the $\\phi$-direction), with coordinates $(r_{i+1/2}, \\theta_{j+1/2})$.\n\nGiven the vector potential $A_\\phi(r, \\theta)$ sampled at cell corners, the face-centered magnetic flux densities $\\Phi^r$ and $\\Phi^\\theta$ are computed using a discrete curl operation.\nThe radial flux $\\Phi^r$ is located on $r$-faces (at locations $(r_{i+1/2}, \\theta_j)$) and is computed via a finite difference of $A_\\phi$ in the $\\theta$-direction:\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\nThe polar flux $\\Phi^\\theta$ is located on $\\theta$-faces (at locations $(r_i, \\theta_{j+1/2})$) and is computed via a finite difference of $A_\\phi$ in the $r$-direction:\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r}\n$$\nDue to axisymmetry, $\\Phi^\\phi = 0$.\n\nThe discrete divergence is then computed at cell centers $(r_i, \\theta_j)$ by taking finite differences of the face-centered fluxes:\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\nSubstituting the definitions for the fluxes into the divergence expression reveals that the terms cancel out exactly:\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} = \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} \\right) - \\left( A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] \\\\\n- \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} \\right) - \\left( A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] = 0\n$$\nThis algebraic cancellation guarantees that the computed divergence will be zero up to machine precision. The error metric for this method is the maximum absolute value of this discrete divergence over all grid cells, $E_{\\mathrm{CT}}$.\n\nFor comparison, a non-conservative, \"naive\" method is implemented. This approach fails to preserve the divergence-free property at the discrete level. The procedure is as follows:\n1.  Compute the face-centered physical magnetic field components $B^r = \\Phi^r / \\sqrt{\\gamma}$ and $B^\\theta = \\Phi^\\theta / \\sqrt{\\gamma}$, using values of $\\sqrt{\\gamma}$ evaluated at the corresponding face locations. The metric determinant is $\\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+2M/r}$.\n2.  Average the face-centered components $B^r$ and $B^\\theta$ to obtain cell-centered fields, $B^r_c$ and $B^\\theta_c$. For instance, $B^r_{c,ij} = \\frac{1}{2}(B^r_{i+1/2,j} + B^r_{i-1/2,j})$.\n3.  Reconstruct cell-centered flux densities using the cell-centered fields and cell-centered metric determinant value: $F^r_c = (\\sqrt{\\gamma} B^r)_c$ and $F^\\theta_c = (\\sqrt{\\gamma} B^\\theta)_c$.\n4.  Approximate the divergence $\\frac{1}{\\sqrt{\\gamma}}[\\partial_r(\\sqrt{\\gamma}B^r) + \\partial_\\theta(\\sqrt{\\gamma}B^\\theta)]$ using second-order centered finite differences for the derivatives of $F^r_c$ and $F^\\theta_c$ on the grid of interior cells.\n\nThis naive method introduces truncation errors at each step (averaging and differentiation). Since the true divergence of the analytic field is zero, the numerically computed divergence will be on the order of the truncation error, which is expected to be second-order in the grid spacing, i.e., $O(\\Delta r^2, \\Delta \\theta^2)$. The error metric $E_{\\mathrm{naive}}$ is the root-mean-square of this naive divergence over the interior grid cells. We expect $E_{\\mathrm{naive}}$ to decrease by a factor of approximately $4$ each time the resolution is doubled.\n\nThe calculations are performed for three grid resolutions ($48 \\times 48$, $96 \\times 96$, and $192 \\times 192$) on a domain that straddles the black hole event horizon at $r=2M=2$, demonstrating the robustness of the CT method even in this strong-gravity regime.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares constrained transport and naive divergence schemes\n    for the magnetic field in Schwarzschild spacetime.\n    \"\"\"\n\n    def run_case(Nr, Nth):\n        \"\"\"\n        Runs the simulation for a single resolution (Nr, Nth).\n\n        Returns:\n            E_ct (float): Maximum absolute error for the CT method.\n            E_naive (float): RMS error for the naive method.\n        \"\"\"\n        # Physical and domain constants\n        M = 1.0\n        A0 = 1.0\n        r0 = 4.0\n        rmin, rmax = 1.6, 10.0\n        th_min, th_max = 0.05, np.pi - 0.05\n\n        # Grid setup\n        dr = (rmax - rmin) / Nr\n        dth = (th_max - th_min) / Nth\n        \n        r_faces = np.linspace(rmin, rmax, Nr + 1, dtype=np.float64)\n        th_faces = np.linspace(th_min, th_max, Nth + 1, dtype=np.float64)\n        r_centers = rmin + (np.arange(Nr, dtype=np.float64) + 0.5) * dr\n        th_centers = th_min + (np.arange(Nth, dtype=np.float64) + 0.5) * dth\n\n        # Vector potential A_phi defined at grid corners (intersections of faces)\n        R_corners, TH_corners = np.meshgrid(r_faces, th_faces, indexing='ij')\n        A_phi_corners = A0 * R_corners**2 * np.sin(TH_corners)**2 * np.exp(-(R_corners/r0)**2)\n\n        # ---- Constrained Transport (CT) Divergence Calculation ----\n\n        # Magnetic flux densities at faces from discrete curl of A_phi\n        # Phi_r is located at (r-faces, theta-centers), size (Nr+1, Nth)\n        Phi_r = (A_phi_corners[:, 1:] - A_phi_corners[:, :-1]) / dth\n        # Phi_theta is located at (r-centers, theta-faces), size (Nr, Nth+1)\n        Phi_theta = - (A_phi_corners[1:, :] - A_phi_corners[:-1, :]) / dr\n\n        # Discrete divergence at cell centers, size (Nr, Nth)\n        divB_CT = (Phi_r[1:, :] - Phi_r[:-1, :]) / dr \\\n                + (Phi_theta[:, 1:] - Phi_theta[:, :-1]) / dth\n        \n        # Maximum absolute error for the CT method\n        E_ct = np.max(np.abs(divB_CT))\n\n        # ---- Naive Divergence Calculation ----\n\n        def sqrt_gamma(r, th, mass):\n            r_safe = np.maximum(r, 1e-15) # Avoid r=0 issues, though domain prevents it.\n            return r_safe**2 * np.sin(th) * np.sqrt(1.0 + 2.0 * mass / r_safe)\n\n        # sqrt(gamma) on r-faces grid (locations of Phi_r)\n        R_rf, TH_rf = np.meshgrid(r_faces, th_centers, indexing='ij')\n        sg_rf = sqrt_gamma(R_rf, TH_rf, M)\n\n        # sqrt(gamma) on theta-faces grid (locations of Phi_theta)\n        R_thf, TH_thf = np.meshgrid(r_centers, th_faces, indexing='ij')\n        sg_thf = sqrt_gamma(R_thf, TH_thf, M)\n\n        # Physical magnetic field components B at faces\n        Br_face = Phi_r / sg_rf\n        Bth_face = Phi_theta / sg_thf\n\n        # Average B fields to cell centers\n        Br_c = 0.5 * (Br_face[1:, :] + Br_face[:-1, :])\n        Bth_c = 0.5 * (Bth_face[:, 1:] + Bth_face[:, :-1])\n        \n        # Cell-centered fluxes for naive method\n        R_c, TH_c = np.meshgrid(r_centers, th_centers, indexing='ij')\n        sg_c = sqrt_gamma(R_c, TH_c, M)\n        \n        Fr_c = sg_c * Br_c\n        Fth_c = sg_c * Bth_c\n\n        # Derivatives of fluxes at interior cell centers using 2nd order centered stencil\n        # Interior indices i in [1, Nr-2] and j in [1, Nth-2]\n        d_dr_Fr = (Fr_c[2:, 1:-1] - Fr_c[:-2, 1:-1]) / (2 * dr)\n        d_dth_Fth = (Fth_c[1:-1, 2:] - Fth_c[1:-1, :-2]) / (2 * dth)\n\n        # Naive divergence at interior cells\n        divB_naive_interior = (d_dr_Fr + d_dth_Fth) / sg_c[1:-1, 1:-1]\n        \n        # RMS error for naive method\n        N_int = (Nr - 2) * (Nth - 2)\n        E_naive = np.sqrt(np.sum(divB_naive_interior**2) / N_int)\n\n        return E_ct, E_naive\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (48, 48),    # Case A\n        (96, 96),    # Case B\n        (192, 192),  # Case C\n    ]\n\n    results = []\n    for Nr, Nth in test_cases:\n        E_ct, E_naive = run_case(Nr, Nth)\n        results.extend([E_ct, E_naive])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6e}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}