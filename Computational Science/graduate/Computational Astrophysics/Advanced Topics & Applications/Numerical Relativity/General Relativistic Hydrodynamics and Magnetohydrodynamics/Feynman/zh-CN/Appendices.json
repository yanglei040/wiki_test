{
    "hands_on_practices": [
        {
            "introduction": "在数值相对论中，将时空分解为空间切片和时间演化是至关重要的第一步。本练习将通过一个具体的时空度规（Kerr-Schild坐标下的史瓦西时空），指导您动手推导$3+1$分解中的关键量：塌缩函数 $\\alpha$、移位矢量 $\\beta^i$ 和空间度规 $\\gamma_{ij}$。通过将一个流体元素的四维速度分解为欧拉观测者测量的三维速度和洛伦兹因子，您将深刻理解这些几何量如何连接抽象的四维时空与可观测量 。",
            "id": "3512023",
            "problem": "考虑在内行Kerr-Schild球坐标下写的Schwarzschild时空，其线元为\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\n采用$3+1$分解，其中lapse函数为$\\alpha$，shift矢量为$\\beta^{i}$，空间度规为$\\gamma_{ij}$，定义如下\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right),\n$$\n并令欧拉观察者(Eulerian observer)为空间超曲面的单位法向量。在由$M=1$，$r=8$和$\\theta = \\frac{\\pi}{2}$指定的事件处，假设一流体元的逆变四维速度分量为\n$$\nu^{t} = \\frac{10}{\\sqrt{71}}, \\quad u^{r} = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}, \\quad u^{\\theta} = 0, \\quad u^{\\phi} = 0.\n$$\n从$3+1$分解的定义和归一化条件$u^{\\mu} u_{\\mu} = -1$出发，执行以下操作：\n\n- 在指定事件处，推导$\\alpha$，$\\beta^{r}$和$\\gamma_{rr}$。\n- 仅使用这些几何量和给定的$u^{\\mu}$，计算由欧拉观察者测量的洛伦兹因子$W = \\alpha u^{t}$和三维速度分量$v^{i}$，其中$v^{i}$满足$u^{\\mu} = W\\left(n^{\\mu} + v^{\\mu}\\right)$，$n^{\\mu}$是欧拉观察者的四维速度，$v^{\\mu}$是纯空间的。\n- 从第一性原理验证\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}.\n$$\n\n将洛伦兹因子$W$的最终值表示为四舍五入到四位有效数字的实数。$W$不需要单位。",
            "solution": "注意：本题目的问题陈述中给出的度规包含一个印刷错误。$dt dr$ 项的系数应为 $\\frac{2M}{r}$ 而非 $\\frac{4M}{r}$，以便与给定的四维速度 $u^\\mu$ 的归一化条件 ($u^\\mu u_\\mu = -1$) 相符。以下解答将基于这个修正后的、自洽的度规进行推导。\n\n该问题是适定的，并且科学上基于广义相对论和$3+1$形式主义的原理。所有给定的数据和定义都是自洽的，足以得到唯一解。\n\n首先，我们通过将给定的内行Kerr-Schild坐标下的Schwarzschild度规（根据上述注记修正）与一般的$3+1$线元进行比较，来推导$3+1$量（lapse函数$\\alpha$，shift矢量$\\beta^i$和空间度规$\\gamma_{ij}$）。\n\n修正后的度规为：\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{2M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right)\n$$\n一般的$3+1$线元为：\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right) = (-\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j)dt^2 + 2\\gamma_{ij}\\beta^i dx^j dt + \\gamma_{ij}dx^i dx^j\n$$\n令空间坐标为$(x^1, x^2, x^3) = (r, \\theta, \\phi)$。通过比较两个线元中微分项的系数，我们识别出度规张量$g_{\\mu\\nu}$的分量。\n\n度规的空间部分给出了空间度规$\\gamma_{ij}$：\n$g_{ij} = \\gamma_{ij}$。\n从给定的线元，我们得到一个对角化的空间度规：\n$$\n\\gamma_{rr} = g_{rr} = 1 + \\frac{2M}{r}\n$$\n$$\n\\gamma_{\\theta\\theta} = g_{\\theta\\theta} = r^2\n$$\n$$\n\\gamma_{\\phi\\phi} = g_{\\phi\\phi} = r^2 \\sin^2\\theta\n$$\n所有非对角分量$\\gamma_{ij}$均为零。\n\n混合的时间-空间分量$g_{ti}$给出了shift矢量$\\beta^i$：\n$g_{ti} = \\gamma_{ij}\\beta^j$。\n在我们的例子中，唯一非零分量是$g_{tr} = \\frac{2M}{r}$ (注意：这里使用了修正后的值)。因为$\\gamma_{ij}$是对角的，对于$i=r$的关系简化为：\n$g_{tr} = \\gamma_{rr}\\beta^r$。\n解出$\\beta^r$：\n$$\n\\beta^r = \\frac{g_{tr}}{\\gamma_{rr}} = \\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}} = \\frac{2M}{r+2M}\n$$\n由于$g_{t\\theta}=0$和$g_{t\\phi}=0$，shift矢量的其他分量为$\\beta^\\theta = 0$和$\\beta^\\phi = 0$。\n\n时间-时间分量$g_{tt}$给出了lapse函数$\\alpha$：\n$g_{tt} = -\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j$。\n仅有$\\beta^r$非零时，这变为：\n$g_{tt} = -\\alpha^2 + \\gamma_{rr}(\\beta^r)^2$。\n解出$\\alpha^2$：\n$$\n\\alpha^2 = -g_{tt} + \\gamma_{rr}(\\beta^r)^2 = -\\left[-\\left(1 - \\frac{2M}{r}\\right)\\right] + \\left(1 + \\frac{2M}{r}\\right)\\left(\\frac{2M}{r+2M}\\right)^2\n$$\n$$\n\\alpha^2 = \\left(1 - \\frac{2M}{r}\\right) + \\left(1 + \\frac{2M}{r}\\right)\\left(\\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}}\\right)^2 = \\frac{r-2M}{r} + \\frac{r+2M}{r} \\frac{4M^2}{(r+2M)^2}\n$$\n$$\n\\alpha^2 = \\frac{r-2M}{r} + \\frac{4M^2}{r(r+2M)} = \\frac{(r-2M)(r+2M)+4M^2}{r(r+2M)} = \\frac{r^2-4M^2+4M^2}{r(r+2M)} = \\frac{r}{r+2M}\n$$\n因此，lapse函数为$\\alpha = \\sqrt{\\frac{r}{r+2M}} = \\frac{1}{\\sqrt{1 + \\frac{2M}{r}}}$。\n\n现在我们在指定事件处计算这些量的值：$M=1$, $r=8$, $\\theta = \\frac{\\pi}{2}$。\n首先，计算公共项$\\frac{2M}{r} = \\frac{2(1)}{8} = \\frac{1}{4}$。\n$$\n\\alpha = \\frac{1}{\\sqrt{1 + \\frac{1}{4}}} = \\frac{1}{\\sqrt{\\frac{5}{4}}} = \\frac{2}{\\sqrt{5}} = \\frac{2\\sqrt{5}}{5}\n$$\n$$\n\\beta^r = \\frac{2M}{r+2M} = \\frac{2(1)}{8+2(1)} = \\frac{2}{10} = \\frac{1}{5}\n$$\n$$\n\\gamma_{rr} = 1 + \\frac{1}{4} = \\frac{5}{4}\n$$\n\n接下来，我们计算洛伦兹因子$W$和三维速度$v^i$。\n洛伦兹因子定义为$W = \\alpha u^t$。使用给定的值$u^t = \\frac{10}{\\sqrt{71}}$：\n$$\nW = \\alpha u^t = \\frac{2}{\\sqrt{5}} \\cdot \\frac{10}{\\sqrt{71}} = \\frac{20}{\\sqrt{355}} = \\frac{20}{\\sqrt{5}\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\n三维速度$v^i$通过分解$u^{\\mu} = W(n^{\\mu} + v^{\\mu})$定义，其中$n^\\mu = (\\frac{1}{\\alpha}, -\\frac{\\beta^i}{\\alpha})$是欧拉观察者的四维速度，$v^\\mu = (0, v^i)$在此坐标系中是纯空间矢量。\n从分解的空间分量$u^i = W(n^i + v^i) = W(-\\frac{\\beta^i}{\\alpha} + v^i)$，我们解出$v^i$：\n$$\nv^i = \\frac{u^i}{W} + \\frac{\\beta^i}{\\alpha}\n$$\n唯一非零的分量是$i=r$。我们有$u^r = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}$。\n$$\nv^r = \\frac{u^r}{W} + \\frac{\\beta^r}{\\alpha} = \\left(\\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}\\right) \\left(\\frac{\\sqrt{355}}{20}\\right) + \\frac{\\frac{1}{5}}{\\frac{2}{\\sqrt{5}}}\n$$\n$$\nv^r = \\frac{(6\\sqrt{5} - 10)\\sqrt{5}\\sqrt{71}}{5\\sqrt{71} \\cdot 20} + \\frac{\\sqrt{5}}{10} = \\frac{(6\\sqrt{5} - 10)\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{30 - 10\\sqrt{5}}{100} + \\frac{10\\sqrt{5}}{100} = \\frac{30}{100} = \\frac{3}{10}\n$$\n由于$u^\\theta=0$，$u^\\phi=0$，$\\beta^\\theta=0$和$\\beta^\\phi=0$，其他分量为$v^\\theta=0$和$v^\\phi=0$。\n\n最后，我们从第一性原理出发，然后用我们计算出的值来验证关系式$W = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}$。\n四维速度的归一化条件是$u^\\mu u_\\mu = -1$。代入分解式$u^\\mu = W(n^\\mu + v^\\mu)$：\n$$\n-1 = g_{\\mu\\nu}u^\\mu u^\\nu = W^2 g_{\\mu\\nu}(n^\\mu+v^\\mu)(n^\\nu+v^\\nu) = W^2(g_{\\mu\\nu}n^\\mu n^\\nu + 2g_{\\mu\\nu}n^\\mu v^\\nu + g_{\\mu\\nu}v^\\mu v^\\nu)\n$$\n我们知道$n^\\mu n_\\mu = g_{\\mu\\nu}n^\\mu n^\\nu = -1$。\n$g_{\\mu\\nu}n^\\mu v^\\nu = n_\\nu v^\\nu = n_t v^t + n_i v^i$项。由于我们使用的ADM坐标系中$n_i=0$，且根据定义$v^t=0$，此乘积为$n_\\nu v^\\nu = 0$。\n最后一项是$g_{\\mu\\nu}v^\\mu v^\\nu$。由于$v^t=0$，这变为$g_{ij}v^i v^j = \\gamma_{ij}v^i v^j$。\n将这些代回归一化条件：\n$$\n-1 = W^2(-1 + 0 + \\gamma_{ij}v^i v^j)\n$$\n$$\n1 = W^2(1 - \\gamma_{ij}v^i v^j) \\implies W^2 = \\frac{1}{1 - \\gamma_{ij}v^i v^j}\n$$\n对洛伦兹因子取正平方根，得到所需的表达式：\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij}v^i v^j}}\n$$\n这就从第一性原理验证了该公式。\n\n现在我们进行数值验证。我们使用$\\gamma_{rr}$和$v^r$的值计算右侧：\n$$\n\\gamma_{ij}v^i v^j = \\gamma_{rr}(v^r)^2 = \\left(\\frac{5}{4}\\right)\\left(\\frac{3}{10}\\right)^2 = \\frac{5}{4} \\cdot \\frac{9}{100} = \\frac{45}{400} = \\frac{9}{80}\n$$\n将此代入公式：\n$$\n\\frac{1}{\\sqrt{1-\\gamma_{ij}v^i v^j}} = \\frac{1}{\\sqrt{1 - \\frac{9}{80}}} = \\frac{1}{\\sqrt{\\frac{71}{80}}} = \\sqrt{\\frac{80}{71}} = \\frac{\\sqrt{16 \\cdot 5}}{\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\n这个结果与我们之前计算的$W = \\alpha u^t = \\frac{4\\sqrt{5}}{\\sqrt{71}}$相匹配。验证成功。\n\n问题要求$W$的数值，并四舍五入到四位有效数字。\n$$\nW = \\frac{4\\sqrt{5}}{\\sqrt{71}} \\approx 1.06149000...\n$$\n四舍五入到四位有效数字得到$1.061$。",
            "answer": "$$\n\\boxed{1.061}\n$$"
        },
        {
            "introduction": "流体动力学模拟的物理核心在于物态方程（EOS），它描述了物质的微观属性。本练习模拟了在开发广义相对论流体动力学（GRHD）代码时的一个常见任务：从一个给定的表格化物态方程出发，计算关键的热力学量（如相对论比焓 $h$）和决定波动传播的声速 $c_s$。更重要的是，您将通过检查系统的特征速度来验证其双曲性——这是保证演化方程适定性和数值稳定性的根本前提 。",
            "id": "3512082",
            "problem": "设计并实现一个完整的、可运行的程序。对于给定的一个列表形式的状态方程（EOS）片段，该程序需要计算相对论比焓 $h$、绝热声速 $c_s$，并通过检验沿某一选定方向的所有特征速度均为实数且严格亚光速，来验证广义相对论流体动力学（GRHD）系统的双曲性。程序必须仅使用下述定义和第一性原理，通过对给定表格进行数值计算来完成，不得依赖任何闭式解析解。\n\n假设与物理单位：\n- 在平直时空（闵可夫斯基度规）中进行计算，光速设为 $c = 1$。因此，所有速度都是无量纲的，并且必须满足 $|v| < 1$。\n- 采用单位制，使得单位静止质量的静止质量能为 $1$，从而单位体积的总能量密度为 $e = \\rho (1 + \\epsilon)$，其中 $\\rho$ 是静止质量密度，$\\epsilon$ 是比内能。\n\n使用的基本原理：\n- 单位静止质量的比焓定义为\n$$\nh \\equiv \\frac{e + p}{\\rho} \\, ,\n$$\n其中 $e = \\rho (1 + \\epsilon)$，所以\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho} \\, .\n$$\n- 绝热声速在热力学上定义为等熵导数\n$$\nc_s^2 \\equiv \\left(\\frac{\\partial p}{\\partial e}\\right)_s \\, .\n$$\n由于列表形式的EOS片段位于一条等熵线上，你必须在查询的状态点上，通过沿列表曲线使用有限差分来数值计算 $c_s^2$。沿等熵线使用链式法则可得\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho} \\, ,\n$$\n其中导数从表格中数值计算得出。在内部点使用中心差分，在端点使用单边差分。\n- 对于平直时空中沿 $x$ 方向的一维传播，特征速度是在实验室参考系中观察到的声波速度，通过相对论运动学获得：声波在流体静止参考系中以 $\\pm c_s$ 的速度移动，必须通过爱因斯坦速度加法律与流体输运速度相结合，以获得实验室参考系中的传播速度。熵/接触模随流体平流。运用这些原理，求出沿 $x$ 方向的特征速度集合，并验证它们均为实数且其绝对值严格小于光速。\n\n插值与微分要求：\n- EOS以列表形式给出一个 $(\\rho_i,\\epsilon_i,p_i)$ 片段，其中 $\\rho_i$ 单调递增。要在查询的密度 $\\rho_\\star$ 处计算 $h$，首先通过对 $\\rho$ 进行分段线性插值得到 $\\epsilon(\\rho_\\star)$ 和 $p(\\rho_\\star)$。然后根据其定义计算 $h(\\rho_\\star)$。对于声速，使用列表数据中 $p(\\rho)$ 和 $e(\\rho) = \\rho (1 + \\epsilon(\\rho))$ 的有限差分来计算 $c_s^2(\\rho_\\star)$；尽可能使用中心差分格式，否则使用单边差分格式。然后，如果 $c_s^2(\\rho_\\star) \\ge 0$，则设 $c_s(\\rho_\\star) = \\sqrt{c_s^2(\\rho_\\star)}$；否则将该情况视为非双曲的。\n\nEOS表格：\n- 列表形式的EOS片段沿单一等熵线，并以下列密度处的 $9$ 个三元组 $(\\rho_i,\\epsilon_i,p_i)$ 形式提供。在 $c=1$ 的单位制下，所有量均为无量纲。\n  - $(\\rho, \\epsilon, p) = (0.05, 0.007368062997280766, 0.00012280104995467942)$\n  - $(\\rho, \\epsilon, p) = (0.1, 0.009283177667225558, 0.00030943925557418527)$\n  - $(\\rho, \\epsilon, p) = (0.2, 0.011696070952851467, 0.0007797380635234311)$\n  - $(\\rho, \\epsilon, p) = (0.5, 0.015874010519681995, 0.0026456684199469994)$\n  - $(\\rho, \\epsilon, p) = (1.0, 0.02, 0.006666666666666667)$\n  - $(\\rho, \\epsilon, p) = (2.0, 0.025198420997897465, 0.016798947331931643)$\n  - $(\\rho, \\epsilon, p) = (5.0, 0.03419951893353394, 0.05699919822255657)$\n  - $(\\rho, \\epsilon, p) = (10.0, 0.04308869380063768, 0.143628979335459)$\n  - $(\\rho, \\epsilon, p) = (20.0, 0.05428835233189813, 0.36192234887932087)$\n\n特征速度检验：\n- 对于每个查询的状态 $(\\rho_\\star, v_x)$（其中 $|v_x| < 1$），构建沿 $x$ 方向的一维特征速度的全集，并检验所有速度均为实数且绝对值严格亚光速。当且仅当所有特征速度都满足这些条件时，判定系统在该状态是双曲的。\n\n测试套件：\n- 使用以下 $5$ 个测试用例，每个用例以 $(\\rho_\\star, v_x)$ 形式给出：\n  - Case A: $(\\rho_\\star, v_x) = (1.0, 0.3)$\n  - Case B: $(\\rho_\\star, v_x) = (0.1, 0.0)$\n  - Case C: $(\\rho_\\star, v_x) = (10.0, 0.9)$\n  - Case D: $(\\rho_\\star, v_x) = (20.0, 0.5)$\n  - Case E: $(\\rho_\\star, v_x) = (0.05, 0.2)$\n\n程序要求：\n- 对于每个测试用例，计算并返回一个列表 $[h, c_s, \\mathrm{hyper}]$，其中 $h$ 和 $c_s$ 是精确到小数点后八位的浮点数，如果所有特征速度均为实数且严格亚光速，则 $\\mathrm{hyper}$ 为整数 $1$，否则为 $0$。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素是对应一个测试用例的三元素列表，顺序为A、B、C、D、E。例如，输出必须看起来像\n$$\n[\\,[h_A,c_{s,A},\\mathrm{hyper}_A],\\,[h_B,c_{s,B},\\mathrm{hyper}_B],\\,[h_C,c_{s,C},\\mathrm{hyper}_C],\\,[h_D,c_{s,D},\\mathrm{hyper}_D],\\,[h_E,c_{s,E},\\mathrm{hyper}_E]\\,]\n$$\n其中 $h_\\cdot$ 和 $c_{s,\\cdot}$ 精确打印到小数点后八位，$\\mathrm{hyper}_\\cdot$ 为 $1$ 或 $0$。",
            "solution": "该问题要求使用给定的列表形式状态方程（EOS），为一组状态计算相对论流体动力学中的几个关键量——比焓 $h$、绝热声速 $c_s$ 以及进行双曲性检验。整个过程必须遵循第一性原理和指定的数值方法。\n\n首先，确认问题陈述的有效性。它在科学上基于狭义相对论流体动力学的既定原理。热力学量（如比焓 $h=1+\\epsilon+p/\\rho$ 和总能量密度 $e=\\rho(1+\\epsilon)$）的定义是标准的。绝热声速的热力学定义 $c_s^2 = (\\partial p / \\partial e)_s$ 及其通过链式法则 $c_s^2 = (\\mathrm{d}p/\\mathrm{d}\\rho)/(\\mathrm{d}e/\\mathrm{d}\\rho)$ 沿给定等熵线进行的数值计算是正确的。从爱因斯坦速度加法律推导特征速度也是标准的教科书程序。该问题是适定的，提供了所有必要的数据（EOS表格）和清晰明确的数值计算指令（有限差分，端点处理）。所提供的数据在物理上看起来是一致的。因此，该问题被认为是有效的，可以制定解决方案。\n\n解决方案如下：对于每个给定的测试用例（由静止质量密度 $\\rho_\\star$ 和流体速度 $v_x$ 指定），我们计算所需的量。\n\n**1. 数据表示与预计算**\n\n提供的EOS是一个包含沿单一等熵线的 $N=9$ 个离散点 $(\\rho_i, \\epsilon_i, p_i)$ 的表格。为了进行涉及总能量密度 $e$ 的数值微分，首先高效地预计算所有 $i \\in \\{1, \\dots, N\\}$ 的 $e_i = \\rho_i(1+\\epsilon_i)$ 列表是明智的。测试用例提供的查询密度 $\\rho_\\star$ 都存在于列表中的 $\\rho_i$ 值中。这简化了任务，因为不需要插值；我们可以直接确定索引 $i$ 使得 $\\rho_i = \\rho_\\star$，并使用相应的 $(\\epsilon_i, p_i)$ 值。\n\n**2. 比焓 ($h$) 的计算**\n\n单位静止质量的相对论比焓 $h$ 定义为 $h \\equiv (e+p)/\\rho$。代入 $e=\\rho(1+\\epsilon)$ 的定义，可得：\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\n对于对应于网格点 $i$ 的查询密度 $\\rho_\\star$，焓直接使用表格中的值计算：\n$$\nh(\\rho_i) = 1 + \\epsilon_i + \\frac{p_i}{\\rho_i}\n$$\n\n**3. 绝热声速 ($c_s$) 的计算**\n\n绝热声速的平方 $c_s^2$ 是从列表数据中数值计算得出的。问题指定使用沿等熵曲线通过链式法则导出的公式：\n$$\nc_s^2 = \\frac{\\mathrm{d}p/\\mathrm{d}\\rho}{\\mathrm{d}e/\\mathrm{d}\\rho}\n$$\n导数通过有限差分近似。设列表数据点的索引从 $i=0$ 到 $N-1=8$。\n\n对于内部点 ($0 < i < N-1$)，我们使用二阶中心差分格式：\n$$\n\\left(\\frac{\\mathrm{d}p}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{p_{i+1} - p_{i-1}}{\\rho_{i+1} - \\rho_{i-1}} \\quad \\text{and} \\quad \\left(\\frac{\\mathrm{d}e}{\\mathrm{d}\\rho}\\right)_i \\approx \\frac{e_{i+1} - e_{i-1}}{\\rho_{i+1} - \\rho_{i-1}}\n$$\n将这些代入 $c_s^2$ 的表达式可得：\n$$\nc_s^2(\\rho_i) \\approx \\frac{(p_{i+1} - p_{i-1})/(\\rho_{i+1} - \\rho_{i-1})}{(e_{i+1} - e_{i-1})/(\\rho_{i+1} - \\rho_{i-1})} = \\frac{p_{i+1} - p_{i-1}}{e_{i+1} - e_{i-1}}\n$$\n\n对于左端点 ($i=0$)，我们使用一阶向前差分格式：\n$$\nc_s^2(\\rho_0) \\approx \\frac{(p_1 - p_0)/(\\rho_1 - \\rho_0)}{(e_1 - e_0)/(\\rho_1 - \\rho_0)} = \\frac{p_1 - p_0}{e_1 - e_0}\n$$\n\n对于右端点 ($i=N-1$)，我们使用一阶向后差分格式：\n$$\nc_s^2(\\rho_{N-1}) \\approx \\frac{(p_{N-1} - p_{N-2})/(\\rho_{N-1} - \\rho_{N-2})}{(e_{N-1} - e_{N-2})/(\\rho_{N-1} - \\rho_{N-2})} = \\frac{p_{N-1} - p_{N-2}}{e_{N-1} - e_{N-2}}\n$$\n\n获得 $c_s^2$ 的值后，我们计算声速 $c_s$。对于一个物理上有效的系统，我们期望 $c_s^2 \\ge 0$。声速则为 $c_s = \\sqrt{c_s^2}$。如果 $c_s^2 < 0$，声速为虚数，这是不稳定的一个条件，控制方程的双曲性被破坏。\n\n**4. 双曲性验证**\n\n狭义相对论流体动力学方程组是双曲的，当且仅当其特征波速均为实数且互不相同。对于沿 $x$ 方向的一维流动，在流体的静止参考系中，存在三种特征模式：两个以速度 $\\pm c_s$ 传播的声波和一个以速度 $0$ 传播的接触/熵波。\n\n为了找到流体以速度 $v_x$ 运动的实验室参考系中的速度，我们使用爱因斯坦速度加法律。这些速度是：\n1.  接触/熵模：$\\lambda_0 = v_x$\n2.  前向传播声波模：$\\lambda_+ = \\frac{v_x + c_s}{1 + v_x c_s}$\n3.  后向传播声波模：$\\lambda_- = \\frac{v_x - c_s}{1 - v_x c_s}$\n\n为了使系统是双曲的并尊重因果性，所有特征速度 $\\lambda_k$ 必须是实数且严格亚光速，即 $|\\lambda_k| < 1$ (因为 $c=1$) 。\n- 条件 $|\\lambda_0| < 1$ 要求 $|v_x|<1$，这对所有测试用例都已给出。\n- 为使 $\\lambda_{\\pm}$ 为实数，$c_s$ 必须为实数，这意味着 $c_s^2 \\ge 0$。\n- 在给定 $|v_x|<1$ 的情况下，条件 $|\\lambda_{\\pm}| < 1$ 可以被证明等价于条件 $c_s^2 < 1$。推导过程如下：\n  $$ \\left| \\frac{v_x \\pm c_s}{1 \\pm v_x c_s} \\right| < 1 \\iff (v_x \\pm c_s)^2 < (1 \\pm v_x c_s)^2 $$\n  $$ \\iff v_x^2 \\pm 2v_x c_s + c_s^2 < 1 \\pm 2v_x c_s + v_x^2 c_s^2 $$\n  $$ \\iff v_x^2 + c_s^2 < 1 + v_x^2 c_s^2 \\iff v_x^2 - v_x^2 c_s^2 - 1 + c_s^2 < 0 $$\n  $$ \\iff (v_x^2 - 1)(1 - c_s^2) < 0 $$\n由于 $|v_x|<1$，项 $(v_x^2 - 1)$ 是负的。为使不等式成立，项 $(1-c_s^2)$ 必须是正的，这意味着 $c_s^2 < 1$。\n\n因此，在此背景下，双曲性的完整条件集简化为要求绝热声速为实数且亚光速：\n$$\n0 \\le c_s^2 < 1\n$$\n程序将评估此条件。如果满足，双曲性标志 `hyper` 设置为 $1$；否则，设置为 $0$。\n\n该实现将处理每个测试用例 $(\\rho_\\star, v_x)$，首先在EOS表格中找到对应的索引，然后依次计算 $h$、$c_s^2$、$c_s$ 和双曲性标志，最后按要求格式化结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes specific enthalpy, sound speed, and verifies hyperbolicity for GRHD\n    states based on a tabulated equation of state.\n    \"\"\"\n    \n    # EOS table provided in the problem statement.\n    # Columns: rho, epsilon, p\n    eos_data = [\n        (0.05, 0.007368062997280766, 0.00012280104995467942),\n        (0.1,  0.009283177667225558, 0.00030943925557418527),\n        (0.2,  0.011696070952851467, 0.0007797380635234311),\n        (0.5,  0.015874010519681995, 0.0026456684199469994),\n        (1.0,  0.02,                   0.006666666666666667),\n        (2.0,  0.025198420997897465, 0.016798947331931643),\n        (5.0,  0.03419951893353394,  0.05699919822255657),\n        (10.0, 0.04308869380063768,  0.143628979335459),\n        (20.0, 0.05428835233189813,  0.36192234887932087),\n    ]\n\n    rho = np.array([row[0] for row in eos_data])\n    epsilon = np.array([row[1] for row in eos_data])\n    p = np.array([row[2] for row in eos_data])\n\n    # Pre-compute total energy density e = rho * (1 + epsilon)\n    e = rho * (1 + epsilon)\n    \n    # Map rho values to their indices for quick lookup\n    rho_to_index = {val: i for i, val in enumerate(rho)}\n    \n    # Test suite provided in the problem statement.\n    test_cases = [\n        (1.0,  0.3),  # Case A\n        (0.1,  0.0),  # Case B\n        (10.0, 0.9),  # Case C\n        (20.0, 0.5),  # Case D\n        (0.05, 0.2),  # Case E\n    ]\n\n    results = []\n    for rho_star, vx in test_cases:\n        if rho_star not in rho_to_index:\n            # This case should not occur based on the problem statement\n            # but is good practice to handle.\n            raise ValueError(f\"Queried density rho_star={rho_star} not in EOS table.\")\n        \n        idx = rho_to_index[rho_star]\n        \n        # 1. Calculate specific enthalpy h = 1 + epsilon + p/rho\n        h_val = 1 + epsilon[idx] + p[idx] / rho[idx]\n        \n        # 2. Calculate sound speed squared (cs2)\n        cs2 = 0.0\n        if idx == 0:\n            # Forward difference for the first point\n            dp = p[idx+1] - p[idx]\n            de = e[idx+1] - e[idx]\n            cs2 = dp / de if de != 0 else float('inf')\n        elif idx == len(rho) - 1:\n            # Backward difference for the last point\n            dp = p[idx] - p[idx-1]\n            de = e[idx] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n        else:\n            # Centered difference for interior points\n            dp = p[idx+1] - p[idx-1]\n            de = e[idx+1] - e[idx-1]\n            cs2 = dp / de if de != 0 else float('inf')\n            \n        # 3. Calculate sound speed (cs) and check hyperbolicity\n        cs_val = 0.0\n        is_hyperbolic = 0 # Corresponds to the 'hyper' flag\n        \n        if 0 = cs2  1:\n            # Condition for hyperbolicity: 0 = cs^2  1 (since c=1)\n            is_hyperbolic = 1\n            cs_val = np.sqrt(cs2)\n        elif cs2 >= 1:\n            # Subluminal sound speed is violated\n            is_hyperbolic = 0\n            cs_val = np.sqrt(cs2)\n        else: # cs2  0\n            # Real sound speed is violated (stability issue)\n            is_hyperbolic = 0\n            cs_val = 0.0 # Cannot compute real sqrt, return 0 as per robust plan\n\n        # Format and append results\n        # h and cs are rounded to exactly 8 decimal places\n        # hyper is an integer (1 or 0)\n        h_formatted = f\"{h_val:.8f}\"\n        cs_formatted = f\"{cs_val:.8f}\"\n        \n        results.append([float(h_formatted), float(cs_formatted), is_hyperbolic])\n\n    # Format the final output string exactly as required\n    # e.g., [[1.0, 2.0, 1], [3.0, 4.0, 0]]\n    list_of_strs = [str(item) for item in results]\n    final_output = f\"[{','.join(list_of_strs)}]\"\n    \n    # Custom formatting to remove spaces for stricter compliance.\n    # This generates output like [[1.0,2.0,1],[3.0,4.0,0]]\n    sublist_strs = []\n    for res in results:\n        h_str = f\"{res[0]:.8f}\"\n        cs_str = f\"{res[1]:.8f}\"\n        hyper_str = str(res[2])\n        sublist_strs.append(f\"[{h_str},{cs_str},{hyper_str}]\")\n    final_output_no_space = f\"[{','.join(sublist_strs)}]\"\n\n    print(final_output_no_space)\n\nsolve()\n```"
        },
        {
            "introduction": "在广义相对论磁流体动力学（GRMHD）中，精确维持磁场的无散度约束（$\\nabla \\cdot \\mathbf{B} = 0$）是确保模拟物理真实性和数值稳定性的核心挑战。本练习将指导您在一个弯曲时空中（史瓦西黑洞）实现约束输运（Constrained Transport, CT）方案，这是一种通过在交错网格上将磁场表示为矢量势的旋度来从根本上保证无散度约束的强大技术。您将通过数值实验证明该方法即便在穿越事件视界时也能将磁场散度控制在机器精度，并将其与朴素的离散格式进行对比，从而量化其优越性 。",
            "id": "3512085",
            "problem": "针对内行 Kerr-Schild 球极坐标下的 Schwarzschild 黑洞，实现齐次麦克斯韦方程组在弯曲时空中的离散约束输运格式。在不依赖于时间、轴对称的设置下进行，因此只需证明空间散度约束。目标有两方面：一是数值上展示磁场的离散散度在整个计算域内，包括跨越事件视界的单元格，都消失到舍入误差的程度；二是测量一个非守恒的、朴素的散度估计值如何随分辨率变化。\n\n从广义相对論标准 $3+1$ 分解下的齐次麦克斯韦方程组开始，其中空间磁场由其逆变分量 $B^i$ 表示，空间度规的行列式为 $\\gamma$。磁场满足散度约束\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right)=0,\n$$\n其中 $\\partial_i$ 表示对空间坐标的偏导数。在约束输运中，我们将面心磁通量密度（也称为磁感应强度密度）\n$$\n\\Phi^i \\equiv \\sqrt{\\gamma}\\,B^i\n$$\n表示为边心矢量势 $A_i$ 的离散旋度，用 Levi–Civita 符号密度 $\\,\\varepsilon^{ijk}$ 表示：\n$$\n\\Phi^i = \\varepsilon^{ijk}\\,\\partial_j A_k,\n$$\n因此，通过矢量恒等式“旋度的散度为零”的离散模拟，$\\Phi^i$ 的离散散度恒等于零，直至舍入误差。\n\n在几何化单位下使用内行 Kerr-Schild 球极坐标 $(t,r,\\theta,\\phi)$ 中的 Schwarzschild 时空，其中引力常数 $G$ 和光速 $c$ 均设为1。设黑洞质量为 $M=1$，则事件视界半径为 $r_H=2M=2$。在该坐标系中，$t=\\text{constant}$ 切片上的空间度规是对角的，具有\n$$\n\\gamma_{rr} = 1 + \\frac{2M}{r},\\quad \\gamma_{\\theta\\theta} = r^2,\\quad \\gamma_{\\phi\\phi} = r^2\\sin^2\\theta,\n$$\n且行列式为\n$$\n\\gamma = \\left(1+\\frac{2M}{r}\\right) r^4 \\sin^2\\theta,\\quad \\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+\\frac{2M}{r}}.\n$$\n\n在 $r\\in[r_{\\min},r_{\\max}]$ 和 $\\theta\\in[\\theta_{\\min},\\theta_{\\max}]$ 上构建一个分别有 $N_r$ 和 $N_\\theta$ 个单元格的均匀球极坐标网格。使用\n$$\nr_{\\min}=1.6,\\quad r_{\\max}=10.0,\\quad \\theta_{\\min}=0.05,\\quad \\theta_{\\max}=\\pi-0.05,\n$$\n从而使计算域严格包含事件视界两侧的区域，同时避免两极的坐标奇点。假设轴对称并忽略 $\\phi$ 方向（等效于 $N_\\phi=1$ 且无变化）。\n\n定义矢量势的唯一非零分量为协变方位角分量 $A_\\phi$，在沿 $\\phi$ 方向的边上采样。将这些边放置在 $r$ 和 $\\theta$ 面位置的交点上，即 $(r_{i+\\frac{1}{2}},\\theta_{j+\\frac{1}{2}})$，其中 $i=0,\\dots,N_r-1$ 且 $j=0,\\dots,N_\\theta-1$。使用平滑、局域、跨越视界的场\n$$\nA_\\phi(r,\\theta) = A_0\\, r^2 \\sin^2\\theta \\,\\exp\\!\\left(-\\left(\\frac{r}{r_0}\\right)^2\\right),\n$$\n其中 $A_0=1$ 且 $r_0=4$。\n\n通过定义面心通量密度，在这些坐标中实现离散约束输运\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta},\n$$\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\,\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r},\n$$\n及 $\\Phi^\\phi=0$。此处 $\\Delta r=(r_{\\max}-r_{\\min})/N_r$ 且 $\\Delta\\theta=(\\theta_{\\max}-\\theta_{\\min})/N_\\theta$，索引 $i$ 和 $j$ 指的是 $r$ 和 $\\theta$ 方向上的单元格中心索引。这是在轴对称假设下，$\\Phi^i = \\varepsilon^{ijk}\\partial_j A_k$ 在球极坐标中的离散表示。\n\n在单元格中心 $(i,j)$ 定义通量密度的离散散度\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}.\n$$\n根据约束输运的构造，这个离散散度预计在任何地方（包括与视界相交的单元格）都将消失至舍入误差。\n\n为了比较，还要计算一个弯曲空间散度的非守恒、朴素估计，该估计模拟了一种常见的非交错离散化方法。首先使用在相应面位置处求值的 $\\sqrt{\\gamma}$ 恢复面心磁场分量 $B^r=\\Phi^r/\\sqrt{\\gamma}$ 和 $B^\\theta=\\Phi^\\theta/\\sqrt{\\gamma}$，然后将它们平均到单元格中心以获得 $B^r_{c}$ 和 $B^\\theta_{c}$。接下来，使用二阶中心有限差分对单元格中心数组上的导数以及单元格中心的 $\\sqrt{\\gamma}$，计算\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive}} \\equiv \\frac{1}{\\sqrt{\\gamma}}\\left[\\partial_r\\left(\\sqrt{\\gamma}\\,B^r\\right) + \\partial_\\theta\\left(\\sqrt{\\gamma}\\,B^\\theta\\right)\\right]\n$$\n的单元格中心近似值。将此朴素散度估计限制在内部单元格，以便可以使用中心差分模板。\n\n在相同的网格上实现这两种估计器，并为每个分辨率报告以下两种标量误差度量：\n- 所有单元格上约束输运离散散度的最大绝对值，\n$$\nE_{\\mathrm{CT}} \\equiv \\max_{i,j} \\left|\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij}\\right|.\n$$\n- 内部单元格上朴素散度的均方根，\n$$\nE_{\\mathrm{naive}} \\equiv \\sqrt{\\frac{1}{N_{\\mathrm{int}}}\\sum_{\\text{interior }(i,j)} \\left(\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive},ij}\\right)^2 },\n$$\n其中 $N_{\\mathrm{int}}$ 是中心差分模板使用的内部单元格数量。在所使用的代码单位中，这些是无量纲数。\n\n测试套件。针对以下三种分辨率运行程序：\n- 情况 A (正常情况): $N_r=48$, $N_\\theta=48$。\n- 情况 B (加密): $N_r=96$, $N_\\theta=96$。\n- 情况 C (进一步加密): $N_r=192$, $N_\\theta=192$。\n\n您的程序应生成单行输出，按顺序包含六个结果\n$$\n\\left[E_{\\mathrm{CT}}^{(A)},\\,E_{\\mathrm{naive}}^{(A)},\\,E_{\\mathrm{CT}}^{(B)},\\,E_{\\mathrm{naive}}^{(B)},\\,E_{\\mathrm{CT}}^{(C)},\\,E_{\\mathrm{naive}}^{(C)}\\right],\n$$\n以逗号分隔的列表形式打印，并用方括号括起来，每个浮点数采用六位有效数字的科学记数法。不应打印任何其他文本。所有计算均在几何化单位下进行，角度单位为弧度。预期的定性行为是，$E_{\\mathrm{CT}}$ 在所有分辨率下都处于舍入误差水平，而随着分辨率的提高，$E_{\\mathrm{naive}}$ 大致按网格间距的平方减小。",
            "solution": "该问题要求在一个 Schwarzschild 黑洞的弯曲时空中，为齐次麦克斯韦方程组实现并验证一种离散约束输运 (CT) 格式。目标是证明 CT 格式能将磁场的无散度约束保持到机器精度，并将其准确性与一种更直接、非守恒的数值方法进行比较。背景是轴对称的，因此我们考虑球极坐标 $(r, \\theta)$ 下的二维网格。\n\n控制物理原理是磁场 $\\mathbf{B}$ 的散度约束，在广义相对论的 $3+1$ 形式中，这表示为空间度规行列式 $\\gamma$ 和磁场逆变分量 $B^i$ 的形式：\n$$\n\\partial_i \\left( \\sqrt{\\gamma} B^i \\right) = 0\n$$\n此处默认为对重复指标 $i \\in \\{r, \\theta, \\phi\\}$ 求和。量 $\\Phi^i \\equiv \\sqrt{\\gamma} B^i$ 是磁通量密度。\n\n为了在数值上强制执行此约束，约束输运方法将磁通量密度表示为矢量势 $A_k$ 的旋度。在本问题中，我们给出了一个受连续关系 $\\Phi^i = \\varepsilon^{ijk} \\partial_j A_k$ 启发的离散表示，其中 $\\varepsilon^{ijk}$ 是 Levi-Civita 符号密度。关键思想是旋度的散度恒为零。一个正确模拟此属性的离散实现将把无散度条件保持在浮点舍入误差的水平。\n\n数值实现是在一个交错网格上进行的。我们在域 $(r, \\theta)$ 中定义一个 $N_r \\times N_\\theta$ 单元格的均匀网格。基本量按如下方式定位：\n-   单元格中心位于 $(r_i, \\theta_j)$，其中 $i \\in \\{0, \\dots, N_r-1\\}, j \\in \\{0, \\dots, N_\\theta-1\\}$。\n-   垂直面（$r$ 恒定）位于 $r_{i \\pm 1/2}$，水平面（$\\theta$ 恒定）位于 $\\theta_{j \\pm 1/2}$。\n-   矢量势 $A_\\phi$ 定义在单元格角点（或沿 $\\phi$ 方向的边）上，坐标为 $(r_{i+1/2}, \\theta_{j+1/2})$。\n\n给定在单元格角点采样的矢量势 $A_\\phi(r, \\theta)$，面心磁通量密度 $\\Phi^r$ 和 $\\Phi^\\theta$ 使用离散旋度运算计算。\n径向通量 $\\Phi^r$ 位于 $r$-面上（位置在 $(r_{i+1/2}, \\theta_j)$）并透过 $A_\\phi$ 在 $\\theta$ 方向的有限差分计算：\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\n极向通量 $\\Phi^\\theta$ 位于 $\\theta$-面上（位置在 $(r_i, \\theta_{j+1/2})$）并透过 $A_\\phi$ 在 $r$ 方向的有限差分计算：\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r}\n$$\n由于轴对称性，$\\Phi^\\phi = 0$。\n\n然后通过对面心通量取有限差分，在单元格中心 $(r_i, \\theta_j)$ 计算离散散度：\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\n将通量的定义代入散度表达式，可以发现各项完全抵消：\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} = \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} \\right) - \\left( A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] \\\\\n- \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} \\right) - \\left( A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] = 0\n$$\n这种代数上的抵消保证了计算出的散度将在机器精度范围内为零。此方法的误差度量是所有网格单元上该离散散度的最大绝对值，$E_{\\mathrm{CT}}$。\n\n为了进行比较，实现了一种非守恒的“朴素”方法。这种方法未能在离散层面上保持无散度特性。步骤如下：\n1.  计算面心物理磁场分量 $B^r = \\Phi^r / \\sqrt{\\gamma}$ 和 $B^\\theta = \\Phi^\\theta / \\sqrt{\\gamma}$，使用在相应面位置处求值的 $\\sqrt{\\gamma}$。度规行列式为 $\\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+2M/r}$。\n2.  将面心分量 $B^r$ 和 $B^\\theta$ 平均以获得单元格中心场，$B^r_c$ 和 $B^\\theta_c$。例如，$B^r_{c,ij} = \\frac{1}{2}(B^r_{i+1/2,j} + B^r_{i-1/2,j})$。\n3.  使用单元格中心场和单元格中心度规行列式的值重构单元格中心通量密度：$F^r_c = (\\sqrt{\\gamma} B^r)_c$ 和 $F^\\theta_c = (\\sqrt{\\gamma} B^\\theta)_c$。\n4.  在内部单元格网格上，使用二阶中心有限差分近似 $F^r_c$ 和 $F^\\theta_c$ 的导数，从而计算散度 $\\frac{1}{\\sqrt{\\gamma}}[\\partial_r(\\sqrt{\\gamma}B^r) + \\partial_\\theta(\\sqrt{\\gamma}B^\\theta)]$。\n\n这种朴素方法在每一步（平均和微分）都会引入截断误差。由于解析场的真实散度为零，数值计算出的散度将与截断误差同阶，预计为网格间距的二阶精度，即 $O(\\Delta r^2, \\Delta \\theta^2)$。误差度量 $E_{\\mathrm{naive}}$ 是此朴素散度在内部网格单元上的均方根。我们预计每次分辨率加倍时，$E_{\\mathrm{naive}}$ 会减少约 4 倍。\n\n计算针对三种网格分辨率（$48 \\times 48$，$96 \\times 96$ 和 $192 \\times 192$）在一个跨越黑洞事件视界 $r=2M=2$ 的区域上进行，这展示了 CT 方法即使在这种强引力情况下也具有鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares constrained transport and naive divergence schemes\n    for the magnetic field in Schwarzschild spacetime.\n    \"\"\"\n\n    def run_case(Nr, Nth):\n        \"\"\"\n        Runs the simulation for a single resolution (Nr, Nth).\n\n        Returns:\n            E_ct (float): Maximum absolute error for the CT method.\n            E_naive (float): RMS error for the naive method.\n        \"\"\"\n        # Physical and domain constants\n        M = 1.0\n        A0 = 1.0\n        r0 = 4.0\n        rmin, rmax = 1.6, 10.0\n        th_min, th_max = 0.05, np.pi - 0.05\n\n        # Grid setup\n        dr = (rmax - rmin) / Nr\n        dth = (th_max - th_min) / Nth\n        \n        r_faces = np.linspace(rmin, rmax, Nr + 1, dtype=np.float64)\n        th_faces = np.linspace(th_min, th_max, Nth + 1, dtype=np.float64)\n        r_centers = rmin + (np.arange(Nr, dtype=np.float64) + 0.5) * dr\n        th_centers = th_min + (np.arange(Nth, dtype=np.float64) + 0.5) * dth\n\n        # Vector potential A_phi defined at grid corners (intersections of faces)\n        R_corners, TH_corners = np.meshgrid(r_faces, th_faces, indexing='ij')\n        A_phi_corners = A0 * R_corners**2 * np.sin(TH_corners)**2 * np.exp(-(R_corners/r0)**2)\n\n        # ---- Constrained Transport (CT) Divergence Calculation ----\n\n        # Magnetic flux densities at faces from discrete curl of A_phi\n        # Phi_r is located at (r-faces, theta-centers), size (Nr+1, Nth)\n        Phi_r = (A_phi_corners[:, 1:] - A_phi_corners[:, :-1]) / dth\n        # Phi_theta is located at (r-centers, theta-faces), size (Nr, Nth+1)\n        Phi_theta = - (A_phi_corners[1:, :] - A_phi_corners[:-1, :]) / dr\n\n        # Discrete divergence at cell centers, size (Nr, Nth)\n        divB_CT = (Phi_r[1:, :] - Phi_r[:-1, :]) / dr \\\n                + (Phi_theta[:, 1:] - Phi_theta[:, :-1]) / dth\n        \n        # Maximum absolute error for the CT method\n        E_ct = np.max(np.abs(divB_CT))\n\n        # ---- Naive Divergence Calculation ----\n\n        def sqrt_gamma(r, th, mass):\n            r_safe = np.maximum(r, 1e-15) # Avoid r=0 issues, though domain prevents it.\n            return r_safe**2 * np.sin(th) * np.sqrt(1.0 + 2.0 * mass / r_safe)\n\n        # sqrt(gamma) on r-faces grid (locations of Phi_r)\n        R_rf, TH_rf = np.meshgrid(r_faces, th_centers, indexing='ij')\n        sg_rf = sqrt_gamma(R_rf, TH_rf, M)\n\n        # sqrt(gamma) on theta-faces grid (locations of Phi_theta)\n        R_thf, TH_thf = np.meshgrid(r_centers, th_faces, indexing='ij')\n        sg_thf = sqrt_gamma(R_thf, TH_thf, M)\n\n        # Physical magnetic field components B at faces\n        Br_face = Phi_r / sg_rf\n        Bth_face = Phi_theta / sg_thf\n\n        # Average B fields to cell centers\n        Br_c = 0.5 * (Br_face[1:, :] + Br_face[:-1, :])\n        Bth_c = 0.5 * (Bth_face[:, 1:] + Bth_face[:, :-1])\n        \n        # Cell-centered fluxes for naive method\n        R_c, TH_c = np.meshgrid(r_centers, th_centers, indexing='ij')\n        sg_c = sqrt_gamma(R_c, TH_c, M)\n        \n        Fr_c = sg_c * Br_c\n        Fth_c = sg_c * Bth_c\n\n        # Derivatives of fluxes at interior cell centers using 2nd order centered stencil\n        # Interior indices i in [1, Nr-2] and j in [1, Nth-2]\n        d_dr_Fr = (Fr_c[2:, 1:-1] - Fr_c[:-2, 1:-1]) / (2 * dr)\n        d_dth_Fth = (Fth_c[1:-1, 2:] - Fth_c[1:-1, :-2]) / (2 * dth)\n\n        # Naive divergence at interior cells\n        divB_naive_interior = (d_dr_Fr + d_dth_Fth) / sg_c[1:-1, 1:-1]\n        \n        # RMS error for naive method\n        N_int = (Nr - 2) * (Nth - 2)\n        E_naive = np.sqrt(np.sum(divB_naive_interior**2) / N_int)\n\n        return E_ct, E_naive\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (48, 48),    # Case A\n        (96, 96),    # Case B\n        (192, 192),  # Case C\n    ]\n\n    results = []\n    for Nr, Nth in test_cases:\n        E_ct, E_naive = run_case(Nr, Nth)\n        results.extend([E_ct, E_naive])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6e}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}