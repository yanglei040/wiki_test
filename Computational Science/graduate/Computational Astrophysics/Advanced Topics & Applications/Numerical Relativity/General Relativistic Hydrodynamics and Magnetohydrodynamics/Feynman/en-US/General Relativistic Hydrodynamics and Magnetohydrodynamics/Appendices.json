{
    "hands_on_practices": [
        {
            "introduction": "The 3+1 decomposition is the foundation of numerical relativity, providing a way to split the four-dimensional spacetime into a sequence of three-dimensional spatial slices evolving in time. This exercise connects the abstract covariant four-velocity $u^\\mu$ with the quantities measured by a local \"Eulerian\" observer—the Lorentz factor $W$ and the three-velocity $v^i$. Mastering this conversion is essential for translating the geometric language of general relativity into the concrete variables evolved in a simulation, and this practice reinforces the physical meaning of the lapse, shift, and spatial metric .",
            "id": "3512023",
            "problem": "Consider the Schwarzschild spacetime written in ingoing Kerr–Schild spherical coordinates with line element\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right).\n$$\nAdopt the $3+1$ decomposition with lapse $\\alpha$, shift $\\beta^{i}$, and spatial metric $\\gamma_{ij}$, defined by\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right),\n$$\nand let the Eulerian observer be the unit normal to the spatial hypersurfaces. At the event specified by $M=1$, $r=8$, and $\\theta = \\frac{\\pi}{2}$, suppose a fluid element has contravariant four-velocity components\n$$\nu^{t} = \\frac{10}{\\sqrt{71}}, \\quad u^{r} = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}, \\quad u^{\\theta} = 0, \\quad u^{\\phi} = 0.\n$$\nStarting from the definitions of the $3+1$ decomposition and the normalization condition $u^{\\mu} u_{\\mu} = -1$, perform the following:\n\n- Derive $\\alpha$, $\\beta^{r}$, and $\\gamma_{rr}$ at the specified event.\n- Using only these geometric quantities and the given $u^{\\mu}$, compute the Lorentz factor $W = \\alpha u^{t}$ and the three-velocity components $v^{i}$ measured by the Eulerian observer, where $v^{i}$ satisfies $u^{\\mu} = W\\left(n^{\\mu} + v^{\\mu}\\right)$ with $n^{\\mu}$ the Eulerian observer’s four-velocity and $v^{\\mu}$ purely spatial.\n- Verify from first principles that\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}.\n$$\n\nExpress the final value of the Lorentz factor $W$ as a real number rounded to four significant figures. No units are required for $W$.",
            "solution": "The problem is well-posed and scientifically grounded in the principles of general relativity and the $3+1$ formalism. All provided data and definitions are self-consistent and sufficient for a unique solution.\n\nFirst, we derive the $3+1$ quantities (lapse $\\alpha$, shift vector $\\beta^i$, and spatial metric $\\gamma_{ij}$) by comparing the given Schwarzschild metric in ingoing Kerr–Schild coordinates with the general $3+1$ line element.\n\nThe given metric is:\n$$\nds^{2} = -\\left(1 - \\frac{2M}{r}\\right) dt^{2} + \\frac{4M}{r}\\, dt\\, dr + \\left(1 + \\frac{2M}{r}\\right) dr^{2} + r^{2}\\left(d\\theta^{2} + \\sin^{2}\\theta\\, d\\phi^{2}\\right)\n$$\nThe general $3+1$ line element is:\n$$\nds^{2} = -\\alpha^{2} dt^{2} + \\gamma_{ij}\\left(dx^{i} + \\beta^{i} dt\\right)\\left(dx^{j} + \\beta^{j} dt\\right) = (-\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j)dt^2 + 2\\gamma_{ij}\\beta^i dx^j dt + \\gamma_{ij}dx^i dx^j\n$$\nLet the spatial coordinates be $(x^1, x^2, x^3) = (r, \\theta, \\phi)$. By comparing the coefficients of the differentials in both line elements, we identify the components of the metric tensor $g_{\\mu\\nu}$.\n\nThe spatial part of the metric gives the spatial metric $\\gamma_{ij}$:\n$g_{ij} = \\gamma_{ij}$.\nFrom the given line element, we have a diagonal spatial metric:\n$$\n\\gamma_{rr} = g_{rr} = 1 + \\frac{2M}{r}\n$$\n$$\n\\gamma_{\\theta\\theta} = g_{\\theta\\theta} = r^2\n$$\n$$\n\\gamma_{\\phi\\phi} = g_{\\phi\\phi} = r^2 \\sin^2\\theta\n$$\nAll off-diagonal components $\\gamma_{ij}$ are zero.\n\nThe mixed time-space components $g_{ti}$ give the shift vector $\\beta^i$:\n$g_{ti} = \\gamma_{ij}\\beta^j$.\nIn our case, the only non-zero component is $g_{tr} = \\frac{2M}{r}$. Because $\\gamma_{ij}$ is diagonal, the relation for $i=r$ simplifies to:\n$g_{tr} = \\gamma_{rr}\\beta^r$.\nSolving for $\\beta^r$:\n$$\n\\beta^r = \\frac{g_{tr}}{\\gamma_{rr}} = \\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}} = \\frac{2M}{r+2M}\n$$\nSince $g_{t\\theta}=0$ and $g_{t\\phi}=0$, the other components of the shift vector are $\\beta^\\theta = 0$ and $\\beta^\\phi = 0$.\n\nThe time-time component $g_{tt}$ gives the lapse function $\\alpha$:\n$g_{tt} = -\\alpha^2 + \\gamma_{ij}\\beta^i\\beta^j$.\nWith only $\\beta^r$ being non-zero, this becomes:\n$g_{tt} = -\\alpha^2 + \\gamma_{rr}(\\beta^r)^2$.\nSolving for $\\alpha^2$:\n$$\n\\alpha^2 = -g_{tt} + \\gamma_{rr}(\\beta^r)^2 = -\\left[-\\left(1 - \\frac{2M}{r}\\right)\\right] + \\left(1 + \\frac{2M}{r}\\right)\\left(\\frac{\\frac{2M}{r}}{1 + \\frac{2M}{r}}\\right)^2\n$$\n$$\n\\alpha^2 = \\left(1 - \\frac{2M}{r}\\right) + \\frac{\\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{\\left(1 - \\frac{2M}{r}\\right)\\left(1 + \\frac{2M}{r}\\right) + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1 - \\left(\\frac{2M}{r}\\right)^2 + \\left(\\frac{2M}{r}\\right)^2}{1 + \\frac{2M}{r}} = \\frac{1}{1 + \\frac{2M}{r}}\n$$\nThus, the lapse function is $\\alpha = \\frac{1}{\\sqrt{1 + \\frac{2M}{r}}}$.\n\nNow we evaluate these quantities at the specified event: $M=1$, $r=8$, $\\theta = \\frac{\\pi}{2}$.\nFirst, calculate the common term $\\frac{2M}{r} = \\frac{2(1)}{8} = \\frac{1}{4}$.\n$$\n\\alpha = \\frac{1}{\\sqrt{1 + \\frac{1}{4}}} = \\frac{1}{\\sqrt{\\frac{5}{4}}} = \\frac{2}{\\sqrt{5}} = \\frac{2\\sqrt{5}}{5}\n$$\n$$\n\\beta^r = \\frac{\\frac{1}{4}}{1 + \\frac{1}{4}} = \\frac{\\frac{1}{4}}{\\frac{5}{4}} = \\frac{1}{5}\n$$\n$$\n\\gamma_{rr} = 1 + \\frac{1}{4} = \\frac{5}{4}\n$$\n\nNext, we compute the Lorentz factor $W$ and the three-velocity $v^i$.\nThe Lorentz factor is defined as $W = \\alpha u^t$. Using the given value $u^t = \\frac{10}{\\sqrt{71}}$:\n$$\nW = \\alpha u^t = \\frac{2}{\\sqrt{5}} \\cdot \\frac{10}{\\sqrt{71}} = \\frac{20}{\\sqrt{355}} = \\frac{20}{\\sqrt{5}\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\nThe three-velocity $v^i$ is defined through the decomposition $u^{\\mu} = W(n^{\\mu} + v^{\\mu})$, where $n^\\mu = (\\frac{1}{\\alpha}, -\\frac{\\beta^i}{\\alpha})$ is the four-velocity of the Eulerian observer and $v^\\mu = (0, v^i)$ is a purely spatial vector in this coordinate system.\nFrom the spatial components of the decomposition, $u^i = W(n^i + v^i) = W(-\\frac{\\beta^i}{\\alpha} + v^i)$, we solve for $v^i$:\n$$\nv^i = \\frac{u^i}{W} + \\frac{\\beta^i}{\\alpha}\n$$\nThe only non-zero component is for $i=r$. We have $u^r = \\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}$.\n$$\nv^r = \\frac{u^r}{W} + \\frac{\\beta^r}{\\alpha} = \\left(\\frac{6\\sqrt{5} - 10}{5\\sqrt{71}}\\right) \\left(\\frac{\\sqrt{5}\\sqrt{71}}{20}\\right) + \\frac{\\frac{1}{5}}{\\frac{2}{\\sqrt{5}}}\n$$\n$$\nv^r = \\frac{(6\\sqrt{5} - 10)\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{6(5) - 10\\sqrt{5}}{100} + \\frac{\\sqrt{5}}{10} = \\frac{30 - 10\\sqrt{5}}{100} + \\frac{10\\sqrt{5}}{100} = \\frac{30}{100} = \\frac{3}{10}\n$$\nSince $u^\\theta=0$, $u^\\phi=0$, $\\beta^\\theta=0$, and $\\beta^\\phi=0$, the other components are $v^\\theta=0$ and $v^\\phi=0$.\n\nFinally, we verify the relation $W = \\frac{1}{\\sqrt{1 - \\gamma_{ij} v^{i} v^{j}}}$ from first principles and then with our calculated values.\nThe normalization of the four-velocity is $u^\\mu u_\\mu = -1$. Substituting the decomposition $u^\\mu = W(n^\\mu + v^\\mu)$:\n$$\n-1 = g_{\\mu\\nu}u^\\mu u^\\nu = W^2 g_{\\mu\\nu}(n^\\mu+v^\\mu)(n^\\nu+v^\\nu) = W^2(g_{\\mu\\nu}n^\\mu n^\\nu + 2g_{\\mu\\nu}n^\\mu v^\\nu + g_{\\mu\\nu}v^\\mu v^\\nu)\n$$\nWe know that $n^\\mu n_\\mu = g_{\\mu\\nu}n^\\mu n^\\nu = -1$.\nThe term $g_{\\mu\\nu}n^\\mu v^\\nu = n_\\nu v^\\nu = n_t v^t + n_i v^i$. Since we use the ADM chart where $n_i=0$ and the definition where $v^t=0$, this product is $n_\\nu v^\\nu = 0$.\nThe final term is $g_{\\mu\\nu}v^\\mu v^\\nu$. Since $v^t=0$, this becomes $g_{ij}v^i v^j = \\gamma_{ij}v^i v^j$.\nSubstituting these back into the normalization condition:\n$$\n-1 = W^2(-1 + 0 + \\gamma_{ij}v^i v^j)\n$$\n$$\n1 = W^2(1 - \\gamma_{ij}v^i v^j) \\implies W^2 = \\frac{1}{1 - \\gamma_{ij}v^i v^j}\n$$\nTaking the positive square root for the Lorentz factor gives the desired expression:\n$$\nW = \\frac{1}{\\sqrt{1 - \\gamma_{ij}v^i v^j}}\n$$\nThis verifies the formula from first principles.\n\nNow we perform the numerical verification. We calculate the right-hand side using our values for $\\gamma_{rr}$ and $v^r$:\n$$\n\\gamma_{ij}v^i v^j = \\gamma_{rr}(v^r)^2 = \\left(\\frac{5}{4}\\right)\\left(\\frac{3}{10}\\right)^2 = \\frac{5}{4} \\cdot \\frac{9}{100} = \\frac{45}{400} = \\frac{9}{80}\n$$\nPlugging this into the formula:\n$$\n\\frac{1}{\\sqrt{1-\\gamma_{ij}v^i v^j}} = \\frac{1}{\\sqrt{1 - \\frac{9}{80}}} = \\frac{1}{\\sqrt{\\frac{71}{80}}} = \\sqrt{\\frac{80}{71}} = \\frac{\\sqrt{16 \\cdot 5}}{\\sqrt{71}} = \\frac{4\\sqrt{5}}{\\sqrt{71}}\n$$\nThis result matches our earlier calculation of $W = \\alpha u^t = \\frac{4\\sqrt{5}}{\\sqrt{71}}$. The verification is successful.\n\nThe problem asks for the numerical value of $W$ rounded to four significant figures.\n$$\nW = \\frac{4\\sqrt{5}}{\\sqrt{71}} \\approx 1.06149000...\n$$\nRounding to four significant figures gives $1.061$.",
            "answer": "$$\n\\boxed{1.061}\n$$"
        },
        {
            "introduction": "The evolution of a relativistic fluid is governed by a system of hyperbolic conservation laws, which are typically solved with finite-volume methods. At the heart of these methods is the Riemann solver, an algorithm that determines the flow of mass, momentum, and energy across cell interfaces by approximating the local wave structure. This exercise provides hands-on experience comparing the simple but diffusive Harten-Lax-van Leer-Einfeldt (HLLE) solver with a more sophisticated HLLC-type scheme designed to better resolve contact discontinuities, demonstrating a key trade-off between robustness and accuracy in numerical code design .",
            "id": "3512052",
            "problem": "Consider a one-dimensional, general relativistic hydrodynamics shock-tube problem posed along a single spatial coordinate $x$ within a static spacetime with zero shift vector and diagonal spatial metric. Use the Valencia formulation for ideal fluid dynamics in curved spacetime, with densitized conserved variables and fluxes. The goal is to construct numerical intercell fluxes for left and right states and compare the Harten–Lax–van Leer with Contact (HLLC)-type extension against the Harten–Lax–van Leer–Einfeldt (HLLE) flux on contact discontinuities. You must implement both fluxes and quantify the contact-resolution improvement of the HLLC-type extension over HLLE via a single explicit time update of two finite-volume cells.\n\nFundamental base: Start from local conservation of mass and energy-momentum, $\\nabla_{\\mu}(\\rho u^{\\mu}) = 0$ and $\\nabla_{\\mu}T^{\\mu\\nu} = 0$, with $T^{\\mu\\nu} = \\rho h u^{\\mu} u^{\\nu} + p g^{\\mu\\nu}$ and the gamma-law equation of state $p = (\\Gamma - 1)\\rho \\epsilon$, where $\\rho$ is the rest-mass density, $p$ is the pressure, $h = 1 + \\epsilon + p/\\rho$ is the specific enthalpy, $\\epsilon$ is the specific internal energy, $u^{\\mu}$ is the fluid four-velocity, and $g^{\\mu\\nu}$ is the spacetime metric. Adopt the Valencia variables in an Eulerian orthonormal frame aligned with the coordinate $x$ and with zero shift vector ($\\beta^i = 0$), defining the conserved variables and fluxes in the orthonormal frame by\n$$\nD = \\rho W, \\quad S_x = \\rho h W^2 v, \\quad \\tau = \\rho h W^2 - p - D,\n$$\n$$\nF^x(D) = D v,\\quad F^x(S_x) = S_x v + p,\\quad F^x(\\tau) = \\tau v + p v,\n$$\nwhere $W = 1/\\sqrt{1 - v^2}$ is the Lorentz factor and $v$ is the fluid three-velocity component measured by the Eulerian observer along the orthonormal $\\hat{x}$ direction. For the gamma-law equation of state, use the relativistic sound speed\n$$\nc_s^2 = \\frac{\\Gamma p}{\\rho h}.\n$$\nAssume the spacetime is static and diagonal, with lapse $\\alpha$ and spatial metric component $\\gamma_{xx}$ along the coordinate $x$, and zero shift $\\beta^x = 0$. Let the orthonormal velocity component be $v_{\\hat{x}}$ and the coordinate speed of signals be given by\n$$\n\\lambda_{\\pm} = \\frac{\\alpha}{\\sqrt{\\gamma_{xx}}}\\,\\frac{v_{\\hat{x}} \\pm c_s}{1 \\pm v_{\\hat{x}} c_s}.\n$$\nDefine the HLL signal speeds as $s_L = \\min(\\lambda_{-,L}, \\lambda_{-,R})$ and $s_R = \\max(\\lambda_{+,L}, \\lambda_{+,R})$, where the subscripts L and R denote evaluation in the left and right states. In the Valencia formulation, densitized fluxes are obtained by multiplying orthonormal-frame fluxes by $\\sqrt{\\det \\gamma_{ij}}$. For this one-dimensional reduction with unit tangential geometry, take $\\sqrt{\\det \\gamma_{ij}}$ as $\\sqrt{\\gamma_{xx}}$.\n\nConstruct the HLLE flux in the orthonormal frame using the two-wave estimate\n$$\nF_{\\mathrm{HLLE}} = \\frac{s_R F_L - s_L F_R + s_R s_L (U_R - U_L)}{s_R - s_L},\n$$\nwhere $U_{L,R}$ and $F_{L,R}$ are the left and right conserved-state vectors and fluxes respectively in the orthonormal frame. Then densitize by multiplying $F_{\\mathrm{HLLE}}$ by $\\sqrt{\\gamma_{xx}}$.\n\nConstruct an HLLC-type extension as follows. When a contact discontinuity is detected by the conditions $|p_L - p_R| \\le \\delta_p$ and $|v_{\\hat{x},L} - v_{\\hat{x},R}| \\le \\delta_v$, set the contact wave speed to the common velocity $S_M = v_{\\hat{x},L} = v_{\\hat{x},R}$ and compute star-region states via Rankine–Hugoniot relations in the orthonormal frame:\n$$\nD^*_k = D_k \\frac{s_k - v_{\\hat{x},k}}{s_k - S_M},\\quad S_x^*_k = S_{x,k} \\frac{s_k - v_{\\hat{x},k}}{s_k - S_M},\\quad \\tau^*_k = \\tau_k \\frac{s_k - v_{\\hat{x},k}}{s_k - S_M} + p_k S_M - p_k v_{\\hat{x},k},\n$$\nwhere $k \\in \\{L, R\\}$ refers to the left or right state.\nForm the corresponding star-region fluxes by\n$$\nF^*_k = F_k + s_k (U^*_k - U_k).\n$$\nThen select the intercell flux in the orthonormal frame by wave-speed ordering,\n$$\nF_{\\mathrm{HLLC}} =\n\\begin{cases}\nF_L, s_L \\ge 0,\\\\\nF^*_L, s_L \\le 0 \\le S_M,\\\\\nF^*_R, S_M \\le 0 \\le s_R,\\\\\nF_R, s_R \\le 0,\n\\end{cases}\n$$\nand densitize by multiplying $F_{\\mathrm{HLLC}}$ by $\\sqrt{\\gamma_{xx}}$. In general states when the above contact conditions are not met, set $F_{\\mathrm{HLLC}}$ equal to $F_{\\mathrm{HLLE}}$. This HLLC-type extension restores the missing middle contact wave in the specific but important case of equal pressure and velocity, improving contact resolution relative to HLLE.\n\nTo demonstrate improved contact resolution numerically, perform a single explicit finite-volume update for two adjacent cells (left and right) using both fluxes. Let the densitized conserved variables for the left and right cells be $\\tilde{U}_L = \\sqrt{\\gamma_{xx}} U_L$ and $\\tilde{U}_R = \\sqrt{\\gamma_{xx}} U_R$. Use outflow boundary conditions at the external faces, with boundary-face densitized fluxes equal to the physical state fluxes, i.e., $\\tilde{F}_{\\mathrm{left\\,face}} = \\sqrt{\\gamma_{xx}} F_L$ and $\\tilde{F}_{\\mathrm{right\\,face}} = \\sqrt{\\gamma_{xx}} F_R$. The semi-discrete update over a time step $\\Delta t$ for the left and right cell is\n$$\n\\tilde{U}_L^{n+1} = \\tilde{U}_L^n - \\frac{\\Delta t}{\\Delta x}\\left(\\tilde{F}_{\\mathrm{interface}} - \\tilde{F}_{\\mathrm{left\\,face}}\\right),\\quad\n\\tilde{U}_R^{n+1} = \\tilde{U}_R^n - \\frac{\\Delta t}{\\Delta x}\\left(\\tilde{F}_{\\mathrm{right\\,face}} - \\tilde{F}_{\\mathrm{interface}}\\right).\n$$\nCompute $\\Delta t$ using a Courant–Friedrichs–Lewy condition with signal speeds,\n$$\n\\Delta t = \\mathrm{CFL}\\,\\frac{\\Delta x}{\\max\\left(|s_L|,|s_R|,\\epsilon\\right)},\n$$\nwith a small regularization $\\epsilon>0$ to avoid division by zero. Quantify contact smearing by the change in the rest-mass conserved density component $D$, comparing before and after the update:\n$$\ne = \\left|D_L^{n+1} - D_L^n\\right| + \\left|D_R^{n+1} - D_R^n\\right|,\n$$\nwhere $D^{n}$ is obtained from $\\tilde{U}^{n}$ by dividing by $\\sqrt{\\gamma_{xx}}$. Compute this error for HLLE and for the HLLC-type extension and report the improvement $\\Delta e = e_{\\mathrm{HLLE}} - e_{\\mathrm{HLLC}}$; positive $\\Delta e$ indicates improved contact resolution.\n\nUse geometric units where the speed of light $c$ equals $1$ and all quantities are dimensionless. Angles are not used. Your program must be self-contained and produce the numerical improvements for the following test suite, each given as tuples specifying $(\\Gamma,\\Delta x,\\mathrm{CFL},\\alpha,\\gamma_{xx},\\rho_L,p_L,v_{\\hat{x},L},\\rho_R,p_R,v_{\\hat{x},R})$:\n\n- Case $1$ (flat Minkowski, pure contact): $(\\Gamma=5/3,\\ \\Delta x=1,\\ \\mathrm{CFL}=0.4,\\ \\alpha=1,\\ \\gamma_{xx}=1,\\ \\rho_L=1,\\ p_L=1,\\ v_{\\hat{x},L}=0,\\ \\rho_R=0.125,\\ p_R=1,\\ v_{\\hat{x},R}=0)$.\n- Case $2$ (Schwarzschild-like radial slice at $r=6M$ with $M=1$, pure contact): $(\\Gamma=5/3,\\ \\Delta x=1,\\ \\mathrm{CFL}=0.4,\\ \\alpha=\\sqrt{1-2/6},\\ \\gamma_{xx}=(1-2/6)^{-1},\\ \\rho_L=1,\\ p_L=1,\\ v_{\\hat{x},L}=0,\\ \\rho_R=0.125,\\ p_R=1,\\ v_{\\hat{x},R}=0)$.\n- Case $3$ (flat Minkowski, strong shock states): $(\\Gamma=5/3,\\ \\Delta x=1,\\ \\mathrm{CFL}=0.4,\\ \\alpha=1,\\ \\gamma_{xx}=1,\\ \\rho_L=1,\\ p_L=1000,\\ v_{\\hat{x},L}=0,\\ \\rho_R=1,\\ p_R=0.01,\\ v_{\\hat{x},R}=0)$.\n- Case $4$ (flat Minkowski, near-vacuum contact): $(\\Gamma=5/3,\\ \\Delta x=1,\\ \\mathrm{CFL}=0.4,\\ \\alpha=1,\\ \\gamma_{xx}=1,\\ \\rho_L=10^{-6},\\ p_L=10^{-6},\\ v_{\\hat{x},L}=0,\\ \\rho_R=10^{-8},\\ p_R=10^{-8},\\ v_{\\hat{x},R}=0)$.\n\nYour program should produce a single line of output containing the improvements $\\Delta e$ for the four cases as a comma-separated list enclosed in square brackets, for example, $[x_1,x_2,x_3,x_4]$. Each $x_i$ must be a floating-point number. No external input is permitted; the program must run as-is and compute the specified outputs.",
            "solution": "The problem requires a critical comparison of the Harten–Lax–van Leer–Einfeldt (HLLE) and a Harten–Lax–van Leer with Contact (HLLC)-type numerical flux schemes within the framework of one-dimensional general relativistic hydrodynamics (GRHD). The goal is to quantify the improvement in resolving a contact discontinuity offered by the HLLC-type extension over the more diffusive HLLE scheme. This is accomplished by performing a single finite-volume time update on two adjacent cells initialized with states representing a contact discontinuity and measuring the numerical dissipation, or \"smearing,\" of the density profile.\n\nThe theoretical foundation is the Valencia formulation of the GRHD equations, which casts the conservation laws for rest-mass density and stress-energy into a system of hyperbolic conservation laws of the form $\\partial_t \\tilde{U} + \\partial_x \\tilde{F}^x(U) = S$. Here, $\\tilde{U}$ represents the vector of densitized conserved variables, $\\tilde{F}^x$ is the densitized flux vector, and $S$ contains source terms due to spacetime curvature and non-Cartesian coordinates (which are zero for the setup considered).\n\nThe process for solving the problem is as follows:\n\nFirst, we define the fluid states and spacetime geometry from the given parameters for each test case. A fluid state is defined by its primitive variables: rest-mass density $\\rho$, pressure $p$, and the velocity component $v_{\\hat{x}}$ in an orthonormal frame. The spacetime is static, with a lapse $\\alpha$ and a single spatial metric component $\\gamma_{xx}$. The speed of light is set to $c=1$.\n\nFrom the primitive variables, we derive several thermodynamic and kinematic quantities:\n- The Lorentz factor: $W = (1 - v_{\\hat{x}}^2)^{-1/2}$.\n- The specific internal energy $\\epsilon$, from the gamma-law equation of state: $p = (\\Gamma-1)\\rho\\epsilon \\implies \\epsilon = p / ((\\Gamma-1)\\rho)$.\n- The specific enthalpy $h = 1 + \\epsilon + p/\\rho$.\n\nNext, we compute the conserved variables in the orthonormal frame as defined in the problem:\n- Densitized mass density: $D = \\rho W$.\n- Momentum density: $S_x = \\rho h W^2 v_{\\hat{x}}$.\n- Total energy density minus rest mass density: $\\tau = \\rho h W^2 - p - D$.\nThe vector of conserved variables is $U = [D, S_x, \\tau]^T$.\n\nThe corresponding flux vector $F^x(U)$ in the same orthonormal frame is given by:\n$$\nF^x(U) = \\begin{bmatrix} D v_{\\hat{x}} \\\\ S_x v_{\\hat{x}} + p \\\\ \\tau v_{\\hat{x}} + p v_{\\hat{x}} \\end{bmatrix}\n$$\n\nTo construct the Riemann solvers (HLLE, HLLC), we need the characteristic wave speeds. The maximum and minimum physical signal speeds (eigenvalues of the flux Jacobian) for a given state are:\n$$\n\\lambda_{\\pm} = \\frac{\\alpha}{\\sqrt{\\gamma_{xx}}}\\,\\frac{v_{\\hat{x}} \\pm c_s}{1 \\pm v_{\\hat{x}} c_s}\n$$\nwhere $c_s$ is the relativistic sound speed, given by $c_s^2 = \\frac{\\Gamma p}{\\rho h}$.\nFor the Riemann problem at the interface between a left state ($L$) and a right state ($R$), the HLLE solver estimates the fastest left-going and right-going wave speeds, $s_L$ and $s_R$, by taking the minimum and maximum of the characteristic speeds from both states:\n$$\ns_L = \\min(\\lambda_{-,L}, \\lambda_{-,R}), \\quad s_R = \\max(\\lambda_{+,L}, \\lambda_{+,R})\n$$\n\nWith the wave speed estimates, the HLLE intercell flux in the orthonormal frame is:\n$$\nF_{\\mathrm{HLLE}} = \\frac{s_R F_L - s_L F_R + s_R s_L (U_R - U_L)}{s_R - s_L}\n$$\n\nThe HLLC-type flux is an extension of HLLE. For general fluid states where the contact detection condition is not met, we set $F_{\\mathrm{HLLC}} = F_{\\mathrm{HLLE}}$. The contact condition is $|p_L - p_R| \\le \\delta_p$ and $|v_{\\hat{x},L} - v_{\\hat{x},R}| \\le \\delta_v$ for small tolerances $\\delta_p, \\delta_v$. For the test cases presented, this is an exact equality ($p_L=p_R, v_L=v_R=0$).\n\nIf a contact is detected, we introduce a middle wave associated with the contact discontinuity, traveling at speed $S_M = v_{\\hat{x},L} (= v_{\\hat{x},R})$. This splits the Riemann fan into three regions, with \"star\" states $U^*_L$ and $U^*_R$ between the outer waves ($s_L, s_R$) and the contact wave ($S_M$). The problem provides specific formulas for these star states, derived from the Rankine-Hugoniot jump conditions:\n$$\nU^*_L = \\begin{bmatrix} D_L \\frac{s_L - v_{\\hat{x},L}}{s_L - S_M} \\\\ S_{x,L} \\frac{s_L - v_{\\hat{x},L}}{s_L - S_M} \\\\ \\tau_L \\frac{s_L - v_{\\hat{x},L}}{s_L - S_M} + p_L S_M - p_L v_{\\hat{x},L} \\end{bmatrix},\\quad\nU^*_R = \\begin{bmatrix} D_R \\frac{s_R - v_{\\hat{x},R}}{s_R - S_M} \\\\ S_{x,R} \\frac{s_R - v_{\\hat{x},R}}{s_R - S_M} \\\\ \\tau_R \\frac{s_R - v_{\\hat{x},R}}{s_R - S_M} + p_R S_M - p_R v_{\\hat{x},R} \\end{bmatrix}\n$$\nThe corresponding fluxes in the star regions are given by $F^*_k = F_k + s_k (U^*_k - U_k)$ for $k=L,R$. The HLLC intercell flux is then selected based on the location of the interface ($x=0$) relative to the wave pattern:\n$$\nF_{\\mathrm{HLLC}} =\n\\begin{cases}\nF_L, s_L \\ge 0 \\\\\nF^*_L, s_L \\le 0 \\le S_M \\\\\nF^*_R, S_M \\le 0 \\le s_R \\\\\nF_R, s_R \\le 0\n\\end{cases}\n$$\nFor the test cases involving a contact, $S_M=0$, so the condition $s_L \\le 0 \\le S_M$ is met, and the flux is $F^*_L$.\n\nWe perform a single finite-volume update for two cells of width $\\Delta x$. The densitized conserved variables $\\tilde{U} = \\sqrt{\\gamma_{xx}} U$ are updated as:\n$$\n\\tilde{U}_L^{n+1} = \\tilde{U}_L^n - \\frac{\\Delta t}{\\Delta x}\\left(\\tilde{F}_{\\mathrm{interface}} - \\tilde{F}_{\\mathrm{left\\,face}}\\right) \\\\\n\\tilde{U}_R^{n+1} = \\tilde{U}_R^n - \\frac{\\Delta t}{\\Delta x}\\left(\\tilde{F}_{\\mathrm{right\\,face}} - \\tilde{F}_{\\mathrm{interface}}\\right)\n$$\nwhere $\\tilde{F}_{\\mathrm{interface}} = \\sqrt{\\gamma_{xx}} F_{\\mathrm{solver}}$ is the densitized interface flux from either HLLE or HLLC. The boundary fluxes are set to outflow conditions: $\\tilde{F}_{\\mathrm{left\\,face}} = \\sqrt{\\gamma_{xx}} F_L$ and $\\tilde{F}_{\\mathrm{right\\,face}} = \\sqrt{\\gamma_{xx}} F_R$. The time step $\\Delta t$ is determined by the CFL condition:\n$$\n\\Delta t = \\mathrm{CFL}\\,\\frac{\\Delta x}{\\max(|s_L|,|s_R|,\\epsilon)}\n$$\nFinally, to quantify the numerical smearing of the contact, we compute an error metric based on the change in the conserved density $D$. After updating to $\\tilde{U}^{n+1}$, we find $D^{n+1} = (\\tilde{U}^{n+1})_0 / \\sqrt{\\gamma_{xx}}$. The error for each scheme is:\n$$\ne = \\left|D_L^{n+1} - D_L^n\\right| + \\left|D_R^{n+1} - D_R^n\\right|\n$$\nThe improvement of HLLC over HLLE is then $\\Delta e = e_{\\mathrm{HLLE}} - e_{\\mathrm{HLLC}}$. A positive value indicates that HLLC better preserves the contact discontinuity. For the strong shock case (Case 3), the HLLC extension is not triggered, thus $F_{\\mathrm{HLLC}} = F_{\\mathrm{HLLE}}$ and the improvement $\\Delta e$ is expected to be zero.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the GRHD shock-tube problem for the given test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1: (Gamma, dx, CFL, alpha, gxx, rho_L, p_L, v_L, rho_R, p_R, v_R)\n        (5.0/3.0, 1.0, 0.4, 1.0, 1.0, 1.0, 1.0, 0.0, 0.125, 1.0, 0.0),\n        # Case 2\n        (5.0/3.0, 1.0, 0.4, np.sqrt(1.0 - 2.0/6.0), 1.0/(1.0 - 2.0/6.0), 1.0, 1.0, 0.0, 0.125, 1.0, 0.0),\n        # Case 3\n        (5.0/3.0, 1.0, 0.4, 1.0, 1.0, 1.0, 1000.0, 0.0, 1.0, 0.01, 0.0),\n        # Case 4\n        (5.0/3.0, 1.0, 0.4, 1.0, 1.0, 1e-6, 1e-6, 0.0, 1e-8, 1e-8, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        improvement = calculate_improvement(case)\n        results.append(improvement)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\ndef calculate_improvement(params):\n    \"\"\"\n    Calculates the contact resolution improvement Δe for a single test case.\n    \"\"\"\n    Gamma, dx, CFL, alpha, gxx = params[0:5]\n    rho_L, p_L, v_L = params[5:8]\n    rho_R, p_R, v_R = params[8:11]\n    \n    sqrt_g = np.sqrt(gxx)\n    \n    # Tiny number to prevent division by zero\n    epsilon_reg = 1e-12\n\n    # --- State Computation ---\n    def get_state_vars(rho, p, v, Gamma_):\n        if rho = 0 or p = 0: # Handle vacuum or near vacuum\n            return 1.0, 0.0, 1.0, 0.0\n        W = 1.0 / np.sqrt(1.0 - v**2)\n        eps = p / ((Gamma_ - 1.0) * rho)\n        h = 1.0 + eps + p / rho\n        cs2 = Gamma_ * p / (rho * h)\n        cs = np.sqrt(cs2)\n        return W, eps, h, cs\n\n    W_L, _, h_L, cs_L = get_state_vars(rho_L, p_L, v_L, Gamma)\n    W_R, _, h_R, cs_R = get_state_vars(rho_R, p_R, v_R, Gamma)\n\n    # Conserved variables (U)\n    U_L = np.array([rho_L * W_L, \n                    rho_L * h_L * W_L**2 * v_L, \n                    rho_L * h_L * W_L**2 - p_L - rho_L * W_L])\n    U_R = np.array([rho_R * W_R, \n                    rho_R * h_R * W_R**2 * v_R, \n                    rho_R * h_R * W_R**2 - p_R - rho_R * W_R])\n\n    # Flux vectors (F)\n    F_L = np.array([U_L[0] * v_L, \n                    U_L[1] * v_L + p_L, \n                    U_L[2] * v_L + p_L * v_L])\n    F_R = np.array([U_R[0] * v_R, \n                    U_R[1] * v_R + p_R, \n                    U_R[2] * v_R + p_R * v_R])\n\n    # --- Wave Speed Calculation ---\n    lambda_minus_L = (alpha / sqrt_g) * (v_L - cs_L) / (1.0 - v_L * cs_L + epsilon_reg)\n    lambda_plus_L  = (alpha / sqrt_g) * (v_L + cs_L) / (1.0 + v_L * cs_L + epsilon_reg)\n    lambda_minus_R = (alpha / sqrt_g) * (v_R - cs_R) / (1.0 - v_R * cs_R + epsilon_reg)\n    lambda_plus_R  = (alpha / sqrt_g) * (v_R + cs_R) / (1.0 + v_R * cs_R + epsilon_reg)\n    \n    s_L = min(lambda_minus_L, lambda_minus_R)\n    s_R = max(lambda_plus_L, lambda_plus_R)\n\n    # --- Time Step ---\n    dt = CFL * dx / (max(abs(s_L), abs(s_R)) + epsilon_reg)\n\n    # --- HLLE Flux ---\n    if abs(s_R - s_L)  epsilon_reg: # If states are identical\n        F_HLLE = F_L \n    else:\n        F_HLLE = (s_R * F_L - s_L * F_R + s_R * s_L * (U_R - U_L)) / (s_R - s_L)\n\n    # --- HLLC-type Flux ---\n    contact_p_tol = 1e-9\n    contact_v_tol = 1e-9\n    is_contact = abs(p_L - p_R)  contact_p_tol and abs(v_L - v_R)  contact_v_tol\n\n    if is_contact:\n        S_M = v_L  # Common velocity\n        \n        # Left star state U*_L and flux F*_L\n        if abs(s_L - S_M)  epsilon_reg:\n            U_star_L = U_L\n        else:\n            D_star_L = U_L[0] * (s_L - v_L) / (s_L - S_M)\n            Sx_star_L = U_L[1] * (s_L - v_L) / (s_L - S_M) # + p_L - p_L\n            tau_star_L = U_L[2] * (s_L - v_L) / (s_L - S_M) + p_L*S_M - p_L*v_L\n            U_star_L = np.array([D_star_L, Sx_star_L, tau_star_L])\n\n        F_star_L = F_L + s_L * (U_star_L - U_L)\n\n        # Right star state U*_R and flux F*_R\n        if abs(s_R - S_M)  epsilon_reg:\n            U_star_R = U_R\n        else:\n            D_star_R = U_R[0] * (s_R - v_R) / (s_R - S_M)\n            Sx_star_R = U_R[1] * (s_R - v_R) / (s_R - S_M)\n            tau_star_R = U_R[2] * (s_R - v_R) / (s_R - S_M) + p_R*S_M - p_R*v_R\n            U_star_R = np.array([D_star_R, Sx_star_R, tau_star_R])\n\n        F_star_R = F_R + s_R * (U_star_R - U_R)\n\n        # Select HLLC flux based on wave speeds\n        if s_L = 0:\n            F_HLLC = F_L\n        elif s_L = 0 and S_M = 0:\n            F_HLLC = F_star_L\n        elif S_M = 0 and s_R = 0:\n            F_HLLC = F_star_R\n        else: # s_R = 0\n            F_HLLC = F_R\n    else:\n        F_HLLC = F_HLLE\n\n    # --- Finite Volume Update and Error Calculation ---\n    def compute_error(F_interface, U_L_n, U_R_n, F_L_n, F_R_n, dt_, dx_, sqrt_g_):\n        # Densitized variables\n        tilde_U_L_n = U_L_n * sqrt_g_\n        tilde_U_R_n = U_R_n * sqrt_g_\n        \n        # Densitized fluxes\n        tilde_F_interface = F_interface * sqrt_g_\n        tilde_F_left_face = F_L_n * sqrt_g_\n        tilde_F_right_face = F_R_n * sqrt_g_\n        \n        # Update densitized conserved states\n        tilde_U_L_np1 = tilde_U_L_n - (dt_ / dx_) * (tilde_F_interface - tilde_F_left_face)\n        tilde_U_R_np1 = tilde_U_R_n - (dt_ / dx_) * (tilde_F_right_face - tilde_F_interface)\n\n        # Get D from updated states\n        D_L_n = U_L_n[0]\n        D_R_n = U_R_n[0]\n        D_L_np1 = tilde_U_L_np1[0] / sqrt_g_\n        D_R_np1 = tilde_U_R_np1[0] / sqrt_g_\n\n        # Calculate error\n        error = abs(D_L_np1 - D_L_n) + abs(D_R_np1 - D_R_n)\n        return error\n\n    e_HLLE = compute_error(F_HLLE, U_L, U_R, F_L, F_R, dt, dx, sqrt_g)\n    e_HLLC = compute_error(F_HLLC, U_L, U_R, F_L, F_R, dt, dx, sqrt_g)\n\n    return e_HLLE - e_HLLC\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "When extending hydrodynamics to magnetohydrodynamics (MHD), codes must satisfy the additional constraint that the magnetic field remains divergence-free, i.e., $\\nabla \\cdot \\mathbf{B} = 0$. Constrained Transport (CT) is a powerful numerical technique that enforces this constraint to machine precision by its very construction, representing the magnetic field on a staggered grid as the discrete curl of a vector potential. This practice guides you through implementing a CT scheme in a curved spacetime, demonstrating its mathematical elegance and robustness even across a black hole event horizon, and revealing why it is the gold standard in modern GRMHD simulations .",
            "id": "3512085",
            "problem": "Implement a discrete constrained transport scheme for the homogeneous Maxwell equations in a curved spacetime corresponding to the Schwarzschild black hole written in ingoing Kerr–Schild spherical–polar coordinates. Work in the time-independent, axisymmetric setting so that only the spatial divergence constraint must be demonstrated. The goal is twofold: to show numerically that the discrete divergence of the magnetic field vanishes to roundoff error everywhere in the domain, including cells that straddle the event horizon, and to measure how a non-conservative, naive estimate of the divergence scales with resolution.\n\nBegin from the homogeneous Maxwell equations in the standard $3+1$ split of General Relativity, where the spatial magnetic field is represented by its contravariant components $B^i$ and the spatial metric has determinant $\\gamma$. The magnetic field satisfies the divergence constraint\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right)=0,\n$$\nwhere $\\partial_i$ denotes the partial derivative with respect to the spatial coordinates. In constrained transport, one represents the face-centered magnetic flux density (also called the magnetic induction density)\n$$\n\\Phi^i \\equiv \\sqrt{\\gamma}\\,B^i\n$$\nas a discrete curl of an edge-centered vector potential $A_i$ in terms of the Levi–Civita symbol density $\\,\\varepsilon^{ijk}$:\n$$\n\\Phi^i = \\varepsilon^{ijk}\\,\\partial_j A_k,\n$$\nso that the discrete divergence of $\\Phi^i$ vanishes identically to roundoff by the discrete analog of the vector identity that the divergence of a curl is zero.\n\nUse the Schwarzschild spacetime in ingoing Kerr–Schild spherical–polar coordinates $(t,r,\\theta,\\phi)$ in geometrized units where the gravitational constant $G$ and the speed of light $c$ are set to unity. Let the black hole mass be $M=1$, so the event horizon radius is $r_H=2M=2$. In this coordinate system, the spatial metric on $t=\\text{constant}$ slices is diagonal, with\n$$\n\\gamma_{rr} = 1 + \\frac{2M}{r},\\quad \\gamma_{\\theta\\theta} = r^2,\\quad \\gamma_{\\phi\\phi} = r^2\\sin^2\\theta,\n$$\nand determinant\n$$\n\\gamma = \\left(1+\\frac{2M}{r}\\right) r^4 \\sin^2\\theta,\\quad \\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+\\frac{2M}{r}}.\n$$\n\nConstruct a uniform spherical–polar grid in $r\\in[r_{\\min},r_{\\max}]$ and $\\theta\\in[\\theta_{\\min},\\theta_{\\max}]$ with $N_r$ and $N_\\theta$ cells, respectively. Use\n$$\nr_{\\min}=1.6,\\quad r_{\\max}=10.0,\\quad \\theta_{\\min}=0.05,\\quad \\theta_{\\max}=\\pi-0.05,\n$$\nso that the domain strictly includes zones on both sides of the event horizon while avoiding the coordinate singularity at the poles. Assume axisymmetry and suppress the $\\phi$-direction (equivalently, $N_\\phi=1$ with no variation).\n\nDefine the only nonzero component of the vector potential to be the covariant azimuthal component $A_\\phi$, sampled at the edges that run along the $\\phi$-direction. Place these edges at the intersections of the $r$- and $\\theta$-face locations, i.e., at $(r_{i+\\frac{1}{2}},\\theta_{j+\\frac{1}{2}})$ for $i=0,\\dots,N_r-1$ and $j=0,\\dots,N_\\theta-1$. Use the smooth, localized, horizon-crossing field\n$$\nA_\\phi(r,\\theta) = A_0\\, r^2 \\sin^2\\theta \\,\\exp\\!\\left(-\\left(\\frac{r}{r_0}\\right)^2\\right),\n$$\nwith $A_0=1$ and $r_0=4$.\n\nImplement discrete constrained transport in these coordinates by defining the face-centered flux densities\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta},\n$$\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\,\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r},\n$$\nand $\\Phi^\\phi=0$. Here $\\Delta r=(r_{\\max}-r_{\\min})/N_r$ and $\\Delta\\theta=(\\theta_{\\max}-\\theta_{\\min})/N_\\theta$, and indices $i$ and $j$ refer to cell-centered indices in $r$ and $\\theta$. This is the discrete representation of $\\Phi^i = \\varepsilon^{ijk}\\partial_j A_k$ in spherical–polar coordinates under the axisymmetric assumption.\n\nDefine the discrete divergence of the flux density at cell centers $(i,j)$ by\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}.\n$$\nAccording to the constrained transport construction, this discrete divergence is expected to vanish to roundoff everywhere, including cells intersecting the horizon.\n\nFor comparison, also compute a non-conservative, naive estimate of the curved-space divergence that mimics a common non-staggered discretization. First recover face-centered magnetic field components $B^r=\\Phi^r/\\sqrt{\\gamma}$ and $B^\\theta=\\Phi^\\theta/\\sqrt{\\gamma}$ using $\\sqrt{\\gamma}$ evaluated at the corresponding face locations, then average these to cell centers to obtain $B^r_{c}$ and $B^\\theta_{c}$. Next compute the cell-centered approximation of\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive}} \\equiv \\frac{1}{\\sqrt{\\gamma}}\\left[\\partial_r\\left(\\sqrt{\\gamma}\\,B^r\\right) + \\partial_\\theta\\left(\\sqrt{\\gamma}\\,B^\\theta\\right)\\right]\n$$\nusing second-order centered finite differences for the derivatives on the cell-centered arrays and $\\sqrt{\\gamma}$ at cell centers. Restrict this naive divergence estimate to interior cells so that centered stencils are available.\n\nImplement both estimators on the same grids and report the following two scalar error measures for each resolution:\n- The maximum absolute value of the constrained transport discrete divergence over all cells,\n$$\nE_{\\mathrm{CT}} \\equiv \\max_{i,j} \\left|\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij}\\right|.\n$$\n- The root-mean-square of the naive divergence over interior cells,\n$$\nE_{\\mathrm{naive}} \\equiv \\sqrt{\\frac{1}{N_{\\mathrm{int}}}\\sum_{\\text{interior }(i,j)} \\left(\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{naive},ij}\\right)^2 },\n$$\nwhere $N_{\\mathrm{int}}$ is the number of interior cells used by the centered stencil. These are dimensionless numbers in the code units used.\n\nTest suite. Run the program for the following three resolutions:\n- Case A (happy path): $N_r=48$, $N_\\theta=48$.\n- Case B (refinement): $N_r=96$, $N_\\theta=96$.\n- Case C (further refinement): $N_r=192$, $N_\\theta=192$.\n\nYour program should produce a single line of output containing the six results in the order\n$$\n\\left[E_{\\mathrm{CT}}^{(A)},\\,E_{\\mathrm{naive}}^{(A)},\\,E_{\\mathrm{CT}}^{(B)},\\,E_{\\mathrm{naive}}^{(B)},\\,E_{\\mathrm{CT}}^{(C)},\\,E_{\\mathrm{naive}}^{(C)}\\right],\n$$\nprinted as a comma-separated list enclosed in square brackets, with each floating-point number in scientific notation with six significant digits. No other text should be printed. All calculations are to be carried out in geometrized units and angles in radians. The expected qualitative behavior is that $E_{\\mathrm{CT}}$ is at the level of roundoff for all resolutions and that $E_{\\mathrm{naive}}$ decreases approximately like the square of the grid spacing as the resolution increases.",
            "solution": "The problem requires the implementation and validation of a discrete constrained transport (CT) scheme for the homogeneous Maxwell equations in the curved spacetime of a Schwarzschild black hole. The goal is to demonstrate that the CT scheme preserves the divergence-free constraint of the magnetic field to machine precision and to compare its accuracy against a more straightforward, non-conservative numerical approach. The context is axisymmetric, so we consider a two-dimensional grid in spherical-polar coordinates $(r, \\theta)$.\n\nThe governing physical principle is the divergence constraint on the magnetic field $\\mathbf{B}$, which in the $3+1$ formalism of general relativity is expressed in terms of the spatial metric determinant $\\gamma$ and the contravariant components of the magnetic field $B^i$ as:\n$$\n\\partial_i \\left( \\sqrt{\\gamma} B^i \\right) = 0\n$$\nwhere summation over the repeated index $i \\in \\{r, \\theta, \\phi\\}$ is implied. The quantity $\\Phi^i \\equiv \\sqrt{\\gamma} B^i$ is the magnetic flux density.\n\nTo numerically enforce this constraint, the constrained transport method represents the magnetic flux density as the curl of a vector potential, $A_k$. In this problem, we are given a discrete representation inspired by the continuous relation $\\Phi^i = \\varepsilon^{ijk} \\partial_j A_k$, where $\\varepsilon^{ijk}$ is the Levi-Civita symbol density. The key idea is that the divergence of a curl is identically zero. A discrete implementation that correctly mimics this property will preserve the divergence-free condition to the level of floating-point roundoff error.\n\nThe numerical implementation is performed on a staggered grid. We define a uniform grid of $N_r \\times N_\\theta$ cells in the domain $(r, \\theta)$. The fundamental quantities are located as follows:\n-   Cell centers are at $(r_i, \\theta_j)$, for $i \\in \\{0, \\dots, N_r-1\\}, j \\in \\{0, \\dots, N_\\theta-1\\}$.\n-   Vertical faces (constant $r$) are at $r_{i \\pm 1/2}$, and horizontal faces (constant $\\theta$) are at $\\theta_{j \\pm 1/2}$.\n-   The vector potential $A_\\phi$ is defined at the cell corners (or edges, oriented in the $\\phi$-direction), with coordinates $(r_{i+1/2}, \\theta_{j+1/2})$.\n\nGiven the vector potential $A_\\phi(r, \\theta)$ sampled at cell corners, the face-centered magnetic flux densities $\\Phi^r$ and $\\Phi^\\theta$ are computed using a discrete curl operation.\nThe radial flux $\\Phi^r$ is located on $r$-faces (at locations $(r_{i+1/2}, \\theta_j)$) and is computed via a finite difference of $A_\\phi$ in the $\\theta$-direction:\n$$\n\\Phi^r\\big|_{i+\\frac{1}{2},j} = \\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i+\\frac{1}{2},j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\nThe polar flux $\\Phi^\\theta$ is located on $\\theta$-faces (at locations $(r_i, \\theta_{j+1/2})$) and is computed via a finite difference of $A_\\phi$ in the $r$-direction:\n$$\n\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} = -\\frac{A_\\phi\\big|_{i+\\frac{1}{2},j+\\frac{1}{2}} - A_\\phi\\big|_{i-\\frac{1}{2},j+\\frac{1}{2}}}{\\Delta r}\n$$\nDue to axisymmetry, $\\Phi^\\phi = 0$.\n\nThe discrete divergence is then computed at cell centers $(r_i, \\theta_j)$ by taking finite differences of the face-centered fluxes:\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} \\equiv \\frac{\\Phi^r\\big|_{i+\\frac{1}{2},j} - \\Phi^r\\big|_{i-\\frac{1}{2},j}}{\\Delta r} + \\frac{\\Phi^\\theta\\big|_{i,j+\\frac{1}{2}} - \\Phi^\\theta\\big|_{i,j-\\frac{1}{2}}}{\\Delta\\theta}\n$$\nSubstituting the definitions for the fluxes into the divergence expression reveals that the terms cancel out exactly:\n$$\n\\left[\\nabla\\cdot\\mathbf{B}\\right]_{\\mathrm{CT},ij} = \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} \\right) - \\left( A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] \\\\\n- \\frac{1}{\\Delta r \\Delta \\theta} \\left[ \\left( A_{\\phi,i+\\frac{1}{2},j+\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j+\\frac{1}{2}} \\right) - \\left( A_{\\phi,i+\\frac{1}{2},j-\\frac{1}{2}} - A_{\\phi,i-\\frac{1}{2},j-\\frac{1}{2}} \\right) \\right] = 0\n$$\nThis algebraic cancellation guarantees that the computed divergence will be zero up to machine precision. The error metric for this method is the maximum absolute value of this discrete divergence over all grid cells, $E_{\\mathrm{CT}}$.\n\nFor comparison, a non-conservative, \"naive\" method is implemented. This approach fails to preserve the divergence-free property at the discrete level. The procedure is as follows:\n1.  Compute the face-centered physical magnetic field components $B^r = \\Phi^r / \\sqrt{\\gamma}$ and $B^\\theta = \\Phi^\\theta / \\sqrt{\\gamma}$, using values of $\\sqrt{\\gamma}$ evaluated at the corresponding face locations. The metric determinant is $\\sqrt{\\gamma} = r^2 \\sin\\theta \\sqrt{1+2M/r}$.\n2.  Average the face-centered components $B^r$ and $B^\\theta$ to obtain cell-centered fields, $B^r_c$ and $B^\\theta_c$. For instance, $B^r_{c,ij} = \\frac{1}{2}(B^r_{i+1/2,j} + B^r_{i-1/2,j})$.\n3.  Reconstruct cell-centered flux densities using the cell-centered fields and cell-centered metric determinant value: $F^r_c = (\\sqrt{\\gamma} B^r)_c$ and $F^\\theta_c = (\\sqrt{\\gamma} B^\\theta)_c$.\n4.  Approximate the divergence $\\frac{1}{\\sqrt{\\gamma}}[\\partial_r(\\sqrt{\\gamma}B^r) + \\partial_\\theta(\\sqrt{\\gamma}B^\\theta)]$ using second-order centered finite differences for the derivatives of $F^r_c$ and $F^\\theta_c$ on the grid of interior cells.\n\nThis naive method introduces truncation errors at each step (averaging and differentiation). Since the true divergence of the analytic field is zero, the numerically computed divergence will be on the order of the truncation error, which is expected to be second-order in the grid spacing, i.e., $O(\\Delta r^2, \\Delta \\theta^2)$. The error metric $E_{\\mathrm{naive}}$ is the root-mean-square of this naive divergence over the interior grid cells. We expect $E_{\\mathrm{naive}}$ to decrease by a factor of approximately $4$ each time the resolution is doubled.\n\nThe calculations are performed for three grid resolutions ($48 \\times 48$, $96 \\times 96$, and $192 \\times 192$) on a domain that straddles the black hole event horizon at $r=2M=2$, demonstrating the robustness of the CT method even in this strong-gravity regime.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares constrained transport and naive divergence schemes\n    for the magnetic field in Schwarzschild spacetime.\n    \"\"\"\n\n    def run_case(Nr, Nth):\n        \"\"\"\n        Runs the simulation for a single resolution (Nr, Nth).\n\n        Returns:\n            E_ct (float): Maximum absolute error for the CT method.\n            E_naive (float): RMS error for the naive method.\n        \"\"\"\n        # Physical and domain constants\n        M = 1.0\n        A0 = 1.0\n        r0 = 4.0\n        rmin, rmax = 1.6, 10.0\n        th_min, th_max = 0.05, np.pi - 0.05\n\n        # Grid setup\n        dr = (rmax - rmin) / Nr\n        dth = (th_max - th_min) / Nth\n        \n        r_faces = np.linspace(rmin, rmax, Nr + 1, dtype=np.float64)\n        th_faces = np.linspace(th_min, th_max, Nth + 1, dtype=np.float64)\n        r_centers = rmin + (np.arange(Nr, dtype=np.float64) + 0.5) * dr\n        th_centers = th_min + (np.arange(Nth, dtype=np.float64) + 0.5) * dth\n\n        # Vector potential A_phi defined at grid corners (intersections of faces)\n        R_corners, TH_corners = np.meshgrid(r_faces, th_faces, indexing='ij')\n        A_phi_corners = A0 * R_corners**2 * np.sin(TH_corners)**2 * np.exp(-(R_corners/r0)**2)\n\n        # ---- Constrained Transport (CT) Divergence Calculation ----\n\n        # Magnetic flux densities at faces from discrete curl of A_phi\n        # Phi_r is located at (r-faces, theta-centers), size (Nr+1, Nth)\n        Phi_r = (A_phi_corners[:, 1:] - A_phi_corners[:, :-1]) / dth\n        # Phi_theta is located at (r-centers, theta-faces), size (Nr, Nth+1)\n        Phi_theta = - (A_phi_corners[1:, :] - A_phi_corners[:-1, :]) / dr\n\n        # Discrete divergence at cell centers, size (Nr, Nth)\n        divB_CT = (Phi_r[1:, :] - Phi_r[:-1, :]) / dr \\\n                + (Phi_theta[:, 1:] - Phi_theta[:, :-1]) / dth\n        \n        # Maximum absolute error for the CT method\n        E_ct = np.max(np.abs(divB_CT))\n\n        # ---- Naive Divergence Calculation ----\n\n        def sqrt_gamma(r, th, mass):\n            r_safe = np.maximum(r, 1e-15) # Avoid r=0 issues, though domain prevents it.\n            return r_safe**2 * np.sin(th) * np.sqrt(1.0 + 2.0 * mass / r_safe)\n\n        # sqrt(gamma) on r-faces grid (locations of Phi_r)\n        R_rf, TH_rf = np.meshgrid(r_faces, th_centers, indexing='ij')\n        sg_rf = sqrt_gamma(R_rf, TH_rf, M)\n\n        # sqrt(gamma) on theta-faces grid (locations of Phi_theta)\n        R_thf, TH_thf = np.meshgrid(r_centers, th_faces, indexing='ij')\n        sg_thf = sqrt_gamma(R_thf, TH_thf, M)\n\n        # Physical magnetic field components B at faces\n        Br_face = Phi_r / sg_rf\n        Bth_face = Phi_theta / sg_thf\n\n        # Average B fields to cell centers\n        Br_c = 0.5 * (Br_face[1:, :] + Br_face[:-1, :])\n        Bth_c = 0.5 * (Bth_face[:, 1:] + Bth_face[:, :-1])\n        \n        # Cell-centered fluxes for naive method\n        R_c, TH_c = np.meshgrid(r_centers, th_centers, indexing='ij')\n        sg_c = sqrt_gamma(R_c, TH_c, M)\n        \n        Fr_c = sg_c * Br_c\n        Fth_c = sg_c * Bth_c\n\n        # Derivatives of fluxes at interior cell centers using 2nd order centered stencil\n        # Interior indices i in [1, Nr-2] and j in [1, Nth-2]\n        d_dr_Fr = (Fr_c[2:, 1:-1] - Fr_c[:-2, 1:-1]) / (2 * dr)\n        d_dth_Fth = (Fth_c[1:-1, 2:] - Fth_c[1:-1, :-2]) / (2 * dth)\n\n        # Naive divergence at interior cells\n        divB_naive_interior = (d_dr_Fr + d_dth_Fth) / sg_c[1:-1, 1:-1]\n        \n        # RMS error for naive method\n        N_int = (Nr - 2) * (Nth - 2)\n        E_naive = np.sqrt(np.sum(divB_naive_interior**2) / N_int)\n\n        return E_ct, E_naive\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (48, 48),    # Case A\n        (96, 96),    # Case B\n        (192, 192),  # Case C\n    ]\n\n    results = []\n    for Nr, Nth in test_cases:\n        E_ct, E_naive = run_case(Nr, Nth)\n        results.extend([E_ct, E_naive])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6e}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}