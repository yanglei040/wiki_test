{
    "hands_on_practices": [
        {
            "introduction": "许多强大的常微分方程数值方法，如线性多步法，其核心思想是对常微分方程的积分形式进行近似。本练习将带你追本溯源，通过泰勒展开来推导经典的二阶 Adams-Bashforth（显式）和 Adams-Moulton（隐式）方法的系数。这个过程不仅揭示了数值积分方法构造的基本原理，也让你深刻理解“阶数”这一衡量方法精度的关键概念是如何确定的 。",
            "id": "3528239",
            "problem": "在计算天体物理学中，常微分方程的时间积分出现在诸如演化致密双星在引力辐射反作用下的轨道间距，或坍缩的原恒星核中流体元的内能等任务中。考虑一个标量可观测量 $y(t)$ 的一般初值问题，它由一个光滑的右端项 $f(t,y)$ 通过基本关系 $y'(t) = f(t,y)$ 控制，其中 $y(t_0)$ 已知。从 $t_n$ 到 $t_{n+1} = t_n + h$，大小为 $h0$ 的均匀步长上的精确积分形式为\n$$\ny(t_{n+1}) = y(t_n) + \\int_{t_n}^{t_{n+1}} f\\big(t, y(t)\\big)\\,dt.\n$$\n为了构建二阶精度的多步法，我们假设用两种求积拟设来近似积分 $\\int_{t_n}^{t_{n+1}} f\\big(t,y(t)\\big)\\,dt$：\n\n- 一个与 Adams–Bashforth 族一致的显式两步预测子，它使用过去的采样点，\n$$\n\\int_{t_n}^{t_{n+1}} f\\big(t,y(t)\\big)\\,dt \\approx h\\left[\\alpha_0\\, f\\big(t_n,y(t_n)\\big) + \\alpha_1\\, f\\big(t_{n-1},y(t_{n-1})\\big)\\right],\n$$\n其中 $\\alpha_0$ 和 $\\alpha_1$ 是未知系数。\n\n- 一个与 Adams–Moulton 族一致的隐式单步校正子，它使用当前和未来的采样点，\n$$\n\\int_{t_n}^{t_{n+1}} f\\big(t,y(t)\\big)\\,dt \\approx h\\left[\\beta_0\\, f\\big(t_{n+1},y(t_{n+1})\\big) + \\beta_1\\, f\\big(t_n,y(t_n)\\big)\\right],\n$$\n其中 $\\beta_0$ 和 $\\beta_1$ 是未知系数。\n\n仅使用上述积分表示以及 $f\\big(t,y(t)\\big)$ 沿精确解在 $t_n$ 点的泰勒展开，推导系数 $\\alpha_0$、$\\alpha_1$、$\\beta_0$ 和 $\\beta_1$。推导要求是，对于任何足够光滑的 $f$，每种拟设都能再现精确积分，直到并包括局部截断误差中 $h^2$ 阶的项（即，所得方法的阶为 2）。将你的最终答案表示为一个单行矩阵，按顺序包含 $\\alpha_0$、$\\alpha_1$、$\\beta_0$ 和 $\\beta_1$。不需要四舍五入，并报告精确的有理数值。",
            "solution": "该问题要求推导用于求解常微分方程的预测-校正方法中的两种求积公式的系数。推导必须确保所得的数值积分方法具有二阶精度。这是通过将求积公式的泰勒级数展开与精确积分的泰勒级数展开进行匹配来实现的。\n\n设待积函数表示为 $F(t) = f\\big(t, y(t)\\big)$，其中 $y(t)$ 是微分方程 $y'(t) = f(t,y)$ 的精确解。我们假设 $F(t)$ 足够光滑以拥有必要的导数。时间步长是均匀的，对于整数 $k$，有 $t_{k} = t_n + (k-n)h$。\n\n首先，我们将精确积分 $I = \\int_{t_n}^{t_{n+1}} F(t)\\,dt$ 在点 $t_n$ 周围展开为泰勒级数。为此，我们将被积函数 $F(t)$ 在 $t_n$ 处展开：\n$$\nF(t) = F(t_n) + F'(t_n)(t-t_n) + \\frac{F''(t_n)}{2!}(t-t_n)^2 + O\\big((t-t_n)^3\\big)\n$$\n将此展开式从 $t_n$ 积分到 $t_{n+1} = t_n + h$：\n$$\nI = \\int_{t_n}^{t_n+h} \\left[ F(t_n) + F'(t_n)(t-t_n) + \\frac{F''(t_n)}{2}(t-t_n)^2 + \\dots \\right] dt\n$$\n$$\nI = \\left[ F(t_n)(t-t_n) + F'(t_n)\\frac{(t-t_n)^2}{2} + F''(t_n)\\frac{(t-t_n)^3}{6} + \\dots \\right]_{t_n}^{t_n+h}\n$$\n代入积分上下限，得到精确积分关于 $h$ 的幂级数：\n$$\nI = h F(t_n) + \\frac{h^2}{2} F'(t_n) + \\frac{h^3}{6} F''(t_n) + O(h^4)\n$$\n此处，$F(t_n)$ 代表函数在 $t_n$ 的值，$F'(t_n)$ 代表其在 $t=t_n$ 处的导数 $\\frac{dF}{dt}|_{t=t_n}$，以此类推。如果局部截断误差为 $O(h^3)$，则数值方法的阶为 2。这要求对积分 $I$ 的近似必须与精确展开式匹配到 $h^2$ 阶的项。\n\n**预测子系数($\\alpha_0, \\alpha_1$)的推导**\n\n显式两步预测子公式由以下拟设给出：\n$$\nI \\approx I_p = h\\left[\\alpha_0\\, F(t_n) + \\alpha_1\\, F(t_{n-1})\\right]\n$$\n为了为此近似创建一个关于 $h$ 的幂级数，我们将 $F(t_{n-1})$ 在 $t_n$ 处展开。由于 $t_{n-1} = t_n - h$：\n$$\nF(t_{n-1}) = F(t_n) + F'(t_n)(t_{n-1}-t_n) + O\\big((t_{n-1}-t_n)^2\\big) = F(t_n) - h F'(t_n) + O(h^2)\n$$\n将此代入 $I_p$ 的表达式中：\n$$\nI_p = h\\left[\\alpha_0\\, F(t_n) + \\alpha_1\\, \\big(F(t_n) - h F'(t_n) + O(h^2)\\big)\\right]\n$$\n$$\nI_p = h\\left[(\\alpha_0 + \\alpha_1)F(t_n) - \\alpha_1 h F'(t_n) + O(h^2)\\right]\n$$\n$$\nI_p = (\\alpha_0 + \\alpha_1)h F(t_n) - \\alpha_1 h^2 F'(t_n) + O(h^3)\n$$\n为了达到二阶精度，我们将 $I$ 和 $I_p$ 的展开式中直至 $h^2$ 阶的项的系数相等：\n$$\nI   = 1 \\cdot h F(t_n) + \\frac{1}{2} h^2 F'(t_n) + O(h^3)\n$$\n$$\nI_p = (\\alpha_0 + \\alpha_1)h F(t_n) - \\alpha_1 h^2 F'(t_n) + O(h^3)\n$$\n比较 $h F(t_n)$ 和 $h^2 F'(t_n)$ 的系数：\n1.  $h F(t_n)$ 的系数：$1 = \\alpha_0 + \\alpha_1$\n2.  $h^2 F'(t_n)$ 的系数：$\\frac{1}{2} = -\\alpha_1$\n\n从第二个方程，我们得到 $\\alpha_1 = -\\frac{1}{2}$。\n将此代入第一个方程：$\\alpha_0 + (-\\frac{1}{2}) = 1$，得到 $\\alpha_0 = \\frac{3}{2}$。\n因此，二阶 Adams-Bashforth 预测子的系数为 $\\alpha_0 = \\frac{3}{2}$ 和 $\\alpha_1 = -\\frac{1}{2}$。\n\n**校正子系数($\\beta_0, \\beta_1$)的推导**\n\n隐式单步校正子公式由以下拟设给出：\n$$\nI \\approx I_c = h\\left[\\beta_0\\, F(t_{n+1}) + \\beta_1\\, F(t_n)\\right]\n$$\n为了为此近似创建一个关于 $h$ 的幂级数，我们将 $F(t_{n+1})$ 在 $t_n$ 处展开。由于 $t_{n+1} = t_n + h$：\n$$\nF(t_{n+1}) = F(t_n) + F'(t_n)(t_{n+1}-t_n) + O\\big((t_{n+1}-t_n)^2\\big) = F(t_n) + h F'(t_n) + O(h^2)\n$$\n将此代入 $I_c$ 的表达式中：\n$$\nI_c = h\\left[\\beta_0\\, \\big(F(t_n) + h F'(t_n) + O(h^2)\\big) + \\beta_1\\, F(t_n)\\right]\n$$\n$$\nI_c = h\\left[(\\beta_0 + \\beta_1)F(t_n) + \\beta_0 h F'(t_n) + O(h^2)\\right]\n$$\n$$\nI_c = (\\beta_0 + \\beta_1)h F(t_n) + \\beta_0 h^2 F'(t_n) + O(h^3)\n$$\n再次，我们将系数与精确积分 $I$ 的展开式进行相等：\n$$\nI   = 1 \\cdot h F(t_n) + \\frac{1}{2} h^2 F'(t_n) + O(h^3)\n$$\n$$\nI_c = (\\beta_0 + \\beta_1)h F(t_n) + \\beta_0 h^2 F'(t_n) + O(h^3)\n$$\n比较 $h F(t_n)$ 和 $h^2 F'(t_n)$ 的系数：\n1.  $h F(t_n)$ 的系数：$1 = \\beta_0 + \\beta_1$\n2.  $h^2 F'(t_n)$ 的系数：$\\frac{1}{2} = \\beta_0$\n\n从第二个方程，我们得到 $\\beta_0 = \\frac{1}{2}$。\n将此代入第一个方程：$\\frac{1}{2} + \\beta_1 = 1$，得到 $\\beta_1 = \\frac{1}{2}$。\n因此，二阶 Adams-Moulton 校正子（即梯形法则）的系数为 $\\beta_0 = \\frac{1}{2}$ 和 $\\beta_1 = \\frac{1}{2}$。\n\n总之，推导出的系数为：\n$\\alpha_0 = \\frac{3}{2}$\n$\\alpha_1 = -\\frac{1}{2}$\n$\\beta_0 = \\frac{1}{2}$\n$\\beta_1 = \\frac{1}{2}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{2}  -\\frac{1}{2}  \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在天体物理学中，许多问题（如恒星内部的热核反应或热扩散）本质上是“刚性”的，这意味着系统包含多个尺度差异巨大的时间尺度。为了稳定地求解这些问题，我们需要使用具有特定稳定性属性的积分方法。本练习聚焦于为刚性问题设计的向后差分格式（BDF），通过推导 BDF2 方法的绝对稳定域，你将学会如何分析数值方法的稳定性，并将其与简并物质核心闪燃模拟中时间步长的实际选择联系起来 。",
            "id": "3528288",
            "problem": "在刚性初值问题中，使用全隐式向后分化格式 (BDF) 方法来推进 Dahlquist 测试方程 $y'(t) = \\lambda y(t)$ 的解，其中 $\\lambda \\in \\mathbb{C}$ 代表计算天体物理模型中线性化算子的谱。考虑二阶向后分化格式 (BDF2)，其定义为用二阶向后差分近似新时间层 $t_{n+1}$ 处的导数，并将其等于在 $t_{n+1}$ 处计算的右端项：\n$$\\frac{3 y_{n+1} - 4 y_n + y_{n-1}}{2 h} = f(t_{n+1}, y_{n+1}),$$\n其中 $h$ 是常数步长，对于测试方程有 $f(t, y) = \\lambda y$。对于一个线性多步法，其绝对稳定域是复数 $z = h \\lambda$ 的集合，使得对于由测试方程导出的递推关系，所有特征根的模都严格小于 1，并且由零点稳定性允许在 $z=0$ 时存在一个在 1 处的单根。\n\n任务 1：通过假设存在一个单位模长的特征根，推导 BDF2 绝对稳定边界的精确参数表达式，并将该边界表示为 $z(\\varphi)$，其中 $\\varphi \\in [0, 2\\pi)$ 以弧度为单位。\n\n任务 2：在简并核闪模拟中，扩散主导的热响应可以局部线性化为 $y'(t) = -\\Lambda y(t)$，其中 $\\Lambda  0$，这反映了在时间尺度 $\\Lambda^{-1}$ 上温度扰动的强阻尼。为保证操作稳健性，要求此刚性模式的每步数值放大因子的模最大为 $r = 0.2$。使用 BDF2 在测试方程上的递推关系，对于实负数 $z = - h \\Lambda$，求出保证此每步阻尼要求的最小步长 $h_{\\min}$。对于 $\\Lambda = 2.0 \\times 10^{3}\\ \\text{s}^{-1}$ 计算 $h_{\\min}$ 的值，并将您的数值答案四舍五入到四位有效数字。以秒为单位表示 $h_{\\min}$。\n\n您的最终答案必须包括：\n- 以弧度 $\\varphi$ 表示的稳定边界的精确解析表达式 $z(\\varphi)$。\n- 四舍五入到四位有效数字的 $h_{\\min}$ 的数值（以秒为单位）。",
            "solution": "该问题已经过验证，并被确定为一个应用于计算天体物理学领域的、适定的、有科学依据的数值分析问题。\n\n该问题分为两个任务。第一个任务是推导二阶向后分化格式 (BDF2) 的绝对稳定边界。第二个任务是应用特定的阻尼要求，为一个给定的刚性常微分方程 (ODE) 确定最小步长。\n\n**任务 1：绝对稳定边界的推导**\n\nBDF2 方法由以下递推关系给出：\n$$ \\frac{3 y_{n+1} - 4 y_n + y_{n-1}}{2 h} = f(t_{n+1}, y_{n+1}) $$\n我们使用 Dahlquist 测试方程 $y'(t) = \\lambda y(t)$（其中 $\\lambda \\in \\mathbb{C}$）来分析此方法。对于该方程，右端项为 $f(t_{n+1}, y_{n+1}) = \\lambda y_{n+1}$。将此代入 BDF2 公式得到：\n$$ \\frac{3 y_{n+1} - 4 y_n + y_{n-1}}{2 h} = \\lambda y_{n+1} $$\n两边乘以 $2h$ 并按时间步分组整理各项，得到：\n$$ 3 y_{n+1} - 4 y_n + y_{n-1} = 2h\\lambda y_{n+1} $$\n$$ (3 - 2h\\lambda) y_{n+1} - 4 y_n + y_{n-1} = 0 $$\n令 $z = h\\lambda$。该递推关系可以写为：\n$$ (3 - 2z) y_{n+1} - 4 y_n + y_{n-1} = 0 $$\n为求此线性常系数差分方程的特征根，我们代入拟设解 $y_k = \\xi^k$：\n$$ (3 - 2z) \\xi^{n+1} - 4 \\xi^n + \\xi^{n-1} = 0 $$\n两边除以 $\\xi^{n-1}$（假设 $\\xi \\neq 0$），我们得到放大因子 $\\xi$ 的特征多项式：\n$$ (3 - 2z) \\xi^2 - 4 \\xi + 1 = 0 $$\n绝对稳定边界是 $z \\in \\mathbb{C}$ 的集合，其中至少有一个特征根 $\\xi$ 的模为 1。因此，我们令 $\\xi = \\exp(i\\varphi)$，其中 $\\varphi \\in [0, 2\\pi)$ 是一个实值参数。将此代入特征方程：\n$$ (3 - 2z) (\\exp(i\\varphi))^2 - 4 \\exp(i\\varphi) + 1 = 0 $$\n$$ (3 - 2z) \\exp(i2\\varphi) - 4 \\exp(i\\varphi) + 1 = 0 $$\n现在我们求解 $z$ 作为 $\\varphi$ 的函数：\n$$ 3 \\exp(i2\\varphi) - 2z \\exp(i2\\varphi) - 4 \\exp(i\\varphi) + 1 = 0 $$\n$$ 2z \\exp(i2\\varphi) = 3 \\exp(i2\\varphi) - 4 \\exp(i\\varphi) + 1 $$\n$$ z(\\varphi) = \\frac{3 \\exp(i2\\varphi) - 4 \\exp(i\\varphi) + 1}{2 \\exp(i2\\varphi)} $$\n化简此表达式可得到稳定边界的参数形式：\n$$ z(\\varphi) = \\frac{3}{2} - \\frac{4 \\exp(i\\varphi)}{2 \\exp(i2\\varphi)} + \\frac{1}{2 \\exp(i2\\varphi)} $$\n$$ z(\\varphi) = \\frac{3}{2} - 2 \\exp(-i\\varphi) + \\frac{1}{2} \\exp(-i2\\varphi) $$\n这就是所要求的 BDF2 方法的绝对稳定边界的解析表达式。\n\n**任务 2：满足阻尼要求的最小步长**\n\n在第二个任务中，我们考虑特定的常微分方程 $y'(t) = -\\Lambda y(t)$，其中 $\\Lambda  0$。这对应于 $\\lambda = -\\Lambda$ 的 Dahlquist 测试方程。因此，参数 $z$ 是实数且为负：$z = h\\lambda = -h\\Lambda$。\n\n特征方程仍然是 $(3 - 2z) \\xi^2 - 4 \\xi + 1 = 0$。代入 $z = -h\\Lambda$：\n$$ (3 + 2h\\Lambda) \\xi^2 - 4 \\xi + 1 = 0 $$\n这个二次方程的根 $\\xi$ 是每步放大因子：\n$$ \\xi = \\frac{-(-4) \\pm \\sqrt{(-4)^2 - 4(3+2h\\Lambda)(1)}}{2(3+2h\\Lambda)} = \\frac{4 \\pm \\sqrt{16 - 12 - 8h\\Lambda}}{2(3+2h\\Lambda)} = \\frac{4 \\pm \\sqrt{4 - 8h\\Lambda}}{2(3+2h\\Lambda)} $$\n$$ \\xi = \\frac{2 \\pm \\sqrt{1 - 2h\\Lambda}}{3+2h\\Lambda} $$\n根的性质取决于判别式 $1 - 2h\\Lambda$ 的符号。令 $x = h\\Lambda$。由于 $h0$ 和 $\\Lambda0$，我们有 $x0$。\n\n情况 1：$1 - 2x \\ge 0$，即 $0  x \\le \\frac{1}{2}$。\n在这种情况下，根是实数。两个根是 $\\xi_1 = \\frac{2 + \\sqrt{1 - 2x}}{3+2x}$ 和 $\\xi_2 = \\frac{2 - \\sqrt{1 - 2x}}{3+2x}$。主根（模最大的根）是 $\\xi_1$。设 $G(z)$ 为放大因子，则 $|G(z)| = |\\xi_1|$。\n要求是放大因子的模至多为 $r=0.2$。\n让我们分析函数 $g(x) = \\frac{2 + \\sqrt{1 - 2x}}{3+2x}$ 在 $x \\in (0, \\frac{1}{2}]$ 上的行为。当 $x \\to 0$ 时，$g(x) \\to \\frac{2+\\sqrt{1}}{3} = 1$。当 $x = \\frac{1}{2}$ 时，$g(\\frac{1}{2}) = \\frac{2+0}{3+1} = \\frac{1}{2} = 0.5$。函数 $g(x)$ 在此区间上是单调递减的。由于其最小值为 $0.5$，大于所要求的最大值 $0.2$，因此在 $0  h\\Lambda \\le \\frac{1}{2}$ 的范围内没有满足阻尼要求的 $h$ 的解。\n\n情况 2：$1 - 2x  0$，即 $x  \\frac{1}{2}$。\n在这种情况下，根是一对复共轭：\n$$ \\xi = \\frac{2 \\pm i\\sqrt{2x - 1}}{3+2x} $$\n两个根的模是相同的：\n$$ |G(z)| = |\\xi| = \\sqrt{\\left(\\frac{2}{3+2x}\\right)^2 + \\left(\\frac{\\sqrt{2x-1}}{3+2x}\\right)^2} = \\sqrt{\\frac{4 + (2x-1)}{(3+2x)^2}} = \\sqrt{\\frac{3+2x}{(3+2x)^2}} = \\frac{1}{\\sqrt{3+2x}} $$\n阻尼要求是 $|G(z)| \\le r = 0.2$。代回 $x = h\\Lambda$：\n$$ \\frac{1}{\\sqrt{3+2h\\Lambda}} \\le 0.2 $$\n为求解 $h$，我们可以对两边进行平方（因为两边都为正）：\n$$ \\frac{1}{3+2h\\Lambda} \\le (0.2)^2 = 0.04 $$\n$$ 1 \\le 0.04(3+2h\\Lambda) $$\n$$ \\frac{1}{0.04} \\le 3+2h\\Lambda $$\n$$ 25 \\le 3+2h\\Lambda $$\n$$ 22 \\le 2h\\Lambda $$\n$$ h\\Lambda \\ge 11 $$\n这意味着步长 $h$ 必须满足 $h \\ge \\frac{11}{\\Lambda}$。这个条件 $h\\Lambda \\ge 11$ 与本情况的假设 $h\\Lambda  \\frac{1}{2}$ 一致。\n保证所需阻尼的最小步长 $h_{\\min}$ 是：\n$$ h_{\\min} = \\frac{11}{\\Lambda} $$\n给定 $\\Lambda = 2.0 \\times 10^3\\ \\text{s}^{-1}$。代入此值：\n$$ h_{\\min} = \\frac{11}{2.0 \\times 10^3\\ \\text{s}^{-1}} = 5.5 \\times 10^{-3}\\ \\text{s} $$\n问题要求答案四舍五入到四位有效数字。\n$$ h_{\\min} = 5.500 \\times 10^{-3}\\ \\text{s} $$\n\n最终答案包含 $z(\\varphi)$ 的表达式和 $h_{\\min}$ 的数值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{2} - 2\\exp(-i\\varphi) + \\frac{1}{2}\\exp(-i2\\varphi)  5.500 \\times 10^{-3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论和分析是基础，但将它们应用于实际的计算挑战是最终目标。本练习提供了一个涉及刚性核反应网络的动手编程问题，这是计算天体物理学中的一个典型难题。你将发现，即使使用了为刚性问题设计的强大求解器，变量尺度选择不当也会严重影响其性能。通过实现和对比原始系统与其无量纲化后的形式，本练习将让你亲身体验如何通过变量缩放来改善问题的“条件数”，从而显著提高求解器的效率和稳健性 。",
            "id": "3528222",
            "problem": "您的任务是研究一个最小但刚性的核反应网络，并在计算天体物理学的背景下，量化变量的无量纲缩放对常微分方程初值问题的数值影响。目标是从第一性原理推导控制方程，实现原始和无量纲缩放两种公式，使用刚性求解器对两者进行积分，并计算可被自动测试的定量性能和条件度量。所有时间必须以秒为单位表示，所有要求的输出都是无量纲实数。\n\n从基本基础出发，即在一个充分混合的网络中，物种丰度的时间演化受质量作用定律和化学计量守恒的支配。考虑一个包含以下在恒定热力学状态下的有效反应的三同位素α链：\n- 有效的3α反应生成碳：$3\\, {}^{4}\\mathrm{He} \\rightarrow {}^{12}\\mathrm{C}$。\n- 碳上的α俘获生成氧：${}^{12}\\mathrm{C} + {}^{4}\\mathrm{He} \\rightarrow {}^{16}\\mathrm{O}$。\n\n设动力学变量为每重子的无量纲丰度$Y_{\\mathrm{He}}(t)$、$Y_{\\mathrm{C}}(t)$和$Y_{\\mathrm{O}}(t)$，它们是非负的，并在指定的网络下满足核子数守恒。令$k_{3\\alpha}$表示3α反应的有效速率系数，令$k_{\\alpha C}$表示碳上的α俘获的有效速率系数。将$k_{3\\alpha}$和$k_{\\alpha C}$视为常数参数，其量纲的选择应使以下标准的质量作用形式对于以秒的倒数为单位的产生项有效：有效的3α反应速率项与$Y_{\\mathrm{He}}^{3}$成正比，比例常数为$k_{3\\alpha}$；α俘获速率项与$Y_{\\mathrm{He}} Y_{\\mathrm{C}}$成正比，比例常数为$k_{\\alpha C}$。仅使用这些定义和化学计量守恒，推导向量$\\mathbf{y}(t) = \\left[Y_{\\mathrm{He}}(t), Y_{\\mathrm{C}}(t), Y_{\\mathrm{O}}(t)\\right]^{\\top}$的封闭常微分方程组。\n\n通过推导出的系统和初始条件$\\mathbf{y}(t_{0}) = \\mathbf{y}_{0}$，在有限时间区间$\\left[t_{0}, t_{f}\\right]$上定义未缩放的初值问题。对于刚性积分，您必须：\n- 使用后向差分公式（BDF）方法，并提供解析雅可比矩阵$\\mathbf{J}_{\\mathbf{y}}(t, \\mathbf{y}) = \\partial \\mathbf{f} / \\partial \\mathbf{y}$。\n- 启用密集输出，以在任意中间时间点评估解。\n- 对$\\left[Y_{\\mathrm{He}}, Y_{\\mathrm{C}}, Y_{\\mathrm{O}}\\right]$分别使用$10^{-9}$的相对容差和$\\left[10^{-18}, 10^{-18}, 10^{-18}\\right]$的绝对容差向量。\n\n现在构建一个旨在减小动态范围的无量纲缩放公式。选择一个固定的对角缩放矩阵$\\mathbf{S} = \\mathrm{diag}\\left(s_{\\mathrm{He}}, s_{\\mathrm{C}}, s_{\\mathrm{O}}\\right)$，其中$s_{\\mathrm{He}} = 1$，$s_{\\mathrm{C}} = 10^{-6}$，$s_{\\mathrm{O}} = 10^{-12}$。定义缩放后的变量$\\mathbf{x}(\\tau) = \\mathbf{S}^{-1} \\mathbf{y}(t)$和缩放后的时间$\\tau = t / t_{\\mathrm{ref}}$，时间尺度为$t_{\\mathrm{ref}} = 1 / k_{\\alpha C}$。仅使用链式法则和质量作用形式，推导形式为$\\mathrm{d} \\mathbf{x} / \\mathrm{d} \\tau = \\mathbf{g}(\\mathbf{x})$的变换后的初值问题，并提供解析雅可比矩阵$\\mathbf{J}_{\\mathbf{x}}(\\mathbf{x}) = \\partial \\mathbf{g} / \\partial \\mathbf{x}$。使用相同的求解器设置，在缩放后的时间$\\tau$内对缩放后的系统进行积分，并使用适用于缩放后系统的解析雅可比矩阵。根据需要，使用$t = \\tau \\, t_{\\mathrm{ref}}$将缩放运行中任何基于时间的诊断量映射回物理秒。\n\n对于每次运行（未缩放和缩放后），计算以下诊断量：\n- 接受的步长：如果求解器返回接受的时间点$\\{t_{i}\\}_{i=0}^{N}$，则计算接受的步长序列$\\Delta t_{i} = t_{i+1} - t_{i}$，其中$i = 0, \\dots, N-1$；计算平均值$\\overline{\\Delta t}$和中位数$\\widetilde{\\Delta t}$。对于缩放后的运行，通过乘以$t_{\\mathrm{ref}}$将$\\tau$中接受的步长转换为物理秒。所有时间均以秒为单位。\n- 隐式线性化的雅可比矩阵条件数：对于三个物理时间$t_{0}$（初始）、$t_{\\mathrm{mid}} = (t_{0} + t_{f})/2$（中点）和$t_{f}$（最终），使用该次运行中接受步长的中位数作为$h$，并使用该公式对应的雅可比矩阵来评估求解器的隐式线性系统矩阵$\\mathbf{M} = \\mathbf{I} - h \\mathbf{J}$。对于未缩放的运行，使用在状态$\\mathbf{y}(t)$处评估的$\\mathbf{J} = \\mathbf{J}_{\\mathbf{y}}$；对于缩放后的运行，使用在$\\mathbf{x}(\\tau)$处（其中$\\tau = t / t_{\\mathrm{ref}}$）评估的$\\mathbf{J} = \\mathbf{J}_{\\mathbf{x}}$。计算在三个时间点上每个矩阵的2-范数条件数$\\kappa_{2}(\\mathbf{M})$，然后取这三个值的算术平均值，以获得该次运行的单个条件度量。\n\n使用以下三个无量纲度量来量化每个测试用例中缩放的影响：\n- 平均条件度量的比率 $\\mathcal{R}_{\\kappa} = \\left(\\text{未缩放的平均 } \\kappa_{2}\\right) / \\left(\\text{缩放后的平均 } \\kappa_{2}\\right)$。\n- 平均接受物理步长的比率 $\\mathcal{R}_{\\Delta t} = \\left(\\text{缩放后的 }\\overline{\\Delta t}\\right) / \\left(\\text{未缩放的 }\\overline{\\Delta t}\\right)$。\n- 函数求值次数的比率 $\\mathcal{R}_{\\mathrm{nfev}} = \\left(\\text{求解器报告的未缩放的 nfev}\\right) / \\left(\\text{求解器报告的缩放后的 nfev}\\right)$。\n\n测试套件和参数规格：\n- 所有情况的初始条件：在$t_{0} = 0$秒时，$\\mathbf{y}_{0} = \\left[0.98,\\ 10^{-12},\\ 10^{-20}\\right]^{\\top}$。\n- 情况A（刚性，快速α俘获）：$k_{3\\alpha} = 10^{-4}\\ \\mathrm{s}^{-1}$，$k_{\\alpha C} = 10^{3}\\ \\mathrm{s}^{-1}$，$t_{f} = 10^{-2}$秒。\n- 情况B（非常刚性，极快α俘获）：$k_{3\\alpha} = 10^{-6}\\ \\mathrm{s}^{-1}$，$k_{\\alpha C} = 10^{5}\\ \\mathrm{s}^{-1}$，$t_{f} = 10^{-5}$秒。\n- 情况C（中等刚性，较慢动力学）：$k_{3\\alpha} = 10^{-2}\\ \\mathrm{s}^{-1}$，$k_{\\alpha C} = 10^{2}\\ \\mathrm{s}^{-1}$，$t_{f} = 10^{-1}$秒。\n\n实现要求：\n- 使用后向差分公式（BDF）方法，启用解析雅可比矩阵和密集输出。\n- 使用相对容差$10^{-9}$和绝对容差向量$\\left[10^{-18}, 10^{-18}, 10^{-18}\\right]$。\n- 对于每种情况，计算如上定义的$\\mathcal{R}_{\\kappa}$、$\\mathcal{R}_{\\Delta t}$和$\\mathcal{R}_{\\mathrm{nfev}}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由三个列表组成的列表，每个测试用例一个，顺序与上述情况相同。每个内部列表必须按顺序包含三个浮点数$\\left[\\mathcal{R}_{\\kappa}, \\mathcal{R}_{\\Delta t}, \\mathcal{R}_{\\mathrm{nfev}}\\right]$，不带任何单位。确切格式为Python风格的列表字面量，例如：\"[[1.23,0.45,3.67],[...],[...]]\"。",
            "solution": "用户提供的问题是一个在计算天体物理学和数值分析领域中适定且有科学依据的练习。它要求推导并数值求解一个简化核反应网络的常微分方程组（ODE）。核心任务是比较未缩放的公式与无量纲的缩放公式，并量化其对数值性能的影响。该问题是自洽的，提供了所有必要的参数、初始条件和度量定义。它遵循了化学动力学（质量作用定律）和刚性常微分方程数值方法的既定原则。\n\n### 1. 未缩放ODE系统的推导\n\n该问题描述了一个包含两个有效反应的三同位素α链：\n1. 3α反应：$3\\, {}^{4}\\mathrm{He} \\rightarrow {}^{12}\\mathrm{C}$\n2. 碳上的α俘获：${}^{12}\\mathrm{C} + {}^{4}\\mathrm{He} \\rightarrow {}^{16}\\mathrm{O}$\n\n状态向量为$\\mathbf{y}(t) = \\left[Y_{\\mathrm{He}}(t), Y_{\\mathrm{C}}(t), Y_{\\mathrm{O}}(t)\\right]^{\\top}$，表示无量纲丰度。这些丰度的时间演化由质量作用定律支配。\n\n设$R_1$为3α反应的速率，$R_2$为α俘获反应的速率。问题陈述，3α反应产生${}^{12}\\mathrm{C}$的产生项为$k_{3\\alpha} Y_{\\mathrm{He}}^{3}$，α俘获产生${}^{16}\\mathrm{O}$的产生项为$k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}$。这意味着由产生引起的速率变化为$\\left.dY_{\\mathrm{C}}/dt\\right|_{\\text{prod},1} = k_{3\\alpha} Y_{\\mathrm{He}}^{3}$和$\\left.dY_{\\mathrm{O}}/dt\\right|_{\\text{prod},2} = k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}$。\n\n基于反应的化学计量关系，我们可以写出完整的ODE系统，$\\mathrm{d}\\mathbf{y}/\\mathrm{d}t = \\mathbf{f}(\\mathbf{y})$：\n\n对于3α反应（$3\\mathrm{He} \\to \\mathrm{C}$），每生成一个${}^{12}\\mathrm{C}$核，就会消耗三个${}^{4}\\mathrm{He}$核。因此：\n$\\frac{\\mathrm{d}Y_{\\mathrm{He}}}{\\mathrm{d}t} \\bigg|_{1} = -3 \\left( \\frac{\\mathrm{d}Y_{\\mathrm{C}}}{\\mathrm{d}t} \\bigg|_{\\text{prod},1} \\right) = -3 k_{3\\alpha} Y_{\\mathrm{He}}^{3}$\n$\\frac{\\mathrm{d}Y_{\\mathrm{C}}}{\\mathrm{d}t} \\bigg|_{1} = +k_{3\\alpha} Y_{\\mathrm{He}}^{3}$\n\n对于α俘获反应（$\\mathrm{C} + \\mathrm{He} \\to \\mathrm{O}$），每生成一个${}^{16}\\mathrm{O}$核，就会消耗一个${}^{12}\\mathrm{C}$核和一个${}^{4}\\mathrm{He}$核。因此：\n$\\frac{\\mathrm{d}Y_{\\mathrm{He}}}{\\mathrm{d}t} \\bigg|_{2} = - \\left( \\frac{\\mathrm{d}Y_{\\mathrm{O}}}{\\mathrm{d}t} \\bigg|_{\\text{prod},2} \\right) = -k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}$\n$\\frac{\\mathrm{d}Y_{\\mathrm{C}}}{\\mathrm{d}t} \\bigg|_{2} = - \\left( \\frac{\\mathrm{d}Y_{\\mathrm{O}}}{\\mathrm{d}t} \\bigg|_{\\text{prod},2} \\right) = -k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}$\n$\\frac{\\mathrm{d}Y_{\\mathrm{O}}}{\\mathrm{d}t} \\bigg|_{2} = +k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}$\n\n合并这些项得到最终的系统：\n$$\n\\frac{\\mathrm{d}Y_{\\mathrm{He}}}{\\mathrm{d}t} = f_1(\\mathbf{y}) = -3 k_{3\\alpha} Y_{\\mathrm{He}}^{3} - k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}\n$$\n$$\n\\frac{\\mathrm{d}Y_{\\mathrm{C}}}{\\mathrm{d}t} = f_2(\\mathbf{y}) = k_{3\\alpha} Y_{\\mathrm{He}}^{3} - k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}\n$$\n$$\n\\frac{\\mathrm{d}Y_{\\mathrm{O}}}{\\mathrm{d}t} = f_3(\\mathbf{y}) = k_{\\alpha C} Y_{\\mathrm{He}} Y_{\\mathrm{C}}\n$$\n\n雅可比矩阵$\\mathbf{J}_{\\mathbf{y}} = \\partial \\mathbf{f} / \\partial \\mathbf{y}$是：\n$$\n\\mathbf{J}_{\\mathbf{y}} = \n\\begin{pmatrix}\n\\frac{\\partial f_1}{\\partial Y_{\\mathrm{He}}}  \\frac{\\partial f_1}{\\partial Y_{\\mathrm{C}}}  \\frac{\\partial f_1}{\\partial Y_{\\mathrm{O}}} \\\\\n\\frac{\\partial f_2}{\\partial Y_{\\mathrm{He}}}  \\frac{\\partial f_2}{\\partial Y_{\\mathrm{C}}}  \\frac{\\partial f_2}{\\partial Y_{\\mathrm{O}}} \\\\\n\\frac{\\partial f_3}{\\partial Y_{\\mathrm{He}}}  \\frac{\\partial f_3}{\\partial Y_{\\mathrm{C}}}  \\frac{\\partial f_3}{\\partial Y_{\\mathrm{O}}}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-9 k_{3\\alpha} Y_{\\mathrm{He}}^{2} - k_{\\alpha C} Y_{\\mathrm{C}}  -k_{\\alpha C} Y_{\\mathrm{He}}  0 \\\\\n3 k_{3\\alpha} Y_{\\mathrm{He}}^{2} - k_{\\alpha C} Y_{\\mathrm{C}}  -k_{\\alpha C} Y_{\\mathrm{He}}  0 \\\\\nk_{\\alpha C} Y_{\\mathrm{C}}  k_{\\alpha C} Y_{\\mathrm{He}}  0\n\\end{pmatrix}\n$$\n\n### 2. 缩放后ODE系统的推导\n\n我们引入缩放后的变量$\\mathbf{x}(\\tau) = \\mathbf{S}^{-1} \\mathbf{y}(t)$和缩放后的时间$\\tau = t / t_{\\mathrm{ref}}$，其中$\\mathbf{S} = \\mathrm{diag}(s_{\\mathrm{He}}, s_{\\mathrm{C}}, s_{\\mathrm{O}})$且$t_{\\mathrm{ref}} = 1 / k_{\\alpha C}$。未缩放的变量为$\\mathbf{y}(t) = \\mathbf{S} \\mathbf{x}(\\tau)$。\n\n使用链式法则，我们变换导数：\n$$\n\\frac{\\mathrm{d}\\mathbf{y}}{\\mathrm{d}t} = \\frac{\\mathrm{d}(\\mathbf{S}\\mathbf{x})}{\\mathrm{d}t} = \\mathbf{S} \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}\\tau} \\frac{\\mathrm{d}\\tau}{\\mathrm{d}t} = \\mathbf{S} \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}\\tau} \\frac{1}{t_{\\mathrm{ref}}}\n$$\n将此代入未缩放的ODE系统$\\mathrm{d}\\mathbf{y}/\\mathrm{d}t = \\mathbf{f}(\\mathbf{y})$：\n$$\n\\frac{\\mathbf{S}}{t_{\\mathrm{ref}}} \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}\\tau} = \\mathbf{f}(\\mathbf{S}\\mathbf{x}) \\implies \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}\\tau} = t_{\\mathrm{ref}} \\mathbf{S}^{-1} \\mathbf{f}(\\mathbf{S}\\mathbf{x})\n$$\n右侧是新的函数$\\mathbf{g}(\\mathbf{x})$。让我们写出其分量，代入$Y_{\\mathrm{He}} = s_{\\mathrm{He}}x_{\\mathrm{He}}$，$Y_{\\mathrm{C}} = s_{\\mathrm{C}}x_{\\mathrm{C}}$，$t_{\\mathrm{ref}} = 1/k_{\\alpha C}$，并定义无量纲比率$\\gamma = k_{3\\alpha}/k_{\\alpha C}$：\n\n$g_1(x) = \\frac{t_{\\mathrm{ref}}}{s_{\\mathrm{He}}} f_1(\\mathbf{S x}) = \\frac{1}{k_{\\alpha C}s_{\\mathrm{He}}} \\left( -3 k_{3\\alpha} (s_{\\mathrm{He}}x_{\\mathrm{He}})^3 - k_{\\alpha C} (s_{\\mathrm{He}}x_{\\mathrm{He}})(s_{\\mathrm{C}}x_{\\mathrm{C}}) \\right) = -3\\gamma \\frac{s_{\\mathrm{He}}^3}{s_{\\mathrm{He}}} x_{\\mathrm{He}}^3 - \\frac{s_{\\mathrm{He}}s_{\\mathrm{C}}}{s_{\\mathrm{He}}} x_{\\mathrm{He}}x_{\\mathrm{C}}$\n$g_2(x) = \\frac{t_{\\mathrm{ref}}}{s_{\\mathrm{C}}} f_2(\\mathbf{S x}) = \\frac{1}{k_{\\alpha C}s_{\\mathrm{C}}} \\left( k_{3\\alpha} (s_{\\mathrm{He}}x_{\\mathrm{He}})^3 - k_{\\alpha C} (s_{\\mathrm{He}}x_{\\mathrm{He}})(s_{\\mathrm{C}}x_{\\mathrm{C}}) \\right) = \\gamma \\frac{s_{\\mathrm{He}}^3}{s_{\\mathrm{C}}} x_{\\mathrm{He}}^3 - \\frac{s_{\\mathrm{He}}s_{\\mathrm{C}}}{s_{\\mathrm{C}}} x_{\\mathrm{He}}x_{\\mathrm{C}}$\n$g_3(x) = \\frac{t_{\\mathrm{ref}}}{s_{\\mathrm{O}}} f_3(\\mathbf{S x}) = \\frac{1}{k_{\\alpha C}s_{\\mathrm{O}}} \\left( k_{\\alpha C} (s_{\\mathrm{He}}x_{\\mathrm{He}})(s_{\\mathrm{C}}x_{\\mathrm{C}}) \\right) = \\frac{s_{\\mathrm{He}}s_{\\mathrm{C}}}{s_{\\mathrm{O}}} x_{\\mathrm{He}}x_{\\mathrm{C}}$\n\n使用指定的缩放常数$s_{\\mathrm{He}}=1$，$s_{\\mathrm{C}}=10^{-6}$和$s_{\\mathrm{O}}=10^{-12}$：\n$$\ng_1(\\mathbf{x}) = -3 \\gamma x_{\\mathrm{He}}^{3} - s_{\\mathrm{C}} x_{\\mathrm{He}} x_{\\mathrm{C}}\n$$\n$$\ng_2(\\mathbf{x}) = \\frac{\\gamma}{s_{\\mathrm{C}}} x_{\\mathrm{He}}^{3} - x_{\\mathrm{He}} x_{\\mathrm{C}}\n$$\n$$\ng_3(\\mathbf{x}) = \\frac{s_{\\mathrm{C}}}{s_{\\mathrm{O}}} x_{\\mathrm{He}} x_{\\mathrm{C}}\n$$\n\n缩放后系统的雅可比矩阵，$\\mathbf{J}_{\\mathbf{x}} = \\partial \\mathbf{g} / \\partial \\mathbf{x}$，是：\n$$\n\\mathbf{J}_{\\mathbf{x}} = \n\\begin{pmatrix}\n-9 \\gamma x_{\\mathrm{He}}^{2} - s_{\\mathrm{C}} x_{\\mathrm{C}}  -s_{\\mathrm{C}} x_{\\mathrm{He}}  0 \\\\\n\\frac{3\\gamma}{s_{\\mathrm{C}}} x_{\\mathrm{He}}^{2} - x_{\\mathrm{C}}  -x_{\\mathrm{He}}  0 \\\\\n\\frac{s_{\\mathrm{C}}}{s_{\\mathrm{O}}} x_{\\mathrm{C}}  \\frac{s_{\\mathrm{C}}}{s_{\\mathrm{O}}} x_{\\mathrm{He}}  0\n\\end{pmatrix}\n$$\n\n### 3. 数值积分与诊断\n\n对于每个测试用例，我们使用BDF方法从$t_0=0$到$t_f$求解未缩放和缩放后的系统。缩放后的系统从$\\tau_0=0$求解到$\\tau_f = t_f/t_{\\mathrm{ref}}$。\n对每次运行计算以下诊断量：\n- **平均和中值步长**：收集接受的步长序列，未缩放运行为$\\Delta t_i$，缩放后运行为$\\Delta \\tau_i$。为了进行比较，将缩放后的步长转换为物理时间：$\\Delta t_i^{\\text{scaled}} = \\Delta \\tau_i \\cdot t_{\\mathrm{ref}}$。然后计算平均值$\\overline{\\Delta t}$和中位数$\\widetilde{\\Delta t}$。\n- **雅可比矩阵条件数**：构造矩阵$\\mathbf{M} = \\mathbf{I} - h \\mathbf{J}$。对于未缩放的运行，$\\mathbf{J}=\\mathbf{J}_{\\mathbf{y}}$且$h=\\widetilde{\\Delta t}^{\\text{unscaled}}$。对于缩放后的运行，$\\mathbf{J}=\\mathbf{J}_{\\mathbf{x}}$且$h=\\widetilde{\\Delta \\tau}^{\\text{scaled}}$。在三个物理时间（$t_0$, $(t_0+t_f)/2$, $t_f$）及其对应的缩放时间点上对矩阵进行评估。在每个时间点计算2-范数条件数$\\kappa_2(\\mathbf{M})$，然后将这三个值取平均。\n- **函数求值次数**：从求解器中获取函数求值的总次数`nfev`。\n\n最后，计算三个无量纲比率以量化缩放的影响：\n- $\\mathcal{R}_{\\kappa} = \\left(\\text{未缩放的平均 } \\kappa_{2}\\right) / \\left(\\text{缩放后的平均 } \\kappa_{2}\\right)$\n- $\\mathcal{R}_{\\Delta t} = \\left(\\text{缩放后的 }\\overline{\\Delta t}\\right) / \\left(\\text{未缩放的 }\\overline{\\Delta t}\\right)$\n- $\\mathcal{R}_{\\mathrm{nfev}} = \\left(\\text{未缩放的 nfev}\\right) / \\left(\\text{缩放后的 nfev}\\right)$\n\n实现将遵循这些推导和步骤。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\n# --- Problem Definition: Unscaled System ---\n\ndef f_unscaled(t, y, k_3a, k_ac):\n    \"\"\"RHS of the unscaled ODE system dy/dt = f(t, y).\"\"\"\n    y_he, y_c, y_o = y[0], y[1], y[2]\n    \n    # Reaction rates based on problem definition\n    term_3a = k_3a * y_he**3\n    term_ac = k_ac * y_he * y_c\n    \n    dy_he_dt = -3.0 * term_3a - term_ac\n    dy_c_dt = term_3a - term_ac\n    dy_o_dt = term_ac\n    \n    return np.array([dy_he_dt, dy_c_dt, dy_o_dt])\n\ndef jac_unscaled(t, y, k_3a, k_ac):\n    \"\"\"Jacobian of the unscaled ODE system.\"\"\"\n    y_he, y_c = y[0], y[1]\n    \n    J = np.zeros((3, 3), dtype=np.float64)\n    \n    # df1/dy\n    J[0, 0] = -9.0 * k_3a * y_he**2 - k_ac * y_c\n    J[0, 1] = -k_ac * y_he\n    \n    # df2/dy\n    J[1, 0] = 3.0 * k_3a * y_he**2 - k_ac * y_c\n    J[1, 1] = -k_ac * y_he\n    \n    # df3/dy\n    J[2, 0] = k_ac * y_c\n    J[2, 1] = k_ac * y_he\n    \n    return J\n\n# --- Problem Definition: Scaled System ---\n\n# Scaling constants are fixed for all test cases\nS_DIAG = np.array([1.0, 1e-6, 1e-12])\nS_HE, S_C, S_O = S_DIAG[0], S_DIAG[1], S_DIAG[2]\n\ndef g_scaled(tau, x, gamma):\n    \"\"\"RHS of the scaled ODE system dx/dtau = g(tau, x).\"\"\"\n    x_he, x_c = x[0], x[1]\n    \n    g1 = -3.0 * gamma * x_he**3 - S_C * x_he * x_c\n    g2 = (gamma / S_C) * x_he**3 - x_he * x_c\n    g3 = (S_C / S_O) * x_he * x_c\n    \n    return np.array([g1, g2, g3])\n\ndef jac_scaled(tau, x, gamma):\n    \"\"\"Jacobian of the scaled ODE system.\"\"\"\n    x_he, x_c = x[0], x[1]\n    \n    J = np.zeros((3, 3), dtype=np.float64)\n    \n    # dg1/dx\n    J[0, 0] = -9.0 * gamma * x_he**2 - S_C * x_c\n    J[0, 1] = -S_C * x_he\n    \n    # dg2/dx\n    J[1, 0] = (3.0 * gamma / S_C) * x_he**2 - x_c\n    J[1, 1] = -x_he\n    \n    # dg3/dx\n    J[2, 0] = (S_C / S_O) * x_c\n    J[2, 1] = (S_C / S_O) * x_he\n    \n    return J\n\ndef run_and_analyze(case_params):\n    \"\"\"\n    Runs both unscaled and scaled simulations for a given case and computes metrics.\n    \"\"\"\n    k_3a, k_ac, tf = case_params\n    y0 = np.array([0.98, 1e-12, 1e-20])\n    t0 = 0.0\n    rtol = 1e-9\n    atol = np.array([1e-18, 1e-18, 1e-18])\n    t_span = [t0, tf]\n    t_eval_points = np.array([t0, (t0 + tf) / 2.0, tf])\n\n    # --- Unscaled Run ---\n    unscaled_sol = solve_ivp(\n        fun=f_unscaled,\n        t_span=t_span,\n        y0=y0,\n        method='BDF',\n        jac=jac_unscaled,\n        dense_output=True,\n        rtol=rtol,\n        atol=atol,\n        args=(k_3a, k_ac)\n    )\n\n    unscaled_steps_t = np.diff(unscaled_sol.t)\n    mean_dt_unscaled = np.mean(unscaled_steps_t) if len(unscaled_steps_t) > 0 else 0\n    median_dt_unscaled = np.median(unscaled_steps_t) if len(unscaled_steps_t) > 0 else 0\n    nfev_unscaled = unscaled_sol.nfev\n\n    y_at_evals = unscaled_sol.sol(t_eval_points)\n    kappas_unscaled = []\n    for i in range(len(t_eval_points)):\n        y_i = y_at_evals[:, i]\n        J = jac_unscaled(t_eval_points[i], y_i, k_3a, k_ac)\n        M = np.identity(3, dtype=np.float64) - median_dt_unscaled * J\n        kappas_unscaled.append(np.linalg.cond(M, 2))\n    mean_kappa_unscaled = np.mean(kappas_unscaled)\n\n    # --- Scaled Run ---\n    t_ref = 1.0 / k_ac\n    gamma = k_3a / k_ac\n    x0 = y0 / S_DIAG\n    tau_span = [t / t_ref for t in t_span]\n    \n    scaled_sol = solve_ivp(\n        fun=g_scaled,\n        t_span=tau_span,\n        y0=x0,\n        method='BDF',\n        jac=jac_scaled,\n        dense_output=True,\n        rtol=rtol,\n        atol=atol, # Using same atol as per problem statement\n        args=(gamma,)\n    )\n\n    scaled_steps_tau = np.diff(scaled_sol.t)\n    mean_dt_scaled = np.mean(scaled_steps_tau * t_ref) if len(scaled_steps_tau) > 0 else 0\n    median_dtau_scaled = np.median(scaled_steps_tau) if len(scaled_steps_tau) > 0 else 0\n    nfev_scaled = scaled_sol.nfev\n\n    tau_eval_points = t_eval_points / t_ref\n    x_at_evals = scaled_sol.sol(tau_eval_points)\n    kappas_scaled = []\n    for i in range(len(tau_eval_points)):\n        x_i = x_at_evals[:, i]\n        J = jac_scaled(tau_eval_points[i], x_i, gamma)\n        M = np.identity(3, dtype=np.float64) - median_dtau_scaled * J\n        kappas_scaled.append(np.linalg.cond(M, 2))\n    mean_kappa_scaled = np.mean(kappas_scaled)\n\n    # --- Compute Ratios ---\n    # Handle potential division by zero if a metric is zero, though unlikely.\n    R_kappa = mean_kappa_unscaled / mean_kappa_scaled if mean_kappa_scaled != 0 else np.inf\n    R_dt = mean_dt_scaled / mean_dt_unscaled if mean_dt_unscaled != 0 else np.inf\n    R_nfev = float(nfev_unscaled) / float(nfev_scaled) if nfev_scaled != 0 else np.inf\n    \n    return [R_kappa, R_dt, R_nfev]\n\ndef solve():\n    \"\"\"Main solver function to run all test cases and print results.\"\"\"\n    # Test cases: [k_3alpha (s^-1), k_alphaC (s^-1), t_f (s)]\n    test_cases = [\n        # Case A\n        (1e-4, 1e3, 1e-2),\n        # Case B\n        (1e-6, 1e5, 1e-5),\n        # Case C\n        (1e-2, 1e2, 1e-1)\n    ]\n    \n    # Use a high precision for numpy printing to match string formatting\n    np.set_printoptions(precision=16)\n\n    all_results = []\n    for case in test_cases:\n        result_metrics = run_and_analyze(case)\n        all_results.append(result_metrics)\n    \n    # Format according to spec: \"[[1.23,0.45,3.67],[...],[...]]\"\n    # str(list) provides the required formatting.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n# This block is for local execution and will not be part of the final XML output.\n# if __name__ == '__main__':\n#     solve()\n```"
        }
    ]
}