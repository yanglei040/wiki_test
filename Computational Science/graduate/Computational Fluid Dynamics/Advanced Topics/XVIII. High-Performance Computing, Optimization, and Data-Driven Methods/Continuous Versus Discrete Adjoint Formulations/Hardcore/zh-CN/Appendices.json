{
    "hands_on_practices": [
        {
            "introduction": "本练习为连续伴随法奠定了理论基础。我们将从第一性原理出发，推导与一个非定常对流扩散问题相关的伴随场的控制方程 ()。通过构造拉格朗日量并应用变分法，你将看到分部积分如何将微分算子从状态变量转移到伴随变量，从而产生一个时间反向传播的新偏微分方程。这个练习对于掌握“先优化后离散”方法，以及理解目标泛函的结构如何决定伴随场的终值条件至关重要。",
            "id": "3304882",
            "problem": "考虑一个有界 Lipschitz 域 $\\Omega \\subset \\mathbb{R}^{d}$（其中 $d \\in \\{1,2,3\\}$）上，在固定时间范围 $[0,T]$ 内的标量非稳态对流扩散过程。状态 $u:\\Omega \\times [0,T] \\to \\mathbb{R}$ 满足以下初边值问题\n$$\n\\partial_{t} u + \\boldsymbol{v}(\\boldsymbol{x},t) \\cdot \\nabla u - \\nabla \\cdot \\left( \\kappa \\nabla u \\right) = q(\\boldsymbol{x},t) \\quad \\text{in } \\Omega \\times (0,T),\n$$\n其齐次 Dirichlet 边界条件为 $u=0$ on $\\partial \\Omega \\times (0,T)$，初始条件为 $u(\\boldsymbol{x},0)=u_{0}(\\boldsymbol{x})$ on $\\Omega$。假设 $\\kappa>0$ 是一个正常数，$\\boldsymbol{v}(\\boldsymbol{x},t)$ 是无散的，即对所有 $(\\boldsymbol{x},t)$ 都有 $\\nabla \\cdot \\boldsymbol{v}(\\boldsymbol{x},t)=0$，并且 $q$ 和 $u_{0}$ 足够光滑，以确保下面所有的形式推导都是合理的。\n\n定义性能泛函\n$$\nJ(u) \\;=\\; \\int_{0}^{T} g\\!\\left(u(\\cdot,t)\\right) \\,\\mathrm{d}t \\;+\\; R\\!\\left(u(\\cdot,T)\\right),\n$$\n其中\n$$\ng\\!\\left(u(\\cdot,t)\\right) \\;=\\; \\int_{\\Omega} \\ell\\!\\left(u(\\boldsymbol{x},t)\\right) \\,\\mathrm{d}\\boldsymbol{x}, \n\\qquad\nR\\!\\left(u(\\cdot,T)\\right) \\;=\\; \\int_{\\Omega} r\\!\\left(u(\\boldsymbol{x},T)\\right) \\,\\mathrm{d}\\boldsymbol{x},\n$$\n并且 $\\ell:\\mathbb{R}\\to\\mathbb{R}$ 和 $r:\\mathbb{R}\\to\\mathbb{R}$ 是连续可微的，其导数分别记为 $\\ell_{u}$ 和 $r_{u}$。\n\n从状态方程的强形式和 $J(u)$ 的定义出发，使用拉格朗日构造和分部积分法，推导伴随场 $\\psi:\\Omega \\times [0,T]\\to \\mathbb{R}$ 的连续伴随偏微分方程及其相关的边界和时间终端条件。假设 $u$ 的 Dirichlet 边界条件是强施加的，因此 $u$ 的相应变分在 $\\partial \\Omega \\times (0,T)$ 上为零。\n\n根据 $J(u)$ 的结构，解释伴随终端条件何时存在或不存在，以及它如何依赖于终端项 $R(u(\\cdot,T))$ 与纯粹的运行项 $g(u(\\cdot,t))$ 的存在。\n\n你的最终答案必须是伴随终端条件 $\\psi(\\boldsymbol{x},T)$ 的闭式解析表达式，用 $r_{u}$ 和 $u(\\boldsymbol{x},T)$ 表示。如果没有终端项 $R$，请对你的表达式进行相应解释。不需要数值计算，也不需要单位。",
            "solution": "该问题要求使用拉格朗日框架，推导与非稳态对流扩散过程相关的连续伴随方程、边界条件和终端条件。目标是确定伴随终端条件的表达式，并解释其对性能泛函 $J(u)$ 的依赖性。\n\n该问题陈述经证实具有科学依据、良定且客观。它代表了在偏微分方程背景下推导伴随系统的变分法的一个标准应用，这是计算科学中灵敏度分析和优化的基石。所有必要信息均已提供，且前提条件一致。因此，我们可以着手求解。\n\n状态方程由下式给出\n$$\n\\mathcal{N}(u) := \\partial_{t} u + \\boldsymbol{v} \\cdot \\nabla u - \\nabla \\cdot \\left( \\kappa \\nabla u \\right) - q = 0 \\quad \\text{in } \\Omega \\times (0,T)\n$$\n其初始条件为 $u(\\boldsymbol{x},0) = u_{0}(\\boldsymbol{x})$，边界条件为 $u|_{\\partial\\Omega \\times (0,T)} = 0$。性能泛函为\n$$\nJ(u) = \\int_{0}^{T} \\int_{\\Omega} \\ell(u(\\boldsymbol{x},t)) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t + \\int_{\\Omega} r(u(\\boldsymbol{x},T)) \\,\\mathrm{d}\\boldsymbol{x}\n$$\n我们引入伴随场 $\\psi(\\boldsymbol{x},t)$ 作为拉格朗日乘子，将状态方程作为约束强制执行。拉格朗日泛函 $\\mathcal{L}(u, \\psi)$ 定义为：\n$$\n\\mathcal{L}(u, \\psi) = J(u) + \\int_{0}^{T} \\int_{\\Omega} \\psi \\, \\mathcal{N}(u) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n$$\n代入 $J(u)$ 和 $\\mathcal{N}(u)$ 的表达式：\n$$\n\\mathcal{L}(u, \\psi) = \\int_{0}^{T} \\int_{\\Omega} \\ell(u) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t + \\int_{\\Omega} r(u(\\cdot,T)) \\,\\mathrm{d}\\boldsymbol{x} + \\int_{0}^{T} \\int_{\\Omega} \\psi \\left( \\partial_{t} u + \\boldsymbol{v} \\cdot \\nabla u - \\nabla \\cdot (\\kappa \\nabla u) - q \\right) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n$$\n为求伴随方程，我们计算 $\\mathcal{L}$ 在任意容许方向 $\\delta u$ 上关于 $u$ 的一阶变分，并令其为零。如果扰动 $\\delta u$ 满足齐次初始和边界条件，即在 $\\Omega$ 上 $\\delta u(\\boldsymbol{x},0) = 0$ 且在 $\\partial\\Omega \\times (0,T)$ 上 $\\delta u = 0$，则该扰动是容许的。\n一阶变分为 $\\delta\\mathcal{L}[\\delta u] = \\frac{\\mathrm{d}}{\\mathrm{d}\\epsilon}\\Big|_{\\epsilon=0} \\mathcal{L}(u+\\epsilon\\delta u, \\psi)$。\n\n性能泛函 $J(u)$ 的变分为：\n$$\n\\delta J = \\int_{0}^{T} \\int_{\\Omega} \\ell_{u}(u) \\delta u \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t + \\int_{\\Omega} r_{u}(u(\\cdot,T)) \\delta u(\\cdot,T) \\,\\mathrm{d}\\boldsymbol{x}\n$$\n约束项的变分为：\n$$\n\\delta \\left( \\int_{0}^{T} \\int_{\\Omega} \\psi \\, \\mathcal{N}(u) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t \\right) = \\int_{0}^{T} \\int_{\\Omega} \\psi \\left( \\partial_{t} \\delta u + \\boldsymbol{v} \\cdot \\nabla \\delta u - \\nabla \\cdot (\\kappa \\nabla \\delta u) \\right) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n$$\n我们对上述表达式中的每一项应用分部积分，将所有微分算子从变分 $\\delta u$ 转移到伴随场 $\\psi$。\n\n1.  **时间导数项：**\n    $$\n    \\int_{0}^{T} \\int_{\\Omega} \\psi \\, \\partial_{t} \\delta u \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t = \\int_{\\Omega} \\left[ \\psi \\delta u \\right]_{t=0}^{t=T} \\,\\mathrm{d}\\boldsymbol{x} - \\int_{0}^{T} \\int_{\\Omega} (\\partial_{t}\\psi) \\delta u \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n    $$\n    因为 $\\delta u(\\boldsymbol{x},0) = 0$，该式变为 $\\int_{\\Omega} \\psi(\\boldsymbol{x},T) \\delta u(\\boldsymbol{x},T) \\,\\mathrm{d}\\boldsymbol{x} - \\int_{0}^{T} \\int_{\\Omega} (\\partial_{t}\\psi) \\delta u \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t$。\n\n2.  **对流项：** 给定无散条件 $\\nabla \\cdot \\boldsymbol{v} = 0$，我们有 $\\psi (\\boldsymbol{v} \\cdot \\nabla \\delta u) = \\psi \\nabla \\cdot (\\delta u \\boldsymbol{v}) = \\nabla \\cdot (\\psi \\delta u \\boldsymbol{v}) - \\delta u (\\boldsymbol{v} \\cdot \\nabla \\psi)$。\n    $$\n    \\int_{0}^{T} \\int_{\\Omega} \\psi (\\boldsymbol{v} \\cdot \\nabla \\delta u) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t = \\int_{0}^{T} \\int_{\\Omega} \\left( \\nabla \\cdot (\\psi \\delta u \\boldsymbol{v}) - \\delta u (\\boldsymbol{v} \\cdot \\nabla \\psi) \\right) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n    $$\n    根据散度定理，$\\int_{\\Omega} \\nabla \\cdot (\\psi \\delta u \\boldsymbol{v}) \\,\\mathrm{d}\\boldsymbol{x} = \\int_{\\partial\\Omega} \\psi \\delta u (\\boldsymbol{v} \\cdot \\boldsymbol{n}) \\,\\mathrm{d}S = 0$，因为在 $\\partial\\Omega$ 上 $\\delta u = 0$。该项简化为 $-\\int_{0}^{T} \\int_{\\Omega} \\delta u (\\boldsymbol{v} \\cdot \\nabla \\psi) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t$。\n\n3.  **扩散项：** 我们应用两次分部积分。\n    $$\n    -\\int_{0}^{T} \\int_{\\Omega} \\psi \\nabla \\cdot (\\kappa \\nabla \\delta u) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t = -\\int_{0}^{T} \\left( \\int_{\\partial\\Omega} \\psi \\kappa (\\nabla\\delta u \\cdot \\boldsymbol{n}) \\,\\mathrm{d}S - \\int_{\\Omega} \\nabla\\psi \\cdot (\\kappa \\nabla\\delta u) \\,\\mathrm{d}\\boldsymbol{x} \\right) \\mathrm{d}t\n    $$\n    对括号中的第二项应用分部积分：\n    $$\n    \\int_{\\Omega} \\nabla\\psi \\cdot (\\kappa \\nabla\\delta u) \\,\\mathrm{d}\\boldsymbol{x} = \\int_{\\partial\\Omega} \\delta u (\\kappa \\nabla\\psi \\cdot \\boldsymbol{n}) \\,\\mathrm{d}S - \\int_{\\Omega} \\delta u \\nabla\\cdot(\\kappa \\nabla\\psi) \\,\\mathrm{d}\\boldsymbol{x}\n    $$\n    由于在 $\\partial\\Omega$ 上 $\\delta u = 0$，新的边界积分为零。合并结果，扩散项变为：\n    $$\n    -\\int_{0}^{T} \\int_{\\partial\\Omega} \\psi \\kappa (\\nabla\\delta u \\cdot \\boldsymbol{n}) \\,\\mathrm{d}S \\,\\mathrm{d}t - \\int_{0}^{T} \\int_{\\Omega} \\delta u \\nabla\\cdot(\\kappa \\nabla\\psi) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t\n    $$\n    为了使变分 $\\delta\\mathcal{L}$ 与 $\\delta u$ 的选择无关，边界项对于任何容许的 $\\delta u$ 都必须为零。由于 $\\nabla\\delta u \\cdot \\boldsymbol{n}$ 在边界上不一定为零，我们必须在 $\\partial\\Omega \\times (0,T)$ 上强制施加齐次 Dirichlet 边界条件 $\\psi=0$。这产生了伴随边界条件。通过这种选择，扩散项简化为 $-\\int_{0}^{T} \\int_{\\Omega} \\delta u \\nabla\\cdot(\\kappa \\nabla\\psi) \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t$。由于 $\\kappa$ 是一个常数，$\\nabla\\cdot(\\kappa \\nabla\\psi) = \\kappa \\nabla^{2}\\psi$。\n\n合并所有项，总变分 $\\delta\\mathcal{L}$ 为：\n$$\n\\delta\\mathcal{L} = \\int_{0}^{T} \\int_{\\Omega} \\left[ \\ell_{u}(u) - \\partial_{t}\\psi - \\boldsymbol{v} \\cdot \\nabla \\psi - \\kappa \\nabla^{2}\\psi \\right] \\delta u \\,\\mathrm{d}\\boldsymbol{x} \\,\\mathrm{d}t + \\int_{\\Omega} \\left[ r_{u}(u(\\cdot,T)) + \\psi(\\boldsymbol{x},T) \\right] \\delta u(\\boldsymbol{x},T) \\,\\mathrm{d}\\boldsymbol{x} = 0\n$$\n根据变分法基本引理，要使 $\\delta\\mathcal{L}$ 对所有容许变分 $\\delta u$ 都为零，被积函数必须为零。这产生了伴随系统：\n- **伴随偏微分方程：** 时空积分中的项必须为零，从而得到 $\\psi$ 的偏微分方程：\n  $$\n  -\\partial_{t}\\psi - \\boldsymbol{v} \\cdot \\nabla \\psi - \\kappa \\nabla^{2}\\psi = -\\ell_{u}(u) \\quad \\text{in } \\Omega \\times (0,T)\n  $$\n- **伴随边界条件：** 从分部积分推导得出：\n  $$\n  \\psi = 0 \\quad \\text{on } \\partial\\Omega \\times (0,T)\n  $$\n- **伴随终端条件：** 最终时刻积分中的项必须为零：\n  $$\n  \\psi(\\boldsymbol{x},T) + r_{u}(u(\\boldsymbol{x},T)) = 0 \\quad \\text{on } \\Omega\n  $$\n  这给出了伴随场 $\\psi$ 的时间终端条件：\n  $$\n  \\psi(\\boldsymbol{x},T) = -r_{u}(u(\\boldsymbol{x},T))\n  $$\n\n伴随偏微分方程是一个终端值问题，因为它是从最终时刻 $t=T$ 指定的条件开始沿时间向后积分的。\n\n这个终端条件的结构直接解答了问题的第二部分。函数 $r_u$ 是终端成本项 $R(u(\\cdot,T)) = \\int_{\\Omega} r(u(\\boldsymbol{x},T)) \\,\\mathrm{d}\\boldsymbol{x}$ 的被积函数的导数。\n- 如果性能泛函 $J(u)$ 包含一个终端成本项 $R(u(\\cdot,T))$，那么 $r(u)$ 是一个非平凡函数。其导数 $r_u(u)$ 通常不为零，从而导致一个非齐次终端条件 $\\psi(\\boldsymbol{x},T) = -r_u(u(\\boldsymbol{x},T))$。\n- 如果性能泛函仅由一个运行成本项组成（即 $R(u(\\cdot,T))=0$），我们可以形式上设定 $r(u) \\equiv 0$。在这种情况下，其导数 $r_u$ 也为零。伴随方程的终端条件简化为一个齐次条件：$\\psi(\\boldsymbol{x},T) = 0$。\n\n因此，终端成本的存在直接在最终时刻为伴随系统提供源项，为时间反向积分提供了“初始”条件。若没有终端成本，则伴随方程的终端条件为零。所要求的最终答案是该终端条件的解析表达式。",
            "answer": "$$\n\\boxed{-r_{u}\\left(u(\\boldsymbol{x},T)\\right)}\n$$"
        },
        {
            "introduction": "在探索了连续框架之后，我们现在将注意力转向离散世界，在这里偏微分方程变成了代数方程组。本练习聚焦于离散伴随算子的精确代数定义 ()。你会发现，对于像有限元法这样的数值方法，标准的矩阵转置并非正确的伴随算子。相反，伴随算子必须是针对由质量矩阵加权的内积来定义，这反映了其底层的函数空间。这项练习是正确实施“先离散后优化”方法的关键，同时也能帮助理解离散伴随算子 $K^{\\dagger}$、原矩阵 $K$ 和质量矩阵 $M$ 之间的关系。",
            "id": "3304955",
            "problem": "考虑一个在具有足够光滑边界的有界域上的线性、定常、标量偏微分方程，该方程在计算流体动力学（CFD）的背景下通过伽辽金有限元法（FEM）进行离散化。设得到的代数系统写作 $K u = f$，其中 $K \\in \\mathbb{R}^{n \\times n}$ 是与弱形式相关的双线性形式所产生的刚度矩阵，而 $M \\in \\mathbb{R}^{n \\times n}$ 是由有限元空间上的 $L^{2}$ 内积导出的对称正定质量矩阵，即对于基函数 $\\{\\phi_{i}\\}_{i=1}^{n}$，$M_{ij} = \\int_{\\Omega} \\phi_{i} \\phi_{j} \\,\\mathrm{d}x$。对于系数向量 $x, y \\in \\mathbb{R}^{n}$，定义 $M$-加权内积为 $\\langle x, y \\rangle_{M} := x^{\\mathsf{T}} M y$。\n\n在离散伴随分析中，将 $K$ 相对于 $M$-加权内积的伴随算子定义为唯一的线性算子 $K^{\\dagger}$，使得对于所有 $x, y \\in \\mathbb{R}^{n}$，都有 $\\langle x, K y \\rangle_{M} = \\langle K^{\\dagger} x, y \\rangle_{M}$。仅使用给定内积下伴随算子的定义性质以及 $M$ 的性质，推导矩阵 $K^{\\dagger}$ 关于 $K$、$M$ 和欧几里得转置的显式表达式。你的最终答案必须是 $K^{\\dagger}$ 关于 $K$ 和 $M$ 的单个闭式解析表达式（不含等式或不等式）。不需要数值舍入，也不涉及单位。",
            "solution": "该问题是有效的，因为它在科学上基于线性代数和数值分析的原理，特别是在有限元法和伴随算子理论的背景下。它提法良好、客观，并包含了获得唯一解所需的所有信息。\n\n目标是推导离散伴随算子 $K^{\\dagger}$ 关于刚度矩阵 $K$、质量矩阵 $M$ 和欧几里得转置运算的显式表达式。出发点是伴随算子 $K^{\\dagger}$ 相对于 $M$-加权内积 $\\langle \\cdot, \\cdot \\rangle_{M}$ 的定义性质。该性质由下式给出：\n$$\n\\langle x, K y \\rangle_{M} = \\langle K^{\\dagger} x, y \\rangle_{M}\n$$\n此关系必须对所有向量 $x, y \\in \\mathbb{R}^{n}$ 成立。\n\n$M$-加权内积的定义为 $\\langle u, v \\rangle_{M} := u^{\\mathsf{T}} M v$，适用于任何向量 $u, v \\in \\mathbb{R}^{n}$。我们将此定义代入伴随算子定义方程的两边。\n\n左侧（LHS）变为：\n$$\n\\langle x, K y \\rangle_{M} = x^{\\mathsf{T}} M (K y)\n$$\n使用矩阵乘法的结合律，可以写成：\n$$\n\\text{LHS} = x^{\\mathsf{T}} M K y\n$$\n右侧（RHS）变为：\n$$\n\\langle K^{\\dagger} x, y \\rangle_{M} = (K^{\\dagger} x)^{\\mathsf{T}} M y\n$$\n为了简化右侧，我们使用矩阵-向量乘积的转置性质，即 $(AB)^{\\mathsf{T}} = B^{\\mathsf{T}} A^{\\mathsf{T}}$。将此应用于项 $(K^{\\dagger} x)^{\\mathsf{T}}$，得到：\n$$\n(K^{\\dagger} x)^{\\mathsf{T}} = x^{\\mathsf{T}} (K^{\\dagger})^{\\mathsf{T}}\n$$\n将此代回右侧的表达式，得到：\n$$\n\\text{RHS} = x^{\\mathsf{T}} (K^{\\dagger})^{\\mathsf{T}} M y\n$$\n现在，我们令左侧和右侧的表达式相等：\n$$\nx^{\\mathsf{T}} M K y = x^{\\mathsf{T}} (K^{\\dagger})^{\\mathsf{T}} M y\n$$\n此方程必须对所有向量 $x \\in \\mathbb{R}^{n}$ 和 $y \\in \\mathbb{R}^{n}$ 成立。如果对于所有的 $x, y$，都有 $x^{\\mathsf{T}} A y = x^{\\mathsf{T}} B y$，那么矩阵 $A$ 和 $B$ 必定相等。因此，我们可以令矩阵乘积相等：\n$$\nM K = (K^{\\dagger})^{\\mathsf{T}} M\n$$\n我们的目标是求解矩阵 $K^{\\dagger}$。问题中指出，$M$ 是质量矩阵，它是对称且正定的。根据定义，正定矩阵是可逆的。因此，我们可以用 $M$ 的逆矩阵（记为 $M^{-1}$）右乘方程的两边：\n$$\n(M K) M^{-1} = ((K^{\\dagger})^{\\mathsf{T}} M) M^{-1}\n$$\n$$\nM K M^{-1} = (K^{\\dagger})^{\\mathsf{T}} (M M^{-1})\n$$\n由于 $M M^{-1} = I$，其中 $I$ 是单位矩阵，方程简化为：\n$$\nM K M^{-1} = (K^{\\dagger})^{\\mathsf{T}}\n$$\n为了得到 $K^{\\dagger}$ 的表达式，我们对该方程两边取转置：\n$$\n(M K M^{-1})^{\\mathsf{T}} = ((K^{\\dagger})^{\\mathsf{T}})^{\\mathsf{T}}\n$$\n矩阵的转置的转置等于原矩阵，所以 $((K^{\\dagger})^{\\mathsf{T}})^{\\mathsf{T}} = K^{\\dagger}$。这得到：\n$$\nK^{\\dagger} = (M K M^{-1})^{\\mathsf{T}}\n$$\n接下来，我们使用矩阵乘积的转置等于其转置矩阵以相反顺序相乘的性质：$(ABC)^{\\mathsf{T}} = C^{\\mathsf{T}} B^{\\mathsf{T}} A^{\\mathsf{T}}$。应用此规则，我们得到：\n$$\nK^{\\dagger} = (M^{-1})^{\\mathsf{T}} K^{\\mathsf{T}} M^{\\mathsf{T}}\n$$\n问题中指出 $M$ 是一个对称矩阵，这意味着 $M^{\\mathsf{T}} = M$。对称矩阵的逆矩阵也是对称的，所以我们有 $(M^{-1})^{\\mathsf{T}} = M^{-1}$。将这些性质代入 $K^{\\dagger}$ 的表达式中：\n$$\nK^{\\dagger} = M^{-1} K^{\\mathsf{T}} M\n$$\n这就是离散伴随矩阵 $K^{\\dagger}$ 关于 $K$、$M$ 和转置运算的最终显式表达式。",
            "answer": "$$\n\\boxed{M^{-1} K^{\\mathsf{T}} M}\n$$"
        },
        {
            "introduction": "最后的这个练习直面核心问题：连续和离散伴随方法是否总能得到相同的灵敏度信息？通过一个精心构建的模型问题 ()，你将分别使用“先优化后离散”（连续伴随）和“先离散后优化”（离散伴随）两种方法计算一个灵敏度梯度。你将证明这两个结果可能不同，并找出这种差异的根源在于目标泛函的离散化方式不一致。这项练习提供了一个至关重要的见解：优化与离散的不可交换性不仅是理论上的奇特现象，在实践中也会带来实实在在的后果。",
            "id": "3304943",
            "problem": "考虑计算流体动力学领域中一个研究生高级课程水平的模型问题，该问题旨在揭示目标泛函的连续伴随梯度与由不一致求积引起的离散化目标函数的梯度之间的差异。\n\n设状态为线性偏微分方程 (PDE) 的解 $u(x; p)$\n$$\n- \\frac{d^{2} u}{dx^{2}}(x; p) \\;=\\; p,\\quad x \\in (0, 1),\n$$\n服从狄利克雷边界条件\n$$\nu(0; p) \\;=\\; 0, \\qquad u(1; p) \\;=\\; 0,\n$$\n其中 $p \\in \\mathbb{R}$ 是一个标量控制参数。连续目标是线性泛函\n$$\nJ(u) \\;=\\; \\int_{0}^{1} u(x; p)\\, dx.\n$$\n对于离散问题，考虑一个具有 $N$ 个内部节点的均匀网格，网格间距为 $h = \\frac{1}{N+1}$，网格点为 $x_{i} = i h$，其中 $i = 1, \\dots, N$。使用标准二阶中心有限差分 (FD) 方法对该偏微分方程进行离散化，得到\n$$\n- \\frac{U_{i-1} - 2 U_{i} + U_{i+1}}{h^{2}} \\;=\\; p, \\qquad i = 1, \\dots, N,\n$$\n其中 $U_{0} = 0$ 且 $U_{N+1} = 0$。通过一个省略了最后一个内部节点的不一致求积来定义离散化目标：\n$$\nJ_{h}(U) \\;=\\; h \\sum_{i=1}^{N-1} U_{i}.\n$$\n\n使用连续伴随方法，推导连续梯度 $\\frac{dJ}{dp}$ 的闭合形式。使用离散伴随方法，对任意整数 $N \\geq 2$ 推导离散梯度 $\\frac{dJ_{h}}{dp}$ 的闭合形式，并明确使用与 FD 离散化和上述 $J_{h}$ 定义相对应的线性代数伴随系统。证明这两个梯度之间的差异仅仅源于 $J_{h}$ 中的不一致求积，并计算精确差值\n$$\n\\Delta(N) \\;=\\; \\frac{dJ}{dp} \\;-\\; \\frac{dJ_{h}}{dp}\n$$\n将其表示为关于 $N$ 的单一闭合形式解析表达式。将最终答案表示为关于 $N$ 的简化解析表达式。不要对结果进行四舍五入。无需单位。",
            "solution": "问题陈述经核实具有科学依据、适定、客观且完整。它代表了优化计算方法领域的一个标准教学问题，适合进行严格分析。我们开始求解。\n\n目标是计算目标泛函关于控制参数 $p$ 的连续梯度与离散梯度之间的差值 $\\Delta(N) = \\frac{dJ}{dp} - \\frac{dJ_{h}}{dp}$。\n\n首先，我们将使用连续伴随方法求出连续梯度 $\\frac{dJ}{dp}$。\n状态方程是域 $x \\in (0, 1)$ 上的泊松方程：\n$$ - \\frac{d^{2} u}{dx^{2}}(x; p) = p $$\n边界条件为齐次狄利克雷边界条件 $u(0; p) = 0$ 和 $u(1; p) = 0$。\n目标泛函为：\n$$ J(u) = \\int_{0}^{1} u(x; p)\\, dx $$\n为求梯度 $\\frac{dJ}{dp}$，我们引入拉格朗日量 $\\mathcal{L}$，通过使用伴随函数 $\\lambda(x)$ 作为拉格朗日乘子，用状态方程增广目标泛函：\n$$ \\mathcal{L}(u, \\lambda, p) = J(u) - \\int_{0}^{1} \\lambda(x) \\left( - \\frac{d^{2} u}{dx^{2}} - p \\right) dx $$\n为了使拉格朗日量关于状态的梯度 $\\frac{\\delta \\mathcal{L}}{\\delta u}$ 对任意容许变分 $\\delta u$ 都为零，我们必须找到伴随方程。\n$$ \\frac{\\delta \\mathcal{L}}{\\delta u} \\cdot \\delta u = \\int_{0}^{1} \\delta u(x) \\,dx - \\int_{0}^{1} \\lambda(x) \\left( - \\frac{d^{2} (\\delta u)}{dx^{2}} \\right) dx = 0 $$\n对第二项进行两次分部积分，我们得到：\n$$ -\\int_{0}^{1} \\lambda \\frac{d^{2} (\\delta u)}{dx^{2}} dx = - \\left[ \\lambda \\frac{d(\\delta u)}{dx} \\right]_{0}^{1} + \\left[ \\frac{d\\lambda}{dx} \\delta u \\right]_{0}^{1} - \\int_{0}^{1} \\frac{d^{2}\\lambda}{dx^{2}} \\delta u \\, dx $$\n变分 $\\delta u$ 必须满足与 $u$ 相同的齐次边界条件，因此 $\\delta u(0) = 0$ 且 $\\delta u(1) = 0$。通过对伴随变量 $\\lambda$ 也施加齐次边界条件，即 $\\lambda(0) = 0$ 和 $\\lambda(1) = 0$，所有边界项都消失了。驻值条件变为：\n$$ \\int_{0}^{1} \\left( 1 - \\frac{d^{2}\\lambda}{dx^{2}} \\right) \\delta u(x) \\,dx = 0 $$\n由于此式必须对所有容许变分 $\\delta u$ 成立，被积函数必须为零，这便给出了伴随方程：\n$$ - \\frac{d^{2}\\lambda}{dx^{2}} = 1, \\quad x \\in (0, 1) $$\n边界条件为 $\\lambda(0) = 0$ 和 $\\lambda(1) = 0$。这是一个关于 $\\lambda$ 的泊松方程。积分两次并应用边界条件，可得到解：\n$$ \\lambda(x) = \\frac{1}{2}x(1-x) $$\n$J$ 关于 $p$ 的全导数就是拉格朗日量关于 $p$ 的偏导数，因为根据伴随方程的构造，涉及状态变量导数的项会消失：\n$$ \\frac{dJ}{dp} = \\frac{\\partial \\mathcal{L}}{\\partial p} = \\frac{\\partial}{\\partial p} \\int_{0}^{1} \\lambda(x) p \\, dx = \\int_{0}^{1} \\lambda(x) \\, dx $$\n代入 $\\lambda(x)$ 的表达式并积分：\n$$ \\frac{dJ}{dp} = \\int_{0}^{1} \\frac{1}{2}x(1-x) \\, dx = \\frac{1}{2} \\left[ \\frac{x^2}{2} - \\frac{x^3}{3} \\right]_{0}^{1} = \\frac{1}{2} \\left( \\frac{1}{2} - \\frac{1}{3} \\right) = \\frac{1}{12} $$\n因此，连续梯度为 $\\frac{dJ}{dp} = \\frac{1}{12}$。\n\n接下来，我们使用离散伴随方法推导离散梯度 $\\frac{dJ_{h}}{dp}$。\n离散状态方程由以下有限差分系统给出：\n$$ - \\frac{U_{i-1} - 2 U_{i} + U_{i+1}}{h^{2}} = p, \\quad i = 1, \\dots, N $$\n其中 $U_{0} = 0$ 且 $U_{N+1} = 0$。这可以写成矩阵形式 $A_{h} U = p \\mathbf{1}$，其中 $U = [U_1, \\dots, U_N]^T$，$\\mathbf{1}$ 是全一向量，$A_h$ 是 $N \\times N$ 的对称正定矩阵：\n$$ A_h = \\frac{1}{h^2} \\begin{pmatrix} 2  -1   \\\\ -1  2  -1  \\\\  \\ddots  \\ddots  \\ddots \\\\   -1  2  -1 \\\\    -1  2 \\end{pmatrix} $$\n离散化目标泛函为：\n$$ J_{h}(U) = h \\sum_{i=1}^{N-1} U_{i} $$\n这可以写成向量形式 $J_h(U) = c_h^T U$，其中 $c_h = h [1, 1, \\dots, 1, 0]^T$。该求积是不一致的，因为一个一致的梯形法则会包含节点 $U_N$。\n离散拉格朗日量为：\n$$ \\mathcal{L}_h(U, \\Lambda, p) = J_h(U) - \\Lambda^T (A_h U - p \\mathbf{1}) = c_h^T U - \\Lambda^T (A_h U - p \\mathbf{1}) $$\n其中 $\\Lambda$ 是离散伴随向量。通过将 $\\mathcal{L}_h$ 关于 $U$ 的梯度设为零，可得到离散伴随方程：\n$$ \\nabla_U \\mathcal{L}_h = c_h - A_h^T \\Lambda = 0 \\implies A_h \\Lambda = c_h $$\n因为 $A_h$ 是对称的。\n离散梯度 $\\frac{dJ_h}{dp}$ 是 $\\mathcal{L}_h$ 关于 $p$ 的偏导数：\n$$ \\frac{dJ_h}{dp} = \\frac{\\partial \\mathcal{L}_h}{\\partial p} = \\Lambda^T \\mathbf{1} = \\sum_{i=1}^{N} \\Lambda_i $$\n为了求这个和，我们可以求解 $\\Lambda = A_h^{-1} c_h$ 并对其分量求和。然而，一个更直接的方法是直接对 $J_h$ 的表达式关于 $p$ 求导。首先，我们求出离散状态 $U$。\n$U = A_h^{-1} (p \\mathbf{1}) = p (A_h^{-1} \\mathbf{1})$。\n向量 $V = A_h^{-1} \\mathbf{1}$ 是离散泊松方程 $A_h V = \\mathbf{1}$ 的解。连续问题 $-v''=1$（边界条件为 $v(0)=v(1)=0$）的解为 $v(x) = \\frac{1}{2}x(1-x)$。由于二阶有限差分格式对二次多项式是精确的，离散解就是精确解在网格点上的取值：$V_i = v(x_i) = \\frac{1}{2}x_i(1-x_i)$。\n因此，$U_i = p V_i = p \\frac{1}{2} x_i (1-x_i)$。\n现在我们将此代入 $J_h$：\n$$ J_h(p) = h \\sum_{i=1}^{N-1} U_i = h \\sum_{i=1}^{N-1} p \\frac{1}{2} x_i(1-x_i) $$\n那么梯度为：\n$$ \\frac{dJ_h}{dp} = h \\sum_{i=1}^{N-1} \\frac{1}{2} x_i(1-x_i) = \\frac{h}{2} \\sum_{i=1}^{N-1} (ih - i^2h^2) = \\frac{h^2}{2} \\sum_{i=1}^{N-1} i - \\frac{h^3}{2} \\sum_{i=1}^{N-1} i^2 $$\n使用幂和公式 $\\sum_{i=1}^{k} i = \\frac{k(k+1)}{2}$ 和 $\\sum_{i=1}^{k} i^2 = \\frac{k(k+1)(2k+1)}{6}$，其中 $k=N-1$：\n$$ \\frac{dJ_h}{dp} = \\frac{h^2}{2} \\frac{(N-1)N}{2} - \\frac{h^3}{2} \\frac{(N-1)N(2(N-1)+1)}{6} = \\frac{h^2 N(N-1)}{4} - \\frac{h^3 N(N-1)(2N-1)}{12} $$\n代入 $h = \\frac{1}{N+1}$：\n$$ \\frac{dJ_h}{dp} = \\frac{N(N-1)}{4(N+1)^2} - \\frac{N(N-1)(2N-1)}{12(N+1)^3} = \\frac{3N(N-1)(N+1) - N(N-1)(2N-1)}{12(N+1)^3} $$\n$$ = \\frac{N(N-1) [3(N+1)-(2N-1)]}{12(N+1)^3} = \\frac{N(N-1)(3N+3-2N+1)}{12(N+1)^3} = \\frac{N(N-1)(N+4)}{12(N+1)^3} $$\n这表明由于离散化误差和不一致求积的共同作用，连续梯度与离散梯度之间的差值非零。\n\n最后，我们计算精确差值 $\\Delta(N)$：\n$$ \\Delta(N) = \\frac{dJ}{dp} - \\frac{dJ_h}{dp} = \\frac{1}{12} - \\frac{N(N-1)(N+4)}{12(N+1)^3} $$\n$$ \\Delta(N) = \\frac{1}{12} \\left[ 1 - \\frac{N(N-1)(N+4)}{(N+1)^3} \\right] = \\frac{(N+1)^3 - N(N^2+3N-4)}{12(N+1)^3} $$\n我们展开分子中的各项：\n$(N+1)^3 = N^3 + 3N^2 + 3N + 1$\n$N(N^2+3N-4) = N^3 + 3N^2 - 4N$\n差为 $(N^3 + 3N^2 + 3N + 1) - (N^3 + 3N^2 - 4N) = 7N+1$。\n因此，精确差值为：\n$$ \\Delta(N) = \\frac{7N+1}{12(N+1)^3} $$\n当 $N \\to \\infty$ 时，$h \\to 0$，我们可以看到 $\\frac{dJ_h}{dp} \\to \\frac{N^3}{12N^3} = \\frac{1}{12}$，因此离散梯度收敛于连续梯度。差值 $\\Delta(N)$ 的阶为 $O(N/N^3) = O(1/N^2) = O(h^2)$。求积中的不一致性引入了一个误差项，其阶数与一致格式下梯度的离散化误差相同。",
            "answer": "$$ \\boxed{\\frac{7N+1}{12(N+1)^3}} $$"
        }
    ]
}