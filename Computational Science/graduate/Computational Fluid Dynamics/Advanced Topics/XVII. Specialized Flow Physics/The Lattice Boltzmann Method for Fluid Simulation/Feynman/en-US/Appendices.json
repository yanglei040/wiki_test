{
    "hands_on_practices": [
        {
            "introduction": "The heart of the Lattice Boltzmann Method is the equilibrium distribution function, $f_i^{\\text{eq}}$, which provides the crucial link between the microscopic particle kinetics and the macroscopic fluid dynamics we aim to simulate. Before building a full solver, it is essential to understand how to work with this function directly. This practice challenges you to derive the standard second-order form of $f_i^{\\text{eq}}$ from fundamental moment-matching principles and then apply it to a specific fluid state, verifying that the macroscopic density and velocity are correctly recovered .",
            "id": "3375057",
            "problem": "Consider the isothermal Lattice Boltzmann Method (LBM) on the two-dimensional nine-velocity lattice (D2Q9) for a single-component, weakly compressible fluid. The discrete velocities are\n$$\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1),$$\nwith lattice weights\n$$w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36},$$\nand lattice speed of sound\n$$c_s^{2} = \\frac{1}{3}.$$\nAssume $|\\boldsymbol{u}|/c_s \\ll 1$ and use the moment-matching principle so that the zeroth, first, and second discrete velocity moments of the equilibrium populations reproduce the isothermal compressible Euler-level hydrodynamic fields to second order in the Mach number. Specifically, require that\n- the zeroth moment recovers the mass density $ \\rho $,\n- the first moment recovers the momentum density $ \\rho \\boldsymbol{u} $,\n- the second moment recovers the isothermal pressure tensor $ \\boldsymbol{\\Pi}^{\\text{eq}} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u} $.\n\nUsing only these constraints, derive the general form of the D2Q9 equilibrium populations $f_i^{\\text{eq}}(\\rho,\\boldsymbol{u})$ consistent with the above moment conditions up to second order in $|\\boldsymbol{u}|$. Then, for the specific state\n$$\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right),$$\ncompute all nine equilibrium populations $f_i^{\\text{eq}}$ for $i=0,\\dots,8$. Finally, verify the recovery of density and momentum by explicitly computing $\\sum_{i=0}^{8} f_i^{\\text{eq}}$ and $\\sum_{i=0}^{8} f_i^{\\text{eq}}\\boldsymbol{c}_i$, and report the scalar $\\sum_{i} f_i^{\\text{eq}}$ and the two components of $\\sum_{i} f_i^{\\text{eq}}\\boldsymbol{c}_i$.\n\nExpress the final answer as a single row matrix containing the $9$ values $f_0^{\\text{eq}},f_1^{\\text{eq}},\\dots,f_8^{\\text{eq}}$, followed by $\\sum_{i} f_i^{\\text{eq}}$, $\\left(\\sum_{i} f_i^{\\text{eq}} c_{ix}\\right)$, and $\\left(\\sum_{i} f_i^{\\text{eq}} c_{iy}\\right)$, in that order. No rounding is required and no units should be included in the final answer.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n-   **Model**: Isothermal Lattice Boltzmann Method (LBM) on a two-dimensional nine-velocity (D2Q9) lattice for a single-component, weakly compressible fluid.\n-   **Discrete Velocities $\\boldsymbol{c}_i$**:\n    $\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1)$, in lattice units where $\\Delta x = 1$ and $\\Delta t = 1$.\n-   **Lattice Weights $w_i$**:\n    $w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36}$.\n-   **Lattice Speed of Sound $c_s$**:\n    $c_s^{2} = \\frac{1}{3}$.\n-   **Low Mach Number Condition**: $|\\boldsymbol{u}|/c_s \\ll 1$.\n-   **Moment Constraints on Equilibrium Populations $f_i^{\\text{eq}}$**:\n    1.  Zeroth moment (density): $\\sum_{i=0}^{8} f_i^{\\text{eq}} = \\rho$.\n    2.  First moment (momentum): $\\sum_{i=0}^{8} f_i^{\\text{eq}} \\boldsymbol{c}_i = \\rho \\boldsymbol{u}$.\n    3.  Second moment (momentum flux): $\\sum_{i=0}^{8} f_i^{\\text{eq}} \\boldsymbol{c}_i \\boldsymbol{c}_i = \\boldsymbol{\\Pi}^{\\text{eq}} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u}$.\n-   **Specific State**:\n    $\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated based on the criteria of being scientifically grounded, well-posed, and objective.\n\n-   **Scientific Grounding**: The problem is a standard derivation and application within the field of computational fluid dynamics, specifically concerning the Lattice Boltzmann Method. The D2Q9 model, its weights, speed of sound, and the moment-matching conditions for the equilibrium distribution are fundamental, well-established concepts in LBM theory. The problem is scientifically sound.\n-   **Well-Posedness**: The problem provides all necessary constraints and data to derive the general form of the equilibrium distribution function up to the specified order and to compute its specific values. The moment conditions uniquely determine the polynomial coefficients of the expansion of $f_i^{\\text{eq}}$ in velocity. The specific values of density and velocity are well-defined. The problem is self-contained and uniquely solvable.\n-   **Objectivity**: The problem is stated in precise mathematical language, free from any subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a standard, well-posed problem in computational physics that adheres to all validation criteria. A full solution will be provided.\n\n### Derivation of the Equilibrium Distribution Function\n\nThe problem requires deriving the form of $f_i^{\\text{eq}}(\\rho, \\boldsymbol{u})$ from the moment conditions. A standard way to achieve this is through a truncated expansion in orthogonal polynomials, which for the LBM case are lattice-based Hermite polynomials. We seek an expansion of $f_i^{\\text{eq}}$ in powers of the macroscopic velocity $\\boldsymbol{u}$ up to second order, which is consistent with the low Mach number assumption.\n\nLet's expand $f_i^{\\text{eq}}$ as:\n$$f_i^{\\text{eq}} = w_i \\left( A + B_{\\alpha} c_{i\\alpha} + C_{\\alpha\\beta} c_{i\\alpha} c_{i\\beta} + D_{\\alpha\\beta} \\delta_{\\alpha\\beta} \\right)$$\nwhere repeated Greek indices imply summation over spatial dimensions ($x, y$). The coefficients $A$, $B_\\alpha$, $C_{\\alpha\\beta}$, and $D_{\\alpha\\beta}$ are functions of $\\rho$ and $\\boldsymbol{u}$. To simplify, we'll express them as polynomials in $u$.\nA more direct method is to use a Grad-type moment expansion for $f_i^{\\text{eq}}$ in terms of its moments. For a second-order expansion, this has the general form:\n$$f_i^{\\text{eq}} = w_i \\left( a^{(0)} + \\frac{a_{\\alpha}^{(1)} c_{i\\alpha}}{c_s^2} + \\frac{a_{\\alpha\\beta}^{(2)} (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right)$$\nwhere $a^{(0)}$, $a_\\alpha^{(1)}$, and $a_{\\alpha\\beta}^{(2)}$ are the zeroth, first, and second raw moments of $f_i^{\\text{eq}}$ with respect to velocity.\nThe hydrodynamic moments are given by the constraints:\n-   $a^{(0)} = \\sum_i f_i^{\\text{eq}} = \\rho$\n-   $a_{\\alpha}^{(1)} = \\sum_i f_i^{\\text{eq}} c_{i\\alpha} = \\rho u_\\alpha$\n-   $\\sum_i f_i^{\\text{eq}} c_{i\\alpha}c_{i\\beta} = \\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$\n\nFrom the expansion itself, we can also compute the second moment:\n$$ \\sum_i f_i^{\\text{eq}} c_{i\\alpha} c_{i\\beta} = \\sum_i w_i \\left( a^{(0)} + \\frac{a_{\\gamma}^{(1)} c_{i\\gamma}}{c_s^2} + \\frac{a_{\\gamma\\delta}^{(2)} (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta})}{2c_s^4} \\right) c_{i\\alpha} c_{i\\beta} $$\nUsing the lattice isotropy properties $\\sum_i w_i c_{i\\alpha} c_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta}$ and $\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma} = 0$, we get:\n$$ \\sum_i f_i^{\\text{eq}} c_{i\\alpha} c_{i\\beta} = a^{(0)} c_s^2 \\delta_{\\alpha\\beta} + \\frac{a_{\\gamma\\delta}^{(2)}}{2c_s^4} \\sum_i w_i (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta}) c_{i\\alpha}c_{i\\beta} $$\nThe second term contains fourth-order moments. Since we are matching moments up to second order in $\\boldsymbol{u}$, the term $a_{\\gamma\\delta}^{(2)}$ is itself of order $O(|\\boldsymbol{u}|^2)$. The expansion for $\\sum f_i^{\\text{eq}} c_{i\\alpha}c_{i\\beta}$ is effectively $\\rho c_s^2 \\delta_{\\alpha\\beta} + a_{\\alpha\\beta}^{(2)}$.\nBy comparing with the constraint $\\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$, we can identify the second-order moment coefficient as $a_{\\alpha\\beta}^{(2)} = \\rho u_\\alpha u_\\beta$.\n\nSubstituting $a^{(0)}=\\rho$, $a_{\\alpha}^{(1)}=\\rho u_\\alpha$, and $a_{\\alpha\\beta}^{(2)}=\\rho u_\\alpha u_\\beta$ back into the expansion for $f_i^{\\text{eq}}$:\n$$ f_i^{\\text{eq}} = w_i \\left( \\rho + \\frac{(\\rho u_\\alpha) c_{i\\alpha}}{c_s^2} + \\frac{(\\rho u_\\alpha u_\\beta) (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right) $$\nFactoring out $\\rho$:\n$$ f_i^{\\text{eq}} = w_i \\rho \\left( 1 + \\frac{u_\\alpha c_{i\\alpha}}{c_s^2} + \\frac{u_\\alpha u_\\beta c_{i\\alpha}c_{i\\beta} - u_\\alpha u_\\beta c_s^2 \\delta_{\\alpha\\beta}}{2c_s^4} \\right) $$\nIn vector notation, this is:\n$$ f_i^{\\text{eq}}(\\rho, \\boldsymbol{u}) = w_i \\rho \\left( 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_s^2} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2}{2c_s^4} - \\frac{|\\boldsymbol{u}|^2}{2c_s^2} \\right) $$\nThis is the general form of the D2Q9 equilibrium distribution function consistent with the moment conditions up to second order in $|\\boldsymbol{u}|$.\n\n### Calculation of Specific Equilibrium Populations\n\nWe are given $\\rho = \\frac{5}{4}$, $\\boldsymbol{u} = \\left(\\frac{1}{6}, -\\frac{1}{9}\\right)$, and $c_s^2=\\frac{1}{3}$.\nWe substitute these into the derived formula. First, calculate the common terms:\n$$ \\frac{1}{c_s^2} = 3 $$\n$$ \\frac{1}{2c_s^4} = \\frac{9}{2} $$\n$$ |\\boldsymbol{u}|^2 = u_x^2 + u_y^2 = \\left(\\frac{1}{6}\\right)^2 + \\left(-\\frac{1}{9}\\right)^2 = \\frac{1}{36} + \\frac{1}{81} = \\frac{9+4}{324} = \\frac{13}{324} $$\nThe expression becomes:\n$$ f_i^{\\text{eq}} = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{3}{2}\\frac{13}{324} \\right) = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216} \\right) $$\nNow, we compute $\\boldsymbol{c}_i \\cdot \\boldsymbol{u}$ for each $i$:\n$\\boldsymbol{c}_0 \\cdot \\boldsymbol{u} = 0$,\n$\\boldsymbol{c}_1 \\cdot \\boldsymbol{u} = \\frac{1}{6}$,\n$\\boldsymbol{c}_2 \\cdot \\boldsymbol{u} = -\\frac{1}{9}$,\n$\\boldsymbol{c}_3 \\cdot \\boldsymbol{u} = -\\frac{1}{6}$,\n$\\boldsymbol{c}_4 \\cdot \\boldsymbol{u} = \\frac{1}{9}$,\n$\\boldsymbol{c}_5 \\cdot \\boldsymbol{u} = \\frac{1}{6}-\\frac{1}{9} = \\frac{1}{18}$,\n$\\boldsymbol{c}_6 \\cdot \\boldsymbol{u} = -\\frac{1}{6}-\\frac{1}{9} = -\\frac{5}{18}$,\n$\\boldsymbol{c}_7 \\cdot \\boldsymbol{u} = -\\frac{1}{6}+\\frac{1}{9} = -\\frac{1}{18}$,\n$\\boldsymbol{c}_8 \\cdot \\boldsymbol{u} = \\frac{1}{6}+\\frac{1}{9} = \\frac{5}{18}$.\n\nLet $S_i = 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216}$. We compute $f_i^{\\text{eq}} = w_i (\\frac{5}{4}) S_i$:\n-   $i=0$: $S_0 = 1 - \\frac{13}{216} = \\frac{203}{216}$. $f_0^{\\text{eq}} = \\frac{4}{9} \\frac{5}{4} \\frac{203}{216} = \\frac{5}{9} \\frac{203}{216} = \\frac{1015}{1944}$.\n-   $i=1$: $S_1 = 1 + 3(\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 + \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216+108+27-13}{216} = \\frac{338}{216} = \\frac{169}{108}$. $f_1^{\\text{eq}} = \\frac{1}{9} \\frac{5}{4} \\frac{169}{108} = \\frac{5}{36} \\frac{169}{108} = \\frac{845}{3888}$.\n-   $i=2$: $S_2 = 1 + 3(-\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 - \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216-72+12-13}{216} = \\frac{143}{216}$. $f_2^{\\text{eq}} = \\frac{1}{9} \\frac{5}{4} \\frac{143}{216} = \\frac{5}{36} \\frac{143}{216} = \\frac{715}{7776}$.\n-   $i=3$: $S_3 = 1 + 3(-\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 - \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216-108+27-13}{216} = \\frac{122}{216} = \\frac{61}{108}$. $f_3^{\\text{eq}} = \\frac{1}{9} \\frac{5}{4} \\frac{61}{108} = \\frac{5}{36} \\frac{61}{108} = \\frac{305}{3888}$.\n-   $i=4$: $S_4 = 1 + 3(\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 + \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216+72+12-13}{216} = \\frac{287}{216}$. $f_4^{\\text{eq}} = \\frac{1}{9} \\frac{5}{4} \\frac{287}{216} = \\frac{5}{36} \\frac{287}{216} = \\frac{1435}{7776}$.\n-   $i=5$: $S_5 = 1 + 3(\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 + \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216+36+3-13}{216} = \\frac{242}{216} = \\frac{121}{108}$. $f_5^{\\text{eq}} = \\frac{1}{36} \\frac{5}{4} \\frac{121}{108} = \\frac{5}{144} \\frac{121}{108} = \\frac{605}{15552}$.\n-   $i=6$: $S_6 = 1 + 3(-\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 - \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216-180+75-13}{216} = \\frac{98}{216} = \\frac{49}{108}$. $f_6^{\\text{eq}} = \\frac{1}{36} \\frac{5}{4} \\frac{49}{108} = \\frac{5}{144} \\frac{49}{108} = \\frac{245}{15552}$.\n-   $i=7$: $S_7 = 1 + 3(-\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 - \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216-36+3-13}{216} = \\frac{170}{216} = \\frac{85}{108}$. $f_7^{\\text{eq}} = \\frac{1}{36} \\frac{5}{4} \\frac{85}{108} = \\frac{5}{144} \\frac{85}{108} = \\frac{425}{15552}$.\n-   $i=8$: $S_8 = 1 + 3(\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 + \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216+180+75-13}{216} = \\frac{458}{216} = \\frac{229}{108}$. $f_8^{\\text{eq}} = \\frac{1}{36} \\frac{5}{4} \\frac{229}{108} = \\frac{5}{144} \\frac{229}{108} = \\frac{1145}{15552}$.\n\n### Verification of Moment Recovery\n\n**Density:** The sum $\\sum_{i=0}^{8} f_i^{\\text{eq}}$ must equal $\\rho = \\frac{5}{4}$. By construction, the analytical sum of the formula for $f_i^{\\text{eq}}$ yields $\\rho$. Let's verify with the numerical values. Using a common denominator of $15552$:\n$$ \\sum f_i^{\\text{eq}} = \\frac{8120 + 3380 + 1430 + 1220 + 2870 + 605 + 245 + 425 + 1145}{15552} = \\frac{19440}{15552} = \\frac{5 \\times 3888}{4 \\times 3888} = \\frac{5}{4} $$\nThe density is correctly recovered.\n\n**Momentum:** The sum $\\sum_{i=0}^{8} f_i^{\\text{eq}} \\boldsymbol{c}_i$ must equal $\\rho\\boldsymbol{u} = \\frac{5}{4}(\\frac{1}{6}, -\\frac{1}{9}) = (\\frac{5}{24}, -\\frac{5}{36})$.\n-   x-component: $\\sum f_i^{\\text{eq}} c_{ix} = f_1^{\\text{eq}}-f_3^{\\text{eq}}+f_5^{\\text{eq}}-f_6^{\\text{eq}}-f_7^{\\text{eq}}+f_8^{\\text{eq}}$\n$$ \\sum f_i^{\\text{eq}} c_{ix} = \\frac{3380 - 1220 + 605 - 245 - 425 + 1145}{15552} = \\frac{3240}{15552} = \\frac{5 \\times 648}{24 \\times 648} = \\frac{5}{24} $$\n-   y-component: $\\sum f_i^{\\text{eq}} c_{iy} = f_2^{\\text{eq}}-f_4^{\\text{eq}}+f_5^{\\text{eq}}+f_6^{\\text{eq}}-f_7^{\\text{eq}}-f_8^{\\text{eq}}$\n$$ \\sum f_i^{\\text{eq}} c_{iy} = \\frac{1430 - 2870 + 605 + 245 - 425 - 1145}{15552} = \\frac{-2160}{15552} = \\frac{-5 \\times 432}{36 \\times 432} = -\\frac{5}{36} $$\nThe momentum is also correctly recovered. The computed values are correct.\nSo, the twelve quantities for the final answer are:\n$f_0^{\\text{eq}} = \\frac{1015}{1944}$, $f_1^{\\text{eq}} = \\frac{845}{3888}$, $f_2^{\\text{eq}} = \\frac{715}{7776}$, $f_3^{\\text{eq}} = \\frac{305}{3888}$, $f_4^{\\text{eq}} = \\frac{1435}{7776}$, $f_5^{\\text{eq}} = \\frac{605}{15552}$, $f_6^{\\text{eq}} = \\frac{245}{15552}$, $f_7^{\\text{eq}} = \\frac{425}{15552}$, $f_8^{\\text{eq}} = \\frac{1145}{15552}$, $\\sum f_i^{\\text{eq}} = \\frac{5}{4}$, $\\sum (f_i^{\\text{eq}} c_{ix}) = \\frac{5}{24}$, $\\sum (f_i^{\\text{eq}} c_{iy}) = -\\frac{5}{36}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1015}{1944} & \\frac{845}{3888} & \\frac{715}{7776} & \\frac{305}{3888} & \\frac{1435}{7776} & \\frac{605}{15552} & \\frac{245}{15552} & \\frac{425}{15552} & \\frac{1145}{15552} & \\frac{5}{4} & \\frac{5}{24} & -\\frac{5}{36} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "This exercise guides you through the process of building your first complete LBM solver from the ground up. You will implement a D1Q3 model to simulate transient heat conduction, a classic problem for which a precise analytical solution exists for verification . By coding the core LBM algorithm—initialization, collision, streaming, and boundary conditions—and comparing your results to the exact solution, you will gain invaluable hands-on experience in the practical aspects of LBM and the critical process of code validation.",
            "id": "3375033",
            "problem": "Design and implement a complete numerical solver in code to simulate one-dimensional transient heat conduction using the Lattice Boltzmann Method (LBM). Use a one-dimensional three-velocity lattice (D1Q3) for both an isothermal momentum solver and a thermal energy solver, where the energy lattice is coupled to the momentum field through the advective term. Validate the simulated temperature profiles against the analytical solution of the one-dimensional heat equation for a single Fourier mode in a periodic domain. All quantities are to be treated in nondimensional lattice units with spatial step $\\Delta x = 1$ and time step $\\Delta t = 1$, so no physical units are required.\n\nStart from the following well-established bases:\n- The kinetic transport with Bhatnagar–Gross–Krook (BGK) relaxation: the continuous Boltzmann–BGK equation for a distribution function $f$ is given by $\\partial_t f + \\boldsymbol{\\xi} \\cdot \\nabla f = -\\frac{1}{\\tau}(f - f^{\\text{eq}})$, where $\\boldsymbol{\\xi}$ is the molecular velocity and $\\tau$ is the relaxation time.\n- The discrete-velocity formulation for the Lattice Boltzmann Method (LBM) in one dimension with three discrete velocities (D1Q3): $e_0 = 0$, $e_1 = +1$, $e_2 = -1$, with weights $w_0 = \\frac{2}{3}$ and $w_1 = w_2 = \\frac{1}{6}$, and lattice sound speed $c_s^2 = \\frac{1}{3}$.\n- The hydrodynamic limit under a Chapman–Enskog expansion: the D1Q3 BGK scheme for a passive scalar recovers the advection–diffusion equation $\\partial_t T + \\partial_x (u T) = \\partial_x (\\alpha \\partial_x T)$ with thermal diffusivity $\\alpha = c_s^2 (\\tau_T - \\frac{1}{2}) \\Delta t$ in lattice units, provided that $\\tau_T > \\frac{1}{2}$.\n\nYour program must:\n- Implement two coupled D1Q3 LBM solvers:\n  1. An isothermal momentum solver advancing density $\\rho$ and velocity $u$ using a BGK collision with relaxation time $\\tau_f$ and periodic boundary conditions. Use the D1Q3 equilibrium $f_i^{\\text{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right]$.\n  2. A thermal energy solver for temperature $T$ with a BGK collision with relaxation time $\\tau_T$ and periodic boundary conditions. Use the advective equilibrium $g_i^{\\text{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right]$ so that the energy lattice is coupled to the momentum velocity $u$.\n- Use the collision–streaming algorithm with periodic boundaries for both lattices.\n- Initialize the momentum field with uniform $\\rho = 1$ and $u = 0$ everywhere, and initialize the momentum distribution to its equilibrium at $u = 0$.\n- Initialize the temperature field as a single Fourier mode in a periodic domain of length $L = N_x$ lattice nodes:\n  $$T(x, 0) = T_0 + A \\sin(k x), \\quad k = \\frac{2 \\pi m}{L}, \\quad x \\in \\{0, 1, \\dots, N_x - 1\\}.$$\n  Initialize the energy distributions to their equilibrium at the initial $T$ and $u = 0$.\n- Evolve the coupled system for a prescribed number of time steps $N_t$.\n- Compute the analytical solution of the one-dimensional heat equation in the same periodic domain:\n  $$T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp\\!\\left( - \\alpha k^2 t \\right) \\sin(k x), \\quad \\alpha = c_s^2 \\left( \\tau_T - \\frac{1}{2} \\right), \\quad t = N_t \\Delta t,$$\n  and compare it to the numerical temperature $T_{\\mathrm{num}}(x, t)$ extracted from the energy lattice after $N_t$ steps.\n- Quantify the difference using the root-mean-square error (RMS) over the lattice:\n  $$\\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, t) - T_{\\mathrm{ana}}(x_j, t) \\right)^2 }.$$\n\nUse the following D1Q3 definitions in all computations: $e_0 = 0$, $e_1 = +1$, $e_2 = -1$, $w_0 = \\frac{2}{3}$, $w_1 = w_2 = \\frac{1}{6}$, $c_s^2 = \\frac{1}{3}$, and periodic boundary conditions. Fix the momentum relaxation time to $\\tau_f = 0.6$ for all tests. All steps are in lattice units with $\\Delta x = \\Delta t = 1$.\n\nTest suite:\n- Case A (general behavior with moderate diffusion):\n  - $N_x = 120$, $N_t = 1200$, $\\tau_T = 0.8$, $m = 1$, $A = 0.01$, $T_0 = 1.0$.\n- Case B (near-relaxation boundary with slow diffusion):\n  - $N_x = 64$, $N_t = 3000$, $\\tau_T = 0.501$, $m = 3$, $A = 0.2$, $T_0 = 1.0$.\n- Case C (high diffusion rate):\n  - $N_x = 100$, $N_t = 300$, $\\tau_T = 1.5$, $m = 2$, $A = 0.5$, $T_0 = 0.0$.\n\nYour program should compute $\\varepsilon_{\\mathrm{RMS}}$ for each case and produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order [Case A, Case B, Case C], with each value rounded to exactly six digits after the decimal point (for example, \"[0.001234,0.056789,0.000012]\").",
            "solution": "The user problem is subjected to validation.\n\n### Step 1: Extract Givens\n- **Model**: One-dimensional ($1$D) transient heat conduction simulated with the Lattice Boltzmann Method (LBM).\n- **Lattices**: Two coupled one-dimensional, three-velocity (D1Q3) lattices. One for isothermal momentum, one for thermal energy.\n- **Lattice Parameters (D1Q3)**:\n    - Discrete velocities: $e_0 = 0, e_1 = +1, e_2 = -1$.\n    - Weights: $w_0 = \\frac{2}{3}, w_1 = w_2 = \\frac{1}{6}$.\n    - Lattice sound speed squared: $c_s^2 = \\frac{1}{3}$.\n- **Lattice Units**: $\\Delta x = 1$ and $\\Delta t = 1$.\n- **Governing Equations**:\n    - Boltzmann-BGK equation: $\\partial_t f + \\boldsymbol{\\xi} \\cdot \\nabla f = -\\frac{1}{\\tau}(f - f^{\\text{eq}})$.\n    - Recovered macroscopic equation for temperature $T$: $\\partial_t T + \\partial_x (u T) = \\partial_x (\\alpha \\partial_x T)$.\n    - Thermal diffusivity: $\\alpha = c_s^2 (\\tau_T - \\frac{1}{2}) \\Delta t$, with the stability constraint $\\tau_T > \\frac{1}{2}$.\n- **Momentum Solver**:\n    - Variables: density $\\rho$ and velocity $u$.\n    - Relaxation time: $\\tau_f = 0.6$.\n    - Equilibrium distribution: $f_i^{\\text{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right]$.\n    - Initial conditions: $\\rho(x, 0) = 1$ and $u(x, 0) = 0$ for all $x$. Momentum distributions $f_i(x,0)$ are at equilibrium.\n- **Thermal Solver**:\n    - Variable: Temperature $T$.\n    - Relaxation time: $\\tau_T$ (specified per case).\n    - Equilibrium distribution: $g_i^{\\text{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right]$.\n    - Initial condition: $T(x, 0) = T_0 + A \\sin(k x)$, with $k = \\frac{2 \\pi m}{L}$ and $L = N_x$. Energy distributions $g_i(x,0)$ are at equilibrium.\n- **Boundaries**: Periodic for both solvers.\n- **Algorithm**: Collision-streaming.\n- **Validation**: Compare numerical temperature $T_{\\mathrm{num}}$ with analytical solution $T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp(-\\alpha k^2 t) \\sin(k x)$ at $t = N_t \\Delta t$.\n- **Error Metric**: Root-mean-square error $\\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, t) - T_{\\mathrm{ana}}(x_j, t) \\right)^2 }$.\n- **Test Cases**:\n    - Case A: $N_x = 120, N_t = 1200, \\tau_T = 0.8, m = 1, A = 0.01, T_0 = 1.0$.\n    - Case B: $N_x = 64, N_t = 3000, \\tau_T = 0.501, m = 3, A = 0.2, T_0 = 1.0$.\n    - Case C: $N_x = 100, N_t = 300, \\tau_T = 1.5, m = 2, A = 0.5, T_0 = 0.0$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed based on the predefined criteria.\n- **Scientific Grounding**: The problem is well-grounded in the established theory of the Lattice Boltzmann Method for computational fluid dynamics. The D1Q3 model, BGK collision operator, equilibrium distribution functions, and the Chapman-Enskog analysis leading to the advection-diffusion equation are all standard and correct elements of LBM. The analytical solution for the 1D heat equation is also correct.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary parameters, initial conditions, and boundary conditions to obtain a unique solution. The parameters for all test cases satisfy the stability condition $\\tau_T > 0.5$.\n- **Objectivity**: The problem is stated in precise, objective, and mathematical language, free from any subjectivity.\n- **Consistency**: The problem setup is internally consistent. The initial conditions of uniform density $\\rho=1$ and zero velocity $u=0$ on a periodic domain mean that the momentum field will remain static. This simplifies the macroscopic advection-diffusion equation to a pure diffusion equation, for which the provided analytical solution is correct. This is not a contradiction but a specific test case for the diffusive behavior of the thermal solver.\n\n### Step 3: Verdict and Action\nThe problem is valid. It presents a standard verification exercise for a numerical method. A complete solution will be provided.\n\n### Solution\n\nThe problem requires the implementation of a one-dimensional, three-velocity (D1Q3) Lattice Boltzmann Method (LBM) solver for transient heat conduction. The simulation involves two coupled fields: a momentum field for fluid density $\\rho$ and velocity $u$, and a thermal field for temperature $T$. The solution will be validated against an analytical solution for heat diffusion. All calculations are performed in non-dimensional lattice units where $\\Delta x = 1$ and $\\Delta t = 1$.\n\nThe D1Q3 lattice model uses a set of $3$ discrete velocities, $e_i$, and corresponding weights, $w_i$:\n- Velocities: $e_0 = 0, e_1 = 1, e_2 = -1$.\n- Weights: $w_0 = \\frac{2}{3}, w_1 = \\frac{1}{6}, w_2 = \\frac{1}{6}$.\nThe lattice sound speed squared is $c_s^2 = \\sum_i w_i e_i^2 = \\frac{1}{3}$.\n\nThe LBM algorithm advances the discrete distribution functions, $f_i$ for momentum and $g_i$ for energy, through a sequence of collision and streaming steps.\n\n**1. Coupled LBM Solvers**\n\n**Momentum Field:**\nThe momentum field is described by the distribution functions $f_i(x, t)$. The macroscopic density $\\rho$ and velocity $u$ are recovered as moments of $f_i$:\n$$ \\rho = \\sum_{i=0}^{2} f_i, \\quad \\rho u = \\sum_{i=0}^{2} e_i f_i $$\nThe collision step relaxes $f_i$ towards a local equilibrium distribution function, $f_i^{\\text{eq}}$, over a characteristic time $\\tau_f$:\n$$ f_i^{\\text{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right] $$\nThe problem specifies initial conditions of uniform density $\\rho(x, 0) = 1$ and zero velocity $u(x, 0) = 0$. With periodic boundary conditions and no external forcing, the initial state of macroscopic uniformity is preserved for all time. The momentum field remains static at $\\rho=1, u=0$. While the solver implementation will include the update steps for the momentum field for generality, they will have no net effect.\n\n**Thermal Field:**\nThe thermal field is governed by the energy distribution functions $g_i(x, t)$. The temperature $T$ is the zeroth moment of $g_i$:\n$$ T = \\sum_{i=0}^{2} g_i $$\nThe collision step for the thermal field relaxes $g_i$ towards its equilibrium, $g_i^{\\text{eq}}$, with a relaxation time $\\tau_T$:\n$$ g_i^{\\text{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right] $$\nThis equilibrium function couples the thermal field to the momentum field via the velocity $u$. However, since $u(x, t) = 0$ for this problem, the equilibrium simplifies to that of a pure diffusion process:\n$$ g_i^{\\text{eq}} = w_i T $$\nIn the macroscopic limit, this LBM scheme recovers the advection-diffusion equation. With $u=0$, this reduces to the 1D heat equation, $\\partial_t T = \\alpha \\partial_x^2 T$, where the thermal diffusivity $\\alpha$ is given by:\n$$ \\alpha = c_s^2 \\left( \\tau_T - \\frac{1}{2} \\right) $$\n\n**2. Numerical Algorithm**\n\nThe simulation proceeds as follows for each test case:\n\n**Initialization:**\n1.  The computational domain is a $1$D grid of $N_x$ nodes, $x \\in \\{0, 1, \\dots, N_x-1\\}$.\n2.  The momentum field is initialized to $\\rho(x,0) = 1$ and $u(x,0) = 0$. The distributions $f_i(x,0)$ are set to their equilibrium values, $f_i^{\\text{eq}}(\\rho=1, u=0)$.\n3.  The initial temperature field is set to a sinusoidal profile: $T(x, 0) = T_0 + A \\sin(k x)$, where the wavenumber is $k = \\frac{2 \\pi m}{N_x}$. The distributions $g_i(x,0)$ are set to their equilibrium values, $g_i^{\\text{eq}}(T(x,0), u=0)$.\n\n**Time Evolution Loop:**\nFor each time step from $t=0$ to $N_t-1$:\n1.  **Macroscopic Variables**: Compute $\\rho, u$ from $f_i$ and $T$ from $g_i$. (As noted, $\\rho$ and $u$ will remain constant).\n2.  **Collision**: Update both sets of distributions based on the BGK rule. For a distribution $\\psi_i \\in \\{f_i, g_i\\}$ with relaxation time $\\tau_{\\psi}$:\n    $$ \\psi_i^{\\text{post-collision}}(x, t) = \\psi_i(x, t) - \\frac{1}{\\tau_{\\psi}} \\left( \\psi_i(x, t) - \\psi_i^{\\text{eq}}(x, t) \\right) $$\n3.  **Streaming**: Propagate the post-collision distributions to neighboring nodes according to their velocities. This is implemented using a circular shift (roll) on the distribution arrays to enforce periodic boundary conditions:\n    $$ \\psi_i(x, t+\\Delta t) = \\psi_i^{\\text{post-collision}}(x - e_i \\Delta x, t) $$\n    Specifically, the distributions for $e_1=1$ are shifted right, and for $e_2=-1$ are shifted left. Distributions for $e_0=0$ remain in place.\n\n**3. Validation and Error Calculation**\n\nAfter $N_t$ time steps, the final numerical temperature $T_{\\mathrm{num}}(x, N_t)$ is obtained by summing the final energy distributions $g_i$. This result is compared against the analytical solution for the 1D heat equation with the same initial and boundary conditions:\n$$ T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp(-\\alpha k^2 t) \\sin(k x) $$\nwhere $t = N_t$ and $\\alpha = c_s^2(\\tau_T - 0.5)$. The deviation is quantified by the root-mean-square error, $\\varepsilon_{\\mathrm{RMS}}$:\n$$ \\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, N_t) - T_{\\mathrm{ana}}(x_j, N_t) \\right)^2 } $$\nThis procedure is repeated for each of the three test cases specified in the problem statement, and the resulting $\\varepsilon_{\\mathrm{RMS}}$ values are reported.",
            "answer": "```python\nimport numpy as np\n\ndef run_lbm_simulation(Nx, Nt, tau_T, m, A, T0):\n    \"\"\"\n    Runs a 1D LBM simulation for coupled momentum and heat transfer.\n    \n    Args:\n        Nx (int): Number of lattice nodes.\n        Nt (int): Number of time steps.\n        tau_T (float): Relaxation time for the thermal field.\n        m (int): Wavenumber mode for the initial temperature profile.\n        A (float): Amplitude of the initial temperature sine wave.\n        T0 (float): Base initial temperature.\n        \n    Returns:\n        float: The root-mean-square error between numerical and analytical solutions.\n    \"\"\"\n    \n    # --- Fixed and D1Q3 Lattice Parameters ---\n    tau_f = 0.6  # Relaxation time for momentum field\n    \n    # D1Q3 velocities, weights, and sound speed squared\n    e = np.array([0, 1, -1])\n    w = np.array([2/3, 1/6, 1/6])\n    cs2 = 1/3\n\n    # --- Initialization ---\n    \n    # Spatial grid and wavenumber\n    x_grid = np.arange(Nx)\n    k = 2 * np.pi * m / Nx\n    \n    # Momentum field initialization\n    # Macroscopic variables: rho (density), u (velocity)\n    rho = np.ones(Nx)  # rho = 1.0 everywhere\n    u = np.zeros(Nx)   # u = 0.0 everywhere\n    \n    # Microscopic distribution functions f for momentum\n    # Initialize f to equilibrium for rho=1, u=0\n    f = np.zeros((3, Nx))\n    u_term = (e[:, np.newaxis] * u) / cs2\n    f_eq = w[:, np.newaxis] * rho * (1 + u_term + 0.5 * u_term**2 - 0.5 * u**2 / cs2)\n    f[:, :] = f_eq\n    \n    # Thermal field initialization\n    # Macroscopic variable: T (temperature)\n    T = T0 + A * np.sin(k * x_grid)\n    \n    # Microscopic distribution functions g for thermal energy\n    # Initialize g to equilibrium for initial T and u=0\n    g_eq = w[:, np.newaxis] * T * (1 + (e[:, np.newaxis] * u) / cs2)\n    g = np.zeros((3, Nx))\n    g[:, :] = g_eq\n\n    # --- Main Time-Stepping Loop ---\n    for _ in range(Nt):\n        # 1. Macroscopic properties (recalculated for generality, though rho/u are static)\n        rho = np.sum(f, axis=0)\n        u = (f[1, :] - f[2, :]) / rho\n        T = np.sum(g, axis=0)\n\n        # 2. Collision step\n        # Calculate equilibrium distributions\n        u_term = (e[:, np.newaxis] * u) / cs2\n        f_eq = w[:, np.newaxis] * rho * (1 + u_term + 0.5 * u_term**2 - 0.5 * u**2 / cs2)\n        g_eq = w[:, np.newaxis] * T * (1 + u_term)\n        \n        # Apply BGK collision\n        f += -(1.0 / tau_f) * (f - f_eq)\n        g += -(1.0 / tau_T) * (g - g_eq)\n\n        # 3. Streaming step (with periodic boundaries)\n        f[1, :] = np.roll(f[1, :], 1)\n        f[2, :] = np.roll(f[2, :], -1)\n        g[1, :] = np.roll(g[1, :], 1)\n        g[2, :] = np.roll(g[2, :], -1)\n\n    # --- Post-Processing and Validation ---\n    \n    # Final numerical temperature\n    T_num = np.sum(g, axis=0)\n    \n    # Analytical solution\n    # With dt=1, time t=Nt\n    alpha = cs2 * (tau_T - 0.5)\n    t = Nt\n    decay_term = np.exp(-alpha * k**2 * t)\n    T_ana = T0 + A * decay_term * np.sin(k * x_grid)\n    \n    # Root-Mean-Square Error calculation\n    rms_error = np.sqrt(np.mean((T_num - T_ana)**2))\n    \n    return rms_error\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case A: (Nx, Nt, tau_T, m, A, T0)\n        (120, 1200, 0.8, 1, 0.01, 1.0),\n        # Case B\n        (64, 3000, 0.501, 3, 0.2, 1.0),\n        # Case C\n        (100, 300, 1.5, 2, 0.5, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Nt, tau_T, m, A, T0 = case\n        rms_error = run_lbm_simulation(Nx, Nt, tau_T, m, A, T0)\n        results.append(f\"{rms_error:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "We now scale up our efforts to a more complex and physically rich problem: the decay of a two-dimensional vortex, a canonical model for studying turbulence. This advanced practice involves not only extending your solver to two dimensions but also implementing a Large Eddy Simulation (LES) model to account for the effects of unresolved subgrid-scale motions . By incorporating the Smagorinsky model via a locally-adapting relaxation time, you will explore how LBM can be used to simulate turbulent flows and directly observe how subgrid modeling impacts the dissipation of kinetic energy.",
            "id": "3375021",
            "problem": "You are tasked with building, from first principles, a complete numerical simulator in the Lattice Boltzmann Method (LBM) framework to study the decay of a two-dimensional Taylor-Green vortex and the impact of subgrid modeling via the Smagorinsky Large Eddy Simulation (LES) closure on the kinetic energy decay rate. The simulator must be a single program that is fully self-contained and runnable as provided.\n\nThe fundamental starting point is the kinetic representation of fluid dynamics via the Boltzmann equation and its single-relaxation-time Bhatnagar-Gross-Krook (BGK) model in a discrete-velocity setting. In the two-dimensional nine-velocity ($\\mathrm{D2Q9}$) lattice, the discrete particle distribution functions $f_i(\\mathbf{x}, t)$ evolve under the combined action of collision and streaming. The macroscopic density $\\rho(\\mathbf{x}, t)$ and velocity $\\mathbf{u}(\\mathbf{x}, t)$ are recovered by velocity moments of $f_i$. The equilibrium distribution $f_i^{\\text{eq}}$ is defined by matching those moments to the hydrodynamic fields of the isothermal lattice, and the collision step relaxes $f_i$ toward $f_i^{\\text{eq}}$ at a rate controlled by the relaxation time $\\tau$. In lattice units, the kinematic viscosity $\\nu$ is linked to the relaxation time by $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$, where $c_s^2$ is the lattice speed of sound squared. You must model the Smagorinsky LES closure as a local eddy viscosity $\\nu_t$ based on the local rate-of-strain magnitude, defining an effective viscosity $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$ and therefore a local relaxation time $\\tau_{\\mathrm{eff}} = \\frac{\\nu_{\\mathrm{eff}}}{c_s^2} + \\frac{1}{2}$. The filter width must be taken equal to the lattice spacing.\n\nThe target flow is the two-dimensional Taylor-Green vortex on a periodic square domain with side length $L$, whose initial velocity field is divergence-free and given by\n$$\nu_x(x,y,0) = U_0 \\cos(k x)\\,\\sin(k y), \\qquad\nu_y(x,y,0) = - U_0 \\sin(k x)\\,\\cos(k y),\n$$\nwith fundamental wavenumber $k = \\frac{2\\pi}{L}$. For an incompressible viscous fluid, the mode amplitude decays in time, and the kinetic energy per unit mass,\n$$\nE(t) = \\frac{1}{2}\\left\\langle u_x^2 + u_y^2 \\right\\rangle,\n$$\nhas a known reference evolution that you must use as a Direct Numerical Simulation (DNS) comparison baseline for the case without subgrid modeling. Your implementation must numerically integrate the LBM equations in time, compute the spatially averaged kinetic energy $E_{\\mathrm{LBM}}(t)$ at the final time, and compare it to the analytical reference $E_{\\mathrm{ref}}(t)$ computed from the exact viscous decay of the Taylor-Green vortex in the laminar (no LES) case. The effect of the Smagorinsky constant $C_s$ must be introduced via the eddy viscosity $\\nu_t$ defined from the local strain-rate magnitude.\n\nYou must start your derivations from the following fundamental base:\n- The discrete-velocity Boltzmann equation with Bhatnagar-Gross-Krook (BGK) relaxation in two dimensions.\n- The definition of macroscopic fields by velocity moments of the distribution functions.\n- The isothermal lattice equilibrium distribution obtained by Hermite projection that matches density and momentum up to second order.\n- The relation $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$ in lattice units for the $\\mathrm{D2Q9}$ lattice.\n- The Smagorinsky model for Large Eddy Simulation (LES), where the eddy viscosity is $\\nu_t = \\left(C_s \\Delta\\right)^2 \\left\\lVert S \\right\\rVert$ with $\\Delta$ the filter width, $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$, and $S_{ij} = \\frac{1}{2}\\left(\\partial_j u_i + \\partial_i u_j\\right)$.\n- The exact laminar Taylor-Green vortex decay in two dimensions for the reference comparison.\n\nYour program must implement:\n- A two-dimensional $\\mathrm{D2Q9}$ LBM with periodic boundary conditions on a square lattice.\n- Local relaxation time $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)$ obtained from $\\nu_{\\mathrm{eff}}(\\mathbf{x}, t) = \\nu + \\nu_t(\\mathbf{x}, t)$ with $\\nu_t$ computed from central differences for velocity gradients and $\\Delta = 1$ (lattice spacing).\n- Initialization by the Taylor-Green vortex velocity field with uniform density.\n\nScientific and numerical parameters and units:\n- Work entirely in lattice units with $\\Delta x = \\Delta y = \\Delta t = 1$, so all quantities are dimensionless in this setting.\n- Lattice size $N_x = N_y = 64$, hence $L = 64$ and $k = \\frac{2\\pi}{64}$.\n- Base kinematic viscosity $\\nu = 0.01$.\n- Initial velocity amplitude $U_0 = 0.05$.\n- Total number of time steps $N_t = 300$.\n- Use the standard $\\mathrm{D2Q9}$ velocities and weights, and $c_s^2 = \\frac{1}{3}$.\n\nTest suite:\n- The program must run four test cases, each specified by a Smagorinsky constant $C_s$: $C_s = 0.0$ (no LES), $C_s = 0.12$, $C_s = 0.18$, and $C_s = 0.24$.\n- For each test case, compute the final-time LBM kinetic energy $E_{\\mathrm{LBM}}(t=N_t)$, the analytical reference energy $E_{\\mathrm{ref}}(t=N_t)$ based on the laminar Taylor-Green decay, and report the dimensionless deviation\n$$\n\\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1.\n$$\n\nOutput specification:\n- Your program must produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$.\n- Each $\\delta(C_s)$ must be a decimal number rounded to six decimal places.\n- The output is dimensionless and must be printed exactly in the specified single-line format.\n\nThe solution must derive and justify the numerical procedure and the diagnostic quantities from the fundamental base above, explain why the Taylor-Green vortex decay is an appropriate DNS reference in this context, and elucidate how and why the Smagorinsky constant alters the decay via an increased effective viscosity. In particular, ensure your derivation clearly shows what the LBM update is, why it is correct in this regime, and how the algorithm computes the rate-of-strain and the eddy viscosity in a scientifically consistent way. Avoid nonphysical configurations and ensure stability by maintaining a relaxation time greater than $\\frac{1}{2}$ everywhere.",
            "solution": "The problem statement is a valid and well-posed numerical experiment in computational fluid dynamics. It requires the development of a Lattice Boltzmann Method (LBM) simulator for a two-dimensional, decaying turbulent flow, specifically the Taylor-Green vortex. The problem includes a comparison with an analytical solution and an investigation into the effects of a subgrid-scale model, the Smagorinsky Large Eddy Simulation (LES) model. All necessary physical and numerical parameters are provided, and the problem is scientifically grounded in established principles of fluid dynamics and numerical methods.\n\nThe solution will be developed from first principles, as requested. We begin with the theoretical foundation of the Lattice Boltzmann Method, then incorporate the Smagorinsky LES model, detail the specifics of the Taylor-Green vortex flow, and finally outline the complete numerical algorithm and the diagnostic quantity to be computed.\n\n**1. The Lattice Boltzmann Equation**\n\nThe LBM describes the evolution of a set of particle distribution functions, $f_i(\\mathbf{x}, t)$, on a discrete lattice. Each function $f_i$ represents the density of particles at position $\\mathbf{x}$ and time $t$ moving with a discrete velocity $\\mathbf{c}_i$. The evolution is governed by the discrete-velocity Boltzmann equation. With the Bhatnagar-Gross-Krook (BGK) approximation for the collision term, this equation is:\n$$\n\\frac{\\partial f_i}{\\partial t} + \\mathbf{c}_i \\cdot \\nabla f_i = -\\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\mathbf{x}, t) \\right]\n$$\nwhere $\\tau$ is the single relaxation time, which controls the rate at which the distribution functions relax towards a local equilibrium distribution, $f_i^{\\text{eq}}$. Discretizing this equation in time and space with $\\Delta t = \\Delta x = 1$ (in lattice units) leads to the LBM update rule, which is typically split into two steps: collision and streaming.\n\n**Collision Step**: The right-hand side is treated. The post-collision distribution $f_i^*$ is computed at each lattice node:\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\mathbf{x}, t) \\right]\n$$\n\n**Streaming Step**: The advection on the left-hand side is treated. The post-collision populations move to adjacent nodes according to their discrete velocities:\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n$$\nIn our lattice units, this simplifies to $f_i(\\mathbf{x} + \\mathbf{c}_i, t + 1) = f_i^*(\\mathbf{x}, t)$.\n\n**2. The D2Q9 Lattice Model**\n\nFor two-dimensional flows, the D2Q9 model is standard. It uses a square lattice with nine discrete velocities, $\\mathbf{c}_i$ for $i=0, \\dots, 8$.\n-   $\\mathbf{c}_0 = (0, 0)$ (rest particles)\n-   $\\mathbf{c}_{1,2,3,4} = (1, 0), (0, 1), (-1, 0), (0, -1)$ (axial velocities, speed $1$)\n-   $\\mathbf{c}_{5,6,7,8} = (1, 1), (-1, 1), (-1, -1), (1, -1)$ (diagonal velocities, speed $\\sqrt{2}$)\n\nAssociated with each velocity is a weight $w_i$:\n-   $w_0 = 4/9$\n-   $w_{1,2,3,4} = 1/9$\n-   $w_{5,6,7,8} = 1/36$\n\nThese weights and velocities are chosen such that the model recovers the Navier-Stokes equations in the low-Mach number limit. The lattice speed of sound is given by $c_s^2 = \\sum_i w_i (\\mathbf{c}_{ix})^2 = 1/3$.\n\n**3. Macroscopic Hydrodynamic Variables**\n\nThe macroscopic fluid density $\\rho$ and momentum $\\rho \\mathbf{u}$ (and thus velocity $\\mathbf{u}$) are recovered as moments of the distribution functions:\n$$\n\\rho(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t)\n$$\n$$\n\\rho(\\mathbf{x}, t) \\mathbf{u}(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t) \\mathbf{c}_i\n$$\n\n**4. Equilibrium Distribution Function**\n\nThe equilibrium distribution $f_i^{\\text{eq}}$ is a function of the local macroscopic density and velocity. For the nearly incompressible (low-Mach number) regime, a second-order expansion of the Maxwell-Boltzmann distribution in terms of velocity $\\mathbf{u}$ is used:\n$$\nf_i^{\\text{eq}}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right]\n$$\nThis form ensures that the moments of $f_i^{\\text{eq}}$ return the correct macroscopic $\\rho$ and $\\rho\\mathbf{u}$, and it is crucial for recovering the correct form of the Navier-Stokes equations.\n\n**5. Viscosity and the Smagorinsky LES Model**\n\nThrough a Chapman-Enskog expansion, it can be shown that the LBM-BGK model recovers the Navier-Stokes equations with a kinematic viscosity $\\nu$ related to the relaxation time $\\tau$ by:\n$$\n\\nu = c_s^2 \\left( \\tau - \\frac{1}{2} \\right)\n$$\nThe problem requires simulating a flow that may develop turbulent features at scales smaller than the lattice resolution. Large Eddy Simulation (LES) is a technique for modeling the effect of these unresolved subgrid scales on the resolved flow. The Smagorinsky model is an algebraic subgrid-scale model that introduces an eddy viscosity, $\\nu_t$, which depends on the local strain rate of the resolved flow.\nThe total effective viscosity becomes $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$, where $\\nu$ is the base molecular viscosity. The eddy viscosity is given by:\n$$\n\\nu_t = (C_s \\Delta)^2 \\left\\lVert S \\right\\rVert\n$$\nHere, $C_s$ is the dimensionless Smagorinsky constant, $\\Delta$ is the filter width (taken to be the lattice spacing, so $\\Delta = 1$), and $\\left\\lVert S \\right\\rVert$ is the magnitude of the resolved-scale strain-rate tensor $S_{ij}$.\n\nThe strain-rate tensor is defined as $S_{ij} = \\frac{1}{2}(\\partial_j u_i + \\partial_i u_j)$, where $\\partial_i \\equiv \\partial/\\partial x_i$. Its magnitude is $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$. In two dimensions, this expands to:\n$$\n\\left\\lVert S \\right\\rVert = \\sqrt{2 \\left( S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2 \\right)}\n$$\nwith $S_{xx} = \\partial_x u_x$, $S_{yy} = \\partial_y u_y$, and $S_{xy} = \\frac{1}{2}(\\partial_y u_x + \\partial_x u_y)$. These velocity gradients must be computed numerically from the velocity field on the lattice at each time step. We use a second-order central difference scheme, e.g., $\\partial_x \\phi(x,y) \\approx (\\phi(x+1,y) - \\phi(x-1,y))/2$.\n\nThe introduction of $\\nu_t$ implies that the viscosity is no longer uniform. This is incorporated into the LBM by defining a local, time-dependent effective relaxation time, $\\tau_{\\mathrm{eff}}$:\n$$\n\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = \\frac{\\nu_{\\mathrm{eff}}(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2} = \\frac{\\nu + \\nu_t(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2}\n$$\nThe collision step is then performed using this local $\\tau_{\\mathrm{eff}}$:\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\mathbf{x}, t) \\right]\n$$\nA larger $C_s$ results in a larger eddy viscosity in regions of high shear, leading to a larger $\\tau_{\\mathrm{eff}}$ and consequently enhanced dissipation of kinetic energy, mimicking the physical effect of turbulent eddies. For stability, it is required that $\\tau_{\\mathrm{eff}} > 1/2$ everywhere. Since $\\nu > 0$ and $\\nu_t \\ge 0$, this condition is satisfied by the problem parameters ($\\nu=0.01$, so base $\\tau = 0.53 > 0.5$).\n\n**6. The Taylor-Green Vortex**\n\nThe Taylor-Green vortex is an exact solution to the incompressible Navier-Stokes equations on a doubly-periodic domain. It serves as a canonical problem for verifying numerical schemes for viscous and turbulent flows. The initial velocity field is given by:\n$$\nu_x(x,y,0) = U_0 \\cos(kx)\\sin(ky)\n$$\n$$\nu_y(x,y,0) = -U_0 \\sin(kx)\\cos(ky)\n$$\nwhere $k = 2\\pi/L$ is the fundamental wavenumber for a domain of side length $L$.\nFor the laminar case (i.e., without any turbulence model, corresponding to $C_s=0$), the velocity field decays analytically as:\n$$\nu_x(x,y,t) = U_0 \\cos(kx)\\sin(ky) e^{-2\\nu k^2 t}\n$$\n$$\nu_y(x,y,t) = -U_0 \\sin(kx)\\cos(ky) e^{-2\\nu k^2 t}\n$$\nThe spatially-averaged kinetic energy per unit mass, $E(t) = \\frac{1}{2} \\langle u_x^2 + u_y^2 \\rangle$, provides a single metric to track the flow's evolution. For the analytical solution, this is:\n$$\nE_{\\mathrm{ref}}(t) = \\frac{1}{2} \\left\\langle U_0^2 e^{-4\\nu k^2 t} (\\cos^2(kx)\\sin^2(ky) + \\sin^2(kx)\\cos^2(ky)) \\right\\rangle\n$$\nUsing the fact that $\\langle \\cos^2(\\cdot) \\rangle = \\langle \\sin^2(\\cdot) \\rangle = 1/2$ over a period, the spatially averaged term becomes $\\langle \\dots \\rangle = (1/2)(1/2) + (1/2)(1/2) = 1/2$. Thus, the reference analytical energy decay is:\n$$\nE_{\\mathrm{ref}}(t) = \\frac{U_0^2}{4} e^{-4\\nu k^2 t}\n$$\nThis provides the benchmark (\"DNS reference\") against which the LBM simulation for $C_s=0$ can be validated and the effect of the LES model for $C_s>0$ can be quantified.\n\n**7. Numerical Algorithm and Diagnostics**\n\nThe complete algorithm for a single test case is as follows:\n\n-   **Initialization ($t=0$):**\n    1.  Define the lattice grid $(x, y)$ for a domain of size $N_x \\times N_y$. Here $N_x = N_y = L = 64$.\n    2.  Set initial density to a constant, $\\rho(\\mathbf{x}, 0) = \\rho_0 = 1$.\n    3.  Calculate the initial velocity field $\\mathbf{u}(\\mathbf{x}, 0)$ using the Taylor-Green vortex equations.\n    4.  Initialize the distribution functions to their equilibrium values: $f_i(\\mathbf{x}, 0) = f_i^{\\text{eq}}(\\rho(\\mathbf{x}, 0), \\mathbf{u}(\\mathbf{x}, 0))$.\n\n-   **Time Loop (for $t=1$ to $N_t$):**\n    1.  **Streaming**: The populations are moved to neighboring nodes. A pull scheme is computationally efficient: $f_i(\\mathbf{x}, t_{post-stream}) = f_i(\\mathbf{x}-\\mathbf{c}_i, t_{post-collision})$. Periodic boundary conditions are naturally handled using modular arithmetic or `numpy.roll`.\n    2.  **Macroscopic Fields**: Compute $\\rho(\\mathbf{x}, t)$ and $\\mathbf{u}(\\mathbf{x}, t)$ from the streamed populations $f_i$ using the moment summations.\n    3.  **LES Calculation (if $C_s > 0$):**\n        a. Compute the velocity-gradient components ($\\partial_x u_x, \\partial_y u_x, \\ldots$) via second-order central differences.\n        b. Assemble the strain-rate tensor components $S_{ij}$ and calculate its magnitude $\\left\\lVert S \\right\\rVert$.\n        c. Compute the eddy viscosity $\\nu_t(\\mathbf{x}, t) = C_s^2 \\left\\lVert S(\\mathbf{x}, t) \\right\\rVert$.\n        d. Determine the local effective relaxation time $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = (\\nu + \\nu_t)/c_s^2 + 1/2$.\n    4.  **Collision**:\n        a. Calculate the equilibrium distribution $f_i^{\\text{eq}}(\\mathbf{x}, t)$ from the current macroscopic $\\rho$ and $\\mathbf{u}$.\n        b. Apply the collision step using the local relaxation time $\\tau_{\\mathrm{eff}}$ (or the constant base $\\tau$ if $C_s=0$):\n           $f_i(\\mathbf{x}, t_{post-collision}) = f_i - (1/\\tau_{\\mathrm{eff}})(f_i - f_i^{\\text{eq}})$.\n\n-   **Final Calculation ($t=N_t$):**\n    1.  After the final time step, compute the final velocity field $\\mathbf{u}(\\mathbf{x}, N_t)$.\n    2.  Calculate the numerical kinetic energy by averaging over the domain: $E_{\\mathrm{LBM}}(N_t) = \\frac{1}{2 N_x N_y} \\sum_{\\mathbf{x}} (u_x^2(\\mathbf{x}, N_t) + u_y^2(\\mathbf{x}, N_t))$.\n    3.  Calculate the analytical reference energy $E_{\\mathrm{ref}}(N_t) = (U_0^2/4) \\exp(-4\\nu k^2 N_t)$.\n    4.  Compute the final diagnostic quantity, the dimensionless deviation $\\delta(C_s)$:\n        $$\n        \\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1\n        $$\nThis procedure is repeated for each specified value of the Smagorinsky constant $C_s$. The case $C_s=0$ serves as a verification of the underlying solver accuracy, for which we expect $\\delta(0) \\approx 0$. For $C_s>0$, the enhanced dissipation due to the eddy viscosity will cause $E_{\\mathrm{LBM}}(N_t)$ to be less than $E_{\\mathrm{ref}}(N_t)$, yielding a negative $\\delta(C_s)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates the decay of a 2D Taylor-Green vortex using the Lattice Boltzmann Method\n    with a Smagorinsky LES model.\n    \"\"\"\n    \n    # Scientific and numerical parameters in lattice units\n    Nx = 64          # Lattice size in x-direction\n    Ny = 64          # Lattice size in y-direction\n    Nt = 300         # Total number of time steps\n    nu = 0.01        # Base kinematic viscosity\n    U0 = 0.05        # Initial velocity amplitude\n    rho0 = 1.0       # Initial uniform density\n    \n    test_cases_Cs = [0.0, 0.12, 0.18, 0.24] # Smagorinsky constants\n\n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1.0 / 3.0  # Speed of sound squared\n\n    # Pre-calculate reference energy decay for comparison\n    k = 2.0 * np.pi / Nx\n    E_ref_final = (U0**2 / 4.0) * np.exp(-4.0 * nu * k**2 * Nt)\n\n    results = []\n    \n    for Cs in test_cases_Cs:\n        \n        # --- Initialization ---\n        # Create lattice grid\n        x = np.arange(Nx)\n        y = np.arange(Ny)\n        X, Y = np.meshgrid(x, y)\n\n        # Initialize velocity field (Taylor-Green vortex)\n        ux = U0 * np.cos(k * X) * np.sin(k * Y)\n        uy = -U0 * np.sin(k * X) * np.cos(k * Y)\n\n        # Initialize density\n        rho = np.full((Ny, Nx), rho0)\n\n        # Initialize distribution functions to equilibrium\n        u_sq = ux**2 + uy**2\n        c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n        \n        feq = np.zeros((9, Ny, Nx))\n        for i in range(9):\n            feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n        \n        f = feq.copy()\n        \n        # Base relaxation time (for Cs=0 case)\n        tau_base = nu / cs2 + 0.5\n        omega_base = 1.0 / tau_base\n\n        # --- Time-stepping loop ---\n        for t in range(Nt):\n            # Streaming (pull scheme)\n            for i in range(9):\n                f[i, :, :] = np.roll(f[i, :, :], c[i], axis=(1, 0))\n\n            # Macroscopic variables from streamed populations\n            rho = np.sum(f, axis=0)\n            ux = np.einsum('iyx,i->yx', f, c[:, 0]) / rho\n            uy = np.einsum('iyx,i->yx', f, c[:, 1]) / rho\n\n            # --- Collision Step ---\n            # Equilibrium distribution\n            u_sq = ux**2 + uy**2\n            c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n            for i in range(9):\n                feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n\n            # Determine relaxation parameter omega\n            if Cs > 0:\n                # Calculate strain rate tensor components using central differences\n                # Gradients are calculated using np.roll for periodic boundaries\n                # dux/dx\n                grad_ux_x = (np.roll(ux, -1, axis=1) - np.roll(ux, 1, axis=1)) / 2.0\n                # dux/dy\n                grad_ux_y = (np.roll(ux, -1, axis=0) - np.roll(ux, 1, axis=0)) / 2.0\n                # duy/dx\n                grad_uy_x = (np.roll(uy, -1, axis=1) - np.roll(uy, 1, axis=1)) / 2.0\n                # duy/dy\n                grad_uy_y = (np.roll(uy, -1, axis=0) - np.roll(uy, 1, axis=0)) / 2.0\n                \n                Sxx = grad_ux_x\n                Syy = grad_uy_y\n                Sxy = 0.5 * (grad_ux_y + grad_uy_x)\n\n                # Strain rate magnitude\n                S_mag = np.sqrt(2.0 * (Sxx**2 + Syy**2 + 2.0 * Sxy**2))\n                \n                # Eddy viscosity\n                nu_t = (Cs**2) * S_mag # Delta = 1 in lattice units\n                \n                # Effective relaxation time\n                tau_eff = (nu + nu_t) / cs2 + 0.5\n                omega = 1.0 / tau_eff\n            else:\n                omega = omega_base\n            \n            # Apply collision\n            f += omega * (feq - f)\n            \n        # --- Post-processing ---\n        # Final kinetic energy from LBM simulation\n        final_ux = np.einsum('iyx,i->yx', f, c[:, 0]) / np.sum(f, axis=0)\n        final_uy = np.einsum('iyx,i->yx', f, c[:, 1]) / np.sum(f, axis=0)\n        E_lbm_final = 0.5 * np.mean(final_ux**2 + final_uy**2)\n\n        # Calculate dimensionless deviation\n        deviation = (E_lbm_final / E_ref_final) - 1.0\n        results.append(deviation)\n\n    # Final print statement in the exact required format\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}