{
    "hands_on_practices": [
        {
            "introduction": "平衡态分布函数 $f_i^{eq}$ 是格子玻尔兹曼方法（LBM）的基石，它在介观动力学描述与宏观流体动力学之间建立了关键的联系。这个基础练习将指导您针对一个给定的宏观状态（$\\rho, \\boldsymbol{u}$），直接计算 D2Q9 模型中的平衡态分布函数。通过验证您计算出的分布函数矩能够正确地恢复初始的密度和动量，您将巩固对这一核心概念的理解，这是实现 LBM 碰撞步骤前必不可少的一步。",
            "id": "3375057",
            "problem": "考虑用于单组分、弱可压缩流体的二维九速 (D2Q9) 格子上的等温格子玻尔兹曼方法 (LBM)。离散速度为\n$$\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1),$$\n格子权重为\n$$w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36},$$\n格子声速为\n$$c_s^{2} = \\frac{1}{3}。$$\n假设 $|\\boldsymbol{u}|/c_s \\ll 1$ 并使用矩匹配原理，使得平衡态分布函数的零阶、一阶和二阶离散速度矩能够在马赫数的二阶精度上重现等温可压缩欧拉级流体动力学场。具体要求如下：\n- 零阶矩恢复质量密度 $ \\rho $，\n- 一阶矩恢复动量密度 $ \\rho \\boldsymbol{u} $，\n- 二阶矩恢复等温压力张量 $ \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u} $。\n\n仅使用这些约束条件，推导与上述矩条件在 $|\\boldsymbol{u}|$ 的二阶精度上一致的 D2Q9 平衡态分布函数 $f_i^{eq}(\\rho,\\boldsymbol{u})$ 的通用形式。然后，对于特定状态\n$$\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right),$$\n计算所有九个平衡态分布函数 $f_i^{eq}$ (其中 $i=0,\\dots,8$)。最后，通过显式计算 $\\sum_{i=0}^{8} f_i^{eq}$ 和 $\\sum_{i=0}^{8} f_i^{eq}\\boldsymbol{c}_i$ 来验证密度和动量的恢复，并报告标量 $\\sum_{i} f_i^{eq}$ 和 $\\sum_{i} f_i^{eq}\\boldsymbol{c}_i$ 的两个分量。\n\n将最终答案表示为一个单行矩阵，其中包含 $9$ 个值 $f_0^{eq},f_1^{eq},\\dots,f_8^{eq}$，其后依次是 $\\sum_{i} f_i^{eq}$、$\\left(\\sum_{i} f_i^{eq} c_{ix}\\right)$ 和 $\\left(\\sum_{i} f_i^{eq} c_{iy}\\right)$。无需四舍五入，最终答案中不应包含单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **模型**：用于单组分、弱可压缩流体的二维九速 (D2Q9) 格子上的等温格子玻尔兹曼方法 (LBM)。\n-   **离散速度 $\\boldsymbol{c}_i$**：\n    $\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1)$，在格子单位下，$\\Delta x = 1$ 且 $\\Delta t = 1$。\n-   **格子权重 $w_i$**：\n    $w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36}$。\n-   **格子声速 $c_s$**：\n    $c_s^{2} = \\frac{1}{3}$。\n-   **低马赫数条件**：$|\\boldsymbol{u}|/c_s \\ll 1$。\n-   **平衡态分布函数 $f_i^{eq}$ 的矩约束**：\n    1.  零阶矩（密度）：$\\sum_{i=0}^{8} f_i^{eq} = \\rho$。\n    2.  一阶矩（动量）：$\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i = \\rho \\boldsymbol{u}$。\n    3.  二阶矩（动量通量）：$\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i \\boldsymbol{c}_i = \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u}$。\n-   **特定状态**：\n    $\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据科学性、适定性和客观性标准对问题进行评估。\n\n-   **科学基础**：该问题是计算流体动力学领域内的一个标准推导和应用，特别涉及格子玻尔兹曼方法。D2Q9 模型、其权重、声速以及平衡分布的矩匹配条件是 LBM 理论中基本且成熟的概念。该问题在科学上是合理的。\n-   **适定性**：该问题提供了推导平衡分布函数到指定阶数的通用形式以及计算其具体值所需的所有约束和数据。矩条件唯一地确定了 $f_i^{eq}$ 速度展开式的多项式系数。密度和速度的具体值定义明确。该问题是自洽且可唯一求解的。\n-   **客观性**：该问题以精确的数学语言陈述，没有任何主观或模棱两可的术语。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。这是一个计算物理学中的标准、适定问题，符合所有验证标准。将提供完整解答。\n\n### 平衡态分布函数的推导\n\n问题要求从矩条件推导 $f_i^{eq}(\\rho, \\boldsymbol{u})$ 的形式。一种标准方法是通过正交多项式的截断展开，在 LBM 中即为基于格子的埃尔米特多项式。我们寻求将 $f_i^{eq}$ 按宏观速度 $\\boldsymbol{u}$ 的幂次展开至二阶，这与低马赫数假设一致。\n\n我们将 $f_i^{eq}$ 展开为：\n$$f_i^{eq} = w_i \\left( A + B_{\\alpha} c_{i\\alpha} + C_{\\alpha\\beta} c_{i\\alpha} c_{i\\beta} + D_{\\alpha\\beta} \\delta_{\\alpha\\beta} \\right)$$\n其中重复的希腊下标表示对空间维度 ($x, y$) 求和。系数 $A$、$B_\\alpha$、$C_{\\alpha\\beta}$ 和 $D_{\\alpha\\beta}$ 是 $\\rho$ 和 $\\boldsymbol{u}$ 的函数。为简化起见，我们将它们表示为 $u$ 的多项式。\n一种更直接的方法是使用 Grad 型矩展开，用 $f_i^{eq}$ 的矩来表示它。对于二阶展开，其通用形式为：\n$$f_i^{eq} = w_i \\left( a^{(0)} + \\frac{a_{\\alpha}^{(1)} c_{i\\alpha}}{c_s^2} + \\frac{a_{\\alpha\\beta}^{(2)} (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right)$$\n其中 $a^{(0)}$、$a_\\alpha^{(1)}$ 和 $a_{\\alpha\\beta}^{(2)}$ 是 $f_i^{eq}$ 关于速度的零阶、一阶和二阶原始矩。\n流体动力学矩由以下约束条件给出：\n-   $a^{(0)} = \\sum_i f_i^{eq} = \\rho$\n-   $a_{\\alpha}^{(1)} = \\sum_i f_i^{eq} c_{i\\alpha} = \\rho u_\\alpha$\n-   $\\sum_i f_i^{eq} c_{i\\alpha}c_{i\\beta} = \\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$\n\n从展开式本身，我们也可以计算二阶矩：\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = \\sum_i w_i \\left( a^{(0)} + \\frac{a_{\\gamma}^{(1)} c_{i\\gamma}}{c_s^2} + \\frac{a_{\\gamma\\delta}^{(2)} (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta})}{2c_s^4} \\right) c_{i\\alpha} c_{i\\beta} $$\n使用格子各向同性性质 $\\sum_i w_i c_{i\\alpha} c_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta}$ 和 $\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma} = 0$，我们得到：\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = a^{(0)} c_s^2 \\delta_{\\alpha\\beta} + \\frac{a_{\\gamma\\delta}^{(2)}}{2c_s^4} \\sum_i w_i (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta}) c_{i\\alpha}c_{i\\beta} $$\n第二项包含四阶矩。由于我们匹配到 $\\boldsymbol{u}$ 的二阶矩，项 $a_{\\gamma\\delta}^{(2)}$ 本身是 $O(|\\boldsymbol{u}|^2)$ 阶。$\\sum f_i^{eq} c_{i\\alpha}c_{i\\beta}$ 的展开式实际上是 $\\rho c_s^2 \\delta_{\\alpha\\beta} + a_{\\alpha\\beta}^{(2)}$。\n通过与约束条件 $\\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$ 比较，我们可以确定二阶矩系数为 $a_{\\alpha\\beta}^{(2)} = \\rho u_\\alpha u_\\beta$。\n\n将 $a^{(0)}=\\rho$、$a_{\\alpha}^{(1)}=\\rho u_\\alpha$ 和 $a_{\\alpha\\beta}^{(2)}=\\rho u_\\alpha u_\\beta$ 代回 $f_i^{eq}$ 的展开式中：\n$$ f_i^{eq} = w_i \\left( \\rho + \\frac{(\\rho u_\\alpha) c_{i\\alpha}}{c_s^2} + \\frac{(\\rho u_\\alpha u_\\beta) (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right) $$\n提出因子 $\\rho$：\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{u_\\alpha c_{i\\alpha}}{c_s^2} + \\frac{u_\\alpha u_\\beta c_{i\\alpha}c_{i\\beta} - u_\\alpha u_\\beta c_s^2 \\delta_{\\alpha\\beta}}{2c_s^4} \\right) $$\n用矢量符号表示，即为：\n$$ f_i^{eq}(\\rho, \\boldsymbol{u}) = w_i \\rho \\left( 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_s^2} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2}{2c_s^4} - \\frac{|\\boldsymbol{u}|^2}{2c_s^2} \\right) $$\n这就是与矩条件在 $|\\boldsymbol{u}|$ 的二阶精度上一致的 D2Q9 平衡态分布函数的通用形式。\n\n### 特定平衡态分布函数的计算\n\n给定 $\\rho = \\frac{5}{4}$，$\\boldsymbol{u} = \\left(\\frac{1}{6}, -\\frac{1}{9}\\right)$ 以及 $c_s^2=\\frac{1}{3}$。\n我们将这些值代入推导出的公式中。首先，计算公共项：\n$$ \\frac{1}{c_s^2} = 3 $$\n$$ \\frac{1}{2c_s^4} = \\frac{9}{2} $$\n$$ |\\boldsymbol{u}|^2 = u_x^2 + u_y^2 = \\left(\\frac{1}{6}\\right)^2 + \\left(-\\frac{1}{9}\\right)^2 = \\frac{1}{36} + \\frac{1}{81} = \\frac{9+4}{324} = \\frac{13}{324} $$\n表达式变为：\n$$ f_i^{eq} = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{3}{2}\\frac{13}{324} \\right) = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216} \\right) $$\n现在，我们为每个 $i$ 计算 $\\boldsymbol{c}_i \\cdot \\boldsymbol{u}$：\n$\\boldsymbol{c}_0 \\cdot \\boldsymbol{u} = 0$,\n$\\boldsymbol{c}_1 \\cdot \\boldsymbol{u} = \\frac{1}{6}$,\n$\\boldsymbol{c}_2 \\cdot \\boldsymbol{u} = -\\frac{1}{9}$,\n$\\boldsymbol{c}_3 \\cdot \\boldsymbol{u} = -\\frac{1}{6}$,\n$\\boldsymbol{c}_4 \\cdot \\boldsymbol{u} = \\frac{1}{9}$,\n$\\boldsymbol{c}_5 \\cdot \\boldsymbol{u} = \\frac{1}{6}-\\frac{1}{9} = \\frac{1}{18}$,\n$\\boldsymbol{c}_6 \\cdot \\boldsymbol{u} = -\\frac{1}{6}-\\frac{1}{9} = -\\frac{5}{18}$,\n$\\boldsymbol{c}_7 \\cdot \\boldsymbol{u} = -\\frac{1}{6}+\\frac{1}{9} = -\\frac{1}{18}$,\n$\\boldsymbol{c}_8 \\cdot \\boldsymbol{u} = \\frac{1}{6}+\\frac{1}{9} = \\frac{5}{18}$。\n\n令 $S_i = 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216}$。我们计算 $f_i^{eq} = w_i (\\frac{5}{4}) S_i$：\n-   $i=0$： $S_0 = 1 - \\frac{13}{216} = \\frac{203}{216}$。 $f_0^{eq} = \\frac{4}{9} \\frac{5}{4} \\frac{203}{216} = \\frac{5}{9} \\frac{203}{216} = \\frac{1015}{1944}$。\n-   $i=1$： $S_1 = 1 + 3(\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 + \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216+108+27-13}{216} = \\frac{338}{216} = \\frac{169}{108}$。 $f_1^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{169}{108} = \\frac{5}{36} \\frac{169}{108} = \\frac{845}{3888}$。\n-   $i=2$： $S_2 = 1 + 3(-\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 - \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216-72+12-13}{216} = \\frac{143}{216}$。 $f_2^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{143}{216} = \\frac{5}{36} \\frac{143}{216} = \\frac{715}{7776}$。\n-   $i=3$： $S_3 = 1 + 3(-\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 - \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216-108+27-13}{216} = \\frac{122}{216} = \\frac{61}{108}$。 $f_3^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{61}{108} = \\frac{5}{36} \\frac{61}{108} = \\frac{305}{3888}$。\n-   $i=4$： $S_4 = 1 + 3(\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 + \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216+72+12-13}{216} = \\frac{287}{216}$。 $f_4^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{287}{216} = \\frac{5}{36} \\frac{287}{216} = \\frac{1435}{7776}$。\n-   $i=5$： $S_5 = 1 + 3(\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 + \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216+36+3-13}{216} = \\frac{242}{216} = \\frac{121}{108}$。 $f_5^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{121}{108} = \\frac{5}{144} \\frac{121}{108} = \\frac{605}{15552}$。\n-   $i=6$： $S_6 = 1 + 3(-\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 - \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216-180+75-13}{216} = \\frac{98}{216} = \\frac{49}{108}$。 $f_6^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{49}{108} = \\frac{5}{144} \\frac{49}{108} = \\frac{245}{15552}$。\n-   $i=7$： $S_7 = 1 + 3(-\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 - \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216-36+3-13}{216} = \\frac{170}{216} = \\frac{85}{108}$。 $f_7^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{85}{108} = \\frac{5}{144} \\frac{85}{108} = \\frac{425}{15552}$。\n-   $i=8$： $S_8 = 1 + 3(\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 + \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216+180+75-13}{216} = \\frac{458}{216} = \\frac{229}{108}$。 $f_8^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{229}{108} = \\frac{5}{144} \\frac{229}{108} = \\frac{1145}{15552}$。\n\n### 矩恢复的验证\n\n**密度：** 总和 $\\sum_{i=0}^{8} f_i^{eq}$ 必须等于 $\\rho = \\frac{5}{4}$。根据构造，$f_i^{eq}$ 公式的解析和得出 $\\rho$。我们用数值进行验证。使用公分母 $15552$：\n$$ \\sum f_i^{eq} = \\frac{8120 + 3380 + 1430 + 1220 + 2870 + 605 + 245 + 425 + 1145}{15552} = \\frac{19440}{15552} = \\frac{5 \\times 3888}{4 \\times 3888} = \\frac{5}{4} $$\n密度被正确恢复。\n\n**动量：** 总和 $\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i$ 必须等于 $\\rho\\boldsymbol{u} = \\frac{5}{4}(\\frac{1}{6}, -\\frac{1}{9}) = (\\frac{5}{24}, -\\frac{5}{36})$。\n-   x-分量： $\\sum f_i^{eq} c_{ix} = f_1^{eq}-f_3^{eq}+f_5^{eq}-f_6^{eq}-f_7^{eq}+f_8^{eq}$\n$$ \\sum f_i^{eq} c_{ix} = \\frac{3380 - 1220 + 605 - 245 - 425 + 1145}{15552} = \\frac{3240}{15552} = \\frac{5 \\times 648}{24 \\times 648} = \\frac{5}{24} $$\n-   y-分量： $\\sum f_i^{eq} c_{iy} = f_2^{eq}-f_4^{eq}+f_5^{eq}+f_6^{eq}-f_7^{eq}-f_8^{eq}$\n$$ \\sum f_i^{eq} c_{iy} = \\frac{1430 - 2870 + 605 + 245 - 425 - 1145}{15552} = \\frac{-2160}{15552} = \\frac{-5 \\times 432}{36 \\times 432} = -\\frac{5}{36} $$\n动量也被正确恢复。计算值是正确的。\n因此，最终答案的十二个量是：\n$f_0^{eq} = \\frac{1015}{1944}$, $f_1^{eq} = \\frac{845}{3888}$, $f_2^{eq} = \\frac{715}{7776}$, $f_3^{eq} = \\frac{305}{3888}$, $f_4^{eq} = \\frac{1435}{7776}$, $f_5^{eq} = \\frac{605}{15552}$, $f_6^{eq} = \\frac{245}{15552}$, $f_7^{eq} = \\frac{425}{15552}$, $f_8^{eq} = \\frac{1145}{15552}$, $\\sum f_i^{eq} = \\frac{5}{4}$, $\\sum (f_i^{eq} c_{ix}) = \\frac{5}{24}$, $\\sum (f_i^{eq} c_{iy}) = -\\frac{5}{36}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1015}{1944} & \\frac{845}{3888} & \\frac{715}{7776} & \\frac{305}{3888} & \\frac{1435}{7776} & \\frac{605}{15552} & \\frac{245}{15552} & \\frac{425}{15552} & \\frac{1145}{15552} & \\frac{5}{4} & \\frac{5}{24} & -\\frac{5}{36} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "为了连接理论与实践，本练习将要求您构建第一个完整的 LBM 求解器，用以模拟一个典型的物理问题：一维瞬态热传导。您将使用 D1Q3 格子实现一个耦合系统，其中一个求解器处理流体的动量，另一个则追踪在流体中扩散和被平流输运的被动标量（温度）。这个编程实践任务将引导您走过完整的 LBM 算法流程——包括初始化、碰撞-迁移循环以及周期性边界条件——同时通过将数值模型与精确的解析解进行对比，强化模型验证这一关键技能。",
            "id": "3375033",
            "problem": "设计并用代码实现一个完整的数值求解器，以使用格子玻尔兹曼方法（LBM）模拟一维瞬态热传导。对等温动量求解器和热能求解器均使用一维三速（D1Q3）格子，其中能量格子通过平流项与动量场耦合。将模拟的温度分布与周期性域中单个傅里叶模式的一维热方程的解析解进行对比验证。所有量均以无量纲的格子单位处理，空间步长 $\\Delta x = 1$ 且时间步长 $\\Delta t = 1$，因此不需要物理单位。\n\n从以下公认的基础出发：\n- 采用 Bhatnagar–Gross–Krook (BGK) 弛豫的动力学输运：分布函数 $f$ 的连续 Boltzmann–BGK 方程为 $\\partial_t f + \\boldsymbol{\\xi} \\cdot \\nabla f = -\\frac{1}{\\tau}(f - f^{\\mathrm{eq}})$，其中 $\\boldsymbol{\\xi}$ 是分子速度，$\\tau$ 是弛豫时间。\n- 格子玻尔兹曼方法（LBM）在一维三离散速度（D1Q3）下的离散速度公式：$e_0 = 0$, $e_1 = +1$, $e_2 = -1$，权重为 $w_0 = \\frac{2}{3}$ 和 $w_1 = w_2 = \\frac{1}{6}$，格子声速为 $c_s^2 = \\frac{1}{3}$。\n- Chapman–Enskog 展开下的流体动力学极限：针对被动标量的 D1Q3 BGK 格式可恢复为平流-扩散方程 $\\partial_t T + \\partial_x (u T) = \\partial_x (\\alpha \\partial_x T)$，其中热扩散系数在格子单位下为 $\\alpha = c_s^2 (\\tau_T - \\frac{1}{2}) \\Delta t$，条件是 $\\tau_T > \\frac{1}{2}$。\n\n您的程序必须：\n- 实现两个耦合的 D1Q3 LBM 求解器：\n  1. 一个等温动量求解器，使用 BGK 碰撞（弛豫时间为 $\\tau_f$）和周期性边界条件来推进密度 $\\rho$ 和速度 $u$。使用 D1Q3 平衡态 $f_i^{\\mathrm{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right]$。\n  2. 一个用于温度 $T$ 的热能求解器，使用 BGK 碰撞（弛豫时间为 $\\tau_T$）和周期性边界条件。使用平流平衡态 $g_i^{\\mathrm{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right]$，从而使能量格子与动量速度 $u$ 耦合。\n- 对两个格子都使用碰撞-迁移算法和周期性边界。\n- 将动量场初始化为处处均匀的 $\\rho = 1$ 和 $u = 0$，并将动量分布初始化为其在 $u=0$ 时的平衡态。\n- 在长度为 $L=N_x$ 个格子节点的周期性域中，将温度场初始化为单个傅里叶模式：\n  $$T(x, 0) = T_0 + A \\sin(k x), \\quad k = \\frac{2 \\pi m}{L}, \\quad x \\in \\{0, 1, \\dots, N_x - 1\\}.$$\n  将能量分布初始化为其在初始温度 $T$ 和 $u=0$ 时的平衡态。\n- 将耦合系统演化指定的 $N_t$ 个时间步。\n- 在相同的周期性域中计算一维热方程的解析解：\n  $$T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp\\!\\left( - \\alpha k^2 t \\right) \\sin(k x), \\quad \\alpha = c_s^2 \\left( \\tau_T - \\frac{1}{2} \\right), \\quad t = N_t \\Delta t,$$\n  并将其与 $N_t$ 步后从能量格子中提取的数值温度 $T_{\\mathrm{num}}(x, t)$ 进行比较。\n- 使用格子上的均方根误差（RMS）来量化差异：\n  $$\\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, t) - T_{\\mathrm{ana}}(x_j, t) \\right)^2 }.$$\n\n在所有计算中，使用以下 D1Q3 定义：$e_0 = 0$, $e_1 = +1$, $e_2 = -1$, $w_0 = \\frac{2}{3}$, $w_1 = w_2 = \\frac{1}{6}$, $c_s^2 = \\frac{1}{3}$，以及周期性边界条件。对于所有测试，将动量弛豫时间固定为 $\\tau_f = 0.6$。所有步长均采用格子单位，$\\Delta x = \\Delta t = 1$。\n\n测试套件：\n- 情况 A（中等扩散下的一般行为）：\n  - $N_x = 120$, $N_t = 1200$, $\\tau_T = 0.8$, $m = 1$, $A = 0.01$, $T_0 = 1.0$。\n- 情况 B（接近弛豫边界的慢扩散）：\n  - $N_x = 64$, $N_t = 3000$, $\\tau_T = 0.501$, $m = 3$, $A = 0.2$, $T_0 = 1.0$。\n- 情况 C（高扩散率）：\n  - $N_x = 100$, $N_t = 300$, $\\tau_T = 1.5$, $m = 2$, $A = 0.5$, $T_0 = 0.0$。\n\n您的程序应为每种情况计算 $\\varepsilon_{\\mathrm{RMS}}$，并生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 [情况 A, 情况 B, 情况 C]，每个值都四舍五入到小数点后六位（例如，“[0.001234,0.056789,0.000012]”）。",
            "solution": "用户问题已通过验证。\n\n### 步骤 1：提取已知信息\n- **模型**：使用格子玻尔兹曼方法（LBM）模拟的一维（$1$D）瞬态热传导。\n- **格子**：两个耦合的一维三速（D1Q3）格子。一个用于等温动量，一个用于热能。\n- **格子参数（D1Q3）**：\n    - 离散速度：$e_0 = 0, e_1 = +1, e_2 = -1$。\n    - 权重：$w_0 = \\frac{2}{3}, w_1 = w_2 = \\frac{1}{6}$。\n    - 格子声速的平方：$c_s^2 = \\frac{1}{3}$。\n- **格子单位**：$\\Delta x = 1$ 和 $\\Delta t = 1$。\n- **控制方程**：\n    - Boltzmann-BGK 方程：$\\partial_t f + \\boldsymbol{\\xi} \\cdot \\nabla f = -\\frac{1}{\\tau}(f - f^{\\mathrm{eq}})$。\n    - 恢复的温度 $T$ 的宏观方程：$\\partial_t T + \\partial_x (u T) = \\partial_x (\\alpha \\partial_x T)$。\n    - 热扩散系数：$\\alpha = c_s^2 (\\tau_T - \\frac{1}{2}) \\Delta t$，稳定性约束为 $\\tau_T > \\frac{1}{2}$。\n- **动量求解器**：\n    - 变量：密度 $\\rho$ 和速度 $u$。\n    - 弛豫时间：$\\tau_f = 0.6$。\n    - 平衡态分布：$f_i^{\\mathrm{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right]$。\n    - 初始条件：对于所有 $x$，$\\rho(x, 0) = 1$ 且 $u(x, 0) = 0$。动量分布 $f_i(x,0)$ 处于平衡态。\n- **热求解器**：\n    - 变量：温度 $T$。\n    - 弛豫时间：$\\tau_T$（按情况指定）。\n    - 平衡态分布：$g_i^{\\mathrm{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right]$。\n    - 初始条件：$T(x, 0) = T_0 + A \\sin(k x)$，其中 $k = \\frac{2 \\pi m}{L}$ 且 $L = N_x$。能量分布 $g_i(x,0)$ 处于平衡态。\n- **边界**：两个求解器均为周期性边界。\n- **算法**：碰撞-迁移。\n- **验证**：在 $t = N_t \\Delta t$ 时，将数值温度 $T_{\\mathrm{num}}$ 与解析解 $T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp(-\\alpha k^2 t) \\sin(k x)$ 进行比较。\n- **误差度量**：均方根误差 $\\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, t) - T_{\\mathrm{ana}}(x_j, t) \\right)^2 }$。\n- **测试用例**：\n    - 情况 A: $N_x = 120, N_t = 1200, \\tau_T = 0.8, m = 1, A = 0.01, T_0 = 1.0$。\n    - 情况 B: $N_x = 64, N_t = 3000, \\tau_T = 0.501, m = 3, A = 0.2, T_0 = 1.0$。\n    - 情况 C: $N_x = 100, N_t = 300, \\tau_T = 1.5, m = 2, A = 0.5, T_0 = 0.0$。\n\n### 步骤 2：使用提取的已知信息进行验证\n根据预定义标准对问题进行评估。\n- **科学依据**：该问题在计算流体动力学的格子玻尔兹曼方法的既定理论中有充分的依据。D1Q3 模型、BGK 碰撞算子、平衡态分布函数，以及导出平流-扩散方程的 Chapman-Enskog 分析都是 LBM 的标准且正确的要素。一维熱方程的解析解也是正确的。\n- **适定性**：该问题是适定的。它提供了获得唯一解所需的所有必要参数、初始条件和边界条件。所有测试用例的参数都满足稳定性条件 $\\tau_T > 0.5$。\n- **客观性**：问题以精确、客观和数学化的语言陳述，不含任何主观性。\n- **一致性**：问题设置是内部一致的。周期性域上均匀密度 $\\rho=1$ 和零速度 $u=0$ 的初始条件意味着动量场将保持静态。这将宏观平流-扩散方程简化为纯扩散方程，对此所提供的解析解是正确的。这不是矛盾，而是针对热求解器扩散行为的一个特定测试用例。\n\n### 步骤 3：结论与行动\n问题是有效的。它为一种数值方法提供了一个标准的验证练习。将提供一个完整的解决方案。\n\n### 解决方案\n\n该问题要求实现一个用于瞬态热传導的一维三速（D1Q3）格子玻尔兹曼方法（LBM）求解器。该模拟涉及两个耦合场：一个用于流体密度 $\\rho$ 和速度 $u$ 的动量场，以及一个用于温度 $T$ 的热场。该解将与热扩散的解析解进行对比验证。所有计算均在无量纲格子单位下执行，其中 $\\Delta x = 1$ 且 $\\Delta t = 1$。\n\nD1Q3 格子模型使用一组 3 个离散速度 $e_i$ 和相应的权重 $w_i$：\n- 速度：$e_0 = 0, e_1 = 1, e_2 = -1$。\n- 权重：$w_0 = \\frac{2}{3}, w_1 = \\frac{1}{6}, w_2 = \\frac{1}{6}$。\n格子声速的平方为 $c_s^2 = \\sum_i w_i e_i^2 = \\frac{1}{3}$。\n\nLBM 算法通过一系列碰撞和迁移步骤来推进离散分布函数，$f_i$ 用于动量，$g_i$ 用于能量。\n\n**1. 耦合的 LBM 求解器**\n\n**动量场：**\n动量场由分布函数 $f_i(x, t)$ 描述。宏观密度 $\\rho$ 和速度 $u$ 作为 $f_i$ 的矩来恢复：\n$$ \\rho = \\sum_{i=0}^{2} f_i, \\quad \\rho u = \\sum_{i=0}^{2} e_i f_i $$\n碰撞步骤在特征时间 $\\tau_f$ 内将 $f_i$ 弛豫到局部平衡态分布函数 $f_i^{\\mathrm{eq}}$：\n$$ f_i^{\\mathrm{eq}} = w_i \\rho \\left[ 1 + \\frac{e_i u}{c_s^2} + \\frac{(e_i u)^2}{2 c_s^4} - \\frac{u^2}{2 c_s^2} \\right] $$\n问题指定了均匀密度 $\\rho(x, 0) = 1$ 和零速度 $u(x, 0) = 0$ 的初始条件。在周期性边界条件且无外力作用的情况下，宏观均匀性的初始状态在所有时间内都得以保持。动量场保持在 $\\rho=1, u=0$ 的静态状态。虽然为了通用性，求解器的实现将包括动量场的更新步骤，但这些步骤不会产生净效应。\n\n**热场：**\n热场由能量分布函数 $g_i(x, t)$ 控制。温度 $T$ 是 $g_i$ 的零阶矩：\n$$ T = \\sum_{i=0}^{2} g_i $$\n热场的碰撞步骤以弛豫时间 $\\tau_T$ 将 $g_i$ 弛豫到其平衡态 $g_i^{\\mathrm{eq}}$：\n$$ g_i^{\\mathrm{eq}} = w_i \\left[ T + \\frac{e_i u}{c_s^2} T \\right] $$\n这个平衡函数通过速度 $u$ 将热场与动量场耦合。然而，由于此问题中 $u(x, t) = 0$，平衡态简化为纯扩散过程的平衡态：\n$$ g_i^{\\mathrm{eq}} = w_i T $$\n在宏观极限下，此 LBM 格式恢复为平流-扩散方程。当 $u=0$ 时，该方程简化为一维热方程 $\\partial_t T = \\alpha \\partial_x^2 T$，其中热扩散系数 $\\alpha$ 由下式给出：\n$$ \\alpha = c_s^2 \\left( \\tau_T - \\frac{1}{2} \\right) $$\n\n**2. 数值算法**\n\n对于每个测试用例，模拟按以下步骤进行：\n\n**初始化：**\n1.  计算域是一个包含 $N_x$ 个节点的 $1$D 网格，$x \\in \\{0, 1, \\dots, N_x-1\\}$。\n2.  动量场初始化为 $\\rho(x,0) = 1$ 和 $u(x,0) = 0$。分布函数 $f_i(x,0)$ 设置为其平衡值 $f_i^{\\mathrm{eq}}(\\rho=1, u=0)$。\n3.  初始温度场设置为正弦分布：$T(x, 0) = T_0 + A \\sin(k x)$，其中波数为 $k = \\frac{2 \\pi m}{N_x}$。分布函数 $g_i(x,0)$ 设置为其平衡值 $g_i^{\\mathrm{eq}}(T(x,0), u=0)$。\n\n**时间演化循环：**\n对于从 $t=0$ 到 $N_t-1$ 的每个时间步：\n1.  **宏观变量**：从 $f_i$ 计算 $\\rho, u$，从 $g_i$ 计算 $T$。（如前所述，$\\rho$ 和 $u$ 将保持不变）。\n2.  **碰撞**：根据 BGK 规则更新两组分布函数。对于弛豫时间为 $\\tau_{\\psi}$ 的分布 $\\psi_i \\in \\{f_i, g_i\\}$：\n    $$ \\psi_i^{\\text{post-collision}}(x, t) = \\psi_i(x, t) - \\frac{1}{\\tau_{\\psi}} \\left( \\psi_i(x, t) - \\psi_i^{\\mathrm{eq}}(x, t) \\right) $$\n3.  **迁移**：根据速度将碰撞后的分布函数传播到相邻节点。这通过对分布函数数组进行循环移位（roll）来实现，以强制施加周期性边界条件：\n    $$ \\psi_i(x, t+\\Delta t) = \\psi_i^{\\text{post-collision}}(x - e_i \\Delta x, t) $$\n    具体来说，$e_1=1$ 的分布函数向右移动，$e_2=-1$ 的分布函数向左移动。$e_0=0$ 的分布函数保持原位。\n\n**3. 验证与误差计算**\n\n经过 $N_t$ 个时间步后，通过对最终的能量分布 $g_i$ 求和，得到最终的数值温度 $T_{\\mathrm{num}}(x, N_t)$。将此结果与具有相同初始和边界条件的一维热方程的解析解进行比较：\n$$ T_{\\mathrm{ana}}(x, t) = T_0 + A \\exp(-\\alpha k^2 t) \\sin(k x) $$\n其中 $t = N_t$ 且 $\\alpha = c_s^2(\\tau_T - 0.5)$。偏差由均方根误差 $\\varepsilon_{\\mathrm{RMS}}$ 量化：\n$$ \\varepsilon_{\\mathrm{RMS}} = \\sqrt{ \\frac{1}{N_x} \\sum_{j=0}^{N_x-1} \\left( T_{\\mathrm{num}}(x_j, N_t) - T_{\\mathrm{ana}}(x_j, N_t) \\right)^2 } $$\n对问题陈述中指定的三个测试用例重复此过程，并报告所得的 $\\varepsilon_{\\mathrm{RMS}}$ 值。",
            "answer": "```python\nimport numpy as np\n\ndef run_lbm_simulation(Nx, Nt, tau_T, m, A, T0):\n    \"\"\"\n    Runs a 1D LBM simulation for coupled momentum and heat transfer.\n    \n    Args:\n        Nx (int): Number of lattice nodes.\n        Nt (int): Number of time steps.\n        tau_T (float): Relaxation time for the thermal field.\n        m (int): Wavenumber mode for the initial temperature profile.\n        A (float): Amplitude of the initial temperature sine wave.\n        T0 (float): Base initial temperature.\n        \n    Returns:\n        float: The root-mean-square error between numerical and analytical solutions.\n    \"\"\"\n    \n    # --- Fixed and D1Q3 Lattice Parameters ---\n    tau_f = 0.6  # Relaxation time for momentum field\n    \n    # D1Q3 velocities, weights, and sound speed squared\n    e = np.array([0, 1, -1])\n    w = np.array([2/3, 1/6, 1/6])\n    cs2 = 1/3\n\n    # --- Initialization ---\n    \n    # Spatial grid and wavenumber\n    x_grid = np.arange(Nx)\n    k = 2 * np.pi * m / Nx\n    \n    # Momentum field initialization\n    # Macroscopic variables: rho (density), u (velocity)\n    rho = np.ones(Nx)  # rho = 1.0 everywhere\n    u = np.zeros(Nx)   # u = 0.0 everywhere\n    \n    # Microscopic distribution functions f for momentum\n    # Initialize f to equilibrium for rho=1, u=0\n    f = np.zeros((3, Nx))\n    u_term = (e[:, np.newaxis] * u) / cs2\n    f_eq = w[:, np.newaxis] * rho * (1 + u_term + 0.5 * u_term**2 - 0.5 * u**2 / cs2)\n    f[:, :] = f_eq\n    \n    # Thermal field initialization\n    # Macroscopic variable: T (temperature)\n    T = T0 + A * np.sin(k * x_grid)\n    \n    # Microscopic distribution functions g for thermal energy\n    # Initialize g to equilibrium for initial T and u=0\n    g_eq = w[:, np.newaxis] * T * (1 + (e[:, np.newaxis] * u) / cs2)\n    g = np.zeros((3, Nx))\n    g[:, :] = g_eq\n\n    # --- Main Time-Stepping Loop ---\n    for _ in range(Nt):\n        # 1. Macroscopic properties (recalculated for generality, though rho/u are static)\n        rho = np.sum(f, axis=0)\n        u = (f[1, :] - f[2, :]) / rho\n        T = np.sum(g, axis=0)\n\n        # 2. Collision step\n        # Calculate equilibrium distributions\n        u_term = (e[:, np.newaxis] * u) / cs2\n        f_eq = w[:, np.newaxis] * rho * (1 + u_term + 0.5 * u_term**2 - 0.5 * u**2 / cs2)\n        g_eq = w[:, np.newaxis] * T * (1 + u_term)\n        \n        # Apply BGK collision\n        f += -(1.0 / tau_f) * (f - f_eq)\n        g += -(1.0 / tau_T) * (g - g_eq)\n\n        # 3. Streaming step (with periodic boundaries)\n        f[1, :] = np.roll(f[1, :], 1)\n        f[2, :] = np.roll(f[2, :], -1)\n        g[1, :] = np.roll(g[1, :], 1)\n        g[2, :] = np.roll(g[2, :], -1)\n\n    # --- Post-Processing and Validation ---\n    \n    # Final numerical temperature\n    T_num = np.sum(g, axis=0)\n    \n    # Analytical solution\n    # With dt=1, time t=Nt\n    alpha = cs2 * (tau_T - 0.5)\n    t = Nt\n    decay_term = np.exp(-alpha * k**2 * t)\n    T_ana = T0 + A * decay_term * np.sin(k * x_grid)\n    \n    # Root-Mean-Square Error calculation\n    rms_error = np.sqrt(np.mean((T_num - T_ana)**2))\n    \n    return rms_error\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case A: (Nx, Nt, tau_T, m, A, T0)\n        (120, 1200, 0.8, 1, 0.01, 1.0),\n        # Case B\n        (64, 3000, 0.501, 3, 0.2, 1.0),\n        # Case C\n        (100, 300, 1.5, 2, 0.5, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Nt, tau_T, m, A, T0 = case\n        rms_error = run_lbm_simulation(Nx, Nt, tau_T, m, A, T0)\n        results.append(f\"{rms_error:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "这项高级实践将挑战您模拟一个研究湍流的经典问题：二维泰勒-格林涡的衰减。您将开发一个 D2Q9 LBM 求解器，并通过引入 Smagorinsky 大涡模拟（LES）模型对其进行功能增强，该模型会根据流场的局部应变率引入一个非均匀的涡粘性。这个练习不仅展示了 LBM 框架在处理复杂流动问题时的强大功能和灵活性，也为学生提供了亚格子模型方面的实践经验——这是计算流体动力学中处理高雷诺数现象的一项至关重要的技术。",
            "id": "3375021",
            "problem": "您的任务是，从基本原理出发，在格子玻尔兹曼方法（LBM）框架下构建一个完整的数值模拟器，用于研究二维泰勒-格林涡的衰减，以及通过Smagorinsky大涡模拟（LES）封闭模型进行的亚格子建模对动能衰减率的影响。该模拟器必须是一个完全自洽且可直接运行的单一程序。\n\n其基本出发点是流体动力学的动理学表述，即通过玻尔兹曼方程及其在离散速度设定下的单弛豫时间Bhatnagar-Gross-Krook（BGK）模型。在二维九速（$\\mathrm{D2Q9}$）格子中，离散粒子分布函数 $f_i(\\mathbf{x}, t)$ 在碰撞和迁移的共同作用下演化。宏观密度 $\\rho(\\mathbf{x}, t)$ 和速度 $\\mathbf{u}(\\mathbf{x}, t)$ 通过 $f_i$ 的速度矩来恢复。平衡分布函数 $f_i^{\\mathrm{eq}}$ 的定义是通过将这些矩与等温格子的流体动力学场相匹配，而碰撞步则以由弛豫时间 $\\tau$ 控制的速率使 $f_i$ 向 $f_i^{\\mathrm{eq}}$ 松弛。在格子单位下，运动粘度 $\\nu$ 与弛豫时间通过 $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$ 相关联，其中 $c_s^2$ 是格子声速的平方。您必须将Smagorinsky LES封闭模型建模为基于局部应变率张量模的局部涡粘度 $\\nu_t$，从而定义一个有效粘度 $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$ 和一个局部弛豫时间 $\\tau_{\\mathrm{eff}} = \\frac{\\nu_{\\mathrm{eff}}}{c_s^2} + \\frac{1}{2}$。滤波宽度必须取为与格子间距相等。\n\n目标流场是边长为 $L$ 的周期性方形区域上的二维泰勒-格林涡，其初始速度场是无散的，并由下式给出：\n$$\nu_x(x,y,0) = U_0 \\cos(k x)\\,\\sin(k y), \\qquad\nu_y(x,y,0) = - U_0 \\sin(k x)\\,\\cos(k y),\n$$\n其中基波数 $k = \\frac{2\\pi}{L}$。对于不可压缩粘性流体，模式振幅随时间衰减，单位质量的动能，\n$$\nE(t) = \\frac{1}{2}\\left\\langle u_x^2 + u_y^2 \\right\\rangle,\n$$\n有一个已知的参考演化过程，您必须将其用作无亚格子建模情况下的直接数值模拟（DNS）比较基准。您的实现必须对LBM方程进行时间上的数值积分，计算最终时刻的空间平均动能 $E_{\\mathrm{LBM}}(t)$，并将其与根据层流（无LES）情况下泰勒-格林涡的精确粘性衰减计算出的解析参考值 $E_{\\mathrm{ref}}(t)$ 进行比较。Smagorinsky常数 $C_s$ 的影响必须通过由局部应变率模定义的涡粘度 $\\nu_t$ 来引入。\n\n您必须从以下基本依据开始推导：\n- 二维情况下具有Bhatnagar-Gross-Krook（BGK）弛豫的离散速度玻尔兹曼方程。\n- 通过分布函数的速度矩来定义宏观场。\n- 通过Hermite投影得到的、在密度和动量上匹配至二阶的等温格子平衡分布。\n- 对于$\\mathrm{D2Q9}$格子，在格子单位下的关系式 $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$。\n- 用于大涡模拟（LES）的Smagorinsky模型，其中涡粘度为 $\\nu_t = \\left(C_s \\Delta\\right)^2 \\left\\lVert S \\right\\rVert$，$\\Delta$ 为滤波宽度，$\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$，且 $S_{ij} = \\frac{1}{2}\\left(\\partial_j u_i + \\partial_i u_j\\right)$。\n- 用于参考比较的二维精确层流泰勒-格林涡衰减。\n\n您的程序必须实现：\n- 在方形格子上具有周期性边界条件的二维$\\mathrm{D2Q9}$ LBM。\n- 从 $\\nu_{\\mathrm{eff}}(\\mathbf{x}, t) = \\nu + \\nu_t(\\mathbf{x}, t)$ 得到的局部弛豫时间 $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)$，其中 $\\nu_t$ 使用中心差分计算速度梯度，且 $\\Delta = 1$（格子间距）。\n- 通过泰勒-格林涡速度场和均匀密度进行初始化。\n\n科学和数值参数及单位：\n- 完全在格子单位下工作，$\\Delta x = \\Delta y = \\Delta t = 1$，因此在此设定下所有量均为无量纲。\n- 格子尺寸 $N_x = N_y = 64$，因此 $L = 64$ 且 $k = \\frac{2\\pi}{64}$。\n- 基础运动粘度 $\\nu = 0.01$。\n- 初始速度幅值 $U_0 = 0.05$。\n- 总时间步数 $N_t = 300$。\n- 使用标准的$\\mathrm{D2Q9}$速度和权重，以及 $c_s^2 = \\frac{1}{3}$。\n\n测试套件：\n- 程序必须运行四个测试用例，每个用例由一个Smagorinsky常数 $C_s$ 指定：$C_s = 0.0$（无LES），$C_s = 0.12$，$C_s = 0.18$ 和 $C_s = 0.24$。\n- 对于每个测试用例，计算最终时刻的LBM动能 $E_{\\mathrm{LBM}}(t=N_t)$，基于层流泰勒-格林衰减的解析参考能量 $E_{\\mathrm{ref}}(t=N_t)$，并报告无量纲偏差\n$$\n\\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1.\n$$\n\n输出规格：\n- 您的程序必须生成单行输出，其中包含四个测试用例的结果，形式为逗号分隔并用方括号括起来的列表，例如 $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$。\n- 每个 $\\delta(C_s)$ 必须是保留六位小数的十进制数。\n- 输出是无量纲的，并且必须严格按照指定的单行格式打印。\n\n解决方案必须从上述基本依据出发，推导和论证数值流程及诊断量，解释为什么在此背景下泰勒-格林涡衰减是合适的DNS参考，并阐明Smagorinsky常数如何以及为何通过增加有效粘度来改变衰减。特别是，要确保您的推导清晰地展示LBM更新是什么，为什么它在该体系下是正确的，以及算法如何以科学上一致的方式计算应变率和涡粘度。避免非物理构型，并通过在任何地方都保持弛豫时间大于 $\\frac{1}{2}$ 来确保稳定性。",
            "solution": "该问题陈述是计算流体动力学中一个有效且适定的数值实验。它要求开发一个格子玻尔兹曼方法（LBM）模拟器，用于模拟一个二维衰减湍流，特别是泰勒-格林涡。该问题包括与解析解的比较，以及对亚格子尺度模型——Smagorinsky大涡模拟（LES）模型——效果的研究。所有必要的物理和数值参数都已提供，并且该问题在科学上根植于流体动力学和数值方法的既定原理。\n\n根据要求，解决方案将从基本原理出发进行阐述。我们首先从格子玻尔兹曼方法的理论基础开始，然后引入Smagorinsky LES模型，详细说明泰勒-格林涡流的具体情况，最后概述完整的数值算法和待计算的诊断量。\n\n**1. 格子玻尔兹曼方程**\n\nLBM描述了一组粒子分布函数 $f_i(\\mathbf{x}, t)$ 在离散格子上的演化。每个函数 $f_i$ 代表在位置 $\\mathbf{x}$ 和时间 $t$ 以离散速度 $\\mathbf{c}_i$ 运动的粒子密度。其演化由离散速度玻尔兹曼方程控制。采用Bhatnagar-Gross-Krook（BGK）近似处理碰撞项，该方程为：\n$$\n\\frac{\\partial f_i}{\\partial t} + \\mathbf{c}_i \\cdot \\nabla f_i = -\\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n其中 $\\tau$ 是单弛豫时间，它控制分布函数向局部平衡分布 $f_i^{\\mathrm{eq}}$ 松弛的速率。在时间和空间上将此方程离散化，并设 $\\Delta t = \\Delta x = 1$（格子单位），得到LBM更新规则，该规则通常分为碰撞和迁移两个步骤。\n\n**碰撞步**：处理方程右侧。在每个格子节点上计算碰撞后的分布 $f_i^*$：\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n\n**迁移步**：处理方程左侧的平流项。碰撞后的布居根据其离散速度移动到相邻节点：\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n$$\n在我们的格子单位中，这简化为 $f_i(\\mathbf{x} + \\mathbf{c}_i, t + 1) = f_i^*(\\mathbf{x}, t)$。\n\n**2. D2Q9格子模型**\n\n对于二维流，D2Q9模型是标准模型。它使用一个具有九个离散速度 $\\mathbf{c}_i$（$i=0, \\dots, 8$）的方形格子。\n-   $\\mathbf{c}_0 = (0, 0)$ （静止粒子）\n-   $\\mathbf{c}_{1,2,3,4} = (1, 0), (0, 1), (-1, 0), (0, -1)$ （轴向速度，速率为 $1$）\n-   $\\mathbf{c}_{5,6,7,8} = (1, 1), (-1, 1), (-1, -1), (1, -1)$ （对角线速度，速率为 $\\sqrt{2}$）\n\n与每个速度相关联的是一个权重 $w_i$：\n-   $w_0 = 4/9$\n-   $w_{1,2,3,4} = 1/9$\n-   $w_{5,6,7,8} = 1/36$\n\n选择这些权重和速度是为了使模型在低马赫数极限下能够恢复纳维-斯托克斯方程。格子声速由 $c_s^2 = \\sum_i w_i (\\mathbf{c}_{ix})^2 = 1/3$ 给出。\n\n**3. 宏观流体动力学变量**\n\n宏观流体密度 $\\rho$ 和动量 $\\rho \\mathbf{u}$（从而得到速度 $\\mathbf{u}$）是作为分布函数的矩来恢复的：\n$$\n\\rho(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t)\n$$\n$$\n\\rho(\\mathbf{x}, t) \\mathbf{u}(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t) \\mathbf{c}_i\n$$\n\n**4. 平衡分布函数**\n\n平衡分布 $f_i^{\\mathrm{eq}}$ 是局部宏观密度和速度的函数。对于近不可压缩（低马赫数）区域，使用麦克斯韦-玻尔兹曼分布在速度 $\\mathbf{u}$ 上的二阶展开：\n$$\nf_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right]\n$$\n这种形式确保 $f_i^{\\mathrm{eq}}$ 的矩返回正确的宏观 $\\rho$ 和 $\\rho\\mathbf{u}$，这对于恢复正确形式的纳维-斯托克斯方程至关重要。\n\n**5. 粘度与Smagorinsky LES模型**\n\n通过Chapman-Enskog展开可以证明，LBM-BGK模型恢复的纳维-斯托克斯方程的运动粘度 $\\nu$ 与弛豫时间 $\\tau$ 的关系为：\n$$\n\\nu = c_s^2 \\left( \\tau - \\frac{1}{2} \\right)\n$$\n该问题要求模拟一个可能在小于格子分辨率的尺度上发展出湍流特征的流。大涡模拟（LES）是一种用于模拟这些未解析的亚格子尺度对解析流影响的技术。Smagorinsky模型是一个代数亚格子尺度模型，它引入一个涡粘度 $\\nu_t$，该粘度取决于解析流的局部应变率。\n总有效粘度变为 $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$，其中 $\\nu$ 是基础分子粘度。涡粘度由下式给出：\n$$\n\\nu_t = (C_s \\Delta)^2 \\left\\lVert S \\right\\rVert\n$$\n这里，$C_s$ 是无量纲的Smagorinsky常数，$\\Delta$ 是滤波宽度（取为格子间距，因此 $\\Delta = 1$），而 $\\left\\lVert S \\right\\rVert$ 是解析尺度应变率张量 $S_{ij}$ 的模。\n\n应变率张量定义为 $S_{ij} = \\frac{1}{2}(\\partial_j u_i + \\partial_i u_j)$，其中 $\\partial_i \\equiv \\partial/\\partial x_i$。其模为 $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$。在二维情况下，这展开为：\n$$\n\\left\\lVert S \\right\\rVert = \\sqrt{2 \\left( S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2 \\right)}\n$$\n其中 $S_{xx} = \\partial_x u_x$, $S_{yy} = \\partial_y u_y$, $S_{xy} = \\frac{1}{2}(\\partial_y u_x + \\partial_x u_y)$。这些速度梯度必须在每个时间步从格子上的速度场数值计算得到。我们使用二阶中心差分格式，例如 $\\partial_x \\phi(x,y) \\approx (\\phi(x+1,y) - \\phi(x-1,y))/2$。\n\n$\\nu_t$ 的引入意味着粘度不再是均匀的。这通过定义一个局部的、随时间变化的有效弛豫时间 $\\tau_{\\mathrm{eff}}$ 被整合到LBM中：\n$$\n\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = \\frac{\\nu_{\\mathrm{eff}}(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2} = \\frac{\\nu + \\nu_t(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2}\n$$\n然后，碰撞步使用这个局部的 $\\tau_{\\mathrm{eff}}$ 来执行：\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n较大的 $C_s$ 会在高剪切区域产生较大的涡粘度，导致较大的 $\\tau_{\\mathrm{eff}}$，从而增强动能的耗散，模拟了湍流涡的物理效应。为保证稳定性，要求处处 $\\tau_{\\mathrm{eff}} > 1/2$。由于 $\\nu > 0$ 且 $\\nu_t \\ge 0$，问题的参数（$\\nu=0.01$，所以基础 $\\tau = 0.53 > 0.5$）满足此条件。\n\n**6. 泰勒-格林涡**\n\n泰勒-格林涡是双周期域上不可压缩纳维-斯托克斯方程的一个精确解。它作为验证粘性和湍流数值格式的典范问题。初始速度场由下式给出：\n$$\nu_x(x,y,0) = U_0 \\cos(kx)\\sin(ky)\n$$\n$$\nu_y(x,y,0) = -U_0 \\sin(kx)\\cos(ky)\n$$\n其中 $k = 2\\pi/L$ 是边长为 $L$ 的区域的基波数。\n对于层流情况（即没有任何湍流模型，对应于$C_s=0$），速度场解析地衰减为：\n$$\nu_x(x,y,t) = U_0 \\cos(kx)\\sin(ky) e^{-2\\nu k^2 t}\n$$\n$$\nu_y(x,y,t) = -U_0 \\sin(kx)\\cos(ky) e^{-2\\nu k^2 t}\n$$\n单位质量的空间平均动能 $E(t) = \\frac{1}{2} \\langle u_x^2 + u_y^2 \\rangle$ 提供了一个单一的度量来跟踪流的演化。对于解析解，这是：\n$$\nE_{\\mathrm{ref}}(t) = \\frac{1}{2} \\left\\langle U_0^2 e^{-4\\nu k^2 t} (\\cos^2(kx)\\sin^2(ky) + \\sin^2(kx)\\cos^2(ky)) \\right\\rangle\n$$\n利用在一个周期内 $\\langle \\cos^2(\\cdot) \\rangle = \\langle \\sin^2(\\cdot) \\rangle = 1/2$ 这一事实，空间平均项变为 $\\langle \\dots \\rangle = (1/2)(1/2) + (1/2)(1/2) = 1/2$。因此，参考的解析能量衰减为：\n$$\nE_{\\mathrm{ref}}(t) = \\frac{U_0^2}{4} e^{-4\\nu k^2 t}\n$$\n这提供了基准（“DNS参考”），可以用来验证$C_s=0$时的LBM模拟，并量化$C_s>0$时LES模型的效果。\n\n**7. 数值算法与诊断**\n\n单个测试用例的完整算法如下：\n\n- **初始化 ($t=0$):**\n    1.  为大小为 $N_x \\times N_y$ 的区域定义格子网格 $(x, y)$。这里 $N_x = N_y = L = 64$。\n    2.  将初始密度设为常数，$\\rho(\\mathbf{x}, 0) = \\rho_0 = 1$。\n    3.  使用泰勒-格林涡方程计算初始速度场 $\\mathbf{u}(\\mathbf{x}, 0)$。\n    4.  将分布函数初始化为其平衡值：$f_i(\\mathbf{x}, 0) = f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x}, 0), \\mathbf{u}(\\mathbf{x}, 0))$。\n\n- **时间循环 (从 $t=1$ 到 $N_t$):**\n    1.  **迁移**：将布居移动到相邻节点。拉模式（pull scheme）在计算上是高效的：$f_i(\\mathbf{x}, t_{post-stream}) = f_i(\\mathbf{x}-\\mathbf{c}_i, t_{post-collision})$。周期性边界条件可以通过模运算或`numpy.roll`自然处理。\n    2.  **宏观场**：使用矩求和从迁移后的布居 $f_i$ 计算 $\\rho(\\mathbf{x}, t)$ 和 $\\mathbf{u}(\\mathbf{x}, t)$。\n    3.  **LES计算 (如果 $C_s > 0$):**\n        a. 通过二阶中心差分计算速度梯度分量（$\\partial_x u_x, \\partial_y u_x, \\ldots$）。\n        b. 组装应变率张量分量 $S_{ij}$ 并计算其模 $\\left\\lVert S \\right\\rVert$。\n        c. 计算涡粘度 $\\nu_t(\\mathbf{x}, t) = C_s^2 \\left\\lVert S(\\mathbf{x}, t) \\right\\rVert$。\n        d. 确定局部有效弛豫时间 $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = (\\nu + \\nu_t)/c_s^2 + 1/2$。\n    4.  **碰撞**:\n        a. 从当前的宏观 $\\rho$ 和 $\\mathbf{u}$ 计算平衡分布 $f_i^{\\mathrm{eq}}(\\mathbf{x}, t)$。\n        b. 使用局部弛豫时间 $\\tau_{\\mathrm{eff}}$（如果$C_s=0$，则使用常数基础$\\tau$）应用碰撞步：\n           $f_i(\\mathbf{x}, t_{post-collision}) = f_i - (1/\\tau_{\\mathrm{eff}})(f_i - f_i^{\\mathrm{eq}})$。\n\n- **最终计算 ($t=N_t$):**\n    1.  在最后一个时间步之后，计算最终速度场 $\\mathbf{u}(\\mathbf{x}, N_t)$。\n    2.  通过在区域上求平均来计算数值动能：$E_{\\mathrm{LBM}}(N_t) = \\frac{1}{2 N_x N_y} \\sum_{\\mathbf{x}} (u_x^2(\\mathbf{x}, N_t) + u_y^2(\\mathbf{x}, N_t))$。\n    3.  计算解析参考能量 $E_{\\mathrm{ref}}(N_t) = (U_0^2/4) \\exp(-4\\nu k^2 N_t)$。\n    4.  计算最终诊断量，即无量纲偏差 $\\delta(C_s)$：\n        $$\n        \\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1\n        $$\n对每个指定的Smagorinsky常数 $C_s$ 值重复此过程。$C_s=0$ 的情况用作验证底层求解器的精度，我们期望 $\\delta(0) \\approx 0$。对于$C_s>0$，由于涡粘度导致的增强耗散将使 $E_{\\mathrm{LBM}}(N_t)$ 小于 $E_{\\mathrm{ref}}(N_t)$，从而产生负的 $\\delta(C_s)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates the decay of a 2D Taylor-Green vortex using the Lattice Boltzmann Method\n    with a Smagorinsky LES model.\n    \"\"\"\n    \n    # Scientific and numerical parameters in lattice units\n    Nx = 64          # Lattice size in x-direction\n    Ny = 64          # Lattice size in y-direction\n    Nt = 300         # Total number of time steps\n    nu = 0.01        # Base kinematic viscosity\n    U0 = 0.05        # Initial velocity amplitude\n    rho0 = 1.0       # Initial uniform density\n    \n    test_cases_Cs = [0.0, 0.12, 0.18, 0.24] # Smagorinsky constants\n\n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1.0 / 3.0  # Speed of sound squared\n\n    # Pre-calculate reference energy decay for comparison\n    k = 2.0 * np.pi / Nx\n    E_ref_final = (U0**2 / 4.0) * np.exp(-4.0 * nu * k**2 * Nt)\n\n    results = []\n    \n    for Cs in test_cases_Cs:\n        \n        # --- Initialization ---\n        # Create lattice grid\n        x = np.arange(Nx)\n        y = np.arange(Ny)\n        X, Y = np.meshgrid(x, y)\n\n        # Initialize velocity field (Taylor-Green vortex)\n        ux = U0 * np.cos(k * X) * np.sin(k * Y)\n        uy = -U0 * np.sin(k * X) * np.cos(k * Y)\n\n        # Initialize density\n        rho = np.full((Ny, Nx), rho0)\n\n        # Initialize distribution functions to equilibrium\n        u_sq = ux**2 + uy**2\n        c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n        \n        feq = np.zeros((9, Ny, Nx))\n        for i in range(9):\n            feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n        \n        f = feq.copy()\n        \n        # Base relaxation time (for Cs=0 case)\n        tau_base = nu / cs2 + 0.5\n        omega_base = 1.0 / tau_base\n\n        # --- Time-stepping loop ---\n        for t in range(Nt):\n            # Streaming (pull scheme)\n            for i in range(9):\n                f[i, :, :] = np.roll(f[i, :, :], c[i], axis=(1, 0))\n\n            # Macroscopic variables from streamed populations\n            rho = np.sum(f, axis=0)\n            ux = np.einsum('iyx,i->yx', f, c[:, 0]) / rho\n            uy = np.einsum('iyx,i->yx', f, c[:, 1]) / rho\n\n            # --- Collision Step ---\n            # Equilibrium distribution\n            u_sq = ux**2 + uy**2\n            c_dot_u = np.einsum('ia,yxa->iyx', c, np.stack([ux, uy], axis=-1))\n            for i in range(9):\n                feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n\n            # Determine relaxation parameter omega\n            if Cs > 0:\n                # Calculate strain rate tensor components using central differences\n                # Gradients are calculated using np.roll for periodic boundaries\n                # dux/dx\n                grad_ux_x = (np.roll(ux, -1, axis=1) - np.roll(ux, 1, axis=1)) / 2.0\n                # dux/dy\n                grad_ux_y = (np.roll(ux, -1, axis=0) - np.roll(ux, 1, axis=0)) / 2.0\n                # duy/dx\n                grad_uy_x = (np.roll(uy, -1, axis=1) - np.roll(uy, 1, axis=1)) / 2.0\n                # duy/dy\n                grad_uy_y = (np.roll(uy, -1, axis=0) - np.roll(uy, 1, axis=0)) / 2.0\n                \n                Sxx = grad_ux_x\n                Syy = grad_uy_y\n                Sxy = 0.5 * (grad_ux_y + grad_uy_x)\n\n                # Strain rate magnitude\n                S_mag = np.sqrt(2.0 * (Sxx**2 + Syy**2 + 2.0 * Sxy**2))\n                \n                # Eddy viscosity\n                nu_t = (Cs**2) * S_mag # Delta = 1 in lattice units\n                \n                # Effective relaxation time\n                tau_eff = (nu + nu_t) / cs2 + 0.5\n                omega = 1.0 / tau_eff\n            else:\n                omega = omega_base\n            \n            # Apply collision\n            f += omega * (feq - f)\n            \n        # --- Post-processing ---\n        # Final kinetic energy from LBM simulation\n        final_ux = np.einsum('iyx,i->yx', f, c[:, 0]) / np.sum(f, axis=0)\n        final_uy = np.einsum('iyx,i->yx', f, c[:, 1]) / np.sum(f, axis=0)\n        E_lbm_final = 0.5 * np.mean(final_ux**2 + final_uy**2)\n\n        # Calculate dimensionless deviation\n        deviation = (E_lbm_final / E_ref_final) - 1.0\n        results.append(deviation)\n\n    # Final print statement in the exact required format\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}