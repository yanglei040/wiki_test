{
    "hands_on_practices": [
        {
            "introduction": "在计算磁流体动力学中，精确地保持磁场的无散约束（即 $\\nabla \\cdot \\mathbf{B} = 0$）是至关重要的。在连续介质理论中，通过矢量势 $\\mathbf{A}$ 定义磁场 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ 可以自动满足此约束。本练习旨在将这一思想推广到离散世界，指导您构建一个离散的旋度算子，该算子在代数上严格保证离散散度为零，这是构建结构保持或“仿拟”数值格式的基石。",
            "id": "3343379",
            "problem": "考虑一个用于磁流体动力学 (MHD) 的导电流体域的均匀、周期性、立方计算网格，其中磁场由矢量势的旋度表示。目标是为矢量势构建一个离散旋度算子，并分析其截断误差，同时严格保持磁场的无散度约束。\n\n从以下基本原理出发：\n- 磁场由矢量势的旋度定义，即 $\\,\\mathbf{B}=\\nabla\\times\\mathbf{A}\\,$，根据矢量微积分恒等式 $\\,\\nabla\\cdot(\\nabla\\times\\mathbf{A})=0\\,$，这在连续设定下确保了 $\\,\\nabla\\cdot\\mathbf{B}=0\\,$。\n- 在具有周期性边界条件的均匀网格上，任何由跨方向可交换的网格平移算子构建的离散导数算子都存在此恒等式的离散模拟，即当在所有方向上一致使用相同的中心差分格式时，离散旋度的离散散度恒等于机器精度。\n\n定义计算设置：\n- 设立方域为 $\\,\\Omega=[0,2\\pi]^3\\,$，坐标为 $\\,x\\in[0,2\\pi]\\,$, $\\,y\\in[0,2\\pi]\\,$, $\\,z\\in[0,2\\pi]\\,$，以弧度为单位。\n- 使用一个每个维度有 $\\,N\\,$ 个点的均匀网格，网格间距为 $\\,h=2\\pi/N\\,$，并采用周期性边界条件（即，值在域边界处回绕）。\n- 记沿 $\\,x\\,$ 方向的离散中心有限差分导数为\n$$\nD_x f_{i,j,k} \\equiv \\frac{f_{i+1,j,k}-f_{i-1,j,k}}{2h},\n$$\n类似地，沿 $\\,y\\,$ 和 $\\,z\\,$ 方向的 $\\,D_y\\,$ 和 $\\,D_z\\,$ 使用相同的格式，其中索引对 $\\,N\\,$ 取模以强制周期性。\n- 定义离散旋度（将离散矢量势 $\\,\\mathbf{A}=(A_x,A_y,A_z)\\,$ 映射到离散磁场 $\\,\\mathbf{B}=(B_x,B_y,B_z)\\,$）如下\n$$\nB_x = D_y A_z - D_z A_y,\\quad\nB_y = D_z A_x - D_x A_z,\\quad\nB_z = D_x A_y - D_y A_x.\n$$\n- 定义离散磁场的离散散度如下\n$$\n\\nabla_h\\cdot\\mathbf{B} \\equiv D_x B_x + D_y B_y + D_z B_z.\n$$\n\n构造的光滑矢量势及其解析旋度：\n- 设构造的矢量势为\n$$\nA_x(x,y,z)=\\sin(y)+\\cos(z),\\quad\nA_y(x,y,z)=\\sin(z)+\\cos(x),\\quad\nA_z(x,y,z)=\\sin(x)+\\cos(y).\n$$\n- 相应的解析磁场为\n$$\nB^\\star_x(x,y,z)= -\\big(\\sin(y)+\\cos(z)\\big),\\quad\nB^\\star_y(x,y,z)= -\\big(\\sin(z)+\\cos(x)\\big),\\quad\nB^\\star_z(x,y,z)= -\\big(\\sin(x)+\\cos(y)\\big).\n$$\n- 注意 $\\,\\nabla\\cdot\\mathbf{B}^\\star=0\\,$ 精确成立。\n\n截断误差度量：\n- 使用离散 $\\,\\mathbf{B}\\,$ 与解析 $\\,\\mathbf{B}^\\star\\,$ 之间的均方根 (RMS) 误差，定义为\n$$\n\\mathcal{E}(N) \\equiv \\sqrt{\\frac{1}{N^3}\\sum_{i,j,k}\n\\Big( \\big(B_x-B^\\star_x\\big)^2 + \\big(B_y-B^\\star_y\\big)^2 + \\big(B_z-B^\\star_z\\big)^2 \\Big)_{i,j,k}}.\n$$\n- 对于连续的网格加密 $\\,N\\to 2N\\,$，通过以下公式估计观测到的精度阶\n$$\np(N\\to 2N) \\equiv \\log_2\\left(\\frac{\\mathcal{E}(N)}{\\mathcal{E}(2N)}\\right).\n$$\n对于光滑数据，使用二阶中心差分，截断误差预期将按 $\\,\\mathcal{E}(N)=\\mathcal{O}(h^2)\\,$ 的比例缩放，因此渐近地有 $\\,p\\approx 2\\,$。\n\n无散度属性测试：\n- 给定周期性网格上的上述离散算子，计算任意数据上的 $\\,\\max|\\nabla_h\\cdot(\\nabla_h\\times\\mathbf{A})|\\,$；其结果应达到机器精度，这说明了旋度的散度为零的离散模拟恒等式。\n\n您的任务：\n1. 实现如上定义的具有周期性回绕的离散中心差分导数算子 $\\,D_x,D_y,D_z\\,$、离散旋度 $\\,\\nabla_h\\times\\,$ 和离散散度 $\\,\\nabla_h\\cdot\\,$。\n2. 对于构造的 $\\,\\mathbf{A}\\,$，计算 $\\,\\mathbf{B}\\,$ 以及相对于 $\\,\\mathbf{B}^\\star\\,$ 的 RMS 误差 $\\,\\mathcal{E}(N)\\,$，使用加密序列 $\\,N\\in\\{8,16,32,64\\}\\,$。\n3. 计算观测到的精度阶 $\\,p(8\\to 16),\\,p(16\\to 32),\\,p(32\\to 64)\\,$。\n4. 通过设置一个固定的伪随机种子，并在 $\\,N=33\\,$ 的网格上独立采样 $\\,\\mathbf{A}\\,$ 的每个分量，生成一个确定性的随机场测试；计算 $\\,\\max|\\nabla_h\\cdot(\\nabla_h\\times\\mathbf{A})|\\,$。\n5. 构建一个常数矢量势测试，在任意网格（使用 $\\,N=32\\,$）上设 $\\,A_x=A_y=A_z=c\\,$，其中 $\\,c\\,$ 为常数（选择 $\\,c=1\\,$），并返回一个布尔值以验证 $\\,\\max|\\mathbf{B}|  10^{-12}\\,$。\n6. 对于粗网格 $\\,N=4\\,$ 上的构造 $\\,\\mathbf{A}\\,$，计算 $\\,\\max|\\nabla_h\\cdot(\\nabla_h\\times\\mathbf{A})|\\,$，以说明即使在粗分辨率下也能保持 $\\,\\nabla\\cdot\\mathbf{B}=0\\,$。\n\n角度单位是弧度。输出中没有物理单位；所有量纲均为无量纲。\n\n测试套件规范和所需输出：\n- 使用以下参数值测试套件：\n  - 构造的光滑场：在 $\\,\\Omega=[0,2\\pi]^3\\,$ 上，$\\,N\\in\\{8,16,32,64\\}\\,$。\n  - 随机场：$\\,N=33\\,$，固定伪随机种子为 $\\,0\\,$。\n  - 常数场：在 $\\,N=32\\,$ 上，$\\,c=1\\,$。\n  - 粗网格上的构造场：$\\,N=4\\,$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。输出必须是：\n$$\n[\\,[\\mathcal{E}(8),\\mathcal{E}(16),\\mathcal{E}(32),\\mathcal{E}(64)],\\,[p(8\\to 16),p(16\\to 32),p(32\\to 64)],\\,\\max|\\nabla_h\\cdot(\\nabla_h\\times\\mathbf{A})|\\text{ 对于随机场},\\,\\text{对于常数场的布尔值},\\,\\max|\\nabla_h\\cdot(\\nabla_h\\times\\mathbf{A})|\\text{ 对于 }N=4\\,].\n$$\n除布尔条目外，所有数值都必须以浮点数形式生成，并且布尔值必须表示为编程语言的字面量 true/false 值。",
            "solution": "该问题要求在均匀、周期性的三维网格上实现并验证离散的旋度和散度算子，这是计算磁流体动力学 (MHD) 中的一项基本任务。其核心原理是保持磁场的无散度约束，即 $\\nabla \\cdot \\mathbf{B} = 0$。通过将磁场 $\\mathbf{B}$ 定义为矢量势 $\\mathbf{A}$ 的旋度，可以从解析上保证这一点，因为旋度的散度恒为零，即 $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) \\equiv 0$。目标是构建能保持类似恒等式 $\\nabla_h \\cdot (\\nabla_h \\times \\mathbf{A}) = 0$ 的离散算子，其中 $\\nabla_h \\cdot$ 和 $\\nabla_h \\times$ 分别是离散散度和离散旋度算子。这类格式被称为“模拟”或“保结构”格式，因为它们在离散层面复制了连续矢量微积分的一个关键性质。\n\n计算域是一个立方体 $\\Omega = [0, 2\\pi]^3$，通过一个包含 $N^3$ 个点的均匀网格进行离散化，网格间距为 $h = 2\\pi/N$。网格点 $(i, j, k)$ 处的坐标为 $x_i = ih$, $y_j = jh$, $z_k = kh$，其中 $i,j,k \\in \\{0, 1, \\dots, N-1\\}$。在所有三个方向上都强制实行周期性。\n\n离散算子的基础是一阶导数的二阶中心有限差分近似。对于网格上的函数 $f$，在网格点 $(i, j, k)$ 处沿 $x$ 方向的离散导数定义为：\n$$\nD_x f_{i,j,k} \\equiv \\frac{f_{i+1,j,k} - f_{i-1,j,k}}{2h}\n$$\n算子 $D_y$ 和 $D_z$ 的定义类似。周期性通过对索引以 $N$ 为模进行解释来处理，例如 $f_{N,j,k} = f_{0,j,k}$ 和 $f_{-1,j,k} = f_{N-1,j,k}$。在实现中，这些周期性平移可以通过数组的滚动操作高效执行。\n\n使用这些导数算子，矢量势 $\\mathbf{A} = (A_x, A_y, A_z)$ 的离散旋度按分量定义，模仿了连续定义：\n$$\n\\mathbf{B} = \\nabla_h \\times \\mathbf{A} \\equiv \\begin{pmatrix} B_x \\\\ B_y \\\\ B_z \\end{pmatrix} = \\begin{pmatrix} D_y A_z - D_z A_y \\\\ D_z A_x - D_x A_z \\\\ D_x A_y - D_y A_x \\end{pmatrix}\n$$\n类似地，矢量场 $\\mathbf{F} = (F_x, F_y, F_z)$ 的离散散度为：\n$$\n\\nabla_h \\cdot \\mathbf{F} \\equiv D_x F_x + D_y F_y + D_z F_z\n$$\n这些由可交换的平移操作构建的离散算子的一个关键性质是它们本身也可交换，例如 $D_x D_y = D_y D_x$。这直接导致了旋度的散度恒等式的离散保持：\n$$\n\\nabla_h \\cdot (\\nabla_h \\times \\mathbf{A}) = D_x(D_y A_z - D_z A_y) + D_y(D_z A_x - D_x A_z) + D_z(D_x A_y - D_y A_x)\n$$\n$$\n= (D_x D_y A_z - D_y D_x A_z) + (D_z D_x A_y - D_x D_z A_y) + (D_y D_z A_x - D_z D_y A_x) = 0\n$$\n只要一致地使用相同的中心差分格式，该恒等式就以机器精度成立，与网格分辨率或具体的场 $\\mathbf{A}$ 无关。\n\n这些算法任务旨在通过数值方法验证这些性质。\n\n首先，使用“制造解方法”进行收敛性研究。定义一个光滑的矢量势场：\n$$\nA_x(x,y,z)=\\sin(y)+\\cos(z),\\quad A_y(x,y,z)=\\sin(z)+\\cos(x),\\quad A_z(x,y,z)=\\sin(x)+\\cos(y)\n$$\n相应的解析磁场为 $\\mathbf{B}^\\star = \\nabla \\times \\mathbf{A}$：\n$$\nB^\\star_x(x,y,z)= -\\big(\\sin(y)+\\cos(z)\\big),\\quad B^\\star_y(x,y,z)= -\\big(\\sin(z)+\\cos(x)\\big),\\quad B^\\star_z(x,y,z)= -\\big(\\sin(x)+\\cos(y)\\big)\n$$\n在 $N \\in \\{8, 16, 32, 64\\}$ 的网格上计算数值旋度 $\\mathbf{B}$。然后计算均方根 (RMS) 误差 $\\mathcal{E}(N)$：\n$$\n\\mathcal{E}(N) \\equiv \\sqrt{\\frac{1}{N^3}\\sum_{i,j,k}\n\\Big( \\big(B_x-B^\\star_x\\big)^2 + \\big(B_y-B^\\star_y\\big)^2 + \\big(B_z-B^\\star_z\\big)^2 \\Big)_{i,j,k}}\n$$\n通过计算观测到的精度阶 $p(N \\to 2N)$ 来估计收敛率：\n$$\np(N\\to 2N) \\equiv \\log_2\\left(\\frac{\\mathcal{E}(N)}{\\mathcal{E}(2N)}\\right)\n$$\n对于应用于光滑函数的二阶格式，我们预期 $p \\approx 2$。\n\n其次，进行几项测试以明确验证离散无散度性质 $\\nabla_h \\cdot (\\nabla_h \\times \\mathbf{A}) = 0$。\n1.  **常数场**：对于常数矢量势 $\\mathbf{A} = (c, c, c)$ 且 $c=1$，所有离散导数均为零，因此数值旋度 $\\mathbf{B}$ 必须在机器精度内为零。我们通过检查 $\\max|\\mathbf{B}|  10^{-12}$ 是否成立来验证这一点。\n2.  **随机场**：在 $N=33$ 的网格上创建一个矢量势 $\\mathbf{A}$，其分量从均匀随机分布中采样。这用于测试一个非光滑、非对称场的恒等式。计算量 $\\max|\\nabla_h \\cdot (\\nabla_h \\times \\mathbf{A})|$，预期其量级为机器ε。\n3.  **粗网格制造场**：在一个非常粗的网格（$N=4$）上使用制造解，以证明即使旋度算子本身的截断误差很大，无散度性质仍然精确保持（在机器精度内）。计算 $\\max|\\nabla_h \\cdot (\\nabla_h \\times \\mathbf{A})|$ 的值。\n\n该实现使用 Python 中的 `numpy` 库完成。计算网格使用 `np.meshgrid` 并设置 `indexing='ij'` 生成。周期性导数 $D_x, D_y, D_z$ 使用 `np.roll` 来处理索引平移。然后按所述执行任务，并将结果汇总成指定的输出格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to perform all calculations as specified in the problem.\n    The problem asks for a series of distinct calculations. A sequential execution\n    of these tasks is clearer than forcing them into a single loop over a\n    'test_cases' list as suggested by the generic template.\n    \"\"\"\n\n    # --- Helper functions for discrete operators ---\n    def get_grid(N):\n        \"\"\"Generates a 3D periodic grid.\"\"\"\n        h = 2 * np.pi / N\n        coords_1d = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        x, y, z = np.meshgrid(coords_1d, coords_1d, coords_1d, indexing='ij')\n        return x, y, z, h\n\n    def Dx(f, h):\n        \"\"\"Computes the centered-difference derivative along the x-axis (axis 0).\"\"\"\n        return (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * h)\n\n    def Dy(f, h):\n        \"\"\"Computes the centered-difference derivative along the y-axis (axis 1).\"\"\"\n        return (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * h)\n\n    def Dz(f, h):\n        \"\"\"Computes the centered-difference derivative along the z-axis (axis 2).\"\"\"\n        return (np.roll(f, -1, axis=2) - np.roll(f, 1, axis=2)) / (2 * h)\n\n    def curl(Ax, Ay, Az, h):\n        \"\"\"Computes the discrete curl of a vector field.\"\"\"\n        Bx = Dy(Az, h) - Dz(Ay, h)\n        By = Dz(Ax, h) - Dx(Az, h)\n        Bz = Dx(Ay, h) - Dy(Ax, h)\n        return Bx, By, Bz\n\n    def div(Fx, Fy, Fz, h):\n        \"\"\"Computes the discrete divergence of a vector field.\"\"\"\n        return Dx(Fx, h) + Dy(Fy, h) + Dz(Fz, h)\n\n    # --- Task 2  3: Convergence study for manufactured solution ---\n    Ns = [8, 16, 32, 64]\n    errors = []\n    \n    for N in Ns:\n        x, y, z, h = get_grid(N)\n        \n        # Manufactured vector potential A\n        Ax_man = np.sin(y) + np.cos(z)\n        Ay_man = np.sin(z) + np.cos(x)\n        Az_man = np.sin(x) + np.cos(y)\n        \n        # Analytic magnetic field B*\n        Bx_star = -(np.sin(y) + np.cos(z))\n        By_star = -(np.sin(z) + np.cos(x))\n        Bz_star = -(np.sin(x) + np.cos(y))\n        \n        # Numerical magnetic field B\n        Bx_num, By_num, Bz_num = curl(Ax_man, Ay_man, Az_man, h)\n        \n        # RMS error calculation\n        err_sq = (Bx_num - Bx_star)**2 + (By_num - By_star)**2 + (Bz_num - Bz_star)**2\n        rms_error = np.sqrt(np.mean(err_sq))\n        errors.append(rms_error)\n        \n    orders = [np.log2(errors[i] / errors[i+1]) for i in range(len(Ns) - 1)]\n\n    # --- Task 4: Random field divergence test ---\n    N_rand = 33\n    h_rand = 2 * np.pi / N_rand\n    np.random.seed(0)\n    Ax_rand = np.random.rand(N_rand, N_rand, N_rand)\n    Ay_rand = np.random.rand(N_rand, N_rand, N_rand)\n    Az_rand = np.random.rand(N_rand, N_rand, N_rand)\n    \n    Bx_rand, By_rand, Bz_rand = curl(Ax_rand, Ay_rand, Az_rand, h_rand)\n    div_B_rand = div(Bx_rand, By_rand, Bz_rand, h_rand)\n    max_div_curl_random = np.max(np.abs(div_B_rand))\n\n    # --- Task 5: Constant field test ---\n    N_const = 32\n    h_const = 2 * np.pi / N_const\n    c = 1.0\n    Ax_const = np.full((N_const, N_const, N_const), c)\n    Ay_const = np.full((N_const, N_const, N_const), c)\n    Az_const = np.full((N_const, N_const, N_const), c)\n    \n    Bx_const, By_const, Bz_const = curl(Ax_const, Ay_const, Az_const, h_const)\n    max_B_const = np.max([np.abs(Bx_const), np.abs(By_const), np.abs(Bz_const)])\n    const_field_bool = max_B_const  1e-12\n\n    # --- Task 6: Coarse grid divergence test with manufactured solution ---\n    N_coarse = 4\n    x_coarse, y_coarse, z_coarse, h_coarse = get_grid(N_coarse)\n    \n    Ax_m_coarse = np.sin(y_coarse) + np.cos(z_coarse)\n    Ay_m_coarse = np.sin(z_coarse) + np.cos(x_coarse)\n    Az_m_coarse = np.sin(x_coarse) + np.cos(y_coarse)\n    \n    Bx_m_coarse, By_m_coarse, Bz_m_coarse = curl(Ax_m_coarse, Ay_m_coarse, Az_m_coarse, h_coarse)\n    div_B_m_coarse = div(Bx_m_coarse, By_m_coarse, Bz_m_coarse, h_coarse)\n    max_div_curl_coarse = np.max(np.abs(div_B_m_coarse))\n    \n    # --- Final Output ---\n    # Convert boolean to lowercase 'true'/'false' as required.\n    bool_str = str(const_field_bool).lower()\n    \n    # Assemble the final string in the specified format.\n    print(f\"[[{','.join(map(str, errors))}],\"\n          f\"[{','.join(map(str, orders))}],\"\n          f\"{max_div_curl_random},\"\n          f\"{bool_str},\"\n          f\"{max_div_curl_coarse}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "构建数值求解器后，验证其代码是否正确实现了控制方程是不可或缺的一步。制造解方法（Method of Manufactured Solutions, MMS）是实现这一目标的通用而强大的技术。本练习将引导您推导一个源项，当将其添加到感应方程中时，一个预先设定的“制造”场将成为该方程的精确解，从而为代码验证提供一个可量化的基准。",
            "id": "3343377",
            "problem": "考虑一种在磁流体动力学（MHD）条件下演化的不可压缩导电流体。采用磁导率为单位1的无量纲公式，其电磁控制关系为 Maxwell–Faraday 定律 $\\,\\partial \\mathbf{B}/\\partial t = -\\nabla \\times \\mathbf{E}\\,$、无位移电流的 Ampère 定律 $\\,\\mathbf{J} = \\nabla \\times \\mathbf{B}\\,$，以及电阻性 Ohm 定律 $\\,\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = \\eta\\,\\mathbf{J}\\,$，其中 $\\eta$ 是一个恒定的磁扩散系数。该流体是无散的，满足 $\\,\\nabla \\cdot \\mathbf{u} = 0\\,$ 和 $\\,\\nabla \\cdot \\mathbf{B} = 0\\,$。力学动量方程包含 Lorentz 力 $\\,\\mathbf{J} \\times \\mathbf{B}\\,$，尽管在此次计算中并不直接需要它。\n\n作为基于人造解法（MMS）的验证策略的一部分，假设速度场和磁场由流函数和磁势构造而成，\n$$\n\\psi(x,y,t) = U_0 \\sin(kx)\\sin(ky)\\exp(\\alpha t), \\qquad \n\\phi(x,y,t) = B_0 \\cos(kx)\\cos(ky)\\exp(\\beta t),\n$$\n其中\n$$\n\\mathbf{u}(x,y,t) = \\left(\\frac{\\partial \\psi}{\\partial y},\\, -\\frac{\\partial \\psi}{\\partial x},\\, 0\\right), \\qquad \n\\mathbf{B}(x,y,t) = \\left(\\frac{\\partial \\phi}{\\partial y},\\, -\\frac{\\partial \\phi}{\\partial x},\\, 0\\right).\n$$\n\n定义人造源 $\\mathbf{S}_B(x,y,t)$ 为在此无量纲电阻性 MHD 设置中，使人造场成为感应方程精确解所需的残差。也就是说，从上述基本定律推导出 $\\mathbf{S}_B$，然后计算其在以下点的 $x$ 分量\n$$\nx = \\frac{\\pi}{4}, \\quad y = \\frac{\\pi}{3}, \\quad t = \\ln 2,\n$$\n参数值为\n$$\nU_0 = 2, \\quad B_0 = 1, \\quad k = 1, \\quad \\alpha = 0, \\quad \\beta = 1, \\quad \\eta = \\frac{1}{4}.\n$$\n\n以单一精确解析表达式的形式提供 $S_{B,x}$ 的最终值。此问题是完全无量纲的；最终答案中不需要物理单位。",
            "solution": "## 问题验证\n\n### 第 1 步：提取已知信息\n问题提供了以下信息：\n- **控制方程**：\n  - Maxwell–Faraday 定律：$\\frac{\\partial \\mathbf{B}}{\\partial t} = -\\nabla \\times \\mathbf{E}$\n  - Ampère 定律（无位移电流）：$\\mathbf{J} = \\nabla \\times \\mathbf{B}$\n  - 电阻性 Ohm 定律：$\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = \\eta \\mathbf{J}$\n  - 磁导率为单位1。\n- **流体性质**：\n  - 不可压缩，导电。\n  - 恒定磁扩散系数 $\\eta$。\n  - 无散的流体速度和磁场：$\\nabla \\cdot \\mathbf{u} = 0$, $\\nabla \\cdot \\mathbf{B} = 0$。\n- **人造解**：\n  - 流函数：$\\psi(x,y,t) = U_0 \\sin(kx)\\sin(ky)\\exp(\\alpha t)$\n  - 磁势：$\\phi(x,y,t) = B_0 \\cos(kx)\\cos(ky)\\exp(\\beta t)$\n- **场的定义**：\n  - 速度场：$\\mathbf{u}(x,y,t) = \\left(\\frac{\\partial \\psi}{\\partial y},\\, -\\frac{\\partial \\psi}{\\partial x},\\, 0\\right)$\n  - 磁场：$\\mathbf{B}(x,y,t) = \\left(\\frac{\\partial \\phi}{\\partial y},\\, -\\frac{\\partial \\phi}{\\partial x},\\, 0\\right)$\n- **任务定义**：\n  - 定义人造源 $\\mathbf{S}_B(x,y,t)$ 为感应方程的残差。\n  - 在特定点处计算源的 $x$ 分量 $S_{B,x}$。\n- **求值点**：\n  - $x = \\frac{\\pi}{4}$, $y = \\frac{\\pi}{3}$, $t = \\ln 2$\n- **参数值**：\n  - $U_0 = 2$, $B_0 = 1$, $k = 1$, $\\alpha = 0$, $\\beta = 1$, $\\eta = \\frac{1}{4}$\n\n### 第 2 步：使用提取的已知信息进行验证\n1.  **科学依据**：该问题基于电阻性磁流体动力学（MHD）的无量纲标准方程。人造解法（MMS）的使用是计算科学中一种成熟的验证技术。所选的速度场和磁场形式是测试数值格式（例如，Taylor-Green 涡流类型流动）的标准形式。\n2.  **适定性**：该问题是适定的。它提供了唯一确定源项及其在指定点的值所需的所有必要方程、定义和参数值。没有缺失或矛盾的信息。\n3.  **客观性**：问题以精确的数学语言陈述，没有任何主观或模棱两可的术语。\n4.  **未检测到其他缺陷**：该问题不违反任何其他验证标准。这是一个形式化的、自洽的数学物理问题。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n## 解\n\n任务是找到感应方程的人造源项 $\\mathbf{S}_B$。感应方程可以从给定的定律推导出来。\n\n首先，将 Ohm 定律代入 Maxwell-Faraday 定律：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = -\\nabla \\times \\mathbf{E} = -\\nabla \\times (\\eta \\mathbf{J} - \\mathbf{u} \\times \\mathbf{B}) = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) - \\eta \\nabla \\times \\mathbf{J}\n$$\n接下来，将 Ampère 定律 $\\mathbf{J} = \\nabla \\times \\mathbf{B}$ 代入此表达式：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) - \\eta \\nabla \\times (\\nabla \\times \\mathbf{B})\n$$\n使用向量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{B}) = \\nabla(\\nabla \\cdot \\mathbf{B}) - \\nabla^2 \\mathbf{B}$ 和给定条件 $\\nabla \\cdot \\mathbf{B} = 0$，我们得到 $\\nabla \\times (\\nabla \\times \\mathbf{B}) = -\\nabla^2 \\mathbf{B}$。感应方程变为：\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\n$$\n当人造场被代入时，人造源项 $\\mathbf{S}_B$ 是该方程的残差：\n$$\n\\mathbf{S}_B = \\frac{\\partial \\mathbf{B}}{\\partial t} - \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) - \\eta \\nabla^2 \\mathbf{B}\n$$\n我们需要计算 $x$ 分量 $S_{B,x}$。让我们分别计算每一项。\n\n首先，我们从势 $\\psi$ 和 $\\phi$ 推导出向量场 $\\mathbf{u}$ 和 $\\mathbf{B}$。\n$$\n\\psi(x,y,t) = U_0 \\sin(kx)\\sin(ky)\\exp(\\alpha t)\n$$\n$$\nu_x = \\frac{\\partial \\psi}{\\partial y} = k U_0 \\sin(kx)\\cos(ky)\\exp(\\alpha t)\n$$\n$$\nu_y = -\\frac{\\partial \\psi}{\\partial x} = -k U_0 \\cos(kx)\\sin(ky)\\exp(\\alpha t)\n$$\n$$\n\\mathbf{u} = (u_x, u_y, 0)\n$$\n$$\n\\phi(x,y,t) = B_0 \\cos(kx)\\cos(ky)\\exp(\\beta t)\n$$\n$$\nB_x = \\frac{\\partial \\phi}{\\partial y} = -k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t)\n$$\n$$\nB_y = -\\frac{\\partial \\phi}{\\partial x} = k B_0 \\sin(kx)\\cos(ky)\\exp(\\beta t)\n$$\n$$\n\\mathbf{B} = (B_x, B_y, 0)\n$$\n\n现在我们计算 $S_{B,x}$ 的各项：\n1.  **时间导数项：$\\frac{\\partial B_x}{\\partial t}$**\n    $$\n    \\frac{\\partial B_x}{\\partial t} = \\frac{\\partial}{\\partial t} \\left( -k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t) \\right) = \\beta (-k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t)) = \\beta B_x\n    $$\n\n2.  **对流项：$(\\nabla \\times (\\mathbf{u} \\times \\mathbf{B}))_x$**\n    叉积 $\\mathbf{u} \\times \\mathbf{B}$ 为：\n    $$\n    \\mathbf{u} \\times \\mathbf{B} = (u_x B_y - u_y B_x)\\mathbf{\\hat{k}}\n    $$\n    设 $W_z = u_x B_y - u_y B_x$。\n    $$\n    W_z = \\left( k U_0 \\sin(kx)\\cos(ky)\\exp(\\alpha t) \\right) \\left( k B_0 \\sin(kx)\\cos(ky)\\exp(\\beta t) \\right) - \\left( -k U_0 \\cos(kx)\\sin(ky)\\exp(\\alpha t) \\right) \\left( -k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t) \\right)\n    $$\n    $$\n    W_z = k^2 U_0 B_0 \\exp((\\alpha+\\beta)t) \\left( \\sin^2(kx)\\cos^2(ky) - \\cos^2(kx)\\sin^2(ky) \\right)\n    $$\n    使用恒等式 $\\sin^2 A \\cos^2 B - \\cos^2 A \\sin^2 B = \\sin^2 A - \\sin^2 B$：\n    $$\n    W_z = k^2 U_0 B_0 \\exp((\\alpha+\\beta)t) \\left( \\sin^2(kx) - \\sin^2(ky) \\right)\n    $$\n    旋度为 $\\nabla \\times (W_z \\mathbf{\\hat{k}}) = \\frac{\\partial W_z}{\\partial y}\\mathbf{\\hat{i}} - \\frac{\\partial W_z}{\\partial x}\\mathbf{\\hat{j}}$。其 $x$ 分量是：\n    $$\n    (\\nabla \\times (\\mathbf{u} \\times \\mathbf{B}))_x = \\frac{\\partial W_z}{\\partial y} = k^2 U_0 B_0 \\exp((\\alpha+\\beta)t) \\left( -\\frac{\\partial}{\\partial y}\\sin^2(ky) \\right)\n    $$\n    $$\n    \\frac{\\partial}{\\partial y}\\sin^2(ky) = 2\\sin(ky)\\cos(ky) \\cdot k = k\\sin(2ky)\n    $$\n    所以，\n    $$\n    (\\nabla \\times (\\mathbf{u} \\times \\mathbf{B}))_x = -k^3 U_0 B_0 \\exp((\\alpha+\\beta)t) \\sin(2ky)\n    $$\n\n3.  **扩散项：$\\eta \\nabla^2 B_x$**\n    拉普拉斯算子为 $\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$。\n    $$\n    \\frac{\\partial^2 B_x}{\\partial x^2} = \\frac{\\partial^2}{\\partial x^2}\\left( -k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t) \\right) = (-k^2) B_x\n    $$\n    $$\n    \\frac{\\partial^2 B_x}{\\partial y^2} = \\frac{\\partial^2}{\\partial y^2}\\left( -k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t) \\right) = (-k^2) B_x\n    $$\n    $$\n    \\nabla^2 B_x = \\frac{\\partial^2 B_x}{\\partial x^2} + \\frac{\\partial^2 B_x}{\\partial y^2} = -k^2 B_x - k^2 B_x = -2k^2 B_x\n    $$\n    因此，\n    $$\n    \\eta \\nabla^2 B_x = -2\\eta k^2 B_x\n    $$\n\n现在，组合 $S_{B,x}$：\n$$\nS_{B,x} = \\frac{\\partial B_x}{\\partial t} - (\\nabla \\times (\\mathbf{u} \\times \\mathbf{B}))_x - \\eta \\nabla^2 B_x\n$$\n$$\nS_{B,x} = \\beta B_x - \\left( -k^3 U_0 B_0 \\exp((\\alpha+\\beta)t) \\sin(2ky) \\right) - \\left( -2\\eta k^2 B_x \\right)\n$$\n$$\nS_{B,x} = (\\beta + 2\\eta k^2)B_x + k^3 U_0 B_0 \\exp((\\alpha+\\beta)t) \\sin(2ky)\n$$\n代入 $B_x$ 的表达式：\n$$\nS_{B,x} = (\\beta + 2\\eta k^2)(-k B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t)) + k^3 U_0 B_0 \\exp((\\alpha+\\beta)t) \\sin(2ky)\n$$\n$$\nS_{B,x} = -k(\\beta + 2\\eta k^2)B_0 \\cos(kx)\\sin(ky)\\exp(\\beta t) + k^3 U_0 B_0 \\exp((\\alpha+\\beta)t) \\sin(2ky)\n$$\n现在，代入给定的参数值：$U_0 = 2$, $B_0 = 1$, $k = 1$, $\\alpha = 0$, $\\beta = 1$, $\\eta = \\frac{1}{4}$。\n$$\nS_{B,x} = -(1)(1 + 2(\\frac{1}{4})(1)^2)(1) \\cos(x)\\sin(y)\\exp(t) + (1)^3 (2) (1) \\exp((0+1)t) \\sin(2y)\n$$\n$$\nS_{B,x} = -(1 + \\frac{1}{2}) \\cos(x)\\sin(y)\\exp(t) + 2 \\exp(t) \\sin(2y)\n$$\n$$\nS_{B,x} = -\\frac{3}{2}\\cos(x)\\sin(y)\\exp(t) + 2\\sin(2y)\\exp(t)\n$$\n$$\nS_{B,x} = \\exp(t) \\left( 2\\sin(2y) - \\frac{3}{2}\\cos(x)\\sin(y) \\right)\n$$\n最后，在点 $x = \\frac{\\pi}{4}$，$y = \\frac{\\pi}{3}$，$t = \\ln 2$ 处计算此表达式的值。\n$$\n\\exp(t) = \\exp(\\ln 2) = 2\n$$\n$$\n\\cos(x) = \\cos(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}\n$$\n$$\n\\sin(y) = \\sin(\\frac{\\pi}{3}) = \\frac{\\sqrt{3}}{2}\n$$\n$$\n\\sin(2y) = \\sin(\\frac{2\\pi}{3}) = \\frac{\\sqrt{3}}{2}\n$$\n代入这些值：\n$$\nS_{B,x} = 2 \\left( 2\\left(\\frac{\\sqrt{3}}{2}\\right) - \\frac{3}{2}\\left(\\frac{\\sqrt{2}}{2}\\right)\\left(\\frac{\\sqrt{3}}{2}\\right) \\right)\n$$\n$$\nS_{B,x} = 2 \\left( \\sqrt{3} - \\frac{3\\sqrt{6}}{8} \\right)\n$$\n$$\nS_{B,x} = 2\\sqrt{3} - \\frac{6\\sqrt{6}}{8} = 2\\sqrt{3} - \\frac{3\\sqrt{6}}{4}\n$$",
            "answer": "$$\\boxed{2\\sqrt{3} - \\frac{3\\sqrt{6}}{4}}$$"
        },
        {
            "introduction": "成功的模拟不仅依赖于正确的内部域离散化，还依赖于对物理边界条件的精确处理。本练习将理论与实践相结合，专注于一个经典的MHD问题：具有完美导电壁的通道流。您将学习如何将在导电壁上应用的物理定律（如无滑移和切向电场为零）转化为在交错网格上一致的数值边界条件，并验证其与无散约束的相容性。",
            "id": "3343370",
            "problem": "请考虑一个二维不可压缩磁流体动力学（MHD）通道流，该通道位于矩形区域 $\\Omega = [0,L_x] \\times [0,L_y]$ 内，在 $x$ 方向具有周期性边界条件，在 $y=0$ 和 $y=L_y$ 处为完美导电壁。设流体速度为 $\\mathbf{u}(x,y,t)$，磁场为 $\\mathbf{B}(x,y,t)$。控制基础是麦克斯韦方程组，特别是 $\\nabla \\cdot \\mathbf{B} = 0$，以及由法拉第定律和运动导体广义欧姆定律导出的感应方程，同时还有不可压缩条件 $\\nabla \\cdot \\mathbf{u} = 0$ 和速度的无滑移边界条件。作为起点的物理定律是：\n- $\\nabla \\cdot \\mathbf{B} = 0$。\n- $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$。\n- $\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = \\eta \\mathbf{J}$，其中 $\\eta$ 是磁扩散率，$\\mathbf{J}$ 是电流密度。\n- $\\nabla \\cdot \\mathbf{u} = 0$。\n- 在完美导电壁上，电场的切向分量消失，这与无滑移条件 $\\mathbf{u} = \\mathbf{0}$ 相容，并约束了 $\\mathbf{B}$ 允许的边界行为。\n\n您的任务是为 $\\mathbf{B}$ 和 $\\mathbf{u}$ 在 $y=0$ 和 $y=L_y$ 上指定并实现一致的数值边界条件，证明它们与 $\\nabla \\cdot \\mathbf{B}=0$ 的相容性，并通过在均匀笛卡尔网格上使用离散散度算子进行数值验证。您必须：\n1. 为导电壁上的磁场制定物理上一致且与无散度约束数值相容的边界条件。在通道情境下，对完美导电壁使用以下标准建模假设：\n   - $B_y|_{y=0} = 0$ 和 $B_y|_{y=L_y} = 0$（无磁通量穿过壁面）。\n   - $\\partial_y B_x|_{y=0} = 0$ 和 $\\partial_y B_x|_{y=L_y} = 0$（磁场切向分量的齐次诺伊曼条件）。\n   提供一个有原则的论证，说明这些边界条件不违反 $\\nabla \\cdot \\mathbf{B} = 0$，并且可以在有限体积或标记与单元（MAC）交错网格的意义上强制执行。\n2. 在 $y=0$ 和 $y=L_y$ 处施加无滑移速度边界条件 $\\mathbf{u} = \\mathbf{0}$，并在 $x$ 方向施加周期性条件。通过构造确保速度在内部是数值上无散度的。\n3. 使用均匀的 MAC 类型交错网格：\n   - 将 $B_x$ 和 $u_x$ 存储在位于 $(x_i,y_j)$ 的 $x$ 面上，其中 $x_i = i\\,\\Delta x$，$i \\in \\{0,1,\\dots,N_x\\}$，$y_j = \\left(j+\\tfrac{1}{2}\\right)\\Delta y$，$j \\in \\{0,1,\\dots,N_y-1\\}$。\n   - 将 $B_y$ 和 $u_y$ 存储在位于 $(x_i,y_j)$ 的 $y$ 面上，其中 $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$，$i \\in \\{0,1,\\dots,N_x-1\\}$，$y_j = j\\,\\Delta y$，$j \\in \\{0,1,\\dots,N_y\\}$。\n   - 将散度存储在单元中心 $(x_i,y_j)$，其中 $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$，$i \\in \\{0,1,\\dots,N_x-1\\}$，$y_j = \\left(j+\\tfrac{1}{2}\\right)\\Delta y$，$j \\in \\{0,1,\\dots,N_y-1\\}$，其中 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$。\n4. 定义一个作用于面心场的离散散度算子：\n   $$\\left(\\nabla \\cdot \\mathbf{F}\\right)_{i,j} = \\frac{F_x\\left(x_{i+\\tfrac{1}{2}},y_j\\right) - F_x\\left(x_{i-\\tfrac{1}{2}},y_j\\right)}{\\Delta x} + \\frac{F_y\\left(x_i,y_{j+\\tfrac{1}{2}}\\right) - F_y\\left(x_i,y_{j-\\tfrac{1}{2}}\\right)}{\\Delta y}，$$\n   在 $x$ 方向采用周期性环绕，在 $y$ 方向应用上述边界条件。\n5. 为了进行数值验证，使用为 $\\mathbf{B}$ 和 $\\mathbf{u}$ 构造的、源于流函数的光滑无散度解析场来填充相应的面位置：\n   - 磁流函数 $\\psi(x,y) = \\sin\\left(\\frac{\\pi y}{L_y}\\right)\\cos\\left(\\frac{2\\pi x}{L_x}\\right)$，即 $B_x = \\partial_y \\psi$ 和 $B_y = -\\partial_x \\psi$，在适当的面位置求值。\n   - 速度流函数 $\\phi(x,y) = \\sin^2\\left(\\frac{\\pi y}{L_y}\\right)\\cos\\left(\\frac{2\\pi x}{L_x}\\right)$，即 $u_x = \\partial_y \\phi$ 和 $u_y = -\\partial_x \\phi$，在适当的面位置求值。\n   这些选择满足 $B_y|_{y=0}=0$, $B_y|_{y=L_y}=0$, $\\partial_y B_x|_{y=0}=0$, $\\partial_y B_x|_{y=L_y}=0$, 以及 $u_x|_{y=0}=u_y|_{y=0}=u_x|_{y=L_y}=u_y|_{y=L_y}=0$。\n6. 实现一个程序，该程序为每个测试用例计算并返回施加指定边界条件后，$\\Omega$ 中所有单元中心上 $\\mathbf{B}$ 和 $\\mathbf{u}$ 的最大绝对离散散度。此外，包括一个压力测试，其中通过在 $y=0$ 和 $y=L_y$ 处将 $B_y$ 设置为非零常数来故意违反磁边界条件，并报告由此产生的 $\\mathbf{B}$ 的最大离散散度，以证明其与 $\\nabla \\cdot \\mathbf{B}=0$ 的不相容性。\n7. 所有量都是无量纲的；以浮点值的形式报告结果。\n\n测试套件规范，参数为 $(L_x,L_y,N_x,N_y,m)$，其中 $m$ 是一个标志，表示磁边界条件是正确的（$m=0$）还是在壁处被故意违反（$m=1$）：\n- 情况 A（正常情况）：$(L_x,L_y,N_x,N_y,m) = (2,1,16,8,0)$。\n- 情况 B（细化）：$(L_x,L_y,N_x,N_y,m) = (2,1,64,32,0)$。\n- 情况 C（在导电壁处违反）：$(L_x,L_y,N_x,N_y,m) = (2,1,64,32,1)$。\n\n您的程序应生成单行输出，其中包含一个以方括号括起来的逗号分隔列表形式的结果，顺序为 $[\\max|\\nabla\\cdot\\mathbf{B}|_{\\text{情况 A}},\\max|\\nabla\\cdot\\mathbf{u}|_{\\text{情况 A}},\\max|\\nabla\\cdot\\mathbf{B}|_{\\text{情况 B}},\\max|\\nabla\\cdot\\mathbf{u}|_{\\text{情况 B}},\\max|\\nabla\\cdot\\mathbf{B}|_{\\text{情况 C}},\\max|\\nabla\\cdot\\mathbf{u}|_{\\text{情况 C}}]$，每个条目都是一个浮点值。所有三角函数求值的角度单位均为弧度。不需要物理单位；所有量都是无量纲的。",
            "solution": "用户提供了一个计算磁流体动力学（MHD）的问题。第一步是验证问题陈述。\n\n### 问题验证\n\n#### 步骤1：提取给定信息\n- **域**：$\\Omega = [0,L_x] \\times [0,L_y]$。\n- **控制方程**：$\\nabla \\cdot \\mathbf{B} = 0$, $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$, $\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = \\eta \\mathbf{J}$, $\\nabla \\cdot \\mathbf{u} = 0$。\n- **边界条件 (BCs)**：\n    - $x$ 方向周期性。\n    - 壁面无滑移：在 $y=0, L_y$ 处 $\\mathbf{u} = \\mathbf{0}$。\n    - 在 $y=0, L_y$ 处为完美导电壁：切向电场为零。\n    - 指定的磁场边界条件在 $y=0,L_y$ 处：$B_y = 0$ 和 $\\partial_y B_x = 0$。\n- **数值方法**：\n    - 均匀标记与单元 (MAC) 交错网格。\n    - $B_x, u_x$ 存储在 $x$ 面上：$(x_i, y_j)$，其中 $x_i = i\\,\\Delta x$ 对于 $i \\in \\{0, \\dots, N_x\\}$，$y_j = (j+\\frac{1}{2})\\Delta y$ 对于 $j \\in \\{0, \\dots, N_y-1\\}$。\n    - $B_y, u_y$ 存储在 $y$ 面上：$(x_i, y_j)$，其中 $x_i = (i+\\frac{1}{2})\\Delta x$ 对于 $i \\in \\{0, \\dots, N_x-1\\}$，$y_j = j\\,\\Delta y$ 对于 $j \\in \\{0, \\dots, N_y\\}$。\n    - 散度计算于单元中心：$(x_i, y_j)$，其中 $x_i = (i+\\frac{1}{2})\\Delta x$ 对于 $i \\in \\{0, \\dots, N_x-1\\}$，$y_j = (j+\\frac{1}{2})\\Delta y$ 对于 $j \\in \\{0, \\dots, N_y-1\\}$。\n- **离散散度算子**：$(\\nabla \\cdot \\mathbf{F})_{i,j} = \\frac{F_x(x_{i+\\frac{1}{2}},y_j) - F_x(x_{i-\\frac{1}{2}},y_j)}{\\Delta x} + \\frac{F_y(x_i,y_{j+\\frac{1}{2}}) - F_y(x_i,y_{j-\\frac{1}{2}})}{\\Delta y}$。\n- **解析验证场**：\n    - 磁场来自流函数 $\\psi(x,y) = \\sin(\\frac{\\pi y}{L_y})\\cos(\\frac{2\\pi x}{L_x})$，得到 $B_x = \\partial_y \\psi$ 和 $B_y = -\\partial_x \\psi$。\n    - 速度场来自流函数 $\\phi(x,y) = \\sin^2(\\frac{\\pi y}{L_y})\\cos(\\frac{2\\pi x}{L_x})$，得到 $u_x = \\partial_y \\phi$ 和 $u_y = -\\partial_x \\phi$。\n- **任务**：实现一个程序，为几个测试用例计算 $\\mathbf{B}$ 和 $\\mathbf{u}$ 的最大绝对离散散度，包括一个故意违反磁边界条件的用例。\n- **测试用例**：\n    - A: $(L_x,L_y,N_x,N_y,m) = (2,1,16,8,0)$\n    - B: $(L_x,L_y,N_x,N_y,m) = (2,1,64,32,0)$\n    - C: $(L_x,L_y,N_x,N_y,m) = (2,1,64,32,1)$，其中 $m=1$ 意味着通过将 $B_y$ 在壁上设置为非零常数来违反 $B_y=0$ 边界条件。\n\n#### 步骤2：使用提取的给定信息进行验证\n1.  **科学基础**：该问题基于不可压缩 MHD 的标准方程，并使用已确立的完美导电壁边界条件。数值方法（MAC 网格）和验证程序（使用解析解）是计算物理学中的标准实践。该问题在科学上是合理的。\n2.  **适定性**：任务是具体的计算任务。它要求对由给定解析函数生成的场评估一个离散算子。所有参数都已提供。这将导致一个唯一的、可验证的数值结果。\n3.  **客观性**：问题以精确、形式化和客观的数学和物理语言陈述。\n4.  **完整性和一致性**：问题是自洽的。提供的解析场与连续边界条件和无散度约束一致。从物理原理推导磁边界条件是 MHD 中的标准结果。唯一的小歧义是违反边界条件时“非零常数”的值，但这无关紧要，因为任何 $O(1)$ 的常数都将展示预期的数值行为；选择 $1.0$ 是一个合理的值。问题是一致且足够完整的。\n\n#### 步骤3：结论与行动\n该问题被判定为**有效**。这是一个定义明确的计算磁流体动力学练习，测试了交错网格方法的实现以及对边界条件强制执行的理解。我将继续提供解决方案。\n\n### 原理解决方案\n\n任务是在离散数值 MHD 环境中，验证指定的 MHD 边界条件与无散度约束 $\\nabla \\cdot \\mathbf{B} = 0$ 和 $\\nabla \\cdot \\mathbf{u} = 0$ 的相容性。\n\n#### 1. 边界条件的合理性\n完美导电壁的边界条件源于基本的电磁学原理。\n- **无滑移条件**：在壁面处 $\\mathbf{u} = \\mathbf{0}$ 是粘性流在固体静止壁上的标准流体动力学边界条件。\n- **磁场条件**：\n    1. 条件 $B_y|_{y=0,L_y} = 0$ 指出磁场的法向分量在壁面为零。这是将 $\\nabla \\cdot \\mathbf{B} = 0$ 应用于完美导体的结果，完美导体不允许磁场穿透建立或改变。\n    2. 切向分量 $B_x$ 的条件 $\\partial_y B_x|_{y=0,L_y} = 0$ 是从欧姆定律和完美导体的性质推导出来的。在静止壁上，$\\mathbf{u}=\\mathbf{0}$，广义欧姆定律简化为 $\\mathbf{E} = \\eta \\mathbf{J}$。完美导体不能维持与其表面相切的电场，因此在 $y=0, L_y$ 处 $E_x=0$ 和 $E_z=0$。对于具有场 $\\mathbf{B} = (B_x, B_y, 0)$ 的二维问题，平面外电流密度为 $J_z = \\mu_0^{-1}(\\partial_x B_y - \\partial_y B_x)$。因此，平面外电场为 $E_z = \\eta J_z = (\\eta/\\mu_0)(\\partial_x B_y - \\partial_y B_x)$。在壁上设置 $E_z=0$ 得到 $\\partial_x B_y - \\partial_y B_x = 0$。由于在壁上所有 $x$ 的 $B_y=0$，其切向导数 $\\partial_x B_y$ 也为零。这迫使剩下的项为零：$\\partial_y B_x = 0$。\n\n因此，这些条件在物理上与完美导电、静止壁的模型一致。\n\n#### 2. 与无散度约束的相容性\n使用流函数 $\\mathbf{F} = \\nabla \\times (\\psi \\hat{\\mathbf{z}})$，其中 $\\mathbf{F}$ 是 $\\mathbf{B}$ 或 $\\mathbf{u}$，自动确保连续场是无散度的，因为对于任何矢量势 $\\mathbf{A}$，$\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$。为 $\\mathbf{B}$ 和 $\\mathbf{u}$ 提供的流函数被构造成也满足边界条件。\n\n对于离散情况，MAC 网格专门设计用于维持该属性的离散模拟。离散散度算子是单元中心 $(i,j)$ 处的中心差分近似：\n$$ (\\nabla \\cdot \\mathbf{F})_{i,j} = \\frac{F_x[i+1, j] - F_x[i, j]}{\\Delta x} + \\frac{F_y[i, j+1] - F_y[i, j]}{\\Delta y} $$\n其中 $F_x[i,j]$ 是在 $x=i\\Delta x$ 面上的 $x$ 分量，$F_y[i,j]$ 是在 $y=j\\Delta y$ 面上的 $y$ 分量。\n\n全局离散散度是所有单元上的和。这个和是伸缩的：\n$$ \\sum_{i,j} (\\nabla \\cdot \\mathbf{F})_{i,j} = \\frac{1}{\\Delta x}\\sum_j \\sum_i (F_x[i+1,j] - F_x[i,j]) + \\frac{1}{\\Delta y}\\sum_i \\sum_j (F_y[i,j+1] - F_y[i,j]) $$\n$F_x$ 项对 $i$ 的求和得到 $\\sum_j (F_x[N_x,j] - F_x[0,j])$。由于周期性，$x=L_x$ 处的 $F_x$ 等于 $x=0$ 处的 $F_x$，所以这个和为零。$F_y$ 项对 $j$ 的求和得到 $\\sum_i (F_y[i,N_y] - F_y[i,0])$。在 $y=0$ 和 $y=L_y$ 处的边界条件 $F_y=0$（对于 $\\mathbf{B}$ 和 $\\mathbf{u}$ 都是）使得第二个和也为零。\n因此，域上的总散度在数值上为零，这是长时间模拟的关键属性。我们的任务是检查局部的、逐个单元的离散散度，对于光滑的、解析上无散度的场，这个值应该很小（在有限差分格式的截断误差量级）。\n\n#### 3. 数值实现策略\n计划是实现一个函数，为每个测试用例执行以下步骤：\n1.  **网格生成**：定义网格间距 $\\Delta x, \\Delta y$。使用 `numpy.meshgrid` 和 `indexing='ij'` 为 $x$ 面心位置（用于 $u_x, B_x$）和 $y$ 面心位置（用于 $u_y, B_y$）创建二维坐标数组。\n2.  **场填充**：为从给定流函数导出的 $B_x, B_y, u_x, u_y$ 的解析形式定义 Python 函数。在相应的坐标网格上评估这些函数以填充离散场数组。\n3.  **边界条件**：对于标准情况（$m=0$），解析函数已经满足所需的边界条件。对于违反情况（$m=1$），在填充 $B_y$ 数组后，将其在顶部（$j=N_y$）和底部（$j=0$）边界的值覆盖为常数 $1.0$。在所有情况下，速度场 $\\mathbf{u}$ 保持不变。\n4.  **散度计算**：使用 `numpy` 数组切片应用离散散度算子。对于场 $\\mathbf{F}=(F_x, F_y)$，散度数组 `div_F` 计算如下：\n    `div_Fx = (Fx[1:, :] - Fx[:-1, :]) / dx`\n    `div_Fy = (Fy[:, 1:] - Fy[:, :-1]) / dy`\n    `div_F = div_Fx + div_Fy`\n    这将计算所有 $N_x \\times N_y$ 单元中心的散度。\n5.  **误差测量**：使用 `numpy.max(numpy.abs(...))` 计算 $\\mathbf{B}$ 和 $\\mathbf{u}$ 的所得散度数组的最大绝对值。返回这些值。\n\n主程序将遍历测试用例，调用此函数，并按要求格式化结果。对于适定情况，我们期望散度很小，并随网格细化而减小（二阶收敛，即误差 $\\propto h^2$）。对于违反情况，我们期望一个大的、$O(1/\\Delta y)$ 的散度，表明不相容性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to execute all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (Lx, Ly, Nx, Ny, m)\n        (2.0, 1.0, 16, 8, 0),   # Case A\n        (2.0, 1.0, 64, 32, 0),  # Case B\n        (2.0, 1.0, 64, 32, 1),  # Case C\n    ]\n\n    results = []\n    for Lx, Ly, Nx, Ny, m in test_cases:\n        max_div_B, max_div_u = compute_divergence_errors(Lx, Ly, Nx, Ny, m)\n        results.append(max_div_B)\n        results.append(max_div_u)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\ndef compute_divergence_errors(Lx, Ly, Nx, Ny, m):\n    \"\"\"\n    Computes the maximum absolute discrete divergence for B and u fields.\n\n    Args:\n        Lx (float): Domain length in x.\n        Ly (float): Domain length in y.\n        Nx (int): Number of grid cells in x.\n        Ny (int): Number of grid cells in y.\n        m (int): Flag for magnetic boundary condition. \n                 0 for correct, 1 for violated.\n\n    Returns:\n        tuple[float, float]: A tuple containing the max absolute divergence\n                             of B and u, respectively.\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # --- Define analytic functions from streamfunctions ---\n    # B field from psi = sin(pi*y/Ly)*cos(2*pi*x/Lx)\n    # Bx = d(psi)/dy, By = -d(psi)/dx\n    def Bx_func(x, y, Lx, Ly):\n        return (np.pi / Ly) * np.cos(np.pi * y / Ly) * np.cos(2 * np.pi * x / Lx)\n    def By_func(x, y, Lx, Ly):\n        return (2 * np.pi / Lx) * np.sin(np.pi * y / Ly) * np.sin(2 * np.pi * x / Lx)\n\n    # u field from phi = sin^2(pi*y/Ly)*cos(2*pi*x/Lx)\n    # ux = d(phi)/dy, uy = -d(phi)/dx\n    def ux_func(x, y, Lx, Ly):\n        return (np.pi / Ly) * np.sin(2 * np.pi * y / Ly) * np.cos(2 * np.pi * x / Lx)\n    def uy_func(x, y, Lx, Ly):\n        return (2 * np.pi / Lx) * (np.sin(np.pi * y / Ly))**2 * np.sin(2 * np.pi * x / Lx)\n\n    # --- Grid generation (MAC staggered) ---\n    # Coordinates for Bx, ux (x-faces: centered in y, on x-nodes)\n    x_bx_coords = np.arange(Nx + 1) * dx\n    y_bx_coords = (np.arange(Ny) + 0.5) * dy\n    xx_bx, yy_bx = np.meshgrid(x_bx_coords, y_bx_coords, indexing='ij')\n\n    # Coordinates for By, uy (y-faces: centered in x, on y-nodes)\n    x_by_coords = (np.arange(Nx) + 0.5) * dx\n    y_by_coords = np.arange(Ny + 1) * dy\n    xx_by, yy_by = np.meshgrid(x_by_coords, y_by_coords, indexing='ij')\n\n    # --- B-field divergence calculation ---\n    # Populate Bx array\n    Bx = Bx_func(xx_bx, yy_bx, Lx, Ly)\n    # Populate By array\n    By = By_func(xx_by, yy_by, Lx, Ly)\n\n    # For case C, intentionally violate the magnetic boundary condition at y=0, Ly\n    if m == 1:\n        # The first and last rows of By correspond to y=0 and y=Ly\n        By[:, 0] = 1.0  # At y=0\n        By[:, -1] = 1.0 # At y=Ly\n\n    # Compute divergence of B at cell centers\n    # Term from x-derivative of Bx\n    div_Bx_term = (Bx[1:(Nx + 1), :] - Bx[0:Nx, :]) / dx\n    # Term from y-derivative of By\n    div_By_term = (By[:, 1:(Ny + 1)] - By[:, 0:Ny]) / dy\n    # Total divergence of B\n    div_B = div_Bx_term + div_By_term\n\n    max_abs_div_B = np.max(np.abs(div_B))\n\n    # --- u-field divergence calculation ---\n    # Populate ux array\n    ux = ux_func(xx_bx, yy_bx, Lx, Ly)\n    # Populate uy array\n    uy = uy_func(xx_by, yy_by, Lx, Ly)\n\n    # Compute divergence of u at cell centers\n    # Term from x-derivative of ux\n    div_ux_term = (ux[1:(Nx + 1), :] - ux[0:Nx, :]) / dx\n    # Term from y-derivative of uy\n    div_uy_term = (uy[:, 1:(Ny + 1)] - uy[:, 0:Ny]) / dy\n    # Total divergence of u\n    div_u = div_ux_term + div_uy_term\n\n    max_abs_div_u = np.max(np.abs(div_u))\n\n    return max_abs_div_B, max_abs_div_u\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}