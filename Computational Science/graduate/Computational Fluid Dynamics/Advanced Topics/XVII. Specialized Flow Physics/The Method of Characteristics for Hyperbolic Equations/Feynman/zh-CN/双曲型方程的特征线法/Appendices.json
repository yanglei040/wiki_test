{
    "hands_on_practices": [
        {
            "introduction": "本练习为特征线法奠定了理论基础，引导您为典型的双曲型偏微分方程——无粘性伯格斯方程（inviscid Burgers' equation）推导出经典解。通过这个过程 ，您将深入理解特征线如何传递信息，以及特征线的相交如何导致光滑解的破裂并最终形成激波。",
            "id": "3376534",
            "problem": "考虑一维无粘流的标量守恒律\n$$\nu_{t} + u\\,u_{x} = 0,\\quad (x,t)\\in \\mathbb{R}\\times [0,\\infty),\n$$\n其初始条件为\n$$\nu(x,0)=\\phi(x),\n$$\n其中 $\\phi:\\mathbb{R}\\to\\mathbb{R}$ 是一个连续可微函数，满足 $\\phi\\in C^{1}(\\mathbb{R})$，且 $\\phi$ 和 $\\phi'$ 有界。从守恒律结构和特征曲线的定义出发，推导特征常微分方程，并通过积分求得从初始足点 $a$ 到时刻 $t$ 的当前位置 $x$ 的拉格朗日流映射。利用此映射构建特征映射，并陈述其局部可逆的精确条件。然后，用 $\\phi$ 和特征足点映射的逆映射来表示古典解 $u(x,t)$，该解在最早激波形成时间之前有效。最后，根据 $\\phi'$ 确定最早的激波形成时间 $t_{\\ast}$，此时间被理解为存在 $u\\in C^{1}$ 古典解的时间的上确界。\n\n你的最终答案必须包含：\n- 一个用 $\\phi$ 和特征足点映射的逆映射写出的 $u(x,t)$ 的显式表达式，以及\n- 一个用 $\\phi'$ 写出的 $t_{\\ast}$ 的显式表达式。\n\n不需要进行数值计算或四舍五入。请用符号表示你的答案。不要包含单位。如果你的表达式是分段定义的，你必须明确地写出分段形式。",
            "solution": "所述问题构成了无粘伯格斯方程（一个基本的标量双曲守恒律）的一个有效的初值问题。所有提供的信息都是一致且充分的，足以通过特征线法推导出古典解并确定其有效时间。\n\n给定的偏微分方程是拟线性形式的无粘伯格斯方程：\n$$\nu_{t} + u\\,u_{x} = 0, \\quad (x,t)\\in \\mathbb{R}\\times [0,\\infty)\n$$\n初始条件为 $u(x,0)=\\phi(x)$。已知函数 $\\phi$ 属于 $C^{1}(\\mathbb{R})$，且 $\\phi$ 及其导数 $\\phi'$ 有界。\n\n我们使用特征线法求解。设 $(x,t)$ 平面中的一条曲线由 $s \\mapsto (x(s), t(s))$ 参数化。我们选择 $s=t$，因此曲线由 $x(t)$ 给出。解 $u(x(t),t)$ 沿此曲线的全导数为：\n$$\n\\frac{d}{dt}u(x(t),t) = u_{t}(x(t),t) + u_{x}(x(t),t) \\frac{dx}{dt}\n$$\n将其与偏微分方程 $u_t = -u u_x$ 比较，我们发现如果通过常微分方程（ODE）定义特征曲线：\n$$\n\\frac{dx}{dt} = u(x(t),t)\n$$\n那么沿着这些曲线，$u$ 的全导数变为：\n$$\n\\frac{d}{dt}u(x(t),t) = -u u_x + u_x u = 0\n$$\n因此，特征常微分方程组为：\n$$\n\\frac{du}{dt} = 0\n$$\n$$\n\\frac{dx}{dt} = u\n$$\n第一个常微分方程 $\\frac{du}{dt}=0$ 意味着解 $u$ 的值在任何给定的特征曲线上都是常数。这个常数的值由初始条件确定。设一条特征曲线始于初始线 $t=0$ 上的点 $(a,0)$。那么沿着整条曲线 $u$ 的值都是 $u(x(0),0) = u(a,0) = \\phi(a)$。\n\n将这个常数值代入第二个常微分方程，我们得到：\n$$\n\\frac{dx}{dt} = \\phi(a)\n$$\n我们对这个常微分方程关于时间 $t$ 积分，使用初始条件 $x(0)=a$：\n$$\n\\int_{a}^{x} d\\xi = \\int_{0}^{t} \\phi(a) d\\tau\n$$\n这就得到了特征线的方程：\n$$\nx(t) = a + \\phi(a)t\n$$\n这个方程代表了拉格朗日流映射，我们记作 $x = M(a; t)$。它给出了从 $t=0$ 时的足点 $a$ 出发的特征线在时间 $t$ 的位置 $x$。\n\n在任意点 $(x,t)$ 的解 $u$ 是通过该点的特征线所携带的值 $\\phi(a)$。为了找到这个值，我们必须确定与给定 $(x,t)$ 对应的足点 $a$。这需要对特征映射 $M(a;t)$ 求逆。我们将此逆映射记为 $a(x,t)$，即 $a(x,t) = M^{-1}(x;t)$。因此，函数 $a(x,t)$ 由以下关系隐式定义：\n$$\nx = a(x,t) + \\phi(a(x,t))t\n$$\n只要这个求逆是可能且唯一的，古典解就由下式给出：\n$$\nu(x,t) = \\phi(a(x,t))\n$$\n对于固定的 $t$，特征映射 $a \\mapsto x$ 局部可逆的条件是其雅可比行列式不为零。在这个一维情况下，雅可比行列式就是导数 $\\frac{\\partial x}{\\partial a}$：\n$$\n\\frac{\\partial M(a;t)}{\\partial a} = \\frac{\\partial}{\\partial a}(a + \\phi(a)t) = 1 + \\phi'(a)t\n$$\n只要对所有 $a \\in \\mathbb{R}$ 都有 $1 + \\phi'(a)t \\neq 0$，就存在一个古典的、单值的解。由于 $t \\ge 0$，如果对所有 $a$ 都有 $\\phi'(a) \\ge 0$，那么这个条件总是满足的。\n\n当特征线相交时，激波在最早的时间 $t_{\\ast} > 0$ 形成。这对应于导数 $u_x$ 首次变为无穷大的瞬间，标志着 $C^1$ 解的破裂。为了求 $u_x$，我们将解的表达式对 $x$ 求导：\n$$\nu_x(x,t) = \\phi'(a(x,t)) \\frac{\\partial a}{\\partial x}\n$$\n为了求 $\\frac{\\partial a}{\\partial x}$，我们将隐式关系 $x = a + \\phi(a)t$ 对 $x$ 求导：\n$$\n1 = \\frac{\\partial a}{\\partial x} \\left( 1 + \\phi'(a(x,t))t \\right) \\implies \\frac{\\partial a}{\\partial x} = \\frac{1}{1 + \\phi'(a(x,t))t}\n$$\n将其代回，我们得到解的梯度的表达式：\n$$\nu_x(x,t) = \\frac{\\phi'(a(x,t))}{1 + \\phi'(a(x,t))t}\n$$\n当分母为零时，梯度 $u_x$ 变为无穷大：\n$$\n1 + \\phi'(a)t = 0 \\implies t = -\\frac{1}{\\phi'(a)}\n$$\n由于 $t$ 必须为正，这种情况只可能在 $\\phi'(a)  0$ 的 $a$ 值处发生。最早的激波形成时间 $t_{\\ast}$ 是在所有可能的初始点 $a$ 上这些时间的最小值：\n$$\nt_{\\ast} = \\inf_{a \\in \\mathbb{R} : \\phi'(a)  0} \\left\\{ -\\frac{1}{\\phi'(a)} \\right\\}\n$$\n为了找到这个下确界，我们需要最大化正量 $-\\phi'(a)$，这等价于找到 $\\phi'(a)$ 的最小值（最负的值）。令 $m = \\inf_{y \\in \\mathbb{R}} \\phi'(y)$。\n\n有两种情况：\n1.  如果 $m \\ge 0$，那么对所有 $y \\in \\mathbb{R}$ 都有 $\\phi'(y) \\ge 0$。激波形成的条件永远不会满足。古典解在所有时间都存在，因此 $t_{\\ast} = \\infty$。\n2.  如果 $m  0$，则会形成激波。它能形成的最早时间对应于 $\\phi'$ 的最负值，即 $m$。激波时间是 $t_{\\ast} = -\\frac{1}{m} = -\\frac{1}{\\inf_{y \\in \\mathbb{R}} \\phi'(y)}$。\n\n综合这两种情况，我们得到最早激波形成时间的表达式。\n第一个要求是古典解 $u(x,t)$ 关于 $\\phi$ 和特征足点映射的逆映射的表达式。如上所推导，这是 $u(x,t)=\\phi(a(x,t))$，其中 $a(x,t)$ 是逆映射。\n第二个要求是最早激波时间 $t_{\\ast}$ 的表达式。",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\nu(x,t) = \\phi(a(x,t)) \\\\\nt_{\\ast} = \\begin{cases} -\\frac{1}{\\inf_{y \\in \\mathbb{R}} \\phi'(y)}  \\text{若 } \\inf_{y \\in \\mathbb{R}} \\phi'(y)  0 \\\\ \\infty  \\text{若 } \\inf_{y \\in \\mathbb{R}} \\phi'(y) \\ge 0 \\end{cases}\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "在理解了激波如何形成之后，本练习  将进一步探讨间断解的性质。通过分析一个具有非凸通量函数的黎曼问题，您将应用兰金-雨果尼奥（Rankine-Hugoniot）跳跃关系来确定激波速度，并探索熵条件在筛选物理相关弱解时所起的关键作用。",
            "id": "3376556",
            "problem": "考虑一维非线性标量守恒律\n$$\nu_{t} + \\partial_{x} f(u) = 0,\n$$\n它代表了计算流体动力学中标量在无粘性情况下的守恒，其通量函数为 $$f(u) = \\frac{u^{3}}{3}$$。初始条件为黎曼数据\n$$\nu(x,0) = \\begin{cases}\nu_{L},  x  0, \\\\\nu_{R},  x > 0,\n\\end{cases}\n$$\n其中 $$u_{L} = 2$$ 且 $$u_{R} = -1$$。使用特征线法 (Method of Characteristics, MOC) 以及从守恒律积分形式推导出的弱解框架，判断产生的自相似解是激波还是稀疏波。如果形成激波，请使用适当的守恒和可采纳性原则计算其速度。\n\n将最终答案表示为激波速度的单个实数（无量纲）。提供精确值，不要四舍五入。",
            "solution": "问题陈述已经过验证，被认为是可靠、适定且有科学依据的。它提出了一个经典的非线性标量守恒律的黎曼问题。\n\n控制方程为一维非线性标量守恒律：\n$$\nu_{t} + \\partial_{x} f(u) = 0\n$$\n其中 $u(x,t)$ 是守恒量，通量函数 $f(u)$ 指定为：\n$$\nf(u) = \\frac{u^{3}}{3}\n$$\n该问题服从黎曼初始条件：\n$$\nu(x,0) = \\begin{cases}\nu_{L},  x  0 \\\\\nu_{R},  x > 0\n\\end{cases}\n$$\n其中常数状态为 $u_{L} = 2$ 和 $u_{R} = -1$。\n\n为了分析解的演化，我们首先将偏微分方程写成其拟线性形式 $u_{t} + c(u) u_{x} = 0$，其中 $c(u)$ 是特征速度。特征速度由通量函数对 $u$ 的导数给出：\n$$\nc(u) = f'(u) = \\frac{d}{du}\\left(\\frac{u^{3}}{3}\\right) = u^{2}\n$$\n特征线法表明，$u$ 的值沿着由 $\\frac{dx}{dt} = c(u)$ 定义的特征曲线保持不变。\n\n我们计算初始左右状态的特征速度：\n左状态 $u_{L} = 2$ 的特征速度是：\n$$\nc(u_{L}) = c(2) = 2^{2} = 4\n$$\n右状态 $u_{R} = -1$ 的特征速度是：\n$$\nc(u_{R}) = c(-1) = (-1)^{2} = 1\n$$\n从初始间断产生的解的类型取决于 $c(u_{L})$ 和 $c(u_{R})$ 之间的关系。\n- 如果 $c(u_{L})  c(u_{R})$，特征线发散，形成称为稀疏波的连续解。\n- 如果 $c(u_{L}) > c(u_{R})$，来自左侧的特征线会追上来自右侧的特征线。它们相交，导致多值解，这是不符合物理规律的。自然界通过形成一个间断，即激波，来解决这个问题。\n\n在本题中，我们有 $c(u_{L}) = 4$ 和 $c(u_{R}) = 1$。由于 $c(u_{L}) > c(u_{R})$，特征线会碰撞，必须形成激波。\n\n这个激波的速度，记为 $s$，由 Rankine-Hugoniot 跳跃条件确定。这个条件是从应用于间断两侧的守恒律积分形式推导出来的，确保激波正确地守恒量 $u$。该条件为：\n$$\ns = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}\n$$\n现在我们计算左右状态的通量函数值：\n对于 $u_{L} = 2$，通量为：\n$$\nf(u_{L}) = f(2) = \\frac{2^{3}}{3} = \\frac{8}{3}\n$$\n对于 $u_{R} = -1$，通量为：\n$$\nf(u_{R}) = f(-1) = \\frac{(-1)^{3}}{3} = -\\frac{1}{3}\n$$\n将这些值代入 Rankine-Hugoniot 条件，求出激波速度 $s$：\n$$\ns = \\frac{-\\frac{1}{3} - \\frac{8}{3}}{-1 - 2} = \\frac{-\\frac{9}{3}}{-3} = \\frac{-3}{-3} = 1\n$$\n为了使这个激波在物理上是可采纳的，它必须满足一个熵条件。通量函数 $f(u) = u^3/3$ 是非凸的，因为它的二阶导数 $f''(u) = 2u$ 会改变符号。因此，我们必须使用广义的 Oleinik 熵条件。对于连接 $u_{L}$ 和 $u_{R}$（其中 $u_{L} > u_{R}$）的激波，该条件要求对于 $u \\in [u_{R}, u_{L}]$，$f(u)$ 的图像位于连接点 $(u_{R}, f(u_{R}))$ 和 $(u_{L}, f(u_{L}))$ 的线段（弦）下方或其上。\n在数学上，这可以表示为：\n$$\nf(u) \\le f(u_{R}) + s(u - u_{R}) \\quad \\text{对于所有 } u \\in [u_{R}, u_{L}]\n$$\n代入已知值，$s=1$，$u_R=-1$ 和 $f(u_R)=-1/3$：\n$$\n\\frac{u^3}{3} \\le -\\frac{1}{3} + 1(u - (-1)) \\quad \\text{对于所有 } u \\in [-1, 2]\n$$\n$$\n\\frac{u^3}{3} \\le u + 1 - \\frac{1}{3}\n$$\n$$\n\\frac{u^3}{3} \\le u + \\frac{2}{3}\n$$\n乘以 3 并重新整理可得：\n$$\nu^3 - 3u - 2 \\le 0\n$$\n我们来分析多项式 $p(u) = u^3 - 3u - 2$。根据构造，它的根必须包括 $u=u_L=2$ 和 $u=u_R=-1$。确实，$p(2) = 2^3 - 3(2) - 2 = 8 - 6 - 2 = 0$ 且 $p(-1) = (-1)^3 - 3(-1) - 2 = -1 + 3 - 2 = 0$。由于 $u=-1$ 是一个根，$(u+1)$ 是一个因子。由于 $p'(-1) = 3(-1)^2 - 3 = 0$，$u=-1$ 是一个二重根。该多项式可因式分解为 $p(u) = (u-2)(u+1)^2$。\n对于 $u \\in [-1, 2]$，项 $(u+1)^2$ 是非负的，项 $(u-2)$ 是非正的。因此，它们的乘积 $(u-2)(u+1)^2$ 对于区间 $[-1, 2]$ 中的所有 $u$ 都是非正的。Oleinik 熵条件得到满足，证实了该激波是可采纳的。\n\n最终的自相似解是一个以恒定速度 $s = 1$ 传播的激波。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "本练习将理论付诸实践，将特征线法应用于计算流体动力学中的一个经典问题：含源项的准一维喷管流。您将为马赫数推导一个常微分方程（ODE），并实施数值方法来求解喷管中的超声速流场 ，从而连接起解析理论与计算实践的桥梁。",
            "id": "3376542",
            "problem": "要求您编写一个完整、可运行的程序，该程序通过使用经喷管面积源项调整的特征线法（MOC）相容性关系进行顺流步进，计算准一维等熵可压缩流的超音速部分。该流动受理想气体的一维可压缩欧拉方程控制，比热比为$\\gamma$，采用准一维面积变化模型，并假设流动为等熵、无粘、绝热且无体积力。基本出发点是：\n- 理想气体的质量、动量和能量守恒，其中横截面积$A(x)$随轴向坐标$x$平滑变化。\n- 状态方程 $p = \\rho R T$ 和声速 $a^2 = \\gamma p/\\rho$。\n- 等熵关系 $p \\propto \\rho^\\gamma$ 和马赫数定义 $M = u/a$。\n\n从非定常准一维方程出发：\n$$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} + \\frac{\\rho u}{A}\\frac{dA}{dx} = 0,$$\n$$\\frac{\\partial u}{\\partial t} + u\\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0,$$\n$$\\frac{\\partial p}{\\partial t} + u\\frac{\\partial p}{\\partial x} + \\rho a^2\\left(\\frac{\\partial u}{\\partial x} + \\frac{u}{A}\\frac{dA}{dx}\\right) = 0,$$\n推导在存在准一维源项的情况下，沿 $dx/dt = u \\pm a$ 族线的特征相容性关系，并将其简化为适用于超音速流动的定常双曲区域。然后，仅从上述基本方程和定义出发，将定常问题进一步简化为一个包含面积源效应的马赫数$M(x)$的常微分方程。您的程序必须实现一个基于此相容性推导出的$M(x)$常微分方程的稳定顺流步进方法，以计算超音速分支，并使用从音速喉道附近一个小的正$x$处的等熵面积-马赫数关系中选择的正确超音速初始条件。\n\n算法要求：\n- 利用相容性关系推导出一个适用于有面积变化$A(x)$的定常超音速流动的$M(x)$的常微分方程。该方程必须包含来自$dA/dx$的源项。\n- 在$x = x_0$处进行初始化，其中$x_0 > 0$且非常小，恰好位于$x=0$处的音速喉道下游，此处$A(0) = A^\\star$。利用代数等熵面积-马赫数关系，根据给定的面积比$A(x_0)/A^\\star$选择$M(x_0)$的超音速根。\n- 使用您选择的数值稳定的显式积分器（例如，四阶龙格-库塔法）顺流推进，以获得在要求位置的$M(x)$。\n- 在需要时，使用理想气体等熵关系计算静压与总压之比$p/p_0$和静温$T$：\n  $$\\frac{p}{p_0} = \\left(1 + \\frac{\\gamma - 1}{2} M^2\\right)^{-\\frac{\\gamma}{\\gamma - 1}}, \\quad \\frac{T}{T_0} = \\left(1 + \\frac{\\gamma - 1}{2} M^2\\right)^{-1}.$$\n\n单位和输出：\n- 马赫数$M$是无量纲的。\n- 总压$p_0$必须以帕斯卡（国际单位制）表示，静温$T$必须以开尔文表示。\n- 当输出要求温度时，以开尔文表示；当输出要求压比时，表示为一个无百分号的无量纲小数。最终的数值输出应按如下规定进行四舍五入。\n\n测试套件和要求的输出：\n实现您的程序以评估以下五个独立的参数集。对于每个集合，计算所要求的一个或多个量。面积$A(x)$的单位是平方米，$x$的单位是米。在所有情况下，取$A^\\star = A(0)$；您的代码必须直接从给定的$A(x)$函数中推断出$A^\\star$。\n\n- 测试A（正常情况，中等扩张）：\n  - 参数：$\\gamma = 1.4$, $R = 287$, $p_0 = 100000$, $T_0 = 300$, $A(x) = 1 + 0.2 x^2$。\n  - 目标：$x = 0.25$ 和 $x = 0.75$。\n  - 输出：$M(0.25)$ 和 $M(0.75)$，均为无量纲，各自四舍五入到六位小数。\n\n- 测试B（较强扩张，四次项）：\n  - 参数：$\\gamma = 1.4$, $R = 287$, $p_0 = 100000$, $T_0 = 300$, $A(x) = 1 + 0.4 x^2 + 0.02 x^4$。\n  - 目标：$x = 1.0$。\n  - 输出：$M(1.0)$，无量纲，四舍五入到六位小数。\n\n- 测试C（不同气体，压比检验）：\n  - 参数：$\\gamma = 1.67$, $R = 2077$, $p_0 = 250000$, $T_0 = 300$, $A(x) = 1 + 0.2 x^2$。\n  - 目标：$x = 1.0$。\n  - 输出：$x = 1.0$ 处的 $p/p_0$，无量纲，四舍五入到六位小数。\n\n- 测试D（缓慢扩张，长管道）：\n  - 参数：$\\gamma = 1.3$, $R = 287$, $p_0 = 200000$, $T_0 = 400$, $A(x) = 1 + 0.02 x^2$。\n  - 目标：$x = 5.0$。\n  - 输出：$M(5.0)$，无量纲，四舍五入到六位小数。\n\n- 测试E（从总温计算静温）：\n  - 参数：$\\gamma = 1.4$, $R = 287$, $p_0 = 100000$, $T_0 = 300$, $A(x) = 1 + 0.2 x^2$。\n  - 目标：$x = 1.0$。\n  - 输出：$T(1.0)$，单位为开尔文，四舍五入到三位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$[M_A(0.25), M_A(0.75), M_B(1.0), (p/p_0)_C(1.0), M_D(5.0), T_E(1.0)]。$$\n\n例如，您的程序必须打印一行如下格式的输出：\n$$[1.234567,1.345678,1.456789,0.234567,1.567890,205.123].$$",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于可压缩流体动力学原理，特别是准一维等熵流动。该问题是适定的，提供了一套完整且一致的控制方程、边界条件和参数，这使得唯一且稳定的解得以存在。所有术语都得到了客观和精确的定义。\n\n任务是计算扩张喷管中超音速流的性质。这需要推导马赫数$M$作为轴向坐标$x$的函数的常微分方程（ODE），然后进行数值积分。推导过程从定常、准一维欧拉方程开始，这些方程是在定常假设（$\\partial/\\partial t = 0$）下对所提供的非定常方程进行简化的结果。\n\n理想气体的定常、无粘、等熵、准一维流动的控制方程是：\n1.  **连续性方程：**\n    $$ \\frac{d}{dx}(\\rho u A) = 0 $$\n    其微分形式为：\n    $$ \\frac{1}{\\rho}\\frac{d\\rho}{dx} + \\frac{1}{u}\\frac{du}{dx} + \\frac{1}{A}\\frac{dA}{dx} = 0 $$\n\n2.  **动量方程（欧拉方程）：**\n    $$ \\rho u \\frac{du}{dx} + \\frac{dp}{dx} = 0 $$\n\n3.  **等熵关系：** 流动是等熵的，因此总性质是恒定的。压力$p$和密度$\\rho$的变化通过声速$a$的平方相关联：\n    $$ dp = a^2 d\\rho \\implies \\frac{dp}{dx} = a^2 \\frac{d\\rho}{dx} $$\n\n从动量方程，我们将$\\frac{dp}{dx}$表示为$-\\rho u \\frac{du}{dx}$。将此代入等熵关系得到：\n$$ -\\rho u \\frac{du}{dx} = a^2 \\frac{d\\rho}{dx} \\implies \\frac{1}{\\rho}\\frac{d\\rho}{dx} = -\\frac{u}{a^2}\\frac{du}{dx} $$\n回顾马赫数定义，$M = u/a$，上式简化为：\n$$ \\frac{1}{\\rho}\\frac{d\\rho}{dx} = -M^2 \\frac{1}{u}\\frac{du}{dx} $$\n将这个密度梯度的表达式代回到连续性方程的微分形式中，得到：\n$$ -M^2 \\frac{1}{u}\\frac{du}{dx} + \\frac{1}{u}\\frac{du}{dx} + \\frac{1}{A}\\frac{dA}{dx} = 0 $$\n$$ (1-M^2)\\frac{1}{u}\\frac{du}{dx} = -\\frac{1}{A}\\frac{dA}{dx} $$\n这个关系式通常被称为面积-速度关系，可以重新整理以表达速度梯度：\n$$ \\frac{du}{dx} = \\frac{u}{M^2-1} \\frac{1}{A}\\frac{dA}{dx} $$\n\n为了获得马赫数$M(x)$的常微分方程，我们对定义式$M = u/a$进行微分：\n$$ \\frac{dM}{dx} = \\frac{1}{a}\\frac{du}{dx} - \\frac{u}{a^2}\\frac{da}{dx} = \\frac{M}{u}\\frac{du}{dx} - \\frac{M}{a}\\frac{da}{dx} $$\n对于理想气体的等熵流动，总温$T_0$是恒定的。当地静温$T$和声速$a$与$M$和$T_0$的关系如下：\n$$ \\frac{T}{T_0} = \\left(1 + \\frac{\\gamma-1}{2}M^2\\right)^{-1} \\quad \\text{and} \\quad a^2 = \\gamma R T $$\n由此，我们找到声速$a$和马赫数$M$之间的关系：\n$$ a^2 = a_0^2 \\left(1 + \\frac{\\gamma-1}{2}M^2\\right)^{-1} $$\n其中$a_0 = \\sqrt{\\gamma R T_0}$是总声速。对$x$求导：\n$$ 2a\\frac{da}{dx} = -a_0^2 \\left(1 + \\frac{\\gamma-1}{2}M^2\\right)^{-2} (\\gamma-1)M\\frac{dM}{dx} $$\n两边除以$2a^2$得到对数导数：\n$$ \\frac{1}{a}\\frac{da}{dx} = -\\frac{a_0^2}{2a^2}\\frac{(\\gamma-1)M}{ (1 + \\frac{\\gamma-1}{2}M^2)^2 } \\frac{dM}{dx} = -\\frac{1}{2} \\frac{(\\gamma-1)M}{1 + \\frac{\\gamma-1}{2}M^2} \\frac{dM}{dx} $$\n将$\\frac{du}{dx}$和$\\frac{1}{a}\\frac{da}{dx}$的表达式代入$\\frac{dM}{dx}$的方程中：\n$$ \\frac{dM}{dx} = \\frac{M}{u} \\left( \\frac{u}{M^2-1} \\frac{1}{A}\\frac{dA}{dx} \\right) - M \\left( -\\frac{1}{2} \\frac{(\\gamma-1)M}{1 + \\frac{\\gamma-1}{2}M^2} \\frac{dM}{dx} \\right) $$\n$$ \\frac{dM}{dx} = \\frac{M}{M^2-1} \\frac{1}{A}\\frac{dA}{dx} + \\frac{(\\gamma-1)M^2/2}{1 + (\\gamma-1)M^2/2} \\frac{dM}{dx} $$\n重新整理以求解$\\frac{dM}{dx}$：\n$$ \\frac{dM}{dx} \\left( 1 - \\frac{(\\gamma-1)M^2/2}{1 + (\\gamma-1)M^2/2} \\right) = \\frac{M}{M^2-1} \\frac{1}{A}\\frac{dA}{dx} $$\n$$ \\frac{dM}{dx} \\left( \\frac{1 + \\frac{\\gamma-1}{2}M^2 - \\frac{\\gamma-1}{2}M^2}{1 + \\frac{\\gamma-1}{2}M^2} \\right) = \\frac{M}{M^2-1} \\frac{1}{A}\\frac{dA}{dx} $$\n这简化为最终的马赫数常微分方程：\n$$ \\frac{dM}{dx} = \\frac{M\\left(1 + \\frac{\\gamma-1}{2}M^2\\right)}{M^2-1} \\frac{1}{A(x)}\\frac{dA(x)}{dx} $$\n这个常微分方程控制着马赫数沿喷管超音速分支（$M>1$）的演变。项$\\frac{1}{A}\\frac{dA}{dx}$作为源项驱动$M$的变化。对于扩张喷管（$dA/dx > 0$）和超音速流（$M>1$），$\\frac{dM}{dx} > 0$，表明流动在加速。\n\n数值求解过程如下：\n1.  **初始化：** 积分不能从$M=1$的喉道$x=0$处开始，因为常微分方程在该点是奇异的。我们从喉道下游的一个小距离$x_0 > 0$处开始。初始马赫数$M(x_0)$通过求解等熵面积-马赫数关系的超音速根（$M>1$）来确定：\n    $$ \\left(\\frac{A(x_0)}{A^\\star}\\right)^2 = \\frac{1}{M^2}\\left[\\frac{2}{\\gamma+1}\\left(1 + \\frac{\\gamma-1}{2}M^2\\right)\\right]^{\\frac{\\gamma+1}{\\gamma-1}} $$\n    其中$A^\\star = A(0)$。这个超越方程使用数值求根算法求解。\n\n2.  **积分：** 推导出的常微分方程是一个一阶初值问题。它使用稳定的数值方法从$x_0$积分到所需的目标位置$x_{target}$。我们采用SciPy库中的`solve_ivp`函数，该函数实现了自适应龙格-库塔法（RK45），确保了精度和稳定性。\n\n3.  **输出计算：** 一旦在目标位置找到马赫数$M$，就可以使用标准的等熵关系计算所需的物理量：\n    $$ \\frac{p}{p_0} = \\left(1 + \\frac{\\gamma-1}{2}M^2\\right)^{-\\frac{\\gamma}{\\gamma-1}}, \\quad T = T_0 \\left(1 + \\frac{\\gamma-1}{2}M^2\\right)^{-1} $$\n    总压$p_0$和气体常数$R$已给出，但在给定总温$T_0$的情况下，计算马赫数$M$、压比$p/p_0$或静温$T$并非必需。包含它们是为了指定一个完整的物理状态，但不会改变所需的计算。\n\n以下程序实现了这整个过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes supersonic quasi-1D isentropic flow properties by integrating\n    the Mach number ODE derived from the method of characteristics.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test A: M(0.25)\n        {'gamma': 1.4, 'T0': 300, \n         'A_coeffs': {'c0': 1.0, 'c2': 0.2, 'c4': 0.0}, 'x_target': 0.25, \n         'output_type': 'M', 'precision': 6},\n        # Test A: M(0.75)\n        {'gamma': 1.4, 'T0': 300,\n         'A_coeffs': {'c0': 1.0, 'c2': 0.2, 'c4': 0.0}, 'x_target': 0.75, \n         'output_type': 'M', 'precision': 6},\n        # Test B: M(1.0)\n        {'gamma': 1.4, 'T0': 300,\n         'A_coeffs': {'c0': 1.0, 'c2': 0.4, 'c4': 0.02}, 'x_target': 1.0, \n         'output_type': 'M', 'precision': 6},\n        # Test C: p/p0(1.0)\n        {'gamma': 1.67, 'T0': 300,\n         'A_coeffs': {'c0': 1.0, 'c2': 0.2, 'c4': 0.0}, 'x_target': 1.0, \n         'output_type': 'p_ratio', 'precision': 6},\n        # Test D: M(5.0)\n        {'gamma': 1.3, 'T0': 400,\n         'A_coeffs': {'c0': 1.0, 'c2': 0.02, 'c4': 0.0}, 'x_target': 5.0, \n         'output_type': 'M', 'precision': 6},\n        # Test E: T(1.0)\n        {'gamma': 1.4, 'T0': 300,\n         'A_coeffs': {'c0': 1.0, 'c2': 0.2, 'c4': 0.0}, 'x_target': 1.0, \n         'output_type': 'T', 'precision': 3},\n    ]\n\n    results = []\n    \n    # Define a small offset from the throat to start integration\n    x0 = 1e-7\n\n    for case in test_cases:\n        gamma = case['gamma']\n        T0 = case['T0']\n        coeffs = case['A_coeffs']\n        x_target = case['x_target']\n\n        # Define area A(x) and its derivative dA/dx from coefficients\n        A = lambda x: coeffs['c0'] + coeffs['c2'] * x**2 + coeffs['c4'] * x**4\n        dA_dx = lambda x: 2 * coeffs['c2'] * x + 4 * coeffs['c4'] * x**3\n\n        # Step 1: Find the initial condition M(x0)\n        A_star = A(0.0)\n        A_ratio_at_x0 = A(x0) / A_star\n\n        # Define the implicit area-Mach relation function to find its root\n        # f(M) = (A/A*)^2 - (1/M^2) * [ ... ] = 0\n        def area_mach_func(M):\n            gm1 = gamma - 1\n            gp1 = gamma + 1\n            term1 = (A_ratio_at_x0)**2\n            term2 = (1 / M**2) * ((2 / gp1) * (1 + gm1 / 2 * M**2))**(gp1 / gm1)\n            return term1 - term2\n\n        # Find the supersonic root (M > 1) of the area-Mach relation\n        M0 = brentq(area_mach_func, 1.0 + 1e-10, 10.0)\n\n        # Step 2: Integrate the ODE for M(x)\n        # dM/dx = f(x, M)\n        def dMdx(x, M):\n            if M == 1.0:\n                # This should not be reached in the supersonic case\n                return 0.0\n            \n            gm1 = gamma - 1\n            numerator = M * (1 + gm1 / 2 * M**2)\n            denominator = M**2 - 1\n            source_term = (1 / A(x)) * dA_dx(x)\n\n            return (numerator / denominator) * source_term\n\n        # Solve the Initial Value Problem using an adaptive method\n        sol = solve_ivp(\n            dMdx, \n            (x0, x_target), \n            [M0], \n            method='RK45', \n            dense_output=True, \n            rtol=1e-11, \n            atol=1e-13\n        )\n        M_final = sol.sol(x_target)[0]\n\n        # Step 3: Calculate the required output based on the final Mach number\n        output_type = case['output_type']\n        precision = case['precision']\n        \n        if output_type == 'M':\n            result_val = round(M_final, precision)\n        elif output_type == 'p_ratio':\n            gm1 = gamma - 1\n            p_ratio = (1 + gm1 / 2 * M_final**2)**(-gamma / gm1)\n            result_val = round(p_ratio, precision)\n        elif output_type == 'T':\n            gm1 = gamma - 1\n            T_final = T0 * (1 + gm1 / 2 * M_final**2)**(-1)\n            result_val = round(T_final, precision)\n        \n        results.append(f\"{result_val:.{precision}f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}