## 引言
平滑粒子[流体动力学](@entry_id:136788)（Smoothed-Particle Hydrodynamics, SPH）作为一种强大的无网格[拉格朗日方法](@entry_id:142825)，在过去几十年中已成为[计算流体力学](@entry_id:747620)（CFD）领域不可或缺的工具。与传统的基于网格的方法不同，SPH通过一系列自由移动的粒子来离散和追踪流体，这使其在模拟具有复杂自由表面、[大变形](@entry_id:167243)以及物质界面的问题时展现出无与伦比的优势。然而，要有效运用这一方法，必须深刻理解其底层的数学原理、固有的数值特性以及应对特定物理挑战的先进策略。本文旨在弥合理论与实践之间的鸿沟，为研究者和工程师提供一个关于[SPH方法](@entry_id:755216)的全面而深入的指南。

本文将引导读者循序渐进地掌握SPH的核心知识。在“原理与机制”一章中，我们将从[核函数](@entry_id:145324)插值的第一性原理出发，构建SPH的离散化框架，并深入探讨其守恒性、一致性以及数值稳定性等关键理论问题。紧接着，“应用与跨学科联系”一章将展示SPH的强大适应性，通过实例探讨其如何被扩展用于模拟[多相流](@entry_id:146480)、[非牛顿流体](@entry_id:145598)、[湍流](@entry_id:151300)以及复杂的传热现象，凸显其在天体物理、工程和生物力学等多个领域的应用价值。最后，在“动手实践”部分，我们设计了一系列实践问题，旨在帮助读者将理论知识转化为解决实际问题的能力，从而真正掌握SPH模拟的精髓。

## 原理与机制

本章深入探讨平滑粒子[流体动力学](@entry_id:136788)（Smoothed-Particle Hydrodynamics, SPH）方法的核心原理与基本机制。我们将从其数学构造的基础——[核函数](@entry_id:145324)插值——出发，系统地建立[SPH方法](@entry_id:755216)中用于近似连续介质场的离散形式。随后，我们将详细分析SPH离散算子的性质，包括守恒性、一致性和收敛性。基于这些基础，我们将推导[流体动力学](@entry_id:136788)控制方程的SPH离散形式，并探讨在处理不同类型流动（如不可压缩流和包含激波的可压缩流）时所采用的关键技术和数值策略。本章旨在为读者提供一个严谨而全面的理论框架，以理解[SPH方法](@entry_id:755216)的优势、固有的挑战及其在现代[计算流体力学](@entry_id:747620)中的应用。

### [SPH方法](@entry_id:755216)的基本构造

[SPH方法](@entry_id:755216)的核心思想是使用一个平滑的[核函数](@entry_id:145324)（smoothing kernel）将一组离散的、携带物理量的粒子（particles）上的信息插值到连续的空间场中。这是一种无网格的[拉格朗日方法](@entry_id:142825)，粒子既是计算节点，也代表了流体微元，随流体一同运动。

#### 积分表示与粒子近似

在SPH中，任意连续场 $f(\mathbf{r})$ 在空间点 $\mathbf{r}$ 处的值可以通过其与一个[核函数](@entry_id:145324) $W$ 的卷积来近似表示：
$$
f(\mathbf{r}) \approx \int f(\mathbf{r}') W(\mathbf{r} - \mathbf{r}', h) \, dV'
$$
其中，$h$ 是一个称为**平滑长度**（smoothing length）的特征尺度，它定义了核函数的影响范围。核函数 $W$ 是一个经过归一化的权函数，其性质将在下一节详细讨论。

为了将上述连续积分表达式转化为可在计算机上求解的离散形式，我们用一组携带质量 $m_b$ 和密度 $\rho_b$ 的邻近粒子 $b$ 的求和来代替积分。每个粒子 $b$ 代表一个体积微元 $dV' \approx m_b / \rho_b$。将此代入积分表达式，并令被积函数在粒子位置 $\mathbf{r}_b$ 处取值，我们便得到了在粒子 $a$ 位置 $\mathbf{r}_a$ 处场 $f$ 的**粒子近似**（particle approximation）：
$$
\langle f(\mathbf{r}_a) \rangle = \sum_b f(\mathbf{r}_b) \frac{m_b}{\rho_b} W(\mathbf{r}_a - \mathbf{r}_b, h) = \sum_b m_b \frac{f_b}{\rho_b} W_{ab}(h)
$$
这里，$f_b = f(\mathbf{r}_b)$ 是粒子 $b$ 上的场量，$W_{ab}(h) \equiv W(\mathbf{r}_a - \mathbf{r}_b, h)$ 是核函数在粒子对 $(a, b)$ 上的估值。这个求和公式是[SPH方法](@entry_id:755216)中最基本的插值形式。

一个特别重要的应用是密度的计算。通过将密度本身 $\rho$ 作为被插值的场，并利用 $\rho_b$ 作为粒子 $b$ 处的密度值，我们可以得到一个自洽的密度求和表达式：
$$
\rho_a = \langle \rho(\mathbf{r}_a) \rangle = \sum_b m_b \frac{\rho_b}{\rho_b} W_{ab}(h) = \sum_b m_b W_{ab}(h)
$$
这个公式，即**密度求和**（density summation），是SPH模拟的基石，它将每个粒子的密度与其邻近粒子的[空间分布](@entry_id:188271)直接联系起来。

### [平滑核](@entry_id:195877)函数

[平滑核](@entry_id:195877)函数 $W(\mathbf{r}, h)$ 是[SPH方法](@entry_id:755216)的核心。其选择和性质直接决定了方法的精度、稳定性和[计算效率](@entry_id:270255)。一个理想的核函数应具备以下几个关键属性：

1.  **归一性 (Normalization Condition)**：$\int W(\mathbf{r}, h) \, dV = 1$。这是确保插值过程能够精确重现常数场（即零阶一致性）的连续条件。

2.  **非负性 (Positivity)**：$W(\mathbf{r}, h) \ge 0$。这保证了插值过程中的权重为正，从而避免了非物理的负密度或[负能量](@entry_id:161542)。

3.  **紧支性 (Compact Support)**：存在一个有限的 $\kappa$，使得当 $\|\mathbf{r}\| > \kappa h$ 时，$W(\mathbf{r}, h) = 0$。这个性质将每个粒子的相互作用限制在一个有限的邻域内，极大地提高了计算效率，因为计算量与粒子数 $N$ 成正比（$\mathcal{O}(N)$），而非 $\mathcal{O}(N^2)$。

4.  **对称性 (Symmetry)**：$W(\mathbf{r}, h) = W(-\mathbf{r}, h)$。对称性确保了[核函数](@entry_id:145324)的一阶矩为零，即 $\int \mathbf{r} W(\mathbf{r}, h) \, dV = \mathbf{0}$，这对于提高近似精度至关重要。对于[径向对称](@entry_id:141658)的核函数，这一性质自然满足。

5.  **[光滑性](@entry_id:634843) (Smoothness)**：核函数及其导数需要足够光滑，以便能够计算出平滑的[力场](@entry_id:147325)，避免粒子间出现非物理的突变力。

在实践中，有几类[核函数](@entry_id:145324)被广泛使用，它们在满足上述性质方面各有取舍：

*   **高斯核 (Gaussian kernel)**：形如 $W(\mathbf{r},h) \propto \exp(-\|\mathbf{r}\|^2/h^2)$。它无限次可微（$C^\infty$），具有优良的[光滑性](@entry_id:634843)。然而，它不具备紧支性，其影响范围理论上是无限的。在实际计算中，必须在某个有限半径（如 $3h$ 或 $4h$）处进行截断。这种截断会破坏其归一性，除非进行重新归一化，否则会导致[密度估计](@entry_id:634063)等产生系统性偏差。

*   **[三次样条](@entry_id:140033)核 (Cubic Spline kernel)**：也称 $M_4$ 核，是一种[分段多项式](@entry_id:634113)函数，具有紧支性（通常 $\kappa=2$）且二次连续可微（$C^2$），足以用于计算[压力梯度力](@entry_id:262279)。它因其简单性和平滑性而成为SPH中最常用的[核函数](@entry_id:145324)之一。然而，它的[傅里叶变换](@entry_id:142120)（[频谱](@entry_id:265125)）在高波数区域存在负值部分，这与一种称为**[配对不稳定性](@entry_id:158107)**（pairing instability）的数值病症有关，尤其是在邻居粒子数较少时，粒子会倾向于形成非物理的团簇。

*   **Wendland 核 (Wendland kernels)**：这是一族专门构建的、具有紧支性的[多项式核函数](@entry_id:270040)。它们的一个突出优点是在特定维度（如 $d \le 3$）内是正定函数，这意味着它们的[傅里叶变换](@entry_id:142120)在所有[波数](@entry_id:172452)上都是非负的（$\hat{W}(k) \ge 0$）。这一特性从根本上消除了[配对不稳定性](@entry_id:158107)的根源，使得[Wendland核](@entry_id:756700)在[数值稳定性](@entry_id:146550)方面优于[三次样条](@entry_id:140033)核，尤其是在需要较大邻居数以保证精度的场合。 

### [一致性与收敛性](@entry_id:747723)

一个数值方法的**一致性**（consistency）指的是其离散算子在平滑极限下（即粒子间距趋于零）恢复相应连续介质微分算子的能力。[SPH方法](@entry_id:755216)的精度与此密切相关。

#### 函[数值插值](@entry_id:166640)的一致性

我们称SPH插值算子具有**零阶一致性**（zeroth-order consistency），如果它能精确地重现任意常数场。对于 $f(\mathbf{r}) = C$，其粒子近似为 $\langle f(\mathbf{r}_a) \rangle = C \sum_b (m_b/\rho_b) W_{ab}(h)$。为使结果等于 $C$，必须满足离散的[归一化条件](@entry_id:156486)：
$$
\sum_b \frac{m_b}{\rho_b} W_{ab}(h) = 1
$$
我们称算子具有**一阶一致性**（first-order consistency），如果它能精确地重现任意线性场 $f(\mathbf{r}) = C + \mathbf{g}\cdot\mathbf{r}$。这要求在满足零阶一致性的基础上，还需满足离散的一阶[矩条件](@entry_id:136365)：
$$
\sum_b \frac{m_b}{\rho_b} (\mathbf{r}_b - \mathbf{r}_a) W_{ab}(h) = \mathbf{0}
$$
在连续积分中，核函数的对称性保证了一阶矩为零。然而，在离散的SPH求和中，由于[粒子分布](@entry_id:158657)不规则（disordered），上述求和通常不精确为零。这是标准[SPH方法](@entry_id:755216)的一个基本弱点，导致其在没有修正的情况下仅具有零阶精度。 

#### SPH近似的误差来源

[SPH方法](@entry_id:755216)的误差主要来源于三个方面：

1.  **核函数偏差 (Kernel bias)**：即使对于无限、规则的[粒子分布](@entry_id:158657)，用卷积 $f_h(\mathbf{r})$ 近似 $f(\mathbf{r})$ 本身也会引入误差。通过对 $f(\mathbf{r})$ 在 $\mathbf{r}$ 点进行[泰勒展开](@entry_id:145057)，可以证明对于光滑函数和对称核函数，该误差的主导项与 $h^2$ 成正比，即 $\mathcal{O}(h^2)$。

2.  **粒子近似误差 (Particle approximation error)**：用离散求和代替积分会引入误差。对于不规则的[粒子分布](@entry_id:158657)，这种误差会导致前述的[一致性条件](@entry_id:637057)（如零阶和一阶[矩条件](@entry_id:136365)）不被满足。这种由粒子无序性引起的误差被称为 **E0 误差**，它会导致即使在常数压[力场](@entry_id:147325)中也会产生虚假的残余力。

3.  **边界[截断误差](@entry_id:140949) (Boundary truncation error)**：当粒子靠近计算域的边界时，其[核函数](@entry_id:145324)的支撑域会被边界截断。这导致归一性条件 $\sum_b (m_b/\rho_b) W_{ab}(h) = 1$ 严重失效，因为邻居粒子不完整。这会引起密度、压力等物理量的严重低估。一个直接的修正方法是在计算时对结果进行归一化，即用插值结果除以截断后的[核函数](@entry_id:145324)质量 $\sum_b (m_b/\rho_b) W_{ab}(h)$。

### [流体动力学](@entry_id:136788)方程的SPH离散化

将[SPH方法](@entry_id:755216)应用于[流体动力学](@entry_id:136788)，需要构建控制方程（如[Navier-Stokes方程](@entry_id:161487)）中各项（如压力梯度、[粘性力](@entry_id:263294)）的离散算子。

#### [动量方程](@entry_id:197225)与守恒律

对于[无粘流](@entry_id:273124)体，其动量方程为 $\frac{d\mathbf{v}}{dt} = -\frac{1}{\rho}\nabla p$。为了构建一个既精确又守恒的SPH离散形式，一个优雅且物理上自洽的方法是从离散[拉格朗日量](@entry_id:174593)（discrete Lagrangian）出发。对于一个正压、[无粘流](@entry_id:273124)体，其拉格朗日量可以写为：
$$
L = \sum_a m_a \left( \frac{1}{2} |\mathbf{v}_a|^2 - u(\rho_a) \right)
$$
其中 $u(\rho_a)$ 是与粒子密度相关的单位质量内能。通过应用欧拉-拉格朗日方程 $\frac{d}{dt}(\frac{\partial L}{\partial \mathbf{v}_a}) = \frac{\partial L}{\partial \mathbf{r}_a}$，并利用[热力学](@entry_id:141121)关系 $p = \rho^2 \frac{du}{d\rho}$，可以推导出压力梯度的对称离散形式：
$$
\frac{d\mathbf{v}_a}{dt} = -\sum_b m_b \left( \frac{p_a}{\rho_a^2} + \frac{p_b}{\rho_b^2} \right) \nabla_a W_{ab}(h)
$$
这个公式是SPH中最常用的[动量方程](@entry_id:197225)形式。其对称结构确保了粒子对 $(a, b)$ 之间的作用力 $\mathbf{f}_{ab}$ 与 $(b, a)$ 之间的作用力 $\mathbf{f}_{ba}$ 满足牛顿第三定律，即 $\mathbf{f}_{ab} = -\mathbf{f}_{ba}$。这是因为括号内的压力项在交换粒子索引 $a, b$ 时保持不变，而[核函数](@entry_id:145324)梯度项由于 $W_{ab}$ 依赖于相对位置 $\mathbf{r}_a - \mathbf{r}_b$ 而具有反对称性，即 $\nabla_a W_{ab} = -\nabla_b W_{ba}$。这种成对的**反对称力**（anti-symmetric force）确保了整个[粒子系统](@entry_id:180557)的**总线动量守恒**。

此外，如果[核函数](@entry_id:145324)是[径向对称](@entry_id:141658)的，那么梯度 $\nabla_a W_{ab}$ 的方向总是沿着粒子连线 $\mathbf{r}_a - \mathbf{r}_b$。这意味着粒子间的作用力是**[中心力](@entry_id:267832)**（central force）。[中心力](@entry_id:267832)对粒子对产生的总力矩 $(\mathbf{r}_a - \mathbf{r}_b) \times \mathbf{f}_{ab}$ 恒为零，从而保证了**总[角动量守恒](@entry_id:156798)**。

值得注意的是，这种守恒的对称形式在一致性方面存在缺陷。对于一个常数压[力场](@entry_id:147325) $p_a=p_b=p_0$，上述[动量方程](@entry_id:197225)给出的加速度不为零，这正是前文提到的 E0 误差。存在其他[梯度算子](@entry_id:275922)形式，例如基于差分的[梯度算子](@entry_id:275922) $\langle \nabla f \rangle_a = \sum_b (f_b - f_a) \frac{m_b}{\rho_b} \nabla_a W_{ab}$，它天生满足零阶一致性（对常数场梯度为零），但用它构造的力不满足[反对称性](@entry_id:261893)，因此不守恒动量。这是SPH中**一致性与守恒性之间的经典权衡**。

#### [连续性方程](@entry_id:195013)

通过对密度求和公式 $\rho_a = \sum_b m_b W_{ab}(h)$ 直接求时间导数，并利用 $\frac{d\mathbf{r}_a}{dt} = \mathbf{v}_a$，可以得到[连续性方程](@entry_id:195013)的SPH形式：
$$
\frac{d\rho_a}{dt} = \sum_b m_b (\mathbf{v}_a - \mathbf{v}_b) \cdot \nabla_a W_{ab}(h)
$$
这个方程直观地表示了粒子 $a$ 的密度变化率是其与邻近粒子[相对运动](@entry_id:169798)通量的总和。

### [不可压缩流](@entry_id:140301)的模拟策略

模拟不可压缩流（$\nabla \cdot \mathbf{v} = 0$）对SPH提出了特殊的挑战，因为压力在这种情况下是作为一个[拉格朗日乘子](@entry_id:142696)来维持[速度场](@entry_id:271461)的无散性，而不是密度的直接函数。主要有两种应对策略：弱可压缩SPH和不可压缩SPH。

#### 弱可压缩SPH (WCSPH)

WCSPH的核心思想是并不严格执行不可压缩条件，而是允许流体有微小的可压缩性，即密度可以在其参考值 $\rho_0$ 附近有小幅波动（通常要求 $\Delta\rho/\rho_0 \lesssim 1\%$）。压力则通过一个人为设定的**[状态方程](@entry_id:274378)**（Equation of State, EoS）与密度直接关联。一个常用的状态方程是[Tait方程](@entry_id:271177)：
$$
p = B \left[ \left( \frac{\rho}{\rho_0} \right)^\gamma - 1 \right]
$$
其中 $B$ 是一个刚度系数，$\gamma$ 通常取7（对于水）。为了将密度波动限制在小范围内，需要选择一个足够大的数值声速 $c_s$。通过线性化[Tait方程](@entry_id:271177)可以发现，压力波动 $\Delta p \sim c_s^2 \Delta\rho$。在流体中，典型的压力波动尺度为动压 $\rho_0 U^2$（$U$为特征流速）。因此，为满足密度波动限制 $\Delta\rho/\rho_0 \le \varepsilon$，必须选取声速 $c_s \ge U / \sqrt{\varepsilon}$。

WCSPH的优点在于其**算法简单**，所有计算都是显式的、局部的，易于实现和[并行化](@entry_id:753104)。然而，其主要缺点是**计算刚性**（stiffness）。为了[数值稳定性](@entry_id:146550)，时间步长 $\Delta t$ 必须满足[声学](@entry_id:265335)[CFL条件](@entry_id:178032)，即 $\Delta t \lesssim h/c_s$。由于 $c_s$ 必须远大于流体速度 $U$，这导致 $\Delta t$ 非常小，使得模拟长时间过程的计算成本极高。此外，由于压力直接依赖于有噪声的密度场，WCSPH的压[力场](@entry_id:147325)通常充满非物理的[振荡](@entry_id:267781)。 

#### 不可压缩SPH (ISPH)

与WCSPH不同，ISPH旨在更严格地执行不可压缩条件 $\nabla \cdot \mathbf{v} = 0$。这通常通过一个**[投影法](@entry_id:144836)**（projection method）实现。每个时间步分为两个阶段：

1.  **预测步**：首先计算一个中间速度 $\mathbf{v}^*$，它包含了除压力梯度之外所有力的作用。这个[速度场](@entry_id:271461)通常不满足[无散条件](@entry_id:755034)。
2.  **校正步**：通过求解一个**[压力泊松方程](@entry_id:137996)**（Pressure Poisson Equation, PPE）来计算压[力场](@entry_id:147325) $p^{n+1}$，该压[力场](@entry_id:147325)的作用是将中间速度投影到无散空间上，得到最终的速度 $\mathbf{v}^{n+1}$。PPE的形式为 $\nabla^2 p^{n+1} = \frac{\rho_0}{\Delta t} \nabla \cdot \mathbf{v}^*$。

ISPH的主要优点是能够得到平滑、精确的压[力场](@entry_id:147325)，并允许使用比WCSPH大得多的时间步长（由[对流](@entry_id:141806)或粘性CFL条件决定）。其缺点在于**复杂性和计算成本**。求解[大型稀疏线性系统](@entry_id:137968)（离散化的PPE）比WCSPH的局部代数运算要复杂和耗时得多。此外，在无网格的[粒子方法](@entry_id:137936)中正确施加压力的边界条件（如Neumann或[Dirichlet条件](@entry_id:137096)）是一个众所周知的难题。

### 数值稳定性与[正则化技术](@entry_id:261393)

标准的[SPH方法](@entry_id:755216)存在一些[数值不稳定性](@entry_id:137058)，需要通过引入正则化项来抑制。

#### 激波处理：[人工粘性](@entry_id:142854)

在模拟包含激波的[可压缩流](@entry_id:747589)时，物理粘性的缺失会导致粒子在激波面附近发生非物理的穿透和[振荡](@entry_id:267781)。为了解决这个问题，Monaghan引入了**人工粘性**（artificial viscosity）项 $\Pi_{ab}$，它被添加到[动量方程](@entry_id:197225)的压力项中，充当一个只在压缩区域起作用的附加压力。其[标准形式](@entry_id:153058)为：
$$
\Pi_{ab} =
\begin{cases}
\dfrac{-\alpha\,\bar{c}_{ab}\,\mu_{ab} + \beta\,\mu_{ab}^2}{\bar{\rho}_{ab}},  \text{if } \mathbf{v}_{ab}\cdot \mathbf{r}_{ab}  0 \\
0,  \text{otherwise}
\end{cases}
$$
这里，$\mathbf{v}_{ab} = \mathbf{v}_a - \mathbf{v}_b$ 和 $\mathbf{r}_{ab} = \mathbf{r}_a - \mathbf{r}_b$。该项仅在粒子相互靠近（$\mathbf{v}_{ab}\cdot \mathbf{r}_{ab}  0$）时激活。它包含两个部分：
*   **线性项**（与参数 $\alpha$ 相关）：提供类似于物理体积粘性的耗散，用于抑制激波后的[振荡](@entry_id:267781)。
*   **二次项**（与参数 $\beta$ 相关）：在强压缩时占主导，提供足够的斥力以防止粒子穿透。

$\mu_{ab} = \frac{h\,\mathbf{v}_{ab}\cdot \mathbf{r}_{ab}}{\|\mathbf{r}_{ab}\|^2 + \eta^2}$ 是一个压缩度量，其中的 $\eta^2$ 是一个小的参数，用于防止分母在粒子距离过近时为零。人工粘性的作用是将激波面展宽到几个平滑长度的范围内，并将定向的动能转化为内能，从而在数值上模拟了[激波中的熵增](@entry_id:261419)过程。

#### 张力不稳定性

当流体处于张力状态（$p  0$）时，标准[SPH方法](@entry_id:755216)会表现出一种称为**张力不稳定性**（tensile instability）的病症，导致粒子不正常地聚集和成团。其根源在于前述的E0误差：在负压下，由不规则[粒子分布](@entry_id:158657)引起的残余力表现为一种非物理的吸[引力](@entry_id:175476)。

这种不稳定性与[配对不稳定性](@entry_id:158107)（由[核函数](@entry_id:145324)[频谱](@entry_id:265125)的负值区域引起）不同。即使使用像[Wendland核](@entry_id:756700)这样能避免[配对不稳定性](@entry_id:158107)的核函数，张力不稳定性依然存在，因为所有标准核函数的导数 $W'(r)$ 都是负的，这是触发该不稳定性的一个因素。

缓解张力不稳定的方法主要有两类：
1.  **添加人工排斥力**：引入一个只在[负压](@entry_id:161198)或粒子过近时激活的“人工应力”或“人工压力”项，以抵消非物理的吸[引力](@entry_id:175476)。
2.  **修[正算子](@entry_id:263696)一致性**：采用更高级的SPH格式（如修正核函数或重现核粒子法RKPM），强制[离散梯度](@entry_id:171970)算子满足零阶一致性。这样可以从根本上消除导致不稳定性的残余力。

### 高级公式：可变平滑长度

在模拟具有大密度比的流（如气体动力学或[自由表面流](@entry_id:265322)）时，使用一个全局恒定的平滑长度 $h$ 是不合适的。高密度区域需要高分辨率（小 $h$），而低密度区域则需要大 $h$ 以维持足够的邻居粒子数。因此，现代SPH模拟通常采用随空间位置变化的平滑长度，一种常见的做法是让 $h$ 成为局部密度的函数，即 $h_a = h(\rho_a)$。

这种依赖关系 $h_a(\rho_a)$ 在推导SPH方程时引入了额外的复杂性。例如，对密度求和公式 $\rho_a = \sum_b m_b W_{ab}(h_a)$ 求时间导数时，根据[链式法则](@entry_id:190743)，必须考虑 $h_a$ 通过 $\rho_a$ 依赖于时间。这导致连续性方程中出现了一个修正因子 $\Omega_a$：
$$
\frac{d\rho_a}{dt} = \frac{1}{\Omega_a} \sum_b m_b (\mathbf{v}_a - \mathbf{v}_b) \cdot \nabla_a W_{ab}(h_a)
$$
其中，$\Omega_a = 1 - \frac{\partial h_a}{\partial \rho_a} \sum_b m_b \frac{\partial W_{ab}(h_a)}{\partial h_a}$。这些额外的项被称为 **"grad-h" 项**。为了保持系统的能量和动量守恒，[动量方程](@entry_id:197225)也必须包含相应的修正。忽略这些 "grad-h" 项会导致严重的守恒性错误。当 $h$ 为常数时，$\partial h/\partial \rho = 0$，$\Omega_a=1$，所有修正项消失，方程退化为标准形式。