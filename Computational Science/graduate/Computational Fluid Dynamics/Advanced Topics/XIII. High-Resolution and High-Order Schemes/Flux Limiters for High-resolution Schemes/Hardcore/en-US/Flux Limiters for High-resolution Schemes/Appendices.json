{
    "hands_on_practices": [
        {
            "introduction": "An effective high-resolution scheme is not a monolithic entity; it is an intelligent system that should adapt to the local flow physics. Different phenomena, such as compressive shocks and expansive rarefactions, have distinct numerical requirements. This exercise challenges you to think like a scheme designer, weighing the trade-offs between numerical dissipation and accuracy to construct a robust strategy for the inviscid Burgers’ equation, a foundational model for shock dynamics . You will explore how to switch between different flux limiters to treat compressive regions more aggressively, a common technique for enhancing the stability and sharpness of shock-capturing schemes.",
            "id": "3320308",
            "problem": "Consider the scalar conservation law for inviscid Burgers’ equation, $u_t + (u^2/2)_x = 0$, posed on a uniform one-dimensional mesh with cell averages $u_i(t)$ and mesh spacing $\\Delta x$. A high-resolution finite-volume scheme advances $u_i(t)$ using a monotone numerical flux paired with Monotonic Upstream-Centered Schemes for Conservation Laws (MUSCL) reconstruction. In MUSCL, left/right interface states are built from limited slopes $\\sigma_i$ determined by a flux limiter function $\\phi(r)$ acting on the ratio $r_i$ of successive discrete gradients. The characteristic speed of Burgers’ equation is $a(u) = f'(u) = u$, and compressive or expansive behavior is governed by the sign of $u_x$: compressive when $u_x  0$ (characteristics converge and shocks can form) and expansive when $u_x  0$ (characteristics diverge and rarefactions occur). The Total Variation Diminishing (TVD) property is sought to prevent spurious oscillations, and entropy satisfaction is required so that only physically admissible shocks appear, consistent with the Lax entropy condition for scalar conservation laws.\n\nA practitioner proposes to “treat compressive regions more aggressively than expansive regions” by switching between two TVD limiters depending on the local flow classification, while using a consistent Riemann solver for the interfacial fluxes. Here, “more aggressive” means stronger slope limiting (more dissipation) in compressive regions to suppress nonphysical oscillations near incipient shocks, and less dissipation in expansive regions to better resolve smooth rarefactions. The time integration is assumed Strong Stability Preserving (SSP) so that semi-discrete TVD properties carry to the fully discrete scheme under a Courant–Friedrichs–Lewy (CFL) restriction.\n\nWhich strategy below correctly implements such a limiter switching rule using a consistent flux, and, under a standard CFL bound on $u$ (e.g., $\\lambda = \\Delta t/\\Delta x \\, \\max_i |u_i| \\le 1$), is most justified to be TVD and to satisfy the entropy condition for Burgers’ equation?\n\nA. Use the Godunov flux with MUSCL reconstruction and choose the minmod limiter in compressive regions and the monotonized central (MC) limiter in expansive regions, where compression/expansion is detected by the sign of the discrete gradient $u_{i+1} - u_i$; i.e., if $u_{i+1} - u_i  0$ set $\\phi = \\phi_{\\mathrm{mm}}$, and if $u_{i+1} - u_i  0$ set $\\phi = \\phi_{\\mathrm{MC}}$.\n\nB. Use the Roe linearized flux without entropy fix and choose the superbee limiter in compressive regions and the minmod limiter in expansive regions, with compression/expansion detected by $u_{i+1} - u_i$.\n\nC. Use the Godunov flux and choose the MC limiter when $u_i  0$ and the minmod limiter when $u_i  0$, interpreting compression/expansion by the sign of the local characteristic speed $u_i$.\n\nD. Use the Lax–Friedrichs (Rusanov) flux and choose the minmod limiter in compressive regions while turning off limiting (i.e., $\\phi \\equiv 1$) in expansive regions, with compression/expansion detected by $u_{i+1} - u_i$.\n\nSelect the most correct option among A–D with respect to both the stated “aggressive in compression” design goal and the justification of TVD and entropy satisfaction for Burgers’ equation under a suitable CFL condition.",
            "solution": "To identify the best strategy, we must evaluate each option based on three essential criteria for a high-resolution shock-capturing scheme for Burgers' equation:\n1.  **Correct Implementation of the Design Goal**: The scheme must use a more dissipative limiter in compressive regions (where shocks form, identified by $u_{i+1} - u_i  0$) and a less dissipative one in expansive regions (rarefactions, $u_{i+1} - u_i  0$).\n2.  **Total Variation Diminishing (TVD) Property**: The scheme must be constructed from components that guarantee a non-oscillatory solution. This requires a monotone numerical flux and TVD-compliant limiters.\n3.  **Entropy Satisfaction**: The numerical flux must ensure that only physically correct shocks are produced, preventing non-physical expansion shocks.\n\nFirst, we rank the limiters by their dissipativeness. A more dissipative limiter restricts slopes more severely, leading to more robust but less sharp results. The order from most to least dissipative is:\n$$\n\\text{minmod} > \\text{monotonized central (MC)} > \\text{superbee}\n$$\nSecond, we review the numerical fluxes for entropy satisfaction:\n-   **Godunov Flux**: Being an exact Riemann solver for scalar problems, it is guaranteed to satisfy the entropy condition.\n-   **Lax–Friedrichs (Rusanov) Flux**: This is a monotone flux and satisfies the entropy condition.\n-   **Roe Flux**: Without an \"entropy fix,\" it is known to fail the entropy condition for transonic rarefactions.\n\nNow we analyze each option:\n\n**A.** This option uses the **minmod** limiter (more dissipative) for compression ($u_{i+1} - u_i  0$) and the **MC** limiter (less dissipative) for expansion. This correctly implements the \"more aggressive in compression\" design goal. It uses the entropy-satisfying Godunov flux and two well-known TVD limiters. This strategy is sound and justified to be both TVD and entropy-satisfying.\n\n**B.** This option uses the **superbee** limiter (less dissipative) for compression and the **minmod** limiter (more dissipative) for expansion. This is the *opposite* of the design goal. Furthermore, it uses the Roe flux *without* an entropy fix, which violates the entropy condition.\n\n**C.** This option bases the limiter switch on the sign of the local velocity $u_i$, not the velocity gradient $u_{i+1} - u_i$. The sign of $u_i$ indicates the direction of wave propagation, not whether the wave is compressive or expansive. For instance, a right-moving shock has $u > 0$ but is compressive ($u_x  0$). This strategy fails to correctly identify the flow regions as intended.\n\n**D.** This option correctly identifies the flow regions. However, in expansive regions, it proposes to turn off limiting ($\\phi \\equiv 1$). A reconstruction with an unlimited slope is not TVD and will produce spurious oscillations. This violates a core requirement of the scheme.\n\nBased on this analysis, Option A is the only one that correctly implements the design goal while using components (Godunov flux and valid TVD limiters) that ensure both the TVD property and entropy satisfaction.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "When simulating systems of conservation laws, such as the compressible Euler equations, ensuring the physical realizability of the solution is paramount. A numerical scheme that produces negative density or pressure is not just inaccurate; it is fundamentally broken and will often lead to catastrophic simulation failure. This practice provides a hands-on calculation for implementing a positivity-preserving limiter, a crucial \"failsafe\" in modern CFD codes . By blending a high-order, potentially non-physical flux with a robust low-order, positivity-guaranteed flux, you will derive the precise condition needed to maintain positive density and pressure, gaining insight into the design of robust schemes for complex flows.",
            "id": "3320306",
            "problem": "Consider the one-dimensional compressible Euler equations in conservative variables $U = (\\rho, m, E)^{\\top}$, where $\\rho$ is the density, $m = \\rho u$ is the momentum with velocity $u$, and $E$ is the total energy. The pressure $p$ is given by the ideal gas relation $p = (\\gamma - 1)\\left(E - \\frac{m^{2}}{2 \\rho}\\right)$ for ratio of specific heats $\\gamma  1$. A uniform finite-volume discretization on a grid with spacing $\\Delta x$ is advanced in time with time step $\\Delta t$ by a flux update of the form\n$$\nU_{i}^{n+1} \\;=\\; U_{i}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\nwhere $F_{i\\pm\\frac{1}{2}}$ are numerical fluxes at the cell interfaces. To construct a positivity-preserving high-resolution update for density and pressure, consider a convex flux limiter that blends a high-order flux with a low-order flux as\n$$\nF_{i\\pm\\frac{1}{2}}(\\theta) \\;=\\; \\theta\\,F_{i\\pm\\frac{1}{2}}^{\\mathrm{HO}} \\;+\\; (1-\\theta)\\,F_{i\\pm\\frac{1}{2}}^{\\mathrm{LO}},\n$$\nwith a coefficient $\\theta \\in [0,1]$. Let the net flux differences be denoted by\n$$\n\\Delta F^{\\mathrm{HO}} \\;=\\; F_{i+\\frac{1}{2}}^{\\mathrm{HO}} - F_{i-\\frac{1}{2}}^{\\mathrm{HO}}, \\qquad\n\\Delta F^{\\mathrm{LO}} \\;=\\; F_{i+\\frac{1}{2}}^{\\mathrm{LO}} - F_{i-\\frac{1}{2}}^{\\mathrm{LO}},\n$$\nso that the update in cell $i$ can be written as\n$$\nU_{i}^{n+1}(\\theta) \\;=\\; U_{i}^{n} \\;-\\; \\lambda\\left(\\theta\\,\\Delta F^{\\mathrm{HO}} + (1-\\theta)\\,\\Delta F^{\\mathrm{LO}}\\right),\n\\qquad \\lambda \\;=\\; \\frac{\\Delta t}{\\Delta x}.\n$$\nAssume $\\gamma = 1.4$, $\\lambda = 0.1$, and the initial state\n$$\nU_{i}^{n} \\;=\\; \\begin{pmatrix} \\rho_{i}^{n} \\\\ m_{i}^{n} \\\\ E_{i}^{n} \\end{pmatrix}\n\\;=\\; \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 4.5 \\end{pmatrix}.\n$$\nSuppose the high-order net flux difference and the low-order net flux difference are\n$$\n\\Delta F^{\\mathrm{HO}} \\;=\\; \\begin{pmatrix} 0.8 \\\\ -3.0 \\\\ 18.0 \\end{pmatrix},\n\\qquad\n\\Delta F^{\\mathrm{LO}} \\;=\\; \\begin{pmatrix} 0.1 \\\\ 0.0 \\\\ 0.5 \\end{pmatrix},\n$$\nand further suppose that the low-order flux is positivity-guaranteeing in the sense that the update with $\\theta = 0$ yields nonnegative density and pressure. Derive, from the governing update and the definition of pressure, the algebraic conditions on $\\theta$ required to guarantee $\\rho_{i}^{n+1}(\\theta) \\ge 0$ and $p_{i}^{n+1}(\\theta) \\ge 0$. Then, compute the largest admissible $\\theta$ in $[0,1]$ that satisfies both conditions for the given data. Express your final answer as a single real number rounded to four significant figures. The answer is dimensionless, so no units are required.",
            "solution": "The problem requires finding the largest blending coefficient $\\theta \\in [0,1]$ that ensures the updated density $\\rho_{i}^{n+1}$ and pressure $p_{i}^{n+1}$ are non-negative.\n\nThe update for the vector of conservative variables $U_{i}^{n+1} = (\\rho_{i}^{n+1}, m_{i}^{n+1}, E_{i}^{n+1})^{\\top}$ is given by:\n$$\nU_{i}^{n+1}(\\theta) = U_{i}^{n} - \\lambda\\left(\\theta\\,\\Delta F^{\\mathrm{HO}} + (1-\\theta)\\,\\Delta F^{\\mathrm{LO}}\\right)\n$$\nwhere $\\lambda = \\frac{\\Delta t}{\\Delta x}$. We can rewrite this equation by separating the low-order part:\n$$\nU_{i}^{n+1}(\\theta) = U_{i}^{n} - \\lambda\\Delta F^{\\mathrm{LO}} - \\theta\\lambda(\\Delta F^{\\mathrm{HO}} - \\Delta F^{\\mathrm{LO}})\n$$\nLet $U_{i}^{\\mathrm{LO}} = U_{i}^{n} - \\lambda\\Delta F^{\\mathrm{LO}}$ be the state updated using only the low-order flux. The problem states that this update is positivity-preserving, meaning $\\rho_{i}^{\\mathrm{LO}} \\ge 0$ and $p_{i}^{\\mathrm{LO}} \\ge 0$. Let $P = \\lambda(\\Delta F^{\\mathrm{HO}} - \\Delta F^{\\mathrm{LO}})$. The update can then be written compactly as:\n$$\nU_{i}^{n+1}(\\theta) = U_{i}^{\\mathrm{LO}} - \\theta P\n$$\nWriting this in component form:\n$$\n\\rho_{i}^{n+1}(\\theta) = \\rho_{i}^{\\mathrm{LO}} - \\theta P_{\\rho} \\\\\nm_{i}^{n+1}(\\theta) = m_{i}^{\\mathrm{LO}} - \\theta P_{m} \\\\\nE_{i}^{n+1}(\\theta) = E_{i}^{\\mathrm{LO}} - \\theta P_{E}\n$$\nwhere $P = (P_\\rho, P_m, P_E)^\\top$.\n\nFirst, we derive the algebraic condition for the positivity of density, $\\rho_{i}^{n+1}(\\theta) \\ge 0$:\n$$\n\\rho_{i}^{\\mathrm{LO}} - \\theta P_{\\rho} \\ge 0\n$$\nThis is a linear inequality in $\\theta$.\n\nSecond, we derive the condition for the positivity of pressure, $p_{i}^{n+1}(\\theta) \\ge 0$. The pressure is given by $p = (\\gamma - 1)(E - \\frac{m^2}{2\\rho})$. Since $\\gamma > 1$, the condition $p \\ge 0$ is equivalent to its argument being non-negative:\n$$\nE_{i}^{n+1}(\\theta) - \\frac{(m_{i}^{n+1}(\\theta))^2}{2\\rho_{i}^{n+1}(\\theta)} \\ge 0\n$$\nTo avoid division by $\\rho_{i}^{n+1}(\\theta)$ (which could be zero), we multiply by $2\\rho_{i}^{n+1}(\\theta)$. Assuming $\\rho_{i}^{n+1}(\\theta) > 0$, this yields:\n$$\n2E_{i}^{n+1}(\\theta)\\rho_{i}^{n+1}(\\theta) - (m_{i}^{n+1}(\\theta))^2 \\ge 0\n$$\nSubstituting the expressions in terms of $\\theta$:\n$$\n2(E_{i}^{\\mathrm{LO}} - \\theta P_{E})(\\rho_{i}^{\\mathrm{LO}} - \\theta P_{\\rho}) - (m_{i}^{\\mathrm{LO}} - \\theta P_{m})^2 \\ge 0\n$$\nThis is a quadratic inequality in $\\theta$ of the form $A\\theta^2 + B\\theta + C \\ge 0$. Expanding the expression gives the coefficients:\n$$\nA = 2P_{E}P_{\\rho} - P_{m}^{2}\n$$\n$$\nB = -2(E_{i}^{\\mathrm{LO}}P_{\\rho} + \\rho_{i}^{\\mathrm{LO}}P_{E}) + 2m_{i}^{\\mathrm{LO}}P_{m}\n$$\n$$\nC = 2E_{i}^{\\mathrm{LO}}\\rho_{i}^{\\mathrm{LO}} - (m_{i}^{\\mathrm{LO}})^2\n$$\nNote that $C \\ge 0$ because the low-order update is positivity-preserving.\n\nNow, we substitute the given numerical values:\n$\\gamma = 1.4$, $\\lambda = 0.1$.\n$U_{i}^{n} = (1.0, 2.0, 4.5)^{\\top}$.\n$\\Delta F^{\\mathrm{HO}} = (0.8, -3.0, 18.0)^{\\top}$.\n$\\Delta F^{\\mathrm{LO}} = (0.1, 0.0, 0.5)^{\\top}$.\n\nFirst, compute the low-order state $U_{i}^{\\mathrm{LO}}$:\n$$\nU_{i}^{\\mathrm{LO}} = U_{i}^{n} - \\lambda \\Delta F^{\\mathrm{LO}} = \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 4.5 \\end{pmatrix} - 0.1 \\begin{pmatrix} 0.1 \\\\ 0.0 \\\\ 0.5 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 4.5 \\end{pmatrix} - \\begin{pmatrix} 0.01 \\\\ 0.0 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} 0.99 \\\\ 2.0 \\\\ 4.45 \\end{pmatrix}\n$$\nSo, $\\rho_{i}^{\\mathrm{LO}} = 0.99$, $m_{i}^{\\mathrm{LO}} = 2.0$, and $E_{i}^{\\mathrm{LO}} = 4.45$.\n\nNext, compute the vector $P$:\n$$\n\\Delta F^{\\mathrm{HO}} - \\Delta F^{\\mathrm{LO}} = \\begin{pmatrix} 0.8 \\\\ -3.0 \\\\ 18.0 \\end{pmatrix} - \\begin{pmatrix} 0.1 \\\\ 0.0 \\\\ 0.5 \\end{pmatrix} = \\begin{pmatrix} 0.7 \\\\ -3.0 \\\\ 17.5 \\end{pmatrix}\n$$\n$$\nP = \\lambda(\\Delta F^{\\mathrm{HO}} - \\Delta F^{\\mathrm{LO}}) = 0.1 \\begin{pmatrix} 0.7 \\\\ -3.0 \\\\ 17.5 \\end{pmatrix} = \\begin{pmatrix} 0.07 \\\\ -0.3 \\\\ 1.75 \\end{pmatrix}\n$$\nSo, $P_{\\rho} = 0.07$, $P_{m} = -0.3$, and $P_{E} = 1.75$.\n\nEvaluate the density condition:\n$$\n0.99 - \\theta(0.07) \\ge 0 \\implies 0.99 \\ge 0.07\\theta \\implies \\theta \\le \\frac{0.99}{0.07} = \\frac{99}{7} \\approx 14.14\n$$\nThis condition is satisfied for any $\\theta \\in [0,1]$.\n\nEvaluate the pressure condition by computing the coefficients of the quadratic inequality $A\\theta^2 + B\\theta + C \\ge 0$, where the coefficients are divided by 2 for simplicity:\n$$\nC = (4.45)(0.99) - \\frac{1}{2}(2.0)^2 = 4.4055 - 2.0 = 2.4055\n$$\n$$\nB = (2.0)(-0.3) - ((4.45)(0.07) + (0.99)(1.75)) = -0.6 - (0.3115 + 1.7325) = -0.6 - 2.044 = -2.644\n$$\n$$\nA = (1.75)(0.07) - \\frac{1}{2}(-0.3)^2 = 0.1225 - \\frac{1}{2}(0.09) = 0.1225 - 0.045 = 0.0775\n$$\nThe quadratic inequality for pressure positivity is:\n$$\n0.0775 \\theta^2 - 2.644 \\theta + 2.4055 \\ge 0\n$$\nTo find the regions where this holds, we find the roots of the quadratic equation $0.0775 \\theta^2 - 2.644 \\theta + 2.4055 = 0$ using the quadratic formula $\\theta = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$:\n$$\nB^2 - 4AC = (-2.644)^2 - 4(0.0775)(2.4055) = 6.990736 - 0.745705 = 6.245031\n$$\n$$\n\\sqrt{B^2 - 4AC} \\approx 2.499006\n$$\nThe roots are:\n$$\n\\theta_{1,2} = \\frac{2.644 \\pm 2.499006}{2(0.0775)} = \\frac{2.644 \\pm 2.499006}{0.155}\n$$\n$$\n\\theta_1 = \\frac{2.644 - 2.499006}{0.155} = \\frac{0.144994}{0.155} \\approx 0.935445\n$$\n$$\n\\theta_2 = \\frac{2.644 + 2.499006}{0.155} = \\frac{5.143006}{0.155} \\approx 33.18068\n$$\nSince the coefficient $A=0.0775$ is positive, the parabola opens upwards. The inequality $A\\theta^2 + B\\theta + C \\ge 0$ is satisfied for $\\theta \\le \\theta_1$ or $\\theta \\ge \\theta_2$. Thus, we must have:\n$$\n\\theta \\le 0.935445 \\quad \\text{or} \\quad \\theta \\ge 33.18068\n$$\nWe need to find the largest $\\theta$ that satisfies all conditions simultaneously:\n1. $\\theta \\in [0,1]$ (by definition of the limiter)\n2. $\\theta \\le 14.14$ (from density positivity)\n3. $\\theta \\le 0.935445$ or $\\theta \\ge 33.18068$ (from pressure positivity)\n\nThe intersection of these conditions is $0 \\le \\theta \\le 0.935445$.\nThe largest admissible value for $\\theta$ is the upper bound of this interval, $\\theta_{max} \\approx 0.935445$.\nRounding to four significant figures, the result is $0.9354$.",
            "answer": "$$\\boxed{0.9354}$$"
        },
        {
            "introduction": "The transition from one to multiple dimensions is a notorious stumbling block in numerical methods, where seemingly robust 1D concepts can fail spectacularly. This is particularly true for flux limiters, where a naive, coordinate-by-coordinate application of a 1D limiter can introduce significant errors and oscillations, especially when the flow is oblique to an anisotropic grid. This coding exercise directly confronts this challenge by having you implement and compare a simple coordinate-wise limiter against a genuinely multi-dimensional limiter that senses the true direction of wave propagation . By quantifying the performance of both approaches in a carefully designed test case, you will gain a practical understanding of why directional-awareness is critical for accurate multi-dimensional shock capturing.",
            "id": "3320354",
            "problem": "Consider the two-dimensional linear advection of a scalar field $q(x,y,t)$ governed by the conservation law\n$$\n\\partial_t q + a\\,\\partial_x q + b\\,\\partial_y q = 0,\n$$\nwhere $(a,b)$ is a constant velocity vector. A second-order accurate finite-volume update on a uniform Cartesian mesh with rectangular cells of sizes $\\,\\Delta x\\,$ and $\\,\\Delta y\\,$ can be written as\n$$\nq_{i,j}^{n+1} = q_{i,j}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2},j} - F_{i-\\frac{1}{2},j}\\right) - \\frac{\\Delta t}{\\Delta y}\\left(G_{i,j+\\frac{1}{2}} - G_{i,j-\\frac{1}{2}}\\right),\n$$\nwith periodic boundaries, where $F_{i+\\frac{1}{2},j}$ and $G_{i,j+\\frac{1}{2}}$ are numerical fluxes across cell faces. For linear advection, an upwind Riemann solver uses $F_{i+\\frac{1}{2},j} = a\\,q_{i+\\frac{1}{2},j}^{\\mathrm{up}}$ and $G_{i,j+\\frac{1}{2}} = b\\,q_{i,j+\\frac{1}{2}}^{\\mathrm{up}}$, where $q^{\\mathrm{up}}$ is the reconstructed scalar at the face taken from the upwind side.\n\nThe reconstruction uses a linear profile within each cell based on a limited gradient. In many multi-dimensional implementations, limiting is applied separately to the $\\partial_x q$ and $\\partial_y q$ components by using a one-dimensional Total Variation Diminishing (TVD) limiter along each coordinate. This coordinate-wise limiting can fail to prevent non-physical behavior when the true gradient and characteristics are oblique to the grid axes, especially on grids with aspect ratio $\\Delta x/\\Delta y \\neq 1$. A genuinely multi-dimensional limiter should sense the direction of information propagation and limit the gradient component along that direction, not independently along $x$ and $y$.\n\nTask: Starting from the conservation law and the finite-volume discretization above, implement two reconstruction strategies:\n- Coordinate-wise limiting: compute separate limited slopes for $\\partial_x q$ and $\\partial_y q$ using a one-dimensional TVD limiter applied to forward and backward differences along each axis.\n- Directional multi-dimensional limiting: compute the limited slope along the unit vector in the advection direction $\\boldsymbol{n} = (a,b)/\\sqrt{a^2+b^2}$ using the same TVD limiter, then reconstruct the gradient vector by projecting this limited directional slope back onto $\\boldsymbol{n}$.\n\nUse a single explicit time step of size $\\Delta t$ chosen to satisfy a standard stability constraint. Initialize $q$ as an oblique planar step function on the periodic unit square domain $[0,1]\\times[0,1]$,\n$$\nq(x,y,0) = \\begin{cases}\n1,  \\text{if } x\\cos\\alpha + y\\sin\\alpha  s,\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nwhere $\\alpha$ is the step normal angle and $s$ is a threshold. The exact solution after one time step is $q_{\\mathrm{exact}}(x,y,\\Delta t) = q(x - a\\Delta t, y - b\\Delta t, 0)$ under periodic wrapping.\n\nYou must:\n- Derive the limited reconstructions from the base discretization and define the limiter you choose to use.\n- Implement both schemes and advance one time step.\n- Quantify failure and improvement using two metrics per test case:\n    1. Overshoot difference: the non-physical boundedness violation magnitude for the coordinate-wise limiter minus that for the directional limiter, defined as\n       $$\n       \\Delta_{\\mathrm{over}} = \\left[\\max\\left(\\max(q_{\\mathrm{axis}} - 1), \\max(0 - q_{\\mathrm{axis}}), 0\\right)\\right] - \\left[\\max\\left(\\max(q_{\\mathrm{dir}} - 1), \\max(0 - q_{\\mathrm{dir}}), 0\\right)\\right].\n       $$\n    2. Error ratio: the ratio of discrete $L^1$ errors,\n       $$\n       R_{L^1} = \\frac{\\frac{1}{N_x N_y}\\sum_{i,j}\\left|q_{i,j}^{\\mathrm{axis}} - q_{i,j}^{\\mathrm{exact}}\\right|}{\\frac{1}{N_x N_y}\\sum_{i,j}\\left|q_{i,j}^{\\mathrm{dir}} - q_{i,j}^{\\mathrm{exact}}\\right|}.\n       $$\n\nAngle quantities must be expressed in radians. There are no physical units beyond the non-dimensional variables above. Use periodic boundary conditions in both directions. Choose $\\Delta t$ according to\n$$\n\\Delta t = \\mathrm{CFL}\\cdot \\min\\left( \\frac{\\Delta x}{|a|}, \\frac{\\Delta y}{|b|} \\right),\n$$\nwith the convention that if $a=0$ or $b=0$, the corresponding fraction is treated as $+\\infty$ in the minimum.\n\nTest Suite:\n- Case $1$ (happy path, near-isotropic mesh): $N_x=128$, $N_y=128$, $\\beta= \\pi/4$, $\\alpha=\\pi/4$, $s=0.5$, $\\mathrm{CFL}=0.4$, with $(a,b)=(\\cos\\beta,\\sin\\beta)$.\n- Case $2$ (extreme aspect ratio, oblique advection): $N_x=200$, $N_y=20$, $\\beta= \\pi/3$, $\\alpha=\\pi/3$, $s=0.5$, $\\mathrm{CFL}=0.95$, with $(a,b)=(\\cos\\beta,\\sin\\beta)$.\n- Case $3$ (extreme aspect ratio in the opposite sense): $N_x=40$, $N_y=400$, $\\beta= \\pi/6$, $\\alpha=\\pi/6$, $s=0.5$, $\\mathrm{CFL}=0.95$, with $(a,b)=(\\cos\\beta,\\sin\\beta)$.\n- Case $4$ (boundary case, purely one-dimensional advection): $N_x=128$, $N_y=32$, $\\beta= 0$, $\\alpha=\\pi/4$, $s=0.5$, $\\mathrm{CFL}=0.8$, with $(a,b)=(\\cos\\beta,\\sin\\beta)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a two-element list $[\\Delta_{\\mathrm{over}}, R_{L^1}]$. For example, the output format must be\n$$\n\\text{[}[d_1,r_1],[d_2,r_2],[d_3,r_3],[d_4,r_4]\\text{]},\n$$\nwith each $d_k$ and $r_k$ printed as floating-point numbers.",
            "solution": "The problem requires the implementation and comparison of two finite-volume schemes for the two-dimensional linear advection equation,\n$$\n\\partial_t q + \\mathbf{v} \\cdot \\nabla q = 0,\n$$\nwhere $\\mathbf{v} = (a, b)$ is a constant velocity vector and $q(x,y,t)$ is a scalar field. The comparison focuses on the gradient limiting strategy used in the second-order reconstruction step on a uniform Cartesian mesh.\n\nFirst, we establish the numerical framework. The governing partial differential equation is discretized using a finite-volume method. Integrating over a control volume (cell) $\\Omega_{i,j} = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}] \\times [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$ with area $|\\Omega_{i,j}| = \\Delta x \\Delta y$, and applying the divergence theorem, we obtain the semi-discrete conservation law for the cell-averaged quantity $q_{i,j}(t)$:\n$$\n\\frac{d q_{i,j}}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+\\frac{1}{2},j} - F_{i-\\frac{1}{2},j} \\right) + \\frac{1}{\\Delta y} \\left( G_{i,j+\\frac{1}{2}} - G_{i,j-\\frac{1}{2}} \\right) = 0.\n$$\nHere, $F$ and $G$ are the numerical fluxes in the $x$ and $y$ directions, respectively. For linear advection, the physical fluxes are $f(q) = a q$ and $g(q) = b q$. The numerical fluxes approximate the integral of the physical flux over the cell faces. For an upwind scheme, the flux at a cell face is determined by the value of $q$ in the upwind cell. For example, at the face $x = x_{i+\\frac{1}{2}}$ between cells $(i,j)$ and $(i+1,j)$, the flux is:\n$$\nF_{i+\\frac{1}{2},j} = a^+ q_{i+\\frac{1}{2},j}^L + a^- q_{i+\\frac{1}{2},j}^R,\n$$\nwhere $a^+ = \\max(a,0)$, $a^- = \\min(a,0)$, and $q^L$ and $q^R$ are the reconstructed values of $q$ at the face, viewed from the left (cell $i,j$) and right (cell $i+1,j$) respectively.\n\nTo achieve second-order spatial accuracy, we reconstruct $q$ as a linear function within each cell:\n$$\nq(x,y) = q_{i,j} + (\\partial_x q)_{i,j} (x-x_i) + (\\partial_y q)_{i,j} (y-y_j),\n$$\nwhere $(x_i, y_j)$ is the cell center and $(\\partial_x q)_{i,j}, (\\partial_y q)_{i,j}$ are estimates of the gradient in cell $(i,j)$.\nWith this reconstruction, the left and right states at the face $x_{i+\\frac{1}{2}}$ are:\n$$\nq_{i+\\frac{1}{2},j}^L = q_{i,j} + (\\partial_x q)_{i,j} \\frac{\\Delta x}{2}\n$$\n$$\nq_{i+\\frac{1}{2},j}^R = q_{i+1,j} - (\\partial_x q)_{i+1,j} \\frac{\\Delta x}{2}\n$$\nAnalogous expressions hold for the $y$-direction faces.\n\nTo prevent spurious oscillations (Gibbs phenomenon) near discontinuities, the gradient components must be limited. This ensures the reconstruction is Total Variation Diminishing (TVD). We will use the minmod limiter. For two slopes $s_1$ and $s_2$, it is defined as:\n$$\n\\mathrm{minmod}(s_1, s_2) = \\begin{cases} \\min(s_1, s_2)  \\text{if } s_1, s_2  0 \\\\ \\max(s_1, s_2)  \\text{if } s_1, s_2  0 \\\\ 0  \\text{otherwise} \\end{cases}\n$$\n\nThe two required schemes differ in how they compute the limited gradient vector $\\nabla q_{i,j} = ((\\partial_x q)_{i,j}, (\\partial_y q)_{i,j})$.\n\n**1. Coordinate-wise Limiting (`axis`)**\nThis is the most straightforward extension of one-dimensional limiting to multiple dimensions. The gradient components are limited independently along each coordinate axis.\nWe first compute forward and backward difference quotients in each direction for cell $(i,j)$:\n$$\n\\Delta_x^b q = \\frac{q_{i,j}-q_{i-1,j}}{\\Delta x}, \\quad \\Delta_x^f q = \\frac{q_{i+1,j}-q_{i,j}}{\\Delta x}\n$$\n$$\n\\Delta_y^b q = \\frac{q_{i,j}-q_{i,j-1}}{\\Delta y}, \\quad \\Delta_y^f q = \\frac{q_{i,j+1}-q_{i,j}}{\\Delta y}\n$$\nThe limited gradient components are then computed by applying the minmod limiter to these difference quotients:\n$$\n(\\partial_x q)_{i,j}^{\\mathrm{axis}} = \\mathrm{minmod}(\\Delta_x^b q, \\Delta_x^f q)\n$$\n$$\n(\\partial_y q)_{i,j}^{\\mathrm{axis}} = \\mathrm{minmod}(\\Delta_y^b q, \\Delta_y^f q)\n$$\nThis approach is simple but can be overly diffusive when the flow direction is oblique to the grid, as it fails to correlate the limiting process in the different coordinate directions.\n\n**2. Directional Multi-dimensional Limiting (`dir`)**\nThis strategy aims to limit the gradient along the direction of advection, $\\mathbf{n} = \\mathbf{v} / \\|\\mathbf{v}\\|_2 = (n_x, n_y)$. Following the problem description, we first construct two estimates for the directional derivative using the forward and backward difference quotients computed above:\n$$\nS_b = n_x \\Delta_x^b q + n_y \\Delta_y^b q\n$$\n$$\nS_f = n_x \\Delta_x^f q + n_y \\Delta_y^f q\n$$\nThese represent projections of backward- and forward-biased difference vectors onto the advection direction. We then apply the minmod limiter to these directional slopes:\n$$\n\\sigma_n = \\mathrm{minmod}(S_b, S_f)\n$$\nThis limited directional slope $\\sigma_n$ is then projected back onto the advection direction vector $\\mathbf{n}$ to form the final limited gradient vector:\n$$\n\\nabla q_{i,j}^{\\mathrm{dir}} = \\sigma_n \\mathbf{n} = (\\sigma_n n_x, \\sigma_n n_y)\n$$\nThis ensures the limited gradient is always aligned with the advection velocity, fundamentally differing from the coordinate-wise approach where the limited gradient's direction can be arbitrary.\n\n**Time Discretization and Final Algorithm**\nWe use a single forward Euler step for time integration. The full update formula is:\n$$\nq_{i,j}^{n+1} = q_{i,j}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2},j}^n - F_{i-\\frac{1}{2},j}^n\\right) - \\frac{\\Delta t}{\\Delta y}\\left(G_{i,j+\\frac{1}{2}}^n - G_{i,j-\\frac{1}{2}}^n\\right),\n$$\nwhere the fluxes are computed using the reconstructed values from one of the two limiting schemes. The time step $\\Delta t$ is chosen based on the CFL condition to ensure stability. Initial conditions are set by sampling the given step function at cell centers. The exact solution is obtained by advecting the initial condition field and applying periodic wrapping. Periodic boundary conditions are handled by using `numpy.roll` for accessing neighbor data.",
            "answer": "```python\nimport numpy as np\n\ndef minmod(s1, s2):\n    \"\"\"Vectorized minmod limiter function.\"\"\"\n    # This implementation is equivalent to the standard definition.\n    # It correctly handles arrays s1 and s2 element-wise.\n    signs = np.sign(s1) + np.sign(s2)\n    return 0.5 * signs * np.minimum(np.abs(s1), np.abs(s2))\n\ndef solve_step(q, dx, dy, dt, a, b, limiter_type):\n    \"\"\"\n    Advances the scalar field q by one time step dt.\n    \"\"\"\n    Nx, Ny = q.shape\n\n    # --- 1. Compute limited gradients ---\n    # Get neighbor values using periodic boundary conditions\n    q_im1_j = np.roll(q, 1, axis=0)\n    q_ip1_j = np.roll(q, -1, axis=0)\n    q_i_jm1 = np.roll(q, 1, axis=1)\n    q_i_jp1 = np.roll(q, -1, axis=1)\n\n    # Compute forward/backward difference quotients\n    grad_x_bwd = (q - q_im1_j) / dx\n    grad_x_fwd = (q_ip1_j - q) / dx\n    grad_y_bwd = (q - q_i_jm1) / dy\n    grad_y_fwd = (q_i_jp1 - q) / dy\n\n    if limiter_type == 'axis':\n        grad_x = minmod(grad_x_bwd, grad_x_fwd)\n        grad_y = minmod(grad_y_bwd, grad_y_fwd)\n    elif limiter_type == 'dir':\n        v_norm = np.sqrt(a**2 + b**2)\n        if v_norm == 0:\n            grad_x, grad_y = np.zeros_like(q), np.zeros_like(q)\n        else:\n            nx, ny = a / v_norm, b / v_norm\n            s_b = nx * grad_x_bwd + ny * grad_y_bwd\n            s_f = nx * grad_x_fwd + ny * grad_y_fwd\n            sigma_n = minmod(s_b, s_f)\n            grad_x = sigma_n * nx\n            grad_y = sigma_n * ny\n    else:\n        raise ValueError(\"Unknown limiter type\")\n\n    # --- 2. Reconstruct states at cell faces ---\n    # x-faces (i+1/2, j)\n    q_L_x = q + grad_x * dx / 2.0\n    q_R_x = np.roll(q, -1, axis=0) - np.roll(grad_x, -1, axis=0) * dx / 2.0\n    \n    # y-faces (i, j+1/2)\n    q_L_y = q + grad_y * dy / 2.0\n    q_R_y = np.roll(q, -1, axis=1) - np.roll(grad_y, -1, axis=1) * dy / 2.0\n\n    # --- 3. Compute upwind fluxes ---\n    # Fluxes F across x-faces\n    q_upwind_x = np.where(a  0.0, q_L_x, q_R_x)\n    F = a * q_upwind_x\n    \n    # Fluxes G across y-faces\n    q_upwind_y = np.where(b  0.0, q_L_y, q_R_y)\n    G = b * q_upwind_y\n\n    # --- 4. Compute flux divergence ---\n    div_F = (F - np.roll(F, 1, axis=0)) / dx\n    div_G = (G - np.roll(G, 1, axis=1)) / dy\n\n    # --- 5. Update cell averages ---\n    q_new = q - dt * (div_F + div_G)\n\n    return q_new\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute metrics.\n    \"\"\"\n    test_cases = [\n        # Case 1: Nx=128, Ny=128, beta=pi/4, alpha=pi/4, s=0.5, CFL=0.4\n        (128, 128, np.pi/4, np.pi/4, 0.5, 0.4),\n        # Case 2: Nx=200, Ny=20, beta=pi/3, alpha=pi/3, s=0.5, CFL=0.95\n        (200, 20, np.pi/3, np.pi/3, 0.5, 0.95),\n        # Case 3: Nx=40, Ny=400, beta=pi/6, alpha=pi/6, s=0.5, CFL=0.95\n        (40, 400, np.pi/6, np.pi/6, 0.5, 0.95),\n        # Case 4: Nx=128, Ny=32, beta=0, alpha=pi/4, s=0.5, CFL=0.8\n        (128, 32, 0.0, np.pi/4, 0.5, 0.8),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        Nx, Ny, beta, alpha, s, CFL = case\n        \n        # Grid setup\n        dx, dy = 1.0 / Nx, 1.0 / Ny\n        x_centers = (np.arange(Nx) + 0.5) * dx\n        y_centers = (np.arange(Ny) + 0.5) * dy\n        xx, yy = np.meshgrid(x_centers, y_centers, indexing='ij')\n\n        # Advection velocity\n        a, b = np.cos(beta), np.sin(beta)\n        \n        # Time step calculation\n        term_x = dx / np.abs(a) if np.abs(a)  1e-12 else np.inf\n        term_y = dy / np.abs(b) if np.abs(b)  1e-12 else np.inf\n        dt = CFL * min(term_x, term_y)\n\n        # Initial condition\n        q0 = np.where(xx * np.cos(alpha) + yy * np.sin(alpha)  s, 1.0, 0.0)\n\n        # Run both schemes\n        q_axis = solve_step(q0, dx, dy, dt, a, b, 'axis')\n        q_dir = solve_step(q0, dx, dy, dt, a, b, 'dir')\n\n        # Exact solution at t=dt\n        x_shifted = (xx - a * dt) % 1.0\n        y_shifted = (yy - b * dt) % 1.0\n        q_exact = np.where(x_shifted * np.cos(alpha) + y_shifted * np.sin(alpha)  s, 1.0, 0.0)\n\n        # Calculate metrics\n        # 1. Overshoot difference\n        over_axis = np.max([np.max(q_axis - 1.0), np.max(0.0 - q_axis), 0.0])\n        over_dir = np.max([np.max(q_dir - 1.0), np.max(0.0 - q_dir), 0.0])\n        delta_over = over_axis - over_dir\n\n        # 2. L1 error ratio\n        err_axis = np.sum(np.abs(q_axis - q_exact))\n        err_dir = np.sum(np.abs(q_dir - q_exact))\n        \n        # Handle cases where denominator is zero (e.g., perfect solution)\n        R_L1 = err_axis / err_dir if err_dir  1e-15 else 1.0\n        \n        all_results.append([delta_over, R_L1])\n\n    # Format output\n    result_str = \",\".join([f\"[{d:.12f},{r:.12f}]\" for d, r in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        }
    ]
}