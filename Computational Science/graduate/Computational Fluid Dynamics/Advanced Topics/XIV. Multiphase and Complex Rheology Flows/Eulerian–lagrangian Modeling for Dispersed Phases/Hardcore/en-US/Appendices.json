{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any Lagrangian particle tracking model is the correct application of Newton's second law to an individual particle. This exercise reinforces first principles by having you derive the equation of motion for a particle settling in a quiescent fluid. By solving for the transient velocity, you will gain a concrete understanding of fundamental concepts such as the particle relaxation timescale, $\\tau_p$, and terminal velocity, $v_t$, which are critical parameters in all Eulerian-Lagrangian models. ",
            "id": "3315838",
            "problem": "A single, rigid, spherical particle of diameter $d$ and density $\\rho_p$ is tracked in a Lagrangian frame as it settles under gravity in an otherwise quiescent, infinite Newtonian fluid of density $\\rho_f$ and dynamic viscosity $\\mu$. The particle is released from rest at time $t=0$ with velocity $v_p(0)=0$ along the vertical axis, with the positive direction taken downward. Assume that the particle is sufficiently heavy and small that the flow around it remains in the Stokes regime and that the only hydrodynamic force is the linear Stokes drag. Neglect added mass, history (Basset) force, lift, and Faxén corrections. Gravitational and buoyant forces act in the usual way. Use the following as a fundamental basis: Newton’s second law for the particle and the Stokes drag law, $F_D=3\\pi\\mu d\\,(v_p-u)$, where $u$ is the local fluid velocity, here $u=0$.\n\nStarting from first principles, derive an explicit, closed-form expression for the transient particle velocity $v_p(t)$ for $t\\ge 0$. Then, determine the minimal time $t_{0.05}$ such that the particle speed is within $5$ percent of its terminal speed, i.e., $|v_t - v_p(t_{0.05})| = 0.05\\,v_t$, where $v_t$ is the terminal velocity emerging from your derivation. Express your results entirely in terms of $\\rho_p$, $\\rho_f$, $\\mu$, $d$, $g$, and $t$. Express the timescale in seconds.\n\nProvide your final answer as a single row matrix containing the two closed-form expressions for $v_p(t)$ and $t_{0.05}$. No numerical evaluation is required.",
            "solution": "The problem statement is critically evaluated for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n-   **Particle properties**: single, rigid, spherical, diameter $d$, density $\\rho_p$.\n-   **Fluid properties**: quiescent, infinite, Newtonian, density $\\rho_f$, dynamic viscosity $\\mu$.\n-   **Initial condition**: $v_p(0) = 0$ at $t=0$.\n-   **Coordinate system**: positive direction is downward along the vertical axis.\n-   **Physical model**:\n    -   Framework: Lagrangian tracking of the particle.\n    -   Governing law: Newton's second law.\n    -   Included forces: Gravity, Buoyancy, Stokes drag.\n    -   Stokes drag law: $F_D=3\\pi\\mu d\\,(v_p-u)$.\n    -   Fluid velocity: $u=0$.\n    -   Neglected effects: Added mass, history (Basset) force, lift, Faxén corrections.\n-   **Objectives**:\n    1.  Derive the transient particle velocity $v_p(t)$ for $t \\ge 0$.\n    2.  Determine the time $t_{0.05}$ such that $|v_t - v_p(t_{0.05})| = 0.05\\,v_t$, where $v_t$ is the terminal velocity.\n-   **Output requirements**: Express results in terms of $\\rho_p$, $\\rho_f$, $\\mu$, $d$, $g$, and $t$. Provide the final answer as a single row matrix containing the expressions for $v_p(t)$ and $t_{0.05}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n-   **Scientifically Grounded**: Yes. The problem describes the classical setup for particle settling at low Reynolds numbers, based on Newton's second law and the Stokes drag model. This is a fundamental and well-established topic in fluid mechanics.\n-   **Well-Posed**: Yes. The problem describes a first-order linear ordinary differential equation with a specified initial condition. This structure guarantees that a unique and stable solution exists.\n-   **Objective**: Yes. The problem is stated using precise, quantitative, and unambiguous scientific language.\n-   **Flaw Analysis**:\n    1.  **Scientific Unsoundness**: None. The physical model is a standard, valid simplification for the specified regime.\n    2.  **Non-Formalizable/Irrelevant**: The problem is directly formalizable into a solvable differential equation and is highly relevant to Eulerian-Lagrangian modeling in computational fluid dynamics.\n    3.  **Incomplete/Contradictory Setup**: No. All necessary parameters ($\\rho_p$, $\\rho_f$, $\\mu$, $d$, $g$) and conditions ($v_p(0)=0$) are provided.\n    4.  **Unrealistic/Infeasible**: No. The conditions are physically plausible for a wide range of real-world scenarios, such as sedimentation of fine particles.\n    5.  **Ill-Posed**: No. As established, the problem is well-posed.\n    6.  **Trivial/Tautological**: No. While a textbook problem, it requires a complete derivation from first principles, demonstrating core competencies in mechanics and differential equations.\n    7.  **Outside Scientific Verifiability**: No. The solution is mathematically derivable and physically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full, reasoned solution will be provided.\n\n### Solution Derivation\nThe motion of the particle is governed by Newton's second law, which states that the net force on the particle is equal to its mass times its acceleration.\n$$m_p \\frac{dv_p}{dt} = \\sum F$$\nThe particle is spherical with diameter $d$. Its volume is $V_p = \\frac{1}{6}\\pi d^3$, and its mass is $m_p = \\rho_p V_p = \\frac{1}{6}\\pi d^3 \\rho_p$. The forces acting on the particle in the vertical direction (positive downward) are gravity, buoyancy, and drag.\n\n1.  **Gravitational Force ($F_g$)**: Acts downward (positive).\n    $$F_g = m_p g = \\frac{1}{6}\\pi d^3 \\rho_p g$$\n\n2.  **Buoyant Force ($F_b$)**: Acts upward (negative), equal to the weight of the displaced fluid.\n    $$F_b = -V_p \\rho_f g = -\\frac{1}{6}\\pi d^3 \\rho_f g$$\n\n3.  **Stokes Drag Force ($F_D$)**: Acts upward (negative) as it opposes the downward motion of the particle. The problem specifies the form $F_D = 3\\pi\\mu d (v_p-u)$. With the fluid being quiescent ($u=0$), the drag force opposing the velocity $v_p$ is:\n    $$F_D = -3\\pi\\mu d v_p$$\n\nSumming the forces yields the equation of motion:\n$$m_p \\frac{dv_p}{dt} = F_g + F_b + F_D$$\n$$\\frac{1}{6}\\pi d^3 \\rho_p \\frac{dv_p}{dt} = \\frac{1}{6}\\pi d^3 \\rho_p g - \\frac{1}{6}\\pi d^3 \\rho_f g - 3\\pi\\mu d v_p$$\nGroup the terms:\n$$\\frac{1}{6}\\pi d^3 \\rho_p \\frac{dv_p}{dt} = \\frac{1}{6}\\pi d^3 (\\rho_p - \\rho_f)g - 3\\pi\\mu d v_p$$\nTo simplify, we isolate the derivative term $\\frac{dv_p}{dt}$:\n$$\\frac{dv_p}{dt} = \\frac{\\frac{1}{6}\\pi d^3 (\\rho_p - \\rho_f)g}{\\frac{1}{6}\\pi d^3 \\rho_p} - \\frac{3\\pi\\mu d}{\\frac{1}{6}\\pi d^3 \\rho_p} v_p$$\n$$\\frac{dv_p}{dt} = \\frac{(\\rho_p - \\rho_f)g}{\\rho_p} - \\frac{18\\mu}{d^2 \\rho_p} v_p$$\nThis is a first-order linear ordinary differential equation. We can define two important parameters. First, the terminal velocity $v_t$ is reached when the acceleration is zero ($\\frac{dv_p}{dt}=0$).\n$$0 = \\frac{(\\rho_p - \\rho_f)g}{\\rho_p} - \\frac{18\\mu}{d^2 \\rho_p} v_t$$\nSolving for $v_t$:\n$$v_t = \\frac{(\\rho_p - \\rho_f)g}{\\rho_p} \\cdot \\frac{d^2 \\rho_p}{18\\mu} = \\frac{g d^2 (\\rho_p - \\rho_f)}{18\\mu}$$\nThis is the Stokes settling velocity. We assume $\\rho_p > \\rho_f$ for settling to occur, making $v_t>0$.\n\nSecond, we define the particle momentum relaxation time, $\\tau_p$, which is the inverse of the coefficient of $v_p$:\n$$\\tau_p = \\frac{d^2 \\rho_p}{18\\mu}$$\nThe equation of motion can now be rewritten compactly in terms of $v_t$ and $\\tau_p$:\n$$\\frac{dv_p}{dt} = \\frac{v_t}{\\tau_p} - \\frac{1}{\\tau_p}v_p = \\frac{1}{\\tau_p}(v_t - v_p)$$\nThis is a separable differential equation:\n$$\\frac{dv_p}{v_t - v_p} = \\frac{dt}{\\tau_p}$$\nWe integrate both sides from the initial state ($t=0, v_p=0$) to a general state ($t, v_p(t)$):\n$$\\int_0^{v_p(t)} \\frac{dv'}{v_t - v'} = \\int_0^t \\frac{dt'}{\\tau_p}$$\n$$\\left[-\\ln(v_t - v')\\right]_0^{v_p(t)} = \\frac{t}{\\tau_p}$$\n$$-\\ln(v_t - v_p(t)) + \\ln(v_t - 0) = \\frac{t}{\\tau_p}$$\n$$\\ln\\left(\\frac{v_t}{v_t - v_p(t)}\\right) = \\frac{t}{\\tau_p}$$\nExponentiating both sides:\n$$\\frac{v_t}{v_t - v_p(t)} = \\exp\\left(\\frac{t}{\\tau_p}\\right)$$\nRearranging to solve for $v_p(t)$:\n$$v_t - v_p(t) = v_t \\exp\\left(-\\frac{t}{\\tau_p}\\right)$$\n$$v_p(t) = v_t \\left(1 - \\exp\\left(-\\frac{t}{\\tau_p}\\right)\\right)$$\nSubstituting the full expressions for $v_t$ and $\\tau_p$ yields the first part of the answer:\n$$v_p(t) = \\frac{g d^2 (\\rho_p - \\rho_f)}{18\\mu} \\left(1 - \\exp\\left(-\\frac{18\\mu t}{d^2 \\rho_p}\\right)\\right)$$\nNext, we find the time $t_{0.05}$ at which the particle's speed is within $5\\%$ of its terminal speed. The condition is $|v_t - v_p(t_{0.05})| = 0.05 v_t$. Since $v_p(t)$ approaches $v_t$ from below ($v_p(t) \\le v_t$), we can drop the absolute value:\n$$v_t - v_p(t_{0.05}) = 0.05 v_t$$\nThis simplifies to $v_p(t_{0.05}) = 0.95 v_t$. Using our transient solution for $v_p(t)$:\n$$v_t \\left(1 - \\exp\\left(-\\frac{t_{0.05}}{\\tau_p}\\right)\\right) = 0.95 v_t$$\nAssuming $v_t \\neq 0$, we divide by $v_t$:\n$$1 - \\exp\\left(-\\frac{t_{0.05}}{\\tau_p}\\right) = 0.95$$\n$$\\exp\\left(-\\frac{t_{0.05}}{\\tau_p}\\right) = 1 - 0.95 = 0.05$$\nTaking the natural logarithm of both sides:\n$$-\\frac{t_{0.05}}{\\tau_p} = \\ln(0.05)$$\n$$t_{0.05} = -\\tau_p \\ln(0.05) = \\tau_p \\ln\\left(\\frac{1}{0.05}\\right) = \\tau_p \\ln(20)$$\nSubstituting the expression for $\\tau_p = \\frac{d^2 \\rho_p}{18\\mu}$:\n$$t_{0.05} = \\frac{d^2 \\rho_p \\ln(20)}{18\\mu}$$\nThis expression has units of time, which is consistent with the prompt.\n\nThe final answer requires a row matrix containing the two derived expressions.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{g d^2 (\\rho_p - \\rho_f)}{18\\mu} \\left(1 - \\exp\\left(-\\frac{18\\mu t}{d^2 \\rho_p}\\right)\\right) & \\frac{d^2 \\rho_p \\ln(20)}{18\\mu}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Once we can model a single particle, we must consider its motion within a dynamic fluid velocity field, $\\boldsymbol{u}(\\boldsymbol{x},t)$. A common misconception is that tracer particles follow the instantaneous streamlines of the flow; however, this is only true for steady flows. This practice challenges you to explore the crucial kinematic distinction between a particle's pathline and the fluid's streamlines in an unsteady flow, a concept essential for correctly interpreting and visualizing Lagrangian data. ",
            "id": "3315853",
            "problem": "Consider Eulerian–Lagrangian modeling of a dispersed phase in Computational Fluid Dynamics (CFD), where the carrier-flow velocity field is denoted by $\\boldsymbol{u}(\\boldsymbol{x},t)$ and a small spherical particle has velocity $\\boldsymbol{v}_p(\\boldsymbol{x},t)$. A streamline at a fixed time $t_0$ is defined as a curve $\\boldsymbol{r}(s)$ whose tangent is everywhere parallel to $\\boldsymbol{u}(\\boldsymbol{r},t_0)$, i.e., $\\mathrm{d}\\boldsymbol{r}/\\mathrm{d}s \\parallel \\boldsymbol{u}(\\boldsymbol{r},t_0)$. A pathline (trajectory) of a particle is the curve $\\boldsymbol{x}_p(t)$ that solves $\\mathrm{d}\\boldsymbol{x}_p/\\mathrm{d}t = \\boldsymbol{v}_p(\\boldsymbol{x}_p,t)$, with an initial condition $\\boldsymbol{x}_p(t_0)=\\boldsymbol{x}_0$. In the tracer limit with negligible particle inertia and no other body forces, a commonly used, well-tested closure for small particles is that $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$ when the particle relaxation time $\\tau_p$ is small, e.g., $\\mathrm{d}\\boldsymbol{v}_p/\\mathrm{d}t = (\\boldsymbol{u}-\\boldsymbol{v}_p)/\\tau_p$ with $\\tau_p \\to 0$.\n\nStarting from these definitions and laws, assess the difference between pathlines and streamlines in unsteady fields and the consequences for Eulerian–Lagrangian predictions when $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$. Then consider the following scientifically realistic, incompressible two-dimensional unsteady carrier flow in a square domain, constructed from alternating orthogonal shear phases of period $T>0$ and shear rate $S>0$:\n- For $t \\in [nT, nT+T/2)$, with integer $n$, the flow is $\\boldsymbol{u}(\\boldsymbol{x},t) = (S y, 0)$.\n- For $t \\in [nT+T/2, (n+1)T)$, the flow is $\\boldsymbol{u}(\\boldsymbol{x},t) = (0, S x)$.\n\nAssume a neutrally buoyant particle with small relaxation time $\\tau_p \\ll T$ so that $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$ over each phase. Let the particle start at $(x_0,y_0)$ at $t=nT$. Using only the above first-principles definitions and laws, reason about the particle’s pathline over one period and its relation to the instantaneous streamlines in each phase.\n\nWhich option(s) correctly capture the distinction and its implications for the stated scenario?\n\nA. In unsteady flows, if $\\boldsymbol{v}_p=\\boldsymbol{u}$ at all times, a particle’s pathline generally does not coincide with any single streamline of $\\boldsymbol{u}(\\cdot,t_0)$ at a fixed $t_0$; coincidence requires $\\boldsymbol{u}$ to be steady in $t$. In the alternating shear example, the tracer’s position after one period $T$ is $(x',y') = \\big(x_0 + S y_0 \\tfrac{T}{2},\\; y_0 + S x_0 \\tfrac{T}{2} + S^2 y_0 \\tfrac{T^2}{4}\\big)$, which crosses multiple instantaneous streamlines.\n\nB. If the Stokes number $\\mathrm{St} \\ll 1$ so that $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, pathlines always coincide with instantaneous streamlines, regardless of unsteadiness; in the alternating shear, the net displacement after any integer number of periods is zero.\n\nC. Incompressibility, $\\nabla\\cdot\\boldsymbol{u}=0$, guarantees that the level sets of a streamfunction are material lines for any $\\boldsymbol{u}(\\boldsymbol{x},t)$, hence pathlines coincide with streamlines; the alternating shear only fails to show this because it is compressible.\n\nD. Pathlines can diverge from streamlines only when particle density differs from the carrier density, through added mass and history effects; if $\\rho_p=\\rho_f$ and $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, divergence is impossible.\n\nSelect all that apply.",
            "solution": "The problem statement is analyzed for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n- Carrier-flow velocity field: $\\boldsymbol{u}(\\boldsymbol{x},t)$\n- Small spherical particle velocity: $\\boldsymbol{v}_p(\\boldsymbol{x},t)$\n- Streamline definition: A curve $\\boldsymbol{r}(s)$ at a fixed time $t_0$ such that its tangent is everywhere parallel to the velocity field, i.e., $\\mathrm{d}\\boldsymbol{r}/\\mathrm{d}s \\parallel \\boldsymbol{u}(\\boldsymbol{r},t_0)$.\n- Pathline definition: The curve $\\boldsymbol{x}_p(t)$ that is the solution to $\\mathrm{d}\\boldsymbol{x}_p/\\mathrm{d}t = \\boldsymbol{v}_p(\\boldsymbol{x}_p,t)$, with an initial condition $\\boldsymbol{x}_p(t_0)=\\boldsymbol{x}_0$.\n- Tracer limit approximation: For a small particle relaxation time $\\tau_p \\to 0$, the particle velocity approximates the fluid velocity, $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$. The underlying model is given as $\\mathrm{d}\\boldsymbol{v}_p/\\mathrm{d}t = (\\boldsymbol{u}-\\boldsymbol{v}_p)/\\tau_p$.\n- Specific unsteady flow field: A $2$D incompressible flow with period $T>0$ and shear rate $S>0$.\n    - For $t \\in [nT, nT+T/2)$ (integer $n$): $\\boldsymbol{u}(\\boldsymbol{x},t) = (S y, 0)$.\n    - For $t \\in [nT+T/2, (n+1)T)$: $\\boldsymbol{u}(\\boldsymbol{x},t) = (0, S x)$.\n- Particle and initial conditions for the specific case: Neutrally buoyant particle with $\\tau_p \\ll T$, such that $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$. The particle starts at $(x_0, y_0)$ at time $t=nT$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The definitions of streamlines and pathlines are fundamental concepts in fluid mechanics. The tracer limit, where $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, is a standard and valid approximation for particles with negligible inertia (i.e., very small Stokes number). The specified flow field is a known example used to study chaotic advection; it is a mathematically well-defined, unsteady, incompressible flow. The incompressibility condition $\\nabla \\cdot \\boldsymbol{u} = 0$ holds for each phase:\n    - Phase 1: $\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial}{\\partial x}(Sy) + \\frac{\\partial}{\\partial y}(0) = 0+0=0$.\n    - Phase 2: $\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial}{\\partial x}(0) + \\frac{\\partial}{\\partial y}(Sx) = 0+0=0$.\nAll premises are scientifically sound.\n- **Well-Posed:** The problem is well-posed. The flow field and particle behavior are explicitly defined. The initial conditions are given. The task is to calculate a particle trajectory and compare it with the definition of streamlines. A unique solution exists for the particle's path.\n- **Objective:** The problem is stated in precise, objective, mathematical language. There are no subjective elements.\n\n### Step 3: Verdict and Action\nThe problem statement is scientifically sound, well-posed, objective, and complete. It presents a valid and non-trivial question in fluid dynamics. Therefore, I will proceed with the solution.\n\n### Part 1: Derivation from First Principles\n\nFirst, we analyze the general relationship between pathlines and streamlines.\nA pathline $\\boldsymbol{x}_p(t)$ is the trajectory of a material point. In the tracer limit, $\\boldsymbol{v}_p = \\boldsymbol{u}$, so the pathline equation is:\n$$ \\frac{\\mathrm{d}\\boldsymbol{x}_p}{\\mathrm{d}t} = \\boldsymbol{u}(\\boldsymbol{x}_p(t), t) $$\nThis is an integral over time $t$. The tangent to the pathline at time $t$ is the velocity vector $\\boldsymbol{u}$ at position $\\boldsymbol{x}_p(t)$ and time $t$.\n\nA streamline is a curve $\\boldsymbol{r}(s)$ that is everywhere tangent to the velocity field at a single, frozen instant of time $t_0$:\n$$ \\frac{\\mathrm{d}\\boldsymbol{r}}{\\mathrm{d}s} \\parallel \\boldsymbol{u}(\\boldsymbol{r}(s), t_0) $$\nIf the flow is steady, $\\boldsymbol{u}(\\boldsymbol{x},t) = \\boldsymbol{u}(\\boldsymbol{x})$. The governing equations for pathlines and streamlines become formally identical, so they coincide.\nIf the flow is unsteady, $\\boldsymbol{u}(\\boldsymbol{x},t)$ changes with time. A particle at $\\boldsymbol{x}_p(t)$ moves according to $\\boldsymbol{u}(\\boldsymbol{x}_p(t), t)$. An infinitesimal time $\\mathrm{d}t$ later, it is at $\\boldsymbol{x}_p(t+\\mathrm{d}t)$, and the velocity field itself may have changed. The particle follows the new local velocity vector. Therefore, the pathline is tangent to the streamline that passes through the particle's position *at each instant in time*, but it does not follow a single streamline defined at a fixed time $t_0$. The path is a curve that cuts across the evolving family of instantaneous streamline patterns.\n\nNext, we apply this to the specific alternating shear flow. We assume $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, so we solve for the pathline $\\boldsymbolx_p(t) = (x(t), y(t))$ using the fluid velocity $\\boldsymbol{u}$. The particle starts at $(x_0, y_0)$ at $t=nT$.\n\n**Phase 1: $t \\in [nT, nT + T/2)$**\nThe velocity field is $\\boldsymbol{u} = (Sy, 0)$. The equations of motion for the particle are:\n$$ \\frac{\\mathrm{d}x}{\\mathrm{d}t} = Sy $$\n$$ \\frac{\\mathrm{d}y}{\\mathrm{d}t} = 0 $$\nIntegrating the second equation with the initial condition $y(nT) = y_0$ gives $y(t) = y_0$ for this entire interval.\nSubstituting this into the first equation gives $\\mathrm{d}x/\\mathrm{d}t = Sy_0$. Integrating from $t=nT$ to a time $t_{end} = nT + T/2$:\n$$ \\int_{x_0}^{x_1} \\mathrm{d}x = \\int_{nT}^{nT+T/2} Sy_0 \\mathrm{d}t $$\n$$ x_1 - x_0 = Sy_0 \\left( (nT+T/2) - nT \\right) = Sy_0 \\frac{T}{2} $$\n$$ x_1 = x_0 + Sy_0 \\frac{T}{2} $$\nAt the end of Phase 1, the particle is at position $(x_1, y_1) = (x_0 + Sy_0 \\frac{T}{2}, y_0)$. The path during this phase is a horizontal line segment. The streamlines for this phase are given by $\\mathrm{d}y/\\mathrm{d}x=0/Sy=0$, which are horizontal lines $y=\\text{constant}$. Thus, during this phase, the pathline locally follows a streamline.\n\n**Phase 2: $t \\in [nT+T/2, (n+1)T)$**\nThe velocity field is $\\boldsymbol{u} = (0, Sx)$. The equations of motion are:\n$$ \\frac{\\mathrm{d}x}{\\mathrm{d}t} = 0 $$\n$$ \\frac{\\mathrm{d}y}{\\mathrm{d}t} = Sx $$\nThe initial condition for this phase is the final position from Phase 1: $(x_1, y_1)$.\nIntegrating the first equation gives $x(t) = x_1 = x_0 + Sy_0 \\frac{T}{2}$ for this entire interval.\nSubstituting this into the second equation gives $\\mathrm{d}y/\\mathrm{d}t = S(x_0 + Sy_0 \\frac{T}{2})$. Integrating from $t=nT+T/2$ to $t_{end} = (n+1)T$:\n$$ \\int_{y_1}^{y'} \\mathrm{d}y = \\int_{nT+T/2}^{(n+1)T} S\\left(x_0 + Sy_0 \\frac{T}{2}\\right) \\mathrm{d}t $$\n$$ y' - y_1 = S\\left(x_0 + Sy_0 \\frac{T}{2}\\right) \\left( ((n+1)T) - (nT+T/2) \\right) = S\\left(x_0 + Sy_0 \\frac{T}{2}\\right) \\frac{T}{2} $$\nSubstituting $y_1=y_0$:\n$$ y' = y_0 + S x_0 \\frac{T}{2} + S^2 y_0 \\frac{T^2}{4} $$\nThe final position after one period $t=(n+1)T$ is $(x', y')$ where $x'=x_1$.\n$$ (x', y') = \\left( x_0 + S y_0 \\frac{T}{2}, \\; y_0 + S x_0 \\frac{T}{2} + S^2 y_0 \\frac{T^2}{4} \\right) $$\nThe path during this phase is a vertical line segment. The streamlines for this phase are given by $\\mathrm{d}y/\\mathrm{d}x=Sx/0 \\to \\infty$, which are vertical lines $x=\\text{constant}$. Again, the pathline locally follows a streamline.\n\nHowever, the total path over the period $T$ is a horizontal segment followed by a vertical segment. This path does not coincide with any streamline from the first phase (a horizontal line) nor any streamline from the second phase (a vertical line). It crosses multiple streamlines from each phase's \"frozen\" field.\n\n### Part 2: Option-by-Option Analysis\n\n**A. In unsteady flows, if $\\boldsymbol{v}_p=\\boldsymbol{u}$ at all times, a particle’s pathline generally does not coincide with any single streamline of $\\boldsymbol{u}(\\cdot,t_0)$ at a fixed $t_0$; coincidence requires $\\boldsymbol{u}$ to be steady in $t$. In the alternating shear example, the tracer’s position after one period $T$ is $(x',y') = \\big(x_0 + S y_0 \\tfrac{T}{2},\\; y_0 + S x_0 \\tfrac{T}{2} + S^2 y_0 \\tfrac{T^2}{4}\\big)$, which crosses multiple instantaneous streamlines.**\n- The first statement about the general distinction between pathlines and streamlines in unsteady vs. steady flows is correct, as established in our derivation.\n- The calculated final position $(x', y')$ precisely matches our derived result: $(x', y') = \\left( x_0 + S y_0 \\frac{T}{2}, \\; y_0 + S x_0 \\frac{T}{2} + S^2 y_0 \\frac{T^2}{4} \\right)$.\n- The final path, composed of a horizontal and then a vertical segment, is not a single streamline of the flow at any fixed time. The vertical part of the trajectory crosses the horizontal streamlines of Phase 1, and the horizontal part crosses the vertical streamlines of Phase 2. Thus, the path crosses multiple instantaneous streamlines.\nThis option is entirely consistent with the first principles and our derivation.\n**Verdict: Correct**\n\n**B. If the Stokes number $\\mathrm{St} \\ll 1$ so that $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, pathlines always coincide with instantaneous streamlines, regardless of unsteadiness; in the alternating shear, the net displacement after any integer number of periods is zero.**\n- The first part of the statement, \"pathlines always coincide with instantaneous streamlines, regardless of unsteadiness\", is fundamentally incorrect. This coincidence is a defining feature of steady flows, not general flows. The condition $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$ simply means the particle pathline is the same as the fluid pathline; it does not equate the pathline to a streamline in an unsteady flow.\n- The second part, \"the net displacement after any integer number of periods is zero\", is also incorrect. The displacement after one period is $\\Delta \\boldsymbol{x} = (x' - x_0, y' - y_0) = \\left(S y_0 \\frac{T}{2}, \\; S x_0 \\frac{T}{2} + S^2 y_0 \\frac{T^2}{4}\\right)$. This is generally non-zero for non-zero initial positions and flow parameters.\n**Verdict: Incorrect**\n\n**C. Incompressibility, $\\nabla\\cdot\\boldsymbol{u}=0$, guarantees that the level sets of a streamfunction are material lines for any $\\boldsymbol{u}(\\boldsymbol{x},t)$, hence pathlines coincide with streamlines; the alternating shear only fails to show this because it is compressible.**\n- The first claim is false. For a $2$D incompressible flow, we can define a streamfunction $\\psi$ such that its level sets are the streamlines. A particle's pathline follows a streamline (is a material line) if the value of $\\psi$ is constant following the particle, i.e., $D\\psi/Dt = 0$. The material derivative is $D\\psi/Dt = \\partial \\psi/\\partial t + \\boldsymbol{u} \\cdot \\nabla \\psi$. Since $\\boldsymbol{u} \\cdot \\nabla \\psi = 0$ by definition of $\\psi$, we have $D\\psi/Dt = \\partial \\psi/\\partial t$. This is only zero if the flow is steady ($\\partial \\psi/\\partial t=0$). Incompressibility alone is not sufficient.\n- The second claim that the alternating shear flow is compressible is factually incorrect. As shown during the validation step, $\\nabla \\cdot \\boldsymbol{u} = 0$ for both phases.\n**Verdict: Incorrect**\n\n**D. Pathlines can diverge from streamlines only when particle density differs from the carrier density, through added mass and history effects; if $\\rho_p=\\rho_f$ and $\\boldsymbol{v}_p \\approx \\boldsymbol{u}$, divergence is impossible.**\n- This option incorrectly confuses two distinct concepts: (1) the deviation of a particle's pathline from the fluid's pathline due to particle inertia (finite $\\tau_p$), and (2) the deviation of a fluid's pathline from a fluid streamline due to flow unsteadiness.\n- The problem is framed in the tracer limit ($\\boldsymbol{v}_p \\approx \\boldsymbol{u}$), where we are examining the fluid pathline itself. The divergence between this pathline and the instantaneous streamlines is a kinematic consequence of the unsteadiness of $\\boldsymbol{u}(\\boldsymbol{x}, t)$. It has nothing to do with particle properties like density, added mass, or history forces, which would cause $\\boldsymbol{v}_p$ to differ from $\\boldsymbol{u}$. The statement that divergence is impossible under the given conditions is directly contradicted by the provided unsteady flow example.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "The power of the Eulerian-Lagrangian framework lies in the coupling between phases, which requires transferring information between the Lagrangian particles and the Eulerian grid. This hands-on coding practice addresses the critical step of particle-to-mesh deposition, where particle properties are mapped onto the fluid grid. By implementing and comparing several standard assignment kernels, you will directly engage with the numerical challenges of ensuring conservation while minimizing artifacts like numerical diffusion. ",
            "id": "3315881",
            "problem": "Consider a one-dimensional periodic domain of length $L$ with $N$ uniform Eulerian cells of width $\\Delta x = L/N$ and centers at $x_i = (i + \\tfrac{1}{2})\\Delta x$ for $i \\in \\{0,1,\\dots,N-1\\}$. A dispersed phase is represented in a Lagrangian manner by $M$ particles located at positions $x_p \\in [0,L)$ with weights $w_p \\ge 0$ that represent particle number. The goal is to map the Lagrangian particles to an Eulerian cell-averaged number density field $\\rho_i$ in a way that is conservative and minimizes numerical diffusion of particle number density. Conservation of particle number means the discrete integral of the deposited density equals the total particle number, i.e., $\\sum_{i=0}^{N-1} \\rho_i \\Delta x = \\sum_{p=1}^{M} w_p$. Numerical diffusion can be quantified by the increase in the second central moment (variance) of the field after deposition compared to the particle distribution.\n\nStarting from the following fundamental base:\n- Newtonian kinematics for particle positions, $v = dx/dt$, focusing here on static deposition (no particle motion during mapping).\n- Conservation of particle number expressed as $\\int_0^L \\rho(x)\\,dx = \\sum_{p=1}^M w_p$.\n- The representation of the particle number density as a sum of Dirac delta distributions, $\\rho(x) = \\sum_{p=1}^M w_p \\delta(x - x_p)$, and its grid-based approximation by replacing $\\delta$ with a normalized assignment kernel.\n\nDefine a family of particle-to-mesh deposition operators that map particles to the discrete field by\n$$\n\\rho_i = \\frac{1}{\\Delta x} \\sum_{p=1}^M w_p\\, \\mathcal{W}(x_p - x_i),\n$$\nwhere $\\mathcal{W}$ is a compactly supported, normalized assignment kernel that satisfies a discrete partition-of-unity on the grid,\n$$\n\\sum_{i=0}^{N-1} \\mathcal{W}(x_p - x_i) = 1 \\quad \\text{for all particle positions } x_p,\n$$\nwith periodic boundary conditions.\n\nImplement and compare the following three assignment schemes:\n1. Nearest-Grid-Point (NGP): Assign each particle entirely to its nearest cell center. This corresponds to a zero-order B-spline kernel with unit mass and support over one cell.\n2. Cloud-In-Cell (CIC): Distribute each particle between the two nearest cell centers using a first-order hat function in one dimension. This corresponds to a first-order B-spline kernel with unit mass and support over two cells.\n3. Cubic B-spline: Use the third-order B-spline kernel with support over four cells and piecewise definition,\n$$\n\\phi(u) =\n\\begin{cases}\n\\frac{4 - 6u^2 + 3u^3}{6}, & 0 \\le u < 1, \\\\\n\\frac{(2 - u)^3}{6}, & 1 \\le u < 2, \\\\\n0, & u \\ge 2,\n\\end{cases}\n$$\nwhere $u$ is the distance from the particle to a cell center in units of $\\Delta x$, and the periodic discrete partition-of-unity is enforced by summing over the four nearest centers.\n\nTo quantify numerical diffusion, use the second central moment (variance) on the periodic domain. Let the particle number be $N_{\\text{tot}} = \\sum_{p=1}^{M} w_p$. The circular mean position $\\mu \\in [0,L)$ is defined by mapping positions to angles $\\theta_p = 2\\pi x_p / L$, computing the complex mean $z = \\left(\\sum_p w_p e^{i \\theta_p}\\right)/N_{\\text{tot}}$, taking $\\bar{\\theta} = \\arg(z)$, and setting $\\mu = (\\bar{\\theta} \\bmod 2\\pi)\\,L/(2\\pi)$. Define the minimal periodic difference $\\mathrm{wrap}_L(d) = d - L \\,\\mathrm{round}(d/L)$ so that $\\mathrm{wrap}_L(d) \\in [-L/2,L/2]$. Then compute the particle second moment\n$$\n\\sigma^2_{\\text{part}} = \\frac{1}{N_{\\text{tot}}}\\sum_{p=1}^{M} w_p\\, \\mathrm{wrap}_L(x_p - \\mu)^2,\n$$\nand the grid second moment for a deposited field $\\rho_i$ using the same $\\mu$,\n$$\n\\sigma^2_{\\text{grid}} = \\frac{1}{N_{\\text{tot}}}\\sum_{i=0}^{N-1} \\rho_i\\, \\mathrm{wrap}_L(x_i - \\mu)^2 \\, \\Delta x.\n$$\nDefine the numerical diffusion for a scheme as the increase in variance, $\\Delta \\sigma^2 = \\sigma^2_{\\text{grid}} - \\sigma^2_{\\text{part}}$.\n\nTask:\n- Implement the three deposition schemes described above in a periodic one-dimensional domain.\n- Ensure conservation, i.e., $\\sum_i \\rho_i \\Delta x = \\sum_p w_p$, up to numerical rounding.\n- Compute the numerical diffusion $\\Delta \\sigma^2$ for each scheme for each test case below.\n- Output, for each test case, a list of six floats in the order\n$[\\varepsilon_{\\text{NGP}}, \\varepsilon_{\\text{CIC}}, \\varepsilon_{\\text{B3}}, \\Delta \\sigma^2_{\\text{NGP}}, \\Delta \\sigma^2_{\\text{CIC}}, \\Delta \\sigma^2_{\\text{B3}}]$,\nwhere $\\varepsilon$ is the absolute conservation error defined by $\\varepsilon = \\left|\\sum_i \\rho_i \\Delta x - \\sum_p w_p\\right|$ and $\\Delta \\sigma^2$ is the variance increase as defined above. All numbers must be expressed as dimensionless floats, rounded to ten decimal places.\n\nPhysical and numerical parameters:\n- Domain length $L = 1$ (dimensionless).\n- Grid sizes and particle sets as follows.\n\nTest suite (use these exact parameters with the same random seeds for reproducibility):\n1. Gaussian cluster away from boundaries (happy path): $N=64$, $M=20000$, particle positions $x_p$ sampled independently from a normal distribution with mean $0.35$ and standard deviation $0.03$, then mapped into $[0,1)$ by modulo $L$; equal weights $w_p=1$. Use random seed $12345$.\n2. Narrow Gaussian cluster near the periodic boundary (boundary stress): $N=64$, $M=20000$, particle positions sampled from a normal distribution with mean $0.98$ and standard deviation $0.01$, wrapped into $[0,1)$; equal weights $w_p=1$. Use random seed $23456$.\n3. Single particle at the boundary (edge case): $N=64$, $M=1$, $x_1 = 0.0$, $w_1 = 1$.\n4. Uniform distribution (aliasing sanity): $N=64$, $M=20000$, particle positions sampled uniformly on $[0,1)$; equal weights $w_p=1$. Use random seed $34567$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets. Specifically, print\n$[[t_1],[t_2],[t_3],[t_4]]$,\nwhere $[t_k]$ is the six-float list for test case $k$, in the order specified above, with each float rounded to ten decimal places. No additional text should be printed.",
            "solution": "We begin from conservation of particle number and the mathematical representation of a dispersed phase. In one dimension, a collection of $M$ particles at positions $x_p$ with weights $w_p$ has a continuous number density given formally by\n$$\n\\rho(x) = \\sum_{p=1}^{M} w_p \\delta(x - x_p),\n$$\nwhere $\\delta$ is the Dirac delta distribution. The total particle number is conserved:\n$$\n\\int_{0}^{L} \\rho(x)\\, dx = \\sum_{p=1}^{M} w_p = N_{\\text{tot}}.\n$$\nAn Eulerian representation uses cell-averaged densities $\\rho_i$ on a uniform grid with cell centers $x_i$ and width $\\Delta x$. To obtain a discrete mapping that preserves conservation, we replace $\\delta$ with an assignment kernel $\\mathcal{W}$ that is normalized in the discrete sense. Specifically, the deposition operator is\n$$\n\\rho_i = \\frac{1}{\\Delta x} \\sum_{p=1}^{M} w_p\\, \\mathcal{W}(x_p - x_i),\n$$\nand we require that for each particle position $x_p$, the kernel satisfies the partition of unity on the discrete grid:\n$$\n\\sum_{i=0}^{N-1} \\mathcal{W}(x_p - x_i) = 1,\n$$\nunder periodic boundary conditions. Then conservation follows directly:\n$$\n\\sum_{i=0}^{N-1} \\rho_i \\Delta x = \\sum_{i=0}^{N-1} \\sum_{p=1}^{M} w_p \\mathcal{W}(x_p - x_i) = \\sum_{p=1}^{M} w_p \\left(\\sum_{i=0}^{N-1} \\mathcal{W}(x_p - x_i)\\right) = \\sum_{p=1}^{M} w_p = N_{\\text{tot}}.\n$$\n\nWe now define three specific kernels $\\mathcal{W}$, each a member of the family of B-spline assignment functions, expressed in one dimension:\n1. Nearest-Grid-Point (NGP) corresponds to the zero-order B-spline. For a particle at $x_p$, its contribution goes entirely to the nearest center $x_j$, i.e., $\\mathcal{W}(x_p - x_i) = 1$ if $i=j$ and $0$ otherwise. This trivially satisfies the partition of unity and conserves mass.\n2. Cloud-In-Cell (CIC) corresponds to the first-order B-spline, a piecewise linear hat function that linearly distributes weight between the two nearest centers. If $s = x_p/\\Delta x - 1/2$ is the particle coordinate relative to the grid of centers in units of cells, and $j = \\lfloor s \\rfloor$, then with $f = s - j \\in [0,1)$, $\\mathcal{W}$ assigns weights $(1-f)$ and $f$ to centers $j$ and $j+1$ (wrapped periodically). The discrete sum of weights is $(1-f)+f=1$.\n3. The cubic ($3$rd-order) B-spline has compact support over four neighboring centers. Let $u$ denote the distance in cell units between $x_p$ and a center $x_i$: $u = |x_p - x_i|/\\Delta x$. The kernel value is\n$$\n\\phi(u) =\n\\begin{cases}\n\\frac{4 - 6u^2 + 3u^3}{6}, & 0 \\le u < 1, \\\\\n\\frac{(2 - u)^3}{6}, & 1 \\le u < 2, \\\\\n0, & u \\ge 2.\n\\end{cases}\n$$\nFor a particle with fractional coordinate $s$, contributions are nonzero only to the four neighboring centers with indices $j + k$ for $k \\in \\{-1,0,1,2\\}$, where $j = \\lfloor s \\rfloor$, with distances $u_k = |s - (j+k)|$. The partition of unity property holds, i.e., $\\sum_{k=-1}^{2} \\phi(u_k) = 1$ for any $s$, ensuring conservation.\n\nTo assess numerical diffusion, we compare the second central moment (variance) of the particle distribution to that of the deposited grid field. On a periodic domain, the usual Euclidean mean is not appropriate near the boundary. Instead, we define the circular mean using angles $\\theta_p = 2\\pi x_p/L$, computing\n$$\nz = \\frac{1}{N_{\\text{tot}}} \\sum_{p=1}^{M} w_p e^{i \\theta_p}, \\quad \\bar{\\theta} = \\arg(z), \\quad \\mu = \\frac{L}{2\\pi} (\\bar{\\theta} \\bmod 2\\pi).\n$$\nWe measure squared distances using the minimal periodic difference\n$$\n\\mathrm{wrap}_L(d) = d - L \\,\\mathrm{round}\\!\\left(\\frac{d}{L}\\right) \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right].\n$$\nThe particle variance is then\n$$\n\\sigma^2_{\\text{part}} = \\frac{1}{N_{\\text{tot}}} \\sum_{p=1}^{M} w_p \\, \\mathrm{wrap}_L(x_p - \\mu)^2,\n$$\nand the grid variance is\n$$\n\\sigma^2_{\\text{grid}} = \\frac{1}{N_{\\text{tot}}} \\sum_{i=0}^{N-1} \\rho_i \\, \\mathrm{wrap}_L(x_i - \\mu)^2 \\, \\Delta x.\n$$\nThe numerical diffusion introduced by the deposition is the increase in variance\n$$\n\\Delta \\sigma^2 = \\sigma^2_{\\text{grid}} - \\sigma^2_{\\text{part}}.\n$$\nA conservative deposition has $\\varepsilon = \\left|\\sum_i \\rho_i \\Delta x - \\sum_p w_p\\right| \\approx 0$. A less diffusive scheme yields smaller $\\Delta \\sigma^2$ for smooth distributions. For a single particle (a discrete delta), higher-order kernels spread the mass more widely and thus can yield a larger $\\Delta \\sigma^2$, whereas for smooth clustered distributions, higher-order kernels typically better suppress aliasing and reduce effective diffusion.\n\nAlgorithmic design:\n- Precompute grid centers $x_i$ and $\\Delta x$ from $L$ and $N$.\n- For each scheme:\n  - Initialize $\\rho_i = 0$.\n  - For each particle, compute the relative coordinate $s = x_p/\\Delta x - 1/2$ and apply periodic indexing to determine affected cells and weights according to the kernel, updating $\\rho$ by adding $w_p$ times the kernel weights divided by $\\Delta x$. Periodicity is handled by modular arithmetic on indices.\n  - After deposition, compute conservation error $\\varepsilon = \\left|\\sum_i \\rho_i \\Delta x - N_{\\text{tot}}\\right|$.\n- For each test case:\n  - Generate particle positions $x_p$ with specified distributions and weights $w_p$.\n  - Compute the circular mean $\\mu$ and particle variance $\\sigma^2_{\\text{part}}$.\n  - Deposit using NGP, CIC, and cubic B-spline to obtain $\\rho^{\\text{NGP}}$, $\\rho^{\\text{CIC}}$, and $\\rho^{\\text{B3}}$.\n  - Compute $\\sigma^2_{\\text{grid}}$ for each deposited field using the same $\\mu$ to isolate diffusion, and then $\\Delta \\sigma^2$.\n  - Record the six-tuple $[\\varepsilon_{\\text{NGP}}, \\varepsilon_{\\text{CIC}}, \\varepsilon_{\\text{B3}}, \\Delta \\sigma^2_{\\text{NGP}}, \\Delta \\sigma^2_{\\text{CIC}}, \\Delta \\sigma^2_{\\text{B3}}]$.\n- Print the list of four results, one per test case, rounded to ten decimal places, as a single line.\n\nNumerical details and robustness:\n- Using the partition-of-unity property of the kernels and periodic modular indexing guarantees conservation up to floating-point rounding.\n- The circular mean and wrapped squared distances ensure consistent statistics even when the distribution straddles the periodic boundary.\n- Rounding output values to ten decimal places provides deterministic, comparable results across environments.\n\nThis method adheres to the core principles of Eulerian–Lagrangian coupling: conservation through properly normalized kernel deposition and quantification of numerical diffusion via physically meaningful second moments on a periodic domain. The comparison across NGP, CIC, and cubic B-spline exposes the trade-off between locality and smoothness typical of particle-mesh methods.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef wrap_L(d, L):\n    # Minimal periodic difference in [-L/2, L/2]\n    return d - L * np.round(d / L)\n\ndef circular_mean(xs, ws, L):\n    # Compute weighted circular mean in [0, L)\n    theta = (2.0 * np.pi / L) * xs\n    z = np.sum(ws * (np.cos(theta) + 1j * np.sin(theta))) / np.sum(ws)\n    # If z is numerically 0, arg is undefined; np.angle returns 0.0 for z=0+0j\n    mean_angle = np.angle(z)\n    if mean_angle < 0:\n        mean_angle += 2.0 * np.pi\n    mu = (L / (2.0 * np.pi)) * mean_angle\n    return mu\n\ndef particle_second_moment(xs, ws, L, mu=None):\n    if mu is None:\n        mu = circular_mean(xs, ws, L)\n    diffs = wrap_L(xs - mu, L)\n    return np.sum(ws * diffs * diffs) / np.sum(ws), mu\n\ndef grid_second_moment(rho, centers, L, mu):\n    dx = L / len(centers)\n    diffs = wrap_L(centers - mu, L)\n    Ntot = np.sum(rho) * dx\n    if Ntot == 0.0:\n        return 0.0\n    return np.sum(rho * diffs * diffs) * dx / Ntot\n\ndef deposit_ngp(xs, ws, N, L):\n    dx = L / N\n    rho = np.zeros(N, dtype=np.float64)\n    s = xs / dx - 0.5\n    j = np.floor(s + 0.5).astype(int) % N\n    # Accumulate mass; density is mass per length: w/dx\n    np.add.at(rho, j, ws / dx)\n    return rho\n\ndef deposit_cic(xs, ws, N, L):\n    dx = L / N\n    rho = np.zeros(N, dtype=np.float64)\n    s = xs / dx - 0.5\n    j0 = np.floor(s).astype(int)\n    f = s - j0  # in [0,1)\n    j0 = j0 % N\n    j1 = (j0 + 1) % N\n    contrib0 = ws * (1.0 - f) / dx\n    contrib1 = ws * f / dx\n    np.add.at(rho, j0, contrib0)\n    np.add.at(rho, j1, contrib1)\n    return rho\n\ndef bspline3_phi(u):\n    # Cubic B-spline kernel as a function of nonnegative distance u (in cell units)\n    phi = np.zeros_like(u, dtype=np.float64)\n    u = np.asarray(u, dtype=np.float64)\n    mask1 = (u >= 0.0) & (u < 1.0)\n    mask2 = (u >= 1.0) & (u < 2.0)\n    phi[mask1] = (4.0 - 6.0 * u[mask1]**2 + 3.0 * u[mask1]**3) / 6.0\n    phi[mask2] = ((2.0 - u[mask2])**3) / 6.0\n    # outside support phi=0\n    return phi\n\ndef deposit_bspline3(xs, ws, N, L):\n    dx = L / N\n    rho = np.zeros(N, dtype=np.float64)\n    s = xs / dx - 0.5\n    j0 = np.floor(s).astype(int)  # base index (left center)\n    # For each particle, distribute to neighbors j0 + k, k in {-1,0,1,2}\n    for p in range(xs.shape[0]):\n        base = j0[p]\n        sp = s[p]\n        w = ws[p] / dx\n        for k in (-1, 0, 1, 2):\n            idx = (base + k) % N\n            u = abs(sp - (base + k))\n            phi = bspline3_phi(np.array([u]))[0]\n            if phi != 0.0:\n                rho[idx] += w * phi\n    return rho\n\ndef centers(N, L):\n    dx = L / N\n    return (np.arange(N, dtype=np.float64) + 0.5) * dx\n\ndef conservation_error(rho, L, total_weight):\n    dx = L / len(rho)\n    return abs(np.sum(rho) * dx - total_weight)\n\ndef variance_increase(xs, ws, rho, centers_arr, L):\n    sigma_p2, mu = particle_second_moment(xs, ws, L)\n    sigma_g2 = grid_second_moment(rho, centers_arr, L, mu)\n    return sigma_g2 - sigma_p2\n\ndef run_test_case(seed, N, L, positions_generator, weights_generator):\n    np.random.seed(seed)\n    xs = positions_generator()\n    ws = weights_generator(xs)\n    cent = centers(N, L)\n    rho_ngp = deposit_ngp(xs, ws, N, L)\n    rho_cic = deposit_cic(xs, ws, N, L)\nrho_b3 = deposit_bspline3(xs, ws, N, L)\n    Ntot = np.sum(ws)\n    eps_ngp = conservation_error(rho_ngp, L, Ntot)\n    eps_cic = conservation_error(rho_cic, L, Ntot)\n    eps_b3 = conservation_error(rho_b3, L, Ntot)\n    dv_ngp = variance_increase(xs, ws, rho_ngp, cent, L)\n    dv_cic = variance_increase(xs, ws, rho_cic, cent, L)\n    dv_b3 = variance_increase(xs, ws, rho_b3, cent, L)\n    return [eps_ngp, eps_cic, eps_b3, dv_ngp, dv_cic, dv_b3]\n\ndef format_results(results):\n    # Round to 10 decimal places and format as required\n    def fmt(x):\n        return f\"{x:.10f}\"\n    out = []\n    for res in results:\n        out.append(\"[\" + \",\".join(fmt(v) for v in res) + \"]\")\n    return \"[\" + \",\".join(out) + \"]\"\n\ndef solve():\n    L = 1.0\n\n    # Test case 1: Gaussian cluster away from boundaries\n    N1 = 64\n    M1 = 20000\n    mu1 = 0.35\n    sigma1 = 0.03\n    def pos_gen1():\n        xs = np.random.normal(loc=mu1, scale=sigma1, size=M1)\n        xs = np.mod(xs, L)\n        return xs\n    def w_gen_equal(xs):\n        return np.ones_like(xs, dtype=np.float64)\n    res1 = run_test_case(seed=12345, N=N1, L=L, positions_generator=pos_gen1, weights_generator=w_gen_equal)\n\n    # Test case 2: Narrow Gaussian near boundary\n    N2 = 64\n    M2 = 20000\n    mu2 = 0.98\n    sigma2 = 0.01\n    def pos_gen2():\n        xs = np.random.normal(loc=mu2, scale=sigma2, size=M2)\n        xs = np.mod(xs, L)\n        return xs\n    res2 = run_test_case(seed=23456, N=N2, L=L, positions_generator=pos_gen2, weights_generator=w_gen_equal)\n\n    # Test case 3: Single particle at boundary\n    N3 = 64\n    def pos_gen3():\n        return np.array([0.0], dtype=np.float64)\n    def w_gen_single(xs):\n        return np.array([1.0], dtype=np.float64)\n    res3 = run_test_case(seed=0, N=N3, L=L, positions_generator=pos_gen3, weights_generator=w_gen_single)\n\n    # Test case 4: Uniform distribution\n    N4 = 64\n    M4 = 20000\n    def pos_gen4():\n        return np.random.rand(M4).astype(np.float64) * L\n    res4 = run_test_case(seed=34567, N=N4, L=L, positions_generator=pos_gen4, weights_generator=w_gen_equal)\n\n    results = [res1, res2, res3, res4]\n    print(format_results(results))\n\nsolve()\n```"
        }
    ]
}