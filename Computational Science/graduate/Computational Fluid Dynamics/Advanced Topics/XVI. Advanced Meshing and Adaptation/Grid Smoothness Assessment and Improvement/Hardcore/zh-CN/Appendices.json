{
    "hands_on_practices": [
        {
            "introduction": "拉普拉斯平滑是一种用于改善网格质量的基础且直观的迭代方法。本练习提供了一个具体的计算任务，让你亲手实践一步拉普拉斯平滑操作，并量化其对网格单元几何质量的影响。通过计算单个节点移动前后雅可比行列式 $J$ 的变化，你将建立起网格平滑操作与其对核心质量度量（如单元体积或方向）影响之间的直接联系。",
            "id": "3327112",
            "problem": "考虑一个用于计算流体动力学 (CFD) 网格生成的二维结构化四边形网格片。设参数索引为 $(i,j)$ 的内部节点的物理坐标为 $\\left(x_{i,j},y_{i,j}\\right)$，其四个直接相邻的节点分别为 $\\left(x_{i-1,j},y_{i-1,j}\\right)$、$\\left(x_{i+1,j},y_{i+1,j}\\right)$、$\\left(x_{i,j-1},y_{i,j-1}\\right)$ 和 $\\left(x_{i,j+1},y_{i,j+1}\\right)$。假设一个均匀间隔的参数坐标系，其无量纲参数变量为 $\\xi$ 和 $\\eta$，且每个方向上的间距为单位长度。在每个四边形单元内部，假设从参数坐标 $(\\xi,\\eta)$ 到物理坐标 $(x(\\xi,\\eta),y(\\xi,\\eta))$ 的映射采用双线性插值。网格的局部几何质量通过映射的雅可比行列式 $J(\\xi,\\eta)$ 来评估，其定义为 $J(\\xi,\\eta)=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$，其中偏导数是关于参数变量求得的。\n\n给定一个网格片的以下物理坐标（单位：米）：\n- 内部节点（中心）：$\\left(x_{i,j},y_{i,j}\\right)=\\left(1.1,\\,1.3\\right)$，\n- 左侧相邻节点：$\\left(x_{i-1,j},y_{i-1,j}\\right)=\\left(0.9,\\,1.0\\right)$，\n- 右侧相邻节点：$\\left(x_{i+1,j},y_{i+1,j}\\right)=\\left(2.1,\\,0.8\\right)$，\n- 底部相邻节点：$\\left(x_{i,j-1},y_{i,j-1}\\right)=\\left(1.0,\\,-0.1\\right)$，\n- 顶部相邻节点：$\\left(x_{i,j+1},y_{i,j+1}\\right)=\\left(1.2,\\,2.4\\right)$，\n- 相邻单元所需的右上角节点：$\\left(x_{i+1,j+1},y_{i+1,j+1}\\right)=\\left(2.3,\\,2.2\\right)$。\n\n在内部节点上执行一次拉普拉斯平滑迭代，其定义为将内部节点更新为其四个直接相邻节点的平均值：\n$$\nx_{i,j}^{\\text{new}}=\\frac{x_{i-1,j}+x_{i+1,j}+x_{i,j-1}+x_{i,j+1}}{4},\\quad\ny_{i,j}^{\\text{new}}=\\frac{y_{i-1,j}+y_{i+1,j}+y_{i,j-1}+y_{i,j+1}}{4}.\n$$\n然后，对于一个四边形单元，其顶点按顺序为 $(\\xi,\\eta)=(0,0)$ 处的 $\\left(x_{i,j},y_{i,j}\\right)$，$(\\xi,\\eta)=(1,0)$ 处的 $\\left(x_{i+1,j},y_{i+1,j}\\right)$，$(\\xi,\\eta)=(0,1)$ 处的 $\\left(x_{i,j+1},y_{i,j+1}\\right)$，以及 $(\\xi,\\eta)=(1,1)$ 处的 $\\left(x_{i+1,j+1},y_{i+1,j+1}\\right)$，计算在平滑更新之前和之后，单元中心 $(\\xi,\\eta)=\\left(\\frac{1}{2},\\frac{1}{2}\\right)$ 处的雅可比行列式。使用双线性映射和雅可比行列式定义的基本原理，推导所需的表达式，并利用给定的坐标计算其值。最后，计算由于平滑操作引起的单元中心局部雅可比行列式的变化量，\n$$\n\\Delta J=J^{\\text{new}}-J^{\\text{old}},\n$$\n并报告 $\\Delta J$ 的值，单位为平方米。将最终答案四舍五入到四位有效数字，并以 $\\mathrm{m}^{2}$ 表示。",
            "solution": "该问题经评估是有效的。它在科学上基于计算流体动力学和网格生成的原理，是适定的，提供了所有必要信息，并以客观、无歧义的语言表述。\n\n解题过程分为四个步骤：\n1.  执行一次拉普拉斯平滑迭代，以找到中心节点的新坐标 $\\left(x_{i,j}^{\\text{new}}, y_{i,j}^{\\text{new}}\\right)$。\n2.  推导双线性四边形单元中心的雅可比行列式 $J$ 的表达式。\n3.  计算平滑操作之前 ($J^{\\text{old}}$) 和之后 ($J^{\\text{new}}$) 单元中心的雅可比行列式。\n4.  计算雅可比行列式的变化量 $\\Delta J = J^{\\text{new}} - J^{\\text{old}}$。\n\n**步骤 1：拉普拉斯平滑**\n\n内部节点的初始坐标为 $\\left(x_{i,j},y_{i,j}\\right)=\\left(1.1,\\,1.3\\right)$。其四个相邻节点的坐标为：\n- 左侧：$\\left(x_{i-1,j},y_{i-1,j}\\right)=\\left(0.9,\\,1.0\\right)$\n- 右侧：$\\left(x_{i+1,j},y_{i+1,j}\\right)=\\left(2.1,\\,0.8\\right)$\n- 底部：$\\left(x_{i,j-1},y_{i,j-1}\\right)=\\left(1.0,\\,-0.1\\right)$\n- 顶部：$\\left(x_{i,j+1},y_{i,j+1}\\right)=\\left(1.2,\\,2.4\\right)$\n\n拉普拉斯平滑更新规则由下式给出：\n$$\nx_{i,j}^{\\text{new}}=\\frac{x_{i-1,j}+x_{i+1,j}+x_{i,j-1}+x_{i,j+1}}{4}\n$$\n$$\ny_{i,j}^{\\text{new}}=\\frac{y_{i-1,j}+y_{i+1,j}+y_{i,j-1}+y_{i,j+1}}{4}\n$$\n代入给定值：\n$$\nx_{i,j}^{\\text{new}}=\\frac{0.9+2.1+1.0+1.2}{4}=\\frac{5.2}{4}=1.3\n$$\n$$\ny_{i,j}^{\\text{new}}=\\frac{1.0+0.8+(-0.1)+2.4}{4}=\\frac{4.1}{4}=1.025\n$$\n内部节点的新坐标为 $\\left(x_{i,j}^{\\text{new}}, y_{i,j}^{\\text{new}}\\right)=\\left(1.3,\\,1.025\\right)$。\n\n**步骤 2：单元中心的雅可比行列式**\n\n从参数坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的四边形单元双线性映射由下式给出：\n$$\nx(\\xi,\\eta) = x_{00}(1-\\xi)(1-\\eta) + x_{10}\\xi(1-\\eta) + x_{01}(1-\\xi)\\eta + x_{11}\\xi\\eta\n$$\n$$\ny(\\xi,\\eta) = y_{00}(1-\\xi)(1-\\eta) + y_{10}\\xi(1-\\eta) + y_{01}(1-\\xi)\\eta + y_{11}\\xi\\eta\n$$\n此处，顶点坐标与参数角点的对应关系如下：\n- $\\left(x_{00},y_{00}\\right) = \\left(x_{i,j},y_{i,j}\\right)$ 位于 $(\\xi,\\eta)=(0,0)$\n- $\\left(x_{10},y_{10}\\right) = \\left(x_{i+1,j},y_{i+1,j}\\right)$ 位于 $(\\xi,\\eta)=(1,0)$\n- $\\left(x_{01},y_{01}\\right) = \\left(x_{i,j+1},y_{i,j+1}\\right)$ 位于 $(\\xi,\\eta)=(0,1)$\n- $\\left(x_{11},y_{11}\\right) = \\left(x_{i+1,j+1},y_{i+1,j+1}\\right)$ 位于 $(\\xi,\\eta)=(1,1)$\n\n雅可比行列式为 $J(\\xi,\\eta)=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$。我们求其偏导数：\n$$\nx_{\\xi} = \\frac{\\partial x}{\\partial \\xi} = (x_{10}-x_{00})(1-\\eta) + (x_{11}-x_{01})\\eta\n$$\n$$\nx_{\\eta} = \\frac{\\partial x}{\\partial \\eta} = (x_{01}-x_{00})(1-\\xi) + (x_{11}-x_{10})\\xi\n$$\n$$\ny_{\\xi} = \\frac{\\partial y}{\\partial \\xi} = (y_{10}-y_{00})(1-\\eta) + (y_{11}-y_{01})\\eta\n$$\n$$\ny_{\\eta} = \\frac{\\partial y}{\\partial \\eta} = (y_{01}-y_{00})(1-\\xi) + (y_{11}-y_{10})\\xi\n$$\n在单元中心 $(\\xi,\\eta)=\\left(\\frac{1}{2},\\frac{1}{2}\\right)$ 处：\n$$\nx_{\\xi}\\left(\\frac{1}{2},\\frac{1}{2}\\right) = \\frac{1}{2}(x_{10}-x_{00}) + \\frac{1}{2}(x_{11}-x_{01}) = \\frac{1}{2}(x_{10}+x_{11}-x_{00}-x_{01})\n$$\n$$\nx_{\\eta}\\left(\\frac{1}{2},\\frac{1}{2}\\right) = \\frac{1}{2}(x_{01}-x_{00}) + \\frac{1}{2}(x_{11}-x_{10}) = \\frac{1}{2}(x_{01}+x_{11}-x_{00}-x_{10})\n$$\n$$\ny_{\\xi}\\left(\\frac{1}{2},\\frac{1}{2}\\right) = \\frac{1}{2}(y_{10}-y_{00}) + \\frac{1}{2}(y_{11}-y_{01}) = \\frac{1}{2}(y_{10}+y_{11}-y_{00}-y_{01})\n$$\n$$\ny_{\\eta}\\left(\\frac{1}{2},\\frac{1}{2}\\right) = \\frac{1}{2}(y_{01}-y_{00}) + \\frac{1}{2}(y_{11}-y_{10}) = \\frac{1}{2}(y_{01}+y_{11}-y_{00}-y_{10})\n$$\n\n**步骤 3：雅可比行列式计算（平滑前后）**\n\n**平滑前 ($J^{\\text{old}}$):**\n单元顶点为：\n- $\\left(x_{00}^{\\text{old}},y_{00}^{\\text{old}}\\right) = \\left(1.1, 1.3\\right)$\n- $\\left(x_{10},y_{10}\\right) = \\left(2.1, 0.8\\right)$\n- $\\left(x_{01},y_{01}\\right) = \\left(1.2, 2.4\\right)$\n- $\\left(x_{11},y_{11}\\right) = \\left(2.3, 2.2\\right)$\n\n单元中心的偏导数为：\n$$\nx_{\\xi}^{\\text{old}} = \\frac{1}{2}(2.1+2.3-1.1-1.2) = \\frac{1}{2}(4.4-2.3) = \\frac{2.1}{2} = 1.05\n$$\n$$\ny_{\\eta}^{\\text{old}} = \\frac{1}{2}(2.4+2.2-1.3-0.8) = \\frac{1}{2}(4.6-2.1) = \\frac{2.5}{2} = 1.25\n$$\n$$\nx_{\\eta}^{\\text{old}} = \\frac{1}{2}(1.2+2.3-1.1-2.1) = \\frac{1}{2}(3.5-3.2) = \\frac{0.3}{2} = 0.15\n$$\n$$\ny_{\\xi}^{\\text{old}} = \\frac{1}{2}(0.8+2.2-1.3-2.4) = \\frac{1}{2}(3.0-3.7) = \\frac{-0.7}{2} = -0.35\n$$\n平滑前的雅可比行列式为：\n$$\nJ^{\\text{old}} = x_{\\xi}^{\\text{old}} y_{\\eta}^{\\text{old}} - x_{\\eta}^{\\text{old}} y_{\\xi}^{\\text{old}} = (1.05)(1.25) - (0.15)(-0.35) = 1.3125 + 0.0525 = 1.365\n$$\n\n**平滑后 ($J^{\\text{new}}$):**\n内部节点坐标 $\\left(x_{00},y_{00}\\right)$ 被更新，而其他顶点保持不变。\n- $\\left(x_{00}^{\\text{new}},y_{00}^{\\text{new}}\\right) = \\left(1.3, 1.025\\right)$\n- 其他顶点与之前相同。\n\n单元中心的新偏导数为：\n$$\nx_{\\xi}^{\\text{new}} = \\frac{1}{2}(2.1+2.3-1.3-1.2) = \\frac{1}{2}(4.4-2.5) = \\frac{1.9}{2} = 0.95\n$$\n$$\ny_{\\eta}^{\\text{new}} = \\frac{1}{2}(2.4+2.2-1.025-0.8) = \\frac{1}{2}(4.6-1.825) = \\frac{2.775}{2} = 1.3875\n$$\n$$\nx_{\\eta}^{\\text{new}} = \\frac{1}{2}(1.2+2.3-1.3-2.1) = \\frac{1}{2}(3.5-3.4) = \\frac{0.1}{2} = 0.05\n$$\n$$\ny_{\\xi}^{\\text{new}} = \\frac{1}{2}(0.8+2.2-1.025-2.4) = \\frac{1}{2}(3.0-3.425) = \\frac{-0.425}{2} = -0.2125\n$$\n平滑后的雅可比行列式为：\n$$\nJ^{\\text{new}} = x_{\\xi}^{\\text{new}} y_{\\eta}^{\\text{new}} - x_{\\eta}^{\\text{new}} y_{\\xi}^{\\text{new}} = (0.95)(1.3875) - (0.05)(-0.2125) = 1.318125 + 0.010625 = 1.32875\n$$\n\n**步骤 4：雅可比行列式的变化**\n\n雅可比行列式的变化量为：\n$$\n\\Delta J = J^{\\text{new}} - J^{\\text{old}} = 1.32875 - 1.365 = -0.03625\n$$\n所有坐标的单位均为米，参数坐标是无量纲的。因此，雅可比行列式及其变化量 $\\Delta J$ 的单位是平方米 ($\\mathrm{m}^2$)。问题要求将结果四舍五入到四位有效数字。计算出的值 $-0.03625$ 已经有四位有效数字。",
            "answer": "$$\n\\boxed{-0.03625}\n$$"
        },
        {
            "introduction": "对于实际工程中的复杂网格，逐一手动检查单元质量是不现实的，因此需要自动化的评估工具。本练习旨在让你开发一个自动化程序，用于评估整个结构化网格的质量，并识别需要改进的区域。你将为每个单元计算雅可比行列式，并实现一个归一化变异指標 $S_i$，从而能够自动标记出那些因扭曲、接近塌陷或与邻近单元尺寸差异过大而需要平滑处理的单元。",
            "id": "3327113",
            "problem": "给定一个由二维四边形单元或三维六面体单元组成的网格。任务是为每个单元计算其在参数中心的带符号雅可比行列式，并利用这些行列式的空间变化来识别应重点进行网格平滑的区域。背景是计算流体动力学（CFD），其中网格质量直接影响数值稳定性和准确性。假设网格是等参数的，这意味着从参考单元到物理单元的映射使用的插值函数与表示场变量所用的插值函数相同。\n\n从基本原理出发，考虑等参数映射和双线性或三线性形函数：\n- 对于四边形单元，参考参数坐标为 $(\\xi,\\eta)\\in[-1,1]^2$。等参数映射为 $\\mathbf{x}(\\xi,\\eta)=\\sum_{i=1}^{4} N_i(\\xi,\\eta) \\mathbf{x}_i$，其中 $\\mathbf{x}_i\\in\\mathbb{R}^2$ 是四个顶点的物理坐标，而 $N_i(\\xi,\\eta)=\\frac{1}{4}(1+\\xi_i \\xi)(1+\\eta_i \\eta)$ 是双线性形函数。在参数中心 $(\\xi,\\eta)=(0,0)$ 处，导数为 $\\frac{\\partial N_i}{\\partial \\xi}=\\frac{1}{4}\\xi_i$ 和 $\\frac{\\partial N_i}{\\partial \\eta}=\\frac{1}{4}\\eta_i$，其中 $(\\xi_i,\\eta_i)\\in\\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$ 是局部角点符号。中心的雅可比矩阵为\n$$\nJ=\\begin{bmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}\n\\end{bmatrix}, \\quad \\text{其中} \\quad \n\\frac{\\partial x}{\\partial \\xi}=\\sum_{i=1}^{4}\\frac{\\partial N_i}{\\partial \\xi} x_i, \\quad\n\\frac{\\partial x}{\\partial \\eta}=\\sum_{i=1}^{4}\\frac{\\partial N_i}{\\partial \\eta} x_i,\n$$\n$\\frac{\\partial y}{\\partial \\xi}$ 和 $\\frac{\\partial y}{\\partial \\eta}$ 也类似。中心的带符号雅可比行列式是 $J_c=\\det(J)$。负的 $J_c$ 表示局部反转（方向翻转），接近于零的 $|J_c|$ 表示可能的塌陷或严重扭曲。\n\n- 对于六面体单元，参考参数坐标为 $(\\xi,\\eta,\\zeta)\\in[-1,1]^3$。等参数映射为 $\\mathbf{x}(\\xi,\\eta,\\zeta)=\\sum_{i=1}^{8} N_i(\\xi,\\eta,\\zeta) \\mathbf{x}_i$，其中 $\\mathbf{x}_i\\in\\mathbb{R}^3$ 是八个顶点的物理坐标，而 $N_i(\\xi,\\eta,\\zeta)=\\frac{1}{8}(1+\\xi_i \\xi)(1+\\eta_i \\eta)(1+\\zeta_i \\zeta)$ 是三线性形函数。在 $(\\xi,\\eta,\\zeta)=(0,0,0)$ 处，导数为 $\\frac{\\partial N_i}{\\partial \\xi}=\\frac{1}{8}\\xi_i$，$\\frac{\\partial N_i}{\\partial \\eta}=\\frac{1}{8}\\eta_i$ 和 $\\frac{\\partial N_i}{\\partial \\zeta}=\\frac{1}{8}\\zeta_i$，其中 $(\\xi_i,\\eta_i,\\zeta_i)\\in\\{(-1,-1,-1),(1,-1,-1),(1,1,-1),(-1,1,-1),(-1,-1,1),(1,-1,1),(1,1,1),(-1,1,1)\\}$。中心的雅可比矩阵为\n$$\nJ=\\begin{bmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial x}{\\partial \\zeta} \\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\zeta} \\\\\n\\frac{\\partial z}{\\partial \\xi}  \\frac{\\partial z}{\\partial \\eta}  \\frac{\\partial z}{\\partial \\zeta}\n\\end{bmatrix}, \\quad \\text{且} \\quad J_c=\\det(J).\n$$\n同样，负的 $J_c$ 表示反转，而小的 $|J_c|$ 表示退化。\n\n为了识别应重点进行平滑的区域，为每个单元 $i$ 定义一个归一化变化指标：\n$$\nS_i=\\frac{|J_i-\\overline{J}_{\\mathcal{N}(i)}|}{|\\overline{J}_{\\mathcal{N}(i)}|+\\delta},\n$$\n其中 $J_i$ 是单元 $i$ 中心的带符号雅可比行列式，$\\mathcal{N}(i)$ 是在二维中共享一条边（两个公共顶点）或在三维中共享一个面（四个公共顶点）的相邻单元集合，$\\overline{J}_{\\mathcal{N}(i)}$ 是 $J$ 在 $\\mathcal{N}(i)$ 上的算术平均值，$\\delta>0$ 是一个小的正则化常数以避免除以零。如果满足以下任一条件，则应将单元标记为需要平滑：$J_i  0$（反转）、$|J_i|  \\tau_{\\text{det}}$（接近塌陷）或 $S_i\\tau_{\\text{var}}$（高粗糙度）。阈值 $\\tau_{\\text{det}}$ 和 $\\tau_{\\text{var}}$ 将针对每个测试用例提供。\n\n您的程序必须：\n- 使用在 $(\\xi,\\eta,\\zeta)=(0,0,0)$ 处的双线性/三线性形函数导数，精确地在参数中心执行上述计算。\n- 通过比较单元连接关系来构建邻接关系 $\\mathcal{N}(i)$：如果在二维中两个单元共享至少两个顶点，或在三维中共享至少四个顶点，则它们是相邻的。\n- 对于每个测试用例，根据条件 $J_i  0$、$|J_i|  \\tau_{\\text{det}}$ 或 $S_i\\tau_{\\text{var}}$，输出被标记为需要平滑的单元索引列表。索引必须从 $0$ 开始。\n\n测试套件：\n1. 二维四边形网格，规则的 $2\\times 2$ 网格，预期是平滑的。\n   - 节点（无量纲笛卡尔空间坐标）：\n     - $(0,0)$, $(1,0)$, $(2,0)$, $(0,1)$, $(1,1)$, $(2,1)$, $(0,2)$, $(1,2)$, $(2,2)$。\n   - 单元（连接关系，每个单元包含4个按常规局部顺序排列的顶点索引）：$[0,1,4,3]$, $[1,2,5,4]$, $[3,4,7,6]$, $[4,5,8,7]$。\n   - 阈值：$\\tau_{\\text{det}}=0.05$, $\\tau_{\\text{var}}=0.3$, $\\delta=10^{-12}$。\n   - 预期结果：没有单元被标记。\n2. 二维单个四边形单元，在中心处被人为反转。\n   - 节点：$(0,0)$, $(1,0)$, $(0,-1)$, $(0,1)$。\n   - 单个单元连接关系：$[0,1,2,3]$。\n   - 阈值：$\\tau_{\\text{det}}=0.01$, $\\tau_{\\text{var}}=0.2$, $\\delta=10^{-12}$。\n   - 预期结果：由于中心的带符号雅可比行列式为负，单个单元被标记。\n3. 三维链条，包含三个沿 $x$ 轴排列的六面体单元，其顶面逐渐塌陷（无量纲笛卡尔空间）。\n   - $x$ 方向上的平面：$x\\in\\{0,1,2,3\\}$；$y$ 方向上的平面：$y\\in\\{0,1\\}$。\n   - 底部 $z$ 平面：对于所有 $x$，$z=0$。\n   - 每个 $x$ 平面的顶部 $z$ 高度：$z_{\\text{top}}(0)=1$, $z_{\\text{top}}(1)=1$, $z_{\\text{top}}(2)=0.5$, $z_{\\text{top}}(3)=0.02$。\n   - 单元（每个单元包含8个按常规局部顺序排列的顶点索引，由上述网格构建）：\n     - 单元 $0$：跨越 $x\\in[0,1]$，连接关系为 $[b(0,0),b(1,0),b(1,1),b(0,1),t(0,0),t(1,0),t(1,1),t(0,1)]$，其中 $b(i,j)$ 表示位于 $(x_i,y_j,z=0)$ 的底部节点，而 $t(i,j)$ 表示位于 $(x_i,y_j,z=z_{\\text{top}}(x_i))$ 的顶部节点。\n     - 单元 $1$：跨越 $x\\in[1,2]$，连接关系为 $[b(1,0),b(2,0),b(2,1),b(1,1),t(1,0),t(2,0),t(2,1),t(1,1)]$。\n     - 单元 $2$：跨越 $x\\in[2,3]$，连接关系为 $[b(2,0),b(3,0),b(3,1),b(2,1),t(2,0),t(3,0),t(3,1),t(2,1)]$。\n   - 阈值：$\\tau_{\\text{det}}=0.04$, $\\tau_{\\text{var}}=0.3$, $\\delta=10^{-12}$。\n   - 预期结果：边界单元和塌陷单元因高变化和接近塌陷而被标记。\n   \n最终输出格式：\n您的程序应生成单行输出，其中包含结果，格式为包含在方括号中的逗号分隔列表（例如，$[result_1,result_2,result_3]$），其中 $result_k$ 是测试用例 $k$ 的被标记单元索引列表。对于提供的测试套件，输出必须是每个用例的整数列表，并汇总到单行中。不应打印任何其他文本。",
            "solution": "该问题要求评估二维四边形和三维六面体单元的计算网格质量。质量评估基于每个单元参数中心的带符号雅可比行列式及其在整个网格中的变化。该方法论坚实地植根于连续介质力学和有限元方法的原理，并应用于计算流体动力学（CFD）中。\n\n首先，我们建立理论基础。问题陈述网格单元是等参数的。这意味着从一个规范的参考单元（参数坐标 $(\\xi, \\eta, \\zeta)$ 中的正方形或立方体）到物理单元（笛卡尔坐标 $\\mathbf{x}=(x,y,z)$ 中）的几何映射是由用于插值单元内场变量的相同形函数 $N_i$ 定义的。该映射由 $\\mathbf{x}(\\xi,\\eta,\\zeta) = \\sum_{i} N_i(\\xi,\\eta,\\zeta) \\mathbf{x}_i$ 给出，其中 $\\mathbf{x}_i$ 是物理单元顶点的坐标。\n\n此映射引入的局部扭曲和缩放由雅可比矩阵 $J$ 来量化，该矩阵包含物理坐标相对于参数坐标的偏导数。对于一个三维六面体单元，其形式为：\n$$\nJ = \\frac{\\partial(x,y,z)}{\\partial(\\xi,\\eta,\\zeta)} = \\begin{bmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial x}{\\partial \\zeta} \\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\zeta} \\\\\n\\frac{\\partial z}{\\partial \\xi}  \\frac{\\partial z}{\\partial \\eta}  \\frac{\\partial z}{\\partial \\zeta}\n\\end{bmatrix}\n$$\n该矩阵的项通过对映射方程求导得到：$\\frac{\\partial x}{\\partial \\xi} = \\sum_i \\frac{\\partial N_i}{\\partial \\xi} x_i$，其他所有分量也依此类推。对于双线性（2D）和三线性（3D）形函数，在参数中心 $(\\xi,\\eta,\\zeta)=(0,0,0)$ 处，计算会显著简化。在此位置，形函数的导数只是与局部顶点编号 $(\\xi_i, \\eta_i, \\zeta_i)$（即 $\\pm 1$ 的组合）相关的常数。具体来说，对于一个三维六面体的顶点 $i$：\n$$\n\\left. \\frac{\\partial N_i}{\\partial \\xi} \\right|_{(0,0,0)} = \\frac{1}{8}\\xi_i, \\quad \\left. \\frac{\\partial N_i}{\\partial \\eta} \\right|_{(0,0,0)} = \\frac{1}{8}\\eta_i, \\quad \\left. \\frac{\\partial N_i}{\\partial \\zeta} \\right|_{(0,0,0)} = \\frac{1}{8}\\zeta_i\n$$\n2D情况是类似的，其形函数为 $N_i(\\xi,\\eta)=\\frac{1}{4}(1+\\xi_i \\xi)(1+\\eta_i \\eta)$，从而得到导数如 $\\left. \\frac{\\partial N_i}{\\partial \\xi} \\right|_{(0,0)} = \\frac{1}{4}\\xi_i$。\n\n雅可比矩阵的行列式 $\\det(J)$ 表示映射的体积（在2D中为面积）缩放因子。正行列式 $J_c = \\det(J)  0$ 表示映射保留了单元的局部方向。负行列式表示局部反转（一个“缠结”或“内外翻转”的单元），这在物理上是无效的，在计算上是灾难性的。接近于零的行列式表明单元高度扭曲或塌陷，可能导致严重的数值不准确性。\n\n质量评估的第二部分涉及网格平滑度。单元尺寸或形状的突变会降低数值方案的准确性。我们使用归一化变化指标 $S_i$ 来量化每个单元 $i$ 的这种“粗糙度”：\n$$\nS_i=\\frac{|J_i-\\overline{J}_{\\mathcal{N}(i)}|}{|\\overline{J}_{\\mathcal{N}(i)}|+\\delta}\n$$\n此处，$J_i$ 是单元自身的中心雅可比行列式，$\\mathcal{N}(i)$ 是其面或边相邻的邻居集合，$\\overline{J}_{\\mathcal{N}(i)}$ 是该邻域上雅可比行列式的平均值，$\\delta$ 是一个正则化参数以防止除以零。较大的 $S_i$ 值表明一个单元在体积或扭曲程度上与其直接邻居有显著差异，标志着一个网格质量差的区域。\n\n识别需要平滑的单元的算法如下：\n1.  **读取网格数据**：输入每个测试用例的节点坐标和单元连接关系。\n2.  **计算雅可比行列式**：对每个单元，计算其参数中心的带符号雅可比行列式 $J_i$。这涉及使用提供的公式和顶点坐标组装雅可比矩阵 $J$，然后计算其行列式。这些计算可以使用矩阵运算高效地向量化。\n3.  **建立邻接关系**：确定每个单元 $i$ 的邻域 $\\mathcal{N}(i)$。这通过比较所有单元对的顶点连接列表来完成。如果两个单元共享足够数量的顶点（2D边至少两个，3D面至少四个），则它们是邻居。\n4.  **应用标记标准**：遍历每个单元 $i$ 并应用三个指定条件：\n    a. 检查反转：$J_i  0$。\n    b. 检查接近塌陷：$|J_i|  \\tau_{\\text{det}}$。\n    c. 检查高变化：如果单元有邻居，则计算 $S_i$ 并检查是否 $S_i  \\tau_{\\text{var}}$。\n5.  **输出结果**：任何满足一个或多个这些条件的单元都将被标记为需要平滑。最终输出是每个测试用例中这些被标记单元的0索引列表。这为有针对性的网格改进提供了量化且可操作的基础。",
            "answer": "[[],[0],[0,2]]"
        },
        {
            "introduction": "尽管拉普拉斯平滑等迭代方法简单易行，但它们无法保证在平滑网格的同时不牺牲其他重要的质量属性，甚至可能产生无效单元。一种更稳健的思路是将网格改进视为一个带约束的优化问题。本练习通过一个简化的一维案例，引导你应用Karush–Kuhn–Tucker (KKT) 条件来求解一个优化问题，即在满足最小单元尺寸约束的前提下，找到最优的节点位置以最小化平滑度目标函数。",
            "id": "3327114",
            "problem": "考虑一个一维线段，其固定的边界节点位于位置 $x_0=0$ 和 $x_2=L$，还有一个位于位置 $x_1=x\\in(0,L)$ 的单个内部节点，你可以移动该节点以改善计算流体动力学 (CFD) 的网格光滑度。通过比较两个相邻单元的长度 $h_1=x-x_0$ 和 $h_2=x_2-x$，构建一个简单的光滑度目标函数，该函数惩罚相邻单元尺寸的不均匀性。假设一个外部偏置，代表来自背景解特征的对齐压力，通过一个预设参数 $\\delta\\in\\mathbb{R}$ 使目标平衡发生偏移。于是，光滑度目标函数定义为\n$$\nJ_s(x;\\delta)=\\left[h_1-h_2-\\delta\\right]^2=\\left(2x-L-\\delta\\right)^2.\n$$\n为了保证最低单元质量，施加不等式约束，要求每个单元长度必须超过一个阈值 $\\epsilon0$，即\n$$\nJ_{e,1}(x)=h_1=x-\\epsilon\\ge 0,\\qquad J_{e,2}(x)=h_2=L-x-\\epsilon\\ge 0,\n$$\n这等价于可行区间 $x\\in[\\epsilon,L-\\epsilon]$。将 $J_{e,1}\\ge 0$ 和 $J_{e,2}\\ge 0$ 视为不等式约束，建立以 $x$ 为决策变量、以 $J_s(x;\\delta)$ 为目标函数、以 $J_{e,1}(x)\\ge 0$ 和 $J_{e,2}(x)\\ge 0$ 为约束条件的约束光滑度优化问题。\n\n从约束优化的基本原理出发，推导该问题的 Karush–Kuhn–Tucker (KKT) 条件。然后，根据最优光滑度成本对收紧单元质量阈值 $\\epsilon$ 的敏感性，对拉格朗日乘子进行物理解释。\n\n最后，对于 $L=1$，$\\delta=0.6$ 和 $\\epsilon=0.3$ 的特定情况，计算在最优点处与激活的不等式约束相关的拉格朗日乘子的值。将最终数值表示为无量纲数，并四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是约束优化领域中一个应用于计算网格生成背景下的良定、有科学依据的客观问题。因此，我们可以进行完整解答。\n\n该优化问题是在满足两个不等式约束 $J_{e,1}(x)\\ge 0$ 和 $J_{e,2}(x)\\ge 0$ 的条件下，最小化光滑度目标函数 $J_s(x;\\delta)$。\n目标函数为：\n$$\nJ_s(x) = (2x - L - \\delta)^2\n$$\n不等式约束为：\n$$\nJ_{e,1}(x) = x - \\epsilon \\ge 0\n$$\n$$\nJ_{e,2}(x) = L - x - \\epsilon \\ge 0\n$$\n为了建立 Karush–Kuhn–Tucker (KKT) 条件，标准的做法是将不等式约束表示为 $g_i(x) \\le 0$ 的形式。\n我们定义：\n$$\ng_1(x) = \\epsilon - x \\le 0\n$$\n$$\ng_2(x) = x - L + \\epsilon \\le 0\n$$\n现在问题是在满足 $g_1(x) \\le 0$ 和 $g_2(x) \\le 0$ 的约束下最小化 $J_s(x)$。\n\n### Karush–Kuhn–Tucker (KKT) 条件\n\n该问题的拉格朗日函数 $\\mathcal{L}$ 是通过将目标函数与由拉格朗日乘子 $\\lambda_1$ 和 $\\lambda_2$ 加权的约束条件相加来构建的。\n$$\n\\mathcal{L}(x, \\lambda_1, \\lambda_2) = J_s(x) + \\lambda_1 g_1(x) + \\lambda_2 g_2(x) = (2x - L - \\delta)^2 + \\lambda_1(\\epsilon - x) + \\lambda_2(x - L + \\epsilon)\n$$\nKKT 条件是非线性规划中的解为最优解的一组一阶必要条件，前提是满足某些正则性条件。对于这个凸问题，它们也是充分条件。这些条件是：\n\n1.  **平稳性 (Stationarity)**：拉格朗日函数关于决策变量 $x$ 的梯度在最优点 $x^*$ 处必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial x} \\bigg|_{x=x^*} = 2(2x^* - L - \\delta)(2) - \\lambda_1 + \\lambda_2 = 4(2x^* - L - \\delta) - \\lambda_1 + \\lambda_2 = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)**：最优点 $x^*$ 必须满足所有约束条件。\n    $$\n    g_1(x^*) = \\epsilon - x^* \\le 0 \\quad (\\text{或 } x^* \\ge \\epsilon)\n    $$\n    $$\n    g_2(x^*) = x^* - L + \\epsilon \\le 0 \\quad (\\text{或 } x^* \\le L - \\epsilon)\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)**：与不等式约束相关的拉格朗日乘子必须为非负。\n    $$\n    \\lambda_1 \\ge 0\n    $$\n    $$\n    \\lambda_2 \\ge 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)**：每个拉格朗日乘子与其对应的约束函数之积必须为零。这意味着如果一个约束是非激活的（即不等式是严格的），其乘子必须为零。\n    $$\n    \\lambda_1 g_1(x^*) = \\lambda_1(\\epsilon - x^*) = 0\n    $$\n    $$\n    \\lambda_2 g_2(x^*) = \\lambda_2(x^* - L + \\epsilon) = 0\n    $$\n\n### 拉格朗日乘子的物理解释\n\n拉格朗日乘子具有与敏感性分析相关的重要的物理解释。设目标函数的最优值为 $J_{opt}(\\epsilon) = J_s(x^*(\\epsilon))$，其中 $x^*(\\epsilon)$ 是给定阈值 $\\epsilon$ 下的最优解。在最优点处的拉格朗日乘子 $\\lambda_1^*$ 和 $\\lambda_2^*$ 衡量了最优成本 $J_{opt}$ 对约束扰动的敏感性。\n\n根据包络定理 (Envelope Theorem)，最优值函数关于参数 $\\epsilon$ 的导数由拉格朗日函数关于 $\\epsilon$ 的偏导数在最优点 $(x^*, \\lambda_1^*, \\lambda_2^*)$ 处的值给出。\n$$\n\\frac{d J_{opt}}{d \\epsilon} = \\frac{\\partial \\mathcal{L}}{\\partial \\epsilon} \\bigg|_{(x^*, \\lambda_1^*, \\lambda_2^*)}\n$$\n拉格朗日函数为 $\\mathcal{L}(x, \\lambda_1, \\lambda_2; \\epsilon) = (2x-L-\\delta)^2 + \\lambda_1(\\epsilon-x) + \\lambda_2(x-L+\\epsilon)$。\n其关于 $\\epsilon$ 的偏导数为：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\epsilon} = \\lambda_1 + \\lambda_2\n$$\n因此，在最优点处：\n$$\n\\frac{d J_{opt}}{d \\epsilon} = \\lambda_1^* + \\lambda_2^*\n$$\n这个关系表明，最优拉格朗日乘子之和表示当单元质量阈值 $\\epsilon$ 被收紧（即增加）时，最小可能的光滑度成本 $J_s$ 增加的速率。$\\lambda_1^*$ 是对下界 $x \\ge \\epsilon$ 移动的敏感性，而 $\\lambda_2^*$ 是对上界 $x \\le L-\\epsilon$ 移动的敏感性。一个非零的乘子 $\\lambda_i^*$ 表明对应的约束是激活的，并且正在为优化带来“成本”，阻止目标函数达到一个更有利的值。\n\n### 特定情况的计算\n\n给定具体数值：$L=1$，$\\delta=0.6$，以及 $\\epsilon=0.3$。\n\n首先，我们确定决策变量 $x$ 的可行域。约束条件是：\n$x \\ge \\epsilon \\implies x \\ge 0.3$。\n$x \\le L - \\epsilon \\implies x \\le 1 - 0.3 = 0.7$。\n可行区间是 $x \\in [0.3, 0.7]$。\n\n接下来，我们分析目标函数：\n$J_s(x) = (2x - 1 - 0.6)^2 = (2x - 1.6)^2$。\n为了找到无约束最小值，我们将其导数设为零：\n$\\frac{dJ_s}{dx} = 2(2x - 1.6)(2) = 8x - 12.8 = 0$。\n这给出了无约束最小化点 $x_{unc} = \\frac{12.8}{8} = 1.6$。\n\n无约束最小化点 $x_{unc} = 1.6$ 位于可行区间 $[0.3, 0.7]$ 之外。目标函数 $J_s(x)$ 是一个顶点在 $x=1.6$ 的凸抛物线。在闭区间上，这种函数的最小值必然出现在离顶点最近的边界点。从 $x=0.3$ 到 $x=1.6$ 的距离是 $|1.6-0.3|=1.3$。从 $x=0.7$ 到 $x=1.6$ 的距离是 $|1.6-0.7|=0.9$。更近的边界点是 $x=0.7$。因此，约束最优解是 $x^* = 0.7$。\n\n现在，我们必须找到与激活约束相关的拉格朗日乘子。在 $x^*=0.7$ 处：\n- 第一个约束 $x \\ge 0.3$ 得到满足，因为 $0.7  0.3$。此约束为非激活。\n- 第二个约束 $x \\le 0.7$ 得到满足，因为 $0.7=0.7$。此约束为**激活**。\n\n根据互补松弛性条件：\n- 由于 $g_1(x^*) = \\epsilon - x^* = 0.3 - 0.7 = -0.4 \\ne 0$（非激活），其乘子必须为零：$\\lambda_1 = 0$。\n- 由于 $g_2(x^*) = x^* - L + \\epsilon = 0.7 - 1 + 0.3 = 0$（激活），其乘子 $\\lambda_2$ 可以为非零。\n\n我们使用平稳性条件来求解 $\\lambda_2$：\n$4(2x^* - L - \\delta) - \\lambda_1 + \\lambda_2 = 0$。\n代入已知值 $x^*=0.7$, $L=1$, $\\delta=0.6$, 和 $\\lambda_1=0$：\n$4(2(0.7) - 1 - 0.6) - 0 + \\lambda_2 = 0$。\n$4(1.4 - 1.6) + \\lambda_2 = 0$。\n$4(-0.2) + \\lambda_2 = 0$。\n$-0.8 + \\lambda_2 = 0$。\n这得出 $\\lambda_2 = 0.8$。\n\n对偶可行性条件 $\\lambda_1=0 \\ge 0$ 和 $\\lambda_2=0.8 \\ge 0$ 得到满足。\n激活的约束是 $J_{e,2}(x)\\ge 0$（对应于 $g_2(x)\\le 0$），其相关的拉格朗日乘子是 $\\lambda_2 = 0.8$。\n\n四舍五入到四位有效数字，该值为 $0.8000$。",
            "answer": "$$\\boxed{0.8000}$$"
        }
    ]
}