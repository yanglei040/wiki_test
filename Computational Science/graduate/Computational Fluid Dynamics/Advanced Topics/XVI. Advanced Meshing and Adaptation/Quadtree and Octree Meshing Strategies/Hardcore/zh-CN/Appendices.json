{
    "hands_on_practices": [
        {
            "introduction": "在四叉树和八叉树网格中，一个核心挑战是如何处理不同加密等级交界处的“悬挂节点”。为了确保有限体积法的严格守恒性，跨越粗细网格界面的通量必须是唯一的。本练习将指导您设计一个二阶精度的通量重构格式，它能保证在加密界面上通量守恒，这是开发和使用自适应网格加密（AMR）代码的一项基本技能。",
            "id": "3355466",
            "problem": "考虑一个二维计算流体动力学 (CFD) 问题，其中无源标量场 $u(x,y,t)$ 的输运由一个线性平流方程控制，速度场为常数 $\\boldsymbol{v} = (v_{n}, 0)$。因此，穿过一个垂直面的法向平流通量密度为 $q(y) = v_{n} \\, u(y)$，其中 $v_{n}$ 是 $\\boldsymbol{v}$ 的恒定法向分量。在单元中心有限体积法 (FVM) 中，通过一个面的通量是法向通量密度沿该面的积分。现在考虑一个自适应网格加密 (AMR) 四叉树，其中一个长度为 $h$ 的单个粗糙垂直面与两个精细子单元相邻，因此粗糙面被分裂成两个长度各为 $h/2$ 的相等精细子面，在子面的中点处有悬挂节点。设横向坐标 $y$ 沿面测量，原点位于粗糙面的形心，其范围为 $y \\in [-h/2, h/2]$。两个精细子面的形心位于 $y_{-} = -h/4$ 和 $y_{+} = +h/4$，粗糙面的形心位于 $y_{0} = 0$。\n\n为了保证两个精细兄弟单元之间的法向通量相等，并确保跨层级的守恒达到机器精度，您的任务是设计一个单一的共享法向通量密度 $q^{\\star}$，它将相同地应用于两个精细子面，使得通过粗糙面的总通量等于通过两个精细子面的通量之和。假设在两个层级上都对 $u$ 进行二阶单元中心重构，并分别将样本 $u_{-} = u(y_{-})$, $u_{0} = u(y_{0})$ 和 $u_{+} = u(y_{+})$ 定义为在子面形心和粗糙面形心处的重构值。您的目标是确定无量纲常数权重 $w_{-}$, $w_{0}$, $w_{+}$，使得共享通量密度\n$$\nq^{\\star} \\;=\\; v_{n} \\,\\big( w_{-}\\,u_{-} \\;+\\; w_{0}\\,u_{0} \\;+\\; w_{+}\\,u_{+} \\big)\n$$\n在误差与二阶有限体积格式一致的情况下，逼近 $q(y)$ 的面平均值，同时严格对两个兄弟单元强制使用单一法向通量值。\n\n从守恒的积分形式和面平均通量的定义出发，通过要求 $q^{\\star}$ 对于次数最高为 2 的任意多项式 $u(y)$ 都能精确再现 $q(y)$ 的面平均值，来确定权重 $w_{-}$、$w_{0}$ 和 $w_{+}$。请将最终答案表示为包含 $(w_{-}, w_{0}, w_{+})$ 的单行矩阵。最终答案无需四舍五入，也无需单位。",
            "solution": "该问题要求确定三个无量纲权重 $w_{-}$、$w_{0}$ 和 $w_{+}$，用于在基于四叉树的自适应网格中，一个粗糙单元和两个精细单元之间的界面上，构造一个共享的法向通量密度 $q^{\\star}$。该构造必须确保通量守恒并保持一定的精度阶数。\n\n首先，我们建立通量守恒的基本条件。在单元中心有限体积法中，通过一个面的通量是法向通量密度在该面上的积分。问题考虑一个长度为 $h$ 的粗糙面被细分为两个长度各为 $h/2$ 的精细子面。一个单一的共享通量密度 $q^{\\star}$ 将用于两个精细子面。\n\n通过粗糙面的总通量 $F_{\\text{coarse}}$ 由通量密度 $q(y) = v_{n} u(y)$ 在粗糙面区间 $y \\in [-h/2, h/2]$ 上的积分给出：\n$$\nF_{\\text{coarse}} = \\int_{-h/2}^{h/2} q(y) \\, dy = v_n \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n使用共享的恒定通量密度 $q^{\\star}$，通过两个精细子面的通量之和 $F_{\\text{fine}}$ 为：\n$$\nF_{\\text{fine}} = q^{\\star} \\times (\\text{length of subface 1}) + q^{\\star} \\times (\\text{length of subface 2}) = q^{\\star} \\left(\\frac{h}{2}\\right) + q^{\\star} \\left(\\frac{h}{2}\\right) = q^{\\star} h\n$$\n守恒原理要求总通量在加密界面上是守恒的，即 $F_{\\text{coarse}} = F_{\\text{fine}}$。\n$$\nv_n \\int_{-h/2}^{h/2} u(y) \\, dy = q^{\\star} h\n$$\n这意味着共享通量密度 $q^{\\star}$ 必须等于粗糙面上的面平均通量密度：\n$$\nq^{\\star} = \\frac{v_n}{h} \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n问题给出了 $q^{\\star}$ 以标量场 $u(y)$ 的三个采样值表示的显式公式：\n$$\nq^{\\star} = v_{n} \\left( w_{-}\\,u_{-} + w_{0}\\,u_{0} + w_{+}\\,u_{+} \\right)\n$$\n其中 $u_{-} = u(y_{-}) = u(-h/4)$，$u_{0} = u(y_{0}) = u(0)$，以及 $u_{+} = u(y_{+}) = u(h/4)$。\n\n结合 $q^{\\star}$ 的这两个表达式，并假设平流速度 $v_n$ 非零，我们得到关于权重的核心方程：\n$$\nw_{-}\\,u(-h/4) + w_{0}\\,u(0) + w_{+}\\,u(h/4) = \\frac{1}{h} \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n此方程必须对任意次数至多为2的多项式 $u(y)$ 成立。为了求出三个未知权重 $w_{-}$、$w_{0}$ 和 $w_{+}$，我们将对次数至多为2的多项式向量空间的一组基 $\\{1, y, y^2\\}$ 强制施加此条件。一个方便的基是 $\\{1, y, y^2\\}$。\n\n情况 1: $u(y) = 1$ (0次)\n采样值为 $u(-h/4) = 1$，$u(0) = 1$ 和 $u(h/4) = 1$。方程的左侧 (LHS) 变为：\n$$\n\\text{LHS} = w_{-}(1) + w_{0}(1) + w_{+}(1) = w_{-} + w_{0} + w_{+}\n$$\n右侧 (RHS) 是 $u(y)=1$ 在该区间上的平均值：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} 1 \\, dy = \\frac{1}{h} [y]_{-h/2}^{h/2} = \\frac{1}{h} \\left(\\frac{h}{2} - \\left(-\\frac{h}{2}\\right)\\right) = 1\n$$\n这给出了我们的第一个线性方程：\n$$\nw_{-} + w_{0} + w_{+} = 1 \\quad (1)\n$$\n\n情况 2: $u(y) = y$ (1次)\n采样值为 $u(-h/4) = -h/4$，$u(0) = 0$ 和 $u(h/4) = h/4$。LHS 变为：\n$$\n\\text{LHS} = w_{-}\\left(-\\frac{h}{4}\\right) + w_{0}(0) + w_{+}\\left(\\frac{h}{4}\\right) = \\frac{h}{4}(-w_{-} + w_{+})\n$$\nRHS 是奇函数 $u(y)=y$ 在对称区间上的平均值，结果为零：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} y \\, dy = \\frac{1}{h} \\left[\\frac{y^2}{2}\\right]_{-h/2}^{h/2} = \\frac{1}{2h} \\left(\\left(\\frac{h}{2}\\right)^2 - \\left(-\\frac{h}{2}\\right)^2\\right) = 0\n$$\n因为 $h \\neq 0$，得到的方程是：\n$$\n-w_{-} + w_{+} = 0 \\implies w_{-} = w_{+} \\quad (2)\n$$\n\n情况 3: $u(y) = y^2$ (2次)\n采样值为 $u(-h/4) = (-h/4)^2 = h^2/16$，$u(0) = 0^2 = 0$ 和 $u(h/4) = (h/4)^2 = h^2/16$。LHS 变为：\n$$\n\\text{LHS} = w_{-}\\left(\\frac{h^2}{16}\\right) + w_{0}(0) + w_{+}\\left(\\frac{h^2}{16}\\right) = \\frac{h^2}{16}(w_{-} + w_{+})\n$$\nRHS 是 $u(y)=y^2$ 的平均值：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} y^2 \\, dy = \\frac{1}{h} \\left[\\frac{y^3}{3}\\right]_{-h/2}^{h/2} = \\frac{1}{3h} \\left(\\left(\\frac{h}{2}\\right)^3 - \\left(-\\frac{h}{2}\\right)^3\\right) = \\frac{1}{3h} \\left(\\frac{h^3}{8} + \\frac{h^3}{8}\\right) = \\frac{2h^3}{24h} = \\frac{h^2}{12}\n$$\n令 LHS 和 RHS 相等，并消去 $h^2$ 项 (因为 $h \\neq 0$)：\n$$\n\\frac{1}{16}(w_{-} + w_{+}) = \\frac{1}{12} \\implies w_{-} + w_{+} = \\frac{16}{12} = \\frac{4}{3} \\quad (3)\n$$\n\n现在我们求解关于 $w_{-}$、$w_{0}$ 和 $w_{+}$ 的三元线性方程组：\n1. $w_{-} + w_{0} + w_{+} = 1$\n2. $w_{-} = w_{+}$\n3. $w_{-} + w_{+} = 4/3$\n\n将方程 (2) 代入 (3)：\n$$\nw_{+} + w_{+} = \\frac{4}{3} \\implies 2w_{+} = \\frac{4}{3} \\implies w_{+} = \\frac{2}{3}\n$$\n由方程 (2) 可得：\n$$\nw_{-} = \\frac{2}{3}\n$$\n最后，将 $w_{-}$ 和 $w_{+}$ 的值代入方程 (1) 求 $w_{0}$：\n$$\n\\frac{2}{3} + w_{0} + \\frac{2}{3} = 1 \\implies w_{0} + \\frac{4}{3} = 1 \\implies w_{0} = 1 - \\frac{4}{3} = -\\frac{1}{3}\n$$\n因此，所需的权重为 $w_{-} = 2/3$，$w_{0} = -1/3$ 和 $w_{+} = 2/3$。问题要求以单行矩阵 $(w_{-}, w_{0}, w_{+})$ 的形式给出答案。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  \\frac{2}{3} \\end{pmatrix}}$$"
        },
        {
            "introduction": "浸入边界法（Immersed Boundary Method）是在笛卡尔网格（如四叉树/八叉树）上处理复杂几何的强大工具，但它也带来了独特的数值挑战。当物理边界切割网格单元时，可能会产生体积非常小的“小单元”（cut-cells），这会对显式时间积分格式的稳定性构成严峻考验。本练习旨在通过分析CFL条件，从第一性原理揭示为何这些小单元会严重限制稳定时间步长，帮助您理解和应对这一在实践中至关重要的问题。",
            "id": "3355418",
            "problem": "考虑二维常系数线性平流方程 $\\partial_{t} q + \\nabla \\cdot (\\mathbf{u}\\, q) = 0$，其中速度 $\\mathbf{u} = (u_{x}, u_{y})$ 为常数，作用于一个四叉树网格上。四叉树的叶节点是边长为 $h$ 的轴对齐正方形。该方程采用一阶有限体积法进行离散化，时间积分使用前向欧拉法，数值通量使用迎风格式。一个经过充分检验的事实是，对于任意多边形单元上的此类显式有限体积格式，局部 Courant–Friedrichs–Lewy (CFL) 稳定性条件可以表示为 $\\Delta t \\le \\nu \\, V / \\sum_{f} |\\mathbf{u}\\cdot \\mathbf{n}_{f}|\\,A_{f}$，其中 $V$ 是单元面积，求和项遍历与相邻流体交换通量的所有单元面 $f$，$A_{f}$ 是面长，$\\mathbf{n}_{f}$ 是面 $f$ 的单位法向量，$\\nu \\in (0,1)$ 是 Courant 数。\n\n我们关注一个被笔直的不可穿透固体边界所切割的单一四叉树叶单元。切割在叶单元内部形成了一个小的流体控制体积（一个切割单元）。您可以假设固体边界在切割界面上施加了零法向质量通量，因此只有与流体邻居相邻的面才对通量求和有贡献。\n\n任务 A（稳定性标度）：将 CFL 稳定性界限定制化到切割单元是一个厚度为 $\\varepsilon \\ll h$ 的、与面平行的薄流体条带（sliver）的情况，该流体条带由一个平行于单元某条边的笔直边界产生。设置坐标系，使未切割的正方形为 $\\{(x,y): 0 \\le x \\le h,\\, 0 \\le y \\le h\\}$，不可穿透边界位于直线 $y=\\varepsilon$ 上；流体占据 $\\{(x,y): 0 \\le x \\le h,\\, 0 \\le y \\le \\varepsilon\\}$。从上述基本有限体积 CFL 界限出发，根据第一性原理证明，在此构型下，显式稳定性极限与切割单元面积成线性比例关系，即当 $h$ 固定时，随着 $\\varepsilon \\to 0$，有 $\\Delta t \\propto V_{\\min}$。\n\n任务 B（$V_{\\min}$ 的几何标度）：在两种代表性情况下，推导切割单元面积 $V$ 对切割边界在四叉树叶单元内相对位置的依赖关系：\n- 面平行条带：对于上述构型，用 $h$ 和 $\\varepsilon$ 表示 $V$。\n- 掠角楔形：设边界是一条直线，其与单元左下角的有符号法向距离为 $\\varepsilon$，且其单位法向量与正 x 轴的夹角为 $\\theta \\in (0,\\pi/2)$。此时，流体切割单元是一个直角边沿坐标轴的直角三角形。将 $V$ 表示为 $\\varepsilon$ 和 $\\theta$ 的函数。\n\n最后，对于面平行条带构型，将精确的最大稳定时间步长 $\\Delta t_{\\max}$ 表示为以 $V_{\\min}$、$h$、$|u_{x}|$、$|u_{y}|$ 和 $\\nu$ 表示的封闭形式解析表达式。请提供这个最终表达式。不需要数值；请以符号形式给出表达式。最终答案的表达式内不应包含单位。",
            "solution": "我们从多边形控制体积上双曲守恒律的显式有限体积离散化开始。对于面积为 $V$ 的控制体积，采用一阶迎风通量和前向欧拉时间积分，局部 Courant–Friedrichs–Lewy (CFL) 时间步长限制的一个标准形式是\n$$\n\\Delta t \\le \\nu \\, \\frac{V}{\\sum_{f} |\\lambda_{f}|\\, A_{f}},\n$$\n其中求和遍历所有面 $f$，$A_f$ 是面长，$|\\lambda_f|$ 是垂直于面 $f$ 的最大信号速度。对于速度为 $\\mathbf{u}=(u_{x},u_{y})$ 的常系数线性平流，垂直于面 $f$ 的特征速度是 $|\\lambda_{f}| = |\\mathbf{u}\\cdot \\mathbf{n}_{f}|$。对于不可穿透的固体边界，切割界面上的法向通量为零，因此与固体边界重合的切割面不出现在通量求和中。\n\n任务 A：面平行条带切割单元的特例化及 $\\Delta t$ 随 $V_{\\min}$ 的标度关系。\n\n在一个四叉树叶节点上设置坐标，使得未切割的正方形单元为 $\\{(x,y): 0 \\le x \\le h,\\; 0 \\le y \\le h\\}$，不可穿透边界为直线 $y=\\varepsilon$，其中 $0  \\varepsilon \\ll h$。流体切割单元区域则为 $\\{(x,y): 0\\le x\\le h,\\; 0\\le y\\le \\varepsilon\\}$，这是一个宽为 $h$、高为 $\\varepsilon$ 的矩形。\n\n流体切割单元的面积是\n$$\nV \\;=\\; h \\,\\varepsilon.\n$$\n这个流体条带与流体邻居相邻的面是：位于 $y=0$ 的底面，其外法线为 $\\mathbf{n}=(0,-1)$，长度为 $A_{\\text{bottom}}=h$；以及位于 $x=0$ 和 $x=h$ 的两个垂直侧面，其外法线分别为 $\\mathbf{n}=(-1,0)$ 和 $\\mathbf{n}=(1,0)$，每个面的长度为 $A_{\\text{side}}=\\varepsilon$。位于 $y=\\varepsilon$ 的顶面是不可穿透的（固体边界），因此在这个壁面法向速度设为零的线性平流模型中，它没有通量贡献。\n\n因此，CFL 界限分母中的通量求和为\n$$\n\\sum_{f} |\\mathbf{u}\\cdot \\mathbf{n}_{f}|\\,A_{f}\n\\;=\\;\n|\\mathbf{u}\\cdot(0,-1)|\\, h \\;+\\; |\\mathbf{u}\\cdot(-1,0)|\\, \\varepsilon \\;+\\; |\\mathbf{u}\\cdot(1,0)|\\, \\varepsilon\n\\;=\\;\n|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon.\n$$\n因此，面平行条带的精确局部稳定性极限是\n$$\n\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon}\n\\;=\\;\n\\nu \\, \\frac{h\\,\\varepsilon}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon}.\n$$\n当 $h$ 和 $|u_{x}|, |u_{y}|$ 固定时，随着 $\\varepsilon \\to 0$，分母由 $|u_{y}|\\, h$ 项主导，给出渐近标度关系\n$$\n\\Delta t_{\\max} \\;\\sim\\; \\nu \\, \\frac{h\\,\\varepsilon}{|u_{y}|\\, h} \\;=\\; \\nu \\, \\frac{\\varepsilon}{|u_{y}|}.\n$$\n由于 $V = h\\,\\varepsilon$，这个渐进行为等价于\n$$\n\\Delta t_{\\max} \\;\\sim\\; \\nu \\, \\frac{V}{|u_{y}|\\, h},\n$$\n这表明在薄条带极限下，显式稳定性极限与切割单元面积 $V$ 成正比。这证实了在存在面平行条带切割单元的情况下，显式时间步进方法为了保持稳定可能需要 $\\Delta t \\propto V_{\\min}$ 的论断。\n\n任务 B：$V_{\\min}$ 随边界在四叉树叶单元内位置的几何标度关系。\n\n我们推导在四叉树正方形内两种代表性的直边界放置方式下的面积标度关系。\n\n面平行条带：如上所述，一个与单元边平行且距离为 $\\varepsilon$ 的边界会产生一个高为 $\\varepsilon$、宽为 $h$ 的矩形流体区域，因此\n$$\nV(\\varepsilon; \\text{parallel to face}) \\;=\\; h\\,\\varepsilon,\n$$\n这与到面的距离 $\\varepsilon$ 呈线性关系。\n\n掠角楔形：考虑位于正方形原点 $(0,0)$ 的左下角。设边界为一条直线，其单位法向量为 $\\mathbf{n}=(\\cos\\theta,\\sin\\theta)$，其中 $\\theta \\in (0,\\pi/2)$，且该直线与原点的有符号法向距离为 $\\varepsilon0$，因此直线方程为 $\\mathbf{n}\\cdot \\mathbf{x} = \\varepsilon$。通过设置 $y=0$，可求得该直线与 x 轴的截距为 $x = \\varepsilon/\\cos\\theta$。同样，与 y 轴的截距为 $y=\\varepsilon/\\sin\\theta$。对于足够小的 $\\varepsilon$，这些截距位于正方形内，角点附近的流体区域是一个直角三角形，其沿坐标轴的直角边长分别为 $\\varepsilon/\\cos\\theta$ 和 $\\varepsilon/\\sin\\theta$。其面积为\n$$\nV(\\varepsilon,\\theta; \\text{near corner}) \\;=\\; \\frac{1}{2}\\,\\frac{\\varepsilon}{\\cos\\theta}\\,\\frac{\\varepsilon}{\\sin\\theta}\n\\;=\\;\n\\frac{\\varepsilon^{2}}{2\\,\\sin\\theta\\,\\cos\\theta},\n$$\n这与沿边界法线方向到角点的距离 $\\varepsilon$ 呈二次关系。这表明，根据边界在四叉树单元内的相对位置，最小切割单元面积可能与到面的距离成线性关系，或与到角点的距离成二次关系。\n\n以 $V_{\\min}$ 表示的最终表达式：对于面平行条带构型，我们可以直接用 $V_{\\min}$ 表示精确的稳定性极限。使用 $V_{\\min} = h\\,\\varepsilon$，我们消去 $\\varepsilon$ 得到\n$$\n\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V_{\\min}}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, V_{\\min}/h}.\n$$\n此表达式对于所述几何构型是精确的，并且在薄条带极限 $V_{\\min}\\to 0$ 下简化为线性标度关系 $\\Delta t_{\\max} \\sim \\nu\\, V_{\\min}/(|u_{y}|\\, h)$。",
            "answer": "$$\\boxed{\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V_{\\min}}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, V_{\\min}/h}}$$"
        }
    ]
}