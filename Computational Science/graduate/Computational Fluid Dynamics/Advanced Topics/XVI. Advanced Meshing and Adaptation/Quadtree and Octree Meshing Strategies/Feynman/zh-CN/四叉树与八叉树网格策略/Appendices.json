{
    "hands_on_practices": [
        {
            "introduction": "在自适应网格加密（AMR）中，确保粗细网格界面（即存在“悬挂节点”处）的通量守恒，是获得物理上正确模拟结果的重中之重。本练习将演示一种严谨的方法，用于设计一个能够保证守恒并维持二阶精度的通量重构方案。通过解决这个问题，您将深入理解如何在四叉树网格上维护有限体积法的完整性。",
            "id": "3355466",
            "problem": "考虑一个二维计算流体动力学 (CFD) 问题，其中被动标量场 $u(x,y,t)$ 的输运由一个线性平流方程控制，该方程具有恒定的速度场 $\\boldsymbol{v} = (v_{n}, 0)$。因此，穿过一个垂直面的法向平流通量密度为 $q(y) = v_{n} \\, u(y)$，其中 $v_{n}$ 是 $\\boldsymbol{v}$ 的恒定法向分量。在一个以单元为中心的有限体积法 (FVM) 中，通过一个面的通量是该面上法向通量密度的积分。现在考虑一个自适应网格加密 (AMR) 四叉树，其中一个长度为 $h$ 的粗糙垂直面与两个精细子单元相邻，因此该粗糙面被分裂成两个长度各为 $h/2$ 的相等精细子面，悬挂节点位于子面的中点。设横向坐标 $y$ 沿着面测量，原点位于粗糙面的形心，其范围为 $y \\in [-h/2, h/2]$。两个精细子面的形心分别位于 $y_{-} = -h/4$ 和 $y_{+} = +h/4$，粗糙面的形心位于 $y_{0} = 0$。\n\n为了保证两个精细兄弟单元之间的法向通量相等，并在不同层级之间达到机器精度的守恒，您的任务是设计一个单一的共享法向通量密度 $q^{\\star}$，它将相同地应用于两个精细子面，使得通过粗糙面的总通量等于通过两个精细子面的通量之和。假设在两个层级上都对 $u$ 进行二阶格心重构，并将样本 $u_{-} = u(y_{-})$、$u_{0} = u(y_{0})$ 和 $u_{+} = u(y_{+})$ 分别定义为在子面形心和粗糙面形心处的重构值。您的目标是确定恒定的无量纲权重 $w_{-}$、$w_{0}$、$w_{+}$，使得共享通量密度\n$$\nq^{\\star} \\;=\\; v_{n} \\,\\big( w_{-}\\,u_{-} \\;+\\; w_{0}\\,u_{0} \\;+\\; w_{+}\\,u_{+} \\big)\n$$\n以与二阶有限体积格式相符的误差来逼近 $q(y)$ 的面平均值，同时严格地对两个兄弟单元强制使用单一的法向通量值。\n\n从守恒的积分形式和面平均通量的定义出发，通过要求 $q^{\\star}$ 对于任何次数至多为 2 的多项式 $u(y)$ 都能精确再现 $q(y)$ 的面平均值，来确定权重 $w_{-}$、$w_{0}$、$w_{+}$。将您的最终答案表示为包含 $(w_{-}, w_{0}, w_{+})$ 的单行矩阵。最终答案无需四舍五入，也无需单位。",
            "solution": "该问题要求确定三个无量纲权重 $w_{-}$、$w_{0}$ 和 $w_{+}$，用于在基于四叉树的自适应网格中，一个粗糙单元和两个精细单元之间的界面上构建一个共享的法向通量密度 $q^{\\star}$。该构建必须确保通量守恒并保持一定的精度阶数。\n\n首先，我们建立通量守恒的基本条件。在以单元为中心的有限体积法中，通过一个面的通量是该面上法向通量密度的积分。该问题考虑一个长度为 $h$ 的粗糙面，它被细分为两个长度各为 $h/2$ 的精细子面。一个单一的共享通量密度 $q^{\\star}$ 将用于两个精细子面。\n\n通过粗糙面的总通量 $F_{\\text{coarse}}$ 由通量密度 $q(y) = v_{n} u(y)$ 在粗糙面区间 $y \\in [-h/2, h/2]$ 上的积分给出：\n$$\nF_{\\text{coarse}} = \\int_{-h/2}^{h/2} q(y) \\, dy = v_n \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n使用共享的恒定通量密度 $q^{\\star}$，通过两个精细子面的通量之和 $F_{\\text{fine}}$ 为：\n$$\nF_{\\text{fine}} = q^{\\star} \\times (\\text{子面1的长度}) + q^{\\star} \\times (\\text{子面2的长度}) = q^{\\star} \\left(\\frac{h}{2}\\right) + q^{\\star} \\left(\\frac{h}{2}\\right) = q^{\\star} h\n$$\n守恒原理要求总通量在加密界面上是守恒的，即 $F_{\\text{coarse}} = F_{\\text{fine}}$。\n$$\nv_n \\int_{-h/2}^{h/2} u(y) \\, dy = q^{\\star} h\n$$\n这意味着共享通量密度 $q^{\\star}$ 必须等于粗糙面上的面平均通量密度：\n$$\nq^{\\star} = \\frac{v_n}{h} \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n问题提供了一个用标量场 $u(y)$ 的三个采样值表示 $q^{\\star}$ 的显式公式：\n$$\nq^{\\star} = v_{n} \\left( w_{-}\\,u_{-} + w_{0}\\,u_{0} + w_{+}\\,u_{+} \\right)\n$$\n其中 $u_{-} = u(y_{-}) = u(-h/4)$，$u_{0} = u(y_{0}) = u(0)$，以及 $u_{+} = u(y_{+}) = u(h/4)$。\n\n结合 $q^{\\star}$ 的这两个表达式，并假设平流速度 $v_n$ 非零，我们得到关于权重的核心方程：\n$$\nw_{-}\\,u(-h/4) + w_{0}\\,u(0) + w_{+}\\,u(h/4) = \\frac{1}{h} \\int_{-h/2}^{h/2} u(y) \\, dy\n$$\n该方程必须对任何次数至多为 2 的多项式 $u(y)$ 成立。为了求出三个未知权重 $w_{-}$、$w_{0}$ 和 $w_{+}$，我们将对次数至多为 2 的多项式向量空间的一组基强制执行此条件。一组方便的基是 $\\{1, y, y^2\\}$。\n\n情况1：$u(y) = 1$ (0次)\n采样值为 $u(-h/4) = 1$，$u(0) = 1$ 和 $u(h/4) = 1$。方程的左侧 (LHS) 变为：\n$$\n\\text{LHS} = w_{-}(1) + w_{0}(1) + w_{+}(1) = w_{-} + w_{0} + w_{+}\n$$\n右侧 (RHS) 是 $u(y)=1$ 在该区间上的平均值：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} 1 \\, dy = \\frac{1}{h} [y]_{-h/2}^{h/2} = \\frac{1}{h} \\left(\\frac{h}{2} - \\left(-\\frac{h}{2}\\right)\\right) = 1\n$$\n这给出了我们的第一个线性方程：\n$$\nw_{-} + w_{0} + w_{+} = 1 \\quad (1)\n$$\n\n情况2：$u(y) = y$ (1次)\n采样值为 $u(-h/4) = -h/4$，$u(0) = 0$ 和 $u(h/4) = h/4$。LHS 变为：\n$$\n\\text{LHS} = w_{-}\\left(-\\frac{h}{4}\\right) + w_{0}(0) + w_{+}\\left(\\frac{h}{4}\\right) = \\frac{h}{4}(-w_{-} + w_{+})\n$$\nRHS 是奇函数 $u(y)=y$ 在对称区间上的平均值，结果为零：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} y \\, dy = \\frac{1}{h} \\left[\\frac{y^2}{2}\\right]_{-h/2}^{h/2} = \\frac{1}{2h} \\left(\\left(\\frac{h}{2}\\right)^2 - \\left(-\\frac{h}{2}\\right)^2\\right) = 0\n$$\n因为 $h \\neq 0$，得到的方程是：\n$$\n-w_{-} + w_{+} = 0 \\implies w_{-} = w_{+} \\quad (2)\n$$\n\n情况3：$u(y) = y^2$ (2次)\n采样值为 $u(-h/4) = (-h/4)^2 = h^2/16$，$u(0) = 0^2 = 0$ 和 $u(h/4) = (h/4)^2 = h^2/16$。LHS 变为：\n$$\n\\text{LHS} = w_{-}\\left(\\frac{h^2}{16}\\right) + w_{0}(0) + w_{+}\\left(\\frac{h^2}{16}\\right) = \\frac{h^2}{16}(w_{-} + w_{+})\n$$\nRHS 是 $u(y)=y^2$ 的平均值：\n$$\n\\text{RHS} = \\frac{1}{h} \\int_{-h/2}^{h/2} y^2 \\, dy = \\frac{1}{h} \\left[\\frac{y^3}{3}\\right]_{-h/2}^{h/2} = \\frac{1}{3h} \\left(\\left(\\frac{h}{2}\\right)^3 - \\left(-\\frac{h}{2}\\right)^3\\right) = \\frac{1}{3h} \\left(\\frac{h^3}{8} + \\frac{h^3}{8}\\right) = \\frac{2h^3}{24h} = \\frac{h^2}{12}\n$$\n将 LHS 和 RHS 相等，并消去 $h^2$ 项（因为 $h \\neq 0$）：\n$$\n\\frac{1}{16}(w_{-} + w_{+}) = \\frac{1}{12} \\implies w_{-} + w_{+} = \\frac{16}{12} = \\frac{4}{3} \\quad (3)\n$$\n\n现在我们求解这个关于 $w_{-}$、$w_{0}$ 和 $w_{+}$ 的三元线性方程组：\n1. $w_{-} + w_{0} + w_{+} = 1$\n2. $w_{-} = w_{+}$\n3. $w_{-} + w_{+} = 4/3$\n\n将方程(2)代入方程(3)：\n$$\nw_{+} + w_{+} = \\frac{4}{3} \\implies 2w_{+} = \\frac{4}{3} \\implies w_{+} = \\frac{2}{3}\n$$\n从方程(2)可以得出：\n$$\nw_{-} = \\frac{2}{3}\n$$\n最后，将 $w_{-}$ 和 $w_{+}$ 的值代入方程(1)来求 $w_{0}$：\n$$\n\\frac{2}{3} + w_{0} + \\frac{2}{3} = 1 \\implies w_{0} + \\frac{4}{3} = 1 \\implies w_{0} = 1 - \\frac{4}{3} = -\\frac{1}{3}\n$$\n因此，所求的权重为 $w_{-} = 2/3$，$w_{0} = -1/3$ 和 $w_{+} = 2/3$。问题要求将答案表示为单行矩阵 $(w_{-}, w_{0}, w_{+})$。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  \\frac{2}{3} \\end{pmatrix}}$$"
        },
        {
            "introduction": "当使用四叉树或八叉树网格通过切割单元（cut cells）来表示复杂几何时，显式时间格式会遇到一个严重的限制，即“小单元问题”。本练习将引导您从第一性原理出发，分析这些微小切割单元的 Courant–Friedrichs–Lewy (CFL) 稳定性条件。理解这一稳定性瓶颈对于设计稳健的浸入边界法至关重要。",
            "id": "3355418",
            "problem": "考虑在四叉树网格上的二维常系数线性平流方程 $\\partial_{t} q + \\nabla \\cdot (\\mathbf{u}\\, q) = 0$，其中速度 $\\mathbf{u} = (u_{x}, u_{y})$ 为常数。四叉树的叶节点是边长为 $h$ 的轴对齐正方形。该方程通过一阶有限体积法进行离散，采用前向欧拉时间积分和迎风数值通量。一个经过充分检验的事实是，对于任意多边形单元上的此类显式有限体积格式，局部 Courant–Friedrichs–Lewy (CFL) 稳定性条件可以表示为 $\\Delta t \\le \\nu \\, V / \\sum_{f} |\\mathbf{u}\\cdot \\mathbf{n}_{f}|\\,A_{f}$，其中 $V$ 是单元面积，求和遍及所有与相邻流体交换通量的单元面 $f$，$A_{f}$ 是面长，$\\mathbf{n}_{f}$ 是面 $f$ 的单位法向量，$\\nu \\in (0,1)$ 是 Courant 数。\n\n我们关注一个被笔直的、不可穿透的固体边界切割的单个四叉树叶单元。该切割在叶节点内部创建了一个小的流体控制体（一个切割单元）。您可以假设固体边界在切割界面上施加了零法向质量通量，因此只有与流体邻居相邻的面才对通量总和有贡献。\n\n任务 A (稳定性标度)：将 CFL 稳定性界限特化到以下情况：切割单元是由一条平行于单元某条边的直线边界所形成的一个厚度为 $\\varepsilon \\ll h$ 的、与面平行的薄流体片。设置坐标系，使得未切割的正方形为 $\\{(x,y): 0 \\le x \\le h,\\, 0 \\le y \\le h\\}$，不可穿透的边界位于直线 $y=\\varepsilon$ 上；流体占据的区域为 $\\{(x,y): 0 \\le x \\le h,\\, 0 \\le y \\le \\varepsilon\\}$。从上述基本有限体积 CFL 界限出发，依据第一性原理证明，在此配置下，当 $h$ 固定且 $\\varepsilon \\to 0$ 时，显式稳定性极限与切割单元面积成线性比例，即 $\\Delta t \\propto V_{\\min}$。\n\n任务 B ($V_{\\min}$ 的几何标度)：在两种代表性情况下，推导切割单元面积 $V$ 对切割边界在四叉树叶节点内相对位置的依赖关系：\n- 与面平行的薄片：对于上述配置，用 $h$ 和 $\\varepsilon$ 表示 $V$。\n- 掠过角落的楔形：设边界是一条直线，其到单元左下角的有符号法向距离为 $\\varepsilon$，且其单位法向量与 x 轴正向的夹角为 $\\theta \\in (0,\\pi/2)$。此时，流体切割单元是一个两直角边沿坐标轴的直角三角形。将 $V$ 表示为 $\\varepsilon$ 和 $\\theta$ 的函数。\n\n最后，对于与面平行的薄片配置，将精确的最大稳定时间步长 $\\Delta t_{\\max}$ 表示为以 $V_{\\min}$、$h$、$|u_{x}|$、$|u_{y}|$ 和 $\\nu$ 表示的闭式解析表达式。请提供此最终表达式。不需要具体数值；请以符号形式给出表达式。最终答案的表达式内不应包含单位。",
            "solution": "我们从多边形控制体上的双曲守恒律的显式有限体积离散化开始。对于面积为 $V$ 的控制体上的一阶迎风通量和前向欧拉时间积分，局部 Courant–Friedrichs–Lewy (CFL) 时间步长限制的一个标准形式是\n$$\n\\Delta t \\le \\nu \\, \\frac{V}{\\sum_{f} |\\lambda_{f}|\\, A_{f}}\n$$\n其中求和遍及所有面 $f$，$A_{f}$ 是面长，$|\\lambda_{f}|$ 是垂直于面 $f$ 的最大信号速度。对于速度为 $\\mathbf{u}=(u_{x},u_{y})$ 的常系数线性平流，垂直于面 $f$ 的特征速度为 $|\\lambda_{f}| = |\\mathbf{u}\\cdot \\mathbf{n}_{f}|$。对于不可穿透的固体边界，切割界面上的法向通量为零，因此与固体边界重合的切割面不出现在通量求和中。\n\n任务 A：特化到与面平行的薄片切割单元，以及 $\\Delta t$ 随 $V_{\\min}$ 的标度关系。\n\n在四叉树叶节点上设置坐标系，使得未切割的正方形单元为 $\\{(x,y): 0 \\le x \\le h,\\; 0 \\le y \\le h\\}$，不可穿透的边界是直线 $y=\\varepsilon$，其中 $0\\varepsilon \\ll h$。流体切割单元区域则为 $\\{(x,y): 0\\le x\\le h,\\; 0\\le y\\le \\varepsilon\\}$，这是一个宽为 $h$、高为 $\\varepsilon$ 的矩形。\n\n流体切割单元的面积为\n$$\nV \\;=\\; h \\,\\varepsilon.\n$$\n此流体薄片与流体邻居相邻的面有：位于 $y=0$ 的底面，其外法线为 $\\mathbf{n}=(0,-1)$，长度为 $A_{\\text{bottom}}=h$；以及位于 $x=0$ 和 $x=h$ 的两个垂直侧面，其外法线分别为 $\\mathbf{n}=(-1,0)$ 和 $\\mathbf{n}=(1,0)$，每个面的长度为 $A_{\\text{side}}=\\varepsilon$。位于 $y=\\varepsilon$ 的顶面是不可穿透的（固体边界），因此在这个壁面法向速度设为零的线性平流模型中，它不贡献通量。\n\n因此，CFL 界限分母中的通量和为\n$$\n\\sum_{f} |\\mathbf{u}\\cdot \\mathbf{n}_{f}|\\,A_{f}\n\\;=\\;\n|\\mathbf{u}\\cdot(0,-1)|\\, h \\;+\\; |\\mathbf{u}\\cdot(-1,0)|\\, \\varepsilon \\;+\\; |\\mathbf{u}\\cdot(1,0)|\\, \\varepsilon\n\\;=\\;\n|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon.\n$$\n所以，对于与面平行的薄片，精确的局部稳定性极限为\n$$\n\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon}\n\\;=\\;\n\\nu \\, \\frac{h\\,\\varepsilon}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, \\varepsilon}.\n$$\n当 $h$、$|u_{x}|$ 和 $|u_{y}|$ 固定且 $\\varepsilon \\to 0$ 时，分母由 $|u_{y}|\\, h$ 项主导，给出渐近标度关系\n$$\n\\Delta t_{\\max} \\;\\sim\\; \\nu \\, \\frac{h\\,\\varepsilon}{|u_{y}|\\, h} \\;=\\; \\nu \\, \\frac{\\varepsilon}{|u_{y}|}.\n$$\n由于 $V = h\\,\\varepsilon$，这个渐近行为等价于\n$$\n\\Delta t_{\\max} \\;\\sim\\; \\nu \\, \\frac{V}{|u_{y}|\\, h},\n$$\n这表明在薄片极限下，显式稳定性极限与切割单元面积 $V$ 成正比。这就证实了在存在与面平行的薄片切割单元的情况下，显式时间步进可能需要 $\\Delta t \\propto V_{\\min}$ 来保证稳定性的论断。\n\n任务 B：$V_{\\min}$ 随四叉树叶节点内边界位置的几何标度关系。\n\n我们推导在四叉树正方形内放置一条直线边界的两种代表性情况下的面积标度关系。\n\n与面平行的薄片：如上所述，一条距离单元某条边为 $\\varepsilon$ 且与其平行的边界，会产生一个高为 $\\varepsilon$、宽为 $h$ 的矩形流体区域，因此\n$$\nV(\\varepsilon; \\text{parallel to face}) \\;=\\; h\\,\\varepsilon,\n$$\n这与到面的距离 $\\varepsilon$ 呈线性关系。\n\n掠过角落的楔形：考虑正方形位于原点 $(0,0)$ 的左下角。设边界是一条直线，其单位法向量为 $\\mathbf{n}=(\\cos\\theta,\\sin\\theta)$，其中 $\\theta \\in (0,\\pi/2)$，且该直线到原点的有符号法向距离为 $\\varepsilon0$，因此直线方程为 $\\mathbf{n}\\cdot \\mathbf{x} = \\varepsilon$。通过设置 $y=0$，可求得该直线与 x 轴的截距为 $x = \\varepsilon/\\cos\\theta$。同样，与 y 轴的截距在 $y=\\varepsilon/\\sin\\theta$ 处。对于足够小的 $\\varepsilon$，这些截距位于正方形内，角落附近的流体区域是一个直角三角形，其沿坐标轴的两条直角边长度分别为 $\\varepsilon/\\cos\\theta$ 和 $\\varepsilon/\\sin\\theta$。其面积为\n$$\nV(\\varepsilon,\\theta; \\text{near corner}) \\;=\\; \\frac{1}{2}\\,\\frac{\\varepsilon}{\\cos\\theta}\\,\\frac{\\varepsilon}{\\sin\\theta}\n\\;=\\;\n\\frac{\\varepsilon^{2}}{2\\,\\sin\\theta\\,\\cos\\theta},\n$$\n这与沿边界法线到角落的距离 $\\varepsilon$ 呈二次关系。这表明，根据边界在四叉树单元内的相对位置，最小切割单元面积可能与到面的距离呈线性关系，也可能与到角的距离呈二次关系。\n\n用 $V_{\\min}$ 表示的最终表达式：对于与面平行的薄片配置，我们可以直接用 $V_{\\min}$ 表示精确的稳定性极限。使用 $V_{\\min} = h\\,\\varepsilon$，我们消去 $\\varepsilon$ 得到\n$$\n\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V_{\\min}}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, V_{\\min}/h}.\n$$\n对于所述的几何形状，此表达式是精确的，并且在薄片极限 $V_{\\min}\\to 0$ 下，简化为线性标度关系 $\\Delta t_{\\max} \\sim \\nu\\, V_{\\min}/(|u_{y}|\\, h)$。",
            "answer": "$$\\boxed{\\Delta t_{\\max} \\;=\\; \\nu \\, \\frac{V_{\\min}}{|u_{y}|\\, h \\;+\\; 2\\,|u_{x}|\\, V_{\\min}/h}}$$"
        },
        {
            "introduction": "虽然四叉树网格提供了极大的灵活性，但其固有的轴对齐特性会导致弯曲边界的“阶梯化”表示，这会在计算如壁面剪切应力等关键工程量时引入误差。本练习使用一个构造解来量化由几何错位和离散格式选择共同导致的误差，并探索了实用的修正策略。这项动手分析揭示了从浸入边界模拟中获得精确结果所面临的挑战与解决方案。",
            "id": "3355443",
            "problem": "在计算流体动力学 (CFD) 的背景下，考虑光滑不可渗透壁面附近的二维层流。对于牛顿流体，壁面剪切应力由本构关系 $\\boldsymbol{\\tau} = \\mu \\left( \\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\top} \\right)$ 定义，其中 $\\mu$ 是动力粘度，$\\boldsymbol{u}$ 是速度场。对于光滑壁面，某一点的标量壁面剪切应力大小为 $\\tau_w = \\mu \\, \\partial u_t / \\partial n$，其中 $u_t$ 是速度的切向分量，$n$ 表示指向流体内部的法向坐标。\n\n在使用四叉树网格的浸入边界 (IB) 方法中，粗糙层级会引起几何形状的阶梯化：真实的壁面法线 $\\boldsymbol{n}_{\\mathrm{true}}$ 和切线 $\\boldsymbol{t}_{\\mathrm{true}}$ 被轴对齐方向 $\\boldsymbol{n}_{\\mathrm{axis}} \\in \\{\\boldsymbol{e}_x, \\boldsymbol{e}_y\\}$ 以及垂直于 $\\boldsymbol{n}_{\\mathrm{axis}}$ 的 $\\boldsymbol{t}_{\\mathrm{axis}}$ 所近似。这种量化在估计 $\\tau_w$ 时会产生几何偏差，且在粗糙层级上该偏差会被放大。相比之下，贴体网格的单元面与 $\\boldsymbol{n}_{\\mathrm{true}}$ 和 $\\boldsymbol{t}_{\\mathrm{true}}$ 对齐。\n\n假设一个与无滑移条件和壁面附近法向线性加二次变化一致的构造局部速度场：\n$$\nu_t(y_{\\mathrm{true}}) = \\gamma \\, y_{\\mathrm{true}} + \\beta \\, y_{\\mathrm{true}}^2,\n$$\n其中 $y_{\\mathrm{true}}$ 是沿真实壁面法线 $\\boldsymbol{n}_{\\mathrm{true}}$ 的有符号距离，$\\gamma$ 的单位是 $\\mathrm{s}^{-1}$，$\\beta$ 的单位是 $\\mathrm{s}^{-1}\\,\\mathrm{m}^{-1}$。精确的壁面剪切应力大小为\n$$\n\\tau_w^{\\mathrm{true}} = \\mu \\, \\gamma.\n$$\n\n设真实壁面法线为 $\\boldsymbol{n}_{\\mathrm{true}} = [\\cos\\phi, \\sin\\phi]$，其中 $\\phi$ 是与 $x$ 轴的夹角，以弧度为单位。真实切线为 $\\boldsymbol{t}_{\\mathrm{true}} = [-\\sin\\phi, \\cos\\phi]$。四叉树阶梯化的法线 $\\boldsymbol{n}_{\\mathrm{axis}}$ 按以下方式选择：\n$$\n\\boldsymbol{n}_{\\mathrm{axis}} =\n\\begin{cases}\n\\boldsymbol{e}_x  \\text{if } |\\cos\\phi| \\ge |\\sin\\phi|, \\\\\n\\boldsymbol{e}_y  \\text{otherwise},\n\\end{cases}\n$$\n当 $|\\cos\\phi| = |\\sin\\phi|$ 时，决胜规则选择 $\\boldsymbol{e}_x$。相关的轴向切线为：若 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_x$，则 $\\boldsymbol{t}_{\\mathrm{axis}} = \\boldsymbol{e}_y$；若 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_y$，则 $\\boldsymbol{t}_{\\mathrm{axis}} = \\boldsymbol{e}_x$。\n\n定义邻近壁面单元的局部网格尺寸为 $h$。第一个流体单元的中心位于沿选定法线方向距离为 $d = h/2$ 的位置。浸入边界单点阶梯化估计使用基于轴对齐法线和切线的向前差分：\n$$\nf(y) = \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{u}\\big(y \\, \\boldsymbol{n}_{\\mathrm{axis}}\\big),\n$$\n以及\n$$\n\\tau_w^{\\mathrm{IB,1pt}} = \\mu \\left| \\frac{f(d) - f(0)}{d} \\right|,\n$$\n由于无滑移条件，$f(0)=0$。贴体单点估计使用真实法线和切线：\n$$\n\\tau_w^{\\mathrm{BF,1pt}} = \\mu \\left| \\frac{u_t(d) - u_t(0)}{d} \\right| = \\mu \\left| \\gamma + \\beta d \\right|.\n$$\n\n为减少阶梯化引起的偏差，考虑两种校正方法：\n- 方向投影校正，通过因子\n$$\nr = \\left(\\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}}\\right) \\left(\\boldsymbol{n}_{\\mathrm{axis}} \\cdot \\boldsymbol{n}_{\\mathrm{true}}\\right)\n$$\n来解释 $\\boldsymbol{n}_{\\mathrm{axis}}$、$\\boldsymbol{t}_{\\mathrm{axis}}$ 与 $\\boldsymbol{n}_{\\mathrm{true}}$、$\\boldsymbol{t}_{\\mathrm{true}}$ 之间的未对准。\n- 使用多项式结构以及沿 $\\boldsymbol{n}_{\\mathrm{axis}}$ 方向上 $y=0$、$y=d$ 和 $y=2d$ 处的点进行二阶外插至壁面：\n$$\n\\left.\\frac{\\partial (\\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{u})}{\\partial y}\\right|_{y=0} \\approx \\frac{4 f(d) - f(2d)}{2 d}.\n$$\n\n结合这些，校正后的浸入边界估计为\n$$\n\\tau_w^{\\mathrm{IB,corr}} = \\mu \\, \\left| \\frac{4 f(d) - f(2d)}{2 d} \\right| \\, \\frac{1}{|r|}.\n$$\n\n从第一性原理出发，推导实现上述估计量所需的表达式，并展示在构造解下，阶梯化未对准如何通过 $r$ 进入，以及粗糙层级偏差如何通过 $\\beta d$ 项进入。然后实现一个程序，对于一组给定的测试用例，计算每个估计量相对于精确壁面剪切应力的相对误差：\n$$\nE_{\\mathrm{IB}} = \\frac{\\left| \\tau_w^{\\mathrm{IB,1pt}} - \\tau_w^{\\mathrm{true}} \\right|}{\\left| \\tau_w^{\\mathrm{true}} \\right|}, \\quad\nE_{\\mathrm{BF}} = \\frac{\\left| \\tau_w^{\\mathrm{BF,1pt}} - \\tau_w^{\\mathrm{true}} \\right|}{\\left| \\tau_w^{\\mathrm{true}} \\right|}, \\quad\nE_{\\mathrm{corr}} = \\frac{\\left| \\tau_w^{\\mathrm{IB,corr}} - \\tau_w^{\\mathrm{true}} \\right|}{\\left| \\tau_w^{\\mathrm{true}} \\right|}.\n$$\n\n角度必须以弧度为单位。动力粘度 $\\mu$ 必须以帕斯卡-秒为单位，距离必须以米为单位，最终的壁面剪切应力大小以帕斯卡为单位。输出必须报告每个测试用例的三个相对误差，形式为小数（无百分号）。\n\n使用以下测试套件，每个参数集以 $(\\phi, h, \\mu, \\gamma, \\beta)$ 的形式给出：\n\n- 用例 1：$\\left( \\frac{\\pi}{12}, \\, 0.1, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 5 \\right)$。\n- 用例 2：$\\left( \\frac{\\pi}{4}, \\, 0.1, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 5 \\right)$。\n- 用例 3：$\\left( \\frac{5\\pi}{12}, \\, 0.1, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 5 \\right)$。\n- 用例 4：$\\left( \\frac{\\pi}{4}, \\, 0.05, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 5 \\right)$。\n- 用例 5：$\\left( \\frac{\\pi}{4}, \\, 0.025, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 5 \\right)$。\n- 用例 6：$\\left( \\frac{\\pi}{4}, \\, 0.1, \\, 1.0 \\times 10^{-3}, \\, 10, \\, 0 \\right)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，条目按用例排序，在每个用例中按 $(E_{\\mathrm{IB}}, E_{\\mathrm{BF}}, E_{\\mathrm{corr}})$ 排序。例如，包含两个用例的输出形式为 $\\left[ E_{\\mathrm{IB},1}, E_{\\mathrm{BF},1}, E_{\\mathrm{corr},1}, E_{\\mathrm{IB},2}, E_{\\mathrm{BF},2}, E_{\\mathrm{corr},2} \\right]$。实际输出必须反映上述所有六个用例。",
            "solution": "基本出发点是连接应力与速度梯度的牛顿本构关系。对于牛顿流体，粘性应力张量为 $\\boldsymbol{\\tau} = \\mu \\left( \\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\top} \\right)$。在光滑壁面上，无滑移条件意味着壁面上的速度 $\\boldsymbol{u} = \\boldsymbol{0}$，标量壁面剪切应力大小由 $\\tau_w = \\mu \\, \\partial u_t / \\partial n$ 给出，其中 $u_t$ 是速度的切向分量，$n$ 是指向流体内部的法向坐标。\n\n我们在壁面附近构造一个局部解，\n$$\nu_t(y_{\\mathrm{true}}) = \\gamma \\, y_{\\mathrm{true}} + \\beta \\, y_{\\mathrm{true}}^2,\n$$\n其中 $y_{\\mathrm{true}}$ 是沿真实壁面法线 $\\boldsymbol{n}_{\\mathrm{true}}$ 的有符号距离。该函数与无滑移边界条件 $u_t(0) = 0$ 一致，并代表一个线性剪切率 $\\gamma$，以及一个与 $\\beta$ 成正比的二次校正，用于模拟粗糙层级的插值或曲率效应。精确的壁面剪切应力大小为\n$$\n\\tau_w^{\\mathrm{true}} = \\mu \\left. \\frac{\\partial u_t}{\\partial y_{\\mathrm{true}}} \\right|_{y_{\\mathrm{true}}=0} = \\mu \\, \\gamma.\n$$\n\n四叉树中的浸入边界阶梯化用轴对齐的线段取代了真实的壁面方向。定义真实法线和切线为\n$$\n\\boldsymbol{n}_{\\mathrm{true}} = \\begin{bmatrix} \\cos\\phi \\\\ \\sin\\phi \\end{bmatrix}, \\quad\n\\boldsymbol{t}_{\\mathrm{true}} = \\begin{bmatrix} -\\sin\\phi \\\\ \\cos\\phi \\end{bmatrix}.\n$$\n量化的阶梯化法线和切线为\n$$\n\\boldsymbol{n}_{\\mathrm{axis}} =\n\\begin{cases}\n\\boldsymbol{e}_x  \\text{if } |\\cos\\phi| \\ge |\\sin\\phi|, \\\\\n\\boldsymbol{e}_y  \\text{otherwise},\n\\end{cases}\n\\qquad\n\\boldsymbol{t}_{\\mathrm{axis}} =\n\\begin{cases}\n\\boldsymbol{e}_y  \\text{if } \\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_x, \\\\\n\\boldsymbol{e}_x  \\text{if } \\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_y.\n\\end{cases}\n$$\n第一个内部单元的中心位于沿选定法线方向距离为 $d = h/2$ 的位置。一个典型的浸入边界单点估计计算平行于 $\\boldsymbol{t}_{\\mathrm{axis}}$ 的速度分量在 $\\boldsymbol{n}_{\\mathrm{axis}}$ 方向上的向前差分：\n$$\nf(y) = \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{u}\\big(y \\boldsymbol{n}_{\\mathrm{axis}}\\big), \\quad\n\\tau_w^{\\mathrm{IB,1pt}} = \\mu \\left| \\frac{f(d) - f(0)}{d} \\right| = \\mu \\left| \\frac{f(d)}{d} \\right|,\n$$\n因为根据无滑移条件，$f(0)=0$。为了表达我们构造解的 $f(y)$，注意到在壁面附近 $\\boldsymbol{u} = u_t \\, \\boldsymbol{t}_{\\mathrm{true}}$，且真实法向坐标为 $y_{\\mathrm{true}} = \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\left( y \\boldsymbol{n}_{\\mathrm{axis}} \\right) = y \\left( \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\boldsymbol{n}_{\\mathrm{axis}} \\right)$。因此，\n$$\nf(y) = \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\left( u_t(y_{\\mathrm{true}}) \\boldsymbol{t}_{\\mathrm{true}} \\right)\n= \\left( \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}} \\right) \\left( \\gamma y_{\\mathrm{true}} + \\beta y_{\\mathrm{true}}^2 \\right)\n= \\left( \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}} \\right) \\left( \\gamma \\left( \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\boldsymbol{n}_{\\mathrm{axis}} \\right) y + \\beta \\left( \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\boldsymbol{n}_{\\mathrm{axis}} \\right)^2 y^2 \\right).\n$$\n定义\n$$\nr = \\left( \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}} \\right) \\left( \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\boldsymbol{n}_{\\mathrm{axis}} \\right),\n\\qquad\ns = \\left( \\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}} \\right) \\left( \\boldsymbol{n}_{\\mathrm{true}} \\cdot \\boldsymbol{n}_{\\mathrm{axis}} \\right)^2,\n$$\n因此 $f(y) = \\gamma r \\, y + \\beta s \\, y^2$。于是，IB 单点估计变为\n$$\n\\tau_w^{\\mathrm{IB,1pt}} = \\mu \\left| \\frac{\\gamma r \\, d + \\beta s \\, d^2}{d} \\right|\n= \\mu \\left| \\gamma r + \\beta s \\, d \\right|.\n$$\n这显示出相对于 $\\tau_w^{\\mathrm{true}} = \\mu \\gamma$ 的两种偏差：\n- 一个几何未对准因子 $r$，当 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_x$ 时，给出 $r = \\cos^2\\phi$；当 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_y$ 时，给出 $r = -\\sin^2\\phi$。其大小 $|r|$ 反映了由于阶梯化引起的余弦平方或正弦平方衰减。这从根本上与将剪切率二阶张量 $\\gamma \\, \\boldsymbol{t}_{\\mathrm{true}} \\otimes \\boldsymbol{n}_{\\mathrm{true}}$ 投影到轴对齐方向上有关。\n- 一个粗糙层级偏差 $\\beta s \\, d$，它随 $d = h/2$ 线性增长，源于使用单点向前差分时的二次项。\n\n在贴体网格中，法线和切线与真实几何形状对齐，因此单点估计为\n$$\n\\tau_w^{\\mathrm{BF,1pt}} = \\mu \\left| \\frac{\\gamma d + \\beta d^2}{d} \\right| = \\mu \\left| \\gamma + \\beta d \\right|,\n$$\n它只包含来自二次项的粗糙层级偏差，没有未对准因子。\n\n为了在不改变网格的情况下减少粗糙层级偏差，我们可以利用已知的边界值 $f(0)=0$ 和在 $y=d$、$y=2d$ 处的测量值进行二阶外插。对于一个二次函数 $f(y) = a_1 y + a_2 y^2$，求解其在壁面处的导数可得\n$$\na_1 = \\left. \\frac{d f}{d y} \\right|_{y=0} = \\frac{4 f(d) - f(2d)}{2 d}.\n$$\n将此应用于阶梯化测量值 $f(y) = \\gamma r \\, y + \\beta s \\, y^2$ 可得\n$$\n\\frac{4 f(d) - f(2d)}{2 d} = \\frac{4 (\\gamma r \\, d + \\beta s \\, d^2) - (2 \\gamma r \\, d + 4 \\beta s \\, d^2)}{2 d} = \\gamma r,\n$$\n因此，在构造解下，二阶外插精确地移除了来自二次项的 $\\mathcal{O}(d)$ 偏差。与 $\\gamma$ 的剩余偏差是阶梯化未对准因子 $r$。如果真实的壁面方向是可用的（例如，从水平集函数中获得），我们可以通过除以 $|r|$ 来校正这个几何因子，得到\n$$\n\\tau_w^{\\mathrm{IB,corr}} = \\mu \\, \\left| \\frac{4 f(d) - f(2d)}{2 d} \\right| \\, \\frac{1}{|r|} = \\mu \\, |\\gamma|.\n$$\n因此，在构造解下，对于任何 $\\phi$ 和 $h$，校正后的估计都能恢复精确的壁面剪切应力大小。\n\n算法步骤：\n- 对每个测试用例 $(\\phi, h, \\mu, \\gamma, \\beta)$，计算 $\\boldsymbol{n}_{\\mathrm{true}} = [\\cos\\phi, \\sin\\phi]$ 和 $\\boldsymbol{t}_{\\mathrm{true}} = [-\\sin\\phi, \\cos\\phi]$。\n- 根据规则 $|\\cos\\phi| \\ge |\\sin\\phi| \\Rightarrow \\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_x$，否则 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_y$，来选择 $\\boldsymbol{n}_{\\mathrm{axis}}$ 和 $\\boldsymbol{t}_{\\mathrm{axis}}$，并相应地设置垂直的 $\\boldsymbol{t}_{\\mathrm{axis}}$。\n- 计算 $d = h/2$、$r = (\\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}})(\\boldsymbol{n}_{\\mathrm{axis}} \\cdot \\boldsymbol{n}_{\\mathrm{true}})$ 和 $s = (\\boldsymbol{t}_{\\mathrm{axis}} \\cdot \\boldsymbol{t}_{\\mathrm{true}})(\\boldsymbol{n}_{\\mathrm{axis}} \\cdot \\boldsymbol{n}_{\\mathrm{true}})^2$。\n- 评估 $f(d) = \\gamma r \\, d + \\beta s \\, d^2$ 和 $f(2d) = \\gamma r \\, 2d + \\beta s \\, (2d)^2$。\n- 计算：\n  - $\\tau_w^{\\mathrm{true}} = \\mu \\, \\gamma$，\n  - $\\tau_w^{\\mathrm{IB,1pt}} = \\mu \\left| f(d)/d \\right| = \\mu \\left| \\gamma r + \\beta s \\, d \\right|$，\n  - $\\tau_w^{\\mathrm{BF,1pt}} = \\mu \\left| \\gamma + \\beta d \\right|$，\n  - $\\tau_w^{\\mathrm{IB,corr}} = \\mu \\left| \\frac{4 f(d) - f(2d)}{2 d} \\right| \\cdot \\frac{1}{|r|}$。\n- 以小数形式返回相对误差 $E_{\\mathrm{IB}}$、$E_{\\mathrm{BF}}$ 和 $E_{\\mathrm{corr}}$。\n\n测试套件的覆盖范围分析：\n- 用例 1 使用小角度 $\\phi = \\pi/12$ 和粗糙网格 $h = 0.1$ 来探究轻微的未对准和粗糙偏差。\n- 用例 2 使用最大模糊角 $\\phi = \\pi/4$ 和粗糙网格 $h = 0.1$ 来探究最坏情况下的未对准（$|r| = 1/2$）和粗糙偏差。\n- 用例 3 使用大角度 $\\phi = 5\\pi/12$ 和粗糙网格 $h = 0.1$ 来探究 $\\boldsymbol{n}_{\\mathrm{axis}} = \\boldsymbol{e}_y$ 时的未对准。\n- 用例 4 和 5 在 $\\phi = \\pi/4$ 时减小 $h$ 以显示贴体误差随 $d$ 缩放，而 IB 未对准持续存在；在构造解下，校正后的估计消除了这两种效应。\n- 用例 6 设置 $\\beta = 0$ 以单独分离未对准效应。\n\n程序将结果聚合成指定的单行格式，作为一个在方括号内的逗号分隔列表，按用例排序，每个用例包含三元组 $(E_{\\mathrm{IB}}, E_{\\mathrm{BF}}, E_{\\mathrm{corr}})$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_errors(phi, h, mu, gamma, beta):\n    # True normal and tangent\n    n_true = np.array([np.cos(phi), np.sin(phi)])\n    t_true = np.array([-np.sin(phi), np.cos(phi)])\n\n    # Staircased axis normal selection with tie-breaker to ex\n    if abs(n_true[0]) = abs(n_true[1]):\n        n_axis = np.array([1.0, 0.0])\n        t_axis = np.array([0.0, 1.0])\n    else:\n        n_axis = np.array([0.0, 1.0])\n        t_axis = np.array([1.0, 0.0])\n\n    # Distances\n    d = h / 2.0\n\n    # Projection factors\n    r = float(np.dot(t_axis, t_true) * np.dot(n_axis, n_true))\n    s = float(np.dot(t_axis, t_true) * (np.dot(n_axis, n_true) ** 2))\n\n    # Manufactured axis-aligned sampling function values\n    # f(y) = gamma * r * y + beta * s * y^2\n    f_d = gamma * r * d + beta * s * d ** 2\n    f_2d = gamma * r * (2.0 * d) + beta * s * (2.0 * d) ** 2\n\n    # Shear stress estimates\n    tau_true = mu * gamma\n    tau_ib_1pt = mu * abs(f_d / d)  # = mu * |gamma * r + beta * s * d|\n    tau_bf_1pt = mu * abs(gamma + beta * d)\n    # Second-order extrapolated derivative at wall along axis:\n    # (4 f(d) - f(2d)) / (2 d) - equals gamma * r for the manufactured solution\n    deriv_axis_wall = (4.0 * f_d - f_2d) / (2.0 * d)\n    # Correct orientation by dividing by |r| to recover true normal/tangential derivative\n    r_abs = abs(r) if r != 0.0 else np.nan  # handle degenerate case r=0 gracefully\n    if r_abs == 0.0 or np.isnan(r_abs):\n        # If r is exactly zero (pathological orientation), set corrected to NaN to avoid division by zero\n        tau_ib_corr = np.nan\n    else:\n        tau_ib_corr = mu * abs(deriv_axis_wall) / r_abs\n\n    # Relative errors as decimal fractions\n    # If corrected tau is NaN, set error to NaN to reflect inability to correct\n    E_ib = abs(tau_ib_1pt - tau_true) / abs(tau_true)\n    E_bf = abs(tau_bf_1pt - tau_true) / abs(tau_true)\n    E_corr = abs(tau_ib_corr - tau_true) / abs(tau_true) if not np.isnan(tau_ib_corr) else np.nan\n\n    return E_ib, E_bf, E_corr\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (phi, h, mu, gamma, beta)\n    test_cases = [\n        (np.pi/12.0, 0.1, 1.0e-3, 10.0, 5.0),          # Case 1\n        (np.pi/4.0, 0.1, 1.0e-3, 10.0, 5.0),           # Case 2\n        (5.0*np.pi/12.0, 0.1, 1.0e-3, 10.0, 5.0),      # Case 3\n        (np.pi/4.0, 0.05, 1.0e-3, 10.0, 5.0),          # Case 4\n        (np.pi/4.0, 0.025, 1.0e-3, 10.0, 5.0),         # Case 5\n        (np.pi/4.0, 0.1, 1.0e-3, 10.0, 0.0),           # Case 6\n    ]\n\n    results = []\n    for phi, h, mu, gamma, beta in test_cases:\n        E_ib, E_bf, E_corr = compute_errors(phi, h, mu, gamma, beta)\n        # Append in the required order per case: (E_IB, E_BF, E_CORR)\n        # Format floats in a consistent decimal representation\n        results.extend([E_ib, E_bf, E_corr])\n\n    # Convert potential NaNs to \"nan\" string via str(), preserving single-line format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}