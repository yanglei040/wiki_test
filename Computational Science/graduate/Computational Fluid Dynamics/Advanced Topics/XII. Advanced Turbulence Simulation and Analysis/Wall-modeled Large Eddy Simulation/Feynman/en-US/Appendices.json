{
    "hands_on_practices": [
        {
            "introduction": "Before delving into the mechanics of wall models, it is crucial to understand *why* they are indispensable for high-Reynolds-number simulations. This exercise performs a thought experiment to estimate the computational cost of a fully wall-resolved simulation, demonstrating the prohibitive grid requirements that necessitate the use of wall modeling. By working through the scaling laws, you will gain a concrete appreciation for the challenge that Wall-Modeled Large Eddy Simulation (WMLES) is designed to overcome .",
            "id": "3391472",
            "problem": "Consider incompressible turbulent plane channel flow at friction Reynolds number $Re_{\\tau} = 10^{5}$ in a domain of size $L_{x} \\times 2h \\times L_{z}$, where $h$ is the channel half-height. Assume a Wall-Modeled Large Eddy Simulation (WMLES) context but, as a thought experiment to assess resolution demands relative to wall units, suppose you insist on near-wall target spacings of $\\Delta x^{+} \\approx 50$, $\\Delta z^{+} \\approx 15$, and a conservative uniform wall-normal spacing chosen equal to the wall value, $\\Delta y^{+} \\approx 1$, applied across the entire height. Take standard channel LES extents $L_{x} = 8\\pi h$ and $L_{z} = 3\\pi h$. Using only core definitions of wall units and the friction Reynolds number, derive the expressions for the number of grid points $N_{x}$, $N_{y}$, and $N_{z}$ needed in each direction under these assumptions, and compute the total number of grid cells $N = N_{x} N_{y} N_{z}$.\n\nInstructions:\n- Use the definitions $Re_{\\tau} = u_{\\tau} h / \\nu$ and $\\Delta \\xi^{+} = \\Delta \\xi \\, u_{\\tau} / \\nu$ for $\\xi \\in \\{x,y,z\\}$.\n- Assume uniform spacings in the streamwise and spanwise directions consistent with the target wall-unit spacings, and a uniform wall-normal spacing equal to the wall value $\\Delta y^{+} \\approx 1$ throughout $2h$.\n- Compute a single numerical value for $N$ for $Re_{\\tau} = 10^{5}$, $L_{x} = 8\\pi h$, $L_{z} = 3\\pi h$, $\\Delta x^{+} = 50$, $\\Delta z^{+} = 15$, and $\\Delta y^{+} = 1$.\n- Round your final answer for $N$ to two significant figures and express it as a pure number with no units.\n\nAfter computing $N$, briefly assess in your solution the feasibility of such a grid on contemporary high-performance computing in terms of order-of-magnitude memory requirements, but note that the final answer must be only the single rounded $N$.",
            "solution": "The problem has been validated and is deemed sound. It presents a well-posed thought experiment in computational fluid dynamics, grounded in standard definitions, free of scientific or logical contradictions, and containing all necessary information for a unique solution. The assumptions, while impractical for a real-world simulation, are explicitly stated for the purpose of a theoretical calculation, which is to assess resolution demands.\n\nThe objective is to calculate the total number of grid cells, $N$, required to simulate a turbulent channel flow under a specific set of hypothetical grid resolution constraints. The problem provides the fundamental definitions for the friction Reynolds number, $Re_{\\tau}$, and wall-unit normalized grid spacing, $\\Delta \\xi^{+}$.\n\nGiven definitions are:\n$Re_{\\tau} = \\frac{u_{\\tau} h}{\\nu}$\n$\\Delta \\xi^{+} = \\frac{\\Delta \\xi \\, u_{\\tau}}{\\nu}$\nwhere $\\xi$ can be any of the spatial coordinates $\\{x, y, z\\}$. Here, $u_{\\tau}$ is the friction velocity, $h$ is the channel half-height, and $\\nu$ is the kinematic viscosity.\n\nOur first step is to derive an expression for the physical grid spacing, $\\Delta \\xi$, in terms of the given parameters $Re_{\\tau}$, $h$, and the target wall-unit spacing $\\Delta \\xi^{+}$. We can rearrange the definition of $Re_{\\tau}$ to solve for the ratio $\\frac{\\nu}{u_{\\tau}}$:\n$$ \\frac{\\nu}{u_{\\tau}} = \\frac{h}{Re_{\\tau}} $$\nNext, we rearrange the definition of $\\Delta \\xi^{+}$ to solve for the physical grid spacing $\\Delta \\xi$:\n$$ \\Delta \\xi = \\frac{\\Delta \\xi^{+} \\nu}{u_{\\tau}} $$\nSubstituting the expression for $\\frac{\\nu}{u_{\\tau}}$ into this equation yields:\n$$ \\Delta \\xi = \\Delta \\xi^{+} \\left( \\frac{h}{Re_{\\tau}} \\right) $$\nThis crucial relationship links the physical grid spacing to the friction Reynolds number and the desired wall-unit spacing.\n\nThe number of grid points in each direction ($N_x$, $N_y$, $N_z$) is given by the domain length in that direction divided by the grid spacing. The domain dimensions are given as $L_x \\times 2h \\times L_z$.\n\nFor the streamwise direction ($x$):\nThe domain length is $L_x = 8\\pi h$, and the grid spacing is $\\Delta x = \\Delta x^{+} \\frac{h}{Re_{\\tau}}$.\n$$ N_x = \\frac{L_x}{\\Delta x} = \\frac{8\\pi h}{\\Delta x^{+} \\frac{h}{Re_{\\tau}}} = \\frac{8\\pi Re_{\\tau}}{\\Delta x^{+}} $$\n\nFor the wall-normal direction ($y$):\nThe total domain height is $2h$, and the uniform grid spacing is $\\Delta y = \\Delta y^{+} \\frac{h}{Re_{\\tau}}$.\n$$ N_y = \\frac{2h}{\\Delta y} = \\frac{2h}{\\Delta y^{+} \\frac{h}{Re_{\\tau}}} = \\frac{2 Re_{\\tau}}{\\Delta y^{+}} $$\n\nFor the spanwise direction ($z$):\nThe domain length is $L_z = 3\\pi h$, and the grid spacing is $\\Delta z = \\Delta z^{+} \\frac{h}{Re_{\\tau}}$.\n$$ N_z = \\frac{L_z}{\\Delta z} = \\frac{3\\pi h}{\\Delta z^{+} \\frac{h}{Re_{\\tau}}} = \\frac{3\\pi Re_{\\tau}}{\\Delta z^{+}} $$\n\nThe total number of grid cells, $N$, is the product of the number of cells in each direction: $N = N_x N_y N_z$.\n$$ N = \\left( \\frac{8\\pi Re_{\\tau}}{\\Delta x^{+}} \\right) \\left( \\frac{2 Re_{\\tau}}{\\Delta y^{+}} \\right) \\left( \\frac{3\\pi Re_{\\tau}}{\\Delta z^{+}} \\right) $$\n$$ N = \\frac{8 \\cdot 2 \\cdot 3 \\cdot \\pi^2}{(\\Delta x^{+})(\\Delta y^{+})(\\Delta z^{+})} (Re_{\\tau})^3 = \\frac{48 \\pi^2}{(\\Delta x^{+})(\\Delta y^{+})(\\Delta z^{+})} (Re_{\\tau})^3 $$\n\nNow, we substitute the numerical values provided in the problem statement:\n- $Re_{\\tau} = 10^5$\n- $\\Delta x^{+} = 50$\n- $\\Delta y^{+} = 1$\n- $\\Delta z^{+} = 15$\n\n$$ N = \\frac{48 \\pi^2}{(50)(1)(15)} (10^5)^3 = \\frac{48 \\pi^2}{750} (10^{15}) $$\nWe can simplify the numerical pre-factor:\n$$ \\frac{48}{750} = \\frac{16}{250} = \\frac{8}{125} = 0.064 $$\nSo, the expression for $N$ becomes:\n$$ N = 0.064 \\pi^2 \\times 10^{15} = 6.4 \\pi^2 \\times 10^{13} $$\nTo obtain the final numerical value, we use $\\pi \\approx 3.14159$:\n$$ N \\approx 6.4 \\times (3.14159)^2 \\times 10^{13} \\approx 6.4 \\times 9.8696044 \\times 10^{13} $$\n$$ N \\approx 63.165468 \\times 10^{13} = 6.3165468 \\times 10^{14} $$\n\nThe problem requires rounding the final answer to two significant figures.\n$$ N \\approx 6.3 \\times 10^{14} $$\n\nAs a brief assessment of feasibility, we consider the memory requirements. A typical simulation stores multiple floating-point variables (e.g., three velocity components, pressure) at each grid point. Assuming $5$ variables per point and double-precision arithmetic ($8$ bytes per value), the total memory required would be approximately $N \\times 5 \\times 8$ bytes.\n$$ \\text{Memory} \\approx (6.3 \\times 10^{14}) \\times 40 \\text{ Bytes} = 2.52 \\times 10^{16} \\text{ Bytes} $$\nThis corresponds to approximately $25$ petabytes (PB). This memory requirement is at the extreme upper limit of, or exceeds, the capacity of the largest contemporary high-performance computing systems. Therefore, a grid with such specifications is computationally infeasible. This thought experiment starkly illustrates why practical high-Reynolds-number simulations cannot use a uniform fine grid in the wall-normal direction and must instead employ grid stretching to place resolution only where it is most needed, i.e., near the wall. This is a primary motivation for wall modeling itself, which relaxes the need for resolving the innermost parts of the boundary layer.",
            "answer": "$$\\boxed{6.3 \\times 10^{14}}$$"
        },
        {
            "introduction": "Having established the need for wall modeling, we now turn to its most fundamental implementation: the equilibrium wall-law model. This practice guides you through deriving the implicit equation that connects the resolved velocity to the wall shear stress via the logarithmic law of the wall. You will then implement a robust numerical solver to find the wall stress, a core task in the practical application of WMLES .",
            "id": "3391459",
            "problem": "Consider a canonical equilibrium turbulent boundary layer over a smooth, planar wall as encountered in Wall-Modeled Large Eddy Simulation (WMLES) for Large Eddy Simulation (LES). Assume the following foundational base: (i) the time-averaged streamwise momentum balance in the near-wall region is dominated by the wall shear stress, with friction velocity $u_{\\tau}$ defined by $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$ where $\\tau_{w}$ is the wall shear stress and $\\rho$ is the fluid density, (ii) the mean streamwise velocity $U(y)$ in the logarithmic layer obeys a similarity form that depends only on $u_{\\tau}$ and the kinematic viscosity $\\nu$, and (iii) dimensional analysis in the overlap region yields the logarithmic law of the wall for the mean velocity profile with universal constants von Kármán constant $\\kappa$ and additive constant $B$. From these bases, derive the implicit relation between the resolved velocity sampled at a wall-normal height $y_{m}$ and the wall shear stress, namely\n$$\nU(y_{m}) \\,=\\, \\sqrt{\\frac{\\tau_{w}}{\\rho}} \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_{m}\\sqrt{\\tau_{w}/\\rho}}{\\nu}\\right) + B \\right].\n$$\nYour derivation must begin from the definitions $u_{\\tau}=\\sqrt{\\tau_{w}/\\rho}$, $U^{+}=U/u_{\\tau}$, $y^{+}=y u_{\\tau}/\\nu$, and the overlap law $dU^{+}/dy^{+}=1/(\\kappa y^{+})$, and proceed to the stated implicit equation without assuming any intermediate shortcut formulas beyond these foundations.\n\nThen, design a robust Newton iteration to solve for $\\tau_{w}$ given measurements or inputs $U(y_{m})$, $y_{m}$, $\\rho$, $\\nu$, and the wall-law parameters $\\kappa$ and $B$. Your design must:\n- Specify the nonlinear residual in terms of $\\tau_{w}$ and its analytic derivative required by Newton’s method.\n- Discuss and incorporate safeguards suitable for computational practice in wall-modeled large eddy simulation, including positivity enforcement for $\\tau_{w}$, a line search or damping strategy to ensure global convergence, and a reasonable initial guess strategy derived from first principles. You may optionally reformulate the iteration in terms of $u_{\\tau}$ while returning $\\tau_{w}$ at the end; if you do so, clearly justify why this preserves correctness.\n- Provide clear stopping criteria based on the residual norm and relative update size.\n\nImplement your Newton solver as a program that, for a given small test suite of cases, outputs the computed $\\tau_{w}$ values. Use the following test suite to exercise different regimes:\n- Case $\\#1$ (air, moderate velocity, healthy logarithmic layer): $U(y_{m}) = 20\\,\\mathrm{m/s}$, $y_{m} = 0.005\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$.\n- Case $\\#2$ (air, lower velocity, deeper sample): $U(y_{m}) = 2\\,\\mathrm{m/s}$, $y_{m} = 0.01\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$.\n- Case $\\#3$ (air, higher velocity): $U(y_{m}) = 100\\,\\mathrm{m/s}$, $y_{m} = 0.01\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$.\n- Case $\\#4$ (water, moderate velocity, different fluid properties): $U(y_{m}) = 1\\,\\mathrm{m/s}$, $y_{m} = 0.001\\,\\mathrm{m}$, $\\rho = 1000\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.0\\times 10^{-6}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$.\n\nAll physical inputs are in International System of Units (SI). Your program must compute $\\tau_{w}$ for each case and express each final answer in $\\mathrm{Pa}$ (equivalently $\\mathrm{N/m^{2}}$) as a floating-point number. The required final output format is a single line containing a Python-style list of the four results in order, as a comma-separated list enclosed in square brackets, for example, $[x_{1},x_{2},x_{3},x_{4}]$.\n\nYour solution must be a complete, runnable program that implements the Newton solver with the outlined robustness features and produces exactly the required single-line output with the four $\\tau_{w}$ values for the specified test suite.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of turbulent fluid dynamics, well-posed, and provides a complete and consistent set of data and requirements for both the analytical derivation and the numerical implementation.\n\n### Part 1: Derivation of the Implicit Wall-Law Relation\n\nThe objective is to derive the implicit equation relating the mean velocity $U(y_m)$ at a height $y_m$ to the wall shear stress $\\tau_w$. The derivation shall commence from the foundational relations provided.\n\nThe given starting points are:\n1.  The definition of the friction velocity, $u_{\\tau}$:\n    $$u_{\\tau} = \\sqrt{\\frac{\\tau_{w}}{\\rho}}$$\n    where $\\tau_{w}$ is the wall shear stress and $\\rho$ is the fluid density.\n2.  The definitions of inner-scaled (wall-unit) velocity, $U^{+}$, and wall-normal distance, $y^{+}$:\n    $$U^{+} = \\frac{U}{u_{\\tau}}, \\quad y^{+} = \\frac{y u_{\\tau}}{\\nu}$$\n    where $U$ is the mean streamwise velocity at a distance $y$ from the wall, and $\\nu$ is the kinematic viscosity.\n3.  The differential form of the law of the wall, valid in the logarithmic overlap region:\n    $$\\frac{dU^{+}}{dy^{+}} = \\frac{1}{\\kappa y^{+}}$$\n    where $\\kappa$ is the von Kármán constant.\n\nWe begin by integrating the differential form of the law of the wall with respect to $y^{+}$:\n$$ \\int dU^{+} = \\int \\frac{1}{\\kappa y^{+}} dy^{+} $$\nThis integration yields:\n$$ U^{+}(y^{+}) = \\frac{1}{\\kappa} \\ln(y^{+}) + C $$\nHere, $C$ is the constant of integration. In the theory of wall-bounded turbulence, this constant is determined by matching this logarithmic profile with the velocity profile in the viscous sublayer. This matching process establishes $C$ as another universal constant, commonly denoted by $B$. Thus, we have the integrated law of the wall:\n$$ U^{+}(y^{+}) = \\frac{1}{\\kappa} \\ln(y^{+}) + B $$\n\nNext, we substitute the definitions of the wall units $U^{+}$ and $y^{+}$ back into this equation. The velocity $U$ is sampled at a specific wall-normal location, which we denote as $y_m$.\n$$ \\frac{U(y_m)}{u_{\\tau}} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_{\\tau}}{\\nu}\\right) + B $$\n\nTo obtain the final relation in terms of $\\tau_w$, we substitute the definition of the friction velocity, $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$:\n$$ \\frac{U(y_m)}{\\sqrt{\\tau_w/\\rho}} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m \\sqrt{\\tau_w/\\rho}}{\\nu}\\right) + B $$\n\nFinally, multiplying both sides by $\\sqrt{\\tau_w/\\rho}$ gives the desired implicit relation for $\\tau_w$:\n$$ U(y_m) = \\sqrt{\\frac{\\tau_w}{\\rho}} \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m \\sqrt{\\tau_w/\\rho}}{\\nu}\\right) + B \\right] $$\nThis completes the derivation. This equation forms the basis of the wall model, connecting the resolved velocity $U(y_m)$ from the outer Large Eddy Simulation (LES) to the subgrid wall shear stress $\\tau_w$.\n\n### Part 2: Design of a Robust Newton Solver\n\nThe task is to solve the derived implicit equation for $\\tau_w$ given $U(y_m)$, $y_m$, $\\rho$, $\\nu$, $\\kappa$, and $B$. A Newton-Raphson method provides an efficient iterative approach.\n\n**Formulation of the Root-Finding Problem**\n\nIt is numerically advantageous to solve for the friction velocity $u_\\tau$ rather than $\\tau_w$ directly. This reformulation naturally enforces the physical constraint $\\tau_w > 0$ by ensuring $u_\\tau > 0$, and it simplifies the logarithmic term. The relationship $\\tau_w = \\rho u_{\\tau}^2$ is monotonic for positive $u_\\tau$, so a unique positive solution for $u_\\tau$ guarantees a unique positive solution for $\\tau_w$.\n\nWe define a residual function $R(u_\\tau)$ whose root we seek to find:\n$$ R(u_\\tau) = u_\\tau \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right] - U(y_m) = 0 $$\n\n**Newton Iteration Scheme**\n\nThe Newton-Raphson method iteratively finds the root using the update rule:\n$$ u_{\\tau, k+1} = u_{\\tau, k} - \\frac{R(u_{\\tau, k})}{R'(u_{\\tau, k})} $$\nwhere $k$ is the iteration index and $R'(u_\\tau)$ is the derivative of the residual function with respect to $u_\\tau$.\n\nWe compute the analytic derivative $R'(u_\\tau)$:\n$$ R'(u_\\tau) = \\frac{d}{du_\\tau} \\left( u_\\tau \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right] - U(y_m) \\right) $$\nUsing the product rule on the first term:\n$$ R'(u_\\tau) = \\left( \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right) + u_\\tau \\left( \\frac{1}{\\kappa} \\frac{1}{(y_m u_\\tau / \\nu)} \\frac{y_m}{\\nu} \\right) $$\n$$ R'(u_\\tau) = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B + \\frac{1}{\\kappa} $$\nThis derivative is positive for all physically relevant conditions (i.e., for $y^{+} > 1$), ensuring that the function $R(u_\\tau)$ is monotonic and a unique root exists.\n\n**Robustness Enhancements**\n\nFor use in a production CFD code, the solver must be robust.\n\n1.  **Initial Guess**: A good initial guess, $u_{\\tau, 0}$, is crucial for fast convergence. We can estimate $u_{\\tau}$ using a skin friction coefficient $C_f$, where $\\tau_w = C_f \\frac{1}{2} \\rho U^2$. A typical value for turbulent boundary layers is $C_f \\approx 0.005$. This gives:\n    $$ \\tau_{w,0} \\approx 0.005 \\times \\frac{1}{2} \\rho U(y_m)^2 $$\n    $$ u_{\\tau,0} = \\sqrt{\\frac{\\tau_{w,0}}{\\rho}} \\approx \\sqrt{0.0025 \\cdot U(y_m)^2} = 0.05 \\cdot U(y_m) $$\n    This provides a physically-based, positive initial value for $u_\\tau$.\n\n2.  **Positivity and Convergence (Line Search)**: A full Newton step $\\Delta u_\\tau = -R/R'$ might be too large, potentially leading to a non-physical negative $u_\\tau$ or divergence. A backtracking line search is employed to prevent this. The update is modified to:\n    $$ u_{\\tau, k+1} = u_{\\tau, k} + \\alpha \\Delta u_\\tau $$\n    where $\\alpha \\in (0, 1]$ is a damping factor. We start with $\\alpha = 1$ (full step). If the proposed update $u_{\\tau, k+1}$ is non-positive, or if the residual norm does not decrease (i.e., $|R(u_{\\tau, k+1})| \\ge |R(u_{\\tau, k})|$), $\\alpha$ is successively halved (e.g., $\\alpha \\leftarrow \\alpha/2$) and the step is re-evaluated. This ensures that each iteration is a descent step towards the solution and maintains positivity.\n\n**Stopping Criteria**\n\nThe iteration terminates when the solution is sufficiently converged. This is checked using a combination of criteria:\n1.  **Absolute Residual**: The residual is close to zero: $|R(u_{\\tau, k})| < \\epsilon_{abs}$.\n2.  **Relative Update**: The relative change in the solution is small: $|u_{\\tau, k} - u_{\\tau, k-1}| < \\epsilon_{rel} |u_{\\tau,k}|$.\nThe iteration also terminates if a maximum number of iterations is reached, indicating a failure to converge.\n\nOnce the iteration has converged to a final value $u_\\tau^*$, the wall shear stress is computed as $\\tau_w = \\rho (u_\\tau^*)^2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef newton_solve_tau_w(U_m, y_m, rho, nu, kappa, B, tol=1e-9, max_iter=50, min_alpha=1e-8):\n    \"\"\"\n    Solves for the wall shear stress tau_w using a robust Newton method.\n\n    The solver finds the root of the wall-law equation by iterating on the\n    friction velocity u_tau.\n\n    Args:\n        U_m (float): Velocity at measurement height y_m.\n        y_m (float): Wall-normal measurement height.\n        rho (float): Fluid density.\n        nu (float): Fluid kinematic viscosity.\n        kappa (float): von Kármán constant.\n        B (float): Additive constant in the law of the wall.\n        tol (float): Convergence tolerance for the residual.\n        max_iter (int): Maximum number of iterations.\n        min_alpha (float): Minimum damping factor for the line search.\n\n    Returns:\n        float: The computed wall shear stress tau_w in Pascals.\n    \"\"\"\n\n    # Initial guess for u_tau based on a typical skin friction coefficient\n    # C_f_guess = 0.005, so tau_w = 0.5 * rho * U_m^2 * C_f_guess\n    # u_tau = sqrt(tau_w/rho) = U_m * sqrt(0.5 * C_f_guess) = U_m * 0.05\n    u_tau = 0.05 * U_m\n    \n    # Ensure initial u_tau is at least a small positive number to avoid log(0)\n    if u_tau <= 0:\n        # Fallback for U_m=0 or negative (unphysical for this problem)\n        # Choose a small value based on viscosity and distance\n        u_tau = nu / y_m\n\n    for i in range(max_iter):\n        # Avoid division by zero or errors if u_tau becomes non-positive,\n        # although the line search should prevent this.\n        if u_tau <= 0:\n            raise RuntimeError(\"Newton iteration produced non-positive u_tau.\")\n\n        # Calculate residual R(u_tau) and its derivative R'(u_tau)\n        y_plus = y_m * u_tau / nu\n        log_y_plus = np.log(y_plus)\n        \n        # Residual function: R(u_tau) = u_tau * (1/kappa*ln(y^+) + B) - U_m\n        residual = u_tau * (log_y_plus / kappa + B) - U_m\n        \n        # Check for convergence based on residual norm\n        if abs(residual) < tol and i > 0:\n            break\n            \n        # Derivative of the residual function: R'(u_tau) = 1/kappa*ln(y^+) + B + 1/kappa\n        derivative = (log_y_plus / kappa) + B + (1.0 / kappa)\n\n        if derivative == 0:\n            raise RuntimeError(\"Derivative is zero, Newton method fails.\")\n\n        # Newton step\n        delta_u_tau = -residual / derivative\n        \n        # Backtracking line search to ensure positivity and convergence\n        alpha = 1.0\n        while alpha > min_alpha:\n            u_tau_new = u_tau + alpha * delta_u_tau\n            \n            if u_tau_new > 0:\n                # Calculate new residual to check for descent\n                y_plus_new = y_m * u_tau_new / nu\n                residual_new = u_tau_new * (np.log(y_plus_new) / kappa + B) - U_m\n                \n                # Armijo-like condition: check for sufficient decrease in residual\n                if abs(residual_new) < abs(residual):\n                    u_tau = u_tau_new\n                    break # Exit line search\n            \n            alpha /= 2.0 # Reduce damping factor\n        \n        if alpha <= min_alpha:\n            raise RuntimeError(f\"Line search failed to find a convergent step for case with U_m={U_m}.\")\n\n    else: # This else belongs to the for-loop, executed if loop finishes without break\n        raise RuntimeError(f\"Newton solver did not converge within {max_iter} iterations for case with U_m={U_m}.\")\n        \n    # Convert final u_tau to tau_w\n    tau_w = rho * u_tau**2\n    return tau_w\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (U(y_m), y_m, rho, nu, kappa, B)\n    test_cases = [\n        (20.0, 0.005, 1.225, 1.5e-5, 0.41, 5.2),  # Case 1\n        (2.0, 0.01, 1.225, 1.5e-5, 0.41, 5.2),   # Case 2\n        (100.0, 0.01, 1.225, 1.5e-5, 0.41, 5.2), # Case 3\n        (1.0, 0.001, 1000.0, 1.0e-6, 0.41, 5.2), # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        U_m, y_m, rho, nu, kappa, B = case\n        tau_w = newton_solve_tau_w(U_m, y_m, rho, nu, kappa, B)\n        results.append(tau_w)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The classic law of the wall assumes an idealized equilibrium boundary layer, a condition often violated in complex flows with pressure gradients. This final practice explores a more advanced approach by deriving and implementing a wall model from the integrated momentum equation. This method directly accounts for the effect of streamwise pressure gradients on the wall shear stress, providing a more accurate and robust foundation for WMLES in non-equilibrium conditions .",
            "id": "3391442",
            "problem": "Consider an incompressible, steady wall-bounded flow simulated using Large Eddy Simulation (LES, Large Eddy Simulation). Let the streamwise momentum be modeled in a thin wall layer from $y=0$ to $y=y_m$ using a control-volume integration of the filtered momentum equation under boundary-layer assumptions (streamwise gradients only through pressure and wall-normal gradients only through shear stress). The wall shear stress is denoted by $\\tau_w$, and the resolved total shear stress at the matching location $y=y_m$ is denoted by $\\tau_{xy}(y_m)$. The streamwise pressure gradient profile within the wall layer is prescribed as a polynomial function of the wall-normal coordinate $y$ of the form $g(y)=a_0+a_1 y+a_2 y^2+a_3 y^3$, with $g$ measured in Pascal per meter (Pa/m) and $y$ in meters (m). The total stress and pressure are understood as filtered/averaged quantities appropriate for wall-modeled LES. Using only first principles, derive the integrated streamwise momentum balance for the wall layer that links the wall shear stress $\\tau_w$ to the resolved shear stress $\\tau_{xy}(y_m)$ and the wall-normal integral of the streamwise pressure gradient over $[0,y_m]$. Based on this result, design an algorithm that, given $y_m$, the polynomial coefficients $(a_0,a_1,a_2,a_3)$ for $g(y)$, and the resolved shear $\\tau_{xy}(y_m)$, computes $\\tau_w$ in Pascal (Pa). Your algorithm must enforce the exact control-volume balance implied by the integrated momentum equation. \n\nYour program must implement this algorithm and evaluate it on the following test suite to assess robustness, including cases with zero pressure gradient, favorable pressure gradient, adverse pressure gradient, and strong adverse pressure gradient that can drive the wall shear toward negative values. All quantities are specified in SI units: pressure gradient in Pa/m, wall-normal distance in m, and shear stress in Pa.\n\n- Test case $1$ (zero pressure gradient, happy path): $y_m=0.05$, $(a_0,a_1,a_2,a_3)=(0,0,0,0)$, $\\tau_{xy}(y_m)=1.5$.\n- Test case $2$ (constant favorable pressure gradient): $y_m=0.05$, $(a_0,a_1,a_2,a_3)=(-2,0,0,0)$, $\\tau_{xy}(y_m)=1.0$.\n- Test case $3$ (constant adverse pressure gradient): $y_m=0.05$, $(a_0,a_1,a_2,a_3)=(5,0,0,0)$, $\\tau_{xy}(y_m)=0.4$.\n- Test case $4$ (linearly increasing adverse pressure gradient): $y_m=0.02$, $(a_0,a_1,a_2,a_3)=(20,100,0,0)$, $\\tau_{xy}(y_m)=0.3$.\n- Test case $5$ (strong adverse pressure gradient with quadratic profile): $y_m=0.01$, $(a_0,a_1,a_2,a_3)=(0,0,1000,0)$, $\\tau_{xy}(y_m)=0.0002$.\n- Test case $6$ (boundary-layer thickness approaching zero): $y_m=0.000001$, $(a_0,a_1,a_2,a_3)=(10,0,0,0)$, $\\tau_{xy}(y_m)=0.8$.\n\nYour implementation should compute, for each test case, the wall shear stress $\\tau_w$ in Pascal (Pa). The final output format must be a single line containing the computed wall shear stresses as a comma-separated list enclosed in square brackets, for example $[\\tau_{w,1},\\tau_{w,2},\\ldots,\\tau_{w,6}]$, with each entry being a floating-point number in Pascal (Pa). No additional text should be printed.",
            "solution": "The problem is assessed to be **valid**. It is scientifically grounded in the principles of fluid dynamics, specifically the momentum balance in a boundary layer. The problem is well-posed, objective, and provides all necessary information to derive a unique solution. It does not violate any of the invalidity criteria.\n\nThe core task is to derive an expression for the wall shear stress, $\\tau_w$, based on a control-volume integration of the simplified streamwise momentum equation for a wall-modeled Large Eddy Simulation (LES).\n\nWe begin with the filtered, steady, incompressible momentum equation in the streamwise direction ($x$-direction). The problem states to use boundary-layer assumptions, specifically that streamwise gradients are significant only for the pressure term and wall-normal gradients ($y$-direction) are significant only for the shear stress term. This is a strong simplification, often used in equilibrium boundary layer theory, which implies that the convective acceleration terms are negligible compared to the pressure and viscous/turbulent stress terms within the thin wall layer. This simplification of the momentum balance is expressed as:\n$$\n\\frac{\\partial \\tau_{xy}}{\\partial y} \\approx \\frac{\\partial \\bar{P}}{\\partial x}\n$$\nwhere $\\tau_{xy}$ is the total shear stress (sum of viscous and turbulent Reynolds/subgrid-scale stress), and $\\frac{\\partial \\bar{P}}{\\partial x}$ is the mean streamwise pressure gradient. The problem provides this pressure gradient as a function of the wall-normal coordinate $y$, denoted by $g(y)$, such that:\n$$\n\\frac{d\\tau_{xy}}{dy} = g(y)\n$$\nHere, we use an ordinary derivative as $\\tau_{xy}$ is assumed to vary only with $y$ within this thin layer.\n\nTo find the relationship between the stress at the wall and the stress at the matching height $y_m$, we perform a control-volume analysis by integrating this equation with respect to $y$ from the wall ($y=0$) to the matching location ($y=y_m$):\n$$\n\\int_{y=0}^{y=y_m} \\frac{d\\tau_{xy}}{dy} dy = \\int_{y=0}^{y=y_m} g(y) dy\n$$\nApplying the fundamental theorem of calculus to the left-hand side, we get:\n$$\n[\\tau_{xy}(y)]_{0}^{y_m} = \\tau_{xy}(y_m) - \\tau_{xy}(0)\n$$\nBy definition, the shear stress at the wall, $\\tau_{xy}(0)$, is the wall shear stress, $\\tau_w$. Therefore, the integrated momentum balance becomes:\n$$\n\\tau_{xy}(y_m) - \\tau_w = \\int_{0}^{y_m} g(y) dy\n$$\nThis equation represents the exact control-volume balance requested. It states that the change in shear stress across the layer, from $\\tau_w$ at the bottom to $\\tau_{xy}(y_m)$ at the top, is balanced by the total force exerted by the pressure gradient on the fluid within that layer.\n\nTo design the algorithm, we rearrange the equation to solve for the unknown wall shear stress, $\\tau_w$:\n$$\n\\tau_w = \\tau_{xy}(y_m) - \\int_{0}^{y_m} g(y) dy\n$$\nThe problem specifies the pressure gradient profile as a polynomial:\n$$\ng(y) = a_0 + a_1 y + a_2 y^2 + a_3 y^3\n$$\nWe must now compute the definite integral of $g(y)$ from $0$ to $y_m$:\n$$\n\\int_{0}^{y_m} (a_0 + a_1 y + a_2 y^2 + a_3 y^3) dy = \\left[ a_0 y + \\frac{a_1}{2} y^2 + \\frac{a_2}{3} y^3 + \\frac{a_3}{4} y^4 \\right]_{0}^{y_m}\n$$\nEvaluating the antiderivative at the limits of integration yields:\n$$\n\\int_{0}^{y_m} g(y) dy = \\left( a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4 \\right) - (0)\n$$\nLet this integral be denoted by $I_p$. The final expression for the wall shear stress is:\n$$\n\\tau_w = \\tau_{xy}(y_m) - I_p = \\tau_{xy}(y_m) - \\left( a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4 \\right)\n$$\nThis formula provides the basis for the algorithm.\n\nThe algorithmic steps are:\n1.  Receive the inputs: the matching height $y_m$, the polynomial coefficients $(a_0, a_1, a_2, a_3)$ for the pressure gradient $g(y)$, and the resolved shear stress at the matching height, $\\tau_{xy}(y_m)$.\n2.  Calculate the value of the pressure gradient integral, $I_p$, using the derived formula:\n    $I_p = a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4$.\n3.  Calculate the wall shear stress $\\tau_w$ using the momentum balance equation:\n    $\\tau_w = \\tau_{xy}(y_m) - I_p$.\n4.  Return the computed value of $\\tau_w$.\n\nThis algorithm will now be implemented to evaluate the provided test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the wall shear stress based on an integrated momentum balance for a wall-modeled LES.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (y_m, (a0, a1, a2, a3), tau_xy_m)\n    test_cases = [\n        (0.05, (0, 0, 0, 0), 1.5),         # Case 1\n        (0.05, (-2, 0, 0, 0), 1.0),        # Case 2\n        (0.05, (5, 0, 0, 0), 0.4),         # Case 3\n        (0.02, (20, 100, 0, 0), 0.3),      # Case 4\n        (0.01, (0, 0, 1000, 0), 0.0002),   # Case 5\n        (0.000001, (10, 0, 0, 0), 0.8),    # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        ym, coeffs, tau_xy_m = case\n        a0, a1, a2, a3 = coeffs\n\n        # Calculate the definite integral of the pressure gradient g(y) from 0 to ym.\n        # The integral of g(y) = a0 + a1*y + a2*y^2 + a3*y^3 is:\n        # I_p = a0*ym + (a1/2)*ym^2 + (a2/3)*ym^3 + (a3/4)*ym^4\n        integral_g = (a0 * ym + \n                      a1 * (ym**2) / 2.0 + \n                      a2 * (ym**3) / 3.0 + \n                      a3 * (ym**4) / 4.0)\n\n        # The integrated momentum balance is: tau_xy_m - tau_w = integral_g\n        # Therefore, tau_w = tau_xy_m - integral_g\n        tau_w = tau_xy_m - integral_g\n        \n        results.append(tau_w)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}