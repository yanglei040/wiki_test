{
    "hands_on_practices": [
        {
            "introduction": "对于高雷诺数流动，为何壁面模化是必不可少的？本练习通过一个尺度分析练习，为我们提供了定量的解答。通过估算直接解析近壁区域所需的惊人计算成本，你将亲身体会到驱动壁面模化大涡模拟（WMLES）发展的根本挑战。 这个练习揭示了湍流模拟中的“维度灾难”，并确立了壁面模化的实践必要性。",
            "id": "3391472",
            "problem": "考虑在一个尺寸为 $L_{x} \\times 2h \\times L_{z}$ 的区域内，摩擦雷诺数 $Re_{\\tau} = 10^{5}$ 的不可压缩湍流平面槽道流，其中 $h$ 是槽道半高。假设在壁面模化大涡模拟 (WMLES) 的背景下，但作为一个评估相对于壁面单位的分辨率需求的思想实验，我们坚持要求近壁目标间距为 $\\Delta x^{+} \\approx 50$ 和 $\\Delta z^{+} \\approx 15$，并且在整个高度上应用一个保守的、与壁面值相等的均匀法向间距，即 $\\Delta y^{+} \\approx 1$。取标准槽道流大涡模拟的区域范围 $L_{x} = 8\\pi h$ 和 $L_{z} = 3\\pi h$。仅使用壁面单位和摩擦雷诺数的核心定义，推导出在这些假设下各方向所需的网格点数 $N_{x}$、$N_{y}$ 和 $N_{z}$ 的表达式，并计算总网格单元数 $N = N_{x} N_{y} N_{z}$。\n\n说明：\n- 使用定义 $Re_{\\tau} = u_{\\tau} h / \\nu$ 和 $\\Delta \\xi^{+} = \\Delta \\xi \\, u_{\\tau} / \\nu$，其中 $\\xi \\in \\{x,y,z\\}$。\n- 假设流向和展向的间距是均匀的，并与目标壁面单位间距一致；法向间距在整个 $2h$ 高度上也是均匀的，且等于壁面值 $\\Delta y^{+} \\approx 1$。\n- 为 $Re_{\\tau} = 10^{5}$，$L_{x} = 8\\pi h$，$L_{z} = 3\\pi h$，$\\Delta x^{+} = 50$，$\\Delta z^{+} = 15$ 和 $\\Delta y^{+} = 1$ 计算 $N$ 的单个数值。\n- 将 $N$ 的最终答案四舍五入至两位有效数字，并以无单位的纯数字形式表示。\n\n在计算出 $N$ 之后，在您的解答中简要评估这种网格在当代高性能计算上在数量级内存需求方面的可行性，但请注意，最终答案必须只是单个四舍五入后的 $N$。",
            "solution": "该问题已经过验证，被认为是合理的。它提出了一个计算流体力学中适定的思想实验，该实验基于标准定义，没有科学或逻辑上的矛盾，并包含了获得唯一解所需的所有信息。其中的假设虽然对于真实世界的模拟来说不切实际，但是为了评估分辨率需求的理论计算而被明确说明。\n\n目标是在一组特定的假设性网格分辨率约束下，计算模拟湍流槽道流所需的总网格单元数 $N$。问题给出了摩擦雷诺数 $Re_{\\tau}$ 和经壁面单位归一化的网格间距 $\\Delta \\xi^{+}$ 的基本定义。\n\n给定的定义是：\n$Re_{\\tau} = \\frac{u_{\\tau} h}{\\nu}$\n$\\Delta \\xi^{+} = \\frac{\\Delta \\xi \\, u_{\\tau}}{\\nu}$\n其中 $\\xi$ 可以是任何空间坐标 $\\{x, y, z\\}$。这里，$u_{\\tau}$ 是摩擦速度，$h$ 是槽道半高，$\\nu$ 是运动粘度。\n\n我们的第一步是根据给定的参数 $Re_{\\tau}$、$h$ 和目标壁面单位间距 $\\Delta \\xi^{+}$，推导物理网格间距 $\\Delta \\xi$ 的表达式。我们可以重新整理 $Re_{\\tau}$ 的定义，以求解比率 $\\frac{\\nu}{u_{\\tau}}$：\n$$ \\frac{\\nu}{u_{\\tau}} = \\frac{h}{Re_{\\tau}} $$\n接下来，我们重新整理 $\\Delta \\xi^{+}$ 的定义，以求解物理网格间距 $\\Delta \\xi$：\n$$ \\Delta \\xi = \\frac{\\Delta \\xi^{+} \\nu}{u_{\\tau}} $$\n将 $\\frac{\\nu}{u_{\\tau}}$ 的表达式代入该方程，得到：\n$$ \\Delta \\xi = \\Delta \\xi^{+} \\left( \\frac{h}{Re_{\\tau}} \\right) $$\n这个关键关系将物理网格间距与摩擦雷诺数和期望的壁面单位间距联系起来。\n\n每个方向上的网格点数（$N_x$, $N_y$, $N_z$）由该方向上的区域长度除以网格间距得出。区域尺寸给定为 $L_x \\times 2h \\times L_z$。\n\n对于流向（$x$）：\n区域长度为 $L_x = 8\\pi h$，网格间距为 $\\Delta x = \\Delta x^{+} \\frac{h}{Re_{\\tau}}$。\n$$ N_x = \\frac{L_x}{\\Delta x} = \\frac{8\\pi h}{\\Delta x^{+} \\frac{h}{Re_{\\tau}}} = \\frac{8\\pi Re_{\\tau}}{\\Delta x^{+}} $$\n\n对于法向（$y$）：\n总区域高度为 $2h$，均匀网格间距为 $\\Delta y = \\Delta y^{+} \\frac{h}{Re_{\\tau}}$。\n$$ N_y = \\frac{2h}{\\Delta y} = \\frac{2h}{\\Delta y^{+} \\frac{h}{Re_{\\tau}}} = \\frac{2 Re_{\\tau}}{\\Delta y^{+}} $$\n\n对于展向（$z$）：\n区域长度为 $L_z = 3\\pi h$，网格间距为 $\\Delta z = \\Delta z^{+} \\frac{h}{Re_{\\tau}}$。\n$$ N_z = \\frac{L_z}{\\Delta z} = \\frac{3\\pi h}{\\Delta z^{+} \\frac{h}{Re_{\\tau}}} = \\frac{3\\pi Re_{\\tau}}{\\Delta z^{+}} $$\n\n总网格单元数 $N$ 是各方向上网格单元数的乘积：$N = N_x N_y N_z$。\n$$ N = \\left( \\frac{8\\pi Re_{\\tau}}{\\Delta x^{+}} \\right) \\left( \\frac{2 Re_{\\tau}}{\\Delta y^{+}} \\right) \\left( \\frac{3\\pi Re_{\\tau}}{\\Delta z^{+}} \\right) $$\n$$ N = \\frac{8 \\cdot 2 \\cdot 3 \\cdot \\pi^2}{(\\Delta x^{+})(\\Delta y^{+})(\\Delta z^{+})} (Re_{\\tau})^3 = \\frac{48 \\pi^2}{(\\Delta x^{+})(\\Delta y^{+})(\\Delta z^{+})} (Re_{\\tau})^3 $$\n\n现在，我们代入问题陈述中提供的数值：\n- $Re_{\\tau} = 10^5$\n- $\\Delta x^{+} = 50$\n- $\\Delta y^{+} = 1$\n- $\\Delta z^{+} = 15$\n\n$$ N = \\frac{48 \\pi^2}{(50)(1)(15)} (10^5)^3 = \\frac{48 \\pi^2}{750} (10^{15}) $$\n我们可以简化数值前置因子：\n$$ \\frac{48}{750} = \\frac{16}{250} = \\frac{8}{125} = 0.064 $$\n因此，$N$ 的表达式变为：\n$$ N = 0.064 \\pi^2 \\times 10^{15} = 6.4 \\pi^2 \\times 10^{13} $$\n为了获得最终数值，我们使用 $\\pi \\approx 3.14159$：\n$$ N \\approx 6.4 \\times (3.14159)^2 \\times 10^{13} \\approx 6.4 \\times 9.8696044 \\times 10^{13} $$\n$$ N \\approx 63.165468 \\times 10^{13} = 6.3165468 \\times 10^{14} $$\n\n问题要求将最终答案四舍五入到两位有效数字。\n$$ N \\approx 6.3 \\times 10^{14} $$\n\n作为对可行性的简要评估，我们考虑内存需求。一个典型的模拟在每个网格点上存储多个浮点变量（例如，三个速度分量、压力）。假设每个点有 $5$ 个变量，并采用双精度算术（每个值 $8$ 字节），所需的总内存大约为 $N \\times 5 \\times 8$ 字节。\n$$ \\text{内存} \\approx (6.3 \\times 10^{14}) \\times 40 \\text{ 字节} = 2.52 \\times 10^{16} \\text{ 字节} $$\n这大约相当于 $25$ 拍字节 (PB)。这一内存需求达到了或超过了当代最大型高性能计算系统的容量上限。因此，具有这样规格的网格在计算上是不可行的。这个思想实验鲜明地说明了为什么实际的高雷诺数模拟不能在法向方向上使用均匀的细网格，而必须采用网格拉伸，将分辨率仅放置在最需要的地方，即近壁区域。这本身就是壁面模化的一个主要动机，它放宽了对解析边界层最内部区域的需求。",
            "answer": "$$\\boxed{6.3 \\times 10^{14}}$$"
        },
        {
            "introduction": "大多数WMLES实现的核心是一个代数壁面模型，其中平衡态对数律是最基础的一种。本练习将带你完成推导这一核心关系的全过程，并实现一个稳健的数值求解器来计算壁面剪切应力。 掌握这一实践至关重要，因为它构成了在WMLES中施加边界条件的基础，并将已解析的外部流动与未解析的壁面物理联系起来。",
            "id": "3391459",
            "problem": "考虑在用于大涡模拟 (LES) 的壁面模化大涡模拟 (WMLES) 中遇到的光滑平坦壁面上的典范平衡湍流边界层。假设以下基本前提：(i) 近壁区域的时间平均流向动量平衡由壁面剪切应力主导，其中摩擦速度 $u_{\\tau}$ 定义为 $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$，$\\tau_{w}$ 是壁面剪切应力，$\\rho$ 是流体密度；(ii) 对数层中的平均流向速度 $U(y)$ 服从仅依赖于 $u_{\\tau}$ 和运动粘度 $\\nu$ 的相似形式；(iii) 重叠区的量纲分析得出适用于平均速度剖面的壁面律对数律，其中包含普适的冯·卡门常数 $\\kappa$ 和加法常数 $B$。基于这些前提，推导在壁面法向高度 $y_{m}$ 处采样的解析速度与壁面剪切应力之间的隐式关系，即\n$$\nU(y_{m}) \\,=\\, \\sqrt{\\frac{\\tau_{w}}{\\rho}} \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_{m}\\sqrt{\\tau_{w}/\\rho}}{\\nu}\\right) + B \\right].\n$$\n您的推导必须从定义 $u_{\\tau}=\\sqrt{\\tau_{w}/\\rho}$、$U^{+}=U/u_{\\tau}$、$y^{+}=y u_{\\tau}/\\nu$ 和重叠律 $dU^{+}/dy^{+}=1/(\\kappa y^{+})$ 开始，并直接推导出所述的隐式方程，不得假设除这些基础之外的任何中间捷径公式。\n\n然后，设计一个稳健的牛顿迭代法，用于在给定测量值或输入值 $U(y_{m})$、$y_{m}$、$\\rho$、$\\nu$ 以及壁面律参数 $\\kappa$ 和 $B$ 的情况下求解 $\\tau_{w}$。您的设计必须：\n- 以 $\\tau_{w}$ 及其解析导数的形式，指定牛顿法所需的非线性残差。\n- 讨论并整合适用于壁面模化大涡模拟计算实践的保障措施，包括强制 $\\tau_{w}$ 为正值、确保全局收敛的线搜索或阻尼策略，以及从第一性原理推导出的合理初始猜测策略。您可以选择用 $u_{\\tau}$ 来重构迭代过程，并在最后返回 $\\tau_{w}$；如果这样做，请清楚地说明为什么这种方法能保持正确性。\n- 提供基于残差范数和相对更新大小的明确停止准则。\n\n将您的牛顿求解器实现为一个程序，该程序针对一组给定的小型测试案例，输出计算出的 $\\tau_{w}$ 值。使用以下测试套件来检验不同的工况：\n- 案例 #1 (空气，中等速度，健康的对数层): $U(y_{m}) = 20\\,\\mathrm{m/s}$, $y_{m} = 0.005\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$。\n- 案例 #2 (空气，较低速度，更深的采样点): $U(y_{m}) = 2\\,\\mathrm{m/s}$, $y_{m} = 0.01\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$。\n- 案例 #3 (空气，较高速度): $U(y_{m}) = 100\\,\\mathrm{m/s}$, $y_{m} = 0.01\\,\\mathrm{m}$, $\\rho = 1.225\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$。\n- 案例 #4 (水，中等速度，不同流体属性): $U(y_{m}) = 1\\,\\mathrm{m/s}$, $y_{m} = 0.001\\,\\mathrm{m}$, $\\rho = 1000\\,\\mathrm{kg/m^{3}}$, $\\nu = 1.0\\times 10^{-6}\\,\\mathrm{m^{2}/s}$, $\\kappa = 0.41$, $B = 5.2$。\n\n所有物理输入均采用国际单位制 (SI)。您的程序必须为每个案例计算 $\\tau_{w}$，并将每个最终答案以帕斯卡 ($\\mathrm{Pa}$，等效于 $\\mathrm{N/m^{2}}$) 为单位表示为浮点数。要求的最终输出格式为单行文本，包含一个 Python 风格的列表，按顺序包含四个结果，以逗号分隔并用方括号括起来，例如 $[x_{1},x_{2},x_{3},x_{4}]$。\n\n您的解决方案必须是一个完整、可运行的程序，该程序实现了具有所述稳健性特征的牛顿求解器，并为指定的测试套件生成包含四个 $\\tau_{w}$ 值的、格式完全符合要求的单行输出。",
            "solution": "该问题是有效的，因为它在科学上基于湍流流体动力学原理，问题提法适定 (well-posed)，并为解析推导和数值实现提供了完整且一致的数据集和要求。\n\n### 第 1 部分：隐式壁面律关系的推导\n\n目标是推导在高度 $y_m$ 处的平均速度 $U(y_m)$ 与壁面剪切应力 $\\tau_w$ 相关联的隐式方程。推导应从所提供的基本关系开始。\n\n给定的出发点是：\n1.  摩擦速度 $u_{\\tau}$ 的定义：\n    $$u_{\\tau} = \\sqrt{\\frac{\\tau_{w}}{\\rho}}$$\n    其中 $\\tau_{w}$ 是壁面剪切应力，$\\rho$ 是流体密度。\n2.  内尺度（壁面单位）速度 $U^{+}$ 和壁面法向距离 $y^{+}$ 的定义：\n    $$U^{+} = \\frac{U}{u_{\\tau}}, \\quad y^{+} = \\frac{y u_{\\tau}}{\\nu}$$\n    其中 $U$ 是距离壁面 $y$ 处的平均流向速度，$\\nu$ 是运动粘度。\n3.  壁面律的微分形式，在对数重叠区有效：\n    $$\\frac{dU^{+}}{dy^{+}} = \\frac{1}{\\kappa y^{+}}$$\n    其中 $\\kappa$ 是冯·卡门常数。\n\n我们首先对壁面律的微分形式关于 $y^{+}$ 进行积分：\n$$ \\int dU^{+} = \\int \\frac{1}{\\kappa y^{+}} dy^{+} $$\n积分得到：\n$$ U^{+}(y^{+}) = \\frac{1}{\\kappa} \\ln(y^{+}) + C $$\n这里，$C$ 是积分常数。在壁湍流理论中，该常数是通过将此对数剖面与粘性子层中的速度剖面进行匹配来确定的。这个匹配过程将 $C$ 确立为另一个普适常数，通常用 $B$ 表示。因此，我们得到了积分形式的壁面律：\n$$ U^{+}(y^{+}) = \\frac{1}{\\kappa} \\ln(y^{+}) + B $$\n\n接下来，我们将壁面单位 $U^{+}$ 和 $y^{+}$ 的定义代回到这个方程中。速度 $U$ 是在一个特定的壁面法向位置采样的，我们将其记为 $y_m$。\n$$ \\frac{U(y_m)}{u_{\\tau}} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_{\\tau}}{\\nu}\\right) + B $$\n\n为了得到以 $\\tau_w$ 表示的最终关系，我们代入摩擦速度的定义 $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$：\n$$ \\frac{U(y_m)}{\\sqrt{\\tau_w/\\rho}} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m \\sqrt{\\tau_w/\\rho}}{\\nu}\\right) + B $$\n\n最后，两边同乘以 $\\sqrt{\\tau_w/\\rho}$，得到所需的关于 $\\tau_w$ 的隐式关系：\n$$ U(y_m) = \\sqrt{\\frac{\\tau_w}{\\rho}} \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m \\sqrt{\\tau_w/\\rho}}{\\nu}\\right) + B \\right] $$\n推导至此完成。该方程构成了壁面模型的基础，将来自外部大涡模拟 (LES) 的解析速度 $U(y_m)$ 与亚格子壁面剪切应力 $\\tau_w$联系起来。\n\n### 第 2 部分：稳健的牛顿求解器设计\n\n任务是在给定 $U(y_m)$、$y_m$、$\\rho$、$\\nu$、$\\kappa$ 和 $B$ 的情况下，求解推导出的关于 $\\tau_w$ 的隐式方程。Newton-Raphson 方法提供了一种高效的迭代途径。\n\n**求根问题的构建**\n\n直接求解摩擦速度 $u_\\tau$ 而不是 $\\tau_w$ 在数值上更有优势。这种重构通过确保 $u_\\tau  0$ 来自然地强制施加物理约束 $\\tau_w  0$，并且它简化了对数项。对于正的 $u_\\tau$，关系式 $\\tau_w = \\rho u_{\\tau}^2$ 是单调的，因此 $u_\\tau$ 的唯一正解保证了 $\\tau_w$ 的唯一正解。\n\n我们定义一个残差函数 $R(u_\\tau)$，并寻求其根：\n$$ R(u_\\tau) = u_\\tau \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right] - U(y_m) = 0 $$\n\n**牛顿迭代方案**\n\nNewton-Raphson 方法使用以下更新规则来迭代求根：\n$$ u_{\\tau, k+1} = u_{\\tau, k} - \\frac{R(u_{\\tau, k})}{R'(u_{\\tau, k})} $$\n其中 $k$ 是迭代指数，$R'(u_\\tau)$ 是残差函数相对于 $u_\\tau$ 的导数。\n\n我们计算解析导数 $R'(u_\\tau)$：\n$$ R'(u_\\tau) = \\frac{d}{du_\\tau} \\left( u_\\tau \\left[ \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right] - U(y_m) \\right) $$\n对第一项使用乘积法则：\n$$ R'(u_\\tau) = \\left( \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B \\right) + u_\\tau \\left( \\frac{1}{\\kappa} \\frac{1}{(y_m u_\\tau / \\nu)} \\frac{y_m}{\\nu} \\right) $$\n$$ R'(u_\\tau) = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_m u_\\tau}{\\nu}\\right) + B + \\frac{1}{\\kappa} $$\n对于所有物理相关条件（即 $y^{+}  1$），该导数均为正，这确保了函数 $R(u_\\tau)$ 是单调的且存在唯一的根。\n\n**稳健性增强**\n\n要在生产级 CFD 代码中使用，求解器必须是稳健的。\n\n1.  **初始猜测**：一个好的初始猜测值 $u_{\\tau, 0}$ 对快速收敛至关重要。我们可以使用壁面摩擦系数 $C_f$ 来估计 $u_{\\tau}$，其中 $\\tau_w = C_f \\frac{1}{2} \\rho U^2$。湍流边界层的一个典型值是 $C_f \\approx 0.005$。这得出：\n    $$ \\tau_{w,0} \\approx 0.005 \\times \\frac{1}{2} \\rho U(y_m)^2 $$\n    $$ u_{\\tau,0} = \\sqrt{\\frac{\\tau_{w,0}}{\\rho}} \\approx \\sqrt{0.0025 \\cdot U(y_m)^2} = 0.05 \\cdot U(y_m) $$\n    这为 $u_\\tau$ 提供了一个基于物理的、正的初始值。\n\n2.  **正性和收敛性（线搜索）**：一个完整的牛顿步长 $\\Delta u_\\tau = -R/R'$ 可能过大，可能导致非物理的负 $u_\\tau$ 或发散。为防止这种情况，采用了回溯线搜索。更新过程修改为：\n    $$ u_{\\tau, k+1} = u_{\\tau, k} + \\alpha \\Delta u_\\tau $$\n    其中 $\\alpha \\in (0, 1]$ 是一个阻尼因子。我们从 $\\alpha = 1$（完整步长）开始。如果提议的更新 $u_{\\tau, k+1}$ 为非正值，或者如果残差范数没有减小（即 $|R(u_{\\tau, k+1})| \\ge |R(u_{\\tau, k})|$），则将 $\\alpha$ 连续减半（例如 $\\alpha \\leftarrow \\alpha/2$）并重新评估步长。这确保了每次迭代都是朝向解的一个下降步，并保持了正性。\n\n**停止准则**\n\n当解充分收敛时，迭代终止。这通过一组准则的组合来检查：\n1.  **绝对残差**：残差接近于零：$|R(u_{\\tau, k})|  \\epsilon_{abs}$。\n2.  **相对更新**：解的相对变化很小：$|u_{\\tau, k} - u_{\\tau, k-1}|  \\epsilon_{rel} |u_{\\tau,k}|$。\n如果达到最大迭代次数，迭代也会终止，这表明未能收敛。\n\n一旦迭代收敛到最终值 $u_\\tau^*$，壁面剪切应力就计算为 $\\tau_w = \\rho (u_\\tau^*)^2$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef newton_solve_tau_w(U_m, y_m, rho, nu, kappa, B, tol=1e-9, max_iter=50, min_alpha=1e-8):\n    \"\"\"\n    Solves for the wall shear stress tau_w using a robust Newton method.\n\n    The solver finds the root of the wall-law equation by iterating on the\n    friction velocity u_tau.\n\n    Args:\n        U_m (float): Velocity at measurement height y_m.\n        y_m (float): Wall-normal measurement height.\n        rho (float): Fluid density.\n        nu (float): Fluid kinematic viscosity.\n        kappa (float): von Kármán constant.\n        B (float): Additive constant in the law of the wall.\n        tol (float): Convergence tolerance for the residual.\n        max_iter (int): Maximum number of iterations.\n        min_alpha (float): Minimum damping factor for the line search.\n\n    Returns:\n        float: The computed wall shear stress tau_w in Pascals.\n    \"\"\"\n\n    # Initial guess for u_tau based on a typical skin friction coefficient\n    # C_f_guess = 0.005, so tau_w = 0.5 * rho * U_m^2 * C_f_guess\n    # u_tau = sqrt(tau_w/rho) = U_m * sqrt(0.5 * C_f_guess) = U_m * 0.05\n    u_tau = 0.05 * U_m\n    \n    # Ensure initial u_tau is at least a small positive number to avoid log(0)\n    if u_tau = 0:\n        # Fallback for U_m=0 or negative (unphysical for this problem)\n        # Choose a small value based on viscosity and distance\n        u_tau = nu / y_m\n\n    for i in range(max_iter):\n        # Avoid division by zero or errors if u_tau becomes non-positive,\n        # although the line search should prevent this.\n        if u_tau = 0:\n            raise RuntimeError(\"Newton iteration produced non-positive u_tau.\")\n\n        # Calculate residual R(u_tau) and its derivative R'(u_tau)\n        y_plus = y_m * u_tau / nu\n        log_y_plus = np.log(y_plus)\n        \n        # Residual function: R(u_tau) = u_tau * (1/kappa*ln(y^+) + B) - U_m\n        residual = u_tau * (log_y_plus / kappa + B) - U_m\n        \n        # Check for convergence based on residual norm\n        if abs(residual)  tol and i > 0:\n            break\n            \n        # Derivative of the residual function: R'(u_tau) = 1/kappa*ln(y^+) + B + 1/kappa\n        derivative = (log_y_plus / kappa) + B + (1.0 / kappa)\n\n        if derivative == 0:\n            raise RuntimeError(\"Derivative is zero, Newton method fails.\")\n\n        # Newton step\n        delta_u_tau = -residual / derivative\n        \n        # Backtracking line search to ensure positivity and convergence\n        alpha = 1.0\n        while alpha > min_alpha:\n            u_tau_new = u_tau + alpha * delta_u_tau\n            \n            if u_tau_new > 0:\n                # Calculate new residual to check for descent\n                y_plus_new = y_m * u_tau_new / nu\n                residual_new = u_tau_new * (np.log(y_plus_new) / kappa + B) - U_m\n                \n                # Armijo-like condition: check for sufficient decrease in residual\n                if abs(residual_new)  abs(residual):\n                    u_tau = u_tau_new\n                    break # Exit line search\n            \n            alpha /= 2.0 # Reduce damping factor\n        \n        if alpha = min_alpha:\n            raise RuntimeError(f\"Line search failed to find a convergent step for case with U_m={U_m}.\")\n\n    else: # This else belongs to the for-loop, executed if loop finishes without break\n        raise RuntimeError(f\"Newton solver did not converge within {max_iter} iterations for case with U_m={U_m}.\")\n        \n    # Convert final u_tau to tau_w\n    tau_w = rho * u_tau**2\n    return tau_w\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (U(y_m), y_m, rho, nu, kappa, B)\n    test_cases = [\n        (20.0, 0.005, 1.225, 1.5e-5, 0.41, 5.2),  # Case 1\n        (2.0, 0.01, 1.225, 1.5e-5, 0.41, 5.2),   # Case 2\n        (100.0, 0.01, 1.225, 1.5e-5, 0.41, 5.2), # Case 3\n        (1.0, 0.001, 1000.0, 1.0e-6, 0.41, 5.2), # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        U_m, y_m, rho, nu, kappa, B = case\n        tau_w = newton_solve_tau_w(U_m, y_m, rho, nu, kappa, B)\n        results.append(tau_w)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然平衡态模型是基础，但现实世界中的工程流动常常包含压力梯度，这使得这类模型变得不准确。本练习介绍了一种更高级的壁面模型，它基于积分动量方程，并明确地考虑了压力梯度的影响。 通过实现这个模型，你将学习如何处理非平衡条件，这是构建能够用于翼型或扩压器等复杂应用的、更通用和更精确的WMLES求解器的关键一步。",
            "id": "3391442",
            "problem": "考虑一个使用大涡模拟（LES, Large Eddy Simulation）模拟的不可压缩稳态壁面有界流。假设在从 $y=0$ 到 $y=y_m$ 的薄壁面层中，流向动量通过在边界层假设（流向梯度仅通过压力，壁面法向梯度仅通过剪切应力）下对滤波后的动量方程进行控制体积分来建模。壁面剪切应力表示为 $\\tau_w$，在匹配位置 $y=y_m$ 处的解析总剪切应力表示为 $\\tau_{xy}(y_m)$。壁面层内的流向压力梯度剖面被规定为壁面法向坐标 $y$ 的多项式函数，形式为 $g(y)=a_0+a_1 y+a_2 y^2+a_3 y^3$，其中 $g$ 的单位为帕斯卡/米（Pa/m），$y$ 的单位为米（m）。总应力和压力被理解为适用于壁面模型大涡模拟的滤波/平均量。仅使用第一性原理，推导壁面层的积分流向动量平衡，该平衡将壁面剪切应力 $\\tau_w$ 与解析剪切应力 $\\tau_{xy}(y_m)$ 以及流向压力梯度在 $[0,y_m]$ 上的壁面法向积分联系起来。基于此结果，设计一个算法，在给定 $y_m$、压力梯度 $g(y)$ 的多项式系数 $(a_0,a_1,a_2,a_3)$ 以及解析剪切应力 $\\tau_{xy}(y_m)$ 的情况下，计算以帕斯卡（Pa）为单位的 $\\tau_w$。您的算法必须强制执行积分动量方程所蕴含的精确控制体平衡。\n\n您的程序必须实现此算法，并在以下测试套件上进行评估以检验其鲁棒性，包括零压力梯度、顺压力梯度、逆压力梯度以及可能导致壁面剪切应力变为负值的强逆压力梯度等情况。所有量均采用国际单位制（SI）：压力梯度单位为 Pa/m，壁面法向距离单位为 m，剪切应力单位为 Pa。\n\n- 测试用例 1（零压力梯度，理想情况）：$y_m=0.05$，$(a_0,a_1,a_2,a_3)=(0,0,0,0)$，$\\tau_{xy}(y_m)=1.5$。\n- 测试用例 2（恒定顺压力梯度）：$y_m=0.05$，$(a_0,a_1,a_2,a_3)=(-2,0,0,0)$，$\\tau_{xy}(y_m)=1.0$。\n- 测试用例 3（恒定逆压力梯度）：$y_m=0.05$，$(a_0,a_1,a_2,a_3)=(5,0,0,0)$，$\\tau_{xy}(y_m)=0.4$。\n- 测试用例 4（线性递增逆压力梯度）：$y_m=0.02$，$(a_0,a_1,a_2,a_3)=(20,100,0,0)$，$\\tau_{xy}(y_m)=0.3$。\n- 测试用例 5（具有二次剖面的强逆压力梯度）：$y_m=0.01$，$(a_0,a_1,a_2,a_3)=(0,0,1000,0)$，$\\tau_{xy}(y_m)=0.0002$。\n- 测试用例 6（边界层厚度趋近于零）：$y_m=0.000001$，$(a_0,a_1,a_2,a_3)=(10,0,0,0)$，$\\tau_{xy}(y_m)=0.8$。\n\n您的实现应为每个测试用例计算以帕斯卡（Pa）为单位的壁面剪切应力 $\\tau_w$。最终输出格式必须为单行，包含计算出的壁面剪切应力，形式为方括号括起来的逗号分隔列表，例如 $[\\tau_{w,1},\\tau_{w,2},\\ldots,\\tau_{w,6}]$，其中每个条目都是一个以帕斯卡（Pa）为单位的浮点数。不应打印任何额外文本。",
            "solution": "问题被评估为**有效**。它在科学上基于流体动力学原理，特别是边界层中的动量平衡。该问题提法明确、客观，并提供了推导唯一解所需的所有必要信息。它不违反任何无效性标准。\n\n核心任务是基于壁面模型大涡模拟（LES）的简化流向动量方程的控制体积分，推导壁面剪切应力 $\\tau_w$ 的表达式。\n\n我们从流向（$x$方向）的滤波后、稳态、不可压缩动量方程开始。问题陈述要求使用边界层假设，具体来说，流向梯度仅对压力项显著，而壁面法向梯度（$y$方向）仅对剪切应力项显著。这是一个很强的简化，常用于平衡边界层理论，它意味着在薄壁面层内，与压力项和粘性/湍流应力项相比，对流加速度项可以忽略不计。动量平衡的这种简化表示为：\n$$\n\\frac{\\partial \\tau_{xy}}{\\partial y} \\approx \\frac{\\partial \\bar{P}}{\\partial x}\n$$\n其中 $\\tau_{xy}$ 是总剪切应力（粘性应力与湍流雷诺/亚格子尺度应力之和），而 $\\frac{\\partial \\bar{P}}{\\partial x}$ 是平均流向压力梯度。问题将此压力梯度作为壁面法向坐标 $y$ 的函数给出，记为 $g(y)$，因此：\n$$\n\\frac{d\\tau_{xy}}{dy} = g(y)\n$$\n在此，我们使用常导数，因为假定 $\\tau_{xy}$ 在此薄层内仅随 $y$ 变化。\n\n为了找到壁面处的应力与匹配高度 $y_m$ 处的应力之间的关系，我们通过对此方程关于 $y$ 从壁面（$y=0$）到匹配位置（$y=y_m$）进行积分来进行控制体分析：\n$$\n\\int_{y=0}^{y=y_m} \\frac{d\\tau_{xy}}{dy} dy = \\int_{y=0}^{y=y_m} g(y) dy\n$$\n对左侧应用微积分基本定理，我们得到：\n$$\n[\\tau_{xy}(y)]_{0}^{y_m} = \\tau_{xy}(y_m) - \\tau_{xy}(0)\n$$\n根据定义，壁面处的剪切应力 $\\tau_{xy}(0)$ 即为壁面剪切应力 $\\tau_w$。因此，积分后的动量平衡变为：\n$$\n\\tau_{xy}(y_m) - \\tau_w = \\int_{0}^{y_m} g(y) dy\n$$\n该方程代表了所要求的精确控制体平衡。它表明，整个层内剪切应力的变化量（从底部的 $\\tau_w$ 到顶部的 $\\tau_{xy}(y_m)$）与压力梯度施加在该层内流体上的总力相平衡。\n\n为了设计算法，我们重新整理方程以求解未知的壁面剪切应力 $\\tau_w$：\n$$\n\\tau_w = \\tau_{xy}(y_m) - \\int_{0}^{y_m} g(y) dy\n$$\n问题将压力梯度剖面指定为多项式：\n$$\ng(y) = a_0 + a_1 y + a_2 y^2 + a_3 y^3\n$$\n我们现在必须计算 $g(y)$ 从 $0$到 $y_m$ 的定积分：\n$$\n\\int_{0}^{y_m} (a_0 + a_1 y + a_2 y^2 + a_3 y^3) dy = \\left[ a_0 y + \\frac{a_1}{2} y^2 + \\frac{a_2}{3} y^3 + \\frac{a_3}{4} y^4 \\right]_{0}^{y_m}\n$$\n在积分上下限处计算原函数的值，得到：\n$$\n\\int_{0}^{y_m} g(y) dy = \\left( a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4 \\right) - (0)\n$$\n设此积分为 $I_p$。壁面剪切应力的最终表达式为：\n$$\n\\tau_w = \\tau_{xy}(y_m) - I_p = \\tau_{xy}(y_m) - \\left( a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4 \\right)\n$$\n该公式为算法提供了基础。\n\n算法步骤如下：\n1.  接收输入：匹配高度 $y_m$、压力梯度 $g(y)$ 的多项式系数 $(a_0, a_1, a_2, a_3)$ 以及匹配高度处的解析剪切应力 $\\tau_{xy}(y_m)$。\n2.  使用推导出的公式计算压力梯度积分 $I_p$ 的值：\n    $I_p = a_0 y_m + \\frac{a_1}{2} y_m^2 + \\frac{a_2}{3} y_m^3 + \\frac{a_3}{4} y_m^4$。\n3.  使用动量平衡方程计算壁面剪切应力 $\\tau_w$：\n    $\\tau_w = \\tau_{xy}(y_m) - I_p$。\n4.  返回计算出的 $\\tau_w$ 值。\n\n现在将实现此算法以评估所提供的测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the wall shear stress based on an integrated momentum balance for a wall-modeled LES.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (y_m, (a0, a1, a2, a3), tau_xy_m)\n    test_cases = [\n        (0.05, (0, 0, 0, 0), 1.5),         # Case 1\n        (0.05, (-2, 0, 0, 0), 1.0),        # Case 2\n        (0.05, (5, 0, 0, 0), 0.4),         # Case 3\n        (0.02, (20, 100, 0, 0), 0.3),      # Case 4\n        (0.01, (0, 0, 1000, 0), 0.0002),   # Case 5\n        (0.000001, (10, 0, 0, 0), 0.8),    # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        ym, coeffs, tau_xy_m = case\n        a0, a1, a2, a3 = coeffs\n\n        # Calculate the definite integral of the pressure gradient g(y) from 0 to ym.\n        # The integral of g(y) = a0 + a1*y + a2*y^2 + a3*y^3 is:\n        # I_p = a0*ym + (a1/2)*ym^2 + (a2/3)*ym^3 + (a3/4)*ym^4\n        integral_g = (a0 * ym + \n                      a1 * (ym**2) / 2.0 + \n                      a2 * (ym**3) / 3.0 + \n                      a3 * (ym**4) / 4.0)\n\n        # The integrated momentum balance is: tau_xy_m - tau_w = integral_g\n        # Therefore, tau_w = tau_xy_m - integral_g\n        tau_w = tau_xy_m - integral_g\n        \n        results.append(tau_w)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}