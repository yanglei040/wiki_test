{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp the Smagorinsky model, we begin with a foundational exercise. This problem strips away the complexity of turbulent flow to focus on the core mechanism: how the model translates a simple, resolved velocity gradient into a subgrid-scale (SGS) viscosity. By working through this idealized case of simple shear flow, you will build a concrete understanding of the relationship between the strain-rate tensor, the filter width $\\Delta$, and the resulting eddy viscosity $\\nu_{sgs}$ .",
            "id": "1770682",
            "problem": "In the field of computational fluid dynamics, Large Eddy Simulation (LES) is a turbulence modeling technique that separates the large-scale turbulent eddies, which are resolved directly, from the small-scale eddies, which are modeled. The effect of these small, unresolved scales on the resolved flow is incorporated through a subgrid-scale (SGS) stress tensor. A common approach to model this tensor is the Boussinesq hypothesis, which relates the SGS stress to the resolved strain rate tensor via an SGS eddy viscosity, $\\nu_{sgs}$.\n\nOne of the foundational models for this eddy viscosity is the Smagorinsky model, given by the expression:\n$$\n\\nu_{sgs} = (C_s \\Delta)^2 \\sqrt{2 \\bar{S}_{ij} \\bar{S}_{ij}}\n$$\nwhere $C_s$ is the dimensionless Smagorinsky constant, $\\Delta$ is the filter width (a characteristic length scale of the computational grid), and $\\bar{S}_{ij}$ is the resolved strain rate tensor. For an incompressible flow with velocity components $\\bar{u}_i$ in the directions $x_i = (x, y, z)$, the strain rate tensor is defined as $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_i}{\\partial x_j} + \\frac{\\partial \\bar{u}_j}{\\partial x_i}\\right)$. The term $\\bar{S}_{ij} \\bar{S}_{ij}$ implies summation over repeated indices (Einstein notation).\n\nConsider a simple, steady, two-dimensional shear flow in a Cartesian coordinate system, where the velocity field is given by $\\vec{v} = (u,v,w)$ with components $u = S y$, $v=0$, and $w=0$. The quantity $S$ is a constant, positive shear rate. For the purpose of this analysis, assume that the filtering operation inherent in LES does not alter this linear velocity profile, such that the resolved velocity field is identical to the given field (i.e., $\\bar{u}_i = u_i$).\n\nBased on this information, derive an expression for the subgrid-scale viscosity $\\nu_{sgs}$ in this simple shear flow. Your final answer should be expressed in terms of the shear rate $S$, the Smagorinsky constant $C_s$, and the filter width $\\Delta$.",
            "solution": "We use the Smagorinsky subgrid-scale viscosity model\n$$\n\\nu_{sgs} = (C_{s}\\Delta)^{2}\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}},\n$$\nwhere the resolved strain rate tensor is defined for incompressible flow as\n$$\n\\bar{S}_{ij}=\\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}}+\\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right).\n$$\nThe given velocity field is $u_{1}=u=S\\,y$, $u_{2}=v=0$, $u_{3}=w=0$, with $x_{1}=x$, $x_{2}=y$, $x_{3}=z$, and the filtering operation does not alter the field, so $\\bar{u}_{i}=u_{i}$. The nonzero velocity gradients are\n$$\n\\frac{\\partial u_{1}}{\\partial x_{2}}=S,\\quad \\frac{\\partial u_{1}}{\\partial x_{1}}=\\frac{\\partial u_{1}}{\\partial x_{3}}=\\frac{\\partial u_{2}}{\\partial x_{j}}=\\frac{\\partial u_{3}}{\\partial x_{j}}=0.\n$$\nUsing the definition of $\\bar{S}_{ij}$, the only nonzero components are\n$$\n\\bar{S}_{12}=\\bar{S}_{21}=\\frac{1}{2}\\left(\\frac{\\partial u_{1}}{\\partial x_{2}}+\\frac{\\partial u_{2}}{\\partial x_{1}}\\right)=\\frac{S}{2},\n$$\nwhile all diagonal and other off-diagonal components vanish. The contraction is then\n$$\n\\bar{S}_{ij}\\bar{S}_{ij}=\\bar{S}_{12}^{2}+\\bar{S}_{21}^{2}=2\\left(\\frac{S}{2}\\right)^{2}=\\frac{S^{2}}{2}.\n$$\nTherefore,\n$$\n\\sqrt{2\\,\\bar{S}_{ij}\\bar{S}_{ij}}=\\sqrt{2\\cdot\\frac{S^{2}}{2}}=|S|.\n$$\nSince the given shear rate $S$ is specified to be positive, $|S|=S$. Substituting into the Smagorinsky model yields\n$$\n\\nu_{sgs}=(C_{s}\\Delta)^{2}S.\n$$",
            "answer": "$$\\boxed{(C_{s}\\Delta)^{2}S}$$"
        },
        {
            "introduction": "A powerful model is one whose limitations are well understood. This exercise challenges the universal applicability of the constant-coefficient Smagorinsky model by applying it to a flow it should \"get right\": a simple laminar shear flow . By analyzing this case, you will discover a fundamental flaw in the model—its inability to distinguish between mean shear and turbulent fluctuations—and see firsthand why dynamic procedures were developed to overcome this critical deficiency.",
            "id": "3373067",
            "problem": "Consider a Large-Eddy Simulation (LES) of an incompressible, laminar simple shear flow with filtered velocity field given by $\\bar{\\mathbf{u}}(x,y,z) = (G y,\\, 0,\\, 0)$, where $G$ is a constant shear rate. The LES applies a spatial filter of width $\\Delta$ and models the deviatoric subgrid-scale (SGS) stress via an eddy-viscosity closure. \n\nStarting from the definitions and laws below, perform the following:\n1. Using the kinematic definition of the filtered strain-rate tensor $S_{ij}$ for an incompressible flow, compute the scalar magnitude $|\\bar{S}|$ in terms of $G$ only, where the magnitude is defined by $|\\bar{S}| = \\left(2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij}\\right)^{1/2}$.\n2. Using the eddy-viscosity closure $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ and the Smagorinsky hypothesis $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$ with constant model coefficient $C_{S}$, reason from first principles why this constant-$C_{S}$ closure predicts nonzero SGS dissipation even as the grid is refined (i.e., as $\\Delta \\to 0$), despite the flow being exactly laminar and fully resolved. Then, starting from the Germano identity central to the dynamic Smagorinsky procedure, explain why the dynamically computed $C_{S}^{2}$ vanishes for this flow.\n\nUse only the following foundational elements as your starting point:\n- The incompressible filtered continuity equation $\\partial \\bar{u}_{i}/\\partial x_{i} = 0$.\n- The filtered strain-rate definition $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)$.\n- The deviatoric SGS closure $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ with $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$.\n- The Germano identity for LES and test filtering: $L_{ij} = \\widetilde{\\overline{u_{i}\\,u_{j}}} - \\tilde{\\bar{u}}_{i}\\,\\tilde{\\bar{u}}_{j}$, where tilde denotes test filtering and overbar denotes grid filtering, and $L_{ij}$ is the Leonard stress.\n\nReport the value of $|\\bar{S}|$ as a single algebraic expression in terms of $G$ only. No numerical evaluation is required. If you introduce any physical units in your reasoning, state them explicitly in standard International System of Units (SI), but the final reported expression must be unitless as written in terms of $G$ alone.",
            "solution": "The problem requires a two-part analysis of the Smagorinsky subgrid-scale (SGS) model for a given incompressible, laminar simple shear flow. First, we compute the magnitude of the filtered strain-rate tensor. Second, we analyze the behavior of the constant-coefficient and dynamic Smagorinsky models for this flow.\n\n**Part 1: Computation of the Filtered Strain-Rate Magnitude $|\\bar{S}|$**\n\nThe problem provides the filtered velocity field $\\bar{\\mathbf{u}}$ with components in a Cartesian coordinate system $(x_1, x_2, x_3) = (x, y, z)$ as:\n$$\n\\bar{u}_1 = G y = G x_2 \\\\\n\\bar{u}_2 = 0 \\\\\n\\bar{u}_3 = 0\n$$\nwhere $G$ is the constant shear rate.\n\nThe filtered strain-rate tensor $\\bar{S}_{ij}$ is defined as:\n$$\n\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)\n$$\nWe compute the components of this tensor. The only non-zero partial derivative of the velocity components is $\\frac{\\partial \\bar{u}_1}{\\partial x_2} = G$. All other derivatives, such as $\\frac{\\partial \\bar{u}_1}{\\partial x_1}$, $\\frac{\\partial \\bar{u}_1}{\\partial x_3}$, $\\frac{\\partial \\bar{u}_2}{\\partial x_j}$, and $\\frac{\\partial \\bar{u}_3}{\\partial x_j}$, are zero.\n\nThe diagonal components of $\\bar{S}_{ij}$ are:\n$$\n\\bar{S}_{11} = \\frac{\\partial \\bar{u}_1}{\\partial x_1} = 0 \\\\\n\\bar{S}_{22} = \\frac{\\partial \\bar{u}_2}{\\partial x_2} = 0 \\\\\n\\bar{S}_{33} = \\frac{\\partial \\bar{u}_3}{\\partial x_3} = 0\n$$\nThe off-diagonal components are:\n$$\n\\bar{S}_{12} = \\bar{S}_{21} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_2} + \\frac{\\partial \\bar{u}_2}{\\partial x_1}\\right) = \\frac{1}{2}(G + 0) = \\frac{G}{2} \\\\\n\\bar{S}_{13} = \\bar{S}_{31} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_1}\\right) = \\frac{1}{2}(0 + 0) = 0 \\\\\n\\bar{S}_{23} = \\bar{S}_{32} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_2}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_2}\\right) = \\frac{1}{2}(0 + 0) = 0\n$$\nThus, the filtered strain-rate tensor in matrix form is:\n$$\n\\bar{S}_{ij} =\n\\begin{pmatrix}\n0 & \\frac{G}{2} & 0 \\\\\n\\frac{G}{2} & 0 & 0 \\\\\n0 & 0 & 0\n\\end{pmatrix}\n$$\nThe magnitude of the filtered strain-rate tensor is defined as $|\\bar{S}| = (2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij})^{1/2}$, where summation over repeated indices is implied.\nFirst, we compute the product $\\bar{S}_{ij}\\,\\bar{S}_{ij}$:\n$$\n\\bar{S}_{ij}\\,\\bar{S}_{ij} = \\sum_{i=1}^3 \\sum_{j=1}^3 (\\bar{S}_{ij})^2 = (\\bar{S}_{12})^2 + (\\bar{S}_{21})^2 = \\left(\\frac{G}{2}\\right)^2 + \\left(\\frac{G}{2}\\right)^2 = \\frac{G^2}{4} + \\frac{G^2}{4} = \\frac{G^2}{2}\n$$\nNow, we substitute this result into the definition of $|\\bar{S}|$:\n$$\n|\\bar{S}| = \\left(2 \\cdot \\frac{G^2}{2}\\right)^{1/2} = \\left(G^2\\right)^{1/2} = |G|\n$$\nSince the problem asks for the expression in terms of $G$ only, and shear rate is a scalar that can be positive or negative, the most accurate form is $|G|$.\n\n**Part 2: Analysis of the Smagorinsky Closure**\n\n**Failure of the Constant-Coefficient Smagorinsky Model:**\nThe standard Smagorinsky model proposes an eddy viscosity $\\nu_t$ given by:\n$$\n\\nu_t = (C_S \\Delta)^2 |\\bar{S}|\n$$\nwhere $C_S$ is a constant and $\\Delta$ is the filter width. The deviatoric SGS stress is then modeled as:\n$$\n\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij} = -2 \\nu_t \\bar{S}_{ij}\n$$\nThe rate of SGS dissipation of kinetic energy is $\\epsilon_{\\mathrm{SGS}} = -(\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij})\\bar{S}_{ij} = 2 \\nu_t \\bar{S}_{ij}\\bar{S}_{ij}$.\nFor the given flow, we found $|\\bar{S}| = |G|$. Substituting this into the model for $\\nu_t$:\n$$\n\\nu_t = (C_S \\Delta)^2 |G|\n$$\nSince $C_S$ is a non-zero constant in this formulation, $\\Delta > 0$, and we assume a non-trivial shear flow ($G \\neq 0$), the model predicts a non-zero eddy viscosity $\\nu_t \\neq 0$. This, in turn, leads to a non-zero deviatoric SGS stress and a non-zero SGS dissipation rate:\n$$\n\\epsilon_{\\mathrm{SGS}} = 2 \\left((C_S \\Delta)^2 |G|\\right) \\left(\\frac{G^2}{2}\\right) = (C_S \\Delta)^2 |G| G^2 = C_S^2 \\Delta^2 |G|^3\n$$\nThe fundamental flaw is that the original flow is specified as *laminar*. In a laminar flow, there are no turbulent fluctuations, and therefore the SGS stress tensor MUST be zero. The constant-coefficient Smagorinsky model is solely dependent on the magnitude of the *resolved* strain rate, $|\\bar{S}|$. Since a simple shear flow has a non-zero mean strain rate, the model incorrectly predicts the existence of subgrid-scale turbulence and spuriously removes energy from the resolved flow field. The model cannot distinguish between a turbulent flow with mean shear and a simple laminar shear. Even as the grid is refined ($\\Delta \\to 0$), for any finite $\\Delta$, the model predicts spurious dissipation, although this dissipation does correctly tend to zero in the limit.\n\n**Success of the Dynamic Smagorinsky Procedure:**\nThe dynamic procedure remedies this flaw by computing $C_S$ based on the flow information available at two different filter scales: the grid filter (width $\\Delta$, denoted by $\\bar{\\cdot}$) and a test filter (width $\\hat{\\Delta} > \\Delta$, denoted by $\\tilde{\\cdot}$). The procedure is derived from the Germano identity, which relates the stresses at these two scales:\n$$\nL_{ij} = T_{ij} - \\widetilde{\\tau_{ij}}\n$$\nwhere $L_{ij} = \\widetilde{\\bar{u}_i \\bar{u}_j} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ is the Leonard stress (computable from the resolved field $\\bar{u}_i$), $T_{ij} = \\widetilde{\\overline{u_i u_j}} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ is the sub-test-scale stress, and $\\tau_{ij} = \\overline{u_i u_j} - \\bar{u}_i \\bar{u}_j$ is the sub-grid scale stress.\n\nBy modeling the deviatoric parts of $\\tau_{ij}$ and $T_{ij}$ with the Smagorinsky closure and assuming $C_S$ is constant between the filter levels, one arrives at the relation $L_{ij}^{\\text{dev}} = C_S^2 M_{ij}$, where $L_{ij}^{\\text{dev}}$ is the deviatoric part of the Leonard stress tensor and $M_{ij}$ is a tensor also computable from the filtered velocity field:\n$$\nM_{ij} = 2\\Delta^2 \\widetilde{|\\bar{S}|\\bar{S}_{ij}} - 2\\hat{\\Delta}^2 |\\tilde{\\bar{S}}|\\tilde{\\bar{S}}_{ij}\n$$\n$C_S^2$ is then found by minimizing the error in this relation, typically via least squares: $C_S^2 = \\frac{L_{ij}^{\\text{dev}} M_{ij}}{M_{kl} M_{kl}}$.\n\nLet's analyze $L_{ij}$ and $M_{ij}$ for the given flow $\\bar{u}_1 = Gx_2$. We assume standard filters that do not alter functions linear in the coordinates, so $\\tilde{\\bar{u}}_1 = \\widetilde{Gx_2} = Gx_2 = \\bar{u}_1$. However, filtering does affect non-linear terms.\nThe only non-zero term in the product $\\bar{u}_i \\bar{u}_j$ is $\\bar{u}_1\\bar{u}_1 = (Gx_2)^2$. Applying the test filter to this quadratic term gives $\\widetilde{(Gx_2)^2} = (Gx_2)^2 + C$ for some constant $C$ that depends on the filter shape and width $\\hat{\\Delta}$ (e.g., $C = G^2\\hat{\\Delta}^2/12$ for a 1D box filter).\nThe Leonard stress components are:\n$$\nL_{11} = \\widetilde{\\bar{u}_1 \\bar{u}_1} - \\tilde{\\bar{u}}_1 \\tilde{\\bar{u}}_1 = ((Gx_2)^2 + C) - (Gx_2)^2 = C\n$$\nAll other components $L_{ij}$ are zero, as they involve products like $\\bar{u}_1\\bar{u}_2=0$. Therefore, $L_{ij}$ is a diagonal tensor. Consequently, its deviatoric part, $L_{ij}^{\\text{dev}} = L_{ij} - \\frac{1}{3}L_{kk}\\delta_{ij}$, is also a diagonal tensor.\n\nNow, let's analyze $M_{ij}$. Since $\\tilde{\\bar{u}}_i = \\bar{u}_i$, the strain-rate tensors are also identical: $\\tilde{\\bar{S}}_{ij} = \\bar{S}_{ij}$, and so are their magnitudes: $|\\tilde{\\bar{S}}| = |\\bar{S}| = |G|$. The term $|\\bar{S}|\\bar{S}_{ij}$ is a constant tensor field. Filtering a constant field yields the constant itself, so $\\widetilde{|\\bar{S}|\\bar{S}_{ij}} = |\\bar{S}|\\bar{S}_{ij}$.\nSubstituting these into the expression for $M_{ij}$:\n$$\nM_{ij} = (2\\Delta^2 - 2\\hat{\\Delta}^2)|\\bar{S}|\\bar{S}_{ij}\n$$\nThis shows that $M_{ij}$ is directly proportional to $\\bar{S}_{ij}$. As we found in Part 1, $\\bar{S}_{ij}$ is a purely off-diagonal tensor.\n\nFinally, we compute $C_S^2$ from the numerator $L_{ij}^{\\text{dev}} M_{ij}$. This is the contracted product (inner product) of a diagonal tensor ($L_{ij}^{\\text{dev}}$) and a purely off-diagonal tensor ($M_{ij}$). Such a product is identically zero:\n$$\nL_{ij}^{\\text{dev}} M_{ij} = \\sum_{i,j} L_{ij}^{\\text{dev}} M_{ij} = 0\n$$\nThe denominator $M_{kl}M_{kl}$ is proportional to $\\bar{S}_{kl}\\bar{S}_{kl} = G^2/2$, which is non-zero.\nTherefore, the dynamically computed coefficient is:\n$$\nC_S^2 = \\frac{0}{\\text{non-zero}} = 0\n$$\nThe dynamic procedure correctly determines that for this laminar flow, the model coefficient must be zero, which in turn means $\\nu_t = 0$ and the spurious SGS dissipation is eliminated. The model correctly \"turns itself off.\"",
            "answer": "$$\\boxed{|G|}$$"
        },
        {
            "introduction": "Moving from analytical theory to computational practice introduces new layers of complexity and choice. The concept of \"filtering\" in Large Eddy Simulation (LES) is a prime example, as it can be interpreted as an implicit effect of the computational grid or as an explicit mathematical operation . This hands-on coding problem directs you to quantify the impact of this choice, comparing the SGS stresses produced by an implicit, grid-based filter against those from an explicit box filter, revealing how numerical implementation details directly influence the model's physical predictions.",
            "id": "3380543",
            "problem": "You are to write a complete, runnable program that, for a prescribed two-dimensional resolved velocity field, compares the subgrid-scale (SGS) stress predicted by an implicitly filtered second-order central-difference scheme against that predicted after an explicit top-hat (box) filter, both closed with the Smagorinsky subgrid-scale model. Your program must compute, for each test case, a single scalar that quantifies the difference between the two SGS stress predictions, and then output all scalars for the provided test suite in a single line as specified below.\n\nFundamental base and definitions to use:\n- Start from the spatially filtered, incompressible Navier–Stokes equations and the definition of the subgrid-scale stress tensor, where the deviatoric part is modeled by the Smagorinsky eddy-viscosity hypothesis. The deviatoric SGS stress is closed by introducing an eddy viscosity proportional to the square of a characteristic filter width and the magnitude of the resolved strain-rate tensor.\n- The resolved velocity field is incompressible and smooth, and all computations are performed on a uniform, periodic grid.\n\nMathematical setup:\n- Consider a square periodic domain with side length $L = 2\\pi$ and a uniform grid of $N \\times N$ points, with grid spacings $\\Delta x = \\Delta y = L/N$. All angles in trigonometric functions are in radians.\n- Define a scalar streamfunction $\\psi(x,y)$ and an incompressible velocity field via $\\boldsymbol{u} = (u,v) = \\left(\\frac{\\partial \\psi}{\\partial y}, -\\frac{\\partial \\psi}{\\partial x}\\right)$. Use the analytic streamfunction\n$$\n\\psi(x,y) = \\sin(k_x x)\\sin(k_y y),\n$$\nwhere $k_x$ and $k_y$ are integers specifying wavenumbers.\n- Compute spatial derivatives using the second-order central-difference formula with periodic boundary conditions. For any grid function $f$, the discrete derivative in the $x$-direction is\n$$\n\\left.\\frac{\\partial f}{\\partial x}\\right|_{i,j} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x},\n$$\nwith indices understood modulo $N$; analogously for the $y$-direction.\n\nResolved strain-rate tensor:\n- From the resolved velocity field, compute the resolved strain-rate tensor $S_{ij}$,\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right),\n$$\nand its magnitude\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}},\n$$\nwhere repeated indices imply summation over spatial dimensions $i,j \\in \\{x,y\\}$.\n\nSmagorinsky subgrid-scale closure:\n- The deviatoric SGS stress is modeled as\n$$\n\\tau^{\\mathrm{dev}}_{ij} = - 2 \\left(C_s \\Delta\\right)^2 \\lvert S \\rvert \\, S_{ij},\n$$\nwhere $C_s$ is the Smagorinsky constant and $\\Delta$ is a characteristic filter width. To ensure a trace-free tensor in discrete computations, apply the deviatoric projection for $d=2$ as\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\, \\delta_{ij}, \\quad d=2,\n$$\nwith $\\delta_{ij}$ the Kronecker delta.\n\nTwo filtering pathways to compare:\n- Implicit filtering: Use the unfiltered resolved field on the grid and the second-order central-difference derivatives to build $S_{ij}$, and set the characteristic width to the grid-based scale $\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$.\n- Explicit filtering: First apply a separable, periodic two-dimensional top-hat (box) filter of integer radius $r \\ge 0$, meaning a $(2r+1)\\times(2r+1)$ uniform average, to each component of the velocity field. Then compute derivatives, $S_{ij}$, and the SGS stress from the explicitly filtered velocities. In this pathway, set the characteristic width to the explicit filter width scaled consistently in $2$D as\n$$\n\\Delta_{\\mathrm{exp}} = (2r+1) \\, \\sqrt{\\Delta x \\Delta y}.\n$$\n\nDifference metric:\n- Let $\\tau^{\\mathrm{imp}}_{ij}$ and $\\tau^{\\mathrm{exp}}_{ij}$ denote the deviatoric SGS tensors computed along the implicit and explicit pathways, respectively. Quantify their difference using the normalized discrete Frobenius norm over the grid,\n$$\nE = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\Delta \\tau_{xx}\\right)^2 + \\left(\\Delta \\tau_{yy}\\right)^2 + 2 \\left(\\Delta \\tau_{xy}\\right)^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ \\left(\\tau^{\\mathrm{imp}}_{xx}\\right)^2 + \\left(\\tau^{\\mathrm{imp}}_{yy}\\right)^2 + 2 \\left(\\tau^{\\mathrm{imp}}_{xy}\\right)^2 \\right]}},\n$$\nwhere $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$. If the denominator is exactly zero, define $E = 0$.\n\nNumerical construction details required:\n- Assemble the resolved field by discretizing $x \\in [0,L)$ and $y \\in [0,L)$ as $x_i = i \\Delta x$, $y_j = j \\Delta y$ for $i,j \\in \\{0,1,\\dots,N-1\\}$.\n- Implement periodic central differences and the explicit top-hat filter as a separable periodic $(2r+1)$-point moving average in each direction.\n- Use the same second-order derivative formula for both pathways.\n\nTest suite:\nFor each tuple $(N, C_s, r, k_x, k_y)$, compute and record the scalar $E$ defined above.\n- Test $1$: $(N, C_s, r, k_x, k_y) = (64, 0.17, 0, 4, 3)$.\n- Test $2$: $(N, C_s, r, k_x, k_y) = (64, 0.17, 1, 4, 3)$.\n- Test $3$: $(N, C_s, r, k_x, k_y) = (64, 0.17, 2, 8, 8)$.\n- Test $4$: $(N, C_s, r, k_x, k_y) = (16, 0.10, 1, 2, 1)$.\n- Test $5$: $(N, C_s, r, k_x, k_y) = (32, 0.23, 3, 1, 5)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the five floating-point values $E$ for Tests $1$ through $5$, in that order, enclosed in square brackets and with no spaces. For example, a valid output would look like $[e_1,e_2,e_3,e_4,e_5]$. No other output is permitted.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, specifically Large Eddy Simulation (LES), and is mathematically well-posed and self-contained. All necessary equations, parameters, and numerical methods are unambiguously defined.\n\nThe solution proceeds by first constructing the computational environment and the prescribed analytical velocity field. Subsequently, it implements the two distinct filtering pathways—implicit and explicit—to compute the subgrid-scale (SGS) stress tensor. Finally, it quantifies the difference between the resulting stress fields using the specified error metric.\n\n**1. Grid and Velocity Field Generation**\nThe simulation is performed on a two-dimensional square periodic domain of side length $L=2\\pi$. This domain is discretized into a uniform grid of $N \\times N$ points. The grid spacing in each direction is $\\Delta x = \\Delta y = L/N$. The grid coordinates are given by $x_i = i \\Delta x$ and $y_j = j \\Delta y$ for $i, j \\in \\{0, 1, \\dots, N-1\\}$.\n\nAn incompressible velocity field $\\boldsymbol{u} = (u,v)$ is derived from a scalar streamfunction $\\psi(x,y)$. This construction, $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$, analytically guarantees that the divergence of the velocity field is zero, $\\nabla \\cdot \\boldsymbol{u} = 0$. The specified streamfunction is $\\psi(x,y) = \\sin(k_x x)\\sin(k_y y)$, which yields the velocity components:\n$$\nu(x,y) = \\frac{\\partial \\psi}{\\partial y} = k_y \\sin(k_x x)\\cos(k_y y)\n$$\n$$\nv(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -k_x \\cos(k_x x)\\sin(k_y y)\n$$\nThese analytical expressions are evaluated at the grid points $(x_i, y_j)$ to generate the discrete resolved velocity fields, which serve as the starting point for all subsequent computations.\n\n**2. Numerical Operators**\nTwo core numerical operators are required: a derivative approximation and a spatial filter.\n\n- **Periodic Central Differences**: Spatial derivatives are computed using a second-order accurate central-difference scheme. For a generic grid function $f_{i,j}$, the partial derivatives are approximated as:\n$$\n\\frac{\\partial f}{\\partial x} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta x} \\quad \\text{and} \\quad \\frac{\\partial f}{\\partial y} \\approx \\frac{f_{i,j+1} - f_{i,j-1}}{2 \\Delta y}\n$$\nPeriodicity is handled by implementing index shifts modulo $N$, which is efficiently achieved using array-rolling operations.\n\n- **Periodic Top-Hat (Box) Filter**: For the explicit filtering pathway, a separable 2D top-hat filter is applied. This filter replaces each grid point's value with the unweighted average of the values in a $(2r+1) \\times (2r+1)$ neighborhood, where $r$ is the filter radius. The box filter is implemented using `scipy.ndimage.uniform_filter` with the `mode='wrap'` option to correctly handle the periodic boundaries.\n\n**3. Smagorinsky SGS Stress Calculation**\nThe core of the physical modeling lies in calculating the deviatoric SGS stress tensor, $\\tau^{\\mathrm{dev}}_{ij}$, using the Smagorinsky closure. This process is encapsulated in a single function that takes a velocity field and model parameters as input.\n\n- **Step 1: Strain-Rate Tensor**: From a given resolved velocity field $(u_i)$, the components of the resolved strain-rate tensor $S_{ij}$ are computed using the central-difference operator:\n$$\nS_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right) \\quad \\Rightarrow \\quad S_{xx} = \\frac{\\partial u}{\\partial x}, \\quad S_{yy} = \\frac{\\partial v}{\\partial y}, \\quad S_{xy} = \\frac{1}{2}\\left(\\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}\\right)\n$$\n- **Step 2: Strain-Rate Magnitude**: The magnitude of the strain-rate tensor, $\\lvert S \\rvert$, is calculated as:\n$$\n\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}} = \\sqrt{2(S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2)}\n$$\n- **Step 3: SGS Stress Tensor**: The deviatoric SGS stress is modeled as being proportional to the strain rate, $\\tau^{\\mathrm{dev}}_{ij} = -2 \\nu_{SGS} S_{ij}$, where $\\nu_{SGS}$ is the eddy viscosity. The Smagorinsky model defines the eddy viscosity as:\n$$\n\\nu_{SGS} = (C_s \\Delta)^2 \\lvert S \\rvert\n$$\nHere, $C_s$ is the Smagorinsky constant and $\\Delta$ is the characteristic filter width. This gives the preliminary SGS stress tensor components, e.g., $\\tau_{xx} = -2 \\nu_{SGS} S_{xx}$.\n- **Step 4: Deviatoric Projection**: Although the analytical strain-rate tensor for an incompressible flow is trace-free ($S_{kk}=0$), numerical discretization errors can introduce a non-zero trace. To rigorously enforce the trace-free property ($\\tau_{kk}=0$), a deviatoric projection is applied to the computed stress tensor:\n$$\n\\widetilde{\\tau}_{ij} = \\tau_{ij} - \\frac{1}{d} \\tau_{kk} \\delta_{ij} \\quad (\\text{with } d=2)\n$$\nThis ensures the final computed SGS stress tensor is properly deviatoric.\n\n**4. Implementation of the Two Pathways**\nThe problem requires comparing the SGS stress tensors resulting from two different interpretations of the filter width $\\Delta$.\n\n- **Implicit Pathway**: This approach assumes the filtering operation is implicitly performed by the grid itself. The characteristic filter width is set to the grid scale, $\\Delta_{\\mathrm{imp}} = \\sqrt{\\Delta x \\Delta y}$. The SGS stress calculation is applied directly to the original, unfiltered velocity field.\n\n- **Explicit Pathway**: This approach involves an explicit filtering step prior to modeling. The velocity field components $(u,v)$ are first smoothed using the $(2r+1)\\times(2r+1)$ box filter. The characteristic filter width is then set to be consistent with the size of this explicit filter, $\\Delta_{\\mathrm{exp}} = (2r+1) \\sqrt{\\Delta x \\Delta y}$. The SGS stress calculation is then performed on this pre-filtered velocity field using $\\Delta_{\\mathrm{exp}}$.\n\n**5. Difference Metric**\nThe discrepancy between the two SGS stress tensors, $\\tau^{\\mathrm{imp}}_{ij}$ and $\\tau^{\\mathrm{exp}}_{ij}$, is quantified by the normalized Frobenius norm of their difference, summed over all grid points:\n$$\nE = \\sqrt{\\frac{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} - \\tau^{\\mathrm{exp}} \\rVert_F^2}{\\sum_{\\text{grid}} \\lVert \\tau^{\\mathrm{imp}} \\rVert_F^2}} = \\sqrt{\\frac{\\sum\\limits_{\\text{grid}} \\left[ (\\Delta \\tau_{xx})^2 + (\\Delta \\tau_{yy})^2 + 2 (\\Delta \\tau_{xy})^2 \\right]}{\\sum\\limits_{\\text{grid}} \\left[ (\\tau^{\\mathrm{imp}}_{xx})^2 + (\\tau^{\\mathrm{imp}}_{yy})^2 + 2 (\\tau^{\\mathrm{imp}}_{xy})^2 \\right]}}\n$$\nwhere $\\Delta \\tau_{ij} = \\tau^{\\mathrm{imp}}_{ij} - \\tau^{\\mathrm{exp}}_{ij}$. If the denominator is zero (i.e., the implicit stress field is identically zero), the error $E$ is defined to be $0$.\n\nThe described procedure is executed for each test case specified in the problem statement, and the resulting scalar values of $E$ are collected and formatted into the final output. For the special case where the filter radius $r=0$, the explicit filter is an identity operation, and the filter widths become equal ($\\Delta_{\\mathrm{exp}} = \\Delta_{\\mathrm{imp}}$), leading to an expected error of $E=0$, which serves as a valuable internal consistency check.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.ndimage import uniform_filter\n\ndef solve():\n    \"\"\"\n    Main function to compute and compare SGS stress predictions for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Cs, r, kx, ky)\n        (64, 0.17, 0, 4, 3),\n        (64, 0.17, 1, 4, 3),\n        (64, 0.17, 2, 8, 8),\n        (16, 0.10, 1, 2, 1),\n        (32, 0.23, 3, 1, 5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, Cs, r, kx, ky = case\n        \n        # 1. Grid and Field Setup\n        L = 2.0 * np.pi\n        dx = dy = L / N\n        x = np.linspace(0, L - dx, N)\n        y = np.linspace(0, L - dy, N)\n        X, Y = np.meshgrid(x, y)\n        \n        # Analytical velocity field from streamfunction\n        # psi = sin(kx*x)sin(ky*y)\n        # u = d(psi)/dy = ky*sin(kx*x)cos(ky*y)\n        # v = -d(psi)/dx = -kx*cos(kx*x)sin(ky*y)\n        u_initial = ky * np.sin(kx * X) * np.cos(ky * Y)\n        v_initial = -kx * np.cos(kx * X) * np.sin(ky * Y)\n\n        # 2. Implicit Pathway\n        Delta_imp = np.sqrt(dx * dy)\n        tau_imp_xx, tau_imp_yy, tau_imp_xy = calculate_sgs_stress(\n            u_initial, v_initial, dx, dy, Cs, Delta_imp\n        )\n        \n        # 3. Explicit Pathway\n        # Apply top-hat filter to velocity fields\n        u_filtered = box_filter(u_initial, r)\n        v_filtered = box_filter(v_initial, r)\n        \n        Delta_exp = (2 * r + 1) * np.sqrt(dx * dy)\n        tau_exp_xx, tau_exp_yy, tau_exp_xy = calculate_sgs_stress(\n            u_filtered, v_filtered, dx, dy, Cs, Delta_exp\n        )\n\n        # 4. Difference Metric Calculation\n        d_tau_xx = tau_imp_xx - tau_exp_xx\n        d_tau_yy = tau_imp_yy - tau_exp_yy\n        d_tau_xy = tau_imp_xy - tau_exp_xy\n        \n        # Numerator: Sum of squared Frobenius norm of the difference tensor\n        numerator = np.sum(d_tau_xx**2 + d_tau_yy**2 + 2 * d_tau_xy**2)\n        \n        # Denominator: Sum of squared Frobenius norm of the implicit tensor\n        denominator = np.sum(tau_imp_xx**2 + tau_imp_yy**2 + 2 * tau_imp_xy**2)\n        \n        if denominator == 0.0:\n            E = 0.0\n        else:\n            E = np.sqrt(numerator / denominator)\n            \n        results.append(E)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef periodic_central_difference(f, delta):\n    \"\"\"\n    Computes partial derivatives using 2nd-order periodic central differences.\n    Numpy indexing: axis 0 is y, axis 1 is x.\n    \"\"\"\n    df_dx = (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * delta)\n    df_dy = (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * delta)\n    return df_dx, df_dy\n\ndef box_filter(f, r):\n    \"\"\"\n    Applies a separable, periodic 2D top-hat (box) filter of radius r.\n    A radius r=0 means a 1x1 filter, which is an identity operation.\n    \"\"\"\n    if r == 0:\n        return f.copy()\n    width = 2 * r + 1\n    # scipy.ndimage.uniform_filter is ideal for this, handling separability\n    # and periodic boundaries (mode='wrap') efficiently.\n    return uniform_filter(f, size=width, mode='wrap')\n\ndef calculate_sgs_stress(u, v, dx, dy, Cs, Delta_filter):\n    \"\"\"\n    Computes the deviatoric Smagorinsky SGS stress tensor for a given velocity field.\n    \"\"\"\n    # Compute velocity gradients using central differences\n    du_dx, du_dy = periodic_central_difference(u, dx)\n    dv_dx, dv_dy = periodic_central_difference(v, dy)\n\n    # Compute resolved strain-rate tensor components, S_ij\n    S_xx = du_dx\n    S_yy = dv_dy\n    S_xy = 0.5 * (du_dy + dv_dx)\n\n    # Compute strain-rate magnitude, |S|\n    # |S| = sqrt(2 * S_ij * S_ij)\n    S_mag = np.sqrt(2 * (S_xx**2 + S_yy**2 + 2 * S_xy**2))\n\n    # Compute eddy viscosity, nu_sgs\n    nu_sgs = (Cs * Delta_filter)**2 * S_mag\n\n    # Compute SGS stress tensor, tau_ij = -2 * nu_sgs * S_ij\n    tau_xx_raw = -2 * nu_sgs * S_xx\n    tau_yy_raw = -2 * nu_sgs * S_yy\n    tau_xy_raw = -2 * nu_sgs * S_xy\n\n    # Apply deviatoric projection for d=2 to enforce trace-free property numerically\n    trace_tau = tau_xx_raw + tau_yy_raw\n    tau_xx = tau_xx_raw - 0.5 * trace_tau\n    tau_yy = tau_yy_raw - 0.5 * trace_tau\n    tau_xy = tau_xy_raw # Off-diagonal elements are unchanged by projection\n    \n    return tau_xx, tau_yy, tau_xy\n\nsolve()\n```"
        }
    ]
}