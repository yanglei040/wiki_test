{
    "hands_on_practices": [
        {
            "introduction": "隐式大涡模拟（ILES）依赖于数值格式的内在特性来模拟湍流。本练习将探讨ILES中所用数值格式的一个基本属性：其守恒动能的能力。我们将通过理论推导，了解数值方法中的一个简单选择——单元交界面上速度的插值方法——如何直接决定该格式是否会伪地产生或耗散能量，这是理解亚格子模型“隐式”特性的一个关键概念 。",
            "id": "3333512",
            "problem": "考虑一个不可压缩、常密度流的隐式大涡模拟 (ILES)，该模拟在具有三周期边界条件的均匀笛卡尔网格上，采用同位网格有限体积法 (FVM) 进行离散化。未知速度场存储在网格单元中心。每个控制体用索引 $P$ 表示，其体积为 $\\Delta \\Omega_{P}$，单元中心速度为 $\\boldsymbol{u}_{P}(t)$。每个内面 $f$ 连接一对相邻的单元 $(P,N)$，相对于单元 $P$ 的外法向面积矢量为 $\\boldsymbol{S}_{f}$，因此同一个面相对于单元 $N$ 的面积矢量为 $-\\boldsymbol{S}_{f}$。常数密度为 $\\rho$，动力黏度为 $\\mu$。\n\n每个单元 $P$ 中的半离散动量平衡是通过在控制体上积分不可压缩 Navier-Stokes 方程，并对每个通量项应用散度定理得到的。通过面 $f$ 的动量对流通量由质量通量 $m_{f}$ 乘以插值得到的面速度 $\\boldsymbol{u}_{f}$ 表示。从单元 $P$ 看来，通过面 $f$ 的质量通量为 $m_{f} = \\rho\\,\\boldsymbol{u}_{f}\\cdot\\boldsymbol{S}_{f}$，而从单元 $N$ 看来，同一个面的质量通量为 $-m_{f}$。面速度插值由单个参数 $\\alpha \\in [0,1]$ 定义，通过\n$$\n\\boldsymbol{u}_{f}(\\alpha) = \\alpha\\,\\boldsymbol{u}_{P} + (1-\\alpha)\\,\\boldsymbol{u}_{N}.\n$$\n假设离散连续性方程以通常的面通量形式强制执行，\n$$\n\\sum_{f\\in \\partial \\Omega_{P}} m_{f} = 0 \\quad \\text{for every cell } P,\n$$\n并且压力采用中心、基于面的梯度进行离散化，使得离散梯度和散度算子在标准 FVM 内积下构成一个分部求和对。黏性通量采用对称中心差分离散化，这为黏性耗散产生一个非负二次型。\n\n从上述基本定律和定义出发，推导全局动能\n$$\nK(t) = \\sum_{P} \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}.\n$$\n的半离散动能平衡。明确指出对流项、压力项和黏性项对 $\\mathrm{d}K/\\mathrm{d}t$ 的贡献，并用面-对 $(P,N)$、质量通量 $m_{f}$ 和插值参数 $\\alpha$ 来表示对流项的贡献。然后，确定 $\\alpha$ 的值，使得对流项的贡献精确地简化为一个动能的叠缩边界输运项，没有内部的产生或销毁，从而在三周期边界条件下，对流不会产生虚假的动能。将最终的 $\\alpha$ 值作为你的答案。无需四舍五入。你的答案必须是一个无单位的实数。",
            "solution": "分析始于对问题陈述的审查，以确保其有效性。\n\n### 步骤1：提取已知条件\n- **流动：** 不可压缩、常密度、隐式大涡模拟 (ILES)。\n- **离散化：** 均匀笛卡尔网格上的同位网格有限体积法 (FVM)。\n- **边界条件：** 三周期。\n- **变量：** 控制体 $\\Delta \\Omega_{P}$ 中的单元中心速度 $\\boldsymbol{u}_{P}(t)$。\n- **常量：** 密度 $\\rho$，动力黏度 $\\mu$。\n- **面几何：** 面 $f$ 连接单元 $P$ 和 $N$。其面积矢量 $\\boldsymbol{S}_{f}$ 从 $P$ 指出。\n- **半离散动量方程：** 通过在 $\\Delta \\Omega_{P}$ 上积分 Navier-Stokes 方程得到。\n- **质量通量：** 通过面 $f$ 的质量通量为 $m_{f} = \\rho\\,\\boldsymbol{u}_{f}\\cdot\\boldsymbol{S}_{f}$。\n- **面速度插值：** $\\boldsymbol{u}_{f}(\\alpha) = \\alpha\\,\\boldsymbol{u}_{P} + (1-\\alpha)\\,\\boldsymbol{u}_{N}$，其中 $\\alpha \\in [0,1]$。\n- **离散连续性：** 对于每个单元 $P$，$\\sum_{f\\in \\partial \\Omega_{P}} m_{f} = 0$。\n- **压力-梯度和散度：** 离散算子构成一个分部求和对。\n- **黏性项：** 使用对称中心差分离散化，为黏性耗散产生一个非负二次型。\n- **全局动能：** $K(t) = \\sum_{P} \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，属于计算流体动力学这一成熟领域。它是一个适定、客观且自洽的问题，提供了推导参数 $\\alpha$ 唯一解所需的所有定义和约束。其前提，如 FVM 方程的形式和算子属性，在文献中是标准的。该问题是可形式化的，并要求进行严格的数学推导。它并非无足轻重，因为它需要仔细的代数操作和对数值格式守恒性质的理解。不存在矛盾、歧义或事实上的不健全之处。\n\n### 步骤3：结论和行动\n问题被认为是有效的。将提供一个完整的、有理有据的解答。\n\n### 半离散动能平衡的推导\n\n单元 $P$ 的半离散动量方程是通过在控制体 $\\Delta\\Omega_P$ 上积分 Navier-Stokes 方程得到的。对于常数密度 $\\rho$，其形式为：\n$$\n\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = -\\sum_{f \\in \\partial\\Omega_P} (\\rho \\boldsymbol{u}_f \\otimes \\boldsymbol{u}_f) \\cdot \\boldsymbol{S}_f - \\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f + \\sum_{f \\in \\partial\\Omega_P} \\boldsymbol{\\tau}_f \\cdot \\boldsymbol{S}_f\n$$\n使用质量通量的定义 $m_f = \\rho \\boldsymbol{u}_f \\cdot \\boldsymbol{S}_f$，对流项可以写为 $\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f$。因此，单元 $P$ 的动量方程为：\n$$\n\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = -\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f - \\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f + \\boldsymbol{V}_P\n$$\n其中 $\\boldsymbol{V}_P$ 表示作用在单元上的净黏性力。\n\n单元 $P$ 中的动能为 $K_P(t) = \\Delta \\Omega_{P}\\,\\frac{\\rho}{2}\\,|\\boldsymbol{u}_{P}(t)|^{2}$。其时间导数为：\n$$\n\\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = \\Delta \\Omega_{P}\\,\\rho\\,\\boldsymbol{u}_P \\cdot \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t} = \\boldsymbol{u}_P \\cdot \\left(\\Delta\\Omega_P \\rho \\frac{\\mathrm{d}\\boldsymbol{u}_P}{\\mathrm{d}t}\\right)\n$$\n代入动量方程：\n$$\n\\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f \\right) + \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f \\right) + \\boldsymbol{u}_P \\cdot \\boldsymbol{V}_P\n$$\n全局动能 $K(t) = \\sum_P K_P(t)$ 的变化率通过对所有单元 $P$ 求和得到：\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\sum_P \\frac{\\mathrm{d}K_P}{\\mathrm{d}t} = T_C + T_P + T_V\n$$\n其中 $T_C$、$T_P$ 和 $T_V$ 分别是对流项、压力项和黏性项的总贡献。\n\n**压力项的贡献 ($T_P$)**\n压力项为 $T_P = \\sum_P \\boldsymbol{u}_P \\cdot \\left( -\\sum_{f \\in \\partial\\Omega_P} p_f \\boldsymbol{S}_f \\right)$。问题陈述离散散度 ($D$) 和梯度 ($G$) 算子构成一个分部求和对。设 FVM 内积为 $\\langle \\boldsymbol{a}, \\boldsymbol{b} \\rangle = \\sum_P \\Delta\\Omega_P \\boldsymbol{a}_P \\cdot \\boldsymbol{b}_P$。对于周期性边界条件，分部求和性质为 $\\langle \\boldsymbol{v}, G\\phi \\rangle = - \\langle D\\boldsymbol{v}, \\phi \\rangle$。压力项可以写成 $T_P = -\\langle \\boldsymbol{u}, Gp \\rangle$。利用该性质，这变为 $T_P = \\langle Du, p \\rangle$。\n与连续性方程一致的速度场离散散度为 $(D\\boldsymbol{u})_P = \\frac{1}{\\Delta\\Omega_P \\rho} \\sum_{f \\in \\partial\\Omega_P} \\rho \\boldsymbol{u}_f \\cdot \\boldsymbol{S}_f = \\frac{1}{\\Delta\\Omega_P \\rho} \\sum_{f \\in \\partial\\Omega_P} m_f$。\n给定的离散连续性方程为对于所有 $P$，$\\sum_{f \\in \\partial\\Omega_P} m_f = 0$。因此，对于所有 $P$，$(D\\boldsymbol{u})_P = 0$。\n这意味着 $T_P = \\sum_P \\Delta\\Omega_P (Du)_P p_P = 0$。压力项对系统不做净功。\n\n**黏性项的贡献 ($T_V$)**\n黏性项为 $T_V = \\sum_P \\boldsymbol{u}_P \\cdot \\boldsymbol{V}_P$。问题陈述黏性离散化为黏性耗散产生一个非负二次型。黏性耗散定义为 $\\epsilon = -T_V$。因此条件为 $\\epsilon \\ge 0$，即 $T_V \\le 0$。此项表示动能到内能的不可逆转换。\n\n**对流项的贡献 ($T_C$)**\n总对流贡献为 $T_C = \\sum_P \\left( -\\boldsymbol{u}_P \\cdot \\sum_{f \\in \\partial\\Omega_P} m_f \\boldsymbol{u}_f \\right)$。我们可以将求和顺序从先对单元再对面积分，改为对所有唯一的面求和。每个内面 $f$ 由两个单元 $P$ 和 $N$ 共享。从 $P$ 的角度看，质量通量为 $m_f$；从 $N$ 的角度看，质量通量为 $m_{f,N} = \\rho \\boldsymbol{u}_f \\cdot (-\\boldsymbol{S}_f) = -m_f$。\n$$\nT_C = -\\sum_{f(P,N)} \\left( \\boldsymbol{u}_P \\cdot (m_f \\boldsymbol{u}_f) + \\boldsymbol{u}_N \\cdot (m_{f,N} \\boldsymbol{u}_f) \\right) = -\\sum_{f(P,N)} (\\boldsymbol{u}_P \\cdot m_f \\boldsymbol{u}_f - \\boldsymbol{u}_N \\cdot m_f \\boldsymbol{u}_f)\n$$\n$$\nT_C = \\sum_{f(P,N)} m_f (\\boldsymbol{u}_N - \\boldsymbol{u}_P) \\cdot \\boldsymbol{u}_f\n$$\n现在，代入插值公式 $\\boldsymbol{u}_f = \\alpha \\boldsymbol{u}_P + (1-\\alpha)\\boldsymbol{u}_N$。一个有用的恒等式是 $(b-a) \\cdot (\\alpha a + (1-\\alpha)b) = \\frac{1}{2}(|b|^2-|a|^2) - (\\alpha-\\frac{1}{2})|b-a|^2$。\n令 $\\boldsymbol{a} = \\boldsymbol{u}_P$ 和 $\\boldsymbol{b} = \\boldsymbol{u}_N$，我们得到：\n$$\n(\\boldsymbol{u}_N - \\boldsymbol{u}_P) \\cdot \\boldsymbol{u}_f = \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) - \\left(\\alpha - \\frac{1}{2}\\right)|\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\n将此代入 $T_C$ 的表达式中：\n$$\nT_C = \\sum_{f} m_f \\left[ \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) \\right] - \\sum_{f} m_f \\left(\\alpha - \\frac{1}{2}\\right)|\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\n我们来分析第一项，$T_{C,1} = \\sum_{f} m_f \\frac{1}{2}(|\\boldsymbol{u}_N|^2 - |\\boldsymbol{u}_P|^2) = \\sum_f m_f (E_N - E_P)$，其中 $E_P = \\frac{1}{2}|\\boldsymbol{u}_P|^2$。\n我们可以证明该项恒等于零。考虑求和 $\\sum_P E_P \\left( \\sum_{f \\in \\partial\\Omega_P} m_f \\right)$。根据离散连续性方程，该和为零。\n$$\n0 = \\sum_P E_P \\left( \\sum_{f \\in \\partial\\Omega_P} m_f \\right) = \\sum_P \\sum_{f \\in \\partial\\Omega_P} E_P m_f\n$$\n将求和顺序改为对唯一的面求和：\n$$\n0 = \\sum_{f(P,N)} (E_P m_f + E_N m_{f,N}) = \\sum_{f(P,N)} (E_P m_f - E_N m_f) = \\sum_f m_f (E_P - E_N)\n$$\n这表明 $\\sum_f m_f (E_P - E_N) = 0$。因此，$T_{C,1} = \\sum_f m_f (E_N - E_P) = - \\sum_f m_f(E_P - E_N) = 0$。\n\n对流项对动能收支的贡献简化为：\n$$\nT_C = - \\left(\\alpha - \\frac{1}{2}\\right) \\sum_{f} m_f |\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2\n$$\n问题陈述对于特定的 $\\alpha$ 值，对流贡献应简化为叠缩边界输运。对于具有周期性边界条件的区域，这样的输运项计算结果为零。这意味着在区域内部，对流项不会产生或销毁虚假的动能。为此，必须有 $T_C = 0$。\n对于一般流动，求和 $\\sum_{f} m_f |\\boldsymbol{u}_N - \\boldsymbol{u}_P|^2$ 不为零。因此，要使 $T_C$ 对任意流场都为零，其系数必须为零：\n$$\n\\alpha - \\frac{1}{2} = 0 \\implies \\alpha = \\frac{1}{2}\n$$\n这个 $\\alpha$ 值对应于面速度的中心插值，$\\boldsymbol{u}_f = \\frac{1}{2}(\\boldsymbol{u}_P + \\boldsymbol{u}_N)$，这使得半离散对流算子是斜对称的，因此相对于动能是非耗散的。\n\n最终的动能平衡为：\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = T_C + T_V\n$$\n对于 $\\alpha = 1/2$，$T_C=0$，能量平衡变为 $\\frac{\\mathrm{d}K}{\\mathrm{d}t} = T_V \\le 0$。总动能只能因黏性耗散而减少，这在物理上是正确的。\n\n确保对流项非耗散的 $\\alpha$ 值为 $1/2$。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "在认识到数值格式具有内在的物理效应之后，本练习将介绍一个强大的分析工具：修正波数分析。我们将利用这项技术在一个简化的模型上，量化一个数值格式的数值耗散和色散，并观察调整一个模拟通量限制器的参数如何让我们控制精度与稳定性之间的平衡，这对于ILES的性能至关重要 。",
            "id": "3333547",
            "problem": "考虑具有恒定速度 $a>0$ 的一维线性平流方程 $u_t + a u_x = 0$。在使用总变差递减 (TVD) 重构的隐式大涡模拟 (ILES) 背景下，可以通过参数化非线性通量限制器来调整数值色散与数值耗散之间的平衡。对于线性化分析下的单色模，该限制器可以通过一个等效的半离散空间算子来建模，该算子混合了中心差分（色散）项和二阶差分（耗散）项。具体来说，假设半离散格式为\n$$\nu_t = -a\\, D_{\\beta}(u), \\quad D_{\\beta}(u_i) = \\frac{1}{\\Delta x}\\left(\\frac{1}{2}(u_{i+1} - u_{i-1}) - \\beta (u_{i+1} - 2 u_i + u_{i-1})\\right),\n$$\n其中 $\\beta \\ge 0$ 是一个由限制器控制的系数，表示 TVD 引起的数值耗散的有效强度，而 $\\Delta x = L/N$ 是在具有 $N$ 个点的长度为 $L$ 的周期性域上的均匀网格间距。\n\n令 $u_i = \\hat{u}\\, e^{\\mathrm{i} k x_i}$，其中 $x_i = i \\Delta x$，$k$ 是物理波数，$\\mathrm{i} = \\sqrt{-1}$。定义无量纲波数 $\\theta = k \\Delta x$。\n\n1. 推导 $D_{\\beta}$ 的离散傅里叶符号以及相关的修正波数 $k^*(k)$。修正波数是通过关系式 $u_t = -\\mathrm{i}\\, a\\, k^*(k)\\, u$ 为单色模定义的。请用 $\\theta$、$\\Delta x$ 和 $\\beta$ 表示 $k^*(k)$。\n\n2. 定义相位误差 $\\phi(k)$ 为 $\\phi(k) = \\mathrm{Re}(k^*(k)) - k$，其中 $\\mathrm{Re}(\\cdot)$ 表示实部。请用 $\\theta$、$\\Delta x$ 和 $k$ 给出 $\\phi(k)$ 的表达式。\n\n3. 为了描述 ILES 中的瓶颈效应，使用一个基于物理的代理，将数值耗散率与分子（物理）黏性进行比较。令格式引起的数值耗散率为\n$$\n\\mu(k) = \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos \\theta\\right),\n$$\n并令物理黏性耗散率为 $\\nu k^2$，其中 $\\nu > 0$ 是运动黏度。定义瓶颈振幅 $B$ 为\n$$\nB = \\max_{k \\in \\mathcal{K}} \\frac{\\mu(k)}{\\nu k^2},\n$$\n其中 $\\mathcal{K}$ 是所选网格上直至 Nyquist 极限的可分辨波数集合。角度单位必须是弧度。\n\n使用这些定义，编写一个完整的程序，为以下测试套件中的每个测试用例计算：\n- 所有可分辨波数上的最大绝对相位误差 $\\max_{k \\in \\mathcal{K}} |\\phi(k)|$。\n- 瓶颈振幅 $B$。\n\n假设 $a = 1$（无量纲）。使用离散波数集合 $\\mathcal{K} = \\left\\{k_m = \\frac{2\\pi m}{L} \\,\\big|\\, m = 1, 2, \\ldots, \\left\\lfloor\\frac{N}{2}\\right\\rfloor \\right\\}$，因此 $\\theta_m = k_m \\Delta x = \\frac{2\\pi m}{N}$。程序必须为每个测试用例生成结果，形式为列表 $[B, E_{\\phi}]$，其中 $E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)|$。\n\n测试套件参数（所有量均为无量纲，角度以弧度为单位）：\n- 用例 1: $L = 2\\pi$, $N = 64$, $\\beta = 0.05$, $\\nu = 10^{-3}$。\n- 用例 2: $L = 2\\pi$, $N = 64$, $\\beta = 0.20$, $\\nu = 10^{-3}$。\n- 用例 3: $L = 2\\pi$, $N = 128$, $\\beta = 0.20$, $\\nu = 10^{-3}$。\n- 用例 4: $L = 2\\pi$, $N = 32$, $\\beta = 0.40$, $\\nu = 10^{-3}$。\n- 用例 5: $L = 2\\pi$, $N = 128$, $\\beta = 0.40$, $\\nu = 10^{-3}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，格式应完全如下：\n$$\n\\text{[[B\\_1,E\\_{\\phi,1}],[B\\_2,E\\_{\\phi,2}],[B\\_3,E\\_{\\phi,3}],[B\\_4,E\\_{\\phi,4}],[B\\_5,E\\_{\\phi,5}]]}\n$$\n其中 $B_i$ 和 $E_{\\phi,i}$ 是根据上述规定计算的第 $i$ 个用例的浮点数。不应打印任何额外文本。",
            "solution": "该问题是有效的，因为它在科学上基于偏微分方程的数值分析，是自洽的、适定的，并且没有任何歧义或矛盾。\n\n解答过程分为四个步骤：\n1.  推导给定半离散格式的修正波数 $k^*(k)$。\n2.  推导相位误差 $\\phi(k)$ 并确定其最大绝对值 $E_{\\phi}$。\n3.  推导瓶颈振幅 $B$。\n4.  陈述用于实现的最终公式。\n\n**1. 修正波数的推导**\n\n一维线性平流方程 $u_t + a u_x = 0$ 的半离散格式由下式给出\n$$u_t = -a\\, D_{\\beta}(u)$$\n其中空间算子 $D_{\\beta}$ 定义为\n$$D_{\\beta}(u_i) = \\frac{1}{\\Delta x}\\left(\\frac{1}{2}(u_{i+1} - u_{i-1}) - \\beta (u_{i+1} - 2 u_i + u_{i-1})\\right)$$\n为了找到该格式对单个傅里叶模的行为，我们将单色波解 $u_j(t) = \\hat{u}(t) e^{\\mathrm{i}k x_j}$（其中 $x_j = j\\Delta x$）代入算子中。网格上的位移表示为 $u_{j\\pm1} = \\hat{u}(t) e^{\\mathrm{i}k(j\\pm1)\\Delta x} = u_j e^{\\pm\\mathrm{i}k\\Delta x}$。使用无量纲波数 $\\theta = k\\Delta x$，我们有 $u_{j\\pm1} = u_j e^{\\pm\\mathrm{i}\\theta}$。\n\n代入 $D_{\\beta}(u_j)$ 的表达式中：\n$$D_{\\beta}(u_j) = \\frac{u_j}{\\Delta x}\\left(\\frac{1}{2}(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta}) - \\beta (e^{\\mathrm{i}\\theta} - 2 + e^{-\\mathrm{i}\\theta})\\right)$$\n使用欧拉恒等式 $e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta} = 2\\mathrm{i}\\sin\\theta$ 和 $e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta} = 2\\cos\\theta$，我们简化各项：\n$$ \\frac{1}{2}(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta}) = \\mathrm{i}\\sin\\theta $$\n$$ e^{\\mathrm{i}\\theta} - 2 + e^{-\\mathrm{i}\\theta} = (e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta}) - 2 = 2\\cos\\theta - 2 = -2(1-\\cos\\theta) $$\n因此，算子变为：\n$$ D_{\\beta}(u_j) = \\frac{u_j}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\n那么，模振幅 $\\hat{u}$ 的半离散方程为：\n$$ \\frac{d\\hat{u}}{dt} e^{\\mathrm{i} k x_j} = -a \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) \\hat{u} e^{\\mathrm{i} k x_j} $$\n这可以重写为 $\\frac{du}{dt} = \\lambda u$，其中 $\\lambda$ 是空间离散化的特征值。问题通过关系式 $u_t = -\\mathrm{i} a k^*(k) u$ 定义了修正波数 $k^*(k)$。将其与我们推导的方程进行比较：\n$$ -\\mathrm{i} a k^*(k) = -a \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\n$$ \\mathrm{i} k^*(k) = \\frac{1}{\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) $$\n通过除以 $\\mathrm{i}$（并使用 $1/\\mathrm{i} = -\\mathrm{i}$）来求解 $k^*(k)$：\n$$ k^*(k) = \\frac{1}{\\mathrm{i}\\Delta x} \\left( \\mathrm{i}\\sin\\theta + 2\\beta(1-\\cos\\theta) \\right) = \\frac{1}{\\Delta x} \\left( \\sin\\theta - \\mathrm{i}2\\beta(1-\\cos\\theta) \\right) $$\n这是复修正波数。其实部控制数值色散，其虚部控制数值耗散。\n\n**2. 最大绝对相位误差的推导**\n\n相位误差定义为 $\\phi(k) = \\mathrm{Re}(k^*(k)) - k$。根据 $k^*(k)$ 的表达式：\n$$ \\mathrm{Re}(k^*(k)) = \\frac{\\sin\\theta}{\\Delta x} $$\n因此，相位误差为：\n$$ \\phi(k) = \\frac{\\sin\\theta}{\\Delta x} - k $$\n由于 $\\theta = k\\Delta x$，我们有 $k = \\theta/\\Delta x$。代入此式可得用 $\\theta$ 和 $\\Delta x$ 表示的相位误差：\n$$ \\phi(k) = \\frac{\\sin\\theta - \\theta}{\\Delta x} $$\n我们需要找到最大绝对相位误差 $E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)|$。可分辨波数的集合是 $\\mathcal{K} = \\{k_m = \\frac{2\\pi m}{L} | m = 1, \\dots, \\lfloor\\frac{N}{2}\\rfloor \\}$。这对应于无量纲波数 $\\theta_m = k_m \\Delta x = \\frac{2\\pi m}{L} \\frac{L}{N} = \\frac{2\\pi m}{N}$。\n$\\theta_m$ 的范围是从 $\\frac{2\\pi}{N}$（对于 $m=1$）到 $\\frac{2\\pi \\lfloor N/2 \\rfloor}{N}$。对于所有测试用例，$N$ 均为偶数，所以 $\\lfloor N/2 \\rfloor = N/2$，$\\theta_m$ 的最大值是 $\\theta_{\\max} = \\pi$（Nyquist 波数）。\n\n需要最大化的函数是 $|\\phi(k)| = |\\frac{\\sin\\theta - \\theta}{\\Delta x}|$。对于 $\\theta>0$，有 $\\sin\\theta  \\theta$，所以 $\\sin\\theta - \\theta  0$。因此，$|\\sin\\theta - \\theta| = \\theta - \\sin\\theta$。\n令 $f(\\theta) = \\theta - \\sin\\theta$。其导数为 $f'(\\theta) = 1 - \\cos\\theta$。对于 $\\theta \\in (0, 2\\pi)$，$f'(\\theta) \\ge 0$，这意味着 $f(\\theta)$ 是一个单调递增函数。因此，$|\\phi(k)|$ 的最大值将在离散集合中 $\\theta$ 的最大值处取得，即 $\\theta_{\\max} = \\pi$。\n$$ E_{\\phi} = \\max_{k \\in \\mathcal{K}} |\\phi(k)| = \\frac{\\theta_{\\max} - \\sin(\\theta_{\\max})}{\\Delta x} = \\frac{\\pi - \\sin(\\pi)}{\\Delta x} = \\frac{\\pi}{\\Delta x} $$\n代入 $\\Delta x = L/N$，我们得到最大绝对相位误差的最终表达式：\n$$ E_{\\phi} = \\frac{\\pi N}{L} $$\n\n**3. 瓶颈振幅的推导**\n\n瓶颈振幅 $B$ 定义为在所有可分辨波数上，数值耗散率 $\\mu(k)$ 与物理黏性耗散率 $\\nu k^2$之比的最大值：\n$$ B = \\max_{k \\in \\mathcal{K}} \\frac{\\mu(k)}{\\nu k^2} $$\n数值耗散率由下式给出 $\\mu(k) = \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos \\theta\\right)$。\n该比值为：\n$$ R(k) = \\frac{\\mu(k)}{\\nu k^2} = \\frac{1}{\\nu k^2} \\frac{2 \\beta}{\\Delta x} \\left(1 - \\cos(k\\Delta x)\\right) $$\n为了求最大值，我们分析函数 $g(\\theta) = \\frac{1 - \\cos\\theta}{\\theta^2}$ 的行为，其中 $\\theta = k\\Delta x$。该比值可以写为 $R(k) = \\frac{2\\beta \\Delta x}{\\nu} g(k\\Delta x)$。\n$g(\\theta)$ 的导数是 $g'(\\theta) = \\frac{\\theta \\sin\\theta - 2(1-\\cos\\theta)}{\\theta^3}$。分子 $h(\\theta) = \\theta \\sin\\theta - 2(1-\\cos\\theta)$ 可以通过分析其自身的导数来证明在 $\\theta \\in (0, \\pi)$ 内为负：$h(0)=0$ 且 $h'(\\theta) = \\theta\\cos\\theta - \\sin\\theta$ 在 $\\theta \\in(0,\\pi)$ 内也为负。由于 $g'(\\theta)  0$，函数 $g(\\theta)$ 在 $(0, \\pi]$ 上是单调递减的。\n因此，当 $k\\Delta x \\in (0, \\pi]$ 时，比值 $R(k)$ 是 $k$ 的单调递减函数。$R(k)$ 在离散集合 $\\mathcal{K}$ 上的最大值必然出现在集合中最小的波数处，即 $k_1 = \\frac{2\\pi}{L}$。\n对应的无量纲波数是 $\\theta_1 = k_1 \\Delta x = \\frac{2\\pi}{L} \\frac{L}{N} = \\frac{2\\pi}{N}$。\n\n我们在 $k=k_1$ 处计算 $R(k)$：\n$$ B = R(k_1) = \\frac{2 \\beta (1 - \\cos(\\theta_1))}{\\nu \\Delta x k_1^2} = \\frac{2 \\beta (1 - \\cos(2\\pi/N))}{\\nu (L/N) (2\\pi/L)^2} $$\n$$ B = \\frac{2 \\beta N (1 - \\cos(2\\pi/N))}{\\nu L (4\\pi^2/L^2)} = \\frac{2 \\beta N L (1 - \\cos(2\\pi/N))}{4\\pi^2 \\nu} = \\frac{\\beta N L}{2\\pi^2 \\nu} (1 - \\cos(2\\pi/N)) $$\n使用半角恒等式 $1 - \\cos(2x) = 2 \\sin^2(x)$，其中 $x = \\pi/N$：\n$$ B = \\frac{\\beta N L}{2\\pi^2 \\nu} (2\\sin^2(\\pi/N)) = \\frac{\\beta N L}{\\pi^2 \\nu} \\sin^2(\\pi/N) $$\n\n**4. 用于实现的最终公式**\n\n对于每个具有参数 $(L, N, \\beta, \\nu)$ 的测试用例：\n1.  最大绝对相位误差计算如下：\n    $$ E_{\\phi} = \\frac{\\pi N}{L} $$\n2.  瓶颈振幅计算如下：\n    $$ B = \\frac{\\beta N L}{\\pi^2 \\nu} \\sin^2\\left(\\frac{\\pi}{N}\\right) $$\n这些公式将在 Python 代码中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the bottleneck amplitude (B) and maximum phase error (E_phi)\n    for a series of test cases based on a semi-discrete scheme for the\n    linear advection equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (L, N, beta, nu)\n    test_cases = [\n        (2 * np.pi, 64, 0.05, 1e-3),\n        (2 * np.pi, 64, 0.20, 1e-3),\n        (2 * np.pi, 128, 0.20, 1e-3),\n        (2 * np.pi, 32, 0.40, 1e-3),\n        (2 * np.pi, 128, 0.40, 1e-3),\n    ]\n\n    results = []\n    \n    # Constant from problem statement.\n    a = 1.0\n\n    for case in test_cases:\n        L, N, beta, nu = case\n\n        # Formula for maximum absolute phase error: E_phi = pi * N / L\n        # This is derived from maximizing |phi(k)| = |(sin(theta)-theta)/dx|\n        # at the Nyquist wavenumber k_max = pi / dx, where theta_max = pi.\n        E_phi = np.pi * N / L\n\n        # Formula for bottleneck amplitude: B = (beta * N * L / (pi^2 * nu)) * sin^2(pi/N)\n        # This is derived from maximizing R(k) = mu(k) / (nu * k^2) at the\n        # smallest non-zero wavenumber k_1 = 2*pi / L.\n        # B = (2*beta*(1-cos(2*pi/N))) / (nu * (L/N) * (2*pi/L)^2)\n        #   = (beta * N * L / (2 * pi^2 * nu)) * (1 - cos(2*pi/N))\n        # Using 1 - cos(2x) = 2sin^2(x):\n        # B = (beta * N * L / (pi^2 * nu)) * sin^2(pi/N)\n        \n        # We use the sinc function form for better numerical stability, though the direct formula is also accurate for these parameters.\n        # B = (beta * (L/N) / nu) * (sin(pi/N)/(pi/N))^2\n        # For simplicity and directness, let's stick to the derived formula:\n        B = (beta * N * L / (np.pi**2 * nu)) * (np.sin(np.pi / N))**2\n\n        results.append([B, E_phi])\n\n    # Format the final output string as a list of lists.\n    # str([1.2, 3.4]) produces '[1.2, 3.4]', which is what's needed for the comma-separated join.\n    # The final output has no spaces within the sublists, e.g., \"[1.2,3.4]\".\n    # The default string representation of a list includes spaces. To match the implicit format\n    # of the example, we build the string more carefully.\n    \n    # Let's re-read the format example in the prompt.\n    # [[B_1,E_{\\phi,1}],[B_2,E_{\\phi,2}],...]\n    # In Python, str([[1.0, 2.0], [3.0, 4.0]]) produces '[[1.0, 2.0], [3.0, 4.0]]'\n    # The prompt template `f\"[{','.join(map(str, results))}]\"` joins these with commas,\n    # producing '[[1.0, 2.0], [3.0, 4.0]]' -> '[[1.0, 2.0],[3.0, 4.0]]'.\n    # This matches the requested format.\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\n\nsolve()\n```"
        },
        {
            "introduction": "这个最终练习将理论概念应用于模拟设置的实际问题中。我们将为近壁湍流的网格设计建立并应用一个量化准则，这是计算流体力学中的一个经典挑战。本练习将展示如何将我们对ILES中隐式滤波器的理解，转化为关于网格分辨率和近壁拉伸率的实际决策 。",
            "id": "3333490",
            "problem": "考虑不可压缩湍流槽道流以及一种隐式大涡模拟（ILES）离散化方法，其截断误差起到隐式滤波器的作用。在壁面单位下进行分析，其中距离由黏性长度尺度无量纲化，并用上标“+”表示。目标是量化几何拉伸的法向网格如何改变局部隐式截止波数 $k_{\\Delta}(y)$，并提出一个定量准则，以保证近壁条带的预乘能量谱 $E(k)$ 在直至缓冲层的区域内得以保留。您的程序必须实现以下建模假设，并为一组测试用例计算安全因子。\n\n基本依据与建模选择：\n- 不可压缩纳维-斯托克斯方程控制该流动，并在大涡模拟中被滤波。对于隐式方法，取有效滤波宽度 $\\Delta_{\\text{eff}}$ 为局部网格间距的几何平均值，\n$$\n\\Delta_{\\text{eff}}(y) = \\big(\\Delta_x \\,\\Delta_y(y)\\, \\Delta_z\\big)^{1/3}.\n$$\n- 受采样定理和离散算子线性稳定性的启发，将局部隐式截止波数近似为\n$$\nk_{\\Delta}(y) = \\alpha \\,\\frac{\\pi}{\\Delta_{\\text{eff}}(y)},\n$$\n其中 $\\alpha \\in (0,1]$ 是一个与格式相关的常数，用于表征由离散化（包括其对格式低通特性和时间步进的依赖性）引起的隐式滤波器的耗散性。\n- 湍流槽道流中的近壁条带表现出稳健的内尺度谱峰。为解决此问题，将目标近壁含能波长建模为常数\n$$\n\\lambda_x^+ = 700,\\qquad \\lambda_z^+ = 100,\n$$\n从而所需的方向波数为\n$$\nk_{x,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_x^+},\\qquad k_{z,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_z^+},\n$$\n且对大小的组合各向同性要求为\n$$\nk_{\\mathrm{req,iso}} = \\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2}.\n$$\n- 流向和展向的网格间距是均匀的，并以壁面单位指定为 $\\Delta_x^+$ 和 $\\Delta_z^+$。法向间距以第一个单元高度 $\\Delta y_1^+$ 和恒定比率 $r1$ 从壁面开始几何拉伸，即\n$$\n\\Delta y_j^+ = \\Delta y_1^+\\, r^{\\,j-1},\\qquad Y_n^+ = \\sum_{j=1}^{n} \\Delta y_j^+,\n$$\n并且只有满足 $Y_n^+ \\le y_{\\mathrm{buf}}^+$ 的网格部分对近壁准则有贡献。使用 $y_{\\mathrm{buf}}^+=40$。\n\n安全因子与通过/失败准则：\n- 定义方向安全因子\n$$\nS_{\\mathrm{dir}} = \\min\\!\\Bigg(\\frac{\\alpha \\,\\pi/\\Delta_x^+}{k_{x,\\mathrm{req}}},\\, \\frac{\\alpha \\,\\pi/\\Delta_z^+}{k_{z,\\mathrm{req}}}\\Bigg),\n$$\n该因子确保流向和展向的截止值分别超过其所需值。\n- 定义缓冲层上的各向同性安全因子为\n$$\nS_{\\mathrm{iso}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{k_{\\Delta}(Y_n^+)}{k_{\\mathrm{req,iso}}}\n= \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{\\alpha \\,\\pi/\\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_n^+\\big)^{1/3}}{\\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2}},\n$$\n其中 $\\Delta y_n^+$ 是缓冲层内第 n 个单元的局部法向间距。\n- 总体安全因子为\n$$\nS = \\min\\big(S_{\\mathrm{dir}},\\, S_{\\mathrm{iso}}\\big).\n$$\n解释：$S \\ge 1$ 意味着隐式截止值超过了在直至缓冲层区域内保留近壁条带能量所需的值；$S  1$ 表明根据此准则，分辨率不足。\n\n编程任务：\n- 实现一个程序，为每个提供的测试用例，完全按照上述规定计算 $S$。该算法必须：\n  1. 接受 $\\Delta_x^+$、$\\Delta_z^+$、$\\Delta y_1^+$、r、$\\alpha$ 和 $y_{\\mathrm{buf}}^+$。\n  2. 根据 $\\lambda_x^+$ 和 $\\lambda_z^+$ 计算 $k_{x,\\mathrm{req}}$、$k_{z,\\mathrm{req}}$ 和 $k_{\\mathrm{req,iso}}$。\n  3. 构建几何序列 $\\Delta y_j^+$，直到累加和 $Y_n^+$ 将超过 $y_{\\mathrm{buf}}^+$；仅包括那些满足 $Y_n^+ \\le y_{\\mathrm{buf}}^+$ 的 $n$。\n  4. 计算 $S_{\\mathrm{dir}}$ 和 $S_{\\mathrm{iso}}$，然后计算 $S$。\n- 所有量均采用壁面单位无量纲化，因此输出中不需要物理单位。不使用角度。\n\n测试套件：\n- 使用以下参数集，每个参数集为一个元组 $(\\Delta_x^+,\\Delta_z^+,\\Delta y_1^+, r,\\alpha, y_{\\mathrm{buf}}^+)$：\n  1. $(18.0, 9.0, 0.4, 1.10, 0.75, 40.0)$\n  2. $(30.0, 40.0, 0.8, 1.15, 0.60, 40.0)$\n  3. $(60.0, 12.0, 0.3, 1.70, 0.65, 40.0)$\n  4. $(25.0, 32.0, 0.5, 1.20, 0.70, 40.0)$\n  5. $(20.0, 35.0, 0.5, 1.05, 0.55, 40.0)$\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容为每个测试用例的安全因子 $S$，顺序与上述相同。将每个 $S$ 表示为浮点数。例如，输出格式必须类似于“[s1,s2,s3,s4,s5]”，不含多余空格或文本。如果需要，您可以将浮点值格式化为具有一致小数位数的格式。",
            "solution": "该问题是有效的，因为它在计算流体力学领域内提出了一个适定的、有科学依据的计算任务。其定义、参数和目标清晰、一致，足以推导出唯一解。\n\n目标是计算安全因子 $S$，该因子用于量化隐式大涡模拟（ILES）网格在捕捉槽道流中近壁湍流条带方面的分辨率充分性。该安全因子基于物理所需的谱分辨率与网格离散化所提供的谱分辨率之间的比较。\n\n首先，我们确定所需的谱分辨率。问题将近壁条带建模为在流向和展向上分别具有特征波长 $\\lambda_x^+ = 700$ 和 $\\lambda_z^+ = 100$。为解析这些结构，网格必须支持至少与相应基本波数一样大的波数：\n$$\nk_{x,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_x^+} = \\frac{2\\pi}{700}\n$$\n$$\nk_{z,\\mathrm{req}} = \\frac{2\\pi}{\\lambda_z^+} = \\frac{2\\pi}{100}\n$$\n对于所需分辨率的组合各向同性度量，我们使用波数向量的模：\n$$\nk_{\\mathrm{req,iso}} = \\sqrt{k_{x,\\mathrm{req}}^2 + k_{z,\\mathrm{req}}^2} = \\sqrt{\\left(\\frac{2\\pi}{700}\\right)^2 + \\left(\\frac{2\\pi}{100}\\right)^2} = \\frac{2\\pi}{100} \\sqrt{\\left(\\frac{1}{7}\\right)^2 + 1^2} = \\frac{2\\pi}{100} \\frac{\\sqrt{50}}{7} = \\frac{10\\pi\\sqrt{2}}{700} = \\frac{\\pi\\sqrt{2}}{70}\n$$\n\n接下来，我们确定由网格间距限制的所提供的谱分辨率。在 ILES 中，数值离散化的截断误差起到隐式低通滤波器的作用。该模型将有效局部滤波宽度 $\\Delta_{\\text{eff}}(y)$ 近似为三个方向上网格间距的几何平均值：\n$$\n\\Delta_{\\text{eff}}(y^+) = \\big(\\Delta_x^+ \\Delta_z^+ \\Delta_y^+(y^+)\\big)^{1/3}\n$$\n其中 $\\Delta_x^+$ 和 $\\Delta_z^+$ 是均匀的，而 $\\Delta_y^+(y^+)$ 是局部的法向网格间距。相应的局部隐式截止波数 $k_{\\Delta}(y^+)$ 建模为：\n$$\nk_{\\Delta}(y^+) = \\alpha \\frac{\\pi}{\\Delta_{\\text{eff}}(y^+)}\n$$\n参数 $\\alpha \\in (0,1]$ 考虑了数值格式并非完美的“砖墙式”滤波器，且其耗散特性会影响有效截止波数这一事实。\n\n在定义了所需分辨率和所提供分辨率之后，我们可以建立安全因子。\n\n方向安全因子 $S_{\\mathrm{dir}}$ 检查流向和展向的均匀网格间距本身是否足够。它是每个方向上所提供的截止波数与所需波数之比的最小值：\n$$\nS_{\\mathrm{dir}} = \\min\\Bigg(\\frac{\\alpha \\pi/\\Delta_x^+}{k_{x,\\mathrm{req}}},\\, \\frac{\\alpha \\pi/\\Delta_z^+}{k_{z,\\mathrm{req}}}\\Bigg)\n$$\n代入 $k_{x,\\mathrm{req}}$ 和 $k_{z,\\mathrm{req}}$ 的表达式，可简化为：\n$$\nS_{\\mathrm{dir}} = \\min\\Bigg(\\frac{\\alpha \\lambda_x^+}{2\\Delta_x^+},\\, \\frac{\\alpha \\lambda_z^+}{2\\Delta_z^+}\\Bigg)\n$$\n\n各向同性安全因子 $S_{\\mathrm{iso}}$ 处理组合分辨率要求，并考虑了可变的法向网格间距。它定义为缓冲层内（指定为 $Y_n^+ \\le y_{\\mathrm{buf}}^+$，其中 $y_{\\mathrm{buf}}^+=40$）所有网格单元的最小分辨率比：\n$$\nS_{\\mathrm{iso}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{k_{\\Delta}(Y_n^+)}{k_{\\mathrm{req,iso}}} = \\min_{Y_n^+ \\le y_{\\mathrm{buf}}^+}\\;\\frac{\\alpha \\pi / \\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_n^+\\big)^{1/3}}{k_{\\mathrm{req,iso}}}\n$$\n此处，$\\Delta y_n^+$ 是第 n 个单元的法向间距，由几何级数 $\\Delta y_n^+ = \\Delta y_1^+ r^{n-1}$ 给出。为了找到该比率的最小值，我们必须分析其对 $\\Delta y_n^+$ 的依赖性。该比率与 $(\\Delta y_n^+)^{-1/3}$ 成反比。因此，要使比率最小化，我们必须使其分母最大化，这意味着我们必须在所有满足缓冲层准则的单元中找到 $\\Delta y_n^+$ 的最大值。由于拉伸比 $r1$，单元间距 $\\Delta y_n^+$ 随单元索引 $n$ 的增加而增加。因此，最大间距 $\\Delta y_{\\max}^+$ 对应于最后一个单元（假设索引为 $N$），其累积高度 $Y_N^+ = \\sum_{j=1}^{N} \\Delta y_j^+$ 小于或等于 $y_{\\mathrm{buf}}^+$。\n寻找 $\\Delta y_{\\max}^+$ 的算法是：从 $j=1$ 开始遍历单元，计算 $\\Delta y_j^+$ 和累积高度 $Y_j^+$，当 $Y_j^+$ 超过 $y_{\\mathrm{buf}}^+$ 时停止。上一步的 $\\Delta y_{j-1}^+$ 值即为所需的 $\\Delta y_{\\max}^+$。如果缓冲层内不包含任何单元，则该集合为空，最小值形式上为无穷大，这意味着 $S_{\\mathrm{iso}}$ 不会成为限制因素。\n\n一旦找到 $\\Delta y_{\\max}^+$，$S_{\\mathrm{iso}}$ 就使用这个单一值进行计算：\n$$\nS_{\\mathrm{iso}} = \\frac{\\alpha \\pi / \\big(\\Delta_x^+ \\Delta_z^+ \\Delta y_{\\max}^+\\big)^{1/3}}{k_{\\mathrm{req,iso}}}\n$$\n\n最后，总体安全因子 $S$ 是方向因子和各向同性因子的最小值，确保所有分辨率准则都同时得到满足：\n$$\nS = \\min(S_{\\mathrm{dir}}, S_{\\mathrm{iso}})\n$$\n$S \\ge 1$ 的值表示根据该模型，网格分辨率是足够的，而 $S  1$ 则表明分辨率不足。程序将为每个测试用例实现这一逻辑。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_safety_factor(dx_plus, dz_plus, dy1_plus, r, alpha, y_buf_plus):\n    \"\"\"\n    Computes the ILES grid resolution safety factor S for a single test case.\n\n    Args:\n        dx_plus (float): Streamwise grid spacing in wall units.\n        dz_plus (float): Spanwise grid spacing in wall units.\n        dy1_plus (float): First wall-normal cell height in wall units.\n        r (float): Wall-normal grid stretching ratio.\n        alpha (float): Scheme-dependent dissipation parameter.\n        y_buf_plus (float): Height of the buffer layer in wall units.\n\n    Returns:\n        float: The overall safety factor S.\n    \"\"\"\n    # 1. Define physical constants and required wavenumbers\n    lambda_x_plus = 700.0\n    lambda_z_plus = 100.0\n\n    k_x_req = 2 * np.pi / lambda_x_plus\n    k_z_req = 2 * np.pi / lambda_z_plus\n    k_req_iso = np.sqrt(k_x_req**2 + k_z_req**2)\n\n    # 2. Compute the directional safety factor S_dir\n    s_x = (alpha * np.pi / dx_plus) / k_x_req\n    s_z = (alpha * np.pi / dz_plus) / k_z_req\n    s_dir = min(s_x, s_z)\n\n    # 3. Compute the isotropic safety factor S_iso\n    # This requires finding the largest wall-normal cell spacing, dy_max_plus,\n    # for a cell whose top boundary Y_n^+ is within y_buf_plus.\n    \n    # Iteratively find the last cell within the buffer layer\n    current_y_plus = 0.0\n    last_dy_plus = 0.0\n    j = 1\n    while True:\n        dy_j_plus = dy1_plus * (r**(j - 1))\n        if current_y_plus + dy_j_plus > y_buf_plus:\n            break\n        last_dy_plus = dy_j_plus\n        current_y_plus += dy_j_plus\n        j += 1\n\n    # If no cell fits in the buffer layer, S_iso is not a limiting constraint (formally infinite).\n    if last_dy_plus == 0.0:\n        s_iso = float('inf')\n    else:\n        # The minimum isotropic ratio occurs at the largest cell spacing (dy_max_plus)\n        dy_max_plus = last_dy_plus\n        \n        delta_eff = (dx_plus * dz_plus * dy_max_plus)**(1.0/3.0)\n        k_delta_min = alpha * np.pi / delta_eff\n        s_iso = k_delta_min / k_req_iso\n\n    # 4. Compute the overall safety factor S\n    s_final = min(s_dir, s_iso)\n    \n    return s_final\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test suite: tuples of (dx+, dz+, dy1+, r, alpha, y_buf+)\n    test_cases = [\n        (18.0, 9.0, 0.4, 1.10, 0.75, 40.0),\n        (30.0, 40.0, 0.8, 1.15, 0.60, 40.0),\n        (60.0, 12.0, 0.3, 1.70, 0.65, 40.0),\n        (25.0, 32.0, 0.5, 1.20, 0.70, 40.0),\n        (20.0, 35.0, 0.5, 1.05, 0.55, 40.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        dx, dz, dy1, r, alpha, y_buf = case\n        s_val = calculate_safety_factor(dx, dz, dy1, r, alpha, y_buf)\n        results.append(s_val)\n    \n    # Format the output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}