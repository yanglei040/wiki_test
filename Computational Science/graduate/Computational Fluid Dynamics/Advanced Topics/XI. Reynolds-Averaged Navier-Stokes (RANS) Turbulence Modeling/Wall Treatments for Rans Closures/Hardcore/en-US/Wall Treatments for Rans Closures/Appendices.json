{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of high-Reynolds-number wall treatments in RANS modeling is the celebrated \"law of the wall.\" This empirical relationship connects the near-wall velocity to the wall shear stress, but doing so creates a transcendental algebraic equation for the friction velocity $u_\\tau$. This exercise provides direct, hands-on practice in implementing a numerical solver to find $u_\\tau$, a fundamental skill required for developing or understanding wall functions for turbulence models like $k$-$\\varepsilon$ .",
            "id": "3391064",
            "problem": "You are asked to implement an equilibrium wall-function evaluator for Reynolds-Averaged Navier–Stokes (RANS) closures at the first off-wall point in a fully turbulent boundary layer. The model base must consist only of well-tested relationships used in Computational Fluid Dynamics (CFD) wall treatments. Use the following definitions and empirical relations as the foundational base:\n\n- Reynolds-Averaged Navier–Stokes (RANS): A turbulence modeling approach in which the instantaneous flow variables are decomposed into mean and fluctuating parts, and the time-averaged equations are closed with a turbulence model.\n- Friction velocity $u_{\\tau}$ is defined by $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$, where $\\tau_w$ is the wall shear stress and $\\rho$ is the fluid density.\n- The law-of-the-wall for the mean velocity in the equilibrium logarithmic region is given by\n  $$U^+ = \\frac{1}{\\kappa}\\ln\\left(y^+\\right) + B,$$\n  where $U^+ = U_P/u_{\\tau}$, $y^+ = u_{\\tau} y_P/\\nu$, $\\kappa$ is the von Kármán constant, $B$ is the additive constant, $U_P$ is the mean velocity at the wall-adjacent point $P$, $y_P$ is the normal distance of point $P$ from the wall, and $\\nu$ is the kinematic viscosity. Use the natural logarithm.\n- In the high-Reynolds-number equilibrium wall-function framework for the $k$–$\\varepsilon$ model, impose the near-wall values at the first off-wall cell center as\n  $$k_P = \\frac{u_{\\tau}^2}{\\sqrt{C_{\\mu}}},\\qquad \\varepsilon_P = \\frac{u_{\\tau}^3}{\\kappa\\, y_P},$$\n  where $k_P$ is the turbulent kinetic energy at point $P$, $\\varepsilon_P$ is the rate of dissipation of turbulent kinetic energy, and $C_{\\mu}$ is a model constant.\n\nYour task is to, for each test case, numerically invert the logarithmic law to compute the unique positive $u_{\\tau}$ that satisfies\n$$\\frac{U_P}{u_{\\tau}} = \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) + B,$$\nand then evaluate wall shear stress $\\tau_w = \\rho\\, u_{\\tau}^2$, as well as $k_P$ and $\\varepsilon_P$ using the relations above.\n\nAssumptions and constants:\n- Use $\\kappa = 0.41$ and $B = 5.2$.\n- Use $C_{\\mu} = 0.09$.\n- Use only physically meaningful inputs: $U_P > 0$, $y_P > 0$, $\\nu > 0$, $\\rho > 0$.\n- Use the natural logarithm base $e$.\n\nNumerical requirements:\n- Solve for $u_{\\tau}$ by root-finding a well-posed scalar equation that is strictly monotone in $u_{\\tau} > 0$. Use a robust bracketing method to ensure convergence for all test cases. The solution must be computed to a tight tolerance such that the final reported values are accurate to at least six decimal places.\n\nUnits and output:\n- All inputs are in the International System of Units (SI). The required outputs are:\n  - $u_{\\tau}$ in $\\mathrm{m/s}$,\n  - $\\tau_w$ in $\\mathrm{Pa}$,\n  - $k_P$ in $\\mathrm{m^2/s^2}$,\n  - $\\varepsilon_P$ in $\\mathrm{m^2/s^3}$.\n- Express each output value as a decimal rounded to exactly six digits after the decimal point.\n\nTest suite:\n- Use $\\kappa = 0.41$, $B = 5.2$, and $C_{\\mu} = 0.09$ for all cases.\n- Case $1$: $U_P = 5\\,\\mathrm{m/s}$, $y_P = 0.5\\times 10^{-3}\\,\\mathrm{m}$, $\\nu = 1.0\\times 10^{-5}\\,\\mathrm{m^2/s}$, $\\rho = 1.225\\,\\mathrm{kg/m^3}$.\n- Case $2$: $U_P = 10\\,\\mathrm{m/s}$, $y_P = 1.0\\times 10^{-3}\\,\\mathrm{m}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^2/s}$, $\\rho = 1.225\\,\\mathrm{kg/m^3}$.\n- Case $3$: $U_P = 2\\,\\mathrm{m/s}$, $y_P = 2.0\\times 10^{-4}\\,\\mathrm{m}$, $\\nu = 1.0\\times 10^{-6}\\,\\mathrm{m^2/s}$, $\\rho = 1000.0\\,\\mathrm{kg/m^3}$.\n- Case $4$: $U_P = 50\\,\\mathrm{m/s}$, $y_P = 2.0\\times 10^{-3}\\,\\mathrm{m}$, $\\nu = 1.5\\times 10^{-5}\\,\\mathrm{m^2/s}$, $\\rho = 1.225\\,\\mathrm{kg/m^3}$.\n\nProgram specification:\n- Your program must compute, for each case, the quadruple $\\left[u_{\\tau},\\ \\tau_w,\\ k_P,\\ \\varepsilon_P\\right]$ in the order shown, with the units specified above and each value rounded to exactly six digits after the decimal point.\n- Your program should produce a single line of output containing the results as a comma-separated list of case results, each case result being its own bracketed comma-separated list, with no spaces. For example: $\\texttt{[[a\\_1,b\\_1,c\\_1,d\\_1],[a\\_2,b\\_2,c\\_2,d\\_2],\\ldots]}$.",
            "solution": "The problem requires the implementation of an equilibrium wall-function evaluator for Reynolds-Averaged Navier–Stokes (RANS) computational fluid dynamics (CFD). The core of the task is to determine the friction velocity, $u_{\\tau}$, by numerically solving the law-of-the-wall equation, and subsequently using this value to compute the wall shear stress, $\\tau_w$, and the near-wall values of turbulent kinetic energy, $k_P$, and its dissipation rate, $\\varepsilon_P$.\n\nThe fundamental relationship to be solved is the logarithmic law of the wall, an algebraic equation relating the mean velocity $U_P$ at a distance $y_P$ from the wall to the friction velocity $u_{\\tau}$:\n$$ \\frac{U_P}{u_{\\tau}} = \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) + B $$\nHere, $\\kappa$ is the von Kármán constant, $B$ is the log-layer additive constant, and $\\nu$ is the kinematic viscosity of the fluid. This is a transcendental equation for the unknown $u_{\\tau}$.\n\nTo solve this equation numerically, we define a function $f(u_{\\tau})$ whose root corresponds to the solution. The function is formulated by rearranging the equation:\n$$ f(u_{\\tau}) = \\frac{U_P}{u_{\\tau}} - \\frac{1}{\\kappa}\\ln\\left(\\frac{u_{\\tau}\\, y_P}{\\nu}\\right) - B $$\nWe seek the value of $u_{\\tau} > 0$ such that $f(u_{\\tau}) = 0$. The physical constraints are $U_P > 0$, $y_P > 0$, $\\nu > 0$, $\\kappa > 0$, and the desired solution $u_{\\tau}$ must also be positive.\n\nTo ensure that a unique solution exists and to inform the choice of a numerical solver, we analyze the properties of $f(u_{\\tau})$ on its domain $u_{\\tau} \\in (0, \\infty)$. We first compute the derivative of $f(u_{\\tau})$ with respect to $u_{\\tau}$:\n$$ f'(u_{\\tau}) = \\frac{d}{du_{\\tau}}\\left( U_P u_{\\tau}^{-1} - \\frac{1}{\\kappa}\\ln(u_{\\tau}) - \\frac{1}{\\kappa}\\ln\\left(\\frac{y_P}{\\nu}\\right) - B \\right) $$\n$$ f'(u_{\\tau}) = -U_P u_{\\tau}^{-2} - \\frac{1}{\\kappa u_{\\tau}} $$\nSince $U_P$, $\\kappa$, and $u_{\\tau}$ are all positive, both terms in the derivative are negative. Thus, $f'(u_{\\tau}) < 0$ for all $u_{\\tau} > 0$. This proves that $f(u_{\\tau})$ is a strictly monotonically decreasing function over its entire domain.\n\nNext, we examine the behavior of $f(u_{\\tau})$ at the limits of its domain:\n- As $u_{\\tau} \\to 0^+$, the term $U_P/u_{\\tau} \\to +\\infty$ and the term $-\\frac{1}{\\kappa}\\ln(u_{\\tau}) \\to +\\infty$. Therefore, $\\lim_{u_{\\tau} \\to 0^+} f(u_{\\tau}) = +\\infty$.\n- As $u_{\\tau} \\to \\infty$, the term $U_P/u_{\\tau} \\to 0$ and the term $-\\frac{1}{\\kappa}\\ln(u_{\\tau}) \\to -\\infty$. Therefore, $\\lim_{u_{\\tau} \\to \\infty} f(u_{\\tau}) = -\\infty$.\n\nBecause $f(u_{\\tau})$ is continuous and strictly decreases from $+\\infty$ to $-\\infty$ over the interval $(0, \\infty)$, the Intermediate Value Theorem guarantees that there is one and only one positive root $u_{\\tau}$ that satisfies $f(u_{\\tau}) = 0$.\n\nThis well-posed nature of the problem allows the use of a robust root-finding algorithm, such as a bracketing method (e.g., bisection or Brent's method). Such a method requires an initial interval $[a, b]$ where $f(a)$ and $f(b)$ have opposite signs. Based on our analysis:\n- We can choose a very small positive number for the lower bound, $a$, (e.g., $a=10^{-9}$), which ensures $f(a) > 0$.\n- For the upper bound, $b$, a value of $b=U_P$ is a reasonable choice, as $u_{\\tau}$ is physically expected to be smaller than the local velocity $U_P$. For this choice, $f(U_P) = 1 - B - \\frac{1}{\\kappa}\\ln\\left(\\frac{U_P y_P}{\\nu}\\right)$. With the given constants ($B=5.2$), this value is negative for all provided test cases.\nThus, the interval $[10^{-9}, U_P]$ provides a reliable bracket for the solver. The implementation will use the `scipy.optimize.brentq` function, which is an efficient and robust implementation of a bracketing root-finding algorithm.\n\nOnce the solver finds the unique value of $u_{\\tau}$ for a given test case, the remaining quantities are calculated using the provided formulae:\n- The wall shear stress, $\\tau_w$, is computed from the definition of friction velocity, $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$:\n$$ \\tau_w = \\rho\\, u_{\\tau}^2 $$\n- The turbulent kinetic energy, $k_P$, is determined by the standard equilibrium relation:\n$$ k_P = \\frac{u_{\\tau}^2}{\\sqrt{C_{\\mu}}} $$\n- The turbulent kinetic energy dissipation rate, $\\varepsilon_P$, is found using its corresponding equilibrium relation:\n$$ \\varepsilon_P = \\frac{u_{\\tau}^3}{\\kappa\\, y_P} $$\n\nThis procedure is systematically applied to each test case, using the specified constants $\\kappa = 0.41$, $B = 5.2$, and $C_{\\mu} = 0.09$. All calculations are performed in SI units, and the final results are rounded to exactly six decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes wall-function derived quantities for a series of test cases.\n    For each case, it numerically solves for the friction velocity u_tau and then\n    calculates wall shear stress (tau_w), turbulent kinetic energy (k_p),\n    and turbulent dissipation rate (epsilon_p).\n    \"\"\"\n\n    # Define the constants from the problem statement.\n    KAPPA = 0.41  # von Kármán constant\n    B = 5.2       # Log-law additive constant\n    C_MU = 0.09   # k-epsilon model constant\n\n    # Define the test cases from the problem statement as a list of tuples.\n    # Each tuple contains: (U_P, y_P, nu, rho)\n    test_cases = [\n        (5.0, 0.5e-3, 1.0e-5, 1.225),   # Case 1\n        (10.0, 1.0e-3, 1.5e-5, 1.225),  # Case 2\n        (2.0, 2.0e-4, 1.0e-6, 1000.0),  # Case 3\n        (50.0, 2.0e-3, 1.5e-5, 1.225),  # Case 4\n    ]\n\n    all_results_formatted = []\n    TOLERANCE = 1e-14 # High precision for the root-finder\n\n    for case in test_cases:\n        Up, yp, nu, rho = case\n\n        # Define the function for root-finding. We seek the root u_tau of f(u_tau) = 0.\n        # The equation is: U_P/u_tau = (1/kappa)*ln(u_tau*y_P/nu) + B\n        # Rearranged for root-finding: f(u_tau) = U_P/u_tau - ((1/kappa)*ln(u_tau*y_P/nu) + B)\n        def root_func(u_tau):\n            # The argument to the logarithm, y_plus, must be positive.\n            # Since y_P > 0 and nu > 0, this requires u_tau > 0.\n            if u_tau = 0:\n                # Return a large number to guide the solver away from non-physical values.\n                return np.inf\n            y_plus = u_tau * yp / nu\n            return Up / u_tau - ((1.0 / KAPPA) * np.log(y_plus) + B)\n\n        # A robust bracket for the root-finding algorithm.\n        # The function is strictly decreasing for u_tau > 0.\n        # As u_tau -> 0+, f(u_tau) -> +inf.\n        # As u_tau -> inf, f(u_tau) -> -inf.\n        # Lower bound `a` can be a small positive number.\n        # Upper bound `b` can be U_P, for which f(b) is negative for these cases.\n        a = 1e-9\n        b = Up\n        \n        # Solve for u_tau using Brent's method for robustness and efficiency.\n        u_tau_sol = brentq(root_func, a, b, xtol=TOLERANCE, rtol=TOLERANCE)\n\n        # Calculate the derived quantities using the solved u_tau.\n        # 1. Wall shear stress\n        tau_w_sol = rho * u_tau_sol**2\n        \n        # 2. Turbulent kinetic energy at point P\n        k_p_sol = u_tau_sol**2 / np.sqrt(C_MU)\n        \n        # 3. Turbulent dissipation rate at point P\n        epsilon_p_sol = u_tau_sol**3 / (KAPPA * yp)\n        \n        # Collect the results for the current case.\n        case_results = [u_tau_sol, tau_w_sol, k_p_sol, epsilon_p_sol]\n\n        # Format each value to exactly six decimal places.\n        formatted_quad = [f\"{val:.6f}\" for val in case_results]\n        all_results_formatted.append(f\"[{','.join(formatted_quad)}]\")\n    \n    # Final print statement in the exact required format.\n    # The output is a single line: [[...],[...],...]\n    print(f\"[{','.join(all_results_formatted)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While powerful, wall functions are only valid within a specific region of the boundary layer, typically the logarithmic layer where $y^+$ is sufficiently large. This practice provides a crucial lesson in the limitations of this approach. By using a hypothetical scenario where you generate a synthetic \"true\" velocity based on known near-wall physics, you will directly quantify the significant errors that arise when a standard log-law wall function is misapplied to grid points in the viscous sublayer, highlighting the importance of mesh quality in CFD .",
            "id": "3391066",
            "problem": "Consider a one-dimensional wall-normal discretization for a statistically steady, fully developed turbulent flow near a solid wall, modeled with Reynolds-Averaged Navier-Stokes (RANS) closures. The first cell center is located at a distance $y_1$ from the wall, with uniform cell thickness $\\Delta y$, so that $y_1 = \\Delta y/2$. Let the fluid be Newtonian with constant density $\\rho$ and kinematic viscosity $\\nu$, and let the friction velocity be $u_\\tau = \\sqrt{\\tau_w/\\rho}$, where $\\tau_w$ is the wall shear stress. Define the inner scaling variables $y^+ = y u_\\tau/\\nu$ and $U^+ = U/u_\\tau$, where $U$ is the mean streamwise velocity.\n\nAs a well-tested physical fact, in the viscous sublayer the mean velocity satisfies $U^+ \\approx y^+$, and in the logarithmic layer it satisfies $U^+ \\approx \\frac{1}{\\kappa} \\ln(y^+) + B$, where $\\kappa$ is the von Kármán constant and $B$ is an empirical intercept. Standard wall functions in many RANS closures impose the logarithmic relationship at the first off-wall point to infer the wall shear stress.\n\nYour task is to demonstrate, using a purely mathematical and algorithmic construction based on the above definitions and facts, the inconsistency introduced by placing the first node at $y^+ \\approx 5$ when a standard wall function (logarithmic law of the wall) is used, and to estimate the resulting error in $\\tau_w$. Proceed as follows for each test case:\n\n1. Take $(\\rho,\\nu,u_\\tau)$ as given constants. For a prescribed target $y_1^+$, construct a grid with $\\Delta y$ such that $y_1 = \\Delta y/2$ and $y_1^+ = y_1 u_\\tau/\\nu$ equals the target. This implies $\\Delta y = 2 y_1$ and $y_1 = \\dfrac{y_1^+ \\, \\nu}{u_\\tau}$.\n2. Generate a synthetic \"true\" mean velocity $U$ at $y_1$ consistent with the following reference near-wall behavior:\n   - If $y_1^+ \\leq 5$, use the viscous sublayer relation $U^+ = y^+$ to set $U = u_\\tau \\, y_1^+$.\n   - If $y_1^+ \\geq 30$, use the logarithmic relation $U^+ = \\dfrac{1}{\\kappa} \\ln(y^+) + B$ to set $U = u_\\tau \\left(\\dfrac{1}{\\kappa} \\ln(y_1^+) + B\\right)$.\n   - The transitional regime between $5  y^+  30$ is not used in the test suite, so no additional modeling is required.\n3. Emulate a standard wall-function inference of the wall shear stress by inverting the logarithmic relation at $y_1$ to estimate an \"inferred\" friction velocity $\\hat{u}_\\tau$ from $U$, namely solve for $\\hat{u}_\\tau$ in the nonlinear equation\n   $$ \\frac{U}{\\hat{u}_\\tau} = \\frac{1}{\\kappa} \\ln\\left(\\frac{y_1 \\hat{u}_\\tau}{\\nu}\\right) + B. $$\n   Then compute the inferred wall shear stress $\\hat{\\tau}_w = \\rho \\, \\hat{u}_\\tau^2$.\n4. Compute the true wall shear stress $\\tau_w = \\rho \\, u_\\tau^2$ and the relative error\n   $$ e = \\frac{\\hat{\\tau}_w - \\tau_w}{\\tau_w}. $$\n   Report $e$ as a decimal number.\n\nUse the constants $\\rho = 1000$ (in $\\mathrm{kg/m^3}$), $\\nu = 10^{-6}$ (in $\\mathrm{m^2/s}$), $u_\\tau = 0.2$ (in $\\mathrm{m/s}$), $\\kappa = 0.41$, and $B = 5.2$. Construct the following four test cases by prescribing $y_1^+$ targets:\n- Case A (deep viscous sublayer): $y_1^+ = 0.5$.\n- Case B (near the viscous-log transition): $y_1^+ = 5$.\n- Case C (entry to the logarithmic layer): $y_1^+ = 30$.\n- Case D (well within the logarithmic layer): $y_1^+ = 100$.\n\nFor each case, perform the steps above and compute the relative error $e$ (dimensionless). Your program should produce a single line of output containing the four relative errors as a comma-separated list enclosed in square brackets, with each value rounded to six decimal places, for example \"$[e_A,e_B,e_C,e_D]$\". No other text or formatting should be printed. All intermediate quantities using physical units should be kept internally consistent with the specified units, and the wall shear stress $\\tau_w$ is in $\\mathrm{Pa}$; the reported relative error $e$ is dimensionless and must be expressed as a decimal number.",
            "solution": "The objective is to quantify the inconsistency introduced when the first near-wall node is located at $y^+ \\approx 5$ yet a standard wall function based on the logarithmic law is imposed to infer the wall shear stress. We begin from fundamental definitions and well-tested facts for near-wall turbulent flows.\n\nFirst, define the friction velocity $u_\\tau$ from the wall shear stress $\\tau_w$ as $u_\\tau = \\sqrt{\\tau_w/\\rho}$. Introduce wall units via the inner scaling $y^+ = y \\, u_\\tau/\\nu$ and $U^+ = U/u_\\tau$. In a statistically steady, fully developed turbulent flow near a wall, the mean momentum equation simplifies in the immediate vicinity of the wall because the Reynolds shear stress is negligible compared to the viscous stress. Therefore, the total stress is approximately viscous, with $\\tau \\approx \\mu \\, \\dfrac{dU}{dy}$, where $\\mu = \\rho \\nu$ is the dynamic viscosity. Integrating this near-wall behavior yields the well-tested viscous sublayer relation $U^+ \\approx y^+$ for $y^+ \\lesssim 5$.\n\nAway from the wall, empirical and theoretical arguments using mixing-length closures (a widely accepted basis in Reynolds-Averaged Navier-Stokes modeling) lead to the logarithmic law of the wall in the equilibrium region of the boundary layer, $U^+ \\approx \\dfrac{1}{\\kappa}\\ln(y^+) + B$ for $y^+ \\gtrsim 30$, where $\\kappa$ is the von Kármán constant and $B$ is an empirical intercept. These two well-tested facts form the foundation for many computational fluid dynamics wall treatments.\n\nA typical \"standard wall function\" imposes the logarithmic relation at the first off-wall point to infer $u_\\tau$ (and hence $\\tau_w$) from the computed mean velocity $U$ at distance $y_1$ from the wall. The friction velocity $u_\\tau$ controls the inner scaling $y^+$ itself, which implies a nonlinearity when solving for $u_\\tau$ given $U$ and $y_1$. If the first node lies in the viscous sublayer, replacing the linear relation with the logarithmic one produces an inconsistency. We quantify it by comparing the \"true\" wall shear stress, computed from a consistent near-wall relation, with the \"inferred\" wall shear stress obtained by inverting the logarithmic law.\n\nAlgorithmic steps grounded in these principles:\n\n1. Fix physical constants $\\rho$, $\\nu$, $\\kappa$, $B$, and a \"true\" friction velocity $u_\\tau$ that characterizes the target flow. The true wall shear stress is $\\tau_w = \\rho \\, u_\\tau^2$.\n2. For each target $y_1^+$, compute the grid spacing so that the first cell center is at $y_1 = \\dfrac{y_1^+ \\, \\nu}{u_\\tau}$ and $\\Delta y = 2 y_1$ as per a one-dimensional wall-normal discretization with uniform cells.\n3. Generate a synthetic \"true\" mean velocity $U$ at $y_1$ by selecting the appropriate near-wall relation consistent with the known $u_\\tau$:\n   - If $y_1^+ \\leq 5$, use the viscous sublayer: $U^+ = y_1^+ \\Rightarrow U = u_\\tau \\, y_1^+$.\n   - If $y_1^+ \\geq 30$, use the logarithmic law: $U^+ = \\dfrac{1}{\\kappa}\\ln(y_1^+) + B \\Rightarrow U = u_\\tau\\left(\\dfrac{1}{\\kappa}\\ln(y_1^+) + B\\right)$.\n4. Emulate the standard wall function by solving for an inferred friction velocity $\\hat{u}_\\tau$ from the logarithmic relation imposed at $y_1$. The equation to solve is\n   $$ g(\\hat{u}_\\tau) = \\frac{U}{\\hat{u}_\\tau} - \\left[\\frac{1}{\\kappa} \\ln\\left(\\frac{y_1 \\hat{u}_\\tau}{\\nu}\\right) + B\\right] = 0, $$\n   which is well-posed for $\\hat{u}_\\tau  0$ since the first term decreases with increasing $\\hat{u}_\\tau$ and the second term increases logarithmically, ensuring a unique root. A robust numerical method such as the Brent bracketing method can be used to find the root in a wide interval (for instance, between a small positive lower bound and a large upper bound) because $g$ exhibits a sign change over such a range for physically plausible inputs.\n5. Compute the inferred wall shear stress $\\hat{\\tau}_w = \\rho \\, \\hat{u}_\\tau^2$ and the relative error\n   $$ e = \\frac{\\hat{\\tau}_w - \\tau_w}{\\tau_w}. $$\n   This error is dimensionless and directly quantifies the inconsistency introduced by using the log-law at the first node.\n6. Apply this procedure to the four test cases designed to probe distinct regions:\n   - $y_1^+ = 0.5$ (deep viscous sublayer, expected large inconsistency),\n   - $y_1^+ = 5$ (near the transition, the case of interest),\n   - $y_1^+ = 30$ (entry to the logarithmic region, consistency expected),\n   - $y_1^+ = 100$ (well within the logarithmic region, consistency expected).\n7. Report the errors $e$ as a list of four decimal numbers rounded to six decimal places, in the specified single-line format.\n\nScientific interpretation: For $y_1^+ \\leq 5$, the true $U^+$ grows linearly with $y^+$, while the logarithmic law grows only as the logarithm. When one inverts the logarithmic relation using a velocity that is actually consistent with the linear law at the same location, the inferred $\\hat{u}_\\tau$ decreases relative to the true $u_\\tau$ to reconcile the larger observed $U/u_\\tau$ with the logarithmic expression, resulting in a substantial underprediction of $\\hat{\\tau}_w$. Conversely, for $y_1^+ \\geq 30$, if $U$ is consistent with the logarithmic law, inverting the same law reproduces the correct $u_\\tau$ and thus yields negligible error in $\\tau_w$. This demonstrates the inconsistency of placing the first node too close to the wall when standard wall functions are used.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    # Physical and model constants (units: rho [kg/m^3], nu [m^2/s], u_tau [m/s])\n    rho = 1000.0\n    nu = 1e-6\n    u_tau_true = 0.2\n    kappa = 0.41\n    B = 5.2\n\n    # Test cases specified by target y1^+ values\n    yplus_targets = [0.5, 5.0, 30.0, 100.0]\n\n    def U_true_at_y1(yplus):\n        \"\"\"\n        Compute synthetic 'true' mean velocity U at y1 for a given yplus = y1^+,\n        using viscous sublayer for yplus = 5, and log-law for yplus = 30.\n        \"\"\"\n        if yplus = 5.0:\n            # Viscous sublayer: U+ = y+\n            return u_tau_true * yplus\n        else:\n            # Log-law: U+ = (1/kappa) ln(y+) + B\n            return u_tau_true * ((1.0 / kappa) * np.log(yplus) + B)\n\n    def infer_u_tau_from_log(U, y1):\n        \"\"\"\n        Infer friction velocity u_tau by inverting the log-law at y1:\n            U/u = (1/kappa) ln(y1 * u / nu) + B\n        Solve g(u) = 0 with a robust bracket.\n        \"\"\"\n        def g(u):\n            return U / u - ((1.0 / kappa) * np.log(y1 * u / nu) + B)\n\n        # Use a wide bracket to ensure a sign change for physically plausible U, y1\n        lower = 1e-8\n        upper = 1e4\n        # Ensure the function is defined in the bracket\n        return brentq(g, lower, upper, maxiter=200, xtol=1e-12)\n\n    results = []\n    for yplus_target in yplus_targets:\n        # Construct grid: y1 = yplus_target * nu / u_tau_true\n        y1 = yplus_target * nu / u_tau_true\n        # Synthetic \"true\" velocity at y1\n        U = U_true_at_y1(yplus_target)\n        # Inferred friction velocity from standard wall function (log-law)\n        u_tau_inferred = infer_u_tau_from_log(U, y1)\n        # Compute wall shear stresses\n        tau_w_true = rho * (u_tau_true ** 2)\n        tau_w_inferred = rho * (u_tau_inferred ** 2)\n        # Relative error as a decimal number\n        error = (tau_w_inferred - tau_w_true) / tau_w_true\n        results.append(error)\n\n    # Final print statement in the exact required format, rounded to six decimals.\n    print(f\"[{','.join(f'{e:.6f}' for e in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Bridging the gap between theory and application, this exercise addresses a challenge faced by all practical CFD codes: how to handle meshes with varying wall-normal resolution. A robust solver cannot assume that all near-wall cells fall neatly into the log-layer; it needs an automated strategy to select the appropriate wall treatment. This practice guides you through building a simplified version of such a logic, using well-established empirical correlations as a proxy for flow conditions to estimate the local $y^+$ and implement a switching criterion between a high-Re wall function and a two-layer model .",
            "id": "3391094",
            "problem": "You are tasked with building a program that, for a given set of wall-adjacent mesh faces in a Reynolds-Averaged Navier–Stokes (RANS) simulation, decides whether high-Reynolds-number (high-Re) wall functions are valid and automatically switches to a two-layer model elsewhere based on the dimensionless wall distance. Your derivation must begin from fundamental relations of wall-bounded shear flows in computational fluid dynamics. The program must implement the following steps grounded in first principles.\n\nStart from the definition of wall shear stress and the associated friction velocity. Let the skin-friction coefficient be defined by $C_f = \\tau_w / \\left(\\tfrac{1}{2} \\rho U_b^2\\right)$, where $\\tau_w$ is the wall shear stress, $\\rho$ is the fluid density, and $U_b$ is a representative bulk velocity parallel to the wall. The friction velocity is defined by $u_\\tau = \\sqrt{\\tau_w / \\rho}$. The dimensionless wall distance is defined by $y^+ = u_\\tau y / \\nu$, where $y$ is the distance from the wall to the face centroid and $\\nu = \\mu / \\rho$ is the kinematic viscosity with $\\mu$ the dynamic viscosity.\n\nTo close the skin-friction coefficient without providing direct wall shear data, adopt widely used flat-plate correlations that are consistent with boundary layer theory. For a plate of length $L$, define the plate-length Reynolds number $Re_L = \\rho U_b L / \\mu$. Use a laminar correlation for $Re_L  5 \\times 10^5$ and a turbulent correlation otherwise. Specifically, for laminar boundary layers, use $C_f = 0.664 / \\sqrt{Re_L}$, and for turbulent boundary layers, use $C_f = 0.0592 \\, Re_L^{-1/5}$. These correlations are well tested in wall-bounded shear flows and provide a physically consistent estimate of $C_f$ for the present purpose.\n\nGiven $C_f$, compute $u_\\tau$ via $u_\\tau = U_b \\sqrt{\\tfrac{1}{2} C_f}$, and then compute $y^+$ for each face via $y^+ = u_\\tau y / \\nu$. Declare the high-Re wall function valid when the first off-wall cell centroid lies in the logarithmic region, which for engineering purposes is taken as $y^+ \\ge 30$. The automatic switch to a two-layer model is then triggered elsewhere, namely when $y^+  30$.\n\nFor each test case, the required outputs are:\n- The fraction of faces for which high-Re wall functions are valid, defined as the number of faces with $y^+ \\ge 30$ divided by the total number of faces (expressed as a decimal).\n- An integer decision code per face specifying the model choice, where $2$ denotes high-Re wall function use (valid region $y^+ \\ge 30$), and $0$ denotes automatic switch to the two-layer model ($y^+  30$).\n\nScientific and numerical requirements:\n- Derivations must be consistent with the above definitions and correlations.\n- Distances must be expressed in meters (m), velocities in meters per second (m/s), density in kilograms per cubic meter (kg/m$^3$), dynamic viscosity in Pascal-seconds (Pa·s), and $y^+$ is dimensionless.\n- The final fraction should be returned as a decimal number. You may round the fraction to three decimal places.\n- Angles are not involved in this problem.\n\nTest suite:\nProvide the following three test cases to validate your program:\n1. Turbulent regime with a wide spread of $y$ values:\n   - $U_b = 20$ m/s, $L = 2$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n   - $y$ values in meters: $[5 \\times 10^{-5}, 2 \\times 10^{-4}, 8 \\times 10^{-4}, 3 \\times 10^{-3}, 1 \\times 10^{-2}]$\n2. Laminar regime with small $y$ values:\n   - $U_b = 2$ m/s, $L = 0.1$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n   - $y$ values in meters: $[1 \\times 10^{-5}, 1 \\times 10^{-4}, 5 \\times 10^{-4}, 1 \\times 10^{-3}]$\n3. Boundary-focused turbulent case that includes faces near the transition threshold:\n   - $U_b = 15$ m/s, $L = 1$ m, $\\rho = 1.225$ kg/m$^3$, $\\mu = 1.8 \\times 10^{-5}$ Pa·s\n   - $y$ values in meters: $[1.136 \\times 10^{-4}, 6.807 \\times 10^{-4}, 6.807 \\times 10^{-3}, 1 \\times 10^{-2}]$\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is encoded as a two-element list consisting of the fraction (a float, rounded to three decimals) and the list of integer decision codes per face. For example:\n\"[[fraction1,[code_1,code_2,...]],[fraction2,[...]],...]\"",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, well-posed with a clear and deterministic set of calculations, and objective in its definitions and criteria. All required physical parameters and empirical correlations are provided, constituting a self-contained and solvable problem. The following solution proceeds by deriving the required quantities step-by-step from the provided first principles.\n\nThe primary objective is to determine, for a set of wall-adjacent mesh faces, whether a high-Reynolds-number (high-Re) wall function is applicable. This decision is based on the dimensionless wall distance, $y^+$, of the cell centroid. The procedure involves a sequence of calculations beginning with global flow parameters and culminating in the value of $y^+$ for each face.\n\n**Step 1: Plate-Length Reynolds Number ($Re_L$)**\nThe first step is to characterize the overall flow regime (laminar or turbulent) over the characteristic length scale $L$. This is achieved by computing the plate-length Reynolds number, $Re_L$, defined as the ratio of inertial forces to viscous forces.\n$$\nRe_L = \\frac{\\rho U_b L}{\\mu}\n$$\nHere, $\\rho$ is the fluid density, $U_b$ is the bulk velocity, $L$ is the characteristic length of the plate, and $\\mu$ is the dynamic viscosity. The problem specifies a threshold of $Re_L = 5 \\times 10^5$ to distinguish between laminar and turbulent boundary layer correlations.\n\n**Step 2: Skin-Friction Coefficient ($C_f$)**\nThe skin-friction coefficient, $C_f$, relates the wall shear stress, $\\tau_w$, to the dynamic pressure of the bulk flow. The problem provides standard empirical correlations for $C_f$ based on $Re_L$, which are derived from flat-plate boundary layer theory.\n\nFor a laminar boundary layer, where $Re_L  5 \\times 10^5$:\n$$\nC_f = \\frac{0.664}{\\sqrt{Re_L}}\n$$\nFor a turbulent boundary layer, where $Re_L \\ge 5 \\times 10^5$:\n$$\nC_f = 0.0592 \\, Re_L^{-1/5}\n$$\n\n**Step 3: Friction Velocity ($u_\\tau$)**\nThe friction velocity, $u_\\tau$, is a fundamental velocity scale that characterizes the shear-dominated region near the wall. It is defined in terms of the wall shear stress, $\\tau_w$, and the fluid density, $\\rho$:\n$$\nu_\\tau = \\sqrt{\\frac{\\tau_w}{\\rho}}\n$$\nTo compute $u_\\tau$ without direct knowledge of $\\tau_w$, we use the definition of the skin-friction coefficient, $C_f = \\tau_w / \\left(\\tfrac{1}{2} \\rho U_b^2\\right)$. Rearranging for $\\tau_w$ gives $\\tau_w = C_f \\cdot \\frac{1}{2} \\rho U_b^2$. Substituting this into the definition of $u_\\tau$:\n$$\nu_\\tau = \\sqrt{\\frac{C_f \\cdot \\frac{1}{2} \\rho U_b^2}{\\rho}} = \\sqrt{\\frac{1}{2} C_f U_b^2}\n$$\nThis yields the final expression for $u_\\tau$ in terms of known quantities:\n$$\nu_\\tau = U_b \\sqrt{\\frac{C_f}{2}}\n$$\n\n**Step 4: Dimensionless Wall Distance ($y^+$)**\nThe dimensionless wall distance, $y^+$, is the wall-normal coordinate $y$ non-dimensionalized by the viscous length scale, $\\nu/u_\\tau$. It is the crucial parameter for determining which region of the boundary layer a given point lies within (viscous sublayer, buffer layer, or log-law region).\nThe kinematic viscosity, $\\nu$, is defined as $\\nu = \\mu / \\rho$. The formula for $y^+$ is:\n$$\ny^+ = \\frac{u_\\tau y}{\\nu}\n$$\nThis calculation is performed for each face centroid distance $y$ provided in the input data.\n\n**Step 5: Model Selection and Output Generation**\nThe final step is to apply the decision criterion for model selection. High-Re wall functions are valid only if the first off-wall computational node lies within the logarithmic region of the boundary layer. For engineering applications, this region is conventionally taken to begin at $y^+ \\approx 30$.\n- If $y^+ \\ge 30$, the high-Re wall function is deemed valid. A decision code of $2$ is assigned.\n- If $y^+  30$, the node is in the viscous sublayer or buffer layer, where wall functions are not applicable. A switch to a two-layer model (or a low-Re model that resolves the viscous sublayer) is required. A decision code of $0$ is assigned.\n\nThe required outputs for each test case are then compiled:\n1.  The fraction of faces where the wall function is valid, calculated as the count of faces with $y^+ \\ge 30$ divided by the total number of faces. The result is rounded to three decimal places.\n2.  A list containing the integer decision code ($0$ or $2$) for each face.\n\nThis systematic procedure ensures a physically consistent and automated method for selecting the appropriate near-wall modeling strategy in a RANS simulation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for wall function validity based on y+ for multiple test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Turbulent regime\n        {\n            \"Ub\": 20.0,\n            \"L\": 2.0,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([5e-5, 2e-4, 8e-4, 3e-3, 1e-2]),\n        },\n        # Case 2: Laminar regime\n        {\n            \"Ub\": 2.0,\n            \"L\": 0.1,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([1e-5, 1e-4, 5e-4, 1e-3]),\n        },\n        # Case 3: Boundary-focused turbulent case\n        {\n            \"Ub\": 15.0,\n            \"L\": 1.0,\n            \"rho\": 1.225,\n            \"mu\": 1.8e-5,\n            \"y_values\": np.array([1.136e-4, 6.807e-4, 6.807e-3, 1e-2]),\n        },\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        # Extract parameters for the current case\n        Ub = case[\"Ub\"]\n        L = case[\"L\"]\n        rho = case[\"rho\"]\n        mu = case[\"mu\"]\n        y_values = case[\"y_values\"]\n\n        # Step 1: Calculate Reynolds number\n        Re_L = rho * Ub * L / mu\n\n        # Step 2: Calculate skin-friction coefficient based on flow regime\n        if Re_L  5e5:\n            # Laminar correlation\n            Cf = 0.664 / np.sqrt(Re_L)\n        else:\n            # Turbulent correlation\n            Cf = 0.0592 * Re_L**(-1.0 / 5.0)\n\n        # Step 3: Calculate friction velocity\n        u_tau = Ub * np.sqrt(Cf / 2.0)\n\n        # Step 4: Calculate dimensionless wall distance y+\n        nu = mu / rho\n        y_plus = u_tau * y_values / nu\n\n        # Step 5: Apply decision logic and generate outputs\n        # Assign code 2 for y+ = 30 (high-Re), 0 otherwise (two-layer)\n        decision_codes = np.where(y_plus = 30, 2, 0).tolist()\n\n        # Calculate the fraction of valid faces\n        num_valid_faces = np.sum(y_plus = 30)\n        total_faces = len(y_values)\n        fraction = num_valid_faces / total_faces if total_faces  0 else 0.0\n\n        # Format the results as specified\n        fraction_str = f\"{fraction:.3f}\"\n        codes_str = f\"[{','.join(map(str, decision_codes))}]\"\n        result_str = f\"[{fraction_str},{codes_str}]\"\n        results_str_list.append(result_str)\n\n    # Final print statement in the exact required format.\n    final_output = f\"[{','.join(results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}