{
    "hands_on_practices": [
        {
            "introduction": "This practice explores a fundamental consistency requirement for any valid ALE scheme: the preservation of a uniform flow, also known as free-stream preservation. You will derive from first principles why this essential property is intrinsically linked to the satisfaction of the Discrete Geometric Conservation Law (DGCL). By implementing and contrasting a correct scheme with a deliberately flawed one, this exercise provides a clear, hands-on demonstration of how inconsistencies in defining mesh face velocities can artificially generate sources or sinks, violating a basic physical principle .",
            "id": "3292275",
            "problem": "Consider the finite volume formulation of a passive conserved scalar $q$ advected by a constant fluid velocity $\\mathbf{u}$ on a moving mesh with mesh velocity $\\mathbf{w}$ in the Arbitrary Lagrangian–Eulerian (ALE) framework. Starting from the integral conservation law and the Reynolds transport theorem, derive the ALE form suitable for finite volume discretization and state the discrete condition that guarantees invariance of a uniform solution under a pure mesh translation. Specifically, use the following fundamental base:\n\n- The integral conservation law for a conserved scalar over a moving control volume $V(t)$: $\\dfrac{\\mathrm{d}}{\\mathrm{d}t}\\int_{V(t)} q \\,\\mathrm{d}V + \\int_{\\partial V(t)} q\\, (\\mathbf{u}-\\mathbf{w})\\cdot \\mathbf{n} \\,\\mathrm{d}A = 0$.\n- The identity for a closed surface $\\partial V$ with outward unit normal $\\mathbf{n}$ and area element $\\mathrm{d}A$: $\\int_{\\partial V} \\mathbf{n}\\,\\mathrm{d}A = \\mathbf{0}$.\n- The Geometric Conservation Law (GCL), which in continuous form states $\\dfrac{\\mathrm{d}}{\\mathrm{d}t}V(t) = \\int_{\\partial V(t)} \\mathbf{w}\\cdot \\mathbf{n} \\,\\mathrm{d}A$.\n\nExplain, from first principles, why any consistent ALE discretization must render a uniform state $q(\\mathbf{x},t) \\equiv q_0$ invariant under a pure mesh translation $\\mathbf{w} = \\mathbf{c}$, where $\\mathbf{c}$ is a constant vector, regardless of the constant fluid velocity $\\mathbf{u}$. Then, design a numerical test that detects violation due to inconsistent face sweeping, and propose a correction based on face-averaged $\\mathbf{w}$.\n\nYou must implement a self-contained program that, for a set of two-dimensional rectangular control volumes forming a structured grid, computes after one time step $\\Delta t$:\n- The invariance error defined as $\\max_{K} \\left| q_K^{n+1} - q_0 \\right|$, where $q_K^{n+1}$ is the cell-average after one ALE update for cell $K$ and $q_0$ is the uniform initial value.\n- The discrete geometric conservation residual defined as $\\max_{K} \\left| \\sum_{f\\subset \\partial K} \\mathbf{w}_f\\cdot \\mathbf{n}_f \\, L_f \\right|$, where the sum runs over faces $f$ of cell $K$, $\\mathbf{n}_f$ is the outward unit normal of face $f$, and $L_f$ is the face length.\n\nYour discretization must use the standard finite volume ALE update for a scalar on a cell $K$ with area $V_K$:\n- $V_K^{n+1} q_K^{n+1} = V_K^{n} q_K^{n} - \\Delta t \\sum_{f\\subset \\partial K} q_f \\, (\\mathbf{u} - \\mathbf{w}_f)\\cdot \\mathbf{n}_f \\, L_f$,\nwith $q_f = q_K^{n}$ for a uniform state and rectangular cells where $V_K^{n+1} = V_K^{n}$ under pure translation.\n\nTo expose the inconsistency, construct two schemes:\n- An inconsistent face sweeping scheme that assigns different $\\mathbf{w}_f$ to the same geometric face when viewed from adjacent cells, using deliberately biased per-orientation perturbations superimposed on $\\mathbf{c}$ so that $\\sum_{f} \\mathbf{w}_f\\cdot \\mathbf{n}_f \\, L_f \\neq 0$ even when $\\mathbf{w} = \\mathbf{c}$.\n- A corrected scheme that assigns to each face the face-averaged mesh velocity obtained from nodal velocities, which under uniform translation equals exactly $\\mathbf{c}$, ensuring discrete geometric conservation.\n\nUse the following test suite of parameter values, each yielding a single result consisting of a list of two floats $[E,R]$ where $E$ is the invariance error and $R$ is the discrete geometric conservation residual:\n\n- Test 1 (single-cell, inconsistent): $N_x=1$, $N_y=1$, $h_x=1.0$, $h_y=1.0$, $\\mathbf{u} = \\mathbf{c} = [0.7,-0.3]$, $\\Delta t = 0.2$, $q_0 = 2.5$, with the inconsistent face sweeping scheme.\n- Test 2 (single-cell, corrected): Same as Test 1 but with the corrected face-averaged $\\mathbf{w}$ scheme.\n- Test 3 (multi-cell, inconsistent): $N_x=4$, $N_y=3$, $h_x=1.0$, $h_y=1.0$, $\\mathbf{u} = \\mathbf{c} = [0.7,-0.3]$, $\\Delta t = 0.2$, $q_0 = 2.5$, with the inconsistent face sweeping scheme.\n- Test 4 (multi-cell, corrected): Same as Test 3 but with the corrected face-averaged $\\mathbf{w}$ scheme.\n- Test 5 (multi-cell, inconsistent, $\\mathbf{u}\\neq \\mathbf{c}$): $N_x=5$, $N_y=2$, $h_x=1.2$, $h_y=0.8$, $\\mathbf{u} = [0.2,0.1]$, $\\mathbf{c} = [0.7,-0.3]$, $\\Delta t = 0.3$, $q_0 = 1.0$, with the inconsistent face sweeping scheme.\n- Test 6 (multi-cell, corrected, $\\mathbf{u}\\neq \\mathbf{c}$): Same as Test 5 but with the corrected face-averaged $\\mathbf{w}$ scheme.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and without spaces, with each test case result formatted as $[E,R]$ and all aggregated into one list. For example: $[[E_1,R_1],[E_2,R_2],\\dots]$. All quantities are nondimensional; no physical unit conversion is required. Angles do not appear in this formulation.\n\nThe inconsistent face sweeping scheme shall be constructed as follows to guarantee detection: for each cell $(i,j)$ with zero-based indices, define the outward normals and face lengths for its four faces as\n- Left face: $\\mathbf{n}_L = [-1,0]$, $L_L = h_y$,\n- Right face: $\\mathbf{n}_R = [1,0]$, $L_R = h_y$,\n- Bottom face: $\\mathbf{n}_B = [0,-1]$, $L_B = h_x$,\n- Top face: $\\mathbf{n}_T = [0,1]$, $L_T = h_x$,\nand set the face mesh velocity used by cell $(i,j)$ as\n- $\\mathbf{w}_R = \\mathbf{c} + [\\gamma_x (i+1), -\\gamma_y (j+1)]$,\n- $\\mathbf{w}_L = \\mathbf{c} + [-0.5\\,\\gamma_x (i+1), +0.25\\,\\gamma_y (j+1)]$,\n- $\\mathbf{w}_T = \\mathbf{c} + [0.1\\,\\gamma_x (i+1), +1.5\\,\\gamma_y (j+1)]$,\n- $\\mathbf{w}_B = \\mathbf{c} + [-0.2\\,\\gamma_x (i+1), -0.8\\,\\gamma_y (j+1)]$,\nwith $\\gamma_x = 10^{-3}$ and $\\gamma_y = 2\\times 10^{-3}$. This produces a non-zero discrete geometric conservation residual per cell and thus a measurable invariance error.\n\nThe corrected scheme shall assign $\\mathbf{w}_f = \\mathbf{c}$ for all faces $f$, corresponding to the face-averaged nodal velocity under uniform translation.\n\nYour program must implement these computations exactly for the provided tests and print the aggregated results in the required format.",
            "solution": "The problem requires a derivation of the finite volume Arbitrary Lagrangian–Eulerian (ALE) update scheme for a conserved passive scalar and an analysis of the conditions required for the scheme to preserve a uniform scalar field. This preservation property, often called free-stream preservation, is a fundamental consistency requirement for any valid numerical scheme. The analysis will demonstrate that this property is intrinsically linked to the satisfaction of the Discrete Geometric Conservation Law (DGCL).\n\nThe starting point is the integral form of the conservation law for a scalar quantity $q$ over a time-dependent control volume $V(t)$ with boundary $\\partial V(t)$, moving with velocity $\\mathbf{w}$. The fluid velocity is $\\mathbf{u}$. This is the Reynolds transport theorem applied to a conserved quantity, which in the ALE frame is:\n$$\n\\dfrac{\\mathrm{d}}{\\mathrm{d}t}\\int_{V(t)} q \\,\\mathrm{d}V + \\int_{\\partial V(t)} q\\, (\\mathbf{u}-\\mathbf{w})\\cdot \\mathbf{n} \\,\\mathrm{d}A = 0\n$$\nHere, $\\mathbf{n}$ is the outward-pointing unit normal vector to the surface element $\\mathrm{d}A$.\n\nFor a finite volume discretization, we divide the spatial domain into a set of non-overlapping control volumes, or cells, $K$. For each cell $K$, we integrate the equation over a time step from $t^n$ to $t^{n+1} = t^n + \\Delta t$. Using a first-order Euler explicit scheme for the time derivative, we get:\n$$\n\\frac{1}{\\Delta t} \\left[ \\left(\\int_{V_K} q \\,\\mathrm{d}V\\right)^{n+1} - \\left(\\int_{V_K} q \\,\\mathrm{d}V\\right)^{n} \\right] + \\left(\\int_{\\partial V_K} q\\, (\\mathbf{u}-\\mathbf{w})\\cdot \\mathbf{n} \\,\\mathrm{d}A\\right)^n \\approx 0\n$$\nWe define the cell-averaged scalar as $q_K(t) = \\frac{1}{V_K(t)} \\int_{V_K(t)} q(\\mathbf{x}, t) \\,\\mathrm{d}V$, where $V_K(t)$ is the volume (or area in 2D) of cell $K$. The equation becomes:\n$$\n\\frac{V_K^{n+1} q_K^{n+1} - V_K^n q_K^n}{\\Delta t} + \\sum_{f \\subset \\partial K} \\int_{A_f} q\\, (\\mathbf{u}-\\mathbf{w})\\cdot \\mathbf{n}_f \\,\\mathrm{d}A = 0\n$$\nThe surface integral over the cell boundary $\\partial V_K$ is replaced by a sum over the faces $f$ of the cell. Approximating the face integral by the product of a face-averaged value and the face area (or length $L_f$ in 2D) gives the fully discrete update scheme:\n$$\nV_K^{n+1} q_K^{n+1} = V_K^{n} q_K^{n} - \\Delta t \\sum_{f\\subset \\partial K} q_f \\, (\\mathbf{u} - \\mathbf{w}_f)\\cdot \\mathbf{n}_f \\, L_f\n$$\nHere, $q_f$ and $\\mathbf{w}_f$ are representative values of the scalar and mesh velocity on face $f$.\n\nWe now analyze the condition required for this scheme to preserve a uniform state $q(\\mathbf{x}, t) \\equiv q_0$, where $q_0$ is a constant. In this case, the initial cell averages are all identical, $q_K^n = q_0$ for all $K$. A simple and consistent choice for the face value is $q_f = q_K^n = q_0$. Substituting these into the update formula:\n$$\nV_K^{n+1} q_K^{n+1} = V_K^{n} q_0 - \\Delta t \\sum_{f\\subset \\partial K} q_0 \\, (\\mathbf{u} - \\mathbf{w}_f)\\cdot \\mathbf{n}_f \\, L_f\n$$\nFactoring out the constant $q_0$:\n$$\nV_K^{n+1} q_K^{n+1} = V_K^{n} q_0 - \\Delta t \\, q_0 \\sum_{f\\subset \\partial K} (\\mathbf{u} - \\mathbf{w}_f)\\cdot \\mathbf{n}_f \\, L_f\n$$\nThe summation term can be split:\n$$\n\\sum_{f\\subset \\partial K} (\\mathbf{u} - \\mathbf{w}_f)\\cdot \\mathbf{n}_f \\, L_f = \\sum_{f\\subset \\partial K} \\mathbf{u}\\cdot \\mathbf{n}_f \\, L_f - \\sum_{f\\subset \\partial K} \\mathbf{w}_f\\cdot \\mathbf{n}_f \\, L_f\n$$\nSince the fluid velocity $\\mathbf{u}$ is constant, the first term on the right becomes $\\mathbf{u} \\cdot \\left(\\sum_{f\\subset \\partial K} \\mathbf{n}_f L_f\\right)$. For any closed control volume, the vector sum of its outward-pointing, area-weighted normals is zero. This is the discrete equivalent of the identity $\\int_{\\partial V} \\mathbf{n}\\,\\mathrm{d}A = \\mathbf{0}$. Therefore, $\\sum_{f\\subset \\partial K} \\mathbf{n}_f L_f = \\mathbf{0}$, and the term involving $\\mathbf{u}$ vanishes entirely. This is a crucial step: the invariance property for a uniform state must be independent of the fluid velocity.\n\nThe update equation simplifies to:\n$$\nV_K^{n+1} q_K^{n+1} = V_K^{n} q_0 + \\Delta t \\, q_0 \\sum_{f\\subset \\partial K} \\mathbf{w}_f\\cdot \\mathbf{n}_f \\, L_f\n$$\nNow, we invoke the Geometric Conservation Law (GCL). In its continuous form, it states that the rate of change of a control volume's volume is the flux of the boundary velocity: $\\frac{\\mathrm{d}V}{\\mathrm{d}t} = \\int_{\\partial V} \\mathbf{w}\\cdot\\mathbf{n}\\,\\mathrm{d}A$. A consistent discrete analogue, the Discrete Geometric Conservation Law (DGCL), is obtained by discretizing this law in the same manner as the scalar transport equation:\n$$\n\\frac{V_K^{n+1} - V_K^n}{\\Delta t} = \\sum_{f \\subset \\partial K} \\mathbf{w}_f \\cdot \\mathbf{n}_f \\, L_f\n$$\nSubstituting this DGCL into the simplified update equation for $q_K^{n+1}$:\n$$\nV_K^{n+1} q_K^{n+1} = V_K^{n} q_0 + q_0 (V_K^{n+1} - V_K^n)\n$$\n$$\nV_K^{n+1} q_K^{n+1} = q_0 (V_K^n + V_K^{n+1} - V_K^n) = q_0 V_K^{n+1}\n$$\nAssuming the cell volume $V_K^{n+1}$ is non-zero, we can divide by it to obtain the desired result:\n$$\nq_K^{n+1} = q_0\n$$\nThis derivation shows that a uniform state $q_0$ remains invariant if and only if the numerical scheme satisfies the Discrete Geometric Conservation Law. This condition ensures that the numerical discretization of the geometry evolution is consistent with the discretization of the transport equation, preventing the creation of artificial sources or sinks of the scalar $q$ due to mesh motion alone.\n\nFor the specific case of a pure mesh translation, the mesh velocity is a constant vector everywhere, $\\mathbf{w}(\\mathbf{x},t) = \\mathbf{c}$. Geometrically, the volume of any cell remains constant, so $V_K^{n+1} = V_K^n$. The DGCL then requires:\n$$\n\\frac{V_K^{n+1} - V_K^n}{\\Delta t} = 0 = \\sum_{f\\subset \\partial K} \\mathbf{w}_f \\cdot \\mathbf{n}_f \\, L_f\n$$\nThe discrete condition that guarantees invariance of a uniform solution under pure mesh translation is $\\sum_{f\\subset \\partial K} \\mathbf{w}_f \\cdot \\mathbf{n}_f \\, L_f = 0$ for every cell $K$.\n\nThe numerical test is designed to expose violations of this condition.\nThe \"corrected\" scheme defines the face velocity $\\mathbf{w}_f$ uniquely for each geometric face, for instance, as the average of its nodal velocities. For a pure translation $\\mathbf{w}=\\mathbf{c}$, all nodes move with $\\mathbf{c}$, so the face velocities are all $\\mathbf{w}_f = \\mathbf{c}$. The DGCL sum is then $\\sum_{f} \\mathbf{c} \\cdot \\mathbf{n}_f L_f = \\mathbf{c} \\cdot (\\sum_{f} \\mathbf{n}_f L_f) = \\mathbf{c} \\cdot \\mathbf{0} = 0$. This scheme satisfies the DGCL and will preserve the uniform state, resulting in zero invariance error and zero GCL residual.\n\nThe \"inconsistent\" scheme represents a common implementation error where the face velocity $\\mathbf{w}_f$ is computed from a cell-centric perspective. The formulas provided deliberately introduce small, cell-index-dependent perturbations to $\\mathbf{c}$. Thus, for a shared face between two cells, the mesh velocity computed by one cell is different from that computed by its neighbor. This inconsistency leads to a non-zero sum $\\sum_{f \\subset \\partial K} \\mathbf{w}_f \\cdot \\mathbf{n}_f \\, L_f \\neq 0$. As shown in the derivation, this DGCL violation directly causes an error in the updated scalar, $|q_K^{n+1}-q_0| = \\frac{\\Delta t |q_0|}{V_K^n} |\\sum_f \\mathbf{w}_f \\cdot \\mathbf{n}_f L_f|$, which is proportional to the GCL residual. The numerical implementation will calculate this error $E$ and the residual $R$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the ALE invariance test suite.\n    \"\"\"\n\n    test_cases = [\n        # Test 1 (single-cell, inconsistent)\n        {'Nx': 1, 'Ny': 1, 'hx': 1.0, 'hy': 1.0, 'u': np.array([0.7, -0.3]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.2, 'q0': 2.5, 'inconsistent': True},\n        # Test 2 (single-cell, corrected)\n        {'Nx': 1, 'Ny': 1, 'hx': 1.0, 'hy': 1.0, 'u': np.array([0.7, -0.3]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.2, 'q0': 2.5, 'inconsistent': False},\n        # Test 3 (multi-cell, inconsistent)\n        {'Nx': 4, 'Ny': 3, 'hx': 1.0, 'hy': 1.0, 'u': np.array([0.7, -0.3]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.2, 'q0': 2.5, 'inconsistent': True},\n        # Test 4 (multi-cell, corrected)\n        {'Nx': 4, 'Ny': 3, 'hx': 1.0, 'hy': 1.0, 'u': np.array([0.7, -0.3]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.2, 'q0': 2.5, 'inconsistent': False},\n        # Test 5 (multi-cell, inconsistent, u != c)\n        {'Nx': 5, 'Ny': 2, 'hx': 1.2, 'hy': 0.8, 'u': np.array([0.2, 0.1]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.3, 'q0': 1.0, 'inconsistent': True},\n        # Test 6 (multi-cell, corrected, u != c)\n        {'Nx': 5, 'Ny': 2, 'hx': 1.2, 'hy': 0.8, 'u': np.array([0.2, 0.1]),\n         'c': np.array([0.7, -0.3]), 'dt': 0.3, 'q0': 1.0, 'inconsistent': False},\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        all_results.append(result)\n\n    # Format the final output string exactly as specified.\n    result_strings = [f\"[{e},{r}]\" for e, r in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef run_simulation(Nx, Ny, hx, hy, u, c, dt, q0, inconsistent):\n    \"\"\"\n    Computes invariance error and GCL residual for a given grid and scheme.\n    \"\"\"\n    \n    # Constants for the inconsistent scheme\n    gamma_x = 1e-3\n    gamma_y = 2e-3\n    \n    max_invariance_error = 0.0\n    max_gcl_residual = 0.0\n\n    # Cell volume (constant under pure translation)\n    V_K = hx * hy\n\n    # Iterate over all cells in the grid (i = x-index, j = y-index)\n    for j in range(Ny):\n        for i in range(Nx):\n            # Define faces: normal vector, length\n            faces_geom = {\n                'R': {'n': np.array([1.0, 0.0]), 'L': hy},   # Right\n                'L': {'n': np.array([-1.0, 0.0]), 'L': hy},  # Left\n                'T': {'n': np.array([0.0, 1.0]), 'L': hx},   # Top\n                'B': {'n': np.array([0.0, -1.0]), 'L': hx}   # Bottom\n            }\n\n            # Get mesh velocities for each face\n            if inconsistent:\n                # Indices for formula are 1-based\n                ip1 = i + 1\n                jp1 = j + 1\n                w_faces = {\n                    'R': c + np.array([gamma_x * ip1, -gamma_y * jp1]),\n                    'L': c + np.array([-0.5 * gamma_x * ip1, 0.25 * gamma_y * jp1]),\n                    'T': c + np.array([0.1 * gamma_x * ip1, 1.5 * gamma_y * jp1]),\n                    'B': c + np.array([-0.2 * gamma_x * ip1, -0.8 * gamma_y * jp1])\n                }\n            else: # Corrected scheme\n                w_faces = {\n                    'R': c, 'L': c, 'T': c, 'B': c\n                }\n\n            # Calculate sum of fluxes and GCL term for the cell\n            total_flux_term = 0.0\n            gcl_sum = 0.0\n\n            for face_key in faces_geom:\n                n_f = faces_geom[face_key]['n']\n                L_f = faces_geom[face_key]['L']\n                w_f = w_faces[face_key]\n\n                # Flux for q\n                # q_f * (u - w_f) . n_f * L_f\n                # For uniform state, q_f = q0\n                flux = q0 * np.dot(u - w_f, n_f) * L_f\n                total_flux_term += flux\n\n                # Geometric Conservation Law term\n                # w_f . n_f * L_f\n                gcl_term = np.dot(w_f, n_f) * L_f\n                gcl_sum += gcl_term\n\n            # Update q for the cell\n            # V_K * q_K^{n+1} = V_K * q_K^n - dt * sum(fluxes)\n            # Since q_K^n = q0, and V_K is constant\n            q_K_np1 = q0 - (dt / V_K) * total_flux_term\n\n            # Calculate cell-wise errors\n            cell_invariance_error = abs(q_K_np1 - q0)\n            cell_gcl_residual = abs(gcl_sum)\n\n            # Update maximums\n            if cell_invariance_error > max_invariance_error:\n                max_invariance_error = cell_invariance_error\n            \n            if cell_gcl_residual > max_gcl_residual:\n                max_gcl_residual = cell_gcl_residual\n\n    return [max_invariance_error, max_gcl_residual]\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the foundational importance of the Geometric Conservation Law (GCL), this exercise examines the practical consequences of its violation in a dynamic physical system. You will simulate a one-dimensional piston-cylinder problem, where the core task is to compare a GCL-consistent time integrator against a common but incorrect implementation that \"freezes\" geometric terms within a time step. This practice will allow you to quantify the error in a key physical quantity—the internal energy—and thus appreciate why rigorous GCL enforcement is critical for accurate energy conservation in ALE simulations .",
            "id": "3292269",
            "problem": "You must implement a one-dimensional Arbitrary Lagrangian–Eulerian (ALE) time integrator for a compressible ideal gas in a piston–cylinder configuration with a moving right piston. The left wall is fixed at position $x=0$, and the right piston location is prescribed as $x_p(t)=L(t)$. The gas occupies a control volume of time-dependent length $L(t)$ and cross-sectional area equal to $1$, so the physical volume is $V(t)=L(t)$. The state is assumed spatially uniform at all times and governed by the integral form of the compressible Euler equations over the control volume.\n\nFundamental base:\n- Conservation of mass: for impermeable walls, the mass in the control volume is conserved. If $\\rho(t)$ is the density and $J(t)=L(t)$ is the Jacobian (volume), then $\\rho(t) J(t)=\\rho_0 J_0$, where $\\rho_0=\\rho(0)$ and $J_0=J(0)$.\n- Conservation of momentum: with equal pressure on both walls and no net force, the spatially averaged velocity remains zero, $u(t)=0$, for symmetric walls with no net impulse, consistent with the uniform-state assumption used here.\n- Conservation of total energy in ALE form: the integral energy balance for the control volume $[0,L(t)]$ gives\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\big(\\rho E\\,J\\big) \\;=\\; -\\big[u(\\rho E + p) - w\\,\\rho E\\big]\\big\\rvert_{x=L(t)} \\;+\\; \\big[u(\\rho E + p) - w\\,\\rho E\\big]\\big\\rvert_{x=0},\n$$\nwhere $E$ is the specific total energy, $p$ is pressure, and $w$ is the grid (wall) velocity. With $u=0$ everywhere, $w(0)=0$ at the fixed wall, and $u(L)=w(L)=\\dot L(t)$ at the moving wall, this reduces to\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\big(\\rho E\\,J\\big) \\;=\\; -\\,\\dot L(t)\\,p(t).\n$$\nFor an ideal gas with ratio of specific heats $\\gamma$, $E = e + \\tfrac{1}{2}u^2$ and $e = \\dfrac{p}{(\\gamma-1)\\rho}$. With $u=0$, the internal energy per mass $e$ satisfies\n$$\n\\frac{\\mathrm{d}e}{\\mathrm{d}t} \\;=\\; -(\\gamma-1)\\,\\frac{\\dot L(t)}{L(t)}\\,e.\n$$\nThis ordinary differential equation has the exact solution\n$$\ne(t) \\;=\\; e_0 \\left(\\frac{L(t)}{L_0}\\right)^{-(\\gamma-1)},\n$$\nwith $e_0 = \\dfrac{p_0}{(\\gamma-1)\\rho_0}$, $L_0=L(0)$, and $p_0=p(0)$.\n\nGeometric Conservation Law (GCL) and time integration:\n- In an ALE Runge–Kutta (RK) method, enforcing the Geometric Conservation Law (GCL) at intermediate RK stages means that geometric quantities such as $J(t)$ and $w(t)=\\dot L(t)$ must be evaluated consistently at each stage time. For the ODE above, this corresponds to evaluating the coefficient $-(\\gamma-1)\\,\\dot L(t)/L(t)$ at each stage time.\n- A common violation is to not enforce GCL at intermediate stages by freezing geometry at the beginning of the time step, i.e., using $\\dot L(t_n)/L(t_n)$ for all sub-stages of a step from time $t_n$ to $t_{n+1}=t_n+\\Delta t$. This produces a bias in the time integral of the pressure work and hence an error in the final internal energy.\n\nYour tasks:\n1. Implement a time integrator for the ODE\n$$\n\\frac{\\mathrm{d}e}{\\mathrm{d}t} \\;=\\; -(\\gamma-1)\\,\\frac{\\dot L(t)}{L(t)}\\,e,\n$$\nusing the third-order Strong Stability Preserving Runge–Kutta (SSP-RK3) method applied over $t\\in[0,T]$ with constant time step $\\Delta t$.\n2. Implement two variants of the right-hand side evaluation:\n   - GCL-enforced at stages: in each Runge–Kutta sub-stage at time $t_\\ast$, evaluate $\\dot L(t_\\ast)$ and $L(t_\\ast)$, and use the instantaneous ratio $\\dot L(t_\\ast)/L(t_\\ast)$.\n   - No GCL at intermediate stages: for all sub-stages within a step from $t_n$ to $t_{n+1}$, freeze geometry at $t_n$ by using $\\dot L(t_n)/L(t_n)$, regardless of the stage time.\n3. For each test case in the test suite below, compute the absolute error in the final internal energy per mass $e(T)$, in units of $\\mathrm{J/kg}$, relative to the exact solution\n$$\ne_{\\text{exact}}(T) \\;=\\; e_0 \\left(\\frac{L(T)}{L_0}\\right)^{-(\\gamma-1)}.\n$$\nReport two errors per test case: first the error with GCL enforced at stages, then the error when GCL is not enforced at intermediate stages.\n\nPhysical parameters and units:\n- Use $\\gamma=1.4$, $\\rho_0=1.0\\,\\mathrm{kg/m^3}$, $p_0=100000\\,\\mathrm{Pa}$, so $e_0=\\dfrac{p_0}{(\\gamma-1)\\rho_0}$ in $\\mathrm{J/kg}$.\n- All lengths are in $\\mathrm{m}$, time in $\\mathrm{s}$, and velocities in $\\mathrm{m/s}$.\n- The required outputs are errors in internal energy per mass in $\\mathrm{J/kg}$.\n\nTest suite:\n- Test $1$ (smooth single-period sinusoidal motion, returns to initial length): $L_0=1.0\\,\\mathrm{m}$, $L(t)=L_0 + A\\sin\\big(2\\pi t/T\\big)$ with $A=0.1\\,\\mathrm{m}$, $T=1.0\\,\\mathrm{s}$, $\\Delta t = 0.01\\,\\mathrm{s}$. Exact $L(T)=L_0$ implies $e_{\\text{exact}}(T)=e_0$.\n- Test $2$ (monotone linear compression): $L_0=1.0\\,\\mathrm{m}$, $L(t)=L_0 - \\alpha t$ on $t\\in[0,T]$ with $\\alpha=0.4\\,\\mathrm{m/s}$, $T=0.5\\,\\mathrm{s}$ so that $L(T)=0.8\\,\\mathrm{m}$, $\\Delta t = 0.005\\,\\mathrm{s}$.\n- Test $3$ (faster sinusoid with multiple periods, returns to initial length): $L_0=1.0\\,\\mathrm{m}$, $L(t)=L_0 + A\\sin\\big(4\\pi t\\big)$ with $A=0.05\\,\\mathrm{m}$, $T=1.0\\,\\mathrm{s}$, $\\Delta t = 0.01\\,\\mathrm{s}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the entries are floats in $\\mathrm{J/kg}$ in the order\n$$\n[\\;\\text{err}_{\\text{GCL},1},\\;\\text{err}_{\\text{noGCL},1},\\;\\text{err}_{\\text{GCL},2},\\;\\text{err}_{\\text{noGCL},2},\\;\\text{err}_{\\text{GCL},3},\\;\\text{err}_{\\text{noGCL},3}\\;].\n$$\nEach $\\text{err}$ is the absolute difference $|e_{\\text{num}}(T)-e_{\\text{exact}}(T)|$ in $\\mathrm{J/kg}$.",
            "solution": "The problem requires the implementation of a one-dimensional Arbitrary Lagrangian–Eulerian (ALE) time integrator for a simplified model of a compressible ideal gas in a piston–cylinder arrangement. The problem is physically and mathematically well-defined, providing a clear path to a numerical solution. We will first outline the theoretical basis and then the numerical implementation strategy.\n\nThe physical system consists of a gas in a control volume $V(t)$ of length $L(t)$ and unit cross-sectional area. The state of the gas (density $\\rho$, pressure $p$, specific internal energy $e$) is assumed to be spatially uniform at all times. The conservation laws of mass, momentum, and energy for this system, under the specified boundary conditions ($u(0)=0$, $w(0)=0$ at the fixed left wall, and $u(L)=w(L)=\\dot{L}(t)$ at the moving right piston), simplify significantly.\n\nThe conservation of mass, $\\rho(t) L(t) = \\rho_0 L_0$, where $\\rho_0 = \\rho(0)$ and $L_0 = L(0)$, indicates that the total mass in the volume is constant. The uniform state assumption with symmetric boundary forcing leads to a zero average fluid velocity, $u(t)=0$.\n\nThe core of the problem lies in the conservation of total energy. The integral energy balance for the ALE control volume reduces to an ordinary differential equation (ODE) for the specific internal energy $e(t)$. The starting point is the ALE energy equation:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\big(\\rho E J\\big) = -[u(\\rho E + p) - w \\rho E]\\big|_{x=L(t)} + [u(\\rho E + p) - w \\rho E]\\big|_{x=0}\n$$\nwhere $E$ is the specific total energy, $p$ is pressure, $J=L(t)$ is the volume (Jacobian in 1D), and $w$ is the grid velocity. Given $u(t)=0$, $E=e$, $w(0)=0$, and $w(L(t)) = \\dot{L}(t)$, this simplifies to:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\big(\\rho e L\\big) = - p(t) \\dot{L}(t)\n$$\nSince the total mass $M = \\rho L$ is constant, we have $M \\frac{\\mathrm{d}e}{\\mathrm{d}t} = -p(t) \\dot{L}(t)$. Using the ideal gas equation of state $p = (\\gamma-1)\\rho e$ and substituting $\\rho = M/L(t)$, we arrive at the governing ODE:\n$$\nM \\frac{\\mathrm{d}e}{\\mathrm{d}t} = -(\\gamma-1)\\frac{M}{L(t)}e(t) \\dot{L}(t) \\implies \\frac{\\mathrm{d}e}{\\mathrm{d}t} = -(\\gamma-1)\\frac{\\dot{L}(t)}{L(t)}e(t)\n$$\nThis is a first-order linear homogeneous ODE. For a given initial condition $e(0)=e_0$, the exact solution is found by separation of variables:\n$$\n\\int_{e_0}^{e(t)} \\frac{\\mathrm{d}e'}{e'} = -(\\gamma-1) \\int_{0}^{t} \\frac{\\dot{L}(\\tau)}{L(\\tau)} \\mathrm{d}\\tau \\implies \\ln\\left(\\frac{e(t)}{e_0}\\right) = -(\\gamma-1)\\ln\\left(\\frac{L(t)}{L_0}\\right)\n$$\nThis yields the exact solution for the specific internal energy at any time $t$:\n$$\ne(t) = e_0 \\left(\\frac{L(t)}{L_0}\\right)^{-(\\gamma-1)}\n$$\nThe initial specific internal energy $e_0$ is calculated from the initial conditions as $e_0 = \\frac{p_0}{(\\gamma-1)\\rho_0}$.\n\nThe primary task is to solve the ODE numerically using the third-order Strong Stability Preserving Runge–Kutta (SSP-RK3) method. The ODE is of the form $\\frac{\\mathrm{d}e}{\\mathrm{d}t} = f(t, e)$, where the right-hand side function is $f(t, e) = C(t) e(t)$ with a time-dependent coefficient $C(t) = -(\\gamma-1)\\frac{\\dot{L}(t)}{L(t)}$.\nThe SSP-RK3 scheme for a step from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ is given by:\n\\begin{align*}\ne^{(1)} &= e_n + \\Delta t \\, f(t_n, e_n) \\\\\ne^{(2)} &= \\frac{3}{4} e_n + \\frac{1}{4} \\left( e^{(1)} + \\Delta t \\, f(t_n + \\Delta t, e^{(1)}) \\right) \\\\\ne_{n+1} &= \\frac{1}{3} e_n + \\frac{2}{3} \\left( e^{(2)} + \\Delta t \\, f(t_n + \\frac{1}{2}\\Delta t, e^{(2)}) \\right)\n\\end{align*}\nWe must implement two variants for evaluating the function $f(t,e)$:\n\n1.  **GCL-Enforced at Stages**: This is the physically and numerically consistent approach. The geometric terms $L(t)$ and $\\dot{L}(t)$ that form the coefficient $C(t)$ are evaluated at the specific time required by each stage of the Runge-Kutta method.\n    -   For $e^{(1)}$, $C(t)$ is evaluated at $t_n$.\n    -   For $e^{(2)}$, $C(t)$ is evaluated at $t_n + \\Delta t$.\n    -   For $e_{n+1}$, $C(t)$ is evaluated at $t_n + \\frac{1}{2}\\Delta t$.\n\n2.  **No GCL at Intermediate Stages**: This is a common implementation error where the geometry is \"frozen\" at the beginning of the time step. The coefficient $C(t_n) = -(\\gamma-1)\\frac{\\dot{L}(t_n)}{L(t_n)}$ is computed once at time $t_n$ and used for all three stages within the step. This violates the Geometric Conservation Law (GCL) at the sub-stage level and is expected to introduce a first-order error in the time integration of the pressure-work term, leading to lower accuracy.\n\nFor each test case, we will perform the time integration from $t=0$ to $t=T$ using both variants. The final numerical result, $e_{\\text{num}}(T)$, will be compared against the exact solution, $e_{\\text{exact}}(T)$, to compute the absolute error $|e_{\\text{num}}(T) - e_{\\text{exact}}(T)|$.\n\nThe implementation will consist of a main driver function that iterates through the specified test cases. For each case, it will define the functions $L(t)$ and $\\dot{L}(t)$, calculate the initial and exact final energies, and call a dedicated solver function. This solver will implement the SSP-RK3 time-stepping loop, with logic to switch between the GCL-enforced and non-GCL variants. The final output will be a list of these errors, formatted as requested.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It computes the errors in internal energy for GCL-enforced and non-GCL\n    SSP-RK3 integration schemes and prints them in the required format.\n    \"\"\"\n\n    # Physical parameters\n    GAMMA = 1.4\n    RHO_0 = 1.0  # kg/m^3\n    P_0 = 100000.0  # Pa\n    # Initial specific internal energy\n    E_0 = P_0 / ((GAMMA - 1) * RHO_0)  # J/kg\n\n    def run_ssp_rk3_integration(L_func, L_dot_func, L0, T, dt, use_gcl):\n        \"\"\"\n        Performs time integration of the internal energy ODE using SSP-RK3.\n        \n        Args:\n            L_func (callable): Function L(t) for piston position.\n            L_dot_func (callable): Function dL/dt(t) for piston velocity.\n            L0 (float): Initial piston position.\n            T (float): Total integration time.\n            dt (float): Time step.\n            use_gcl (bool): If True, enforces GCL at sub-stages. Otherwise, freezes geometry.\n            \n        Returns:\n            float: The final specific internal energy e(T).\n        \"\"\"\n        num_steps = round(T / dt)\n        e = E_0\n        t = 0.0\n\n        for _ in range(num_steps):\n            if use_gcl:\n                # GCL-enforced at stages: evaluate geometry at each stage time.\n                # Stage 1\n                t1 = t\n                C1 = -(GAMMA - 1) * (L_dot_func(t1) / L_func(t1))\n                e_stage1 = e + dt * (C1 * e)\n\n                # Stage 2\n                t2 = t + dt\n                C2 = -(GAMMA - 1) * (L_dot_func(t2) / L_func(t2))\n                e_stage2 = 0.75 * e + 0.25 * (e_stage1 + dt * (C2 * e_stage1))\n\n                # Stage 3\n                t3 = t + 0.5 * dt\n                C3 = -(GAMMA - 1) * (L_dot_func(t3) / L_func(t3))\n                e_next = (1.0 / 3.0) * e + (2.0 / 3.0) * (e_stage2 + dt * (C3 * e_stage2))\n            else:\n                # No GCL at stages: freeze geometry at the start of the time step.\n                C_frozen = -(GAMMA - 1) * (L_dot_func(t) / L_func(t))\n                \n                # Stage 1\n                e_stage1 = e + dt * (C_frozen * e)\n\n                # Stage 2\n                e_stage2 = 0.75 * e + 0.25 * (e_stage1 + dt * (C_frozen * e_stage1))\n\n                # Stage 3\n                e_next = (1.0 / 3.0) * e + (2.0 / 3.0) * (e_stage2 + dt * (C_frozen * e_stage2))\n\n            e = e_next\n            t += dt\n        \n        return e\n\n    # Test suite definition\n    test_cases = [\n        {\n            \"name\": \"Test 1\",\n            \"L0\": 1.0, \"T\": 1.0, \"dt\": 0.01,\n            \"params\": {\"A\": 0.1},\n            \"L_func\": lambda t, L0, A: L0 + A * np.sin(2 * np.pi * t / 1.0),\n            \"L_dot_func\": lambda t, L0, A: A * (2 * np.pi / 1.0) * np.cos(2 * np.pi * t / 1.0),\n        },\n        {\n            \"name\": \"Test 2\",\n            \"L0\": 1.0, \"T\": 0.5, \"dt\": 0.005,\n            \"params\": {\"alpha\": 0.4},\n            \"L_func\": lambda t, L0, alpha: L0 - alpha * t,\n            \"L_dot_func\": lambda t, L0, alpha: -alpha,\n        },\n        {\n            \"name\": \"Test 3\",\n            \"L0\": 1.0, \"T\": 1.0, \"dt\": 0.01,\n            \"params\": {\"A\": 0.05},\n            \"L_func\": lambda t, L0, A: L0 + A * np.sin(4 * np.pi * t),\n            \"L_dot_func\": lambda t, L0, A: A * (4 * np.pi) * np.cos(4 * np.pi * t),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        L0, T, dt, params = case[\"L0\"], case[\"T\"], case[\"dt\"], case[\"params\"]\n        \n        # Create specific L(t) and L_dot(t) functions for this case\n        L = lambda t: case[\"L_func\"](t, L0, **params)\n        L_dot = lambda t: case[\"L_dot_func\"](t, L0, **params)\n        \n        # Calculate the exact solution at the final time T\n        L_final = L(T)\n        e_exact = E_0 * (L_final / L0) ** (-(GAMMA - 1))\n        \n        # Calculate numerical solution and error for the GCL-enforced case\n        e_num_gcl = run_ssp_rk3_integration(L, L_dot, L0, T, dt, use_gcl=True)\n        err_gcl = abs(e_num_gcl - e_exact)\n        results.append(err_gcl)\n\n        # Calculate numerical solution and error for the non-GCL case\n        e_num_nogcl = run_ssp_rk3_integration(L, L_dot, L0, T, dt, use_gcl=False)\n        err_nogcl = abs(e_num_nogcl - e_exact)\n        results.append(err_nogcl)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This advanced practice moves to the heart of a finite volume ALE scheme: the numerical flux calculation at cell interfaces. You will construct an ALE-aware Harten-Lax-van Leer-Contact (HLLC) approximate Riemann solver, which requires reformulating wave speed estimates and fluxes in terms of the relative velocity between the fluid and the moving mesh. This exercise not only provides experience in modifying a standard solver for ALE but also deepens understanding of the underlying physics by analyzing how shock speeds are transformed between the computational (mesh) and laboratory frames of reference .",
            "id": "3292307",
            "problem": "Consider the one-dimensional compressible Euler equations written in conservation form for a state vector $U = [\\rho, \\rho u, E]^{\\top}$, where $\\rho$ is the mass density in $\\mathrm{kg/m^3}$, $u$ is the velocity in $\\mathrm{m/s}$, and $E$ is the total energy density in $\\mathrm{J/m^3}$. The physical flux is $F(U) = [\\rho u, \\rho u^2 + p, (E + p) u]^{\\top}$, with thermodynamic closure $E = \\dfrac{p}{\\gamma - 1} + \\dfrac{1}{2} \\rho u^2$ for a calorically perfect gas with ratio of specific heats $\\gamma$. In an Arbitrary Lagrangian–Eulerian (ALE) formulation, the interface moves with velocity $w$ (the mesh velocity, in $\\mathrm{m/s}$). The ALE balance law over a moving control volume leads to the ALE flux $F^{\\mathrm{ALE}}(U; w) = F(U) - w U$, and wave propagation in the mesh frame depends on the relative velocity $(u - w)$.\n\nYour task is to construct an approximate ALE Riemann solver of Harten–Lax–van Leer–Contact type (HLLC) for the compressible Euler equations that estimates the left and right wave speeds using the relative velocities in the mesh frame and produces fluxes consistent with the ALE formulation. You must also analyze how the laboratory-frame shock speed changes when $w$ is non-zero but curl-free (i.e., $\\nabla \\times \\mathbf{w} = \\mathbf{0}$). In one spatial dimension, $w$ is a scalar and therefore curl-free by construction. The analysis must be grounded in first principles, starting from conservation laws and Rankine–Hugoniot jump conditions, and must demonstrate the relationship between shock speeds in the mesh frame and the laboratory frame when $w \\neq 0$.\n\nPrecisely, do the following:\n\n1. Starting from the conservation law and the Reynolds transport theorem, derive the ALE conservation law in one dimension and the corresponding ALE flux $F^{\\mathrm{ALE}}(U; w) = F(U) - w U$. Interpret the appearance of $(u - w)$ in wave speed estimates and explain why all interface fluxes in ALE depend on the relative velocity.\n2. Using the Rankine–Hugoniot (RH) jump conditions across a discontinuity moving with speed $s$, show how the shock speed measured in the mesh frame, $s_{\\mathrm{rel}}$, is related to the laboratory-frame shock speed $s_{\\mathrm{lab}}$ when $w$ is curl-free and uniform at the interface, and express $s_{\\mathrm{lab}}$ in terms of $s_{\\mathrm{rel}}$ and $w$. Your derivation must be fully based on RH jump conditions and the ALE flux definition.\n3. Implement an ALE-HLLC Riemann solver that estimates the left and right wave speeds using the Davis estimates in the mesh frame:\n   a. Compute the local sound speeds $a_L = \\sqrt{\\gamma p_L / \\rho_L}$ and $a_R = \\sqrt{\\gamma p_R / \\rho_R}$.\n   b. Define the relative velocities $u_L' = u_L - w$ and $u_R' = u_R - w$.\n   c. Use $S_L = \\min(u_L' - a_L, u_R' - a_R)$ and $S_R = \\max(u_L' + a_L, u_R' + a_R)$.\n   d. Compute the contact wave speed $S_M$ and star pressure $p_*$ consistent with HLLC in the mesh frame. You may use the standard HLLC contact-speed formula derived from momentum balance and star-state consistency:\n   $$S_M = \\frac{p_R - p_L + \\rho_L u_L' (S_L - u_L') - \\rho_R u_R' (S_R - u_R')}{\\rho_L (S_L - u_L') - \\rho_R (S_R - u_R')}$$\n   and\n   $$p_* = p_L + \\rho_L (S_L - u_L') (S_M - u_L') = p_R + \\rho_R (S_R - u_R') (S_M - u_R').$$\n   e. Determine which of the outer waves is a shock by comparing $p_*$ with $p_L$ and $p_R$: if $p_* > p_L$ then the left wave is a shock; if $p_* > p_R$ then the right wave is a shock.\n   f. Report the shock speed in the laboratory frame as $s_{\\mathrm{lab}} = s_{\\mathrm{rel}} + w$, where $s_{\\mathrm{rel}}$ is the appropriate outer-wave speed ($S_L$ or $S_R$) in the mesh frame.\n4. For each test case below, compute the laboratory-frame shock speed and express it in $\\mathrm{m/s}$. If no shock is present on an outer wave due to both sides rarefying, report the outer-wave speed that corresponds to the compressive side (use the HLLC criterion above), otherwise return the outer shock speed. Always assume $\\gamma = 1.4$ for all cases.\n\nUse the following test suite of left/right states $(\\rho, u, p)$ and mesh velocities $w$:\n\n- Case 1 (baseline Sod-like, mesh at rest): $U_L = (\\rho_L, u_L, p_L) = (1.0, 0.0, 1.0 \\times 10^5)$, $U_R = (\\rho_R, u_R, p_R) = (0.125, 0.0, 1.0 \\times 10^4)$, $w = 0.0$.\n- Case 2 (same initial states, mesh moving right): $U_L = (1.0, 0.0, 1.0 \\times 10^5)$, $U_R = (0.125, 0.0, 1.0 \\times 10^4)$, $w = 50.0$.\n- Case 3 (same initial states, mesh moving left): $U_L = (1.0, 0.0, 1.0 \\times 10^5)$, $U_R = (0.125, 0.0, 1.0 \\times 10^4)$, $w = -30.0$.\n- Case 4 (reversed pressure gradient, left shock expected): $U_L = (0.125, 0.0, 1.0 \\times 10^4)$, $U_R = (1.0, 0.0, 1.0 \\times 10^5)$, $w = 20.0$.\n- Case 5 (nonzero velocities with mesh velocity matching left state): $U_L = (1.0, 200.0, 1.2 \\times 10^5)$, $U_R = (0.4, 50.0, 5.0 \\times 10^4)$, $w = 200.0$.\n\nYour program must implement the solver and produce a single line of output containing a comma-separated list with the laboratory-frame shock speeds for the five cases, in $\\mathrm{m/s}$, enclosed in square brackets, in the exact order of the cases above. The output must be of the form $[s_1,s_2,s_3,s_4,s_5]$ with each $s_i$ a floating-point number in $\\mathrm{m/s}$ and no additional text. Angles do not appear in this problem; no angle unit specification is required. Percentages do not appear; no percentage format is required. Ensure the program is self-contained and does not require input.",
            "solution": "The problem posed is valid, as it is scientifically grounded in the principles of computational fluid dynamics, well-posed, and objective. It provides a complete and consistent set of data and definitions required for a rigorous solution. We shall proceed by first deriving the theoretical underpinnings of the Arbitrary Lagrangian–Eulerian (ALE) formulation and then implementing the specified numerical solver.\n\n### 1. Derivation and Interpretation of the ALE Conservation Law\n\nThe foundation of any continuum mechanics problem is the conservation law. For a general conserved quantity with density $U$ and physical flux $F(U)$ per unit area, the law in integral form over a one-dimensional control volume $V(t) = [x_a(t), x_b(t)]$ that moves with time is:\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} U(x, t) \\,dx = F(U(x_a, t)) - F(U(x_b, t))\n$$\nThe left-hand side represents the total rate of change of the quantity within the volume, and the right-hand side is the net flux across its boundaries. The velocities of the boundaries are given by $\\frac{dx_a}{dt} = w_a$ and $\\frac{dx_b}{dt} = w_b$, where $w$ is the mesh velocity.\n\nApplying the Leibniz integral rule (a form of the Reynolds transport theorem) to the left-hand side gives:\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} U(x, t) \\,dx = \\int_{x_a(t)}^{x_b(t)} \\frac{\\partial U}{\\partial t} \\,dx + U(x_b, t) \\frac{dx_b}{dt} - U(x_a, t) \\frac{dx_a}{dt}\n$$\nSubstituting the boundary velocities, we have:\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} U(x, t) \\,dx = \\int_{x_a(t)}^{x_b(t)} \\frac{\\partial U}{\\partial t} \\,dx + U(x_b, t) w_b - U(x_a, t) w_a\n$$\nEquating this with the conservation law:\n$$\n\\int_{x_a(t)}^{x_b(t)} \\frac{\\partial U}{\\partial t} \\,dx + U_b w_b - U_a w_a = F_a - F_b\n$$\nwhere $U_a = U(x_a, t)$, $F_a=F(U_a)$, and so on. Rearranging the terms to group them by boundary location yields:\n$$\n\\int_{x_a(t)}^{x_b(t)} \\frac{\\partial U}{\\partial t} \\,dx = (F_a - w_a U_a) - (F_b - w_b U_b)\n$$\nWe define the Arbitrary Lagrangian–Eulerian (ALE) flux as $F^{\\mathrm{ALE}}(U; w) = F(U) - wU$. The equation becomes:\n$$\n\\int_{x_a(t)}^{x_b(t)} \\frac{\\partial U}{\\partial t} \\,dx = F^{\\mathrm{ALE}}_a - F^{\\mathrm{ALE}}_b = -\\int_{x_a(t)}^{x_b(t)} \\frac{\\partial F^{\\mathrm{ALE}}}{\\partial x} \\,dx\n$$\nThis implies that for any arbitrary control volume $V(t)$,\n$$\n\\int_{x_a(t)}^{x_b(t)} \\left( \\frac{\\partial U}{\\partial t} + \\frac{\\partial F^{\\mathrm{ALE}}}{\\partial x} \\right) \\,dx = 0\n$$\nleading to the differential form of the ALE conservation law:\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( F(U) - wU \\right) = 0\n$$\nThe characteristic wave speeds of this system are the eigenvalues of the ALE flux Jacobian, $A^{\\mathrm{ALE}} = \\frac{\\partial F^{\\mathrm{ALE}}}{\\partial U} = \\frac{\\partial F}{\\partial U} - wI$. For the Euler equations, the eigenvalues of the lab-frame Jacobian $\\frac{\\partial F}{\\partial U}$ are $u$, $u+a$, and $u-a$, where $u$ is the fluid velocity and $a$ is the speed of sound. Consequently, the eigenvalues of $A^{\\mathrm{ALE}}$ are $(u-w)$, $(u-w)+a$, and $(u-w)-a$. These wave speeds are measured in the frame of reference of the mesh. They depend fundamentally on the relative velocity of the fluid with respect to the mesh, $u' = u-w$. This is why all wave propagation phenomena and associated numerical fluxes in an ALE context are naturally expressed in terms of this relative velocity.\n\n### 2. Shock Speed Relationship via Rankine–Hugoniot Conditions\n\nThe Rankine–Hugoniot (RH) jump conditions relate the states across a discontinuity (like a shock) to its propagation speed. For a generic conservation law $\\frac{\\partial U}{\\partial t} + \\frac{\\partial G(U)}{\\partial x} = 0$, the RH condition across a discontinuity moving at speed $s$ is $s[U] = [G(U)]$, where $[q] = q_R - q_L$ denotes the jump in quantity $q$.\n\nIn the laboratory (Eulerian) frame, the conservation law is $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0$. The RH condition for a shock moving at speed $s_{\\mathrm{lab}}$ is:\n$$\ns_{\\mathrm{lab}}[U] = [F(U)]\n$$\nIn the ALE framework, the governing equation is $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F^{\\mathrm{ALE}}(U; w)}{\\partial x} = 0$. A Riemann solver at a mesh interface operates in the mesh's frame of reference. The speed of a wave as seen by this solver is its speed relative to the mesh, which we denote as $s_{\\mathrm{rel}}$. The corresponding RH condition is:\n$$\ns_{\\mathrm{rel}}[U] = [F^{\\mathrm{ALE}}(U; w)] = [F(U) - wU]\n$$\nThe problem specifies that the mesh velocity $w$ is curl-free and uniform at the interface, which in one dimension means $w$ is continuous across the discontinuity ($w_L = w_R = w$). This allows us to write $[wU] = w[U]$. The ALE jump condition becomes:\n$$\ns_{\\mathrm{rel}}[U] = [F(U)] - w[U]\n$$\nWe can now substitute the expression for $[F(U)]$ from the laboratory-frame RH condition:\n$$\ns_{\\mathrm{rel}}[U] = s_{\\mathrm{lab}}[U] - w[U]\n$$\nFor a non-trivial shock, $[U] \\neq 0$, so we can divide by the jump vector $[U]$ to obtain the scalar relationship:\n$$\ns_{\\mathrm{rel}} = s_{\\mathrm{lab}} - w\n$$\nThis equation shows that the shock speed relative to the mesh is the laboratory-frame shock speed minus the mesh velocity. Rearranging for the laboratory-frame shock speed, we get:\n$$\ns_{\\mathrm{lab}} = s_{\\mathrm{rel}} + w\n$$\nThis result demonstrates a Galilean transformation of velocities: the physical shock speed observed in the laboratory is the sum of its speed relative to the moving mesh and the velocity of the mesh itself.\n\n### 3. ALE-HLLC Riemann Solver and Test Case Analysis\n\nWe now implement the specified Harten–Lax–van Leer–Contact (HLLC) approximate Riemann solver within the ALE framework. The algorithm relies on estimating the speeds of the fastest left- and right-propagating waves ($S_L$, $S_R$) in the mesh frame and then reconstructing the fluxes in the intermediate \"star\" regions.\n\nThe steps for each test case are as follows:\na. Given left/right states $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$ and mesh velocity $w$. The ratio of specific heats is $\\gamma = 1.4$.\nb. Compute the sound speeds: $a_K = \\sqrt{\\gamma p_K / \\rho_K}$ for $K \\in \\{L, R\\}$.\nc. Compute relative fluid velocities: $u'_K = u_K - w$.\nd. Estimate wave speeds in the mesh frame using the Davis estimates:\n   $$S_L = \\min(u'_L - a_L, u'_R - a_R)$$\n   $$S_R = \\max(u'_L + a_L, u'_R + a_R)$$\ne. Compute the contact wave speed $S_M$ in the mesh frame using the provided formula derived from momentum conservation across the contact:\n   $$S_M = \\frac{p_R - p_L + \\rho_L u_L' (S_L - u_L') - \\rho_R u_R' (S_R - u_R')}{\\rho_L (S_L - u_L') - \\rho_R (S_R - u_R')}$$\nf. Compute the pressure $p_*$ in the star region. The value of $S_M$ is constructed to ensure consistency between the left and right expressions for $p_*$:\n   $$p_* = p_L + \\rho_L (S_L - u_L') (S_M - u_L')$$\ng. Identify the compressive wave (shock). If $p_* > p_L$, the left wave is a shock with relative speed $s_{\\mathrm{rel}} = S_L$. If $p_* > p_R$, the right wave is a shock with relative speed $s_{\\mathrm{rel}} = S_R$. For the given test cases, one side will be compressive and the other rarefactive.\nh. Calculate the laboratory-frame shock speed using the derived transformation: $s_{\\mathrm{lab}} = s_{\\mathrm{rel}} + w$.\n\nThis procedure is applied to each test case, and the resulting laboratory-frame shock speed is computed. The implementation encapsulates this logic in a reusable function.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the ALE-HLLC problem for all test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: ((rho_L, u_L, p_L), (rho_R, u_R, p_R), w)\n    test_cases = [\n        # Case 1: Sod-like, mesh at rest\n        ((1.0, 0.0, 1.0e5), (0.125, 0.0, 1.0e4), 0.0),\n        # Case 2: Sod-like, mesh moving right\n        ((1.0, 0.0, 1.0e5), (0.125, 0.0, 1.0e4), 50.0),\n        # Case 3: Sod-like, mesh moving left\n        ((1.0, 0.0, 1.0e5), (0.125, 0.0, 1.0e4), -30.0),\n        # Case 4: Reversed pressure, left shock expected\n        ((0.125, 0.0, 1.0e4), (1.0, 0.0, 1.0e5), 20.0),\n        # Case 5: Non-zero velocities\n        ((1.0, 200.0, 1.2e5), (0.4, 50.0, 5.0e4), 200.0),\n    ]\n\n    gamma = 1.4\n    results = []\n    for case in test_cases:\n        state_L, state_R, w = case\n        rho_L, u_L, p_L = state_L\n        rho_R, u_R, p_R = state_R\n\n        s_lab = calculate_lab_shock_speed(rho_L, u_L, p_L, rho_R, u_R, p_R, w, gamma)\n        results.append(s_lab)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_lab_shock_speed(rho_L, u_L, p_L, rho_R, u_R, p_R, w, gamma):\n    \"\"\"\n    Implements the ALE-HLLC Riemann solver to find the laboratory-frame shock speed.\n\n    Args:\n        rho_L, u_L, p_L: Density, velocity, and pressure of the left state.\n        rho_R, u_R, p_R: Density, velocity, and pressure of the right state.\n        w: Mesh velocity.\n        gamma: Ratio of specific heats.\n\n    Returns:\n        The laboratory-frame shock speed (s_lab) in m/s.\n    \"\"\"\n    # a. Compute local sound speeds\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n\n    # b. Define the relative velocities\n    u_L_prime = u_L - w\n    u_R_prime = u_R - w\n\n    # c. Use Davis estimates for wave speeds in the mesh frame\n    S_L = min(u_L_prime - a_L, u_R_prime - a_R)\n    S_R = max(u_L_prime + a_L, u_R_prime + a_R)\n\n    # d. Compute the contact wave speed S_M and star pressure p_star\n    \n    # Numerator for S_M\n    num_S_M = (p_R - p_L + \n               rho_L * u_L_prime * (S_L - u_L_prime) - \n               rho_R * u_R_prime * (S_R - u_R_prime))\n\n    # Denominator for S_M\n    den_S_M = (rho_L * (S_L - u_L_prime) - \n               rho_R * (S_R - u_R_prime))\n    \n    # Avoid division by zero, though unlikely for these physical problems\n    if np.isclose(den_S_M, 0):\n        # Fallback, though not specified, this would indicate an issue.\n        # For the given problems, this case is not encountered.\n        S_M = (u_L_prime + u_R_prime) / 2.0 \n    else:\n        S_M = num_S_M / den_S_M\n\n    # Calculate star pressure p_star (using the left state)\n    p_star = p_L + rho_L * (S_L - u_L_prime) * (S_M - u_L_prime)\n\n    # e. Determine which of the outer waves is a shock\n    s_rel = 0.0\n    # Check for right-traveling shock\n    if p_star > p_R:\n        s_rel = S_R\n    # Check for left-traveling shock\n    elif p_star > p_L:\n        s_rel = S_L\n    else:\n        # This case suggests both waves are rarefactions or a numerical issue.\n        # Problem asks to report the compressive side even if no strong shock.\n        # For given test cases, p_star will be between p_L and p_R, but not\n        # smaller than both. One side will be compressive.\n        # If p_star > p_R, right is compressive. If p_star > p_L, left is.\n        # The logic above correctly handles this.\n        # Setting a default for completeness though it's not strictly needed for these cases.\n        # For the given problem one of the if/elif conditions will be met.\n        pass\n\n    # f. Report the shock speed in the laboratory frame\n    s_lab = s_rel + w\n    \n    return s_lab\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}