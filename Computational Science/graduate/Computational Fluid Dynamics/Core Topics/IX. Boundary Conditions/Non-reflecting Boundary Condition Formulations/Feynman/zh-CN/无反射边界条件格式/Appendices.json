{
    "hands_on_practices": [
        {
            "introduction": "要理解无反射边界条件，我们首先必须量化我们希望消除的现象：虚假的数值反射。这项基础练习  将指导你推导一个简单边界条件的离散反射系数，揭示其性能不佳的原因，并将其与一个旨在吸收波的一阶阻抗匹配条件进行对比。该分析为评估任何边界条件的性能提供了一个具体的度量标准。",
            "id": "3349612",
            "problem": "考虑半无限域 $x \\ge 0$ 上的一维波动方程 $u_{tt} = c^2 u_{xx}$。场 $u$ 在均匀网格上进行离散化，空间步长为 $\\Delta x$，时间步长为 $\\Delta t$，索引表示为 $u_j^n \\approx u(x_j,t_n)$，其中 $x_j = j \\Delta x$，$t_n = n \\Delta t$。内部更新采用在空间和时间上均为二阶精度的中心差分格式，该格式根据标准的显式模板推进 $u_j^n$。Courant–Friedrichs–Lewy (CFL) 数定义为 $\\lambda = \\dfrac{c \\Delta t}{\\Delta x}$。\n\n您将分析入射到 $j = 0$ 边界上的时谐平面波在两种边界闭合条件下的离散反射：\n\n- 简单的 Dirichlet 边界，强制要求对所有整数 $n$ 都有 $u_0^n = 0$。\n- 在 $j = 0$ 处的一阶阻抗匹配（Sommerfeld 型）边界闭合，它使用中心时间差分和单边空间差分，强制要求\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t} - c \\, \\frac{u_1^n - u_0^n}{\\Delta x} = 0.\n$$\n\n角度必须以弧度表示。\n\n从离散的内部更新以及入射和反射离散平面波的叠加出发，您必须：\n\n1. 使用平面波拟设和内部模板，推导连接离散时间频率、离散波数和 CFL 数的离散色散关系。\n2. 通过对叠加的入射波和反射波施加每种边界闭合条件，为 Dirichlet 边界和阻抗匹配边界构建 $j=0$ 处的离散反射系数。反射系数 $R$ 定义为反射波与入射波的复振幅之比。\n3. 使用推导出的表达式计算两种边界闭合的反射系数模 $|R|$，计算针对下方指定的一组测试用例。每个测试用例由 $(\\lambda,\\theta)$ 参数化，其中 $\\theta = k \\Delta x$ 是无量纲离散波数，$k$ 是连续波数。离散时间频率与您推导的色散关系一致。对于数值评估，选择与内部色散一致的离散频率主分支。\n\n待评估的测试用例集是：\n- 情况 1：$\\lambda = 0.8$，$\\theta = 0.4$。\n- 情况 2：$\\lambda = 0.8$，$\\theta = 2.6$。\n- 情况 3：$\\lambda = 1.0$，$\\theta = \\pi$。\n- 情况 4：$\\lambda = 0.2$，$\\theta = 1.0$。\n- 情况 5：$\\lambda = 0.95$，$\\theta = 0.05$。\n\n您的程序必须为每个测试用例计算浮点数对 $[|R_{\\mathrm{D}}|, |R_{\\mathrm{ABC}}|]$，其中 $|R_{\\mathrm{D}}|$ 是 Dirichlet 边界的反射系数模，而 $|R_{\\mathrm{ABC}}|$ 是阻抗匹配边界的反射系数模。最终输出必须是单行，包含一个逗号分隔的这些数对的列表，并用方括号括起来，例如：\n$$\n[[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|],\\,[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|],\\,\\dots]\n$$\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目都严格格式化为一个双元素列表 $[|R_{\\mathrm{D}}|,|R_{\\mathrm{ABC}}|]$，并按测试用例集的顺序排列。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、良定且客观。它包含对数值波传播和反射的标准分析，没有任何使其无效的缺陷。我们继续进行求解。\n\n分析分为三个部分：\n1.  内部有限差分格式的离散色散关系的推导。\n2.  Dirichlet 边界条件和一阶阻抗匹配边界条件的离散反射系数的推导。\n3.  给定测试用例的数值评估程序的规范。\n\n**1. 离散色散关系**\n\n一维波动方程由 $u_{tt} = c^2 u_{xx}$ 给出。区域内部使用在时间和空间上均为二阶精度的中心差分格式进行离散化：\n$$\n\\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\n$$\n引入 Courant-Friedrichs-Lewy (CFL) 数 $\\lambda = \\frac{c \\Delta t}{\\Delta x}$，该格式可以重排为其显式形式：\n$$\nu_j^{n+1} = 2(1 - \\lambda^2)u_j^n - u_j^{n-1} + \\lambda^2 (u_{j+1}^n + u_{j-1}^n)\n$$\n为了找到色散关系，我们将平面波拟设 $u_j^n = \\hat{u} e^{i(\\omega t_n - k x_j)}$ 代入格式中。设 $\\tilde{\\omega} = \\omega \\Delta t$ 为无量纲离散时间频率，$\\theta = k \\Delta x$ 为无量纲离散波数。拟设变为 $u_j^n = \\hat{u} e^{i(n\\tilde{\\omega} - j\\theta)}$。将其代入数值格式并除以公因子 $\\hat{u} e^{i(n\\tilde{\\omega} - j\\theta)}$ 可得：\n$$\ne^{i\\tilde{\\omega}} = 2(1 - \\lambda^2) - e^{-i\\tilde{\\omega}} + \\lambda^2 (e^{-i\\theta} + e^{i\\theta})\n$$\n重新整理各项以求解 $\\tilde{\\omega}$：\n$$\ne^{i\\tilde{\\omega}} + e^{-i\\tilde{\\omega}} = 2(1 - \\lambda^2) + 2\\lambda^2 \\cos\\theta\n$$\n使用恒等式 $e^{iz} + e^{-iz} = 2\\cos z$，我们得到：\n$$\n2\\cos\\tilde{\\omega} = 2 - 2\\lambda^2(1 - \\cos\\theta)\n$$\n应用半角恒等式 $\\cos z = 1 - 2\\sin^2(z/2)$ 和 $1 - \\cos z = 2\\sin^2(z/2)$：\n$$\n2(1 - 2\\sin^2(\\tilde{\\omega}/2)) = 2 - 2\\lambda^2(2\\sin^2(\\theta/2))\n$$\n$$\n-4\\sin^2(\\tilde{\\omega}/2) = -4\\lambda^2\\sin^2(\\theta/2)\n$$\n这简化为该格式的离散色散关系：\n$$\n\\sin^2(\\tilde{\\omega}/2) = \\lambda^2\\sin^2(\\theta/2)\n$$\n取平方根并选择对应于物理波传播的主分支，我们得到：\n$$\n\\sin(\\tilde{\\omega}/2) = \\lambda \\sin(\\theta/2)\n$$\n由此，离散时间频率 $\\tilde{\\omega}$ 可以表示为离散波数 $\\theta$ 和 CFL 数 $\\lambda$ 的函数：\n$$\n\\tilde{\\omega} = 2 \\arcsin(\\lambda \\sin(\\theta/2))\n$$\n此关系对稳定格式有效，其中 $\\lambda \\le 1$。\n\n**2. 反射系数**\n\n在半无限域 $x \\ge 0$ 上的解是一个入射波和一个反射波的叠加，入射波朝向边界 $x=0$ 传播（左行波），反射波远离边界传播（右行波）。解的离散形式为：\n$$\nu_j^n = u_{I,j}^n + u_{R,j}^n = A_I e^{i(n\\tilde{\\omega} + j\\theta)} + A_R e^{i(n\\tilde{\\omega} - j\\theta)}\n$$\n其中 $A_I$ 和 $A_R$ 分别是入射波和反射波的复振幅。反射系数 $R$ 定义为比值 $R = A_R / A_I$。总解可以写为：\n$$\nu_j^n = A_I e^{in\\tilde{\\omega}}(e^{ij\\theta} + R e^{-ij\\theta})\n$$\n\n**Dirichlet 边界条件 ($R_D$)**\n边界条件为对所有 $n$ 都有 $u_0^n = 0$。将此应用于 $j=0$ 处的总解：\n$$\nu_0^n = A_I e^{in\\tilde{\\omega}}(e^{i(0)\\theta} + R_D e^{-i(0)\\theta}) = 0\n$$\n$$\nA_I e^{in\\tilde{\\omega}}(1 + R_D) = 0\n$$\n对于非平凡入射波 ($A_I \\ne 0$)，这要求 $1 + R_D = 0$，从而得出：\n$$\nR_D = -1\n$$\n反射系数的模为 $|R_D| = 1$，表示完全反射并伴有相位反转，与 $\\lambda$ 或 $\\theta$ 无关。\n\n**阻抗匹配边界条件 ($R_{ABC}$)**\n边界条件由下式给出：\n$$\n\\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t} - c \\, \\frac{u_1^n - u_0^n}{\\Delta x} = 0\n$$\n我们将总解 $u_j^n = A_I e^{in\\tilde{\\omega}}(e^{ij\\theta} + R_{ABC} e^{-ij\\theta})$ 代入此方程。首先，我们计算必要的项：\n- $u_0^n = A_I e^{in\\tilde{\\omega}}(1 + R_{ABC})$\n- $u_0^{n \\pm 1} = u_0^n e^{\\pm i\\tilde{\\omega}}$\n- $u_1^n = A_I e^{in\\tilde{\\omega}}(e^{i\\theta} + R_{ABC} e^{-i\\theta})$\n\n将这些代入边界条件：\n$$\n\\frac{A_I e^{in\\tilde{\\omega}}(1+R_{ABC})(e^{i\\tilde{\\omega}} - e^{-i\\tilde{\\omega}})}{2\\Delta t} - \\frac{c}{\\Delta x} \\left( A_I e^{in\\tilde{\\omega}}(e^{i\\theta} + R_{ABC}e^{-i\\theta}) - A_I e^{in\\tilde{\\omega}}(1 + R_{ABC}) \\right) = 0\n$$\n除以 $A_I e^{in\\tilde{\\omega}}$ 并使用 $e^{iz} - e^{-iz} = 2i\\sin z$：\n$$\n\\frac{(1+R_{ABC})(i\\sin\\tilde{\\omega})}{\\Delta t} - \\frac{c}{\\Delta x} \\left( (e^{i\\theta}-1) + R_{ABC}(e^{-i\\theta}-1) \\right) = 0\n$$\n乘以 $\\Delta x/c = \\Delta t/\\lambda$：\n$$\n\\frac{1}{\\lambda} (1+R_{ABC})(i\\sin\\tilde{\\omega}) - \\left( (e^{i\\theta}-1) + R_{ABC}(e^{-i\\theta}-1) \\right) = 0\n$$\n我们现在求解 $R_{ABC}$：\n$$\nR_{ABC} \\left( \\frac{i\\sin\\tilde{\\omega}}{\\lambda} - (e^{-i\\theta}-1) \\right) = (e^{i\\theta}-1) - \\frac{i\\sin\\tilde{\\omega}}{\\lambda}\n$$\n$$\nR_{ABC} = \\frac{(e^{i\\theta}-1) - i\\sin\\tilde{\\omega}/\\lambda}{i\\sin\\tilde{\\omega}/\\lambda - (e^{-i\\theta}-1)}\n$$\n为了在实现中避免除以 $\\lambda$，我们可以将分子和分母同乘以 $\\lambda$：\n$$\nR_{ABC} = \\frac{\\lambda(e^{i\\theta}-1) - i\\sin\\tilde{\\omega}}{i\\sin\\tilde{\\omega} + \\lambda(1-e^{-i\\theta})}\n$$\n必须为每个测试用例计算模 $|R_{ABC}|$。\n\n**3. 数值评估**\n\n对于每个测试用例 $(\\lambda, \\theta)$：\n1.  Dirichlet 边界的反射系数模为 $|R_D| = 1.0$。\n2.  离散时间频率 $\\tilde{\\omega}$ 根据色散关系计算得出：$\\tilde{\\omega} = 2 \\arcsin(\\lambda \\sin(\\theta/2))$。\n3.  复反射系数 $R_{ABC}$ 使用推导出的公式计算。\n4.  然后将模 $|R_{ABC}|$ 计算为复数 $R_{ABC}$ 的绝对值。\n5.  结果以数对 $[|R_D|, |R_{ABC}|]$ 的形式报告。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the reflection coefficient for Dirichlet and\n    first-order impedance-matched boundary conditions for a 1D wave equation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple (lambda, theta).\n    test_cases = [\n        (0.8, 0.4),\n        (0.8, 2.6),\n        (1.0, np.pi),\n        (0.2, 1.0),\n        (0.95, 0.05)\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        lmbda, theta = case\n        \n        # 1. Reflection coefficient for the Dirichlet boundary\n        # As derived, R_D = -1, so its magnitude is always 1.\n        mag_R_d = 1.0\n        \n        # 2. Reflection coefficient for the impedance-matched boundary (ABC)\n        \n        # Check for stability condition, although all test cases satisfy it.\n        if lmbda > 1.0:\n            raise ValueError(f\"CFL condition not met: lambda = {lmbda} > 1\")\n\n        # Calculate discrete temporal frequency from the dispersion relation\n        # sin(omega_tilde/2) = lambda * sin(theta/2)\n        omega_tilde = 2 * np.arcsin(lmbda * np.sin(theta / 2.0))\n        \n        # Calculate the complex reflection coefficient R_ABC using the derived formula:\n        # R_ABC = (lmbda*(exp(i*theta) - 1) - i*sin(omega_tilde)) / \n        #         (i*sin(omega_tilde) + lmbda*(1 - exp(-i*theta)))\n        \n        # Numerator of R_ABC\n        num = lmbda * (np.exp(1j * theta) - 1.0) - 1j * np.sin(omega_tilde)\n        \n        # Denominator of R_ABC\n        den = 1j * np.sin(omega_tilde) + lmbda * (1.0 - np.exp(-1j * theta))\n        \n        # In the limit theta -> 0, den -> 0. Handle this case if necessary.\n        # For the given test cases, theta is never zero.\n        if np.isclose(den, 0):\n             # This case corresponds to perfect absorption in the continuous limit.\n             # Numerically, R_abc should be 0.\n             R_abc = 0.0\n        else:\n             R_abc = num / den\n\n        # Calculate the magnitude of the reflection coefficient\n        mag_R_abc = np.abs(R_abc)\n        \n        results.append([mag_R_d, mag_R_abc])\n\n    # Final print statement in the exact required format.\n    # str(list) automatically creates the \"[a, b]\" format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然一阶条件可以减少反射，但更高级的公式能为更宽范围的波提供更优越的吸收效果。Higdon 边界条件就是这种高阶、可调方法的典型例子。在此练习  中，你将实现一个二阶 Higdon 算子并分析其有效性，特别关注当入射波的属性与算子的设计参数不完全匹配时产生的色散诱导反射，这突显了设计高性能无反射边界条件时固有的权衡与调优过程。",
            "id": "3349619",
            "problem": "考虑一维线性波动方程及其在计算流体动力学 (CFD) 背景下的离散近似。您将推导、实现并评估一个 Higdon 类型的离散无反射边界条件，在时间和空间上均使用二阶精度有限差分，并分析对于相速度未包含在指定集合 $\\{c_m\\}$ 中的波，由色散引起的反射。\n\n从以下基本基础开始：\n- 一维波动方程由 $u_{tt} = c^2 u_{xx}$ 给出，其中 $c  0$ 是一个恒定的波速。\n- 对内部区域，在时间和空间上均使用标准的二阶精度中心差分格式，这将导出一个角频率 $\\omega$ 和波数 $k$ 之间的离散色散关系。假设一个平面波拟设 $u_j^n = \\exp\\left(i k j \\Delta x - i \\omega n \\Delta t\\right)$，并从第一性原理推导该格式所蕴含的离散色散关系。\n- 作用于 $u(x,t)$ 的一个二阶 Higdon 边界算子（两个因子）在右边界上定义为\n$$\\mathcal{H}_2 u = \\left(\\frac{\\partial}{\\partial t} + c_1 \\frac{\\partial}{\\partial x}\\right)\\left(\\frac{\\partial}{\\partial t} + c_2 \\frac{\\partial}{\\partial x}\\right) u = 0,$$\n其中 $c_1$ 和 $c_2$ 是用户选择的相速度，旨在吸收那些相速度与 $\\{c_m\\}$ 匹配的向右传播的出射波。在连续情形下，对于置于 $x=0$ 的右边界，此算子会消除任何满足 $\\omega = c_m k$（其中 $m \\in \\{1,2\\}$）的向右传播的平面波。\n- 以二阶精度离散化该边界算子：\n  - 在边界处，使用二阶时间中心差分来近似 $\\partial u / \\partial t$：\n    $$D_t u_0^n \\approx \\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t}.$$\n  - 在边界处，使用二阶空间单边前向差分来近似 $\\partial u / \\partial x$：\n    $$D_x^+ u_0^n \\approx \\frac{-3 u_0^n + 4 u_1^n - u_2^n}{2 \\Delta x}.$$\n  这些近似应用于每个 Higdon 因子 $\\left(D_t + c_m D_x^+\\right)$，其中 $m \\in \\{1,2\\}$。\n\n分析目标：\n- 考虑内部区域中一个向右传播的平面波，其在网格上由无量纲波数 $\\xi = k \\Delta x$（以弧度为单位）和库朗数 $r = \\dfrac{c \\Delta t}{\\Delta x}$ 表征。内部解是入射的向右传播分量和反射的向左传播分量的叠加。强制施加您推导出的内部离散色散关系，以关联 $\\omega$ 和 $k$。\n- 在右边界 $x=0$ 处，将离散 Higdon 算子施加于入射和反射平面波的叠加之上。通过在每个分量上评估算子符号，推导离散反射系数 $R = B/A$，其中 $A$ 和 $B$ 分别是入射和反射分量的振幅。您应该得到一个以 $D_t$ 和 $D_x^+$ 在入射和反射分量上求值的离散符号以及集合 $\\{c_m\\}$ 表示的闭式表达式。您的程序将使用此表达式计算幅值 $\\lvert R \\rvert$。\n- 所有量均为无量纲，角度必须以弧度处理。\n\n实现要求：\n- 实现一个函数，在给定 $\\left(c, \\Delta x, \\Delta t, \\{c_m\\}, \\xi\\right)$ 的情况下，使用以下方法计算离散反射系数的幅值 $\\lvert R \\rvert$：\n  - 从波动方程的二阶中心格式得出的内部离散色散关系。\n  - 应用为 $\\prod_{m=1}^M \\left(D_t + c_m D_x^+\\right)$（其中 $M \\in \\{1,2\\}$）的二阶精度离散边界算子，该算子使用如上指定的 $D_t$ 和 $D_x^+$。\n  - 在相位因子为 $\\exp\\left(i \\xi j - i \\omega \\Delta t \\, n\\right)$ 的入射分量和相位因子为 $\\exp\\left(-i \\xi j - i \\omega \\Delta t \\, n\\right)$ 的反射分量上求值的 $D_t$ 和 $D_x^+$ 的平面波符号。\n\n测试套件：\n计算并报告以下五个测试用例的 $\\lvert R \\rvert$ 列表。在每个用例中，$c$、$\\Delta x$ 和 $\\Delta t$ 定义了 $r = \\dfrac{c \\Delta t}{\\Delta x}$。集合 $\\{c_m\\}$被明确列出，$\\xi$ 是无量纲波数（以弧度为单位）。\n- 用例 1：$c = 1.0$, $\\Delta x = 1.0$, $\\Delta t = 0.5$, $M = 2$, $\\{c_m\\} = \\{1.0, 1.0\\}$, $\\xi = 1.0$。\n- 用例 2：$c = 1.0$, $\\Delta x = 1.0$, $\\Delta t = 0.5$, $M = 2$, $\\{c_m\\} = \\{0.8, 1.2\\}$, $\\xi = 1.0$。\n- 用例 3：$c = 1.0$, $\\Delta x = 1.0$, $\\Delta t = 0.5$, $M = 2$, $\\{c_m\\} = \\{0.8, 1.2\\}$, $\\xi = 0.1$。\n- 用例 4：$c = 1.0$, $\\Delta x = 1.0$, $\\Delta t = 0.9$, $M = 2$, $\\{c_m\\} = \\{1.0, 1.0\\}$, $\\xi = \\pi - 0.01$。\n- 用例 5：$c = 1.0$, $\\Delta x = 1.0$, $\\Delta t = 0.9$, $M = 1$, $\\{c_m\\} = \\{0.9\\}$, $\\xi = 2.0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，按用例 1 到 5 的顺序列出五个 $\\lvert R \\rvert$ 值，用方括号括起来，每个值四舍五入到小数点后恰好六位，例如 $\\left[\\text{v}_1,\\text{v}_2,\\text{v}_3,\\text{v}_4,\\text{v}_5\\right]$。\n\n不涉及物理单位。所有角度必须以弧度处理。所有输出必须是实值浮点数。",
            "solution": "该问题是有效的，因为它具有科学依据、自成体系且提法得当。它是在数值波传播的无反射边界条件分析中一个标准而详细的练习。\n\n目标是推导并计算离散反射系数的幅值 $\\lvert R \\rvert$，该反射系数针对的是入射到施加了二阶 Higdon 无反射边界条件的边界上的平面波。该分析涉及考虑由用于内部区域和边界的有限差分格式引入的离散色散。\n\n**1. 内部格式与离散色散关系**\n\n一维线性波动方程由 $u_{tt} = c^2 u_{xx}$ 给出。它使用标准的二阶精度中心差分格式在时间和空间上进行离散化：\n$$ \\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{\\Delta t^2} = c^2 \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{\\Delta x^2} $$\n其中 $u_j^n = u(j\\Delta x, n\\Delta t)$。为了找到离散色散关系，我们代入平面波拟设 $u_j^n = \\exp\\left(i k j \\Delta x - i \\omega n \\Delta t\\right)$。令 $\\xi = k \\Delta x$ 为无量纲波数，$\\Omega = \\omega \\Delta t$ 为无量纲频率。拟设变为 $u_j^n = \\exp\\left(i(j\\xi - n\\Omega)\\right)$。将其代入有限差分方程得到：\n$$ \\frac{e^{-i\\Omega} - 2 + e^{i\\Omega}}{\\Delta t^2} = c^2 \\frac{e^{i\\xi} - 2 + e^{-i\\xi}}{\\Delta x^2} $$\n使用恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$ 和 $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$，方程简化为：\n$$ \\frac{-4\\sin^2(\\Omega/2)}{\\Delta t^2} = c^2 \\frac{-4\\sin^2(\\xi/2)}{\\Delta x^2} $$\n这导出了连接 $\\Omega$ 和 $\\xi$ 的离散色散关系：\n$$ \\frac{\\sin(\\Omega/2)}{\\Delta t} = \\frac{c}{\\Delta x} \\sin(\\xi/2) $$\n引入库朗数 $r = \\frac{c \\Delta t}{\\Delta x}$，该关系变为：\n$$ \\sin\\left(\\frac{\\Omega}{2}\\right) = r \\sin\\left(\\frac{\\xi}{2}\\right) $$\n对于给定的波数为 $\\xi$ 的入射波和由 $r$ 定义的格式，相应的无量纲频率 $\\Omega$ 由此关系确定：\n$$ \\Omega = 2 \\arcsin\\left(r \\sin\\left(\\frac{\\xi}{2}\\right)\\right) $$\n此关系对入射波和反射波均成立，假设它们具有相同的频率 $\\omega$ 和大小相等但符号相反的波数 $\\pm k$。\n\n**2. 边界算子离散化与符号**\n\nHigdon 边界算子为 $\\prod_{m=1}^M \\left(\\frac{\\partial}{\\partial t} + c_m \\frac{\\partial}{\\partial x}\\right) u = 0$。这在边界（例如 $j=0$）处使用指定的有限差分算子进行离散化：\n-   时间导数：$D_t u_0^n = \\frac{u_0^{n+1} - u_0^{n-1}}{2 \\Delta t}$\n-   空间导数：$D_x^+ u_0^n = \\frac{-3 u_0^n + 4 u_1^n - u_2^n}{2 \\Delta x}$\n\n离散边界条件为 $\\prod_{m=1}^M \\left(D_t + c_m D_x^+\\right) u_0^n = 0$。为了分析其对平面波的影响，我们求出这些离散算子的符号。一个算子的符号是当该算子作用于平面波 $e^{i(j\\tilde{\\xi} - n\\Omega)}$ 时得到的复数因子，其中 $\\tilde{\\xi}$ 是无量纲波数。\n\n$D_t$ 的符号与 $\\tilde{\\xi}$ 无关：\n$$ \\hat{D}_t(\\Omega) = \\frac{e^{-i\\Omega} - e^{i\\Omega}}{2 \\Delta t} = \\frac{-2i\\sin(\\Omega)}{2 \\Delta t} = \\frac{-i\\sin(\\Omega)}{\\Delta t} $$\n\n$D_x^+$ 的符号取决于 $\\tilde{\\xi}$。在 $j=0$ 处应用它：\n$$ \\hat{D}_x^+(\\tilde{\\xi}) = \\frac{-3 + 4e^{i\\tilde{\\xi}} - e^{i2\\tilde{\\xi}}}{2 \\Delta x} $$\n\n**3. 反射系数的推导**\n\n在边界处，解是一个入射的向右传播波和一个反射的向左传播波的叠加：\n$$ u_j^n = A e^{i(j\\xi - n\\Omega)} + B e^{i(-j\\xi - n\\Omega)} $$\n其中 $A$ 是入射波的振幅，$B$ 是反射波的振幅。反射系数定义为 $R = B/A$。\n\n将离散边界算子应用于此叠加在 $j=0$ 处：\n$$ \\prod_{m=1}^M \\left(D_t + c_m D_x^+\\right) \\left[A e^{-in\\Omega} + B e^{-in\\Omega}\\right] = 0 $$\n由于算子是线性的，我们将其应用于每个分量，并用它们的符号替换它们。对于入射分量，波数为 $\\xi$。对于反射分量，波数为 $-\\xi$。\n$$ A \\left[ \\prod_{m=1}^M \\left(\\hat{D}_t(\\Omega) + c_m \\hat{D}_x^+(\\xi)\\right) \\right] + B \\left[ \\prod_{m=1}^M \\left(\\hat{D}_t(\\Omega) + c_m \\hat{D}_x^+(-\\xi)\\right) \\right] = 0 $$\n令 $P_m(\\tilde{\\xi}) = \\hat{D}_t(\\Omega) + c_m \\hat{D}_x^+(\\tilde{\\xi})$。方程变为：\n$$ A \\prod_{m=1}^M P_m(\\xi) + B \\prod_{m=1}^M P_m(-\\xi) = 0 $$\n求解反射系数 $R = B/A$：\n$$ R = -\\frac{\\prod_{m=1}^M P_m(\\xi)}{\\prod_{m=1}^M P_m(-\\xi)} $$\n我们需要计算的是反射系数的幅值：\n$$ |R| = \\left| \\frac{\\prod_{m=1}^M P_m(\\xi)}{\\prod_{m=1}^M P_m(-\\xi)} \\right| = \\frac{\\left| \\prod_{m=1}^M \\left(\\hat{D}_t(\\Omega) + c_m \\hat{D}_x^+(\\xi)\\right) \\right|}{\\left| \\prod_{m=1}^M \\left(\\hat{D}_t(\\Omega) + c_m \\hat{D}_x^+(-\\xi)\\right) \\right|} $$\n代入符号的表达式：\n- $\\hat{D}_t(\\Omega) = \\frac{-i\\sin(\\Omega)}{\\Delta t}$\n- $\\hat{D}_x^+(\\xi) = \\frac{-3 + 4e^{i\\xi} - e^{i2\\xi}}{2 \\Delta x}$\n- $\\hat{D}_x^+(-\\xi) = \\frac{-3 + 4e^{-i\\xi} - e^{-i2\\xi}}{2 \\Delta x}$\n\n利用这些公式，我们可以编写一个程序来为给定的测试用例计算 $|R|$。参数 $M$ 是乘积中算子的数量，它对应于集合 $\\{c_m\\}$ 中元素的数量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_R_mag(c, delta_x, delta_t, c_m_list, xi):\n    \"\"\"\n    Computes the magnitude of the discrete reflection coefficient |R|.\n    \n    Args:\n        c (float): Wave speed in the continuous wave equation.\n        delta_x (float): Spatial grid spacing.\n        delta_t (float): Temporal grid spacing.\n        c_m_list (list of float): List of phase speeds for the Higdon operator.\n        xi (float): Dimensionless wavenumber (k * delta_x) of the incident wave.\n\n    Returns:\n        float: The magnitude of the reflection coefficient |R|.\n    \"\"\"\n    # Step 1: Calculate the Courant number\n    r = c * delta_t / delta_x\n    \n    # Step 2: Calculate the dimensionless frequency Omega from the discrete dispersion relation.\n    # The argument to arcsin is guaranteed to be in [-1, 1] for a stable scheme (r = 1).\n    arcsin_arg = r * np.sin(xi / 2)\n    Omega = 2 * np.arcsin(arcsin_arg)\n    \n    # Step 3: Calculate the symbol of the discrete time derivative operator D_t.\n    D_t_symbol = -1j * np.sin(Omega) / delta_t\n    \n    # Step 4: Calculate the symbol of the discrete space derivative operator D_x^+\n    # for the incident wave (wavenumber xi).\n    exp_i_xi = np.exp(1j * xi)\n    Dx_plus_symbol_inc = (-3 + 4 * exp_i_xi - exp_i_xi**2) / (2 * delta_x)\n    \n    # Step 5: Calculate the symbol of D_x^+ for the reflected wave (wavenumber -xi).\n    # This can be found by replacing xi with -xi, which is equivalent to taking the\n    # complex conjugate since the operator stencil coefficients are real.\n    Dx_plus_symbol_refl = np.conj(Dx_plus_symbol_inc)\n    \n    # Step 6  7: Calculate the products of the full operator symbols for both\n    # incident and reflected components.\n    P_inc_prod = 1.0 + 0.0j\n    P_refl_prod = 1.0 + 0.0j\n    \n    for c_m in c_m_list:\n        # Operator symbol for incident wave\n        P_inc = D_t_symbol + c_m * Dx_plus_symbol_inc\n        # Operator symbol for reflected wave\n        P_refl = D_t_symbol + c_m * Dx_plus_symbol_refl\n        \n        P_inc_prod *= P_inc\n        P_refl_prod *= P_refl\n        \n    # Step 8, 9  10: Calculate the magnitude of the reflection coefficient R.\n    # R = -P_inc_prod / P_refl_prod\n    # |R| = |P_inc_prod| / |P_refl_prod|\n    \n    # Denominator should not be zero for physically meaningful scenarios.\n    if np.abs(P_refl_prod) == 0:\n        return np.inf\n\n    R_magnitude = np.abs(P_inc_prod) / np.abs(P_refl_prod)\n    \n    return R_magnitude\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (c, delta_x, delta_t, {c_m}, xi)\n        (1.0, 1.0, 0.5, [1.0, 1.0], 1.0),\n        (1.0, 1.0, 0.5, [0.8, 1.2], 1.0),\n        (1.0, 1.0, 0.5, [0.8, 1.2], 0.1),\n        (1.0, 1.0, 0.9, [1.0, 1.0], np.pi - 0.01),\n        (1.0, 1.0, 0.9, [0.9], 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        c, dx, dt, c_m_vals, xi_val = case\n        result = calculate_R_mag(c, dx, dt, c_m_vals, xi_val)\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "无反射边界条件的原理可以从简单的模型方程扩展到如欧拉方程等复杂物理系统，但这种过渡也带来了新的实际挑战。在真实流动中，边界条件所需的局部声速 $c$ 等参数通常需要估计，这可能导致不准确。本练习  探讨了这一问题，要求你推导因估计声速 $\\hat{c}$ 和比热容比 $\\hat{\\gamma}$ 的误差而产生的反射系数。通过进行灵敏度分析，你将量化微小的估计误差如何影响边界的无反射特性，这是稳健CFD模拟中的一个关键考量。",
            "id": "3349564",
            "problem": "考虑由线性化欧拉方程控制的均匀理想气体流的一维小振幅平面波扰动。设均匀基态的特征为：密度 $\\rho_0$、压力 $p_0$、温度 $T_0$ 均为常数，比热比为 $\\gamma$，气体常数为 $R$（因此当地声速 $c$ 满足 $c^2 = \\gamma R T$），且平均速度可忽略不计，故对流效应可在一阶近似下忽略。对于小扰动 $(\\rho', u', p')$，线性化方程允许存在右行和左行声学模态，其色散关系为 $\\omega = \\pm c k$，本构关系对于声学部分为 $u' = \\pm p'/(\\rho_0 c)$ 和 $p' = c^2 \\rho'$。此外，还存在一个熵模态，其特征为 $p'_s = 0$、$u'_s = 0$ 和 $s' \\neq 0$，该模态对流当地的热力学状态。\n\n基于不变量的无反射边界条件 (NRBC) 通常在流出边界上强制要求入射声学特征消失。一种实际的实现方式是在边界上施加代数约束 $u' = p'/(\\rho_0 \\hat{c})$，其中使用了根据估算的比热比 $\\hat{\\gamma}$ 和基态热力学状态推导出的估算声速 $\\hat{c}$。在轻微非等熵流中，当地温度会受到一个小的无量纲熵振幅 $\\sigma$ 的扰动，定义为 $\\sigma \\equiv s'/c_v$，其中 $c_v$ 是定容比热。因此，对于小 $\\sigma$，当地声速满足 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$，而边界算法使用的 $\\hat{c} \\approx \\sqrt{\\hat{\\gamma} R T_0}$ 忽略了 $\\sigma$ 并可能使用了错误的 $\\hat{\\gamma}$。\n\n从线性化欧拉方程和声学模态关系出发，根据第一性原理推导一个右行入射声波在遇到施加 $u' = p'/(\\rho_0 \\hat{c})$ 约束的流出边界时的反射系数模 $|R|$。将 $|R|$ 纯粹用真实的当地声速 $c$ 及其估算值 $\\hat{c}$ 来表示。然后，使用 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$ 和 $\\hat{c} \\approx \\sqrt{\\hat{\\gamma} R T_0}$，推导 $|R|$ 对 $\\hat{c}$ 的灵敏度（记为 $\\partial |R| / \\partial \\hat{c}$）和 $|R|$ 对 $\\hat{\\gamma}$ 的灵敏度（记为 $\\partial |R| / \\partial \\hat{\\gamma}$）在给定参数值下的解析表达式。你必须通过 $\\hat{c}(\\hat{\\gamma})$ 使用链式法则来表示 $\\partial |R| / \\partial \\hat{\\gamma}$。\n\n你的程序必须实现这些公式，并为每个测试用例计算一个三元组，包括：\n- 反射系数的模 $|R|$，\n- 绝对灵敏度 $\\left|\\partial |R| / \\partial \\hat{c}\\right|$，\n- 绝对灵敏度 $\\left|\\partial |R| / \\partial \\hat{\\gamma}\\right|$。\n\n所有速度单位必须为米/秒 (m/s)，$R$ 的单位为焦耳/(千克·开尔文) (J/(kg·K))，$T_0$ 的单位为开尔文 (K)，输出为无量纲浮点数。对于直接提供估算值 $\\hat{c}$ 而不提供 $\\hat{\\gamma}$ 的测试用例，定义 $\\partial |R| / \\partial \\hat{\\gamma}$ 的数值为 $0.0$。\n\n使用以下测试套件，涵盖一般情况、边界条件精确匹配情况以及包括较大参数误差的边界情况：\n1. 直接指定声速（常规路径）：$c = 340.0$ m/s，$\\hat{c} = 333.0$ m/s。忽略 $\\sigma$ 和任何 $\\hat{\\gamma}$；报告三元组 $(|R|, |\\partial |R| / \\partial \\hat{c}|, 0.0)$。\n2. 基于伽马的估算，带有轻微非等熵效应（一般情况）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.39$，$R = 287.0$ J/(kg·K)，$T_0 = 300.0$ K，$\\sigma = 0.02$。\n3. 基于伽马的估算，完美匹配（边界条件精确性）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.4$，$R = 287.0$ J/(kg·K)，$T_0 = 300.0$ K，$\\sigma = 0.0$。\n4. 基于伽马的估算，具有较大不匹配和较大非等熵效应（边界情况）：$\\gamma = 1.4$，$\\hat{\\gamma} = 1.2$，$R = 287.0$ J/(kg·K)，$T_0 = 800.0$ K，$\\sigma = 0.1$。\n\n你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个测试用例的三元组本身也是一个由方括号括起来的逗号分隔列表。例如：“[[result_case1_a,result_case1_b,result_case1_c],[result_case2_a,result_case2_b,result_case2_c],...]”。所有输出必须是浮点数。不得打印任何额外文本。",
            "solution": "用户提供的问题已经过验证，被确定为自洽、有科学依据且定义明确。求解过程如下。\n\n问题的核心是确定一维声波在数值流出边界处的反射，并分析该反射对边界条件中所用参数的灵敏度。流场扰动被分解为入射（右行，下标 $i$）和反射（左行，下标 $r$）分量。总速度扰动 $u'$ 和总压力扰动 $p'$ 由叠加给出：$u' = u'_i + u'_r$ 和 $p' = p'_i + p'_r$。\n\n对于平均速度可忽略不计的流，从线性化欧拉方程可以得到右行和左行平面声波的本构关系：\n$$u'_i = \\frac{p'_i}{\\rho_0 c} \\quad \\text{(入射，右行)}$$\n$$u'_r = -\\frac{p'_r}{\\rho_0 c} \\quad \\text{(反射，左行)}$$\n其中 $\\rho_0$ 是恒定的平均密度，$c$ 是介质中真实的当地声速。\n\n无反射边界条件 (NRBC) 在流出边界上强制执行。根据规定，该条件是一个代数约束，旨在使入射特征（此处为左行波）消失。然而，它使用了一个估算的声速 $\\hat{c}$。该条件是：\n$$u' = \\frac{p'}{\\rho_0 \\hat{c}}$$\n\n为了求得反射系数，我们将叠加场代入边界条件：\n$$u'_i + u'_r = \\frac{p'_i + p'_r}{\\rho_0 \\hat{c}}$$\n接下来，我们用基于压力的本构关系替换速度扰动 $u'_i$ 和 $u'_r$：\n$$\\frac{p'_i}{\\rho_0 c} - \\frac{p'_r}{\\rho_0 c} = \\frac{p'_i + p'_r}{\\rho_0 \\hat{c}}$$\n项 $\\rho_0$ 被约去，得到一个关联压力扰动的方程：\n$$\\frac{p'_i}{c} - \\frac{p'_r}{c} = \\frac{p'_i}{\\hat{c}} + \\frac{p'_r}{\\hat{c}}$$\n反射系数 $R$ 定义为反射波振幅与入射波振幅之比，即 $R = p'_r / p'_i$。重新整理方程以求解该比率：\n$$p'_i \\left( \\frac{1}{c} - \\frac{1}{\\hat{c}} \\right) = p'_r \\left( \\frac{1}{c} + \\frac{1}{\\hat{c}} \\right)$$\n$$R = \\frac{p'_r}{p'_i} = \\frac{\\frac{1}{c} - \\frac{1}{\\hat{c}}}{\\frac{1}{c} + \\frac{1}{\\hat{c}}}$$\n分子和分母同乘以 $c\\hat{c}$ 可简化表达式：\n$$R = \\frac{\\hat{c} - c}{\\hat{c} + c}$$\n问题要求的是反射系数的模 $|R|$。由于 $c$ 和 $\\hat{c}$ 都是速度，因此为正值，所以分母 $\\hat{c}+c$ 总是正的。其模为：\n$$|R| = \\left| \\frac{\\hat{c} - c}{\\hat{c} + c} \\right| = \\frac{|\\hat{c} - c|}{\\hat{c} + c}$$\n\n第二个任务是求 $|R|$ 对估算声速 $\\hat{c}$ 的绝对灵敏度，即 $|\\partial |R| / \\partial \\hat{c}|$。我们必须对 $|R|$ 关于 $\\hat{c}$ 求导。让我们考虑 $\\hat{c} \\neq c$ 的情况。\n如果 $\\hat{c}  c$，则 $|R| = (\\hat{c}-c)/(\\hat{c}+c)$。使用导数的商法则：\n$$\\frac{\\partial |R|}{\\partial \\hat{c}} = \\frac{1(\\hat{c}+c) - (\\hat{c}-c)1}{(\\hat{c}+c)^2} = \\frac{2c}{(\\hat{c}+c)^2}$$\n如果 $\\hat{c}  c$，则 $|R| = (c-\\hat{c})/(c+\\hat{c})$。求导得到：\n$$\\frac{\\partial |R|}{\\partial \\hat{c}} = \\frac{-1(c+\\hat{c}) - (c-\\hat{c})1}{(c+\\hat{c})^2} = \\frac{-2c}{(c+\\hat{c})^2}$$\n这两种情况可以合并为 $\\frac{\\partial |R|}{\\partial \\hat{c}} = \\text{sgn}(\\hat{c}-c) \\frac{2c}{(\\hat{c}+c)^2}$。因此，绝对灵敏度为：\n$$\\left|\\frac{\\partial |R|}{\\partial \\hat{c}}\\right| = \\frac{2c}{(\\hat{c}+c)^2}$$\n对于所有正的 $c$ 和 $\\hat{c}$，此表达式是连续且良定义的。在 $\\hat{c}=c$ 点， $|R|=0$，其导数在形式上未定义。然而，当 $\\hat{c} \\to c$ 时，绝对导数的极限为 $\\frac{2c}{(c+c)^2} = \\frac{1}{2c}$，这表示在完美匹配条件附近反射率的变化率大小。因此，我们对所有情况都使用这个公式。\n\n第三个任务是求 $|R|$ 对估算的比热比 $\\hat{\\gamma}$ 的绝对灵敏度，即 $|\\partial |R| / \\partial \\hat{\\gamma}|$。我们应用链式法则：\n$$\\frac{\\partial |R|}{\\partial \\hat{\\gamma}} = \\frac{\\partial |R|}{\\partial \\hat{c}} \\frac{\\partial \\hat{c}}{\\partial \\hat{\\gamma}}$$\n估算的声速 $\\hat{c}$ 由 $\\hat{c} = \\sqrt{\\hat{\\gamma} R T_0}$ 给出。其对 $\\hat{\\gamma}$ 的导数为：\n$$\\frac{\\partial \\hat{c}}{\\partial \\hat{\\gamma}} = \\frac{\\partial}{\\partial \\hat{\\gamma}} \\left( (\\hat{\\gamma} R T_0)^{1/2} \\right) = \\frac{1}{2} (\\hat{\\gamma} R T_0)^{-1/2} (R T_0) = \\frac{\\sqrt{\\hat{\\gamma} R T_0}}{2\\hat{\\gamma}} = \\frac{\\hat{c}}{2\\hat{\\gamma}}$$\n将此式和 $\\partial|R|/\\partial\\hat{c}$ 的表达式代入链式法则，得到：\n$$\\frac{\\partial |R|}{\\partial \\hat{\\gamma}} = \\left( \\text{sgn}(\\hat{c}-c) \\frac{2c}{(\\hat{c}+c)^2} \\right) \\left( \\frac{\\hat{c}}{2\\hat{\\gamma}} \\right) = \\text{sgn}(\\hat{c}-c) \\frac{c \\hat{c}}{\\hat{\\gamma} (\\hat{c}+c)^2}$$\n因此，绝对灵敏度为：\n$$\\left|\\frac{\\partial |R|}{\\partial \\hat{\\gamma}}\\right| = \\frac{c \\hat{c}}{\\hat{\\gamma} (\\hat{c}+c)^2}$$\n\n当地声速 $c$ 受非等熵扰动影响，由 $c \\approx \\sqrt{\\gamma R T_0}\\,(1 + \\tfrac{1}{2}\\sigma)$ 给出。对于未指定 $\\hat{\\gamma}$ 的测试用例，$\\hat{c}$ 是直接给出的，这意味着 $\\partial\\hat{c}/\\partial\\hat{\\gamma}$ 为 $0$，因此 $|\\partial|R|/\\partial\\hat{\\gamma}|=0.0$。\n\n这些推导出的公式将被用于实现计算，以求解给定测试用例所需的三元组。\n对于涉及 $\\gamma$ 和 $\\sigma$ 的情况，真实的当地声速 $c$ 计算为 $c = \\sqrt{\\gamma R T_0} (1 + 0.5 \\sigma)$，估算的声速 $\\hat{c}$ 计算为 $\\hat{c} = \\sqrt{\\hat{\\gamma} R T_0}$。\n每个测试用例的计算都使用这些公式进行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the non-reflecting boundary condition problem for four test cases.\n    Derives the reflection coefficient and its sensitivities, then computes the numerical values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'type': 'direct', 'c': 340.0, 'c_hat': 333.0},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.39, 'R': 287.0, 'T0': 300.0, 'sigma': 0.02},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.4, 'R': 287.0, 'T0': 300.0, 'sigma': 0.0},\n        {'type': 'gamma', 'gamma': 1.4, 'gamma_hat': 1.2, 'R': 287.0, 'T0': 800.0, 'sigma': 0.1},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        if case['type'] == 'direct':\n            c = case['c']\n            c_hat = case['c_hat']\n            gamma_hat = None  # Indicates gamma_hat is not used for c_hat calculation\n        elif case['type'] == 'gamma':\n            gamma = case['gamma']\n            gamma_hat = case['gamma_hat']\n            R_const = case['R']\n            T0 = case['T0']\n            sigma = case['sigma']\n            \n            # Calculate the true local sound speed, c, including non-isentropic effects\n            c0 = np.sqrt(gamma * R_const * T0)\n            c = c0 * (1.0 + 0.5 * sigma)\n            \n            # Calculate the estimated sound speed, c_hat, used in the boundary condition\n            c_hat = np.sqrt(gamma_hat * R_const * T0)\n        else:\n            continue\n\n        # Formula 1: Reflection Coefficient Magnitude |R|\n        # |R| = |c_hat - c| / (c_hat + c)\n        if c_hat + c == 0:\n             # Avoid division by zero, though physically c, c_hat > 0\n            R_mag = np.inf if c_hat - c != 0 else 0.0\n        else:\n            R_mag = np.abs(c_hat - c) / (c_hat + c)\n\n        # Formula 2: Absolute Sensitivity of |R| with respect to c_hat\n        # |d|R|/d(c_hat)| = 2*c / (c_hat + c)^2\n        if (c_hat + c) == 0:\n            sens_c_hat_abs = np.inf\n        else:\n            sens_c_hat_abs = (2.0 * c) / (c_hat + c)**2\n\n        # Formula 3: Absolute Sensitivity of |R| with respect to gamma_hat\n        # |d|R|/d(gamma_hat)| = (c * c_hat) / (gamma_hat * (c_hat + c)^2)\n        if gamma_hat is not None:\n            if gamma_hat == 0 or (c_hat + c) == 0:\n                sens_gamma_hat_abs = np.inf\n            else:\n                sens_gamma_hat_abs = (c * c_hat) / (gamma_hat * (c_hat + c)**2)\n        else:\n            # Case where c_hat is given directly, so sensitivity to gamma_hat is 0.\n            sens_gamma_hat_abs = 0.0\n            \n        all_results.append([R_mag, sens_c_hat_abs, sens_gamma_hat_abs])\n\n    # Format the final output string as specified in the problem.\n    # e.g., \"[[r1,s1a,s1b],[r2,s2a,s2b],...]\"\n    formatted_results = []\n    for res_triple in all_results:\n        formatted_triple = ','.join(map(str, res_triple))\n        formatted_results.append(f\"[{formatted_triple}]\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}