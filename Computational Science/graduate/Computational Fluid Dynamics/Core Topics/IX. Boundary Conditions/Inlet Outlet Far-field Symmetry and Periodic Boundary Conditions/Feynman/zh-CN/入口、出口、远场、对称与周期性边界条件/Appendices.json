{
    "hands_on_practices": [
        {
            "introduction": "在计算流体动力学（CFD）模拟中，准确地设定入口边界条件对预测结果的可靠性至关重要，尤其是在涉及湍流的流动中。此练习将指导您完成一个核心任务：将易于理解的物理量——湍流强度和积分长度尺度——转化为两方程RANS模型（如$k$-$\\omega$模型）所需的具体湍流输运变量。通过这个实践，您将掌握连接物理直觉与湍流模型数学形式的关键技能，为您的模拟建立一个坚实且物理上一致的起点。",
            "id": "3335042",
            "problem": "考虑一个统计定常、不可压缩的高雷诺数流动，该流动使用由称为湍动能-比耗散率模型 ($k-\\omega$) 的两方程湍流模型封闭的雷诺平均纳维-斯托克斯 (RANS) 方程进行模拟。在入口处，平均流向速度是均匀的，大小为 $U_{\\infty}$，湍流强度为 $I$（定义为速度脉动的均方根与平均速率之比），积分长度尺度为 $L$（假设其代表湍流生成尺度，并与入口处的湍流长度尺度相当）。假设入口湍流是近似各向同性的。\n\n从基本定义和广泛接受的关系式出发，推导湍动能 $k$ 和比耗散率 $\\omega$ 的入口值。使用 $k=\\tfrac{3}{2}(I U_{\\infty})^{2}$，并获得一个以 $k$、$L$ 以及与湍动能-耗散率模型 ($k-\\varepsilon$) 中涡粘性封闭相关的模型常数 $C_{\\mu}$ 表示的 $\\omega$ 的表达式。您可以使用经过充分检验的平衡关系来连接 $k-\\varepsilon$ 和 $k-\\omega$ 封闭。讨论您设定的入口湍流与平均流边界条件的一致性，并阐述所选的入口 $k$ 和 $\\omega$ 如何与其他边界类型（如出口、远场、对称和周期性边界）相关联，以维持 RANS 问题的物理和数学兼容性。\n\n将入口比耗散率 $\\omega_{\\text{in}}$ 的最终表达式以单个闭式解析表达式的形式给出，该表达式应以 $I$、$U_{\\infty}$、$L$ 和 $C_{\\mu}$ 表示。不要代入数值。无需四舍五入。不要在最终表达式中包含单位；但是，从物理上将 $\\omega_{\\text{in}}$ 解释为具有时间倒数的量纲。",
            "solution": "用户希望我解决以下问题：\n考虑一个统计定常、不可压缩的高雷诺数流动，该流动使用由称为湍动能-比耗散率模型 ($k-\\omega$) 的两方程湍流模型封闭的雷诺平均纳维-斯托克斯 (RANS) 方程进行模拟。在入口处，平均流向速度是均匀的，大小为 $U_{\\infty}$，湍流强度为 $I$（定义为速度脉动的均方根与平均速率之比），积分长度尺度为 $L$（假设其代表湍流生成尺度，并与入口处的湍流长度尺度相当）。假设入口湍流是近似各向同性的。\n\n从基本定义和广泛接受的关系式出发，推导湍动能 $k$ 和比耗散率 $\\omega$ 的入口值。使用 $k=\\tfrac{3}{2}(I U_{\\infty})^{2}$，并获得一个以 $k$、$L$ 以及与湍动能-耗散率模型 ($k-\\varepsilon$) 中涡粘性封闭相关的模型常数 $C_{\\mu}$ 表示的 $\\omega$ 的表达式。您可以使用经过充分检验的平衡关系来连接 $k-\\varepsilon$ 和 $k-\\omega$ 封闭。讨论您设定的入口湍流与平均流边界条件的一致性，并阐述所选的入口 $k$ 和 $\\omega$ 如何与其他边界类型（如出口、远场、对称和周期性边界）相关联，以维持 RANS 问题的物理和数学兼容性。\n\n将入口比耗散率 $\\omega_{\\text{in}}$ 的最终表达式以单个闭式解析表达式的形式给出，该表达式应以 $I$、$U_{\\infty}$、$L$ 和 $C_{\\mu}$ 表示。不要代入数值。无需四舍五入。不要在最终表达式中包含单位；但是，从物理上将 $\\omega_{\\text{in}}$ 解释为具有时间倒数的量纲。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 流动类型：统计定常、不可压缩、高雷诺数。\n- 控制方程：雷诺平均纳维-斯托克斯 (RANS)。\n- 湍流模型：湍动能-比耗散率模型 ($k-\\omega$)。\n- 入口平均流向速度：均匀，大小为 $U_{\\infty}$。\n- 入口湍流强度：$I$。\n- 入口积分长度尺度：$L$。\n- 入口湍流假设：近似各向同性。\n- 入口湍动能：$k_{\\text{in}} = \\frac{3}{2}(I U_{\\infty})^{2}$。\n- 任务：推导入口比耗散率 $\\omega_{\\text{in}}$。\n- 推导约束：$\\omega$ 的表达式必须用 $k$、$L$ 以及来自 $k-\\varepsilon$ 模型的模型常数 $C_{\\mu}$ 表示。\n- 方法提示：使用经过充分检验的平衡关系来连接 $k-\\varepsilon$ 和 $k-\\omega$ 封闭。\n- 讨论主题：推导出的入口条件与平均流边界条件的一致性，以及与其他边界条件（出口、远场、对称、周期性）的关系。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础**：该问题坚实地建立在计算流体动力学 (CFD) 和湍流模拟的原理之上。RANS 方程、$k-\\omega$ 和 $k-\\varepsilon$ 模型，以及湍流强度、长度尺度和湍动能等概念都是该领域的标准和基础。\n- **适定性**：该问题是适定的。它要求使用已建立的理论关系，从一组给定的参数（$I$、$U_{\\infty}$、$L$、$C_{\\mu}$）中推导一个特定的量（$\\omega_{\\text{in}}$）。可以获得唯一的解析解。\n- **客观性**：该问题使用流体力学和 CFD 中精确、客观和标准的术语进行陈述。没有主观或模棱两可的陈述。\n- **一致性和完整性**：所提供的信息是自洽且充分的。关于 $k$ 的关系式与各向同性湍流的湍流强度定义一致。使用平衡关系和来自 $k-\\varepsilon$ 模型的常数 $C_{\\mu}$ 的指令为推导提供了清晰的路径。\n- **有效性检查**：该问题不违反任何无效标准。它在科学上是合理的、适定的、客观的、完整的，并且与 CFD 边界条件这一特定主题相关。\n\n**步骤 3：结论与行动**\n该问题是有效的。将提供完整的解答。\n\n### 解答推导\n\n目标是为一个使用 $k-\\omega$ 湍流模型的 RANS 模拟确定比耗散率 $\\omega_{\\text{in}}$ 的入口边界条件。该推导将基于所提供的入口参数和湍流模型理论中的标准关系式。\n\n首先，我们建立 $k-\\omega$ 模型和 $k-\\varepsilon$ 模型之间的联系。两者都是引入涡（或湍流）粘性 $\\nu_t$ 来封闭 RANS 方程的两方程模型。Boussinesq 假设通过此涡粘性将雷诺应力与平均应变率关联起来。\n\n在标准的 $k-\\omega$ 模型中，涡粘性定义为：\n$$ \\nu_t = \\frac{k}{\\omega} $$\n在标准的 $k-\\varepsilon$ 模型中，涡粘性定义为：\n$$ \\nu_t = C_{\\mu} \\frac{k^2}{\\varepsilon} $$\n其中 $k$ 是湍动能，$\\omega$ 是比耗散率，$\\varepsilon$ 是湍流耗散率，$C_{\\mu}$ 是一个经验模型常数（通常 $C_{\\mu} \\approx 0.09$）。\n\n通过令这两个表示同一物理量 $\\nu_t$ 的表达式相等，我们建立了 $\\omega$ 和 $\\varepsilon$ 之间的“封闭层面”关系：\n$$ \\frac{k}{\\omega} = C_{\\mu} \\frac{k^2}{\\varepsilon} $$\n假设 $k \\ne 0$，我们可以重排此表达式，以 $\\omega$ 表示 $\\varepsilon$ 进行求解，反之亦然：\n$$ \\varepsilon = C_{\\mu} k \\omega $$\n该方程提供了连接这两个模型变量的基本桥梁。\n\n接下来，我们必须将这些湍流量与给定的积分长度尺度 $L$ 联系起来。对于高雷诺数湍流，特别是那些接近平衡状态（即湍流生成率几乎等于耗散率）的流动，含能涡的特征长度尺度 $L_t$ 可以与 $k$ 和 $\\varepsilon$ 关联。这种关系源于量纲分析：$\\varepsilon$ 的量纲是 $[(长度)^2(时间)^{-3}]$，$k$ 的量纲是 $[(长度)^2(时间)^{-2}]$。能够产生 $\\varepsilon$ 量纲的 $k$ 和长度尺度 $L_t$ 的唯一组合是 $\\frac{k^{3/2}}{L_t}$。\n\n一个广泛使用的关系式，作为 $k-\\varepsilon$ 模型构建的基石，并与简单剪切流中的观测结果一致，通过模型常数 $C_{\\mu}$ 将长度尺度 $L$、湍动能 $k$ 和耗散率 $\\varepsilon$ 联系起来：\n$$ \\varepsilon = C_{\\mu}^{3/4} \\frac{k^{3/2}}{L} $$\n在这里，我们将问题给定的积分长度尺度 $L$ 等同于特征湍流长度尺度。这是一个常见且合理的假设，用于设定代表已发展湍流的入口条件。\n\n现在我们有两个关于 $\\varepsilon$ 的不同表达式。通过令它们相等，我们可以求解 $\\omega$：\n$$ C_{\\mu} k \\omega = C_{\\mu}^{3/4} \\frac{k^{3/2}}{L} $$\n求解 $\\omega$ 可得：\n$$ \\omega = \\frac{C_{\\mu}^{3/4}}{C_{\\mu}} \\frac{k^{3/2}}{k L} = C_{\\mu}^{3/4 - 1} \\frac{k^{1/2}}{L} = C_{\\mu}^{-1/4} \\frac{k^{1/2}}{L} $$\n该表达式按要求提供了用 $k$、$L$ 和常数 $C_{\\mu}$ 表示的比耗散率 $\\omega$。\n\n最后一步是将给定的入口湍动能表达式 $k_{\\text{in}}$ 代入我们推导出的 $\\omega$ 公式中。问题陈述：\n$$ k_{\\text{in}} = \\frac{3}{2}(I U_{\\infty})^{2} $$\n将此代入 $\\omega$ 的方程中：\n$$ \\omega_{\\text{in}} = C_{\\mu}^{-1/4} \\frac{\\left( \\frac{3}{2}(I U_{\\infty})^{2} \\right)^{1/2}}{L} $$\n化简表达式可得：\n$$ \\omega_{\\text{in}} = C_{\\mu}^{-1/4} \\frac{\\sqrt{\\frac{3}{2}} |I U_{\\infty}|}{L} $$\n由于湍流强度 $I$ 和平均速率 $U_{\\infty}$ 是非负物理量，所以绝对值是多余的。\n$$ \\omega_{\\text{in}} = \\sqrt{\\frac{3}{2}} C_{\\mu}^{-1/4} \\frac{I U_{\\infty}}{L} $$\n这就是入口比耗散率的最终解析表达式。\n\n### 关于边界条件的讨论\n\n**与平均流边界条件的一致性：**\n入口被指定为具有均匀平均速度剖面 $U_{\\infty}$，这是一个“平推流”条件。推导出的湍流量 $k_{\\text{in}}$ 和 $\\omega_{\\text{in}}$ 在整个入口上也是均匀的。这种均匀性是自洽的；对于一个平衡入口条件，用均匀平均流来指定一个空间变化的湍流场在物理上是不协调的。推导出的 $k_{\\text{in}}$ 和 $\\omega_{\\text{in}}$ 值代表了一种近平衡各向同性湍流状态，这是一个物理上合理且稳定的状态，用于初始化流场，可防止在紧邻入口的下游发生不真实的湍流快速衰减或增长。\n\n**与其他边界条件类型的关系：**\n- **出口：** 出口边界旨在允许流动离开计算域，且上游影响最小。一种常见的处理方法是对所有输运变量（包括 $k$ 和 $\\omega$）使用零梯度（Neumann）条件，即 $\\frac{\\partial \\phi}{\\partial n} = 0$。这假设流动在出口处是“充分发展”的。此处推导的入口设定与零梯度出口兼容，前提是计算域足够长，以允许流动从其入口状态演变到充分发展状态。\n- **远场：** 对于外部空气动力学模拟，远场边界条件指定了自由来流状态。施加的条件在形式上与此处推导的入口条件相同：均匀速度 $U_{\\infty}$，以及由自由来流湍流强度 $I_{\\infty}$ 和特征长度尺度 $L_{\\infty}$ 计算出的湍流特性（$k_{\\infty}$，$\\omega_{\\infty}$）。因此，推导出的公式直接适用于远场边界。\n- **对称：** 对称面强制执行跨边界的无通量条件（$\\vec{v} \\cdot \\vec{n} = 0$）以及所有标量（$\\frac{\\partial k}{\\partial n} = 0$, $\\frac{\\partial \\omega}{\\partial n} = 0$）的零法向梯度。这是对流场结构的局部约束。它在数学上独立于入口条件设定的全局湍流水平，并与之兼容。\n- **周期性：** 周期性边界强制一个边界上的流动状态与另一处相应边界上的状态相同。这用于具有空间周期性的几何形状，例如叶栅或充分发展的槽道流。在这种情况下，没有传统意义上的“入口”；流动以其离开时的属性重新进入计算域。因此，在主流动方向上，设定入口 $k$ 和 $\\omega$ 的概念与使用周期性边界是互斥的。因此，推导出的入口条件适用于非周期性问题。\n\n总之，推导出的 $k$ 和 $\\omega$ 入口设定是初始化 RANS 模拟的一种标准的、有物理基础的方法。它确保了与 CFD 中使用的其他常见边界条件类型的数学和物理兼容性，从而构成了一个适定的问题设置。",
            "answer": "$$ \\boxed{\\sqrt{\\frac{3}{2}} C_{\\mu}^{-\\frac{1}{4}} \\frac{I U_{\\infty}}{L}} $$"
        },
        {
            "introduction": "出口边界条件的设计目标是允许流体顺利离开计算域，而不对上游流场产生非物理性的干扰。然而，当出口处出现回流时，不恰当的边界条件可能导致数值不稳定，甚至使模拟发散。本练习将带您深入探讨出口边界条件的理论核心——能量稳定性，通过分析“无为”（do-nothing）边界条件对系统动能收支的影响，您将从第一性原理理解为何某些边界条件会非物理地向计算域注入能量，并学会如何构建一个保证能量守恒的稳定格式。",
            "id": "3335037",
            "problem": "考虑牛顿流体在具有平面出流边界子集的有界域中的不可压缩Navier-Stokes方程。设速度为 $u(x,t)$，压力为 $p(x,t)$，两者均为无量纲。方程为\n$$\n\\partial_t u + (u \\cdot \\nabla) u + \\nabla p - \\nu \\Delta u = 0, \\quad \\nabla \\cdot u = 0,\n$$\n其中运动粘度 $\\nu \\ge 0$。设离散空间算子的选择使其对流项是斜对称的，并与分部求和（SBP）性质一致，从而使得半离散动能收支在边界项的差异内能够反映连续分部积分恒等式。定义（无量纲）动能\n$$\nE(t) = \\frac{1}{2} \\int_{\\Omega} |u|^2 \\, dx.\n$$\n假设不存在体积力，并且除出流边界外的所有边界均不产生能量（例如，无滑移壁面或对称面，这些边界意味着边界面力的做功速率为零）。在出流边界子集上，将考察两类条件：\n\n- 一种自然的、面力类型的边界条件，有时称为“无为”出流，通过在弱形式中不补偿面力而得到。\n\n- 在平面 $x=L$ 上的对流出流条件，形式为 $\\partial_t u + U_0 \\partial_{x} u = 0$，其中 $U_0$ 是给定的恒定速度。\n\n您的任务是：\n\n1) 从动量方程乘以 $u$ 并在域上积分得到的基本恒等式出发，并利用不可压缩性约束，推导半离散动能平衡，以分离出出流边界上的能量产生项。将此边界项表示为仅依赖于局部法向速度 $u \\cdot n$、面力 $t = \\left( -p I + \\nu \\nabla u \\right) n$ 和局部速率 $|u|^2$ 的形式，而不假设 $u \\cdot n$ 的任何特定符号。然后，通过在出流边界上将面力设为零，将此平衡特化为“无为”情况。仅使用所得表达式和第一性原理，确定 $u \\cdot n$ 的一个逐点符号条件，在该条件下，“无为”边界保证是能量不增的。然后，提出并证明一种对自然边界条件的能量稳定修正，该修正在 $u \\cdot n \\ge 0$ 时退化为“无为”条件，并在 $u \\cdot n  0$ 时防止能量流入。\n\n2) 对于平面 $x=L$ 上的对流出流条件 $\\partial_t u + U_0 \\partial_x u = 0$，使用 SBP/斜对称离散框架推导其对动能平衡的贡献。确定 $U_0$ 的符号条件，以保证出流边界的贡献是能量不增的。\n\n3) 基于推导出的边能量项，实现一个计算过程，该过程针对一组带有求积权重的离散出流边界节点，评估由以下条件预测的边能量产生：\n- “无为”无面力条件，\n- 您在任务1)中提出的能量稳定修正，\n- 任务2)中具有恒定 $U_0$ 的对流出流条件。\n\n当且仅当一个边界条件的离散边能量产生（在您的推导中得到的出流边界对 $\\frac{dE}{dt}$ 的贡献）为严格正值时，该边界条件被视为违反离散动能收支。否则，它被视为能量不增。\n\n全程使用无量纲变量，因此不需要物理单位。\n\n测试套件和输出规范：\n\n使用以下五个测试用例。每个测试用例是一个元组，包含：\n- 一系列出流求积点上的局部速率平方 $|u|^2$ 的列表，\n- 这些点上局部法向速度 $u \\cdot n$ 的列表（其中外单位法向量 $n$ 指向域外），\n- 这些点上正求积权重的列表，\n- 在 $x=L$ 处对流出流条件的恒定对流速度 $U_0$。\n\n测试用例如下：\n\n- 用例 A: $|u|^2 = [\\,1.0,\\,0.25\\,]$, $u \\cdot n = [\\,0.8,\\,1.2\\,]$, 权重 $[\\,1.0,\\,1.0\\,]$, $U_0 = 1.0$。\n- 用例 B: $|u|^2 = [\\,0.5,\\,3.0\\,]$, $u \\cdot n = [\\,0.2,\\,-0.7\\,]$, 权重 $[\\,1.0,\\,1.0\\,]$, $U_0 = 1.0$。\n- 用例 C: $|u|^2 = [\\,1.0,\\,1.0\\,]$, $u \\cdot n = [\\,0.0,\\,0.0\\,]$, 权重 $[\\,1.0,\\,1.0\\,]$, $U_0 = 0.0$。\n- 用例 D: $|u|^2 = [\\,1.5,\\,0.2\\,]$, $u \\cdot n = [\\,-0.3,\\,-0.4\\,]$, 权重 $[\\,1.0,\\,1.0\\,]$, $U_0 = -0.5$。\n- 用例 E: $|u|^2 = [\\,2.0,\\,2.0,\\,2.0\\,]$, $u \\cdot n = [\\,0.1,\\,-0.2,\\,0.3\\,]$, 权重 $[\\,0.5,\\,1.0,\\,1.5\\,]$, $U_0 = 0.4$。\n\n您的程序必须为每个用例计算一个布尔值三元组：\n- 第一个布尔值表示“无为”条件是否是能量不增的，\n- 第二个布尔值表示您的能量稳定修正是否是能量不增的，\n- 第三个布尔值表示对流出流条件是否是能量不增的。\n\n您的程序应生成单行输出，其中包含五个三元组的结果，以逗号分隔列表的形式，并用方括号括起来，不含空格。例如，一个包含两个假设三元组的有效格式为：[[True,False,True],[False,True,True]]。",
            "solution": "该问题是有效的，因为它具有科学依据、是适定且客观的，基于计算流体力学的标准原理以及用于分析Navier-Stokes方程数值格式稳定性的能量方法。\n\n解答按问题陈述的要求分为三部分呈现。所有数学实体均按要求使用LaTeX渲染。\n\n1) 动能平衡的推导及“无为”边界条件的分析。\n\n我们从不可压缩Navier-Stokes动量方程开始，其中速度为 $u$，压力为 $p$，运动粘度为 $\\nu$：\n$$\n\\partial_t u + (u \\cdot \\nabla) u + \\nabla p - \\nu \\Delta u = 0\n$$\n为了推导总动能 $E(t) = \\frac{1}{2} \\int_{\\Omega} |u|^2 \\, dx$ 的演化方程，我们将动量方程与速度场 $u$ 作 $L^2$ 内积：\n$$\n\\int_{\\Omega} u \\cdot (\\partial_t u) \\, dx + \\int_{\\Omega} u \\cdot ((u \\cdot \\nabla) u) \\, dx + \\int_{\\Omega} u \\cdot \\nabla p \\, dx - \\nu \\int_{\\Omega} u \\cdot \\Delta u \\, dx = 0\n$$\n我们逐项分析：\n- 时间导数项为 $\\int_{\\Omega} u \\cdot \\partial_t u \\, dx = \\int_{\\Omega} \\frac{1}{2} \\partial_t(|u|^2) \\, dx = \\frac{d}{dt} \\left(\\frac{1}{2} \\int_{\\Omega} |u|^2 \\, dx\\right) = \\frac{dE}{dt}$。\n- 对流项和压力项可以合并。使用矢量微积分恒等式 $\\nabla \\cdot (\\phi v) = \\phi(\\nabla \\cdot v) + v \\cdot \\nabla \\phi$ 和不可压缩性约束 $\\nabla \\cdot u = 0$：\n$$\nu \\cdot ((u \\cdot \\nabla) u) + u \\cdot \\nabla p = u \\cdot \\nabla\\left(\\frac{1}{2}|u|^2\\right) + u \\cdot \\nabla p = \\nabla \\cdot \\left(\\left(\\frac{1}{2}|u|^2 + p\\right)u\\right)\n$$\n在域 $\\Omega$ 上积分并应用散度定理，得到这些项的边界贡献：\n$$\n\\int_{\\Omega} \\left( u \\cdot ((u \\cdot \\nabla) u) + u \\cdot \\nabla p \\right) \\, dx = \\int_{\\partial\\Omega} \\left(\\frac{1}{2}|u|^2 + p\\right)(u \\cdot n) \\, dS\n$$\n其中 $n$ 是外单位法向量。这个恒等式也依赖于离散对流算子的斜对称性质，这使其对能量收支的贡献仅出现在边界上。\n- 粘性项使用分部积分（逐分量的格林第一恒等式）进行分析：\n$$\n- \\nu \\int_{\\Omega} u \\cdot \\Delta u \\, dx = - \\nu \\left( \\int_{\\partial\\Omega} u \\cdot ((\\nabla u) n) \\, dS - \\int_{\\Omega} |\\nabla u|^2 d\\Omega \\right)\n$$\n其中 $|\\nabla u|^2 = \\sum_{i,j} (\\partial_j u_i)^2$ 是速度梯度张量的Frobenius范数，代表粘性耗散。\n\n合并所有项得到动能演化方程：\n$$\n\\frac{dE}{dt} + \\int_{\\partial\\Omega} \\left(\\frac{1}{2}|u|^2 + p\\right)(u \\cdot n) \\, dS - \\nu \\int_{\\partial\\Omega} u \\cdot ((\\nabla u) n) \\, dS + \\nu \\int_{\\Omega} |\\nabla u|^2 d\\Omega = 0\n$$\n问题陈述中指出，除出流边界 $\\partial\\Omega_{out}$ 外的所有边界的净能量贡献为零。项 $\\nu \\int_{\\Omega} |\\nabla u|^2 d\\Omega$ 是粘性耗散率，它总是非负的，因此总是使动能减少。在 $\\partial\\Omega_{out}$ 上的边能量产生是边界积分对 $\\frac{dE}{dt}$ 的贡献。分离出这些项，我们得到：\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy} = - \\int_{\\partial\\Omega_{out}} \\left(\\frac{1}{2}|u|^2 + p\\right)(u \\cdot n) \\, dS + \\nu \\int_{\\partial\\Omega_{out}} u \\cdot ((\\nabla u) n) \\, dS\n$$\n这可以用面力矢量 $t = (-p I + \\nu \\nabla u)n$ 重写：\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy} = \\int_{\\partial\\Omega_{out}} \\left( -\\frac{1}{2}|u|^2(u \\cdot n) - p(u \\cdot n) + \\nu u \\cdot ((\\nabla u)n) \\right) \\, dS\n$$\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy} = \\int_{\\partial\\Omega_{out}} \\left( u \\cdot (-pn + \\nu(\\nabla u)n) - \\frac{1}{2}|u|^2(u \\cdot n) \\right) \\, dS\n$$\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy} = \\int_{\\partial\\Omega_{out}} \\left( u \\cdot t - \\frac{1}{2}|u|^2(u \\cdot n) \\right) \\, dS\n$$\n这就是所求的边能量产生表达式，即边界面力所做的功的速率减去动能的对流通量。\n\n对于“无为”出流条件，在 $\\partial\\Omega_{out}$ 上将面力 $t$ 设为零。边能量产生变为：\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy, \\text{do-nothing}} = -\\frac{1}{2} \\int_{\\partial\\Omega_{out}} |u|^2 (u \\cdot n) \\, dS\n$$\n为使此边界条件是能量不增的，我们必须有 $\\left. \\frac{dE}{dt} \\right|_{bdy} \\le 0$。由于 $|u|^2 \\ge 0$，当且仅当被积函数逐点非负时，此积分才保证为非正。这导出了在 $\\partial\\Omega_{out}$ 上处处有 $u \\cdot n \\ge 0$ 的条件。任何流入区域（$u \\cdot n  0$），通常称为回流，都会导致对 $\\frac{dE}{dt}$ 的正贡献，使得该条件在能量上不稳定。\n\n为了构造一个能量稳定的修正，我们必须在回流区域改变面力 $t$ 以防止能量增加。目标是定义 $t$，使得被积函数 $I = u \\cdot t - \\frac{1}{2}|u|^2(u \\cdot n)$ 总是非正的。\n- 当 $u \\cdot n \\ge 0$ 时，我们希望恢复“无为”条件。我们设置 $t=0$，这给出 $I = - \\frac{1}{2}|u|^2(u \\cdot n) \\le 0$。这是稳定的。\n- 当 $u \\cdot n  0$ 时，“无为”条件 $t=0$ 给出 $I = - \\frac{1}{2}|u|^2(u \\cdot n) > 0$，这是不稳定的。为了纠正这一点，我们可以选择一个面力 $t$ 来抵消这个正项。一个简单而有效的选择是将做功项 $u \\cdot t$ 设置为等于动能平流项，从而使净贡献为零。\n$$\nu \\cdot t = \\frac{1}{2}|u|^2(u \\cdot n)\n$$\n满足此条件的一个简单面力是 $t = \\frac{1}{2}(u \\cdot n)u$。这导出了建议的修正：\n$$\nt = \\frac{1}{2}\\min(0, u \\cdot n) u\n$$\n让我们验证一下。如果 $u \\cdot n \\ge 0$，则 $\\min(0, u \\cdot n) = 0$，所以 $t=0$。如果 $u \\cdot n  0$，则 $\\min(0, u \\cdot n) = u \\cdot n$，所以 $t = \\frac{1}{2}(u \\cdot n) u$。被积函数变为 $I = u \\cdot (\\frac{1}{2}(u \\cdot n)u) - \\frac{1}{2}|u|^2(u \\cdot n) = \\frac{1}{2}(u \\cdot n)|u|^2 - \\frac{1}{2}|u|^2(u \\cdot n) = 0$。\n因此，通过这种修正的面力，边能量产生总是非正的，从而保证了能量稳定性。\n\n2) 对流出流条件的分析。\n\n对流出流条件是在平面 $x=L$ 上的 $\\partial_t u + U_0 \\partial_x u = 0$。SBP/斜对称框架通过将边界条件与能量通量相关联，提供了一种分析边界条件稳定性的稳健方法。通过与一维平流方程 $\\partial_t f + c \\partial_x f = 0$ 类比，能量为 $\\frac{1}{2}\\int f^2 dx$。能量的变化率由边界上的通量决定：$\\frac{d}{dt} \\left(\\frac{1}{2}\\int f^2 dx\\right) = -\\frac{c}{2}[f^2]_{\\text{边界}}$。在出流边界处，能量通量为 $-\\frac{c}{2}f^2$。为使此贡献为非正（能量不增），我们需要 $c \\ge 0$。\n\n将这个既定原则外推到当前的矢量值情况，动能为 $\\frac{1}{2}|u|^2$。因此，与对流边界条件相关的能量产生被建模为能量通量在边界上的积分：\n$$\n\\left. \\frac{dE}{dt} \\right|_{bdy, \\text{conv}} = - \\frac{1}{2} \\int_{\\partial\\Omega_{out}} U_0 |u|^2 \\, dS\n$$\n为使其能量不增，我们需要 $\\left. \\frac{dE}{dt} \\right|_{bdy, \\text{conv}} \\le 0$。因为 $|u|^2 \\ge 0$ 且积分是在一个表面上进行的，如果常数 $U_0$ 是非负的，那么对于任意速度场，该条件都满足。因此，保证能量稳定性的符号条件是 $U_0 \\ge 0$。一个正的 $U_0$ 确保能量被对流出域。\n\n3) 边能量产生计算的实现。\n\n离散边能量产生 $P_{bdy}$ 是通过将在出流边界上的所有离散点 $j$ 的被积函数乘以求积权重 $w_j$ 再求和来计算的。如果 $P_{bdy} \\le 0$，则条件是能量不增的。设点 $j$ 处的数据为 $|u_j|^2$、$(u \\cdot n)_j$ 和 $w_j$。\n- **“无为”条件**：离散能量产生为：\n$$ P_{bdy, 1} = \\sum_j w_j \\left( -\\frac{1}{2} |u_j|^2 (u \\cdot n)_j \\right) $$\n- **能量稳定修正**：当 $(u \\cdot n)_j  0$ 时，被积函数为 $0$；当 $(u \\cdot n)_j \\ge 0$ 时，被积函数为 $-\\frac{1}{2}|u_j|^2 (u \\cdot n)_j$。离散能量产生为：\n$$ P_{bdy, 2} = \\sum_{j \\text{ where } (u \\cdot n)_j \\ge 0} w_j \\left( -\\frac{1}{2} |u_j|^2 (u \\cdot n)_j \\right) $$\n根据构造，此和中的每一项都是非正的，所以 $P_{bdy, 2} \\le 0$ 总是成立。\n- **对流出流条件**：离散能量产生为：\n$$ P_{bdy, 3} = \\sum_j w_j \\left( -\\frac{1}{2} U_0 |u_j|^2 \\right) = -\\frac{1}{2} U_0 \\sum_j w_j |u_j|^2 $$\n以下程序为给定的测试套件实现了这些计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the energy stability for three outflow boundary conditions\n    across five test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {'u2': [1.0, 0.25], 'un': [0.8, 1.2], 'weights': [1.0, 1.0], 'U0': 1.0},\n        # Case B\n        {'u2': [0.5, 3.0], 'un': [0.2, -0.7], 'weights': [1.0, 1.0], 'U0': 1.0},\n        # Case C\n        {'u2': [1.0, 1.0], 'un': [0.0, 0.0], 'weights': [1.0, 1.0], 'U0': 0.0},\n        # Case D\n        {'u2': [1.5, 0.2], 'un': [-0.3, -0.4], 'weights': [1.0, 1.0], 'U0': -0.5},\n        # Case E\n        {'u2': [2.0, 2.0, 2.0], 'un': [0.1, -0.2, 0.3], 'weights': [0.5, 1.0, 1.5], 'U0': 0.4},\n    ]\n\n    results = []\n    # A small tolerance to test for strictly positive values.\n    tol = 1e-12\n\n    for case in test_cases:\n        u_squared = np.array(case['u2'])\n        u_dot_n = np.array(case['un'])\n        weights = np.array(case['weights'])\n        U0 = case['U0']\n\n        # 1. \"Do-nothing\" condition\n        # P_bdy = sum( -0.5 * |u|^2 * (u . n) * w )\n        p_bdy1 = np.sum(-0.5 * u_squared * u_dot_n * weights)\n        is_stable1 = p_bdy1 = tol\n\n        # 2. Energy-stable modification\n        # Integrand is -0.5*|u|^2*(u.n) where u.n = 0, and 0 otherwise.\n        integrand_2 = np.where(u_dot_n >= 0, -0.5 * u_squared * u_dot_n, 0)\n        p_bdy2 = np.sum(integrand_2 * weights)\n        is_stable2 = p_bdy2 = tol\n\n        # 3. Convective outflow condition\n        # P_bdy = -0.5 * U0 * sum( |u|^2 * w )\n        p_bdy3 = -0.5 * U0 * np.sum(u_squared * weights)\n        is_stable3 = p_bdy3 = tol\n\n        results.append((is_stable1, is_stable2, is_stable3))\n\n    # Format the final output string as specified, e.g., [[True,False,True],[...]]\n    triplet_strings = []\n    for r in results:\n        # Convert boolean to lowercase 'true'/'false' if needed, but str(bool) gives 'True'/'False'\n        # which is more common in Python context. The example shows capitalized Booleans.\n        triplet_strings.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    \n    final_output = f\"[{','.join(triplet_strings)}]\"\n    # Replace Python's default spaces after commas for exact format matching.\n    final_output = final_output.replace(\" \", \"\")\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "周期性边界条件是模拟无限或重复性几何（如涡轮叶栅和换热器）的强大工具，但在实际应用中，周期性对应面上的网格往往不一致（即非共形网格），这给保证通量守恒带来了巨大挑战。本高级练习聚焦于一个关键的实施细节：如何为非共形周期性界面构建一个严格守恒的离散映射。通过此练习，您将学会设计和验证一个能够确保质量、动量和能量通量在界面上精确传递的数值方案，从而避免因离散误差累积而导致的模拟失败。",
            "id": "3334990",
            "problem": "给定两个平行的周期性平面，分别表示为 $\\Gamma_L$（供给侧）和 $\\Gamma_R$（接收侧），它们共同构成了一个通过有限体积法（Finite Volume Method, FVM）离散化的可压缩流场中的周期性边界。每个平面都由一组非结构化的面元 tessellation（网格剖分）而成。每个平面上的交界面几何形状由沿交界面曲线的一维参数化 $s \\in [0,L]$ 表示。任一平面上的每个面元都由 $s$ 中的一个区间来标识，并具有相关的几何和流动数据。目标是在 $\\Gamma_L$ 上的供给面元集 $D$ 和 $\\Gamma_R$ 上的接收面元集 $R$ 之间构建一个严格保守的离散映射，以确保即使在两个平面之间的面元面积和单位法向量不同的情况下，总质量、动量和能量通量也能在周期性交界面上得到精确守恒。\n\n该问题的基本基础是可压缩流动的守恒律，由可压缩 Euler 方程及其表面通量表示。对于一个单位法向量为 $\\mathbf{n}$、面积为 $A$ 的面元，假设每个面元上进行分片常数重构，则通过该面元的对流质量通量为\n$$\nF_m = \\rho \\, (\\mathbf{u} \\cdot \\mathbf{n}) \\, A,\n$$\n对流动量通量矢量为\n$$\n\\mathbf{F}_{\\mathbf{p}} = F_m \\, \\mathbf{u},\n$$\n对流能量通量为\n$$\nF_E = F_m \\, E,\n$$\n其中 $\\rho$ 是密度，$\\mathbf{u}$ 是速度矢量，$E$ 是比总能，单位为焦耳每千克。这些定义排除了压力项和粘性应力，专注于对流部分，这足以通过离散映射和“幽灵”状态（ghost-state）构建来证明严格守恒。\n\n您必须在一维参数化中使用共同细化（common-refinement）方法，在 $\\Gamma_L$ 上的供给面元集 $D$ 和 $\\Gamma_R$ 上的接收面元集 $R$ 之间构建一个线性映射矩阵 $W \\in \\mathbb{R}^{|R| \\times |D|}$。设供给面元 $i \\in D$ 覆盖区间 $[s_{i0}, s_{i1}]$，长度为 $\\ell_i = s_{i1} - s_{i0}$，接收面元 $j \\in R$ 覆盖区间 $[s_{j0}, s_{j1}]$。定义重叠长度\n$$\n\\ell_{ji} = \\max\\!\\left(0, \\min(s_{i1}, s_{j1}) - \\max(s_{i0}, s_{j0})\\right),\n$$\n和离散映射权重\n$$\nW_{ji} = \\frac{\\ell_{ji}}{\\ell_i}.\n$$\n当接收侧的 tessellation 覆盖与供给侧 tessellation 相同的全局区间时，此映射对每个供给面元 $i \\in D$ 满足 $\\sum_{j \\in R} W_{ji} = 1$。\n\n使用 $W$，通过供给侧通量的线性组合来定义分配给接收侧的对流通量：\n$$\nF_m^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i),\n$$\n$$\n\\mathbf{F}_{\\mathbf{p}}^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i) \\, \\mathbf{u}_i,\n$$\n$$\nF_E^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i) \\, E_i,\n$$\n其中 $F_m^{(d)}(i)$ 是供给侧质量通量，$\\mathbf{u}_i$ 和 $E_i$ 分别是供给面元的速度和比总能。\n\n为确保在可能具有不同面积 $A_j$ 和法向量 $\\mathbf{n}_j$ 的接收面元上实现严格守恒，请按如下方式在每个接收面元 $j$ 上构建一个“幽灵”状态：\n- 如果 $|F_m^{(r)}(j)| > \\varepsilon$（其中 $\\varepsilon$ 为一个小容差），则设置\n$$\n\\mathbf{u}_j^{\\mathrm{ghost}} = \\frac{\\mathbf{F}_{\\mathbf{p}}^{(r)}(j)}{F_m^{(r)}(j)}, \\quad\nE_j^{\\mathrm{ghost}} = \\frac{F_E^{(r)}(j)}{F_m^{(r)}(j)}, \\quad\n\\rho_j^{\\mathrm{ghost}} = \\frac{F_m^{(r)}(j)}{A_j \\, \\left(\\mathbf{u}_j^{\\mathrm{ghost}} \\cdot \\mathbf{n}_j\\right)}.\n$$\n- 如果 $|F_m^{(r)}(j)| \\le \\varepsilon$，则设置\n$$\n\\mathbf{u}_j^{\\mathrm{ghost}} = \\mathbf{0}, \\quad E_j^{\\mathrm{ghost}} = 0, \\quad \\rho_j^{\\mathrm{ghost}} = 0.\n$$\n通过这种构造，使用接收面元自身几何形状计算出的对流通量满足\n$$\nF_m^{\\mathrm{check}}(j) = \\rho_j^{\\mathrm{ghost}} \\, \\left(\\mathbf{u}_j^{\\mathrm{ghost}} \\cdot \\mathbf{n}_j\\right) \\, A_j = F_m^{(r)}(j),\n$$\n$$\n\\mathbf{F}_{\\mathbf{p}}^{\\mathrm{check}}(j) = F_m^{\\mathrm{check}}(j) \\, \\mathbf{u}_j^{\\mathrm{ghost}} = \\mathbf{F}_{\\mathbf{p}}^{(r)}(j),\n$$\n$$\nF_E^{\\mathrm{check}}(j) = F_m^{\\mathrm{check}}(j) \\, E_j^{\\mathrm{ghost}} = F_E^{(r)}(j),\n$$\n从而确保每个面元上的严格相等，并因此确保交界面上的严格全局守恒。角度不被直接使用；法向量以分量形式提供。所有物理量均使用国际单位制 (SI)：密度单位为千克每立方米，速度单位为米每秒，面积单位为平方米，比总能单位为焦耳每千克，质量通量单位为千克每秒，动量通量单位为牛顿，能量通量单位为瓦特。您的程序必须输出布尔值，因此不要打印单位。\n\n实现一个程序，该程序：\n1. 从供给面元和接收面元的区间构建 $W$。\n2. 计算供给侧对流通量 $F_m^{(d)}(i)$、$\\mathbf{F}_{\\mathbf{p}}^{(d)}(i)$ 和 $F_E^{(d)}(i)$。\n3. 通过 $W$ 计算分配给接收侧的通量。\n4. 如上所述在接收面元上构建“幽灵”状态。\n5. 通过在小容差范围内比较两侧所有面元的总和，验证分配通量与校验通量在每个面元上的相等性以及全局守恒性。\n\n使用以下测试套件，每个套件都定义了 $L$、供给面元和接收面元。每个面元由 $(s_0, s_1, A, \\mathbf{n}, \\rho, \\mathbf{u}, E)$ 指定，其中 $\\mathbf{n}$ 和 $\\mathbf{u}$ 以 $(u_x,u_y,u_z)$ 的形式给出。\n\n测试用例 1（不同面积和轻微法向量错位的一般情况）：\n- $L = 1.0$。\n- 供给侧 $D$：\n  - $[0.0, 0.5], A=1.0, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.2, \\mathbf{u}=(10.0, 2.0, 0.0), E=100000.0$。\n  - $[0.5, 0.75], A=0.5, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.0, \\mathbf{u}=(8.0, -1.0, 0.0), E=90000.0$。\n  - $[0.75, 1.0], A=1.5, \\mathbf{n}=(0.965925826, 0.258819045, 0.0), \\rho=0.95, \\mathbf{u}=(12.0, 0.5, 0.0), E=110000.0$。\n- 接收侧 $R$：\n  - $[0.0, 0.4], A=0.8, \\mathbf{n}=(-0.980580675, -0.196116135, 0.0)$。\n  - $[0.4, 1.0], A=2.2, \\mathbf{n}=(-1.0, 0.0, 0.0)$。\n  - 对于接收面元，$\\rho$、$\\mathbf{u}$、$E$ 未给出；它们被构建为“幽灵”状态。\n\n测试用例 2（在更长的交界面上存在更强的错位和非均匀划分）：\n- $L = 2.0$。\n- 供给侧 $D$：\n  - $[0.0, 0.6], A=0.7, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.3, \\mathbf{u}=(5.0, 0.0, 1.0), E=80000.0$。\n  - $[0.6, 1.5], A=1.2, \\mathbf{n}=(0.93969262, 0.342020143, 0.0), \\rho=1.1, \\mathbf{u}=(7.0, -0.5, 0.2), E=92000.0$。\n  - $[1.5, 2.0], A=0.9, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.25, \\mathbf{u}=(6.0, 0.2, -0.1), E=88000.0$。\n- 接收侧 $R$：\n  - $[0.0, 0.5], A=0.6, \\mathbf{n}=(-0.93969262, -0.342020143, 0.0)$。\n  - $[0.5, 1.2], A=1.0, \\mathbf{n}=(-1.0, 0.0, 0.0)$。\n  - $[1.2, 2.0], A=1.2, \\mathbf{n}=(-0.965925826, -0.258819045, 0.0)$。\n\n测试用例 3（具有小法向分量和高度变化面积的边缘情况）：\n- $L = 1.0$。\n- 供给侧 $D$：\n  - $[0.0, 0.3], A=0.3, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.0, \\mathbf{u}=(2.0, 0.0, 0.0), E=50000.0$。\n  - $[0.3, 0.7], A=1.7, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.0, \\mathbf{u}=(0.1, 4.0, 0.0), E=55000.0$。\n  - $[0.7, 1.0], A=0.5, \\mathbf{n}=(0.965925826, 0.258819045, 0.0), \\rho=1.0, \\mathbf{u}=(0.01, 0.1, 0.0), E=50000.0$。\n- 接收側 $R$：\n  - $[0.0, 0.2], A=0.2, \\mathbf{n}=(-1.0, 0.0, 0.0)$。\n  - $[0.2, 0.6], A=1.6, \\mathbf{n}=(-0.999847695, -0.017452406, 0.0)$。\n  - $[0.6, 1.0], A=0.7, \\mathbf{n}=(-0.984807753, -0.173648178, 0.0)$。\n\n测试用例 4（包括负和零的供给侧质量通量贡献）：\n- $L = 1.5$。\n- 供给侧 $D$：\n  - $[0.0, 0.5], A=0.4, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.2, \\mathbf{u}=(-3.0, 0.0, 0.0), E=60000.0$。\n  - $[0.5, 1.0], A=0.8, \\mathbf{n}=(0.965925826, 0.258819045, 0.0), \\rho=1.0, \\mathbf{u}=(3.0, 1.0, 0.0), E=70000.0$。\n  - $[1.0, 1.5], A=0.5, \\mathbf{n}=(1.0, 0.0, 0.0), \\rho=1.1, \\mathbf{u}=(0.0, 2.0, 0.0), E=65000.0$。\n- 接收側 $R$：\n  - $[0.0, 0.3], A=0.3, \\mathbf{n}=(-1.0, 0.0, 0.0)$。\n  - $[0.3, 1.2], A=1.4, \\mathbf{n}=(-0.965925826, -0.258819045, 0.0)$。\n  - $[1.2, 1.5], A=0.5, \\mathbf{n}=(-1.0, 0.0, 0.0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，输出一个布尔值列表 $[b_m, b_p, b_E]$，分别表示质量（$b_m$）、动量（$b_p$）和能量（$b_E$）的严格全局守恒，判断依据是将供给侧和接收侧校验通量的总和在 $10^{-9}$ 的容差内进行比较。因此，最终输出必须是布尔值列表的列表，形式为 $\\big[\\,[b_m^{(1)}, b_p^{(1)}, b_E^{(1)}], [b_m^{(2)}, b_p^{(2)}, b_E^{(2)}], [b_m^{(3)}, b_p^{(3)}, b_E^{(3)}], [b_m^{(4)}, b_p^{(4)}, b_E^{(4)}]\\,\\big]$。",
            "solution": "问题陈述经评估有效。它在科学上基于计算流体动力学（CFD）的原理，特别是用于可压缩流的有限体积法（FVM）。其公式在数学上是适定的、客观的，并为可验证的计算任务提供了一套完整且一致的数据和程序。任务是实现并验证一种用于周期性边界条件的严格保守映射，这是数值模拟中一种标准且重要的技术。\n\n问题的核心在于证明一个用于耦合两个周期性边界 $\\Gamma_L$ 和 $\\Gamma_R$ 的特定数值方案能够守恒质量、动量和能量。守恒特性是设计使然，源于从面元剖分的共同细化中导出的线性映射的构建。该程序的有效性将通过实施并验证从供给边界 $\\Gamma_L$ 进入域的总通量与在接收边界 $\\Gamma_R$ 上重构的总通量完全相等来确认。\n\n该方法基于交界面的一维参数化 $s$。供给和接收边界上的每个面元都对应于 $s$ 中的一个区间。供给面元 $i$ 和接收面元 $j$ 之间的映射基于它们在此参数空间中的重叠长度。\n\n设供给面元集为 $D$，接收面元集为 $R$。对于每个供给面元 $i \\in D$，我们给定其几何形状（面积 $A_i$，单位法向量 $\\mathbf{n}_i$）和流动状态（密度 $\\rho_i$，速度 $\\mathbf{u}_i$，比总能 $E_i$）。这些值假定在面元上是分片常数。对流通量定义如下：\n$$\n\\text{质量通量: } F_m^{(d)}(i) = \\rho_i \\, (\\mathbf{u}_i \\cdot \\mathbf{n}_i) \\, A_i\n$$\n$$\n\\text{动量通量: } \\mathbf{F}_{\\mathbf{p}}^{(d)}(i) = F_m^{(d)}(i) \\, \\mathbf{u}_i\n$$\n$$\n\\text{能量通量: } F_E^{(d)}(i) = F_m^{(d)}(i) \\, E_i\n$$\n对于每个接收面元 $j \\in R$，我们给定其几何形状（$A_j$, $\\mathbf{n}_j$）。接收面元上的流动状态，称为“幽灵状态”，是我们必须构建的。\n\n需要实现和验证的程序如下：\n\n1.  **构建映射矩阵**：构建一个映射矩阵 $W \\in \\mathbb{R}^{|R| \\times |D|}$。其元素 $W_{ji}$ 表示供给面元 $i$ 在几何上映射到接收面元 $j$ 的部分。一个供给面元 $i$ 覆盖参数区间 $[s_{i0}, s_{i1}]$，长度为 $\\ell_i = s_{i1} - s_{i0}$。一个接收面元 $j$ 覆盖 $[s_{j0}, s_{j1}]$。重叠长度为 $\\ell_{ji} = \\max\\!\\left(0, \\min(s_{i1}, s_{j1}) - \\max(s_{i0}, s_{j0})\\right)$。矩阵元素则定义为重叠长度与供给面元总长度之比：\n    $$\n    W_{ji} = \\frac{\\ell_{ji}}{\\ell_i}\n    $$\n    由于接收面元构成了参数区间 $[0, L]$ 的一个完整划分，而该区间也同样被供给面元所覆盖，因此对于一个给定的供给面元 $i$，其与所有接收面元 $j$ 的重叠长度之和必须等于其自身长度：$\\sum_{j \\in R} \\ell_{ji} = \\ell_i$。这保证了映射矩阵的一个关键属性：\n    $$\n    \\sum_{j \\in R} W_{ji} = \\sum_{j \\in R} \\frac{\\ell_{ji}}{\\ell_i} = \\frac{1}{\\ell_i} \\sum_{j \\in R} \\ell_{ji} = \\frac{\\ell_i}{\\ell_i} = 1\n    $$\n    该属性是此方案守恒性质的基础。\n\n2.  **将通量分配给接收面元**：使用映射 $W$ 将来自供给侧的通量分配给接收面元。接收面元 $j$ 的分配通量是供给侧贡献的加权平均：\n    $$\n    F_m^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i)\n    $$\n    $$\n    \\mathbf{F}_{\\mathbf{p}}^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, \\mathbf{F}_{\\mathbf{p}}^{(d)}(i) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i) \\, \\mathbf{u}_i\n    $$\n    $$\n    F_E^{(r)}(j) = \\sum_{i \\in D} W_{ji} \\, F_E^{(d)}(i) = \\sum_{i \\in D} W_{ji} \\, F_m^{(d)}(i) \\, E_i\n    $$\n\n3.  **构建接收侧“幽灵”状态**：为确保分配的通量与接收面元的几何形状（$A_j$, $\\mathbf{n}_j$）一致，需要从分配的通量中反向工程出一个“幽灵”流动状态（$\\rho_j^{\\mathrm{ghost}}$, $\\mathbf{u}_j^{\\mathrm{ghost}}$, $E_j^{\\mathrm{ghost}}$）。\n    - 如果分配的质量通量 $|F_m^{(r)}(j)|$ 在数值上是显著的（大于一个小容差 $\\varepsilon$，例如 $10^{-12}$），则“幽灵”状态通过反转通量方程来定义：\n    $$\n    \\mathbf{u}_j^{\\mathrm{ghost}} = \\frac{\\mathbf{F}_{\\mathbf{p}}^{(r)}(j)}{F_m^{(r)}(j)}, \\quad\n    E_j^{\\mathrm{ghost}} = \\frac{F_E^{(r)}(j)}{F_m^{(r)}(j)}, \\quad\n    \\rho_j^{\\mathrm{ghost}} = \\frac{F_m^{(r)}(j)}{A_j \\, \\left(\\mathbf{u}_j^{\\mathrm{ghost}} \\cdot \\mathbf{n}_j\\right)}\n    $$\n    - 如果 $|F_m^{(r)}(j)| \\le \\varepsilon$，则通量被视为零，并将“幽灵”状态设为零，以避免除以零并保持一致性：$\\mathbf{u}_j^{\\mathrm{ghost}} = \\mathbf{0}$，$E_j^{\\mathrm{ghost}} = 0$，$\\rho_j^{\\mathrm{ghost}} = 0$。一个潜在的问题是，当 $F_m^{(r)}(j)$ 非零时，分母 $A_j \\, (\\mathbf{u}_j^{\\mathrm{ghost}} \\cdot \\mathbf{n}_j)$ 可能为零，问题描述中未明确处理此情况，但这代表了此特定幽灵状态构造方法的一个局限性。我们继续按给定的公式进行实现。\n\n4.  **验证守恒性**：最后一步是验证使用“幽灵”状态和接收侧几何计算出的通量是否与分配的通量相匹配，更重要的是，验证跨交界面的总通量是否守恒。\n    - 首先，我们计算接收侧的“校验”通量：\n    $$\n    F_m^{\\mathrm{check}}(j) = \\rho_j^{\\mathrm{ghost}} \\, \\left(\\mathbf{u}_j^{\\mathrm{ghost}} \\cdot \\mathbf{n}_j\\right) \\, A_j\n    $$\n    $$\n    \\mathbf{F}_{\\mathbf{p}}^{\\mathrm{check}}(j) = F_m^{\\mathrm{check}}(j) \\, \\mathbf{u}_j^{\\mathrm{ghost}}\n    $$\n    $$\n    F_E^{\\mathrm{check}}(j) = F_m^{\\mathrm{check}}(j) \\, E_j^{\\mathrm{ghost}}\n    $$\n    通过代入“幽灵”状态变量的定义，可以从代数上轻易证明 $F^{\\mathrm{check}}(j) = F^{(r)}(j)$ 对每个守恒量都成立，前提是“幽灵”状态构造中的分母不为零。\n    - 其次，我们通过对两侧所有面元的通量求和并比较总和来验证全局守恒。以质量为例：\n    $$\n    \\sum_{j \\in R} F_m^{\\mathrm{check}}(j) = \\sum_{j \\in R} F_m^{(r)}(j) = \\sum_{j \\in R} \\sum_{i \\in D} W_{ji} F_m^{(d)}(i) = \\sum_{i \\in D} F_m^{(d)}(i) \\left( \\sum_{j \\in R} W_{ji} \\right)\n    $$\n    由于 $\\sum_{j \\in R} W_{ji} = 1$，我们得到：\n    $$\n    \\sum_{j \\in R} F_m^{\\mathrm{check}}(j) = \\sum_{i \\in D} F_m^{(d)}(i)\n    $$\n    这表明总质量通量通过构造是守恒的。同样的逻辑也适用于动量和能量。程序将执行这些步骤，并使用 $10^{-9}$ 的数值容差比较供给侧通量总和与接收侧校验通量总和。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and verifies a conservative mapping for periodic boundary conditions\n    in computational fluid dynamics.\n    \"\"\"\n    \n    # Test case 1\n    donors1 = [\n        ([0.0, 0.5], 1.0, np.array([1.0, 0.0, 0.0]), 1.2, np.array([10.0, 2.0, 0.0]), 100000.0),\n        ([0.5, 0.75], 0.5, np.array([1.0, 0.0, 0.0]), 1.0, np.array([8.0, -1.0, 0.0]), 90000.0),\n        ([0.75, 1.0], 1.5, np.array([0.965925826, 0.258819045, 0.0]), 0.95, np.array([12.0, 0.5, 0.0]), 110000.0)\n    ]\n    receivers1 = [\n        ([0.0, 0.4], 0.8, np.array([-0.980580675, -0.196116135, 0.0])),\n        ([0.4, 1.0], 2.2, np.array([-1.0, 0.0, 0.0]))\n    ]\n\n    # Test case 2\n    donors2 = [\n        ([0.0, 0.6], 0.7, np.array([1.0, 0.0, 0.0]), 1.3, np.array([5.0, 0.0, 1.0]), 80000.0),\n        ([0.6, 1.5], 1.2, np.array([0.93969262, 0.342020143, 0.0]), 1.1, np.array([7.0, -0.5, 0.2]), 92000.0),\n        ([1.5, 2.0], 0.9, np.array([1.0, 0.0, 0.0]), 1.25, np.array([6.0, 0.2, -0.1]), 88000.0)\n    ]\n    receivers2 = [\n        ([0.0, 0.5], 0.6, np.array([-0.93969262, -0.342020143, 0.0])),\n        ([0.5, 1.2], 1.0, np.array([-1.0, 0.0, 0.0])),\n        ([1.2, 2.0], 1.2, np.array([-0.965925826, -0.258819045, 0.0]))\n    ]\n    \n    # Test case 3\n    donors3 = [\n        ([0.0, 0.3], 0.3, np.array([1.0, 0.0, 0.0]), 1.0, np.array([2.0, 0.0, 0.0]), 50000.0),\n        ([0.3, 0.7], 1.7, np.array([1.0, 0.0, 0.0]), 1.0, np.array([0.1, 4.0, 0.0]), 55000.0),\n        ([0.7, 1.0], 0.5, np.array([0.965925826, 0.258819045, 0.0]), 1.0, np.array([0.01, 0.1, 0.0]), 50000.0),\n    ]\n    receivers3 = [\n        ([0.0, 0.2], 0.2, np.array([-1.0, 0.0, 0.0])),\n        ([0.2, 0.6], 1.6, np.array([-0.999847695, -0.017452406, 0.0])),\n        ([0.6, 1.0], 0.7, np.array([-0.984807753, -0.173648178, 0.0]))\n    ]\n    \n    # Test case 4\n    donors4 = [\n        ([0.0, 0.5], 0.4, np.array([1.0, 0.0, 0.0]), 1.2, np.array([-3.0, 0.0, 0.0]), 60000.0),\n        ([0.5, 1.0], 0.8, np.array([0.965925826, 0.258819045, 0.0]), 1.0, np.array([3.0, 1.0, 0.0]), 70000.0),\n        ([1.0, 1.5], 0.5, np.array([1.0, 0.0, 0.0]), 1.1, np.array([0.0, 2.0, 0.0]), 65000.0)\n    ]\n    receivers4 = [\n        ([0.0, 0.3], 0.3, np.array([-1.0, 0.0, 0.0])),\n        ([0.3, 1.2], 1.4, np.array([-0.965925826, -0.258819045, 0.0])),\n        ([1.2, 1.5], 0.5, np.array([-1.0, 0.0, 0.0]))\n    ]\n\n    test_cases = [\n        (donors1, receivers1),\n        (donors2, receivers2),\n        (donors3, receivers3),\n        (donors4, receivers4),\n    ]\n\n    results = []\n    # Tolerance for checking if a mass flux is effectively zero\n    epsilon_flux = 1e-12 \n    # Tolerance for global conservation check\n    conservation_tol = 1e-9\n\n    for donors_data, receivers_data in test_cases:\n        num_donors = len(donors_data)\n        num_receivers = len(receivers_data)\n\n        # Step 1: Compute donor convective fluxes\n        F_m_d = np.zeros(num_donors)\n        F_p_d = np.zeros((num_donors, 3))\n        F_E_d = np.zeros(num_donors)\n\n        for i, data in enumerate(donors_data):\n            _, A, n, rho, u, E = data\n            F_m_d[i] = rho * np.dot(u, n) * A\n            F_p_d[i, :] = F_m_d[i] * u\n            F_E_d[i] = F_m_d[i] * E\n\n        # Step 2: Construct the mapping matrix W\n        W = np.zeros((num_receivers, num_donors))\n        for j, r_data in enumerate(receivers_data):\n            s_j0, s_j1 = r_data[0]\n            for i, d_data in enumerate(donors_data):\n                s_i0, s_i1 = d_data[0]\n                ell_i = s_i1 - s_i0\n                overlap_length = max(0.0, min(s_i1, s_j1) - max(s_i0, s_j0))\n                if ell_i > 0:\n                    W[j, i] = overlap_length / ell_i\n\n        # Step 3: Compute receiver-assigned fluxes\n        F_m_r = W @ F_m_d\n        F_p_r = W @ F_p_d\n        F_E_r = W @ F_E_d\n\n        # Step 4: Construct ghost states on receiver faces\n        rho_ghost = np.zeros(num_receivers)\n        u_ghost = np.zeros((num_receivers, 3))\n        E_ghost = np.zeros(num_receivers)\n\n        for j in range(num_receivers):\n            if abs(F_m_r[j]) > epsilon_flux:\n                u_ghost[j, :] = F_p_r[j, :] / F_m_r[j]\n                E_ghost[j] = F_E_r[j] / F_m_r[j]\n                \n                _, A_j, n_j = receivers_data[j]\n                \n                denominator = A_j * np.dot(u_ghost[j, :], n_j)\n                if abs(denominator) > epsilon_flux:\n                    rho_ghost[j] = F_m_r[j] / denominator\n                else:\n                    # This case implies the constructed velocity is tangent to the face,\n                    # or the area is zero. The resulting check flux will be zero.\n                    rho_ghost[j] = 0.0 # Effectively makes check flux zero\n            # else block is implicitly handled by numpy zeros initialization\n\n        # Step 5: Verify fluxes and global conservation\n        F_m_check = np.zeros(num_receivers)\n        F_p_check = np.zeros((num_receivers, 3))\n        F_E_check = np.zeros(num_receivers)\n        \n        for j in range(num_receivers):\n            _, A_j, n_j = receivers_data[j]\n            F_m_check[j] = rho_ghost[j] * np.dot(u_ghost[j, :], n_j) * A_j\n            F_p_check[j, :] = F_m_check[j] * u_ghost[j, :]\n            F_E_check[j] = F_m_check[j] * E_ghost[j]\n\n        # Compare sum of donor fluxes with sum of receiver check fluxes\n        is_mass_conserved = np.isclose(np.sum(F_m_d), np.sum(F_m_check), atol=conservation_tol, rtol=0)\n        is_momentum_conserved = np.allclose(np.sum(F_p_d, axis=0), np.sum(F_p_check, axis=0), atol=conservation_tol, rtol=0)\n        is_energy_conserved = np.isclose(np.sum(F_E_d), np.sum(F_E_check), atol=conservation_tol, rtol=0)\n\n        results.append([is_mass_conserved, is_momentum_conserved, is_energy_conserved])\n    \n    # Format according to Python's default list-of-lists representation\n    print(str(results).replace(\"'\", \"\"))\n\nsolve()\n\n```"
        }
    ]
}