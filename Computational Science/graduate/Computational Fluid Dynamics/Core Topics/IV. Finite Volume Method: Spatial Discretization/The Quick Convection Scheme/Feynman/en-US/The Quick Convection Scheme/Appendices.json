{
    "hands_on_practices": [
        {
            "introduction": "The standard formulation of the QUICK scheme applies to interior cells where the required upwind-biased stencil is readily available. This practice explores the necessary adaptation of the scheme at a boundary, a common scenario in practical CFD problems. By deriving the interpolation weights for a stencil that includes an inflow Dirichlet boundary condition, you will directly confront the issue of negative weights and the potential for non-physical oscillations, and then apply a simple but effective modification to enforce boundedness .",
            "id": "3378422",
            "problem": "Consider one-dimensional steady convection of a passive scalar on a uniform mesh with cell centers located at positions $x_{i} = \\left(i - \\tfrac{1}{2}\\right)\\Delta x$ for $i \\in \\mathbb{N}$, where $\\Delta x > 0$. The left boundary is at $x = 0$ and imposes an inflow Dirichlet condition $\\phi(0) = \\phi_{\\Gamma}$. Let the velocity be strictly positive, $u > 0$, so that the upwind direction is from left to right. Denote the first interior cell center by $P$ at $x_{P} = \\tfrac{1}{2}\\Delta x$, the second by $E$ at $x_{E} = \\tfrac{3}{2}\\Delta x$, and the first interior face by $f$ at $x_{f} = \\Delta x$ between $P$ and $E$. Using the Quadratic Upwind Interpolation for Convective Kinematics (QUICK) principle of constructing a quadratic interpolant through three upwind-biased points, employ the inflow Dirichlet boundary value at $x = 0$, together with the values at $x_{P}$ and $x_{E}$, to form a quadratic approximation of $\\phi(x)$ and evaluate it at $x_{f}$. \n\n1. Derive the interpolation weights $w_{\\Gamma}$, $w_{P}$, and $w_{E}$ such that the QUICK face value satisfies $\\phi_{f} = w_{\\Gamma}\\,\\phi_{\\Gamma} + w_{P}\\,\\phi_{P} + w_{E}\\,\\phi_{E}$.\n\n2. Impose a minimal boundedness modification: set any negative interpolation weights to zero and renormalize the remaining weights so that they sum to $1$. Express the resulting bounded modified QUICK face value $\\phi_{f}^{\\text{mod}}$ solely in terms of $\\phi_{P}$ and $\\phi_{E}$.\n\n3. Briefly analyze whether the modified face value is bounded relative to pure upwind for $u > 0$, where pure upwind gives $\\phi_{f}^{\\text{up}} = \\phi_{P}$.\n\nYour final answer must be the single closed-form expression for $\\phi_{f}^{\\text{mod}}$ obtained in step 2. No rounding is required, and no units are necessary.",
            "solution": "The problem asks for the derivation and analysis of a modified Quadratic Upwind Interpolation for Convective Kinematics (QUICK) scheme at a boundary. The solution is structured in three parts as requested.\n\n### Part 1: Derivation of QUICK Interpolation Weights\n\nThe QUICK scheme constructs a quadratic interpolating polynomial, $\\phi(x)$, through three appropriately chosen points. For the face $f$ located at $x_{f} = \\Delta x$, which is between cell centers $P$ and $E$, with a strictly positive velocity $u > 0$, the upwind direction is from left to right. The problem specifies using the nodal values at the upwind cell $P$ ($x_{P} = \\frac{1}{2}\\Delta x$), the downstream cell $E$ ($x_{E} = \\frac{3}{2}\\Delta x$), and the Dirichlet boundary value at the inlet boundary $\\Gamma$ ($x_{\\Gamma} = 0$). The corresponding values of the scalar field are $\\phi_{P}$, $\\phi_{E}$, and $\\phi_{\\Gamma}$.\n\nLet the quadratic interpolant be of the form $\\phi(x) = ax^2 + bx + c$. To simplify the algebra, we introduce a normalized coordinate $\\xi = x/\\Delta x$. The three interpolation points in this coordinate system are:\n- At the boundary $\\Gamma$: $\\xi_{\\Gamma} = 0$, with value $\\phi_{\\Gamma}$.\n- At the cell center $P$: $\\xi_{P} = \\frac{1}{2}$, with value $\\phi_{P}$.\n- At the cell center $E$: $\\xi_{E} = \\frac{3}{2}$, with value $\\phi_{E}$.\n\nThe interpolant is to be evaluated at the face $f$, which is at location $\\xi_{f} = 1$.\n\nWe can use Lagrange interpolation to find the value at $\\xi_{f} = 1$ directly. The interpolated value $\\phi_f$ is a linear combination of the nodal values:\n$$ \\phi_f = L_{\\Gamma}(\\xi_f)\\phi_{\\Gamma} + L_{P}(\\xi_f)\\phi_{P} + L_{E}(\\xi_f)\\phi_{E} $$\nThe coefficients $L_i(\\xi_f)$ are the interpolation weights $w_i$.\n\nThe Lagrange basis polynomials evaluated at $\\xi_f = 1$ are:\n- For the boundary point $\\Gamma$:\n$$ w_{\\Gamma} = L_{\\Gamma}(1) = \\frac{(1 - \\xi_{P})(1 - \\xi_{E})}{(\\xi_{\\Gamma} - \\xi_{P})(\\xi_{\\Gamma} - \\xi_{E})} = \\frac{(1 - \\frac{1}{2})(1 - \\frac{3}{2})}{(0 - \\frac{1}{2})(0 - \\frac{3}{2})} = \\frac{(\\frac{1}{2})(-\\frac{1}{2})}{(-\\frac{1}{2})(-\\frac{3}{2})} = \\frac{-\\frac{1}{4}}{\\frac{3}{4}} = -\\frac{1}{3} $$\n- For the cell center $P$:\n$$ w_{P} = L_{P}(1) = \\frac{(1 - \\xi_{\\Gamma})(1 - \\xi_{E})}{(\\xi_{P} - \\xi_{\\Gamma})(\\xi_{P} - \\xi_{E})} = \\frac{(1 - 0)(1 - \\frac{3}{2})}{(\\frac{1}{2} - 0)(\\frac{1}{2} - \\frac{3}{2})} = \\frac{(1)(-\\frac{1}{2})}{(\\frac{1}{2})(-1)} = \\frac{-\\frac{1}{2}}{-\\frac{1}{2}} = 1 $$\n- For the cell center $E$:\n$$ w_{E} = L_{E}(1) = \\frac{(1 - \\xi_{\\Gamma})(1 - \\xi_{P})}{(\\xi_{E} - \\xi_{\\Gamma})(\\xi_{E} - \\xi_{P})} = \\frac{(1 - 0)(1 - \\frac{1}{2})}{(\\frac{3}{2} - 0)(\\frac{3}{2} - \\frac{1}{2})} = \\frac{(1)(\\frac{1}{2})}{(\\frac{3}{2})(1)} = \\frac{\\frac{1}{2}}{\\frac{3}{2}} = \\frac{1}{3} $$\nThe resulting face value is:\n$$ \\phi_f = w_{\\Gamma}\\phi_{\\Gamma} + w_{P}\\phi_{P} + w_{E}\\phi_{E} = -\\frac{1}{3}\\phi_{\\Gamma} + 1\\cdot\\phi_{P} + \\frac{1}{3}\\phi_{E} $$\n\n### Part 2: Bounded Modified QUICK Face Value\n\nThe standard QUICK interpolation is not guaranteed to be bounded, meaning it can produce unphysical oscillations (overshoots or undershoots). This is due to the presence of negative interpolation weights. In our case, $w_{\\Gamma} = -1/3$.\n\nThe problem specifies a modification to enforce boundedness: set any negative weights to zero and renormalize the remaining weights to sum to $1$.\nThe original weights are $w_{\\Gamma} = -1/3$, $w_{P} = 1$, and $w_{E} = 1/3$.\nSetting the negative weight to zero gives the unnormalized modified weights:\n$$ w'_{\\Gamma, \\text{un}} = 0, \\quad w'_{P, \\text{un}} = w_{P} = 1, \\quad w'_{E, \\text{un}} = w_{E} = \\frac{1}{3} $$\nThe sum of the remaining non-negative weights is $S = w_{P} + w_{E} = 1 + \\frac{1}{3} = \\frac{4}{3}$.\nWe renormalize by dividing by this sum:\n$$ w'_{\\Gamma} = 0 $$\n$$ w'_{P} = \\frac{w_{P}}{S} = \\frac{1}{4/3} = \\frac{3}{4} $$\n$$ w'_{E} = \\frac{w_{E}}{S} = \\frac{1/3}{4/3} = \\frac{1}{4} $$\nThe modified face value, $\\phi_{f}^{\\text{mod}}$, is calculated using these new weights:\n$$ \\phi_{f}^{\\text{mod}} = w'_{\\Gamma}\\phi_{\\Gamma} + w'_{P}\\phi_{P} + w'_{E}\\phi_{E} = 0 \\cdot \\phi_{\\Gamma} + \\frac{3}{4}\\phi_{P} + \\frac{1}{4}\\phi_{E} $$\nAs requested, this expression for the modified face value is solely in terms of $\\phi_{P}$ and $\\phi_{E}$:\n$$ \\phi_{f}^{\\text{mod}} = \\frac{3}{4}\\phi_{P} + \\frac{1}{4}\\phi_{E} $$\n\n### Part 3: Analysis of Boundedness\n\nThe pure upwind scheme for $u > 0$ uses the value from the upwind cell center, $P$. Thus, the pure upwind face value is:\n$$ \\phi_{f}^{\\text{up}} = \\phi_{P} $$\nPure upwind is a first-order accurate scheme known for its robustness and for being unconditionally bounded (it never creates new extrema), although it introduces significant numerical diffusion.\n\nThe modified face value is $\\phi_{f}^{\\text{mod}} = \\frac{3}{4}\\phi_{P} + \\frac{1}{4}\\phi_{E}$. This is a weighted average of the values at the bounding cell centers, $\\phi_{P}$ and $\\phi_{E}$. The weights, $w'_{P} = 3/4$ and $w'_{E} = 1/4$, are both positive and sum to unity ($w'_{P} + w'_{E} = 1$). This means $\\phi_{f}^{\\text{mod}}$ is a convex combination of $\\phi_{P}$ and $\\phi_{E}$. A mathematical property of a convex combination is that its value is guaranteed to lie between the values being combined. That is:\n$$ \\min(\\phi_{P}, \\phi_{E}) \\le \\phi_{f}^{\\text{mod}} \\le \\max(\\phi_{P}, \\phi_{E}) $$\nThis demonstrates that the modified scheme is bounded at this face; it will not generate local overshoots or undershoots relative to its neighboring cell values. The modification procedure has successfully replaced the non-bounded quadratic interpolation with a bounded linear interpolation. This resulting scheme retains a higher order of accuracy than the first-order pure upwind scheme while ensuring boundedness, which the original QUICK scheme lacks.",
            "answer": "$$\\boxed{\\frac{3}{4}\\phi_{P} + \\frac{1}{4}\\phi_{E}}$$"
        },
        {
            "introduction": "While QUICK's third-order accuracy is appealing, its primary drawback is its non-monotonic nature, which can lead to unphysical overshoots and undershoots near steep gradients. This hands-on coding exercise provides a direct and quantitative demonstration of this behavior. By implementing the pure, unlimited QUICK scheme for the linear advection of a step discontinuity, you will visualize and measure the magnitude of these oscillations, gaining a clear and practical understanding of why flux limiters are essential companions to higher-order schemes like QUICK .",
            "id": "3378488",
            "problem": "Consider the one-dimensional linear advection equation on a periodic domain of length $L=1$,\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\nwith constant advection speed $a \\in \\mathbb{R}$. Let the domain be discretized into $N$ uniform finite-volume cells with cell centers at $x_i$ and spacing $\\Delta x = L/N$. Define the Courant number $\\nu$ by $\\nu = \\frac{|a| \\Delta t}{\\Delta x}$, where $\\Delta t$ is the time step. Use an explicit one-step update for the cell averages $u_i^n$ to compute $u_i^{n+1}$ from $u_i^n$ by a conservative finite-volume method.\n\nYour task is to:\n- Derive, from first principles, the pure Quadratic Upstream Interpolation for Convective Kinematics (QUICK) face interpolation for a uniform grid, and construct the corresponding explicit finite-volume update formula for one time step. The interpolation must be purely upwind-biased without any flux limiter or clipping.\n- Apply the derived scheme to a piecewise-constant initial condition that contains a single discontinuity at location $x_0$:\n$$\nu(x,0) = \\begin{cases}\nu_L,  0 \\le x  x_0, \\\\\nu_R,  x_0 \\le x  L,\n\\end{cases}\n$$\nwith periodic boundary conditions. The piecewise-constant profile is discretized by assigning $u_i^0 = u_L$ for cells with $x_i  x_0$ and $u_i^0 = u_R$ otherwise. Assume that $x_0$ lies exactly on a cell face to create a clean cell-to-cell jump.\n- For each parameter set in the test suite, perform exactly one explicit time step with the pure QUICK scheme and quantify the overshoot magnitude relative to the jump. Define the jump amplitude $J$ as $J = |u_L - u_R|$. Define the overshoot magnitude relative to the jump as\n$$\nR = \\begin{cases}\n\\displaystyle \\frac{\\max\\{u_i^{n+1}\\} - \\max(u_L,u_R)}{J},  \\text{if } \\max\\{u_i^{n+1}\\}  \\max(u_L,u_R), \\\\\n\\displaystyle \\frac{\\min(u_L,u_R) - \\min\\{u_i^{n+1}\\}}{J},  \\text{if } \\min\\{u_i^{n+1}\\}  \\min(u_L,u_R), \\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nwhich captures the maximum violation of the physical bounds normalized by the jump amplitude. Report $R$ as a real number (unitless).\n\nUse the following test suite (each case specifies $N$, $a$, $\\nu$, $u_L$, $u_R$, $x_0$), where all quantities are real numbers and $x_0$ is interpreted as a physical location in $[0,1)$:\n1. Case A: $N=64$, $a=1.0$, $\\nu=0.5$, $u_L=1.0$, $u_R=0.0$, $x_0=0.5$.\n2. Case B: $N=64$, $a=1.0$, $\\nu=0.1$, $u_L=1.0$, $u_R=0.0$, $x_0=0.5$.\n3. Case C: $N=64$, $a=1.0$, $\\nu=0.5$, $u_L=0.0$, $u_R=1.0$, $x_0=0.5$.\n4. Case D: $N=64$, $a=-1.0$, $\\nu=0.5$, $u_L=1.0$, $u_R=0.0$, $x_0=0.5$.\n5. Case E: $N=64$, $a=1.0$, $\\nu=0.5$, $u_L=1.0$, $u_R=0.9$, $x_0=0.5$.\n\nImplementation details and constraints:\n- The discretization must be conservative and use the pure QUICK interpolation to approximate the advected quantity at each face.\n- Enforce periodic boundary conditions by cyclically wrapping any stencil indices.\n- Perform exactly one time step for each case with the specified Courant number. The time step size satisfies $\\Delta t = \\nu\\,\\Delta x/|a|$ for each case.\n- For each case, compute and store the overshoot ratio $R$ as specified above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the five test cases as a comma-separated list enclosed in square brackets, for example, \"[rA,rB,rC,rD,rE]\". Each entry should be a real number. No additional text or whitespace is permitted in the output.",
            "solution": "The user requests a solution to a one-dimensional linear advection problem using the pure QUICK scheme. The primary tasks are to derive the scheme, implement it for a step-function initial condition, and quantify the numerical overshoot/undershoot after a single time step for several test cases.\n\n### Step 1: Derivation of the QUICK Finite-Volume Scheme\n\nThe one-dimensional linear advection equation is given by\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is the advected quantity and $a$ is the constant advection speed. Since $a$ is constant, we can write the equation in conservative form as:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f}{\\partial x} = 0, \\quad \\text{where the flux is } f = au.\n$$\nWe discretize the spatial domain $x \\in [0, L)$ into $N$ uniform cells of width $\\Delta x = L/N$. The $i$-th cell, $C_i$, spans the interval $[x_{i-1/2}, x_{i+1/2}]$, with its center at $x_i$. The cell-averaged value is $u_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) dx$.\n\nIntegrating the conservative form over cell $C_i$ yields:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial u}{\\partial t} dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial f}{\\partial x} dx = 0\n$$\n$$\n\\Delta x \\frac{d u_i}{d t} + f(x_{i+1/2}, t) - f(x_{i-1/2}, t) = 0\n$$\nDenoting the fluxes at the cell faces as $f_{i+1/2}$ and $f_{i-1/2}$, we have:\n$$\n\\frac{d u_i}{d t} = - \\frac{f_{i+1/2} - f_{i-1/2}}{\\Delta x}\n$$\nApplying an explicit forward Euler scheme for time integration from $t^n$ to $t^{n+1} = t^n + \\Delta t$, we get the update formula for the cell average $u_i^n \\approx u_i(t^n)$:\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = - \\frac{f_{i+1/2}^n - f_{i-1/2}^n}{\\Delta x}\n$$\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (f_{i+1/2}^n - f_{i-1/2}^n)\n$$\nSince $f = au$, the fluxes are $f_{i \\pm 1/2}^n = a u_{i \\pm 1/2}^n$, where $u_{i \\pm 1/2}^n$ is the value of the quantity $u$ at the cell face at time $t^n$. The core of the scheme is to determine this face value.\n\nThe Quadratic Upstream Interpolation for Convective Kinematics (QUICK) scheme approximates the face value by fitting a quadratic polynomial to three cell-centered values. The choice of these three points is biased towards the upstream direction of the flow.\n\nLet's derive the interpolation polynomial. For a uniform grid, we can fit a parabola $P(\\xi) = c_0 + c_1 \\xi + c_2 \\xi^2$ to three points. To find the value at face $i+1/2$, located at a physical coordinate midway between $x_i$ and $x_{i+1}$, the standard QUICK scheme uses the cell-centered values $u_{i-1}$, $u_i$, and $u_{i+1}$. By setting a local coordinate system with its origin at $x_i$ (so $\\xi_i=0$, $\\xi_{i-1}=-\\Delta x$, $\\xi_{i+1}=\\Delta x$), the parabola passing through $(-\\Delta x, u_{i-1})$, $(0, u_i)$, and $(\\Delta x, u_{i+1})$ is:\n$$\nP(\\xi) = u_i + \\frac{u_{i+1}-u_{i-1}}{2\\Delta x}\\xi + \\frac{u_{i+1}-2u_i+u_{i-1}}{2\\Delta x^2}\\xi^2\n$$\nThe \"upstream\" nature of QUICK dictates which three-point stencil is used to evaluate the value at a face, depending on the sign of the advection velocity $a$.\n\n**Case 1: Advection is to the right ($a > 0$)**\nThe flow is from left to right.\n-   To find $u_{i+1/2}$, the value at the right face of cell $i$, we use the upstream-biased stencil of points centered around the face: $u_{i-1}$, $u_i$, $u_{i+1}$. The face is at $\\xi = \\Delta x / 2$. Evaluating the polynomial $P(\\xi)$ at this location gives:\n    $$\n    u_{i+1/2} = P(\\Delta x/2) = u_i + \\frac{u_{i+1}-u_{i-1}}{4} + \\frac{u_{i+1}-2u_i+u_{i-1}}{8} = \\frac{3}{8}u_{i+1} + \\frac{6}{8}u_i - \\frac{1}{8}u_{i-1}\n    $$\n-   To find $u_{i-1/2}$, the value at the left face of cell $i$, we shift the indices of the above formula by $-1$:\n    $$\n    u_{i-1/2} = \\frac{3}{8}u_{i} + \\frac{6}{8}u_{i-1} - \\frac{1}{8}u_{i-2}\n    $$\nThe flux difference across cell $i$ is $a(u_{i+1/2}^n - u_{i-1/2}^n)$. Let $\\nu = \\frac{a \\Delta t}{\\Delta x}$ (since $a>0$, $|a|=a$). The update formula is:\n$$\nu_i^{n+1} = u_i^n - \\nu \\left( \\left[\\frac{3}{8}u_{i+1}^n + \\frac{6}{8}u_i^n - \\frac{1}{8}u_{i-1}^n\\right] - \\left[\\frac{3}{8}u_{i}^n + \\frac{6}{8}u_{i-1}^n - \\frac{1}{8}u_{i-2}^n\\right] \\right)\n$$\n$$\nu_i^{n+1} = u_i^n - \\nu \\left( \\frac{3}{8}u_{i+1}^n + \\frac{3}{8}u_i^n - \\frac{7}{8}u_{i-1}^n + \\frac{1}{8}u_{i-2}^n \\right)\n$$\n\n**Case 2: Advection is to the left ($a  0$)**\nThe flow is from right to left. The upstream direction is to the right.\n-   To find $u_{i+1/2}$, we use the upstream-biased stencil $\\{u_i, u_{i+1}, u_{i+2}\\}$. The interpolation formula, derived by fitting a parabola through these points and evaluating at the face, is:\n    $$\n    u_{i+1/2} = \\frac{3}{8}u_{i} + \\frac{6}{8}u_{i+1} - \\frac{1}{8}u_{i+2}\n    $$\n-   To find $u_{i-1/2}$, we shift the indices by $-1$:\n    $$\n    u_{i-1/2} = \\frac{3}{8}u_{i-1} + \\frac{6}{8}u_{i} - \\frac{1}{8}u_{i+1}\n    $$\nLet $\\nu = \\frac{|a| \\Delta t}{\\Delta x} = \\frac{-a \\Delta t}{\\Delta x}$, so $\\frac{a \\Delta t}{\\Delta x} = -\\nu$. The update formula is:\n$$\nu_i^{n+1} = u_i^n + \\nu (u_{i+1/2}^n - u_{i-1/2}^n)\n$$\n$$\nu_i^{n+1} = u_i^n + \\nu \\left( \\left[\\frac{3}{8}u_i^n + \\frac{6}{8}u_{i+1}^n - \\frac{1}{8}u_{i+2}^n\\right] - \\left[\\frac{3}{8}u_{i-1}^n + \\frac{6}{8}u_i^n - \\frac{1}{8}u_{i+1}^n\\right] \\right)\n$$\n$$\nu_i^{n+1} = u_i^n + \\nu \\left( -\\frac{1}{8}u_{i+2}^n + \\frac{7}{8}u_{i+1}^n - \\frac{3}{8}u_i^n - \\frac{3}{8}u_{i-1}^n \\right)\n$$\n\n### Step 2: Implementation and Overshoot Calculation\n\nThe derived update formulas are implemented for a single time step. The domain is periodic, so stencil indices that go out of bounds $\\{0, \\dots, N-1\\}$ are wrapped around. This is efficiently handled in `numpy` using `np.roll`.\n\nThe initial condition is a piecewise-constant function with a single jump at $x_0$, which lies on a cell face. For $N=64$ and $x_0=0.5$, the jump is between cell $i=31$ and $i=32$. The initial array $u^0$ is constructed accordingly.\n\nAfter computing the updated state $u^{n+1}$, the overshoot/undershoot ratio $R$ is calculated. The problem defines $R$ with a specific conditional logic:\n1.  If the new maximum $\\max\\{u_i^{n+1}\\}$ exceeds the initial maximum $\\max(u_L, u_R)$, the overshoot is computed and returned.\n2.  Otherwise, if the new minimum $\\min\\{u_i^{n+1}\\}$ is below the initial minimum $\\min(u_L, u_R)$, the undershoot is computed and returned.\n3.  Otherwise, the violation is zero.\n\nThis `if-elif-else` structure gives priority to reporting overshoots. If both overshoots and undershoots are present, only the value of $R$ corresponding to the overshoot is reported, regardless of the magnitude of the undershoot. This logic is followed precisely in the implementation.\n\nThe analytical forms of the overshoot/undershoot for a unit step profile with the QUICK scheme are well-known and depend on the Courant number $\\nu$. For a rising step ($u_L=1, u_R=0$) and $a>0$, the scheme produces an overshoot of magnitude $3\\nu/8$ and an undershoot of magnitude $\\nu/8$. For a falling step ($u_L=0, u_R=1$) and $a>0$, it produces an undershoot of $3\\nu/8$ and an overshoot of $\\nu/8$. The behavior for $a0$ is spatially mirrored. The provided code numerically computes these values for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef run_quick_step(N, a, nu, u_L, u_R, x_0):\n    \"\"\"\n    Performs one time step of the pure QUICK scheme for 1D linear advection.\n\n    Args:\n        N (int): Number of cells.\n        a (float): Advection speed.\n        nu (float): Courant number, |a|*dt/dx.\n        u_L (float): Left state of the initial step.\n        u_R (float): Right state of the initial step.\n        x_0 (float): Location of the discontinuity.\n\n    Returns:\n        float: The overshoot/undershoot ratio R.\n    \"\"\"\n    # 1. Grid and Initial Condition Setup\n    L = 1.0\n    dx = L / N\n    # Cell centers\n    x = (np.arange(N) + 0.5) * dx\n    \n    # Piecewise-constant initial condition\n    u0 = np.where(x  x_0, u_L, u_R)\n    \n    # 2. Apply QUICK Scheme for one time step\n    u1 = np.zeros_like(u0)\n\n    if a > 0:\n        # Stencil for a > 0: u_i-2, u_i-1, u_i, u_i+1\n        # u_new[i] = u_old[i] - nu * (3/8*u_old[i+1] + 3/8*u_old[i] - 7/8*u_old[i-1] + 1/8*u_old[i-2])\n        u_im2 = np.roll(u0, 2)\n        u_im1 = np.roll(u0, 1)\n        u_ip1 = np.roll(u0, -1)\n        \n        flux_diff = (3/8 * u_ip1) + (3/8 * u0) - (7/8 * u_im1) + (1/8 * u_im2)\n        u1 = u0 - nu * flux_diff\n    \n    elif a  0:\n        # Stencil for a  0: u_i-1, u_i, u_i+1, u_i+2\n        # u_new[i] = u_old[i] + nu * (-1/8*u_old[i+2] + 7/8*u_old[i+1] - 3/8*u_old[i] - 3/8*u_old[i-1])\n        u_im1 = np.roll(u0, 1)\n        u_ip1 = np.roll(u0, -1)\n        u_ip2 = np.roll(u0, -2)\n        \n        flux_diff = (-1/8 * u_ip2) + (7/8 * u_ip1) - (3/8 * u0) - (3/8 * u_im1)\n        u1 = u0 + nu * flux_diff\n    else: # a == 0\n        u1 = u0\n\n    # 3. Calculate Overshoot/Undershoot Ratio R\n    J = abs(u_L - u_R)\n    if J == 0:\n        return 0.0\n\n    u_max_bounds = max(u_L, u_R)\n    u_min_bounds = min(u_L, u_R)\n\n    u_max_global = np.max(u1)\n    u_min_global = np.min(u1)\n\n    R = 0.0\n    # The problem defines R with a specific if/elif/else structure.\n    # This prioritizes reporting overshoots. If both are present,\n    # the overshoot-based R is reported.\n    if u_max_global > u_max_bounds:\n        R = (u_max_global - u_max_bounds) / J\n    elif u_min_global  u_min_bounds:\n        R = (u_min_bounds - u_min_global) /J\n    \n    return R\n\ndef solve():\n    \"\"\"\n    Main solver function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, a, nu, u_L, u_R, x_0)\n        (64, 1.0, 0.5, 1.0, 0.0, 0.5), # Case A\n        (64, 1.0, 0.1, 1.0, 0.0, 0.5), # Case B\n        (64, 1.0, 0.5, 0.0, 1.0, 0.5), # Case C\n        (64, -1.0, 0.5, 1.0, 0.0, 0.5),# Case D\n        (64, 1.0, 0.5, 1.0, 0.9, 0.5)  # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        N, a, nu, u_L, u_R, x_0 = case\n        result = run_quick_step(N, a, nu, u_L, u_R, x_0)\n        results.append(result)\n\n    # Format output as a comma-separated list in brackets\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established that the pure QUICK scheme can violate physical bounds, this practice delves into common strategies to remedy the issue. You will implement and compare two distinct approaches: a conservative, face-level flux clipping method and a non-conservative, post-update cell value clipping. This exercise illuminates the critical trade-off between enforcing a strict maximum principle and maintaining discrete mass conservation, offering valuable insight into the design choices and compromises inherent in developing robust numerical methods for transport equations .",
            "id": "3378470",
            "problem": "Consider the constant-velocity linear advection equation in one spatial dimension,\n$$\n\\partial_t \\phi(x,t) + u\\,\\partial_x \\phi(x,t) = 0,\n$$\nposed on the periodic domain $[0,1)$ with a spatially uniform and time-independent velocity $u>0$. Discretize the domain into $N_x$ uniform finite-volume cells of width $\\Delta x = 1/N_x$ with periodic indexing. Use an explicit time discretization with time step $\\Delta t = \\mathrm{CFL}\\,\\Delta x/u$, where $\\mathrm{CFL}\\in(0,1)$ is the Courant number. The unknown is the cell-average $\\phi_i^n$ at time level $t^n=n\\,\\Delta t$ for cell index $i\\in\\{0,1,\\dots,N_x-1\\}$. The finite-volume update is\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\Big),\n$$\nwhere $F_{i+\\frac{1}{2}}^n = u\\,\\phi_{i+\\frac{1}{2}}^n$ is the numerical convective flux through face $i+\\tfrac{1}{2}$ at time $t^n$ and all indices are periodic.\n\nUse Quadratic Upstream Interpolation for Convective Kinematics (QUICK) to approximate face states $\\phi_{i+\\frac{1}{2}}^n$ on a uniform grid. For $u>0$, the face state at $i+\\tfrac{1}{2}$ at time $t^n$ uses the upwind-biased quadratic reconstruction through the three-point stencil $\\{i-1,i,i+1\\}$:\n$$\n\\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n} = -\\frac{1}{8}\\phi_{i-1}^n + \\frac{6}{8}\\phi_{i}^n + \\frac{3}{8}\\phi_{i+1}^n.\n$$\nDefine the initial condition as a bounded Gaussian with unit peak and finite width, centered at $x_0\\in[0,1)$, made periodic by using the geodesic distance on the circle:\n$$\n\\phi(x,0) = \\exp\\!\\left(-\\frac{d(x,x_0)^2}{2\\sigma^2}\\right),\\quad d(x,x_0) = \\min_{k\\in\\mathbb{Z}} |x - x_0 + k|.\n$$\nThis implies $0\\phi(x,0]\\le 1$ for all $x$. Initialize cell-averaged values by sampling the cell-center values $\\phi_i^0=\\phi(x_i,0)$ with $x_i=(i+\\tfrac{1}{2})\\Delta x$. Advance the solution for $n_t=\\mathrm{round}(N_x/\\mathrm{CFL})$ time steps, which corresponds to approximately one flow-through time $t\\approx 1/u$.\n\nYour tasks are the following, each to be implemented and tested in a single program:\n\n- Implement the baseline QUICK scheme (no limiting) using the face state formula above. Record the maximum overshoot and undershoot at the final time:\n  $$\n  \\epsilon_+^{\\mathrm{base}} = \\max\\!\\left\\{0,\\ \\max_i \\phi_i^{n_t} - 1\\right\\},\\quad\n  \\epsilon_-^{\\mathrm{base}} = \\max\\!\\left\\{0,\\ -\\min_i \\phi_i^{n_t}\\right\\}.\n  $$\n  Compute the conservation error in discrete mass between the final and initial time levels,\n  $$\n  \\Delta M^{\\mathrm{base}} = \\sum_{i=0}^{N_x-1} \\phi_i^{n_t} - \\sum_{i=0}^{N_x-1} \\phi_i^{0}.\n  $$\n- Propose and implement a flux clipping strategy that enforces a discrete maximum principle at the face level without destroying conservation. Specifically, for each face $i+\\tfrac{1}{2}$ at time $t^n$ with $u>0$, define local stencil bounds\n  $$\n  \\phi_{\\min}^{(i+\\frac{1}{2}),n} = \\min\\{\\phi_{i-1}^n,\\phi_{i}^n,\\phi_{i+1}^n\\},\\quad\n  \\phi_{\\max}^{(i+\\frac{1}{2}),n} = \\max\\{\\phi_{i-1}^n,\\phi_{i}^n,\\phi_{i+1}^n\\},\n  $$\n  and clip the QUICK face state by\n  $\n  \\phi_{i+\\frac{1}{2}}^{\\mathrm{clip},n} = \\min\\Big(\\phi_{\\max}^{(i+\\frac{1}{2}),n},\\ \\max\\big(\\phi_{\\min}^{(i+\\frac{1}{2}),n},\\ \\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n}\\big)\\Big).\n  $\n  Use $F_{i+\\frac{1}{2}}^n = u\\,\\phi_{i+\\frac{1}{2}}^{\\mathrm{clip},n}$ consistently for both adjacent cells so that the finite-volume scheme remains conservative. After advancing to $t^{n_t}$, compute\n  $$\n  \\epsilon_+^{\\mathrm{face}} = \\max\\!\\left\\{0,\\ \\max_i \\phi_i^{n_t} - 1\\right\\},\\quad\n  \\epsilon_-^{\\mathrm{face}} = \\max\\!\\left\\{0,\\ -\\min_i \\phi_i^{n_t}\\right\\},\\quad\n  \\Delta M^{\\mathrm{face}} = \\sum_{i=0}^{N_x-1} \\phi_i^{n_t} - \\sum_{i=0}^{N_x-1} \\phi_i^{0}.\n  $$\n- For comparison, implement a post-update cell-value clipping strategy that enforces $\\phi_i^{n+1}\\in[0,1]$ by applying\n  $\n  \\phi_i^{n+1}\\leftarrow \\min\\{1,\\max\\{0,\\phi_i^{n+1}\\}\\}\n  $\n  after each time step, starting from the baseline QUICK update. After advancing to $t^{n_t}$, compute\n  $$\n  \\epsilon_+^{\\mathrm{post}} = \\max\\!\\left\\{0,\\ \\max_i \\phi_i^{n_t} - 1\\right\\},\\quad\n  \\epsilon_-^{\\mathrm{post}} = \\max\\!\\left\\{0,\\ -\\min_i \\phi_i^{n_t}\\right\\},\\quad\n  \\Delta M^{\\mathrm{post}} = \\sum_{i=0}^{N_x-1} \\phi_i^{n_t} - \\sum_{i=0}^{N_x-1} \\phi_i^{0}.\n  $$\n  Note that this strategy is not flux-based and can break conservation; you must quantify this effect via $\\Delta M^{\\mathrm{post}}$.\n\nAll quantities in this problem are nondimensional; do not attach physical units. Angles are not used. Implement the three strategies and evaluate them for the following test suite of parameter sets, each defined by $(N_x,\\mathrm{CFL},\\sigma,x_0,u)$:\n\n- Test A (general case): $(100,\\,0.4,\\,0.05,\\,0.3,\\,1)$.\n- Test B (near-Courant-limit on a coarser grid): $(50,\\,0.95,\\,0.05,\\,0.3,\\,1)$.\n- Test C (steep profile on a coarse grid): $(40,\\,0.9,\\,0.02,\\,0.3,\\,1)$.\n\nFor each test, the required program output is a list of nine floats in the order\n$$\n\\Big[\\epsilon_+^{\\mathrm{base}},\\,\\epsilon_-^{\\mathrm{base}},\\,\\Delta M^{\\mathrm{base}},\\,\\epsilon_+^{\\mathrm{face}},\\,\\epsilon_-^{\\mathrm{face}},\\,\\Delta M^{\\mathrm{face}},\\,\\epsilon_+^{\\mathrm{post}},\\,\\epsilon_-^{\\mathrm{post}},\\,\\Delta M^{\\mathrm{post}}\\Big].\n$$\nYour program should produce a single line of output containing the results for Tests A, B, and C as a comma-separated list of these three nine-tuples, enclosed in square brackets and with no extra whitespace, for example, $[[\\cdots],[\\cdots],[\\cdots]]$. The outputs must be numeric floats.",
            "solution": "The problem presented is a valid and well-posed exercise in computational fluid dynamics. It requires the numerical solution of the one-dimensional linear advection equation using a finite-volume method with the QUICK scheme, and a comparative analysis of three different strategies for handling the non-monotonic behavior inherent to the baseline QUICK scheme.\n\nThe governing partial differential equation (PDE) is the linear advection equation:\n$$\n\\partial_t \\phi(x,t) + u\\,\\partial_x \\phi(x,t) = 0\n$$\nHere, $\\phi(x,t)$ represents a scalar quantity being advected with a constant, positive velocity $u>0$. The spatial domain is $x \\in [0,1)$ with periodic boundary conditions.\n\nWe employ a finite-volume discretization. The domain is divided into $N_x$ cells, each of width $\\Delta x = 1/N_x$. The cell-averaged value of $\\phi$ in cell $i$ at time $t^n = n\\Delta t$ is denoted by $\\phi_i^n$. Integrating the PDE over cell $i$ from $x_{i-\\frac{1}{2}}$ to $x_{i+\\frac{1}{2}}$ yields the exact relation:\n$$\n\\frac{d\\phi_i}{dt} + \\frac{1}{\\Delta x} \\left( u\\phi(x_{i+\\frac{1}{2}}, t) - u\\phi(x_{i-\\frac{1}{2}}, t) \\right) = 0\n$$\nAn explicit Euler time-stepping scheme gives the semi-discrete finite-volume update rule:\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\Big)\n$$\nwhere $F_{i+\\frac{1}{2}}^n = u\\,\\phi_{i+\\frac{1}{2}}^n$ is the numerical flux across the face at $x_{i+\\frac{1}{2}}$. The time step is $\\Delta t = \\mathrm{CFL}\\,\\Delta x/u$, where $\\mathrm{CFL} \\in (0,1)$ is the Courant-Friedrichs-Lewy number.\n\nThe initial condition is a periodic Gaussian profile centered at $x_0$:\n$$\n\\phi(x,0) = \\exp\\!\\left(-\\frac{d(x,x_0)^2}{2\\sigma^2}\\right)\n$$\nwhere $d(x,x_0) = \\min_{k\\in\\mathbb{Z}} |x - x_0 + k|$ is the geodesic distance on the periodic domain. The initial cell-averaged values are initialized by sampling this function at the cell centers, $\\phi_i^0 = \\phi(x_i, 0)$ where $x_i = (i+\\frac{1}{2})\\Delta x$. The initial profile is bounded, with $\\phi(x,0) \\in (0, 1]$.\n\nThe core of the problem lies in the approximation of the face value $\\phi_{i+\\frac{1}{2}}^n$. The problem specifies the use of the Quadratic Upstream Interpolation for Convective Kinematics (QUICK) scheme. For $u>0$, this scheme reconstructs the face value using a quadratic polynomial fitted to the two adjacent upwind cell averages ($\\phi_{i-1}^n$, $\\phi_i^n$) and the first downwind cell average ($\\phi_{i+1}^n$). The resulting formula is:\n$$\n\\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n} = -\\frac{1}{8}\\phi_{i-1}^n + \\frac{6}{8}\\phi_{i}^n + \\frac{3}{8}\\phi_{i+1}^n\n$$\nThis scheme is third-order accurate for uniform grids but is known to be non-monotonic, meaning it can produce unphysical oscillations (overshoots and undershoots) near steep gradients, violating the discrete maximum principle. The problem requires the implementation and comparison of three approaches to address this.\n\n**1. Baseline QUICK Scheme:**\nThis approach uses the $\\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n}$ values directly to compute the flux $F_{i+\\frac{1}{2}}^n = u\\,\\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n}$. The finite-volume update is conservative, meaning the total mass $\\sum_i \\phi_i^n$ is conserved up to machine precision. However, as noted, it is expected to produce overshoots ($\\phi_i^{n_t} > 1$) and undershoots ($\\phi_i^{n_t}  0$). We quantify these with $\\epsilon_+^{\\mathrm{base}}$ and $\\epsilon_-^{\\mathrm{base}}$, and verify conservation with $\\Delta M^{\\mathrm{base}}$.\n\n**2. Face-Level Clipping (Flux Limiter):**\nThis strategy aims to enforce monotonicity while preserving conservation. It acts by \"clipping\" the reconstructed face value to lie within the bounds defined by the values in its local stencil. For each face $i+\\frac{1}{2}$, the local bounds are:\n$$\n\\phi_{\\min}^{(i+\\frac{1}{2}),n} = \\min\\{\\phi_{i-1}^n,\\phi_{i}^n,\\phi_{i+1}^n\\} \\quad \\text{and} \\quad \\phi_{\\max}^{(i+\\frac{1}{2}),n} = \\max\\{\\phi_{i-1}^n,\\phi_{i}^n,\\phi_{i+1}^n\\}\n$$\nThe QUICK face value is then clipped to these bounds:\n$$\n\\phi_{i+\\frac{1}{2}}^{\\mathrm{clip},n} = \\min\\Big(\\phi_{\\max}^{(i+\\frac{1}{2}),n},\\ \\max\\big(\\phi_{\\min}^{(i+\\frac{1}{2}),n},\\ \\phi_{i+\\frac{1}{2}}^{\\mathrm{QUICK},n}\\big)\\Big)\n$$\nThe numerical flux is computed using this clipped value: $F_{i+\\frac{1}{2}}^n = u\\,\\phi_{i+\\frac{1}{2}}^{\\mathrm{clip},n}$. Because the same flux value is used as an outflow for cell $i$ and an inflow for cell $i+1$, the scheme remains fully conservative. This technique is a form of flux limiter. While it may not strictly enforce the global maximum principle (i.e., $\\phi_i^{n+1}$ may still slightly exceed the global maximum of $\\phi^n$), it significantly dampens oscillations and is expected to substantially reduce or eliminate $\\epsilon_+^{\\mathrm{face}}$ and $\\epsilon_-^{\\mathrm{face}}$ compared to the baseline, while keeping $\\Delta M^{\\mathrm{face}}$ near zero.\n\n**3. Post-Update Cell-Value Clipping:**\nThis is a more direct, but non-conservative, method. The finite-volume update is first performed using the baseline QUICK scheme. Then, the resulting cell values $\\phi_i^{n+1}$ are forcibly clipped to the known physical bounds of the initial solution, $[0,1]$:\n$$\n\\phi_i^{n+1} \\leftarrow \\min\\{1, \\max\\{0, \\phi_i^{n+1}\\}\\}\n$$\nBy definition, this method will result in $\\epsilon_+^{\\mathrm{post}}=0$ and $\\epsilon_-^{\\mathrm{post}}=0$. However, this clipping is applied independently to each cell after the flux-balancing step. It does not respect the conservation law that the finite-volume method is built upon. As a result, this method artificially adds or removes mass from the system, and the conservation error $\\Delta M^{\\mathrm{post}}$ is expected to be significant.\n\nThe implementation will proceed by simulating the advection for approximately one flow-through time for each of the three specified test cases. For each case and each of the three strategies, we will compute the final overshoot, undershoot, and change in total mass as defined in the problem statement. This comparative analysis will highlight the trade-offs between accuracy, monotonicity, and conservation in numerical schemes for advection.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using QUICK scheme with three\n    different strategies for handling oscillations, for three test cases.\n    \"\"\"\n    \n    # (Nx, CFL, sigma, x0, u)\n    test_cases = [\n        (100, 0.4, 0.05, 0.3, 1.0),  # Test A\n        (50, 0.95, 0.05, 0.3, 1.0),  # Test B\n        (40, 0.9, 0.02, 0.3, 1.0),   # Test C\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        case_results = []\n        for strategy in ['base', 'face', 'post']:\n            res = run_simulation(params, strategy)\n            case_results.extend(res)\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'[{\",\".join(map(str, res))}]' for res in all_results])}]\")\n\n\ndef run_simulation(params, strategy):\n    \"\"\"\n    Runs a single simulation for a given set of parameters and strategy.\n    \n    Args:\n        params (tuple): A tuple of (Nx, CFL, sigma, x0, u).\n        strategy (str): One of 'base', 'face', or 'post'.\n\n    Returns:\n        tuple: A tuple containing (eps_plus, eps_minus, delta_M).\n    \"\"\"\n    Nx, CFL, sigma, x0, u = params\n\n    # Grid and time-step setup\n    dx = 1.0 / Nx\n    dt = CFL * dx / u\n    nt = int(round(Nx / CFL))\n    \n    # Cell-center coordinates\n    x = (np.arange(Nx) + 0.5) * dx\n\n    # Initial condition: periodic Gaussian\n    # Geodesic distance on the circle [0, 1)\n    dist = x - x0\n    dist = dist - np.round(dist)\n    phi0 = np.exp(-dist**2 / (2.0 * sigma**2))\n    \n    phi = phi0.copy()\n    \n    # Store initial mass for conservation check\n    mass0 = np.sum(phi0)\n\n    # Time-stepping loop\n    for _ in range(nt):\n        # Periodic indexing using np.roll\n        phi_im1 = np.roll(phi, 1)\n        phi_ip1 = np.roll(phi, -1)\n        \n        # QUICK reconstruction for face i + 1/2\n        phi_face_quick = -1.0/8.0 * phi_im1 + 6.0/8.0 * phi + 3.0/8.0 * phi_ip1\n        \n        phi_face = phi_face_quick\n\n        if strategy == 'face':\n            # Face-level clipping\n            phi_min_stencil = np.minimum(phi_im1, np.minimum(phi, phi_ip1))\n            phi_max_stencil = np.maximum(phi_im1, np.maximum(phi, phi_ip1))\n            phi_face = np.clip(phi_face_quick, phi_min_stencil, phi_max_stencil)\n\n        # Numerical flux at i + 1/2\n        F_ip12 = u * phi_face\n        # Numerical flux at i - 1/2\n        F_im12 = np.roll(F_ip12, 1)\n        \n        # Finite volume update\n        phi = phi - (dt / dx) * (F_ip12 - F_im12)\n\n        if strategy == 'post':\n            # Post-update cell value clipping\n            phi = np.clip(phi, 0.0, 1.0)\n            \n    # Calculate final metrics\n    mass_final = np.sum(phi)\n    \n    eps_plus = max(0.0, np.max(phi) - 1.0)\n    eps_minus = max(0.0, -np.min(phi))\n    delta_M = mass_final - mass0\n    \n    return eps_plus, eps_minus, delta_M\n\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}