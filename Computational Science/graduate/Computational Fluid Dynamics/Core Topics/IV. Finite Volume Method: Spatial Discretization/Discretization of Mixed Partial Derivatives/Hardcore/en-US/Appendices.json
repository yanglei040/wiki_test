{
    "hands_on_practices": [
        {
            "introduction": "A robust numerical method should, as much as possible, inherit the fundamental symmetries of the continuous operator it aims to approximate. This exercise provides a direct way to test this principle for a mixed derivative stencil. By applying the discrete operator to a simple, radially symmetric quadratic function for which the continuous mixed derivative is identically zero, we can quantitatively measure the stencil's failure to preserve this rotational symmetry, a crucial step in identifying sources of discretization error .",
            "id": "3310640",
            "problem": "In Computational Fluid Dynamics (CFD), mixed partial derivatives arise naturally in coordinate-transformed equations and in anisotropic diffusion with non-diagonal diffusivity tensors. Consider a smooth scalar field $u(x,y)$ that models a velocity potential or temperature, and recall that the mixed derivative $\\frac{\\partial^{2} u}{\\partial x \\partial y}$ vanishes for any purely radial quadratic field $u(r)=r^{2}=x^{2}+y^{2}$ in the continuum. On a uniform Cartesian grid with grid spacings $\\Delta x$ and $\\Delta y$, and nodal coordinates $(x_{i},y_{j})=(x_{0}+i\\,\\Delta x,\\;y_{0}+j\\,\\Delta y)$, assess the discrete rotational symmetry of the following candidate linear stencil intended to approximate the mixed derivative at node $(i,j)$:\n$$\n\\mathcal{L}_{xy}[u]_{i,j} \\;=\\; \\frac{1}{\\Delta x\\,\\Delta y}\\Big( \\alpha\\big(u_{i+1,j+1}-u_{i+1,j-1}-u_{i-1,j+1}+u_{i-1,j-1}\\big) \\;+\\; \\beta\\big(u_{i+1,j}-u_{i-1,j}\\big) \\;+\\; \\gamma\\big(u_{i,j+1}-u_{i,j-1}\\big) \\Big),\n$$\nwhere $\\alpha$, $\\beta$, and $\\gamma$ are dimensionless weights. Compute the exact closed-form expression of $\\mathcal{L}_{xy}[u]_{i,j}$ when $u(x,y)=x^{2}+y^{2}$, expressed in terms of $\\alpha$, $\\beta$, $\\gamma$, $\\Delta x$, $\\Delta y$, $x_{i}$, and $y_{j}$. Your answer must be a single analytic expression. Explain, based on your computed expression, how deviations from zero quantify the violation of discrete rotational symmetry for this stencil. No numerical rounding is required, and no units should be included in the final expression.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of numerical analysis, specifically the study of finite difference methods for partial differential equations. It is well-posed, objective, and contains all necessary information to compute a unique and meaningful solution. The problem asks for the evaluation of a discrete operator on a specific function and an interpretation of the result in the context of discrete symmetry, which is a standard procedure for analyzing numerical stencils.\n\nThe task is to compute the exact closed-form expression of the discrete operator $\\mathcal{L}_{xy}[u]_{i,j}$ for the scalar field $u(x,y) = x^2+y^2$. The operator is defined as:\n$$\n\\mathcal{L}_{xy}[u]_{i,j} \\;=\\; \\frac{1}{\\Delta x\\,\\Delta y}\\Big( \\alpha\\big(u_{i+1,j+1}-u_{i+1,j-1}-u_{i-1,j+1}+u_{i-1,j-1}\\big) \\;+\\; \\beta\\big(u_{i+1,j}-u_{i-1,j}\\big) \\;+\\; \\gamma\\big(u_{i,j+1}-u_{i,j-1}\\big) \\Big)\n$$\nThe grid coordinates are given by $x_k = x_i + (k-i)\\Delta x$ and $y_l = y_j + (l-j)\\Delta y$. For the function $u(x,y) = x^2+y^2$, the value at a generic grid node $(x_k, y_l)$ is $u_{k,l} = x_k^2 + y_l^2$.\n\nWe proceed by evaluating the terms inside the operator's definition. We will analyze the three components of the sum, corresponding to the weights $\\alpha$, $\\beta$, and $\\gamma$, separately.\n\nFirst, consider the term multiplied by $\\alpha$:\n$u_{i+1,j+1}-u_{i+1,j-1}-u_{i-1,j+1}+u_{i-1,j-1}$.\nLet's evaluate the constituent differences:\n$u_{i+1,j+1} - u_{i+1,j-1} = \\left((x_i+\\Delta x)^2+(y_j+\\Delta y)^2\\right) - \\left((x_i+\\Delta x)^2+(y_j-\\Delta y)^2\\right)$\n$= (y_j+\\Delta y)^2 - (y_j-\\Delta y)^2 = (y_j^2+2y_j\\Delta y+\\Delta y^2) - (y_j^2-2y_j\\Delta y+\\Delta y^2) = 4y_j\\Delta y$.\n\n$u_{i-1,j+1} - u_{i-1,j-1} = \\left((x_i-\\Delta x)^2+(y_j+\\Delta y)^2\\right) - \\left((x_i-\\Delta x)^2+(y_j-\\Delta y)^2\\right)$\n$= (y_j+\\Delta y)^2 - (y_j-\\Delta y)^2 = 4y_j\\Delta y$.\n\nCombining these, the term for $\\alpha$ is:\n$(u_{i+1,j+1}-u_{i+1,j-1}) - (u_{i-1,j+1}-u_{i-1,j-1}) = 4y_j\\Delta y - 4y_j\\Delta y = 0$.\nThus, the contribution of the $\\alpha$-term to the operator is zero, regardless of the value of $\\alpha$. This is an important finding, as the standard central difference approximation for $\\frac{\\partial^2 u}{\\partial x \\partial y}$ corresponds to this part of the stencil with $\\alpha=1/4$.\n\nNext, consider the term multiplied by $\\beta$:\n$u_{i+1,j} - u_{i-1,j} = \\left((x_i+\\Delta x)^2+y_j^2\\right) - \\left((x_i-\\Delta x)^2+y_j^2\\right)$\n$= (x_i+\\Delta x)^2 - (x_i-\\Delta x)^2 = (x_i^2+2x_i\\Delta x+\\Delta x^2) - (x_i^2-2x_i\\Delta x+\\Delta x^2) = 4x_i\\Delta x$.\n\nFinally, consider the term multiplied by $\\gamma$:\n$u_{i,j+1} - u_{i,j-1} = \\left(x_i^2+(y_j+\\Delta y)^2\\right) - \\left(x_i^2+(y_j-\\Delta y)^2\\right)$\n$= (y_j+\\Delta y)^2 - (y_j-\\Delta y)^2 = (y_j^2+2y_j\\Delta y+\\Delta y^2) - (y_j^2-2y_j\\Delta y+\\Delta y^2) = 4y_j\\Delta y$.\n\nNow, we substitute these results back into the definition of $\\mathcal{L}_{xy}[u]_{i,j}$:\n$$\n\\mathcal{L}_{xy}[u]_{i,j} = \\frac{1}{\\Delta x\\,\\Delta y}\\Big( \\alpha(0) + \\beta(4x_i\\Delta x) + \\gamma(4y_j\\Delta y) \\Big)\n$$\n$$\n\\mathcal{L}_{xy}[u]_{i,j} = \\frac{1}{\\Delta x\\,\\Delta y}\\Big( 4\\beta x_i\\Delta x + 4\\gamma y_j\\Delta y \\Big)\n$$\nDistributing the leading factor $\\frac{1}{\\Delta x\\Delta y}$ to each term in the parenthesis gives:\n$$\n\\mathcal{L}_{xy}[u]_{i,j} = \\frac{4\\beta x_i\\Delta x}{\\Delta x\\Delta y} + \\frac{4\\gamma y_j\\Delta y}{\\Delta x\\Delta y}\n$$\n$$\n\\mathcal{L}_{xy}[u]_{i,j} = \\frac{4\\beta x_i}{\\Delta y} + \\frac{4\\gamma y_j}{\\Delta x}\n$$\nThis is the final closed-form expression for the action of the discrete operator on the function $u(x,y)=x^2+y^2$.\n\nThe problem also asks for an explanation of how this result quantifies the violation of discrete rotational symmetry. In the continuum, the function $u(x,y)=x^2+y^2$ is purely radial (rotationally symmetric), and its mixed partial derivative is identically zero:\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial}{\\partial y}(x^2+y^2)\\right) = \\frac{\\partial}{\\partial x}(2y) = 0\n$$\nAn ideal discrete operator intended to approximate $\\frac{\\partial^2}{\\partial x \\partial y}$ should preserve this fundamental property, meaning it should also yield zero when applied to the discrete samples of a rotationally symmetric quadratic field. This is a test of the operator's discrete symmetry properties.\n\nOur computed result is $\\mathcal{L}_{xy}[u]_{i,j} = \\frac{4\\beta x_i}{\\Delta y} + \\frac{4\\gamma y_j}{\\Delta x}$. For this expression to be zero for all grid points $(x_i, y_j)$, it is necessary and sufficient that the coefficients of $x_i$ and $y_j$ are both zero. This requires $\\beta=0$ and $\\gamma=0$.\n\nAny non-zero values for $\\beta$ or $\\gamma$ lead to a non-zero result. This non-zero value, $\\frac{4\\beta x_i}{\\Delta y} + \\frac{4\\gamma y_j}{\\Delta x}$, represents the error of the discrete operator for this specific case. This error explicitly breaks rotational symmetry because its value depends on the coordinates $x_i$ and $y_j$ individually, not on the radial distance $r_i = \\sqrt{x_i^2+y_j^2}$. For instance, along the $x$-axis ($y_j=0$), the error is $\\frac{4\\beta x_i}{\\Delta y}$, while along the $y$-axis ($x_i=0$), it is $\\frac{4\\gamma y_j}{\\Delta x}$. A rotationally invariant error would depend only on $r_i$.\n\nThe expression $\\frac{4\\beta x_i}{\\Delta y} + \\frac{4\\gamma y_j}{\\Delta x}$ is therefore a direct, quantitative measure of the stencil's failure to respect the rotational symmetry inherent in the continuum operator it is meant to approximate. The presence of non-zero $\\beta$ and $\\gamma$ \"contaminates\" the mixed-derivative stencil with terms that resemble first-derivative operators ($\\beta$ term is a scaled central difference for $\\frac{\\partial}{\\partial x}$, $\\gamma$ term for $\\frac{\\partial}{\\partial y}$), which are themselves not rotationally invariant. The fact that the $\\alpha$-term evaluates to zero demonstrates that the standard nine-point stencil for the mixed derivative ($\\beta=\\gamma=0$) does correctly preserve this discrete rotational symmetry.",
            "answer": "$$\\boxed{\\frac{4\\beta x_i}{\\Delta y} + \\frac{4\\gamma y_j}{\\Delta x}}$$"
        },
        {
            "introduction": "In continuous calculus, Clairaut's theorem guarantees that for sufficiently smooth functions, the order of mixed partial differentiation does not matter, i.e., $\\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial^2 u}{\\partial y \\partial x}$. This exercise investigates whether this fundamental commutative property holds in the discrete world, particularly on the non-uniform grids ubiquitous in practical CFD. By calculating the commutator of one-sided difference operators, you will uncover how grid stretching can introduce errors that break this symmetry, a critical insight into the geometric fidelity of a numerical scheme .",
            "id": "3310685",
            "problem": "Consider a smooth scalar field $u(x,y)$ on a two-dimensional physical domain and recall the continuous fact that, for sufficiently smooth $u$, the mixed partial derivatives commute, so that $\\frac{\\partial^{2} u}{\\partial x \\partial y} = \\frac{\\partial^{2} u}{\\partial y \\partial x}$. In computational fluid dynamics, partial derivatives are approximated on grids by discrete operators. On nonuniform grids, such discrete operators need not commute.\n\nLet the grid be structured with indices $(i,j)$, and define the physical location of the node $(i,j)$ by $x_{i,j} = \\alpha_{j}\\, i\\, h$ and $y_{i,j} = \\beta_{i}\\, j\\, h$, where $(\\alpha_{j})_{j\\in\\mathbb{Z}}$ and $(\\beta_{i})_{i\\in\\mathbb{Z}}$ are strictly positive sequences encoding grid stretching in the $x$- and $y$-directions, respectively, and $h>0$ is a reference spacing. Thus, the local spacings along coordinate lines are $h^{x}_{i-1/2}(j) = x_{i,j} - x_{i-1,j} = \\alpha_{j}\\, h$ and $h^{y}_{j+1/2}(i) = y_{i,j+1} - y_{i,j} = \\beta_{i}\\, h$. Define the discrete first-derivative operators at $(i,j)$ by the first-order backward difference in $x$ and the first-order forward difference in $y$:\n$$\nD_{x} u(i,j) = \\frac{u_{i,j} - u_{i-1,j}}{h^{x}_{i-1/2}(j)} = \\frac{u_{i,j} - u_{i-1,j}}{\\alpha_{j}\\, h}, \n\\qquad\nD_{y} u(i,j) = \\frac{u_{i,j+1} - u_{i,j}}{h^{y}_{j+1/2}(i)} = \\frac{u_{i,j+1} - u_{i,j}}{\\beta_{i}\\, h}.\n$$\nThese choices are representative of one-sided discrete gradients commonly used in flux-conservative discretizations.\n\nLet the test field be the bilinear function $u(x,y) = x\\, y$, so that $u_{i,j} = u(x_{i,j}, y_{i,j}) = x_{i,j}\\, y_{i,j}$. Consider an interior node $(i,j)$ where the neighbors $(i-1,j)$ and $(i,j+1)$ are available.\n\nDefine the grid-stretching ratios\n$$\nr_{x}(j) = \\frac{\\alpha_{j+1}}{\\alpha_{j}}, \n\\qquad\nr_{y}(i) = \\frac{\\beta_{i-1}}{\\beta_{i}},\n$$\nwhich quantify how spacings change when moving one index in the transverse direction.\n\nTask: Starting from the definitions above and without invoking any pre-derived discrete commutator identities, compute $D_{x} D_{y} u(i,j)$ and $D_{y} D_{x} u(i,j)$ at the generic interior node $(i,j)$ and simplify their difference $[D_{x}, D_{y}]\\, u(i,j) := D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j)$. Express your final answer solely as a closed-form analytic expression in terms of $i$, $j$, $r_{x}(j)$, and $r_{y}(i)$. No numerical evaluation is required.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and contains a complete and consistent set of definitions. It presents a standard, albeit detailed, calculation in the field of numerical analysis for partial differential equations. We may proceed with the solution.\n\nThe task is to compute the commutator of the discrete derivative operators, $[D_{x}, D_{y}]\\, u(i,j) = D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j)$, for the specified test field $u(x,y) = x\\,y$ on the given nonuniform grid.\n\nFirst, we express the discrete field $u_{i,j}$ using the definitions of the grid coordinates $x_{i,j} = \\alpha_{j}\\,i\\,h$ and $y_{i,j} = \\beta_{i}\\,j\\,h$.\n$$\nu_{i,j} = u(x_{i,j}, y_{i,j}) = x_{i,j} y_{i,j} = (\\alpha_{j}\\,i\\,h)(\\beta_{i}\\,j\\,h) = i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2}\n$$\nWe will compute the two terms of the commutator, $D_{x} D_{y} u(i,j)$ and $D_{y} D_{x} u(i,j)$, separately.\n\nLet's start by calculating $D_{x} D_{y} u(i,j)$. We first evaluate the inner operation, $v(i,j) = D_{y} u(i,j)$.\nThe operator $D_{y}$ is defined as:\n$$\nD_{y} u(i,j) = \\frac{u_{i,j+1} - u_{i,j}}{\\beta_{i}\\,h}\n$$\nWe need the value of $u$ at the node $(i, j+1)$:\n$$\nu_{i,j+1} = x_{i,j+1} y_{i,j+1} = (\\alpha_{j+1}\\,i\\,h)(\\beta_{i}\\,(j+1)\\,h) = i\\,(j+1)\\,\\alpha_{j+1}\\,\\beta_{i}\\,h^{2}\n$$\nSubstituting $u_{i,j}$ and $u_{i,j+1}$ into the expression for $D_{y} u(i,j)$:\n$$\nv(i,j) = D_{y} u(i,j) = \\frac{i\\,(j+1)\\,\\alpha_{j+1}\\,\\beta_{i}\\,h^{2} - i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2}}{\\beta_{i}\\,h}\n$$\nFactoring out common terms:\n$$\nv(i,j) = \\frac{i\\,\\beta_{i}\\,h^{2} \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\beta_{i}\\,h} = i\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)\n$$\nNow, we apply the $D_{x}$ operator to $v(i,j)$. The operator $D_{x}$ is defined as:\n$$\nD_{x} v(i,j) = \\frac{v(i,j) - v(i-1,j)}{\\alpha_{j}\\,h}\n$$\nWe need $v(i-1,j)$, which is obtained by substituting $i-1$ for $i$ in the expression for $v(i,j)$:\n$$\nv(i-1,j) = (i-1)\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)\n$$\nSubstituting $v(i,j)$ and $v(i-1,j)$ into the expression for $D_{x}v(i,j)$:\n$$\nD_{x} D_{y} u(i,j) = \\frac{i\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right) - (i-1)\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}\\,h}\n$$\nFactoring out the common term in the numerator:\n$$\nD_{x} D_{y} u(i,j) = \\frac{(i - (i-1))\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}\\,h} = \\frac{\\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}}\n$$\n$$\nD_{x} D_{y} u(i,j) = (j+1)\\,\\frac{\\alpha_{j+1}}{\\alpha_{j}} - j\n$$\nUsing the given grid-stretching ratio $r_{x}(j) = \\frac{\\alpha_{j+1}}{\\alpha_{j}}$, we get:\n$$\nD_{x} D_{y} u(i,j) = (j+1)\\,r_{x}(j) - j\n$$\n\nNext, we calculate $D_{y} D_{x} u(i,j)$. We first evaluate the inner operation, $w(i,j) = D_{x} u(i,j)$.\n$$\nD_{x} u(i,j) = \\frac{u_{i,j} - u_{i-1,j}}{\\alpha_{j}\\,h}\n$$\nWe need the value of $u$ at the node $(i-1, j)$:\n$$\nu_{i-1,j} = x_{i-1,j} y_{i-1,j} = (\\alpha_{j}\\,(i-1)\\,h)(\\beta_{i-1}\\,j\\,h) = j\\,(i-1)\\,\\alpha_{j}\\,\\beta_{i-1}\\,h^{2}\n$$\nSubstituting $u_{i,j}$ and $u_{i-1,j}$ into the expression for $D_{x} u(i,j)$:\n$$\nw(i,j) = D_{x} u(i,j) = \\frac{i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2} - j\\,(i-1)\\,\\alpha_{j}\\,\\beta_{i-1}\\,h^{2}}{\\alpha_{j}\\,h}\n$$\nFactoring out common terms:\n$$\nw(i,j) = \\frac{j\\,\\alpha_{j}\\,h^{2} \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\alpha_{j}\\,h} = j\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)\n$$\nNow, we apply the $D_{y}$ operator to $w(i,j)$:\n$$\nD_{y} w(i,j) = \\frac{w(i,j+1) - w(i,j)}{\\beta_{i}\\,h}\n$$\nWe need $w(i,j+1)$, which is obtained by substituting $j+1$ for $j$ in the expression for $w(i,j)$:\n$$\nw(i,j+1) = (j+1)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)\n$$\nSubstituting $w(i,j)$ and $w(i,j+1)$ into the expression for $D_{y}w(i,j)$:\n$$\nD_{y} D_{x} u(i,j) = \\frac{(j+1)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right) - j\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\beta_{i}\\,h}\n$$\nFactoring out the common term in the numerator:\n$$\nD_{y} D_{x} u(i,j) = \\frac{((j+1) - j)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\beta_{i}\\,h} = \\frac{i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}}{\\beta_{i}}\n$$\n$$\nD_{y} D_{x} u(i,j) = i - (i-1)\\,\\frac{\\beta_{i-1}}{\\beta_{i}}\n$$\nUsing the given grid-stretching ratio $r_{y}(i) = \\frac{\\beta_{i-1}}{\\beta_{i}}$, we get:\n$$\nD_{y} D_{x} u(i,j) = i - (i-1)\\,r_{y}(i)\n$$\n\nFinally, we compute the difference to find the commutator:\n$$\n[D_{x}, D_{y}]\\, u(i,j) = D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j) = \\left((j+1)\\,r_{x}(j) - j\\right) - \\left(i - (i-1)\\,r_{y}(i)\\right)\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)\\,r_{x}(j) - j - i + (i-1)\\,r_{y}(i)\n$$\nThis expression can be rearranged to a more insightful form by isolating the deviation from a uniform grid, where $r_x=1$ and $r_y=1$.\nWe rewrite the first term as:\n$$\n(j+1)\\,r_{x}(j) - j = (j+1)\\,r_{x}(j) - (j+1) + 1 = (j+1)(r_x(j) - 1) + 1\n$$\nWe rewrite the second term as:\n$$\ni - (i-1)\\,r_{y}(i) = i - (i-1) - (i-1)(r_y(i) - 1) = 1 - (i-1)(r_y(i) - 1) = 1 + (i-1)(1 - r_y(i))\n$$\nSubtracting the rewritten second term from the rewritten first term:\n$$\n[D_{x}, D_{y}]\\, u(i,j) = \\left( (j+1)(r_x(j) - 1) + 1 \\right) - \\left( 1 + (i-1)(1 - r_y(i)) \\right)\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)(r_x(j) - 1) - (i-1)(1 - r_y(i))\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)(r_x(j) - 1) + (i-1)(r_y(i) - 1)\n$$\nThis final form clearly shows that the commutator vanishes if the grid is uniform in both directions (i.e., $r_x(j)=1$ and $r_y(i)=1$).",
            "answer": "$$\n\\boxed{(j+1)(r_x(j) - 1) + (i-1)(r_y(i) - 1)}\n$$"
        },
        {
            "introduction": "After deriving a discrete operator and analyzing its theoretical properties, the final and most crucial step is to verify that its implementation in code is correct. The Method of Manufactured Solutions (MMS) is the gold standard for this task, providing a rigorous framework to confirm that a numerical scheme achieves its designed order of accuracy. This practice guides you through the entire MMS process: constructing an analytical solution, deriving the corresponding source term for the governing PDE, and performing a grid refinement study to measure the convergence rate of the numerical error .",
            "id": "3310638",
            "problem": "Consider the constant-coefficient linear elliptic operator in two space dimensions given by the symmetric form $a\\,\\partial_{xx} + 2 b\\,\\partial_{xy} + c\\,\\partial_{yy}$ acting on a sufficiently smooth scalar field $u(x,y)$ defined on the periodic unit square $[0,1]\\times[0,1]$. The goal is to verify the observed order of accuracy of a second-order finite difference discretization of the mixed derivative term on a uniform Cartesian grid by the Method of Manufactured Solutions (MMS). All trigonometric arguments are to be interpreted in radians.\n\nYour tasks are:\n\n- Starting from the Taylor series expansion in $x$ and $y$ about a grid point and the definitions of partial and mixed partial derivatives, derive a formally second-order accurate centered finite difference approximation for each of the operators $\\partial_{xx}$, $\\partial_{yy}$, and $\\partial_{xy}$ on a uniform grid with spacings $h_x$ and $h_y$.\n\n- Construct a manufactured solution of the form\n  $$\n  u(x,y) \\;=\\; \\sin(k_x x)\\,\\sin(k_y y) \\;+\\; \\gamma\\,\\sin\\!\\big(k_m(x+y)\\big),\n  $$\n  where $k_x$, $k_y$, and $k_m$ are spatial frequencies and $\\gamma$ is a scalar amplitude. Using the chain rule and linearity of differentiation, derive the exact source term $f(x,y)$ such that the partial differential equation\n  $$\n  a\\,u_{xx}(x,y) \\;+\\; 2 b\\,u_{xy}(x,y) \\;+\\; c\\,u_{yy}(x,y) \\;=\\; f(x,y)\n  $$\n  is satisfied identically on the domain $[0,1]\\times[0,1]$ with periodic boundary conditions.\n\n- Implement the derived second-order accurate finite difference discretization of the operator $a\\,\\partial_{xx} + 2 b\\,\\partial_{xy} + c\\,\\partial_{yy}$ on a uniform $N\\times N$ grid over $[0,1]\\times[0,1]$ with periodic boundary conditions, and evaluate the discrete operator applied to the exact manufactured solution $u(x,y)$ on grids of sizes $N\\in\\{16,32,64,128\\}$. For each $N$, compute the discrete $L^2$-norm of the residual (or consistency error) defined by\n  $$\n  E(N) \\;=\\; \\left(\\int_{0}^{1}\\!\\int_{0}^{1} \\big( \\mathcal{L}_h[u](x,y) - f(x,y) \\big)^2 \\,\\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2},\n  $$\n  where $\\mathcal{L}_h$ denotes your discrete operator and the integral is approximated consistently by the uniform quadrature rule on the grid. Use periodic indexing to enforce boundary conditions.\n\n- Estimate the observed order of accuracy $p$ by fitting a straight line to the data $\\{(\\log h, \\log E(N))\\}$ across the four grid levels, where $h = 1/N$, using least squares. Report $p$ for each test case below.\n\nTest suite specification: Use the following four parameter sets, where $k_x = 2\\pi \\times \\kappa_x$, $k_y = 2\\pi \\times \\kappa_y$, and $k_m = 2\\pi \\times \\kappa_m$ with integer multipliers to maintain periodicity:\n\n- Case $1$ (mixed term present, anisotropic principal part): $a = 1$, $b = 0.3$, $c = 2$, $\\kappa_x = 3$, $\\kappa_y = 2$, $\\gamma = 0.5$, $\\kappa_m = 1$.\n\n- Case $2$ (no mixed term): $a = 1$, $b = 0$, $c = 1$, $\\kappa_x = 2$, $\\kappa_y = 1$, $\\gamma = 0.25$, $\\kappa_m = 3$.\n\n- Case $3$ (strong mixed coupling within ellipticity): $a = 1$, $b = 0.49$, $c = 1$, $\\kappa_x = 4$, $\\kappa_y = 3$, $\\gamma = 1$, $\\kappa_m = 2$.\n\n- Case $4$ (anisotropic coefficients with significant mixed term): $a = 3$, $b = 0.9$, $c = 5$, $\\kappa_x = 5$, $\\kappa_y = 4$, $\\gamma = 0.75$, $\\kappa_m = 1$.\n\nFinal output specification:\n\n- For each of the four cases, compute the least-squares estimate of the observed order of accuracy $p$ using the grid sizes $N\\in\\{16,32,64,128\\}$.\n\n- Your program should produce a single line of output containing the four values of $p$ for Cases $1$ through $4$, in that order, each rounded to exactly $3$ decimal places, formatted as a comma-separated list enclosed in square brackets (for example, $[1.997,2.003,2.001,1.999]$).\n\nThere are no physical units involved in this problem. Angles used in trigonometric functions are in radians. The answer must be given in the specified single-line format.",
            "solution": "The problem requires the derivation and implementation of a second-order accurate finite difference scheme for a general linear elliptic operator to verify its order of accuracy using the Method of Manufactured Solutions (MMS). The process is detailed in the following steps.\n\n### Derivation of Finite Difference Approximations\n\nWe derive second-order accurate centered finite difference approximations for the partial derivatives $\\partial_{xx}$, $\\partial_{yy}$, and $\\partial_{xy}$ on a uniform Cartesian grid with spacing $h_x = h_y = h$. Let $u_{i,j} = u(x_i, y_j) = u(ih, jh)$.\n\nThe Taylor series expansions of $u$ around the point $(x_i, y_j)$ in the $x$-direction are:\n$$\nu_{i+1,j} = u(x_i+h, y_j) = u_{i,j} + h \\frac{\\partial u}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 u}{\\partial x^2} + \\frac{h^3}{6} \\frac{\\partial^3 u}{\\partial x^3} + \\frac{h^4}{24} \\frac{\\partial^4 u}{\\partial x^4} + O(h^5)\n$$\n$$\nu_{i-1,j} = u(x_i-h, y_j) = u_{i,j} - h \\frac{\\partial u}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 u}{\\partial x^2} - \\frac{h^3}{6} \\frac{\\partial^3 u}{\\partial x^3} + \\frac{h^4}{24} \\frac{\\partial^4 u}{\\partial x^4} - O(h^5)\n$$\nAdding these two equations eliminates the odd-order derivative terms:\n$$\nu_{i+1,j} + u_{i-1,j} = 2u_{i,j} + h^2 \\frac{\\partial^2 u}{\\partial x^2} + \\frac{h^4}{12} \\frac{\\partial^4 u}{\\partial x^4} + O(h^6)\n$$\nSolving for $\\frac{\\partial^2 u}{\\partial x^2}$ provides the centered difference approximation:\n$$\n\\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{i,j} = \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2} - \\frac{h^2}{12} \\frac{\\partial^4 u}{\\partial x^4} + O(h^4)\n$$\nThis approximation is second-order accurate, with truncation error $O(h^2)$. By symmetry, the approximation for $\\frac{\\partial^2 u}{\\partial y^2}$ is:\n$$\n\\frac{\\partial^2 u}{\\partial y^2} \\bigg|_{i,j} = \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2} + O(h^2)\n$$\nFor the mixed partial derivative $\\frac{\\partial^2 u}{\\partial x \\partial y}$, we can compose second-order centered difference operators for the first derivatives. The centered difference operators for $\\partial_x$ and $\\partial_y$ are:\n$$\nD_{2x}[u]_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2h} = \\frac{\\partial u}{\\partial x} + O(h^2)\n$$\n$$\nD_{2y}[u]_{i,j} = \\frac{u_{i,j+1} - u_{i,j-1}}{2h} = \\frac{\\partial u}{\\partial y} + O(h^2)\n$$\nApplying these operators sequentially, we obtain an approximation for $\\frac{\\partial^2 u}{\\partial x \\partial y}$:\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial y} \\bigg|_{i,j} \\approx D_{2x}[D_{2y}[u]]_{i,j} = D_{2x}\\left[\\frac{u_{i,j+1} - u_{i,j-1}}{2h}\\right] = \\frac{D_{2x}[u]_{i,j+1} - D_{2x}[u]_{i,j-1}}{2h}\n$$\n$$\n= \\frac{1}{4h^2} \\left( (u_{i+1,j+1} - u_{i-1,j+1}) - (u_{i+1,j-1} - u_{i-1,j-1}) \\right)\n$$\n$$\n= \\frac{u_{i+1,j+1} - u_{i-1,j+1} - u_{i+1,j-1} + u_{i-1,j-1}}{4h^2}\n$$\nA Taylor series analysis shows that the leading term in the truncation error for this approximation is $\\frac{h^2}{6}\\left(\\frac{\\partial^4 u}{\\partial x^3 \\partial y} + \\frac{\\partial^4 u}{\\partial x \\partial y^3}\\right)$, so the scheme is formally second-order accurate.\n\n### Manufactured Solution and Source Term\n\nThe manufactured solution is given as:\n$$\nu(x,y) = \\sin(k_x x)\\,\\sin(k_y y) + \\gamma\\,\\sin(k_m(x+y))\n$$\nTo find the source term $f(x,y)$ that makes this function an exact solution to the PDE $a\\,u_{xx} + 2 b\\,u_{xy} + c\\,u_{yy} = f(x,y)$, we compute the analytical partial derivatives of $u(x,y)$:\n$$\nu_{xx}(x,y) = -k_x^2 \\sin(k_x x)\\sin(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\n$$\nu_{yy}(x,y) = -k_y^2 \\sin(k_x x)\\sin(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\n$$\nu_{xy}(x,y) = k_x k_y \\cos(k_x x)\\cos(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\nSubstituting these expressions into the PDE yields the source term $f(x,y)$:\n$$\nf(x,y) = a u_{xx} + 2b u_{xy} + c u_{yy}\n$$\n$$\n= a \\left( -k_x^2 S_k - \\gamma k_m^2 S_m \\right) + 2b \\left( k_x k_y C_k - \\gamma k_m^2 S_m \\right) + c \\left( -k_y^2 S_k - \\gamma k_m^2 S_m \\right)\n$$\nwhere $S_k = \\sin(k_x x)\\sin(k_y y)$, $C_k = \\cos(k_x x)\\cos(k_y y)$, and $S_m = \\sin(k_m(x+y))$.\nGrouping terms, we obtain the final expression for the source term:\n$$\nf(x,y) = -(a k_x^2 + c k_y^2) \\sin(k_x x)\\sin(k_y y) + 2b k_x k_y \\cos(k_x x)\\cos(k_y y) - \\gamma k_m^2 (a + 2b + c) \\sin(k_m(x+y))\n$$\n\n### Numerical Verification Procedure\n\nThe verification is performed on a uniform $N \\times N$ grid over the domain $[0,1] \\times [0,1]$. The grid points are $(x_i, y_j) = (ih, jh)$ for $i,j = 0, \\ldots, N-1$, with grid spacing $h=1/N$.\n\nThe discrete operator $\\mathcal{L}_h$ is assembled from the derived finite difference formulas:\n$$\n(\\mathcal{L}_h[u])_{i,j} = a \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2} + 2b \\frac{u_{i+1,j+1} - u_{i-1,j+1} - u_{i+1,j-1} + u_{i-1,j-1}}{4h^2} + c \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2}\n$$\nThe periodic boundary conditions are enforced by taking all grid indices modulo $N$.\n\nThe numerical procedure is as follows:\n1. For each grid resolution $N \\in \\{16, 32, 64, 128\\}$, evaluate the exact manufactured solution $u(x_i, y_j)$ and the exact source term $f(x_i, y_j)$ at all grid points.\n2. Apply the discrete operator $\\mathcal{L}_h$ to the grid values of $u$ to obtain $(\\mathcal{L}_h[u])_{i,j}$.\n3. Compute the residual (or truncation error) at each grid point: $R_{ij} = (\\mathcal{L}_h[u])_{i,j} - f(x_i, y_j)$.\n4. Calculate the discrete $L^2$-norm of the residual, which approximates the integral $\\left(\\int_0^1\\int_0^1 R(x,y)^2 dx dy\\right)^{1/2}$ using a uniform quadrature rule (the midpoint rule on each cell):\n$$\nE(N) = \\left( \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} R_{ij}^2 h^2 \\right)^{1/2} = h \\sqrt{\\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} R_{ij}^2}\n$$\nFor a method with order of accuracy $p$, the error is expected to behave as $E(N) \\approx C h^p = C (1/N)^p$ for some constant $C$. Taking the logarithm gives a linear relationship:\n$$\n\\log(E(N)) \\approx p \\log(h) + \\log(C)\n$$\nThe observed order of accuracy $p$ is estimated as the slope of a straight line fitted to the data points $\\{(\\log h, \\log E(N))\\}$ for the four grid resolutions using the method of least squares.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of verifying the order of accuracy of a finite difference\n    scheme for a 2D linear elliptic PDE using the Method of Manufactured Solutions.\n    \"\"\"\n    test_cases = [\n        # Case 1 (mixed term present, anisotropic principal part)\n        {'a': 1, 'b': 0.3, 'c': 2, 'kappa_x': 3, 'kappa_y': 2, 'gamma': 0.5, 'kappa_m': 1},\n        # Case 2 (no mixed term)\n        {'a': 1, 'b': 0, 'c': 1, 'kappa_x': 2, 'kappa_y': 1, 'gamma': 0.25, 'kappa_m': 3},\n        # Case 3 (strong mixed coupling within ellipticity)\n        {'a': 1, 'b': 0.49, 'c': 1, 'kappa_x': 4, 'kappa_y': 3, 'gamma': 1, 'kappa_m': 2},\n        # Case 4 (anisotropic coefficients with significant mixed term)\n        {'a': 3, 'b': 0.9, 'c': 5, 'kappa_x': 5, 'kappa_y': 4, 'gamma': 0.75, 'kappa_m': 1},\n    ]\n\n    grid_sizes = [16, 32, 64, 128]\n    estimated_orders = []\n\n    for case in test_cases:\n        a, b, c = case['a'], case['b'], case['c']\n        gamma = case['gamma']\n        \n        # Wavenumbers\n        k_x = 2 * np.pi * case['kappa_x']\n        k_y = 2 * np.pi * case['kappa_y']\n        k_m = 2 * np.pi * case['kappa_m']\n        \n        log_h_vals = []\n        log_E_vals = []\n\n        for N in grid_sizes:\n            h = 1.0 / N\n            \n            # Create grid\n            # Grid points are x_i = i*h, y_j = j*h for i,j=0..N-1\n            grid_coord = np.arange(N) * h\n            X, Y = np.meshgrid(grid_coord, grid_coord)\n            \n            # --- Evaluate manufactured solution and source term on the grid ---\n            # Manufactured solution u(x,y)\n            term1_u = np.sin(k_x * X) * np.sin(k_y * Y)\n            term2_u = gamma * np.sin(k_m * (X + Y))\n            U = term1_u + term2_u\n            \n            # Source term f(x,y)\n            term1_f = -(a * k_x**2 + c * k_y**2) * np.sin(k_x * X) * np.sin(k_y * Y)\n            term2_f = 2 * b * k_x * k_y * np.cos(k_x * X) * np.cos(k_y * Y)\n            term3_f = -gamma * k_m**2 * (a + 2*b + c) * np.sin(k_m * (X + Y))\n            F = term1_f + term2_f + term3_f\n\n            # --- Apply discrete operator L_h[u] ---\n            # Note: numpy's meshgrid output has Y on axis 0, X on axis 1.\n            # So, axis=0 corresponds to y-derivatives, axis=1 to x-derivatives.\n            h2 = h**2\n            \n            # Second derivative in x\n            U_xp1 = np.roll(U, -1, axis=1)\n            U_xm1 = np.roll(U, 1, axis=1)\n            discrete_uxx = (U_xp1 - 2*U + U_xm1) / h2\n            \n            # Second derivative in y\n            U_yp1 = np.roll(U, -1, axis=0)\n            U_ym1 = np.roll(U, 1, axis=0)\n            discrete_uyy = (U_yp1 - 2*U + U_ym1) / h2\n            \n            # Mixed partial derivative\n            # Stencil: (u(i+1,j+1) - u(i-1,j+1) - u(i+1,j-1) + u(i-1,j-1))/(4h^2)\n            U_xp1_yp1 = np.roll(U_xp1, -1, axis=0)\n            U_xm1_yp1 = np.roll(U_xm1, -1, axis=0)\n            U_xp1_ym1 = np.roll(U_xp1, 1, axis=0)\n            U_xm1_ym1 = np.roll(U_xm1, 1, axis=0)\n            \n            discrete_uxy = (U_xp1_yp1 - U_xm1_yp1 - U_xp1_ym1 + U_xm1_ym1) / (4 * h2)\n            \n            Lh_U = a * discrete_uxx + 2 * b * discrete_uxy + c * discrete_uyy\n            \n            # --- Compute residual and L2-norm of error ---\n            R = Lh_U - F\n            \n            # E(N) = (h^2 * sum(R_ij^2))^(1/2) = h * norm(R_ij)\n            E = h * np.linalg.norm(R)\n            \n            log_h_vals.append(np.log(h))\n            log_E_vals.append(np.log(E))\n\n        # --- Estimate order of accuracy using least squares ---\n        # Fit log(E) = p * log(h) + const\n        p, _ = np.polyfit(log_h_vals, log_E_vals, 1)\n        estimated_orders.append(p)\n    \n    # Format and print the final result\n    formatted_results = [f\"{res:.3f}\" for res in estimated_orders]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}