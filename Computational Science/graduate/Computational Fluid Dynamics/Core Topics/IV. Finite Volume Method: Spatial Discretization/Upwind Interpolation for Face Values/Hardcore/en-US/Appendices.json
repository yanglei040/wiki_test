{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the behavior of a numerical scheme, we must look beyond its derivation and analyze the equation it *actually* solves. This analytical practice guides you through a modified equation analysis, using Taylor series expansions to uncover the leading-order error terms of the explicit upwind scheme for $1$D linear advection . This process reveals an effective diffusion term, $D_{\\text{num}}$, providing a rigorous mathematical explanation for the scheme's well-known dissipative nature.",
            "id": "3386735",
            "problem": "Consider the linear one-dimensional ($1$D) advection equation with constant velocity,\n$$\n\\partial_{t} \\phi + a \\,\\partial_{x} \\phi = 0,\n$$\nwhere $a0$ is constant. Discretize this equation on a uniform grid with spacing $\\Delta x$ using a finite-volume method with first-order upwind interpolation for face values and advance in time with the forward (explicit) Euler method with time step $\\Delta t$. Let the Courant–Friedrichs–Lewy (CFL) number be defined as $\\mathrm{CFL} \\equiv a\\,\\Delta t/\\Delta x$.\n\nStarting from the integral conservation form and the definition of the numerical flux constructed from upwind face values, derive the modified equation that the fully discrete scheme satisfies to leading nontrivial order in $\\Delta x$ and $\\Delta t$. In particular, identify the leading-order truncation term that can be interpreted as an effective diffusion and therefore write the modified equation in the form\n$$\n\\partial_{t} \\phi + a\\,\\partial_{x} \\phi = D_{\\text{num}}\\,\\partial_{xx} \\phi + \\text{higher-order terms}.\n$$\nYour derivation must begin from the finite-volume balance and the explicit Euler update, use Taylor expansions about a generic cell center in space and time, and eliminate time derivatives in favor of spatial derivatives using the continuous equation wherever appropriate.\n\nReport the effective numerical diffusivity $D_{\\text{num}}$ as a single closed-form analytic expression in terms of $a$, $\\Delta x$, and $\\mathrm{CFL}$. Provide only the analytic expression for $D_{\\text{num}}$ as your final answer. No numerical evaluation or rounding is required.",
            "solution": "The problem is subjected to validation and is deemed valid. It is a standard, well-posed problem in the analysis of numerical methods for partial differential equations, grounded in established mathematical and computational principles. All necessary information is provided, and the terminology is precise and unambiguous.\n\nWe begin by stating the one-dimensional linear advection equation in its integral conservation form over a control volume (or cell) $C_i = [x_{i-1/2}, x_{i+1/2}]$, where $x_i$ is the cell center and $\\Delta x = x_{i+1/2} - x_{i-1/2}$ is the uniform cell width.\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial \\phi}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (a\\phi)}{\\partial x} \\,dx = 0\n$$\nLet $\\phi_i(t)$ be the cell-averaged value of the conserved quantity $\\phi$ in cell $C_i$ at time $t$, defined as:\n$$\n\\phi_i(t) \\equiv \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\phi(x,t) \\,dx\n$$\nApplying this definition and the fundamental theorem of calculus to the integral conservation law, we obtain the semi-discrete finite-volume formulation:\n$$\n\\frac{d\\phi_i}{dt} + \\frac{1}{\\Delta x} \\left[ (a\\phi)_{i+1/2} - (a\\phi)_{i-1/2} \\right] = 0\n$$\nHere, $(a\\phi)_{i \\pm 1/2}$ represents the numerical flux at the cell faces $x_{i \\pm 1/2}$.\n\nThe problem specifies the forward (explicit) Euler method for time integration. Applying this to the semi-discrete equation with a time step $\\Delta t$ yields the fully-discrete form:\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left[ F_{i+1/2}^n - F_{i-1/2}^n \\right] = 0\n$$\nwhere the superscript $n$ denotes the time level $t_n = n\\Delta t$, and the numerical flux is $F = a\\phi$.\n\nThe spatial discretization uses first-order upwind interpolation. Since the velocity $a$ is given as positive ($a0$), the \"upwind\" direction is to the left. Therefore, the value of $\\phi$ at a cell face is taken from the cell to its immediate left.\nFor the face at $x_{i+1/2}$, the upwind cell is $C_i$, so $\\phi_{i+1/2}^n = \\phi_i^n$.\nFor the face at $x_{i-1/2}$, the upwind cell is $C_{i-1}$, so $\\phi_{i-1/2}^n = \\phi_{i-1}^n$.\nThe numerical fluxes are thus:\n$$\nF_{i+1/2}^n = a \\phi_i^n \\quad \\text{and} \\quad F_{i-1/2}^n = a \\phi_{i-1}^n\n$$\nSubstituting these fluxes into the fully discrete equation gives:\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} + \\frac{a}{\\Delta x} \\left( \\phi_i^n - \\phi_{i-1}^n \\right) = 0\n$$\nTo derive the modified equation, we perform a Taylor series expansion of each term in the discrete equation around a central point $(x_i, t_n)$. We treat $\\phi_i^n$ as the value of the exact solution at this point, $\\phi(x_i, t_n)$, and relate the other terms to it.\nThe expansion for $\\phi_i^{n+1}$ in time is:\n$$\n\\phi_i^{n+1} = \\phi(x_i, t_n + \\Delta t) = \\phi(x_i, t_n) + \\Delta t \\, \\partial_t\\phi + \\frac{(\\Delta t)^2}{2} \\, \\partial_{tt}\\phi + \\mathcal{O}((\\Delta t)^3)\n$$\nThe expansion for $\\phi_{i-1}^n$ in space is:\n$$\n\\phi_{i-1}^n = \\phi(x_i - \\Delta x, t_n) = \\phi(x_i, t_n) - \\Delta x \\, \\partial_x\\phi + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi - \\frac{(\\Delta x)^3}{6} \\, \\partial_{xxx}\\phi + \\mathcal{O}((\\Delta x)^4)\n$$\nIn these expansions, $\\phi$ and its partial derivatives are evaluated at $(x_i, t_n)$.\n\nWe substitute these expansions into the left-hand side of the discrete equation:\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} = \\frac{1}{\\Delta t} \\left( \\left[ \\phi + \\Delta t \\, \\partial_t\\phi + \\frac{(\\Delta t)^2}{2} \\, \\partial_{tt}\\phi + \\dots \\right] - \\phi \\right) = \\partial_t\\phi + \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi + \\mathcal{O}((\\Delta t)^2)\n$$\nAnd into the right-hand side:\n$$\n-\\frac{a}{\\Delta x} (\\phi_i^n - \\phi_{i-1}^n) = -\\frac{a}{\\Delta x} \\left( \\phi - \\left[ \\phi - \\Delta x \\, \\partial_x\\phi + \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi - \\dots \\right] \\right)\n$$\n$$\n= -\\frac{a}{\\Delta x} \\left( \\Delta x \\, \\partial_x\\phi - \\frac{(\\Delta x)^2}{2} \\, \\partial_{xx}\\phi + \\dots \\right) = -a\\,\\partial_x\\phi + \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\mathcal{O}((\\Delta x)^2)\n$$\nEquating the expanded left-hand and right-hand sides gives the partial differential equation that the discrete scheme actually solves, up to the leading-order error terms:\n$$\n\\partial_t\\phi + \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi = -a\\,\\partial_x\\phi + \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi + \\text{H.O.T.}\n$$\nwhere H.O.T. represents higher-order terms. Rearranging, we get:\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\frac{\\Delta t}{2} \\, \\partial_{tt}\\phi + \\text{H.O.T.}\n$$\nThis is not yet in the desired form, as it contains a time derivative, $\\partial_{tt}\\phi$, in the truncation error. To obtain the modified equation, we must express this time derivative in terms of spatial derivatives. We use the original PDE, $\\partial_t\\phi = -a\\,\\partial_x\\phi$, which is satisfied to the lowest order. We can differentiate this equation to find relationships for higher-order derivatives.\n$$\n\\partial_{t} (\\partial_t \\phi) = \\partial_{t} (-a\\,\\partial_x \\phi) = -a\\,\\partial_{tx}\\phi\n$$\nAssuming the solution $\\phi$ is sufficiently smooth, we have $\\partial_{tx}\\phi = \\partial_{xt}\\phi$. Then:\n$$\n\\partial_{tt}\\phi = -a\\,\\partial_{x}(\\partial_t \\phi) = -a\\,\\partial_{x}(-a\\,\\partial_x \\phi) = a^2\\,\\partial_{xx}\\phi\n$$\nWe can also derive an expression for $\\partial_{tt}\\phi$ from the modified equation itself, $\\partial_t \\phi = -a \\partial_x \\phi + \\mathcal{O}(\\Delta x, \\Delta t)$. Differentiating this gives $\\partial_{tt}\\phi = a^2 \\partial_{xx}\\phi + \\mathcal{O}(\\Delta x, \\Delta t)$. Substituting this back into the truncation error term does not change the leading-order behavior.\n\nSubstituting $\\partial_{tt}\\phi = a^2\\,\\partial_{xx}\\phi$ into our rearranged equation:\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\frac{a\\Delta x}{2} \\, \\partial_{xx}\\phi - \\frac{\\Delta t}{2} (a^2\\,\\partial_{xx}\\phi) + \\text{H.O.T.}\n$$\nWe can now group the terms multiplying the second spatial derivative, $\\partial_{xx}\\phi$:\n$$\n\\partial_t\\phi + a\\,\\partial_x\\phi = \\left( \\frac{a\\Delta x}{2} - \\frac{a^2\\Delta t}{2} \\right) \\partial_{xx}\\phi + \\text{H.O.T.}\n$$\nThis is the modified equation to the leading nontrivial order. The term multiplying $\\partial_{xx}\\phi$ is the effective numerical diffusivity, $D_{\\text{num}}$.\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} - \\frac{a^2\\Delta t}{2}\n$$\nThe problem asks for this expression in terms of $a$, $\\Delta x$, and the Courant–Friedrichs–Lewy (CFL) number, defined as $\\mathrm{CFL} \\equiv a\\,\\Delta t/\\Delta x$. We can factor out $\\frac{a\\Delta x}{2}$ from the expression for $D_{\\text{num}}$:\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} \\left( 1 - \\frac{a^2\\Delta t}{a\\Delta x} \\right) = \\frac{a\\Delta x}{2} \\left( 1 - \\frac{a\\Delta t}{\\Delta x} \\right)\n$$\nSubstituting the definition of the CFL number, we arrive at the final expression for the numerical diffusivity:\n$$\nD_{\\text{num}} = \\frac{a\\Delta x}{2} (1 - \\mathrm{CFL})\n$$\nThis leading-order truncation error term, which has the form of a diffusion term, is responsible for the dissipative nature of the first-order upwind scheme.",
            "answer": "$$\n\\boxed{\\frac{a \\Delta x}{2} (1 - \\mathrm{CFL})}\n$$"
        },
        {
            "introduction": "Theory is powerful, but quantifying its effects is essential for practical engineering. In this exercise, you will confront the upwind scheme's error by comparing it against the exact analytical solution for a steady $1$D convection-diffusion problem . This allows you to numerically investigate how the scheme's inherent numerical diffusion interacts with the physical diffusion, and how this interplay is governed by the mesh size and the Peclet number, $Pe$.",
            "id": "3386667",
            "problem": "Consider the one-dimensional, steady convection–diffusion boundary-value problem on the dimensionless domain $x \\in [0,1]$ with constant material properties and constant velocity, governed by the conservation of a passive scalar $\\phi(x)$:\n$$\n\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0,\n$$\nsubject to Dirichlet boundary conditions $\\phi(0) = \\phi_0$ and $\\phi(1) = \\phi_1$. Assume $\\Gamma  0$, $\\rho  0$, and $u  0$ are constants. Define the dimensionless global Peclet number as\n$$\nP = \\frac{\\rho u L}{\\Gamma},\n$$\nwith $L = 1$, and the uniform mesh consisting of $N$ finite volumes with spacing $\\Delta x = \\frac{1}{N}$. Let the interior face locations be $x_f = j \\Delta x$ for $j = 1,2,\\dots,N-1$, and cell-center locations be $x_j = \\left(j - \\frac{1}{2}\\right)\\Delta x$ for $j = 1,2,\\dots,N$. Define the local cell Peclet number as\n$$\nPe = \\frac{P}{N}.\n$$\n\nUsing the Finite Volume Method (FVM), the convective flux through a face requires an approximation of the face value $\\phi_f$. The upwind interpolation for face values prescribes, for positive velocity $u  0$, the face value at the interior face between cells $j$ and $j+1$ as\n$$\n\\phi_f^{\\text{up}} = \\phi(x_j),\n$$\nwhere $\\phi(x_j)$ denotes the cell-center value. The exact face value is $\\phi(x_f)$, where $\\phi(x)$ is the exact continuous solution of the boundary-value problem.\n\nYour task is to:\n- Derive the exact continuous solution $\\phi(x)$ using the governing equation and boundary conditions.\n- For each test case specified below, compute the error incurred by upwind interpolation at all interior faces defined as\n$$\ne_j = \\phi_f^{\\text{up}} - \\phi(x_f) = \\phi(x_j) - \\phi(x_f),\n$$\nand report two scalar metrics:\n    1. The maximum absolute error over all interior faces,\n    $$\n    E_{\\infty} = \\max_{1 \\le j \\le N-1} |e_j|.\n    $$\n    2. The mean absolute error over all interior faces,\n    $$\n    E_{\\text{mean}} = \\frac{1}{N-1} \\sum_{j=1}^{N-1} |e_j|.\n    $$\n- Use boundary values $\\phi_0 = 0$ and $\\phi_1 = 1$.\n\nAll quantities are dimensionless. The final output must be the aggregated results over the test suite printed as a single line containing a list of two-element lists, where each inner list is $[E_{\\infty}, E_{\\text{mean}]$ for the corresponding test case, in the order listed below.\n\nTest suite:\n1. $P = 0.0$, $N = 4$.\n2. $P = 0.1$, $N = 10$.\n3. $P = 2.0$, $N = 10$.\n4. $P = 2.0$, $N = 40$.\n5. $P = 10.0$, $N = 10$.\n6. $P = 10.0$, $N = 100$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[[r_{11}, r_{12}], [r_{21}, r_{22}], \\dots]$, where each $r_{ij}$ is a floating-point number representing $E_{\\infty}$ or $E_{\\text{mean}}$ for the corresponding test case.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and complete. All necessary information is provided, and the concepts are standard in the field of transport phenomena and computational fluid dynamics. The task is to derive the exact solution to the 1D steady convection-diffusion equation and then compute the error of the first-order upwind interpolation scheme for a given set of parameters.\n\n### Step 1: Derivation of the Exact Analytical Solution\n\nThe governing equation for the steady-state, one-dimensional convection-diffusion of a passive scalar $\\phi(x)$ is given as:\n$$\n\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0\n$$\nAssuming the diffusion coefficient $\\Gamma$, density $\\rho$, and velocity $u$ are constant, the equation simplifies to a second-order linear ordinary differential equation (ODE) with constant coefficients:\n$$\n\\Gamma \\frac{d^2 \\phi}{dx^2} - \\rho u \\frac{d \\phi}{dx} = 0\n$$\nDividing by $\\Gamma$ (since $\\Gamma  0$):\n$$\n\\frac{d^2 \\phi}{dx^2} - \\frac{\\rho u}{\\Gamma} \\frac{d \\phi}{dx} = 0\n$$\nThe problem defines the global Peclet number as $P = \\frac{\\rho u L}{\\Gamma}$ with the domain length $L=1$. Substituting this into the ODE gives:\n$$\n\\frac{d^2 \\phi}{dx^2} - P \\frac{d \\phi}{dx} = 0\n$$\nThe characteristic equation for this ODE is $r^2 - Pr = 0$, which yields two distinct roots: $r_1 = 0$ and $r_2 = P$.\n\n**Case 1: $P \\neq 0$**\nThe general solution is of the form $\\phi(x) = C_1 e^{r_1 x} + C_2 e^{r_2 x}$, which becomes:\n$$\n\\phi(x) = C_1 + C_2 e^{Px}\n$$\nThe constants of integration, $C_1$ and $C_2$, are determined by the Dirichlet boundary conditions $\\phi(0) = \\phi_0$ and $\\phi(1) = \\phi_1$.\nAt $x=0$:\n$$\n\\phi(0) = C_1 + C_2 e^0 = C_1 + C_2 = \\phi_0\n$$\nAt $x=1$:\n$$\n\\phi(1) = C_1 + C_2 e^P = \\phi_1\n$$\nSolving this system of linear equations for $C_1$ and $C_2$:\nFrom the first equation, $C_1 = \\phi_0 - C_2$. Substituting into the second equation:\n$$\n(\\phi_0 - C_2) + C_2 e^P = \\phi_1 \\implies C_2(e^P - 1) = \\phi_1 - \\phi_0 \\implies C_2 = \\frac{\\phi_1 - \\phi_0}{e^P - 1}\n$$\nThen, $C_1$ is found:\n$$\nC_1 = \\phi_0 - \\frac{\\phi_1 - \\phi_0}{e^P - 1} = \\frac{\\phi_0(e^P - 1) - (\\phi_1 - \\phi_0)}{e^P - 1} = \\frac{\\phi_0 e^P - \\phi_1}{e^P - 1}\n$$\nSubstituting $C_1$ and $C_2$ back into the general solution gives:\n$$\n\\phi(x) = \\frac{\\phi_0 e^P - \\phi_1}{e^P - 1} + \\left(\\frac{\\phi_1 - \\phi_0}{e^P - 1}\\right) e^{Px} = \\phi_0 + (\\phi_1 - \\phi_0) \\frac{e^{Px} - 1}{e^P - 1}\n$$\nFor the specific boundary conditions $\\phi_0 = 0$ and $\\phi_1 = 1$, the exact solution simplifies to:\n$$\n\\phi(x) = \\frac{e^{Px} - 1}{e^P - 1}\n$$\n\n**Case 2: $P = 0$**\nWhen $P=0$, the governing equation reduces to the pure diffusion equation:\n$$\n\\frac{d^2 \\phi}{dx^2} = 0\n$$\nIntegrating twice yields a linear solution: $\\phi(x) = C_1 x + C_2$.\nApplying the boundary conditions $\\phi(0) = \\phi_0 = 0$ and $\\phi(1) = \\phi_1 = 1$:\nAt $x=0$: $\\phi(0) = C_2 = 0$.\nAt $x=1$: $\\phi(1) = C_1 + C_2 = C_1 = 1$.\nThus, for $P=0$, the exact solution is:\n$$\n\\phi(x) = x\n$$\nThis result is consistent with the limit of the $P \\neq 0$ solution as $P \\to 0$, which can be verified using L'Hôpital's rule.\n\n### Step 2: Error Calculation Methodology\n\nThe problem requires the calculation of the error incurred by the first-order upwind interpolation scheme at each interior control volume face. The mesh has $N$ uniform volumes of width $\\Delta x = 1/N$.\n\n- The interior faces are located at $x_f = j \\Delta x$ for $j = 1, 2, \\ldots, N-1$.\n- The cell centers are located at $x_j = (j - 1/2) \\Delta x$ for $j = 1, 2, \\ldots, N$.\n\nThe problem states that for positive velocity ($u>0$), the convective flow is from left to right. The upwind value at the face between cell $j$ and cell $j+1$ (located at $x_f = j\\Delta x$) is the value from the center of the upwind cell, which is cell $j$. The center of cell $j$ is at $x_j = (j - 1/2)\\Delta x$. Therefore, the upwind approximation for the face value is:\n$$\n\\phi_f^{\\text{up}} = \\phi(x_j) = \\phi\\left(\\left(j - \\frac{1}{2}\\right)\\Delta x\\right)\n$$\nThe exact value at the same face is $\\phi(x_f) = \\phi(j\\Delta x)$.\n\nThe interpolation error at the $j$-th interior face, $e_j$, is defined as the difference between the upwind approximation and the exact face value:\n$$\ne_j = \\phi_f^{\\text{up}} - \\phi(x_f) = \\phi\\left(\\left(j - \\frac{1}{2}\\right)\\Delta x\\right) - \\phi(j\\Delta x)\n$$\nThis calculation is performed for all interior faces, i.e., for $j = 1, 2, \\ldots, N-1$.\n\n### Step 3: Numerical Procedure and Error Metrics\n\nFor each test case, defined by a pair of values $(P, N)$, the following procedure is executed:\n1.  Determine the appropriate form of the exact solution $\\phi(x)$ based on the value of $P$.\n2.  Calculate the mesh spacing $\\Delta x = 1/N$.\n3.  For each interior face index $j$ from $1$ to $N-1$:\n    a. Determine the upwind cell center coordinate: $x_{\\text{cell}} = (j - 1/2)\\Delta x$.\n    b. Determine the face coordinate: $x_{\\text{face}} = j\\Delta x$.\n    c. Evaluate the exact solution at both points: $\\phi(x_{\\text{cell}})$ and $\\phi(x_{\\text{face}})$.\n    d. Compute the error: $e_j = \\phi(x_{\\text{cell}}) - \\phi(x_{\\text{face}})$.\n4.  After computing the array of errors $\\{e_1, e_2, \\ldots, e_{N-1}\\}$, calculate the two required metrics:\n    a. The maximum absolute error (infinity norm):\n       $$\n       E_{\\infty} = \\max_{1 \\le j \\le N-1} |e_j|\n       $$\n    b. The mean absolute error:\n       $$\n       E_{\\text{mean}} = \\frac{1}{N-1} \\sum_{j=1}^{N-1} |e_j|\n       $$\n5.  The pair $[E_{\\infty}, E_{\\text{mean}}]$ constitutes the result for one test case. This is repeated for all test cases provided. For numerical robustness, the expression $\\frac{e^A-1}{e^B-1}$ is implemented as `np.expm1(A) / np.expm1(B)` to maintain precision for small arguments.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady convection-diffusion problem to find the error\n    of the upwind interpolation scheme for a series of test cases.\n    \"\"\"\n    \n    # Test cases as a list of tuples (P, N).\n    # P: global Peclet number, N: number of finite volumes.\n    test_cases = [\n        (0.0, 4),\n        (0.1, 10),\n        (2.0, 10),\n        (2.0, 40),\n        (10.0, 10),\n        (10.0, 100),\n    ]\n\n    results = []\n    \n    def exact_solution(x, P):\n        \"\"\"\n        Computes the exact solution phi(x) for the given Peclet number P.\n        \n        Args:\n            x (float or np.ndarray): The spatial coordinate(s).\n            P (float): The global Peclet number.\n            \n        Returns:\n            float or np.ndarray: The value(s) of the scalar phi.\n        \"\"\"\n        # A small tolerance to handle the P=0 case numerically.\n        if np.abs(P)  1e-9:\n            # Linear solution for pure diffusion (P=0).\n            # The .copy() is important if x is an array to avoid modifying it.\n            return x.copy() if isinstance(x, np.ndarray) else x\n        else:\n            # Exponential solution for convection-diffusion (P!=0).\n            # np.expm1(z) computes exp(z) - 1 with high precision for small z.\n            return np.expm1(P * x) / np.expm1(P)\n\n    for P, N in test_cases:\n        # Calculate mesh spacing.\n        dx = 1.0 / N\n\n        # Define indices for interior faces.\n        # j runs from 1 to N-1 for the N-1 interior faces.\n        j_indices = np.arange(1, N)\n\n        # Calculate coordinates of upwind cell centers and face centers.\n        # For a face at j*dx, the upwind cell center (for u0) is at (j-0.5)*dx.\n        x_cells = (j_indices - 0.5) * dx\n        x_faces = j_indices * dx\n        \n        # Evaluate the exact solution at these locations.\n        phi_cells = exact_solution(x_cells, P)\n        phi_faces = exact_solution(x_faces, P)\n\n        # The upwind interpolation error at each face.\n        errors = phi_cells - phi_faces\n        \n        # Calculate the absolute errors.\n        abs_errors = np.abs(errors)\n        \n        # Compute the required error metrics.\n        if N  1:\n            E_infinity = np.max(abs_errors)\n            E_mean = np.mean(abs_errors)\n        else: # Handle the edge case of N=1 where there are no interior faces.\n            E_infinity = 0.0\n            E_mean = 0.0\n\n        results.append([E_infinity, E_mean])\n\n    # Format the final output string as specified.\n    # The str() representation of a list is '[val1, val2, ...]'\n    # Joining these with commas gives the desired format '[...],[...]'\n    # The outer f-string adds the final enclosing brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "The first-order upwind scheme is robust but diffusive, smearing sharp gradients across just a few grid cells. This final practice introduces an elegant solution: the Flux-Corrected Transport (FCT) algorithm . You will implement Zalesak’s limiter to add a high-order, anti-diffusive correction to the upwind solution, in a way that strictly preserves local bounds and prevents new oscillations, demonstrating a powerful technique for creating sharp yet stable advection schemes.",
            "id": "3386694",
            "problem": "Consider the one-dimensional linear advection of a passive scalar field described by the conservation law $\\partial_t \\phi + \\partial_x (u \\phi) = 0$ on a periodic domain $[0,1]$. Use a conservative finite-volume formulation with a uniform mesh of $N$ cells and constant velocity $u$. The face fluxes must be computed using first-order upwind interpolation, and then augmented by an anti-diffusive flux correction limited by Zalesak’s Flux-Corrected Transport (FCT) algorithm to strictly enforce local bounds. The Courant-Friedrichs-Lewy (CFL) number is defined by $\\lambda = u \\Delta t / \\Delta x$, and you must ensure that the numerical time step $\\Delta t$ satisfies $\\Delta t = \\text{CFL} \\cdot \\Delta x / |u|$ for a given $\\text{CFL} \\in (0,1)$.\n\nYour task is to implement a complete program that:\n- Constructs the low-order solution by conservative finite-volume update using first-order upwind face values for fluxes.\n- Constructs an unlimited high-order approximation for face fluxes (e.g., a second-order, dispersive-accurate approximation) and defines the anti-diffusive flux as the difference between the high-order and low-order face fluxes.\n- Applies Zalesak’s Flux-Corrected Transport (FCT) limiting procedure to the anti-diffusive flux so that the corrected update preserves local bounds. The local bounds at each cell $i$ must be defined as $u_i^{\\min} = \\min\\{\\phi_{i-1}^{\\text{LO}}, \\phi_i^{\\text{LO}}, \\phi_{i+1}^{\\text{LO}}\\}$ and $u_i^{\\max} = \\max\\{\\phi_{i-1}^{\\text{LO}}, \\phi_i^{\\text{LO}}, \\phi_{i+1}^{\\text{LO}}\\}$, where $\\phi^{\\text{LO}}$ denotes the low-order (upwind) updated values and periodic indexing is used. The Zalesak limiter must distribute the anti-diffusive flux pairwise across faces so that each cell’s corrected value remains within $[u_i^{\\min}, u_i^{\\max}]$ while maintaining conservation.\n\nYou must start from the fundamental base of discrete conservation and face-based fluxes: for each cell $i$, the update is $\\phi_i^{n+1} = \\phi_i^{n} - (\\Delta t / \\Delta x) \\left(F_{i+1/2} - F_{i-1/2}\\right)$, and the FCT correction must be realized as a limited redistribution of the anti-diffusive flux differences while respecting the above local bounds.\n\nDefine the following sharpness metric. For any scalar field array $\\phi$, the interface width $W(\\phi)$ is the number of cells whose values lie strictly between $0.1$ and $0.9$. This metric is intended to measure the thickness of a transported step: a smaller $W(\\phi)$ indicates a sharper interface.\n\nVerification requirements:\n- Sharpness preservation: the interface width of the FCT-corrected solution must be less than or equal to that of the pure upwind solution when transporting a step profile, i.e., $W(\\phi^{\\text{FCT}}) \\le W(\\phi^{\\text{UP}})$.\n- Bound preservation: at every time step, for each cell $i$, the corrected value must satisfy $u_i^{\\min} \\le \\phi_i^{\\text{FCT}} \\le u_i^{\\max}$, using the bounds as defined above from the low-order update at that time step.\n\nImplement periodic boundary conditions for all cases. Angles do not appear in this problem; all quantities are dimensionless. The outputs are booleans.\n\nTest suite:\n- Case $1$: $N=200$, $u=1$, $\\text{CFL}=0.8$, steps $=50$, initial condition is a unit step: $\\phi(x)=1$ for $x \\in [0.25,0.75)$ and $\\phi(x)=0$ otherwise (interpreted on the mesh).\n- Case $2$: $N=200$, $u=-1$, $\\text{CFL}=0.8$, steps $=50$, initial condition is the same unit step.\n- Case $3$: $N=200$, $u=1$, $\\text{CFL}=0.99$, steps $=50$, initial condition is the same unit step.\n- Case $4$: $N=200$, $u=1$, $\\text{CFL}=0.2$, steps $=200$, initial condition is the same unit step.\n- Case $5$: $N=200$, $u=1$, $\\text{CFL}=0.8$, steps $=50$, initial condition is a constant field $\\phi(x)=0.3$.\n\nFor each case, compute:\n- A boolean asserting sharpness preservation $W(\\phi^{\\text{FCT}}) \\le W(\\phi^{\\text{UP}})$.\n- A boolean asserting bound preservation at every time step.\n\nAggregate these two checks per case using logical conjunction (i.e., “both must be true”), producing one boolean per case.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$), with exactly five boolean entries corresponding to the five test cases in the order presented above.",
            "solution": "The problem requires the implementation and validation of a numerical scheme for the one-dimensional linear advection equation. The scheme must be based on the Flux-Corrected Transport (FCT) methodology, specifically using Zalesak's limiter to ensure the preservation of local bounds.\n\nThe governing partial differential equation (PDE) is the conservation law for a passive scalar field $\\phi(x,t)$:\n$$\n\\partial_t \\phi + \\partial_x (u \\phi) = 0\n$$\nThis equation is solved on a periodic domain $x \\in [0,1]$ with a constant velocity $u$. We employ a conservative finite-volume method on a uniform mesh of $N$ cells, each of width $\\Delta x = 1/N$. The cell-averaged value in cell $i$ at time step $n$ is denoted by $\\phi_i^n$. The discrete conservation law for cell $i$ is:\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i+1/2}$ is the numerical flux across the face between cell $i$ and cell $i+1$, and $\\Delta t$ is the time step, given by $\\Delta t = \\text{CFL} \\cdot \\Delta x / |u|$ for a specified Courant-Friedrichs-Lewy (CFL) number, $\\text{CFL} \\in (0,1)$.\n\nThe FCT algorithm is a multi-stage process designed to combine the robustness of a low-order, monotone scheme with the accuracy of a high-order scheme, while strictly preventing the formation of new, non-physical oscillations. The procedure for advancing the solution from time $t^n$ to $t^{n+1}$ is as follows:\n\n**Step 1: Low-Order Solution (Transport and Diffusion)**\n\nFirst, a monotone but diffusive low-order solution, denoted $\\phi^{\\text{LO}}$, is computed. The problem specifies using first-order upwind fluxes, $F^L$. The upwind flux at face $i+1/2$ depends on the sign of the velocity $u$:\n$$\nF^L_{i+1/2} =\n\\begin{cases}\n    u \\phi_i^n  \\text{if } u  0 \\\\\n    u \\phi_{i+1}^n  \\text{if } u  0\n\\end{cases}\n$$\nThis can be written compactly as $F^L_{i+1/2} = \\frac{u+|u|}{2}\\phi_i^n + \\frac{u-|u|}{2}\\phi_{i+1}^n$. The low-order solution is then updated:\n$$\n\\phi_i^{\\text{LO}} = \\phi_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F^L_{i+1/2} - F^L_{i-1/2} \\right)\n$$\nThis guarantees that $\\phi^{\\text{LO}}$ will be free of new extrema, but sharp gradients in the solution will be smeared out (numerical diffusion).\n\n**Step 2: Definition of Anti-Diffusive Fluxes**\n\nNext, high-order fluxes, $F^H$, are computed. A standard choice, which we adopt here, is based on a second-order central average of $\\phi$ at the cell face:\n$$\nF^H_{i+1/2} = u \\left( \\frac{\\phi_i^n + \\phi_{i+1}^n}{2} \\right)\n$$\nThe anti-diffusive flux, $A_{i+1/2}$, is defined as the difference between the high-order and low-order fluxes. It represents the amount of numerical diffusion introduced by the low-order scheme that we wish to correct.\n$$\nA_{i+1/2} = F^H_{i+1/2} - F^L_{i+1/2}\n$$\nThe FCT method aims to add back a limited portion of this anti-diffusive flux to the low-order solution. An unlimited application would yield a high-order solution, which can introduce non-physical oscillations.\n\n**Step 3: Limiting the Anti-Diffusive Fluxes (Zalesak's Limiter)**\n\nThis step is the core of FCT. We seek corrected anti-diffusive fluxes, $A^c$, such that the final updated solution,\n$$\n\\phi_i^{n+1} = \\phi_i^{\\text{LO}} - \\frac{\\Delta t}{\\Delta x} \\left( A^c_{i+1/2} - A^c_{i-1/2} \\right)\n$$\nis guaranteed to lie within local bounds derived from the monotone, low-order solution. The problem specifies these bounds for each cell $i$ as:\n$$\nu_i^{\\min} = \\min\\{\\phi_{i-1}^{\\text{LO}}, \\phi_i^{\\text{LO}}, \\phi_{i+1}^{\\text{LO}}\\}\n$$\n$$\nu_i^{\\max} = \\max\\{\\phi_{i-1}^{\\text{LO}}, \\phi_i^{\\text{LO}}, \\phi_{i+1}^{\\text{LO}}\\}\n$$\nwhere periodic indexing is used for cells $i-1$ and $i+1$. To enforce the condition $u_i^{\\min} \\le \\phi_i^{n+1} \\le u_i^{\\max}$, we must limit the net anti-diffusive flux into each cell. Zalesak's flux-based limiter achieves this as follows:\n\n1.  For each cell $i$, calculate the sum of all raw anti-diffusive fluxes that would increase its value, $S_i^+$, and the sum of all fluxes that would decrease its value, $S_i^-$. With periodic indexing where $A_{i-1/2}$ is retrieved from `A[i-1]`:\n    $$\n    S_i^+ = \\max(0, A_{i-1/2}) - \\min(0, A_{i+1/2})\n    $$\n    $$\n    S_i^- = \\max(0, A_{i+1/2}) - \\min(0, A_{i-1/2})\n    $$\n2.  Calculate the total room for increase, $Q_i^+$, and decrease, $Q_i^-$, in cell $i$ before violating the local bounds, scaled by the flux update factor $\\nu = \\Delta t/\\Delta x$:\n    $$\n    Q_i^+ = u_i^{\\max} - \\phi_i^{\\text{LO}}\n    $$\n    $$\n    Q_i^- = \\phi_i^{\\text{LO}} - u_i^{\\min}\n    $$\n3.  Compute the limiting ratios $R_i^+$ and $R_i^-$ for cell $i$. These ratios determine the fraction of the increasing/decreasing fluxes that can be allowed without causing an overshoot/undershoot.\n    $$\n    R_i^+ = \\min\\left(1, \\frac{Q_i^+}{\\nu S_i^+}\\right) \\quad \\text{if } S_i^+  0, \\text{ else } R_i^+=1\n    $$\n    $$\n    R_i^- = \\min\\left(1, \\frac{Q_i^-}{\\nu S_i^-}\\right) \\quad \\text{if } S_i^-  0, \\text{ else } R_i^-=1\n    $$\n4.  Each flux $A_{i+1/2}$ is an out-flux for cell $i$ and an in-flux for cell $i+1$. It must therefore be limited by the constraints of both cells. The correction factor $C_{i+1/2}$ for the flux $A_{i+1/2}$ is determined by:\n    - If $A_{i+1/2}  0$ (decreases $\\phi_i$, increases $\\phi_{i+1}$): $C_{i+1/2} = \\min(R_i^-, R_{i+1}^+)$\n    - If $A_{i+1/2}  0$ (increases $\\phi_i$, decreases $\\phi_{i+1}$): $C_{i+1/2} = \\min(R_i^+, R_{i+1}^-)$\n    - If $A_{i+1/2} = 0$: $C_{i+1/2} = 0$\n5. The corrected anti-diffusive flux is then $A^c_{i+1/2} = C_{i+1/2} \\cdot A_{i+1/2}$.\n\n**Step 4: Final Corrective Update**\nThe final solution at time $t^{n+1}$ is computed by applying the correction to the low-order solution:\n$$\n\\phi_i^{n+1} = \\phi_i^{\\text{LO}} - \\frac{\\Delta t}{\\Delta x} \\left( A^c_{i+1/2} - A^c_{i-1/2} \\right)\n$$\nBy construction, this procedure guarantees that $\\phi_i^{n+1}$ will respect the local bounds $[u_i^{\\min}, u_i^{\\max}]$ for all $i$, thereby ensuring monotonicity.\n\n**Verification Metrics**\nThe problem requires verifying two properties:\n1.  **Bound Preservation**: At every time step, and for every cell $i$, the condition $u_i^{\\min} \\le \\phi_i^{\\text{FCT}} \\le u_i^{\\max}$ must hold. A small floating-point tolerance is used in practice for this check.\n2.  **Sharpness Preservation**: The interface width $W(\\phi)$, defined as the number of cells with values satisfying $0.1  \\phi_i  0.9$, must be smaller for the FCT solution than for the pure upwind solution, i.e., $W(\\phi^{\\text{FCT}}) \\le W(\\phi^{\\text{UP}})$. This demonstrates that the anti-diffusive correction effectively reduces numerical smearing.\n\nThe provided test suite evaluates the scheme under various conditions, including different advection directions, CFL numbers, and initial profiles, ensuring a robust assessment of the implementation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the FCT simulation for all test cases.\n    \"\"\"\n\n    def run_simulation(N, u, cfl, steps, phi0, use_fct):\n        \"\"\"\n        Runs a 1D advection simulation using either pure upwind or FCT.\n        \"\"\"\n        dx = 1.0 / N\n        dt = cfl * dx / abs(u)\n        nu = dt / dx\n\n        # Epsilon for float comparisons and division by zero prevention\n        epsilon = 1e-12\n\n        phi = phi0.copy()\n        bounds_ok = True\n\n        # Pre-calculate positive and negative parts of velocity for upwind flux\n        u_pos = max(u, 0.0)\n        u_neg = min(u, 0.0)\n\n        for _ in range(steps):\n            # For periodic BC, get previous and next cell values\n            phi_prev = np.roll(phi, 1)\n            phi_next = np.roll(phi, -1)\n\n            # Step 1: Low-Order Solution (Upwind)\n            # Flux at i+1/2 face: F_L = u_pos * phi_i + u_neg * phi_{i+1}\n            F_L = u_pos * phi + u_neg * phi_next\n            # We need F_L at i-1/2, which is F_L[i-1] for cell i a.k.a roll(F_L, 1)\n            F_L_prev = np.roll(F_L, 1)\n            \n            # Update to get the low-order, transported and diffused solution\n            phi_lo = phi - nu * (F_L - F_L_prev)\n\n            if not use_fct:\n                phi = phi_lo\n                continue\n            \n            # --- FCT Correction Stages ---\n            \n            # Define local bounds from the low-order solution\n            phi_lo_prev = np.roll(phi_lo, 1)\n            phi_lo_next = np.roll(phi_lo, -1)\n            u_max = np.maximum(np.maximum(phi_lo_prev, phi_lo), phi_lo_next)\n            u_min = np.minimum(np.minimum(phi_lo_prev, phi_lo), phi_lo_next)\n\n            # Step 2: Define Anti-diffusive Fluxes\n            # High-order flux (central difference) at i+1/2 face\n            F_H = u * (phi + phi_next) / 2.0\n            # Anti-diffusive flux at i+1/2 face\n            A = F_H - F_L\n            A_prev = np.roll(A, 1)\n\n            # Step 3: Limit Anti-diffusive Fluxes (Zalesak's Limiter)\n            # Sum of fluxes increasing/decreasing phi_i\n            S_plus = np.maximum(0, A_prev) - np.minimum(0, A)\n            S_minus = np.maximum(0, A) - np.minimum(0, A_prev)\n            \n            # Available room for increase/decrease in phi_i\n            Q_plus = u_max - phi_lo\n            Q_minus = phi_lo - u_min\n\n            # Calculate correction ratios R+ and R-\n            R_plus = np.ones(N)\n            mask_s_plus = S_plus  epsilon\n            R_plus[mask_s_plus] = np.minimum(1.0, Q_plus[mask_s_plus] / (nu * S_plus[mask_s_plus]))\n\n            R_minus = np.ones(N)\n            mask_s_minus = S_minus  epsilon\n            R_minus[mask_s_minus] = np.minimum(1.0, Q_minus[mask_s_minus] / (nu * S_minus[mask_s_minus]))\n            \n            # Determine correction factor C for each face i+1/2\n            C = np.zeros(N)\n            R_plus_next = np.roll(R_plus, -1)\n            R_minus_next = np.roll(R_minus, -1)\n\n            mask_A_pos = A  0\n            C[mask_A_pos] = np.minimum(R_minus[mask_A_pos], R_plus_next[mask_A_pos])\n            \n            mask_A_neg = A  0\n            C[mask_A_neg] = np.minimum(R_plus[mask_A_neg], R_minus_next[mask_A_neg])\n\n            # Calculate corrected fluxes\n            A_c = C * A\n            A_c_prev = np.roll(A_c, 1)\n\n            # Step 4: Corrective Update\n            phi = phi_lo - nu * (A_c - A_c_prev)\n\n            # Verify bounds preservation\n            if not np.all((phi = u_min - epsilon)  (phi = u_max + epsilon)):\n                bounds_ok = False\n\n        return phi, bounds_ok\n\n    def get_interface_width(phi):\n        \"\"\"\n        Calculates the sharpness metric W(phi).\n        \"\"\"\n        return np.sum((phi  0.1)  (phi  0.9))\n    \n    # Test cases defined in the problem statement\n    test_cases = [\n        {'N': 200, 'u': 1, 'cfl': 0.8, 'steps': 50, 'ic': 'step'},\n        {'N': 200, 'u': -1, 'cfl': 0.8, 'steps': 50, 'ic': 'step'},\n        {'N': 200, 'u': 1, 'cfl': 0.99, 'steps': 50, 'ic': 'step'},\n        {'N': 200, 'u': 1, 'cfl': 0.2, 'steps': 200, 'ic': 'step'},\n        {'N': 200, 'u': 1, 'cfl': 0.8, 'steps': 50, 'ic': 'const'}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        x_centers = (np.arange(N) + 0.5) / N\n        \n        if case['ic'] == 'step':\n            phi0 = np.zeros(N)\n            phi0[(x_centers = 0.25)  (x_centers  0.75)] = 1.0\n        elif case['ic'] == 'const':\n            phi0 = np.full(N, 0.3)\n        else:\n            raise ValueError(f\"Unknown initial condition: {case['ic']}\")\n            \n        params = (N, case['u'], case['cfl'], case['steps'], phi0)\n\n        # Run pure upwind simulation\n        phi_upwind, _ = run_simulation(*params, use_fct=False)\n        \n        # Run FCT simulation\n        phi_fct, bounds_ok = run_simulation(*params, use_fct=True)\n\n        # Verification checks\n        W_upwind = get_interface_width(phi_upwind)\n        W_fct = get_interface_width(phi_fct)\n        sharpness_ok = W_fct = W_upwind\n\n        # Aggregate results\n        results.append(sharpness_ok and bounds_ok)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\".lower())\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}