{
    "hands_on_practices": [
        {
            "introduction": "Understanding pressure-velocity decoupling begins with a rigorous analysis of the discrete operators at the heart of a collocated grid finite volume method. This exercise utilizes the Method of Manufactured Solutions (MMS) to isolate the fundamental flaw in a naive collocated discretization . By constructing velocity fields from both smooth and checkerboard pressure fields and evaluating the resulting discrete divergence, you will gain a clear, first-principles understanding of why the standard scheme is \"blind\" to the checkerboard mode, causing it to reside in the null space of the discrete pressure-Poisson operator.",
            "id": "3354196",
            "problem": "Consider a two-dimensional, incompressible, steady flow on a square domain $\\Omega = [0,1] \\times [0,1]$ with periodic boundary conditions. The flow is discretized on a uniform, collocated, Cartesian grid with $N \\times N$ control volumes of size $\\Delta x = \\Delta y = 1/N$. The objective is to examine pressure–velocity decoupling and checkerboarding on a collocated grid using Verification by Manufactured Solutions (MMS) and to quantify the behavior of the discrete divergence when face velocities are formed from pressure gradients with and without stabilization.\n\nFundamental base:\n- Incompressible mass conservation requires $\\nabla \\cdot \\mathbf{u} = 0$.\n- On a collocated grid in a Finite Volume Method (FVM), the discrete continuity residual at a cell $(i,j)$ is defined by\n$$\nR_{i,j} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y},\n$$\nwhere $u_{e,i,j}$ and $u_{w,i,j}$ are the east and west face velocities of cell $(i,j)$, and $v_{n,i,j}$ and $v_{s,i,j}$ are the north and south face velocities of cell $(i,j)$. Periodicity implies that indices wrap: $i+1$ maps to $0$ if $i = N-1$, and $i-1$ maps to $N-1$ if $i = 0$; analogously for $j$.\n\nManufactured solutions:\n- Define two manufactured pressure fields on cell centers $(x_i, y_j) = \\left(\\frac{i+1/2}{N}, \\frac{j+1/2}{N}\\right)$:\n  1. A smooth field:\n  $$\n  p(x_i, y_j) = \\sin(2\\pi x_i) \\sin(2\\pi y_j).\n  $$\n  2. A discrete checkerboard field:\n  $$\n  p_{i,j} = (-1)^{i+j}.\n  $$\n- Define a linear, diffusion-dominant pressure–velocity response at cell centers that approximates the discrete momentum balance under a collocated FVM as\n$$\nu_{i,j} = -\\kappa_c \\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\\right), \\quad v_{i,j} = -\\kappa_c \\left(\\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}\\right),\n$$\nwhere $\\kappa_c > 0$ is a dimensionless compliance parameter. This algebraic closure models the leading-order pressure-to-velocity coupling of a diffusion-dominant discretization.\n\nFace-velocity formation schemes to be investigated:\n- A collocated, central interpolation scheme that forms face velocities by averaging neighboring cell-centered velocities:\n  - East and west faces:\n  $$\n  u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i-1,j} + u_{i,j}}{2}.\n  $$\n  - North and south faces:\n  $$\n  v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j-1} + v_{i,j}}{2}.\n  $$\n- A Rhie–Chow-like stabilized face interpolation that augments face velocities by a pressure-difference term consistent with a diffusion-dominant discretization:\n  - East and west faces:\n  $$\n  u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\kappa_f \\left[\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x} - \\frac{1}{2}\\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x} + \\frac{p_{i+2,j} - p_{i,j}}{2\\Delta x}\\right)\\right],\n  $$\n  $$\n  u_{w,i,j} = \\frac{u_{i-1,j} + u_{i,j}}{2} - \\kappa_f \\left[\\frac{p_{i,j} - p_{i-1,j}}{\\Delta x} - \\frac{1}{2}\\left(\\frac{p_{i,j} - p_{i-2,j}}{2\\Delta x} + \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\\right)\\right],\n  $$\n  - North and south faces:\n  $$\n  v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\kappa_f \\left[\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y} - \\frac{1}{2}\\left(\\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y} + \\frac{p_{i,j+2} - p_{i,j}}{2\\Delta y}\\right)\\right],\n  $$\n  $$\n  v_{s,i,j} = \\frac{v_{i,j-1} + v_{i,j}}{2} - \\kappa_f \\left[\\frac{p_{i,j} - p_{i,j-1}}{\\Delta y} - \\frac{1}{2}\\left(\\frac{p_{i,j} - p_{i,j-2}}{2\\Delta y} + \\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}\\right)\\right],\n  $$\n  where all indices are periodic, and $\\kappa_f > 0$ is a dimensionless stabilization parameter. The bracketed terms subtract the interpolated cell-centered pressure gradients from face pressure differences, which suppresses pressure–velocity decoupling.\n\nPerformance metric:\n- For each configuration, compute the discrete continuity residual $R_{i,j}$ over all cells and return the discrete $L^2$ norm\n$$\n\\|R\\|_2 = \\left(\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} R_{i,j}^2\\right)^{1/2}.\n$$\n\nUnits:\n- All quantities are dimensionless; report $\\|R\\|_2$ as a float.\n\nTest suite:\n- Use the following parameter sets $(N, \\text{scheme}, \\text{pressure}, \\kappa_c, \\kappa_f)$:\n  1. $(16, \\text{central}, \\text{smooth}, 1.0, 1.0)$\n  2. $(16, \\text{stabilized}, \\text{smooth}, 1.0, 1.0)$\n  3. $(16, \\text{central}, \\text{checkerboard}, 1.0, 1.0)$\n  4. $(16, \\text{stabilized}, \\text{checkerboard}, 1.0, 1.0)$\n  5. $(5, \\text{stabilized}, \\text{checkerboard}, 1.0, 1.0)$\n  6. $(5, \\text{central}, \\text{checkerboard}, 1.0, 1.0)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), where each result is the $\\|R\\|_2$ value for one test case in the same order as listed above. No additional text should be printed.",
            "solution": "The objective of this problem is to analyze and quantify the numerical phenomenon of pressure–velocity decoupling on a collocated grid. This is accomplished using the Method of Manufactured Solutions (MMS) for two distinct pressure fields and two different face-velocity interpolation schemes. The performance metric is the discrete $L^2$ norm of the continuity residual, $\\|R\\|_2$.\n\nThe governing principle is the conservation of mass for an incompressible flow, which requires the divergence of the velocity field to be zero: $\\nabla \\cdot \\mathbf{u} = 0$. In a collocated grid finite volume discretization, this is expressed for each control volume $(i,j)$ by the discrete continuity residual, $R_{i,j}$:\n$$\nR_{i,j} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}\n$$\nGiven the uniform square grid, $\\Delta x = \\Delta y = h = 1/N$. Thus,\n$$\nR_{i,j} = \\frac{1}{h} (u_{e,i,j} - u_{w,i,j} + v_{n,i,j} - v_{s,i,j})\n$$\nThe procedure involves computing $R_{i,j}$ for all cells $(i,j)$ and then calculating the grid-averaged $L^2$ norm:\n$$\n\\|R\\|_2 = \\left(\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} R_{i,j}^2\\right)^{1/2}\n$$\nThe calculation proceeds in stages:\n$1$. The pressure field $p_{i,j}$ is defined at cell centers $(x_i, y_j) = \\left(\\frac{i+1/2}{N}, \\frac{j+1/2}{N}\\right)$.\n$2$. The cell-centered velocity field, $(u_{i,j}, v_{i,j})$, is calculated from the pressure field using the provided algebraic model, which represents a pressure-driven, diffusion-dominant flow:\n$$\nu_{i,j} = -\\kappa_c \\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2h}\\right), \\quad v_{i,j} = -\\kappa_c \\left(\\frac{p_{i,j+1} - p_{i,j-1}}{2h}\\right)\n$$\nAll indices are handled periodically.\n$3$. The face velocities ($u_{e,i,j}, u_{w,i,j}, v_{n,i,j}, v_{s,i,j}$) are computed from the cell-centered velocities and pressures using either the central or stabilized interpolation scheme.\n$4$. The face velocities are used to compute the residual field $R_{i,j}$, from which the final norm $\\|R\\|_2$ is determined.\n\nLet us analyze the behavior of the schemes.\n\n**1. Central Interpolation Scheme**\nFace velocities are obtained by simple averaging of adjacent cell-centered velocities:\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i-1,j} + u_{i,j}}{2}\n$$\nThe difference in face velocities for cell $(i,j)$ becomes:\n$$\nu_{e,i,j} - u_{w,i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2}\n$$\nAnalogous expressions hold for the $v$-velocities. Substituting these into the residual equation yields:\n$$\nR_{i,j} = \\frac{1}{2h} (u_{i+1,j} - u_{i-1,j} + v_{i,j+1} - v_{i,j-1})\n$$\nBy substituting the definitions of $u_{i,j}$ and $v_{i,j}$, we express the residual purely in terms of pressure:\n$$\nR_{i,j} = \\frac{1}{2h} \\left[ -\\frac{\\kappa_c}{2h}(p_{i+2,j} - p_{i,j}) + \\frac{\\kappa_c}{2h}(p_{i,j} - p_{i-2,j}) \\right] + \\frac{1}{2h} \\left[ -\\frac{\\kappa_c}{2h}(p_{i,j+2} - p_{i,j}) + \\frac{\\kappa_c}{2h}(p_{i,j} - p_{i,j-2}) \\right]\n$$\n$$\nR_{i,j} = -\\frac{\\kappa_c}{4h^2} (p_{i+2,j} + p_{i-2,j} + p_{i,j+2} + p_{i,j-2} - 4p_{i,j})\n$$\nThis is a wide-stencil discrete Laplacian operator. Now, consider the checkerboard pressure field, $p_{i,j} = (-1)^{i+j}$:\n$$\np_{i \\pm 2, j} = (-1)^{i \\pm 2 +j} = (-1)^{i+j} = p_{i,j} \\quad \\text{and} \\quad p_{i, j \\pm 2} = (-1)^{i + j \\pm 2} = (-1)^{i+j} = p_{i,j}\n$$\nThus, for the checkerboard field, the residual is:\n$$\nR_{i,j} = -\\frac{\\kappa_c}{4h^2} (p_{i,j} + p_{i,j} + p_{i,j} + p_{i,j} - 4p_{i,j}) = 0\n$$\nThe discrete divergence is identically zero for this highly oscillatory, non-physical pressure field. This demonstrates that the central differencing scheme on a collocated grid has a null space containing the highest frequency mode, which is the root cause of pressure-velocity decoupling. Consequently, for the central scheme and checkerboard pressure, we must obtain $\\|R\\|_2 = 0$.\n\n**2. Stabilized Rhie–Chow-like Interpolation Scheme**\nThis scheme adds a stabilization term to the face velocity calculation. For the east face:\n$$\nu_{e,i,j} = \\underbrace{\\frac{u_{i,j} + u_{i+1,j}}{2}}_{\\text{central part}} - \\underbrace{\\kappa_f \\left[\\frac{p_{i+1,j} - p_{i,j}}{h} - \\frac{1}{2}\\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2h} + \\frac{p_{i+2,j} - p_{i,j}}{2h}\\right)\\right]}_{\\text{stabilization part}}\n$$\nThe residual $R_{i,j}$ is now the sum of the residual from the central scheme, $R_{i,j}^{\\text{central}}$, and a contribution from the stabilization terms. A careful symbolic manipulation of the stabilization terms for all four faces reveals that their contribution to the residual $R_{i,j}$ is:\n$$\nR_{i,j}^{\\text{stab}} = \\frac{\\kappa_f}{4h^2} \\left[ (p_{i+2,j} - 4p_{i+1,j} + 6p_{i,j} - 4p_{i-1,j} + p_{i-2,j}) + (p_{i,j+2} - 4p_{i,j+1} + 6p_{i,j} - 4p_{i,j-1} + p_{i,j-2}) \\right]\n$$\nThis is a discrete biharmonic operator. Let us analyze its effect on the checkerboard pressure field $p_{i,j} = (-1)^{i+j}$. As established, $R_{i,j}^{\\text{central}}=0$. For the stabilization term, we evaluate the finite differences:\n$$\np_{i+2,j} - 4p_{i+1,j} + 6p_{i,j} - 4p_{i-1,j} + p_{i-2,j} = p_{i,j} - 4(-p_{i,j}) + 6p_{i,j} - 4(-p_{i,j}) + p_{i,j} = (1+4+6+4+1)p_{i,j} = 16p_{i,j}\n$$\nThe same result, $16p_{i,j}$, is obtained for the $j$-direction stencil. Therefore, for the checkerboard field with the stabilized scheme:\n$$\nR_{i,j} = R_{i,j}^{\\text{central}} + R_{i,j}^{\\text{stab}} = 0 + \\frac{\\kappa_f}{4h^2} (16p_{i,j} + 16p_{i,j}) = \\frac{32\\kappa_f}{4h^2}p_{i,j} = \\frac{8\\kappa_f}{h^2}p_{i,j}\n$$\nSubstituting $h=1/N$ and $p_{i,j}=(-1)^{i+j}$ yields:\n$$\nR_{i,j} = 8\\kappa_f N^2 (-1)^{i+j}\n$$\nThis residual is non-zero and large, indicating that the stabilization has successfully eliminated the checkerboard mode from the null space. We can now compute its $L^2$ norm:\n$$\n\\|R\\|_2^2 = \\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} (8\\kappa_f N^2 (-1)^{i+j})^2 = \\frac{1}{N^2}\\sum_{i,j} (8\\kappa_f N^2)^2 = \\frac{1}{N^2} \\cdot N^2 (8\\kappa_f N^2)^2 = (8\\kappa_f N^2)^2\n$$\n$$\n\\|R\\|_2 = 8\\kappa_f N^2\n$$\nThis analytical result provides a precise verification target for the implementation. For a smooth pressure field, the stabilization term is of higher order in $h$ and acts as a small correction, whereas for non-smooth fields it provides the necessary stabilization.\n\nThe following Python program implements the full numerical procedure to compute $\\|R\\|_2$ for each test case as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_one_case(N, scheme, pressure_type, kappa_c, kappa_f):\n    \"\"\"\n    Calculates the L2 norm of the discrete continuity residual for a single test case.\n    \"\"\"\n    h = 1.0 / N\n\n    # 1. Define grid and pressure field\n    i_ = np.arange(N)\n    j_ = np.arange(N)\n    ii, jj = np.meshgrid(i_, j_, indexing='ij')\n\n    if pressure_type == 'smooth':\n        x = (ii + 0.5) * h\n        y = (jj + 0.5) * h\n        p = np.sin(2 * np.pi * x) * np.sin(2 * np.pi * y)\n    elif pressure_type == 'checkerboard':\n        p = (-1.0)**(ii + jj)\n    else:\n        raise ValueError(f\"Unknown pressure type: {pressure_type}\")\n\n    # Pre-roll pressure fields for convenience, handling periodic boundary conditions.\n    # Indices needed are up to i+/-2, j+/-2.\n    p_ip1 = np.roll(p, -1, axis=0)\n    p_im1 = np.roll(p, 1, axis=0)\n    p_ip2 = np.roll(p, -2, axis=0)\n    p_im2 = np.roll(p, 2, axis=0)\n\n    p_jp1 = np.roll(p, -1, axis=1)\n    p_jm1 = np.roll(p, 1, axis=1)\n    p_jp2 = np.roll(p, -2, axis=1)\n    p_jm2 = np.roll(p, 2, axis=1)\n\n    # 2. Compute cell-centered velocities\n    u = -kappa_c * (p_ip1 - p_im1) / (2.0 * h)\n    v = -kappa_c * (p_jp1 - p_jm1) / (2.0 * h)\n\n    # Pre-roll cell-centered velocities for face interpolation\n    u_ip1 = np.roll(u, -1, axis=0)\n    u_im1 = np.roll(u, 1, axis=0)\n    v_jp1 = np.roll(v, -1, axis=1)\n    v_jm1 = np.roll(v, 1, axis=1)\n\n    # 3. Compute face velocities based on the selected scheme\n    if scheme == 'central':\n        u_e = (u + u_ip1) / 2.0\n        u_w = (u_im1 + u) / 2.0\n        v_n = (v + v_jp1) / 2.0\n        v_s = (v_jm1 + v) / 2.0\n    elif scheme == 'stabilized':\n        # Interpolated velocity part (same as central scheme)\n        u_e_interp = (u + u_ip1) / 2.0\n        u_w_interp = (u_im1 + u) / 2.0\n        v_n_interp = (v + v_jp1) / 2.0\n        v_s_interp = (v_jm1 + v) / 2.0\n\n        # Stabilization term for east face 'e' of cell (i,j)\n        grad_p_e = (p_ip1 - p) / h\n        interp_grad_p_e = 0.5 * ((p_ip1 - p_im1) / (2.0*h) + (p_ip2 - p) / (2.0*h))\n        u_e = u_e_interp - kappa_f * (grad_p_e - interp_grad_p_e)\n\n        # Stabilization term for west face 'w' of cell (i,j)\n        grad_p_w = (p - p_im1) / h\n        interp_grad_p_w = 0.5 * ((p - p_im2) / (2.0*h) + (p_ip1 - p_im1) / (2.0*h))\n        u_w = u_w_interp - kappa_f * (grad_p_w - interp_grad_p_w)\n\n        # Stabilization term for north face 'n' of cell (i,j)\n        grad_p_n = (p_jp1 - p) / h\n        interp_grad_p_n = 0.5 * ((p_jp1 - p_jm1) / (2.0*h) + (p_jp2 - p) / (2.0*h))\n        v_n = v_n_interp - kappa_f * (grad_p_n - interp_grad_p_n)\n\n        # Stabilization term for south face 's' of cell (i,j)\n        grad_p_s = (p - p_jm1) / h\n        interp_grad_p_s = 0.5 * ((p - p_jm2) / (2.0*h) + (p_jp1 - p_jm1) / (2.0*h))\n        v_s = v_s_interp - kappa_f * (grad_p_s - interp_grad_p_s)\n    else:\n        raise ValueError(f\"Unknown scheme: {scheme}\")\n\n    # 4. Compute the discrete continuity residual for each cell\n    R = (u_e - u_w) / h + (v_n - v_s) / h\n\n    # 5. Compute the final discrete L2 norm over the grid\n    l2_norm = np.sqrt(np.mean(R**2))\n    \n    return l2_norm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Format: (N, scheme, pressure_type, kappa_c, kappa_f)\n    test_cases = [\n        (16, 'central', 'smooth', 1.0, 1.0),\n        (16, 'stabilized', 'smooth', 1.0, 1.0),\n        (16, 'central', 'checkerboard', 1.0, 1.0),\n        (16, 'stabilized', 'checkerboard', 1.0, 1.0),\n        (5, 'stabilized', 'checkerboard', 1.0, 1.0),\n        (5, 'central', 'checkerboard', 1.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, scheme, pressure_type, kappa_c, kappa_f = case\n        result = solve_one_case(N, scheme, pressure_type, kappa_c, kappa_f)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established the theoretical cause of decoupling, the next practical step is learning to diagnose its presence in simulation data. This practice challenges you to develop a robust toolkit of numerical diagnostics to detect and quantify checkerboard pressure oscillations . You will implement three distinct metrics that operate in both physical and spectral space, including a spectral energy analysis, a gradient-based decoupling ratio, and a nearest-neighbor correlation. Applying these metrics to a suite of test cases will build your skills in identifying and characterizing this common numerical artifact.",
            "id": "3354208",
            "problem": "You are to design and implement diagnostics that quantify and detect pressure–velocity decoupling and odd–even checkerboarding on a two-dimensional, structured, periodic grid. Begin from the incompressible continuity equation and the momentum equation, recognizing that the pressure gradient term must be discretized consistently with the mass flux to avoid decoupling. For collocated grids with naive linear interpolation of pressure to faces, an odd–even pressure mode of the form $p_{i,j} = (-1)^{i+j}$ produces face pressures that cancel and a discrete gradient that collapses, even though physical gradients at one-cell scales are nonzero. This leads to the characteristic checkerboard pathology. Your task is to derive and implement three metrics that detect and quantify this pathology, and then classify several test fields.\n\nFundamental base:\n- The incompressible continuity equation is $\\nabla \\cdot \\mathbf{u} = 0$.\n- The momentum equation includes the pressure gradient term, written as $\\rho \\frac{D \\mathbf{u}}{D t} = -\\nabla p + \\text{other terms}$, where $\\rho$ is the fluid density, $\\mathbf{u}$ is velocity, and $p$ is pressure.\n- On a structured, periodic, uniform grid with $N_x$ cells in the $x$ direction, $N_y$ cells in the $y$ direction, and spacings $\\Delta x$ and $\\Delta y$, a collocated central-difference discretization of $\\nabla p$ at cell centers uses nearest neighbors separated by two cells. A face pressure $p^{x}_{i+1/2,j}$ defined by arithmetic interpolation $p^{x}_{i+1/2,j} = \\frac{1}{2}\\left(p_{i+1,j}+p_{i,j}\\right)$ equals zero for the checkerboard mode, which implies a vanishing face-based discrete gradient $\\frac{p^{x}_{i+1/2,j}-p^{x}_{i-1/2,j}}{\\Delta x} = 0$ even though the one-cell forward difference $\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x}$ is nonzero. This is the essence of pressure–velocity decoupling detectable by odd–even patterns.\n\nDiagnostics to implement:\n- Metric $1$ (Spectral odd–even energy fraction): Use the two-dimensional Discrete Fourier Transform (DFT) of $p_{i,j}$ to quantify energy concentrated at Nyquist wavenumbers. For periodic grids, the discrete wavenumbers are $k_x = \\frac{2\\pi m_x}{N_x \\Delta x}$ with $m_x \\in \\{0,\\dots, N_x-1\\}$ and $k_y = \\frac{2\\pi m_y}{N_y \\Delta y}$ with $m_y \\in \\{0,\\dots, N_y-1\\}$. For even $N_x$ and $N_y$, the Nyquist wavenumbers are $k_x = \\frac{\\pi}{\\Delta x}$ corresponding to $m_x = \\frac{N_x}{2}$ and $k_y = \\frac{\\pi}{\\Delta y}$ corresponding to $m_y = \\frac{N_y}{2}$. Let $P(m_y,m_x)$ be the DFT of $p_{i,j}$. Define total spectral energy $E = \\sum_{m_y=0}^{N_y-1}\\sum_{m_x=0}^{N_x-1} \\left|P(m_y,m_x)\\right|^2$. Define Nyquist energy $E_{\\text{nyq}}$ as the sum over the four bins $(m_y,m_x) \\in \\{(0,\\frac{N_y}{2}),(\\frac{N_y}{2},0),(\\frac{N_y}{2},\\frac{N_x}{2})\\}$, excluding duplicate bins if any. The odd–even energy fraction is $\\Phi_{\\text{oe}} = \\frac{E_{\\text{nyq}}}{E}$.\n- Metric $2$ (Decoupling ratio based on one-cell versus two-cell gradients): Define the one-cell forward-difference gradient magnitudes\n$$D_1 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}\\right)^2\\right],$$\nwith periodic indexing. Define the two-cell central-difference gradient magnitudes\n$$D_2 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}\\right)^2\\right],$$\nalso with periodic indexing. The decoupling ratio is $R = \\frac{D_2}{D_1}$, with the convention that if $D_1 = 0$ then set $R = 1$ to avoid spurious detection in constant fields. For a perfect checkerboard, $D_1$ is large while $D_2 = 0$, yielding $R \\approx 0$.\n- Metric $3$ (Nearest-neighbor correlation): Define the normalized nearest-neighbor correlation as\n$$C = \\frac{\\frac{1}{2N}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[p_{i,j} p_{i+1,j} + p_{i,j} p_{i,j+1}\\right]}{\\frac{1}{N}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1} p_{i,j}^2},$$\nwhere $N = N_x N_y$. For a perfect checkerboard $p_{i,j} = (-1)^{i+j}$, one has $p_{i+1,j} = -p_{i,j}$ and $p_{i,j+1} = -p_{i,j}$, yielding $C = -1$. For a smooth field with neighboring values aligned, $C$ is close to $1$.\n\nClassification rule:\n- Declare checkerboarding detected if $\\Phi_{\\text{oe}} \\ge \\alpha$ or $C \\le -\\beta$ or $R \\le \\gamma$, with thresholds $\\alpha = 0.5$, $\\beta = 0.5$, and $\\gamma = 0.1$.\n\nImplementation requirements:\n- Construct a periodic grid with $N_x = 16$, $N_y = 16$, $\\Delta x = 1$, and $\\Delta y = 1$.\n- Build the following test suite of pressure fields $p_{i,j}$:\n    - Case $1$ (Smooth separable mode): $p_{i,j} = \\sin\\left(2\\pi \\frac{i}{N_x}\\right) \\sin\\left(2\\pi \\frac{j}{N_y}\\right)$.\n    - Case $2$ (Perfect checkerboard): $p_{i,j} = (-1)^{i+j}$.\n    - Case $3$ (Mixed smooth plus checker): $p_{i,j} = 0.7\\,(-1)^{i+j} + 0.3\\,\\sin\\left(2\\pi \\frac{i}{N_x}\\right) \\sin\\left(2\\pi \\frac{j}{N_y}\\right)$.\n    - Case $4$ (Uniform field): $p_{i,j} = 1$.\n    - Case $5$ (Mean-zero random field): $p_{i,j}$ drawn independently from a normal distribution $\\mathcal{N}(0,1)$ with a fixed pseudorandom seed for reproducibility.\n- For each case, compute $\\Phi_{\\text{oe}}$, $R$, and $C$ and apply the classification rule.\n\nFinal output format:\n- Your program should produce a single line of output containing the classification results for the five cases, as a comma-separated list enclosed in square brackets in the order of the cases, with each element a boolean (e.g., $\\texttt{[True,False,True,False,False]}$). No other text should be printed.",
            "solution": "The problem requires the design and implementation of three distinct numerical diagnostics to detect pressure-velocity decoupling, a phenomenon often manifesting as a \"checkerboard\" pattern in the pressure field in computational fluid dynamics simulations. This issue is particularly prevalent on collocated grids where pressure and velocity components are stored at the same grid locations. We will validate the problem statement, detail the theoretical underpinnings of each diagnostic, and then construct a program to apply them to a suite of test cases.\n\n### Problem Validation\n\n**Step 1: Extracted Givens**\n- **Governing Equations**: Incompressible continuity equation $\\nabla \\cdot \\mathbf{u} = 0$; Momentum equation pressure term $\\rho \\frac{D \\mathbf{u}}{D t} = -\\nabla p + \\text{other terms}$.\n- **Grid and Discretization**: Two-dimensional, structured, periodic, uniform grid with $N_x \\times N_y$ cells of size $\\Delta x \\times \\Delta y$; collocated variable arrangement.\n- **Checkerboard Mode**: $p_{i,j} = (-1)^{i+j}$.\n- **Face Pressure Interpolation**: $p^{x}_{i+1/2,j} = \\frac{1}{2}\\left(p_{i+1,j}+p_{i,j}\\right)$.\n- **Metric 1 ($\\Phi_{\\text{oe}}$)**: Spectral odd–even energy fraction.\n    - DFT of $p_{i,j}$ is $P(m_y,m_x)$.\n    - Total spectral energy: $E = \\sum_{m_y=0}^{N_y-1}\\sum_{m_x=0}^{N_x-1} \\left|P(m_y,m_x)\\right|^2$.\n    - Nyquist energy $E_{\\text{nyq}}$: sum of $|P|^2$ at $(m_y,m_x)$ bins corresponding to Nyquist frequencies, specifically $(0, N_x/2)$, $(N_y/2, 0)$, and $(N_y/2, N_x/2)$ for even $N_x, N_y$.\n    - Formula: $\\Phi_{\\text{oe}} = E_{\\text{nyq}} / E$.\n- **Metric 2 ($R$)**: Decoupling ratio.\n    - One-cell forward-difference gradient magnitude sum: $D_1 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}\\right)^2\\right]$.\n    - Two-cell central-difference gradient magnitude sum: $D_2 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}\\right)^2\\right]$.\n    - Formula: $R = D_2 / D_1$, with $R=1$ if $D_1=0$.\n- **Metric 3 ($C$)**: Nearest-neighbor correlation.\n    - Formula: $C = \\frac{\\frac{1}{2N}\\sum_{i,j}\\left[p_{i,j} p_{i+1,j} + p_{i,j} p_{i,j+1}\\right]}{\\frac{1}{N}\\sum_{i,j} p_{i,j}^2}$, where $N = N_x N_y$.\n- **Classification Rule**: Checkerboarding is detected if $\\Phi_{\\text{oe}} \\ge 0.5$ or $C \\le -0.5$ or $R \\le 0.1$.\n- **Implementation Parameters**: $N_x = 16$, $N_y = 16$, $\\Delta x = 1$, $\\Delta y = 1$.\n- **Test Cases**: 1) Smooth separable mode, 2) Perfect checkerboard, 3) Mixed smooth/checkerboard, 4) Uniform field, 5) Mean-zero random field.\n\n**Step 2: Validation Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It addresses a canonical problem in numerical analysis for fluid dynamics (pressure-velocity decoupling) using standard, well-defined mathematical and computational techniques. The supplied formulas for the metrics are correct representations of methods used to diagnose such numerical artifacts. The test cases are well chosen to probe the behavior of the metrics under different conditions (smooth, purely oscillatory, mixed, constant, and noisy fields). There is a minor ambiguity in the problem description for Metric 1, which states \"sum over the four bins\" but lists three specific index pairs. This is interpreted as a typographical error, and the three listed bins—$(0, N_x/2)$, $(N_y/2, 0)$, and $(N_y/2, N_x/2)$—are the correct ones for capturing odd-even oscillations along axes and diagonals, and are sufficient. This minor issue does not impede a rigorous solution. The problem is therefore deemed valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation and Implementation Strategy\n\nThe core of the problem lies in the properties of discrete operators on a grid. A naive central differencing scheme for the pressure gradient, as used in many early CFD methods on collocated grids, results in a discrete operator whose null space is not trivial. Specifically, it contains high-frequency modes, like the checkerboard pattern $p_{i,j} = C(-1)^{i+j}$, where $C$ is a constant. For such a field, the pressure gradient computed at cell centers using values at $i-1$ and $i+1$ is identically zero, decoupling the pressure field from the velocity field and allowing spurious, unphysical pressure oscillations to grow. The three metrics are designed to detect the signature of such modes.\n\n**Metric 1: Spectral Odd-Even Energy Fraction, $\\Phi_{\\text{oe}}$**\nThis metric operates in Fourier space. The checkerboard pattern $p_{i,j} = (-1)^{i+j}$ represents the highest possible spatial frequency that can be resolved on a grid with spacing $\\Delta x$ and $\\Delta y$. In the discrete Fourier domain, this pattern's energy is concentrated entirely at the Nyquist frequencies, which correspond to wavenumbers $k_x = \\pi / \\Delta x$ and $k_y = \\pi / \\Delta y$.\n\nLet $p_{i,j}$ be the pressure field on an $N_x \\times N_y$ grid. Its two-dimensional Discrete Fourier Transform (DFT) is given by\n$$ P(m_y, m_x) = \\sum_{j=0}^{N_y-1} \\sum_{i=0}^{N_x-1} p_{i,j} e^{-2\\pi i (m_x i / N_x + m_y j / N_y)} $$\nwhere $m_x \\in \\{0, \\dots, N_x-1\\}$ and $m_y \\in \\{0, \\dots, N_y-1\\}$ are the frequency indices.\nBy Parseval's theorem, the total energy in the field is proportional to the sum of the squared magnitudes of its Fourier coefficients:\n$$ E = \\sum_{m_y=0}^{N_y-1} \\sum_{m_x=0}^{N_x-1} |P(m_y, m_x)|^2 $$\nFor the given even grid dimensions ($N_x=16$, $N_y=16$), the Nyquist frequency indices are $m_x = N_x/2 = 8$ and $m_y = N_y/2 = 8$. The energy associated with odd-even oscillations is found at frequencies corresponding to oscillations purely in $x$, purely in $y$, or in both. The relevant frequency bins are thus $(m_y, m_x) = (0, N_x/2)$, $(N_y/2, 0)$, and $(N_y/2, N_x/2)$. The Nyquist energy is the sum of energies in these bins:\n$$ E_{\\text{nyq}} = |P(0, N_x/2)|^2 + |P(N_y/2, 0)|^2 + |P(N_y/2, N_x/2)|^2 $$\nThe metric is the ratio of this Nyquist energy to the total energy:\n$$ \\Phi_{\\text{oe}} = \\frac{E_{\\text{nyq}}}{E} $$\nA value of $\\Phi_{\\text{oe}}$ close to $1$ indicates that the field is dominated by checkerboard-like patterns.\n\n**Metric 2: Decoupling Ratio, $R$**\nThis metric operates in physical space and compares the magnitude of the pressure field's gradient as computed by two different stencils. The two-cell central difference, e.g., $\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}$, is the operator that becomes \"blind\" to the checkerboard mode. For $p_{i,j} = (-1)^{i+j}$, we have $p_{i+1,j} = p_{i-1,j} = -p_{i,j}$, so the numerator is zero. The one-cell forward difference, $\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}$, remains sensitive to this mode.\n\nThe metric computes the total squared magnitude of the gradient field using both stencils, summed over the entire grid.\n$D_1$ uses the one-cell stencil:\n$$ D_1 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}\\right)^2\\right] $$\n$D_2$ uses the two-cell stencil:\n$$ D_2 = \\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[\\left(\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x}\\right)^2 + \\left(\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}\\right)^2\\right] $$\nThe grid is periodic, so indices are wrapped. The ratio $R = D_2/D_1$ quantifies the decoupling. For a smooth field, both stencils provide similar gradient approximations, so $R \\approx 1$. For a perfect checkerboard, $D_2 = 0$ while $D_1 > 0$, yielding $R = 0$. Small values of $R$ are indicative of decoupling. For a constant field, $D_1=0$, and by convention we set $R=1$.\n\n**Metric 3: Nearest-Neighbor Correlation, $C$**\nThis metric provides the most direct test for the sign-alternating structure of a checkerboard pattern. A perfect checkerboard has $p_{i+1,j} = -p_{i,j}$ and $p_{i,j+1} = -p_{i,j}$. The correlation between a point and its neighbors will therefore be strongly negative.\nThe metric is defined as the average of the product of a cell's value with its neighbors, normalized by the mean square of the field itself:\n$$ C = \\frac{\\frac{1}{2N}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1}\\left[p_{i,j} p_{i+1,j} + p_{i,j} p_{i,j+1}\\right]}{\\frac{1}{N}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1} p_{i,j}^2} $$\nwhere $N = N_x N_y$. For a perfect checkerboard, $p_{i,j}p_{i+1,j} = -p_{i,j}^2$ and $p_{i,j}p_{i,j+1} = -p_{i,j}^2$. If $p_{i,j} = \\pm 1$, the numerator becomes $\\frac{1}{2N}\\sum(-1-1) = -1$, and the denominator is $1$, so $C=-1$. For a smooth field, $p_{i+1,j} \\approx p_{i,j}$, leading to $C \\approx 1$. A value of $C$ close to $-1$ is a strong indicator of checkerboarding.\n\n**Implementation**\nThe implementation will follow these principles. We will define Python functions for each metric. NumPy's `fft.fft2` will be used for Metric 1. For Metrics 2 and 3, `numpy.roll` is ideally suited for implementing the required shifts on a periodic grid. The five test cases will be generated, and for each, the three metrics will be computed. Finally, the logical 'OR' of the conditions from the classification rule will determine the boolean output for each case.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_phi_oe(p_field, Nx, Ny):\n    \"\"\"\n    Calculates Metric 1: Spectral odd-even energy fraction (Phi_oe).\n    \"\"\"\n    # Compute the 2D Discrete Fourier Transform of the pressure field.\n    p_fft = np.fft.fft2(p_field)\n    \n    # Total spectral energy is the sum of the squared magnitudes of the FFT coefficients.\n    total_energy = np.sum(np.abs(p_fft)**2)\n    \n    if total_energy == 0:\n        return 0.0\n\n    # For even Nx, Ny, the Nyquist frequency indices are Nx/2 and Ny/2.\n    nx_nyq, ny_nyq = Nx // 2, Ny // 2\n    \n    # Nyquist energy is the sum of energy at the highest frequencies.\n    # Corresponds to odd-even oscillations in x, y, and both directions.\n    e_nyq = (\n        np.abs(p_fft[0, nx_nyq])**2 +\n        np.abs(p_fft[ny_nyq, 0])**2 +\n        np.abs(p_fft[ny_nyq, nx_nyq])**2\n    )\n    \n    phi_oe = e_nyq / total_energy\n    return phi_oe\n\ndef calculate_r_ratio(p_field, dx, dy):\n    \"\"\"\n    Calculates Metric 2: Decoupling ratio (R).\n    \"\"\"\n    # D1: Sum of squared one-cell forward differences.\n    # np.roll provides periodic boundary conditions.\n    # For D1x, we compute (p_{i+1,j} - p_{i,j}) / dx\n    diff_x_1 = (np.roll(p_field, -1, axis=1) - p_field) / dx\n    # For D1y, we compute (p_{i,j+1} - p_{i,j}) / dy\n    diff_y_1 = (np.roll(p_field, -1, axis=0) - p_field) / dy\n    \n    d1 = np.sum(diff_x_1**2 + diff_y_1**2)\n\n    # If D1 is zero (constant field), return 1 as per problem convention.\n    if d1 == 0:\n        return 1.0\n\n    # D2: Sum of squared two-cell central differences.\n    # For D2x, we compute (p_{i+1,j} - p_{i-1,j}) / (2*dx)\n    diff_x_2 = (np.roll(p_field, -1, axis=1) - np.roll(p_field, 1, axis=1)) / (2 * dx)\n    # For D2y, we compute (p_{i,j+1} - p_{i,j-1}) / (2*dy)\n    diff_y_2 = (np.roll(p_field, -1, axis=0) - np.roll(p_field, 1, axis=0)) / (2 * dy)\n    \n    d2 = np.sum(diff_x_2**2 + diff_y_2**2)\n    \n    r_ratio = d2 / d1\n    return r_ratio\n\ndef calculate_c_corr(p_field, Nx, Ny):\n    \"\"\"\n    Calculates Metric 3: Nearest-neighbor correlation (C).\n    \"\"\"\n    N = Nx * Ny\n    \n    # Denominator: Mean square of the field.\n    p_sq_mean = np.sum(p_field**2) / N\n    \n    if p_sq_mean == 0:\n        return 1.0 # Or some neutral value; 1 is appropriate for non-checkerboard.\n\n    # Numerator: Average of products with neighbors.\n    # Sum of p_{i,j} * p_{i+1,j}\n    corr_x = np.sum(p_field * np.roll(p_field, -1, axis=1))\n    # Sum of p_{i,j} * p_{i,j+1}\n    corr_y = np.sum(p_field * np.roll(p_field, -1, axis=0))\n    \n    numerator = (corr_x + corr_y) / (2 * N)\n    \n    c_corr = numerator / p_sq_mean\n    return c_corr\n    \ndef solve():\n    \"\"\"\n    Main function to run diagnostics on all test cases.\n    \"\"\"\n    # Grid parameters\n    Nx, Ny = 16, 16\n    dx, dy = 1.0, 1.0\n    \n    # Classification thresholds\n    alpha = 0.5\n    beta = 0.5\n    gamma = 0.1\n\n    # Grid generation\n    i = np.arange(Nx)\n    j = np.arange(Ny)\n    I, J = np.meshgrid(i, j, indexing='ij')\n\n    # Test cases generation\n    p_smooth = np.sin(2 * np.pi * I / Nx) * np.sin(2 * np.pi * J / Ny)\n    p_checker = (-1)**(I + J)\n    p_mixed = 0.7 * p_checker + 0.3 * p_smooth\n    p_uniform = np.ones((Nx, Ny))\n    \n    # Reproducible random field\n    np.random.seed(42)\n    p_random = np.random.normal(0, 1, (Nx, Ny))\n\n    test_cases = [\n        p_smooth, \n        p_checker, \n        p_mixed, \n        p_uniform, \n        p_random\n    ]\n    \n    results = []\n    \n    for p_field in test_cases:\n        # Calculate the three metrics for the current field\n        phi_oe = calculate_phi_oe(p_field, Nx, Ny)\n        r_ratio = calculate_r_ratio(p_field, dx, dy)\n        c_corr = calculate_c_corr(p_field, Nx, Ny)\n        \n        # Apply the classification rule\n        is_checkerboard = (phi_oe >= alpha) or (c_corr = -beta) or (r_ratio = gamma)\n        results.append(is_checkerboard)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "This final practice situates the concept of pressure-velocity decoupling within the context of complete pressure-correction algorithms. You will implement simplified versions of the classic SIMPLE and PISO methods on a collocated grid, deliberately omitting the Rhie-Chow stabilization to observe the raw behavior of the schemes . By examining the pressure field after a single predictive-corrective step, you will see how algorithmic choices, such as pressure under-relaxation or the number of correction steps, can either amplify or suppress the growth of spurious checkerboard modes, providing critical insight into the practical stability of incompressible flow solvers.",
            "id": "3354212",
            "problem": "Consider a two-dimensional, incompressible lid-driven cavity of square domain with side length $L$ in meters containing a Newtonian fluid with density $\\rho$ in kilograms per cubic meter and kinematic viscosity $\\nu$ in square meters per second. At time $t=0$ seconds, the cavity lid (the top boundary) is impulsively set into motion. In a co-located finite-volume discretization on a uniform Cartesian grid, pressure and velocity components are stored at the same cell centers. It is well known that in such co-located arrangements, central-difference interpolation of face fluxes without additional stabilization can cause pressure–velocity decoupling and the emergence of odd–even (checkerboard) pressure fields.\n\nYour task is to implement a simplified pressure-correction pathway using either the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE) or the Pressure Implicit with Splitting of Operators (PISO) on a co-located grid, explicitly omitting Rhie–Chow interpolation. Starting from the incompressible Navier–Stokes equations with constant $\\rho$ and $\\nu$ and the continuity equation\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\n$$\nand the linear momentum balance at early times (neglecting convection immediately after the impulsive start so that viscous and pressure effects dominate),\n$$\n\\rho \\frac{\\partial \\mathbf{u}}{\\partial t} = -\\nabla p + \\rho \\nu \\nabla^2 \\mathbf{u} + \\mathbf{S},\n$$\nuse a co-located discretization with central differences to drive a single time-step prediction–correction cycle that demonstrates the effect of pressure under-relaxation on the emergence or suppression of checkerboard pressure patterns.\n\nTo ensure scientific realism and reproducibility while keeping the computation tractable, adopt the following modeling choices and algorithmic steps.\n\n1. Grid and discretization:\n   - Use a uniform co-located grid of $N_x \\times N_y$ interior cells in the square domain of side $L$ meters, with spacings $ \\Delta x = L / N_x $ and $ \\Delta y = L / N_y $.\n   - Use central differences to approximate spatial derivatives at cell centers.\n   - Compute face-normal mass fluxes using arithmetic averaging of adjacent cell-centered velocities (explicitly do not apply Rhie–Chow interpolation or any pressure smoothing at faces).\n   - Impose Dirichlet conditions for the pressure correction solve with $p=0$ at the domain boundaries to regularize the linear system.\n\n2. Time and material parameters:\n   - Use a single time step of size $\\Delta t$ seconds.\n   - Use fluid density $\\rho$ in kilograms per cubic meter and kinematic viscosity $\\nu$ in square meters per second.\n   - Use a diagonal momentum coefficient $a_u = \\rho/\\Delta t + 2 \\rho \\nu \\left(1/\\Delta x^2 + 1/\\Delta y^2\\right)$ to represent a semi-implicit balance of local inertia and viscous diffusion in the velocity predictor.\n\n3. Impulsive start model:\n   - Represent the impulsive start of the lid by a spatially localized, divergence-producing body force $\\mathbf{S} = (S_x, 0)$ applied near the top boundary at $t=0$ seconds. Let the $x$-component be\n     $$\n     S_x(x,y) = \\rho \\frac{U_0}{\\Delta t} \\exp\\!\\left(-\\frac{L-y}{\\sigma}\\right) \\sin\\!\\left(\\frac{2\\pi x}{L}\\right),\n     $$\n     where $U_0$ is the lid speed in meters per second and $\\sigma$ is a penetration length scale set to $\\sigma = 0.1 L$ meters. Use $S_y=0$.\n   - Compute the predicted velocities\n     $$\n     u^* = \\frac{\\Delta t}{a_u} S_x, \\quad v^* = 0,\n     $$\n     at cell centers. This produces a divergence field at the faces,\n     $$\n     b = -\\nabla \\cdot \\mathbf{u}^*,\n     $$\n     based on arithmetic face interpolation of $u^*$ and $v^*$.\n\n4. Pressure correction pathways on a co-located grid:\n   - Define the velocity correction due to pressure as\n     $$\n     u' = -\\frac{\\Delta t}{\\rho\\, a_u}\\frac{\\partial p'}{\\partial x}, \\quad v' = -\\frac{\\Delta t}{\\rho\\, a_u}\\frac{\\partial p'}{\\partial y},\n     $$\n     and compute the divergence contribution of this correction by averaging $u'$ and $v'$ to faces then differencing.\n   - SIMPLE pathway:\n     - Compute a residual $r = b - \\mathcal{C}(p)$, where $\\mathcal{C}(p)$ denotes the divergence induced by the current pressure field via the pressure-to-velocity coupling described above.\n     - Solve a regularized Dirichlet Poisson problem $L p_c = r$ using a five-point Laplacian $L$ with spacings $\\Delta x$ and $\\Delta y$.\n     - Update the pressure with under-relaxation $p \\leftarrow p + \\alpha_p p_c$, where $\\alpha_p \\in (0,1]$ is the pressure under-relaxation.\n     - Do not update the predictor $u^*,v^*$ during the correction loop (single prediction, multiple pressure corrections).\n   - PISO pathway:\n     - Perform $N_{\\text{corr}} \\in \\{2,3\\}$ consecutive correctors in one overall step. At each corrector:\n       - Form $r = b - \\mathcal{C}(p)$, solve $L p_c = r$, and update $p \\leftarrow p + p_c$ (use $\\alpha_p=1$).\n       - Update the velocities using the pressure gradient correction, $u \\leftarrow u^* + u'$ and $v \\leftarrow v^* + v'$.\n       - Recompute $b$ from the updated face-normal mass flux using arithmetic interpolation, and proceed to the next corrector.\n\n5. Checkerboard amplitude metric:\n   - Define the canonical odd–even mask $S_{i,j} = (-1)^{i+j}$ on the $N_x \\times N_y$ grid.\n   - Compute the checkerboard amplitude of the final pressure field (after all corrections) as\n     $$\n     A = \\frac{\\left|\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} S_{i,j}\\,\\left(p_{i,j} - \\bar{p}\\right)\\right|}{\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} \\left|p_{i,j} - \\bar{p}\\right|},\n     $$\n     where $\\bar{p}$ is the spatial average of $p$ over the interior cells. This dimensionless ratio quantifies the relative presence of the odd–even mode.\n\nImplement the above in a single, self-contained program that constructs the grid and operators, executes the specified prediction–correction pathway for each test case, and reports the checkerboard amplitude $A$ for each case.\n\nUse the following parameter values (with units where applicable):\n- Domain side length $L = 1$ meter.\n- Lid speed $U_0 = 1$ meters per second.\n- Fluid density $\\rho = 1$ kilograms per cubic meter.\n- Kinematic viscosity $\\nu = 10^{-3}$ square meters per second.\n- Time step $\\Delta t = 10^{-3}$ seconds.\n\nTest suite:\n- Case $1$: $N_x = 32$, $N_y = 32$, SIMPLE with $\\alpha_p = 0.2$.\n- Case $2$: $N_x = 32$, $N_y = 32$, SIMPLE with $\\alpha_p = 0.8$.\n- Case $3$: $N_x = 32$, $N_y = 32$, PISO with $N_{\\text{corr}} = 2$ and $\\alpha_p = 1.0$.\n- Case $4$: $N_x = 16$, $N_y = 16$, SIMPLE with $\\alpha_p = 0.8$.\n- Case $5$: $N_x = 32$, $N_y = 32$, PISO with $N_{\\text{corr}} = 3$ and $\\alpha_p = 1.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the above test cases, for example, $[\\text{result1},\\text{result2},\\text{result3},\\text{result4},\\text{result5}]$ where each $\\text{result}$ is a floating-point number representing the checkerboard amplitude $A$ for the corresponding case. No other output should be produced. All angles, if any were to appear, must be in radians, but no angles are involved in this task. Since the final outputs are dimensionless, no physical units are required for the numerical answers, although all input parameters must adhere to the specified units above.",
            "solution": "The user-provided problem is a well-defined numerical exercise in computational fluid dynamics (CFD) and is deemed valid. It requires the implementation of a simplified pressure-correction scheme on a co-located grid to demonstrate the phenomenon of pressure-velocity decoupling, which manifests as checkerboard pressure oscillations. The problem is scientifically grounded, self-contained, and algorithmically specific.\n\nThe core of the problem lies in solving a pressure Poisson equation derived from the continuity and simplified momentum equations. We are to implement two classic pressure-correction algorithms, SIMPLE and PISO, under a set of simplifying assumptions characteristic of an impulsive start from a quiescent state. Specifically, the convective terms are neglected, and the velocity prediction is driven solely by a prescribed body force designed to mimic the impulsive start of a lid. Crucially, the scheme omits the Rhie-Chow interpolation, which is the standard remedy for checkerboarding on co-located grids, thereby ensuring the phenomenon will be observable.\n\nThe solution is structured as follows:\n1.  **Grid and Parameter Setup**: We define the physical domain, grid resolution ($N_x \\times N_y$), and all relevant physical constants ($L, \\rho, \\nu, U_0, \\Delta t$). From these, we derive the grid spacings ($\\Delta x, \\Delta y$) and the diagonal momentum coefficient $a_u$.\n2.  **Predictor Step**: The initial velocity prediction, denoted by $\\mathbf{u}^* = (u^*, v^*)$, is computed. As specified, this field arises from a body force $\\mathbf{S}$ representing the impulsive lid motion. The simplified momentum balance gives $u^* = \\frac{\\Delta t}{a_u} S_x$ and $v^*=0$. This predicted field $\\mathbf{u}^*$ does not generally satisfy the continuity equation, $\\nabla \\cdot \\mathbf{u}^* \\neq 0$.\n3.  **Discretized Operators**: To implement the finite volume method on our co-located grid, we require discrete versions of the divergence, gradient, and Laplacian operators.\n    -   The gradient $\\nabla p$ is discretized using central differences.\n    -   The divergence $\\nabla \\cdot \\mathbf{u}$ is discretized by first arithmetically averaging cell-center velocities to obtain face-normal fluxes and then applying the divergence theorem to each control volume. This specific choice is the root cause of the pressure-velocity decoupling.\n    -   The pressure Poisson equation, which takes the form $-\\nabla^2 p' = S$, is solved using a sparse linear system. The matrix for the negative Laplacian operator ($-\\nabla^2$) is constructed for the 2D grid with homogeneous Dirichlet boundary conditions ($p=0$ on all boundaries).\n4.  **Pressure-Correction Step**: This is the core of the algorithm, where a pressure field is computed to enforce continuity. The final velocity field $\\mathbf{u}$ is related to the predictor $\\mathbf{u}^*$ through a pressure-gradient correction: $\\mathbf{u} = \\mathbf{u}^* - \\frac{\\Delta t}{\\rho a_u}\\nabla p$. Enforcing the continuity equation, $\\nabla \\cdot \\mathbf{u} = 0$, leads to the pressure Poisson equation:\n    $$\n    \\nabla \\cdot \\left( \\frac{\\Delta t}{\\rho a_u} \\nabla p \\right) = \\nabla \\cdot \\mathbf{u}^*\n    $$\n    Since $\\frac{\\Delta t}{\\rho a_u}$ is constant, this simplifies to $-\\nabla^2 p = -\\frac{\\rho a_u}{\\Delta t} \\nabla \\cdot \\mathbf{u}^* = \\frac{\\rho a_u}{\\Delta t} b$, where $b = -\\nabla \\cdot \\mathbf{u}^*$ is the divergence source term.\n\n    -   **SIMPLE Pathway**: This is an iterative procedure. We start with an initial pressure guess (e.g., $p^{(0)}=0$) and iteratively refine it. For each iteration, we calculate the residual of the continuity equation, $r = b - \\mathcal{C}(p^{(k)})$, where $\\mathcal{C}(p^{(k)})$ is the divergence correction provided by the current pressure guess $p^{(k)}$. We solve for a pressure correction $p_c$ that addresses this residual and update the pressure field via under-relaxation: $p^{(k+1)} = p^{(k)} + \\alpha_p p_c$. This process is repeated for a fixed number of inner iterations. The implemented procedure is equivalent to a Richardson iterative solver for the full Poisson equation.\n    -   **PISO Pathway**: This is a non-iterative sequence of predictor-corrector steps. After the initial prediction, we perform $N_{\\text{corr}}$ correction steps. In each step, we calculate the divergence of the current velocity field, solve the Poisson equation for a pressure correction, and update both the pressure and the velocity fields. The key difference from SIMPLE is that the velocity field is updated within the correction sequence, and the source term for the subsequent pressure solve is the divergence of this newly updated velocity field.\n5.  **Checkerboard Amplitude Metric**: After the final pressure field $p$ is obtained, we quantify the strength of the odd-even oscillations using the specified checkerboard amplitude metric, $A$. This metric measures the projection of the pressure fluctuations onto the highest-frequency mode, $(-1)^{i+j}$, normalized by the total magnitude of the fluctuations. A higher value of $A$ indicates stronger checkerboarding.\n\nThe final program encapsulates this logic, iterates through the five test cases provided, computes the checkerboard amplitude $A$ for each, and prints the results in the specified format. The expectation is that higher pressure under-relaxation ($\\alpha_p$) in SIMPLE and coarser grids will lead to larger values of $A$, while the PISO algorithm, especially with more correctors, will be more effective at suppressing these oscillations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, kron, identity\nfrom scipy.sparse.linalg import spsolve\n\ndef setup_grid_and_params(L, Nx, Ny, rho, nu, dt, sigma_factor):\n    \"\"\"Sets up grid, coordinates, and physical parameters.\"\"\"\n    dx = L / Nx\n    dy = L / Ny\n    \n    # Cell-centered coordinates\n    x_coords = (np.arange(Nx) + 0.5) * dx\n    y_coords = (np.arange(Ny) + 0.5) * dy\n    xx, yy = np.meshgrid(x_coords, y_coords, indexing='ij')\n\n    au = rho / dt + 2 * rho * nu * (1/dx**2 + 1/dy**2)\n    sigma = sigma_factor * L\n    \n    return (dx, dy, xx, yy, au, sigma)\n\n\ndef get_predictor_velocities(rho, U0, dt, L, au, sigma, xx, yy):\n    \"\"\"Computes the predictor velocity field u*.\"\"\"\n    # Sx is defined at cell centers\n    Sx = rho * (U0 / dt) * np.exp(-(L - yy) / sigma) * np.sin(2 * np.pi * xx / L)\n    u_star = (dt / au) * Sx\n    v_star = np.zeros_like(u_star)\n    return u_star, v_star\n\n\ndef compute_divergence(u, v, dx, dy):\n    \"\"\"Computes divergence of a cell-centered vector field using arithmetic averaging for face values.\"\"\"\n    # Pad with zeros for boundary conditions (zero velocity assumed at walls for this calculation)\n    u_padded = np.pad(u, 1, 'constant', constant_values=0)\n    v_padded = np.pad(v, 1, 'constant', constant_values=0)\n    \n    # Face velocities (arithmetic average)\n    u_face_e = 0.5 * (u_padded[1:-1, 1:-1] + u_padded[2:, 1:-1])\n    u_face_w = 0.5 * (u_padded[1:-1, 1:-1] + u_padded[:-2, 1:-1])\n    v_face_n = 0.5 * (v_padded[1:-1, 1:-1] + v_padded[1:-1, 2:])\n    v_face_s = 0.5 * (v_padded[1:-1, 1:-1] + v_padded[1:-1, :-2])\n    \n    div = (u_face_e - u_face_w) / dx + (v_face_n - v_face_s) / dy\n    return div\n\n\ndef compute_gradient(p, dx, dy):\n    \"\"\"Computes gradient of a cell-centered scalar field with zero Dirichlet BCs.\"\"\"\n    # Pad with zeros for Dirichlet BCs p=0\n    p_padded = np.pad(p, 1, 'constant', constant_values=0)\n    \n    grad_x = (p_padded[2:, 1:-1] - p_padded[:-2, 1:-1]) / (2 * dx)\n    grad_y = (p_padded[1:-1, 2:] - p_padded[1:-1, :-2]) / (2 * dy)\n    \n    return grad_x, grad_y\n\ndef get_laplacian_matrix(Nx, Ny, dx, dy):\n    \"\"\"Creates a sparse matrix for the negative 2D Laplacian (-del^2) with Dirichlet BCs using Kronecker product.\"\"\"\n    L_x = diags([1, -2, 1], [-1, 0, 1], shape=(Nx, Nx)) / dx**2\n    L_y = diags([1, -2, 1], [-1, 0, 1], shape=(Ny, Ny)) / dy**2\n\n    I_x = identity(Nx)\n    I_y = identity(Ny)\n\n    A = - (kron(I_y, L_x) + kron(L_y, I_x))\n    return A.tocsr()\n\n\ndef compute_checkerboard_amplitude(p):\n    \"\"\"Computes the checkerboard amplitude metric for a pressure field.\"\"\"\n    Nx, Ny = p.shape\n    if p.size == 0:\n        return 0.0\n        \n    p_mean = np.mean(p)\n    p_fluctuation = p - p_mean\n    \n    denominator = np.sum(np.abs(p_fluctuation))\n    if denominator  1e-15:\n        return 0.0\n\n    ii, jj = np.meshgrid(np.arange(Nx), np.arange(Ny), indexing='ij')\n    mask = (-1)**(ii + jj)\n    \n    numerator = np.abs(np.sum(mask * p_fluctuation))\n        \n    return numerator / denominator\n\n\ndef run_case(case_params):\n    # Fixed physical parameters\n    L, rho, nu, U0, dt, sigma_factor = 1.0, 1.0, 1e-3, 1.0, 1e-3, 0.1\n    \n    # Case-specific parameters\n    Nx, Ny = case_params['Nx'], case_params['Ny']\n    method = case_params['method']\n    alpha_p = case_params.get('alpha_p')\n    N_corr = case_params.get('N_corr')\n\n    # Setup\n    dx, dy, xx, yy, au, sigma = setup_grid_and_params(L, Nx, Ny, rho, nu, dt, sigma_factor)\n    u_star, v_star = get_predictor_velocities(rho, U0, dt, L, au, sigma, xx, yy)\n    lap_mat = get_laplacian_matrix(Nx, Ny, dx, dy)\n    D = dt / (rho * au) # D = \\Delta t / (\\rho a_u)\n    \n    p = np.zeros((Nx, Ny))\n\n    if method == 'SIMPLE':\n        num_inner_iter = 10 # A reasonable number of inner iterations for the SIMPLE loop\n        b = -compute_divergence(u_star, v_star, dx, dy)\n        \n        # We solve -D \\nabla^2 p_total = b, which is equivalent to -\\nabla^2 p_total = b/D\n        poisson_rhs_total = b.flatten() / D\n        p_total_flat = spsolve(lap_mat, poisson_rhs_total)\n        \n        p_flat = p.flatten()\n        # This is a Richardson iteration to solve for the pressure\n        for _ in range(num_inner_iter):\n            pc_flat = p_total_flat - p_flat\n            p_flat += alpha_p * pc_flat\n            \n        p = p_flat.reshape((Nx, Ny))\n\n    elif method == 'PISO':\n        # Start with predictor field\n        u_curr, v_curr = u_star.copy(), v_star.copy()\n        \n        for _ in range(N_corr):\n            b_corr = -compute_divergence(u_curr, v_curr, dx, dy)\n            # Solve -D \\nabla^2 p_c = b_corr => -\\nabla^2 p_c = b_corr / D\n            poisson_rhs_corr = b_corr.flatten() / D\n            pc_flat = spsolve(lap_mat, poisson_rhs_corr)\n            pc = pc_flat.reshape((Nx, Ny))\n\n            p += pc\n            \n            # Update velocity from total pressure and original predictor u*\n            grad_px, grad_py = compute_gradient(p, dx, dy)\n            u_curr = u_star - D * grad_px\n            v_curr = v_star - D * grad_py\n\n    return compute_checkerboard_amplitude(p)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {'Nx': 32, 'Ny': 32, 'method': 'SIMPLE', 'alpha_p': 0.2},\n        {'Nx': 32, 'Ny': 32, 'method': 'SIMPLE', 'alpha_p': 0.8},\n        {'Nx': 32, 'Ny': 32, 'method': 'PISO', 'N_corr': 2, 'alpha_p': 1.0},\n        {'Nx': 16, 'Ny': 16, 'method': 'SIMPLE', 'alpha_p': 0.8},\n        {'Nx': 32, 'Ny': 32, 'method': 'PISO', 'N_corr': 3, 'alpha_p': 1.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        amplitude = run_case(case)\n        results.append(f\"{amplitude:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}