{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基本问题  开始，以此建立对CFL条件的数学理解。这个练习将引导你使用冯·诺依曼稳定性分析这一标准工具，为一维线性平流方程的一阶迎风格式推导其稳定性约束。通过这个实践，你将亲自验证为什么对于这个特定的数值格式，柯朗数 $C$ 必须小于等于1，从而为更复杂的分析奠定坚实的基础。",
            "id": "3372287",
            "problem": "考虑一维线性平流偏微分方程 (PDE) $\\partial_t u + a\\,\\partial_x u = 0$，其中波速 $a > 0$ 为常数。该方程在间距为 $\\Delta x$ 的均匀空间网格上离散，并使用针对 $a>0$ 的显式一阶迎风格式以时间步长 $\\Delta t$ 向前推进。请从第一性原理出发，使用傅里叶 (von Neumann) 稳定性分析，推导傅里叶模态的放大因子的模，并由此推断出保证该格式 $\\ell^2$-稳定性的无量纲 Courant–Friedrichs–Lewy (CFL) 数（定义为 $C = a\\,\\Delta t/\\Delta x$）的允许范围。然后，对于 $a = 2$ m/s, $\\Delta x = 0.01$ m 和目标 Courant 数 $C_{\\mathrm{target}} = 0.8$，选择一个时间步长 $\\Delta t_{\\mathrm{adopt}}$，使其在允许的情况下达到目标 Courant 数，否则等于由您的稳定性判据所施加的最大允许时间步长。计算 $\\Delta t_{\\mathrm{adopt}}$ 的值，并以秒为单位表示您的最终结果，四舍五入到四位有效数字。",
            "solution": "问题陈述经评估有效，具有科学依据、适定、客观且自洽。我们将开始解答。\n\n一维线性平流偏微分方程由下式给出：\n$$\n\\partial_t u + a\\,\\partial_x u = 0\n$$\n其中波速 $a$ 是一个正常数 ($a > 0$)。\n\n我们在均匀网格上离散此方程，其中 $x_j = j\\Delta x$ 且 $t_n = n\\Delta t$。令 $u_j^n$ 表示解 $u(x_j, t_n)$ 的数值近似。显式一阶迎风格式通过在时间上使用向前差分和在空间上使用向后差分来构建，对于 $a>0$ 这就是“迎风”方向：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0\n$$\n为了进行傅里叶 (von Neumann) 稳定性分析，我们考虑将单个傅里叶模态作为有限差分方程的解：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j} = \\hat{u}^n(k) e^{i k j \\Delta x}\n$$\n这里，$k$ 是波数，$i = \\sqrt{-1}$。下一时间步的解通过放大因子 $G(k)$ 与当前时间步的解相关联，即 $\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)$。因此，$u_j^{n+1} = G(k) u_j^n$。\n\n将傅里叶模态代入离散方程中：\n$$\n\\frac{G(k) \\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k j \\Delta x}}{\\Delta t} + a \\frac{\\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k (j-1) \\Delta x}}{\\Delta x} = 0\n$$\n项 $\\hat{u}^n(k) e^{i k j \\Delta x}$ 是一个公因子，并且由于其非零，可以被约去：\n$$\n\\frac{G(k) - 1}{\\Delta t} + a \\frac{1 - e^{-i k \\Delta x}}{\\Delta x} = 0\n$$\n求解放大因子 $G(k)$：\n$$\nG(k) - 1 = - \\frac{a \\Delta t}{\\Delta x} (1 - e^{-i k \\Delta x})\n$$\n我们引入无量纲的 Courant–Friedrichs–Lewy (CFL) 数, $C = \\frac{a \\Delta t}{\\Delta x}$。\n$$\nG(k) = 1 - C (1 - e^{-i k \\Delta x})\n$$\n为了保证 $\\ell^2$-稳定性，对于所有波数 $k$，放大因子的模必须小于或等于 1：$|G(k)| \\le 1$。我们定义无量纲波数 $\\theta = k \\Delta x$。那么，\n$$\nG(\\theta) = 1 - C (1 - e^{-i \\theta}) = 1 - C (1 - (\\cos\\theta - i\\sin\\theta)) = (1 - C(1 - \\cos\\theta)) + i C\\sin\\theta\n$$\n模的平方 $|G(\\theta)|^2$ 是实部和虚部平方的和：\n$$\n|G(\\theta)|^2 = (1 - C(1 - \\cos\\theta))^2 + (C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - \\cos\\theta)^2 + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - 2\\cos\\theta + \\cos^2\\theta + \\sin^2\\theta)\n$$\n使用恒等式 $\\cos^2\\theta + \\sin^2\\theta = 1$：\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - 2\\cos\\theta + 1) = 1 - 2C(1 - \\cos\\theta) + C^2(2 - 2\\cos\\theta)\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + 2C^2(1 - \\cos\\theta)\n$$\n$$\n|G(\\theta)|^2 = 1 + (2C^2 - 2C)(1 - \\cos\\theta) = 1 + 2C(C - 1)(1 - \\cos\\theta)\n$$\n稳定性条件是 $|G(\\theta)|^2 \\le 1$：\n$$\n1 + 2C(C - 1)(1 - \\cos\\theta) \\le 1\n$$\n$$\n2C(C - 1)(1 - \\cos\\theta) \\le 0\n$$\n参数 $a$、$\\Delta t$ 和 $\\Delta x$ 都是正的，因此 CFL 数 $C$ 是正的。项 $(1 - \\cos\\theta)$ 总是非负的，因为 $-1 \\le \\cos\\theta \\le 1$。为了使该不等式对所有可能的 $\\theta$ 值都成立，项 $2C(C-1)$ 必须是非正的。由于 $C>0$，这要求：\n$$\nC - 1 \\le 0 \\implies C \\le 1\n$$\n结合物理约束 $C \\ge 0$，保证稳定性的 CFL 数的允许范围是：\n$$\n0 \\le C \\le 1\n$$\n现在，我们将此结果应用于给定的具体情况。给定的参数是：\n$a = 2$ m/s\n$\\Delta x = 0.01$ m\n$C_{\\mathrm{target}} = 0.8$\n\n推导出的稳定性判据是 $0 \\le C \\le 1$。目标 Courant 数 $C_{\\mathrm{target}} = 0.8$ 在此允许范围内。根据问题陈述，我们应该选择一个时间步长 $\\Delta t_{\\mathrm{adopt}}$ 来达到这个目标 Courant 数。\n\nCourant 数的定义是 $C = \\frac{a \\Delta t}{\\Delta x}$。我们令 $C = C_{\\mathrm{target}}$ 并求解 $\\Delta t = \\Delta t_{\\mathrm{adopt}}$：\n$$\nC_{\\mathrm{target}} = \\frac{a \\Delta t_{\\mathrm{adopt}}}{\\Delta x}\n$$\n$$\n\\Delta t_{\\mathrm{adopt}} = \\frac{C_{\\mathrm{target}} \\Delta x}{a}\n$$\n代入数值：\n$$\n\\Delta t_{\\mathrm{adopt}} = \\frac{(0.8)(0.01\\ \\text{m})}{2\\ \\text{m/s}} = \\frac{0.008}{2}\\ \\text{s} = 0.004\\ \\text{s}\n$$\n题目要求结果四舍五入到四位有效数字。为了用四位有效数字表示 $0.004$，我们将其写成科学记数法形式 $4.000 \\times 10^{-3}$。",
            "answer": "$$\n\\boxed{4.000 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "在推导出CFL条件的数学形式后，下一个关键步骤是理解其物理本质。这个动手实践  要求你编写一个数值实验，来直观地展示物理依赖域和数值依赖域之间的关系，这正是CFL条件的物理核心。通过将柯朗数设置为稳定、临界和不稳定三种情况，你将亲眼观察到当数值计算无法“捕捉”到所有相关的物理信息时，数值解如何产生非物理解并最终崩溃。",
            "id": "3372295",
            "problem": "考虑一维线性平流方程 $u_t + a\\,u_x = 0$，描述的是一个具有恒定平流速度 $a > 0$ 的被动标量 $u(x,t)$。在长度为 $L$ 的周期性空间域上，点 $(x,t)$ 处的物理依赖域由特征线 $x(t) = x_0 + a\\,t$ 决定，这意味着点 $(x,t)$ 处的值取决于点 $(x - a\\,t, 0)$ 处的初始值。在采用均匀网格和显式一阶迎风有限差分格式的离散计算环境中，数值更新仅使用前一个时间层的相邻信息。当这个显式模板被重复应用时，数值依赖域会以每个时间步长有限个网格间距的速度扩张。物理依赖域和数值依赖域之间的差异可以被构建和量化，并且这种差异与双曲守恒律显式格式的稳定性以及 Courant–Friedrichs–Lewy 条件密切相关。\n\n您的任务是实现一个数值实验，展示平流问题中物理依赖域和数值依赖域之间的不匹配，并提供一种对非局域影响增长的受控度量。请使用以下设置和定义。\n\n基本原理：\n- 平流方程 $u_t + a\\,u_x = 0$ 在周期区间 $[0,L)$ 上，初始条件为 $u(x,0)$。\n- 平流方程的特征以速度 $a$ 传递信息，因此物理（精确）解无畸变地平移：$u(x,t) = u_0(x - a\\,t)$，其中 $u_0$ 是初始条件。\n\n离散化：\n- 使用具有 $N$ 个点和间距 $\\Delta x = L/N$ 的均匀网格，网格点为 $x_i = i\\,\\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$，并采用周期性边界条件。\n- 对于 $a>0$，使用显式一阶迎风格式：\n$$\nu_i^{n+1} = u_i^n - C\\left(u_i^n - u_{i-1}^n\\right),\n$$\n其中 $C = \\dfrac{a\\,\\Delta t}{\\Delta x}$ 是库朗数 (Courant number)，$\\Delta t$ 是时间步长，$n$ 是时间层，为实现周期性，下标对 $N$ 取模。\n- 演化 $n$ 个时间步，最终时间为 $T = n\\,\\Delta t$。\n\n物理依赖域和精确解区域：\n- 选择一个宽度为 $W$、振幅为 $1$、中心位于 $x_0$ 的紧支集高帽初始条件：\n$$\nu_0(x) = \n\\begin{cases}\n1,  \\text{若 } x \\text{ 到 } x_0 \\text{ 的周期距离 } \\le \\dfrac{W}{2},\\\\\n0,  \\text{其他情况}。\n\\end{cases}\n$$\n- 时间 $T$ 的物理（精确）解是相同的高帽函数平移 $a\\,T$ 的距离。因此，时间 $T$ 的物理影响区域（精确非零区域）是在周期域上以 $x_0 + a\\,T$ 为中心、长度为 $W$ 的区间。\n\n数值依赖域长度：\n- 对于在均匀网格上应用 $n$ 次的显式迎风格式，值 $u_i^n$ 仅取决于初始值 $\\{u_{i-k}^0\\}_{k=0}^n$。因此，在物理空间中，数值依赖域最多跨越上游长度 $n\\,\\Delta x$。\n\n需要计算的受控度量：\n1. 计算时间 $T$ 的非局域影响增长率，\n$$\nR_{\\text{nonlocal}} = \\frac{\\sum_{i=0}^{N-1} \\left|u_i^n\\right| \\,\\mathbf{1}_{\\text{在 T 时刻位于精确支集之外}}}{\\sum_{i=0}^{N-1} \\left|u_i^n\\right|},\n$$\n其中，如果 $x_i$ 位于时间 $T$ 的精确平移后的高帽函数支集之外，则 $\\mathbf{1}_{\\text{在 T 时刻位于精确支集之外}}$ 为 $1$，否则为 $0$。该比率量化了数值影响有多少位于物理允许区域之外，并用绝对值表示的总数值质量进行归一化；它是无量纲的。\n2. 计算包容误差率，\n$$\n\\mu_{\\text{contain}} = \\frac{\\max\\left(0,\\,a\\,T - n\\,\\Delta x\\right)}{W},\n$$\n它量化了未被数值依赖域长度覆盖的物理依赖域长度的比例；它是无量纲的。\n\n实现细节：\n- 使用周期性边界条件。\n- 精确按照所述方式使用 $a>0$ 的迎风格式。\n- 使用时间 $T$ 的精确平移高帽函数来确定物理允许区域。\n\n单位：\n- 所有物理参数必须以国际单位制 (SI) 处理：米 ($\\text{m}$) 和秒 ($\\text{s}$)。报告的比率 $R_{\\text{nonlocal}}$ 和 $\\mu_{\\text{contain}}$ 是无量纲量；请以小数形式报告。\n\n测试套件：\n使用四个测试用例，探究“理想路径”、边界和违规情景：\n- 用例 1：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 0.5$。\n- 用例 2：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 1.0$。\n- 用例 3：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 1.3$。\n- 用例 4：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 2.0$。\n\n对于每个用例，设置 $\\Delta x = L/N$ 和 $\\Delta t = C\\,\\Delta x/a$。然后演化 $n$ 步到达 $T = n\\,\\Delta t$，计算 $R_{\\text{nonlocal}}$ 和 $\\mu_{\\text{contain}}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，结果按以下顺序排列：\n$$\n\\left[ R_{\\text{nonlocal}}^{(1)}, \\mu_{\\text{contain}}^{(1)}, R_{\\text{nonlocal}}^{(2)}, \\mu_{\\text{contain}}^{(2)}, R_{\\text{nonlocal}}^{(3)}, \\mu_{\\text{contain}}^{(3)}, R_{\\text{nonlocal}}^{(4)}, \\mu_{\\text{contain}}^{(4)} \\right].\n$$\n换句话说，对于每个测试用例，按顺序先输出 $R_{\\text{nonlocal}}$，再输出 $\\mu_{\\text{contain}}$，所有值都在一行上，以指定列表格式的小数形式呈现。",
            "solution": "一维线性平流方程 $u_t + a\\,u_x = 0$ 沿着特征曲线 $x(t) = x_0 + a\\,t$ 传输标量 $u$ 而不改变其形状。基于此基本原理，点 $(x,t)$ 处解的物理依赖域精确地为点 $(x - a\\,t, 0)$；等价地，对于紧支集初始条件，物理影响区域是初始支集沿周期域平移距离 $a\\,t$ 的结果。\n\n在间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格 $\\{x_i\\}$ 上，通过显式一阶迎风格式（对于 $a>0$）进行离散化，使用更新公式：\n$$\nu_i^{n+1} = u_i^n - C\\left(u_i^n - u_{i-1}^n\\right), \\quad C = \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\n该公式是用于双曲输运的、经过充分检验的标准有限差分近似，它是通过平衡离散通量差与时间变化率推导得出的。重复应用 $n$ 步可得：\n$$\nu_i^n = \\sum_{k=0}^{n} \\binom{n}{k} C^k (1-C)^{n-k}\\,u_{i-k}^0,\n$$\n这表明点 $(i,n)$ 的数值仅依赖于下标为 $i-k$（其中 $k \\in \\{0,1,\\dots,n\\}$）的上游初始值。在物理空间中，该约束意味着数值依赖域在 $n$ 步后最多跨越上游长度 $n\\,\\Delta x$。相比之下，时间 $T = n\\,\\Delta t$ 的物理依赖域沿着特征位移，从一个特征的初始位置算起，跨越长度 $a\\,T$。\n\nCourant–Friedrichs–Lewy 条件对于显式格式，确保物理依赖域包含在数值依赖域之内。在当前的推导中，这一包容要求通过比较长度体现出来：数值最大上游到达范围 $n\\,\\Delta x$ 必须足以覆盖物理到达范围 $a\\,T$，否则连续问题所需的信息将位于显式模板的影响范围之外。我们不作任何先验不等式假设或陈述；相反，我们通过以下公式直接量化这种不匹配：\n$$\n\\mu_{\\text{contain}} = \\frac{\\max(0, a\\,T - n\\,\\Delta x)}{W},\n$$\n它相对于高帽宽度 $W$ 度量了未被数值依赖域覆盖的物理所需上游范围的比例。如果 $a\\,T \\le n\\,\\Delta x$，则 $\\mu_{\\text{contain}} = 0$ 且包容条件成立。\n\n为了评估非局域影响增长，考虑一个在周期域上以 $x_0$ 为中心、宽度为 $W$、振幅为 $1$ 的紧支集高帽初始条件。时间 $T$ 的精确解是相同的高帽函数平移 $a\\,T$ 的距离，在长度为 $L$ 的圆上，其支集长度为 $W$，中心在 $x_0 + a\\,T$。任何出现在此精确支集之外的数值影响都代表相对于物理（精确）解的非局域扩散。一个受控的无量纲度量是：\n$$\nR_{\\text{nonlocal}} = \\frac{\\sum_{i=0}^{N-1} \\left|u_i^n\\right| \\,\\mathbf{1}_{\\{x_i \\notin \\text{T 时刻的精确支集}\\}}}{\\sum_{i=0}^{N-1} \\left|u_i^n\\right|},\n$$\n这是位于精确的物理影响区域之外的总数值质量（取绝对值）的比例。该度量既能捕捉色散行为也能捕捉不稳定行为：类扩散格式产生小的但非零的 $R_{\\text{nonlocal}}$，而违反包容条件则产生更大的 $R_{\\text{nonlocal}}$，通常伴随着振荡增长。\n\n算法步骤：\n1. 对每个测试用例，设置 $L$、$N$、$a$、$W$、$x_0$、$n$ 和 $C$，计算 $\\Delta x = L/N$ 和 $\\Delta t = C\\,\\Delta x/a$，并设置 $T = n\\,\\Delta t$。\n2. 通过以 $x_0$ 为中心、宽度为 $W$ 的周期性高帽函数初始化 $u^0$：如果周期距离 $\\min(|x_i-x_0|, L-|x_i-x_0|) \\le W/2$，则设 $u_i^0 = 1$，否则 $u_i^0 = 0$。\n3. 通过应用迎风更新 $n$ 次来演化 $u^n$，并采用周期性边界条件：$u^{n+1} = (1-C)\\,u^n + C\\,\\text{roll}(u^n, 1)$。\n4. 构建时间 $T$ 的精确支集掩码，即周期距离到 $x_0 + a\\,T$ 小于或等于 $W/2$ 的网格点集合。\n5. 通过对精确支集外的 $|u_i^n|$求和并用总和 $\\sum_i |u_i^n|$ 进行归一化，来计算 $R_{\\text{nonlocal}}$。\n6. 计算 $\\mu_{\\text{contain}} = \\max(0, a\\,T - n\\,\\Delta x)/W$。\n7. 按指定顺序将结果输出为单个方括号列表。\n\n测试套件的定性预期：\n- 用例 1，$C = 0.5$（“理想路径”）：包容条件成立，因为 $a\\,T \\le n\\,\\Delta x$，所以 $\\mu_{\\text{contain}} = 0$。格式是稳定且具有扩散性的；由于数值扩散将一些质量扩散到精确支集之外，$R_{\\text{nonlocal}}$ 非零但值适中。\n- 用例 2，$C = 1.0$（边界）：离散更新简化为纯粹平移 $u_i^{n+1} = u_{i-1}^n$，在网格上产生精确平移。当 $x_0$ 与网格点对齐且 $W$ 被选为 $\\Delta x$ 的倍数时，时间 $T$ 的精确支集与数值支集重合，因此 $R_{\\text{nonlocal}}$ 接近 $0$，且 $\\mu_{\\text{contain}} = 0$。\n- 用例 3，$C = 1.3$（违规）：物理到达范围 $a\\,T$ 超过 $n\\,\\Delta x$，导致 $\\mu_{\\text{contain}} > 0$。格式产生振荡和日益增长的非局域扩散；由于质量出现在精确支集之外，$R_{\\text{nonlocal}}$ 增大。\n- 用例 4，$C = 2.0$（严重违规）：包容条件失效更严重，$\\mu_{\\text{contain}}$ 更大，且不稳定性导致显著的非局域影响；$R_{\\text{nonlocal}}$ 很大。\n\n本实验将从特征线推导（物理依赖域）与重复模板所及范围（数值依赖域）联系起来，量化它们之间的不匹配，并度量当数值格式在显式双曲输运所需的包容条件之外运行时产生的非局域影响的增长。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef periodic_distance(x, x0, L):\n    \"\"\"Compute the minimal periodic distance on [0,L).\"\"\"\n    d = np.abs(x - x0)\n    return np.minimum(d, L - d)\n\ndef initialize_top_hat(x, x0, W, L):\n    \"\"\"Top-hat initial condition: 1 inside periodic distance = W/2, else 0.\"\"\"\n    dist = periodic_distance(x, x0, L)\n    return (dist = (W / 2.0)).astype(float)\n\ndef upwind_evolve(u0, C, n_steps):\n    \"\"\"Evolve using explicit first-order upwind scheme for a  0 with periodic BC.\"\"\"\n    u = u0.copy()\n    for _ in range(n_steps):\n        # u^{n+1} = (1 - C) * u^n + C * u_{i-1}^n, with periodic shift by +1 index\n        u = (1.0 - C) * u + C * np.roll(u, 1)\n    return u\n\ndef exact_support_mask(x, x_center, W, L):\n    \"\"\"Mask for exact support (1 inside top-hat centered at x_center, else 0).\"\"\"\n    dist = periodic_distance(x, x_center, L)\n    return (dist = (W / 2.0)).astype(float)\n\ndef nonlocal_influence_ratio(u, mask):\n    \"\"\"Compute R_nonlocal = mass outside exact support / total mass (absolute).\"\"\"\n    abs_u = np.abs(u)\n    total_mass = abs_u.sum()\n    if total_mass == 0.0:\n        return 0.0\n    outside = (mask == 0.0)\n    nonlocal_mass = abs_u[outside].sum()\n    return float(nonlocal_mass / total_mass)\n\ndef containment_error_ratio(a, T, n_steps, dx, W):\n    \"\"\"Compute mu_contain = max(0, a T - n dx) / W.\"\"\"\n    reach_phys = a * T\n    reach_num = n_steps * dx\n    return float(max(0.0, reach_phys - reach_num) / W)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], N, a [m/s], W [m], x0 [m], n_steps, C)\n    L = 1.0\n    N = 400\n    a = 1.0\n    W = 0.1\n    x0 = 0.25 * L\n    n_steps = 60\n\n    test_cases = [\n        (L, N, a, W, x0, n_steps, 0.5),  # Case 1: happy path\n        (L, N, a, W, x0, n_steps, 1.0),  # Case 2: boundary\n        (L, N, a, W, x0, n_steps, 1.3),  # Case 3: violation\n        (L, N, a, W, x0, n_steps, 2.0),  # Case 4: strong violation\n    ]\n\n    results = []\n    for case in test_cases:\n        R_nonlocal, mu_contain = run_case(*case)\n        # Format to a reasonable precision\n        results.append(f\"{R_nonlocal:.6f}\")\n        results.append(f\"{mu_contain:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现实世界中的流体问题几乎都是多维的，因此将我们在一维情况下学到的知识推广至更高维度至关重要。本练习  将CFL条件的应用扩展到二维线性平流方程。你将通过一种不同于冯·诺依曼分析的方法，即确保数值更新格式的系数构成一个凸组合，来推导多维情况下的稳定性约束，这为保证解的正定性提供了一种直观的途径。",
            "id": "3372303",
            "problem": "考虑二维常系数线性平流方程\n$$\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} + b\\,\\frac{\\partial u}{\\partial y} = 0,$$\n该方程定义在一个均匀的笛卡尔网格上，网格间距为 $\\Delta x$ 和 $\\Delta y$，并使用大小为 $\\Delta t$ 的显式向前欧拉步长进行时间推进。空间离散化采用一阶、维度非分裂的迎风有限体积法。假设速度分量 $a$ 和 $b$ 是常数且已知。Courant–Friedrichs–Lewy (CFL) 条件通过确保数值依赖域包含偏微分方程的依赖域来保证稳定性。\n\n从在单元 $(i,j)$ 上应用与 $a$ 和 $b$ 符号一致的迎风差分得到的离散守恒更新出发，推导保证所有更新系数为非负并形成相邻值的凸组合的条件。利用此条件，得到维度非分裂迎风法以 $a$、$b$、$\\Delta x$ 和 $\\Delta y$ 表示的最大稳定时间步长 $\\Delta t$。\n\n然后，对于具体数值 $a=1$ m/s、$b=-0.5$ m/s、$\\Delta x=0.01$ m 和 $\\Delta y=0.005$ m，计算最大稳定时间步长 $\\Delta t$。将最终数值答案四舍五入至 $3$ 位有效数字，并以秒为单位表示 $\\Delta t$。",
            "solution": "本问题要求推导应用于二维线性平流方程的一阶迎风、维度非分裂有限体积法的稳定性条件，然后根据给定的参数集计算最大稳定时间步长。\n\n### 第 1 步：提取已知条件\n- **偏微分方程 (PDE)**: $\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} + b\\,\\frac{\\partial u}{\\partial y} = 0$\n- **网格**: 均匀笛卡尔网格，间距为 $\\Delta x$ 和 $\\Delta y$。\n- **时间离散化**: 显式向前欧拉法，步长为 $\\Delta t$。\n- **空间离散化**: 一阶、维度非分裂、迎风有限体积法。\n- **速度**: $a$ 和 $b$ 是常数。\n- **稳定性判据**: 数值更新系数必须为非负且形成一个凸组合。\n- **数值**: $a=1$ m/s, $b=-0.5$ m/s, $\\Delta x=0.01$ m, $\\Delta y=0.005$ m。\n- **输出要求**: 计算最大稳定时间步长 $\\Delta t$，并四舍五入至 $3$ 位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n这是一个偏微分方程数值分析（特别是在计算流体动力学领域）的标准练习题。它具备以下特点：\n- **科学上成立**: 问题涉及双曲型偏微分方程公认的 Courant-Friedrichs-Lewy (CFL) 条件，这是数值方法中的一个基本概念。\n- **适定的**: 问题要求推导稳定性条件并进行后续计算，其答案是唯一且明确的。\n- **客观的**: 问题使用精确的数学和计算术语进行陈述。\n- **自洽且一致的**: 所有必要信息均已提供。\n\n问题是有效的。\n\n### 第 3 步：形式推导\n给定的偏微分方程可以写成守恒形式：\n$$ \\frac{\\partial u}{\\partial t} + \\frac{\\partial F}{\\partial x} + \\frac{\\partial G}{\\partial y} = 0 $$\n其中通量为 $F = au$ 和 $G = bu$，因为 $a$ 和 $b$ 是常数。\n\n我们应用有限体积法，将此方程在一个以 $(x_i, y_j)$ 为中心、尺寸为 $\\Delta x \\times \\Delta y$ 的控制体（单元）$V_{i,j}$ 上积分。设 $u_{i,j}(t)$ 为单元 $(i,j)$ 在时间 $t$ 时 $u$ 的单元平均值。守恒律的半离散形式为：\n$$ \\frac{du_{i,j}}{dt} + \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} + \\frac{G_{i,j+1/2} - G_{i,j-1/2}}{\\Delta y} = 0 $$\n这里，$F_{i+1/2,j}$ 和 $G_{i,j+1/2}$ 是单元界面上的数值通量。\n\n对于一阶迎风格式，界面上的通量由“迎风”单元中的值决定。风向由平流速度 $a$ 和 $b$ 的符号给出。\n数值通量函数为：\n$$ F_{i+1/2,j} = \\begin{cases} a u_{i,j}  \\text{if } a  0 \\\\ a u_{i+1,j}  \\text{if } a  0 \\end{cases} $$\n$$ G_{i,j+1/2} = \\begin{cases} b u_{i,j}  \\text{if } b  0 \\\\ b u_{i,j+1}  \\text{if } b  0 \\end{cases} $$\n我们可以使用定义 $v^+ = \\frac{1}{2}(v+|v|) = \\max(v,0)$ 和 $v^- = \\frac{1}{2}(v-|v|) = \\min(v,0)$ 更普遍地表达这一点。注意 $v = v^+ + v^-$。\n数值通量 $F_{i+1/2,j}$ 由下式给出：\n$$ F_{i+1/2,j} = a^+ u_{i,j} + a^- u_{i+1,j} $$\n类似地，通量 $G_{i,j+1/2}$ 为：\n$$ G_{i,j+1/2} = b^+ u_{i,j} + b^- u_{i,j+1} $$\n穿过单元 $(i,j)$ 的通量差为：\n$$ F_{i+1/2,j} - F_{i-1/2,j} = (a^+ u_{i,j} + a^- u_{i+1,j}) - (a^+ u_{i-1,j} + a^- u_{i,j}) = a^+(u_{i,j} - u_{i-1,j}) + a^-(u_{i+1,j} - u_{i,j}) $$\n$$ G_{i,j+1/2} - G_{i,j-1/2} = (b^+ u_{i,j} + b^- u_{i,j+1}) - (b^+ u_{i,j-1} + b^- u_{i,j}) = b^+(u_{i,j} - u_{i,j-1}) + b^-(u_{i,j+1} - u_{i,j}) $$\n将这些代入半离散方程：\n$$ \\frac{du_{i,j}}{dt} = -\\frac{1}{\\Delta x} \\left[ a^+(u_{i,j} - u_{i-1,j}) + a^-(u_{i+1,j} - u_{i,j}) \\right] - \\frac{1}{\\Delta y} \\left[ b^+(u_{i,j} - u_{i,j-1}) + b^-(u_{i,j+1} - u_{i,j}) \\right] $$\n现在，我们应用显式向前欧拉时间步进格式：$\\frac{u_{i,j}^{n+1} - u_{i,j}^n}{\\Delta t} = \\left(\\frac{du_{i,j}}{dt}\\right)^n$。设 $u_{i,j}^n$ 表示在时间 $t_n$ 的值。\n$$ u_{i,j}^{n+1} = u_{i,j}^n - \\frac{\\Delta t}{\\Delta x} \\left[ a^+(u_{i,j}^n - u_{i-1,j}^n) + a^-(u_{i+1,j}^n - u_{i,j}^n) \\right] - \\frac{\\Delta t}{\\Delta y} \\left[ b^+(u_{i,j}^n - u_{i,j-1}^n) + b^-(u_{i,j+1}^n - u_{i,j}^n) \\right] $$\n我们重新整理各项，将 $u_{i,j}^{n+1}$ 表示为时间 $n$ 处值的线性组合：\n$$ u_{i,j}^{n+1} = u_{i,j}^n - \\frac{\\Delta t}{\\Delta x}(a^+ - a^-)u_{i,j}^n - \\frac{\\Delta t}{\\Delta y}(b^+ - b^-)u_{i,j}^n + \\frac{\\Delta t}{\\Delta x} a^+ u_{i-1,j}^n - \\frac{\\Delta t}{\\Delta x} a^- u_{i+1,j}^n + \\frac{\\Delta t}{\\Delta y} b^+ u_{i,j-1}^n - \\frac{\\Delta t}{\\Delta y} b^- u_{i,j+1}^n $$\n使用恒等式 $|v| = v^+ - v^-$、$v^+ \\ge 0$ 和 $v^- \\le 0$：\n$$ u_{i,j}^{n+1} = \\left(1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}\\right) u_{i,j}^n + \\left(\\frac{a^+\\Delta t}{\\Delta x}\\right) u_{i-1,j}^n + \\left(\\frac{-a^-\\Delta t}{\\Delta x}\\right) u_{i+1,j}^n + \\left(\\frac{b^+\\Delta t}{\\Delta y}\\right) u_{i,j-1}^n + \\left(\\frac{-b^-\\Delta t}{\\Delta y}\\right) u_{i,j+1}^n $$\n这是完整的更新方程。为了使更新成为一个凸组合，所有 $u^n$ 值的系数必须是非负的，并且它们的和必须为 $1$。\n我们来检查这些系数：\n- $u_{i-1,j}^n$ 的系数：$\\frac{a^+\\Delta t}{\\Delta x}$。因为 $a^+ \\ge 0$、$\\Delta t  0$ 和 $\\Delta x  0$，所以此系数是非负的。\n- $u_{i+1,j}^n$ 的系数：$\\frac{-a^-\\Delta t}{\\Delta x}$。因为 $a^- \\le 0$，所以此系数是非负的。\n- $u_{i,j-1}^n$ 的系数：$\\frac{b^+\\Delta t}{\\Delta y}$。因为 $b^+ \\ge 0$，所以此系数是非负的。\n- $u_{i,j+1}^n$ 的系数：$\\frac{-b^-\\Delta t}{\\Delta y}$。因为 $b^- \\le 0$，所以此系数是非负的。\n- $u_{i,j}^n$ 的系数：$1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}$。为了使此项为非负，我们必须有：\n$$ 1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y} \\ge 0 $$\n这导出了稳定性条件：\n$$ \\frac{|a|\\Delta t}{\\Delta x} + \\frac{|b|\\Delta t}{\\Delta y} \\le 1 $$\n我们来验证系数之和是否为 $1$。其和为：\n$$ \\left(1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}\\right) + \\frac{a^+\\Delta t}{\\Delta x} - \\frac{a^-\\Delta t}{\\Delta x} + \\frac{b^+\\Delta t}{\\Delta y} - \\frac{b^-\\Delta t}{\\Delta y} $$\n$$ = 1 - \\left(\\frac{|a| - (a^+ - a^-)}{\\Delta x}\\right)\\Delta t - \\left(\\frac{|b| - (b^+ - b^-)}{\\Delta y}\\right)\\Delta t $$\n因为对于任何 $v$ 都有 $|v| = v^+ - v^-$，所以括号中的项为零。系数之和恰好为 $1$。\n因此，凸组合更新的条件（也即该格式的稳定性条件）是：\n$$ \\Delta t \\left( \\frac{|a|}{\\Delta x} + \\frac{|b|}{\\Delta y} \\right) \\le 1 $$\n当等号成立时，得到最大稳定时间步长 $\\Delta t_{max}$：\n$$ \\Delta t_{max} = \\frac{1}{\\frac{|a|}{\\Delta x} + \\frac{|b|}{\\Delta y}} $$\n\n### 第 4 步：数值计算\n现在我们代入给定的数值：$a=1$ m/s、$b=-0.5$ m/s、$\\Delta x=0.01$ m 和 $\\Delta y=0.005$ m。\n首先，我们求出速度的绝对值：\n$$ |a| = |1| = 1 \\text{ m/s} $$\n$$ |b| = |-0.5| = 0.5 \\text{ m/s} $$\n接下来，我们计算分母中的各项：\n$$ \\frac{|a|}{\\Delta x} = \\frac{1 \\text{ m/s}}{0.01 \\text{ m}} = 100 \\text{ s}^{-1} $$\n$$ \\frac{|b|}{\\Delta y} = \\frac{0.5 \\text{ m/s}}{0.005 \\text{ m}} = 100 \\text{ s}^{-1} $$\n最后，我们计算 $\\Delta t_{max}$：\n$$ \\Delta t_{max} = \\frac{1}{100 \\text{ s}^{-1} + 100 \\text{ s}^{-1}} = \\frac{1}{200 \\text{ s}^{-1}} = 0.005 \\text{ s} $$\n问题要求将答案四舍五入到 $3$ 位有效数字。\n$$ \\Delta t_{max} = 0.00500 \\text{ s} = 5.00 \\times 10^{-3} \\text{ s} $$",
            "answer": "$$ \\boxed{5.00 \\times 10^{-3}} $$"
        }
    ]
}