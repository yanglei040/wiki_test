{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将介绍核心概念——放大因子 $R(z)$。我们将为后向欧拉法（一种基本的 L-稳定格式）推导该因子，并将其应用于一个物理扩散模型，以理解如何量化刚性系统的稳定性。这个练习将为您分析任何时间积分格式提供基础技能。",
            "id": "3287261",
            "problem": "考虑一维热方程 $u_t = \\nu u_{xx}$，定义在一个周期性区域上，使用二阶中心有限差分在间距为 $\\Delta x > 0$ 的均匀网格上进行空间离散化。这产生了一个半离散线性系统 $\\frac{d\\mathbf{u}}{dt}=\\mathbf{A}\\mathbf{u}$，其中 $\\mathbf{A}$ 是离散扩散算子。对于此算子，控制最快衰减傅里叶模式的最大（绝对值最小的负）特征值可以很好地近似为 $\\lambda_{\\max}\\approx -\\frac{4\\nu}{\\Delta x^{2}}$。令 $h > 0$ 表示时间步长。\n\n选择单级对角隐式龙格-库塔（SDIRK）格式（Backward Euler），该方法是 L-稳定的，其 Butcher tableau 定义为 $c=[1]$，$A=[1]$ 和 $b=[1]$。对于由标量测试方程 $y'(t)=\\lambda\\,y(t)$ 控制的单个特征模式，该方法的单步更新可以写成 $y_{n+1}=R(h\\lambda)\\,y_{n}$ 的形式，其中 $R$ 是放大因子（稳定性函数）。\n\n从 Backward Euler 方法的定义和单个特征模式的半离散线性演化出发，推导放大因子 $R(z)$（其中 $z=h\\lambda$），然后在扩散极端情况 $z=h\\lambda_{\\max}$（其中 $\\lambda_{\\max}\\approx -\\frac{4\\nu}{\\Delta x^{2}}$）下对其进行求值。请以 $h$、$\\nu$ 和 $\\Delta x$ 表示的单个简化解析表达式的形式提供最终结果。不要包含单位，也不要四舍五入。",
            "solution": "该问题要求推导 Backward Euler 方法的放大因子，并针对与一维热方程相关的特定情况对其进行求值。该过程包括两个主要步骤：首先，推导稳定性函数 $R(z)$；其次，将给定的 $z$ 值代入此函数。\n\nBackward Euler 方法是一种单级对角隐式龙格-库塔（SDIRK）方法。对于形如 $\\frac{dy}{dt} = f(t,y)$ 的一般初值问题，从时间步 $n$ 到 $n+1$ 的更新由下式给出：\n$$y_{n+1} = y_n + h f(t_{n+1}, y_{n+1})$$\n其中 $h$ 是时间步长。\n\n问题指定将此方法应用于标量线性测试方程：\n$$\\frac{dy}{dt} = \\lambda y$$\n对于此方程，函数 $f$ 为 $f(t,y) = \\lambda y$。将其代入 Backward Euler 公式可得：\n$$y_{n+1} = y_n + h (\\lambda y_{n+1})$$\n\n放大因子（或稳定性函数）$R(z)$ 由关系式 $y_{n+1} = R(z) y_n$ 定义，其中 $z = h\\lambda$。为了求出 $R(z)$，我们必须求解更新方程，用 $y_n$ 来表示 $y_{n+1}$。\n重新整理方程，将含有 $y_{n+1}$ 的项归到一起：\n$$y_{n+1} - h\\lambda y_{n+1} = y_n$$\n从左侧提出公因子 $y_{n+1}$：\n$$y_{n+1} (1 - h\\lambda) = y_n$$\n两边同时除以 $y_n$ 和 $(1-h\\lambda)$，得到比率 $\\frac{y_{n+1}}{y_n}$：\n$$\\frac{y_{n+1}}{y_n} = \\frac{1}{1 - h\\lambda}$$\n根据定义，该比率即为放大因子 $R(z)$。代入 $z = h\\lambda$，我们有：\n$$R(z) = \\frac{1}{1 - z}$$\n这样就完成了推导的第一部分。\n\n接下来，我们必须对给定的特定情况评估此放大因子。问题涉及半离散化的热方程 $u_t = \\nu u_{xx}$，其中空间离散算子的最大绝对值特征值近似为：\n$$\\lambda_{\\max} \\approx -\\frac{4\\nu}{\\Delta x^{2}}$$\n该特征值对应于最快衰减的模式，并对显式方法施加了最严格的稳定性约束。稳定性函数的自变量 $z$ 为 $z = h\\lambda$。对于此特定模式，我们有：\n$$z = h \\lambda_{\\max} \\approx h \\left( -\\frac{4\\nu}{\\Delta x^{2}} \\right) = -\\frac{4h\\nu}{\\Delta x^{2}}$$\n现在，我们将 $z$ 的这个特定表达式代入已推导出的稳定性函数 $R(z)$ 中：\n$$R\\left(-\\frac{4h\\nu}{\\Delta x^{2}}\\right) = \\frac{1}{1 - \\left(-\\frac{4h\\nu}{\\Delta x^{2}}\\right)}$$\n化简分母：\n$$R = \\frac{1}{1 + \\frac{4h\\nu}{\\Delta x^{2}}}$$\n为了得到一个简化的单分数，我们对主分数的分母中的表达式进行通分：\n$$1 + \\frac{4h\\nu}{\\Delta x^{2}} = \\frac{\\Delta x^{2}}{\\Delta x^{2}} + \\frac{4h\\nu}{\\Delta x^{2}} = \\frac{\\Delta x^{2} + 4h\\nu}{\\Delta x^{2}}$$\n将此代回 $R$ 的表达式中：\n$$R = \\frac{1}{\\frac{\\Delta x^{2} + 4h\\nu}{\\Delta x^{2}}}$$\n最后，将分母取倒数，得到简化的解析表达式：\n$$R = \\frac{\\Delta x^{2}}{\\Delta x^{2} + 4h\\nu}$$\n这是以给定参数 $h$、$\\nu$ 和 $\\Delta x$ 表示的最终结果。",
            "answer": "$$\\boxed{\\frac{\\Delta x^{2}}{\\Delta x^{2} + 4h\\nu}}$$"
        },
        {
            "introduction": "在上一练习的基础上，我们现在直接比较两种重要的方法：L-稳定的隐式欧拉法和 A-稳定的梯形法则。通过计算和对比它们对高频模式的放大因子，您将具体理解为何 L-稳定性对于抑制刚性 CFD 问题中的伪振荡至关重要。这个实践突显了 A-稳定性与更强的 L-稳定性条件之间的实际差异。",
            "id": "3287233",
            "problem": "考虑计算流体动力学（CFD）中的一维粘性扩散方程\n$$\n\\frac{\\partial u}{\\partial t} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n该方程定义在周期性域 $[0,L]$ 上，其中 $L=1$ 米。使用 $N=256$ 个均匀间隔的网格点，并对拉普拉斯算子采用二阶中心差分格式来离散空间，从而得到方法线半离散系统\n$$\n\\frac{d \\mathbf{u}}{dt} = \\nu \\mathbf{L} \\mathbf{u},\n$$\n其中 $\\mathbf{L}$ 是标准的离散周期性拉普拉斯算子。假设运动粘度为 $\\nu = 1.0 \\times 10^{-4} \\, \\text{m}^{2}/\\text{s}$。使用大小为 $\\Delta t = 2$ 秒的单个时间步长，通过隐式欧拉法或梯形法则（也称为 Crank–Nicolson 方法）对半离散系统进行时间推进。\n\n从应用于线性标量测试方程 $y'=\\lambda y$ 的单步法的稳定性函数定义出发，为每种方法推导周期性离散拉普拉斯算子的最高离散傅里叶模态的单步数值放大因子。利用最高离散傅里叶模态对应于均匀周期网格上的奈奎斯特波数这一事实。然后，使用这些放大因子，计算一个时间步长后最高模态的放大因子绝对值之比（隐式欧拉法结果除以梯形法则结果）。\n\n将最终答案四舍五入至四位有效数字。将最终答案表示为一个无量纲实数。",
            "solution": "用户希望解决一个基于计算流体动力学原理的问题。\n\n### 步骤 1：问题验证\n\n根据所需标准对问题陈述进行验证。\n\n**提取的已知条件：**\n- 控制方程：$\\frac{\\partial u}{\\partial t} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}}$\n- 域：周期性，$[0, L]$，其中 $L=1 \\, \\text{m}$。\n- 空间离散化：方法线，使用 $N=256$ 个均匀网格点和拉普拉斯算子的二阶中心差分，得到系统 $\\frac{d \\mathbf{u}}{dt} = \\nu \\mathbf{L} \\mathbf{u}$。\n- 运动粘度：$\\nu = 1.0 \\times 10^{-4} \\, \\text{m}^{2}/\\text{s}$。\n- 时间积分：使用隐式欧拉法或梯形法则，步长为 $\\Delta t = 2 \\, \\text{s}$ 的单步。\n- 任务：\n  1. 推导每种方法的最高离散傅里叶模态的单步数值放大因子。\n  2. 最高离散傅里叶模态对应奈奎斯特波数。\n  3. 计算放大因子绝对值之比：$\\frac{|\\text{放大因子（隐式欧拉法）}|}{|\\text{放大因子（梯形法则）}|}$。\n  4. 将最终答案四舍五入到四位有效数字。\n\n**验证分析：**\n- **科学依据：** 该问题基于扩散方程（输运现象的基石），并采用了计算科学与工程中使用的标准数值方法（方法线、有限差分、隐式欧拉法、梯形法则）和分析技术（冯·诺依曼稳定性分析）。物理参数是合理的。该问题在科学上是合理的。\n- **适定性：** 问题定义清晰，提供了所有必要的参数（$L, N, \\nu, \\Delta t$）和定义。目标是计算一个特定的、唯一定义的比率。\n- **客观性：** 问题使用精确、明确的技术语言陈述。它不含主观或基于观点的内容。\n\n**结论：**\n该问题是有效的，因为它具有科学依据、适定性、客观性且自成体系。可以进行求解过程。\n\n### 步骤 2：推导与求解\n\n求解过程首先确定半离散系统的相关特征值，然后分析指定时间积分方案的放大因子。\n\n**离散拉普拉斯算子的特征值**\n空间域为 $[0, L]$，其中 $L=1 \\, \\text{m}$，被离散为 $N=256$ 个点。网格间距为 $\\Delta x = \\frac{L}{N} = \\frac{1}{256} \\, \\text{m}$。在网格点 $j$ 处，二阶导数的二阶中心差分近似由下式给出：\n$$\n\\left(\\frac{\\partial^{2} u}{\\partial x^{2}}\\right)_j \\approx \\frac{u_{j+1} - 2 u_j + u_{j-1}}{(\\Delta x)^2}\n$$\n这定义了离散拉普拉斯算子 $\\mathbf{L}$。为了找到它的特征值，我们将 $\\mathbf{L}$ 应用于一个离散傅里叶模态 $u_j(t) = \\hat{u}_k(t) e^{i k x_j}$，其中 $k$ 是波数，$x_j=j\\Delta x$。\n$$\n(\\mathbf{L} e^{i k j \\Delta x})_j = \\frac{e^{i k(j+1)\\Delta x} - 2e^{i k j \\Delta x} + e^{i k(j-1)\\Delta x}}{(\\Delta x)^2} = e^{i k j \\Delta x} \\frac{e^{i k \\Delta x} - 2 + e^{-i k \\Delta x}}{(\\Delta x)^2}\n$$\n对于波数 $k$，$\\mathbf{L}$ 的特征值，记为 $\\lambda_{\\mathbf{L},k}$，是：\n$$\n\\lambda_{\\mathbf{L},k} = \\frac{2\\cos(k\\Delta x) - 2}{(\\Delta x)^2} = -\\frac{4\\sin^2(k\\Delta x/2)}{(\\Delta x)^2}\n$$\n问题要求分析最高离散傅里叶模态，它对应于奈奎斯特波数 $k_{Nyquist}$。在间距为 $\\Delta x$ 的网格上，这是 $k_{Nyquist} = \\frac{\\pi}{\\Delta x}$。将此代入特征值表达式，得到：\n$$\n\\lambda_{\\mathbf{L}, highest} = -\\frac{4\\sin^2((\\pi/\\Delta x)\\Delta x/2)}{(\\Delta x)^2} = -\\frac{4\\sin^2(\\pi/2)}{(\\Delta x)^2} = -\\frac{4}{(\\Delta x)^2}\n$$\n对于这单个模态，半离散系统的行为类似于标量常微分方程（ODE）$y' = \\lambda y$，其中 $\\lambda$ 是整个系统的有效特征值：\n$$\n\\lambda_{eff} = \\nu \\lambda_{\\mathbf{L}, highest} = -\\frac{4\\nu}{(\\Delta x)^2}\n$$\n代入给定值：$\\nu = 1.0 \\times 10^{-4} \\, \\text{m}^2/\\text{s}$，$L=1 \\, \\text{m}$，以及 $N=256$，所以 $\\Delta x = \\frac{1}{256} \\, \\text{m}$：\n$$\n\\lambda_{eff} = -\\frac{4(1.0 \\times 10^{-4})}{(1/256)^2} = -4 \\times 10^{-4} \\times 256^2 = -4 \\times 10^{-4} \\times 65536 = -26.2144 \\, \\text{s}^{-1}\n$$\n\n**放大因子**\n应用于 $y'=\\lambda y$ 的单步数值方法给出 $y_{n+1} = G \\, y_n$，其中 $G$ 是放大因子，它是在 $z = \\lambda \\Delta t$ 处求值的稳定性函数 $R(z)$。此处，$z = \\lambda_{eff} \\Delta t$。\n$$\nz = (-26.2144 \\, \\text{s}^{-1}) \\times (2 \\, \\text{s}) = -52.4288\n$$\n1.  **隐式欧拉法：** 该格式为 $y_{n+1} = y_n + \\Delta t (\\lambda y_{n+1})$。其稳定性函数为 $R_{IE}(z) = \\frac{1}{1-z}$。放大因子为：\n    $$\n    G_{IE} = R_{IE}(-52.4288) = \\frac{1}{1 - (-52.4288)} = \\frac{1}{53.4288}\n    $$\n2.  **梯形法则（Crank-Nicolson）：** 该格式为 $y_{n+1} = y_n + \\frac{\\Delta t}{2}(\\lambda y_n + \\lambda y_{n+1})$。其稳定性函数为 $R_{TR}(z) = \\frac{1+z/2}{1-z/2}$。放大因子为：\n    $$\n    G_{TR} = R_{TR}(-52.4288) = \\frac{1 + (-52.4288)/2}{1 - (-52.4288)/2} = \\frac{1 - 26.2144}{1 + 26.2144} = \\frac{-25.2144}{27.2144}\n    $$\n    这种行为是 L-稳定方法与 A-稳定方法的典型特征。对于这个高度刚性的模态（$z \\ll -1$），隐式欧拉法提供了强阻尼（$|G_{IE}| \\approx 0$），而梯形法则则没有（$|G_{TR}| \\approx 1$）。\n\n**放大因子之比**\n问题要求计算这些放大因子绝对值的比率：\n$$\n\\text{比率} = \\frac{|G_{IE}|}{|G_{TR}|} = \\frac{\\left| \\frac{1}{53.4288} \\right|}{\\left| \\frac{-25.2144}{27.2144} \\right|} = \\frac{1/53.4288}{25.2144/27.2144}\n$$\n$$\n\\text{比率} = \\frac{27.2144}{53.4288 \\times 25.2144}\n$$\n计算分母：$53.4288 \\times 25.2144 = 1347.11216256$。\n$$\n\\text{比率} = \\frac{27.2144}{1347.11216256} \\approx 0.02020140089\n$$\n\n**最终答案**\n问题要求将答案四舍五入到四位有效数字。该值为 $0.0202014...$。前四位有效数字是 $2, 0, 2, 0$。下一位数字是 $1$，所以向下舍入。最终答案是 $0.02020$。",
            "answer": "$$\n\\boxed{0.02020}\n$$"
        },
        {
            "introduction": "这最后一个练习将理论与计算相结合，这是计算流体力学中的一项关键技能。您将首先从理论上分析 L-稳定的 TR-BDF2 方法，然后通过编程实现该方法来求解一个刚性边界层问题，并将其性能与 A-稳定的 Crank-Nicolson 方法进行比较。通过量化数值过冲的减少，您将亲眼见证 L-稳定性在产生物理上真实的解方面的实际优势。",
            "id": "3287222",
            "problem": "考虑一个常微分方程 (ODE) 的初值问题 $y'(t) = f(y(t))$，其中 $f$ 是一个足够光滑的函数，及其在标量检验方程 $y'(t) = \\lambda y(t)$（其中 $\\lambda \\in \\mathbb{C}$）上的线性化。2阶梯形法则-向后差分格式 (TR-BDF2) 方法在每个大小为 $h$ 的时间步内使用两个子步：一个大小为 $\\gamma h$ 的梯形法则 (TR) 子步，其后跟一个大小为 $(1 - \\gamma) h$ 的2阶向后差分格式 (BDF2) 子步。在计算流体动力学中，时间积分格式通过绝对稳定性 (A-稳定性) 和 L-稳定性进行评估。A-稳定性意味着对于任何步长 $h > 0$，该方法对所有满足 $\\operatorname{Re}(\\lambda) \\le 0$ 的 $\\lambda$ 都是稳定的；L-稳定性进一步要求稳定性函数 $R(z)$ 对 $z = h \\lambda$ 满足 $\\lim_{z \\to -\\infty} R(z) = 0$，从而保证对快模态的强阻尼。\n\n您的任务是：\n\n- 构建应用于检验方程 $y'(t) = \\lambda y(t)$ 的 TR-BDF2 方法的稳定性函数 $R(z)$，其中参数 $\\gamma \\in (0,1)$。证明对于任何固定的 $\\gamma \\in (0,1)$，TR-BDF2 方法是 L-稳定的；即，证明沿负实轴 $\\lim_{z \\to -\\infty} R(z) = 0$。\n- 实现采用标准参数选择 $\\gamma = 1 - 1/\\sqrt{2}$ 的 TR-BDF2 方法，并将其与 Crank–Nicolson 方法（该方法是 A-稳定的但非 L-稳定的）在一个半离散边界层模型上进行比较。该模型是一维扩散偏微分方程 (PDE) $u_t = \\nu u_{xx}$，定义在域 $x \\in (0,1)$ 上，具有狄利克雷边界条件 $u(0,t) = 1$ 和 $u(1,t) = 0$，以及初始条件 $u(x,0) = 0$。在 $N$ 个内部点上进行空间上的均匀二阶中心差分（网格间距 $\\Delta x = 1/(N+1)$）后，得到的半离散系统为 $y'(t) = A y(t) + b$，其中 $A$ 是按 $\\nu/\\Delta x^2$ 缩放的标准三对角离散拉普拉斯算子，$b$ 编码了边界值。对于小的 $\\Delta x$，该半离散系统是刚性的。物理上可接受的解满足对所有 $x,t$ 都有 $u(x,t) \\in [0,1]$。数值过冲是指任何对这些边界的违反。\n\n将时间步 $n$ 的过冲幅度定义为整个网格上违反边界的最大幅度，即，如果重建的完整状态（包括边界）是 $u^{(n)} \\in \\mathbb{R}^{N+2}$，那么\n$$\n\\mathrm{overshoot}(n) = \\max\\left\\{ \\max_i \\left(u^{(n)}_i - 1,\\, 0\\right),\\; \\max_i \\left(0 - u^{(n)}_i,\\, 0\\right) \\right\\}。\n$$\n将一次运行中的全局过冲幅度定义为\n$$\n\\mathrm{Overshoot} = \\max_n \\mathrm{overshoot}(n)。\n$$\n\n将 TR-BDF2 相对于 Crank–Nicolson 实现的过冲减少量数值化为非负差值\n$$\n\\mathrm{Reduction} = \\mathrm{Overshoot}_{\\text{CN}} - \\mathrm{Overshoot}_{\\text{TR-BDF2}}。\n$$\n\n所有量均为无量纲。不出现角度。您的程序必须为半离散模型构建 $A$ 和 $b$，并对两种方法在固定数量的时间步上进行时间推进，跟踪每种方法的全局过冲并计算减少量。\n\n使用以下测试套件，其中每个测试用例是一个元组 $(N, \\nu, \\alpha, M)$，$N$ 是内部点数，$\\nu$ 是扩散率，时间步长 $h = \\alpha \\Delta x^2 / \\nu$，$M$ 是时间步数：\n\n- 测试用例 1: $(N, \\nu, \\alpha, M) = (64, 1.0, 5.0, 20)$。\n- 测试用例 2: $(N, \\nu, \\alpha, M) = (64, 1.0, 50.0, 20)$。\n- 测试用例 3: $(N, \\nu, \\alpha, M) = (64, 1.0, 200.0, 20)$。\n\n这些用例探索了一个适中的时间步长、一个引起显著刚性的大时间步长，以及一个接近 Crank–Nicolson 方法表现出严重非物理振荡区域的非常大的时间步长。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试用例的顺序排列，例如 $[r_1,r_2,r_3]$，其中每个 $r_i$ 是一个浮点数，等于相应测试用例的 $\\mathrm{Reduction}$。",
            "solution": "该问题被评估为有效的，因为它具有科学依据、是适定的且客观的。它包含一个标准的理论推导和一个在计算流体动力学及数值分析领域中定义明确的数值实验。所有必要的数据和定义都已提供。\n\n### 第1部分：TR-BDF2的理论分析\n\nTR-BDF2 方法是一种复合的、单步、两阶段的格式。对于一个大小为 $h$ 的给定时间步，它由一个大小为 $\\gamma h$ 的梯形法则 (TR) 子步和一个大小为 $(1-\\gamma)h$ 的2阶向后差分格式 (BDF2) 子步组成，其中 $\\gamma \\in (0,1)$。我们通过将该方法应用于标量检验方程 $y'(t) = \\lambda y(t)$（其中 $\\lambda \\in \\mathbb{C}$）来分析其稳定性。令 $z = h\\lambda$。\n\n**1. 稳定性函数 $R(z)$ 的推导**\n\n我们将时间 $t_n$ 的数值解记为 $y_n$。第一个子步计算在时间 $t_n + \\gamma h$ 的中间解 $y_{n+\\gamma}$。第二个子步计算在时间 $t_n + h$ 的最终解 $y_{n+1}$。我们使用标准文献（例如，Hundsdorfer  Verwer 的《Numerical Solution of Time-Dependent Advection-Diffusion-Reaction Equations》）中提出的公式。\n\n**子步 1：梯形法则 (TR)**\nTR A-稳定格式应用于区间 $[t_n, t_n + \\gamma h]$：\n$$\n\\frac{y_{n+\\gamma} - y_n}{\\gamma h} = \\frac{1}{2} (\\lambda y_n + \\lambda y_{n+\\gamma})\n$$\n整理并代入 $z = h\\lambda$：\n$$\ny_{n+\\gamma} - y_n = \\frac{\\gamma z}{2} (y_n + y_{n+\\gamma})\n$$\n$$\ny_{n+\\gamma} \\left(1 - \\frac{\\gamma z}{2}\\right) = y_n \\left(1 + \\frac{\\gamma z}{2}\\right)\n$$\n这给出了用前一个解表示的中间解：\n$$\ny_{n+\\gamma} = \\frac{1 + \\gamma z/2}{1 - \\gamma z/2} y_n\n$$\n\n**子步 2：2阶向后差分格式 (BDF2)**\n第二个子步使用三个时间层 $t_n$、$t_n+\\gamma h$ 和 $t_n+h$ 来推进求解。可变步长 BDF2 方法的单腿公式为：\n$$\ny_{n+1} = \\frac{1}{\\gamma(2-\\gamma)}y_{n+\\gamma} - \\frac{(1-\\gamma)^2}{\\gamma(2-\\gamma)}y_n + \\frac{h(1-\\gamma)}{2-\\gamma} f(y_{n+1})\n$$\n对于检验方程 $f(y_{n+1}) = \\lambda y_{n+1}$，这变为：\n$$\ny_{n+1} = \\frac{1}{\\gamma(2-\\gamma)}y_{n+\\gamma} - \\frac{(1-\\gamma)^2}{\\gamma(2-\\gamma)}y_n + \\frac{z(1-\\gamma)}{2-\\gamma}y_{n+1}\n$$\n合并 $y_{n+1}$ 的项：\n$$\ny_{n+1}\\left(1 - \\frac{z(1-\\gamma)}{2-\\gamma}\\right) = \\frac{1}{\\gamma(2-\\gamma)}\\left(y_{n+\\gamma} - (1-\\gamma)^2 y_n\\right)\n$$\n$$\ny_{n+1}\\left(\\frac{2-\\gamma - z(1-\\gamma)}{2-\\gamma}\\right) = \\frac{1}{\\gamma(2-\\gamma)}\\left(y_{n+\\gamma} - (1-\\gamma)^2 y_n\\right)\n$$\n现在，我们从 TR 步代入 $y_{n+\\gamma}$ 的表达式：\n$$\ny_{n+1}\\left(\\frac{2-\\gamma - z(1-\\gamma)}{2-\\gamma}\\right) = \\frac{1}{\\gamma(2-\\gamma)}\\left(\\frac{1 + \\gamma z/2}{1 - \\gamma z/2} y_n - (1-\\gamma)^2 y_n\\right)\n$$\n提取 $y_n$ 并合并右侧的项：\n$$\ny_{n+1}\\left(\\dots\\right) = \\frac{y_n}{\\gamma(2-\\gamma)(1-\\gamma z/2)} \\left[ (1 + \\gamma z/2) - (1-\\gamma)^2(1 - \\gamma z/2) \\right]\n$$\n方括号中的项简化为：\n$$\n1 + \\frac{\\gamma z}{2} - (1-2\\gamma+\\gamma^2) + (1-2\\gamma+\\gamma^2)\\frac{\\gamma z}{2} = (2\\gamma - \\gamma^2) + \\frac{\\gamma z}{2}(2-2\\gamma+\\gamma^2)\n$$\n将其代回并简化 $y_{n+1}$ 的方程：\n$$\ny_{n+1}\\left(\\frac{2-\\gamma - z(1-\\gamma)}{2-\\gamma}\\right) = \\frac{y_n}{\\gamma(2-\\gamma)(1-\\gamma z/2)} \\left[ \\gamma(2-\\gamma) + \\frac{\\gamma z}{2}(2-2\\gamma+\\gamma^2) \\right]\n$$\n$$\ny_{n+1}\\left(\\frac{2-\\gamma - z(1-\\gamma)}{2-\\gamma}\\right) = \\frac{y_n}{(2-\\gamma)(1-\\gamma z/2)} \\left[ (2-\\gamma) + \\frac{z}{2}(2-2\\gamma+\\gamma^2) \\right]\n$$\n因此，稳定性函数 $R(z) = y_{n+1}/y_n$ 是：\n$$\nR(z) = \\frac{2-\\gamma}{2-\\gamma - (1-\\gamma)z} \\cdot \\frac{(2-\\gamma) + \\frac{1}{2}(2-2\\gamma+\\gamma^2)z}{(2-\\gamma)(1-\\gamma z/2)}\n$$\n$$\nR(z) = \\frac{(2-\\gamma) + \\frac{1}{2}(2-2\\gamma+\\gamma^2)z}{\\left(2-\\gamma - (1-\\gamma)z\\right)\\left(1-\\frac{\\gamma}{2}z\\right)}\n$$\n\n**2. L-稳定性的证明**\n\n如果一个方法是 A-稳定的，并且其稳定性函数对于实数 $z$ 满足 $\\lim_{z \\to -\\infty} R(z) = 0$，则该方法是 L-稳定的。为了证明 L-稳定性，我们为推导出的 $R(z)$ 计算这个极限。对于 $z \\in \\mathbb{R}$ 和 $z \\to -\\infty$，分子和分母中 $z$ 的最高次幂决定了极限。\n分子是关于 $z$ 的1次多项式：$P_1(z) = \\frac{1}{2}(2-2\\gamma+\\gamma^2)z + (2-\\gamma)$。\n分母是关于 $z$ 的2次多项式：$P_2(z) = \\left(-(1-\\gamma)z + (2-\\gamma)\\right)\\left(-\\frac{\\gamma}{2}z+1\\right) = \\frac{\\gamma(1-\\gamma)}{2}z^2 + \\dots$。\n极限是 $z$ 的最高次幂系数之比：\n$$\n\\lim_{z \\to -\\infty} R(z) = \\lim_{z \\to -\\infty} \\frac{\\frac{1}{2}(2-2\\gamma+\\gamma^2)z}{\\frac{\\gamma(1-\\gamma)}{2}z^2} = \\lim_{z \\to -\\infty} \\frac{2-2\\gamma+\\gamma^2}{\\gamma(1-\\gamma)z}\n$$\n参数 $\\gamma$ 在开区间 $(0,1)$ 内，所以 $\\gamma > 0$ 且 $1-\\gamma > 0$。因此，分母项 $\\gamma(1-\\gamma)$ 严格为正。\n分子项 $2-2\\gamma+\\gamma^2 = (1-\\gamma)^2 + 1$ 对任何实数 $\\gamma$ 也严格为正。\n因此，极限的形式为 $\\lim_{z \\to -\\infty} \\frac{C}{z}$，其中 $C = \\frac{2-2\\gamma+\\gamma^2}{\\gamma(1-\\gamma)} > 0$。该极限为 $0$。\n由于 $\\lim_{z \\to -\\infty} R(z) = 0$，对于任何 $\\gamma \\in (0,1)$ 的选择，TR-BDF2 方法都是 L-稳定的。此性质确保了高频模态（对应于具有大负实部的特征值）被强力阻尼，这对于求解刚性问题至关重要。\n\n### 第2部分：数值实现与比较\n\n数值任务是在一个刚性半离散扩散问题上，比较 L-稳定的 TR-BDF2 方法与仅为 A-稳定的 Crank-Nicolson (CN) 方法。\n\n**1. 扩散偏微分方程的半离散化**\n一维扩散方程为 $u_t = \\nu u_{xx}$，定义在 $x \\in (0,1)$ 上，边界条件为 $u(0,t)=1$，$u(1,t)=0$，初始条件为 $u(x,0)=0$。\n我们使用一个具有 $N$ 个内部点 $x_i = i\\Delta x$（$i=1, \\dots, N$）的均匀网格，其中 $\\Delta x = 1/(N+1)$。未知数的状态向量为 $y(t) = [u_1(t), \\dots, u_N(t)]^T$，其中 $u_i(t) \\approx u(x_i, t)$。\n在 $x_i$ 处的二阶空间导数 $u_{xx}$ 使用二阶中心差分进行近似：\n$$\nu_{xx}(x_i, t) \\approx \\frac{u_{i-1}(t) - 2u_i(t) + u_{i+1}(t)}{\\Delta x^2}\n$$\n这产生了一个包含 $N$ 个耦合常微分方程 (ODEs) 的系统，$y'(t) = Ay(t) + b$：\n$$\n\\frac{du_i}{dt} = \\frac{\\nu}{\\Delta x^2} (u_{i-1} - 2u_i + u_{i+1})\n$$\n矩阵 $A$ 是缩放后的离散拉普拉斯算子，一个 $N \\times N$ 的三对角矩阵：\n$$\nA = \\frac{\\nu}{\\Delta x^2} \\begin{pmatrix} -2  1   \\\\ 1  -2  1  \\\\  \\ddots  \\ddots  \\ddots \\\\   1  -2  1 \\\\    1  -2 \\end{pmatrix}\n$$\n向量 $b$ 包含了非齐次狄利克雷边界条件：\n$$\nb = \\frac{\\nu}{\\Delta x^2} [u_0, 0, \\dots, 0, u_{N+1}]^T = \\frac{\\nu}{\\Delta x^2} [1, 0, \\dots, 0]^T\n$$\n其中 $u_0 = u(0,t) = 1$ 且 $u_{N+1} = u(1,t) = 0$。\n\n**2. 时间积分格式**\n对于一般线性系统 $y' = Ay+b$，隐式格式需要在每个时间步求解一个线性系统。\n\n**Crank-Nicolson (CN):**\n$$\n\\frac{y_{n+1} - y_n}{h} = \\frac{1}{2}\\left((Ay_n + b) + (Ay_{n+1} + b)\\right)\n$$\n整理后得到关于 $y_{n+1}$ 的线性系统：\n$$\n\\left(I - \\frac{h}{2}A\\right) y_{n+1} = \\left(I + \\frac{h}{2}A\\right) y_n + h b\n$$\n\n**TR-BDF2 (参数 $\\gamma = 1 - 1/\\sqrt{2}$):**\n**子步 1 (TR):**\n$$\n\\left(I - \\frac{\\gamma h}{2}A\\right) y_{n+\\gamma} = \\left(I + \\frac{\\gamma h}{2}A\\right) y_n + \\gamma h b\n$$\n**子步 2 (BDF2):**\n$$\n\\left(I - \\frac{h(1-\\gamma)}{2-\\gamma}A\\right) y_{n+1} = \\frac{1}{\\gamma(2-\\gamma)}y_{n+\\gamma} - \\frac{(1-\\gamma)^2}{\\gamma(2-\\gamma)}y_n + \\frac{h(1-\\gamma)}{2-\\gamma}b\n$$\n对于这两种方法，左侧的矩阵在整个模拟过程中是恒定的，因此只需执行一次 LU 分解，以便在每个步骤中进行高效的回代。\n\n**3. 过冲量化**\n物理上可接受的解是有界的：$u(x,t) \\in [0,1]$。数值解可能会违反这些边界，这种效应称为过冲（对于 $u_i > 1$）或下冲（对于 $u_i  0$）。一次模拟的全局过冲幅度是在所有时间步和所有网格点上观察到的最大违反量。对于在步骤 $n$ 计算出的内部解 $y_n$，过冲计算为 $\\max(\\max(y_n) - 1, -\\min(y_n), 0)$。程序会为两种方法计算此值，并计算其减少量 $\\mathrm{Overshoot}_{\\text{CN}} - \\mathrm{Overshoot}_{\\text{TR-BDF2}}$，该值预期为正，并随问题刚性（由参数 $\\alpha$ 控制）的增加而增加。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve_diffusion_system(N, nu, alpha, M, method):\n    \"\"\"\n    Solves the semi-discretized 1D diffusion equation using a specified time\n    integration method and calculates the global overshoot magnitude.\n\n    Args:\n        N (int): Number of interior spatial points.\n        nu (float): Diffusivity constant.\n        alpha (float): Timestep parameter (Courant-like number).\n        M (int): Number of time steps.\n        method (str): Time integration method, 'CN' or 'TR-BDF2'.\n\n    Returns:\n        float: The global overshoot magnitude over the simulation.\n    \"\"\"\n    # 1. Setup grid, time step, matrix A, and vector b\n    dx = 1.0 / (N + 1)\n    h = alpha * dx**2 / nu\n    \n    # Construct the discrete Laplacian matrix A\n    scale = nu / dx**2\n    diag = np.full(N, -2.0)\n    off_diag = np.full(N - 1, 1.0)\n    A = scale * (np.diag(diag) + np.diag(off_diag, k=1) + np.diag(off_diag, k=-1))\n    \n    # Construct the boundary condition vector b\n    b = np.zeros(N)\n    b[0] = scale\n\n    # Initial condition y(0) = 0 for all interior points\n    y = np.zeros(N)\n    \n    global_overshoot = 0.0\n\n    if method == 'CN':\n        # 2a. Setup for Crank-Nicolson method\n        LHS_mat = np.identity(N) - (h / 2.0) * A\n        RHS_mat = np.identity(N) + (h / 2.0) * A\n        lu_piv = linalg.lu_factor(LHS_mat)\n\n        for _ in range(M):\n            RHS_vec = RHS_mat @ y + h * b\n            y = linalg.lu_solve(lu_piv, RHS_vec)\n            \n            # Calculate and update the global overshoot\n            current_overshoot = max(np.max(y) - 1.0, -np.min(y), 0.0)\n            if current_overshoot > global_overshoot:\n                global_overshoot = current_overshoot\n\n    elif method == 'TR-BDF2':\n        # 2b. Setup for TR-BDF2 method\n        gamma = 1.0 - 1.0 / np.sqrt(2.0)\n        \n        # Pre-factorize matrices for both substeps\n        LHS_TR = np.identity(N) - (gamma * h / 2.0) * A\n        lu_piv_tr = linalg.lu_factor(LHS_TR)\n        RHS_TR_mat = np.identity(N) + (gamma * h / 2.0) * A\n        \n        c1 = h * (1.0 - gamma) / (2.0 - gamma)\n        LHS_BDF2 = np.identity(N) - c1 * A\n        lu_piv_bdf2 = linalg.lu_factor(LHS_BDF2)\n        \n        y_prev = y.copy()\n        \n        for _ in range(M):\n            # TR substep to find y_intermediate\n            RHS_vec_TR = RHS_TR_mat @ y_prev + gamma * h * b\n            y_intermediate = linalg.lu_solve(lu_piv_tr, RHS_vec_TR)\n            \n            # BDF2 substep to find y\n            c2 = 1.0 / ((2.0 - gamma) * gamma)\n            c3 = (1.0 - gamma)**2 / ((2.0 - gamma) * gamma)\n            RHS_vec_BDF2 = c2 * y_intermediate - c3 * y_prev + c1 * b\n            y = linalg.lu_solve(lu_piv_bdf2, RHS_vec_BDF2)\n            \n            # Calculate and update the global overshoot\n            current_overshoot = max(np.max(y) - 1.0, -np.min(y), 0.0)\n            if current_overshoot > global_overshoot:\n                global_overshoot = current_overshoot\n            \n            y_prev = y.copy()\n\n    return global_overshoot\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test cases: (N, nu, alpha, M)\n    test_cases = [\n        (64, 1.0, 5.0, 20),\n        (64, 1.0, 50.0, 20),\n        (64, 1.0, 200.0, 20),\n    ]\n\n    results = []\n    for N, nu, alpha, M in test_cases:\n        overshoot_cn = solve_diffusion_system(N, nu, alpha, M, 'CN')\n        overshoot_trbdf2 = solve_diffusion_system(N, nu, alpha, M, 'TR-BDF2')\n        reduction = overshoot_cn - overshoot_trbdf2\n        results.append(reduction)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}