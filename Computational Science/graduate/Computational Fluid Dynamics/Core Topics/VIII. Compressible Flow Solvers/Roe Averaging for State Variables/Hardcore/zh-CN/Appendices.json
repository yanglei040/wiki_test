{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握 Roe 平均，仅仅记住其公式是不够的，理解其内在属性至关重要。本练习旨在通过理论推导，深入探究 Roe 平均声速与简单算术平均声速之间的关系，从而揭示该格式内蕴的数值耗散特性。通过完成这项练习 ，您将能更深刻地理解 Roe 平均为何能有效稳定地捕捉激波，并认识到其设计背后的物理考量。",
            "id": "3359628",
            "problem": "考虑一种一维、无粘的量热完全气体流动，其比热比 $\\gamma  1$ 为常数，该流动由守恒形式的可压缩欧拉方程建模，状态向量为 $\\boldsymbol{U} = (\\rho, \\rho u, E)^{\\mathsf{T}}$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是单位体积的总能量。热力学封闭关系由 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$ 给出，其中 $p$ 是压力。比总焓为 $H = \\dfrac{E + p}{\\rho} = h + \\tfrac{1}{2}u^{2}$，其中 $h$ 是热力学焓。对于量热完全气体，声速满足 $a^{2} = \\gamma p / \\rho$，并且 $h = \\dfrac{a^{2}}{\\gamma - 1}$。\n\n令 $\\boldsymbol{U}_{L}$ 和 $\\boldsymbol{U}_{R}$ 表示一个黎曼问题的左右状态。Roe 线性化旨在寻找一个常数雅可比矩阵 $\\boldsymbol{A}(\\tilde{\\boldsymbol{U}})$，该矩阵在一个适当平均的状态 $\\tilde{\\boldsymbol{U}}$ 下求值，使得精确通量差满足 $\\boldsymbol{F}(\\boldsymbol{U}_{R}) - \\boldsymbol{F}(\\boldsymbol{U}_{L}) = \\boldsymbol{A}(\\tilde{\\boldsymbol{U}})\\big(\\boldsymbol{U}_{R} - \\boldsymbol{U}_{L}\\big)$，并且 $\\boldsymbol{A}(\\tilde{\\boldsymbol{U}})$ 具有物理系统的特征结构。\n\n从这些基础出发，推导 Roe 平均原始变量在何种条件下退化为特定变量的算术平均值。然后，专门考虑质量密度相等的情况，即 $\\rho_{L} = \\rho_{R} = \\rho$，但 $u_{L}$、$u_{R}$、$p_{L}$ 和 $p_{R}$ 是任意的。仅使用上述物理定律和定义，推导 Roe 平均声速与左右声速的算术平均值之差的封闭形式表达式：\n$$\n\\Delta a \\equiv \\tilde{a} - \\frac{a_{L} + a_{R}}{2},\n$$\n该表达式用 $\\gamma$、$u_{L}$、$u_{R}$、$a_{L}$ 和 $a_{R}$ 表示。在您的推导中，讨论 $\\rho_{L} = \\rho_{R}$ 的等式对 Roe 平均速度和焓的影响，并定性解释您得到的 $\\Delta a$ 结果如何影响与 Roe 型通量中声波相关的迎风耗散的大小。\n\n提供 $\\Delta a$ 的最终封闭形式表达式。您可以保留所有量为符号形式；无需进行数值代入。如果进行数值计算，速度以米/秒表示。",
            "solution": "所述问题具有科学依据，是适定且客观的。它基于可压缩欧拉方程的标准公式以及计算流体力学中 Roe 近似黎曼求解器的既定原理。定义是正确的，目标是基于这些原理进行形式推导。因此，该问题是有效的，并将提供解答。\n\nRoe 线性化的基础在于找到一个平均状态 $\\tilde{\\boldsymbol{U}}$，使得通量差性质 $\\Delta \\boldsymbol{F} = \\boldsymbol{A}(\\tilde{\\boldsymbol{U}}) \\Delta \\boldsymbol{U}$ 得以满足，其中 $\\Delta(\\cdot) = (\\cdot)_R - (\\cdot)_L$。对于量热完全气体的一维欧拉方程，这可以通过定义以下 Roe 平均量来实现：\n$$\n\\tilde{\\rho} = \\sqrt{\\rho_{L} \\rho_{R}}\n$$\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_{L}} u_{L} + \\sqrt{\\rho_{R}} u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_{L}} H_{L} + \\sqrt{\\rho_{R}} H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}}\n$$\n这里，$\\tilde{\\rho}$、$\\tilde{u}$ 和 $\\tilde{H}$（比总焓）是基本的平均量。所有其他平均变量，例如平均声速 $\\tilde{a}$，都是从这些量导出的。\n\n问题的第一部分要求说明特定 Roe 平均变量在何种条件下退化为算术平均值。通过检查 $\\tilde{u}$ 和 $\\tilde{H}$ 的公式，我们可以看到它们是权重为 $\\sqrt{\\rho_{L}}$ 和 $\\sqrt{\\rho_{R}}$ 的加权平均。这些加权平均成为简单的算术平均，当且仅当权重相等。这发生在 $\\sqrt{\\rho_{L}} = \\sqrt{\\rho_{R}}$ 时，这等价于条件 $\\rho_{L} = \\rho_{R}$。因此，对于跨间断的恒定密度，Roe 平均速度和比总焓就是它们各自左右状态值的简单算术平均。注意，Roe 平均密度 $\\tilde{\\rho} = \\sqrt{\\rho_{L}\\rho_{R}}$ 成为一个几何平均。\n\n我们现在专门考虑问题中规定的情况：$\\rho_{L} = \\rho_{R} = \\rho$。正如刚刚确定的，这个条件对 Roe 平均速度和焓有直接影响。\nRoe 平均密度变为：\n$$\n\\tilde{\\rho} = \\sqrt{\\rho \\cdot \\rho} = \\rho\n$$\nRoe 平均速度变为算术平均：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho} u_{L} + \\sqrt{\\rho} u_{R}}{\\sqrt{\\rho} + \\sqrt{\\rho}} = \\frac{u_{L} + u_{R}}{2}\n$$\nRoe 平均比总焓也变为算术平均：\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho} H_{L} + \\sqrt{\\rho} H_{R}}{\\sqrt{\\rho} + \\sqrt{\\rho}} = \\frac{H_{L} + H_{R}}{2}\n$$\n\nRoe 平均声速 $\\tilde{a}$ 是通过平均状态变量定义的，与气体的热力学关系一致。具体来说，它由下式给出：\n$$\n\\tilde{a}^{2} = (\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^{2}\\right)\n$$\n在恒定密度情况下，代入 $\\tilde{u}$ 和 $\\tilde{H}$ 的表达式：\n$$\n\\tilde{a}^{2} = (\\gamma - 1)\\left(\\frac{H_{L} + H_{R}}{2} - \\frac{1}{2}\\left(\\frac{u_{L} + u_{R}}{2}\\right)^{2}\\right)\n$$\n我们现在必须用给定的变量 $a_{L}, a_{R}, u_{L}, u_{R}$ 来表示 $H_{L}$ 和 $H_{R}$。比总焓 $H$ 通过 $H = h + \\frac{1}{2}u^{2}$ 和 $h = \\frac{a^{2}}{\\gamma-1}$ 与声速 $a$ 和速度 $u$ 相关。因此：\n$$\nH = \\frac{a^{2}}{\\gamma-1} + \\frac{1}{2}u^{2}\n$$\n将此应用于左右状态：\n$$\nH_{L} = \\frac{a_{L}^{2}}{\\gamma-1} + \\frac{1}{2}u_{L}^{2} \\quad \\text{和} \\quad H_{R} = \\frac{a_{R}^{2}}{\\gamma-1} + \\frac{1}{2}u_{R}^{2}\n$$\n将这些代入我们关于 $\\tilde{a}^{2}$ 的方程：\n$$\n\\tilde{a}^{2} = (\\gamma - 1)\\left[ \\frac{1}{2}\\left(\\left(\\frac{a_{L}^{2}}{\\gamma-1} + \\frac{1}{2}u_{L}^{2}\\right) + \\left(\\frac{a_{R}^{2}}{\\gamma-1} + \\frac{1}{2}u_{R}^{2}\\right)\\right) - \\frac{1}{8}(u_{L} + u_{R})^{2} \\right]\n$$\n现在，我们简化表达式。\n$$\n\\tilde{a}^{2} = (\\gamma - 1)\\left[ \\frac{a_{L}^{2} + a_{R}^{2}}{2(\\gamma - 1)} + \\frac{u_{L}^{2} + u_{R}^{2}}{4} - \\frac{u_{L}^{2} + 2u_{L}u_{R} + u_{R}^{2}}{8} \\right]\n$$\n将 $(\\gamma-1)$ 项分配给括号中的第一项，并合并速度项：\n$$\n\\tilde{a}^{2} = \\frac{a_{L}^{2} + a_{R}^{2}}{2} + (\\gamma - 1)\\left[ \\frac{2(u_{L}^{2} + u_{R}^{2}) - (u_{L}^{2} + 2u_{L}u_{R} + u_{R}^{2})}{8} \\right]\n$$\n分子中的项简化为：\n$$\n2u_{L}^{2} + 2u_{R}^{2} - u_{L}^{2} - 2u_{L}u_{R} - u_{R}^{2} = u_{L}^{2} - 2u_{L}u_{R} + u_{R}^{2} = (u_{L} - u_{R})^{2}\n$$\n这给出了 Roe 平均声速平方的最终表达式：\n$$\n\\tilde{a}^{2} = \\frac{a_{L}^{2} + a_{R}^{2}}{2} + \\frac{\\gamma - 1}{8}(u_{L} - u_{R})^{2}\n$$\n问题要求推导 $\\Delta a = \\tilde{a} - \\frac{a_{L} + a_{R}}{2}$。对上述 $\\tilde{a}^2$ 的表达式取平方根，得到 $\\tilde{a}$：\n$$\n\\tilde{a} = \\sqrt{\\frac{a_{L}^{2} + a_{R}^{2}}{2} + \\frac{\\gamma - 1}{8}(u_{L} - u_{R})^{2}}\n$$\n因此，差值 $\\Delta a$ 为：\n$$\n\\Delta a = \\sqrt{\\frac{a_{L}^{2} + a_{R}^{2}}{2} + \\frac{\\gamma - 1}{8}(u_{L} - u_{R})^{2}} - \\frac{a_{L} + a_{R}}{2}\n$$\n\n对于定性讨论，我们分析 $\\Delta a$ 的符号。考虑恒等式 $\\frac{a_{L}^{2} + a_{R}^{2}}{2} = \\left(\\frac{a_{L} + a_{R}}{2}\\right)^{2} + \\left(\\frac{a_{L} - a_{R}}{2}\\right)^{2}$。将其代入 $\\tilde{a}^{2}$ 的表达式：\n$$\n\\tilde{a}^{2} = \\left(\\frac{a_{L} + a_{R}}{2}\\right)^{2} + \\left(\\frac{a_{L} - a_{R}}{2}\\right)^{2} + \\frac{\\gamma - 1}{8}(u_{L} - u_{R})^{2}\n$$\n由于实数的平方是非负的，且 $\\gamma  1$，所以右侧的所有三项都是非负的。这直接意味着 $\\tilde{a}^{2} \\geq \\left(\\frac{a_{L} + a_{R}}{2}\\right)^{2}$，并且由于声速是非负的，所以 $\\tilde{a} \\geq \\frac{a_{L} + a_{R}}{2}$。因此，$\\Delta a \\geq 0$。Roe 平均声速总是大于或等于左右声速的算术平均值。等号成立（$\\Delta a = 0$）的条件是当且仅当 $a_{L} = a_{R}$ 且 $u_{L} = u_{R}$，在给定 $\\rho_{L}=\\rho_{R}$ 的情况下，这意味着左右状态是相同的。\n\nRoe 型通量中数值耗散的大小与 Roe 矩阵 $\\boldsymbol{A}(\\tilde{\\boldsymbol{U}})$ 的特征值的模成正比。对应于声波的特征值是 $\\tilde{\\lambda}_{1,3} = \\tilde{u} \\pm \\tilde{a}$。$\\Delta a \\geq 0$ 的结果表明，Roe 平均过程产生的声速 $\\tilde{a}$ 通常比简单的算术平均值要高估。这个较大的 $\\tilde{a}$ 值增加了声波特征值 $|\\tilde{u} \\pm \\tilde{a}|$ 的模。因此，与声波相关的迎风耗散增加了。这种效应是由左右状态之间的压力（反映在 $a_{L,R}$ 中）和速度的差异驱动的。对于具有大速度差（剪切层）但密度恒定的间断，这会引入过多的数值粘性，导致对此类特征的涂抹超出物理上合理的范围。",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{a_{L}^{2} + a_{R}^{2}}{2} + \\frac{\\gamma - 1}{8}(u_{L} - u_{R})^{2}} - \\frac{a_{L} + a_{R}}{2}}\n$$"
        },
        {
            "introduction": "Roe 平均状态量并非纯粹的理论构建，它们在计算流体动力学（CFD）模拟中具有直接的实际应用。本练习将理论与实践相结合，展示了如何运用 Roe 平均得到的波速来确定显式时间推进格式的稳定性极限，即 Courant-Friedrichs-Lewy (CFL) 条件。通过求解这个问题 ，您将亲身体会到平均状态的计算结果如何直接影响数值模拟的稳定性和计算效率。",
            "id": "3359591",
            "problem": "考虑具有恒定比热比 $\\gamma$ 的量热完全理想气体的一维可压缩欧拉方程。一种使用 Roe 近似黎曼求解器的显式有限体积法，在 Courant-Friedrichs-Lewy (CFL) 约束下，随时间推进守恒变量。在间距为 $\\Delta x$ 的均匀网格的某个特定单元交界面处，左、右原始状态（密度 $\\rho$、速度 $u$ 和压力 $p$）为\n- 左侧状态：$\\rho_{L} = 1.2$ kg/m$^{3}$， $u_{L} = 50$ m/s， $p_{L} = 101325$ Pa，\n- 右侧状态：$\\rho_{R} = 0.8$ kg/m$^{3}$， $u_{R} = -30$ m/s， $p_{R} = 80000$ Pa。\n\n假设 $\\gamma = 1.4$，并且时间步长受此交界面限制。选择的 Courant 数为 $0.7$，网格间距为 $\\Delta x = 1.0 \\times 10^{-2}$ m。使用根据这些左、右状态构造的 Roe 线性化以及显式方法的 Courant-Friedrichs-Lewy (CFL) 稳定性要求，确定最大稳定时间步长 $\\Delta t_{\\max}$。\n\n以秒为单位表示您的最终答案，并将结果四舍五入到四位有效数字。",
            "solution": "该问题要求确定使用 Roe 近似黎曼求解器的显式有限体积格式的最大稳定时间步长 $\\Delta t_{\\max}$。此类格式的稳定性由 Courant-Friedrichs-Lewy (CFL) 条件控制。对于一维欧拉方程，CFL 条件指出，数值依赖域必须包含物理依赖域。这表示为：\n$$ C = \\frac{\\Delta t}{\\Delta x} S_{\\max} \\le C_{\\max} $$\n其中 $C$ 是 Courant 数，$\\Delta t$ 是时间步长，$\\Delta x$ 是网格间距，而 $S_{\\max}$ 是交界面处的最大信号速度（最快特征波的幅值）。问题指定了 Courant 数 $C = 0.7$。为了求得最大稳定时间步长，我们求解 $\\Delta t$：\n$$ \\Delta t_{\\max} = C \\frac{\\Delta x}{S_{\\max}} $$\n对于 Roe 求解器，最大信号速度 $S_{\\max}$ 由 Roe 平均雅可比矩阵 $\\tilde{A}$ 的特征值确定。对于一维欧拉方程，$\\tilde{A}$ 的特征值为 $\\tilde{u}$、$\\tilde{u} + \\tilde{a}$ 和 $\\tilde{u} - \\tilde{a}$，其中 $\\tilde{u}$ 是 Roe 平均速度，$\\tilde{a}$ 是 Roe 平均声速。这些特征值的最大幅值是矩阵的谱半径，由下式给出：\n$$ S_{\\max} = \\max(|\\tilde{u}|, |\\tilde{u} + \\tilde{a}|, |\\tilde{u} - \\tilde{a}|) = |\\tilde{u}| + \\tilde{a} $$\n因此，任务简化为根据给定的左 (L) 和右 (R) 状态计算 Roe 平均量 $\\tilde{u}$ 和 $\\tilde{a}$。\n\n提供的原始变量为：\n- 左侧状态：$\\rho_{L} = 1.2$ kg/m$^3$, $u_{L} = 50$ m/s, $p_{L} = 101325$ Pa.\n- 右侧状态：$\\rho_{R} = 0.8$ kg/m$^3$, $u_{R} = -30$ m/s, $p_{R} = 80000$ Pa.\n比热比为 $\\gamma = 1.4$。网格间距为 $\\Delta x = 1.0 \\times 10^{-2}$ m。\n\n首先，我们定义并计算 Roe 平均速度 $\\tilde{u}$。其公式是基于密度平方根的加权平均：\n$$ \\tilde{u} = \\frac{\\sqrt{\\rho_{L}} u_{L} + \\sqrt{\\rho_{R}} u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} $$\n代入给定值：\n$$ \\tilde{u} = \\frac{\\sqrt{1.2} (50) + \\sqrt{0.8} (-30)}{\\sqrt{1.2} + \\sqrt{0.8}} \\approx \\frac{(1.095445)(50) + (0.894427)(-30)}{1.095445 + 0.894427} \\approx \\frac{54.77225 - 26.83281}{1.989872} \\approx 14.0408 \\text{ m/s} $$\n\n接下来，我们计算 Roe 平均声速 $\\tilde{a}$。这是从 Roe 平均比总焓 $\\tilde{H}$ 使用以下关系式推导得出的：\n$$ \\tilde{a}^2 = (\\gamma - 1) \\left( \\tilde{H} - \\frac{1}{2} \\tilde{u}^2 \\right) $$\nRoe 平均比总焓 $\\tilde{H}$ 的定义与 $\\tilde{u}$ 类似：\n$$ \\tilde{H} = \\frac{\\sqrt{\\rho_{L}} H_{L} + \\sqrt{\\rho_{R}} H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} $$\n其中 $H_L$ 和 $H_R$ 分别是左、右状态的比总焓。对于量热完全气体，比总焓 $H$ 由下式给出：\n$$ H = \\frac{\\gamma}{\\gamma-1} \\frac{p}{\\rho} + \\frac{1}{2} u^2 $$\n我们计算 $H_L$ 和 $H_R$：\n$$ H_L = \\frac{1.4}{1.4-1} \\frac{101325}{1.2} + \\frac{1}{2} (50)^2 = \\frac{1.4}{0.4} (84437.5) + \\frac{1}{2}(2500) = 295531.25 + 1250 = 296781.25 \\text{ J/kg} $$\n$$ H_R = \\frac{1.4}{1.4-1} \\frac{80000}{0.8} + \\frac{1}{2} (-30)^2 = \\frac{1.4}{0.4} (100000) + \\frac{1}{2}(900) = 350000 + 450 = 350450 \\text{ J/kg} $$\n现在，我们可以计算 $\\tilde{H}$：\n$$ \\tilde{H} = \\frac{\\sqrt{1.2} (296781.25) + \\sqrt{0.8} (350450)}{\\sqrt{1.2} + \\sqrt{0.8}} \\approx \\frac{(1.095445)(296781.25) + (0.894427)(350450)}{1.989872} \\approx \\frac{325102.39 + 313437.49}{1.989872} \\approx 320892.59 \\text{ J/kg} $$\n有了 $\\tilde{u}$ 和 $\\tilde{H}$，我们可以求得 $\\tilde{a}$：\n$$ \\tilde{a}^2 = (1.4 - 1) \\left( 320892.59 - \\frac{1}{2} (14.0408)^2 \\right) \\approx 0.4 \\left( 320892.59 - \\frac{1}{2} (197.144) \\right) = 0.4 (320892.59 - 98.572) = 0.4(320794.018) \\approx 128317.61 $$\n$$ \\tilde{a} = \\sqrt{128317.61} \\approx 358.2145 \\text{ m/s} $$\n交界面处的最大信号速度为：\n$$ S_{\\max} = |\\tilde{u}| + \\tilde{a} \\approx |14.0408| + 358.2145 = 372.2553 \\text{ m/s} $$\n最后，我们使用 CFL 条件计算最大稳定时间步长 $\\Delta t_{\\max}$：\n$$ \\Delta t_{\\max} = C \\frac{\\Delta x}{S_{\\max}} = 0.7 \\times \\frac{1.0 \\times 10^{-2}}{372.2553} \\approx \\frac{0.007}{372.2553} \\approx 1.88044 \\times 10^{-5} \\text{ s} $$\n按要求将结果四舍五入到四位有效数字：\n$$ \\Delta t_{\\max} \\approx 1.880 \\times 10^{-5} \\text{ s} $$",
            "answer": "$$\\boxed{1.880 \\times 10^{-5}}$$"
        },
        {
            "introduction": "从理论公式到稳健的数值实现，需要对细节有精确的把握。本编程练习为您提供了将 Roe 平均付诸实践的机会，并系统地量化分析多种潜在的误差来源。通过这个练习 ，您不仅能巩固对 Roe 平均公式的理解，还能通过对比算术平均、分析误用静焓与总焓的区别以及评估数值精度问题，全面掌握在实际编程中可能遇到的挑战。",
            "id": "3359619",
            "problem": "考虑计算流体动力学（CFD）中的一维可压缩欧拉方程，模拟比热比为 $\\gamma$ 的理想气体。守恒变量为质量密度 $\\rho$、动量密度 $\\rho u$ 和总能量密度 $E$。无粘通量 $\\mathbf{F}$ 以及原始变量 $u$ 和 $p$ 通过理想气体的标准热力学定义相互关联。比静焓 $h$ 和比总焓 $H$ 必须根据理想气体定律以及 $E$ 分解为内能和动能的原理，从第一性原理出发进行定义。Roe 线性化需要一个单一状态 $\\tilde{\\mathbf{U}}$，其关联的通量雅可比矩阵 $\\tilde{\\mathbf{A}}$ 通过一个线性映射将通量差精确地关联到状态差。必须利用这一要求来推导 Roe 平均速度和焓的表达式。您必须从欧拉方程、理想气体定义以及比总焓 $H$ 的定义出发进行推导，并最终得出可计算的 Roe 平均值表达式。\n\n您的任务是编写一个程序，对于每个给定的左、右状态 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$ 以及共同的 $\\gamma$，执行以下所有操作：\n- 推导并计算与线性化要求一致的 Roe 平均速度 $\\tilde{u}$ 和 Roe 平均比总焓 $\\tilde{H}$。\n- 分别根据 $(u_L,u_R)$ 和 $(H_L,H_R)$ 计算算术平均值 $\\bar{u}$ 和 $\\bar{H}$，其中 $H_L$ 和 $H_R$ 是根据左、右状态的 $(\\rho,u,p,\\gamma)$ 构建的物理上正确的比总焓。\n- 通过输出绝对差值 $|\\tilde{u}-\\bar{u}|$（单位：$\\mathrm{m/s}$）和 $|\\tilde{H}-\\bar{H}|$（单位：$\\mathrm{J/kg}$），来量化使用算术平均值替代 Roe 平均值所产生的误差。\n- 通过计算绝对差值 $|\\tilde{H}-\\tilde{h}|$（单位：$\\mathrm{J/kg}$），来量化在 Roe 焓平均中错误使用静焓 $h$（忽略动能贡献）所引入的误差，其中 $\\tilde{h}$ 是将相同的 Roe 平均过程应用于 $h$ 而非 $H$ 所得到的焓。\n- 通过对权重施加大小为 $\\varepsilon$ 的对称相对扰动，并报告对于 $\\varepsilon=10^{-12}$ 和 $\\varepsilon=10^{-8}$ 由此引起的绝对误差 $|\\tilde{u}-\\tilde{u}_\\varepsilon|$（单位：$\\mathrm{m/s}$），来估计 $\\tilde{u}$ 对密度权重中有限精度扰动的敏感性。通过将左权重缩放 $(1+\\varepsilon)$ 并将右权重缩放 $(1-\\varepsilon)$ 来使用最坏情况的对称扰动。\n\n所有速度以 $\\mathrm{m/s}$ 表示，所有焓以 $\\mathrm{J/kg}$ 表示。最终输出必须是浮点数。您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，每个测试用例对应一个包含五个浮点数的嵌套列表，顺序为 $[|\\tilde{u}-\\bar{u}|,|\\tilde{H}-\\bar{H}|,|\\tilde{H}-\\tilde{h}|,|\\tilde{u}-\\tilde{u}_{\\varepsilon=10^{-12}}|,|\\tilde{u}-\\tilde{u}_{\\varepsilon=10^{-8}}|]$。程序不得读取任何输入。\n\n使用以下科学上一致的测试套件以涵盖不同工况：\n- 测试 1（中等，亚音速到跨音速对比）：$(\\rho_L,u_L,p_L)=(1.0,200,1.0\\times 10^5)$，$(\\rho_R,u_R,p_R)=(0.8,220,0.9\\times 10^5)$，$\\gamma=1.4$。\n- 测试 2（强跳跃，类激波）：$(\\rho_L,u_L,p_L)=(1.0,800,1.0\\times 10^5)$，$(\\rho_R,u_R,p_R)=(5.0,200,5.0\\times 10^5)$，$\\gamma=1.4$。\n- 测试 3（右侧接近真空，经过仔细缩放以保持焓为有限值）：$(\\rho_L,u_L,p_L)=(1.225,50,1.0\\times 10^5)$，$(\\rho_R,u_R,p_R)=(1.0\\times 10^{-5},50,1.0)$，$\\gamma=1.4$。\n- 测试 4（相同状态，一致性检查）：$(\\rho_L,u_L,p_L)=(1.0,300,1.0\\times 10^5)$，$(\\rho_R,u_R,p_R)=(1.0,300,1.0\\times 10^5)$，$\\gamma=1.4$。\n- 测试 5（密度差异极大，压力经过缩放）：$(\\rho_L,u_L,p_L)=(1.0\\times 10^6,300,1.0\\times 10^9)$，$(\\rho_R,u_R,p_R)=(1.0\\times 10^{-6},300,1.0\\times 10^3)$，$\\gamma=1.4$。\n\n您的程序必须实现物理上正确的焓定义和从第一性原理推导出的与 Roe 线性化一致的平均值，然后计算所要求的误差度量。最终打印的输出必须是形如 $[[\\ldots],[\\ldots],\\ldots]$ 的单行，按上述顺序包含五个测试用例的五个浮点数列表。",
            "solution": "该问题要求推导一维欧拉方程的 Roe 平均速度和焓，并为给定的测试用例计算若干误差度量。对问题陈述的验证确认了其科学上合理、适定，并包含了所有必要信息。我们着手进行求解。\n\n一维可压缩欧拉方程的守恒形式由下式给出：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量矢量，$\\mathbf{F}$ 是通量矢量：\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad\n\\mathbf{F} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (E+p)u \\end{pmatrix}\n$$\n这里，$\\rho$ 是质量密度， $u$ 是流体速度， $p$ 是压力， $E$ 是单位体积的总能量。\n\n对于理想气体，压力 $p$ 和总能量 $E$ 通过状态方程相关联。总能量是内能 $\\rho e$ 和动能之和：\n$$\nE = \\rho e + \\frac{1}{2}\\rho u^2\n$$\n压力通过 $p = (\\gamma-1)\\rho e$ 与比内能 $e$ 相关，其中 $\\gamma$ 是比热比。由此，我们可以用守恒变量表示压力：\n$$\np = (\\gamma-1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\n理想气体的比静焓 $h$ 定义为 $h = e + p/\\rho$。代入 $e = p/((\\gamma-1)\\rho)$ 可得：\n$$\nh = \\frac{p}{(\\gamma-1)\\rho} + \\frac{p}{\\rho} = \\frac{\\gamma p}{(\\gamma-1)\\rho}\n$$\n比总焓 $H$ 定义为 $H = h + \\frac{1}{2}u^2$。通过代入 $E$ 和 $p$ 的定义，可以得到通量矢量的一个重要关系：\n$$\nH = \\frac{E+p}{\\rho}\n$$\n使用这个关系，通量矢量的第三个分量可以写为 $F_3 = (E+p)u = \\rho u H$。\n\nRoe 线性化方法的核心是找到一个平均状态 $\\tilde{\\mathbf{U}}$，使得左状态 $\\mathbf{U}_L$ 和右状态 $\\mathbf{U}_R$ 之间的通量差，能够通过在该平均状态下求值的雅可比矩阵 $\\mathbf{A}(\\mathbf{U}) = \\partial\\mathbf{F}/\\partial\\mathbf{U}$ 精确关联：\n$$\n\\Delta\\mathbf{F} = \\mathbf{F}_R - \\mathbf{F}_L = \\mathbf{A}(\\tilde{\\mathbf{U}}) (\\mathbf{U}_R - \\mathbf{U}_L) = \\tilde{\\mathbf{A}}\\Delta\\mathbf{U}\n$$\n这个性质必须精确成立。直接通过代数方法寻找这样一个平均状态是极其复杂的。一个更优雅和严谨的推导方法，如 Roe 和 Pike (1984) 最初所示，依赖于找到一个参数矢量 $\\mathbf{q}$，使得 $\\mathbf{U}$ 和 $\\mathbf{F}$ 都是其分量的齐次二次函数。\n\n让我们将参数矢量 $\\mathbf{q}$ 定义为：\n$$\n\\mathbf{q} = \\begin{pmatrix} q_1 \\\\ q_2 \\\\ q_3 \\end{pmatrix} = \\begin{pmatrix} \\sqrt{\\rho} \\\\ \\sqrt{\\rho}u \\\\ \\sqrt{\\rho}H \\end{pmatrix}\n$$\n我们现在可以用 $\\mathbf{q}$ 的分量来表示守恒变量 $\\mathbf{U}$：\n$U_1 = \\rho = q_1^2$\n$U_2 = \\rho u = q_1 q_2$\n为了表示 $U_3 = E$，我们使用关系式 $\\rho H = E+p = E+(\\gamma-1)(E - \\frac{1}{2}\\rho u^2) = \\gamma E - \\frac{\\gamma-1}{2}\\rho u^2$。整理得到 $E$ 的表达式为 $E = \\frac{1}{\\gamma}(\\rho H + \\frac{\\gamma-1}{2}\\rho u^2)$。代入 $\\mathbf{q}$ 参数可得：\n$$\nU_3 = E = \\frac{1}{\\gamma}\\left(q_1 q_3 + \\frac{\\gamma-1}{2}q_2^2\\right)\n$$\n通量矢量 $\\mathbf{F}$ 也可以用 $\\mathbf{q}$ 表示：\n$F_1 = \\rho u = q_1 q_2$\n$F_3 = \\rho u H = q_2 q_3$\n分量 $F_2 = \\rho u^2 + p = \\rho u^2 + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\rho u^2 = \\frac{3-\\gamma}{2}\\rho u^2 + (\\gamma-1)E$。代入用 $\\mathbf{q}$ 表示的 $\\rho u^2$ 和 $E$ 的表达式可得：\n$$\nF_2 = \\frac{3-\\gamma}{2}q_2^2 + (\\gamma-1)\\left[\\frac{1}{\\gamma}\\left(q_1 q_3 + \\frac{\\gamma-1}{2}q_2^2\\right)\\right] = \\frac{\\gamma-1}{\\gamma}q_1 q_3 + \\frac{\\gamma+1}{2\\gamma}q_2^2\n$$\n$\\mathbf{U}(\\mathbf{q})$ 和 $\\mathbf{F}(\\mathbf{q})$ 都是 $\\mathbf{q}$ 分量的齐次二次函数。对于任何此类函数 $f(\\mathbf{q})$，中值定理提供了精确的关系：\n$$\n\\Delta f = f(\\mathbf{q}_R) - f(\\mathbf{q}_L) = \\nabla_{\\mathbf{q}}f(\\bar{\\mathbf{q}}) \\cdot (\\mathbf{q}_R - \\mathbf{q}_L) = \\nabla_{\\mathbf{q}}f(\\bar{\\mathbf{q}}) \\cdot \\Delta\\mathbf{q}\n$$\n其中 $\\bar{\\mathbf{q}} = \\frac{1}{2}(\\mathbf{q}_L + \\mathbf{q}_R)$ 是算术平均值。将此应用于我们的矢量 $\\mathbf{U}$ 和 $\\mathbf{F}$：\n$$\n\\Delta\\mathbf{U} = \\left(\\frac{\\partial \\mathbf{U}}{\\partial \\mathbf{q}}\\right)_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q} \\equiv \\mathbf{B}_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q}\n$$\n$$\n\\Delta\\mathbf{F} = \\left(\\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{q}}\\right)_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q} \\equiv \\mathbf{J}_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q}\n$$\n从第一个方程，我们可以写出 $\\Delta\\mathbf{q} = \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1} \\Delta\\mathbf{U}$。将其代入第二个方程可得：\n$$\n\\Delta\\mathbf{F} = (\\mathbf{J}_{\\bar{\\mathbf{q}}} \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1}) \\Delta\\mathbf{U}\n$$\n这个构造给出了 Roe 矩阵 $\\tilde{\\mathbf{A}} = \\mathbf{J}_{\\bar{\\mathbf{q}}} \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1}$。性质 $\\tilde{\\mathbf{A}} = \\mathbf{A}(\\tilde{\\mathbf{U}})$ 要求 Roe 平均状态 $\\tilde{\\mathbf{U}}$ 对应于从平均参数矢量 $\\bar{\\mathbf{q}}$ 推导出的原始变量。具体来说，我们从 $\\bar{\\mathbf{q}}$ 的分量之比来确定 Roe 平均速度 $\\tilde{u}$ 和总焓 $\\tilde{H}$：\n$$\n\\tilde{u} = \\frac{\\bar{q}_2}{\\bar{q}_1} = \\frac{(\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R)/2}{(\\sqrt{\\rho_L} + \\sqrt{\\rho_R})/2} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\bar{q}_3}{\\bar{q}_1} = \\frac{(\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R)/2}{(\\sqrt{\\rho_L} + \\sqrt{\\rho_R})/2} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n这些就是从第一性原理推导出的 Roe 平均速度和比总焓的所需表达式。\n\n对于每个测试用例 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，计算任务如下：\n1.  使用 $h = \\frac{\\gamma p}{(\\gamma-1)\\rho}$ 和 $H = h + \\frac{1}{2}u^2$ 计算左、右状态的比静焓 $h_L, h_R$ 和比总焓 $H_L, H_R$。\n2.  使用推导出的公式计算 Roe 平均速度 $\\tilde{u}$ 和总焓 $\\tilde{H}$。\n3.  计算简单的算术平均值 $\\bar{u} = \\frac{1}{2}(u_L+u_R)$ 和 $\\bar{H} = \\frac{1}{2}(H_L+H_R)$。\n4.  计算 Roe 平均静焓 $\\tilde{h} = \\frac{\\sqrt{\\rho_L}h_L + \\sqrt{\\rho_R}h_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}$。\n5.  计算对于 $\\varepsilon \\in \\{10^{-12}, 10^{-8}\\}$ 的扰动 Roe 速度 $\\tilde{u}_{\\varepsilon}$。扰动权重为 $w_L' = \\sqrt{\\rho_L}(1+\\varepsilon)$ 和 $w_R' = \\sqrt{\\rho_R}(1-\\varepsilon)$，因此 $\\tilde{u}_{\\varepsilon} = \\frac{w_L' u_L + w_R' u_R}{w_L' + w_R'}$。\n6.  计算五个所需的绝对差值：\n    -   $|\\tilde{u} - \\bar{u}|$（单位：$\\mathrm{m/s}$）\n    -   $|\\tilde{H} - \\bar{H}|$（单位：$\\mathrm{J/kg}$）\n    -   $|\\tilde{H} - \\tilde{h}|$（单位：$\\mathrm{J/kg}$）\n    -   $|\\tilde{u} - \\tilde{u}_{\\varepsilon=10^{-12}}|$（单位：$\\mathrm{m/s}$）\n    -   $|\\tilde{u} - \\tilde{u}_{\\varepsilon=10^{-8}}|$（单位：$\\mathrm{m/s}$）\n\n这些计算将针对所提供的测试套件进行实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Roe averaging problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: ((rho_L, u_L, p_L), (rho_R, u_R, p_R), gamma)\n    test_cases = [\n        # Test 1: moderate contrast\n        ((1.0, 200.0, 1.0e5), (0.8, 220.0, 0.9e5), 1.4),\n        # Test 2: strong jump (shock-like)\n        ((1.0, 800.0, 1.0e5), (5.0, 200.0, 5.0e5), 1.4),\n        # Test 3: near-vacuum\n        ((1.225, 50.0, 1.0e5), (1.0e-5, 50.0, 1.0), 1.4),\n        # Test 4: identical states\n        ((1.0, 300.0, 1.0e5), (1.0, 300.0, 1.0e5), 1.4),\n        # Test 5: extremely disparate densities\n        ((1.0e6, 300.0, 1.0e9), (1.0e-6, 300.0, 1.0e3), 1.4),\n    ]\n\n    # Perturbation magnitudes\n    epsilons = [1e-12, 1e-8]\n    \n    results = []\n    for case in test_cases:\n        state_L, state_R, gamma = case\n        rho_L, u_L, p_L = state_L\n        rho_R, u_R, p_R = state_R\n\n        # --- Sub-problem 1: Calculate state-dependent enthalpies ---\n        \n        # Specific static enthalpy: h = (gamma * p) / ((gamma - 1) * rho)\n        h_L = (gamma * p_L) / ((gamma - 1.0) * rho_L)\n        h_R = (gamma * p_R) / ((gamma - 1.0) * rho_R)\n\n        # Specific total enthalpy: H = h + 0.5 * u^2\n        H_L = h_L + 0.5 * u_L**2\n        H_R = h_R + 0.5 * u_R**2\n\n        # --- Sub-problem 2: Compute Roe and arithmetic averages ---\n\n        # Weights for Roe averaging\n        sqrt_rho_L = np.sqrt(rho_L)\n        sqrt_rho_R = np.sqrt(rho_R)\n        \n        # Denominator for Roe averages\n        roe_denom = sqrt_rho_L + sqrt_rho_R\n\n        # Roe-averaged velocity: u_roe = (sqrt(rho_L)*u_L + sqrt(rho_R)*u_R) / (sqrt(rho_L)+sqrt(rho_R))\n        u_roe = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / roe_denom\n        \n        # Roe-averaged specific total enthalpy\n        H_roe = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / roe_denom\n\n        # Arithmetic average velocity\n        u_arith = 0.5 * (u_L + u_R)\n        \n        # Arithmetic average specific total enthalpy\n        H_arith = 0.5 * (H_L + H_R)\n\n        # --- Sub-problem 3: Compute errors ---\n        \n        # Error 1: Absolute difference between Roe and arithmetic average velocity\n        err_u_avg = np.abs(u_roe - u_arith)\n        \n        # Error 2: Absolute difference between Roe and arithmetic average total enthalpy\n        err_H_avg = np.abs(H_roe - H_arith)\n        \n        # For error 3, compute Roe-averaged static enthalpy\n        h_roe = (sqrt_rho_L * h_L + sqrt_rho_R * h_R) / roe_denom\n        \n        # Error 3: Absolute difference between Roe total and static enthalpy\n        # This quantifies the kinetic energy component at the Roe-averaged state.\n        err_H_h_roe = np.abs(H_roe - h_roe)\n        \n        # --- Sub-problem 4: Compute sensitivity to weight perturbations ---\n        \n        sensitivity_errors = []\n        for eps in epsilons:\n            # Perturbed weights\n            w_L_eps = sqrt_rho_L * (1.0 + eps)\n            w_R_eps = sqrt_rho_R * (1.0 - eps)\n            \n            # Perturbed Roe velocity\n            u_roe_eps = (w_L_eps * u_L + w_R_eps * u_R) / (w_L_eps + w_R_eps)\n            \n            # Error: Absolute difference between original and perturbed Roe velocity\n            err_u_sens = np.abs(u_roe - u_roe_eps)\n            sensitivity_errors.append(err_u_sens)\n\n        case_results = [\n            err_u_avg, \n            err_H_avg, \n            err_H_h_roe, \n            sensitivity_errors[0], \n            sensitivity_errors[1]\n        ]\n        results.append([f\"{val:.15g}\" for val in case_results])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(['[' + ','.join(res) + ']' for res in results])}]\")\n\nsolve()\n```"
        }
    ]
}