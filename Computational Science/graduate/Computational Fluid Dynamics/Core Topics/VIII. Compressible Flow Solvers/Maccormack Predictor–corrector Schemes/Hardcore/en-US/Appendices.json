{
    "hands_on_practices": [
        {
            "introduction": "A fundamental step in evaluating any finite difference scheme is to assess its stability and accuracy. The Von Neumann stability analysis provides a powerful framework for this, examining how the scheme amplifies or damps individual Fourier modes of the solution. By deriving the amplification factor for the MacCormack scheme applied to the linear advection equation , you will gain direct insight into its numerical dissipation and dispersion properties, which are key to understanding its performance.",
            "id": "3342546",
            "problem": "Consider the one-dimensional linear advection equation $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$ posed on a uniform periodic grid with spacing $\\Delta x$ and time step $\\Delta t$, where $a>0$ is a constant advection speed. Discretize $x$ by nodes $x_j = j \\Delta x$ and $t$ by levels $t^n = n \\Delta t$. The MacCormack predictor–corrector scheme is defined by the following two steps:\nPredictor: $u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$,\nCorrector: $u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$,\nwhere the Courant–Friedrichs–Lewy (CFL) number is $\\nu = \\frac{a \\Delta t}{\\Delta x}$.\n\nStarting from the advection equation and these discrete update formulas, perform a von Neumann stability analysis by assuming a Fourier mode $u_j^n = \\hat{u}^n \\exp(i j \\theta)$ and derive the amplification factor $G(\\theta;\\nu)$ for the MacCormack scheme. Then evaluate the amplification factor at $\\theta = \\frac{\\pi}{2}$ to determine its magnitude $|G|$ and phase $\\phi = \\arg(G)$ per time step. Assume $0<\\nu<1$ so that the principal value of the phase is well-defined without branch ambiguity. Assess whether this mode is damped or amplified and quantify the phase shift per time step in radians.\n\nProvide your final answer as the ordered pair $(|G|,\\phi)$ expressed in terms of $a$, $\\Delta x$, and $\\Delta t$, and give the phase in radians. No numerical rounding is required; provide a closed-form analytic expression.",
            "solution": "The problem statement is critically validated and determined to be valid. It is scientifically grounded in the principles of computational fluid dynamics, well-posed with a clear objective and sufficient data, and objective in its language. The task is to perform a standard von Neumann stability analysis for the MacCormack scheme applied to the linear advection equation.\n\nThe analysis begins by considering a single Fourier mode for the numerical solution $u_j^n$ at discrete time level $n$ and spatial node $j$:\n$$u_j^n = \\hat{u}^n \\exp(i j \\theta)$$\nwhere $\\hat{u}^n$ is the amplitude of the mode at time level $n$, $i = \\sqrt{-1}$ is the imaginary unit, and $\\theta = k \\Delta x$ is the dimensionless wave number, with $k$ being the physical wave number and $\\Delta x$ the spatial grid spacing. The amplification factor, $G$, is defined by the relation $\\hat{u}^{n+1} = G \\cdot \\hat{u}^n$. Our goal is to find the expression for $G(\\theta; \\nu)$.\n\nWe substitute the Fourier mode into the two steps of the MacCormack scheme.\n\nFirst, for the predictor step:\n$$u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$$\nSubstituting the Fourier mode yields:\n$$\\hat{u}^* \\exp(i j \\theta) = \\hat{u}^n \\exp(i j \\theta) - \\nu \\left(\\hat{u}^n \\exp(i (j+1) \\theta) - \\hat{u}^n \\exp(i j \\theta)\\right)$$\nDividing by $\\exp(i j \\theta)$:\n$$\\hat{u}^* = \\hat{u}^n - \\nu \\left(\\hat{u}^n \\exp(i \\theta) - \\hat{u}^n\\right)$$\n$$\\hat{u}^* = \\hat{u}^n \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right)$$\nThis gives the relation between the predicted amplitude $\\hat{u}^*$ and the initial amplitude $\\hat{u}^n$.\n\nNext, for the corrector step:\n$$u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$$\nWe substitute the corresponding Fourier modes for $u_j^{n+1}$, $u_j^n$, and the predicted values $u_j^*$ and $u_{j-1}^*$:\n$$\\hat{u}^{n+1} \\exp(i j \\theta) = \\frac{1}{2} \\left(\\hat{u}^n \\exp(i j \\theta) + \\hat{u}^* \\exp(i j \\theta) - \\nu \\left(\\hat{u}^* \\exp(i j \\theta) - \\hat{u}^* \\exp(i (j-1) \\theta)\\right)\\right)$$\nDividing by $\\exp(i j \\theta)$:\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* - \\nu \\left(\\hat{u}^* - \\hat{u}^* \\exp(-i \\theta)\\right)\\right)$$\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\nTo find the amplification factor $G = \\hat{u}^{n+1}/\\hat{u}^n$, we divide by $\\hat{u}^n$:\n$$G = \\frac{1}{2} \\left(1 + \\frac{\\hat{u}^*}{\\hat{u}^n} \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\nSubstituting the expression for $\\hat{u}^*/\\hat{u}^n$ from the predictor step:\n$$G = \\frac{1}{2} \\left(1 + \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right) \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\nExpanding the product term:\n$$(1 - \\nu (\\exp(i \\theta) - 1)) (1 - \\nu (1 - \\exp(-i \\theta))) = 1 - \\nu(1-\\exp(-i\\theta)) - \\nu(\\exp(i\\theta)-1) + \\nu^2(\\exp(i\\theta)-1)(1-\\exp(-i\\theta))$$\n$$= 1 - \\nu + \\nu\\exp(-i\\theta) - \\nu\\exp(i\\theta) + \\nu + \\nu^2(\\exp(i\\theta) - 1 - 1 + \\exp(-i\\theta))$$\n$$= 1 - \\nu(\\exp(i\\theta) - \\exp(-i\\theta)) + \\nu^2(\\exp(i\\theta) + \\exp(-i\\theta) - 2)$$\nUsing Euler's identities, $\\exp(i\\theta) - \\exp(-i\\theta) = 2i\\sin(\\theta)$ and $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$:\n$$= 1 - 2i\\nu\\sin(\\theta) + \\nu^2(2\\cos(\\theta) - 2) = 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))$$\nSubstituting this back into the expression for $G$:\n$$G = \\frac{1}{2} \\left(1 + 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))\\right)$$\n$$G(\\theta; \\nu) = 1 - \\nu^2(1-\\cos(\\theta)) - i\\nu\\sin(\\theta)$$\nUsing the half-angle identity $1-\\cos(\\theta) = 2\\sin^2(\\theta/2)$, this can also be written as:\n$$G(\\theta; \\nu) = 1 - 2\\nu^2\\sin^2(\\frac{\\theta}{2}) - i\\nu\\sin(\\theta)$$\nThis is the general amplification factor for the MacCormack scheme.\n\nNow, we evaluate $G$ at the specific wave number $\\theta = \\frac{\\pi}{2}$:\n$$\\sin\\left(\\frac{\\pi}{2}\\right) = 1$$\n$$\\sin\\left(\\frac{\\theta}{2}\\right) = \\sin\\left(\\frac{\\pi}{4}\\right) = \\frac{\\sqrt{2}}{2} \\implies \\sin^2\\left(\\frac{\\theta}{2}\\right) = \\frac{1}{2}$$\nSubstituting these values into the expression for $G$:\n$$G\\left(\\frac{\\pi}{2}; \\nu\\right) = 1 - 2\\nu^2\\left(\\frac{1}{2}\\right) - i\\nu(1) = 1 - \\nu^2 - i\\nu$$\nThis is a complex number representing the amplification factor for the specified mode.\n\nNext, we calculate its magnitude $|G|$:\n$$|G| = \\left|1 - \\nu^2 - i\\nu\\right| = \\sqrt{\\left(1 - \\nu^2\\right)^2 + (-\\nu)^2}$$\n$$|G| = \\sqrt{1 - 2\\nu^2 + \\nu^4 + \\nu^2}$$\n$$|G| = \\sqrt{1 - \\nu^2 + \\nu^4}$$\nFor the given condition $0 < \\nu < 1$, we have $\\nu^2 > \\nu^4$, so $\\nu^2 - \\nu^4 > 0$. Thus, $1 - (\\nu^2 - \\nu^4) < 1$, which implies $|G| < 1$. This means the mode is damped, as expected for a stable scheme.\n\nFinally, we calculate the phase $\\phi = \\arg(G)$. The real part is $\\text{Re}(G) = 1 - \\nu^2$ and the imaginary part is $\\text{Im}(G) = -\\nu$. Since $0 < \\nu < 1$, the real part is positive and the imaginary part is negative, placing the complex number in the fourth quadrant.\n$$\\phi = \\arctan\\left(\\frac{\\text{Im}(G)}{\\text{Re}(G)}\\right) = \\arctan\\left(\\frac{-\\nu}{1 - \\nu^2}\\right)$$\n$$\\phi = -\\arctan\\left(\\frac{\\nu}{1 - \\nu^2}\\right)$$\nThis phase $\\phi$ is the numerical phase shift per time step, in radians.\n\nThe problem requires the final answer in terms of $a$, $\\Delta x$, and $\\Delta t$. We substitute the CFL number $\\nu = \\frac{a \\Delta t}{\\Delta x}$ into the expressions for $|G|$ and $\\phi$.\n$$|G| = \\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4}$$\n$$\\phi = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2}\\right) = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{\\frac{(\\Delta x)^2 - (a \\Delta t)^2}{(\\Delta x)^2}}\\right) = -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right)$$\n\nThe final result is the ordered pair $(|G|, \\phi)$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4} & -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right) \\end{pmatrix}}$$"
        },
        {
            "introduction": "While analysis on constant-coefficient equations is instructive, real-world problems often involve spatially varying fields. This exercise  explores the critical distinction between the conservative and non-conservative forms of an advection equation with a variable coefficient $a(x)$. You will discover through Taylor analysis how a \"naive\" discretization can lose accuracy and then construct a proper conservative MacCormack scheme, reinforcing the principle that numerical methods must respect the underlying integral conservation law.",
            "id": "3342575",
            "problem": "Consider the linear advection of a scalar field with a spatially varying transport coefficient described by the conservation law $u_{t} + (a(x) u)_{x} = 0$, where $a(x)$ is a smooth, time-independent function and $u(x,t)$ is sufficiently smooth. Let the spatial domain be discretized on a uniform grid with nodes $x_{i} = x_{0} + i \\,\\Delta x$, and let time be discretized with $t_{n} = t_{0} + n \\,\\Delta t$. Define the Courant ratio $\\lambda = \\Delta t / \\Delta x$. Assume periodic boundary conditions and focus on a generic interior node $x_{i}$.\n\nStart from the partial differential equation given above and the definitions of forward and backward discrete differences. Analyze the local truncation error at $x_{i}$ of a “naive” MacCormack predictor–corrector that discretizes the nonconservative form $u_{t} + a(x) u_{x} = 0$ by using $a_{i} = a(x_{i})$ in both predictor and corrector steps to multiply one-sided discrete differences of $u$. Derive, by Taylor expansion about $x_{i}$ and $t_{n}$ and using the conservation law $u_{t} = - (a u)_{x}$, the leading-order nonvanishing term in the local truncation error that arises due to the neglected coefficient gradient. Explain the loss of second-order accuracy caused by this term.\n\nThen, construct a coefficient-aware MacCormack predictor–corrector formulated in conservative form, using cell-centered discrete fluxes $f_{i}^{n} = a_{i} \\, u_{i}^{n}$ in both predictor and corrector. Eliminate the intermediate predicted state to write the one-step combined update for $u_{i}^{n+1}$ explicitly in terms of $u_{i-1}^{n}$, $u_{i}^{n}$, $u_{i+1}^{n}$ and $a_{i-1}$, $a_{i}$, $a_{i+1}$, together with $\\lambda$. The expression must be algebraically closed, containing no predicted quantities, and must be consistent with second-order accuracy under smoothness of $a(x)$ and $u(x,t)$. Your final answer should be the single closed-form analytic expression for $u_{i}^{n+1}$ produced by this coefficient-aware conservative MacCormack scheme. No numerical evaluation is required.",
            "solution": "We begin from the conservation law $u_{t} + (a u)_{x} = 0$, where $a(x)$ is smooth, time-independent, and $u(x,t)$ is smooth. The fundamental base is the conservation form and its product-rule expansion $(a u)_{x} = a u_{x} + a_{x} u$, together with Taylor expansions in space and time at a grid point.\n\nAnalysis of the naive nonconservative MacCormack and loss of second order:\n\nConsider the naive MacCormack predictor–corrector that discretizes $u_{t} + a(x) u_{x} = 0$ by multiplying one-sided differences of $u$ by $a_{i} = a(x_{i})$. Its predictor and corrector at node $i$ are\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\, a_{i} \\left(u_{i+1}^{n} - u_{i}^{n}\\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\, a_{i} \\left( u_{i}^{*} - u_{i-1}^{*} \\right) \\right].\n$$\nTo assess consistency with the conservation law, insert the exact solution $u(x,t)$ at $(x_{i},t_{n})$ and expand to leading orders in $\\Delta x$ and $\\Delta t$. Write $\\Delta x$ as $\\Delta$ for brevity. Taylor expand the spatial values:\n$$\nu_{i+1}^{n} = u + u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\n$$\nu_{i-1}^{n} = u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\nand $a_{i-1} = a - a_{x} \\Delta + \\frac{1}{2} a_{xx} \\Delta^{2} + \\mathcal{O}(\\Delta^{3})$, where all derivatives are evaluated at $(x_{i},t_{n})$. The predictor yields\n$$\nu_{i}^{*} = u - \\lambda \\, a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) + \\mathcal{O}(\\Delta^{4}).\n$$\nA similar expansion at $i-1$ gives\n\\begin{align*}\nu_{i-1}^{*} &= \\left[ u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\\\\n&\\quad - \\lambda \\left[ a u_{x} \\Delta + \\left( -\\frac{1}{2} a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{6} a u_{xxx} + \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\nSubtract to obtain\n\\begin{align*}\nu_{i}^{*} - u_{i-1}^{*} &= u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\\\\n&\\quad + \\lambda \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\nNow form the corrector:\n\\begin{align*}\nu_{i}^{n+1} &= \\frac{1}{2} \\left\\{ \\left[ u + u_{i}^{*} \\right] - \\lambda a \\left[ u_{i}^{*} - u_{i-1}^{*} \\right] \\right\\} \\\\\n&= \\frac{1}{2} \\left\\{ 2 u - \\lambda a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) - \\lambda a \\left[ u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\right. \\\\\n&\\qquad \\left. - \\lambda^{2} a \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] \\right\\} + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\nSimplify the leading terms:\n$$\nu_{i}^{n+1} = u - \\lambda a \\, u_{x} \\Delta - \\frac{1}{6} \\lambda a \\, u_{xxx} \\Delta^{3} - \\frac{1}{2} \\lambda^{2} a \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\mathcal{O}(\\Delta^{3}, \\lambda^{2} \\Delta^{3}).\n$$\nSince $\\lambda \\Delta = \\Delta t$, the leading-order temporal increment generated by the scheme is $- a u_{x} \\Delta t$. However, the true time derivative from the conservation law is $u_{t} = - (a u)_{x} = - a u_{x} - a_{x} u$. Therefore, the local truncation error at order $\\Delta t$ contains the unbalanced term $+ a_{x} u \\, \\Delta t$. This is a first-order term and demonstrates that discretizing the nonconservative form $u_{t} + a(x) u_{x} = 0$ with the naive MacCormack loses consistency with the conservation law when $a_{x} \\neq 0$, and thus cannot achieve second-order accuracy in the presence of coefficient gradients.\n\nConstruction of the coefficient-aware conservative MacCormack and combined update:\n\nTo restore second-order accuracy and consistency with the conservation law, we discretize in conservative form using cell-centered fluxes $f_{i}^{n} = a_{i} \\, u_{i}^{n}$. The predictor–corrector reads\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\left( f_{i+1}^{n} - f_{i}^{n} \\right) = u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\left( f_{i}^{*} - f_{i-1}^{*} \\right) \\right],\n$$\nwith $f_{i}^{*} = a_{i} \\, u_{i}^{*}$ (since $a$ is time-independent). Eliminating the predicted variables, we obtain\n\\begin{align*}\nf_{i}^{*} &= a_{i} u_{i}^{*} = a_{i} u_{i}^{n} - \\lambda a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right), \\\\\nf_{i-1}^{*} &= a_{i-1} u_{i-1}^{*} = a_{i-1} u_{i-1}^{n} - \\lambda a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right).\n\\end{align*}\nSubstitute into the corrector and combine with the predictor to write a single-step update. First compute $u_{i}^{n} + u_{i}^{*}$:\n$$\nu_{i}^{n} + u_{i}^{*} = 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right).\n$$\nNext compute $f_{i}^{*} - f_{i-1}^{*}$:\n\\begin{align*}\nf_{i}^{*} - f_{i-1}^{*} &= \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left[ a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right].\n\\end{align*}\nTherefore,\n\\begin{align*}\nu_{i}^{n+1} &= \\frac{1}{2} \\left\\{ 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - \\lambda \\left[ \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left( a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right) \\right] \\right\\} \\\\\n&= u_{i}^{n} - \\frac{\\lambda}{2} \\left( a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n} \\right) + \\frac{\\lambda^{2}}{2} \\left[ a_{i} a_{i+1} u_{i+1}^{n} - \\left( a_{i}^{2} + a_{i-1} a_{i} \\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n} \\right].\n\\end{align*}\nThis explicit update uses only the values at $i-1$, $i$, and $i+1$ and the local coefficients $a_{i-1}$, $a_{i}$, $a_{i+1}$, and is consistent with the conservation form. A Taylor analysis analogous to the one above, but now carried through on the flux $f = a u$, shows that the first-order temporal increment is $- \\Delta t (a u)_{x}$ (correct), and the leading local truncation error is of order $\\mathcal{O}(\\Delta t^{2}, \\Delta x^{2})$ under smoothness, thereby restoring second-order accuracy.\n\nThe requested final expression for the coefficient-aware conservative MacCormack combined update is the closed-form analytic update for $u_{i}^{n+1}$ given above.",
            "answer": "$$\\boxed{u_{i}^{n+1} = u_{i}^{n} - \\frac{\\lambda}{2}\\left(a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n}\\right) + \\frac{\\lambda^{2}}{2}\\left[a_{i} a_{i+1} u_{i+1}^{n} - \\left(a_{i}^{2} + a_{i-1} a_{i}\\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n}\\right]}$$"
        },
        {
            "introduction": "The true test of a shock-capturing scheme lies in its application to nonlinear problems where discontinuities spontaneously form. This practice  provides a concrete, computational demonstration of the concepts from the previous exercise using the inviscid Burgers' equation. By implementing and comparing both conservative and non-conservative MacCormack schemes, you will observe firsthand that only the conservative formulation correctly computes the shock speed as predicted by the Rankine–Hugoniot condition, a cornerstone of hyperbolic conservation laws.",
            "id": "3342598",
            "problem": "Consider the one-dimensional inviscid Burgers equation in conservation form, given by $u_t + \\left(\\frac{u^2}{2}\\right)_x = 0$, where $u = u(x,t)$ denotes a scalar velocity field on a periodic domain with spatial coordinate $x$. The conservation law is understood in the weak sense, so that discontinuous solutions may occur and obey an integral balance derived from the conservation principle. The flux function is $f(u) = \\frac{u^2}{2}$. This equation admits shock waves for Riemann-type initial data with $u_L > u_R$, and the shock speed determined by the Rankine–Hugoniot jump condition is $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$.\n\nMacCormack predictor–corrector schemes are used to advance hyperbolic partial differential equations. In conservation law form, a MacCormack method advances the solution by predicting with a forward spatial difference of flux and correcting with a backward difference of the predicted flux. A nonconservative variant instead advances the variable using the nonconservative differential form $u_t + u\\,u_x = 0$, applying forward and backward differences to $u$ rather than to the flux $f(u)$. For discontinuous solutions, only the conservative formulation enforces the correct shock motion derived from the integral conservation law, while the nonconservative formulation is not guaranteed to propagate shocks with the correct speed.\n\nYour task is to construct a counterexample demonstrating that a nonconservative MacCormack update yields an incorrect shock location compared to both the conservative MacCormack update and the analytical Rankine–Hugoniot speed for the inviscid Burgers equation. Proceed as follows:\n\n1. Use a periodic domain of length $L = 2$, identified with the interval $[-1,1)$. Let $N$ be the number of uniformly spaced grid points, so that $\\Delta x = L/N$. Represent values at cell centers $x_i = -L/2 + i\\,\\Delta x$ for $i = 0,1,\\dots,N-1$.\n\n2. Initialize Riemann data at time $t=0$ with a single discontinuity located at $x = x_0$, defined by\n   $$\n   u(x,0) = \n   \\begin{cases}\n   u_L, & x < x_0, \\\\\n   u_R, & x \\ge x_0,\n   \\end{cases}\n   $$\n   with periodic continuation outside the interval $[-1,1)$.\n\n3. Implement two explicit MacCormack predictor–corrector schemes with a constant time step $\\Delta t$ satisfying a Courant–Friedrichs–Lewy condition based on the maximum characteristic speed. Use a dimensionless Courant number $\\text{CFL}$ and set $\\Delta t = \\text{CFL}\\,\\Delta x / \\max(|u_L|,|u_R|)$.\n   - Conservative MacCormack: apply predictor and corrector using forward and backward differences of the flux function $f(u) = \\frac{u^2}{2}$, ensuring a discretization consistent with the conservation law.\n   - Nonconservative MacCormack: apply predictor and corrector using forward and backward differences of the primitive variable $u$ in the nonconservative form $u_t + u\\,u_x = 0$.\n\n4. Advance each scheme for $n$ steps where $n = \\lceil T/\\Delta t \\rceil$, yielding a final time $t_{\\text{end}} = n\\,\\Delta t$.\n\n5. Estimate the numerical shock location at $t_{\\text{end}}$ for each scheme by identifying the position $x$ at which the solution crosses the midpoint value $m = \\frac{u_L + u_R}{2}$ between neighboring grid points, using linear interpolation between cell centers. If multiple crossings exist due to periodicity or numerical oscillations, select the crossing whose position minimizes the periodic distance to the analytical shock location. If no crossing is detected, approximate the shock location by the position of maximum magnitude of the discrete gradient and then refine using local interpolation.\n\n6. Compute the analytical shock location using the Rankine–Hugoniot speed $s = \\frac{u_L + u_R}{2}$, namely $x_{\\text{exact}}(t_{\\text{end}}) = x_0 + s\\,t_{\\text{end}}$, interpreting positions modulo the domain length $L$ to remain in $[-1,1)$.\n\n7. For each test case, report the absolute periodic distance between the numerical shock location and the analytical shock location at $t_{\\text{end}}$, separately for the conservative and nonconservative MacCormack schemes.\n\nUse the following test suite, which includes a clear shock propagation, a moderate shock, and a stationary shock:\n- Case 1: `u_L = 2.0`, `u_R = 0.0`, `x_0 = 0.0`, `N = 1000`, `T = 0.3`, `CFL = 0.4`.\n- Case 2: `u_L = 1.5`, `u_R = 0.5`, `x_0 = -0.2`, `N = 1000`, `T = 0.5`, `CFL = 0.4`.\n- Case 3: `u_L = 1.0`, `u_R = -1.0`, `x_0 = 0.3`, `N = 1000`, `T = 0.4`, `CFL = 0.4`.\n\nAll quantities are dimensionless; no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of conservative error followed by nonconservative error for each case, namely $[e_{\\text{cons},1},e_{\\text{noncons},1},e_{\\text{cons},2},e_{\\text{noncons},2},e_{\\text{cons},3},e_{\\text{noncons},3}]$, where each $e$ is a floating-point number representing the absolute periodic distance between the computed and analytical shock locations at the final time for the corresponding scheme and case.",
            "solution": "The problem requires constructing a numerical counterexample to demonstrate that a nonconservative finite difference scheme fails to compute the correct shock speed for the inviscid Burgers' equation, unlike a conservative scheme. This will be achieved by implementing and comparing two variants of the MacCormack method.\n\nThe one-dimensional inviscid Burgers' equation in conservation-law form is\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\frac{u^2}{2} \\right) = 0\n$$\nwhere $u(x,t)$ is the velocity, and the flux function is $f(u) = \\frac{u^2}{2}$. For smooth solutions, where the derivatives exist, the chain rule can be applied to yield the nonconservative form:\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = 0\n$$\nHowever, hyperbolic conservation laws like Burgers' equation are known to develop discontinuities (shock waves) even from smooth initial data. For discontinuous solutions, the differential forms are not well-defined, and one must refer to the integral form of the conservation law. The dynamics of a discontinuity are governed by the Rankine–Hugoniot jump condition, which is a direct consequence of this integral form. For a shock moving with speed $s$, separating two constant states $u_L$ (left) and $u_R$ (right), the condition is:\n$$\ns = \\frac{f(u_L) - f(u_R)}{u_L - u_R}\n$$\nFor Burgers' equation, this gives the analytical shock speed:\n$$\ns = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{u_L + u_R}{2}\n$$\nA numerical scheme must be formulated in \"conservation form\" to ensure that its solutions converge to a weak solution that satisfies this jump condition. A nonconservative scheme does not respect the integral balance and typically converges to a solution with an incorrect shock speed.\n\nWe will discretize the spatial domain $x \\in [-1, 1)$, of length $L=2$, using $N$ uniformly spaced cell centers $x_i = -L/2 + i \\Delta x$ for $i = 0, \\dots, N-1$, where $\\Delta x = L/N$. The time step $\\Delta t$ is determined by a Courant–Friedrichs–Lewy (CFL) condition, $\\Delta t = \\text{CFL} \\Delta x / \\max(|u_L|, |u_R|)$, to ensure numerical stability.\n\nThe initial condition is a Riemann problem with a step discontinuity at $x=x_0$:\n$$\nu(x,0) = \n\\begin{cases}\nu_L, & x < x_0, \\\\\nu_R, & x \\ge x_0,\n\\end{cases}\n$$\nWe advance the solution to a final time $t_{\\text{end}} = n \\Delta t$, where $n = \\lceil T/\\Delta t \\rceil$.\n\nThe two MacCormack schemes are implemented as follows. Let $u_i^n$ be the numerical solution at grid point $i$ and time $t^n = n \\Delta t$.\n\n**1. Conservative MacCormack Scheme**\nThis scheme discretizes the conservation law $u_t + f(u)_x=0$.\n*   Predictor step (forward difference on flux):\n    $$\n    u_i^* = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( f(u_{i+1}^n) - f(u_i^n) \\right)\n    $$\n*   Corrector step (backward difference on predicted flux):\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - \\frac{\\Delta t}{\\Delta x} \\left( f(u_i^*) - f(u_{i-1}^*) \\right) \\right)\n    $$\nHere, indices are handled periodically, e.g., $u_{N} = u_0$ and $u_{-1} = u_{N-1}$. This scheme is in conservation form and is expected to compute the correct shock speed in the limit of grid refinement.\n\n**2. Nonconservative MacCormack Scheme**\nThis scheme discretizes the nonconservative form $u_t + u u_x=0$.\n*   Predictor step (forward difference on $u$):\n    $$\n    u_i^* = u_i^n - u_i^n \\frac{\\Delta t}{\\Delta x} (u_{i+1}^n - u_i^n)\n    $$\n*   Corrector step (backward difference on predicted $u$):\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - u_i^* \\frac{\\Delta t}{\\Delta x} (u_i^* - u_{i-1}^*) \\right)\n    $$\nThis formulation does not discretize a flux difference at the cell interfaces and thus does not enforce a local conservation property. As a result, it is not guaranteed to capture the correct shock dynamics.\n\nAfter evolving the solution to $t_{\\text{end}}$ with both schemes, we determine the numerical shock location. This is done by finding where the numerical solution profile crosses the midpoint value $m = (u_L + u_R)/2$. We use linear interpolation between the two grid points bracketing the crossing. If multiple crossings occur due to numerical oscillations, we select the one closest to the analytical shock position, $x_{\\text{analytical}}(t_{\\text{end}}) = x_0 + s \\cdot t_{\\text{end}}$, using the periodic distance on the domain. The absolute periodic distance between two points $p_1$ and $p_2$ on a domain of length $L$ is given by $\\min(|p_1 - p_2|, L - |p_1 - p_2|)$.\n\nThe error for each scheme is then calculated as the absolute periodic distance between its computed numerical shock location, $x_{\\text{numerical}}$, and the analytical shock location, $x_{\\text{analytical}}$, at the final time $t_{\\text{end}}$. The results for the three test cases will demonstrate that the error for the nonconservative scheme is substantially larger than for the conservative one, confirming that the former computes an incorrect shock speed.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the 1D inviscid Burgers' equation using conservative and nonconservative\n    MacCormack schemes to demonstrate the importance of conservation form\n    for shock capturing.\n    \"\"\"\n    test_cases = [\n        # (u_L, u_R, x_0, N, T, CFL)\n        (2.0, 0.0, 0.0, 1000, 0.3, 0.4),\n        (1.5, 0.5, -0.2, 1000, 0.5, 0.4),\n        (1.0, -1.0, 0.3, 1000, 0.4, 0.4),\n    ]\n\n    results = []\n\n    for u_L, u_R, x_0, N, T, CFL in test_cases:\n        L = 2.0\n        dx = L / N\n        x = -L/2 + np.arange(N) * dx\n        \n        # CFL condition and time steps\n        max_speed = max(abs(u_L), abs(u_R))\n        if max_speed == 0:\n            # Avoid division by zero if max speed is zero, choose a reasonable dt\n            max_speed = 1.0\n        dt = CFL * dx / max_speed\n        num_steps = math.ceil(T / dt)\n        t_end = num_steps * dt\n\n        # Initial condition\n        u0 = np.full(N, u_R, dtype=np.float64)\n        u0[x < x_0] = u_L\n        \n        u_cons = u0.copy()\n        u_noncons = u0.copy()\n\n        # --- Time evolution ---\n        for _ in range(num_steps):\n            # Conservative MacCormack\n            f = 0.5 * u_cons**2\n            # Predictor\n            u_star_c = u_cons - (dt / dx) * (np.roll(f, -1) - f)\n            # Corrector\n            f_star = 0.5 * u_star_c**2\n            u_cons = 0.5 * (u_cons + u_star_c - (dt / dx) * (f_star - np.roll(f_star, 1)))\n\n            # Nonconservative MacCormack\n            # Predictor\n            u_star_nc = u_noncons - u_noncons * (dt / dx) * (np.roll(u_noncons, -1) - u_noncons)\n            # Corrector\n            u_noncons = 0.5 * (u_noncons + u_star_nc - u_star_nc * (dt / dx) * (u_star_nc - np.roll(u_star_nc, 1)))\n        \n        # --- Analysis ---\n        # Analytical shock location\n        s = (u_L + u_R) / 2.0\n        x_analytical = x_0 + s * t_end\n        # Map to periodic domain [-L/2, L/2)\n        x_analytical = -L/2 + (x_analytical - (-L/2)) % L\n\n        midpoint_val = (u_L + u_R) / 2.0\n        \n        def find_shock_location(u_final, x_grid, L_domain, analytical_pos, dx_grid):\n            \"\"\"\n            Finds the numerical shock location by looking for a crossing of the\n            midpoint value, refined by linear interpolation.\n            \"\"\"\n            crossings = []\n            # Find all crossings of midpoint_val\n            for i in range(N):\n                u_i = u_final[i]\n                u_i_plus_1 = u_final[(i + 1) % N]\n                if (u_i - midpoint_val) * (u_i_plus_1 - midpoint_val) <= 0 and u_i != u_i_plus_1:\n                    x_i = x_grid[i]\n                    x_cross = x_i + dx_grid * (midpoint_val - u_i) / (u_i_plus_1 - u_i)\n                    crossings.append(x_cross)\n\n            if crossings:\n                # Find crossing closest to analytical solution\n                min_dist = float('inf')\n                best_pos = crossings[0]\n                for pos in crossings:\n                    dist = abs(pos - analytical_pos)\n                    periodic_dist = min(dist, L_domain - dist)\n                    if periodic_dist < min_dist:\n                        min_dist = periodic_dist\n                        best_pos = pos\n                return best_pos\n            else:\n                # Fallback: max gradient\n                grad = np.abs(np.roll(u_final, -1) - u_final)\n                max_grad_idx = np.argmax(grad)\n                \n                u_a = u_final[max_grad_idx]\n                u_b = u_final[(max_grad_idx + 1) % N]\n                x_a = x_grid[max_grad_idx]\n                \n                if abs(u_b - u_a) < 1e-9: # Avoid division by zero\n                    return x_a + dx_grid / 2.0\n                \n                x_pos = x_a + dx_grid * (midpoint_val - u_a) / (u_b - u_a)\n                return x_pos\n\n        def periodic_map(pos, length):\n            \"\"\"Maps a position to the periodic interval [-length/2, length/2).\"\"\"\n            return -length/2 + (pos - (-length/2)) % length\n\n        x_num_cons = find_shock_location(u_cons, x, L, x_analytical, dx)\n        x_num_noncons = find_shock_location(u_noncons, x, L, x_analytical, dx)\n        \n        x_num_cons = periodic_map(x_num_cons, L)\n        x_num_noncons = periodic_map(x_num_noncons, L)\n        \n        def periodic_distance(p1, p2, length):\n            \"\"\"Calculates the absolute periodic distance between two points.\"\"\"\n            dist = abs(p1 - p2)\n            return min(dist, length - dist)\n\n        error_cons = periodic_distance(x_num_cons, x_analytical, L)\n        error_noncons = periodic_distance(x_num_noncons, x_analytical, L)\n\n        results.extend([error_cons, error_noncons])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}