{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of low-Mach preconditioning lies in correctly scaling the thermodynamic variables. At low speeds, a fluid's internal energy vastly exceeds its kinetic energy. This exercise demonstrates why a naive nondimensionalization of the energy equation using kinetic energy fails catastrophically as the Mach number $M \\to 0$, and guides you through deriving the physically consistent scaling based on thermal energy. Through a combination of first-principles derivation and numerical validation, you will solidify your understanding of the fundamental problem that preconditioning is designed to solve .",
            "id": "3341795",
            "problem": "You are to develop a principled nondimensionalization and scaling for the compressible energy variables that is consistent with low-Mach preconditioning, and then validate its consequences on a simple non-isentropic heated channel flow model. The context is Computational Fluid Dynamics (CFD) with low-Mach preconditioning for compressible equations. Your derivation and program must be self-contained and start from fundamental laws and core definitions without assuming any specialized preconditioning formula. The goal is to show what the scaling is, why it is correct, and how it is derived so the energy transport remains $\\mathcal{O}(1)$ as the Mach number ($M$) tends to zero.\n\nStart from the conservative compressible Navier–Stokes equations for a perfect gas and the Ideal Gas Law. Use the following base definitions and facts:\n- The Ideal Gas Law $p=\\rho R T$, where $p$ is pressure, $\\rho$ is density, $R$ is the specific gas constant, and $T$ is temperature.\n- The specific heats satisfy $c_p-c_v=R$, with $c_p=\\dfrac{\\gamma R}{\\gamma-1}$ and $c_v=\\dfrac{R}{\\gamma-1}$, where $\\gamma$ is the ratio of specific heats.\n- The speed of sound is $a=\\sqrt{\\gamma R T}$, and the Mach number is $M=\\dfrac{U}{a_{\\mathrm{ref}}}$, where $U$ is a characteristic velocity and $a_{\\mathrm{ref}}=\\sqrt{\\gamma R T_{\\mathrm{ref}}}$ is the reference speed of sound at the reference temperature $T_{\\mathrm{ref}}$.\n- The static enthalpy is $h=c_p T$, the internal energy is $e=c_v T$, the total energy per unit mass is $E=e+\\dfrac{1}{2}\\lvert\\mathbf{u}\\rvert^2$, and the total enthalpy per unit mass is $H=h+\\dfrac{1}{2}\\lvert\\mathbf{u}\\rvert^2$.\n- In one-dimensional steady channel flow directed along the $x$-axis with plug flow velocity $u=U$, the energy convective flux has the form $\\rho u H$.\n\nYour tasks are:\n1. Derivation task. Starting from the above base, derive a consistent scaling and nondimensionalization for $h$ and $E$ that is compatible with low-Mach preconditioning and yields an energy transport term that remains $\\mathcal{O}(1)$ as $M\\to 0$. You must reason from first principles, explaining why the appropriate reference scales are chosen and how the scales follow from the governing equations. You may assume that the preconditioning concept rescales thermodynamic stiffness to balance acoustic and convective contributions but do not introduce any unproved target formula in the problem statement.\n2. Validation task. Consider a non-isentropic heated channel flow with imposed heating such that the exit temperature $T_{\\mathrm{out}}$ is a multiple of the inlet/reference temperature $T_{\\mathrm{ref}}$, i.e., $T_{\\mathrm{out}}=f\\,T_{\\mathrm{ref}}$ with $f>1$. Assume low-Mach conditions where pressure variations are small and approximate $p\\approx p_{\\mathrm{ref}}$ along the channel, with a uniform plug flow $u=U$ equal to $U=M\\,a_{\\mathrm{ref}}$. Use the Ideal Gas Law to evaluate $\\rho_{\\mathrm{out}}\\approx \\dfrac{p_{\\mathrm{ref}}}{R\\,T_{\\mathrm{out}}}$ and take $H_{\\mathrm{out}}=c_p T_{\\mathrm{out}}+\\dfrac{1}{2}U^2$. Define a dimensionless “normalized convective energy transport measure at the exit” under two scalings:\n   - An acoustic-enthalpy-based normalization implied by your derived low-Mach preconditioned scaling. For testability, take the characteristic energy-flux scale to be $\\rho_{\\mathrm{ref}}\\,a_{\\mathrm{ref}}^2\\,U$, where $\\rho_{\\mathrm{ref}}=\\dfrac{p_{\\mathrm{ref}}}{R\\,T_{\\mathrm{ref}}}$ and $a_{\\mathrm{ref}}=\\sqrt{\\gamma R T_{\\mathrm{ref}}}$.\n   - A naive velocity-squared normalization using $\\rho_{\\mathrm{ref}}\\,U^3$, which is known to be inconsistent with low-Mach scaling.\n   The two dimensionless measures to compute are, respectively,\n   $$S_{\\mathrm{good}}=\\dfrac{\\rho_{\\mathrm{out}}\\,U\\,H_{\\mathrm{out}}}{\\rho_{\\mathrm{ref}}\\,a_{\\mathrm{ref}}^2\\,U},\\qquad S_{\\mathrm{bad}}=\\dfrac{\\rho_{\\mathrm{out}}\\,U\\,H_{\\mathrm{out}}}{\\rho_{\\mathrm{ref}}\\,U^3}.$$\n   You must use the above definitions in your program to numerically validate that $S_{\\mathrm{good}}$ remains $\\mathcal{O}(1)$ as $M\\to 0$ across heated cases, whereas $S_{\\mathrm{bad}}$ does not.\n\nPhysical constants and units to use in the validation:\n- Reference temperature $T_{\\mathrm{ref}}$ in $\\mathrm{K}$: $300$.\n- Reference pressure $p_{\\mathrm{ref}}$ in $\\mathrm{Pa}$: $101325$.\n- Ratio of specific heats $\\gamma$: $1.4$.\n- Specific gas constant $R$ in $\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$: $287$.\nAll outputs must be unitless (dimensionless floats).\n\nTest suite:\nCompute the ordered pair $\\left[S_{\\mathrm{good}},S_{\\mathrm{bad}}\\right]$ for each of these $(M,f)$ cases:\n- Case $1$: $M=1.0$, $f=1.0$.\n- Case $2$: $M=0.1$, $f=1.5$.\n- Case $3$: $M=0.01$, $f=2.0$.\n- Case $4$: $M=0.001$, $f=1.2$.\nThese cases cover a general compressible regime, moderate low-Mach with heating, deep low-Mach with strong heating, and an extreme low-Mach boundary with mild heating.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of the four ordered pairs, enclosed in square brackets, with each pair itself enclosed in square brackets, for example, $\\left[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]\\right]$. The numerical values $x_i$ and $y_i$ must be floats.",
            "solution": "The problem requires the derivation of a thermodynamically consistent scaling for energy variables in the context of low-Mach number compressible flows, followed by a numerical validation. The derivation must originate from first principles of fluid dynamics and thermodynamics.\n\n### Derivation of Low-Mach Energy Scaling\n\nThe fundamental challenge in simulating compressible flows at low Mach numbers, $M \\to 0$, is the multiscale nature of the governing equations. The speed of acoustic waves, $a$, is much larger than the fluid velocity, $U$, leading to a stiff system. This stiffness is particularly pronounced in the energy equation. Our goal is to derive a nondimensionalization scheme that ensures the terms in the energy equation remain of order unity, $\\mathcal{O}(1)$, as $M \\to 0$.\n\nWe begin with the definitions for total energy per unit mass, $E$, and total enthalpy per unit mass, $H$, for a perfect gas:\n$$E = e + \\frac{1}{2}|\\mathbf{u}|^2 = c_v T + \\frac{1}{2}|\\mathbf{u}|^2$$\n$$H = h + \\frac{1}{2}|\\mathbf{u}|^2 = c_p T + \\frac{1}{2}|\\mathbf{u}|^2$$\nwhere $e$ is the specific internal energy, $h$ is the specific static enthalpy, $T$ is temperature, $\\mathbf{u}$ is the velocity vector, and $c_v$ and $c_p$ are the specific heats at constant volume and pressure, respectively.\n\nThe core of the problem lies in choosing appropriate reference scales for nondimensionalization. Let us denote reference quantities with a subscript `ref` and dimensionless quantities with a prime, e.g., $\\mathbf{u} = U \\mathbf{u}'$, where $U$ is a characteristic velocity.\n\nA naive scaling, often used for high-speed compressible flows, would be to scale all energy quantities by the characteristic kinetic energy, $U^2$. Let us examine the consequences of this choice. The dimensionless total energy, $E'_{naive}$, would be:\n$$E'_{naive} = \\frac{E}{U^2} = \\frac{c_v T}{U^2} + \\frac{1}{2}\\frac{|\\mathbf{u}|^2}{U^2}$$\nTo analyze the first term, we use the definition of the speed of sound, $a^2 = \\gamma R T$, and the Mach number, $M = U/a_{\\mathrm{ref}}$.\n$$\\frac{c_v T}{U^2} = \\frac{c_v T}{M^2 a_{\\mathrm{ref}}^2} = \\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) \\frac{c_v T_{\\mathrm{ref}}}{M^2 a_{\\mathrm{ref}}^2}$$\nUsing $c_v = R/(\\gamma-1)$ and $a_{\\mathrm{ref}}^2 = \\gamma R T_{\\mathrm{ref}}$, we find:\n$$\\frac{c_v T_{\\mathrm{ref}}}{a_{\\mathrm{ref}}^2} = \\frac{R/(\\gamma-1) T_{\\mathrm{ref}}}{\\gamma R T_{\\mathrm{ref}}} = \\frac{1}{\\gamma(\\gamma-1)}$$\nAssuming temperature fluctuations are bounded, $T/T_{\\mathrm{ref}} = \\mathcal{O}(1)$, the thermal energy contribution to $E'_{naive}$ becomes:\n$$\\frac{c_v T}{U^2} = \\mathcal{O}\\left(\\frac{1}{M^2}\\right)$$\nTherefore, the dimensionless total energy becomes:\n$$E'_{naive} = \\mathcal{O}\\left(\\frac{1}{M^2}\\right) + \\frac{1}{2}|\\mathbf{u}'|^2$$\nAs $M \\to 0$, the scaled thermal energy term diverges. This demonstrates that $U^2$ is an improper scale for total energy in the low-Mach regime. The physical reason is that for low-speed flows, the internal energy is vastly larger than the kinetic energy. The total energy is dominated by its thermal component.\n\nA consistent scaling must acknowledge this physical reality. The dominant thermal energy, $h = c_p T$, is directly related to the speed of sound squared, $a^2 = \\gamma R T$. This suggests that a natural reference scale for specific energy quantities ($e, h, E, H$) is $a_{\\mathrm{ref}}^2$. Let us define a new dimensionless total energy, $E'$, using this scale:\n$$E' = \\frac{E}{a_{\\mathrm{ref}}^2} = \\frac{c_v T}{a_{\\mathrm{ref}}^2} + \\frac{1}{2}\\frac{|\\mathbf{u}|^2}{a_{\\mathrm{ref}}^2}$$\nLet's analyze the terms again:\nThe thermal term is $\\dfrac{c_v T}{a_{\\mathrm{ref}}^2} = \\left(\\dfrac{T}{T_{\\mathrm{ref}}}\\right) \\dfrac{c_v T_{\\mathrm{ref}}}{a_{\\mathrm{ref}}^2} = \\left(\\dfrac{T}{T_{\\mathrm{ref}}}\\right) \\dfrac{1}{\\gamma(\\gamma-1)} = \\mathcal{O}(1)$.\nThe kinetic term is $\\dfrac{1}{2}\\dfrac{|\\mathbf{u}|^2}{a_{\\mathrm{ref}}^2} = \\dfrac{1}{2}\\dfrac{U^2 |\\mathbf{u}'|^2}{a_{\\mathrm{ref}}^2} = \\dfrac{1}{2} M^2 |\\mathbf{u}'|^2 = \\mathcal{O}(M^2)$.\nThus, the properly scaled dimensionless total energy is:\n$$E' = \\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) \\frac{1}{\\gamma(\\gamma-1)} + \\frac{1}{2}M^2|\\mathbf{u}'|^2$$\nAs $M \\to 0$, $E'$ remains $\\mathcal{O}(1)$ and smoothly approaches the scaled internal energy. This scaling is well-behaved and removes the system stiffness associated with the energy variable.\n\nThis principle extends to the energy convective flux, $\\rho \\mathbf{u} H$. The characteristic scale of this flux is $(\\rho_{\\mathrm{ref}})(\\_U)(H_{\\mathrm{ref}})$. Using our derived scale $H_{\\mathrm{ref}} = a_{\\mathrm{ref}}^2$, the characteristic flux becomes $\\rho_{\\mathrm{ref}} U a_{\\mathrm{ref}}^2$. This corresponds to the denominator in the definition of $S_{\\mathrm{good}}$. The dimensionless flux is then:\n$$\\frac{\\rho \\mathbf{u} H}{\\rho_{\\mathrm{ref}} U a_{\\mathrm{ref}}^2} = \\rho' \\mathbf{u}' \\frac{H}{a_{\\mathrm{ref}}^2} = \\rho' \\mathbf{u}' \\left(\\frac{c_p T}{a_{\\mathrm{ref}}^2} + \\frac{1}{2}\\frac{|\\mathbf{u}|^2}{a_{\\mathrm{ref}}^2}\\right)$$\nThe term $\\dfrac{c_p T}{a_{\\mathrm{ref}}^2} = \\left(\\dfrac{T}{T_{\\mathrm{ref}}}\\right)\\dfrac{1}{\\gamma-1} = \\mathcal{O}(1)$. The full dimensionless flux is $\\mathcal{O}(1)$ as $M \\to 0$, ensuring the energy transport equation is well-conditioned. This scaling is the essence of low-Mach preconditioning as applied to the energy equation: it rescales the thermodynamic state to balance with convective phenomena.\n\n### Numerical Validation\n\nWe now validate this conclusion using the specified heated channel flow model. We will compute the two dimensionless measures, $S_{\\mathrm{good}}$ and $S_{\\mathrm{bad}}$, which represent the correctly and incorrectly scaled energy fluxes, respectively.\n\nThe formulas are:\n$$S_{\\mathrm{good}}=\\dfrac{\\rho_{\\mathrm{out}}\\,U\\,H_{\\mathrm{out}}}{\\rho_{\\mathrm{ref}}\\,a_{\\mathrm{ref}}^2\\,U} = \\dfrac{\\rho_{\\mathrm{out}}\\,H_{\\mathrm{out}}}{\\rho_{\\mathrm{ref}}\\,a_{\\mathrm{ref}}^2}$$\n$$S_{\\mathrm{bad}}=\\dfrac{\\rho_{\\mathrm{out}}\\,U\\,H_{\\mathrm{out}}}{\\rho_{\\mathrm{ref}}\\,U^3}$$\nThe quantities at the channel exit are defined as:\n$T_{\\mathrm{out}} = f T_{\\mathrm{ref}}$\n$U = M a_{\\mathrm{ref}}$\nUnder the low-Mach assumption $p \\approx p_{\\mathrm{ref}}$, the ideal gas law $p = \\rho R T$ gives $\\rho_{\\mathrm{out}} = \\dfrac{p_{\\mathrm{ref}}}{R T_{\\mathrm{out}}} = \\dfrac{p_{\\mathrm{ref}}}{R f T_{\\mathrm{ref}}}$. Since $\\rho_{\\mathrm{ref}} = \\dfrac{p_{\\mathrm{ref}}}{R T_{\\mathrm{ref}}}$, we have $\\rho_{\\mathrm{out}} = \\dfrac{\\rho_{\\mathrm{ref}}}{f}$.\nThe exit total enthalpy is $H_{\\mathrm{out}} = c_p T_{\\mathrm{out}} + \\frac{1}{2}U^2 = c_p f T_{\\mathrm{ref}} + \\frac{1}{2}M^2 a_{\\mathrm{ref}}^2$.\n\nSubstituting these into the expression for $S_{\\mathrm{good}}$:\n$$S_{\\mathrm{good}} = \\frac{(\\rho_{\\mathrm{ref}}/f)(c_p f T_{\\mathrm{ref}} + \\frac{1}{2}M^2 a_{\\mathrm{ref}}^2)}{\\rho_{\\mathrm{ref}} a_{\\mathrm{ref}}^2} = \\frac{c_p T_{\\mathrm{ref}}}{a_{\\mathrm{ref}}^2} + \\frac{M^2}{2f}$$\nUsing $c_p = \\dfrac{\\gamma R}{\\gamma-1}$ and $a_{\\mathrm{ref}}^2 = \\gamma R T_{\\mathrm{ref}}$, the constant term simplifies to $\\dfrac{c_p T_{\\mathrm{ref}}}{a_{\\mathrm{ref}}^2} = \\dfrac{1}{\\gamma-1}$.\nThus, we arrive at the analytical expressions:\n$$S_{\\mathrm{good}} = \\frac{1}{\\gamma-1} + \\frac{M^2}{2f}$$\n$$S_{\\mathrm{bad}} = \\frac{S_{\\mathrm{good}}}{M^2} = \\frac{1}{M^2(\\gamma-1)} + \\frac{1}{2f}$$\nAs $M \\to 0$, $S_{\\mathrm{good}}$ approaches the constant $\\dfrac{1}{\\gamma-1}$, confirming it is an $\\mathcal{O}(1)$ quantity. In contrast, $S_{\\mathrm{bad}}$ diverges as $\\mathcal{O}(M^{-2})$. The following program will numerically compute these values from the fundamental definitions to verify this behavior for the given test cases. For $\\gamma=1.4$, the limiting value for $S_{\\mathrm{good}}$ is $1/(1.4-1.0) = 2.5$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and validates energy flux scaling for low-Mach number flows.\n    \"\"\"\n    # Define physical constants and reference-state properties\n    T_ref = 300.0  # Reference temperature in K\n    p_ref = 101325.0  # Reference pressure in Pa\n    gamma = 1.4  # Ratio of specific heats\n    R = 287.0  # Specific gas constant in J/(kg*K)\n\n    # Define the test cases as a list of (Mach number, temperature factor) tuples\n    test_cases = [\n        (1.0, 1.0),\n        (0.1, 1.5),\n        (0.01, 2.0),\n        (0.001, 1.2),\n    ]\n\n    results = []\n\n    # Calculate derived reference quantities\n    a_ref = np.sqrt(gamma * R * T_ref)\n    rho_ref = p_ref / (R * T_ref)\n    c_p = gamma * R / (gamma - 1.0)\n\n    for M, f in test_cases:\n        # Calculate flow properties based on the test case\n        U = M * a_ref\n        T_out = f * T_ref\n        \n        # Approximate density at exit assuming constant pressure p_ref\n        rho_out = p_ref / (R * T_out)\n        \n        # Calculate total enthalpy at exit\n        H_out = c_p * T_out + 0.5 * U**2\n        \n        # Calculate the convective energy flux at the exit\n        energy_flux = rho_out * U * H_out\n        \n        # Calculate the \"good\" scaling denominator (acoustic-enthalpy-based)\n        # This scale is O(rho_ref * U * a_ref^2)\n        denom_good = rho_ref * (a_ref**2) * U\n        \n        # Calculate the \"bad\" scaling denominator (naive velocity-squared-based)\n        # This scale is O(rho_ref * U^3)\n        denom_bad = rho_ref * (U**3)\n        \n        # Compute the two dimensionless measures\n        # Note: If M=0, U=0, leading to division by zero. The problem uses M > 0.\n        S_good = energy_flux / denom_good\n        S_bad = energy_flux / denom_bad\n        \n        results.append([S_good, S_bad])\n\n    # Format the output string precisely as required: [[r1_1,r1_2],[r2_1,r2_2],...]\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "A primary motivation for using preconditioning is to dramatically accelerate the convergence of simulations to a steady state. By re-scaling the system's disparate eigenvalues to be of the same order of magnitude, preconditioning removes the stiffness that otherwise cripples explicit time-stepping schemes at low Mach numbers. This hands-on calculation makes the abstract benefit concrete, tasking you with deriving the modified stability constraint for a preconditioned system and quantifying the significant increase in the allowable pseudo-time step .",
            "id": "3341765",
            "problem": "Consider one-dimensional steady uniform flow of a calorically perfect ideal gas with specific heat ratio $\\gamma=1.4$ at a freestream Mach number $M=0.02$. The compressible Euler equations are written in quasi-linear form as $\\partial \\mathbf{Q}/\\partial t + \\partial \\mathbf{F}(\\mathbf{Q})/\\partial x = \\mathbf{0}$, where $\\mathbf{Q}$ denotes the conserved variables and $\\mathbf{F}$ the inviscid flux. To accelerate convergence to steady state, pseudo-time $\\tau$ integration with a preconditioning matrix is employed, so the pseudo-time system is $\\mathbf{P}\\,\\partial \\mathbf{Q}/\\partial \\tau + \\partial \\mathbf{F}(\\mathbf{Q})/\\partial x = \\mathbf{0}$, where $\\mathbf{P}$ is the Turkel preconditioning matrix.\n\nAssume linearization about the uniform state and consider a first-order explicit forward Euler update in pseudo-time over a uniform grid of spacing $\\Delta x$. The Courant–Friedrichs–Lewy (CFL) number is defined by $\\mathrm{CFL} = \\lambda_{\\max}\\,\\Delta \\tau/\\Delta x$, where $\\lambda_{\\max}$ is the maximum magnitude of the preconditioned characteristic speed along the $x$-direction, and $\\Delta \\tau$ is the pseudo-time step. The physical speed of sound is $a$, the flow speed is $u$, and the Mach number is defined as $M = \\lvert u \\rvert/a$. For a calorically perfect gas, $a = \\sqrt{\\gamma p/\\rho}$, where $p$ is the pressure and $\\rho$ is the density.\n\nUnder Turkel preconditioning in the low-Mach regime, the acoustic characteristic speeds are scaled by a factor $\\sqrt{\\beta}$, where the preconditioning parameter satisfies $\\beta = M^{2}$ for $M \\leq 1$, while the convective characteristic speed remains $u$. Using these facts, derive the stability constraint for the explicit scheme and compute the stable pseudo-time step $\\Delta \\tau$ when $\\mathrm{CFL} = 0.5$, $M = 0.02$, $\\gamma = 1.4$, and the grid size is $\\Delta x$. Express your final answer in seconds as a single simplified closed-form analytic expression in terms of $\\Delta x$ and $a$. No rounding is required.",
            "solution": "We start from the compressible Euler equations in quasi-linear form, linearized about a uniform state, where the flux Jacobian in one spatial dimension has characteristic speeds $u-a$, $u$, and $u+a$. These are the eigenvalues of the unpreconditioned Jacobian $\\partial \\mathbf{F}/\\partial \\mathbf{Q}$ along the $x$-direction. Introducing pseudo-time $\\tau$ and Turkel preconditioning, the system can be written as\n$$\n\\mathbf{P}\\,\\frac{\\partial \\mathbf{Q}}{\\partial \\tau} + \\frac{\\partial \\mathbf{F}(\\mathbf{Q})}{\\partial x} = \\mathbf{0},\n$$\nor equivalently\n$$\n\\frac{\\partial \\mathbf{Q}}{\\partial \\tau} + \\mathbf{P}^{-1}\\,\\frac{\\partial \\mathbf{F}(\\mathbf{Q})}{\\partial x} = \\mathbf{0}.\n$$\nThe effect of preconditioning is to modify the characteristic speeds of the spatial operator from their physical values to preconditioned values. In the Turkel preconditioner for low-Mach-number flows, the convective characteristic speed $u$ is unchanged, while the acoustic speeds are scaled by a factor $\\sqrt{\\beta}$, where the preconditioning parameter $\\beta$ satisfies $\\beta = M^{2}$ for $M \\leq 1$. Thus, the preconditioned characteristic speeds are\n$$\n\\lambda_{1} = u - a\\sqrt{\\beta}, \\quad \\lambda_{2} = u, \\quad \\lambda_{3} = u + a\\sqrt{\\beta}.\n$$\n\nFor an explicit forward Euler scheme in pseudo-time applied to the linearized system on a uniform grid of spacing $\\Delta x$, a standard von Neumann stability argument gives the Courant–Friedrichs–Lewy condition\n$$\n\\Delta \\tau \\leq \\frac{\\mathrm{CFL}\\,\\Delta x}{\\max\\left(\\lvert\\lambda_{1}\\rvert,\\lvert\\lambda_{2}\\rvert,\\lvert\\lambda_{3}\\rvert\\right)}.\n$$\nFor subsonic flow with $u \\geq 0$ and small Mach number (here $M=0.02$), the maximum magnitude among the three characteristic speeds is\n$$\n\\lambda_{\\max} = u + a\\sqrt{\\beta}.\n$$\nUsing the definition of Mach number $M = \\lvert u \\rvert/a$, we have $u = M a$. Substituting $u = M a$ and $\\beta = M^{2}$ into $\\lambda_{\\max}$ yields\n$$\n\\lambda_{\\max} = M a + a\\sqrt{M^{2}} = M a + a M = 2 M a.\n$$\n\nTherefore, the stability constraint becomes\n$$\n\\Delta \\tau \\leq \\frac{\\mathrm{CFL}\\,\\Delta x}{2 M a}.\n$$\nWith the specified parameters $\\mathrm{CFL} = 0.5$ and $M = 0.02$, this reduces to\n$$\n\\Delta \\tau = \\frac{0.5\\,\\Delta x}{2 \\cdot 0.02 \\, a} = \\frac{0.5\\,\\Delta x}{0.04\\,a} = \\frac{12.5\\,\\Delta x}{a}.\n$$\nHere, $a$ is the physical speed of sound, which for a calorically perfect ideal gas is $a = \\sqrt{\\gamma p/\\rho}$ with $\\gamma = 1.4$. Since $p$ and $\\rho$ are not specified, the closed-form expression in terms of $\\Delta x$ and $a$ is the final result. The units are seconds because $\\Delta x$ has units of length and $a$ has units of length per unit time, so their ratio has units of time.\n\nThus, the stable pseudo-time step under Turkel preconditioning for the given conditions is\n$$\n\\Delta \\tau = \\frac{12.5\\,\\Delta x}{a}.\n$$",
            "answer": "$$\\boxed{\\frac{12.5\\,\\Delta x}{a}}$$"
        },
        {
            "introduction": "Implementing a preconditioning strategy requires more than just modifying a single matrix; it demands that other components of the numerical solver are made consistent with the new scaling. This practice explores a subtle but critical interaction between preconditioning and the entropy fix used in modern shock-capturing schemes. You will analyze how a standard, Mach-unaware entropy fix can introduce excessive numerical dissipation that corrupts the solution at low speeds, and determine a correctly scaled, Mach-dependent formulation that works in harmony with the preconditioned system to maintain accuracy .",
            "id": "3341806",
            "problem": "In compressible Computational Fluid Dynamics (CFD), consider the inviscid Euler equations in conservative form, $\\partial_t \\mathbf{U} + \\nabla \\cdot \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$, where $\\mathbf{U}$ is the vector of conservative variables and $\\mathbf{F}$ is the flux tensor. A Roe-type approximate Riemann solver constructs an interface-normal numerical flux from a jump $\\Delta \\mathbf{U}$ using characteristic decomposition with respect to the normal flux Jacobian $\\mathbf{A}_n = \\partial \\mathbf{F}_n / \\partial \\mathbf{U}$, where $\\mathbf{F}_n = \\mathbf{F}(\\mathbf{U}) \\cdot \\mathbf{n}$ and $\\mathbf{n}$ is a unit normal. For low-Mach number flows with local Mach number $M = \\lvert \\mathbf{u} \\rvert / c \\ll 1$, a preconditioning matrix $\\mathbf{P}(M)$ is introduced so that the effective normal operator $\\mathbf{P}^{-1}\\mathbf{A}_n$ has eigenvalues $\\lambda_{\\pm} = u_n \\pm \\tilde{c}$ and convective eigenvalues equal to $u_n$ (possibly with multiplicity), where $u_n = \\mathbf{u} \\cdot \\mathbf{n}$, $c$ is the physical speed of sound, and $\\tilde{c} = \\phi(M)\\,c$ is a preconditioned acoustic speed with $\\phi(M) \\sim M$ as $M \\to 0$. In preconditioned formulations, the entropy condition for the acoustic fields is tied to the preconditioned sonic condition $\\lvert u_n \\rvert \\approx \\tilde{c}$.\n\nTo avoid non-physical expansion shocks in transonic rarefactions, Roe-type solvers apply an entropy fix that replaces $\\lvert \\lambda_k \\rvert$ by a Lipschitz-continuous entropy-corrected magnitude $\\lvert \\lambda_k \\rvert_e$ that increases the dissipation near sonic points, controlled by a threshold parameter $\\delta_k$ for each field $k$. In the classical (unpreconditioned) setting, choosing $\\delta_k$ proportional to $c$ ensures adequate entropy-satisfying dissipation near $\\lvert u_n \\rvert \\approx c$. However, at low $M$, such a choice can conflict with preconditioning and can overdamp vortical structures whose dynamics are dominated by the convective eigenvalues of magnitude $\\mathcal{O}(u_n) = \\mathcal{O}(M c)$.\n\nStarting from the above fundamentals and the definition of $M$, analyze the scaling of the entropy correction in the preconditioned problem and determine which of the following Mach-dependent entropy fixes simultaneously satisfies the following goals:\n\n- $(\\mathrm{G1})$ It aligns the entropy trigger with the preconditioned acoustic fields, i.e., it activates when $\\lvert u_n \\rvert \\approx \\tilde{c}$, not when $\\lvert u_n \\rvert \\approx c$.\n- $(\\mathrm{G2})$ It avoids contaminating the convective (vortical) modes with artificial dissipation that is not asymptotically negligible as $M \\to 0$.\n- $(\\mathrm{G3})$ It preserves Lipschitz continuity of the characteristic magnitudes near sonic points and does not alter the sign of the wave speeds.\n\nAssume that when a threshold $\\delta_k$ is specified for a field $k$, a standard Lipschitz continuous entropy replacement is used that yields an added magnitude of order $\\delta_k$ near the sonic point of that field (for example, at the sonic point the corrected magnitude is of order $\\delta_k$). You may assume any reasonable preconditioner for which $\\tilde{c} = \\phi(M)\\,c$ with $\\phi(M) \\sim M$ as $M \\to 0$, and that the Roe-averaging used to define characteristic fields is consistent with the above eigenstructure.\n\nWhich option best satisfies $(\\mathrm{G1})$–$(\\mathrm{G3})$?\n\nA. Use the unpreconditioned speed of sound for all fields: set $\\delta_k = \\kappa\\,c$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.\n\nB. Use the preconditioned acoustic speed for all fields: set $\\delta_k = \\kappa\\,\\tilde{c}$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.\n\nC. Restrict the entropy fix to the acoustic fields and tie it to proximity to the preconditioned sonic condition: for $k \\in \\{+,-\\}$ set $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,\\tilde{c} - \\lvert u_n \\rvert\\big)$ with $\\kappa \\in (0,1)$, and set $\\delta_k = 0$ for the convective fields; use a Lipschitz continuous entropy replacement for the acoustic magnitudes only.\n\nD. Use the normal velocity magnitude for all fields: set $\\delta_k = \\kappa\\,\\lvert u_n \\rvert$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.\n\nE. Trigger the entropy fix for the acoustic fields based on the unpreconditioned sonic condition: for $k \\in \\{+,-\\}$ set $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,c - \\lvert u_n \\rvert\\big)$ with $\\kappa \\in (0,1)$, and set $\\delta_k = 0$ for the convective fields; use a Lipschitz continuous entropy replacement for the acoustic magnitudes only.\n\nSelect all that apply.",
            "solution": "The problem statement is first validated to ensure its scientific and logical integrity before a solution is attempted.\n\n### Step 1: Extract Givens\n\n-   **Governing Equations**: Inviscid Euler equations in conservative form, $\\partial_t \\mathbf{U} + \\nabla \\cdot \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$.\n-   **Numerical Method**: Roe-type approximate Riemann solver.\n-   **Key Operators**: Normal flux Jacobian $\\mathbf{A}_n = \\partial \\mathbf{F}_n / \\partial \\mathbf{U}$, where $\\mathbf{F}_n = \\mathbf{F}(\\mathbf{U}) \\cdot \\mathbf{n}$.\n-   **Flow Regime**: Low-Mach number, $M = \\lvert \\mathbf{u} \\rvert / c \\ll 1$.\n-   **Preconditioning**: A matrix $\\mathbf{P}(M)$ is used, modifying the operator to $\\mathbf{P}^{-1}\\mathbf{A}_n$.\n-   **Eigenstructure of $\\mathbf{P}^{-1}\\mathbf{A}_n$**:\n    -   Acoustic eigenvalues: $\\lambda_{\\pm} = u_n \\pm \\tilde{c}$.\n    -   Convective eigenvalues: $u_n$ (possibly with multiplicity).\n-   **Variable Definitions**:\n    -   $u_n = \\mathbf{u} \\cdot \\mathbf{n}$ is the normal velocity.\n    -   $c$ is the physical speed of sound.\n    -   $\\tilde{c} = \\phi(M)\\,c$ is the preconditioned acoustic speed.\n-   **Asymptotic Behavior**: $\\phi(M) \\sim M$ as $M \\to 0$. This implies $\\tilde{c} = \\mathcal{O}(Mc)$ and $u_n = \\mathcal{O}(Mc)$ for low Mach number flows.\n-   **Entropy Fix**: Replaces eigenvalue magnitude $\\lvert \\lambda_k \\rvert$ with a Lipschitz-continuous corrected magnitude $\\lvert \\lambda_k \\rvert_e$ using a threshold parameter $\\delta_k$. The added dissipation is of order $\\delta_k$.\n-   **Problem with Classical Fix**: Setting $\\delta_k \\propto c$ overdamps convective modes whose dynamics scale with $u_n = \\mathcal{O}(Mc)$.\n-   **Goals for a valid preconditioned entropy fix**:\n    -   $(\\mathrm{G1})$: Activates when $\\lvert u_n \\rvert \\approx \\tilde{c}$ (preconditioned sonic condition).\n    -   $(\\mathrm{G2})$: Avoids adding artificial dissipation to convective modes that is not asymptotically negligible as $M \\to 0$.\n    -   $(\\mathrm{G3})$: Preserves Lipschitz continuity and does not alter wave speed signs.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is analyzed for validity.\n\n-   **Scientific Grounding**: The problem is well-grounded in the established theory of computational fluid dynamics, specifically concerning numerical methods for all-speed compressible flows. The concepts of low-Mach preconditioning, Roe solvers, characteristic decomposition, and entropy fixes are standard topics in advanced numerical analysis for PDEs. The described issue of eigenvalue stiffness and the need for scaled dissipation is a central challenge in this field.\n-   **Well-Posedness**: The problem is well-posed. It presents a clear set of criteria (G1, G2, G3) and asks for an evaluation of several specific mathematical forms against these criteria. The analysis required is based on asymptotic scaling and logical deduction, leading to a unique conclusion.\n-   **Objectivity**: The problem is stated using precise, objective, and standard terminology from the field of CFD. The goals are unambiguous.\n-   **Completeness and Consistency**: The problem statement provides all necessary information concerning the eigenstructure of the preconditioned system and the asymptotic scaling of the relevant quantities ($u_n$, $c$, $\\tilde{c}$) at low Mach numbers. There are no internal contradictions.\n-   **Other Flaws**: The problem is not unrealistic, ill-posed, trivial, or unverifiable. It represents a genuine and non-trivial aspect of numerical algorithm design.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. A solution will be derived by analyzing the proposed options against the stated goals.\n\n### Solution and Option Analysis\n\nThe core of the problem lies in the disparity of scales at low Mach numbers ($M \\ll 1$). The physical sound speed $c$ is an $\\mathcal{O}(1)$ quantity (in appropriate non-dimensionalization), while the material velocity $u_n$ and the preconditioned sound speed $\\tilde{c}$ both scale with the Mach number, i.e., $u_n, \\tilde{c} = \\mathcal{O}(M)$. The goal of an entropy fix is to add numerical dissipation selectively at \"sonic points\" where an eigenvalue $\\lambda_k$ approaches zero, to prevent the formation of expansion shocks. In the preconditioned system, the sonic points for the acoustic waves are at $\\lvert u_n \\rvert \\approx \\tilde{c}$, and the sonic point for the convective waves is at $u_n \\approx 0$. The added dissipation must be scaled appropriately for each wave family.\n\nWe now evaluate each option against goals (G1), (G2), and (G3).\n\n**A. Use the unpreconditioned speed of sound for all fields: set $\\delta_k = \\kappa\\,c$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.**\n\n-   **Analysis**: This approach uses a threshold $\\delta_k$ of order $\\mathcal{O}(c)$.\n    -   **For acoustic fields ($\\lambda_{\\pm} = u_n \\pm \\tilde{c}$)**: The eigenvalues have magnitude $\\mathcal{O}(Mc)$. The threshold is $\\delta_{\\pm}=\\kappa c = \\mathcal{O}(c)$. Since $Mc \\ll c$, the condition for activating the fix, $\\lvert \\lambda_{\\pm} \\rvert < \\delta_{\\pm}$, is always satisfied at low Mach numbers, regardless of proximity to the preconditioned sonic point $\\lvert u_n \\rvert \\approx \\tilde{c}$. This violates **(G1)**, as the fix is not targeted.\n    -   **For convective fields ($\\lambda_{conv} = u_n$)**: The eigenvalue has magnitude $\\mathcal{O}(Mc)$. The added dissipation is of order $\\delta_{conv} = \\kappa c = \\mathcal{O}(c)$. This dissipation scale is much larger than the physical wave speed scale, $\\mathcal{O}(c) \\gg \\mathcal{O}(Mc)$. This results in massive, unphysical damping of vortical and shear phenomena, exactly the problem the prompt warns against. This violates **(G2)**.\n-   **Verdict**: **Incorrect**.\n\n**B. Use the preconditioned acoustic speed for all fields: set $\\delta_k = \\kappa\\,\\tilde{c}$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.**\n\n-   **Analysis**: This approach uses a threshold $\\delta_k$ of order $\\mathcal{O}(\\tilde{c}) = \\mathcal{O}(Mc)$.\n    -   **For acoustic fields ($\\lambda_{\\pm} = u_n \\pm \\tilde{c}$)**: The threshold $\\delta_{\\pm} = \\kappa \\tilde{c}$ correctly scales with the eigenvalues. The fix activates when $\\lvert u_n \\pm \\tilde{c} \\rvert < \\kappa \\tilde{c}$, which correctly targets the region near the preconditioned sonic point $\\lvert u_n \\rvert \\approx \\tilde{c}$. This satisfies **(G1)**.\n    -   **For convective fields ($\\lambda_{conv} = u_n$)**: The threshold is $\\delta_{conv} = \\kappa \\tilde{c} = \\mathcal{O}(Mc)$. The added dissipation is therefore also of order $\\mathcal{O}(Mc)$. The convective eigenvalue $u_n$ is itself of order $\\mathcal{O}(Mc)$. Adding dissipation of the same order as the wave speed itself is not \"asymptotically negligible\". It fundamentally alters the convective dynamics and is a significant source of artificial viscosity for the vortical modes. This violates **(G2)**.\n-   **Verdict**: **Incorrect**.\n\n**C. Restrict the entropy fix to the acoustic fields and tie it to proximity to the preconditioned sonic condition: for $k \\in \\{+,-\\}$ set $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,\\tilde{c} - \\lvert u_n \\rvert\\big)$ with $\\kappa \\in (0,1)$, and set $\\delta_k = 0$ for the convective fields; use a Lipschitz continuous entropy replacement for the acoustic magnitudes only.**\n\n-   **Analysis**: This is a multi-part strategy.\n    -   **For acoustic fields**: The threshold is $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,\\tilde{c} - \\lvert u_n \\rvert\\big)$. This form, often called a pressure-difference switch (or its velocity-based equivalent), makes the threshold $\\delta_{\\pm}$ non-zero only in the subsonic region $\\lvert u_n \\rvert < \\tilde{c}$. The threshold smoothly goes to zero as the flow approaches the preconditioned sonic point from below. This form is explicitly designed to target the region where transonic rarefactions can form, perfectly aligning with the condition $\\lvert u_n \\rvert \\approx \\tilde{c}$. This satisfies **(G1)**.\n    -   **For convective fields**: The threshold is explicitly set to $\\delta_k = 0$. This means no entropy fix is applied, and no artificial dissipation is added to these modes. This is the most direct and effective way to satisfy **(G2)**. This is physically motivated, as the convective fields are linearly degenerate and do not support shock waves, making an entropy fix less critical compared to the genuinely non-linear acoustic fields.\n    -   **Lipschitz continuity**: The function $\\max(0, x)$ is Lipschitz continuous. Since $\\tilde{c}$ and $\\lvert u_n \\rvert$ are well-behaved functions of the flow variables (for a proper preconditioner), $\\delta_{\\pm}$ is also Lipschitz continuous. This satisfies **(G3)**.\n-   **Verdict**: **Correct**.\n\n**D. Use the normal velocity magnitude for all fields: set $\\delta_k = \\kappa\\,\\lvert u_n \\rvert$ with a constant $\\kappa \\in (0,1)$, applied identically to all characteristic fields, including the convective fields.**\n\n-   **Analysis**: This approach uses a threshold $\\delta_k$ proportional to $\\lvert u_n \\rvert$.\n    -   **For acoustic fields**: The fix activates when $\\lvert u_n \\pm \\tilde{c} \\rvert < \\kappa \\lvert u_n \\rvert$. This condition is satisfied near the sonic points $\\lvert u_n \\rvert \\approx \\tilde{c}$, so it appears to satisfy **(G1)**.\n    -   **For convective fields**: The threshold is $\\delta_{conv} = \\kappa \\lvert u_n \\rvert$. The activation condition is $\\lvert \\lambda_{conv} \\rvert < \\delta_{conv}$, which translates to $\\lvert u_n \\rvert < \\kappa \\lvert u_n \\rvert$. For $\\kappa \\in (0,1)$, this inequality is never satisfied for $u_n \\neq 0$. Thus, the entropy fix is never applied to the convective modes, except at the singular point $u_n=0$, where $\\delta_{conv}=0$. A fix that is never active fails to serve its purpose. Furthermore, a threshold that vanishes at the sonic point ($u_n=0$) is conceptually flawed, as it provides no dissipation where it is most needed. This formulation is ill-conceived and fails to provide a robust fix, thereby violating the implicit requirements of an entropy correction and failing to properly handle the convective modes as per **(G2)**. If we interpret (G2) as strictly \"avoiding contamination\", then adding zero dissipation satisfies it, but the option is nonsensical as a whole. More critically, as $u_n \\to 0$, the threshold $\\delta_k \\to 0$. Any entropy fix model, like Harten's ($\\psi(\\lambda, \\delta) = (\\lambda^2+\\delta^2)/(2\\delta)$), would become singular or ill-defined as $\\delta \\to 0$, violating **(G3)**.\n-   **Verdict**: **Incorrect**.\n\n**E. Trigger the entropy fix for the acoustic fields based on the unpreconditioned sonic condition: for $k \\in \\{+,-\\}$ set $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,c - \\lvert u_n \\rvert\\big)$ with $\\kappa \\in (0,1)$, and set $\\delta_k = 0$ for the convective fields; use a Lipschitz continuous entropy replacement for the acoustic magnitudes only.**\n\n-   **Analysis**: This option correctly isolates the fix to the acoustic fields, satisfying **(G2)**.\n    -   **For acoustic fields**: The threshold is $\\delta_{\\pm} = \\kappa\\,\\max\\!\\big(0,\\,c - \\lvert u_n \\rvert\\big)$. This fix is designed to activate near the physical sonic point, $\\lvert u_n \\rvert \\approx c$. However, the preconditioned problem requires a fix near the preconditioned sonic point, $\\lvert u_n \\rvert \\approx \\tilde{c}$. At low Mach numbers, $\\lvert u_n \\rvert \\ll c$, so the switch gives $\\delta_{\\pm} \\approx \\kappa c$. This leads to the same problem as Option A: the dissipation scale is $\\mathcal{O}(c)$, which is far too large for the preconditioned acoustic waves of speed $\\mathcal{O}(Mc)$. This catastrophically violates **(G1)**.\n-   **Verdict**: **Incorrect**.\n\nIn summary, only option C successfully meets all three required criteria by correctly scaling the dissipation for the acoustic waves according to the preconditioned dynamics and by completely avoiding artificial dissipation on the convective waves.",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}