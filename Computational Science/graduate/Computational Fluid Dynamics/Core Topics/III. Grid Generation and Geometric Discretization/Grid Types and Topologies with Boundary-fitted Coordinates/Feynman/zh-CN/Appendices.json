{
    "hands_on_practices": [
        {
            "introduction": "在进行任何计算流体动力学（CFD）模拟之前，首要任务是确保计算网格的有效性。一个包含翻转或扭曲单元的网格将导致计算发散或产生无意义的结果。本练习将指导您如何通过计算雅可比行列式（Jacobian determinant）和有向单元面积/体积，以编程方式检测这些常见的网格质量问题，并应用一种基本的修正技术——拉普拉斯平滑（Laplacian smoothing）来修复无效的网格单元 。",
            "id": "3327949",
            "problem": "给定一个二维边界拟合结构化网格映射和一组非结构化三维四面体单元。您的任务是使用雅可比行列式和定向面矢量来实现网格扭曲和翻转（负体积）单元的检测，并对结构化网格应用一种修正性光滑准则。目标是展示基于原理的检测方法，并在一致的接受规则下量化平滑处理的效果。\n\n需使用的基本原理和定义：\n\n- 考虑一个从计算坐标 $(\\xi,\\eta)\\in[0,1]^2$ 到物理坐标 $(x,y)$ 的光滑边界拟合映射，其中 $x=x(\\xi,\\eta)$ 且 $y=y(\\xi,\\eta)$。雅可比行列式 $J$ 定义为从 $(\\xi,\\eta)$ 到 $(x,y)$ 的变换导数张量的行列式，即 $J = \\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$。\n\n- 对于一个具有顶点 $\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3,\\mathbf{v}_4\\in\\mathbb{R}^3$ 的三维非结构化四面体单元，其定向面矢量定义为 $\\mathbf{A}_f = \\int_f \\mathbf{n}\\,dA$，其中 $f$ 为每个面，$\\mathbf{n}$ 是外向き单位法向量，$A$ 是面面积。定向单元体积可以用定向面矢量表示，对于四面体，等效地可以通过边向量的定向标量三重积表示。\n\n- 在结构化边界拟合网格中，网格扭曲与 $J$ 值过小或变化剧烈相关，当 $J \\le 0$ 或单元的定向面积相对于预期方向变为负值时，会发生翻转。\n\n您的程序必须：\n\n1. 对于结构化二维网格，使用单位正方形计算域上的边界拟合映射，通过以下带有扰动参数 $(a,b)$ 的映射族来构建物理节点坐标：\n   - $x(\\xi,\\eta) = \\xi + a \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$。\n   - $y(\\xi,\\eta) = \\eta + b \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$。\n   计算网格是一个包含 $(n_x\\times n_y)$ 个节点的直角网格，具有均匀间距 $\\Delta \\xi = 1/(n_x-1)$ 和 $\\Delta \\eta = 1/(n_y-1)$。\n\n2. 使用基于物理空间中相邻节点坐标的一致性有限差分近似来计算 $\\partial x/\\partial \\xi$、$\\partial x/\\partial \\eta$、$\\partial y/\\partial \\xi$ 和 $\\partial y/\\partial \\eta$，从而在每个单元中心计算离散的雅可比行列式 $J$。报告网格中所有单元的 $J$ 的最小值。\n\n3. 通过计算物理空间中每个四边形单元多边形的定向面积，并检查其相对于字典序节点排序 $(i,j)\\to(i+1,j)\\to(i+1,j+1)\\to(i,j+1)$ 的符号，来检测翻转的四边形单元。负的定向面积被认为是翻转。返回一个布尔值，指示是否存在任何此类翻转单元。\n\n4. 对结构化网格应用修正性平滑，采用对物理空间中的内部节点进行拉普拉斯平滑的松弛形式。对于每次迭代，将内部节点坐标 $(x_{i,j},y_{i,j})$ 更新为\n   $$\\mathbf{p}_{i,j}^{\\text{new}} = \\mathbf{p}_{i,j}^{\\text{old}} + \\omega\\left(\\frac{\\mathbf{p}_{i+1,j}+\\mathbf{p}_{i-1,j}+\\mathbf{p}_{i,j+1}+\\mathbf{p}_{i,j-1}}{4} - \\mathbf{p}_{i,j}^{\\text{old}}\\right),$$\n   其中 $\\omega\\in(0,1)$ 是一个松弛参数，$\\mathbf{p}_{i,j}=(x_{i,j},y_{i,j})$。边界节点是固定的，不进行平滑。每次迭代后，重新评估离散雅可比行列式和定向面积。停止的接受准则是：\n   - $J_{\\min} \\ge \\varepsilon$ 且没有负面积单元，\n   其中 $\\varepsilon>0$ 是一个小的目标阈值。如果在最大迭代次数后仍未满足接受准则，则声明失败并报告迭代次数为 $-1$。\n\n5. 对于非结构化四面体单元，使用边向量的标量三重积计算定向体积。给定顶点 $\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3,\\mathbf{v}_4$，定义：\n   $$V_{\\text{tet}} = \\frac{1}{6}\\left[\\left(\\mathbf{v}_2-\\mathbf{v}_1\\right)\\cdot\\left(\\left(\\mathbf{v}_3-\\mathbf{v}_1\\right)\\times\\left(\\mathbf{v}_4-\\mathbf{v}_1\\right)\\right)\\right].$$\n   负值表示翻转的方向。返回定向体积和一个指示其是否为 $V_{\\text{tet}}  0$ 的布尔值。\n\n测试套件：\n\n- 结构化网格案例使用 $(n_x,n_y)=(33,33)$，松弛参数 $\\omega=0.5$，阈值 $\\varepsilon=0.05$，以及最大迭代次数 $N_{\\max}=25$。\n  1. 案例 S1（正常情况）：$(a,b)=(0.05,0.02)$。\n  2. 案例 S2（强扭曲/翻转）：$(a,b)=(0.20,0.00)$。\n  3. 案例 S3（近退化边界情况）：$(a,b)=(0.159,0.00)$。\n\n- 非结构化四面体案例：\n  4. 案例 T1（正向）：$\\mathbf{v}_1=(0,0,0)$, $\\mathbf{v}_2=(1,0,0)$, $\\mathbf{v}_3=(0,1,0)$, $\\mathbf{v}_4=(0,0,1)$。\n  5. 案例 T2（因顶点顺序导致的负向）：$\\mathbf{v}_1=(0,0,0)$, $\\mathbf{v}_2=(0,1,0)$, $\\mathbf{v}_3=(1,0,0)$, $\\mathbf{v}_4=(0,0,1)$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。该列表必须按顺序包括：\n\n- 对于每个结构化案例 S1–S3：最小离散雅可比行列式 $J_{\\min}$（浮点数），一个指示平滑前是否存在任何负面积单元的布尔值，以及满足接受准则所需的平滑迭代次数（整数）（如果未达到则为 $-1$）。\n- 对于每个四面体案例 T1–T2：定向体积 $V_{\\text{tet}}$（浮点数）和一个指示是否 $V_{\\text{tet}}  0$ 的布尔值。\n\n示例格式（仅结构，非实际数值）：“[Jmin_S1,negArea_S1,iters_S1,Jmin_S2,negArea_S2,iters_S2,Jmin_S3,negArea_S3,iters_S3,V_T1,neg_T1,V_T2,neg_T2]”。\n\n所有角度测量单位均为弧度。由于计算在归一化域中是无量纲的，因此没有物理单位。请确保程序使用指定的参数并按所描述的精确格式生成输出。",
            "solution": "所给定的问题要求验证计算网格的质量，既包括结构化二维网格，也包括非结构化三维单元。核心任务是检测网格扭曲和单元翻转，并对结构化网格应用修正性平滑程序。该分析基于矢量微积分和计算流体动力学（CFD）中常用的数值方法的基本原理。\n\n首先，对于结构化网格，我们必须构建物理网格，然后分析其质量。物理网格坐标 $(x,y)$ 是通过在 $(\\xi,\\eta) \\in [0,1]^2$ 中的均匀计算网格上使用所提供的边界拟合映射生成的：\n$$x(\\xi,\\eta) = \\xi + a \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$$\n$$y(\\xi,\\eta) = \\eta + b \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$$\n计算域被离散化为一个 $(n_x \\times n_y)$ 个节点的网格，具有均匀间距 $\\Delta\\xi = 1/(n_x-1)$ 和 $\\Delta\\eta = 1/(n_y-1)$。\n\n局部网格质量的主要度量是变换的雅可比行列式，$J = \\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$。$J \\le 0$ 的值表示局部翻转或退化的单元。我们使用二阶精确的中心有限差分在每个四边形单元 $(i,j)$ 的中心计算 $J$ 的离散近似。对于像 $\\frac{\\partial x}{\\partial \\xi}$ 在单元中心 $(\\xi_{i+1/2}, \\eta_{j+1/2})$ 的导数，我们使用单元四个顶点（索引从 $(i,j)$ 到 $(i+1,j+1)$）的值：\n$$ \\frac{\\partial x}{\\partial \\xi} \\approx \\frac{(x_{i+1,j+1} + x_{i+1,j}) - (x_{i,j+1} + x_{i,j})}{2\\Delta\\xi} $$\n$$ \\frac{\\partial x}{\\partial \\eta} \\approx \\frac{(x_{i+1,j+1} + x_{i,j+1}) - (x_{i+1,j} + x_{i,j})}{2\\Delta\\eta} $$\n类似的公式适用于 $\\frac{\\partial y}{\\partial \\xi}$ 和 $\\frac{\\partial y}{\\partial \\eta}$。有了这些，离散雅可比行列式计算为 $J_{i,j} = \\frac{\\partial x}{\\partial \\xi}\\frac{\\partial y}{\\partial \\eta} - \\frac{\\partial x}{\\partial \\eta}\\frac{\\partial y}{\\partial \\xi}$。然后我们找到所有单元中的最小值 $J_{\\min}$。\n\n单元翻转也可通过计算每个四边形单元的定向面积来检测。对于一个具有有序顶点 $\\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3, \\mathbf{p}_4$ 的单元，其有向面积可以通过其对角线 $\\mathbf{d}_1 = \\mathbf{p}_3 - \\mathbf{p}_1$ 和 $\\mathbf{d}_2 = \\mathbf{p}_4 - \\mathbf{p}_2$ 的叉积来计算。对于指定的顶点排序 $(i,j) \\to (i+1,j) \\to (i+1,j+1) \\to (i,j+1)$，面积计算如下：\n$$ A = \\frac{1}{2} \\left[ (x_{i+1,j+1}-x_{i,j})(y_{i,j+1}-y_{i+1,j}) - (y_{i+1,j+1}-y_{i,j})(x_{i,j+1}-x_{i+1,j}) \\right] $$\n负面积 $A  0$ 表示单元在物理空间中的方向相对于其在计算空间中的方向是翻转的，这标志着一次翻转。\n\n如果网格质量不合格（$J_{\\min}  \\varepsilon$ 或任何单元面积为负），我们应用修正性平滑程序。拉普拉斯平滑是一种迭代方法，它将每个内部节点的位置调整为其四个邻居的平均位置。带有松弛参数 $\\omega$ 的更新规则是：\n$$ \\mathbf{p}_{i,j}^{\\text{new}} = \\mathbf{p}_{i,j}^{\\text{old}} + \\omega\\left(\\frac{\\mathbf{p}_{i+1,j}+\\mathbf{p}_{i-1,j}+\\mathbf{p}_{i,j+1}+\\mathbf{p}_{i,j-1}}{4} - \\mathbf{p}_{i,j}^{\\text{old}}\\right) $$\n其中 $\\mathbf{p}_{i,j}=(x_{i,j},y_{i,j})$。边界节点保持固定。每次迭代后，我们重新评估 $J_{\\min}$ 并检查负面积单元。当满足接受准则（$J_{\\min} \\ge \\varepsilon$ 且无负面积单元）或达到最大迭代次数 $N_{\\max}$ 时，过程停止。\n\n对于非结构化四面体单元，质量检查涉及计算定向体积。给定一个具有顶点 $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3, \\mathbf{v}_4$ 的四面体，其定向体积由从一个公共顶点（例如 $\\mathbf{v}_1$）出发的边向量的标量三重积的六分之一给出：\n$$ V_{\\text{tet}} = \\frac{1}{6}\\left[ (\\mathbf{v}_2-\\mathbf{v}_1) \\cdot \\left( (\\mathbf{v}_3-\\mathbf{v}_1) \\times (\\mathbf{v}_4-\\mathbf{v}_1) \\right) \\right] $$\n$V_{\\text{tet}}$ 的符号取决于顶点的排序。负体积表示该四面体的定向与由边向量定义的右手坐标系相反，标志着一个翻转的元素。\n\n实现将这些原理封装在一系列函数中。一个函数生成初始的结构化网格坐标。第二个函数计算所有单元的离散雅可比行列式和定向面积。第三个函数实现迭代平滑循环。对于非结构化情况，一个专门的函数计算四面体体积。主程序执行指定的测试用例，收集结果，并将其格式化为所需的输出字符串。所有向量和矩阵运算均使用 `numpy` 库高效执行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_grid(nx, ny, a, b):\n    \"\"\"\n    Generates a 2D structured grid based on the given mapping.\n    \"\"\"\n    xi_1d = np.linspace(0, 1, nx)\n    eta_1d = np.linspace(0, 1, ny)\n    xi, eta = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n    x = xi + a * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n    y = eta + b * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n    return x, y\n\ndef calculate_metrics(x_coords, y_coords):\n    \"\"\"\n    Computes the minimum Jacobian and checks for negative area cells.\n    \"\"\"\n    nx, ny = x_coords.shape\n    delta_xi = 1.0 / (nx - 1)\n    delta_eta = 1.0 / (ny - 1)\n\n    # --- Jacobian calculation at cell centers ---\n    x_xi_num = (x_coords[1:, 1:] + x_coords[1:, :-1]) - (x_coords[:-1, 1:] + x_coords[:-1, :-1])\n    dx_dxi = x_xi_num / (2 * delta_xi)\n\n    x_eta_num = (x_coords[1:, 1:] + x_coords[:-1, 1:]) - (x_coords[1:, :-1] + x_coords[:-1, :-1])\n    dx_deta = x_eta_num / (2 * delta_eta)\n\n    y_xi_num = (y_coords[1:, 1:] + y_coords[1:, :-1]) - (y_coords[:-1, 1:] + y_coords[:-1, :-1])\n    dy_dxi = y_xi_num / (2 * delta_xi)\n\n    y_eta_num = (y_coords[1:, 1:] + y_coords[:-1, 1:]) - (y_coords[1:, :-1] + y_coords[:-1, :-1])\n    dy_deta = y_eta_num / (2 * delta_eta)\n\n    jacobians = dx_dxi * dy_deta - dx_deta * dy_dxi\n    min_jacobian = np.min(jacobians)\n\n    # --- Oriented area calculation ---\n    d1_x = x_coords[1:, 1:] - x_coords[:-1, :-1]\n    d1_y = y_coords[1:, 1:] - y_coords[:-1, :-1]\n    d2_x = x_coords[:-1, 1:] - x_coords[1:, :-1]\n    d2_y = y_coords[:-1, 1:] - y_coords[1:, :-1]\n    \n    areas = 0.5 * (d1_x * d2_y - d1_y * d2_x)\n    has_negative_area = np.any(areas  0)\n\n    return min_jacobian, has_negative_area\n\ndef smooth_grid(x_coords, y_coords, omega, epsilon, n_max):\n    \"\"\"\n    Applies Laplacian smoothing to the grid and returns iteration count.\n    \"\"\"\n    x_smooth = np.copy(x_coords)\n    y_smooth = np.copy(y_coords)\n    \n    for i in range(n_max):\n        x_old = np.copy(x_smooth)\n        y_old = np.copy(y_smooth)\n\n        avg_x = (x_old[2:, 1:-1] + x_old[:-2, 1:-1] + x_old[1:-1, 2:] + x_old[1:-1, :-2]) / 4.0\n        x_smooth[1:-1, 1:-1] += omega * (avg_x - x_old[1:-1, 1:-1])\n\n        avg_y = (y_old[2:, 1:-1] + y_old[:-2, 1:-1] + y_old[1:-1, 2:] + y_old[1:-1, :-2]) / 4.0\n        y_smooth[1:-1, 1:-1] += omega * (avg_y - y_old[1:-1, 1:-1])\n        \n        min_j, has_neg_area = calculate_metrics(x_smooth, y_smooth)\n        \n        if min_j = epsilon and not has_neg_area:\n            return i + 1\n            \n    return -1\n\ndef solve_structured_case(params):\n    \"\"\"\n    Solves a single structured grid case.\n    \"\"\"\n    nx, ny, a, b, omega, epsilon, n_max = params\n    x_coords, y_coords = generate_grid(nx, ny, a, b)\n    \n    min_j_initial, has_neg_area_initial = calculate_metrics(x_coords, y_coords)\n\n    if min_j_initial = epsilon and not has_neg_area_initial:\n        iterations = 0\n    else:\n        iterations = smooth_grid(x_coords, y_coords, omega, epsilon, n_max)\n\n    return min_j_initial, has_neg_area_initial, iterations\n\ndef calculate_tetra_volume(v1, v2, v3, v4):\n    \"\"\"\n    Calculates the oriented volume of a tetrahedron.\n    \"\"\"\n    v1, v2, v3, v4 = np.array(v1), np.array(v2), np.array(v3), np.array(v4)\n    \n    e1 = v2 - v1\n    e2 = v3 - v1\n    e3 = v4 - v1\n    \n    scalar_triple_product = np.dot(e1, np.cross(e2, e3))\n    \n    volume = scalar_triple_product / 6.0\n    is_negative = volume  0\n    \n    return volume, is_negative\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Structured grid cases\n    nx, ny = 33, 33\n    omega = 0.5\n    epsilon = 0.05\n    n_max = 25\n    \n    structured_cases = [\n        # S1: (a,b)=(0.05,0.02)\n        (nx, ny, 0.05, 0.02, omega, epsilon, n_max),\n        # S2: (a,b)=(0.20,0.00)\n        (nx, ny, 0.20, 0.00, omega, epsilon, n_max),\n        # S3: (a,b)=(0.159,0.00)\n        (nx, ny, 0.159, 0.00, omega, epsilon, n_max),\n    ]\n\n    # Unstructured tetrahedral cases\n    unstructured_cases = [\n        # T1\n        {'v1':(0,0,0), 'v2':(1,0,0), 'v3':(0,1,0), 'v4':(0,0,1)},\n        # T2\n        {'v1':(0,0,0), 'v2':(0,1,0), 'v3':(1,0,0), 'v4':(0,0,1)},\n    ]\n\n    results = []\n    \n    # Process structured cases\n    for params in structured_cases:\n        j_min, neg_area, iters = solve_structured_case(params)\n        results.extend([j_min, neg_area, iters])\n\n    # Process unstructured cases\n    for case in unstructured_cases:\n        vol, is_neg = calculate_tetra_volume(**case)\n        results.extend([vol, is_neg])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个有效的网格如果质量不佳，例如存在显著的非正交性，同样会引入数值误差，尤其是在梯度较大的壁面附近。本练习将引导您完成一个解析推导，以量化壁面处的网格非正交性如何直接影响关键工程量——壁面剪切应力（wall shear stress）的计算精度 。通过这个过程，您将深刻理解网格质量与模拟准确性之间的直接联系。",
            "id": "3327938",
            "problem": "考虑一个二维不可压缩牛顿流体在近壁区域，该区域使用边界贴体坐标在混合网格上进行离散，此网格在平行于壁面的方向上是结构化的，在垂直于壁面的方向上是非结构化的。在计算流体动力学 (CFD) 中，一致的壁面法向扩散通量计算对于精确的粘性应力计算至关重要。在完全边界正交的网格中，计算坐标线与壁面的物理切向和法向重合。在非正交网格中，近壁控制体的面法向可能与真实的物理法向不重合，这会给壁面法向通量引入交叉扩散贡献。\n\n从动力粘度为 $\\mu$ 的牛顿流体的粘性应力定律 $\\boldsymbol{\\tau}=\\mu\\left(\\nabla \\boldsymbol{u}+(\\nabla \\boldsymbol{u})^{\\top}\\right)$ 出发，并利用方向导数作为 $\\nabla(\\cdot)$ 在单位方向上投影的几何定义，推导当切向速度的壁面法向导数被一个与真实物理法线存在 $\\theta$ 角度偏差的计算面法向上的导数近似时，壁面剪切应力误差的主阶表达式。假设在壁面处存在一个由切向 $\\boldsymbol{t}$ 和法向 $\\boldsymbol{n}$ 定义的局部标准正交标架，并且计算面法向单位向量 $\\boldsymbol{\\hat{n}}$ 是通过将 $\\boldsymbol{n}$ 在壁面平面内朝 $\\boldsymbol{t}$ 方向旋转角度 $\\theta$ 得到的。在物理上标准的无滑移边界条件和近壁速度场光滑性的假设下进行推导。\n\n然后，对于一个具体案例，其中动力粘度 $\\mu=1.8\\times 10^{-5}\\ \\text{kg}\\ \\text{m}^{-1}\\ \\text{s}^{-1}$，真实的切向速度壁面法向梯度为 $\\partial u_{t}/\\partial n = 500\\ \\text{s}^{-1}$，切向导数为 $\\partial u_{t}/\\partial s = 4000\\ \\text{s}^{-1}$，偏差角为 $\\theta=5^{\\circ}$，计算因使用计算面法向导数代替真实壁面法向导数而引起的壁面剪切应力的绝对误差。所有三角函数均使用弧度制进行计算，并将最终数值答案四舍五入至四位有效数字。最终答案以帕斯卡 (Pa) 为单位表示。",
            "solution": "该问题要求得到两个结果：首先，推导由于网格非正交性引起的壁面剪切应力误差的主阶表达式；其次，针对一个具体案例计算该误差的绝对值。\n\n### 第一部分：误差表达式的推导\n\n对于动力粘度为 $\\mu$ 的不可压缩牛顿流体，其粘性应力张量 $\\boldsymbol{\\tau}$ 由下式给出：\n$$ \\boldsymbol{\\tau} = \\mu \\left( \\nabla \\boldsymbol{u} + (\\nabla \\boldsymbol{u})^{\\top} \\right) $$\n其中 $\\boldsymbol{u}$ 是速度矢量。\n\n壁面剪切应力 $\\tau_w$ 是流体作用在壁面单位面积上的粘性力的切向分量。这也就是在壁面处计算的牵引力矢量 $\\boldsymbol{\\tau} \\cdot \\boldsymbol{n}$ 的切向分量，其中 $\\boldsymbol{n}$ 是指向流体内部的壁面单位法向量。\n$$ \\tau_w = (\\boldsymbol{\\tau} \\cdot \\boldsymbol{n}) \\cdot \\boldsymbol{t} \\big|_{\\text{wall}} $$\n其中 $\\boldsymbol{t}$ 是壁面的单位切向量。\n\n我们建立一个局部的二维笛卡尔坐标系，其中壁面为直线 $y=0$。切向对应于 $x$ 轴 ($\\boldsymbol{t}$)，法向对应于 $y$ 轴 ($\\boldsymbol{n}$)。速度矢量为 $\\boldsymbol{u} = u_t \\boldsymbol{t} + u_n \\boldsymbol{n}$。坐标 $s$ 沿着 $\\boldsymbol{t}$ 方向，$n$ 沿着 $\\boldsymbol{n}$ 方向。因此，$\\partial/\\partial s$ 是沿 $\\boldsymbol{t}$ 的导数，$\\partial/\\partial n$ 是沿 $\\boldsymbol{n}$ 的导数。\n\n在此标架下，速度梯度张量为：\n$$ \\nabla \\boldsymbol{u} = \\begin{pmatrix} \\frac{\\partial u_t}{\\partial s}  \\frac{\\partial u_t}{\\partial n} \\\\ \\frac{\\partial u_n}{\\partial s}  \\frac{\\partial u_n}{\\partial n} \\end{pmatrix} $$\n应力张量的分量为：\n$$ \\boldsymbol{\\tau} = \\mu \\begin{pmatrix} 2\\frac{\\partial u_t}{\\partial s}  \\frac{\\partial u_t}{\\partial n} + \\frac{\\partial u_n}{\\partial s} \\\\ \\frac{\\partial u_t}{\\partial n} + \\frac{\\partial u_n}{\\partial s}  2\\frac{\\partial u_n}{\\partial n} \\end{pmatrix} $$\n壁面上的牵引力矢量为 $\\boldsymbol{\\tau} \\cdot \\boldsymbol{n}$，可得：\n$$ \\boldsymbol{\\tau} \\cdot \\boldsymbol{n} = \\mu \\begin{pmatrix} \\frac{\\partial u_t}{\\partial n} + \\frac{\\partial u_n}{\\partial s} \\\\ 2\\frac{\\partial u_n}{\\partial n} \\end{pmatrix} $$\n真实的壁面剪切应力 $\\tau_{w, \\text{true}}$ 是该矢量的切向分量：\n$$ \\tau_{w, \\text{true}} = \\mu \\left( \\frac{\\partial u_t}{\\partial n} + \\frac{\\partial u_n}{\\partial s} \\right) \\bigg|_{\\text{wall}} $$\n无滑移边界条件规定壁面上所有点的速度 $\\boldsymbol{u} = \\boldsymbol{0}$。这意味着速度分量沿壁面的梯度为零，即在壁面上有 $\\frac{\\partial u_t}{\\partial s} = 0$ 和 $\\frac{\\partial u_n}{\\partial s} = 0$。不可压缩条件 $\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial u_t}{\\partial s} + \\frac{\\partial u_n}{\\partial n} = 0$ 与壁面上 $\\frac{\\partial u_t}{\\partial s}=0$ 相结合，意味着在壁面上有 $\\frac{\\partial u_n}{\\partial n}=0$。\n应用这些条件，真实壁面剪切应力的表达式简化为：\n$$ \\tau_{w, \\text{true}} = \\mu \\frac{\\partial u_t}{\\partial n} \\bigg|_{\\text{wall}} $$\n这是物理上精确的壁面剪切应力。注意，尽管壁面上的 $\\frac{\\partial u_t}{\\partial s}|_{\\text{wall}}$ 为零，但题目中给出了一个非零值。这意味着该导数并非精确地在壁面 *上* 计算，而是在离壁面一个很小的距离处计算，也即 CFD 近似计算的位置。我们将遵循 CFD 中的这种标准解释，即梯度在近壁的单元中心或面上进行评估。\n\n题目指出，壁面法向导数是使用沿一个有偏差的计算面法向单位向量 $\\boldsymbol{\\hat{n}}$ 的导数来近似的。近似的壁面剪切应力 $\\tau_{w, \\text{approx}}$ 为：\n$$ \\tau_{w, \\text{approx}} = \\mu \\frac{D u_t}{D \\hat{n}} $$\n其中 $\\frac{D u_t}{D \\hat{n}}$ 是 $u_t$ 在 $\\boldsymbol{\\hat{n}}$ 方向上的方向导数。其定义为 $\\nabla u_t \\cdot \\boldsymbol{\\hat{n}}$。\n标量场 $u_t$ 的梯度为：\n$$ \\nabla u_t = \\frac{\\partial u_t}{\\partial s} \\boldsymbol{t} + \\frac{\\partial u_t}{\\partial n} \\boldsymbol{n} $$\n向量 $\\boldsymbol{\\hat{n}}$ 是将 $\\boldsymbol{n}$ 朝 $\\boldsymbol{t}$ 方向旋转角度 $\\theta$ 得到的。在 $\\{\\boldsymbol{t}, \\boldsymbol{n}\\}$ 基下，可得：\n$$ \\boldsymbol{\\hat{n}} = \\sin\\theta \\, \\boldsymbol{t} + \\cos\\theta \\, \\boldsymbol{n} $$\n现在，我们计算方向导数：\n$$ \\frac{D u_t}{D \\hat{n}} = \\left( \\frac{\\partial u_t}{\\partial s} \\boldsymbol{t} + \\frac{\\partial u_t}{\\partial n} \\boldsymbol{n} \\right) \\cdot (\\sin\\theta \\, \\boldsymbol{t} + \\cos\\theta \\, \\boldsymbol{n}) $$\n利用基向量的标准正交性（$\\boldsymbol{t} \\cdot \\boldsymbol{t} = 1$, $\\boldsymbol{n} \\cdot \\boldsymbol{n} = 1$, $\\boldsymbol{t} \\cdot \\boldsymbol{n} = 0$）：\n$$ \\frac{D u_t}{D \\hat{n}} = \\frac{\\partial u_t}{\\partial s} \\sin\\theta + \\frac{\\partial u_t}{\\partial n} \\cos\\theta $$\n因此，近似的壁面剪切应力为：\n$$ \\tau_{w, \\text{approx}} = \\mu \\left( \\frac{\\partial u_t}{\\partial s} \\sin\\theta + \\frac{\\partial u_t}{\\partial n} \\cos\\theta \\right) $$\n误差 $\\Delta \\tau_w$ 是近似值与真实值之差：\n$$ \\Delta \\tau_w = \\tau_{w, \\text{approx}} - \\tau_{w, \\text{true}} = \\mu \\left( \\frac{\\partial u_t}{\\partial s} \\sin\\theta + \\frac{\\partial u_t}{\\partial n} \\cos\\theta \\right) - \\mu \\frac{\\partial u_t}{\\partial n} $$\n$$ \\Delta \\tau_w = \\mu \\left( \\frac{\\partial u_t}{\\partial s} \\sin\\theta + \\frac{\\partial u_t}{\\partial n} (\\cos\\theta - 1) \\right) $$\n为求误差的主阶表达式，我们对小角度 $\\theta$（以弧度为单位）使用 $\\sin\\theta$ 和 $\\cos\\theta$ 的泰勒级数展开：\n$$ \\sin\\theta = \\theta - \\frac{\\theta^3}{6} + \\mathcal{O}(\\theta^5) $$\n$$ \\cos\\theta = 1 - \\frac{\\theta^2}{2} + \\frac{\\theta^4}{24} + \\mathcal{O}(\\theta^6) \\implies \\cos\\theta - 1 = -\\frac{\\theta^2}{2} + \\mathcal{O}(\\theta^4) $$\n将这些代入误差表达式：\n$$ \\Delta \\tau_w = \\mu \\left( \\frac{\\partial u_t}{\\partial s} \\left(\\theta - \\mathcal{O}(\\theta^3)\\right) + \\frac{\\partial u_t}{\\partial n} \\left(-\\frac{\\theta^2}{2} + \\mathcal{O}(\\theta^4)\\right) \\right) $$\n$$ \\Delta \\tau_w = \\mu \\theta \\frac{\\partial u_t}{\\partial s} - \\mu \\frac{\\theta^2}{2} \\frac{\\partial u_t}{\\partial n} + \\mathcal{O}(\\theta^3) $$\n主阶项是 $\\theta$ 的最低次幂项，即第一项。因此，误差的主阶表达式为：\n$$ \\Delta \\tau_{w, \\text{LO}} = \\mu \\theta \\frac{\\partial u_t}{\\partial s} $$\n\n### 第二部分：绝对误差的数值计算\n\n题目要求我们计算给定情况下的绝对误差 $|\\Delta \\tau_w|$。为保证准确性，我们将使用上面推导出的完整误差表达式。\n$$ |\\Delta \\tau_w| = \\left| \\mu \\left( \\frac{\\partial u_t}{\\partial s} \\sin\\theta + \\frac{\\partial u_t}{\\partial n} (\\cos\\theta - 1) \\right) \\right| $$\n给定值为：\n- 动力粘度，$\\mu = 1.8 \\times 10^{-5}\\ \\text{kg}\\ \\text{m}^{-1}\\ \\text{s}^{-1}$。\n- 真实的切向速度壁面法向梯度，$\\frac{\\partial u_t}{\\partial n} = 500\\ \\text{s}^{-1}$。\n- 切向速度的切向导数，$\\frac{\\partial u_t}{\\partial s} = 4000\\ \\text{s}^{-1}$。\n- 偏差角，$\\theta = 5^{\\circ}$。\n\n首先，我们必须将角度 $\\theta$ 转换为弧度，以满足三角函数计算的要求：\n$$ \\theta_{\\text{rad}} = 5^{\\circ} \\times \\frac{\\pi}{180^{\\circ}} = \\frac{\\pi}{36}\\ \\text{rad} $$\n现在，我们将这些数值代入误差表达式：\n$$ \\Delta \\tau_w = (1.8 \\times 10^{-5}) \\left( (4000) \\sin\\left(\\frac{\\pi}{36}\\right) + (500) \\left(\\cos\\left(\\frac{\\pi}{36}\\right) - 1\\right) \\right) $$\n我们来计算各项的值：\n$$ \\sin\\left(\\frac{\\pi}{36}\\right) \\approx 0.08715574 $$\n$$ \\cos\\left(\\frac{\\pi}{36}\\right) \\approx 0.99619470 $$\n$$ \\cos\\left(\\frac{\\pi}{36}\\right) - 1 \\approx -0.00380530 $$\n将这些值代入表达式：\n$$ \\Delta \\tau_w \\approx (1.8 \\times 10^{-5}) \\left( (4000)(0.08715574) + (500)(-0.00380530) \\right) $$\n$$ \\Delta \\tau_w \\approx (1.8 \\times 10^{-5}) \\left( 348.62296 - 1.90265 \\right) $$\n$$ \\Delta \\tau_w \\approx (1.8 \\times 10^{-5}) (346.72031) $$\n$$ \\Delta \\tau_w \\approx 0.00624096558\\ \\text{Pa} $$\n题目要求的是绝对误差，即 $|\\Delta \\tau_w|$。由于计算结果为正，绝对误差就是这个值。\n$$ |\\Delta \\tau_w| \\approx 0.00624096558\\ \\text{Pa} $$\n最后，我们将答案四舍五入到四位有效数字：\n$$ |\\Delta \\tau_w| \\approx 0.006241\\ \\text{Pa} $$\n用标准科学记数法表示，即 $6.241 \\times 10^{-3}\\ \\text{Pa}$。",
            "answer": "$$\\boxed{6.241 \\times 10^{-3}}$$"
        },
        {
            "introduction": "几何守恒律（Geometric Conservation Law, GCL）是曲线坐标系下离散格式必须满足的一个基本要求，它确保了数值格式能够精确地维持一个均匀的流场状态。本练习采用经典的刚体旋转流场（其涡量为常数）作为测试案例，来演示对网格度量项的不一致离散化如何违背GCL，从而在物理上应为均匀的流场中产生虚假的涡量 。这个实践对于理解和编写可靠的CFD求解器至关重要。",
            "id": "3327956",
            "problem": "给定一个从计算坐标 $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ 到物理空间 $(x,y)\\in\\mathbb{R}^2$ 的贴体、二维、结构化曲线网格映射，由 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 定义，以及一个刚体旋转场，其切向速度为 $u_\\theta(\\boldsymbol{x})=\\Omega r$，其中 $r=\\sqrt{x^2+y^2}$，$\\Omega$ 是一个恒定的角速度。在笛卡尔分量中，速度为 $(u,v)=(-\\Omega y,\\Omega x)$。对于刚体旋转，物理涡量（二维速度的旋度）定义为 $\\omega=\\partial v/\\partial x - \\partial u/\\partial y$，它是一个空间常数 $\\omega=2\\Omega$。在曲线网格上，对 $\\omega$ 的离散计算应遵守几何度量恒等式；否则，可能会产生伪涡量。\n\n从涡量的基本定义 $\\omega=\\partial v/\\partial x - \\partial u/\\partial y$ 和光滑映射 $\\boldsymbol{r}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$ 的定义出发，定义切向量 $\\boldsymbol{t}^\\xi=\\partial\\boldsymbol{r}/\\partial\\xi=(x_\\xi,y_\\xi)$ 和 $\\boldsymbol{t}^\\eta=\\partial\\boldsymbol{r}/\\partial\\eta=(x_\\eta,y_\\eta)$，以及雅可比行列式 $J=x_\\xi y_\\eta - x_\\eta y_\\xi$。使用链式法则推导涡量的守恒形式，\n$$ \\omega = \\frac{1}{J}\\left( \\frac{\\partial}{\\partial \\xi}\\left(u\\,x_\\eta + v\\,y_\\eta\\right) - \\frac{\\partial}{\\partial \\eta}\\left(u\\,x_\\xi + v\\,y_\\xi\\right)\\right) $$\n并构建一个在结构化网格上通过二阶中心差分来近似 $\\xi$ 和 $\\eta$ 方向导数的离散算子。度量恒等式是混合偏导数的相等关系（例如，$x_{\\xi\\eta}=x_{\\eta\\xi}$ 和 $y_{\\xi\\eta}=y_{\\eta\\xi}$）。当度量 $(x_\\xi,x_\\eta,y_\\xi,y_\\eta)$ 的不一致离散近似违反这些关系时，即使对于均匀旋转场，也会产生伪涡量。\n\n实现以下具有内半径 $r_0$ 和外半径 $r_1$ 的环形区域的贴体映射：\n- 令 $\\theta(\\xi,\\eta)=2\\pi \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$，\n- 令 $r(\\eta)=r_0 + (r_1-r_0)\\eta + \\beta \\sin(2\\pi \\eta)$，\n- 令 $x(\\xi,\\eta)=r(\\eta)\\cos(\\theta(\\xi,\\eta))$ 且 $y(\\xi,\\eta)=r(\\eta)\\sin(\\theta(\\xi,\\eta))$，\n其中 $\\alpha=0.2 a$ 和 $\\beta=0.1 a$，而 $a \\ge 0$ 是一个控制网格曲率的扭曲振幅参数。\n\n定义一个诊断量，通过离散涡量与精确值 $2\\Omega$ 的相对偏差来量化伪涡量：\n$$ D=\\max_{i,j}\\left|\\frac{\\omega_{i,j}}{2\\Omega}-1\\right| $$\n其中 $\\omega_{i,j}$ 是在内部节点 $(i,j)$ 处计算的离散涡量。伪涡量的检测布尔值为\n$$ B=\\begin{cases} \\text{True},  \\text{if } D > \\tau \\\\ \\text{False},  \\text{if } D \\le \\tau \\end{cases} $$\n指定阈值为 $\\tau=0.05$（无量纲）。诊断量 $D$ 是无量纲的；角速度 $\\Omega$ 的单位是 $\\text{s}^{-1}$，但要求的输出是无量纲的诊断量和相应的布尔标志，因此无需打印任何物理单位。\n\n你的程序必须：\n- 为给定的 $(N_\\xi,N_\\eta,a)$ 构建网格，\n- 根据给定的 $\\Omega$ 从 $(x,y)$ 计算 $(u,v)$，\n- 使用上述守恒旋度形式计算离散涡量 $\\omega$，并采用：\n    1. 从映射公式得到的解析度量 $(x_\\xi,x_\\eta,y_\\xi,y_\\eta)$，\n    2. 从 $(x,y)$ 的二阶中心差分得到的一致离散度量，\n    3. 通过对不同分量混合使用前向和后向差分格式而违反度量恒等式的不一致离散度量，\n- 计算每种情况下的 $D$ 和 $B$。\n\n测试套件：\n使用 $\\Omega=1.0\\,\\text{s}^{-1}$，$r_0=1.0\\,\\text{m}$，$r_1=2.0\\,\\text{m}$，以及阈值 $\\tau=0.05$。评估以下五个测试用例：\n1. $(N_\\xi,N_\\eta,a,\\text{metric})=(64,32,0.10,\\text{analytic})$。\n2. $(N_\\xi,N_\\eta,a,\\text{metric})=(64,32,0.10,\\text{central})$。\n3. $(N_\\xi,N_\\eta,a,\\text{metric})=(64,32,0.10,\\text{broken})$。\n4. $(N_\\xi,N_\\eta,a,\\text{metric})=(64,32,0.30,\\text{broken})$。\n5. $(N_\\xi,N_\\eta,a,\\text{metric})=(16,8,0.10,\\text{central})$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按顺序为 $[D_1,B_1,D_2,B_2,D_3,B_3,D_4,B_4,D_5,B_5]$。每个 $D_k$ 必须是一个十进制数（无量纲），每个 $B_k$ 必须是一个布尔值。例如，一个可接受的输出如下所示：`[0.0012,False,0.0034,False,0.1523,True,0.3011,True,0.0221,False]`。",
            "solution": "用户提供的问题在科学上是合理的、良定的和完整的。所有必要的数据、方程和测试条件都已指定，并且问题遵循了计算流体动力学（CFD）的既定原则。该问题有效，可以按所述方式解决。\n\n该问题要求在变换坐标系中推导涡量的守恒形式，然后进行数值实现，以诊断由几何度量项的不一致离散近似产生的伪涡量。\n\n**1. 理论基础**\n\n在二维笛卡尔坐标 $(x,y)$ 中，对于速度场 $\\boldsymbol{u}=(u,v)$，涡量 $\\omega$ 定义为速度场的旋度：\n$$\n\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\n$$\n给定一个从计算坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的光滑、可逆映射，由 $x=x(\\xi,\\eta)$ 和 $y=y(\\xi,\\eta)$ 定义。链式法则允许我们变换偏导数算子。偏导数之间的关系是：\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial \\xi}{\\partial x}\\frac{\\partial}{\\partial \\xi} + \\frac{\\partial \\eta}{\\partial x}\\frac{\\partial}{\\partial \\eta}\n$$\n$$\n\\frac{\\partial}{\\partial y} = \\frac{\\partial \\xi}{\\partial y}\\frac{\\partial}{\\partial \\xi} + \\frac{\\partial \\eta}{\\partial y}\\frac{\\partial}{\\partial \\eta}\n$$\n逆变换的导数 $(\\xi_x, \\xi_y, \\eta_x, \\eta_y)$ 可以用正变换的导数 $(x_\\xi, x_\\eta, y_\\xi, y_\\eta)$ 通过变换的雅可比矩阵的逆来表示：\n$$\n\\begin{pmatrix} \\xi_x  \\xi_y \\\\ \\eta_x  \\eta_y \\end{pmatrix} = \\begin{pmatrix} x_\\xi  y_\\xi \\\\ x_\\eta  y_\\eta \\end{pmatrix}^{-1} = \\frac{1}{J} \\begin{pmatrix} y_\\eta  -y_\\xi \\\\ -x_\\eta  x_\\xi \\end{pmatrix}\n$$\n其中 $J = x_\\xi y_\\eta - x_\\eta y_\\xi$ 是变换的雅可比行列式。\n\n将这些代入涡量的定义中，得到：\n$$\n\\omega = \\left( \\frac{\\partial \\xi}{\\partial x}\\frac{\\partial v}{\\partial \\xi} + \\frac{\\partial \\eta}{\\partial x}\\frac{\\partial v}{\\partial \\eta} \\right) - \\left( \\frac{\\partial \\xi}{\\partial y}\\frac{\\partial u}{\\partial \\xi} + \\frac{\\partial \\eta}{\\partial y}\\frac{\\partial u}{\\partial \\eta} \\right)\n$$\n$$\n\\omega = \\frac{1}{J} \\left( y_\\eta \\frac{\\partial v}{\\partial \\xi} - x_\\eta \\frac{\\partial v}{\\partial \\eta} \\right) - \\frac{1}{J} \\left( -y_\\xi \\frac{\\partial u}{\\partial \\xi} + x_\\xi \\frac{\\partial u}{\\partial \\eta} \\right)\n$$\n$$\nJ\\omega = \\left( y_\\eta v_\\xi - y_\\xi v_\\eta - (-x_\\eta u_\\xi + x_\\xi u_\\eta) \\right) = (x_\\eta u_\\xi + y_\\eta v_\\xi) - (x_\\xi u_\\eta + y_\\xi v_\\eta)\n$$\n这是涡量方程的非守恒形式。问题要求推导守恒形式：\n$$\n\\omega = \\frac{1}{J}\\left( \\frac{\\partial}{\\partial \\xi}\\left(u\\,x_\\eta + v\\,y_\\eta\\right) - \\frac{\\partial}{\\partial \\eta}\\left(u\\,x_\\xi + v\\,y_\\xi\\right)\\right)\n$$\n为了证明它们的等价性，我们使用乘法法则展开右侧：\n$$\nJ\\omega = \\left( u_\\xi x_\\eta + u x_{\\eta\\xi} + v_\\xi y_\\eta + v y_{\\eta\\xi} \\right) - \\left( u_\\eta x_\\xi + u x_{\\xi\\eta} + v_\\eta y_\\xi + v y_{\\xi\\eta} \\right)\n$$\n$$\nJ\\omega = (u_\\xi x_\\eta + v_\\xi y_\\eta) - (u_\\eta x_\\xi + v_\\eta y_\\xi) + u(x_{\\eta\\xi} - x_{\\xi\\eta}) + v(y_{\\eta\\xi} - y_{\\xi\\eta})\n$$\n如果坐标映射足够光滑（二次连续可微），那么根据混合偏导数相等定理（Clairaut's theorem），我们有 $x_{\\xi\\eta} = x_{\\eta\\xi}$ 和 $y_{\\xi\\eta} = y_{\\eta\\xi}$。这些被称为几何度量恒等式。在此条件下，最后两项消失，方程简化为前面推导的非守恒形式。\n\n关键的洞见在于，虽然这个恒等式在解析上成立，但其离散近似可能不成立。如果度量的离散算子选择得不一致，则项 $u(D_\\xi D_\\eta x - D_\\eta D_\\xi x) + v(D_\\xi D_\\eta y - D_\\eta D_\\xi y)$（其中 $D$ 代表离散差分算子）可能非零。这个非零项会产生虚假的、非物理的涡量。具有空间常数物理涡量 $\\omega = 2\\Omega$ 的刚体旋转场是这种“自由流保持”特性的经典测试案例。一个数值格式应该能够精确保守这个恒定状态，任何偏差都表明离散化中存在缺陷，特别是在满足离散几何守恒律方面。\n\n**2. 数值实现策略**\n\n任务的核心是针对三种不同的计算度量项 $(x_\\xi, x_\\eta, y_\\xi, y_\\eta)$ 的方法，在内部网格节点上计算离散涡量 $\\omega_{i,j}$。\n\n**网格与坐标**：在计算域 $[0,1]\\times[0,1]$ 中定义一个具有 $(N_\\xi, N_\\eta)$ 个点的均匀结构化网格。网格间距为 $\\Delta\\xi = 1/(N_\\xi-1)$ 和 $\\Delta\\eta = 1/(N_\\eta-1)$。使用提供的映射公式在每个网格点上计算物理坐标 $(x,y)$。\n\n**速度场**：在每个网格点上计算速度分量 $(u, v) = (-\\Omega y, \\Omega x)$。\n\n**度量项计算**：\n1.  **解析法**：从映射方程解析推导出偏导数 $(x_\\xi, y_\\xi, x_\\eta, y_\\eta)$，并在每个网格点上进行计算。此方法完美满足度量恒等式。\n2.  **一致法（中心差分）**：在 $(x,y)$ 网格上使用二阶中心差分来近似度量项。`numpy.gradient` 函数是合适的，因为它对内部点使用中心差分，在边界上使用二阶单边差分，从而确保了一致性。均匀网格上的离散中心差分算子是可交换的，因此离散度量恒等式在机器精度范围内得到满足。\n3.  **不一致法（破坏法）**：为故意违反度量恒等式，我们对不同分量使用不同的有限差分格式。例如，我们使用前向差分计算 $x$ 的导数（$x_\\xi, x_\\eta$），并使用后向差分计算 $y$ 的导数（$y_\\xi, y_\\eta$）。这种不一致性导致 $D_\\xi D_\\eta x \\neq D_\\eta D_\\xi x$（对 $y$ 也同样），从而产生伪涡量。\n\n**涡量计算**：给定度量后，我们在所有网格点上构造量 $F_\\xi = u x_\\eta + v y_\\eta$ 和 $F_\\eta = u x_\\xi + v y_\\xi$。然后，对 $F_\\xi$ 和 $F_\\eta$ 使用二阶中心差分，计算内部节点 $(i,j)$（其中 $i \\in [1, N_\\xi-2], j \\in [1, N_\\eta-2]$）的涡量：\n$$\n\\omega_{i,j} = \\frac{1}{J_{i,j}} \\left( \\frac{(F_\\xi)_{i+1,j} - (F_\\xi)_{i-1,j}}{2\\Delta\\xi} - \\frac{(F_\\eta)_{i,j+1} - (F_\\eta)_{i,j-1}}{2\\Delta\\eta} \\right)\n$$\n雅可比行列式 $J_{i,j}$ 也在内部节点上使用计算出的度量进行求值。\n\n**诊断量计算**：在所有内部节点上计算相对偏差 $D = \\max_{i,j} \\left| \\omega_{i,j}/(2\\Omega) - 1 \\right|$。如果 $D  \\tau$，则布尔标志 $B$ 被设为真。\n\n实现将处理五个测试用例中的每一个，为每个用例计算并存储对 $(D, B)$。",
            "answer": "```python\nimport numpy as np\n\ndef run_case(N_xi, N_eta, a, metric_type, r0, r1, Omega, tau):\n    \"\"\"\n    Computes spurious vorticity for a single test case.\n    \"\"\"\n    # 1. Construct the computational grid\n    xi_1d = np.linspace(0, 1, N_xi)\n    eta_1d = np.linspace(0, 1, N_eta)\n    dxi = 1.0 / (N_xi - 1)\n    deta = 1.0 / (N_eta - 1)\n    XI_m, ETA_m = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n    # Parameters for the mapping\n    alpha = 0.2 * a\n    beta = 0.1 * a\n    PI2 = 2.0 * np.pi\n\n    # 2. Compute physical coordinates and analytical metrics if needed\n    theta = PI2 * XI_m + alpha * np.sin(PI2 * XI_m) * np.sin(PI2 * ETA_m)\n    r = r0 + (r1 - r0) * ETA_m + beta * np.sin(PI2 * ETA_m)\n    x = r * np.cos(theta)\n    y = r * np.sin(theta)\n\n    # 3. Evaluate metric terms based on metric_type\n    if metric_type == 'analytic':\n        theta_xi = PI2 * (1.0 + alpha * np.cos(PI2 * XI_m) * np.sin(PI2 * ETA_m))\n        theta_eta = PI2 * alpha * np.sin(PI2 * XI_m) * np.cos(PI2 * ETA_m)\n        r_eta = (r1 - r0) + PI2 * beta * np.cos(PI2 * ETA_m)\n        \n        x_xi = -y * theta_xi\n        y_xi = x * theta_xi\n        x_eta = r_eta * np.cos(theta) - y * theta_eta\n        y_eta = r_eta * np.sin(theta) + x * theta_eta\n\n    elif metric_type == 'central':\n        x_xi, x_eta = np.gradient(x, dxi, deta, axis=(0, 1))\n        y_xi, y_eta = np.gradient(y, dxi, deta, axis=(0, 1))\n\n    elif metric_type == 'broken':\n        x_xi = (np.roll(x, -1, axis=0) - x) / dxi\n        y_xi = (y - np.roll(y, 1, axis=0)) / dxi\n\n        x_eta = np.zeros_like(x)\n        x_eta[:, :-1] = (x[:, 1:] - x[:, :-1]) / deta\n        x_eta[:, -1] = (x[:, -1] - x[:, -2]) / deta  # Backward difference at boundary\n\n        y_eta = np.zeros_like(y)\n        y_eta[:, 1:] = (y[:, 1:] - y[:, :-1]) / deta\n        y_eta[:, 0] = (y[:, 1] - y[:, 0]) / deta  # Forward difference at boundary\n    \n    else:\n        raise ValueError(\"Unknown metric type\")\n\n    # 4. Evaluate velocity field\n    u = -Omega * y\n    v = Omega * x\n\n    # 5. Compute conservative flux-like terms\n    F_xi = u * x_eta + v * y_eta\n    F_eta = u * x_xi + v * y_xi\n\n    # 6. Compute vorticity on interior nodes\n    # Slice to get interior points for the final result\n    # We need a 3-point stencil, so we compute derivatives for [1:-1]\n    # d/dxi needs F_xi[2:, 1:-1] and F_xi[:-2, 1:-1]\n    dFxi_dxi = (F_xi[2:, 1:-1] - F_xi[:-2, 1:-1]) / (2.0 * dxi)\n    # d/deta needs F_eta[1:-1, 2:] and F_eta[1:-1, :-2]\n    dFeta_deta = (F_eta[1:-1, 2:] - F_eta[1:-1, :-2]) / (2.0 * deta)\n    \n    # Jacobian on interior nodes\n    J_interior = (x_xi * y_eta - x_eta * y_xi)[1:-1, 1:-1]\n    \n    # Avoid division by zero, although J should be  0 for a valid mesh\n    J_interior[J_interior == 0] = 1e-16\n\n    omega_discrete = (1.0 / J_interior) * (dFxi_dxi - dFeta_deta)\n\n    # 7. Compute diagnostics\n    omega_exact = 2.0 * Omega\n    D = np.max(np.abs(omega_discrete / omega_exact - 1.0))\n    B = D > tau\n\n    return D, B\n\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n    # Define test cases from the problem statement.\n    test_cases = [\n        (64, 32, 0.10, 'analytic'),\n        (64, 32, 0.10, 'central'),\n        (64, 32, 0.10, 'broken'),\n        (64, 32, 0.30, 'broken'),\n        (16, 8, 0.10, 'central'),\n    ]\n\n    # Global parameters\n    Omega = 1.0  # s^-1\n    r0 = 1.0     # m\n    r1 = 2.0     # m\n    tau = 0.05   # dimensionless threshold\n\n    results = []\n    for case in test_cases:\n        N_xi, N_eta, a, metric_type = case\n        D, B = run_case(N_xi, N_eta, a, metric_type, r0, r1, Omega, tau)\n        results.append(D)\n        results.append(B)\n    \n    # Format the final output string exactly as required\n    formatted_results = []\n    for item in results:\n        if isinstance(item, bool):\n            formatted_results.append(str(item))\n        else: # float\n            # Using a reasonable precision for floating point numbers\n            formatted_results.append(f\"{item:.12f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}