{
    "hands_on_practices": [
        {
            "introduction": "To properly account for source terms in a finite volume method on a curvilinear grid, we must integrate the source over the physical volume of each cell. This is not the same as simply averaging the source function over the uniform computational cell. This first exercise provides a foundational analytical derivation to illustrate why the Jacobian determinant of the coordinate transformation must be included as a weighting function in the integral, ensuring the calculation correctly reflects the physical volume ().",
            "id": "3363957",
            "problem": "In Computational Fluid Dynamics (CFD), source terms are often averaged over physical control volumes that arise from nonuniform coordinate mappings. Consider the two-dimensional mapping from computational coordinates $(\\xi,\\eta)$ to physical coordinates $(x,y)$ given by $x(\\xi,\\eta)=\\xi$ and $y(\\xi,\\eta)=\\eta^{2}$. Let the rectangular computational cell be $\\xi\\in[\\xi_{a},\\xi_{b}]$ and $\\eta\\in[\\eta_{a},\\eta_{b}]$, with $0<\\eta_{a}<\\eta_{b}$ to ensure a nondegenerate, orientation-preserving mapping. For the scalar source term $S(x,y)=x+y$, define the exact cell-averaged value in the physical space by the fundamental notion of an area-weighted mean,\n$$\\overline{S}=\\frac{1}{A}\\iint_{\\Omega}S(x,y)\\,dA,$$\nwhere $A=\\iint_{\\Omega}dA$ is the physical area of the mapped cell $\\Omega$.\n\nStarting only from the definition of $\\overline{S}$ and the change-of-variables theorem for integrals, and without invoking any unstated shortcut formulas, derive a closed-form expression for $\\overline{S}$ in terms of $\\xi_{a}$, $\\xi_{b}$, $\\eta_{a}$, and $\\eta_{b}$. You must account for the Jacobian determinant $J(\\xi,\\eta)$ associated with the mapping $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$, and you must carry $J(\\xi,\\eta)$ symbolically until its substitution is justified by the mapping. Clearly show how the nonuniformity of $J(\\xi,\\eta)$ with respect to $\\eta$ influences the averaging process relative to a uniform computational average.\n\nProvide your final answer as a single simplified analytic expression for $\\overline{S}$ in terms of $\\xi_{a}$, $\\xi_{b}$, $\\eta_{a}$, and $\\eta_{b}$. No numerical evaluation or rounding is required. Do not include units in your final expression.",
            "solution": "The problem requires the derivation of a closed-form expression for the cell-averaged source term, $\\overline{S}$, in physical space. The starting point is the formal definition of the average over the physical cell area $\\Omega$:\n$$ \\overline{S} = \\frac{1}{A} \\iint_{\\Omega} S(x,y) \\, dA $$\nwhere $A = \\iint_{\\Omega} dA$ is the physical area of the cell. The calculation involves transforming these integrals from the physical coordinates $(x,y)$ to the computational coordinates $(\\xi,\\eta)$ using the provided mapping.\n\nThe mapping is given by $x(\\xi,\\eta) = \\xi$ and $y(\\xi,\\eta) = \\eta^2$. The domain of integration in the computational space is the rectangle $R = \\{(\\xi,\\eta) \\mid \\xi_a \\le \\xi \\le \\xi_b, \\eta_a \\le \\eta \\le \\eta_b \\}$. The source term is $S(x,y) = x+y$.\n\nFirst, we must compute the Jacobian determinant of the coordinate transformation. The Jacobian matrix $\\mathbf{J}$ is defined as:\n$$ \\mathbf{J}(\\xi,\\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} $$\nCalculating the partial derivatives from the mapping functions:\n$$ \\frac{\\partial x}{\\partial \\xi} = 1, \\quad \\frac{\\partial x}{\\partial \\eta} = 0 $$\n$$ \\frac{\\partial y}{\\partial \\xi} = 0, \\quad \\frac{\\partial y}{\\partial \\eta} = 2\\eta $$\nThe Jacobian determinant, denoted by $J(\\xi,\\eta)$, is the determinant of this matrix:\n$$ J(\\xi,\\eta) = \\det(\\mathbf{J}) = (1)(2\\eta) - (0)(0) = 2\\eta $$\nThe problem states that $0 < \\eta_a < \\eta_b$, which ensures that for any $\\eta$ in the integration interval $[\\eta_a, \\eta_b]$, $J(\\xi,\\eta) = 2\\eta > 0$. This confirms the mapping is non-degenerate and orientation-preserving.\n\nThe change of variables theorem for a double integral states that $\\iint_{\\Omega} f(x,y) \\, dA = \\iint_{R} f(x(\\xi,\\eta), y(\\xi,\\eta)) |J(\\xi,\\eta)| \\,d\\xi \\,d\\eta$. Since $J(\\xi,\\eta) > 0$, the absolute value is unnecessary, and the area element transforms as $dA = J(\\xi,\\eta) \\, d\\xi \\, d\\eta = 2\\eta \\, d\\xi \\, d\\eta$.\n\nWe proceed by calculating the area $A$ and the integrated source term, which we will denote as $I_S = \\iint_{\\Omega} S(x,y) \\, dA$.\n\nFirst, we calculate the area $A$:\n$$ A = \\iint_{\\Omega} dA = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} J(\\xi,\\eta) \\, d\\xi \\, d\\eta $$\nSubstituting $J(\\xi,\\eta) = 2\\eta$:\n$$ A = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} 2\\eta \\, d\\xi \\, d\\eta $$\nWe integrate first with respect to $\\xi$:\n$$ A = \\int_{\\eta_a}^{\\eta_b} [2\\eta\\xi]_{\\xi=\\xi_a}^{\\xi=\\xi_b} \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} 2\\eta(\\xi_b - \\xi_a) \\, d\\eta $$\nNow, we integrate with respect to $\\eta$:\n$$ A = 2(\\xi_b - \\xi_a) \\int_{\\eta_a}^{\\eta_b} \\eta \\, d\\eta = 2(\\xi_b - \\xi_a) \\left[ \\frac{\\eta^2}{2} \\right]_{\\eta=\\eta_a}^{\\eta=\\eta_b} $$\n$$ A = 2(\\xi_b - \\xi_a) \\left( \\frac{\\eta_b^2}{2} - \\frac{\\eta_a^2}{2} \\right) = (\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) $$\n\nNext, we calculate the integrated source term $I_S$. We must first express the source term $S(x,y)$ in computational coordinates:\n$$ S(x(\\xi,\\eta), y(\\xi,\\eta)) = x(\\xi,\\eta) + y(\\xi,\\eta) = \\xi + \\eta^2 $$\nThe integral $I_S$ is then:\n$$ I_S = \\iint_{\\Omega} (x+y) \\, dA = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (\\xi + \\eta^2) J(\\xi,\\eta) \\, d\\xi \\, d\\eta $$\nSubstituting $J(\\xi,\\eta) = 2\\eta$:\n$$ I_S = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (\\xi + \\eta^2)(2\\eta) \\, d\\xi \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (2\\xi\\eta + 2\\eta^3) \\, d\\xi \\, d\\eta $$\nIntegrate with respect to $\\xi$:\n$$ I_S = \\int_{\\eta_a}^{\\eta_b} \\left[ \\xi^2\\eta + 2\\xi\\eta^3 \\right]_{\\xi=\\xi_a}^{\\xi=\\xi_b} \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} \\left( (\\xi_b^2 - \\xi_a^2)\\eta + 2(\\xi_b - \\xi_a)\\eta^3 \\right) \\, d\\eta $$\nNow, integrate with respect to $\\eta$:\n$$ I_S = \\left[ (\\xi_b^2 - \\xi_a^2)\\frac{\\eta^2}{2} + 2(\\xi_b - \\xi_a)\\frac{\\eta^4}{4} \\right]_{\\eta=\\eta_a}^{\\eta=\\eta_b} $$\n$$ I_S = (\\xi_b^2 - \\xi_a^2)\\left(\\frac{\\eta_b^2 - \\eta_a^2}{2}\\right) + (\\xi_b - \\xi_a)\\left(\\frac{\\eta_b^4 - \\eta_a^4}{2}\\right) $$\nTo simplify this expression, we use the difference of squares factorization: $\\xi_b^2 - \\xi_a^2 = (\\xi_b - \\xi_a)(\\xi_b + \\xi_a)$ and $\\eta_b^4 - \\eta_a^4 = (\\eta_b^2 - \\eta_a^2)(\\eta_b^2 + \\eta_a^2)$.\n$$ I_S = \\frac{1}{2}(\\xi_b - \\xi_a)(\\xi_b + \\xi_a)(\\eta_b^2 - \\eta_a^2) + \\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)(\\eta_b^2 + \\eta_a^2) $$\nFactor out the common terms $\\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)$:\n$$ I_S = \\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) \\left[ (\\xi_b + \\xi_a) + (\\eta_b^2 + \\eta_a^2) \\right] $$\n\nFinally, we compute the cell-averaged source term $\\overline{S}$ by dividing $I_S$ by $A$:\n$$ \\overline{S} = \\frac{I_S}{A} = \\frac{\\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) \\left[ \\xi_a + \\xi_b + \\eta_a^2 + \\eta_b^2 \\right]}{(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)} $$\nSince the computational cell is non-degenerate, we have $\\xi_a \\neq \\xi_b$ and $\\eta_a \\neq \\eta_b$, so the terms $(\\xi_b - \\xi_a)$ and $(\\eta_b^2 - \\eta_a^2)$ are non-zero and can be canceled. This yields the final expression:\n$$ \\overline{S} = \\frac{1}{2}(\\xi_a + \\xi_b + \\eta_a^2 + \\eta_b^2) $$\nThis expression can be rewritten as:\n$$ \\overline{S} = \\frac{\\xi_a + \\xi_b}{2} + \\frac{\\eta_a^2 + \\eta_b^2}{2} $$\nThe term $\\frac{\\xi_a + \\xi_b}{2}$ is the arithmetic mean of the cell-face values of $x = \\xi$. The term $\\frac{\\eta_a^2 + \\eta_b^2}{2}$ is the arithmetic mean of the cell-face values of $y=\\eta^2$.\n\nThe problem asks to show how the nonuniformity of $J(\\xi,\\eta)$ influences the result. The Jacobian $J(\\xi,\\eta) = 2\\eta$ is not uniform; it varies with $\\eta$. Its role is that of a weighting function. The physically correct average is not an average of $S=\\xi+\\eta^2$ over the computational cell, but a weighted average where the weight is the Jacobian determinant, representing the local ratio of physical area to computational area.\nThe correct average is $\\overline{S} = \\frac{\\iint S J \\,d\\xi d\\eta}{\\iint J \\,d\\xi d\\eta}$.\nBecause $J$ is independent of $\\xi$, the averaging in the $\\xi$ direction is uniform, resulting in the standard average $\\frac{\\xi_a+\\xi_b}{2}$.\nHowever, because $J$ is a function of $\\eta$, the averaging in the $\\eta$ direction is weighted. The average of the $y = \\eta^2$ term is $\\frac{\\int \\eta^2 J \\,d\\eta}{\\int J \\,d\\eta} = \\frac{\\int_{\\eta_a}^{\\eta_b} \\eta^2(2\\eta) \\,d\\eta}{\\int_{\\eta_a}^{\\eta_b} 2\\eta \\,d\\eta} = \\frac{[\\eta^4/2]_{\\eta_a}^{\\eta_b}}{[\\eta^2]_{\\eta_a}^{\\eta_b}} = \\frac{(\\eta_b^4-\\eta_a^4)/2}{\\eta_b^2-\\eta_a^2} = \\frac{\\eta_a^2 + \\eta_b^2}{2}$.\nIf one were to naively average $S=\\xi+\\eta^2$ in the computational domain (i.e., with a uniform Jacobian $J=1$), the $\\eta^2$ part would average to $\\frac{\\int_{\\eta_a}^{\\eta_b} \\eta^2 \\,d\\eta}{\\int_{\\eta_a}^{\\eta_b} 1 \\,d\\eta} = \\frac{[\\eta^3/3]_{\\eta_a}^{\\eta_b}}{[\\eta]_{\\eta_a}^{\\eta_b}} = \\frac{\\eta_b^3-\\eta_a^3}{3(\\eta_b-\\eta_a)} = \\frac{\\eta_a^2 + \\eta_a\\eta_b + \\eta_b^2}{3}$. This result is different from the physically correct one. The non-uniform Jacobian correctly gives more weight to the values of $S$ at larger $\\eta$, where the physical area is stretched more significantly.",
            "answer": "$$ \\boxed{\\frac{\\xi_{a} + \\xi_{b} + \\eta_{a}^{2} + \\eta_{b}^{2}}{2}} $$"
        },
        {
            "introduction": "Moving from continuous theory to discrete numerical schemes requires that our discrete operators respect the properties of the underlying geometry, a principle known as the Geometric Conservation Law (GCL). A failure to do so can lead to schemes that do not conserve fundamental quantities, even for simple uniform flows. This practice uses the powerful method of manufactured solutions to create a clear counterexample, demonstrating precisely how an inconsistent quadrature of a source term violates discrete conservation and how a GCL-consistent treatment restores it ().",
            "id": "3363913",
            "problem": "Consider a single spectral element in one spatial dimension with computational coordinate $\\xi \\in [-1,1]$ mapped to physical coordinate $x$ through the isoparametric transformation $x(\\xi) = \\xi + \\alpha \\xi^{2}$, where $\\alpha \\in \\left(-\\frac{1}{2}, \\frac{1}{2}\\right)$ so that the mapping is non-singular and the Jacobian $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\xi$ remains positive. The steady scalar conservation law in physical space is written in transformed conservative form as\n$$\n\\frac{d}{d\\xi} g(\\xi) = J(\\xi) s(\\xi),\n$$\nwhere $g(\\xi)$ is the contravariant flux and $s(\\xi)$ is the source per unit physical volume, and the integral statement of conservation over the element is\n$$\n\\int_{-1}^{1} J(\\xi)\\, s(\\xi)\\, d\\xi = g(1) - g(-1).\n$$\nUsing this fundamental integral conservation law and the definition of the Jacobian under coordinate transformation, define a manufactured consistent solution by choosing $g(\\xi) = \\xi$ and $s(\\xi) = \\frac{1}{J(\\xi)}$, which yields exact continuous conservation $\\int_{-1}^{1} J(\\xi)\\, s(\\xi)\\, d\\xi = 2$ and $g(1) - g(-1) = 2$.\n\nNow construct a discrete counterexample that violates conservation when the source quadrature is inconsistent with the Jacobian. Specifically, approximate the flux-divergence integral $\\int_{-1}^{1} \\frac{d}{d\\xi} g(\\xi)\\, d\\xi$ with two-node Gauss–Lobatto quadrature at $\\xi_{-} = -1$ and $\\xi_{+} = 1$ with weights $w_{-} = 1$ and $w_{+} = 1$ applied to the integrand $\\frac{d}{d\\xi} g(\\xi)$, and approximate the source integral $\\int_{-1}^{1} J(\\xi) s(\\xi)\\, d\\xi$ incorrectly as $\\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k})$, i.e., omitting the Jacobian from the source integrand in the quadrature. Denote the resulting discrete conservation residual under this inconsistent source quadrature by\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k}).\n$$\nThen, propose a metric-consistent correction by evaluating the source integral with the same quadrature but including the Jacobian consistently in the integrand, i.e., $\\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k})$, and define the corrected residual\n$$\nR_{\\mathrm{corrected}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k}).\n$$\nUsing only the fundamental definitions and the manufactured choice $g(\\xi) = \\xi$ and $s(\\xi) = \\frac{1}{J(\\xi)}$, derive an explicit closed-form analytical expression for $R_{\\mathrm{inconsistent}}(\\alpha)$ and for $R_{\\mathrm{corrected}}(\\alpha)$ in terms of $\\alpha$. Your final answer must be given as a row matrix containing $R_{\\mathrm{inconsistent}}(\\alpha)$ and $R_{\\mathrm{corrected}}(\\alpha)$, with no units required and no rounding.",
            "solution": "The problem is validated as scientifically sound, well-posed, objective, and complete. It presents a standard exercise in numerical analysis for computational fluid dynamics, specifically concerning the geometric conservation law and the correct treatment of source terms under coordinate transformations. We proceed to derive the analytical expressions for the inconsistent and corrected discrete residuals.\n\nThe objective is to compute the expressions for $R_{\\mathrm{inconsistent}}(\\alpha)$ and $R_{\\mathrm{corrected}}(\\alpha)$. Both residuals are defined as the difference between a discrete flux-divergence term and a discrete source term. We will compute these terms systematically using the provided definitions.\n\nThe definitions given are:\n- Coordinate mapping: $x(\\xi) = \\xi + \\alpha \\xi^{2}$\n- Jacobian: $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\xi$\n- Manufactured flux: $g(\\xi) = \\xi$\n- Manufactured source: $s(\\xi) = \\frac{1}{J(\\xi)} = \\frac{1}{1 + 2 \\alpha \\xi}$\n- Quadrature nodes: $\\xi_{-} = -1$, $\\xi_{+} = 1$\n- Quadrature weights: $w_{-} = 1$, $w_{+} = 1$\n\nThe discrete residuals are:\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k})\n$$\n$$\nR_{\\mathrm{corrected}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k})\n$$\n\nFirst, we compute the discrete flux-divergence term, which is common to both residual definitions. The integrand is the derivative of the flux function $g(\\xi)$.\nGiven $g(\\xi) = \\xi$, its derivative with respect to $\\xi$ is:\n$$\n\\frac{dg}{d\\xi} = 1\n$$\nThis derivative is a constant. We evaluate it at the two-node Gauss–Lobatto quadrature points $\\xi_{-} = -1$ and $\\xi_{+} = 1$ and sum the results multiplied by the corresponding weights $w_{-} = 1$ and $w_{+} = 1$.\nThe discrete flux-divergence term is:\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{dg}{d\\xi}\\right|_{\\xi=\\xi_{k}} = w_{-} \\left(\\left.\\frac{dg}{d\\xi}\\right|_{\\xi=-1}\\right) + w_{+} \\left(\\left.\\frac{dg}{d\\xi}\\right|_{\\xi=1}\\right) = (1)(1) + (1)(1) = 2\n$$\n\nNext, we compute the inconsistent discrete source term for $R_{\\mathrm{inconsistent}}(\\alpha)$. This term incorrectly omits the Jacobian from the quadrature integrand.\nThe term to be summed is $s(\\xi) = \\frac{1}{1 + 2 \\alpha \\xi}$. We evaluate this at the quadrature points:\n$$\ns(\\xi_{-}) = s(-1) = \\frac{1}{1 + 2 \\alpha (-1)} = \\frac{1}{1 - 2\\alpha}\n$$\n$$\ns(\\xi_{+}) = s(1) = \\frac{1}{1 + 2 \\alpha (1)} = \\frac{1}{1 + 2\\alpha}\n$$\nThe inconsistent source term is the weighted sum:\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k}) = w_{-} s(-1) + w_{+} s(1) = (1)\\left(\\frac{1}{1 - 2\\alpha}\\right) + (1)\\left(\\frac{1}{1 + 2\\alpha}\\right)\n$$\nCombining the fractions over a common denominator:\n$$\n\\frac{1 + 2\\alpha}{(1 - 2\\alpha)(1 + 2\\alpha)} + \\frac{1 - 2\\alpha}{(1 - 2\\alpha)(1 + 2\\alpha)} = \\frac{(1 + 2\\alpha) + (1 - 2\\alpha)}{1 - (2\\alpha)^2} = \\frac{2}{1 - 4\\alpha^2}\n$$\n\nNow we assemble the expression for $R_{\\mathrm{inconsistent}}(\\alpha)$:\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = (\\text{Discrete Flux Divergence}) - (\\text{Inconsistent Source Term}) = 2 - \\frac{2}{1 - 4\\alpha^2}\n$$\nTo obtain a single fractional expression:\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\frac{2(1 - 4\\alpha^2) - 2}{1 - 4\\alpha^2} = \\frac{2 - 8\\alpha^2 - 2}{1 - 4\\alpha^2} = \\frac{-8\\alpha^2}{1 - 4\\alpha^2}\n$$\n\nFinally, we compute the corrected discrete source term for $R_{\\mathrm{corrected}}(\\alpha)$. This term correctly includes the Jacobian $J(\\xi)$ in the quadrature integrand.\nThe term to be summed is $J(\\xi) s(\\xi)$. By definition of the manufactured source term, $s(\\xi) = \\frac{1}{J(\\xi)}$. Therefore, the product is:\n$$\nJ(\\xi) s(\\xi) = (1 + 2\\alpha\\xi) \\left(\\frac{1}{1 + 2\\alpha\\xi}\\right) = 1\n$$\nThis product is a constant value of $1$ for all $\\xi$ in the domain.\nThe corrected source term is the weighted sum of this product evaluated at the quadrature points:\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k}) = w_{-} (1) + w_{+} (1) = (1)(1) + (1)(1) = 2\n$$\n\nNow we assemble the expression for $R_{\\mathrm{corrected}}(\\alpha)$:\n$$\nR_{\\mathrm{corrected}}(\\alpha) = (\\text{Discrete Flux Divergence}) - (\\text{Corrected Source Term}) = 2 - 2 = 0\n$$\nThe corrected residual is identically zero, which demonstrates that the metric-consistent quadrature preserves the conservation property of the continuous equation at the discrete level for this manufactured solution. This is because the quadrature rule is exact for the integrands $\\frac{dg}{d\\xi}=1$ and $J(\\xi)s(\\xi)=1$.\n\nThe derived expressions are:\n- $R_{\\mathrm{inconsistent}}(\\alpha) = \\frac{-8\\alpha^2}{1 - 4\\alpha^2}$\n- $R_{\\mathrm{corrected}}(\\alpha) = 0$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{-8\\alpha^{2}}{1 - 4\\alpha^{2}} & 0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "The challenge of maintaining conservation becomes even more acute on time-dependent, moving grids, a scenario common in Arbitrary Lagrangian-Eulerian (ALE) frameworks. Here, the GCL requires an exact balance between the rate of change of the cell volume, represented by the time derivative of the Jacobian ($J_t$), and the flux generated by grid motion. This final hands-on practice involves a coding exercise to quantify the non-physical, spurious sources that arise in mass and energy equations when this discrete GCL is violated, providing a direct demonstration of why freestream preservation is a critical test for any ALE solver ().",
            "id": "3363918",
            "problem": "Consider the one-dimensional conservation of a generic conserved scalar under a time-dependent mapping in Arbitrary Lagrangian–Eulerian (ALE) form. Let the physical coordinate be $x$, the computational coordinate be $\\xi \\in [0,1)$, and the mapping be $x = x(\\xi, t)$ with Jacobian $J = \\partial x / \\partial \\xi$ and grid velocity $w = \\partial x / \\partial t |_{\\xi}$. The conserved variable is denoted by $U(x,t)$ and the physical flux by $F(U)$. The governing conservation law in physical space is the fundamental balance $\\partial_t U + \\partial_x F(U) = 0$. In mapped form, the conservative ALE equation is of the form $\\partial_t (J U) + \\partial_{\\xi}(F(U) - w U) = 0$. The Discrete Geometric Conservation Law (GCL) requires that the discrete analog of the identity $J_t = \\partial_{\\xi} w$ be satisfied to preserve free streams.\n\nYou are asked to demonstrate from first principles why a discrete GCL is necessary to avoid spurious sources in the mass and energy equations, by constructing and analyzing a time-dependent mapping with $J_t \\ne 0$. Start from the integral conservation form and the Reynolds transport theorem, adopt a one-dimensional time-dependent coordinate transformation, and carefully derive the mapped conservative equation. Using a uniform resting state (no physical flow), show analytically that the correct mapped equation for a constant $U$ demands $J_t - \\partial_{\\xi}w = 0$. Then design a discrete residual that quantifies the violation of this identity when discrete terms are missing or inconsistent.\n\nAll quantities in this problem are nondimensional. Angles (e.g., trigonometric arguments) are in radians. The analysis must be purely mathematical and algorithmic, independent of any particular programming language, and should be physically and numerically consistent with the foundations of Computational Fluid Dynamics (CFD).\n\nConstruct the following mapping and test suite, and write a program to compute, for each test, the magnitude of the artificial source introduced when the $J_t$ term is omitted or inconsistently discretized:\n\nMapping and parameters:\n- Define $x(\\xi,t) = \\xi + \\frac{a}{2 \\pi k} \\sin(2 \\pi k \\xi)\\, \\sin(\\omega t)$.\n- Then $J(\\xi,t) = \\frac{\\partial x}{\\partial \\xi} = 1 + a \\cos(2 \\pi k \\xi)\\, \\sin(\\omega t)$ and $w(\\xi,t) = \\frac{\\partial x}{\\partial t} |_{\\xi} = \\frac{a}{2 \\pi k} \\sin(2 \\pi k \\xi)\\, \\omega \\cos(\\omega t)$.\n- Consider a free-stream state with uniform density $\\rho_0$ and uniform total energy $E_0$, and vanishing physical velocity $u_0 = 0$, so that the exact evolution in physical space is constant in time for both mass and energy.\n- Fix the global parameters $\\omega = 2 \\pi$, $\\rho_0 = 1$, $E_0 = 2.5$, initial time $t^n = 0.37$, and time step $\\Delta t = 0.01$. Use periodic boundary conditions in $\\xi$.\n\nDiscrete residual (artificial source) measure:\n- Let the computational grid be $N$ uniformly spaced points at cell centers $\\xi_i = \\frac{i+1/2}{N}$ for $i = 0, \\dots, N-1$, with $\\Delta \\xi = \\frac{1}{N}$.\n- Define the discrete spatial derivative by the centered difference $D_{\\xi} w_i = \\frac{w_{i+1} - w_{i-1}}{2 \\Delta \\xi}$ with periodic indexing.\n- Evaluate $w$ at the mid-time $t^{n+1/2} = t^n + \\frac{\\Delta t}{2}$, i.e., $w_i^{n+1/2} = w(\\xi_i, t^{n+1/2})$.\n- Define two approximations for $J_t$:\n  1. Omitting $J_t$: $J_t^{\\text{omit}} = 0$.\n  2. Naive finite-difference in time: $J_t^{\\text{naive}}(\\xi_i) = \\frac{J(\\xi_i, t^{n+1}) - J(\\xi_i, t^{n})}{\\Delta t}$.\n  3. Discrete GCL-satisfying choice: $J_t^{\\text{gcl}}(\\xi_i) = D_{\\xi} w_i^{n+1/2}$.\n- For a uniform $U_0$, the discrete spurious source at each node for a given choice of $J_t^{(\\cdot)}$ is $S_i^{(\\cdot)} = U_0 (J_t^{(\\cdot)}(\\xi_i) - D_{\\xi} w_i^{n+1/2})$.\n- Use the $L^2$ norm to quantify the magnitude: $\\|S^{(\\cdot)}\\|_2 = \\sqrt{\\sum_{i=0}^{N-1} (S_i^{(\\cdot)})^2 \\Delta \\xi}$.\n\nInterpretation:\n- For mass, take $U_0 = \\rho_0$; for energy, take $U_0 = E_0$.\n- You must compute $\\|S_{\\text{mass}}^{\\text{omit}}\\|_2$, $\\|S_{\\text{mass}}^{\\text{naive}}\\|_2$, and $\\|S_{\\text{mass}}^{\\text{gcl}}\\|_2$ for both mass and energy.\n\nTest suite:\n- Case $1$: $a = 0$, $k = 1$, $N = 64$ (static grid baseline).\n- Case $2$: $a = 0.5$, $k = 1$, $N = 64$ (moderate motion, fundamental mode).\n- Case $3$: $a = 0.5$, $k = 8$, $N = 32$ (coarse grid, high spatial frequency).\n- Case $4$: $a = 0.5$, $k = 8$, $N = 256$ (fine grid, high spatial frequency).\n- Case $5$: $a = 0.9$, $k = 3$, $N = 64$ (strong motion near monotonicity limit).\n\nRequired outputs for each case (in this exact order):\n- $\\|S_{\\text{mass}}^{\\text{omit}}\\|_2$, $\\|S_{\\text{mass}}^{\\text{naive}}\\|_2$, $\\|S_{\\text{mass}}^{\\text{gcl}}\\|_2$, $\\|S_{\\text{energy}}^{\\text{omit}}\\|_2$, $\\|S_{\\text{energy}}^{\\text{naive}}\\|_2$, $\\|S_{\\text{energy}}^{\\text{gcl}}\\|_2$.\n\nFinal output format:\n- Your program should produce a single line of output containing all results for the $5$ cases, concatenated in order, as a comma-separated Python-style list enclosed in square brackets, for a total of $30$ floating-point numbers:\n- For example, it must print a string of the form $\\left[\\text{case}_1\\_1,\\text{case}_1\\_2,\\dots,\\text{case}_1\\_6,\\text{case}_2\\_1,\\dots,\\text{case}_5\\_6\\right]$ with no additional text.\n\nYour task:\n- Derive the mapped conservation law using the Reynolds transport theorem and identify the condition for free-stream preservation $J_t - \\partial_{\\xi} w = 0$.\n- Explain why omitting $J_t$ or computing it inconsistently creates artificial sources for uniform states in the mapped discrete system.\n- Implement the numerical procedure above to compute the six norms per case and aggregate them into the required output format.",
            "solution": "The problem requires a demonstration from first principles of the necessity of the Discrete Geometric Conservation Law (GCL) in Arbitrary Lagrangian-Eulerian (ALE) formulations to prevent spurious sources. We begin with the theoretical derivation, followed by an explanation of the numerical implications.\n\n### Derivation of the Mapped Conservation Law and GCL\n\nThe fundamental conservation law in one dimension for a conserved quantity $U$ with flux $F(U)$ is given in integral form over a moving control volume $V(t) = [x_a(t), x_b(t)]$ as:\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} U(x,t) \\, dx = \\mathcal{F}_{\\text{in}} - \\mathcal{F}_{\\text{out}}\n$$\nwhere the flux across a boundary moving with velocity $w$ is the sum of the physical flux $F(U)$ and the advective flux due to boundary motion, $-wU$. This yields:\n$$\n\\frac{d}{dt} \\int_{x_a(t)}^{x_b(t)} U(x,t) \\, dx = [ F(U) - wU ]_{x=x_a(t)} - [ F(U) - wU ]_{x=x_b(t)}\n$$\nWe introduce a time-dependent coordinate transformation from the physical coordinate $x$ to a computational coordinate $\\xi$, given by $x=x(\\xi, t)$. The boundaries of the control volume in physical space are mapped to fixed coordinates in computational space, $x_a(t) = x(\\xi_a, t)$ and $x_b(t) = x(\\xi_b, t)$, where $\\xi_a$ and $\\xi_b$ are constant. The velocity of a point of constant $\\xi$ is the grid velocity, $w(\\xi,t) = \\frac{\\partial x}{\\partial t}|_{\\xi}$. The transformation Jacobian is $J(\\xi,t) = \\frac{\\partial x}{\\partial \\xi}$.\n\nWe transform the integral on the left-hand side (LHS) to the computational domain:\n$$\n\\int_{x_a(t)}^{x_b(t)} U(x,t) \\, dx = \\int_{\\xi_a}^{\\xi_b} U(x(\\xi,t), t) J(\\xi,t) \\, d\\xi\n$$\nSince $\\xi_a$ and $\\xi_b$ are constant, we can bring the time derivative inside the integral (Leibniz rule):\n$$\n\\frac{d}{dt} \\int_{\\xi_a}^{\\xi_b} UJ \\, d\\xi = \\int_{\\xi_a}^{\\xi_b} \\frac{\\partial(UJ)}{\\partial t} \\bigg|_{\\xi} \\, d\\xi\n$$\nThe right-hand side (RHS) can be written as an integral using the fundamental theorem of calculus. The boundaries $x_a(t)$ and $x_b(t)$ correspond to $\\xi_a$ and $\\xi_b$. The flux function in the mapped coordinate is $\\tilde{\\mathcal{F}} = F-wU$. Thus, the RHS becomes $\\tilde{\\mathcal{F}}(\\xi_a, t) - \\tilde{\\mathcal{F}}(\\xi_b, t)$. Using the fundamental theorem of calculus in the $\\xi$ coordinate, this is:\n$$\n\\text{RHS} = - \\int_{\\xi_a}^{\\xi_b} \\frac{\\partial \\tilde{\\mathcal{F}}}{\\partial \\xi} \\, d\\xi = - \\int_{\\xi_a}^{\\xi_b} \\frac{\\partial (F-wU)}{\\partial \\xi} \\, d\\xi\n$$\nEquating the transformed LHS and RHS integral expressions gives:\n$$\n\\int_{\\xi_a}^{\\xi_b} \\left( \\frac{\\partial(UJ)}{\\partial t} + \\frac{\\partial (F-wU)}{\\partial \\xi} \\right) d\\xi = 0\n$$\nSince this must hold for any arbitrary control volume $[\\xi_a, \\xi_b]$, the integrand must be zero. This yields the strong differential form of the conservative ALE equation:\n$$\n\\frac{\\partial(UJ)}{\\partial t} + \\frac{\\partial (F-wU)}{\\partial \\xi} = 0\n$$\nThis matches the equation provided in the problem statement.\n\nTo derive the Geometric Conservation Law (GCL), we expand the time derivative term:\n$$\nU \\frac{\\partial J}{\\partial t} + J \\frac{\\partial U}{\\partial t} + \\frac{\\partial F}{\\partial \\xi} - \\frac{\\partial(wU)}{\\partial \\xi} = 0\n$$\nNow, consider a uniform free-stream state, where $U(x,t) = U_0$, a non-zero constant. In physical space, this state is stationary, as $\\partial_t U_0 = 0$ and $\\partial_x F(U_0) = F'(U_0) \\partial_x U_0 = 0$. The ALE formulation must preserve this property. In the mapped coordinates, $U(\\xi,t)=U_0$ is also constant. Therefore, any derivatives of $U$ with respect to $t$ or $\\xi$ are zero. The flux $F(U_0)$ is also constant, so $\\partial_{\\xi} F(U_0) = 0$. Substituting these facts into the expanded ALE equation gives:\n$$\nU_0 \\frac{\\partial J}{\\partial t} + J \\cdot 0 + 0 - \\frac{\\partial(wU_0)}{\\partial \\xi} = 0\n$$\nSince $U_0$ is a constant, it can be factored out:\n$$\nU_0 \\left( \\frac{\\partial J}{\\partial t} - \\frac{\\partial w}{\\partial \\xi} \\right) = 0\n$$\nFor a non-trivial state ($U_0 \\ne 0$), this equation can only be satisfied if the term in the parenthesis is zero:\n$$\n\\frac{\\partial J}{\\partial t} - \\frac{\\partial w}{\\partial \\xi} = 0\n$$\nThis is the continuous GCL. It is a direct consequence of the equality of mixed partial derivatives of the mapping function $x(\\xi,t)$: $\\partial_t \\partial_\\xi x = \\partial_\\xi \\partial_t x$, which translates to $\\partial_t J = \\partial_\\xi w$. The derivation above shows that satisfying this identity is a prerequisite for the mapped conservation law to correctly handle a trivial (uniform) physical state without generating spurious sources or sinks.\n\n### The Discrete GCL and Spurious Sources\n\nWhen the ALE equation is discretized, for example, using a finite volume method, the semi-discrete form for a cell $i$ is:\n$$\n\\frac{d(J_i U_i)}{dt} + \\frac{\\tilde{\\mathcal{F}}_{i+1/2} - \\tilde{\\mathcal{F}}_{i-1/2}}{\\Delta \\xi} = 0\n$$\nwhere $\\tilde{\\mathcal{F}}_{i \\pm 1/2}$ are the numerical fluxes at cell faces. When considering a uniform state $U_i = U_0$ for all $i$, the physical flux term $F(U_0)$ is constant, and the numerical flux reduces to the contribution from the grid velocity: $\\tilde{\\mathcal{F}}_{i \\pm 1/2} \\approx -w_{i \\pm 1/2} U_0$. The spatial derivative term becomes approximately $-U_0 D_{\\xi}w_i$, where $D_{\\xi}w_i$ is a discrete approximation of $\\partial_\\xi w$ at cell center $i$.\nIf we discretize the time derivative using a simple forward difference, the fully discrete equation for a single time step is:\n$$\n\\frac{(J U)_i^{n+1} - (J U)_i^n}{\\Delta t} + (D_{\\xi}(F - wU))_i^{n+1/2} \\approx 0\n$$\nFor a uniform state $U_0$, we demand that $U_i^{n+1} = U_i^n = U_0$. The equation becomes:\n$$\n\\frac{J_i^{n+1} U_0 - J_i^n U_0}{\\Delta t} - U_0 (D_{\\xi}w)_i^{n+1/2} = \\text{Residual}_i\n$$\nFactoring out $U_0$ and rearranging, the residual or spurious source term $S_i$ is:\n$$\nS_i = U_0 \\left( \\frac{J_i^{n+1} - J_i^n}{\\Delta t} - (D_{\\xi}w)_i^{n+1/2} \\right)\n$$\nThis shows that for the source term to be zero, the term in parentheses must be zero. That is, the discrete approximation used for $\\partial_t J$ must be precisely equal to the discrete approximation used for $\\partial_\\xi w$. This is the Discrete GCL.\n\nThe problem investigates three choices for the discrete $\\partial_t J$ term:\n1.  **Omitted ($J_t^{\\text{omit}} = 0$)**: This is equivalent to assuming a static grid, which is incorrect. It leads to a large, first-order error, creating a spurious source $S_i = -U_0 (D_{\\xi}w)_i^{n+1/2}$. This error does not vanish as the grid or time step is refined.\n2.  **Naive ($J_t^{\\text{naive}}$)**: A standard finite difference for $\\partial_t J$ is used, e.g., $\\frac{J^{n+1}-J^n}{\\Delta t}$. This is consistent in the limit ($\\Delta t \\to 0$), but for a finite $\\Delta t$, its truncation error will not in general cancel the truncation error of the spatial scheme $D_{\\xi}w$. This leaves a residual source term of the order of the discretization error, $S_i = U_0 \\times O(\\Delta t^2, \\Delta\\xi^2)$. This source term vanishes upon refinement but can still be significant on practical grids.\n3.  **GCL-satisfying ($J_t^{\\text{gcl}}$)**: The discrete $\\partial_t J$ is *defined* to be equal to the discrete $\\partial_\\xi w$. That is, $J_t^{\\text{gcl}} = D_{\\xi}w^{n+1/2}$. This forces the term in parentheses to be zero by construction, guaranteeing that the spurious source $S_i$ is identically zero (to machine precision). This is the standard practice in robust ALE solvers to ensure free-stream preservation.\n\nThe numerical experiment will quantify the magnitude of these spurious sources for the different approaches. The results for mass ($U_0 = \\rho_0 = 1$) and energy ($U_0 = E_0 = 2.5$) will be related by a simple factor of $2.5$, as the source term is linear in $U_0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the L2 norm of spurious sources introduced in an ALE scheme\n    due to violations of the Discrete Geometric Conservation Law (GCL).\n    \"\"\"\n    # Global parameters\n    omega = 2.0 * np.pi\n    rho0 = 1.0\n    E0 = 2.5\n    t_n = 0.37\n    dt = 0.01\n\n    # Derived time levels\n    t_np1 = t_n + dt\n    t_mid = t_n + dt / 2.0\n\n    # Test suite\n    test_cases = [\n        # (a, k, N)\n        (0.0, 1, 64),    # Case 1: Static grid baseline\n        (0.5, 1, 64),    # Case 2: Moderate motion, fundamental mode\n        (0.5, 8, 32),    # Case 3: Coarse grid, high spatial frequency\n        (0.5, 8, 256),   # Case 4: Fine grid, high spatial frequency\n        (0.9, 3, 64),    # Case 5: Strong motion near monotonicity limit\n    ]\n\n    # Functions for the mapping properties\n    def J_func(xi, t, a, k):\n        return 1.0 + a * np.cos(2.0 * np.pi * k * xi) * np.sin(omega * t)\n\n    def w_func(xi, t, a, k):\n        # The w function is d(x)/dt, where x = xi + a/(2*pi*k) * sin(2*pi*k*xi) * sin(omega*t)\n        # d(x)/dt = a/(2*pi*k) * sin(2*pi*k*xi) * omega * cos(omega*t)\n        # With omega = 2*pi, this simplifies to (a/k) * sin(2*pi*k*xi) * cos(omega*t)\n        if k == 0:\n            return np.zeros_like(xi)\n        return (a / k) * np.sin(2.0 * np.pi * k * xi) * np.cos(omega * t)\n\n    results = []\n\n    for a, k, N in test_cases:\n        # 1. Set up the computational grid\n        dxi = 1.0 / N\n        xi_grid = (np.arange(N) + 0.5) / N\n\n        # 2. Calculate the GCL-defining term: a discrete version of d(w)/d(xi)\n        # Evaluate w at cell centers at the mid-time t^{n+1/2}\n        w_mid = w_func(xi_grid, t_mid, a, k)\n\n        # Compute spatial derivative D_xi(w) using a periodic centered difference\n        # D_xi(f_i) = (f_{i+1} - f_{i-1}) / (2 * dxi)\n        w_plus_1 = np.roll(w_mid, -1)\n        w_minus_1 = np.roll(w_mid, 1)\n        dw_dxi_gcl_def = (w_plus_1 - w_minus_1) / (2.0 * dxi)\n\n        # 3. Calculate the three approximations for d(J)/d(t)\n        \n        # a) Omitted term\n        Jt_omit = np.zeros(N)\n\n        # b) Naive finite-difference in time\n        J_n = J_func(xi_grid, t_n, a, k)\n        J_np1 = J_func(xi_grid, t_np1, a, k)\n        Jt_naive = (J_np1 - J_n) / dt\n\n        # c) GCL-satisfying choice (defined to match the discrete d(w)/d(xi))\n        Jt_gcl = dw_dxi_gcl_def\n\n        # 4. Calculate the spurious source vectors for mass and energy\n        # S = U0 * (Jt_approx - D_xi(w))\n        \n        # Mass sources (U0 = rho0)\n        S_mass_omit = rho0 * (Jt_omit - dw_dxi_gcl_def)\n        S_mass_naive = rho0 * (Jt_naive - dw_dxi_gcl_def)\n        S_mass_gcl = rho0 * (Jt_gcl - dw_dxi_gcl_def)\n        \n        # Energy sources (U0 = E0)\n        S_energy_omit = E0 * (Jt_omit - dw_dxi_gcl_def)\n        S_energy_naive = E0 * (Jt_naive - dw_dxi_gcl_def)\n        S_energy_gcl = E0 * (Jt_gcl - dw_dxi_gcl_def)\n\n        # 5. Compute the L2 norm of each source vector\n        # ||S||_2 = sqrt( sum(S_i^2 * dxi) )\n        norm = lambda s_vec: np.sqrt(np.sum(s_vec**2) * dxi)\n\n        case_results = [\n            norm(S_mass_omit),\n            norm(S_mass_naive),\n            norm(S_mass_gcl),\n            norm(S_energy_omit),\n            norm(S_energy_naive),\n            norm(S_energy_gcl),\n        ]\n        results.extend(case_results)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}