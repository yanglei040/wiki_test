{
    "hands_on_practices": [
        {
            "introduction": "在将控制方程从物理空间变换到计算空间时，正确处理源项是保证数值解精度的关键。本练习从最基本的积分变换原理出发，探讨一个简单的二维非均匀坐标变换。通过直接计算一个标量源项在物理控制体上的精确平均值，你将亲身体会到雅可比行列式 $J$ 在坐标变换中的核心作用——它不仅是一个几何缩放因子，更是一个决定局部权重的函数。这个实践旨在加深对源项积分变换物理本质的理解，并揭示了为何必须在计算域中进行雅可比加权平均。",
            "id": "3363957",
            "problem": "在计算流体动力学 (CFD) 中，源项通常在由非均匀坐标映射产生的物理控制体积上进行平均。考虑从计算坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的二维映射，由 $x(\\xi,\\eta)=\\xi$ 和 $y(\\xi,\\eta)=\\eta^{2}$ 给出。设矩形计算网格为 $\\xi\\in[\\xi_{a},\\xi_{b}]$ 和 $\\eta\\in[\\eta_{a},\\eta_{b}]$，其中 $0 < \\eta_{a} < \\eta_{b}$ 以确保一个非退化的、保向的映射。对于标量源项 $S(x,y)=x+y$，通过面积加权平均的基本概念来定义物理空间中的精确网格平均值，\n$$\\overline{S}=\\frac{1}{A}\\iint_{\\Omega}S(x,y)\\,dA,$$\n其中 $A=\\iint_{\\Omega}dA$ 是映射后网格 $\\Omega$ 的物理面积。\n\n仅从 $\\overline{S}$ 的定义和积分的变量替换定理出发，并且不使用任何未声明的快捷公式，推导出一个用 $\\xi_{a}$、$\\xi_{b}$、$\\eta_{a}$ 和 $\\eta_{b}$ 表示的 $\\overline{S}$ 的闭式表达式。您必须考虑与映射 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 相关联的雅可比行列式 $J(\\xi,\\eta)$，并且必须以符号形式携带 $J(\\xi,\\eta)$ 进行运算，直到其代入被该映射证明是合理的。请清楚地展示 $J(\\xi,\\eta)$ 关于 $\\eta$ 的非均匀性如何相对于均匀计算平均影响平均过程。\n\n请提供您的最终答案，作为用 $\\xi_{a}$、$\\xi_{b}$、$\\eta_{a}$ 和 $\\eta_{b}$ 表示 $\\overline{S}$ 的单个简化解析表达式。不需要进行数值计算或四舍五入。最终表达式中不要包含单位。",
            "solution": "该问题要求推导物理空间中网格平均源项 $\\overline{S}$ 的闭式表达式。出发点是在物理网格区域 $\\Omega$ 上的平均值的形式化定义：\n$$ \\overline{S} = \\frac{1}{A} \\iint_{\\Omega} S(x,y) \\, dA $$\n其中 $A = \\iint_{\\Omega} dA$ 是网格的物理面积。计算过程涉及使用所提供的映射，将这些积分从物理坐标 $(x,y)$ 转换到计算坐标 $(\\xi,\\eta)$。\n\n映射由 $x(\\xi,\\eta) = \\xi$ 和 $y(\\xi,\\eta) = \\eta^2$ 给出。计算空间中的积分域是矩形 $R = \\{(\\xi,\\eta) \\mid \\xi_a \\le \\xi \\le \\xi_b, \\eta_a \\le \\eta \\le \\eta_b \\}$。源项为 $S(x,y) = x+y$。\n\n首先，我们必须计算坐标变换的雅可比行列式。雅可比矩阵 $\\mathbf{J}$ 定义为：\n$$ \\mathbf{J}(\\xi,\\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} $$\n根据映射函数计算偏导数：\n$$ \\frac{\\partial x}{\\partial \\xi} = 1, \\quad \\frac{\\partial x}{\\partial \\eta} = 0 $$\n$$ \\frac{\\partial y}{\\partial \\xi} = 0, \\quad \\frac{\\partial y}{\\partial \\eta} = 2\\eta $$\n雅可比行列式，记为 $J(\\xi,\\eta)$，是该矩阵的行列式：\n$$ J(\\xi,\\eta) = \\det(\\mathbf{J}) = (1)(2\\eta) - (0)(0) = 2\\eta $$\n问题陈述 $0  \\eta_a  \\eta_b$，这确保了对于积分区间 $[\\eta_a, \\eta_b]$ 中的任何 $\\eta$，$J(\\xi,\\eta) = 2\\eta > 0$。这证实了该映射是非退化和保向的。\n\n二重积分的变量替换定理表明 $\\iint_{\\Omega} f(x,y) \\, dA = \\iint_{R} f(x(\\xi,\\eta), y(\\xi,\\eta)) |J(\\xi,\\eta)| \\,d\\xi \\,d\\eta$。由于 $J(\\xi,\\eta) > 0$，绝对值是不必要的，面积元变换为 $dA = J(\\xi,\\eta) \\, d\\xi \\, d\\eta = 2\\eta \\, d\\xi \\, d\\eta$。\n\n我们接下来计算面积 $A$ 和积分后的源项，我们将其记为 $I_S = \\iint_{\\Omega} S(x,y) \\, dA$。\n\n首先，我们计算面积 $A$：\n$$ A = \\iint_{\\Omega} dA = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} J(\\xi,\\eta) \\, d\\xi \\, d\\eta $$\n代入 $J(\\xi,\\eta) = 2\\eta$：\n$$ A = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} 2\\eta \\, d\\xi \\, d\\eta $$\n我们首先对 $\\xi$ 积分：\n$$ A = \\int_{\\eta_a}^{\\eta_b} [2\\eta\\xi]_{\\xi=\\xi_a}^{\\xi=\\xi_b} \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} 2\\eta(\\xi_b - \\xi_a) \\, d\\eta $$\n现在，我们对 $\\eta$ 积分：\n$$ A = 2(\\xi_b - \\xi_a) \\int_{\\eta_a}^{\\eta_b} \\eta \\, d\\eta = 2(\\xi_b - \\xi_a) \\left[ \\frac{\\eta^2}{2} \\right]_{\\eta=\\eta_a}^{\\eta=\\eta_b} $$\n$$ A = 2(\\xi_b - \\xi_a) \\left( \\frac{\\eta_b^2}{2} - \\frac{\\eta_a^2}{2} \\right) = (\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) $$\n\n接下来，我们计算积分后的源项 $I_S$。我们必须首先用计算坐标表示源项 $S(x,y)$：\n$$ S(x(\\xi,\\eta), y(\\xi,\\eta)) = x(\\xi,\\eta) + y(\\xi,\\eta) = \\xi + \\eta^2 $$\n那么积分 $I_S$ 为：\n$$ I_S = \\iint_{\\Omega} (x+y) \\, dA = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (\\xi + \\eta^2) J(\\xi,\\eta) \\, d\\xi \\, d\\eta $$\n代入 $J(\\xi,\\eta) = 2\\eta$：\n$$ I_S = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (\\xi + \\eta^2)(2\\eta) \\, d\\xi \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} \\int_{\\xi_a}^{\\xi_b} (2\\xi\\eta + 2\\eta^3) \\, d\\xi \\, d\\eta $$\n对 $\\xi$ 积分：\n$$ I_S = \\int_{\\eta_a}^{\\eta_b} \\left[ \\xi^2\\eta + 2\\xi\\eta^3 \\right]_{\\xi=\\xi_a}^{\\xi=\\xi_b} \\, d\\eta = \\int_{\\eta_a}^{\\eta_b} \\left( (\\xi_b^2 - \\xi_a^2)\\eta + 2(\\xi_b - \\xi_a)\\eta^3 \\right) \\, d\\eta $$\n现在，对 $\\eta$ 积分：\n$$ I_S = \\left[ (\\xi_b^2 - \\xi_a^2)\\frac{\\eta^2}{2} + 2(\\xi_b - \\xi_a)\\frac{\\eta^4}{4} \\right]_{\\eta=\\eta_a}^{\\eta=\\eta_b} $$\n$$ I_S = (\\xi_b^2 - \\xi_a^2)\\left(\\frac{\\eta_b^2 - \\eta_a^2}{2}\\right) + (\\xi_b - \\xi_a)\\left(\\frac{\\eta_b^4 - \\eta_a^4}{2}\\right) $$\n为了简化此表达式，我们使用平方差分解：$\\xi_b^2 - \\xi_a^2 = (\\xi_b - \\xi_a)(\\xi_b + \\xi_a)$ 和 $\\eta_b^4 - \\eta_a^4 = (\\eta_b^2 - \\eta_a^2)(\\eta_b^2 + \\eta_a^2)$。\n$$ I_S = \\frac{1}{2}(\\xi_b - \\xi_a)(\\xi_b + \\xi_a)(\\eta_b^2 - \\eta_a^2) + \\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)(\\eta_b^2 + \\eta_a^2) $$\n提取公因式 $\\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)$：\n$$ I_S = \\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) \\left[ (\\xi_b + \\xi_a) + (\\eta_b^2 + \\eta_a^2) \\right] $$\n\n最后，我们通过将 $I_S$ 除以 $A$ 来计算网格平均源项 $\\overline{S}$：\n$$ \\overline{S} = \\frac{I_S}{A} = \\frac{\\frac{1}{2}(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2) \\left[ \\xi_a + \\xi_b + \\eta_a^2 + \\eta_b^2 \\right]}{(\\xi_b - \\xi_a)(\\eta_b^2 - \\eta_a^2)} $$\n由于计算网格是非退化的，我们有 $\\xi_a \\neq \\xi_b$ 和 $\\eta_a \\neq \\eta_b$，所以项 $(\\xi_b - \\xi_a)$ 和 $(\\eta_b^2 - \\eta_a^2)$ 非零，可以消去。这得出了最终表达式：\n$$ \\overline{S} = \\frac{1}{2}(\\xi_a + \\xi_b + \\eta_a^2 + \\eta_b^2) $$\n这个表达式可以重写为：\n$$ \\overline{S} = \\frac{\\xi_a + \\xi_b}{2} + \\frac{\\eta_a^2 + \\eta_b^2}{2} $$\n项 $\\frac{\\xi_a + \\xi_b}{2}$ 是 $x = \\xi$ 在网格面上的值的算术平均值。项 $\\frac{\\eta_a^2 + \\eta_b^2}{2}$ 是 $y=\\eta^2$ 在网格面上的值的算术平均值。\n\n问题要求说明 $J(\\xi,\\eta)$ 的非均匀性如何影响结果。雅可比行列式 $J(\\xi,\\eta) = 2\\eta$ 不是均匀的；它随 $\\eta$ 变化。它的作用是作为一个权重函数。物理上正确的平均不是 $S=\\xi+\\eta^2$ 在计算网格上的平均，而是一个加权平均，其中权重是雅可比行列式，表示物理面积与计算面积的局部比率。\n正确的平均值是 $\\overline{S} = \\frac{\\iint S J \\,d\\xi d\\eta}{\\iint J \\,d\\xi d\\eta}$。\n因为 $J$ 与 $\\xi$ 无关，所以在 $\\xi$ 方向上的平均是均匀的，得到标准平均值 $\\frac{\\xi_a+\\xi_b}{2}$。\n然而，因为 $J$ 是 $\\eta$ 的函数，所以在 $\\eta$ 方向上的平均是加权的。$y = \\eta^2$ 项的平均值为 $\\frac{\\int \\eta^2 J \\,d\\eta}{\\int J \\,d\\eta} = \\frac{\\int_{\\eta_a}^{\\eta_b} \\eta^2(2\\eta) \\,d\\eta}{\\int_{\\eta_a}^{\\eta_b} 2\\eta \\,d\\eta} = \\frac{[\\eta^4/2]_{\\eta_a}^{\\eta_b}}{[\\eta^2]_{\\eta_a}^{\\eta_b}} = \\frac{(\\eta_b^4-\\eta_a^4)/2}{\\eta_b^2-\\eta_a^2} = \\frac{\\eta_a^2 + \\eta_b^2}{2}$。\n如果有人天真地在计算域中对 $S=\\xi+\\eta^2$ 进行平均（即，使用均匀的雅可比行列式 $J=1$），那么 $\\eta^2$ 部分的平均值将为 $\\frac{\\int_{\\eta_a}^{\\eta_b} \\eta^2 \\,d\\eta}{\\int_{\\eta_a}^{\\eta_b} 1 \\,d\\eta} = \\frac{[\\eta^3/3]_{\\eta_a}^{\\eta_b}}{[\\eta]_{\\eta_a}^{\\eta_b}} = \\frac{\\eta_b^3-\\eta_a^3}{3(\\eta_b-\\eta_a)} = \\frac{\\eta_a^2 + \\eta_a\\eta_b + \\eta_b^2}{3}$。这个结果与物理上正确的结果不同。非均匀的雅可比行列式正确地为较大 $\\eta$ 处的 $S$ 值赋予了更大的权重，在这些地方物理面积被更显著地拉伸。",
            "answer": "$$ \\boxed{\\frac{\\xi_{a} + \\xi_{b} + \\eta_{a}^{2} + \\eta_{b}^{2}}{2}} $$"
        },
        {
            "introduction": "将连续的守恒律离散化到曲线网格上时，我们必须确保离散算子能够精确地再现均匀流场（即无物理变化的自由流）。这个要求被称为几何守恒律（GCL）。本练习通过构造一个“人造解”的巧妙方法，让你在一个一维谱元上构建一个违反守恒的离散反例。你将看到，当源项的求积方式与通量梯度的离散格式不一致时，即使在连续层面完全守恒的方程，也会在离散层面产生虚假的残差。通过对比非守恒格式和修正后的守恒格式，本练习将揭示为何在离散化过程中保持度量项（即雅可比行列式 $J$）的一致性是至关重要的。",
            "id": "3363913",
            "problem": "考虑一维空间中的单个谱元，其计算坐标 $\\xi \\in [-1,1]$ 通过等参变换 $x(\\xi) = \\xi + \\alpha \\xi^{2}$ 映射到物理坐标 $x$，其中 $\\alpha \\in \\left(-\\frac{1}{2}, \\frac{1}{2}\\right)$，使得映射非奇异且雅可比 $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\xi$ 保持为正。物理空间中的稳态标量守恒律以变换后的守恒形式写作\n$$\n\\frac{d}{d\\xi} g(\\xi) = J(\\xi) s(\\xi),\n$$\n其中 $g(\\xi)$ 是逆变通量，$s(\\xi)$ 是单位物理体积的源项，且元素上的守恒积分形式为\n$$\n\\int_{-1}^{1} J(\\xi)\\, s(\\xi)\\, d\\xi = g(1) - g(-1).\n$$\n使用此基本积分守恒律和坐标变换下的雅可比定义，通过选择 $g(\\xi) = \\xi$ 和 $s(\\xi) = \\frac{1}{J(\\xi)}$ 来定义一个构造的一致解，这会得到精确的连续守恒 $\\int_{-1}^{1} J(\\xi)\\, s(\\xi)\\, d\\xi = 2$ 和 $g(1) - g(-1) = 2$。\n\n现在构造一个离散反例，当源项求积与雅可比不一致时，该反例违反了守恒。具体来说，使用在 $\\xi_{-} = -1$ 和 $\\xi_{+} = 1$ 处的双节点Gauss–Lobatto求积（权重为 $w_{-} = 1$ 和 $w_{+} = 1$）来近似通量散度积分 $\\int_{-1}^{1} \\frac{d}{d\\xi} g(\\xi)\\, d\\xi$，将被积函数设为 $\\frac{d}{d\\xi} g(\\xi)$；并错误地将源项积分 $\\int_{-1}^{1} J(\\xi) s(\\xi)\\, d\\xi$ 近似为 $\\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k})$，即在求积中从源项被积函数中省略雅可比。将这种不一致的源项求积下产生的离散守恒残差表示为\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k}).\n$$\n然后，通过使用相同的求积法，但在被积函数中一致地包含雅可比来计算源项积分，即 $\\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k})$，从而提出一个度量一致的修正，并定义修正后的残差\n$$\nR_{\\mathrm{corrected}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k}).\n$$\n仅使用基本定义和构造选择 $g(\\xi) = \\xi$ 和 $s(\\xi) = \\frac{1}{J(\\xi)}$，推导出 $R_{\\mathrm{inconsistent}}(\\alpha)$ 和 $R_{\\mathrm{corrected}}(\\alpha)$ 关于 $\\alpha$ 的显式闭式解析表达式。你的最终答案必须以包含 $R_{\\mathrm{inconsistent}}(\\alpha)$ 和 $R_{\\mathrm{corrected}}(\\alpha)$ 的行矩阵形式给出，无需单位，也无需四舍五入。",
            "solution": "该问题经检验在科学上是合理的、适定的、客观且完整的。它提出了一个计算流体动力学中数值分析的标准练习，具体涉及几何守恒律和坐标变换下源项的正确处理。我们接下来推导不一致和修正后的离散残差的解析表达式。\n\n目标是计算 $R_{\\mathrm{inconsistent}}(\\alpha)$ 和 $R_{\\mathrm{corrected}}(\\alpha)$ 的表达式。两个残差都定义为一个离散通量散度项和一个离散源项之差。我们将使用所给定义系统地计算这些项。\n\n给出的定义如下：\n- 坐标映射：$x(\\xi) = \\xi + \\alpha \\xi^{2}$\n- 雅可比：$J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\xi$\n- 构造的通量：$g(\\xi) = \\xi$\n- 构造的源项：$s(\\xi) = \\frac{1}{J(\\xi)} = \\frac{1}{1 + 2 \\alpha \\xi}$\n- 求积节点：$\\xi_{-} = -1$, $\\xi_{+} = 1$\n- 求积权重：$w_{-} = 1$, $w_{+} = 1$\n\n离散残差为：\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k})\n$$\n$$\nR_{\\mathrm{corrected}}(\\alpha) = \\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{d}{d\\xi} g(\\xi)\\right|_{\\xi=\\xi_{k}} \\;-\\; \\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k})\n$$\n\n首先，我们计算离散通量散度项，这在两个残差定义中是共有的。被积函数是通量函数 $g(\\xi)$ 的导数。\n给定 $g(\\xi) = \\xi$，其关于 $\\xi$ 的导数为：\n$$\n\\frac{dg}{d\\xi} = 1\n$$\n这个导数是一个常数。我们在两个节点的Gauss-Lobatto求积点 $\\xi_{-} = -1$ 和 $\\xi_{+} = 1$ 处对其求值，并将结果乘以相应的权重 $w_{-} = 1$ 和 $w_{+} = 1$ 后求和。\n离散通量散度项为：\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, \\left.\\frac{dg}{d\\xi}\\right|_{\\xi=\\xi_{k}} = w_{-} \\left(\\left.\\frac{dg}{d\\xi}\\right|_{\\xi=-1}\\right) + w_{+} \\left(\\left.\\frac{dg}{d\\xi}\\right|_{\\xi=1}\\right) = (1)(1) + (1)(1) = 2\n$$\n\n接下来，我们计算 $R_{\\mathrm{inconsistent}}(\\alpha)$ 的不一致离散源项。该项错误地从求积被积函数中省略了雅可比。\n要求和的项是 $s(\\xi) = \\frac{1}{1 + 2 \\alpha \\xi}$。我们在求积点处对此求值：\n$$\ns(\\xi_{-}) = s(-1) = \\frac{1}{1 + 2 \\alpha (-1)} = \\frac{1}{1 - 2\\alpha}\n$$\n$$\ns(\\xi_{+}) = s(1) = \\frac{1}{1 + 2 \\alpha (1)} = \\frac{1}{1 + 2\\alpha}\n$$\n不一致的源项是加权和：\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, s(\\xi_{k}) = w_{-} s(-1) + w_{+} s(1) = (1)\\left(\\frac{1}{1 - 2\\alpha}\\right) + (1)\\left(\\frac{1}{1 + 2\\alpha}\\right)\n$$\n将分数通分：\n$$\n\\frac{1 + 2\\alpha}{(1 - 2\\alpha)(1 + 2\\alpha)} + \\frac{1 - 2\\alpha}{(1 - 2\\alpha)(1 + 2\\alpha)} = \\frac{(1 + 2\\alpha) + (1 - 2\\alpha)}{1 - (2\\alpha)^2} = \\frac{2}{1 - 4\\alpha^2}\n$$\n\n现在我们组合出 $R_{\\mathrm{inconsistent}}(\\alpha)$ 的表达式：\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = (\\text{离散通量散度}) - (\\text{不一致源项}) = 2 - \\frac{2}{1 - 4\\alpha^2}\n$$\n为了得到一个单一的分数表达式：\n$$\nR_{\\mathrm{inconsistent}}(\\alpha) = \\frac{2(1 - 4\\alpha^2) - 2}{1 - 4\\alpha^2} = \\frac{2 - 8\\alpha^2 - 2}{1 - 4\\alpha^2} = \\frac{-8\\alpha^2}{1 - 4\\alpha^2}\n$$\n\n最后，我们计算 $R_{\\mathrm{corrected}}(\\alpha)$ 的修正离散源项。该项正确地在求积被积函数中包含了雅可比 $J(\\xi)$。\n要求和的项是 $J(\\xi) s(\\xi)$。根据构造源项的定义，$s(\\xi) = \\frac{1}{J(\\xi)}$。因此，乘积为：\n$$\nJ(\\xi) s(\\xi) = (1 + 2\\alpha\\xi) \\left(\\frac{1}{1 + 2\\alpha\\xi}\\right) = 1\n$$\n对于域中所有的 $\\xi$，该乘积是一个常数值 $1$。\n修正后的源项是在求积点处对此乘积求值的加权和：\n$$\n\\sum_{k \\in \\{-,+\\}} w_{k}\\, J(\\xi_{k})\\, s(\\xi_{k}) = w_{-} (1) + w_{+} (1) = (1)(1) + (1)(1) = 2\n$$\n\n现在我们组合出 $R_{\\mathrm{corrected}}(\\alpha)$ 的表达式：\n$$\nR_{\\mathrm{corrected}}(\\alpha) = (\\text{离散通量散度}) - (\\text{修正后源项}) = 2 - 2 = 0\n$$\n修正后的残差恒为零，这表明对于此构造解，度量一致的求积在离散层面上保持了连续方程的守恒性质。这是因为对于被积函数 $\\frac{dg}{d\\xi}=1$ 和 $J(\\xi)s(\\xi)=1$，该求积法则是精确的。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{-8\\alpha^{2}}{1 - 4\\alpha^{2}}  0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在许多物理问题中，数值格式不仅需要满足守恒性，还需要能够精确地维持特定的物理平衡状态，例如大气模型中的静力平衡。这类格式被称为“均匀流保持”或“良态平衡”（well-balanced）格式。本练习将你带入一个真实而富有挑战性的场景：在地形跟随坐标系下模拟静止的大气。你将发现，重力源项与因坐标变换而产生的压力梯度度量项之间必须达到精确的离散平衡。任何微小的不匹配都会破坏平衡，产生虚假的流动。通过这个实践，你将理解为何在处理具有大源项且相互拮抗的问题时，发展良态平衡格式是保证模拟真实性的关键。",
            "id": "3363968",
            "problem": "考虑一个二维空间中的稳定静水大气，其物理坐标为 $(x,z)$，计算（地形追随）坐标为 $(\\xi,\\eta)$。物理空间中的静水力学平衡由基本平衡关系给出\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g,\n$$\n其中 $p$ 是压力，单位为 $\\mathrm{Pa}$；$\\rho$ 是质量密度，单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$；$g$ 是重力加速度，单位为 $\\mathrm{m}\\,\\mathrm{s}^{-2}$。在计算流体动力学（CFD）的数值求解器中，通常的做法是将控制方程转换到曲线地形追随坐标系中，以便更好地表示复杂的地形。在坐标变换 $(\\xi,\\eta) \\mapsto (x,z)$ 下，局部雅可比行列式为 $J(\\xi,\\eta)$，垂直压力梯度项变换为\n$$\n\\frac{\\partial p}{\\partial z} = \\frac{1}{J(\\xi,\\eta)} \\frac{\\partial p}{\\partial \\eta},\n$$\n前提是 $x = \\xi$ 且 $p$ 仅依赖于 $z$。垂直动量方程中的重力源项保持为 $S_\\rho = - \\rho g$，而静水平衡要求度量修正后的压力梯度精确抵消此源项。\n\n定义人造的地形追随映射为\n$$\nx(\\xi,\\eta) = \\xi,\n\\quad\nz(\\xi,\\eta) = Z_{\\text{top}} \\left[ \\eta + \\alpha \\sin\\!\\left( 2\\pi \\xi \\right) \\eta (1 - \\eta) \\right],\n$$\n其中有一个可调参数 $\\alpha \\in [0,1)$，它控制地形扭曲的幅度，还有一个垂直域高 $Z_{\\text{top}}$，单位为 $\\mathrm{m}$。该映射的雅可比行列式为\n$$\nJ(\\xi,\\eta) = \\frac{\\partial z}{\\partial \\eta} = Z_{\\text{top}}\\left[1 + \\alpha \\sin\\!\\left(2\\pi \\xi\\right) (1 - 2\\eta) \\right].\n$$\n三角函数中的角度以弧度为单位。\n\n构建一个验证案例，以评估在此映射下，度量修正后的压力梯度与重力源项之间的精确抵消情况。具体来说，对于满足静水平衡的场 $p(z)$ 和 $\\rho(z)$，连续残差\n$$\nR_{\\text{analytic}}(\\xi,\\eta) = \\frac{1}{J(\\xi,\\eta)} \\frac{\\partial p}{\\partial \\eta} + \\rho g\n$$\n必须恒等于零。对于一个在均匀计算网格上通过有限差分来近似 $\\partial p/\\partial \\eta$ 的离散格式，离散残差\n$$\nR_{\\text{discrete}}(\\xi,\\eta) = \\frac{1}{J(\\xi,\\eta)} \\left( \\frac{\\partial p}{\\partial \\eta} \\right)_{\\text{FD}} + \\rho g\n$$\n通常不为零，并且如果度量项处理得当，它应随着网格加密而减小。\n\n您的任务是实现一个完整、可运行的程序，该程序能够：\n- 在 $[0,1]\\times[0,1]$ 上构建一个包含 $N_\\xi$ 和 $N_\\eta$ 个点的 $(\\xi,\\eta)$ 均匀网格。\n- 对于下面列出的每个测试用例，在网格上计算 $z(\\xi,\\eta)$、$J(\\xi,\\eta)$、$p(z)$、$\\rho(z)$ 以及 $R_{\\text{analytic}}(\\xi,\\eta)$ 和 $R_{\\text{discrete}}(\\xi,\\eta)$。\n- 使用链式法则计算用于 $R_{\\text{analytic}}$ 的 $\\partial p/\\partial \\eta$，即 $\\partial p/\\partial \\eta = (\\partial p/\\partial z) (\\partial z/\\partial \\eta)$；并对内部点使用二阶中心有限差分，对边界点使用一阶单边有限差分来计算 $\\left( \\frac{\\partial p}{\\partial \\eta} \\right)_{\\text{FD}}$。\n- 报告每个测试用例在整个网格上 $R_{\\text{analytic}}$ 和 $R_{\\text{discrete}}$ 的最大绝对值。\n\n使用以下物理常数和单位：\n- $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。\n- $\\sin$ 和 $\\cos$ 中的角度以弧度为单位。\n- 所有残差必须以 $\\mathrm{N}\\,\\mathrm{m}^{-3}$ 为单位报告。\n\n使用以下具有科学真实参数的测试套件，以检验变换源项处理的不同方面：\n- 案例1（理想情况，中等地形扭曲，等温大气）：\n  - $Z_{\\text{top}} = 10000\\,\\mathrm{m}$，$\\alpha = 0.2$。\n  - 等温大气：$p(z) = p_0 \\exp\\!\\left( - z / H \\right)$，$\\rho(z) = p(z) / (R T)$。\n  - 常数：$p_0 = 101325\\,\\mathrm{Pa}$，$T = 288\\,\\mathrm{K}$，$R = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，$H = R T / g$。\n- 案例2（无地形扭曲）：\n  - $Z_{\\text{top}} = 10000\\,\\mathrm{m}$，$\\alpha = 0.0$。\n  - 等温大气同案例1。\n- 案例3（接近奇异的度量应力，大扭曲幅度）：\n  - $Z_{\\text{top}} = 10000\\,\\mathrm{m}$，$\\alpha = 0.99$。\n  - 等温大气同案例1。\n- 案例4（人造非等温多项式静水场）：\n  - $Z_{\\text{top}} = 2000\\,\\mathrm{m}$，$\\alpha = 0.3$。\n  - 人造多项式压力：$p(z) = p_0 + a_1 z + a_2 z^2$，其中 $p_0 = 120000\\,\\mathrm{Pa}$，$a_1 = - \\rho_0 g$，$a_2 = 0.05\\,\\mathrm{Pa}\\,\\mathrm{m}^{-2}$，且 $\\rho_0 = 1.225\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n  - 定义 $\\rho(z) = - \\frac{1}{g} \\frac{\\partial p}{\\partial z} = - \\frac{1}{g}(a_1 + 2 a_2 z)$。\n\n网格规格：\n- 对 $\\xi$ 和 $\\eta$ 都在 $[0,1]$ 区间内使用 $N_\\xi = 101$ 和 $N_\\eta = 101$ 个均匀分布的点。\n\n最终输出规格：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号内由逗号分隔的列表，形式如下\n$$\n\\left[ [r_{1,a}, r_{1,d}], [r_{2,a}, r_{2,d}], [r_{3,a}, r_{3,d}], [r_{4,a}, r_{4,d}] \\right],\n$$\n其中 $r_{k,a}$ 是案例 $k$ 中 $R_{\\text{analytic}}$ 的最大绝对值，$r_{k,d}$ 是案例 $k$ 中 $R_{\\text{discrete}}$ 的最大绝对值。将每个 $r_{k,\\cdot}$ 表示为以 $\\mathrm{N}\\,\\mathrm{m}^{-3}$ 为单位的浮点数。",
            "solution": "起点是物理坐标 $(x,z)$ 中的静水力学平衡，它由以下公式控制\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g.\n$$\n这个关系是垂直压力梯度力与重力之间平衡的基本陈述，并构成了静止大气中垂直动量方程的基础。为了分析坐标变换下的源项处理，我们考虑一个人造但科学上一致的地形追随映射\n$$\nx(\\xi,\\eta) = \\xi,\n\\quad\nz(\\xi,\\eta) = Z_{\\text{top}}\\left[\\eta + \\alpha \\sin(2\\pi \\xi) \\eta (1 - \\eta) \\right].\n$$\n该映射保留了水平坐标（因此 $x = \\xi$）并通过一个平滑的、依赖于 $\\xi$ 的变形来修改垂直坐标 $z$。与 $\\eta$ 方向相关的雅可比行列式，它缩放了在常数 $\\xi$ 下的导数，为\n$$\nJ(\\xi,\\eta) = \\frac{\\partial z}{\\partial \\eta} = Z_{\\text{top}} \\left[ 1 + \\alpha \\sin(2\\pi \\xi) (1 - 2 \\eta) \\right].\n$$\n对于具有 $p = p(z)$ 和 $\\rho = \\rho(z)$ 的静水剖面，链式法则给出\n$$\n\\frac{\\partial p}{\\partial \\eta} = \\frac{\\partial p}{\\partial z} \\frac{\\partial z}{\\partial \\eta} = \\left( \\frac{\\partial p}{\\partial z} \\right) J(\\xi,\\eta).\n$$\n因此，度量修正形式下的变换压力梯度为\n$$\n\\frac{1}{J(\\xi,\\eta)} \\frac{\\partial p}{\\partial \\eta} = \\frac{1}{J(\\xi,\\eta)} \\left( \\frac{\\partial p}{\\partial z} \\right) J(\\xi,\\eta) = \\frac{\\partial p}{\\partial z}.\n$$\n代入静水平衡，我们得到\n$$\n\\frac{1}{J(\\xi,\\eta)} \\frac{\\partial p}{\\partial \\eta} + \\rho g = \\frac{\\partial p}{\\partial z} + \\rho g = 0,\n$$\n这表明，在连续情况下，变换后的压力梯度与重力源项 $S_\\rho = - \\rho g$ 精确抵消，且与由 $\\alpha$ 表征的地形扭曲无关。\n\n验证策略包括两个残差计算：\n- 一个使用精确导数的解析残差：\n$$\nR_{\\text{analytic}}(\\xi,\\eta) = \\frac{1}{J(\\xi,\\eta)} \\frac{\\partial p}{\\partial \\eta} + \\rho g = \\left( \\frac{\\partial p}{\\partial z} \\right) + \\rho g,\n$$\n如果 $p(z)$ 和 $\\rho(z)$ 满足静水平衡，该残差恒等于零。\n- 一个在均匀计算网格上使用有限差分近似 $\\partial p / \\partial \\eta$ 的离散残差：\n$$\nR_{\\text{discrete}}(\\xi,\\eta) = \\frac{1}{J(\\xi,\\eta)} \\left( \\frac{\\partial p}{\\partial \\eta} \\right)_{\\text{FD}} + \\rho g.\n$$\n我们对 $\\eta$ 方向的内部点采用二阶中心差分，\n$$\n\\left( \\frac{\\partial p}{\\partial \\eta} \\right)_{\\text{FD}} \\approx \\frac{p(\\xi,\\eta+\\Delta \\eta) - p(\\xi,\\eta - \\Delta \\eta)}{2 \\Delta \\eta},\n$$\n对边界点采用一阶单边差分，其中 $\\Delta \\eta = 1/(N_\\eta - 1)$ 且 $N_\\eta = 101$。\n\n该测试套件检验了不同的情况：\n- 案例1使用等温大气，其中 $p(z) = p_0 \\exp(-z/H)$ 且 $\\rho(z) = p(z)/(R T)$，这里 $H = R T / g$。静水关系成立，因为 $ \\frac{\\partial p}{\\partial z} = - \\frac{p_0}{H} e^{-z/H} = - \\rho g$。\n- 案例2通过设置 $\\alpha = 0$ 移除了地形扭曲；$J$ 变为常数 $J = Z_{\\text{top}}$，映射简化为均匀的垂直拉伸。静水平衡仍然成立。\n- 案例3将 $\\alpha$ 增加到接近 $1$，以产生大的度量变化，从而对 $\\eta$ 方向的数值微分施加压力，并突显对 $J$ 的敏感性。\n- 案例4使用人造的非等温多项式压力 $p(z) = p_0 + a_1 z + a_2 z^2$，并通过 $\\rho(z) = - \\frac{1}{g} \\frac{\\partial p}{\\partial z} = - \\frac{1}{g}(a_1 + 2 a_2 z)$ 强制执行静水平衡来定义 $\\rho(z)$，从而保证了解析上的精确抵消。\n\n算法步骤：\n1. 创建一个包含 $N_\\xi = 101$ 和 $N_\\eta = 101$ 个点的均匀网格 $(\\xi_i,\\eta_j)$。\n2. 对于每个案例，计算 $z(\\xi,\\eta)$ 和 $J(\\xi,\\eta)$。\n3. 根据案例定义 $p(z)$ 和 $\\rho(z)$。对于等温案例，使用 $p(z) = p_0 \\exp(-z/H)$ 和 $\\rho(z) = p(z)/(R T)$，其中 $H = R T / g$。对于多项式案例，使用 $p(z) = p_0 + a_1 z + a_2 z^2$ 和 $\\rho(z) = - (a_1 + 2 a_2 z)/g$。\n4. 通过直接使用 $\\frac{\\partial p}{\\partial z} = - \\rho g$ 或计算 $p(z)$ 的精确导数来计算解析残差 $R_{\\text{analytic}} = \\left( \\frac{\\partial p}{\\partial z} \\right) + \\rho g$。\n5. 在固定 $\\xi$ 的情况下，使用 $\\eta$ 方向的有限差分计算离散残差 $R_{\\text{discrete}} = \\frac{1}{J} \\left( \\frac{\\partial p}{\\partial \\eta} \\right)_{\\text{FD}} + \\rho g$。\n6. 报告每个案例在整个网格上 $R_{\\text{analytic}}$ 和 $R_{\\text{discrete}}$ 的最大绝对值。\n\n预期行为：\n- 对于所有案例，$R_{\\text{analytic}}$ 在浮点舍入误差范围内应为数值零，这表明在连续变换方程中度量-源项达到了精确平衡。\n- 对于案例1和案例2，$R_{\\text{discrete}}$ 应该很小，在案例3中由于强的度量可变性而增大，在案例4中则某种程度上依赖于 $z$ 的变化。离散残差反映了在计算坐标中应用有限差分所产生的截断误差以及随后的 $1/J$ 度量缩放。\n\n程序必须输出一行列表\n$$\n\\left[ [r_{1,a}, r_{1,d}], [r_{2,a}, r_{2,d}], [r_{3,a}, r_{3,d}], [r_{4,a}, r_{4,d}] \\right],\n$$\n其中每个 $r_{k,\\cdot}$ 是一个以 $\\mathrm{N}\\,\\mathrm{m}^{-3}$ 为单位的浮点数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_mapping_and_jacobian(Z_top, alpha, xi, eta):\n    \"\"\"\n    Compute the manufactured terrain-following mapping z(xi,eta) and its Jacobian J = dz/deta.\n    x = xi (identity), so only z and J are needed.\n    \"\"\"\n    z = Z_top * (eta + alpha * np.sin(2.0 * np.pi * xi) * eta * (1.0 - eta))\n    J = Z_top * (1.0 + alpha * np.sin(2.0 * np.pi * xi) * (1.0 - 2.0 * eta))\n    return z, J\n\ndef isothermal_fields(z, g=9.81, p0=101325.0, T=288.0, R=287.0):\n    \"\"\"\n    Construct isothermal hydrostatic fields:\n    p(z) = p0 * exp(-z / H), rho(z) = p(z) / (R*T), H = R*T/g.\n    Returns p, rho, and exact dp/dz (which equals -rho*g).\n    \"\"\"\n    H = R * T / g\n    p = p0 * np.exp(-z / H)\n    rho = p / (R * T)\n    dpdz = -rho * g  # exact hydrostatic derivative\n    return p, rho, dpdz\n\ndef polynomial_fields(z, g=9.81, p0=120000.0, rho0=1.225, a2=0.05):\n    \"\"\"\n    Manufactured polynomial hydrostatic fields:\n    p(z) = p0 + a1*z + a2*z^2, with a1 = -rho0*g,\n    rho(z) = -(a1 + 2*a2*z)/g, dp/dz = a1 + 2*a2*z.\n    Returns p, rho, and exact dp/dz.\n    \"\"\"\n    a1 = -rho0 * g\n    p = p0 + a1 * z + a2 * z**2\n    dpdz = a1 + 2.0 * a2 * z\n    rho = -(dpdz) / g\n    return p, rho, dpdz\n\ndef fd_dpdeta(p, d_eta):\n    \"\"\"\n    Compute finite-difference approximation to partial derivative of p with respect to eta (FD along axis 0).\n    Central differences for interior points; one-sided for boundaries.\n    p shape assumed (N_eta, N_xi).\n    \"\"\"\n    N_eta, N_xi = p.shape\n    dpdeta = np.zeros_like(p)\n    # interior central difference\n    dpdeta[1:-1, :] = (p[2:, :] - p[:-2, :]) / (2.0 * d_eta)\n    # boundaries one-sided\n    dpdeta[0, :] = (p[1, :] - p[0, :]) / d_eta\n    dpdeta[-1, :] = (p[-1, :] - p[-2, :]) / d_eta\n    return dpdeta\n\ndef case_runner(case):\n    \"\"\"\n    Run a single test case: compute z, J, fields, residuals (analytic and discrete), and return max abs values.\n    \"\"\"\n    # Grid\n    N_xi = 101\n    N_eta = 101\n    xi = np.linspace(0.0, 1.0, N_xi)\n    eta = np.linspace(0.0, 1.0, N_eta)\n    d_eta = eta[1] - eta[0]\n    XI, ETA = np.meshgrid(xi, eta, indexing='xy')  # XI: (N_eta,N_xi), ETA: (N_eta,N_xi)\n    # Mapping and Jacobian\n    z, J = compute_mapping_and_jacobian(case['Z_top'], case['alpha'], XI, ETA)\n    # Fields\n    if case['type'] == 'isothermal':\n        p, rho, dpdz = isothermal_fields(z, g=9.81, p0=case['p0'], T=case['T'], R=case['R'])\n    elif case['type'] == 'polynomial':\n        p, rho, dpdz = polynomial_fields(z, g=9.81, p0=case['p0'], rho0=case['rho0'], a2=case['a2'])\n    else:\n        raise ValueError(\"Unknown case type.\")\n    # Analytic residual: (dp/dz) + rho*g\n    g = 9.81\n    R_analytic = dpdz + rho * g\n    max_abs_R_analytic = float(np.max(np.abs(R_analytic)))\n    # Discrete residual: (1/J) * (dp/deta)_FD + rho*g\n    dpdeta_fd = fd_dpdeta(p, d_eta)\n    R_discrete = (dpdeta_fd / J) + rho * g\n    max_abs_R_discrete = float(np.max(np.abs(R_discrete)))\n    return [max_abs_R_analytic, max_abs_R_discrete]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: isothermal, moderate terrain distortion\n        {\n            'type': 'isothermal',\n            'Z_top': 10000.0,\n            'alpha': 0.2,\n            'p0': 101325.0,\n            'T': 288.0,\n            'R': 287.0\n        },\n        # Case 2: isothermal, no terrain distortion\n        {\n            'type': 'isothermal',\n            'Z_top': 10000.0,\n            'alpha': 0.0,\n            'p0': 101325.0,\n            'T': 288.0,\n            'R': 287.0\n        },\n        # Case 3: isothermal, near-singular metric (large distortion amplitude)\n        {\n            'type': 'isothermal',\n            'Z_top': 10000.0,\n            'alpha': 0.99,\n            'p0': 101325.0,\n            'T': 288.0,\n            'R': 287.0\n        },\n        # Case 4: polynomial manufactured hydrostatic fields\n        {\n            'type': 'polynomial',\n            'Z_top': 2000.0,\n            'alpha': 0.3,\n            'p0': 120000.0,\n            'rho0': 1.225,\n            'a2': 0.05\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        res = case_runner(case)\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Results are [[r1_a, r1_d],[r2_a, r2_d],[r3_a, r3_d],[r4_a, r4_d]]\n    # Ensure only the single-line output is printed.\n    def format_nested_list(lst):\n        # Use scientific notation for all floating point numbers to ensure consistency and precision.\n        return \"[\" + \",\".join(\"[\" + \",\".join(f\"{x:.12e}\" for x in sub) + \"]\" for sub in lst) + \"]\"\n    print(format_nested_list(results))\n\nsolve()\n```"
        }
    ]
}