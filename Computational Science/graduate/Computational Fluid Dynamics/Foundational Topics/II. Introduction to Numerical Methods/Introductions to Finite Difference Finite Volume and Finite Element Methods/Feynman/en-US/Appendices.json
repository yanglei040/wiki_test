{
    "hands_on_practices": [
        {
            "introduction": "Understanding numerical stability is a critical first step in evaluating any time-dependent numerical scheme. This exercise provides a foundational analysis of the explicit upwind scheme for the linear advection equation, a cornerstone model for transport phenomena. By applying the von Neumann stability analysis, you will derive the celebrated Courant–Friedrichs–Lewy (CFL) condition, which provides a rigorous link between the physical wave speed, the grid spacing, and the maximum allowable time step .",
            "id": "3337490",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant wave speed $a \\in \\mathbb{R}$ on a periodic spatial domain $x \\in [0,L]$. Let the spatial grid be uniform with spacing $h > 0$, and let the time step be $\\Delta t > 0$. Define the explicit upwind finite difference scheme that is consistent with the sign of $a$ by\nfor $a > 0$: $u_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{h}\\left(u_{j}^{n} - u_{j-1}^{n}\\right)$,\nfor $a < 0$: $u_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{h}\\left(u_{j+1}^{n} - u_{j}^{n}\\right)$,\nwhere $u_{j}^{n}$ approximates $u(x_{j}, t^{n})$ with $x_{j} = j h$ and $t^{n} = n \\Delta t$. Starting from the governing equation $u_{t} + a\\,u_{x} = 0$ and the above discrete update, perform a von Neumann stability analysis (also called Fourier or von Neumann stability analysis) by assuming a discrete Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})$ with wavenumber $\\kappa \\in \\mathbb{R}$ and periodic boundary conditions. Derive the corresponding amplification factor $G(\\kappa)$ and enforce the stability requirement $|G(\\kappa)| \\leq 1$ for all admissible wavenumbers. Use this to determine the complete set of time steps $\\Delta t$ that ensure stability for each sign of $a$, and then consolidate these into a single stability restriction expressed via the Courant number, consistent with the Courant–Friedrichs–Lewy (CFL) condition. Finally, report the maximal stable time step $\\Delta t_{\\max}$ as a single closed-form symbolic expression in terms of $|a|$ and $h$. Express the final answer as one closed-form expression; do not state it as an inequality and do not include any physical units.",
            "solution": "The partial differential equation $u_{t} + a\\,u_{x} = 0$ models pure advection at constant speed $a$. For stability analysis of a linear constant-coefficient finite difference scheme on a periodic domain, the von Neumann stability analysis proceeds by substituting a discrete Fourier mode into the update and studying the resulting amplification factor.\n\nWe consider the uniform grid $x_{j} = j h$ and time levels $t^{n} = n \\Delta t$. The explicit upwind scheme is defined in a way that aligns the spatial differencing with the direction of propagation: for $a > 0$, the upwind derivative uses the backward difference, and for $a < 0$, it uses the forward difference. Introduce the Courant number $\\nu = \\frac{a\\,\\Delta t}{h}$.\n\nCase $a > 0$. The scheme is\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\nu\\left(u_{j}^{n} - u_{j-1}^{n}\\right).\n$$\nAssume a Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})$ with $x_{j} = j h$ and denote $\\theta = \\kappa h$. Then $u_{j-1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j-1}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,(x_{j} - h)) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(-i\\,\\theta)$. Substituting into the update gives\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,\\kappa\\,x_{j}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\nu\\left[\\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(-i\\,\\theta)\\right].\n$$\nDivide both sides by $\\exp(i\\,\\kappa\\,x_{j})$ to obtain the amplification relation $\\hat{u}^{n+1} = G(\\theta)\\,\\hat{u}^{n}$ with\n$$\nG(\\theta) = 1 - \\nu\\left(1 - \\exp(-i\\,\\theta)\\right).\n$$\nWe compute the magnitude of $G(\\theta)$. Write $\\exp(-i\\,\\theta) = \\cos(\\theta) - i \\sin(\\theta)$, so\n$$\nG(\\theta) = 1 - \\nu + \\nu\\cos(\\theta) - i\\,\\nu\\sin(\\theta).\n$$\nThe squared magnitude is\n\\begin{align*}\n|G(\\theta)|^{2} &= \\left(1 - \\nu + \\nu\\cos(\\theta)\\right)^{2} + \\left(\\nu\\sin(\\theta)\\right)^{2} \\\\\n&= (1 - \\nu)^{2} + 2\\nu(1 - \\nu)\\cos(\\theta) + \\nu^{2}\\cos^{2}(\\theta) + \\nu^{2}\\sin^{2}(\\theta) \\\\\n&= (1 - \\nu)^{2} + 2\\nu(1 - \\nu)\\cos(\\theta) + \\nu^{2} \\\\\n&= 1 - 2\\nu + 2\\nu^{2} + 2\\nu(1 - \\nu)\\cos(\\theta).\n\\end{align*}\nFor fixed $\\nu \\in \\mathbb{R}$, the dependence on $\\theta$ enters only through $\\cos(\\theta) \\in [-1, 1]$. When $0 \\leq \\nu \\leq 1$, the coefficient $2\\nu(1 - \\nu)$ is nonnegative, so the maximum over $\\theta$ occurs at $\\cos(\\theta) = 1$, yielding $|G(\\theta)|^{2} = 1$. The minimum occurs at $\\cos(\\theta) = -1$, giving $|G(\\theta)|^{2} = 1 - 4\\nu + 4\\nu^{2} = (1 - 2\\nu)^{2} \\leq 1$. Thus for $a > 0$, stability in the von Neumann sense ($|G(\\theta)| \\leq 1$ for all $\\theta$) holds precisely when $0 \\leq \\nu \\leq 1$, that is, $0 \\leq \\frac{a\\,\\Delta t}{h} \\leq 1$, equivalently $0 \\leq \\Delta t \\leq \\frac{h}{a}$.\n\nCase $a < 0$. The scheme is\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\nu\\left(u_{j+1}^{n} - u_{j}^{n}\\right),\n$$\nwith $\\nu = \\frac{a\\,\\Delta t}{h} < 0$. Using the Fourier mode $u_{j+1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j+1}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(i\\,\\theta)$, substitution gives\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,\\kappa\\,x_{j}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\nu\\left[\\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(i\\,\\theta) - \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\right].\n$$\nDivide by $\\exp(i\\,\\kappa\\,x_{j})$ to obtain\n$$\n\\hat{u}^{n+1} = \\left(1 - \\nu\\left(\\exp(i\\,\\theta) - 1\\right)\\right)\\hat{u}^{n}, \\quad G(\\theta) = 1 - \\nu\\left(\\exp(i\\,\\theta) - 1\\right).\n$$\nWriting $\\exp(i\\,\\theta) = \\cos(\\theta) + i \\sin(\\theta)$, we have\n$$\nG(\\theta) = 1 + \\nu - \\nu\\cos(\\theta) - i\\,\\nu\\sin(\\theta),\n$$\nand\n\\begin{align*}\n|G(\\theta)|^{2} &= \\left(1 + \\nu - \\nu\\cos(\\theta)\\right)^{2} + \\left(\\nu\\sin(\\theta)\\right)^{2} \\\\\n&= (1 + \\nu)^{2} - 2\\nu(1 + \\nu)\\cos(\\theta) + \\nu^{2}\\cos^{2}(\\theta) + \\nu^{2}\\sin^{2}(\\theta) \\\\\n&= (1 + \\nu)^{2} - 2\\nu(1 + \\nu)\\cos(\\theta) + \\nu^{2} \\\\\n&= 1 + 2\\nu + 2\\nu^{2} - 2\\nu(1 + \\nu)\\cos(\\theta).\n\\end{align*}\nFor $\\nu \\in [-1, 0]$, the coefficient $-2\\nu(1 + \\nu)$ is nonnegative (because $\\nu \\leq 0$ and $1 + \\nu \\geq 0$), so the maximum over $\\theta$ occurs at $\\cos(\\theta) = 1$, yielding $|G(\\theta)|^{2} = 1$. The minimum occurs at $\\cos(\\theta) = -1$, giving $|G(\\theta)|^{2} = 1 + 4\\nu + 4\\nu^{2} = (1 + 2\\nu)^{2} \\leq 1$. Thus for $a < 0$, stability holds precisely when $-1 \\leq \\nu \\leq 0$, that is, $0 \\leq \\Delta t \\leq \\frac{h}{|a|}$.\n\nConsolidating both cases, the von Neumann stability condition for the explicit upwind scheme is $|\\nu| \\leq 1$, equivalently $\\Delta t \\leq \\frac{h}{|a|}$. The maximal stable time step is therefore\n$$\n\\Delta t_{\\max} = \\frac{h}{|a|}.\n$$\nThis coincides with the Courant–Friedrichs–Lewy (CFL) restriction for monotone upwind advection: the numerical domain of dependence must include the physical domain of dependence, which here enforces that the ratio of the distance traversed by advection in one time step, $|a|\\,\\Delta t$, to the grid spacing $h$ not exceed $1$.\n\nTherefore, the requested single closed-form symbolic expression for the maximal stable time step is $\\Delta t_{\\max} = \\frac{h}{|a|}$.",
            "answer": "$$\\boxed{\\frac{h}{|a|}}$$"
        },
        {
            "introduction": "While explicit schemes are limited by strict time step constraints, implicit methods like the Crank-Nicolson scheme offer the tantalizing possibility of unconditional stability. This practice delves into the stability properties of the Crank-Nicolson method for the diffusion equation, introducing the powerful concept of A-stability. It also reveals a crucial subtlety: stability alone does not guarantee a physically meaningful solution, as large time steps can introduce spurious oscillations, a key lesson in the practical application of numerical methods .",
            "id": "3337428",
            "problem": "Consider the one-dimensional heat equation, a canonical parabolic Partial Differential Equation (PDE), given by $u_{t} = \\nu u_{xx}$ with constant kinematic viscosity $\\nu > 0$ on a uniform spatial grid with spacing $h$ and time step $\\Delta t$. Let $u_{j}^{n}$ denote the numerical approximation to $u(x_{j}, t^{n})$ at grid index $j \\in \\mathbb{Z}$ and time level $n \\in \\mathbb{N}$. Discretize the spatial second derivative using the standard second-order central finite difference operator $D u_{j}^{n} = h^{-2} \\left(u_{j+1}^{n} - 2 u_{j}^{n} + u_{j-1}^{n}\\right)$ and advance in time with the Crank–Nicolson (CN) scheme, defined by\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2} \\left(D u_{j}^{n+1} + D u_{j}^{n}\\right).\n$$\nPerform a von Neumann Fourier-mode analysis by assuming a solution of the form $u_{j}^{n} = \\hat{u}^{n} \\exp\\!\\left(i j \\theta\\right)$ for a mode angle $\\theta \\in [-\\pi, \\pi]$. Starting from the fundamental definitions above, derive the amplification factor $g(\\theta, \\alpha)$, where $\\alpha := \\nu \\Delta t / h^{2}$, such that $\\hat{u}^{n+1} = g(\\theta, \\alpha) \\, \\hat{u}^{n}$. Then, using the linear scalar test equation $y' = \\lambda y$ with $\\operatorname{Re}(\\lambda) \\le 0$ and the CN stability function, justify whether CN is $A$-stable (absolute stability) and determine the behavior of $|g(\\theta, \\alpha)|$ as $\\alpha \\to \\infty$ for any fixed $\\theta \\neq 0$, explaining the implications for nonphysical oscillations when large time steps are used.\n\nProvide the closed-form expression for the amplification factor $g(\\theta, \\alpha)$ as your final answer.",
            "solution": "The problem requires the derivation and analysis of the amplification factor for the Crank-Nicolson (CN) scheme applied to the one-dimensional heat equation $u_{t} = \\nu u_{xx}$, where $\\nu > 0$.\n\nThe CN scheme is given as:\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2} \\left(D u_{j}^{n+1} + D u_{j}^{n}\\right)\n$$\nHere, $u_{j}^{n}$ approximates the solution $u(x_j, t^n)$ at grid point $j$ and time level $n$. The spatial operator $D$ is the second-order central finite difference:\n$$\nD u_{j}^{n} = \\frac{u_{j+1}^{n} - 2 u_{j}^{n} + u_{j-1}^{n}}{h^2}\n$$\nSubstituting the operator $D$ into the CN scheme yields:\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2h^2} \\left[ (u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}) + (u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}) \\right]\n$$\nWe define the diffusion number $\\alpha := \\nu \\Delta t / h^2$. Multiplying by $\\Delta t$ and rearranging terms to separate time levels $n+1$ and $n$:\n$$\nu_{j}^{n+1} - \\frac{\\alpha}{2} (u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}) = u_{j}^{n} + \\frac{\\alpha}{2} (u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n})\n$$\nTo perform the von Neumann stability analysis, we substitute the Fourier mode ansatz $u_{j}^{n} = \\hat{u}^{n} \\exp(i j \\theta)$, where $i = \\sqrt{-1}$ and $\\theta = k h$ is the dimensionless wavenumber or mode angle. This substitution implies:\n$$\nu_{j \\pm 1}^{n} = \\hat{u}^{n} \\exp(i (j \\pm 1) \\theta) = \\hat{u}^{n} \\exp(i j \\theta) \\exp(\\pm i \\theta) = u_{j}^{n} \\exp(\\pm i \\theta)\n$$\nApplying this to the left-hand side (LHS) of the rearranged scheme (at time level $n+1$):\n$$\n\\text{LHS} = \\hat{u}^{n+1} \\exp(i j \\theta) - \\frac{\\alpha}{2} \\left[ \\hat{u}^{n+1} \\exp(i (j+1) \\theta) - 2\\hat{u}^{n+1} \\exp(i j \\theta) + \\hat{u}^{n+1} \\exp(i (j-1) \\theta) \\right]\n$$\nFactoring out $\\hat{u}^{n+1} \\exp(i j \\theta)$:\n$$\n\\text{LHS} = \\hat{u}^{n+1} \\exp(i j \\theta) \\left[ 1 - \\frac{\\alpha}{2} \\left( \\exp(i \\theta) - 2 + \\exp(-i \\theta) \\right) \\right]\n$$\nSimilarly, for the right-hand side (RHS) at time level $n$:\n$$\n\\text{RHS} = \\hat{u}^{n} \\exp(i j \\theta) \\left[ 1 + \\frac{\\alpha}{2} \\left( \\exp(i \\theta) - 2 + \\exp(-i \\theta) \\right) \\right]\n$$\nThe term in the parentheses can be simplified using Euler's formula, $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$:\n$$\n\\exp(i \\theta) - 2 + \\exp(-i \\theta) = 2\\cos(\\theta) - 2 = -2(1 - \\cos(\\theta))\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$, this becomes:\n$$\n\\exp(i \\theta) - 2 + \\exp(-i \\theta) = -4\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\nSubstituting this simplified expression back into the LHS and RHS and equating them:\n$$\n\\hat{u}^{n+1} \\left[ 1 - \\frac{\\alpha}{2} \\left(-4\\sin^2\\left(\\frac{\\theta}{2}\\right)\\right) \\right] = \\hat{u}^{n} \\left[ 1 + \\frac{\\alpha}{2} \\left(-4\\sin^2\\left(\\frac{\\theta}{2}\\right)\\right) \\right]\n$$\n$$\n\\hat{u}^{n+1} \\left[ 1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right) \\right] = \\hat{u}^{n} \\left[ 1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right) \\right]\n$$\nThe amplification factor $g(\\theta, \\alpha)$ is defined by $\\hat{u}^{n+1} = g(\\theta, \\alpha) \\hat{u}^{n}$. Solving for $g(\\theta, \\alpha)$ gives:\n$$\ng(\\theta, \\alpha) = \\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}\n$$\nThis is the required closed-form expression.\n\nNext, we analyze the stability properties. For the linear scalar test equation $y' = \\lambda y$, where $\\operatorname{Re}(\\lambda) \\le 0$, the CN method (which is an application of the trapezoidal rule) is:\n$$\n\\frac{y^{n+1} - y^{n}}{\\Delta t} = \\frac{1}{2}(\\lambda y^{n+1} + \\lambda y^{n})\n$$\nLet $z = \\lambda \\Delta t$. Rearranging to find the stability function $R(z) = y^{n+1} / y^{n}$:\n$$\ny^{n+1}(1 - z/2) = y^{n}(1 + z/2) \\implies R(z) = \\frac{1 + z/2}{1 - z/2}\n$$\nA method is $A$-stable if $|R(z)| \\le 1$ for all $z \\in \\mathbb{C}$ with $\\operatorname{Re}(z) \\le 0$. Let $z = x+iy$ with $x \\le 0$.\n$$\n|R(z)|^2 = \\left| \\frac{1 + (x+iy)/2}{1 - (x+iy)/2} \\right|^2 = \\frac{|(1+x/2) + i(y/2)|^2}{|(1-x/2) - i(y/2)|^2} = \\frac{(1+x/2)^2 + (y/2)^2}{(1-x/2)^2 + (y/2)^2}\n$$\nThe condition $|R(z)|^2 \\le 1$ becomes $(1+x/2)^2 \\le (1-x/2)^2$, which simplifies to $1+x \\le 1-x$, or $2x \\le 0$, which is $x \\le 0$. This holds true for all $z$ in the left half-plane, $\\operatorname{Re}(z) \\le 0$. Thus, the Crank-Nicolson method is $A$-stable.\n\nFor the heat equation, the values of $z$ correspond to the eigenvalues of the discretized spatial operator multiplied by $\\Delta t$. The eigenvalues of $\\nu D$ are $\\lambda_{\\theta} = \\nu \\left(\\frac{\\exp(i\\theta) - 2 + \\exp(-i\\theta)}{h^2}\\right) = -\\frac{4\\nu}{h^2}\\sin^2(\\theta/2)$. Since $\\nu > 0$, these eigenvalues are real and non-positive, so $\\operatorname{Re}(\\lambda_{\\theta}\\Delta t) \\le 0$. The corresponding value of $z$ is:\n$$\nz = \\lambda_{\\theta}\\Delta t = -\\frac{4\\nu\\Delta t}{h^2}\\sin^2\\left(\\frac{\\theta}{2}\\right) = -4\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\nSubstituting this into the stability function $R(z)$ yields:\n$$\nR(z) = \\frac{1 + (-4\\alpha\\sin^2(\\theta/2))/2}{1 - (-4\\alpha\\sin^2(\\theta/2))/2} = \\frac{1 - 2\\alpha\\sin^2(\\theta/2)}{1 + 2\\alpha\\sin^2(\\theta/2)} = g(\\theta, \\alpha)\n$$\nThis demonstrates that $A$-stability implies unconditional stability for the CN scheme applied to the heat equation, meaning $|g(\\theta, \\alpha)| \\le 1$ for all $\\alpha > 0$ and all $\\theta \\in [-\\pi, \\pi]$.\n\nFinally, we examine the behavior as $\\alpha \\to \\infty$ for a fixed $\\theta \\neq 0$. For any $\\theta \\in [-\\pi, \\pi]$ except $\\theta=0$, the term $\\sin^2(\\theta/2)$ is a positive constant.\n$$\n\\lim_{\\alpha \\to \\infty} g(\\theta, \\alpha) = \\lim_{\\alpha \\to \\infty} \\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)} = \\lim_{\\alpha \\to \\infty} \\frac{1/\\alpha - 2\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1/\\alpha + 2\\sin^2\\left(\\frac{\\theta}{2}\\right)} = \\frac{-2\\sin^2\\left(\\frac{\\theta}{2}\\right)}{+2\\sin^2\\left(\\frac{\\theta}{2}\\right)} = -1\n$$\nThis means that for large time steps (large $\\alpha$), the amplification factor for any non-zero frequency mode approaches $-1$. Consequently, $|g(\\theta, \\alpha)| \\to 1$. While the magnitudes of the Fourier modes do not grow (ensuring stability), their signs alternate at each time step, since $\\hat{u}^{n+1} \\approx -\\hat{u}^{n}$. This manifests as spurious, non-physical high-frequency oscillations in the numerical solution. The solution does not \"blow up\", but its quality degenerates severely. This illustrates that the CN scheme is not L-stable, a property that requires the amplification factor to tend to zero for highly stiff components (i.e., as $\\operatorname{Re}(z) \\to -\\infty$), which is desirable for effectively damping high-frequency numerical errors.",
            "answer": "$$\n\\boxed{\\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}}\n$$"
        },
        {
            "introduction": "A numerically stable scheme is not always a physically realistic one, especially when dealing with sharp gradients or discontinuities. This hands-on coding exercise challenges you to investigate the discrete maximum principle—the property that a scheme should not create new, non-physical high or low values in the solution. You will see firsthand why standard centered-difference schemes can fail for advection-dominated problems and how the concept of flux limiting in modern finite volume methods provides a powerful remedy to ensure robust, non-oscillatory solutions .",
            "id": "3337479",
            "problem": "Consider the one-dimensional advection–diffusion equation on a periodic domain derived from conservation of mass and Fick’s law, namely the scalar partial differential equation $u_t + a\\,u_x - \\nu\\,u_{xx} = 0$ on $x \\in [0,1]$ with period $1$. Here $u(x,t)$ is the conserved scalar, $a$ is a constant advection speed, and $\\nu$ is a constant diffusivity. The continuous equation satisfies a maximum principle in the sense that if $u(x,0)$ is bounded between a minimum and a maximum, then no new extrema appear for $t \\ge 0$.\n\nYou will study the conditions under which a discrete maximum principle holds for two semi-discretizations in space coupled with forward Euler in time, and you will empirically construct a counterexample at high cell Peclet number to demonstrate violation and a flux-limiter remedy that restores monotonicity.\n\nDefinitions to use in your derivation and implementation:\n- The uniform grid consists of $N$ points with spacing $\\Delta x = 1/N$, cell centers at $x_i = (i+1/2)\\Delta x$ for $i=0,\\dots,N-1$, and periodic indexing.\n- The discrete maximum principle (DMP) shall be tested numerically as follows: let $u^0$ be the initial discrete state and $u^n$ the solution after $n$ time steps. The DMP is declared to hold if for all time steps $n$ the inequalities $\\min_i u^n_i \\ge \\min_i u^0_i - \\tau$ and $\\max_i u^n_i \\le \\max_i u^0_i + \\tau$ with tolerance $\\tau = 10^{-8}$ are satisfied.\n- The cell Peclet number is defined as $Pe_h = |a|\\Delta x/\\nu$.\n\nSchemes to implement:\n- Finite difference central scheme (FD-central): discretize $u_x$ by the centered difference on the uniform grid and $u_{xx}$ by the standard second-order centered difference. The method-of-lines ordinary differential equation is integrated by forward Euler with time step $\\Delta t$.\n- Finite volume upwind scheme with a minmod slope limiter (FV-upwind-limited): compute the intercell convective flux using an upwinded, piecewise-linear reconstruction with the minmod slope limiter applied to the one-sided differences to retain total variation diminishing behavior for scalar advection. The diffusive flux is the centered gradient at faces. Update cell averages by the flux difference with forward Euler time stepping of size $\\Delta t$.\n\nInitial conditions to use:\n- Smooth case: $u(x,0) = \\tfrac{1}{2} + \\tfrac{1}{2}\\sin(2\\pi x)$.\n- Counterexample case (sharp front): $u(x,0) = 1$ for $x \\in [0.4,0.6)$ and $u(x,0) = 0$ elsewhere on $[0,1)$, interpreted periodically.\n\nTask:\n- Starting from the conservation law and definitions above as the fundamental base, derive the discrete coefficient conditions under which the FD-central forward Euler update is an M-matrix type convex combination that ensures a discrete maximum principle in one space dimension. Similarly, derive sufficient step-size and coefficient conditions for the FV-upwind-limited forward Euler update to be monotone. Use these to predict when violations can occur at high $Pe_h$ for centered differences, and explain why the upwind limited flux remedies the violation.\n- Implement both schemes and construct numerical evidence for violation and remedy by running the specified test suite below and checking the DMP condition with the tolerance $\\tau$ at every time step.\n\nTest suite:\n- Case $1$ (happy path, smooth and diffusive): $N=100$, $a=1.0$, $\\nu=0.1$, $\\Delta t=2.5\\times 10^{-4}$, $T=0.05$, scheme FD-central, smooth initial condition. Expected behavior: DMP holds.\n- Case $2$ (counterexample, high $Pe_h$ with centered differences): $N=100$, $a=5.0$, $\\nu=10^{-3}$, $\\Delta t=2.0\\times 10^{-4}$, $T=0.02$, scheme FD-central, sharp-front initial condition. Expected behavior: DMP violation due to dispersive oscillations.\n- Case $3$ (remedy with limiter at high $Pe_h$): $N=100$, $a=5.0$, $\\nu=10^{-3}$, $\\Delta t=10^{-3}$, $T=0.02$, scheme FV-upwind-limited, sharp-front initial condition. Expected behavior: DMP holds.\n- Case $4$ (borderline $Pe_h$ with centered differences): $N=100$, $a=1.0$, $\\nu=10^{-2}$, $\\Delta t=2.5\\times 10^{-3}$, $T=0.05$, scheme FD-central, sharp-front initial condition. Expected behavior: DMP holds provided the coefficient and step-size constraints are satisfied.\n\nComputational and output requirements:\n- Use double-precision arithmetic. The domain is dimensionless; no physical units are required.\n- For each case, advance the numerical solution from $t=0$ to $t=T$ using the specified scheme and parameters, enforcing periodic boundary conditions.\n- For each case, output a boolean indicating whether the DMP holds at all time steps for that case with tolerance $\\tau = 10^{-8}$.\n- Your program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, for example $[true,false,true,true]$. Use the host language’s native boolean literals.\n\nNotes:\n- Angles do not appear; no angle unit is needed.\n- Ensure the implementation is self-contained and does not require external data.",
            "solution": "The user has provided a well-posed problem from the field of computational fluid dynamics, which requires both a theoretical derivation of conditions for a discrete maximum principle (DMP) and a numerical implementation to verify these conditions. The problem is scientifically grounded, internally consistent, and contains all necessary information. We proceed with the solution.\n\nThe governing equation is the one-dimensional advection–diffusion equation, a conservation law given by\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( a u - \\nu \\frac{\\partial u}{\\partial x} \\right) = 0\n$$\nwhere $u(x,t)$ is a scalar quantity, $a$ is the constant advection speed, and $\\nu$ is the constant diffusivity. For a constant $a$, this expands to $u_t + a u_x - \\nu u_{xx} = 0$. We will analyze two spatial discretizations on a uniform periodic grid with $N$ cells of width $\\Delta x = 1/N$ and cell centers $x_i = (i+1/2)\\Delta x$. Time integration is performed using the explicit forward Euler method with step size $\\Delta t$.\n\nA numerical scheme is said to satisfy a discrete maximum principle if, for an initial condition $u^0$, the solution $u^n$ at any time step $n$ remains bounded by the initial minimum and maximum values, i.e., $\\min_i u_i^n \\ge \\min_i u_i^0$ and $\\max_i u_i^n \\le \\max_i u_i^0$. A sufficient condition for this is that the update for each grid point $u_i^{n+1}$ is a convex combination of values from the previous time step, $u^n$. That is, if the scheme can be written as $u_i^{n+1} = \\sum_{j} C_j u_j^n$, the DMP is guaranteed if all coefficients $C_j \\ge 0$ and their sum $\\sum_j C_j = 1$.\n\n**Analysis of the Finite Difference Central (FD-central) Scheme**\n\nThe FD-central scheme discretizes the spatial derivatives as:\n$$\nu_x \\approx \\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x} \\quad \\text{and} \\quad u_{xx} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2}\n$$\nSubstituting these into the governing equation with forward Euler time stepping gives the update formula:\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + a \\left(\\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x}\\right) - \\nu \\left(\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2}\\right) = 0\n$$\nSolving for $u_i^{n+1}$ and grouping terms by their spatial index at time $n$:\n$$\nu_i^{n+1} = u_i^n - \\Delta t \\left[ a \\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x} - \\nu \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2} \\right]\n$$\n$$\nu_i^{n+1} = \\left(\\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x}\\right) u_{i+1}^n + \\left(1 - \\frac{2\\nu \\Delta t}{\\Delta x^2}\\right) u_i^n + \\left(\\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x}\\right) u_{i-1}^n\n$$\nLet's denote the coefficients of $u_{i+1}^n$, $u_i^n$, and $u_{i-1}^n$ by $C_{i+1}$, $C_i$, and $C_{i-1}$ respectively. The sum of the coefficients is $C_{i+1} + C_i + C_{i-1} = (\\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x}) + (1 - \\frac{2\\nu \\Delta t}{\\Delta x^2}) + (\\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x}) = 1$. Thus, the scheme forms a convex combination if and only if all coefficients are non-negative.\n1.  $C_i \\ge 0 \\implies 1 - \\frac{2\\nu \\Delta t}{\\Delta x^2} \\ge 0 \\implies \\Delta t \\le \\frac{\\Delta x^2}{2\\nu}$. This is the standard CFL stability condition for diffusion.\n2.  $C_{i+1} \\ge 0 \\implies \\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x} \\ge 0$. Assuming $\\Delta t > 0$, this simplifies to $\\frac{\\nu}{\\Delta x} \\ge \\frac{a}{2}$.\n3.  $C_{i-1} \\ge 0 \\implies \\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x} \\ge 0$. Assuming $\\Delta t > 0$, this simplifies to $\\frac{\\nu}{\\Delta x} \\ge -\\frac{a}{2}$.\n\nCombining the conditions on $C_{i+1}$ and $C_{i-1}$ yields $|\\frac{a}{2}| \\le \\frac{\\nu}{\\Delta x}$, which is equivalent to $\\frac{|a|\\Delta x}{\\nu} \\le 2$. This introduces a restriction on the cell Peclet number, $Pe_h = \\frac{|a|\\Delta x}{\\nu}$.\nTherefore, the FD-central scheme with forward Euler satisfies the DMP if two conditions are met:\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{2\\nu} \\quad \\text{(parabolic CFL condition)} \\quad \\text{and} \\quad Pe_h = \\frac{|a|\\Delta x}{\\nu} \\le 2 \\quad \\text{(cell Peclet condition)}\n$$\nWhen $Pe_h > 2$, one of the off-diagonal coefficients becomes negative. This means $u_i^{n+1}$ is no longer a convex combination of its neighbors. A negative coefficient allows for the creation of new extrema (spurious oscillations or undershoots/overshoots), thus violating the DMP. This is particularly noticeable when advection dominates diffusion ($Pe_h \\gg 1$) and the solution has sharp gradients.\n\n**Analysis of the Finite Volume Upwind-Limited (FV-upwind-limited) Scheme**\n\nThe finite volume method updates the cell average $\\bar{u}_i$ based on the fluxes at the cell boundaries (interfaces):\n$$\n\\frac{d\\bar{u}_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nThe numerical flux $F_{i+1/2}$ is composed of a convective and a diffusive part: $F_{i+1/2} = F_{i+1/2}^{conv} + F_{i+1/2}^{diff}$. The diffusive flux is approximated by a centered difference: $F_{i+1/2}^{diff} = -\\nu \\frac{\\bar{u}_{i+1} - \\bar{u}_i}{\\Delta x}$.\n\nFor the convective flux, this scheme uses a piecewise-linear reconstruction within each cell $i$, $u(x) = \\bar{u}_i + \\sigma_i (x - x_i)$, where $\\sigma_i$ is a limited slope. The specified minmod limiter on one-sided differences is:\n$$\n\\sigma_i = \\text{minmod}\\left(\\frac{\\bar{u}_i - \\bar{u}_{i-1}}{\\Delta x}, \\frac{\\bar{u}_{i+1} - \\bar{u}_i}{\\Delta x}\\right)\n$$\nwhere $\\text{minmod}(a,b) = \\frac{1}{2}(\\text{sgn}(a)+\\text{sgn}(b))\\min(|a|,|b|)$. The purpose of the limiter is to make the reconstruction non-oscillatory, meaning the reconstructed values at the cell edges, $\\bar{u}_i \\pm \\sigma_i \\frac{\\Delta x}{2}$, do not exceed the values of the neighboring cell averages. This property is crucial for satisfying the DMP.\n\nThe convective flux is then determined using an upwind choice based on the sign of $a$. At interface $i+1/2$:\n- If $a > 0$, the flow is from left to right, so we use the reconstruction from cell $i$: $F_{i+1/2}^{conv} = a \\left(\\bar{u}_i + \\sigma_i \\frac{\\Delta x}{2}\\right)$.\n- If $a < 0$, the flow is from right to left, so we use the reconstruction from cell $i+1$: $F_{i+1/2}^{conv} = a \\left(\\bar{u}_{i+1} - \\sigma_{i+1} \\frac{\\Delta x}{2}\\right)$.\n\nBy design, this upwind, limited scheme is total variation diminishing (TVD) for the pure advection case, which implies it is monotonicity-preserving and thus satisfies the DMP under a suitable CFL condition, typically $|a|\\Delta t/\\Delta x \\le 1/2$. To analyze the full advection-diffusion equation, consider the simpler first-order upwind scheme ($\\sigma_i=0$). For $a>0$, the update is:\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x}\\left[ a\\bar{u}_i - \\nu\\frac{\\bar{u}_{i+1}-\\bar{u}_i}{\\Delta x} \\right] + \\frac{\\Delta t}{\\Delta x}\\left[ a\\bar{u}_{i-1} - \\nu\\frac{\\bar{u}_i-\\bar{u}_{i-1}}{\\Delta x} \\right]\n$$\n$$\n\\bar{u}_i^{n+1} = \\left(\\frac{\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_{i+1}^n + \\left(1 - \\frac{a\\Delta t}{\\Delta x} - \\frac{2\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_i^n + \\left(\\frac{a\\Delta t}{\\Delta x} + \\frac{\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_{i-1}^n\n$$\nFor this to be a convex combination, the coefficients must be non-negative. For $a>0, \\nu>0$, this reduces to a single condition on the coefficient of $\\bar{u}_i^n$:\n$$\n1 - \\frac{a\\Delta t}{\\Delta x} - \\frac{2\\nu\\Delta t}{\\Delta x^2} \\ge 0 \\implies \\Delta t \\left( \\frac{a}{\\Delta x} + \\frac{2\\nu}{\\Delta x^2} \\right) \\le 1\n$$\nThis condition ensures monotonicity for the first-order scheme without any restriction on the cell Peclet number $Pe_h$. The slope-limited second-order scheme behaves similarly; the limiter essentially reduces the scheme to first-order accuracy near sharp gradients or extrema to suppress oscillations, thereby preserving monotonicity, while providing higher accuracy in smooth regions. This is why the FV-upwind-limited scheme is expected to satisfy the DMP even at high $Pe_h$, remedying the failure of the FD-central scheme.",
            "answer": "```python\nimport numpy as np\n\ndef minmod(a, b):\n    \"\"\"Vectorized minmod function.\"\"\"\n    # Ensure inputs are numpy arrays for vectorized operations\n    a = np.asarray(a)\n    b = np.asarray(b)\n    # The sign check correctly handles the case where signs differ (result is 0)\n    # and where they are the same (result has the same sign).\n    return 0.5 * (np.sign(a) + np.sign(b)) * np.minimum(np.abs(a), np.abs(b))\n\ndef run_fd_central(N, a, nu, dt, T, ic_type, tau):\n    \"\"\"\n    Solves the 1D advection-diffusion equation using FD-central in space\n    and Forward Euler in time.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n\n    if ic_type == 'smooth':\n        u = 0.5 + 0.5 * np.sin(2 * np.pi * x)\n    elif ic_type == 'sharp':\n        u = np.zeros(N, dtype=np.float64)\n        mask = (x >= 0.4)  (x  0.6)\n        u[mask] = 1.0\n    else:\n        raise ValueError(\"Invalid initial condition type\")\n        \n    u = u.astype(np.float64)\n\n    u_min_0 = np.min(u)\n    u_max_0 = np.max(u)\n    \n    num_steps = int(round(T / dt))\n    \n    dmp_holds = True\n    for _ in range(num_steps):\n        u_plus_1 = np.roll(u, -1)\n        u_minus_1 = np.roll(u, 1)\n        \n        u_x = (u_plus_1 - u_minus_1) / (2.0 * dx)\n        u_xx = (u_plus_1 - 2.0 * u + u_minus_1) / (dx**2)\n        \n        u = u - dt * (a * u_x - nu * u_xx)\n        \n        if np.min(u)  u_min_0 - tau or np.max(u) > u_max_0 + tau:\n            dmp_holds = False\n            break\n            \n    return dmp_holds\n\ndef run_fv_upwind_limited(N, a, nu, dt, T, ic_type, tau):\n    \"\"\"\n    Solves the 1D advection-diffusion equation using a second-order TVD\n    finite volume scheme with a minmod limiter.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n\n    if ic_type == 'smooth':\n        u = 0.5 + 0.5 * np.sin(2 * np.pi * x)\n    elif ic_type == 'sharp':\n        u = np.zeros(N, dtype=np.float64)\n        mask = (x >= 0.4)  (x  0.6)\n        u[mask] = 1.0\n    else:\n        raise ValueError(\"Invalid initial condition type\")\n\n    u = u.astype(np.float64)\n\n    u_min_0 = np.min(u)\n    u_max_0 = np.max(u)\n\n    num_steps = int(round(T / dt))\n\n    dmp_holds = True\n    for _ in range(num_steps):\n        # Calculate slopes with minmod limiter\n        du_bwd = (u - np.roll(u, 1)) / dx\n        du_fwd = (np.roll(u, -1) - u) / dx\n        slopes = minmod(du_bwd, du_fwd)\n\n        # Reconstruct values at interfaces i+1/2\n        # u_L is the value from cell i at its right edge\n        u_L = u + slopes * dx / 2.0\n        # u_R is the value from cell i+1 at its left edge\n        u_R = np.roll(u, -1) - np.roll(slopes, -1) * dx / 2.0\n\n        # Convective flux (upwind)\n        # flux = a * u_upwind\n        # a>0: u_upwind = u_L. a0: u_upwind = u_R\n        flux_conv = (a + np.abs(a)) / 2.0 * u_L + (a - np.abs(a)) / 2.0 * u_R\n\n        # Diffusive flux (centered)\n        flux_diff = -nu * (np.roll(u, -1) - u) / dx\n        \n        # Total flux at interfaces i+1/2\n        total_flux = flux_conv + flux_diff\n        \n        # Update cell averages using flux differences\n        u = u - (dt / dx) * (total_flux - np.roll(total_flux, 1))\n\n        if np.min(u)  u_min_0 - tau or np.max(u) > u_max_0 + tau:\n            dmp_holds = False\n            break\n\n    return dmp_holds\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # DMP tolerance\n    tau = 1.0e-8\n\n    test_cases = [\n        # Case 1: happy path, smooth and diffusive\n        {'N': 100, 'a': 1.0, 'nu': 0.1, 'dt': 2.5e-4, 'T': 0.05, 'scheme': 'FD-central', 'ic_type': 'smooth'},\n        # Case 2: counterexample, high Pe_h with centered differences\n        {'N': 100, 'a': 5.0, 'nu': 1.0e-3, 'dt': 2.0e-4, 'T': 0.02, 'scheme': 'FD-central', 'ic_type': 'sharp'},\n        # Case 3: remedy with limiter at high Pe_h\n        {'N': 100, 'a': 5.0, 'nu': 1.0e-3, 'dt': 1.0e-3, 'T': 0.02, 'scheme': 'FV-upwind-limited', 'ic_type': 'sharp'},\n        # Case 4: borderline Pe_h with centered differences\n        {'N': 100, 'a': 1.0, 'nu': 1.0e-2, 'dt': 2.5e-3, 'T': 0.05, 'scheme': 'FD-central', 'ic_type': 'sharp'},\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        if case['scheme'] == 'FD-central':\n            result = run_fd_central(case['N'], case['a'], case['nu'], case['dt'], case['T'], case['ic_type'], tau)\n        elif case['scheme'] == 'FV-upwind-limited':\n            result = run_fv_upwind_limited(case['N'], case['a'], case['nu'], case['dt'], case['T'], case['ic_type'], tau)\n        else:\n            raise ValueError(f\"Unknown scheme: {case['scheme']}\")\n        results.append(str(result).lower())\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}