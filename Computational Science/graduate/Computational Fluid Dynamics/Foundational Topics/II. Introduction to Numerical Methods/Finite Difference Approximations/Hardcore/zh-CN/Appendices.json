{
    "hands_on_practices": [
        {
            "introduction": "构建高阶差分格式是计算流体动力学中的一项基本功。本练习将引导你从第一性原理出发，通过泰勒级数展开来推导一个四阶精度的中心差分格式，用于逼近二阶导数 。掌握此方法不仅能让你深刻理解截断误差的来源，更是设计和分析数值格式的基石。",
            "id": "3318184",
            "problem": "考虑计算流体力学(CFD)中的一个一维扩散项，其中空间二阶导数 $u''(x)$ 必须在均匀网格上以高阶精度进行近似。设 $x_i$ 为间距为 $h$ 的均匀网格上的一个网格点，并设 $u_i = u(x_i)$，其中 $u$ 是一个在包含 $x_i$ 的区间上至少有6阶连续导数的充分光滑函数。使用中心差分格式 $\\{x_{i-2}, x_{i-1}, x_i, x_{i+1}, x_{i+2}\\}$，构造一个形如下式的线性组合\n$$\n\\frac{1}{h^2}\\left(A\\,u_{i-2} + B\\,u_{i-1} + C\\,u_i + B\\,u_{i+1} + A\\,u_{i+2}\\right)\n$$\n以四阶精度逼近 $u''(x_i)$。通过将 $u(x)$ 在 $x_i$ 点进行泰勒级数展开并施加必要的相容性和精度条件，从第一性原理出发推导系数 $A$、$B$ 和 $C$。然后，通过泰勒展开验证截断误差为 $O(h^4)$，并确定主阶截断误差项。将您的最终近似表示为由网格值 $u_{i-2}$、$u_{i-1}$、$u_i$、$u_{i+1}$ 和 $u_{i+2}$ 构成的单个闭式差分格式表达式。答案无需四舍五入，也无需物理单位。",
            "solution": "用户提供的问题经评估有效。这是一个数值分析领域的适定、有科学依据的问题，具体涉及有限差分公式的推导。问题陈述完整、一致，并要求使用泰勒级数这一该学科的基本技术进行标准推导。\n\n目标是使用一个五点对称差分格式，为二阶导数 $u''(x_i)$ 推导一个四阶精度的中心差分近似。所提出的近似具有以下形式：\n$$\nu''(x_i) \\approx \\frac{1}{h^2}\\left(A\\,u_{i-2} + B\\,u_{i-1} + C\\,u_i + B\\,u_{i+1} + A\\,u_{i+2}\\right)\n$$\n其中 $h$ 是均匀网格间距，$u_j = u(x_j)$，而 $A$、$B$、$C$ 是待定系数。函数 $u(x)$ 被假设为充分光滑，具有至少六阶连续导数。\n\n推导过程通过将函数值 $u_{i \\pm 1}$ 和 $u_{i \\pm 2}$ 在点 $x_i$ 附近展开为泰勒级数来进行。我们记 $u^{(n)}_i = \\frac{d^n u}{dx^n}\\Big|_{x=x_i}$。展开式如下：\n$$\nu_{i+k} = u(x_i + kh) = \\sum_{n=0}^{\\infty} \\frac{(kh)^n}{n!} u^{(n)}_i\n$$\n我们展开到包含 $u^{(6)}_i$ 的项，以确定 $O(h^4)$ 误差项。\n\\begin{align*}\nu_{i+1} = u_i + h u'_i + \\frac{h^2}{2} u''_i + \\frac{h^3}{6} u'''_i + \\frac{h^4}{24} u''''_i + \\frac{h^5}{120} u^{(5)}_i + \\frac{h^6}{720} u^{(6)}_i + O(h^7) \\\\\nu_{i-1} = u_i - h u'_i + \\frac{h^2}{2} u''_i - \\frac{h^3}{6} u'''_i + \\frac{h^4}{24} u''''_i - \\frac{h^5}{120} u^{(5)}_i + \\frac{h^6}{720} u^{(6)}_i + O(h^7) \\\\\nu_{i+2} = u_i + 2h u'_i + \\frac{(2h)^2}{2} u''_i + \\frac{(2h)^3}{6} u'''_i + \\frac{(2h)^4}{24} u''''_i + \\frac{(2h)^5}{120} u^{(5)}_i + \\frac{(2h)^6}{720} u^{(6)}_i + O(h^7) \\\\\nu_{i-2} = u_i - 2h u'_i + \\frac{(2h)^2}{2} u''_i - \\frac{(2h)^3}{6} u'''_i + \\frac{(2h)^4}{24} u''''_i - \\frac{(2h)^5}{120} u^{(5)}_i + \\frac{(2h)^6}{720} u^{(6)}_i + O(h^7)\n\\end{align*}\n由于差分格式和系数的对称性（$u_{i\\pm 2}$ 的系数为 $A$，$u_{i\\pm 1}$ 的系数为 $B$），奇数阶导数项在组合时会相互抵消。我们来构造对称组合：\n$$\nu_{i+1} + u_{i-1} = 2u_i + h^2 u''_i + \\frac{h^4}{12} u''''_i + \\frac{h^6}{360} u^{(6)}_i + O(h^8)\n$$\n$$\nu_{i+2} + u_{i-2} = 2u_i + (2h)^2 u''_i + \\frac{(2h)^4}{12} u''''_i + \\frac{(2h)^6}{360} u^{(6)}_i + O(h^8) = 2u_i + 4h^2 u''_i + \\frac{4h^4}{3} u''''_i + \\frac{8h^6}{45} u^{(6)}_i + O(h^8)\n$$\n设分子中的线性组合为 $S$：\n$$\nS = A(u_{i+2} + u_{i-2}) + B(u_{i+1} + u_{i-1}) + C u_i\n$$\n代入组合后的泰勒级数：\n$$\nS = A\\left(2u_i + 4h^2 u''_i + \\frac{4}{3}h^4 u''''_i + \\frac{8}{45}h^6 u^{(6)}_i\\right) + B\\left(2u_i + h^2 u''_i + \\frac{1}{12}h^4 u''''_i + \\frac{1}{360}h^6 u^{(6)}_i\\right) + C u_i + O(h^8)\n$$\n按 $u_i$ 的导数项对各项进行分组：\n$$\nS = (2A + 2B + C)u_i + (4A + B)h^2 u''_i + \\left(\\frac{4}{3}A + \\frac{1}{12}B\\right)h^4 u''''_i + \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right)h^6 u^{(6)}_i + O(h^8)\n$$\n完整的近似式为 $\\frac{S}{h^2}$。我们希望它等于 $u''_i + O(h^4)$。\n$$\n\\frac{S}{h^2} = \\frac{2A + 2B + C}{h^2}u_i + (4A + B)u''_i + \\left(\\frac{4}{3}A + \\frac{1}{12}B\\right)h^2 u''''_i + \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right)h^4 u^{(6)}_i + O(h^6)\n$$\n为了使其与 $u''_i$ 匹配并达到所需精度，我们将不需要的项的系数设为零，并将 $u''_i$ 的系数设为一。这产生了一个关于 $A$、$B$ 和 $C$ 的线性方程组。\n\\begin{enumerate}\n    \\item $u_i$ 的系数必须为零： $2A + 2B + C = 0$\n    \\item $u''_i$ 的系数必须为一： $4A + B = 1$\n    \\item 为了达到 $O(h^4)$ 的精度，$h^2 u''''_i$ 项的系数必须为零： $\\frac{4}{3}A + \\frac{1}{12}B = 0$\n\\end{enumerate}\n我们现在解这个方程组。由第三个方程可得：\n$$\n\\frac{4}{3}A = -\\frac{1}{12}B \\implies 16A = -B \\implies B = -16A\n$$\n将此结果代入第二个方程：\n$$\n4A + (-16A) = 1 \\implies -12A = 1 \\implies A = -\\frac{1}{12}\n$$\n现在我们求 $B$：\n$$\nB = -16A = -16\\left(-\\frac{1}{12}\\right) = \\frac{16}{12} = \\frac{4}{3}\n$$\n最后，使用第一个方程求 $C$：\n$$\nC = -2A - 2B = -2\\left(-\\frac{1}{12}\\right) - 2\\left(\\frac{4}{3}\\right) = \\frac{2}{12} - \\frac{8}{3} = \\frac{1}{6} - \\frac{16}{6} = -\\frac{15}{6} = -\\frac{5}{2}\n$$\n因此，系数为 $A = -\\frac{1}{12}$，$B = \\frac{4}{3}$，以及 $C = -\\frac{5}{2}$。\n\n求出系数后，我们现在可以确定截断误差。使用这些系数，$u_i$ 和 $u''''_i$ 的项消失，$u''_i$ 的项系数为1。有限差分近似变为：\n$$\n\\frac{S}{h^2} = u''_i + \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right)h^4 u^{(6)}_i + O(h^6)\n$$\n截断误差 $T_i$ 定义为精确值减去近似值：\n$$\nT_i = u''_i - \\frac{S}{h^2} = - \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right)h^4 u^{(6)}_i - O(h^6)\n$$\n我们来计算主误差项的系数：\n$$\n- \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right) = - \\left(\\frac{8}{45}\\left(-\\frac{1}{12}\\right) + \\frac{1}{360}\\left(\\frac{4}{3}\\right)\\right) = - \\left(-\\frac{8}{540} + \\frac{4}{1080}\\right)\n$$\n$$\n= - \\left(-\\frac{16}{1080} + \\frac{4}{1080}\\right) = - \\left(-\\frac{12}{1080}\\right) = \\frac{12}{1080} = \\frac{1}{90}\n$$\n因此，截断误差为 $T_i = \\frac{1}{90}h^4 u^{(6)}_i + O(h^6)$。这验证了该近似确实是四阶精度，即 $O(h^4)$，且主阶截断误差项为 $\\frac{h^4 u^{(6)}(x_i)}{90}$。\n\n最后一步是构造闭式差分格式表达式。将系数 $A$、$B$ 和 $C$ 代入近似公式：\n$$\nu''(x_i) \\approx \\frac{1}{h^2}\\left(-\\frac{1}{12}u_{i-2} + \\frac{4}{3}u_{i-1} - \\frac{5}{2}u_i + \\frac{4}{3}u_{i+1} - \\frac{1}{12}u_{i+2}\\right)\n$$\n为了在括号内使用整数系数，我们可以提取公分母 $12$：\n$$\nA = -\\frac{1}{12}, \\quad B = \\frac{4}{3} = \\frac{16}{12}, \\quad C = -\\frac{5}{2} = -\\frac{30}{12}\n$$\n该近似可以写为：\n$$\nu''(x_i) \\approx \\frac{1}{12h^2}\\left(-u_{i-2} + 16u_{i-1} - 30u_i + 16u_{i+1} - u_{i+2}\\right)\n$$\n这就是所求的二阶导数的四阶中心差分近似。",
            "answer": "$$\n\\boxed{\\frac{-u_{i-2} + 16u_{i-1} - 30u_i + 16u_{i+1} - u_{i+2}}{12h^2}}\n$$"
        },
        {
            "introduction": "理论上的精度阶数必须通过数值实验来验证，这是保证代码正确性的关键步骤。本练习将指导你设计一个网格加密研究（grid refinement study），以经验性地验证你在理论上推导出的不同差分格式的精度阶数 。通过这个实践，你将学会如何从数值误差中提取出收敛阶，从而连接起理论分析与计算实践。",
            "id": "3318157",
            "problem": "设计并实现一个数值网格加密研究，从 Taylor 级数展开以及相容性和阶的定义出发，经验性地验证二阶导数 $u''(x)$ 有限差分近似的形式精度阶。该研究必须纯粹用数学术语来表述和执行，角度以弧度为单位。\n\n您必须基于以下基本原则：\n- 使用光滑函数 $u(x)$ 在点 $x^\\star$ 附近的 Taylor 级数展开，基于间距为 $h>0$ 的均匀网格上的 $u$ 值，构造和分析 $u''(x^\\star)$ 的有限差分近似。\n- 将网格间距为 $h$ 时在 $x^\\star$ 处的观测误差定义为 $E(h) = \\lvert D_h[u](x^\\star) - u''(x^\\star)\\rvert$，其中 $D_h$ 表示由指定模板构造的有限差分算子。\n- 假设当 $h \\to 0^+$ 时，误差满足渐近模型 $E(h) \\approx C h^p$（其中常数 $C>0$ 和 $p>0$），并解释如何通过对 $\\log E(h)$ 与 $\\log h$ 进行最小二乘拟合，从测量误差中提取指数 $p$。\n\n实现一个单一的程序来执行以下任务。\n\n1. 选择一个光滑测试函数和一个求值点：\n   - 设 $u(x) = e^{x} + \\sin(7x)$，其中所有角度均以弧度为单位。\n   - 其精确的二阶导数是 $u''(x) = e^{x} - 49 \\sin(7x)$。\n   - 固定求值点为 $x^\\star = 0.3$。\n\n2. 定义一个均匀网格间距的加密序列：\n   - 使用集合 $\\{h_k\\}_{k=1}^{5}$，其中 $h_k \\in \\{2^{-3}, 2^{-4}, 2^{-5}, 2^{-6}, 2^{-7}\\}$。\n\n3. 指定要测试的四种不同模板，每种模板都基于距 $x^\\star$ 的偏移量 $\\{j h\\}$ 处的函数值来构造 $u''(x^\\star)$ 的有限差分近似：\n   - 前向单侧三点模板：偏移量 $j \\in \\{0, 1, 2\\}$。\n   - 后向单侧三点模板：偏移量 $j \\in \\{0, -1, -2\\}$。\n   - 中心三点模板：偏移量 $j \\in \\{-1, 0, 1\\}$。\n   - 中心五点模板：偏移量 $j \\in \\{-2, -1, 0, 1, 2\\}$。\n   对每种模板，通过满足必要的 Taylor 矩条件来构造近似 $u''(x^\\star)$ 的权重，以使算子与 $x^\\star$ 处的二阶导数相容。权重的构造必须遵循基本的 Taylor 级数原理；不要假设任何未从这些原理推导出的结果。\n\n4. 对于每种模板和每个 $h_k$：\n   - 通过将 $u(x^\\star + j h_k)$ 的相应加权和除以 $h_k^2$ 来构成近似值 $D_{h_k}[u](x^\\star)$。\n   - 计算绝对误差 $E(h_k) = \\lvert D_{h_k}[u](x^\\star) - u''(x^\\star)\\rvert$。\n\n5. 对于每种模板，通过对数据对 $\\{(\\log h_k, \\log E(h_k))\\}_{k=1}^{5}$ 应用线性最小二乘拟合来估计观测到的精度阶 $p$：\n   - 使用自然对数。\n   - 将直线 $y = a + p x$ 拟合到 $x = \\log h_k$, $y = \\log E(h_k)$，并将斜率 $p$ 作为观测阶报告。\n\n测试套件和答案规范：\n- 测试套件包括上面列出的四种模板和集合 $\\{2^{-3}, 2^{-4}, 2^{-5}, 2^{-6}, 2^{-7}\\}$ 中的五个 $h_k$ 值。\n- 对于每种模板，计算观测阶 $p$（实数）。\n- 您的程序应输出一行，其中包含四个观测阶的列表，顺序为：前向三点、后向三点、中心三点、中心五点。每个观测阶必须四舍五入到三位小数。\n- 最终输出格式：单行形式为 $[p_1,p_2,p_3,p_4]$，其中 $p_i$ 是四舍五入到三位小数的浮点数，无额外文本。\n\n此任务不涉及物理单位；三角函数的所有角度必须以弧度处理。该任务纯粹是数学和数值计算性质的。",
            "solution": "目标是经验性地确定四种不同有限差分模板近似二阶导数 $u''(x)$ 的精度阶 $p$。这是通过网格加密研究实现的。精度阶由渐近误差模型 $E(h) \\approx C h^p$ 定义，其中 $E(h)$ 是网格间距为 $h$ 时近似的绝对误差，$C$ 是一个常数。我们可以通过观察到 $\\log E(h) \\approx \\log C + p \\log h$ 来确定 $p$。这表明 $\\log E$ 和 $\\log h$ 之间存在线性关系，其斜率就是精度阶 $p$。我们将计算一系列递减网格间距 $h_k$ 的误差，然后对 $(\\log h_k, \\log E_k)$ 数据使用线性最小二乘拟合来估计斜率 $p$。\n\n该方法的基础在于 Taylor 级数展开。二阶导数 $u''(x^\\star)$ 的有限差分近似 $D_h[u](x^\\star)$ 是 $x^\\star$ 附近网格点上函数值 $u(x)$ 的线性组合。设网格点为 $x^\\star + j h$，其中 $j \\in S$ 是一组整数偏移量。其一般形式为：\n$$ D_h[u](x^\\star) = \\frac{1}{h^2} \\sum_{j \\in S} w_j u(x^\\star + j h) $$\n权重 $w_j$是通过将 $D_h[u](x^\\star)$ 的 Taylor 级数展开与期望的导数相匹配来确定的。将每个 $u(x^\\star + j h)$ 项在 $x^\\star$ 附近展开：\n$$ u(x^\\star + j h) = u(x^\\star) + (j h) u'(x^\\star) + \\frac{(j h)^2}{2!} u''(x^\\star) + \\frac{(j h)^3}{3!} u'''(x^\\star) + \\dots = \\sum_{k=0}^{\\infty} \\frac{(jh)^k}{k!} u^{(k)}(x^\\star) $$\n将此代入 $D_h[u](x^\\star)$ 的公式中：\n$$ D_h[u](x^\\star) = \\frac{1}{h^2} \\sum_{j \\in S} w_j \\sum_{k=0}^{\\infty} \\frac{(jh)^k}{k!} u^{(k)}(x^\\star) $$\n重排求和顺序可得：\n$$ D_h[u](x^\\star) = \\sum_{k=0}^{\\infty} \\left[ \\frac{h^{k-2}}{k!} \\left( \\sum_{j \\in S} j^k w_j \\right) \\right] u^{(k)}(x^\\star) $$\n为了使 $D_h[u](x^\\star)$ 成为 $u''(x^\\star)$ 的良好近似，$u''(x^\\star)$ 的系数必须为 1，而其他导数（特别是低阶导数）的系数应为 0。这就导出了一个关于权重 $w_j$ 的线性方程组，称为矩条件：\n\\begin{enumerate}\n    \\item $u(x^\\star)$ 的系数 ($k=0$): $\\frac{1}{h^2} \\sum_{j \\in S} w_j = 0 \\implies \\sum_{j \\in S} w_j = 0$\n    \\item $u'(x^\\star)$ 的系数 ($k=1$): $\\frac{1}{h} \\sum_{j \\in S} j w_j = 0 \\implies \\sum_{j \\in S} j w_j = 0$\n    \\item $u''(x^\\star)$ 的系数 ($k=2$): $\\frac{1}{2!} \\sum_{j \\in S} j^2 w_j = 1 \\implies \\sum_{j \\in S} j^2 w_j = 2$\n\\end{enumerate}\n为了获得更高的精度阶，我们可以通过将更高阶导数项的系数设为零来施加额外条件。截断误差 $T(h) = D_h[u](x^\\star) - u''(x^\\star)$ 展开式中的第一个非零项决定了精度阶。如果首项误差项与 $h^p$ 成正比，则该方法的精度为 $p$ 阶。\n\n我们现在为每种指定的模板推导权重和理论阶。\n\n1.  **前向单侧三点模板**：该模板使用偏移量 $S = \\{0, 1, 2\\}$。我们需要求解三个权重 $w_0, w_1, w_2$，因此我们使用前三个矩条件：\n    $$ w_0 + w_1 + w_2 = 0 $$\n    $$ 0 \\cdot w_0 + 1 \\cdot w_1 + 2 \\cdot w_2 = 0 \\implies w_1 + 2w_2 = 0 $$\n    $$ 0^2 \\cdot w_0 + 1^2 \\cdot w_1 + 2^2 \\cdot w_2 = 2 \\implies w_1 + 4w_2 = 2 $$\n    求解该方程组可得 $w_2=1$，$w_1=-2$ 和 $w_0=1$。首项误差项由第一个非零的高阶矩（即 $k=3$ 时）决定：\n    $$ \\sum_{j \\in S} j^3 w_j = 0^3(1) + 1^3(-2) + 2^3(1) = 6 $$\n    截断误差的首项是 $\\frac{h^{3-2}}{3!} (6) u'''(x^\\star) = h u'''(x^\\star)$。误差为 $O(h)$，因此形式阶为 $p=1$。\n\n2.  **后向单侧三点模板**：该模板使用偏移量 $S = \\{0, -1, -2\\}$。矩条件是：\n    $$ w_0 + w_{-1} + w_{-2} = 0 $$\n    $$ 0 \\cdot w_0 - 1 \\cdot w_{-1} - 2 \\cdot w_{-2} = 0 \\implies w_{-1} + 2w_{-2} = 0 $$\n    $$ 0^2 \\cdot w_0 + (-1)^2 \\cdot w_{-1} + (-2)^2 \\cdot w_{-2} = 2 \\implies w_{-1} + 4w_{-2} = 2 $$\n    该方程组与前向情况类似，求解可得 $w_{-2}=1$，$w_{-1}=-2$ 和 $w_0=1$。首项误差项由 $k=3$ 的矩决定：\n    $$ \\sum_{j \\in S} j^3 w_j = 0^3(1) + (-1)^3(-2) + (-2)^3(1) = 2 - 8 = -6 $$\n    首项误差项是 $\\frac{h}{6}(-6)u'''(x^\\star) = -h u'''(x^\\star)$。误差为 $O(h)$，因此形式阶为 $p=1$。\n\n3.  **中心三点模板**：该模板使用偏移量 $S = \\{-1, 0, 1\\}$。矩条件是：\n    $$ w_{-1} + w_0 + w_1 = 0 $$\n    $$ -1 \\cdot w_{-1} + 0 \\cdot w_0 + 1 \\cdot w_1 = 0 \\implies w_{-1} = w_1 $$\n    $$ (-1)^2 \\cdot w_{-1} + 0^2 \\cdot w_0 + 1^2 \\cdot w_1 = 2 \\implies w_{-1} + w_1 = 2 $$\n    这可解得 $w_1=1$, $w_{-1}=1$ 和 $w_0=-2$。由于模板和权重的对称性，任何奇数次幂 $k$ 的和都为零（$\\sum j^{2m+1} w_j = 0$）。因此，$k=3$ 的矩为零。我们必须检查 $k=4$ 的矩：\n    $$ \\sum_{j \\in S} j^4 w_j = (-1)^4(1) + 0^4(-2) + 1^4(1) = 2 $$\n    首项误差项是 $\\frac{h^{4-2}}{4!} (2) u^{(4)}(x^\\star) = \\frac{h^2}{12} u^{(4)}(x^\\star)$。误差为 $O(h^2)$，因此形式阶为 $p=2$。\n\n4.  **中心五点模板**：该模板使用偏移量 $S = \\{-2, -1, 0, 1, 2\\}$。我们有五个权重，这使得我们可以满足更多的矩条件以获得更高精度。我们强制要求对称性（$w_{-j}=w_j$），这会自动消除奇数矩。我们将 $k=4$ 的矩设为零，以消除 $O(h^2)$ 误差项。条件是：\n    $$ w_0 + 2w_1 + 2w_2 = 0 \\quad (\\text{来自 } \\sum w_j = 0) $$\n    $$ 2w_1(1^2) + 2w_2(2^2) = 2 \\implies w_1 + 4w_2 = 1 \\quad (\\text{来自 } \\sum j^2 w_j = 2) $$\n    $$ 2w_1(1^4) + 2w_2(2^4) = 0 \\implies w_1 + 16w_2 = 0 \\quad (\\text{来自 } \\sum j^4 w_j = 0) $$\n    求解该方程组可得 $w_2 = -1/12$，$w_1 = 4/3$ 和 $w_0 = -5/2$。首项误差由第一个非零的高阶矩（即 $k=6$ 时）决定：\n    $$ \\sum_{j \\in S} j^6 w_j = 2(w_1 \\cdot 1^6 + w_2 \\cdot 2^6) = 2(4/3 - 64/12) = 2(4/3 - 16/3) = -8 $$\n    首项误差项是 $\\frac{h^{6-2}}{6!} (-8) u^{(6)}(x^\\star) = -\\frac{h^4}{90} u^{(6)}(x^\\star)$。误差为 $O(h^4)$，因此形式阶为 $p=4$。\n\n数值实验使用函数 $u(x) = e^{x} + \\sin(7x)$ 及其在点 $x^\\star = 0.3$ 处的精确二阶导数 $u''(x) = e^{x} - 49 \\sin(7x)$ 来执行。对于每种模板，我们为每个网格间距 $h_k \\in \\{2^{-3}, 2^{-4}, 2^{-5}, 2^{-6}, 2^{-7}\\}$ 计算近似值 $D_{h_k}[u](x^\\star)$ 和误差 $E(h_k) = |D_{h_k}[u](x^\\star) - u''(x^\\star)|$。然后，我们对点 $(\\log h_k, \\log E_k)$ 进行线性回归，以找到斜率，该斜率即为观测到的精度阶 $p$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a numerical grid refinement study to empirically\n    verify the formal order of accuracy of four finite difference stencils for\n    the second derivative.\n    \"\"\"\n    \n    # 1. Choose a smooth test function and an evaluation point.\n    u = lambda x: np.exp(x) + np.sin(7 * x)\n    x_star = 0.3\n    \n    # Its exact second derivative value at the evaluation point.\n    u_xx_exact = np.exp(x_star) - 49 * np.sin(7 * x_star)\n\n    # 2. Define a refinement sequence of uniform grid spacings.\n    h_values = np.array([2.0**(-k) for k in range(3, 8)])\n\n    # 3. Specify the four distinct stencils to be tested.\n    # Each stencil is defined by a tuple of (offsets, weights).\n    # The weights were derived from Taylor series expansions.\n    stencils = {\n        \"forward_3pt\": (\n            [0, 1, 2],\n            [1.0, -2.0, 1.0]\n        ),\n        \"backward_3pt\": (\n            [-2, -1, 0],\n            [1.0, -2.0, 1.0]\n        ),\n        \"central_3pt\": (\n            [-1, 0, 1],\n            [1.0, -2.0, 1.0]\n        ),\n        \"central_5pt\": (\n            [-2, -1, 0, 1, 2],\n            [-1.0/12.0, 4.0/3.0, -5.0/2.0, 4.0/3.0, -1.0/12.0]\n        )\n    }\n\n    # The problem specifies the output order.\n    stencil_order = [\"forward_3pt\", \"backward_3pt\", \"central_3pt\", \"central_5pt\"]\n    \n    observed_orders = []\n\n    # 4.  5. Loop through stencils, compute errors, and estimate order of accuracy.\n    for name in stencil_order:\n        offsets, weights = stencils[name]\n        \n        errors = []\n        # For each h in the refinement sequence:\n        for h in h_values:\n            # Form the approximation D_h[u](x_star).\n            # D_h = (1/h^2) * sum(w_j * u(x_star + j*h))\n            approx_sum = 0.0\n            for j, w in zip(offsets, weights):\n                approx_sum += w * u(x_star + j * h)\n            u_xx_approx = approx_sum / (h**2)\n            \n            # Compute the absolute error E(h).\n            error = np.abs(u_xx_approx - u_xx_exact)\n            errors.append(error)\n\n        # Estimate the observed order of accuracy p with a linear least-squares fit.\n        # The model is log(E) = log(C) + p*log(h).\n        # We fit a line y = a + p*x to the data (x=log(h), y=log(E)).\n        log_h = np.log(h_values)\n        log_E = np.log(np.array(errors))\n        \n        # np.polyfit returns the coefficients [p, a] for the polynomial p*x + a.\n        p, _ = np.polyfit(log_h, log_E, 1)\n        \n        observed_orders.append(p)\n\n    # Format the results as specified.\n    rounded_orders = [round(p, 3) for p in observed_orders]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, rounded_orders))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在模拟波传播等对流主导的问题时，仅仅关注局部截断误差是不够的，控制数值色散同样至关重要。本练习将引入一个更高级的概念——修正波数（modified wavenumber），并要求你设计一个色散关系保持（Dispersion-Relation-Preserving, DRP）格式 。这个练习展示了如何将格式设计视为一个约束优化问题，从而根据所模拟的物理现象来定制最优的数值格式。",
            "id": "3318142",
            "problem": "考虑一个间距为 $\\Delta x$ 的一维均匀网格，用于通过一个以 $x$ 为中心的 $(2m+1)$ 点模板构建的线性、移位不变的有限差分算子来近似空间导数 $u'(x)$。对于一个非耗散中心格式，模板系数是反对称的：$c_{-j} = -c_{j}$ (对于 $j=1,\\dots,m$)，并且 $c_{0}=0$。令数值导数算子定义为\n$$\n\\mathcal{D}_{\\Delta x} u(x) \\equiv \\frac{1}{\\Delta x} \\sum_{j=-m}^{m} c_{j} \\, u(x + j \\Delta x).\n$$\n在均匀网格上，此类算子对傅里叶模态 $u(x) = \\exp(i \\kappa x)$ 的响应由一个离散符号来表征。定义无量纲波数 $k \\equiv \\kappa \\Delta x \\in [0,\\pi]$（受奈奎斯特波数限制），修正波数 $\\tilde{k}(k)$ 是满足以下条件的实标量：\n$$\n\\mathcal{D}_{\\Delta x} \\exp(i \\kappa x) = \\frac{i}{\\Delta x} \\tilde{k}(k) \\exp(i \\kappa x).\n$$\n色散关系保持（DRP）设计方法旨在通过最小化积分色散误差，来优化波数带 $k \\in [0,\\pi]$ 上的相位精度，从而找到最佳的模板系数。从 $u(x+j\\Delta x)$ 关于 $x$ 的泰勒展开和导数的定义出发，通过要求展开式中的主导项精确成立，可以得到 $O(\\Delta x^{p})$ 阶的精度约束。\n\n设计一个用于 $u'(x)$ 的七点（$m=3$）反对称中心模板，该模板具有四阶精度（$p=4$），并能最小化积分色散误差\n$$\n\\int_{0}^{\\pi} \\left| \\tilde{k}(k) - k \\right|^{2} \\, dk,\n$$\n同时服从于从泰勒展开导出的 $O(\\Delta x^{4})$ 精度约束。使用上述无量纲波数的定义以及反对称性（即 $c_{0}=0$ 和 $c_{-j}=-c_{j}$）。请以精确解析形式将您的最终答案表示为模板系数的有序列表 $\\{c_{-3}, c_{-2}, c_{-1}, c_{0}, c_{1}, c_{2}, c_{3}\\}$。无需四舍五入。",
            "solution": "问题陈述经评估有效。这是一个在计算流体力学数值分析领域内适定的、有科学依据的问题。问题是自洽的，提供了所有必要的定义和约束，并且没有任何科学或逻辑上的矛盾。任务是求解一个约束优化问题以找到有限差分格式的系数，这是设计此类格式的标准流程。\n\n问题是设计一个用于一阶导数 $u'(x)$ 的七点（$m=3$）反对称中心有限差分模板，该模板具有四阶精度（$p=4$）并能最小化积分色散误差。模板系数用 $c_j$ 表示，其中 $j \\in \\{-3, -2, -1, 0, 1, 2, 3\\}$。\n\n首先，我们根据精度要求建立系数 $c_j$ 的约束条件。有限差分算子的一般形式如下：\n$$\n\\mathcal{D}_{\\Delta x} u(x) \\equiv \\frac{1}{\\Delta x} \\sum_{j=-m}^{m} c_{j} \\, u(x + j \\Delta x)\n$$\n问题指定了一个反对称模板，这意味着 $c_0 = 0$ 且 $c_{-j} = -c_j$。对于 $m=3$，算子可以写成：\n$$\n\\mathcal{D}_{\\Delta x} u(x) = \\frac{1}{\\Delta x} \\sum_{j=1}^{3} c_j \\left[ u(x+j\\Delta x) - u(x-j\\Delta x) \\right]\n$$\n为了确定精度，我们将 $u(x \\pm j\\Delta x)$ 在 $x$ 点的泰勒级数展开代入算子。差分项为：\n$$\nu(x+j\\Delta x) - u(x-j\\Delta x) = \\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x)}{k!} \\left[ (j\\Delta x)^k - (-j\\Delta x)^k \\right] = 2 \\sum_{l=0}^{\\infty} \\frac{(j\\Delta x)^{2l+1}}{(2l+1)!} u^{(2l+1)}(x)\n$$\n将此代入算子表达式，得到：\n$$\n\\mathcal{D}_{\\Delta x} u(x) = \\frac{1}{\\Delta x} \\sum_{j=1}^{3} c_j \\left[ 2j\\Delta x u'(x) + \\frac{2(j\\Delta x)^3}{3!} u'''(x) + \\frac{2(j\\Delta x)^5}{5!} u^{(5)}(x) + \\dots \\right]\n$$\n$$\n= \\left( 2\\sum_{j=1}^{3} j c_j \\right) u'(x) + \\left( \\frac{1}{3}\\sum_{j=1}^{3} j^3 c_j \\right) (\\Delta x)^2 u'''(x) + \\left( \\frac{1}{60}\\sum_{j=1}^{3} j^5 c_j \\right) (\\Delta x)^4 u^{(5)}(x) + O(\\Delta x^6)\n$$\n为使该算子近似 $u'(x)$，$u'(x)$ 的系数必须为1。为使格式达到四阶精度（$p=4$），$(\\Delta x)^2 u'''(x)$ 项的系数必须为零，从而使主导误差项与 $(\\Delta x)^4$ 成正比。这为三个未知系数 $c_1, c_2, c_3$ 带来了两个约束方程：\n1. $2\\sum_{j=1}^{3} j c_j = 1 \\implies c_1 + 2c_2 + 3c_3 = \\frac{1}{2}$\n2. $\\sum_{j=1}^{3} j^3 c_j = 0 \\implies c_1 + 8c_2 + 27c_3 = 0$\n\n接下来，我们推导修正波数 $\\tilde{k}(k)$。将算子应用于傅里叶模态 $u(x) = \\exp(i\\kappa x)$，其中 $k=\\kappa \\Delta x$：\n$$\n\\mathcal{D}_{\\Delta x} \\exp(i\\kappa x) = \\frac{1}{\\Delta x} \\sum_{j=-3}^{3} c_j \\exp(i\\kappa(x+j\\Delta x)) = \\frac{\\exp(i\\kappa x)}{\\Delta x} \\sum_{j=-3}^{3} c_j \\exp(ijk)\n$$\n使用反对称性 $c_0=0$ 和 $c_{-j}=-c_j$：\n$$\n\\sum_{j=-3}^{3} c_j \\exp(ijk) = \\sum_{j=1}^{3} c_j (\\exp(ijk) - \\exp(-ijk)) = \\sum_{j=1}^{3} c_j (2i \\sin(jk)) = 2i \\sum_{j=1}^{3} c_j \\sin(jk)\n$$\n根据定义，$\\mathcal{D}_{\\Delta x} \\exp(i\\kappa x) = \\frac{i}{\\Delta x}\\tilde{k}(k)\\exp(i\\kappa x)$。比较这些表达式，我们得到修正波数：\n$$\n\\tilde{k}(k) = 2 \\sum_{j=1}^{3} c_j \\sin(jk) = 2(c_1 \\sin(k) + c_2 \\sin(2k) + c_3 \\sin(3k))\n$$\n问题现在是一个约束优化问题：在关于 $c_1, c_2, c_3$ 的两个线性约束条件下，最小化 $E = \\int_{0}^{\\pi} (\\tilde{k}(k) - k)^2 dk$。我们求解约束系统，用 $c_3$ 表示 $c_1$ 和 $c_2$。将第二个约束减去第一个约束得到：\n$6c_2 + 24c_3 = -\\frac{1}{2} \\implies c_2 = -4c_3 - \\frac{1}{12}$\n将 $c_2$ 代入第一个约束条件：\n$c_1 + 2(-4c_3 - \\frac{1}{12}) + 3c_3 = \\frac{1}{2} \\implies c_1 - 8c_3 - \\frac{1}{6} + 3c_3 = \\frac{1}{2} \\implies c_1 - 5c_3 = \\frac{2}{3} \\implies c_1 = 5c_3 + \\frac{2}{3}$\n\n现在，将这些代入 $\\tilde{k}(k)$ 的表达式：\n$$\n\\tilde{k}(k) = 2\\left(5c_3 + \\frac{2}{3}\\right)\\sin(k) + 2\\left(-4c_3 - \\frac{1}{12}\\right)\\sin(2k) + 2c_3\\sin(3k)\n$$\n$$\n= \\left(\\frac{4}{3}\\sin(k) - \\frac{1}{6}\\sin(2k)\\right) + c_3 \\left(10\\sin(k) - 8\\sin(2k) + 2\\sin(3k)\\right)\n$$\n令 $g(k) = \\frac{4}{3}\\sin(k) - \\frac{1}{6}\\sin(2k)$ 且 $f(k) = 10\\sin(k) - 8\\sin(2k) + 2\\sin(3k)$。需要最小化的误差泛函是 $E(c_3) = \\int_{0}^{\\pi} (g(k) + c_3f(k) - k)^2 dk$。为了找到最小值，我们令 $\\frac{dE}{dc_3} = 0$：\n$$\n\\frac{dE}{dc_3} = \\int_{0}^{\\pi} 2(g(k) + c_3f(k) - k)f(k) dk = 0\n$$\n$$\nc_3 \\int_{0}^{\\pi} f(k)^2 dk + \\int_{0}^{\\pi} g(k)f(k) dk - \\int_{0}^{\\pi} k f(k) dk = 0\n$$\n求解 $c_3$：\n$$\nc_3 = \\frac{\\int_{0}^{\\pi} k f(k) dk - \\int_{0}^{\\pi} g(k)f(k) dk}{\\int_{0}^{\\pi} f(k)^2 dk}\n$$\n我们使用标准积分结果 $\\int_{0}^{\\pi}\\sin(nk)\\sin(mk)dk = \\frac{\\pi}{2}\\delta_{nm}$ 和 $\\int_{0}^{\\pi} k \\sin(nk)dk = \\frac{-\\pi(-1)^n}{n}$（对于整数 $n,m > 0$）来计算积分。\n\n分母：$\\int_{0}^{\\pi} f(k)^2 dk = \\int_{0}^{\\pi} (10\\sin(k) - 8\\sin(2k) + 2\\sin(3k))^2 dk$。根据正交性：\n$$\n\\int_{0}^{\\pi} f(k)^2 dk = \\left(10^2 + (-8)^2 + 2^2\\right)\\frac{\\pi}{2} = (100+64+4)\\frac{\\pi}{2} = 168\\frac{\\pi}{2} = 84\\pi\n$$\n分子第一部分：$\\int_{0}^{\\pi} k f(k) dk = 10\\int_{0}^{\\pi} k\\sin(k)dk - 8\\int_{0}^{\\pi} k\\sin(2k)dk + 2\\int_{0}^{\\pi} k\\sin(3k)dk$\n$$\n= 10\\left(\\frac{-\\pi(-1)^1}{1}\\right) - 8\\left(\\frac{-\\pi(-1)^2}{2}\\right) + 2\\left(\\frac{-\\pi(-1)^3}{3}\\right) = 10\\pi + 4\\pi + \\frac{2\\pi}{3} = 14\\pi + \\frac{2\\pi}{3} = \\frac{44\\pi}{3}\n$$\n分子第二部分：$\\int_{0}^{\\pi} g(k)f(k) dk = \\int_{0}^{\\pi} (\\frac{4}{3}\\sin(k) - \\frac{1}{6}\\sin(2k))(10\\sin(k) - 8\\sin(2k) + \\dots) dk$。根据正交性：\n$$\n= \\left(\\frac{4}{3}\\right)(10)\\frac{\\pi}{2} + \\left(-\\frac{1}{6}\\right)(-8)\\frac{\\pi}{2} = \\frac{40}{3}\\frac{\\pi}{2} + \\frac{8}{6}\\frac{\\pi}{2} = \\frac{20\\pi}{3} + \\frac{2\\pi}{3} = \\frac{22\\pi}{3}\n$$\n现在，将这些结果代回以求得 $c_3$：\n$$\nc_3 = \\frac{\\frac{44\\pi}{3} - \\frac{22\\pi}{3}}{84\\pi} = \\frac{\\frac{22\\pi}{3}}{84\\pi} = \\frac{22}{3 \\times 84} = \\frac{11}{3 \\times 42} = \\frac{11}{126}\n$$\n已知 $c_3 = \\frac{11}{126}$，我们可以求出 $c_1$ 和 $c_2$：\n$$\nc_2 = -4c_3 - \\frac{1}{12} = -4\\left(\\frac{11}{126}\\right) - \\frac{1}{12} = -\\frac{44}{126} - \\frac{1}{12} = -\\frac{22}{63} - \\frac{1}{12} = \\frac{-22 \\times 4 - 21}{252} = -\\frac{109}{252}\n$$\n$$\nc_1 = 5c_3 + \\frac{2}{3} = 5\\left(\\frac{11}{126}\\right) + \\frac{2}{3} = \\frac{55}{126} + \\frac{2 \\times 42}{126} = \\frac{55 + 84}{126} = \\frac{139}{126}\n$$\n正索引的系数为 $c_1 = \\frac{139}{126}$，$c_2 = -\\frac{109}{252}$ 和 $c_3 = \\frac{11}{126}$。\n利用 $c_0=0$ 和 $c_{-j}=-c_j$，完整的模板系数集为：\n$$\nc_{-3} = -\\frac{11}{126}, \\quad c_{-2} = \\frac{109}{252}, \\quad c_{-1} = -\\frac{139}{126}, \\quad c_0 = 0, \\quad c_1 = \\frac{139}{126}, \\quad c_2 = -\\frac{109}{252}, \\quad c_3 = \\frac{11}{126}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{11}{126} & \\frac{109}{252} & -\\frac{139}{126} & 0 & \\frac{139}{126} & -\\frac{109}{252} & \\frac{11}{126} \\end{pmatrix}}\n$$"
        }
    ]
}