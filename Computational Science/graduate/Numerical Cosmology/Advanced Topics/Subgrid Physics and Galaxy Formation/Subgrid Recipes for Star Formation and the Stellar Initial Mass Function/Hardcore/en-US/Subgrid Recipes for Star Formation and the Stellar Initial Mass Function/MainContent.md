## Introduction
The evolution of galaxies, from their turbulent formation in the early universe to the diverse structures we observe today, is fundamentally driven by the lifecycle of stars. While the laws of gravity and hydrodynamics that govern large-scale cosmic structures are well understood, a significant challenge arises in bridging these scales to the compact, dense environments where individual stars are born. Cosmological simulations, our primary tools for modeling galaxy evolution, lack the resolution to capture the intricate process of [star formation](@entry_id:160356) directly. This creates a critical gap between the resolved physics of galactic dynamics and the unresolved physics of the [interstellar medium](@entry_id:150031).

This article addresses this "resolution problem" by delving into the subgrid recipes that have become indispensable components of modern [computational astrophysics](@entry_id:145768). These models are physically motivated, phenomenological rules that allow simulations to form stars based on the properties of the resolved gas, effectively parameterizing the complex physics occurring below the [resolution limit](@entry_id:200378). By exploring these [subgrid models](@entry_id:755601), you will gain a comprehensive understanding of how simulations connect the microphysics of stellar birth to the macrophysics of galaxy evolution.

The following chapters will guide you through this topic. In **Principles and Mechanisms**, we will lay the theoretical groundwork, exploring the physical criteria and [rate laws](@entry_id:276849) that govern subgrid [star formation](@entry_id:160356) and the critical role of the [stellar initial mass function](@entry_id:755432) (IMF). In **Applications and Interdisciplinary Connections**, we will examine how these models are calibrated against observations, how they drive galaxy evolution through feedback, and how they connect [star formation](@entry_id:160356) to other frontier topics. Finally, **Hands-On Practices** will provide concrete problems to solidify your understanding of these core concepts.

## Principles and Mechanisms

The evolution of galaxies is a multi-scale process, governed by the interplay of gravity, [hydrodynamics](@entry_id:158871), and the lifecycle of stars. While the governing equations of gravity and fluid dynamics are well-understood, their application in [cosmological simulations](@entry_id:747925) is computationally bounded by finite resolution. The processes of star formation and the subsequent feedback of energy, momentum, and [heavy elements](@entry_id:272514) into the interstellar medium (ISM) occur on scales far smaller than what can be feasibly resolved in simulations of entire galaxies. This [scale separation](@entry_id:152215) necessitates the development of **[subgrid models](@entry_id:755601)**: physically motivated, phenomenological prescriptions that parameterize the effects of unresolved processes based on the properties of the resolved gas. This chapter details the core principles and mechanisms underpinning these essential components of modern galaxy formation simulations.

### The Resolution Problem and the Need for Subgrid Models

The fundamental driver of star formation is the [gravitational collapse](@entry_id:161275) of dense interstellar gas. In a uniform, isothermal, self-gravitating medium, the stability of a density perturbation is determined by a characteristic physical scale known as the **Jeans length**, $\lambda_J$. Perturbations larger than this length are gravitationally unstable and will collapse, while smaller perturbations are stabilized by [thermal pressure](@entry_id:202761) and propagate as sound waves. The Jeans length is given by:

$$ \lambda_J = c_s \sqrt{\frac{\pi}{G\rho}} $$

where $c_s$ is the isothermal sound speed, $\rho$ is the gas density, and $G$ is the [gravitational constant](@entry_id:262704). The sound speed itself depends on the gas temperature $T$ and mean molecular weight $\mu$ as $c_s = \sqrt{k_B T / (\mu m_p)}$, where $k_B$ is the Boltzmann constant and $m_p$ is the proton mass.

For a [numerical hydrodynamics](@entry_id:752794) simulation to accurately capture the process of gravitational fragmentation, it must resolve the Jeans length. The **Bate-Burkert criterion** (or Truelove criterion) formalizes this requirement, stating that the grid resolution $\Delta x$ must be significantly smaller than the Jeans length, typically $\Delta x \le \lambda_J / N_J$, where $N_J$ is a resolution factor of at least 4.

However, in typical simulations of galaxy formation, this criterion is overwhelmingly violated. Consider, for example, a dense, star-forming patch of gas in a high-redshift galaxy with a hydrogen [number density](@entry_id:268986) $n_{\mathrm{H}} = 100\,\mathrm{cm^{-3}}$ and temperature $T = 100\,\mathrm{K}$. For such conditions, the Jeans length is approximately $\lambda_J \approx 9\,\mathrm{pc}$. A state-of-the-art cosmological "zoom-in" simulation might achieve a spatial resolution of $\Delta x = 50\,\mathrm{pc}$ in its highest-resolution region. In this case, $\lambda_J \ll \Delta x$, and the simulation grid is far too coarse to resolve the physical scale of [gravitational collapse](@entry_id:161275) . The numerical scheme would therefore artificially suppress the very fragmentation that leads to star formation.

This resolution shortfall is the primary motivation for [subgrid models](@entry_id:755601). Since the simulation cannot form stars "naturally," we must introduce a recipe that does so artificially, based on the resolved, cell-averaged properties of the gas. A **subgrid [star formation](@entry_id:160356) recipe** is thus a [closure relation](@entry_id:747393) that maps resolved gas properties—such as density, temperature, metallicity, and kinematic state—to a rate of star formation. When this recipe triggers, a fraction of the gas mass in a cell is converted into a collisionless **star particle**. It is crucial to understand that in galaxy-scale simulations, a single star particle does not represent an individual star but rather a **simple stellar population (SSP)**: a collection of thousands or millions of stars assumed to have formed at the same time and place with a shared metallicity. The properties of this population, and the subsequent feedback it imparts, are determined by an assumed [stellar initial mass function](@entry_id:755432) (IMF).

### Criteria for Star Formation

A robust subgrid model must include a set of criteria to identify gas that is physically likely to be undergoing [star formation](@entry_id:160356), distinguishing it from gas that is merely dense but stable, hot, or expanding. These criteria act as a gate, permitting [star formation](@entry_id:160356) only in cells that satisfy specific physical conditions.

#### Density, Temperature, and Kinematic Thresholds

The most fundamental criterion is a **density threshold**. Star formation is restricted to gas with a density $\rho$ exceeding a threshold $\rho_{\mathrm{th}}$ (or, equivalently, a [number density](@entry_id:268986) $n_{\mathrm{H}} > n_{\mathrm{th}}$). A physically motivated way to set this threshold is to tie it directly to the simulation's [resolution limit](@entry_id:200378). By inverting the Jeans resolution criterion, we can define the threshold as the density at which the Jeans length becomes unresolved. For instance, we can require that [star formation](@entry_id:160356) is triggered when the local Jeans length drops below a few grid cells, $\lambda_J  N_J \Delta x$. Solving for density, this yields a resolution-dependent threshold :

$$ \rho_{\mathrm{th}} = \frac{\pi k_{\mathrmB} T}{G \mu m_{\mathrmp} (N_{\mathrmJ}\Delta x)^2} $$

This approach ensures that the subgrid model activates precisely where the simulation loses its ability to follow the collapse physically.

Density alone is insufficient. A gas parcel could be dense due to a passing shock wave but be too hot to collapse, or it could be part of a large-scale outflow. Therefore, additional criteria are commonly employed:

*   **Temperature Threshold:** Star formation is limited to cold gas, typically by requiring $T  T_{\max}$ (e.g., $T_{\max} \sim 10^4\,\mathrm{K}$ or lower). This ensures that thermal pressure support is not overwhelmingly dominant .
*   **Converging Flow:** To select for gas that is dynamically contracting, a kinematic criterion is often imposed, requiring the velocity field to be convergent: $\nabla \cdot \mathbf{v}  0$. This helps to exclude star formation in expanding shells or unbound, transient compressions .

#### Thermodynamic and Dynamical Criteria

More sophisticated models incorporate criteria related to the thermal and dynamical state of the gas.

A critical condition for gravitational collapse to proceed is that the gas must be able to efficiently radiate away the thermal energy generated by gravitational compression. If cooling is inefficient, the gas will heat up, increasing its pressure support and halting the collapse. This physical requirement can be translated into a criterion comparing the local cooling time, $t_{\mathrm{cool}}$, to the gravitational [free-fall time](@entry_id:261377), $t_{\mathrm{ff}}$. Star formation is permitted only if $t_{\mathrm{cool}}  t_{\mathrm{ff}}$ . The cooling time is defined as the ratio of the gas's internal energy density, $u$, to its volumetric cooling rate, $C$: $t_{\mathrm{cool}} = u/C$. The cooling rate is a complex function of the gas's temperature, density, and chemical composition, often tabulated in a **cooling function** $\Lambda(T,Z)$, where $Z$ is the metallicity. Since metal-[line cooling](@entry_id:157856) is a dominant process over a wide range of temperatures, the cooling time is strongly dependent on metallicity. Higher metallicity generally leads to more efficient cooling, a shorter $t_{\mathrm{cool}}$, and thus makes the criterion for [star formation](@entry_id:160356) easier to satisfy.

Another powerful criterion is based on the dynamical state of a potential star-forming region, often characterized by the **virial parameter**, $\alpha_{\mathrm{vir}}$. For a gas cloud of mass $M$, radius $R$, and internal one-dimensional velocity dispersion $\sigma$, the virial parameter is defined as the ratio of twice the [internal kinetic energy](@entry_id:167806) to the magnitude of the [gravitational potential energy](@entry_id:269038):

$$ \alpha_{\mathrm{vir}} = \frac{2 E_{\mathrm{kin}}}{|E_{\mathrm{grav}}|} \approx \frac{5 \sigma^2 R}{G M} $$

where the approximation holds for a uniform sphere . The kinetic term $\sigma^2$ includes contributions from both thermal motion and unresolved turbulence. A value of $\alpha_{\mathrm{vir}} \approx 1$ signifies virial equilibrium (for an isolated, unmagnetized sphere). A cloud with $\alpha_{\mathrm{vir}} \gg 1$ is kinetically supported and unbound, while a cloud with $\alpha_{\mathrm{vir}} \ll 1$ is dominated by [self-gravity](@entry_id:271015) and is unstable to collapse. Subgrid models can use a criterion like $\alpha_{\mathrm{vir}}  2$ to select gas parcels that are gravitationally bound and likely to collapse, providing a robust way to account for turbulent support.

Finally, observations show that star formation in the local universe occurs almost exclusively within giant [molecular clouds](@entry_id:160702). This motivates models where [star formation](@entry_id:160356) is tied to the **molecular hydrogen ($\text{H}_2$) fraction**, $f_{\mathrm{H_2}} \equiv 2n_{\mathrm{H2}}/n_{\mathrm{H}}$. The equilibrium abundance of $\text{H}_2$ is set by a balance between its formation on the surfaces of dust grains (a process whose rate is proportional to density and metallicity) and its destruction by ultraviolet photons. Because of this, a high molecular fraction is a reliable tracer of the dense, cold, well-shielded environments where stars are born. Tying the star formation recipe to $f_{\text{H}_2}$ naturally incorporates dependencies on the local gas density, metallicity, and ambient [radiation field](@entry_id:164265) .

### The Rate of Star Formation

Once a gas cell is deemed eligible for star formation, the next question is how quickly it should convert its gas into stars. The most widely used prescription relates the [star formation](@entry_id:160356) rate density, $\dot{\rho}_{\star}$, to the local gas density $\rho$ and the gravitational **[free-fall time](@entry_id:261377)**, $t_{\mathrm{ff}}$:

$$ \dot{\rho}_{\star} = \epsilon_{\mathrm{ff}} \frac{\rho}{t_{\mathrm{ff}}} $$

The [free-fall time](@entry_id:261377) is the characteristic timescale for a pressureless, self-gravitating body to collapse, given by $t_{\mathrm{ff}} = \sqrt{3\pi / (32G\rho)}$. This implies $t_{\mathrm{ff}} \propto \rho^{-1/2}$. Substituting this into the [rate equation](@entry_id:203049) reveals a [non-linear dependence](@entry_id:265776) on density: $\dot{\rho}_{\star} \propto \rho^{1.5}$, a scaling consistent with the observed Kennicutt-Schmidt law .

The key parameter in this law is $\epsilon_{\mathrm{ff}}$, the dimensionless **efficiency per [free-fall time](@entry_id:261377)**. This parameter represents the fraction of gas in a region that is converted into stars over one [free-fall time](@entry_id:261377). Observationally, $\epsilon_{\mathrm{ff}}$ is found to be small, typically around $0.01$. This low efficiency reflects the fact that star formation is regulated by complex processes like turbulence and [stellar feedback](@entry_id:755431), which prevent the wholesale collapse of a gas cloud in a single [free-fall time](@entry_id:261377).

Theoretical models of turbulence-regulated [star formation](@entry_id:160356) provide a physical basis for the small value of $\epsilon_{\mathrm{ff}}$. In supersonic, isothermal turbulence, the gas density distribution is highly inhomogeneous and can be described by a lognormal probability density function (PDF). Star formation is thought to occur only in the highest-density fluctuations that exceed a critical threshold for collapse. The mass fraction in this high-density tail of the PDF is small. By integrating the star formation rate over the collapsing part of the density PDF, one can derive an analytic expression for $\epsilon_{\mathrm{ff}}$ that depends on the turbulent Mach number and the nature of the turbulent driving. These models naturally predict $\epsilon_{\mathrm{ff}} \ll 1$, with typical values in the range of $0.01$ to $0.1$, providing a first-principles justification for this crucial subgrid parameter .

### The Stellar Initial Mass Function and Its Consequences

After a subgrid model determines that a mass $\Delta M_{\star}$ of stars should form in a timestep, this mass must be distributed among stars of different individual masses. This distribution is the **[stellar initial mass function](@entry_id:755432) (IMF)**, defined as $\xi(m) = dN/dm$, which gives the number of stars $dN$ in a mass interval $dm$. The IMF is a cornerstone of [subgrid modeling](@entry_id:755600) because it determines the number of massive stars, which are the primary sources of [stellar feedback](@entry_id:755431) and chemical enrichment.

Several empirical forms for the IMF are widely used in simulations :
*   The **Salpeter IMF** (1955) is a single power law, $\xi(m) \propto m^{-2.35}$, which provides a good description for stars with masses $\gtrsim 1\,M_{\odot}$.
*   The **Kroupa IMF** (2001) is a broken power law, which is shallower below $\sim 0.5\,M_{\odot}$ ($\xi(m) \propto m^{-1.3}$) and steepens to a Salpeter-like slope at higher masses.
*   The **Chabrier IMF** (2003) is often preferred in modern simulations. It takes the form of a [lognormal distribution](@entry_id:261888) at low masses ($m \lesssim 1\,M_{\odot}$) and transitions to a power law similar to Salpeter's at high masses.

The choice of IMF has profound consequences because it sets the key parameters that govern feedback. For a given total mass of stars formed, the IMF allows us to calculate:
*   The **mass return fraction ($R$)**: The fraction of mass that is returned to the ISM via [stellar winds](@entry_id:161386) and supernova explosions.
*   The **net metal yield ($y$)**: The mass of newly synthesized heavy elements returned to the ISM per unit mass of stars formed.
*   The **[supernova](@entry_id:159451) rate ($\nu$)**: The number of core-collapse supernovae (from progenitors with $m \gtrsim 8\,M_{\odot}$) per unit mass of stars formed.

These IMF-dependent parameters directly impact the global evolution of simulated galaxies. A "top-heavy" IMF, which has a higher proportion of [massive stars](@entry_id:159884), will have a larger $R$, $y$, and $\nu$ compared to a Chabrier-like IMF. Using a simple "bathtub" or gas-regulator model, we can see how these choices propagate. In a steady state where gas inflow is balanced by [star formation](@entry_id:160356) and outflows, the equilibrium [star formation](@entry_id:160356) rate and gas-phase metallicity are given by :

$$ \dot{M}_{\star} = \frac{\dot{M}_{\mathrm{in}}}{1-R+\eta} \quad \text{and} \quad Z_{\mathrm{eq}} = \frac{y}{1-R+\eta} $$

Here, $\dot{M}_{\mathrm{in}}$ is the gas inflow rate and $\eta = \dot{M}_{\mathrm{out}}/\dot{M}_{\star}$ is the outflow mass-loading factor, which itself depends on the supernova energy injection rate ($\eta \propto \nu$). A switch to a top-heavy IMF increases $R$, $y$, and $\eta$. These changes have competing effects on $\dot{M}_{\star}$ and $Z_{\mathrm{eq}}$. A top-heavy IMF results in stronger outflows (larger $\eta$), which suppresses the overall star formation rate. However, it can simultaneously increase the equilibrium metallicity, as the dramatic increase in the metal yield $y$ can overcome the diluting effect of the stronger inflow required to fuel the outflows . This demonstrates the critical importance of the IMF as a fundamental assumption in [subgrid modeling](@entry_id:755600).

### Challenges and Practicalities: Resolution and Convergence

A major challenge in using [subgrid models](@entry_id:755601) is their inherent dependence on simulation resolution. The governing Euler-Poisson equations are formally scale-free, but the introduction of a grid and [subgrid models](@entry_id:755601) breaks this invariance. As a result, simply increasing the simulation resolution while keeping the subgrid parameters fixed does *not* typically lead to a converged solution for galaxy properties. This lack of **[strong convergence](@entry_id:139495)** arises for two primary reasons :

1.  **Changing Resolved Gas Structure:** As resolution increases, simulations can resolve denser gas structures and a wider range of turbulent fluctuations. This systematically alters the resolved gas density PDF, typically extending its tail to higher densities. For a star formation law sensitive to density (e.g., $\dot{\rho}_{\star} \propto \rho^{1.5}$), this change in the underlying gas distribution will cause the total star formation rate to increase with resolution if the efficiency parameter $\epsilon_{\mathrm{SF}}$ is held fixed.

2.  **Resolution-Dependent Feedback Coupling:** The effectiveness of [stellar feedback](@entry_id:755431) is also highly resolution-dependent. When supernova energy is injected into a grid cell, it must compete with [radiative cooling](@entry_id:754014). In a high-resolution simulation, star-forming regions are better resolved, meaning the feedback energy is deposited into smaller, denser cells. Since cooling rates often scale as $\rho^2$, this energy can be radiated away extremely quickly before it can do significant mechanical work, a numerical issue known as the "overcooling problem." At lower resolution, the same energy is deposited into a larger, lower-density cell, where cooling is less efficient, and the feedback can more effectively drive an outflow. Consequently, a fixed feedback coupling efficiency parameter results in a different *effective* feedback strength at different resolutions. Furthermore, at very high [mass resolution](@entry_id:197946), the discrete nature of the IMF becomes important; a low-mass star particle may or may not stochastically contain a massive star, making feedback bursty and unpredictable .

Given these challenges, the standard practice in the field is to aim for **[weak convergence](@entry_id:146650)**. This is the pragmatic approach of allowing subgrid parameters (like star formation efficiencies and feedback coupling efficiencies) to be functions of the simulation resolution. Parameters are carefully re-calibrated at each resolution level to ensure that key macroscopic, observable properties of the galaxy population (such as the galaxy stellar [mass function](@entry_id:158970) or the mass-metallicity relation) remain stable. This re-tuning acknowledges that [subgrid models](@entry_id:755601) are not perfect physical theories but are numerical tools that must be validated against the very physics they are designed to emulate, ensuring that simulation outcomes are robust and meaningful.