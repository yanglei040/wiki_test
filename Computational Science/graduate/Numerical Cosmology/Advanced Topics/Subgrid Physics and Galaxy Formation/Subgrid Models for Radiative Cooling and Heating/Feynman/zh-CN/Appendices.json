{
    "hands_on_practices": [
        {
            "introduction": "本练习将指导您计算气体单元的平衡温度 $T_\\mathrm{eq}$。通过建立光致加热和辐射冷却之间的基本平衡关系，您将接触到宇宙学气体动力学中的一个核心过程。这项练习  不仅能锻炼您的数值求根能力，还将揭示气体在光致电离平衡下的一个关键且非直观的特性。",
            "id": "3491059",
            "problem": "考虑一个处于光致电离平衡 (PIE) 状态下的光学薄、空间均匀的低密度星系际介质 (IGM) 气块。令总氢数密度为 $n$（单位为 $\\mathrm{cm}^{-3}$），中性氢数密度为 $n_\\mathrm{HI}$（单位为 $\\mathrm{cm}^{-3}$），电子数密度为 $n_e$（单位为 $\\mathrm{cm}^{-3}$），质子数密度为 $n_p$（单位为 $\\mathrm{cm}^{-3}$），金属丰度为 $Z$（表示为太阳金属丰度的分数）。假设电离平衡只考虑纯氢，并采用一个包含原初项和金属线项的简单次网格冷却参数化方案。\n\n基本的能量平衡要求单位体积冷却率等于单位体积加热率。从第一性原理出发，将单位体积的辐射冷却率设为等于单位体积的光致加热率。假设氢是电离平衡中唯一的电离物种，电子由氢电离提供，并且气体是光学薄的，因此每次电离都会沉积一个平均过剩能量。本问题的目标是计算满足能量平衡的平衡温度 $T_\\mathrm{eq}$（单位为 K），并讨论在 PIE 条件下它对 $n$ 的依赖关系。\n\n从以下基础出发：\n- 单位体积的辐射冷却率为 $n_e n_\\mathrm{H} \\Lambda(T,Z)$，其中 $n_\\mathrm{H}$ 是总氢数密度，$\\Lambda(T,Z)$（单位为 $\\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$）是冷却函数。\n- 单位体积的光致加热率为 $n_\\mathrm{HI} \\Gamma \\langle E \\rangle$，其中 $\\Gamma$（单位为 $\\mathrm{s}^{-1}$）是氢光致电离率，$\\langle E \\rangle$（单位为 $\\mathrm{erg}$）是每次光致电离沉积的平均过剩能量。\n- 光致电离平衡 (PIE) 给出 $\\Gamma n_\\mathrm{HI} = \\alpha_\\mathrm{A}(T)\\, n_e n_p$，其中 $\\alpha_\\mathrm{A}(T)$ 是 Case A 复合系数（单位为 $\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$）。\n\n使用这些基础，推导出一个关于 $T_\\mathrm{eq}$ 的自洽标量方程，并对其进行数值实现。为解决此问题，请采用以下科学上合理且广泛使用的参数化方案：\n- 氢的 Case A 复合系数：\n$$\n\\alpha_\\mathrm{A}(T) = 4.2\\times10^{-13}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{-0.7}\\ \\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}.\n$$\n- 一个由原初氢项和金属线项组成的次网格冷却函数：\n$$\n\\Lambda(T,Z) = \\Lambda_{0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{a} + Z\\, \\Lambda_{Z,0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{b},\n$$\n其中常数为 $\\Lambda_{0} = 1.2\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，$a = 0.3$，$\\Lambda_{Z,0} = 3.0\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，以及 $b = -0.2$。此处 $Z$ 是相对于太阳的无量纲金属丰度（例如，$Z=0.1$ 意味着太阳丰度的十分之一）。\n\n对于低密度、高度电离的 IGM，假设 $n_e \\approx n_p \\approx n_\\mathrm{H}$。推导平衡条件并数值求解 $T_\\mathrm{eq}$。\n\n你的程序必须：\n- 使用 $1\\,\\mathrm{eV} = 1.602176634\\times10^{-12}\\,\\mathrm{erg}$ 将光致加热的过剩能量 $\\langle E \\rangle$ 从电子伏特转换为尔格。\n- 通过在区间 $[3000\\,\\mathrm{K},\\,30000\\,\\mathrm{K}]$ 上寻找一个从能量平衡和 PIE 推导出的关于 $T$ 的标量函数的根，来求解 $T_\\mathrm{eq}$（单位为 K）。如果某个测试用例需要更宽的区间来寻找根，你可以将上界扩展至 $100000\\,\\mathrm{K}$。\n- 将每个计算出的平衡温度（单位为 K）表示为浮点数。\n\n在你的解法中，讨论在 PIE 条件下，推导过程所隐含的 $T_\\mathrm{eq}$ 对 $n$ 的依赖关系。\n\n测试套件：\n使用以下参数集 $(n, Z, \\Gamma, \\langle E \\rangle)$，其中 $n$ 的单位为 $\\mathrm{cm}^{-3}$，$Z$ 为无量纲（相对于太阳），$\\Gamma$ 的单位为 $\\mathrm{s}^{-1}$，$\\langle E \\rangle$ 的单位为 $\\mathrm{eV}$。\n1. $(10^{-5},\\ 0.0,\\ 10^{-12},\\ 2.0)$\n2. $(10^{-4},\\ 0.0,\\ 10^{-12},\\ 2.0)$\n3. $(10^{-5},\\ 0.1,\\ 10^{-12},\\ 2.0)$\n4. $(10^{-5},\\ 0.0,\\ 10^{-12},\\ 4.0)$\n5. $(10^{-7},\\ 0.0,\\ 10^{-13},\\ 2.0)$\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[T_1,T_2,T_3,T_4,T_5]$），其中每个 $T_i$ 是第 $i$ 个测试用例的平衡温度（单位为 K）。",
            "solution": "该问题要求推导并数值求解在光致电离平衡 (PIE) 条件下星系际介质 (IGM) 气块的平衡温度 $T_\\mathrm{eq}$。解法必须按照问题陈述中概述的那样从第一性原理推导得出。\n\n控制气体热状态的基本原理是能量平衡。在平衡状态下，总体积加热率 $\\mathcal{H}$（单位为 $\\mathrm{erg}\\,\\mathrm{s}^{-1}\\,\\mathrm{cm}^{-3}$）必须等于总体积冷却率 $\\mathcal{C}$（单位相同）。\n$$\n\\mathcal{H} = \\mathcal{C}\n$$\n问题给出了这些率的表达式。单位体积的光致加热率由下式给出：\n$$\n\\mathcal{H} = n_\\mathrm{HI} \\Gamma \\langle E \\rangle\n$$\n其中 $n_\\mathrm{HI}$ 是中性氢的数密度，$\\Gamma$ 是光致电离率，$\\langle E \\rangle$ 是每次光致电离沉积到气体中的平均过剩能量。\n\n单位体积的辐射冷却率由下式给出：\n$$\n\\mathcal{C} = n_e n_\\mathrm{H} \\Lambda(T,Z)\n$$\n其中 $n_e$ 是电子数密度，$n_\\mathrm{H}$ 是总氢数密度（我们将其表示为 $n$），$\\Lambda(T,Z)$ 是依赖于温度和金属丰度的冷却函数。\n\n将加热率和冷却率设为相等，得出热平衡方程：\n$$\nn_\\mathrm{HI} \\Gamma \\langle E \\rangle = n_e n \\Lambda(T_\\mathrm{eq}, Z)\n$$\n该方程包含多个密度项（$n_\\mathrm{HI}$、$n_e$、$n$）。为了简化它，我们必须引用所提供的第二个条件：光致电离平衡 (PIE)。PIE 规定了光致电离的速率等于复合的速率。对于纯氢气体，这表示为：\n$$\n\\Gamma n_\\mathrm{HI} = \\alpha_\\mathrm{A}(T) n_e n_p\n$$\n其中 $\\alpha_\\mathrm{A}(T)$ 是 Case A 复合系数，$n_p$ 是质子数密度。\n\n现在，我们可以将 PIE 方程中 $\\Gamma n_\\mathrm{HI}$ 的表达式代入热平衡方程。这是将电离状态与热状态联系起来的关键一步。\n$$\n\\left( \\alpha_\\mathrm{A}(T_\\mathrm{eq}) n_e n_p \\right) \\langle E \\rangle = n_e n \\Lambda(T_\\mathrm{eq}, Z)\n$$\n问题陈述指出，对于低密度、高度电离的 IGM，我们可以近似认为气体几乎完全电离。这意味着电子和质子密度约等于总氢密度：\n$$\nn_e \\approx n_p \\approx n_\\mathrm{H} = n\n$$\n将这些近似值代入方程，可得：\n$$\n\\alpha_\\mathrm{A}(T_\\mathrm{eq}) (n) (n) \\langle E \\rangle = (n) (n) \\Lambda(T_\\mathrm{eq}, Z)\n$$\n这可以简化为：\n$$\nn^2 \\alpha_\\mathrm{A}(T_\\mathrm{eq}) \\langle E \\rangle = n^2 \\Lambda(T_\\mathrm{eq}, Z)\n$$\n从这个推导中出现一个关键结果。方程两边都出现了 $n^2$ 因子，在 $n \\neq 0$ 的条件下可以消去。\n$$\n\\alpha_\\mathrm{A}(T_\\mathrm{eq}) \\langle E \\rangle = \\Lambda(T_\\mathrm{eq}, Z)\n$$\n这个最终方程定义了平衡温度 $T_\\mathrm{eq}$。它是一个关于单一变量 $T_\\mathrm{eq}$ 的标量方程。\n\n从这个结果中可以得出一个重要的物理洞见：**在光学薄介质中满足 PIE 的特定条件下，平衡温度 $T_\\mathrm{eq}$ 与气体密度 $n$ 无关**。这是因为主要的加热机制（光致加热）和主要的冷却机制（包括碰撞激发和复合冷却，两者都是双体过程）都与密度的平方（$n^2$）成正比，因为它们的速率取决于相互作用粒子的密度乘积（例如 $n_e n_p$）。当平衡这两个速率时，密度的依赖性就被消除了。因此，平衡温度完全由每次复合事件的能量输入（与来自电离辐射场的能量 $\\langle E \\rangle$ 相关）与单位“冷却系数”（也依赖于复合和碰撞，并概括在 $\\Lambda(T,Z)/\\alpha_A(T)$ 中）所辐射的能量之间的平衡所决定。\n\n为了数值求解 $T_\\mathrm{eq}$，我们定义一个函数 $f(T)$，其根即为平衡温度。\n$$\nf(T) = \\Lambda(T, Z) - \\alpha_\\mathrm{A}(T) \\langle E \\rangle = 0\n$$\n我们必须代入给定的 $\\Lambda(T, Z)$ 和 $\\alpha_\\mathrm{A}(T)$ 的参数化形式：\n$$\n\\Lambda(T,Z) = \\Lambda_{0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{a} + Z\\, \\Lambda_{Z,0}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{b}\n$$\n$$\n\\alpha_\\mathrm{A}(T) = 4.2\\times10^{-13}\\left(\\frac{T}{10^{4}\\,\\mathrm{K}}\\right)^{-0.7}\\ \\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}\n$$\n常数给定为 $\\Lambda_{0} = 1.2\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，$a = 0.3$，$\\Lambda_{Z,0} = 3.0\\times10^{-24}\\ \\mathrm{erg}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$，以及 $b = -0.2$。我们记 $T_0 = 10^4\\,\\mathrm{K}$ 和 $\\alpha_{A,0} = 4.2\\times10^{-13}\\,\\mathrm{cm}^{3}\\,\\mathrm{s}^{-1}$。用于求根算法的方程变为：\n$$\nf(T) = \\left[ \\Lambda_{0} \\left(\\frac{T}{T_0}\\right)^{a} + Z \\Lambda_{Z,0} \\left(\\frac{T}{T_0}\\right)^{b} \\right] - \\left[ \\alpha_{A,0} \\left(\\frac{T}{T_0}\\right)^{-0.7} \\right] \\langle E \\rangle_{\\mathrm{erg}} = 0\n$$\n能量 $\\langle E \\rangle$ 以电子伏特 ($\\mathrm{eV}$) 为单位给出，必须使用提供的转换因子 $1\\,\\mathrm{eV} = 1.602176634\\times10^{-12}\\,\\mathrm{erg}$ 将其转换为尔格。\n\n对于每个测试用例，将 $Z$ 和 $\\langle E \\rangle$ 的值代入该方程，然后在指定的温度区间 $[3000\\,\\mathrm{K}, 30000\\,\\mathrm{K}]$ 内对 $T = T_\\mathrm{eq}$ 进行数值求解。测试套件中的参数 $n$ 和 $\\Gamma$ 虽然对于定义物理情景至关重要，但并未进入求解 $T_\\mathrm{eq}$ 的最终代数方程，这再次证实了在这些假设下，平衡温度与密度和电离率无关的结论。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for the equilibrium temperature of an IGM parcel for multiple test cases.\n    \"\"\"\n    \n    # Define physical and numerical constants from the problem statement.\n    Lambda_0 = 1.2e-24  # erg cm^3 s^-1\n    a = 0.3             # dimensionless power-law index\n    Lambda_Z0 = 3.0e-24 # erg cm^3 s^-1\n    b = -0.2            # dimensionless power-law index\n    alpha_A0 = 4.2e-13  # cm^3 s^-1\n    alpha_power = -0.7  # dimensionless power-law index for recombination\n    T0 = 1.0e4          # K, reference temperature\n    eV_to_erg = 1.602176634e-12 # erg/eV\n\n    # Define the search interval for the root finder.\n    T_min = 3000.0  # K\n    T_max_extended = 100000.0 # K\n    \n    # Test cases parameters: (n_H [cm^-3], Z [solar], Gamma [s^-1], E_mean [eV])\n    # Note: n_H and Gamma are not used in the final equation for T_eq,\n    # as they cancel out under the assumption of photoionization equilibrium.\n    test_cases = [\n        (1e-5, 0.0, 1e-12, 2.0),\n        (1e-4, 0.0, 1e-12, 2.0),\n        (1e-5, 0.1, 1e-12, 2.0),\n        (1e-5, 0.0, 1e-12, 4.0),\n        (1e-7, 0.0, 1e-13, 2.0),\n    ]\n\n    def equilibrium_function(T, Z, E_erg):\n        \"\"\"\n        The scalar function f(T) = Lambda(T, Z) - alpha_A(T) * E_erg, whose root is T_eq.\n        T is in Kelvin, Z is dimensionless, E_erg is in ergs.\n        \"\"\"\n        T_ratio = T / T0\n        \n        # Cooling function Lambda(T, Z)\n        lambda_val = Lambda_0 * (T_ratio**a) + Z * Lambda_Z0 * (T_ratio**b)\n        \n        # Recombination coefficient alpha_A(T)\n        alpha_val = alpha_A0 * (T_ratio**alpha_power)\n        \n        # This term represents the heating associated with recombination in the PIE context\n        heating_term = alpha_val * E_erg\n        \n        return lambda_val - heating_term\n\n    results = []\n    for _, Z, _, E_eV in test_cases:\n        E_erg = E_eV * eV_to_erg\n        try:\n            # Use the wider range to be robust as suggested.\n            T_eq = optimize.brentq(equilibrium_function, T_min, T_max_extended, args=(Z, E_erg))\n            results.append(T_eq)\n        except ValueError:\n            # Fallback if root not in bracket, though unlikely for this problem.\n            results.append(float('nan'))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了在计算上可行，次网格模型通常依赖于各种简化。本练习  旨在探讨其中一种常见简化——光致加热的“灰体”（grey）近似——并将其与精确的多频计算进行比较。通过解决这个问题，您将对建模选择（如此处的入射辐射谱）如何影响气体的热演化获得定量的理解。",
            "id": "3491114",
            "problem": "在暴露于电离辐射的光学薄的中性氢介质中，每个氢原子的净光致加热率可以通过计算光子吸收事件和每次事件沉积的过剩能量，从第一性原理计算得出。设单位频率的光子数通量用 $F_{\\nu}$ 表示，单位为 $\\mathrm{s^{-1}\\,m^{-2}\\,Hz^{-1}}$，氢光致电离截面为 $\\sigma_{\\mathrm{HI}}(\\nu)$。对于中性氢，一个广泛使用且经过充分检验的近似是，当 $\\nu \\ge \\nu_{0}$ 时 $\\sigma_{\\mathrm{HI}}(\\nu) = \\sigma_{0}\\,(\\nu/\\nu_{0})^{-3}$，当 $\\nu  \\nu_{0}$ 时 $\\sigma_{\\mathrm{HI}}(\\nu) = 0$，其中 $\\nu_{0}$ 是对应于 $13.6\\,\\mathrm{eV}$ 的阈值频率，且 $\\sigma_{0} = 6.3\\times 10^{-22}\\,\\mathrm{m^{2}}$。普朗克常数为 $h = 6.62607015\\times 10^{-34}\\,\\mathrm{J\\,s}$，电子伏特到焦耳的转换关系为 $1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$。在国际单位制 (SI) 中，精确的、多频率的每个氢原子的净光致加热率（单位为焦耳每秒每原子）由下式给出：\n$$\n\\mathcal{H}_{\\mathrm{true}} \\;=\\; \\int_{\\nu_{0}}^{\\infty} F_{\\nu}\\,\\sigma_{\\mathrm{HI}}(\\nu)\\,\\bigl(h\\nu - h\\nu_{0}\\bigr)\\,d\\nu.\n$$\n一种常用的单组（“灰体”）次网格模型则将辐射场压缩为单个代表性频率和截面。在本问题中，将灰体模型定义如下：用其总光子数通量\n$$\n\\dot{N} \\;=\\; \\int_{\\nu_{0}}^{\\infty} F_{\\nu}\\,d\\nu,\n$$\n光子数加权平均频率\n$$\n\\bar{\\nu} \\;=\\; \\frac{1}{\\dot{N}}\\int_{\\nu_{0}}^{\\infty} \\nu\\,F_{\\nu}\\,d\\nu,\n$$\n来表征辐射场，并用其阈值 $\\sigma_{0}$ 来近似截面。由此得到的每个氢原子的灰体加热率为\n$$\n\\mathcal{H}_{\\mathrm{grey}} \\;=\\; \\dot{N}\\,\\sigma_{0}\\,\\bigl(h\\bar{\\nu} - h\\nu_{0}\\bigr).\n$$\n你需要比较 $\\mathcal{H}_{\\mathrm{grey}}$ 与 $\\mathcal{H}_{\\mathrm{true}}$，针对两类在阈值以上具有相同总光子通量 $\\dot{N}$ 的玩具能谱：\n- 光子能量为 $E_{\\mathrm{mono}}$（严格高于阈值）的单色谱，可以表示为 $F_{\\nu} = \\dot{N}\\,\\delta(\\nu - \\nu_{\\mathrm{mono}})$，其中 $\\nu_{\\mathrm{mono}} = E_{\\mathrm{mono}}/h$。\n- 在 $\\nu_{0}$ 和上限截止频率 $\\nu_{\\max}$ 之间的幂律谱 $F_{\\nu} \\propto \\nu^{-\\alpha}$，归一化到相同的 $\\dot{N}$。\n\n仅从上述定义和给定的物理常数出发，实现一个程序来计算无量纲的分数差\n$$\n\\delta \\;=\\; \\frac{\\mathcal{H}_{\\mathrm{grey}} - \\mathcal{H}_{\\mathrm{true}}}{\\mathcal{H}_{\\mathrm{true}}}\n$$\n针对以下测试套件（所有情况都使用相同的总光子通量 $\\dot{N} = 10^{10}\\,\\mathrm{s^{-1}\\,m^{-2}}$）：\n- 情况 A（单色谱）：$E_{\\mathrm{mono}} = 20.0\\,\\mathrm{eV}$。\n- 情况 B（幂律谱）：$\\alpha = 1.5$, $E_{\\max} = 54.4\\,\\mathrm{eV}$。\n- 情况 C（幂律谱）：$\\alpha = 0.5$, $E_{\\max} = 136.0\\,\\mathrm{eV}$。\n- 情况 D（单色谱）：$E_{\\mathrm{mono}} = 13.7\\,\\mathrm{eV}$。\n\n所有中间物理量都必须以国际单位制（SI）处理。特别是，内部应以每个原子 $\\mathrm{J\\,s^{-1}}$ 为单位表示加热率，但最终要求的输出是每种情况下无量纲的分数差 $\\delta$，并按所列顺序排列。您的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，$[x,y,z,w]$）。",
            "solution": "该问题已经过验证，被认为是科学上合理的、适定的、完整的和可形式化的。所有提供的常数和模型都是天体物理学和辐射转移领域内的标准。问题陈述中没有矛盾或含糊不清之处。因此，我们可以进行完整求解。\n\n目标是计算简化的“灰体”光致加热模型与精确的多频率计算之间的无量纲分数差 $\\delta = (\\mathcal{H}_{\\mathrm{grey}} - \\mathcal{H}_{\\mathrm{true}}) / \\mathcal{H}_{\\mathrm{true}}$，针对两种类型的入射辐射谱。我们将首先为每种能谱类型推导 $\\mathcal{H}_{\\mathrm{true}}$ 和 $\\mathcal{H}_{\\mathrm{grey}}$ 的解析表达式。所有计算都将按规定以国际单位制（SI）进行。\n\n让我们首先定义物理常数以及氢的阈值电离能 $E_{0}$ 和频率 $\\nu_{0}$：\n- 普朗克常数：$h = 6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}$\n- 电子伏特到焦耳的转换关系：$1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$\n- 阈值能量：$E_{0} = 13.6\\,\\mathrm{eV} = 13.6 \\times 1.602176634 \\times 10^{-19}\\,\\mathrm{J} \\approx 2.17895... \\times 10^{-18}\\,\\mathrm{J}$\n- 阈值频率：$\\nu_{0} = E_{0}/h \\approx 3.28805... \\times 10^{15}\\,\\mathrm{Hz}$\n- 阈值处的截面：$\\sigma_{0} = 6.3 \\times 10^{-22}\\,\\mathrm{m^2}$\n\n为方便起见，我们将以光子能量 $E=h\\nu$ 作为自变量。单位能量的光谱光子数通量 $F_E$ 与单位频率的通量 $F_\\nu$ 的关系为 $F_E(E) dE = F_\\nu(\\nu) d\\nu$。由于 $dE = h\\,d\\nu$，我们有 $F_E(E) = F_\\nu(\\nu)/h$。作为能量函数的光致电离截面为，当 $E \\ge E_{0}$ 时，$\\sigma_{\\mathrm{HI}}(E) = \\sigma_{0}(E/E_{0})^{-3}$。\n\n每个原子的真实加热率为：\n$$\n\\mathcal{H}_{\\mathrm{true}} = \\int_{E_{0}}^{\\infty} F_E(E)\\,\\sigma_{\\mathrm{HI}}(E)\\,(E - E_{0})\\,dE = \\sigma_{0} \\int_{E_{0}}^{\\infty} F_E(E)\\,(E/E_{0})^{-3}\\,(E - E_{0})\\,dE\n$$\n灰体加热率定义为 $\\mathcal{H}_{\\mathrm{grey}} = \\dot{N}\\,\\sigma_{0}\\,(h\\bar{\\nu} - h\\nu_{0}) = \\dot{N}\\,\\sigma_{0}\\,(\\bar{E} - E_{0})$，其中 $\\dot{N} = \\int_{E_{0}}^{\\infty} F_E(E)\\,dE$ 是总光子数通量，$\\bar{E} = \\frac{1}{\\dot{N}}\\int_{E_{0}}^{\\infty} E\\,F_E(E)\\,dE$ 是平均光子能量。\n一个关键的洞见是，灰体加热率的表达式可以改写为：\n$$\n\\mathcal{H}_{\\mathrm{grey}} = \\left(\\int_{E_{0}}^{\\infty} F_E(E)\\,dE\\right)\\,\\sigma_{0}\\,\\left(\\frac{\\int_{E_{0}}^{\\infty} E\\,F_E(E)\\,dE}{\\int_{E_{0}}^{\\infty} F_E(E)\\,dE} - E_{0}\\right)\n= \\sigma_{0} \\left( \\int_{E_{0}}^{\\infty} E\\,F_E(E)\\,dE - E_{0} \\int_{E_{0}}^{\\infty} F_E(E)\\,dE \\right)\n$$\n$$\n\\mathcal{H}_{\\mathrm{grey}} = \\sigma_{0} \\int_{E_{0}}^{\\infty} F_E(E)\\,(E - E_{0})\\,dE\n$$\n这种重新表述巧妙地阐明了两种模型之间的物理差异：$\\mathcal{H}_{\\mathrm{true}}$ 在积分内部包含了依赖于能量的截面因子 $(E/E_{0})^{-3}$，而 $\\mathcal{H}_{\\mathrm{grey}}$ 实际上将此因子近似为1。由于对于所有相关能量 $E \\ge E_{0}$，都有 $(E/E_{0})^{-3} \\le 1$，我们可以立即推断出 $\\mathcal{H}_{\\mathrm{true}} \\le \\mathcal{H}_{\\mathrm{grey}}$，这意味着 $\\delta \\ge 0$。\n\n现在我们来分析每种能谱类型。\n\n**1. 单色谱**\n能谱由 $F_{\\nu} = \\dot{N}\\,\\delta(\\nu - \\nu_{\\mathrm{mono}})$ 给出，其中 $\\delta(\\cdot)$ 是 Dirac δ函数。用能量表示，即为 $F_E(E) = \\dot{N}\\,\\delta(E - E_{\\mathrm{mono}})$，且 $E_{\\mathrm{mono}} > E_{0}$。\n利用δ函数的筛选性质 $\\int g(x)\\delta(x-a)dx = g(a)$：\n\n$$\n\\mathcal{H}_{\\mathrm{true}} = \\sigma_{0} \\int_{E_{0}}^{\\infty} \\dot{N}\\,\\delta(E - E_{\\mathrm{mono}})\\,(E/E_{0})^{-3}\\,(E - E_{0})\\,dE = \\dot{N}\\,\\sigma_{0}\\,(E_{\\mathrm{mono}}/E_{0})^{-3}\\,(E_{\\mathrm{mono}} - E_{0})\n$$\n$$\n\\mathcal{H}_{\\mathrm{grey}} = \\sigma_{0} \\int_{E_{0}}^{\\infty} \\dot{N}\\,\\delta(E - E_{\\mathrm{mono}})\\,(E - E_{0})\\,dE = \\dot{N}\\,\\sigma_{0}\\,(E_{\\mathrm{mono}} - E_{0})\n$$\n分数差为：\n$$\n\\delta = \\frac{\\mathcal{H}_{\\mathrm{grey}} - \\mathcal{H}_{\\mathrm{true}}}{\\mathcal{H}_{\\mathrm{true}}} = \\frac{\\mathcal{H}_{\\mathrm{grey}}}{\\mathcal{H}_{\\mathrm{true}}} - 1 = \\frac{\\dot{N}\\,\\sigma_{0}\\,(E_{\\mathrm{mono}} - E_{0})}{\\dot{N}\\,\\sigma_{0}\\,(E_{\\mathrm{mono}}/E_{0})^{-3}\\,(E_{\\mathrm{mono}} - E_{0})} - 1 = \\frac{1}{(E_{\\mathrm{mono}}/E_{0})^{-3}} - 1\n$$\n$$\n\\delta = \\left(\\frac{E_{\\mathrm{mono}}}{E_{0}}\\right)^{3} - 1\n$$\n注意，结果与 $\\dot{N}$ 和 $\\sigma_{0}$ 无关。\n\n**2. 幂律谱**\n能谱在 $\\nu_0 \\le \\nu \\le \\nu_{\\max}$ 范围内为 $F_{\\nu} \\propto \\nu^{-\\alpha}$，这对应于在 $E_0 \\le E \\le E_{\\max}$ 范围内 $F_E(E) \\propto E^{-\\alpha}$。设 $F_E(E) = K E^{-\\alpha}$。\n常数 $K$ 由归一化到总光子通量 $\\dot{N}$ 来确定，但正如我们发现的，$\\mathcal{H}_{\\mathrm{true}}$ 和 $\\mathcal{H}_{\\mathrm{grey}}$ 都与此归一化成正比。因此，该常数将在比率 $\\delta$ 中被消去。\n让我们引入无量纲能量 $x = E/E_{0}$，其截止值为 $x_{\\max} = E_{\\max}/E_{0}$。那么 $dE = E_{0}\\,dx$。\n\n$$\n\\mathcal{H}_{\\mathrm{true}} = \\sigma_{0} \\int_{E_{0}}^{E_{\\max}} K E^{-\\alpha}\\, (E/E_{0})^{-3}\\, (E - E_{0})\\,dE = K \\sigma_{0} E_{0}^{1-\\alpha} \\int_{1}^{x_{\\max}} x^{-\\alpha}\\,x^{-3}\\,(E_{0}x - E_{0})\\,dx\n$$\n$$\n\\mathcal{H}_{\\mathrm{true}} \\propto \\int_{1}^{x_{\\max}} (x-1)x^{-\\alpha-3}\\,dx = \\int_{1}^{x_{\\max}} (x^{-\\alpha-2} - x^{-\\alpha-3})\\,dx\n$$\n\n$$\n\\mathcal{H}_{\\mathrm{grey}} = \\sigma_{0} \\int_{E_{0}}^{E_{\\max}} K E^{-\\alpha}\\,(E-E_{0})\\,dE = K \\sigma_{0} E_{0}^{1-\\alpha} \\int_{1}^{x_{\\max}} x^{-\\alpha}\\,(E_{0}x - E_{0})\\,dx\n$$\n$$\n\\mathcal{H}_{\\mathrm{grey}} \\propto \\int_{1}^{x_{\\max}} (x-1)x^{-\\alpha}\\,dx = \\int_{1}^{x_{\\max}} (x^{1-\\alpha} - x^{-\\alpha})\\,dx\n$$\n分数差是这两个定积分之比减一：\n$$\n\\delta = \\frac{\\int_{1}^{x_{\\max}} (x^{1-\\alpha} - x^{-\\alpha})\\,dx}{\\int_{1}^{x_{\\max}} (x^{-\\alpha-2} - x^{-\\alpha-3})\\,dx} - 1\n$$\n对于 $\\alpha \\neq 1, 2$ 和 $\\alpha \\neq -1, -2$ (这对于给定的情况 $\\alpha=1.5, 0.5$ 成立)，这些积分是容易求解的。\n我们来计算分子积分 $I_{\\mathrm{grey}}$：\n$$\nI_{\\mathrm{grey}}(x_{\\max}, \\alpha) = \\left[\\frac{x^{2-\\alpha}}{2-\\alpha} - \\frac{x^{1-\\alpha}}{1-\\alpha}\\right]_{1}^{x_{\\max}} = \\left(\\frac{x_{\\max}^{2-\\alpha}-1}{2-\\alpha}\\right) - \\left(\\frac{x_{\\max}^{1-\\alpha}-1}{1-\\alpha}\\right)\n$$\n以及分母积分 $I_{\\mathrm{true}}$：\n$$\nI_{\\mathrm{true}}(x_{\\max}, \\alpha) = \\left[\\frac{x^{-\\alpha-1}}{-\\alpha-1} - \\frac{x^{-\\alpha-2}}{-\\alpha-2}\\right]_{1}^{x_{\\max}} = \\left(\\frac{1-x_{\\max}^{-\\alpha-1}}{\\alpha+1}\\right) - \\left(\\frac{1-x_{\\max}^{-\\alpha-2}}{\\alpha+2}\\right)\n$$\n对于幂律谱情况的最终公式是 $\\delta = I_{\\mathrm{grey}}/I_{\\mathrm{true}} - 1$。\n\n下面的程序实现了这些推导出的解析公式，用于计算四个测试用例中每一个的 $\\delta$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fractional difference between grey and true photoheating rates\n    for a suite of test cases.\n    \"\"\"\n    # Define physical constants in SI units\n    h_planck = 6.62607015e-34  # J s\n    eV_to_J = 1.602176634e-19  # J/eV\n    sigma0_HI = 6.3e-22        # m^2\n\n    # Ionization threshold for Hydrogen\n    E0_eV = 13.6\n    E0_J = E0_eV * eV_to_J\n\n    # Define the test cases from the problem statement\n    # Format: (case_type, params_dict)\n    # Monochromatic case: {'E_mono_eV': float}\n    # Power-law case: {'alpha': float, 'E_max_eV': float}\n    test_cases = [\n        ('monochromatic', {'E_mono_eV': 20.0}),        # Case A\n        ('power_law',     {'alpha': 1.5, 'E_max_eV': 54.4}),   # Case B\n        ('power_law',     {'alpha': 0.5, 'E_max_eV': 136.0}),  # Case C\n        ('monochromatic', {'E_mono_eV': 13.7}),        # Case D\n    ]\n\n    results = []\n    for case_type, params in test_cases:\n        if case_type == 'monochromatic':\n            E_mono_eV = params['E_mono_eV']\n            \n            # The fractional difference delta is given by (E_mono/E_0)^3 - 1.\n            # We can use energies in eV as it is a dimensionless ratio.\n            x_mono = E_mono_eV / E0_eV\n            \n            # Since E_mono > E_0, (E_mono - E_0) is non-zero and cancels.\n            delta = x_mono**3 - 1.0\n            \n            results.append(delta)\n\n        elif case_type == 'power_law':\n            alpha = params['alpha']\n            E_max_eV = params['E_max_eV']\n            \n            # The calculation is based on the ratio of two definite integrals\n            # involving the dimensionless energy x = E/E_0.\n            x_max = E_max_eV / E0_eV\n            \n            # Numerator integral for H_grey: integral[(x^(1-alpha) - x^(-alpha))]dx from 1 to x_max\n            # This is valid for alpha != 1, 2\n            term1_grey = (x_max**(2.0 - alpha) - 1.0) / (2.0 - alpha)\n            term2_grey = (x_max**(1.0 - alpha) - 1.0) / (1.0 - alpha)\n            integral_grey = term1_grey - term2_grey\n            \n            # Denominator integral for H_true: integral[(x^(-alpha-2) - x^(-alpha-3))]dx from 1 to x_max\n            # This is valid for alpha != -1, -2\n            term1_true = (1.0 - x_max**(-alpha - 1.0)) / (alpha + 1.0)\n            term2_true = (1.0 - x_max**(-alpha - 2.0)) / (alpha + 2.0)\n            integral_true = term1_true - term2_true\n            \n            # delta = (H_grey / H_true) - 1\n            if integral_true == 0:\n                # This would happen only in a trivial case where E_max = E_0,\n                # which is not the case here.\n                delta = np.inf if integral_grey > 0 else 0\n            else:\n                delta = integral_grey / integral_true - 1.0\n\n            results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在数值上耦合不同的物理过程时，细节至关重要。本练习  揭示了一个因热力学量更新不一致而可能产生的细微但关键的误差来源。通过解析推导温度误差 $\\Delta T$，您将深刻体会到在算法设计中确保状态方程与气体化学状态协同更新的重要性。",
            "id": "3491083",
            "problem": "考虑一个宇宙学流体动力学模拟中的单个计算单元，其子网格模型在一个时长为 $\\Delta t$ 的算符分裂子步中推进辐射冷却、加热和原初氢化学过程。气体是纯氢，其质量密度为 $\\rho$，绝热指数为 $\\gamma$，并遵循理想气体状态方程 (EOS)。设 $m_p$ 为质子质量，$k_B$ 为玻尔兹曼常数。热状态由比内能 $u$（单位质量的能量）表示，电离状态由氢电离分数 $x$ 表示，$x$ 定义为电离氢数密度与总氢数密度之比。以 $m_p$ 为单位的平均分子量为 $\\mu(x)$。\n\n在子步开始时 $(t^n)$，状态为 $(u^n, x^n)$。子网格模型执行一个算符分裂显式更新，其中：\n- 比内能使用在步长开始时计算的净比加热/冷却率 $\\dot{u}^n$ 进行推进，因此 $u^{n+1} = u^n + \\Delta t\\, \\dot{u}^n$。\n- 电离分数通过前向欧拉法推进，使用光致电离率 $\\Gamma$（每个原子）和B类复合系数 $\\alpha_B$（假设在步长内为常数），氢数密度为 $n_H = \\rho/m_p$，根据以下公式：\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right].\n$$\n\n假设理想气体状态方程中内能 $u$ 和温度 $T$ 的关系为\n$$\nu = \\frac{k_B}{(\\gamma - 1)\\, \\mu\\, m_p}\\, T,\n$$\n其中纯氢的 $\\mu(x)$ 由下式给出\n$$\n\\mu(x) = \\frac{1}{1 + x}.\n$$\n\n在推进 $(u, x)$ 后，考虑两种可能的方法来获得 $t^{n+1}$ 时的温度：\n- 一种朴素转换，使用旧的平均分子量 $\\mu^n \\equiv \\mu(x^n)$：\n$$\nT_{\\mathrm{naive}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1}.\n$$\n- 一致性转换，使用更新后的平均分子量 $\\mu^{n+1} \\equiv \\mu(x^{n+1})$：\n$$\nT_{\\mathrm{cons}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}.\n$$\n\n定义由朴素方法引入的温度误差为 $\\Delta T \\equiv T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}$。从上面给出的基本定义和定律出发，不使用任何未引入的快捷公式，推导这个单子步后 $\\Delta T$ 的精确闭式解析表达式，该表达式仅用符号 $\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$ 表示。将您的最终结果表示为单个简化的代数表达式。量 $\\Delta T$ 应以开尔文为单位解释，但不要在最终的方框表达式中包含单位。无需进行数值计算。",
            "solution": "该问题已被验证为具有科学依据、问题明确且客观。它基于数值宇宙学和天体物理学中使用的标准（尽管是简化的）方程。所有必要信息均已提供，任务是进行直接的形式推导。因此，我们可以开始解答。\n\n目标是在单个子网格子步后，为温度误差 $\\Delta T \\equiv T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}$ 推导一个精确的闭式解析表达式。最终表达式必须用给定的基本量表示：$\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$。\n\n我们从温度误差 $\\Delta T$ 的定义开始：\n$$\n\\Delta T = T_{\\mathrm{naive}}^{n+1} - T_{\\mathrm{cons}}^{n+1}\n$$\n问题给出了在时间 $t^{n+1}$ 时朴素计算和一致性计算的温度表达式：\n$$\nT_{\\mathrm{naive}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1}\n$$\n$$\nT_{\\mathrm{cons}}^{n+1} = \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}\n$$\n其中 $\\mu^n \\equiv \\mu(x^n)$ 且 $\\mu^{n+1} \\equiv \\mu(x^{n+1})$。\n\n将这些表达式代入 $\\Delta T$ 的定义，得到：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, \\mu^n\\, m_p}{k_B}\\, u^{n+1} - \\frac{(\\gamma - 1)\\, \\mu^{n+1}\\, m_p}{k_B}\\, u^{n+1}\n$$\n我们可以提取公因式来简化此表达式：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B}\\, u^{n+1} \\left( \\mu^n - \\mu^{n+1} \\right)\n$$\n接下来，我们使用所给的定义 $\\mu(x) = \\frac{1}{1 + x}$ 来表示平均分子量的差值 $\\mu^n - \\mu^{n+1}$：\n$$\n\\mu^n - \\mu^{n+1} = \\frac{1}{1 + x^n} - \\frac{1}{1 + x^{n+1}}\n$$\n将各项通分：\n$$\n\\mu^n - \\mu^{n+1} = \\frac{(1 + x^{n+1}) - (1 + x^n)}{(1 + x^n)(1 + x^{n+1})} = \\frac{x^{n+1} - x^n}{(1 + x^n)(1 + x^{n+1})}\n$$\n现在，我们将此结果代回我们的 $\\Delta T$ 表达式中：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B}\\, u^{n+1} \\left( \\frac{x^{n+1} - x^n}{(1 + x^n)(1 + x^{n+1})} \\right)\n$$\n为了使该表达式能用时间 $t^n$ 时的量显式表示，我们必须代入给定的更新方案。比内能 $u$ 按如下方式推进：\n$$\nu^{n+1} = u^n + \\Delta t\\, \\dot{u}^n\n$$\n电离分数 $x$ 按如下方式推进：\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right]\n$$\n由此，子步内电离分数的变化为：\n$$\nx^{n+1} - x^n = \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, n_H\\, \\left(x^n\\right)^2 \\right]\n$$\n问题陈述总氢数密度为 $n_H = \\rho/m_p$。将此代入 $x^{n+1}$ 和 $x^{n+1}-x^n$ 的表达式中：\n$$\nx^{n+1} - x^n = \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\n$$\n因此，\n$$\nx^{n+1} = x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\n$$\n我们现在有了写出 $\\Delta T$ 最终表达式所需的所有部分。我们将 $u^{n+1}$、$x^{n+1} - x^n$ 和 $x^{n+1}$ 的表达式代入我们的 $\\Delta T$ 方程中：\n$$\n\\Delta T = \\frac{(\\gamma - 1)\\, m_p}{k_B} (u^n + \\Delta t\\, \\dot{u}^n) \\frac{\\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]}{(1 + x^n)\\left(1 + x^n + \\Delta t\\left[ \\Gamma\\left(1 - x^n\\right) - \\alpha_B\\, \\frac{\\rho}{m_p}\\, \\left(x^n\\right)^2 \\right]\\right)}\n$$\n该表达式是一个单一的代数分式，并且完全由允许的符号 $\\rho$、$\\gamma$、$m_p$、$k_B$、$u^n$、$\\dot{u}^n$、$\\Delta t$、$x^n$、$\\Gamma$ 和 $\\alpha_B$ 表示。这就是温度误差的最终、精确、闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{(\\gamma - 1) m_p \\Delta t (u^n + \\Delta t \\dot{u}^n) \\left[ \\Gamma(1 - x^n) - \\alpha_B \\frac{\\rho}{m_p} (x^n)^2 \\right]}{k_B (1 + x^n) \\left( 1 + x^n + \\Delta t \\left[ \\Gamma(1 - x^n) - \\alpha_B \\frac{\\rho}{m_p} (x^n)^2 \\right] \\right)}}\n$$"
        }
    ]
}