## Introduction
Radiative cooling and heating are fundamental processes that govern the thermal state of cosmic gas, dictating the lifecycle of baryons from the diffuse [intergalactic medium](@entry_id:157642) to the dense cores of star-forming galaxies. However, a profound disconnect exists between the microscopic scales of these [atomic interactions](@entry_id:161336) and the macroscopic scales resolved by cosmological hydrodynamical simulations. Attempting to model this physics directly leads to computationally intractable problems and physically incorrect results, such as the infamous "overcooling problem" where galaxies form with excessive mass. Subgrid models provide the essential theoretical and numerical bridge across this scale divide, encapsulating the effects of unresolved physics in a computationally feasible framework.

This article provides a comprehensive overview of the theory, application, and practice of [subgrid models](@entry_id:755601) for [radiative cooling](@entry_id:754014) and heating. We begin our journey in the **"Principles and Mechanisms"** chapter, where we will delve into the fundamental microphysics of radiative processes, establish the numerical challenges of stiffness and unresolved scales they create, and introduce the key subgrid techniques developed to overcome them. Next, the **"Applications and Interdisciplinary Connections"** chapter will showcase how these models are deployed to answer critical questions in astrophysics, from regulating the multiphase structure of the interstellar medium to modeling feedback from supernovae and [active galactic nuclei](@entry_id:158029). Finally, the **"Hands-On Practices"** section provides a set of targeted problems designed to solidify your understanding of the core concepts, from calculating equilibrium temperatures to implementing [numerical interpolation](@entry_id:166640) schemes for cooling functions.

## Principles and Mechanisms

In this chapter, we transition from the high-level introduction to a detailed examination of the physical principles and numerical mechanisms that govern [radiative cooling](@entry_id:754014) and heating in [cosmological simulations](@entry_id:747925). Our goal is to build a foundational understanding of *why* [subgrid models](@entry_id:755601) are not merely a convenience but a necessity, and *how* they are constructed to represent crucial unresolved physics. We will begin with the microphysics of radiative processes, establish how they determine the [thermodynamic state](@entry_id:200783) of cosmic gas, and then confront the profound challenges that arise when these processes are implemented in numerical codes with finite resolution.

### The Microphysics of Radiative Cooling

The thermal energy of [astrophysical plasmas](@entry_id:267820) is depleted by the emission of photons that subsequently escape the system. In the optically thin limit, which is an excellent approximation for a vast range of cosmological environments, the rate of energy loss is simply the total power radiated per unit volume. This quantity is known as the **volumetric [radiative cooling](@entry_id:754014) rate**, denoted by $\mathcal{L}$.

From first principles, radiative processes such as [line emission](@entry_id:161645) following [collisional excitation](@entry_id:159854), [free-free emission](@entry_id:270512) ([bremsstrahlung](@entry_id:157865)), and free-bound emission (recombination) are fundamentally two-body interactions, primarily involving electrons colliding with ions. The rate of such interactions per unit volume naturally scales with the product of the number densities of the interacting species. By convention in astrophysics, this dependence is factored out, leading to the fundamental expression for the cooling rate :

$$
\mathcal{L} = n_e n_{\mathrm{H}} \Lambda(T, Z, x_i)
$$

Here, $n_e$ is the [number density](@entry_id:268986) of free electrons and $n_{\mathrm{H}}$ is the number density of hydrogen nuclei (protons and neutral atoms), which serves as a convenient normalization. The term $\Lambda(T, Z, x_i)$ is the **cooling function**. It encapsulates all the complex microphysics of emission and depends on the gas temperature $T$, its chemical composition (specifically the **metallicity** $Z$, the mass fraction of elements heavier than helium), and the **[ionization](@entry_id:136315) fractions** $x_i$ of all relevant atomic species. The units of $\mathcal{L}$ are energy per unit volume per unit time (e.g., $\mathrm{erg}\,\mathrm{s}^{-1}\,\mathrm{cm}^{-3}$), which implies that the units of $\Lambda$ are $\mathrm{erg}\,\mathrm{cm}^{3}\,\mathrm{s}^{-1}$. It is crucial to distinguish $\mathcal{L}$ from the spectral [emissivity](@entry_id:143288) $j_\nu$, which is the power emitted per unit volume, per unit frequency, per unit [solid angle](@entry_id:154756). The total cooling rate is the integral of the [emissivity](@entry_id:143288) over all frequencies and solid angles: $\mathcal{L} = 4\pi \int_0^\infty j_\nu \,\mathrm{d}\nu$.

The temperature and metallicity dependence of the cooling function $\Lambda(T,Z)$ is the engine of astrophysical gas thermodynamics. In a primordial gas composed only of hydrogen and helium, cooling is relatively inefficient. Above $T \approx 10^4\,\mathrm{K}$, hydrogen and helium become highly ionized, stripping them of the bound electrons needed for the most efficient cooling mechanism: **[line cooling](@entry_id:157856)**. Line cooling occurs when a collisional electron excites a bound electron in an ion to a higher energy level, followed by the spontaneous [radiative decay](@entry_id:159878) of that electron, emitting a photon that escapes. Once H and He are fully ionized, the much weaker processes of [bremsstrahlung](@entry_id:157865) and recombination radiation dominate.

The situation changes dramatically with the introduction of metals. Even a small amount of enrichment, such as a metallicity of $Z = 0.1 Z_\odot$ (one-tenth of the solar value), can increase the cooling rate by orders of magnitude in the temperature range $T \sim 10^4 - 10^7\,\mathrm{K}$ . The reason is that ions of elements like carbon, oxygen, and iron are not fully stripped of their electrons in this temperature range. They possess a rich and [complex structure](@entry_id:269128) of energy levels. Crucially, many of these levels have [excitation energies](@entry_id:190368) $\Delta E$ that are comparable to the mean thermal energy of the colliding electrons, $k_B T$. This makes [collisional excitation](@entry_id:159854) extremely effective. The subsequent radiative cascade emits numerous photons, efficiently draining thermal energy from the gas. The overall cooling function $\Lambda(T,Z)$ is the sum of contributions from all available transitions in all ions, and its value is dominated by metal [line cooling](@entry_id:157856) wherever metals are present and the temperature is conducive.

### Determining the Ionization and Thermal State

The cooling rate is critically sensitive to which ions are present in the gas, which is determined by the balance between ionization and recombination. The state of the gas is therefore set by the interplay of atomic processes and the [radiation field](@entry_id:164265). Two idealized limiting cases are fundamental to understanding this balance: Collisional Ionization Equilibrium and Photoionization Equilibrium .

In a hot, dense plasma shielded from external radiation, the dominant process is **collisional [ionization](@entry_id:136315)**, where thermal electrons have sufficient energy to knock bound electrons out of atoms and ions. This is balanced by recombination, where ions recapture free electrons. In a steady state, known as **Collisional Ionization Equilibrium (CIE)**, the rate of collisional ionization from each ionic stage equals the rate of recombination to it. For any ion $X^k$ being ionized to $X^{k+1}$, the balance equation is:

$$
n_{X^k} n_e q_{X^k}(T) = n_{X^{k+1}} n_e \alpha_{X^{k+1}}(T)
$$

Here, $q_{X^k}(T)$ is the temperature-dependent collisional ionization [rate coefficient](@entry_id:183300) and $\alpha_{X^{k+1}}(T)$ is the [recombination rate](@entry_id:203271) coefficient. Note that in CIE, the equilibrium [ionization](@entry_id:136315) fractions $x_i = n_i / n_{\mathrm{element}}$ depend only on temperature, not on density, as the factor $n_e$ cancels. The "peaky" structure of the cooling function $\Lambda(T)$ arises directly from this. As temperature increases, successive ions of a given element become abundant, briefly dominate the cooling with their specific emission lines, and are then ionized to the next stage .

In contrast, in the diffuse intergalactic and [circumgalactic medium](@entry_id:747361), the gas is typically bathed in a powerful **metagalactic ultraviolet background (UVB)** originating from [quasars](@entry_id:159221) and star-forming galaxies. Here, the dominant ionization process is **[photoionization](@entry_id:157870)**. In a steady state, this is balanced by recombination, a state known as **Photoionization Equilibrium (PIE)**. The balance equation for an ion $X^k$ becomes:

$$
n_{X^k} \Gamma_{X^k} = n_{X^{k+1}} n_e \alpha_{X^{k+1}}(T)
$$

where $\Gamma_{X^k}$ is the [photoionization](@entry_id:157870) rate, determined by the intensity of the external radiation field. Unlike in CIE, the factor $n_e$ does not cancel, and the equilibrium [ionization](@entry_id:136315) state in PIE depends on both the [radiation field](@entry_id:164265) and the gas density.

This leads to the concept of **thermal equilibrium**, where the volumetric heating rate $\mathcal{H}$ exactly balances the volumetric cooling rate $\mathcal{L}$. Photoionization is a primary source of heating, as the excess energy of the ionizing photon above the ionization potential is converted into the kinetic energy of the freed electron. The volumetric [photoheating](@entry_id:753413) rate is proportional to the number of target atoms and the [photoionization](@entry_id:157870) rate, so it scales linearly with density: $\mathcal{H} \propto n$. In contrast, we have seen that collisional cooling scales as the square of the density: $\mathcal{L} \propto n^2$.

The balance equation $\mathcal{H} = \mathcal{L}$ therefore establishes a tight relationship between density and equilibrium temperature. For a simple photoionized gas where $\mathcal{H} \propto n$ and $\mathcal{L} \propto n^2 \Lambda(T)$, and approximating the cooling function locally as a power law $\Lambda(T) \propto T^\alpha$, thermal equilibrium, $\mathcal{H} \approx \mathcal{L}$, implies a scaling of the form $C_1 n \approx C_2 n^2 T_{\mathrm{eq}}^\alpha$. This simplifies to a temperature-density relation $T_{\mathrm{eq}} \propto n^{-1/\alpha}$ . This simple scaling underpins the well-defined "equation of state" of the low-density [intergalactic medium](@entry_id:157642).

### Timescale and Length Scale Challenges in Numerical Simulations

The physics of cooling and heating presents profound challenges when incorporated into hydrodynamical simulations with finite timesteps and spatial resolution. These challenges arise from the vast range of [characteristic scales](@entry_id:144643) involved.

A fundamental quantity is the **cooling time**, defined as the ratio of the gas's thermal energy density to its net cooling rate. For an [ideal monatomic gas](@entry_id:138760) with internal energy density $u = \frac{3}{2}n_{\text{tot}}k_B T$, the cooling time is:

$$
t_{\mathrm{cool}} = \frac{u}{\mathcal{L}} = \frac{\frac{3}{2}n_{\text{tot}}k_B T}{n_e n_{\mathrm{H}} \Lambda(T,Z)}
$$

Since the densities appear in the denominator, the cooling time is inversely proportional to density: $t_{\mathrm{cool}} \propto n^{-1}$ for a fixed temperature and composition . This simple scaling is the source of many numerical difficulties. In dense regions of the cosmos, such as star-forming clouds where number densities can be orders of magnitude higher than the cosmic mean, the cooling time can become exceedingly short. For instance, a fully ionized hydrogen plasma at $T=10^6\,\mathrm{K}$ with a low density of $n_H = 10^{-3}\,\mathrm{cm^{-3}}$ might have a cooling time of $\sim 131\,\mathrm{Myr}$. Increasing the density by a factor of $10^5$ to $n_H=100\,\mathrm{cm^{-3}}$ (typical of a molecular cloud) would decrease the cooling time to just over a thousand years.

This leads to the problem of **[numerical stiffness](@entry_id:752836)**. In an operator-split code, the hydrodynamic evolution is typically limited by the Courant-Friedrichs-Lewy (CFL) timestep, $\Delta t_{\mathrm{CFL}}$, which dictates how fast information can propagate across a grid cell. A cooling [source term](@entry_id:269111) is considered stiff when the cooling time is much shorter than the hydrodynamic timestep, i.e., $t_{\mathrm{cool}} \ll \Delta t_{\mathrm{CFL}}$ . Integrating a stiff equation with a simple explicit method, such as forward Euler ($u^{n+1} = u^n - \Delta t \mathcal{L}(u^n)$), is numerically unstable unless the timestep $\Delta t$ is smaller than the cooling time. A [linear stability analysis](@entry_id:154985) shows that the explicit update is stable only if $\Delta t  2 t_{\mathrm{cool}}/\beta$, where $\beta = d\ln\Lambda/d\ln T$ . When cooling is stiff, this condition is violated if one naively uses $\Delta t = \Delta t_{\mathrm{CFL}}$, causing the numerical solution for temperature to oscillate wildly or become negative. This forces codes to either use tiny timesteps ([subcycling](@entry_id:755594)) or adopt more complex [implicit solvers](@entry_id:140315) that are unconditionally stable.

The stiffness of cooling gives rise to the infamous **overcooling problem** in galaxy formation simulations, particularly in the context of [supernova feedback](@entry_id:755651) . A [supernova](@entry_id:159451) injects a tremendous amount of thermal energy ($E_{\mathrm{SN}} \sim 10^{51}\,\mathrm{erg}$) into the surrounding gas. If this energy is distributed over a large mass of dense gas, the resulting temperature increase may be modest, placing the gas in a regime of very efficient cooling. For example, injecting $10^{51}\,\mathrm{erg}$ into $10^5\,M_\odot$ of gas at $n_{\mathrm{H}} = 30\,\mathrm{cm}^{-3}$ raises the temperature to only a few times $10^4\,\mathrm{K}$, where the cooling time can be as short as $\sim 150$ years. This is far shorter than a typical hydrodynamic timestep of $\sim 10^4\,\mathrm{yr}$. As a result, in an explicit update, the injected thermal energy is radiated away almost instantaneously, before it can build up pressure and drive an outflow. The feedback becomes numerically inefficient.

Beyond timescales, there is also a characteristic **cooling length**, $L_{\mathrm{cool}} = c_s t_{\mathrm{cool}}$, where $c_s$ is the sound speed. This represents the distance a sound wave can travel in a cooling time . It is the physical scale over which a cooling gas parcel can maintain pressure equilibrium with its surroundings. If this length is smaller than the grid resolution of the simulation ($\Delta x$), the cooling becomes spatially unresolved. A cell can then cool and lose pressure support in isolation, without being able to hydrodynamically respond to or influence its neighbors. This can lead to artificial clumping and fragmentation on the grid scale, a purely numerical artifact. For gas at $T=10^4\,\mathrm{K}$ and $n_H=10^{-2}\,\mathrm{cm}^{-3}$, the cooling length can be as small as $\sim 1.6\,\mathrm{pc}$, which is severely unresolved in many large-scale [cosmological simulations](@entry_id:747925) where the finest resolution may be tens or hundreds of parsecs.

### Key Subgrid Modeling Techniques

The numerical challenges of unresolved timescales and length scales necessitate the development of [subgrid models](@entry_id:755601). These models aim to represent the net physical effect of processes occurring below the grid scale, ensuring that the resolved-scale dynamics are physically plausible and numerically stable.

#### Models for Feedback and Overcooling

To combat the overcooling of [supernova](@entry_id:159451) energy, [subgrid models](@entry_id:755601) have been devised to ensure feedback is effective.
*   **High-Temperature Heating:** One strategy is to alter how the supernova energy is distributed. Instead of depositing it into a large gas mass, the energy is concentrated into a much smaller mass. For instance, heating only $10^3\,M_\odot$ of gas with the same $10^{51}\,\mathrm{erg}$ can raise its temperature to several million Kelvin . At these very high temperatures, the cooling function is actually lower than at $10^5\,\mathrm{K}$, and the cooling time $t_{\mathrm{cool}} \propto T/\Lambda(T)$ becomes much longer, potentially exceeding the hydrodynamic timestep. This gives the hot, high-pressure bubble time to expand and perform work, thus coupling the feedback energy to the gas kinetically.
*   **Kinetic Feedback:** A more direct approach is to bypass the thermal phase entirely. Analytic models predict the terminal momentum that a supernova remnant imparts to its surroundings after the initial, unresolved blastwave phase. Subgrid models can use these results to inject momentum directly into the grid cells around a star particle, creating a "kinetic" feedback model that is immune to the thermal overcooling problem by construction .
*   **Temperature Floors:** To prevent artificial fragmentation from unresolved cooling, codes often impose a non-thermal pressure floor or, equivalently, a **temperature floor**. This prevents gas from cooling below a certain density-dependent temperature. A physically motivated way to set this floor is to enforce that the cooling length must be resolved . One can impose the condition $L_{\mathrm{cool}}(T_{\mathrm{floor}}, n) = N_{\mathrm{res}}\Delta x$, where $N_{\mathrm{res}}$ is a desired number of resolution elements (e.g., 4). This defines an implicit equation for the floor temperature $T_{\mathrm{floor}}$ as a function of density and grid resolution, ensuring that runaway cooling does not occur on scales the simulation cannot properly resolve.

#### Models for Unresolved Structure

Cosmic gas is turbulent and inhomogeneous on all scales. A single grid cell in a simulation does not contain uniform-density gas but rather a complex distribution of densities. This unresolved structure can dramatically affect the mean radiative rates.
*   **Clumping Factor:** The volumetric cooling rate scales as $\mathcal{L} \propto n^2$. Because the average of the square is not the square of the average ($\langle n^2 \rangle \ge \langle n \rangle^2$), unresolved [density fluctuations](@entry_id:143540) will always enhance the mean cooling rate. This effect is captured by the **[clumping factor](@entry_id:747398)**, $C \equiv \langle n^2 \rangle / \langle n \rangle^2$. The mean cooling rate in an inhomogeneous cell is $\langle \mathcal{L} \rangle = C \cdot \mathcal{L}_{\mathrm{hom}}$, where $\mathcal{L}_{\mathrm{hom}}$ is the rate one would compute using the cell's mean density $\langle n \rangle$ . The density distribution in turbulent gas is often well-described by a lognormal PDF. For such a distribution, the [clumping factor](@entry_id:747398) has a simple and elegant form: $C = \exp(\sigma^2)$, where $\sigma^2$ is the variance of the log-density. Subgrid models can incorporate a prescription for $\sigma^2$ based on local resolved properties (like the Mach number) to compute a [clumping factor](@entry_id:747398) and apply a physically motivated boost to the cooling rate.

*   **Self-Shielding:** Just as unresolved clumps enhance cooling, they can also block external radiation. In dense regions, the column density of [neutral hydrogen](@entry_id:174271) can become large enough to absorb most of the incident ionizing photons from the UVB. This is called **self-shielding**. It is the process that allows gas to transition from being highly ionized to mostly neutral, a key step in forming stars and galaxies. Since this transition often occurs on scales smaller than the grid, it must be modeled as a subgrid process. A common approach is to attenuate the external [photoionization](@entry_id:157870) rate $\Gamma_{\mathrm{thin}}$ by a factor that depends on an estimate of the local neutral column density, $N_{\mathrm{HI}}$ . A physically robust model must be self-consistent: the attenuated rate $\Gamma = \Gamma_{\mathrm{thin}} S(N_{\mathrm{HI}})$ determines the neutral fraction $x_{\mathrm{HI}}$, which in turn is used to calculate the column density $N_{\mathrm{HI}} = x_{\mathrm{HI}} n_H L_{\mathrm{sh}}$ over some characteristic shielding length $L_{\mathrm{sh}}$. To be resolution-independent, $L_{\mathrm{sh}}$ must be a physical scale. A common choice is the local Jeans length, $L_J$, which is derived from the balance of thermal pressure and gravity. This leads to a self-consistent, local, and resolution-independent subgrid model that accurately captures the transition from the optically thin to the self-shielded regime.

In summary, the principles of [radiative heating](@entry_id:754016) and cooling, when combined with the realities of finite numerical resolution, create a rich landscape of physical and numerical challenges. Subgrid models are the essential theoretical tools that allow simulations to bridge these scales, enabling them to produce physically meaningful predictions for the evolution of cosmic structures.