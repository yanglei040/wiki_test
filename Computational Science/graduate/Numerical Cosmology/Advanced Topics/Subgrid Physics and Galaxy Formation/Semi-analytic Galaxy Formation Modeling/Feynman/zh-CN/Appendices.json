{
    "hands_on_practices": [
        {
            "introduction": "这项练习是星系形成建模的基石，它在宇宙学模拟提供的暗物质晕支架与其中孕育的重子星系之间架起了桥梁。通过实践角动量守恒和引力稳定性等基本原理，您将亲手建立一个切实的银盘模型，并学会评估其稳定性。这个练习将帮助您掌握如何从暗物质晕的核心属性（如质量和自旋参数）出发，推导出星系盘的关键特征，例如盘标度半径和 Toomre $Q$ 参数 。",
            "id": "3486109",
            "problem": "您的任务是在数值宇宙学领域内，在一个暗物质晕中实现一个简化但科学上一致的盘状星系形成的半解析模型。您必须从基本物理关系和核心定义出发，推导并计算嵌入在以质量和自旋参数为特征的暗物质晕中的气体指数盘的盘标度半径、Toomre 稳定性参数以及预期的不稳定盘质量分数。所有计算都必须遵守所提供的建模和单位规范。\n\n建模假设和物理设置：\n- 暗物质晕位于红移 $z = 0$ 处，总质量为 $M$（以太阳质量为单位），并遵循球形顶帽（spherical top-hat）维里化，相对于临界密度的过密度为 $\\Delta = 200$。哈勃常数为 $H_0 = 70$，单位为 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，在所有计算中必须将其转换为 $\\mathrm{km\\,s^{-1}\\,kpc^{-1}}$。\n- 引力常数为 $G = 4.3009 \\times 10^{-6}$，单位为 $\\mathrm{kpc\\,km^2\\,s^{-2}\\,M_\\odot^{-1}}$。\n- 暗物质晕具有自旋参数 $\\lambda$，并假设在形成旋转支撑的指数盘过程中比角动量守恒，其具有平坦的圆周速度剖面 $V_c(R) \\approx V_{\\mathrm{vir}}$。\n- 盘质量分数为 $m_d$，因此重子盘的质量为 $M_d = m_d M$。盘内的气体分数为 $f_g$，得出气体质量为 $M_{\\mathrm{gas}} = f_g M_d = f_g m_d M$。\n- 气体盘具有指数表面密度剖面 $\\Sigma_g(R) = \\Sigma_0 \\exp(-R/R_d)$，其中 $R_d$ 是盘标度半径，$\\Sigma_0$ 由质量守恒确定。\n- 气体速度弥散由声速 $c_s$（单位为 $\\mathrm{km\\,s^{-1}}$）近似。\n- 薄气体盘的 Toomre 稳定性参数（Toomre $Q$）定义为 $Q(R) = \\kappa(R) c_s / (\\pi G \\Sigma_g(R))$，其中对于平坦的旋转曲线，周转频率为 $\\kappa(R) = \\sqrt{2} V_c(R)/R$。\n\n推导要求（在实现中不提供捷径或目标公式；您的代码必须应用推导出的关系）：\n1. 使用以哈勃常数表示的临界密度定义 $\\rho_c = 3 H_0^2 / (8 \\pi G)$，并通过 $M = (4/3) \\pi \\Delta \\rho_c R_{\\mathrm{vir}}^3$ 从暗物质晕质量 $M$ 计算维里半径 $R_{\\mathrm{vir}}$。然后计算维里圆周速度 $V_{\\mathrm{vir}} = \\sqrt{G M / R_{\\mathrm{vir}}}$。\n2. 从无量纲自旋参数的定义 $\\lambda = J |E|^{1/2} / (G M^{5/2})$ 出发，其中维里化等温晕的总能量近似为 $E \\approx - \\tfrac{1}{2} G M^2 / R_{\\mathrm{vir}}$，推导出暗物质晕的比角动量 $j_h = J/M$，并对于具有平坦旋转曲线的盘（其中 $j_d = 2 R_d V_c$）使用比角动量守恒 $j_d \\approx j_h$。在这些假设下，总结出用 $\\lambda$ 和 $R_{\\mathrm{vir}}$ 表示 $R_d$ 的表达式，并用它来计算 $R_d$。\n3. 使用指数盘的质量守恒（$M_{\\mathrm{gas}} = 2 \\pi \\Sigma_0 R_d^2$）从 $M_{\\mathrm{gas}}$ 和 $R_d$ 计算 $\\Sigma_0$。\n4. 计算在 $R = R_d$ 处的 $Q(R)$，以获得具有平坦旋转曲线的指数盘的特征最小稳定性值 $Q_d \\equiv Q(R_d)$。\n5. 确定 $Q(R)  1$ 的不稳定径向区域。证明在 $V_c(R) \\approx V_{\\mathrm{vir}}$ 的条件下，$Q(R)$ 可以写成 $Q(R) = A \\exp(R/R_d) / R$ 的形式（其中 $A$ 是一个常数），$Q(R)$ 在 $R = R_d$ 处达到其最小值，并且当 $Q_d  1$ 时，不等式 $Q(R)  1$ 会产生两个实数根 $R_1$ 和 $R_2$。使用 Lambert W 函数求解边界以获得 $R_1$ 和 $R_2$，并通过对 $R_1$ 和 $R_2$ 之间的指数盘质量进行积分再除以总气体质量来计算不稳定的气体质量分数。最终的不稳定质量分数仅用无量纲半径 $u_i = R_i / R_d$ 表示。\n\n实现任务：\n- 在一个完整的程序中实现上述推导，该程序不接受任何输入，并使用提供的测试套件。\n- 对于每个测试用例，计算并输出三元组 $[R_d, Q_d, f_{\\mathrm{unstable}}]$，其中 $R_d$ 必须以 $\\mathrm{kpc}$ 表示，$Q_d$ 是无量纲的，$f_{\\mathrm{unstable}}$ 是不稳定区域中气体质量的小数部分。\n\n测试套件：\n使用以下参数集，每个参数集以 $(M, \\lambda, m_d, f_g, c_s)$ 的形式给出，其中 $M$ 的单位是 $M_\\odot$，$c_s$ 的单位是 $\\mathrm{km\\,s^{-1}}$。\n- 案例 1（一般类银河系，预期稳定）：$(1.0 \\times 10^{12}, 0.04, 0.05, 0.20, 10.0)$。\n- 案例 2（低自旋，富含气体，预期非常不稳定）：$(1.0 \\times 10^{12}, 0.01, 0.08, 0.80, 6.0)$。\n- 案例 3（中等质量，高自旋，预期稳定）：$(3.0 \\times 10^{11}, 0.08, 0.03, 0.15, 12.0)$。\n- 案例 4（低质量，接近阈值稳定性）：$(1.0 \\times 10^{10}, 0.03, 0.06, 0.50, 6.0)$。\n- 案例 5（案例 1 的边界条件，接近 $Q_d \\approx 1$）：$(1.0 \\times 10^{12}, 0.04, 0.05, 0.20, 6.64)$。\n\n最终输出规范：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素本身就是一个包含三个浮点数的列表，按测试套件的顺序表示 $[R_d, Q_d, f_{\\mathrm{unstable}}]$，例如 $\\left[ [r_{d,1}, q_{d,1}, f_{1}], [r_{d,2}, q_{d,2}, f_{2}], \\ldots \\right]$。",
            "solution": "问题陈述已经过验证，被认为是科学基础扎实、提法恰当、客观且内部一致的。它提出了一个简化但标准的盘状星系形成模型，适合基于第一性原理进行计算实现。所需的任务和推导是合乎逻辑的，并遵循既定的天体物理学形式体系。因此，我们可以着手提供一个完整的解决方案。\n\n该解决方案的结构是按照问题描述中指定的方式，逐步推导出必要的物理量。所有数学符号、变量和数值均按照格式要求以 LaTeX 呈现。\n\n**单位转换和常数**\n\n该问题是使用一组特定的物理常数和单位定义的。我们首先为计算确定这些值。\n引力常数为 $G = 4.3009 \\times 10^{-6} \\, \\mathrm{kpc\\,km^2\\,s^{-2}\\,M_\\odot^{-1}}$。\n哈勃常数给定为 $H_0 = 70 \\, \\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$。为了与 G 的单位保持一致，我们将其转换为每千秒差距的单位。由于 $1 \\, \\mathrm{Mpc} = 10^3 \\, \\mathrm{kpc}$，我们有：\n$$H_0 = 70 \\, \\frac{\\mathrm{km}}{\\mathrm{s} \\cdot \\mathrm{Mpc}} \\times \\frac{1 \\, \\mathrm{Mpc}}{1000 \\, \\mathrm{kpc}} = 0.07 \\, \\mathrm{km\\,s^{-1}\\,kpc^{-1}}$$\n在红移 $z=0$ 时，暗物质晕相对于临界密度 $\\rho_c$ 的维里化过密度为 $\\Delta = 200$。\n\n**步骤 1. 维里性质的推导**\n\n第一步是通过其维里半径 $R_{\\mathrm{vir}}$ 和维里圆周速度 $V_{\\mathrm{vir}}$ 来表征暗物质晕。\n宇宙的临界密度定义为 $\\rho_c = \\frac{3 H_0^2}{8 \\pi G}$。\n暗物质晕的质量 $M$ 定义在维里半径 $R_{\\mathrm{vir}}$ 内，其平均密度为 $\\Delta \\rho_c$。对于球形暗物质晕：\n$$M = \\frac{4}{3} \\pi R_{\\mathrm{vir}}^3 (\\Delta \\rho_c)$$\n代入 $\\rho_c$ 的表达式：\n$$M = \\frac{4}{3} \\pi R_{\\mathrm{vir}}^3 \\left( \\Delta \\frac{3 H_0^2}{8 \\pi G} \\right) = \\frac{\\Delta H_0^2}{2G} R_{\\mathrm{vir}}^3$$\n求解维里半径 $R_{\\mathrm{vir}}$ 得：\n$$R_{\\mathrm{vir}} = \\left( \\frac{2 G M}{\\Delta H_0^2} \\right)^{1/3}$$\n维里半径处的圆周速度 $V_{\\mathrm{vir}}$ 由球形质量分布的标准公式给出：\n$$V_{\\mathrm{vir}} = \\sqrt{\\frac{G M}{R_{\\mathrm{vir}}}}$$\n这两个方程使我们能够从暗物质晕的质量 $M$ 计算出其基本尺度和速度。\n\n**步骤 2. 盘标度半径的推导**\n\n盘标度半径 $R_d$ 是通过假设形成盘的物质的比角动量守恒来确定的。暗物质晕的比角动量与其无量纲自旋参数 $\\lambda$ 相关：\n$$\\lambda = \\frac{J |E|^{1/2}}{G M^{5/2}}$$\n其中 $J$ 是总角动量，$E$ 是暗物质晕的总能量。对于一个维里化的等温球体，其能量近似为 $E \\approx - \\frac{1}{2} \\frac{G M^2}{R_{\\mathrm{vir}}}$。其绝对值为 $|E| = \\frac{G M^2}{2 R_{\\mathrm{vir}}}$。\n将 $|E|$ 代入 $\\lambda$ 的定义中：\n$$\\lambda = \\frac{J}{G M^{5/2}} \\left( \\frac{G M^2}{2 R_{\\mathrm{vir}}} \\right)^{1/2} = \\frac{J}{G M^{5/2}} \\frac{G^{1/2} M}{\\sqrt{2} R_{\\mathrm{vir}}^{1/2}} = \\frac{J}{\\sqrt{2} G^{1/2} M^{3/2} R_{\\mathrm{vir}}^{1/2}}$$\n暗物质晕的比角动量为 $j_h = J/M$。求解 $j_h$：\n$$j_h = \\sqrt{2} \\lambda G^{1/2} M^{1/2} R_{\\mathrm{vir}}^{1/2}$$\n使用关系式 $V_{\\mathrm{vir}}^2 = GM/R_{\\mathrm{vir}}$，我们可以写出 $G^{1/2}M^{1/2} = V_{\\mathrm{vir}} R_{\\mathrm{vir}}^{1/2}$。将此代入 $j_h$ 的表达式中：\n$$j_h = \\sqrt{2} \\lambda (V_{\\mathrm{vir}} R_{\\mathrm{vir}}^{1/2}) R_{\\mathrm{vir}}^{1/2} = \\sqrt{2} \\lambda V_{\\mathrm{vir}} R_{\\mathrm{vir}}$$\n一个具有表面密度 $\\Sigma(R) \\propto \\exp(-R/R_d)$ 和平坦旋转曲线 $V_c$ 的指数盘的比角动量为 $j_d = 2 R_d V_c$。该模型假设比角动量守恒，$j_d \\approx j_h$，并且盘的平坦旋转曲线由暗物质晕的势能决定，$V_c \\approx V_{\\mathrm{vir}}$。\n$$2 R_d V_{\\mathrm{vir}} = \\sqrt{2} \\lambda V_{\\mathrm{vir}} R_{\\mathrm{vir}}$$\n求解盘标度半径 $R_d$ 得到我们的工作公式：\n$$R_d = \\frac{\\lambda}{\\sqrt{2}} R_{\\mathrm{vir}}$$\n\n**步骤 3. 中心气体表面密度的推导**\n\n气体盘具有指数表面密度剖面 $\\Sigma_g(R) = \\Sigma_0 \\exp(-R/R_d)$，其中 $\\Sigma_0$ 是中心表面密度。总气体质量 $M_{\\mathrm{gas}}$ 是通过对整个盘上的此剖面进行积分得到的：\n$$M_{\\mathrm{gas}} = \\int_0^\\infty \\Sigma_g(R) \\, 2 \\pi R \\, dR = 2 \\pi \\Sigma_0 \\int_0^\\infty R e^{-R/R_d} \\, dR$$\n该积分的计算结果为 $R_d^2$。因此，$M_{\\mathrm{gas}} = 2 \\pi \\Sigma_0 R_d^2$。\n气体质量是盘质量 $M_d$ 的一个分数 $f_g$，而盘质量本身是总暗物质晕质量 $M$ 的一个分数 $m_d$，所以 $M_{\\mathrm{gas}} = f_g m_d M$。\n通过将 $M_{\\mathrm{gas}}$ 的两个表达式相等，我们可以求解 $\\Sigma_0$：\n$$\\Sigma_0 = \\frac{M_{\\mathrm{gas}}}{2 \\pi R_d^2} = \\frac{f_g m_d M}{2 \\pi R_d^2}$$\n\n**步骤 4. Toomre 稳定性参数的推导**\n\n薄气体盘的 Toomre 稳定性由参数 $Q(R)$ 量化：\n$$Q(R) = \\frac{\\kappa(R) c_s}{\\pi G \\Sigma_g(R)}$$\n其中 $c_s$ 是气体速度弥散（声速）。对于平坦的旋转曲线 $V_c(R) \\approx V_{\\mathrm{vir}}$，周转频率为 $\\kappa(R) = \\sqrt{2} V_c / R \\approx \\sqrt{2} V_{\\mathrm{vir}}/R$。\n代入 $\\kappa(R)$ 和 $\\Sigma_g(R)$ 的表达式：\n$$Q(R) = \\frac{(\\sqrt{2} V_{\\mathrm{vir}}/R) c_s}{\\pi G (\\Sigma_0 e^{-R/R_d})} = \\frac{\\sqrt{2} V_{\\mathrm{vir}} c_s}{\\pi G \\Sigma_0} \\frac{e^{R/R_d}}{R}$$\n这表明 $Q(R)$ 具有 $A \\exp(R/R_d) / R$ 的形式，它有一个唯一的最小值。函数 $f(R) = e^{R/R_d}/R$ 的最小值出现在 $f'(R)=0$ 时，解得 $R=R_d$。\n因此，Toomre 参数的最小值 $Q_d$ 出现在 $R=R_d$ 处：\n$$Q_d \\equiv Q(R_d) = \\frac{\\sqrt{2} V_{\\mathrm{vir}} c_s}{\\pi G \\Sigma_0} \\frac{e}{R_d}$$\n代入 $\\Sigma_0$ 的表达式：\n$$Q_d = \\frac{\\sqrt{2} V_{\\mathrm{vir}} c_s e}{\\pi G R_d} \\left( \\frac{2 \\pi R_d^2}{M_{\\mathrm{gas}}} \\right) = \\frac{2 \\sqrt{2} e V_{\\mathrm{vir}} c_s R_d}{G M_{\\mathrm{gas}}}$$\n这提供了一种直接计算盘的特征稳定性的方法。\n\n**步骤 5. 不稳定区域和质量分数的推导**\n\n在 $Q(R)  1$ 的区域，盘对引力坍缩是局部不稳定的。我们可以用其最小值 $Q_d$ 和无量纲半径 $u=R/R_d$ 来表示 $Q(R)$：\n$$Q(R) = Q(u R_d) = \\frac{\\sqrt{2} V_{\\mathrm{vir}} c_s}{\\pi G \\Sigma_0} \\frac{e^{u}}{u R_d} = \\left(\\frac{\\sqrt{2} V_{\\mathrm{vir}} c_s e}{\\pi G \\Sigma_0 R_d}\\right) \\frac{e^{u-1}}{u} = Q_d \\frac{e^{u-1}}{u}$$\n不稳定性条件是 $Q_d \\frac{e^{u-1}}{u}  1$。如果 $Q_d \\ge 1$，则该条件永远不会满足，盘在任何地方都是稳定的，因此不稳定质量分数 $f_{\\mathrm{unstable}} = 0$。\n如果 $Q_d  1$，我们求解边界半径，在这些半径处 $Q(u)=1$：\n$$Q_d \\frac{e^{u-1}}{u} = 1 \\implies u e^{-u} = \\frac{Q_d}{e}$$\n这是一个超越方程，可以使用 Lambert W 函数求解，该函数由 $W(z) e^{W(z)} = z$ 定义。我们设 $x=-u$，所以 $u=-x$：\n$$(-x) e^x = \\frac{Q_d}{e} \\implies x e^x = -\\frac{Q_d}{e}$$\n对于 $0  Q_d  1$，参数 $z = -Q_d/e$ 在范围 $(-1/e, 0)$ 内，对此 Lambert W 函数有两个实数分支，$W_0(z)$ 和 $W_{-1}(z)$。$x$ 的解是 $x_1 = W_{-1}(-Q_d/e)$ 和 $x_2 = W_0(-Q_d/e)$。\n相应的无量纲半径为 $u_1 = -x_2 = -W_0(-Q_d/e)$ 和 $u_2 = -x_1 = -W_{-1}(-Q_d/e)$，它们定义了不稳定区域 $[R_1, R_2] = [u_1 R_d, u_2 R_d]$。\n不稳定气体的质量通过在这些半径之间对表面密度剖面进行积分来找到：\n$$M_{\\mathrm{unstable}} = \\int_{R_1}^{R_2} 2\\pi R \\Sigma_g(R) \\, dR = 2\\pi \\Sigma_0 \\int_{R_1}^{R_2} R e^{-R/R_d} \\, dR$$\n不定积分为 $\\int R e^{-R/R_d} dR = -R_d(R+R_d)e^{-R/R_d}$。计算定积分得到：\n$$M_{\\mathrm{unstable}} = 2\\pi \\Sigma_0 R_d^2 \\left[ (1+u_1)e^{-u_1} - (1+u_2)e^{-u_2} \\right]$$\n不稳定质量分数 $f_{\\mathrm{unstable}} = M_{\\mathrm{unstable}} / M_{\\mathrm{gas}}$，其中 $M_{\\mathrm{gas}} = 2\\pi\\Sigma_0 R_d^2$，简化为：\n$$f_{\\mathrm{unstable}} = (1+u_1)e^{-u_1} - (1+u_2)e^{-u_2}$$\n如果 $Q_d \\ge 1$，则 $f_{\\mathrm{unstable}}=0$。至此完成了所有所需量的推导。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lambertw\n\ndef solve():\n    \"\"\"\n    Main function to run the semi-analytic galaxy formation model for the provided test suite.\n    \"\"\"\n    \n    # Global constants\n    G = 4.3009e-6  # kpc*km^2/s^2/M_sun\n    H0 = 0.07      # km/s/kpc\n    DELTA = 200.0  # Virial overdensity\n\n    test_cases = [\n        # (M [M_sun], lambda, m_d, f_g, c_s [km/s])\n        (1.0e12, 0.04, 0.05, 0.20, 10.0),  # Case 1\n        (1.0e12, 0.01, 0.08, 0.80, 6.0),   # Case 2\n        (3.0e11, 0.08, 0.03, 0.15, 12.0),  # Case 3\n        (1.0e10, 0.03, 0.06, 0.50, 6.0),   # Case 4\n        (1.0e12, 0.04, 0.05, 0.20, 6.64)   # Case 5\n    ]\n    \n    def calculate_disk_properties(M, lam, m_d, f_g, c_s):\n        \"\"\"\n        Calculates Rd, Qd, and f_unstable based on the derived model.\n        \n        Args:\n            M (float): Total halo mass in solar masses.\n            lam (float): Halo spin parameter (dimensionless).\n            m_d (float): Disk mass fraction (dimensionless).\n            f_g (float): Gas fraction of the disk (dimensionless).\n            c_s (float): Gas velocity dispersion in km/s.\n            \n        Returns:\n            list: A list containing [Rd, Qd, f_unstable].\n        \"\"\"\n        \n        # Step 1: Virial Properties\n        # R_vir = (2 * G * M / (DELTA * H0^2))^(1/3)\n        R_vir = (2.0 * G * M / (DELTA * H0**2))**(1.0/3.0)\n        \n        # V_vir = sqrt(G * M / R_vir)\n        V_vir = np.sqrt(G * M / R_vir)\n        \n        # Step 2: Disk Scale Radius\n        # R_d = lambda * R_vir / sqrt(2)\n        R_d = lam * R_vir / np.sqrt(2.0)\n        \n        # Gas mass\n        M_gas = f_g * m_d * M\n        \n        # Step 3 (Implicit in Step 4): Central Surface Density\n        # Sigma_0 = M_gas / (2 * pi * R_d^2)\n        \n        # Step 4: Toomre Q at R_d\n        # Qd = (2 * sqrt(2) * e * V_vir * c_s * R_d) / (G * M_gas)\n        if M_gas == 0 or R_d == 0:\n            return [R_d, float('inf'), 0.0]\n            \n        Q_d = (2.0 * np.sqrt(2.0) * np.e * V_vir * c_s * R_d) / (G * M_gas)\n        \n        # Step 5: Unstable Mass Fraction\n        f_unstable = 0.0\n        if 0  Q_d  1.0:\n            # Solve u * exp(-u) = Q_d / e using the Lambert W function.\n            # Let x = -u, then x * exp(x) = -Q_d / e.\n            arg = -Q_d / np.e\n            \n            # The two solutions u1, u2 are given by the two real branches of W.\n            # u1 = -W_0(arg), u2 = -W_-1(arg)\n            # lambertw returns complex numbers, so we take the real part.\n            u1 = -lambertw(arg, k=0).real\n            u2 = -lambertw(arg, k=-1).real\n            \n            # f_unstable = (1+u1)e^(-u1) - (1+u2)e^(-u2)\n            f_unstable = (1.0 + u1) * np.exp(-u1) - (1.0 + u2) * np.exp(-u2)\n\n        return [R_d, Q_d, f_unstable]\n\n    results = []\n    for case in test_cases:\n        M, lam, m_d, f_g, c_s = case\n        result = calculate_disk_properties(M, lam, m_d, f_g, c_s)\n        results.append(result)\n\n    # The final print statement must match the format [[r1,q1,f1], [r2,q2,f2], ...] exactly.\n    # The default str() representation of a list of lists matches this.\n    print(str(results).replace(\"'\", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "在建立星系盘之后，下一步是为其植入驱动演化的关键重子物理过程。这项实践将深入探讨恒星形成定律与星系反馈之间至关重要且时常简并的关系。通过这项练习，您将量化分析不同的恒星形成物理模型（例如经典的 Kennicutt-Schmidt 定律与基于分子氢的定律）如何影响匹配观测（如恒星形成主序）所需的反馈强度 。",
            "id": "3486103",
            "problem": "考虑一个以气体调节器图像和恒星形成表面密度定律为中心的半解析星系形成建模练习。您将构建一个程序，通过在物理驱动的表面密度上限下，对比 Kennicutt–Schmidt 定律与基于分子氢 (H$_2$) 分配的定律 (Blitz–Rosolowsky)，来交叉校准反馈归一化。目标是量化当试图匹配恒星形成主序时，在这些不同的恒星形成处方之间，所需的反馈归一化如何变化。您必须从质量连续性的第一性原理和经过观测检验的恒星形成关系出发，来构建模型和算法。所有符号必须以其指定单位进行解释，所有数值输出必须是无单位的浮点数。最终输出格式必须是单行，其中包含一个用方括号括起来的逗号分隔列表。\n\n基本和核心定义：\n- 星系气体调节器连续性方程为 $\\,\\mathrm{d}M_{\\rm gas}/\\mathrm{d}t = \\dot{M}_{\\rm in} - (1-R)\\,\\mathrm{SFR} - \\eta\\,\\mathrm{SFR}\\,$，其中 $M_{\\rm gas}$ 是气体质量，$\\dot{M}_{\\rm in}$ 是流入率，$R$ 是恒星演化的瞬时返回分数，$\\eta$ 是外流质量加载因子。在准稳态下，设置 $\\,\\mathrm{d}M_{\\rm gas}/\\mathrm{d}t = 0\\,$ 以获得 $\\,\\mathrm{SFR}_{\\rm eq} = \\dot{M}_{\\rm in}/\\left(1-R+\\eta\\right)\\,$。\n- 质量加载因子归一化参数化为 $\\,\\eta = \\epsilon_{\\rm fb}\\left(V_{\\rm ref}/V_c\\right)^\\gamma\\,$，其中 $\\epsilon_{\\rm fb}$ 是在参考环绕速度 $V_{\\rm ref}$ 下的无量纲反馈归一化，$V_c$ 是星系环绕速度，$\\gamma$ 是幂律指数。\n- Kennicutt–Schmidt 关系为 $\\,\\Sigma_{\\rm SFR} = A_{\\rm KS}\\,\\Sigma_{\\rm gas}^n\\,$，其中 $A_{\\rm KS}$ 和 $n$ 是根据邻近星系校准的常数。\n- 基于 H$_2$ 的定律采用 $\\Sigma_{\\rm SFR} = A_{\\rm H_2}\\,f_{\\rm H_2}\\,\\Sigma_{\\rm gas}$，其中分子分数 $\\,f_{\\rm H_2}\\,$ 由 Blitz–Rosolowsky 压力分配设定：$R_{\\rm mol} = (P_{\\rm ext}/P_0)^\\alpha$， $f_{\\rm H_2} = R_{\\rm mol}/(1+R_{\\rm mol})$。外部中平面压力与归一化压力之比被建模为 $\\,P_{\\rm ext}/P_0 = C_P\\,\\Sigma_{\\rm gas}\\,\\left(\\Sigma_{\\rm gas}+\\xi\\,\\Sigma_\\star\\right)\\,$，其中 $C_P$ 是一个编码单位转换和几何预因子的无量纲常数，$\\,\\Sigma_\\star\\,$ 是恒星表面密度，$\\,\\xi = \\sigma_g/\\sigma_\\star\\,$ 是气体与恒星速度弥散之比。\n- 恒星形成主序表示为 $\\,\\mathrm{SFR}_{\\rm MS} = k_{\\rm MS}\\,M_\\star^\\beta\\,$。\n\n算法任务：\n1. 对于每个测试案例，计算在气体表面密度上限 $\\,\\Sigma_{\\rm gas,max}\\,$ 和盘面积 $\\,A\\,$下，每种定律的恒星形成率上限：\n   - $\\,\\mathrm{SFR}_{\\rm cap,KS} = A\\,A_{\\rm KS}\\,\\Sigma_{\\rm gas,max}^n\\,$。\n   - $\\,\\mathrm{SFR}_{\\rm cap,H_2} = A\\,A_{\\rm H_2}\\,f_{\\rm H_2}(\\Sigma_{\\rm gas,max})\\,\\Sigma_{\\rm gas,max}\\,$，其中 $\\,f_{\\rm H_2} = \\frac{(C_P\\,\\Sigma_{\\rm gas,max}\\,(\\Sigma_{\\rm gas,max}+\\xi\\Sigma_\\star))^\\alpha}{1+(C_P\\,\\Sigma_{\\rm gas,max}\\,(\\Sigma_{\\rm gas,max}+\\xi\\Sigma_\\star))^\\alpha}\\,$。\n   这里 $\\,A\\,$ 的单位是 $\\mathrm{kpc}^2$，$\\,\\Sigma_{\\rm gas,max}\\,$ 和 $\\,\\Sigma_\\star\\,$ 的单位是 $\\,M_\\odot/\\mathrm{pc}^2$，$\\,\\Sigma_{\\rm SFR}\\,$ 的单位是 $\\,M_\\odot\\,\\mathrm{yr}^{-1}\\,\\mathrm{kpc}^{-2}$，所有 $\\mathrm{SFR}$ 的单位是 $\\,M_\\odot/\\mathrm{yr}$。\n2. 将每种定律所需的恒星形成率定义为 $\\,\\mathrm{SFR}_{\\rm req,law} = \\min\\!\\left(\\mathrm{SFR}_{\\rm MS},\\,\\mathrm{SFR}_{\\rm cap,law}\\right)\\,$。这在表面密度上限下，强制施加了一个来自恒星形成定律的物理上合理的上限。\n3. 使用准稳态平衡关系求解产生所需恒星形成率的反馈归一化：\n   $$\\epsilon_{\\rm fb,law} = \\max\\left\\{0,\\; \\frac{\\dot{M}_{\\rm in}/\\mathrm{SFR}_{\\rm req,law} - (1-R)}{(V_{\\rm ref}/V_c)^\\gamma}\\right\\}.$$\n   $\\max$ 强制执行物理约束 $\\,\\epsilon_{\\rm fb}\\ge 0\\,$。将 $\\,\\epsilon_{\\rm fb,law}\\,$ 表示为无单位浮点数。\n4. 报告每个测试案例的绝对差 $\\,\\Delta\\epsilon_{\\rm fb} = \\left|\\epsilon_{\\rm fb,KS} - \\epsilon_{\\rm fb,H_2}\\right|\\,$。输出必须是单行，包含一个用方括号括起来的逗号分隔列表，例如 $\\,\\left[\\delta_1,\\delta_2,\\delta_3\\right]\\,$。\n\n使用以下固定的参数值，这些值与观测结果和广泛使用的半解析实践一致：\n- $\\,A_{\\rm KS} = 2.5\\times 10^{-4}\\,$，单位为 $\\,M_\\odot\\,\\mathrm{yr}^{-1}\\,\\mathrm{kpc}^{-2}\\, (M_\\odot\\,\\mathrm{pc}^{-2})^{-n}\\,$.\n- $\\,n = 1.4\\,$.\n- 分子气体耗尽时间 $\\,t_{\\rm dep} = 2.0\\times 10^9\\,$ 年，意味着 $A_{\\rm H_2} = 10^6/t_{\\rm dep} = 5.0\\times 10^{-4}\\,$，单位为 $\\,M_\\odot\\,\\mathrm{yr}^{-1}\\,\\mathrm{kpc}^{-2}\\,(M_\\odot\\,\\mathrm{pc}^{-2})^{-1}\\,$.\n- Blitz–Rosolowsky 参数：$\\,\\alpha = 0.92\\,$，$\\,C_P = 5.0\\times 10^{-4}\\,$ 作为一个无量纲预因子，将单位为 $M_\\odot/\\mathrm{pc}^2$ 的 $\\,\\Sigma\\,$ 对映射到 $\\,P_{\\rm ext}/P_0\\,$.\n- 反馈和恒星演化：$\\,R = 0.4\\,$，$\\,V_{\\rm ref} = 200\\,\\mathrm{km}\\,\\mathrm{s}^{-1}\\,$，$\\,\\gamma = 2\\,$.\n- 主序：$\\,k_{\\rm MS} = 1.0\\times 10^{-10}\\,$，单位为 $\\,\\mathrm{yr}^{-1}\\,$，$\\,\\beta = 1.0\\,$.\n\n科学真实性和单位规范：\n- $\\,\\dot{M}_{\\rm in}\\,$ 必须以 $\\,M_\\odot/\\mathrm{yr}\\,$ 为单位，$\\,V_c\\,$ 和 $\\,V_{\\rm ref}\\,$ 必须以 $\\,\\mathrm{km}\\,\\mathrm{s}^{-1}\\,$ 为单位，$\\,A\\,$ 必须以 $\\,\\mathrm{kpc}^2\\,$ 为单位，$\\,\\Sigma\\,$ 类物理量必须以 $\\,M_\\odot/\\mathrm{pc}^2\\,$ 为单位。计算出的 $\\,\\epsilon_{\\rm fb}\\,$ 是无量纲的。\n\n测试套件：\n提供以下五个参数集以涵盖不同情况：\n- 案例 $\\,1\\,$ (理想路径): $\\dot{M}_{\\rm in} = 20.0$, $V_c = 200.0$, $A = 200.0$, $\\Sigma_\\star = 500.0$, $\\xi = 0.1$, $\\Sigma_{\\rm gas,max} = 100.0$, $M_\\star = 5.0\\times 10^{10}$.\n- 案例 $\\,2\\,$ (H$_2$ 上限起限制作用，Kennicutt–Schmidt 不起): $\\dot{M}_{\\rm in} = 15.0$, $V_c = 200.0$, $A = 200.0$, $\\Sigma_\\star = 200.0$, $\\xi = 0.1$, $\\Sigma_{\\rm gas,max} = 30.0$, $M_\\star = 5.0\\times 10^{10}$.\n- 案例 $\\,3\\,$ (两个上限都起限制作用): $\\dot{M}_{\\rm in} = 12.0$, $V_c = 220.0$, $A = 50.0$, $\\Sigma_\\star = 200.0$, $\\xi = 0.1$, $\\Sigma_{\\rm gas,max} = 30.0$, $M_\\star = 1.0\\times 10^{11}$.\n- 案例 $\\,4\\,$ (高环绕速度边界): $\\dot{M}_{\\rm in} = 30.0$, $V_c = 300.0$, $A = 200.0$, $\\Sigma_\\star = 500.0$, $\\xi = 0.1$, $\\Sigma_{\\rm gas,max} = 100.0$, $M_\\star = 5.0\\times 10^{10}$.\n- 案例 $\\,5\\,$ (低流入导致反馈在零处被截断): $\\dot{M}_{\\rm in} = 1.0$, $V_c = 200.0$, $A = 200.0$, $\\Sigma_\\star = 500.0$, $\\xi = 0.1$, $\\Sigma_{\\rm gas,max} = 100.0$, $M_\\star = 5.0\\times 10^{10}$.\n\n最终输出规范：\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，$[\\delta_1,\\delta_2,\\delta_3,\\delta_4,\\delta_5]$），其中每个 $\\,\\delta_i\\,$ 是对应测试案例的绝对差 $\\,\\Delta\\epsilon_{\\rm fb}\\,$，表示为浮点数。",
            "solution": "我们从气体调节器连续性方程 $\\,\\mathrm{d}M_{\\rm gas}/\\mathrm{d}t = \\dot{M}_{\\rm in} - (1-R)\\mathrm{SFR} - \\eta \\mathrm{SFR}\\,$ 开始。在准稳态下，将左侧设为零，得到 $\\,\\mathrm{SFR}_{\\rm eq} = \\dot{M}_{\\rm in}/(1-R+\\eta)\\,$。这是半解析星系形成模型中的标准平衡解，由质量守恒在储库变化相对于源/汇项较慢的假设下推导得出。\n\n外流质量加载因子被参数化为 $\\,\\eta = \\epsilon_{\\rm fb}(V_{\\rm ref}/V_c)^\\gamma\\,$。这里 $\\,\\epsilon_{\\rm fb}\\,$ 是在参考环绕速度 $\\,V_{\\rm ref}\\,$ 下的归一化值，$\\,\\gamma\\,$ 是一个幂律指数，捕捉了反馈强度如何随引力势阱深度变化。这种参数化被广泛使用，并由恒星风模型的经验驱动。\n\n恒星形成定律：\n- Kennicutt–Schmidt (KS): $\\,\\Sigma_{\\rm SFR} = A_{\\rm KS}\\,\\Sigma_{\\rm gas}^n\\,$. 常数 $\\,A_{\\rm KS} = 2.5\\times 10^{-4}\\,$（单位为 $\\,M_\\odot\\,\\mathrm{yr}^{-1}\\,\\mathrm{kpc}^{-2}\\, (M_\\odot\\,\\mathrm{pc}^{-2})^{-n}\\,$）和 $\\,n = 1.4\\,$ 反映了在邻近星系中观测到的标度关系。\n- 基于 H$_2$ 的定律: $\\,\\Sigma_{\\rm SFR} = A_{\\rm H_2}\\,f_{\\rm H_2}\\,\\Sigma_{\\rm gas}\\,$。我们采用分子气体耗尽时间 $\\,t_{\\rm dep} = 2.0\\times 10^9\\,$ 年，因此 $\\,A_{\\rm H_2} = 10^6/t_{\\rm dep} = 5.0\\times 10^{-4}\\,$（单位为 $\\,M_\\odot\\,\\mathrm{yr}^{-1}\\,\\mathrm{kpc}^{-2}\\,(M_\\odot\\,\\mathrm{pc}^{-2})^{-1}\\,$）。Blitz–Rosolowsky 分配使用 $\\,R_{\\rm mol} = (P_{\\rm ext}/P_0)^\\alpha\\,$，其中 $\\,\\alpha = 0.92\\,$，以及 $\\,f_{\\rm H_2} = R_{\\rm mol}/(1+R_{\\rm mol})\\,$。为了计算 $\\,P_{\\rm ext}/P_0\\,$，我们采用一个与流体静力学期望一致的无量纲压力映射：$\\,P_{\\rm ext}/P_0 = C_P\\,\\Sigma_{\\rm gas}\\,(\\Sigma_{\\rm gas}+\\xi\\Sigma_\\star)\\,$，其中 $\\,C_P = 5.0\\times 10^{-4}\\,$ 和 $\\,\\xi = \\sigma_g/\\sigma_\\star\\,$.\n\n给定一个最大气体表面密度 $\\,\\Sigma_{\\rm gas,max}\\,$ 和盘面积 $\\,A\\,$，总的恒星形成率不能超过每种定律所隐含的上限：\n- $\\,\\mathrm{SFR}_{\\rm cap,KS} = A\\,A_{\\rm KS}\\,\\Sigma_{\\rm gas,max}^n\\,$.\n- 对于 H$_2$ 定律，计算 $\\,P_{\\rm ext}/P_0 = C_P\\,\\Sigma_{\\rm gas,max}\\,(\\Sigma_{\\rm gas,max}+\\xi\\Sigma_\\star)\\,$，$\\,R_{\\rm mol} = (P_{\\rm ext}/P_0)^\\alpha\\,$，$\\,f_{\\rm H_2} = R_{\\rm mol}/(1+R_{\\rm mol})\\,$，以及 $\\,\\mathrm{SFR}_{\\rm cap,H_2} = A\\,A_{\\rm H_2}\\,f_{\\rm H_2}\\,\\Sigma_{\\rm gas,max}\\,$.\n\n恒星形成主序是 $\\,\\mathrm{SFR}_{\\rm MS} = k_{\\rm MS}\\,M_\\star^\\beta\\,$，其中 $\\,k_{\\rm MS} = 1.0\\times 10^{-10}\\,$（单位为 $\\,\\mathrm{yr}^{-1}\\,$）和 $\\,\\beta = 1.0\\,$。这在恒星质量尺度上设定了一个目标恒星形成率。\n\n为了在解耦简并性的同时交叉校准反馈归一化与恒星形成定律，我们规定可实现的恒星形成受限于上限，因此定义 $\\,\\mathrm{SFR}_{\\rm req,law} = \\min(\\mathrm{SFR}_{\\rm MS},\\mathrm{SFR}_{\\rm cap,law})\\,$。这可操作化了一个物理约束，即反馈不能强迫恒星形成率超过在允许的表面密度下由恒星形成定律所允许的最大值。将 $\\,\\mathrm{SFR}_{\\rm req,law}\\,$ 代入平衡关系即可求解 $\\,\\epsilon_{\\rm fb}$:\n$$\\epsilon_{\\rm fb,law} = \\max\\left\\{0,\\; \\frac{\\dot{M}_{\\rm in}/\\mathrm{SFR}_{\\rm req,law} - (1-R)}{(V_{\\rm ref}/V_c)^\\gamma}\\right\\}.$$\n$\\,\\max\\,$ 反映了负的反馈归一化是非物理的，因此在低流入情况下被截断为零。\n\n最后，我们感兴趣的量是绝对差 $\\,\\Delta\\epsilon_{\\rm fb} = |\\epsilon_{\\rm fb,KS} - \\epsilon_{\\rm fb,H_2}|\\,$，它衡量了在相同的流入、结构和上限条件下，推断出的反馈归一化对所假设的恒星形成定律的敏感性。当两个上限都远超主序目标时，简并性最大，$\\,\\Delta\\epsilon_{\\rm fb}\\,$ 趋于零，因为 $\\,\\epsilon_{\\rm fb}\\,$ 仅取决于所需的平衡恒星形成率。当一个或两个上限起限制作用时，两种定律将意味着不同的 $\\,\\mathrm{SFR}_{\\rm req}\\,$，因此也意味着不同的 $\\,\\epsilon_{\\rm fb}\\,$，从而量化了上限和分子分配物理学打破简并性的能力。\n\n程序的算法步骤：\n1. 对于每个测试案例，计算 $\\,\\mathrm{SFR}_{\\rm MS} = k_{\\rm MS} M_\\star^\\beta\\,$.\n2. 通过 Kennicutt–Schmidt 定律在 $\\,\\Sigma_{\\rm gas,max}\\,$ 处计算 $\\,\\mathrm{SFR}_{\\rm cap,KS}\\,$.\n3. 通过在 $\\,\\Sigma_{\\rm gas,max}\\,$ 处评估的 Blitz–Rosolowsky 分配和 H$_2$ 恒星形成定律计算 $\\,\\mathrm{SFR}_{\\rm cap,H_2}\\,$.\n4. 设置 $\\,\\mathrm{SFR}_{\\rm req,KS} = \\min(\\mathrm{SFR}_{\\rm MS},\\mathrm{SFR}_{\\rm cap,KS})\\,$ 和 $\\,\\mathrm{SFR}_{\\rm req,H_2} = \\min(\\mathrm{SFR}_{\\rm MS},\\mathrm{SFR}_{\\rm cap,H_2})\\,$.\n5. 使用带零点截断的平衡公式计算 $\\,\\epsilon_{\\rm fb,KS}\\,$ 和 $\\,\\epsilon_{\\rm fb,H_2}\\,$。所有输入均使用指定单位；得到的 $\\,\\epsilon_{\\rm fb}\\,$ 值是无量纲的。\n6. 将每个测试案例的 $\\,\\Delta\\epsilon_{\\rm fb}\\,$ 作为浮点数输出，以逗号分隔列表的形式置于方括号中，并显示在单行上。\n\n此过程测试了一个理想路径（两种定律都允许达到主序）、一个分子分配限制恒星形成但 Kennicutt–Schmidt 定律不限制的情况、一个两个上限都起限制作用的情况、一个探测对 $\\,V_c\\,$ 敏感性的情况，以及一个发生截断的低流入情况。输出值为无单位浮点数，适合于自动验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Fixed global parameters as specified in the problem statement.\nA_KS = 2.5e-4            # Kennicutt-Schmidt normalization [Msun yr^-1 kpc^-2 (Msun pc^-2)^-n]\nn_KS = 1.4               # Kennicutt-Schmidt slope\nt_dep = 2.0e9            # Molecular gas depletion time [yr]\nA_H2 = 1.0e6 / t_dep     # H2 law normalization [Msun yr^-1 kpc^-2 (Msun pc^-2)^-1]\nalpha_BR = 0.92          # Blitz-Rosolowsky exponent\nC_P = 5.0e-4             # Dimensionless prefactor mapping to P_ext/P0\nR_return = 0.4           # Instantaneous return fraction\nV_ref = 200.0            # Reference circular velocity [km/s]\ngamma = 2.0              # Feedback velocity scaling index\nk_MS = 1.0e-10           # Main sequence normalization [yr^-1]\nbeta_MS = 1.0            # Main sequence slope\n\ndef f_H2_blitz_rosolowsky(sigma_gas, sigma_star, xi):\n    \"\"\"\n    Compute molecular fraction f_H2 using Blitz–Rosolowsky pressure partition.\n    Inputs:\n        sigma_gas  : gas surface density [Msun/pc^2]\n        sigma_star : stellar surface density [Msun/pc^2]\n        xi         : velocity dispersion ratio sigma_g / sigma_*\n    Returns:\n        f_H2       : molecular fraction (unitless)\n    \"\"\"\n    # External pressure ratio P_ext/P0 using dimensionless mapping\n    p_ratio = C_P * sigma_gas * (sigma_gas + xi * sigma_star)\n    # Molecular-to-atomic ratio\n    R_mol = p_ratio ** alpha_BR\n    # Molecular fraction\n    f_h2 = R_mol / (1.0 + R_mol)\n    return f_h2\n\ndef sfr_cap_ks(area_kpc2, sigma_gas_max):\n    \"\"\"\n    SFR cap under Kennicutt-Schmidt law at given maximum gas surface density.\n    \"\"\"\n    sigma_sfr = A_KS * (sigma_gas_max ** n_KS)\n    return area_kpc2 * sigma_sfr  # [Msun/yr]\n\ndef sfr_cap_h2(area_kpc2, sigma_gas_max, sigma_star, xi):\n    \"\"\"\n    SFR cap under H2-based law at given maximum gas surface density.\n    \"\"\"\n    f_h2 = f_H2_blitz_rosolowsky(sigma_gas_max, sigma_star, xi)\n    sigma_sfr = A_H2 * f_h2 * sigma_gas_max\n    return area_kpc2 * sigma_sfr  # [Msun/yr]\n\ndef epsilon_fb_required(mdot_in, sfr_req, Vc):\n    \"\"\"\n    Compute required feedback normalization epsilon_fb given required SFR,\n    inflow rate, and circular velocity, with non-negativity clipping.\n    \"\"\"\n    # Avoid division by zero in pathological cases\n    if sfr_req == 0.0:\n        return 0.0\n    factor = (V_ref / Vc) ** gamma\n    eps = (mdot_in / sfr_req) - (1.0 - R_return)\n    eps /= factor\n    # Non-negative clipping\n    eps = max(0.0, eps)\n    return eps\n\ndef main():\n    # Define the test cases as specified: (mdot_in, Vc, A_kpc2, Sigma_star, xi, Sigma_gas_max, M_star)\n    test_cases = [\n        (20.0, 200.0, 200.0, 500.0, 0.1, 100.0, 5.0e10),   # Case 1\n        (15.0, 200.0, 200.0, 200.0, 0.1, 30.0, 5.0e10),    # Case 2\n        (12.0, 220.0, 50.0, 200.0, 0.1, 30.0, 1.0e11),     # Case 3\n        (30.0, 300.0, 200.0, 500.0, 0.1, 100.0, 5.0e10),   # Case 4\n        (1.0, 200.0, 200.0, 500.0, 0.1, 100.0, 5.0e10),    # Case 5\n    ]\n\n    results = []\n    for (mdot_in, Vc, area_kpc2, sigma_star, xi, sigma_gas_max, M_star) in test_cases:\n        # Main sequence target SFR\n        sfr_ms = k_MS * (M_star ** beta_MS)\n\n        # Caps from both laws\n        cap_ks = sfr_cap_ks(area_kpc2, sigma_gas_max)\n        cap_h2 = sfr_cap_h2(area_kpc2, sigma_gas_max, sigma_star, xi)\n\n        # Required SFRs under each law\n        sfr_req_ks = min(sfr_ms, cap_ks)\n        sfr_req_h2 = min(sfr_ms, cap_h2)\n\n        # Required feedback normalizations\n        eps_ks = epsilon_fb_required(mdot_in, sfr_req_ks, Vc)\n        eps_h2 = epsilon_fb_required(mdot_in, sfr_req_h2, Vc)\n\n        # Absolute difference\n        diff = abs(eps_ks - eps_h2)\n        results.append(diff)\n\n    # Final print in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    main()\n```"
        }
    ]
}