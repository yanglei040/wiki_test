{
    "hands_on_practices": [
        {
            "introduction": "在模拟星系形成时，一个核心挑战是“过度冷却问题”（overcooling problem），即注入的反馈能量在对气体产生流体动力学影响之前，就在数值上通过辐射损失掉了。本练习将引导你推导一个无量纲参数 $\\Pi$，该参数通过比较局部的冷却时间尺度和声波跨越时间尺度来预测这种数值效应的发生 。通过编程实现并对照受控模拟来验证该判据，你将获得诊断数值反馈模型中最基本问题之一的实践经验。",
            "id": "3491443",
            "problem": "考虑在数值宇宙学中用于超新星（SN）和活动星系核（AGN）反馈的次网格模型中的理想化单区能量注入事件。单个流体动力学分辨率单元（边长为 $\\Delta x$ 的立方单元）接收一次瞬时热能注入。我们希望通过比较辐射冷却和流体动力学响应的时间尺度，来定义一个能够预测数值过冷现象开始的无量纲参数。您的任务是推导、实现并验证这样一个参数。\n\n从基本原理和广为接受的近似出发：\n\n- 使用理想气体内能关系和声速，对于绝热指数 $\\gamma = 5/3$ 的单原子理想气体。假设气体已电离，平均分子量 $\\mu = 0.6$。\n- 使用温度 $T$ 的定义，该温度是在将能量 $E$ 瞬时注入到体积为 $V = \\Delta x^3$、氢数密度为 $n$ 的单元后得到的，并假设所有能量 $E$ 都转化为热内能。\n- 使用声波穿越分辨率单元 $\\Delta x$ 的时间 $t_{\\mathrm{sc}}$ 的定义：声速为 $c_s = \\sqrt{\\gamma k_B T / (\\mu m_p)}$，其中 $k_B$ 是玻尔兹曼常数，$m_p$ 是质子质量。声波穿越时间为 $t_{\\mathrm{sc}} = \\Delta x / c_s$。\n- 使用等容极限下的光学薄辐射冷却时间 $t_{\\mathrm{cool}} = \\dfrac{(3/2) n k_B T}{n_e n_i \\Lambda(T)}$。对于完全电离的氢，假设 $n_e \\approx n_i \\approx n$，因此 $n_e n_i \\approx n^2$。辐射冷却函数是 $\\Lambda(T)$，单位为 $\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n\n将无量纲参数 $\\Pi$ 定义为注入能量、气体密度、网格尺度和冷却函数的函数：\n$$\n\\Pi \\equiv \\frac{t_{\\mathrm{cool}}}{t_{\\mathrm{sc}}}.\n$$\n$\\Pi  1$ 的值表示冷却时间短于流体动力学在分辨率单元上的响应时间，预示着数值过冷现象的开始。\n\n通过受控能量注入测试进行验证的方案：\n- 在纯辐射损失下，将单区内能 $E(t)$ 演化一个初始声波穿越时间 $t_{\\mathrm{sc}}$ 的时长，其中\n$$\n\\frac{dE}{dt} = - n^2 \\Lambda(T) V,\n$$\n并使用热力学闭合关系\n$$\nE = \\frac{3}{2} n V k_B T \\quad \\Rightarrow \\quad T(E) = \\frac{2 E}{3 n V k_B}.\n$$\n- 如果在一个初始声波穿越时间后，保留的能量分数小于二分之一，即 $E(t_{\\mathrm{sc}})/E(0)  1/2$，则将该演化分类为“过冷”。\n- 将此测量分类与基于 $\\Pi$ 的预测进行比较：当且仅当 $\\Pi  1$ 时，预测为过冷。\n\n采用以下常数和单位约定：\n- 对所有物理量使用 cgs 单位制：$E$ 的单位为 $\\mathrm{erg}$，$n$ 的单位为 $\\mathrm{cm^{-3}}$，$\\Delta x$ 的单位为 $\\mathrm{pc}$（使用 $1\\,\\mathrm{pc} = 3.08567758\\times 10^{18}\\,\\mathrm{cm}$ 换算为 $\\mathrm{cm}$），$k_B = 1.380649\\times 10^{-16}\\,\\mathrm{erg\\,K^{-1}}$，$m_p = 1.67262192369\\times 10^{-24}\\,\\mathrm{g}$，$\\mu = 0.6$，以及 $\\gamma = 5/3$。\n- 对冷却函数 $\\Lambda(T)$（完全电离，近太阳金属丰度，光学薄）使用以下分段解析近似，该近似在各区间连续，且对 $T \\ge 10^{4}\\,\\mathrm{K}$ 有效：\n  - 对于 $10^{4}\\,\\mathrm{K} \\le T  10^{5}\\,\\mathrm{K}$：$\\Lambda(T) = 10^{-22}\\,\\left(\\dfrac{T}{10^{5}\\,\\mathrm{K}}\\right)^{1/2}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n  - 对于 $10^{5}\\,\\mathrm{K} \\le T \\le 10^{7}\\,\\mathrm{K}$：$\\Lambda(T) = 2\\times 10^{-23}\\,\\left(\\dfrac{T}{10^{6}\\,\\mathrm{K}}\\right)^{-0.7}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n  - 对于 $T > 10^{7}\\,\\mathrm{K}$：$\\Lambda(T) = 10^{-23}\\,\\left(\\dfrac{T}{10^{7}\\,\\mathrm{K}}\\right)^{1/2}\\,\\mathrm{erg\\,cm^3\\,s^{-1}}$。\n为保证数值稳定性，您应在 $\\Lambda(T)$ 内部强制设置一个 $T \\ge 10^{4}\\,\\mathrm{K}$ 的下限。\n\n数值积分要求：\n- 在 $[0, t_{\\mathrm{sc}}]$ 区间内，使用固定时间步长和稳定方法对 $E(t)$ 的常微分方程进行积分。使用至少 $N = 10^{4}$ 个等长步长的四阶显式龙格－库塔方法，以确保在这些测试案例中收敛。\n- 使用初始温度 $T(0)$ 来计算 $t_{\\mathrm{sc}}$；在演化过程中保持 $\\Delta x$ 不变。\n\n测试套件：\n实现您的程序以评估以下四个受控能量注入测试。对每个测试，计算无量纲参数 $\\Pi$，执行单区演化，并返回一个布尔值，表示基于 $\\Pi$ 的预测是否与测量的分类一致。所有输入均以 $(E, n, \\Delta x)$ 的形式列出：\n\n1. 稠密气体中的超新星，粗分辨率（预期过冷）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 10\\,\\mathrm{cm^{-3}},\\; \\Delta x = 100\\,\\mathrm{pc})$。\n2. 稀疏气体中的超新星，高分辨率（预期不过冷）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 1\\,\\mathrm{cm^{-3}},\\; \\Delta x = 1\\,\\mathrm{pc})$。\n3. 簇内介质中的活动星系核（AGN）气泡（预期不过冷）：$(E = 10^{57}\\,\\mathrm{erg},\\; n = 10^{-3}\\,\\mathrm{cm^{-3}},\\; \\Delta x = 1000\\,\\mathrm{pc})$。\n4. 近阈值超新星案例（临界分辨率）：$(E = 10^{51}\\,\\mathrm{erg},\\; n = 1\\,\\mathrm{cm^{-3}},\\; \\Delta x = 60\\,\\mathrm{pc})$。\n\n最终输出规范：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，且无空格。每个条目必须是一个布尔值，当且仅当该测试案例中基于 $\\Pi$ 的过冷预测与测量的分类匹配时，该布尔值为真，顺序与上面列出的顺序相同。例如：\"[True,False,True,True]\"。",
            "solution": "该问题要求推导并验证一个无量纲参数 $\\Pi$，此参数旨在预测天体物理反馈模拟中数值过冷现象的发生。当单个分辨率单元内的辐射冷却时间尺度短于流体动力学响应时间时，便会发生此现象，导致注入的能量在对周围气体做机械功之前就被辐射掉。\n\n首先，我们根据问题的基本物理参数——注入的能量 $E$、环境氢数密度 $n$ 和网格单元大小 $\\Delta x$——来推导 $\\Pi$ 的表达式。\n\n无量纲参数 $\\Pi$ 定义为冷却时间 $t_{\\mathrm{cool}}$ 与声波穿越时间 $t_{\\mathrm{sc}}$ 的比值：\n$$\n\\Pi \\equiv \\frac{t_{\\mathrm{cool}}}{t_{\\mathrm{sc}}}\n$$\n\n声波穿越时间 $t_{\\mathrm{sc}}$ 是声波穿过大小为 $\\Delta x$ 的分辨率单元所需的时间。它由下式给出：\n$$\nt_{\\mathrm{sc}} = \\frac{\\Delta x}{c_s}\n$$\n其中 $c_s$ 是气体中的声速。对于绝热指数 $\\gamma = 5/3$、平均分子量 $\\mu = 0.6$ 的单原子理想气体，声速为：\n$$\nc_s = \\sqrt{\\frac{\\gamma k_B T}{\\mu m_p}}\n$$\n此处，$k_B$ 是玻尔兹曼常数，$T$ 是温度，$m_p$ 是质子质量。在将热能 $E$ 瞬时注入体积为 $V = \\Delta x^3$ 的立方单元后，其温度 $T$ 由理想气体内能关系确定：\n$$\nE = \\frac{3}{2} n V k_B T = \\frac{3}{2} n (\\Delta x)^3 k_B T\n$$\n解出 $T$，我们得到初始温度 $T_0$：\n$$\nT_0 = \\frac{2 E}{3 n (\\Delta x)^3 k_B}\n$$\n将 $T_0$ 的表达式代入 $c_s$ 的公式，我们可以用主要变量表示初始声波穿越时间 $t_{\\mathrm{sc},0}$：\n$$\nt_{\\mathrm{sc},0} = \\frac{\\Delta x}{\\sqrt{\\frac{\\gamma k_B}{\\mu m_p} \\left( \\frac{2 E}{3 n (\\Delta x)^3 k_B} \\right)}} = \\frac{\\Delta x}{\\sqrt{\\frac{2 \\gamma E}{3 n (\\Delta x)^3 \\mu m_p}}} = \\Delta x \\sqrt{\\frac{3 n (\\Delta x)^3 \\mu m_p}{2 \\gamma E}} = (\\Delta x)^{5/2} \\sqrt{\\frac{3 n \\mu m_p}{2 \\gamma E}}\n$$\n\n接下来，我们推导初始冷却时间 $t_{\\mathrm{cool},0}$。它被定义为热能密度与单位体积辐射冷却率之比。对于等容过程：\n$$\nt_{\\mathrm{cool}} = \\frac{(3/2) n k_B T}{n_e n_i \\Lambda(T)}\n$$\n其中 $\\Lambda(T)$ 是辐射冷却函数。对于完全电离的氢气，电子和离子的数密度约等于氢数密度，即 $n_e \\approx n_i \\approx n$。热能密度 $(3/2) n k_B T$ 恰好是总能量 $E$ 除以体积 $V = (\\Delta x)^3$。因此，初始冷却时间为：\n$$\nt_{\\mathrm{cool},0} = \\frac{E/V}{n^2 \\Lambda(T_0)} = \\frac{E}{(\\Delta x)^3 n^2 \\Lambda(T_0)}\n$$\n\n现在我们可以通过将 $t_{\\mathrm{cool},0}$ 除以 $t_{\\mathrm{sc},0}$ 来构成无量纲参数 $\\Pi$：\n$$\n\\Pi = \\frac{t_{\\mathrm{cool},0}}{t_{\\mathrm{sc},0}} = \\frac{E / ((\\Delta x)^3 n^2 \\Lambda(T_0))}{(\\Delta x)^{5/2} \\sqrt{3 n \\mu m_p / (2 \\gamma E)}} = \\frac{E}{n^2 (\\Delta x)^{11/2} \\Lambda(T_0)} \\sqrt{\\frac{2 \\gamma E}{3 n \\mu m_p}}\n$$\n$$\n\\Pi = \\frac{E^{3/2}}{n^{5/2} (\\Delta x)^{11/2} \\Lambda(T_0)} \\sqrt{\\frac{2 \\gamma}{3 \\mu m_p}}\n$$\n$\\Pi  1$ 的值表明冷却过程主导了流体动力学过程，导致数值过冷。\n\n为了验证这一判据，我们按规定进行数值实验。我们求解在纯辐射损失下内能 $E(t)$ 演化的常微分方程（ODE）：\n$$\n\\frac{dE}{dt} = -n^2 \\Lambda(T(E)) V\n$$\n其中温度 $T$ 在任何时刻都通过热力学闭合关系与能量 $E$ 相关联：\n$$\nT(E) = \\frac{2 E}{3 n V k_B}\n$$\n此 ODE 从 $t=0$ 积分到 $t=t_{\\mathrm{sc},0}$（初始声波穿越时间）。我们使用四阶显式龙格－库塔（RK4）方法，总共 $N=10^4$ 个固定时间步长，$\\Delta t = t_{\\mathrm{sc},0}/N$。对于给定的时间步 $i$，能量从 $E_i$ 更新到 $E_{i+1}$ 的过程如下，其中 $f(E) = dE/dt$：\n$$\nk_1 = \\Delta t \\cdot f(E_i)\n$$\n$$\nk_2 = \\Delta t \\cdot f(E_i + 0.5 k_1)\n$$\n$$\nk_3 = \\Delta t \\cdot f(E_i + 0.5 k_2)\n$$\n$$\nk_4 = \\Delta t \\cdot f(E_i + k_3)\n$$\n$$\nE_{i+1} = E_i + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\n积分到 $t=t_{\\mathrm{sc},0}$ 以求得最终能量 $E(t_{\\mathrm{sc},0})$ 后，如果保留的能量分数小于二分之一，我们就将该演化分类为“测量的过冷”：\n$$\n\\frac{E(t_{\\mathrm{sc},0})}{E(0)}  \\frac{1}{2}\n$$\n每个测试案例的验证包括检查预测（如果 $\\Pi  1$ 则为过冷，如果 $\\Pi \\ge 1$ 则无过冷）是否与数值实验的分类相匹配。\n\n分段冷却函数 $\\Lambda(T)$ 按规定实现，温度下限为 $T=10^4\\,\\mathrm{K}$。所有计算均以 cgs 单位制进行。所提供的测试案例将根据此程序进行评估。最终输出是一个布尔值列表，其中如果 $\\Pi$ 的预测与相应测试案例的测量结果一致，则该条目为 `True`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and validates a dimensionless parameter for numerical\n    overcooling in astrophysical simulations.\n    \"\"\"\n\n    # Physical constants in cgs units\n    K_B = 1.380649e-16  # Boltzmann constant in erg/K\n    M_P = 1.67262192369e-24  # Proton mass in g\n    PC_TO_CM = 3.08567758e18  # Parsec to cm conversion\n\n    # Gas properties\n    GAMMA = 5.0 / 3.0  # Adiabatic index for monatomic gas\n    MU = 0.6  # Mean molecular weight for ionized gas\n\n    def lambda_cooling_func(T):\n        \"\"\"\n        Calculates the radiative cooling function Lambda(T) in erg cm^3 s^-1.\n        The function is a piecewise power-law approximation.\n        A temperature floor of 1e4 K is enforced.\n        \"\"\"\n        T_eff = np.maximum(T, 1.0e4)\n\n        if T_eff  1.0e5:\n            return 1.0e-22 * np.sqrt(T_eff / 1.0e5)\n        elif T_eff = 1.0e7:\n            return 2.0e-23 * (T_eff / 1.0e6)**(-0.7)\n        else:  # T_eff > 1.0e7\n            return 1.0e-23 * np.sqrt(T_eff / 1.0e7)\n\n    def run_simulation(E_init, n, delta_x_pc):\n        \"\"\"\n        Runs a single simulation case to compare the Pi-based prediction\n        with the measured overcooling outcome.\n        \"\"\"\n        # --- Convert units and calculate cell volume ---\n        delta_x_cm = delta_x_pc * PC_TO_CM\n        V = delta_x_cm**3\n\n        # --- Calculate initial state and Pi parameter ---\n        # Initial Temperature\n        T_0 = (2.0 * E_init) / (3.0 * n * V * K_B)\n        \n        # Initial cooling function value\n        lambda_0 = lambda_cooling_func(T_0)\n        \n        # Initial cooling time\n        if lambda_0 > 0:\n            t_cool_0 = E_init / (n**2 * V * lambda_0)\n        else:\n            t_cool_0 = np.inf\n\n        # Initial sound speed\n        c_s_0 = np.sqrt(GAMMA * K_B * T_0 / (MU * M_P))\n        \n        # Initial sound crossing time\n        t_sc_0 = delta_x_cm / c_s_0\n        \n        # Dimensionless parameter Pi\n        Pi = t_cool_0 / t_sc_0\n\n        # Prediction based on Pi\n        predicted_overcooling = (Pi  1.0)\n        \n        # --- Perform numerical integration using RK4 ---\n        N_steps = 10000\n        dt = t_sc_0 / N_steps\n        \n        E_current = E_init\n\n        # Define the ODE function dE/dt = f(E)\n        def dE_dt(E):\n            if E = 0:\n                return 0.0\n            T_current = (2.0 * E) / (3.0 * n * V * K_B)\n            lambda_val = lambda_cooling_func(T_current)\n            return -n**2 * V * lambda_val\n\n        for _ in range(N_steps):\n            k1 = dt * dE_dt(E_current)\n            k2 = dt * dE_dt(E_current + 0.5 * k1)\n            k3 = dt * dE_dt(E_current + 0.5 * k2)\n            k4 = dt * dE_dt(E_current + k3)\n            E_current += (k1 + 2*k2 + 2*k3 + k4) / 6.0\n            if E_current  0:\n                 E_current = 0\n                 break # Energy fully radiated away\n\n        E_final = E_current\n\n        # Measurement from simulation\n        measured_overcooling = (E_final / E_init)  0.5\n        \n        # Compare prediction and measurement\n        return predicted_overcooling == measured_overcooling\n\n    # Test suite: (E [erg], n [cm^-3], delta_x [pc])\n    test_cases = [\n        # 1. Supernova in dense gas, coarse resolution\n        (1.0e51, 10.0, 100.0),\n        # 2. Supernova in diffuse gas, fine resolution\n        (1.0e51, 1.0, 1.0),\n        # 3. AGN bubble in intracluster medium\n        (1.0e57, 1.0e-3, 1000.0),\n        # 4. Near-threshold supernova case\n        (1.0e51, 1.0, 60.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        E, n, dx = case\n        agreement = run_simulation(E, n, dx)\n        results.append(agreement)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "有效的次网格模型必须概括未解析的物理过程，例如在分配反馈能量中起着关键作用的湍流。本练习要求你在一个分层介质中，通过平衡来自反馈的能量注入、湍流耗散以及浮力汇，来构建一个湍动能的单区次网格模型 。通过求解稳态湍流水平，你将学到构建和分析物理闭合关系的基本过程，而这些闭合关系正是现代反馈模型实现的核心支柱。",
            "id": "3491461",
            "problem": "您将为一维分层盒子中的比湍动能 $k$ 设计并实现一个最小的亚格子模型。该盒子具有恒定的重力加速度 $g$，并由超新星（SN）和活动星系核（AGN）的体积能量注入驱动。该模型应在中心平面 $z=0$ 处通过求解 $k$ 的稳态值进行验证，求解过程基于以下假设。\n\n作为基础出发点的模型假设：\n- 气体是等温的，声速为 $c_s$，中心平面密度为 $\\rho_0$，在恒定的重力加速度 $g$ 下处于流体静力平衡状态，因此特征等温压力标高为 $H = c_s^2/g$。\n- 亚格子混合长度建模为 $\\ell = \\alpha H$，其中 $\\alpha$ 是一个无量纲常数参数。\n- 在 $z=0$ 处，一部分超新星体积能量注入率 $e_{\\mathrm{SN},0}$（比例为 $f_{\\mathrm{SN}}$）和一部分活动星系核体积能量注入率 $e_{\\mathrm{AGN},0}$（比例为 $f_{\\mathrm{AGN}}$）被转化为亚格子湍流能量。相应的比湍流能量注入率为 $S = \\left(f_{\\mathrm{SN}} e_{\\mathrm{SN},0} + f_{\\mathrm{AGN}} e_{\\mathrm{AGN},0}\\right)/\\rho_0$。\n- 湍流能量的耗散遵循柯尔莫哥洛夫标度闭合关系 $\\varepsilon = C_\\varepsilon k^{3/2}/\\ell$，其中 $C_\\varepsilon$ 是一个数量级为1的常数。\n- 稳定分层引起一个浮力汇，建模为 $B = - C_b (g/c_s) k$，其中 $C_b$ 是一个无量纲常数。\n\n从湍动能收支方程出发，并忽略中心平面的平流作用，通过平衡产生项和汇项来施加稳态条件 $\\partial_t k = 0$（在 $z=0$ 处）。仅使用上述定义，为 $k \\ge 0$ 推导出一个可解的代数条件。\n\n您的程序必须对下面的每个测试用例，计算出满足上述闭合关系所隐含的稳态平衡的中心平面稳态值 $k$（单位为 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$）。计算需满足约束条件 $k \\ge 0$，且物理上相关的解是所隐含的稳态方程的唯一非负实根。\n\n全程使用的物理单位：\n- $g$ 单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-2}$，\n- $c_s$ 单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$，\n- $\\rho_0$ 单位为 $\\mathrm{g}\\,\\mathrm{cm}^{-3}$，\n- $e_{\\mathrm{SN},0}$ 和 $e_{\\mathrm{AGN},0}$ 单位为 $\\mathrm{erg}\\,\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$，\n- $k$ 单位为 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$。\n\n所有测试用例共享的常数：\n- $\\alpha = 0.5$，\n- $C_\\varepsilon = 1.0$，\n- $C_b = 0.5$。\n\n测试组参数集（每个用例给出的元组为 $(g, c_s, \\rho_0, e_{\\mathrm{SN},0}, f_{\\mathrm{SN}}, e_{\\mathrm{AGN},0}, f_{\\mathrm{AGN}})$）：\n1. 用例A（超新星主导的暖盘）： $(g = 2.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 1.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.10,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n2. 用例B（AGN主导的热晕）： $(g = 1.0\\times 10^{-8},\\ c_s = 1.0\\times 10^{7},\\ \\rho_0 = 1.0\\times 10^{-26},\\ e_{\\mathrm{SN},0} = 0.0,\\ f_{\\mathrm{SN}} = 0.0,\\ e_{\\mathrm{AGN},0} = 1.0\\times 10^{-25},\\ f_{\\mathrm{AGN}} = 0.30)$。\n3. 用例C（联合驱动）： $(g = 5.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 5.0\\times 10^{-25},\\ e_{\\mathrm{SN},0} = 3.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.20,\\ e_{\\mathrm{AGN},0} = 1.0\\times 10^{-25},\\ f_{\\mathrm{AGN}} = 0.05)$。\n4. 用例D（无源边界情况）： $(g = 2.0\\times 10^{-9},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 0.0,\\ f_{\\mathrm{SN}} = 0.0,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n5. 用例E（强引力抑制）： $(g = 3.0\\times 10^{-8},\\ c_s = 1.0\\times 10^{6},\\ \\rho_0 = 1.67\\times 10^{-24},\\ e_{\\mathrm{SN},0} = 1.0\\times 10^{-26},\\ f_{\\mathrm{SN}} = 0.10,\\ e_{\\mathrm{AGN},0} = 0.0,\\ f_{\\mathrm{AGN}} = 0.0)$。\n\n数值要求：\n- 对于每个用例，使用给定的 $g$ 和 $c_s$ 计算 $H = c_s^2/g$ 和 $\\ell = \\alpha H$。\n- 构建由上述闭合关系所隐含的稳态方程，并求解唯一的非负实数解 $k$。\n- 将每个得到的 $k$ 以 $\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$ 为单位表示，并四舍五入到三位有效数字。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按顺序排列的五个四舍五入后的值，形式为用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是一个四舍五入到三位有效数字的浮点数。不允许有任何额外的字符或空格。",
            "solution": "该问题已经过验证，被认为是合理的。这是一个应用物理学中定义明确的问题，基于天体物理流体动力学中使用的标准（尽管是简化的）模型。所有必要的参数和定义都已提供，没有发现内部矛盾或科学谬误。因此，我们可以进行正式求解。\n\n该问题要求解在分层环境的中心平面（$z=0$）处，比湍动能 $k$ 的稳态值。$k$ 的演化由一个平衡源项和汇项的收支方程控制。忽略中心平面的平流，收支方程为：\n$$\n\\frac{\\partial k}{\\partial t} = S - \\varepsilon - \\Lambda_B\n$$\n其中 $S$ 是比湍流能量注入率，$\\varepsilon$ 是湍流耗散率，而 $\\Lambda_B$ 是浮力汇项。\n\n根据问题陈述，这些项的建模如下：\n$1$. 比湍流能量注入率 $S$ 结合了来自超新星（SN）和活动星系核（AGN）的贡献：\n$$\nS = \\frac{f_{\\mathrm{SN}} e_{\\mathrm{SN},0} + f_{\\mathrm{AGN}} e_{\\mathrm{AGN},0}}{\\rho_0}\n$$\n其中 $e_{\\mathrm{SN},0}$ 和 $e_{\\mathrm{AGN},0}$ 是体积能量注入率，$f_{\\mathrm{SN}}$ 和 $f_{\\mathrm{AGN}}$ 分别是耦合效率，$\\rho_0$ 是中心平面气体密度。\n\n$2$. 湍流耗散率 $\\varepsilon$ 遵循类似柯尔莫哥洛夫的标度关系：\n$$\n\\varepsilon = \\frac{C_\\varepsilon k^{3/2}}{\\ell}\n$$\n其中 $C_\\varepsilon$ 是一个无量纲常数，$\\ell$ 是亚格子混合长度。\n\n$3$. 问题定义了一个浮力项 $B = - C_b (g/c_s) k$。由于该项必须作为汇项，它对能量收支的贡献为负。汇项是 $\\Lambda_B = -B = C_b (g/c_s) k$。因此，问题陈述中写的项 $B$ 是汇项的负值，代表由浮力引起的 $k$ 的变化率。收支方程可以写成 $\\partial_t k = S - \\varepsilon + B$。代入 $B$ 的模型：\n$$\n\\frac{\\partial k}{\\partial t} = S - \\frac{C_\\varepsilon k^{3/2}}{\\ell} - C_b \\frac{g}{c_s} k\n$$\n这个公式与物理直觉一致，因为耗散和稳定分层（浮力）都会抑制湍流。\n\n混合长度 $\\ell$ 与等温压力标高 $H$ 的关系为 $\\ell = \\alpha H$，其中 $\\alpha$ 是一个无量纲参数。标高定义为 $H = c_s^2/g$，其中 $c_s$ 是等温声速，g 是重力加速度。代入这些定义，我们得到：\n$$\n\\ell = \\alpha \\frac{c_s^2}{g}\n$$\n在稳态条件下，$\\partial k / \\partial t = 0$，源项和汇项必须平衡：\n$$\nS - \\frac{C_\\varepsilon k^{3/2}}{\\alpha c_s^2 / g} - C_b \\frac{g}{c_s} k = 0\n$$\n整理各项，我们得到一个关于 $k$ 的方程：\n$$\n\\frac{C_\\varepsilon g}{\\alpha c_s^2} k^{3/2} + C_b \\frac{g}{c_s} k = S\n$$\n为了解这个方程，引入变量 $x = \\sqrt{k}$ 会很方便。因为 $k$ 代表比动能，它必须是非负的，所以我们寻找 $x \\ge 0$ 的解。用 $x$ 表示，该方程变成一个三次多项式：\n$$\n\\left(\\frac{C_\\varepsilon g}{\\alpha c_s^2}\\right) x^3 + \\left(C_b \\frac{g}{c_s}\\right) x^2 - S = 0\n$$\n该方程具有一般形式 $P_3 x^3 + P_2 x^2 + P_1 x + P_0 = 0$，其系数为：\n- $P_3 = \\frac{C_\\varepsilon g}{\\alpha c_s^2}$\n- $P_2 = C_b \\frac{g}{c_s}$\n- $P_1 = 0$\n- $P_0 = -S$\n\n物理参数 $g, c_s, \\alpha, C_\\varepsilon, C_b$ 都是正常数。因此，系数 $P_3$ 和 $P_2$ 严格为正。源项 $S$ 是非负的（$S \\ge 0$），所以 $P_0 \\le 0$。\n\n我们来分析函数 $f(x) = P_3 x^3 + P_2 x^2 - S$。它的导数是 $f'(x) = 3 P_3 x^2 + 2 P_2 x$。由于 $P_3 > 0$ 且 $P_2 > 0$，对于所有 $x > 0$，$f'(x) > 0$。这意味着对于 $x \\ge 0$，$f(x)$ 是一个严格单调递增的函数。\n在 $x=0$ 处，我们有 $f(0) = -S$。\n- 如果 $S=0$，则 $f(0)=0$，因此 $x=0$ 是唯一的非负根。这对应于 $k=0$，即没有能量注入时的物理预期结果。\n- 如果 $S > 0$，则 $f(0) = -S  0$。由于 $f(x)$ 是连续的、单调的，且 $\\lim_{x\\to\\infty} f(x) = \\infty$，根据介值定理，可以保证存在且仅存在一个正实根 $x_{sol} > 0$。\n\n对于每个测试用例，我们将使用给定的参数计算系数 $P_3$、$P_2$ 和 $P_0 = -S$。然后我们将解这个三次方程以求其根。唯一的非负实根 $x_{sol}$ 将被平方以求得稳态湍动能 $k = x_{sol}^2$。最终值将四舍五入到三位有效数字。\n\n所有用例的共享常数为 $\\alpha = 0.5$，$C_\\varepsilon = 1.0$ 和 $C_b = 0.5$。将对每个测试用例实施以下步骤：\n$1$. 根据给定参数计算源项 $S$。\n$2$. 如果 $S=0$，解为 $k=0\\,\\mathrm{cm}^2\\,\\mathrm{s}^{-2}$。\n$3$. 如果 $S>0$，计算多项式系数 $P_3$ 和 $P_2$。\n$4$. 数值求解三次多项式 $P_3 x^3 + P_2 x^2 - S = 0$ 的根。\n$5$. 确定唯一的非负实根 $x_{sol}$。\n$6$. 计算 $k = x_{sol}^2$。\n$7$. 将 $k$ 的结果四舍五入到三位有效数字，并在最终输出中呈现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the steady-state midplane turbulent kinetic energy k for a series of test cases.\n    \"\"\"\n    # Shared constants from the problem statement.\n    ALPHA = 0.5\n    C_EPS = 1.0\n    C_B = 0.5\n\n    # Test suite parameter sets:\n    # (g, c_s, rho_0, e_SN,0, f_SN, e_AGN,0, f_AGN)\n    test_cases = [\n        # Case A (SN-dominated warm disk)\n        (2.0e-9, 1.0e6, 1.67e-24, 1.0e-26, 0.10, 0.0, 0.0),\n        # Case B (AGN-dominated hot halo)\n        (1.0e-8, 1.0e7, 1.0e-26, 0.0, 0.0, 1.0e-25, 0.30),\n        # Case C (combined driving)\n        (5.0e-9, 1.0e6, 5.0e-25, 3.0e-26, 0.20, 1.0e-25, 0.05),\n        # Case D (no sources boundary case)\n        (2.0e-9, 1.0e6, 1.67e-24, 0.0, 0.0, 0.0, 0.0),\n        # Case E (strong gravity suppression)\n        (3.0e-8, 1.0e6, 1.67e-24, 1.0e-26, 0.10, 0.0, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        g, c_s, rho_0, e_sn_0, f_sn, e_agn_0, f_agn = case\n\n        # Calculate the specific turbulent energy injection rate S.\n        # Erg = g * cm^2 / s^2. S has units of cm^2/s^3.\n        s_term = (f_sn * e_sn_0 + f_agn * e_agn_0) / rho_0\n\n        if s_term == 0:\n            # If there are no sources, the turbulent kinetic energy is zero.\n            k_val = 0.0\n        else:\n            # Set up the cubic equation for x = sqrt(k): P3*x^3 + P2*x^2 - S = 0\n            # P3 = (C_epsilon * g) / (alpha * c_s^2)\n            # P2 = C_b * g / c_s\n            # P1 = 0\n            # P0 = -S\n            \n            p3 = (C_EPS * g) / (ALPHA * c_s**2)\n            p2 = (C_B * g) / c_s\n            p1 = 0.0\n            p0 = -s_term\n            \n            coeffs = [p3, p2, p1, p0]\n            \n            # Find the roots of the polynomial.\n            roots = np.roots(coeffs)\n            \n            # Find the unique non-negative real root for x = sqrt(k).\n            x_sol = None\n            for root in roots:\n                if np.isreal(root) and root.real >= 0:\n                    x_sol = root.real\n                    break\n            \n            if x_sol is None:\n                # This should not happen based on the problem analysis.\n                # Raise an error for robustness.\n                raise ValueError(\"No non-negative real root found.\")\n\n            # Calculate k from x.\n            k_val = x_sol**2\n\n        # Format the result to 3 significant figures.\n        # The 'g' format specifier handles general number formatting,\n        # switching to scientific notation for large/small numbers.\n        if k_val == 0.0:\n            formatted_k = '0.0'\n        else:\n            formatted_k = format(k_val, '.3g')\n        results.append(formatted_k)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "次网格模型的数值实现与其物理模型本身同等重要，因为积分方案的选择会引入显著的偏差。本练习通过分析算子分裂（operator splitting）——一种集成复杂物理过程的常用技术——的影响，探讨更新顺序和时间步长如何影响能量守恒和最终的风速 。通过将数值结果与精确的解析解进行比较，你将对耦合反馈的实际挑战以及精细算法设计的重要性获得关键的洞察。",
            "id": "3491413",
            "problem": "考虑一个用于数值宇宙学中反馈耦合的单区亚格子模型，其中由超新星 (SN) 和活动星系核 (AGN) 反馈驱动的风被建模为一个速度为 $v(t)$、质量为 $m$ 的单一气团。反馈表示为在有限持续时间 $T_{\\mathrm{inj}}$ 内均匀提供的恒定能量注入率（功率）$L$。与周围星际介质的动量耦合通过一个以时间尺度 $\\tau_{\\mathrm{d}}$ 为特征的线性阻力来近似，该阻力根据耗散功率 $P_{\\mathrm{drag}}(t) = m v(t)^2 / \\tau_{\\mathrm{d}}$ 来移除动能。其基本控制原理是动能定理、牛顿第二定律以及动能的定义 $K(t) = \\tfrac{1}{2} m v(t)^2$。由此，可得出连续能量平衡方程为\n$$\n\\frac{dK}{dt} = L - \\frac{m v(t)^2}{\\tau_{\\mathrm{d}}}.\n$$\n假设在时间 $t=0$ 时，风速为 $v_0$，动能为 $K_0 = \\tfrac{1}{2} m v_0^2$。我们考虑在一个数值时间积分方案中使用算子分裂，该方案在注入算子和带子循环的阻力算子之间交替进行。\n\n定义一个全局时间步长 $\\Delta t$ 和一个整数子循环次数 $n_{\\mathrm{sub}} \\geq 1$。在每个全局步长内，根据两种算子顺序之一，执行 $n_{\\mathrm{sub}}$ 个大小为 $\\delta t = \\Delta t / n_{\\mathrm{sub}}$ 的子循环：\n- 注入后阻力 ($\\mathrm{I} \\rightarrow \\mathrm{D}$): 对于每个子循环，首先应用注入算子，使动能增加 $L \\delta t$（即更新 $v$ 使得 $K \\leftarrow K + L \\delta t$），然后应用阻力算子，使用线性阻力的前向欧拉递减来更新 $v$，即 $v \\leftarrow v \\left( 1 - \\delta t / \\tau_{\\mathrm{d}} \\right)$，并将在该子循环中由阻力耗散的能量近似为 $D_{\\mathrm{sub}} \\approx m v_{\\mathrm{pre}}^2 \\delta t / \\tau_{\\mathrm{d}}$，其中 $v_{\\mathrm{pre}}$ 是在该子循环中应用阻力算子之前的速度。\n- 阻力后注入 ($\\mathrm{D} \\rightarrow \\mathrm{I}$): 对于每个子循环，首先应用如上所述的阻力算子，然后应用注入算子，使动能增加 $L \\delta t$。\n\n在整个注入持续时间 $T_{\\mathrm{inj}}$ 内，以大小为 $\\Delta t$ 的全局步长进行积分，直到 $t = T_{\\mathrm{inj}}$（如有必要，可缩短最后一个全局步长，以使总时间恰好等于 $T_{\\mathrm{inj}}$）。总注入能量为 $E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$（单位为焦耳），总耗散能量为 $D_{\\mathrm{num}}$（所有阻力子循环中 $D_{\\mathrm{sub}}$ 的总和，单位为焦耳）。数值动能变化为 $\\Delta K_{\\mathrm{num}} = \\tfrac{1}{2} m v(T_{\\mathrm{inj}})^2 - \\tfrac{1}{2} m v_0^2$（单位为焦耳）。将能量守恒误差定义为无量纲分数\n$$\n\\varepsilon_E = \\frac{E_{\\mathrm{in}} - \\Delta K_{\\mathrm{num}} - D_{\\mathrm{num}}}{E_{\\mathrm{in}}}.\n$$\n对于连续系统，通过在 $[0, T_{\\mathrm{inj}}]$ 上对基本能量平衡方程进行积分，从第一性原理推导出精确的 $v(t)$ 和精确的阻力能量 $D_{\\mathrm{exact}}$。利用这些，计算最终的精确风速 $v_{\\mathrm{exact}} = v(T_{\\mathrm{inj}})$，并将风速的分数偏差（无量纲）定义为\n$$\n\\varepsilon_v = \\begin{cases}\n\\dfrac{v_{\\mathrm{num}} - v_{\\mathrm{exact}}}{v_{\\mathrm{exact}}},  v_{\\mathrm{exact}} \\neq 0 \\\\\n0,  v_{\\mathrm{exact}} = 0\n\\end{cases}\n$$\n其中 $v_{\\mathrm{num}}$ 是在 $t = T_{\\mathrm{inj}}$ 时通过数值方法得到的风速。所有速度必须以 $\\mathrm{m/s}$ 表示，所有时间以 $\\mathrm{s}$ 表示，功率以 $\\mathrm{J/s}$ 表示，质量以 $\\mathrm{kg}$ 表示，能量以 $\\mathrm{J}$ 表示。每个测试用例的最终答案 $\\varepsilon_E$ 和 $\\varepsilon_v$ 必须作为实数返回，不带单位符号，并且必须表示为小数（浮点数）。\n\n实现一个程序，给定固定的物理参数 $(m, \\tau_{\\mathrm{d}}, L, v_0, T_{\\mathrm{inj}})$ 和一组数值参数 $(\\Delta t, n_{\\mathrm{sub}}, \\text{ordering})$，为每个测试用例计算 $(\\varepsilon_E, \\varepsilon_v)$。注入算子必须通过强制动能增量 $L \\delta t$ 来更新速度。阻力算子必须使用前向欧拉速度更新 $v \\leftarrow v (1 - \\delta t/\\tau_{\\mathrm{d}})$，并且必须将在该子循环中耗散的能量近似为 $m v_{\\mathrm{pre}}^2 \\delta t/\\tau_{\\mathrm{d}}$。\n\n您的程序应处理以下测试套件，其通用物理参数为 $m = 1.0$（单位 $\\mathrm{kg}$），$\\tau_{\\mathrm{d}} = 2.0$（单位 $\\mathrm{s}$），$L = 1.0$（单位 $\\mathrm{J/s}$），$v_0 = 0.0$（单位 $\\mathrm{m/s}$），$T_{\\mathrm{inj}} = 4.0$（单位 $\\mathrm{s}$）。每个用例的数值参数如下：\n- 用例 1: $\\Delta t = 0.1$ (单位 $\\mathrm{s}$), $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 2: $\\Delta t = 0.1$ (单位 $\\mathrm{s}$), $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n- 用例 3: $\\Delta t = 0.5$ (单位 $\\mathrm{s}$), $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 4: $\\Delta t = 0.5$ (单位 $\\mathrm{s}$), $n_{\\mathrm{sub}} = 5$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n- 用例 5: $\\Delta t = 2.0$ (单位 $\\mathrm{s}$), $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n\n您的程序应生成单行输出，其中包含一个逗号分隔的 Python 风格列表的结果，其中每个元素对应一个测试用例，并且本身是一个包含两个浮点数 $[\\varepsilon_E, \\varepsilon_v]$ 的列表。例如，输出格式必须是\n$$\n[\\,[\\varepsilon_{E,1}, \\varepsilon_{v,1}], [\\varepsilon_{E,2}, \\varepsilon_{v,2}], \\dots ].\n$$\n顺序标签必须完全按照上面所写的方式解释。此问题不涉及角度。所有必需的单位均已指定；确保为能量和速度推导的任何数值答案都基于这些单位。程序不得读取输入；它必须嵌入测试套件并打印单行输出。数值方案必须实现所描述的算子分裂和子循环，并且精确参考必须从给定的基本定律中推导出来。将每个 $\\varepsilon_E$ 和每个 $\\varepsilon_v$ 报告为浮点数，不四舍五入到固定的小数位数。",
            "solution": "用户提供的问题已经过评估并且有效。\n\n### 问题验证\n\n#### 第1步：提取已知条件\n\n提供的问题陈述指定了以下已知条件：\n- **物理模型**：一个用于风的单区亚格子模型，风速为 $v(t)$，质量为 $m$。\n- **能量注入**：在持续时间 $T_{\\mathrm{inj}}$ 内的恒定功率 $L$。\n- **能量耗散**：由时间尺度 $\\tau_{\\mathrm{d}}$ 表征的线性阻力，耗散功率为 $P_{\\mathrm{drag}}(t) = m v(t)^2 / \\tau_{\\mathrm{d}}$。\n- **控制方程**：动能 $K(t) = \\tfrac{1}{2} m v(t)^2$ 的能量平衡方程由下式给出：\n$$ \\frac{dK}{dt} = L - \\frac{m v(t)^2}{\\tau_{\\mathrm{d}}} $$\n- **初始条件**：在 $t=0$ 时，速度为 $v_0$，动能为 $K_0 = \\tfrac{1}{2} m v_0^2$。\n- **数值方案**：使用全局时间步长 $\\Delta t$ 和子循环次数 $n_{\\mathrm{sub}} \\geq 1$ 的算子分裂。子循环步长为 $\\delta t = \\Delta t / n_{\\mathrm{sub}}$。\n- **算子**：\n    - **注入算子 ($\\mathrm{I}$)**：增加动能：$K \\leftarrow K + L \\delta t$。速度 $v$ 相应更新。\n    - **阻力算子 ($\\mathrm{D}$)**：通过前向欧拉法更新速度：$v \\leftarrow v \\left( 1 - \\delta t / \\tau_{\\mathrm{d}} \\right)$。\n- **耗散能量计算（数值）**：在每个子循环中，耗散能量近似为 $D_{\\mathrm{sub}} \\approx m v_{\\mathrm{pre}}^2 \\delta t / \\tau_{\\mathrm{d}}$，其中 $v_{\\mathrm{pre}}$ 是应用阻力算子之前的速度。总数值耗散能量 $D_{\\mathrm{num}}$ 是所有 $D_{\\mathrm{sub}}$ 的总和。\n- **算子顺序**：\n    - 注入后阻力 ($\\mathrm{I} \\rightarrow \\mathrm{D}$)\n    - 阻力后注入 ($\\mathrm{D} \\rightarrow \\mathrm{I}$)\n- **积分周期**：积分从 $t=0$ 进行到 $t=T_{\\mathrm{inj}}$。\n- **误差定义**：\n    - 总注入能量：$E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$。\n    - 数值动能变化：$\\Delta K_{\\mathrm{num}} = \\tfrac{1}{2} m v(T_{\\mathrm{inj}})^2 - \\tfrac{1}{2} m v_0^2$。\n    - 能量守恒误差：$\\varepsilon_E = (E_{\\mathrm{in}} - \\Delta K_{\\mathrm{num}} - D_{\\mathrm{num}})/E_{\\mathrm{in}}$。\n    - 风速的分数偏差：当 $v_{\\mathrm{exact}} \\neq 0$ 时为 $\\varepsilon_v = (v_{\\mathrm{num}} - v_{\\mathrm{exact}})/v_{\\mathrm{exact}}$，当 $v_{\\mathrm{exact}}=0$ 时为 $\\varepsilon_v = 0$。\n- **物理参数**：$m = 1.0\\,\\mathrm{kg}$，$\\tau_{\\mathrm{d}} = 2.0\\,\\mathrm{s}$，$L = 1.0\\,\\mathrm{J/s}$，$v_0 = 0.0\\,\\mathrm{m/s}$，$T_{\\mathrm{inj}} = 4.0\\,\\mathrm{s}$。\n- **测试用例**：\n    - 用例 1: $\\Delta t = 0.1\\,\\mathrm{s}$, $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n    - 用例 2: $\\Delta t = 0.1\\,\\mathrm{s}$, $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n    - 用例 3: $\\Delta t = 0.5\\,\\mathrm{s}$, $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n    - 用例 4: $\\Delta t = 0.5\\,\\mathrm{s}$, $n_{\\mathrm{sub}} = 5$, 顺序 = $\\mathrm{I} \\rightarrow \\mathrm{D}$。\n    - 用例 5: $\\Delta t = 2.0\\,\\mathrm{s}$, $n_{\\mathrm{sub}} = 1$, 顺序 = $\\mathrm{D} \\rightarrow \\mathrm{I}$。\n\n#### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行分析：\n- **有科学依据**：该问题描述了一个简化的、但物理上一致的反馈过程模型。控制方程是一个标准的能量平衡方程。数值方法（算子分裂、前向欧拉法）是标准技术。该模型是计算天体物理学中使用的有效简化。\n- **适定的**：该问题提供了一个带初始条件的一阶常微分方程，该方程有唯一解。数值方案被明确定义，导致每个测试用例都有确定的结果。所有参数都已指定。\n- **客观的**：问题使用精确的数学和物理语言陈述。对解决方案和输出格式的要求是明确的。没有主观或基于意见的陈述。\n- **完整性**：提供了推导精确解和实现数值模型所需的所有必要参数、初始条件、方程和步骤。\n- **一致性**：问题陈述中没有内部矛盾。算子和误差度量的定义是一致的。\n\n#### 第3步：结论与行动\n问题是**有效的**。将提供一个解决方案。\n\n### 求解推导与算法设计\n\n解决方案需要两个组成部分：推导作为基准的精确解析解，以及实现指定的数值方案。\n\n#### 1. 精确解析解\n\n动能 $K(t)$ 的控制方程为：\n$$ \\frac{dK}{dt} = L - \\frac{m v(t)^2}{\\tau_{\\mathrm{d}}} $$\n使用定义 $K(t) = \\frac{1}{2}mv(t)^2$，我们可以将方程重写为仅含 $K(t)$ 的形式：\n$$ \\frac{dK}{dt} = L - \\frac{2K(t)}{\\tau_{\\mathrm{d}}} $$\n这是一个一阶线性常微分方程。我们可以将其重新排列为标准形式：\n$$ \\frac{dK}{dt} + \\frac{2}{\\tau_{\\mathrm{d}}} K(t) = L $$\n该解可以通过积分因子法找到。积分因子为 $I(t) = \\exp\\left(\\int \\frac{2}{\\tau_{\\mathrm{d}}} dt\\right) = e^{2t/\\tau_{\\mathrm{d}}}$。将常微分方程乘以 $I(t)$ 得：\n$$ \\frac{d}{dt}\\left( K(t) e^{2t/\\tau_{\\mathrm{d}}} \\right) = L e^{2t/\\tau_{\\mathrm{d}}} $$\n对时间从 $0$ 到 $t$ 积分：\n$$ K(t)e^{2t/\\tau_{\\mathrm{d}}} - K(0)e^{0} = \\int_0^t L e^{2t'/\\tau_{\\mathrm{d}}} dt' = L \\frac{\\tau_{\\mathrm{d}}}{2} \\left( e^{2t/\\tau_{\\mathrm{d}}} - 1 \\right) $$\n利用初始条件 $K(0) = K_0$，我们求解 $K(t)$：\n$$ K(t) = K_0 e^{-2t/\\tau_{\\mathrm{d}}} + \\frac{L\\tau_{\\mathrm{d}}}{2} \\left(1 - e^{-2t/\\tau_{\\mathrm{d}}}\\right) $$\n这可以重排为：\n$$ K(t) = \\frac{L\\tau_{\\mathrm{d}}}{2} + \\left(K_0 - \\frac{L\\tau_{\\mathrm{d}}}{2}\\right) e^{-2t/\\tau_{\\mathrm{d}}} $$\n在 $t=T_{\\mathrm{inj}}$ 时的精确最终动能是 $K_{\\mathrm{exact}}(T_{\\mathrm{inj}})$。那么精确的最终速度 $v_{\\mathrm{exact}}$ 是：\n$$ v_{\\mathrm{exact}} = \\sqrt{\\frac{2 K_{\\mathrm{exact}}(T_{\\mathrm{inj}})}{m}} = \\sqrt{\\frac{2}{m} \\left[ \\frac{L\\tau_{\\mathrm{d}}}{2} + \\left(\\frac{1}{2}mv_0^2 - \\frac{L\\tau_{\\mathrm{d}}}{2}\\right) e^{-2T_{\\mathrm{inj}}/\\tau_{\\mathrm{d}}} \\right]} $$\n在此期间的总注入能量为 $E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$。精确的动能变化为 $\\Delta K_{\\mathrm{exact}} = K_{\\mathrm{exact}}(T_{\\mathrm{inj}}) - K_0$。根据能量守恒，由阻力耗散的总能量 $D_{\\mathrm{exact}}$ 是：\n$$ D_{\\mathrm{exact}} = E_{\\mathrm{in}} - \\Delta K_{\\mathrm{exact}} $$\n对于给定的参数 $m=1.0$、$\\tau_{\\mathrm{d}}=2.0$、$L=1.0$、$v_0=0.0$ 和 $T_{\\mathrm{inj}}=4.0$，我们有 $K_0=0$。精确的最终动能是：\n$$ K_{\\mathrm{exact}}(T_{\\mathrm{inj}}) = \\frac{1.0 \\cdot 2.0}{2} \\left(1 - e^{-2 \\cdot 4.0 / 2.0}\\right) = 1 - e^{-4} $$\n精确的最终速度是：\n$$ v_{\\mathrm{exact}} = \\sqrt{\\frac{2(1-e^{-4})}{1.0}} = \\sqrt{2(1-e^{-4})} $$\n\n#### 2. 数值方案\n\n数值积分在时间区间 $[0, T_{\\mathrm{inj}}]$ 上使用大小为 $\\Delta t$ 的全局步长执行。如果 $T_{\\mathrm{inj}}$ 不是 $\\Delta t$ 的整数倍，则缩短最后一步以确保总时间恰好为 $T_{\\mathrm{inj}}$。每个全局步长被划分为 $n_{\\mathrm{sub}}$ 个持续时间为 $\\delta t = \\Delta t / n_{\\mathrm{sub}}$ 的子循环。\n\n状态由风速 $v$ 描述。我们还累加总耗散能量 $D_{\\mathrm{num}}$。过程如下：\n初始化 $t=0$, $v=v_0$, $D_{\\mathrm{num}}=0$。\n当 $t  T_{\\mathrm{inj}}$ 时循环：\n1. 确定当前步长：$\\Delta t_{\\mathrm{current}} = \\min(\\Delta t, T_{\\mathrm{inj}} - t)$。\n2. 计算子循环步长：$\\delta t = \\Delta t_{\\mathrm{current}} / n_{\\mathrm{sub}}$。\n3. 执行一个包含 $n_{\\mathrm{sub}}$ 个子循环的循环。在每个子循环中：\n   a. 根据指定的 `ordering` 应用注入和阻力算子。\n\n算子的实现如下：\n\n**注入算子 ($\\mathrm{I}$)**：更新动能 $K \\leftarrow K + L\\delta t$。\n如果注入前的速度是 $v_{\\mathrm{in}}$，则初始动能是 $K_{\\mathrm{in}} = \\frac{1}{2} m v_{\\mathrm{in}}^2$。\n新的动能是 $K_{\\mathrm{out}} = K_{\\mathrm{in}} + L\\delta t$。\n新的速度是 $v_{\\mathrm{out}} = \\sqrt{2 K_{\\mathrm{out}}/m} = \\sqrt{v_{\\mathrm{in}}^2 + 2L\\delta t/m}$。\n\n**阻力算子 ($\\mathrm{D}$)**：用前向欧拉步更新速度并计算耗散能量。\n如果阻力前的速度是 $v_{\\mathrm{in}}$，则新速度是 $v_{\\mathrm{out}} = v_{\\mathrm{in}}(1 - \\delta t/\\tau_{\\mathrm{d}})$。\n子循环的耗散能量明确定义为 $D_{\\mathrm{sub}} = m v_{\\mathrm{in}}^2 \\delta t / \\tau_{\\mathrm{d}}$。该值被加到总的 $D_{\\mathrm{num}}$ 中。\n\n两种要求的顺序是：\n- **注入后阻力 ($\\mathrm{I} \\rightarrow \\mathrm{D}$)**：在一个子循环内，首先应用算子 $\\mathrm{I}$，然后应用算子 $\\mathrm{D}$。用于阻力耗散计算的 $v_{\\mathrm{pre}}$ 是*应用注入算子之后*的速度。\n- **阻力后注入 ($\\mathrm{D} \\rightarrow \\mathrm{I}$)**：在一个子循环内，首先应用算子 $\\mathrm{D}$，然后应用算子 $\\mathrm{I}$。用于阻力耗散计算的 $v_{\\mathrm{pre}}$ 是*应用阻力算子之前*的速度。\n\n#### 3. 误差计算\n\n在模拟循环于 $t=T_{\\mathrm{inj}}$ 完成后，我们得到最终的数值速度 $v_{\\mathrm{num}}$ 和总数值耗散能量 $D_{\\mathrm{num}}$。然后我们计算：\n- 最终数值动能：$K_{\\mathrm{num, final}} = \\frac{1}{2}m v_{\\mathrm{num}}^2$。\n- 数值动能变化：$\\Delta K_{\\mathrm{num}} = K_{\\mathrm{num, final}} - K_0$。\n- 总注入能量：$E_{\\mathrm{in}} = L T_{\\mathrm{inj}}$。\n- 能量守恒误差：$\\varepsilon_E = (E_{\\mathrm{in}} - \\Delta K_{\\mathrm{num}} - D_{\\mathrm{num}})/E_{\\mathrm{in}}$。此误差的产生是因为阻力步骤中动能的更新规则 $K \\leftarrow K(1-\\delta t/\\tau_d)^2$ 与用于耗散能量的近似 $D_{sub}$ 并非完全一致。\n- 分数速度偏差：$\\varepsilon_v = (v_{\\mathrm{num}} - v_{\\mathrm{exact}})/v_{\\mathrm{exact}}$，使用先前推导的 $v_{\\mathrm{exact}}$。\n\n该算法在 Python 中实现，以处理所有五个测试用例并按要求格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the subgrid feedback model problem for a suite of test cases.\n    It calculates the exact solution and then runs a numerical simulation\n    for each case to determine the energy conservation error and velocity bias.\n    \"\"\"\n\n    # Common physical parameters\n    m = 1.0  # kg\n    tau_d = 2.0  # s\n    L = 1.0  # J/s\n    v0 = 0.0  # m/s\n    T_inj = 4.0  # s\n\n    # Test suite\n    test_cases = [\n        {'dt': 0.1, 'n_sub': 1, 'ordering': 'I->D'},\n        {'dt': 0.1, 'n_sub': 1, 'ordering': 'D->I'},\n        {'dt': 0.5, 'n_sub': 1, 'ordering': 'I->D'},\n        {'dt': 0.5, 'n_sub': 5, 'ordering': 'I->D'},\n        {'dt': 2.0, 'n_sub': 1, 'ordering': 'D->I'},\n    ]\n\n    # --- Exact Solution Calculation ---\n    K0 = 0.5 * m * v0**2\n    \n    # Exact kinetic energy at T_inj\n    K_exact_final = (L * tau_d / 2.0) + (K0 - L * tau_d / 2.0) * np.exp(-2 * T_inj / tau_d)\n    \n    # Exact final velocity\n    if K_exact_final >= 0:\n        v_exact = np.sqrt(2 * K_exact_final / m)\n    else:\n        # Should not happen with given parameters\n        v_exact = 0.0\n\n    results = []\n    for case in test_cases:\n        dt = case['dt']\n        n_sub = case['n_sub']\n        ordering = case['ordering']\n\n        # --- Numerical Simulation ---\n        v = v0\n        current_time = 0.0\n        D_num = 0.0\n\n        # Loop over global time steps until T_inj is reached\n        while not np.isclose(current_time, T_inj):\n            time_step = min(dt, T_inj - current_time)\n            delta_t_sub = time_step / n_sub\n\n            # Subcycling loop\n            for _ in range(n_sub):\n                if ordering == 'I->D':\n                    # 1. Injection Operator\n                    v = np.sqrt(v**2 + 2 * L * delta_t_sub / m)\n                    \n                    # 2. Drag Operator\n                    v_pre_drag = v\n                    D_sub = m * v_pre_drag**2 * delta_t_sub / tau_d\n                    D_num += D_sub\n                    v = v_pre_drag * (1.0 - delta_t_sub / tau_d)\n\n                elif ordering == 'D->I':\n                    # 1. Drag Operator\n                    v_pre_drag = v\n                    D_sub = m * v_pre_drag**2 * delta_t_sub / tau_d\n                    D_num += D_sub\n                    v = v_pre_drag * (1.0 - delta_t_sub / tau_d)\n                    \n                    # 2. Injection Operator\n                    v = np.sqrt(v**2 + 2 * L * delta_t_sub / m)\n            \n            current_time += time_step\n\n        v_num = v\n        \n        # --- Error Calculation ---\n        E_in = L * T_inj\n        K_num_final = 0.5 * m * v_num**2\n        delta_K_num = K_num_final - K0\n        \n        # Energy conservation error\n        # Avoid division by zero if E_in is zero, though not possible in this problem.\n        epsilon_E = (E_in - delta_K_num - D_num) / E_in if E_in != 0 else 0.0\n        \n        # Fractional bias in wind speed\n        if v_exact != 0:\n            epsilon_v = (v_num - v_exact) / v_exact\n        else:\n            epsilon_v = 0.0\n            \n        results.append([epsilon_E, epsilon_v])\n\n    # Final print statement in the exact required format.\n    # The default string representation for a list includes spaces, which\n    # aligns with the Python-style list format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}