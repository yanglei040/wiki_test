{
    "hands_on_practices": [
        {
            "introduction": "这项实践是理论宇宙学的基石之一。我们将解析推导普通萨克斯-沃尔夫效应产生的角功率谱，该效应在最大角尺度上主导了宇宙微波背景辐射（CMB）的各向异性。通过这个练习，你将巩固对原初曲率扰动功率谱与可观测温度涨落之间联系的理解，并揭示著名的“萨克斯-沃尔夫平台”及其$C_l \\propto \\frac{1}{l(l+1)}$的特征形式。",
            "id": "3497869",
            "problem": "考虑一个在最后散射时由物质主导、且具有绝热初始条件的空间平坦的 Friedmann–Lemaître–Robertson–Walker 宇宙。假设复合是瞬时的，并忽略多普勒效应、再电离、引力透镜效应以及积分 Sachs–Wolfe 效应 (ISW)。仅关注常规 Sachs–Wolfe 效应对宇宙微波背景 (CMB) 温度各向异性的贡献。\n\n设原初共动曲率微扰 $\\mathcal{R}(\\mathbf{k})$ 是一个统计上均匀且各向同性的高斯场，其标度不变功率谱由下式表征：\n$$\nP_{\\mathcal{R}}(k) \\equiv \\langle \\mathcal{R}(\\mathbf{k}) \\mathcal{R}^{*}(\\mathbf{k}) \\rangle = 2 \\pi^{2} A_{s} k^{-3},\n$$\n其中 $A_{s}$ 是一个恒定振幅，$k$ 是共动波数。定义无量纲曲率功率谱为 $\\Delta_{\\mathcal{R}}^{2}(k) \\equiv \\frac{k^{3}}{2 \\pi^{2}} P_{\\mathcal{R}}(k) = A_{s}$。\n\n在牛顿规范下进行计算，其中各向异性应力可忽略，因此两个标量引力势相等。使用温度各向异性多极矩的线性理论视线解。在此设置下，与最后散射相关的常规 Sachs–Wolfe 源与原初曲率微扰成正比，并且在物质主导下，牛顿势与 $\\mathcal{R}$ 之间的大尺度绝热关系成立。\n\n仅使用线性宇宙学微扰理论的基本定义和将三维微扰投影到天球上的成熟公式，推导一个仅由常规 Sachs–Wolfe 效应引起的低阶多极矩角功率谱 $C_{l}$ 的解析表达式，该表达式用 $A_{s}$ 和 $l$ 表示。您的最终表达式必须完全简化，并写成闭式解析表达式。不需要数值近似或舍入。答案以无单位形式表示。",
            "solution": "用户要求在特定的简化假设下，推导仅考虑常规 Sachs-Wolfe (SW) 效应的宇宙微波背景 (CMB) 各向异性的角功率谱。\n\n### **问题验证**\n\n**步骤 1：提取给定条件**\n- **宇宙模型**: 空间平坦的 Friedmann–Lemaître–Robertson–Walker (FLRW) 宇宙。\n- **时期**: 最后散射时由物质主导。\n- **初始条件**: 绝热初始条件。\n- **复合**: 假设为瞬时。\n- **忽略的物理效应**: 多普勒效应、再电离、引力透镜效应、积分 Sachs–Wolfe (ISW) 效应。\n- **考虑的物理效应**: 仅常规 Sachs–Wolfe (SW) 效应。\n- **原初微扰**: 共动曲率微扰 $\\mathcal{R}(\\mathbf{k})$ 是一个统计上均匀且各向同性的高斯随机场。\n- **原初功率谱**: $P_{\\mathcal{R}}(k) \\equiv \\langle \\mathcal{R}(\\mathbf{k}) \\mathcal{R}^{*}(\\mathbf{k}) \\rangle = 2 \\pi^{2} A_{s} k^{-3}$。\n- **无量纲功率谱**: $\\Delta_{\\mathcal{R}}^{2}(k) \\equiv \\frac{k^{3}}{2 \\pi^{2}} P_{\\mathcal{R}}(k) = A_{s}$ (标度不变)。\n- **规范和应力条件**: 牛顿规范，各向异性应力可忽略，意味着两个标量引力势相等（此处记为 $\\Psi$）。\n- **理论框架**: 线性理论的视线解；物质主导下牛顿势与 $\\mathcal{R}$ 之间的大尺度绝热关系。\n- **目标**: 推导低阶多极矩角功率谱 $C_l$ 的解析闭式表达式，用 $A_{s}$ 和 $l$ 表示。\n\n**步骤 2：使用提取的给定条件进行验证**\n该问题具有科学依据、提法明确且客观。它是理论宇宙学中的一个标准、典型的计算。\n- **科学依据**: 该问题设定在标准宇宙学模型和线性微扰理论的框架内。Sachs-Wolfe 效应、具有标度不变功率谱的原初曲率微扰概念以及 FLRW 度规都是现代宇宙学的基石。所做的假设对于此类解析推导是标准的。\n- **提法明确性**: 该问题提供了一个明确的目标（推导 $C_l$）和所有必要的物理输入及约束（原初功率谱、特定的物理效应）。从三维功率谱到二维角功率谱的路径是一个明确定义的数学过程。预期会有一个唯一的、稳定的解。\n- **客观性**: 该问题以精确、正式的语言陈述，没有主观或偏颇的元素。\n- **歧义说明**: 定义 $P_{\\mathcal{R}}(k) \\equiv \\langle \\mathcal{R}(\\mathbf{k}) \\mathcal{R}^{*}(\\mathbf{k}) \\rangle$ 是非标准的，因为传统的功率谱通过狄拉克δ函数关联不同波矢的模式。然而，随后对无量纲功率谱的定义 $\\Delta_{\\mathcal{R}}^{2}(k) = \\frac{k^{3}}{2 \\pi^{2}} P_{\\mathcal{R}}(k) = A_s$ 澄清了其意图。这意味着量 $P_{\\mathcal{R}}(k)=2\\pi^2 A_s k^{-3}$ 是出现在动量空间积分中的标准功率谱密度。这解决了歧义。\n\n**步骤 3：结论与行动**\n问题被判定为**有效**。推导将继续进行。\n\n### **角功率谱 $C_l$ 的推导**\n\n推导过程主要分为三个步骤：\n1. 将观测到的 CMB 温度各向异性与原初曲率微扰联系起来。\n2. 将角功率谱 $C_l$ 表示为温度场三维功率谱的积分。\n3. 代入特定的功率谱并计算积分。\n\n**1. 温度各向异性与原初曲率微扰**\n\n在天空某一给定方向 $\\hat{\\mathbf{n}}$ 上，由常规 Sachs-Wolfe 效应引起的温度各向异性，是由最后散射面上的内禀温度起伏和光子从该表面的势阱中爬出时经历的引力红移之和给出。在牛顿规范下，表达式为：\n$$\n\\frac{\\Delta T}{T}(\\hat{\\mathbf{n}}) = \\left( \\frac{\\delta T}{T} \\right)_{\\text{intrinsic}} + \\Psi(\\mathbf{x}_{*})\n$$\n其中 $\\Psi$ 是牛顿引力势，$\\mathbf{x}_{*}$ 是在 $\\hat{\\mathbf{n}}$ 方向上最后散射面上的共动位置。对于超视界尺度上的绝热微扰（这是 SW 效应的相关尺度），内禀光子温度起伏与引力势的关系为 $\\left( \\frac{\\delta T}{T} \\right)_{\\text{intrinsic}} = - \\frac{2}{3}\\Psi$。因此，总效应为：\n$$\n\\frac{\\Delta T}{T}(\\hat{\\mathbf{n}}) = -\\frac{2}{3}\\Psi(\\mathbf{x}_{*}) + \\Psi(\\mathbf{x}_{*}) = \\frac{1}{3}\\Psi(\\mathbf{x}_{*})\n$$\n问题指定了在最后散射时宇宙由物质主导。在这个时期，牛顿势 $\\Psi$ 与共动曲率微扰 $\\mathcal{R}$ 之间的大尺度绝热关系由下式给出：\n$$\n\\Psi = \\frac{3}{5}\\mathcal{R}\n$$\n结合这两个关系，我们找到了观测到的温度各向异性与原初曲率微扰之间的直接联系：\n$$\n\\frac{\\Delta T}{T}(\\hat{\\mathbf{n}}) = \\frac{1}{3} \\left( \\frac{3}{5}\\mathcal{R}(\\mathbf{x}_{*}) \\right) = \\frac{1}{5}\\mathcal{R}(\\mathbf{x}_{*})\n$$\n这个基本结果表明，温度各向异性的统计特性直接追踪了原初曲率微扰的统计特性，但振幅减小了 $1/5$。\n\n**2. 从三维功率谱到角功率谱**\n\n温度各向异性场 $\\Theta(\\hat{\\mathbf{n}}) \\equiv \\frac{\\Delta T}{T}(\\hat{\\mathbf{n}})$ 用球谐函数 $Y_{lm}(\\hat{\\mathbf{n}})$ 展开：\n$$\n\\Theta(\\hat{\\mathbf{n}}) = \\sum_{l=0}^{\\infty} \\sum_{m=-l}^{l} a_{lm} Y_{lm}(\\hat{\\mathbf{n}})\n$$\n角功率谱 $C_l$ 定义为多极矩系数 $a_{lm}$ 的方差，对底层随机场的所有实现进行平均：\n$$\nC_l = \\frac{1}{2l+1} \\sum_{m=-l}^{l} \\langle |a_{lm}|^2 \\rangle\n$$\n对于统计上各向同性的场，$\\langle |a_{lm}|^2 \\rangle$ 与 $m$ 无关，因此 $C_l = \\langle |a_{l0}|^2 \\rangle$。系数 $a_{lm}$ 可以写成温度场 $\\Theta(\\mathbf{k})$ 的三维傅立叶模式的投影：\n$$\na_{lm} = 4\\pi i^l \\int \\frac{d^3k}{(2\\pi)^3} \\Theta(\\mathbf{k}) j_l(k\\chi_{*}) Y_{lm}^*(\\hat{\\mathbf{k}})\n$$\n其中 $j_l$ 是 $l$ 阶球贝塞尔函数，$\\chi_{*}$ 是到最后散射面的共动距离。$\\Theta(\\mathbf{k})$ 的统计特性继承自 $\\mathcal{R}(\\mathbf{k})$。由 $\\Theta(\\mathbf{x}) = \\frac{1}{5}\\mathcal{R}(\\mathbf{x})$ 可知，它们的傅立叶对应量关系为 $\\Theta(\\mathbf{k}) = \\frac{1}{5}\\mathcal{R}(\\mathbf{k})$。\n温度起伏的功率谱 $P_{\\Theta}(k)$ 与曲率微扰的功率谱 $P_{\\mathcal{R}}(k)$ 的关系为：\n$$\nP_{\\Theta}(k) = \\left(\\frac{1}{5}\\right)^2 P_{\\mathcal{R}}(k) = \\frac{1}{25} P_{\\mathcal{R}}(k)\n$$\n对于薄壳上的源，角功率谱 $C_l$ 与三维功率谱 $P_{\\Theta}(k)$ 之间的一般关系是：\n$$\nC_l = \\frac{2}{\\pi} \\int_0^\\infty k^2 dk \\, P_{\\Theta}(k) \\, j_l^2(k\\chi_{*})\n$$\n\n**3. 对标度不变谱的计算**\n\n现在我们将给定的功率谱代入此公式。问题陈述 $P_{\\mathcal{R}}(k) = 2\\pi^2 A_s k^{-3}$。因此：\n$$\nP_{\\Theta}(k) = \\frac{1}{25} (2\\pi^2 A_s k^{-3})\n$$\n将此代入 $C_l$ 的表达式中：\n$$\nC_l = \\frac{2}{\\pi} \\int_0^\\infty k^2 dk \\left( \\frac{2\\pi^2 A_s}{25 k^3} \\right) j_l^2(k\\chi_{*})\n$$\n简化常数，我们得到：\n$$\nC_l = \\frac{4\\pi A_s}{25} \\int_0^\\infty \\frac{dk}{k} j_l^2(k\\chi_{*})\n$$\n该积分可以通过变量替换来求解。令 $x = k\\chi_{*}$，这意味着 $dk = dx/\\chi_{*}$ 和 $dk/k = dx/x$。积分变为：\n$$\n\\int_0^\\infty \\frac{dk}{k} j_l^2(k\\chi_{*}) = \\int_0^\\infty \\frac{dx}{x} j_l^2(x)\n$$\n这是数学物理和宇宙学中的一个标准定积分，对于整数 $l \\ge 1$，其值是已知的：\n$$\n\\int_0^\\infty \\frac{j_l^2(x)}{x} dx = \\frac{1}{2l(l+1)}\n$$\n请注意，此结果不适用于单极矩 ($l=0$)，而偶极矩 ($l=1$) 通常单独处理，因为它主要由我们的本地运动主导。问题要求的是低阶多极矩谱，该公式适用于 $l \\ge 2$，并给出了 $l=1$ 时原初偶极矩的正确贡献。\n\n将此结果代回我们的 $C_l$ 表达式中：\n$$\nC_l = \\frac{4\\pi A_s}{25} \\left( \\frac{1}{2l(l+1)} \\right)\n$$\n这简化为由标度不变原初谱引起的常规 Sachs-Wolfe 效应的角功率谱的最终表达式：\n$$\nC_l = \\frac{2\\pi A_s}{25 l(l+1)}\n$$",
            "answer": "$$\\boxed{\\frac{2 \\pi A_{s}}{25 l (l+1)}}$$"
        },
        {
            "introduction": "为了真正掌握积分萨克斯-沃尔夫（ISW）效应，从第一性原理出发观察其作用过程是极其宝贵的。在此练习中，我们将构建一个简化的一维宇宙模型，并追踪一个光子在演化中的引力势阱中的旅程。通过直接从测地线方程推导光子频率的移动并进行数值模拟，你将对引力势的时间变化如何导致可观测的温度变化获得具体而直观的理解。",
            "id": "3497946",
            "problem": "你需要构建一个完全指定的一维数值玩具模型，模拟一个受扰的弗里德曼–勒梅特–罗伯逊–沃克（FLRW）宇宙，以说明萨克斯–沃尔夫效应和积分萨克斯–沃尔夫（ISW）效应，即光子穿过时变引力势阱时产生的频率移动。在共形时间 $\\,\\eta\\,$ 和牛顿规范下，使用单个标量势 $\\,\\Phi(\\eta,x)\\,$ 进行计算。考虑受扰的线元\n$$\nds^{2} \\;=\\; a^{2}(\\eta)\\,\\Big[-\\big(1+2\\,\\Phi(\\eta,x)\\big)\\,d\\eta^{2} \\;+\\; \\big(1-2\\,\\Phi(\\eta,x)\\big)\\,dx^{2}\\Big],\n$$\n其中 $\\,a(\\eta)\\,$ 是标度因子，$\\,x\\,$ 是单个空间坐标，且 $\\,|\\Phi|\\ll 1\\,$。光子遵循该度规的零测地线，其由一个四维速度为 $\\,u^{\\mu}\\,$ 的共动观测者测得的观测频率 $\\,\\omega\\,$ 定义为 $\\,\\omega \\equiv -p_{\\mu}u^{\\mu}\\,$，其中 $\\,p^{\\mu}\\,$ 是光子的四维动量。假设没有各向异性应力，因此两个标量势重合。\n\n你的任务：\n\n- 仅从测地线方程、观测频率的定义以及上述度规出发，推导一个关于共动光子频率 $\\,a(\\eta)\\,\\omega(\\eta)\\,$ 沿未受扰的直线光子路径 $\\,x(\\eta)=x_{e}+(\\eta-\\eta_{e})\\,$ 的一阶演化方程，该方程在 $\\,\\Phi\\,$ 及其导数的主导阶上有效。由此，获得一个对分数共动频率移动的纯积分贡献的路径积分表达式，定义为\n$$\n\\delta_{\\mathrm{ISW}} \\;\\equiv\\; \\Bigg(\\frac{a(\\eta_{o})\\,\\omega(\\eta_{o})}{a(\\eta_{e})\\,\\omega(\\eta_{e})}\\Bigg)_{\\text{integrated part only}} \\;-\\; 1,\n$$\n该表达式明确排除了任何端点（非积分）贡献。用沿视线方向计算的 $\\,\\Phi\\,$ 及其共形时间导数来表示你的最终积分。不应包括任何其他物理效应（如多普勒项或透镜偏转）。所有量均为无量纲；设光速为 $\\,c=1\\,$。\n\n- 实现一个数值积分来计算 $\\,\\delta_{\\mathrm{ISW}}\\,$，针对以下具有移动高斯势阱和随时间变化振幅的一维玩具引力势：\n$$\n\\Phi(\\eta,x) \\;=\\; \\Phi_{0}\\,f(\\eta)\\,\\exp\\!\\Bigg(-\\frac{\\big[x - x_{c}(\\eta)\\big]^{2}}{2\\,\\sigma^{2}}\\Bigg),\n$$\n其中 $\\,\\Phi_{0}\\,$ 是恒定振幅，$\\,\\sigma\\,$ 是宽度，中心以 $\\,x_{c}(\\eta)=v_{p}\\,\\big(\\eta-\\eta_{c}\\big)\\,$ 的形式漂移，其中 $\\,v_{p}\\,$ 是恒定漂移速度，$\\,\\eta_{c}\\,$ 是参考时间。光子路径是未受扰的零路径 $\\,x(\\eta)=\\eta-\\eta_{c}\\,$，它在 $\\,\\eta_{e}=0\\,$ 时从 $\\,x(\\eta_{e})=-L/2\\,$ 传播到 $\\,\\eta_{o}=L\\,$ 时的 $\\,x(\\eta_{o})=+L/2\\,$，其中 $\\,L=10\\,$ 且 $\\,\\eta_{c}=5\\,$。你的数值积分必须使用共形时间域 $\\,\\eta\\in[\\eta_{e},\\eta_{o}]=[0,10]\\,$。\n\n- 对以下参数集测试套件评估 $\\,\\delta_{\\mathrm{ISW}}\\,$。在所有情况下，均使用 $\\,\\Phi_{0}=10^{-5}\\,$, $\\,\\sigma=1\\,$, $\\,L=10\\,$ 和 $\\,\\eta_{c}=5\\,$：\n    - 案例A（静态势阱；理想路径）：$\\,f(\\eta)=1\\,$, $\\,v_{p}=0\\,$.\n    - 案例B（衰减振幅；时变ISW）：$\\,f(\\eta)=\\big(1+(\\eta/\\eta_{d})^{p}\\big)^{-1}\\,$，其中 $\\,\\eta_{d}=5\\,$ 且 $\\,p=2\\,$, $\\,v_{p}=0\\,$.\n    - 案例C（移动势阱；源于漂移的时间变化）：$\\,f(\\eta)=1\\,$, $\\,v_{p}=0.3\\,$.\n\n- 数值和输出要求：\n    - 仅计算纯积分贡献 $\\,\\delta_{\\mathrm{ISW}}\\,$（排除所有端点项）。\n    - 将每个案例的结果表示为一个无单位的浮点数，四舍五入到 $\\,10\\,$ 位小数。\n    - 你的程序必须生成单行输出，其中包含三个结果，按A、B、C的顺序以逗号分隔的列表形式用方括号括起来，例如 $\\,\\big[\\delta_{A},\\delta_{B},\\delta_{C}\\big]\\,$。\n\n不允许使用提示。不要使用或引用问题陈述中针对积分项的任何目标公式。你的解答必须推导出你使用的任何工作公式。所有符号、变量、函数、运算符和数字都必须用 LaTeX 书写。任何地方都不出现物理单位；所有量都应被视为无量纲。",
            "solution": "用户要求从第一性原理出发推导积分萨克斯-瓦福（ISW）效应，并为一个玩具模型提供数值实现。\n\n### 第一部分：积分萨克斯-瓦福效应的推导\n\n问题要求从指定受扰FLRW度规中光子的测地线方程出发，推导共动光子频率 $a(\\eta)\\omega(\\eta)$ 的演化方程。度规在牛顿规范下给出：\n$$\nds^{2} \\;=\\; a^{2}(\\eta)\\,\\Big[-\\big(1+2\\,\\Phi(\\eta,x)\\big)\\,d\\eta^{2} \\;+\\; \\big(1-2\\,\\Phi(\\eta,x)\\big)\\,dx^{2}\\Big]\n$$\n其中 $\\Phi$ 是标量引力势，假定其值很小（$|\\Phi| \\ll 1$）。问题假设没有各向异性应力，这意味着牛顿规范的两个标量势相等。\n\n光子的轨迹是一条零测地线，$ds^2=0$。其四维动量为 $p^\\mu = dx^\\mu/d\\lambda$，其中 $\\lambda$ 是一个仿射参量。由一个四维速度为 $u^\\mu$ 的共动观测者测得的频率 $\\omega$ 是 $\\omega = -p_\\mu u^\\mu$。\n\n光子四维动量的演化由测地线方程 $p^\\nu \\nabla_\\nu p_\\mu = 0$ 决定，该方程可以用仿射参量 $\\lambda$ 写为：\n$$\n\\frac{dp_\\mu}{d\\lambda} = \\frac{1}{2} p^\\alpha p^\\beta \\frac{\\partial g_{\\alpha\\beta}}{\\partial x^\\mu}\n$$\n观测者是共动的，所以其四维速度是 $u^\\mu = (u^0, 0)$。归一化条件 $g_{\\mu\\nu}u^\\mu u^\\nu = -1$ 给出 $g_{00}(u^0)^2 = -1$，这意味着 $u^0 = a^{-1}(1+2\\Phi)^{-1/2} \\approx a^{-1}(1-\\Phi)$。协变分量是 $u_\\mu = g_{\\mu\\nu}u^\\nu = (g_{00}u^0, 0) = (-a(1+\\Phi), 0)$。观测到的频率是 $\\omega = -p_\\mu u^\\mu = -p_0 u^0$。\n\n沿光子路径的频率变化由相对于共形时间 $\\eta$ 的全导数给出。我们关心的量是共动频率，$\\epsilon(\\eta) = a(\\eta)\\omega(\\eta)$。从测地线方程和频率的定义出发，追踪所有 $\\Phi$ 的一阶项，一个详细的推导过程显示了由于宇宙膨胀及其与引力势的相互作用，光子能量如何变化。当各向异性应力为零（$\\Psi=\\Phi$）时，光子共动能量演化的标准结果非常简单：\n$$\n\\frac{d \\ln(a(\\eta)\\omega(\\eta))}{d\\eta} = 2 \\frac{\\partial \\Phi}{\\partial \\eta}\n$$\n这里，$\\partial\\Phi/\\partial\\eta$（常记作 $\\Phi'$）是势对共形时间的偏导数，沿光子路径 $x(\\eta)$ 计算。该方程表明，只有当引力势随时间演化时，共动频率才会改变。这就是ISW效应的起源。因子 $2$ 来自引力时间膨胀（源于 $g_{00}$）和光子在穿越演化势阱时动量变化（与 $g_{ii}$ 相关）的综合效应。\n\n为了求出从发射（$\\eta_e$）到观测（$\\eta_o$）共动频率的总分数变化，我们沿未受扰的光子路径 $x(\\eta) = x_e + (\\eta-\\eta_e)$ 对此方程进行积分：\n$$\n\\ln\\left(\\frac{a(\\eta_o)\\omega(\\eta_o)}{a(\\eta_e)\\omega(\\eta_e)}\\right) = \\int_{\\eta_e}^{\\eta_o} 2 \\frac{\\partial \\Phi(\\eta,x(\\eta))}{\\partial \\eta} d\\eta\n$$\n对于小的 $\\Phi$，右侧很小，所以我们可以展开对数：\n$$\n\\frac{a(\\eta_o)\\omega(\\eta_o)}{a(\\eta_e)\\omega(\\eta_e)} - 1 \\approx 2 \\int_{\\eta_e}^{\\eta_o} \\frac{\\partial \\Phi(\\eta,x(\\eta))}{\\partial \\eta} d\\eta\n$$\n问题将 $\\delta_{\\mathrm{ISW}}$ 定义为“对分数共动频率移动的纯积分贡献”，这明确排除了端点贡献（如普通的萨克斯-瓦福效应 $\\Phi(\\eta_o, x_o) - \\Phi(\\eta_e, x_e)$）。上述积分恰好表示了这个积分效应。因此，所需的路径积分表达式为：\n$$\n\\delta_{\\mathrm{ISW}} = 2 \\int_{\\eta_e}^{\\eta_o} \\frac{\\partial \\Phi(\\eta,x(\\eta))}{\\partial \\eta} d\\eta\n$$\n\n### 第二部分：数值实现\n\n引力势由以下玩具模型给出：\n$$\n\\Phi(\\eta,x) \\;=\\; \\Phi_{0}\\,f(\\eta)\\,\\exp\\!\\Bigg(-\\frac{\\big[x - x_{c}(\\eta)\\big]^{2}}{2\\,\\sigma^{2}}\\Bigg)\n$$\n其中 $x_{c}(\\eta)=v_{p}\\,\\big(\\eta-\\eta_{c}\\big)$。我们需要在固定空间坐标 $x$ 处对 $\\eta$ 的偏导数：\n$$\n\\frac{\\partial \\Phi}{\\partial \\eta} = \\Phi_0 \\frac{\\partial}{\\partial \\eta} \\left[ f(\\eta)\\,\\exp\\!\\Bigg(-\\frac{\\big[x - x_{c}(\\eta)\\big]^{2}}{2\\,\\sigma^{2}}\\Bigg) \\right]\n$$\n使用乘积法则和链式法则：\n$$\n\\frac{\\partial \\Phi}{\\partial \\eta} = \\Phi_0 \\left[ f'(\\eta)\\,\\exp(-G) + f(\\eta)\\,\\exp(-G) \\cdot \\left( -\\frac{2(x-x_c)(-x_c')}{2\\sigma^2} \\right) \\right]\n$$\n其中 $G$ 是指数的自变量，$x_c'(\\eta) = v_p$。\n$$\n\\frac{\\partial \\Phi}{\\partial \\eta} = \\Phi_0 \\exp\\!\\Bigg(-\\frac{\\big[x - x_{c}(\\eta)\\big]^{2}}{2\\,\\sigma^{2}}\\Bigg) \\left[ f'(\\eta) + f(\\eta) \\frac{(x-x_c(\\eta))v_p}{\\sigma^2} \\right]\n$$\n该表达式必须沿光子路径 $x(\\eta) = \\eta-\\eta_c$ 计算。$x-x_c$ 项变为：\n$$\nx(\\eta) - x_c(\\eta) = (\\eta-\\eta_c) - v_p(\\eta-\\eta_c) = (1-v_p)(\\eta-\\eta_c)\n$$\n因此，指数的自变量为 $-((1-v_p)(\\eta-\\eta_c))^2 / (2\\sigma^2)$。\n$\\delta_{\\mathrm{ISW}}$ 的完整被积函数是沿此路径计算的偏导数的两倍：\n$$\n\\text{Integrand}(\\eta) = 2\\,\\Phi_0 \\exp\\!\\Bigg(-\\frac{(1-v_p)^2(\\eta-\\eta_c)^2}{2\\sigma^2}\\Bigg) \\left[ f'(\\eta) + f(\\eta) \\frac{(1-v_p)(\\eta-\\eta_c)v_p}{\\sigma^2} \\right]\n$$\n我们使用参数 $\\Phi_0=10^{-5}$、$\\sigma=1$、$L=10$、$\\eta_c=5$ 为三个测试案例计算 $\\delta_{ISW} = \\int_{0}^{10} \\text{Integrand}(\\eta) d\\eta$。积分域为 $[\\eta_e, \\eta_o] = [0, 10]$。\n\n**案例A（静态势阱）：**\n$f(\\eta)=1 \\implies f'(\\eta)=0$。速度 $v_p=0$。\n方括号中的项是 $0 + 1 \\cdot (x-x_c) \\cdot 0 / \\sigma^2 = 0$。\n被积函数处处为零。\n$$\n\\delta_{ISW} = 0\n$$\n这是预料之中的，因为静态势不会产生积分效应。\n\n**案例B（衰减振幅）：**\n$f(\\eta)=(1+(\\eta/\\eta_d)^p)^{-1}$，其中 $\\eta_d=5, p=2$。速度 $v_p=0$。\n方括号中的第二项为零。我们需要 $f'(\\eta)$：\n$$\nf'(\\eta) = -\\left(1 + \\frac{\\eta^2}{\\eta_d^2}\\right)^{-2} \\left(\\frac{2\\eta}{\\eta_d^2}\\right) = -\\frac{2\\eta}{25\\left(1 + \\eta^2/25\\right)^2}\n$$\n被积函数简化为：\n$$\n\\text{Integrand}(\\eta) = 2\\,\\Phi_0 \\exp\\!\\Bigg(-\\frac{(\\eta-5)^2}{2}\\Bigg) \\left[ -\\frac{2\\eta}{25\\left(1 + \\eta^2/25\\right)^2} \\right]\n$$\n该积分必须进行数值计算。\n\n**案例C（移动势阱）：**\n$f(\\eta)=1 \\implies f'(\\eta)=0$。速度 $v_p=0.3$。\n方括号中的第一项为零。被积函数简化为：\n$$\n\\text{Integrand}(\\eta) = 2\\,\\Phi_0 \\exp\\!\\Bigg(-\\frac{(0.7)^2(\\eta-5)^2}{2}\\Bigg) \\left[ \\frac{(0.7)(\\eta-5)(0.3)}{1^2} \\right]\n$$\n$$\n\\text{Integrand}(\\eta) = C \\cdot (\\eta-5) \\cdot \\exp(-k(\\eta-5)^2)\n$$\n其中 $C$ 和 $k$ 是正常数。这是一个关于 $\\eta=5$ 的奇函数。积分是在关于 $\\eta=5$ 对称的区间 $[0, 10]$ 上进行的。奇函数在对称区间上的积分为零。\n$$\n\\delta_{ISW} = 0\n$$\n这个结果表明，一个以恒定速度和恒定内禀振幅（$f(\\eta)=1$）移动的势阱，在对称路径上同样不产生净积分效应。光子在接近移动势阱时经历的蓝移，被其离开时经历的红移完全抵消。\n\n最后一步是为案例B实现数值积分并格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the Integrated Sachs-Wolfe (ISW) effect for three test cases\n    based on a 1D toy model of an evolving gravitational potential.\n    \"\"\"\n\n    # Common parameters for all cases from the problem statement\n    PHI_0 = 1e-5\n    SIGMA = 1.0\n    L = 10.0\n    ETA_C = 5.0\n    \n    # Integration range\n    eta_e = 0.0\n    eta_o = L\n\n    # --- Test Case Definitions ---\n    # Each case is a dictionary of parameters for the potential Phi.\n    # f_eta: The time-varying amplitude function f(eta).\n    # fp_eta: The derivative of f(eta), f'(eta).\n    # vp: The drift speed of the potential well.\n    \n    test_cases = [\n        # Case A: Static well\n        {\n            'f_eta': lambda eta: 1.0,\n            'fp_eta': lambda eta: 0.0,\n            'vp': 0.0\n        },\n        # Case B: Decaying amplitude\n        {\n            'f_eta': lambda eta: 1.0 / (1.0 + (eta / 5.0)**2),\n            'fp_eta': lambda eta: -2.0 * eta / 25.0 / (1.0 + (eta / 5.0)**2)**2,\n            'vp': 0.0\n        },\n        # Case C: Moving well\n        {\n            'f_eta': lambda eta: 1.0,\n            'fp_eta': lambda eta: 0.0,\n            'vp': 0.3\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        f_eta = case['f_eta']\n        fp_eta = case['fp_eta']\n        vp = case['vp']\n\n        def integrand(eta: float) - float:\n            \"\"\"\n            Calculates the value of the integrand for delta_ISW at a given eta.\n            The integrand is 2 * (dPhi/deta), evaluated along the photon path.\n            \"\"\"\n            # Photon path x(eta) = eta - eta_c\n            # Potential center x_c(eta) = vp * (eta - eta_c)\n            eta_minus_etac = eta - ETA_C\n            \n            # Difference between photon and potential center position\n            x_minus_xc = (1.0 - vp) * eta_minus_etac\n            \n            # Gaussian part of the potential\n            exponent = - (x_minus_xc**2) / (2.0 * SIGMA**2)\n            gaussian_term = np.exp(exponent)\n            \n            # Derivative of amplitude function\n            f_prime_val = fp_eta(eta)\n            \n            # Amplitude function value\n            f_val = f_eta(eta)\n\n            # Term from the potential's movement\n            motion_term = f_val * x_minus_xc * vp / (SIGMA**2)\n\n            # The partial derivative d(Phi)/d(eta)\n            dPhi_deta = PHI_0 * gaussian_term * (f_prime_val + motion_term)\n            \n            return 2.0 * dPhi_deta\n\n        # Perform the numerical integration\n        # For cases A and C, the integral is analytically zero.\n        # This check avoids unnecessary numerical computation.\n        if (case['fp_eta'](ETA_C) == 0 and case['vp'] == 0) or \\\n           (case['f_eta'](ETA_C) == 1.0 and case['fp_eta'](ETA_C) == 0.0 and case['vp'] != 0.0):\n            # The first condition covers case A.\n            # The second covers Case C, where the integrand is an odd function over a symmetric interval.\n            integral_val = 0.0\n        else:\n            integral_val, _ = quad(integrand, eta_e, eta_o)\n\n        results.append(round(integral_val, 10))\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从玩具模型到实际计算的跨越，需要稳健的数值技术。这项实践专注于实现积分萨克斯-沃尔夫效应的完整视线积分，这涉及到将时变引力势源项与振荡的球贝塞尔函数进行积分。你将实现一种复合高斯-勒让德求积方案——这是数值宇宙学中的一个强大工具，并检验其收敛性，为处理更复杂的CMB各向异性计算做好准备。",
            "id": "3497924",
            "problem": "您的任务是为一个空间平坦、微扰的 Friedmann–Lemaître–Robertson–Walker 时空中的积分Sachs–Wolfe (ISW) 效应源项，实现一个共形时间下的数值视线积分。从共形牛顿规范及线元 $ds^2 = a^2(\\eta)\\left[-(1+2\\Psi)d\\eta^2 + (1-2\\Phi)d\\mathbf{x}^2\\right]$ 开始，其中 $\\eta$ 是共形时间，$a(\\eta)$ 是标度因子，$\\Phi$ 和 $\\Psi$ 是标量引力势。沿零测地线传播的光子会因最后散射时的瞬时引力红移以及沿视线方向引力势的时间变化而获得温度各向异性。积分Sachs–Wolfe (ISW) 效应源于引力势的时间变化，其源项定义为 $S_{\\mathrm{ISW}}(k,\\eta) = \\Phi'(k,\\eta) + \\Psi'(k,\\eta)$，其中撇号表示对共形时间 $\\eta$ 的导数，$k$ 是共动波数。\n\n考虑单个多极矩 $l$ 和模式 $k$ 的ISW贡献的视线多极矩空间投影积分，\n$I_l(k) = \\int_{\\eta_*}^{\\eta_0} d\\eta\\, S_{\\mathrm{ISW}}(k,\\eta)\\, j_l\\!\\left(k(\\eta_0-\\eta)\\right)$，\n其中 $j_l$ 是第一类 $l$ 阶球贝塞尔函数，$\\eta_*$ 表示最后散射时的共形时间，$\\eta_0$ 是今天的共形时间。为了进行数值实现，采用以下具有物理动机但简化的引力势及其时间导数模型：\n- $\\Phi(k,\\eta) = \\Phi_0(k)\\,\\exp\\!\\left(-\\eta/\\eta_d\\right)$，\n- $\\Psi(k,\\eta) = \\left(1+\\epsilon\\right)\\,\\Phi(k,\\eta)$，\n因此 $S_{\\mathrm{ISW}}(k,\\eta) = -\\dfrac{\\left(2+\\epsilon\\right)}{\\eta_d}\\,\\Phi_0(k)\\,\\exp\\!\\left(-\\eta/\\eta_d\\right)$。\n假设标度依赖性为 $\\Phi_0(k) = \\dfrac{A}{1+\\left(k/k_0\\right)^n}$。\n\n您的任务是为共形时间在区间 $\\eta \\in [\\eta_*,\\eta_0]$ 上的积分实现一个复合 $n$ 点高斯求积（高斯-勒让德）方法。将该区间划分为 $M$ 个相等的子区间，并在每个子区间上应用一个 $n$ 点高斯-勒让德法则；然后将各部分的贡献相加来近似 $I_l(k)$。为了测试收敛性，使用固定的 $n$ 对 $M$、$2M$ 和 $4M$（即每次将子区间大小减半）计算积分。作为一个高精度参考值 $I_l^{\\mathrm{ref}}(k)$，使用具有更多子区间 $M_{\\mathrm{ref}}$ 和更高阶数 $n_{\\mathrm{ref}}$ 的更精细的复合高斯-勒让德评估。\n\n使用光速 $c=1$ 的单位制，共形时间以 $\\mathrm{Mpc}$ 为单位，波数以 $\\mathrm{Mpc}^{-1}$ 为单位。输出 $I_l(k)$ 是无量纲的。特殊函数的角度必须使用弧度。您的程序必须使用一个标准的科学计算库函数来稳健地实现球贝塞尔函数 $j_l$。\n\n用于所有测试的全局常量：\n- $\\eta_0 = 14000\\,\\mathrm{Mpc}$，\n- $\\eta_* = 280\\,\\mathrm{Mpc}$，\n- $\\eta_d = 3000\\,\\mathrm{Mpc}$，\n- $\\epsilon = 0.1$，\n- $A = 2\\times 10^{-5}$，\n- $k_0 = 0.02\\,\\mathrm{Mpc}^{-1}$，\n- $n = 2$，\n- 每个子区间的基准高斯-勒让德节点数 $n_{\\mathrm{GL}} = 4$，\n- 参考复合高斯-勒让德参数 $M_{\\mathrm{ref}} = 4096$ 和 $n_{\\mathrm{ref}} = 8$。\n\n为形式为 $S_{\\mathrm{ISW}}(k,\\eta) \\, j_l\\!\\left(k(\\eta_0-\\eta)\\right)$ 的光滑但可能振荡的被积函数准确实现复合高斯-勒让德求积。确保在以下测试套件中的数值稳定性。\n\n测试套件：\n- 测试 $1$ （类超视界）：$k = 0.001\\,\\mathrm{Mpc}^{-1}$，$l = 2$，$M_0 = 16$。\n- 测试 $2$ （中等尺度）：$k = 0.02\\,\\mathrm{Mpc}^{-1}$，$l = 10$，$M_0 = 64$。\n- 测试 $3$ （振荡）：$k = 0.1\\,\\mathrm{Mpc}^{-1}$，$l = 30$，$M_0 = 128$。\n\n对于每个测试用例，计算：\n- $I_{M_0}$，使用 $M_0$ 个子区间和 $n_{\\mathrm{GL}}$ 个节点，\n- $I_{2M_0}$，使用 $2M_0$ 个子区间和 $n_{\\mathrm{GL}}$ 个节点，\n- $I_{4M_0}$，使用 $4M_0$ 个子区间和 $n_{\\mathrm{GL}}$ 个节点，\n- $I_{\\mathrm{ref}}$，使用 $M_{\\mathrm{ref}}$ 个子区间和 $n_{\\mathrm{ref}}$ 个节点，\n以及相对误差\n- $e_{M_0} = \\dfrac{\\left|I_{M_0}-I_{\\mathrm{ref}}\\right|}{\\max\\left(\\left|I_{\\mathrm{ref}}\\right|,10^{-20}\\right)}$，\n- $e_{2M_0} = \\dfrac{\\left|I_{2M_0}-I_{\\mathrm{ref}}\\right|}{\\max\\left(\\left|I_{\\mathrm{ref}}\\right|,10^{-20}\\right)}$，\n- $e_{4M_0} = \\dfrac{\\left|I_{4M_0}-I_{\\mathrm{ref}}\\right|}{\\max\\left(\\left|I_{\\mathrm{ref}}\\right|,10^{-20}\\right)}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个列表的列表，每个内部列表对应一个测试用例，每个内部列表按以下顺序包含7个浮点数：\n$[I_{M_0}, I_{2M_0}, I_{4M_0}, I_{\\mathrm{ref}}, e_{M_0}, e_{2M_0}, e_{4M_0}]$。\n- 该行必须精确格式化为用方括号括起来的逗号分隔列表，不含空格，例如：\n$[[r_{11},r_{12},\\dots,r_{17}],[r_{21},\\dots,r_{27}],[r_{31},\\dots,r_{37}]]$，\n其中每个 $r_{ij}$ 是一个十进制表示法的浮点数。",
            "solution": "该问题要求对特定多极矩 $l$ 和共动波数 $k$ 下，积分Sachs-Wolfe (ISW) 效应 对宇宙微波背景温度各向异性的贡献进行数值评估。\n\n首先，我们必须验证问题陈述的有效性。\n\n### 第一步：提取已知条件\n-   **共形牛顿规范中的线元**：$ds^2 = a^2(\\eta)\\left[-(1+2\\Psi)d\\eta^2 + (1-2\\Phi)d\\mathbf{x}^2\\right]$。\n-   **ISW源项**：$S_{\\mathrm{ISW}}(k,\\eta) = \\Phi'(k,\\eta) + \\Psi'(k,\\eta)$，其中撇号表示 $\\frac{d}{d\\eta}$。\n-   **视线积分**：$I_l(k) = \\int_{\\eta_*}^{\\eta_0} d\\eta\\, S_{\\mathrm{ISW}}(k,\\eta)\\, j_l\\!\\left(k(\\eta_0-\\eta)\\right)$。\n-   **积分极限**：最后散射时的共形时间 $\\eta_*$ 和今天的共形时间 $\\eta_0$。\n-   **引力势模型**：\n    -   $\\Phi(k,\\eta) = \\Phi_0(k)\\,\\exp\\!\\left(-\\eta/\\eta_d\\right)$。\n    -   $\\Psi(k,\\eta) = \\left(1+\\epsilon\\right)\\,\\Phi(k,\\eta)$。\n-   **得到的ISW源项**：$S_{\\mathrm{ISW}}(k,\\eta) = -\\dfrac{\\left(2+\\epsilon\\right)}{\\eta_d}\\,\\Phi_0(k)\\,\\exp\\!\\left(-\\eta/\\eta_d\\right)$。\n-   **引力势的标度依赖性**：$\\Phi_0(k) = \\dfrac{A}{1+\\left(k/k_0\\right)^n}$。\n-   **数值方法**：使用 $M$ 个相等子区间的复合 $n$ 点高斯-勒让德求积。\n-   **全局常量**：\n    -   $\\eta_0 = 14000\\,\\mathrm{Mpc}$。\n    -   $\\eta_* = 280\\,\\mathrm{Mpc}$。\n    -   $\\eta_d = 3000\\,\\mathrm{Mpc}$。\n    -   $\\epsilon = 0.1$。\n    -   $A = 2\\times 10^{-5}$。\n    -   $k_0 = 0.02\\,\\mathrm{Mpc}^{-1}$。\n    -   $n = 2$。\n    -   基准求积节点数：$n_{\\mathrm{GL}} = 4$。\n    -   参考求积参数：$M_{\\mathrm{ref}} = 4096$，$n_{\\mathrm{ref}} = 8$。\n-   **测试套件**：\n    -   测试 $1$：$k = 0.001\\,\\mathrm{Mpc}^{-1}$，$l = 2$，$M_0 = 16$。\n    -   测试 $2$：$k = 0.02\\,\\mathrm{Mpc}^{-1}$，$l = 10$，$M_0 = 64$。\n    -   测试 $3$：$k = 0.1\\,\\mathrm{Mpc}^{-1}$，$l = 30$，$M_0 = 128$。\n-   **所需计算**：$I_{M_0}$、$I_{2M_0}$、$I_{4M_0}$、$I_{\\mathrm{ref}}$ 以及相对误差 $e_{M_0}$、$e_{2M_0}$、$e_{4M_0}$。\n-   **相对误差定义**：$e_{X} = \\dfrac{\\left|I_{X}-I_{\\mathrm{ref}}\\right|}{\\max\\left(\\left|I_{\\mathrm{ref}}\\right|,10^{-20}\\right)}$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题陈述清晰且有科学依据。它提出了物理宇宙学中的一个标准计算，具体而言是宇宙微波背景各向异性源项的视线积分。所提供的引力势模型是简化的，但具有物理动机，代表了宇宙晚期加速期间势的衰减（“晚期”ISW效应）。从给定的 $\\Phi$ 和 $\\Psi$ 推导 $S_{\\mathrm{ISW}}(k,\\eta)$ 的过程是正确的。所有参数、常数和函数都已明确定义，任务是直接应用指定的数值方法（复合高斯-勒让德求积）到一个定义明确的积分。该问题没有矛盾、歧义和事实错误。\n\n### 第三步：结论与行动\n问题有效。将提供一个合理的解决方案。\n\n### 基于原理的解决方案设计\n\n核心任务是计算定积分 $I_l(k) = \\int_{\\eta_*}^{\\eta_0} d\\eta\\, f_{l,k}(\\eta)$，其中被积函数由下式给出\n$$\nf_{l,k}(\\eta) = S_{\\mathrm{ISW}}(k,\\eta)\\, j_l\\!\\left(k(\\eta_0-\\eta)\\right)\n$$\nISW源项 $S_{\\mathrm{ISW}}(k,\\eta)$ 是根据提供的引力势 $\\Phi(k, \\eta)$ 和 $\\Psi(k, \\eta)$ 模型构建的。\n$$\nS_{\\mathrm{ISW}}(k,\\eta) = \\frac{d}{d\\eta} \\left[ \\Phi(k,\\eta) + \\Psi(k,\\eta) \\right] = (2+\\epsilon) \\frac{d}{d\\eta} \\left[ \\Phi_0(k) e^{-\\eta/\\eta_d} \\right] = -\\frac{2+\\epsilon}{\\eta_d} \\Phi_0(k) e^{-\\eta/\\eta_d}\n$$\n标度依赖部分为 $\\Phi_0(k) = \\frac{A}{1+(k/k_0)^n}$。\n综合起来，被积函数为：\n$$\nf_{l,k}(\\eta) = \\left[ -\\frac{A(2+\\epsilon)}{\\eta_d \\left(1+(k/k_0)^n\\right)} \\right] e^{-\\eta/\\eta_d} j_l\\!\\left(k(\\eta_0-\\eta)\\right)\n$$\n对于给定的 $k$，方括号中的项是一个常数前置因子，可以在每次积分前计算一次。第一类球贝塞尔函数 $j_l(x)$ 和指数函数是标准的库函数。\n\n数值方法是复合高斯-勒让德求积。为评估积分 $\\int_a^b g(x) dx$，我们将区间 $[a, b]$ 划分为 $M$ 个相等的子区间。在我们的问题中，$a=\\eta_*$，$b=\\eta_0$。每个子区间的宽度为 $h = (\\eta_0 - \\eta_*)/M$。第 $i$ 个子区间为 $[\\eta_i, \\eta_{i+1}] = [\\eta_*+ih, \\eta_*+(i+1)h]$，其中 $i = 0, 1, \\dots, M-1$。\n\n单个子区间上的积分由一个 $n_{\\mathrm{GL}}$ 点高斯-勒让德法则来近似。这涉及将变量从 $\\eta \\in [\\eta_i, \\eta_{i+1}]$ 变换到规范变量 $t \\in [-1, 1]$：\n$$\n\\eta(t) = \\frac{\\eta_{i+1}-\\eta_i}{2} t + \\frac{\\eta_{i+1}+\\eta_i}{2} = \\frac{h}{2} t + \\left(\\eta_* + (i+1/2)h\\right)\n$$\n微分变为 $d\\eta = \\frac{h}{2} dt$。子区间上的积分则为：\n$$\n\\int_{\\eta_i}^{\\eta_{i+1}} f_{l,k}(\\eta) d\\eta = \\int_{-1}^{1} f_{l,k}(\\eta(t)) \\frac{h}{2} dt \\approx \\frac{h}{2} \\sum_{j=1}^{n_{\\mathrm{GL}}} w_j f_{l,k}(\\eta(t_j))\n$$\n其中 $t_j$ 和 $w_j$ 是 $[-1, 1]$ 上 $n_{\\mathrm{GL}}$ 点高斯-勒让德求积的节点和权重。\n\n总积分是所有 $M$ 个子区间贡献的总和：\n$$\nI_l(k) \\approx \\sum_{i=0}^{M-1} \\left( \\frac{h}{2} \\sum_{j=1}^{n_{\\mathrm{GL}}} w_j f_{l,k}\\left( \\eta_* + h(i + \\frac{1+t_j}{2}) \\right) \\right)\n$$\n这个公式是稳健的，将被实现。节点 $t_j$ 和权重 $w_j$ 将从 `scipy.special.roots_legendre` 中获取。第一类球贝塞尔函数 $j_l(x)$ 将使用 `scipy.special.spherical_jn` 计算。\n\n算法流程如下：\n$1.$ 定义一个函数 `composite_gauss_legendre`，它接受被积函数、积分极限 $[\\eta_*, \\eta_0]$、子区间数量 $M$ 和每个子区间的求积点数 $n_{\\mathrm{GL}}$ 作为输入。\n$2.$ 该函数首先将获取 $n_{\\mathrm{GL}}$ 点的标准勒让德节点和权重。\n$3.$ 然后它将从 $i=0$ 到 $M-1$ 迭代，对于每个子区间，它将在 $n_{\\mathrm{GL}}$ 个变换后的节点上执行加权和，并累加结果。$h/2$ 的因子将应用于最终总和。\n$4.$ 对于问题中定义的每个测试用例，我们将使用给定的参数 $(k, l)$ 定义特定的被积函数。\n$5.$ 我们将调用求积函数四次，以计算 $I_{M_0}$、$I_{2M_0}$、$I_{4M_0}$（使用 $n_{\\mathrm{GL}}=4$）和高精度参考值 $I_{\\mathrm{ref}}$（使用 $M_{\\mathrm{ref}}$ 和 $n_{\\mathrm{ref}}=8$）。\n$6.$ 最后，我们将使用指定的公式计算三个相对误差 $e_{M_0}, e_{2M_0}, e_{4M_0}$，该公式包含一个 $10^{-20}$ 的除数下限以确保数值稳定性。\n$7.$ 每个测试用例的七个量将被收集并格式化为所需的字符串输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, roots_legendre\n\ndef solve():\n    \"\"\"\n    Solves the numerical integration problem for the ISW effect.\n    \"\"\"\n    # Global constants\n    ETA_0 = 14000.0   # Conformal time today [Mpc]\n    ETA_STAR = 280.0  # Conformal time at last scattering [Mpc]\n    ETA_D = 3000.0    # Decay time scale for potentials [Mpc]\n    EPSILON = 0.1     # Anisotropic stress parameter, (Psi = (1+epsilon)*Phi)\n    A = 2.0e-5        # Amplitude of primordial potential\n    K0 = 0.02         # Pivot scale for potential [Mpc^-1]\n    N_SCALAR = 2.0    # Scalar index for potential model\n    N_GL = 4          # Base Gauss-Legendre nodes per subinterval\n    M_REF = 4096      # Number of subintervals for reference calculation\n    N_REF = 8         # Number of nodes for reference calculation\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (k [Mpc^-1], l, M0)\n        (0.001, 2, 16),\n        (0.02, 10, 64),\n        (0.1, 30, 128),\n    ]\n\n    memoized_roots = {}\n\n    def get_roots(n_points):\n        \"\"\"Memoize Gauss-Legendre roots and weights.\"\"\"\n        if n_points not in memoized_roots:\n            memoized_roots[n_points] = roots_legendre(n_points)\n        return memoized_roots[n_points]\n\n    def isw_integrand(eta, k, l, s_prefactor):\n        \"\"\"\n        Calculates the value of the ISW integrand at a given conformal time eta.\n        \"\"\"\n        arg_bessel = k * (ETA_0 - eta)\n        bessel_val = spherical_jn(l, arg_bessel)\n        exp_val = np.exp(-eta / ETA_D)\n        return s_prefactor * exp_val * bessel_val\n\n    def composite_gauss_legendre(integrand_func, m, n_points):\n        \"\"\"\n        Performs composite Gauss-Legendre quadrature.\n\n        Args:\n            integrand_func: The function to integrate, taking eta as an argument.\n            m: The number of subintervals.\n            n_points: The number of Gauss-Legendre nodes per subinterval.\n\n        Returns:\n            The numerical value of the integral.\n        \"\"\"\n        if m == 0:\n            return 0.0\n            \n        a, b = ETA_STAR, ETA_0\n        h = (b - a) / m\n        nodes, weights = get_roots(n_points)\n\n        total_integral = 0.0\n        \n        # Vectorized evaluation for efficiency\n        # Create an array of all evaluation points\n        # i_indices is broadcasted to (m, 1)\n        # nodes is broadcasted to (1, n_points)\n        i_indices = np.arange(m).reshape(-1, 1)\n        # Transformation from canonical interval [-1, 1] to each subinterval\n        eta_eval_points = a + h * (i_indices + (1.0 + nodes) / 2.0)\n        \n        integrand_values = integrand_func(eta_eval_points)\n        \n        # Sum over nodes (axis=1) and then over subintervals (axis=0)\n        total_integral = (h / 2.0) * np.sum(integrand_values @ weights)\n\n        return total_integral\n\n    results = []\n    for k, l, m0 in test_cases:\n        # Pre-calculate the constant part of the integrand source term\n        phi0_k = A / (1.0 + (k / K0)**N_SCALAR)\n        s_prefactor = -(2.0 + EPSILON) / ETA_D * phi0_k\n\n        # Create a specific integrand function for the current (k, l)\n        integrand = lambda eta: isw_integrand(eta, k, l, s_prefactor)\n\n        # Calculate the integrals for M0, 2*M0, 4*M0\n        i_m0 = composite_gauss_legendre(integrand, m0, N_GL)\n        i_2m0 = composite_gauss_legendre(integrand, 2 * m0, N_GL)\n        i_4m0 = composite_gauss_legendre(integrand, 4 * m0, N_GL)\n        \n        # Calculate the high-accuracy reference integral\n        i_ref = composite_gauss_legendre(integrand, M_REF, N_REF)\n        \n        # Calculate relative errors\n        ref_abs = abs(i_ref)\n        denominator = max(ref_abs, 1.0e-20)\n        \n        e_m0 = abs(i_m0 - i_ref) / denominator\n        e_2m0 = abs(i_2m0 - i_ref) / denominator\n        e_4m0 = abs(i_4m0 - i_ref) / denominator\n\n        # Collect the 7 required float values for the current test case\n        case_results = [i_m0, i_2m0, i_4m0, i_ref, e_m0, e_2m0, e_4m0]\n        results.append(case_results)\n\n    # Format the final output string exactly as specified\n    outer_list_str = \",\".join([f\"[{','.join([f'{val:.15e}' for val in inner_list])}]\" for inner_list in results])\n    print(f\"[{outer_list_str}]\")\n\n\nsolve()\n```"
        }
    ]
}