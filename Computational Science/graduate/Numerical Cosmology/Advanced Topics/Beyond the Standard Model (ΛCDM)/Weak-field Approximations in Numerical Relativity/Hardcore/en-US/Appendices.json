{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of weak-field gravity is the Poisson equation, which relates the gravitational potential to the matter distribution. Before tackling complex time-dependent simulations, it is crucial to understand how to solve this equation numerically and to quantify the errors introduced by discretization. This practice contrasts a highly accurate spectral method with a more common finite-difference approach, guiding you to derive a closed-form expression for the numerical error . This analysis provides fundamental insight into how grid resolution affects accuracy and is a foundational skill for developing and validating numerical codes.",
            "id": "3502863",
            "problem": "Consider a periodic cubic cosmological box of side length $L$ in comoving coordinates, discretized by a uniform Cartesian grid of $N$ points in each direction with spacing $\\Delta x = L/N$. In the weak-field approximation of General Relativity, the scalar potential $ \\Phi $ in the conformal Newtonian gauge obeys a Poisson-type equation in comoving coordinates, \n$$\n\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x}),\n$$\nwhere $S(\\mathbf{x})$ is proportional to $4 \\pi G a^{2} \\bar{\\rho}\\,\\delta(\\mathbf{x})$ but may be treated here as a generic source with zero spatial mean. Assume periodic boundary conditions on $[0,L]^{3}$. \n\nFocus on a single, resolved, separable plane-wave source directed along the $x$-axis,\n$$\nS(\\mathbf{x}) = S_{0} \\cos(k x),\n$$\nwith $k = 2 \\pi m / L$ and integer mode number $m$ satisfying $1 \\leq m \\leq \\frac{N}{2} - 1$ to avoid Nyquist aliasing. \n\nTwo numerical methods are considered for solving the discrete version of the equation:\n\n- A spectral method using the Discrete Fourier Transform (DFT), which inverts the Laplacian mode-by-mode in Fourier space for nonzero wavevectors and sets the zero wavenumber mode $ \\Phi_{\\mathbf{k}=\\mathbf{0}} $ to zero to fix the gauge (constant offset) of the potential.\n\n- A second-order central-difference finite-difference method on the grid with periodic boundary conditions, using the discrete Laplacian stencil in the $x$-direction,\n$$\n(\\nabla^{2} \\Phi)_{j} \\equiv \\frac{\\Phi_{j+1} - 2 \\Phi_{j} + \\Phi_{j-1}}{\\Delta x^{2}},\n$$\nand analogous stencils in $y$ and $z$, where indices are taken modulo $N$.\n\nStarting from fundamental definitions of the continuous Laplacian and its discrete second-order central-difference approximation, and using only the stated properties of the DFT and periodicity, derive the discrete eigenvalue of the finite-difference Laplacian acting on the sampled plane wave in one dimension. Then use this to obtain the closed-form expression for the relative amplitude error of the finite-difference solution for the single-mode source compared to the exact continuous solution,\n$$\nE_{\\mathrm{fd}}(k,N,L) \\equiv \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}},\n$$\nunder the convention that the zero-wavenumber mode of the potential is set to zero in both methods. Your final answer must be the single closed-form analytic expression for $E_{\\mathrm{fd}}(k,N,L)$ in terms of $k$, $N$, and $L$. Do not provide any intermediate steps, and do not include any units in your final answer. Additionally, state in your derivation how the spectral method treats the zero mode and how this affects its error for this source.\n\nNo rounding is required. Express the final relative error as a dimensionless analytic expression.",
            "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n- **Governing Equation:** Poisson-type equation $\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x})$.\n- **Domain:** Periodic cubic box of side length $L$ in comoving coordinates, $[0,L]^{3}$.\n- **Discretization:** Uniform Cartesian grid with $N$ points per direction, grid spacing $\\Delta x = L/N$.\n- **Source Term:** A single plane-wave $S(\\mathbf{x}) = S_{0} \\cos(k x)$.\n- **Wavenumber:** $k = 2 \\pi m / L$, with integer $m$ satisfying $1 \\leq m \\leq \\frac{N}{2} - 1$.\n- **Source Property:** Zero spatial mean.\n- **Boundary Conditions:** Periodic.\n- **Spectral Method:** Inverts the Laplacian mode-by-mode in Fourier space. Sets the zero-wavenumber mode of the potential $\\Phi_{\\mathbf{k}=\\mathbf{0}}$ to zero.\n- **Finite-Difference (FD) Method:** Uses a second-order central-difference stencil for the Laplacian, e.g., $(\\nabla^{2} \\Phi)_{j} \\equiv \\frac{\\Phi_{j+1} - 2 \\Phi_{j} + \\Phi_{j-1}}{\\Delta x^{2}}$ for the $x$-direction, with indices modulo $N$.\n- **Error Definition:** The relative amplitude error is $E_{\\mathrm{fd}}(k,N,L) \\equiv \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}}$.\n- **Gauge Convention:** The zero-wavenumber mode of the potential is set to zero for all solutions.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It presents a standard numerical analysis problem in the context of computational physics. The governing equation is fundamental, the source term is well-defined and satisfies the stated 'zero spatial mean' property for $m \\ge 1$. The boundary conditions and gauge fixing ($\\Phi_{\\mathbf{k}=\\mathbf{0}}=0$) ensure a unique solution. The constraint on the mode number $m$ ensures the wave is resolved and not at the Nyquist frequency, which is a standard consideration in discrete methods. The problem is self-contained, and its terms are defined unambiguously. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full, reasoned solution will be provided.\n\n### Solution Derivation\nThe objective is to find the relative error of the finite-difference solution's amplitude compared to the exact continuous solution's amplitude for a single Fourier mode.\n\n**1. Exact Continuous Solution**\nThe given equation is $\\nabla^{2} \\Phi(\\mathbf{x}) = S(\\mathbf{x})$. Since the source term $S(\\mathbf{x}) = S_{0} \\cos(k x)$ depends only on the coordinate $x$, the potential $\\Phi$ will also depend only on $x$, so that $\\nabla^{2} \\Phi = \\frac{d^{2}\\Phi}{dx^{2}}$. The equation simplifies to:\n$$\n\\frac{d^{2}\\Phi}{dx^{2}} = S_{0} \\cos(k x)\n$$\nWe seek a solution of the form $\\Phi(x) = \\Phi^{\\mathrm{exact}}_{k} \\cos(k x)$, where $\\Phi^{\\mathrm{exact}}_{k}$ is the amplitude of the mode. Differentiating this ansatz twice with respect to $x$ yields:\n$$\n\\frac{d\\Phi}{dx} = -\\Phi^{\\mathrm{exact}}_{k} k \\sin(k x)\n$$\n$$\n\\frac{d^{2}\\Phi}{dx^{2}} = -\\Phi^{\\mathrm{exact}}_{k} k^{2} \\cos(k x)\n$$\nSubstituting this back into the differential equation gives:\n$$\n-\\Phi^{\\mathrm{exact}}_{k} k^{2} \\cos(k x) = S_{0} \\cos(k x)\n$$\nFor this equality to hold for all $x$, the coefficients must be equal. This gives the amplitude of the exact solution:\n$$\n\\Phi^{\\mathrm{exact}}_{k} = -\\frac{S_{0}}{k^{2}}\n$$\nThe problem specifies that the zero-wavenumber mode of the potential is zero. For $k = 2\\pi m/L$ with $m \\ge 1$, the integral of $\\cos(kx)$ over one period $L$ is zero. Thus, the exact solution $\\Phi(x) = -\\frac{S_{0}}{k^{2}} \\cos(k x)$ has zero mean and satisfies this condition.\n\n**2. Note on the Spectral Method**\nThe problem mentions a spectral method. This method solves the equation in Fourier space, where the Laplacian operator $\\nabla^2$ becomes an algebraic multiplication by $-|\\mathbf{k}|^2$. For discrete data, the Discrete Fourier Transform (DFT) is used. On the grid, the source is sampled as $S_j = S_{0} \\cos(k x_j)$. The DFT of this sampled function has non-zero components only at the discrete wavenumbers corresponding to $\\pm k$. The spectral method calculates the Fourier coefficients $\\hat{\\Phi}_{\\mathbf{k}}$ from the source's coefficients $\\hat{S}_{\\mathbf{k}}$ via $\\hat{\\Phi}_{\\mathbf{k}} = - \\hat{S}_{\\mathbf{k}} / |\\mathbf{k}|^2$ for non-zero wavenumbers. Since the source is a single plane wave that is periodic on the grid (as guaranteed by $k = 2\\pi m/L$), the DFT and the action of the discrete Laplacian in Fourier space are exact. Therefore, the spectral method yields the exact solution for this particular source, and its error is zero. The condition to set $\\Phi_{\\mathbf{k}=\\mathbf{0}}=0$ is a gauge-fixing choice. The source's mean is zero, so its $\\mathbf{k}=\\mathbf{0}$ Fourier component is also zero, $\\hat{S}_{\\mathbf{k}=\\mathbf{0}}=0$. The equation for the zero mode, $0 \\cdot \\hat{\\Phi}_{\\mathbf{k}=\\mathbf{0}} = \\hat{S}_{\\mathbf{k}=\\mathbf{0}} = 0$, is indeterminate. Setting $\\hat{\\Phi}_{\\mathbf{k}=\\mathbf{0}}=0$ makes the solution unique and matches the exact continuous solution.\n\n**3. Finite-Difference Solution**\nThe discrete form of the Poisson equation is $(\\nabla^{2}_{\\mathrm{fd}} \\Phi)_{j} = S_j$, where $(\\nabla^{2}_{\\mathrm{fd}} \\Phi)_{j}$ is the second-order central difference approximation of the Laplacian and $S_j = S_0 \\cos(k x_j)$ is the source sampled at grid points $x_j = j \\Delta x$ for $j \\in \\{0, 1, ..., N-1\\}$. We look for a solution of the form $\\Phi^{\\mathrm{fd}}_{j} = \\Phi^{\\mathrm{fd}}_{k} \\cos(k x_j)$. To find the amplitude $\\Phi^{\\mathrm{fd}}_{k}$, we first determine the discrete eigenvalue of the finite-difference Laplacian acting on the mode $\\cos(k x_j)$.\n$$\n(\\nabla^{2}_{\\mathrm{fd}} \\cos(k x_j)) = \\frac{\\cos(k x_{j+1}) - 2 \\cos(k x_j) + \\cos(k x_{j-1})}{(\\Delta x)^{2}}\n$$\nUsing $x_{j \\pm 1} = x_j \\pm \\Delta x$ and the trigonometric identity $\\cos(A+B) + \\cos(A-B) = 2\\cos(A)\\cos(B)$, we have:\n$$\n\\cos(k(x_j + \\Delta x)) + \\cos(k(x_j - \\Delta x)) = 2 \\cos(k x_j) \\cos(k \\Delta x)\n$$\nSubstituting this into the finite-difference expression:\n$$\n(\\nabla^{2}_{\\mathrm{fd}} \\cos(k x_j)) = \\frac{2 \\cos(k x_j) \\cos(k \\Delta x) - 2 \\cos(k x_j)}{(\\Delta x)^{2}} = \\left[ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} \\right] \\cos(k x_j)\n$$\nThe term in brackets is the eigenvalue of the discrete Laplacian operator for the mode with wavenumber $k$. The discrete equation becomes:\n$$\n\\Phi^{\\mathrm{fd}}_{k} \\left[ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} \\right] \\cos(k x_j) = S_{0} \\cos(k x_j)\n$$\nSolving for the finite-difference amplitude $\\Phi^{\\mathrm{fd}}_{k}$:\n$$\n\\Phi^{\\mathrm{fd}}_{k} = \\frac{S_{0}}{ \\frac{2(\\cos(k \\Delta x) - 1)}{(\\Delta x)^{2}} } = \\frac{S_{0} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)}\n$$\n\n**4. Relative Amplitude Error**\nThe relative error is defined as $E_{\\mathrm{fd}} = \\frac{\\Phi^{\\mathrm{fd}}_{k} - \\Phi^{\\mathrm{exact}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = \\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} - 1$. We compute the ratio of the amplitudes:\n$$\n\\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = \\frac{ \\frac{S_{0} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)} }{ -\\frac{S_{0}}{k^{2}} } = -\\frac{k^{2} (\\Delta x)^{2}}{2(\\cos(k \\Delta x) - 1)}\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2 \\sin^{2}(\\theta/2)$, we can write $\\cos(k \\Delta x) - 1 = -2 \\sin^{2}(k \\Delta x / 2)$.\n$$\n\\frac{\\Phi^{\\mathrm{fd}}_{k}}{\\Phi^{\\mathrm{exact}}_{k}} = -\\frac{k^{2} (\\Delta x)^{2}}{2(-2 \\sin^{2}(k \\Delta x / 2))} = \\frac{k^{2} (\\Delta x)^{2}}{4 \\sin^{2}(k \\Delta x / 2)}\n$$\nThe relative error is therefore:\n$$\nE_{\\mathrm{fd}} = \\frac{k^{2} (\\Delta x)^{2}}{4 \\sin^{2}(k \\Delta x / 2)} - 1\n$$\nFinally, we substitute $\\Delta x = L/N$ to express the error in terms of the given parameters $k$, $N$, and $L$.\n$$\nE_{\\mathrm{fd}}(k,N,L) = \\frac{k^{2} (L/N)^{2}}{4 \\sin^{2}(k L / (2N))} - 1 = \\frac{k^{2} L^{2}}{4 N^{2} \\sin^{2}\\left(\\frac{k L}{2 N}\\right)} - 1\n$$\nThis is the closed-form expression for the relative amplitude error of the finite-difference solution.",
            "answer": "$$\n\\boxed{\\frac{k^{2} L^{2}}{4 N^{2} \\sin^{2}\\left(\\frac{k L}{2 N}\\right)} - 1}\n$$"
        },
        {
            "introduction": "Having analyzed a static equation, we now turn to the dynamics of weak-field gravity by studying the propagation of gravitational waves. In the simplest case, this is described by the scalar wave equation. A primary technique for validating any evolution code is to test it against a known analytic solution, allowing for a precise measurement of numerical errors that accumulate over time . This exercise will give you hands-on experience implementing a standard time-stepping algorithm and quantifying its numerical dissipation (amplitude error) and dispersion (phase error), two critical metrics for the performance of any wave-propagating code.",
            "id": "3502846",
            "problem": "Consider linearized General Relativity in vacuum on a flat background spacetime. Let the spacetime metric be written as $g_{\\mu\\nu} = \\eta_{\\mu\\nu} + h_{\\mu\\nu}$, where $\\eta_{\\mu\\nu}$ is the Minkowski metric and $h_{\\mu\\nu}$ is a small perturbation with $|h_{\\mu\\nu}| \\ll 1$. In the Lorenz gauge and vacuum, the trace-reversed perturbation obeys the homogeneous wave equation. In the Transverse-Traceless (TT) gauge, each independent metric-perturbation component $h_{ij}^{\\mathrm{TT}}$ obeys the scalar wave equation\n$$\n\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2},\n$$\nin one spatial dimension $x$ for a representative component, where $c$ is the speed of light. In geometric units often used in numerical relativity, set $c=1$.\n\nYou are asked to validate a numerical time-evolution code by evolving an exact analytic weak-field plane-wave solution and quantifying phase and amplitude errors as functions of the timestep $\\Delta t$ and the grid spacing $\\Delta x$. The analytic solution to be used is\n$$\nh(x,t) = A \\cos(k x - \\omega t),\n$$\nwith $A=10^{-6}$, $k = 2\\pi m$, $m=4$, $\\omega = c k$, and periodic boundary conditions on $x \\in [0,L)$ with $L=1$. The initial conditions at $t=0$ are\n$$\nh(x,0) = A \\cos(k x), \\quad \\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} = \\omega A \\sin(k x).\n$$\n\nUse a second-order accurate explicit finite-difference scheme in both space and time on a uniform grid with $N_x$ points and spacing $\\Delta x = L/N_x$. Impose periodic boundary conditions. Define the Courant number $C = c \\Delta t / \\Delta x$. The time-update for $n \\ge 1$ must be implemented as\n$$\nh_j^{n+1} = 2 h_j^n - h_j^{n-1} + C^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right),\n$$\nwhere $j$ indexes grid points and $n$ indexes time levels. The first step $h_j^{1}$ must be obtained from a Taylor expansion consistent with the wave equation using the discrete Laplacian:\n$$\nh_j^{1} = h_j^{0} + \\Delta t \\left(\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0}\\right)_j + \\frac{1}{2} \\Delta t^2 \\, c^2 \\, \\left(\\frac{\\partial^2 h}{\\partial x^2}\\right)_j^{0,\\mathrm{disc}},\n$$\nwhere the discrete Laplacian is\n$$\n\\left(\\frac{\\partial^2 h}{\\partial x^2}\\right)_j^{0,\\mathrm{disc}} = \\frac{h_{j+1}^0 - 2 h_{j}^0 + h_{j-1}^0}{\\Delta x^2}.\n$$\n\nEvolve the solution to a target time $t_{\\mathrm{target}} = \\alpha T$, where $T = 2\\pi / \\omega$ is the analytic period and $\\alpha = 0.37$. Use an integer number of timesteps $N_t = \\mathrm{round}(t_{\\mathrm{target}}/\\Delta t)$ and set $t_{\\mathrm{final}} = N_t \\Delta t$.\n\nAt $t_{\\mathrm{final}}$, compute the numerical amplitude $A_{\\mathrm{num}}$ and phase $\\phi_{\\mathrm{num}}$ of the plane-wave mode with index $m$ by projecting the numerical solution onto the basis functions $\\cos(k x)$ and $\\sin(k x)$:\n$$\nC = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\cos(k x_j), \\quad S = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\sin(k x_j),\n$$\n$$\nA_{\\mathrm{num}} = \\frac{2}{N_x} \\sqrt{C^2 + S^2}, \\quad \\phi_{\\mathrm{num}} = \\mathrm{atan2}(S, C).\n$$\nThe analytic phase at $t_{\\mathrm{final}}$ is $\\phi_{\\mathrm{true}} = \\omega t_{\\mathrm{final}}$. Quantify:\n- The amplitude error as the absolute difference $E_A = \\lvert A_{\\mathrm{num}} - A \\rvert$ (dimensionless, the same units as $h$).\n- The phase error as the absolute principal-value difference $E_\\phi = \\left\\lvert \\mathrm{Arg}\\left(e^{i(\\phi_{\\mathrm{num}} - \\phi_{\\mathrm{true}})}\\right) \\right\\rvert$ in radians, where $\\mathrm{Arg}(\\cdot)$ maps angles to $(-\\pi,\\pi]$.\n\nUse the following test suite of parameter values to explore error behavior across stable Courant numbers and resolutions:\n- Case $1$: $N_x = 128$, $\\Delta x = L/N_x$, $\\Delta t = 0.5 \\Delta x$.\n- Case $2$: $N_x = 64$, $\\Delta x = L/N_x$, $\\Delta t = 0.8 \\Delta x$.\n- Case $3$: $N_x = 32$, $\\Delta x = L/N_x$, $\\Delta t = 0.99 \\Delta x$.\n- Case $4$: $N_x = 16$, $\\Delta x = L/N_x$, $\\Delta t = 0.5 \\Delta x$.\n\nAll quantities are dimensionless, except the phase error $E_\\phi$, which must be expressed in radians. Your program must compute $(E_A, E_\\phi)$ for each test case and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format\n$$\n\\left[ [E_{A,1},E_{\\phi,1}], [E_{A,2},E_{\\phi,2}], [E_{A,3},E_{\\phi,3}], [E_{A,4},E_{\\phi,4}] \\right],\n$$\nwith each entry being a floating-point number. Angles must be handled in radians. No user input is required; all parameters are specified above and must be hard-coded in your solution.",
            "solution": "The problem requires the validation of a numerical scheme for the one-dimensional scalar wave equation, which serves as a model for weak-field gravitational waves in the Transverse-Traceless (TT) gauge. The validation is performed by evolving an exact analytic plane-wave solution and quantifying the numerical amplitude and phase errors.\n\nThe governing equation is the scalar wave equation in one spatial dimension $x$ and time $t$:\n$$\n\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2}\n$$\nIn accordance with the problem statement, we adopt geometric units where the speed of light is $c=1$. The problem is solved on a periodic spatial domain $x \\in [0,L)$ with $L=1$.\n\nThe exact analytic solution used as a benchmark is a plane wave:\n$$\nh(x,t) = A \\cos(k x - \\omega t)\n$$\nThe parameters are given as amplitude $A=10^{-6}$, mode number $m=4$, wavenumber $k=2\\pi m$, and angular frequency $\\omega=ck=k$. The initial conditions at $t=0$ are derived from this analytic solution:\n$$\nh(x,0) = A \\cos(k x)\n$$\n$$\n\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} = \\omega A \\sin(k x)\n$$\n\nThe numerical solution is computed on a uniform grid with $N_x$ spatial points $x_j = j \\Delta x$ for $j=0, 1, \\dots, N_x-1$, where the grid spacing is $\\Delta x = L/N_x$. The time is discretized with a constant timestep $\\Delta t$. The Courant number is defined as $C = c \\Delta t / \\Delta x = \\Delta t / \\Delta x$.\n\nThe numerical scheme is a second-order accurate finite-difference method. The spatial second derivative is approximated by the standard three-point central difference stencil:\n$$\n\\left.\\frac{\\partial^2 h}{\\partial x^2}\\right|_{x_j, t^n} \\approx \\frac{h_{j+1}^n - 2 h_j^n + h_{j-1}^n}{\\Delta x^2}\n$$\nwhere $h_j^n$ denotes the numerical approximation of $h(x_j, t^n = n\\Delta t)$. Substituting this into the wave equation gives the explicit leapfrog time-stepping scheme, which is rearranged to solve for the solution at the next time level, $h_j^{n+1}$:\n$$\nh_j^{n+1} = 2 h_j^n - h_j^{n-1} + \\left(\\frac{\\Delta t}{\\Delta x}\\right)^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right) = 2 h_j^n - h_j^{n-1} + C^2 \\left(h_{j+1}^n - 2 h_j^n + h_{j-1}^n\\right)\n$$\nThis formula is valid for time levels $n \\ge 1$. Periodic boundary conditions are enforced by identifying grid point $j=N_x$ with $j=0$ and $j=-1$ with $j=N_x-1$.\n\nTo begin the simulation, a special procedure is required for the first timestep, as the leapfrog scheme is a three-level method. The solution at $t^1 = \\Delta t$ is computed from a second-order Taylor series expansion in time, consistent with the governing equation:\n$$\nh(x, \\Delta t) \\approx h(x,0) + \\Delta t \\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0} + \\frac{\\Delta t^2}{2} \\left.\\frac{\\partial^2 h}{\\partial t^2}\\right|_{t=0}\n$$\nUsing the wave equation $\\frac{\\partial^2 h}{\\partial t^2} = c^2 \\frac{\\partial^2 h}{\\partial x^2}$ and the discrete approximation for the spatial derivative, the formula for $h_j^1$ becomes:\n$$\nh_j^1 = h_j^0 + \\Delta t \\left(\\left.\\frac{\\partial h}{\\partial t}\\right|_{t=0}\\right)_j + \\frac{c^2 \\Delta t^2}{2} \\left(\\frac{h_{j+1}^0 - 2 h_j^0 + h_{j-1}^0}{\\Delta x^2}\\right)\n$$\nwhere $h_j^0 = h(x_j,0)$ and its time derivative are given by the initial conditions.\n\nThe simulation for each test case proceeds as follows:\n1.  Initialize parameters: $A, m, L, \\alpha, c, N_x, \\Delta t/\\Delta x$.\n2.  Calculate derived quantities: $\\Delta x = L/N_x$, $\\Delta t$, $k=2\\pi m$, $\\omega=k$, $T=2\\pi/\\omega$, $t_{\\mathrm{target}}=\\alpha T$, $N_t = \\mathrm{round}(t_{\\mathrm{target}}/\\Delta t)$, and $t_{\\mathrm{final}} = N_t \\Delta t$.\n3.  Set up the grid $x_j$ and initial data arrays for $h_j^0$ and $\\left(\\partial_t h\\right)_j^0$.\n4.  Compute $h_j^1$ using the first-step formula.\n5.  Iterate the main leapfrog update rule for $N_t-1$ steps to reach $t_{\\mathrm{final}}$, evolving the solution to $h_j^{N_t}$.\n\nAt the final time $t_{\\mathrm{final}}$, the numerical solution $h_j^{N_t}$ is analyzed to extract its amplitude and phase. Since the initial condition is a pure cosine mode, the numerical solution is expected to be dominated by the same mode. We project the numerical solution onto cosine and sine basis functions corresponding to mode $m$:\n$$\nC = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\cos(k x_j), \\quad S = \\sum_{j=0}^{N_x-1} h_j^{N_t} \\sin(k x_j)\n$$\nThe numerical amplitude $A_{\\mathrm{num}}$ and phase $\\phi_{\\mathrm{num}}$ are then calculated as:\n$$\nA_{\\mathrm{num}} = \\frac{2}{N_x} \\sqrt{C^2 + S^2}, \\quad \\phi_{\\mathrm{num}} = \\mathrm{atan2}(S, C)\n$$\nThe factor $2/N_x$ is the standard normalization for a discrete Fourier transform of a real-valued signal. The phase $\\phi_{\\mathrm{num}}$ represents the measured value of the temporal phase $\\omega t$ at $t=t_{\\mathrm{final}}$.\n\nThe errors are computed by comparing these numerical results to the analytic values. The true amplitude is $A = 10^{-6}$, and the true phase is $\\phi_{\\mathrm{true}} = \\omega t_{\\mathrm{final}}$.\nThe amplitude error is the absolute difference:\n$$\nE_A = \\lvert A_{\\mathrm{num}} - A \\rvert\n$$\nThe phase error $E_\\phi$ is the absolute difference between the numerical and true phases, wrapped to the interval $[0, \\pi]$ to find the shortest angle. This is robustly computed as:\n$$\nE_\\phi = \\left\\lvert \\mathrm{Arg}\\left(e^{i(\\phi_{\\mathrm{num}} - \\phi_{\\mathrm{true}})}\\right) \\right\\rvert\n$$\nwhere $\\mathrm{Arg}(z)$ is the principal value of the argument of a complex number $z$, mapping to $(-\\pi, \\pi]$. This procedure is implemented for each of the four specified test cases to produce the required output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_case(Nx, dt_dx_ratio):\n    \"\"\"\n    Runs a single simulation case for the 1D wave equation and computes errors.\n\n    Args:\n        Nx (int): Number of spatial grid points.\n        dt_dx_ratio (float): Ratio of timestep to grid spacing, Delta_t / Delta_x.\n\n    Returns:\n        tuple[float, float]: A tuple containing the amplitude error (E_A) and\n                             the phase error (E_phi) in radians.\n    \"\"\"\n    # 1. Define constants and parameters\n    A = 1.0e-6\n    m = 4.0\n    L = 1.0\n    alpha = 0.37\n    c_light = 1.0\n\n    # 2. Calculate derived quantities\n    dx = L / Nx\n    dt = dt_dx_ratio * dx\n    courant_num = c_light * dt / dx\n\n    k = 2.0 * np.pi * m / L\n    omega = c_light * k\n    period = 2.0 * np.pi / omega\n    t_target = alpha * period\n    \n    # Ensure Nt is an integer, as specified\n    Nt = int(np.round(t_target / dt))\n    t_final = Nt * dt\n\n    # 3. Set up the grid and initial conditions\n    x = np.linspace(0.0, L, Nx, endpoint=False)\n    h0 = A * np.cos(k * x)\n    h_dot_0 = omega * A * np.sin(k * x)\n\n    # 4. Perform the first timestep using a second-order Taylor expansion\n    # h_prev corresponds to h^0, h_curr will be h^1\n    h_prev = h0\n    \n    # Discrete Laplacian of h^0 with periodic boundaries\n    laplacian_h0 = (np.roll(h0, -1) - 2.0 * h0 + np.roll(h0, 1)) / (dx**2)\n    \n    h_curr = h0 + dt * h_dot_0 + 0.5 * dt**2 * c_light**2 * laplacian_h0\n\n    # 5. Main time-stepping loop (Leapfrog)\n    # The loop runs from n=1 to Nt-1, calculating h^(n+1)\n    for _ in range(1, Nt):\n        # Laplacian of h_curr (h^n)\n        laplacian_h_curr = np.roll(h_curr, -1) - 2.0 * h_curr + np.roll(h_curr, 1)\n        \n        # Calculate h_next (h^(n+1))\n        # Note: courant_num**2 = (c*dt/dx)**2\n        h_next = 2.0 * h_curr - h_prev + courant_num**2 * laplacian_h_curr\n        \n        # Update time levels\n        h_prev = h_curr\n        h_curr = h_next\n\n    # h_curr now holds the solution at t_final, i.e., h^{N_t}\n    h_final = h_curr\n\n    # 6. Error analysis at t_final\n    # Project numerical solution onto basis functions\n    cos_kx = np.cos(k * x)\n    sin_kx = np.sin(k * x)\n\n    C_proj = np.sum(h_final * cos_kx)\n    S_proj = np.sum(h_final * sin_kx)\n\n    # Calculate numerical amplitude and phase\n    A_num = (2.0 / Nx) * np.sqrt(C_proj**2 + S_proj**2)\n    phi_num = np.arctan2(S_proj, C_proj)\n\n    # Calculate true phase\n    phi_true = omega * t_final\n\n    # Calculate errors\n    E_A = np.abs(A_num - A)\n    \n    # Phase error calculation, wrapping the difference to (-pi, pi]\n    delta_phi = phi_num - phi_true\n    # Arg(exp(i*delta_phi)) is equivalent to wrapping delta_phi to (-pi, pi]\n    E_phi = np.abs(np.arctan2(np.sin(delta_phi), np.cos(delta_phi)))\n\n    return E_A, E_phi\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, dt/dx)\n        (128, 0.5),\n        (64, 0.8),\n        (32, 0.99),\n        (16, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, dt_dx_ratio = case\n        errors = run_case(Nx, dt_dx_ratio)\n        results.append(errors)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{e_a},{e_phi}]\" for e_a, e_phi in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A powerful test of any numerical relativity code is to verify that it correctly reproduces simpler, well-established physics in the appropriate limits. According to the correspondence principle, the equations of general relativity must reduce to special relativity in the absence of gravity and to Newtonian gravity in the weak-field, non-relativistic regime. This final practice is a capstone exercise where you will numerically verify these fundamental limits within a cosmological context . By performing convergence studies, you will confirm that the discretized equations properly capture both Newtonian gravitational attraction and special relativistic hydrodynamics, ensuring the code is built on a sound physical and numerical foundation.",
            "id": "3502781",
            "problem": "Consider a spatially flat, weakly perturbed Friedmann–Lemaître–Robertson–Walker spacetime in Newtonian gauge with line element\n$$\nds^2 = -(1+2\\Phi)\\,dt^2 + a^2(1-2\\Psi)\\,\\delta_{ij}\\,dx^i\\,dx^j,\n$$\nwhere the scale factor is $a$, the gravitational potential is $\\Phi$, and the spatial curvature potential is $\\Psi$. In the weak-field limit with $a=1$ and $\\Phi \\to 0$ and $\\Psi=\\Phi$, the metric approaches the Minkowski metric and General Relativity (GR) reduces to Special Relativity (SR). In numerical cosmology, one expects that the discretized equations converge to:\n- Newtonian gravity governed by the Poisson equation for scalar perturbations when $a=1$ and $\\Phi$ is small.\n- Special-relativistic hydrodynamics on a Minkowski background when $a=1$ and $\\Phi = 0$.\n\nStarting from the following foundational bases:\n- The Einstein field equations in the linearized weak-field limit imply that scalar perturbations satisfy the Poisson equation\n$$\n\\nabla^2 \\Phi = 4\\pi G\\,\\bar{\\rho}\\,\\delta,\n$$\nfor the gravitational potential $\\Phi$, background density $\\bar{\\rho}$, and density contrast $\\delta$. This is a widely tested result for scalar perturbations in the weak-field, sub-horizon regime.\n- Conservation of the energy–momentum tensor for a perfect fluid, $\\nabla_\\mu T^{\\mu\\nu}=0$, reduces in Minkowski spacetime to the Special Relativity (SR) hydrodynamics equations. For a pressureless fluid (dust), the conserved density is $U=\\gamma \\rho$, where $\\rho$ is the rest-mass density and $\\gamma$ is the Lorentz factor defined by $\\gamma = 1/\\sqrt{1-v^2/c^2}$.\n\nYou must implement numerical experiments to demonstrate recovery of these limits and perform a convergence study. Use natural units where the speed of light $c=1$ and the gravitational constant $G=1$. All quantities must be treated as dimensionless.\n\nDomain and initial data:\n- One-dimensional periodic domain of length $L=2\\pi$ with coordinate $x\\in[0,L)$.\n- Density contrast $\\delta(x)$ is a single sinusoidal mode:\n$$\n\\delta(x) = A \\sin(kx),\n$$\nwith $k=1$ and amplitude $A$ specified per test case. The background density is $\\bar{\\rho}=1$.\n\nTasks:\n1) Newtonian gravity convergence in the weak-field limit ($a=1$):\n   - Solve the discrete Poisson equation on the periodic domain using a second-order finite-difference Laplacian operator. In Fourier space, the discrete Laplacian eigenvalue for mode $m$ on a uniform grid with spacing $\\Delta x=L/N$ is\n   $$\n   \\lambda_m = \\frac{2\\left(1-\\cos\\left(\\frac{2\\pi m}{N}\\right)\\right)}{\\Delta x^2}.\n   $$\n   Represent the source term $S(x) = 4\\pi G \\bar{\\rho}\\, \\delta(x)$, compute its discrete Fourier transform, and solve\n   $$\n   \\hat{\\Phi}_m = -\\frac{\\hat{S}_m}{\\lambda_m}, \\quad m\\neq 0,\n   $$\n   setting the zero mode to $\\hat{\\Phi}_0=0$ to enforce zero-mean potential. Transform back to obtain $\\Phi(x)$ on the grid. Compare to the continuum analytic solution\n   $$\n   \\Phi_{\\mathrm{ana}}(x) = -\\frac{4\\pi G \\bar{\\rho}}{k^2}\\,A \\sin(kx),\n   $$\n   and compute the discrete $L^2$ error\n   $$\n   E_N = \\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[\\Phi_i - \\Phi_{\\mathrm{ana}}(x_i)\\right]^2\\right)^{1/2}.\n   $$\n   For $A=10^{-3}$, compute $E_N$ for $N=64,128,256$, and then the observed convergence orders\n   $$\n   p_{64\\to 128} = \\log_2\\left(\\frac{E_{64}}{E_{128}}\\right), \\quad p_{128\\to 256} = \\log_2\\left(\\frac{E_{128}}{E_{256}}\\right).\n   $$\n   Also compute the boundary-case error $E_{A=0}$ for $N=128$ and $A=0$, which should be close to zero.\n\n2) Special-relativistic hydrodynamics in Minkowski spacetime ($a=1$, $\\Phi=0$):\n   - Evolve the conserved SR density $U=\\gamma \\rho$ under constant velocity advection $v$ using the second-order Lax–Wendroff scheme for the linear advection equation\n   $$\n   \\partial_t U + v\\,\\partial_x U = 0.\n   $$\n   The update at grid index $i$ is\n   $$\n   U_i^{n+1} = U_i^{n} - \\frac{v\\Delta t}{2\\Delta x}\\left(U_{i+1}^{n}-U_{i-1}^{n}\\right) + \\frac{v^2\\Delta t^2}{2\\Delta x^2}\\left(U_{i+1}^{n} - 2U_i^{n} + U_{i-1}^{n}\\right).\n   $$\n   Use periodic boundary conditions, Courant factor $\\mathrm{CFL}=0.5$, and evolve from $t=0$ to $t=T=1$ with initial $\\rho(x,0) = \\bar{\\rho} + A \\sin(kx)$ and constant $v=0.5$. The analytic SR solution for the conserved variable is\n   $$\n   U_{\\mathrm{ana}}(x,t) = \\gamma \\left[\\bar{\\rho} + A \\sin\\left(k(x-vt)\\right)\\right].\n   $$\n   Compute the discrete $L^2$ error\n   $$\n   E^{\\mathrm{SR}}_N = \\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[U_i(T) - U_{\\mathrm{ana}}(x_i,T)\\right]^2\\right)^{1/2}\n   $$\n   for $N=64,128,256$, and the observed convergence orders\n   $$\n   p^{\\mathrm{SR}}_{64\\to 128} = \\log_2\\left(\\frac{E^{\\mathrm{SR}}_{64}}{E^{\\mathrm{SR}}_{128}}\\right), \\quad p^{\\mathrm{SR}}_{128\\to 256} = \\log_2\\left(\\frac{E^{\\mathrm{SR}}_{128}}{E^{\\mathrm{SR}}_{256}}\\right).\n   $$\n\n3) Newtonian limit of SR momentum density:\n   - For a pressureless fluid (dust), the SR momentum density in Minkowski spacetime is\n   $$\n   S_{\\mathrm{SR}}(x,t) = \\rho(x,t)\\,\\gamma^2\\,v,\n   $$\n   while the Newtonian momentum density is\n   $$\n   S_{\\mathrm{N}}(x,t) = \\rho(x,t)\\,v.\n   $$\n   Using the analytic $\\rho(x,t) = \\bar{\\rho} + A \\sin(k(x-vt))$ at $t=T=1$, compute the domain-averaged relative $L^2$ difference for velocities $v\\in\\{0.3,0.1,0.05\\}$,\n   $$\n   R(v) = \\frac{\\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[S_{\\mathrm{SR}}(x_i,T) - S_{\\mathrm{N}}(x_i,T)\\right]^2\\right)^{1/2}}{\\left(\\frac{1}{N}\\sum_{i=0}^{N-1}\\left[S_{\\mathrm{SR}}(x_i,T)\\right]^2\\right)^{1/2}},\n   $$\n   which should decrease toward zero as $v\\to 0$, demonstrating the Newtonian limit of SR.\n\nAngle units: All trigonometric functions use radians.\n\nUnits: Use natural units with $c=1$ and $G=1$; all quantities are dimensionless.\n\nTest suite:\n- Gravitational solver: $A=10^{-3}$ with $N\\in\\{64,128,256\\}$; boundary case $A=0$ with $N=128$.\n- SR advection: $A=10^{-3}$, $v=0.5$, $T=1$, $N\\in\\{64,128,256\\}$.\n- Newtonian limit (momentum): $A=10^{-3}$, $T=1$, $N=1024$, $v\\in\\{0.3,0.1,0.05\\}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[p_{64\\to 128},\\,p_{128\\to 256},\\,p^{\\mathrm{SR}}_{64\\to 128},\\,p^{\\mathrm{SR}}_{128\\to 256},\\,R(0.3),\\,R(0.1),\\,R(0.05),\\,E_{A=0}\\right].\n$$\nEach entry must be a floating-point number. For example, the output should look like \"[result1,result2,result3,result4,result5,result6,result7,result8]\".",
            "solution": "The problem presents a series of numerical experiments designed to validate the recovery of fundamental physical limits from the equations of numerical cosmology. Specifically, we will demonstrate the convergence to Newtonian gravity and special-relativistic (SR) hydrodynamics in the appropriate weak-field approximations of General Relativity. All calculations are performed in natural units where the gravitational constant $G=1$ and the speed of light $c=1$. The problem is divided into three distinct tasks.\n\n**Task 1: Newtonian Gravity Convergence Analysis**\n\nThe first task is to show that in the weak-field, non-relativistic limit ($a=1$, small $\\Phi$), the equations for scalar perturbations recover Newtonian gravity. The governing equation is the Poisson equation for the gravitational potential $\\Phi$:\n$$\n\\nabla^2 \\Phi = 4\\pi G\\,\\bar{\\rho}\\,\\delta\n$$\nHere, $\\bar{\\rho}$ is the background matter density and $\\delta$ is the density contrast. The problem is defined on a one-dimensional periodic domain of length $L=2\\pi$ with coordinate $x\\in[0,L)$. The density contrast is a single sinusoidal mode, $\\delta(x) = A \\sin(kx)$, with wavenumber $k=1$ and background density $\\bar{\\rho}=1$. The source term for the Poisson equation is $S(x) = 4\\pi G \\bar{\\rho} \\delta(x) = 4\\pi A \\sin(x)$.\n\nThe continuum analytical solution on this domain, assuming a zero-mean potential, is found by letting $\\Phi_{\\mathrm{ana}}(x) = C\\sin(kx)$. Substituting into the Poisson equation yields $\\frac{d^2}{dx^2}(C\\sin(x)) = -C\\sin(x) = 4\\pi A \\sin(x)$, which gives $C = -4\\pi A$. With $k=1$, $G=1$, $\\bar{\\rho}=1$, the analytical solution is:\n$$\n\\Phi_{\\mathrm{ana}}(x) = -\\frac{4\\pi G \\bar{\\rho}}{k^2}A \\sin(kx) = -4\\pi A \\sin(x)\n$$\nNumerically, we solve the Poisson equation on a discrete grid with $N$ points and spacing $\\Delta x = L/N$. We employ a Fourier pseudo-spectral method. The equation $\\nabla^2 \\Phi = S$ transforms to $(\\widehat{\\nabla^2 \\Phi})_m = \\hat{S}_m$ in Fourier space, where $\\hat{f}_m$ denotes the $m$-th discrete Fourier coefficient of a function $f(x)$. The discrete Laplacian operator's action on a Fourier mode $e^{i2\\pi mx/L}$ is multiplication by its eigenvalue. For the second-order finite-difference Laplacian, the eigenvalue corresponding to mode $m$ is $-(k^{\\text{eff}}_m)^2$, where $k^{\\text{eff}}_m$ is the effective wavenumber. The problem states the eigenvalue of the negative Laplacian, $-\\nabla^2$, is:\n$$\n\\lambda_m = \\frac{2\\left(1-\\cos\\left(\\frac{2\\pi m}{N}\\right)\\right)}{\\Delta x^2}\n$$\nThus, the algebraic equation in Fourier space becomes $-\\lambda_m \\hat{\\Phi}_m = \\hat{S}_m$. For non-zero modes ($m \\neq 0$), we can solve for the potential's Fourier coefficients:\n$$\n\\hat{\\Phi}_m = -\\frac{\\hat{S}_m}{\\lambda_m}\n$$\nThe mean of the source term $\\int_0^{2\\pi} \\sin(x) dx = 0$, so its zero-frequency component $\\hat{S}_0=0$. We enforce a zero-mean potential by setting $\\hat{\\Phi}_0=0$. The numerical solution $\\Phi(x)$ is then recovered by applying an inverse discrete Fourier transform to the coefficients $\\hat{\\Phi}_m$.\n\nWe compute the discrete $L^2$ error $E_N$ between the numerical solution $\\Phi_i$ and the analytical solution $\\Phi_{\\mathrm{ana}}(x_i)$ on grids of size $N \\in \\{64, 128, 256\\}$. The convergence order $p$ is then determined using the formula $p = \\log_2(E_{N_1}/E_{N_2})$. Since the finite-difference stencil for the Laplacian is second-order accurate, we expect the convergence order to be $p \\approx 2$. We also calculate the error for a boundary case with amplitude $A=0$, which should be close to machine precision.\n\n**Task 2: Special-Relativistic Hydrodynamics Convergence Analysis**\n\nThe second task demonstrates the recovery of SR hydrodynamics in a Minkowski background ($a=1$, $\\Phi=0$). We consider a pressureless fluid (dust) with rest-mass density $\\rho$ and constant velocity $v$. The conserved quantity is the density in the laboratory frame, $U = \\gamma \\rho$, where $\\gamma = (1-v^2/c^2)^{-1/2}$ is the Lorentz factor. In one dimension, its evolution is governed by the linear advection equation:\n$$\n\\partial_t U + v\\,\\partial_x U = 0\n$$\nThe initial condition at $t=0$ is a sinusoidal density perturbation over a constant background, $\\rho(x,0) = \\bar{\\rho} + A \\sin(kx)$, with $\\bar{\\rho}=1$, $A=10^{-3}$, and $k=1$. The initial conserved density is $U(x,0) = \\gamma (\\bar{\\rho} + A \\sin(kx))$. The analytical solution is a simple translation of the initial profile:\n$$\nU_{\\mathrm{ana}}(x,t) = \\gamma \\left[\\bar{\\rho} + A \\sin\\left(k(x-vt)\\right)\\right]\n$$\nWe solve the advection equation numerically using the second-order Lax–Wendroff scheme. For a time step $\\Delta t$ and grid spacing $\\Delta x$, the update rule from time step $n$ to $n+1$ is:\n$$\nU_i^{n+1} = U_i^{n} - \\frac{v\\Delta t}{2\\Delta x}\\left(U_{i+1}^{n}-U_{i-1}^{n}\\right) + \\frac{v^2\\Delta t^2}{2\\Delta x^2}\\left(U_{i+1}^{n} - 2U_i^{n} + U_{i-1}^{n}\\right)\n$$\nThe scheme is evolved from $t=0$ to $T=1$ using a Courant factor $\\mathrm{CFL} = v\\Delta t/\\Delta x = 0.5$, which ensures numerical stability. Periodic boundary conditions are applied. We compute the $L^2$ error $E^{\\mathrm{SR}}_N$ between the numerical solution at $T=1$ and the analytical solution for grid sizes $N \\in \\{64, 128, 256\\}$, and from these errors, the convergence orders. As the Lax-Wendroff scheme is second-order accurate, we expect a convergence order $p^{\\mathrm{SR}} \\approx 2$.\n\n**Task 3: Newtonian Limit of Special-Relativistic Momentum**\n\nThe final task is to verify that the SR momentum density approaches the Newtonian momentum density in the non-relativistic limit ($v \\ll c$). The SR momentum density for dust is $S_{\\mathrm{SR}} = T^{0i} = \\rho h u^0 u^i = \\rho \\gamma^2 v$ (since the specific enthalpy $h=1$ for dust and $u^\\mu = \\gamma(1, \\vec{v})$). The corresponding Newtonian momentum density is $S_{\\mathrm{N}} = \\rho v$.\nWe analyze the analytic solutions at time $T=1$ using the advected density profile $\\rho(x,T) = \\bar{\\rho} + A \\sin(k(x-vT))$ on a high-resolution grid ($N=1024$). The agreement between the two formulations is quantified by the domain-averaged relative $L^2$ difference:\n$$\nR(v) = \\frac{\\|S_{\\mathrm{SR}} - S_{\\mathrm{N}}\\|_{L^2}}{\\|S_{\\mathrm{SR}}\\|_{L^2}}\n$$\nWe can simplify this expression analytically:\n$$\nS_{\\mathrm{SR}} - S_{\\mathrm{N}} = \\rho \\gamma^2 v - \\rho v = \\rho v (\\gamma^2 - 1)\n$$\nThe ratio of the norms becomes:\n$$\nR(v) = \\frac{\\|\\rho v (\\gamma^2 - 1)\\|}{\\|\\rho v \\gamma^2\\|} = \\frac{|v(\\gamma^2-1)|}{|v\\gamma^2|} \\frac{\\|\\rho\\|}{\\|\\rho\\|} = \\frac{\\gamma^2-1}{\\gamma^2} = 1 - \\frac{1}{\\gamma^2} = 1 - (1-v^2) = v^2\n$$\nThis demonstrates that the relative difference between SR and Newtonian momentum scales as $v^2$. We compute this value for a series of decreasing velocities, $v \\in \\{0.3, 0.1, 0.05\\}$, to confirm this behavior numerically.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_poisson_error(N: int, A: float) - float:\n    \"\"\"\n    Solves the 1D periodic Poisson equation using a Fourier method and\n    computes the L2 error against the analytic solution.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density contrast.\n\n    Returns:\n        The discrete L2 error.\n    \"\"\"\n    # Constants and domain setup\n    G = 1.0\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    \n    # Grid setup\n    dx = L / N\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Source term\n    delta = A * np.sin(k * x)\n    S = 4.0 * np.pi * G * rho_bar * delta\n    \n    # Solve in Fourier space\n    S_hat = np.fft.fft(S)\n    \n    # Wavenumbers (integer mode numbers)\n    m = np.fft.fftfreq(N) * N\n    \n    # Eigenvalues of the negative discrete Laplacian (-nabla^2)\n    # The m=0 mode gives lambda_0 = 0, leading to a singularity.\n    # We handle it by setting Phi_hat[0] = 0.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        lambda_m = (2.0 * (1.0 - np.cos(2.0 * np.pi * m / N))) / (dx**2)\n    \n    Phi_hat = np.zeros_like(S_hat)\n    # The source term has zero mean, so S_hat[0] is zero.\n    # The condition Phi_hat[0]=0 enforces a zero-mean potential.\n    non_zero_modes = (m != 0)\n    Phi_hat[non_zero_modes] = -S_hat[non_zero_modes] / lambda_m[non_zero_modes]\n\n    # Transform back to real space\n    Phi_num = np.fft.ifft(Phi_hat).real\n    \n    # Analytical solution\n    Phi_ana = -(4.0 * np.pi * G * rho_bar / k**2) * A * np.sin(k * x)\n    \n    # Compute L2 error\n    error = np.linalg.norm(Phi_num - Phi_ana) / np.sqrt(N)\n    \n    return error\n\ndef run_lax_wendroff_advection(N: int, A: float, v: float, T: float) - float:\n    \"\"\"\n    Evolves the SR linear advection equation using the Lax-Wendroff scheme\n    and computes the L2 error.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density perturbation.\n        v: Advection velocity.\n        T: Final evolution time.\n\n    Returns:\n        The discrete L2 error at time T.\n    \"\"\"\n    # Constants and domain setup\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    CFL = 0.5\n    \n    # Grid setup\n    dx = L / N\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Time stepping setup\n    # Adjust dt to land exactly on T\n    dt_provisional = CFL * dx / v\n    n_steps = int(np.ceil(T / dt_provisional))\n    dt = T / n_steps\n\n    # Initial condition for conserved density U = gamma * rho\n    gamma = 1.0 / np.sqrt(1.0 - v**2)\n    rho0 = rho_bar + A * np.sin(k * x)\n    U = gamma * rho0\n    \n    # Coefficients for Lax-Wendroff update\n    c1 = v * dt / (2.0 * dx)\n    c2 = (v**2 * dt**2) / (2.0 * dx**2)\n\n    # Time evolution loop\n    for _ in range(n_steps):\n        U_p1 = np.roll(U, -1)  # U_{i+1}\n        U_m1 = np.roll(U, 1)   # U_{i-1}\n        \n        # Second-order stencil for first derivative\n        advection_term = c1 * (U_p1 - U_m1)\n        # Second-order stencil for second derivative\n        diffusion_term = c2 * (U_p1 - 2.0 * U + U_m1)\n        \n        U = U - advection_term + diffusion_term\n\n    # Analytical solution at T\n    U_ana = gamma * (rho_bar + A * np.sin(k * (x - v * T)))\n\n    # Compute L2 error\n    error = np.linalg.norm(U - U_ana) / np.sqrt(N)\n    \n    return error\n    \ndef calculate_momentum_difference(N: int, A: float, v: float, T: float) - float:\n    \"\"\"\n    Computes the relative L2 difference between SR and Newtonian momentum densities.\n\n    Args:\n        N: Number of grid points.\n        A: Amplitude of the density perturbation.\n        v: Velocity of the fluid.\n        T: Time of evaluation.\n\n    Returns:\n        The relative L2 difference R(v).\n    \"\"\"\n    # Constants and domain\n    rho_bar = 1.0\n    k = 1.0\n    L = 2.0 * np.pi\n    \n    # Grid\n    x = np.linspace(0, L, N, endpoint=False)\n    \n    # Lorentz factor\n    gamma = 1.0 / np.sqrt(1.0 - v**2)\n    \n    # Analytic density at time T\n    rho = rho_bar + A * np.sin(k * (x - v * T))\n    \n    # Momentum densities\n    S_N = rho * v\n    S_SR = rho * gamma**2 * v\n    \n    # Relative L2 difference\n    norm_diff = np.linalg.norm(S_SR - S_N)\n    norm_SR = np.linalg.norm(S_SR)\n    \n    # Avoid division by zero if S_SR is zero everywhere\n    if norm_SR == 0:\n        return 0.0\n    \n    return norm_diff / norm_SR\n\ndef solve():\n    \"\"\"\n    Runs all tasks and prints the final results.\n    \"\"\"\n    # --- Task 1: Newtonian Gravity Convergence ---\n    A_grav = 1.0e-3\n    Ns_grav = [64, 128, 256]\n    errors_grav = [calculate_poisson_error(N, A_grav) for N in Ns_grav]\n    \n    p_64_128 = np.log2(errors_grav[0] / errors_grav[1])\n    p_128_256 = np.log2(errors_grav[1] / errors_grav[2])\n    \n    # Boundary case A=0\n    error_A0 = calculate_poisson_error(N=128, A=0.0)\n\n    # --- Task 2: Special-Relativistic Hydrodynamics Convergence ---\n    A_hydro = 1.0e-3\n    v_hydro = 0.5\n    T_hydro = 1.0\n    Ns_hydro = [64, 128, 256]\n    errors_hydro = [run_lax_wendroff_advection(N, A_hydro, v_hydro, T_hydro) for N in Ns_hydro]\n    \n    p_sr_64_128 = np.log2(errors_hydro[0] / errors_hydro[1])\n    p_sr_128_256 = np.log2(errors_hydro[1] / errors_hydro[2])\n\n    # --- Task 3: Newtonian Limit of Momentum Density ---\n    A_limit = 1.0e-3\n    T_limit = 1.0\n    N_limit = 1024\n    vs_limit = [0.3, 0.1, 0.05]\n    R_values = [calculate_momentum_difference(N_limit, A_limit, v, T_limit) for v in vs_limit]\n\n    # --- Assemble and Print Final Results ---\n    results = [\n        p_64_128,\n        p_128_256,\n        p_sr_64_128,\n        p_sr_128_256,\n        R_values[0],\n        R_values[1],\n        R_values[2],\n        error_A0\n    ]\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}