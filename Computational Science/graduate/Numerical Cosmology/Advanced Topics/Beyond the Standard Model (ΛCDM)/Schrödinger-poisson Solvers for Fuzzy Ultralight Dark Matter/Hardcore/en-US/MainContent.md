## Introduction
Fuzzy dark matter (FDM), also known as [ultralight dark matter](@entry_id:756282) (ULDM), has emerged as a compelling alternative to the standard Cold Dark Matter (CDM) model, offering potential solutions to long-standing small-scale challenges in cosmology. By postulating that dark matter consists of extremely light bosonic particles, FDM introduces a wave-like nature on astrophysical scales, fundamentally altering the process of [structure formation](@entry_id:158241). To explore the rich phenomenology of this paradigm, we must move beyond the classical particle-based simulations of CDM and embrace a quantum mechanical description. The primary tool for this is the Schrödinger-Poisson (SP) system, a set of coupled equations describing a self-gravitating [quantum fluid](@entry_id:145920).

This article provides a comprehensive guide to understanding and implementing Schrödinger-Poisson solvers. In the first chapter, **Principles and Mechanisms**, we will derive the governing SP and Gross-Pitaevskii-Poisson equations, explore their physical interpretation through the Madelung fluid analogy, and analyze the key phenomena they predict, from quantum interference to the formation of stable solitonic cores. The second chapter, **Applications and Interdisciplinary Connections**, will demonstrate how numerical SP solvers are used as virtual laboratories to study astrophysical signatures like the solitonic [mass-radius relation](@entry_id:158512) and [wave optics](@entry_id:271428) in the [cosmic web](@entry_id:162042), while also delving into the advanced numerical algorithms that make these simulations possible. Finally, the **Hands-On Practices** section provides a series of targeted exercises to validate a numerical implementation, building from fundamental symmetry checks to dynamic tests of the full solver. Together, these chapters will equip you with the theoretical and practical knowledge needed to simulate the captivating dynamics of [fuzzy dark matter](@entry_id:161829).

## Principles and Mechanisms

This chapter delves into the fundamental principles and physical mechanisms that govern the dynamics of fuzzy or [ultralight dark matter](@entry_id:756282) (ULDM). Building upon the introductory concepts, we will formally establish the governing equations, explore their physical interpretation through a fluid analogy, and analyze the key phenomena that emerge, such as wave interference, [gravitational instability](@entry_id:160721), and the formation of stable solitonic structures. We will also address the practical considerations of numerical implementation and the domain of validity for the nonrelativistic framework.

### The Governing Equations: Schrödinger-Poisson and Gross-Pitaevskii-Poisson Systems

The standard model for ULDM treats it as a nonrelativistic, self-gravitating [quantum fluid](@entry_id:145920) described by a single, classical [complex scalar field](@entry_id:159799), or "[macroscopic wavefunction](@entry_id:143853)," $\psi(\mathbf{x}, t)$. The time evolution of this field is governed by the Schrödinger equation, while its gravitational influence is described by the Poisson equation for Newtonian gravity.

The total potential energy operator for a single dark matter particle of mass $m$ in this model is $\hat{V} = m\Phi$, where $\Phi(\mathbf{x}, t)$ is the Newtonian [gravitational potential](@entry_id:160378). The time-dependent Schrödinger equation, $i\hbar \partial_t \psi = \hat{H}\psi$, with the Hamiltonian $\hat{H} = -(\hbar^2/2m)\nabla^2 + m\Phi$, thus takes the form:
$$
i\hbar \frac{\partial \psi}{\partial t} = -\frac{\hbar^2}{2m}\nabla^2\psi + m\Phi\psi
$$

The source for the gravitational potential is the mass density $\rho$. In the quantum description, the probability density of finding a particle is proportional to $|\psi|^2$. If we interpret $|\psi|^2$ as the [number density](@entry_id:268986) of dark matter particles, the mass density is obtained by multiplying by the particle mass $m$:
$$
\rho(\mathbf{x}, t) = m|\psi(\mathbf{x}, t)|^2
$$

The gravitational potential $\Phi$ is then determined by the Poisson equation. In [cosmological simulations](@entry_id:747925) performed in a periodic domain, it is standard practice to solve for the potential generated by the density *contrast*, $\delta\rho = \rho - \bar{\rho}$, where $\bar{\rho}$ is the mean density of the universe. This approach, sometimes known as the "Jeans swindle," isolates the dynamics of local structure formation from the uniform [cosmic expansion](@entry_id:161002). The Poisson equation is therefore:
$$
\nabla^2\Phi = 4\pi G (\rho - \bar{\rho})
$$

These three equations—the Schrödinger equation, the mass density definition, and the Poisson equation—constitute the **Schrödinger-Poisson (SP) system**. This system of coupled, [nonlinear partial differential equations](@entry_id:168847) provides the fundamental description for the evolution of non-interacting ULDM .

Some ULDM models also incorporate a repulsive, short-range contact [self-interaction](@entry_id:201333). This is analogous to the physics of Bose-Einstein condensates. At the mean-field level, such an interaction introduces an additional potential energy term proportional to the local density, $V_{int} \propto \rho$. This leads to a nonlinear term in the Schrödinger equation. If we define a coupling constant $g$ such that the interaction energy density is proportional to $|\psi|^4$, the corresponding potential operator is multiplication by $g|\psi|^2$. The evolution equation becomes the **Gross-Pitaevskii equation (GPE)**:
$$
i\hbar \frac{\partial \psi}{\partial t} = -\frac{\hbar^2}{2m}\nabla^2\psi + m\Phi\psi + g|\psi|^2\psi
$$

When coupled with the same Poisson equation and density definition as before, this forms the **Gross-Pitaevskii-Poisson (GPP) system**. The GPP system describes self-gravitating ULDM with a contact self-interaction, where the sign of $g$ determines whether the interaction is repulsive ($g > 0$) or attractive ($g  0$)  .

### The Fluid Analogy: The Madelung Transformation

The wavelike nature of the SP and GPP systems can be made more intuitive by reformulating them in the language of fluid dynamics. This is achieved through the **Madelung transformation**, which involves writing the complex wavefunction $\psi$ in its polar form:
$$
\psi(\mathbf{x}, t) = \sqrt{\frac{\rho(\mathbf{x}, t)}{m}} \exp\left(\frac{iS(\mathbf{x}, t)}{\hbar}\right)
$$
Here, $\rho(\mathbf{x}, t)$ is the real-valued mass density field, and $S(\mathbf{x}, t)$ is the real-valued phase field. Substituting this [ansatz](@entry_id:184384) into the Schrödinger equation and separating the real and imaginary parts yields two equations for the real fields $\rho$ and $S$ .

The imaginary part of the equation, after some manipulation, can be written as:
$$
\frac{\partial \rho}{\partial t} + \nabla \cdot (\rho \mathbf{v}) = 0
$$
where we have defined an effective **velocity field** $\mathbf{v}(\mathbf{x}, t) \equiv \frac{\nabla S}{m}$. This equation is formally identical to the classical continuity equation, expressing the [conservation of mass](@entry_id:268004) for the dark matter fluid.

The real part of the equation yields a quantum generalization of the Hamilton-Jacobi equation. By taking the gradient of this equation, one obtains a [momentum equation](@entry_id:197225) analogous to the classical Euler equation:
$$
\frac{\partial \mathbf{v}}{\partial t} + (\mathbf{v} \cdot \nabla)\mathbf{v} = -\nabla\Phi - \nabla V_Q
$$
This equation states that a fluid element accelerates due to the gradient of the [gravitational potential](@entry_id:160378) $\Phi$ and the gradient of an additional term, $V_Q$. This term, known as the **[quantum potential](@entry_id:193380)** or **dispersive potential**, is given by:
$$
V_Q = -\frac{\hbar^2}{2m^2}\frac{\nabla^2\sqrt{\rho}}{\sqrt{\rho}}
$$
The force per unit mass, $-\nabla V_Q$, is often called the **quantum pressure** force. It arises directly from the kinetic energy term in the Schrödinger equation and has no classical analogue. It depends on the curvature of the wavefunction's amplitude and is responsible for resisting [gravitational collapse](@entry_id:161275) on small scales, effectively providing a pressure support that prevents the formation of singularities. If self-interactions are present (the GPP system), an additional pressure term derived from the $g|\psi|^2\psi$ term appears in the Euler-like equation .

### Physical Consequences of the Wave Nature

The [wave mechanics](@entry_id:166256) underlying the SP system give rise to phenomena not present in classical cold dark matter (CDM), which is modeled as a collisionless collection of particles.

#### Coherence, Interference, and the de Broglie Wavelength

The most fundamental consequence of the wave description is that ULDM particles are not localized points but are described by a wavefunction with a characteristic wavelength. For a particle of mass $m$ moving with a characteristic velocity $v$, this is the **de Broglie wavelength**, $\lambda_{\text{dB}} = h/(mv)$.

We can estimate when these wave effects become important for astrophysical structures like [dark matter halos](@entry_id:147523). For a virialized halo of mass $M$ and radius $R$, the characteristic velocity of a constituent particle is given by the [virial theorem](@entry_id:146441), $v \sim \sqrt{GM/R}$. The de Broglie wavelength of such a particle is then $\lambda_{\text{dB}} \sim h / (m \sqrt{GM/R})$. Quantum effects are expected to dominate the halo's dynamics when this wavelength becomes comparable to or larger than the size of the halo itself, $R$. The condition $\lambda_{\text{dB}} \gtrsim R$ defines the regime where the wavelike nature of dark matter is inescapable. The critical particle mass $m_{\text{crit}}$ for which $\lambda_{\text{dB}} = R$ is given by :
$$
m_{\text{crit}} = \frac{h}{\sqrt{GMR}}
$$
For particle masses $m \ll m_{\text{crit}}$, the de Broglie wavelength is much larger than the halo, quantum pressure prevents its collapse, and the halo cannot form in the first place. This allows cosmological observations of the smallest known galaxies to place lower bounds on the ULDM particle mass.

The wave nature also fundamentally alters the description of multi-stream regions, which are common in classical CDM simulations where different streams of particles cross each other after [gravitational collapse](@entry_id:161275). In the classical **Vlasov-Poisson system**, the [phase-space distribution](@entry_id:151304) function $f(\mathbf{x}, \mathbf{v}, t)$ can have support at multiple velocities for a single position $\mathbf{x}$. In the SP system, the velocity field $\mathbf{v} = \nabla S / m$ is inherently single-valued. The physical manifestation of multiple streams is instead encoded as **interference**. Superposing two or more plane-wave components of the wavefunction, representing different streams, creates a characteristic [interference pattern](@entry_id:181379) of [standing waves](@entry_id:148648) in the density field $\rho$. These density oscillations, or "fringes," have a spatial scale related to the momentum difference between the streams.

On scales much larger than the interference fringe wavelength, the oscillatory features of the SP fluid average out. A [coarse-graining](@entry_id:141933) procedure over a scale $L$ that is large compared to the de Broglie wavelength will wash out the interference patterns. In this averaged sense, the zeroth (density) and first (momentum) moments of the SP fluid can be shown to match those of the classical Vlasov-Poisson fluid. The highly oscillatory quantum pressure term also averages to a near-zero value, recovering the behavior of a "cold" or pressureless fluid on large scales. This demonstrates that the classical CDM model emerges as a short-wavelength, coarse-grained limit of the more fundamental ULDM wave model .

#### Quantized Vortices and Nodal Lines

The phase field $S$ of the wavefunction can harbor topological defects, leading to another uniquely quantum phenomenon: **[quantized vortices](@entry_id:147055)**. These are locations where the density $\rho$ goes to zero (a nodal line in 3D or point in 2D) and the phase $S$ is singular. The [velocity field](@entry_id:271461) $\mathbf{v} = \nabla S / m$ circulates around the nodal line.

The single-valuedness of the wavefunction $\psi$ imposes a powerful constraint: the change in the phase $S/\hbar$ integrated around any closed loop must be an integer multiple of $2\pi$. This integer, $n$, is the **[topological charge](@entry_id:142322)** or **[winding number](@entry_id:138707)** of the loop.
$$
n = \frac{1}{2\pi} \oint_C \nabla\left(\frac{S}{\hbar}\right) \cdot d\mathbf{l}
$$
A non-zero [winding number](@entry_id:138707) indicates the presence of a vortex within the loop. For instance, consider a localized wavefunction near a nodal line that, in a 2D cross-section using [polar coordinates](@entry_id:159425) $(r, \theta)$, has the form $\psi(r, \theta) \propto r \exp(i\theta)$. The phase is $S = \hbar\theta$. The [velocity field](@entry_id:271461) is $\mathbf{v} = \nabla S / m = (\hbar/mr)\hat{\boldsymbol{\theta}}$, which describes a vortex centered at $r=0$. A direct calculation of the [winding number](@entry_id:138707) for a loop around the origin yields $n=1$. The circulation of the velocity field, $\Gamma = \oint \mathbf{v} \cdot d\mathbf{l}$, is quantized in units of $h/m$, since $\Gamma = n(h/m)$. These vortices are stable topological structures that can form during the complex interference dynamics following gravitational collapse and represent stored angular momentum in the ULDM fluid .

### Gravitational Instability and Structure Formation

The formation of cosmic structure from small initial [density fluctuations](@entry_id:143540) is driven by [gravitational instability](@entry_id:160721). In the ULDM model, this instability is a competition between the attractive force of gravity and the repulsive effects of pressure.

#### The Jeans Instability in ULDM

We can analyze this competition by performing a linear [perturbation analysis](@entry_id:178808) of the fluid equations. Consider small plane-wave perturbations of the form $\delta\rho \propto \exp[i(\mathbf{k} \cdot \mathbf{x} - \omega t)]$ around a static, uniform background density $\bar{\rho}$. Substituting this into the linearized fluid equations derived from the SP system leads to a **[dispersion relation](@entry_id:138513)** for the frequency $\omega$ as a function of the [wavenumber](@entry_id:172452) $k = |\mathbf{k}|$ :
$$
\omega^2(k) = \frac{\hbar^2 k^4}{4m^2} - 4\pi G \bar{\rho}
$$
The first term on the right, proportional to $k^4$, represents the stabilizing effect of quantum pressure, which is stronger for short-wavelength (large $k$) perturbations. The second term, which is negative, represents the destabilizing effect of gravity.

If $\omega^2 > 0$, the frequency $\omega$ is real, and the perturbations propagate as stable waves. If $\omega^2  0$, $\omega$ is imaginary, leading to one solution that grows exponentially in time, signifying gravitational collapse. The threshold between stability and instability occurs at $\omega^2 = 0$. The [wavenumber](@entry_id:172452) at which this happens is the **Jeans wavenumber**, $k_J$. Setting $\omega^2(k_J)=0$ gives:
$$
k_J = \left(\frac{16\pi G \bar{\rho} m^2}{\hbar^2}\right)^{1/4}
$$
Perturbations with wavenumbers $k  k_J$ (wavelengths $\lambda > \lambda_J = 2\pi/k_J$) are gravitationally unstable and will collapse to form structures. The Jeans [wavenumber](@entry_id:172452) sets the characteristic scale for the smallest objects that can form at a given background density.

If we include a repulsive self-interaction ($g > 0$) as in the GPP system, the self-interaction provides an additional source of pressure. The linearized analysis can be repeated, resulting in a modified [dispersion relation](@entry_id:138513) :
$$
\omega^2(k) = \frac{\hbar^2 k^4}{4m^2} + \frac{g\bar{\rho}}{m^2}k^2 - 4\pi G\bar{\rho}
$$
The new term, proportional to $g k^2$, is a pressure contribution that is also stronger at smaller scales (larger $k$). The modified Jeans wavenumber $k_J(g)$ is found by solving the quadratic equation for $k^2$ that results from setting $\omega^2=0$. The physical solution is:
$$
k_J(g) = \sqrt{\frac{2}{\hbar^2}\left( \sqrt{g^2\bar{\rho}^2 + 4\pi G m^2\hbar^2\bar{\rho}} - g\bar{\rho} \right)}
$$
A repulsive [self-interaction](@entry_id:201333) ($g>0$) makes the Jeans wavenumber smaller (and the Jeans length larger), thus stabilizing the fluid against collapse and leading to the formation of more massive structures compared to the non-interacting case.

### Equilibrium Structures: Solitonic Cores

The nonlinear evolution of a Jeans-unstable perturbation eventually leads to the formation of a gravitationally bound, stable object. In ULDM, the ground-state [equilibrium solutions](@entry_id:174651) are known as **[solitons](@entry_id:145656)**. These are smooth, spherically symmetric objects where the inward pull of gravity is perfectly balanced by the outward push of quantum pressure.

To find the structure of a soliton, we seek a stationary solution to the SP system. We use the ansatz $\psi(r, t) = e^{-i\mu t/\hbar}u(r)$, where $\mu$ is the chemical potential (an energy eigenvalue) and $u(r)$ is a real-valued, spherically symmetric function. Substituting this into the SP equations yields a system of two coupled, time-independent ordinary differential equations for $u(r)$ and the potential $\Phi(r)$ :
$$
-\frac{\hbar^2}{2m}\left(\frac{d^2u}{dr^2} + \frac{2}{r}\frac{du}{dr}\right) + m\Phi(r)u(r) = \mu u(r)
$$
$$
\frac{1}{r^2}\frac{d}{dr}\left(r^2 \frac{d\Phi}{dr}\right) = 4\pi G m u(r)^2
$$
This system must be solved subject to boundary conditions. For a [regular solution](@entry_id:156590), the derivatives must vanish at the center: $u'(0) = 0$ and $\Phi'(0) = 0$. For a bound state, the wavefunction and potential must vanish at infinity: $u(r) \to 0$ and $\Phi(r) \to 0$ as $r \to \infty$. This constitutes a [nonlinear eigenvalue problem](@entry_id:752640) for $\mu$.

Numerically, these solutions can be found using a **[shooting method](@entry_id:136635)**. One chooses a central amplitude $u(0)=u_c$ and guesses a value for the eigenvalue $\mu$. With the regularity conditions at the origin, the equations are integrated outward. The guess for $\mu$ is then adjusted iteratively (e.g., using a bisection algorithm) until the solution is found that satisfies the bound-state condition $u(r) \to 0$ at large $r$. This procedure yields a unique soliton profile for each choice of central density, with a characteristic dense core and a rapidly decaying density tail.

In the presence of a strong repulsive [self-interaction](@entry_id:201333) (the GPP system), the equilibrium balance can be dominated by gravity versus the [self-interaction](@entry_id:201333) pressure, with quantum pressure being negligible. This is known as the **Thomas-Fermi regime**. In this limit, the [equation of state](@entry_id:141675) becomes polytropic with index $n=1$. The structure is described by the Lane-Emden equation, and remarkably, the core radius becomes independent of the soliton's mass or central density, depending only on the [fundamental constants](@entry_id:148774) $m$, $G$, and $g$ .

### Numerical Considerations and Domain of Validity

Solving the SP system numerically requires careful handling of the wide range of scales involved. A crucial first step is **[nondimensionalization](@entry_id:136704)**, which recasts the equations in terms of dimensionless variables by introducing [characteristic scales](@entry_id:144643) for length ($L$), time ($T$), and wavefunction amplitude ($\Psi_0$).

By defining $\mathbf{x} = L\tilde{\mathbf{x}}$, $t = T\tilde{t}$, and $\psi = \Psi_0\tilde{\psi}$, and choosing the potential scale $\Phi_0$ to normalize the potential term in the dimensionless Schrödinger equation, one can derive a dimensionless SP system. The key result is that the physics is governed by a single dimensionless parameter, $\Lambda$, which appears in the dimensionless Poisson equation $\tilde{\nabla}^2\tilde{\phi} = \Lambda |\tilde{\psi}|^2$. This parameter is given by :
$$
\Lambda = \frac{4\pi G m^2 \Psi_0^2 L^2 T}{\hbar}
$$
The magnitude of $\Lambda$ dictates the relative strength of gravity compared to the quantum kinetic energy and sets the overall character of the solutions. Fixing these scales is a fundamental aspect of setting up a [numerical simulation](@entry_id:137087).

Finally, it is essential to understand the **domain of validity** of the SP system itself. The Schrödinger equation is a nonrelativistic approximation. The fully relativistic description of a scalar field is the **Klein-Gordon equation**. The SP system can be derived from the Klein-Gordon equation in a weak gravitational field under the ansatz $\phi(t, \mathbf{x}) \approx \psi(t, \mathbf{x}) \exp(-imc^2t/\hbar)$, where the rapid oscillation at the rest-mass frequency $mc^2/\hbar$ is factored out .

This reduction is valid only under a set of smallness conditions:
1.  **Weak Gravity:** The gravitational potential must be small compared to $c^2$, i.e., $|\Phi|/c^2 \ll 1$.
2.  **Nonrelativistic Velocities:** Characteristic velocities must be small, $v^2/c^2 \ll 1$.
3.  **Slowly-Varying Envelope:** The kinetic and potential energies must be much smaller than the rest-mass energy, $E_{\text{kin}} \ll mc^2$ and $|m\Phi| \ll mc^2$.

The last condition provides a bound on the spatial variations of the wavefunction. Requiring that the kinetic energy term be smaller than the rest-mass energy by some tolerance $\varepsilon$, i.e., $(\hbar^2 k^2 / 2m) \le \varepsilon(mc^2)$, yields an upper bound on the wavenumber $k$. This translates to a minimum physical length scale $L_{\text{crit}}$ below which the SP approximation breaks down. For a typical ULDM mass of $m \sim 10^{-22} \text{ eV}/c^2$, this critical scale is on the order of parsecs. For phenomena occurring on scales smaller than this, [relativistic corrections](@entry_id:153041) become significant, and a more fundamental Klein-Gordon-Poisson solver would be required . However, for the vast majority of cosmological applications involving galaxy-scale structures, the nonrelativistic Schrödinger-Poisson system provides a robust and accurate framework.