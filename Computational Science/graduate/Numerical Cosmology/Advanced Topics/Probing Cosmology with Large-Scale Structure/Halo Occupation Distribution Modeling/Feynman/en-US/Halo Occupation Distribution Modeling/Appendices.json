{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of the Halo Occupation Distribution (HOD) is the statistical description of how many galaxies reside within a dark matter halo of a given mass. While a simple Poisson distribution is often assumed for satellite galaxies, more flexible models are needed to capture the full complexity of galaxy formation. This practice explores the impact of using a Negative Binomial distribution, which allows for \"super-Poissonian\" variance, on the satellite-satellite component of the one-halo term . By numerically computing and comparing the outcomes, you will gain crucial hands-on experience with implementing HOD integrals and develop a deeper intuition for how the statistical details of galaxy occupation influence clustering predictions.",
            "id": "3475225",
            "problem": "Consider the Halo Occupation Distribution (HOD) framework in numerical cosmology, where the satellite-satellite part of the one-halo contribution to the galaxy pair density is determined by the second factorial moment of the satellite occupation at fixed halo mass and the halo mass function. Starting from first principles, use the following base facts and definitions to construct and evaluate the required integrals:\n\n1. The satellite-satellite one-halo pair density amplitude is defined by the integral\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}} \\equiv \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle,$$\nwhere $n(M)$ is the differential halo mass function, and $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ is the second factorial moment of the satellite occupation conditioned on halo mass $M$.\n\n2. By definition of mean and variance for a nonnegative integer-valued random variable $N$, one has\n$$\\left\\langle N(N-1) \\right\\rangle = \\left\\langle N^2 \\right\\rangle - \\left\\langle N \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle.$$\nUse this identity together with the well-tested variance properties of the Poisson distribution and the Negative Binomial (NB) distribution to derive $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ for both cases:\n- For the Poisson distribution, the variance equals the mean.\n- For the Negative Binomial distribution parameterized by a positive dispersion parameter $k$, the variance equals the mean plus the squared mean divided by $k$.\n\n3. Adopt the following physically plausible, smooth parameterizations:\n- Halo mass function\n$$n(M) = n_0 \\left(\\frac{M}{M_0}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_{\\mathrm{cut}}}\\right),$$\nwith $M$ in $\\mathrm{M}_\\odot/h$ and $n(M)$ in $h^3 \\mathrm{Mpc}^{-3} \\, (\\mathrm{M}_\\odot/h)^{-1}$.\n- Probability of hosting a central galaxy\n$$P_{\\mathrm{cen}}(M) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(\\frac{\\ln M - \\ln M_{\\min}^{\\mathrm{cen}}}{\\sigma_{\\ln M}}\\right)\\right],$$\nwith $P_{\\mathrm{cen}}(M) \\in [0,1]$.\n- Mean satellite occupation conditioned on $M$\n$$\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle = P_{\\mathrm{cen}}(M) \\left(\\frac{\\max\\{M - M_0^{\\mathrm{sat}}, \\, 0\\}}{M_1}\\right)^{\\alpha},$$\nwhere the power-law applies only when $M > M_0^{\\mathrm{sat}}$ and is suppressed otherwise.\n\n4. Define the dimensionless impact of super-Poisson satellite variance on the one-halo satellite-satellite term as the ratio of amplitudes from the Negative Binomial case to the Poisson case:\n$$\\mathcal{R} \\equiv \\frac{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})},$$\nwhich is unitless.\n\nYour task is to write a complete program that:\n- For each test case, constructs $n(M)$ and $\\mu_{\\mathrm{sat}}(M)$ using the parameters provided.\n- Computes $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$ for the Poisson case and for the Negative Binomial case using the variance identity in item $2$.\n- Numerically evaluates the integrals for $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ and $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$ over the specified mass range $\\left[M_{\\min}, M_{\\max}\\right]$.\n- Returns the dimensionless ratio $\\mathcal{R}$ for each test case.\n\nUse radians for any implicit angle arguments in special functions (the error function has no angle argument, so no angles are present here). Since the final reported quantity is a ratio, there is no physical unit to express in the output. Ensure the numerical integration is robust over many decades in mass.\n\nTest Suite (each case specifies $\\{n_0, M_0, \\beta, M_{\\mathrm{cut}}, M_{\\min}^{\\mathrm{cen}}, \\sigma_{\\ln M}, M_0^{\\mathrm{sat}}, M_1, \\alpha, k, M_{\\min}, M_{\\max}\\}$):\n- Case $1$ (general, moderate super-Poisson): $\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 5.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$.\n- Case $2$ (near-Poisson limit): $\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 1.0\\times 10^{9}, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$.\n- Case $3$ (rare satellites, steeper mass function): $\\{\\, n_0 = 2.5\\times 10^{-18}, \\, M_0 = 8.0\\times 10^{12}, \\, \\beta = 2.2, \\, M_{\\mathrm{cut}} = 3.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 1.0\\times 10^{12}, \\, \\sigma_{\\ln M} = 0.7, \\, M_0^{\\mathrm{sat}} = 2.0\\times 10^{12}, \\, M_1 = 5.0\\times 10^{13}, \\, \\alpha = 0.8, \\, k = 2.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 8.0\\times 10^{14} \\, \\}$.\n- Case $4$ (high-mass dominated, strong super-Poisson): $\\{\\, n_0 = 1.5\\times 10^{-18}, \\, M_0 = 2.0\\times 10^{13}, \\, \\beta = 1.5, \\, M_{\\mathrm{cut}} = 1.0\\times 10^{15}, \\, M_{\\min}^{\\mathrm{cen}} = 8.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.4, \\, M_0^{\\mathrm{sat}} = 1.5\\times 10^{12}, \\, M_1 = 8.0\\times 10^{12}, \\, \\alpha = 1.3, \\, k = 1.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 2.0\\times 10^{15} \\, \\}$.\n\nAlgorithmic requirements:\n- Perform the mass integral by a stable change of variables, for example $x \\equiv \\ln M$, so that $\\mathrm{d}M = M \\, \\mathrm{d}x$, and integrate over $x \\in [\\ln M_{\\min}, \\ln M_{\\max}]$.\n- Use the identity in item $2$ to compute $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$ for each distribution, given $\\mu_{\\mathrm{sat}}(M)$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the dimensionless ratios $\\mathcal{R}$ for the four cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4\\right]$, where each $\\text{r}_i$ is a float.",
            "solution": "The problem presented is a valid and well-posed exercise in computational astrophysics, specifically within the framework of Halo Occupation Distribution (HOD) modeling. It requires the calculation of a dimensionless ratio, $\\mathcal{R}$, which quantifies the impact of super-Poissonian satellite galaxy statistics on the one-halo satellite-satellite galaxy pair density. This involves deriving the relevant integrands from first principles and then performing numerical integration.\n\nThe fundamental quantity is the satellite-satellite one-halo pair density amplitude, given by the integral:\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}} = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$$\nHere, $n(M)$ is the halo mass function, and $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ is the second factorial moment of the satellite occupation number $N_{\\mathrm{sat}}$ for a halo of mass $M$. Our first step is to determine the form of this moment for the two specified probability distributions governing $N_{\\mathrm{sat}}$.\n\nWe are given the general statistical identity for a non-negative integer-valued random variable $N$:\n$$\\left\\langle N(N-1) \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle$$\nLet $\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle$ be the mean satellite occupation at a given halo mass $M$.\n\nCase 1: Poisson Distribution\nFor a Poisson process, the variance is equal to the mean: $\\mathrm{Var}(N_{\\mathrm{sat}} \\mid M) = \\mu_{\\mathrm{sat}}(M)$. Substituting this into the identity yields:\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{Poisson}} = \\mu_{\\mathrm{sat}}(M) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M) = \\mu_{\\mathrm{sat}}(M)^2$$\nThus, for a Poisson distribution of satellites, the second factorial moment is simply the square of the mean occupation.\n\nCase 2: Negative Binomial (NB) Distribution\nFor the Negative Binomial distribution, the variance is given as $\\mathrm{Var}(N_{\\mathrm{sat}} \\mid M) = \\mu_{\\mathrm{sat}}(M) + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k}$, where $k$ is a constant dispersion parameter. Substituting this into the identity gives:\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{NB}} = \\left( \\mu_{\\mathrm{sat}}(M) + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k} \\right) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M)$$\n$$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{NB}} = \\mu_{\\mathrm{sat}}(M)^2 + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k} = \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right)$$\nThis shows that the second factorial moment for the NB case is larger than the Poisson case by a factor of $(1 + 1/k)$.\n\nNow, we can write the expressions for the amplitudes:\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson}) = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2$$\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) = \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right)$$\nSince the parameter $k$ is provided as a constant for each test case (i.e., it does not depend on the integration variable $M$), the factor $(1 + 1/k)$ can be moved outside the integral:\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) = \\left(1 + \\frac{1}{k}\\right) \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 = \\left(1 + \\frac{1}{k}\\right) A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$$\nThe dimensionless ratio $\\mathcal{R}$ is therefore:\n$$\\mathcal{R} \\equiv \\frac{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})} = \\frac{\\left(1 + \\frac{1}{k}\\right) A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})} = 1 + \\frac{1}{k}$$\nThis analytical simplification reveals that the final ratio depends only on the dispersion parameter $k$. However, the problem explicitly instructs to construct the models and numerically evaluate the integrals. This procedure acts as a robust verification of the analytical result and ensures all aspects of the HOD model are correctly implemented.\n\nThe numerical implementation strategy is as follows:\n1.  Define Python functions for the specified parameterizations:\n    -   Halo Mass Function: $n(M) = n_0 \\left(\\frac{M}{M_0}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_{\\mathrm{cut}}}\\right)$\n    -   Central Galaxy Probability: $P_{\\mathrm{cen}}(M) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(\\frac{\\ln M - \\ln M_{\\min}^{\\mathrm{cen}}}{\\sigma_{\\ln M}}\\right)\\right]$\n    -   Mean Satellite Occupation: $\\mu_{\\mathrm{sat}}(M) = P_{\\mathrm{cen}}(M) \\left(\\frac{\\max\\{M - M_0^{\\mathrm{sat}}, 0\\}}{M_1}\\right)^{\\alpha}$\n\n2.  To handle the large dynamic range of the halo mass $M$, we perform a change of variables to logarithmic space: $x = \\ln M$, which implies $M = e^x$ and $\\mathrm{d}M = M \\, \\mathrm{d}x = e^x \\, \\mathrm{d}x$. The integration limits become $[\\ln M_{\\min}, \\ln M_{\\max}]$.\n\n3.  The integrands in terms of $x$ are:\n    -   For the Poisson case: $I_{\\mathrm{Poisson}}(x) = e^x \\, n(e^x) \\, \\mu_{\\mathrm{sat}}(e^x)^2$\n    -   For the NB case: $I_{\\mathrm{NB}}(x) = e^x \\, n(e^x) \\, \\mu_{\\mathrm{sat}}(e^x)^2 \\left(1 + \\frac{1}{k}\\right)$\n\n4.  For each test case, the definite integrals for $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ and $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$ are computed over the range $[\\ln M_{\\min}, \\ln M_{\\max}]$ using the `quad` function from the `scipy.integrate` library, which is a robust numerical quadrature routine.\n\n5.  The final ratio $\\mathcal{R}$ is computed from the results of the numerical integrations. This process is repeated for all four test cases provided. The resulting code implements these steps faithfully.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the HOD problem for the given test suite.\n    \n    This function calculates the dimensionless ratio R for four different sets of\n    cosmological and HOD parameters. It does so by numerically integrating\n    the required expressions for the satellite-satellite one-halo term amplitude\n    for both Poisson and Negative Binomial satellite distributions and then\n    taking their ratio.\n    \"\"\"\n    \n    # Test Suite Data:\n    # {n0, M0, beta, M_cut, M_min_cen, sigma_lnM, M0_sat, M1, alpha, k, M_min, M_max}\n    test_cases = [\n        # Case 1 (general, moderate super-Poisson)\n        (2.0e-18, 1.0e13, 1.8, 6.0e14, 6.0e11, 0.5, 1.0e12, 1.2e13, 1.1, 5.0, 1.0e11, 1.0e15),\n        # Case 2 (near-Poisson limit)\n        (2.0e-18, 1.0e13, 1.8, 6.0e14, 6.0e11, 0.5, 1.0e12, 1.2e13, 1.1, 1.0e9, 1.0e11, 1.0e15),\n        # Case 3 (rare satellites, steeper mass function)\n        (2.5e-18, 8.0e12, 2.2, 3.0e14, 1.0e12, 0.7, 2.0e12, 5.0e13, 0.8, 2.0, 1.0e11, 8.0e14),\n        # Case 4 (high-mass dominated, strong super-Poisson)\n        (1.5e-18, 2.0e13, 1.5, 1.0e15, 8.0e11, 0.4, 1.5e12, 8.0e12, 1.3, 1.0, 1.0e11, 2.0e15),\n    ]\n\n    results = []\n    \n    # HOD Model Functions\n    def n_M(M, n0, M0, beta, M_cut):\n        \"\"\"Halo mass function n(M).\"\"\"\n        return n0 * (M / M0)**(-beta) * np.exp(-M / M_cut)\n\n    def P_cen(M, M_min_cen, sigma_lnM):\n        \"\"\"Probability of hosting a central galaxy.\"\"\"\n        # Use np.log for natural logarithm as specified by \"ln\"\n        arg = (np.log(M) - np.log(M_min_cen)) / sigma_lnM\n        return 0.5 * (1.0 + special.erf(arg))\n\n    def mu_sat(M, M_min_cen, sigma_lnM, M0_sat, M1, alpha):\n        \"\"\"Mean satellite occupation <N_sat|M>.\"\"\"\n        p_cen_val = P_cen(M, M_min_cen, sigma_lnM)\n        mass_term = np.maximum(M - M0_sat, 0)\n        return p_cen_val * (mass_term / M1)**alpha\n\n    # Integrands (in log-space for numerical stability)\n    def an_integrand(ln_M, params, distribution_type):\n        \"\"\"\n        Generic integrand for the A_1h^SS calculation.\n        The change of variables dM = M d(lnM) is included.\n        \"\"\"\n        n0, M0, beta, M_cut, M_min_cen, sigma_lnM, M0_sat, M1, alpha, k, _, _ = params\n        M = np.exp(ln_M)\n\n        # Calculate HOD quantities\n        n_val = n_M(M, n0, M0, beta, M_cut)\n        mu_val = mu_sat(M, M_min_cen, sigma_lnM, M0_sat, M1, alpha)\n\n        # Second factorial moment\n        moment2_fact_poisson = mu_val**2\n        if distribution_type == 'poisson':\n            moment2_fact = moment2_fact_poisson\n        elif distribution_type == 'nb':\n            moment2_fact = moment2_fact_poisson * (1.0 + 1.0 / k)\n        else:\n            raise ValueError(\"Unknown distribution type\")\n\n        return M * n_val * moment2_fact\n\n    for case in test_cases:\n        _, _, _, _, _, _, _, _, _, _, M_min, M_max = case\n        \n        ln_M_min = np.log(M_min)\n        ln_M_max = np.log(M_max)\n\n        # Numerically evaluate the integral for the Poisson case\n        A_poisson, _ = integrate.quad(\n            an_integrand,\n            ln_M_min,\n            ln_M_max,\n            args=(case, 'poisson')\n        )\n        \n        # Numerically evaluate the integral for the Negative Binomial case\n        A_nb, _ = integrate.quad(\n            an_integrand,\n            ln_M_min,\n            ln_M_max,\n            args=(case, 'nb')\n        )\n        \n        # Calculate the ratio, R\n        # Handle the case where A_poisson might be zero to avoid division errors,\n        # though it's physically not expected for the given parameters.\n        if A_poisson == 0:\n            # The analytical result 1 + 1/k is well-defined as long as k is not 0.\n            # If A_poisson is 0, A_nb is also 0, so the ratio is indeterminate.\n            # We'll rely on the analytical form in this unlikely edge case.\n            k = case[9]\n            ratio = 1.0 + 1.0/k\n        else:\n            ratio = A_nb / A_poisson\n            \n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from the statistics within individual halos to the large-scale structure of the universe, the halo model provides a powerful framework for predicting the galaxy two-point correlation function, $\\xi_{gg}(r)$. This function is composed of a one-halo term, describing pairs of galaxies in the same halo, and a two-halo term for pairs in different halos. This exercise asks you to construct a complete, albeit simplified, model for $\\xi_{gg}(r)$ that incorporates the critical physical principle of halo exclusionâ€”the fact that distinct halos cannot overlap . Implementing this model will solidify your understanding of how the HOD formalism translates into a primary observable and how fundamental physical constraints shape the galaxy clustering signal.",
            "id": "3475183",
            "problem": "You are asked to design and implement a numerical estimator for the impact of exclusion of close halo pairs on the galaxy two-point correlation function in the context of halo occupation distribution (HOD) modeling within the standard halo model of large-scale structure.\n\nConsider a threshold galaxy sample defined by a minimum halo mass parameter $M_{\\min}$ such that a halo of mass $M$ hosts a central galaxy only if $M \\ge M_{\\min}$. For satellites, assume a power-law mean occupation in halos that already host a central galaxy. Specifically, assume the following for the halo occupation distribution (HOD) of galaxies:\n- The expected number of central galaxies is $\\langle N_{\\mathrm{c}}(M) \\rangle = \\Theta(M - M_{\\min})$, where $\\Theta(x)$ is the Heaviside step function defined by $\\Theta(x) = 1$ if $x > 0$ and $\\Theta(x) = 0$ otherwise.\n- The expected number of satellite galaxies is $\\langle N_{\\mathrm{s}}(M) \\rangle = \\Theta(M - M_{\\min}) \\left( \\dfrac{M}{M_{1}} \\right)^{\\alpha}$, where $M_{1}$ and $\\alpha$ are parameters, and all masses are in units of $\\mathrm{M}_{\\odot}/h$.\n\nAssume the following simplified, but physically grounded, ingredients of the halo model:\n- A cosmology with matter density parameter $\\Omega_{\\mathrm{m}} = 0.3$ and Hubble parameter $h = 1$ so that all distances are in $h^{-1}\\,\\mathrm{Mpc}$ and all masses are in $\\mathrm{M}_{\\odot}/h$. Use the critical density $\\rho_{\\mathrm{crit},0} = 2.775\\times 10^{11}\\,\\mathrm{M}_{\\odot}\\,\\mathrm{Mpc}^{-3}$; since $h=1$, the mean matter density is $\\bar{\\rho}_{\\mathrm{m}} = \\Omega_{\\mathrm{m}} \\rho_{\\mathrm{crit},0}$.\n- Virialized halos have an overdensity $\\Delta = 200$ with respect to the mean matter density. The virial radius $R_{\\mathrm{vir}}(M)$ is defined implicitly by $M = \\dfrac{4\\pi}{3}\\, \\Delta\\, \\bar{\\rho}_{\\mathrm{m}}\\, R_{\\mathrm{vir}}(M)^{3}$. Define the virial volume $V_{\\mathrm{vir}}(M) = \\dfrac{4\\pi}{3} R_{\\mathrm{vir}}(M)^{3}$.\n- The halo mass function is a Schechter-like form\n$$\nn(M) = \\frac{n_{0}}{M_{*}} \\left( \\frac{M}{M_{*}} \\right)^{-a} \\exp\\!\\left(-\\frac{M}{M_{*}}\\right),\n$$\nwith parameters $n_{0} = 10^{-2}\\, (h^{-1}\\,\\mathrm{Mpc})^{-3}$, $M_{*} = 10^{13}\\,\\mathrm{M}_{\\odot}/h$, and $a = 1.9$. This $n(M)$ has units of $(h^{-1}\\,\\mathrm{Mpc})^{-3}$ per $\\mathrm{M}_{\\odot}/h$.\n- The large-scale halo bias is approximated as $b(M) = 1 + \\left( \\dfrac{M}{M_{b}} \\right)^{\\beta}$ with $M_{b} = 10^{13}\\,\\mathrm{M}_{\\odot}/h$ and $\\beta = 0.1$.\n- The matter two-point correlation function at $z=0$ may be approximated near the scale of interest by a power-law $\\xi_{\\mathrm{m}}(r) = \\left( \\dfrac{r_{0}}{r} \\right)^{\\gamma}$ with $r_{0} = 5\\,h^{-1}\\,\\mathrm{Mpc}$ and $\\gamma = 1.8$.\n- Satellites trace a uniform number density within $R_{\\mathrm{vir}}(M)$, so that the spherically averaged three-dimensional probability density of satellite positions around the central is $\\lambda_{\\mathrm{cs}}(\\mathbf{r}\\,|\\,M) = V_{\\mathrm{vir}}(M)^{-1}$ for $|\\mathbf{r}| < R_{\\mathrm{vir}}(M)$ and zero otherwise. For the purposes of this problem, neglect satellite-satellite contributions to the one-halo term.\n\nLet the galaxy number density be\n$$\n\\bar{n}_{\\mathrm{g}} = \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\left[\\langle N_{\\mathrm{c}}(M) \\rangle + \\langle N_{\\mathrm{s}}(M) \\rangle \\right],\n$$\nand the galaxy bias be\n$$\nb_{\\mathrm{g}} = \\frac{1}{\\bar{n}_{\\mathrm{g}}} \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\left[\\langle N_{\\mathrm{c}}(M) \\rangle + \\langle N_{\\mathrm{s}}(M) \\rangle \\right]\\, b(M).\n$$\n\nUsing the above, model the galaxy two-point correlation function $\\xi_{\\mathrm{gg}}(r)$ at a fixed separation $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$ as a sum of one-halo and two-halo terms:\n- The one-halo term is approximated by the central-satellite contribution\n$$\n\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) = \\frac{1}{\\bar{n}_{\\mathrm{g}}^{2}} \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\langle N_{\\mathrm{c}}(M) \\rangle \\langle N_{\\mathrm{s}}(M) \\rangle\\, \\lambda_{\\mathrm{cs}}(r\\,|\\,M),\n$$\nwhere by spherical symmetry $\\lambda_{\\mathrm{cs}}(r\\,|\\,M)=V_{\\mathrm{vir}}(M)^{-1}$ if $R_{\\mathrm{vir}}(M) > r$ and $0$ otherwise.\n- The two-halo term without exclusion is approximated by linear biasing as\n$$\n\\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r) = b_{\\mathrm{g}}^{2} \\, \\xi_{\\mathrm{m}}(r).\n$$\n\nNow impose a fixed exclusion radius $R_{\\mathrm{ex}}$ such that distinct halos are not allowed to contribute two-halo pairs at separations $r \\le R_{\\mathrm{ex}}$. Implement exclusion by multiplying the two-halo term by a sharp step function $S(r; R_{\\mathrm{ex}})$ defined as $S(r; R_{\\mathrm{ex}}) = 1$ if $r > R_{\\mathrm{ex}}$ and $S(r; R_{\\mathrm{ex}}) = 0$ if $r \\le R_{\\mathrm{ex}}$. Then\n$$\n\\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,ex}}(r) = S(r; R_{\\mathrm{ex}})\\, b_{\\mathrm{g}}^{2}\\, \\xi_{\\mathrm{m}}(r).\n$$\n\nDefine the total galaxy correlation without exclusion as $\\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r) = \\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r)$ and with exclusion as $\\xi_{\\mathrm{gg}}^{\\mathrm{ex}}(r) = \\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,ex}}(r)$. Your task is to compute the fractional change\n$$\n\\Delta(r) \\equiv \\frac{\\xi_{\\mathrm{gg}}^{\\mathrm{ex}}(r) - \\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r)}{\\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r)}\n$$\nat $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$ for a threshold sample with given $(M_{\\min}, M_{1}, \\alpha)$ and $R_{\\mathrm{ex}}$.\n\nPhysical and numerical units:\n- All distances must be in $h^{-1}\\,\\mathrm{Mpc}$.\n- All masses must be in $\\mathrm{M}_{\\odot}/h$.\n- The output fractional change $\\Delta(r)$ is dimensionless and must be reported as a decimal number.\n\nImplement a program that numerically evaluates the above integrals using a log-spaced mass grid over a sufficiently broad range to ensure convergence. Use the Heaviside function as defined above, and assume $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$ exactly. You must not introduce any additional modeling beyond what is specified.\n\nTest suite:\nCompute and report $\\Delta(r)$ for the following parameter sets:\n- Case $1$ (happy path): $M_{\\min} = 10^{12}\\,\\mathrm{M}_{\\odot}/h$, $M_{1} = 10^{13}\\,\\mathrm{M}_{\\odot}/h$, $\\alpha = 1.0$, $R_{\\mathrm{ex}} = 0.5\\,h^{-1}\\,\\mathrm{Mpc}$.\n- Case $2$ (boundary condition): $M_{\\min} = 10^{12}\\,\\mathrm{M}_{\\odot}/h$, $M_{1} = 10^{13}\\,\\mathrm{M}_{\\odot}/h$, $\\alpha = 1.0$, $R_{\\mathrm{ex}} = 1.0\\,h^{-1}\\,\\mathrm{Mpc}$.\n- Case $3$ (edge case with stronger exclusion and rarer hosts): $M_{\\min} = 5\\times 10^{12}\\,\\mathrm{M}_{\\odot}/h$, $M_{1} = 10^{13}\\,\\mathrm{M}_{\\odot}/h$, $\\alpha = 1.0$, $R_{\\mathrm{ex}} = 2.0\\,h^{-1}\\,\\mathrm{Mpc}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[x_{1},x_{2},x_{3}]$), where each $x_{i}$ is the computed decimal value of $\\Delta(r)$ for the corresponding case. Report each value rounded to $6$ decimal places. No additional text should be printed.",
            "solution": "The problem is valid. It presents a well-defined and self-contained numerical task within the standard scientific framework of the halo model in cosmology. All necessary physical parameters, functional forms, and conditions are provided, and there are no internal contradictions or scientific inaccuracies. The task is to compute the fractional change in the galaxy two-point correlation function due to a model of halo exclusion.\n\nThe quantity to be computed is the fractional change $\\Delta(r)$ at a separation $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$, defined as:\n$$\n\\Delta(r) \\equiv \\frac{\\xi_{\\mathrm{gg}}^{\\mathrm{ex}}(r) - \\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r)}{\\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r)}\n$$\nThe total galaxy correlation functions with and without exclusion are given by the sum of one-halo and two-halo terms:\n$$\n\\xi_{\\mathrm{gg}}^{\\mathrm{noex}}(r) = \\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r)\n$$\n$$\n\\xi_{\\mathrm{gg}}^{\\mathrm{ex}}(r) = \\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,ex}}(r)\n$$\nSubstituting these into the definition of $\\Delta(r)$, the one-halo term $\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r)$ cancels out from the numerator:\n$$\n\\Delta(r) = \\frac{\\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,ex}}(r) - \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r)}{\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + \\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r)}\n$$\nThe two-halo terms are defined using the galaxy bias $b_{\\mathrm{g}}$, the matter correlation function $\\xi_{\\mathrm{m}}(r)$, and the exclusion step function $S(r; R_{\\mathrm{ex}})$:\n$$\n\\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,noex}}(r) = b_{\\mathrm{g}}^{2} \\, \\xi_{\\mathrm{m}}(r)\n$$\n$$\n\\xi_{\\mathrm{gg}}^{2\\mathrm{h,\\,ex}}(r) = S(r; R_{\\mathrm{ex}})\\, b_{\\mathrm{g}}^{2}\\, \\xi_{\\mathrm{m}}(r)\n$$\nwhere $S(r; R_{\\mathrm{ex}}) = 1$ if $r > R_{\\mathrm{ex}}$ and $S(r; R_{\\mathrm{ex}}) = 0$ if $r \\le R_{\\mathrm{ex}}$.\nThis leads to a simplified expression for the fractional change:\n$$\n\\Delta(r) = \\frac{(S(r; R_{\\mathrm{ex}}) - 1) \\, b_{\\mathrm{g}}^2 \\, \\xi_{\\mathrm{m}}(r)}{\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) + b_{\\mathrm{g}}^2 \\, \\xi_{\\mathrm{m}}(r)}\n$$\nThe evaluation is at a fixed separation $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$. The value of the step function $S(1; R_{\\mathrm{ex}})$ depends on the exclusion radius $R_{\\mathrm{ex}}$ for each test case:\n- If $R_{\\mathrm{ex}} < 1\\,h^{-1}\\,\\mathrm{Mpc}$, then $S(1; R_{\\mathrm{ex}}) = 1$, making the numerator zero and hence $\\Delta(1) = 0$.\n- If $R_{\\mathrm{ex}} \\ge 1\\,h^{-1}\\,\\mathrm{Mpc}$, then $S(1; R_{\\mathrm{ex}}) = 0$, and the expression becomes:\n$$\n\\Delta(1) = \\frac{- b_{\\mathrm{g}}^2 \\, \\xi_{\\mathrm{m}}(1)}{\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(1) + b_{\\mathrm{g}}^2 \\, \\xi_{\\mathrm{m}}(1)}\n$$\nTo compute $\\Delta(1)$, we must first calculate the components $b_{\\mathrm{g}}$, $\\xi_{\\mathrm{m}}(1)$, and $\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(1)$.\n\nThe matter correlation function at $r = 1\\,h^{-1}\\,\\mathrm{Mpc}$ is a direct calculation:\n$$\n\\xi_{\\mathrm{m}}(1) = \\left( \\frac{r_{0}}{1} \\right)^{\\gamma} = (5)^{1.8}\n$$\nThe galaxy bias $b_{\\mathrm{g}}$ and one-halo term $\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(1)$ require numerical integration over the halo mass function $n(M)$. We define the necessary halo model ingredients based on the problem statement. The mean matter density $\\bar{\\rho}_{\\mathrm{m}}$ is $\\Omega_{\\mathrm{m}}\\rho_{\\mathrm{crit},0}$.\n\nThe mean galaxy number density $\\bar{n}_{\\mathrm{g}}$ is given by the integral of the total mean number of galaxies per halo, $\\langle N(M) \\rangle = \\langle N_{\\mathrm{c}}(M) \\rangle + \\langle N_{\\mathrm{s}}(M) \\rangle$, weighted by the halo mass function $n(M)$:\n$$\n\\bar{n}_{\\mathrm{g}} = \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\langle N(M) \\rangle = \\int_{M_{\\min}}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\left[1 + \\left( \\frac{M}{M_{1}} \\right)^{\\alpha} \\right]\n$$\nThe galaxy bias $b_{\\mathrm{g}}$ is the mean of the halo bias $b(M)$, weighted by the number of galaxies in each halo:\n$$\nb_{\\mathrm{g}} = \\frac{1}{\\bar{n}_{\\mathrm{g}}} \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\langle N(M) \\rangle\\, b(M) = \\frac{1}{\\bar{n}_{\\mathrm{g}}} \\int_{M_{\\min}}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\left[1 + \\left( \\frac{M}{M_{1}} \\right)^{\\alpha} \\right] b(M)\n$$\nThe one-halo term is given by:\n$$\n\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(r) = \\frac{1}{\\bar{n}_{\\mathrm{g}}^{2}} \\int_{0}^{\\infty} \\mathrm{d}M\\, n(M)\\, \\langle N_{\\mathrm{c}}(M) \\rangle \\langle N_{\\mathrm{s}}(M) \\rangle\\, \\lambda_{\\mathrm{cs}}(r\\,|\\,M)\n$$\nThe satellite density profile $\\lambda_{\\mathrm{cs}}(r\\,|\\,M)$ is non-zero only for halos large enough to contain the separation $r$, i.e., $R_{\\mathrm{vir}}(M) > r$. The condition on mass $M$ is derived from the definition of the virial radius: $M = \\frac{4\\pi}{3} \\Delta \\bar{\\rho}_{\\mathrm{m}} R_{\\mathrm{vir}}^3$. Thus, $R_{\\mathrm{vir}}(M) > r$ implies $M > M_{\\mathrm{Th}}(r)$, where $M_{\\mathrm{Th}}(r) = \\frac{4\\pi}{3} r^3 \\Delta \\bar{\\rho}_{\\mathrm{m}}$. For $r=1\\,h^{-1}\\,\\mathrm{Mpc}$, let's denote this threshold mass $M_{\\mathrm{Th}}$. The integration is non-zero only for masses $M > \\max(M_{\\min}, M_{\\mathrm{Th}})$. The satellite profile is $\\lambda_{\\mathrm{cs}}(r|M) = 1/V_{\\mathrm{vir}}(M) = \\Delta \\bar{\\rho}_{\\mathrm{m}} / M$.\n$$\n\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(1) = \\frac{1}{\\bar{n}_{\\mathrm{g}}^{2}} \\int_{\\max(M_{\\min}, M_{\\mathrm{Th}})}^\\infty \\mathrm{d}M\\, n(M)\\, \\left( \\frac{M}{M_{1}} \\right)^{\\alpha}\\, \\frac{\\Delta \\bar{\\rho}_{\\mathrm{m}}}{M}\n$$\nThese integrals are evaluated numerically using the trapezoidal rule over a logarithmically spaced mass grid from $M=10^{10}\\,\\mathrm{M}_{\\odot}/h$ to $M=10^{16}\\,\\mathrm{M}_{\\odot}/h$, ensuring convergence.\n\nThe calculation proceeds as follows for each test case:\n1.  Set the HOD parameters $(M_{\\min}, M_{1}, \\alpha)$ and the exclusion radius $R_{\\mathrm{ex}}$.\n2.  Compute constants like $\\bar{\\rho}_{\\mathrm{m}}$ and $M_{\\mathrm{Th}}$.\n3.  Numerically integrate to find $\\bar{n}_{\\mathrm{g}}$ and the numerator for $b_{\\mathrm{g}}$, then compute $b_{\\mathrm{g}}$.\n4.  Numerically integrate to find the integral component of $\\xi_{\\mathrm{gg}}^{1\\mathrm{h}}(1)$, then compute the full term.\n5.  Calculate $\\xi_{\\mathrm{m}}(1)$ and the two-halo term $b_{\\mathrm{g}}^2 \\xi_{\\mathrm{m}}(1)$.\n6.  Apply the exclusion logic based on $R_{\\mathrm{ex}}$ to compute $\\Delta(1)$.\n\nFor Case 1, $R_{\\mathrm{ex}} = 0.5 < 1$, so $\\Delta(1) = 0$.\nFor Cases 2 and 3, $R_{\\mathrm{ex}} \\ge 1$, so the full calculation is required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fractional change in the galaxy two-point correlation function\n    due to halo exclusion for three test cases.\n    \"\"\"\n\n    # Physical and cosmological constants\n    RHO_CRIT_0 = 2.775e11  # M_sun * Mpc^-3\n    OMEGA_M = 0.3\n    H = 1.0  # Assumed h=1.0\n    DELTA = 200.0  # Virial overdensity\n\n    # Halo mass function parameters (Schechter-like)\n    N0 = 1e-2  # (h^-1 Mpc)^-3\n    M_STAR = 1e13  # M_sun/h\n    A = 1.9\n\n    # Halo bias parameters\n    M_B = 1e13  # M_sun/h\n    BETA = 0.1\n\n    # Matter correlation function parameters\n    R0 = 5.0  # h^-1 Mpc\n    GAMMA = 1.8\n    R_EVAL = 1.0  # h^-1 Mpc, evaluation scale\n\n    # Mean matter density\n    rho_m_bar = OMEGA_M * RHO_CRIT_0  # M_sun/h * (h^-1 Mpc)^-3\n\n    # Define a log-spaced mass grid for numerical integration\n    mass_grid = np.logspace(10, 16, 10000)  # M_sun/h\n\n    # --- Pre-calculate mass-dependent functions on the grid ---\n    # Halo mass function n(M)\n    nm = (N0 / M_STAR) * (mass_grid / M_STAR)**(-A) * np.exp(-mass_grid / M_STAR)\n    # Halo bias b(M)\n    bm = 1.0 + (mass_grid / M_B)**BETA\n\n    # Test cases\n    test_cases = [\n        # Case 1: happy path\n        {'m_min': 1e12, 'm1': 1e13, 'alpha': 1.0, 'r_ex': 0.5},\n        # Case 2: boundary condition\n        {'m_min': 1e12, 'm1': 1e13, 'alpha': 1.0, 'r_ex': 1.0},\n        # Case 3: edge case\n        {'m_min': 5e12, 'm1': 1e13, 'alpha': 1.0, 'r_ex': 2.0},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        m_min = case['m_min']\n        m1 = case['m1']\n        alpha = case['alpha']\n        r_ex = case['r_ex']\n\n        # Determine the value of the exclusion step function S(r; R_ex)\n        # S = 1 if r > R_ex, 0 if r = R_ex.\n        # We are interested in S-1 for the fractional change formula.\n        s_minus_1 = 0.0 if R_EVAL > r_ex else -1.0\n\n        # If S-1 is zero, the fractional change is zero.\n        if s_minus_1 == 0.0:\n            results.append(0.0)\n            continue\n\n        # --- Calculate HOD-dependent quantities for the current case ---\n        # Heaviside step function for halo occupation\n        heaviside = (mass_grid > m_min).astype(float)\n\n        # Mean number of central and satellite galaxies\n        n_cen = heaviside\n        n_sat = heaviside * (mass_grid / m1)**alpha\n        n_total = n_cen + n_sat\n\n        # --- Numerical Integrations ---\n        # 1. Galaxy number density n_g\n        integrand_ng = nm * n_total\n        n_g_bar = np.trapz(integrand_ng, mass_grid)\n\n        # 2. Galaxy bias b_g\n        integrand_bg = nm * n_total * bm\n        bg_numerator = np.trapz(integrand_bg, mass_grid)\n        b_g = bg_numerator / n_g_bar\n\n        # 3. One-halo term xi_gg^1h\n        # Mass threshold for a halo to contain the separation R_EVAL\n        m_thresh_1h = (4.0 / 3.0) * np.pi * R_EVAL**3 * DELTA * rho_m_bar\n        \n        # Integrand for the 1h term. Non-zero only if M > M_min and M > M_thresh_1h\n        integrand_1h = nm * n_cen * n_sat * (DELTA * rho_m_bar / mass_grid)\n        mask_1h = mass_grid > m_thresh_1h\n        integrand_1h[~mask_1h] = 0.0\n        \n        integral_1h = np.trapz(integrand_1h, mass_grid)\n        xi_gg_1h = integral_1h / (n_g_bar**2)\n\n        # --- Calculate Correlation Function Components ---\n        # Matter correlation function xi_m\n        xi_m = (R0 / R_EVAL)**GAMMA\n\n        # Two-halo term without exclusion\n        xi_gg_2h_noex = b_g**2 * xi_m\n\n        # Total correlation function without exclusion (denominator of Delta)\n        xi_gg_noex = xi_gg_1h + xi_gg_2h_noex\n        \n        # --- Final Calculation of Fractional Change Delta(r) ---\n        # Numerator of Delta is (S-1) * xi_gg^2h_noex\n        delta_r_numerator = s_minus_1 * xi_gg_2h_noex\n        \n        if xi_gg_noex == 0:\n            delta_r = 0.0 # Avoid division by zero, though unlikely\n        else:\n            delta_r = delta_r_numerator / xi_gg_noex\n        \n        results.append(round(delta_r, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The predictive power of HOD models extends beyond analyzing existing data to planning future observational campaigns. The Fisher Information Matrix (FIM) formalism allows us to forecast a survey's ability to constrain model parameters, enabling us to optimize survey strategy for maximum scientific return. In this advanced capstone exercise, you will step into the role of a survey designer tasked with allocating precious spectroscopic resources . You will formulate and solve a D-optimal design problem to find the most efficient observing strategy, a powerful technique that integrates statistical forecasting with HOD modeling and is at the forefront of planning next-generation cosmological surveys.",
            "id": "3475222",
            "problem": "You are tasked with formulating and solving a resource allocation problem in halo occupation distribution modeling. Consider a spectroscopic survey that allocates observing time across discrete apparent magnitude bins to gather redshifts. The scientific goal is to maximize the expected information on two halo occupation distribution parameters: the characteristic satellite mass scale $M_1$ and the satellite occupation slope $\\alpha$, using only number counts extracted from spectra. Assume the following modeling setup grounded in standard definitions.\n\nBase modeling assumptions:\n- Halo mass function: the comoving halo mass function is modeled by a Schechter-like form $n(M) = n_0 \\left(\\frac{M}{M_\\star}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_\\star}\\right)$ over $M \\in [M_{\\min}, M_{\\max}]$.\n- Satellite-only dependence: the expected satellite occupation is $\\langle N_{\\mathrm{sat}} \\mid M \\rangle = \\left(\\frac{M}{M_1}\\right)^{\\alpha}$ for $M \\ge M_{\\min}$ and $0$ otherwise.\n- Magnitude-bin selection: each magnitude bin $i \\in \\{1,\\dots,B\\}$ is represented by a selection weight $S_i(M)$ that is a log-normal (Gaussian in $\\log_{10} M$) centered at $M_i$ with scatter $\\sigma_i$ (in dex), i.e., $S_i(M) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_i} \\exp\\left[-\\frac{\\left(\\log_{10} M - \\log_{10} M_i\\right)^2}{2\\sigma_i^2}\\right]$.\n- Expected counts per bin: the expected number of galaxies contributing to bin $i$ per spectroscopic success is modeled as\n$$\n\\mu_i(M_1,\\alpha) = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,S_i(M)\\,dM.\n$$\n- Likelihood and information: let $N_i$ be the observed spectroscopic counts in bin $i$ from $s_i$ successful spectra. Assume $N_i$ follows a Poisson distribution with mean $\\Lambda_i(M_1,\\alpha;s_i) = s_i\\,\\mu_i(M_1,\\alpha)$, with different bins treated as independent. The Fisher Information Matrix (FIM) for parameters $\\boldsymbol{\\theta} = (M_1,\\alpha)$ from Poisson counts is defined via the standard second-derivative expectation of the log-likelihood. To regularize and ensure positive-definiteness, include an independent Gaussian prior Fisher matrix $\\mathbf{P} = \\mathrm{diag}(\\pi_{M_1}, \\pi_{\\alpha})$ with small positive entries.\n\nDecision variables and constraints:\n- Decision variables are the per-bin spectroscopic allocations $\\mathbf{s} = (s_1,\\dots,s_B)$, where $s_i$ represents the number of successful spectra obtained in bin $i$.\n- Observing resource constraints are:\n  1. Total fibers: $\\sum_{i=1}^{B} s_i \\le F_{\\mathrm{tot}}$.\n  2. Total time: $\\sum_{i=1}^{B} \\frac{s_i}{a_i} \\le T_{\\mathrm{tot}}$, where $a_i  0$ is the per-bin spectroscopic efficiency (successful spectra per unit time).\n  3. Bin caps: $0 \\le s_i \\le S^{\\max}_i$, with $S^{\\max}_i$ the maximum number of available targets that can be observed in bin $i$.\n\nOptimization goal:\n- Use a D-optimal design criterion to choose $\\mathbf{s}$ that maximizes the determinant of the Fisher Information Matrix on $\\boldsymbol{\\theta} = (M_1,\\alpha)$, subject to the above constraints. All other modeling choices follow from the assumptions stated, and you must work from first principles to obtain a tractable objective that depends on $\\mathbf{s}$.\n\nScientific constants and parameter values:\n- Number of bins: $B = 3$.\n- Mass integration limits: $M_{\\min} = 10^{11}\\,h^{-1}M_{\\odot}$, $M_{\\max} = 10^{15}\\,h^{-1}M_{\\odot}$.\n- Halo mass function parameters: $n_0 = 1$, $M_{\\star} = 10^{13}\\,h^{-1}M_{\\odot}$, $\\beta = 1.9$.\n- Satellite occupation parameters (to be inferred around fiducial values): $M_1 = 3\\times 10^{13}\\,h^{-1}M_{\\odot}$, $\\alpha = 1.1$.\n- Selection functions per bin:\n  - Bin $1$: $M_1^{\\mathrm{sel}} = 10^{12}\\,h^{-1}M_{\\odot}$, $\\sigma_1 = 0.3$.\n  - Bin $2$: $M_2^{\\mathrm{sel}} = 10^{12.5}\\,h^{-1}M_{\\odot}$, $\\sigma_2 = 0.3$.\n  - Bin $3$: $M_3^{\\mathrm{sel}} = 10^{13}\\,h^{-1}M_{\\odot}$, $\\sigma_3 = 0.3$.\n- Prior Fisher diagonal entries: $\\pi_{M_1} = 10^{-12}$, $\\pi_{\\alpha} = 10^{-6}$.\n\nTest suite:\nEach test case specifies $(F_{\\mathrm{tot}}, T_{\\mathrm{tot}}, \\mathbf{a}, \\mathbf{S}^{\\max})$. Use the above scientific constants for all tests.\n- Test $1$ (balanced resources): $F_{\\mathrm{tot}} = 3000$, $T_{\\mathrm{tot}} = 7000$, $\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$, $\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$.\n- Test $2$ (fiber-limited): $F_{\\mathrm{tot}} = 800$, $T_{\\mathrm{tot}} = 20000$, $\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$, $\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$.\n- Test $3$ (time-limited): $F_{\\mathrm{tot}} = 10000$, $T_{\\mathrm{tot}} = 1000$, $\\mathbf{a} = [0.6,\\,0.4,\\,0.25]$, $\\mathbf{S}^{\\max} = [4000,\\,2500,\\,1500]$.\n\nRequired outputs:\n- For each test case, compute the optimal spectroscopic allocations $\\mathbf{s}^{\\star} = (s_1^{\\star}, s_2^{\\star}, s_3^{\\star})$ that maximize the D-optimal criterion under the constraints.\n- You must output a single line containing a list of the three allocation vectors, each rounded to six decimal places, in the exact format: $[[s^{\\star}_{1,1},s^{\\star}_{1,2},s^{\\star}_{1,3}],[s^{\\star}_{2,1},s^{\\star}_{2,2},s^{\\star}_{2,3}],[s^{\\star}_{3,1},s^{\\star}_{3,2},s^{\\star}_{3,3}]]$.\n- No physical units appear in the output because the allocations are counts. Angles do not appear. All numeric answers are pure decimals.\n\nYour program must be a complete, runnable implementation that performs the following steps:\n- Construct $\\mu_i(M_1,\\alpha)$ from the stated integrals, evaluate the required derivatives with respect to $M_1$ and $\\alpha$ from first principles, and assemble the Fisher Information Matrix for Poisson counts with the specified prior.\n- Formulate the D-optimal objective and implement a solver that enforces the linear inequality constraints and box constraints on $\\mathbf{s}$.\n- Solve the optimization for each test case and print the requested output. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]]$).",
            "solution": "The user has provided a well-defined optimization problem grounded in the principles of halo occupation distribution (HOD) modeling and statistical survey design. The problem is scientifically sound, self-contained, and algorithmically tractable. I will therefore proceed with a complete solution.\n\nThe problem asks us to find the optimal allocation of spectroscopic observing resources, denoted by the vector of successful spectra per magnitude bin $\\mathbf{s} = (s_1, \\dots, s_B)$, to maximize the scientific information on a set of HOD parameters $\\boldsymbol{\\theta} = (M_1, \\alpha)$. The optimization is subject to several linear constraints on the total number of spectra, total observing time, and the number of targets per bin.\n\nOur approach is as follows:\n1.  Formulate the Fisher Information Matrix (FIM) for the HOD parameters $\\boldsymbol{\\theta}$ given the experimental setup.\n2.  Establish the D-optimal design objective function, which is the determinant of the FIM, $\\det(\\mathbf{F}(\\mathbf{s}))$.\n3.  Show that this leads to a convex optimization problem, which guarantees a unique global maximum and allows for the use of standard numerical solvers.\n4.  Numerically compute the constant terms required for the objective function, which involves evaluating definite integrals based on the provided physical models.\n5.  Implement a solver using `scipy.optimize.minimize` to find the optimal allocation vector $\\mathbf{s}^\\star$ for each of the specified test cases.\n\n### Step 1: Deriving the Fisher Information Matrix\n\nThe observed number of galaxies $N_i$ in bin $i$ is assumed to follow a Poisson distribution with mean $\\Lambda_i = s_i \\mu_i(\\boldsymbol{\\theta})$. The total log-likelihood for independent bins is $\\mathcal{L}(\\boldsymbol{\\theta}) = \\sum_{i=1}^{B} \\left( N_i \\log(\\Lambda_i) - \\Lambda_i - \\log(N_i!) \\right)$.\n\nThe Fisher Information Matrix (FIM) for parameters $\\boldsymbol{\\theta} = (\\theta_j, \\theta_k)$ is defined by its components $F_{jk} = -E\\left[\\frac{\\partial^2 \\mathcal{L}}{\\partial \\theta_j \\partial \\theta_k}\\right]$. Since the bins are independent, the total FIM is the sum of the FIMs from each bin, $\\mathbf{F} = \\sum_{i=1}^B \\mathbf{F}^{(i)}$.\n\nFor a single bin $i$, the derivatives of the log-likelihood are:\n$$\n\\frac{\\partial \\ell_i}{\\partial \\theta_j} = \\left(\\frac{N_i}{\\Lambda_i} - 1\\right) \\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\n$$\n$$\n\\frac{\\partial^2 \\ell_i}{\\partial \\theta_j \\partial \\theta_k} = -\\frac{N_i}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k} + \\left(\\frac{N_i}{\\Lambda_i} - 1\\right)\\frac{\\partial^2 \\Lambda_i}{\\partial \\theta_j \\partial \\theta_k}\n$$\nTaking the expectation $E[\\cdot]$, and using $E[N_i] = \\Lambda_i$, the second term vanishes.\n$$\nF_{jk}^{(i)} = -E\\left[-\\frac{N_i}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k}\\right] = \\frac{E[N_i]}{\\Lambda_i^2}\\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k} = \\frac{1}{\\Lambda_i} \\frac{\\partial \\Lambda_i}{\\partial \\theta_j}\\frac{\\partial \\Lambda_i}{\\partial \\theta_k}\n$$\nSubstituting $\\Lambda_i = s_i \\mu_i(\\boldsymbol{\\theta})$ and its derivative $\\frac{\\partial \\Lambda_i}{\\partial \\theta_j} = s_i \\frac{\\partial \\mu_i}{\\partial \\theta_j}$, we obtain:\n$$\nF_{jk}^{(i)}(\\mathbf{s}, \\boldsymbol{\\theta}) = s_i \\left( \\frac{1}{\\mu_i} \\frac{\\partial \\mu_i}{\\partial \\theta_j} \\frac{\\partial \\mu_i}{\\partial \\theta_k} \\right)\n$$\nThis expression shows that the FIM for each bin is linear in the allocation variable $s_i$. The term in the parenthesis is a function of the model parameters $\\boldsymbol{\\theta}$ but is independent of the allocations $\\mathbf{s}$. We evaluate this term at the fiducial parameter values $\\boldsymbol{\\theta}_{\\text{fid}} = (M_1, \\alpha)$. Let us define the constant matrices $\\mathbf{K}_i$ for each bin $i$:\n$$\n(\\mathbf{K}_i)_{jk} = \\left. \\frac{1}{\\mu_i} \\frac{\\partial \\mu_i}{\\partial \\theta_j} \\frac{\\partial \\mu_i}{\\partial \\theta_k} \\right|_{\\boldsymbol{\\theta}_{\\text{fid}}}\n$$\nThe total FIM from the data is then $\\mathbf{F}_{\\text{data}}(\\mathbf{s}) = \\sum_{i=1}^{B} s_i \\mathbf{K}_i$.\n\nThe problem states that a Gaussian prior must be included. The total FIM is the sum of the data FIM and the prior FIM, $\\mathbf{P} = \\mathrm{diag}(\\pi_{M_1}, \\pi_{\\alpha})$:\n$$\n\\mathbf{F}(\\mathbf{s}) = \\mathbf{P} + \\sum_{i=1}^{B} s_i \\mathbf{K}_i\n$$\nThe total FIM is an affine function of the allocation vector $\\mathbf{s}$.\n\n### Step 2: The D-Optimal Design Objective\n\nThe D-optimality criterion aims to maximize the determinant of the Fisher Information Matrix, $\\det(\\mathbf{F}(\\mathbf{s}))$. This corresponds to minimizing the volume of the confidence ellipsoid for the parameters $\\boldsymbol{\\theta}$. The optimization problem is:\n$$\n\\begin{aligned}\n \\underset{\\mathbf{s}}{\\text{maximize}}   \\det\\left(\\mathbf{P} + \\sum_{i=1}^{B} s_i \\mathbf{K}_i\\right) \\\\\n \\text{subject to}   \\sum_{i=1}^{B} s_i \\le F_{\\mathrm{tot}} \\\\\n   \\sum_{i=1}^{B} \\frac{s_i}{a_i} \\le T_{\\mathrm{tot}} \\\\\n   0 \\le s_i \\le S^{\\max}_i \\quad \\text{for } i=1,\\dots,B\n\\end{aligned}\n$$\nSince the logarithm is a strictly increasing function, maximizing $\\det(\\mathbf{F}(\\mathbf{s}))$ is equivalent to maximizing its logarithm, $\\log(\\det(\\mathbf{F}(\\mathbf{s})))$.\n\n### Step 3: Formulation as a Convex Optimization Problem\n\nThe objective function can be written as $g(\\mathbf{s}) = \\log \\det(\\mathbf{P} + \\sum_i s_i \\mathbf{K}_i)$. The function $\\log \\det(\\mathbf{X})$ is known to be concave for any positive definite matrix $\\mathbf{X}$. The argument of the determinant, $\\mathbf{A}(\\mathbf{s}) = \\mathbf{P} + \\sum_i s_i \\mathbf{K}_i$, is an affine function of $\\mathbf{s}$. The composition of a concave function with an affine map preserves concavity. Therefore, $g(\\mathbf{s})$ is a concave function of $\\mathbf{s}$.\n\nThe constraints are all linear inequalities, which define a convex set (a polytope). The problem is thus to maximize a concave function over a convex set. This is a standard convex optimization problem. We can solve it by minimizing its negation, $-g(\\mathbf{s})$, which is a convex function. This guarantees that any local minimum found by a suitable algorithm will also be the global minimum. We will use the Sequential Least Squares Programming (SLSQP) algorithm, as implemented in `scipy.optimize.minimize`, which is well-suited for such problems.\n\n### Step 4: Numerical Computation of $\\mathbf{K}_i$\n\nTo construct the matrices $\\mathbf{K}_i$, we need to compute $\\mu_i$ and its partial derivatives with respect to $M_1$ and $\\alpha$ at the fiducial parameter values. The parameters are $\\boldsymbol{\\theta} = (\\theta_1, \\theta_2) = (M_1, \\alpha)$.\n\nThe expected counts per success are:\n$$\n\\mu_i = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,S_i(M)\\,dM\n$$\nThe partial derivatives are found by differentiating under the integral sign:\n$$\n\\frac{\\partial \\mu_i}{\\partial M_1} = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\, M^\\alpha\\,(-\\alpha M_1^{-\\alpha-1})\\,S_i(M)\\,dM = -\\frac{\\alpha}{M_1} \\mu_i\n$$\n$$\n\\frac{\\partial \\mu_i}{\\partial \\alpha} = \\int_{M_{\\min}}^{M_{\\max}} n(M)\\,\\left(\\frac{M}{M_1}\\right)^{\\alpha}\\,\\ln\\left(\\frac{M}{M_1}\\right)\\,S_i(M)\\,dM \\equiv I_i\n$$\nThese integrals, $\\mu_i$ and $I_i$, must be computed numerically. We perform a change of variables to $u = \\log_{10} M$, which simplifies the integration range and the form of the selection function. The integration element becomes $dM = 10^u \\ln(10) du$. The integration is performed over $u \\in [\\log_{10} M_{\\min}, \\log_{10} M_{\\max}] = [11, 15]$.\n\nWith these derivatives, the vector of derivatives for bin $i$ is $\\mathbf{d}_i = \\begin{pmatrix} -\\alpha \\mu_i / M_1 \\\\ I_i \\end{pmatrix}$. The matrix $\\mathbf{K}_i$ is the outer product $\\frac{1}{\\mu_i} \\mathbf{d}_i \\mathbf{d}_i^T$:\n$$\n\\mathbf{K}_i = \\frac{1}{\\mu_i} \\begin{pmatrix} (-\\alpha \\mu_i / M_1)^2  (-\\alpha \\mu_i / M_1) I_i \\\\ (-\\alpha \\mu_i / M_1) I_i  I_i^2 \\end{pmatrix} = \\begin{pmatrix} \\alpha^2 \\mu_i / M_1^2  -\\alpha I_i / M_1 \\\\ -\\alpha I_i / M_1  I_i^2 / \\mu_i \\end{pmatrix}\n$$\nWe compute these constant $2 \\times 2$ matrices for each bin $i \\in \\{1, 2, 3\\}$ using the provided fiducial parameters and physical constants.\n\n### Step 5: Implementation and Solution\n\nThe final step is to implement this logic in Python. We first pre-compute the $\\mathbf{K}_i$ matrices using `scipy.integrate.quad` for numerical integration. Then, for each test case, we define the objective function (the negative log-determinant) and the constraints using `scipy.optimize.LinearConstraint` and `scipy.optimize.Bounds`. We call `scipy.optimize.minimize` with the `SLSQP` method to find the optimal spectroscopic allocations $\\mathbf{s}^\\star = (s_1^\\star, s_2^\\star, s_3^\\star)$. The results for the three test cases are then formatted and printed as required.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import minimize, LinearConstraint, Bounds\n\ndef solve():\n    \"\"\"\n    Solves the D-optimal resource allocation problem for a spectroscopic survey.\n    \"\"\"\n    # Scientific constants and fiducial parameter values\n    M_min = 1e11\n    M_max = 1e15\n    n0 = 1.0\n    M_star = 1e13\n    beta = 1.9\n    fid_M1 = 3e13\n    fid_alpha = 1.1\n\n    # Bin-specific parameters\n    B = 3\n    sel_M_centers = np.array([1e12, 10**12.5, 1e13])\n    sel_sigmas = np.array([0.3, 0.3, 0.3])\n    log10_sel_M_centers = np.log10(sel_M_centers)\n\n    # Prior Fisher matrix\n    pi_M1 = 1e-12\n    pi_alpha = 1e-6\n    P_prior = np.diag([pi_M1, pi_alpha])\n    \n    # Integration range in log10(M)\n    u_min = np.log10(M_min)\n    u_max = np.log10(M_max)\n\n    def precompute_matrices():\n        \"\"\"\n        Precomputes the constant matrices K_i for each bin.\n        These matrices form the basis of the optimization objective function.\n        \"\"\"\n        K_matrices = []\n        for i in range(B):\n            log10_M_sel_i = log10_sel_M_centers[i]\n            sigma_i = sel_sigmas[i]\n\n            def integrand_base(u):\n                M = 10**u\n                # Halo Mass Function n(M)\n                nm = n0 * (M / M_star)**(-beta) * np.exp(-M / M_star)\n                # Satellite Occupation N_sat|M\n                nsat = (M / fid_M1)**fid_alpha\n                # Selection Function S_i(M)\n                log_term = (u - log10_M_sel_i) / sigma_i\n                sm = (1 / (np.sqrt(2 * np.pi) * sigma_i)) * np.exp(-0.5 * log_term**2)\n                # Jacobian for dM - du\n                jacobian = M * np.log(10)\n                return nm * nsat * sm * jacobian\n\n            def integrand_mu(u):\n                return integrand_base(u)\n\n            def integrand_I(u):\n                M = 10**u\n                log_M_M1 = np.log(M / fid_M1)\n                return integrand_base(u) * log_M_M1\n\n            mu_i, _ = quad(integrand_mu, u_min, u_max)\n            I_i, _ = quad(integrand_I, u_min, u_max)\n\n            # Assemble the K_i matrix based on the derived formula\n            # K_i = [[alpha^2*mu_i/M1^2, -alpha*I_i/M1],\n            #        [-alpha*I_i/M1,        I_i^2/mu_i]]\n            k11 = fid_alpha**2 * mu_i / fid_M1**2\n            k12 = -fid_alpha * I_i / fid_M1\n            k22 = I_i**2 / mu_i\n            K_i = np.array([[k11, k12], [k12, k22]])\n            K_matrices.append(K_i)\n        \n        return K_matrices\n\n    K_matrices = precompute_matrices()\n    K1, K2, K3 = K_matrices\n\n    def objective_function(s):\n        \"\"\" The negative log-determinant of the total Fisher matrix. \"\"\"\n        s1, s2, s3 = s\n        F_matrix = P_prior + s1 * K1 + s2 * K2 + s3 * K3\n        sign, logdet = np.linalg.slogdet(F_matrix)\n        \n        if sign = 0:\n            # This should not happen for s_i >= 0 as F will be positive definite\n            return np.inf\n        \n        return -logdet\n\n    # Define test cases\n    test_cases = [\n        {'F_tot': 3000, 'T_tot': 7000, 'a': [0.6, 0.4, 0.25], 'S_max': [4000, 2500, 1500]},\n        {'F_tot': 800, 'T_tot': 20000, 'a': [0.6, 0.4, 0.25], 'S_max': [4000, 2500, 1500]},\n        {'F_tot': 10000, 'T_tot': 1000,  'a': [0.6, 0.4, 0.25], 'S_max': [4000, 2500, 1500]},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        F_tot = case['F_tot']\n        T_tot = case['T_tot']\n        a = np.array(case['a'])\n        S_max = case['S_max']\n\n        # Define constraints for the optimizer\n        # Bounds: 0 = s_i = S_max_i\n        bounds = Bounds([0, 0, 0], S_max)\n\n        # Linear constraints: sum(s_i) = F_tot and sum(s_i/a_i) = T_tot\n        inv_a = 1.0 / a\n        linear_constraints = [\n            LinearConstraint(np.ones(B), -np.inf, F_tot),\n            LinearConstraint(inv_a, -np.inf, T_tot)\n        ]\n\n        # Initial guess for the allocation vector s\n        s0 = np.ones(B) * min(F_tot, T_tot * np.mean(a)) / B\n        \n        # Run the optimization\n        opt_result = minimize(\n            objective_function,\n            s0,\n            method='SLSQP',\n            bounds=bounds,\n            constraints=linear_constraints,\n            options={'ftol': 1e-12}\n        )\n        \n        # Store the optimal allocation vector, ensuring non-negativity from floating point errors\n        s_star = np.maximum(0, opt_result.x)\n        results.append(s_star)\n\n    # Format the output string exactly as specified\n    formatted_results = []\n    for s_star in results:\n        formatted_s = [f\"{x:.6f}\" for x in s_star]\n        formatted_results.append(f\"[{','.join(formatted_s)}]\")\n    \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}