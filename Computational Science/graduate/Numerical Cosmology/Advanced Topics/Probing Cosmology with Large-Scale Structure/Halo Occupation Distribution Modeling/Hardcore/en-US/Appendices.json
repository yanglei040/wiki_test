{
    "hands_on_practices": [
        {
            "introduction": "The standard Halo Occupation Distribution (HOD) model often describes the probability of a halo hosting a central galaxy using a smooth \"soft-step\" function characterized by a minimum mass $M_{\\rm min}$ and a transition width $\\sigma_{\\log M}$. While convenient, these parameters have deep physical roots. This analytical exercise guides you through the process of deriving this functional form and its parameters directly from the more fundamental stellar-to-halo mass relation, including its intrinsic lognormal scatter. This practice is essential for understanding the physical meaning of HOD parameters and for quantifying the systematic biases that can arise when the underlying physics of galaxy selection is oversimplified. ",
            "id": "3475178",
            "problem": "Consider a Halo Occupation Distribution (HOD) analysis in numerical cosmology for an abundance-limited galaxy sample selected by a threshold in stellar mass. Let the halo mass be denoted by $M$ and the stellar mass by $M_{\\star}$. Work in base-10 logarithms and define $y \\equiv \\log_{10} M$ and $s \\equiv \\log_{10} M_{\\star}$. Assume the following physically standard ingredients:\n\n1. The halo mass function at the high-mass end is a power law, $n(M)\\,dM = n_{0}\\left(\\frac{M}{M_{0}}\\right)^{-p}\\,dM$ with $p>1$.\n\n2. The conditional distribution of stellar mass at fixed halo mass is lognormal in $s$, such that $s$ at fixed $y$ is Gaussian with mean $\\mu(y) = A + \\beta\\left(y - y_{1}\\right)$ and variance $\\sigma^{2}$, where $A$, $\\beta$, $y_{1}$, and $\\sigma$ are constants. Here $\\sigma$ is the standard deviation of $s=\\log_{10} M_{\\star}$ at fixed $M$.\n\n3. The galaxy sample is selected by a hard threshold $s_{\\rm th}$, i.e., galaxies are included if $s \\ge s_{\\rm th}$. The resulting number density is $n_{\\rm g}(s_{\\rm th}) = \\int n(M)\\,P(s \\ge s_{\\rm th}\\,|\\,M)\\,dM$.\n\n4. The central-galaxy HOD in halo mass is parameterized by the widely used soft-step form\n$$\n\\langle N_{\\rm cen}(M)\\rangle = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\log_{10} M - \\log_{10} M_{\\rm min}}{\\sigma_{\\log M}}\\right)\\right],\n$$\nwhere $\\log_{10} M_{\\rm min}$ determines the characteristic mass scale and $\\sigma_{\\log M}$ sets the width of the transition in $\\log_{10} M$.\n\nStarting from the definitions above and without introducing any shortcut formulas or empirical calibrations beyond these assumptions, derive the impact of the lognormal scatter in $s$ at fixed $M$ on the abundance-limited selection and show how it biases inferences of $M_{\\rm min}$ and $\\sigma_{\\log M}$ if the analysis is mis-specified.\n\nSpecifically:\n\n(a) Define $y_{\\star}$ by $s_{\\rm th}=\\mu(y_{\\star})$, and let $n_{\\rm g}^{(0)}$ denote the zero-scatter number density obtained by replacing $P(s \\ge s_{\\rm th}\\,|\\,M)$ with the sharp step $H(y-y_{\\star})$, where $H(\\cdot)$ is the Heaviside function. Derive the exact multiplicative enhancement factor $R \\equiv \\frac{n_{\\rm g}(s_{\\rm th})}{n_{\\rm g}^{(0)}}$ induced by the lognormal scatter $\\sigma$.\n\n(b) Suppose an analyst ignores the lognormal scatter and infers $\\log_{10} M_{\\rm min}$ by matching the zero-scatter abundance $n_{\\rm g}^{(0)}$ to the true $n_{\\rm g}(s_{\\rm th})$. Derive, in closed form, the ratio $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}}$ between the naively inferred $M_{\\rm min}$ (ignoring scatter) and the correctly inferred $M_{\\rm min}$ (accounting for scatter), expressed in terms of $p$, $\\beta$, and $\\sigma$.\n\n(c) By matching the functional form of the true selection $\\langle N_{\\rm cen}(M)\\rangle$ induced by the lognormal scatter in $s$ to the parametric HOD form given above, derive the exact relation between $\\sigma$ and the true $\\sigma_{\\log M}^{\\rm true}$. Then quantify the bias factor $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}}$ if one naively sets $\\sigma_{\\log M}^{\\rm naive} \\equiv \\sigma$ instead of the correct relation.\n\nProvide the final answer as a two-entry row matrix containing the two bias factors $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}}$ and $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}}$. No numerical evaluation is required; give a closed-form analytic expression.",
            "solution": "The problem asks us to derive the biases in the inferred parameters of a Halo Occupation Distribution (HOD) model when the scatter in the stellar mass-halo mass relation is incorrectly handled. We will proceed by first deriving the true galaxy number density including the effect of scatter, then determining how a simplified (scatter-free) model would misinterpret this density, and finally by relating the physical model of galaxy occupation to a standard parametric HOD form.\n\nLet $y \\equiv \\log_{10} M$ and $s \\equiv \\log_{10} M_{\\star}$. The halo mass function at the high-mass end is given as $n(M)\\,dM = n_{0}\\left(\\frac{M}{M_{0}}\\right)^{-p}\\,dM$. To work with the logarithmic mass $y$, we perform a change of variables. Since $M = 10^y$, we have $dM = M \\ln(10) dy$.\nThe number density in terms of $y$ is $n(y) dy = n(M) dM$.\nThus, $n(y) = n_0 \\left(\\frac{10^y}{M_0}\\right)^{-p} 10^y \\ln(10)$.\nThis can be written as $n(y) = K e^{-\\alpha y}$, where $\\alpha = (p-1)\\ln(10) > 0$ and $K$ is a constant.\n\n### (a) Derivation of the Enhancement Factor $R$\n\nThe zero-scatter number density, $n_{\\rm g}^{(0)}$, is obtained by assuming a sharp mass cut at $M_\\star$, defined by $s_{\\rm th} = \\mu(y_{\\star})$. The selection is $H(y-y_{\\star})$, where $H$ is the Heaviside function.\n$$\nn_{\\rm g}^{(0)} = \\int_{y_{\\star}}^{\\infty} n(y) dy = \\int_{y_{\\star}}^{\\infty} K e^{-\\alpha y} dy = \\frac{K}{\\alpha} e^{-\\alpha y_{\\star}}\n$$\n\nThe true number density, $n_{\\rm g}(s_{\\rm th})$, accounts for lognormal scatter $\\sigma$. The probability of selection is $\\langle N_{\\rm cen}(M) \\rangle = P(s \\ge s_{\\rm th} | y)$. Since $s \\sim N(\\mu(y), \\sigma^2)$, this probability is:\n$$\n\\langle N_{\\rm cen}(M) \\rangle = \\frac{1}{2}\\mathrm{erfc}\\left(\\frac{s_{\\rm th}-\\mu(y)}{\\sqrt{2}\\sigma}\\right) = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\mu(y)-s_{\\rm th}}{\\sqrt{2}\\sigma}\\right)\\right]\n$$\nUsing $\\mu(y) - s_{\\rm th} = \\beta(y - y_\\star)$, we have the true occupation probability.\nThe true number density is the convolution of the mass function with this probability. The integral can be solved by switching the order of integration:\n$$\nn_{\\rm g}(s_{\\rm th}) = \\int_{-\\infty}^{\\infty} n(y) \\left( \\int_{s_{\\rm th}}^{\\infty} P(s'|y) ds' \\right) dy = \\int_{s_{\\rm th}}^{\\infty} \\left( \\int_{-\\infty}^{\\infty} n(y) P(s'|y) dy \\right) ds'\n$$\nThe inner integral is the convolution of an exponential $n(y)$ and a Gaussian $P(s'|y)$, which results in an exponential function of $s'$. Integrating this from $s_{\\rm th}$ to $\\infty$ yields:\n$$\nn_{\\rm g}(s_{\\rm th}) = \\frac{K}{\\alpha} e^{-\\alpha y_{\\star}} \\exp\\left(\\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right)\n$$\nComparing this with $n_{\\rm g}^{(0)}$, the enhancement factor $R$ is:\n$$\nR \\equiv \\frac{n_{\\rm g}(s_{\\rm th})}{n_{\\rm g}^{(0)}} = \\exp\\left(\\frac{\\alpha^2 \\sigma^2}{2\\beta^2}\\right) = \\exp\\left(\\frac{((p-1)\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n\n### (b) Bias in $M_{\\rm min}$\n\nAn analyst ignoring scatter would infer a naive mass threshold, $M_{\\rm min}^{\\rm naive}$, by matching the zero-scatter abundance formula to the true abundance:\n$$\n\\int_{M_{\\rm min}^{\\rm naive}}^{\\infty} n(M) dM = n_{\\rm g}(s_{\\rm th})\n$$\nThe left side is $\\frac{K}{\\alpha}e^{-\\alpha y_{\\rm min}^{\\rm naive}}$, where $y_{\\rm min}^{\\rm naive} = \\log_{10} M_{\\rm min}^{\\rm naive}$. Setting this equal to $n_{\\rm g}(s_{\\rm th}) = n_{\\rm g}^{(0)} R = \\frac{K}{\\alpha}e^{-\\alpha y_{\\star}} R$:\n$$\ne^{-\\alpha y_{\\rm min}^{\\rm naive}} = e^{-\\alpha y_{\\star}} R \\implies y_{\\rm min}^{\\rm naive} = y_{\\star} - \\frac{\\ln R}{\\alpha}\n$$\nTo find the true $M_{\\rm min}$, we match the true occupation probability with the parametric HOD form:\n$$\n\\langle N_{\\rm cen}(M)\\rangle = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\log_{10} M - \\log_{10} M_{\\rm min}}{\\sigma_{\\log M}}\\right)\\right] = \\frac{1}{2}\\left[1 + \\mathrm{erf}\\left(\\frac{\\beta(y-y_{\\star})}{\\sqrt{2}\\sigma}\\right)\\right]\n$$\nBy comparing arguments, we identify the true HOD parameters. From the constant term in the numerator, $y_{\\rm min}^{\\rm true} = y_{\\star}$, so $M_{\\rm min}^{\\rm true} = 10^{y_{\\star}} = M_{\\star}$.\nThe naive mass is $M_{\\rm min}^{\\rm naive} = 10^{y_{\\rm min}^{\\rm naive}} = 10^{y_{\\star} - \\frac{\\ln R}{\\alpha}}$. Recalling $\\alpha = (p-1)\\ln 10$:\n$$\nM_{\\rm min}^{\\rm naive} = M_{\\star} \\cdot 10^{-\\frac{\\ln R}{(p-1)\\ln 10}} = M_{\\star} \\cdot (e^{\\ln 10})^{-\\frac{\\ln R}{(p-1)\\ln 10}} = M_{\\star} \\cdot e^{-\\frac{\\ln R}{p-1}} = M_{\\star} R^{-1/(p-1)}\n$$\nThe bias factor for $M_{\\rm min}$ is:\n$$\n\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}} = \\frac{M_{\\star} R^{-1/(p-1)}}{M_{\\star}} = R^{-1/(p-1)} = \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)\n$$\n\n### (c) Bias in $\\sigma_{\\log M}$\n\nFrom comparing the error function arguments in part (b), we match the coefficients of $y = \\log_{10} M$ to find the true HOD width parameter $\\sigma_{\\log M}^{\\rm true}$:\n$$\n\\frac{1}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\beta}{\\sqrt{2}\\sigma} \\implies \\sigma_{\\log M}^{\\rm true} = \\frac{\\sqrt{2}\\sigma}{\\beta}\n$$\nThis is the correct mapping from the physical scatter $\\sigma$ in the $s-y$ relation to the HOD parameter $\\sigma_{\\log M}$.\n\nThe problem states that a naive analyst mistakenly sets $\\sigma_{\\log M}^{\\rm naive} \\equiv \\sigma$. The bias factor is the ratio of the naive to the true value:\n$$\n\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\sigma}{\\frac{\\sqrt{2}\\sigma}{\\beta}} = \\frac{\\beta}{\\sqrt{2}}\n$$\nThis quantifies the error made by conflating the scatter in stellar mass at fixed halo mass with the width of the occupation function in halo mass.\n\nWe are asked to provide the two bias factors as a two-entry row matrix.\nFirst entry: $\\frac{M_{\\rm min}^{\\rm naive}}{M_{\\rm min}^{\\rm true}} = \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right)$.\nSecond entry: $\\frac{\\sigma_{\\log M}^{\\rm naive}}{\\sigma_{\\log M}^{\\rm true}} = \\frac{\\beta}{\\sqrt{2}}$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\exp\\left(-\\frac{(p-1)(\\ln 10)^2 \\sigma^2}{2\\beta^2}\\right) & \\frac{\\beta}{\\sqrt{2}} \\end{pmatrix}}$$"
        },
        {
            "introduction": "The simplest HOD models assume that halo mass is the sole determinant of galaxy content, but mounting evidence points to the importance of secondary halo properties, a phenomenon known as \"assembly bias\". This practice explores how to build a more sophisticated model where galaxy occupation depends on halo concentration, a proxy for formation time. By analytically deriving the resulting shift in the large-scale galaxy bias to leading order, you will uncover the subtle but significant impact that arises from the correlation between how galaxies occupy halos and how those halos cluster. ",
            "id": "3475137",
            "problem": "Consider a halo occupation distribution (HOD; Halo Occupation Distribution) model for a galaxy sample in a numerical cosmology context in which galaxies are exclusively centrals hosted by dark matter halos. Let the comoving halo mass function be $n_{h}(M)$ and the conditional probability density of halo concentration $c$ at fixed mass $M$ be $f(c\\,|\\,M)$, normalized such that $\\int \\mathrm{d}c\\, f(c\\,|\\,M) = 1$. Assume large-scale halo bias exhibits assembly bias with respect to concentration and is given by\n$$\nb_{h}(M,c) = \\bar{b}_{h}(M)\\left[1 + \\kappa(M)\\,S(c\\,|\\,M)\\right],\n$$\nwhere $\\bar{b}_{h}(M) \\equiv \\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, b_{h}(M,c)$ is the concentration-marginalized halo bias, $\\kappa(M)$ is a small amplitude function, and $S(c\\,|\\,M) \\equiv \\frac{c - \\bar{c}(M)}{\\sigma_{c}(M)}$ is a standardized concentration variable with $\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, S(c\\,|\\,M) = 0$ and $\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, S(c\\,|\\,M)^{2} = 1$. The baseline central galaxy probability (without assembly bias in the HOD) depends only on mass and is $p_{0}(M)$.\n\nIntroduce assembly bias in the HOD through a concentration-dependent central probability\n$$\np_{\\mathrm{cen}}(M,c) = p_{0}(M)\\left[1 + \\alpha(M)\\,S(c\\,|\\,M)\\right],\n$$\nwith $\\alpha(M)$ small and such that $p_{\\mathrm{cen}}(M,c)$ remains within $[0,1]$. Assume there are no satellite galaxies and that all quantities are defined in the linear, large-scale regime where galaxy bias $b_{g}$ is the number-weighted average of halo bias:\n$$\nb_{g} = \\frac{1}{n_{g}}\\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, b_{h}(M,c)\\, \\langle N\\,|\\,M,c\\rangle,\n$$\nwith galaxy number density\n$$\nn_{g} = \\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, \\langle N\\,|\\,M,c\\rangle,\n$$\nand $\\langle N\\,|\\,M,c\\rangle = p_{\\mathrm{cen}}(M,c)$ for a central-only sample. Define the baseline galaxy bias $b_{g,0}$ as the value when $\\alpha(M) = 0$ and $\\kappa(M) = 0$ in the HOD and halo bias, respectively.\n\nStarting from these definitions and the properties of $S(c\\,|\\,M)$, derive, to leading order in the small amplitudes $\\alpha(M)$ and $\\kappa(M)$, a closed-form analytic expression for the shift in large-scale galaxy bias $\\Delta b_{g} \\equiv b_{g} - b_{g,0}$ that arises from the concentration dependence of $p_{\\mathrm{cen}}(M,c)$, under the constraint that the galaxy number density $n_{g}$ remains unchanged relative to the baseline. Express your final answer as a single simplified integral expression over $M$ involving $n_{h}(M)$, $p_{0}(M)$, $\\bar{b}_{h}(M)$, $\\alpha(M)$, and $\\kappa(M)$. No numerical evaluation is required. The final answer must be a single closed-form analytic expression with no units.",
            "solution": "The problem requires the derivation of the shift in large-scale galaxy bias, $\\Delta b_{g} \\equiv b_{g} - b_{g,0}$, under a specific halo occupation distribution (HOD) model that includes assembly bias. The derivation must be performed to leading order in the small amplitude functions $\\alpha(M)$ and $\\kappa(M)$ and under the constraint that the galaxy number density, $n_{g}$, is held constant.\n\nFirst, let us establish the baseline case where there is no assembly bias, which corresponds to setting the amplitudes $\\alpha(M) = 0$ and $\\kappa(M) = 0$.\nIn this baseline scenario, the central galaxy probability is $\\langle N\\,|\\,M,c\\rangle_0 = p_{\\mathrm{cen}}(M,c)|_{\\alpha=0} = p_{0}(M)$.\nThe halo bias is $b_{h}(M,c)_0 = b_{h}(M,c)|_{\\kappa=0} = \\bar{b}_{h}(M)$.\n\nThe baseline galaxy number density, $n_{g,0}$, is given by:\n$$\nn_{g,0} = \\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, \\langle N\\,|\\,M,c\\rangle_0\n$$\nSubstituting $\\langle N\\,|\\,M,c\\rangle_0 = p_{0}(M)$ and noting that $p_{0}(M)$ is independent of concentration $c$:\n$$\nn_{g,0} = \\int \\mathrm{d}M\\, n_{h}(M)\\, p_{0}(M) \\left( \\int \\mathrm{d}c\\, f(c\\,|\\,M) \\right) = \\int \\mathrm{d}M\\, n_{h}(M)\\, p_{0}(M)\n$$\nThe baseline galaxy bias, $b_{g,0}$, is defined as:\n$$\nb_{g,0} = \\frac{1}{n_{g,0}}\\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, b_{h}(M,c)_0\\, \\langle N\\,|\\,M,c\\rangle_0\n$$\nSubstituting the baseline expressions and integrating over $c$ yields:\n$$\nb_{g,0} = \\frac{1}{n_{g,0}}\\int \\mathrm{d}M\\, n_{h}(M)\\, \\bar{b}_{h}(M)\\, p_{0}(M)\n$$\n\nNext, we consider the full model including assembly bias. The central galaxy probability is $\\langle N\\,|\\,M,c\\rangle = p_{0}(M)\\left[1 + \\alpha(M)\\,S(c\\,|\\,M)\\right]$.\nThe full galaxy number density, $n_g$, is:\n$$\nn_{g} = \\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, p_{0}(M)\\left[1 + \\alpha(M)\\,S(c\\,|\\,M)\\right]\n$$\nUsing the property that $\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\,S(c\\,|\\,M) = 0$, the second term vanishes, and we find $n_g = n_{g,0}$, satisfying the problem's constraint.\n\nNow we calculate the full galaxy bias, $b_{g}$, by evaluating its numerator, which we call $I_b$:\n$$\nI_b = \\int \\mathrm{d}M\\, n_{h}(M)\\int \\mathrm{d}c\\, f(c\\,|\\,M)\\, \\left( \\bar{b}_{h}(M)\\left[1 + \\kappa(M)\\,S\\right] \\right) \\left( p_{0}(M)\\left[1 + \\alpha(M)\\,S\\right] \\right)\n$$\nwhere $S \\equiv S(c\\,|\\,M)$. Expanding the product for a fixed mass $M$:\n$$\n\\bar{b}_{h}(M) p_{0}(M) \\left[1 + \\alpha(M)S + \\kappa(M)S + \\alpha(M)\\kappa(M)S^2\\right]\n$$\nWe integrate this expression over $c$, weighted by $f(c\\,|\\,M)$. Using the properties of $S$:\n$\\int f(c|M)S\\, \\mathrm{d}c = 0$ and $\\int f(c|M)S^2\\, \\mathrm{d}c = 1$.\nThe integral over $c$ becomes:\n$$\n\\bar{b}_{h}(M) p_{0}(M) \\left[ 1 + (\\alpha(M)+\\kappa(M)) \\cdot 0 + \\alpha(M)\\kappa(M) \\cdot 1 \\right] = \\bar{b}_{h}(M) p_{0}(M) \\left[1 + \\alpha(M)\\kappa(M)\\right]\n$$\nThe linear terms in $\\alpha$ and $\\kappa$ vanish. The leading-order correction is the second-order term $\\alpha(M)\\kappa(M)$.\n\nSubstituting this result back into the expression for $I_b$:\n$$\nI_b = \\int \\mathrm{d}M\\, n_{h}(M)\\, \\bar{b}_{h}(M)\\, p_{0}(M) \\left[1 + \\alpha(M)\\kappa(M)\\right]\n$$\nThe full galaxy bias is $b_{g} = I_b / n_{g,0}$.\n$$\nb_{g} = \\frac{\\int \\mathrm{d}M\\, n_{h}(M)\\, \\bar{b}_{h}(M)\\, p_{0}(M)}{n_{g,0}} + \\frac{\\int \\mathrm{d}M\\, n_{h}(M)\\, \\bar{b}_{h}(M)\\, p_{0}(M)\\, \\alpha(M)\\kappa(M)}{n_{g,0}}\n$$\nRecognizing the first term as $b_{g,0}$, the shift in galaxy bias, $\\Delta b_{g} = b_{g} - b_{g,0}$, is:\n$$\n\\Delta b_{g} = \\frac{1}{n_{g,0}} \\int \\mathrm{d}M\\, n_{h}(M)\\, p_{0}(M)\\, \\bar{b}_{h}(M)\\, \\alpha(M)\\kappa(M)\n$$\nSubstituting the integral expression for $n_{g,0}$ provides the final closed-form expression. To avoid confusion with the integration variable, we use $M'$ in the denominator.\n$$\n\\Delta b_{g} = \\frac{\\int \\mathrm{d}M\\, n_{h}(M)\\, p_{0}(M)\\, \\bar{b}_{h}(M)\\, \\alpha(M)\\, \\kappa(M)}{\\int \\mathrm{d}M'\\, n_{h}(M')\\, p_{0}(M')}\n$$\nThis expression represents the galaxy-number-weighted average of the product $\\bar{b}_{h}(M) \\alpha(M) \\kappa(M)$, and is the leading-order shift in galaxy bias due to the correlation between HOD assembly bias and halo clustering assembly bias.",
            "answer": "$$\n\\boxed{\\frac{\\int \\mathrm{d}M\\, n_{h}(M)\\, p_{0}(M)\\, \\bar{b}_{h}(M)\\, \\alpha(M)\\, \\kappa(M)}{\\int \\mathrm{d}M'\\, n_{h}(M')\\, p_{0}(M')}}\n$$"
        },
        {
            "introduction": "Once an HOD is specified, its primary purpose is to predict observable statistics of the galaxy distribution, such as the two-point correlation function. This hands-on numerical problem focuses on computing the \"one-halo\" term, which describes the clustering of galaxy pairs within the same dark matter halo. You will implement the integral for the satellite-satellite contribution and explore how moving beyond simple Poisson statistics for the satellite number distribution to a more general Negative Binomial model impacts the predicted clustering amplitude. ",
            "id": "3475225",
            "problem": "Consider the Halo Occupation Distribution (HOD) framework in numerical cosmology, where the satellite-satellite part of the one-halo contribution to the galaxy pair density is determined by the second factorial moment of the satellite occupation at fixed halo mass and the halo mass function. Starting from first principles, use the following base facts and definitions to construct and evaluate the required integrals:\n\n1. The satellite-satellite one-halo pair density amplitude is defined by the integral\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}} \\equiv \\int_{M_{\\min}}^{M_{\\max}} \\mathrm{d}M \\, n(M) \\, \\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle,$$\nwhere $n(M)$ is the differential halo mass function, and $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ is the second factorial moment of the satellite occupation conditioned on halo mass $M$.\n\n2. By definition of mean and variance for a nonnegative integer-valued random variable $N$, one has\n$$\\left\\langle N(N-1) \\right\\rangle = \\left\\langle N^2 \\right\\rangle - \\left\\langle N \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle.$$\nUse this identity together with the well-tested variance properties of the Poisson distribution and the Negative Binomial (NB) distribution to derive $\\left\\langle N_{\\mathrm{sat}}\\left(N_{\\mathrm{sat}}-1\\right) \\mid M \\right\\rangle$ for both cases:\n- For the Poisson distribution, the variance equals the mean.\n- For the Negative Binomial distribution parameterized by a positive dispersion parameter $k$, the variance equals the mean plus the squared mean divided by $k$.\n\n3. Adopt the following physically plausible, smooth parameterizations:\n- Halo mass function\n$$n(M) = n_0 \\left(\\frac{M}{M_0}\\right)^{-\\beta} \\exp\\left(-\\frac{M}{M_{\\mathrm{cut}}}\\right),$$\nwith $M$ in $\\mathrm{M}_\\odot/h$ and $n(M)$ in $h^3 \\mathrm{Mpc}^{-3} \\, (\\mathrm{M}_\\odot/h)^{-1}$.\n- Probability of hosting a central galaxy\n$$P_{\\mathrm{cen}}(M) = \\frac{1}{2} \\left[1 + \\mathrm{erf}\\left(\\frac{\\ln M - \\ln M_{\\min}^{\\mathrm{cen}}}{\\sigma_{\\ln M}}\\right)\\right],$$\nwith $P_{\\mathrm{cen}}(M) \\in [0,1]$.\n- Mean satellite occupation conditioned on $M$\n$$\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle = P_{\\mathrm{cen}}(M) \\left(\\frac{\\max\\{M - M_0^{\\mathrm{sat}}, \\, 0\\}}{M_1}\\right)^{\\alpha},$$\nwhere the power-law applies only when $M > M_0^{\\mathrm{sat}}$ and is suppressed otherwise.\n\n4. Define the dimensionless impact of super-Poisson satellite variance on the one-halo satellite-satellite term as the ratio of amplitudes from the Negative Binomial case to the Poisson case:\n$$\\mathcal{R} \\equiv \\frac{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})}{A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})},$$\nwhich is unitless.\n\nYour task is to write a complete program that:\n- For each test case, constructs $n(M)$ and $\\mu_{\\mathrm{sat}}(M)$ using the parameters provided.\n- Computes $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$ for the Poisson case and for the Negative Binomial case using the variance identity in item $2$.\n- Numerically evaluates the integrals for $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ and $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$ over the specified mass range $\\left[M_{\\min}, M_{\\max}\\right]$.\n- Returns the dimensionless ratio $\\mathcal{R}$ for each test case.\n\nUse radians for any implicit angle arguments in special functions (the error function has no angle argument, so no angles are present here). Since the final reported quantity is a ratio, there is no physical unit to express in the output. Ensure the numerical integration is robust over many decades in mass.\n\nTest Suite (each case specifies $\\{n_0, M_0, \\beta, M_{\\mathrm{cut}}, M_{\\min}^{\\mathrm{cen}}, \\sigma_{\\ln M}, M_0^{\\mathrm{sat}}, M_1, \\alpha, k, M_{\\min}, M_{\\max}\\}$):\n- Case $1$ (general, moderate super-Poisson): $\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 5.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$.\n- Case $2$ (near-Poisson limit): $\\{\\, n_0 = 2.0\\times 10^{-18}, \\, M_0 = 1.0\\times 10^{13}, \\, \\beta = 1.8, \\, M_{\\mathrm{cut}} = 6.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 6.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.5, \\, M_0^{\\mathrm{sat}} = 1.0\\times 10^{12}, \\, M_1 = 1.2\\times 10^{13}, \\, \\alpha = 1.1, \\, k = 1.0\\times 10^{9}, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 1.0\\times 10^{15} \\, \\}$.\n- Case $3$ (rare satellites, steeper mass function): $\\{\\, n_0 = 2.5\\times 10^{-18}, \\, M_0 = 8.0\\times 10^{12}, \\, \\beta = 2.2, \\, M_{\\mathrm{cut}} = 3.0\\times 10^{14}, \\, M_{\\min}^{\\mathrm{cen}} = 1.0\\times 10^{12}, \\, \\sigma_{\\ln M} = 0.7, \\, M_0^{\\mathrm{sat}} = 2.0\\times 10^{12}, \\, M_1 = 5.0\\times 10^{13}, \\, \\alpha = 0.8, \\, k = 2.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 8.0\\times 10^{14} \\, \\}$.\n- Case $4$ (high-mass dominated, strong super-Poisson): $\\{\\, n_0 = 1.5\\times 10^{-18}, \\, M_0 = 2.0\\times 10^{13}, \\, \\beta = 1.5, \\, M_{\\mathrm{cut}} = 1.0\\times 10^{15}, \\, M_{\\min}^{\\mathrm{cen}} = 8.0\\times 10^{11}, \\, \\sigma_{\\ln M} = 0.4, \\, M_0^{\\mathrm{sat}} = 1.5\\times 10^{12}, \\, M_1 = 8.0\\times 10^{12}, \\, \\alpha = 1.3, \\, k = 1.0, \\, M_{\\min} = 1.0\\times 10^{11}, \\, M_{\\max} = 2.0\\times 10^{15} \\, \\}$.\n\nAlgorithmic requirements:\n- Perform the mass integral by a stable change of variables, for example $x \\equiv \\ln M$, so that $\\mathrm{d}M = M \\, \\mathrm{d}x$, and integrate over $x \\in [\\ln M_{\\min}, \\ln M_{\\max}]$.\n- Use the identity in item $2$ to compute $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$ for each distribution, given $\\mu_{\\mathrm{sat}}(M)$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the dimensionless ratios $\\mathcal{R}$ for the four cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4\\right]$, where each $\\text{r}_i$ is a float.",
            "solution": "The solution requires calculating the ratio $\\mathcal{R} = A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) / A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$. The first step is to derive the integrand's core component, the second factorial moment of the satellite occupation, $\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle$, for both distributions.\n\nUsing the provided identity $\\left\\langle N(N-1) \\right\\rangle = \\mathrm{Var}(N) + \\left\\langle N \\right\\rangle^2 - \\left\\langle N \\right\\rangle$, and letting $\\mu_{\\mathrm{sat}}(M) \\equiv \\left\\langle N_{\\mathrm{sat}} \\mid M \\right\\rangle$:\n\n1.  **Poisson Distribution**: With $\\mathrm{Var}(N_{\\mathrm{sat}}) = \\mu_{\\mathrm{sat}}(M)$, the moment is:\n    $$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{Poisson}} = \\mu_{\\mathrm{sat}}(M) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M) = \\mu_{\\mathrm{sat}}(M)^2$$\n\n2.  **Negative Binomial (NB) Distribution**: With $\\mathrm{Var}(N_{\\mathrm{sat}}) = \\mu_{\\mathrm{sat}}(M) + \\mu_{\\mathrm{sat}}(M)^2/k$, the moment is:\n    $$\\left\\langle N_{\\mathrm{sat}}(N_{\\mathrm{sat}}-1) \\mid M \\right\\rangle_{\\mathrm{NB}} = \\left(\\mu_{\\mathrm{sat}}(M) + \\frac{\\mu_{\\mathrm{sat}}(M)^2}{k}\\right) + \\mu_{\\mathrm{sat}}(M)^2 - \\mu_{\\mathrm{sat}}(M) = \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right)$$\n\nThe amplitude integrals are thus:\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson}) = \\int_{M_{\\min}}^{M_{\\max}} n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 \\, \\mathrm{d}M$$\n$$A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB}) = \\int_{M_{\\min}}^{M_{\\max}} n(M) \\, \\mu_{\\mathrm{sat}}(M)^2 \\left(1 + \\frac{1}{k}\\right) \\, \\mathrm{d}M$$\n\nSince $k$ is a constant for each case, it can be factored out of the integral, leading to the analytical simplification $\\mathcal{R} = 1 + 1/k$. The provided problem, however, requires a full numerical evaluation to test the implementation of the entire HOD model.\n\nThe numerical implementation involves:\n1.  Defining functions for the halo mass function $n(M)$, central occupation $P_{\\mathrm{cen}}(M)$, and mean satellite number $\\mu_{\\mathrm{sat}}(M)$.\n2.  Creating integrand functions for both the Poisson and NB cases. For numerical stability over the wide mass range, the integration variable is changed to $x = \\ln M$, so $\\mathrm{d}M = M\\,\\mathrm{d}x$.\n3.  Using a robust numerical quadrature routine (`scipy.integrate.quad`) to compute the definite integrals for $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{Poisson})$ and $A_{1\\mathrm{h}}^{\\mathrm{SS}}(\\mathrm{NB})$.\n4.  Calculating the ratio $\\mathcal{R}$ from the numerical results for each test case. The Python code in the answer block executes these steps.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the HOD problem for the given test suite.\n    \n    This function calculates the dimensionless ratio R for four different sets of\n    cosmological and HOD parameters. It does so by numerically integrating\n    the required expressions for the satellite-satellite one-halo term amplitude\n    for both Poisson and Negative Binomial satellite distributions and then\n    taking their ratio.\n    \"\"\"\n    \n    # Test Suite Data:\n    # {n0, M0, beta, M_cut, M_min_cen, sigma_lnM, M0_sat, M1, alpha, k, M_min, M_max}\n    test_cases = [\n        # Case 1 (general, moderate super-Poisson)\n        (2.0e-18, 1.0e13, 1.8, 6.0e14, 6.0e11, 0.5, 1.0e12, 1.2e13, 1.1, 5.0, 1.0e11, 1.0e15),\n        # Case 2 (near-Poisson limit)\n        (2.0e-18, 1.0e13, 1.8, 6.0e14, 6.0e11, 0.5, 1.0e12, 1.2e13, 1.1, 1.0e9, 1.0e11, 1.0e15),\n        # Case 3 (rare satellites, steeper mass function)\n        (2.5e-18, 8.0e12, 2.2, 3.0e14, 1.0e12, 0.7, 2.0e12, 5.0e13, 0.8, 2.0, 1.0e11, 8.0e14),\n        # Case 4 (high-mass dominated, strong super-Poisson)\n        (1.5e-18, 2.0e13, 1.5, 1.0e15, 8.0e11, 0.4, 1.5e12, 8.0e12, 1.3, 1.0, 1.0e11, 2.0e15),\n    ]\n\n    results = []\n    \n    # HOD Model Functions\n    def n_M(M, n0, M0, beta, M_cut):\n        \"\"\"Halo mass function n(M).\"\"\"\n        return n0 * (M / M0)**(-beta) * np.exp(-M / M_cut)\n\n    def P_cen(M, M_min_cen, sigma_lnM):\n        \"\"\"Probability of hosting a central galaxy.\"\"\"\n        # Use np.log for natural logarithm as specified by \"ln\"\n        arg = (np.log(M) - np.log(M_min_cen)) / sigma_lnM\n        return 0.5 * (1.0 + special.erf(arg))\n\n    def mu_sat(M, M_min_cen, sigma_lnM, M0_sat, M1, alpha):\n        \"\"\"Mean satellite occupation <N_sat|M>.\"\"\"\n        p_cen_val = P_cen(M, M_min_cen, sigma_lnM)\n        mass_term = np.maximum(M - M0_sat, 0)\n        return p_cen_val * (mass_term / M1)**alpha\n\n    # Integrands (in log-space for numerical stability)\n    def an_integrand(ln_M, params, distribution_type):\n        \"\"\"\n        Generic integrand for the A_1h^SS calculation.\n        The change of variables dM = M d(lnM) is included.\n        \"\"\"\n        n0, M0, beta, M_cut, M_min_cen, sigma_lnM, M0_sat, M1, alpha, k, _, _ = params\n        M = np.exp(ln_M)\n\n        # Calculate HOD quantities\n        n_val = n_M(M, n0, M0, beta, M_cut)\n        mu_val = mu_sat(M, M_min_cen, sigma_lnM, M0_sat, M1, alpha)\n\n        # Second factorial moment\n        moment2_fact_poisson = mu_val**2\n        if distribution_type == 'poisson':\n            moment2_fact = moment2_fact_poisson\n        elif distribution_type == 'nb':\n            moment2_fact = moment2_fact_poisson * (1.0 + 1.0 / k)\n        else:\n            raise ValueError(\"Unknown distribution type\")\n\n        return M * n_val * moment2_fact\n\n    for case in test_cases:\n        _, _, _, _, _, _, _, _, _, _, M_min, M_max = case\n        \n        ln_M_min = np.log(M_min)\n        ln_M_max = np.log(M_max)\n\n        # Numerically evaluate the integral for the Poisson case\n        A_poisson, _ = integrate.quad(\n            an_integrand,\n            ln_M_min,\n            ln_M_max,\n            args=(case, 'poisson')\n        )\n        \n        # Numerically evaluate the integral for the Negative Binomial case\n        A_nb, _ = integrate.quad(\n            an_integrand,\n            ln_M_min,\n            ln_M_max,\n            args=(case, 'nb')\n        )\n        \n        # Calculate the ratio, R\n        # Handle the case where A_poisson might be zero to avoid division errors,\n        # though it's physically not expected for the given parameters.\n        if A_poisson == 0:\n            # The analytical result 1 + 1/k is well-defined as long as k is not 0.\n            # If A_poisson is 0, A_nb is also 0, so the ratio is indeterminate.\n            # We'll rely on the analytical form in this unlikely edge case.\n            k = case[9]\n            ratio = 1.0 + 1.0/k\n        else:\n            ratio = A_nb / A_poisson\n            \n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}