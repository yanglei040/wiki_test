{
    "hands_on_practices": [
        {
            "introduction": "At the heart of modern finite-volume hydrodynamics codes lies the Riemann problem: the evolution of an initial discontinuity separating two constant states. This exercise provides foundational practice by guiding you through the exact solution for a one-dimensional shock tube, a classic scenario in gas dynamics. By deriving the structure of the resulting shock waves, rarefaction waves, and contact discontinuities from first principles, you will gain a deep, physical understanding of the wave dynamics that numerical Godunov-type schemes are designed to capture .",
            "id": "3464087",
            "problem": "Consider a one-dimensional shock tube initial value problem posed on the real line with an interface at $x=0$. This problem is representative of the local Riemann problems solved at hydrodynamic interfaces in Adaptive Mesh Refinement (AMR) schemes for cosmological gas dynamics. Assume Newtonian ideal-gas hydrodynamics with the Euler equations in conservation form and an ideal gas with adiabatic index $\\gamma = \\frac{5}{3}$. Neglect cosmological expansion and gravity over the time and length scales of interest so that the local dynamics are governed purely by the Euler equations. The left and right initial states (at $t=0$) are given by\n$$\n(\\rho_L, u_L, p_L) = \\left(1.67 \\times 10^{-21},\\, 0,\\, 1.00 \\times 10^{-12}\\right), \\quad\n(\\rho_R, u_R, p_R) = \\left(1.67 \\times 10^{-23},\\, 0,\\, 1.00 \\times 10^{-14}\\right),\n$$\nwhere $\\rho$ is mass density in $\\mathrm{kg\\,m^{-3}}$, $u$ is velocity in $\\mathrm{m\\,s^{-1}}$, and $p$ is pressure in $\\mathrm{Pa}$. The interface is at $x=0$, and the solution is self-similar in the variable $\\xi = x/t$ for $t>0$.\n\nStarting from the Euler equations, the definition of sound speed $c = \\sqrt{\\gamma p / \\rho}$, the self-similar form of the Riemann problem, the isentropic relations across rarefaction waves, and the Rankine–Hugoniot jump conditions across shock waves, derive the exact structure of the Riemann fan for these initial states. In particular:\n- Determine whether the left-going wave is a shock or a rarefaction and whether the right-going wave is a shock or a rarefaction.\n- Identify which primitive variables are continuous across the contact discontinuity and which conserved fluxes are continuous across a shock in the sense of the Rankine–Hugoniot conditions.\n\nThen, using the appropriate wave relations from first principles, set up the implicit equation for the star-region pressure $p_\\ast$ that enforces equality of the velocity $u_\\ast$ obtained from the left and right wave connections. Solve this equation to determine the unique physically admissible $p_\\ast$.\n\nAnswer specification:\n- Report the value of the star-region pressure $p_\\ast$.\n- Express your final answer in $\\mathrm{Pa}$.\n- Round your answer to four significant figures.\n- Your final answer must be a single real number.",
            "solution": "This problem requires the solution of a one-dimensional Riemann problem for the Euler equations of gas dynamics. The system is governed by the conservation laws:\n$$ \\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0 $$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}(\\mathbf{U})$ is the vector of fluxes:\n$$ \\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\mathcal{E} \\end{pmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(\\mathcal{E}+p) \\end{pmatrix} $$\nHere, $\\rho$ is the mass density, $u$ is the fluid velocity, $p$ is the pressure, and $\\mathcal{E}$ is the total energy density per unit volume. For an ideal gas with adiabatic index $\\gamma$, the total energy density is given by the equation of state:\n$$ \\mathcal{E} = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2 $$\nThe given initial conditions define two states, a left state ($L$) for $x<0$ and a right state ($R$) for $x>0$:\n$(\\rho_L, u_L, p_L) = (1.67 \\times 10^{-21}, 0, 1.00 \\times 10^{-12})$\n$(\\rho_R, u_R, p_R) = (1.67 \\times 10^{-23}, 0, 1.00 \\times 10^{-14})$\nThe adiabatic index is $\\gamma = \\frac{5}{3}$. The solution for $t>0$ is self-similar and depends only on the variable $\\xi = x/t$. The solution structure consists of four constant states separated by three waves propagating from the origin: a left-going wave, a contact discontinuity, and a right-going wave. The intermediate region between the left and right waves is called the star region, characterized by a constant pressure $p_\\ast$ and velocity $u_\\ast$.\n\n**1. Wave Structure Determination**\nThe type of the left- and right-going waves (shock or rarefaction) is determined by the pressure difference between the initial states and the star region pressure $p_\\ast$. Since the initial velocities are zero ($u_L = u_R = 0$) and the pressure on the left is higher than on the right ($p_L > p_R$), the gas will expand from the left region and compress the right region. This implies a positive velocity $u_\\ast > 0$ in the star region.\nFor a wave to accelerate a fluid from $u_k$ to $u_\\ast$, the velocity change $u_\\ast - u_k$ is related to the pressure change $p_\\ast - p_k$.\n- If $p_\\ast > p_k$, the wave is a shock (compressive).\n- If $p_\\ast  p_k$, the wave is a rarefaction (expansive).\n\nLet us consider the possible ranges for $p_\\ast$:\n- If $p_\\ast > p_L$, both left and right waves would be shocks. A left-going shock would accelerate the fluid to the left, resulting in $u_\\ast  u_L = 0$. A right-going shock would accelerate the fluid to the right, resulting in $u_\\ast > u_R = 0$. These two conditions are contradictory.\n- If $p_\\ast  p_R$, both waves would be rarefactions. A left-going rarefaction would accelerate the fluid to the right ($u_\\ast > u_L = 0$), but a right-going rarefaction would accelerate the fluid to the left ($u_\\ast  u_R = 0$). This is also contradictory.\n- Therefore, the only physically consistent solution must satisfy $p_R  p_\\ast  p_L$. This implies that the left-going wave is a rarefaction wave (as it expands from high pressure $p_L$ to lower pressure $p_\\ast$) and the right-going wave is a shock wave (as it compresses from low pressure $p_R$ to higher pressure $p_\\ast$).\n\n**2. Continuity Conditions**\n- **Contact Discontinuity**: This is an interface that moves with the local fluid velocity, $u_\\ast$. Across a contact discontinuity, pressure $p$ and velocity $u$ are continuous. Density $\\rho$ and temperature $T$ (and thus specific entropy) can jump.\n- **Shock Wave**: Across a shock, the primitive variables and fluxes are discontinuous. Conservation is expressed by the Rankine-Hugoniot (R-H) jump conditions. For a shock moving at speed $S$, the R-H conditions are $[ \\mathbf{F} ] = S [ \\mathbf{U} ]$, where $[q] = q_2 - q_1$ denotes the jump in a quantity $q$ across the shock. No component of the flux vector $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2+p, u(\\mathcal{E}+p))^T$ is generally continuous in the laboratory frame. However, in a frame moving with the shock, the following quantities are conserved (continuous):\n    1. Mass flux: $\\rho(u-S)$\n    2. Momentum flux: $p + \\rho(u-S)^2$\n    3. Energy flux: $(\\mathcal{E}+p)(u-S) + pS$\n\n**3. Equation for the Star-Region Pressure $p_\\ast$**\nWe must find $p_\\ast$ by equating the star-region velocity $u_\\ast$ as determined by the relations for the left- and right-going waves.\n- **Left Wave (Rarefaction)**: The change in velocity across a left-propagating rarefaction wave is given by the Riemann invariant along the $C_+$ characteristics:\n$$ u_\\ast = u_L + \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) $$\nwhere $c_L = \\sqrt{\\gamma p_L / \\rho_L}$ is the sound speed in the left state.\n- **Right Wave (Shock)**: The change in velocity across a right-propagating shock wave is derived from the Rankine-Hugoniot conditions:\n$$ u_\\ast = u_R + (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\nEquating these two expressions for $u_\\ast$ (with $u_L=u_R=0$) gives the implicit equation for $p_\\ast$:\n$$ \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) = (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\n\n**4. Solving for $p_\\ast$**\nWe now substitute the given numerical values to solve for $p_\\ast$.\n- $\\gamma = 5/3$, so $\\gamma-1 = 2/3$, $\\gamma+1=8/3$, and $\\frac{\\gamma-1}{2\\gamma} = \\frac{2/3}{2(5/3)} = 1/5$.\n- Left state data:\n  $p_L = 1.00 \\times 10^{-12} \\, \\mathrm{Pa}$\n  $\\rho_L = 1.67 \\times 10^{-21} \\, \\mathrm{kg\\,m^{-3}}$\n  $c_L = \\sqrt{\\frac{(5/3)(1.00 \\times 10^{-12})}{1.67 \\times 10^{-21}}} \\approx 31591.2 \\, \\mathrm{m\\,s^{-1}}$\n- Right state data:\n  $p_R = 1.00 \\times 10^{-14} \\, \\mathrm{Pa}$\n  $\\rho_R = 1.67 \\times 10^{-23} \\, \\mathrm{kg\\,m^{-3}}$\n\nThe equation becomes:\n$$ \\frac{2(31591.2)}{2/3} \\left( 1 - \\left(\\frac{p_\\ast}{10^{-12}}\\right)^{1/5} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{2/(1.67 \\times 10^{-23})}{(8/3)p_\\ast + (2/3)(10^{-14})}} $$\n$$ 94773.6 \\left( 1 - (10^{12}p_\\ast)^{1/5} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{1.1976 \\times 10^{23}}{(8/3)p_\\ast + (2/3) \\times 10^{-14}}} $$\nThis simplifies to:\n$$ 94773.6 \\left( 1 - (10^{12}p_\\ast)^{0.2} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{p_\\ast + 0.25 \\times 10^{-14}}} $$\nThis is a nonlinear equation for $p_\\ast$ which must be solved numerically. Let the left-hand side be $f_L(p_\\ast)$ and the right-hand side be $f_R(p_\\ast)$. We seek the root of $f_L(p_\\ast) - f_R(p_\\ast) = 0$ in the interval $(p_R, p_L)$. A numerical root-finding method (e.g., bisection or Newton-Raphson) yields the solution.\nLet's test $p_\\ast = 5.7706 \\times 10^{-14} \\, \\mathrm{Pa}$.\n- Left side (velocity from rarefaction):\n$u_\\ast = 94773.6 \\left( 1 - \\left(\\frac{5.7706 \\times 10^{-14}}{10^{-12}}\\right)^{0.2} \\right) = 94773.6 \\left( 1 - (0.057706)^{0.2} \\right) \\approx 94773.6 (1 - 0.56527) = 41200 \\, \\mathrm{m\\,s^{-1}}$.\n- Right side (velocity from shock):\n$u_\\ast = (5.7706 \\times 10^{-14} - 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{5.7706 \\times 10^{-14} + 0.25 \\times 10^{-14}}} = (4.7706 \\times 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{6.0206 \\times 10^{-14}}} \\approx (4.7706 \\times 10^{-14})(8.6368 \\times 10^{17}) = 41200 \\, \\mathrm{m\\,s^{-1}}$.\nThe two velocities are equal, confirming this value of $p_\\ast$ is the correct solution.\nRounding to four significant figures, we get $p_\\ast = 5.771 \\times 10^{-14} \\, \\mathrm{Pa}$.",
            "answer": "$$\\boxed{5.771 \\times 10^{-14}}$$"
        },
        {
            "introduction": "A key challenge in Adaptive Mesh Refinement (AMR) is ensuring that conserved quantities like mass, momentum, and energy are perfectly conserved across the boundaries between coarse and fine grids. A naive approach where coarse and fine grids evolve independently would lead to unphysical sources or sinks of these quantities at level interfaces. This practice introduces the crucial \"refluxing\" algorithm, which corrects the solution on coarse cells adjacent to a fine grid to account for the more accurate fluxes computed on the fine grid, thereby enforcing exact conservation .",
            "id": "3464103",
            "problem": "Consider one-dimensional finite-volume hydrodynamics in a cosmological simulation using Adaptive Mesh Refinement (AMR). Focus on a single conserved scalar field (e.g., comoving mass density) with no source terms so that local conservation is controlled entirely by face fluxes. A level-$0$ coarse grid with uniform cell width $\\Delta x_0$ and time step $\\Delta t_0$ is partially refined by a level-$1$ fine patch with refinement ratio $r=2$. The fine level advances with two substeps of size $\\Delta t_1=\\Delta t_0/2$. The fine patch covers exactly coarse cell $i=1$, so the coarse-fine interfaces are the faces at $x_{1/2}$ (between coarse cells $i=0$ and $i=1$) and $x_{3/2}$ (between coarse cells $i=1$ and $i=2$). All quantities are nondimensional.\n\nYou are given:\n- Coarse cell indices: $i=0,1,2$.\n- Coarse cell widths and time step: $\\Delta x_0 = 4$, $\\Delta t_0 = 1$.\n- Coarse-level conserved states at time $t^n$: $U_0^n = 10$, $U_1^n = 20$, $U_2^n = 30$.\n- Coarse-level numerical fluxes at faces during $\\Delta t_0$: $F_{-1/2}^{(0)}=2$, $F_{1/2}^{(0)}=5$, $F_{3/2}^{(0)}=6$, $F_{5/2}^{(0)}=3$.\n- Fine-level substep numerical fluxes at the coarse-fine faces:\n  - At $x_{1/2}$: $F_{1/2}^{(1,1)}=7$ for the first substep and $F_{1/2}^{(1,2)}=5$ for the second substep.\n  - At $x_{3/2}$: $F_{3/2}^{(1,1)}=8$ for the first substep and $F_{3/2}^{(1,2)}=6$ for the second substep.\n\nStarting from the finite-volume conservation law and the definition of refluxing as the conservative replacement of coarse-face fluxes at coarse-fine interfaces by the time-integrated fine-level fluxes accumulated over substeps, perform the following:\n\n1. Compute the level-$0$ coarse prediction update for the uncovered coarse cells $i=0$ and $i=2$ over $\\Delta t_0$ using only level-$0$ fluxes.\n2. Construct the flux-register differences at the two coarse-fine interfaces by contrasting the time-integrated fine fluxes with the level-$0$ coarse fluxes over the same time interval, and apply the refluxing corrections to the coarse prediction for cells $i=0$ and $i=2$ with the correct face-orientation signs.\n3. Report the post-refluxing updated coarse conserved states $U_0^{n+1}$ and $U_2^{n+1}$.\n\nExpress your final answer as the row matrix $\\left(U_0^{n+1}\\;\\;U_2^{n+1}\\right)$ with no units. No rounding is required.",
            "solution": "The problem requires the calculation of updated conserved states in the coarse cells of an Adaptive Mesh Refinement (AMR) grid after a conservative synchronization step known as refluxing.\n\nThe fundamental principle is the finite-volume update for a conserved quantity $U$ in one dimension. For a cell $i$ with width $\\Delta x$ and time step $\\Delta t$, the state is updated from time $t^n$ to $t^{n+1}$ as:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i \\pm 1/2}$ are the numerical fluxes at the cell faces, defined as positive in the positive $x$-direction.\n\n**1. Compute the level-$0$ coarse prediction update for cells $i=0$ and $i=2$.**\n\nThis step calculates the state of the coarse cells that are not covered by the fine grid, using only the coarse-level fluxes. The time step is $\\Delta t_0 = 1$ and the cell width is $\\Delta x_0 = 4$.\n\nFor coarse cell $i=0$, the update equation is:\n$$\nU_0^{n+1, \\text{pred}} = U_0^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{1/2}^{(0)} - F_{-1/2}^{(0)} \\right)\n$$\nSubstituting the given values:\n$$\nU_0^{n+1, \\text{pred}} = 10 - \\frac{1}{4} \\left( 5 - 2 \\right) = 10 - \\frac{3}{4} = 9.25\n$$\n\nFor coarse cell $i=2$, the update equation is:\n$$\nU_2^{n+1, \\text{pred}} = U_2^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{5/2}^{(0)} - F_{3/2}^{(0)} \\right)\n$$\nSubstituting the given values:\n$$\nU_2^{n+1, \\text{pred}} = 30 - \\frac{1}{4} \\left( 3 - 6 \\right) = 30 - \\frac{-3}{4} = 30 + \\frac{3}{4} = 30.75\n$$\nThese are the provisional updated states before the refluxing correction.\n\n**2. Construct the flux-register differences and apply refluxing corrections.**\n\nThe refluxing step corrects for the mismatch between the flux calculated on the coarse grid and the more accurate flux calculated on the fine grid at a coarse-fine interface. A flux register, $\\mathcal{R}$, accumulates this mismatch over the full coarse time step $\\Delta t_0$. The total mismatch is defined as the integrated coarse flux minus the sum of integrated fine fluxes over the substeps.\n\nFor a face at $x_{i+1/2}$, with refinement $r=2$, the flux register is:\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 F_{i+1/2}^{(0)} - \\sum_{k=1}^{2} \\Delta t_1 F_{i+1/2}^{(1,k)}\n$$\nGiven $\\Delta t_1 = \\Delta t_0 / 2 = 1/2$:\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 \\left( F_{i+1/2}^{(0)} - \\frac{1}{2} \\sum_{k=1}^{2} F_{i+1/2}^{(1,k)} \\right)\n$$\n\nNow, we calculate the register values for the two coarse-fine interfaces, $x_{1/2}$ and $x_{3/2}$.\n\nAt interface $x_{1/2}$:\n$$\n\\mathcal{R}_{1/2} = 1 \\left( 5 - \\frac{1}{2} \\left( F_{1/2}^{(1,1)} + F_{1/2}^{(1,2)} \\right) \\right) = 5 - \\frac{1}{2} (7 + 5) = 5 - \\frac{12}{2} = 5 - 6 = -1\n$$\n\nAt interface $x_{3/2}$:\n$$\n\\mathcal{R}_{3/2} = 1 \\left( 6 - \\frac{1}{2} \\left( F_{3/2}^{(1,1)} + F_{3/2}^{(1,2)} \\right) \\right) = 6 - \\frac{1}{2} (8 + 6) = 6 - \\frac{14}{2} = 6 - 7 = -1\n$$\n\nThe value $\\mathcal{R}_{i+1/2}$ represents the net amount of the conserved quantity that the coarse simulation incorrectly moved across the face $x_{i+1/2}$ compared to the fine simulation. To maintain conservation, this mismatch must be corrected in the coarse cells adjacent to the interface. The correction to the total conserved quantity $Q_i = U_i \\Delta x_0$ is:\n- For the cell to the left ($i$): $\\Delta Q_{i, \\text{reflux}} = +\\mathcal{R}_{i+1/2}$\n- For the cell to the right ($i+1$): $\\Delta Q_{i+1, \\text{reflux}} = -\\mathcal{R}_{i+1/2}$\n\nThe corresponding change in the state variable $U_i$ is $\\Delta U_i = \\Delta Q_i / \\Delta x_0$.\n\nThe refluxing correction is applied to the uncovered coarse cells neighboring the fine patch.\n- Coarse cell $i=0$ is to the left of the interface $x_{1/2}$. Its state is corrected by $\\mathcal{R}_{1/2}$.\n- Coarse cell $i=2$ is to the right of the interface $x_{3/2}$. Its state is corrected by $\\mathcal{R}_{3/2}$.\n\nThe final updated state is the predicted state plus the refluxing correction.\n\nFor cell $i=0$:\n$$\nU_0^{n+1} = U_0^{n+1, \\text{pred}} + \\frac{\\mathcal{R}_{1/2}}{\\Delta x_0} = 9.25 + \\frac{-1}{4} = 9.25 - 0.25 = 9\n$$\n\nFor cell $i=2$:\n$$\nU_2^{n+1} = U_2^{n+1, \\text{pred}} - \\frac{\\mathcal{R}_{3/2}}{\\Delta x_0} = 30.75 - \\frac{-1}{4} = 30.75 + 0.25 = 31\n$$\n\n**3. Report the post-refluxing updated coarse conserved states.**\n\nThe final, fully synchronized coarse states for the uncovered cells are $U_0^{n+1} = 9$ and $U_2^{n+1} = 31$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9  31\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Cosmological simulations often involve highly supersonic flows where the kinetic energy of the gas vastly exceeds its internal thermal energy. In such regimes, a naive calculation of the internal energy $e_{\\mathrm{int}}$ by subtracting the kinetic energy from the total energy, $e_{\\mathrm{int}} = E - \\frac{1}{2}\\rho u^2$, is subject to catastrophic cancellation errors that can produce unphysical negative pressures. This exercise demonstrates this critical failure mode and introduces the dual-energy formalism, a widely used technique that tracks both total and internal energy to ensure thermodynamic consistency and robustness in high-Mach-number flows .",
            "id": "3464071",
            "problem": "Consider one-dimensional compressible hydrodynamics governed by the Euler equations with an ideal-gas equation of state. The conserved variables are $U = (\\rho, \\rho u, E)$, where $\\rho$ is mass density, $u$ is velocity, and $E$ is total energy density. The fluxes are $F(U) = (\\rho u, \\rho u^2 + p, (E + p) u)$, and the equation of state is $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ with ratio of specific heats $\\gamma$. Adaptive Mesh Refinement (AMR) introduces level transitions where flux synchronization can perturb total energy, which can lead to negative pressures when naively computing internal energy by subtraction in kinetic-energy-dominated flows.\n\nThe dual-energy formalism (DEF) tracks an auxiliary internal energy density $e_{\\mathrm{int}}$ to stabilize the thermodynamics in supersonic flows. In the high-Mach-number limit across shocks, subtractive cancellation in $e = E - \\tfrac{1}{2}\\rho u^2$ can be catastrophic. A robust DEF switching criterion must therefore decide when to trust $E$ versus when to overwrite thermodynamics using $e_{\\mathrm{int}}$, especially at AMR level transitions.\n\nStarting from the fundamental conservation laws, the ideal-gas equation of state, and the Rankine–Hugoniot jump conditions for a stationary planar normal shock, design and implement a program that:\n\n- Constructs left (post-shock) and right (pre-shock) primitive states $(\\rho, u, p)$ adjoining a stationary shock for a given upstream Mach number $M \\gg 1$ in code units, using $\\rho_1 = 1$, $u_1 = u_{\\infty}$, and $p_1 = \\rho_1 a_1^2/\\gamma$ with $a_1 = u_{\\infty}/M$. Use the standard normal-shock relations to compute the downstream state $(\\rho_2, u_2, p_2)$ from $(\\rho_1, u_1, p_1)$ and $\\gamma$. The shock is stationary in the laboratory frame so that the shock-frame and lab-frame velocities coincide.\n- Converts these primitive states to conserved variables $U_L$ and $U_R$ on the two cells adjacent to the shock and computes a single interfacial numerical flux using a first-order Harten–Lax–van Leer–Einfeldt (HLLE) approximate Riemann solver based on the Euler fluxes and the signal speeds $s_L = \\min(u_L - a_L, u_R - a_R)$ and $s_R = \\max(u_L + a_L, u_R + a_R)$, where $a = \\sqrt{\\gamma p/\\rho}$.\n- Applies one forward-Euler finite-volume update to the two interface-adjacent cells using a nondimensional Courant-like factor $\\alpha = \\Delta t/\\Delta x$, treating the interfacial flux as the only contribution to each cell’s update: $U_L^{\\star} = U_L - \\alpha F_{\\mathrm{HLLE}}$, $U_R^{\\star} = U_R + \\alpha F_{\\mathrm{HLLE}}$.\n- Emulates an AMR level-transition synchronization by applying an energy-only correction to the right (pre-shock) cell: $E_R^{\\star} \\mapsto E_R^{\\star} - \\varepsilon \\,\\tfrac{1}{2}\\rho_R^{\\star} u_R^{\\star 2}$. This models a small but potentially catastrophic mismatch that preferentially erodes internal energy in the kinetic-energy-dominated pre-shock cell while preserving mass and momentum.\n- Compares two thermodynamic closures for the post-synchronization right and left cells:\n  1. The naive closure, which computes pressure $p_{\\mathrm{naive}} = (\\gamma - 1)\\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right)$ directly from total energy. This can yield $p_{\\mathrm{naive}} \\le 0$.\n  2. The dual-energy formalism (DEF) closure: evolve an auxiliary internal energy variable initialized as $e_{\\mathrm{int}} = p/(\\gamma - 1)$ for each cell. After the synchronization correction, evaluate the ratio $r = \\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right)/E^{\\star}$. If either $r  \\eta$ or $\\left(E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\right) \\le 0$, then switch to DEF by setting the pressure from $e_{\\mathrm{int}}$ and enforcing consistency $E^{\\star} \\leftarrow e_{\\mathrm{int}} + \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}$. Otherwise, synchronize $e_{\\mathrm{int}} \\leftarrow \\max\\{e_{\\mathrm{int}}, E^{\\star} - \\tfrac{1}{2}\\rho^{\\star} u^{\\star 2}\\}$ and use the energy-based pressure. Count the number of cells that trigger the DEF switch.\n- Reports, for each test case, three quantities: a boolean indicating whether any cell has $p_{\\mathrm{naive}} \\le 0$ after synchronization, a boolean indicating whether any cell has $p_{\\mathrm{DEF}} \\le 0$ after the DEF switch logic, and the integer count of how many cells triggered the DEF switch.\n\nAll quantities are nondimensional code units. Use $\\gamma = 5/3$ and $u_{\\infty} = 1$ for all tests. Use $\\alpha = 0.4$, and the DEF threshold $\\eta = 10^{-3}$. The numerical flux must be computed by HLLE as stated from the conserved and primitive variables.\n\nTest Suite:\n- Case $1$: $M = 10$, $\\varepsilon = 10^{-3}$.\n- Case $2$: $M = 50$, $\\varepsilon = 10^{-3}$.\n- Case $3$: $M = 100$, $\\varepsilon = 10^{-3}$.\n- Case $4$: $M = 100$, $\\varepsilon = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists in Python literal format, ordered by the cases above. For example, the format must be $[[b_{1},b_{2},n_{1}],[b_{1},b_{2},n_{2}],\\dots]$, where each inner list contains two booleans and one integer in that order. No additional text should be printed.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It poses a standard, albeit simplified, numerical experiment in computational hydrodynamics to test the efficacy of the Dual-Energy Formalism (DEF) in preventing numerical artifacts—specifically, the generation of negative pressure in high Mach number flows. The setup, involving a stationary normal shock and a first-order finite-volume update with an HLLE Riemann solver, is a canonical test case. The prescribed emulation of an Adaptive Mesh Refinement (AMR) synchronization error is a physically motivated way to induce the pathology that DEF is designed to cure. All parameters, equations (Euler, ideal-gas EOS), and numerical methods (Rankine-Hugoniot, HLLE, Forward Euler) are standard in the field. The problem is self-contained and provides a clear, step-by-step procedure, leading to a unique, verifiable solution.\n\nThe solution proceeds by first establishing the pre-shock (right) and post-shock (left) fluid states based on the given upstream Mach number, $M$, and the Rankine-Hugoniot shock jump conditions. Then, these primitive states, $(\\rho, u, p)$, are converted into conserved variable vectors, $U = (\\rho, \\rho u, E)$, which form the initial conditions for two adjacent numerical cells.\n\nA single numerical flux, $F_{\\mathrm{HLLE}}$, is computed at the interface between the two cells using the Harten–Lax–van Leer–Einfeldt (HLLE) approximate Riemann solver. The HLLE flux is constructed from the left and right states and the estimated fastest signal velocities, $s_L$ and $s_R$.\n$F_{\\mathrm{HLLE}} = \\frac{s_R F_L - s_L F_R + s_L s_R (U_R - U_L)}{s_R - s_L}$\nwhere $F_L$ and $F_R$ are the Euler fluxes corresponding to $U_L$ and $U_R$, and the signal speeds are given by $s_L = \\min(u_L - a_L, u_R - a_R)$ and $s_R = \\max(u_L + a_L, u_R + a_R)$, with $a = \\sqrt{\\gamma p/\\rho}$ being the sound speed.\n\nWith the interfacial flux computed, a single first-order forward-Euler finite-volume update is applied to both cells. The left cell's state is updated as $U_L^{\\star} = U_L - \\alpha F_{\\mathrm{HLLE}}$, and the right cell's as $U_R^{\\star} = U_R + \\alpha F_{\\mathrm{HLLE}}$, where $\\alpha = \\Delta t/\\Delta x$ is a specified Courant-like factor.\n\nFollowing the hydrodynamic update, we emulate an AMR synchronization error. This is a crucial step that models how numerical errors at grid boundaries can corrupt the solution. A small fraction, $\\varepsilon$, of the kinetic energy in the right (pre-shock) cell is erroneously subtracted from its total energy:\n$E_R^{\\star} \\mapsto E_R^{\\star} - \\varepsilon \\left( \\frac{1}{2}\\rho_R^{\\star} (u_R^{\\star})^2 \\right)$\nThis is particularly pernicious in the pre-shock cell, where the Mach number is high, and thus the total energy $E = e_{\\mathrm{int}} + K$ is dominated by the kinetic energy component, $K = \\tfrac{1}{2}\\rho u^2$. A small relative error in $E$ can become a large, possibly sign-changing, error in the internal energy $e_{\\mathrm{int}} = E - K$.\n\nFinally, we analyze the thermodynamic state of both cells using two different methods:\n1.  **Naive Closure**: The pressure is computed directly from the updated total energy: $p_{\\mathrm{naive}} = (\\gamma - 1)(E^{\\star} - K^{\\star})$. We check if this results in an unphysical non-positive pressure, $p_{\\mathrm{naive}} \\le 0$.\n2.  **Dual-Energy Formalism (DEF) Closure**: An auxiliary internal energy variable, $e_{\\mathrm{int}}$, is initialized from the pre-update state. A switch condition is evaluated for the post-update state. The condition is triggered if the internal energy is a very small fraction of the total energy, $(E^{\\star} - K^{\\star}) / E^{\\star}  \\eta$, or if the internal energy itself is non-positive, $E^{\\star} - K^{\\star} \\le 0$. If the switch is triggered, the pressure is reset using the initial auxiliary variable, $p_{\\mathrm{DEF}} = (\\gamma-1)e_{\\mathrm{int}}$, thereby correcting the thermodynamic state. Otherwise, the pressure is computed from the total energy as in the naive case. We count the number of cells that trigger this switch and check if the resulting pressure, $p_{\\mathrm{DEF}}$, is ever non-positive.\n\nThis procedure is repeated for each test case, and the required boolean flags and integer counts are collected.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    # Test Suite: (M, epsilon)\n    test_cases = [\n        (10.0, 1e-3),\n        (50.0, 1e-3),\n        (100.0, 1e-3),\n        (100.0, 0.0),\n    ]\n\n    # Constants and parameters\n    gamma = 5.0 / 3.0\n    u_inf = 1.0\n    alpha = 0.4  # Nondimensional Courant-like factor\n    eta = 1e-3   # DEF threshold\n\n    results = []\n\n    for M, epsilon in test_cases:\n        # Step 1: Construct left (post-shock) and right (pre-shock) primitive states\n        # The shock is stationary in the lab frame.\n        # Right state (R) is the pre-shock, upstream state (denoted by subscript 1).\n        rho_R = 1.0\n        u_R = u_inf\n        a_R = u_inf / M\n        p_R = rho_R * a_R**2 / gamma\n\n        # Left state (L) is the post-shock, downstream state (denoted by subscript 2).\n        # Calculated using the normal shock (Rankine-Hugoniot) relations.\n        M2 = M * M\n        rho_L = rho_R * ((gamma + 1.0) * M2) / ((gamma - 1.0) * M2 + 2.0)\n        u_L = u_R * ((gamma - 1.0) * M2 + 2.0) / ((gamma + 1.0) * M2)\n        p_L = p_R * (2.0 * gamma * M2 - (gamma - 1.0)) / (gamma + 1.0)\n\n        prims_L = np.array([rho_L, u_L, p_L])\n        prims_R = np.array([rho_R, u_R, p_R])\n\n        # Step 2: Convert to conserved variables and initialize auxiliary internal energy\n        def prims_to_cons(prims, gamma_val):\n            rho, u, p = prims\n            E = p / (gamma_val - 1.0) + 0.5 * rho * u**2\n            return np.array([rho, rho * u, E])\n\n        U_L = prims_to_cons(prims_L, gamma)\n        U_R = prims_to_cons(prims_R, gamma)\n\n        e_int_L_initial = p_L / (gamma - 1.0)\n        e_int_R_initial = p_R / (gamma - 1.0)\n        initial_e_int = {\"L\": e_int_L_initial, \"R\": e_int_R_initial}\n\n        # Step 3: Compute HLLE flux\n        def get_flux(U, prims, gamma_val):\n            _rho, rhou, E = U\n            _rho_p, u_p, p_p = prims\n            return np.array([rhou, rhou * u_p + p_p, (E + p_p) * u_p])\n\n        F_L = get_flux(U_L, prims_L, gamma)\n        F_R = get_flux(U_R, prims_R, gamma)\n\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        \n        s_L_wave = min(u_L - a_L, u_R - a_R)\n        s_R_wave = max(u_L + a_L, u_R + a_R)\n\n        # The HLLE flux formula\n        F_hlle = (s_R_wave * F_L - s_L_wave * F_R + s_L_wave * s_R_wave * (U_R - U_L)) / (s_R_wave - s_L_wave)\n\n        # Step 4: Apply one forward-Euler finite-volume update\n        U_L_star = U_L - alpha * F_hlle\n        U_R_star = U_R + alpha * F_hlle\n\n        # Step 5: Emulate AMR level-transition synchronization on the right cell\n        rho_R_star, rhou_R_star, E_R_star = U_R_star\n        if rho_R_star  0:\n            K_R_star = (rhou_R_star**2) / (2.0 * rho_R_star)\n            E_R_star_corrected = E_R_star - epsilon * K_R_star\n            U_R_star[2] = E_R_star_corrected\n\n        # Step 6: Compare thermodynamic closures\n        p_naive_neg = False\n        p_def_neg = False\n        def_switch_count = 0\n\n        updated_states = {\"L\": U_L_star, \"R\": U_R_star}\n\n        for key, U_star in updated_states.items():\n            rho_star, rhou_star, E_star = U_star\n            \n            e_from_E = -1.0 # Initialize to a failure state\n            if rho_star  0:\n                K_star = (rhou_star**2) / (2.0 * rho_star)\n                e_from_E = E_star - K_star\n            \n            # Naive closure check\n            p_naive = (gamma - 1.0) * e_from_E\n            if p_naive = 0:\n                p_naive_neg = True\n\n            # DEF closure logic\n            r = e_from_E / E_star if E_star != 0 else -1.0\n            \n            switch_on = (r  eta) or (e_from_E = 0)\n\n            if switch_on:\n                def_switch_count += 1\n                p_def = (gamma - 1.0) * initial_e_int[key]\n            else:\n                p_def = p_naive\n            \n            if p_def = 0:\n                p_def_neg = True\n\n        results.append([p_naive_neg, p_def_neg, def_switch_count])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}