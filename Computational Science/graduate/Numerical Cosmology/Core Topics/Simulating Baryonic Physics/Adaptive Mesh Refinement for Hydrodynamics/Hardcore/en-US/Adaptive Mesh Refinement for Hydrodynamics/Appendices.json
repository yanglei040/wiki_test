{
    "hands_on_practices": [
        {
            "introduction": "At the heart of modern shock-capturing hydrodynamics codes, including those using AMR, lies the solution to the Riemann problem. This exercise  challenges you to derive the exact solution for a classic shock tube setup, building your intuition for the fundamental wave structures—shocks, rarefactions, and contact discontinuities—that govern gas dynamics. Mastering this foundational calculation is essential for understanding how numerical fluxes are computed at cell interfaces in any Godunov-type scheme.",
            "id": "3464087",
            "problem": "Consider a one-dimensional shock tube initial value problem posed on the real line with an interface at $x=0$. This problem is representative of the local Riemann problems solved at hydrodynamic interfaces in Adaptive Mesh Refinement (AMR) schemes for cosmological gas dynamics. Assume Newtonian ideal-gas hydrodynamics with the Euler equations in conservation form and an ideal gas with adiabatic index $\\gamma = \\frac{5}{3}$. Neglect cosmological expansion and gravity over the time and length scales of interest so that the local dynamics are governed purely by the Euler equations. The left and right initial states (at $t=0$) are given by\n$$\n(\\rho_L, u_L, p_L) = \\left(1.67 \\times 10^{-21},\\, 0,\\, 1.00 \\times 10^{-12}\\right), \\quad\n(\\rho_R, u_R, p_R) = \\left(1.67 \\times 10^{-23},\\, 0,\\, 1.00 \\times 10^{-14}\\right),\n$$\nwhere $\\rho$ is mass density in $\\mathrm{kg\\,m^{-3}}$, $u$ is velocity in $\\mathrm{m\\,s^{-1}}$, and $p$ is pressure in $\\mathrm{Pa}$. The interface is at $x=0$, and the solution is self-similar in the variable $\\xi = x/t$ for $t>0$.\n\nStarting from the Euler equations, the definition of sound speed $c = \\sqrt{\\gamma p / \\rho}$, the self-similar form of the Riemann problem, the isentropic relations across rarefaction waves, and the Rankine–Hugoniot jump conditions across shock waves, derive the exact structure of the Riemann fan for these initial states. In particular:\n- Determine whether the left-going wave is a shock or a rarefaction and whether the right-going wave is a shock or a rarefaction.\n- Identify which primitive variables are continuous across the contact discontinuity and which conserved fluxes are continuous across a shock in the sense of the Rankine–Hugoniot conditions.\n\nThen, using the appropriate wave relations from first principles, set up the implicit equation for the star-region pressure $p_\\ast$ that enforces equality of the velocity $u_\\ast$ obtained from the left and right wave connections. Solve this equation to determine the unique physically admissible $p_\\ast$.\n\nAnswer specification:\n- Report the value of the star-region pressure $p_\\ast$.\n- Express your final answer in $\\mathrm{Pa}$.\n- Round your answer to four significant figures.\n- Your final answer must be a single real number.",
            "solution": "This problem requires the solution of a one-dimensional Riemann problem for the Euler equations of gas dynamics. The system is governed by the conservation laws:\n$$ \\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0 $$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}(\\mathbf{U})$ is the vector of fluxes:\n$$ \\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\mathcal{E} \\end{pmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(\\mathcal{E}+p) \\end{pmatrix} $$\nHere, $\\rho$ is the mass density, $u$ is the fluid velocity, $p$ is the pressure, and $\\mathcal{E}$ is the total energy density per unit volume. For an ideal gas with adiabatic index $\\gamma$, the total energy density is given by the equation of state:\n$$ \\mathcal{E} = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2 $$\nThe given initial conditions define two states, a left state ($L$) for $x<0$ and a right state ($R$) for $x>0$:\n$(\\rho_L, u_L, p_L) = (1.67 \\times 10^{-21}, 0, 1.00 \\times 10^{-12})$\n$(\\rho_R, u_R, p_R) = (1.67 \\times 10^{-23}, 0, 1.00 \\times 10^{-14})$\nThe adiabatic index is $\\gamma = \\frac{5}{3}$. The solution for $t>0$ is self-similar and depends only on the variable $\\xi = x/t$. The solution structure consists of four constant states separated by three waves propagating from the origin: a left-going wave, a contact discontinuity, and a right-going wave. The intermediate region between the left and right waves is called the star region, characterized by a constant pressure $p_\\ast$ and velocity $u_\\ast$.\n\n**1. Wave Structure Determination**\nThe type of the left- and right-going waves (shock or rarefaction) is determined by the pressure difference between the initial states and the star region pressure $p_\\ast$. Since the initial velocities are zero ($u_L = u_R = 0$) and the pressure on the left is higher than on the right ($p_L > p_R$), the gas will expand from the left region and compress the right region. This implies a positive velocity $u_\\ast > 0$ in the star region.\nFor a wave to accelerate a fluid from $u_k$ to $u_\\ast$, the velocity change $u_\\ast - u_k$ is related to the pressure change $p_\\ast - p_k$.\n- If $p_\\ast > p_k$, the wave is a shock (compressive).\n- If $p_\\ast < p_k$, the wave is a rarefaction (expansive).\n\nLet us consider the possible ranges for $p_\\ast$:\n- If $p_\\ast > p_L$, both left and right waves would be shocks. A left-going shock would accelerate the fluid to the left, resulting in $u_\\ast < u_L = 0$. A right-going shock would accelerate the fluid to the right, resulting in $u_\\ast > u_R = 0$. These two conditions are contradictory.\n- If $p_\\ast < p_R$, both waves would be rarefactions. A left-going rarefaction would accelerate the fluid to the right ($u_\\ast > u_L = 0$), but a right-going rarefaction would accelerate the fluid to the left ($u_\\ast < u_R = 0$). This is also contradictory.\n- Therefore, the only physically consistent solution must satisfy $p_R < p_\\ast < p_L$. This implies that the left-going wave is a rarefaction wave (as it expands from high pressure $p_L$ to lower pressure $p_\\ast$) and the right-going wave is a shock wave (as it compresses from low pressure $p_R$ to higher pressure $p_\\ast$).\n\n**2. Continuity Conditions**\n- **Contact Discontinuity**: This is an interface that moves with the local fluid velocity, $u_\\ast$. Across a contact discontinuity, the pressure and velocity are continuous: $p$ is continuous and $u$ is continuous. Density $\\rho$ and temperature $T$ (and thus specific entropy) can jump.\n- **Shock Wave**: Across a shock, the primitive variables and fluxes are discontinuous. Conservation is expressed by the Rankine-Hugoniot (R-H) jump conditions. For a shock moving at speed $S$, the R-H conditions are $[ \\mathbf{F} ] = S [ \\mathbf{U} ]$, where $[q] = q_2 - q_1$ denotes the jump in a quantity $q$ across the shock. No component of the flux vector $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2+p, u(\\mathcal{E}+p))^T$ is generally continuous in the laboratory frame. However, in a frame moving with the shock, the following quantities are conserved (continuous):\n    1. Mass flux: $\\rho(u-S)$\n    2. Momentum flux: $p + \\rho(u-S)^2$\n    3. Energy flux: $(\\mathcal{E}+p)(u-S) + pS$\n\n**3. Equation for the Star-Region Pressure $p_\\ast$**\nWe must find $p_\\ast$ by equating the star-region velocity $u_\\ast$ as determined by the relations for the left- and right-going waves.\n- **Left Wave (Rarefaction)**: The change in velocity across a left-propagating rarefaction wave is given by the Riemann invariant along the $C_+$ characteristics:\n$$ u_\\ast = u_L + \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) $$\nwhere $c_L = \\sqrt{\\gamma p_L / \\rho_L}$ is the sound speed in the left state.\n- **Right Wave (Shock)**: The change in velocity across a right-propagating shock wave is derived from the Rankine-Hugoniot conditions:\n$$ u_\\ast = u_R + (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\nEquating these two expressions for $u_\\ast$ (with $u_L=u_R=0$) gives the implicit equation for $p_\\ast$:\n$$ \\frac{2c_L}{\\gamma-1} \\left( 1 - \\left(\\frac{p_\\ast}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\right) = (p_\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p_\\ast + (\\gamma-1)p_R}} $$\n\n**4. Solving for $p_\\ast$**\nWe now substitute the given numerical values to solve for $p_\\ast$.\n- $\\gamma = 5/3$, so $\\gamma-1 = 2/3$, $\\gamma+1=8/3$, and $\\frac{\\gamma-1}{2\\gamma} = \\frac{2/3}{2(5/3)} = 1/5$.\n- Left state data:\n  $p_L = 1.00 \\times 10^{-12} \\, \\mathrm{Pa}$\n  $\\rho_L = 1.67 \\times 10^{-21} \\, \\mathrm{kg\\,m^{-3}}$\n  $c_L = \\sqrt{\\frac{(5/3)(1.00 \\times 10^{-12})}{1.67 \\times 10^{-21}}} \\approx 31591.2 \\, \\mathrm{m\\,s^{-1}}$\n- Right state data:\n  $p_R = 1.00 \\times 10^{-14} \\, \\mathrm{Pa}$\n  $\\rho_R = 1.67 \\times 10^{-23} \\, \\mathrm{kg\\,m^{-3}}$\n\nThe equation becomes:\n$$ \\frac{2(31591.2)}{2/3} \\left( 1 - \\left(\\frac{p_\\ast}{10^{-12}}\\right)^{1/5} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{2/(1.67 \\times 10^{-23})}{(8/3)p_\\ast + (2/3)(10^{-14})}} $$\n$$ 94773.6 \\left( 1 - (10^{12}p_\\ast)^{1/5} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{1.1976 \\times 10^{23}}{(8/3)p_\\ast + (2/3) \\times 10^{-14}}} $$\nThis simplifies to:\n$$ 94773.6 \\left( 1 - (10^{12}p_\\ast)^{0.2} \\right) = (p_\\ast - 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{p_\\ast + 0.25 \\times 10^{-14}}} $$\nThis is a nonlinear equation for $p_\\ast$ which must be solved numerically. Let the left-hand side be $f_L(p_\\ast)$ and the right-hand side be $f_R(p_\\ast)$. We seek the root of $f_L(p_\\ast) - f_R(p_\\ast) = 0$ in the interval $(p_R, p_L)$. A numerical root-finding method (e.g., bisection or Newton-Raphson) yields the solution.\nLet's test $p_\\ast = 5.7706 \\times 10^{-14} \\, \\mathrm{Pa}$.\n- Left side (velocity from rarefaction):\n$u_\\ast = 94773.6 \\left( 1 - \\left(\\frac{5.7706 \\times 10^{-14}}{10^{-12}}\\right)^{0.2} \\right) = 94773.6 \\left( 1 - (0.057706)^{0.2} \\right) \\approx 94773.6 (1 - 0.56527) = 41200 \\, \\mathrm{m\\,s^{-1}}$.\n- Right side (velocity from shock):\n$u_\\ast = (5.7706 \\times 10^{-14} - 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{5.7706 \\times 10^{-14} + 0.25 \\times 10^{-14}}} = (4.7706 \\times 10^{-14}) \\sqrt{\\frac{4.491 \\times 10^{22}}{6.0206 \\times 10^{-14}}} \\approx (4.7706 \\times 10^{-14})(8.6368 \\times 10^{17}) = 41200 \\, \\mathrm{m\\,s^{-1}}$.\nThe two velocities are equal, confirming this value of $p_\\ast$ is the correct solution.\nRounding to four significant figures, we get $p_\\ast = 5.771 \\times 10^{-14} \\, \\mathrm{Pa}$.",
            "answer": "$$\\boxed{5.771 \\times 10^{-14}}$$"
        },
        {
            "introduction": "While a single grid must obey conservation laws, adaptive mesh refinement introduces a new challenge: ensuring conservation across boundaries between different refinement levels. This practice  provides a concrete, step-by-step calculation of the \"refluxing\" correction, a cornerstone of conservative AMR schemes. By working through this example, you will understand the mechanism that reconciles flux mismatches at coarse-fine interfaces to maintain global conservation.",
            "id": "3464103",
            "problem": "Consider one-dimensional finite-volume hydrodynamics in a cosmological simulation using Adaptive Mesh Refinement (AMR). Focus on a single conserved scalar field (e.g., comoving mass density) with no source terms so that local conservation is controlled entirely by face fluxes. A level-$0$ coarse grid with uniform cell width $\\Delta x_0$ and time step $\\Delta t_0$ is partially refined by a level-$1$ fine patch with refinement ratio $r=2$. The fine level advances with two substeps of size $\\Delta t_1=\\Delta t_0/2$. The fine patch covers exactly coarse cell $i=1$, so the coarse-fine interfaces are the faces at $x_{1/2}$ (between coarse cells $i=0$ and $i=1$) and $x_{3/2}$ (between coarse cells $i=1$ and $i=2$). All quantities are nondimensional.\n\nYou are given:\n- Coarse cell indices: $i=0,1,2$.\n- Coarse cell widths and time step: $\\Delta x_0 = 4$, $\\Delta t_0 = 1$.\n- Coarse-level conserved states at time $t^n$: $U_0^n = 10$, $U_1^n = 20$, $U_2^n = 30$.\n- Coarse-level numerical fluxes at faces during $\\Delta t_0$: $F_{-1/2}^{(0)}=2$, $F_{1/2}^{(0)}=5$, $F_{3/2}^{(0)}=6$, $F_{5/2}^{(0)}=3$.\n- Fine-level substep numerical fluxes at the coarse-fine faces:\n  - At $x_{1/2}$: $F_{1/2}^{(1,1)}=7$ for the first substep and $F_{1/2}^{(1,2)}=5$ for the second substep.\n  - At $x_{3/2}$: $F_{3/2}^{(1,1)}=8$ for the first substep and $F_{3/2}^{(1,2)}=6$ for the second substep.\n\nStarting from the finite-volume conservation law and the definition of refluxing as the conservative replacement of coarse-face fluxes at coarse-fine interfaces by the time-integrated fine-level fluxes accumulated over substeps, perform the following:\n\n1. Compute the level-$0$ coarse prediction update for the uncovered coarse cells $i=0$ and $i=2$ over $\\Delta t_0$ using only level-$0$ fluxes.\n2. Construct the flux-register differences at the two coarse-fine interfaces by contrasting the time-integrated fine fluxes with the level-$0$ coarse fluxes over the same time interval, and apply the refluxing corrections to the coarse prediction for cells $i=0$ and $i=2$ with the correct face-orientation signs.\n3. Report the post-refluxing updated coarse conserved states $U_0^{n+1}$ and $U_2^{n+1}$.\n\nExpress your final answer as the row matrix $\\left(U_0^{n+1}\\;\\;U_2^{n+1}\\right)$ with no units. No rounding is required.",
            "solution": "The fundamental principle is the finite-volume update for a conserved quantity $U$ in one dimension. For a cell $i$ with width $\\Delta x$ and time step $\\Delta t$, the state is updated from time $t^n$ to $t^{n+1}$ as:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i \\pm 1/2}$ are the numerical fluxes at the cell faces, defined as positive in the positive $x$-direction.\n\n**1. Compute the level-0 coarse prediction update for cells $i=0$ and $i=2$.**\n\nThis step calculates the state of the coarse cells that are not covered by the fine grid, using only the coarse-level fluxes. The time step is $\\Delta t_0 = 1$ and the cell width is $\\Delta x_0 = 4$.\n\nFor coarse cell $i=0$, the update equation is:\n$$\nU_0^{n+1, \\text{pred}} = U_0^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{1/2}^{(0)} - F_{-1/2}^{(0)} \\right)\n$$\nSubstituting the given values:\n$$\nU_0^{n+1, \\text{pred}} = 10 - \\frac{1}{4} \\left( 5 - 2 \\right) = 10 - \\frac{3}{4} = 9.25\n$$\n\nFor coarse cell $i=2$, the update equation is:\n$$\nU_2^{n+1, \\text{pred}} = U_2^n - \\frac{\\Delta t_0}{\\Delta x_0} \\left( F_{5/2}^{(0)} - F_{3/2}^{(0)} \\right)\n$$\nSubstituting the given values:\n$$\nU_2^{n+1, \\text{pred}} = 30 - \\frac{1}{4} \\left( 3 - 6 \\right) = 30 - \\frac{-3}{4} = 30 + \\frac{3}{4} = 30.75\n$$\nThese are the provisional updated states before the refluxing correction.\n\n**2. Construct the flux-register differences and apply refluxing corrections.**\n\nThe refluxing step corrects for the mismatch between the flux calculated on the coarse grid and the more accurate flux calculated on the fine grid at a coarse-fine interface. A flux register, $\\mathcal{R}$, accumulates this mismatch over the full coarse time step $\\Delta t_0$. The total mismatch is defined as the integrated coarse flux minus the sum of integrated fine fluxes over the substeps.\n\nFor a face at $x_{i+1/2}$, with refinement $r=2$, the flux register is:\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 F_{i+1/2}^{(0)} - \\sum_{k=1}^{2} \\Delta t_1 F_{i+1/2}^{(1,k)}\n$$\nGiven $\\Delta t_1 = \\Delta t_0 / 2 = 1/2$:\n$$\n\\mathcal{R}_{i+1/2} = \\Delta t_0 \\left( F_{i+1/2}^{(0)} - \\frac{1}{2} \\sum_{k=1}^{2} F_{i+1/2}^{(1,k)} \\right)\n$$\n\nNow, we calculate the register values for the two coarse-fine interfaces, $x_{1/2}$ and $x_{3/2}$.\n\nAt interface $x_{1/2}$:\n$$\n\\mathcal{R}_{1/2} = 1 \\left( 5 - \\frac{1}{2} \\left( F_{1/2}^{(1,1)} + F_{1/2}^{(1,2)} \\right) \\right) = 5 - \\frac{1}{2} (7 + 5) = 5 - \\frac{12}{2} = 5 - 6 = -1\n$$\n\nAt interface $x_{3/2}$:\n$$\n\\mathcal{R}_{3/2} = 1 \\left( 6 - \\frac{1}{2} \\left( F_{3/2}^{(1,1)} + F_{3/2}^{(1,2)} \\right) \\right) = 6 - \\frac{1}{2} (8 + 6) = 6 - \\frac{14}{2} = 6 - 7 = -1\n$$\n\nThe value $\\mathcal{R}_{i+1/2}$ represents the net amount of the conserved quantity that the coarse simulation incorrectly moved across the face $x_{i+1/2}$ compared to the fine simulation. To maintain conservation, this mismatch must be corrected in the coarse cells adjacent to the interface. The correction to the state variable $U_i$ is $\\Delta U_i = \\pm \\mathcal{R}_{i+1/2} / \\Delta x_0$.\n\nThe refluxing correction is applied to the uncovered coarse cells neighboring the fine patch.\n- Coarse cell $i=0$ is to the left of the interface $x_{1/2}$. Its state is corrected by adding the flux error from the register.\n- Coarse cell $i=2$ is to the right of the interface $x_{3/2}$. Its state is corrected by subtracting the flux error from the register.\n\nThe final updated state is the predicted state plus the refluxing correction.\n\nFor cell $i=0$:\n$$\nU_0^{n+1} = U_0^{n+1, \\text{pred}} + \\frac{\\mathcal{R}_{1/2}}{\\Delta x_0} = 9.25 + \\frac{-1}{4} = 9.25 - 0.25 = 9\n$$\n\nFor cell $i=2$:\n$$\nU_2^{n+1} = U_2^{n+1, \\text{pred}} - \\frac{\\mathcal{R}_{3/2}}{\\Delta x_0} = 30.75 - \\frac{-1}{4} = 30.75 + 0.25 = 31\n$$\n\n**3. Report the post-refluxing updated coarse conserved states.**\n\nThe final, fully synchronized coarse states for the uncovered cells are $U_0^{n+1} = 9$ and $U_2^{n+1} = 31$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9 & 31\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A crucial aspect of mastering AMR is understanding how the grid structure itself can influence physical results, a common source of numerical artifacts. This advanced practice  asks you to model and quantify how an AMR level boundary introduces numerical diffusion that alters the growth of the Kelvin-Helmholtz instability. This exercise highlights the critical skill of distinguishing between physical phenomena and numerical effects when interpreting simulation data.",
            "id": "3464075",
            "problem": "You are to design and implement a program that quantitatively assesses how Adaptive Mesh Refinement (AMR) level transitions modify the linear growth and weakly nonlinear saturation of seeded Kelvin–Helmholtz (KH) modes in inviscid hydrodynamics, using a principled, first-principles derivation grounded in the Euler equations and the modified equation analysis of numerical diffusion for a first-order upwind finite-volume scheme. The physical setting is a two-dimensional inviscid shear layer in nondimensional units.\n\nA small-amplitude, single-mode KH perturbation is seeded at a planar velocity discontinuity (a vortex sheet) located at the horizontal line $y=0$, which coincides with an AMR level boundary. The upper half-plane $y&gt;0$ has uniform flow velocity $U_{\\text{top}}=+\\frac{1}{2}U_0$ and the lower half-plane $y&lt;0$ has uniform flow velocity $U_{\\text{bot}}=-\\frac{1}{2}U_0$, so that the velocity jump is $\\Delta U=U_{\\text{top}}-U_{\\text{bot}}=U_0$. The KH interface displacement is initialized with a single sinusoidal mode of wavenumber $k$ and amplitude $a_0\\ll 1$.\n\nYour derivation and implementation must proceed from the following fundamental bases:\n- The inviscid hydrodynamics is governed by the Euler equations. For a vortex sheet with a velocity jump $\\Delta U$ and a single Fourier mode of wavenumber $k$, the linear instability analysis of the linearized Euler equations yields an inviscid exponential growth of the interface amplitude. You must derive the inviscid growth rate in terms of $k$ and $\\Delta U$ from this base.\n- A first-order upwind finite-volume discretization of linear advection in one spatial dimension is known, via modified equation analysis, to introduce an artificial (numerical) diffusion term of the form $\\nu_{\\text{num}}\\partial_{xx}q$ with $\\nu_{\\text{num}}=\\frac{1}{2}|u|\\Delta x$ for advection velocity $u$ and grid spacing $\\Delta x$. You must justify how, for a shear interface resolved across the AMR level transition aligned with $y=0$, the KH mode experiences an effective damping that can be modeled as a viscous term proportional to $k^2$, with an effective coefficient constructed by appropriately averaging the contributions from the two sides of the interface that have different normal grid spacings $\\Delta y_{\\text{top}}$ and $\\Delta y_{\\text{bot}}$ and advecting speeds $U_{\\text{top}}$ and $U_{\\text{bot}}$. Explicitly state and justify your averaging choice from first principles so that it is consistent with flux continuity at a level boundary.\n\nFrom these principles, construct:\n- A linear effective growth rate $\\gamma_{\\text{eff}}(k)$ that combines the inviscid KH drive and the damping from the effective numerical diffusion at the AMR level transition aligned with the interface. The dependence on $k$, $U_0$, $\\Delta y_{\\text{top}}$, and $\\Delta y_{\\text{bot}}$ must be explicitly derived.\n- A weakly nonlinear saturation amplitude $a_{\\text{sat}}$ from a Landau-type amplitude equation of the form $\\frac{da}{dt}=\\gamma_{\\text{eff}}a-\\beta a^3$, where $\\beta&gt;0$ is a given constant. Show that for $\\gamma_{\\text{eff}}\\le 0$ the amplitude decays and for $\\gamma_{\\text{eff}}&gt;0$ the saturated amplitude is finite and determined by $\\gamma_{\\text{eff}}$ and $\\beta$.\n\nYour program must implement the derived formulas to compute, for each test case listed below, the pair of values $(\\gamma_{\\text{eff}},a_{\\text{sat}})$, with all quantities nondimensional. Round each reported value to exactly $6$ decimal places.\n\nTest suite (nondimensional parameters):\n- Case $1$ (happy path, no refinement contrast): $U_0=1.0$, $k=8\\pi$, $\\Delta y_{\\text{top}}=\\frac{1}{256}$, $\\Delta y_{\\text{bot}}=\\frac{1}{256}$, $\\beta=1.0$.\n- Case $2$ (typical AMR ratio $2$ to $1$): $U_0=1.0$, $k=8\\pi$, $\\Delta y_{\\text{top}}=\\frac{1}{256}$, $\\Delta y_{\\text{bot}}=\\frac{1}{128}$, $\\beta=1.0$.\n- Case $3$ (strong AMR ratio $4$ to $1$): $U_0=1.0$, $k=8\\pi$, $\\Delta y_{\\text{top}}=\\frac{1}{256}$, $\\Delta y_{\\text{bot}}=\\frac{1}{64}$, $\\beta=1.0$.\n- Case $4$ (longer wavelength with coarse lower level): $U_0=1.0$, $k=2\\pi$, $\\Delta y_{\\text{top}}=\\frac{1}{128}$, $\\Delta y_{\\text{bot}}=\\frac{1}{16}$, $\\beta=1.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, one pair per test case, enclosed in square brackets, with no spaces. For example, the printed line must look like $[[\\gamma_1,a_1],[\\gamma_2,a_2],[\\gamma_3,a_3],[\\gamma_4,a_4]]$, where each $\\gamma_i$ and $a_i$ is a decimal rounded to $6$ places.",
            "solution": "The problem requires the formulation and implementation of a model that describes the growth and saturation of a single Kelvin-Helmholtz (KH) mode at a shear interface coinciding with an Adaptive Mesh Refinement (AMR) boundary. This analysis will be grounded in first principles, combining the inviscid dynamics governed by the Euler equations with a model for numerical diffusion arising from a first-order upwind discretization.\n\nFirst, we derive the inviscid growth rate, $\\gamma_{\\text{inv}}$, of the KH instability. The physical system consists of a vortex sheet at $y=0$, separating two fluid regions of uniform density $\\rho$ (which we can set to $1$ in nondimensional units). The upper fluid ($y>0$) moves with velocity $U_{\\text{top}} = +\\frac{1}{2}U_0$, and the lower fluid ($y<0$) with velocity $U_{\\text{bot}} = -\\frac{1}{2}U_0$. The velocity jump is $\\Delta U = U_0$. We consider a small sinusoidal perturbation of the interface, $\\eta(x,t)$, with wavenumber $k$. The flow is assumed to be irrotational in each half-plane, described by velocity potentials $\\phi_1$ and $\\phi_2$. A linear stability analysis of the Euler equations yields the dispersion relation for the complex frequency $\\omega$ of the perturbation, where the amplitude grows as $e^{\\gamma t}$ with $\\gamma = \\text{Im}(\\omega)$. The standard derivation for two semi-infinite fluids of equal density yields the relation:\n$$\n\\left(\\omega - k U_{\\text{top}}\\right)^2 + \\left(\\omega - k U_{\\text{bot}}\\right)^2 = 0\n$$\nSolving this quadratic equation for $\\omega$ gives:\n$$\n\\omega = k \\frac{U_{\\text{top}} + U_{\\text{bot}}}{2} \\pm i \\frac{k}{2} |U_{\\text{top}} - U_{\\text{bot}}|\n$$\nThe real part of $\\omega$ represents the phase velocity of the wave, while the imaginary part represents the growth or decay rate. The unstable mode corresponds to the positive imaginary part. The inviscid growth rate $\\gamma_{\\text{inv}}$ is therefore:\n$$\n\\gamma_{\\text{inv}} = \\frac{k}{2} |U_{\\text{top}} - U_{\\text{bot}}|\n$$\nSubstituting the given velocities, $U_{\\text{top}} = \\frac{1}{2}U_0$ and $U_{\\text{bot}} = -\\frac{1}{2}U_0$, we obtain the specific expression for the inviscid growth rate:\n$$\n\\gamma_{\\text{inv}} = \\frac{k}{2} \\left|\\frac{1}{2}U_0 - \\left(-\\frac{1}{2}U_0\\right)\\right| = \\frac{1}{2} k U_0\n$$\n\nSecond, we model the effect of numerical diffusion introduced by the finite-volume scheme. The problem states that a first-order upwind scheme for 1D linear advection with velocity $u$ and grid spacing $\\Delta x$ introduces an artificial diffusion term with a coefficient $\\nu_{\\text{num}} = \\frac{1}{2}|u|\\Delta x$. In our 2D KH problem, the shear layer is oriented along the $x$-axis, and the numerical grid is refined across the $y=0$ line, with different grid spacings $\\Delta y_{\\text{top}}$ and $\\Delta y_{\\text{bot}}$. The numerical diffusion will act to smear the sharp velocity gradient in the $y$-direction, thus damping the instability. We model this effect by constructing an effective numerical viscosity, $\\nu_{\\text{eff, num}}$, acting on the interface. The characteristic velocities driving the process are the advection speeds on either side, $|U_{\\text{top}}|$ and $|U_{\\text{bot}}|$, and the relevant length scales are the grid spacings normal to the interface, $\\Delta y_{\\text{top}}$ and $\\Delta y_{\\text{bot}}$. Following the provided form, we define the numerical viscosity contributions from the top and bottom regions as:\n$$\n\\nu_{\\text{num, top}} = \\frac{1}{2} |U_{\\text{top}}| \\Delta y_{\\text{top}} = \\frac{1}{2} \\left(\\frac{1}{2}U_0\\right) \\Delta y_{\\text{top}} = \\frac{1}{4} U_0 \\Delta y_{\\text{top}}\n$$\n$$\n\\nu_{\\text{num, bot}} = \\frac{1}{2} |U_{\\text{bot}}| \\Delta y_{\\text{bot}} = \\frac{1}{2} \\left|-\\frac{1}{2}U_0\\right| \\Delta y_{\\text{bot}} = \\frac{1}{4} U_0 \\Delta y_{\\text{bot}}\n$$\nThe problem requires a justified averaging of these two contributions. The interface lies at the boundary of two numerical domains with different properties. The total dissipative effect on the interface is a combination of the diffusion from both sides. A simple and robust first-principles approach is to assume the effective numerical environment is the arithmetic average of the two, representing an equal influence from the cells above and below the interface. This is consistent with finite-volume schemes where face-centered properties are often interpolated from adjacent cell-centers. Thus, we define the effective numerical viscosity as:\n$$\n\\nu_{\\text{eff, num}} = \\frac{\\nu_{\\text{num, top}} + \\nu_{\\text{num, bot}}}{2} = \\frac{1}{2} \\left( \\frac{1}{4} U_0 \\Delta y_{\\text{top}} + \\frac{1}{4} U_0 \\Delta y_{\\text{bot}} \\right) = \\frac{1}{8} U_0 (\\Delta y_{\\text{top}} + \\Delta y_{\\text{bot}})\n$$\nThis effective viscosity introduces a damping term to the growth rate. For a diffusive process modeled by the equation $\\partial_t q = \\nu \\nabla^2 q$, a mode with wavenumber $k$ is damped at a rate proportional to $-\\nu k^2$. Applying this to our effective viscosity, the damping rate $\\gamma_{\\text{damp}}$ on the mode amplitude is:\n$$\n\\gamma_{\\text{damp}} = -\\nu_{\\text{eff, num}} k^2 = - \\frac{1}{8} U_0 (\\Delta y_{\\text{top}} + \\Delta y_{\\text{bot}}) k^2\n$$\n\nThird, we construct the effective linear growth rate, $\\gamma_{\\text{eff}}$, by combining the inviscid drive and the numerical damping:\n$$\n\\gamma_{\\text{eff}} = \\gamma_{\\text{inv}} + \\gamma_{\\text{damp}} = \\frac{1}{2} k U_0 - \\frac{1}{8} U_0 (\\Delta y_{\\text{top}} + \\Delta y_{\\text{bot}}) k^2\n$$\nThis can be rewritten to highlight the competition between the terms:\n$$\n\\gamma_{\\text{eff}} = \\frac{1}{2} k U_0 \\left[ 1 - \\frac{k}{4} (\\Delta y_{\\text{top}} + \\Delta y_{\\text{bot}}) \\right]\n$$\n\nFinally, we determine the weakly nonlinear saturation amplitude, $a_{\\text{sat}}$, using the provided Landau-type equation for the amplitude $a(t)$:\n$$\n\\frac{da}{dt} = \\gamma_{\\text{eff}} a - \\beta a^3\n$$\nSaturation occurs when the amplitude reaches a steady state, i.e., $\\frac{da}{dt}=0$. This gives two fixed points: the trivial one $a=0$ and the non-trivial one defined by:\n$$\n\\gamma_{\\text{eff}} a_{\\text{sat}} - \\beta a_{\\text{sat}}^3 = 0 \\implies a_{\\text{sat}}^2 = \\frac{\\gamma_{\\text{eff}}}{\\beta}\n$$\nA physically meaningful, non-zero saturation amplitude exists only if the mode is linearly unstable, i.e., $\\gamma_{\\text{eff}} > 0$. If $\\gamma_{\\text{eff}} \\le 0$, any initial perturbation decays, and the saturation amplitude is $0$. Therefore, the saturation amplitude is given by:\n$$\na_{\\text{sat}} = \\begin{cases} \\sqrt{\\frac{\\gamma_{\\text{eff}}}{\\beta}} & \\text{if } \\gamma_{\\text{eff}} > 0 \\\\ 0 & \\text{if } \\gamma_{\\text{eff}} \\le 0 \\end{cases}\n$$\nThese derived expressions for $\\gamma_{\\text{eff}}$ and $a_{\\text{sat}}$ will be implemented to solve the test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the effective growth rate and saturation amplitude for Kelvin-Helmholtz\n    instability at an AMR interface based on a derived model.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: U0=1.0, k=8*pi, dy_top=1/256, dy_bot=1/256, beta=1.0\n        (1.0, 8 * np.pi, 1.0/256.0, 1.0/256.0, 1.0),\n        # Case 2: U0=1.0, k=8*pi, dy_top=1/256, dy_bot=1/128, beta=1.0\n        (1.0, 8 * np.pi, 1.0/256.0, 1.0/128.0, 1.0),\n        # Case 3: U0=1.0, k=8*pi, dy_top=1/256, dy_bot=1/64, beta=1.0\n        (1.0, 8 * np.pi, 1.0/256.0, 1.0/64.0, 1.0),\n        # Case 4: U0=1.0, k=2*pi, dy_top=1/128, dy_bot=1/16, beta=1.0\n        (1.0, 2 * np.pi, 1.0/128.0, 1.0/16.0, 1.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        U0, k, dy_top, dy_bot, beta = case\n\n        # Calculate the effective linear growth rate (gamma_eff)\n        # gamma_eff = (1/2)*k*U0 - (1/8)*U0*(dy_top + dy_bot)*k**2\n        # Factored form: gamma_eff = 0.5 * k * U0 * (1 - 0.25 * k * (dy_top + dy_bot))\n        gamma_eff = 0.5 * k * U0 * (1.0 - 0.25 * k * (dy_top + dy_bot))\n        \n        # Calculate the weakly nonlinear saturation amplitude (a_sat)\n        if gamma_eff > 0:\n            a_sat = np.sqrt(gamma_eff / beta)\n        else:\n            a_sat = 0.0\n            \n        # Append the pair of results, pre-rounded for clarity\n        # The final formatting will handle the exact decimal places\n        results.append([gamma_eff, a_sat])\n\n    # Format the results into the required string format.\n    # The format is a list of pairs, comma-separated, with no spaces.\n    # Each value must be rounded to exactly 6 decimal places.\n    # Example: [[_gamma1_f,_a1_f],[_gamma2_f,_a2_f]]\n    result_strings = []\n    for gamma, a_sat in results:\n        result_strings.append(f\"[{gamma:.6f},{a_sat:.6f}]\")\n        \n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}