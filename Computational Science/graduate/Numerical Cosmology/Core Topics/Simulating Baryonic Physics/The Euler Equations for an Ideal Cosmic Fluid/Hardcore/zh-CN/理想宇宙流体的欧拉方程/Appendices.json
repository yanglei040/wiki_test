{
    "hands_on_practices": [
        {
            "introduction": "宇宙流体的数值模拟通常演化一组守恒变量，即质量密度、动量密度和总能量密度。然而，为了进行物理解释和计算更新所需的通量，我们需要原始变量：密度、速度和压力。本练习  将引导您完成这两组变量之间的基本代数转换，这是构建或理解任何流体动力学代码的关键第一步。",
            "id": "3495179",
            "problem": "考虑一个理想宇宙流体的宇宙学流体动力学模拟中的局部有限体积元，其在物理时间上推进了一个足够小的时间间隔，以至于为了重构原始变量可以忽略哈勃膨胀源项。该状态由守恒变量——质量密度 $\\rho$、动量密度 $m$ 和总能量密度 $E$，以及适用于单原子理想气体的常数绝热指数 $\\gamma$ 来表示。在给定时刻，为您提供了以下物理上合理的数值：$\\rho = 1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}$，$m = 3.0 \\times 10^{-17}\\ \\mathrm{g\\,cm^{-2}\\,s^{-1}}$，$E = 1.45 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$ 以及 $\\gamma = 5/3$。\n\n从适用于欧拉方程的可压缩流体动力学和热力学中的基本定义出发：\n- 动量密度等于质量密度乘以体速度。\n- 总能量密度等于内能密度与动能密度之和。\n- 理想气体闭合关系将压强与内能密度关联起来。\n- 绝热声速源于微小的等熵压缩。\n\n推导体速度 $u$、内能密度 $e$、压强 $P$ 和绝热声速 $c_s$ 关于守恒变量 $(\\rho, m, E)$ 和 $\\gamma$ 的表达式。然后使用提供的数值计算这些表达式的值。最后，通过检查压强的正性条件 $P > 0$ 来评估该状态的物理可容许性。\n\n将 $u$ 和 $c_s$ 以 $\\mathrm{cm\\,s^{-1}}$ 为单位表示，$e$ 和 $P$ 以 $\\mathrm{erg\\,cm^{-3}}$ 为单位表示。将您最终得到的 $(u, e, P, c_s)$ 的数值四舍五入到四位有效数字。最终答案必须只包含一同呈现的四元组 $(u, e, P, c_s)$。",
            "solution": "问题陈述需经过验证。\n\n**第1步：提取已知条件**\n提供的数据和定义如下：\n- 守恒变量：质量密度 $\\rho$、动量密度 $m$、总能量密度 $E$。\n- 常数：绝热指数 $\\gamma$。\n- 数值：\n  - $\\rho = 1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}$\n  - $m = 3.0 \\times 10^{-17}\\ \\mathrm{g\\,cm^{-2}\\,s^{-1}}$\n  - $E = 1.45 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$\n  - $\\gamma = 5/3$\n- 理想流体的基本定义：\n  1. 动量密度：$m = \\rho u$，其中 $u$ 是体速度。\n  2. 总能量密度：$E = e + E_k$，即内能密度 $e$ 和动能密度 $E_k$ 之和。动能密度定义为 $E_k = \\frac{1}{2}\\rho u^2$。\n  3. 理想气体闭合关系：$P = (\\gamma - 1)e$，将压强 $P$ 与内能密度关联。\n  4. 绝热声速：$c_s^2 = \\frac{\\gamma P}{\\rho}$。\n\n**第2步：使用提取的已知条件进行验证**\n根据指定标准评估问题：\n- **科学依据：**该问题是计算流体动力学中的一个标准练习，具体涉及欧拉方程中从守恒变量 $(\\rho, m, E)$ 到原始变量 $(u, e, P, c_s)$ 的转换。这是数值宇宙学中使用的有限体积法的一项基本操作。$\\gamma = 5/3$ 这个值对于单原子理想气体是正确的，这是对宇宙流体的一种常见近似。所有定义都是标准的。\n- **适定性：**该问题是适定的。它提供了唯一确定所需量的所有必要信息。\n- **客观性：**语言正式、精确，没有任何主观或模糊的陈述。\n- **一致性与完备性：**该问题是自洽的。所提供的数值和单位在量纲上是一致的，并且对于所描述的场景（例如，星系际介质）是物理上合理的。任务定义清晰。\n\n**第3步：结论与行动**\n该问题有效。这是一个在计算天体物理学中定义明确、科学合理的问题。可以继续求解过程。\n\n**原始变量的推导**\n目标是用守恒变量 $(\\rho, m, E)$ 和常数 $\\gamma$ 来表示原始变量 $(u, e, P, c_s)$。\n\n1.  **体速度 ($u$)**：\n    根据动量密度的定义，$m = \\rho u$。求解速度 $u$ 可得：\n    $$u = \\frac{m}{\\rho}$$\n\n2.  **内能密度 ($e$)**：\n    总能量密度为 $E = e + E_k$。动能密度为 $E_k = \\frac{1}{2}\\rho u^2$。我们可以将 $u$ 的表达式代入 $E_k$ 的表达式中：\n    $$E_k = \\frac{1}{2}\\rho \\left(\\frac{m}{\\rho}\\right)^2 = \\frac{1}{2}\\rho \\frac{m^2}{\\rho^2} = \\frac{m^2}{2\\rho}$$\n    现在，我们可以从总能量的定义中解出内能密度 $e$：\n    $$e = E - E_k = E - \\frac{m^2}{2\\rho}$$\n\n3.  **压强 ($P$)**：\n    理想气体闭合关系将压强与内能密度关联起来：$P = (\\gamma - 1)e$。代入推导出的 $e$ 的表达式：\n    $$P = (\\gamma - 1)\\left(E - \\frac{m^2}{2\\rho}\\right)$$\n\n4.  **绝热声速 ($c_s$)**：\n    声速的平方由 $c_s^2 = \\frac{\\gamma P}{\\rho}$ 给出。代入 $P$ 的表达式：\n    $$c_s^2 = \\frac{\\gamma}{\\rho} \\left[(\\gamma - 1)\\left(E - \\frac{m^2}{2\\rho}\\right)\\right] = \\frac{\\gamma(\\gamma-1)}{\\rho}\\left(E - \\frac{m^2}{2\\rho}\\right)$$\n    取平方根得到 $c_s$：\n    $$c_s = \\sqrt{\\frac{\\gamma(\\gamma-1)}{\\rho}\\left(E - \\frac{m^2}{2\\rho}\\right)}$$\n\n**数值计算**\n现在我们将提供的数值代入这些推导出的表达式中。\n- 已知：\n  - $\\rho = 1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}$\n  - $m = 3.0 \\times 10^{-17}\\ \\mathrm{g\\,cm^{-2}\\,s^{-1}}$\n  - $E = 1.45 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$\n  - $\\gamma = 5/3$\n\n1.  **计算 $u$**：\n    $$u = \\frac{3.0 \\times 10^{-17}\\ \\mathrm{g\\,cm^{-2}\\,s^{-1}}}{1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}} = 3.0 \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$$\n    保留四位有效数字，结果为 $3.000 \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$。\n\n2.  **计算 $e$**：\n    首先，计算动能密度 $E_k$：\n    $$E_k = \\frac{m^2}{2\\rho} = \\frac{(3.0 \\times 10^{-17}\\ \\mathrm{g\\,cm^{-2}\\,s^{-1}})^2}{2(1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}})} = \\frac{9.0 \\times 10^{-34}\\ \\mathrm{g^2\\,cm^{-4}\\,s^{-2}}}{2.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}} = 4.5 \\times 10^{-10}\\ \\mathrm{g\\,cm^{-1}\\,s^{-2}}$$\n    由于 $1\\ \\mathrm{erg} = 1\\ \\mathrm{g\\,cm^2\\,s^{-2}}$，所以 $1\\ \\mathrm{erg\\,cm^{-3}} = 1\\ \\mathrm{g\\,cm^{-1}\\,s^{-2}}$。\n    $$E_k = 4.5 \\times 10^{-10}\\ \\mathrm{erg\\,cm^{-3}}$$\n    现在，计算 $e$：\n    $$e = E - E_k = 1.45 \\times 10^{-9} - 4.5 \\times 10^{-10} = 1.45 \\times 10^{-9} - 0.45 \\times 10^{-9}$$\n    $$e = 1.0 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$$\n    保留四位有效数字，结果为 $1.000 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$。\n\n3.  **计算 $P$ 并评估可容许性**：\n    $$P = (\\gamma - 1)e = \\left(\\frac{5}{3} - 1\\right)(1.0 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}) = \\frac{2}{3} \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$$\n    $$P \\approx 6.6666... \\times 10^{-10}\\ \\mathrm{erg\\,cm^{-3}}$$\n    物理可容许性所需的条件是 $P > 0$。由于 $P \\approx 6.667 \\times 10^{-10} > 0$，该状态是物理上可容许的。这等价于总能量密度必须超过动能密度的条件，$E > E_k$，这是成立的：$1.45 \\times 10^{-9} > 4.5 \\times 10^{-10}$。\n    四舍五入到四位有效数字，$P \\approx 6.667 \\times 10^{-10}\\ \\mathrm{erg\\,cm^{-3}}$。\n\n4.  **计算 $c_s$**：\n    $$c_s = \\sqrt{\\frac{\\gamma P}{\\rho}} = \\sqrt{\\frac{(5/3)(\\frac{2}{3} \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}})}{1.0 \\times 10^{-24}\\ \\mathrm{g\\,cm^{-3}}}}$$\n    $$c_s = \\sqrt{\\frac{\\frac{10}{9} \\times 10^{-9}}{1.0 \\times 10^{-24}}} = \\sqrt{\\frac{10}{9} \\times 10^{15}}\\ \\mathrm{cm\\,s^{-1}}$$\n    $$c_s = \\sqrt{\\frac{100}{9} \\times 10^{14}}\\ \\mathrm{cm\\,s^{-1}} = \\frac{10}{3} \\times 10^7\\ \\mathrm{cm\\,s^{-1}} \\approx 3.3333... \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$$\n    四舍五入到四位有效数字，$c_s \\approx 3.333 \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$。\n\n最终计算出的四元组 $(u, e, P, c_s)$，四舍五入到四位有效数字，为：\n$u = 3.000 \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$\n$e = 1.000 \\times 10^{-9}\\ \\mathrm{erg\\,cm^{-3}}$\n$P = 6.667 \\times 10^{-10}\\ \\mathrm{erg\\,cm^{-3}}$\n$c_s = 3.333 \\times 10^7\\ \\mathrm{cm\\,s^{-1}}$",
            "answer": "$$\\boxed{\\begin{pmatrix} 3.000 \\times 10^7  1.000 \\times 10^{-9}  6.667 \\times 10^{-10}  3.333 \\times 10^7 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在广阔的宇宙网中，宇宙空洞代表了密度极低的区域。模拟这些近真空区域带来了重大的数值挑战，因为在计算内能时，灾难性的相消误差可能导致非物理的负压。本实践  将指导您实现并测试一种“保正性”重构格式，这是一种确保宇宙学模拟物理可靠性所必需的稳健技术。",
            "id": "3495161",
            "problem": "考虑在共动坐标中的一维理想宇宙流体，其由可压缩气体的欧拉方程和伽马律物态方程（EOS）建模。原始变量是共动质量密度 $\\rho$、本动速度 $u$ 和热压强 $P$。守恒变量由 $D=\\rho$、$S=\\rho u$ 和总共动能量密度 $E$ 定义，其中 $E$ 包括内能和动能的贡献。理想气体的伽马律物态方程为 $P=(\\gamma-1)U$，其中 $U$ 是内能密度，$\\gamma$ 是绝热指数。在欧拉系统中，守恒的总能量密度满足 $E=U+\\frac{1}{2}\\rho u^2$。\n\n在数值宇宙学中，由于宇宙空洞的膨胀，可能会形成近真空区域，其特征通常是密度对比度 $\\delta$ 趋于 $-1$ 的极端负值，其中 $\\delta$ 定义为 $\\delta = (\\rho - \\bar{\\rho})/\\bar{\\rho}$，$\\bar{\\rho}$ 是背景密度。在这种情况下，从守恒变量稳健地恢复原始变量必须确保 $\\rho>0$ 和 $P>0$，即使在计算 $E - \\frac{1}{2}\\rho u^2$ 时存在极端的舍入和抵消误差。\n\n从上述基本定义和理想气体的伽马律物态方程出发，推导一个从守恒变量 $(D,S,E)$ 到原始变量 $(\\rho,u,P)$ 的保持正性的原始变量恢复映射，该映射要能保证 $\\rho$ 和 $P$ 严格为正，即使在数值伪影导致内能 $U$ 为非正值的情况下也是如此。在无量纲代码单位下进行计算：设置 $\\bar{\\rho}=1$ 并将所有量视为无量纲。假设为一维流，并采用绝热指数 $\\gamma = 5/3$。设密度下限为 $\\rho_{\\min}=10^{-12}$，压强下限为 $P_{\\min}=10^{-12}$。\n\n你的程序必须实现以下恢复逻辑，并通过你的推导证明其合理性：\n- 计算 $\\rho = \\max(D,\\rho_{\\min})$。\n- 计算 $u = S/\\rho$。\n- 计算动能密度 $K = \\frac{1}{2}\\rho u^2$ 和候选内能密度 $U^\\ast = E - K$。\n- 如果 $U^\\ast \\le \\frac{P_{\\min}}{\\gamma-1}$，则用 $U = \\frac{P_{\\min}}{\\gamma-1}$ 替换 $U^\\ast$，并将 $E$ 重置为 $E = U + K$；否则，设 $U=U^\\ast$。\n- 计算 $P = (\\gamma-1)U$。\n\n使用背景密度 $\\bar{\\rho}=1$，通过以下方式为给定的密度对比度 $\\delta$、速度 $u$ 和比内能 $e$（单位质量的内能）构建守恒变量 $D$、$S$ 和 $E$：\n- $\\rho_{\\mathrm{input}} = \\bar{\\rho}(1+\\delta)$,\n- $D = \\rho_{\\mathrm{input}}$,\n- $S = D \\, u$,\n- $E = D \\, e + \\frac{1}{2} D \\, u^2$.\n\n请注意，由于在极端空洞中存在严重的抵消误差，$e$ 可能为零或略为负值，这代表了近真空机器精度范围内可能出现的数值伪影；恢复过程应保持稳健并确保 $P>0$。\n\n测试套件：\n实现恢复过程，并在以下五个测试用例上进行评估，每个用例以元组 $(\\delta, u, e)$ 的形式提供：\n1. $(\\delta, u, e) = (-0.9, 0.0, 10^{-6})$。\n2. $(\\delta, u, e) = (-1 + 10^{-12}, 0.0, 10^{-24})$。\n3. $(\\delta, u, e) = (-0.999999999999, 10^{-3}, 10^{-30})$。\n4. $(\\delta, u, e) = (-0.99, 10.0, 0.0)$。\n5. $(\\delta, u, e) = (-0.999, 1.0, -10^{-16})$。\n\n所有量都是无量纲的。对于每个用例，按照上述方法构建 $(D,S,E)$，使用保持正性的映射恢复 $(\\rho,u,P)$，并验证 $\\rho$ 和 $P$ 的严格正性。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个结果都是一个布尔值，表示对于相应的测试用例（按上述顺序列出），恢复的 $\\rho$ 和 $P$ 是否均为严格正值，例如：\"[True,True,False,...]\"。",
            "solution": "我们考虑在共动坐标系中的一种理想宇宙流体，其原始变量为 $(\\rho,u,P)$，守恒变量为 $(D,S,E)$。伽马律物态方程 (EOS) 为 $P=(\\gamma-1)U$，其中 $U$ 为内能密度。总能量密度为 $E=U+\\frac{1}{2}\\rho u^2$。该流体是一维的，绝热指数为 $\\gamma=5/3$。\n\n其基本依据是欧拉系统的定义和伽马律物态方程。我们的目标是从守恒变量 $(D,S,E)$ 恢复 $(\\rho,u,P)$，同时在 $\\delta\\to -1$ 的近真空区域确保其正性。在宇宙学中，密度对比度 $\\delta$ 为 $\\delta=(\\rho-\\bar{\\rho})/\\bar{\\rho}$，因此在代码单位中给定 $\\bar{\\rho}=1$ 时，输入密度为 $\\rho_{\\mathrm{input}}=1+\\delta$。对于给定的 $(\\delta,u,e)$（其中 $e$ 是单位质量的内能）的测试，构建守恒变量的过程如下：\n$$\nD=\\rho_{\\mathrm{input}},\\quad S=D\\,u,\\quad E=D\\,e+\\frac{1}{2}D\\,u^2.\n$$\n\n从 $(D,S,E)$ 恢复原始变量的过程通过反转定义推导得出：\n1. 根据质量守恒，原始密度为 $D=\\rho$。然而，在近真空区域，为避免非物理的零密度或负密度，会使用数值舍入或模型下限。因此，施加一个密度下限：\n$$\n\\rho = \\max(D,\\rho_{\\min}),\n$$\n在代码单位中，$\\rho_{\\min}=10^{-12}$。这确保了严格正性 $\\rho>0$。\n2. 速度从动量中恢复：\n$$\nu = \\frac{S}{\\rho}.\n$$\n这里使用经过下限处理的 $\\rho$ 来避免除以零。注意 $S$ 是守恒的，所以如果 $\\rho$ 因下限而增加，则 $u$ 会相应减小，这与保持 $S$ 守恒是一致的。\n3. 动能密度由原始变量定义：\n$$\nK = \\frac{1}{2}\\rho u^2.\n$$\n4. 候选内能密度是总能量密度与动能之差：\n$$\nU^\\ast = E - K.\n$$\n在 $\\delta\\to -1$ 的极端空洞中，$D$ 可能非常小，而 $E$ 可能约等于 $K$，因此由于抵消或舍入误差，$U^\\ast$ 可能为非正值，特别是当提供的 $e$ 作为一种可能的数值伪影为零或略为负值时。为确保非负且严格为正的压强，我们强制施加一个压强下限 $P_{\\min}=10^{-12}$ 及其对应的内能下限：\n$$\nU_{\\min} = \\frac{P_{\\min}}{\\gamma-1}.\n$$\n保持正性的规则是：\n$$\nU = \\begin{cases}\nU^\\ast,  \\text{if } U^\\ast > U_{\\min},\\\\\nU_{\\min},  \\text{otherwise}.\n\\end{cases}\n$$\n如果应用了下限，则重置总能量以保持一致性，\n$$\nE \\leftarrow U + K,\n$$\n这样守恒能量在修正后仍然是内能和动能分量的有效总和。\n5. 最后，通过伽马律物态方程恢复压强：\n$$\nP = (\\gamma-1)U.\n$$\n\n这种映射通过密度下限的构造保证了 $\\rho>0$，通过压强下限保证了 $P>0$。这是在数值宇宙学和计算流体动力学中，在极端低密度条件下使用的标准保持正性的原始变量恢复方法。\n\n集成原理的算法设计：\n- 每个测试的输入为 $(\\delta,u,e)$。使用 $\\bar{\\rho}=1$，设置 $D=1+\\delta$，$S=D\\,u$ 和 $E=D\\,e+\\frac{1}{2}D\\,u^2$。\n- 应用恢复映射：\n  - 计算 $\\rho=\\max(D,\\rho_{\\min})$。\n  - 计算 $u=S/\\rho$。\n  - 计算 $K=\\frac{1}{2}\\rho u^2$。\n  - 计算 $U^\\ast=E-K$。\n  - 如果 $U^\\ast\\le U_{\\min}$，则设 $U=U_{\\min}$ 并重置 $E=U+K$，否则设 $U=U^\\ast$。\n  - 计算 $P=(\\gamma-1)U$。\n- 通过严格检查 $(\\rho>0)$ 和 $(P>0)$ 来验证正性。\n- 将正性检查结果聚合为测试套件的布尔值。\n\n测试套件覆盖范围的基本原理：\n- 用例1使用一个强空洞但非极端情况，零速度，以及小的内能，这是一个 $U^\\ast$ 为正的“理想路径”。\n- 用例2探测了 $\\delta$ 非常接近 $-1$ 且内能极小的情况，这依赖于下限值。\n- 用例3结合了极端的 $\\delta$ 和小的非零速度，测试了 $E-K$ 中的抵消误差。\n- 用例4设置 $e=0$ 且 $u$ 相对于密度较大，因此 $E=K$，压强下限必须被激活。\n- 用例5引入了一个略为负值的 $e$，这是一个现实的数值伪影，以确保下限能纠正 $U^\\ast\\le 0$ 的情况。\n\n输出规范：\n生成单行输出：一个用方括号括起来的逗号分隔列表，包含五个布尔值，每个值表示对于按所列顺序的相应测试用例，恢复的 $\\rho$ 和 $P$ 是否都严格为正。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef recover_primitives(D, S, E, gamma, rho_floor, P_floor):\n    \"\"\"\n    Positivity-preserving primitive-variable recovery for 1D gamma-law ideal gas.\n    Inputs:\n        D: conserved density (dimensionless)\n        S: conserved momentum density (dimensionless)\n        E: conserved total energy density (dimensionless)\n        gamma: adiabatic index\n        rho_floor: minimum allowed density\n        P_floor: minimum allowed pressure\n    Returns:\n        rho: recovered density (>0)\n        u: recovered velocity\n        P: recovered pressure (>0)\n    \"\"\"\n    # Density floor\n    rho = max(D, rho_floor)\n\n    # Velocity from momentum and floored density\n    # If rho is extremely small, this keeps u finite given S.\n    u = S / rho\n\n    # Kinetic energy density\n    K = 0.5 * rho * u * u\n\n    # Internal energy candidate\n    U_star = E - K\n\n    # Internal energy floor corresponding to pressure floor\n    U_min = P_floor / (gamma - 1.0)\n\n    if not np.isfinite(U_star) or U_star = U_min:\n        U = U_min\n        # Reset E to keep consistency E = U + K\n        E = U + K\n    else:\n        U = U_star\n\n    # Pressure from EOS\n    P = (gamma - 1.0) * U\n\n    return rho, u, P\n\ndef construct_conserved(delta, u, e, rho_bg=1.0):\n    \"\"\"\n    Construct conserved variables from (delta, u, e) in code units with rho_bg = 1.\n    D = rho_input = rho_bg * (1 + delta)\n    S = D * u\n    E = D * e + 0.5 * D * u^2\n    \"\"\"\n    D = rho_bg * (1.0 + delta)\n    S = D * u\n    E = D * e + 0.5 * D * u * u\n    return D, S, E\n\ndef solve():\n    # Constants in code units\n    gamma = 5.0 / 3.0\n    rho_floor = 1e-12\n    P_floor = 1e-12\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (delta, u, e)\n    test_cases = [\n        (-0.9, 0.0, 1e-6),\n        (-1.0 + 1e-12, 0.0, 1e-24),\n        (-0.999999999999, 1e-3, 1e-30),\n        (-0.99, 10.0, 0.0),\n        (-0.999, 1.0, -1e-16),\n    ]\n\n    results = []\n    for delta, u, e in test_cases:\n        D, S, E = construct_conserved(delta, u, e, rho_bg=1.0)\n        rho, u_rec, P = recover_primitives(D, S, E, gamma, rho_floor, P_floor)\n        # Check strict positivity\n        ok = (rho > 0.0) and (P > 0.0) and np.isfinite(rho) and np.isfinite(P)\n        results.append(ok)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何可靠的数值求解器的基石都是严格的验证。这最后一个实践  将挑战您构建一个完整的一维有限体积求解器，并测试其最基本的属性：总能量守恒。通过将您的代码输出与周期性区域中的解析解和守恒律进行比较，您将学到验证您的实现是否正确捕捉了共动欧拉方程基本物理的批判性技能。",
            "id": "3495173",
            "problem": "实现一个一维有限体积求解器，用于求解在空间平坦的膨胀 Friedmann–Lemaître–Robertson–Walker (FLRW) 背景下，使用共动坐标表示的理想气体欧拉方程。您必须为总共动能量密度设计一个守恒格式，其中明确包含宇宙膨胀功项 $-3 H P$，并在孤立的周期性区域中验证其离散守恒性。推导和算法必须从基本守恒定律和经过充分检验的事实出发，并且您的实现必须严格遵守周期性边界条件和有限体积的守恒性质。\n\n从理想气体的牛顿欧拉方程出发，该方程在共动坐标 $\\boldsymbol{x}$ 下描述。气体具有绝热指数 $\\gamma$，标度因子为 $a(t)$，哈勃参数为 $H(t) \\equiv \\dot{a}(t)/a(t)$，本动速度为 $u(x,t)$，共动质量密度为 $\\rho(x,t)$，共动动量密度为 $m(x,t) \\equiv \\rho u$，共动总能量密度为\n$$\nE(x,t) \\equiv \\rho e + \\tfrac{1}{2} \\rho u^2,\n$$\n其中 $e$ 是比内能。理想气体状态方程关联了共动热压力：\n$$\nP(x,t) = (\\gamma - 1) \\left[E - \\tfrac{1}{2}\\frac{m^2}{\\rho}\\right].\n$$\n在一维空间中，采用周期性边界并忽略自引力，共动欧拉方程组为\n$$\n\\partial_t \\rho + \\frac{1}{a}\\partial_x(\\rho u) = 0,\n$$\n$$\n\\partial_t m + \\frac{1}{a}\\partial_x(\\rho u^2 + P) = - H m,\n$$\n$$\n\\partial_t E + \\frac{1}{a}\\partial_x\\left(u(E+P)\\right) = - 2 H \\left(\\tfrac{1}{2}\\rho u^2\\right) - 3 H P.\n$$\n这些方程源于膨胀背景下的质量、动量和能量守恒，并结合了热力学功 $-P \\nabla \\cdot \\boldsymbol{v}_{\\text{phys}}$，其中对于均匀哈勃流有 $\\nabla \\cdot \\boldsymbol{v}_{\\text{phys}} = 3 H$。\n\n算法目标：\n- 在均匀网格上使用有限体积离散化，并采用单元平均的守恒变量 $U_j \\equiv [\\rho_j, m_j, E_j]$。\n- 使用一种带有波速估计的自洽类黎曼求解器方法，在界面处计算数值通量 $F_{j+1/2}$。理想气体的共动双曲通量为\n$$\nF(U) = \\frac{1}{a}\\begin{bmatrix} \\rho u \\\\ \\rho u^2 + P \\\\ u(E+P) \\end{bmatrix}.\n$$\n- 严格施加周期性边界条件，以便在没有源项的情况下，每个守恒量的离散体积积分在舍入误差范围内保持不变。在有限体积方法中，半离散更新\n$$\n\\frac{d}{dt} U_j = - \\frac{1}{\\Delta x} \\left[ F_{j+1/2} - F_{j-1/2} \\right] + S_j\n$$\n确保在周期性边界下的全局求和中通量能够级数相消，即 $F_{j+1/2}$ 的空间总和等于 $F_{j-1/2}$ 的总和。\n- 包括宇宙膨胀源项\n$$\nS_\\rho = 0,\\quad S_m = - H m,\\quad S_E = - 2 H \\left(\\tfrac{1}{2}\\rho u^2\\right) - 3 H P.\n$$\n- 对于常数 $H$，使用纯膨胀下的已知解析标度关系在一个时间步长内精确积分源项：\n  - $a(t) = a_0 \\exp(H (t - t_0))$,\n  - $m \\propto a^{-1}$，因此 $m_{\\text{new}} = m_{\\text{old}}/c$,\n  - $K \\equiv \\tfrac{1}{2}\\rho u^2 \\propto a^{-2}$，因此 $K_{\\text{new}} = K_{\\text{old}}/c^2$,\n  - $U_{\\text{th}} \\equiv \\rho e \\propto a^{-3(\\gamma-1)}$，因此 $U_{\\text{th,new}} = U_{\\text{th,old}}/c^{3(\\gamma-1)}$,\n  其中 $c \\equiv a_{\\text{new}}/a_{\\text{old}}$。\n- 使用 Strang 分裂：首先使用解析标度关系应用半步源项更新，然后是在中间点冻结 $a$ 的完整双曲步，最后是第二个半步源项更新。\n\n验证目标：\n- 证明当 $H = 0$ 且使用周期性边界时，总共动能量的离散体积积分\n$$\n\\mathcal{E}(t) \\equiv \\int E(x,t)\\,dx,\n$$\n在数值舍入误差范围内是守恒的。\n- 证明对于 $H > 0$ 和均匀初始条件，离散的 $\\mathcal{E}(t)$ 严格按照解析的纯源项标度关系演化。对于 $u = 0$ 的均匀静态气体，这意味着\n$$\n\\mathcal{E}(t) = \\mathcal{E}(0)\\,\\exp\\left(-3(\\gamma-1) H t\\right).\n$$\n- 对于具有恒定初始速度 $u \\neq 0$ 的均匀运动气体，体积积分的总共动能量的精确解析演化为\n$$\n\\mathcal{E}(t) = \\mathcal{U}_{\\text{th}}(0)\\,\\exp\\left(-3(\\gamma-1) H t\\right) + \\mathcal{K}(0)\\,\\exp\\left(-2 H t\\right),\n$$\n其中 $\\mathcal{U}_{\\text{th}}(0)$ 和 $\\mathcal{K}(0)$ 分别是初始时在整个区域上积分的热共动能量密度和动能共动能量密度。\n\n您的程序必须：\n- 在一维空间中实现所述方案，为双曲步使用 Rusanov 通量，采用理想气体状态方程，并针对常数 $H$ 使用精确的源项步长标度关系。\n- 使用以下测试套件，它涵盖了守恒性、解析源项演化和周期性边界的正确性。所有测试的区域长度均为 $L = 1$。所有量均为无量纲。\n  1. 测试 A (正常路径守恒性)：$\\gamma = 5/3$， $H = 0$， $a_0 = 1$， $N_x = 256$，初始条件\n     - $\\rho(x) = 1 + 0.2 \\sin(2\\pi x)$,\n     - $u(x) = 0.3 \\sin(4\\pi x)$,\n     - $P(x) = 1 + 0.1 \\cos(2\\pi x)$.\n     演化至最终时间 $T = 0.1$，Courant–Friedrichs–Lewy (CFL) 数为 $0.4$。输出相对变化量\n     $$\n     \\varepsilon_A \\equiv \\frac{|\\mathcal{E}(T) - \\mathcal{E}(0)|}{\\mathcal{E}(0)}.\n     $$\n  2. 测试 B (均匀静态源项标度)：$\\gamma = 5/3$， $H = 0.01$， $a_0 = 1$，$N_x = 64$，初始条件\n     - $\\rho(x) = 1$,\n     - $u(x) = 0$,\n     - $P(x) = 2$.\n     演化至 $T = 2$，CFL 数为 $0.4$。计算解析期望值\n     $$\n     \\mathcal{E}_{\\text{exp}}(T) = \\mathcal{E}(0)\\,\\exp\\left(-3(\\gamma-1) H T\\right),\n     $$\n     并输出\n     $$\n     \\varepsilon_B \\equiv \\frac{|\\mathcal{E}(T) - \\mathcal{E}_{\\text{exp}}(T)|}{\\mathcal{E}_{\\text{exp}}(T)}.\n     $$\n  3. 测试 C (均匀运动源项标度)：$\\gamma = 5/3$, $H = 0.05$, $a_0 = 1$, $N_x = 64$, 初始条件\n     - $\\rho(x) = 1$,\n     - $u(x) = 0.2$,\n     - $P(x) = 1$.\n     演化至 $T = 2$，CFL 数为 $0.4$。计算解析期望值\n     $$\n     \\mathcal{E}_{\\text{exp}}(T) = \\mathcal{U}_{\\text{th}}(0)\\,\\exp\\left(-3(\\gamma-1) H T\\right) + \\mathcal{K}(0)\\,\\exp\\left(-2 H T\\right),\n     $$\n     其中 $\\mathcal{U}_{\\text{th}}(0) = \\int P/(\\gamma-1)\\,dx$ 且 $\\mathcal{K}(0) = \\int \\tfrac{1}{2}\\rho u^2\\,dx$。输出\n     $$\n     \\varepsilon_C \\equiv \\frac{|\\mathcal{E}(T) - \\mathcal{E}_{\\text{exp}}(T)|}{\\mathcal{E}_{\\text{exp}}(T)}.\n     $$\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC]”），其中每个结果是一个浮点数，按顺序对应于 $[\\varepsilon_A, \\varepsilon_B, \\varepsilon_C]$。\n\n注意：不涉及角度。所有量均为无量纲；不要附加单位。实现完整的算法，并严格按照规定生成所需的单行输出。",
            "solution": "该问题要求实现一个一维有限体积数值求解器，用于求解在膨胀的 Friedmann–Lemaître–Robertson–Walker (FLRW) 宇宙学背景下的理想气体欧拉方程。该求解器必须使用共动坐标，采用守恒的有限体积离散化，通过 Strang 分裂处理宇宙学源项（其中针对常数哈勃参数 $H$ 使用精确的解析更新），并为双曲部分利用 Rusanov 型通量。\n\n在一维空间中，关于共动质量密度 $\\rho$、共动动量密度 $m = \\rho u$ 和共动总能量密度 $E$ 的控制方程如下所示：\n$$\n\\partial_t \\rho + \\frac{1}{a}\\partial_x(\\rho u) = 0\n$$\n$$\n\\partial_t m + \\frac{1}{a}\\partial_x(\\rho u^2 + P) = - H m\n$$\n$$\n\\partial_t E + \\frac{1}{a}\\partial_x\\left(u(E+P)\\right) = - 2 H \\left(\\tfrac{1}{2}\\rho u^2\\right) - 3 H P\n$$\n这些方程可以写成紧凑的守恒矢量形式 $\\partial_t U + \\frac{1}{a}\\partial_x F_{\\text{hydro}}(U) = S(U, H)$，其中：\n- 守恒量状态矢量为 $U = [\\rho, m, E]^T$。\n- 流体动力学通量矢量为 $F_{\\text{hydro}}(U) = [\\rho u, \\rho u^2 + P, u(E+P)]^T$。\n- 宇宙学源项矢量为 $S(U, H) = [0, -H m, -2H K - 3HP]^T$，其中 $K = \\frac{1}{2}\\rho u^2 = \\frac{1}{2}m^2/\\rho$ 是动能密度。\n压力 $P$ 由理想气体状态方程决定：$P = (\\gamma - 1)(E - K)$。\n\n在一个包含 $N_x$ 个单元的均匀网格上采用一种有限体积方法，每个单元的宽度为 $\\Delta x = L/N_x$。状态矢量 $U_j(t)$ 代表 $U(x, t)$ 在单元 $j$ 上的单元平均值。方程的半离散形式为：\n$$\n\\frac{d U_j}{dt} = - \\frac{1}{\\Delta x} \\left( F_{j+1/2} - F_{j-1/2} \\right) + S_j\n$$\n其中 $F_{j+1/2}$ 是单元 $j$ 和 $j+1$ 之间界面上的数值通量，而 $S_j$ 是为单元 $j$ 计算的源项。\n\n从时间 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的演化是使用一个二阶 Strang 分裂格式进行的。这种算子分裂方法将双曲平流部分和源项部分分开处理，这对于处理这些物理过程的不同特性和时间尺度是有效的。更新过程分三步进行：\n$$\nU^{n+1} = \\mathcal{O}_{\\text{src}}(\\Delta t/2) \\circ \\mathcal{O}_{\\text{hyp}}(\\Delta t) \\circ \\mathcal{O}_{\\text{src}}(\\Delta t/2) \\, U^n\n$$\n其中 $\\mathcal{O}_{\\text{src}}(\\delta t)$ 是在仅有源项作用下将状态演化一段时间 $\\delta t$ 的算子，而 $\\mathcal{O}_{\\text{hyp}}(\\Delta t)$ 是双曲部分的算子。\n\n源项步 $\\mathcal{O}_{\\text{src}}(\\delta t)$ 求解常微分方程组 $\\frac{dU}{dt} = S(U, H)$。对于一个常数哈勃参数 $H$，这些方程有基于膨胀宇宙中物理量的标度关系的精确解析解。在一个时间步长 $\\delta t$ 内，标度因子演化为 $a_{\\text{new}} = a_{\\text{old}} \\exp(H \\delta t)$。令 $c = a_{\\text{new}}/a_{\\text{old}} = \\exp(H\\delta t)$。守恒变量按如下方式更新：\n- 共动质量密度 $\\rho$ 在源项作用下是守恒的：$\\rho_{\\text{new}} = \\rho_{\\text{old}}$。\n- 本动速度的标度关系为 $u \\propto a^{-1}$，因此共动动量密度 $m = \\rho u$ 的标度关系为 $m_{\\text{new}} = m_{\\text{old}} / c = m_{\\text{old}} \\exp(-H \\delta t)$。\n- 总能量 $E$ 分解为其动能部分 $K = \\frac{1}{2} m^2/\\rho$ 和热能部分 $U_{\\text{th}} = E - K$。每个部分有不同的标度关系：\n    - $K \\propto a^{-2}$，所以 $K_{\\text{new}} = K_{\\text{old}} / c^2 = K_{\\text{old}} \\exp(-2H \\delta t)$。\n    - $U_{\\text{th}} \\propto a^{-3(\\gamma-1)}$，所以 $U_{\\text{th,new}} = U_{\\text{th,old}} / c^{3(\\gamma-1)} = U_{\\text{th,old}} \\exp(-3(\\gamma-1)H \\delta t)$。\n- 新的总能量被重构为 $E_{\\text{new}} = K_{\\text{new}} + U_{\\text{th,new}}$。\n\n双曲步 $\\mathcal{O}_{\\text{hyp}}(\\Delta t)$ 求解齐次守恒律 $\\partial_t U + \\partial_x F(U) = 0$，其中通量为 $F(U) = \\frac{1}{a} F_{\\text{hydro}}(U)$。根据 Strang 分裂的规定，在整个步骤中，标度因子 $a$ 在其中心点值 $a_{\\text{mid}} = a(t_n + \\Delta t/2) = a_n \\exp(H \\Delta t/2)$ 上保持不变。对此子步骤使用一阶显式欧拉方法：\n$$\nU_{j}^{**} = U_{j}^{*} - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2} - F_{j-1/2} \\right)\n$$\n其中 $U^{*}$ 是第一个半源项步之后的状态。数值通量 $F_{j+1/2}$ 使用 Rusanov (或局部 Lax-Friedrichs) 格式计算。对于界面 $x_{j+1/2}$ 左侧和右侧的状态 $U_L=U_j$ 和 $U_R=U_{j+1}$：\n$$\nF_{j+1/2} = \\frac{1}{2} \\left( F(U_L) + F(U_R) \\right) - \\frac{s_{\\max}}{2} (U_R - U_L)\n$$\n界面处的最大信号速度 $s_{\\max}$ 由通量雅可比矩阵的最大绝对特征值给出：\n$$\ns_{\\max} = \\frac{1}{a_{\\text{mid}}} \\max \\left( |u_L| + c_{s,L}, |u_R| + c_{s,R} \\right)\n$$\n其中 $c_s = \\sqrt{\\gamma P/\\rho}$ 是绝热声速。\n\n周期性边界条件对于验证守恒性质至关重要。它们通过创建 ghost 单元来实现，使得单元 $-1$ 中的状态是单元 $N_x-1$ 的副本，而单元 $N_x$ 中的状态是单元 $0$ 的副本。这确保了所有单元上的通量差之和是一个可以相消为零的级数和，即 $\\sum_{j=0}^{N_x-1} (F_{j+1/2} - F_{j-1/2}) = 0$，从而保证了双曲步中总质量、动量和能量的离散守恒。\n\n时间步长 $\\Delta t$ 被动态调整以满足 Courant–Friedrichs–Lewy (CFL) 稳定性条件：\n$$\n\\Delta t = \\text{CFL} \\times \\frac{\\Delta x}{\\max_j \\left( (|u_j| + c_{s,j})/a \\right)}\n$$\n其中最大值取自域中所有单元，而 $a$ 是完整时间步开始时的标度因子。\n\n该实现通过三个测试案例进行验证：测试 A 检查 $H=0$ 时的能量守恒，此时数值误差应是非守恒的唯一来源。测试 B 和测试 C 通过与均匀初始条件下的精确解析解进行比较，来验证源项积分的正确性，此时双曲更新应为零，且数值解应与解析解在机器精度内匹配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the hydro-solver for the specified test cases.\n    \"\"\"\n\n    class HydroSolver1D:\n        \"\"\"\n        A 1D finite-volume solver for cosmological Euler equations.\n        \"\"\"\n        def __init__(self, Nx, L, gamma, H, a0, CFL, U0):\n            self.Nx = Nx\n            self.L = L\n            self.gamma = gamma\n            self.H = H\n            self.a = float(a0)\n            self.CFL = CFL\n            self.dx = L / Nx\n            self.x = (np.arange(Nx) + 0.5) * self.dx\n            # State vector U is shape (3, Nx) for [rho, m, E]\n            self.U = np.copy(U0)\n            self.t = 0.0\n\n        def get_primitives(self, U):\n            \"\"\"Computes primitive variables [rho, u, P] from conserved state U.\"\"\"\n            rho = U[0]\n            m = U[1]\n            E = U[2]\n            \n            # Floor for density to avoid division by zero\n            rho = np.maximum(rho, 1e-12)\n            \n            u = m / rho\n            \n            # Kinetic energy density\n            K = 0.5 * m**2 / rho\n            \n            # Pressure, with a floor\n            P = (self.gamma - 1) * (E - K)\n            P = np.maximum(P, 1e-12)\n            \n            return rho, u, P\n\n        def get_flux(self, U, a_val):\n            \"\"\"Computes the hyperbolic flux vector F(U).\"\"\"\n            rho, u, P = self.get_primitives(U)\n            E = U[2]\n            \n            F = np.zeros_like(U)\n            F[0] = rho * u\n            F[1] = rho * u**2 + P\n            F[2] = u * (E + P)\n            \n            return F / a_val\n\n        def source_step(self, dt):\n            \"\"\"Applies the analytic source term update over a timestep dt.\"\"\"\n            if self.H == 0.0:\n                return\n\n            rho, m, E = self.U[0], self.U[1], self.U[2]\n            c = np.exp(self.H * dt)\n\n            # Update momentum\n            m_new = m / c\n\n            # Decompose energy and update its components\n            K_old = 0.5 * m**2 / np.maximum(rho, 1e-12)\n            U_th_old = E - K_old\n            \n            K_new = K_old / c**2\n            U_th_new = U_th_old / c**(3 * (self.gamma - 1))\n            \n            E_new = U_th_new + K_new\n\n            # Update state vector and scale factor\n            self.U[1] = m_new\n            self.U[2] = E_new\n            self.a *= c\n\n        def hyperbolic_step(self, dt):\n            \"\"\"Applies the hyperbolic update using a Rusanov flux.\"\"\"\n            # States at cell centers\n            U_c = self.U\n\n            # Reconstruct states at interfaces (first-order) with periodic boundaries\n            # U_L is state at left of interface, U_R is state at right\n            U_L = U_c\n            U_R = np.roll(U_c, -1, axis=1)\n\n            # Primitives for left and right states\n            rho_L, u_L, P_L = self.get_primitives(U_L)\n            rho_R, u_R, P_R = self.get_primitives(U_R)\n\n            # Sound speeds\n            cs_L = np.sqrt(self.gamma * P_L / rho_L)\n            cs_R = np.sqrt(self.gamma * P_R / rho_R)\n\n            # Max signal speed at interfaces (Rusanov wave speed)\n            # self.a is a_mid at this point in the Strang split\n            s_max = (np.maximum(np.abs(u_L) + cs_L, np.abs(u_R) + cs_R)) / self.a\n\n            # Central fluxes\n            F_L = self.get_flux(U_L, self.a)\n            F_R = self.get_flux(U_R, self.a)\n\n            # Rusanov flux at interfaces j+1/2\n            # Note: s_max has shape (Nx,), broadcasting to (3, Nx)\n            F_rusanov = 0.5 * (F_L + F_R) - 0.5 * s_max[:, np.newaxis].T * (U_R - U_L)\n\n            # Finite volume update\n            # F_left_of_cell (flux at j-1/2) is F_rusanov rolled\n            F_left_of_cell = np.roll(F_rusanov, 1, axis=1)\n            self.U -= (dt / self.dx) * (F_rusanov - F_left_of_cell)\n\n        def get_dt(self):\n            \"\"\"Calculates the stable time step dt via CFL condition.\"\"\"\n            rho, u, P = self.get_primitives(self.U)\n            cs = np.sqrt(self.gamma * P / rho)\n            max_speed = np.max((np.abs(u) + cs) / self.a)\n            \n            if max_speed == 0:\n                return 1e-4 # Default for static case\n            \n            return self.CFL * self.dx / max_speed\n\n        def evolve(self, T_final):\n            \"\"\"Evolves the system to final time T_final.\"\"\"\n            while self.t  T_final:\n                dt = self.get_dt()\n                if self.t + dt > T_final:\n                    dt = T_final - self.t\n\n                # Strang splitting\n                # 1. Half source step\n                a_start_step = self.a\n                self.source_step(dt / 2.0)\n                a_mid_step = self.a\n\n                # 2. Full hyperbolic step (self.a is now at t + dt/2)\n                self.hyperbolic_step(dt)\n\n                # 3. Half source step (use a_mid for this step)\n                self.a = a_mid_step\n                self.source_step(dt / 2.0)\n\n                self.t += dt\n\n    test_cases = [\n        # Test A: Conservation for H=0\n        {'name': 'A', 'gamma': 5/3, 'H': 0.0, 'a0': 1.0, 'Nx': 256, 'L': 1.0, 'T': 0.1, 'CFL': 0.4,\n         'ic': {'type': 'sine'}},\n        # Test B: Uniform static gas scaling\n        {'name': 'B', 'gamma': 5/3, 'H': 0.01, 'a0': 1.0, 'Nx': 64, 'L': 1.0, 'T': 2.0, 'CFL': 0.4,\n         'ic': {'type': 'uniform', 'rho': 1.0, 'u': 0.0, 'P': 2.0}},\n        # Test C: Uniform moving gas scaling\n        {'name': 'C', 'gamma': 5/3, 'H': 0.05, 'a0': 1.0, 'Nx': 64, 'L': 1.0, 'T': 2.0, 'CFL': 0.4,\n         'ic': {'type': 'uniform', 'rho': 1.0, 'u': 0.2, 'P': 1.0}},\n    ]\n\n    results = []\n    for params in test_cases:\n        # Set up initial conditions\n        Nx = params['Nx']\n        L = params['L']\n        dx = L / Nx\n        x = (np.arange(Nx) + 0.5) * dx\n        gamma = params['gamma']\n        ic_params = params['ic']\n\n        if ic_params['type'] == 'sine':\n            rho0 = 1.0 + 0.2 * np.sin(2 * np.pi * x)\n            u0 = 0.3 * np.sin(4 * np.pi * x)\n            P0 = 1.0 + 0.1 * np.cos(2 * np.pi * x)\n        else:  # uniform\n            rho0 = np.full(Nx, ic_params['rho'])\n            u0 = np.full(Nx, ic_params['u'])\n            P0 = np.full(Nx, ic_params['P'])\n            \n        m0 = rho0 * u0\n        E0 = P0 / (gamma - 1) + 0.5 * rho0 * u0**2\n        U0 = np.array([rho0, m0, E0])\n\n        total_E0 = np.sum(E0) * dx\n\n        # Initialize and run the solver\n        solver = HydroSolver1D(Nx, L, gamma, params['H'], params['a0'], params['CFL'], U0)\n        solver.evolve(params['T'])\n\n        # Get final state and calculate total energy\n        U_final = solver.U\n        total_E_final = np.sum(U_final[2]) * dx\n\n        # Calculate error metric for the test case\n        if params['name'] == 'A':\n            error = np.abs(total_E_final - total_E0) / np.abs(total_E0)\n            results.append(error)\n        elif params['name'] == 'B':\n            E_expected = total_E0 * np.exp(-3 * (gamma - 1) * params['H'] * params['T'])\n            error = np.abs(total_E_final - E_expected) / np.abs(E_expected)\n            if E_expected == 0: error = 0.0\n            results.append(error)\n        elif params['name'] == 'C':\n            total_U_th0 = np.sum(P0 / (gamma - 1)) * dx\n            total_K0 = np.sum(0.5 * rho0 * u0**2) * dx\n            \n            E_expected = total_U_th0 * np.exp(-3 * (gamma - 1) * params['H'] * params['T']) + \\\n                         total_K0 * np.exp(-2 * params['H'] * params['T'])\n            \n            error = np.abs(total_E_final - E_expected) / np.abs(E_expected)\n            if E_expected == 0: error = 0.0\n            results.append(error)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}