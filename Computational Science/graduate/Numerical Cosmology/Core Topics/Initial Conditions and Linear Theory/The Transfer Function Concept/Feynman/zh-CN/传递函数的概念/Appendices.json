{
    "hands_on_practices": [
        {
            "introduction": "传递函数的物理内涵根植于宇宙的演化历史。本练习将引导您通过第一性原理的推导，将传递函数中最显著的特征——转折尺度，与物质-辐射相等时期的哈勃尺度联系起来。完成这项基础性的分析练习，可以加深您对传递函数形状如何由 $\\Omega_m h^2$ 等基本宇宙学参数决定的理解 。",
            "id": "3499458",
            "problem": "一个空间平坦的 Friedmann–Lemaître–Robertson–Walker (FLRW) 宇宙学模型中充满了非相对论性物质和相对论性组分（光子和有效无质量的中微子），它们现今的密度参数分别用 $\\Omega_{m}$ 和 $\\Omega_{r}$ 表示。线性冷暗物质 (CDM) 物质转移函数 $T(k)$ 描述了由在辐射主导时期进入视界的模式所引起的增长压制的尺度依赖性。对于绝热初始条件，具有共动波数 $k$ 且在辐射主导时期进入哈勃视界的模式，其增长相对于在物质-辐射相等之后进入视界的模式会受到压制，这导致 $T(k)$ 在一个由物质-辐射相等时的视界尺度所决定的特征波数处出现一个拐点。\n\n仅使用用于背景膨胀的 Friedmann 方程、标度关系 $\\rho_{m}\\propto a^{-3}$ 和 $\\rho_{r}\\propto a^{-4}$，以及物质-辐射相等的定义，完成以下任务：\n\n- 从第一性原理出发，论证为什么 $T(k)$ 的拐点尺度与物质-辐射相等时的共动哈勃尺度成正比，并因此与相等波数 $k_{\\mathrm{eq}}$ 成正比。你的论证应从次视界扰动在辐射主导和物质主导时期的物理增长出发，并且不应假设任何关于 $T(k)$ 的特定拟合公式。\n\n- 仅用 $\\Omega_{m}h^{2}$ 和 $\\Omega_{r}h^{2}$ 的组合，推导相等波数 $k_{\\mathrm{eq}}$ 的一个显式的、闭合形式的表达式，其中 $H_{0}=100\\,h\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$。取光速为 $c=299{,}792.458\\,\\mathrm{km\\,s^{-1}}$，并在相等时期忽略空间曲率和暗能量。\n\n将你关于 $k_{\\mathrm{eq}}$ 的最终答案以 $\\mathrm{Mpc}^{-1}$ 为单位，表示为一个仅包含符号 $\\Omega_{m}h^{2}$、$\\Omega_{r}h^{2}$ 和数值常数的单一闭合形式解析表达式。不要进行数值计算，也不要四舍五入。",
            "solution": "问题陈述需经验证。\n\n### 第1步：提取已知条件\n-   **宇宙学模型**：空间平坦的 Friedmann–Lemaître–Robertson–Walker (FLRW) 模型。\n-   **宇宙组分**：非相对论性物质（现今密度参数 $\\Omega_{m}$）和相对论性组分（现今密度参数 $\\Omega_{r}$）。\n-   **动力学**：密度标度关系 $\\rho_{m} \\propto a^{-3}$ 和 $\\rho_{r} \\propto a^{-4}$。\n-   **概念**：线性冷暗物质 (CDM) 物质转移函数 $T(k)$ 在一个特征波数 $k_{\\mathrm{eq}}$ 处有一个拐点，该波数由物质-辐射相等时的视界尺度决定。\n-   **初始条件**：绝热初始条件。\n-   **任务1**：从第一性原理出发，论证为什么 $T(k)$ 的拐点尺度与 $k_{\\mathrm{eq}}$ 成正比。论证必须基于次视界扰动的物理增长。\n-   **任务2**：用 $\\Omega_{m}h^{2}$ 和 $\\Omega_{r}h^{2}$ 推导相等波数 $k_{\\mathrm{eq}}$ 的闭合形式表达式。\n-   **常数与参数**：$H_{0}=100\\,h\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，$c=299{,}792.458\\,\\mathrm{km\\,s^{-1}}$。\n-   **假设**：在物质-辐射相等时期忽略空间曲率（由平坦FLRW模型给出）和暗能量。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于标准的 $\\Lambda$CDM 宇宙学模型，特别是宇宙学扰动增长和结构形成理论。所有概念，如FLRW度规、密度参数、物质-辐射相等和物质转移函数，都是现代物理宇宙学的基石。\n-   **适定性**：问题陈述清晰。它要求进行物理论证和特定的数学推导。所提供的信息对于完成这两项任务是充分且必要的。对于 $k_{\\mathrm{eq}}$ 存在一个唯一的、有意义的解。\n-   **客观性**：问题是用精确、标准和客观的科学语言表述的。没有主观或含糊不清的陈述。\n-   **其他缺陷**：该问题是完整的、一致的、现实的，并且是该领域一个标准的、非平凡的问题。它没有违反任何无效性标准。\n\n### 第3步：结论与行动\n问题是有效的。将提供完整解答。\n\n### 解答\n问题要求两个部分：一是为相等波数 $k_{\\mathrm{eq}}$ 对物质转移函数 $T(k)$ 的重要性提供一个物理论证，二是对 $k_{\\mathrm{eq}}$ 的显式表达式进行推导。\n\n**第一部分：关于拐点尺度的物理论证**\n\n物质转移函数 $T(k)$ 量化了一个具有共动波数 $k$ 的密度扰动从早期宇宙到现今的演化，其增长是相对于一个始终在哈勃视界之外的极大尺度模式而言的。$T(k)$ 的形状由扰动增长的物理过程决定，这关键地取决于一个模式是在共动哈勃视界 $(aH)^{-1}$ 之内还是之外，以及宇宙是由辐射主导还是由物质主导。\n\n一个具有共动波数 $k$ 的密度扰动模式的物理波长为 $\\lambda_{\\mathrm{phys}} = 2\\pi a(t)/k$。当其物理波长与哈勃半径 $H^{-1}$（即时间 $t$ 时宇宙的特征因果尺度）相当时，该模式被称为“进入视界”。因此，进入视界的条件是 $a/k \\sim H^{-1}$，或 $k \\sim aH$。\n\n冷暗物质 (CDM) 密度扰动 $\\delta_{m} \\equiv \\delta\\rho_{m}/\\rho_{m}$ 的增长，受引力不稳定性与宇宙膨胀之间相互作用的支配。次视界模式的线性化方程近似为 $\\ddot{\\delta}_{m} + 2H\\dot{\\delta}_{m} \\approx 4\\pi G \\rho_{m}\\delta_{m}$。\n\n1.  **辐射主导 (RD) 时期 ($a  a_{\\mathrm{eq}}$)**：在此时期，总能量密度由相对论性组分主导，$\\rho \\approx \\rho_r$，因此 Friedmann 方程给出 $H^2 \\propto \\rho_r \\propto a^{-4}$。对于视界深处的物质扰动 ($k \\gg aH$)，膨胀项 $2H\\dot{\\delta}_{m}$ 很大，阻止了有效增长。紧密耦合的光子-重子流体的压力提供了抵抗坍缩的支撑，但不相互作用的冷暗物质只感受到主要由占主导地位的辐射组分产生的被稀释的引力势。结果是冷暗物质扰动只经历非常缓慢的对数增长，这种现象被称为 Mészáros 效应：$\\delta_{m} \\propto \\ln(a)$。\n\n2.  **物质主导 (MD) 时期 ($a > a_{\\mathrm{eq}}$)**：在此时期，非相对论性物质主导能量密度，$\\rho \\approx \\rho_m$，因此 $H^2 \\propto \\rho_m \\propto a^{-3}$。对于次视界模式，引力现在完全有效。源项 $4\\pi G \\rho_m \\delta_m$ 驱动增长，标准解为 $\\delta_{m} \\propto a$。\n\n转移函数的形状源于在不同时间进入视界的模式的不同增长历史：\n\n-   **大尺度模式 ($k \\ll k_{\\mathrm{eq}}$)**：这些模式具有非常长的波长。它们在物质主导时期进入视界，即在尺度因子 $a_{\\mathrm{enter}} > a_{\\mathrm{eq}}$ 时。在进入视界之前，它们作为超视界模式增长。进入视界之后，它们立即开始随尺度因子线性增长，$\\delta_{m} \\propto a$。它们不经历停滞期。我们可以归一化转移函数，使得当 $k \\to 0$ 时，这些模式的 $T(k) \\to 1$。\n\n-   **小尺度模式 ($k \\gg k_{\\mathrm{eq}}$)**：这些模式具有短波长，并在辐射主导时期 ($a_{\\mathrm{enter}}  a_{\\mathrm{eq}}$) 进入视界。一旦进入视界，它们的增长就停滞了，并且在宇宙于 $a_{\\mathrm{eq}}$ 变为物质主导之前只以对数方式进行。在 $a_{\\mathrm{eq}}$ 之后，它们恢复线性增长率，$\\delta_{m} \\propto a$。因为它们在演化过程中经历了一段增长被压制的时期，所以与从未停滞过的大尺度模式相比，它们在现今的最终振幅要小得多。这导致了转移函数的压制，$T(k)  1$。\n\n这两种机制之间的过渡发生在恰好在物质-辐射相等时（$a_{\\mathrm{eq}}$）进入视界的模式上。这类模式的共动波数被定义为相等波数 $k_{\\mathrm{eq}}$，由条件 $k_{\\mathrm{eq}} = a_{\\mathrm{eq}}H(a_{\\mathrm{eq}})$ 给出。因此，这个波数 $k_{\\mathrm{eq}}$ 标志着转移函数的“拐点”或“折断点”。对于 $k  k_{\\mathrm{eq}}$，$T(k)$ 近似为常数，而对于 $k > k_{\\mathrm{eq}}$，$T(k)$ 会减小，对于大的 $k$ 通常表现为 $k^{-2}\\ln(k)$。因此，$T(k)$ 的拐点尺度直接由物质-辐射相等时的共动哈勃尺度（由 $k_{\\mathrm{eq}}$ 代表）设定。\n\n**第二部分：相等波数 $k_{\\mathrm{eq}}$ 的推导**\n\n我们的任务是推导一个用 $\\Omega_{m}h^2$ 和 $\\Omega_{r}h^2$ 表示的 $k_{\\mathrm{eq}}$ 表达式。\n\n相等波数 $k_{\\mathrm{eq}}$ 定义为物质-辐射相等时期 $a_{\\mathrm{eq}}$ 的共动哈勃率：\n$$k_{\\mathrm{eq}} = a_{\\mathrm{eq}} H(a_{\\mathrm{eq}})$$\n\n首先，我们确定相等时的尺度因子 $a_{\\mathrm{eq}}$。相等由条件 $\\rho_{m}(a_{\\mathrm{eq}}) = \\rho_{r}(a_{\\mathrm{eq}})$ 定义。使用给定的标度关系 $\\rho_{m} \\propto a^{-3}$ 和 $\\rho_{r} \\propto a^{-4}$，我们可以用它们在现今（$a_0=1$）的值 $\\rho_{m,0}$ 和 $\\rho_{r,0}$ 来表示密度：\n$$\\rho_{m}(a) = \\rho_{m,0} a^{-3}$$\n$$\\rho_{r}(a) = \\rho_{r,0} a^{-4}$$\n在 $a = a_{\\mathrm{eq}}$ 时，我们有：\n$$\\rho_{m,0} a_{\\mathrm{eq}}^{-3} = \\rho_{r,0} a_{\\mathrm{eq}}^{-4}$$\n解出 $a_{\\mathrm{eq}}$ 可得：\n$$a_{\\mathrm{eq}} = \\frac{\\rho_{r,0}}{\\rho_{m,0}}$$\n使用密度参数的定义 $\\Omega_{x} = \\rho_{x,0} / \\rho_{c,0}$，其中 $\\rho_{c,0}$ 是今天的临界密度，我们可以写出：\n$$a_{\\mathrm{eq}} = \\frac{\\Omega_{r} \\rho_{c,0}}{\\Omega_{m} \\rho_{c,0}} = \\frac{\\Omega_{r}}{\\Omega_{m}}$$\n\n接下来，我们求相等时的哈勃参数 $H(a_{\\mathrm{eq}})$。对于包含物质和辐射的平坦宇宙，Friedmann 方程为：\n$$H^{2}(a) = H_{0}^{2} \\left[ \\Omega_{m}a^{-3} + \\Omega_{r}a^{-4} + \\Omega_{\\Lambda} \\right]$$\n问题陈述要求在相等时期忽略宇宙学常数（暗能量），因为在如此早期的时刻其贡献可以忽略不计（$\\Omega_{\\Lambda}(a_{\\mathrm{eq}}) \\ll \\Omega_m(a_{\\mathrm{eq}}), \\Omega_r(a_{\\mathrm{eq}})$）。\n$$H^{2}(a) = H_{0}^{2} \\left( \\Omega_{m}a^{-3} + \\Omega_{r}a^{-4} \\right)$$\n在 $a=a_{\\mathrm{eq}}$ 时，我们知道 $\\Omega_{m}a_{\\mathrm{eq}}^{-3} = \\Omega_{r}a_{\\mathrm{eq}}^{-4}$。我们可以将其代入 Friedmann 方程：\n$$H^{2}(a_{\\mathrm{eq}}) = H_{0}^{2} \\left( \\Omega_{r}a_{\\mathrm{eq}}^{-4} + \\Omega_{r}a_{\\mathrm{eq}}^{-4} \\right) = 2 H_{0}^{2} \\Omega_{r} a_{\\mathrm{eq}}^{-4}$$\n取平方根，我们得到相等时的哈勃参数：\n$$H(a_{\\mathrm{eq}}) = \\sqrt{2} H_{0} \\sqrt{\\Omega_{r}} a_{\\mathrm{eq}}^{-2}$$\n\n现在我们可以结合这些结果来求 $k_{\\mathrm{eq}}$：\n$$k_{\\mathrm{eq}} = a_{\\mathrm{eq}} H(a_{\\mathrm{eq}}) = a_{\\mathrm{eq}} \\left( \\sqrt{2} H_{0} \\sqrt{\\Omega_{r}} a_{\\mathrm{eq}}^{-2} \\right) = \\frac{\\sqrt{2} H_{0} \\sqrt{\\Omega_{r}}}{a_{\\mathrm{eq}}}$$\n代入我们关于 $a_{\\mathrm{eq}} = \\Omega_{r}/\\Omega_{m}$ 的表达式：\n$$k_{\\mathrm{eq}} = \\frac{\\sqrt{2} H_{0} \\sqrt{\\Omega_{r}}}{\\Omega_{r}/\\Omega_{m}} = \\sqrt{2} H_{0} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\n$H_0$ 的单位是 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$。为了以常规单位 $\\mathrm{Mpc}^{-1}$ 获得 $k_{\\mathrm{eq}}$，我们必须除以光速 $c$：\n$$k_{\\mathrm{eq}} \\left[\\mathrm{Mpc}^{-1}\\right] = \\frac{\\sqrt{2} H_{0}}{c} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\n我们被要求用 $\\Omega_{m}h^{2}$ 和 $\\Omega_{r}h^{2}$ 来表示它。我们代入 $H_{0} = 100\\,h\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$：\n$$k_{\\mathrm{eq}} = \\frac{\\sqrt{2} (100h)}{c} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}} = \\frac{100\\sqrt{2}}{c} \\frac{h \\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\n为了引入所需的参数组合，我们可以将表达式平方，重新整理，然后取平方根。\n$$k_{\\mathrm{eq}}^{2} = \\left(\\frac{100\\sqrt{2}}{c}\\right)^{2} \\frac{h^{2}\\Omega_{m}^{2}}{\\Omega_{r}} = \\frac{2 \\times 100^{2}}{c^{2}} \\frac{h^{2}\\Omega_{m}^{2}}{\\Omega_{r}}$$\n将分数内的分子和分母同乘以 $h^2$：\n$$k_{\\mathrm{eq}}^{2} = \\frac{2 \\times 10000}{c^{2}} \\frac{h^{2}\\Omega_{m}^{2}h^{2}}{\\Omega_{r}h^{2}} = \\frac{20000}{c^{2}} \\frac{(\\Omega_{m}h^{2})^{2}}{\\Omega_{r}h^{2}}$$\n现在，对两边取平方根：\n$$k_{\\mathrm{eq}} = \\sqrt{\\frac{20000}{c^{2}} \\frac{(\\Omega_{m}h^{2})^{2}}{\\Omega_{r}h^{2}}} = \\frac{\\sqrt{20000}}{c} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\n因为 $\\sqrt{20000} = \\sqrt{2 \\times 10000} = 100\\sqrt{2}$，我们得到最终表达式：\n$$k_{\\mathrm{eq}} = \\frac{100\\sqrt{2}}{c} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\n最后，我们代入给定的 $c$ 的数值 $c = 299792.458\\,\\mathrm{km\\,s^{-1}}$，同时按照要求保持宇宙学参数为符号形式。\n$$k_{\\mathrm{eq}} = \\frac{100\\sqrt{2}}{299792.458} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\n单位始终是 $\\mathrm{Mpc}^{-1}$，因为在使用单位为 $\\mathrm{km\\,s^{-1}}$ 的 $c$ 来匹配 $H_0$ 的单位后，前面的系数变为无量纲。",
            "answer": "$$\\boxed{\\frac{100\\sqrt{2}}{299792.458} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}}$$"
        },
        {
            "introduction": "在分析推导之后，我们将通过构建一个简化的数值模型来探索微扰的动力学。本练习要求您将描述多组分流体（光子、重子、暗物质、中微子）演化的线性化方程组转化为一个演化矩阵 $\\mathbf{M}(k)$。通过对该矩阵进行数值对角化，您可以亲手揭示不同尺度下系统的主导模式，从而直观地理解声学振荡和引力不稳定性等物理过程 。",
            "id": "3499511",
            "problem": "你需要构建、分析并数值对角化一个简化的耦合多流体传递模型，该模型捕捉了光子、重子、冷暗物质和中微子的宇宙学扰动的线性演化。你的任务是将在傅里叶空间中由线性化的连续性方程、欧拉方程和泊松方程生成的线性映射形式化为传递算符的概念，为给定的波数构建耦合传递矩阵，并将其主导本征模解释为模式成分的代理。目标是为一组明确定义的波数和耦合参数测试套件生成可复现的定量结果。\n\n从以下基本基础出发，该基础在闵可夫斯基近似下，对于短时间间隔内的傅里叶空间线性扰动有效，其中引力势由泊松方程提供源。对于每个物种索引 $i$，其状态方程参数为 $w_i$，绝热声速为 $c_{s,i}^2$，标量扰动的线性化连续性方程和欧拉方程在傅里叶空间中分别为 $\\,\\delta_i' = - (1+w_i) \\,\\theta_i\\,$ 和 $\\,\\theta_i' = - k^2 \\big(c_{s,i}^2\\,\\delta_i + \\phi\\big) + \\text{drag}_i\\,$，其中 $\\,\\delta_i\\,$ 是密度对比，$\\,\\theta_i\\,$ 是奇速度的散度，$\\,k\\,$ 是共动波数，$\\,\\phi\\,$ 是牛顿引力势。引力势遵循傅里叶空间中的泊松方程 $\\,k^2 \\phi = 4\\pi G a^2 \\sum_i \\rho_i \\,\\delta_i\\,$。假设使用无量纲的归一化单位，使得 $\\,4\\pi G a^2 \\rho_{\\text{tot}} = 1\\,$，因此 $\\,k^2 \\phi = \\sum_i \\Omega_i \\,\\delta_i\\,$，其中 $\\,\\Omega_i \\equiv \\rho_i/\\rho_{\\text{tot}}\\,$。将紧耦合机制中的光子-重子相互作用模型化为光子和重子欧拉方程中形式为 $\\,\\pm \\kappa_{\\gamma b}\\,(\\theta_\\gamma - \\theta_b)\\,$ 的大小相等、方向相反的线性拖曳项，其中 $\\,\\kappa_{\\gamma b}\\,$ 是一个常数耦合系数。通过一个常数因子 $\\,\\beta_\\nu \\in (0,1]\\,$ 来唯象地减少中微子对泊松方程源的贡献，以此来模拟中微子自由流动引起的各向异性应力，即使用 $\\,k^2 \\phi = \\Omega_\\gamma \\delta_\\gamma + \\Omega_b \\delta_b + \\Omega_c \\delta_c + \\beta_\\nu \\Omega_\\nu \\delta_\\nu\\,$。视所有物种对 $\\,\\phi\\,$ 的欧拉响应为相同。\n\n定义状态向量 $\\,\\mathbf{y} \\equiv (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top\\,$。仅使用上述基本关系，推导出显式的线性时间演化系统 $\\,\\mathbf{y}' = \\mathbf{M}(k)\\,\\mathbf{y}\\,$，其中 $\\,\\mathbf{M}(k)\\,$ 是一个依赖于共动波数 $\\,k\\,$ 和下面指定的物理参数的 $\\,8\\times 8\\,$ 实矩阵。在此公式中，小时间步长 $\\,\\Delta \\tau\\,$ 上的短时传递算符为 $\\,\\mathbf{T}(k,\\Delta \\tau) = \\exp\\big(\\mathbf{M}(k)\\,\\Delta \\tau\\big)\\,$，$\\,\\mathbf{M}(k)\\,$ 的本征分解揭示了瞬时简正模，其本征值 $\\,\\lambda\\,$ 通过 $\\,\\Re(\\lambda)\\,$ 编码增长或衰減率，通过 $\\,|\\Im(\\lambda)|\\,$ 编码振荡频率。\n\n采用以下物理上一致且自洽的参数选择，以归一化的无量纲单位表示：\n- 密度分数：$\\,\\Omega_\\gamma = 0.55\\,$, $\\,\\Omega_\\nu = 0.35\\,$, $\\,\\Omega_b = 0.05\\,$, $\\,\\Omega_c = 0.05\\,$, 总和为 $\\,1.0\\,$。\n- 状态方程和绝热声速：光子 $\\,w_\\gamma = 1/3\\,$ 和 $\\,c_{s,\\gamma}^2 = 1/3\\,$；中微子 $\\,w_\\nu = 1/3\\,$ 和 $\\,c_{s,\\nu}^2 = 1/3\\,$；重子 $\\,w_b = 0\\,$ 和 $\\,c_{s,b}^2 = 10^{-6}\\,$；冷暗物质 $\\,w_c = 0\\,$ 和 $\\,c_{s,c}^2 = 0\\,$。\n- 光子-重子耦合系数 $\\,\\kappa_{\\gamma b}\\,$ 按每个测试案例指定。\n- 泊松方程源中的中微子各向异性应力衰减因子：$\\,\\beta_\\nu = 0.8\\,$。\n- 泊松方程源的归一化：$\\,4\\pi G a^2 \\rho_{\\text{tot}} = 1\\,$。\n\n通过结合每个物种的连续性方程和欧拉方程、$\\,\\phi\\,$ 的泊松方程以及光子-重子拖曳项来构建 $\\,\\mathbf{M}(k)\\,$。不要假设或引入任何未从所列基础推导出的 $\\,\\mathbf{M}(k)\\,$ 公式；你的推导必须是明确且有原则的。然后，对于下面列出的每个测试案例，数值对角化 $\\,\\mathbf{M}(k)\\,$ 以获得其本征值和本征向量。将本征值实部最大的本征模确定为瞬时主导模式。对于该主导模式，使用相应归一化本征向量 $\\,\\mathbf{v}\\,$ 的密度对比分量计算以下模式成分分数：\n$$\nf_\\gamma = \\frac{\\Omega_\\gamma\\,|\\delta_\\gamma|^2}{\\Omega_\\gamma\\,|\\delta_\\gamma|^2 + \\Omega_b\\,|\\delta_b|^2 + \\Omega_c\\,|\\delta_c|^2 + \\Omega_\\nu\\,|\\delta_\\nu|^2},\\quad\nf_b = \\frac{\\Omega_b\\,|\\delta_b|^2}{\\cdots},\\quad\nf_c = \\frac{\\Omega_c\\,|\\delta_c|^2}{\\cdots},\\quad\nf_\\nu = \\frac{\\Omega_\\nu\\,|\\delta_\\nu|^2}{\\cdots}.\n$$\n同时记录主导本征值的实部 $\\,\\Re(\\lambda_{\\max})\\,$ 和其虚部的绝对值 $\\,|\\Im(\\lambda_{\\max})|\\,$.\n\n测试套件：\n- 案例 $\\,1\\,$: $\\,k = 10^{-3}\\,$, $\\,\\kappa_{\\gamma b} = 50\\,$.\n- 案例 $\\,2\\,$: $\\,k = 0.5\\,$, $\\,\\kappa_{\\gamma b} = 50\\,$.\n- 案例 $\\,3\\,$: $\\,k = 5.0\\,$, $\\,\\kappa_{\\gamma b} = 50\\,$.\n- 案例 $\\,4\\,$: $\\,k = 0.5\\,$, $\\,\\kappa_{\\gamma b} = 0\\,$.\n\n你的程序必须：\n- 直接根据上述基本定义为每个测试案例构建 $\\,\\mathbf{M}(k)\\,$。\n- 计算 $\\,\\mathbf{M}(k)\\,$ 的本征值和本征向量。\n- 选择具有最大 $\\,\\Re(\\lambda)\\,$ 的本征对。\n- 按定义计算 $\\,\\Re(\\lambda_{\\max})\\,$, $\\,|\\Im(\\lambda_{\\max})|\\,$, 以及 $\\,f_\\gamma, f_b, f_c, f_\\nu\\,$。\n- 将每个测试案例报告的所有六个数字四舍五入到六位小数。\n\n最终输出格式：\n- 你的程序应生成单行输出，包含一个逗号分隔的列表的列表，用方括号括起来，没有空格，每个测试案例按以下顺序排列：$[\\Re(\\lambda_{\\max}),|\\Im(\\lambda_{\\max})|,f_\\gamma,f_b,f_c,f_\\nu]$。对于四个测试案例，总输出必须是 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$ 的形式，位于单行上，每个数字按规定四舍五入到六位小数。不应打印任何其他文本。\n- 不需要物理单位；所有量通过构造都是无量纲的。",
            "solution": "用户提供了一个数值宇宙学领域的问题陈述，要求推导并数值分析一个简化的多流体宇宙学扰动模型。第一步是验证问题。\n\n### 问题验证\n\n**步骤 1：提取给定条件**\n\n问题提供了以下数据和定义：\n- **状态向量**：系统的状态由向量 $\\mathbf{y} \\equiv (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$ 描述，其中 $\\delta_i$ 是密度对比，$\\theta_i$ 是物种 $i \\in \\{\\gamma, b, c, \\nu\\}$（光子、重子、冷暗物质、中微子）的奇速度散度。\n- **演化方程**：状态向量的时间演化由线性系统 $\\mathbf{y}' = \\mathbf{M}(k)\\,\\mathbf{y}$ 给出，其中撇号表示对时间坐标 $\\tau$ 的微分。\n- **控制物理方程**：\n    1.  **连续性方程**：$\\delta_i' = - (1+w_i) \\,\\theta_i$，其中 $w_i$ 是状态方程参数。\n    2.  **欧拉方程**：$\\theta_i' = - k^2 \\big(c_{s,i}^2\\,\\delta_i + \\phi\\big) + \\text{drag}_i$，其中 $k$ 是共动波数，$c_{s,i}^2$ 是绝热声速，$\\phi$ 是牛顿引力势。\n    3.  **泊松方程**：$k^2 \\phi = \\Omega_\\gamma \\delta_\\gamma + \\Omega_b \\delta_b + \\Omega_c \\delta_c + \\beta_\\nu \\Omega_\\nu \\delta_\\nu$，在归一化单位中，$4\\pi G a^2 \\rho_{\\text{tot}} = 1$。$\\Omega_i$ 是密度分数。\n- **相互作用项**：\n    -   紧耦合极限下的光子-重子拖曳：$\\text{drag}_\\gamma = -\\kappa_{\\gamma b}\\,(\\theta_\\gamma - \\theta_b)$ 和 $\\text{drag}_b = +\\kappa_{\\gamma b}\\,(\\theta_\\gamma - \\theta_b)$，其中 $\\text{drag}_c = \\text{drag}_\\nu = 0$。\n- **物理参数**：\n    -   密度分数：$\\Omega_\\gamma = 0.55$, $\\Omega_\\nu = 0.35$, $\\Omega_b = 0.05$, $\\Omega_c = 0.05$。\n    -   状态方程 ($w_i$) 和声速 ($c_{s,i}^2$)：\n        -   光子：$w_\\gamma = 1/3$, $c_{s,\\gamma}^2 = 1/3$。\n        -   中微子：$w_\\nu = 1/3$, $c_{s,\\nu}^2 = 1/3$。\n        -   重子：$w_b = 0$, $c_{s,b}^2 = 10^{-6}$。\n        -   冷暗物质：$w_c = 0$, $c_{s,c}^2 = 0$。\n    -   中微子各向异性应力因子：$\\beta_\\nu = 0.8$。\n- **任务定义**：\n    -   将对应于具有最大实部的本征值 $\\lambda_{\\max}$ 的本征模识别为主导本征模。\n    -   计算模式成分分数：$f_i = (\\Omega_i\\,|\\delta_i|^2) / D$，其中分母为 $D = \\sum_j \\Omega_j\\,|\\delta_j|^2$，对于 $j \\in \\{\\gamma, b, c, \\nu\\}$。$\\delta_j$ 是主导本征向量的分量。\n    -   报告 $\\Re(\\lambda_{\\max})$, $|\\Im(\\lambda_{\\max})|$ 和分数 $f_\\gamma, f_b, f_c, f_\\nu$。\n- **测试套件**：\n    -   案例 1: $k = 10^{-3}$, $\\kappa_{\\gamma b} = 50$。\n    -   案例 2: $k = 0.5$, $\\kappa_{\\gamma b} = 50$。\n    -   案例 3: $k = 5.0$, $\\kappa_{\\gamma b} = 50$。\n    -   案例 4: $k = 0.5$, $\\kappa_{\\gamma b} = 0$。\n\n**步骤 2：使用提取的给定条件进行验证**\n\n对问题进行严格评估：\n1.  **科学依据**：该问题在物理宇宙学原理上有坚实的基础，特别是在线性宇宙学扰动理论方面。所提供的方程是线性化爱因斯坦-玻尔兹曼方程在牛顿规范下的标准（尽管是简化的）形式。物理参数是自洽的（例如，$\\sum \\Omega_i=1$），并代表了一个合理但简化的玩具宇宙。\n2.  **适定性**：该问题是适定的。它要求从一组明确的线性代数和微分方程构建一个矩阵，然后进行标准的本征值分析。所有参数和函数都已明确定义，确保了矩阵 $\\mathbf{M}(k)$ 对于每个测试案例都是唯一确定的。数值任务是线性代数中的标准任务。\n3.  **客观性**：问题以精确、客观和数学化的语言陈述，没有歧义或主观性陈述。\n\n该问题没有表现出验证标准中列出的任何缺陷（例如，科学上不健全、不完整、含糊不清）。这是一个计算物理学中的标准、可形式化的问题。\n\n**步骤 3：结论与行动**\n\n此问题是**有效的**。将提供一个完整、合理的解答。\n\n### 解答\n\n解答需要从提供的基本方程中推导出 $8 \\times 8$ 演化矩阵 $\\mathbf{M}(k)$，然后对一组测试案例进行数值对角化。\n\n**1. 演化矩阵 $\\mathbf{M}(k)$ 的推导**\n\n演化方程为 $\\mathbf{y}' = \\mathbf{M}(k)\\mathbf{y}$。我们需要将 $\\mathbf{y}' = (\\delta_\\gamma', \\theta_\\gamma', \\delta_b', \\theta_b', \\delta_c', \\theta_c', \\delta_\\nu', \\theta_\\nu')^\\top$ 的分量表示为 $\\mathbf{y} = (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$ 分量的线性组合。\n\n设状态向量 $\\mathbf{y}$ 的索引从 $0$ 到 $7$。\n\n**连续性方程：**\n方程 $\\delta_i' = -(1+w_i)\\theta_i$ 决定了 $\\mathbf{y}'$ 的奇数行（即 $\\delta_i'$ 所在的行）。\n-   $\\delta_\\gamma' = -(1+w_\\gamma)\\theta_\\gamma = -(1+1/3)\\theta_\\gamma = -4/3\\,\\theta_\\gamma$。这得出 $\\mathbf{y}_0' = (-4/3)\\mathbf{y}_1$。\n-   $\\delta_b' = -(1+w_b)\\theta_b = -(1+0)\\theta_b = -1\\,\\theta_b$。这得出 $\\mathbf{y}_2' = -1\\,\\mathbf{y}_3$。\n-   $\\delta_c' = -(1+w_c)\\theta_c = -(1+0)\\theta_c = -1\\,\\theta_c$。这得出 $\\mathbf{y}_4' = -1\\,\\mathbf{y}_5$。\n-   $\\delta_\\nu' = -(1+w_\\nu)\\theta_\\nu = -(1+1/3)\\theta_\\nu = -4/3\\,\\theta_\\nu$。这得出 $\\mathbf{y}_6' = (-4/3)\\mathbf{y}_7$。\n\n这些方程填充了矩阵 $\\mathbf{M}(k)$ 的第 $0, 2, 4, 6$ 行。例如，第 $0$ 行为 $[0, -4/3, 0, 0, 0, 0, 0, 0]$。\n\n**欧拉方程：**\n方程 $\\theta_i' = -k^2 c_{s,i}^2\\delta_i - k^2\\phi + \\text{drag}_i$ 决定了 $\\mathbf{y}'$ 的偶数行。我们首先代入泊松方程中引力势 $\\phi$ 的表达式：\n$$ k^2\\phi = \\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n因此，所有欧拉方程共有的项 $-k^2\\phi$ 是 $-(\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu)$。\n\n-   **光子 ($\\theta_\\gamma'$, 第 1 行)：** $\\text{drag}_\\gamma = -\\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b)$。\n    $$ \\theta_\\gamma' = -k^2 c_{s,\\gamma}^2\\delta_\\gamma - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) - \\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b) $$\n    $$ \\theta_\\gamma' = -(k^2 c_{s,\\gamma}^2 + \\Omega_\\gamma)\\delta_\\gamma - \\kappa_{\\gamma b}\\theta_\\gamma - \\Omega_b\\delta_b + \\kappa_{\\gamma b}\\theta_b - \\Omega_c\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **重子 ($\\theta_b'$, 第 3 行)：** $\\text{drag}_b = +\\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b)$。\n    $$ \\theta_b' = -k^2 c_{s,b}^2\\delta_b - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) + \\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b) $$\n    $$ \\theta_b' = -\\Omega_\\gamma\\delta_\\gamma + \\kappa_{\\gamma b}\\theta_\\gamma - (k^2 c_{s,b}^2 + \\Omega_b)\\delta_b - \\kappa_{\\gamma b}\\theta_b - \\Omega_c\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **冷暗物质 ($\\theta_c'$, 第 5 行)：** $\\text{drag}_c = 0$。\n    $$ \\theta_c' = -k^2 c_{s,c}^2\\delta_c - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) $$\n    $$ \\theta_c' = -\\Omega_\\gamma\\delta_\\gamma - \\Omega_b\\delta_b - (k^2 c_{s,c}^2 + \\Omega_c)\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **中微子 ($\\theta_\\nu'$, 第 7 行)：** $\\text{drag}_\\nu = 0$。\n    $$ \\theta_\\nu' = -k^2 c_{s,\\nu}^2\\delta_\\nu - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) $$\n    $$ \\theta_\\nu' = -\\Omega_\\gamma\\delta_\\gamma - \\Omega_b\\delta_b - \\Omega_c\\delta_c - (k^2 c_{s,\\nu}^2 + \\beta_\\nu\\Omega_\\nu)\\delta_\\nu $$\n\n**组装矩阵 $\\mathbf{M}(k)$：**\n综合这些结果，得到 $8 \\times 8$ 矩阵 $\\mathbf{M}(k)$ 如下：\n$$\n\\mathbf{M}(k) =\n\\begin{pmatrix}\n0  -(1+w_\\gamma)  0  0  0  0  0  0 \\\\\n-(k^2 c_{s,\\gamma}^2+\\Omega_\\gamma)  -\\kappa_{\\gamma b}  -\\Omega_b  \\kappa_{\\gamma b}  -\\Omega_c  0  -\\beta_\\nu\\Omega_\\nu  0 \\\\\n0  0  0  -(1+w_b)  0  0  0  0 \\\\\n-\\Omega_\\gamma  \\kappa_{\\gamma b}  -(k^2 c_{s,b}^2+\\Omega_b)  -\\kappa_{\\gamma b}  -\\Omega_c  0  -\\beta_\\nu\\Omega_\\nu  0 \\\\\n0  0  0  0  0  -(1+w_c)  0  0 \\\\\n-\\Omega_\\gamma  0  -\\Omega_b  0  -(k^2 c_{s,c}^2+\\Omega_c)  0  -\\beta_\\nu\\Omega_\\nu  0 \\\\\n0  0  0  0  0  0  0  -(1+w_\\nu) \\\\\n-\\Omega_\\gamma  0  -\\Omega_b  0  -\\Omega_c  0  -(k^2 c_{s,\\nu}^2+\\beta_\\nu\\Omega_\\nu)  0\n\\end{pmatrix}\n$$\n代入给定的参数值：$\\Omega_\\gamma = 0.55$, $\\Omega_\\nu = 0.35$, $\\Omega_b = 0.05$, $\\Omega_c = 0.05$, $w_\\gamma=w_\\nu=1/3$, $w_b=w_c=0$, $c_{s,\\gamma}^2=c_{s,\\nu}^2=1/3$, $c_{s,b}^2 = 10^{-6}$, $c_{s,c}^2 = 0$, 以及 $\\beta_\\nu = 0.8$。\n$$\n\\mathbf{M}(k, \\kappa_{\\gamma b}) =\n\\begin{pmatrix}\n0  -4/3  0  0  0  0  0  0 \\\\\n-(k^2/3 + 0.55)  -\\kappa_{\\gamma b}  -0.05  \\kappa_{\\gamma b}  -0.05  0  -0.28  0 \\\\\n0  0  0  -1  0  0  0  0 \\\\\n-0.55  \\kappa_{\\gamma b}  -(10^{-6}k^2 + 0.05)  -\\kappa_{\\gamma b}  -0.05  0  -0.28  0 \\\\\n0  0  0  0  0  -1  0  0 \\\\\n-0.55  0  -0.05  0  -(0.05)  0  -0.28  0 \\\\\n0  0  0  0  0  0  0  -4/3 \\\\\n-0.55  0  -0.05  0  -0.05  0  -(k^2/3 + 0.28)  0\n\\end{pmatrix}\n$$\n这个矩阵将针对每个测试案例进行构建和对角化。\n\n**2. 数值实现与分析**\n\n对于测试套件中的每一对 $(k, \\kappa_{\\gamma b})$：\n1.  构建数值矩阵 $\\mathbf{M}(k, \\kappa_{\\gamma b})$。\n2.  使用标准的数值库（NumPy）计算 $\\mathbf{M}$ 的本征值 $\\lambda_i$ 和本征向量 $\\mathbf{v}_i$。\n3.  找到具有最大实部的本征值，$\\lambda_{\\max} = \\max_i \\Re(\\lambda_i)$。设其对应的本征向量为 $\\mathbf{v}_{\\max}$。\n4.  计算所需量：$\\Re(\\lambda_{\\max})$ 和 $|\\Im(\\lambda_{\\max})|$。\n5.  从本征向量 $\\mathbf{v}_{\\max} = (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$ 中提取分量。\n6.  计算模式成分分数。分母为 $D = \\Omega_\\gamma|\\delta_\\gamma|^2 + \\Omega_b|\\delta_b|^2 + \\Omega_c|\\delta_c|^2 + \\Omega_\\nu|\\delta_\\nu|^2$。分数为 $f_\\gamma = \\Omega_\\gamma|\\delta_\\gamma|^2/D$, $f_b = \\Omega_b|\\delta_b|^2/D$, $f_c = \\Omega_c|\\delta_c|^2/D$, and $f_\\nu = \\Omega_\\nu|\\delta_\\nu|^2/D$。\n7.  将所有六个结果值四舍五入到六位小数进行报告。\n\n这些步骤的实现见最终答案块。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and diagonalizes the cosmological perturbation evolution matrix M(k)\n    for a simplified multi-fluid model, and computes properties of the dominant eigenmode.\n    \"\"\"\n\n    # Define physical parameters as per problem statement.\n    # Density fractions\n    Omega_g = 0.55  # Photons\n    Omega_n = 0.35  # Neutrinos\n    Omega_b = 0.05  # Baryons\n    Omega_c = 0.05  # Cold Dark Matter\n\n    # Equation of state and sound speeds squared\n    w_g = 1.0 / 3.0\n    cs2_g = 1.0 / 3.0\n    w_n = 1.0 / 3.0\n    cs2_n = 1.0 / 3.0\n    w_b = 0.0\n    cs2_b = 1.0e-6\n    w_c = 0.0\n    cs2_c = 0.0\n    \n    # Neutrino anisotropic stress factor\n    beta_n = 0.8\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (k, kappa_gb)\n        (1.0e-3, 50.0),  # Case 1\n        (0.5, 50.0),    # Case 2\n        (5.0, 50.0),    # Case 3\n        (0.5, 0.0),      # Case 4\n    ]\n\n    # Store results for all cases\n    all_results = []\n\n    for k, kappa_gb in test_cases:\n        # Construct the 8x8 matrix M(k)\n        M = np.zeros((8, 8), dtype=np.float64)\n\n        # Row 0: delta_g' = -(1+w_g)*theta_g\n        M[0, 1] = -(1.0 + w_g)\n\n        # Row 1: theta_g'\n        M[1, 0] = -(k**2 * cs2_g + Omega_g)\n        M[1, 1] = -kappa_gb\n        M[1, 2] = -Omega_b\n        M[1, 3] = kappa_gb\n        M[1, 4] = -Omega_c\n        M[1, 6] = -beta_n * Omega_n\n\n        # Row 2: delta_b' = -(1+w_b)*theta_b\n        M[2, 3] = -(1.0 + w_b)\n\n        # Row 3: theta_b'\n        M[3, 0] = -Omega_g\n        M[3, 1] = kappa_gb\n        M[3, 2] = -(k**2 * cs2_b + Omega_b)\n        M[3, 3] = -kappa_gb\n        M[3, 4] = -Omega_c\n        M[3, 6] = -beta_n * Omega_n\n\n        # Row 4: delta_c' = -(1+w_c)*theta_c\n        M[4, 5] = -(1.0 + w_c)\n\n        # Row 5: theta_c'\n        M[5, 0] = -Omega_g\n        M[5, 2] = -Omega_b\n        M[5, 4] = -(k**2 * cs2_c + Omega_c)\n        M[5, 6] = -beta_n * Omega_n\n\n        # Row 6: delta_n' = -(1+w_n)*theta_n\n        M[6, 7] = -(1.0 + w_n)\n\n        # Row 7: theta_n'\n        M[7, 0] = -Omega_g\n        M[7, 2] = -Omega_b\n        M[7, 4] = -Omega_c\n        M[7, 6] = -(k**2 * cs2_n + beta_n * Omega_n)\n\n        # Diagonalize the matrix M\n        eigenvalues, eigenvectors = np.linalg.eig(M)\n\n        # Find the index of the eigenvalue with the maximal real part\n        max_real_part_idx = np.argmax(eigenvalues.real)\n        \n        # Get the dominant eigenvalue and eigenvector\n        lambda_max = eigenvalues[max_real_part_idx]\n        v_max = eigenvectors[:, max_real_part_idx]\n\n        # Extract real and imaginary parts of the dominant eigenvalue\n        re_lambda_max = lambda_max.real\n        abs_im_lambda_max = np.abs(lambda_max.imag)\n\n        # Extract delta components from the dominant eigenvector\n        # Note: squared modulus of a complex number z is abs(z)**2 in numpy\n        delta_g_sq_mod = np.abs(v_max[0])**2\n        delta_b_sq_mod = np.abs(v_max[2])**2\n        delta_c_sq_mod = np.abs(v_max[4])**2\n        delta_n_sq_mod = np.abs(v_max[6])**2\n\n        # Calculate the denominator for the mode content fractions\n        denominator = (Omega_g * delta_g_sq_mod + \n                       Omega_b * delta_b_sq_mod + \n                       Omega_c * delta_c_sq_mod + \n                       Omega_n * delta_n_sq_mod)\n\n        # Handle potential division by zero, although unlikely for a physical mode\n        if denominator == 0:\n            f_g, f_b, f_c, f_n = 0.0, 0.0, 0.0, 0.0\n        else:\n            # Calculate the mode content fractions\n            f_g = (Omega_g * delta_g_sq_mod) / denominator\n            f_b = (Omega_b * delta_b_sq_mod) / denominator\n            f_c = (Omega_c * delta_c_sq_mod) / denominator\n            f_n = (Omega_n * delta_n_sq_mod) / denominator\n        \n        # Collect the results for the current case\n        case_results = [\n            re_lambda_max,\n            abs_im_lambda_max,\n            f_g,\n            f_b,\n            f_c,\n            f_n\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    # Each number rounded to 6 decimal places, no spaces, list of lists.\n    formatted_cases = []\n    for res in all_results:\n        formatted_res = [f\"{x:.6f}\" for x in res]\n        formatted_cases.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "理论模型最终要接受观测数据的检验，这常常涉及求解逆问题。本练习模拟了从带有噪声的功率谱“观测数据”中恢复传递函数的真实挑战。您将实现一个使用吉洪诺夫正则化（Tikhonov regularization）的反卷积流程，这是一种处理不适定问题的关键技术，能帮助我们从充满噪声的数据中稳定地提取物理信号 。",
            "id": "3499485",
            "problem": "您需要实现一个完整的反卷积流程，使用 Tikhonov 正则化从物质功率谱的模拟观测中推断宇宙学传递函数的平方。出发点是物质功率谱与传递函数之间的线性理论关系：对于每个波数 $k$ 和红移 $z$，物质功率谱 $P(k,z)$可以写成 $P(k,z) = P_{\\rm prim}(k)\\,T^{2}(k,z)$，其中 $P_{\\rm prim}(k)$ 是原初功率谱，$T(k,z)$ 是传递函数。给定一个先验条件 $P_{\\rm prim}(k) \\propto k^{n_s - 4}$，其中 $n_s$ 是标量谱指数。您必须将此逆问题形式化，以从 $P(k,z)$ 的含噪测量中恢复 $T(k,z)$。\n\n请使用以下定义和建模选择来生成一个自洽的模拟数据集，并定义该逆问题：\n\n- 定义一个对数间隔的波数网格，包含 $N_k = 64$ 个点，范围从 $k_{\\min} = 5\\times 10^{-3}$ 到 $k_{\\max} = 1$，单位为任意逆长度单位。由于最终报告的指标是无量纲的，因此不需要精确的物理单位。\n\n- 构造一个物理上合理、平滑、正值且单调的“真实”传递函数如下\n$$\nT_{\\rm true}(k,z) = D(z)\\,T_0(k),\n$$\n其中 $D(z)$ 是线性增长因子，近似为 $D(z) = \\frac{1}{1+z}$，且\n$$\nT_0(k) = \\frac{1}{1 + \\frac{k}{k_0} + \\left(\\frac{k}{k_1}\\right)^2},\n$$\n其中 $k_0 = 0.05$，$k_1 = 0.2$。选择这些常数是为了在保持数值简单的同时，模拟小尺度上功率的定性抑制。\n\n- 采用一个单位振幅的原初先验\n$$\nP_{\\rm prim}(k) = k^{n_s - 4},\n$$\n因此，模拟的“真实”功率谱由下式给出\n$$\nP_{\\rm true}(k,z) = P_{\\rm prim}(k)\\,T_{\\rm true}^2(k,z).\n$$\n\n- 通过向每个 $k$ 区间添加独立的高斯噪声，创建一个含噪观测向量 $y(k;z)$，\n$$\ny(k;z) = P_{\\rm true}(k,z) + \\epsilon(k),\n$$\n其中 $\\epsilon(k) \\sim \\mathcal{N}(0,\\sigma^2(k))$ 且方差是异方差的\n$$\n\\sigma(k) = \\sigma_{\\rm rel}\\,P_{\\rm true}(k,z),\n$$\n其中 $\\sigma_{\\rm rel}$ 是指定的相对噪声幅度。为确保确定性的可复现性，请使用固定的随机种子 $s = 12345$。\n\n- 将反演问题表述为关于未知非负向量 $x(k;z) = T^2(k,z)$ 的问题。令 $A$ 表示对角算子 $A = \\operatorname{diag}(P_{\\rm prim}(k))$，令 $y$ 表示观测数据向量 $y(k;z)$，令 $W$ 表示对角权重算子 $W = \\operatorname{diag}(1/\\sigma(k))$。引入一个平滑算子 $L$ 作为 $k$ 网格内部（未缩放）的二阶有限差分，其作用于 $k$ 索引，使得对于内部索引，有 $(Lx)_i = x_{i-1} - 2 x_i + x_{i+1}$。通过最小化加权的 Tikhonov 正则化目标函数来恢复 $x$：\n$$\nJ(x) = \\lVert W(Ax - y) \\rVert_2^2 + \\lambda^2 \\lVert L x \\rVert_2^2,\n$$\n其中正则化参数 $\\lambda \\ge 0$。求解出 $x$ 后，通过 $T_{\\rm est}(k;z) = \\sqrt{\\max(x(k;z),\\epsilon_x)}$ 恢复传递函数，其中 $\\epsilon_x = 10^{-12}$ 是一个小的非负性下限，以避免浮点数问题。\n\n- 使用 $k$ 网格上的相对均方根误差（无量纲）来量化性能，\n$$\nR = \\sqrt{\\frac{1}{N_k} \\sum_{i=1}^{N_k} \\left(\\frac{T_{\\rm est}(k_i;z) - T_{\\rm true}(k_i;z)}{T_{\\rm true}(k_i;z)}\\right)^2}.\n$$\n\n您的程序必须实现上述完整流程，并为以下每个测试用例计算 $R$。这些测试用例共同构成一个测试套件，用于探究一般情况、无正则化边界、更高红移、带有更强正则化的高噪声，以及不同谱指数的影响：\n\n- 测试用例 1：$(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.05, 10^{-3})$。\n- 测试用例 2：$(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.05, 0)$。\n- 测试用例 3：$(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 1.0, 0.10, 10^{-3})$。\n- 测试用例 4：$(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.20, 10^{-2})$。\n- 测试用例 5：$(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (1.0, 0.0, 0.05, 10^{-1})$。\n\n实现要求：\n\n- 使用 $J(x)$ 最小化子的正规方程，精确求解所提出的 Tikhonov 问题，并假设正则化后的矩阵是满秩的。您必须使用确定性随机种子 $s = 12345$ 来生成噪声，以确保结果可复现。\n\n- 对于每个测试用例，返回一个等于该用例的 $R$ 值的浮点数。您的程序应生成单行输出，其中包含按测试用例顺序列出的结果，形式为用方括号括起来的逗号分隔列表。每个浮点数结果必须精确格式化到小数点后六位。\n\n- 输出中不需要物理单位；所有输出都是无量纲数。\n\n您的最终交付成果必须是一个完整、可运行的程序，该程序实现了此流程并打印所需的单行输出。不允许用户输入或使用外部文件。",
            "solution": "问题陈述已经过验证，被认为是有效的。它提出了一个自洽的、数学上适定的、并有科学依据的逆问题。尽管原初功率谱 $P_{\\rm prim}(k)$ 的解析形式是为本次练习所做的简化，但它在整个问题的自身定义中得到了一致的使用，并且没有以任何会使任务失效的方式违反基本原理。所有必要的数据、模型和参数均已提供，且没有内部矛盾。任务是实现一个 Tikhonov 正则化流程来解决这个逆问题。\n\n问题的核心是从一个含噪的功率谱测量向量 $y(k;z)$ 中推断出传递函数的平方，记为向量 $x(k;z) = T^2(k,z)$。该问题被指定为一个线性逆问题，遵循关系 $y \\approx Ax$，其中 $A$ 是一个代表物理模型的线性算子。\n\n首先，我们生成一个综合的“真实”宇宙及其对应的模拟观测。定义了一个包含 $N_k = 64$ 个波数 $k$ 的对数间隔网格，范围从 $k_{\\min} = 5 \\times 10^{-3}$ 到 $k_{\\max} = 1$。真实的传递函数 $T_{\\rm true}(k,z)$ 构造如下：\n$$\nT_{\\rm true}(k,z) = D(z) \\, T_0(k)\n$$\n其中线性增长因子是 $D(z) = \\frac{1}{1+z}$，基准传递函数由平滑函数给出：\n$$\nT_0(k) = \\frac{1}{1 + \\frac{k}{k_0} + \\left(\\frac{k}{k_1}\\right)^2}\n$$\n其中常数 $k_0 = 0.05$ 和 $k_1 = 0.2$。原初功率谱先验定义为：\n$$\nP_{\\rm prim}(k) = k^{n_s - 4}\n$$\n其中 $n_s$ 是标量谱指数。然后使用线性理论关系合成“真实”的物质功率谱 $P_{\\rm true}(k,z)$：\n$$\nP_{\\rm true}(k,z) = P_{\\rm prim}(k) \\, T_{\\rm true}^2(k,z)\n$$\n最后，通过向真实谱添加异方差高斯噪声来创建含噪观测向量 $y(k;z)$。每个波数区间的噪声 $\\epsilon(k)$ 从正态分布 $\\mathcal{N}(0, \\sigma^2(k))$ 中抽取，其标准差是真实信号的一部分，即 $\\sigma(k) = \\sigma_{\\rm rel} P_{\\rm true}(k,z)$。为保证可复现性，使用了固定的随机种子 $s = 12345$。\n\n逆问题是在给定数据 $y$ 和模型的情况下，找到 $x = T^2(k,z)$ 的最佳估计。这是一个不适定问题，因为 $y$ 中的少量噪声可能导致解 $x$ 中出现大的、非物理的振荡。为解决此问题，采用 Tikhonov 正则化，通过寻找最小化以下目标函数的向量 $x$ 来实现：\n$$\nJ(x) = \\lVert W(Ax - y) \\rVert_2^2 + \\lambda^2 \\lVert Lx \\rVert_2^2\n$$\n该函数由两项组成。第一项 $\\lVert W(Ax - y) \\rVert_2^2$ 是数据保真项。它衡量模型预测 $Ax$ 与观测数据 $y$ 之间的残差平方和，并由噪声方差的倒数加权。算子 $A = \\operatorname{diag}(P_{\\rm prim}(k))$ 代表正演模型，权重算子 $W = \\operatorname{diag}(1/\\sigma(k))$ 确保噪声较小（置信度较高）的数据点对解的贡献更大。第二项 $\\lambda^2 \\lVert Lx \\rVert_2^2$ 是正则化项。它对解 $x$ 施加了平滑性约束。算子 $L$ 是二阶导数的有限差分近似，具体来说，对于离散波数网格的内部索引 $i$，有 $(Lx)_i = x_{i-1} - 2x_i + x_{i+1}$。最小化 $\\lVert Lx \\rVert_2^2$ 会惩罚具有高曲率的解，从而抑制非物理振荡。正则化参数 $\\lambda \\ge 0$ 控制着拟合数据与强制平滑之间的平衡。\n\n为了找到二次目标函数 $J(x)$ 的最小化子，我们计算它关于 $x$ 的梯度并将其设为零：\n$$\n\\nabla_x J(x) = \\nabla_x \\left( (Ax-y)^T W^T W (Ax-y) + \\lambda^2 x^T L^T L x \\right) = 0\n$$\n由于 $W$ 是对角矩阵，$W^T = W$。求导得出：\n$$\n2 A^T W^2 (Ax - y) + 2 \\lambda^2 L^T L x = 0\n$$\n整理各项可得到正规方程，这是一个形如 $\\mathbf{M}x = \\mathbf{b}$ 的标准线性系统：\n$$\n\\left( A^T W^2 A + \\lambda^2 L^T L \\right) x = A^T W^2 y\n$$\n求解此系统以得到 $x$。矩阵 $A^T W^2 A$ 是对角矩阵，其元素为 $(P_{\\rm prim}(k_i)/\\sigma(k_i))^2$。矩阵 $L^T L$ 是一个由离散拉普拉斯算子导出的带状矩阵。对于 $\\lambda > 0$ 的情况，左侧的矩阵保证可逆，从而使问题变得适定。\n\n数值实现过程是为每个测试用例构造这些矩阵。求解该系统以得到向量 $x$，即我们对 $T^2(k,z)$ 的估计。由于传递函数的平方必须为非负，因此应用一个下限：$x_{\\rm est} = \\max(x, \\epsilon_x)$，其中 $\\epsilon_x = 10^{-12}$ 是一个小的正值。然后，通过 $T_{\\rm est}(k,z) = \\sqrt{x_{\\rm est}}$ 恢复估计的传递函数。\n\n恢复的性能通过在波数网格上计算的相对均方根误差 $R$ 来量化：\n$$\nR = \\sqrt{ \\frac{1}{N_k} \\sum_{i=1}^{N_k} \\left( \\frac{T_{\\rm est}(k_i;z) - T_{\\rm true}(k_i;z)}{T_{\\rm true}(k_i;z)} \\right)^2 }\n$$\n以下代码实现了这一完整流程，并为每个指定的测试用例计算 $R$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a Tikhonov regularization pipeline to infer the cosmological\n    transfer function from mock power spectrum data.\n    \"\"\"\n\n    # Define constants from the problem statement.\n    N_k = 64\n    k_min = 5e-3\n    k_max = 1.0\n    k0 = 0.05\n    k1 = 0.2\n    epsilon_x = 1e-12\n    seed = 12345\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (n_s, z, sigma_rel, lambda)\n        (0.965, 0.0, 0.05, 10**-3),\n        (0.965, 0.0, 0.05, 0.0),\n        (0.965, 1.0, 0.10, 10**-3),\n        (0.965, 0.0, 0.20, 10**-2),\n        (1.0, 0.0, 0.05, 10**-1),\n    ]\n\n    results = []\n\n    # Construct the wavenumber grid (same for all cases).\n    k = np.logspace(np.log10(k_min), np.log10(k_max), N_k)\n\n    # Construct the second-order finite-difference operator L (same for all cases).\n    # L has zeros on the first and last rows as it acts on interior points.\n    L = np.zeros((N_k, N_k))\n    for i in range(1, N_k - 1):\n        L[i, i - 1] = 1.0\n        L[i, i] = -2.0\n        L[i, i + 1] = 1.0\n    \n    # Pre-compute L^T L for efficiency.\n    L_T_L = L.T @ L\n\n    # Initialize a single random number generator for deterministic reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Iterate through each test case.\n    for n_s, z, sigma_rel, lam in test_cases:\n        # Step 1: Generate the \"true\" signals.\n        D_z = 1.0 / (1.0 + z)\n        T0_k = 1.0 / (1.0 + k / k0 + (k / k1)**2)\n        T_true = D_z * T0_k\n        \n        P_prim = k**(n_s - 4.0)\n        P_true = P_prim * T_true**2\n\n        # Step 2: Generate the noisy observation vector y.\n        sigma_k = sigma_rel * P_true\n        noise = rng.normal(loc=0.0, scale=sigma_k, size=N_k)\n        y = P_true + noise\n\n        # Step 3: Set up and solve the normal equations for Tikhonov regularization.\n        # The system to solve is (A.T @ W^2 @ A + lambda^2 * L.T @ L) @ x = A.T @ W^2 @ y\n        # A = diag(P_prim), W = diag(1/sigma_k)\n        # We can implement this efficiently without creating full diagonal matrices.\n        \n        # Left-hand side matrix M = A.T @ W^2 @ A + lambda^2 * L.T @ L\n        # A.T @ W^2 @ A is diagonal with entries (P_prim/sigma_k)^2\n        lhs_diag_part = (P_prim / sigma_k)**2\n        M_lhs = np.diag(lhs_diag_part) + lam**2 * L_T_L\n\n        # Right-hand side vector b = A.T @ W^2 @ y\n        # This is a vector with entries P_prim[i] * y[i] / sigma_k[i]^2\n        b_rhs = (P_prim / sigma_k**2) * y\n        \n        # Solve the linear system M @ x = b for x\n        x = np.linalg.solve(M_lhs, b_rhs)\n\n        # Step 4: Recover the estimated transfer function T_est.\n        # Enforce non-negativity with a small floor and take the square root.\n        x_nonneg = np.maximum(x, epsilon_x)\n        T_est = np.sqrt(x_nonneg)\n\n        # Step 5: Quantify performance with the relative RMSE.\n        relative_errors_sq = ((T_est - T_true) / T_true)**2\n        R = np.sqrt(np.mean(relative_errors_sq))\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}