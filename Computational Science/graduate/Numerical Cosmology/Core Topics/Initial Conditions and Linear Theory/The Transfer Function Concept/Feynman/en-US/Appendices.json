{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical simulations, it is crucial to grasp the underlying physics that the transfer function describes. This exercise guides you through a first-principles derivation of the matter-radiation equality scale, $k_{\\text{eq}}$, which sets the characteristic turnover in the matter transfer function. By connecting the growth history of perturbations to the background expansion, you will solidify your physical intuition for why large-scale structure has the shape it does. ",
            "id": "3499458",
            "problem": "A spatially flat Friedmann–Lemaître–Robertson–Walker (FLRW) cosmology is filled with non-relativistic matter and relativistic species (photons and effectively massless neutrinos), with present-day density parameters denoted by $\\Omega_{m}$ and $\\Omega_{r}$, respectively. The linear Cold Dark Matter (CDM) matter transfer function $T(k)$ encodes the scale dependence of the suppression of growth caused by modes that enter the horizon during radiation domination. For adiabatic initial conditions, modes with comoving wavenumber $k$ that enter the Hubble horizon during radiation domination experience suppressed growth relative to modes that enter after matter–radiation equality, leading to a turnover of $T(k)$ at a characteristic wavenumber set by the horizon scale at equality.\n\nUsing only the Friedmann equation for the background expansion, the scalings $\\rho_{m}\\propto a^{-3}$ and $\\rho_{r}\\propto a^{-4}$, and the definition of matter–radiation equality, do the following:\n\n- Starting from first principles, argue why the turnover scale of $T(k)$ is proportional to the comoving Hubble scale at matter–radiation equality, and hence to the equality wavenumber $k_{\\mathrm{eq}}$. Your argument should begin from the physical growth of subhorizon perturbations across radiation and matter domination and should not assume any specific fitting formula for $T(k)$.\n\n- Derive an explicit, closed-form expression for the equality wavenumber $k_{\\mathrm{eq}}$ in terms of the combinations $\\Omega_{m}h^{2}$ and $\\Omega_{r}h^{2}$ only, where $H_{0}=100\\,h\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$. Take the speed of light to be $c=299{,}792.458\\,\\mathrm{km\\,s^{-1}}$ and neglect spatial curvature and dark energy at equality.\n\nExpress your final answer for $k_{\\mathrm{eq}}$ in units of $\\mathrm{Mpc}^{-1}$ as a single, closed-form analytic expression involving only the symbols $\\Omega_{m}h^{2}$, $\\Omega_{r}h^{2}$, and numerical constants. Do not evaluate numerically and do not round.",
            "solution": "The problem asks for two components: a physical argument for the significance of the equality wavenumber $k_{\\mathrm{eq}}$ for the matter transfer function $T(k)$, and a derivation of an explicit expression for $k_{\\mathrm{eq}}$.\n\n**Part 1: Physical Argument for the Turnover Scale**\n\nThe matter transfer function, $T(k)$, quantifies the evolution of a density perturbation with comoving wavenumber $k$ from the early universe to the present, relative to the growth of a mode on very large scales that is always outside the Hubble horizon. The shape of $T(k)$ is determined by the physics of perturbation growth, which depends critically on whether a mode is inside or outside the comoving Hubble horizon, $(aH)^{-1}$, and whether the universe is dominated by radiation or matter.\n\nA density perturbation mode with comoving wavenumber $k$ has a physical wavelength $\\lambda_{\\mathrm{phys}} = 2\\pi a(t)/k$. The mode is said to \"enter the horizon\" when its physical wavelength becomes comparable to the Hubble radius $H^{-1}$, which is the characteristic causal scale of the universe at time $t$. The condition for horizon entry is thus $a/k \\sim H^{-1}$, or $k \\sim aH$.\n\nThe growth of cold dark matter (CDM) density perturbations, $\\delta_{m} \\equiv \\delta\\rho_{m}/\\rho_{m}$, is governed by the interplay between gravitational instability and the expansion of the universe. The linearized equation for subhorizon modes is approximately $\\ddot{\\delta}_{m} + 2H\\dot{\\delta}_{m} \\approx 4\\pi G \\rho_{m}\\delta_{m}$.\n\n1.  **Radiation-Dominated (RD) Era ($a < a_{\\mathrm{eq}}$)**: In this epoch, the total energy density is dominated by relativistic species, $\\rho \\approx \\rho_r$, so the Friedmann equation gives $H^2 \\propto \\rho_r \\propto a^{-4}$. For a matter perturbation deep inside the horizon ($k \\gg aH$), the expansion term $2H\\dot{\\delta}_{m}$ is large and prevents efficient growth. The pressure of the tightly coupled photon-baryon fluid provides support against collapse, but the non-interacting CDM feels only the diluted gravitational potential sourced primarily by the dominant radiation component. The result is that CDM perturbations experience only very slow, logarithmic growth, a phenomenon known as the Mészáros effect: $\\delta_{m} \\propto \\ln(a)$.\n\n2.  **Matter-Dominated (MD) Era ($a > a_{\\mathrm{eq}}$)**: In this epoch, non-relativistic matter dominates the energy density, $\\rho \\approx \\rho_m$, so $H^2 \\propto \\rho_m \\propto a^{-3}$. For subhorizon modes, gravity is now fully effective. The source term $4\\pi G \\rho_m \\delta_m$ drives growth, and the standard solution is $\\delta_{m} \\propto a$.\n\nThe shape of the transfer function arises from the different growth histories of modes that enter the horizon at different times:\n\n-   **Large-scale modes ($k \\ll k_{\\mathrm{eq}}$)**: These modes have very long wavelengths. They enter the horizon during the matter-dominated era, i.e., at a scale factor $a_{\\mathrm{enter}} > a_{\\mathrm{eq}}$. Before horizon entry, they grow as superhorizon modes. After horizon entry, they immediately begin to grow linearly with the scale factor, $\\delta_{m} \\propto a$. They do not experience the period of stagnation. We can normalize the transfer function such that $T(k) \\to 1$ for these modes as $k \\to 0$.\n\n-   **Small-scale modes ($k \\gg k_{\\mathrm{eq}}$)**: These modes have short wavelengths and enter the horizon during the radiation-dominated era ($a_{\\mathrm{enter}} < a_{\\mathrm{eq}}$). Upon entering the horizon, their growth stagnates and proceeds only logarithmically until the universe becomes matter-dominated at $a_{\\mathrm{eq}}$. After $a_{\\mathrm{eq}}$, they resume a linear growth rate, $\\delta_{m} \\propto a$. Because they spent a period of their evolution with suppressed growth, their final amplitude at the present day is significantly smaller compared to the large-scale modes that never stagnated. This leads to a suppression in the transfer function, $T(k) < 1$.\n\nThe transition between these two regimes occurs for modes that enter the horizon precisely at the time of matter-radiation equality, $a_{\\mathrm{eq}}$. The comoving wavenumber for such modes is defined as the equality wavenumber, $k_{\\mathrm{eq}}$, given by the condition $k_{\\mathrm{eq}} = a_{\\mathrm{eq}}H(a_{\\mathrm{eq}})$. This wavenumber, $k_{\\mathrm{eq}}$, therefore marks the \"turnover\" or \"break\" in the transfer function. For $k < k_{\\mathrm{eq}}$, $T(k)$ is approximately constant, while for $k > k_{\\mathrm{eq}}$, $T(k)$ decreases, typically as $k^{-2}\\ln(k)$ for large $k$. Thus, the turnover scale of $T(k)$ is directly set by the comoving Hubble scale at matter-radiation equality, represented by $k_{\\mathrm{eq}}$.\n\n**Part 2: Derivation of the Equality Wavenumber $k_{\\mathrm{eq}}$**\n\nWe are tasked with deriving an expression for $k_{\\mathrm{eq}}$ in terms of $\\Omega_{m}h^2$ and $\\Omega_{r}h^2$.\n\nThe equality wavenumber $k_{\\mathrm{eq}}$ is defined as the comoving Hubble rate at the epoch of matter-radiation equality, $a_{\\mathrm{eq}}$:\n$$k_{\\mathrm{eq}} = a_{\\mathrm{eq}} H(a_{\\mathrm{eq}})$$\n\nFirst, we determine the scale factor at equality, $a_{\\mathrm{eq}}$. Equality is defined by the condition $\\rho_{m}(a_{\\mathrm{eq}}) = \\rho_{r}(a_{\\mathrm{eq}})$. Using the given scalings $\\rho_{m} \\propto a^{-3}$ and $\\rho_{r} \\propto a^{-4}$, we can write the densities in terms of their present-day ($a_0=1$) values, $\\rho_{m,0}$ and $\\rho_{r,0}$:\n$$\\rho_{m}(a) = \\rho_{m,0} a^{-3}$$\n$$\\rho_{r}(a) = \\rho_{r,0} a^{-4}$$\nAt $a = a_{\\mathrm{eq}}$, we have:\n$$\\rho_{m,0} a_{\\mathrm{eq}}^{-3} = \\rho_{r,0} a_{\\mathrm{eq}}^{-4}$$\nSolving for $a_{\\mathrm{eq}}$ gives:\n$$a_{\\mathrm{eq}} = \\frac{\\rho_{r,0}}{\\rho_{m,0}}$$\nUsing the definition of the density parameter $\\Omega_{x} = \\rho_{x,0} / \\rho_{c,0}$, where $\\rho_{c,0}$ is the critical density today, we can write:\n$$a_{\\mathrm{eq}} = \\frac{\\Omega_{r} \\rho_{c,0}}{\\Omega_{m} \\rho_{c,0}} = \\frac{\\Omega_{r}}{\\Omega_{m}}$$\n\nNext, we find the Hubble parameter at equality, $H(a_{\\mathrm{eq}})$. The Friedmann equation for a flat universe with matter and radiation is:\n$$H^{2}(a) = H_{0}^{2} \\left[ \\Omega_{m}a^{-3} + \\Omega_{r}a^{-4} + \\Omega_{\\Lambda} \\right]$$\nThe problem states to neglect the cosmological constant (dark energy) at the epoch of equality, as its contribution is negligible at such early times ($\\Omega_{\\Lambda}(a_{\\mathrm{eq}}) \\ll \\Omega_m(a_{\\mathrm{eq}}), \\Omega_r(a_{\\mathrm{eq}})$).\n$$H^{2}(a) = H_{0}^{2} \\left( \\Omega_{m}a^{-3} + \\Omega_{r}a^{-4} \\right)$$\nAt $a=a_{\\mathrm{eq}}$, we know that $\\Omega_{m}a_{\\mathrm{eq}}^{-3} = \\Omega_{r}a_{\\mathrm{eq}}^{-4}$. We can substitute this into the Friedmann equation:\n$$H^{2}(a_{\\mathrm{eq}}) = H_{0}^{2} \\left( \\Omega_{r}a_{\\mathrm{eq}}^{-4} + \\Omega_{r}a_{\\mathrm{eq}}^{-4} \\right) = 2 H_{0}^{2} \\Omega_{r} a_{\\mathrm{eq}}^{-4}$$\nTaking the square root, we get the Hubble parameter at equality:\n$$H(a_{\\mathrm{eq}}) = \\sqrt{2} H_{0} \\sqrt{\\Omega_{r}} a_{\\mathrm{eq}}^{-2}$$\n\nNow we can combine these results to find $k_{\\mathrm{eq}}$:\n$$k_{\\mathrm{eq}} = a_{\\mathrm{eq}} H(a_{\\mathrm{eq}}) = a_{\\mathrm{eq}} \\left( \\sqrt{2} H_{0} \\sqrt{\\Omega_{r}} a_{\\mathrm{eq}}^{-2} \\right) = \\frac{\\sqrt{2} H_{0} \\sqrt{\\Omega_{r}}}{a_{\\mathrm{eq}}}$$\nSubstituting our expression for $a_{\\mathrm{eq}} = \\Omega_{r}/\\Omega_{m}$:\n$$k_{\\mathrm{eq}} = \\frac{\\sqrt{2} H_{0} \\sqrt{\\Omega_{r}}}{\\Omega_{r}/\\Omega_{m}} = \\sqrt{2} H_{0} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\nThe units of $H_0$ are $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$. To obtain $k_{\\mathrm{eq}}$ in the conventional units of $\\mathrm{Mpc}^{-1}$, we must divide by the speed of light $c$:\n$$k_{\\mathrm{eq}} \\left[\\mathrm{Mpc}^{-1}\\right] = \\frac{\\sqrt{2} H_{0}}{c} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\nWe are asked to express this in terms of $\\Omega_{m}h^{2}$ and $\\Omega_{r}h^{2}$. We substitute $H_{0} = 100\\,h\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$:\n$$k_{\\mathrm{eq}} = \\frac{\\sqrt{2} (100h)}{c} \\frac{\\Omega_{m}}{\\sqrt{\\Omega_{r}}} = \\frac{100\\sqrt{2}}{c} \\frac{h \\Omega_{m}}{\\sqrt{\\Omega_{r}}}$$\nTo introduce the required parameter combinations, we can square the expression, rearrange, and then take the square root.\n$$k_{\\mathrm{eq}}^{2} = \\left(\\frac{100\\sqrt{2}}{c}\\right)^{2} \\frac{h^{2}\\Omega_{m}^{2}}{\\Omega_{r}} = \\frac{2 \\times 100^{2}}{c^{2}} \\frac{h^{2}\\Omega_{m}^{2}}{\\Omega_{r}}$$\nMultiplying the numerator and denominator inside the fraction by $h^2$:\n$$k_{\\mathrm{eq}}^{2} = \\frac{2 \\times 10000}{c^{2}} \\frac{h^{2}\\Omega_{m}^{2}h^{2}}{\\Omega_{r}h^{2}} = \\frac{20000}{c^{2}} \\frac{(\\Omega_{m}h^{2})^{2}}{\\Omega_{r}h^{2}}$$\nNow, taking the square root of both sides:\n$$k_{\\mathrm{eq}} = \\sqrt{\\frac{20000}{c^{2}} \\frac{(\\Omega_{m}h^{2})^{2}}{\\Omega_{r}h^{2}}} = \\frac{\\sqrt{20000}}{c} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\nSince $\\sqrt{20000} = \\sqrt{2 \\times 10000} = 100\\sqrt{2}$, we arrive at the final expression:\n$$k_{\\mathrm{eq}} = \\frac{100\\sqrt{2}}{c} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\nTo finalize, we insert the given numerical value for $c = 299792.458\\,\\mathrm{km\\,s^{-1}}$, while keeping the cosmological parameters symbolic as requested.\n$$k_{\\mathrm{eq}} = \\frac{100\\sqrt{2}}{299792.458} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}$$\nThe units are consistently $\\mathrm{Mpc}^{-1}$ as the prefactor becomes dimensionless after using $c$ in $\\mathrm{km\\,s^{-1}}$ to match the units in $H_0$.",
            "answer": "$$\\boxed{\\frac{100\\sqrt{2}}{299792.458} \\frac{\\Omega_{m}h^{2}}{\\sqrt{\\Omega_{r}h^{2}}}}$$"
        },
        {
            "introduction": "This practice transitions from analytical theory to a concrete numerical model, the core of how cosmological perturbations are evolved in modern codes. You will construct the transfer operator as an evolution matrix for a simplified multi-fluid system containing photons, baryons, dark matter, and neutrinos. By diagonalizing this matrix, you will explore the system's normal modes, gaining insight into the rich, coupled dynamics of the cosmic fluid. ",
            "id": "3499511",
            "problem": "You are asked to construct, analyze, and numerically diagonalize a simplified coupled multi-fluid transfer model that captures the linear evolution of cosmological perturbations for photons, baryons, cold dark matter, and neutrinos. Your task is to formalize the notion of a transfer operator as the linear map generated by the linearized continuity, Euler, and Poisson equations in Fourier space, to build the coupled transfer matrix for a given wavenumber, and to interpret the dominant eigenmode as a proxy for mode content. The objective is to produce reproducible, quantitative results for a well-defined test suite of wavenumbers and coupling parameters.\n\nStart from the following fundamental base, valid for linear perturbations in Fourier space under the Minkowski approximation over a short time interval, with the gravitational potential sourced by Poisson’s equation. For each species index $i$ with equation-of-state parameter $w_i$ and adiabatic sound speed $c_{s,i}^2$, the linearized continuity and Euler equations in Fourier space for scalar perturbations are, respectively, $\\delta_i' = - (1+w_i) \\theta_i$ and $\\theta_i' = - k^2 \\big(c_{s,i}^2\\delta_i + \\phi\\big) + \\text{drag}_i$, where $\\delta_i$ is the density contrast, $\\theta_i$ is the divergence of the peculiar velocity, $k$ is the comoving wavenumber, and $\\phi$ is the Newtonian gravitational potential. The gravitational potential obeys Poisson’s equation in Fourier space $k^2 \\phi = 4\\pi G a^2 \\sum_i \\rho_i \\delta_i$. Assume dimensionless normalized units such that $4\\pi G a^2 \\rho_{\\text{tot}} = 1$, so that $k^2 \\phi = \\sum_i \\Omega_i \\delta_i$ with $\\Omega_i \\equiv \\rho_i/\\rho_{\\text{tot}}$. Model the photon–baryon interaction in the tight-coupling regime as an equal-and-opposite linear drag term of the form $\\pm \\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b)$ in the Euler equations for photons and baryons, where $\\kappa_{\\gamma b}$ is a constant coupling coefficient. Model neutrino free-streaming–induced anisotropic stress phenomenologically by reducing their contribution to the Poisson source by a constant factor $\\beta_\\nu \\in (0,1]$, i.e., use $k^2 \\phi = \\Omega_\\gamma \\delta_\\gamma + \\Omega_b \\delta_b + \\Omega_c \\delta_c + \\beta_\\nu \\Omega_\\nu \\delta_\\nu$. Treat the Euler response to $\\phi$ as identical for all species.\n\nDefine the state vector $\\mathbf{y} \\equiv (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$. Using the above fundamental relations only, derive the explicit linear time-evolution system $\\mathbf{y}' = \\mathbf{M}(k)\\mathbf{y}$, where $\\mathbf{M}(k)$ is an $8\\times 8$ real matrix that depends on the comoving wavenumber $k$ and the physical parameters specified below. In this formulation, the short-time transfer operator over a small time step $\\Delta \\tau$ is $\\mathbf{T}(k,\\Delta \\tau) = \\exp\\big(\\mathbf{M}(k)\\Delta \\tau\\big)$, and the eigen-decomposition of $\\mathbf{M}(k)$ reveals the instantaneous normal modes, with eigenvalues $\\lambda$ encoding growth or decay rates via $\\Re(\\lambda)$ and oscillation frequencies via $|\\Im(\\lambda)|$.\n\nAdopt the following physically consistent and self-contained parameter choices, expressed in normalized, dimensionless units:\n- Density fractions: $\\Omega_\\gamma = 0.55$, $\\Omega_\\nu = 0.35$, $\\Omega_b = 0.05$, $\\Omega_c = 0.05$, which sum to $1.0$.\n- Equation-of-state and adiabatic sound speeds: photons $w_\\gamma = 1/3$ and $c_{s,\\gamma}^2 = 1/3$; neutrinos $w_\\nu = 1/3$ and $c_{s,\\nu}^2 = 1/3$; baryons $w_b = 0$ and $c_{s,b}^2 = 10^{-6}$; cold dark matter $w_c = 0$ and $c_{s,c}^2 = 0$.\n- Photon–baryon coupling coefficient $\\kappa_{\\gamma b}$ as specified per test case.\n- Neutrino anisotropic stress attenuation factor in the Poisson source: $\\beta_\\nu = 0.8$.\n- Normalization of the Poisson source: $4\\pi G a^2 \\rho_{\\text{tot}} = 1$.\n\nConstruct $\\mathbf{M}(k)$ by combining the continuity and Euler equations for each species, the Poisson equation for $\\phi$, and the photon–baryon drag. Do not assume or import any formulas for $\\mathbf{M}(k)$ not derivable from the listed base; your derivation must be explicit and principled. Then, for each test case listed below, numerically diagonalize $\\mathbf{M}(k)$ to obtain its eigenvalues and eigenvectors. Identify the dominant instantaneous mode as the eigenmode whose eigenvalue has the maximal real part. For that dominant mode, compute the following mode-content fractions using the density-contrast components of the corresponding normalized eigenvector $\\mathbf{v}$:\n$$\nf_\\gamma = \\frac{\\Omega_\\gamma\\,|\\delta_\\gamma|^2}{\\Omega_\\gamma\\,|\\delta_\\gamma|^2 + \\Omega_b\\,|\\delta_b|^2 + \\Omega_c\\,|\\delta_c|^2 + \\Omega_\\nu\\,|\\delta_\\nu|^2},\\quad\nf_b = \\frac{\\Omega_b\\,|\\delta_b|^2}{\\cdots},\\quad\nf_c = \\frac{\\Omega_c\\,|\\delta_c|^2}{\\cdots},\\quad\nf_\\nu = \\frac{\\Omega_\\nu\\,|\\delta_\\nu|^2}{\\cdots}.\n$$\nAlso record the dominant eigenvalue’s real part $\\Re(\\lambda_{\\max})$ and the absolute value of its imaginary part $|\\Im(\\lambda_{\\max})|$.\n\nTest suite:\n- Case 1: $k = 10^{-3}$, $\\kappa_{\\gamma b} = 50$.\n- Case 2: $k = 0.5$, $\\kappa_{\\gamma b} = 50$.\n- Case 3: $k = 5.0$, $\\kappa_{\\gamma b} = 50$.\n- Case 4: $k = 0.5$, $\\kappa_{\\gamma b} = 0$.\n\nYour program must:\n- Build $\\mathbf{M}(k)$ for each test case directly from the above base definitions.\n- Compute the eigenvalues and eigenvectors of $\\mathbf{M}(k)$.\n- Select the eigenpair with maximal $\\Re(\\lambda)$.\n- Compute $\\Re(\\lambda_{\\max})$, $|\\Im(\\lambda_{\\max})|$, and $f_\\gamma, f_b, f_c, f_\\nu$ as defined.\n- Round all six reported numbers for each test case to six decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, with no spaces, in the following order per test case: $[\\Re(\\lambda_{\\max}),|\\Im(\\lambda_{\\max})|,f_\\gamma,f_b,f_c,f_\\nu]$. For the four test cases, the overall output must be $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$ on a single line, with each number rounded to six decimals as specified. No other text should be printed.\n- No physical units are required; all quantities are dimensionless by construction.",
            "solution": "The solution requires the derivation of the $8 \\times 8$ evolution matrix $\\mathbf{M}(k)$ from the fundamental equations provided, followed by its numerical diagonalization for a set of test cases.\n\n**1. Derivation of the Evolution Matrix $\\mathbf{M}(k)$**\n\nThe evolution equation is $\\mathbf{y}' = \\mathbf{M}(k)\\mathbf{y}$. We need to express the components of $\\mathbf{y}' = (\\delta_\\gamma', \\theta_\\gamma', \\delta_b', \\theta_b', \\delta_c', \\theta_c', \\delta_\\nu', \\theta_\\nu')^\\top$ as a linear combination of the components of $\\mathbf{y} = (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$.\n\nLet the indices of the state vector $\\mathbf{y}$ be $0$ through $7$.\n\n**Continuity Equations:**\nThe equations $\\delta_i' = -(1+w_i)\\theta_i$ determine the odd-numbered rows of $\\mathbf{y}'$ (i.e., rows for $\\delta_i'$).\n-   $\\delta_\\gamma' = -(1+w_\\gamma)\\theta_\\gamma = -(1+1/3)\\theta_\\gamma = -4/3\\,\\theta_\\gamma$. This gives $\\mathbf{y}_0' = (-4/3)\\mathbf{y}_1$.\n-   $\\delta_b' = -(1+w_b)\\theta_b = -(1+0)\\theta_b = -1\\,\\theta_b$. This gives $\\mathbf{y}_2' = -1\\,\\mathbf{y}_3$.\n-   $\\delta_c' = -(1+w_c)\\theta_c = -(1+0)\\theta_c = -1\\,\\theta_c$. This gives $\\mathbf{y}_4' = -1\\,\\mathbf{y}_5$.\n-   $\\delta_\\nu' = -(1+w_\\nu)\\theta_\\nu = -(1+1/3)\\theta_\\nu = -4/3\\,\\theta_\\nu$. This gives $\\mathbf{y}_6' = (-4/3)\\mathbf{y}_7$.\n\nThese equations fill rows $0, 2, 4, 6$ of the matrix $\\mathbf{M}(k)$. For example, row $0$ is $[0, -4/3, 0, 0, 0, 0, 0, 0]$.\n\n**Euler Equations:**\nThe equations $\\theta_i' = -k^2 c_{s,i}^2\\delta_i - k^2\\phi + \\text{drag}_i$ determine the even-numbered rows of $\\mathbf{y}'$. We first substitute the expression for the gravitational potential $\\phi$ from the Poisson equation:\n$$ k^2\\phi = \\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\nSo, the term $-k^2\\phi$ common to all Euler equations is $-(\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu)$.\n\n-   **Photons ($\\theta_\\gamma'$, row 1):** $\\text{drag}_\\gamma = -\\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b)$.\n    $$ \\theta_\\gamma' = -k^2 c_{s,\\gamma}^2\\delta_\\gamma - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) - \\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b) $$\n    $$ \\theta_\\gamma' = -(k^2 c_{s,\\gamma}^2 + \\Omega_\\gamma)\\delta_\\gamma - \\kappa_{\\gamma b}\\theta_\\gamma - \\Omega_b\\delta_b + \\kappa_{\\gamma b}\\theta_b - \\Omega_c\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **Baryons ($\\theta_b'$, row 3):** $\\text{drag}_b = +\\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b)$.\n    $$ \\theta_b' = -k^2 c_{s,b}^2\\delta_b - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) + \\kappa_{\\gamma b}(\\theta_\\gamma - \\theta_b) $$\n    $$ \\theta_b' = -\\Omega_\\gamma\\delta_\\gamma + \\kappa_{\\gamma b}\\theta_\\gamma - (k^2 c_{s,b}^2 + \\Omega_b)\\delta_b - \\kappa_{\\gamma b}\\theta_b - \\Omega_c\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **Cold Dark Matter ($\\theta_c'$, row 5):** $\\text{drag}_c = 0$.\n    $$ \\theta_c' = -k^2 c_{s,c}^2\\delta_c - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) $$\n    $$ \\theta_c' = -\\Omega_\\gamma\\delta_\\gamma - \\Omega_b\\delta_b - (k^2 c_{s,c}^2 + \\Omega_c)\\delta_c - \\beta_\\nu\\Omega_\\nu\\delta_\\nu $$\n\n-   **Neutrinos ($\\theta_\\nu'$, row 7):** $\\text{drag}_\\nu = 0$.\n    $$ \\theta_\\nu' = -k^2 c_{s,\\nu}^2\\delta_\\nu - (\\Omega_\\gamma\\delta_\\gamma + \\Omega_b\\delta_b + \\Omega_c\\delta_c + \\beta_\\nu\\Omega_\\nu\\delta_\\nu) $$\n    $$ \\theta_\\nu' = -\\Omega_\\gamma\\delta_\\gamma - \\Omega_b\\delta_b - \\Omega_c\\delta_c - (k^2 c_{s,\\nu}^2 + \\beta_\\nu\\Omega_\\nu)\\delta_\\nu $$\n\n**Assembling the Matrix $\\mathbf{M}(k)$:**\nCombining these results, the $8 \\times 8$ matrix $\\mathbf{M}(k)$ is:\n$$\n\\mathbf{M}(k) =\n\\begin{pmatrix}\n0 & -(1+w_\\gamma) & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n-(k^2 c_{s,\\gamma}^2+\\Omega_\\gamma) & -\\kappa_{\\gamma b} & -\\Omega_b & \\kappa_{\\gamma b} & -\\Omega_c & 0 & -\\beta_\\nu\\Omega_\\nu & 0 \\\\\n0 & 0 & 0 & -(1+w_b) & 0 & 0 & 0 & 0 \\\\\n-\\Omega_\\gamma & \\kappa_{\\gamma b} & -(k^2 c_{s,b}^2+\\Omega_b) & -\\kappa_{\\gamma b} & -\\Omega_c & 0 & -\\beta_\\nu\\Omega_\\nu & 0 \\\\\n0 & 0 & 0 & 0 & 0 & -(1+w_c) & 0 & 0 \\\\\n-\\Omega_\\gamma & 0 & -\\Omega_b & 0 & -(k^2 c_{s,c}^2+\\Omega_c) & 0 & -\\beta_\\nu\\Omega_\\nu & 0 \\\\\n0 & 0 & 0 & 0 & 0 & 0 & 0 & -(1+w_\\nu) \\\\\n-\\Omega_\\gamma & 0 & -\\Omega_b & 0 & -\\Omega_c & 0 & -(k^2 c_{s,\\nu}^2+\\beta_\\nu\\Omega_\\nu) & 0\n\\end{pmatrix}\n$$\nPlugging in the given parameter values: $\\Omega_\\gamma = 0.55$, $\\Omega_\\nu = 0.35$, $\\Omega_b = 0.05$, $\\Omega_c = 0.05$, $w_\\gamma=w_\\nu=1/3$, $w_b=w_c=0$, $c_{s,\\gamma}^2=c_{s,\\nu}^2=1/3$, $c_{s,b}^2 = 10^{-6}$, $c_{s,c}^2 = 0$, and $\\beta_\\nu = 0.8$.\n$$\n\\mathbf{M}(k, \\kappa_{\\gamma b}) =\n\\begin{pmatrix}\n0 & -4/3 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n-(k^2/3 + 0.55) & -\\kappa_{\\gamma b} & -0.05 & \\kappa_{\\gamma b} & -0.05 & 0 & -0.28 & 0 \\\\\n0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\\\\n-0.55 & \\kappa_{\\gamma b} & -(10^{-6}k^2 + 0.05) & -\\kappa_{\\gamma b} & -0.05 & 0 & -0.28 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 \\\\\n-0.55 & 0 & -0.05 & 0 & -0.05 & 0 & -0.28 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & 0 & 0 & -4/3 \\\\\n-0.55 & 0 & -0.05 & 0 & -0.05 & 0 & -(k^2/3 + 0.28) & 0\n\\end{pmatrix}\n$$\nThis matrix will be constructed and diagonalized for each test case.\n\n**2. Numerical Implementation and Analysis**\n\nFor each pair of $(k, \\kappa_{\\gamma b})$ from the test suite:\n1.  The numerical matrix $\\mathbf{M}(k, \\kappa_{\\gamma b})$ is constructed.\n2.  The eigenvalues $\\lambda_i$ and eigenvectors $\\mathbf{v}_i$ of $\\mathbf{M}$ are computed using a standard numerical library (NumPy).\n3.  The eigenvalue with the largest real part, $\\lambda_{\\max} = \\max_i \\Re(\\lambda_i)$, is identified. Let the corresponding eigenvector be $\\mathbf{v}_{\\max}$.\n4.  The required quantities are calculated: $\\Re(\\lambda_{\\max})$ and $|\\Im(\\lambda_{\\max})|$.\n5.  The components of the eigenvector $\\mathbf{v}_{\\max} = (\\delta_\\gamma, \\theta_\\gamma, \\delta_b, \\theta_b, \\delta_c, \\theta_c, \\delta_\\nu, \\theta_\\nu)^\\top$ are extracted.\n6.  The mode-content fractions are computed. The denominator is $D = \\Omega_\\gamma|\\delta_\\gamma|^2 + \\Omega_b|\\delta_b|^2 + \\Omega_c|\\delta_c|^2 + \\Omega_\\nu|\\delta_\\nu|^2$. The fractions are $f_\\gamma = \\Omega_\\gamma|\\delta_\\gamma|^2/D$, $f_b = \\Omega_b|\\delta_b|^2/D$, $f_c = \\Omega_c|\\delta_c|^2/D$, and $f_\\nu = \\Omega_\\nu|\\delta_\\nu|^2/D$.\n7.  All six resulting values are rounded to six decimal places for reporting.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and diagonalizes the cosmological perturbation evolution matrix M(k)\n    for a simplified multi-fluid model, and computes properties of the dominant eigenmode.\n    \"\"\"\n\n    # Define physical parameters as per problem statement.\n    # Density fractions\n    Omega_g = 0.55  # Photons\n    Omega_n = 0.35  # Neutrinos\n    Omega_b = 0.05  # Baryons\n    Omega_c = 0.05  # Cold Dark Matter\n\n    # Equation of state and sound speeds squared\n    w_g = 1.0 / 3.0\n    cs2_g = 1.0 / 3.0\n    w_n = 1.0 / 3.0\n    cs2_n = 1.0 / 3.0\n    w_b = 0.0\n    cs2_b = 1.0e-6\n    w_c = 0.0\n    cs2_c = 0.0\n    \n    # Neutrino anisotropic stress factor\n    beta_n = 0.8\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (k, kappa_gb)\n        (1.0e-3, 50.0),  # Case 1\n        (0.5, 50.0),    # Case 2\n        (5.0, 50.0),    # Case 3\n        (0.5, 0.0),      # Case 4\n    ]\n\n    # Store results for all cases\n    all_results = []\n\n    for k, kappa_gb in test_cases:\n        # Construct the 8x8 matrix M(k)\n        M = np.zeros((8, 8), dtype=np.float64)\n\n        # Row 0: delta_g' = -(1+w_g)*theta_g\n        M[0, 1] = -(1.0 + w_g)\n\n        # Row 1: theta_g'\n        M[1, 0] = -(k**2 * cs2_g + Omega_g)\n        M[1, 1] = -kappa_gb\n        M[1, 2] = -Omega_b\n        M[1, 3] = kappa_gb\n        M[1, 4] = -Omega_c\n        M[1, 6] = -beta_n * Omega_n\n\n        # Row 2: delta_b' = -(1+w_b)*theta_b\n        M[2, 3] = -(1.0 + w_b)\n\n        # Row 3: theta_b'\n        M[3, 0] = -Omega_g\n        M[3, 1] = kappa_gb\n        M[3, 2] = -(k**2 * cs2_b + Omega_b)\n        M[3, 3] = -kappa_gb\n        M[3, 4] = -Omega_c\n        M[3, 6] = -beta_n * Omega_n\n\n        # Row 4: delta_c' = -(1+w_c)*theta_c\n        M[4, 5] = -(1.0 + w_c)\n\n        # Row 5: theta_c'\n        M[5, 0] = -Omega_g\n        M[5, 2] = -Omega_b\n        M[5, 4] = -(k**2 * cs2_c + Omega_c)\n        M[5, 6] = -beta_n * Omega_n\n\n        # Row 6: delta_n' = -(1+w_n)*theta_n\n        M[6, 7] = -(1.0 + w_n)\n\n        # Row 7: theta_n'\n        M[7, 0] = -Omega_g\n        M[7, 2] = -Omega_b\n        M[7, 4] = -Omega_c\n        M[7, 6] = -(k**2 * cs2_n + beta_n * Omega_n)\n\n        # Diagonalize the matrix M\n        eigenvalues, eigenvectors = np.linalg.eig(M)\n\n        # Find the index of the eigenvalue with the maximal real part\n        max_real_part_idx = np.argmax(eigenvalues.real)\n        \n        # Get the dominant eigenvalue and eigenvector\n        lambda_max = eigenvalues[max_real_part_idx]\n        v_max = eigenvectors[:, max_real_part_idx]\n\n        # Extract real and imaginary parts of the dominant eigenvalue\n        re_lambda_max = lambda_max.real\n        abs_im_lambda_max = np.abs(lambda_max.imag)\n\n        # Extract delta components from the dominant eigenvector\n        # Note: squared modulus of a complex number z is abs(z)**2 in numpy\n        delta_g_sq_mod = np.abs(v_max[0])**2\n        delta_b_sq_mod = np.abs(v_max[2])**2\n        delta_c_sq_mod = np.abs(v_max[4])**2\n        delta_n_sq_mod = np.abs(v_max[6])**2\n\n        # Calculate the denominator for the mode content fractions\n        denominator = (Omega_g * delta_g_sq_mod + \n                       Omega_b * delta_b_sq_mod + \n                       Omega_c * delta_c_sq_mod + \n                       Omega_n * delta_n_sq_mod)\n\n        # Handle potential division by zero, although unlikely for a physical mode\n        if denominator == 0:\n            f_g, f_b, f_c, f_n = 0.0, 0.0, 0.0, 0.0\n        else:\n            # Calculate the mode content fractions\n            f_g = (Omega_g * delta_g_sq_mod) / denominator\n            f_b = (Omega_b * delta_b_sq_mod) / denominator\n            f_c = (Omega_c * delta_c_sq_mod) / denominator\n            f_n = (Omega_n * delta_n_sq_mod) / denominator\n        \n        # Collect the results for the current case\n        case_results = [\n            re_lambda_max,\n            abs_im_lambda_max,\n            f_g,\n            f_b,\n            f_c,\n            f_n\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as per requirements\n    # Each number rounded to 6 decimal places, no spaces, list of lists.\n    formatted_cases = []\n    for res in all_results:\n        formatted_res = [f\"{x:.6f}\" for x in res]\n        formatted_cases.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "The transfer function serves as a crucial link between primordial fluctuations and the observed large-scale structure, but in practice, we must infer it from noisy data. This exercise frames the challenge as an inverse problem, tasking you with implementing a deconvolution pipeline using Tikhonov regularization to recover the transfer function from a mock power spectrum. This hands-on practice introduces you to essential data analysis techniques used to confront cosmological theory with observation. ",
            "id": "3499485",
            "problem": "You are to implement a complete deconvolution pipeline that infers the cosmological transfer function squared from mock observations of the matter power spectrum using Tikhonov regularization. The starting point is the linear-theory relation between the matter power spectrum and the transfer function: for each wavenumber $k$ and redshift $z$, the matter power spectrum $P(k,z)$ can be written as $P_{\\rm prim}(k)\\,T^{2}(k,z)$, where $P_{\\rm prim}(k)$ is the primordial power spectrum and $T(k,z)$ is the transfer function. You are given a prior that $P_{\\rm prim}(k) \\propto k^{n_s - 4}$, where $n_s$ is the scalar spectral index. You must formalize the inverse problem to recover $T(k,z)$ from noisy measurements of $P(k,z)$.\n\nUse the following definitions and modeling choices to generate a self-consistent mock dataset and to define the inverse problem:\n\n- Define a logarithmically spaced wavenumber grid with $N_k = 64$ points from $k_{\\min} = 5\\times 10^{-3}$ to $k_{\\max} = 1$ in arbitrary inverse-length units. The precise physical unit is not required because the final reported metrics are dimensionless.\n\n- Construct a physically plausible, smooth, positive, and monotonic \"true\" transfer function as\n$$\nT_{\\rm true}(k,z) = D(z)\\,T_0(k),\n$$\nwhere $D(z)$ is the linear growth factor approximated as $D(z) = \\frac{1}{1+z}$ and\n$$\nT_0(k) = \\frac{1}{1 + \\frac{k}{k_0} + \\left(\\frac{k}{k_1}\\right)^2},\n$$\nwith $k_0 = 0.05$ and $k_1 = 0.2$. These constants are chosen to mimic the qualitative suppression of power on small scales while remaining numerically simple.\n\n- Adopt a unit-amplitude primordial prior\n$$\nP_{\\rm prim}(k) = k^{n_s - 4},\n$$\nso that the mock \"true\" power spectrum is given by\n$$\nP_{\\rm true}(k,z) = P_{\\rm prim}(k)\\,T_{\\rm true}^2(k,z).\n$$\n\n- Create a noisy observation vector $y(k;z)$ by adding independent Gaussian noise to each $k$-bin,\n$$\ny(k;z) = P_{\\rm true}(k,z) + \\epsilon(k),\n$$\nwith $\\epsilon(k) \\sim \\mathcal{N}(0,\\sigma^2(k))$ and heteroscedastic variance\n$$\n\\sigma(k) = \\sigma_{\\rm rel}\\,P_{\\rm true}(k,z),\n$$\nwhere $\\sigma_{\\rm rel}$ is a specified relative noise amplitude. To ensure deterministic reproducibility, use a fixed random seed $s = 12345$.\n\n- Pose the inversion in terms of the unknown nonnegative vector $x(k;z) = T^2(k,z)$. Let $A$ denote the diagonal operator $A = \\operatorname{diag}(P_{\\rm prim}(k))$, let $y$ denote the observed data vector $y(k;z)$, and let $W$ be the diagonal weighting operator $W = \\operatorname{diag}(1/\\sigma(k))$. Introduce a smoothness operator $L$ as the second-order finite-difference on the $k$-grid interior (unscaled), acting along the $k$-index so that $(Lx)_i = x_{i-1} - 2 x_i + x_{i+1}$ for interior indices. Recover $x$ by minimizing the weighted Tikhonov-regularized objective\n$$\nJ(x) = \\lVert W(Ax - y) \\rVert_2^2 + \\lambda^2 \\lVert L x \\rVert_2^2,\n$$\nwith regularization parameter $\\lambda \\ge 0$. After solving for $x$, recover the transfer function as $T_{\\rm est}(k;z) = \\sqrt{\\max(x(k;z),\\epsilon_x)}$ with a small nonnegativity floor $\\epsilon_x = 10^{-12}$ to avoid floating point issues.\n\n- Quantify performance using the relative root-mean-square error (dimensionless) over the $k$-grid,\n$$\nR = \\sqrt{\\frac{1}{N_k} \\sum_{i=1}^{N_k} \\left(\\frac{T_{\\rm est}(k_i;z) - T_{\\rm true}(k_i;z)}{T_{\\rm true}(k_i;z)}\\right)^2}.\n$$\n\nYour program must implement the full pipeline above and compute $R$ for each of the following test cases, which together form the test suite to probe a general case, a no-regularization boundary, higher redshift, high noise with stronger regularization, and the effect of a different spectral index:\n\n- Test case $1$: $(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.05, 10^{-3})$.\n- Test case $2$: $(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.05, 0)$.\n- Test case $3$: $(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 1.0, 0.10, 10^{-3})$.\n- Test case $4$: $(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (0.965, 0.0, 0.20, 10^{-2})$.\n- Test case $5$: $(n_s, z, \\sigma_{\\rm rel}, \\lambda) = (1.0, 0.0, 0.05, 10^{-1})$.\n\nImplementation requirements:\n\n- Solve the Tikhonov problem exactly as posed using the normal equations for the minimizer of $J(x)$, assuming full-rank matrices after regularization. You must use a deterministic random seed $s = 12345$ for noise generation so that results are reproducible.\n\n- For each test case, return a single floating-point number equal to $R$ for that case. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order of the test cases. Each floating-point result must be formatted to exactly six digits after the decimal point.\n\n- No physical units are required in the output; all outputs are dimensionless numbers.\n\nYour final deliverable must be a complete, runnable program that implements the pipeline and prints the single required output line. No user input or external files are permitted.",
            "solution": "The core of the problem is to infer the squared transfer function, denoted by the vector $x(k;z) = T^2(k,z)$, from a vector of noisy power spectrum measurements, $y(k;z)$. The problem is specified as a linear inverse problem governed by the relationship $y \\approx Ax$, where $A$ is a linear operator representing the physical model.\n\nFirst, we generate a synthetic \"true\" universe and the corresponding mock observations. A logarithmically spaced grid of $N_k = 64$ wavenumbers, $k$, is defined from $k_{\\min} = 5 \\times 10^{-3}$ to $k_{\\max} = 1$. The true transfer function, $T_{\\rm true}(k,z)$, is constructed as:\n$$\nT_{\\rm true}(k,z) = D(z) \\, T_0(k)\n$$\nwhere the linear growth factor is $D(z) = \\frac{1}{1+z}$ and the baseline transfer function is given by the smooth function:\n$$\nT_0(k) = \\frac{1}{1 + \\frac{k}{k_0} + \\left(\\frac{k}{k_1}\\right)^2}\n$$\nwith constants $k_0 = 0.05$ and $k_1 = 0.2$. The primordial power spectrum prior is defined as:\n$$\nP_{\\rm prim}(k) = k^{n_s - 4}\n$$\nwhere $n_s$ is the scalar spectral index. The \"true\" matter power spectrum, $P_{\\rm true}(k,z)$, is then synthesized using the linear-theory relation:\n$$\nP_{\\rm true}(k,z) = P_{\\rm prim}(k) \\, T_{\\rm true}^2(k,z)\n$$\nFinally, a noisy observation vector $y(k;z)$ is created by adding heteroscedastic Gaussian noise to the true spectrum. The noise $\\epsilon(k)$ at each wavenumber bin is drawn from a normal distribution $\\mathcal{N}(0, \\sigma^2(k))$, with the standard deviation being a fraction of the true signal, $\\sigma(k) = \\sigma_{\\rm rel} P_{\\rm true}(k,z)$. A fixed random seed $s = 12345$ is used for reproducibility.\n\nThe inverse problem is to find the best estimate for $x = T^2(k,z)$ given the data $y$ and the model. This is an ill-posed problem, as small amounts of noise in $y$ can lead to large, unphysical oscillations in the solution $x$. Tikhonov regularization is employed to overcome this by finding the vector $x$ that minimizes the following objective function:\n$$\nJ(x) = \\lVert W(Ax - y) \\rVert_2^2 + \\lambda^2 \\lVert Lx \\rVert_2^2\n$$\nThis function consists of two terms. The first, $\\lVert W(Ax - y) \\rVert_2^2$, is the data fidelity term. It measures the sum of squared residuals between the model prediction $Ax$ and the observed data $y$, weighted by the inverse of the noise variance. The operator $A = \\operatorname{diag}(P_{\\rm prim}(k))$ represents the forward model, and the weighting operator $W = \\operatorname{diag}(1/\\sigma(k))$ ensures that data points with smaller noise (higher confidence) contribute more to the solution. The second term, $\\lambda^2 \\lVert Lx \\rVert_2^2$, is the regularization term. It imposes a smoothness constraint on the solution $x$. The operator $L$ is a finite-difference approximation of the second derivative, specifically $(Lx)_i = x_{i-1} - 2x_i + x_{i+1}$ for interior indices $i$ of the discrete wavenumber grid. Minimizing $\\lVert Lx \\rVert_2^2$ penalizes solutions with high curvature, thus suppressing unphysical oscillations. The regularization parameter $\\lambda \\ge 0$ controls the balance between fitting the data and enforcing smoothness.\n\nTo find the minimizer of the quadratic objective function $J(x)$, we compute its gradient with respect to $x$ and set it to zero:\n$$\n\\nabla_x J(x) = \\nabla_x \\left( (Ax-y)^T W^T W (Ax-y) + \\lambda^2 x^T L^T L x \\right) = 0\n$$\nSince $W$ is diagonal, $W^T = W$. The differentiation yields:\n$$\n2 A^T W^2 (Ax - y) + 2 \\lambda^2 L^T L x = 0\n$$\nRearranging the terms gives the normal equations, which is a standard linear system of the form $\\mathbf{M}x = \\mathbf{b}$:\n$$\n\\left( A^T W^2 A + \\lambda^2 L^T L \\right) x = A^T W^2 y\n$$\nThis system is solved for $x$. The matrix $A^T W^2 A$ is diagonal with entries $(P_{\\rm prim}(k_i)/\\sigma(k_i))^2$. The matrix $L^T L$ is a banded matrix derived from the discrete Laplacian. The matrix on the left-hand side is guaranteed to be invertible for $\\lambda > 0$, rendering the problem well-posed.\n\nThe numerical implementation proceeds by constructing these matrices for each test case. The system is solved for the vector $x$, which is our estimate for $T^2(k,z)$. Since the squared transfer function must be non-negative, a floor is applied: $x_{\\rm est} = \\max(x, \\epsilon_x)$, where $\\epsilon_x = 10^{-12}$ is a small positive value. The estimated transfer function is then recovered as $T_{\\rm est}(k,z) = \\sqrt{x_{\\rm est}}$.\n\nThe performance of the recovery is quantified by the relative root-mean-square error, $R$, computed over the wavenumber grid:\n$$\nR = \\sqrt{ \\frac{1}{N_k} \\sum_{i=1}^{N_k} \\left( \\frac{T_{\\rm est}(k_i;z) - T_{\\rm true}(k_i;z)}{T_{\\rm true}(k_i;z)} \\right)^2 }\n$$\nThe provided code implements this full pipeline and calculates $R$ for each of the specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a Tikhonov regularization pipeline to infer the cosmological\n    transfer function from mock power spectrum data.\n    \"\"\"\n\n    # Define constants from the problem statement.\n    N_k = 64\n    k_min = 5e-3\n    k_max = 1.0\n    k0 = 0.05\n    k1 = 0.2\n    epsilon_x = 1e-12\n    seed = 12345\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (n_s, z, sigma_rel, lambda)\n        (0.965, 0.0, 0.05, 10**-3),\n        (0.965, 0.0, 0.05, 0.0),\n        (0.965, 1.0, 0.10, 10**-3),\n        (0.965, 0.0, 0.20, 10**-2),\n        (1.0, 0.0, 0.05, 10**-1),\n    ]\n\n    results = []\n\n    # Construct the wavenumber grid (same for all cases).\n    k = np.logspace(np.log10(k_min), np.log10(k_max), N_k)\n\n    # Construct the second-order finite-difference operator L (same for all cases).\n    # L has zeros on the first and last rows as it acts on interior points.\n    L = np.zeros((N_k, N_k))\n    for i in range(1, N_k - 1):\n        L[i, i - 1] = 1.0\n        L[i, i] = -2.0\n        L[i, i + 1] = 1.0\n    \n    # Pre-compute L^T L for efficiency.\n    L_T_L = L.T @ L\n\n    # Initialize a single random number generator for deterministic reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Iterate through each test case.\n    for n_s, z, sigma_rel, lam in test_cases:\n        # Step 1: Generate the \"true\" signals.\n        D_z = 1.0 / (1.0 + z)\n        T0_k = 1.0 / (1.0 + k / k0 + (k / k1)**2)\n        T_true = D_z * T0_k\n        \n        P_prim = k**(n_s - 4.0)\n        P_true = P_prim * T_true**2\n\n        # Step 2: Generate the noisy observation vector y.\n        sigma_k = sigma_rel * P_true\n        noise = rng.normal(loc=0.0, scale=sigma_k, size=N_k)\n        y = P_true + noise\n\n        # Step 3: Set up and solve the normal equations for Tikhonov regularization.\n        # The system to solve is (A.T @ W^2 @ A + lambda^2 * L.T @ L) @ x = A.T @ W^2 @ y\n        # A = diag(P_prim), W = diag(1/sigma_k)\n        # We can implement this efficiently without creating full diagonal matrices.\n        \n        # Left-hand side matrix M = A.T @ W^2 @ A + lambda^2 * L.T @ L\n        # A.T @ W^2 @ A is diagonal with entries (P_prim/sigma_k)^2\n        lhs_diag_part = (P_prim / sigma_k)**2\n        M_lhs = np.diag(lhs_diag_part) + lam**2 * L_T_L\n\n        # Right-hand side vector b = A.T @ W^2 @ y\n        # This is a vector with entries P_prim[i] * y[i] / sigma_k[i]^2\n        b_rhs = (P_prim / sigma_k**2) * y\n        \n        # Solve the linear system M @ x = b for x\n        x = np.linalg.solve(M_lhs, b_rhs)\n\n        # Step 4: Recover the estimated transfer function T_est.\n        # Enforce non-negativity with a small floor and take the square root.\n        x_nonneg = np.maximum(x, epsilon_x)\n        T_est = np.sqrt(x_nonneg)\n\n        # Step 5: Quantify performance with the relative RMSE.\n        relative_errors_sq = ((T_est - T_true) / T_true)**2\n        R = np.sqrt(np.mean(relative_errors_sq))\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}