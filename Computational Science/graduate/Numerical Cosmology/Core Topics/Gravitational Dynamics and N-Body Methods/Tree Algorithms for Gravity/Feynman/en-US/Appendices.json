{
    "hands_on_practices": [
        {
            "introduction": "The efficiency of tree algorithms stems from approximating the gravitational pull of a distant group of particles as if it were a single, effective particle. This first practice provides a concrete calculation to explore this fundamental concept, the monopole approximation. By directly comparing the exact gravitational force with the approximated force for a simple, hypothetical three-particle system, you will gain a tangible understanding of the trade-off between computational cost and accuracy, and see how this trade-off is quantified by the Barnes-Hut opening angle criterion .",
            "id": "3501662",
            "problem": "Consider Newtonian gravity in comoving code units where the gravitational constant is $G=1$. A simple configuration mimicking a single far cell in a Barnes–Hut (BH) tree consists of a target particle at the origin with mass $m_{0}$, and two source particles with masses $m_{1}=1$ and $m_{2}=1$ located at positions $\\boldsymbol{r}_{1}=(10,1,0)$ and $\\boldsymbol{r}_{2}=(10,-1,0)$. Ignore any cosmological expansion factors or periodic images and treat the interaction as purely Newtonian in three-dimensional Euclidean space.\n\nStarting from Newton’s law of gravitation and the definition of the center of mass, do the following in order:\n\n1. Compute the exact gravitational force vector $\\boldsymbol{F}_{\\text{exact}}$ on the target particle due to the two source particles.\n\n2. Approximate the contribution of the two source particles by a single BH tree cell using only the monopole term: replace the two particles by a single point mass equal to their total mass $M$ located at their center of mass position $\\boldsymbol{R}_{\\text{cm}}$. Compute the approximate force vector $\\boldsymbol{F}_{\\text{mono}}$ on the target particle.\n\n3. Using your results, compute the relative error of the monopole approximation defined as\n$$\n\\varepsilon \\equiv \\frac{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert}{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert}.\n$$\n\nTo connect with the BH opening-angle criterion, define the effective cell size as the side length $s$ of the smallest axis-aligned square that bounds the two source particles and let $d=\\lvert \\boldsymbol{R}_{\\text{cm}}\\rvert$. Report the opening angle $\\theta \\equiv s/d$ you would associate with this configuration, and interpret the numerical value of $\\varepsilon$ as the relative error realized at that $\\theta$ for this geometry.\n\nProvide as your final answer only the numerical value of $\\varepsilon$ as a dimensionless decimal, rounded to four significant figures.",
            "solution": "The problem is subjected to validation and is determined to be a valid, well-posed problem in Newtonian mechanics, directly applicable to the analysis of numerical algorithms in cosmology. The problem is self-contained, scientifically grounded, and unambiguous. We may therefore proceed with a formal solution.\n\nThe gravitational force $\\boldsymbol{F}_{ji}$ exerted on a particle $i$ with mass $m_i$ at position $\\boldsymbol{r}_i$ by a source particle $j$ with mass $m_j$ at position $\\boldsymbol{r}_j$ is given by Newton's law of universal gravitation:\n$$\n\\boldsymbol{F}_{ji} = G \\frac{m_j m_i}{\\left\\lvert\\boldsymbol{r}_j - \\boldsymbol{r}_i\\right\\rvert^3} (\\boldsymbol{r}_j - \\boldsymbol{r}_i)\n$$\nIn this problem, the gravitational constant is given as $G=1$. The target particle has mass $m_0$ and is located at the origin, so its position vector is $\\boldsymbol{r}_0 = (0,0,0)$. The two source particles have masses $m_1=1$ and $m_2=1$ and are located at positions $\\boldsymbol{r}_1 = (10,1,0)$ and $\\boldsymbol{r}_2 = (10,-1,0)$, respectively.\n\n**1. Exact Gravitational Force**\n\nThe exact total gravitational force on the target particle, $\\boldsymbol{F}_{\\text{exact}}$, is the vector sum of the individual forces from each source particle:\n$$\n\\boldsymbol{F}_{\\text{exact}} = \\boldsymbol{F}_{10} + \\boldsymbol{F}_{20}\n$$\nwhere $\\boldsymbol{F}_{10}$ is the force from particle $1$ on particle $0$, and $\\boldsymbol{F}_{20}$ is the force from particle $2$ on particle $0$.\n\nWe compute the individual force vectors:\nThe vector from particle $1$ to particle $0$ is $\\boldsymbol{r}_0 - \\boldsymbol{r}_1 = -\\boldsymbol{r}_1$, but the force on particle $0$ is directed towards particle $1$, so we use the vector $\\boldsymbol{r}_1 - \\boldsymbol{r}_0 = \\boldsymbol{r}_1$.\n$$\n\\boldsymbol{F}_{10} = G \\frac{m_1 m_0}{\\left\\lvert\\boldsymbol{r}_1 - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{r}_1 - \\boldsymbol{r}_0) = (1) \\frac{(1) m_0}{\\left\\lvert\\boldsymbol{r}_1\\right\\rvert^3} \\boldsymbol{r}_1\n$$\nThe squared magnitude of $\\boldsymbol{r}_1$ is $\\left\\lvert\\boldsymbol{r}_1\\right\\rvert^2 = 10^2 + 1^2 + 0^2 = 101$. Thus, $\\left\\lvert\\boldsymbol{r}_1\\right\\rvert = \\sqrt{101}$.\n$$\n\\boldsymbol{F}_{10} = \\frac{m_0}{(\\sqrt{101})^3} (10,1,0) = \\frac{m_0}{101\\sqrt{101}} (10,1,0)\n$$\nSimilarly, for particle $2$:\n$$\n\\boldsymbol{F}_{20} = G \\frac{m_2 m_0}{\\left\\lvert\\boldsymbol{r}_2 - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{r}_2 - \\boldsymbol{r}_0) = (1) \\frac{(1) m_0}{\\left\\lvert\\boldsymbol{r}_2\\right\\rvert^3} \\boldsymbol{r}_2\n$$\nThe squared magnitude of $\\boldsymbol{r}_2$ is $\\left\\lvert\\boldsymbol{r}_2\\right\\rvert^2 = 10^2 + (-1)^2 + 0^2 = 101$. Thus, $\\left\\lvert\\boldsymbol{r}_2\\right\\rvert = \\sqrt{101}$.\n$$\n\\boldsymbol{F}_{20} = \\frac{m_0}{(\\sqrt{101})^3} (10,-1,0) = \\frac{m_0}{101\\sqrt{101}} (10,-1,0)\n$$\nThe total exact force is the sum:\n$$\n\\boldsymbol{F}_{\\text{exact}} = \\boldsymbol{F}_{10} + \\boldsymbol{F}_{20} = \\frac{m_0}{101\\sqrt{101}} \\left[ (10,1,0) + (10,-1,0) \\right] = \\frac{m_0}{101\\sqrt{101}} (20,0,0)\n$$\nSo, $\\boldsymbol{F}_{\\text{exact}} = \\left(\\frac{20m_0}{101\\sqrt{101}}, 0, 0\\right)$.\n\n**2. Monopole Approximation Force**\n\nIn the monopole approximation, the two source particles are replaced by a single point mass $M$ located at their center of mass $\\boldsymbol{R}_{\\text{cm}}$.\nThe total mass is $M = m_1 + m_2 = 1 + 1 = 2$.\nThe center of mass position is:\n$$\n\\boldsymbol{R}_{\\text{cm}} = \\frac{m_1\\boldsymbol{r}_1 + m_2\\boldsymbol{r}_2}{m_1+m_2} = \\frac{(1)(10,1,0) + (1)(10,-1,0)}{2} = \\frac{(10+10, 1-1, 0+0)}{2} = \\frac{(20,0,0)}{2} = (10,0,0)\n$$\nThe approximate force, $\\boldsymbol{F}_{\\text{mono}}$, is the force exerted by this single point mass on the target particle:\n$$\n\\boldsymbol{F}_{\\text{mono}} = G \\frac{M m_0}{\\left\\lvert\\boldsymbol{R}_{\\text{cm}} - \\boldsymbol{r}_0\\right\\rvert^3} (\\boldsymbol{R}_{\\text{cm}} - \\boldsymbol{r}_0) = (1) \\frac{(2)m_0}{\\left\\lvert\\boldsymbol{R}_{\\text{cm}}\\right\\rvert^3} \\boldsymbol{R}_{\\text{cm}}\n$$\nThe magnitude of $\\boldsymbol{R}_{\\text{cm}}$ is $\\left\\lvert\\boldsymbol{R}_{\\text{cm}}\\right\\rvert = \\sqrt{10^2+0^2+0^2} = 10$.\n$$\n\\boldsymbol{F}_{\\text{mono}} = \\frac{2m_0}{10^3} (10,0,0) = \\frac{20m_0}{1000} (1,0,0) = \\frac{m_0}{50} (1,0,0) = \\left(\\frac{m_0}{50}, 0, 0\\right)\n$$\n\n**3. Relative Error**\n\nThe relative error $\\varepsilon$ is defined as $\\varepsilon \\equiv \\frac{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert}{\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert}$.\n\nFirst, we find the difference vector:\n$$\n\\boldsymbol{F}_{\\text{exact}} - \\boldsymbol{F}_{\\text{mono}} = \\left(\\frac{20m_0}{101\\sqrt{101}} - \\frac{m_0}{50}\\right) (1,0,0) = m_0 \\left(\\frac{20}{101\\sqrt{101}} - \\frac{1}{50}\\right) (1,0,0)\n$$\nThe magnitude of this vector is:\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert = \\left\\lvert m_0 \\left(\\frac{20}{101\\sqrt{101}} - \\frac{1}{50}\\right) \\right\\rvert = m_0 \\left\\lvert \\frac{20 \\cdot 50 - 101\\sqrt{101}}{50 \\cdot 101\\sqrt{101}} \\right\\rvert\n$$\nWe note that $101\\sqrt{101} = \\sqrt{101^3} = \\sqrt{1030301} \\approx 1015.04$, while $20 \\cdot 50 = 1000$. Thus, the term inside the absolute value is negative.\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}-\\boldsymbol{F}_{\\text{mono}}\\right\\rvert = m_0 \\left(\\frac{1}{50} - \\frac{20}{101\\sqrt{101}}\\right)\n$$\nThe magnitude of the exact force is:\n$$\n\\left\\lvert \\boldsymbol{F}_{\\text{exact}}\\right\\rvert = \\left\\lvert \\frac{20m_0}{101\\sqrt{101}} (1,0,0) \\right\\rvert = \\frac{20m_0}{101\\sqrt{101}}\n$$\nNow we compute the ratio. The factor $m_0$ cancels.\n$$\n\\varepsilon = \\frac{m_0 \\left(\\frac{1}{50} - \\frac{20}{101\\sqrt{101}}\\right)}{\\frac{20m_0}{101\\sqrt{101}}} = \\frac{\\frac{1}{50}}{\\frac{20}{101\\sqrt{101}}} - 1 = \\frac{101\\sqrt{101}}{50 \\cdot 20} - 1 = \\frac{101\\sqrt{101}}{1000} - 1\n$$\nWe now compute the numerical value:\n$$\n\\varepsilon = \\frac{101\\sqrt{101}}{1000} - 1 \\approx \\frac{101 \\times 10.0498756}{1000} - 1 \\approx \\frac{1015.0374377}{1000} - 1 = 1.0150374377 - 1 = 0.0150374377\n$$\nRounding to four significant figures, we get $\\varepsilon \\approx 0.01504$.\n\nTo interpret this result, we compute the opening angle $\\theta=s/d$. The source particles are at $(10,1,0)$ and $(10,-1,0)$. The smallest axis-aligned box containing them has dimensions $\\Delta x=10-10=0$, $\\Delta y=1-(-1)=2$, $\\Delta z=0-0=0$. The cell size $s$ is the side length of the smallest bounding square, which is the maximum of these dimensions: $s = \\max(0,2,0) = 2$. The distance from the origin to the center of mass is $d = |\\boldsymbol{R}_{\\text{cm}}| = 10$.\nThe opening angle is $\\theta = s/d = 2/10 = 0.2$. The calculated value of $\\varepsilon \\approx 1.5\\%$ is the relative force error incurred when applying the monopole approximation for this specific geometry, which corresponds to an opening angle of $\\theta=0.2$. This is a typical level of accuracy for common choices of the Barnes-Hut opening angle criterion (e.g., $\\theta_{\\text{crit}}  0.5$).\nThe final requested answer is the numerical value of $\\varepsilon$.",
            "answer": "$$\n\\boxed{0.01504}\n$$"
        },
        {
            "introduction": "While the monopole approximation is powerful, achieving higher accuracy in simulations requires including higher-order terms from the multipole expansion. This practice moves beyond the simple center-of-mass approximation to explore the next level of detail: the quadrupole moment. By computing the quadrupole tensor for a hypothetical cell of particles, you will learn how to characterize the non-spherical distribution of mass and estimate the leading error term in a monopole-only calculation, providing insight into the structure of more sophisticated tree codes .",
            "id": "3501693",
            "problem": "Consider a single tree cell in a Newtonian $N$-body calculation used in Barnes–Hut (BH) tree algorithms for gravity in numerical cosmology. The cell contains four point masses at positions $\\mathbf{x}_a$ with masses $m_a$ given in dimensionless code units as follows:\n$\\mathbf{x}_1 = (1, 0, 0)$ with $m_1 = 3$, $\\mathbf{x}_2 = (0, 2, 0)$ with $m_2 = 2$, $\\mathbf{x}_3 = (-1, -1, 1)$ with $m_3 = 5$, and $\\mathbf{x}_4 = (2, -2, -1)$ with $m_4 = 4$.\nUsing Newtonian gravity and the multipole expansion framework, do the following:\n- Compute the center-of-mass position $\\mathbf{r}_{\\mathrm{cm}}$ of the cell.\n- Using coordinates measured relative to the center of mass, $\\mathbf{y}_a = \\mathbf{x}_a - \\mathbf{r}_{\\mathrm{cm}}$, compute the quadrupole tensor defined by $Q_{ij} = \\sum_{a} m_a \\left(3\\,y_{a,i}\\,y_{a,j} - \\delta_{ij}\\,|\\mathbf{y}_a|^2\\right)$, where $\\delta_{ij}$ is the Kronecker delta and $|\\mathbf{y}_a|^2 = \\mathbf{y}_a \\cdot \\mathbf{y}_a$.\n- Consider a field point located at distance $d$ from $\\mathbf{r}_{\\mathrm{cm}}$ along the direction of the vector $(1, 2, -1)$. Let $\\mathbf{n} = \\frac{1}{\\sqrt{6}}(1, 2, -1)$ denote the corresponding unit vector. Assuming the potential is approximated by the monopole term, estimate the leading truncation error, defined as the next nonvanishing term in the far-field multipole expansion of the gravitational potential at this field point, in terms of the gravitational constant $G$, the distance $d$, and the computed quadrupole tensor.\nAll quantities are in nondimensional code units and the gravitational constant $G$ is to be kept symbolic. Express your final answer as a single row vector containing, in order, the three components of $\\mathbf{r}_{\\mathrm{cm}}$, the six independent components of the quadrupole tensor $(Q_{xx}, Q_{yy}, Q_{zz}, Q_{xy}, Q_{xz}, Q_{yz})$, and the scalar leading truncation error $\\Delta \\Phi(d)$. Report exact values (no rounding) and do not include units in your final answer.",
            "solution": "The user wants me to solve a multi-part problem in the context of numerical cosmology, specifically concerning the Barnes-Hut algorithm and the multipole expansion of the gravitational potential.\n\n### Step 1: Problem Validation\n\n**1. Extraction of Givens:**\n- Four point masses with positions $\\mathbf{x}_a$ and masses $m_a$:\n  - $\\mathbf{x}_1 = (1, 0, 0)$, $m_1 = 3$\n  - $\\mathbf{x}_2 = (0, 2, 0)$, $m_2 = 2$\n  - $\\mathbf{x}_3 = (-1, -1, 1)$, $m_3 = 5$\n  - $\\mathbf{x}_4 = (2, -2, -1)$, $m_4 = 4$\n- All quantities are in dimensionless code units.\n- The gravitational constant is to be kept symbolic, denoted by $G$.\n- The task is to compute:\n  1. The center-of-mass position $\\mathbf{r}_{\\mathrm{cm}}$.\n  2. The quadrupole tensor $Q_{ij} = \\sum_{a} m_a \\left(3\\,y_{a,i}\\,y_{a,j} - \\delta_{ij}\\,|\\mathbf{y}_a|^2\\right)$, where $\\mathbf{y}_a = \\mathbf{x}_a - \\mathbf{r}_{\\mathrm{cm}}$.\n  3. The leading truncation error $\\Delta \\Phi(d)$ of the gravitational potential, approximated by the monopole term, at a field point located at distance $d$ from $\\mathbf{r}_{\\mathrm{cm}}$ along the direction of the unit vector $\\mathbf{n} = \\frac{1}{\\sqrt{6}}(1, 2, -1)$.\n\n**2. Validation:**\n- **Scientific Grounding:** The problem is firmly based on Newtonian gravity and the standard multipole expansion, which are fundamental concepts in physics and astrophysics. The Barnes-Hut algorithm is a standard technique in computational N-body simulations. The definition of the traceless quadrupole tensor is standard.\n- **Well-Posedness:** The problem provides all necessary data and definitions to calculate the required quantities. The steps are logical and lead to a unique solution.\n- **Objectivity:** The problem is stated in precise, mathematical terms, free of any subjectivity or ambiguity.\n\n**3. Verdict:**\nThe problem is valid as it is scientifically sound, well-posed, objective, and complete. All conditions for a valid problem are met. I will now proceed with the solution.\n\n### Step 2: Solution\n\nThe solution proceeds in three stages as requested by the problem statement.\n\n**I. Computation of the Center-of-Mass Position**\n\nThe total mass $M$ of the system is the sum of the individual masses:\n$$M = \\sum_{a=1}^{4} m_a = 3 + 2 + 5 + 4 = 14$$\nThe center-of-mass position $\\mathbf{r}_{\\mathrm{cm}}$ is the mass-weighted average of the positions $\\mathbf{x}_a$:\n$$\\mathbf{r}_{\\mathrm{cm}} = \\frac{1}{M} \\sum_{a=1}^{4} m_a \\mathbf{x}_a$$\nWe compute the sum $\\sum m_a \\mathbf{x}_a$:\n$$\\sum_{a=1}^{4} m_a \\mathbf{x}_a = m_1\\mathbf{x}_1 + m_2\\mathbf{x}_2 + m_3\\mathbf{x}_3 + m_4\\mathbf{x}_4$$\n$$= 3(1, 0, 0) + 2(0, 2, 0) + 5(-1, -1, 1) + 4(2, -2, -1)$$\n$$= (3, 0, 0) + (0, 4, 0) + (-5, -5, 5) + (8, -8, -4)$$\n$$= (3+0-5+8, \\quad 0+4-5-8, \\quad 0+0+5-4)$$\n$$= (6, -9, 1)$$\nTherefore, the center-of-mass position is:\n$$\\mathbf{r}_{\\mathrm{cm}} = \\frac{1}{14}(6, -9, 1) = \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{3}{7}, -\\frac{9}{14}, \\frac{1}{14}\\right)$$\n\n**II. Computation of the Quadrupole Tensor**\n\nFirst, we must compute the position vectors $\\mathbf{y}_a$ of each mass relative to the center of mass, $\\mathbf{r}_{\\mathrm{cm}} = (\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14})$:\n$$\\mathbf{y}_a = \\mathbf{x}_a - \\mathbf{r}_{\\mathrm{cm}}$$\n$$\\mathbf{y}_1 = (1, 0, 0) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{8}{14}, \\frac{9}{14}, -\\frac{1}{14}\\right) = \\frac{1}{14}(8, 9, -1)$$\n$$\\mathbf{y}_2 = (0, 2, 0) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(-\\frac{6}{14}, \\frac{37}{14}, -\\frac{1}{14}\\right) = \\frac{1}{14}(-6, 37, -1)$$\n$$\\mathbf{y}_3 = (-1, -1, 1) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(-\\frac{20}{14}, -\\frac{5}{14}, \\frac{13}{14}\\right) = \\frac{1}{14}(-20, -5, 13)$$\n$$\\mathbf{y}_4 = (2, -2, -1) - \\left(\\frac{6}{14}, -\\frac{9}{14}, \\frac{1}{14}\\right) = \\left(\\frac{22}{14}, -\\frac{19}{14}, -\\frac{15}{14}\\right) = \\frac{1}{14}(22, -19, -15)$$\n\nThe quadrupole tensor is defined as $Q_{ij} = \\sum_a m_a (3 y_{a,i} y_{a,j} - \\delta_{ij} |\\mathbf{y}_a|^2)$. This can be calculated from the moment of inertia tensor about the center of mass, $I_{ij} = \\sum_a m_a y_{a,i} y_{a,j}$. The quadrupole tensor is then $Q_{ij} = 3I_{ij} - \\delta_{ij} \\mathrm{Tr}(I)$, where $\\mathrm{Tr}(I) = \\sum_k I_{kk} = \\sum_a m_a |\\mathbf{y}_a|^2$.\n\nLet's compute the components of $I_{ij}$. Let $y_{a,i}' = 14 y_{a,i}$.\n$I_{ij} = \\frac{1}{14^2} \\sum_a m_a y_{a,i}' y_{a,j}' = \\frac{1}{196} \\sum_a m_a y_{a,i}' y_{a,j}'$.\n$I_{xx} = \\frac{1}{196} [3(8^2) + 2(-6)^2 + 5(-20)^2 + 4(22^2)] = \\frac{1}{196}[192 + 72 + 2000 + 1936] = \\frac{4200}{196} = \\frac{150}{7}$.\n$I_{yy} = \\frac{1}{196} [3(9^2) + 2(37^2) + 5(-5)^2 + 4(-19)^2] = \\frac{1}{196}[243 + 2738 + 125 + 1444] = \\frac{4550}{196} = \\frac{325}{14}$.\n$I_{zz} = \\frac{1}{196} [3(-1)^2 + 2(-1)^2 + 5(13^2) + 4(-15)^2] = \\frac{1}{196}[3 + 2 + 845 + 900] = \\frac{1750}{196} = \\frac{125}{14}$.\n$I_{xy} = \\frac{1}{196} [3(8)(9) + 2(-6)(37) + 5(-20)(-5) + 4(22)(-19)] = \\frac{1}{196}[216 - 444 + 500 - 1672] = \\frac{-1400}{196} = -\\frac{50}{7}$.\n$I_{xz} = \\frac{1}{196} [3(8)(-1) + 2(-6)(-1) + 5(-20)(13) + 4(22)(-15)] = \\frac{1}{196}[-24 + 12 - 1300 - 1320] = \\frac{-2632}{196} = -\\frac{94}{7}$.\n$I_{yz} = \\frac{1}{196} [3(9)(-1) + 2(37)(-1) + 5(-5)(13) + 4(-19)(-15)] = \\frac{1}{196}[-27 - 74 - 325 + 1140] = \\frac{714}{196} = \\frac{51}{14}$.\n\nThe trace of $I$ is:\n$\\mathrm{Tr}(I) = I_{xx} + I_{yy} + I_{zz} = \\frac{150}{7} + \\frac{325}{14} + \\frac{125}{14} = \\frac{300}{14} + \\frac{450}{14} = \\frac{750}{14} = \\frac{375}{7}$.\n\nNow we compute the components of $Q_{ij}$:\n$Q_{xx} = 3I_{xx} - \\mathrm{Tr}(I) = 3\\left(\\frac{150}{7}\\right) - \\frac{375}{7} = \\frac{450 - 375}{7} = \\frac{75}{7}$.\n$Q_{yy} = 3I_{yy} - \\mathrm{Tr}(I) = 3\\left(\\frac{325}{14}\\right) - \\frac{375}{7} = \\frac{975}{14} - \\frac{750}{14} = \\frac{225}{14}$.\n$Q_{zz} = 3I_{zz} - \\mathrm{Tr}(I) = 3\\left(\\frac{125}{14}\\right) - \\frac{375}{7} = \\frac{375}{14} - \\frac{750}{14} = -\\frac{375}{14}$.\nAs a check, the trace of $Q$ is $Q_{xx} + Q_{yy} + Q_{zz} = \\frac{150}{14} + \\frac{225}{14} - \\frac{375}{14} = 0$, as required for this definition of the quadrupole tensor.\nThe off-diagonal elements are:\n$Q_{xy} = 3I_{xy} = 3\\left(-\\frac{50}{7}\\right) = -\\frac{150}{7}$.\n$Q_{xz} = 3I_{xz} = 3\\left(-\\frac{94}{7}\\right) = -\\frac{282}{7}$.\n$Q_{yz} = 3I_{yz} = 3\\left(\\frac{51}{14}\\right) = \\frac{153}{14}$.\n\nThe six independent components of the symmetric quadrupole tensor $Q_{ij}$ are $(Q_{xx}, Q_{yy}, Q_{zz}, Q_{xy}, Q_{xz}, Q_{yz})$.\n\n**III. Computation of the Leading Truncation Error**\n\nThe multipole expansion of the gravitational potential $\\Phi$ at a position $\\mathbf{r}$ relative to the center of mass is:\n$$\\Phi(\\mathbf{r}) = -G \\left( \\frac{M}{r} + \\frac{\\mathbf{D} \\cdot \\mathbf{n}}{r^2} + \\frac{1}{2r^3} \\sum_{i,j} n_i Q_{ij} n_j + O(r^{-4}) \\right)$$\nwhere $r=|\\mathbf{r}|$, $\\mathbf{n} = \\mathbf{r}/r$, $M$ is the monopole moment (total mass), $\\mathbf{D} = \\sum_a m_a \\mathbf{y}_a$ is the dipole moment, and $Q_{ij}$ is the traceless quadrupole tensor.\nBy construction, the dipole moment $\\mathbf{D}$ is zero in the center-of-mass frame. The problem states that the potential is approximated by the monopole term, $\\Phi_{mono} = -GM/r$. The leading truncation error is the next non-vanishing term, which is the quadrupole term $\\Phi_{quad}$.\n$$\\Delta \\Phi = \\Phi_{quad}(\\mathbf{r}) = -\\frac{G}{2r^3} \\sum_{i,j} n_i Q_{ij} n_j$$\nThe field point is at a distance $d$ from the center of mass, so $r=d$. The direction is given by the unit vector $\\mathbf{n} = \\frac{1}{\\sqrt{6}}(1, 2, -1)$.\nWe need to compute the quadratic form $\\sum_{i,j} n_i Q_{ij} n_j = \\mathbf{n}^T Q \\mathbf{n}$.\n$$\\mathbf{n}^T Q \\mathbf{n} = \\frac{1}{(\\sqrt{6})^2} (1, 2, -1) \\begin{pmatrix} Q_{xx}  Q_{xy}  Q_{xz} \\\\ Q_{xy}  Q_{yy}  Q_{yz} \\\\ Q_{xz}  Q_{yz}  Q_{zz} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ -1 \\end{pmatrix}$$\n$$ = \\frac{1}{6} (Q_{xx} \\cdot 1^2 + Q_{yy} \\cdot 2^2 + Q_{zz} \\cdot (-1)^2 + 2Q_{xy} \\cdot 1 \\cdot 2 + 2Q_{xz} \\cdot 1 \\cdot (-1) + 2Q_{yz} \\cdot 2 \\cdot (-1))$$\n$$ = \\frac{1}{6} (Q_{xx} + 4Q_{yy} + Q_{zz} + 4Q_{xy} - 2Q_{xz} - 4Q_{yz})$$\nSubstituting the computed values of $Q_{ij}$:\n$$ = \\frac{1}{6} \\left( \\frac{75}{7} + 4\\left(\\frac{225}{14}\\right) - \\frac{375}{14} + 4\\left(-\\frac{150}{7}\\right) - 2\\left(-\\frac{282}{7}\\right) - 4\\left(\\frac{153}{14}\\right) \\right)$$\n$$ = \\frac{1}{6} \\left( \\frac{150}{14} + \\frac{900}{14} - \\frac{375}{14} - \\frac{1200}{14} + \\frac{1128}{14} - \\frac{612}{14} \\right)$$\n$$ = \\frac{1}{6} \\cdot \\frac{1}{14} (150 + 900 - 375 - 1200 + 1128 - 612)$$\n$$ = \\frac{1}{84} (2178 - 2187) = \\frac{-9}{84} = -\\frac{3}{28}$$\nThe leading truncation error is then:\n$$\\Delta \\Phi(d) = -\\frac{G}{2d^3} \\left(-\\frac{3}{28}\\right) = \\frac{3G}{56d^3}$$\n\nThe final answer is a row vector containing the three components of $\\mathbf{r}_{\\mathrm{cm}}$, the six independent components of $Q_{ij}$, and the scalar $\\Delta \\Phi(d)$.\nThe components are:\n1. $\\mathbf{r}_{\\mathrm{cm},x} = \\frac{3}{7}$\n2. $\\mathbf{r}_{\\mathrm{cm},y} = -\\frac{9}{14}$\n3. $\\mathbf{r}_{\\mathrm{cm},z} = \\frac{1}{14}$\n4. $Q_{xx} = \\frac{75}{7}$\n5. $Q_{yy} = \\frac{225}{14}$\n6. $Q_{zz} = -\\frac{375}{14}$\n7. $Q_{xy} = -\\frac{150}{7}$\n8. $Q_{xz} = -\\frac{282}{7}$\n9. $Q_{yz} = \\frac{153}{14}$\n10. $\\Delta\\Phi(d) = \\frac{3G}{56d^3}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{3}{7}  -\\frac{9}{14}  \\frac{1}{14}  \\frac{75}{7}  \\frac{225}{14}  -\\frac{375}{14}  -\\frac{150}{7}  -\\frac{282}{7}  \\frac{153}{14}  \\frac{3G}{56d^3} \\end{pmatrix} } $$"
        },
        {
            "introduction": "This final practice synthesizes the preceding concepts into a complete, step-by-step execution of the Barnes-Hut algorithm's core logic. You will perform a \"tree walk\" for a target particle, traversing a pre-defined octree and applying the opening-angle criterion at each internal node to decide between using a monopole approximation or descending to a deeper level. This exercise simulates the recursive decision-making process at the heart of the force calculation, bridging the gap between understanding individual components and seeing the full algorithm in action .",
            "id": "3501671",
            "problem": "In a collisionless gravitating system evolved in dimensionless code units, consider computing the gravitational acceleration on a target test particle using a Barnes–Hut (BH) tree approximation. The gravitational constant is $G=1$. The computational domain is a cube with side length $8$ spanning coordinates $[0,8]$ in each dimension. The root node (cell) has geometric center at $(4,4,4)$ and side length $w_0=8$, and is subdivided into $8$ octants of side length $4$ with geometric centers at the usual $(2,2,2)$, $(6,2,2)$, $(2,6,2)$, $(6,6,2)$, $(2,2,6)$, $(6,2,6)$, $(2,6,6)$, $(6,6,6)$. The octree is constructed by recursively subdividing any occupied node until every leaf contains at most $1$ particle.\n\nThe $N$-body system contains the following particles with positions $\\mathbf{r}_i$ and masses $m_i$:\n- One particle at $(7,1,1)$ with mass $m=2$ in the octant centered at $(6,2,2)$.\n- One particle at $(1,7,1)$ with mass $m=3$ in the octant centered at $(2,6,2)$.\n- One particle at $(1,1,7)$ with mass $m=4$ in the octant centered at $(2,2,6)$.\n- Three particles forming a compact group inside the octant centered at $(6,6,6)$ with side length $4$, located at $(5.5,5.5,5.5)$ with mass $m=1$, at $(6.5,6.0,6.0)$ with mass $m=1.5$, and at $(6.0,6.5,6.0)$ with mass $m=2$. This octant is further subdivided until each of these three particles resides alone in a leaf.\n\nA target test particle (not included among the above six) is located at $\\mathbf{r}_{\\mathrm{t}}=(1,1,1)$. Using the standard Barnes–Hut opening-angle criterion, accept an internal node of side length $w$ and center-of-mass position $\\mathbf{R}_{\\mathrm{com}}$ if\n$$\n\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{com}}|} \\le \\theta,\n$$\nwith opening angle $\\theta=0.5$. If an internal node is not accepted, descend to its children. If a leaf node is reached that does not contain the target, compute its particle’s direct contribution. For any accepted internal node, approximate its contribution by a monopole located at its center of mass with total mass equal to the sum of its constituent particle masses. Ignore any self-interaction; no gravitational softening is used.\n\nStarting from Newton’s law of gravitation and the above tree-walk rules, traverse the tree to compute the total gravitational acceleration on the target by summing the accepted node monopole contributions and the direct leaf interactions. Use $G=1$, and express the final acceleration vector as a row matrix $\\begin{pmatrix}a_x  a_y  a_z\\end{pmatrix}$ in code units. Round your final numerical answer to four significant figures. Angles are not involved.",
            "solution": "The problem asks for the gravitational acceleration on a target test particle using the Barnes-Hut (BH) tree approximation. I will first validate the problem statement and, if it is valid, proceed to a full solution.\n\n### Step 1: Extract Givens\n- **Gravitational constant:** $G=1$.\n- **Computational Domain:** Cube with side length $L=8$, coordinates in $[0,8]$ for each dimension.\n- **Root Node:** Geometric center at $(4,4,4)$, side length $w_0=8$.\n- **Octree Construction:** Recursive subdivision of occupied nodes until each leaf contains at most $1$ particle.\n- **Particle Data:**\n  - Particle 1: $\\mathbf{r}_1=(7,1,1)$, $m_1=2$.\n  - Particle 2: $\\mathbf{r}_2=(1,7,1)$, $m_2=3$.\n  - Particle 3: $\\mathbf{r}_3=(1,1,7)$, $m_3=4$.\n  - Particle 4: $\\mathbf{r}_4=(5.5,5.5,5.5)$, $m_4=1$.\n  - Particle 5: $\\mathbf{r}_5=(6.5,6.0,6.0)$, $m_5=1.5$.\n  - Particle 6: $\\mathbf{r}_6=(6.0,6.5,6.0)$, $m_6=2$.\n- **Target Particle:** Position $\\mathbf{r}_{\\mathrm{t}}=(1,1,1)$.\n- **BH Opening-Angle Criterion:** An internal node of side length $w$ and center of mass $\\mathbf{R}_{\\mathrm{com}}$ is accepted if $\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{com}}|} \\le \\theta$, with the opening angle $\\theta=0.5$.\n- **Interaction Rules:**\n  - If a node is accepted, its contribution is that of a monopole with its total mass $M$ at its center of mass $\\mathbf{R}_{\\mathrm{com}}$.\n  - If an internal node is not accepted, descend to its children.\n  - If a leaf node is reached, compute the particle's direct contribution.\n- **Physics:** No gravitational softening is used.\n- **Output Requirement:** Express the final acceleration vector $\\begin{pmatrix}a_x  a_y  a_z\\end{pmatrix}$ with components rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in Newtonian mechanics and computational physics, specifically the well-established Barnes-Hut algorithm for N-body simulations. The setup is objectively described with precise numerical values and clear, unambiguous rules. All necessary data (particle masses and positions, domain geometry, BH parameter $\\theta$) are provided. The problem is self-contained, consistent, and well-posed, admitting a unique and verifiable solution through a deterministic application of the given rules. There are no contradictions, factual errors, or infeasible conditions.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A full solution will be derived.\n\nThe gravitational acceleration $\\mathbf{a}$ exerted by a source of mass $M$ at position $\\mathbf{R}$ on the target particle at $\\mathbf{r}_{\\mathrm{t}}$ follows Newton's law of gravitation. With $G=1$, this is:\n$$\n\\mathbf{a} = \\frac{M (\\mathbf{R} - \\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{R} - \\mathbf{r}_{\\mathrm{t}}|^3}\n$$\nThe total acceleration is the vector sum of contributions from all nodes as determined by the BH tree traversal. The target particle is at $\\mathbf{r}_{\\mathrm{t}}=(1,1,1)$.\n\nThe traversal begins at the root node of the octree.\n\n**Root Node Analysis:**\nThe root node encompasses the entire domain, with side length $w_0=8$. It contains all $N=6$ particles. We must first determine if this node can be approximated as a monopole.\nTotal mass of the system:\n$M_{\\mathrm{root}} = \\sum_{i=1}^{6} m_i = 2+3+4+1+1.5+2 = 13.5$.\nThe center of mass $\\mathbf{R}_{\\mathrm{root}}$ is:\n$\\mathbf{R}_{\\mathrm{root}} = \\frac{1}{M_{\\mathrm{root}}} \\sum_{i=1}^{6} m_i \\mathbf{r}_i$\n$\\sum m_i \\mathbf{r}_i = 2(7,1,1) + 3(1,7,1) + 4(1,1,7) + 1(5.5,5.5,5.5) + 1.5(6.5,6,6) + 2(6,6.5,6)$\n$= (14,2,2) + (3,21,3) + (4,4,28) + (5.5,5.5,5.5) + (9.75,9,9) + (12,13,12)$\n$= (48.25, 54.5, 59.5)$\n$\\mathbf{R}_{\\mathrm{root}} = \\frac{1}{13.5}(48.25, 54.5, 59.5) \\approx (3.574, 4.037, 4.407)$.\nThe distance from the target to the root's center of mass is:\n$|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{root}}| = |(1,1,1) - (3.574, 4.037, 4.407)| = |(-2.574, -3.037, -3.407)|$\n$= \\sqrt{(-2.574)^2 + (-3.037)^2 + (-3.407)^2} \\approx \\sqrt{6.626 + 9.223 + 11.608} = \\sqrt{27.457} \\approx 5.240$.\nApplying the opening-angle criterion:\n$\\frac{w_0}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{R}_{\\mathrm{root}}|} = \\frac{8}{5.240} \\approx 1.527$.\nSince $1.527  \\theta=0.5$, the root node is not accepted. We must descend to its children, which are the $8$ octants of side length $w=4$. We consider only the four occupied octants.\n\n**Children of the Root Node (Octants with $w=4$):**\n\n1.  **Node containing P1:** This node corresponds to the octant $[4,8]\\times[0,4]\\times[0,4]$ and contains only particle P1 at $\\mathbf{r}_1=(7,1,1)$ with mass $m_1=2$. The node's center of mass is $\\mathbf{R}_{\\mathrm{com}}=\\mathbf{r}_1$ and total mass is $M=m_1$.\n    The distance is $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1| = \\sqrt{(1-7)^2+(1-1)^2+(1-1)^2} = \\sqrt{(-6)^2} = 6$.\n    Criterion check: $\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1|} = \\frac{4}{6} \\approx 0.667  0.5$. This node is not accepted. We must open it.\n    The child of this node is a smaller cell of side length $w'=2$ containing only P1.\n    Criterion check for the child node: $\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_1|} = \\frac{2}{6} \\approx 0.333 \\le 0.5$. This node is accepted. Its contribution is that of a monopole at $\\mathbf{r}_1$ with mass $m_1$, which is the direct interaction.\n    $\\mathbf{a}_1 = \\frac{m_1(\\mathbf{r}_1-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_1-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{2((7,1,1)-(1,1,1))}{6^3} = \\frac{2(6,0,0)}{216} = (\\frac{12}{216}, 0, 0) = (\\frac{1}{18}, 0, 0)$.\n\n2.  **Node containing P2:** This node corresponds to the octant $[0,4]\\times[4,8]\\times[0,4]$ and contains only P2 at $\\mathbf{r}_2=(1,7,1)$ with $m_2=3$. The COM is $\\mathbf{r}_2$.\n    The distance is $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2| = \\sqrt{(1-1)^2+(1-7)^2+(1-1)^2} = \\sqrt{(-6)^2} = 6$.\n    Criterion check: $\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2|} = \\frac{4}{6}  0.5$. Not accepted. Descending to the child node of side $w'=2$.\n    Criterion check for child: $\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_2|} = \\frac{2}{6} \\le 0.5$. Accepted.\n    $\\mathbf{a}_2 = \\frac{m_2(\\mathbf{r}_2-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_2-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{3((1,7,1)-(1,1,1))}{6^3} = \\frac{3(0,6,0)}{216} = (0, \\frac{18}{216}, 0) = (0, \\frac{1}{12}, 0)$.\n\n3.  **Node containing P3:** This node corresponds to the octant $[0,4]\\times[0,4]\\times[4,8]$ and contains only P3 at $\\mathbf{r}_3=(1,1,7)$ with $m_3=4$. The COM is $\\mathbf{r}_3$.\n    The distance is $|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3| = \\sqrt{(1-1)^2+(1-1)^2+(1-7)^2} = \\sqrt{(-6)^2} = 6$.\n    Criterion check: $\\frac{w}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3|} = \\frac{4}{6}  0.5$. Not accepted. Descending to the child node of side $w'=2$.\n    Criterion check for child: $\\frac{w'}{|\\mathbf{r}_{\\mathrm{t}}-\\mathbf{r}_3|} = \\frac{2}{6} \\le 0.5$. Accepted.\n    $\\mathbf{a}_3 = \\frac{m_3(\\mathbf{r}_3-\\mathbf{r}_{\\mathrm{t}})}{|\\mathbf{r}_3-\\mathbf{r}_{\\mathrm{t}}|^3} = \\frac{4((1,1,7)-(1,1,1))}{6^3} = \\frac{4(0,0,6)}{216} = (0, 0, \\frac{24}{216}) = (0, 0, \\frac{1}{9})$.\n\n4.  **Node containing the group (P4, P5, P6):** This internal node corresponds to the octant $[4,8]\\times[4,8]\\times[4,8]$ with side length $w=4$. It contains three particles.\n    Total mass: $M_{\\mathrm{grp}} = m_4+m_5+m_6 = 1+1.5+2 = 4.5$.\n    Center of mass $\\mathbf{R}_{\\mathrm{grp}} = \\frac{1}{M_{\\mathrm{grp}}}(m_4\\mathbf{r}_4+m_5\\mathbf{r}_5+m_6\\mathbf{r}_6)$.\n    $m_4\\mathbf{r}_4+m_5\\mathbf{r}_5+m_6\\mathbf{r}_6 = 1(5.5,5.5,5.5) + 1.5(6.5,6.0,6.0) + 2(6.0,6.5,6.0)$\n    $= (5.5,5.5,5.5) + (9.75,9.0,9.0) + (12.0,13.0,12.0) = (27.25, 27.5, 26.5)$.\n    $\\mathbf{R}_{\\mathrm{grp}} = \\frac{1}{4.5}(27.25, 27.5, 26.5) = (\\frac{109}{18}, \\frac{55}{9}, \\frac{53}{9}) \\approx (6.0556, 6.1111, 5.8889)$.\n    The displacement vector and distance are:\n    $\\mathbf{d}_{\\mathrm{grp}} = \\mathbf{R}_{\\mathrm{grp}} - \\mathbf{r}_{\\mathrm{t}} = (\\frac{109}{18}-1, \\frac{55}{9}-1, \\frac{53}{9}-1) = (\\frac{91}{18}, \\frac{46}{9}, \\frac{44}{9}) \\approx (5.0556, 5.1111, 4.8889)$.\n    $|\\mathbf{d}_{\\mathrm{grp}}| = \\sqrt{(\\frac{91}{18})^2 + (\\frac{46}{9})^2 + (\\frac{44}{9})^2} = \\sqrt{25.5586 + 26.1235 + 23.9012} \\approx \\sqrt{75.5833} \\approx 8.6939$.\n    Criterion check: $\\frac{w}{|\\mathbf{d}_{\\mathrm{grp}}|} = \\frac{4}{8.6939} \\approx 0.4601 \\le 0.5$.\n    The criterion is met. This node is accepted and treated as a monopole.\n    $\\mathbf{a}_{\\mathrm{grp}} = \\frac{M_{\\mathrm{grp}}\\mathbf{d}_{\\mathrm{grp}}}{|\\mathbf{d}_{\\mathrm{grp}}|^3} = \\frac{4.5}{(8.6939)^3}(5.0556, 5.1111, 4.8889)$.\n    $|\\mathbf{d}_{\\mathrm{grp}}|^3 \\approx 657.07$.\n    $\\mathbf{a}_{\\mathrm{grp}} \\approx \\frac{4.5}{657.07}(5.0556, 5.1111, 4.8889) \\approx 0.0068485 (5.0556, 5.1111, 4.8889)$.\n    $\\mathbf{a}_{\\mathrm{grp}} \\approx (0.034621, 0.034999, 0.033480)$.\n\n**Total Acceleration:**\nThe total acceleration is the sum of the individual contributions:\n$\\mathbf{a}_{\\mathrm{total}} = \\mathbf{a}_1 + \\mathbf{a}_2 + \\mathbf{a}_3 + \\mathbf{a}_{\\mathrm{grp}}$.\n$\\mathbf{a}_1 = (\\frac{1}{18}, 0, 0) \\approx (0.055556, 0, 0)$.\n$\\mathbf{a}_2 = (0, \\frac{1}{12}, 0) \\approx (0, 0.083333, 0)$.\n$\\mathbf{a}_3 = (0, 0, \\frac{1}{9}) \\approx (0, 0, 0.111111)$.\nSumming the components:\n$a_x = \\frac{1}{18} + 0.034621 \\approx 0.055556 + 0.034621 = 0.090177$.\n$a_y = \\frac{1}{12} + 0.034999 \\approx 0.083333 + 0.034999 = 0.118332$.\n$a_z = \\frac{1}{9} + 0.033480 \\approx 0.111111 + 0.033480 = 0.144591$.\nThe total acceleration vector is approximately $(0.090177, 0.118332, 0.144591)$.\n\nRounding each component to four significant figures:\n$a_x \\approx 0.09018$.\n$a_y \\approx 0.1183$.\n$a_z \\approx 0.1446$.\nThe final result is presented as a row matrix as requested.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.09018  0.1183  0.1446 \\end{pmatrix}}\n$$"
        }
    ]
}