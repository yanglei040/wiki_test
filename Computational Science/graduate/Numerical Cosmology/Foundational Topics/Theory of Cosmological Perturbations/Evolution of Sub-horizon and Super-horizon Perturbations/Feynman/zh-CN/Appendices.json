{
    "hands_on_practices": [
        {
            "introduction": "在宇宙学中，引力在不同尺度上的表现有所不同。此练习旨在探索从大尺度（超视界）上完整的广义相对论描述到小尺度（亚视界）上我们所熟悉的牛顿引力描述的过渡。通过在 $\\Lambda$CDM 模型中数值求解微扰方程，您将直接验证简单的泊松方程在何种条件下成为一个有效的近似，这是连接理论与天体物理观测的一个关键概念 。",
            "id": "3471486",
            "problem": "你的任务是在空间平坦的$\\Lambda$冷暗物质（$\\Lambda$CDM）宇宙学中，对标量度规微扰的牛顿（泊松极限）行为进行数值验证。具体来说，对于波数 $k$ 远大于共形哈勃率 $aH$ 的傅里叶模式，牛顿泊松方程 $k^2 \\Phi = 4 \\pi G a^2 \\bar{\\rho} \\, \\delta$ 应高度精确地成立。对于 $k \\lesssim aH$ 的模式，广义相对论修正会使该牛顿关系产生偏差。你的程序必须实现线性微扰的自洽数值演化，以量化牛顿泊松方程的分数残差。\n\n宇宙学背景是一个平坦的$\\Lambda$CDM宇宙，其当前的物质密度参数为$\\Omega_{m0}$，宇宙学常数密度参数为$\\Omega_{\\Lambda 0}$，哈勃参数为 $H(a) = H_0 \\sqrt{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}}$。我们将共形哈勃率定义为 $\\mathcal{H}(a) = a H(a)$。为方便起见并避免单位换算，设置 $H_0 = 1$（无量纲单位），因此所有量都是无量纲的。使用 $\\Omega_{m0} = 0.3$ 和 $\\Omega_{\\Lambda 0} = 0.7$。\n\n考虑在牛顿规范下的无压物质（冷暗物质）的线性微扰。对单个傅里叶模式 $k$，演化以下关于对数尺度因子 $N = \\ln a$ 的函数系统：\n\n- 尘埃的连续性方程：\n$$\n\\delta' = - \\theta + 3 \\Phi' \\, ,\n$$\n- 尘埃的欧拉方程：\n$$\n\\theta' = - \\mathcal{H} \\, \\theta + k^2 \\Phi \\, ,\n$$\n- 爱因斯坦动量约束（用于自洽地计算 $\\Phi'$）：\n$$\nk^2 \\left(\\Phi' + \\mathcal{H} \\Phi \\right) = 4 \\pi G \\, a^2 \\bar{\\rho} \\, \\theta \\, .\n$$\n\n此处，$\\delta$ 是物质密度对比，$\\theta$ 是速度散度，$\\Phi$ 是 Bardeen 势，撇号（'）表示对共形时间 $\\eta$ 的导数。使用 $X_N \\equiv \\frac{dX}{dN} = \\frac{X'}{\\mathcal{H}}$ 将这些方程转换为关于 $N$ 的导数。使用背景 Friedmann 关系 $3 H^2(a) = 8 \\pi G \\, \\bar{\\rho}_{\\text{tot}}(a)$ 并定义物质组分\n$$\n\\Omega_m(a) = \\frac{\\Omega_{m0} a^{-3}}{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} \\, ,\n$$\n从而通过以下方式将 $4 \\pi G a^2 \\bar{\\rho}$ 用 $\\mathcal{H}(a)$ 表示：\n$$\n4 \\pi G a^2 \\bar{\\rho} = \\frac{3}{2} \\mathcal{H}^2(a) \\, \\Omega_m(a) \\, .\n$$\n\n初始条件：选择一个早期时间 $a_i = 10^{-3}$，并设置深处物质主导时期的绝热增长模式初始条件。取 $\\Phi(a_i) = \\Phi_0$，其中 $\\Phi_0 = 10^{-5}$，$\\delta(a_i) = -2 \\Phi_0$，以及 $\\theta(a_i) = 0$。演化至 $a_f = 1$。\n\n对于每个 $k$，在演化到 $a_f$ 后，计算牛顿泊松方程的分数残差，\n$$\nR(k) = \\frac{\\left| k^2 \\Phi(a_f) - 4 \\pi G a_f^2 \\bar{\\rho}(a_f) \\, \\delta(a_f) \\right|}{\\left| 4 \\pi G a_f^2 \\bar{\\rho}(a_f) \\, \\delta(a_f) \\right|} \\, ,\n$$\n其结果是一个无量纲浮点数。\n\n测试套件：\n- 使用 $a_f = 1$ 并根据给定的背景参数计算 $\\mathcal{H}_f \\equiv \\mathcal{H}(a_f)$。\n- 对以下四个波数评估分数残差 $R(k)$：\n    1. $k = 0.01 \\, \\mathcal{H}_f$ (在 $a_f$ 时为超视界)，\n    2. $k = 1 \\, \\mathcal{H}_f$ (在 $a_f$ 时为近视界)，\n    3. $k = 10 \\, \\mathcal{H}_f$ (在 $a_f$ 时为亚视界)，\n    4. $k = 100 \\, \\mathcal{H}_f$ (在 $a_f$ 时为深亚视界)。\n这个集合探测了超视界、视界和亚视界区域的行为。\n\n要求的最终输出：\n- 你的程序应产生单行输出，其中包含四个计算出的残差，格式为方括号括起来的逗号分隔列表，顺序如上所述，例如，“[r1,r2,r3,r4]”。\n- 所有输出均为无量纲浮点数。不应打印百分比和物理单位。\n\n科学和数值的真实性：\n- 实现必须基于上述来自广义相对论（GR）线性微扰理论和ΛCDM背景的基本关系。\n- 数值积分应使用稳健的常微分方程求解器和适当的变量变换来执行，以确保在整个测试套件中的稳定性。",
            "solution": "所述问题具有科学依据、内容自洽且定义明确。它要求对一个描述$\\Lambda$CDM宇宙中宇宙学微扰演化的线性常微分方程（ODE）组进行数值积分。方程和初始条件是物理宇宙学领域的标准内容，基于广义相对论。任务是计算当前时刻（$a_f=1$）不同微扰尺度下牛顿泊松方程的分数残差，这是一个经典的练习，用于理解引力从广义相对论描述到牛顿描述的过渡。\n\n求解过程如下：\n首先，我们必须构建一个适合数值积分的一阶ODE系统。问题为物质密度对比 $\\delta$、速度散度 $\\theta$ 和引力势 $\\Phi$ 提供了三个方程。导数是关于共形时间 $\\eta$ 的。相对于尺度因子的对数 $N = \\ln a$ 进行积分更为方便。导数之间的关系是 $\\frac{d}{dN} = \\frac{1}{\\mathcal{H}}\\frac{d}{d\\eta}$，其中 $\\mathcal{H} = aH$ 是共形哈勃率。\n\n给定的方程是：\n1.  连续性方程： $\\delta' = - \\theta + 3 \\Phi'$\n2.  欧拉方程： $\\theta' = - \\mathcal{H} \\, \\theta + k^2 \\Phi$\n3.  爱因斯坦动量约束： $k^2 \\left(\\Phi' + \\mathcal{H} \\Phi \\right) = 4 \\pi G \\, a^2 \\bar{\\rho} \\, \\theta$\n\n让下标 $N$ 表示对 $N$ 的导数，即 $X_N = dX/dN = X'/\\mathcal{H}$。我们转换方程：\n1.  $\\mathcal{H} \\delta_N = -\\theta + 3\\mathcal{H}\\Phi_N \\implies \\delta_N = -\\frac{\\theta}{\\mathcal{H}} + 3\\Phi_N$\n2.  $\\mathcal{H} \\theta_N = -\\mathcal{H}\\theta + k^2\\Phi \\implies \\theta_N = -\\theta + \\frac{k^2}{\\mathcal{H}}\\Phi$\n3.  $k^2(\\mathcal{H} \\Phi_N + \\mathcal{H}\\Phi) = 4\\pi G a^2 \\bar{\\rho} \\, \\theta \\implies \\Phi_N = \\frac{4\\pi G a^2 \\bar{\\rho}}{k^2\\mathcal{H}}\\theta - \\Phi$\n\n使用提供的恒等式 $4 \\pi G a^2 \\bar{\\rho} = \\frac{3}{2} \\mathcal{H}^2(a) \\, \\Omega_m(a)$，其中 $\\bar{\\rho}$ 是背景物质密度，$\\Phi_N$ 的方程变为：\n$$\n\\Phi_N = \\frac{\\frac{3}{2} \\mathcal{H}^2 \\Omega_m}{k^2 \\mathcal{H}}\\theta - \\Phi = \\frac{3}{2} \\Omega_m(a) \\frac{\\mathcal{H}(a)}{k^2} \\theta - \\Phi\n$$\n可以将此代入 $\\delta_N$ 的方程中，但在数值上更直接的方法是同时求解所有三个变量 $[\\delta, \\theta, \\Phi]$。对于状态向量 $Y(N) = [\\delta(N), \\theta(N), \\Phi(N)]^T$，关于 $N$ 的一阶ODE系统为：\n$$\n\\frac{d\\delta}{dN} = -\\frac{\\theta}{\\mathcal{H}} + 3 \\left( \\frac{3}{2} \\Omega_m \\frac{\\mathcal{H}}{k^2}\\theta - \\Phi \\right) = \\left( \\frac{9}{2} \\frac{\\Omega_m \\mathcal{H}}{k^2} - \\frac{1}{\\mathcal{H}} \\right) \\theta - 3\\Phi\n$$\n$$\n\\frac{d\\theta}{dN} = -\\theta + \\frac{k^2}{\\mathcal{H}}\\Phi\n$$\n$$\n\\frac{d\\Phi}{dN} = \\frac{3}{2} \\Omega_m \\frac{\\mathcal{H}}{k^2}\\theta - \\Phi\n$$\n背景量 $\\mathcal{H}(a)$ 和 $\\Omega_m(a)$ 通过 $a=e^N$ 成为 $N$ 的函数：\n-   $\\mathcal{H}(a) = a H(a) = a H_0 \\sqrt{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} = H_0 \\sqrt{\\Omega_{m0} a^{-1} + \\Omega_{\\Lambda 0} a^2}$\n-   $\\Omega_m(a) = \\frac{\\Omega_{m0} a^{-3}}{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} = \\frac{\\Omega_{m0}}{\\Omega_{m0} + \\Omega_{\\Lambda 0} a^3}$\n\n在 $H_0 = 1$、$\\Omega_{m0} = 0.3$ 和 $\\Omega_{\\Lambda 0} = 0.7$ 的条件下，我们从初始时间 $a_i = 10^{-3}$ ($N_i = \\ln(10^{-3})$) 到最终时间 $a_f = 1$ ($N_f = 0$) 积分此系统。初始条件对应于物质主导时期深处（$a \\ll 1$）的标准绝热增长模式：$\\Phi(a_i) = \\Phi_0 = 10^{-5}$，$\\delta(a_i) = -2\\Phi_0$ 和 $\\theta(a_i) = 0$。\n\n针对四个不同的波数进行积分：$k/\\mathcal{H}_f = \\{0.01, 1, 10, 100\\}$，其中 $\\mathcal{H}_f = \\mathcal{H}(a_f=1) = H_0\\sqrt{\\Omega_{m0}+\\Omega_{\\Lambda 0}} = 1$。因此，波数为 $k \\in \\{0.01, 1, 10, 100\\}$。使用了一个数值ODE求解器，具体为 `scipy.integrate.solve_ivp`。\n\n在获得最终状态 $[\\delta(a_f), \\theta(a_f), \\Phi(a_f)]$ 后，我们计算牛顿泊松方程的分数残差：\n$$\nR(k) = \\frac{\\left| k^2 \\Phi_f - (4 \\pi G a_f^2 \\bar{\\rho}_f) \\, \\delta_f \\right|}{\\left| (4 \\pi G a_f^2 \\bar{\\rho}_f) \\, \\delta_f \\right|}\n$$\n项 $4 \\pi G a_f^2 \\bar{\\rho}_f$ 使用该恒等式计算：\n$$\n4 \\pi G a_f^2 \\bar{\\rho}(a_f) = \\frac{3}{2} \\mathcal{H}(a_f)^2 \\Omega_m(a_f) = \\frac{3}{2} (1)^2 (0.3) = 0.45\n$$\n然后报告得到的四个 $R(k)$ 值。预期结果是，对于亚视界模式（$k \\gg \\mathcal{H}_f$），$R(k)$ 会很小，而对于超视界模式（$k \\lesssim \\mathcal{H}_f$），$R(k)$ 会较大，这展示了牛顿引力是有效近似的区域。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\n# Main function to encapsulate the solution process.\ndef solve():\n    \"\"\"\n    Numerically integrates the evolution of cosmological perturbations and computes\n    the fractional residual of the Newtonian Poisson equation for different\n    wavenumbers.\n    \"\"\"\n    # Cosmological Parameters\n    OMEGA_M0 = 0.3\n    OMEGA_L0 = 0.7\n    H0 = 1.0  # Dimensionless Hubble constant\n\n    # Integration settings\n    A_I = 1e-3  # Initial scale factor\n    A_F = 1.0   # Final scale factor\n    N_I = np.log(A_I)\n    N_F = np.log(A_F)\n\n    # Initial conditions for adiabatic growing mode\n    PHI_0 = 1e-5\n    DELTA_I = -2.0 * PHI_0\n    THETA_I = 0.0\n    PHI_I = PHI_0\n    Y0 = [DELTA_I, THETA_I, PHI_I]\n\n    # Helper functions for background evolution\n    def h_conf_func(a, omega_m0=OMEGA_M0, omega_l0=OMEGA_L0, h0=H0):\n        \"\"\"Calculates the conformal Hubble rate H_conf = a*H.\"\"\"\n        return h0 * np.sqrt(omega_m0 * a**(-1.0) + omega_l0 * a**(2.0))\n\n    def omega_m_func(a, omega_m0=OMEGA_M0, omega_l0=OMEGA_L0):\n        \"\"\"Calculates the matter density parameter Omega_m(a).\"\"\"\n        return (omega_m0 * a**(-3.0)) / (omega_m0 * a**(-3.0) + omega_l0)\n\n    # ODE system definition for the integrator\n    def ode_system(N, Y, k, omega_m0, omega_l0, h0):\n        \"\"\"\n        Defines the system of ODEs for (delta, theta, Phi) with respect to N = ln(a).\n        Y[0] = delta, Y[1] = theta, Y[2] = Phi\n        \"\"\"\n        delta, theta, phi = Y\n        a = np.exp(N)\n\n        # Calculate background quantities at the current step\n        h_conf = h_conf_func(a, omega_m0, omega_l0, h0)\n        omega_m = omega_m_func(a, omega_m0, omega_l0)\n\n        # The system of ODEs dY/dN\n        # Equation for d(delta)/dN\n        d_delta_dN = ( (9.0/2.0) * omega_m * h_conf / k**2 - 1.0 / h_conf ) * theta - 3.0 * phi\n        # Equation for d(theta)/dN\n        d_theta_dN = -theta + k**2 / h_conf * phi\n        # Equation for d(Phi)/dN\n        d_phi_dN = (3.0/2.0) * omega_m * h_conf / k**2 * theta - phi\n        \n        return [d_delta_dN, d_theta_dN, d_phi_dN]\n\n    # Define the wavenumbers for the test suite\n    h_conf_f = h_conf_func(A_F)\n    test_cases_k = [0.01 * h_conf_f, 1.0 * h_conf_f, 10.0 * h_conf_f, 100.0 * h_conf_f]\n\n    results = []\n    for k_val in test_cases_k:\n        # Numerically integrate the ODE system for the current k\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=[N_I, N_F],\n            y0=Y0,\n            args=(k_val, OMEGA_M0, OMEGA_L0, H0),\n            t_eval=[N_F],\n            method='RK45', # Standard solver, sufficient for this problem\n            rtol=1e-7, atol=1e-12 # Tolerances for high accuracy\n        )\n        \n        # Extract final values of the perturbations\n        delta_f, _, phi_f = sol.y[:, -1]\n\n        # Calculate the fractional residual of the Newtonian Poisson equation\n        # The term 4*pi*G*a^2*rho_m becomes (3/2)*H_conf^2*Omega_m\n        newtonian_coeff = (3.0/2.0) * h_conf_f**2 * omega_m_func(A_F)\n        \n        gr_poisson_term = k_val**2 * phi_f\n        newtonian_poisson_term = newtonian_coeff * delta_f\n        \n        # Guard against division by an extremely small number\n        if abs(newtonian_poisson_term) > 1e-30:\n            residual = np.abs(gr_poisson_term - newtonian_poisson_term) / np.abs(newtonian_poisson_term)\n        else:\n            # This case is not expected in a physical growing mode scenario\n            residual = np.nan\n        \n        results.append(residual)\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\n# Execute the main function to produce the solution.\nsolve()\n```"
        },
        {
            "introduction": "播种了所有宇宙结构的微扰被认为起源于暴胀时期的量子涨落。此练习聚焦于为这些涨落设置初始条件这一关键步骤。您将通过测试最终的超视界微扰振幅如何依赖于我们在视界深处开始模拟的精确时刻，来研究暴胀理论的基石——邦奇-戴维斯真空假设的稳健性 。",
            "id": "3471532",
            "problem": "设计并实现一个程序，以数值方式评估在单场、慢滚参数恒定的背景下曲率微扰的 Bunch–Davies 初始条件的稳健性。具体方法为：在有限的亚视界比率 $k/(aH)=\\alpha \\gg 1$ 处初始化亚视界模式，并通过改变 $\\alpha$ 来量化冻结曲率微扰振幅的敏感性。\n\n您必须在以下一致且自洽的框架内工作：\n\n- 背景和微扰：\n  - 考虑一个单场暴胀背景，其第一慢滚参数 $\\epsilon$ 为常数，其中 $\\epsilon \\in (0,1)$。\n  - 在共形时间 $\\eta  0$ 中进行计算，对于恒定的 $\\epsilon$，标度因子 $a(\\eta)$ 按纯幂律缩放。令 $p \\equiv 1/(1-\\epsilon)$ 并将标度因子的整体归一化设为 1，从而 $a(\\eta) = (-\\eta)^{-p}$。这固定了约定并消除了一个任意的乘法常数。\n  - Mukhanov 变量 $v_k(\\eta)$ 遵循 Mukhanov–Sasaki 方程\n    $$ v_k''(\\eta) + \\left(k^2 - \\frac{z''(\\eta)}{z(\\eta)}\\right) v_k(\\eta) = 0, $$\n    其中在约化普朗克单位（设为 1）下，$z(\\eta) = a(\\eta) \\sqrt{2\\epsilon}$，撇号表示对 $\\eta$ 的导数。对于恒定的 $\\epsilon$，我们有\n    $$ \\frac{z''}{z} = \\frac{a''}{a} = \\frac{p(p+1)}{\\eta^2}. $$\n  - 共动曲率微扰为 $\\zeta_k(\\eta) = v_k(\\eta)/z(\\eta)$，它在超视界尺度上冻结为一个恒定的振幅。\n\n- 初始化协议（有限 Bunch–Davies 近似）：\n  - 精确的 Bunch–Davies 真空要求当 $\\eta \\to -\\infty$ 时，$v_k(\\eta) \\to e^{-ik\\eta}/\\sqrt{2k}$。为了在有限时间近似这一点，使用平面波方案在有限的亚视界比率 $k/(aH)=\\alpha$ 处进行初始化：\n    $$ v_k(\\eta_i) = \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}}, \\quad v_k'(\\eta_i) = -i k \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}}. $$\n  - 使用 $aH = a'/a = -p/\\eta$，亚视界条件 $k/(aH)=\\alpha$ 意味着\n    $$ \\eta_i = -\\frac{p\\,\\alpha}{k}. $$\n\n- 数值任务：\n  - 对于给定的 $\\epsilon$ 和 $k$，将 Mukhanov–Sasaki 方程从 $\\eta=\\eta_i$ 积分到一个最终时间 $\\eta=\\eta_f$，该时间的选择要确保模式已深入超视界，即：\n    $$ \\eta_f = -\\frac{p\\,\\alpha_{\\text{out}}}{k}, \\quad \\text{with} \\quad \\alpha_{\\text{out}} \\ll 1. $$\n  - 在 $\\eta_f$ 处，计算冻结振幅\n    $$ A(\\alpha) \\equiv \\left|\\zeta_k(\\eta_f)\\right| = \\left|\\frac{v_k(\\eta_f)}{z(\\eta_f)}\\right|. $$\n\n- 稳健性度量：\n  - 使用一个大的参考值 $\\alpha_{\\text{ref}}$ 并报告分数偏差\n    $$ \\delta(\\alpha) \\equiv \\frac{A(\\alpha) - A(\\alpha_{\\text{ref}})}{A(\\alpha_{\\text{ref}})}. $$\n  - 这消除了对 $a(\\eta)$ 任意归一化的任何残余依赖性，并隔离了对有限时间初始化的敏感性。\n\n- 参数选择和单位：\n  - 在约化普朗克单位下工作，设 $M_{\\mathrm{pl}}=1$。\n  - 使用以下固定参数：$\\epsilon = 0.01$，$k = 1$，$\\alpha_{\\text{out}} = 10^{-3}$，以及 $\\alpha_{\\text{ref}} = 100$。\n  - 结果是无量纲的。不需要物理单位。\n\n- 测试套件：\n  - 评估初始亚视界深度集合的稳健性度量\n    $$ \\{\\alpha\\} = \\{2, 5, 10, 20, 50, 100\\}. $$\n  - 这些值探测了一个边界情况（$\\alpha=2$）、一些中间情况，并趋近于参考的大数值。\n\n- 输出规格：\n  - 您的程序应按上面列出的顺序为每个 $\\alpha$ 数值积分系统，使用 $\\alpha_{\\text{ref}}=100$ 计算 $\\delta(\\alpha)$，并生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[x1,x2,x3,x4,x5,x6]”）。每个条目必须是浮点数。\n\n约束和实现细节：\n- 计算必须通过显式积分关于 $v_k(\\eta)$ 的二阶常微分方程来完成，该方程需重写为关于实部和虚部的一阶系统。\n- 确保数值精度足以分辨大 $\\alpha$ 时的振荡行为以及跨越视界到 $\\zeta_k$ 冻结的超视界状态的过渡。\n- 不要假设或使用任何 $v_k(\\eta)$ 或 $\\zeta_k(\\eta)$ 的闭式解；解必须通过对所提出的初值问题进行数值积分得到。",
            "solution": "用户的问题是有效的，并将按所述方式解决。该问题在科学上基于宇宙学微扰理论的原理，作为一个数值初值问题是适定的，其参数和目标也得到了足够精确的定义。\n\n该问题要求对单场暴胀期间标量微扰的 Bunch–Davies 真空初始条件的稳健性进行数值研究。标准的 Bunch–Davies 真空定义在无限遥远的过去，即 $\\eta \\to -\\infty$。在数值模拟中，必须从一个有限的时间 $\\eta_i$ 开始，这对应于一个有限的亚视界尺度，在该尺度上模数 $k$ 远大于膨胀率 $aH$。这由比率 $\\alpha = k/(aH) \\gg 1$ 参数化。问题在于量化最终的、超视界曲率微扰振幅如何依赖于这个初始尺度 $\\alpha$ 的选择。\n\n问题的核心是对规范不变变量 $v_k(\\eta)$ 的 Mukhanov–Sasaki 方程进行数值积分。对于具有恒定第一慢滚参数 $\\epsilon$ 的单标量场，该方程为\n$$ v_k''(\\eta) + \\left(k^2 - \\frac{z''(\\eta)}{z(\\eta)}\\right) v_k(\\eta) = 0 $$\n其中撇号表示对共形时间 $\\eta$ 的导数。背景由标度因子 $a(\\eta) = (-\\eta)^{-p}$（其中 $p \\equiv 1/(1-\\epsilon)$）表征，势能项由 $\\frac{z''}{z} = \\frac{a''}{a} = \\frac{p(p+1)}{\\eta^2}$ 给出。变量 $z(\\eta)$ 在约化普朗克单位（$M_{\\text{pl}}=1$）下定义为 $z(\\eta) = a(\\eta) \\sqrt{2\\epsilon}$。\n\n为了求解这个二阶线性复常微分方程（ODE），我们将 Mukhanov 变量 $v_k(\\eta)$ 分解为其实部和虚部，$v_k(\\eta) = v_R(\\eta) + i v_I(\\eta)$。Mukhanov–Sasaki 方程随后分离为两个关于实部和虚部的独立且相同的方程：\n$$ v_R''(\\eta) + \\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) v_R(\\eta) = 0 $$\n$$ v_I''(\\eta) + \\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) v_I(\\eta) = 0 $$\n为了使用标准 ODE 求解器进行数值积分，该系统被重写为一个包含四个一阶 ODE 的系统。令状态向量为 $\\mathbf{y}(\\eta) = [y_0(\\eta), y_1(\\eta), y_2(\\eta), y_3(\\eta)]^T \\equiv [v_R(\\eta), v_R'(\\eta), v_I(\\eta), v_I'(\\eta)]^T$。该系统则由 $\\frac{d\\mathbf{y}}{d\\eta} = \\mathbf{f}(\\eta, \\mathbf{y})$ 描述，其中：\n$$ \\mathbf{f}(\\eta, \\mathbf{y}) = \\begin{pmatrix} y_1 \\\\ -\\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) y_0 \\\\ y_3 \\\\ -\\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) y_2 \\end{pmatrix} $$\n\n积分从对应于亚视界比率 $\\alpha = k/(aH)$ 的初始时间 $\\eta_i$ 开始。使用 $aH = a'/a = -p/\\eta$，我们得到 $\\eta_i = -p\\alpha/k$。在这个时间点，我们施加有限的 Bunch-Davies 初始条件，该条件近似于在 $\\eta \\to -\\infty$ 时成立的纯负频平面波解 $v_k(\\eta) \\approx e^{-ik\\eta}/\\sqrt{2k}$。$v_k$ 及其导数 $v_k'$ 的初始条件为：\n$$ v_k(\\eta_i) = \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}} = \\frac{1}{\\sqrt{2k}}\\left(\\cos(k\\eta_i) - i\\sin(k\\eta_i)\\right) $$\n$$ v_k'(\\eta_i) = -ik \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}} = \\frac{k}{\\sqrt{2k}}\\left(-\\sin(k\\eta_i) - i\\cos(k\\eta_i)\\right) $$\n由此，我们构造初始状态向量 $\\mathbf{y}(\\eta_i)$：\n$$ \\mathbf{y}(\\eta_i) = \\frac{1}{\\sqrt{2k}} \\begin{pmatrix} \\cos(k\\eta_i) \\\\ -k\\sin(k\\eta_i) \\\\ -\\sin(k\\eta_i) \\\\ -k\\cos(k\\eta_i) \\end{pmatrix} $$\n\n积分从 $\\eta = \\eta_i$ 执行到一个最终时间 $\\eta = \\eta_f$，此时模式已深入超视界区域。这对应于一个比率 $\\alpha_{\\text{out}} = k/(aH) \\ll 1$，得出 $\\eta_f = -p\\alpha_{\\text{out}}/k$。在 $\\eta_f$ 处，我们计算共动曲率微扰 $\\zeta_k(\\eta_f) = v_k(\\eta_f)/z(\\eta_f)$。其振幅由下式给出\n$$ A(\\alpha) = |\\zeta_k(\\eta_f)| = \\frac{|v_k(\\eta_f)|}{|z(\\eta_f)|} = \\frac{\\sqrt{v_R(\\eta_f)^2 + v_I(\\eta_f)^2}}{(-\\eta_f)^{-p}\\sqrt{2\\epsilon}} $$\n\n为了量化对初始选择 $\\alpha$ 的敏感性，我们计算振幅 $A(\\alpha)$ 相对于用一个非常大的参考值 $\\alpha_{\\text{ref}}$ 计算出的参考振幅 $A(\\alpha_{\\text{ref}})$ 的分数偏差 $\\delta(\\alpha)$：\n$$ \\delta(\\alpha) = \\frac{A(\\alpha) - A(\\alpha_{\\text{ref}})}{A(\\alpha_{\\text{ref}})} $$\n该度量隔离了因从有限的亚视界尺度 $\\alpha$ 而非从 $\\alpha \\to \\infty$ 开始演化所引入的误差。\n\n算法流程如下：\n1.  定义物理参数：$\\epsilon = 0.01$，$k = 1$，$\\alpha_{\\text{out}} = 10^{-3}$，以及 $\\alpha_{\\text{ref}} = 100$。计算导出参数 $p = 1/(1-\\epsilon)$。\n2.  通过对 $\\alpha = \\alpha_{\\text{ref}}$ 的系统进行数值积分，计算参考振幅 $A(\\alpha_{\\text{ref}})$。\n3.  遍历指定的测试集 $\\{\\alpha\\} = \\{2, 5, 10, 20, 50, 100\\}$。\n4.  对于集合中的每个 $\\alpha$，通过数值积分计算相应的振幅 $A(\\alpha)$。\n5.  为每个测试用例计算稳健性度量 $\\delta(\\alpha)$。\n6.  收集结果并按规定格式化。对于 $\\alpha = \\alpha_{\\text{ref}}$，结果显然为 $\\delta(\\alpha_{\\text{ref}}) = 0$。\n数值积分将使用高精度求解器执行，以精确捕捉早期（$\\eta \\ll -1/k$）的振荡行为和随后在晚期（$\\eta \\gg -1/k$）的冻结。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Numerically assesses the robustness of Bunch-Davies initial conditions\n    for curvature perturbations by varying the initial sub-horizon scale.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    epsilon = 0.01\n    k = 1.0\n    alpha_out = 1e-3\n    alpha_ref = 100.0\n    test_alphas = [2.0, 5.0, 10.0, 20.0, 50.0, 100.0]\n\n    # --- Derived Constants ---\n    p = 1.0 / (1.0 - epsilon)\n    p_p_plus_1 = p * (p + 1.0)\n    sqrt_2k = np.sqrt(2.0 * k)\n    sqrt_2epsilon = np.sqrt(2.0 * epsilon)\n\n    def get_amplitude(alpha):\n        \"\"\"\n        Computes the frozen amplitude A(alpha) by integrating the Mukhanov-Sasaki equation.\n        \"\"\"\n        \n        # --- Time intervals ---\n        # Initial time eta_i, based on alpha = k/(aH)\n        eta_i = -p * alpha / k\n        # Final time eta_f, for deep super-horizon evolution\n        eta_f = -p * alpha_out / k\n\n        # --- Initial Conditions (Finite Bunch-Davies) ---\n        # v_k(eta_i) = exp(-i*k*eta_i) / sqrt(2k)\n        # v_k'(eta_i) = -i*k * v_k(eta_i)\n        cos_k_eta_i = np.cos(k * eta_i)\n        sin_k_eta_i = np.sin(k * eta_i)\n        \n        # State vector y = [v_R, v_R', v_I, v_I']\n        y_i = np.array([\n            cos_k_eta_i / sqrt_2k,          # v_R(eta_i)\n            -k * sin_k_eta_i / sqrt_2k,     # v_R'(eta_i)\n            -sin_k_eta_i / sqrt_2k,         # v_I(eta_i)\n            -k * cos_k_eta_i / sqrt_2k,     # v_I'(eta_i)\n        ])\n\n        # --- ODE System Definition ---\n        # y' = f(eta, y)\n        def mukhanov_sasaki_system(eta, y):\n            # Potential term in MS equation: (k^2 - z''/z)\n            # z''/z = a''/a = p(p+1)/eta^2\n            potential_term = k**2 - p_p_plus_1 / eta**2\n            \n            # y = [v_R, v_R', v_I, v_I']\n            # y' = [v_R', v_R'', v_I', v_I'']\n            return np.array([\n                y[1],                       # y_0' = y_1\n                -potential_term * y[0],     # y_1' = - (k^2 - ...) * y_0\n                y[3],                       # y_2' = y_3\n                -potential_term * y[2]      # y_3' = - (k^2 - ...) * y_2\n            ])\n\n        # --- Numerical Integration ---\n        # Use a high-precision solver from eta_i to eta_f\n        sol = solve_ivp(\n            mukhanov_sasaki_system,\n            [eta_i, eta_f],\n            y_i,\n            method='RK45',\n            t_eval=[eta_f],\n            rtol=1e-9,  # Relative tolerance for accuracy\n            atol=1e-12  # Absolute tolerance for accuracy\n        )\n\n        y_f = sol.y[:, -1]\n        v_R_f = y_f[0]\n        v_I_f = y_f[2]\n\n        # --- Amplitude Calculation ---\n        # v_k(eta_f) = v_R(eta_f) + i*v_I(eta_f)\n        v_k_f_abs = np.sqrt(v_R_f**2 + v_I_f**2)\n        \n        # z(eta_f) = a(eta_f) * sqrt(2*epsilon)\n        # a(eta_f) = (-eta_f)^(-p)\n        a_f = (-eta_f)**(-p)\n        z_f = a_f * sqrt_2epsilon\n        \n        # A(alpha) = |zeta_k(eta_f)| = |v_k(eta_f)/z(eta_f)|\n        amplitude = v_k_f_abs / z_f\n        \n        return amplitude\n\n    # --- Main Calculation Loop ---\n    \n    # 1. Compute reference amplitude\n    A_ref = get_amplitude(alpha_ref)\n    \n    # 2. Compute fractional deviation for each test alpha\n    results = []\n    for alpha in test_alphas:\n        A_alpha = get_amplitude(alpha)\n        delta_alpha = (A_alpha - A_ref) / A_ref\n        results.append(delta_alpha)\n        \n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "微扰理论的一个关键结果是，对于简单的绝热流体，共动曲率微扰 $\\zeta$ 在超视界尺度上是守恒的。本练习旨在检验这一定律的极限。通过积分穆哈诺夫-萨萨基方程，然后引入一个假设的非绝热压力源，您将诊断出 $\\zeta$ 在何种条件下保持恒定，又在何种条件下会发生演化，从而深入理解暴胀后能够改变原初功率谱的物理机制 。",
            "id": "3471482",
            "problem": "实现一个完整的、可运行的程序，对傅里叶模函数 $v_k(\\eta)$ 穿越视界的过程进行数值求解，并在存在微小非绝热源的情况下，诊断共动曲率微扰 $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ 在超视界尺度上的守恒性。您的实现必须遵守以下物理上和数值上自洽的规范。\n\n背景与基本基础：\n- 在一个空间平坦的 Friedmann–Robertson–Walker (FRW) 时空中进行计算，该时空具有共形时间 $\\eta0$ 和标度因子 $a(\\eta)=-1/(H\\eta)$，描述了具有恒定哈勃参数 $H>0$ 的精确 de Sitter 膨胀，即 $a(\\eta)=-1/(H\\eta)$。\n- 考虑一个具有恒定慢滚参数 $\\epsilon$（其中 $0\\epsilon\\ll 1$）的单一正则标量自由度，并采用自然单位制，即 $c=\\hbar=M_{\\rm pl}=1$。\n- 使用 Mukhanov–Sasaki 变量 $v_k(\\eta)$ 和函数 $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}$，使得模方程呈现正则形式\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{z''(\\eta)}{z(\\eta)}\\right)v_k(\\eta)=0,\n$$\n其中撇号表示对共形时间 $\\eta$ 的导数，$k>0$ 是共动波数。\n- 根据上述背景，明确地用 $\\eta$ 表示 $z''(\\eta)/z(\\eta)$，并在您的求解器中使用该解析表达式。\n\n初始条件和数值域：\n- 在远在视界内部施加 Bunch–Davies 初始条件，即在 $\\eta_{\\rm i}=-100/k$ 处：\n$$\nv_k(\\eta_{\\rm i})=\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}},\\quad\nv_k'(\\eta_{\\rm i})=-i k\\,\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}}.\n$$\n- 将模方程沿共形时间向前积分至 $\\eta_{\\rm f}=-10^{-3}/k$，该时间点远在视界出口之后。\n- 在两个超视界时间点计算曲率微扰 $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$：\n$$\n\\eta_{\\rm sh,start}=-\\frac{10^{-1}}{k},\\qquad \\eta_{\\rm sh,end}=-\\frac{10^{-3}}{k}.\n$$\n- 从齐次的 Mukhanov–Sasaki 积分（绝热情况）中，计算 $\\zeta_k$ 的纯数值超视界漂移，作为一个无量纲量\n$$\n\\Delta_{\\rm num}=\\frac{\\left|\\zeta_k(\\eta_{\\rm sh,end})-\\zeta_k(\\eta_{\\rm sh,start})\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\n微小的非绝热源和超视界演化：\n- 对于超视界尺度 $k\\ll aH$，使用经过充分检验的共动曲率微扰的超视界演化方程，\n$$\n\\zeta_k'(\\eta)=-\\frac{\\mathcal{H}(\\eta)}{\\rho(\\eta)+P(\\eta)}\\,\\delta P_{\\rm nad}(\\eta,k),\n$$\n其中 $\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)$ 是共形哈勃参数，$\\rho(\\eta)$ 是背景能量密度，$P(\\eta)$ 是背景压力，$\\delta P_{\\rm nad}$ 是非绝热压力微扰。对于具有恒定 $\\epsilon$ 的正则标量场，在自然单位制中，有 $\\rho(\\eta)+P(\\eta)=2\\epsilon H^2$。\n- 通过以下方式引入一个以视界穿越为中心的微小、局域化的非绝热源\n$$\n\\delta P_{\\rm nad}(\\eta,k)=A_{\\rm nad}\\,(\\rho+P)\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)-\\mu\\bigr)^2}{2\\sigma^2}\\right],\n$$\n其中 $\\mu=0$，因此源在 $-k\\eta=1$ 处达到峰值。使用上述公式，超视界演化变为\n$$\n\\zeta_k'(\\eta)=-\\mathcal{H}(\\eta)\\,A_{\\rm nad}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\n- 为了进行诊断，通过仅在超视界区间 $[\\eta_{\\rm sh,start},\\eta_{\\rm sh,end}]$ 上对上述方程进行积分，来近似计算视界出口后由源引起的漂移。将相应的绝对分数漂移表示为\n$$\n\\Delta_{\\rm src}=\\frac{\\left|\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\zeta_k'(\\eta)\\,d\\eta\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n- 对于给定的容差 $\\text{tol}>0$，当 $\\Delta_{\\rm num}\\leq\\text{tol}$ 和 $\\Delta_{\\rm src}\\leq\\text{tol}$ 同时满足时，判定 $\\zeta_k$ 在超视界尺度上是数值守恒的。\n\n测试套件和要求输出：\n- 所有测试均使用 $H=1$ 和 $\\epsilon=10^{-2}$。不使用角度。在所选的自然单位制中，所有量都是无量纲的。\n- 为以下四个测试用例实现求解器和诊断，每个用例由元组 $(k, A_{\\rm nad}, \\sigma, \\text{tol})$ 指定：\n    1. $(10^{-1}, 0, 3 \\times 10^{-1}, 10^{-3})$。\n    2. $(5 \\times 10^{-2}, 10^{-9}, 3 \\times 10^{-1}, 10^{-3})$。\n    3. $(5 \\times 10^{-2}, 10^{-6}, 5 \\times 10^{-1}, 10^{-3})$。\n    4. $(2 \\times 10^{-2}, 10^{-4}, 1, 10^{-3})$。\n- 对于每个测试用例，计算布尔标志\n$$\n\\text{conserved}=\\bigl(\\Delta_{\\rm num}\\leq\\text{tol}\\bigr)\\ \\wedge\\ \\bigl(\\Delta_{\\rm src}\\leq\\text{tol}\\bigr),\n$$\n并按测试用例的顺序将四个布尔值聚合到一个列表中。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如，“[True,False,True,True]”。不应打印任何其他文本。",
            "solution": "我们在一个空间平坦的 Friedmann–Robertson–Walker (FRW) 时空中进行计算，该时空具有精确的 de Sitter 膨胀、恒定的哈勃参数 $H$、共形时间 $\\eta0$ 以及标度因子 $a(\\eta)=-1/(H\\eta)$。对于一个具有恒定慢滚参数 $\\epsilon$ 的正则标量场，Mukhanov–Sasaki (MS) 变量 $v_k(\\eta)$ 遵循常微分方程\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{z''(\\eta)}{z(\\eta)}\\right)v_k(\\eta)=0,\n$$\n其中 $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}$。共动曲率微扰为 $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$。\n\n步骤 1：在 de Sitter 空间中推导 $z''(\\eta)/z(\\eta)$。\n由于对于恒定的 $\\epsilon$，$z(\\eta)\\propto a(\\eta)$，我们有\n$$\n\\frac{z''(\\eta)}{z(\\eta)}=\\frac{a''(\\eta)}{a(\\eta)}.\n$$\n使用 $a(\\eta)=-\\frac{1}{H\\eta}$，我们计算\n$$\na'(\\eta)=\\frac{1}{H\\eta^2},\\qquad a''(\\eta)=-\\frac{2}{H\\eta^3},\\qquad \\Rightarrow\\ \\frac{a''(\\eta)}{a(\\eta)}=\\frac{-\\frac{2}{H\\eta^3}}{-\\frac{1}{H\\eta}}=\\frac{2}{\\eta^2}.\n$$\n因此，\n$$\n\\frac{z''(\\eta)}{z(\\eta)}=\\frac{2}{\\eta^2}.\n$$\nMS 方程具体化为\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{2}{\\eta^2}\\right)v_k(\\eta)=0.\n$$\n\n步骤 2：初始条件和区域。\n在远在视界内部的 $\\eta_{\\rm i}=-100/k$ 处，Bunch–Davies 真空给出\n$$\nv_k(\\eta_{\\rm i})=\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}},\\qquad v_k'(\\eta_{\\rm i})=-i k\\,\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}}.\n$$\n我们将方程积分至 $\\eta_{\\rm f}=-10^{-3}/k$，该时间点远在视界出口之后。为了评估超视界守恒性，我们记录\n$$\n\\eta_{\\rm sh,start}=-\\frac{10^{-1}}{k},\\qquad \\eta_{\\rm sh,end}=-\\frac{10^{-3}}{k}.\n$$\n在每个时间 $\\eta$，我们还需要 $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}=-\\frac{1}{H\\eta}\\sqrt{2\\epsilon}$；当 $H=1$ 时，此为 $z(\\eta)=-\\sqrt{2\\epsilon}/\\eta$。\n\n我们在两个超视界时间点计算 $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ 并构成纯数值漂移\n$$\n\\Delta_{\\rm num}=\\frac{\\left|\\zeta_k(\\eta_{\\rm sh,end})-\\zeta_k(\\eta_{\\rm sh,start})\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\n步骤 3：微小的非绝热源和超视界漂移。\n在超视界尺度上，忽略空间梯度，共动曲率微扰的演化方程为\n$$\n\\zeta_k'(\\eta)=-\\frac{\\mathcal{H}(\\eta)}{\\rho(\\eta)+P(\\eta)}\\,\\delta P_{\\rm nad}(\\eta,k),\n$$\n其中 $\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)$ 是共形哈勃参数。对于具有恒定 $\\epsilon$ 的正则标量场，在自然单位制中，$\\rho(\\eta)+P(\\eta)=2\\epsilon H^2$。我们选择一个以视界出口为中心的局域化、微小的非绝热源，\n$$\n\\delta P_{\\rm nad}(\\eta,k)=A_{\\rm nad}\\,(\\rho+P)\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\n代入可得\n$$\n\\zeta_k'(\\eta)=-\\mathcal{H}(\\eta)\\,A_{\\rm nad}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\n在精确的 de Sitter 空间中，$\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)=-1/\\eta$，所以\n$$\n\\zeta_k'(\\eta)=\\frac{A_{\\rm nad}}{\\eta}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\n从 $\\eta_{\\rm sh,start}$ 到 $\\eta_{\\rm sh,end}$ 由源引起的超视界漂移为\n$$\n\\Delta\\zeta_{\\rm src}=\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\zeta_k'(\\eta)\\,d\\eta\n=A_{\\rm nad}\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\frac{1}{\\eta}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right]\\,d\\eta.\n$$\n通过换元 $u=\\ln(-k\\eta)$，$du=d\\eta/\\eta$，该积分变为高斯积分：\n$$\n\\Delta\\zeta_{\\rm src}=A_{\\rm nad}\\int_{u_{\\rm start}}^{u_{\\rm end}} e^{-u^2/(2\\sigma^2)}\\,du\n= A_{\\rm nad}\\,\\sqrt{\\frac{\\pi}{2}}\\,\\sigma\\left[\\operatorname{erf}\\!\\left(\\frac{u}{\\sqrt{2}\\,\\sigma}\\right)\\right]_{u_{\\rm start}}^{u_{\\rm end}},\n$$\n其中 $u_{\\rm start}=\\ln(-k\\,\\eta_{\\rm sh,start})$ 和 $u_{\\rm end}=\\ln(-k\\,\\eta_{\\rm sh,end})$。因此，由源引起的绝对分数漂移为\n$$\n\\Delta_{\\rm src}=\\frac{\\left|\\Delta\\zeta_{\\rm src}\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}\n=\\frac{\\left|A_{\\rm nad}\\,\\sqrt{\\frac{\\pi}{2}}\\,\\sigma\\left(\\operatorname{erf}\\!\\left(\\frac{u_{\\rm end}}{\\sqrt{2}\\,\\sigma}\\right)-\\operatorname{erf}\\!\\left(\\frac{u_{\\rm start}}{\\sqrt{2}\\,\\sigma}\\right)\\right)\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\n步骤 4：诊断和测试。\n如果 $\\Delta_{\\rm num}\\leq\\text{tol}$ 和 $\\Delta_{\\rm src}\\leq\\text{tol}$ 同时满足，我们宣布超视界守恒在数值上成立。我们将此应用于四个指定的测试用例：\n1. $(10^{-1}, 0, 3 \\times 10^{-1}, 10^{-3})$。\n2. $(5 \\times 10^{-2}, 10^{-9}, 3 \\times 10^{-1}, 10^{-3})$。\n3. $(5 \\times 10^{-2}, 10^{-6}, 5 \\times 10^{-1}, 10^{-3})$。\n4. $(2 \\times 10^{-2}, 10^{-4}, 1, 10^{-3})$。\n\n算法设计：\n- 通过将 $v_k$ 分解为实部和虚部，将 MS 方程作为一个实的四维系统进行数值积分，以避免复数常微分方程（ODE）的限制。使用具有严格容差的显式 Runge–Kutta 方法，以确保在视界穿越过程中相位和振幅的精确演化。\n- 在 $\\eta_{\\rm sh,start}$ 和 $\\eta_{\\rm sh,end}$ 处计算 $z(\\eta)$ 和 $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$，从而构成 $\\Delta_{\\rm num}$。\n- 使用上述解析高斯积分来计算 $\\Delta_{\\rm src}$，根据构造，该积分在超视界区间上是有效的。\n- 对于每个测试，输出布尔值 $\\text{conserved}=(\\Delta_{\\rm num}\\le \\text{tol})\\wedge(\\Delta_{\\rm src}\\le \\text{tol})$。\n- 将四个布尔值聚合到一个列表中，并按要求的格式单行打印。\n\n科学真实性与覆盖范围：\n- 背景和微扰方程是线性宇宙学微扰理论中标准且经过充分检验的。\n- 测试套件涵盖了：严格绝热的情况（$A_{\\rm nad}=0$）、极小的非绝热性、以及逐渐增大但仍然微小的源，还有不同的尺度 $k$。这确保了求解器能够处理视界前后的区域，并且超视界诊断的行为是一致的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom math import erf, sqrt, pi\n\n# Constants in natural units\nH = 1.0            # Hubble parameter (dimensionless in chosen units)\nepsilon = 1e-2     # slow-roll parameter (constant, small)\n\ndef a_of_eta(eta):\n    # de Sitter: a(eta) = -1/(H*eta), eta  0\n    return -1.0 / (H * eta)\n\ndef z_of_eta(eta):\n    # z = a * sqrt(2*epsilon)\n    return a_of_eta(eta) * np.sqrt(2.0 * epsilon)\n\ndef zpp_over_z(eta):\n    # For de Sitter with constant epsilon, z''/z = a''/a = 2/eta^2\n    return 2.0 / (eta**2)\n\ndef ms_system(eta, y, k):\n    # y = [Re(v), Im(v), Re(v'), Im(v')]\n    vr, vi, vpr, vpi = y\n    coeff = (k**2) - zpp_over_z(eta)\n    dvr = vpr\n    dvi = vpi\n    dvpr = -coeff * vr\n    dvpi = -coeff * vi\n    return [dvr, dvi, dvpr, dvpi]\n\ndef bunch_davies_ic(k, eta_i):\n    # v(eta_i) = exp(-i k eta_i)/sqrt(2k)\n    phase = np.exp(-1j * k * eta_i)\n    v0 = phase / np.sqrt(2.0 * k)\n    vp0 = (-1j * k) * v0\n    return np.array([v0.real, v0.imag, vp0.real, vp0.imag], dtype=float)\n\ndef compute_zeta(vr, vi, eta):\n    v = vr + 1j * vi\n    z = z_of_eta(eta)\n    return v / z\n\ndef sourced_fractional_drift(k, A_nad, sigma, eta_start, eta_end, zeta_ref_abs):\n    # Super-horizon sourced drift integral using analytic Gaussian integral.\n    # zeta' = A_nad * (1/eta) * exp[-(ln(-k eta))^2 / (2 sigma^2)]\n    # Integral over eta -> u = ln(-k eta)\n    u_start = np.log(-k * eta_start)\n    u_end = np.log(-k * eta_end)\n    pref = A_nad * np.sqrt(pi / 2.0) * sigma\n    arg_start = u_start / (np.sqrt(2.0) * sigma)\n    arg_end = u_end / (np.sqrt(2.0) * sigma)\n    delta_zeta = pref * (erf(arg_end) - erf(arg_start))\n    return abs(delta_zeta) / zeta_ref_abs\n\ndef solve_case(k, A_nad, sigma, tol):\n    # Define times\n    eta_i = -100.0 / k\n    eta_sh_start = -1.0e-1 / k\n    eta_sh_end = -1.0e-3 / k\n    eta_f = eta_sh_end\n\n    # Initial conditions\n    y0 = bunch_davies_ic(k, eta_i)\n\n    # Integrate MS equation\n    t_eval = [eta_sh_start, eta_sh_end]\n    sol = solve_ivp(\n        fun=lambda eta, y: ms_system(eta, y, k),\n        t_span=(eta_i, eta_f),\n        y0=y0,\n        t_eval=t_eval,\n        method=\"RK45\",\n        rtol=1e-9,\n        atol=1e-12,\n        dense_output=False,\n        vectorized=False,\n    )\n\n    if not sol.success or sol.y.shape[1] != 2:\n        # Fallback: treat as non-conserved if solver failed\n        return False\n\n    # Extract solutions at the two super-horizon times\n    vr_start, vi_start = sol.y[0, 0], sol.y[1, 0]\n    vr_end, vi_end = sol.y[0, 1], sol.y[1, 1]\n\n    # Compute zeta at start and end\n    zeta_start = compute_zeta(vr_start, vi_start, t_eval[0])\n    zeta_end = compute_zeta(vr_end, vi_end, t_eval[1])\n\n    # Numerical drift from homogeneous MS evolution\n    num_drift = abs(zeta_end - zeta_start) / abs(zeta_start)\n\n    # Sourced super-horizon drift fraction\n    src_drift = sourced_fractional_drift(k, A_nad, sigma, t_eval[0], t_eval[1], abs(zeta_start))\n\n    # Conservation criterion\n    conserved = (num_drift = tol) and (src_drift = tol)\n    return conserved\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (k, A_nad, sigma, tol)\n    test_cases = [\n        (1.0e-1, 0.0, 3.0e-1, 1.0e-3),\n        (5.0e-2, 1.0e-9, 3.0e-1, 1.0e-3),\n        (5.0e-2, 1.0e-6, 5.0e-1, 1.0e-3),\n        (2.0e-2, 1.0e-4, 1.0, 1.0e-3),\n    ]\n\n    results = []\n    for k, A_nad, sigma, tol in test_cases:\n        result = solve_case(k, A_nad, sigma, tol)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}