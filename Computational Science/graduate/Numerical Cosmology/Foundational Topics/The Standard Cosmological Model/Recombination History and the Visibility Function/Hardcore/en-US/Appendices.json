{
    "hands_on_practices": [
        {
            "introduction": "The visibility function, which describes the probability of a photon's last scattering event, is a cornerstone for computing Cosmic Microwave Background (CMB) anisotropies. This practice bridges the gap between abstract theory and concrete computation, allowing you to build this crucial function from the ground up. By numerically constructing the Thomson optical depth $\\tau(z)$ and the visibility function $g(z)$ from a given ionization history, you will gain a tangible understanding of how the universe transitions from opaque to transparent and directly identify the surface of last scattering .",
            "id": "3483730",
            "problem": "You are given a spatially flat Lambda Cold Dark Matter (ΛCDM) cosmology and a smooth model for the free-electron fraction as a function of redshift, denoted by $x_e(z)$. Your task is to construct, from first principles, a numerical method to compute the line-of-sight Thomson optical depth to redshift $z$, denoted by $\\tau(z)$, using the fundamental definitions of radiative transfer in an expanding universe. You will then determine the location $z_\\star$ where the derivative $d\\tau/dz$ attains its maximum within a specified redshift interval, and compare it to the location of the peak of the visibility function, which you must define in terms of $\\tau(z)$ and $d\\tau/dz$.\n\nStart from the following physical bases:\n- The differential optical depth is defined as $d\\tau = n_e \\sigma_T c \\, dt$, where $n_e$ is the free-electron number density, $\\sigma_T$ is the Thomson cross section, and $c$ is the speed of light.\n- The redshift-time relation in an expanding universe is $dt/dz = -\\big[(1+z) H(z)\\big]^{-1}$, where $H(z)$ is the Hubble expansion rate.\n- The Hubble expansion rate in a flat $\\Lambda$ Cold Dark Matter (ΛCDM) cosmology is given by $H(z) = H_0 \\sqrt{\\Omega_r (1+z)^4 + \\Omega_m (1+z)^3 + \\Omega_\\Lambda}$, where $H_0$ is the Hubble constant today, $\\Omega_r$ is the present-day radiation density parameter, $\\Omega_m$ is the present-day matter density parameter, and $\\Omega_\\Lambda$ is the present-day cosmological constant density parameter. Assume spatial flatness so that $\\Omega_r + \\Omega_m + \\Omega_\\Lambda = 1$ need not be enforced numerically in your implementation but is physically the case.\n- The present-day critical density is $\\rho_{c,0} = 3 H_0^2 / (8 \\pi G)$, and the present-day baryon mass density is $\\rho_{b,0} = \\Omega_b \\rho_{c,0}$, where $\\Omega_b$ is the present-day baryon density parameter and $G$ is the gravitational constant.\n- Denote the primordial helium mass fraction by $Y_p$. The hydrogen mass fraction is $X_p = 1 - Y_p$. Assume that helium does not contribute free electrons in the recombination window for this problem, so that $n_e(z) = x_e(z) \\, n_H(z)$ with $n_H(z) = X_p \\rho_b(z) / m_p$ and $\\rho_b(z) = \\rho_{b,0} (1+z)^3$, where $m_p$ is the proton mass.\n\nThe free-electron fraction $x_e(z)$ is modeled as a smooth transition between a fully ionized plasma at high redshift and a small residual ionization at low redshift using a hyperbolic tangent profile centered on a recombination redshift $z_\\mathrm{rec}$ with width $\\Delta_z$ and residual ionization $x_\\mathrm{res}$:\n$$\nx_e(z) = x_\\mathrm{res} + \\frac{1 - x_\\mathrm{res}}{2} \\left[ 1 + \\tanh\\left( \\frac{z - z_\\mathrm{rec}}{\\Delta_z} \\right) \\right].\n$$\n\nDefine the visibility function in redshift space for this problem as\n$$\ng(z) = e^{-\\tau(z)} \\, \\frac{d\\tau}{dz},\n$$\nand interpret the location of its maximum, $z_g$, as the redshift of the last scattering surface.\n\nImplementation requirements:\n- Work entirely in the International System of Units (SI) internally for physical constants. Redshift is dimensionless and must be reported as such.\n- Construct a uniform redshift grid $z_i$ for $i=0,\\dots,N$ spanning $z \\in [0, z_{\\max}]$ for each test case. Compute $\\tau(z)$ on this grid by numerically integrating $d\\tau/dz$ from $z=0$ using a stable cumulative trapezoidal rule. Then compute $g(z)$ on the grid, and locate the maxima of $d\\tau/dz$ and $g(z)$ on the closed interval $[0, z_{\\max}]$ using a simple argmax over the grid values.\n- Report, for each test case, two floating-point redshifts: $z_\\star$ (the location where $d\\tau/dz$ attains its maximum on $[0, z_{\\max}]$) and $z_g$ (the location where $g(z)$ attains its maximum on $[0, z_{\\max}]$). Round each reported redshift to one decimal place. Redshift is dimensionless; no physical unit should be printed.\n\nPhysical constants to use (SI values):\n- $c = 299{,}792{,}458$ meters per second.\n- $\\sigma_T = 6.652\\,458\\,7321 \\times 10^{-29}$ square meters.\n- $G = 6.674\\,30 \\times 10^{-11}$ cubic meters per kilogram per square second.\n- $m_p = 1.672\\,621\\,923\\,69 \\times 10^{-27}$ kilograms.\n- $1$ megaparsec $= 3.085\\,677\\,581 \\times 10^{22}$ meters.\n\nTest suite:\nImplement your program to run the following three test cases. For each case, build the grid size $N$ and upper limit $z_{\\max}$ as specified, and compute the requested outputs.\n\n- Case A (happy path):\n  - $H_0 = 67.66$ kilometers per second per megaparsec.\n  - $\\Omega_m = 0.3111$.\n  - $\\Omega_b = 0.0490$.\n  - $\\Omega_r = 9.236 \\times 10^{-5}$.\n  - $\\Omega_\\Lambda = 0.6888064$.\n  - $Y_p = 0.24$.\n  - $z_\\mathrm{rec} = 1090$.\n  - $\\Delta_z = 80$.\n  - $x_\\mathrm{res} = 2 \\times 10^{-4}$.\n  - $z_{\\max} = 1800$.\n  - $N = 20000$.\n\n- Case B (narrow recombination width):\n  - $H_0 = 70.0$ kilometers per second per megaparsec.\n  - $\\Omega_m = 0.3000$.\n  - $\\Omega_b = 0.0480$.\n  - $\\Omega_r = 9.000 \\times 10^{-5}$.\n  - $\\Omega_\\Lambda = 0.69991$.\n  - $Y_p = 0.24$.\n  - $z_\\mathrm{rec} = 1080$.\n  - $\\Delta_z = 15$.\n  - $x_\\mathrm{res} = 1 \\times 10^{-4}$.\n  - $z_{\\max} = 1600$.\n  - $N = 30000$.\n\n- Case C (lower baryon fraction, different expansion):\n  - $H_0 = 73.0$ kilometers per second per megaparsec.\n  - $\\Omega_m = 0.2700$.\n  - $\\Omega_b = 0.0300$.\n  - $\\Omega_r = 9.000 \\times 10^{-5}$.\n  - $\\Omega_\\Lambda = 0.72991$.\n  - $Y_p = 0.24$.\n  - $z_\\mathrm{rec} = 1050$.\n  - $\\Delta_z = 50$.\n  - $x_\\mathrm{res} = 5 \\times 10^{-4}$.\n  - $z_{\\max} = 1700$.\n  - $N = 20000$.\n\nAnswer specification:\n- For each test case, output a list containing $z_\\star$ and $z_g$, both rounded to one decimal place.\n- Your program should produce a single line of output containing the results as a comma-separated list of the three test-case lists, enclosed in square brackets. For example, the output format must be of the form\n  \"[[zstar_A,zg_A],[zstar_B,zg_B],[zstar_C,zg_C]]\"\nwith the actual numerical values substituted. Redshifts are dimensionless and must be printed without any unit.",
            "solution": "The problem requires the numerical computation of the Thomson scattering optical depth, $\\tau(z)$, and the associated visibility function, $g(z)$, within a flat $\\Lambda$CDM cosmological model. The goal is to determine the redshifts $z_\\star$ and $z_g$ corresponding to the maxima of the derivative of the optical depth, $d\\tau/dz$, and the visibility function, respectively. This will be performed for three distinct sets of cosmological parameters.\n\n### Step 1: Theoretical Formulation\n\nThe fundamental quantity is the differential optical depth, $d\\tau$, experienced by a photon traveling a path length $dl$:\n$$d\\tau = n_e \\sigma_T dl$$\nwhere $n_e$ is the number density of free electrons and $\\sigma_T$ is the Thomson scattering cross-section. For a photon traveling along the line of sight in an expanding universe, the path length element $dl$ is related to the time interval $dt$ by $dl = c \\, dt$. Therefore,\n$$d\\tau = n_e \\sigma_T c \\, dt$$\nIn cosmology, it is more convenient to work with redshift $z$ as the independent variable. The relationship between the differential time interval $dt$ and the differential redshift interval $dz$ is given by:\n$$\\frac{dt}{dz} = -\\frac{1}{(1+z)H(z)}$$\nwhere $H(z)$ is the Hubble expansion rate at redshift $z$. The negative sign indicates that time increases as redshift decreases.\n\nThe total optical depth to a redshift $z$ is the integral of $d\\tau$ from the present day (time $t_0$, redshift $z=0$) to the earlier time $t(z)$ corresponding to that redshift:\n$$\\tau(z) = \\int_{t(z)}^{t_0} n_e(t') \\sigma_T c \\, dt'$$\nBy changing the integration variable from $t'$ to $z'$, we get:\n$$\\tau(z) = \\int_{z}^{0} n_e(z') \\sigma_T c \\left( \\frac{dt}{dz'} \\right) dz' = \\int_{z}^{0} n_e(z') \\sigma_T c \\left( -\\frac{1}{(1+z')H(z')} \\right) dz'$$\nReversing the limits of integration to eliminate the negative sign, we obtain the expression for $\\tau(z)$ as an integral from $z'=0$ to $z'=z$:\n$$\\tau(z) = \\int_{0}^{z} \\frac{n_e(z') \\sigma_T c}{(1+z')H(z')} dz'$$\nFrom this integral form, we can identify the derivative of the optical depth with respect to redshift:\n$$\\frac{d\\tau}{dz} = \\frac{n_e(z) \\sigma_T c}{(1+z)H(z)}$$\n\n### Step 2: Derivation of Quantities in the $\\Lambda$CDM Model\n\nTo evaluate $d\\tau/dz$, we need explicit expressions for $n_e(z)$ and $H(z)$ in the specified cosmological model.\n\nThe Hubble rate in a spatially flat $\\Lambda$CDM universe is:\n$$H(z) = H_0 \\sqrt{\\Omega_r (1+z)^4 + \\Omega_m (1+z)^3 + \\Omega_\\Lambda}$$\nwhere $H_0$ is the Hubble constant, and $\\Omega_r$, $\\Omega_m$, and $\\Omega_\\Lambda$ are the present-day density parameters for radiation, matter, and the cosmological constant, respectively. We can write $H(z) = H_0 E(z)$, where $E(z)$ is the dimensionless evolution function under the square root.\n\nThe free-electron number density $n_e(z)$ is given as a product of the free-electron fraction $x_e(z)$ and the hydrogen number density $n_H(z)$, assuming helium does not contribute significantly to the free electron population during the epoch of hydrogen recombination.\n$$n_e(z) = x_e(z) n_H(z)$$\nThe hydrogen number density $n_H(z)$ is related to the baryon mass density $\\rho_b(z)$. Given a primordial helium mass fraction $Y_p$, the hydrogen mass fraction is $X_p = 1 - Y_p$.\n$$n_H(z) = \\frac{X_p \\rho_b(z)}{m_p}$$\nwhere $m_p$ is the proton mass. The baryon density scales with redshift as $\\rho_b(z) = \\rho_{b,0}(1+z)^3$, where $\\rho_{b,0}$ is the present-day baryon density. This, in turn, is related to the present-day critical density $\\rho_{c,0}$ and the baryon density parameter $\\Omega_b$:\n$$\\rho_{b,0} = \\Omega_b \\rho_{c,0} = \\Omega_b \\frac{3 H_0^2}{8 \\pi G}$$\nwhere $G$ is Newton's gravitational constant.\n\nCombining these expressions for $n_e(z)$:\n$$n_e(z) = x_e(z) \\frac{(1-Y_p)}{m_p} \\left(\\Omega_b \\frac{3 H_0^2}{8 \\pi G}\\right) (1+z)^3$$\nSubstituting $n_e(z)$ and $H(z)$ into the equation for $d\\tau/dz$:\n$$\\frac{d\\tau}{dz} = \\frac{x_e(z) \\left[ \\frac{(1-Y_p)\\Omega_b}{m_p} \\frac{3 H_0^2}{8 \\pi G} (1+z)^3 \\right] \\sigma_T c}{(1+z)H_0 E(z)}$$\nSimplifying this expression by collecting constants gives:\n$$\\frac{d\\tau}{dz} = \\left[ \\frac{3 H_0 \\sigma_T c (1-Y_p) \\Omega_b}{8 \\pi G m_p} \\right] x_e(z) \\frac{(1+z)^2}{E(z)}$$\nThe term in square brackets is a constant for a given cosmology, which we can pre-calculate to simplify the numerical computation. Let us denote this constant by $\\mathcal{C}$. The free-electron fraction $x_e(z)$ is given by the specified hyperbolic tangent model.\n\n### Step 3: Visibility Function and Peak Locations\n\nThe visibility function $g(z)$ is defined as:\n$$g(z) = e^{-\\tau(z)} \\frac{d\\tau}{dz}$$\nThis function can be interpreted as the probability density function for the redshift of last scattering. That is, $g(z)dz$ is the probability that a CMB photon observed today last scattered between redshift $z$ and $z+dz$. The peak of this function, $z_g$, is therefore a crucial observable, representing the most probable redshift of the last scattering surface.\n\nWe are asked to find the redshifts $z_\\star$ and $z_g$ which maximize $d\\tau/dz$ and $g(z)$, respectively.\n- $z_\\star$ is the redshift where the interaction rate per unit redshift is maximal.\n- $z_g$ is the redshift where the probability of last scattering is maximal.\n\nTo find the maximum of $g(z)$, we set its derivative to zero. Let $f(z) = d\\tau/dz$. Then $g(z) = f(z)e^{-\\tau(z)}$.\n$$g'(z) = f'(z)e^{-\\tau(z)} - f(z)\\tau'(z)e^{-\\tau(z)} = e^{-\\tau(z)}[f'(z) - (f(z))^2] = 0$$\nThis implies $f'(z_g) = (f(z_g))^2$.\nThe peak of $f(z) = d\\tau/dz$ occurs at $z_\\star$, where $f'(z_\\star) = 0$. At this redshift, the derivative of the visibility function is $g'(z_\\star) = -e^{-\\tau(z_\\star)}(f(z_\\star))^2 < 0$. Since the derivative of $g(z)$ is negative at $z=z_\\star$, it means $g(z)$ is a decreasing function at that point. Consequently, the peak of the visibility function must occur at a lower redshift, i.e., $z_g < z_\\star$. The factor $e^{-\\tau(z)}$, which represents the probability of a photon reaching the observer without further scattering, is a monotonically decreasing function of $z$ and thus shifts the peak of the product $g(z)$ to lower redshifts compared to the peak of $d\\tau/dz$.\n\n### Step 4: Numerical Algorithm\n\nThe problem is solved numerically following these steps for each test case:\n1.  **Setup and Unit Conversion**: All physical constants ($c, \\sigma_T, G, m_p$) are defined in SI units. The Hubble constant $H_0$, given in km s$^{-1}$ Mpc$^{-1}$, is converted to s$^{-1}$ using the provided conversion factor for megaparsecs to meters.\n2.  **Redshift Grid**: A uniform redshift grid $z_i$ is created from $z=0$ to $z=z_{\\max}$ with $N+1$ points.\n3.  **Compute $d\\tau/dz$**: The constant factor $\\mathcal{C}$ is calculated. Then, for each point $z_i$ on the grid, the functions $E(z_i)$ and $x_e(z_i)$ are evaluated, and the array for $d\\tau/dz$ is computed using the derived formula.\n4.  **Compute $\\tau(z)$**: The optical depth $\\tau(z_i)$ is computed by numerically integrating the $d\\tau/dz$ array from $z=0$ up to each $z_i$. The `scipy.integrate.cumulative_trapezoid` function is well-suited for this, as it efficiently implements the cumulative trapezoidal rule. We ensure $\\tau(0)=0$.\n5.  **Compute $g(z)$**: Using the computed arrays for $\\tau(z)$ and $d\\tau/dz$, the visibility function $g(z_i)$ is evaluated at each grid point.\n6.  **Find Maxima**: The `numpy.argmax` function is used to find the indices of the maximum values in the $d\\tau/dz$ and $g(z)$ arrays. These indices correspond to the grid locations of $z_\\star$ and $z_g$.\n7.  **Report Results**: The resulting redshift values $z_\\star$ and $z_g$ are rounded to one decimal place and stored. The final output is formatted as a list of lists.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the redshifts of maximum interaction rate (z_star) and maximum\n    visibility (z_g) for given cosmological models.\n    \"\"\"\n    # Physical constants in SI units\n    C_LIGHT = 299792458.0          # Speed of light (m/s)\n    SIGMA_T = 6.6524587321e-29     # Thomson cross-section (m^2)\n    G_NEWTON = 6.67430e-11         # Gravitational constant (m^3 kg^-1 s^-2)\n    M_P = 1.67262192369e-27        # Proton mass (kg)\n    MPC_TO_M = 3.085677581e22      # Megaparsec to meters conversion\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"H0_km_s_Mpc\": 67.66, \"Omega_m\": 0.3111, \"Omega_b\": 0.0490,\n            \"Omega_r\": 9.236e-5, \"Omega_L\": 0.6888064, \"Yp\": 0.24,\n            \"z_rec\": 1090.0, \"Delta_z\": 80.0, \"x_res\": 2e-4,\n            \"z_max\": 1800, \"N\": 20000\n        },\n        {\n            \"H0_km_s_Mpc\": 70.0, \"Omega_m\": 0.3000, \"Omega_b\": 0.0480,\n            \"Omega_r\": 9.000e-5, \"Omega_L\": 0.69991, \"Yp\": 0.24,\n            \"z_rec\": 1080.0, \"Delta_z\": 15.0, \"x_res\": 1e-4,\n            \"z_max\": 1600, \"N\": 30000\n        },\n        {\n            \"H0_km_s_Mpc\": 73.0, \"Omega_m\": 0.2700, \"Omega_b\": 0.0300,\n            \"Omega_r\": 9.000e-5, \"Omega_L\": 0.72991, \"Yp\": 0.24,\n            \"z_rec\": 1050.0, \"Delta_z\": 50.0, \"x_res\": 5e-4,\n            \"z_max\": 1700, \"N\": 20000\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Convert H0 to SI units (s^-1)\n        H0_si = case[\"H0_km_s_Mpc\"] * 1000.0 / MPC_TO_M\n        \n        # Pre-compute the constant factor for d(tau)/dz\n        # C = (3 * H0 * sigma_T * c * (1 - Yp) * Omega_b) / (8 * pi * G * m_p)\n        prefactor = (3 * H0_si * SIGMA_T * C_LIGHT * (1 - case[\"Yp\"]) * case[\"Omega_b\"]) / \\\n                    (8 * np.pi * G_NEWTON * M_P)\n\n        # Create a uniform redshift grid\n        z_grid = np.linspace(0, case[\"z_max\"], case[\"N\"] + 1)\n        one_plus_z = 1 + z_grid\n        \n        # Dimensionless Hubble parameter evolution E(z) = H(z)/H0\n        E_z = np.sqrt(case[\"Omega_r\"] * one_plus_z**4 + \n                      case[\"Omega_m\"] * one_plus_z**3 + \n                      case[\"Omega_L\"])\n        \n        # Free-electron fraction x_e(z) using the tanh model\n        x_e_z = case[\"x_res\"] + (1 - case[\"x_res\"]) / 2.0 * \\\n              (1 + np.tanh((z_grid - case[\"z_rec\"]) / case[\"Delta_z\"]))\n        \n        # Differential optical depth d(tau)/dz\n        dtau_dz = prefactor * x_e_z * (one_plus_z**2) / E_z\n        \n        # Total optical depth tau(z) by cumulative trapezoidal integration\n        # tau(z) is the integral of d(tau)/dz' from z'=0 to z.\n        # cumulative_trapezoid with initial=0 gives an array of the same size as input.\n        tau_z = cumulative_trapezoid(dtau_dz, z_grid, initial=0)\n        \n        # Visibility function g(z) = exp(-tau(z)) * d(tau)/dz\n        g_z = np.exp(-tau_z) * dtau_dz\n        \n        # Find redshift of maximum d(tau)/dz\n        idx_star = np.argmax(dtau_dz)\n        z_star = z_grid[idx_star]\n        \n        # Find redshift of maximum g(z)\n        idx_g = np.argmax(g_z)\n        z_g = z_grid[idx_g]\n        \n        # Store the rounded results for this case\n        results.append([round(z_star, 1), round(z_g, 1)])\n\n    # Final print statement in the exact required format.\n    print(f\"{results}\".replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "While cosmic recombination was a gradual process spanning thousands of years, it is often modeled as an instantaneous event to simplify calculations of CMB anisotropies. This exercise provides critical insight into the validity and limitations of this powerful approximation. Using a physically motivated toy model, you will analytically quantify the error introduced by the instantaneous recombination approximation, building intuition for how the finite duration of recombination leads to a characteristic damping of small-scale (high-$\\ell$) power in the CMB .",
            "id": "3483675",
            "problem": "Consider the line-of-sight formulation for Cosmic Microwave Background (CMB) anisotropies in conformal time $\\eta$, in which a source term $s(\\eta)$ is weighted by the photon visibility function $g(\\eta)$ and integrated over $\\eta$ to give the observed contribution $I \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$. The visibility function $g(\\eta)$ is nonnegative, sharply peaked at the recombination time $\\eta_{\\star}$, and normalized so that $\\int_{-\\infty}^{\\infty} g(\\eta)\\,d\\eta = 1$. In the instantaneous recombination approximation, one assumes $g(\\eta)$ is infinitely narrow about $\\eta_{\\star}$, effectively $g(\\eta)\\to \\delta(\\eta-\\eta_{\\star})$, so that the integral is replaced by $I_{\\mathrm{IA}} \\equiv s(\\eta_{\\star})$.\n\nTo quantify how the narrowness of $g(\\eta)$ justifies the instantaneous recombination approximation and to estimate the resulting error, adopt the following controlled, physically motivated model:\n- Model the visibility function as a normalized Gaussian,\n$$\ng(\\eta) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right],\n$$\nwith width parameter $\\sigma \\ll \\eta_{\\star}$.\n- Model the local time dependence of the source term near last scattering by a smooth oscillatory form,\n$$\ns(\\eta) \\equiv \\cos\\!\\big(\\omega\\,(\\eta-\\eta_{\\star})\\big),\n$$\nwhich captures the acoustic oscillation behavior with angular frequency $\\omega$.\n\nTasks:\n1. Starting from the central-moment expansion of a smooth function against a narrow, normalized kernel, derive the first nontrivial correction to $I$ in powers of $\\sigma$ and state the condition on $\\sigma$ and $\\omega$ under which $I \\approx I_{\\mathrm{IA}}$ is accurate.\n2. Compute the exact integral $I_{\\mathrm{exact}} \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$ for the given $g(\\eta)$ and $s(\\eta)$.\n3. Define the fractional error of the instantaneous recombination approximation relative to the exact integral by\n$$\nE(\\omega,\\sigma) \\equiv \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}.\n$$\nDerive a single closed-form analytic expression for $E(\\omega,\\sigma)$.\n\nYour final answer must be a single closed-form analytic expression for $E(\\omega,\\sigma)$ with no units. If you choose to present any intermediate numerical estimates, do not include them in the final answer. If you present a numerical approximation for illustration, round it to four significant figures and clearly identify it as an illustration only, not the final answer.",
            "solution": "The problem statement is first validated against the criteria of scientific soundness, well-posedness, and objectivity.\n\n### Step 1: Extract Givens\n- The observed contribution to CMB anisotropies is given by the integral $I \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$.\n- The visibility function $g(\\eta)$ is nonnegative, sharply peaked at $\\eta_{\\star}$, and normalized such that $\\int_{-\\infty}^{\\infty} g(\\eta)\\,d\\eta = 1$.\n- The instantaneous recombination approximation (IA) is defined by replacing $g(\\eta)$ with a Dirac delta function, $g(\\eta) \\to \\delta(\\eta-\\eta_{\\star})$, yielding $I_{\\mathrm{IA}} \\equiv s(\\eta_{\\star})$.\n- The model for the visibility function is a normalized Gaussian: $g(\\eta) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right]$, with width $\\sigma \\ll \\eta_{\\star}$.\n- The model for the source term is a smooth oscillatory function: $s(\\eta) \\equiv \\cos\\!\\big(\\omega\\,(\\eta-\\eta_{\\star})\\big)$.\n- The exact integral is denoted $I_{\\mathrm{exact}} \\equiv \\int_{-\\infty}^{\\infty} g(\\eta)\\,s(\\eta)\\,d\\eta$.\n- The fractional error is defined as $E(\\omega,\\sigma) \\equiv \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a well-structured exercise in theoretical physics, specifically in the context of numerical cosmology.\n- **Scientifically Grounded**: The premise is sound. The line-of-sight integral is the fundamental formalism for computing CMB anisotropies. The visibility function describes the probability density of last scattering, and its finite width is a key physical feature. The instantaneous recombination approximation is a standard, widely used simplification. The use of a Gaussian for the visibility function and a cosine for the source term are physically motivated and common simplifying models for pedagogical and analytical purposes. The problem does not violate any scientific principles.\n- **Well-Posed**: The problem is mathematically well-posed. The functions $g(\\eta)$ and $s(\\eta)$ are well-defined, and the integral $I$ is convergent. The tasks are specified clearly, leading to a unique and meaningful solution.\n- **Objective**: The language is precise and free of subjectivity. All terms are defined analytically.\n- **Completeness**: The problem is self-contained and provides all necessary information to perform the requested derivations and calculations.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. The solution process will now proceed.\n\n### Solution Derivation\n\nThe problem is addressed in three parts as requested.\n\n#### 1. First Nontrivial Correction and Accuracy Condition\n\nWe begin with the integral $I = \\int_{-\\infty}^{\\infty} g(\\eta) s(\\eta) d\\eta$. The function $s(\\eta)$ is smooth, and the kernel $g(\\eta)$ is sharply peaked at $\\eta = \\eta_{\\star}$. We can Taylor expand $s(\\eta)$ about $\\eta_{\\star}$:\n$$\ns(\\eta) = s(\\eta_{\\star}) + (\\eta - \\eta_{\\star}) s'(\\eta_{\\star}) + \\frac{1}{2!} (\\eta - \\eta_{\\star})^2 s''(\\eta_{\\star}) + \\mathcal{O}((\\eta - \\eta_{\\star})^3)\n$$\nSubstituting this expansion into the integral for $I$:\n$$\nI = \\int_{-\\infty}^{\\infty} g(\\eta) \\left[ s(\\eta_{\\star}) + (\\eta - \\eta_{\\star}) s'(\\eta_{\\star}) + \\frac{1}{2} (\\eta - \\eta_{\\star})^2 s''(\\eta_{\\star}) + \\dots \\right] d\\eta\n$$\nBy linearity of integration, we can write this as a sum of moments of the distribution $g(\\eta)$:\n$$\nI = s(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} g(\\eta) d\\eta + s'(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star}) g(\\eta) d\\eta + \\frac{1}{2} s''(\\eta_{\\star}) \\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star})^2 g(\\eta) d\\eta + \\dots\n$$\nThe integrals correspond to the moments of $g(\\eta)$ about its mean $\\eta_{\\star}$.\n- The zeroth moment is the normalization of the probability density: $\\int_{-\\infty}^{\\infty} g(\\eta) d\\eta = 1$.\n- The first central moment is the mean deviation, which is zero for a symmetric distribution centered at $\\eta_{\\star}$: $\\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star}) g(\\eta) d\\eta = 0$.\n- The second central moment is the variance, which for the given Gaussian model is $\\sigma^2$: $\\int_{-\\infty}^{\\infty} (\\eta - \\eta_{\\star})^2 g(\\eta) d\\eta = \\sigma^2$.\n\nSubstituting these moment values, the expansion for $I$ becomes:\n$$\nI = s(\\eta_{\\star}) + \\frac{\\sigma^2}{2} s''(\\eta_{\\star}) + \\mathcal{O}(\\sigma^4)\n$$\nThe instantaneous recombination approximation is $I_{\\mathrm{IA}} = s(\\eta_{\\star})$. The first nontrivial correction to this approximation is the term of order $\\sigma^2$, which is $\\frac{\\sigma^2}{2} s''(\\eta_{\\star})$.\n\nFor the given source term $s(\\eta) = \\cos(\\omega(\\eta - \\eta_{\\star}))$, we compute its derivatives at $\\eta_{\\star}$:\n- $s(\\eta_{\\star}) = \\cos(0) = 1$.\n- $s'(\\eta) = -\\omega \\sin(\\omega(\\eta - \\eta_{\\star})) \\implies s'(\\eta_{\\star}) = 0$.\n- $s''(\\eta) = -\\omega^2 \\cos(\\omega(\\eta - \\eta_{\\star})) \\implies s''(\\eta_{\\star}) = -\\omega^2$.\n\nThus, the approximation for $I$ is:\n$$\nI \\approx 1 - \\frac{\\omega^2 \\sigma^2}{2}\n$$\nThe approximation $I \\approx I_{\\mathrm{IA}} = 1$ is accurate when the magnitude of the correction term is much smaller than the leading term. This gives the condition:\n$$\n\\left| -\\frac{\\omega^2 \\sigma^2}{2} \\right| \\ll 1 \\implies \\frac{\\omega^2 \\sigma^2}{2} \\ll 1\n$$\nThis is equivalent to $\\omega \\sigma \\ll \\sqrt{2}$, or more generally stated as a condition on the scales, $\\omega \\sigma \\ll 1$. This means the oscillation period of the source ($2\\pi/\\omega$) is much larger than the duration of recombination ($\\sim \\sigma$).\n\n#### 2. Exact Integral Calculation\n\nWe compute the exact integral $I_{\\mathrm{exact}}$:\n$$\nI_{\\mathrm{exact}} = \\int_{-\\infty}^{\\infty} g(\\eta) s(\\eta) d\\eta = \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left[-\\frac{(\\eta-\\eta_{\\star})^{2}}{2\\sigma^{2}}\\right] \\cos(\\omega(\\eta-\\eta_{\\star})) d\\eta\n$$\nLet's introduce the substitution $x = \\eta - \\eta_{\\star}$, so $dx = d\\eta$. The integration limits remain $(-\\infty, \\infty)$:\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\cos(\\omega x) dx\n$$\nThis integral can be solved by recognizing that $\\cos(\\omega x) = \\Re\\{\\exp(i\\omega x)\\}$. The integral is the real part of the Fourier transform of a Gaussian function.\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\Re\\left\\{ \\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\exp(i\\omega x) dx \\right\\}\n$$\nThe inner integral is of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2 + bx) dx$ with $a = 1/(2\\sigma^2)$ and $b = i\\omega$. This standard Gaussian integral evaluates to $\\sqrt{\\pi/a} \\exp(b^2/(4a))$.\n- $a = \\frac{1}{2\\sigma^2}$\n- $b^2/(4a) = (i\\omega)^2 / (4 \\cdot \\frac{1}{2\\sigma^2}) = -\\omega^2 / (\\frac{2}{\\sigma^2}) = -\\frac{\\omega^2\\sigma^2}{2}$.\n- $\\sqrt{\\pi/a} = \\sqrt{\\pi \\cdot 2\\sigma^2} = \\sqrt{2\\pi}\\sigma$.\n\nSo the complex integral is:\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left[-\\frac{x^2}{2\\sigma^2}\\right] \\exp(i\\omega x) dx = \\sqrt{2\\pi}\\sigma \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\nSubstituting this back into the expression for $I_{\\mathrm{exact}}$:\n$$\nI_{\\mathrm{exact}} = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\Re\\left\\{ \\sqrt{2\\pi}\\sigma \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right) \\right\\}\n$$\nSince the expression inside the real part operator is already real, we get:\n$$\nI_{\\mathrm{exact}} = \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\n\nAlternatively, the integral represents the value of the characteristic function of a normal distribution with mean $0$ and variance $\\sigma^2$ evaluated at $\\omega$. The characteristic function $\\phi_X(t) = \\mathbb{E}[\\exp(itX)] = \\exp(i\\mu t - \\frac{1}{2}\\sigma^2 t^2)$. For $\\mu=0$, $\\phi_X(t) = \\exp(-\\frac{1}{2}\\sigma^2 t^2)$. The integral $\\int P(x)\\cos(\\omega x) dx = \\Re\\{\\mathbb{E}[\\exp(i\\omega X)]\\} = \\Re\\{\\phi_X(\\omega)\\} = \\exp(-\\frac{1}{2}\\sigma^2 \\omega^2)$.\n\n#### 3. Fractional Error Calculation\n\nThe fractional error is defined as $E(\\omega,\\sigma) = \\frac{I_{\\mathrm{IA}} - I_{\\mathrm{exact}}}{I_{\\mathrm{IA}}}$.\nWe have the necessary components:\n- $I_{\\mathrm{IA}} = s(\\eta_{\\star}) = \\cos(\\omega(\\eta_{\\star}-\\eta_{\\star})) = \\cos(0) = 1$.\n- $I_{\\mathrm{exact}} = \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)$.\n\nSubstituting these into the definition of the error:\n$$\nE(\\omega,\\sigma) = \\frac{1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)}{1}\n$$\nThis simplifies to the final closed-form analytic expression for the fractional error:\n$$\nE(\\omega,\\sigma) = 1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)\n$$\nAs a consistency check, we can expand this for small $\\omega\\sigma$. Using the Taylor series $\\exp(-x) \\approx 1 - x + x^2/2 - \\dots$ with $x = \\omega^2\\sigma^2/2$:\n$$\nE(\\omega,\\sigma) \\approx 1 - \\left(1 - \\frac{\\omega^2\\sigma^2}{2}\\right) = \\frac{\\omega^2\\sigma^2}{2}\n$$\nThis matches the relative error derived from the first-order correction in Part 1, $\\frac{I_{\\mathrm{IA}} - I}{I_{\\mathrm{IA}}} = \\frac{1 - (1 - \\omega^2\\sigma^2/2)}{1} = \\frac{\\omega^2\\sigma^2}{2}$, confirming the consistency of our results.",
            "answer": "$$\n\\boxed{1 - \\exp\\left(-\\frac{\\omega^2\\sigma^2}{2}\\right)}\n$$"
        },
        {
            "introduction": "Precision cosmology hinges on understanding how uncertainties in fundamental physical processes, such as the recombination history, propagate to our final observables. This advanced practice offers a direct look into this form of sensitivity analysis, a vital tool in modern cosmological research. You will derive and numerically implement the linear response of the visibility function, $\\delta g(\\eta)/g(\\eta)$, to small perturbations in the free-electron fraction, $x_e(\\eta)$, revealing the direct link between the microphysics of recombination and the macroscopic structure of the last scattering surface .",
            "id": "3483751",
            "problem": "You are to build a numerical pipeline to construct the visibility function $g(\\eta)$ from the definition of the Thomson optical depth $\\tau(\\eta)$ and quantify the linear response of $g(\\eta)$ to small fractional perturbations in the free-electron fraction $x_{e}(\\eta)$. Work entirely in conformal time $\\eta$, and treat all quantities as dimensionless by fixing the present conformal time to $\\eta_{0}=1$. Your task must be performed using only the definitions and well-tested relations listed below, and must be implemented as a complete, runnable program as specified in the final section.\n\nDefinitions and assumptions to be used as the fundamental base:\n- The conformal time $\\eta$ is related to the scale factor $a(\\eta)$. Over the redshift range of hydrogen recombination, matter domination is a good approximation, so you may model $a(\\eta)$ as $a(\\eta)=\\left(\\eta/\\eta_{0}\\right)^{2}$.\n- The optical depth from conformal time $\\eta$ to the present is defined by\n$$\n\\tau(\\eta)=\\int_{\\eta}^{\\eta_{0}} a(\\eta')\\, n_{e}(\\eta')\\, \\sigma_{T}\\, d\\eta' ,\n$$\nwhere $n_{e}(\\eta)$ is the free-electron number density, and $\\sigma_{T}$ is the Thomson cross-section, both taken as constants in the sense that $\\sigma_{T}$ does not depend on $\\eta$ and $n_{e}$ depends on $\\eta$ only through $x_{e}(\\eta)$ and $a(\\eta)$ as specified below. By definition, let $\\dot{\\tau}(\\eta)\\equiv a(\\eta)\\,n_{e}(\\eta)\\,\\sigma_{T}$.\n- The visibility function $g(\\eta)$ is the differential probability density for photon last scattering in the conformal time interval $[\\eta,\\eta+d\\eta]$. Construct $g(\\eta)$ from the probability for free streaming without scattering between $\\eta$ and $\\eta_{0}$ and the instantaneous scattering rate at $\\eta$.\n- The comoving hydrogen number density scales as $n_{H}(\\eta)=n_{H0}\\, a(\\eta)^{-3}$, with $n_{H0}$ a constant. The free-electron density is $n_{e}(\\eta)=x_{e}(\\eta)\\, n_{H}(\\eta)$.\n- Model the unperturbed recombination history by a smooth transition in $x_{e}(\\eta)$ from a fully ionized state at early times to a small residual ionization at late times using the following form:\n$$\nx_{e}^{(0)}(\\eta)=x_{\\mathrm{res}}+\\frac{1}{2}\\,\\bigl(x_{\\mathrm{pre}}-x_{\\mathrm{res}}\\bigr)\\,\\Bigl[1-\\tanh\\Bigl(\\frac{\\eta-\\eta_{c}}{w}\\Bigr)\\Bigr],\n$$\nwhere $x_{\\mathrm{pre}}=1.0$ is the pre-recombination ionization fraction, $x_{\\mathrm{res}}=2\\times 10^{-4}$ is the post-recombination residual ionization fraction, $\\eta_{c}=0.03\\,\\eta_{0}$ is the center of the transition, and $w=0.01\\,\\eta_{0}$ is the transition width.\n- Use $n_{H0}\\,\\sigma_{T}\\,\\eta_{0}=10^{-4}$ to set the overall normalization of the optical depth in these dimensionless units.\n- Assume small perturbations in the free-electron fraction are applied multiplicatively: $x_{e}(\\eta)\\to x_{e}^{(0)}(\\eta)\\,\\bigl[1+\\delta x_{e}(\\eta)/x_{e}(\\eta)\\bigr]$, with $\\left|\\delta x_{e}/x_{e}\\right|\\ll 1$. Derive the first-order fractional change in the visibility function, $\\delta g(\\eta)/g(\\eta)$, expressed in terms of $\\delta x_{e}(\\eta)/x_{e}(\\eta)$ and the unperturbed background quantities. Your derivation must begin from the definitions above and the interpretation of $g(\\eta)$ as a differential probability density, and must not introduce any additional empirically fitted formulas.\n\nComputational tasks to implement:\n1. Construct a uniform grid in conformal time $\\eta\\in[\\eta_{\\min},\\eta_{0}]$ with $\\eta_{\\min}=10^{-4}\\,\\eta_{0}$ and $\\eta_{0}=1$. On this grid, compute $a(\\eta)$, $n_{e}(\\eta)$, $\\dot{\\tau}(\\eta)$, the optical depth $\\tau(\\eta)$ from $\\eta$ to $\\eta_{0}$, and the visibility function $g(\\eta)$.\n2. Determine the peak location $\\eta_{\\ast}$ where $g(\\eta)$ attains its global maximum on $[\\eta_{\\min},\\eta_{0}]$. Report the dimensionless value $\\eta_{\\ast}$ in units of $\\eta_{0}$.\n3. Define three small perturbation profiles for $\\delta x_{e}(\\eta)/x_{e}(\\eta)$ with a common amplitude $\\epsilon=10^{-3}$:\n   - Case A (constant): $\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon$ for all $\\eta$.\n   - Case B (Gaussian, localized near recombination): $\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon\\,\\exp\\Bigl(-\\frac{(\\eta-\\eta_{c})^{2}}{2\\,\\sigma^{2}}\\Bigr)$ with $\\sigma=0.005\\,\\eta_{0}$.\n   - Case C (oscillatory): $\\delta x_{e}(\\eta)/x_{e}(\\eta)=\\epsilon\\,\\cos\\Bigl(2\\pi\\,\\frac{\\eta/\\eta_{0}}{P}\\Bigr)$ with $P=0.05$.\n4. Using your first-order expression for $\\delta g(\\eta)/g(\\eta)$, compute the response for each perturbation case on the same grid. To avoid domination by times where the visibility weight is negligible, restrict the evaluation of maxima to the subset of the grid where $g(\\eta)/\\max_{\\eta}g(\\eta)\\ge 10^{-8}$.\n5. For each perturbation case, compute:\n   - The maximum absolute fractional change over the restricted domain, $\\max_{\\eta}\\left|\\delta g(\\eta)/g(\\eta)\\right|$.\n   - The fractional change at the baseline peak, $\\left.\\delta g(\\eta)/g(\\eta)\\right|_{\\eta=\\eta_{\\ast}}$.\n6. Numerical units and precision: all quantities are dimensionless by construction. Report all outputs as floating-point numbers.\n\nTest suite:\n- Use exactly the parameter values listed above. The three perturbation cases A, B, and C form the test suite. The required outputs are:\n  - The baseline peak location $\\eta_{\\ast}$.\n  - For each case (A, B, C), the pair of floats $\\bigl[\\max_{\\eta}\\left|\\delta g/g\\right|,\\ \\left.\\delta g/g\\right|_{\\eta=\\eta_{\\ast}}\\bigr]$ computed under the restriction $g/\\max g\\ge 10^{-8}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\bigl[\\ \\eta_{\\ast},\\ \\max|\\delta g/g|_{\\mathrm{A}},\\ (\\delta g/g)_{\\mathrm{A}}(\\eta_{\\ast}),\\ \\max|\\delta g/g|_{\\mathrm{B}},\\ (\\delta g/g)_{\\mathrm{B}}(\\eta_{\\ast}),\\ \\max|\\delta g/g|_{\\mathrm{C}},\\ (\\delta g/g)_{\\mathrm{C}}(\\eta_{\\ast})\\ \\bigr].\n$$\nAll seven values must be printed as floating-point numbers. No additional text should be printed.",
            "solution": "The problem requires the development of a numerical pipeline to compute the cosmological visibility function $g(\\eta)$ and its linear response to fractional perturbations in the free-electron fraction, $\\delta x_{e}(\\eta)/x_{e}(\\eta)$. The solution is constructed by first deriving the necessary analytical expressions from the provided definitions and then implementing them numerically.\n\n**1. Theoretical Framework**\n\n**1.1. The Visibility Function**\n\nThe visibility function $g(\\eta)$ represents the probability density that a photon observed today had its last scattering event at conformal time $\\eta$. This probability is the product of two factors: the probability of scattering in the infinitesimal interval $[\\eta, \\eta+d\\eta]$, and the probability of free-streaming without further scattering from $\\eta$ to the present time $\\eta_0$.\n\nThe instantaneous rate of scattering is given by $\\dot{\\tau}(\\eta) \\equiv a(\\eta)n_{e}(\\eta)\\sigma_{T}$, where $a(\\eta)$ is the scale factor, $n_e(\\eta)$ is the free-electron number density, and $\\sigma_T$ is the Thomson scattering cross-section. The probability of scattering in $[\\eta, \\eta+d\\eta]$ is thus $\\dot{\\tau}(\\eta) d\\eta$.\n\nThe probability of a photon free-streaming from $\\eta$ to $\\eta_0$ is given by $e^{-\\tau(\\eta)}$, where $\\tau(\\eta)$ is the optical depth to scattering between $\\eta$ and $\\eta_0$:\n$$\n\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}(\\eta') d\\eta'\n$$\nCombining these, the probability of last scattering in $[\\eta, \\eta+d\\eta]$ is $g(\\eta)d\\eta = \\dot{\\tau}(\\eta)e^{-\\tau(\\eta)}d\\eta$. Therefore, the visibility function is:\n$$\ng(\\eta) = \\dot{\\tau}(\\eta) e^{-\\tau(\\eta)}\n$$\nNote that with this definition, $\\dot{\\tau}(\\eta) = -d\\tau/d\\eta$.\n\nTo implement this numerically, we first need an explicit expression for $\\dot{\\tau}(\\eta)$ in terms of the given model parameters. We are given:\n- Scale factor: $a(\\eta) = (\\eta/\\eta_0)^2$. With $\\eta_0=1$, this is $a(\\eta) = \\eta^2$.\n- Free-electron density: $n_e(\\eta) = x_e(\\eta) n_H(\\eta)$.\n- Hydrogen number density: $n_H(\\eta) = n_{H0} a(\\eta)^{-3} = n_{H0} \\eta^{-6}$.\n\nSubstituting these into the definition of $\\dot{\\tau}(\\eta)$:\n$$\n\\dot{\\tau}(\\eta) = a(\\eta) \\bigl(x_e(\\eta) n_H(\\eta)\\bigr) \\sigma_T = \\eta^2 \\bigl(x_e(\\eta) n_{H0} \\eta^{-6}\\bigr) \\sigma_T = (n_{H0}\\sigma_T) x_e(\\eta) \\eta^{-4}\n$$\nThe problem provides the normalization constant $C = n_{H0}\\sigma_T\\eta_0 = 10^{-4}$. Since $\\eta_0=1$, this gives $n_{H0}\\sigma_T = 10^{-4}$. The final expression for the scattering rate is:\n$$\n\\dot{\\tau}(\\eta) = C \\frac{x_e(\\eta)}{\\eta^4} \\quad \\text{with} \\quad C=10^{-4}\n$$\nThe unperturbed free-electron fraction $x_e^{(0)}(\\eta)$ is given by the tanh model:\n$$\nx_{e}^{(0)}(\\eta)=x_{\\mathrm{res}}+\\frac{1}{2}\\,(x_{\\mathrm{pre}}-x_{\\mathrm{res}})\\,\\Bigl[1-\\tanh\\Bigl(\\frac{\\eta-\\eta_{c}}{w}\\Bigr)\\Bigr]\n$$\nwith parameters $x_{\\mathrm{pre}}=1.0$, $x_{\\mathrm{res}}=2\\times 10^{-4}$, $\\eta_{c}=0.03$, and $w=0.01$.\n\n**1.2. Linear Response of the Visibility Function**\n\nWe wish to find the first-order fractional change $\\delta g(\\eta)/g(\\eta)$ due to a small fractional perturbation in the electron fraction, $\\delta_x(\\eta) \\equiv \\delta x_e(\\eta)/x_e(\\eta)$. We denote unperturbed quantities with a superscript $(0)$.\n\nThe perturbed quantities are:\n- $x_e(\\eta) = x_e^{(0)}(\\eta) (1 + \\delta_x(\\eta))$\n- $\\dot{\\tau}(\\eta) = \\dot{\\tau}^{(0)}(\\eta) (1 + \\delta_x(\\eta)) \\implies \\delta\\dot{\\tau}(\\eta) = \\dot{\\tau}^{(0)}(\\eta) \\delta_x(\\eta)$\n- $\\tau(\\eta) = \\tau^{(0)}(\\eta) + \\delta\\tau(\\eta)$, where\n$$\n\\delta\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\delta\\dot{\\tau}(\\eta') d\\eta' = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}^{(0)}(\\eta') \\delta_x(\\eta') d\\eta'\n$$\nThe visibility function is $g = \\dot{\\tau}e^{-\\tau}$. Taking the variation yields, to first order:\n$$\n\\delta g = \\delta\\dot{\\tau} e^{-\\tau^{(0)}} + \\dot{\\tau}^{(0)} e^{-\\tau^{(0)}} (-\\delta\\tau) = e^{-\\tau^{(0)}} (\\delta\\dot{\\tau} - \\dot{\\tau}^{(0)}\\delta\\tau)\n$$\nDividing by the unperturbed visibility function, $g^{(0)} = \\dot{\\tau}^{(0)}e^{-\\tau^{(0)}}$, we obtain the fractional change:\n$$\n\\frac{\\delta g(\\eta)}{g^{(0)}(\\eta)} = \\frac{\\delta\\dot{\\tau}(\\eta)}{\\dot{\\tau}^{(0)}(\\eta)} - \\delta\\tau(\\eta)\n$$\nSubstituting the expressions for $\\delta\\dot{\\tau}$ and $\\delta\\tau$:\n$$\n\\frac{\\delta g(\\eta)}{g^{(0)}(\\eta)} = \\delta_x(\\eta) - \\int_{\\eta}^{\\eta_0} \\dot{\\tau}^{(0)}(\\eta') \\delta_x(\\eta') d\\eta'\n$$\nThis is the central equation for the linear response. Hereafter, we drop the $(0)$ superscript for notational clarity.\n\n**2. Numerical Implementation**\n\nThe numerical pipeline follows the derived theoretical framework.\n\n**2.1. Grid and Background Quantities**\nA uniform grid in conformal time $\\eta$ is established from $\\eta_{\\min}=10^{-4}$ to $\\eta_0=1$. On this grid, we compute the following unperturbed background quantities in sequence:\n1.  The free-electron fraction $x_e(\\eta)$ using the given `tanh` formula.\n2.  The scattering rate $\\dot{\\tau}(\\eta) = C x_e(\\eta) \\eta^{-4}$.\n3.  The optical depth $\\tau(\\eta) = \\int_{\\eta}^{\\eta_0} \\dot{\\tau}(\\eta') d\\eta'$. This integral is computed numerically for each grid point $\\eta_i$. A standard approach is to first compute the cumulative integral from the start of the grid, $I(\\eta_i) = \\int_{\\eta_{\\min}}^{\\eta_i} \\dot{\\tau}(\\eta')d\\eta'$, using the trapezoidal rule (e.g., `scipy.integrate.cumulative_trapezoid`). Then, $\\tau(\\eta_i)$ is found by subtraction: $\\tau(\\eta_i) = I(\\eta_0) - I(\\eta_i)$.\n4.  The visibility function $g(\\eta) = \\dot{\\tau}(\\eta) e^{-\\tau(\\eta)}$.\n\n**2.2. Peak Location**\nThe peak of the visibility function, $\\eta_\\ast$, is determined by finding the grid point where the computed array $g(\\eta)$ reaches its maximum value. This corresponds to the most probable time of last scattering.\n\n**2.3. Perturbation Response Calculation**\nFor each of the three specified perturbation profiles $\\delta_x(\\eta) = \\delta x_e(\\eta)/x_e(\\eta)$ (constant, Gaussian, oscillatory), the linear response $\\delta g(\\eta)/g(\\eta)$ is computed using the derived formula. This involves:\n1.  Calculating the perturbation profile $\\delta_x(\\eta)$ on the grid.\n2.  Computing the integrand $\\dot{\\tau}(\\eta)\\delta_x(\\eta)$.\n3.  Numerically integrating this product from $\\eta$ to $\\eta_0$ to find $\\delta\\tau(\\eta)$ for each point on the grid, using the same cumulative integration technique as for $\\tau(\\eta)$.\n4.  Finally, calculating $\\delta g(\\eta)/g(\\eta) = \\delta_x(\\eta) - \\delta\\tau(\\eta)$.\n\n**2.4. Analysis of Results**\nFor each perturbation case, two quantities are extracted:\n1.  The maximum absolute fractional change, $\\max_{\\eta}|\\delta g(\\eta)/g(\\eta)|$. This search is restricted to the domain where $g(\\eta)$ is non-negligible, defined by the condition $g(\\eta) / \\max_{\\eta'}g(\\eta') \\ge 10^{-8}$, to avoid numerical artifacts in the tails of the distribution.\n2.  The fractional change at the unperturbed peak location, $(\\delta g/g)(\\eta_\\ast)$.\n\nThese steps are implemented in the provided Python code, which yields the seven required output values.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the cosmological visibility function and its linear response to\n    perturbations in the free-electron fraction.\n    \"\"\"\n\n    # 1. Define constants and grid\n    eta0 = 1.0\n    eta_min = 1e-4\n    num_points = 20000\n    eta = np.linspace(eta_min, eta0, num_points)\n\n    # Cosmological and model parameters\n    x_pre = 1.0\n    x_res = 2.0e-4\n    eta_c = 0.03 * eta0\n    w = 0.01 * eta0\n    C = 1.0e-4  # n_H0 * sigma_T * eta_0\n\n    # 2. Compute background quantities\n    # Unperturbed free-electron fraction x_e(eta)\n    x_e = x_res + 0.5 * (x_pre - x_res) * (1.0 - np.tanh((eta - eta_c) / w))\n\n    # Scattering rate, \\dot{\\tau} = -d\\tau/d\\eta\n    tau_dot = C * x_e / eta**4\n\n    # Optical depth \\tau(eta) = integral from eta to eta0 of \\dot{\\tau}\n    integral_part = cumulative_trapezoid(tau_dot, eta, initial=0.0)\n    total_integral = integral_part[-1]\n    tau = total_integral - integral_part\n    \n    # Visibility function g(eta)\n    g = tau_dot * np.exp(-tau)\n    \n    # 3. Determine peak location eta_star\n    g_max_idx = np.argmax(g)\n    eta_star = eta[g_max_idx]\n    g_max = g[g_max_idx]\n\n    results = [eta_star]\n\n    # 4. Define perturbation profiles\n    epsilon = 1.0e-3\n    \n    # Case A: Constant perturbation\n    delta_xe_over_xe_A = epsilon * np.ones_like(eta)\n    \n    # Case B: Gaussian perturbation\n    sigma_B = 0.005 * eta0\n    delta_xe_over_xe_B = epsilon * np.exp(-((eta - eta_c)**2) / (2 * sigma_B**2))\n    \n    # Case C: Oscillatory perturbation\n    P_C = 0.05\n    delta_xe_over_xe_C = epsilon * np.cos(2 * np.pi * (eta / eta0) / P_C)\n    \n    perturbations = [\n        delta_xe_over_xe_A, \n        delta_xe_over_xe_B, \n        delta_xe_over_xe_C\n    ]\n    \n    # Define restricted domain for analysis\n    g_threshold = g_max * 1.0e-8\n    valid_indices = np.where(g >= g_threshold)[0]\n\n    # 5. Compute and analyze response for each case\n    for delta_xe_over_xe in perturbations:\n        # Compute delta_tau(eta)\n        integrand_delta_tau = tau_dot * delta_xe_over_xe\n        integral_part_delta = cumulative_trapezoid(integrand_delta_tau, eta, initial=0.0)\n        total_integral_delta = integral_part_delta[-1]\n        delta_tau = total_integral_delta - integral_part_delta\n        \n        # Compute fractional change in g(eta)\n        delta_g_over_g = delta_xe_over_xe - delta_tau\n        \n        # 6. Extract required metrics\n        # Max absolute fractional change over the restricted domain\n        max_abs_change = np.max(np.abs(delta_g_over_g[valid_indices]))\n        \n        # Fractional change at the baseline peak\n        change_at_peak = delta_g_over_g[g_max_idx]\n        \n        results.extend([max_abs_change, change_at_peak])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}