{
    "hands_on_practices": [
        {
            "introduction": "计算宇宙学距离是数值宇宙学中的一项基本任务。本练习将带领您在最常用的宇宙学模型——平坦的$\\Lambda$CDM宇宙——中进行实践。您将从弗里德曼方程出发，通过数值求解共动距离的积分，并进一步计算光度距离 $D_L$ 和角直径距离 $D_A$ ，这些都是解释超新星、星系巡天等观测数据的关键。",
            "id": "3469306",
            "problem": "您的任务是设计并实现一个数值算法，用于在空间平坦的Lambda冷暗物质（ΛCDM）宇宙学模型中计算宇宙学距离。请从第一性原理出发：即专用于具有非相对论性物质和宇宙学常数的空间平坦几何的罗伯逊-沃克度规和弗里德曼方程。基于这些输入所蕴含的膨胀历史，推导出视线共动距离，然后使用引力度规理论中物理上有效的关系式计算光度距离和角直径距离。请确保所有定义和推导都与这些基本依据保持一致，并且不依赖于预先给出的最终公式。\n\n算法和物理约束：\n- 假设宇宙是空间平坦的，在所考虑的红移范围内忽略辐射分量。\n- 使用光速 $c = 299{,}792.458\\,\\mathrm{km\\,s^{-1}}$。\n- 哈勃常数 $H_0$ 以 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$ 为单位提供。\n- 所有报告的距离必须以 $\\mathrm{Mpc}$（百万秒差距）为单位表示。\n- 使用宇宙学红移 $z$ 的定义，以及与所假设宇宙组分的弗里德曼方程一致的适当膨胀率，其中物质密度参数 $\\Omega_m$ 和宇宙学常数密度参数满足空间平坦性条件。\n- 实现对红移的数值积分以获得视线共动距离，并由此计算光度距离和角直径距离。使用度规理论中物理上合理的联系这些距离的关系式。\n\n数值输出要求：\n- 对于每个测试用例，计算光度距离 $D_L$ 和角直径距离 $D_A$，两者均以 $\\mathrm{Mpc}$ 为单位。\n- 将每个报告值四舍五入到六位小数。\n- 生成单行输出，其中包含所有测试用例的结果，形式为一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果本身是一个形式为 $[D_L, D_A]$ 的双元素列表，两个值均以 $\\mathrm{Mpc}$ 为单位并四舍五入到六位小数。例如：$[[D_{L,1},D_{A,1}],[D_{L,2},D_{A,2}],\\dots]$。\n\n测试套件：\n为以下空间平坦的ΛCDM配置计算 $[D_L, D_A]$，每个配置由 $(z, H_0, \\Omega_m)$ 指定：\n1. $(z=0.5,\\; H_0=70\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}},\\; \\Omega_m=0.3)$。\n2. $(z=0.0,\\; H_0=70\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}},\\; \\Omega_m=0.3)$，一个边界情况，此时距离应反映局部极限。\n3. $(z=10^{-6},\\; H_0=70\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}},\\; \\Omega_m=0.3)$，一个近线性哈勃定律区域的检验。\n4. $(z=2.0,\\; H_0=70\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}},\\; \\Omega_m=0.3)$，一个更高红移的情况，用于探测物质主导的标度关系。\n5. $(z=0.5,\\; H_0=67.74\\,\\mathrm{km\\,s^{-1}\\,Mpc^{-1}},\\; \\Omega_m=0.315)$，一个类Planck宇宙学模型的变体。\n\n您的程序应生成单行输出，包含所有结果，格式为一个由方括号括起来的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个双元素列表 $[D_L, D_A]$，两个值均以 $\\mathrm{Mpc}$ 为单位并四舍五入到六位小数。例如，输出格式必须与以下完全一样：\n$[[D_{L,1},D_{A,1}],[D_{L,2},D_{A,2}],[D_{L,3},D_{A,3}],[D_{L,4},D_{A,4}],[D_{L,5},D_{A,5}]]$。",
            "solution": "该问题是有效的，因为它科学地基于标准的ΛCDM宇宙学模型，问题陈述清晰且数据充分一致，并且表述客观。它提出了一个数值宇宙学中的标准、非平凡的计算。我们现在将从第一性原理出发，推导必要的表达式来给出解答。\n\n我们的出发点是用于均匀且各向同性宇宙的罗伯逊-沃克（RW）度规。问题指定了空间平坦的几何，其曲率参数 $k=0$。RW线元 $ds^2$ 简化为：\n$$ ds^2 = c^2 dt^2 - a(t)^2 \\left[ dr^2 + r^2 (d\\theta^2 + \\sin^2\\theta d\\phi^2) \\right] $$\n其中 $c$ 是光速，$t$ 是宇宙学固有时，$a(t)$ 是无量纲的尺度因子（归一化为现今时刻 $a(t_0)=1$），而 $(r, \\theta, \\phi)$ 是共动坐标。\n\n尺度因子 $a(t)$ 的动力学由弗里德曼方程决定。对于一个包含非相对论性物质（密度参数 $\\Omega_m$）和宇宙学常数（密度参数 $\\Omega_\\Lambda$），并且按要求忽略辐射分量的宇宙，第一个弗里德曼方程为：\n$$ \\left(\\frac{\\dot{a}}{a}\\right)^2 = H(t)^2 = H_0^2 \\left[ \\Omega_m a^{-3} + \\Omega_\\Lambda \\right] $$\n此处，$H(t) = \\dot{a}/a$ 是哈勃参数，$H_0$ 是它在现今的值。空间平坦性条件施加了约束 $\\Omega_m + \\Omega_\\Lambda = 1$，因此我们可以写成 $\\Omega_\\Lambda = 1 - \\Omega_m$。\n\n我们通过定义 $1+z = a_0/a = 1/a$ 将尺度因子 $a$ 与可观测的宇宙学红移 $z$ 联系起来。将此代入弗里德曼方程，我们可以将哈勃参数表示为红移的函数：\n$$ H(z)^2 = H_0^2 \\left[ \\Omega_m (1+z)^3 + 1 - \\Omega_m \\right] $$\n定义无量纲的哈勃参数 $E(z) = H(z)/H_0$ 会很方便：\n$$ E(z) = \\sqrt{\\Omega_m (1+z)^3 + 1 - \\Omega_m} $$\n\n为求得一个物体的距离，我们考虑一个从红移为 $z$ 的源头发射、传播到红移为 $z=0$ 的观测者的光子。光子沿零测地线传播，即 $ds^2=0$。对于一个沿径向朝我们传播的光子（$d\\theta=d\\phi=0$），RW度规给出 $c\\,dt = a(t)\\,dr$。视线共动距离 $D_C$ 是源的共动坐标 $r$，通过将此关系从发射时间 $t_e$ 积分到观测时间 $t_0$ 得到：\n$$ D_C = \\int_0^{D_C} dr = \\int_{t_e}^{t_0} \\frac{c}{a(t)} dt $$\n为了执行这个积分，我们将积分变量从时间 $t$ 变换为红移 $z'$。根据哈勃参数的定义 $H = \\frac{1}{a}\\frac{da}{dt}$ 以及关系式 $a=(1+z')^{-1}$，我们得到 $dt = \\frac{da}{aH} = -\\frac{dz'}{(1+z')H(z')}$。积分上下限从 $(t_e, t_0)$ 变为 $(z, 0)$。\n$$ D_C(z) = c \\int_z^0 (1+z') \\left( -\\frac{dz'}{(1+z')H(z')} \\right) = c \\int_0^z \\frac{dz'}{H(z')} $$\n代入 $H(z') = H_0 E(z')$，我们得到共动距离的积分表达式：\n$$ D_C(z) = \\frac{c}{H_0} \\int_0^z \\frac{dz'}{\\sqrt{\\Omega_m (1+z')^3 + 1 - \\Omega_m}} $$\n量 $D_H = c/H_0$ 被称为哈勃距离。鉴于 $c$ 的单位是 $\\mathrm{km\\,s^{-1}}$ 而 $H_0$ 的单位是 $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，$D_H$ 的单位将是 $\\mathrm{Mpc}$。该积分为一个无量纲的量，必须进行数值计算。\n\n从共动距离，我们可以推导出光度距离（$D_L$）和角直径距离（$D_A$）。\n光度距离 $D_L$ 由流量-光度关系式 $F = L/(4\\pi D_L^2)$ 定义。在膨胀的宇宙中，观测到的流量因两个 $(1+z)$ 因子而减小：一个因子是由于光子能量的红移，另一个因子是由于光子到达速率的时间膨胀。这导出了如下关系（对于平坦宇宙）：\n$$ D_L(z) = (1+z) D_C(z) $$\n\n角直径距离 $D_A$ 由物体的固有横向尺寸 $l$ 与其角尺寸 $\\delta\\theta$ 之间的关系 $l = D_A \\delta\\theta$ 定义。一个在发射时间 $t_e$（红移 $z$）时固有尺寸为 $l$ 的物体，其张角为 $\\delta\\theta = l / (a(t_e) D_C(z))$。由于 $a(t_e) = 1/(1+z)$，这给出了如下关系：\n$$ D_A(z) = \\frac{D_C(z)}{1+z} $$\n注意，这两个距离通过基本的 Etherington 互易定理 $D_L = (1+z)^2 D_A$ 相关联，这是对我们推导的一致性检验。\n\n待实现的算法如下：\n1. 对于每个测试用例 $(z, H_0, \\Omega_m)$，定义被积函数 $f(z') = E(z')^{-1}$。\n2. 处理 $z=0$ 的平凡情况，此时 $D_C, D_L, D_A$ 均为 $0$。\n3. 对于 $z0$，使用标准求积方法（例如 `scipy.integrate.quad` 提供的方法）对 $f(z')$ 从 $0$ 到 $z$ 进行数值积分。\n4. 计算哈勃距离 $D_H = c/H_0$。\n5. 计算共动距离 $D_C = D_H \\times \\int_0^z f(z') dz'$。\n6. 计算光度距离 $D_L = (1+z)D_C$ 和角直径距离 $D_A = D_C/(1+z)$。\n7. 将结果四舍五入到六位小数，并按要求格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes luminosity and angular diameter distances in a spatially flat\n    Lambda-CDM cosmology.\n    \"\"\"\n    # Define physical constants and test cases as per the problem statement.\n    C_KMS = 299792.458  # Speed of light in km/s\n\n    test_cases = [\n        # (z, H0 in km/s/Mpc, Omega_m)\n        (0.5, 70.0, 0.3),\n        (0.0, 70.0, 0.3),\n        (1.0E-6, 70.0, 0.3),\n        (2.0, 70.0, 0.3),\n        (0.5, 67.74, 0.315)\n    ]\n\n    # The integrand for the comoving distance calculation is 1/E(z), where\n    # E(z) = H(z)/H_0.\n    def integrand(z_prime, omega_m):\n        \"\"\"\n        Integrand function, 1/E(z'), for the comoving distance integral.\n        For a flat universe, Omega_Lambda = 1 - Omega_m.\n        \"\"\"\n        return 1.0 / np.sqrt(omega_m * (1.0 + z_prime)**3 + (1.0 - omega_m))\n\n    results = []\n    for z, h0, omega_m in test_cases:\n        # The boundary case at z=0 results in zero distance.\n        if z == 0.0:\n            dl = 0.0\n            da = 0.0\n        else:\n            # Calculate the Hubble distance in Mpc.\n            # H0 is in km/s/Mpc, c is in km/s, so D_H is in Mpc.\n            d_h = C_KMS / h0\n\n            # Numerically integrate to find the dimensionless comoving distance integral.\n            # The result is the line-of-sight comoving distance D_C in units of D_H.\n            integral_val, _ = integrate.quad(\n                integrand, 0, z, args=(omega_m,)\n            )\n\n            # Calculate the line-of-sight comoving distance D_C in Mpc.\n            d_c = d_h * integral_val\n\n            # The luminosity distance D_L relates to D_C by a factor of (1+z).\n            dl = d_c * (1.0 + z)\n\n            # The angular diameter distance D_A relates to D_C by a factor of 1/(1+z).\n            da = d_c / (1.0 + z)\n        \n        # Round the final distances to six decimal places as required.\n        dl_rounded = round(dl, 6)\n        da_rounded = round(da, 6)\n\n        results.append([dl_rounded, da_rounded])\n\n    # The final output must be a single line, formatted as a list of lists.\n    # The default string representation of a list is used for each [D_L, D_A] pair.\n    # e.g., str([1.23, 4.56]) gives \"[1.23, 4.56]\".\n    # These string representations are then joined by commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "虽然数值积分能够提供精确解，但解析近似往往能带来更深刻的物理洞察。本练习将探索低红移宇宙，在该区域，距离可以表示为泰勒级数。通过推导此展开式，您将直接把光度距离 $D_L$ 与描述宇宙膨胀变化的减速参数 $q_0$ 联系起来，并量化辐射成分对距离测量的细微影响。",
            "id": "3469251",
            "problem": "考虑一个空间平坦的弗里德曼-勒梅特-罗伯逊-沃尔克 (Friedmann–Lemaître–Robertson–Walker, FLRW) 宇宙，其中充满了非相对论物质 ($w=0$)、辐射 ($w=\\frac{1}{3}$) 和宇宙学常数 ($w=-1$)。设当今的哈勃参数为 $H_{0} = 70~\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$，光速为 $c = 299{,}792.458~\\mathrm{km\\,s^{-1}}$，当今的密度参数为 $\\Omega_{m} = 0.3$，$\\Omega_{r} = 9 \\times 10^{-5}$，且平坦性条件要求 $\\Omega_{\\Lambda} = 1 - \\Omega_{m} - \\Omega_{r}$。\n\n从 FLRW 线元、空间平坦宇宙中光度距离 $D_{L}(z)$ 的定义以及弗里德曼 (Friedmann) 和雷乔杜里 (Raychaudhuri) 方程出发，完成以下任务：\n\n1.  推导光度距离 $D_{L}(z)$ 的低红移展开式，直到并包括 $z$ 的二次项，将结果用 $H_{0}$ 和当今的减速参数 $q_{0}$ 表示。\n\n2.  将当今的减速参数 $q_{0}$ 用当今的密度参数和状态方程表示，然后针对混合物 ($w_{m}=0, w_{r}=\\frac{1}{3}, w_{\\Lambda}=-1$) 进行特例化，以得到作为 $\\Omega_{m}$、$\\Omega_{r}$ 和 $\\Omega_{\\Lambda}$ 函数的 $q_{0}$。\n\n3.  使用二阶低红移展开式，通过计算分数变化\n$$\n\\Delta \\equiv \\frac{D_{L}^{(\\mathrm{with}~\\Omega_{r})}(z=0.1) - D_{L}^{(\\mathrm{no~radiation})}(z=0.1)}{D_{L}^{(\\mathrm{no~radiation})}(z=0.1)}\\,,\n$$\n来量化包含辐射对 $z=0.1$ 处光度距离的影响，其中在“无辐射”情况下，设 $\\Omega_{r}=0$，同时保持 $\\Omega_{m}=0.3$ 固定并施加平坦性条件。对 $\\Delta$ 进行数值计算。将答案四舍五入到四位有效数字。将最终结果表示为一个纯数（无量纲）。",
            "solution": "该问题具有科学依据，提法明确，且解决问题所需的所有数据均已提供。我们可以着手求解。解答分为三个部分，对应于问题陈述中的三个任务。\n\n出发点是空间平坦 ($k=0$) 宇宙的弗里德曼-勒梅特-罗伯逊-沃尔克 (FLRW) 线元：\n$$ds^2 = -c^2 dt^2 + a(t)^2 [dr^2 + r^2(d\\theta^2 + \\sin^2\\theta d\\phi^2)]$$\n其中 $a(t)$ 是标度因子，$c$ 是光速。对于一束从位于共动坐标 $r$ 的源头发射，沿径向路径 ($d\\theta=d\\phi=0$) 传播到位于原点 ($r=0$) 的观测者的光线，零条件 $ds^2=0$ 意味着 $c\\,dt = a(t)\\,dr$。将其从发射时间 $t_e$ 积分到观测时间 $t_0$ 得到共动距离 $d_c$：\n$$d_c = \\int_0^r dr' = \\int_{t_e}^{t_0} \\frac{c\\,dt}{a(t)}$$\n通过使用关系式 $1+z = a_0/a(t)$ (其中 $a_0 \\equiv a(t_0)$) 和 $dt = -dz/((1+z)H(z))$ (其中 $H(z) = \\dot{a}/a$ 是哈勃参数) 将积分变量从时间 $t$ 变为红移 $z$，到红移为 $z$ 的物体的共动距离为：\n$$d_c(z) = c \\int_0^z \\frac{dz'}{H(z')}$$\n光度距离 $D_L$ 的定义为，对于一个绝对光度为 $L$ 的源，其观测通量 $F$ 为 $F = L/(4\\pi D_L^2)$。在膨胀的 FLRW 宇宙中，该定义得到 $D_L(z) = a_0 r (1+z)$。按照惯例，我们设 $a_0=1$，并注意到 $r$ 是共动距离 $d_c(z)$，因此我们有：\n$$D_L(z) = (1+z)d_c(z) = c(1+z)\\int_0^z \\frac{dz'}{H(z')}$$\n\n### 第一部分：光度距离的低红移展开\n\n为了找到 $D_L(z)$ 的低红移展开式，我们将被积函数 $1/H(z')$ 在 $z'=0$ 附近进行泰勒展开。首先，我们展开 $H(z')$：\n$$H(z') = H(0) + \\left. \\frac{dH}{dz'}\\right|_{z'=0} z' + O(z'^2)$$\n我们知道 $H(0) = H_0$。导数项与减速参数 $q = -a\\ddot{a}/\\dot{a}^2$ 相关。我们有 $\\dot{a} = Ha$，以及 $\\ddot{a} = \\dot{H}a + H\\dot{a} = (\\dot{H}+H^2)a$。因此，$q = -(\\dot{H}/H^2 + 1)$，这给出 $\\dot{H} = -H^2(1+q)$。\n链式法则给出 $\\frac{dH}{dz'} = \\frac{dH}{dt}\\frac{dt}{dz'} = \\dot{H} \\frac{-1}{(1+z')H(z')}$。\n在 $z'=0$ 处求值：\n$$\\left. \\frac{dH}{dz'}\\right|_{z'=0} = \\frac{\\dot{H}_0}{-(1+0)H_0} = \\frac{-H_0^2(1+q_0)}{-H_0} = H_0(1+q_0)$$\n其中 $q_0 = q(z=0)$ 是当今的减速参数。\n$H(z')$ 的展开式为：\n$$H(z') = H_0(1 + (1+q_0)z' + O(z'^2))$$\n取倒数，我们得到：\n$$\\frac{1}{H(z')} = \\frac{1}{H_0} (1 - (1+q_0)z' + O(z'^2))$$\n现在，我们积分求共动距离：\n$$d_c(z) = c \\int_0^z \\frac{1}{H_0} (1 - (1+q_0)z') dz' = \\frac{c}{H_0} \\left[z' - \\frac{1+q_0}{2}z'^2\\right]_0^z = \\frac{c}{H_0}\\left(z - \\frac{1+q_0}{2}z^2\\right)$$\n最后，我们求光度距离 $D_L(z) = (1+z)d_c(z)$：\n$$D_L(z) = (1+z) \\frac{c}{H_0}\\left(z - \\frac{1+q_0}{2}z^2 + O(z^3)\\right)$$\n$$D_L(z) = \\frac{c}{H_0}\\left(z - \\frac{1+q_0}{2}z^2 + z^2 + O(z^3)\\right)$$\n$$D_L(z) = \\frac{c}{H_0}\\left(z + \\left(1 - \\frac{1+q_0}{2}\\right)z^2 + O(z^3)\\right)$$\n这给出了所需的光度距离的二阶展开式：\n$$D_L(z) = \\frac{c}{H_0}\\left(z + \\frac{1-q_0}{2}z^2 + O(z^3)\\right)$$\n\n### 第二部分：减速参数\n\n减速参数 $q_0$ 是从弗里德曼方程和流体方程推导出来的。对于平坦宇宙 ($k=0$)，第一弗里德曼方程是 $H^2 = \\frac{8\\pi G}{3c^2}\\rho_{tot}$，其中我们使用能量密度 $\\rho_{tot}$，单位是能量每体积。第二弗里德曼方程（或雷乔杜里方程）是 $\\dot{H} + H^2 = -\\frac{4\\pi G}{3c^2}(\\rho_{tot} + 3P_{tot})$。\n减速参数是 $q = -\\frac{\\ddot{a}a}{\\dot{a}^2} = -(\\frac{\\dot{H}}{H^2}+1)$。\n将 $\\dot{H} = -\\frac{4\\pi G}{3c^2}(\\rho_{tot} + 3P_{tot}) - H^2$ 代入 $q$ 的表达式：\n$$q = -\\left(\\frac{-\\frac{4\\pi G}{3c^2}(\\rho_{tot} + 3P_{tot}) - H^2}{H^2} + 1\\right) = \\frac{\\frac{4\\pi G}{3c^2}(\\rho_{tot} + 3P_{tot})}{H^2} = \\frac{\\frac{4\\pi G}{3c^2}(\\rho_{tot} + 3P_{tot})}{\\frac{8\\pi G}{3c^2}\\rho_{tot}}$$\n$$q = \\frac{1}{2}\\frac{\\rho_{tot} + 3P_{tot}}{\\rho_{tot}} = \\frac{1}{2}\\left(1 + 3\\frac{P_{tot}}{\\rho_{tot}}\\right)$$\n总能量密度和压力是所有组分的总和：$\\rho_{tot} = \\sum_i \\rho_i$ 和 $P_{tot} = \\sum_i P_i$。每个组分都有一个状态方程 $P_i = w_i \\rho_i$。\n$$q = \\frac{1}{2}\\left(1 + 3\\frac{\\sum_i w_i \\rho_i}{\\sum_j \\rho_j}\\right)$$\n使用密度参数的定义 $\\Omega_i = \\rho_i/\\rho_c$，其中 $\\rho_c = \\frac{3c^2H^2}{8\\pi G}$ 是临界密度。对于平坦宇宙，$\\rho_{tot} = \\rho_c$，因此 $\\sum_i \\Omega_i = 1$。\n在当今 ($z=0$)，$q$ 的表达式变为：\n$$q_0 = \\frac{1}{2}\\left(1 + 3\\frac{\\sum_i w_i \\Omega_i \\rho_c}{\\sum_j \\Omega_j \\rho_c}\\right) = \\frac{1}{2}\\left(1 + 3\\frac{\\sum_i w_i \\Omega_i}{\\sum_j \\Omega_j}\\right) = \\frac{1}{2}\\left(1 + 3\\sum_i w_i \\Omega_i\\right)$$\n其中这里的 $\\Omega_i$ 是当今的值。对于给定的非相对论物质 ($w_m=0$)、辐射 ($w_r=1/3$) 和宇宙学常数 ($w_\\Lambda=-1$) 的混合物，这特化为：\n$$q_0 = \\frac{1}{2}(1 + 3(w_m\\Omega_m + w_r\\Omega_r + w_\\Lambda\\Omega_\\Lambda))$$\n$$q_0 = \\frac{1}{2}(1 + 3(0 \\cdot \\Omega_m + \\frac{1}{3}\\Omega_r - 1 \\cdot \\Omega_\\Lambda)) = \\frac{1}{2}(1 + \\Omega_r - 3\\Omega_\\Lambda)$$\n使用平坦性条件 $\\Omega_m + \\Omega_r + \\Omega_\\Lambda = 1$，我们可以写出 $\\Omega_\\Lambda = 1 - \\Omega_m - \\Omega_r$。\n$$q_0 = \\frac{1}{2}(1 + \\Omega_r - 3(1 - \\Omega_m - \\Omega_r)) = \\frac{1}{2}(1 + \\Omega_r - 3 + 3\\Omega_m + 3\\Omega_r)$$\n$$q_0 = \\frac{1}{2}(-2 + 3\\Omega_m + 4\\Omega_r) = \\frac{3}{2}\\Omega_m + 2\\Omega_r - 1$$\n另外，一个更常见的形式是：\n$$q_0 = \\frac{1}{2}\\Omega_m + \\Omega_r - \\Omega_\\Lambda$$\n在平坦性约束下，这两种形式是等价的。为简单起见，我们将使用后者。\n\n### 第三部分：分数变化的数值计算\n\n我们需要计算在 $z=0.1$ 处的 $\\Delta = \\frac{D_{L}^{(\\mathrm{with}~\\Omega_{r})} - D_{L}^{(\\mathrm{no~radiation})}}{D_{L}^{(\\mathrm{no~radiation})}}$。\n使用推导出的展开式 $D_L(z) = \\frac{c}{H_0}(z + \\frac{1-q_0}{2}z^2)$，因子 $\\frac{c}{H_0}$ 将在比率中消去。\n\n情况1：“包含辐射”\n密度参数为 $\\Omega_m = 0.3$，$\\Omega_r = 9 \\times 10^{-5}$。\n平坦性意味着 $\\Omega_\\Lambda = 1 - \\Omega_m - \\Omega_r = 1 - 0.3 - 0.00009 = 0.69991$。\n减速参数为：\n$$q_{0}^{(\\mathrm{with r})} = \\frac{1}{2}\\Omega_{m} + \\Omega_{r} - \\Omega_{\\Lambda} = \\frac{1}{2}(0.3) + 9 \\times 10^{-5} - 0.69991 = 0.15 + 0.00009 - 0.69991 = -0.54982$$\n与 $z=0.1$ 处的 $D_L$ 相关的项是：\n$$X_{\\mathrm{with~r}} \\equiv z + \\frac{1-q_{0}^{(\\mathrm{with r})}}{2}z^2 = 0.1 + \\frac{1 - (-0.54982)}{2}(0.1)^2 = 0.1 + \\frac{1.54982}{2}(0.01) = 0.1 + 0.0077491 = 0.1077491$$\n\n情况2：“无辐射”\n密度参数为 $\\Omega_m = 0.3$，$\\Omega_r = 0$。\n平坦性意味着 $\\Omega_\\Lambda = 1 - \\Omega_m = 1 - 0.3 = 0.7$。\n减速参数为：\n$$q_{0}^{(\\mathrm{no r})} = \\frac{1}{2}\\Omega_{m} + \\Omega_{r} - \\Omega_{\\Lambda} = \\frac{1}{2}(0.3) + 0 - 0.7 = 0.15 - 0.7 = -0.55$$\n与 $z=0.1$ 处的 $D_L$ 相关的项是：\n$$X_{\\mathrm{no~r}} \\equiv z + \\frac{1-q_{0}^{(\\mathrm{no r})}}{2}z^2 = 0.1 + \\frac{1 - (-0.55)}{2}(0.1)^2 = 0.1 + \\frac{1.55}{2}(0.01) = 0.1 + 0.00775 = 0.10775$$\n\n现在，我们计算分数变化 $\\Delta$：\n$$\\Delta = \\frac{D_{L}^{(\\mathrm{with r})} - D_L^{(\\mathrm{no r})}}{D_L^{(\\mathrm{no r})}} = \\frac{\\frac{c}{H_0}X_{\\mathrm{with~r}} - \\frac{c}{H_0}X_{\\mathrm{no~r}}}{\\frac{c}{H_0}X_{\\mathrm{no~r}}} = \\frac{X_{\\mathrm{with~r}} - X_{\\mathrm{no~r}}}{X_{\\mathrm{no~r}}}$$\n$$\\Delta = \\frac{0.1077491 - 0.10775}{0.10775} = \\frac{-0.0000009}{0.10775} \\approx -8.352668 \\times 10^{-6}$$\n将结果四舍五入到四位有效数字，我们得到：\n$$\\Delta \\approx -8.353 \\times 10^{-6}$$\n负号表示，在此红移和展开阶数下，包含辐射会轻微减小光度距离，因为对于相同的能量密度，辐射对减速的贡献大于物质，这会增加 $q_0$，进而减小 $D_L$ 公式中的 $(1-q_0)$ 项。",
            "answer": "$$\\boxed{-8.353 \\times 10^{-6}}$$"
        },
        {
            "introduction": "标准宇宙学模型通常假设宇宙是平坦的，但测量或限制空间曲率是现代宇宙学的核心目标之一。本练习将我们的数值工具箱扩展到非平坦的几何结构（开放或闭合宇宙）。您将学习曲率如何通过弗里德曼方程改变宇宙动力学，并同时修正视线距离与横向距离之间的几何关系，从而能够量化其可观测效应。",
            "id": "3469235",
            "problem": "您需要实现一个完整的、可运行的程序，用于计算在空间弯曲宇宙和空间平坦宇宙中，横向共动距离的分数差异，该差异在指定的红移处进行评估。横向共动距离是一个基础的宇宙学距离测量，通过 Etherington 互易关系与角直径距离和光度距离密切相关。计算必须基于弗里德曼-勒梅特-罗伯逊-沃尔克（Friedmann–Lemaître–Robertson–Walker, FLRW）几何学和弗里德曼方程，考虑非相对论性物质和宇宙学常数，并对空间曲率进行一致的处理。\n\n起点和假设：\n- 使用弗里德曼-勒梅特-罗伯逊-沃尔克（FLRW）模型，其尺度因子为 $a(t)$，并忽略辐射。哈勃参数为 $H(z)$，当前值为 $H_0$。\n- 使用当今的密度参数 $\\Omega_m$、$\\Omega_\\Lambda$ 和 $\\Omega_k$，当忽略辐射时，它们满足闭合关系 $ \\Omega_m + \\Omega_\\Lambda + \\Omega_k = 1$。\n- 空间曲率由 $\\Omega_k$ 表示，其符号约定与 FLRW 度规一致。闭合宇宙的 $\\Omega_k  0$，平坦宇宙的 $\\Omega_k = 0$，开放宇宙的 $\\Omega_k  0$。\n- 横向共动距离 $D_M(z)$ 必须根据第一性原理，使用 FLRW 径向坐标距离和空间曲率映射来构建，不得调用本问题陈述中任何预先提供的快捷公式。\n\n程序要求：\n- 通过对红移从 $z=0$ 到指定 $z$ 的一维求积，实现视线共动距离的数值计算。\n- 使用依赖于空间曲率的几何学，将视线共动距离映射到横向共动距离 $D_M(z)$，确保对 $\\Omega_k  0$、$\\Omega_k = 0$ 和 $\\Omega_k  0$ 的情况进行正确处理。\n- 计算定义如下的分数差异\n$$\n\\frac{\\Delta D_M}{D_M} \\equiv \\frac{D_M^{\\mathrm{curved}}(z) - D_M^{\\mathrm{flat}}(z)}{D_M^{\\mathrm{flat}}(z)},\n$$\n其中 $D_M^{\\mathrm{flat}}(z)$ 是在空间平坦宇宙中的横向共动距离，该宇宙具有相同的 $\\Omega_m$，且 $\\Omega_\\Lambda$ 根据 $\\Omega_k=0$ 的闭合关系进行调整。\n\n物理常数和单位：\n- 使用光速 $c = 299{,}792.458 \\ \\mathrm{km \\ s^{-1}}$。\n- 使用哈勃常数 $H_0 = 70 \\ \\mathrm{km \\ s^{-1} \\ Mpc^{-1}}$。\n- 内部所有距离以 $\\mathrm{Mpc}$ 表示。所要求的分数差异 $\\Delta D_M / D_M$ 是无量纲的。\n- 出现在三角函数或双曲函数中的角度必须作为与 FLRW 曲率映射一致的无量纲量来处理。\n\n测试套件：\n对于每个测试用例，在弯曲宇宙中，根据闭合关系 $ \\Omega_\\Lambda = 1 - \\Omega_m - \\Omega_k$ 为指定的 $\\Omega_k$ 设置 $\\Omega_\\Lambda$。对于平坦宇宙基线，使用 $\\Omega_k=0$ 和 $\\Omega_\\Lambda = 1 - \\Omega_m$。评估以下情况的分数差异 $\\Delta D_M / D_M$：\n- 测试用例 1：$z=3$，$\\Omega_m=0.3$，弯曲宇宙，其中 $\\Omega_k=-0.01$（闭合；因此 $\\Omega_m + \\Omega_\\Lambda = 1.01$）。\n- 测试用例 2：$z=1$，$\\Omega_m=0.3$，弯曲宇宙，其中 $\\Omega_k=-0.01$（闭合）。\n- 测试用例 3：$z=3$，$\\Omega_m=0.3$，弯曲宇宙，其中 $\\Omega_k=+0.01$（开放；因此 $\\Omega_m + \\Omega_\\Lambda = 0.99$）。\n- 测试用例 4：$z=3$，$\\Omega_m=0.3$，弯曲宇宙，其中 $\\Omega_k=-10^{-6}$（近乎平坦，闭合）。\n- 测试用例 5：$z=0.1$，$\\Omega_m=0.3$，弯曲宇宙，其中 $\\Omega_k=-0.01$（闭合）。\n\n输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个值四舍五入到 $8$ 位小数，例如，\n$$\n[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4,\\text{r}_5],\n$$\n其中每个 $\\text{r}_i$ 是对应测试用例计算出的 $\\Delta D_M / D_M$ 值。\n\n科学真实性和约束：\n- 对于所有指定情况，数值积分必须稳定和准确。\n- 稳健地处理 $\\Omega_k=0$ 的情况和近乎平坦的情况 $\\Omega_k=-10^{-6}$。\n- 不要使用任何外部输入；所有参数均在上方和程序内部指定。",
            "solution": "用户要求计算在几个测试用例中，空间弯曲宇宙和空间平坦宇宙之间横向共动距离的分数差异。这项任务要求严格应用从弗里德曼-勒梅特-罗伯逊-沃尔克（Friedmann–Lemaître–Robertson–Walker, FLRW）度规中推导出的宇宙学距离测量。解决方案将按照要求从第一性原理构建。\n\n### 1. 理论框架\n\n问题设定在标准宇宙学模型的背景下，该模型由 FLRW 度规描述。按照规定忽略辐射，宇宙的动力学由非相对论性物质（其当今密度参数为 $\\Omega_m$）和宇宙学常数（$\\Omega_\\Lambda$）决定。空间几何由曲率密度参数 $\\Omega_k$ 描述。这些参数受到弗里德曼方程的约束，在当前时期（$z=0$），该方程得出闭合关系：\n$$\n\\Omega_m + \\Omega_\\Lambda + \\Omega_k = 1\n$$\n\n所需的基本距离测量是横向共动距离 $D_M(z)$。其计算分两个阶段进行：首先，计算视线共动距离 $D_C(z)$；其次，根据空间曲率将 $D_C(z)$ 映射到 $D_M(z)$。\n\n### 2. 哈勃参数 $H(z)$\n\n哈勃参数随红移 $z$ 的演化由弗里德曼方程给出。使用尺度因子 $a = (1+z)^{-1}$（当前 $a_0=1$），哈勃参数 $H(z) = \\dot{a}/a$ 的演化如下：\n$$\nH(z)^2 = H_0^2 \\left[ \\Omega_m (1+z)^3 + \\Omega_\\Lambda + \\Omega_k (1+z)^2 \\right]\n$$\n其中 $H_0$ 是哈勃常数。为方便起见，定义无量纲哈勃参数 $E(z) = H(z)/H_0$，使得：\n$$\nE(z) = \\sqrt{\\Omega_m (1+z)^3 + \\Omega_k (1+z)^2 + \\Omega_\\Lambda}\n$$\n\n### 3. 视线共动距离, $D_C(z)$\n\n到红移 $z$ 处物体的视线共动距离是光子从该物体传播到观测者所经过的总距离，并按宇宙今天的尺寸进行了缩放。它是通过在光子的传播时间内对无穷小的共动距离 $c \\, dt/a(t)$ 进行积分来计算的。通过使用关系式 $dt = -dz / ((1+z)H(z))$ 将积分变量更改为红移 $z$，我们得到：\n$$\nD_C(z) = \\int_{t_e}^{t_0} \\frac{c \\, dt}{a(t)} = c \\int_0^z \\frac{dz'}{H(z')}\n$$\n代入 $H(z') = H_0 E(z')$，这变成：\n$$\nD_C(z) = \\frac{c}{H_0} \\int_0^z \\frac{dz'}{E(z')} = D_H \\int_0^z \\frac{dz'}{\\sqrt{\\Omega_m(1+z')^3 + \\Omega_k(1+z')^2 + \\Omega_\\Lambda}}\n$$\n其中 $D_H = c/H_0$ 是哈勃距离。该积分必须进行数值计算。\n\n### 4. 横向共动距离, $D_M(z)$\n\n横向共动距离 $D_M(z)$ 将红移 $z$ 处物体的物理横向尺寸与其在天空中的角大小联系起来。它等价于特定形式的 FLRW 度规中的共动径向坐标，并通过一个依赖于空间曲率 $\\Omega_k$ 的映射与 $D_C(z)$ 相关。\n\n该关系定义如下：\n- 对于空间**平坦**的宇宙（$\\Omega_k = 0$）：\n  $$\n  D_M(z) = D_C(z)\n  $$\n- 对于空间**闭合**的宇宙（$\\Omega_k  0$）：\n  $$\n  D_M(z) = \\frac{D_H}{\\sqrt{-\\Omega_k}} \\sin\\left(\\frac{\\sqrt{-\\Omega_k}}{D_H} D_C(z)\\right)\n  $$\n- 对于空间**开放**的宇宙（$\\Omega_k > 0$）：\n  $$\n  D_M(z) = \\frac{D_H}{\\sqrt{\\Omega_k}} \\sinh\\left(\\frac{\\sqrt{\\Omega_k}}{D_H} D_C(z)\\right)\n  $$\n\n当 $|\\Omega_k|$ 非常小时，直接计算这些公式可能会产生数值精度误差。泰勒级数展开提供了更稳健的计算方法。对于小的 $x$，$\\sin(x) \\approx x - x^3/6$ 且 $\\sinh(x) \\approx x + x^3/6$。将此应用于 $D_M(z)$ 的公式，会得到一个对任何小的 $\\Omega_k$ 都有效的通用近似：\n$$\nD_M(z) \\approx D_C(z) \\left(1 + \\frac{\\Omega_k D_C(z)^2}{6 D_H^2}\\right)\n$$\n这个近似对于稳健地处理近乎平坦的宇宙学模型特别有用，例如提供的测试用例中 $\\Omega_k = -10^{-6}$ 的情况。在实现中，当 $|\\Omega_k|$ 低于一个小的阈值（例如 $10^{-8}$）时，可以使用此泰勒展开来确保稳定性，尽管标准的双精度浮点运算对于测试用例中指定的数量级通常是足够的。\n\n### 5. 计算算法\n\n所要求的分数差异为 $\\frac{\\Delta D_M}{D_M} = \\frac{D_M^{\\mathrm{curved}}(z) - D_M^{\\mathrm{flat}}(z)}{D_M^{\\mathrm{flat}}(z)}$。对于每个由红移 $z$、物质密度 $\\Omega_m$ 和曲率 $\\Omega_{k, \\mathrm{curved}}$ 定义的测试用例，算法如下：\n\n1.  **定义常数**：设置物理常数 $c = 299792.458 \\, \\mathrm{km \\, s^{-1}}$ 和 $H_0 = 70 \\, \\mathrm{km \\, s^{-1} \\, Mpc^{-1}}$。计算哈勃距离 $D_H = c/H_0$。\n\n2.  **计算 $D_M^{\\mathrm{flat}}(z)$**：这是用于比较的基线。\n    a.  为平坦模型设置宇宙学参数：$\\Omega_{m, \\mathrm{flat}} = \\Omega_m$（来自测试用例），$\\Omega_{k, \\mathrm{flat}} = 0$，以及 $\\Omega_{\\Lambda, \\mathrm{flat}} = 1 - \\Omega_{m, \\mathrm{flat}}$。\n    b.  为平坦模型定义被积函数 $1/E(z')$。\n    c.  从 $z'=0$ 到 $z$ 对此进行数值积分，以找到无量纲积分 $I_{\\mathrm{flat}}$。\n    d.  计算 $D_{C, \\mathrm{flat}}(z) = D_H \\times I_{\\mathrm{flat}}$。\n    e.  由于 $\\Omega_{k, \\mathrm{flat}} = 0$，因此 $D_{M, \\mathrm{flat}}(z) = D_{C, \\mathrm{flat}}(z)$。\n\n3.  **计算 $D_M^{\\mathrm{curved}}(z)$**：这是指定弯曲宇宙的值。\n    a.  为弯曲模型设置宇宙学参数：$\\Omega_{m, \\mathrm{curved}} = \\Omega_m$，$\\Omega_{k, \\mathrm{curved}} = \\Omega_k$（来自测试用例），以及 $\\Omega_{\\Lambda, \\mathrm{curved}} = 1 - \\Omega_{m, \\mathrm{curved}} - \\Omega_{k, \\mathrm{curved}}$。\n    b.  为弯曲模型定义被积函数 $1/E(z')$。\n    c.  从 $z'=0$ 到 $z$ 对此进行数值积分，以找到无量纲积分 $I_{\\mathrm{curved}}$。\n    d.  计算 $D_{C, \\mathrm{curved}}(z) = D_H \\times I_{\\mathrm{curved}}$。\n    e.  应用适当的依赖于曲率的公式，从 $D_{C, \\mathrm{curved}}(z)$ 和 $\\Omega_{k, \\mathrm{curved}}$ 计算 $D_{M, \\mathrm{curved}}(z)$。对于 $\\Omega_{k, \\mathrm{curved}}  0$，使用 `sin` 公式。对于 $\\Omega_{k, \\mathrm{curved}} > 0$，使用 `sinh` 公式。\n\n4.  **计算分数差异**：\n    a.  计算最终结果：$(\\frac{D_M^{\\mathrm{curved}}(z) - D_M^{\\mathrm{flat}}(z)}{D_M^{\\mathrm{flat}}(z)})$。\n    b.  对所有测试用例重复此过程，并按规定格式化输出。\n\n此过程严格遵守问题陈述，从第一性原理构建所需的宇宙学距离，并确保数值稳健性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the fractional difference between transverse comoving distance\n    in a spatially curved Universe and in a spatially flat Universe.\n    \"\"\"\n\n    # Define physical constants and test cases as per the problem statement.\n    C_KM_S = 299792.458  # Speed of light in km/s\n    H0 = 70.0  # Hubble constant in km/s/Mpc\n    D_H = C_KM_S / H0  # Hubble distance in Mpc\n\n    test_cases = [\n        # (z, Omega_m, Omega_k_curved)\n        (3.0, 0.3, -0.01),\n        (1.0, 0.3, -0.01),\n        (3.0, 0.3, +0.01),\n        (3.0, 0.3, -1.0e-6),\n        (0.1, 0.3, -0.01),\n    ]\n\n    results = []\n    for z, om_m, om_k_curved in test_cases:\n        # Calculate the fractional difference for each case.\n        result = compute_fractional_difference(z, om_m, om_k_curved, D_H)\n        results.append(result)\n\n    # Format and print the final output exactly as specified.\n    print(f\"[{','.join([f'{r:.8f}' for r in results])}]\")\n\ndef compute_fractional_difference(z, om_m, om_k_curved, d_h):\n    \"\"\"\n    Computes the fractional difference for a single cosmological model.\n    \"\"\"\n    # 1. Flat Universe baseline calculation\n    om_l_flat = 1.0 - om_m\n    om_k_flat = 0.0\n\n    def integrand_flat(z_prime):\n        e_z = np.sqrt(om_m * (1 + z_prime)**3 + om_l_flat)\n        return 1.0 / e_z\n\n    integral_flat, _ = quad(integrand_flat, 0, z)\n    d_c_flat = d_h * integral_flat\n    # For a flat universe, D_M = D_C\n    d_m_flat = d_c_flat\n\n    # 2. Curved Universe calculation\n    om_l_curved = 1.0 - om_m - om_k_curved\n\n    def integrand_curved(z_prime):\n        e_z = np.sqrt(om_m * (1 + z_prime)**3 + om_k_curved * (1 + z_prime)**2 + om_l_curved)\n        return 1.0 / e_z\n\n    integral_curved, _ = quad(integrand_curved, 0, z)\n    d_c_curved = d_h * integral_curved\n\n    # Compute transverse comoving distance D_M for the curved universe\n    if om_k_curved == 0:\n        d_m_curved = d_c_curved\n    else:\n        # A small threshold for om_k to switch to Taylor expansion for robustness.\n        # Although for the given test cases, direct computation is numerically stable.\n        om_k_threshold = 1.0e-9 \n        if abs(om_k_curved)  om_k_threshold:\n            # Use Taylor expansion for near-flat case: D_M ≈ D_C * (1 + om_k*D_C^2 / (6*D_H^2))\n            d_m_curved = d_c_curved * (1.0 + om_k_curved * (d_c_curved**2) / (6.0 * d_h**2))\n        else:\n            sqrt_abs_om_k = np.sqrt(abs(om_k_curved))\n            arg = sqrt_abs_om_k * d_c_curved / d_h\n            \n            if om_k_curved > 0: # Open universe\n                d_m_curved = (d_h / sqrt_abs_om_k) * np.sinh(arg)\n            else: # Closed universe\n                d_m_curved = (d_h / sqrt_abs_om_k) * np.sin(arg)\n\n    # 3. Compute the fractional difference\n    if d_m_flat == 0: # handle z=0 case\n      return 0.0\n      \n    fractional_diff = (d_m_curved - d_m_flat) / d_m_flat\n\n    return fractional_diff\n\nsolve()\n```"
        }
    ]
}