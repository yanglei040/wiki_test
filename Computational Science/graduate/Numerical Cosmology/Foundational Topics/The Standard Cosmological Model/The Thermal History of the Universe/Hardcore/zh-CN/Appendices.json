{
    "hands_on_practices": [
        {
            "introduction": "宇宙热历史研究中的一个基本任务是建立宇宙时间 $t$ 与光子温度 $T$ 之间的关系。这个关系就像宇宙的“时钟”，为各种物理过程（如量子色动力学相变和电子-正电子湮灭）设定了时间尺度。通过这个实践，你将从弗里德曼方程和熵守恒等第一性原理出发，数值计算出精确的时间-温度关系，并与简化的幂律模型进行对比，从而深刻理解有效自由度 $g_*(T)$ 的变化如何扭曲了宇宙的膨胀历史。",
            "id": "3499024",
            "problem": "你的任务是编写一个完整的、可运行的程序，用于数值计算早期宇宙中，跨越量子色动力学 (QCD) 交叉和电子-正电子湮灭 ($e^\\pm$) 过渡时，作为温度函数的宇宙时间，记作 $t(T)$。你必须将数值计算出的 $t(T)$ 与一个朴素的幂律估计进行比较，并量化由有效自由度的温度依赖性引入的畸变。\n\n基础出发点是辐射主导的 Friedmann-Lemaître-Robertson-Walker (FLRW) 宇宙学，其基本定律和核心定义如下：\n\n- 对于空间平坦宇宙的 Friedmann 方程为 $H^2 = \\frac{8\\pi G_N}{3}\\rho$，其中 $H$ 是哈勃膨胀率，$G_N$ 是牛顿常数，$\\rho$ 是能量密度。\n- 对于相对论性等离子体，能量密度为 $\\rho(T) = \\frac{\\pi^2}{30} g_*(T) T^4$，其中 $g_*(T)$ 是有效相对论性能量自由度数，$T$ 是光子温度。\n- 共动熵密度守恒，$s(T) a^3 = \\text{constant}$，其中 $s(T) = \\frac{2\\pi^2}{45} g_s(T) T^3$ 是熵密度，$g_s(T)$ 是有效相对论性熵自由度数，$a$ 是尺度因子。\n\n使用这些定义，程序必须通过结合 Friedmann 方程和熵守恒，从第一性原理推导出温度-时间关系。具体来说，你必须从上述基础出发，在不依赖于预先给定的目标公式的情况下，得到用 $H(T)$、$T$、$g_s(T)$ 和 $dg_s/dT$ 表示的 $dt/dT$。\n\n$g_*(T)$ 和 $g_s(T)$ 的温度依赖性必须通过平滑且科学上合理的交叉函数来建模，这些函数通过双曲正切阶跃来捕捉 QCD 和 $e^\\pm$ 过渡（以及μ子湮灭）。定义过渡形状函数\n$$\nS(T; T_0, \\Delta T) = \\frac{1}{2}\\left[1 + \\tanh\\!\\left(\\frac{T_0 - T}{\\Delta T}\\right)\\right],\n$$\n它在 $T \\gg T_0$ 时从 $0$ 平滑地变化到在 $T \\ll T_0$ 时的 $1$。使用以下参数值和参考自由度：\n\n- QCD 交叉：$T_0^{\\mathrm{qcd}} = 155\\,\\mathrm{MeV}$，$\\Delta T^{\\mathrm{qcd}} = 50\\,\\mathrm{MeV}$。\n- μ子湮灭：$T_0^{\\mu} = 105\\,\\mathrm{MeV}$，$\\Delta T^{\\mu} = 20\\,\\mathrm{MeV}$。\n- 电子-正电子湮灭：$T_0^{e} = 0.5\\,\\mathrm{MeV}$，$\\Delta T^{e} = 0.2\\,\\mathrm{MeV}$。\n- 高温基线：$g_{\\mathrm{high}} = 61.75$。\n- QCD之后基线：$g_{\\mathrm{qcd}} = 17.25$。\n- μ子之后基线：$g_{\\mu} = 10.75$。\n- $e^\\pm$ 之后基线：能量自由度 $g_{*,e} = 3.36$，熵自由度 $g_{s,e} = 3.909$。\n\n将能量和熵自由度函数构造为\n$$\ng_*(T) = g_{\\mathrm{high}} - \\left(g_{\\mathrm{high}} - g_{\\mathrm{qcd}}\\right) S(T; T_0^{\\mathrm{qcd}}, \\Delta T^{\\mathrm{qcd}})\n- \\left(g_{\\mathrm{qcd}} - g_{\\mu}\\right) S(T; T_0^{\\mu}, \\Delta T^{\\mu})\n- \\left(g_{\\mu} - g_{*,e}\\right) S(T; T_0^{e}, \\Delta T^{e}),\n$$\n$$\ng_s(T) = g_{\\mathrm{high}} - \\left(g_{\\mathrm{high}} - g_{\\mathrm{qcd}}\\right) S(T; T_0^{\\mathrm{qcd}}, \\Delta T^{\\mathrm{qcd}})\n- \\left(g_{\\mathrm{qcd}} - g_{\\mu}\\right) S(T; T_0^{\\mu}, \\Delta T^{\\mu})\n- \\left(g_{\\mu} - g_{s,e}\\right) S(T; T_0^{e}, \\Delta T^{e}).\n$$\n推导并使用与上述 $S(T)$ 一致的 $dg_s/dT$。\n\n在推导和计算 $t(T)$ 的过程中使用自然单位制，即 $\\hbar = c = k_B = 1$，并在最后使用转换因子 $1\\,\\mathrm{MeV}^{-1} = 6.582119569\\times 10^{-22}\\,\\mathrm{s}$ 将结果转换为国际单位制 (SI) 秒。使用 $G_N = 1/M_\\mathrm{Pl}^2$ 和（非约化）普朗克质量 $M_\\mathrm{Pl} = 1.2209\\times 10^{22}\\,\\mathrm{MeV}$。\n\n通过假设 $g_s(T)$ 是常数且 $g_*(T)$ 沿热历史轨迹不变化来定义朴素的幂律估计 $t_{\\mathrm{naive}}(T)$；对于每个测试案例，将 $g_*$ 固定为最终温度 $T$ 时的值，并执行从一个高温参考 $T_{\\mathrm{ref}}$ 到 $T$ 的适当温度积分。\n\n你的程序必须计算无量纲畸变\n$$\nD(T) = \\frac{t_{\\mathrm{true}}(T)}{t_{\\mathrm{naive}}(T)} - 1,\n$$\n其中 $t_{\\mathrm{true}}(T)$ 是通过将推导出的 $dt/dT$（包括 $g_s(T)$ 和 $g_*(T)$ 的变化）从 $T_{\\mathrm{ref}}$ 到 $T$ 进行数值积分（单位为 $\\mathrm{MeV}$）得到的，而 $t_{\\mathrm{naive}}(T)$ 是在上述朴素假设下计算的。所有时间都必须以秒表示。\n\n使用兆电子伏特 (MeV) 为单位的温度实现以下测试套件：\n- 参考温度：$T_{\\mathrm{ref}} = 5000\\,\\mathrm{MeV}$。\n- 目标温度：$T \\in \\{150\\,\\mathrm{MeV}, 100\\,\\mathrm{MeV}, 20\\,\\mathrm{MeV}, 1\\,\\mathrm{MeV}, 0.1\\,\\mathrm{MeV}\\}$。\n\n为保证覆盖性而设计：\n- $T = 150\\,\\mathrm{MeV}$ 探测 QCD 交叉区域。\n- $T = 100\\,\\mathrm{MeV}$ 探测 QCD 之后、μ子湮灭之前的区域。\n- $T = 20\\,\\mathrm{MeV}$ 探测 μ子和 $e^\\pm$ 过渡之间的区域。\n- $T = 1\\,\\mathrm{MeV}$ 探测 $e^\\pm$ 湮灭刚发生前的区域。\n- $T = 0.1\\,\\mathrm{MeV}$ 探测 $e^\\pm$ 湮灭发生很久之后的区域。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，\"[result1,result2,result3,result4,result5]\"）。每个结果必须是畸变 $D(T)$ 并四舍五入到六位小数。不允许有其他输出。",
            "solution": "该问题要求在辐射主导时期，数值计算宇宙时间-温度关系 $t(T)$，并考虑温度依赖的有效自由度 $g_*(T)$ 和 $g_s(T)$。计算结果将与一个朴素估计进行比较，以量化畸变。解决方案主要分两个阶段：首先，从第一性原理推导 $t(T)$ 的主导微分方程；其次，设计一个数值算法来求解它。\n\n### 时间-温度关系的推导\n\n宇宙的演化由 Friedmann 方程决定。对于一个空间平坦、辐射主导的宇宙，该方程为：\n$$\nH^2 = \\left(\\frac{1}{a}\\frac{da}{dt}\\right)^2 = \\frac{8\\pi G_N}{3}\\rho(T)\n$$\n其中 H 是哈勃参数，a 是尺度因子，GN 是牛顿引力常数，ρ(T) 是相对论性等离子体的能量密度。能量密度由下式给出：\n$$\n\\rho(T) = \\frac{\\pi^2}{30} g_*(T) T^4\n$$\n其中 $g_*(T)$ 是有效相对论性能量自由度数，$T$ 是光子温度。所有计算都在自然单位制（$\\hbar = c = k_B = 1$）下进行。使用给定的关系式 $G_N = 1/M_\\mathrm{Pl}^2$，其中 $M_\\mathrm{Pl} = 1.2209\\times 10^{22}\\,\\mathrm{MeV}$ 是非约化普朗克质量，哈勃参数变为：\n$$\nH(T) = \\sqrt{\\frac{8\\pi}{3 M_\\mathrm{Pl}^2} \\frac{\\pi^2}{30} g_*(T) T^4} = \\frac{T^2}{M_\\mathrm{Pl}} \\sqrt{\\frac{4\\pi^3 g_*(T)}{45}}\n$$\n\n第二个基本原理是共动熵守恒。在一个共动体积中的总熵 $S = s(T)a^3$ 是一个常数。这意味着它对时间的导数为零：\n$$\n\\frac{d}{dt}(s a^3) = \\frac{ds}{dt}a^3 + s \\left(3a^2 \\frac{da}{dt}\\right) = 0\n$$\n使用链式法则 $\\frac{ds}{dt} = \\frac{ds}{dT}\\frac{dT}{dt}$ 以及哈勃参数的定义 $H = \\frac{1}{a}\\frac{da}{dt}$，我们得到：\n$$\n\\frac{ds}{dT}\\frac{dT}{dt} a^3 + 3Hsa^3 = 0 \\implies \\frac{dT}{dt} = -3H \\frac{s}{ds/dT}\n$$\n熵密度 $s(T)$ 由 $s(T) = \\frac{2\\pi^2}{45} g_s(T) T^3$ 给出。它对温度的导数是：\n$$\n\\frac{ds}{dT} = \\frac{2\\pi^2}{45} \\left( \\frac{dg_s}{dT}T^3 + g_s(T) \\cdot 3T^2 \\right) = s(T) \\left( \\frac{1}{g_s(T)}\\frac{dg_s}{dT} + \\frac{3}{T} \\right)\n$$\n将此代入 $\\frac{dT}{dt}$ 的表达式中：\n$$\n\\frac{dT}{dt} = -3H \\frac{s(T)}{s(T) \\left( \\frac{1}{g_s(T)}\\frac{dg_s}{dT} + \\frac{3}{T} \\right)} = -3H \\left( \\frac{T g_s(T)}{T \\frac{dg_s}{dT} + 3g_s(T)} \\right) = -HT \\left( \\frac{1}{1 + \\frac{T}{3g_s(T)}\\frac{dg_s}{dT}} \\right)\n$$\n我们寻求时间对温度的变化率 $\\frac{dt}{dT}$，它是 $\\frac{dT}{dt}$ 的倒数：\n$$\n\\frac{dt}{dT} = -\\frac{1}{HT} \\left( 1 + \\frac{T}{3g_s(T)}\\frac{dg_s}{dT} \\right)\n$$\n代入推导出的 $H(T)$ 表达式，我们得到真实时间演化 $t_{\\mathrm{true}}(T)$ 的最终微分方程：\n$$\n\\frac{dt}{dT}\\bigg|_{\\mathrm{true}} = - \\frac{M_\\mathrm{Pl}}{T^3} \\sqrt{\\frac{45}{4\\pi^3 g_*(T)}} \\left( 1 + \\frac{T}{3g_s(T)}\\frac{dg_s}{dT} \\right)\n$$\n从参考温度 $T_{\\mathrm{ref}}$ 到最终温度 $T$ 所经过的时间可以通过对该表达式积分得到：\n$$\nt_{\\mathrm{true}}(T) = \\int_{T_{\\mathrm{ref}}}^{T} \\frac{dt}{dT'}\\bigg|_{\\mathrm{true}} dT'\n$$\n\n### 朴素幂律估计\n朴素估计 $t_{\\mathrm{naive}}(T)$ 假设 $g_s$ 是常数（因此 $\\frac{dg_s}{dT} = 0$）且 $g_*$ 是常数，固定为其在最终温度时的值 $g_*(T_{\\text{final}})$。在这些假设下，微分方程大大简化：\n$$\n\\frac{dt}{dT}\\bigg|_{\\mathrm{naive}} = - \\frac{M_\\mathrm{Pl}}{T^3} \\sqrt{\\frac{45}{4\\pi^3 g_*(T_{\\text{final}})}}\n$$\n这个常微分方程（ODE）可以从 $T_{\\mathrm{ref}}$ 到 $T_{\\text{final}}$ 进行解析积分：\n$$\nt_{\\mathrm{naive}}(T_{\\text{final}}) = \\int_{T_{\\mathrm{ref}}}^{T_{\\text{final}}} \\left( - \\frac{M_\\mathrm{Pl}}{T'^3} \\sqrt{\\frac{45}{4\\pi^3 g_*(T_{\\text{final}})}} \\right) dT' = \\frac{M_\\mathrm{Pl}}{2} \\sqrt{\\frac{45}{4\\pi^3 g_*(T_{\\text{final}})}} \\left( \\frac{1}{T_{\\text{final}}^2} - \\frac{1}{T_{\\mathrm{ref}}^2} \\right)\n$$\n\n### 自由度及其导数\n函数 $g_*(T)$ 和 $g_s(T)$ 使用提供的形状函数 $S(T; T_0, \\Delta T) = \\frac{1}{2}\\left[1 + \\tanh\\!\\left(\\frac{T_0 - T}{\\Delta T}\\right)\\right]$ 构建。为了计算 $t_{\\mathrm{true}}$ 的被积函数，我们需要 $g_s(T)$ 的解析导数。形状函数的导数是：\n$$\n\\frac{dS}{dT}(T; T_0, \\Delta T) = \\frac{d}{dT}\\left[\\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{T_0 - T}{\\Delta T}\\right)\\right)\\right] = -\\frac{1}{2\\Delta T} \\mathrm{sech}^2\\left(\\frac{T_0 - T}{\\Delta T}\\right)\n$$\n由于 $g_s(T)$ 是各种过渡（QCD、μ子、电子）的 $S$ 函数的线性组合，其导数 $\\frac{dg_s}{dT}$ 是对应的 $\\frac{dS}{dT}$ 项的线性组合。\n\n### 数值实现\n求解算法如下：\n1.  定义所有物理常数（$M_\\mathrm{Pl}$、MeV 到 s 的转换因子）和模型参数（每个过渡的 $T_0, \\Delta T$ 和基线 $g$ 值）。\n2.  根据提供的公式实现 $g_*(T)$、$g_s(T)$ 及其解析导数 $\\frac{dg_s}{dT}(T)$ 的函数。\n3.  对于测试套件中的每个目标温度 $T_f$：\n    a. 通过从 $T_{\\mathrm{ref}}$ 到 $T_f$ 积分 $\\frac{dt}{dT}|_{\\mathrm{true}}$ 来数值计算 $t_{\\mathrm{true}}(T_f)$。由于像 `scipy.integrate.quad` 这样的数值积分器通常要求积分下限小于上限，我们计算 $t_{\\mathrm{true}}(T_f) = -\\int_{T_f}^{T_{\\mathrm{ref}}} \\frac{dt}{dT'}|_{\\mathrm{true}} dT' = \\int_{T_f}^{T_{\\mathrm{ref}}} \\left(-\\frac{dt}{dT'}|_{\\mathrm{true}}\\right) dT'$。结果以 $\\mathrm{MeV}^{-1}$ 为单位得到，并转换为秒。\n    b. 使用其推导出的公式解析计算 $t_{\\mathrm{naive}}(T_f)$，其中 $g_*(T_{\\text{final}})$ 在 $T_f$ 处求值。结果也以 $\\mathrm{MeV}^{-1}$ 为单位得到，并转换为秒。\n    c. 计算无量纲畸变 $D(T_f) = \\frac{t_{\\mathrm{true}}(T_f)}{t_{\\mathrm{naive}}(T_f)} - 1$。\n4.  收集畸变值，将它们四舍五入到六位小数，并格式化为方括号内的逗号分隔列表。\n这个过程确保了精确模型和简化的朴素估计之间的严格比较，揭示了熵释放过程对宇宙热历史的影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes the distortion D(T) in the cosmic time-temperature relation\n    for a set of target temperatures in the early universe.\n    \"\"\"\n    # Define constants and parameters as per the problem statement\n    # Natural units: h_bar = c = k_B = 1\n    \n    # Physical constants\n    M_PL = 1.2209e22  # Non-reduced Planck mass in MeV\n    MEV_TO_S = 6.582119569e-22  # Conversion factor from MeV^-1 to s\n\n    # Transition parameters (T0 in MeV, dT in MeV)\n    T0_QCD, DT_QCD = 155.0, 50.0\n    T0_MU, DT_MU = 105.0, 20.0\n    T0_E, DT_E = 0.5, 0.2\n\n    # Degrees of freedom (g) baselines\n    G_HIGH = 61.75\n    G_QCD = 17.25\n    G_MU = 10.75\n    G_STAR_E = 3.36\n    G_S_E = 3.909\n\n    # Pre-calculate differences for g* and gs calculations\n    DG_QCD = G_HIGH - G_QCD\n    DG_MU = G_QCD - G_MU\n    DG_STAR_E = G_MU - G_STAR_E\n    DG_S_E = G_MU - G_S_E\n    \n    # Test suite parameters\n    T_REF = 5000.0  # Reference temperature in MeV\n    TARGET_TEMPS = [150.0, 100.0, 20.0, 1.0, 0.1] # Target temperatures in MeV\n\n    # --- Helper functions ---\n\n    def S(T, T0, dT):\n        \"\"\"Transition shaping function S(T; T0, dT).\"\"\"\n        return 0.5 * (1.0 + np.tanh((T0 - T) / dT))\n\n    def g_star(T):\n        \"\"\"Effective number of relativistic energy degrees of freedom g_*(T).\"\"\"\n        s_qcd = S(T, T0_QCD, DT_QCD)\n        s_mu = S(T, T0_MU, DT_MU)\n        s_e = S(T, T0_E, DT_E)\n        return G_HIGH - DG_QCD * s_qcd - DG_MU * s_mu - DG_STAR_E * s_e\n\n    def g_s(T):\n        \"\"\"Effective number of relativistic entropy degrees of freedom g_s(T).\"\"\"\n        s_qcd = S(T, T0_QCD, DT_QCD)\n        s_mu = S(T, T0_MU, DT_MU)\n        s_e = S(T, T0_E, DT_E)\n        return G_HIGH - DG_QCD * s_qcd - DG_MU * s_mu - DG_S_E * s_e\n\n    def dS_dT(T, T0, dT):\n        \"\"\"Derivative of the shaping function S with respect to T.\"\"\"\n        # sech(x)^2 = 1/cosh(x)^2\n        arg = (T0 - T) / dT\n        return -1.0 / (2.0 * dT * np.cosh(arg)**2)\n\n    def dg_s_dT(T):\n        \"\"\"Derivative of g_s(T) with respect to T.\"\"\"\n        dsdt_qcd = dS_dT(T, T0_QCD, DT_QCD)\n        dsdt_mu = dS_dT(T, T0_MU, DT_MU)\n        dsdt_e = dS_dT(T, T0_E, DT_E)\n        return -DG_QCD * dsdt_qcd - DG_MU * dsdt_mu - DG_S_E * dsdt_e\n    \n    # --- Integrand for dt/dT_true ---\n    # We compute -dt/dT, which is positive, and integrate from T_final to T_ref\n    # to get t_true = t(T_final) - t(T_ref).\n    \n    # Constant part of the expression for dt/dT: M_Pl * sqrt(45 / (4*pi^3))\n    const_integrand_part = M_PL * np.sqrt(45.0 / (4.0 * np.pi**3))\n\n    def true_integrand(T):\n        \"\"\"The function -dt/dT to be integrated for t_true.\"\"\"\n        g_star_val = g_star(T)\n        g_s_val = g_s(T)\n        dg_s_dT_val = dg_s_dT(T)\n        \n        term1 = const_integrand_part / (T**3 * np.sqrt(g_star_val))\n        term2 = 1.0 + (T / (3.0 * g_s_val)) * dg_s_dT_val\n        \n        return term1 * term2\n\n    results = []\n    for T_final in TARGET_TEMPS:\n        # --- 1. Calculate t_true ---\n        # Integrate from T_final (lower limit) to T_ref (upper limit).\n        integral_result, _ = integrate.quad(true_integrand, T_final, T_REF)\n        t_true_mev_inv = integral_result\n        t_true_s = t_true_mev_inv * MEV_TO_S\n\n        # --- 2. Calculate t_naive ---\n        g_star_final = g_star(T_final)\n        \n        # Coefficient for the naive calculation\n        c_naive = (M_PL / 2.0) * np.sqrt(45.0 / (4.0 * np.pi**3 * g_star_final))\n        \n        t_naive_mev_inv = c_naive * (1.0 / T_final**2 - 1.0 / T_REF**2)\n        t_naive_s = t_naive_mev_inv * MEV_TO_S\n\n        # --- 3. Calculate the distortion D(T) ---\n        distortion = t_true_s / t_naive_s - 1.0\n        results.append(f\"{distortion:.6f}\")\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "电子-正电子湮灭是早期宇宙中的一个关键事件，它将大量的熵从电子-正电子对转移给了光子，但已解耦的中微子并未被加热。这个过程导致了中微子温度相对于光子温度的降低，并对有效的相对论自由度数目 $N_{\\text{eff}}$ 产生了可观测的修正。本练习将指导你通过精确计算热力学积分，并考虑量子电动力学（QED）修正，来定量分析这一过程，从而掌握计算关键宇宙学参数的精髓。",
            "id": "3499106",
            "problem": "构建一个完整的、可运行的程序，通过将量子电动力学(QED)修正的热力学性质纳入相互作用的等离子体中，为一组测试用例数值计算电子-正电子湮灭后的最终中微子-光子温度比和有效中微子物种数。物理情景是早期宇宙在电子-正电子湮灭时期，中微子在指定的退耦温度下瞬时退耦。结果必须是无量纲的，并以实数形式报告。\n\n您必须使用的基本依据是：在任何保持局域热平衡的区域中，共动熵守恒；理想费米-狄拉克和玻色-爱因斯坦气体的相对论动理学理论；以及有效中微子物种数的定义。仅从这些基础出发。不要使用预先制表的拟合公式来计算最终的中微子-光子温度比或最终的有效中微子物种数。您必须从第一性原理推导并实现必要的热力学积分。\n\n需要实现的假设和定义：\n- 使用自然单位制，其中玻尔兹曼常数、光速和约化普朗克常数均设为1，因此温度即能量。温度以兆电子伏特(MeV)表示。所有输出均为无单位的纯数字。\n- 假设电子和正电子在指定的退耦温度 $T_{\\mathrm{dec}}$ 之前与光子处于局域热平衡状态，此后中微子自由流，而光子与电子-正电子对在对湮灭为光子期间保持平衡。\n- 假设在 $T_{\\mathrm{dec}}$ 发生瞬时退耦，这意味着中微子在 $T_{\\mathrm{dec}}$ 时与等离子体具有共同的温度，随后随尺度因子绝热冷却。\n- 对于理想热力学（无QED修正），具有能量密度 $\\rho$ 和压强 $P$ 的物种在温度 $T$ 下的熵密度为 $s = (\\rho + P)/T$。对于光子，其 $g_{\\gamma} = 2$，有 $s_{\\gamma}(T) = \\frac{2 \\pi^2}{45} g_{\\gamma} T^3$。对于一个总内禀自由度为 $g_{e^\\pm} = 4$、质量为 $m_e$ 的理想费米-狄拉克电子和正电子气体，其在温度 $T$ 下的能量密度和压强由以下积分计算：\n$$\n\\rho_{e^\\pm}(T) = \\frac{g_{e^\\pm}}{2 \\pi^2} T^4 \\int_{0}^{\\infty} \\mathrm{d}y \\, \\frac{y^2 \\sqrt{y^2 + z^2}}{\\exp\\!\\left(\\sqrt{y^2 + z^2}\\right) + 1},\n\\quad\nP_{e^\\pm}(T) = \\frac{g_{e^\\pm}}{6 \\pi^2} T^4 \\int_{0}^{\\infty} \\mathrm{d}y \\, \\frac{y^4/\\sqrt{y^2 + z^2}}{\\exp\\!\\left(\\sqrt{y^2 + z^2}\\right) + 1},\n$$\n其中 $z = m_e/T$ 且 $y = p/T$ 是无量纲动量。则 $s_{e^\\pm}(T) = \\left(\\rho_{e^\\pm}(T) + P_{e^\\pm}(T)\\right)/T$。\n- 相互作用等离子体部分的有效熵自由度 $g_{s,\\gamma e}(T)$ 由 $s_{\\gamma e}(T) \\equiv s_{\\gamma}(T) + s_{e^\\pm}(T) = \\frac{2 \\pi^2}{45} g_{s,\\gamma e}(T) T^3$ 定义。\n- 必须将QED修正的热力学作为对相互作用部分熵密度的微扰、领头阶修正包含进来。实现以下最小、保守且物理上合理的拟设：\n    1. 将超相对论电子-正电子熵密度（理想，无质量）定义为 $s_{e^\\pm}^{\\mathrm{UR}}(T) = \\frac{2 \\pi^2}{45} \\left(\\frac{7}{8}\\right) g_{e^\\pm} T^3$。\n    2. 定义电子-正电子超相对论权重 $w(T) = s_{e^\\pm}(T) / s_{e^\\pm}^{\\mathrm{UR}}(T)$。\n    3. 经QED修正的相互作用部分熵为 $s_{\\gamma e}^{\\mathrm{QED}}(T) = s_{\\gamma e}^{\\mathrm{ideal}}(T) \\left[ 1 + \\left( \\frac{\\alpha}{\\pi} \\right) c_0 \\, w(T) \\right]$，其中 $\\alpha$ 是电磁精细结构常数， $c_0 = -\\frac{5}{4}$。这捕捉了高温下热力学势的领头阶减少，并在粒子对通过 $w(T)$ 湮灭时消失。\n    4. 从 $s_{\\gamma e}^{\\mathrm{QED}}(T)$，通过 $s_{\\gamma e}^{\\mathrm{QED}}(T) = \\frac{2 \\pi^2}{45} g_{s,\\gamma e}^{\\mathrm{QED}}(T) T^3$ 定义 $g_{s,\\gamma e}^{\\mathrm{QED}}(T)$。\n- 根据中微子退耦后相互作用部分的共动熵守恒以及中微子的独立绝热冷却，仅用 $g_{s,\\gamma e}(T_{\\mathrm{dec}})$ 和纯光子的 $g_{s,\\gamma}(T) = 2$ 来推导最终的中微子-光子温度比。您必须得出一个通用表达式，然后进行数值计算。\n- 根据标准关系式定义有效中微子物种数 $N_{\\mathrm{eff}}$：\n$$\n\\rho_{\\nu} \\equiv N_{\\mathrm{eff}} \\left(\\frac{7}{8}\\right) \\left( \\frac{4}{11} \\right)^{4/3} \\rho_{\\gamma},\n$$\n并为您给定的标准模型类中微子物种数 $N_{\\nu}$ 计算与其 $T_{\\nu}/T_{\\gamma}$ 一致的 $N_{\\mathrm{eff}}$。您的定义必须在 $T_{\\nu}/T_{\\gamma} = \\left(\\frac{4}{11}\\right)^{1/3}$ 时简化为 $N_{\\mathrm{eff}} = N_{\\nu}$。\n\n需使用的常数：\n- 电子质量 $m_e = 0.51099895\\,\\mathrm{MeV}$。\n- 精细结构常数 $\\alpha = 1/137.035999084$。\n- 内禀自由度 $g_{\\gamma} = 2$ 和 $g_{e^\\pm} = 4$。\n\n必需的数值实现细节：\n- 您必须数值计算所需的费米-狄拉克积分，其精度需足以分辨在 $T \\sim \\mathcal{O}(\\mathrm{MeV})$ 附近的亚百分比修正。您可自由选择指定环境中任何稳定且收敛的求积方法。\n- 所有量均为纯数字；输出中不应出现单位。\n- 为保证可复现性，在包含QED修正的情况下，请严格实现上述指定的拟设；不要替换任何其他修正模型。\n\n测试套件：\n您的程序必须为以下五个案例计算结果，每个案例指定为一个元组 $(T_{\\mathrm{dec}}, \\mathrm{include\\_QED}, N_{\\nu})$：\n- 案例1：$(2.0, \\mathrm{True}, 3.0)$。\n- 案例2：$(2.0, \\mathrm{False}, 3.0)$。\n- 案例3：$(20.0, \\mathrm{True}, 3.0)$。\n- 案例4：$(0.3, \\mathrm{True}, 3.0)$。\n- 案例5：$(2.0, \\mathrm{True}, 2.5)$。\n\n输出规范：\n- 对每个案例，使用您推导的表达式和数值积分计算数对 $\\left[T_{\\nu}/T_{\\gamma}, N_{\\mathrm{eff}}\\right]$。\n- 将每个实数四舍五入到 $6$ 位小数。\n- 您的程序应生成单行输出，其中包含结果，格式为无空格、逗号分隔的列表之列表，精确格式如下：\n$[\\,[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4],[x_5,y_5]\\,]$,\n其中 $x_i$ 和 $y_i$ 是案例 $i$ 的四舍五入值。例如，一个语法正确的行看起来像 $[[0.713766,3.000000],[\\dots]]$。\n\n科学真实性和约束：\n- 确保您的实现严格遵循上述定义，并遵守共动熵守恒。\n- 不要在您的代码或推导中包含任何直接给出 $T_{\\nu}/T_{\\gamma}$ 或 $N_{\\mathrm{eff}}$ 最终结果的公式，除非它是从前面描述的基本依据推导出来的。\n- 在整个测试套件中保持所有计算的数值稳定性，特别是对于边界情况 $T_{\\mathrm{dec}} = 0.3$（此时电子-正电子对已处于非相对论状态）。\n\n您的最终交付成果必须是一个独立的、可运行的程序，该程序执行这些计算并打印所需的单行输出。",
            "solution": "该问题要求计算早期宇宙中电子-正电子湮灭之后，最终的中微子-光子温度比 $T_{\\nu}/T_{\\gamma}$ 和有效中微子物种数 $N_{\\mathrm{eff}}$。这需要从第一性原理出发，并包含一个可选的领头阶QED修正。该解法主要通过三个步骤推导得出：\n1.  从共动熵守恒推导温度比 $T_{\\nu}/T_{\\gamma}$。\n2.  计算相互作用的光子-电子-正电子等离子体的有效熵自由度 $g_{s,\\gamma e}$，包括指定的QED修正。\n3.  根据 $N_{\\mathrm{eff}}$ 的标准定义和已计算的温度比推导 $N_{\\mathrm{eff}}$。\n\n我们在自然单位制中工作，其中 $\\hbar=c=k_B=1$。\n\n**1. 最终温度比 $T_{\\nu}/T_{\\gamma}$ 的推导**\n\n核心原理是，对于任何处于局域热平衡的系统，其共动体积内的熵是守恒的。我们假设，在一个退耦温度 $T_{\\mathrm{dec}}$ 时，中微子从由光子、电子和正电子组成的原始等离子体中退耦。退耦之后，中微子部分和光子-电子-正电子（$\\gamma e^\\pm$）部分分开演化，各自的共动熵保持守恒。\n\n令 $S=sa^3$ 为共动熵，其中 $s$ 是熵密度， $a$ 是宇宙的尺度因子。\n对于 $\\gamma e^\\pm$ 等离子体，其共动熵从中微子退耦时刻（$T=T_{\\mathrm{dec}}$）到远在电子-正电子湮灭之后（$T_{\\gamma} \\ll m_e$）都保持守恒。\n$$ S_{\\gamma e}(T_{\\mathrm{dec}}) = S_{\\gamma e, \\mathrm{final}} $$\n$$ s_{\\gamma e}(T_{\\mathrm{dec}}) a(T_{\\mathrm{dec}})^3 = s_{\\gamma}(T_{\\gamma}) a(T_{\\gamma})^3 $$\n此处，$s_{\\gamma e}(T)$ 是 $\\gamma e^\\pm$ 等离子体在温度 $T$ 下的熵密度，$s_{\\gamma}(T_{\\gamma})$ 是剩余光子气体在其最终温度 $T_{\\gamma}$ 下的熵密度。最终的等离子体只包含光子，因为所有电子-正电子对都已湮灭。\n\n在温度 $T$ 下处于热平衡的一组物种的熵密度，可以用有效熵自由度 $g_s(T)$ 来表示：\n$$ s(T) = \\frac{2\\pi^2}{45} g_s(T) T^3 $$\n将此应用于我们的熵守恒方程：\n$$ \\frac{2\\pi^2}{45} g_{s,\\gamma e}(T_{\\mathrm{dec}}) T_{\\mathrm{dec}}^3 a(T_{\\mathrm{dec}})^3 = \\frac{2\\pi^2}{45} g_{s,\\gamma}(T_{\\gamma}) T_{\\gamma}^3 a(T_{\\gamma})^3 $$\n其中 $g_{s,\\gamma e}(T_{\\mathrm{dec}})$ 是 $\\gamma e^\\pm$ 等离子体在 $T_{\\mathrm{dec}}$ 时的有效熵自由度，$g_{s,\\gamma}(T_{\\gamma})$ 是光子气体的有效熵自由度。对于纯光子气体，$g_{s,\\gamma}(T_{\\gamma}) = g_{\\gamma} = 2$。方程简化为：\n$$ g_{s,\\gamma e}(T_{\\mathrm{dec}}) (T_{\\mathrm{dec}} a(T_{\\mathrm{dec}}))^3 = g_{\\gamma} (T_{\\gamma} a(T_{\\gamma}))^3 $$\n中微子在退耦后被假定为自由流动的相对论性粒子。它们的熵也守恒，这意味着它们的温度与尺度因子成反比，即 $T_{\\nu} \\propto 1/a$。因此，量 $T_{\\nu} a$ 是一个常数。在退耦时，$T_{\\nu}(T_{\\mathrm{dec}}) = T_{\\mathrm{dec}}$。因此，对于之后任何尺度因子为 $a(T_{\\gamma})$、中微子温度为 $T_{\\nu}$ 的时刻，我们有：\n$$ T_{\\mathrm{dec}} a(T_{\\mathrm{dec}}) = T_{\\nu} a(T_{\\gamma}) $$\n将中微子冷却关系中的 $T_{\\mathrm{dec}} a(T_{\\mathrm{dec}})$ 代入 $\\gamma e^\\pm$ 熵守恒方程：\n$$ g_{s,\\gamma e}(T_{\\mathrm{dec}}) (T_{\\nu} a(T_{\\gamma}))^3 = g_{\\gamma} (T_{\\gamma} a(T_{\\gamma}))^3 $$\n$$ g_{s,\\gamma e}(T_{\\mathrm{dec}}) T_{\\nu}^3 a(T_{\\gamma})^3 = g_{\\gamma} T_{\\gamma}^3 a(T_{\\gamma})^3 $$\n解出最终温度比 $T_{\\nu}/T_{\\gamma}$：\n$$ \\frac{T_{\\nu}}{T_{\\gamma}} = \\left( \\frac{g_{\\gamma}}{g_{s,\\gamma e}(T_{\\mathrm{dec}})} \\right)^{1/3} $$\n给定 $g_{\\gamma}=2$，需要计算的最终表达式为：\n$$ \\frac{T_{\\nu}}{T_{\\gamma}} = \\left( \\frac{2}{g_{s,\\gamma e}(T_{\\mathrm{dec}})} \\right)^{1/3} $$\n\n**2. $g_{s,\\gamma e}(T_{\\mathrm{dec}})$ 的计算**\n\n关键任务是计算 $g_{s,\\gamma e}(T_{\\mathrm{dec}})$，这个值取决于是否包含QED修正。\n\n**理想气体情况（无QED修正）：**\n理想 $\\gamma e^\\pm$ 等离子体的总熵密度为 $s_{\\gamma e}^{\\mathrm{ideal}}(T) = s_{\\gamma}(T) + s_{e^\\pm}(T)$。根据定义，$s_{\\gamma e}^{\\mathrm{ideal}}(T) = \\frac{2\\pi^2}{45} g_{s,\\gamma e}^{\\mathrm{ideal}}(T) T^3$。\n这给出：\n$$ g_{s,\\gamma e}^{\\mathrm{ideal}}(T) = \\frac{45}{2\\pi^2 T^3} \\left( s_{\\gamma}(T) + s_{e^\\pm}(T) \\right) $$\n由于 $s_{\\gamma}(T) = \\frac{2\\pi^2}{45} g_{\\gamma} T^3$，上式变为：\n$$ g_{s,\\gamma e}^{\\mathrm{ideal}}(T) = g_{\\gamma} + \\frac{45}{2\\pi^2 T^3} s_{e^\\pm}(T) $$\n电子和正电子（$e^\\pm$）的熵密度由 $s_{e^\\pm}(T) = (\\rho_{e^\\pm}(T) + P_{e^\\pm}(T))/T$ 给出。能量密度 $\\rho_{e^\\pm}$ 和压强 $P_{e^\\pm}$ 由以下积分给出：\n$$ \\rho_{e^\\pm}(T) = \\frac{g_{e^\\pm}}{2 \\pi^2} T^4 I_{\\rho}(z), \\quad P_{e^\\pm}(T) = \\frac{g_{e^\\pm}}{6 \\pi^2} T^4 I_{P}(z) $$\n其中 $z=m_e/T$，无量纲积分为：\n$$ I_{\\rho}(z) = \\int_{0}^{\\infty} \\mathrm{d}y \\, \\frac{y^2 \\sqrt{y^2 + z^2}}{\\exp\\left(\\sqrt{y^2 + z^2}\\right) + 1}, \\quad I_{P}(z) = \\int_{0}^{\\infty} \\mathrm{d}y \\, \\frac{y^4/\\sqrt{y^2 + z^2}}{\\exp\\left(\\sqrt{y^2 + z^2}\\right) + 1} $$\n因此，$s_{e^\\pm}(T) = \\frac{g_{e^\\pm} T^3}{6\\pi^2} (3 I_{\\rho}(z) + I_P(z))$。将此代入 $g_{s,\\gamma e}^{\\mathrm{ideal}}$ 的表达式中：\n$$ g_{s,\\gamma e}^{\\mathrm{ideal}}(T) = g_{\\gamma} + \\frac{45}{2\\pi^2 T^3} \\left( \\frac{g_{e^\\pm} T^3}{6\\pi^2} [3 I_{\\rho}(z) + I_P(z)] \\right) = g_{\\gamma} + \\frac{15 g_{e^\\pm}}{4\\pi^4} [3 I_{\\rho}(z) + I_P(z)] $$\n使用给定的值 $g_{\\gamma}=2$ 和 $g_{e^\\pm}=4$：\n$$ g_{s,\\gamma e}^{\\mathrm{ideal}}(T) = 2 + \\frac{15}{\\pi^4} [3 I_{\\rho}(m_e/T) + I_P(m_e/T)] $$\n\n**经QED修正的情况：**\n问题为QED修正指定了一个特定的拟设。修正后的熵密度为：\n$$ s_{\\gamma e}^{\\mathrm{QED}}(T) = s_{\\gamma e}^{\\mathrm{ideal}}(T) \\left[ 1 + \\left( \\frac{\\alpha}{\\pi} \\right) c_0 \\, w(T) \\right] $$\n其中 $\\alpha$ 是精细结构常数，$c_0 = -5/4$，$w(T)$ 是一个权重因子，定义为实际 $e^\\pm$ 熵密度与其超相对论形式的比值：\n$$ w(T) = \\frac{s_{e^\\pm}(T)}{s_{e^\\pm}^{\\mathrm{UR}}(T)} $$\n超相对论熵密度为 $s_{e^\\pm}^{\\mathrm{UR}}(T) = \\frac{2\\pi^2}{45} \\left(\\frac{7}{8}\\right) g_{e^\\pm} T^3$。代入熵密度的表达式：\n$$ w(T) = \\frac{\\frac{g_{e^\\pm} T^3}{6\\pi^2} [3 I_{\\rho}(z) + I_P(z)]}{\\frac{2\\pi^2}{45} \\frac{7}{8} g_{e^\\pm} T^3} = \\frac{1}{6\\pi^2} \\frac{45 \\cdot 8}{14\\pi^2} [3 I_{\\rho}(z) + I_P(z)] = \\frac{30}{7\\pi^4} [3 I_{\\rho}(z) + I_P(z)] $$\n经QED修正的有效自由度 $g_{s,\\gamma e}^{\\mathrm{QED}}(T)$ 由 $s_{\\gamma e}^{\\mathrm{QED}}(T) = \\frac{2\\pi^2}{45} g_{s,\\gamma e}^{\\mathrm{QED}}(T) T^3$ 定义。这直接导致：\n$$ g_{s,\\gamma e}^{\\mathrm{QED}}(T) = g_{s,\\gamma e}^{\\mathrm{ideal}}(T) \\left[ 1 + \\left( \\frac{\\alpha}{\\pi} \\right) c_0 \\, w(T) \\right] $$\n当启用QED修正时，这个值将被用于 $T_{\\nu}/T_{\\gamma}$ 表达式的分母中。\n\n**3. $N_{\\mathrm{eff}}$ 的推导**\n\n有效中微子物种数 $N_{\\mathrm{eff}}$ 由以下关系定义：\n$$ \\rho_{\\nu, \\mathrm{total}} \\equiv N_{\\mathrm{eff}} \\left(\\frac{7}{8}\\right) \\left( \\frac{4}{11} \\right)^{4/3} \\rho_{\\gamma} $$\n此处，$\\rho_{\\nu, \\mathrm{total}}$ 是所有中微子物种的总能量密度，$\\rho_{\\gamma}$ 是光子的能量密度。我们在最终状态（$T \\ll m_e$）下计算这些量。假设有 $N_{\\nu}$ 种标准模型类的中微子（和反中微子），每种都是一个相对论性费米子气体，具有 $g=2$ 的自由度（粒子+反粒子），它们的总能量密度为：\n$$ \\rho_{\\nu, \\mathrm{total}} = N_{\\nu} \\times \\left( \\frac{7}{8} \\frac{\\pi^2}{15} T_{\\nu}^4 \\right) $$\n光子的能量密度是具有 $g_{\\gamma}=2$ 的相对论性玻色子气体：\n$$ \\rho_{\\gamma} = \\frac{\\pi^2}{15} T_{\\gamma}^4 $$\n将这些代入 $N_{\\mathrm{eff}}$ 的定义中：\n$$ N_{\\nu} \\frac{7}{8} \\frac{\\pi^2}{15} T_{\\nu}^4 = N_{\\mathrm{eff}} \\frac{7}{8} \\left( \\frac{4}{11} \\right)^{4/3} \\frac{\\pi^2}{15} T_{\\gamma}^4 $$\n解出 $N_{\\mathrm{eff}}$：\n$$ N_{\\mathrm{eff}} = N_{\\nu} \\left( \\frac{T_{\\nu}}{T_{\\gamma}} \\right)^4 \\left( \\frac{11}{4} \\right)^{4/3} $$\n这个表达式使我们能够从中微子物种数 $N_{\\nu}$ 和我们之前推导的温度比 $T_{\\nu}/T_{\\gamma}$ 计算出 $N_{\\mathrm{eff}}$。\n\n**数值计算步骤：**\n对于每个测试用例 $(T_{\\mathrm{dec}}, \\mathrm{include\\_QED}, N_{\\nu})$：\n1.  计算 $z=m_e/T_{\\mathrm{dec}}$。\n2.  使用求积法数值计算积分 $I_{\\rho}(z)$ 和 $I_P(z)$。\n3.  使用其推导公式计算 $g_{s,\\gamma e}^{\\mathrm{ideal}}(T_{\\mathrm{dec}})$。\n4.  如果 `include_QED` 为真，计算 $w(T_{\\mathrm{dec}})$，然后计算 $g_{s,\\gamma e}^{\\mathrm{QED}}(T_{\\mathrm{dec}})$。设置 $g_s = g_{s,\\gamma e}^{\\mathrm{QED}}(T_{\\mathrm{dec}})$。否则，设置 $g_s = g_{s,\\gamma e}^{\\mathrm{ideal}}(T_{\\mathrm{dec}})$。\n5.  计算温度比 $T_{\\nu}/T_{\\gamma} = (2/g_s)^{1/3}$。\n6.  使用其推导公式计算 $N_{\\mathrm{eff}}$。\n7.  四舍五入并存储结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes the final neutrino-to-photon temperature ratio and the effective\n    number of neutrino species after e+- annihilation, based on entropy conservation\n    and a specified QED correction model.\n    \"\"\"\n    \n    # Constants in specified units (MeV for mass and temperature)\n    m_e = 0.51099895  # electron mass in MeV\n    alpha = 1.0 / 137.035999084  # fine-structure constant\n    g_gamma = 2.0  # photon degrees of freedom\n    g_e = 4.0  # electron+positron degrees of freedom\n    c0 = -5.0 / 4.0  # coefficient for QED correction ansatz\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2.0, True, 3.0),\n        (2.0, False, 3.0),\n        (20.0, True, 3.0),\n        (0.3, True, 3.0),\n        (2.0, True, 2.5),\n    ]\n\n    # Memoization cache for integrals to avoid re-computation\n    integral_cache = {}\n\n    def get_thermo_integrals(z):\n        \"\"\"\n        Numerically computes and returns the thermodynamic integrals I_rho and I_p\n        for a given z = m_e/T. Uses memoization for efficiency.\n        \"\"\"\n        if z in integral_cache:\n            return integral_cache[z]\n\n        # Integrand for energy density rho\n        def integrand_rho(y, z_val):\n            # The integrand can be zero for y=0, which is fine\n            if y == 0:\n                return 0.0\n            energy_term = np.sqrt(y**2 + z_val**2)\n            # Use log-exp trick for numerical stability if energy_term is large\n            if energy_term > 700: # np.exp(709) is around max float\n                return 0.0\n            return y**2 * energy_term / (np.exp(energy_term) + 1.0)\n\n        # Integrand for pressure P\n        def integrand_p(y, z_val):\n            # Integrand is zero at y=0, avoiding division by zero\n            if y == 0:\n                return 0.0\n            energy_term = np.sqrt(y**2 + z_val**2)\n            if energy_term > 700:\n                return 0.0\n            return (y**4 / energy_term) / (np.exp(energy_term) + 1.0)\n            \n        # Perform numerical integration using scipy.integrate.quad\n        I_rho, _ = integrate.quad(integrand_rho, 0, np.inf, args=(z,))\n        I_p, _ = integrate.quad(integrand_p, 0, np.inf, args=(z,))\n        \n        integral_cache[z] = (I_rho, I_p)\n        return I_rho, I_p\n\n    results = []\n    for case in test_cases:\n        T_dec, include_QED, N_nu = case\n        \n        z = m_e / T_dec\n        \n        # 1. Compute thermodynamic integrals\n        I_rho_val, I_p_val = get_thermo_integrals(z)\n        \n        # Common term in g_s and w\n        integral_combo = 3.0 * I_rho_val + I_p_val\n\n        # 2. Compute g_s_ideal\n        # g_s_ideal = g_gamma + (15 * g_e) / (4 * pi^4) * (3*I_rho + I_p)\n        g_s_contrib_e = (15.0 * g_e) / (4.0 * np.pi**4) * integral_combo\n        g_s_ideal = g_gamma + g_s_contrib_e\n        \n        g_s_final = g_s_ideal\n        \n        # 3. Apply QED correction if requested\n        if include_QED:\n            # w(T) = (30 / (7 * pi^4)) * (3*I_rho + I_p)\n            w = (30.0 / (7.0 * np.pi**4)) * integral_combo\n            \n            # g_s_QED = g_s_ideal * [1 + (alpha/pi) * c0 * w]\n            correction_factor = 1.0 + (alpha / np.pi) * c0 * w\n            g_s_qed = g_s_ideal * correction_factor\n            g_s_final = g_s_qed\n\n        # 4. Compute final temperature ratio\n        # T_nu / T_gamma = (g_gamma / g_s_final)^(1/3)\n        T_ratio = (g_gamma / g_s_final)**(1.0 / 3.0)\n        \n        # 5. Compute effective number of neutrino species\n        # N_eff = N_nu * (T_nu/T_gamma)^4 * (11/4)^(4/3)\n        N_eff = N_nu * (T_ratio**4) * (11.0 / 4.0)**(4.0 / 3.0)\n        \n        # Append rounded results for this case\n        results.append([round(T_ratio, 6), round(N_eff, 6)])\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    # Ex: [[0.713766,3.000000],[...]] without spaces\n    result_str = \",\".join([f\"[{res[0]},{res[1]}]\" for res in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在复合发生之前，光子-重子流体中的小尺度密度涨落由于光子扩散而被抹去，这一过程被称为丝绸阻尼（Silk damping）。这个物理过程将声波模式的能量耗散掉，并以一种被称为 $\\mu$ 扭曲的特定形式，改变了宇宙微波背景（CMB）的黑体谱。本练习提供了一个动手实践的机会，让你模拟这一能量耗散过程，并计算由此产生的 $\\mu$ 扭曲，从而探索如何利用CMB谱扭曲这一未来可观测的物理量来探测极小尺度上的原初功率谱信息。",
            "id": "3498976",
            "problem": "考虑一个简化的、具有物理动机的模型，用于描述宇宙微波背景（CMB）退耦前时代，由光子扩散（丝绸阻尼）引起的小尺度原初光子-重子声学扰动的耗散，以及由此产生的CMB谱畸变。在光子-重子流体的紧耦合机制下，光子的空间扩散会阻尼具有共动波数 $k$ 的声学模式。在 $\\mu$-畸变时代的中心附近，该阻尼因子可以很好地近似为一个指数抑制窗口，其特征共动扩散尺度为 $k_{D}$。设原初曲率功率谱由振幅 $A_{s}$、在枢轴 $k_{p}$ 处定义的光谱倾斜 $n_{s}$ 以及谱指数的跑动 $\\alpha_{s}$ 参数化，使得功率谱为\n$$\nP_{\\zeta}(k) \\equiv A_{s} \\exp\\Big[(n_{s}-1)\\ln\\Big(\\frac{k}{k_{p}}\\Big) + \\frac{1}{2}\\alpha_{s}\\,\\ln^{2}\\Big(\\frac{k}{k_{p}}\\Big)\\Big].\n$$\n假设在这个简化模型中，$\\mu$-时代由丝绸阻尼耗散的分数能量密度，可以通过对由扩散抑制加权的原初谱进行 $\\ln k$ 积分来捕捉，\n$$\nQ_{\\mathrm{Silk}} \\propto \\int_{k_{\\min}}^{k_{\\max}} d\\ln k\\; P_{\\zeta}(k)\\,\\exp\\Big(-\\frac{2k^{2}}{k_{D}^{2}}\\Big),\n$$\n其中 $k_{\\min}$ 和 $k_{\\max}$ 定义了小尺度模式有显著贡献的共动波数域，并且为了本次数值练习的目的，比例常数被吸收到 $Q_{\\mathrm{Silk}}$ 的定义中。在这个玩具模型中，假定CMB谱畸变产生的化学势 $\\mu$ 与耗散的分数能量成正比，其转换系数为一个常数 $C_{\\mu}$，\n$$\n\\mu = C_{\\mu}\\,Q_{\\mathrm{Silk}},\n$$\n这近似了在光子数改变过程效率低下而康普顿散射仍然有效时，能量注入与化学势之间的晚期映射关系。\n\n严格从上述定义和紧耦合机制中的标准光子扩散图像出发，并一致地使用测度 $d\\ln k$，推导出一个用 $A_{s}$、$n_{s}$、$\\alpha_{s}$、$k_{p}$ 和 $k_{D}$ 表示的 $Q_{\\mathrm{Silk}}$ 的显式一维积分表达式，然后实现一个数值稳定的算法来计算 $Q_{\\mathrm{Silk}}$ 和相应的 $\\mu$。您的算法必须：\n\n- 以百万秒差距的倒数（$\\mathrm{Mpc}^{-1}$）为单位处理 $k$。\n- 使用无量纲振幅 $A_{s}$，无量纲指数 $n_{s}$ 和 $\\alpha_{s}$，以 $\\mathrm{Mpc}^{-1}$ 为单位的 $k_{p}$、$k_{D}$、$k_{\\min}$ 和 $k_{\\max}$，并生成无量纲浮点数 $Q_{\\mathrm{Silk}}$ 和 $\\mu$。\n- 使用测度 $d\\ln k$ 计算积分，这等同于在对 $k$ 积分时包含一个 $1/k$ 的因子以保持一致性。\n- 实现数值稳定的指数计算，尽可能避免上溢和下溢，并确保在宽参数范围内收敛。\n\n测试套件规范：\n\n对以下六个参数集评估数组 $(Q_{\\mathrm{Silk}},\\mu)$，这些参数集探讨了不同的小尺度倾斜、跑动和扩散尺度。除非另有说明，所有情况均使用 $C_{\\mu} = 1.4$，$k_{p} = 0.05\\,\\mathrm{Mpc}^{-1}$，$k_{\\min} = 1\\,\\mathrm{Mpc}^{-1}$ 和 $k_{\\max} = 10^{4}\\,\\mathrm{Mpc}^{-1}$。\n\n- 情况1（基准红倾斜，无跑动）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 0.965$，$\\alpha_{s} = 0$，$k_{D} = 1300\\,\\mathrm{Mpc}^{-1}$。\n- 情况2（蓝倾斜，无跑动）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 1.05$，$\\alpha_{s} = 0$，$k_{D} = 1300\\,\\mathrm{Mpc}^{-1}$。\n- 情况3（轻微负跑动）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 0.97$，$\\alpha_{s} = -0.01$，$k_{D} = 1300\\,\\mathrm{Mpc}^{-1}$。\n- 情况4（正跑动）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 0.97$，$\\alpha_{s} = 0.02$，$k_{D} = 1300\\,\\mathrm{Mpc}^{-1}$。\n- 情况5（更强阻尼窗口，更小扩散尺度）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 0.965$，$\\alpha_{s} = 0$，$k_{D} = 300\\,\\mathrm{Mpc}^{-1}$。\n- 情况6（更弱阻尼窗口，更大扩散尺度和蓝倾斜）：$A_{s} = 2.1\\times 10^{-9}$，$n_{s} = 1.05$，$\\alpha_{s} = 0$，$k_{D} = 3000\\,\\mathrm{Mpc}^{-1}$。\n\n要求的最终输出格式：\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。对于每种情况，输出 $Q_{\\mathrm{Silk}}$，紧接着是 $\\mu$，因此六种情况的十二个数字按顺序显示为 $[Q_{1},\\mu_{1},Q_{2},\\mu_{2},...,Q_{6},\\mu_{6}]$。所有量都必须是无量纲浮点数。角度单位不适用，任何地方都不得使用百分比；所有数值均以小数形式表示。",
            "solution": "目标是为几组参数集计算耗散的分数能量密度 $Q_{\\mathrm{Silk}}$ 和由此产生的CMB化学势 $\\mu$。$Q_{\\mathrm{Silk}}$ 的控制方程是一个关于共动波数 $k$ 的积分：\n$$\nQ_{\\mathrm{Silk}} = \\int_{k_{\\min}}^{k_{\\max}} P_{\\zeta}(k)\\,\\exp\\Big(-\\frac{2k^{2}}{k_{D}^{2}}\\Big)\\,d\\ln k\n$$\n问题描述中的记号 $Q_{\\mathrm{Silk}} \\propto \\dots$，结合将比例常数视为被吸收的指令，意味着在本次数值练习中，该方程应被视为等式。原初曲率功率谱 $P_{\\zeta}(k)$ 定义为：\n$$\nP_{\\zeta}(k) = A_{s} \\exp\\Big[(n_{s}-1)\\ln\\Big(\\frac{k}{k_{p}}\\Big) + \\frac{1}{2}\\alpha_{s}\\,\\ln^{2}\\Big(\\frac{k}{k_{p}}\\Big)\\Big]\n$$\n为了实现一个数值稳定的算法，我们首先处理积分测度 $d\\ln k$。变量替换是最有效的策略。设积分变量为 $u = \\ln k$。这一变换得到 $k = e^u$，最重要的是，$d\\ln k = du$。新变量下的积分限变为 $u_{\\min} = \\ln k_{\\min}$ 和 $u_{\\max} = \\ln k_{\\max}$。\n\n$Q_{\\mathrm{Silk}}$ 的积分变换为：\n$$\nQ_{\\mathrm{Silk}} = \\int_{\\ln k_{\\min}}^{\\ln k_{\\max}} P_{\\zeta}(e^u)\\,\\exp\\Big(-\\frac{2(e^u)^{2}}{k_{D}^{2}}\\Big)\\,du\n$$\n接下来，我们将积分的参数，即被积函数，完全用 $u$ 来表示。$P_{\\zeta}(k)$ 中的项变为：\n$$\n\\ln\\Big(\\frac{k}{k_{p}}\\Big) = \\ln\\Big(\\frac{e^u}{k_{p}}\\Big) = u - \\ln k_{p}\n$$\n将此代入 $P_{\\zeta}(k)$ 的表达式中，得到：\n$$\nP_{\\zeta}(e^u) = A_{s} \\exp\\Big[(n_{s}-1)(u - \\ln k_{p}) + \\frac{1}{2}\\alpha_{s}(u - \\ln k_{p})^{2}\\Big]\n$$\n完整的被积函数，我们称之为 $I(u)$，是 $P_{\\zeta}(e^u)$ 和指数阻尼项的乘积。为了获得更优的数值稳定性，将所有指数函数的参数合并到单个 `exp` 调用中是有利的。\n$$\nI(u) = P_{\\zeta}(e^u) \\exp\\Big(-\\frac{2e^{2u}}{k_{D}^{2}}\\Big) = A_{s} \\exp\\Big[(n_{s}-1)(u - \\ln k_{p}) + \\frac{1}{2}\\alpha_{s}(u - \\ln k_{p})^{2} - \\frac{2e^{2u}}{k_{D}^{2}}\\Big]\n$$\n这种形式避免了可能非常大或非常小的数字相乘，从而降低了浮点数上溢或下溢的风险。现在要计算的积分是一个在有限区间 $[\\ln k_{\\min}, \\ln k_{\\max}]$ 上的标准一维定积分：\n$$\nQ_{\\mathrm{Silk}} = \\int_{\\ln k_{\\min}}^{\\ln k_{\\max}} I(u)\\,du\n$$\n这个积分可以使用标准的数值求积算法（例如Python中`scipy.integrate`库的`quad`函数）进行稳健而准确的评估。\n\n最后，一旦对于给定的参数集 $\\{A_s, n_s, \\alpha_s, k_p, k_D, k_{\\min}, k_{\\max}\\}$ 确定了 $Q_{\\mathrm{Silk}}$ 的值，就可以通过所提供的简单线性关系计算出相应的化学势 $\\mu$：\n$$\n\\mu = C_{\\mu}\\,Q_{\\mathrm{Silk}}\n$$\n其中 $C_{\\mu}$ 是一个给定的常数。\n\n对于每个测试用例，算法按以下步骤进行：\n1.  如上所述，定义由 $A_s$、$n_s$、$\\alpha_s$、$k_p$ 和 $k_D$ 参数化的被积函数 $I(u)$。\n2.  设置积分限 $u_{\\min} = \\ln k_{\\min}$ 和 $u_{\\max} = \\ln k_{\\max}$。\n3.  对 $I(u)$ 在 $u_{\\min}$ 到 $u_{\\max}$ 的区间内进行数值积分，以求得 $Q_{\\mathrm{Silk}}$。\n4.  计算 $\\mu = C_{\\mu} \\times Q_{\\mathrm{Silk}}$。\n5.  存储结果对 $(Q_{\\mathrm{Silk}}, \\mu)$。\n对所有指定的参数集重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Calculates the Silk damping energy dissipation Q_Silk and the resulting\n    CMB chemical potential mu for a series of cosmological parameter sets.\n    \"\"\"\n    \n    # Common parameters for all test cases\n    C_mu = 1.4\n    k_p = 0.05  # Mpc^-1\n    k_min = 1.0  # Mpc^-1\n    k_max = 10000.0  # Mpc^-1\n\n    # Define the six test cases\n    test_cases = [\n        # (As, ns, alphas, kD)\n        (2.1e-9, 0.965, 0.0, 1300.0),      # Case 1\n        (2.1e-9, 1.05, 0.0, 1300.0),       # Case 2\n        (2.1e-9, 0.97, -0.01, 1300.0),     # Case 3\n        (2.1e-9, 0.97, 0.02, 1300.0),      # Case 4\n        (2.1e-9, 0.965, 0.0, 300.0),       # Case 5\n        (2.1e-9, 1.05, 0.0, 3000.0),       # Case 6\n    ]\n\n    results = []\n\n    def integrand(u, A_s, n_s, alpha_s, k_p_val, k_D_val):\n        \"\"\"\n        The integrand for Q_Silk after a change of variables u = ln(k).\n        \n        Args:\n            u: The integration variable, ln(k).\n            A_s: Amplitude of the primordial power spectrum.\n            n_s: Spectral tilt.\n            alpha_s: Running of the spectral index.\n            k_p_val: Pivot scale in Mpc^-1.\n            k_D_val: Diffusion scale in Mpc^-1.\n        \n        Returns:\n            The value of the integrand at u.\n        \"\"\"\n        log_kp = np.log(k_p_val)\n        log_k_over_kp = u - log_kp\n        \n        # Combine all terms inside a single exponential for numerical stability\n        exponent = (\n            (n_s - 1.0) * log_k_over_kp\n            + 0.5 * alpha_s * log_k_over_kp**2\n            - 2.0 * np.exp(2.0 * u) / k_D_val**2\n        )\n        \n        return A_s * np.exp(exponent)\n\n    # Set integration limits based on the change of variable u = ln(k)\n    u_min = np.log(k_min)\n    u_max = np.log(k_max)\n\n    for case in test_cases:\n        A_s, n_s, alpha_s, k_D = case\n        \n        # Perform the numerical integration\n        # Pass parameters to the integrand via the `args` tuple\n        q_silk, _ = quad(integrand, u_min, u_max, args=(A_s, n_s, alpha_s, k_p, k_D))\n        \n        # Calculate the chemical potential mu\n        mu = C_mu * q_silk\n        \n        results.append(q_silk)\n        results.append(mu)\n\n    # Format the final output string as specified\n    formatted_results = [f\"{val:.10e}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}