{
    "hands_on_practices": [
        {
            "introduction": "A robust wellbore stability analysis begins with an accurate description of the stress state around the borehole. This practice focuses on the fundamental geometric and mechanical skill of transforming the known far-field principal stresses into the local coordinate systems of a deviated well. Mastering this coordinate transformation  is the essential first step for correctly applying any analytical or numerical stability model, as the orientation of the wellbore relative to the in-situ stresses dictates the magnitude and distribution of stress concentrations that drive instability.",
            "id": "3571590",
            "problem": "A homogeneous, linear-elastic formation is subjected to a far-field stress state whose Cauchy stress tensor is diagonal in its principal-stress coordinate system $\\mathcal{P}=\\{\\mathbf{e}_{1},\\mathbf{e}_{2},\\mathbf{e}_{3}\\}$, with $\\mathbf{e}_{1}$ aligned with the maximum horizontal principal stress, $\\mathbf{e}_{2}$ aligned with the minimum horizontal principal stress, and $\\mathbf{e}_{3}$ aligned with the vertical principal stress. A deviated wellbore is drilled with inclination $\\theta$ from the vertical and azimuth $\\psi$ measured in the horizontal plane from $\\mathbf{e}_{1}$ toward $\\mathbf{e}_{2}$ following a right-handed convention. In the local borehole Cartesian frame $\\mathcal{B}=\\{\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3}\\}$, $\\mathbf{b}_{3}$ is chosen along the wellbore axis, $\\mathbf{b}_{1}$ is the high-side direction given by the projection of $\\mathbf{e}_{3}$ onto the plane orthogonal to $\\mathbf{b}_{3}$, and $\\mathbf{b}_{2}=\\mathbf{b}_{3}\\times \\mathbf{b}_{1}$ completes a right-handed basis. The borehole cylindrical frame $\\mathcal{C}=\\{\\mathbf{e}_{r},\\mathbf{e}_{\\theta},\\mathbf{e}_{z}\\}$ at a circumferential location specified by angle $\\alpha$ is defined by $\\mathbf{e}_{r}=\\cos\\alpha\\,\\mathbf{b}_{1}+\\sin\\alpha\\,\\mathbf{b}_{2}$, $\\mathbf{e}_{\\theta}=-\\sin\\alpha\\,\\mathbf{b}_{1}+\\cos\\alpha\\,\\mathbf{b}_{2}$, and $\\mathbf{e}_{z}=\\mathbf{b}_{3}$. All angles $\\theta$, $\\psi$, and $\\alpha$ are measured in radians.\n\nStarting from the definitions of orthonormal bases, direction cosines, and the tensor transformation law, derive the rotation matrices that map vector and second-order tensor components from $\\mathcal{P}$ to $\\mathcal{B}$ and from $\\mathcal{B}$ to $\\mathcal{C}$. Compose them to obtain a single rotation matrix $\\mathbf{Q}_{\\mathcal{C}\\leftarrow \\mathcal{P}}(\\alpha,\\theta,\\psi)$ such that for any vector $\\mathbf{v}$, the components satisfy $\\left[\\mathbf{v}\\right]_{\\mathcal{C}}=\\mathbf{Q}_{\\mathcal{C}\\leftarrow \\mathcal{P}}\\left[\\mathbf{v}\\right]_{\\mathcal{P}}$, and for any second-order tensor $\\boldsymbol{\\sigma}$, the components satisfy $\\left[\\boldsymbol{\\sigma}\\right]_{\\mathcal{C}}=\\mathbf{Q}_{\\mathcal{C}\\leftarrow \\mathcal{P}}\\left[\\boldsymbol{\\sigma}\\right]_{\\mathcal{P}}\\mathbf{Q}_{\\mathcal{C}\\leftarrow \\mathcal{P}}^{\\top}$.\n\nProvide the final answer as a single closed-form analytic expression for the $3\\times 3$ matrix $\\mathbf{Q}_{\\mathcal{C}\\leftarrow \\mathcal{P}}(\\alpha,\\theta,\\psi)$ in terms of $\\alpha$, $\\theta$, and $\\psi$. No numerical evaluation or rounding is required.",
            "solution": "...",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\cos\\alpha\\cos\\theta\\cos\\psi + \\sin\\alpha\\sin\\psi  -\\cos\\alpha\\cos\\theta\\sin\\psi - \\sin\\alpha\\cos\\psi  \\cos\\alpha\\sin\\theta \\\\\n\\sin\\alpha\\cos\\theta\\cos\\psi + \\cos\\alpha\\sin\\psi  \\sin\\alpha\\cos\\theta\\sin\\psi - \\cos\\alpha\\cos\\psi  -\\sin\\alpha\\sin\\theta \\\\\n\\sin\\theta\\cos\\psi  \\sin\\theta\\sin\\psi  \\cos\\theta\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While elastic models provide a useful first approximation, they can be non-conservative if the stress concentration at the wellbore wall exceeds the rock's strength. This exercise demonstrates the critical concept of stress redistribution that occurs when the rock yields plastically, a common scenario in weaker formations or high-stress environments. By comparing the purely elastic stress prediction with the state governed by the Mohr-Coulomb failure criterion , you will gain insight into how failure initiates and why elastic-plastic analysis is crucial for a realistic assessment of wellbore stability.",
            "id": "3571622",
            "problem": "A vertical, circular borehole of radius $a$ is drilled in a homogeneous, isotropic, linear elastic rock that behaves as elastic-perfectly plastic with a Mohr–Coulomb (MC) failure criterion and associated flow. Adopt small strains and axisymmetric plane strain conditions in the plane normal to the borehole axis, with compressive stresses taken as positive. The in-situ far-field total stresses in the horizontal plane are isotropic with magnitude $S_{0} = 60\\,\\mathrm{MPa}$. The formation pore pressure is $P_{p} = 10\\,\\mathrm{MPa}$, and the borehole is hydraulically connected to the formation under steady-state drained conditions so that the pore pressure at the wall equals the mud pressure $P_{w} = 10\\,\\mathrm{MPa}$. Take the Biot coefficient $\\alpha = 1$. The rock’s Mohr–Coulomb strength parameters are cohesion $c = 8\\,\\mathrm{MPa}$ and friction angle $\\varphi = 30^{\\circ}$. Young’s modulus is $E = 20\\,\\mathrm{GPa}$ and Poisson’s ratio is $\\nu = 0.25$. Assume the intermediate principal effective stress is the axial stress and remains between the radial and hoop effective stresses so that yielding is governed by the radial and hoop effective stresses as the minimum and maximum principal effective stresses, respectively.\n\nUsing first principles, begin from the equilibrium equation in cylindrical coordinates and the definitions of effective stress and the Mohr–Coulomb yield condition. Compute:\n- the updated borehole wall hoop effective stress after a plastic zone forms adjacent to the wall, using an elastic–plastic analytical solution, and\n- the purely elastic hoop effective stress at the borehole wall (Kirsch-type solution) for the same boundary conditions.\n\nThen form the ratio $R$ of the updated elastic–plastic wall hoop effective stress to the purely elastic wall hoop effective stress. Report $R$ as a decimal number with no units and no percent sign, rounded to four significant figures.",
            "solution": "The problem will be validated before a solution is attempted.\n\n### Step 1: Extract Givens\n-   Borehole geometry: Vertical, circular, radius $a$.\n-   Rock mass properties: Homogeneous, isotropic, linear elastic-perfectly plastic.\n-   Analysis conditions: Small strains, axisymmetric plane strain. Compressive stresses are positive.\n-   Failure criterion: Mohr–Coulomb (MC) with associated flow.\n-   Strength parameters: Cohesion $c = 8\\,\\mathrm{MPa}$, friction angle $\\varphi = 30^{\\circ}$.\n-   Elastic parameters: Young’s modulus $E = 20\\,\\mathrm{GPa}$, Poisson’s ratio $\\nu = 0.25$.\n-   Far-field stress: Isotropic total stress $S_{0} = 60\\,\\mathrm{MPa}$.\n-   Pore pressure: Far-field formation pressure $P_{p} = 10\\,\\mathrm{MPa}$. Borehole wall pressure (mud pressure) $P_{w} = 10\\,\\mathrm{MPa}$. Steady-state drained conditions with hydraulic connection.\n-   Effective stress parameter: Biot coefficient $\\alpha = 1$.\n-   Principal stress assumption: Intermediate principal effective stress $\\sigma'_z$ satisfies $\\sigma'_r \\le \\sigma'_z \\le \\sigma'_\\theta$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on established principles of continuum mechanics, elasticity, plasticity, and rock mechanics (Kirsch equations, effective stress principle, Mohr-Coulomb failure criterion). All concepts are standard in geomechanics.\n-   **Well-Posed**: The problem provides sufficient information to determine a unique solution. The givens are consistent and the boundary conditions are clearly defined. The elastic moduli ($E, \\nu$) are supplied but not strictly necessary for the stress calculations, which does not render the problem ill-posed.\n-   **Objective**: The problem is stated in precise, quantitative terms, free from ambiguity or subjective language.\n-   **Completeness and Consistency**: The data are self-contained and consistent. For instance, the condition $P_w = P_p = 10\\,\\mathrm{MPa}$ under steady-state drained conditions implies a uniform pore pressure field $P(r) = 10\\,\\mathrm{MPa}$, which simplifies the analysis. The assumption about the intermediate principal stress ensures the problem can be analyzed in two dimensions.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically sound, well-posed, and all necessary parameters for the requested calculations are provided. A complete solution will be provided.\n\n### Solution Derivation\nThe objective is to compute the ratio $R = \\sigma'_{\\theta\\theta, \\text{ep}} / \\sigma'_{\\theta\\theta, \\text{e}}$, where $\\sigma'_{\\theta\\theta, \\text{ep}}$ is the hoop effective stress at the borehole wall for an elastic-plastic material, and $\\sigma'_{\\theta\\theta, \\text{e}}$ is the hoop effective stress at the wall assuming a purely elastic response.\n\n**1. Calculation of Purely Elastic Hoop Effective Stress ($\\sigma'_{\\theta\\theta, \\text{e}}$)**\n\nFor a circular opening in an infinite, isotropic, elastic medium under an isotropic far-field total stress $S_0$ and an internal pressure $P_w$, the total stresses in a cylindrical coordinate system $(r, \\theta, z)$ are given by the Kirsch equations. Due to axisymmetry ($S_H = S_h = S_0$), the shear stress $\\tau_{r\\theta}$ is zero and the stresses are independent of $\\theta$. The radial ($\\sigma_r$) and hoop ($\\sigma_\\theta$) total stresses are:\n$$ \\sigma_r(r) = S_0 \\left(1 - \\frac{a^2}{r^2}\\right) + P_w \\frac{a^2}{r^2} $$\n$$ \\sigma_\\theta(r) = S_0 \\left(1 + \\frac{a^2}{r^2}\\right) - P_w \\frac{a^2}{r^2} $$\nWe are interested in the stress at the borehole wall, where $r=a$:\n$$ \\sigma_r(r=a) = S_0 (1-1) + P_w (1) = P_w $$\n$$ \\sigma_\\theta(r=a) = S_0 (1+1) - P_w (1) = 2S_0 - P_w $$\nSubstituting the given total stress values $S_0 = 60\\,\\mathrm{MPa}$ and $P_w = 10\\,\\mathrm{MPa}$:\n$$ \\sigma_r(r=a) = 10\\,\\mathrm{MPa} $$\n$$ \\sigma_\\theta(r=a) = 2(60\\,\\mathrm{MPa}) - 10\\,\\mathrm{MPa} = 120\\,\\mathrm{MPa} - 10\\,\\mathrm{MPa} = 110\\,\\mathrm{MPa} $$\nThe effective stress, $\\sigma'$, is related to the total stress, $\\sigma$, and pore pressure, $P$, by Terzaghi's principle, generalized by Biot: $\\sigma' = \\sigma - \\alpha P$. The problem states that due to steady-state drained conditions, the pore pressure at the wall is equal to the mud pressure, $P(r=a) = P_w = 10\\,\\mathrm{MPa}$. With $\\alpha=1$, the effective stresses at the wall are:\n$$ \\sigma'_{rr, \\text{e}}(r=a) = \\sigma_r(r=a) - \\alpha P(r=a) = 10\\,\\mathrm{MPa} - 1(10\\,\\mathrm{MPa}) = 0\\,\\mathrm{MPa} $$\n$$ \\sigma'_{\\theta\\theta, \\text{e}}(r=a) = \\sigma_\\theta(r=a) - \\alpha P(r=a) = 110\\,\\mathrm{MPa} - 1(10\\,\\mathrm{MPa}) = 100\\,\\mathrm{MPa} $$\nThus, the purely elastic hoop effective stress at the borehole wall is $\\sigma'_{\\theta\\theta, \\text{e}} = 100\\,\\mathrm{MPa}$.\n\n**2. Calculation of Elastic-Plastic Hoop Effective Stress ($\\sigma'_{\\theta\\theta, \\text{ep}}$)**\n\nFirst, we must verify that the elastic stress state causes the rock to yield. The Mohr-Coulomb failure criterion, in terms of maximum ($\\sigma'_1$) and minimum ($\\sigma'_3$) principal effective stresses, is:\n$$ \\sigma'_1 = \\sigma'_3 N_\\varphi + C_0 $$\nwhere $N_\\varphi = \\frac{1+\\sin\\varphi}{1-\\sin\\varphi}$ and $C_0 = \\frac{2c \\cos\\varphi}{1-\\sin\\varphi}$.\nFrom the problem givens: $c = 8\\,\\mathrm{MPa}$ and $\\varphi = 30^{\\circ}$, so $\\sin\\varphi = 0.5$ and $\\cos\\varphi = \\frac{\\sqrt{3}}{2}$.\n$$ N_\\varphi = \\frac{1+0.5}{1-0.5} = \\frac{1.5}{0.5} = 3 $$\n$$ C_0 = \\frac{2(8\\,\\mathrm{MPa}) \\cos(30^{\\circ})}{1-\\sin(30^{\\circ})} = \\frac{16 \\left(\\frac{\\sqrt{3}}{2}\\right)}{1-0.5} = \\frac{8\\sqrt{3}}{0.5}\\,\\mathrm{MPa} = 16\\sqrt{3}\\,\\mathrm{MPa} $$\nThe problem assumes $\\sigma'_\\theta$ is the maximum principal stress ($\\sigma'_1$) and $\\sigma'_r$ is the minimum ($\\sigma'_3$). From the elastic calculation, at the wall, $\\sigma'_1 = \\sigma'_{\\theta\\theta, \\text{e}} = 100\\,\\mathrm{MPa}$ and $\\sigma'_3 = \\sigma'_{rr, \\text{e}} = 0\\,\\mathrm{MPa}$.\nLet's check if the yield condition is met:\n$$ \\sigma'_3 N_\\varphi + C_0 = (0)(3) + 16\\sqrt{3}\\,\\mathrm{MPa} \\approx 27.71\\,\\mathrm{MPa} $$\nSince $\\sigma'_1 = 100\\,\\mathrm{MPa} > 16\\sqrt{3}\\,\\mathrm{MPa}$, the rock at the borehole wall has yielded, and a plastic zone has formed.\n\nWhen the material yields, its stress state must lie on the failure envelope. Therefore, the actual hoop effective stress at the wall, $\\sigma'_{\\theta\\theta, \\text{ep}}$, cannot be the elastically calculated $100\\,\\mathrm{MPa}$. Instead, it is the stress that satisfies the Mohr-Coulomb criterion given the known radial stress condition at the wall.\nThe radial effective stress at the wall is fixed by the mud pressure and pore pressure boundary condition:\n$$ \\sigma'_3 = \\sigma'_{rr}(r=a) = P_w - \\alpha P_w = 10\\,\\mathrm{MPa} - 1(10\\,\\mathrm{MPa}) = 0\\,\\mathrm{MPa} $$\nThe hoop effective stress at the wall, $\\sigma'_1 = \\sigma'_{\\theta\\theta, \\text{ep}}$, is then determined by the yield criterion:\n$$ \\sigma'_{\\theta\\theta, \\text{ep}} = \\sigma'_3 N_\\varphi + C_0 = (0)(3) + 16\\sqrt{3}\\,\\mathrm{MPa} $$\n$$ \\sigma'_{\\theta\\theta, \\text{ep}} = 16\\sqrt{3}\\,\\mathrm{MPa} $$\nThis is the updated hoop effective stress at the wall in the elastic-plastic solution.\n\n**3. Calculation of the Ratio $R$**\n\nThe ratio $R$ is defined as the updated elastic-plastic wall hoop effective stress to the purely elastic wall hoop effective stress.\n$$ R = \\frac{\\sigma'_{\\theta\\theta, \\text{ep}}}{\\sigma'_{\\theta\\theta, \\text{e}}} $$\nSubstituting the calculated values:\n$$ R = \\frac{16\\sqrt{3}\\,\\mathrm{MPa}}{100\\,\\mathrm{MPa}} = \\frac{16\\sqrt{3}}{100} $$\nNow, we compute the numerical value and round to four significant figures:\n$$ R = \\frac{16 \\times 1.7320508...}{100} = \\frac{27.7128129...}{100} = 0.277128129... $$\nRounding to four significant figures gives:\n$$ R \\approx 0.2771 $$",
            "answer": "$$\\boxed{0.2771}$$"
        },
        {
            "introduction": "Geomechanical limits on wellbore pressure are not just static constraints; they define a dynamic operational window that must be respected during all drilling activities. This practice integrates wellbore stability with fluid hydraulics to address a common operational challenge: determining a safe speed for moving the drillstring. By modeling the transient surge (downward motion) and swab (upward motion) pressures and ensuring they remain within the fracture and collapse limits , you will translate fundamental geomechanical principles into a tangible engineering guideline that is critical for preventing costly drilling-induced instabilities.",
            "id": "3571594",
            "problem": "You are tasked with developing a complete, runnable program that computes safe tripping speeds for a drillstring to avoid surge- or swab-induced wellbore instability. Your program must couple wellbore hydraulics with stability limits and enforce allowable transient pressure excursions. The computation must be based on first principles and well-tested formulas, without using any shortcut formulas.\n\nFundamental base and modeling assumptions:\n- Incompressible fluid and rigid-column approximation. By conservation of mass, the volumetric flow rate in the annulus equals the volumetric displacement rate of the pipe: if the pipe moves axially with speed $v_{\\text{pipe}}$ (positive when moving downwards), the annulus flow rate is $Q = s \\, v_{\\text{pipe}} \\, A_{\\text{pipe}}$, where $s = +1$ for downward motion (surge) and $s = -1$ for upward motion (swab), and $A_{\\text{pipe}} = \\pi R_{\\mathrm{i}}^{2}$ is the outer cross-sectional area of the drillstring with radius $R_{\\mathrm{i}}$.\n- Hydrostatic equilibrium: the baseline bottom pressure at true vertical depth $L$ is $p_{\\mathrm{h}} = \\rho g L$, where $\\rho$ is the drilling fluid density and $g$ is gravitational acceleration.\n- Unsteady one-dimensional momentum balance for the annular fluid column of length $L$, with upward direction positive and including hydrostatic, inertial, and viscous terms:\n  $$p_{\\mathrm{b}} - p_{\\mathrm{s}} = \\rho g L + \\rho L \\frac{d v_{\\mathrm{ann}}}{dt} + \\Delta p_{\\mathrm{fric}},$$\n  where $p_{\\mathrm{b}}$ is bottomhole pressure, $p_{\\mathrm{s}}$ is surface pressure (take $p_{\\mathrm{s}} = 0$ gauge), and $v_{\\mathrm{ann}} = Q / A_{\\mathrm{ann}}$ is the mean annular velocity with $A_{\\mathrm{ann}} = \\pi (R_{\\mathrm{o}}^{2} - R_{\\mathrm{i}}^{2})$ and $R_{\\mathrm{o}}$ the wellbore radius. Under a constant pipe acceleration magnitude $a_{\\text{pipe}}$ during ramp-up to a target steady speed, assume $d v_{\\mathrm{ann}}/dt = s \\, a_{\\text{pipe}} \\, A_{\\text{pipe}} / A_{\\mathrm{ann}}$.\n- Viscous pressure loss for steady laminar concentric-annulus flow (Newtonian fluid) from classical lubrication theory:\n  $$Q = -\\frac{\\pi}{8 \\mu} \\left(\\frac{dp}{dz}\\right) S,$$\n  where $\\mu$ is dynamic viscosity and\n  $$S = R_{\\mathrm{o}}^{4} - R_{\\mathrm{i}}^{4} - \\frac{\\left(R_{\\mathrm{o}}^{2} - R_{\\mathrm{i}}^{2}\\right)^{2}}{\\ln\\!\\left(R_{\\mathrm{o}}/R_{\\mathrm{i}}\\right)}.$$\n  Over length $L$, the viscous contribution to the bottomhole-surface drop is\n  $$\\Delta p_{\\mathrm{fric}} = \\frac{8 \\mu L}{\\pi S} Q.$$\n- The transient pressure excursion relative to hydrostatic is\n  $$p_{\\mathrm{extra}} = \\rho L \\frac{d v_{\\mathrm{ann}}}{dt} + \\frac{8 \\mu L}{\\pi S} Q.$$\n  During a constant-acceleration ramp to the target speed, the worst case magnitude occurs at the end of the ramp (just before acceleration ceases), which can be conservatively approximated by evaluating $p_{\\mathrm{extra}}$ with $Q = s \\, v_{\\text{pipe}} \\, A_{\\text{pipe}}$ and $\\frac{d v_{\\mathrm{ann}}}{dt} = s \\, a_{\\text{pipe}} \\, A_{\\text{pipe}}/A_{\\mathrm{ann}}$ and summing both contributions.\n\nStability limits and allowable transient excursions:\n- Let the upper stability limit (fracture initiation) at depth be $P_{\\mathrm{frac}}$ and the lower stability limit (collapse threshold or minimum support pressure) be $P_{\\mathrm{low}}$. Allowable transient excursions are represented by nonnegative margins $M_{\\mathrm{surge}}$ and $M_{\\mathrm{swab}}$, requiring\n  $p_{\\mathrm{b}} \\le P_{\\mathrm{frac}} - M_{\\mathrm{surge}}$, $\\quad$ $p_{\\mathrm{b}} \\ge P_{\\mathrm{low}} + M_{\\mathrm{swab}}$.\n- With $p_{\\mathrm{b}} = p_{\\mathrm{h}} + p_{\\mathrm{extra}}$ and $p_{\\mathrm{h}} = \\rho g L$, the safe-speed inequalities become:\n  - Downward motion (surge, $s=+1$): ensure $p_{\\mathrm{h}} + p_{\\mathrm{extra}} \\le P_{\\mathrm{frac}} - M_{\\mathrm{surge}}$.\n  - Upward motion (swab, $s=-1$): ensure $p_{\\mathrm{h}} + p_{\\mathrm{extra}} \\ge P_{\\mathrm{low}} + M_{\\mathrm{swab}}$.\n- For the constant-acceleration-to-constant-speed maneuver, enforce these using the conservative worst-case $p_{\\mathrm{extra}}$ at target speed and ramp acceleration. If the inequality cannot be satisfied for any positive speed, the safe speed is zero.\n\nYour task:\n- Implement a program that, for each test case, computes the safe downward tripping speed $v_{\\downarrow}$ and safe upward tripping speed $v_{\\uparrow}$ (in $\\mathrm{m/s}$), each rounded to four decimals, under the modeling framework above. Use the following steps for each case:\n  1. Compute $A_{\\text{pipe}} = \\pi R_{\\mathrm{i}}^{2}$, $A_{\\text{ann}} = \\pi (R_{\\mathrm{o}}^{2} - R_{\\mathrm{i}}^{2})$, and $S$ as defined above. If $R_{\\mathrm{o}} \\le R_{\\mathrm{i}}$ or $S \\le 0$, set both speeds to zero for that case.\n  2. Compute the hydrostatic pressure $p_{\\mathrm{h}} = \\rho g L$.\n  3. Define the annular acceleration scale $a_{\\mathrm{ann}} = a_{\\text{pipe}} \\, A_{\\text{pipe}}/A_{\\mathrm{ann}}$ and the inertial pressure increment $\\Delta p_{\\mathrm{inert}} = \\rho L a_{\\mathrm{ann}}$ (magnitude).\n  4. Define the laminar friction coefficient $c = \\frac{8 \\mu L A_{\\text{pipe}}}{\\pi S}$ so that the viscous part at speed $v$ is $c v$ in magnitude.\n  5. Define the surge headroom $H_{\\mathrm{surge}} = (P_{\\mathrm{frac}} - M_{\\mathrm{surge}}) - p_{\\mathrm{h}}$ and the swab headroom $H_{\\mathrm{swab}} = p_{\\mathrm{h}} - (P_{\\mathrm{low}} + M_{\\mathrm{swab}})$.\n  6. The conservative safe speeds are\n     $$v_{\\downarrow} = \\max\\!\\left(0, \\frac{H_{\\mathrm{surge}} - \\Delta p_{\\mathrm{inert}}}{c}\\right), \\quad v_{\\uparrow} = \\max\\!\\left(0, \\frac{H_{\\mathrm{swab}} - \\Delta p_{\\mathrm{inert}}}{c}\\right).$$\n     If either headroom is negative, the corresponding safe speed is zero.\n\nPhysical and numerical units:\n- All inputs are in SI units: length in $\\mathrm{m}$, pressure in $\\mathrm{Pa}$, density in $\\mathrm{kg/m^{3}}$, dynamic viscosity in $\\mathrm{Pa \\cdot s}$, acceleration in $\\mathrm{m/s^{2}}$, gravitational acceleration in $\\mathrm{m/s^{2}}$.\n- Output speeds must be expressed in $\\mathrm{m/s}$, rounded to four decimals.\n\nAngle units do not apply.\n\nTest suite:\n- Use the following five parameter sets. For each, compute $[v_{\\downarrow}, v_{\\uparrow}]$ in $\\mathrm{m/s}$.\n  1. Case A (happy path, moderate window):\n     - $L = 3000$, $R_{\\mathrm{o}} = 0.09$, $R_{\\mathrm{i}} = 0.06$, $\\rho = 1200$, $\\mu = 0.04$, $g = 9.81$, $P_{\\mathrm{frac}} = 36.9 \\times 10^{6}$, $P_{\\mathrm{low}} = 34.5 \\times 10^{6}$, $M_{\\mathrm{surge}} = 0.05 \\times 10^{6}$, $M_{\\mathrm{swab}} = 0.05 \\times 10^{6}$, $a_{\\text{pipe}} = 0.2$.\n  2. Case B (inertial limit triggers zero downward speed):\n     - $L = 3000$, $R_{\\mathrm{o}} = 0.09$, $R_{\\mathrm{i}} = 0.06$, $\\rho = 1200$, $\\mu = 0.04$, $g = 9.81$, $P_{\\mathrm{frac}} = 35.75 \\times 10^{6}$, $P_{\\mathrm{low}} = 34.0 \\times 10^{6}$, $M_{\\mathrm{surge}} = 0.10 \\times 10^{6}$, $M_{\\mathrm{swab}} = 0.05 \\times 10^{6}$, $a_{\\text{pipe}} = 0.4$.\n  3. Case C (wide annulus, low viscosity, inertia noticeable):\n     - $L = 2500$, $R_{\\mathrm{o}} = 0.12$, $R_{\\mathrm{i}} = 0.04$, $\\rho = 1100$, $\\mu = 0.01$, $g = 9.81$, $P_{\\mathrm{frac}} = 27.4 \\times 10^{6}$, $P_{\\mathrm{low}} = 26.0 \\times 10^{6}$, $M_{\\mathrm{surge}} = 0.05 \\times 10^{6}$, $M_{\\mathrm{swab}} = 0.05 \\times 10^{6}$, $a_{\\text{pipe}} = 0.3$.\n  4. Case D (deep, viscous, very thin annulus):\n     - $L = 5000$, $R_{\\mathrm{o}} = 0.095$, $R_{\\mathrm{i}} = 0.07$, $\\rho = 1300$, $\\mu = 0.06$, $g = 9.81$, $P_{\\mathrm{frac}} = 64.4 \\times 10^{6}$, $P_{\\mathrm{low}} = 63.0 \\times 10^{6}$, $M_{\\mathrm{surge}} = 0.10 \\times 10^{6}$, $M_{\\mathrm{swab}} = 0.05 \\times 10^{6}$, $a_{\\text{pipe}} = 0.15$.\n  5. Case E (invalid geometry boundary: $R_{\\mathrm{o}} \\le R_{\\mathrm{i}}$):\n     - $L = 3000$, $R_{\\mathrm{o}} = 0.05$, $R_{\\mathrm{i}} = 0.06$, $\\rho = 1200$, $\\mu = 0.04$, $g = 9.81$, $P_{\\mathrm{frac}} = 36.0 \\times 10^{6}$, $P_{\\mathrm{low}} = 34.0 \\times 10^{6}$, $M_{\\mathrm{surge}} = 0.05 \\times 10^{6}$, $M_{\\mathrm{swab}} = 0.05 \\times 10^{6}$, $a_{\\text{pipe}} = 0.2$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is the pair $[v_{\\downarrow}, v_{\\uparrow}]$ for a test case, with both speeds in $\\mathrm{m/s}$ rounded to four decimals. For example, a valid output format is\n  $$[[0.1234,0.5678],[0.0000,0.4321],\\dots].$$",
            "solution": "The objective is to compute the maximum safe tripping speeds, both downward ($v_{\\downarrow}$, surge) and upward ($v_{\\uparrow}$, swab), for a drillstring in a wellbore. The analysis couples simplified wellbore hydraulics with geomechanical stability limits. The solution is derived from first principles as laid out in the problem statement.\n\nThe fundamental principle is the one-dimensional momentum balance for the annular fluid, which relates the bottomhole pressure $p_{\\mathrm{b}}$ to hydrostatic, inertial, and frictional components. The bottomhole pressure is given by:\n$$p_{\\mathrm{b}} = p_{\\mathrm{h}} + p_{\\mathrm{extra}}$$\nwhere $p_{\\mathrm{h}} = \\rho g L$ is the hydrostatic pressure of the fluid column of density $\\rho$ and length $L$, under gravitational acceleration $g$. The term $p_{\\mathrm{extra}}$ represents the transient pressure excursion due to pipe motion.\n\nThe transient pressure excursion $p_{\\mathrm{extra}}$ is modeled as the sum of an inertial component due to fluid acceleration and a viscous frictional component due to fluid flow:\n$$p_{\\mathrm{extra}} = \\rho L \\frac{d v_{\\mathrm{ann}}}{dt} + \\Delta p_{\\mathrm{fric}}$$\nHere, $\\frac{d v_{\\mathrm{ann}}}{dt}$ is the mean acceleration of the fluid in the annulus, and $\\Delta p_{\\mathrm{fric}}$ is the pressure loss due to viscous friction.\n\nFrom the principle of mass conservation for an incompressible fluid and a rigid drillstring, the annular flow rate $Q$ is related to the pipe velocity $v_{\\text{pipe}}$ by $Q = s \\, v_{\\text{pipe}} \\, A_{\\text{pipe}}$. The signum $s$ is $+1$ for downward motion (surge) and $-1$ for upward motion (swab). $A_{\\text{pipe}} = \\pi R_{\\mathrm{i}}^2$ is the cross-sectional area of the pipe with outer radius $R_{\\mathrm{i}}$. The mean annular velocity is $v_{\\mathrm{ann}} = Q / A_{\\mathrm{ann}}$, where $A_{\\mathrm{ann}} = \\pi(R_{\\mathrm{o}}^2 - R_{\\mathrm{i}}^2)$ is the cross-sectional area of the annulus, with $R_{\\mathrm{o}}$ being the wellbore radius.\nFor a constant pipe acceleration $a_{\\text{pipe}}$, the fluid acceleration is $\\frac{d v_{\\mathrm{ann}}}{dt} = s \\, a_{\\text{pipe}} \\, A_{\\text{pipe}} / A_{\\mathrm{ann}}$.\n\nThe inertial pressure component's magnitude is defined as $\\Delta p_{\\mathrm{inert}} = |\\rho L \\frac{d v_{\\mathrm{ann}}}{dt}|$. We define a constant annular acceleration scale $a_{\\mathrm{ann}} = a_{\\text{pipe}} \\frac{A_{\\text{pipe}}}{A_{\\mathrm{ann}}}$. Thus, the inertial pressure term is:\n$$\\Delta p_{\\mathrm{inert}} = \\rho L a_{\\mathrm{ann}}$$\nThe sign of this contribution to $p_{\\mathrm{extra}}$ depends on the direction of motion, being $+ \\Delta p_{\\mathrm{inert}}$ for surge ($s=+1$) and $- \\Delta p_{\\mathrm{inert}}$ for swab ($s=-1$).\n\nThe frictional pressure drop for steady laminar flow in a concentric annulus is given by $\\Delta p_{\\mathrm{fric}} = \\frac{8 \\mu L}{\\pi S} Q$, where $\\mu$ is the fluid's dynamic viscosity and $S$ is a geometric factor:\n$$S = R_{\\mathrm{o}}^{4} - R_{\\mathrm{i}}^{4} - \\frac{\\left(R_{\\mathrm{o}}^{2} - R_{\\mathrm{i}}^{2}\\right)^{2}}{\\ln\\!\\left(R_{\\mathrm{o}}/R_{\\mathrm{i}}\\right)}$$\nThis allows us to write the frictional pressure as a linear function of the pipe speed $v_{\\text{pipe}}$: $\\Delta p_{\\mathrm{fric}} = s \\, c \\, v_{\\text{pipe}}$, where the coefficient $c$ is defined as:\n$$c = \\frac{8 \\mu L A_{\\text{pipe}}}{\\pi S}$$\nThis coefficient is positive for any physically valid geometry ($R_{\\mathrm{o}} > R_{\\mathrm{i}}$) and fluid ($\\mu > 0$).\n\nCombining these terms, the total pressure excursion at a steady speed $v_{\\text{pipe}}$ following a ramp-up with acceleration $a_{\\text{pipe}}$ is conservatively estimated as:\n$$p_{\\mathrm{extra}} = s \\, (\\Delta p_{\\mathrm{inert}} + c \\, v_{\\text{pipe}})$$\nwhere $v_{\\text{pipe}}$ is the magnitude of the velocity ($v_{\\downarrow}$ or $v_{\\uparrow}$).\n\nThe wellbore stability is maintained if the bottomhole pressure $p_{\\mathrm{b}}$ remains within the prescribed limits: $P_{\\mathrm{low}} + M_{\\mathrm{swab}} \\le p_{\\mathrm{b}} \\le P_{\\mathrm{frac}} - M_{\\mathrm{surge}}$. $P_{\\mathrm{frac}}$ and $P_{\\mathrm{low}}$ are the fracture and collapse pressures, and $M_{\\mathrm{surge}}$ and $M_{\\mathrm{swab}}$ are safety margins.\n\nFor downward motion (surge, $s=+1$, $v_{\\text{pipe}} = v_{\\downarrow}$), the constraint is:\n$$p_{\\mathrm{h}} + (\\Delta p_{\\mathrm{inert}} + c \\, v_{\\downarrow}) \\le P_{\\mathrm{frac}} - M_{\\mathrm{surge}}$$\nRearranging to solve for the maximum safe speed $v_{\\downarrow}$:\n$$c \\, v_{\\downarrow} \\le (P_{\\mathrm{frac}} - M_{\\mathrm{surge}} - p_{\\mathrm{h}}) - \\Delta p_{\\mathrm{inert}}$$\nLet the available pressure margin for surge be the \"surge headroom,\" $H_{\\mathrm{surge}} = (P_{\\mathrm{frac}} - M_{\\mathrm{surge}}) - p_{\\mathrm{h}}$. The inequality becomes:\n$$v_{\\downarrow} \\le \\frac{H_{\\mathrm{surge}} - \\Delta p_{\\mathrm{inert}}}{c}$$\nSince speed must be non-negative, and a negative or zero headroom/numerator implies no positive speed is safe, the safe downward speed is:\n$$v_{\\downarrow} = \\max\\!\\left(0, \\frac{H_{\\mathrm{surge}} - \\Delta p_{\\mathrm{inert}}}{c}\\right)$$\n\nFor upward motion (swab, $s=-1$, $v_{\\text{pipe}} = v_{\\uparrow}$), the constraint is:\n$$p_{\\mathrm{h}} - (\\Delta p_{\\mathrm{inert}} + c \\, v_{\\uparrow}) \\ge P_{\\mathrm{low}} + M_{\\mathrm{swab}}$$\nRearranging to solve for the maximum safe speed $v_{\\uparrow}$:\n$$c \\, v_{\\uparrow} \\le p_{\\mathrm{h}} - (P_{\\mathrm{low}} + M_{\\mathrm{swab}}) - \\Delta p_{\\mathrm{inert}}$$\nLet the available pressure margin for swab be the \"swab headroom,\" $H_{\\mathrm{swab}} = p_{\\mathrm{h}} - (P_{\\mathrm{low}} + M_{\\mathrm{swab}})$. The inequality becomes:\n$$v_{\\uparrow} \\le \\frac{H_{\\mathrm{swab}} - \\Delta p_{\\mathrm{inert}}}{c}$$\nSimilarly, the safe upward speed is:\n$$v_{\\uparrow} = \\max\\!\\left(0, \\frac{H_{\\mathrm{swab}} - \\Delta p_{\\mathrm{inert}}}{c}\\right)$$\n\nThe algorithm is as follows for each test case:\n1.  Calculate geometric parameters $A_{\\text{pipe}}$, $A_{\\text{ann}}$, and $S$. If the geometry is invalid ($R_o \\le R_i$) or the derived geometric factor is non-positive ($S \\le 0$), both speeds are set to $0$.\n2.  Compute the hydrostatic pressure $p_{\\mathrm{h}}$.\n3.  Compute the inertial pressure magnitude $\\Delta p_{\\mathrm{inert}}$ and the frictional coefficient $c$.\n4.  Calculate the surge and swab headrooms, $H_{\\mathrm{surge}}$ and $H_{\\mathrm{swab}}$.\n5.  Apply the final formulas to compute $v_{\\downarrow}$ and $v_{\\uparrow}$.\n\nThis procedure is implemented for each provided parameter set.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes safe tripping speeds for a drillstring to avoid surge/swab instability.\n    \"\"\"\n\n    test_cases = [\n        # Case A (happy path, moderate window)\n        {'L': 3000, 'R_o': 0.09, 'R_i': 0.06, 'rho': 1200, 'mu': 0.04, 'g': 9.81, \n         'P_frac': 36.9e6, 'P_low': 34.5e6, 'M_surge': 0.05e6, 'M_swab': 0.05e6, 'a_pipe': 0.2},\n        # Case B (inertial limit triggers zero downward speed)\n        {'L': 3000, 'R_o': 0.09, 'R_i': 0.06, 'rho': 1200, 'mu': 0.04, 'g': 9.81, \n         'P_frac': 35.75e6, 'P_low': 34.0e6, 'M_surge': 0.10e6, 'M_swab': 0.05e6, 'a_pipe': 0.4},\n        # Case C (wide annulus, low viscosity, inertia noticeable)\n        {'L': 2500, 'R_o': 0.12, 'R_i': 0.04, 'rho': 1100, 'mu': 0.01, 'g': 9.81, \n         'P_frac': 27.4e6, 'P_low': 26.0e6, 'M_surge': 0.05e6, 'M_swab': 0.05e6, 'a_pipe': 0.3},\n        # Case D (deep, viscous, very thin annulus)\n        {'L': 5000, 'R_o': 0.095, 'R_i': 0.07, 'rho': 1300, 'mu': 0.06, 'g': 9.81, \n         'P_frac': 64.4e6, 'P_low': 63.0e6, 'M_surge': 0.10e6, 'M_swab': 0.05e6, 'a_pipe': 0.15},\n        # Case E (invalid geometry boundary: Ro = Ri)\n        {'L': 3000, 'R_o': 0.05, 'R_i': 0.06, 'rho': 1200, 'mu': 0.04, 'g': 9.81, \n         'P_frac': 36.0e6, 'P_low': 34.0e6, 'M_surge': 0.05e6, 'M_swab': 0.05e6, 'a_pipe': 0.2},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters\n        L, R_o, R_i, rho, mu, g = case['L'], case['R_o'], case['R_i'], case['rho'], case['mu'], case['g']\n        P_frac, P_low = case['P_frac'], case['P_low']\n        M_surge, M_swab = case['M_surge'], case['M_swab']\n        a_pipe = case['a_pipe']\n\n        # Step 1: Compute geometric properties and validate\n        if R_o = R_i:\n            results.append([0.0, 0.0])\n            continue\n            \n        A_pipe = np.pi * R_i**2\n        A_ann = np.pi * (R_o**2 - R_i**2)\n        \n        try:\n            # S is the geometric factor for friction\n            S_geom = R_o**4 - R_i**4 - (R_o**2 - R_i**2)**2 / np.log(R_o / R_i)\n        except (ValueError, ZeroDivisionError):\n            # This handles the case R_o = R_i, which is already checked\n            S_geom = 0.0\n\n        if S_geom = 0:\n            results.append([0.0, 0.0])\n            continue\n\n        # Step 2: Compute hydrostatic pressure\n        p_h = rho * g * L\n\n        # Step 3: Compute inertial pressure increment\n        a_ann = a_pipe * A_pipe / A_ann\n        delta_p_inert = rho * L * a_ann\n\n        # Step 4: Compute laminar friction coefficient\n        c_fric = (8 * mu * L * A_pipe) / (np.pi * S_geom)\n\n        if c_fric = 0: # This should not happen with valid inputs but is a robust check\n           results.append([0.0, 0.0])\n           continue\n\n        # Step 5: Define surge and swab headrooms\n        H_surge = (P_frac - M_surge) - p_h\n        H_swab = p_h - (P_low + M_swab)\n\n        # Step 6: Compute conservative safe speeds\n        v_down_num = H_surge - delta_p_inert\n        v_down = max(0, v_down_num / c_fric)\n\n        v_up_num = H_swab - delta_p_inert\n        v_up = max(0, v_up_num / c_fric)\n\n        results.append([v_down, v_up])\n\n    # Format the final output string as specified\n    formatted_results = [f\"[{res[0]:.4f},{res[1]:.4f}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}