{
    "hands_on_practices": [
        {
            "introduction": "共振频率 $f_1$ 是控制土层场地放大行为最关键的参数。本练习将指导你为简单的理想化土层推导此基本属性。通过计算共振频率对土体剪切波速 $V_s$ 和土层厚度 $h$ 变化的敏感度，你将深入了解场地勘察中的不确定性如何传播到预测响应中，这是岩土工程风险评估中的一个关键概念。",
            "id": "3559083",
            "problem": "考虑在一维、均质、线性弹性土层中垂直传播的水平偏振剪切（SH）波，该土层厚度为 $h$，覆盖在刚性基岩上。设土壤的质量密度为 $\\rho$，剪切模量为 $\\mu$，因此剪切波速为 $V_s = \\sqrt{\\mu/\\rho}$。假设小应变和角频率为 $\\omega$ 的时谐运动，因此位移场可以写为 $u(z,t) = \\Re\\{U(z)\\exp(i \\omega t)\\}$，其中 $z$ 是竖向坐标，从位于 $z=h$ 的刚性基底向上测量至位于 $z=0$ 的自由地表。\n\n使用SH运动的线性动量平衡和线性弹性理论，随深度变化的位移幅值 $U(z)$ 满足一个标量边值问题，其边界条件为地表的无牵引力条件和刚性基底的运动学条件。定义基本共振频率 $f_1$（单位为赫兹）为满足这些边界条件的非平凡驻波解存在的最低非零频率。\n\n从控制方程和边界条件出发，推导 $f_1$ 关于 $V_s$ 和 $h$ 的显式闭式表达式，然后计算 $f_1$ 相对于 $V_s$ 和 $h$ 的一阶灵敏度，即偏导数 $\\partial f_1/\\partial V_s$ 和 $\\partial f_1/\\partial h$。将最终结果表示为仅含 $V_s$ 和 $h$ 的梯度行向量 $[\\partial f_1/\\partial V_s,\\ \\partial f_1/\\partial h]$。无需进行数值计算，也无需四舍五入。最终的方框答案中不要包含单位。",
            "solution": "该问题要求推导覆盖在刚性基岩上的均质土层的基本共振频率，及其相对于土层剪切波速和厚度的灵敏度。\n\n一维、垂直传播、水平偏振剪切（SH）波的控制方程是波动方程。对于质量密度为 $\\rho$、剪切模量为 $\\mu$ 的均质、线性弹性土壤，该方程为：\n$$ \\rho \\frac{\\partial^2 u}{\\partial t^2} = \\mu \\frac{\\partial^2 u}{\\partial z^2} $$\n其中 $u(z,t)$ 是水平位移，$z$ 是竖向坐标。剪切波速由 $V_s = \\sqrt{\\mu/\\rho}$ 给出。波动方程可以改写为：\n$$ \\frac{\\partial^2 u}{\\partial t^2} = V_s^2 \\frac{\\partial^2 u}{\\partial z^2} $$\n我们考虑角频率为 $\\omega$ 的时谐运动，位移形式为 $u(z,t) = \\Re\\{U(z)\\exp(i \\omega t)\\}$，其中 $U(z)$ 是随深度变化的复数值位移幅值。将此形式代入波动方程，得到关于 $U(z)$ 的常微分方程：\n$$ -\\omega^2 U(z) = V_s^2 \\frac{d^2 U}{dz^2} $$\n整理后得到标准的亥姆霍兹方程：\n$$ \\frac{d^2 U}{dz^2} + \\left(\\frac{\\omega}{V_s}\\right)^2 U(z) = 0 $$\n我们定义波数 $k = \\omega/V_s$。控制方程变为：\n$$ \\frac{d^2 U}{dz^2} + k^2 U(z) = 0 $$\n这个二阶线性齐次微分方程的通解是：\n$$ U(z) = A \\sin(kz) + B \\cos(kz) $$\n其中 $A$ 和 $B$ 是由边界条件确定的常数。\n\n对于厚度为 $h$ 的土层，给出了边界条件。坐标系定义为自由地表在 $z=0$ 处，刚性基底在 $z=h$ 处。\n1. 在地表（$z=0$）处，存在无牵引力条件。剪应力 $\\tau = \\mu \\frac{\\partial u}{\\partial z}$ 必须为零。用幅值 $U(z)$ 表示，这意味着 $\\mu \\frac{dU}{dz}\\Big|_{z=0} = 0$。由于 $\\mu \\neq 0$，条件是：\n$$ \\frac{dU}{dz}(0) = 0 $$\n2. 在基底（$z=h$）处，土层与刚性基岩接触，这施加了一个零位移的运动学条件。因此，对于所有时间 $t$，$u(h,t)=0$，这意味着幅值必须为零：\n$$ U(h) = 0 $$\n\n现在，我们将这些边界条件应用于通解。首先，我们求 $U(z)$ 的导数：\n$$ \\frac{dU}{dz} = Ak \\cos(kz) - Bk \\sin(kz) $$\n在 $z=0$ 处应用第一个边界条件：\n$$ \\frac{dU}{dz}(0) = Ak \\cos(0) - Bk \\sin(0) = Ak = 0 $$\n对于非平凡的波动，波数 $k$ 不能为零（因为 $\\omega \\neq 0$），所以我们必须有 $A=0$。解简化为：\n$$ U(z) = B \\cos(kz) $$\n接下来，我们在 $z=h$ 处应用第二个边界条件：\n$$ U(h) = B \\cos(kh) = 0 $$\n对于非平凡的驻波解，幅值 $B$ 不能为零。因此，共振的条件是：\n$$ \\cos(kh) = 0 $$\n当参数 $kh$ 是 $\\pi/2$ 的奇数倍时，此方程成立：\n$$ k_n h = (2n-1)\\frac{\\pi}{2}, \\quad \\text{for } n = 1, 2, 3, \\dots $$\n基本共振频率对应于最低的非零频率，通过设置 $n=1$ 得到：\n$$ k_1 h = \\frac{\\pi}{2} $$\n代入波数的定义 $k_1 = \\omega_1/V_s = 2\\pi f_1/V_s$，其中 $\\omega_1$ 是基本角频率，$f_1$ 是基本频率（单位赫兹）。\n$$ \\left(\\frac{2\\pi f_1}{V_s}\\right) h = \\frac{\\pi}{2} $$\n求解 $f_1$，我们得到基本共振频率的表达式：\n$$ f_1 = \\frac{V_s}{4h} $$\n问题接着要求计算 $f_1$ 相对于 $V_s$ 和 $h$ 的一阶灵敏度。这些是 $f_1(V_s, h)$ 的偏导数。\n\n首先，关于 $V_s$ 的偏导数：\n$$ \\frac{\\partial f_1}{\\partial V_s} = \\frac{\\partial}{\\partial V_s}\\left(\\frac{V_s}{4h}\\right) = \\frac{1}{4h} $$\n其次，关于 $h$ 的偏导数：\n$$ \\frac{\\partial f_1}{\\partial h} = \\frac{\\partial}{\\partial h}\\left(\\frac{V_s}{4h}\\right) = \\frac{V_s}{4} \\frac{\\partial}{\\partial h}\\left(h^{-1}\\right) = \\frac{V_s}{4}(-1 \\cdot h^{-2}) = -\\frac{V_s}{4h^2} $$\n因此，梯度行向量 $[\\partial f_1/\\partial V_s, \\ \\partial f_1/\\partial h]$ 是：\n$$ \\left[ \\frac{1}{4h}, \\ -\\frac{V_s}{4h^2} \\right] $$\n此结果按要求仅表示为 $V_s$ 和 $h$ 的函数。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{4h} & -\\frac{V_s}{4h^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "虽然前一个练习侧重于根据已知属性计算响应，但在实践中我们经常面临逆问题：从地表测量中推断地下属性。本练习介绍了一种强大的信号处理技术——倒谱分析，用于“解卷积”场地的传递函数 $H(\\omega)$ 并识别回波时间。这个动手编程实践展示了如何从地震响应数据中估算土层厚度 $h$，从而在理论模型和实际场地勘察之间架起一座桥梁。",
            "id": "3559019",
            "problem": "您将获得一个简化的、但具有物理意义的一维线性时不变模型，该模型描述了垂直剪切波在厚度为 $h$ 的单一均质土层（下伏刚性基岩）中的传播过程。对于垂直入射的剪切波，从基岩入射运动到地表运动的复传递函数 $H(\\omega)$ 会因土层与基岩界面的阻抗差异而表现出回波。一个简洁且广泛使用的、描述其幅值行为的回波模型是双路径叠加模型 $H(\\omega) = 1 + r\\,e^{-j \\omega \\tau}$，其中 $r \\in [0,1)$ 是一个实值反射系数，表示一次反射路径的净振幅，$j$ 是虚数单位，$\\tau$ 是波在土层中的双程走时。双程走时为 $\\tau = 2 h / V_s$，其中 $V_s$ 是土层的剪切波速。系统的实倒谱 $c(\\tau)$ 定义为幅值谱自然对数的反傅里叶变换（相对于 $\\omega$），即 $c(\\tau) = \\mathcal{F}^{-1}\\{\\ln |H(\\omega)|\\}(\\tau)$。$c(\\tau)$ 中的峰值出现在等于回波延迟及其倍数的倒频率（quefrency）值处，这可用于通过峰值位置 $\\tau^\\star$ 推断 $h$，公式为 $h = V_s \\tau^\\star / 2$。\n\n从以下基本原理出发：\n- 波的线性叠加，这意味着延迟路径之和的频率响应是其复指数之和。\n- 对于厚度为 $h$、剪切波速为 $V_s$ 的土层，其双程走时定义为 $\\tau = 2 h / V_s$。\n- 实倒谱 $c(\\tau)$ 定义为 $\\ln |H(\\omega)|$ 的反傅里叶变换。\n\n构建一个数值计算程序，该程序：\n- 通过变量替换 $\\omega = s \\theta$（其中 $\\theta \\in [0,2\\pi)$，$s$ 为正的比例因子，单位为弧度/秒）将角频率变量 $\\omega$ 在均匀网格上离散化，从而可以使用对 $\\theta$ 的采样值进行的离散傅里叶变换（DFT）来近似相对于 $\\omega$ 的连续反傅里叶变换。\n- 使用双路径回波模型 $H(\\omega) = 1 + r e^{-j \\omega \\tau}$ 和物理上一致的幅值公式 $\\ln |H(\\omega)| = \\frac{1}{2} \\ln \\left(1 + r^2 + 2 r \\cos(\\omega \\tau)\\right)$ 来计算 $\\ln |H(\\omega)|$ 的样本值，其中余弦函数的参数单位为弧度。\n- 通过对 $\\ln |H(\\omega)|$ 进行关于变量 $\\theta$ 的离散傅里叶反变换来获得实倒谱样本，并通过 $\\tau_n = n/s$ 将离散索引 $n$ 映射到以秒为单位的物理倒频率。\n- 在排除了 $\\tau = 0$ 附近的指定搜索窗口 $[\\tau_{\\min}, \\tau_{\\max}]$ 内，搜索主导的正倒频率峰值 $\\tau^\\star$，并通过 $h = V_s \\tau^\\star / 2$ 估算土层厚度。\n- 使用一个小的、均值为零的附加扰动 $\\epsilon(\\theta)$ 添加到 $\\ln |H(\\omega)|$ 中，以模拟具有指定振幅的良性谱波纹（噪声），同时通过使用固定的伪随机数生成器种子来保持计算的确定性。\n- 报告以米为单位的估算土层厚度。\n\n角度单位必须是弧度。所有物理量必须使用国际单位制（SI）处理。您的程序必须输出以米为单位的估算厚度值，并四舍五入到三位小数。\n\n测试套件：\n使用以下参数元组集合 $(V_s, h_{\\text{true}}, r, \\tau_{\\min}, \\tau_{\\max}, a)$，其中 $V_s$ 的单位是米/秒，$h_{\\text{true}}$ 的单位是米，$r$ 是无量纲的，$\\tau_{\\min}$ 和 $\\tau_{\\max}$ 的单位是秒，$a$ 是添加到 $\\ln |H(\\omega)|$ 上的附加扰动的非负振幅：\n- 案例 1：$(V_s = 200, h_{\\text{true}} = 30, r = 0.6, \\tau_{\\min} = 0.05, \\tau_{\\max} = 0.80, a = 0.01)$。\n- 案例 2：$(V_s = 150, h_{\\text{true}} = 5, r = 0.5, \\tau_{\\min} = 0.02, \\tau_{\\max} = 0.20, a = 0.01)$。\n- 案例 3：$(V_s = 250, h_{\\text{true}} = 60, r = 0.7, \\tau_{\\min} = 0.30, \\tau_{\\max} = 0.80, a = 0.005)$。\n- 案例 4：$(V_s = 180, h_{\\text{true}} = 20, r = 0.25, \\tau_{\\min} = 0.05, \\tau_{\\max} = 0.50, a = 0.02)$。\n\n您的程序必须为每个案例，根据指定参数合成 $\\ln |H(\\omega)|$，计算实倒谱，在提供的搜索窗口内检测主导的正倒频率峰值，使用 $h = V_s \\tau^\\star / 2$ 将其转换为以米为单位的估算厚度 $h$，并将四个估算厚度汇总到单行输出中。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[h_1,h_2,h_3,h_4]$），其中每个 $h_i$ 是以米为单位、四舍五入到三位小数的估算厚度。不应打印任何其他文本。\n\n注意事项与约束：\n- 必须选择合适的离散频率缩放，以确保倒频率分辨率 $\\Delta \\tau$ 和总倒频率范围足以解析所有案例的搜索窗口。如果角频率参数化为 $\\omega = s \\theta$，其中 $\\theta \\in [0,2\\pi)$ 在 $N$ 个均匀间隔的点上采样，则倒频率的采样间隔和范围分别为 $\\Delta \\tau = 1/s$ 和 $\\tau_{\\text{span}} = N/s$。选择 $s$ 和 $N$ 以确保 $\\Delta \\tau \\leq 10^{-3}$ 秒和 $\\tau_{\\text{span}} \\geq 1$ 秒。\n- 除了在合成 $H(\\omega)$ 及其提供的搜索边界 $[\\tau_{\\min}, \\tau_{\\max}]$ 中的体现外，算法不得假定对 $h_{\\text{true}}$ 有任何先验知识。\n- 对数必须是自然对数。仅在需要避免数值问题时才进行正则化；所选的 $r$ 值保证了 $1 + r^2 + 2 r \\cos(\\omega \\tau) \\ge (1 - r)^2 > 0$，因此对数函数不需要额外的正则化项。",
            "solution": "该问题被认为是有效的，因为它具有科学依据，定义明确且客观。它基于波传播和信号处理的既定原则，提出了一个清晰、可形式化的任务。\n\n目标是通过对场地频率响应的简化模型应用倒谱分析，来估算覆盖在刚性基岩上的均质土层的厚度 $h$。该过程包括合成响应、添加确定性噪声分量、执行数值反傅里叶变换以获得实倒谱，并识别与波的双程走时相对应的峰值。\n\n该模型的基础是波传播的线性叠加原理。对于垂直入射的剪切波，地表的运动是直达入射波与在土层内反射的一系列波的总和。一个简化的双路径模型仅考虑直达波和来自基岩的第一次反射。这导出了复传递函数 $H(\\omega)$：\n$$ H(\\omega) = 1 + r\\,e^{-j \\omega \\tau_{true}} $$\n在此，$1$ 代表归一化的直达路径，$r\\,e^{-j \\omega \\tau_{true}}$ 代表反射路径，它被双程走时 $\\tau_{true}$ 延迟，其振幅被净反射系数 $r$ 缩放。参数 $j$ 是虚数单位，$\\omega$ 是角频率。通过厚度为 $h$、剪切波速为 $V_s$ 的土层的双程走时由以下公式给出：\n$$ \\tau_{true} = \\frac{2 h}{V_s} $$\n我们的目标是通过首先从系统响应中估算 $\\tau_{true}$ 来估算 $h$。\n\n倒谱分析是一种用于检测回波的强大技术。实倒谱 $c(\\tau_q)$ 定义为频率响应谱幅值对数的反傅里叶变换，其中 $\\tau_q$ 表示倒频率变量（其单位为时间）。\n$$ c(\\tau_q) = \\mathcal{F}^{-1}\\{\\ln|H(\\omega)|\\}(\\tau_q) $$\n$\\ln|\\cdot|$ 运算将谱分量的乘积转换为和，随后的反傅里叶变换在倒频率域中分离这些可加分量。对于像给定这样简单的回波模型，此过程会在等于回波延迟时间 $\\tau_{true}$ 及其整数倍的倒频率处产生峰值（称为 rahmonics）。\n\n传递函数 $|H(\\omega)|$ 的幅值可从其复数定义中求得：\n$$ |H(\\omega)| = |1 + r(\\cos(-\\omega\\tau_{true}) + j\\sin(-\\omega\\tau_{true}))| = \\sqrt{(1 + r\\cos(\\omega\\tau_{true}))^2 + (-r\\sin(\\omega\\tau_{true}))^2} $$\n$$ |H(\\omega)| = \\sqrt{1 + 2r\\cos(\\omega\\tau_{true}) + r^2\\cos^2(\\omega\\tau_{true}) + r^2\\sin^2(\\omega\\tau_{true})} = \\sqrt{1 + r^2 + 2r\\cos(\\omega\\tau_{true})} $$\n因此，幅值谱的对数为：\n$$ \\ln|H(\\omega)| = \\frac{1}{2}\\ln(1 + r^2 + 2r\\cos(\\omega\\tau_{true})) $$\n由于 $r \\in [0, 1)$，对数的参数始终为正，$1+r^2+2r\\cos(\\omega\\tau_{true}) \\geq 1+r^2-2r = (1-r)^2 > 0$，确保了该函数是良定义的。\n\n解析反傅里叶变换通过使用离散傅里叶变换（DFT）进行数值近似。问题指定了一种离散化方案，通过一个比例因子 $s$ 将连续角频率 $\\omega$ 与一个离散的周期性变量 $\\theta \\in [0, 2\\pi)$ 相关联。这使得可以利用快速傅里叶变换（FFT）算法的效率，它是 DFT 的一种常用实现。\n\n数值计算步骤如下：\n1.  **离散化设置**：我们为 DFT 选择点数 $N$ 和频率比例因子 $s$。问题约束了这些选择，以确保足够的倒频率分辨率和范围：$\\Delta\\tau_q = 1/s \\leq 10^{-3}\\,\\text{s}$ 和 $\\tau_{q, \\text{span}} = N/s \\geq 1\\,\\text{s}$。一个合适的选择是 $N=2048$ 和 $s=2000\\,\\text{rad/s}$，这会产生 $\\Delta\\tau_q = 0.0005\\,\\text{s}$ 和 $\\tau_{q, \\text{span}} = 1.024\\,\\text{s}$。\n\n2.  **频谱合成**：函数 $\\ln|H(\\omega)|$ 是 $\\omega$ 的偶函数。此性质意味着其反傅里叶变换，即实倒谱，是一个纯实信号。为了使用 DFT 计算它，我们可以利用为实信号优化的算法，例如实数反快速傅里叶变换（`irfft`）。这要求仅在非负频率上计算频谱。所需的角频率从 0 到奈奎斯特频率 $\\omega_{Nyq} = \\pi s$ 均匀采样。\n    $$ \\omega_k = k \\frac{2\\pi s}{N} \\quad\\text{for}\\quad k = 0, 1, \\dots, \\frac{N}{2} $$\n    对于每个测试案例，计算真实的双程走时 $\\tau_{true} = 2 h_{\\text{true}} / V_s$，并在每个离散频率 $\\omega_k$ 上合成对数幅值谱。\n\n3.  **噪声添加**：使用固定种子生成一个在 $[-a, a]$ 上均匀分布的确定性伪随机噪声序列，并将其添加到合成的对数幅值谱中。这模拟了良性的谱波纹，并测试了峰值检测算法的鲁棒性。\n\n4.  **倒谱计算**：将实数反快速傅里叶变换应用于带噪的对数幅值谱，以获得离散的实倒谱样本 $c[n]$。生成的序列长度为 $N$，并对应于以下倒频率值：\n    $$ \\tau_q[n] = n \\cdot \\Delta\\tau_q = \\frac{n}{s} \\quad\\text{for}\\quad n = 0, 1, \\dots, N-1 $$\n    DFT 样本索引 $n$ 与物理倒频率 $\\tau_q[n]$ 之间的这种关系与离散信号处理的标准理论是一致的。\n\n5.  **峰值检测**：估算的核心在于找到倒谱中与第一次回波相对应的主导峰值。此峰值在指定的搜索窗口 $[\\tau_{\\min}, \\tau_{\\max}]$ 内寻找，该窗口排除了 $\\tau_q=0$ 处的直流分量（频谱的“DC”项）。搜索窗口被转换为索引范围 $[n_{\\min}, n_{\\max}]$。在此范围内确定 $c[n]$ 最大值的索引 $n^\\star$。\n\n6.  **厚度估算**：与峰值对应的倒频率 $\\tau^\\star = n^\\star/s$ 是我们对真实双程走时 $\\tau_{true}$ 的估算值。然后通过反转走时公式来估算土层厚度：\n    $$ h_{est} = \\frac{V_s \\tau^\\star}{2} $$\n根据要求，最终结果四舍五入到三位小数。对提供的每个测试案例重复此整个过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.fft import irfft\n\ndef solve():\n    \"\"\"\n    Computes soil layer thickness from a simplified site response model\n    using cepstral analysis.\n    \"\"\"\n    # Discretization parameters chosen to satisfy problem constraints:\n    # Quefrency resolution Delta_tau = 1/s = 1e-3 s -> s >= 1000\n    # Quefrency span tau_span = N/s >= 1 s\n    N = 2048  # Number of points for DFT, a power of 2 for FFT efficiency\n    s = 2000.  # Frequency scaling factor in rad/s\n\n    # Fixed seed for deterministic noise generation\n    SEED = 42\n\n    # Test cases as tuples: (V_s, h_true, r, tau_min, tau_max, a)\n    # V_s: shear wave speed (m/s)\n    # h_true: true layer thickness (m)\n    # r: reflection coefficient\n    # tau_min, tau_max: search window for peak quefrency (s)\n    # a: amplitude of additive spectral noise\n    test_cases = [\n        (200., 30., 0.6, 0.05, 0.80, 0.01),\n        (150., 5., 0.5, 0.02, 0.20, 0.01),\n        (250., 60., 0.7, 0.30, 0.80, 0.005),\n        (180., 20., 0.25, 0.05, 0.50, 0.02)\n    ]\n\n    results = []\n    rng = np.random.default_rng(seed=SEED)\n\n    for case in test_cases:\n        V_s, h_true, r, tau_min, tau_max, a = case\n\n        # 1. Synthesize the log-magnitude spectrum\n        # True two-way travel time based on the ground truth thickness\n        tau_true = 2. * h_true / V_s\n        \n        # Length of the one-sided spectrum for a real signal of length N\n        N_fft = N // 2 + 1\n        \n        # Discrete angular frequencies for the one-sided spectrum\n        # omega_k = k * Delta_omega = k * (2*pi*s/N)\n        omega = np.arange(N_fft, dtype=float) * (2. * np.pi * s / N)\n\n        # Compute the theoretical log-magnitude spectrum\n        log_mag_spec = 0.5 * np.log(1. + r**2 + 2. * r * np.cos(omega * tau_true))\n\n        # 2. Add deterministic noise\n        noise = rng.uniform(-a, a, size=N_fft)\n        noisy_log_mag_spec = log_mag_spec + noise\n\n        # 3. Compute the real cepstrum\n        # irfft reconstructs the real signal (cepstrum) of length N from\n        # its one-sided spectrum (noisy_log_mag_spec).\n        cepstrum = irfft(noisy_log_mag_spec, n=N)\n\n        # 4. Find the dominant peak in the specified quefrency window\n        # The quefrency axis step is Delta_tau = 1/s\n        tau_axis = np.arange(N, dtype=float) / s\n        \n        # Find all array indices that fall within the search window [tau_min, tau_max]\n        search_indices = np.where((tau_axis >= tau_min)  (tau_axis = tau_max))[0]\n        \n        # Find the index of the maximum cepstral value within the valid search range.\n        # np.argmax returns an index relative to the start of the slice.\n        peak_index_in_slice = np.argmax(cepstrum[search_indices])\n        # Convert back to an index in the full cepstrum array.\n        peak_index = search_indices[peak_index_in_slice]\n\n        # 5. Estimate thickness from the peak quefrency\n        # The estimated two-way travel time is the quefrency at the peak.\n        tau_star = peak_index / s\n        \n        # Estimate thickness by inverting the travel time formula.\n        h_est = V_s * tau_star / 2.\n\n        # Append the rounded result to the list\n        results.append(round(h_est, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实的场地响应模拟必须考虑地面的半无限特性，即波能可以向外辐射而不会被反射回来。本练习通过让你实现一种先进的吸收边界条件——完美匹配层（PML），来正面应对这一挑战。通过从头开始构建和优化PML，你将深入理解如何防止人工模型边界产生虚假波反射，这是进行精确计算波传播分析的一项关键技能。",
            "id": "3559040",
            "problem": "考虑一个二维弹性介质中的平面外剪切 (SH) 运动，该介质垂直分层但水平均匀。设平面外位移场为 $u(x,z)$，具有简谐时间依赖性 $e^{-i \\omega t}$，其中 $\\omega$ 是角频率。对于具有水平波数 $k_x$ 的平面波，假设采用分离变量法 $u(x,z) = U(z) e^{i k_x x}$。从各向同性弹性固体的线动量平衡和本构关系出发，频域中的SH运动控制方程可以简化为关于垂直坐标 $z$ 的一维常微分方程：\n$$\n\\frac{d}{dz}\\left(\\mu(z)\\frac{dU}{dz}\\right) - \\mu(z) k_x^2 U + \\rho(z) \\omega^2 U = 0,\n$$\n其中 $\\mu(z)$ 是剪切模量，$\\rho(z)$ 是质量密度。对于具有恒定 $\\mu$ 和 $\\rho$ 的均匀介质，定义剪切波速 $c_s = \\sqrt{\\mu/\\rho}$ 和剪切波数 $k = \\omega / c_s$，因此对于 $k_x^2  k^2$ 的传播波，垂直波数为 $k_z = \\sqrt{k^2 - k_x^2}$。\n\n为了截断计算域并在垂直方向上模拟一个半无限半空间，在频域中使用沿 $z$ 的复坐标拉伸引入一个完美匹配层 (PML)。令 $s(z)$ 表示复拉伸，使得沿 $z$ 的导数被替换为 $s(z)^{-1} d/dz$。对于上面导出的标量亥姆霍兹型算子，这产生了一维复拉伸方程：\n$$\n\\frac{d}{dz}\\left(\\frac{\\mu}{s(z)} \\frac{dU}{dz}\\right) - \\mu k_x^2 U + \\rho \\omega^2 s(z) U = 0.\n$$\n对于均匀介质，$\\mu$ 和 $\\rho$ 是常数。PML放置在物理区域 $z \\in [0,H]$ 下方的区间 $z \\in [H, H + L_p]$ 内。使用以下多项式渐变PML拉伸，\n$$\ns(z) = \n\\begin{cases}\n1,  0 \\le z  H, \\\\\n1 + i \\dfrac{\\sigma_{\\max}}{\\omega} \\left(\\dfrac{z - H}{L_p}\\right)^m,  H \\le z \\le H + L_p,\n\\end{cases}\n$$\n其中 $\\sigma_{\\max}$ 是最大PML阻尼，单位为 $\\mathrm{s}^{-1}$，$L_p$ 是PML厚度，$m$ 是控制渐变的正整数。\n\n用 $N+1$ 个均匀间隔的节点 $z_i = i h$（其中 $i=0,1,\\dots,N$，$h = (H+L_p)/N$）离散化区间 $[0, H+L_p]$。定义节点值 $U_i \\approx U(z_i)$ 和面心拉伸 $s_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(s_i + s_{i+1}\\right)$，其中 $s_i = s(z_i)$。对通量项使用二阶中心有限差分，内部节点 $i=1,\\dots,N-1$ 的离散方程为\n$$\n\\frac{1}{h^2}\\left(\\frac{\\mu}{s_{i+\\frac{1}{2}}}(U_{i+1}-U_i) - \\frac{\\mu}{s_{i-\\frac{1}{2}}}(U_i - U_{i-1})\\right) - \\mu k_x^2 U_i + \\rho \\omega^2 s_i U_i = 0.\n$$\n施加边界条件 $U(0) = 1$（顶部单位位移振幅）和 $U(H+L_p) = 0$（在PML底部截断）。这将产生一个关于未知内部节点值的线性系统。\n\n为评估有限厚度PML和截断引起的反射率，考虑PML界面正上方的物理区域。在均匀区域 $z  H$ 中，解可以局部建模为下行和上行平面波的叠加：\n$$\nU(z) \\approx A e^{i k_z z} + B e^{-i k_z z}.\n$$\n通过将 $dU/dz$ 的中心有限差分近似与上述分解相结合，定义物理区域内某点 $z_r$ 的局部反射比 $R$。对于选定的内部网格索引 $i_r$ 使得 $z_{i_r} \\in (0,H)$，中心有限差分导数为\n$$\nD \\approx \\frac{U_{i_r+1} - U_{i_r-1}}{2h}.\n$$\n则局部反射比估计为\n$$\nR = \\left|\\frac{U_{i_r} - \\dfrac{D}{i k_z}}{U_{i_r} + \\dfrac{D}{i k_z}}\\right|.\n$$\n\n优化任务：对于掠射角入射，反射最难衰减。对PML参数 $(\\sigma_{\\max}, m)$ 进行参数扫描，以最小化反射比 $R$。对于下面的每个测试用例，评估指定集合中 $\\sigma_{\\max}$ 和 $m$ 的所有组合的 $R$，并返回最佳（最小）的 $R$ 和对应的 $(\\sigma_{\\max}, m)$。\n\n使用的基本常数和定义：\n- 剪切模量 $\\mu$，单位为 $\\mathrm{Pa}$。\n- 质量密度 $\\rho$，单位为 $\\mathrm{kg/m^3}$。\n- 剪切波速 $c_s = \\sqrt{\\mu/\\rho}$，单位为 $\\mathrm{m/s}$。\n- 角频率 $\\omega = 2 \\pi f$，单位为 $\\mathrm{rad/s}$，其中 $f$ 是频率，单位为 $\\mathrm{Hz}$。\n- 剪切波数 $k = \\omega / c_s$，单位为 $\\mathrm{rad/m}$。\n- 水平波数 $k_x = k \\sin\\theta$，其中 $\\theta$ 是入射角，单位为度（计算时需转换为弧度）。\n- 垂直波数 $k_z = \\sqrt{k^2 - k_x^2}$，单位为 $\\mathrm{rad/m}$。\n\n离散化与测量细节：\n- 使用反射点索引 $i_r = \\lfloor H/h \\rfloor - 2$，以使 $z_{i_r}$ 位于PML界面上方两个网格点处。\n- 使用均匀网格间距 $h = (H+L_p)/N$。\n\n测试套件：\n对于每个参数元组，程序必须计算最小化反射比 $R$ 和相关的最优 $(\\sigma_{\\max}, m)$。参数元组为：\n1. 情况 1：均匀半空间，$\\mu = 4.0 \\times 10^8\\,\\mathrm{Pa}$，$\\rho = 2000\\,\\mathrm{kg/m^3}$，$f = 5\\,\\mathrm{Hz}$，入射角 $\\theta = 85^\\circ$，物理厚度 $H = 300\\,\\mathrm{m}$，PML厚度 $L_p = 300\\,\\mathrm{m}$，区间数 $N = 800$。\n2. 情况 2：均匀半空间，$\\mu = 4.0 \\times 10^8\\,\\mathrm{Pa}$，$\\rho = 2000\\,\\mathrm{kg/m^3}$，$f = 2\\,\\mathrm{Hz}$，入射角 $\\theta = 89^\\circ$，物理厚度 $H = 300\\,\\mathrm{m}$，PML厚度 $L_p = 300\\,\\mathrm{m}$，区间数 $N = 600$。\n3. 情况 3：均匀半空间，$\\mu = 6.0 \\times 10^8\\,\\mathrm{Pa}$，$\\rho = 2200\\,\\mathrm{kg/m^3}$，$f = 10\\,\\mathrm{Hz}$，入射角 $\\theta = 45^\\circ$，物理厚度 $H = 300\\,\\mathrm{m}$，PML厚度 $L_p = 300\\,\\mathrm{m}$，区间数 $N = 800$。\n\nPML参数扫描集合：\n- $\\sigma_{\\max} \\in \\{50, 100, 200, 400, 800, 1200, 1600, 2000\\}\\,\\mathrm{s}^{-1}$。\n- $m \\in \\{2, 3, 4\\}$。\n\n所需输出：\n你的程序应生成一行包含结果的字符串，作为逗号分隔的三元组列表，每个测试用例一个三元组。每个三元组必须包含最小化反射比 $R$（浮点数）、最优 $\\sigma_{\\max}$（浮点数，单位为 $\\mathrm{s}^{-1}$）和最优 $m$（整数）。输出必须没有空格，格式如下：\n$$\n[\\,[R_1,\\sigma_{\\max,1},m_1],[R_2,\\sigma_{\\max,2},m_2],[R_3,\\sigma_{\\max,3},m_3]\\,]\n$$\n输出中所有量均为无量纲，但 $\\sigma_{\\max}$ 除外，其必须以 $\\mathrm{s}^{-1}$ 为单位报告。测试套件中指定的角度以度为单位，但在计算时必须转换为弧度。最终数值结果必须以上述确切的单行格式呈现。",
            "solution": "该问题要求通过参数扫描来优化完美匹配层（PML）的性能，以最小化从计算域截断边界产生的人为波反射。解决方案的核心是数值实现：离散化控制波动传播的偏微分方程，构建并求解线性方程组，然后计算反射系数作为PML性能的度量。\n\n该过程的详细步骤如下：\n\n1.  **参数计算和离散化**：\n    首先，根据给定的物理参数（剪切模量 $\\mu$、密度 $\\rho$、频率 $f$、入射角 $\\theta$）计算出一些派生量：剪切波速 $c_s = \\sqrt{\\mu/\\rho}$，角频率 $\\omega = 2\\pi f$，剪切波数 $k = \\omega/c_s$，以及水平和垂直波数 $k_x = k \\sin\\theta$ 和 $k_z = \\sqrt{k^2-k_x^2}$。\n    然后，将整个计算域 $[0, H+L_p]$ 离散为 $N+1$ 个等距节点，间距为 $h = (H+L_p)/N$。在每个节点 $z_i$ 上，计算PML复拉伸函数 $s_i = s(z_i)$ 的值。对于物理域内的节点 ($z_i  H$)，$s_i=1$。对于PML域内的节点 ($z_i \\ge H$)，根据给定的多项式公式计算 $s_i$。\n\n2.  **构建线性系统 $A\\mathbf{U}=\\mathbf{b}$**：\n    我们使用有限差分法将控制微分方程转化为一个线性代数方程组。未知数是内部节点 $i=1, \\dots, N-1$ 上的位移幅值 $U_i$。问题中给出的离散方程可以重新排列，以识别三对角矩阵的系数。对于第 $i$ 个内部节点（对应矩阵的第 $j=i-1$ 行），其方程为：\n    $$\n    \\left(-\\frac{\\mu}{h^2 s_{i-\\frac{1}{2}}}\\right)U_{i-1} + \\left(\\frac{\\mu}{h^2 s_{i+\\frac{1}{2}}} + \\frac{\\mu}{h^2 s_{i-\\frac{1}{2}}} - \\mu k_x^2 + \\rho \\omega^2 s_i\\right)U_i + \\left(-\\frac{\\mu}{h^2 s_{i+\\frac{1}{2}}}\\right)U_{i+1} = 0\n    $$\n    这个方程定义了三对角矩阵 $A$ 的系数。\n    -   矩阵 $A$ 的对角线元素 $A_{j,j}$ 是 $U_i$ 的系数。\n    -   次对角线元素 $A_{j,j-1}$ 是 $U_{i-1}$ 的系数。\n    -   超对角线元素 $A_{j,j+1}$ 是 $U_{i+1}$ 的系数。\n    边界条件会影响方程组。顶部边界 $U_0=1$ 是一个已知的狄利克雷条件。它会修改第一个方程（$i=1$），产生一个非零的右端向量 $\\mathbf{b}$。具体来说，$U_0$ 项被移到方程右侧，所以 $\\mathbf{b}$ 的第一个元素是 $b_0 = \\frac{\\mu}{h^2 s_{1/2}} U_0 = \\frac{\\mu}{h^2 s_{1/2}}$。底部边界 $U_N=0$ 是另一个狄利克雷条件，它仅将未知数的数量限制为 $N-1$ 个，而不会向右端向量 $\\mathbf{b}$ 添加项。\n\n3.  **求解和计算反射比**：\n    构建完 $(N-1) \\times (N-1)$ 的复值矩阵 $A$ 和长度为 $N-1$ 的向量 $\\mathbf{b}$ 后，我们求解线性系统 $A\\mathbf{U}_{\\text{internal}} = \\mathbf{b}$ 得到所有内部节点的位移幅值。将已知的边界值 $U_0=1$ 和 $U_N=0$ 与解合并，得到整个计算域的完整位移场 $\\mathbf{U}$。\n    接下来，我们在物理域内的一个参考点 $z_{i_r}$ 处计算反射比 $R$。该点需要离PML界面有一定距离，以避免近场效应的干扰。我们使用中心差分计算该点的导数 $D \\approx (U_{i_r+1} - U_{i_r-1})/(2h)$。然后，利用问题中给出的公式，将总波场 $U_{i_r}$ 和其导数 $D$ 分解为上行波和下行波，计算出反射比：\n    $$\n    R = \\left|\\frac{U_{i_r} - \\dfrac{D}{i k_z}}{U_{i_r} + \\dfrac{D}{i k_z}}\\right|\n    $$\n    这个公式的分子代表上行（反射）波的复振幅，分母代表下行（入射）波的复振幅。\n\n4.  **参数扫描与优化**：\n    对于给定的PML参数集合中的每一个 $(\\sigma_{\\max}, m)$ 组合，重复上述步骤1-3，计算对应的反射比 $R$。最后，在所有结果中找到最小的 $R$ 值，并记录下产生该最小值的 $(\\sigma_{\\max}, m)$ 组合。对每个测试用例都执行此优化过程，并按指定格式报告结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the PML optimization for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: (mu, rho, f, theta_deg, H, Lp, N)\n        (4.0e8, 2000.0, 5.0, 85.0, 300.0, 300.0, 800),\n        # Case 2:\n        (4.0e8, 2000.0, 2.0, 89.0, 300.0, 300.0, 600),\n        # Case 3:\n        (6.0e8, 2200.0, 10.0, 45.0, 300.0, 300.0, 800),\n    ]\n\n    sweep_sigma_max = [50.0, 100.0, 200.0, 400.0, 800.0, 1200.0, 1600.0, 2000.0]\n    sweep_m = [2, 3, 4]\n\n    final_results = []\n\n    for case in test_cases:\n        mu, rho, f, theta_deg, H, Lp, N = case\n        \n        min_R = float('inf')\n        best_params = (None, None)\n\n        for sigma_max in sweep_sigma_max:\n            for m in sweep_m:\n                # Calculate R for the current set of parameters\n                R = calculate_reflection_ratio(mu, rho, f, theta_deg, H, Lp, N, sigma_max, m)\n                \n                # Update if a better result is found\n                if R  min_R:\n                    min_R = R\n                    best_params = (sigma_max, m)\n        \n        final_results.append([min_R, best_params[0], best_params[1]])\n\n    # Format the final output string exactly as required\n    result_strings = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in final_results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef calculate_reflection_ratio(mu, rho, f, theta_deg, H, Lp, N, sigma_max, m):\n    \"\"\"\n    Computes the reflection ratio for a given set of physical and PML parameters.\n    \"\"\"\n    # 1. Parameter Computation\n    cs = np.sqrt(mu / rho)\n    omega = 2.0 * np.pi * f\n    k = omega / cs\n    theta_rad = np.deg2rad(theta_deg)\n    kx = k * np.sin(theta_rad)\n    kz_val = k**2 - kx**2\n    # Ensure kz is real for propagating waves, handle evanescent case if needed.\n    if kz_val  0:\n      return float('inf') # Evanescent wave, reflection is total.\n    kz = np.sqrt(kz_val)\n\n    # 2. Discretization and PML Stretch Function\n    h = (H + Lp) / N\n    z = np.linspace(0, H + Lp, N + 1)\n    \n    s = np.ones_like(z, dtype=np.complex128)\n    pml_indices = z > H\n    \n    if np.any(pml_indices):\n        z_pml = z[pml_indices]\n        s_pml = 1.0 + 1j * (sigma_max / omega) * ((z_pml - H) / Lp)**m\n        s[pml_indices] = s_pml\n\n    s_half = 0.5 * (s[:-1] + s[1:])\n\n    # 3. Linear System Formulation\n    num_unknowns = N - 1\n    A = np.zeros((num_unknowns, num_unknowns), dtype=np.complex128)\n    b = np.zeros(num_unknowns, dtype=np.complex128)\n    \n    h2 = h**2\n\n    # Loop through interior nodes i = 1, ..., N-1\n    for i in range(1, N):\n        j = i - 1  # Matrix index\n\n        # Coefficients related to the flux term\n        C_imhalf = mu / (h2 * s_half[i-1])\n        C_iphalf = mu / (h2 * s_half[i])\n\n        # Diagonal term of the matrix\n        diag_val = C_imhalf + C_iphalf - mu * kx**2 + rho * omega**2 * s[i]\n        A[j, j] = diag_val\n\n        # Off-diagonal terms\n        if i > 1:\n            A[j, j-1] = -C_imhalf\n        if i  N - 1:\n            A[j, j+1] = -C_iphalf\n    \n    # Right-hand side vector from boundary condition U_0 = 1\n    b[0] = mu / (h2 * s_half[0])\n\n    # 4. Solving the System\n    U_sol = np.linalg.solve(A, b)\n    U = np.concatenate(([1.0+0j], U_sol, [0.0+0j]))\n\n    # 5. Reflection Ratio Calculation\n    ir = int(np.floor(H / h)) - 2\n    \n    # Ensure index is valid\n    if ir  1 or ir > N - 2:\n        return float('inf')\n\n    # Centered finite difference for the derivative\n    D = (U[ir + 1] - U[ir - 1]) / (2.0 * h)\n    \n    denom_term = D / (1j * kz)\n\n    if np.abs(U[ir] + denom_term)  1e-15:\n        return float('inf')\n\n    R = np.abs((U[ir] - denom_term) / (U[ir] + denom_term))\n\n    return R\n\nsolve()\n```"
        }
    ]
}