{
    "hands_on_practices": [
        {
            "introduction": "This first exercise guides you through a foundational calculation in site response analysis. By starting from the basic wave equation, you will derive the expression for the fundamental resonant frequency of an idealized soil layer, which governs the primary amplification behavior of the site . The exercise then extends this by introducing sensitivity analysis, a crucial tool for understanding how uncertainties in soil properties like shear-wave velocity ($V_s$) and layer thickness ($h$) propagate to our engineering predictions.",
            "id": "3559083",
            "problem": "Consider vertically propagating, horizontally polarized shear (SH) waves in a one-dimensional, homogeneous, linear elastic soil layer of thickness $h$ overlying a rigid bedrock. Let the soil have mass density $\\rho$ and shear modulus $\\mu$, so that the shear-wave velocity is $V_s = \\sqrt{\\mu/\\rho}$. Assume small strains and time-harmonic motion with angular frequency $\\omega$, so that the displacement field can be written as $u(z,t) = \\Re\\{U(z)\\exp(i \\omega t)\\}$, where $z$ is the vertical coordinate measured downward from the free surface at z=0 to the rigid base at z=h.\n\nUsing linear momentum balance and linear elasticity for SH motion, the depth-dependent displacement amplitude $U(z)$ satisfies a scalar boundary value problem with a traction-free condition at the ground surface and a kinematic condition at the rigid base. Define the fundamental resonance frequency $f_1$ (in Hertz) as the lowest nonzero frequency at which a nontrivial standing wave solution exists that satisfies these boundary conditions.\n\nStarting from the governing equations and boundary conditions, derive an explicit closed-form expression for $f_1$ in terms of $V_s$ and $h$, and then compute the first-order sensitivities of $f_1$ with respect to $V_s$ and $h$, namely the partial derivatives $\\partial f_1/\\partial V_s$ and $\\partial f_1/\\partial h$. Express your final result as the gradient row vector $[\\partial f_1/\\partial V_s,\\ \\partial f_1/\\partial h]$ as a function of $V_s$ and $h$ only. No numerical evaluation is required, and no rounding is needed. Do not include units in your final boxed answer.",
            "solution": "The problem requires the derivation of the fundamental resonance frequency of a homogeneous soil layer over rigid bedrock and its sensitivities with respect to the layer's shear-wave velocity and thickness.\n\nThe governing equation for one-dimensional, vertically propagating, horizontally polarized shear (SH) waves is the wave equation. For a homogeneous, linear elastic soil with mass density $\\rho$ and shear modulus $\\mu$, this equation is:\n$$ \\rho \\frac{\\partial^2 u}{\\partial t^2} = \\mu \\frac{\\partial^2 u}{\\partial z^2} $$\nwhere $u(z,t)$ is the horizontal displacement and $z$ is the vertical coordinate. The shear-wave velocity is given by $V_s = \\sqrt{\\mu/\\rho}$. The wave equation can be rewritten as:\n$$ \\frac{\\partial^2 u}{\\partial t^2} = V_s^2 \\frac{\\partial^2 u}{\\partial z^2} $$\nWe consider time-harmonic motion with angular frequency $\\omega$, such that the displacement is of the form $u(z,t) = \\Re\\{U(z)\\exp(i \\omega t)\\}$, where $U(z)$ is the complex-valued displacement amplitude as a function of depth. Substituting this form into the wave equation yields an ordinary differential equation for $U(z)$:\n$$ -\\omega^2 U(z) = V_s^2 \\frac{d^2 U}{dz^2} $$\nRearranging this gives the standard Helmholtz equation:\n$$ \\frac{d^2 U}{dz^2} + \\left(\\frac{\\omega}{V_s}\\right)^2 U(z) = 0 $$\nLet us define the wavenumber $k = \\omega/V_s$. The governing equation becomes:\n$$ \\frac{d^2 U}{dz^2} + k^2 U(z) = 0 $$\nThe general solution to this second-order linear homogeneous differential equation is:\n$$ U(z) = A \\sin(kz) + B \\cos(kz) $$\nwhere $A$ and $B$ are constants to be determined by the boundary conditions.\n\nThe boundary conditions are given for the soil layer of thickness $h$. The coordinate system is defined with the free surface at $z=0$ and the rigid base at $z=h$.\n$1$. At the ground surface ($z=0$), there is a traction-free condition. The shear stress $\\tau = \\mu \\frac{\\partial u}{\\partial z}$ must be zero. In terms of the amplitude $U(z)$, this means $\\mu \\frac{dU}{dz}\\Big|_{z=0} = 0$. Since $\\mu \\neq 0$, the condition is:\n$$ \\frac{dU}{dz}(0) = 0 $$\n$2$. At the base ($z=h$), the layer is in contact with rigid bedrock, which imposes a kinematic condition of zero displacement. Therefore, $u(h,t)=0$ for all time $t$, which implies that the amplitude must be zero:\n$$ U(h) = 0 $$\n\nNow, we apply these boundary conditions to the general solution. First, we find the derivative of $U(z)$:\n$$ \\frac{dU}{dz} = Ak \\cos(kz) - Bk \\sin(kz) $$\nApplying the first boundary condition at $z=0$:\n$$ \\frac{dU}{dz}(0) = Ak \\cos(0) - Bk \\sin(0) = Ak = 0 $$\nFor a non-trivial wave motion, the wavenumber $k$ cannot be zero (since $\\omega \\neq 0$), so we must have $A=0$. The solution simplifies to:\n$$ U(z) = B \\cos(kz) $$\nNext, we apply the second boundary condition at $z=h$:\n$$ U(h) = B \\cos(kh) = 0 $$\nFor a nontrivial standing wave solution, the amplitude $B$ cannot be zero. Therefore, the condition for resonance is:\n$$ \\cos(kh) = 0 $$\nThis equation is satisfied when the argument $kh$ is an odd integer multiple of $\\pi/2$:\n$$ k_n h = (2n-1)\\frac{\\pi}{2}, \\quad \\text{for } n = 1, 2, 3, \\dots $$\nThe fundamental resonance frequency corresponds to the lowest nonzero frequency, which is found by setting $n=1$:\n$$ k_1 h = \\frac{\\pi}{2} $$\nSubstituting the definition of the wavenumber, $k_1 = \\omega_1/V_s = 2\\pi f_1/V_s$, where $\\omega_1$ is the fundamental angular frequency and $f_1$ is the fundamental frequency in Hertz.\n$$ \\left(\\frac{2\\pi f_1}{V_s}\\right) h = \\frac{\\pi}{2} $$\nSolving for $f_1$, we obtain the expression for the fundamental resonance frequency:\n$$ f_1 = \\frac{V_s}{4h} $$\nThe problem then requires the computation of the first-order sensitivities of $f_1$ with respect to $V_s$ and $h$. These are the partial derivatives of $f_1(V_s, h)$.\n\nFirst, the partial derivative with respect to $V_s$:\n$$ \\frac{\\partial f_1}{\\partial V_s} = \\frac{\\partial}{\\partial V_s}\\left(\\frac{V_s}{4h}\\right) = \\frac{1}{4h} $$\nSecond, the partial derivative with respect to $h$:\n$$ \\frac{\\partial f_1}{\\partial h} = \\frac{\\partial}{\\partial h}\\left(\\frac{V_s}{4h}\\right) = \\frac{V_s}{4} \\frac{\\partial}{\\partial h}\\left(h^{-1}\\right) = \\frac{V_s}{4}(-1 \\cdot h^{-2}) = -\\frac{V_s}{4h^2} $$\nThe gradient row vector $[\\partial f_1/\\partial V_s, \\ \\partial f_1/\\partial h]$ is therefore:\n$$ \\left[ \\frac{1}{4h}, \\ -\\frac{V_s}{4h^2} \\right] $$\nThis result is expressed as a function of $V_s$ and $h$ only, as required.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{4h} & -\\frac{V_s}{4h^2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A site's transfer function contains more information than just its resonant peaks; it holds a detailed signature of the subsurface structure. This hands-on coding practice introduces cepstral analysis, a powerful signal processing technique for detecting echoes within a signal . By implementing a cepstral analysis routine, you will learn how to extract the two-way wave travel time from a site's frequency response and use it to estimate the thickness of a soil layer, a common objective in geophysical site characterization.",
            "id": "3559019",
            "problem": "You are given a simplified, yet physically meaningful, one-dimensional linear time-invariant model of vertical shear wave propagation through a single homogeneous soil layer of thickness $h$ over rigid bedrock. For vertically incident shear waves, the complex transfer function $H(\\omega)$ from the incident rock motion to the surface motion exhibits echoes caused by impedance contrast at the layer–bedrock interface. A parsimonious and widely used echo model for the magnitude behavior is the two-path superposition $H(\\omega) = 1 + r\\,e^{-j \\omega \\tau}$, where $r \\in [0,1)$ is a real-valued reflection coefficient capturing the net amplitude of a once-reflected path, $j$ is the imaginary unit, and $\\tau$ is the two-way travel time through the layer. The two-way travel time is $\\tau = 2 h / V_s$, where $V_s$ is the shear wave speed of the layer. The real cepstrum $c(\\tau)$ of the system is defined as the inverse Fourier transform (with respect to $\\omega$) of the natural logarithm of the magnitude spectrum, $c(\\tau) = \\mathcal{F}^{-1}\\{\\ln |H(\\omega)|\\}(\\tau)$. Peaks in $c(\\tau)$ occur at quefrency values equal to echo delays and their multiples, which can be used to infer $h$ from the peak location $\\tau^\\star$ via $h = V_s \\tau^\\star / 2$.\n\nStarting from the following fundamental base:\n- Linear superposition of waves, which implies that the frequency response of a sum of delayed paths is the sum of their complex exponentials.\n- The two-way travel time definition $\\tau = 2 h / V_s$ for a layer of thickness $h$ and shear wave speed $V_s$.\n- The definition of the real cepstrum $c(\\tau)$ as the inverse Fourier transform of $\\ln |H(\\omega)|$.\n\nConstruct a numerical procedure that:\n- Discretizes the angular frequency variable $\\omega$ on a uniform grid through a change of variables $\\omega = s \\theta$ with $\\theta \\in [0,2\\pi)$ and a positive scale factor $s$ (in radians per second), so that a Discrete Fourier Transform (DFT) of the samples over $\\theta$ can be used to approximate the inverse continuous Fourier transform with respect to $\\omega$.\n- Computes samples of $\\ln |H(\\omega)|$ using the two-path echo model $H(\\omega) = 1 + r e^{-j \\omega \\tau}$ with the physically consistent magnitude formula $\\ln |H(\\omega)| = \\frac{1}{2} \\ln \\left(1 + r^2 + 2 r \\cos(\\omega \\tau)\\right)$, where the argument of the cosine is in radians.\n- Obtains the real cepstrum samples by the inverse Discrete Fourier Transform of $\\ln |H(\\omega)|$ with respect to the variable $\\theta$, and maps the discrete index $n$ to a physical quefrency in seconds via $\\tau_n = n/s$.\n- Searches for the dominant positive quefrency peak $\\tau^\\star$ in a prescribed search window $[\\tau_{\\min}, \\tau_{\\max}]$ that excludes the neighborhood of $\\tau = 0$, and estimates the layer thickness by $h = V_s \\tau^\\star / 2$.\n- Uses a small additive zero-mean perturbation to $\\ln |H(\\omega)|$ as $\\epsilon(\\theta)$ to model benign spectral ripple (noise) with a specified amplitude, while keeping the computation deterministic by using a fixed pseudo-random number generator seed.\n- Reports the estimated layer thickness in meters.\n\nAngle units must be radians. All physical quantities must be handled in the International System of Units (SI). Your program must output the estimated thickness values in meters, rounded to three decimal places.\n\nTest Suite:\nUse the following set of parameter tuples $(V_s, h_{\\text{true}}, r, \\tau_{\\min}, \\tau_{\\max}, a)$, where $V_s$ is in meters per second, $h_{\\text{true}}$ is in meters, $r$ is dimensionless, $\\tau_{\\min}$ and $\\tau_{\\max}$ are in seconds, and $a$ is the nonnegative amplitude of the additive perturbation to $\\ln |H(\\omega)|$:\n- Case $1$: $(V_s = 200, h_{\\text{true}} = 30, r = 0.6, \\tau_{\\min} = 0.05, \\tau_{\\max} = 0.80, a = 0.01)$.\n- Case $2$: $(V_s = 150, h_{\\text{true}} = 5, r = 0.5, \\tau_{\\min} = 0.02, \\tau_{\\max} = 0.20, a = 0.01)$.\n- Case $3$: $(V_s = 250, h_{\\text{true}} = 60, r = 0.7, \\tau_{\\min} = 0.30, \\tau_{\\max} = 0.80, a = 0.005)$.\n- Case $4$: $(V_s = 180, h_{\\text{true}} = 20, r = 0.25, \\tau_{\\min} = 0.05, \\tau_{\\max} = 0.50, a = 0.02)$.\n\nYour program must, for each case, synthesize $\\ln |H(\\omega)|$ from the specified parameters, compute the real cepstrum, detect the dominant positive quefrency peak within the provided search window, convert it to an estimated thickness $h$ in meters using $h = V_s \\tau^\\star / 2$, and aggregate the four estimated thicknesses into a single output line.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[h_1,h_2,h_3,h_4]$), where each $h_i$ is the estimated thickness in meters rounded to three decimal places. No other text should be printed.\n\nNotes and constraints:\n- The discrete frequency scaling must be chosen so that the quefrency resolution $\\Delta \\tau$ and the total quefrency span are sufficient to resolve the search windows of all cases. If the angular frequency is parameterized as $\\omega = s \\theta$ with $\\theta \\in [0,2\\pi)$ sampled at $N$ uniformly spaced points, then the quefrency sample spacing and span are $\\Delta \\tau = 1/s$ and $\\tau_{\\text{span}} = N/s$ respectively. Choose $s$ and $N$ to ensure $\\Delta \\tau \\leq 10^{-3}$ seconds and $\\tau_{\\text{span}} \\geq 1$ second.\n- The algorithm must not assume prior knowledge of $h_{\\text{true}}$ beyond its manifestation in the synthesis of $H(\\omega)$ and the provided search bounds $[\\tau_{\\min}, \\tau_{\\max}]$.\n- The logarithm must be the natural logarithm. Regularize only if needed to avoid numerical issues; the chosen $r$ values guarantee $1 + r^2 + 2 r \\cos(\\omega \\tau) \\ge (1 - r)^2 > 0$, so no additional regularization term is necessary for the logarithm.",
            "solution": "The objective is to estimate the thickness $h$ of a homogeneous soil layer overlying rigid bedrock by applying cepstral analysis to a simplified model of the site's frequency response. The procedure involves synthesizing the response, adding a deterministic noise component, performing a numerical inverse Fourier transform to obtain the real cepstrum, and identifying a peak corresponding to the wave's two-way travel time.\n\nThe foundation of the model is the principle of linear superposition for wave propagation. For vertically incident shear waves, the motion at the surface is the sum of the direct incoming wave and a series of waves reflected within the layer. A simplified two-path model considers only the direct wave and the first reflection from the bedrock. This leads to the complex transfer function $H(\\omega)$:\n$$ H(\\omega) = 1 + r\\,e^{-j \\omega \\tau_{true}} $$\nHere, $1$ represents the normalized direct path, and $r\\,e^{-j \\omega \\tau_{true}}$ represents the reflected path, which is delayed by the two-way travel time $\\tau_{true}$ and has its amplitude scaled by a net reflection coefficient $r$. The parameter $j$ is the imaginary unit, and $\\omega$ is the angular frequency. The two-way travel time through a layer of thickness $h$ with shear wave speed $V_s$ is given by:\n$$ \\tau_{true} = \\frac{2 h}{V_s} $$\nOur goal is to estimate $h$ by first estimating $\\tau_{true}$ from the system's response.\n\nCepstral analysis is a powerful technique for detecting echoes. The real cepstrum $c(\\tau_q)$ is defined as the inverse Fourier transform of the logarithm of the magnitude of the frequency response spectrum, where $\\tau_q$ represents the quefrency variable (which has units of time).\n$$ c(\\tau_q) = \\mathcal{F}^{-1}\\{\\ln|H(\\omega)|\\}(\\tau_q) $$\nThe operation $\\ln|\\cdot|$ transforms the product of spectral components into a sum, and the subsequent inverse Fourier transform separates these additive components in the quefrency domain. For a simple echo model like the one given, this process results in peaks (called rahmonics) at quefrencies equal to the echo delay time $\\tau_{true}$ and its integer multiples.\n\nThe magnitude of the transfer function $|H(\\omega)|$ is found from its complex definition:\n$$ |H(\\omega)| = |1 + r(\\cos(-\\omega\\tau_{true}) + j\\sin(-\\omega\\tau_{true}))| = \\sqrt{(1 + r\\cos(\\omega\\tau_{true}))^2 + (-r\\sin(\\omega\\tau_{true}))^2} $$\n$$ |H(\\omega)| = \\sqrt{1 + 2r\\cos(\\omega\\tau_{true}) + r^2\\cos^2(\\omega\\tau_{true}) + r^2\\sin^2(\\omega\\tau_{true})} = \\sqrt{1 + r^2 + 2r\\cos(\\omega\\tau_{true})} $$\nThe logarithm of the magnitude spectrum is therefore:\n$$ \\ln|H(\\omega)| = \\frac{1}{2}\\ln(1 + r^2 + 2r\\cos(\\omega\\tau_{true})) $$\nSince $r \\in [0, 1)$, the argument of the logarithm is always positive, $1+r^2+2r\\cos(\\omega\\tau_{true}) \\geq 1+r^2-2r = (1-r)^2 > 0$, ensuring the function is well-defined.\n\nThe analytical inverse Fourier transform is approximated numerically using the Discrete Fourier Transform (DFT). The problem specifies a discretization scheme relating the continuous angular frequency $\\omega$ to a discrete, periodic variable $\\theta \\in [0, 2\\pi)$ via a scaling factor $s$. This allows leveraging the efficiency of the Fast Fourier Transform (FFT) algorithm, a common implementation of the DFT.\n\nThe numerical procedure is as follows:\n1.  **Discretization Setup**: We select a number of points $N$ for the DFT and a frequency scaling factor $s$. The problem constrains these choices to ensure adequate quefrency resolution and span: $\\Delta\\tau_q = 1/s \\leq 10^{-3}\\,\\text{s}$ and $\\tau_{q, \\text{span}} = N/s \\geq 1\\,\\text{s}$. A suitable choice is $N=2048$ and $s=2000\\,\\text{rad/s}$, yielding $\\Delta\\tau_q = 0.0005\\,\\text{s}$ and $\\tau_{q, \\text{span}} = 1.024\\,\\text{s}$.\n\n2.  **Spectrum Synthesis**: The function $\\ln|H(\\omega)|$ is an even function of $\\omega$. This property implies that its inverse Fourier transform, the real cepstrum, is a purely real signal. To compute this using a DFT, we can leverage algorithms optimized for real signals, such as the inverse real FFT (`irfft`). This requires computing the spectrum only at non-negative frequencies. The required angular frequencies are sampled uniformly from $0$ up to the Nyquist frequency, $\\omega_{Nyq} = \\pi s$.\n    $$ \\omega_k = k \\frac{2\\pi s}{N} \\quad\\text{for}\\quad k = 0, 1, \\dots, \\frac{N}{2} $$\n    For each test case, the true two-way travel time $\\tau_{true} = 2 h_{\\text{true}} / V_s$ is calculated, and the log-magnitude spectrum is synthesized at each discrete frequency $\\omega_k$.\n\n3.  **Noise Addition**: A deterministic pseudo-random noise sequence, uniformly distributed in $[-a, a]$, is generated using a fixed seed and added to the synthesized log-magnitude spectrum. This models benign spectral ripple and tests the robustness of the peak detection algorithm.\n\n4.  **Cepstrum Computation**: The inverse real FFT is applied to the noisy log-magnitude spectrum to obtain the discrete real cepstrum samples, $c[n]$. The resulting sequence has length $N$ and corresponds to quefrency values:\n    $$ \\tau_q[n] = n \\cdot \\Delta\\tau_q = \\frac{n}{s} \\quad\\text{for}\\quad n = 0, 1, \\dots, N-1 $$\n    This relationship between the DFT sample index $n$ and the physical quefrency $\\tau_q[n]$ is consistent with the standard theory of discrete signal processing.\n\n5.  **Peak Detection**: The core of the estimation lies in finding the dominant peak in the cepstrum that corresponds to the first echo. This peak is sought within a specified search window $[\\tau_{\\min}, \\tau_{\\max}]$, which excludes the component at $\\tau_q=0$ (the \"DC\" term of the spectrum). The search window is converted into a range of indices $[n_{\\min}, n_{\\max}]$. The index $n^\\star$ of the maximum value of $c[n]$ within this range is identified.\n\n6.  **Thickness Estimation**: The quefrency corresponding to the peak, $\\tau^\\star = n^\\star/s$, is our estimate of the true two-way travel time $\\tau_{true}$. The layer thickness is then estimated by inverting the travel time formula:\n    $$ h_{est} = \\frac{V_s \\tau^\\star}{2} $$\nThe final result is rounded to three decimal places as required. This entire process is repeated for each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.fft import irfft\n\ndef solve():\n    \"\"\"\n    Computes soil layer thickness from a simplified site response model\n    using cepstral analysis.\n    \"\"\"\n    # Discretization parameters chosen to satisfy problem constraints:\n    # Quefrency resolution Delta_tau = 1/s <= 1e-3 s -> s >= 1000\n    # Quefrency span tau_span = N/s >= 1 s\n    N = 2048  # Number of points for DFT, a power of 2 for FFT efficiency\n    s = 2000.  # Frequency scaling factor in rad/s\n\n    # Fixed seed for deterministic noise generation\n    SEED = 42\n\n    # Test cases as tuples: (V_s, h_true, r, tau_min, tau_max, a)\n    # V_s: shear wave speed (m/s)\n    # h_true: true layer thickness (m)\n    # r: reflection coefficient\n    # tau_min, tau_max: search window for peak quefrency (s)\n    # a: amplitude of additive spectral noise\n    test_cases = [\n        (200., 30., 0.6, 0.05, 0.80, 0.01),\n        (150., 5., 0.5, 0.02, 0.20, 0.01),\n        (250., 60., 0.7, 0.30, 0.80, 0.005),\n        (180., 20., 0.25, 0.05, 0.50, 0.02)\n    ]\n\n    results = []\n    rng = np.random.default_rng(seed=SEED)\n\n    for case in test_cases:\n        V_s, h_true, r, tau_min, tau_max, a = case\n\n        # 1. Synthesize the log-magnitude spectrum\n        # True two-way travel time based on the ground truth thickness\n        tau_true = 2. * h_true / V_s\n        \n        # Length of the one-sided spectrum for a real signal of length N\n        N_fft = N // 2 + 1\n        \n        # Discrete angular frequencies for the one-sided spectrum\n        # omega_k = k * Delta_omega = k * (2*pi*s/N)\n        omega = np.arange(N_fft, dtype=float) * (2. * np.pi * s / N)\n\n        # Compute the theoretical log-magnitude spectrum\n        log_mag_spec = 0.5 * np.log(1. + r**2 + 2. * r * np.cos(omega * tau_true))\n\n        # 2. Add deterministic noise\n        noise = rng.uniform(-a, a, size=N_fft)\n        noisy_log_mag_spec = log_mag_spec + noise\n\n        # 3. Compute the real cepstrum\n        # irfft reconstructs the real signal (cepstrum) of length N from\n        # its one-sided spectrum (noisy_log_mag_spec).\n        cepstrum = irfft(noisy_log_mag_spec, n=N)\n\n        # 4. Find the dominant peak in the specified quefrency window\n        # The quefrency axis step is Delta_tau = 1/s\n        tau_axis = np.arange(N, dtype=float) / s\n        \n        # Find all array indices that fall within the search window [tau_min, tau_max]\n        search_indices = np.where((tau_axis >= tau_min) & (tau_axis <= tau_max))[0]\n        \n        # Find the index of the maximum cepstral value within the valid search range.\n        # np.argmax returns an index relative to the start of the slice.\n        peak_index_in_slice = np.argmax(cepstrum[search_indices])\n        # Convert back to an index in the full cepstrum array.\n        peak_index = search_indices[peak_index_in_slice]\n\n        # 5. Estimate thickness from the peak quefrency\n        # The estimated two-way travel time is the quefrency at the peak.\n        tau_star = peak_index / s\n        \n        # Estimate thickness by inverting the travel time formula.\n        h_est = V_s * tau_star / 2.\n\n        # Append the rounded result to the list\n        results.append(round(h_est, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Numerical models for site response must simulate a semi-infinite medium, which presents a significant challenge: how to truncate the computational domain without causing artificial wave reflections. This advanced practice addresses this by guiding you to implement a Perfectly Matched Layer (PML), a state-of-the-art numerical absorbing boundary condition . Through a hands-on parameter optimization study, you will gain practical experience with a critical component of modern computational geomechanics software and develop an intuition for what makes an absorbing boundary effective.",
            "id": "3559040",
            "problem": "Consider out-of-plane shear (SH) motion in a two-dimensional elastic medium that is vertically stratified but horizontally homogeneous. Let the out-of-plane displacement field be $u(x,z)$, with harmonic time dependence $e^{-i \\omega t}$, where $\\omega$ is the angular frequency. For a plane wave with horizontal wavenumber $k_x$, assume a separated-field ansatz $u(x,z) = U(z) e^{i k_x x}$. Starting from the linear momentum balance and the constitutive relation for an isotropic elastic solid, the governing equation for SH motion in the frequency domain can be reduced to a one-dimensional ordinary differential equation in the vertical coordinate $z$:\n$$\n\\frac{d}{dz}\\left(\\mu(z)\\frac{dU}{dz}\\right) - \\mu(z) k_x^2 U + \\rho(z) \\omega^2 U = 0,\n$$\nwhere $\\mu(z)$ is the shear modulus and $\\rho(z)$ is the mass density. For a homogeneous medium with constant $\\mu$ and $\\rho$, define the shear wave speed $c_s = \\sqrt{\\mu/\\rho}$ and the shear wavenumber $k = \\omega / c_s$, so that the vertical wavenumber is $k_z = \\sqrt{k^2 - k_x^2}$ for propagating waves with $k_x^2 < k^2$.\n\nTo truncate the computational domain and mimic a semi-infinite halfspace in the vertical direction, introduce a perfectly matched layer (PML) in the frequency domain using complex coordinate stretching along $z$. Let $s(z)$ denote the complex stretch such that derivatives along $z$ are replaced by $s(z)^{-1} d/dz$. For the scalar Helmholtz-type operator derived above, this yields the one-dimensional complex-stretched equation\n$$\n\\frac{d}{dz}\\left(\\frac{\\mu}{s(z)} \\frac{dU}{dz}\\right) - \\mu k_x^2 U + \\rho \\omega^2 s(z) U = 0.\n$$\nFor a homogeneous medium, $\\mu$ and $\\rho$ are constants. The PML is placed in the interval $z \\in [H, H + L_p]$ beneath a physical region $z \\in [0,H]$. Use the following polynomially graded PML stretch,\n$$\ns(z) = \n\\begin{cases}\n1, & 0 \\le z < H, \\\\\n1 + i \\dfrac{\\sigma_{\\max}}{\\omega} \\left(\\dfrac{z - H}{L_p}\\right)^m, & H \\le z \\le H + L_p,\n\\end{cases}\n$$\nwhere $\\sigma_{\\max}$ is the maximum PML damping with units $\\mathrm{s}^{-1}$, $L_p$ is the PML thickness, and $m$ is a positive integer controlling the grading.\n\nDiscretize the interval $[0, H+L_p]$ with $N+1$ uniformly spaced nodes $z_i = i h$ for $i=0,1,\\dots,N$, where $h = (H+L_p)/N$. Define the nodal values $U_i \\approx U(z_i)$ and the face-centered stretches $s_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(s_i + s_{i+1}\\right)$, where $s_i = s(z_i)$. Using second-order centered finite differences for the flux term, the discrete equations at interior nodes $i=1,\\dots,N-1$ are\n$$\n\\frac{1}{h^2}\\left(\\frac{\\mu}{s_{i+\\frac{1}{2}}}(U_{i+1}-U_i) - \\frac{\\mu}{s_{i-\\frac{1}{2}}}(U_i - U_{i-1})\\right) - \\mu k_x^2 U_i + \\rho \\omega^2 s_i U_i = 0.\n$$\nImpose the boundary conditions $U(0) = 1$ (unit displacement amplitude at the top) and $U(H+L_p) = 0$ (truncation at the bottom of the PML). This produces a linear system for the unknown interior nodal values.\n\nTo assess the reflectivity induced by the finite-thickness PML and the truncation, consider the physical region just above the PML interface. In the homogeneous region $z < H$, the solution can be locally modeled as a superposition of a downgoing and an upgoing plane wave:\n$$\nU(z) \\approx A e^{i k_z z} + B e^{-i k_z z}.\n$$\nDefine the local reflection ratio $R$ at a point $z_r$ within the physical region by combining a centered finite-difference approximation to $dU/dz$ with the above decomposition. For a chosen interior grid index $i_r$ such that $z_{i_r} \\in (0,H)$, the centered finite-difference derivative is\n$$\nD \\approx \\frac{U_{i_r+1} - U_{i_r-1}}{2h}.\n$$\nThen the local reflection ratio estimate is\n$$\nR = \\left|\\frac{U_{i_r} - \\dfrac{D}{i k_z}}{U_{i_r} + \\dfrac{D}{i k_z}}\\right|.\n$$\n\nOptimization task: For grazing-angle incidence, reflections are hardest to attenuate. Implement a parameter sweep over the PML parameters $(\\sigma_{\\max}, m)$ to minimize the reflection ratio $R$. For each test case below, evaluate $R$ for all combinations of $\\sigma_{\\max}$ and $m$ in the specified sets and return the best (minimum) $R$ and the corresponding $(\\sigma_{\\max}, m)$.\n\nFundamental constants and definitions to use:\n- Shear modulus $\\mu$ in $\\mathrm{Pa}$.\n- Mass density $\\rho$ in $\\mathrm{kg/m^3}$.\n- Shear wave speed $c_s = \\sqrt{\\mu/\\rho}$ in $\\mathrm{m/s}$.\n- Angular frequency $\\omega = 2 \\pi f$ in $\\mathrm{rad/s}$, where $f$ is the frequency in $\\mathrm{Hz}$.\n- Shear wavenumber $k = \\omega / c_s$ in $\\mathrm{rad/m}$.\n- Horizontal wavenumber $k_x = k \\sin\\theta$, with $\\theta$ the incidence angle in degrees (convert to radians for computation).\n- Vertical wavenumber $k_z = \\sqrt{k^2 - k_x^2}$ in $\\mathrm{rad/m}$.\n\nDiscretization and measurement details:\n- Use the reflection index $i_r = \\lfloor H/h \\rfloor - 2$ so that $z_{i_r}$ lies two grid points above the PML interface.\n- Use uniform grid spacing $h = (H+L_p)/N$.\n\nTest suite:\nFor each parameter tuple, the program must compute the minimized reflection ratio $R$ and the associated optimal $(\\sigma_{\\max}, m)$. The parameter tuples are:\n1. Case $1$: Homogeneous halfspace with $\\mu = 4.0 \\times 10^8\\,\\mathrm{Pa}$, $\\rho = 2000\\,\\mathrm{kg/m^3}$, $f = 5\\,\\mathrm{Hz}$, incidence angle $\\theta = 85^\\circ$, physical thickness $H = 300\\,\\mathrm{m}$, PML thickness $L_p = 300\\,\\mathrm{m}$, number of intervals $N = 800$.\n2. Case $2$: Homogeneous halfspace with $\\mu = 4.0 \\times 10^8\\,\\mathrm{Pa}$, $\\rho = 2000\\,\\mathrm{kg/m^3}$, $f = 2\\,\\mathrm{Hz}$, incidence angle $\\theta = 89^\\circ$, physical thickness $H = 300\\,\\mathrm{m}$, PML thickness $L_p = 300\\,\\mathrm{m}$, number of intervals $N = 600$.\n3. Case $3$: Homogeneous halfspace with $\\mu = 6.0 \\times 10^8\\,\\mathrm{Pa}$, $\\rho = 2200\\,\\mathrm{kg/m^3}$, $f = 10\\,\\mathrm{Hz}$, incidence angle $\\theta = 45^\\circ$, physical thickness $H = 300\\,\\mathrm{m}$, PML thickness $L_p = 300\\,\\mathrm{m}$, number of intervals $N = 800$.\n\nPML parameter sweep sets:\n- $\\sigma_{\\max} \\in \\{50, 100, 200, 400, 800, 1200, 1600, 2000\\}\\,\\mathrm{s}^{-1}$.\n- $m \\in \\{2, 3, 4\\}$.\n\nRequired output:\nYour program should produce a single line containing the results as a comma-separated list of triples, one triple per test case. Each triple must contain the minimized reflection ratio $R$ (as a float), the optimal $\\sigma_{\\max}$ (as a float in $\\mathrm{s}^{-1}$), and the optimal $m$ (as an integer). The output must have no spaces and be of the form\n$$\n[\\,[R_1,\\sigma_{\\max,1},m_1],[R_2,\\sigma_{\\max,2},m_2],[R_3,\\sigma_{\\max,3},m_3]\\,].\n$$\nAll quantities in the output are dimensionless except $\\sigma_{\\max}$, which must be reported in $\\mathrm{s}^{-1}$. Angles specified in the test suite are given in degrees but must be converted to radians for computation. The final numerical results must be presented in the exact single-line format described above.",
            "solution": "## Solution\n\nThe problem requires us to find the optimal parameters for a Perfectly Matched Layer (PML) by minimizing the spurious reflections it generates. The physical system is an elastic half-space subjected to incident SH waves. The solution methodology involves discretizing the governing partial differential equation in the frequency domain and solving the resulting linear system.\n\n### Principle-Based Algorithmic Design\n\n1.  **Parameter Computation**: For each test case and each set of PML parameters $(\\sigma_{\\max}, m)$, we first compute the necessary physical and wave parameters.\n    - The material properties are the shear modulus $\\mu$ and density $\\rho$. The shear wave speed is $c_s = \\sqrt{\\mu/\\rho}$.\n    - Given the frequency $f$, the angular frequency is $\\omega = 2 \\pi f$.\n    - The shear wavenumber is $k = \\omega/c_s$.\n    - For an incidence angle $\\theta$, the horizontal wavenumber is $k_x = k \\sin\\theta$. The vertical wavenumber for the physical medium is $k_z = k \\cos\\theta$. We convert the given angle $\\theta$ from degrees to radians for trigonometric calculations.\n\n2.  **Discretization and PML Stretch Function**: The computational domain $[0, H+L_p]$ is discretized into $N$ intervals of uniform size $h = (H+L_p)/N$, resulting in $N+1$ nodes $z_i = i h$. The complex-valued stretch function $s(z)$ is evaluated at each node $z_i$ to obtain nodal values $s_i$. These values are then averaged at a face-centered locations to get $s_{i+\\frac{1}{2}} = (s_i + s_{i+1})/2$ for $i=0, \\dots, N-1$. These values are essential for discretizing the flux term $\\frac{d}{dz}(\\frac{\\mu}{s} \\frac{dU}{dz})$.\n\n3.  **Linear System Formulation**: The finite-difference equation relates the displacement at a node $i$, $U_i$, to its neighbors, $U_{i-1}$ and $U_{i+1}$. By rearranging the terms, we can write the equation for each interior node $i \\in \\{1, \\dots, N-1\\}$ as:\n    $$\n    a_i U_{i-1} + b_i U_i + c_i U_{i+1} = 0\n    $$\n    where the coefficients $a_i, b_i, c_i$ are complex numbers given by:\n    $$\n    a_i = -\\frac{\\mu}{h^2 s_{i-1/2}}\n    $$\n    $$\n    c_i = -\\frac{\\mu}{h^2 s_{i+1/2}}\n    $$\n    $$\n    b_i = \\frac{\\mu}{h^2 s_{i+1/2}} + \\frac{\\mu}{h^2 s_{i-1/2}} - \\mu k_x^2 + \\rho \\omega^2 s_i = -(a_i + c_i) - \\mu k_x^2 + \\rho \\omega^2 s_i\n    $$\n    This forms a system of $N-1$ linear equations for the $N-1$ unknown nodal values $U_1, \\dots, U_{N-1}$. The system can be written in matrix form $\\mathbf{A}\\mathbf{U} = \\mathbf{b}$. The matrix $\\mathbf{A}$ is tridiagonal, with entries corresponding to the coefficients $a_i, b_i, c_i$. The vector $\\mathbf{b}$ arises from the boundary conditions.\n    - At the top boundary, $U_0 = 1$. The equation for $i=1$ is $a_1 U_0 + b_1 U_1 + c_1 U_2 = 0$. Since $U_0$ is known, this becomes $b_1 U_1 + c_1 U_2 = -a_1 U_0 = -a_1$. This contributes a non-zero value to the first element of the vector $\\mathbf{b}$.\n    - At the bottom boundary, $U_N = 0$. The equation for $i=N-1$ is $a_{N-1} U_{N-2} + b_{N-1} U_{N-1} + c_{N-1} U_N = 0$. Since $U_N=0$, this becomes $a_{N-1} U_{N-2} + b_{N-1} U_{N-1} = 0$, contributing a zero to the last element of $\\mathbf{b}$.\n    The resulting system is fully determined and can be solved for the complex-valued displacement vector $\\mathbf{U}$.\n\n4.  **Solving the System**: The complex-valued, tridiagonal linear system $\\mathbf{A}\\mathbf{U}=\\mathbf{b}$ is solved using a standard linear algebra library function, such as `numpy.linalg.solve`. This yields the displacement amplitudes $U_1, \\dots, U_{N-1}$. We then assemble the full solution vector, including the boundary values: $[U_0, U_1, \\dots, U_{N-1}, U_N]$.\n\n5.  **Reflection Ratio Calculation**: To quantify the PML's performance, we calculate the reflection ratio $R$ at a specific point $z_{i_r}$ in the physical domain, just above the PML interface. The index is $i_r = \\lfloor H/h \\rfloor - 2$. The total wavefield $U$ at this location is a superposition of a downgoing (incident-like) wave and an upgoing (reflected-like) wave. These can be separated using the field value $U_{i_r}$ and its spatial derivative, which is approximated by a centered finite difference $D = (U_{i_r+1} - U_{i_r-1}) / (2h)$. The formula for the reflection ratio $R$ is given, which compares the amplitudes of the separated upgoing and downgoing waves.\n    $$\n    R = \\left|\\frac{U_{i_r} - \\dfrac{D}{i k_z}}{U_{i_r} + \\dfrac{D}{i k_z}}\\right|\n    $$\n\n6.  **Parameter Sweep and Optimization**: The entire process, from setting up the linear system to calculating $R$, is repeated for every combination of $\\sigma_{\\max}$ and $m$ from the provided sets. For each test case, we track the minimum reflection ratio found, `min_R`, and the corresponding optimal parameters $(\\sigma_{\\max}, m)_{\\text{opt}}$.\n\n7.  **Output Formatting**: Finally, the results for all test cases—each consisting of the minimized $R$, optimal $\\sigma_{\\max}$, and optimal $m$—are formatted into a single string as specified in the problem statement. The format must be strictly followed, with no extra spaces.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the PML optimization for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: (mu, rho, f, theta_deg, H, Lp, N)\n        (4.0e8, 2000.0, 5.0, 85.0, 300.0, 300.0, 800),\n        # Case 2:\n        (4.0e8, 2000.0, 2.0, 89.0, 300.0, 300.0, 600),\n        # Case 3:\n        (6.0e8, 2200.0, 10.0, 45.0, 300.0, 300.0, 800),\n    ]\n\n    sweep_sigma_max = [50.0, 100.0, 200.0, 400.0, 800.0, 1200.0, 1600.0, 2000.0]\n    sweep_m = [2, 3, 4]\n\n    final_results = []\n\n    for case in test_cases:\n        mu, rho, f, theta_deg, H, Lp, N = case\n        \n        min_R = float('inf')\n        best_params = (None, None)\n\n        for sigma_max in sweep_sigma_max:\n            for m in sweep_m:\n                # Calculate R for the current set of parameters\n                R = calculate_reflection_ratio(mu, rho, f, theta_deg, H, Lp, N, sigma_max, m)\n                \n                # Update if a better result is found\n                if R < min_R:\n                    min_R = R\n                    best_params = (sigma_max, m)\n        \n        final_results.append([min_R, best_params[0], best_params[1]])\n\n    # Format the final output string exactly as required\n    result_strings = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in final_results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef calculate_reflection_ratio(mu, rho, f, theta_deg, H, Lp, N, sigma_max, m):\n    \"\"\"\n    Computes the reflection ratio for a given set of physical and PML parameters.\n    \"\"\"\n    # 1. Parameter Computation\n    cs = np.sqrt(mu / rho)\n    omega = 2.0 * np.pi * f\n    k = omega / cs\n    theta_rad = np.deg2rad(theta_deg)\n    kx = k * np.sin(theta_rad)\n    kz = k * np.cos(theta_rad)\n\n    # 2. Discretization and PML Stretch Function\n    h = (H + Lp) / N\n    z = np.linspace(0, H + Lp, N + 1)\n    \n    s = np.ones_like(z, dtype=np.complex128)\n    pml_indices = z > H # Using > not >= to keep z=H in the physical domain\n    \n    if np.any(pml_indices):\n        z_pml = z[pml_indices]\n        s_pml = 1.0 + 1j * (sigma_max / omega) * ((z_pml - H) / Lp)**m\n        s[pml_indices] = s_pml\n\n    s_half = 0.5 * (s[:-1] + s[1:])\n\n    # 3. Linear System Formulation\n    num_unknowns = N - 1\n    A = np.zeros((num_unknowns, num_unknowns), dtype=np.complex128)\n    b = np.zeros(num_unknowns, dtype=np.complex128)\n    \n    h2 = h**2\n\n    # Loop through interior nodes i = 1, ..., N-1\n    for i in range(1, N):\n        j = i - 1  # Matrix index\n\n        # Coefficients related to the flux term\n        C_imhalf = mu / (h2 * s_half[i-1]) # Coefficient for connection to node i-1\n        C_iphalf = mu / (h2 * s_half[i])   # Coefficient for connection to node i+1\n\n        # Diagonal term of the matrix\n        diag_val = C_imhalf + C_iphalf - mu * kx**2 + rho * omega**2 * s[i]\n        A[j, j] = diag_val\n\n        # Off-diagonal terms\n        if i > 1:\n            A[j, j-1] = -C_imhalf\n        if i < N - 1:\n            A[j, j+1] = -C_iphalf\n    \n    # Right-hand side vector from boundary condition U_0 = 1\n    b[0] = mu / (h2 * s_half[0])\n\n    # 4. Solving the System\n    U_sol = np.linalg.solve(A, b)\n    U = np.concatenate(([1.0+0j], U_sol, [0.0+0j]))\n\n    # 5. Reflection Ratio Calculation\n    ir = int(np.floor(H / h)) - 2\n    \n    # Ensure index is valid\n    if ir < 1 or ir > N - 2:\n        # This case should not happen with the given parameters but is a safeguard.\n        return float('inf')\n\n    # Centered finite difference for the derivative\n    D = (U[ir + 1] - U[ir - 1]) / (2.0 * h)\n    \n    # Denominator in the reflection ratio formula\n    denom_term = D / (1j * kz)\n\n    # Avoid division by zero if U + denom_term is numerically zero\n    if np.abs(U[ir] + denom_term) < 1e-15:\n        return float('inf')\n\n    R = np.abs((U[ir] - denom_term) / (U[ir] + denom_term))\n\n    return R\n\nsolve()\n```"
        }
    ]
}