{
    "hands_on_practices": [
        {
            "introduction": "在连续介质力学中，客观性（或称坐标系无关性）是一项基本原则，它要求材料的本构响应不应依赖于观察者的坐标系。本练习将指导您如何量化一个假设的代理模型对该原则的违反程度，这对于验证任何本构模型的物理真实性至关重要。",
            "id": "3540297",
            "problem": "给定一个代理本构映射，该映射用于从三维小应变张量预测柯西应力张量。目的是通过检查代理模型在正常正交变换下的不变性来评估其客观性（框架无关性）。客观性要求，对于任何正常正交旋转矩阵 $\\mathbf{Q}$（即 $\\mathbf{Q} \\in \\mathbb{R}^{3 \\times 3}$ 且满足 $\\mathbf{Q}^T \\mathbf{Q} = \\mathbf{I}$ 和 $\\det(\\mathbf{Q}) = +1$）以及任何对称小应变张量 $\\boldsymbol{\\varepsilon} \\in \\mathbb{R}^{3 \\times 3}$，本构映射 $\\boldsymbol{\\sigma}(\\cdot)$ 必须满足 $\\boldsymbol{\\sigma}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) = \\mathbf{Q}\\boldsymbol{\\sigma}(\\boldsymbol{\\varepsilon})\\mathbf{Q}^T$。对该恒等式的违背程度量化了客观性的缺失。\n\n待测试的代理模型定义如下。对于任何对称小应变张量 $\\boldsymbol{\\varepsilon}$，\n$$\n\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\n=\n\\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I}\n\\;+\\;\n2 \\mu \\, \\boldsymbol{\\varepsilon}\n\\;+\\;\nb \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A},\n$$\n其中 $\\lambda$ 和 $\\mu$ 是拉梅参数，$\\mathbf{I}$ 是单位张量，$b$ 是一个标量偏置系数，$\\mathbf{A}$ 是一个固定的对称无迹张量，该张量编码了一种与基底相关的建模偏差。该固定张量为\n$$\n\\mathbf{A} = \\mathrm{diag}\\!\\left(\\tfrac{2}{3}, -\\tfrac{1}{3}, -\\tfrac{1}{3}\\right).\n$$\n物理单位和参数如下：\n- 拉梅参数 $\\lambda = 4.0 \\times 10^{10} \\ \\mathrm{Pa}$，\n- 拉梅参数 $\\mu = 3.0 \\times 10^{10} \\ \\mathrm{Pa}$，\n- 偏置系数 $b = 5.0 \\times 10^{8} \\ \\mathrm{Pa}$。\n应变 $\\boldsymbol{\\varepsilon}$ 是无量纲的。应力 $\\boldsymbol{\\sigma}_{\\text{pred}}$ 的单位是 $\\mathrm{Pa}$。\n\n对于任意给定的旋转矩阵 $\\mathbf{Q}$ 和应变张量 $\\boldsymbol{\\varepsilon}$，将客观性违背度量定义为对旋转后的应变预测的应力与旋转后的预测应力之差的弗罗贝尼乌斯范数（Frobenius norm (FN)）：\n$$\nE(\\mathbf{Q}, \\boldsymbol{\\varepsilon}) \\equiv \\left\\| \\boldsymbol{\\sigma}_{\\text{pred}}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) \\;-\\; \\mathbf{Q}\\,\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\\,\\mathbf{Q}^T \\right\\|_F,\n$$\n单位为 $\\mathrm{Pa}$。\n\n你的任务是编写一个程序，为以下测试套件评估 $E(\\mathbf{Q}, \\boldsymbol{\\varepsilon})$。角度以弧度为单位，旋转是围绕 $z$ 轴进行的。围绕 $z$ 轴旋转角度 $\\theta$ 的旋转矩阵为\n$$\n\\mathbf{Q}_z(\\theta) =\n\\begin{bmatrix}\n\\cos(\\theta)  -\\sin(\\theta)  0 \\\\\n\\sin(\\theta)  \\cos(\\theta)  0 \\\\\n0  0  1\n\\end{bmatrix}.\n$$\n测试套件包含五个案例：\n- 案例1（理想情况，单位旋转）：$\\theta = 0$，$\\boldsymbol{\\varepsilon}_1 = \\mathrm{diag}\\!\\left(1.2\\times 10^{-3},\\, -0.3\\times 10^{-3},\\, -0.3\\times 10^{-3}\\right)$。\n- 案例2（非平凡旋转，有体积应变）：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_1 = \\mathrm{diag}\\!\\left(1.2\\times 10^{-3},\\, -0.3\\times 10^{-3},\\, -0.3\\times 10^{-3}\\right)$。\n- 案例3（无迹剪切边缘情况）：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_2$ 的分量为 $(\\boldsymbol{\\varepsilon}_2)_{12} = (\\boldsymbol{\\varepsilon}_2)_{21} = 5.0\\times 10^{-4}$，所有其他分量均为 $0$。\n- 案例4（非平凡旋转下的静水应变）：$\\theta = \\tfrac{\\pi}{3}$，$\\boldsymbol{\\varepsilon}_3 = 1.0\\times 10^{-4} \\, \\mathbf{I}$。\n- 案例5（零应变边界条件）：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_4 = \\mathbf{0}$。\n\n必须按所列顺序评估所有五个案例。你的程序必须：\n- 为指定的 $\\theta$ 构建 $\\mathbf{Q} = \\mathbf{Q}_z(\\theta)$，\n- 构建指定的 $\\boldsymbol{\\varepsilon}$，\n- 使用上面的代理模型 $\\boldsymbol{\\sigma}_{\\text{pred}}$ 计算 $E(\\mathbf{Q}, \\boldsymbol{\\varepsilon})$，\n- 返回五个 $E$ 的值，单位为 $\\mathrm{Pa}$。\n\n以帕斯卡（$\\mathrm{Pa}$）为单位，将最终结果表示为浮点数。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[x1,x2,x3,x4,x5]”），其中每个 $x_i$ 对应于上面所列顺序中案例 $i$ 的 $E$ 值。",
            "solution": "该问题旨在评估连续介质力学中一个代理本构模型的客观性。如果一个本构模型的形式在空间参考系的刚体旋转下保持不变，那么它就是客观的（或称框架无关的）。对于作为小应变张量 $\\boldsymbol{\\varepsilon}$ 函数的柯西应力张量 $\\boldsymbol{\\sigma}$，该原理通过恒等式 $\\boldsymbol{\\sigma}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) = \\mathbf{Q}\\boldsymbol{\\sigma}(\\boldsymbol{\\varepsilon})\\mathbf{Q}^T$ 来正式表达，其中 $\\mathbf{Q}$ 是任意正常正交旋转张量。该问题要求我们为一个特定的代理模型量化对此恒等式的违背程度。\n\n代理模型由下式给出\n$$\n\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon}) = \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} \\;+\\; 2 \\mu \\, \\boldsymbol{\\varepsilon} \\;+\\; b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A}\n$$\n其中 $\\lambda$ 和 $\\mu$ 是拉梅参数，$\\mathbf{I}$ 是单位张量，$b$ 是一个偏置系数，$\\mathbf{A}$ 是一个固定的、与基底相关的对称无迹张量。该模型的标准部分 $\\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} + 2 \\mu \\, \\boldsymbol{\\varepsilon}$ 代表各向同性线弹性，并且已知是客观的。附加项 $b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A}$ 是一个建模偏差，我们将分析其对客观性的影响。\n\n客观性违背的度量定义为差异张量 $\\boldsymbol{\\Delta}$ 的弗罗贝尼乌斯范数：\n$$\nE(\\mathbf{Q}, \\boldsymbol{\\varepsilon}) \\equiv \\| \\boldsymbol{\\Delta} \\|_F = \\left\\| \\boldsymbol{\\sigma}_{\\text{pred}}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) \\;-\\; \\mathbf{Q}\\,\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\\,\\mathbf{Q}^T \\right\\|_F\n$$\n\n让我们为 $\\boldsymbol{\\Delta}$ 推导一个简化表达式。设 $\\boldsymbol{\\varepsilon}' = \\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T$。范数中的第一项是：\n$$\n\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon}') = \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}') \\, \\mathbf{I} \\;+\\; 2 \\mu \\, \\boldsymbol{\\varepsilon}' \\;+\\; b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}') \\, \\mathbf{A}\n$$\n迹算子的一个关键性质是其在循环置换下的不变性，对于正交张量 $\\mathbf{Q}$，这意味着 $\\mathrm{tr}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) = \\mathrm{tr}(\\boldsymbol{\\varepsilon}\\mathbf{Q}^T\\mathbf{Q}) = \\mathrm{tr}(\\boldsymbol{\\varepsilon})$。因此，$\\mathrm{tr}(\\boldsymbol{\\varepsilon}') = \\mathrm{tr}(\\boldsymbol{\\varepsilon})$。代入此式以及 $\\boldsymbol{\\varepsilon}'$ 的定义可得：\n$$\n\\boldsymbol{\\sigma}_{\\text{pred}}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) = \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} \\;+\\; 2 \\mu \\, (\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) \\;+\\; b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A}\n$$\n\n范数中的第二项是：\n$$\n\\mathbf{Q}\\,\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\\,\\mathbf{Q}^T = \\mathbf{Q} \\left( \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} \\;+\\; 2 \\mu \\, \\boldsymbol{\\varepsilon} \\;+\\; b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A} \\right) \\mathbf{Q}^T\n$$\n分配 $\\mathbf{Q}$ 和 $\\mathbf{Q}^T$ 并利用 $\\mathbf{Q}\\mathbf{I}\\mathbf{Q}^T = \\mathbf{I}$ 这一事实，我们得到：\n$$\n\\mathbf{Q}\\,\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\\,\\mathbf{Q}^T = \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} \\;+\\; 2 \\mu \\, (\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) \\;+\\; b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, (\\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T)\n$$\n\n现在，我们计算差异张量 $\\boldsymbol{\\Delta}$：\n$$\n\\boldsymbol{\\Delta} = \\boldsymbol{\\sigma}_{\\text{pred}}(\\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T) - \\mathbf{Q}\\,\\boldsymbol{\\sigma}_{\\text{pred}}(\\boldsymbol{\\varepsilon})\\,\\mathbf{Q}^T\n$$\n$$\n\\boldsymbol{\\Delta} = \\left( \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} + 2 \\mu \\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T + b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{A} \\right) - \\left( \\lambda \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I} + 2 \\mu \\mathbf{Q}\\boldsymbol{\\varepsilon}\\mathbf{Q}^T + b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T \\right)\n$$\n涉及 $\\lambda$ 和 $\\mu$ 的项相互抵消，这对于一个客观的基础模型是符合预期的。剩余的项是：\n$$\n\\boldsymbol{\\Delta} = b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{A} - b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\left( \\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T \\right)\n$$\n客观性违背度量 $E(\\mathbf{Q}, \\boldsymbol{\\varepsilon})$ 是该张量的弗罗贝尼乌斯范数。对于标量 $c$，使用范数性质 $\\|c\\mathbf{M}\\|_F = |c|\\|\\mathbf{M}\\|_F$：\n$$\nE(\\mathbf{Q}, \\boldsymbol{\\varepsilon}) = \\left| b \\, \\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\right| \\left\\| \\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T \\right\\|_F\n$$\n这个简化表达式揭示了，如果 $b=0$，或者应变是等体积的（即 $\\mathrm{tr}(\\boldsymbol{\\varepsilon})=0$），或者旋转 $\\mathbf{Q}$ 与偏置张量 $\\mathbf{A}$ 可交换（即 $\\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = \\mathbf{A}$），则客观性违背为零。\n\n现在我们将此公式应用于五个测试案例，使用给定的参数：$b = 5.0 \\times 10^{8} \\ \\mathrm{Pa}$ 和 $\\mathbf{A} = \\mathrm{diag}(\\tfrac{2}{3}, -\\tfrac{1}{3}, -\\tfrac{1}{3})$。\n\n案例1：$\\theta = 0$，$\\boldsymbol{\\varepsilon}_1 = \\mathrm{diag}(1.2\\times 10^{-3}, -0.3\\times 10^{-3}, -0.3\\times 10^{-3})$。\n对于 $\\theta=0$，旋转矩阵是单位矩阵，$\\mathbf{Q} = \\mathbf{I}$。\n因此，$\\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = \\mathbf{A} - \\mathbf{I}\\mathbf{A}\\mathbf{I}^T = \\mathbf{A} - \\mathbf{A} = \\mathbf{0}$。\n范数为 $0$，因此 $E_1 = 0 \\ \\mathrm{Pa}$。\n\n案例2：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_1 = \\mathrm{diag}(1.2\\times 10^{-3}, -0.3\\times 10^{-3}, -0.3\\times 10^{-3})$。\n首先，$\\mathrm{tr}(\\boldsymbol{\\varepsilon}_1) = (1.2 - 0.3 - 0.3) \\times 10^{-3} = 0.6 \\times 10^{-3}$。\n旋转矩阵是 $$\\mathbf{Q}_z(\\tfrac{\\pi}{2}) = \\begin{bmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{bmatrix}.$$\n我们计算 $\\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = \\mathrm{diag}(-\\tfrac{1}{3}, \\tfrac{2}{3}, -\\tfrac{1}{3})$。\n差值为 $\\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = \\mathrm{diag}(\\tfrac{2}{3}, -\\tfrac{1}{3}, -\\tfrac{1}{3}) - \\mathrm{diag}(-\\tfrac{1}{3}, \\tfrac{2}{3}, -\\tfrac{1}{3}) = \\mathrm{diag}(1, -1, 0)$。\n弗罗贝尼乌斯范数是 $\\| \\mathrm{diag}(1, -1, 0) \\|_F = \\sqrt{1^2 + (-1)^2 + 0^2} = \\sqrt{2}$。\n$E_2 = |5.0 \\times 10^8| \\times |0.6 \\times 10^{-3}| \\times \\sqrt{2} = 3.0 \\times 10^5 \\times \\sqrt{2} \\approx 424264.0687 \\ \\mathrm{Pa}$。\n\n案例3：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_2$ 的非零分量为 $(\\boldsymbol{\\varepsilon}_2)_{12} = (\\boldsymbol{\\varepsilon}_2)_{21} = 5.0\\times 10^{-4}$。\n迹为 $\\mathrm{tr}(\\boldsymbol{\\varepsilon}_2) = 0$。\n因为 $\\mathrm{tr}(\\boldsymbol{\\varepsilon}_2) = 0$，根据公式直接得出客观性违背 $E_3 = 0 \\ \\mathrm{Pa}$。\n\n案例4：$\\theta = \\tfrac{\\pi}{3}$，$\\boldsymbol{\\varepsilon}_3 = 1.0\\times 10^{-4} \\, \\mathbf{I}$。\n应变为静水应变。$\\mathrm{tr}(\\boldsymbol{\\varepsilon}_3) = \\mathrm{tr}(1.0\\times 10^{-4} \\, \\mathbf{I}) = 1.0\\times 10^{-4} \\times 3 = 3.0 \\times 10^{-4}$。\n旋转是 $\\mathbf{Q}_z(\\tfrac{\\pi}{3})$。令 $c=\\cos(\\tfrac{\\pi}{3}) = \\tfrac{1}{2}$ 且 $s=\\sin(\\tfrac{\\pi}{3}) = \\tfrac{\\sqrt{3}}{2}$。\n差异张量是 $$\\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = (a_1-a_2) \\begin{bmatrix} s^2  -cs  0 \\\\ -cs  -s^2  0 \\\\ 0  0  0 \\end{bmatrix},$$ 其中 $a_1=\\tfrac{2}{3}, a_2=-\\tfrac{1}{3}$。\n$a_1 - a_2 = 1$。所以，$$\\mathbf{A} - \\mathbf{Q}\\mathbf{A}\\mathbf{Q}^T = \\begin{bmatrix} 3/4  -\\sqrt{3}/4  0 \\\\ -\\sqrt{3}/4  -3/4  0 \\\\ 0  0  0 \\end{bmatrix}.$$\n弗罗贝尼乌斯范数的平方是 $\\| \\cdot \\|_F^2 = (\\tfrac{3}{4})^2 + (-\\tfrac{\\sqrt{3}}{4})^2 + (-\\tfrac{\\sqrt{3}}{4})^2 + (-\\tfrac{3}{4})^2 = \\tfrac{9}{16} + \\tfrac{3}{16} + \\tfrac{3}{16} + \\tfrac{9}{16} = \\tfrac{24}{16} = \\tfrac{3}{2}$。\n范数是 $\\sqrt{\\tfrac{3}{2}}$。\n$E_4 = |5.0 \\times 10^8| \\times |3.0 \\times 10^{-4}| \\times \\sqrt{\\tfrac{3}{2}} = 1.5 \\times 10^5 \\times \\sqrt{1.5} \\approx 183711.7307 \\ \\mathrm{Pa}$。\n\n案例5：$\\theta = \\tfrac{\\pi}{2}$，$\\boldsymbol{\\varepsilon}_4 = \\mathbf{0}$。\n应变张量是零张量。$\\mathrm{tr}(\\boldsymbol{\\varepsilon}_4) = 0$。\n因此，客观性违背 $E_5 = 0 \\ \\mathrm{Pa}$。\n\n下面的程序将实现这些计算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the objectivity violation measure E(Q, ε) for five test cases.\n    \"\"\"\n    # Define physical and model parameters\n    B_COEFF = 5.0e8  # Bias coefficient b in Pa\n\n    # Define the fixed symmetric traceless tensor A\n    A = np.diag([2/3, -1/3, -1/3])\n\n    # Define the test suite\n    test_cases = [\n        # Case 1: Identity rotation\n        {\n            'theta': 0.0,\n            'epsilon': np.diag([1.2e-3, -0.3e-3, -0.3e-3])\n        },\n        # Case 2: Nontrivial rotation, volumetric strain\n        {\n            'theta': np.pi / 2,\n            'epsilon': np.diag([1.2e-3, -0.3e-3, -0.3e-3])\n        },\n        # Case 3: Trace-free shear\n        {\n            'theta': np.pi / 2,\n            'epsilon': np.array([[0, 5.0e-4, 0], [5.0e-4, 0, 0], [0, 0, 0]])\n        },\n        # Case 4: Hydrostatic strain\n        {\n            'theta': np.pi / 3,\n            'epsilon': 1.0e-4 * np.identity(3)\n        },\n        # Case 5: Zero strain\n        {\n            'theta': np.pi / 2,\n            'epsilon': np.zeros((3, 3))\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        theta = case['theta']\n        epsilon = case['epsilon']\n\n        # Calculate trace of the strain tensor\n        tr_eps = np.trace(epsilon)\n\n        # The objectivity violation is zero if tr(ε) is zero.\n        if np.isclose(tr_eps, 0):\n            E = 0.0\n            results.append(E)\n            continue\n\n        # Construct the rotation matrix Q for rotation about the z-axis\n        c, s = np.cos(theta), np.sin(theta)\n        Q = np.array([[c, -s, 0], \n                      [s,  c, 0], \n                      [0,  0, 1]])\n\n        # Calculate the difference tensor A - Q A Q^T\n        QAQT = Q @ A @ Q.T\n        diff_tensor = A - QAQT\n\n        # Calculate the Frobenius norm of the difference tensor\n        norm_diff = np.linalg.norm(diff_tensor, 'fro')\n\n        # Calculate the objectivity violation measure E\n        E = abs(B_COEFF * tr_eps) * norm_diff\n        results.append(E)\n\n    # Format and print the final results\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "热力学第二定律要求系统的内能耗散必须是非负的，这是任何物理过程都必须遵守的铁律。然而，一个纯粹由数据驱动的代理模型可能在预测中无意间违反此定律，导致产生“无中生有”的能量。本练习  旨在演示如何识别这种违反热力学一致性的情况，并引入一种正则化惩罚项，以便在模型训练阶段引导其学习物理上合理的耗散行为。",
            "id": "3540257",
            "problem": "给定一个适用于计算岩土力学的一维、等温、小应变热力学设定，其中机械耗散受克劳修斯-杜亨不等式约束。其基本依据是克劳修斯-杜亨不等式，该不等式规定机械耗散必须为非负，表示为 $$D \\ge 0 .$$ 在一维空间和小应变条件下，机械耗散为 $$D = \\sigma \\dot{\\epsilon} - \\dot{\\Psi} ,$$ 其中 $\\sigma$ 是柯西应力（单位：帕斯卡），$\\epsilon$ 是应变（无量纲），$\\dot{\\epsilon}$ 是应变率（单位：$\\text{s}^{-1}$），$\\Psi$ 是亥姆霍兹自由能密度（单位：帕斯卡，因为单位体积能量为 $\\text{J}/\\text{m}^3 = \\text{Pa}$）。根据链式法则，$$\\dot{\\Psi} = \\frac{\\partial \\Psi}{\\partial \\epsilon}\\dot{\\epsilon} + \\frac{\\partial \\Psi}{\\partial q}\\dot{q} ,$$ 其中 $q$ 是一个标量内变量（无量纲），$\\dot{q}$ 是其变化率（单位：$\\text{s}^{-1}$）。因此，耗散可简化为 $$D = (\\sigma - \\frac{\\partial \\Psi}{\\partial \\epsilon})\\dot{\\epsilon} - \\frac{\\partial \\Psi}{\\partial q}\\dot{q} .$$\n\n考虑使用机器学习代理模型，这些模型独立地预测应力和自由能形貌，这可能违反 $D \\ge 0$。在这个一维代理模型设定中，定义\n- 代理应力为 $$\\hat{\\sigma}(\\epsilon,q) = s_1 \\epsilon + s_2 q + s_3 \\epsilon^3,$$\n- 代理自由能为 $$\\hat{\\Psi}(\\epsilon,q) = \\tfrac{1}{2} a \\epsilon^2 + \\tfrac{1}{2} b q^2 + c \\epsilon q,$$\n因此 $$\\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}(\\epsilon,q) = a \\epsilon + c q, \\quad \\frac{\\partial \\hat{\\Psi}}{\\partial q}(\\epsilon,q) = b q + c \\epsilon.$$\n对于内变量动力学，使用线性代理演化定律 $$\\dot{q} = h_1 \\hat{\\sigma} + h_2 \\epsilon + h_3 q,$$ 其中 $h_1$ 的单位为 $\\text{s}^{-1}\\text{Pa}^{-1}$，$h_2$ 和 $h_3$ 的单位为 $\\text{s}^{-1}$。\n\n由代理模型产生的机械耗散为 $$D(\\epsilon,q,\\dot{\\epsilon}) = \\hat{\\sigma}(\\epsilon,q)\\,\\dot{\\epsilon} - \\left( \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}(\\epsilon,q)\\,\\dot{\\epsilon} + \\frac{\\partial \\hat{\\Psi}}{\\partial q}(\\epsilon,q)\\,\\dot{q} \\right) .$$\n\n您的任务是：\n1. 计算一个反例，其中无约束的代理模型违反了非负耗散要求 $D \\ge 0$，方法是在一个固定的、有限的训练状态和速率批次上评估 $D$，并检测是否有任何样本产生 $D  0$。\n2. 设计并评估一个正则化项，用于在训练过程中惩罚负耗散。将正则化定义为应用于一个小批次的 Hinge 平方惩罚，$$\\mathcal{R} = \\alpha \\, \\text{mean}\\left( \\max(0, -D)^2 \\right) ,$$ 其中 $\\alpha$ 是一个无量纲权重，$\\text{mean}(\\cdot)$ 是批次上的算术平均值。当所有耗散值均为非负时，此惩罚必须为零；当任何耗散为负时，此惩罚必须严格为正。\n\n使用以下固定的状态和速率训练批次：\n- 应变样本 $$\\epsilon \\in \\{-0.01,\\, 0.0,\\, 0.01\\}$$（无量纲），\n- 内变量样本 $$q \\in \\{0.0,\\, 0.02\\}$$（无量纲），\n- 应变率样本 $$\\dot{\\epsilon} \\in \\{-10^{-5},\\, 10^{-5}\\}$$（单位：$\\text{s}^{-1}$）。\n\n评估三个测试用例（参数集），每个用例的惩罚权重为 $\\alpha = 1.0$：\n- 用例 A（能量一致性应力和耗散流）：选择 $$a = 50\\times 10^6\\,\\text{Pa}, \\quad b = 20\\times 10^6\\,\\text{Pa}, \\quad c = 10\\times 10^6\\,\\text{Pa},$$ 强制 $$s_1 = a,\\quad s_2 = c,\\quad s_3 = 0,$$ 并选择一个正迁移率 $$L = 2\\times 10^{-9}\\,\\text{Pa}^{-1}\\text{s}^{-1}$$，其中 $$h_1 = 0,\\quad h_2 = -L\\,c,\\quad h_3 = -L\\,b.$$ 这是一个物理上一致的配置，预期会满足 $$D \\ge 0 .$$\n- 用例 B（零迁移率的边界情况）：使用与用例 A 相同的 $a$、$b$、$c$、$s_1$、$s_2$、$s_3$，但设置 $$h_1 = 0,\\quad h_2 = 0,\\quad h_3 = 0.$$ 这对应于冻结的内变量，当 $\\hat{\\sigma} = \\partial \\hat{\\Psi}/\\partial \\epsilon$ 时，有 $$D = 0 .$$\n- 用例 C（具有反向流的无约束代理模型）：使用 $$a = 50\\times 10^6\\,\\text{Pa}, \\quad b = 20\\times 10^6\\,\\text{Pa}, \\quad c = 10\\times 10^6\\,\\text{Pa},$$ 设置代理应力参数 $$s_1 = a,\\quad s_2 = -c,\\quad s_3 = 20\\times 10^6\\,\\text{Pa},$$ 并选择一个正迁移率 $$M = 2\\times 10^{-9}\\,\\text{Pa}^{-1}\\text{s}^{-1}$$，其中 $$h_1 = 0,\\quad h_2 = M\\,c,\\quad h_3 = M\\,b.$$ 此配置将内变量流的符号相对于自由能的负梯度进行了反转，预期会在某些状态下产生耗散违规 $$D  0 .$$\n\n对于每个用例，在整个训练批次上计算：\n- 指示是否有任何样本产生 $D  0$ 的布尔违规标志。\n- 如上定义的 Hinge 平方正则化值 $$\\mathcal{R}$$。\n- 批次上的最小耗散值 $$\\min D$$。\n\n物理单位：\n- 以 $\\text{Pa}/\\text{s}$ 报告耗散值 $$D$$，\n- 以 $\\text{Pa}^2/\\text{s}^2$ 报告正则化值 $$\\mathcal{R}$$，\n- 以布尔值报告违规标志。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是 $$[\\text{violation},\\, \\mathcal{R},\\, \\min D]$$ 形式的列表，因此总输出为 $$[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]].$$\n\n测试套件覆盖范围：\n- 用例 A 检验了物理上一致且耗散严格非负的“理想路径”。\n- 用例 B 是一个边界情况，其中整个批次的耗散应为零。\n- 用例 C 是一个故意违反耗散约束的边缘情况反例，要求惩罚项严格为正。\n\n您的实现必须使用上述公式为指定的批次和参数集计算 $$D$$ 和 $$\\mathcal{R}$$，并且必须以所描述的精确格式输出聚合结果。",
            "solution": "该问题要求对一个一维热力学系统进行机械耗散 $D$ 的评估，该系统由应力、自由能和内变量动力学的代理模型描述。核心任务是验证这些代理模型是否遵守热力学第二定律，在该等温、小应变背景下，这表现为克劳修斯-杜亨不等式 $D \\ge 0$。我们将为一批离散状态 $(\\epsilon, q)$ 和速率 $(\\dot{\\epsilon})$ 计算 $D$，识别对此物理约束的违规情况，并使用一个适合训练机器学习模型的惩罚函数来量化该违规。\n\n机械耗散 $D$ 由以下公式给出：\n$$D = \\sigma \\dot{\\epsilon} - \\dot{\\Psi}$$\n其中 $\\sigma$ 是柯西应力，$\\dot{\\epsilon}$ 是应变率，$\\dot{\\Psi}$ 是亥姆霍兹自由能密度 $\\Psi$ 的材料时间导数。对 $\\Psi(\\epsilon, q)$ 使用链式法则，其中 $\\epsilon$ 是应变，$q$ 是内变量，我们得到：\n$$\\dot{\\Psi} = \\frac{\\partial \\Psi}{\\partial \\epsilon}\\dot{\\epsilon} + \\frac{\\partial \\Psi}{\\partial q}\\dot{q}$$\n将此代入耗散表达式，得到：\n$$D = (\\sigma - \\frac{\\partial \\Psi}{\\partial \\epsilon})\\dot{\\epsilon} - \\frac{\\partial \\Psi}{\\partial q}\\dot{q}$$\n这种形式巧妙地将耗散分为两部分：一部分与应变率 $\\dot{\\epsilon}$ 相关，另一部分与内变量的变化率 $\\dot{q}$ 相关。项 $(\\sigma - \\frac{\\partial \\Psi}{\\partial \\epsilon})$ 代表应力的耗散部分。\n\n问题定义了代理模型，包括代理应力 $\\hat{\\sigma}$、代理自由能 $\\hat{\\Psi}$ 以及内变量的演化定律 $\\dot{q}$。我们将这些代理模型代入耗散公式：\n$$D(\\epsilon,q,\\dot{\\epsilon}) = (\\hat{\\sigma}(\\epsilon,q) - \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}(\\epsilon,q))\\dot{\\epsilon} - \\frac{\\partial \\hat{\\Psi}}{\\partial q}(\\epsilon,q)\\dot{q}(\\epsilon,q)$$\n代理模型的具体形式为：\n- 代理应力：$\\hat{\\sigma}(\\epsilon,q) = s_1 \\epsilon + s_2 q + s_3 \\epsilon^3$\n- 代理自由能偏导数：\n  - $\\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}(\\epsilon,q) = a \\epsilon + c q$\n  - $\\frac{\\partial \\hat{\\Psi}}{\\partial q}(\\epsilon,q) = b q + c \\epsilon$\n- 代理内变量演化：$\\dot{q}(\\epsilon,q) = h_1 \\hat{\\sigma}(\\epsilon,q) + h_2 \\epsilon + h_3 q$\n\n我们的计算过程如下。我们首先通过取所提供样本集的笛卡尔积来构建训练批次：$\\epsilon \\in \\{-0.01, 0.0, 0.01\\}$，$q \\in \\{0.0, 0.02\\}$，以及 $\\dot{\\epsilon} \\in \\{-10^{-5}, 10^{-5}\\}$。这会产生一个包含 $3 \\times 2 \\times 2 = 12$ 个 $(\\epsilon, q, \\dot{\\epsilon})$ 数据点的批次。\n\n对于三个测试用例（A、B 和 C）中的每一个，我们设置特定的材料和代理参数。然后，对于批次中的 12 个点中的每一个，我们执行以下计算：\n1.  在状态 $(\\epsilon, q)$ 下计算代理应力 $\\hat{\\sigma}$。\n2.  在状态 $(\\epsilon, q)$ 下计算内变量的变化率 $\\dot{q}$，这取决于计算出的 $\\hat{\\sigma}$。\n3.  在状态 $(\\epsilon, q)$ 下计算代理自由能的偏导数 $\\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}$ 和 $\\frac{\\partial \\hat{\\Psi}}{\\partial q}$。\n4.  组合这些量，使用上述完整表达式计算耗散 $D$。\n\n在计算出给定用例的 12 个耗散值 $\\{D_i\\}$ 后，我们确定所需的输出：\n- **违规标志**：一个布尔值，如果批次中存在任何 $D_i  0$，则为 `True`，否则为 `False`。\n- **最小耗散**：批次中 $D_i$ 的最小值，$\\min(\\{D_i\\})$。\n- **正则化值 $\\mathcal{R}$**：Hinge 平方惩罚，计算公式为 $\\mathcal{R} = \\alpha \\, \\text{mean}(\\max(0, -D_i)^2)$，惩罚权重 $\\alpha=1.0$。如果所有 $D_i \\ge 0$，此项为零；如果任何 $D_i  0$，则此项严格为正。\n\n让我们基于热力学一致性原则来分析这三个用例：\n\n**用例 A：能量一致性应力和耗散流。**\n在这里，代理应力参数的设置使得 $\\hat{\\sigma} = a\\epsilon + c q = \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}$（因为 $s_1=a$, $s_2=c$, $s_3=0$）。这强制要求应力从自由能势导出，这是弹性行为的标准假设。耗散表达式简化为 $D = - \\frac{\\partial \\hat{\\Psi}}{\\partial q}\\dot{q}$。内变量演化由 $\\dot{q} = -L(c\\epsilon + bq) = -L\\frac{\\partial \\hat{\\Psi}}{\\partial q}$ 给出，这是一个标准的线性流动法则，其速率与热力学驱动力 $\\frac{\\partial \\hat{\\Psi}}{\\partial q}$ 成正比。将此代入简化的耗散表达式，得到 $D = - \\frac{\\partial \\hat{\\Psi}}{\\partial q} (-L \\frac{\\partial \\hat{\\Psi}}{\\partial q}) = L (\\frac{\\partial \\hat{\\Psi}}{\\partial q})^2$。由于迁移率 $L > 0$，耗散 $D$ 保证为非负，$D \\ge 0$。我们预期不会有违规情况。\n\n**用例 B：零迁移率的边界情况。**\n此用例保持了能量一致性应力 $\\hat{\\sigma} = \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon}$，因此 $D$ 中的第一项为零。然而，通过将 $h_1, h_2, h_3$ 设置为 $0$，内变量动力学被冻结，这意味着 $\\dot{q}=0$。因此，对于所有状态，耗散为 $D = (0)\\dot{\\epsilon} - \\frac{\\partial \\hat{\\Psi}}{\\partial q}(0) = 0$。这代表了纯弹性（非耗散）响应。我们预期不会有违规情况，且最小耗散恰好为 $0$。\n\n**用例 C：具有反向流的无约束代理模型。**\n在此用例中，$\\hat{\\sigma}$ 的代理参数与 $\\hat{\\Psi}$ 的导数不对应（因为 $s_2 = -c \\neq c$ 且 $s_3 \\neq 0$）。这引入了一个耗散应力项 $(\\hat{\\sigma} - \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon})\\dot{\\epsilon}$。此外，内变量动力学设置为 $\\dot{q} = M(c\\epsilon + bq) = M\\frac{\\partial \\hat{\\Psi}}{\\partial q}$。这代表了一种“上坡”流，即内变量沿着热力学驱动力的方向演化，而不是逆着它。耗散变为 $D = (\\hat{\\sigma} - \\frac{\\partial \\hat{\\Psi}}{\\partial \\epsilon})\\dot{\\epsilon} - M(\\frac{\\partial \\hat{\\Psi}}{\\partial q})^2$。由于 $M>0$，第二项总为非正。第一项则可能为正或为负，具体取决于状态和应变率。此配置是特意设计来违反耗散不等式的，我们预期会找到 $D  0$ 的状态，从而产生一个正的正则化惩罚 $\\mathcal{R}$。\n\n现在，实现将继续为每个用例数值计算这些量。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes dissipation violations and penalties for three test cases\n    of a thermomechanical surrogate model in geomechanics.\n    \"\"\"\n\n    # Define the training batch\n    epsilon_samples = np.array([-0.01, 0.0, 0.01])\n    q_samples = np.array([0.0, 0.02])\n    epsilon_dot_samples = np.array([-1e-5, 1e-5])\n\n    # Create the full batch using meshgrid for vectorized computation\n    eps, q, eps_dot = np.meshgrid(epsilon_samples, q_samples, epsilon_dot_samples, indexing='ij')\n    \n    # Flatten arrays for batch processing\n    batch_size = eps.size\n    eps_flat = eps.flatten()\n    q_flat = q.flatten()\n    eps_dot_flat = eps_dot.flatten()\n\n    # Define parameters for the three test cases\n    cases = {\n        \"A\": {\n            'a': 50e6, 'b': 20e6, 'c': 10e6,\n            's1': 50e6, 's2': 10e6, 's3': 0.0,\n            'h1': 0.0,\n            'h2': -(2e-9) * 10e6,  # -L*c\n            'h3': -(2e-9) * 20e6,  # -L*b\n        },\n        \"B\": {\n            'a': 50e6, 'b': 20e6, 'c': 10e6,\n            's1': 50e6, 's2': 10e6, 's3': 0.0,\n            'h1': 0.0, 'h2': 0.0, 'h3': 0.0,\n        },\n        \"C\": {\n            'a': 50e6, 'b': 20e6, 'c': 10e6,\n            's1': 50e6, 's2': -10e6, 's3': 20e6,\n            'h1': 0.0,\n            'h2': (2e-9) * 10e6,   # M*c\n            'h3': (2e-9) * 20e6,   # M*b\n        }\n    }\n\n    all_results = []\n    \n    # Penalty weight\n    alpha = 1.0\n\n    for case_name in [\"A\", \"B\", \"C\"]:\n        params = cases[case_name]\n        \n        a, b, c = params['a'], params['b'], params['c']\n        s1, s2, s3 = params['s1'], params['s2'], params['s3']\n        h1, h2, h3 = params['h1'], params['h2'], params['h3']\n        \n        # --- Vectorized computations over the batch ---\n        \n        # 1. Surrogate stress\n        sigma_hat = s1 * eps_flat + s2 * q_flat + s3 * eps_flat**3\n        \n        # 2. Surrogate internal variable evolution\n        q_dot = h1 * sigma_hat + h2 * eps_flat + h3 * q_flat\n        \n        # 3. Surrogate free energy derivatives\n        dPsi_de = a * eps_flat + c * q_flat\n        dPsi_dq = b * q_flat + c * eps_flat\n        \n        # 4. Mechanical dissipation\n        D = (sigma_hat - dPsi_de) * eps_dot_flat - dPsi_dq * q_dot\n        \n        # --- Compute required metrics ---\n        \n        # Violation flag\n        violation = np.any(D  0)\n        \n        # Minimum dissipation\n        min_D = np.min(D)\n        \n        # Hinge-squared regularization\n        negative_D = -D\n        penalty_per_sample = np.maximum(0, negative_D)**2\n        R = alpha * np.mean(penalty_per_sample)\n        \n        # Store results for the current case\n        # The problem asks for boolean violation, R, and min_D\n        # Python's default str(bool) gives 'True'/'False' which is acceptable.\n        all_results.append([violation, R, min_D])\n\n    # Format the final output string as per requirements\n    case_strings = []\n    for res in all_results:\n        # res is [bool, float, float]\n        # Manually format to avoid spaces and ensure correctness\n        case_strings.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "岩土力学中的许多状态变量（如孔隙度 $\\phi$ 和饱和度 $S$）在物理上被限制在特定范围内，例如 $[0, 1]$。一个未经约束的代理模型在进行状态更新时，其预测结果可能会超出这些物理边界，从而产生无意义的数值。本实践  将引导您实现一种有效且常用的技术——投影法，以确保模型在每次更新后都能强制满足这些硬性约束，从而保证其预测的物理现实性。",
            "id": "3540293",
            "problem": "考虑在计算岩土力学中，为水力-力学状态更新设计一个机器学习 (ML) 代理模型。状态变量为孔隙度 $\\phi$ 和液体饱和度 $S$，两者均为无量纲分数，受不变边界 $0 \\leq \\phi \\leq 1$ 和 $0 \\leq S \\leq 1$ 的约束。该代理模型接收一个归一化特征向量 $x = [p, \\dot{\\gamma}, p_c]$ 作为输入，其中 $p$ 是归一化有效平均应力，$\\dot{\\gamma}$ 是归一化剪切应变率，$p_c$ 是归一化毛细管压力。所有特征都经过无量纲化处理，使其值落在 $[0,1]$ 区间内，因此不带物理单位。该代理模型产生一个增量 $\\Delta y = [\\Delta \\phi, \\Delta S]$，用于更新状态 $y = [\\phi, S]$。目标是确保代理模型在每次更新后，通过一个有数学原理支持的投影方法，遵守箱式约束 $\\phi \\in [0,1]$ 和 $S \\in [0,1]$。\n\n从以下适合上下文的基本依据和核心定义出发：\n- 孔隙度 $\\phi$ 是空隙体积与总体积之比，由于体积的非负性和分数的定义，其取值被约束在 $0 \\leq \\phi \\leq 1$。\n- 饱和度 $S$ 是孔隙体积中被液相占据的比例，同样遵守 $0 \\leq S \\leq 1$。\n- 状态通过增量进行更新，即 $y^{(t+1)} = y^{(t)} + \\Delta y^{(t)}$。\n- 将点 $z$ 投影到闭凸集 $\\mathcal{C}$ 上的欧几里得投影 $\\Pi_{\\mathcal{C}}(z)$ 定义为平方欧几里得距离的唯一最小化子，即 $\\Pi_{\\mathcal{C}}(z) = \\arg\\min_{u \\in \\mathcal{C}} \\|u - z\\|_2^2$。对于箱型区域 $\\mathcal{B} = [0,1]^2$，此投影简化为逐分量截断。\n\n你的任务是根据以下规范，实现一个完整的机器学习代理模型和投影机制：\n1. 代理模型类。实现一个线性代理模型 $\\Delta y = W x + b$，其参数为 $W \\in \\mathbb{R}^{2 \\times 3}$ 和 $b \\in \\mathbb{R}^2$。在一个确定性的训练集上，通过普通最小二乘法训练 $W$ 和 $b$，以匹配一个合成的、物理一致的增量生成器 $\\Delta y_{\\text{phys}}(x)$。使用固定的训练网格以确保结果可复现。该合成生成器由以下系数定义：\n   - $\\alpha = 0.12$, $\\beta = 0.06$, $\\sigma = 0.08$, $\\eta = 0.25$, $\\rho = 0.03$, $\\lambda = 0.05$ 和参考毛细管压力 $p_{c,\\text{ref}} = 0.4$。\n   - 物理一致的增量为：\n     $$\\Delta \\phi_{\\text{phys}}(x) = -\\alpha\\, p + \\beta\\, \\dot{\\gamma} - \\sigma\\, (p_c - p_{c,\\text{ref}}),$$\n     $$\\Delta S_{\\text{phys}}(x) = -\\eta\\, (p_c - p_{c,\\text{ref}}) - \\lambda\\, p + \\rho\\, \\dot{\\gamma}.$$\n   在笛卡尔网格上构建训练集，其中 $p \\in \\{0, 0.25, 0.5, 0.75, 1\\}$，$\\dot{\\gamma} \\in \\{0, 0.5, 1\\}$，$p_c \\in \\{0, 0.3, 0.6, 0.9\\}$，因此训练样本总数为 $5 \\times 3 \\times 4 = 60$（所有数值均为无量纲小数）。拟合 $W$ 和 $b$ 以最小化代理模型增量与 $\\Delta y_{\\text{phys}}(x)$ 之间的均方误差。\n\n2. 投影步骤。实现到箱型区域 $\\mathcal{B} = [0,1]^2$ 上的欧几里得投影。在计算出 $y^{(t+1)}_{\\text{raw}} = y^{(t)} + \\Delta y^{(t)}$ 后，通过以下方式强制执行不变性：\n   $$y^{(t+1)} = \\Pi_{\\mathcal{B}}(y^{(t+1)}_{\\text{raw}}),$$\n   对于箱型区域，这简化为逐分量裁剪：\n   $$\\phi^{(t+1)} = \\min\\{\\max\\{\\phi^{(t+1)}_{\\text{raw}}, 0\\}, 1\\}, \\quad S^{(t+1)} = \\min\\{\\max\\{S^{(t+1)}_{\\text{raw}}, 0\\}, 1\\} .$$\n\n3. 时间步进。对每个测试用例，使用一个恒定的输入 $x$ 模拟 $T=5$ 步更新。在每一步中，计算代理模型增量并应用投影步骤，然后再进行下一步。\n\n4. 测试套件。使用以下四个测试用例，每个用例都由一个初始状态和一个恒定输入 $x$ 指定：\n   - 用例1（理想路径）：初始状态 $[\\phi_0, S_0] = [0.25, 0.80]$，输入 $x = [p, \\dot{\\gamma}, p_c] = [0.5, 0.1, 0.6]$。\n   - 用例2（上边界边缘情况）：初始状态 $[\\phi_0, S_0] = [0.98, 0.95]$，输入 $x = [0.2, 0.5, 0.3]$。\n   - 用例3（下边界边缘情况）：初始状态 $[\\phi_0, S_0] = [0.02, 0.05]$，输入 $x = [0.8, 0.0, 0.9]$。\n   - 用例4（大更新压力测试）：初始状态 $[\\phi_0, S_0] = [0.50, 0.50]$，输入 $x = [0.9, 0.9, 0.9]$。\n   所有值都是在 $[0,1]$ 区间内的无量纲分数。\n\n5. 输出规范。你的程序应生成单行输出，其中包含所有用例的最终状态，展平并以逗号分隔，用方括号括起来，格式为小数。具体来说，打印\n   $$[\\phi_1, S_1, \\phi_2, S_2, \\phi_3, S_3, \\phi_4, S_4],$$\n   其中 $[\\phi_i, S_i]$ 是用例 $i$ 经过 $T = 5$ 次更新后的最终投影状态。将每个打印的数字四舍五入到6位小数。\n\n你的实现必须是一个完整、可运行的程序，能够训练代理模型，在每次更新后应用投影，运行测试套件，并按指定格式打印最终结果。不允许使用外部数据、用户输入或网络访问。",
            "solution": "该问题要求在计算岩土力学背景下，设计、训练和应用一个线性机器学习代理模型，用于更新水力-力学状态变量 $(\\phi, S)$。该代理模型必须在每个更新步骤后通过应用欧几里得投影来遵守物理箱式约束 $\\phi \\in [0,1]$ 和 $S \\in [0,1]$。\n\n解决方案主要分三个阶段进行开发：\n1.  使用普通最小二乘法 (OLS) 训练线性代理模型。\n2.  实现时间步进模拟循环，包括计算状态增量和应用约束投影。\n3.  对指定的测试用例执行模拟并格式化输出。\n\n### 步骤1：代理模型训练\n\n代理模型是一个线性函数，它将输入特征向量 $x = [p, \\dot{\\gamma}, p_c]$ 映射到状态增量向量 $\\Delta y = [\\Delta \\phi, \\Delta S]$。该模型定义为：\n$$\n\\Delta y = W x + b\n$$\n其中 $W \\in \\mathbb{R}^{2 \\times 3}$ 是权重矩阵，$b \\in \\mathbb{R}^2$ 是偏置向量。为了确定参数 $W$ 和 $b$，我们对一个合成数据生成器进行回归分析。\n\n首先，构建一个确定性训练集。输入特征在笛卡尔网格上采样：\n-   $p \\in \\{0, 0.25, 0.5, 0.75, 1\\}$（$5$个值）\n-   $\\dot{\\gamma} \\in \\{0, 0.5, 1\\}$（$3$个值）\n-   $p_c \\in \\{0, 0.3, 0.6, 0.9\\}$（$4$个值）\n\n这总共产生 $N = 5 \\times 3 \\times 4 = 60$ 个训练样本。这些样本构成了训练数据矩阵 $X_{\\text{train}} \\in \\mathbb{R}^{60 \\times 3}$。\n\n对于 $X_{\\text{train}}$ 中的每个输入向量 $x_i$，使用提供的物理一致性生成器计算相应的“真实”增量 $\\Delta y_{\\text{phys}, i}$：\n$$\n\\Delta \\phi_{\\text{phys}}(x) = -\\alpha\\, p + \\beta\\, \\dot{\\gamma} - \\sigma\\, (p_c - p_{c,\\text{ref}})\n$$\n$$\n\\Delta S_{\\text{phys}}(x) = -\\eta\\, (p_c - p_{c,\\text{ref}}) - \\lambda\\, p + \\rho\\, \\dot{\\gamma}\n$$\n使用的常数为 $\\alpha = 0.12$, $\\beta = 0.06$, $\\sigma = 0.08$, $\\eta = 0.25$, $\\rho = 0.03$, $\\lambda = 0.05$, 以及 $p_{c,\\text{ref}} = 0.4$。这些目标增量构成了训练目标矩阵 $Y_{\\text{train}} \\in \\mathbb{R}^{60 \\times 2}$。\n\nOLS问题是找到 $W$ 和 $b$ 以最小化平方误差和 $\\| (X_{\\text{train}} W^T + \\mathbf{1}b^T) - Y_{\\text{train}} \\|_F^2$，其中 $\\mathbf{1}$ 是一个元素全为1的列向量。这是一个标准的线性回归问题。为了高效求解，我们通过在特征矩阵 $X_{\\text{train}}$ 上增加一列1来创建设计矩阵 $A \\in \\mathbb{R}^{60 \\times 4}$。问题随后变为找到一个参数矩阵 $P \\in \\mathbb{R}^{4 \\times 2}$ 来最小化 $\\| A P - Y_{\\text{train}} \\|_F^2$。解由 $P = (A^T A)^{-1} A^T Y_{\\text{train}}$ 给出。在数值上，这可以通过一个稳定的最小二乘求解器（如 `numpy.linalg.lstsq`）来解决。得到的参数矩阵 $P$ 的第一行包含偏置向量，后续行包含转置的权重矩阵：\n$$\nb = P[0,:]^T \\quad \\in \\mathbb{R}^2\n$$\n$$\nW = P[1:4,:]^T \\quad \\in \\mathbb{R}^{2 \\times 3}\n$$\n\n### 步骤2：时间步进模拟与投影\n\n对于每个测试用例，我们模拟状态向量 $y = [\\phi, S]$ 在 $T=5$ 个时间步内的演化。模拟从给定的初始状态 $y^{(0)} = [\\phi_0, S_0]$ 开始，并使用一个恒定的输入向量 $x$。\n\n在每个时间步 $t$（从 $t=0$ 到 $t=T-1$），执行以下操作：\n1.  **计算增量**：代理模型预测状态增量：\n    $$\n    \\Delta y^{(t)} = W x + b\n    $$\n    由于在单个测试用例的持续时间内输入 $x$ 是恒定的，所以增量 $\\Delta y^{(t)}$ 在每一步也是恒定的。我们将其表示为 $\\Delta y_{\\text{const}}$。\n\n2.  **更新状态**：更新当前状态 $y^{(t)}$ 以获得原始、无约束的下一状态 $y^{(t+1)}_{\\text{raw}}$：\n    $$\n    y^{(t+1)}_{\\text{raw}} = y^{(t)} + \\Delta y_{\\text{const}}\n    $$\n    其中 $y^{(t+1)}_{\\text{raw}} = [\\phi^{(t+1)}_{\\text{raw}}, S^{(t+1)}_{\\text{raw}}]$。\n\n3.  **应用投影**：物理约束 $0 \\leq \\phi \\leq 1$ 和 $0 \\leq S \\leq 1$ 必须被强制执行。这是通过将原始状态 $y^{(t+1)}_{\\text{raw}}$ 投影到有效域（即单位箱 $\\mathcal{B} = [0,1]^2$）上来实现的。到箱型区域上的欧几里得投影 $\\Pi_{\\mathcal{B}}$ 是一个简单的逐分量裁剪操作：\n    $$\n    y^{(t+1)} = \\Pi_{\\mathcal{B}}(y^{(t+1)}_{\\text{raw}})\n    $$\n    具体来说，各分量更新如下：\n    $$\n    \\phi^{(t+1)} = \\min\\{\\max\\{\\phi^{(t+1)}_{\\text{raw}}, 0\\}, 1\\}\n    $$\n    $$\n    S^{(t+1)} = \\min\\{\\max\\{S^{(t+1)}_{\\text{raw}}, 0\\}, 1\\}\n    $$\n这个新状态 $y^{(t+1)}$ 成为下一次迭代的当前状态。至关重要的是，投影必须在时间步进循环内部应用，因为若在最后应用单次投影，即 $\\Pi_{\\mathcal{B}}(y^{(0)} + T \\cdot \\Delta y_{\\text{const}})$，将会产生不同的、不正确的结果。\n\n### 步骤3：执行测试用例\n\n对四个指定的测试用例执行该过程。对于每个用例，使用初始状态 $y^{(0)}$ 和恒定输入 $x$ 运行模拟 $T=5$ 步。记录每个用例的最终投影状态 $y^{(5)} = [\\phi_f, S_f]$。最终输出是这些最终状态分量的展平列表，四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Trains a linear surrogate, simulates state evolution with constraint projection,\n    and outputs the final states for the given test cases.\n    \"\"\"\n    \n    # --- Define Constants ---\n    # Synthetic data generator coefficients\n    ALPHA = 0.12\n    BETA = 0.06\n    SIGMA = 0.08\n    ETA = 0.25\n    RHO = 0.03\n    LAMBDA = 0.05\n    P_C_REF = 0.4\n    \n    # Simulation parameters\n    T_STEPS = 5\n\n    def train_surrogate():\n        \"\"\"\n        Generates training data and fits a linear surrogate model y = Wx + b\n        using ordinary least squares.\n        \"\"\"\n        # 1. Construct the training set on a Cartesian grid\n        p_vals = np.array([0, 0.25, 0.5, 0.75, 1])\n        gamma_dot_vals = np.array([0, 0.5, 1])\n        pc_vals = np.array([0, 0.3, 0.6, 0.9])\n\n        p_grid, gd_grid, pc_grid = np.meshgrid(p_vals, gamma_dot_vals, pc_vals, indexing='ij')\n        \n        x_train = np.vstack([p_grid.ravel(), gd_grid.ravel(), pc_grid.ravel()]).T\n        \n        n_samples = x_train.shape[0]\n        y_train = np.zeros((n_samples, 2))\n\n        # 2. Generate physically consistent increments\n        p = x_train[:, 0]\n        gd = x_train[:, 1]\n        pc = x_train[:, 2]\n\n        delta_phi_phys = -ALPHA * p + BETA * gd - SIGMA * (pc - P_C_REF)\n        delta_s_phys = -ETA * (pc - P_C_REF) - LAMBDA * p + RHO * gd\n        \n        y_train[:, 0] = delta_phi_phys\n        y_train[:, 1] = delta_s_phys\n        \n        # 3. Solve for W and b using Ordinary Least Squares\n        # We solve A * P = Y, where A is the augmented design matrix\n        # and P contains the weights and biases.\n        A = np.hstack([np.ones((n_samples, 1)), x_train])\n        \n        # lstsq solves for a parameter matrix P of shape (4, 2)\n        P, _, _, _ = np.linalg.lstsq(A, y_train, rcond=None)\n        \n        # The first row of P is the bias vector b\n        b = P[0, :]\n        # The remaining rows form the transposed weight matrix W^T\n        W = P[1:, :].T\n        \n        return W, b\n\n    def project(y_raw):\n        \"\"\"\n        Applies Euclidean projection onto the box [0,1]^2.\n        This is equivalent to component-wise clipping.\n        \"\"\"\n        return np.clip(y_raw, 0.0, 1.0)\n\n    def simulate(y0, x, T, W, b):\n        \"\"\"\n        Simulates T updates starting from y0 with constant input x.\n        \"\"\"\n        y = np.array(y0, dtype=float)\n        x_vec = np.array(x, dtype=float)\n        \n        # Since input x is constant, the increment is also constant\n        delta_y = W @ x_vec + b\n        \n        for _ in range(T):\n            y_raw = y + delta_y\n            y = project(y_raw)\n            \n        return y\n\n    # --- Main Execution Logic ---\n    \n    # Train the surrogate model to get W and b\n    W, b = train_surrogate()\n\n    # Define the test suite\n    test_cases = [\n        # Case 1 (happy path)\n        {'y0': [0.25, 0.80], 'x': [0.5, 0.1, 0.6]},\n        # Case 2 (upper-bound edge)\n        {'y0': [0.98, 0.95], 'x': [0.2, 0.5, 0.3]},\n        # Case 3 (lower-bound edge)\n        {'y0': [0.02, 0.05], 'x': [0.8, 0.0, 0.9]},\n        # Case 4 (large update stress test)\n        {'y0': [0.50, 0.50], 'x': [0.9, 0.9, 0.9]},\n    ]\n    \n    final_results = []\n    for case in test_cases:\n        final_state = simulate(case['y0'], case['x'], T_STEPS, W, b)\n        final_results.extend(final_state)\n\n    # Format and print the final output\n    formatted_results = [f\"{num:.6f}\" for num in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}