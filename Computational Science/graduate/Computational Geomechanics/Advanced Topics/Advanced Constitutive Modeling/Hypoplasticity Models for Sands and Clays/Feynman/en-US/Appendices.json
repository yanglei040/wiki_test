{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical implementations, it is essential to build intuition for a model's behavior under simple conditions. This first practice focuses on the fundamental response of a hypoplastic material under isotropic compression. By analytically integrating the model's core rate equations for void ratio $e$ and mean effective pressure $p$, you will derive the classic semi-logarithmic compression law, directly connecting the abstract constitutive parameters to observable soil behavior. ",
            "id": "3531286",
            "problem": "Consider an initially isotropic element of sand modeled within a simplified isotropic projection of a hypoplastic constitutive framework. Let the mean effective pressure be defined as $p = \\tfrac{1}{3} \\operatorname{tr} \\boldsymbol{\\sigma}$ with compression taken as positive. The element is subjected to an isotropic compression at a constant volumetric strain rate, that is, $\\operatorname{tr} \\mathbf{D} = -d_{v}$ where $d_v > 0$ is a constant. The rate of deformation tensor $\\mathbf{D}$ follows a tension-positive convention. Assume small strains and that the void ratio $e$ obeys the standard mass conservation kinematics for a saturated granular skeleton:\n$$\n\\dot{e} = (1 + e)\\, \\operatorname{tr} \\mathbf{D}.\n$$\nAdopt a density-dependent spherical hypoplastic response in which the mean pressure evolves as\n$$\n\\dot{p} = -\\alpha\\,(1 + e)\\, p \\, \\operatorname{tr} \\mathbf{D},\n$$\nwhere $\\alpha > 0$ is a dimensionless material parameter. The initial state at time $t = 0$ is given by $p(0) = p_{0}$ and $e(0) = e_{0}$. Under the imposed constant isotropic compression, the element is compressed until it reaches a mean pressure $p = p_{1} > p_{0}$.\n\nTasks:\n- Starting from the above kinematic law for $e$ and the given hypoplastic evolution for $p$, eliminate time and integrate to obtain a closed-form expression for $e$ as a function of $p$, using $p_{0}$ and $e_{0}$ as reference values. Your derivation must start from the provided kinematics and constitutive rate equations and proceed by symbolic reasoning.\n- Then evaluate the predicted void ratio at $p = p_{1}$ for the data $e_{0} = 0.700$, $p_{0} = 100$ kPa, $p_{1} = 400$ kPa, and $\\alpha = 10.0$. Round your answer to $4$ significant figures. The void ratio is dimensionless; report the final value as a pure number.",
            "solution": "The problem requires the derivation of a relationship between the void ratio $e$ and the mean effective pressure $p$ for an element of sand under isotropic compression, followed by a numerical evaluation.\n\nThe governing equations for the evolution of the void ratio $e$ and mean pressure $p$ are provided. The kinematic law for the void ratio is given by:\n$$\n\\dot{e} = (1 + e) \\operatorname{tr} \\mathbf{D}\n$$\nAnd the constitutive law for the mean pressure is:\n$$\n\\dot{p} = -\\alpha (1 + e) p \\operatorname{tr} \\mathbf{D}\n$$\nIn these equations, $\\dot{e} = \\frac{de}{dt}$ and $\\dot{p} = \\frac{dp}{dt}$ represent the material time derivatives. The problem states that the element is subjected to a constant isotropic compression, meaning the trace of the rate of deformation tensor, $\\operatorname{tr} \\mathbf{D}$, is a negative constant, which we denote as $-d_v$ where $d_v > 0$.\n$$\n\\operatorname{tr} \\mathbf{D} = -d_v\n$$\nSubstituting this into the governing equations yields:\n$$\n\\frac{de}{dt} = - (1 + e) d_v \\quad (1)\n$$\n$$\n\\frac{dp}{dt} = -\\alpha (1 + e) p (-d_v) = \\alpha (1 + e) p d_v \\quad (2)\n$$\nTo find a relationship between $e$ and $p$, we can eliminate the time variable $t$. Using the chain rule for differentiation, we can express the rate of change of void ratio with respect to pressure, $\\frac{de}{dp}$, as the ratio of their time derivatives:\n$$\n\\frac{de}{dp} = \\frac{de/dt}{dp/dt}\n$$\nSubstituting equations $(1)$ and $(2)$ into this expression gives:\n$$\n\\frac{de}{dp} = \\frac{- (1 + e) d_v}{\\alpha (1 + e) p d_v}\n$$\nThe terms $(1 + e)$ and $d_v$ cancel out, as $e > -1$ (since void ratio is physically positive) and $d_v > 0$ (as given). This simplifies the differential equation significantly:\n$$\n\\frac{de}{dp} = - \\frac{1}{\\alpha p}\n$$\nThis is a first-order separable ordinary differential equation. We can solve it by separating the variables $e$ and $p$ and integrating. We integrate from the initial state $(p_0, e_0)$ to a general state $(p, e)$:\n$$\n\\int_{e_0}^{e} d\\tilde{e} = \\int_{p_0}^{p} - \\frac{1}{\\alpha \\tilde{p}} d\\tilde{p}\n$$\nThe material parameter $\\alpha$ is a constant, so it can be taken out of the integral:\n$$\n\\int_{e_0}^{e} d\\tilde{e} = -\\frac{1}{\\alpha} \\int_{p_0}^{p} \\frac{1}{\\tilde{p}} d\\tilde{p}\n$$\nPerforming the integration on both sides yields:\n$$\n[\\tilde{e}]_{e_0}^{e} = -\\frac{1}{\\alpha} [\\ln(\\tilde{p})]_{p_0}^{p}\n$$\nSince pressure $p$ is a positive quantity, we do not need absolute value signs for the logarithm. Evaluating the definite integrals, we get:\n$$\ne - e_0 = -\\frac{1}{\\alpha} (\\ln(p) - \\ln(p_0))\n$$\nUsing the property of logarithms, $\\ln(a) - \\ln(b) = \\ln(\\frac{a}{b})$, we can write:\n$$\ne - e_0 = -\\frac{1}{\\alpha} \\ln\\left(\\frac{p}{p_0}\\right)\n$$\nFinally, solving for $e$ as a function of $p$ gives the required closed-form expression:\n$$\ne(p) = e_0 - \\frac{1}{\\alpha} \\ln\\left(\\frac{p}{p_0}\\right)\n$$\nThis completes the first part of the task.\n\nFor the second part, we must evaluate the void ratio at a final pressure $p = p_1$. Let the void ratio at this pressure be $e_1$. We substitute $p=p_1$ into the derived expression:\n$$\ne_1 = e_0 - \\frac{1}{\\alpha} \\ln\\left(\\frac{p_1}{p_0}\\right)\n$$\nThe problem provides the following numerical values: $e_0 = 0.700$, $p_0 = 100$ kPa, $p_1 = 400$ kPa, and $\\alpha = 10.0$. Substituting these values into the equation:\n$$\ne_1 = 0.700 - \\frac{1}{10.0} \\ln\\left(\\frac{400}{100}\\right)\n$$\n$$\ne_1 = 0.700 - 0.1 \\ln(4)\n$$\nNow, we calculate the numerical value:\n$$\n\\ln(4) \\approx 1.38629436\n$$\n$$\ne_1 \\approx 0.700 - 0.1 \\times 1.38629436\n$$\n$$\ne_1 \\approx 0.700 - 0.138629436\n$$\n$$\ne_1 \\approx 0.561370564\n$$\nThe problem requires the answer to be rounded to $4$ significant figures. The fifth significant figure is $7$, so we round up the fourth digit.\n$$\ne_1 \\approx 0.5614\n$$",
            "answer": "$$\\boxed{0.5614}$$"
        },
        {
            "introduction": "Analytical solutions are limited to simple loading paths, making numerical integration the cornerstone of computational geomechanics. This exercise transitions from theory to code by tasking you with implementing a semi-analytical stress-update algorithm. A key challenge is to ensure numerical stability and physical consistency when the loading direction changes, which requires careful handling of non-smooth terms in the constitutive law through techniques like sub-stepping. ",
            "id": "3531312",
            "problem": "You are given a constitutive update step for a hypoplasticity model specialized to isotropic states, in which the mean effective pressure $p$ (compression-positive) and the void ratio $e$ evolve with the imposed rate-of-deformation tensor $\\mathbf{D}$. Assume small strains and a standard geomechanics sign convention where compression corresponds to $\\operatorname{tr}\\mathbf{D} < 0$. The evolution of the void ratio is governed by mass conservation as\n$ \\dot{e} = (1+e)\\,\\operatorname{tr}\\mathbf{D} $,\nand the isotropic hypoplastic stress rate is simplified to a scalar ordinary differential equation (ODE) for the mean effective pressure $p$ of the form\n$ \\dot{p} = -K(e)\\,\\operatorname{tr}\\mathbf{D} + \\alpha\\,\\lvert \\operatorname{tr}\\mathbf{D} \\rvert\\, p $,\nwhere $K(e) = K_0\\,\\exp(-c_e\\, e)$ with $K_0 > 0$, $c_e > 0$, and $\\alpha \\ge 0$.\n\nOver a single time step of length $\\Delta t$, assume that $\\operatorname{tr}\\mathbf{D}(t)$ varies linearly from a known initial value $\\operatorname{tr}\\mathbf{D}_n$ at time $t_n$ to a known final value $\\operatorname{tr}\\mathbf{D}_{n+1}$ at time $t_{n+1}=t_n+\\Delta t$. Let $e_n$ and $p_n$ denote the known values at $t_n$. Your task is to design and implement a numerically stable and physically consistent update for $(e_{n+1}, p_{n+1})$ that:\n\n- Derives from the fundamental mass conservation relation for the void ratio and a standard hypoplastic rate form under isotropy for the mean effective pressure.\n- Ensures numerical stability and correctness when $\\operatorname{tr}\\mathbf{D}$ changes sign within the time step (i.e., when $\\operatorname{tr}\\mathbf{D}_n \\cdot \\operatorname{tr}\\mathbf{D}_{n+1} < 0$).\n- Treats $\\operatorname{tr}\\mathbf{D}(t)$ as linear in time over the step and uses a piecewise strategy if it crosses zero, with substeps ending precisely at the zero-crossing time, if any.\n- For the void ratio, uses the mathematically exact update implied by integrating $\\dot{e} = (1+e)\\,\\operatorname{tr}\\mathbf{D}$ under the assumed linear-in-time $\\operatorname{tr}\\mathbf{D}(t)$ over each (sub)interval.\n- For the mean effective pressure, models the ODE over each (sub)interval as $\\dot{p} = a + b\\,p$ with coefficients treated as constants evaluated at the temporal midpoint of that (sub)interval, where $a = -K(e_\\mathrm{mid})\\,\\overline{D}$, $b = \\alpha \\lvert \\overline{D} \\rvert$, and $\\overline{D}$ is the average of $\\operatorname{tr}\\mathbf{D}$ over that (sub)interval. Use the exact variation-of-constants solution for constant $a$ and $b$ on that (sub)interval, taking the $b \\to 0$ limit when $b=0$.\n\nThe update must be implemented as a complete, runnable program that produces the final pairs $(e_{n+1}, p_{n+1})$ for the following test suite. In all tests, $K_0$ is in kilopascals (kPa), $\\Delta t$ is in seconds (s), $\\operatorname{tr}\\mathbf{D}$ is in $\\mathrm{s}^{-1}$, $p$ is in kilopascals (kPa), and $e$ is dimensionless.\n\nTest Suite (each tuple is $(e_n, p_n, \\Delta t, \\operatorname{tr}\\mathbf{D}_n, \\operatorname{tr}\\mathbf{D}_{n+1}, K_0, c_e, \\alpha)$):\n\n- Case 1 (compression, no sign change): $(0.6, 100.0, 1.0, -0.02, -0.02, 10000.0, 1.0, 0.3)$.\n- Case 2 (expansion, no sign change): $(0.8, 150.0, 1.0, 0.015, 0.015, 10000.0, 1.0, 0.3)$.\n- Case 3 (sign change within the step): $(0.7, 120.0, 2.0, -0.03, 0.03, 10000.0, 1.0, 0.3)$.\n- Case 4 (near-cancelling volumetric history, sign change): $(1.0, 80.0, 10.0, 0.001, -0.001, 10000.0, 1.0, 0.3)$.\n\nImplementation requirements and clarifications:\n\n- You must assume $\\operatorname{tr}\\mathbf{D}(t)$ is linear between $t_n$ and $t_{n+1}$. If it crosses zero, split the step into two substeps at the zero-crossing time $t^\\ast$ where $\\operatorname{tr}\\mathbf{D}(t^\\ast) = 0$, and apply your update on each substep sequentially.\n- For each (sub)interval $[t_a, t_b]$, compute the void ratio update exactly by integrating $\\dot{e}=(1+e)\\,\\operatorname{tr}\\mathbf{D}(t)$. Under linear $\\operatorname{tr}\\mathbf{D}(t)$, this integral reduces to multiplying $(1+e)$ by an exponential factor with the average $\\overline{D}$ over $[t_a,t_b]$.\n- For each (sub)interval $[t_a, t_b]$, evaluate $K(e)$ at the midpoint time $t_\\mathrm{mid}=\\tfrac{1}{2}(t_a+t_b)$ using the corresponding midpoint void ratio $e_\\mathrm{mid}$, obtained by integrating the $e$-equation from the interval start to $t_\\mathrm{mid}$ exactly.\n- For the mean stress ODE on each (sub)interval, with constants $a$ and $b$ as defined above and duration $\\Delta \\tau = t_b - t_a$, use the exact solution:\n  - If $b \\ne 0$, $p_{b} = \\left(p_{a} + \\dfrac{a}{b}\\right)\\exp(b\\,\\Delta \\tau) - \\dfrac{a}{b}$.\n  - If $b = 0$, $p_{b} = p_{a} + a\\,\\Delta \\tau$.\n- Angles are not involved. Express the final mean effective pressure in kilopascals (kPa). The void ratio is dimensionless.\n- Your program should compute all four cases and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the flattened sequence $[e_{1,\\mathrm{out}}, p_{1,\\mathrm{out}}, e_{2,\\mathrm{out}}, p_{2,\\mathrm{out}}, e_{3,\\mathrm{out}}, p_{3,\\mathrm{out}}, e_{4,\\mathrm{out}}, p_{4,\\mathrm{out}}]$, where each float is rounded to exactly six decimal places.\n\nYour solution must only use the Python Standard Library and the permitted libraries. No user input is allowed; all data must be hardcoded as specified above. The program must be directly runnable and must print only the final bracketed list. The outputs are unit-consistent: $e$ is dimensionless and $p$ is in $\\mathrm{kPa}$. Ensure numerical stability and correctness even when $\\operatorname{tr}\\mathbf{D}$ changes sign within a step.",
            "solution": "The problem requires the numerical integration of a coupled system of ordinary differential equations (ODEs) governing the evolution of void ratio $e$ and mean effective pressure $p$ in an isotropic hypoplastic material. The integration is to be performed over a single time step of duration $\\Delta t$, from an initial time $t_n$ to a final time $t_{n+1} = t_n + \\Delta t$, given the initial state $(e_n, p_n)$ and the values of the trace of the rate-of-deformation tensor, $\\operatorname{tr}\\mathbf{D}$, at the beginning and end of the step, denoted as $D_n$ and $D_{n+1}$ respectively.\n\nThe governing equations are:\n$$\n\\dot{e} = (1+e)\\,D(t)\n$$\n$$\n\\dot{p} = -K(e)\\,D(t) + \\alpha\\,\\lvert D(t) \\rvert\\, p\n$$\nwhere $D(t) = \\operatorname{tr}\\mathbf{D}(t)$ and $K(e) = K_0\\,\\exp(-c_e\\, e)$. It is assumed that $D(t)$ varies linearly with time $t$ over the interval $[t_n, t_{n+1}]$.\n\nThe core of the task is to implement a specific, piecewise, semi-analytical integration scheme. A critical feature of this scheme is its handling of cases where $D(t)$ changes sign within the time step, i.e., when $D_n \\cdot D_{n+1} < 0$. In such cases, the time step must be partitioned into two sub-steps at the time $t^\\ast$ where $D(t^\\ast) = 0$. The integration is then performed sequentially over these sub-steps.\n\nLet's define the integration algorithm for a generic sub-interval $[t_a, t_b]$ of duration $\\Delta\\tau = t_b - t_a$. The state at time $t_a$ is $(e_a, p_a)$, and the values of the trace of the rate-of-deformation tensor are $D_a = D(t_a)$ and $D_b = D(t_b)$.\n\n**1. Void Ratio Update**\n\nThe evolution equation for the void ratio, $\\dot{e} = (1+e)D(t)$, is a first-order separable ODE. We can write it as $\\frac{de}{1+e} = D(t)dt$. Integrating over the interval $[t_a, t_b]$ yields:\n$$\n\\int_{e_a}^{e_b} \\frac{de}{1+e} = \\int_{t_a}^{t_b} D(t) dt\n$$\n$$\n\\ln(1+e_b) - \\ln(1+e_a) = \\int_{t_a}^{t_b} D(t) dt\n$$\nSince $D(t)$ is linear over the interval, its integral is the average value multiplied by the interval duration. The average value is $\\overline{D} = \\frac{D_a+D_b}{2}$.\n$$\n\\ln\\left(\\frac{1+e_b}{1+e_a}\\right) = \\overline{D} \\, \\Delta\\tau\n$$\nSolving for $e_b$, we obtain the exact update for the void ratio under the assumption of linear $D(t)$:\n$$\ne_b = (1+e_a) \\exp(\\overline{D} \\, \\Delta\\tau) - 1\n$$\n\n**2. Mean Effective Pressure Update**\n\nThe evolution equation for the mean effective pressure, $\\dot{p} = -K(e)\\,D(t) + \\alpha\\,\\lvert D(t) \\rvert\\, p$, is more complex. The problem prescribes an approximation where, over the sub-interval $[t_a, t_b]$, the ODE is treated as a linear first-order equation with constant coefficients:\n$$\n\\dot{p} = a + b p\n$$\nThe coefficients $a$ and $b$ are evaluated using values at the mid-point of the interval. Specifically, $b = \\alpha |\\overline{D}|$ and $a = -K(e_\\mathrm{mid})\\overline{D}$, where $\\overline{D} = \\frac{D_a+D_b}{2}$.\n\nThe value $e_\\mathrm{mid}$ is the void ratio at the temporal midpoint of the sub-interval, $t_\\mathrm{mid} = t_a + \\frac{\\Delta\\tau}{2}$. To find $e_\\mathrm{mid}$, we apply the exact void ratio update formula over the first half of the sub-interval, $[t_a, t_\\mathrm{mid}]$. The duration is $\\frac{\\Delta\\tau}{2}$. The value of $D(t)$ at $t_\\mathrm{mid}$ is $D_\\mathrm{mid} = D(t_a+\\frac{\\Delta\\tau}{2}) = \\frac{D_a+D_b}{2} = \\overline{D}$. The average of $D(t)$ over $[t_a, t_\\mathrm{mid}]$ is $\\frac{D_a+D_\\mathrm{mid}}{2} = \\frac{D_a+\\overline{D}}{2}$.\nThus, $e_\\mathrm{mid}$ is calculated as:\n$$\ne_\\mathrm{mid} = (1+e_a) \\exp\\left( \\left(\\frac{D_a+\\overline{D}}{2}\\right) \\frac{\\Delta\\tau}{2} \\right) - 1\n$$\nWith $e_\\mathrm{mid}$, we compute $K(e_\\mathrm{mid}) = K_0 \\exp(-c_e e_\\mathrm{mid})$, which allows us to determine the coefficient $a$.\n\nThe solution to the ODE $\\dot{p} = a + b p$ over the interval of duration $\\Delta\\tau$ with initial condition $p(t_a) = p_a$ is given by the variation of constants formula.\nIf $b \\ne 0$:\n$$\np_b = \\left(p_a + \\frac{a}{b}\\right) \\exp(b \\Delta\\tau) - \\frac{a}{b}\n$$\nIf $b = 0$, which occurs when $\\overline{D} = 0$, the ODE simplifies to $\\dot{p} = a_0$, where $a_0 = -K(e_\\mathrm{mid}) \\cdot 0 = 0$. The solution is simply $p_b = p_a + a_0 \\Delta\\tau = p_a$. For completeness, if $b=0$ but $a \\neq 0$ (which is not the case here), the solution is $p_b = p_a + a\\Delta\\tau$. The problem statement correctly provides this limiting case.\n\n**3. Overall Algorithm**\n\nThe complete algorithm for a step from $t_n$ to $t_{n+1}$ is as follows:\n\n1.  Define the inputs: $(e_n, p_n)$, $\\Delta t$, $D_n$, $D_{n+1}$, and material parameters $(K_0, c_e, \\alpha)$.\n2.  Check for a sign change in $D(t)$: if $D_n \\cdot D_{n+1} < 0$, a zero crossing occurs.\n    a.  If a crossing occurs, calculate the time of crossing: $t^\\ast = t_n + \\Delta t \\frac{D_n}{D_n - D_{n+1}}$.\n    b.  Define two sub-steps:\n        i.  Sub-step 1: from $t_n$ to $t^\\ast$. Duration $\\Delta\\tau_1 = t^\\ast - t_n$. Initial state $(e_n,p_n)$. $D$ values are $D_n$ and $D^\\ast=0$. Apply the integration scheme described above to find an intermediate state $(e^\\ast, p^\\ast)$.\n        ii. Sub-step 2: from $t^\\ast$ to $t_{n+1}$. Duration $\\Delta\\tau_2 = t_{n+1} - t^\\ast$. Initial state $(e^\\ast,p^\\ast)$. $D$ values are $D^\\ast=0$ and $D_{n+1}$. Apply the integration scheme to find the final state $(e_{n+1}, p_{n+1})$.\n3.  If no sign change occurs ($D_n \\cdot D_{n+1} \\ge 0$), the entire step from $t_n$ to $t_{n+1}$ is treated as a single interval.\n    a.  Apply the integration scheme over $[t_n, t_{n+1}]$ with duration $\\Delta t$, initial state $(e_n, p_n)$, and $D$ values $D_n$ and $D_{n+1}$ to compute the final state $(e_{n+1}, p_{n+1})$.\n\nThis procedure is numerically stable and physically consistent with the problem's premises. It correctly handles the non-smoothness introduced by the absolute value term $\\lvert D(t) \\rvert$ by explicitly resolving the point where the argument of the absolute value is zero. The resulting implementation will be applied to the four test cases provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the hypoplasticity update problem for the given test suite.\n    \"\"\"\n\n    def substep_update(e_a, p_a, D_a, D_b, delta_tau, K0, ce, alpha):\n        \"\"\"\n        Performs the constitutive update over a single (sub)interval.\n\n        Args:\n            e_a (float): Void ratio at the start of the interval.\n            p_a (float): Mean pressure at the start of the interval (kPa).\n            D_a (float): tr(D) at the start of the interval (1/s).\n            D_b (float): tr(D) at the end of the interval (1/s).\n            delta_tau (float): Duration of the interval (s).\n            K0 (float): Bulk modulus constant (kPa).\n            ce (float): Void ratio dependency constant for K.\n            alpha (float): Hypoplastic parameter.\n\n        Returns:\n            tuple[float, float]: Updated void ratio (e_b) and mean pressure (p_b).\n        \"\"\"\n        # Average tr(D) over the sub-interval\n        D_avg = 0.5 * (D_a + D_b)\n\n        # 1. Exact void ratio update\n        # e_b = (1 + e_a) * exp(D_avg * delta_tau) - 1\n        e_b = (1.0 + e_a) * np.exp(D_avg * delta_tau) - 1.0\n\n        # 2. Mean pressure update\n        # Calculate coefficients 'a' and 'b' for the ODE: dp/dt = a + b*p\n        \n        # 'b' coefficient\n        b = alpha * abs(D_avg)\n\n        # To calculate 'a', first find e_mid\n        # D at midpoint of sub-interval: D_midpoint = (D_a + D_b)/2 = D_avg\n        # Average D over [t_a, t_mid]\n        D_avg_for_emid = 0.5 * (D_a + D_avg)\n        # Duration for e_mid calculation is delta_tau / 2\n        delta_tau_mid = 0.5 * delta_tau\n        \n        e_mid = (1.0 + e_a) * np.exp(D_avg_for_emid * delta_tau_mid) - 1.0\n        \n        K_mid = K0 * np.exp(-ce * e_mid)\n        \n        # 'a' coefficient\n        a = -K_mid * D_avg\n        \n        p_b = 0.0\n        if b == 0.0:\n            # Solution for b=0: p_b = p_a + a * delta_tau\n            p_b = p_a + a * delta_tau\n        else:\n            # Solution for b != 0\n            p_b = (p_a + a / b) * np.exp(b * delta_tau) - (a / b)\n            \n        return e_b, p_b\n\n    def solve_case(e_n, p_n, dt, D_n, D_n1, K0, ce, alpha):\n        \"\"\"\n        Solves a single case, handling potential sign change of tr(D).\n\n        Args:\n            (See substep_update for parameter definitions)\n            dt (float): Total time step duration.\n            D_n (float): tr(D) at t_n.\n            D_n1 (float): tr(D) at t_{n+1}.\n\n        Returns:\n            tuple[float, float]: Final void ratio and mean pressure (e_{n+1}, p_{n+1}).\n        \"\"\"\n        # Check for sign change of tr(D) within the step\n        if D_n * D_n1 < 0:\n            # Sign change occurs. Split the step.\n            # Time to zero crossing, t_star, relative to t_n\n            # D(t) = D_n + (D_n1 - D_n) * (t - t_n) / dt = 0\n            # (t_star - t_n) = -D_n * dt / (D_n1 - D_n)\n            dt1 = dt * D_n / (D_n - D_n1)\n            dt2 = dt - dt1\n            D_star = 0.0\n            \n            # Substep 1: from t_n to t_star\n            e_star, p_star = substep_update(e_n, p_n, D_n, D_star, dt1, K0, ce, alpha)\n            \n            # Substep 2: from t_star to t_{n+1}\n            e_n1, p_n1 = substep_update(e_star, p_star, D_star, D_n1, dt2, K0, ce, alpha)\n            \n            return e_n1, p_n1\n        else:\n            # No sign change. Perform a single update.\n            return substep_update(e_n, p_n, D_n, D_n1, dt, K0, ce, alpha)\n\n    # Test Suite (each tuple is (e_n, p_n, dt, trD_n, trD_n1, K0, ce, alpha))\n    test_cases = [\n        (0.6, 100.0, 1.0, -0.02, -0.02, 10000.0, 1.0, 0.3),\n        (0.8, 150.0, 1.0, 0.015, 0.015, 10000.0, 1.0, 0.3),\n        (0.7, 120.0, 2.0, -0.03, 0.03, 10000.0, 1.0, 0.3),\n        (1.0, 80.0, 10.0, 0.001, -0.001, 10000.0, 1.0, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        e_n1, p_n1 = solve_case(*case)\n        results.extend([f\"{e_n1:.6f}\", f\"{p_n1:.6f}\"])\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A robust constitutive model implementation must remain stable even under extreme conditions, such as near-zero effective stress where granular materials lose their stiffness. This advanced practice addresses the numerical challenge of model degeneracy by introducing essential techniques like pressure regularization and positivity projection. Implementing this algorithm will teach you how to prevent numerical failures and ensure your code respects the physical constraint that granular soils cannot sustain tension, a critical step towards developing reliable simulation tools. ",
            "id": "3531387",
            "problem": "Implement and assess a simplified hypoplastic stress-update algorithm for granular materials near vanishing mean effective stress. The constitutive rate equation is written in terms of the effective Cauchy stress tensor $\\boldsymbol{\\sigma}^\\prime$ (compression positive), the rate of deformation tensor $\\mathbf{D}$ (tension positive), and a pressure-regularized stiffness mapping $\\mathbb{h}(\\cdot)$ that degenerates as the mean effective stress tends to zero. The goal is to numerically update $\\boldsymbol{\\sigma}^\\prime$ over a time increment while enforcing a positivity constraint on the updated mean effective stress $p^\\prime$, and to quantify the degeneracy of the volumetric response through an effective modulus.\n\nBegin from the following core definitions and facts:\n1. The effective stress tensor $\\boldsymbol{\\sigma}^\\prime$ is decomposed into volumetric and deviatoric parts via $\\boldsymbol{\\sigma}^\\prime = p^\\prime \\mathbf{I} + \\mathbf{s}$, where $p^\\prime = \\tfrac{1}{3} \\mathrm{tr}(\\boldsymbol{\\sigma}^\\prime)$ and $\\mathbf{s} = \\boldsymbol{\\sigma}^\\prime - p^\\prime \\mathbf{I}$. The identity tensor is $\\mathbf{I}$, and $\\mathrm{tr}(\\cdot)$ denotes the trace.\n2. The rate of deformation $\\mathbf{D}$ is decomposed as $\\mathbf{D} = \\mathbf{E} + \\tfrac{1}{3}\\theta \\mathbf{I}$, where $\\theta = \\mathrm{tr}(\\mathbf{D})$ and the deviatoric part is $\\mathbf{E} = \\mathbf{D} - \\tfrac{1}{3}\\theta \\mathbf{I}$.\n3. The Frobenius norm is $\\lVert \\mathbf{A} \\rVert = \\sqrt{\\mathbf{A}:\\mathbf{A}}$.\n\nConsider the following simplified isotropic hypoplastic rate mapping that captures pressure dependence and nonlinearity while remaining tractable for implementation near $p^\\prime \\to 0$:\n$$\n\\dot{\\boldsymbol{\\sigma}}^\\prime \\;=\\; a\\,\\big(p_{\\mathrm{reg}}\\big)^{\\alpha}\\,\\mathbf{E} \\;-\\; b\\,\\big(p_{\\mathrm{reg}}\\big)^{\\beta}\\,\\theta\\,\\mathbf{I} \\;+\\; c\\,\\lVert \\mathbf{E} \\rVert\\,\\mathbf{s},\n$$\nwhere $p_{\\mathrm{reg}} = \\max\\{p^\\prime, p_{\\mathrm{floor}}\\}$ is a regularized mean effective stress, $\\alpha = 0.5$, $\\beta = 0.5$, and the material constants are $a = 100$ (in consistent units), $b = 150$ (in consistent units), and $c = 1$ (dimensionless). The pressure floor is $p_{\\mathrm{floor}} = 0.1\\,\\mathrm{kPa}$. The time integration is performed using an explicit forward Euler scheme:\n$$\n\\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}} \\;=\\; \\boldsymbol{\\sigma}^\\prime_n \\;+\\; \\Delta t \\;\\dot{\\boldsymbol{\\sigma}}^\\prime(\\boldsymbol{\\sigma}^\\prime_n,\\mathbf{D}_n),\n$$\nwith a positivity constraint on the updated mean effective stress. After forming the trial state, compute $p^\\prime_{\\mathrm{trial}} = \\tfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}})$ and $\\mathbf{s}_{\\mathrm{trial}} = \\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}} - p^\\prime_{\\mathrm{trial}}\\mathbf{I}$. If $p^\\prime_{\\mathrm{trial}} \\le p_{\\min}$, enforce positivity by setting\n$$\n\\boldsymbol{\\sigma}^\\prime_{n+1} \\;=\\; \\mathbf{s}_{\\mathrm{trial}} \\;+\\; p_{\\min}\\,\\mathbf{I},\n$$\notherwise set $\\boldsymbol{\\sigma}^\\prime_{n+1} = \\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}}$. Use $p_{\\min} = 0.1\\,\\mathrm{kPa}$.\n\nDefine the degeneracy measure of the volumetric response at the beginning of the step as the effective hypoplastic volumetric modulus $M_v$. If compressive volumetric strain is taken as positive ($d\\epsilon_v = -\\theta dt$), the mean stress increases for a positive $M_v$. The modulus is derived as:\n$$\nM_v \\;=\\; \\frac{d \\dot{p}^\\prime}{d\\epsilon_v} = \\frac{\\partial \\dot{p}^\\prime/\\partial t}{-\\theta} = b\\,(p_{\\mathrm{reg}})^{\\beta},\n$$\nso that near $p^\\prime \\to 0$ and with the regularization $p_{\\mathrm{reg}} = p_{\\mathrm{floor}}$, one has $M_v \\to b\\,(p_{\\mathrm{floor}})^{1/2}$.\n\nImplement a program that, for each test case below, computes the updated mean effective stress $p^\\prime_{n+1}$ in $\\mathrm{kPa}$, the positivity constraint activation flag ($1$ if the positivity projection is applied, $0$ otherwise), and the degeneracy measure $M_v$ in $\\mathrm{kPa}$ evaluated at the beginning of the step. All stress quantities are in $\\mathrm{kPa}$, time in $\\mathrm{s}$, and strain rates in $\\mathrm{s}^{-1}$. Report $p^\\prime_{n+1}$ and $M_v$ rounded to six decimal places. Use compression-positive for stress and tension-positive for strain rate conventions consistently. The angle unit is not applicable.\n\nTest suite to be used by your program:\n1. Test $1$ (near-vacuum isotropic compression): initial $\\boldsymbol{\\sigma}^\\prime_n = p_0 \\mathbf{I}$ with $p_0 = 0.5\\,\\mathrm{kPa}$, $\\mathbf{D}_n = \\tfrac{1}{3}\\theta \\mathbf{I}$ with $\\theta = -0.01\\,\\mathrm{s}^{-1}$, and $\\Delta t = 0.1\\,\\mathrm{s}$.\n2. Test $2$ (near-vacuum isotropic expansion, severe): initial $\\boldsymbol{\\sigma}^\\prime_n = p_0 \\mathbf{I}$ with $p_0 = 1.0\\,\\mathrm{kPa}$, $\\mathbf{D}_n = \\tfrac{1}{3}\\theta \\mathbf{I}$ with $\\theta = 1.0\\,\\mathrm{s}^{-1}$, and $\\Delta t = 0.1\\,\\mathrm{s}$.\n3. Test $3$ (pure shear at vanishing pressure): initial $\\boldsymbol{\\sigma}^\\prime_n = p_0 \\mathbf{I}$ with $p_0 = 0.2\\,\\mathrm{kPa}$, $\\mathbf{D}_n$ a pure shear with $\\theta = 0$ and $\\mathbf{E}$ given by off-diagonal components $(\\mathbf{D}_n)_{12} = (\\mathbf{D}_n)_{21} = 0.01\\,\\mathrm{s}^{-1}$, all others zero, with $\\Delta t = 0.2\\,\\mathrm{s}$.\n4. Test $4$ (general case with deviatoric stress): initial $\\boldsymbol{\\sigma}^\\prime_n = p_0 \\mathbf{I} + \\mathbf{s}_0$ with $p_0 = 5.0\\,\\mathrm{kPa}$ and $\\mathbf{s}_0 = \\mathrm{diag}(1.0,-0.5,-0.5)\\,\\mathrm{kPa}$, $\\mathbf{D}_n$ composed of $\\theta = -0.005\\,\\mathrm{s}^{-1}$ and the same pure shear deviatoric part as in Test $3$, with $\\Delta t = 0.1\\,\\mathrm{s}$.\n5. Test $5$ (exactly zero initial pressure with expansion): initial $\\boldsymbol{\\sigma}^\\prime_n = \\mathbf{0}$, $\\mathbf{D}_n = \\tfrac{1}{3}\\theta \\mathbf{I}$ with $\\theta = 0.2\\,\\mathrm{s}^{-1}$, and $\\Delta t = 0.05\\,\\mathrm{s}$.\n\nYour program should produce a single line of output containing the results as a list of lists. Each inner list must be of the form $[p^\\prime_{n+1}, \\mathrm{flag}, M_v]$, where $p^\\prime_{n+1}$ and $M_v$ are rounded to six decimal places and the flag is an integer. For example, an output with two test cases would look like `[[0.123456,0,45.678900],[0.100000,1,100.000000]]`.",
            "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of computational geomechanics, well-posed with a clear and complete set of definitions and data, and objective in its formulation. The task is to implement a single-step stress update for a simplified hypoplastic constitutive model, which is a standard procedure in the field.\n\nThe solution involves a direct implementation of the provided algorithm. The core of the problem lies in correctly performing tensor algebra, applying the numerical integration scheme, and enforcing the physical constraint of non-negative mean effective stress. The step-by-step derivation will be presented, followed by the implementation logic.\n\nThe problem requires the implementation of a numerical algorithm to update the effective stress tensor $\\boldsymbol{\\sigma}^\\prime$ for a granular material over a single time increment $\\Delta t$. The material behavior is described by a simplified isotropic hypoplastic rate equation. A key feature of this model is its dependence on the mean effective stress $p^\\prime$, which leads to a degeneracy (loss of stiffness) as $p^\\prime$ approaches zero. The algorithm must handle this by regularizing the stiffness and enforcing a positivity constraint on the updated stress.\n\nFirst, we establish the mathematical framework. The effective Cauchy stress tensor $\\boldsymbol{\\sigma}^\\prime$ (compression positive) and the rate of deformation tensor $\\mathbf{D}$ (tension positive) are decomposed into their volumetric and deviatoric parts. For the stress tensor:\n$$\n\\boldsymbol{\\sigma}^\\prime = p^\\prime \\mathbf{I} + \\mathbf{s}\n$$\nwhere $p^\\prime = \\frac{1}{3} \\mathrm{tr}(\\boldsymbol{\\sigma}^\\prime)$ is the mean effective stress, $\\mathbf{s}$ is the deviatoric stress tensor, and $\\mathbf{I}$ is the second-order identity tensor. For the rate of deformation tensor:\n$$\n\\mathbf{D} = \\frac{1}{3}\\theta \\mathbf{I} + \\mathbf{E}\n$$\nwhere $\\theta = \\mathrm{tr}(\\mathbf{D})$ is the volumetric strain rate and $\\mathbf{E}$ is the deviatoric rate of deformation tensor.\n\nThe constitutive rate equation, which defines the stress rate $\\dot{\\boldsymbol{\\sigma}}^\\prime$, is given by:\n$$\n\\dot{\\boldsymbol{\\sigma}}^\\prime = a\\,\\big(p_{\\mathrm{reg}}\\big)^{\\alpha}\\,\\mathbf{E} - b\\,\\big(p_{\\mathrm{reg}}\\big)^{\\beta}\\,\\theta\\,\\mathbf{I} + c\\,\\lVert \\mathbf{E} \\rVert\\,\\mathbf{s}\n$$\nThe term $p_{\\mathrm{reg}} = \\max\\{p^\\prime, p_{\\mathrm{floor}}\\}$ is a regularized mean stress. The model parameters are given as $a=100$, $b=150$, $c=1$, $\\alpha=0.5$, $\\beta=0.5$, and $p_{\\mathrm{floor}} = 0.1\\,\\mathrm{kPa}$. The negative sign in front of the `b` term is crucial for physical consistency, ensuring that compression ($\\theta  0$) leads to an increase in compressive stress.\n\nThe numerical procedure to update the stress from state $n$ at time $t_n$ to state $n+1$ at time $t_{n+1} = t_n + \\Delta t$ is a two-step process: an explicit predictor step followed by a corrector (or projection) step.\n1.  **Predictor Step (Forward Euler)**: First, the stress rate $\\dot{\\boldsymbol{\\sigma}}^\\prime_n$ is evaluated using the state at the beginning of the increment, i.e., using $\\boldsymbol{\\sigma}^\\prime_n$ (which gives $p^\\prime_n$ and $\\mathbf{s}_n$) and $\\mathbf{D}_n$ (which gives $\\theta_n$ and $\\mathbf{E}_n$). A trial stress tensor $\\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}}$ is then computed:\n    $$\n    \\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}} = \\boldsymbol{\\sigma}^\\prime_n + \\Delta t \\;\\dot{\\boldsymbol{\\sigma}}^\\prime(\\boldsymbol{\\sigma}^\\prime_n, \\mathbf{D}_n)\n    $$\n2.  **Corrector Step (Positivity Projection)**: The physical constraint that the mean effective stress in granular materials cannot be tensile (i.e., $p^\\prime \\ge 0$) is enforced. Here, a minimum pressure $p_{\\min} = 0.1\\,\\mathrm{kPa}$ is enforced. The algorithm checks the mean stress of the trial state, $p^\\prime_{\\mathrm{trial}} = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}})$.\n    -   If $p^\\prime_{\\mathrm{trial}}  p_{\\min}$, the trial state is physically admissible, and we set $\\boldsymbol{\\sigma}^\\prime_{n+1} = \\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}}$. The positivity constraint is not activated.\n    -   If $p^\\prime_{\\mathrm{trial}} \\le p_{\\min}$, the trial state violates the positivity constraint. The projection is activated. The updated stress $\\boldsymbol{\\sigma}^\\prime_{n+1}$ is computed by preserving the trial deviatoric stress, $\\mathbf{s}_{\\mathrm{trial}} = \\boldsymbol{\\sigma}^\\prime_{\\mathrm{trial}} - p^\\prime_{\\mathrm{trial}}\\mathbf{I}$, and resetting the mean stress to the minimum allowed value:\n        $$\n        \\boldsymbol{\\sigma}^\\prime_{n+1} = \\mathbf{s}_{\\mathrm{trial}} + p_{\\min}\\,\\mathbf{I}\n        $$\n\nThe problem also requires quantifying the material's volumetric stiffness. The rate of mean stress is found by tracing the constitutive law:\n$$\n\\dot{p}^\\prime = \\frac{1}{3}\\mathrm{tr}(\\dot{\\boldsymbol{\\sigma}}^\\prime) = \\frac{1}{3} \\mathrm{tr}\\left(a\\,(p_{\\mathrm{reg}})^{\\alpha}\\,\\mathbf{E} - b\\,(p_{\\mathrm{reg}})^{\\beta}\\,\\theta\\,\\mathbf{I} + c\\,\\lVert \\mathbf{E} \\rVert\\,\\mathbf{s}\\right)\n$$\nSince $\\mathrm{tr}(\\mathbf{E}) = 0$, $\\mathrm{tr}(\\mathbf{I})=3$, and $\\mathrm{tr}(\\mathbf{s})=0$, this simplifies to:\n$$\n\\dot{p}^\\prime = -b\\,(p_{\\mathrm{reg}})^{\\beta}\\,\\theta\n$$\nThe effective hypoplastic volumetric modulus $M_v$ is defined with respect to a positive compressive volumetric strain ($d\\epsilon_v = -\\theta dt$). Its derivation is:\n$$\nM_v = \\frac{d\\dot{p}'}{d\\epsilon_v} = \\frac{\\dot{p}'}{-\\theta} = \\frac{-b\\,(p_{\\mathrm{reg}})^{\\beta}\\,\\theta}{-\\theta} = b\\,(p_{\\mathrm{reg}})^{\\beta}\n$$\nThis modulus is evaluated using the mean stress $p^\\prime_n$ at the beginning of the time step: $M_v = b\\,(\\max\\{p^\\prime_n, p_{\\mathrm{floor}}\\})^{\\beta}$.\n\nFor implementation, all second-order tensors are represented as $3 \\times 3$ NumPy arrays. The trace is `np.trace()`, the identity is `np.eye(3)`, and the Frobenius norm is `np.linalg.norm(A, 'fro')`. The algorithm is applied to each test case to compute the required outputs.",
            "answer": "```python\nimport numpy as np\nimport json\n\ndef solve():\n    \"\"\"\n    Implements and assesses a simplified hypoplastic stress-update algorithm.\n    \"\"\"\n\n    # --- Material and numerical parameters ---\n    a = 100.0\n    b = 150.0\n    c = 1.0\n    alpha = 0.5\n    beta = 0.5\n    p_floor = 0.1  # kPa\n    p_min = 0.1    # kPa\n\n    # --- Test suite definition ---\n    # Corrected for tension-positive strain rate convention\n    test_cases = [\n        # Test 1: near-vacuum isotropic compression (theta  0)\n        {\n            \"sigma_n\": np.array([[0.5, 0, 0], [0, 0.5, 0], [0, 0, 0.5]]),\n            \"D_n\": np.array([[(1/3)*(-0.01), 0, 0], [0, (1/3)*(-0.01), 0], [0, 0, (1/3)*(-0.01)]]),\n            \"dt\": 0.1\n        },\n        # Test 2: near-vacuum isotropic expansion, severe (theta > 0)\n        {\n            \"sigma_n\": np.array([[1.0, 0, 0], [0, 1.0, 0], [0, 0, 1.0]]),\n            \"D_n\": np.array([[(1/3)*(1.0), 0, 0], [0, (1/3)*(1.0), 0], [0, 0, (1/3)*(1.0)]]),\n            \"dt\": 0.1\n        },\n        # Test 3: pure shear at vanishing pressure (theta = 0)\n        {\n            \"sigma_n\": np.array([[0.2, 0, 0], [0, 0.2, 0], [0, 0, 0.2]]),\n            \"D_n\": np.array([[0, 0.01, 0], [0.01, 0, 0], [0, 0, 0]]),\n            \"dt\": 0.2\n        },\n        # Test 4: general case with deviatoric stress (compression, theta  0)\n        {\n            \"sigma_n\": np.array([[6.0, 0, 0], [0, 4.5, 0], [0, 0, 4.5]]),\n            \"D_n\": np.array([[(1/3)*(-0.005), 0.01, 0], [0.01, (1/3)*(-0.005), 0], [0, 0, (1/3)*(-0.005)]]),\n            \"dt\": 0.1\n        },\n        # Test 5: exactly zero initial pressure with expansion (theta > 0)\n        {\n            \"sigma_n\": np.zeros((3, 3)),\n            \"D_n\": np.array([[(1/3)*(0.2), 0, 0], [0, (1/3)*(0.2), 0], [0, 0, (1/3)*(0.2)]]),\n            \"dt\": 0.05\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        sigma_n = case[\"sigma_n\"]\n        D_n = case[\"D_n\"]\n        dt = case[\"dt\"]\n        \n        I = np.eye(3)\n\n        # Decompose sigma_n and D_n\n        p_n = (1/3) * np.trace(sigma_n)\n        s_n = sigma_n - p_n * I\n        \n        theta_n = np.trace(D_n)\n        E_n = D_n - (1/3) * theta_n * I\n        norm_E = np.linalg.norm(E_n, 'fro')\n\n        # Regularized pressure\n        p_reg = max(p_n, p_floor)\n\n        # Calculate degeneracy measure M_v at the beginning of the step\n        M_v = b * (p_reg ** beta)\n\n        # Calculate stress rate dot_sigma (with corrected formula)\n        term1 = a * (p_reg ** alpha) * E_n\n        term2 = -b * (p_reg ** beta) * theta_n * I\n        term3 = c * norm_E * s_n\n        dot_sigma = term1 + term2 + term3\n\n        # Forward Euler step for trial stress\n        sigma_trial = sigma_n + dt * dot_sigma\n        \n        # Check positivity constraint\n        p_trial = (1/3) * np.trace(sigma_trial)\n        \n        flag = 0\n        if p_trial = p_min:\n            flag = 1\n            s_trial = sigma_trial - p_trial * I\n            sigma_np1 = s_trial + p_min * I\n        else:\n            sigma_np1 = sigma_trial\n\n        # Final updated mean stress\n        p_np1 = (1/3) * np.trace(sigma_np1)\n        \n        all_results.append([round(p_np1, 6), flag, round(M_v, 6)])\n\n    # Use json.dumps for clean formatting without extra spaces\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```"
        }
    ]
}