{
    "hands_on_practices": [
        {
            "introduction": "本练习是计算粘塑性领域的绝佳入门。通过推导一个简单一维蠕变试验的解析解，您将为模型的准确性建立一个基准。本练习将指导您实现一个标准的数值积分方案并量化其误差，这是计算模型验证中的一项关键技能 。",
            "id": "3521801",
            "problem": "考虑一根单轴杆，其材料为遵循 Perzyna 率相关塑性模型的线性弹性-超应力粘塑性固体，并伴有线性各向同性硬化。假设小应变、等温条件和单轴应力。总应变 $\\varepsilon$ 可进行加法分解为 $\\varepsilon = \\varepsilon^{e} + \\varepsilon^{p}$。单轴弹性本构关系为 $\\sigma = E \\, \\varepsilon^{e}$，其中 $E$ 为杨氏模量。粘塑性流动由指数 $n=1$ 的 Perzyna 超应力法则控制，\n$\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle$，\n其中 $\\eta$ 是粘度参数，$\\langle \\cdot \\rangle$ 表示 Macaulay 括号 $\\langle x \\rangle = \\max(x,0)$，具有线性各向同性硬化的单轴屈服函数为 $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$，其中 $\\sigma_{y}$ 为初始屈服应力，$H$ 为硬化模量。在 $t=0$ 时，该杆受到瞬时拉伸加载，然后在所有 $t \\ge 0$ 的时间内保持恒定的单轴应力 $\\sigma(t) = \\sigma_{0}>0$。初始条件为 $\\varepsilon^{p}(0)=0$。\n\n任务：\n1) 仅从上述定义和准静态极限（无惯性）下的线性动量平衡出发，推导在恒定应力 $\\sigma(t)=\\sigma_{0}$（假设 $\\sigma_{0} > \\sigma_{y}$）下，对于 $t \\ge 0$ 的粘塑性应变 $\\varepsilon^{p}(t)$ 和总应变 $\\varepsilon(t)$ 的解析表达式。\n2) 针对 $\\varepsilon^{p}$ 的演化过程，构建一个具有恒定时间步长 $\\Delta t$ 的全隐式后向欧拉（BE）时间离散格式，并推导经过 $N$ 步后（即在 $t_{N} = N \\Delta t$ 时）$\\varepsilon^{p}$ 的闭式表达式，该表达式用 $E$、$H$、$\\eta$、$\\sigma_{y}$、$\\sigma_{0}$、$\\Delta t$ 和 $N$ 表示。\n3) 使用任务1得到的解析解和任务2得到的BE解，计算在最终时间 $T$ 时总应变的绝对误差 $\\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$。使用以下数据（国际单位制）：$E = 30\\,\\mathrm{GPa}$，$H = 2\\,\\mathrm{GPa}$，$\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$，$\\sigma_{y} = 40\\,\\mathrm{MPa}$，$\\sigma_{0} = 60\\,\\mathrm{MPa}$，$T = 2.0 \\times 10^{5}\\,\\mathrm{s}$，$\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$，以及 $N = T/\\Delta t$。将误差以纯应变（无量纲）的形式报告，并将答案四舍五入到四位有效数字。最终数字不带单位。",
            "solution": "该问题陈述经核实科学上合理、适定且完整。它描述了计算粘塑性力学中的一个标准问题。所有必要的本构关系、参数以及边界/初始条件均已提供。\n\n准静态加载的假设意味着惯性力可以忽略不计。对于单轴杆，这确保了轴向应力 $\\sigma$ 在空间上是均匀的，从而可以将其指定为时间的函数 $\\sigma(t)$。问题陈述中说明，在 $t \\ge 0$ 时施加恒定应力 $\\sigma(t) = \\sigma_{0}$，且 $\\sigma_{0} > \\sigma_{y}$。\n\n分析按要求分为三个部分进行。\n\n**任务1：应变演化的解析解**\n\n总应变 $\\varepsilon$ 是弹性应变 $\\varepsilon^{e}$ 和塑性应变 $\\varepsilon^{p}$ 的和：\n$$\n\\varepsilon(t) = \\varepsilon^{e}(t) + \\varepsilon^{p}(t)\n$$\n弹性应变由胡克定律给出，$\\sigma(t) = E \\, \\varepsilon^{e}(t)$。由于应力是恒定的，$\\sigma(t) = \\sigma_{0}$，所以弹性应变也是恒定的：\n$$\n\\varepsilon^{e}(t) = \\frac{\\sigma_{0}}{E}\n$$\n粘塑性应变 $\\varepsilon^{p}$ 的演化由 Perzyna 流动法则控制：\n$$\n\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle\n$$\n其中屈服函数 $f$ 由 $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$ 给出。\n已知 $\\sigma(t) = \\sigma_{0} > 0$，因此有 $|\\sigma| = \\sigma_{0}$。屈服函数变为 $f(\\sigma_{0},\\varepsilon^{p}) = \\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p}$。\n初始条件为 $\\varepsilon^{p}(0)=0$。在 $t=0$ 时，屈服函数的值为 $f(\\sigma_0, 0) = \\sigma_0 - \\sigma_y$。由于已知 $\\sigma_{0} > \\sigma_{y}$，该值为正。根据连续性，$f$ 在 $t=0$ 后的某个时间区间内将保持为正。只要 $f \\ge 0$，Macaulay 括号就可以去掉，即 $\\left\\langle f \\right\\rangle = f$。因此，$\\varepsilon^{p}$ 的控制方程是一个线性一阶常微分方程（ODE）：\n$$\n\\frac{d\\varepsilon^{p}}{dt} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p})\n$$\n这可以重排为标准形式：\n$$\n\\frac{d\\varepsilon^{p}}{dt} + \\frac{H}{\\eta} \\varepsilon^{p} = \\frac{\\sigma_{0} - \\sigma_{y}}{\\eta}\n$$\n此 ODE 在初始条件 $\\varepsilon^{p}(0)=0$ 下的解可以通过标准方法求得。通解是齐次解 $\\varepsilon^{p}_{h}(t) = C \\exp\\left(-\\frac{H}{\\eta}t\\right)$ 和特解 $\\varepsilon^{p}_{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H}$ 的和。\n完整解为 $\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\exp\\left(-\\frac{H}{\\eta}t\\right)$。\n应用初始条件 $\\varepsilon^{p}(0)=0$：\n$$\n0 = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\implies C = -\\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\n将 $C$ 代回，我们得到粘塑性应变的解析表达式：\n$$\n\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\n当 $t \\to \\infty$ 时，$\\varepsilon^{p}(t) \\to \\frac{\\sigma_{0} - \\sigma_{y}}{H}$，这使得 $f \\to \\sigma_{0} - \\sigma_{y} - H \\frac{\\sigma_{0} - \\sigma_{y}}{H} = 0$。因此，条件 $f \\ge 0$ 对所有 $t \\ge 0$ 都成立。\n那么总应变 $\\varepsilon(t)$ 为：\n$$\n\\varepsilon(t) = \\frac{\\sigma_{0}}{E} + \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\n\n**任务2：后向欧拉（BE）离散化**\n\n我们用一个恒定的时间步长 $\\Delta t$ 对时间域进行离散化，使得 $t_{k} = k \\Delta t$。后向欧拉格式将时间 $t_{k+1}$ 处的速率 $\\dot{\\varepsilon}^{p}$ 近似为 $\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t}$，并在 $t_{k+1}$ 处计算 ODE 的右侧：\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} \\left\\langle \\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1} \\right\\rangle\n$$\n这里，$\\varepsilon^{p}_{k}$ 表示 $\\varepsilon^{p}(t_k)$ 的数值近似。假设在第 $k+1$ 步发生塑性流动（鉴于加载条件，这是一个一致的假设），我们可以去掉 Macaulay 括号：\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1})\n$$\n我们求解 $\\varepsilon^{p}_{k+1}$：\n$$\n\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k} = \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y}) - \\frac{H \\Delta t}{\\eta} \\varepsilon^{p}_{k+1}\n$$\n$$\n\\varepsilon^{p}_{k+1} \\left(1 + \\frac{H \\Delta t}{\\eta}\\right) = \\varepsilon^{p}_{k} + \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y})\n$$\n$$\n\\varepsilon^{p}_{k+1} = \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} \\varepsilon^{p}_{k} + \\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}\n$$\n这是一个形式为 $\\varepsilon^{p}_{k+1} = A \\varepsilon^{p}_{k} + B$ 的线性递推关系，其中 $\\varepsilon^{p}_{0}=0$。经过 $N$ 步后的解由 $\\varepsilon^{p}_{N} = B \\sum_{k=0}^{N-1} A^k = B \\frac{1 - A^N}{1 - A}$ 给出。\n让我们计算项 $\\frac{B}{1-A}$：\n$$\n1 - A = 1 - \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} = \\frac{H \\Delta t/\\eta}{1 + H \\Delta t/\\eta}\n$$\n$$\n\\frac{B}{1 - A} = \\frac{\\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}}{\\frac{\\frac{H \\Delta t}{\\eta}}{1 + \\frac{H \\Delta t}{\\eta}}} = \\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\n因此，$\\varepsilon^{p}_{N}$ 的闭式表达式为：\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} (1 - A^N) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(\\frac{1}{1 + \\frac{H \\Delta t}{\\eta}}\\right)^N \\right)\n$$\n这也可以写成：\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right)\n$$\n\n**任务3：误差计算**\n\n我们需要计算在时间 $T = N \\Delta t$ 时总应变的绝对误差：$误差 = \\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$。\n$T$ 时刻的精确总应变为 $\\varepsilon_{\\text{exact}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{\\text{exact}}(T)$。\n$T$ 时刻的 BE 近似总应变为 $\\varepsilon_{\\text{BE}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{N}$。\n弹性应变项 $\\varepsilon^{e}(T) = \\sigma_{0}/E$ 在两个表达式中是共同的，在求差时会消掉。误差仅存在于粘塑性应变分量中：\n$$\nError = \\left| \\varepsilon^{p}_{\\text{exact}}(T) - \\varepsilon^{p}_{N} \\right|\n$$\n代入任务1和任务2中推导出的表达式，其中 $T=N\\Delta t$：\n$$\nError = \\left| \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right) - \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right) \\right|\n$$\n$$\nError = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left| \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right|\n$$\n现在，我们代入给定的数值：\n$E = 30 \\times 10^{9}\\,\\mathrm{Pa}$\n$H = 2 \\times 10^{9}\\,\\mathrm{Pa}$\n$\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$\n$\\sigma_{y} = 40 \\times 10^{6}\\,\\mathrm{Pa}$\n$\\sigma_{0} = 60 \\times 10^{6}\\,\\mathrm{Pa}$\n$T = 2.0 \\times 10^{5}\\,\\mathrm{s}$\n$\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$\n$N = T/\\Delta t = (2.0 \\times 10^{5}) / (2.5 \\times 10^{4}) = 8$\n\n首先，计算前置因子：\n$$\n\\frac{\\sigma_{0} - \\sigma_{y}}{H} = \\frac{60 \\times 10^{6}\\,\\mathrm{Pa} - 40 \\times 10^{6}\\,\\mathrm{Pa}}{2 \\times 10^{9}\\,\\mathrm{Pa}} = \\frac{20 \\times 10^{6}}{2 \\times 10^{9}} = 1 \\times 10^{-2} = 0.01\n$$\n接下来，计算绝对值内各项的参数：\n$$\n\\frac{H \\Delta t}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.5 \\times 10^{4}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{5 \\times 10^{13}}{2 \\times 10^{14}} = 0.25\n$$\n$$\n\\frac{H T}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.0 \\times 10^{5}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{4 \\times 10^{14}}{2 \\times 10^{14}} = 2\n$$\n注意 $\\frac{HT}{\\eta} = \\frac{H(N\\Delta t)}{\\eta} = N \\left(\\frac{H\\Delta t}{\\eta}\\right) = 8 \\times 0.25 = 2$，这是一致的。\n\n现在，将这些代入误差公式：\n$$\nError = 0.01 \\times \\left| \\left(1 + 0.25\\right)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (1.25)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| \\left(\\frac{5}{4}\\right)^{-8} - \\exp(-2) \\right| = 0.01 \\times \\left| \\left(\\frac{4}{5}\\right)^{8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (0.8)^{8} - \\exp(-2) \\right|\n$$\n现在我们计算数值：\n$(0.8)^{8} \\approx 0.16777216$\n$\\exp(-2) \\approx 0.13533528$\n$$\nError \\approx 0.01 \\times |0.16777216 - 0.13533528|\n$$\n$$\nError \\approx 0.01 \\times 0.03243688\n$$\n$$\nError \\approx 0.0003243688\n$$\n四舍五入到四位有效数字，误差为 $0.0003244$。用科学记数法表示为 $3.244 \\times 10^{-4}$。",
            "answer": "$$\n\\boxed{3.244 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "在实际工程中，岩土材料通常采用具有非光滑屈服面的模型来描述，例如莫尔-库仑（Mohr-Coulomb）模型。本练习旨在解决在梯度不唯一的角点和边点处定义塑性流动方向的难题。您将通过实现一个算法，运用次微分（subdifferential）的概念来计算塑性流动方向，这是稳健实现许多高级本构模型的基石技术 。",
            "id": "3521788",
            "problem": "考虑一个三维应力状态，其主应力由向量 $\\boldsymbol{\\sigma} = [\\sigma_1,\\sigma_2,\\sigma_3]$ 表示，并约定不假定其顺序。在 Mohr-Coulomb 模型中，屈服条件可以在主应力空间中，通过摩擦角 $\\varphi$ 和内聚力 $c$，由凸函数表示为\n$$\nf(\\boldsymbol{\\sigma};\\varphi,c) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\varphi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3) - 2\\,c\\,\\sqrt{K(\\varphi)},\n$$\n其中 $K(\\theta) = \\dfrac{1+\\sin\\theta}{1-\\sin\\theta}$。对于弹粘塑性（EVP），塑性流动的速率由一个塑性势 $g$ 控制，该塑性势由剪胀角 $\\psi$ 类似地构造而成，\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\psi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3).\n$$\n由于 $g$ 在主应力相等所对应的棱和角点上是不可微的，因此塑性流动方向必须使用次微分 $\\partial g(\\boldsymbol{\\sigma};\\psi)$ 来定义。EVP 中的返回映射算法需要检测应力状态是位于光滑面（棱）还是角点，并选择一个一致的次梯度方向。\n\n从点态最大和最小函数的凸次微分的基本定义出发，推导一个算法，该算法能够：\n- 在主应力空间中，使用容差 $\\varepsilon$ 来识别相等情况，从而为 Mohr-Coulomb EVP 更新检测活动的棱或角点集，并在最大值和最小值集均为单元素集时将状态分类为“棱”，否则分类为“角点”。\n- 通过选择次微分中的最小范数元素，计算主应力空间中塑性流动的明确次梯度方向 $\\mathbf{n}_p \\in \\partial g(\\boldsymbol{\\sigma};\\psi)$（对最大值和最小值集中的相等索引使用均匀的凸权重）。\n- 当次梯度方向的范数非零时，将其归一化为单位欧几里得范数，如果范数为零，则保持为零向量。\n\n使用以下基本依据：\n- Mohr-Coulomb 屈服函数在主应力空间中的定义以及塑性势 $g$ 作为主应力的凸函数。\n- 线性泛函的点态最大值和最小值的次微分，以及通过凸包对不可微点上次梯度的刻画。\n- 由于对称性，为相等的活动集选择均匀凸权重会产生最小欧几里得范数次梯度的原理。\n\n在一个完整的、可运行的程序中实现所推导的算法，对于每个测试用例，该程序返回：\n- 一个整数分类代码 $c_{\\text{class}}$，其中 $0$ 代表棱，$1$ 代表角点。\n- 活动最大值集的索引列表 $\\mathcal{I}_{\\max} \\subset \\{0,1,2\\}$。\n- 活动最小值集的索引列表 $\\mathcal{J}_{\\min} \\subset \\{0,1,2\\}$。\n- 从 $g(\\boldsymbol{\\sigma};\\psi)$ 计算出的用于塑性流动的归一化次梯度方向向量 $\\mathbf{n}_p$。\n- 以 $\\mathrm{MPa}$ 为单位的屈服超应力 $f(\\boldsymbol{\\sigma};\\varphi,c)$。\n\n角度必须以度为单位提供，并在应用正弦函数前在内部转换为弧度。应力单位必须以兆帕（$\\mathrm{MPa}$）处理。归一化的次梯度方向是无量纲的，屈服超应力必须以 $\\mathrm{MPa}$ 报告。程序必须生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。\n\n测试套件：\n使用以下参数集验证算法，表示为元组 $(\\boldsymbol{\\sigma}\\ (\\mathrm{MPa}),\\ c\\ (\\mathrm{MPa}),\\ \\varphi\\ (\\text{度}),\\ \\psi\\ (\\text{度}),\\ \\varepsilon\\ (\\mathrm{MPa}))$：\n1. $\\left([100.0, 70.0, 30.0],\\ 5.0,\\ 30.0,\\ 5.0,\\ 10^{-3}\\right)$: 主应力互不相同，典型的棱情况。\n2. $\\left([100.0, 100.0 - 10^{-4}, 40.0],\\ 5.0,\\ 30.0,\\ 10.0,\\ 10^{-3}\\right)$: 最大值接近相等，角点情况。\n3. $\\left([50.0, 50.0, 50.0],\\ 0.0,\\ 25.0,\\ 5.0,\\ 10^{-6}\\right)$: 静水应力，位于顶点的角点，内聚力为零。\n4. $\\left([90.0, 30.0, 30.0],\\ 10.0,\\ 35.0,\\ 5.0,\\ 10^{-6}\\right)$: 最小值相等，角点情况。\n5. $\\left([-10.0, -20.0, -30.0],\\ 2.0,\\ 30.0,\\ 0.0,\\ 10^{-4}\\right)$: 拉伸区，剪胀角为零，棱情况。\n6. 使用 $\\varphi=30.0^\\circ$ 时的 $K(\\varphi)$；选择 $\\sigma_3=30.0$，然后设置 $\\sigma_1 = K(\\varphi)\\,\\sigma_3 + 2\\,c\\,\\sqrt{K(\\varphi)}$，以及 $\\sigma_2=50.0$，其中 $c=5.0$，$\\varphi=30.0^\\circ$，$\\psi=10.0^\\circ$，$\\varepsilon=10^{-6}$：此为屈服面上的应力，用于测试接近零的超应力。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，每个测试用例的结果本身也是一个列表，形式如下\n$$\n\\left[c_{\\text{class}},\\ \\mathcal{I}_{\\max},\\ \\mathcal{J}_{\\min},\\ \\mathbf{n}_p,\\ f(\\boldsymbol{\\sigma};\\varphi,c)\\right].\n$$\n所有列表必须对主应力位置使用从零开始的索引。归一化的次梯度向量 $\\mathbf{n}_p$ 必须报告为包含三个浮点数的列表，$f(\\boldsymbol{\\sigma};\\varphi,c)$ 必须是 $\\mathrm{MPa}$ 单位的浮点数。",
            "solution": "该问题要求推导并实现一个算法，用于确定由非关联 Mohr-Coulomb 模型控制的弹粘塑性材料的塑性流动方向。这是计算岩土力学中的一项基本任务，特别是对于称为返回映射算法的应力更新程序。核心挑战在于处理当主应力相等时塑性势函数 $g(\\boldsymbol{\\sigma};\\psi)$ 的不可微性，这对应于主应力空间中屈服面的棱和角点。\n\n解决方案通过将凸分析原理应用于塑性势函数来展开。塑性流动方向由塑性势的梯度 $\\nabla g$ 给出。然而，在 $g$ 不可微的地方，梯度没有唯一定义。我们使用其次微分 $\\partial g$ 来代替，它是所有有效次梯度的集合。\n\n塑性势由下式给出：\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1, \\sigma_2, \\sigma_3) - K(\\psi)\\,\\min(\\sigma_1, \\sigma_2, \\sigma_3)\n$$\n其中 $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]$ 是主应力向量，$\\psi$ 是剪胀角，且 $K(\\psi) = \\frac{1+\\sin\\psi}{1-\\sin\\psi}$。让我们定义 $\\sigma_{\\max} = \\max_i\\{\\sigma_i\\}$ 和 $\\sigma_{\\min} = \\min_i\\{\\sigma_i\\}$。函数 $g$ 可以写作 $g(\\boldsymbol{\\sigma}) = \\sigma_{\\max} - K(\\psi)\\sigma_{\\min}$。\n\n$\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 都是 $\\boldsymbol{\\sigma}$ 的凸函数。凸函数之和的次微分是它们各自次微分的闵可夫斯基和。因此，$g$ 的次微分是：\n$$\n\\partial g(\\boldsymbol{\\sigma}) = \\partial(\\sigma_{\\max}) - K(\\psi)\\,\\partial(\\sigma_{\\min})\n$$\n一组函数的点态最大值的次微分是活动函数梯度的凸包。令 $\\mathcal{I}_{\\max} = \\{i \\in \\{1,2,3\\} \\mid \\sigma_i = \\sigma_{\\max}\\}$ 为对应于最大主应力的索引集。单个函数 $\\sigma_i$ 的梯度是标准基向量 $\\mathbf{e}_i$。因此，$\\sigma_{\\max}$ 的次微分是：\n$$\n\\partial(\\sigma_{\\max}) = \\text{conv}\\{\\mathbf{e}_i \\mid i \\in \\mathcal{I}_{\\max}\\} = \\left\\{ \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i \\mathbf{e}_i \\mid \\alpha_i \\ge 0, \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i = 1 \\right\\}\n$$\n类似地，令 $\\mathcal{J}_{\\min} = \\{j \\in \\{1,2,3\\} \\mid \\sigma_j = \\sigma_{\\min}\\}$ 为对应于最小主应力的索引集。$\\sigma_{\\min}$ 的次微分是：\n$$\n\\partial(\\sigma_{\\min}) = \\text{conv}\\{\\mathbf{e}_j \\mid j \\in \\mathcal{J}_{\\min}\\} = \\left\\{ \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j \\mathbf{e}_j \\mid \\beta_j \\ge 0, \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j = 1 \\right\\}\n$$\n任何次梯度 $\\mathbf{m} \\in \\partial g(\\boldsymbol{\\sigma})$ 都可以表示为 $\\mathbf{m} = \\mathbf{a} - K(\\psi)\\mathbf{b}$，其中 $\\mathbf{a} \\in \\partial(\\sigma_{\\max})$ 且 $\\mathbf{b} \\in \\partial(\\sigma_{\\min})$。\n\n为确保唯一的塑性流动方向，我们选择具有最小欧几里得范数的次梯度，由于 $\\partial g(\\boldsymbol{\\sigma})$ 是一个闭凸集，所以该次梯度是唯一的向量。这个最小范数元素是通过为活动梯度选择均匀的凸权重来找到的。这个选择因凸包的对称性而合理。令 $N_{\\max} = |\\mathcal{I}_{\\max}|$ 和 $N_{\\min} = |\\mathcal{J}_{\\min}|$ 分别为相等的最大和最小主应力的数量。权重为 $\\alpha_i = 1/N_{\\max}$ 和 $\\beta_j = 1/N_{\\min}$。\n\n得到的最小范数次梯度，记为 $\\mathbf{m}_p$，是：\n$$\n\\mathbf{m}_p = \\left( \\frac{1}{N_{\\max}} \\sum_{i \\in \\mathcal{I}_{\\max}} \\mathbf{e}_i \\right) - K(\\psi) \\left( \\frac{1}{N_{\\min}} \\sum_{j \\in \\mathcal{J}_{\\min}} \\mathbf{e}_j \\right)\n$$\n这个向量 $\\mathbf{m}_p$ 代表塑性流动的方向。为了在本构模型中保持一致性，如果它不是零向量，就将其归一化为单位欧几里得范数。归一化的塑性流动方向 $\\mathbf{n}_p$ 是：\n$$\n\\mathbf{n}_p = \\begin{cases} \\frac{\\mathbf{m}_p}{\\|\\mathbf{m}_p\\|_2}  \\text{if } \\|\\mathbf{m}_p\\|_2 \\neq 0 \\\\ \\mathbf{0}  \\text{if } \\|\\mathbf{m}_p\\|_2 = 0 \\end{cases}\n$$\n仅在静水应力状态（$\\sigma_1 = \\sigma_2 = \\sigma_3$，因此 $\\mathcal{I}_{\\max} = \\mathcal{J}_{\\min} = \\{1,2,3\\}$）和零剪胀角（$\\psi=0$，因此 $K(\\psi)=1$）的特定条件下，范数 $\\|\\mathbf{m}_p\\|_2$ 才为零。\n\n算法流程如下：\n1.  给定一个应力向量 $\\boldsymbol{\\sigma}$，找出 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$。\n2.  使用数值容差 $\\varepsilon > 0$，识别活动索引集：\n    $\\mathcal{I}_{\\max} = \\{i \\in \\{0,1,2\\} \\mid \\sigma_i \\ge \\sigma_{\\max} - \\varepsilon\\}$\n    $\\mathcal{J}_{\\min} = \\{j \\in \\{0,1,2\\} \\mid \\sigma_j \\le \\sigma_{\\min} + \\varepsilon\\}$\n3.  对应力状态进行分类。如果 $N_{\\max} = 1$ 且 $N_{\\min} = 1$，状态位于光滑面上（“棱”），分类代码为 $c_{\\text{class}} = 0$。否则，它位于非光滑的交线上（“角点”），分类代码为 $c_{\\text{class}} = 1$。\n4.  计算向量 $\\mathbf{m}_p = [m_{p,1}, m_{p,2}, m_{p,3}]$ 的分量。对于每个分量 $k \\in \\{1,2,3\\}$：\n    $$\n    m_{p,k} = \\begin{cases} 1/N_{\\max}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\notin \\mathcal{J}_{\\min} \\\\ -K(\\psi)/N_{\\min}  \\text{if } k-1 \\notin \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 1/N_{\\max} - K(\\psi)/N_{\\min}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 0  \\text{otherwise} \\end{cases}\n    $$\n    请注意，在实现中我们使用从0开始的索引 $\\{0,1,2\\}$。\n5.  计算欧几里得范数 $\\|\\mathbf{m}_p\\|_2$ 并进行归一化以找到 $\\mathbf{n}_p$。\n6.  最后，使用 Mohr-Coulomb 屈服函数计算屈服超应力 $f(\\boldsymbol{\\sigma};\\varphi,c)$：\n    $$\n    f(\\boldsymbol{\\sigma};\\varphi,c) = \\sigma_{\\max} - K(\\varphi)\\,\\sigma_{\\min} - 2\\,c\\,\\sqrt{K(\\varphi)}\n    $$\n该算法为确定分类、活动集、塑性流动方向和屈服超应力提供了一种完整而稳健的方法，这些都是弹粘塑性本构模型数值积分的基本组成部分。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an algorithm to compute the plastic flow direction\n    for a non-associated Mohr-Coulomb model in principal stress space.\n    \"\"\"\n\n    # Pre-calculate stress for test case 6\n    # phi = 30.0 degrees, c = 5.0 MPa, sigma_3 = 30.0 MPa\n    k_phi_30 = (1 + np.sin(np.deg2rad(30.0))) / (1 - np.sin(np.deg2rad(30.0)))\n    sigma1_tc6 = k_phi_30 * 30.0 + 2 * 5.0 * np.sqrt(k_phi_30)\n\n    test_cases = [\n        ([100.0, 70.0, 30.0], 5.0, 30.0, 5.0, 1e-3),\n        ([100.0, 100.0 - 1e-4, 40.0], 5.0, 30.0, 10.0, 1e-3),\n        ([50.0, 50.0, 50.0], 0.0, 25.0, 5.0, 1e-6),\n        ([90.0, 30.0, 30.0], 10.0, 35.0, 5.0, 1e-6),\n        ([-10.0, -20.0, -30.0], 2.0, 30.0, 0.0, 1e-4),\n        ([sigma1_tc6, 50.0, 30.0], 5.0, 30.0, 10.0, 1e-6),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_vec, c, phi_deg, psi_deg, eps = case\n        sigma = np.array(sigma_vec, dtype=float)\n        \n        # Convert angles to radians\n        phi_rad = np.deg2rad(phi_deg)\n        psi_rad = np.deg2rad(psi_deg)\n        \n        # Calculate K coefficients\n        # Handle the case where sin(theta) is 1.0, though unlikely with typical angles.\n        if np.isclose(np.sin(phi_rad), 1.0):\n            k_phi = np.inf\n        else:\n            k_phi = (1 + np.sin(phi_rad)) / (1 - np.sin(phi_rad))\n\n        if np.isclose(np.sin(psi_rad), 1.0):\n            k_psi = np.inf\n        else:\n            k_psi = (1 + np.sin(psi_rad)) / (1 - np.sin(psi_rad))\n        \n        # Find max and min principal stresses\n        sigma_max = np.max(sigma)\n        sigma_min = np.min(sigma)\n        \n        # Identify active sets using tolerance\n        I_max_indices = np.where(sigma >= sigma_max - eps)[0]\n        J_min_indices = np.where(sigma = sigma_min + eps)[0]\n        \n        N_max = len(I_max_indices)\n        N_min = len(J_min_indices)\n        \n        # Classify as edge or corner\n        if N_max == 1 and N_min == 1:\n            c_class = 0  # Edge\n        else:\n            c_class = 1  # Corner\n\n        # Compute minimal-norm subgradient m_p\n        m_p = np.zeros(3)\n        if N_max > 0:\n            m_p[I_max_indices] += 1.0 / N_max\n        if N_min > 0:\n            m_p[J_min_indices] -= k_psi / N_min\n            \n        # Normalize the subgradient to get plastic flow direction n_p\n        norm_mp = np.linalg.norm(m_p)\n        if norm_mp > 1e-12: # Use a machine epsilon for floating point comparison\n            n_p = m_p / norm_mp\n        else:\n            n_p = np.zeros(3)\n            \n        # Compute yield overstress f\n        if np.isinf(k_phi):\n            # This is a special case (tension cut-off) not formally handled by the formula\n            # For this problem, it's safe to assume phi  90 deg.\n            pass\n        f_overstress = sigma_max - k_phi * sigma_min - 2 * c * np.sqrt(k_phi)\n\n        result_tuple = [\n            c_class,\n            I_max_indices.tolist(),\n            J_min_indices.tolist(),\n            n_p.tolist(),\n            f_overstress\n        ]\n        results.append(result_tuple)\n\n    # Format the final output string\n    # Using str(list) automatically creates the desired output format '[...]'\n    output_str = f\"[{','.join(map(str, results))}]\"\n    # Replace spaces after commas inside each list for a more compact representation, optional but cleaner.\n    output_str = output_str.replace(\", \", \",\")\n    print(output_str)\n\nsolve()\n\n```"
        },
        {
            "introduction": "作为处理非光滑屈服面次微分离散逻辑的一种替代方法，本练习将探索一种更为优雅的技术——正则化。您将使用 LogSumExp 函数来创建莫尔-库仑（Mohr-Coulomb）屈服准则的光滑近似。这项编程练习不仅展示了一种强大的数值方法，而且揭示了其在应用于高度对称问题时所表现出的优美数学特性 。",
            "id": "3521716",
            "problem": "考虑 Mohr-Coulomb 模型在偏平面上的弹-粘塑性正则化。偏平面上的 Mohr-Coulomb 多边形具有不可微的角点，这会导致角点处塑性流动方向的模糊性。在弹-粘塑性（EVP）中，一种与 Duvaut-Lions 或 Perzyna 公式一致的常用正则化方法，是用一个光滑的近似函数来代替非光滑的屈服函数。在偏平面的二维替代表示中，用以下函数的水平集来表示 Mohr-Coulomb 六边形：\n$$\nf(\\mathbf{x}) = \\max_{i=0,\\dots,5}\\left(\\mathbf{n}_i \\cdot \\mathbf{x}\\right) - R,\n$$\n其中 $\\mathbf{x} \\in \\mathbb{R}^2$ 是偏应力矢量，$R  0$ 是一个特征偏半径，面的外法线为：\n$$\n\\mathbf{n}_i = \\begin{bmatrix}\\cos \\alpha_i \\\\ \\sin \\alpha_i\\end{bmatrix}, \\quad \\alpha_i = i \\frac{\\pi}{3}, \\quad i=0,1,\\dots,5.\n$$\n这种构造产生了一个正六边形，其面与 $\\mathbf{n}_i$ 正交，从而在具有六边形对称性的 $\\pi$ 平面中捕捉了 Mohr-Coulomb 模型的不可微角点。\n\n通过 LogSumExp 正则化定义 $f$ 的一个 EVP 平滑：\n$$\n\\tilde{f}_\\varepsilon(\\mathbf{x}) = \\varepsilon \\,\\log\\left(\\sum_{i=0}^5 \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)\\right),\n$$\n其中 $\\varepsilon  0$ 是平滑参数。在这个正则化模型中，粘塑性流动方向与 $\\tilde{f}_\\varepsilon$ 的梯度成正比，即：\n$$\n\\mathbf{d}_\\varepsilon(\\mathbf{x}) \\propto \\nabla \\tilde{f}_\\varepsilon(\\mathbf{x}).\n$$\n在非正则化的 Mohr-Coulomb 多边形上，边界点 $\\mathbf{x}$ 处的参考塑性流动方向定义如下：如果只有一个面是激活的（即在 $f$ 中达到最大值），参考方向是该面的外法线；如果两个相邻的面同时被激活（一个角点），参考方向定义为两个相应外法线的归一化角平分线。令 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x})$ 表示此参考方向。\n\n用应力比 $\\eta = q/p$（偏应力与平均应力之比）来参数化偏应力边界上的应力状态。将注意力限制在三轴拉伸和三轴压缩之间的轴对称状态。设摩擦角为 $\\varphi \\in (0,\\pi/2)$，并定义经典的三轴拉伸和压缩应力比极限：\n$$\nM_{\\mathrm{e}}(\\varphi) = \\frac{6 \\sin \\varphi}{3 + \\sin \\varphi}, \\qquad M_{\\mathrm{c}}(\\varphi) = \\frac{6 \\sin \\varphi}{3 - \\sin \\varphi}.\n$$\n通过在三轴拉伸角点和三轴压缩角点之间进行线性插值，将 $\\eta \\in [M_{\\mathrm{e}}(\\varphi),\\, M_{\\mathrm{c}}(\\varphi)]$ 映射到 $\\pi$ 平面中的一个偏方向角 $\\theta(\\eta)$：\n$$\n\\theta(\\eta) = \\frac{\\pi}{6} \\cdot \\frac{M_{\\mathrm{c}}(\\varphi) + M_{\\mathrm{e}}(\\varphi) - 2\\eta}{M_{\\mathrm{c}}(\\varphi) - M_{\\mathrm{e}}(\\varphi)}.\n$$\n给定一个方向 $\\theta$，六边形上沿方向 $\\mathbf{d}(\\theta) = [\\cos\\theta,\\,\\sin\\theta]^T$ 的边界点通过以下半径得到：\n$$\nr(\\theta) = \\frac{R}{\\max_{i=0,\\dots,5} \\left(\\cos\\big(\\theta - \\alpha_i\\big)\\right)},\n$$\n使得 $\\mathbf{x}(\\theta) = r(\\theta) \\,\\mathbf{d}(\\theta)$ 满足 $f(\\mathbf{x}(\\theta))=0$。\n\n您的任务是设计一个参数化研究，以量化 EVP 平滑参数 $\\varepsilon$ 和应力比 $\\eta$ 如何影响由平滑引入的塑性流动方向误差（相对于非光滑的 Mohr-Coulomb 参考）。对于所提供的测试套件中的每一对 $(\\varepsilon,\\eta)$，计算在相应边界状态 $\\mathbf{x}(\\theta(\\eta))$ 下，归一化的 EVP 流动方向与归一化的 Mohr-Coulomb 参考方向之间的最小夹角：\n$$\n\\Delta(\\varepsilon,\\eta) = \\arccos\\left( \\frac{\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})}{\\left\\|\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})\\right\\|} \\cdot \\widehat{\\mathbf{d}}_{\\mathrm{MC}}(\\mathbf{x}) \\right),\n$$\n以度为单位表示。角度必须以度表示，并以浮点数报告。\n\n您在推导和实现中必须使用的基本原则包括：\n- 将偏平面中的 Mohr-Coulomb 多边形定义为支撑平面的最大值。\n- 通过 LogSumExp 定义 EVP 正则化，以及粘塑性流动方向与正则化超应力梯度之间的关系。\n- 作为摩擦角函数的三轴拉伸和压缩的轴对称应力比极限。\n\n测试套件：\n- 使用 $\\varphi = 30^\\circ$, $R = 1$。\n- 使用平滑参数 $\\varepsilon \\in \\{10^{-4},\\,10^{-2},\\,10^{-1},\\,5\\times 10^{-1}\\}$。\n- 使用应力比 $\\eta \\in \\{M_{\\mathrm{e}}(\\varphi),\\,\\tfrac{1}{2}(M_{\\mathrm{e}}(\\varphi)+M_{\\mathrm{c}}(\\varphi)),\\,M_{\\mathrm{c}}(\\varphi)\\}$。\n\n对于上述集合的笛卡尔积中的每个 $(\\varepsilon,\\eta)$ 组合，计算 $\\Delta(\\varepsilon,\\eta)$（以度为单位）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,...,result12]”），结果的排序方式为：按给定顺序遍历每个 $\\eta$ 值，同时对每个 $\\eta$ 值按给定顺序遍历 $\\varepsilon$。",
            "solution": "该问题的分析和求解分三个阶段进行。首先，我们为感兴趣的量，即正则化的粘塑性流动方向和参考的 Mohr-Coulomb 流动方向，建立数学表达式。其次，我们针对所提供的具体测试用例分析这些表达式。最后，我们实现推导出的算法来计算数值结果。\n\n**1. 理论公式**\n\n问题要求我们计算正则化的粘塑性流动方向 $\\mathbf{d}_\\varepsilon(\\mathbf{x})$ 与非光滑的参考塑性流动方向 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x})$ 之间的夹角 $\\Delta(\\varepsilon,\\eta)$。\n\n**1.1. 粘塑性流动方向**\n\n粘塑性流动方向与正则化屈服函数 $\\tilde{f}_\\varepsilon(\\mathbf{x})$ 的梯度成正比。该函数由下式给出：\n$$\n\\tilde{f}_\\varepsilon(\\mathbf{x}) = \\varepsilon \\,\\log\\left(\\sum_{i=0}^5 \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)\\right)\n$$\n为了求梯度 $\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})$，我们应用链式法则。令对数的参数为 $S(\\mathbf{x}) = \\sum_{i=0}^5 \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)$。\n则 $\\tilde{f}_\\varepsilon(\\mathbf{x}) = \\varepsilon \\log(S(\\mathbf{x}))$。梯度为：\n$$\n\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x}) = \\varepsilon \\frac{1}{S(\\mathbf{x})} \\nabla S(\\mathbf{x})\n$$\n$S(\\mathbf{x})$ 的梯度是：\n$$\n\\nabla S(\\mathbf{x}) = \\sum_{i=0}^5 \\nabla \\left[ \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right) \\right] = \\sum_{i=0}^5 \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right) \\nabla\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)\n$$\n由于 $\\nabla(\\mathbf{n}_i \\cdot \\mathbf{x}) = \\mathbf{n}_i$，这可以简化为：\n$$\n\\nabla S(\\mathbf{x}) = \\sum_{i=0}^5 \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right) \\frac{\\mathbf{n}_i}{\\varepsilon}\n$$\n将此代入 $\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})$ 的表达式中，因子 $\\varepsilon$ 被消掉：\n$$\n\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x}) = \\frac{\\sum_{i=0}^5 \\mathbf{n}_i \\exp\\left(\\frac{\\mathbf{n}_i \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)}{\\sum_{j=0}^5 \\exp\\left(\\frac{\\mathbf{n}_j \\cdot \\mathbf{x} - R}{\\varepsilon}\\right)}\n$$\n这表明梯度是面法线 $\\mathbf{n}_i$ 的加权平均，其中权重由相对于每个面的超应力的指数决定。归一化的粘塑性流动方向则为：\n$$\n\\mathbf{d}_\\varepsilon(\\mathbf{x}) = \\frac{\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})}{\\left\\|\\nabla \\tilde{f}_\\varepsilon(\\mathbf{x})\\right\\|}\n$$\n\n**1.2. Mohr-Coulomb 参考流动方向**\n\n参考流动方向 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x})$ 取决于在点 $\\mathbf{x}$ 处 Mohr-Coulomb 六边形的哪个（些）面被激活。点 $\\mathbf{x}$ 位于屈服面上，因此 $f(\\mathbf{x}) = \\max_{i} (\\mathbf{n}_i \\cdot \\mathbf{x}) - R = 0$。\n如果 $\\mathbf{n}_i \\cdot \\mathbf{x} = R$，则面 $i$ 是激活的。\n- 如果只有一个面 $k$ 是激活的（位于光滑面上的点），则 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x}) = \\mathbf{n}_k$。\n- 如果两个相邻的面 $k$ 和 $k+1$ 被激活（角点），则 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x}) = (\\mathbf{n}_k + \\mathbf{n}_{k+1}) / \\|\\mathbf{n}_k + \\mathbf{n}_{k+1}\\|$。\n\n**2. 测试用例分析**\n\n测试套件使用摩擦角 $\\varphi = 30^\\circ$ 和偏半径 $R = 1$。面法线为 $\\mathbf{n}_i = [\\cos(i\\pi/3), \\sin(i\\pi/3)]^T$，其中 $i=0,\\dots,5$。\n首先，我们计算应力比极限：\n$$\n\\sin(30^\\circ) = 0.5\n$$\n$$\nM_{\\mathrm{e}}(\\varphi=30^\\circ) = \\frac{6 \\times 0.5}{3 + 0.5} = \\frac{3}{3.5} = \\frac{6}{7}\n$$\n$$\nM_{\\mathrm{c}}(\\varphi=30^\\circ) = \\frac{6 \\times 0.5}{3 - 0.5} = \\frac{3}{2.5} = \\frac{6}{5} = 1.2\n$$\n要测试的三个应力比 $\\eta$ 是：\n1. $\\eta_1 = M_{\\mathrm{e}} = 6/7$\n2. $\\eta_2 = \\frac{1}{2}(M_{\\mathrm{e}} + M_{\\mathrm{c}}) = \\frac{1}{2}(6/7 + 6/5) = 36/35$\n3. $\\eta_3 = M_{\\mathrm{c}} = 6/5$\n\n接下来，我们使用所提供的线性插值将它们映射到偏向角 $\\theta(\\eta)$：\n$$\n\\theta(\\eta) = \\frac{\\pi}{6} \\frac{M_{\\mathrm{c}} + M_{\\mathrm{e}} - 2\\eta}{M_{\\mathrm{c}} - M_{\\mathrm{e}}}\n$$\n- 对于 $\\eta_1 = M_{\\mathrm{e}}$: $\\theta_1 = \\frac{\\pi}{6} \\frac{M_{\\mathrm{c}} - M_{\\mathrm{e}}}{M_{\\mathrm{c}} - M_{\\mathrm{e}}} = \\frac{\\pi}{6}$。这对应于六边形的一个角点（三轴拉伸）。\n- 对于 $\\eta_2 = \\frac{1}{2}(M_{\\mathrm{e}} + M_{\\mathrm{c}})$: $\\theta_2 = \\frac{\\pi}{6} \\frac{M_{\\mathrm{c}} + M_{\\mathrm{e}} - (M_{\\mathrm{e}} + M_{\\mathrm{c}})}{M_{\\mathrm{c}} - M_{\\mathrm{e}}} = 0$。这对应于一个面的中点（轴对称压缩）。\n- 对于 $\\eta_3 = M_{\\mathrm{c}}$: $\\theta_3 = \\frac{\\pi}{6} \\frac{M_{\\mathrm{c}} + M_{\\mathrm{e}} - 2M_{\\mathrm{c}}}{M_{\\mathrm{c}} - M_{\\mathrm{e}}} = \\frac{\\pi}{6} \\frac{M_{\\mathrm{e}} - M_{\\mathrm{c}}}{M_{\\mathrm{c}} - M_{\\mathrm{e}}} = -\\frac{\\pi}{6}$。这对应于六边形的另一个角点（三轴压缩）。\n\n因此，问题简化为在由角度 $\\theta \\in \\{\\pi/6, 0, -\\pi/6\\}$ 表征的六边形上的三个特定点评估流动方向。由于正六边形和这些特定点的对称性，计算被显著简化。\n\n**情况 1：面中心点 ($\\theta = 0$)**\n六边形上的点是 $\\mathbf{x}(0) = [1, 0]^T$。在此点，只有面 $i=0$ 是激活的，因为 $\\mathbf{n}_0 \\cdot \\mathbf{x}(0) = 1 = R$。参考方向是 $\\widehat{\\mathbf{d}}_{\\text{MC}} = \\mathbf{n}_0 = [1, 0]^T$。\n用于梯度计算的权重取决于 $\\mathbf{n}_i \\cdot \\mathbf{x}(0) = \\cos(\\alpha_i)$。由于对称性 $\\alpha_{6-i} = -\\alpha_i \\pmod{2\\pi}$（对于 $i=1,2$），我们有 $\\cos(\\alpha_i)=\\cos(\\alpha_{6-i})$。此外，法线成对出现，使得 $\\mathbf{n}_i + \\mathbf{n}_{6-i}$ 是一个纯粹在 x 方向上的矢量。例如，$\\mathbf{n}_1 + \\mathbf{n}_5 = [1,0]^T$。y 分量的梯度表达式为 $\\sum_{i=0}^5 \\sin(\\alpha_i) w_i$。由于 $\\sin(\\alpha_i) = -\\sin(\\alpha_{6-i})$ 且 $w_i=w_{6-i}$，y 分量成对抵消，导致梯度矢量的 y 分量为零。因此，$\\mathbf{d}_\\varepsilon(\\mathbf{x}(0))$ 与 $[1, 0]^T$ 平行，这正是参考方向。对于任何 $\\varepsilon  0$，夹角 $\\Delta$ 恰好为 $0$。\n\n**情况 2：角点 ($\\theta = \\pm \\pi/6$)**\n我们来分析 $\\theta = \\pi/6$ 的情况。这是一个角点，面 $i=0$ 和 $i=1$ 在此被激活。参考方向是归一化的角平分线：\n$$\n\\widehat{\\mathbf{d}}_{\\text{MC}} = \\frac{\\mathbf{n}_0 + \\mathbf{n}_1}{\\|\\mathbf{n}_0 + \\mathbf{n}_1\\|} = \\frac{[1, 0]^T + [1/2, \\sqrt{3}/2]^T}{\\|[3/2, \\sqrt{3}/2]^T\\|} = \\frac{[3/2, \\sqrt{3}/2]^T}{\\sqrt{3}} = [\\sqrt{3}/2, 1/2]^T\n$$\n这个方向对应于 $\\pi/6$ 的角度。指数权重的参数 $C_i = \\mathbf{n}_i \\cdot \\mathbf{x}(\\pi/6) - R$ 表现出关于角度 $\\pi/6$ 的对称性。具体来说，$\\mathbf{n}_i \\cdot \\mathbf{x}(\\pi/6)$ 的值集是对称的。这导致法线对 $(\\mathbf{n}_2, \\mathbf{n}_5)$ 和 $(\\mathbf{n}_3, \\mathbf{n}_4)$ 具有相等的权重，即 $w_2=w_5$ 和 $w_3=w_4$。\n详细的对称性分析表明，梯度 $\\nabla \\tilde{f}_\\varepsilon$ 垂直于参考方向 $\\widehat{\\mathbf{d}}_{\\text{MC}}$ 的分量为零。矢量和 $\\sum_i \\mathbf{n}_i w_i$ 中的项，其垂直于对称轴（角度为 $\\pi/6$ 的线）的分量会相互抵消。例如，法线 $\\mathbf{n}_0$ 和 $\\mathbf{n}_1$ 相对于此轴对称，法线对 $(\\mathbf{n}_5, \\mathbf{n}_2)$ 和 $(\\mathbf{n}_4, \\mathbf{n}_3)$ 也是如此。由于对称对的权重相等，所得梯度必须沿对称轴方向。\n因此，方向 $\\mathbf{d}_\\varepsilon(\\mathbf{x}(\\pi/6))$ 与 $\\widehat{\\mathbf{d}}_{\\text{MC}}(\\mathbf{x}(\\pi/6))$ 完全相同，对于任何 $\\varepsilon  0$，夹角 $\\Delta$ 恰好为 $0$。\n通过对称性，同样的逻辑也适用于 $\\theta = -\\pi/6$ 的角点。\n\n**结论**\n对于所有指定的测试用例 $(\\varepsilon, \\eta)$，屈服面上的点都对应于正六边形上的一个高对称性点（角点或面中心）。在这些特定点上，由于这些对称性，由 LogSumExp 函数的梯度给出的正则化流动方向与标准的关联流动法则方向（垂直于面或角点法线的角平分线）完全重合。因此，对于所有十二种组合，偏差角 $\\Delta(\\varepsilon,\\eta)$ 预计都为 $0$ 度。数值实现将用于在机器精度范围内验证这一解析结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the angle between the regularized EVP flow direction and the \n    reference Mohr-Coulomb flow direction for a set of test cases.\n    \"\"\"\n    \n    # --- Define problem parameters from the test suite ---\n    phi_deg = 30.0\n    R = 1.0\n    epsilons = [1e-4, 1e-2, 1e-1, 5e-1]\n    \n    # Convert friction angle to radians\n    phi_rad = np.deg2rad(phi_deg)\n    sin_phi = np.sin(phi_rad)\n    \n    # --- Define eta values based on friction angle ---\n    M_e = (6 * sin_phi) / (3 + sin_phi)\n    M_c = (6 * sin_phi) / (3 - sin_phi)\n    \n    eta_values = [\n        M_e,                          # Triaxial extension\n        0.5 * (M_e + M_c),            # Average (corresponds to axisymmetric compression)\n        M_c                           # Triaxial compression\n    ]\n\n    # --- Pre-compute hexagon facet normals ---\n    # n_i = [cos(alpha_i), sin(alpha_i)] with alpha_i = i * pi / 3\n    num_facets = 6\n    angles_alpha = (np.arange(num_facets) * np.pi / 3.0).reshape(-1, 1)\n    normals = np.hstack([np.cos(angles_alpha), np.sin(angles_alpha)])\n\n    results = []\n    \n    # --- Main loop over test cases ---\n    # The problem specifies iterating over epsilon for each eta.\n    for eta in eta_values:\n        for epsilon in epsilons:\n            # 1. Map stress ratio eta to deviatoric angle theta\n            theta = (np.pi / 6.0) * (M_c + M_e - 2.0 * eta) / (M_c - M_e)\n\n            # 2. Determine the point x on the hexagon boundary\n            # Direction vector d(theta)\n            d_theta = np.array([np.cos(theta), np.sin(theta)])\n            # Radius r(theta)\n            cos_diffs = np.cos(theta - angles_alpha.flatten())\n            r_theta = R / np.max(cos_diffs)\n            # Position vector x(theta)\n            x = r_theta * d_theta\n            \n            # 3. Calculate the Mohr-Coulomb reference flow direction d_mc\n            # Find which facets are active\n            dot_products = normals @ x\n            # Use a tolerance to handle floating point inaccuracies\n            active_indices = np.where(np.isclose(dot_products, R))[0]\n            \n            if len(active_indices) == 1:\n                # On a smooth face\n                d_mc = normals[active_indices[0]]\n            elif len(active_indices) == 2:\n                # At a corner\n                n_sum = np.sum(normals[active_indices], axis=0)\n                d_mc = n_sum / np.linalg.norm(n_sum)\n            else:\n                # Should not happen for the given test cases\n                # Fallback for unexpected number of active facets\n                raise ValueError(f\"Unexpected number of active facets: {len(active_indices)}\")\n\n            # 4. Calculate the regularized EVP flow direction d_eps\n            # Calculate exponents for the weighted average\n            # Numerically stable calculation since exponents are = 0\n            exponents = (dot_products - R) / epsilon\n            weights = np.exp(exponents)\n            \n            # Calculate gradient as a weighted average of normals\n            grad_f_tilde = np.sum(normals * weights[:, np.newaxis], axis=0) / np.sum(weights)\n\n            # Normalize the gradient vector to get the flow direction\n            d_eps = grad_f_tilde / np.linalg.norm(grad_f_tilde)\n\n            # 5. Compute the angle between the two directions\n            # Dot product between the two normalized vectors\n            dot_val = np.dot(d_eps, d_mc)\n            \n            # Clip to handle potential floating-point errors making |dot_val| > 1\n            dot_val = np.clip(dot_val, -1.0, 1.0)\n            \n            # Calculate angle in degrees\n            angle_rad = np.arccos(dot_val)\n            angle_deg = np.rad2deg(angle_rad)\n            \n            results.append(angle_deg)\n            \n    # --- Format and print the final output ---\n    # The output from the code will be very close to zero, so we format it simply.\n    print(f\"[{','.join(f'{res:.6f}' for res in results)}]\")\n\n\nsolve()\n```"
        }
    ]
}