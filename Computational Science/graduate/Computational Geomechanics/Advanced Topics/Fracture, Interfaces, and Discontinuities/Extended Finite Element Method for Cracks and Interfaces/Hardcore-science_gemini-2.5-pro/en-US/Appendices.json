{
    "hands_on_practices": [
        {
            "introduction": "The first step in applying the Extended Finite Element Method (XFEM) is to understand how the standard finite element approximation is augmented to capture the complex physics of a discontinuity. This involves adding new basis functions and, consequently, new degrees of freedom (DOFs) to specific nodes based on their proximity to features like crack bodies and tips. This exercise explores the core concept of the Partition of Unity, where standard shape functions are multiplied by enrichment functions to represent displacement jumps and crack-tip singularities.\n\nBy calculating the total DOFs for an element with a specific, physically-motivated enrichment strategy , you will gain a concrete understanding of how the XFEM approximation is constructed. More importantly, this practice highlights the critical need for a stable enrichment scheme that avoids linear dependencies and numerical ill-conditioning, revealing why selective enrichment is not just an option, but a necessity for a well-posed problem. This conceptual groundwork is essential before proceeding to implementation.",
            "id": "3524336",
            "problem": "Consider a single four-node bilinear quadrilateral element in plane strain for a homogeneous, isotropic rock matrix within the framework of the Partition of Unity Extended Finite Element Method (XFEM). The element has nodes with physical coordinates $\\boldsymbol{x}_1=(0,0)$, $\\boldsymbol{x}_2=(L,0)$, $\\boldsymbol{x}_3=(L,L)$, and $\\boldsymbol{x}_4=(0,L)$, where $L>0$ is the side length. A traction-free crack enters the element from the left edge at the point $(0,0.5L)$ and terminates with a crack tip located at $\\boldsymbol{x}_{\\mathrm{tip}}=(0.3L,0.3L)$ strictly inside the element. The mechanical unknowns are the displacement components $u_x$ and $u_y$ per node. The enriched displacement approximation is constructed using a Heaviside step function $H$ to represent the displacement jump across the crack faces and four linearly independent near-tip asymptotic branch functions $F_1$, $F_2$, $F_3$, $F_4$ to represent the singular crack-tip field. In the Partition of Unity construction, each enrichment function multiplies the standard shape function at the enriched node and introduces a vector of unknown coefficients of size equal to the number of displacement components.\n\nTo avoid over-enrichment and ill-conditioning, adopt the selection strategy:\n- Attach the four near-tip branch enrichments only to nodes $1$ and $2$ (the two nodes along the bottom edge, aligned with the incoming crack path and nearest to the crack tip region).\n- Attach the Heaviside enrichment only to nodes $3$ and $4$ (the two nodes along the top edge), because their nodal supports are intersected by the crack but they lie away from the tip-dominated zone.\n- Do not assign both Heaviside and near-tip branch enrichments to the same node.\n\nUsing the above selection and the fact that each node in two dimensions carries $u_x$ and $u_y$, compute the total number of degrees of freedom associated with this element after enrichment. Justify why this selection strategy yields a stable and non-redundant enriched approximation consistent with the physical fields. Express your final answer as a pure count (dimensionless). No rounding is required.",
            "solution": "The problem requires the calculation of the total number of degrees of freedom (DOFs) for a four-node quadrilateral element enriched within the Extended Finite Element Method (XFEM) framework to model a crack. The total displacement field $\\boldsymbol{u}(\\boldsymbol{x})$ in XFEM is approximated as a sum of a standard Finite Element (FE) part and an enriched part. For a problem with a crack, an enriched node can have additional DOFs associated with a jump function (Heaviside) and/or singular crack-tip branch functions.\n\nThe general form of the XFEM displacement approximation for an element with a crack is:\n$$\n\\boldsymbol{u}(\\boldsymbol{x}) = \\sum_{i \\in I_s} N_i(\\boldsymbol{x})\\boldsymbol{u}_i + \\sum_{j \\in I_H} N_j(\\boldsymbol{x}) H(\\boldsymbol{x}) \\boldsymbol{a}_j + \\sum_{k \\in I_T} N_k(\\boldsymbol{x}) \\left( \\sum_{\\alpha=1}^{N_f} F_\\alpha(\\boldsymbol{x}) \\boldsymbol{b}_{k\\alpha} \\right)\n$$\nwhere:\n- $N_i(\\boldsymbol{x})$ is the standard FE shape function associated with node $i$.\n- $\\boldsymbol{u}_i$ is the vector of standard DOFs for node $i$.\n- $I_s$ is the set of all nodes in the element.\n- $H(\\boldsymbol{x})$ is the Heaviside step function, which is non-zero for nodes whose supports are cut by the crack ($j \\in I_H$). $\\boldsymbol{a}_j$ is the vector of enriched DOFs for the Heaviside function.\n- $F_\\alpha(\\boldsymbol{x})$ are the near-tip asymptotic branch functions, used for nodes whose supports contain the crack tip ($k \\in I_T$). $\\boldsymbol{b}_{k\\alpha}$ is the vector of enriched DOFs associated with node $k$ and branch function $\\alpha$. $N_f$ is the number of branch functions.\n- The unknowns are vectors of size $2$ in a 2D problem, corresponding to the $u_x$ and $u_y$ displacement components. For example, $\\boldsymbol{u}_i = \\{u_{ix}, u_{iy}\\}$.\n\nWe will calculate the total number of DOFs by summing the contributions from the standard part and the two enrichment types, according to the specific enrichment strategy provided in the problem statement.\n\n1.  **Standard Degrees of Freedom:**\n    The element is a four-node bilinear quadrilateral with nodes $1, 2, 3, 4$. Every node in a standard FE formulation has DOFs associated with it. For a 2D mechanics problem (plane strain), each node has $2$ DOFs ($u_x$ and $u_y$).\n    - Number of nodes: $4$.\n    - Standard DOFs per node: $2$.\n    - Total standard DOFs = (Number of nodes) $\\times$ (Standard DOFs per node) = $4 \\times 2 = 8$.\n\n2.  **Enriched Degrees of Freedom (Heaviside Function):**\n    The Heaviside function $H(\\boldsymbol{x})$ is used to model the displacement discontinuity across the crack faces. The problem states that the Heaviside enrichment is attached only to nodes $3$ and $4$.\n    - Number of Heaviside-enriched nodes: $2$ (nodes $3$ and $4$).\n    - Number of enrichment functions per node: $1$ (the function $H(\\boldsymbol{x})$).\n    - DOFs per enrichment function: $2$ (one for each displacement component, i.e., the vector $\\boldsymbol{a}_j = \\{a_{jx}, a_{jy}\\}$).\n    - Total Heaviside-enriched DOFs = (Number of enriched nodes) $\\times$ (Number of functions) $\\times$ (DOFs per function) = $2 \\times 1 \\times 2 = 4$.\n\n3.  **Enriched Degrees of Freedom (Near-Tip Branch Functions):**\n    The near-tip branch functions $F_\\alpha(\\boldsymbol{x})$ are used to capture the singular stress and strain fields at the crack tip. The problem specifies that four linearly independent branch functions ($F_1, F_2, F_3, F_4$) are used. These enrichments are attached only to nodes $1$ and $2$.\n    - Number of tip-enriched nodes: $2$ (nodes $1$ and $2$).\n    - Number of enrichment functions per node: $4$ (the functions $F_1, F_2, F_3, F_4$).\n    - DOFs per enrichment function: $2$ (one for each displacement component, i.e., the vectors $\\boldsymbol{b}_{k\\alpha}$).\n    - Total tip-enriched DOFs = (Number of enriched nodes) $\\times$ (Number of functions) $\\times$ (DOFs per function) = $2 \\times 4 \\times 2 = 16$.\n\n4.  **Total Degrees of Freedom:**\n    The total number of DOFs for the element is the sum of the standard and all enriched DOFs.\n    - Total DOFs = (Standard DOFs) + (Heaviside DOFs) + (Tip DOFs)\n    - Total DOFs = $8 + 4 + 16 = 28$.\n\n**Justification of the Enrichment Strategy:**\nThe provided strategy is designed to ensure a stable and non-redundant formulation, avoiding ill-conditioning of the resulting system of linear equations. This is achieved by preventing linear dependence among the basis functions.\n\n- **The Problem of Linear Dependence:** The Partition of Unity (PU) property of FE shape functions states that $\\sum_i N_i(\\boldsymbol{x}) = 1$ for any point $\\boldsymbol{x}$ in the element. If all nodes in an element are enriched with the same function, say $G(\\boldsymbol{x})$, the enriched part of the basis contains the term $\\sum_i N_i(\\boldsymbol{x}) G(\\boldsymbol{x}) = G(\\boldsymbol{x})$. If the function $G(\\boldsymbol{x})$ can already be reproduced by the standard FE basis (or another set of enrichment functions), this introduces a linear dependency, leading to a singular stiffness matrix.\n\n- **Redundancy of Heaviside and Tip Functions:** The set of four standard branch functions for a crack in an isotropic elastic material (e.g., $F_\\alpha \\in \\{\\sqrt{r}\\sin(\\frac{\\theta}{2}), \\sqrt{r}\\cos(\\frac{\\theta}{2}), \\sqrt{r}\\sin(\\frac{\\theta}{2})\\sin(\\theta), \\sqrt{r}\\cos(\\frac{\\theta}{2})\\sin(\\theta)\\}$) can represent a displacement jump across the crack faces ($\\theta = \\pm\\pi$) in the vicinity of the tip. Therefore, adding a Heaviside enrichment $H(\\boldsymbol{x})$ to a node that is already enriched with the full set of tip functions is redundant. The function space spanned by the tip-enriched basis functions already contains the jump behavior that the Heaviside function is meant to model. Enriching a node (or set of nodes covering the tip) with both sets of functions would introduce linear dependence and numerical instability.\n\n- **The Chosen Strategy's Stability:** The problem specifies a strategy that avoids this issue by partitioning the enrichment tasks:\n    1.  Nodes near the tip ($1$ and $2$) are enriched with the branch functions ($F_\\alpha$) to capture the complex singular field.\n    2.  Nodes whose supports are cut by the crack but are further from the tip-dominated zone ($3$ and $4$) are enriched with the Heaviside function ($H$) to model the displacement jump.\nThis separation ensures that the basis functions remain linearly independent. The tip functions handle the singularity (which includes the jump at the tip), while the Heaviside function handles the regular jump away from the tip. This division of labor is consistent with the underlying physics and leads to a well-posed and stable numerical system.",
            "answer": "$$\\boxed{28}$$"
        },
        {
            "introduction": "After defining the enriched approximation space, the next practical challenge is to construct the discrete system of equations, such as the stiffness matrix. This requires integrating expressions that involve the new, often discontinuous or singular, basis functions over element domains. Standard numerical quadrature rules, designed for smooth polynomials, are no longer adequate for elements that are cut by a crack.\n\nThis coding practice provides direct, hands-on experience with the most fundamental implementation detail of XFEM: numerical integration over cut cells . You will implement the sub-domain integration technique, where a cut element is partitioned into smaller, regular shapes (e.g., triangles) over which standard quadrature can be accurately applied. Mastering this geometric and numerical procedure is the key to correctly handling the discontinuous integrands that are central to the method.",
            "id": "3524345",
            "problem": "Consider a four-node bilinear quadrilateral finite element used in the Extended Finite Element Method (XFEM) for cracks and interfaces in computational geomechanics. The crack is represented by a level-set function $\\phi(x,y)=y$, and the discontinuity enrichment uses the Heaviside function $H(\\phi)$, where $H(\\phi)=1$ if $\\phi>0$ and $H(\\phi)=0$ if $\\phi<0$. The square element is axis-aligned and defined by four corner nodes with physical coordinates $(x,y)$ ordered as bottom-left, bottom-right, top-right, top-left. The bilinear shape functions $N_I(\\xi,\\eta)$ for $I=1,2,3,4$ on the parent domain $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ are the standard four-node quadrilateral basis. Let the element mapping be linear (affine) for axis-aligned rectangles, with $(x,y)$ given by $x=x_c+\\frac{L_x}{2}\\xi$ and $y=y_c+\\frac{L_y}{2}\\eta$, where $x_c=\\frac{x_{\\min}+x_{\\max}}{2}$, $y_c=\\frac{y_{\\min}+y_{\\max}}{2}$, $L_x=x_{\\max}-x_{\\min}$, and $L_y=y_{\\max}-y_{\\min}$. The Jacobian determinant is constant and equal to $J=\\frac{L_x L_y}{4}$.\n\nYour task is to write a complete, runnable program that, for each given test case, computes the following:\n- The area fractions of the positive side ($\\{(x,y)\\mid y>0\\}$) and the negative side ($\\{(x,y)\\mid y<0\\}$) of the crack with respect to the element area. The line $y=0$ has zero measure and does not contribute to the area.\n- The integrals $\\int_{\\Omega_e} N_I(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A$ for $I=1,2,3,4$, where $\\Omega_e$ denotes the element domain in physical coordinates. The integration must be performed by sub-triangulating the portion of the element on the positive side of the crack (i.e., the polygonal region $\\Omega_e^+=\\Omega_e\\cap\\{y\\ge 0\\}$, noting that the boundary $y=0$ has zero measure), decomposing $\\Omega_e^+$ into triangles, and applying a triangle quadrature rule that is exact for polynomials up to degree $2$.\n\nFundamental basis to use:\n- The Heaviside function definition $H(\\phi)=1$ for $\\phi>0$ and $H(\\phi)=0$ for $\\phi<0$.\n- The bilinear quadrilateral shape functions $N_I(\\xi,\\eta)$ on the parent square and the affine mapping to $(x,y)$ for axis-aligned rectangles.\n- The integral transformation under affine mapping with constant Jacobian determinant $J$.\n- Exact triangle quadrature of order sufficient to integrate quadratic polynomials exactly.\n\nSub-triangulation requirement:\n- Clip the convex polygon of the element by the half-plane $y\\ge 0$ to obtain the polygon $\\Omega_e^+$.\n- Triangulate $\\Omega_e^+$ into non-overlapping triangles that cover it exactly.\n- For each triangle, use a standard $3$-point quadrature exact for polynomials of degree up to $2$, with barycentric points and weights. The integration of a function $f$ over a triangle $T$ must be performed as $\\int_T f(x,y)\\,\\mathrm{d}A = |T|\\sum_{k=1}^{3} w_k f(x_k,y_k)$, where $|T|$ is the triangle area, $(x_k,y_k)$ are quadrature points, and $w_k$ are weights such that $\\sum_k w_k=1$ and the rule is exact for degree-$2$ polynomials.\n\nShape functions:\n- Use the standard four-node bilinear quadrilateral basis on the parent domain $(\\xi,\\eta)\\in[-1,1]^2$: $N_1(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1-\\eta)$, $N_2(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1-\\eta)$, $N_3(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1+\\eta)$, $N_4(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1+\\eta)$. Evaluate $N_I$ at physical coordinates $(x,y)$ by mapping back to $(\\xi,\\eta)$ via $\\xi=\\frac{2(x-x_c)}{L_x}$ and $\\eta=\\frac{2(y-y_c)}{L_y}$.\n\nTest suite:\nFor coverage, include the following five square elements, each defined by node coordinates $(x,y)$ in order: bottom-left, bottom-right, top-right, top-left.\n1. Case $1$: $\\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$ (crack passes through center; symmetric split).\n2. Case $2$: $\\{(2,0.2),(3,0.2),(3,1.2),(2,1.2)\\}$ (entirely above $y=0$).\n3. Case $3$: $\\{(-0.5,-2.0),(0.5,-2.0),(0.5,-1.0),(-0.5,-1.0)\\}$ (entirely below $y=0$).\n4. Case $4$: $\\{(0.0,-0.2),(1.0,-0.2),(1.0,0.8),(0.0,0.8)\\}$ (asymmetric straddle of $y=0$).\n5. Case $5$: $\\{(0.0,0.0),(1.0,0.0),(1.0,1.0),(0.0,1.0)\\}$ (boundary case with crack coincident with bottom edge $y=0$; the positive side is the full element, and the negative side has zero area).\n\nOutput specification:\n- For each test case in the above order, compute:\n  - $f_{\\text{pos}}=\\frac{|\\Omega_e^+|}{|\\Omega_e|}$,\n  - $f_{\\text{neg}}=\\frac{|\\Omega_e^-|}{|\\Omega_e|}$, where $\\Omega_e^-=\\Omega_e\\cap\\{y\\le 0\\}$ and $|\\cdot|$ denotes area,\n  - $I_1=\\int_{\\Omega_e} N_1(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A$,\n  - $I_2=\\int_{\\Omega_e} N_2(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A$,\n  - $I_3=\\int_{\\Omega_e} N_3(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A$,\n  - $I_4=\\int_{\\Omega_e} N_4(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets. For case $k$ in order $k=1,2,3,4,5$, append the six values $[f_{\\text{pos}},f_{\\text{neg}},I_1,I_2,I_3,I_4]$ to the final list, so the final output is a flat list of $30$ floats in the order of the test suite.\n\nAll values are dimensionless and must be reported as floats. Angles are not involved in this problem, so no angle unit is required. The program must be fully self-contained and must not read input files; it should embed the test suite as specified above and print the final answer exactly in the required format.",
            "solution": "The problem requires the computation of area fractions and enriched shape function integrals for a four-node quadrilateral element intersected by a crack. The crack is defined by the level-set function $\\phi(x,y) = y$, which corresponds to a horizontal line at $y=0$. The enrichment is based on the Heaviside function $H(\\phi)$, which is $1$ for $\\phi > 0$ and $0$ for $\\phi < 0$. The integral of interest for each standard shape function $N_I$ is thus:\n$$ I_I = \\int_{\\Omega_e} N_I(x,y)\\,H(\\phi(x,y))\\,\\mathrm{d}A $$\nwhere $\\Omega_e$ is the domain of the finite element. Given the definition of $H(\\phi(x,y)) = H(y)$, the integral simplifies to an integration over the part of the element where $y>0$:\n$$ I_I = \\int_{\\Omega_e \\cap \\{y>0\\}} N_I(x,y)\\,\\mathrm{d}A = \\int_{\\Omega_e^+} N_I(x,y)\\,\\mathrm{d}A $$\nThe domain $\\Omega_e^+$ is the portion of the element with a positive $y$-coordinate. The problem specifies that the line $y=0$ has zero measure and does not contribute to the area or the integral.\n\nThe solution process for each test case involves the following steps:\n1.  **Geometric Characterization**: Define the element's geometry and identify the integration domain $\\Omega_e^+$.\n2.  **Area Fraction Calculation**: Compute the areas of the element $|\\Omega_e|$, the positive part $|\\Omega_e^+|$, and the negative part $|\\Omega_e^-|$, then find the fractions $f_{\\text{pos}} = |\\Omega_e^+|/|\\Omega_e|$ and $f_{\\text{neg}} = |\\Omega_e^-|/|\\Omega_e|$.\n3.  **Numerical Integration**: Triangulate the domain $\\Omega_e^+$ and apply a 3-point quadrature rule on each triangle to compute the integrals $I_I$.\n\nLet's detail each step.\n\n**1. Geometric Characterization and Clipping**\nFor each test case, the element is an axis-aligned square or rectangle defined by four corner nodes. Let the coordinates of these nodes define the element's bounds: $x_{\\min}, x_{\\max}, y_{\\min}, y_{\\max}$. The element domain is $\\Omega_e = [x_{\\min}, x_{\\max}] \\times [y_{\\min}, y_{\\max}]$. The integration domain is $\\Omega_e^+ = \\Omega_e \\cap \\{(x,y) | y > 0\\}$. Since the element is an axis-aligned rectangle, the resulting domain $\\Omega_e^+$ is also a rectangle (or empty). We can identify $\\Omega_e^+$ by considering the element's y-range:\n- If $y_{\\min} \\ge 0$, the entire element is in the positive half-plane. Thus, $\\Omega_e^+ = \\Omega_e$.\n- If $y_{\\max} \\le 0$, the entire element is in the negative half-plane. Thus, $\\Omega_e^+$ is an empty set, and its area is $0$.\n- If $y_{\\min} < 0 < y_{\\max}$, the element is cut by the line $y=0$. The domain $\\Omega_e^+$ is a rectangle defined by $[x_{\\min}, x_{\\max}] \\times [0, y_{\\max}]$.\n\n**2. Area Fraction Calculation**\nThe total area of the element is $|\\Omega_e| = (x_{\\max}-x_{\\min})(y_{\\max}-y_{\\min}) = L_x L_y$. The area of the positive part, $|\\Omega_e^+|$, can be calculated from the vertices of the polygon defining $\\Omega_e^+$. A general method is the shoelace formula for a polygon with vertices $(x_1, y_1), (x_2, y_2), \\dots, (x_n, y_n)$:\n$$ |\\Omega_e^+| = \\frac{1}{2} \\left| \\sum_{i=1}^{n} (x_i y_{i+1} - x_{i+1} y_i) \\right| \\quad (\\text{with } (x_{n+1}, y_{n+1}) = (x_1, y_1)) $$\nThe area of the negative part is $|\\Omega_e^-| = |\\Omega_e| - |\\Omega_e^+|$. The area fractions are then:\n$$ f_{\\text{pos}} = \\frac{|\\Omega_e^+|}{|\\Omega_e|} \\quad \\text{and} \\quad f_{\\text{neg}} = \\frac{|\\Omega_e^-|}{|\\Omega_e|} = 1 - f_{\\text{pos}} $$\n\n**3. Numerical Integration**\nThe integrals $I_I$ are computed over $\\Omega_e^+$. If $|\\Omega_e^+| = 0$, then $I_I=0$ for all $I$. Otherwise, we proceed with triangulation and quadrature.\n\n**3.1 Triangulation:**\nThe domain $\\Omega_e^+$, being a convex rectangle, can be trivially triangulated into two triangles. Let the vertices of rectangle $\\Omega_e^+$ be $v_1, v_2, v_3, v_4$ in counter-clockwise order. We can form two triangles, $T_1 = (v_1, v_2, v_3)$ and $T_2 = (v_1, v_3, v_4)$.\n\n**3.2 Quadrature Rule:**\nThe problem specifies a 3-point quadrature rule for triangles that is exact for polynomials of degree up to $2$. For a triangle $T$ with vertices $p_1, p_2, p_3$, the integral of a function $f(x,y)$ is approximated as:\n$$ \\int_T f(x,y) \\, \\mathrm{d}A \\approx |T| \\sum_{k=1}^{3} w_k f(q_k) $$\nwhere $|T|$ is the area of the triangle. The specified rule uses quadrature points $q_k$ at the midpoints of the triangle's sides, and equal weights $w_k = 1/3$.\n$$ q_1 = \\frac{p_1+p_2}{2}, \\quad q_2 = \\frac{p_2+p_3}{2}, \\quad q_3 = \\frac{p_3+p_1}{2} $$\nThe total integral over $\\Omega_e^+$ is the sum of integrals over its constituent triangles:\n$$ I_I = \\int_{T_1} N_I(x,y) \\, \\mathrm{d}A + \\int_{T_2} N_I(x,y) \\, \\mathrm{d}A $$\n\n**3.3 Shape Function Evaluation:**\nTo evaluate the shape functions $N_I(x,y)$ at a quadrature point $(x_q, y_q)$, we must first map this point from the physical domain to the parent domain $(\\xi_q, \\eta_q) \\in [-1,1]^2$. The mapping is given by:\n$$ \\xi_q = \\frac{2(x_q-x_c)}{L_x} \\quad \\text{and} \\quad \\eta_q = \\frac{2(y_q-y_c)}{L_y} $$\nwhere $L_x = x_{\\max}-x_{\\min}$, $L_y = y_{\\max}-y_{\\min}$, $x_c = (x_{\\min}+x_{\\max})/2$, and $y_c = (y_{\\min}+y_{\\max})/2$. Note that these parameters refer to the original, unclipped element. After computing $(\\xi_q,\\eta_q)$, we use the standard bilinear shape functions:\n\\begin{align*}\nN_1(\\xi_q, \\eta_q) &= \\frac{1}{4}(1-\\xi_q)(1-\\eta_q) \\\\\nN_2(\\xi_q, \\eta_q) &= \\frac{1}{4}(1+\\xi_q)(1-\\eta_q) \\\\\nN_3(\\xi_q, \\eta_q) &= \\frac{1}{4}(1+\\xi_q)(1+\\eta_q) \\\\\nN_4(\\xi_q, \\eta_q) &= \\frac{1}{4}(1-\\xi_q)(1+\\eta_q)\n\\end{align*}\nThe integrands $N_I(x,y)$ are bilinear functions of $(x,y)$, which are polynomials of degree $2$. The chosen quadrature rule is exact for such polynomials, so the numerical integration will produce the exact result, up to floating-point precision.\n\nThe entire procedure is implemented for each of the five test cases provided. For cases where the element is entirely above or below the crack, the calculations simplify significantly. If the element is entirely below ($y_{\\max} \\le 0$), then $f_{\\text{pos}}=0$, $f_{\\text{neg}}=1$, and all $I_I=0$. If it is entirely above ($y_{\\min} \\ge 0$), then $f_{\\text{pos}}=1$, $f_{\\text{neg}}=0$. In this case, the integral $\\int_{\\Omega_e} N_I \\mathrm{d}A$ can be calculated analytically:\n$$ \\int_{\\Omega_e} N_I \\mathrm{d}A = \\int_{-1}^{1}\\int_{-1}^{1} N_I(\\xi, \\eta) J \\mathrm{d}\\xi \\mathrm{d}\\eta = J \\int_{-1}^{1}\\int_{-1}^{1} N_I(\\xi, \\eta) \\mathrm{d}\\xi \\mathrm{d}\\eta = J \\times 1 = \\frac{L_x L_y}{4} $$\nThus, for a fully positive element, each integral $I_I$ equals one-quarter of the element's area. This provides a useful verification for the numerical implementation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases.\n    \"\"\"\n    \n    # Test suite: 5 square elements defined by corner nodes (x,y)\n    # Order: bottom-left, bottom-right, top-right, top-left.\n    test_cases = [\n        # Case 1: Symmetric split\n        [(-1.0, -1.0), (1.0, -1.0), (1.0, 1.0), (-1.0, 1.0)],\n        # Case 2: Entirely above y=0\n        [(2.0, 0.2), (3.0, 0.2), (3.0, 1.2), (2.0, 1.2)],\n        # Case 3: Entirely below y=0\n        [(-0.5, -2.0), (0.5, -2.0), (0.5, -1.0), (-0.5, -1.0)],\n        # Case 4: Asymmetric straddle of y=0\n        [(0.0, -0.2), (1.0, -0.2), (1.0, 0.8), (0.0, 0.8)],\n        # Case 5: Boundary case on y=0\n        [(0.0, 0.0), (1.0, 0.0), (1.0, 1.0), (0.0, 1.0)],\n    ]\n    \n    all_results = []\n    for case_nodes in test_cases:\n        results = compute_for_element(case_nodes)\n        all_results.extend(results)\n\n    # Format the final output string\n    output_str = f\"[{','.join(f'{val:.15f}' for val in all_results)}]\"\n    print(output_str)\n\ndef compute_for_element(nodes):\n    \"\"\"\n    Computes area fractions and enriched integrals for a single element.\n\n    Args:\n        nodes (list of tuples): A list of four (x, y) coordinates for the\n                                element nodes in the order: BL, BR, TR, TL.\n\n    Returns:\n        list: A list of six float values: [f_pos, f_neg, I1, I2, I3, I4].\n    \"\"\"\n    nodes_arr = np.array(nodes, dtype=float)\n    x_coords, y_coords = nodes_arr[:, 0], nodes_arr[:, 1]\n    \n    x_min, x_max = np.min(x_coords), np.max(x_coords)\n    y_min, y_max = np.min(y_coords), np.max(y_coords)\n\n    L_x = x_max - x_min\n    L_y = y_max - y_min\n    \n    if L_x == 0 or L_y == 0: # Degenerate element\n        return [0.0] * 6\n\n    element_area = L_x * L_y\n    \n    # 1. Determine the vertices of the positive polygon Omega_e^+\n    positive_polygon_verts = []\n    if y_max <= 0:\n        # Element is entirely below or on the crack line\n        positive_area = 0.0\n    elif y_min >= 0:\n        # Element is entirely above or on the crack line\n        positive_polygon_verts = [(x_min, y_min), (x_max, y_min), (x_max, y_max), (x_min, y_max)]\n        positive_area = element_area\n    else: # y_min < 0 < y_max\n        # Element is cut by the crack\n        positive_polygon_verts = [(x_min, 0), (x_max, 0), (x_max, y_max), (x_min, y_max)]\n        positive_area = L_x * y_max\n        \n    # 2. Calculate area fractions\n    f_pos = positive_area / element_area\n    f_neg = 1.0 - f_pos\n\n    # 3. Calculate integrals I1, I2, I3, I4\n    integrals = np.zeros(4)\n    if not positive_polygon_verts:\n        return [f_pos, f_neg, 0.0, 0.0, 0.0, 0.0]\n        \n    # --- Triangulation and Quadrature ---\n    # The positive polygon is always a rectangle, so we can split it into two triangles.\n    # Vertices v1, v2, v3, v4 in CCW order\n    v1, v2, v3, v4 = [np.array(p) for p in positive_polygon_verts]\n    triangles = [(v1, v2, v3), (v1, v3, v4)]\n\n    # Element mapping parameters\n    x_c = (x_min + x_max) / 2.0\n    y_c = (y_min + y_max) / 2.0\n    \n    for tri_verts in triangles:\n        p1, p2, p3 = tri_verts\n        \n        # Triangle area using cross product\n        tri_area = 0.5 * np.abs(np.cross(p2 - p1, p3 - p1))\n        \n        # 3-point quadrature: midpoints of sides, weights are 1/3\n        q_points = [\n            (p1 + p2) / 2.0,\n            (p2 + p3) / 2.0,\n            (p3 + p1) / 2.0,\n        ]\n        \n        n_vals_at_q_points = np.zeros((3, 4))\n        for i, q_point in enumerate(q_points):\n            x_q, y_q = q_point\n            \n            # Map physical coords (x_q, y_q) to parent coords (xi, eta)\n            xi = 2.0 * (x_q - x_c) / L_x if L_x != 0 else 0\n            eta = 2.0 * (y_q - y_c) / L_y if L_y != 0 else 0\n            \n            # Evaluate shape functions N_I(xi, eta)\n            N1 = 0.25 * (1 - xi) * (1 - eta)\n            N2 = 0.25 * (1 + xi) * (1 - eta)\n            N3 = 0.25 * (1 + xi) * (1 + eta)\n            N4 = 0.25 * (1 - xi) * (1 + eta)\n            n_vals_at_q_points[i, :] = [N1, N2, N3, N4]\n\n        # Sum contributions from quadrature points\n        # (weight is 1/3 for all points)\n        avg_n_vals = np.mean(n_vals_at_q_points, axis=0)\n        integrals += tri_area * avg_n_vals\n        \n    return [f_pos, f_neg] + integrals.tolist()\n    \n# Run the solver\nsolve()\n\n```"
        },
        {
            "introduction": "A complete and accurate finite element model requires the correct application of boundary conditions. In XFEM, enforcing prescribed displacements (Dirichlet conditions) on boundaries that are intersected by a crack is a notoriously subtle but critical task. A naive enforcement can inadvertently introduce non-physical constraints on the crack's behavior, such as artificially pinning the crack opening at the boundary, leading to incorrect stress calculations and flawed fracture predictions.\n\nThis exercise examines the complex interaction between the enriched DOFs, which govern the crack kinematics, and the physical constraints imposed on the domain's boundary . It challenges you to distinguish between incorrect, over-constraining methods and robust, mathematically consistent techniques like weak imposition (e.g., Nitsche’s method) or fading enrichment functions. Developing this nuanced understanding is crucial for building reliable and predictive models of cracked bodies where discontinuities interact with external surfaces.",
            "id": "3524306",
            "problem": "In linear elastic small-strain computational geomechanics, let a body occupying a domain $\\Omega \\subset \\mathbb{R}^d$ with $d \\in \\{2,3\\}$ contain a crack $\\Gamma_c$ described implicitly by a signed distance level-set $\\phi(\\mathbf{x})$, with the convention that $H(\\phi(\\mathbf{x})) \\in \\{-1,+1\\}$ denotes the Heaviside function for the two sides of the crack. The external boundary $\\partial \\Omega$ is decomposed into a Dirichlet part $\\Gamma_D$ and a Neumann part $\\Gamma_N$, with a prescribed displacement $\\bar{\\mathbf{u}}(\\mathbf{x})$ on $\\Gamma_D$. The extended finite element method (XFEM) approximation of the displacement field uses the partition of unity concept and reads\n$$\n\\mathbf{u}_h(\\mathbf{x}) \\;=\\; \\sum_{i \\in I} N_i(\\mathbf{x})\\,\\mathbf{u}_i \\;+\\; \\sum_{j \\in I_H} N_j(\\mathbf{x})\\,H(\\phi(\\mathbf{x}))\\,\\mathbf{a}_j \\;+\\; \\sum_{k \\in I_T} N_k(\\mathbf{x}) \\sum_{\\alpha=1}^{4} F_\\alpha(\\mathbf{x})\\,\\mathbf{b}_{k\\alpha},\n$$\nwhere $N_i(\\mathbf{x})$ are standard shape functions, $I$ is the set of all nodes, $I_H$ is the set of nodes enriched with the jump (Heaviside) function, $I_T$ is the set of nodes enriched with crack-tip functions $F_\\alpha(\\mathbf{x})$, and $\\{\\mathbf{u}_i\\}$, $\\{\\mathbf{a}_j\\}$, and $\\{\\mathbf{b}_{k\\alpha}\\}$ are the associated degrees of freedom (DOFs). Assume Lagrangian elements so that $N_i(\\mathbf{x}_i)=1$ and $N_{m \\neq i}(\\mathbf{x}_i)=0$, and assume the commonly used shifted enrichment so that $N_j(\\mathbf{x})\\,[H(\\phi(\\mathbf{x}))-H(\\phi(\\mathbf{x}_j))]$ replaces $N_j(\\mathbf{x})\\,H(\\phi(\\mathbf{x}))$ in actual implementation, ensuring that enriched shape functions vanish at enriched nodes.\n\nConsider the nontrivial case in which the crack $\\Gamma_c$ intersects the Dirichlet boundary $\\Gamma_D$ at a point $\\mathbf{x}^\\ast$, so that at least one boundary node $i \\in \\Gamma_D$ belongs to the support of enrichment (e.g., is cut by the crack or lies in a tip-enriched region). The physical boundary displacement on $\\Gamma_D$ must be enforced without overconstraining the enriched approximation, especially at boundary nodes whose supports are cut by $\\Gamma_c$. Let $\\mathbf{u}_h^\\pm$ denote the trace of $\\mathbf{u}_h$ on $\\Gamma_D$ approached from the $\\pm$ side of the crack as determined by $H(\\phi)$, and note that along any open boundary segment of $\\Gamma_D$ away from $\\mathbf{x}^\\ast$ only one of the two traces exists.\n\nWhich of the following statements correctly describe a consistent imposition of the Dirichlet condition on $\\Gamma_D$ in XFEM when cracks cut boundary nodes, and correctly treat enriched DOFs so as to avoid overconstraint? Select all that apply.\n\nA. Set all enriched DOFs associated with nodes on $\\Gamma_D$ to zero a priori and enforce $\\mathbf{u}_h=\\bar{\\mathbf{u}}$ by strongly prescribing only the standard DOFs $\\{\\mathbf{u}_i\\}$ on $\\Gamma_D$. This avoids any extra constraints by eliminating enrichment at the boundary.\n\nB. Impose the Dirichlet condition on the physical boundary trace $\\mathbf{u}_h^\\pm$ along the actual boundary side using a weak imposition (such as Lagrange multipliers, Nitsche’s method, or a penalty approach) integrated over $\\Gamma_D$, so that the constraint acts only on the linear combination of standard and enriched DOFs that contributes to the boundary-side trace; enriched DOFs that contribute only to the opposite crack side are left unconstrained by the boundary condition.\n\nC. Strongly prescribe the nodal values at all boundary nodes by setting both the standard DOFs and all enriched DOFs at those nodes equal to the prescribed displacement $\\bar{\\mathbf{u}}(\\mathbf{x}_i)$, thereby enforcing the same displacement on each DOF present at a boundary node cut by the crack.\n\nD. Modify the enrichment near $\\Gamma_D$ by multiplying the enrichment with a $C^0$ ramp function $r(\\mathbf{x})$ that vanishes on $\\Gamma_D$ and is positive away from it, so that the enriched contribution to the boundary trace is identically zero on $\\Gamma_D$; then enforce the Dirichlet condition strongly on the standard DOFs only. This eliminates the need to constrain enriched DOFs on $\\Gamma_D$ and prevents overconstraint.\n\nE. Duplicate each cut boundary node into two coincident nodes, one per crack side, keep both sets of enriched DOFs, and apply the same prescribed displacement to both duplicates so that both boundary-side traces receive identical Dirichlet data at the node; this guarantees a non-overconstraining imposition at cut boundary nodes in XFEM.",
            "solution": "### Derivation and Option Analysis\n\nThe central issue in imposing Dirichlet boundary conditions on a crack-intersected boundary is that a single enriched node contributes to the displacement field on both sides of the crack. The boundary condition, however, applies only to the physical boundary, which is on one side of the crack. A naive strong enforcement on all degrees of freedom associated with a boundary node can lead to an over-constrained system, where the crack opening kinematics are artificially constrained, yielding physically incorrect results.\n\nLet's consider a node $j$ on the boundary $\\Gamma_D$ whose support is cut by the crack $\\Gamma_c$. The displacement at a point $\\mathbf{x} \\in \\Gamma_D$ within the support of node $j$ is given by the trace of $\\mathbf{u}_h(\\mathbf{x})$. Let's assume this part of the boundary corresponds to the '$+$' side of the crack, where $H(\\phi(\\mathbf{x})) = +1$. The displacement trace is:\n$$\n\\mathbf{u}_h^+(\\mathbf{x}) = \\sum_{i \\in I} N_i(\\mathbf{x})\\,\\mathbf{u}_i + \\sum_{j' \\in I_H} N_{j'}(\\mathbf{x})\\,(+1)\\,\\mathbf{a}_{j'} + \\dots\n$$\nThe Dirichlet condition requires $\\mathbf{u}_h^+(\\mathbf{x}) = \\bar{\\mathbf{u}}(\\mathbf{x})$ for all $\\mathbf{x} \\in \\Gamma_D$. This provides a constraint on a linear combination of the standard DOFs $\\{\\mathbf{u}_i\\}$ and enriched DOFs $\\{\\mathbf{a}_j\\}$. The enriched DOFs $\\{\\mathbf{a}_j\\}$, however, also define the displacement on the other side of the crack (the crack face), which is not part of $\\Gamma_D$:\n$$\n\\mathbf{u}_h^-(\\mathbf{x}) = \\sum_{i \\in I} N_i(\\mathbf{x})\\,\\mathbf{u}_i + \\sum_{j' \\in I_H} N_{j'}(\\mathbf{x})\\,(-1)\\,\\mathbf{a}_{j'} + \\dots\n$$\nThe crack opening is proportional to $\\mathbf{u}_h^+ - \\mathbf{u}_h^-$, which is directly related to the enriched DOFs $\\{\\mathbf{a}_j\\}$. An improper constraint on $\\{\\mathbf{a}_j\\}$ from the boundary condition can thus pollute the physics of the crack opening. The shifted enrichment mentioned in the problem, $N_j(\\mathbf{x})\\,[H(\\phi(\\mathbf{x}))-H(\\phi(\\mathbf{x}_j))]$, simplifies strong imposition at nodes but does not resolve the fundamental issue of constraining the function over the entire boundary element face.\n\nWe will now evaluate each option based on its ability to provide a consistent and well-posed enforcement of the boundary condition.\n\n**Option A: Set all enriched DOFs associated with nodes on $\\Gamma_D$ to zero a priori and enforce $\\mathbf{u}_h=\\bar{\\mathbf{u}}$ by strongly prescribing only the standard DOFs $\\{\\mathbf{u}_i\\}$ on $\\Gamma_D$. This avoids any extra constraints by eliminating enrichment at the boundary.**\n\nThis approach suggests setting $\\mathbf{a}_j = \\mathbf{0}$ and $\\mathbf{b}_{k\\alpha} = \\mathbf{0}$ for all nodes $j,k$ on $\\Gamma_D$. With the enriched DOFs being zero, the XFEM approximation in the support of these nodes reduces to the standard FEM approximation, $\\mathbf{u}_h(\\mathbf{x}) = \\sum N_i(\\mathbf{x})\\mathbf{u}_i$. The Dirichlet condition can then be applied strongly to the standard DOFs $\\{\\mathbf{u}_i\\}$ without over-constraint. While this procedure is mathematically simple and leads to a solvable system, it is physically inconsistent with the problem of a crack reaching a boundary. Setting the enriched DOFs to zero forces the displacement jump across the crack to be zero throughout the enriched region associated with the boundary node. This effectively \"heals\" or \"closes\" the crack in a finite region near the boundary, which is a significant and generally incorrect modeling error. It is an overly simplistic method that sacrifices accuracy for convenience. From a rigorous standpoint, it is not a consistent imposition as it fails to represent the problem physics correctly.\n\n**Verdict: Incorrect.**\n\n**Option B: Impose the Dirichlet condition on the physical boundary trace $\\mathbf{u}_h^\\pm$ along the actual boundary side using a weak imposition (such as Lagrange multipliers, Nitsche’s method, or a penalty approach) integrated over $\\Gamma_D$, so that the constraint acts only on the linear combination of standard and enriched DOFs that contributes to the boundary-side trace; enriched DOFs that contribute only to the opposite crack side are left unconstrained by the boundary condition.**\n\nThis statement accurately describes the modern and most robust approach to this problem. Weak imposition methods enforce the condition $\\mathbf{u}_h = \\bar{\\mathbf{u}}$ in an integral sense over $\\Gamma_D$. For example, a penalty method adds a term like $\\frac{\\beta}{2}\\int_{\\Gamma_D} (\\mathbf{u}_h - \\bar{\\mathbf{u}}) \\cdot (\\mathbf{u}_h - \\bar{\\mathbf{u}}) \\,d\\Gamma$ to the potential energy, where $\\beta$ is a large penalty parameter. Because the integral is taken over the physical boundary $\\Gamma_D$, it only involves the trace of $\\mathbf{u}_h$ on the relevant side of the crack (e.g., $\\mathbf{u}_h^+$). The formulation naturally applies the constraint to the specific linear combination of $\\{\\mathbf{u}_i\\}$, $\\{\\mathbf{a}_j\\}$, etc., that constitutes this trace. The degrees of freedom are not individually constrained a priori. The resulting system of equations determines the values of all DOFs, including the enriched ones, in a way that satisfies both the bulk equilibrium equations and the boundary condition in a weak sense. This method does not impose any artificial constraints on the crack opening and has been shown to be consistent and to yield optimal convergence rates. Nitsche's method is a particularly popular and elegant technique in this class. The description is precise and correct.\n\n**Verdict: Correct.**\n\n**Option C: Strongly prescribe the nodal values at all boundary nodes by setting both the standard DOFs and all enriched DOFs at those nodes equal to the prescribed displacement $\\bar{\\mathbf{u}}(\\mathbf{x}_i)$, thereby enforcing the same displacement on each DOF present at a boundary node cut by the crack.**\n\nThis approach is fundamentally flawed. The standard DOF $\\mathbf{u}_i$ represents a nodal displacement, but the enriched DOF $\\mathbf{a}_j$ represents the magnitude of the displacement jump across the crack. They are physically and dimensionally distinct quantities. Setting $\\mathbf{a}_j = \\bar{\\mathbf{u}}(\\mathbf{x}_j)$ is physically meaningless and constitutes an arbitrary, incorrect constraint on the crack opening. Even if one were to set $\\mathbf{a}_j = \\mathbf{0}$, this would still be an ad-hoc constraint. Trying to enforce the same value on different types of DOFs is a quintessential example of over-constraining the system based on a misunderstanding of the XFEM basis.\n\n**Verdict: Incorrect.**\n\n**Option D: Modify the enrichment near $\\Gamma_D$ by multiplying the enrichment with a $C^0$ ramp function $r(\\mathbf{x})$ that vanishes on $\\Gamma_D$ and is positive away from it, so that the enriched contribution to the boundary trace is identically zero on $\\Gamma_D$; then enforce the Dirichlet condition strongly on the standard DOFs only. This eliminates the need to constrain enriched DOFs on $\\Gamma_D$ and prevents overconstraint.**\n\nThis describes a valid and known technique, often referred to as a \"fading enrichment\" or \"boundary-corrected XFEM\". The enriched part of the approximation is modified, for example, to $N_j(\\mathbf{x}) r(\\mathbf{x}) H(\\phi(\\mathbf{x})) \\mathbf{a}_j$. Since the ramp function $r(\\mathbf{x})$ is constructed to be zero for any $\\mathbf{x} \\in \\Gamma_D$, the entire enrichment term vanishes on the Dirichlet boundary. Consequently, the trace of the displacement on $\\Gamma_D$ becomes $\\mathbf{u}_h|_{\\Gamma_D} = \\sum N_i(\\mathbf{x}) \\mathbf{u}_i|_{\\Gamma_D}$. One can then apply the Dirichlet condition strongly via the standard DOFs (e.g., $\\mathbf{u}_i = \\bar{\\mathbf{u}}(\\mathbf{x}_i)$ for nodes on $\\Gamma_D$) without any risk of over-constraint, as the enriched DOFs $\\{\\mathbf{a}_j\\}$ do not appear in the boundary constraint equation. This method provides a mathematically consistent way to formulate a well-posed problem. It implicitly imposes the physical constraint that the crack opening is zero exactly at the boundary, which is a more localized and refined approach than that of Option A. This is a recognized method in the XFEM literature.\n\n**Verdict: Correct.**\n\n**Option E: Duplicate each cut boundary node into two coincident nodes, one per crack side, keep both sets of enriched DOFs, and apply the same prescribed displacement to both duplicates so that both boundary-side traces receive identical Dirichlet data at the node; this guarantees a non-overconstraining imposition at cut boundary nodes in XFEM.**\n\nThis procedure is conceptually inconsistent with the fundamental principle of XFEM. The XFEM enriches the approximation space on a fixed, underlying mesh without altering the mesh connectivity or topology. Duplicating nodes is a topological modification characteristic of other methods, such as standard finite elements with discontinuous interface elements or some phantom node methods. The XFEM formulation given in the problem, based on a single set of partition of unity functions $\\{N_i\\}$, is incompatible with the concept of coincident but distinct nodes. This option describes a different type of method altogether and misrepresents it as an XFEM procedure.\n\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{BD}$$"
        }
    ]
}