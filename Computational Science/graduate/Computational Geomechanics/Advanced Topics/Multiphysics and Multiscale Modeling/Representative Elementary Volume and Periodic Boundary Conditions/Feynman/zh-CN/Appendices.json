{
    "hands_on_practices": [
        {
            "introduction": "对于其材料属性（如刚度）在空间上随机变化的非均质土工材料，我们需要定义一个统计意义上的代表性体积元（REV）。一个关键的理论和实践问题是“这个体积元需要多大才能准确代表整体材料的平均行为？”。本练习将引导你通过一个具体的计算，学习如何基于材料属性的空间相关性结构，以及对均质化属性可接受的误差范围，来定量地估算所需的最小REV尺寸。",
            "id": "3556458",
            "problem": "一种非均质线性弹性岩土材料被建模为一个具有各向同性系综平均值的局部刚度涨落的平稳遍历随机场。设局部刚度的各向异性偏差由一个无量纲标量场 $a(\\mathbf{x})$ 表示，该标量场量化了局部刚度的方向性对比度（例如，两个正交模量之差的归一化度量），其系综平均值为零，方差为一，即 $\\mathbb{E}[a(\\mathbf{x})]=0$ 且 $\\mathrm{Var}[a(\\mathbf{x})]=1$。假设 $a(\\mathbf{x})$ 具有一个可分离的指数型两点相关函数\n$$\n\\rho(\\mathbf{r}) \\equiv \\mathbb{E}[a(\\mathbf{x})\\,a(\\mathbf{x}+\\mathbf{r})] = \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x} - \\frac{|r_y|}{\\ell_y} - \\frac{|r_z|}{\\ell_z}\\right),\n$$\n其中 $\\ell_x,\\ell_y,\\ell_z$ 是方向相关长度。在周期性边界条件（PBC）下，等效刚度在一个尺寸为 $L_x \\times L_y \\times L_z$ 的矩形单元上计算，平均刚度的各向异性被取为 $a(\\mathbf{x})$ 在该单元上的体积平均值的大小，\n$$\n\\bar{a} = \\frac{1}{V}\\int_V a(\\mathbf{x})\\,\\mathrm{d}V, \\quad V=L_x L_y L_z,\n$$\n在 PBC 和 Hill–Mandel 宏观均匀性条件下，该体积平均值是系综平均各向异性的一个无偏估计量。对于代表性体积单元（REV）的选择，要求 $\\bar{a}$ 的标准差不超过 $0.05$，从而在一个标准差的意义上，平均刚度的各向异性低于百分之五。\n\n使用平稳随机场的体积平均值方差的渐近关系，\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{1}{V}\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} \\quad \\text{for } \\min\\{L_x,L_y,L_z\\} \\gg \\max\\{\\ell_x,\\ell_y,\\ell_z\\},\n$$\n并假设选择的单元尺寸为边长为 $L$ 的立方体，计算保证 $\\sqrt{\\mathrm{Var}(\\bar{a})} \\le 0.05$ 的最小边长 $L_{\\min}$。将你的最终答案表示为关于 $\\ell_x,\\ell_y,\\ell_z$ 的闭式解析表达式，其中 $L_{\\min}$ 的长度单位与 $\\ell_x,\\ell_y,\\ell_z$ 相同。不要以不等式形式给出答案；请提供 $L_{\\min}$ 的显式表达式。",
            "solution": "问题要求确定一个立方计算单元的最小边长 $L_{\\min}$，该边长能保证体积平均各向异性 $\\bar{a}$ 的标准差不超过 $0.05$。分析从所提供的平稳随机场 $a(\\mathbf{x})$ 的体积平均值方差的渐近关系开始。\n\n体积平均值 $\\bar{a}$ 的方差由下列表达式给出：\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{1}{V}\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r}\n$$\n其中 $V$ 是平均域的体积，$\\rho(\\mathbf{r})$ 是两点相关函数。\n\n第一步是计算给定的相关函数在整个三维空间 $\\mathbb{R}^3$ 上的积分。相关函数为：\n$$\n\\rho(\\mathbf{r}) = \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x} - \\frac{|r_y|}{\\ell_y} - \\frac{|r_z|}{\\ell_z}\\right)\n$$\n由于指数函数的可分离性，该三重积分可以表示为三个一维积分的乘积：\n$$\n\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_x|}{\\ell_x}\\right) \\mathrm{d}r_x \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_y|}{\\ell_y}\\right) \\mathrm{d}r_y \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|r_z|}{\\ell_z}\\right) \\mathrm{d}r_z \\right)\n$$\n我们计算这些积分的一般形式。对于一个通用变量 $u$ 和相关长度 $\\ell$：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{|u|}{\\ell}\\right) \\mathrm{d}u = 2 \\int_{0}^{\\infty} \\exp\\!\\left(-\\frac{u}{\\ell}\\right) \\mathrm{d}u = 2 \\left[ -\\ell \\exp\\!\\left(-\\frac{u}{\\ell}\\right) \\right]_{0}^{\\infty} = 2\\ell\n$$\n将此结果应用于三个方向积分中的每一个，我们得到相关函数的总积分为：\n$$\n\\int_{\\mathbb{R}^3}\\rho(\\mathbf{r})\\,\\mathrm{d}\\mathbf{r} = (2\\ell_x) (2\\ell_y) (2\\ell_z) = 8\\ell_x\\ell_y\\ell_z\n$$\n问题指定了一个边长为 $L$ 的立方计算单元，所以其体积为 $V = L^3$。将积分结果和体积代入方差公式，得到：\n$$\n\\mathrm{Var}(\\bar{a}) \\approx \\frac{8\\ell_x\\ell_y\\ell_z}{L^3}\n$$\n代表性体积单元（REV）的选择标准是 $\\bar{a}$ 的标准差不得超过 $0.05$：\n$$\n\\sqrt{\\mathrm{Var}(\\bar{a})} \\le 0.05\n$$\n代入方差的表达式：\n$$\n\\sqrt{\\frac{8\\ell_x\\ell_y\\ell_z}{L^3}} \\le 0.05\n$$\n为了找到最小边长 $L_{\\min}$，我们求解此不等式边界处的方程：\n$$\n\\sqrt{\\frac{8\\ell_x\\ell_y\\ell_z}{L_{\\min}^3}} = 0.05\n$$\n两边平方得到：\n$$\n\\frac{8\\ell_x\\ell_y\\ell_z}{L_{\\min}^3} = (0.05)^2 = \\left(\\frac{1}{20}\\right)^2 = \\frac{1}{400}\n$$\n现在，我们求解 $L_{\\min}^3$：\n$$\nL_{\\min}^3 = 400 \\times 8 \\ell_x\\ell_y\\ell_z = 3200 \\ell_x\\ell_y\\ell_z\n$$\n最后，对两边取立方根，得到所需最小边长 $L_{\\min}$ 的表达式：\n$$\nL_{\\min} = \\sqrt[3]{3200 \\ell_x\\ell_y\\ell_z}\n$$\n数值系数可以被简化。我们注意到 $3200 = 8 \\times 400 = 2^3 \\times 400$。因此，我们可以写成：\n$$\nL_{\\min} = 2\\sqrt[3]{400 \\ell_x\\ell_y\\ell_z}\n$$\n这就是最小边长的最终闭式表达式。",
            "answer": "$$\n\\boxed{2\\sqrt[3]{400 \\ell_x \\ell_y \\ell_z}}\n$$"
        },
        {
            "introduction": "在确定了REV的尺寸后，我们还必须考虑其几何形状，这在有限元等数值模拟中尤为重要。理论上，对于一个完美的周期性微观结构，任何能够完整描述其重复单元的晶胞（无论是立方体、长方体还是斜向的平行六面体）都应得到完全相同的均质化属性。然而，本练习将揭示一个关键的实践问题：尽管理论上等效，不同形状的单元在数值计算中的表现可能天差地别。通过分析不同单元形状对周期性边界条件（PBC）约束方程数值条件数的影响，你将理解为何选择一个“形状良好”的单元对于保证计算结果的准确性和稳定性至关重要。",
            "id": "3556470",
            "problem": "考虑一个周期性颗粒复合材料的代表性体积单元（REV），在周期性边界条件（PBC）下通过有限元法（FEM）进行分析。设该REV由其晶格矢量 $\\mathbf{a}_1$、$\\mathbf{a}_2$、$\\mathbf{a}_3$ 参数化，这些矢量构成了晶格矩阵 $\\mathbf{A} \\in \\mathbb{R}^{3 \\times 3}$ 的列。对于具有宏观应变张量 $\\boldsymbol{E}$ 的宏观均匀变形，周期性运动学约束规定了波动位移场 $\\tilde{\\mathbf{u}}(\\mathbf{x})$ 是周期性的，并且总位移满足\n$$\n\\mathbf{u}(\\mathbf{x} + \\mathbf{a}_i) - \\mathbf{u}(\\mathbf{x}) = \\boldsymbol{E}\\,\\mathbf{a}_i,\\quad i \\in \\{1,2,3\\},\n$$\n其中 $\\mathbf{u}(\\mathbf{x}) = \\boldsymbol{E}\\,\\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$。宏观应力 $\\boldsymbol{\\Sigma}$ 通过 Hill–Mandel 宏观均匀性条件定义\n$$\n\\langle \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\rangle = \\boldsymbol{\\Sigma} : \\boldsymbol{E},\n$$\n其中尖括号表示REV的体积平均，$\\boldsymbol{\\sigma}$ 是微观应力，$\\boldsymbol{\\varepsilon}$ 是微观应变。\n\n在PBC的拉格朗日乘子实现中，多点约束将由每个晶格矢量分隔的相对面上的节点位移联系起来。约束子系统的数值条件受到晶格矢量几何形状的影响，具体体现在矩阵 $\\mathbf{A}$ 的奇异值（等效地，Gram矩阵 $\\mathbf{G} = \\mathbf{A}^{\\top}\\mathbf{A}$ 的特征值）上。不良的条件数会影响计算出的有效模量的准确性，尽管在精确施加PBC的情况下，给定微观结构的精确均匀化模量与单元胞形状的选择无关。\n\n分析以下三种单元胞形状，每种形状都在固定的标准正交基 $\\{\\mathbf{e}_1,\\mathbf{e}_2,\\mathbf{e}_3\\}$ 中定义，长度参数为 $L > 0$：\n\n情况 $\\mathrm{I}$ (立方体): $\\mathbf{a}_1 = L\\,\\mathbf{e}_1$, $\\mathbf{a}_2 = L\\,\\mathbf{e}_2$, $\\mathbf{a}_3 = L\\,\\mathbf{e}_3$。\n\n情况 $\\mathrm{II}$ (具有长宽比的矩形平行六面体): $\\mathbf{a}_1 = L\\,\\mathbf{e}_1$, $\\mathbf{a}_2 = 10L\\,\\mathbf{e}_2$, $\\mathbf{a}_3 = L\\,\\mathbf{e}_3$。\n\n情况 $\\mathrm{III}$ (在 $\\mathbf{e}_1$–$\\mathbf{e}_2$ 平面内偏斜的平行六面体): $\\mathbf{a}_1 = L\\,\\mathbf{e}_1$, $\\mathbf{a}_2 = L(\\cos\\theta\\,\\mathbf{e}_1 + \\sin\\theta\\,\\mathbf{e}_2)$, $\\mathbf{a}_3 = L\\,\\mathbf{e}_3$，其中 $\\theta = 5^\\circ$。\n\n从上述定义出发，不假设任何专门的稳定化技巧，运用第一性原理来论证单元胞形状如何通过 $\\mathbf{A}$ 影响PBC约束方程的数值条件，并解释其对计算各向同性线弹性微结构的有效模量的影响。通过将三个案例的条件数 $\\kappa(\\mathbf{A})$ 与 $\\mathbf{A}$ 的奇异值或 $\\mathbf{G}$ 的特征值联系起来，估算并比较它们。然后，从以下陈述中选择与您的分析最一致的唯一最佳选项。\n\nA. 在精确的周期性边界条件（PBC）下，给定微观结构的有效模量与单元胞形状无关。然而，约束子系统的数值条件会随着长宽比的增加或导致晶格矢量趋向共线性的偏斜而恶化；对于情况 $\\mathrm{II}$ 和情况 $\\mathrm{III}$，$\\mathbf{A}$ 的奇异值分布范围更广，导致 $\\kappa(\\mathbf{A})$ 大于情况 $\\mathrm{I}$。使用晶格度规（或标准正交晶格基）对约束进行归一化可以降低条件数并提高鲁棒性。\n\nB. 将单元胞从立方体变为偏斜体会在物理上改变均匀化模量，因为宏观变形路径依赖于单元胞形状；如果使用相同数量的节点，数值条件在很大程度上不受长宽比或偏斜度的影响。\n\nC. 具有高长宽比的矩形单元总是能改善数值条件，因为较大的面减少了约束耦合；PBC下有效模量的不变性仅对各向同性RVE成立，而对各向异性微观结构则不成立。\n\nD. 偏斜单元提供更优的条件，因为约束方向的线性无关性更强；然而，即使在精确施加PBC的情况下，它们也会通过在宏观应变中引入意外的剪切来使计算出的有效模量产生偏差。",
            "solution": "本题旨在分析不同单元胞几何形状对周期性边界条件（PBC）约束方程数值条件的影响。问题的核心在于评估晶格矩阵 $\\mathbf{A}$ 的条件数 $\\kappa(\\mathbf{A})$，它量化了由PBC诱导的线性约束系统的病态程度。条件数定义为最大奇异值与最小奇异值之比，$\\kappa(\\mathbf{A}) = s_{\\max}/s_{\\min}$。一个接近1的条件数表示系统是良态的，而一个大的条件数则表示系统是病态的，这会放大计算中的数值误差。$\\mathbf{A}$ 的奇异值是其格拉姆矩阵（Gram matrix） $\\mathbf{G} = \\mathbf{A}^{\\top}\\mathbf{A}$ 特征值的平方根。\n\n我们为三种情况分别计算晶格矩阵 $\\mathbf{A}$ 及其条件数：\n\n**情况 I (立方体):** $\\mathbf{A}_{\\mathrm{I}} = L\\mathbf{I}$。所有奇异值均为 $L$。因此，$\\kappa(\\mathbf{A}_{\\mathrm{I}}) = L/L = 1$。这是最优条件数。\n\n**情况 II (矩形平行六面体):** $\\mathbf{A}_{\\mathrm{II}}$ 是一个对角矩阵，对角元素为 $L, 10L, L$。奇异值为 $10L$ 和 $L$。因此，$\\kappa(\\mathbf{A}_{\\mathrm{II}}) = 10L/L = 10$。高长宽比导致条件数变差。\n\n**情况 III (偏斜平行六面体):** 晶格矩阵为 $\\mathbf{A}_{\\mathrm{III}} = \\begin{pmatrix} L  L\\cos\\theta  0 \\\\ 0  L\\sin\\theta  0 \\\\ 0  0  L \\end{pmatrix}$。其格拉姆矩阵的特征值为 $\\lambda_{\\max} = L^2(1+\\cos\\theta)$, $\\lambda_{\\mathrm{mid}} = L^2$, 和 $\\lambda_{\\min} = L^2(1-\\cos\\theta)$。条件数为 $\\kappa(\\mathbf{A}_{\\mathrm{III}}) = \\sqrt{\\lambda_{\\max}/\\lambda_{\\min}} = \\sqrt{\\frac{1+\\cos\\theta}{1-\\cos\\theta}} = |\\cot(\\theta/2)|$。对于 $\\theta = 5^\\circ$, $\\kappa(\\mathbf{A}_{\\mathrm{III}}) \\approx 22.9$。矢量接近共线导致严重的病态条件。\n\n**分析与结论:**\n- **理论 vs. 数值:** 根据均匀化理论，只要单元胞是有效的晶格单元，计算出的精确有效模量与单元胞的形状无关。然而，我们的计算表明，单元胞的几何形状（如高长宽比或偏斜）会严重影响约束系统的数值条件数。\n- **选项评估:**\n    - **A:** 正确指出有效模量的理论不变性，同时正确识别出单元胞形状对数值条件的实际影响，并提及了缓解方法。我们的计算证实了情况II和III的条件数比情况I大。\n    - **B:** 错误地声称有效模量会改变，且数值条件不受影响。\n    - **C:** 错误地声称高长宽比会改善条件，且理论不变性有局限。\n    - **D:** 错误地声称偏斜单元能改善条件，并错误地描述了其影响。\n\n因此，陈述A是唯一与理论和数值分析结果完全一致的选项。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "本节我们将理论付诸实践，通过编程来具体实现周期性边界条件。在计算模型中，正确施加PBC不仅意味着简单地连接相对的边界，还涉及到许多算法细节。本练习将指导你处理离散边界节点上的位移约束，学习如何利用“最小镜像约定”来准确检测跨越周期性边界的颗粒间的接触，并探讨如何通过施加额外的“规范约束”来消除可能导致数值不稳定的寄生刚体运动。",
            "id": "3556487",
            "problem": "考虑一个在小应变运动学下边长为 $L = 1$ 的二维方形代表性体积单元 (REV)。设微观位移场分解为一个施加的仿射部分和一个波动部分，即 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x} + \\mathbf{w}(\\mathbf{x})$，其中 $\\mathbf{E} \\in \\mathbb{R}^{2 \\times 2}$ 是宏观应变张量，$\\mathbf{w}(\\mathbf{x})$ 是周期性波动场。周期性边界条件要求在周期性对应的边界点上波动相等，而总位移差等于在对应晶格矢量上的仿射部分。在微观结构组分之间存在接触相互作用的情况下，必须确保跨周期性映像映射的接触与周期性得到一致处理。此外，周期性联结约束不得引入波动场的人为刚体运动。\n\n使用以下 REV 边界的离散边界表示，其中 8 个节点位于每条边的中点：\n- 左侧面：$\\mathbf{x}_{\\mathrm{L1}} = (0,\\,0.25)$，$\\mathbf{x}_{\\mathrm{L2}} = (0,\\,0.75)$，\n- 右侧面：$\\mathbf{x}_{\\mathrm{R1}} = (1,\\,0.25)$，$\\mathbf{x}_{\\mathrm{R2}} = (1,\\,0.75)$，\n- 底面：$\\mathbf{x}_{\\mathrm{B1}} = (0.25,\\,0)$，$\\mathbf{x}_{\\mathrm{B2}} = (0.75,\\,0)$，\n- 顶面：$\\mathbf{x}_{\\mathrm{T1}} = (0.25,\\,1)$，$\\mathbf{x}_{\\mathrm{T2}} = (0.75,\\,1)$。\n\n按如下方式在波动场上定义周期性联结。对于每一对具有相同横向坐标的相对面节点，施加\n$$\n\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = \\mathbf{0},\n$$\n并且对总位移施加\n$$\n\\mathbf{u}(\\mathbf{x}_+) - \\mathbf{u}(\\mathbf{x}_-) = \\mathbf{E}\\,(\\mathbf{x}_+ - \\mathbf{x}_-).\n$$\n在边界节点上以离散形式，使用约束矩阵 $A_{\\mathrm{w}}$ 将这些关系整合到节点波动矢量 $\\mathbf{w}_{\\mathrm{b}} \\in \\mathbb{R}^{16}$ 的线性系统中，使得 $A_{\\mathrm{w}}\\,\\mathbf{w}_{\\mathrm{b}} = \\mathbf{0}$，其中 $\\mathbf{w}_{\\mathrm{b}}$ 将 8 个边界节点上 $\\mathbf{w}$ 的 x 和 y 分量堆叠而成。总位移对应的联结系统是 $A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} = \\mathbf{b}$，其中 $\\mathbf{b}$ 由仿射差 $\\mathbf{E}(\\mathbf{x}_+ - \\mathbf{x}_-)$ 组装而成，$\\mathbf{u}_{\\mathrm{b}}$ 将边界节点上的 $\\mathbf{u}$ 堆叠而成。\n\n为测试接触，考虑 REV 内部由点（中心）表示的两个微观结构组分：\n- 颗粒 1 位于 $\\mathbf{x}_1 = (0.10,\\,0.50)$，半径为 $r_1$，\n- 颗粒 2 位于 $\\mathbf{x}_2 = (0.90,\\,0.50)$，半径为 $r_2$。\n\n使用周期性最小镜像约定来定义跨越周期性单元的 $\\mathbf{x}_1$ 和 $\\mathbf{x}_2$ 之间的最短矢量：\n$$\n\\Delta \\mathbf{x}_{\\mathrm{p}} = \\left( \\left( (x_2-x_1 + \\tfrac{L}{2}) \\bmod L \\right) - \\tfrac{L}{2},\\; \\left( (y_2-y_1 + \\tfrac{L}{2}) \\bmod L \\right) - \\tfrac{L}{2} \\right).\n$$\n标量间隙为\n$$\ng = \\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| - (r_1 + r_2),\n$$\n如果 $g \\le 0$，则接触被视为激活。\n\n波动场的刚体运动由两个平动和一个无穷小平面内转动所张成的子空间定义：\n- $x$-平动：$\\mathbf{t}_x$ 在所有边界节点上的分量为 $w_x = 1$ 和 $w_y = 0$，\n- $y$-平动：$\\mathbf{t}_y$ 在所有边界节点上的分量为 $w_x = 0$ 和 $w_y = 1$，\n- 无穷小转动：$\\mathbf{r}$ 在每个边界节点上的分量为 $\\mathbf{w}(\\mathbf{x}) = R\\,\\mathbf{x}$，其中 $R = \\begin{pmatrix} 0  -1 \\\\ 1  0 \\end{pmatrix}$。\n\n你的程序必须：\n1. 针对四个相对面节点对 $(\\mathrm{L1},\\mathrm{R1})$、$(\\mathrm{L2},\\mathrm{R2})$、$(\\mathrm{B1},\\mathrm{T1})$、$(\\mathrm{B2},\\mathrm{T2})$ 组装波动联结的 $A_{\\mathrm{w}}$。每对产生两个标量等式（针对 $x$ 和 $y$ 分量）。\n2. 可选地用规范约束增广 $A_{\\mathrm{w}}$ 以防止人为的刚体运动：\n   - 在参考节点 $\\mathbf{x}_{\\mathrm{ref}} = \\mathbf{x}_{\\mathrm{B1}}$ 处的钉扎约束：通过向 $A_{\\mathrm{w}}$ 添加两行来施加 $w_x(\\mathbf{x}_{\\mathrm{ref}}) = 0$ 和 $w_y(\\mathbf{x}_{\\mathrm{ref}}) = 0$。\n   - 可选的转动消除约束：通过向 $A_{\\mathrm{w}}$ 添加一行来施加 $\\sum_{i} \\left( -y_i\\,w_x(\\mathbf{x}_i) + x_i\\,w_y(\\mathbf{x}_i) \\right) = 0$。\n3. 通过检查 $A_{\\mathrm{w}}$ 是否在数值容差范围内零化每个矢量，确定三个刚体基矢量 $\\{\\mathbf{t}_x, \\mathbf{t}_y, \\mathbf{r}\\}$ 中有多少个位于 $A_{\\mathrm{w}}$ 的零空间中。将此计数报告为整数。\n4. 使用周期性最小镜像 $\\Delta \\mathbf{x}_{\\mathrm{p}}$ 和间隙 $g$ 评估周期性接触激活状态，并将接触是否激活报告为布尔值。\n5. 针对相同的四对节点组装联结方程的 $A_{\\mathrm{u}}$ 和 $\\mathbf{b}$。使用在边界节点上为 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x}$ 的纯仿射位移 $\\mathbf{u}_{\\mathrm{b}}$，计算残差矢量 $\\mathbf{r}_{\\mathrm{tie}} = A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} - \\mathbf{b}$，并将其无穷范数 $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 报告为浮点数。\n\n使用以下包含三个案例的测试套件，涵盖正常路径、边界条件遗漏和边缘情况：\n- 案例 1 (正常路径):\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0.01  0.02 \\\\ 0.02  -0.01 \\end{pmatrix}$，\n  - 规范：包括在 $\\mathbf{x}_{\\mathrm{B1}}$ 的钉扎，不包括转动消除约束，\n  - 半径：$r_1 + r_2 = 0.22$。\n- 案例 2 (边界条件遗漏):\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0.01  0.02 \\\\ 0.02  -0.01 \\end{pmatrix}$，\n  - 规范：不包括任何规范约束，\n  - 半径：$r_1 + r_2 = 0.15$。\n- 案例 3 (边缘情况):\n  - 宏观应变 $\\mathbf{E} = \\begin{pmatrix} 0  0.02 \\\\ 0.02  0 \\end{pmatrix}$，\n  - 规范：包括在 $\\mathbf{x}_{\\mathrm{B1}}$ 的钉扎并包括转动消除约束，\n  - 半径：$r_1 + r_2 = 0.20$。\n\n你的程序应为每个案例计算三元组 $[\\text{rbm\\_count}, \\text{contact\\_active}, \\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}]$，其中 $\\text{rbm\\_count}$ 是一个整数，$\\text{contact\\_active}$ 是一个布尔值，$\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 是一个浮点数。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，每个案例的三元组本身也表示为一个列表。例如，最终输出格式必须类似于 $[\\,[\\cdot,\\cdot,\\cdot],\\,[\\cdot,\\cdot,\\cdot],\\,[\\cdot,\\cdot,\\cdot]\\,]$。不需要物理单位；所有量纲均为无量纲。角度（如有）必须以弧度为单位，但此问题不需要角度输入。",
            "solution": "本题要求实现与二维代表性体积单元（REV）上的周期性边界条件（PBC）相关的几个计算任务。我们将按顺序完成这些任务。首先，建立离散化系统。REV边界由8个节点离散化，其坐标和索引如题目所述。波动位移矢量 $\\mathbf{w}_{\\mathrm{b}} \\in \\mathbb{R}^{16}$ 收集了这8个节点上波动场 $\\mathbf{w}$ 的x和y分量。\n\n**任务 1  2：组装波动约束矩阵 $A_{\\mathrm{w}}$**\n\n矩阵 $A_{\\mathrm{w}}$ 对波动矢量 $\\mathbf{w}_{\\mathrm{b}}$ 施加线性约束。其基础部分源于波动场的周期性要求 $\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = \\mathbf{0}$，这对题中指定的四对节点中的每一对都产生两个标量方程，共构成一个 $8 \\times 16$ 的矩阵。根据测试案例，可以添加额外的“规范约束”来消除寄生刚体运动：\n- **钉扎约束**：在参考节点 $\\mathbf{x}_4$ 处施加 $w_x(\\mathbf{x}_4) = 0$ 和 $w_y(\\mathbf{x}_4) = 0$，向 $A_{\\mathrm{w}}$ 添加两行。\n- **转动消除约束**：施加 $\\sum_{i=0}^7 \\left( -y_i w_x(\\mathbf{x}_i) + x_i w_y(\\mathbf{x}_i) \\right) = 0$，向 $A_{\\mathrm{w}}$ 添加一行。\n\n**任务 3：刚体模式分析**\n\n我们需要确定三个刚体模式（RBM）矢量中有多少位于组装好的矩阵 $A_{\\mathrm{w}}$ 的零空间中，即满足 $A_{\\mathrm{w}} \\mathbf{v} = \\mathbf{0}$。\n- **平动模式 ($\\mathbf{t}_x, \\mathbf{t}_y$)**: 一个常数位移场（如 $\\mathbf{w}=(1,0)$）满足基本周期性条件 $\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = \\mathbf{0}$。因此，在没有规范约束的情况下，两个平动模式位于零空间中。\n- **转动模式 ($\\mathbf{r}$)**: 一个无穷小刚体转动场 $\\mathbf{w}(\\mathbf{x}) = (-\\omega y, \\omega x)$ (设 $\\omega=1$) *不*满足基本周期性条件。例如，对于水平相对的一对节点 $\\mathbf{x}_- = (x, y)$ 和 $\\mathbf{x}_+ = (x+L, y)$, 位移差为 $\\mathbf{w}(\\mathbf{x}_+) - \\mathbf{w}(\\mathbf{x}_-) = (-y, x+L) - (-y, x) = (0, L) \\ne \\mathbf{0}$。因此，转动模式天然地被基本PBC所消除。\n\n基于以上分析：\n- **案例 2 (无规范约束)**: 只有两个平动模式 ($\\mathbf{t}_x, \\mathbf{t}_y$) 在零空间中。`rbm_count = 2`。\n- **案例 1 (钉扎)**: 钉扎约束 $w_x(\\mathbf{x}_4)=0$ 和 $w_y(\\mathbf{x}_4)=0$ 显然不被常数平动场所满足，因此平动模式被消除。`rbm_count = 0`。\n- **案例 3 (钉扎 + 转动消除)**: 钉扎已消除了所有RBM，额外的转动消除约束是冗余的。`rbm_count = 0`。\n\n**任务 4：周期性接触激活**\n\n使用最小镜像约定计算位于 $\\mathbf{x}_1 = (0.10, 0.50)$ 和 $\\mathbf{x}_2 = (0.90, 0.50)$ 的颗粒间的最短矢量。\n$\\Delta \\mathbf{x} = \\mathbf{x}_2 - \\mathbf{x}_1 = (0.8, 0)$。\n应用公式，最短矢量为 $\\Delta \\mathbf{x}_{\\mathrm{p}} = (-0.2, 0)$，其范数为 $\\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| = 0.2$。\n接触条件为 $g = \\|\\Delta \\mathbf{x}_{\\mathrm{p}}\\| - (r_1 + r_2) \\le 0$。\n- **案例 1**: $g = 0.2 - 0.22 = -0.02 \\le 0$。接触激活 (`True`)。\n- **案例 2**: $g = 0.2 - 0.15 = 0.05 > 0$。接触未激活 (`False`)。\n- **案例 3**: $g = 0.2 - 0.20 = 0.0 \\le 0$。接触激活 (`True`)。\n\n**任务 5：总位移联结残差**\n\n联结方程为 $A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} = \\mathbf{b}$，其中 $A_{\\mathrm{u}}$ 是基本周期性约束矩阵，$\\mathbf{b}$ 由 $\\mathbf{E}\\,(\\mathbf{x}_+ - \\mathbf{x}_-)$ 构成。当测试一个纯仿射位移场 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x}$ 时，我们有：\n$\\mathbf{u}(\\mathbf{x}_+) - \\mathbf{u}(\\mathbf{x}_-) = \\mathbf{E}\\mathbf{x}_+ - \\mathbf{E}\\mathbf{x}_- = \\mathbf{E}(\\mathbf{x}_+ - \\mathbf{x}_-)$。\n这表明仿射场精确地满足了联结方程。因此，残差 $\\mathbf{r}_{\\mathrm{tie}} = A_{\\mathrm{u}}\\,\\mathbf{u}_{\\mathrm{b}} - \\mathbf{b}$ 理论上为零矢量，其无穷范数 $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}$ 应为0（或在数值上接近机器精度）。\n\n**测试案例结果摘要**\n- **案例 1:** `rbm_count=0`, `contact_active=True`, $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}=0.0$。\n- **案例 2:** `rbm_count=2`, `contact_active=False`, $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}=0.0$。\n- **案例 3:** `rbm_count=0`, `contact_active=True`, $\\|\\mathbf{r}_{\\mathrm{tie}}\\|_{\\infty}=0.0$。\n\n这些推导结果将通过提供的Python脚本实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geomechanics problem for three test cases.\n    \"\"\"\n\n    # Define the 8 boundary nodes\n    nodes_coords = np.array([\n        [0.0, 0.25],  # 0: L1\n        [0.0, 0.75],  # 1: L2\n        [1.0, 0.25],  # 2: R1\n        [1.0, 0.75],  # 3: R2\n        [0.25, 0.0],  # 4: B1\n        [0.75, 0.0],  # 5: B2\n        [0.25, 1.0],  # 6: T1\n        [0.75, 1.0],  # 7: T2\n    ])\n    \n    num_nodes = 8\n    num_dofs = num_nodes * 2\n\n    # Define the 4 periodic tie pairs by node indices\n    tie_pairs = [\n        (0, 2),  # (L1, R1)\n        (1, 3),  # (L2, R2)\n        (4, 6),  # (B1, T1)\n        (5, 7),  # (B2, T2)\n    ]\n    \n    # Define rigid body mode vectors\n    t_x = np.zeros(num_dofs)\n    t_x[0::2] = 1.0\n\n    t_y = np.zeros(num_dofs)\n    t_y[1::2] = 1.0\n\n    r_vec = np.zeros(num_dofs)\n    for i in range(num_nodes):\n        x, y = nodes_coords[i]\n        r_vec[2*i] = -y  # w_x = -y\n        r_vec[2*i+1] = x   # w_y = x\n    \n    rbm_vectors = [t_x, t_y, r_vec]\n\n    # Contact parameters\n    x1 = np.array([0.10, 0.50])\n    x2 = np.array([0.90, 0.50])\n    L = 1.0\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\n            \"E\": np.array([[0.01, 0.02], [0.02, -0.01]]),\n            \"use_pinning\": True,\n            \"use_rot_elim\": False,\n            \"r1_plus_r2\": 0.22,\n        },\n        {\n            \"E\": np.array([[0.01, 0.02], [0.02, -0.01]]),\n            \"use_pinning\": False,\n            \"use_rot_elim\": False,\n            \"r1_plus_r2\": 0.15,\n        },\n        {\n            \"E\": np.array([[0.0, 0.02], [0.02, 0.0]]),\n            \"use_pinning\": True,\n            \"use_rot_elim\": True,\n            \"r1_plus_r2\": 0.20,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Task 1  2: Assemble A_w with optional gauge constraints ---\n        A_w_rows = []\n        \n        # Base periodicity constraints\n        for node_minus, node_plus in tie_pairs:\n            # x-component: w_x(+) - w_x(-) = 0\n            row_x = np.zeros(num_dofs)\n            row_x[2 * node_plus] = 1.0\n            row_x[2 * node_minus] = -1.0\n            A_w_rows.append(row_x)\n            \n            # y-component: w_y(+) - w_y(-) = 0\n            row_y = np.zeros(num_dofs)\n            row_y[2 * node_plus + 1] = 1.0\n            row_y[2 * node_minus + 1] = -1.0\n            A_w_rows.append(row_y)\n        \n        # Pinning constraint at B1 (node 4)\n        if case[\"use_pinning\"]:\n            # w_x(B1) = 0\n            row_pin_x = np.zeros(num_dofs)\n            row_pin_x[2 * 4] = 1.0\n            A_w_rows.append(row_pin_x)\n            \n            # w_y(B1) = 0\n            row_pin_y = np.zeros(num_dofs)\n            row_pin_y[2 * 4 + 1] = 1.0\n            A_w_rows.append(row_pin_y)\n\n        # Rotation-elimination constraint\n        if case[\"use_rot_elim\"]:\n            row_rot = np.zeros(num_dofs)\n            for i in range(num_nodes):\n                x, y = nodes_coords[i]\n                row_rot[2 * i] = -y      # Coeff of w_x\n                row_rot[2 * i + 1] = x   # Coeff of w_y\n            A_w_rows.append(row_rot)\n            \n        A_w = np.array(A_w_rows)\n\n        # --- Task 3: Count RBMs in null space of A_w ---\n        rbm_count = 0\n        for v in rbm_vectors:\n            if np.allclose(A_w @ v, 0):\n                rbm_count += 1\n\n        # --- Task 4: Evaluate periodic contact activation ---\n        delta_x = x2 - x1\n        delta_x_p = np.zeros(2)\n        delta_x_p[0] = ((delta_x[0] + L / 2) % L) - L / 2\n        delta_x_p[1] = ((delta_x[1] + L / 2) % L) - L / 2\n        \n        gap = np.linalg.norm(delta_x_p) - case[\"r1_plus_r2\"]\n        contact_active = gap = 0\n        \n        # --- Task 5: Compute tie residual for total displacements ---\n        # A_u is just the base periodicity part\n        A_u = np.array(A_w_rows[:8])\n        \n        E = case[\"E\"]\n        b_tie = np.zeros(8)\n        for i, (node_minus, node_plus) in enumerate(tie_pairs):\n            delta_coord = nodes_coords[node_plus] - nodes_coords[node_minus]\n            rhs_vec = E @ delta_coord\n            b_tie[2*i] = rhs_vec[0]\n            b_tie[2*i+1] = rhs_vec[1]\n            \n        u_b = np.zeros(num_dofs)\n        for i in range(num_nodes):\n            u_b[2*i:2*i+2] = E @ nodes_coords[i]\n            \n        r_tie = A_u @ u_b - b_tie\n        tie_residual_norm = np.linalg.norm(r_tie, np.inf)\n\n        results.append([rbm_count, contact_active, tie_residual_norm])\n\n    # Convert boolean to lower case string for final output consistency if needed, but bool is fine\n    # For example: [0, True, 0.0] -> [0, 'true', 0.0]\n    # This is not required by the prompt, so we keep bools.\n    \n    # Final formatting\n    final_output_str = \"[\"\n    for i, res in enumerate(results):\n        # The prompt wants bools, not strings 'True'/'False'\n        final_output_str += f\"[{res[0]},{res[1]},{res[2]}]\"\n        if i  len(results) - 1:\n            final_output_str += \",\"\n    final_output_str += \"]\"\n    \n    # Based on my manual calculation, the output should be:\n    # [[0, True, 0.0], [2, False, 0.0], [0, True, 0.0]]\n    # Let's print the actual result from the code\n    # print(final_output_str)\n    # The prompt actually wants me to just print a formatted string, not run the function and print its result.\n    # The formatted string should be `print(f\"[{','.join(map(str, results))}]\")`\n    # This will print booleans as 'True' and 'False' which might be what is expected.\n    # Let me stick to the python code format as requested.\n    print(f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n```"
        }
    ]
}