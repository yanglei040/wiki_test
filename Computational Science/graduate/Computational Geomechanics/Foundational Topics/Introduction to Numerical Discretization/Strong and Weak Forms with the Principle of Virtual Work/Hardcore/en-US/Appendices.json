{
    "hands_on_practices": [
        {
            "introduction": "This first practice problem provides a direct and tangible verification of the Principle of Virtual Work (PVW) in action. By considering a simple soil element with a known stress field in equilibrium, you will explicitly calculate both the internal virtual work done by the stresses and the external virtual work done by body forces. This exercise is designed to build a strong intuition for the PVW, confirming that for any valid virtual displacement, these two quantities must be equal, thereby reinforcing the core concept of a weak form balance statement. ",
            "id": "3565498",
            "problem": "Consider a two-dimensional plane-strain soil element of unit thickness with rectangular domain $\\Omega = \\{(x,y) \\,|\\, 0 \\le x \\le L,\\; 0 \\le y \\le H\\}$, subject to gravity. The Cauchy stress tensor field $\\boldsymbol{\\sigma}(x,y)$ is given in components by\n$$\\sigma_{xx}(x,y) = K_{0}\\,\\gamma\\,y,\\qquad \\sigma_{yy}(x,y) = \\gamma\\,y,\\qquad \\sigma_{xy}(x,y) = 0,$$\nwhere $\\gamma$ is the soil unit weight and $K_{0}$ is the lateral earth pressure coefficient at rest. The body force per unit volume is $\\boldsymbol{b} = (0,-\\gamma)$, and there are no prescribed tractions on the boundary. Let the virtual displacement field $\\delta\\boldsymbol{u}(x,y)$ vanish on the boundary $\\partial\\Omega$ and be defined by\n$$\\delta u_{x}(x,y) = A\\,x(L-x)\\,y(H-y),\\qquad \\delta u_{y}(x,y) = B\\,x(L-x)\\,y(H-y),$$\nwith constants $A$ and $B$. Using the Principle of Virtual Work (PVW), compute the internal virtual work\n$$W_{\\mathrm{int}} = \\int_{\\Omega}\\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega,$$\nwhere $\\delta\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}\\left(\\nabla\\,\\delta\\boldsymbol{u} + (\\nabla\\,\\delta\\boldsymbol{u})^{\\top}\\right)$ is the virtual strain tensor, and verify its equality to the external virtual work under equilibrium. Take the numerical values $L = 2\\,\\mathrm{m}$, $H = 3\\,\\mathrm{m}$, $\\gamma = 18\\,\\mathrm{kN/m^{3}}$, $K_{0} = 0.5$, $A = 1.0\\times 10^{-3}\\,\\mathrm{m^{-3}}$, and $B = 1.0\\times 10^{-3}\\,\\mathrm{m^{-3}}$. Report the common value of the internal and external virtual work as a single number. Express your final answer in $\\mathrm{kN\\cdot m}$ and round your answer to four significant figures.",
            "solution": "The starting point is the strong form of equilibrium for a quasi-static, small-strain, plane-strain continuum,\n$$\\nabla\\cdot\\boldsymbol{\\sigma} + \\boldsymbol{b} = \\boldsymbol{0}\\quad \\text{in } \\Omega,$$\nwith boundary conditions $\\boldsymbol{t} = \\boldsymbol{\\sigma}\\,\\boldsymbol{n}$ on any traction boundary $\\Gamma_{t}$ and kinematic (essential) conditions on $\\Gamma_{u}$, where the virtual displacement field $\\delta\\boldsymbol{u}$ satisfies $\\delta\\boldsymbol{u} = \\boldsymbol{0}$ on $\\Gamma_{u}$.\n\nMultiplying the strong form by an arbitrary, kinematically admissible virtual displacement $\\delta\\boldsymbol{u}$ and integrating over $\\Omega$ gives\n$$\\int_{\\Omega}(\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega + \\int_{\\Omega}\\boldsymbol{b}\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega = 0.$$\nUsing the divergence theorem on the first term,\n$$\\int_{\\Omega}(\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega = \\int_{\\partial\\Omega} (\\boldsymbol{\\sigma}\\boldsymbol{n})\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Gamma - \\int_{\\Omega} \\boldsymbol{\\sigma}:\\nabla\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega.$$\nSymmetrizing $\\nabla\\delta\\boldsymbol{u}$ and using the symmetry of $\\boldsymbol{\\sigma}$ yields\n$$\\int_{\\Omega} \\boldsymbol{\\sigma}:\\nabla\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega = \\int_{\\Omega} \\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega,$$\nwhere $\\delta\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}\\left(\\nabla\\delta\\boldsymbol{u} + (\\nabla\\delta\\boldsymbol{u})^{\\top}\\right)$. Therefore, the Principle of Virtual Work (PVW) reads\n$$\\int_{\\Omega}\\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega = \\int_{\\Omega}\\boldsymbol{b}\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega + \\int_{\\partial\\Omega} \\boldsymbol{t}\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Gamma.$$\nIn the present problem, the virtual displacement vanishes on the entire boundary $\\partial\\Omega$, so the boundary integral is zero. Under equilibrium ($\\nabla\\cdot\\boldsymbol{\\sigma} + \\boldsymbol{b} = \\boldsymbol{0}$), the internal virtual work equals the body-force virtual work:\n$$W_{\\mathrm{int}} = \\int_{\\Omega}\\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega = \\int_{\\Omega}\\boldsymbol{b}\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega.$$\n\nWe now compute both sides explicitly and verify the equality.\n\nFirst, compute the virtual strains from the given virtual displacements:\n\n$$\n\\delta u_{x}(x,y) = A\\,x(L-x)\\,y(H-y),\\qquad\n\\delta u_{y}(x,y) = B\\,x(L-x)\\,y(H-y).\n$$\n\nGradients are\n\n$$\n\\frac{\\partial\\,\\delta u_{x}}{\\partial x} = A\\,(L-2x)\\,y(H-y),\\qquad\n\\frac{\\partial\\,\\delta u_{x}}{\\partial y} = A\\,x(L-x)\\,(H-2y),\n$$\n\n\n$$\n\\frac{\\partial\\,\\delta u_{y}}{\\partial x} = B\\,(L-2x)\\,y(H-y),\\qquad\n\\frac{\\partial\\,\\delta u_{y}}{\\partial y} = B\\,x(L-x)\\,(H-2y).\n$$\n\nThe nonzero components of the virtual strain tensor are\n\n$$\n\\delta\\varepsilon_{xx} = \\frac{\\partial\\,\\delta u_{x}}{\\partial x} = A\\,(L-2x)\\,y(H-y),\n$$\n\n\n$$\n\\delta\\varepsilon_{yy} = \\frac{\\partial\\,\\delta u_{y}}{\\partial y} = B\\,x(L-x)\\,(H-2y),\n$$\n\n\n$$\n\\delta\\varepsilon_{xy} = \\frac{1}{2}\\left(\\frac{\\partial\\,\\delta u_{x}}{\\partial y} + \\frac{\\partial\\,\\delta u_{y}}{\\partial x}\\right) = \\frac{1}{2}\\left(A\\,x(L-x)\\,(H-2y) + B\\,(L-2x)\\,y(H-y)\\right).\n$$\n\nSince $\\sigma_{xy} = 0$, only $\\sigma_{xx}\\,\\delta\\varepsilon_{xx}$ and $\\sigma_{yy}\\,\\delta\\varepsilon_{yy}$ contribute to $\\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon}$:\n\n$$\n\\boldsymbol{\\sigma}:\\delta\\boldsymbol{\\varepsilon} = \\sigma_{xx}\\,\\delta\\varepsilon_{xx} + \\sigma_{yy}\\,\\delta\\varepsilon_{yy} = K_{0}\\gamma y\\cdot A\\,(L-2x)\\,y(H-y) + \\gamma y\\cdot B\\,x(L-x)\\,(H-2y).\n$$\n\nTherefore,\n\n$$\nW_{\\mathrm{int}} = \\int_{0}^{L}\\int_{0}^{H}\\left(K_{0}\\gamma A\\,(L-2x)\\,y^{2}(H-y) + \\gamma B\\,x(L-x)\\,y(H-2y)\\right)\\,\\mathrm{d}y\\,\\mathrm{d}x.\n$$\n\nObserve that the first term factors into $\\int_{0}^{L}(L-2x)\\,\\mathrm{d}x$ times a $y$-integral. Compute\n\n$$\n\\int_{0}^{L}(L-2x)\\,\\mathrm{d}x = \\left[Lx - x^{2}\\right]_{0}^{L} = L^{2} - L^{2} = 0,\n$$\n\nso the entire first term vanishes upon integration. Hence\n\n$$\nW_{\\mathrm{int}} = \\gamma B\\left(\\int_{0}^{L}x(L-x)\\,\\mathrm{d}x\\right)\\left(\\int_{0}^{H}y(H-2y)\\,\\mathrm{d}y\\right).\n$$\n\nCompute these one-dimensional integrals:\n\n$$\n\\int_{0}^{L}x(L-x)\\,\\mathrm{d}x = \\int_{0}^{L}(Lx - x^{2})\\,\\mathrm{d}x = \\left[\\frac{L}{2}x^{2} - \\frac{1}{3}x^{3}\\right]_{0}^{L} = \\left(\\frac{L^{3}}{2} - \\frac{L^{3}}{3}\\right) = \\frac{L^{3}}{6},\n$$\n\n\n$$\n\\int_{0}^{H}y(H-2y)\\,\\mathrm{d}y = \\int_{0}^{H}(Hy - 2y^{2})\\,\\mathrm{d}y = \\left[\\frac{H}{2}y^{2} - \\frac{2}{3}y^{3}\\right]_{0}^{H} = \\left(\\frac{H^{3}}{2} - \\frac{2H^{3}}{3}\\right) = -\\frac{H^{3}}{6}.\n$$\n\nTherefore,\n\n$$\nW_{\\mathrm{int}} = \\gamma B\\left(\\frac{L^{3}}{6}\\right)\\left(-\\frac{H^{3}}{6}\\right) = -\\,\\frac{\\gamma B\\,L^{3}H^{3}}{36}.\n$$\n\n\nNext, compute the external virtual work associated with the body force (the boundary term is zero because $\\delta\\boldsymbol{u}=\\boldsymbol{0}$ on $\\partial\\Omega$):\n\n$$\nW_{\\mathrm{ext}} = \\int_{\\Omega}\\boldsymbol{b}\\cdot\\delta\\boldsymbol{u}\\,\\mathrm{d}\\Omega = \\int_{0}^{L}\\int_{0}^{H}(0,-\\gamma)\\cdot(\\delta u_{x},\\delta u_{y})\\,\\mathrm{d}y\\,\\mathrm{d}x = -\\gamma\\int_{0}^{L}\\int_{0}^{H}\\delta u_{y}\\,\\mathrm{d}y\\,\\mathrm{d}x.\n$$\n\nSubstitute $\\delta u_{y}(x,y) = B\\,x(L-x)\\,y(H-y)$:\n\n$$\nW_{\\mathrm{ext}} = -\\gamma B\\left(\\int_{0}^{L}x(L-x)\\,\\mathrm{d}x\\right)\\left(\\int_{0}^{H}y(H-y)\\,\\mathrm{d}y\\right).\n$$\n\nWe already have $\\int_{0}^{L}x(L-x)\\,\\mathrm{d}x = \\frac{L^{3}}{6}$. Now compute\n\n$$\n\\int_{0}^{H}y(H-y)\\,\\mathrm{d}y = \\int_{0}^{H}(Hy - y^{2})\\,\\mathrm{d}y = \\left[\\frac{H}{2}y^{2} - \\frac{1}{3}y^{3}\\right]_{0}^{H} = \\left(\\frac{H^{3}}{2} - \\frac{H^{3}}{3}\\right) = \\frac{H^{3}}{6}.\n$$\n\nThus,\n\n$$\nW_{\\mathrm{ext}} = -\\gamma B\\left(\\frac{L^{3}}{6}\\right)\\left(\\frac{H^{3}}{6}\\right) = -\\,\\frac{\\gamma B\\,L^{3}H^{3}}{36}.\n$$\n\nWe have shown $W_{\\mathrm{int}} = W_{\\mathrm{ext}}$ in closed form, as required by the Principle of Virtual Work under equilibrium.\n\nFinally, insert the given numerical values $L = 2\\,\\mathrm{m}$, $H = 3\\,\\mathrm{m}$, $\\gamma = 18\\,\\mathrm{kN/m^{3}}$, $B = 1.0\\times 10^{-3}\\,\\mathrm{m^{-3}}$:\n\n$$\nL^{3} = 8,\\qquad H^{3} = 27,\\qquad \\frac{L^{3}H^{3}}{36} = \\frac{8\\cdot 27}{36} = \\frac{216}{36} = 6.\n$$\n\nTherefore,\n\n$$\nW_{\\mathrm{int}} = W_{\\mathrm{ext}} = -\\,\\frac{\\gamma B\\,L^{3}H^{3}}{36} = -\\,18\\,\\mathrm{kN/m^{3}}\\times 1.0\\times 10^{-3}\\,\\mathrm{m^{-3}}\\times 6 = -0.108\\,\\mathrm{kN\\cdot m}.\n$$\n\nRounded to four significant figures and expressed in $\\mathrm{kN\\cdot m}$, the common value is $-0.1080\\,\\mathrm{kN\\cdot m}$.",
            "answer": "$$\\boxed{-0.1080}$$"
        },
        {
            "introduction": "Moving from the continuous theory to computational implementation is a critical step in mastering computational geomechanics. This exercise guides you through the process of discretizing the weak form to derive the fundamental building blocks of a finite element analysis: the element internal and external nodal force vectors. By implementing this derivation in code, you will gain hands-on experience in translating the integral equations of the Principle of Virtual Work into the algebraic quantities that form the basis of a finite element solver. ",
            "id": "3565463",
            "problem": "Consider a two-dimensional small-strain, quasi-static, linear elastic solid in plane strain. Let the displacement field be denoted by $\\mathbf{u}$, the Cauchy stress by $\\boldsymbol{\\sigma}$, the small-strain tensor by $\\boldsymbol{\\varepsilon}$, the body force per unit volume by $\\mathbf{b}$, and the prescribed traction on a portion of the Neumann boundary by $\\bar{\\mathbf{t}}$. Assume the domain is discretized into linear triangular finite elements with constant thickness, and that within each element the displacement is interpolated by nodal shape functions. Use the Principle of Virtual Work to derive the weak form from the strong form of linear momentum balance and obtain, at the element level, the consistent internal nodal force vector and the consistent external nodal force vector. The external force vector must include both body-force and traction contributions on the portion of the boundary where tractions are prescribed.\n\nYour derivation must start from the strong form of equilibrium, the definition of small strain, and the kinematic interpolation of displacements with shape functions (no further shortcut formulas are permitted in your derivation). You must clearly indicate the constitutive relation for plane strain using the Lamé parameters. Adopt the following vector conventions: the strain vector is $[\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$ with $\\gamma_{xy} = 2 \\varepsilon_{xy}$, and the stress vector is $[\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^T$. Nodal degrees of freedom are ordered as $[u_{1x}, u_{1y}, u_{2x}, u_{2y}, u_{3x}, u_{3y}]^T$. Within each element, assume the nodes are listed in counterclockwise order. All lengths are in meters, forces in Newtons, stresses in Pascals, densities in kilograms per cubic meter, and accelerations in meters per second squared. Report all nodal force components in Newtons. Angles, if any, must be in radians.\n\nThen, implement a program that, given the geometric, material, kinematic, and loading data for an element, computes:\n- the element internal nodal force vector, and\n- the element external nodal force vector including body force and traction contributions on the specified traction edge(s).\n\nUse exact integration appropriate to linear triangular elements. For a traction applied uniformly along an element edge between node $i$ and node $j$, the consistent nodal contributions arise from integrating the edge shape functions against the uniform traction.\n\nFor the purpose of verification, use the following test suite of three elements. For each case, produce two lists of length $6$ (internal and external nodal force vectors), each rounded to $6$ decimal places, ordered as $[F_{1x}, F_{1y}, F_{2x}, F_{2y}, F_{3x}, F_{3y}]$, and expressed in Newtons.\n\n- Case $1$ (general case with body force and one traction edge):\n  - Nodal coordinates (meters): node $1$: $(0, 0)$, node $2$: $(2, 0)$, node $3$: $(0, 1)$.\n  - Thickness: $1$ m.\n  - Material: Young’s modulus $E = 3.0 \\times 10^{7}$ Pa, Poisson’s ratio $\\nu = 0.30$ (plane strain).\n  - Nodal displacements (meters): $[0.0, 0.0, 0.001, 0.0, 0.0, 0.0005]$.\n  - Density: $\\rho = 1800$ kg/m$^{3}$; gravity $g = 9.81$ m/s$^{2}$; body force $\\mathbf{b} = [0, -\\rho g]$ N/m$^{3}$.\n  - Traction: uniform traction $\\bar{\\mathbf{t}} = [5000, 0]$ N/m applied along the edge from node $2$ to node $3$.\n\n- Case $2$ (zero displacement, only body force, no traction):\n  - Nodal coordinates (meters): node $1$: $(0, 0), node $2$: $(1, 0), node $3$: $(0, 1)$.\n  - Thickness: $0.5$ m.\n  - Material: Young’s modulus $E = 5.0 \\times 10^{7}$ Pa, Poisson’s ratio $\\nu = 0.25$ (plane strain).\n  - Nodal displacements (meters): $[0.0, 0.0, 0.0, 0.0, 0.0, 0.0]$.\n  - Body force $\\mathbf{b} = [1000, -500]$ N/m$^{3}$.\n  - No traction.\n\n- Case $3$ (no body force, one traction edge, nontrivial geometry and displacements):\n  - Nodal coordinates (meters): node $1$: $(1, 1)$, node $2$: $(3, 1)$, node $3$: $(2, 2.5)$.\n  - Thickness: $1.2$ m.\n  - Material: Young’s modulus $E = 1.0 \\times 10^{7}$ Pa, Poisson’s ratio $\\nu = 0.35$ (plane strain).\n  - Nodal displacements (meters): $[0.0002, -0.0001, 0.0004, 0.0, 0.0003, 0.0002]$.\n  - Body force $\\mathbf{b} = [0, 0]$ N/m$^{3}$.\n  - Traction: uniform traction $\\bar{\\mathbf{t}} = [0, 2000]$ N/m applied along the edge from node $1$ to node $2$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain three items, one per case. Each item is a list of two lists: the first is the internal force vector, the second is the external force vector. The numbers must be rounded to $6$ decimal places. For example: \n  - $[\\,[ [\\dots], [\\dots] ],\\; [ [\\dots], [\\dots] ],\\; [ [\\dots], [\\dots] ]\\,]$.",
            "solution": "The problem requires the derivation of the element-level internal and external nodal force vectors for a two-dimensional linear elastic solid in a state of plane strain, discretized by linear triangular finite elements. The derivation must originate from the strong form of the equilibrium equations and employ the Principle of Virtual Work. Subsequently, a computational implementation is required to calculate these vectors for specified test cases.\n\nThe derivation proceeds as follows.\n\n**1. Strong Form of Equilibrium and Boundary Conditions**\nThe strong form of the quasi-static linear momentum balance, or equilibrium equation, for a continuous body occupying a domain $\\Omega$ is given by:\n$$ \\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{b} = \\mathbf{0} \\quad \\text{in } \\Omega $$\nHere, $\\boldsymbol{\\sigma}$ is the Cauchy stress tensor and $\\mathbf{b}$ is the body force vector per unit volume. The domain's boundary $\\Gamma$ is partitioned into a Dirichlet boundary $\\Gamma_u$ where displacements $\\bar{\\mathbf{u}}$ are prescribed, and a Neumann boundary $\\Gamma_t$ where tractions $\\bar{\\mathbf{t}}$ are prescribed.\n$$ \\mathbf{u} = \\bar{\\mathbf{u}} \\quad \\text{on } \\Gamma_u $$\n$$ \\boldsymbol{\\sigma} \\cdot \\mathbf{n} = \\bar{\\mathbf{t}} \\quad \\text{on } \\Gamma_t $$\nwhere $\\mathbf{n}$ is the outward unit normal to the boundary $\\Gamma$.\n\n**2. Principle of Virtual Work and the Weak Form**\nThe Principle of Virtual Work provides the basis for the weak form. We introduce a kinematically admissible virtual displacement field $\\delta\\mathbf{u}$, which is an arbitrary function that is sufficiently smooth and satisfies the homogeneous essential boundary condition, i.e., $\\delta\\mathbf{u} = \\mathbf{0}$ on $\\Gamma_u$.\n\nWe multiply the equilibrium equation by $\\delta\\mathbf{u}$ and integrate over the domain $\\Omega$:\n$$ \\int_{\\Omega} (\\nabla \\cdot \\boldsymbol{\\sigma} + \\mathbf{b}) \\cdot \\delta\\mathbf{u} \\, dV = 0 $$\nExpanding the terms yields:\n$$ \\int_{\\Omega} (\\nabla \\cdot \\boldsymbol{\\sigma}) \\cdot \\delta\\mathbf{u} \\, dV + \\int_{\\Omega} \\mathbf{b} \\cdot \\delta\\mathbf{u} \\, dV = 0 $$\nApplying the product rule for divergence, we have $\\nabla \\cdot (\\boldsymbol{\\sigma}^T \\cdot \\delta\\mathbf{u}) = (\\nabla \\cdot \\boldsymbol{\\sigma}) \\cdot \\delta\\mathbf{u} + \\boldsymbol{\\sigma} : \\nabla(\\delta\\mathbf{u})$. Since the Cauchy stress tensor is symmetric ($\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^T$), this becomes $\\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\delta\\mathbf{u}) = (\\nabla \\cdot \\boldsymbol{\\sigma}) \\cdot \\delta\\mathbf{u} + \\boldsymbol{\\sigma} : \\nabla(\\delta\\mathbf{u})$.\nRearranging and integrating gives:\n$$ \\int_{\\Omega} (\\nabla \\cdot \\boldsymbol{\\sigma}) \\cdot \\delta\\mathbf{u} \\, dV = \\int_{\\Omega} \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\delta\\mathbf{u}) \\, dV - \\int_{\\Omega} \\boldsymbol{\\sigma} : \\nabla(\\delta\\mathbf{u}) \\, dV $$\nApplying the divergence theorem to the first term on the right-hand side:\n$$ \\int_{\\Omega} \\nabla \\cdot (\\boldsymbol{\\sigma} \\cdot \\delta\\mathbf{u}) \\, dV = \\int_{\\Gamma} (\\boldsymbol{\\sigma} \\cdot \\delta\\mathbf{u}) \\cdot \\mathbf{n} \\, dS = \\int_{\\Gamma} (\\boldsymbol{\\sigma} \\cdot \\mathbf{n}) \\cdot \\delta\\mathbf{u} \\, dS $$\nThe virtual strain tensor $\\delta\\boldsymbol{\\varepsilon}$ is defined as the symmetric part of the gradient of the virtual displacement: $\\delta\\boldsymbol{\\varepsilon} = \\frac{1}{2}(\\nabla(\\delta\\mathbf{u}) + (\\nabla(\\delta\\mathbf{u}))^T)$. Due to the symmetry of $\\boldsymbol{\\sigma}$, the double dot product $\\boldsymbol{\\sigma} : \\nabla(\\delta\\mathbf{u})$ is equal to $\\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon}$.\nSubstituting these back into the original integrated equation gives:\n$$ \\int_{\\Gamma} (\\boldsymbol{\\sigma} \\cdot \\mathbf{n}) \\cdot \\delta\\mathbf{u} \\, dS - \\int_{\\Omega} \\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon} \\, dV + \\int_{\\Omega} \\mathbf{b} \\cdot \\delta\\mathbf{u} \\, dV = 0 $$\nThe boundary integral is split over $\\Gamma_u$ and $\\Gamma_t$. Since $\\delta\\mathbf{u} = \\mathbf{0}$ on $\\Gamma_u$, the integral over $\\Gamma_u$ vanishes. On $\\Gamma_t$, we have $\\boldsymbol{\\sigma} \\cdot \\mathbf{n} = \\bar{\\mathbf{t}}$. The equation becomes:\n$$ \\int_{\\Omega} \\boldsymbol{\\sigma} : \\delta\\boldsymbol{\\varepsilon} \\, dV = \\int_{\\Omega} \\mathbf{b} \\cdot \\delta\\mathbf{u} \\, dV + \\int_{\\Gamma_t} \\bar{\\mathbf{t}} \\cdot \\delta\\mathbf{u} \\, dS $$\nThis is the weak form of the equilibrium equation, also known as the statement of the Principle of Virtual Work: the internal virtual work (left-hand side) equals the external virtual work (right-hand side) for any admissible virtual displacement.\n\n**3. Finite Element Discretization**\nThe domain $\\Omega$ is discretized into non-overlapping finite elements $\\Omega^e$. The weak form holds for the entire domain, and thus for the sum over all elements. We now focus on a single linear triangular element, $\\Omega^e$.\n\nWithin an element, the displacement field $\\mathbf{u}$ is approximated by interpolating the nodal displacements $\\mathbf{d}^e$ using shape functions $N_i(x,y)$:\n$$ \\mathbf{u}(x,y) = \\begin{bmatrix} u_x(x,y) \\\\ u_y(x,y) \\end{bmatrix} = \\sum_{i=1}^{3} N_i(x,y) \\begin{bmatrix} u_{ix} \\\\ u_{iy} \\end{bmatrix} $$\nThis can be written in matrix form as $\\mathbf{u} = \\mathbf{N} \\mathbf{d}^e$, where $\\mathbf{N}$ is the shape function matrix and $\\mathbf{d}^e$ is the element nodal displacement vector:\n$$ \\mathbf{N} = \\begin{bmatrix} N_1 & 0 & N_2 & 0 & N_3 & 0 \\\\ 0 & N_1 & 0 & N_2 & 0 & N_3 \\end{bmatrix} $$\n$$ \\mathbf{d}^e = [u_{1x}, u_{1y}, u_{2x}, u_{2y}, u_{3x}, u_{3y}]^T $$\nThe virtual displacement is similarly interpolated: $\\delta\\mathbf{u} = \\mathbf{N} \\delta\\mathbf{d}^e$.\n\nThe small-strain vector, using the specified convention $\\boldsymbol{\\varepsilon}_{\\text{voigt}} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$, is obtained by applying the strain-displacement operator $\\mathbf{L}$:\n$$ \\boldsymbol{\\varepsilon}_{\\text{voigt}} = \\begin{bmatrix} \\varepsilon_{xx} \\\\ \\varepsilon_{yy} \\\\ \\gamma_{xy} \\end{bmatrix} = \\begin{bmatrix} \\partial/\\partial x & 0 \\\\ 0 & \\partial/\\partial y \\\\ \\partial/\\partial y & \\partial/\\partial x \\end{bmatrix} \\begin{bmatrix} u_x \\\\ u_y \\end{bmatrix} = \\mathbf{L}\\mathbf{u} $$\nSubstituting the displacement interpolation, we get $\\boldsymbol{\\varepsilon}_{\\text{voigt}} = \\mathbf{L}(\\mathbf{N} \\mathbf{d}^e) = (\\mathbf{L}\\mathbf{N}) \\mathbf{d}^e = \\mathbf{B} \\mathbf{d}^e$. The matrix $\\mathbf{B}$ is the strain-displacement matrix:\n$$ \\mathbf{B} = \\mathbf{L}\\mathbf{N} = \\begin{bmatrix} \\frac{\\partial N_1}{\\partial x} & 0 & \\frac{\\partial N_2}{\\partial x} & 0 & \\frac{\\partial N_3}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_1}{\\partial y} & 0 & \\frac{\\partial N_2}{\\partial y} & 0 & \\frac{\\partial N_3}{\\partial y} \\\\ \\frac{\\partial N_1}{\\partial y} & \\frac{\\partial N_1}{\\partial x} & \\frac{\\partial N_2}{\\partial y} & \\frac{\\partial N_2}{\\partial x} & \\frac{\\partial N_3}{\\partial y} & \\frac{\\partial N_3}{\\partial x} \\end{bmatrix} $$\nFor a linear triangular element, the shape functions $N_i(x,y)$ are linear in coordinates, so their derivatives are constant. Consequently, the $\\mathbf{B}$ matrix is constant throughout the element. The shape functions are $N_i(x,y) = \\frac{1}{2A}(a_i + b_i x + c_i y)$, where $A$ is the element area, and $a_i = x_j y_k - x_k y_j$, $b_i = y_j - y_k$, $c_i = x_k - x_j$ for a cyclic permutation $(i,j,k)$ of $(1,2,3)$. The derivatives are $\\frac{\\partial N_i}{\\partial x} = \\frac{b_i}{2A}$ and $\\frac{\\partial N_i}{\\partial y} = \\frac{c_i}{2A}$. The area is $A = \\frac{1}{2} \\det \\begin{pmatrix} 1 & x_1 & y_1 \\\\ 1 & x_2 & y_2 \\\\ 1 & x_3 & y_3 \\end{pmatrix}$.\nThe virtual strain is $\\delta\\boldsymbol{\\varepsilon}_{\\text{voigt}} = \\mathbf{B} \\delta\\mathbf{d}^e$.\n\n**4. Constitutive Relation**\nFor a linear elastic isotropic material under plane strain conditions, the stress-strain relationship $\\boldsymbol{\\sigma}_{\\text{voigt}} = \\mathbf{D} \\boldsymbol{\\varepsilon}_{\\text{voigt}}$ is defined by the elasticity matrix $\\mathbf{D}$. Using the Lamé parameters $\\lambda$ and $\\mu$ (shear modulus), the matrix is:\n$$ \\mathbf{D} = \\begin{bmatrix} \\lambda+2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda+2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix} $$\nThe Lamé parameters are related to Young's modulus $E$ and Poisson's ratio $\\nu$ by:\n$$ \\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)}, \\quad \\mu = G = \\frac{E}{2(1+\\nu)} $$\n\n**5. Element Nodal Force Vectors**\nThe weak form can be expressed in terms of vector-matrix products as $\\int_{\\Omega} (\\delta\\boldsymbol{\\varepsilon}_{\\text{voigt}})^T \\boldsymbol{\\sigma}_{\\text{voigt}} \\, dV = \\int_{\\Omega} (\\delta\\mathbf{u})^T \\mathbf{b} \\, dV + \\int_{\\Gamma_t} (\\delta\\mathbf{u})^T \\bar{\\mathbf{t}} \\, dS$.\nSubstituting the FEM approximations for a single element $\\Omega^e$:\n$$ \\int_{\\Omega^e} (\\mathbf{B} \\delta\\mathbf{d}^e)^T \\boldsymbol{\\sigma}_{\\text{voigt}} \\, dV = \\int_{\\Omega^e} (\\mathbf{N} \\delta\\mathbf{d}^e)^T \\mathbf{b} \\, dV + \\int_{\\Gamma_t^e} (\\mathbf{N} \\delta\\mathbf{d}^e)^T \\bar{\\mathbf{t}} \\, dS $$\n$$ (\\delta\\mathbf{d}^e)^T \\int_{\\Omega^e} \\mathbf{B}^T \\boldsymbol{\\sigma}_{\\text{voigt}} \\, dV = (\\delta\\mathbf{d}^e)^T \\left( \\int_{\\Omega^e} \\mathbf{N}^T \\mathbf{b} \\, dV + \\int_{\\Gamma_t^e} \\mathbf{N}^T \\bar{\\mathbf{t}} \\, dS \\right) $$\nSince this equation must hold for any arbitrary virtual nodal displacement $\\delta\\mathbf{d}^e$, we can equate the vector coefficients. This defines the internal and external nodal force vectors.\n\nThe **internal nodal force vector** $\\mathbf{f}_{\\text{int}}^e$ is defined from the internal virtual work:\n$$ \\mathbf{f}_{\\text{int}}^e = \\int_{\\Omega^e} \\mathbf{B}^T \\boldsymbol{\\sigma}_{\\text{voigt}} \\, dV $$\nFor a linear triangular element with constant thickness $h$, the integrand is constant over the element area $A$. The integral simplifies to:\n$$ \\mathbf{f}_{\\text{int}}^e = \\mathbf{B}^T \\boldsymbol{\\sigma}_{\\text{voigt}} A h $$\nwhere $\\boldsymbol{\\sigma}_{\\text{voigt}} = \\mathbf{D} \\boldsymbol{\\varepsilon}_{\\text{voigt}} = \\mathbf{D} \\mathbf{B} \\mathbf{d}^e$.\n\nThe **external nodal force vector** $\\mathbf{f}_{\\text{ext}}^e$ is defined from the external virtual work and consists of contributions from body forces and surface tractions:\n$$ \\mathbf{f}_{\\text{ext}}^e = \\mathbf{f}_{\\text{body}}^e + \\mathbf{f}_{\\text{traction}}^e $$\nThe **body force vector** $\\mathbf{f}_{\\text{body}}^e$ is:\n$$ \\mathbf{f}_{\\text{body}}^e = \\int_{\\Omega^e} \\mathbf{N}^T \\mathbf{b} \\, dV = h \\int_{A^e} \\mathbf{N}^T \\mathbf{b} \\, dA $$\nAssuming a constant body force $\\mathbf{b} = [b_x, b_y]^T$, and using the identity $\\int_A N_i \\, dA = A/3$, the integral yields:\n$$ \\mathbf{f}_{\\text{body}}^e = \\frac{A h}{3} [b_x, b_y, b_x, b_y, b_x, b_y]^T $$\nThis shows that the total body force on the element, $\\mathbf{b} A h$, is distributed equally among the three nodes.\n\nThe **traction force vector** $\\mathbf{f}_{\\text{traction}}^e$ is:\n$$ \\mathbf{f}_{\\text{traction}}^e = \\int_{\\Gamma_t^e} \\mathbf{N}^T \\bar{\\mathbf{t}} \\, dS $$\nFor a uniform traction $\\bar{\\mathbf{t}} = [\\bar{t}_x, \\bar{t}_y]^T$ applied over an element edge from node $i$ to node $j$ of length $L_{ij}$, the integral becomes:\n$$ \\mathbf{f}_{\\text{traction}}^e = h \\int_{L_{ij}} \\mathbf{N}^T \\bar{\\mathbf{t}} \\, dL $$\nOn this edge, only shape functions $N_i$ and $N_j$ are non-zero. The nodal force contribution for a generic node $k$ is $\\mathbf{f}_k = h \\bar{\\mathbf{t}} \\int_{L_{ij}} N_k \\, dL$.\nThe integral of a linear shape function over its corresponding edge (from $1$ to $0$) is $\\int_{L_{ij}} N_i \\, dL = L_{ij}/2$ and $\\int_{L_{ij}} N_j \\, dL = L_{ij}/2$. Therefore, the total traction force $\\bar{\\mathbf{t}} L_{ij} h$ on the edge is distributed equally to the two nodes on that edge. The force contributions are:\n$$ \\mathbf{f}_i = \\frac{L_{ij} h}{2} \\begin{bmatrix} \\bar{t}_x \\\\ \\bar{t}_y \\end{bmatrix}, \\quad \\mathbf{f}_j = \\frac{L_{ij} h}{2} \\begin{bmatrix} \\bar{t}_x \\\\ \\bar{t}_y \\end{bmatrix} $$\nThe element traction vector $\\mathbf{f}_{\\text{traction}}^e$ is assembled by placing these contributions into the appropriate positions corresponding to the degrees of freedom of nodes $i$ and $j$.\n\nThis concludes the required derivations. The implementation will follow these final formulae.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"nodes\": np.array([[0.0, 0.0], [2.0, 0.0], [0.0, 1.0]]),\n            \"thickness\": 1.0,\n            \"E\": 3.0e7,\n            \"nu\": 0.30,\n            \"displacements\": np.array([0.0, 0.0, 0.001, 0.0, 0.0, 0.0005]),\n            \"body_force_density\": 1800.0,\n            \"gravity\": 9.81,\n            \"body_force_vector\": None, # Will be calculated from density\n            \"traction\": {\"edge_nodes\": (2, 3), \"vector\": np.array([5000.0, 0.0])}\n        },\n        {\n            \"nodes\": np.array([[0.0, 0.0], [1.0, 0.0], [0.0, 1.0]]),\n            \"thickness\": 0.5,\n            \"E\": 5.0e7,\n            \"nu\": 0.25,\n            \"displacements\": np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0]),\n            \"body_force_density\": None,\n            \"gravity\": None,\n            \"body_force_vector\": np.array([1000.0, -500.0]),\n            \"traction\": None\n        },\n        {\n            \"nodes\": np.array([[1.0, 1.0], [3.0, 1.0], [2.0, 2.5]]),\n            \"thickness\": 1.2,\n            \"E\": 1.0e7,\n            \"nu\": 0.35,\n            \"displacements\": np.array([0.0002, -0.0001, 0.0004, 0.0, 0.0003, 0.0002]),\n            \"body_force_density\": None,\n            \"gravity\": None,\n            \"body_force_vector\": np.array([0.0, 0.0]),\n            \"traction\": {\"edge_nodes\": (1, 2), \"vector\": np.array([0.0, 2000.0])}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        f_int, f_ext = calculate_forces(case)\n        results.append([\n            [round(x, 6) for x in f_int],\n            [round(x, 6) for x in f_ext]\n        ])\n\n    # Custom formatting to match the precise output string requirement\n    case_strings = []\n    for res_pair in results:\n        f_int_str = f\"[{','.join(f'{x:.6f}' for x in res_pair[0])}]\"\n        f_ext_str = f\"[{','.join(f'{x:.6f}' for x in res_pair[1])}]\"\n        case_strings.append(f\"[{f_int_str},{f_ext_str}]\")\n    \n    final_output_str = f\"[{','.join(case_strings)}]\"\n    print(final_output_str.replace(\" \", \"\"))\n\n\ndef calculate_forces(case):\n    \"\"\"\n    Calculates the internal and external nodal force vectors for a single linear triangular element.\n\n    Args:\n        case (dict): A dictionary containing all the parameters for the element.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]: A tuple containing the internal force vector\n                                       and the external force vector.\n    \"\"\"\n    nodes = case[\"nodes\"]\n    h = case[\"thickness\"]\n    E = case[\"E\"]\n    nu = case[\"nu\"]\n    d = case[\"displacements\"]\n\n    # 1. Geometric properties and B matrix\n    (x1, y1), (x2, y2), (x3, y3) = nodes[0], nodes[1], nodes[2]\n    \n    # Area of the triangle\n    # For counterclockwise nodes, this is positive\n    area = 0.5 * (x1 * (y2 - y3) + x2 * (y3 - y1) + x3 * (y1 - y2))\n\n    b1, b2, b3 = y2 - y3, y3 - y1, y1 - y2\n    c1, c2, c3 = x3 - x2, x1 - x3, x2 - x1\n\n    # Strain-displacement matrix (B)\n    B = (1 / (2 * area)) * np.array([\n        [b1, 0, b2, 0, b3, 0],\n        [0, c1, 0, c2, 0, c3],\n        [c1, b1, c2, b2, c3, b3]\n    ])\n\n    # 2. Constitutive relation (D matrix for plane strain)\n    # Lamé parameters\n    lame_lambda = (E * nu) / ((1 + nu) * (1 - 2 * nu))\n    lame_mu = E / (2 * (1 + nu))  # Also shear modulus G\n\n    D = np.array([\n        [lame_lambda + 2 * lame_mu, lame_lambda, 0],\n        [lame_lambda, lame_lambda + 2 * lame_mu, 0],\n        [0, 0, lame_mu]\n    ])\n\n    # 3. Internal Nodal Force Vector (f_int)\n    if np.all(d == 0):\n        f_int = np.zeros(6)\n    else:\n        # Strain vector (epsilon)\n        epsilon = B @ d\n        # Stress vector (sigma)\n        sigma = D @ epsilon\n        # Internal force vector\n        f_int = B.T @ sigma * area * h\n\n    # 4. External Nodal Force Vector (f_ext)\n    f_ext = np.zeros(6)\n\n    # Body force contribution\n    if case[\"body_force_vector\"] is not None:\n        b = case[\"body_force_vector\"]\n    elif case[\"body_force_density\"] is not None:\n        b = np.array([0.0, -case[\"body_force_density\"] * case[\"gravity\"]])\n    else:\n        b = np.array([0.0, 0.0])\n\n    if not np.all(b == 0):\n        f_body_per_node = (area * h / 3.0) * b\n        for i in range(3):\n            f_ext[2*i : 2*i+2] += f_body_per_node\n\n    # Traction force contribution\n    if case[\"traction\"] is not None:\n        traction_data = case[\"traction\"]\n        node_i_idx, node_j_idx = traction_data[\"edge_nodes\"]\n        t_bar = traction_data[\"vector\"]\n\n        # Node indices are 1-based in problem, convert to 0-based for array access\n        node_i = nodes[node_i_idx - 1]\n        node_j = nodes[node_j_idx - 1]\n        \n        edge_length = math.sqrt((node_i[0] - node_j[0])**2 + (node_i[1] - node_j[1])**2)\n        \n        f_traction_per_node = (edge_length * h / 2.0) * t_bar\n        \n        f_ext[2*(node_i_idx-1) : 2*(node_i_idx-1)+2] += f_traction_per_node\n        f_ext[2*(node_j_idx-1) : 2*(node_j_idx-1)+2] += f_traction_per_node\n        \n    return f_int.flatten(), f_ext.flatten()\n\n\nsolve()\n\n```"
        },
        {
            "introduction": "This final practice demonstrates the power and versatility of the weak form by extending its application from simple equilibrium to the critical field of stability analysis. You will explore how the Principle of Virtual Work, when linearized around a pre-stressed state, naturally gives rise to a generalized eigenvalue problem for predicting buckling. This exercise is crucial for understanding how the weak form provides a unified framework not only for determining displacements under load but also for assessing the stability of geomechanical structures like tunnels. ",
            "id": "3565447",
            "problem": "Consider a two-dimensional plane-strain model of a circular tunnel lining embedded in a linear elastic soil continuum with small deformations under an initial compressive stress state. Let the domain be denoted by $\\Omega$, the boundary by $\\partial\\Omega$, the displacement field by $u$, the virtual displacement by $\\delta u$, the strain by $\\epsilon(u)$ under the small-strain kinematics, and the Cauchy stress by $\\sigma(u)$. Assume a linear elastic constitutive relation $\\sigma(u) = \\mathbb{C} : \\epsilon(u)$ where $\\mathbb{C}$ is the fourth-order elasticity tensor. The initial stress field induces a geometric stiffness contribution in the incremental equilibrium that, under the Principle of Virtual Work (PVW), defines a geometric work functional. For eigenvalue buckling analysis under the initial stress state, the incremental equilibrium is homogeneous (no incremental external forces), and the PVW enforces that internal virtual work equals geometric virtual work associated with the initial stress state.\n\nTask 1 (Derivation): Starting from the strong form of equilibrium, namely $\\nabla \\cdot \\sigma(u) = 0$ in $\\Omega$ and appropriate displacement boundary conditions on $\\partial\\Omega$, use the Principle of Virtual Work (PVW) to derive the weak form for the buckling eigenvalue problem of the lining-soil system. Your derivation must:\n- Begin from the strong form of the linear momentum balance and the small-strain kinematics $\\epsilon(u) = \\tfrac{1}{2}(\\nabla u + \\nabla u^\\top)$, combined with linear elasticity $\\sigma(u) = \\mathbb{C} : \\epsilon(u)$.\n- Introduce an initial stress field and linearize the geometric contribution of virtual work due to this field, leading to a bilinear form that depends on the displacement.\n- Conclude with a statement of the variational form equating the internal virtual work and the geometric virtual work (with the buckling load factor multiplying the geometric term) for all admissible virtual displacements, written over the domain $\\Omega$.\n- Clearly define all symbols, function spaces, and assumptions used in the derivation.\n\nTask 2 (Discretization): Using the Finite Element Method (FEM), discretize the weak form with standard $C^0$ displacement-based elements under plane strain, resulting in symmetric positive-definite algebraic operators for the internal stiffness and symmetric positive-definite operators for the geometric stiffness under the assumed initial stress state. Define the discrete displacement vector by $u \\in \\mathbb{R}^n$. Show that the discretized eigenvalue buckling problem leads to a generalized symmetric eigenvalue model. Provide the Rayleigh quotient that recovers the eigenvalue for any nonzero vector $u$ in terms of the discrete bilinear forms.\n\nTask 3 (Algorithm): Design a numerical algorithm to compute the smallest buckling load factor for given symmetric positive-definite matrices representing the internal stiffness and geometric stiffness. Your algorithm must:\n- Solve a symmetric generalized eigenvalue problem and select the smallest positive eigenvalue.\n- Validate the eigenpair numerically by computing the Rayleigh quotient of the returned eigenvector.\n- Return the smallest eigenvalue as a floating-point number for each test case.\n\nUnits and conventions:\n- Report all buckling load factors as dimensionless floating-point numbers rounded to six decimal places. Do not include any unit.\n- Angles do not appear in this problem and are therefore not applicable.\n\nTest suite:\nFor each test case, you are given discrete matrices for the internal stiffness and geometric stiffness. Each matrix is expressed in $\\mathbb{R}^{n \\times n}$ using symmetric entries, and each is to be treated as dimensionless for the purposes of this test suite. You must compute the smallest buckling load factor for each pair.\n\n- Test Case A (happy path, coupled $2\\times 2$):\n  Internal stiffness\n  $$\n  K_A = \\begin{bmatrix}\n  12 & -3 \\\\\n  -3 & 4\n  \\end{bmatrix},\n  \\quad\n  G_A = \\begin{bmatrix}\n  5 & 1 \\\\\n  1 & 3\n  \\end{bmatrix}.\n  $$\n- Test Case B (boundary case with repeated eigenvalues):\n  $$\n  K_B = \\begin{bmatrix}\n  10 & 0 \\\\\n  0 & 10\n  \\end{bmatrix},\n  \\quad\n  G_B = \\begin{bmatrix}\n  1 & 0 \\\\\n  0 & 1\n  \\end{bmatrix}.\n  $$\n- Test Case C (coupled $3\\times 3$ with off-diagonal terms):\n  $$\n  K_C = \\begin{bmatrix}\n  8 & -2 & 0 \\\\\n  -2 & 6 & -1 \\\\\n  0 & -1 & 3\n  \\end{bmatrix},\n  \\quad\n  G_C = \\begin{bmatrix}\n  4 & 0.5 & 0 \\\\\n  0.5 & 2.5 & 0.2 \\\\\n  0 & 0.2 & 1.5\n  \\end{bmatrix}.\n  $$\n- Test Case D (ill-conditioned geometric stiffness but symmetric positive-definite):\n  $$\n  K_D = \\begin{bmatrix}\n  2 & 0.1 & 0 \\\\\n  0.1 & 3 & 0.2 \\\\\n  0 & 0.2 & 4\n  \\end{bmatrix},\n  \\quad\n  G_D = \\begin{bmatrix}\n  10^{-6} & 0 & 0 \\\\\n  0 & 1 & 0 \\\\\n  0 & 0 & 2\n  \\end{bmatrix}.\n  $$\n\nProgram output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The results must correspond to the smallest buckling load factors for Test Cases A, B, C, and D, respectively, each rounded to six decimal places. For example, an output would look like $\\texttt{[0.123456,1.234567,2.345678,3.456789]}$ with no additional text.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded, well-posed, and complete. It presents a standard procedure in computational mechanics: a linear bifurcation (eigenvalue) buckling analysis. All provided data and matrices are consistent with the theoretical premises.\n\nThe solution is presented in three parts, corresponding to the three tasks outlined in the problem statement.\n\n### Task 1: Derivation of the Weak Form\n\nThe objective is to derive the weak form of the eigenvalue buckling problem from the strong form of equilibrium using the Principle of Virtual Work (PVW).\n\nLet the body occupy a domain $\\Omega \\subset \\mathbb{R}^2$ with boundary $\\partial\\Omega$. The strong form of equilibrium for a continuum body, in the absence of body forces, is given by the balance of linear momentum:\n$$\n\\nabla \\cdot \\sigma = 0 \\quad \\text{in } \\Omega\n$$\nwhere $\\sigma$ is the Cauchy stress tensor. This equation is subject to boundary conditions, which we assume to be homogeneous displacement conditions ($u=0$) on a part of the boundary $\\partial\\Omega_D$ for the buckling mode.\n\nTo derive the weak form, we apply the PVW. The PVW states that for a body in equilibrium, the internal virtual work is equal to the external virtual work for any kinematically admissible virtual displacement $\\delta u$. A kinematically admissible virtual displacement is any vector field $\\delta u$ that satisfies homogeneous boundary conditions on $\\partial\\Omega_D$. We denote the space of such functions as $V$. For incremental problems, we consider the incremental form of the PVW.\n\nBuckling is a phenomenon of instability where a new equilibrium configuration becomes possible under a constant load. We consider a state defined by an anitial, known stress field $\\sigma_0$ (the pre-buckling state). We then seek a small, non-trivial displacement field $u$ (the buckling mode) that satisfies equilibrium. The stress tensor is updated to account for the strains induced by $u$. The key insight for buckling analysis is to include the effect of the initial stress $\\sigma_0$ on the stiffness of the structure. This leads to the concept of geometric stiffness.\n\nThe total internal virtual work, considering geometric nonlinearity, is expressed as an integral of the product of the second Piola-Kirchhoff stress tensor $S$ and the variation of the Green-Lagrange strain tensor $E$. For buckling analysis, we linearize this expression around the pre-stressed state. The linearized incremental internal virtual work, $\\delta W_{int}$, can be split into two components: a material (or constitutive) part and a geometric part.\n$$\n\\delta W_{int} = \\delta W_{mat} + \\delta W_{geom}\n$$\nThe material part arises from the stress increment $\\Delta\\sigma$ due to the buckling mode $u$:\n$$\n\\delta W_{mat} = \\int_{\\Omega} \\Delta\\sigma : \\epsilon(\\delta u) \\, d\\Omega\n$$\nUsing the linear elastic constitutive relation, $\\Delta\\sigma = \\mathbb{C} : \\epsilon(u)$, where $\\epsilon(u) = \\frac{1}{2}(\\nabla u + \\nabla u^\\top)$ is the small-strain tensor and $\\mathbb{C}$ is the fourth-order elasticity tensor. This term becomes a bilinear form, which we denote $a(\\cdot, \\cdot)$:\n$$\na(u, \\delta u) = \\int_{\\Omega} (\\mathbb{C} : \\epsilon(u)) : \\epsilon(\\delta u) \\, d\\Omega\n$$\nThe geometric part arises from the work done by the initial stress $\\sigma_0$ undergoing additional strains due to the geometric effect of the buckling displacement field $u$. This term is given by:\n$$\n\\delta W_{geom} = \\int_{\\Omega} \\sigma_0 : (\\nabla u \\cdot \\nabla(\\delta u)^\\top) \\, d\\Omega = \\int_{\\Omega} (\\nabla(\\delta u))^T : (\\sigma_0 \\cdot (\\nabla u)^T) \\, d\\Omega\n$$\nIn component form, this can be written as $\\int_{\\Omega} \\sigma_{0,ij} \\frac{\\partial u_k}{\\partial x_j} \\frac{\\partial(\\delta u)_k}{\\partial x_i} d\\Omega$.\n\nFor buckling analysis, we assume the initial stress $\\sigma_0$ is proportional to a reference stress field $\\sigma_{ref}$ via a scalar load factor, $\\lambda$. Thus, $\\sigma_0 = \\lambda \\sigma_{ref}$. The geometric virtual work can then be written as:\n$$\n\\delta W_{geom} = \\lambda \\int_{\\Omega} (\\nabla(\\delta u))^T : (\\sigma_{ref} \\cdot (\\nabla u)^T) \\, d\\Omega = \\lambda \\, g(u, \\delta u)\n$$\nwhere $g(\\cdot, \\cdot)$ is the bilinear form associated with the geometric stiffness.\n\nIn a buckling problem, there are no incremental external forces. Therefore, the total incremental virtual work must be zero for any admissible virtual displacement $\\delta u \\in V$:\n$$\na(u, \\delta u) + \\lambda \\, g(u, \\delta u) = 0 \\quad \\forall \\delta u \\in V\n$$\nConventionally, a compressive reference stress $\\sigma_{ref}$ (with negative components) is used. To work with a positive-definite geometric stiffness operator and a positive buckling load factor $\\lambda$, the sign is often absorbed into the definition. Assuming the form $Kd = \\lambda Gd$ with positive-definite $K$ and $G$ as per the problem statement, we write the variational problem as finding $(\\lambda, u) \\in \\mathbb{R} \\times V, u \\neq 0$, such that:\n$$\na(u, v) = \\lambda \\, g(u, v) \\quad \\forall v \\in V\n$$\nHere, $u$ is the buckling mode shape and $\\lambda$ is the buckling load factor. The space $V$ is a suitable Sobolev space of vector-valued functions, typically $V = \\{w \\in [H^1(\\Omega)]^2 \\mid w=0 \\text{ on } \\partial\\Omega_D\\}$. The forms are:\n-   Internal virtual work (bilinear form): $a(u, v) = \\int_{\\Omega} \\epsilon(u) : \\mathbb{C} : \\epsilon(v) \\, d\\Omega$\n-   Geometric virtual work (bilinear form): $g(u, v) = \\int_{\\Omega} (\\nabla u)^T \\sigma_{ref} \\nabla v \\, d\\Omega$ (in appropriate matrix notation).\n\n### Task 2: Discretization\n\nThe finite element method (FEM) is used to discretize the weak form. The domain $\\Omega$ is partitioned into a mesh of finite elements. Within each element, the displacement field $u(x)$ is approximated by interpolating nodal values using shape functions $N_i(x)$:\n$$\nu(x) \\approx u_h(x) = \\sum_{i=1}^{n_{dof}} N_i(x) d_i = N(x)d\n$$\nwhere $d \\in \\mathbb{R}^n$ is the global vector of nodal displacements (degrees of freedom), and $N(x)$ is the matrix of shape functions. The test function (virtual displacement) $v$ is approximated from the same space: $v_h(x) = N(x)c$.\n\nThe strain field is obtained by applying the kinematic differential operator $L$ to $u_h$:\n$$\n\\epsilon(u_h) = L(N(x)d) = (LN(x))d = B(x)d\n$$\nwhere $B(x)$ is the strain-displacement matrix. Similarly, $\\epsilon(v_h) = B(x)c$.\n\nSubstituting these approximations into the internal virtual work form $a(u_h, v_h)$:\n$$\na(u_h, v_h) = \\int_{\\Omega} \\epsilon(v_h) : \\mathbb{C} : \\epsilon(u_h) \\, d\\Omega = \\left(\\int_{\\Omega} (Bc)^T \\mathbb{D} (Bd) \\, d\\Omega \\right) = c^T \\left(\\int_{\\Omega} B^T \\mathbb{D} B \\, d\\Omega \\right) d\n$$\nwhere $\\mathbb{D}$ is the material elasticity matrix for plane strain. This defines the symmetric, positive-definite internal stiffness matrix $K$:\n$$\nK = \\int_{\\Omega} B(x)^T \\mathbb{D} B(x) \\, d\\Omega\n$$\nSo, $a(u_h, v_h) = c^T K d$.\n\nSimilarly, the displacement gradient $\\nabla u_h$ is discretized as $\\nabla (N(x)d) = (\\nabla N(x))d$. The geometric work form $g(u_h, v_h)$ becomes:\n$$\ng(u_h, v_h) = c^T \\left( \\int_{\\Omega} (\\nabla N)^T \\hat{\\sigma}_{ref} (\\nabla N) \\, d\\Omega \\right) d\n$$\nwhere $\\hat{\\sigma}_{ref}$ is a matrix function of the reference stress components. This defines the symmetric geometric stiffness matrix $G$:\n$$\nG = \\int_{\\Omega} (\\nabla N)^T \\hat{\\sigma}_{ref} (\\nabla N) \\, d\\Omega\n$$\nThe problem states that for a compressive initial stress state, this operator is positive-definite. Thus, $g(u_h, v_h) = c^T G d$.\n\nThe discretized variational equation $a(u_h, v_h) = \\lambda g(u_h, v_h)$ becomes:\n$$\nc^T K d = \\lambda (c^T G d)\n$$\nSince this must hold for all admissible virtual displacements, it must hold for any vector $c$, which implies:\n$$\nK d = \\lambda G d\n$$\nThis is a generalized symmetric eigenvalue problem. The solutions $(\\lambda_i, d_i)$ consist of eigenvalues $\\lambda_i$ (the buckling load factors) and eigenvectors $d_i$ (the discretized buckling mode shapes).\n\nFor any such eigenpair $(\\lambda, d)$, the eigenvalue can be recovered using the Rayleigh quotient:\n$$\n\\lambda = \\frac{d^T K d}{d^T G d}\n$$\nSince $K$ and $G$ are symmetric and positive-definite, $d^T K d > 0$ and $d^T G d > 0$ for any non-zero vector $d$, which guarantees that all eigenvalues $\\lambda$ are real and positive.\n\n### Task 3: Algorithm\n\nThe goal is to compute the smallest buckling load factor, which corresponds to the smallest positive eigenvalue of the generalized eigenvalue problem $Kd = \\lambda Gd$.\n\nThe algorithm is as follows:\n1.  **Input**: Receive the symmetric positive-definite internal stiffness matrix $K \\in \\mathbb{R}^{n \\times n}$ and the symmetric positive-definite geometric stiffness matrix $G \\in \\mathbb{R}^{n \\times n}$.\n2.  **Solve**: Solve the generalized eigenvalue problem $K d = \\lambda G d$ to find all eigenvalues $\\lambda_i$ and their corresponding eigenvectors $d_i$. For numerical computation, specialized library functions for symmetric matrices should be used. For instance, `scipy.linalg.eigh(K, G)` in Python is designed for this purpose. It efficiently computes the eigenvalues and eigenvectors, and importantly, returns the eigenvalues sorted in ascending order.\n3.  **Select**: The critical buckling load factor is the smallest value of $\\lambda$ for which a non-trivial solution $d$ exists. This corresponds to the smallest eigenvalue computed in the previous step. If the eigenvalues are sorted, this is simply the first eigenvalue, $\\lambda_{min}$.\n4.  **Validate (as required by the prompt)**: For the computed eigenpair with the smallest eigenvalue $(\\lambda_{min}, d_{min})$, perform a numerical verification using the Rayleigh quotient. Calculate $\\lambda'_{min} = \\frac{d_{min}^T K d_{min}}{d_{min}^T G d_{min}}$. This value should be numerically identical to $\\lambda_{min}$, confirming the correctness of the solution.\n5.  **Output**: Return the smallest eigenvalue $\\lambda_{min}$ as a floating-point number, rounded to the specified precision.\n\nThis procedure is robust and standard for linear buckling analysis in computational mechanics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Solves for the smallest buckling load factor for a series of test cases.\n    The problem is formulated as a generalized symmetric eigenvalue problem K*d = lambda*G*d,\n    where K is the internal stiffness matrix and G is the geometric stiffness matrix.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case A (happy path, coupled 2x2)\n        {\n            \"K\": np.array([[12., -3.],\n                           [-3., 4.]]),\n            \"G\": np.array([[5., 1.],\n                           [1., 3.]])\n        },\n        # Test Case B (boundary case with repeated eigenvalues)\n        {\n            \"K\": np.array([[10., 0.],\n                           [0., 10.]]),\n            \"G\": np.array([[1., 0.],\n                           [0., 1.]])\n        },\n        # Test Case C (coupled 3x3 with off-diagonal terms)\n        {\n            \"K\": np.array([[8., -2., 0.],\n                           [-2., 6., -1.],\n                           [0., -1., 3.]]),\n            \"G\": np.array([[4., 0.5, 0.],\n                           [0.5, 2.5, 0.2],\n                           [0., 0.2, 1.5]])\n        },\n        # Test Case D (ill-conditioned geometric stiffness but SPD)\n        {\n            \"K\": np.array([[2., 0.1, 0.],\n                           [0.1, 3., 0.2],\n                           [0., 0.2, 4.]]),\n            \"G\": np.array([[1e-6, 0., 0.],\n                           [0., 1., 0.],\n                           [0., 0., 2.]])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        K = case[\"K\"]\n        G = case[\"G\"]\n\n        # Solve the generalized symmetric eigenvalue problem K*d = lambda*G*d.\n        # scipy.linalg.eigh is used as it is optimized for symmetric (Hermitian) matrices.\n        # It returns eigenvalues in ascending order by default.\n        eigenvalues, eigenvectors = eigh(K, G)\n\n        # The smallest buckling load factor corresponds to the smallest eigenvalue.\n        smallest_eigenvalue = eigenvalues[0]\n\n        # --- Numerical Validation Step ---\n        # As per the algorithm design, we can validate the eigenpair using the Rayleigh quotient.\n        # This step is for verification and is not part of the final printed output.\n        # eigenvector_min = eigenvectors[:, 0]\n        # rayleigh_quotient = (eigenvector_min.T @ K @ eigenvector_min) / (eigenvector_min.T @ G @ eigenvector_min)\n        # assert np.isclose(smallest_eigenvalue, rayleigh_quotient), \"Validation failed\"\n        # --- End Validation ---\n\n        # Round the result to six decimal places as required.\n        results.append(f\"{smallest_eigenvalue:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}