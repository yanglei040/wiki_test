{
    "hands_on_practices": [
        {
            "introduction": "Before building numerical models, it is crucial to grasp the mathematical framework of modal analysis. This foundational exercise guides you through a derivation from first principles to connect the physical displacement field to its representation in the modal domain . By leveraging the mass-orthogonality property of eigenvectors, you will see how the complex, coupled equations of motion can be decoupled, a cornerstone of dynamic analysis.",
            "id": "3543998",
            "problem": "Consider the undamped, small-strain free vibration of a linear elastic, homogeneous soil domain discretized by the finite element method (FEM). The semi-discrete equations of motion are given by the second-order ordinary differential equation\n$$\nM \\ddot{u}(t) + K u(t) = 0,\n$$\nwhere $M \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite mass matrix, $K \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite stiffness matrix, and $u(t) \\in \\mathbb{R}^{n}$ is the vector of nodal displacements. The associated generalized eigenvalue problem for free vibration is\n$$\nK \\psi_i = \\omega_i^{2} M \\psi_i,\n$$\nwith real, positive eigenvalues $\\omega_i^{2}$ and real eigenvectors $\\psi_i \\in \\mathbb{R}^{n}$ returned by a numerical eigensolver with arbitrary nonzero scaling.\n\nYou are told to normalize each computed mode to unit generalized mass by enforcing\n$$\n\\phi_i^{T} M \\phi_i = 1,\n$$\nwith $\\phi_i = \\alpha_i \\psi_i$ for some scalar $\\alpha_i \\neq 0$. For a displacement field represented by a truncated modal expansion over mass-normalized modes,\n$$\nu(t) = \\sum_{j=1}^{m} \\phi_j \\, q_j(t),\n$$\nderive from first principles the expression for the modal coordinate $q_i(t)$ in terms of $u(t)$, $M$, and the unnormalized mode $\\psi_i$. Your derivation must begin from the equations of motion and the definition of mass normalization, without introducing any unproved shortcut formulas.\n\nProvide your final answer as a single closed-form analytic expression for $q_i(t)$ in terms of $u(t)$, $M$, and $\\psi_i$. No numerical evaluation is required and no rounding is needed. Do not include physical units in your final expression.",
            "solution": "The problem has been validated and is deemed sound, well-posed, and objective. It is based on fundamental principles of linear algebra and computational mechanics, specifically modal analysis of discrete systems. All necessary information is provided, and the objective is clearly defined. We may proceed with the derivation.\n\nOur objective is to derive an expression for the modal coordinate $q_i(t)$ in terms of the displacement vector $u(t)$, the mass matrix $M$, and the unnormalized eigenvector (mode shape) $\\psi_i$.\n\nThe derivation begins with the provided modal expansion of the displacement field, which represents the total displacement as a linear combination of the mass-normalized mode shapes $\\phi_j$:\n$$\nu(t) = \\sum_{j=1}^{m} \\phi_j \\, q_j(t)\n$$\nTo isolate the specific modal coordinate $q_i(t)$, we will exploit the orthogonality properties of the eigenvectors. The eigenvectors $\\psi_i$ of the generalized eigenvalue problem $K \\psi_i = \\omega_i^2 M \\psi_i$ are orthogonal with respect to both the stiffness matrix $K$ and the mass matrix $M$. The mass orthogonality (or M-orthogonality) is key here. For any two eigenvectors $\\psi_i$ and $\\psi_j$ corresponding to distinct eigenvalues ($\\omega_i^2 \\neq \\omega_j^2$), we have:\n$$\n\\psi_i^T M \\psi_j = 0 \\quad (\\text{for } i \\neq j)\n$$\nThis property derives directly from the eigenvalue problem itself. Given $K \\psi_i = \\omega_i^2 M \\psi_i$ and $K \\psi_j = \\omega_j^2 M \\psi_j$, we pre-multiply the first equation by $\\psi_j^T$ to get $\\psi_j^T K \\psi_i = \\omega_i^2 \\psi_j^T M \\psi_i$. Taking the transpose of the second equation and using the symmetry of $K$ and $M$ ($K=K^T, M=M^T$), we get $\\psi_j^T K \\psi_i = \\omega_j^2 \\psi_j^T M \\psi_i$. Equating these two expressions yields $(\\omega_i^2 - \\omega_j^2)\\psi_j^T M \\psi_i = 0$. Since $\\omega_i^2 \\neq \\omega_j^2$, it follows that $\\psi_j^T M \\psi_i = 0$. For cases with repeated eigenvalues, the corresponding eigenvectors can be chosen to form an M-orthogonal set.\n\nThe mass-normalized mode shapes $\\phi_i$ are related to the unnormalized eigenvectors $\\psi_i$ by a scaling factor $\\alpha_i$, such that $\\phi_i = \\alpha_i \\psi_i$. The M-orthogonality property thus also holds for the normalized modes: for $i \\neq j$, $\\phi_i^T M \\phi_j = (\\alpha_i \\psi_i)^T M (\\alpha_j \\psi_j) = \\alpha_i \\alpha_j (\\psi_i^T M \\psi_j) = 0$.\n\nFurthermore, the problem requires that the modes be normalized to unit generalized mass, which is defined by the condition:\n$$\n\\phi_i^T M \\phi_i = 1\n$$\nCombining the orthogonality and normalization conditions, we obtain the property of M-orthonormality for the set of normalized mode shapes $\\{\\phi_i\\}$:\n$$\n\\phi_i^T M \\phi_j = \\delta_{ij}\n$$\nwhere $\\delta_{ij}$ is the Kronecker delta, which equals $1$ if $i=j$ and $0$ if $i \\neq j$.\n\nWe can now use this M-orthonormality to isolate $q_i(t)$. We take the modal expansion equation for $u(t)$ and pre-multiply both sides by $\\phi_i^T M$:\n$$\n\\phi_i^T M u(t) = \\phi_i^T M \\left( \\sum_{j=1}^{m} \\phi_j \\, q_j(t) \\right)\n$$\nUsing the distributive property of matrix multiplication, we move the pre-multiplier inside the summation:\n$$\n\\phi_i^T M u(t) = \\sum_{j=1}^{m} (\\phi_i^T M \\phi_j) q_j(t)\n$$\nSubstituting the M-orthonormality condition $\\phi_i^T M \\phi_j = \\delta_{ij}$:\n$$\n\\phi_i^T M u(t) = \\sum_{j=1}^{m} \\delta_{ij} \\, q_j(t)\n$$\nThe summation on the right-hand side collapses, as the Kronecker delta $\\delta_{ij}$ is zero for all terms except where the index $j$ is equal to $i$. This leaves only one term:\n$$\n\\phi_i^T M u(t) = q_i(t)\n$$\nThis provides an expression for the modal coordinate $q_i(t)$ in terms of the normalized mode shape $\\phi_i$. The problem, however, requires the final expression to be in terms of the unnormalized eigenvector $\\psi_i$. To achieve this, we first determine the scaling factor $\\alpha_i$ from the normalization condition.\n$$\n\\phi_i^T M \\phi_i = 1\n$$\nSubstitute $\\phi_i = \\alpha_i \\psi_i$:\n$$\n(\\alpha_i \\psi_i)^T M (\\alpha_i \\psi_i) = 1\n$$\nSince $\\alpha_i$ is a scalar, we can factor it out:\n$$\n\\alpha_i^2 (\\psi_i^T M \\psi_i) = 1\n$$\nThe term $\\psi_i^T M \\psi_i$ is a scalar representing the generalized mass of the unnormalized mode $i$. Since $M$ is positive-definite and $\\psi_i$ is a non-zero vector, this term is a positive real number. Solving for $\\alpha_i$ (and conventionally taking the positive root) gives:\n$$\n\\alpha_i = \\frac{1}{\\sqrt{\\psi_i^T M \\psi_i}}\n$$\nNow, substitute this expression for $\\alpha_i$ back into the relationship $\\phi_i = \\alpha_i \\psi_i$:\n$$\n\\phi_i = \\frac{\\psi_i}{\\sqrt{\\psi_i^T M \\psi_i}}\n$$\nFinally, we substitute this expression for $\\phi_i$ into our result for $q_i(t)$:\n$$\nq_i(t) = \\phi_i^T M u(t) = \\left( \\frac{\\psi_i}{\\sqrt{\\psi_i^T M \\psi_i}} \\right)^T M u(t)\n$$\nThe denominator is a scalar and can be factored out. The transpose operation in the numerator applies only to the vector $\\psi_i$:\n$$\nq_i(t) = \\frac{1}{\\sqrt{\\psi_i^T M \\psi_i}} \\psi_i^T M u(t)\n$$\nThis can be written as a single fraction. The numerator, $\\psi_i^T M u(t)$, is a scalar quantity. This is the final expression for the modal coordinate $q_i(t)$ in terms of the specified quantities.",
            "answer": "$$\n\\boxed{\\frac{\\psi_i^T M u(t)}{\\sqrt{\\psi_i^T M \\psi_i}}}\n$$"
        },
        {
            "introduction": "When we discretize a continuous system, practical choices in the numerical formulation have a direct impact on the accuracy of the dynamic solution. This computational practice challenges you to implement a finite element model from scratch to compare the effects of consistent versus lumped mass matrices . This exercise provides a tangible understanding of how different mass formulations introduce systematic biases in the computed natural frequencies and offers insight into the trade-offs between computational simplicity and physical fidelity.",
            "id": "3543947",
            "problem": "You are tasked with developing a complete, runnable program that compares consistent versus lumped mass matrices for a one-dimensional seismic site response model and quantifies the systematic bias in the natural circular frequencies and the compliance with the modal orthogonality relation. The physical system is a vertically discretized, small-strain shear-beam representation of a soil column of height $H$, with lateral displacement $u(z,t)$, shear modulus $G(z)$, and mass density $\\rho(z)$. The governing equation, derived from Newton's Second Law and Hooke's Law for linear elasticity, is $\\rho(z)\\,\\partial^2 u/\\partial t^2=\\partial/\\partial z\\left(G(z)\\,\\partial u/\\partial z\\right)$ for $z\\in(0,H)$, subject to $u(0,t)=0$ (fixed base) and $G(z)\\,\\partial u/\\partial z\\vert_{z=H}=0$ (traction-free surface). Discretize the domain using the finite element method with linear shape functions and unit cross-sectional area to obtain a symmetric global stiffness matrix $K$ and a global mass matrix $M$. Consider two mass formulations: a consistent mass matrix obtained by exact integration of the kinetic energy over each element and a lumped mass matrix obtained by diagonalizing the element mass contributions to the nodes.\n\nDefine the generalized eigenvalue problem $K\\,\\phi=\\omega^2\\,M\\,\\phi$, whose solutions yield the modal vectors $\\phi$ and natural circular frequencies $\\omega$ (expressed in $\\mathrm{rad/s}$). For each mass formulation, compute the first three natural circular frequencies and the corresponding modal vectors under the stated boundary conditions. Define the fractional bias in the $i$-th natural circular frequency as $\\beta_i=\\left(\\omega_i^{\\mathrm{lumped}}-\\omega_i^{\\mathrm{consistent}}\\right)/\\omega_i^{\\mathrm{consistent}}$, expressed as a decimal. To assess the orthogonality property, scale each modal vector $\\phi_i$ so that $\\phi_i^T M\\,\\phi_i=1$ and evaluate the matrix $S=\\Phi^T M\\,\\Phi$, where $\\Phi$ collects the scaled modal vectors as columns. Report the maximum absolute off-diagonal entry of $S$, that is $m=\\max_{i\\neq j}\\left|S_{ij}\\right|$, as a measure of the deviation from $M$-orthogonality. Perform this assessment separately for the consistent and lumped mass formulations.\n\nYour program must assemble $K$ and $M$ from first principles, enforce the fixed-base boundary condition by removing the base degree of freedom, solve the generalized symmetric eigenvalue problem, sort modes by ascending $\\omega$, and compute the required metrics. All natural circular frequencies must be internally handled in $\\mathrm{rad/s}$. The outputs are unitless decimals for the fractional biases and orthogonality metrics.\n\nUse the following test suite of parameter sets, with equal-sized elements along $z\\in[0,H]$ and unit cross-sectional area:\n\n- Test case $1$ (uniform, happy path): $H=30\\,\\mathrm{m}$, $G=80\\times 10^6\\,\\mathrm{Pa}$, $\\rho=1800\\,\\mathrm{kg/m^3}$, $n=10$ elements.\n- Test case $2$ (coarse discretization boundary): $H=30\\,\\mathrm{m}$, $G=80\\times 10^6\\,\\mathrm{Pa}$, $\\rho=1800\\,\\mathrm{kg/m^3}$, $n=3$ elements.\n- Test case $3$ (layered medium): $H=30\\,\\mathrm{m}$, top layer thickness $10\\,\\mathrm{m}$ with $G=40\\times 10^6\\,\\mathrm{Pa}$ and $\\rho=1700\\,\\mathrm{kg/m^3}$, bottom layer thickness $20\\,\\mathrm{m}$ with $G=120\\times 10^6\\,\\mathrm{Pa}$ and $\\rho=1900\\,\\mathrm{kg/m^3}$, $n=30$ elements.\n- Test case $4$ (fine discretization): $H=30\\,\\mathrm{m}$, $G=80\\times 10^6\\,\\mathrm{Pa}$, $\\rho=1800\\,\\mathrm{kg/m^3}$, $n=200$ elements.\n\nFor each test case, compute:\n- The list $[\\beta_1,\\beta_2,\\beta_3]$.\n- The scalar $m_{\\mathrm{consistent}}$ for the consistent mass formulation.\n- The scalar $m_{\\mathrm{lumped}}$ for the lumped mass formulation.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list in the format $[[\\beta_1,\\beta_2,\\beta_3],m_{\\mathrm{consistent}},m_{\\mathrm{lumped}}]$. For example, the output format must be exactly like $[[\\cdot,\\cdot,\\cdot],\\cdot,\\cdot]$ aggregated across the four test cases as a single bracketed list on one line.",
            "solution": "The problem requires the development of a program to compare modal properties derived from consistent and lumped mass matrix formulations for a one-dimensional shear-beam model of a soil column. The analysis involves finite element discretization, solving a generalized eigenvalue problem, and calculating specific metrics for comparison.\n\n**1. Governing Equation and Weak Form**\n\nThe physical system is a soil column of height $H$ modeled as a shear beam. The governing partial differential equation for lateral displacement $u(z,t)$ is given by:\n$$ \\rho(z)\\,\\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial}{\\partial z}\\left(G(z)\\,\\frac{\\partial u}{\\partial z}\\right) \\quad \\text{for } z \\in (0, H) $$\nwhere $\\rho(z)$ is the mass density, $G(z)$ is the shear modulus, and $z$ is the vertical coordinate. The boundary conditions are a fixed base, $u(0,t)=0$, and a traction-free surface, $G(H)\\,\\frac{\\partial u}{\\partial z}\\vert_{z=H}=0$.\n\nAssuming harmonic motion, we use separation of variables, $u(z,t) = \\phi(z)e^{i\\omega t}$, where $\\phi(z)$ is the mode shape and $\\omega$ is the natural circular frequency. Substituting this into the governing equation yields the ordinary differential equation for the mode shape:\n$$ \\frac{d}{dz}\\left(G(z)\\frac{d\\phi}{dz}\\right) + \\omega^2\\rho(z)\\phi(z) = 0 $$\nTo obtain the weak form suitable for the finite element method, we multiply by a test function $v(z)$ (where $v(0)=0$ to satisfy the essential boundary condition) and integrate over the domain $[0, H]$:\n$$ \\int_0^H v(z) \\left[ \\frac{d}{dz}\\left(G(z)\\frac{d\\phi}{dz}\\right) + \\omega^2\\rho(z)\\phi(z) \\right] dz = 0 $$\nIntegrating the stiffness term by parts gives:\n$$ \\left[v(z)G(z)\\frac{d\\phi}{dz}\\right]_0^H - \\int_0^H G(z)\\frac{dv}{dz}\\frac{d\\phi}{dz}dz + \\omega^2\\int_0^H \\rho(z)v(z)\\phi(z)dz = 0 $$\nThe boundary term vanishes because $v(0)=0$ and the natural boundary condition at the surface is $G(H)\\frac{d\\phi}{dz}\\vert_{z=H}=0$. This leads to the weak form of the eigenvalue problem:\n$$ \\int_0^H G(z)\\frac{dv}{dz}\\frac{d\\phi}{dz}dz = \\omega^2\\int_0^H \\rho(z)v(z)\\phi(z)dz $$\n\n**2. Finite Element Discretization**\n\nWe discretize the domain into $n$ one-dimensional elements with linear shape functions. For an element $e$ of length $L_e$ with nodes $1$ and $2$, the displacement field is approximated as $u^e(z) = N_1(z)d_1^e + N_2(z)d_2^e = \\mathbf{N}(z)\\mathbf{d}^e$. For a unit cross-sectional area ($A=1$), the element stiffness matrix $k^e$ and mass matrix $m^e$ are derived from the weak form:\n$$ k^e_{ij} = \\int_{L_e} G_e \\frac{dN_i}{dz}\\frac{dN_j}{dz} dz $$\n$$ m^e_{ij} = \\int_{L_e} \\rho_e N_i N_j dz $$\nAssuming constant properties $G_e$ and $\\rho_e$ over the element, the integration for linear shape functions yields the standard element matrices.\n\nThe element stiffness matrix is:\n$$ k^e = \\frac{G_e}{L_e} \\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\end{bmatrix} $$\nThe element consistent mass matrix, $m_C^e$, derived from exact integration of the kinetic energy term, is:\n$$ m_C^e = \\frac{\\rho_e L_e}{6} \\begin{bmatrix} 2 & 1 \\\\ 1 & 2 \\end{bmatrix} $$\nThe element lumped mass matrix, $m_L^e$, is obtained by lumping the mass at the nodes, typically by summing the rows of the consistent mass matrix and placing the result on the diagonal. This is equivalent to distributing half of the element's mass to each node:\n$$ m_L^e = \\frac{\\rho_e L_e}{2} \\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix} $$\n\n**3. Global System and Eigenvalue Problem**\n\nThe global stiffness matrix $K$ and mass matrices $M_C$ (Consistent) and $M_L$ (Lumped) are assembled by summing the contributions from all $n$ element matrices. The resulting system of equations is the generalized eigenvalue problem:\n$$ K\\,\\phi = \\omega^2 M\\,\\phi $$\nThe system has $n+1$ degrees of freedom (nodes $0, 1, \\dots, n$). The fixed-base boundary condition $u(0)=0$ is enforced by static condensation, which is equivalent to removing the first row and column from the global matrices $K$ and $M$. This reduces the problem to an $n \\times n$ system.\n\n**4. Solution and Post-processing**\n\nThe reduced $n \\times n$ generalized symmetric eigenvalue problem is solved for both mass formulations using a numerical eigensolver, such as `scipy.linalg.eigh`. This yields $n$ eigenvalues $\\lambda_i = \\omega_i^2$ and corresponding eigenvectors $\\phi'_i$. The natural circular frequencies are $\\omega_i = \\sqrt{\\lambda_i}$. The solver returns modes sorted by ascending frequency. The full eigenvectors $\\phi_i$ of size $(n+1) \\times 1$ are recovered by prepending a zero for the fixed base displacement.\n\nThe required metrics are then computed:\n- **Fractional Bias**: The systematic bias in the first three natural frequencies is calculated as:\n$$ \\beta_i = \\frac{\\omega_i^{\\mathrm{lumped}} - \\omega_i^{\\mathrm{consistent}}}{\\omega_i^{\\mathrm{consistent}}} \\quad \\text{for } i \\in \\{1, 2, 3\\} $$\nIt is theoretically established that for a given mesh, the consistent mass formulation tends to overestimate the true continuum frequencies, while the lumped mass formulation tends to underestimate them. Thus, we expect $\\omega_i^{\\mathrm{lumped}} < \\omega_i^{\\mathrm{consistent}}$, leading to negative values for $\\beta_i$.\n\n- **Orthogonality Check**: For each mass formulation (let's use $M$ and $\\phi_i$ as generic placeholders), the first three modal vectors are scaled to be $M$-orthonormal, satisfying $\\phi_i^T M \\phi_j = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta. Standard eigensolvers for generalized problems typically return eigenvectors that are already normalized in this way with respect to the reduced mass matrix. This normalization carries over to the full system. We form a matrix $\\Phi = [\\phi_1, \\phi_2, \\phi_3]$ containing the first three scaled modal vectors as columns. We then compute the check matrix $S = \\Phi^T M \\Phi$. Ideally, $S$ should be the $3 \\times 3$ identity matrix. The metric $m$ quantifies the numerical deviation from perfect orthogonality:\n$$ m = \\max_{i\\neq j}\\left|S_{ij}\\right| $$\nThis is calculated separately for the consistent ($m_{\\mathrm{consistent}}$) and lumped ($m_{\\mathrm{lumped}}$) formulations.\n\nThe program implements this entire procedure, iterating through the provided test cases, each with distinct discretizations and material properties (including a layered profile).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: uniform, n=10\n        {'H': 30.0, 'n': 10, 'layers': [{'thickness': 30.0, 'G': 80e6, 'rho': 1800.0}]},\n        # Case 2: uniform, coarse n=3\n        {'H': 30.0, 'n': 3, 'layers': [{'thickness': 30.0, 'G': 80e6, 'rho': 1800.0}]},\n        # Case 3: layered, n=30\n        {'H': 30.0, 'n': 30, 'layers': [\n            {'thickness': 20.0, 'G': 120e6, 'rho': 1900.0},  # Bottom layer\n            {'thickness': 10.0, 'G': 40e6, 'rho': 1700.0}   # Top layer\n        ]},\n        # Case 4: uniform, fine n=200\n        {'H': 30.0, 'n': 200, 'layers': [{'thickness': 30.0, 'G': 80e6, 'rho': 1800.0}]}\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(run_analysis(case))\n\n    # Format the results for printing as specified.\n    # The output from each case is a list like [[b1, b2, b3], m_c, m_l]\n    # We need to format it into a string representation inside a larger list.\n    formatted_results = []\n    for res in results:\n        betas_str = f\"[{res[0][0]:.8f},{res[0][1]:.8f},{res[0][2]:.8f}]\"\n        m_c_str = f\"{res[1]:.8e}\"\n        m_l_str = f\"{res[2]:.8e}\"\n        formatted_results.append(f\"[{betas_str},{m_c_str},{m_l_str}]\"\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef run_analysis(params):\n    \"\"\"\n    Performs the full analysis for a single test case.\n    \"\"\"\n    H = params['H']\n    n_elements = params['n']\n    layers = params['layers']\n    \n    # Create property functions G(z) and rho(z) from layer data\n    def get_properties(z):\n        current_depth = 0.0\n        for layer in layers:\n            current_depth += layer['thickness']\n            if z <= current_depth:\n                return layer['G'], layer['rho']\n        # Fallback for z=H which might fall on the boundary\n        return layers[-1]['G'], layers[-1]['rho']\n\n    # 1. Assemble matrices\n    K, M_C, M_L = assemble_matrices(H, n_elements, get_properties)\n    \n    # 2. Solve for consistent mass formulation\n    omegas_C, eigvecs_C = solve_eigenproblem(K, M_C)\n    \n    # 3. Solve for lumped mass formulation\n    omegas_L, eigvecs_L = solve_eigenproblem(K, M_L)\n    \n    # 4. Compute metrics\n    # Take first 3 modes for calculations\n    num_modes = 3\n\n    # Fractional bias\n    betas = (omegas_L[:num_modes] - omegas_C[:num_modes]) / omegas_C[:num_modes]\n    \n    # Orthogonality check for consistent mass\n    Phi_C = eigvecs_C[:, :num_modes]\n    S_C = Phi_C.T @ M_C @ Phi_C\n    np.fill_diagonal(S_C, 0.0)\n    m_consistent = np.max(np.abs(S_C))\n\n    # Orthogonality check for lumped mass\n    Phi_L = eigvecs_L[:, :num_modes]\n    S_L = Phi_L.T @ M_L @ Phi_L\n    np.fill_diagonal(S_L, 0.0)\n    m_lumped = np.max(np.abs(S_L))\n\n    return [betas.tolist(), m_consistent, m_lumped]\n\ndef assemble_matrices(H, n_elements, get_properties):\n    \"\"\"\n    Assembles global stiffness and mass matrices for a 1D shear beam.\n    \"\"\"\n    n_nodes = n_elements + 1\n    L_e = H / n_elements  # Element length\n    \n    K = np.zeros((n_nodes, n_nodes))\n    M_C = np.zeros((n_nodes, n_nodes))\n    M_L = np.zeros((n_nodes, n_nodes))\n    \n    # Cross-sectional area is 1\n    A = 1.0\n\n    for e in range(n_elements):\n        # Nodes connected by element e\n        i, j = e, e + 1\n        \n        # Get material properties at the element's midpoint\n        z_mid = (e + 0.5) * L_e\n        G_e, rho_e = get_properties(z_mid)\n        \n        # Element stiffness matrix\n        k_e = (G_e * A / L_e) * np.array([[1, -1], [-1, 1]])\n        \n        # Element consistent mass matrix\n        m_c_e = (rho_e * A * L_e / 6) * np.array([[2, 1], [1, 2]])\n        \n        # Element lumped mass matrix\n        m_l_e = (rho_e * A * L_e / 2) * np.array([[1, 0], [0, 1]])\n        \n        # Assemble into global matrices\n        K[i:j+1, i:j+1] += k_e\n        M_C[i:j+1, i:j+1] += m_c_e\n        M_L[i:j+1, i:j+1] += m_l_e\n        \n    return K, M_C, M_L\n\ndef solve_eigenproblem(K, M):\n    \"\"\"\n    Applies boundary conditions and solves the generalized eigenvalue problem.\n    \"\"\"\n    n_nodes = K.shape[0]\n    \n    # Apply fixed-base boundary condition u(0)=0 by removing the first DOF\n    K_reduced = K[1:, 1:]\n    M_reduced = M[1:, 1:]\n    \n    # Solve the generalized eigenvalue problem: K' * v = w * M' * v\n    # eigh returns eigenvalues in ascending order\n    eigvals, eigvecs_reduced = eigh(K_reduced, M_reduced)\n    \n    # Frequencies omega = sqrt(eigenvalues)\n    omegas = np.sqrt(eigvals)\n    \n    # Reconstruct full eigenvectors (size n_nodes) by prepending zero for the fixed base\n    n_modes = eigvecs_reduced.shape[1]\n    eigvecs_full = np.zeros((n_nodes, n_modes))\n    eigvecs_full[1:, :] = eigvecs_reduced\n    \n    return omegas, eigvecs_full\n\nsolve()\n```"
        },
        {
            "introduction": "We now apply our modeling framework to a central topic in geomechanics: the influence of pore fluid on a soil's dynamic response. This computational experiment uses a simplified, yet insightful, effective density model to explore the transition from undrained (low permeability) to drained (high permeability) conditions . By implementing this model, you will directly observe how the degree of inertial coupling between the soil skeleton and pore fluid alters the system's fundamental frequency and mode shape.",
            "id": "3543949",
            "problem": "You are to design and implement a complete computational experiment to extract and compare the first modal frequency and the corresponding mode shape of a one-dimensional layered soil column under drained versus undrained poroelastic conditions, formulated as a generalized eigenvalue problem. The study is to be performed in the small-strain, linear-elastic regime for shear deformation with vertical coordinate $z \\in [0,H]$ and horizontal displacement $u(z,t)$. The analysis must be based on fundamental principles of continuum mechanics and finite element discretization, and the program must produce quantitative outputs for a specified test suite of permeabilities.\n\nThe fundamental starting point is the one-dimensional shear-wave equation of motion for a nonhomogeneous medium\n$$\n\\rho_{\\mathrm{eff}}(k,z)\\,\\ddot{u}(z,t) = \\frac{\\partial}{\\partial z}\\left(G(z)\\,\\frac{\\partial u(z,t)}{\\partial z}\\right),\n$$\nwith boundary conditions $u(0,t)=0$ (fixed base) and $G(H)\\,\\partial u/\\partial z|_{z=H}=0$ (traction-free ground surface). Here, $G(z)$ is the shear modulus of the soil skeleton and $\\rho_{\\mathrm{eff}}(k,z)$ is the effective density that depends on the intrinsic permeability $k$ and the vertical position through the porosity. Assume a unit cross-sectional area $A=1$ so that the problem is per unit width.\n\nTo connect drained and undrained poroelastic limits in a frequency-independent surrogate model, approximate the effective density as\n$$\n\\rho_{\\mathrm{eff}}(k,z) = \\left(1 - n(z)\\right)\\,\\rho_s + \\beta(k)\\,n(z)\\,\\rho_f,\n$$\nwhere $\\rho_s$ is the solid density, $\\rho_f$ is the pore fluid density, $n(z)$ is the porosity, and $\\beta(k)$ is a monotone function that interpolates between the undrained limit $\\beta(0)=1$ (pore fluid fully moving with the skeleton) and the drained limit $\\beta(\\infty)=0$ (pore fluid fully decoupled inertially). For this experiment, use the calibration\n$$\n\\beta(k) = \\frac{1}{1 + k/k_c},\n$$\nwith $k_c$ a characteristic permeability.\n\nDiscretize the interval $[0,H]$ into $N_e$ uniform two-node linear finite elements and construct the global stiffness matrix $[K]$ and mass matrix $[M]$ by applying the standard Galerkin finite element method with consistent mass for the governing equation. Impose the essential boundary condition at the base by eliminating the corresponding degree of freedom, and keep the natural boundary condition at the top. Compute the free-vibration modes by solving the generalized eigenvalue problem\n$$\n[K]\\,\\boldsymbol{\\phi} = \\omega^2\\,[M]\\,\\boldsymbol{\\phi},\n$$\nand extract the fundamental circular frequency $\\omega_1$ and its associated eigenvector $\\boldsymbol{\\phi}_1$. Report the fundamental frequency in Hertz $f_0 = \\omega_1/(2\\pi)$.\n\nQuantify the variation of the mode shape as permeability varies by computing the Modal Assurance Criterion (MAC) between the fundamental mode for a given permeability $k$ and the fundamental mode for a reference drained case with permeability $k_{\\mathrm{ref}}$. For two real-valued vectors $\\boldsymbol{\\phi}_a$ and $\\boldsymbol{\\phi}_b$, define the Modal Assurance Criterion as\n$$\n\\mathrm{MAC}(\\boldsymbol{\\phi}_a,\\boldsymbol{\\phi}_b) = \\frac{\\left(\\boldsymbol{\\phi}_a^{\\mathsf{T}}\\,\\boldsymbol{\\phi}_b\\right)^2}{\\left(\\boldsymbol{\\phi}_a^{\\mathsf{T}}\\,\\boldsymbol{\\phi}_a\\right)\\left(\\boldsymbol{\\phi}_b^{\\mathsf{T}}\\,\\boldsymbol{\\phi}_b\\right)}.\n$$\n\nUse the following physically plausible, self-consistent parameters:\n- Geometry: total height $H=30\\,\\mathrm{m}$, unit area $A=1\\,\\mathrm{m}^2$, $N_e=60$ uniform elements.\n- Layering: three layers of equal thickness $10\\,\\mathrm{m}$ each, from base to top. Shear moduli $G_1=50\\times 10^6\\,\\mathrm{Pa}$, $G_2=100\\times 10^6\\,\\mathrm{Pa}$, $G_3=30\\times 10^6\\,\\mathrm{Pa}$. Porosities $n_1=0.35$, $n_2=0.30$, $n_3=0.40$.\n- Densities: solid density $\\rho_s=2650\\,\\mathrm{kg/m^3}$, fluid density $\\rho_f=1000\\,\\mathrm{kg/m^3}$.\n- Permeability coupling: characteristic permeability $k_c=10^{-9}\\,\\mathrm{m^2}$, interpolation $\\beta(k)=1/(1+k/k_c)$.\n\nTest suite and outputs:\n- Use the permeability test suite $\\{k_i\\}$ with $k_1=0.0\\,\\mathrm{m^2}$, $k_2=10^{-12}\\,\\mathrm{m^2}$, $k_3=10^{-9}\\,\\mathrm{m^2}$, $k_4=10^{-6}\\,\\mathrm{m^2}$, $k_5=10^{-4}\\,\\mathrm{m^2}$. Treat the most drained reference as $k_{\\mathrm{ref}}=10^{-4}\\,\\mathrm{m^2}$.\n- For each $k_i$, compute the pair $\\left(f_0(k_i), \\mathrm{MAC}(\\boldsymbol{\\phi}_1(k_i),\\boldsymbol{\\phi}_1(k_{\\mathrm{ref}}))\\right)$. Express $f_0$ in $\\mathrm{Hz}$ and the Modal Assurance Criterion as a dimensionless number. Round all numerical outputs to six decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[ f_0(k_1), \\mathrm{MAC}(k_1), f_0(k_2), \\mathrm{MAC}(k_2), \\dots, f_0(k_5), \\mathrm{MAC}(k_5) \\right],\n$$\nwith each entry rounded to six decimal places and $f_0$ in $\\mathrm{Hz}$. No other text should be printed.\n\nThe solution must start from the stated governing equation and boundary conditions, construct the finite element operators, solve the generalized eigenvalue problem, and implement the specified drainedâ€“undrained interpolation through $\\rho_{\\mathrm{eff}}(k,z)$ to quantify the influence of $k$ on $f_0$ and on the fundamental mode shape via the Modal Assurance Criterion.",
            "solution": "The problem requires the design of a computational experiment to determine the fundamental frequency and mode shape of a one-dimensional layered soil column. The analysis compares the behavior under drained and undrained conditions using a finite element model. The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution.\n\nThe analysis begins with the governing equation for one-dimensional shear wave propagation in a heterogeneous medium:\n$$\n\\rho_{\\mathrm{eff}}(k,z)\\,\\ddot{u}(z,t) = \\frac{\\partial}{\\partial z}\\left(G(z)\\,\\frac{\\partial u(z,t)}{\\partial z}\\right)\n$$\nThis equation describes the balance of inertial forces and elastic shear stresses for horizontal displacement $u(z,t)$ along the vertical coordinate $z \\in [0,H]$. The boundary conditions are a fixed base, $u(0,t)=0$, and a traction-free surface, $G(H)\\,\\partial u/\\partial z|_{z=H}=0$.\n\nFor free vibration analysis, we assume a harmonic solution of the form $u(z,t) = \\phi(z)e^{i\\omega t}$. Substituting this into the governing equation yields the time-independent equation:\n$$\n-\\omega^2 \\rho_{\\mathrm{eff}}(k,z) \\phi(z) = \\frac{d}{dz}\\left(G(z)\\frac{d\\phi(z)}{dz}\\right)\n$$\nwhere $\\omega$ is the circular frequency of vibration and $\\phi(z)$ is the mode shape.\n\nTo solve this equation using the Galerkin finite element method, we first derive its weak form. We multiply the equation by an arbitrary test function $v(z)$ that satisfies the essential boundary condition, $v(0)=0$, and integrate over the domain $[0,H]$:\n$$\n-\\int_{0}^{H} v(z) \\omega^2 \\rho_{\\mathrm{eff}}(k,z) \\phi(z) \\,dz = \\int_{0}^{H} v(z) \\frac{d}{dz}\\left(G(z)\\frac{d\\phi(z)}{dz}\\right) \\,dz\n$$\nApplying integration by parts to the right-hand side gives:\n$$\n\\int_{0}^{H} v(z) \\frac{d}{dz}\\left(G(z)\\frac{d\\phi(z)}{dz}\\right) \\,dz = \\left[v(z) G(z) \\frac{d\\phi(z)}{dz}\\right]_{0}^{H} - \\int_{0}^{H} \\frac{dv(z)}{dz} G(z) \\frac{d\\phi(z)}{dz} \\,dz\n$$\nThe boundary term $\\left[v(z) G(z) d\\phi(z)/dz\\right]_{0}^{H}$ evaluates to zero. At $z=0$, $v(0)=0$. At $z=H$, the natural boundary condition $G(H) d\\phi/dz|_{z=H}=0$ applies. Thus, the weak form is:\n$$\n\\int_{0}^{H} \\frac{dv}{dz} G(z) \\frac{d\\phi}{dz} \\,dz = \\omega^2 \\int_{0}^{H} v \\rho_{\\mathrm{eff}}(k,z) \\phi \\,dz\n$$\n\nNext, we discretize the domain $[0,H]$ into $N_e$ uniform two-node linear finite elements. The length of each element is $h_e = H/N_e$. Within each element $e$, the displacement field $\\phi(z)$ and the test function $v(z)$ are approximated using linear shape functions $\\mathbf{N}(z)$:\n$$\n\\phi_e(z) = \\mathbf{N}(z) \\mathbf{d}_e, \\quad v_e(z) = \\mathbf{N}(z) \\mathbf{c}_e\n$$\nwhere $\\mathbf{d}_e$ and $\\mathbf{c}_e$ are vectors of nodal values. Substituting these approximations into the element-level weak form yields:\n$$\n\\mathbf{c}_e^{\\mathsf{T}} \\left( \\int_{\\Omega_e} \\frac{d\\mathbf{N}^{\\mathsf{T}}}{dz} G_e \\frac{d\\mathbf{N}}{dz} \\,dz \\right) \\mathbf{d}_e = \\omega^2 \\mathbf{c}_e^{\\mathsf{T}} \\left( \\int_{\\Omega_e} \\mathbf{N}^{\\mathsf{T}} \\rho_{\\mathrm{eff},e} \\mathbf{N} \\,dz \\right) \\mathbf{d}_e\n$$\nSince this must hold for any arbitrary $\\mathbf{c}_e$, we obtain the element-level matrix equation:\n$$\n[k_e] \\mathbf{d}_e = \\omega^2 [m_e] \\mathbf{d}_e\n$$\nwhere $[k_e]$ is the element stiffness matrix and $[m_e]$ is the element consistent mass matrix, defined as:\n$$\n[k_e] = \\int_{\\Omega_e} G_e \\mathbf{B}^{\\mathsf{T}} \\mathbf{B} \\,dA\\,dz, \\quad [m_e] = \\int_{\\Omega_e} \\rho_{\\mathrm{eff},e} \\mathbf{N}^{\\mathsf{T}} \\mathbf{N} \\,dA\\,dz\n$$\nHere, $\\mathbf{B} = d\\mathbf{N}/dz$ and we assume a unit cross-sectional area $A=1$. For a two-node linear element of length $h_e$, these matrices evaluate to:\n$$\n[k_e] = \\frac{G_e}{h_e} \\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\end{bmatrix}, \\quad [m_e] = \\frac{\\rho_{\\mathrm{eff}, e} h_e}{6} \\begin{bmatrix} 2 & 1 \\\\ 1 & 2 \\end{bmatrix}\n$$\nThe material properties $G_e$ and $\\rho_{\\mathrm{eff}, e}$ are taken as constant over each element, corresponding to the soil layer in which the element resides. The effective density $\\rho_{\\mathrm{eff}, e}$ is calculated based on the permeability $k$ using the provided interpolation:\n$$\n\\rho_{\\mathrm{eff},e}(k) = (1-n_e)\\rho_s + \\beta(k) n_e \\rho_f, \\quad \\text{with} \\quad \\beta(k) = \\frac{1}{1+k/k_c}\n$$\nwhere $n_e$ is the porosity of the element's layer.\n\nThe global matrices $[K]$ and $[M]$ are assembled by summing the contributions from all $N_e$ element matrices. The fixed-base boundary condition $u(0)=0$ is imposed by eliminating the first row and column from both $[K]$ and $[M]$, resulting in reduced matrices $[K_{red}]$ and $[M_{red}]$ of size $N_e \\times N_e$.\n\nThis leads to the generalized eigenvalue problem for the free degrees of freedom:\n$$\n[K_{red}] \\boldsymbol{\\phi} = \\omega^2 [M_{red}] \\boldsymbol{\\phi}\n$$\nSolving this system yields $N_e$ eigenvalues $\\lambda_i = \\omega_i^2$ and corresponding eigenvectors $\\boldsymbol{\\phi}_i$. The fundamental (lowest) natural frequency corresponds to the smallest eigenvalue, $\\omega_1^2 = \\min(\\lambda_i)$. The fundamental frequency in Hertz is then $f_0 = \\omega_1 / (2\\pi)$. The associated eigenvector $\\boldsymbol{\\phi}_1$ represents the fundamental mode shape of the free nodes.\n\nTo quantify the similarity between two mode shapes, $\\boldsymbol{\\phi}_a$ and $\\boldsymbol{\\phi}_b$, the Modal Assurance Criterion (MAC) is used:\n$$\n\\mathrm{MAC}(\\boldsymbol{\\phi}_a, \\boldsymbol{\\phi}_b) = \\frac{(\\boldsymbol{\\phi}_a^{\\mathsf{T}} \\boldsymbol{\\phi}_b)^2}{(\\boldsymbol{\\phi}_a^{\\mathsf{T}} \\boldsymbol{\\phi}_a) (\\boldsymbol{\\phi}_b^{\\mathsf{T}} \\boldsymbol{\\phi}_b)}\n$$\nA MAC value of $1$ indicates perfectly correlated modes, while a value of $0$ indicates orthogonal modes.\n\nThe computational procedure is as follows:\n1. Define all geometric, material, and discretization parameters: $H=30\\,\\mathrm{m}$, $N_e=60$, layer properties ($G_i, n_i$), densities ($\\rho_s, \\rho_f$), and permeability parameters ($k_c$).\n2. Run the analysis for the reference permeability $k_{\\mathrm{ref}}=10^{-4}\\,\\mathrm{m^2}$ to obtain the reference mode shape $\\boldsymbol{\\phi}_1(k_{\\mathrm{ref}})$.\n3. Iterate through the test suite of permeabilities $k_i \\in \\{0.0, 10^{-12}, 10^{-9}, 10^{-6}, 10^{-4}\\}\\,\\mathrm{m^2}$.\n4. For each $k_i$:\n    a. Calculate the global mass matrix $[M(k_i)]$. The stiffness matrix $[K]$ is independent of permeability.\n    b. Apply boundary conditions to obtain $[K_{red}]$ and $[M_{red}(k_i)]$.\n    c. Solve the eigenvalue problem $[K_{red}] \\boldsymbol{\\phi}(k_i) = \\omega^2 [M_{red}(k_i)] \\boldsymbol{\\phi}(k_i)$ for the lowest eigenvalue $\\omega_1^2(k_i)$ and its eigenvector $\\boldsymbol{\\phi}_1(k_i)$.\n    d. Calculate the fundamental frequency $f_0(k_i) = \\omega_1(k_i) / (2\\pi)$.\n    e. Compute the MAC value between the current mode shape and the reference mode shape: $\\mathrm{MAC}(\\boldsymbol{\\phi}_1(k_i), \\boldsymbol{\\phi}_1(k_{\\mathrm{ref}}))$.\n5. Collect and format the pairs $(f_0(k_i), \\mathrm{MAC}(k_i))$ for the final output. The case $k_i=k_{\\mathrm{ref}}$ will by definition yield a MAC value of $1$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Computes the fundamental frequency and mode shape of a layered soil column\n    using the Finite Element Method for a range of permeabilities.\n    \"\"\"\n\n    # --- 1. Define Model Parameters ---\n    # Geometry and Discretization\n    H = 30.0  # m, total height\n    Ne = 60   # number of elements\n    num_nodes = Ne + 1\n    h_e = H / Ne  # element length\n\n    # Layer Properties (from base to top)\n    # Layer 1: z in [0, 10] m, G=50 MPa, n=0.35\n    # Layer 2: z in [10, 20] m, G=100 MPa, n=0.30\n    # Layer 3: z in [20, 30] m, G=30 MPa, n=0.40\n    layer_props = {\n        1: {'G': 50e6, 'n': 0.35},  # Pa, dimensionless\n        2: {'G': 100e6, 'n': 0.30},\n        3: {'G': 30e6, 'n': 0.40},\n    }\n    layer_boundaries = [10.0, 20.0, 30.0]\n\n    # Material Densities\n    rho_s = 2650.0  # kg/m^3\n    rho_f = 1000.0  # kg/m^3\n\n    # Permeability Coupling\n    k_c = 1e-9  # m^2, characteristic permeability\n\n    # Test Suite\n    k_suite = [0.0, 1e-12, 1e-9, 1e-6, 1e-4]  # m^2\n    k_ref = 1e-4  # m^2, reference permeability for MAC\n\n    # --- 2. Helper Functions ---\n    def get_element_properties(elem_idx):\n        \"\"\"Returns G and n for a given element index.\"\"\"\n        mid_z = (elem_idx + 0.5) * h_e\n        if mid_z <= layer_boundaries[0]:\n            return layer_props[1]['G'], layer_props[1]['n']\n        elif mid_z <= layer_boundaries[1]:\n            return layer_props[2]['G'], layer_props[2]['n']\n        else:\n            return layer_props[3]['G'], layer_props[3]['n']\n\n    def beta_func(k, kc):\n        \"\"\"Calculates the drained-undrained interpolation factor.\"\"\"\n        return 1.0 / (1.0 + k / kc)\n\n    def compute_mac(phi_a, phi_b):\n        \"\"\"Computes the Modal Assurance Criterion.\"\"\"\n        num = (phi_a.T @ phi_b)**2\n        den = (phi_a.T @ phi_a) * (phi_b.T @ phi_b)\n        if den == 0:\n            return 0.0\n        return num / den\n\n    def run_analysis(k):\n        \"\"\"Performs FE analysis for a given permeability k.\"\"\"\n        # Initialize global matrices\n        K_global = np.zeros((num_nodes, num_nodes))\n        M_global = np.zeros((num_nodes, num_nodes))\n        \n        beta = beta_func(k, k_c)\n\n        # Assemble global matrices\n        for i in range(Ne):\n            G_e, n_e = get_element_properties(i)\n            \n            # Element stiffness matrix\n            k_e = (G_e / h_e) * np.array([[1, -1], [-1, 1]])\n            \n            # Element mass matrix (consistent)\n            rho_eff_e = (1 - n_e) * rho_s + beta * n_e * rho_f\n            m_e = (rho_eff_e * h_e / 6.0) * np.array([[2, 1], [1, 2]])\n            \n            # Assembly into global matrices\n            K_global[i:i+2, i:i+2] += k_e\n            M_global[i:i+2, i:i+2] += m_e\n            \n        # Apply boundary conditions (fixed base u(0)=0)\n        # Eliminate first row and column\n        K_reduced = K_global[1:, 1:]\n        M_reduced = M_global[1:, 1:]\n        \n        # Solve the generalized eigenvalue problem K*phi = w^2*M*phi\n        # eigh returns eigenvalues in ascending order\n        eigenvalues, eigenvectors = eigh(K_reduced, M_reduced)\n        \n        # Extract fundamental frequency and mode shape\n        omega1_sq = eigenvalues[0]\n        omega1 = np.sqrt(omega1_sq)\n        f0 = omega1 / (2 * np.pi)\n        \n        phi1 = eigenvectors[:, 0]\n        \n        return f0, phi1\n\n    # --- 3. Main Calculation Loop ---\n    \n    # First, compute the reference mode shape\n    _, phi1_ref = run_analysis(k_ref)\n    \n    results = []\n    \n    for k_val in k_suite:\n        # Compute frequency and mode shape for the current k\n        f0_k, phi1_k = run_analysis(k_val)\n        \n        # Compute MAC with respect to the reference mode\n        mac_k = compute_mac(phi1_k, phi1_ref)\n        \n        # Append rounded results\n        results.append(round(f0_k, 6))\n        results.append(round(mac_k, 6))\n\n    # --- 4. Final Output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}