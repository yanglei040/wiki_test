{
    "hands_on_practices": [
        {
            "introduction": "In the Finite Element Method (FEM), stresses are naturally calculated at integration points (Gauss points) within each element, resulting in a field that is optimal at these points but generally discontinuous across element boundaries. To obtain a continuous and visually interpretable stress field, we perform a procedure called stress smoothing. This first practice  introduces the global $L^2$-projection, a powerful and mathematically rigorous method for achieving this. By working through a one-dimensional bar, you will construct the global system of equations and solve for the nodal stresses that represent the best continuous approximation to the discontinuous field, providing a foundational understanding of the projection technique.",
            "id": "3564930",
            "problem": "A straight, prismatic, one-dimensional bar of length $L=3\\,\\mathrm{m}$ is discretized using the Finite Element Method (FEM) with three uniform linear (two-node) elements, so that the global nodes are located at $x=0\\,\\mathrm{m}$, $x=1\\,\\mathrm{m}$, $x=2\\,\\mathrm{m}$, and $x=3\\,\\mathrm{m}$. For each element, consider the standard isoparametric mapping with parent coordinate $\\xi \\in [-1,1]$, linear shape functions $N_{1}(\\xi) = (1-\\xi)/2$ and $N_{2}(\\xi) = (1+\\xi)/2$, and Jacobian determinant $J_{e} = L_{e}/2$ with $L_{e}=1\\,\\mathrm{m}$ for all elements. The axial stress field $\\sigma_{h}(x)$ is known only at the two-point Gaussian quadrature locations within each element, with abscissae $\\xi = \\pm 1/\\sqrt{3}$ and weights $w=1$. The given axial stress values at the Gauss points for the three elements (from left to right) are:\n- Element $1$ (connecting $x=0$ to $x=1$): $\\sigma_{1,-} = 102\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$ and $\\sigma_{1,+} = 110\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n- Element $2$ (connecting $x=1$ to $x=2$): $\\sigma_{2,-} = 118\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$ and $\\sigma_{2,+} = 126\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n- Element $3$ (connecting $x=2$ to $x=3$): $\\sigma_{3,-} = 134\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$ and $\\sigma_{3,+} = 142\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n\nYou are to construct the globally $L^{2}$-projected nodal stress field $\\hat{\\sigma}(x)$ represented in the linear nodal basis $\\{N_{i}(x)\\}_{i=1}^{4}$ so that $\\hat{\\sigma}(x) = \\sum_{i=1}^{4} s_{i} N_{i}(x)$ and the vector of nodal stresses $\\{s_{i}\\}$ minimizes the $L^{2}$-norm of the difference to $\\sigma_{h}(x)$ over the entire bar. Approximate all integrals using the provided two-point Gaussian quadrature on each element, and assemble a single global system for the four nodal values $\\{s_{i}\\}$.\n\nAdditionally, compute a “simple averaging” nodal stress estimate defined at each global node as the arithmetic mean of all Gauss-point stresses from the elements that share that node. For end nodes, this is the mean of the two Gauss points in the single adjacent element; for interior nodes, it is the mean of the four Gauss points from the two adjacent elements.\n\nReport the $L^{2}$-projected nodal stress values at the four global nodes. Express the final nodal stress values in $\\mathrm{MPa}$ and round your answer to four significant figures. State any intermediate assumptions clearly and ensure scientific consistency in the derivation.",
            "solution": "The user wants to find the nodal stresses from a Finite Element Method (FEM) analysis by applying a global $L^{2}$-projection. This procedure is also known as stress smoothing.\n\n### Step 1: Problem Validation\n\nThe problem statement has been validated against the specified criteria.\n\n**1. Extract Givens:**\n- A one-dimensional bar of length $L=3\\,\\mathrm{m}$.\n- Discretization: $3$ uniform linear (two-node) elements.\n- Global nodes at $x=0\\,\\mathrm{m}$, $x=1\\,\\mathrm{m}$, $x=2\\,\\mathrm{m}$, $x=3\\,\\mathrm{m}$.\n- Element length $L_{e}=1\\,\\mathrm{m}$ for each element.\n- Isoparametric parent coordinate $\\xi \\in [-1,1]$.\n- Linear shape functions: $N_{1}(\\xi) = \\frac{1-\\xi}{2}$, $N_{2}(\\xi) = \\frac{1+\\xi}{2}$.\n- Jacobian determinant: $J_{e} = L_{e}/2 = 1/2$.\n- Gaussian quadrature: two-point rule with abscissae $\\xi_{k} = \\pm 1/\\sqrt{3}$ and weights $w_{k}=1$.\n- Stress values $\\sigma_{h}$ at Gauss points:\n  - Element $1$ ($x \\in [0, 1]$): $\\sigma_{1,-} = 102\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$, $\\sigma_{1,+} = 110\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n  - Element $2$ ($x \\in [1, 2]$): $\\sigma_{2,-} = 118\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$, $\\sigma_{2,+} = 126\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n  - Element $3$ ($x \\in [2, 3]$): $\\sigma_{3,-} = 134\\,\\mathrm{MPa}$ at $\\xi=-1/\\sqrt{3}$, $\\sigma_{3,+} = 142\\,\\mathrm{MPa}$ at $\\xi=+1/\\sqrt{3}$.\n\n**2. Task:**\n- Find the globally $L^{2}$-projected nodal stress vector $\\mathbf{s} = \\{s_{1}, s_{2}, s_{3}, s_{4}\\}^{T}$ for the continuous stress field approximation $\\hat{\\sigma}(x) = \\sum_{i=1}^{4} s_{i} N_{i}(x)$.\n- Use two-point Gaussian quadrature for all integrations.\n- Round the final values to four significant figures.\n\n**3. Validation Verdict:**\nThe problem is scientifically grounded, well-posed, objective, and complete. It describes a standard procedure in computational mechanics for post-processing FEM results. No flaws were detected.\n\n### Step 2: Solution Derivation\n\nThe goal is to find the nodal stress values $\\{s_{i}\\}$ that minimize the $L^{2}$-error between the discontinuous FEM stress field $\\sigma_{h}(x)$ and its continuous, globally-defined approximation $\\hat{\\sigma}(x) = \\sum_{j=1}^{4} s_j N_j(x)$. This is achieved by minimizing the functional:\n$$ \\Pi(\\mathbf{s}) = \\int_{0}^{L} (\\hat{\\sigma}(x) - \\sigma_{h}(x))^{2} dx $$\nThe minimization condition $\\frac{\\partial \\Pi}{\\partial s_{i}} = 0$ for each $i \\in \\{1, 2, 3, 4\\}$ leads to the Galerkin weak form:\n$$ \\int_{0}^{L} \\hat{\\sigma}(x) N_{i}(x) dx = \\int_{0}^{L} \\sigma_{h}(x) N_{i}(x) dx $$\nSubstituting $\\hat{\\sigma}(x) = \\sum_{j=1}^{4} s_j N_j(x)$, we obtain a system of linear equations:\n$$ \\sum_{j=1}^{4} \\left( \\int_{0}^{L} N_{i}(x) N_{j}(x) dx \\right) s_{j} = \\int_{0}^{L} \\sigma_{h}(x) N_{i}(x) dx $$\nThis system can be written in matrix form as $\\mathbf{M} \\mathbf{s} = \\mathbf{f}$, where:\n- $\\mathbf{s} = [s_{1}, s_{2}, s_{3}, s_{4}]^T$ is the vector of unknown nodal stresses.\n- $\\mathbf{M}$ is the global mass matrix, with entries $M_{ij} = \\int_{0}^{L} N_i(x) N_j(x) dx$.\n- $\\mathbf{f}$ is the global force vector, with entries $f_i = \\int_{0}^{L} \\sigma_h(x) N_i(x) dx$.\n\nThe global matrices are assembled from elemental contributions. For a linear two-node element, the elemental mass matrix $\\mathbf{M}^{(e)}$ and force vector $\\mathbf{f}^{(e)}$ are computed over the parent domain $\\xi \\in [-1, 1]$.\n\n**Elemental Mass Matrix:**\nThe entries of the elemental mass matrix are given by $M_{ab}^{(e)} = \\int_{-1}^{1} N_{a}(\\xi) N_{b}(\\xi) J_{e} d\\xi$, where $a,b \\in \\{1,2\\}$ are local node indices. With $L_e=1$ and $J_e = L_e/2 = 1/2$, the standard elemental mass matrix for a linear bar element is:\n$$ \\mathbf{M}^{(e)} = \\frac{L_{e}}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} = \\frac{1}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix} $$\nThis result is exact as two-point Gaussian quadrature exactly integrates polynomials of degree up to $3$. The integrand $N_a(\\xi)N_b(\\xi)$ is of degree $2$.\n\n**Global Mass Matrix Assembly:**\nThe global nodes are $1, 2, 3, 4$. Element $1$ connects nodes $1, 2$; element $2$ connects nodes $2, 3$; and element $3$ connects nodes $3, 4$. Assembling the elemental matrices yields the global mass matrix:\n$$ \\mathbf{M} = \\mathbf{M}^{(1)} + \\mathbf{M}^{(2)} + \\mathbf{M}^{(3)} = \\frac{1}{6} \\begin{pmatrix} 2 & 1 & 0 & 0 \\\\ 1 & 2+2 & 1 & 0 \\\\ 0 & 1 & 2+2 & 1 \\\\ 0 & 0 & 1 & 2 \\end{pmatrix} = \\frac{1}{6} \\begin{pmatrix} 2 & 1 & 0 & 0 \\\\ 1 & 4 & 1 & 0 \\\\ 0 & 1 & 4 & 1 \\\\ 0 & 0 & 1 & 2 \\end{pmatrix} $$\n\n**Elemental Force Vector:**\nThe entries of the elemental force vector are $f_{a}^{(e)} = \\int_{\\Omega_e} \\sigma_h(x) N_a(x) dx$. We use two-point Gaussian quadrature with weights $w_k=1$ and abscissae $\\xi_k = \\pm 1/\\sqrt{3}$.\n$$ f_{a}^{(e)} = \\int_{-1}^{1} \\sigma_{h}(\\xi) N_{a}(\\xi) J_{e} d\\xi \\approx \\sum_{k=1}^{2} w_k \\sigma_{h}(\\xi_k) N_{a}(\\xi_k) J_{e} = \\frac{1}{2} \\left[ \\sigma_{h}(-\\tfrac{1}{\\sqrt{3}}) N_{a}(-\\tfrac{1}{\\sqrt{3}}) + \\sigma_{h}(+\\tfrac{1}{\\sqrt{3}}) N_{a}(+\\tfrac{1}{\\sqrt{3}}) \\right] $$\nThe shape function values at the Gauss points are:\n$N_{1}(-\\tfrac{1}{\\sqrt{3}}) = \\frac{1+1/\\sqrt{3}}{2}$, $N_{2}(-\\tfrac{1}{\\sqrt{3}}) = \\frac{1-1/\\sqrt{3}}{2}$\n$N_{1}(+\\tfrac{1}{\\sqrt{3}}) = \\frac{1-1/\\sqrt{3}}{2}$, $N_{2}(+\\tfrac{1}{\\sqrt{3}}) = \\frac{1+1/\\sqrt{3}}{2}$\n\n- **Element 1:** $\\sigma_{1,-}=102$, $\\sigma_{1,+}=110$.\n$f_{1}^{(1)} = \\frac{1}{2} \\left[ 102 \\frac{1+1/\\sqrt{3}}{2} + 110 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [212 - \\frac{8}{\\sqrt{3}}] = 53 - \\frac{2}{\\sqrt{3}}$.\n$f_{2}^{(1)} = \\frac{1}{2} \\left[ 102 \\frac{1-1/\\sqrt{3}}{2} + 110 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [212 + \\frac{8}{\\sqrt{3}}] = 53 + \\frac{2}{\\sqrt{3}}$.\n\n- **Element 2:** $\\sigma_{2,-}=118$, $\\sigma_{2,+}=126$.\n$f_{1}^{(2)} = \\frac{1}{2} \\left[ 118 \\frac{1+1/\\sqrt{3}}{2} + 126 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [244 - \\frac{8}{\\sqrt{3}}] = 61 - \\frac{2}{\\sqrt{3}}$.\n$f_{2}^{(2)} = \\frac{1}{2} \\left[ 118 \\frac{1-1/\\sqrt{3}}{2} + 126 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [244 + \\frac{8}{\\sqrt{3}}] = 61 + \\frac{2}{\\sqrt{3}}$.\n\n- **Element 3:** $\\sigma_{3,-}=134$, $\\sigma_{3,+}=142$.\n$f_{1}^{(3)} = \\frac{1}{2} \\left[ 134 \\frac{1+1/\\sqrt{3}}{2} + 142 \\frac{1-1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [276 - \\frac{8}{\\sqrt{3}}] = 69 - \\frac{2}{\\sqrt{3}}$.\n$f_{2}^{(3)} = \\frac{1}{2} \\left[ 134 \\frac{1-1/\\sqrt{3}}{2} + 142 \\frac{1+1/\\sqrt{3}}{2} \\right] = \\frac{1}{4} [276 + \\frac{8}{\\sqrt{3}}] = 69 + \\frac{2}{\\sqrt{3}}$.\n\n**Global Force Vector Assembly:**\n$f_{1} = f_{1}^{(1)} = 53 - \\frac{2}{\\sqrt{3}}$.\n$f_{2} = f_{2}^{(1)} + f_{1}^{(2)} = (53 + \\frac{2}{\\sqrt{3}}) + (61 - \\frac{2}{\\sqrt{3}}) = 114$.\n$f_{3} = f_{2}^{(2)} + f_{1}^{(3)} = (61 + \\frac{2}{\\sqrt{3}}) + (69 - \\frac{2}{\\sqrt{3}}) = 130$.\n$f_{4} = f_{2}^{(3)} = 69 + \\frac{2}{\\sqrt{3}}$.\nSo, $\\mathbf{f} = [ 53 - \\frac{2}{\\sqrt{3}}, 114, 130, 69 + \\frac{2}{\\sqrt{3}} ]^T$.\n\n**Solving the Global System:**\nThe system $\\mathbf{M} \\mathbf{s} = \\mathbf{f}$ becomes:\n$$ \\frac{1}{6} \\begin{pmatrix} 2 & 1 & 0 & 0 \\\\ 1 & 4 & 1 & 0 \\\\ 0 & 1 & 4 & 1 \\\\ 0 & 0 & 1 & 2 \\end{pmatrix} \\begin{pmatrix} s_{1} \\\\ s_{2} \\\\ s_{3} \\\\ s_{4} \\end{pmatrix} = \\begin{pmatrix} 53 - \\frac{2}{\\sqrt{3}} \\\\ 114 \\\\ 130 \\\\ 69 + \\frac{2}{\\sqrt{3}} \\end{pmatrix} $$\nMultiplying by $6$:\n$$ \\begin{pmatrix} 2 & 1 & 0 & 0 \\\\ 1 & 4 & 1 & 0 \\\\ 0 & 1 & 4 & 1 \\\\ 0 & 0 & 1 & 2 \\end{pmatrix} \\begin{pmatrix} s_{1} \\\\ s_{2} \\\\ s_{3} \\\\ s_{4} \\end{pmatrix} = \\begin{pmatrix} 318 - \\frac{12}{\\sqrt{3}} \\\\ 684 \\\\ 780 \\\\ 414 + \\frac{12}{\\sqrt{3}} \\end{pmatrix} = \\begin{pmatrix} 318 - 4\\sqrt{3} \\\\ 684 \\\\ 780 \\\\ 414 + 4\\sqrt{3} \\end{pmatrix} $$\nThis gives four linear equations:\n1. $2s_{1} + s_{2} = 318 - 4\\sqrt{3}$\n2. $s_{1} + 4s_{2} + s_{3} = 684$\n3. $s_{2} + 4s_{3} + s_{4} = 780$\n4. $s_{3} + 2s_{4} = 414 + 4\\sqrt{3}$\n\nFrom (1), $s_{1} = (318 - 4\\sqrt{3} - s_{2})/2$. From (4), $s_{4} = (414 + 4\\sqrt{3} - s_{3})/2$.\nSubstituting into (2) and (3) gives a $2 \\times 2$ system for $s_2$ and $s_3$:\n$ (318 - 4\\sqrt{3} - s_{2})/2 + 4s_{2} + s_{3} = 684 \\implies 7s_{2} + 2s_{3} = 1050 + 4\\sqrt{3} $\n$ s_{2} + 4s_{3} + (414 + 4\\sqrt{3} - s_{3})/2 = 780 \\implies 2s_{2} + 7s_{3} = 1146 - 4\\sqrt{3} $\nAdding these two equations gives $9s_2 + 9s_3 = 2196$, which simplifies to $s_2 + s_3 = 244$.\nSubstituting $s_3 = 244 - s_2$ into the first equation:\n$ 7s_2 + 2(244 - s_2) = 1050 + 4\\sqrt{3} \\implies 5s_2 + 488 = 1050 + 4\\sqrt{3} $\n$ 5s_2 = 562 + 4\\sqrt{3} \\implies s_2 = 112.4 + \\frac{4\\sqrt{3}}{5} $.\nThen $s_3 = 244 - s_2 = 244 - (112.4 + \\frac{4\\sqrt{3}}{5}) = 131.6 - \\frac{4\\sqrt{3}}{5}$.\n\nNow, we find $s_1$ and $s_4$:\n$ s_1 = \\frac{1}{2}(318 - 4\\sqrt{3} - s_2) = \\frac{1}{2}(318 - 4\\sqrt{3} - 112.4 - \\frac{4\\sqrt{3}}{5}) = \\frac{1}{2}(205.6 - \\frac{24\\sqrt{3}}{5}) = 102.8 - \\frac{12\\sqrt{3}}{5} $.\n$ s_4 = \\frac{1}{2}(414 + 4\\sqrt{3} - s_3) = \\frac{1}{2}(414 + 4\\sqrt{3} - 131.6 + \\frac{4\\sqrt{3}}{5}) = \\frac{1}{2}(282.4 + \\frac{24\\sqrt{3}}{5}) = 141.2 + \\frac{12\\sqrt{3}}{5} $.\n\n**Numerical Values:**\nUsing $\\sqrt{3} \\approx 1.73205$:\n$s_1 = 102.8 - \\frac{12 \\times 1.73205}{5} = 102.8 - 4.15692 = 98.64308$\n$s_2 = 112.4 + \\frac{4 \\times 1.73205}{5} = 112.4 + 1.38564 = 113.78564$\n$s_3 = 131.6 - \\frac{4 \\times 1.73205}{5} = 131.6 - 1.38564 = 130.21436$\n$s_4 = 141.2 + \\frac{12 \\times 1.73205}{5} = 141.2 + 4.15692 = 145.35692$\n\nRounding to four significant figures, the nodal stresses in MPa are:\n$s_1 = 98.64$\n$s_2 = 113.8$\n$s_3 = 130.2$\n$s_4 = 145.4$\nThese values represent the optimal continuous linear approximation of the given discontinuous stress field in the sense of the $L^2$-norm.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 98.64 & 113.8 & 130.2 & 145.4 \\end{pmatrix} } $$"
        },
        {
            "introduction": "While global projection is effective, a more common and computationally convenient approach in large-scale codes is to first extrapolate stresses from Gauss points to nodes on a local, element-by-element basis. This practice  delves into this fundamental procedure for the widely used four-node bilinear quadrilateral element. You will derive the explicit extrapolation matrix and then apply it to a known linear stress field, demonstrating a critical property of this technique: its ability to exactly reproduce linear stress variations, a feature that ensures patch test consistency.",
            "id": "3564946",
            "problem": "Consider a two-dimensional bilinear quadrilateral finite element with four nodes located at the physical coordinates $(x,y) \\in \\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$ so that, under the isoparametric mapping, $(x,y)=(\\xi,\\eta)$ where $(\\xi,\\eta)$ are the natural coordinates. Let the interpolation within the element be based on the standard bilinear shape functions $N_{1}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1-\\eta)$, $N_{2}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1-\\eta)$, $N_{3}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1+\\eta)$, and $N_{4}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1+\\eta)$. In the Finite Element Method (FEM), Gaussian Quadrature (GQ) with two points per direction is used, located at $(\\xi,\\eta)=\\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$.\n\nAssume the true stress field component is linear in the physical coordinates and is given by $\\sigma_{xx}(x,y)=\\alpha+\\beta x+\\gamma y$ with $\\alpha=150\\,\\text{MPa}$, $\\beta=30\\,\\text{MPa}\\cdot\\text{m}^{-1}$, and $\\gamma=-10\\,\\text{MPa}\\cdot\\text{m}^{-1}$. Under the mapping $(x,y)=(\\xi,\\eta)$, the stress values at the four Gauss points (ordered as $(\\xi,\\eta)=\\left(-\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$, $\\left(-\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$) are thus\n$$\n\\sigma^{(g)}=\\begin{pmatrix}\n150-20\\,\\frac{1}{\\sqrt{3}}\\\\\n150+40\\,\\frac{1}{\\sqrt{3}}\\\\\n150+20\\,\\frac{1}{\\sqrt{3}}\\\\\n150-40\\,\\frac{1}{\\sqrt{3}}\n\\end{pmatrix}\\,\\text{MPa}.\n$$\n\nStarting from the fundamental definitions of bilinear interpolation and the values of the bilinear basis $\\{1,\\xi,\\eta,\\xi\\eta\\}$ at the nodes and Gauss points, derive the $4\\times 4$ extrapolation matrix that maps the vector of Gauss-point stresses $\\sigma^{(g)}$ to the nodal stress vector $\\sigma^{(n)}$. Then, using this derived matrix, compute the extrapolated nodal stress vector and demonstrate that the procedure preserves the exact linear stress field at the nodes.\n\nExpress the final nodal stress vector components in $\\text{MPa}$ and round your answer to $4$ significant figures.",
            "solution": "The user wants me to solve a problem on stress extrapolation in Finite Element Method.\n\n### Step 1: Extract Givens\n-   **Element Type**: Two-dimensional bilinear quadrilateral finite element.\n-   **Nodal Coordinates**: The four nodes are at physical coordinates $(x,y) \\in \\{(-1,-1),(+1,-1),(+1,+1),(-1,+1)\\}$.\n-   **Isoparametric Mapping**: The physical coordinates are identical to the natural coordinates, $(x,y) = (\\xi,\\eta)$.\n-   **Shape Functions**:\n    $N_{1}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1-\\eta)$\n    $N_{2}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1-\\eta)$\n    $N_{3}(\\xi,\\eta)=\\frac{1}{4}(1+\\xi)(1+\\eta)$\n    $N_{4}(\\xi,\\eta)=\\frac{1}{4}(1-\\xi)(1+\\eta)$\n    The node numbering is implicit: Node $1$ at $(\\xi=-1,\\eta=-1)$, Node $2$ at $(\\xi=1,\\eta=-1)$, Node $3$ at $(\\xi=1,\\eta=1)$, Node $4$ at $(\\xi=-1,\\eta=1)$.\n-   **Gaussian Quadrature Points**: A $2 \\times 2$ scheme is used, with points at $(\\xi,\\eta)=\\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$.\n-   **True Stress Field**: $\\sigma_{xx}(x,y)=\\alpha+\\beta x+\\gamma y$ with $\\alpha=150\\,\\text{MPa}$, $\\beta=30\\,\\text{MPa}\\cdot\\text{m}^{-1}$, and $\\gamma=-10\\,\\text{MPa}\\cdot\\text{m}^{-1}$.\n-   **Gauss-Point Stresses**: The stress values at the four Gauss points, ordered as $(\\xi,\\eta)=\\left(-\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},-\\frac{1}{\\sqrt{3}}\\right)$, $\\left(+\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$, $\\left(-\\frac{1}{\\sqrt{3}},+\\frac{1}{\\sqrt{3}}\\right)$, are given by the vector $\\sigma^{(g)}$:\n$$\n\\sigma^{(g)}=\\begin{pmatrix}\n150-20\\,\\frac{1}{\\sqrt{3}}\\\\\n150+40\\,\\frac{1}{\\sqrt{3}}\\\\\n150+20\\,\\frac{1}{\\sqrt{3}}\\\\\n150-40\\,\\frac{1}{\\sqrt{3}}\n\\end{pmatrix}\\,\\text{MPa}.\n$$\n-   **Task**:\n    1.  Derive the $4\\times 4$ extrapolation matrix that maps Gauss-point stresses $\\sigma^{(g)}$ to nodal stresses $\\sigma^{(n)}$.\n    2.  Use this matrix to compute the extrapolated nodal stress vector $\\sigma^{(n)}$.\n    3.  Demonstrate that the process preserves the exact linear stress field at the nodes.\n    4.  Express the final answer in MPa, rounded to $4$ significant figures.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem describes a standard and fundamental post-processing technique in the Finite Element Method, specifically stress smoothing and extrapolation from Gauss points to nodes. The use of bilinear shape functions, Gaussian quadrature, and isoparametric mapping are all core concepts in computational mechanics. The problem is scientifically sound.\n-   **Well-Posed**: The problem is well-posed. All necessary information is provided: element geometry, shape functions, Gauss point locations, and stress values at these points. The objectives are clearly stated and lead to a unique solution.\n-   **Objective**: The problem is stated in precise mathematical language, free of ambiguity or subjective claims. The provided stress values at the Gauss points are consistent with the given linear stress field a fact that can be verified.\n-   **Consistency Check**: The problem states a coordinate-dependent stress field and also defines an element with specific dimensions. The mapping $(x,y)=(\\xi,\\eta)$ for nodes at $(\\pm 1, \\pm 1)$ creates a potential ambiguity in units. However, the interpretation that the physical element domain is $[-1,1] \\times [-1,1]$ (in units of meters) is consistent with the calculation of the Gauss point stresses from the function $\\sigma_{xx}(x,y)$. Under this interpretation, the setup is fully consistent. For example, at GP1 $(\\xi, \\eta) = (-1/\\sqrt{3}, -1/\\sqrt{3})$, the stress is $\\sigma_{xx} = 150 + 30(-1/\\sqrt{3}) - 10(-1/\\sqrt{3}) = 150 - 20/\\sqrt{3}$, which matches the provided $\\sigma_1^{(g)}$.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a standard exercise in computational mechanics that is self-contained, consistent, and well-posed. I will proceed with the solution.\n\nThe procedure to extrapolate stresses from Gauss points to nodes involves fitting a function to the Gauss point data and then evaluating this function at the nodal locations. For a bilinear element, we fit a bilinear function of the form $\\sigma^*(\\xi, \\eta) = c_0 + c_1\\xi + c_2\\eta + c_3\\xi\\eta$. This method is exact for any stress field that is itself bilinear in $\\xi$ and $\\eta$. Since the mapping is $(x,y)=(\\xi,\\eta)$, the given linear stress field $\\sigma_{xx}(x,y) = \\alpha+\\beta x+\\gamma y$ is also linear in $(\\xi,\\eta)$ and is a subset of the functions that can be represented exactly by the bilinear basis.\n\nLet $\\boldsymbol{\\sigma}^{(g)}$ be the vector of known stresses at the $4$ Gauss points and $\\boldsymbol{\\sigma}^{(n)}$ be the vector of unknown stresses at the $4$ nodes. We seek an extrapolation matrix $\\mathbf{E}$ such that $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{E}\\boldsymbol{\\sigma}^{(g)}$.\n\nThe relationship between the coefficients $\\mathbf{c} = (c_0, c_1, c_2, c_3)^T$ of the bilinear field and the values at the Gauss points is given by $\\boldsymbol{\\sigma}^{(g)} = \\mathbf{P}^{(g)}\\mathbf{c}$, where $\\mathbf{P}^{(g)}$ is the matrix of the basis functions $\\{1, \\xi, \\eta, \\xi\\eta\\}$ evaluated at the Gauss points.\nSimilarly, the values at the nodes are given by $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{P}^{(n)}\\mathbf{c}$, where $\\mathbf{P}^{(n)}$ is the matrix of basis functions evaluated at the nodal coordinates.\n\nFrom these relations, we have $\\mathbf{c} = (\\mathbf{P}^{(g)})^{-1}\\boldsymbol{\\sigma}^{(g)}$. Substituting this into the equation for nodal stresses gives:\n$\\boldsymbol{\\sigma}^{(n)} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}\\boldsymbol{\\sigma}^{(g)}$.\nThe extrapolation matrix is therefore $\\mathbf{E} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}$.\n\nThe nodes are at $(\\xi,\\eta) \\in \\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$. The basis is $\\{1, \\xi, \\eta, \\xi\\eta\\}$. The matrix $\\mathbf{P}^{(n)}$ is:\n$$ \\mathbf{P}^{(n)} = \\begin{pmatrix}\n1 & -1 & -1 & 1 \\\\\n1 & 1 & -1 & -1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & -1 & 1 & -1\n\\end{pmatrix} $$\nThe Gauss points are at $(\\xi,\\eta) \\in \\{(-a,-a),(a,-a),(a,a),(-a,a)\\}$, where $a = 1/\\sqrt{3}$. The matrix $\\mathbf{P}^{(g)}$ is:\n$$ \\mathbf{P}^{(g)} = \\begin{pmatrix}\n1 & -a & -a & a^2 \\\\\n1 & a & -a & -a^2 \\\\\n1 & a & a & a^2 \\\\\n1 & -a & a & -a^2\n\\end{pmatrix} $$\nTo find $(\\mathbf{P}^{(g)})^{-1}$, we can solve the system $\\mathbf{P}^{(g)}\\mathbf{c} = \\boldsymbol{\\sigma}^{(g)}$ for $\\mathbf{c}$:\n$\\sigma_{g1} = c_0 - a c_1 - a c_2 + a^2 c_3$\n$\\sigma_{g2} = c_0 + a c_1 - a c_2 - a^2 c_3$\n$\\sigma_{g3} = c_0 + a c_1 + a c_2 + a^2 c_3$\n$\\sigma_{g4} = c_0 - a c_1 + a c_2 - a^2 c_3$\nSolving this system yields:\n$c_0 = \\frac{1}{4}(\\sigma_{g1}+\\sigma_{g2}+\\sigma_{g3}+\\sigma_{g4})$\n$c_1 = \\frac{1}{4a}(-\\sigma_{g1}+\\sigma_{g2}+\\sigma_{g3}-\\sigma_{g4})$\n$c_2 = \\frac{1}{4a}(-\\sigma_{g1}-\\sigma_{g2}+\\sigma_{g3}+\\sigma_{g4})$\n$c_3 = \\frac{1}{4a^2}(\\sigma_{g1}-\\sigma_{g2}+\\sigma_{g3}-\\sigma_{g4})$\nThis gives the inverse matrix $(\\mathbf{P}^{(g)})^{-1}$:\n$$ (\\mathbf{P}^{(g)})^{-1} = \\frac{1}{4} \\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n-1/a & 1/a & 1/a & -1/a \\\\\n-1/a & -1/a & 1/a & 1/a \\\\\n1/a^2 & -1/a^2 & 1/a^2 & -1/a^2\n\\end{pmatrix} $$\nLet $b = 1/a = \\sqrt{3}$. Then $b^2 = 3$.\n$$ (\\mathbf{P}^{(g)})^{-1} = \\frac{1}{4} \\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n-b & b & b & -b \\\\\n-b & -b & b & b \\\\\nb^2 & -b^2 & b^2 & -b^2\n\\end{pmatrix} $$\nNow we compute the extrapolation matrix $\\mathbf{E} = \\mathbf{P}^{(n)}(\\mathbf{P}^{(g)})^{-1}$:\n$$ \\mathbf{E} = \\frac{1}{4} \\begin{pmatrix}\n1 & -1 & -1 & 1 \\\\\n1 & 1 & -1 & -1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & -1 & 1 & -1\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n-b & b & b & -b \\\\\n-b & -b & b & b \\\\\nb^2 & -b^2 & b^2 & -b^2\n\\end{pmatrix} $$\nThe first row of $\\mathbf{E}$ is computed as follows:\n$E_{11} = \\frac{1}{4}(1+b+b+b^2) = \\frac{1}{4}(1+2b+b^2) = \\frac{1}{4}(1+b)^2 = \\frac{1}{4}(1+\\sqrt{3})^2 = 1+\\frac{\\sqrt{3}}{2}$\n$E_{12} = \\frac{1}{4}(1-b+b-b^2) = \\frac{1}{4}(1-b^2) = \\frac{1}{4}(1-3) = -\\frac{1}{2}$\n$E_{13} = \\frac{1}{4}(1-b-b+b^2) = \\frac{1}{4}(1-2b+b^2) = \\frac{1}{4}(1-b)^2 = \\frac{1}{4}(1-\\sqrt{3})^2 = 1-\\frac{\\sqrt{3}}{2}$\n$E_{14} = \\frac{1}{4}(1+b-b-b^2) = \\frac{1}{4}(1-b^2) = -\\frac{1}{2}$\n\nDue to the symmetries of the matrices, we can construct the full matrix $\\mathbf{E}$:\n$$ \\mathbf{E} = \\begin{pmatrix}\n1+\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 1-\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} \\\\\n-\\frac{1}{2} & 1+\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 1-\\frac{\\sqrt{3}}{2} \\\\\n1-\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 1+\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} \\\\\n-\\frac{1}{2} & 1-\\frac{\\sqrt{3}}{2} & -\\frac{1}{2} & 1+\\frac{\\sqrt{3}}{2}\n\\end{pmatrix} $$\nNow, we compute the nodal stress vector $\\boldsymbol{\\sigma}^{(n)} = \\mathbf{E}\\boldsymbol{\\sigma}^{(g)}$.\n$$ \\boldsymbol{\\sigma}^{(g)} = \\begin{pmatrix}\n150-20/\\sqrt{3}\\\\\n150+40/\\sqrt{3}\\\\\n150+20/\\sqrt{3}\\\\\n150-40/\\sqrt{3}\n\\end{pmatrix} = 150\\begin{pmatrix}1\\\\1\\\\1\\\\1\\end{pmatrix} + \\frac{1}{\\sqrt{3}}\\begin{pmatrix}-20\\\\40\\\\20\\\\-40\\end{pmatrix} $$\nLet $\\mathbf{1}=(1,1,1,1)^T$ and $\\mathbf{v}=(-20,40,20,-40)^T$. The sum of each row in $\\mathbf{E}$ is $1$, so $\\mathbf{E}\\mathbf{1}=\\mathbf{1}$. Thus, the calculation simplifies to:\n$\\boldsymbol{\\sigma}^{(n)} = 150 \\cdot \\mathbf{1} + \\frac{1}{\\sqrt{3}}\\mathbf{E}\\mathbf{v}$.\n\nWe compute $\\mathbf{E}\\mathbf{v}$:\n- For Node 1:\n$(\\mathbf{E}\\mathbf{v})_1 = (1+\\frac{\\sqrt{3}}{2})(-20) - \\frac{1}{2}(40) + (1-\\frac{\\sqrt{3}}{2})(20) - \\frac{1}{2}(-40) = -20-10\\sqrt{3} - 20 + 20-10\\sqrt{3} + 20 = -20\\sqrt{3}$.\n$\\sigma_1^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(-20\\sqrt{3}) = 150 - 20 = 130$.\nVerification: Exact stress at Node 1 $(x=-1, y=-1)$ is $\\sigma_{xx}(-1,-1) = 150+30(-1)-10(-1) = 150-30+10 = 130$. This matches.\n\n- For Node 2:\n$(\\mathbf{E}\\mathbf{v})_2 = -\\frac{1}{2}(-20) + (1+\\frac{\\sqrt{3}}{2})(40) - \\frac{1}{2}(20) + (1-\\frac{\\sqrt{3}}{2})(-40) = 10 + 40+20\\sqrt{3} - 10 - 40+20\\sqrt{3} = 40\\sqrt{3}$.\n$\\sigma_2^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(40\\sqrt{3}) = 150 + 40 = 190$.\nVerification: Exact stress at Node 2 $(x=1, y=-1)$ is $\\sigma_{xx}(1,-1) = 150+30(1)-10(-1) = 150+30+10 = 190$. This matches.\n\n- For Node 3:\n$(\\mathbf{E}\\mathbf{v})_3 = (1-\\frac{\\sqrt{3}}{2})(-20) - \\frac{1}{2}(40) + (1+\\frac{\\sqrt{3}}{2})(20) - \\frac{1}{2}(-40) = -20+10\\sqrt{3} - 20 + 20+10\\sqrt{3} + 20 = 20\\sqrt{3}$.\n$\\sigma_3^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(20\\sqrt{3}) = 150 + 20 = 170$.\nVerification: Exact stress at Node 3 $(x=1, y=1)$ is $\\sigma_{xx}(1,1) = 150+30(1)-10(1) = 150+30-10 = 170$. This matches.\n\n- For Node 4:\n$(\\mathbf{E}\\mathbf{v})_4 = -\\frac{1}{2}(-20) + (1-\\frac{\\sqrt{3}}{2})(40) - \\frac{1}{2}(20) + (1+\\frac{\\sqrt{3}}{2})(-40) = 10 + 40-20\\sqrt{3} - 10 - 40-20\\sqrt{3} = -40\\sqrt{3}$.\n$\\sigma_4^{(n)} = 150 + \\frac{1}{\\sqrt{3}}(-40\\sqrt{3}) = 150 - 40 = 110$.\nVerification: Exact stress at Node 4 $(x=-1, y=1)$ is $\\sigma_{xx}(-1,1) = 150+30(-1)-10(1) = 150-30-10 = 110$. This matches.\n\nThe calculations demonstrate that the extrapolation procedure correctly recovers the exact nodal values for a linear stress field, as expected. The final nodal stress vector, with components ordered by node number, is $(130, 190, 170, 110)\\,\\text{MPa}$. Rounding to $4$ significant figures, we express these as $130.0$, $190.0$, $170.0$, and $110.0$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n130.0 & 190.0 & 170.0 & 110.0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building upon the concept of local extrapolation, this final practice  integrates stress smoothing into a more comprehensive computational workflow to assess the quality of a finite element solution. After obtaining an initial nodal stress field through extrapolation and averaging, you will apply a graph-Laplacian regularization to enforce inter-element smoothness, a more advanced smoothing technique. Subsequently, you will use this refined stress field to compute the discrete equilibrium residuals, directly connecting the post-processing of stresses to the fundamental physical principle of force balance and providing a tangible measure of the solution's accuracy.",
            "id": "3564967",
            "problem": "You are given a two-dimensional, bilinear quadrilateral mesh and raw Cauchy stress samples at the standard $2\\times2$ Gauss points inside each element. The goal is to construct a nodal stress field by extrapolating the Gauss-point stresses to the mesh nodes and then regularizing the nodal stresses using a graph-Laplacian penalty. After obtaining the regularized nodal stresses, evaluate the discrete equilibrium residual under gravity by assembling internal nodal forces from the stress field and body forces from gravity, using the Finite Element Method (FEM). The final program must compute, for a specified set of regularization parameters, the maximum nodal residual magnitude and report these values on a single line.\n\nFundamental base and physical setting:\n- Static equilibrium requires $\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$, where $\\boldsymbol{\\sigma}$ is the Cauchy stress tensor, $\\rho$ is the mass density, and $\\mathbf{g}$ is the gravitational acceleration vector.\n- In the FEM framework and for bilinear quadrilaterals, the internal nodal force vector $\\mathbf{f}_{\\text{int}}$ associated with a stress field is given by the element-wise assembly of $\\int_{\\Omega_e}\\mathbf{B}^\\top\\boldsymbol{\\sigma}\\,\\mathrm{d}\\Omega$, where $\\mathbf{B}$ is the standard strain-displacement matrix built from physical derivatives of shape functions. The body force vector $\\mathbf{f}_{\\text{body}}$ is the assembly of $\\int_{\\Omega_e}\\mathbf{N}^\\top\\rho\\mathbf{g}\\,\\mathrm{d}\\Omega$ with $\\mathbf{N}$ the matrix of shape functions.\n- The target nodal stress vector $\\boldsymbol{\\sigma}_n$ is obtained by minimizing the quadratic objective $\\|\\boldsymbol{\\sigma}_n-\\mathbf{E}\\boldsymbol{\\sigma}_g\\|^2+\\beta\\sum_{(i,j)\\in\\mathcal{E}}\\|\\boldsymbol{\\sigma}_i-\\boldsymbol{\\sigma}_j\\|^2$, where $\\boldsymbol{\\sigma}_g$ stacks the given Gauss-point stresses, $\\mathbf{E}$ is a global extrapolation operator mapping Gauss-point stresses to initial nodal estimates, $\\beta\\ge 0$ is a scalar regularization parameter, and $\\mathcal{E}$ is the set of undirected mesh edges that connect adjacent nodes. The graph-Laplacian matrix $\\mathbf{L}$ is defined by $\\mathbf{L}=\\mathbf{D}-\\mathbf{A}$, with $\\mathbf{A}$ the adjacency matrix ($\\mathbf{A}_{ij}=1$ if nodes $i$ and $j$ share an element edge and $0$ otherwise) and $\\mathbf{D}$ the diagonal degree matrix ($\\mathbf{D}_{ii}=\\sum_j\\mathbf{A}_{ij}$). The minimizer satisfies $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{E}\\boldsymbol{\\sigma}_g$ component-wise.\n\nMesh and data:\n- Rectangular domain with width $W=2\\,\\text{m}$ and height $H=2\\,\\text{m}$, with coordinates $(x,y)$ and the $y$-axis pointing downward (so gravity is in the positive $y$ direction). Plane strain is assumed with unit thickness $t=1\\,\\text{m}$.\n- Structured bilinear quadrilateral mesh with $3\\times3$ nodes: coordinates $(x,y)\\in\\{0,1,2\\}\\times\\{0,1,2\\}$ in meters. Four elements: bottom-left element connects nodes $\\{(0,0),(1,0),(1,1),(0,1)\\}$, bottom-right connects $\\{(1,0),(2,0),(2,1),(1,1)\\}$, top-left connects $\\{(0,1),(1,1),(1,2),(0,2)\\}$, top-right connects $\\{(1,1),(2,1),(2,2),(1,2)\\}$; the node ordering within each element is $\\{(x_1,y_1),(x_2,y_2),(x_3,y_3),(x_4,y_4)\\}=\\{\\text{bottom-left},\\text{bottom-right},\\text{top-right},\\text{top-left}\\}$.\n- Mass density $\\rho=2000\\,\\text{kg/m}^3$ and gravitational acceleration vector $\\mathbf{g}=[0,9.81]\\,\\text{m/s}^2$.\n- Raw Gauss-point stresses are defined by the gravity-equilibrium field\n$$\n\\sigma_{xx}=0,\\quad \\sigma_{yy}=-\\rho\\,g_y\\,y,\\quad \\sigma_{xy}=0,\n$$\nevaluated at the physical coordinates of the standard bilinear quadrilateral $2\\times2$ Gauss points, i.e., natural coordinates $(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\}\\times\\{\\pm 1/\\sqrt{3}\\}$, mapped to $(x,y)$ through bilinear shape functions.\n- Extrapolation $\\mathbf{E}$ is defined element-wise by fitting a bilinear polynomial $s(\\xi,\\eta)=a_0+a_1\\xi+a_2\\eta+a_3\\xi\\eta$ to the four Gauss-point stress samples per component and evaluating $s$ at the four element corner nodes $(\\xi,\\eta)\\in\\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$. The global initial nodal stress $\\mathbf{s}_0=\\mathbf{E}\\boldsymbol{\\sigma}_g$ is the average of all element-wise nodal extrapolations that share the same global node.\n- Graph-Laplacian regularization uses unit edge weights along element edges. Solve $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{s}_0$ independently for each stress component $s\\in\\{\\sigma_{xx},\\sigma_{yy},\\sigma_{xy}\\}$.\n\nDiscrete equilibrium residual:\n- Using the regularized nodal stress field, interpolate the stress to Gauss points with bilinear shape functions and evaluate the internal nodal force vectors $\\mathbf{f}_{\\text{int}}$ by $2\\times2$ Gauss quadrature with weight $1$ per point:\n$$\n\\mathbf{f}_{\\text{int},e}=\\sum_{k=1}^{4}\\mathbf{B}(\\xi_k,\\eta_k)^\\top\\,\\boldsymbol{\\sigma}(\\xi_k,\\eta_k)\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t,\n$$\nand sum over elements. Here $\\mathbf{B}$ is the standard $3\\times 8$ strain-displacement matrix computed via physical derivatives of shape functions, and $\\mathbf{J}$ is the Jacobian of the isoparametric mapping.\n- The body force vector is\n$$\n\\mathbf{f}_{\\text{body},e}=\\sum_{k=1}^{4}\\mathbf{N}(\\xi_k,\\eta_k)^\\top\\,\\rho\\mathbf{g}\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t,\n$$\nand sum over elements. The global residual is $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$.\n- Compute the nodal residual magnitudes $\\|\\mathbf{r}_i\\|_2=\\sqrt{r_{ix}^2+r_{iy}^2}$ and report the maximum over all nodes.\n\nUnits and output:\n- All forces must be in Newtons ($\\text{N}$). The program must compute the maximum nodal residual magnitude in $\\text{N}$ for each test case in the test suite and output a single line with a comma-separated list enclosed in square brackets.\n- Test suite (regularization parameters): $\\beta\\in\\{0.0,0.1,10.0\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., `[result1,result2,result3]`).",
            "solution": "The user wants to solve a computational geomechanics problem involving stress analysis in a two-dimensional quadrilateral mesh using the Finite Element Method (FEM).\n\n### Step 1: Extract Givens\n- **Problem Type**: 2D plane strain static equilibrium analysis.\n- **Governing Equation**: $\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$.\n- **Geometry**: Rectangular domain of size $W=2\\,\\text{m} \\times H=2\\,\\text{m}$.\n- **Mesh**: Structured $3 \\times 3$ grid of nodes, resulting in 4 bilinear quadrilateral elements.\n  - Node coordinates: $(x,y) \\in \\{0,1,2\\} \\times \\{0,1,2\\}$ meters.\n  - Element 1 (bottom-left): nodes at $\\{(0,0),(1,0),(1,1),(0,1)\\}$.\n  - Element 2 (bottom-right): nodes at $\\{(1,0),(2,0),(2,1),(1,1)\\}$.\n  - Element 3 (top-left): nodes at $\\{(0,1),(1,1),(1,2),(0,2)\\}$.\n  - Element 4 (top-right): nodes at $\\{(1,1),(2,1),(2,2),(1,2)\\}$.\n- **Material & Loading**:\n  - Mass density: $\\rho=2000\\,\\text{kg/m}^3$.\n  - Gravitational acceleration: $\\mathbf{g}=[0, 9.81]\\,\\text{m/s}^2$ (y-axis points downward).\n- **Stress Field**:\n  - Raw stresses at Gauss points are sampled from the analytical field: $\\sigma_{xx}=0$, $\\sigma_{yy}=-\\rho\\,g_y\\,y$, $\\sigma_{xy}=0$.\n  - Gauss points are the standard $2 \\times 2$ set with natural coordinates $(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\} \\times \\{\\pm 1/\\sqrt{3}\\}$.\n- **Numerical Method**:\n  1.  **Stress Extrapolation**: Gauss-point stresses are extrapolated to element nodes by fitting a bilinear polynomial $s(\\xi,\\eta)=a_0+a_1\\xi+a_2\\eta+a_3\\xi\\eta$ within each element.\n  2.  **Nodal Averaging**: An initial global nodal stress field $\\mathbf{s}_0$ is obtained by averaging the extrapolated values from all elements sharing a node.\n  3.  **Regularization**: The final nodal stresses $\\boldsymbol{\\sigma}_n$ are found by solving $(\\mathbf{I}+\\beta\\mathbf{L})\\boldsymbol{\\sigma}_n=\\mathbf{s}_0$ for each stress component, where $\\mathbf{L}$ is the graph-Laplacian of the mesh and $\\beta$ is a regularization parameter.\n  4.  **Force Calculation**: Internal forces $\\mathbf{f}_{\\text{int}}$ and body forces $\\mathbf{f}_{\\text{body}}$ are computed using $2 \\times 2$ Gauss quadrature.\n      - $\\mathbf{f}_{\\text{int}} = \\text{assemble} \\left( \\sum_{k=1}^{4}\\mathbf{B}(\\xi_k,\\eta_k)^\\top\\,\\boldsymbol{\\sigma}(\\xi_k,\\eta_k)\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t \\right)$\n      - $\\mathbf{f}_{\\text{body}} = \\text{assemble} \\left( \\sum_{k=1}^{4}\\mathbf{N}(\\xi_k,\\eta_k)^\\top\\,\\rho\\mathbf{g}\\,\\det\\mathbf{J}(\\xi_k,\\eta_k)\\,t \\right)$\n      - Note: Gauss quadrature weights are all $1$.\n- **Task**:\n  - Compute the global equilibrium residual $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$.\n  - Calculate the L2-norm of the residual vector for each node: $\\|\\mathbf{r}_i\\|_2=\\sqrt{r_{ix}^2+r_{iy}^2}$.\n  - Find the maximum nodal residual magnitude over all nodes.\n- **Test Cases**: The calculation must be performed for regularization parameters $\\beta \\in \\{0.0, 0.1, 10.0\\}$.\n- **Output**: A single line containing a comma-separated list of the maximum nodal residual magnitudes (in Newtons) for the test cases, enclosed in square brackets.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-posed and scientifically grounded.\n- **Scientifically Grounded**: The problem is based on fundamental principles of continuum mechanics (static equilibrium) and the Finite Element Method, a standard and well-established numerical technique in engineering and physics. The provided stress field $\\sigma_{yy} = -\\rho g_y y$ correctly satisfies the equilibrium equation $\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\mathbf{g}=\\mathbf{0}$ when $\\mathbf{g}=[0, g_y]$ and other stress components are zero.\n- **Well-Posed**: The problem is fully specified. The mesh, material properties, boundary conditions (implicitly through the stress field), and numerical procedures are all defined unambiguously. The task is to compute a specific quantity (maximum nodal residual) for a given set of parameters. The use of a positive semi-definite graph Laplacian with a positive identity matrix added ensures that the linear system for regularization is invertible and yields a unique solution for $\\boldsymbol{\\sigma}_n$.\n- **Objective**: The problem is stated in precise mathematical and engineering terms, free of subjective or ambiguous language. All quantities are defined, and the procedure is algorithmic.\n- **Completeness**: All necessary data ($\\rho$, $\\mathbf{g}$, mesh geometry, FEM formulations) are provided. No information is missing.\n- **Consistency**: The dimensions and units are consistent. The physical laws and numerical formulations are internally consistent. For example, the definition of the residual $\\mathbf{r}=\\mathbf{f}_{\\text{int}}+\\mathbf{f}_{\\text{body}}$ is consistent with an equilibrium statement of the form $\\int \\mathbf{B}^T \\boldsymbol{\\sigma} d\\Omega + \\int \\mathbf{N}^T \\rho\\mathbf{g} d\\Omega = \\mathbf{0}$, which is a valid weak form of the governing PDE.\n\nThe problem does not exhibit any of the invalidity flaws. It is a standard, albeit complex, computational exercise.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A step-by-step solution will be developed and implemented.\n\n### Principle-Based Design\nThe solution follows a structured, multi-step approach derived from the Finite Element Method.\n\n1.  **Mesh and Quadrature Setup**: We begin by defining the mesh topology (nodal coordinates and element connectivity) and the parameters for numerical integration (Gauss points and weights). These form the discrete domain for our analysis.\n\n2.  **Initial Stress Field Calculation**: The process starts with the analytical stress field.\n    - For each of the four elements, we iterate through the four $2 \\times 2$ Gauss points.\n    - The natural coordinates $(\\xi_k, \\eta_k)$ of each Gauss point are mapped to physical coordinates $(x_k, y_k)$ using the isoparametric mapping: $\\mathbf{x}(\\xi, \\eta) = \\sum_i N_i(\\xi, \\eta) \\mathbf{x}_i$, where $N_i$ are the bilinear shape functions and $\\mathbf{x}_i$ are the element's nodal coordinates.\n    - At each physical point $(x_k, y_k)$, we evaluate the \"ground truth\" stress components: $\\sigma_{xx,k}=0$, $\\sigma_{yy,k}=-\\rho g_y y_k$, $\\sigma_{xy,k}=0$. This gives us the set of all Gauss-point stresses, $\\boldsymbol{\\sigma}_g$.\n\n3.  **Extrapolation and Averaging**: The discrete Gauss-point stresses are used to construct an initial continuous field defined at the nodes.\n    - Within each element, the four stress values for each component are used to fit a bilinear field $s(\\xi, \\eta)$. This is equivalent to applying a pre-computed $4 \\times 4$ extrapolation matrix, $\\mathbf{E}_{\\text{elem}}$, which maps the four Gauss-point values to four values at the element's local corner nodes $(\\pm 1, \\pm 1)$.\n    - Since interior nodes are shared by multiple elements, they receive multiple, generally different, stress predictions. The problem specifies an averaging scheme: the initial nodal stress for a global node, $\\mathbf{s}_0$, is the arithmetic mean of all contributions from the elements connected to it.\n\n4.  **Graph-Laplacian Regularization**: The initial nodal stress field $\\mathbf{s}_0$ is often noisy or non-smooth. A regularization step is applied to enforce spatial smoothness.\n    - We construct the graph-Laplacian matrix $\\mathbf{L} = \\mathbf{D} - \\mathbf{A}$ for the mesh, where $\\mathbf{A}$ is the adjacency matrix (connecting nodes that share an edge) and $\\mathbf{D}$ is the diagonal degree matrix.\n    - For each given regularization parameter $\\beta$, we solve the linear system $(\\mathbf{I} + \\beta \\mathbf{L})\\boldsymbol{\\sigma}_n = \\mathbf{s}_0$ for the smoothed nodal stresses $\\boldsymbol{\\sigma}_n$. This is done independently for each of the three stress components ($\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}$). This operation acts as a low-pass filter, where $\\beta$ controls the degree of smoothing. For $\\beta=0$, $\\boldsymbol{\\sigma}_n = \\mathbf{s}_0$.\n\n5.  **Equilibrium Residual Calculation**: We assess how well the regularized stress field $\\boldsymbol{\\sigma}_n$ satisfies discrete equilibrium.\n    - **Body Forces**: We first compute the global body force vector, $\\mathbf{f}_{\\text{body}}$. This is done by assembling element-wise contributions. For each element, we integrate $\\mathbf{N}^\\top \\rho \\mathbf{g}$ over the element volume using $2 \\times 2$ Gauss quadrature. Since the geometry and loading are fixed, this vector is constant for all test cases.\n    - **Internal Forces**: We then compute the global internal force vector, $\\mathbf{f}_{\\text{int}}$, which depends on the stress field. For each $\\beta$, we use the corresponding $\\boldsymbol{\\sigma}_n$.\n        - Within each element, we loop through the Gauss points. At each point, we interpolate the stress from the regularized nodal values: $\\boldsymbol{\\sigma}(\\xi_k, \\eta_k) = \\sum_i N_i(\\xi_k, \\eta_k) \\boldsymbol{\\sigma}_{n,i}$.\n        - We then evaluate the integral $\\int \\mathbf{B}^\\top \\boldsymbol{\\sigma} \\, d\\Omega$ using Gauss quadrature, where $\\mathbf{B}$ is the strain-displacement matrix relating nodal displacements to strains.\n        - The resulting element force vectors are assembled into the global vector $\\mathbf{f}_{\\text{int}}$.\n    - **Residual**: The global residual is then $\\mathbf{r} = \\mathbf{f}_{\\text{int}} + \\mathbf{f}_{\\text{body}}$. If equilibrium were perfectly satisfied, $\\mathbf{r}$ would be zero. Extrapolation, averaging, and regularization introduce errors, resulting in a non-zero residual.\n\n6.  **Result Evaluation**: Finally, we quantify the magnitude of the equilibrium error.\n    - The $18 \\times 1$ global residual vector $\\mathbf{r}$ is re-interpreted as a set of nine $2 \\times 1$ vectors, one for each node.\n    - We compute the Euclidean norm of the residual at each node, $\\|\\mathbf{r}_i\\|_2$.\n    - The maximum of these nodal norms is the final result for a given $\\beta$. This process is repeated for all specified values of $\\beta$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum nodal equilibrium residual for a regularized stress field\n    in a 2D quadrilateral mesh under gravity.\n    \"\"\"\n    # --------------------------------------------------------------------------\n    # 1. GIVENS AND MESH DEFINITION\n    # --------------------------------------------------------------------------\n    RHO = 2000.0  # kg/m^3\n    G_VEC = np.array([0.0, 9.81])  # m/s^2\n    THICKNESS = 1.0  # m\n    TEST_CASES = [0.0, 0.1, 10.0]  # Regularization parameters (beta)\n\n    NODAL_COORDS = np.array([\n        [0.0, 0.0], [1.0, 0.0], [2.0, 0.0],\n        [0.0, 1.0], [1.0, 1.0], [2.0, 1.0],\n        [0.0, 2.0], [1.0, 2.0], [2.0, 2.0]\n    ], dtype=np.float64)\n    NUM_NODES = NODAL_COORDS.shape[0]\n\n    ELEM_NODE_INDICES = np.array([\n        [0, 1, 4, 3],  # Element 0 (BL)\n        [1, 2, 5, 4],  # Element 1 (BR)\n        [3, 4, 7, 6],  # Element 2 (TL)\n        [4, 5, 8, 7]   # Element 3 (TR)\n    ])\n    NUM_ELEMS = ELEM_NODE_INDICES.shape[0]\n\n    # Standard 2x2 Gauss quadrature points and weights\n    p = 1.0 / np.sqrt(3.0)\n    GAUSS_POINTS = np.array([[-p, -p], [p, -p], [p, p], [-p, p]])\n    GAUSS_WEIGHTS = np.array([1.0, 1.0, 1.0, 1.0])\n\n    # --------------------------------------------------------------------------\n    # 2. FEM HELPER FUNCTIONS AND PRE-COMPUTATIONS\n    # --------------------------------------------------------------------------\n    def get_shape_functions(xi, eta):\n        N = 0.25 * np.array([\n            (1.0 - xi) * (1.0 - eta), (1.0 + xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 + eta), (1.0 - xi) * (1.0 + eta)\n        ])\n        dNdxi = 0.25 * np.array([-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)])\n        dNdeta = 0.25 * np.array([-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)])\n        return N, dNdxi, dNdeta\n\n    def get_B_matrix(dNdxi, dNdeta, elem_coords):\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dNdxi, elem_coords[:, 0])\n        J[0, 1] = np.dot(dNdeta, elem_coords[:, 0])\n        J[1, 0] = np.dot(dNdxi, elem_coords[:, 1])\n        J[1, 1] = np.dot(dNdeta, elem_coords[:, 1])\n        detJ = np.linalg.det(J)\n        \n        # Derivatives w.r.t physical coordinates\n        invJ = np.linalg.inv(J)\n        dN_phys = invJ @ np.vstack((dNdxi, dNdeta))\n        \n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2 * i] = dN_phys[0, i]\n            B[1, 2 * i + 1] = dN_phys[1, i]\n            B[2, 2 * i] = dN_phys[1, i]\n            B[2, 2 * i + 1] = dN_phys[0, i]\n        return B, detJ\n\n    # Extrapolation matrix (Gauss points to element corner nodes)\n    M_inv = np.array([\n        [0.25, 0.25, 0.25, 0.25],\n        [-np.sqrt(3)/4, np.sqrt(3)/4, np.sqrt(3)/4, -np.sqrt(3)/4],\n        [-np.sqrt(3)/4, -np.sqrt(3)/4, np.sqrt(3)/4, np.sqrt(3)/4],\n        [0.75, -0.75, 0.75, -0.75]\n    ])\n    C_eval = np.array([[1,-1,-1,1], [1,1,-1,-1], [1,1,1,1], [1,-1,1,-1]])\n    E_ELEM = C_eval @ M_inv\n\n    # --------------------------------------------------------------------------\n    # 3. COMPUTE INITIAL NODAL STRESSES (s0)\n    # --------------------------------------------------------------------------\n    initial_nodal_stresses_sum = np.zeros((NUM_NODES, 3))\n    nodal_counts = np.zeros(NUM_NODES)\n    \n    for i in range(NUM_ELEMS):\n        elem_nodes = ELEM_NODE_INDICES[i]\n        elem_coords = NODAL_COORDS[elem_nodes]\n        gauss_stresses = np.zeros((4, 3))\n\n        for k in range(4):\n            xi, eta = GAUSS_POINTS[k]\n            N, _, _ = get_shape_functions(xi, eta)\n            phys_coords = N @ elem_coords\n            y_coord = phys_coords[1]\n            \n            # Analytical stress field\n            gauss_stresses[k, 0] = 0.0  # sigma_xx\n            gauss_stresses[k, 1] = -RHO * G_VEC[1] * y_coord  # sigma_yy\n            gauss_stresses[k, 2] = 0.0  # sigma_xy\n\n        # Extrapolate Gauss stresses to element nodes for each component\n        elem_nodal_stresses = np.zeros((4, 3))\n        for comp in range(3):\n            elem_nodal_stresses[:, comp] = E_ELEM @ gauss_stresses[:, comp]\n\n        # Accumulate for averaging\n        initial_nodal_stresses_sum[elem_nodes] += elem_nodal_stresses\n        nodal_counts[elem_nodes] += 1\n\n    s0 = initial_nodal_stresses_sum / nodal_counts[:, np.newaxis]\n\n    # --------------------------------------------------------------------------\n    # 4. COMPUTE GRAPH LAPLACIAN (L)\n    # --------------------------------------------------------------------------\n    adj_matrix = np.zeros((NUM_NODES, NUM_NODES))\n    for elem_nodes in ELEM_NODE_INDICES:\n        for i in range(4):\n            n1 = elem_nodes[i]\n            n2 = elem_nodes[(i + 1) % 4]\n            adj_matrix[n1, n2] = 1\n            adj_matrix[n2, n1] = 1\n    \n    degree_matrix = np.diag(adj_matrix.sum(axis=1))\n    L = degree_matrix - adj_matrix\n\n    # --------------------------------------------------------------------------\n    # 5. COMPUTE BODY FORCES (f_body)\n    # --------------------------------------------------------------------------\n    f_body = np.zeros(NUM_NODES * 2)\n    body_force_density = RHO * G_VEC\n\n    for i in range(NUM_ELEMS):\n        elem_nodes = ELEM_NODE_INDICES[i]\n        elem_coords = NODAL_COORDS[elem_nodes]\n        f_body_e = np.zeros(8)\n        \n        for k in range(4):\n            xi, eta = GAUSS_POINTS[k]\n            w = GAUSS_WEIGHTS[k]\n            N, dNdxi, dNdeta = get_shape_functions(xi, eta)\n            \n            _ , detJ = get_B_matrix(dNdxi, dNdeta, elem_coords)\n            \n            N_mat = np.zeros((2, 8))\n            for j in range(4):\n                N_mat[0, 2*j] = N[j]\n                N_mat[1, 2*j+1] = N[j]\n            \n            f_body_e += N_mat.T @ body_force_density * detJ * w * THICKNESS\n        \n        # Assembly\n        for j in range(4):\n            node_g_idx = elem_nodes[j]\n            f_body[2*node_g_idx : 2*node_g_idx+2] += f_body_e[2*j : 2*j+2]\n\n    # --------------------------------------------------------------------------\n    # 6. MAIN LOOP: REGULARIZE, COMPUTE RESIDUAL, AND FIND MAX NORM\n    # --------------------------------------------------------------------------\n    results = []\n    for beta in TEST_CASES:\n        # Solve for regularized nodal stresses\n        M_reg = np.identity(NUM_NODES) + beta * L\n        sigma_n = np.zeros((NUM_NODES, 3))\n        for comp in range(3):\n            sigma_n[:, comp] = np.linalg.solve(M_reg, s0[:, comp])\n            \n        # Compute internal forces from regularized stresses\n        f_int = np.zeros(NUM_NODES * 2)\n        for i in range(NUM_ELEMS):\n            elem_nodes = ELEM_NODE_INDICES[i]\n            elem_coords = NODAL_COORDS[elem_nodes]\n            elem_sigma_n = sigma_n[elem_nodes]\n            f_int_e = np.zeros(8)\n            \n            for k in range(4):\n                xi, eta = GAUSS_POINTS[k]\n                w = GAUSS_WEIGHTS[k]\n                N, dNdxi, dNdeta = get_shape_functions(xi, eta)\n                \n                B, detJ = get_B_matrix(dNdxi, dNdeta, elem_coords)\n                \n                # Interpolate stress to Gauss point\n                sigma_gp = N @ elem_sigma_n\n\n                f_int_e += B.T @ sigma_gp * detJ * w * THICKNESS\n            \n            # Assembly\n            for j in range(4):\n                node_g_idx = elem_nodes[j]\n                f_int[2*node_g_idx : 2*node_g_idx+2] += f_int_e[2*j : 2*j+2]\n        \n        # Final residual calculation\n        residual = f_int + f_body\n        residual_reshaped = residual.reshape((NUM_NODES, 2))\n        nodal_residual_norms = np.linalg.norm(residual_reshaped, axis=1)\n        max_residual_norm = np.max(nodal_residual_norms)\n        results.append(max_residual_norm)\n\n    # --------------------------------------------------------------------------\n    # 7. FINAL OUTPUT\n    # --------------------------------------------------------------------------\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}