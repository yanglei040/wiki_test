{
    "hands_on_practices": [
        {
            "introduction": "高斯求积因其卓越的效率和精度，成为有限元方法 (FEM) 中数值积分的基石。然而，它的积分点和权重通常以表格形式给出，其来源可能显得神秘。本练习旨在揭开这一神秘面纱，指导您从第一性原理出发，仅通过矩匹配和对称性来推导一个简单但功能强大的 $n=3$ 高斯-勒让德法则 ()。通过亲手构建这些积分点和权重，您将对高斯求积为何能以极少的计算成本达到高精度有一个深刻的根本性理解。",
            "id": "3546652",
            "problem": "在计算岩土力学中，为了在有限元法 (FEM) 中组装单元矩阵，通常需要计算母（或自然）坐标域上的积分。考虑在标准母区间 $[-1,1]$ 上、权函数为 $w(\\xi)=1$ 的情况下计算积分的任务，例如在一维单元的等参映射中出现的积分。一个基本方法是高斯求积，该方法旨在寻找节点 $\\{\\xi_{i}\\}$ 和正权重 $\\{W_{i}\\}$，使得求积公式 $\\sum_{i=1}^{n} W_{i} f(\\xi_{i})$ 对最高为目标次数的多项式是精确的。\n\n从区间 $[-1,1]$ 上单位权函数的高斯求积的定义出发，并根据 $n$ 点法则对所有次数最高为 $2n-1$ 的多项式都精确的要求，通过对一组适当的偶次幂多项式基底强制精确性，显式地构造 $n=3$ 的高斯-勒让德节点和权重。你不能使用任何列表公式；必须直接通过对称性和矩匹配推导节点和权重。\n\n然后，使用你构造的节点和权重，通过直接代入验证所得到的求积公式能够精确积分 $[-1,1]$ 上的 $p(\\xi)=\\xi^{5}$。\n\n将应用你的 $n=3$ 高斯-勒让德求积法则于 $\\int_{-1}^{1} \\xi^{5} \\, d\\xi$ 所得到的单个实数作为你的最终答案。不需要四舍五入。不需要单位。",
            "solution": "在 $[-1,1]$ 上单位权函数的高斯求积的基本原理如下：一个 $n$ 点法则旨在寻找节点 $\\{\\xi_{i}\\}_{i=1}^{n}$ 和权重 $\\{W_{i}\\}_{i=1}^{n}$，使得\n$$\n\\int_{-1}^{1} f(\\xi)\\, d\\xi \\approx \\sum_{i=1}^{n} W_{i} f(\\xi_{i}),\n$$\n并且该法则对所有 $\\deg(f) \\leq 2n-1$ 的多项式 $f$ 都是精确的。对于 $n=3$，要求精确度达到 5 次。\n\n因为权函数是对称的，且积分区间也是对称的，所以最优的节点和权重也是对称的。因此我们假设其结构为\n$$\n\\xi_{1}=-a,\\quad \\xi_{2}=0,\\quad \\xi_{3}=a,\\qquad W_{1}=W_{3}=w,\\quad W_{2}=w_{0},\n$$\n其中 $a>0$, $w>0$, 且 $w_{0}>0$。通过对偶次幂 $\\xi^{0}$、$\\xi^{2}$ 和 $\\xi^{4}$ 进行矩匹配，可以强制实现对所有最高 5 次多项式的精确性，因为在 $[-1,1]$ 上的奇次幂矩为零，不提供额外信息。\n\n在 $[-1,1]$ 上的精确偶次矩为\n$$\n\\int_{-1}^{1} \\xi^{0} \\, d\\xi = 2,\\qquad \\int_{-1}^{1} \\xi^{2} \\, d\\xi = \\frac{2}{3},\\qquad \\int_{-1}^{1} \\xi^{4} \\, d\\xi = \\frac{2}{5}.\n$$\n对 $\\xi^{0}$、$\\xi^{2}$ 和 $\\xi^{4}$ 强加求积精确性，得到方程组\n$$\n\\text{(i)}\\quad w_{0}+2w=2,\n$$\n$$\n\\text{(ii)}\\quad w_{0}\\cdot 0^{2}+w\\cdot (-a)^{2}+w\\cdot a^{2}=\\frac{2}{3}\\;\\;\\Longrightarrow\\;\\;2wa^{2}=\\frac{2}{3},\n$$\n$$\n\\text{(iii)}\\quad w_{0}\\cdot 0^{4}+w\\cdot (-a)^{4}+w\\cdot a^{4}=\\frac{2}{5}\\;\\;\\Longrightarrow\\;\\;2wa^{4}=\\frac{2}{5}.\n$$\n从方程 (ii) 我们得到\n$$\nw=\\frac{1}{3a^{2}}.\n$$\n将此代入方程 (iii)：\n$$\n2\\left(\\frac{1}{3a^{2}}\\right)a^{4}=\\frac{2}{5}\\;\\;\\Longrightarrow\\;\\;\\frac{2}{3}a^{2}=\\frac{2}{5}\\;\\;\\Longrightarrow\\;\\;a^{2}=\\frac{3}{5}.\n$$\n因此 $a=\\sqrt{\\frac{3}{5}}$。然后\n$$\nw=\\frac{1}{3a^{2}}=\\frac{1}{3\\cdot \\frac{3}{5}}=\\frac{5}{9}.\n$$\n最后，使用方程 (i) 来求得 $w_{0}$：\n$$\nw_{0}=2-2w=2-\\frac{10}{9}=\\frac{8}{9}.\n$$\n因此，$n=3$ 的高斯-勒让德节点和权重在 $[-1,1]$ 上是\n$$\n\\xi_{1}=-\\sqrt{\\frac{3}{5}},\\quad \\xi_{2}=0,\\quad \\xi_{3}=\\sqrt{\\frac{3}{5}},\\qquad W_{1}=W_{3}=\\frac{5}{9},\\quad W_{2}=\\frac{8}{9}.\n$$\n\n我们现在验证对于 $p(\\xi)=\\xi^{5}$ 的积分是精确的。其精确积分为\n$$\n\\int_{-1}^{1} \\xi^{5} \\, d\\xi=0,\n$$\n因为 $\\xi^{5}$ 是对称区间 $[-1,1]$ 上的奇函数。使用推导出的节点和权重进行求积计算为\n$$\n\\sum_{i=1}^{3} W_{i} p(\\xi_{i})=w\\left[(-a)^{5}+a^{5}\\right]+w_{0}\\cdot 0^{5}=w\\left[-a^{5}+a^{5}\\right]+0=0,\n$$\n这与精确积分值一致。因此，$n=3$ 的高斯-勒让德法则能够精确地积分 $p(\\xi)=\\xi^{5}$，这与 $2n-1=5$ 的精确度一致。\n\n最终要求的量是，将构造的 $n=3$ 高斯-勒让德法则应用于 $\\int_{-1}^{1} \\xi^{5}\\, d\\xi$ 所得到的单个实数，即 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在掌握了高斯求积的构建方法后，我们将注意力转向数值积分在实际工程问题中的应用及其固有的误差。本练习采用一个简单的牛顿-科茨法则（梯形法则）来计算岩土力学中的一个关键物理量——塑性功 ()。此实践的核心不仅在于得到一个数值结果，更在于培养从基本插值理论出发推导并量化计算误差的能力。对于任何计算工程师而言，理解和控制误差是与获得近似解本身同等重要的核心技能。",
            "id": "3546656",
            "problem": "对一种岩土材料进行单轴单调塑性加载试验，在应变区间 $\\left[\\epsilon_{a},\\epsilon_{b}\\right]$ 上测得一条塑性柯西应力-塑性应变曲线 $f(\\epsilon)$。在此区间上累积的单位体积塑性功定义为应力对塑性应变的积分，\n$$\nW_{p} \\;=\\; \\int_{\\epsilon_{a}}^{\\epsilon_{b}} f(\\epsilon)\\,d\\epsilon.\n$$\n给定两个端点处的塑性应力测量值：\n$$\n\\epsilon_{a} \\;=\\; 0.012,\\qquad f(\\epsilon_{a}) \\;=\\; 210\\ \\text{MPa},\\qquad \\epsilon_{b} \\;=\\; 0.028,\\qquad f(\\epsilon_{b}) \\;=\\; 365\\ \\text{MPa}.\n$$\n假设 $f$ 在 $\\left[\\epsilon_{a},\\epsilon_{b}\\right]$ 上是二阶连续可微的，并且从一个已校准的本构模型中可以得到曲率的先验界，\n$$\n\\max_{\\epsilon\\in[\\epsilon_{a},\\epsilon_{b}]} \\left| f''(\\epsilon) \\right| \\;\\le\\; M,\\qquad M \\;=\\; 6.00\\times 10^{4}\\ \\text{MPa}.\n$$\n请仅使用塑性功的定义和多项式插值及其余项的概念（不要引用任何现成的求积公式），按以下步骤进行：\n- 通过对穿过点 $\\left(\\epsilon_{a},f(\\epsilon_{a})\\right)$ 和 $\\left(\\epsilon_{b},f(\\epsilon_{b})\\right)$ 的 $f$ 的唯一线性插值函数进行积分，构建一个单区间 Newton–Cotes 法则，以获得 $W_{p}$ 的近似值。\n- 从线性插值的二阶导数余项和适当的积分中值定理出发，推导包含 $f''(\\xi)$（对于某个 $\\xi\\in(\\epsilon_{a},\\epsilon_{b})$）的相应误差表达式，然后用 $M$ 表示误差大小的上限。\n- 使用给定数据，数值计算 $W_{p}$ 的求积估计值和绝对误差的界。\n\n将求积估计值和绝对误差界都以 $\\text{kJ}/\\text{m}^{3}$ 为单位表示。将两个数值均四舍五入至四位有效数字。按以下顺序将您的最终答案报告为两个数字：首先是 $W_{p}$ 的求积估计值，然后是绝对误差界。",
            "solution": "问题要求近似计算单位体积塑性功 $W_p$（由积分 $W_{p} = \\int_{\\epsilon_{a}}^{\\epsilon_{b}} f(\\epsilon)\\,d\\epsilon$ 定义）以及相应的误差界。这将通过从多项式插值的基本原理出发，推导一个单区间 Newton-Cotes 求积法则来完成。\n\n给定的数据如下：\n- 应变区间端点：$\\epsilon_{a} = 0.012$ 和 $\\epsilon_{b} = 0.028$。\n- 端点处的应力值：$f(\\epsilon_{a}) = 210 \\text{ MPa}$ 和 $f(\\epsilon_{b}) = 365 \\text{ MPa}$。\n- 应力-应变函数 $f(\\epsilon)$ 的二阶导数的界：$\\max_{\\epsilon\\in[\\epsilon_{a},\\epsilon_{b}]} | f''(\\epsilon) | \\le M$，其中 $M = 6.00 \\times 10^{4} \\text{ MPa}$。\n\n要求的结果是积分近似值的数值及其绝对误差界，两者均以 $\\text{kJ}/\\text{m}^{3}$ 为单位表示，并四舍五入到四位有效数字。\n\n**第 1 部分：求积法则的构建**\n\n我们构建一个线性多项式 $p_1(\\epsilon)$，它在点 $(\\epsilon_{a}, f(\\epsilon_{a}))$ 和 $(\\epsilon_{b}, f(\\epsilon_{b}))$ 处对函数 $f(\\epsilon)$ 进行插值。使用 Lagrange 基多项式，该插值函数是唯一的，由下式给出：\n$$\np_1(\\epsilon) = f(\\epsilon_{a}) \\frac{\\epsilon - \\epsilon_{b}}{\\epsilon_{a} - \\epsilon_{b}} + f(\\epsilon_{b}) \\frac{\\epsilon - \\epsilon_{a}}{\\epsilon_b - \\epsilon_a}\n$$\n通过对该插值多项式在区间 $[\\epsilon_{a}, \\epsilon_{b}]$ 上进行积分来近似 $f(\\epsilon)$ 的积分，从而得到 Newton-Cotes 法则。设此近似值为 $W_{p,h}$。\n$$\nW_{p,h} = \\int_{\\epsilon_{a}}^{\\epsilon_{b}} p_1(\\epsilon) \\,d\\epsilon = f(\\epsilon_{a}) \\int_{\\epsilon_{a}}^{\\epsilon_{b}} \\frac{\\epsilon - \\epsilon_{b}}{\\epsilon_{a} - \\epsilon_{b}} \\,d\\epsilon + f(\\epsilon_{b}) \\int_{\\epsilon_{a}}^{\\epsilon_{b}} \\frac{\\epsilon - \\epsilon_{a}}{\\epsilon_b - \\epsilon_a} \\,d\\epsilon\n$$\n设 $h = \\epsilon_b - \\epsilon_a$。第一个积分为：\n$$\n\\int_{\\epsilon_{a}}^{\\epsilon_{b}} \\frac{\\epsilon - \\epsilon_{b}}{-h} \\,d\\epsilon = -\\frac{1}{h} \\left[ \\frac{(\\epsilon - \\epsilon_{b})^2}{2} \\right]_{\\epsilon_{a}}^{\\epsilon_{b}} = -\\frac{1}{h} \\left( 0 - \\frac{(\\epsilon_{a} - \\epsilon_{b})^2}{2} \\right) = \\frac{1}{h} \\frac{(-h)^2}{2} = \\frac{h}{2}\n$$\n第二个积分为：\n$$\n\\int_{\\epsilon_{a}}^{\\epsilon_{b}} \\frac{\\epsilon - \\epsilon_{a}}{h} \\,d\\epsilon = \\frac{1}{h} \\left[ \\frac{(\\epsilon - \\epsilon_{a})^2}{2} \\right]_{\\epsilon_{a}}^{\\epsilon_{b}} = \\frac{1}{h} \\left( \\frac{(\\epsilon_{b} - \\epsilon_{a})^2}{2} - 0 \\right) = \\frac{1}{h} \\frac{h^2}{2} = \\frac{h}{2}\n$$\n将这些结果代回，我们得到求积公式：\n$$\nW_{p,h} = f(\\epsilon_{a}) \\frac{h}{2} + f(\\epsilon_{b}) \\frac{h}{2} = \\frac{\\epsilon_b - \\epsilon_a}{2} [f(\\epsilon_a) + f(\\epsilon_b)]\n$$\n这就是单区间 Newton-Cotes 法则，通常称为梯形法则。\n\n**第 2 部分：误差表达式与误差界的推导**\n\n问题要求从线性插值的余项推导误差项。对于一个二阶连续可微的函数 $f$，线性插值的误差由下式给出：\n$$\nE_{1}(\\epsilon) = f(\\epsilon) - p_1(\\epsilon) = \\frac{f''(\\xi_{\\epsilon})}{2!} (\\epsilon - \\epsilon_{a})(\\epsilon - \\epsilon_{b})\n$$\n对于某个 $\\xi_{\\epsilon} \\in (\\epsilon_{a}, \\epsilon_{b})$。积分的误差 $E_{W_p}$ 是该插值误差的积分：\n$$\nE_{W_p} = W_p - W_{p,h} = \\int_{\\epsilon_{a}}^{\\epsilon_{b}} (f(\\epsilon) - p_1(\\epsilon)) \\,d\\epsilon = \\int_{\\epsilon_{a}}^{\\epsilon_{b}} \\frac{f''(\\xi_{\\epsilon})}{2} (\\epsilon - \\epsilon_{a})(\\epsilon - \\epsilon_{b}) \\,d\\epsilon\n$$\n二次项 $(\\epsilon - \\epsilon_{a})(\\epsilon - \\epsilon_{b})$ 对所有 $\\epsilon \\in [\\epsilon_{a}, \\epsilon_{b}]$ 都是非正的。由于 $f''$ 在 $[\\epsilon_{a}, \\epsilon_{b}]$ 上连续，根据广义积分中值定理，存在一个值 $\\zeta \\in (\\epsilon_{a}, \\epsilon_{b})$ 使得：\n$$\nE_{W_p} = \\frac{f''(\\zeta)}{2} \\int_{\\epsilon_{a}}^{\\epsilon_{b}} (\\epsilon - \\epsilon_{a})(\\epsilon - \\epsilon_{b}) \\,d\\epsilon\n$$\n我们计算积分部分。设 $\\epsilon = \\epsilon_a + u$，则 $d\\epsilon = du$。积分限从 $\\epsilon \\in [\\epsilon_a, \\epsilon_b]$ 变为 $u \\in [0, h]$，其中 $h = \\epsilon_b - \\epsilon_a$。\n$$\n\\int_{\\epsilon_{a}}^{\\epsilon_{b}} (\\epsilon - \\epsilon_{a})(\\epsilon - \\epsilon_{b}) \\,d\\epsilon = \\int_{0}^{h} u(u-h) \\,du = \\int_{0}^{h} (u^2 - hu) \\,du = \\left[ \\frac{u^3}{3} - \\frac{hu^2}{2} \\right]_{0}^{h} = \\frac{h^3}{3} - \\frac{h^3}{2} = -\\frac{h^3}{6}\n$$\n将此结果代回 $E_{W_p}$ 的表达式：\n$$\nE_{W_p} = \\frac{f''(\\zeta)}{2} \\left( -\\frac{h^3}{6} \\right) = -\\frac{h^3}{12} f''(\\zeta) = -\\frac{(\\epsilon_b - \\epsilon_a)^3}{12} f''(\\zeta)\n$$\n为了找到误差大小的上限，我们取绝对值：\n$$\n|E_{W_p}| = \\left| -\\frac{(\\epsilon_b - \\epsilon_a)^3}{12} f''(\\zeta) \\right| = \\frac{(\\epsilon_b - \\epsilon_a)^3}{12} |f''(\\zeta)|\n$$\n使用给定的先验界 $|f''(\\epsilon)| \\le M$（对所有 $\\epsilon \\in [\\epsilon_a, \\epsilon_b]$），我们有 $|f''(\\zeta)| \\le M$。因此，绝对误差界，记为 $E_{abs\\_max}$，为：\n$$\nE_{abs\\_max} = \\frac{(\\epsilon_b - \\epsilon_a)^3}{12} M\n$$\n\n**第 3 部分：数值计算**\n\n现在我们代入给定的数值。首先，我们确定区间宽度：\n$$\nh = \\epsilon_b - \\epsilon_a = 0.028 - 0.012 = 0.016\n$$\n塑性功的求积估计值为：\n$$\nW_{p,h} = \\frac{h}{2} [f(\\epsilon_a) + f(\\epsilon_b)] = \\frac{0.016}{2} (210 \\text{ MPa} + 365 \\text{ MPa}) = 0.008 \\times 575 \\text{ MPa} = 4.6 \\text{ MPa}\n$$\n应力单位 (MPa) 乘以无量纲应变得到的结果单位是 MPa。我们必须将其转换为要求的单位 $\\text{kJ}/\\text{m}^{3}$。\n$$\n1 \\text{ MPa} = 10^6 \\text{ Pa} = 10^6 \\frac{\\text{N}}{\\text{m}^2} = 10^6 \\frac{\\text{J}}{\\text{m}^3} = 10^3 \\frac{\\text{kJ}}{\\text{m}^3}\n$$\n所以，$W_{p,h} = 4.6 \\times 10^3 \\text{ kJ}/\\text{m}^3 = 4600 \\text{ kJ}/\\text{m}^3$。四舍五入到四位有效数字得到 $4600$。\n\n接下来，我们计算绝对误差界：\n$$\nE_{abs\\_max} = \\frac{h^3}{12} M = \\frac{(0.016)^3}{12} \\times (6.00 \\times 10^4 \\text{ MPa})\n$$\n$$\nE_{abs\\_max} = \\frac{4.096 \\times 10^{-6}}{12} \\times (6.00 \\times 10^4) \\text{ MPa} = (4.096 \\times 10^{-6}) \\times (5.00 \\times 10^3) \\text{ MPa}\n$$\n$$\nE_{abs\\_max} = 20.48 \\times 10^{-3} \\text{ MPa} = 0.02048 \\text{ MPa}\n$$\n转换为要求的单位：\n$$\nE_{abs\\_max} = 0.02048 \\times 10^3 \\text{ kJ}/\\text{m}^3 = 20.48 \\text{ kJ}/\\text{m}^3\n$$\n这个值已经是四位有效数字。\n\n最终的数值结果是塑性功的估计值 $W_{p,h} = 4600 \\text{ kJ}/\\text{m}^3$ 和绝对误差界 $E_{abs\\_max} = 20.48 \\text{ kJ}/\\text{m}^3$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4600 & 20.48 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "真实世界的工程问题通常涉及复杂的物理场，在这些场中，没有任何单一的积分法则是处处最优的。本练习是一项综合性的实践，旨在连接理论与现代计算实践 ()。它挑战您设计并实现一种混合自适应积分方案，该方案能根据问题的局部特征（如高应变梯度区域）智能地在不同求积法则之间切换。通过完成这项任务，您将学会在计算精度和成本之间进行权衡，这是解决大规模、非均匀岩土力学问题的关键高级技能。",
            "id": "3546638",
            "problem": "你的任务是为一个综合有限元积分任务设计并实现一个混合数值积分方案，该任务的灵感来源于计算岩土力学中的条形基础承载力问题。目标是近似一个二维标量被积函数的积分，该被积函数依赖于一个在基础区域附近具有陡峭梯度的预设“类应变”场，并比较三种求积策略：纯高斯求积、纯牛顿-柯特斯求积，以及一种根据梯度幅值准则进行切换的混合法则。该问题必须作为一个完整的、可运行的程序来实现。\n\n考虑矩形域 $\\mathcal{D} = \\{(x,y) \\mid x \\in [-B/2,B/2], y \\in [0,H]\\}$，将其离散化为一个由 $N_x \\times N_y$ 个轴对齐矩形单元组成的均匀网格。定义综合“类应变”标量场 $\\varepsilon(x,y)$ 和标量被积函数 $f(x,y)$ 如下：\n$$\n\\varepsilon(x,y) = A \\tanh\\!\\big(\\kappa\\, r(x,y)\\big), \\quad r(x,y) = \\exp\\!\\Big(-\\big(\\tfrac{x}{\\sigma_x}\\big)^2\\Big)\\,\\exp\\!\\Big(-\\tfrac{y}{\\sigma_y}\\Big), \\quad f(x,y) = \\big(1+\\beta y\\big)\\,\\varepsilon(x,y)^2,\n$$\n其中 $A>0$、$\\kappa>0$、$\\sigma_x>0$、$\\sigma_y>0$ 和 $\\beta \\ge 0$ 是给定参数。这种选择会在基础线 $x=0$ 下方产生一个局部化的、陡峭的“类破坏”梯度，该梯度在 $x$ 方向和 $y$ 方向上衰减。\n\n设目标积分为\n$$\nI = \\iint_{\\mathcal{D}} f(x,y)\\, dx\\, dy.\n$$\n\n通过对每个物理单元仿射映射到参考正方形 $[-1,1]\\times[-1,1]$ 上，使用三种求积策略计算单元贡献并求和，从而近似 $I$：\n- 纯高斯求积：采用 $2 \\times 2$ 点的张量积高斯-勒让德求积。在一维中，节点为 $\\xi \\in \\{-1/\\sqrt{3}, +1/\\sqrt{3}\\}$，权重为 $w=1$。\n- 纯牛顿-柯特斯求积：采用 $3 \\times 3$ 点的张量积闭式牛顿-柯特斯辛普森求积。在一维 $[-1,1]$ 上，节点为 $\\xi \\in \\{-1,0,+1\\}$，权重为 $w \\in \\{\\tfrac{1}{3},\\tfrac{4}{3},\\tfrac{1}{3}\\}$。\n- 混合法则：在每个单元上，根据 $\\varepsilon(x,y)$ 的梯度幅值评估“切换准则”，对“高梯度”单元使用高斯求积，否则使用牛顿-柯特斯求积。具体来说，定义\n$$\n\\nabla \\varepsilon(x,y) = A \\kappa\\, \\operatorname{sech}^2\\!\\big(\\kappa r(x,y)\\big)\\, \\nabla r(x,y), \\quad \\nabla r(x,y) = r(x,y)\\,\\Big(-\\tfrac{2x}{\\sigma_x^2},\\; -\\tfrac{1}{\\sigma_y}\\Big),\n$$\n并记 $g(x,y)=\\|\\nabla\\varepsilon(x,y)\\|_2$。对于给定的阈值 $T>0$，如果在一个映射到该单元的 $3 \\times 3$ 张量网格点（$\\xi,\\eta \\in \\{-1,0,+1\\}$）上 $\\max g(x,y) > T$，则将该单元声明为“高梯度”单元；否则，声明为“低梯度”单元。在高梯度单元上使用高斯 $2\\times 2$ 求积，在低梯度单元上使用牛顿-柯特斯辛普森 $3\\times 3$ 求积。\n\n使用从参考坐标 $(\\xi,\\eta)\\in[-1,1]^2$ 到每个单元物理坐标 $(x,y)$ 的仿射映射，其雅可比行列式为 $J = \\frac{\\Delta x}{2}\\frac{\\Delta y}{2}$，其中 $\\Delta x$ 和 $\\Delta y$ 是单元在 $x$ 和 $y$ 方向上的尺寸。对于每个单元，求积近似形式为\n$$\nI_e \\approx J \\sum_{i} \\sum_{j} w_i w_j \\, f\\big(x(\\xi_i), y(\\eta_j)\\big),\n$$\n其中 $(\\xi_i,w_i)$ 和 $(\\eta_j,w_j)$ 是所选法则的一维节点和权重。\n\n为得到高精度参考积分 $I_{\\mathrm{ref}}$，对每个单元使用 $5 \\times 5$ 点的张量积高斯-勒让德求积，然后对所有单元求和。\n\n定义以下成本模型以比较效率：\n- 令 $n_f$ 为一种求积方法在所有单元中对 $f(x,y)$ 的求值总次数。\n- 令 $n_g$ 为用于切换准则的 $g(x,y)$ 在所有单元中的求值总次数（将 $g$ 在一个点上的每次求值计为一个单位）。\n- 给定一个非负成本权重 $c_{\\mathrm{grad}}$，定义总成本为 $C = n_f + c_{\\mathrm{grad}}\\, n_g$。\n\n任务：\n1. 在一个单一程序中实现上述内容，计算 $I_{\\mathrm{ref}}$，并对三种方法（纯高斯、纯牛顿-柯特斯、混合）中的每一种，计算近似积分 $I_{\\mathrm{M}}$、绝对误差 $E_{\\mathrm{M}} = |I_{\\mathrm{M}} - I_{\\mathrm{ref}}|$ 和总成本 $C_{\\mathrm{M}}$。\n2. 使用以下参数集测试套件。每个测试用例是一个元组 $\\big(B,H,N_x,N_y,A,\\kappa,\\sigma_x,\\sigma_y,\\beta,T,c_{\\mathrm{grad}}\\big)$：\n   - 用例 1：$\\big(2.0,\\,1.0,\\,20,\\,10,\\,0.05,\\,6.0,\\,0.4,\\,0.3,\\,0.2,\\,0.05,\\,1.0\\big)$。\n   - 用例 2：$\\big(2.0,\\,1.0,\\,40,\\,20,\\,0.5,\\,20.0,\\,0.25,\\,0.2,\\,0.4,\\,0.2,\\,1.0\\big)$。\n   - 用例 3（迫使所有单元使用高斯求积的阈值）：$\\big(2.0,\\,1.0,\\,30,\\,15,\\,0.5,\\,20.0,\\,0.25,\\,0.2,\\,0.4,\\,0.0,\\,1.0\\big)$。\n   - 用例 4（迫使所有单元使用牛顿-柯特斯求积的阈值）：$\\big(2.0,\\,1.0,\\,30,\\,15,\\,0.5,\\,20.0,\\,0.25,\\,0.2,\\,0.4,\\,10^9,\\,1.0\\big)$。\n3. 对于每个用例，报告三种方法（纯高斯、纯牛顿-柯特斯、混合）的配对 $(E_{\\mathrm{M}}, C_{\\mathrm{M}})$。\n4. 最终输出格式：你的程序应生成单行输出，包含一个含四个项目的列表（每个测试用例一个）。每个项目本身必须是一个包含六个数字的列表，顺序为 $\\big[E_{\\mathrm{Gauss}}, C_{\\mathrm{Gauss}}, E_{\\mathrm{NC}}, C_{\\mathrm{NC}}, E_{\\mathrm{Hybrid}}, C_{\\mathrm{Hybrid}}\\big]$。误差必须报告为四舍五入到六位小数的浮点数，成本必须报告为整数。例如，一个有效的形状是 $\\big[\\,[e_{11},c_{11},e_{12},c_{12},e_{13},c_{13}],\\,[e_{21},c_{21},e_{22},c_{22},e_{23},c_{23}],\\,[e_{31},c_{31},e_{32},c_{32},e_{33},c_{33}],\\,[e_{41},c_{41},e_{42},c_{42},e_{43},c_{43}]\\,\\big]$。\n\n注意：此问题不涉及角度。不需要物理单位；所有量纲均为无量纲。确保所有计算都是确定性的。程序必须是独立完整的，不得要求任何输入，并且必须遵循指定的输出格式。",
            "solution": "该问题是有效的。它提出了一个基于标准计算方法的、定义明确的数值分析任务。所有参数、函数和过程都已明确无误地指定，构成一个独立且可解的问题。\n\n目标是近似二维积分 $I = \\iint_{\\mathcal{D}} f(x,y)\\, dx\\, dy$，积分域为一个矩形域 $\\mathcal{D} = \\{(x,y) \\mid x \\in [-B/2,B/2], y \\in [0,H]\\}$。被积函数由 $f(x,y) = \\big(1+\\beta y\\big)\\,\\varepsilon(x,y)^2$ 给出，其中“类应变”场 $\\varepsilon(x,y)$ 定义为 $\\varepsilon(x,y) = A \\tanh\\!\\big(\\kappa\\, r(x,y)\\big)$，其中 $r(x,y) = \\exp\\!\\Big(-\\big(\\tfrac{x}{\\sigma_x}\\big)^2\\Big)\\,\\exp\\!\\Big(-\\tfrac{y}{\\sigma_y}\\Big)$。该公式创建了一个在 $x=0$ 线附近具有局部化陡峭梯度的函数，模拟了岩土力学背景下的应力或应变集中。\n\n积分 $I$ 的近似通过将域 $\\mathcal{D}$ 离散化为 $N_x \\times N_y$ 个矩形单元的网格，并对每个单元的贡献求和来执行。每个单元上的积分使用定义在参考正方形 $[-1,1] \\times [-1,1]$ 上的求积法则进行数值计算。\n\n一个仿射映射将点 $(\\xi, \\eta)$ 从参考正方形变换到特定单元内的物理坐标 $(x,y)$。对于一个尺寸为 $\\Delta x \\times \\Delta y$、中心在 $(x_c, y_c)$ 的单元，映射为：\n$$\nx(\\xi) = x_c + \\xi \\frac{\\Delta x}{2}, \\quad y(\\eta) = y_c + \\eta \\frac{\\Delta y}{2}\n$$\n微分面积元变换为 $dx\\,dy = J\\,d\\xi\\,d\\eta$，其中雅可比行列式对所有单元都是常数：$J = \\frac{\\Delta x}{2}\\frac{\\Delta y}{2} = \\frac{BH}{4 N_x N_y}$。因此，单个单元上的积分 $I_e$ 近似为：\n$$\nI_e = \\iint_{\\text{element}} f(x,y)\\,dx\\,dy \\approx J \\sum_i \\sum_j w_i w_j f\\big(x(\\xi_i), y(\\eta_j)\\big)\n$$\n其中 $(\\xi_i, w_i)$ 和 $(\\eta_j, w_j)$ 是所选法则的一维求积节点和权重。\n\n我们将实现并比较三种不同的求积策略：\n1.  **纯高斯求积**：对每个单元应用 $2 \\times 2$ 张量积高斯-勒让德法则。在一维中，节点为 $\\xi \\in \\{-1/\\sqrt{3}, +1/\\sqrt{3}\\}$，权重为 $w=1$。此法则每个单元使用4次函数求值。对于平滑的、类似多项式的被积函数，它非常高效。\n\n2.  **纯牛顿-柯特斯求积**：对每个单元应用 $3 \\times 3$ 张量积闭式牛顿-柯特斯法则（辛普森法则）。在一维中，节点为 $\\xi \\in \\{-1, 0, +1\\}$，权重为 $w \\in \\{\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}\\}$。此法则每个单元使用9次函数求值。作为一种更高阶的法则，它对于行为良好的函数可能更精确，但计算成本也更高。\n\n3.  **混合求积**：这种自适应策略逐个单元地选择求积法则。选择由一个基于类应变场梯度幅值的“切换准则”控制，$g(x,y) = \\|\\nabla \\varepsilon(x,y)\\|_2$。梯度由以下公式给出：\n    $$\n    \\nabla \\varepsilon(x,y) = A \\kappa\\, \\operatorname{sech}^2\\!\\big(\\kappa r(x,y)\\big)\\, \\nabla r(x,y) \\quad \\text{with} \\quad \\nabla r(x,y) = r(x,y)\\,\\Big(-\\tfrac{2x}{\\sigma_x^2},\\; -\\tfrac{1}{\\sigma_y}\\Big)\n    $$\n    这导出了幅值函数：\n    $$\n    g(x,y) = A \\kappa\\, \\operatorname{sech}^2\\big(\\kappa r(x,y)\\big) r(x,y) \\sqrt{\\frac{4x^2}{\\sigma_x^4} + \\frac{1}{\\sigma_y^2}}\n    $$\n    对于每个单元，我们在对应于辛普森法则节点的 $3 \\times 3$ 点网格上评估 $g(x,y)$。如果 $g(x,y)$ 在此网格上的最大值超过给定阈值 $T$，则该单元被分类为“高梯度”单元，并使用计算上更便宜的 $2 \\times 2$ 高斯法则进行积分。否则，它被分类为“低梯度”单元，并使用更精确的 $3 \\times 3$ 牛顿-柯特斯法则进行积分。其基本原理是将更多的计算精力（更多的求积点）分配给被积函数平滑且高阶法则最有效的区域。\n\n为了评估这些方法的性能，我们首先通过对每个单元应用 $5 \\times 5$ 张量积高斯-勒让德求积法则来计算一个高精度参考积分 $I_{\\mathrm{ref}}$。然后，每种方法 $M$ 的精度通过绝对误差 $E_M = |I_M - I_{\\mathrm{ref}}|$ 来衡量。\n\n计算效率使用成本模型 $C = n_f + c_{\\mathrm{grad}}\\, n_g$ 进行评估，该模型考虑了被积函数求值的总次数 $n_f$ 和混合切换准则所需的梯度幅值求值的总次数 $n_g$。\n-   对于纯高斯法：$C_{\\mathrm{Gauss}} = (N_x N_y) \\times (2 \\times 2)$。不需要梯度求值，因此 $n_g=0$。\n-   对于纯牛顿-柯特斯法：$C_{\\mathrm{NC}} = (N_x N_y) \\times (3 \\times 3)$。不需要梯度求值，因此 $n_g=0$。\n-   对于混合方法：$C_{\\mathrm{Hybrid}} = n_{f, \\text{hybrid}} + c_{\\mathrm{grad}} \\times n_{g, \\text{hybrid}}$。这里，$n_{f, \\text{hybrid}}$ 是所有单元上函数求值的总和（高梯度为4次，低梯度为9次），而 $n_{g, \\text{hybrid}} = (N_x N_y) \\times (3 \\times 3)$。\n\n算法的流程是首先定义必要的数学函数和求积法则。然后，对于每个测试用例，它遍历离散化域的所有 $N_x \\times N_y$ 个单元。在每个单元中，它为参考解和三种方法中的每一种计算积分贡献，并相应地更新总积分和成本计数器。最后，它计算绝对误差和总成本，并按指定格式化结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_legendre\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # B, H, Nx, Ny, A, kappa, sigma_x, sigma_y, beta, T, c_grad\n        (2.0, 1.0, 20, 10, 0.05, 6.0, 0.4, 0.3, 0.2, 0.05, 1.0),\n        (2.0, 1.0, 40, 20, 0.5, 20.0, 0.25, 0.2, 0.4, 0.2, 1.0),\n        (2.0, 1.0, 30, 15, 0.5, 20.0, 0.25, 0.2, 0.4, 0.0, 1.0),\n        (2.0, 1.0, 30, 15, 0.5, 20.0, 0.25, 0.2, 0.4, 10**9, 1.0)\n    ]\n\n    # Pre-calculate quadrature rules\n    nodes_g2, weights_g2 = roots_legendre(2)\n    nodes_nc3 = np.array([-1.0, 0.0, 1.0])\n    weights_nc3 = np.array([1/3, 4/3, 1/3])\n    nodes_g5, weights_g5 = roots_legendre(5)\n\n    quad_rules = {\n        'gauss2': (nodes_g2, weights_g2, 2*2),\n        'nc3': (nodes_nc3, weights_nc3, 3*3),\n        'gauss5': (nodes_g5, weights_g5, 5*5)\n    }\n\n    all_results = []\n    for case in test_cases:\n        all_results.append(run_case(case, quad_rules))\n\n    # Format the final output string\n    formatted_results = []\n    for res_tuple in all_results:\n        e_g, c_g, e_nc, c_nc, e_h, c_h = res_tuple\n        formatted_results.append(\n            f\"[{e_g:.6f},{c_g},{e_nc:.6f},{c_nc},{e_h:.6f},{c_h}]\"\n        )\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef run_case(params, quad_rules):\n    \"\"\"\n    Runs a single test case.\n    \"\"\"\n    B, H, Nx, Ny, A, kappa, sx, sy, beta, T, c_grad = params\n    dx, dy = B / Nx, H / Ny\n    J = (dx / 2.0) * (dy / 2.0)\n\n    # Define the core functions using closures to capture parameters\n    def r_func(x, y):\n        return np.exp(-(x/sx)**2) * np.exp(-y/sy)\n\n    def eps_func(x, y):\n        return A * np.tanh(kappa * r_func(x, y))\n\n    def f_func(x, y):\n        return (1.0 + beta * y) * eps_func(x, y)**2\n\n    def g_func(x, y):\n        r_val = r_func(x, y)\n        # sech(u) = 1 / cosh(u)\n        sech_val = 1.0 / np.cosh(kappa * r_val)\n        grad_r_norm = np.sqrt(4.0 * x**2 / sx**4 + 1.0 / sy**2)\n        return A * kappa * sech_val**2 * r_val * grad_r_norm\n\n    # Initialize integrals and costs\n    I_ref, I_gauss, I_nc, I_hybrid = 0.0, 0.0, 0.0, 0.0\n    \n    # Costs for pure methods are deterministic\n    C_gauss = Nx * Ny * quad_rules['gauss2'][2]\n    C_nc = Nx * Ny * quad_rules['nc3'][2]\n    \n    # Hybrid costs are accumulated\n    nf_hybrid = 0\n    ng_hybrid = (Nx * Ny) * quad_rules['nc3'][2]\n\n    # Unpack quadrature rules for convenience\n    nodes_g2, weights_g2, n_g2 = quad_rules['gauss2']\n    nodes_nc3, weights_nc3, n_nc3 = quad_rules['nc3']\n    nodes_g5, weights_g5, _ = quad_rules['gauss5']\n    \n    # Create meshgrids for quadrature points\n    xi_g2, eta_g2 = np.meshgrid(nodes_g2, nodes_g2)\n    w_g2 = np.outer(weights_g2, weights_g2)\n\n    xi_nc3, eta_nc3 = np.meshgrid(nodes_nc3, nodes_nc3)\n    w_nc3 = np.outer(weights_nc3, weights_nc3)\n    \n    xi_g5, eta_g5 = np.meshgrid(nodes_g5, nodes_g5)\n    w_g5 = np.outer(weights_g5, weights_g5)\n\n    # Loop over all elements\n    for i in range(Nx):\n        for j in range(Ny):\n            xc = -B/2.0 + (i + 0.5) * dx\n            yc = 0.0 + (j + 0.5) * dy\n\n            # Reference integral (Gauss 5x5)\n            x_pts_g5 = xc + xi_g5 * dx / 2.0\n            y_pts_g5 = yc + eta_g5 * dy / 2.0\n            I_ref += J * np.sum(w_g5 * f_func(x_pts_g5, y_pts_g5))\n\n            # Pure Gauss integral (Gauss 2x2)\n            x_pts_g2 = xc + xi_g2 * dx / 2.0\n            y_pts_g2 = yc + eta_g2 * dy / 2.0\n            I_gauss_elem = J * np.sum(w_g2 * f_func(x_pts_g2, y_pts_g2))\n            I_gauss += I_gauss_elem\n\n            # Pure Newton-Cotes integral (NC 3x3)\n            x_pts_nc3 = xc + xi_nc3 * dx / 2.0\n            y_pts_nc3 = yc + eta_nc3 * dy / 2.0\n            I_nc_elem = J * np.sum(w_nc3 * f_func(x_pts_nc3, y_pts_nc3))\n            I_nc += I_nc_elem\n\n            # Hybrid method\n            # 1. Switching criterion on the 3x3 grid\n            g_vals = g_func(x_pts_nc3, y_pts_nc3)\n            max_g = np.max(g_vals)\n\n            # 2. Select rule and compute integral\n            if max_g > T:  # High-gradient -> use Gauss 2x2\n                I_hybrid += I_gauss_elem\n                nf_hybrid += n_g2\n            else:  # Low-gradient -> use Newton-Cotes 3x3\n                I_hybrid += I_nc_elem\n                nf_hybrid += n_nc3\n\n    # Finalize calculations for the case\n    C_hybrid = nf_hybrid + int(c_grad * ng_hybrid)\n\n    E_gauss = abs(I_gauss - I_ref)\n    E_nc = abs(I_nc - I_ref)\n    E_hybrid = abs(I_hybrid - I_ref)\n\n    return (E_gauss, int(C_gauss), E_nc, int(C_nc), E_hybrid, int(C_hybrid))\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}