{
    "hands_on_practices": [
        {
            "introduction": "This first exercise is the cornerstone of computational plasticity. You will implement the classic return mapping algorithm for an isotropic material governed by the von Mises ($J_2$) yield criterion and an associated flow rule. Mastering this implementation in a full three-dimensional tensorial framework  is essential, as it establishes the fundamental elastic-predictor, plastic-corrector workflow that underpins most advanced constitutive models.",
            "id": "3551039",
            "problem": "You are to implement a small-strain, three-dimensional implicit return mapping algorithm for an associated isotropic $J_2$ elastoplastic model with linear isotropic hardening, using the backward Euler time discretization. The implementation must be general and self-contained, operating purely on mathematical objects (tensors) without external input. All material parameters and state variables will be provided numerically in the test suite below. Your program must compute updates for a single load increment per test case, starting from the given previous state.\n\nFoundational base to use:\n- Linear elasticity of isotropic solids at small strains: the Cauchy stress tensor $\\boldsymbol{\\sigma}$ relates to the total strain tensor $\\boldsymbol{\\varepsilon}$ and the plastic strain tensor $\\boldsymbol{\\varepsilon}^p$ via $\\boldsymbol{\\sigma} = \\mathbb{C}:(\\boldsymbol{\\varepsilon}-\\boldsymbol{\\varepsilon}^p)$, with the fourth-order elasticity tensor $\\mathbb{C}$ defined by the Lamé parameters $\\lambda$ and $\\mu$ obtained from Young’s modulus $E$ and Poisson’s ratio $\\nu$.\n- Deviatoric-volumetric split: $\\boldsymbol{\\sigma} = \\mathbf{s} + p \\mathbf{I}$ with $\\mathbf{s} = \\operatorname{dev}\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma} - \\tfrac{1}{3}(\\operatorname{tr}\\boldsymbol{\\sigma})\\mathbf{I}$ and $p = \\tfrac{1}{3}\\operatorname{tr}\\boldsymbol{\\sigma}$.\n- Yield function for isotropic $J_2$ plasticity with linear isotropic hardening: $f(\\boldsymbol{\\sigma},\\kappa) = \\|\\mathbf{s}\\| - r(\\kappa)$, where $\\|\\cdot\\|$ is the Frobenius norm and $r(\\kappa) = \\sqrt{\\tfrac{2}{3}}\\left(\\sigma_{y0} + H \\kappa\\right)$; the internal hardening variable $\\kappa$ is the accumulated equivalent plastic strain.\n- Associated plastic potential and flow rule: adopt $g(\\boldsymbol{\\sigma}) \\equiv f(\\boldsymbol{\\sigma},\\kappa)$ and $\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\,\\dfrac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$, with $\\Delta \\gamma \\ge 0$ the plastic multiplier increment.\n- Kuhn–Tucker conditions: $f \\le 0$, $\\Delta \\gamma \\ge 0$, and $\\Delta \\gamma f = 0$.\n- Isotropic hardening evolution: $\\Delta \\kappa = \\sqrt{\\tfrac{2}{3}}\\|\\Delta \\boldsymbol{\\varepsilon}^p\\|$.\n\nThe algorithm to implement:\n- Use an elastic predictor: compute the trial stress $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ from the previous stress and the total strain increment $\\Delta \\boldsymbol{\\varepsilon}$ assuming $\\Delta \\boldsymbol{\\varepsilon}^p = \\mathbf{0}$.\n- Evaluate the trial yield function $f^{\\mathrm{tr}}$ using $\\mathbf{s}^{\\mathrm{tr}}=\\operatorname{dev}\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ and the previous $\\kappa_n$.\n- If $f^{\\mathrm{tr}} \\le 0$ (within a reasonable numerical tolerance), accept the elastic trial state: $\\boldsymbol{\\sigma}_{n+1}=\\boldsymbol{\\sigma}^{\\mathrm{tr}}$, $\\kappa_{n+1}=\\kappa_n$, and $\\Delta \\gamma = 0$.\n- If $f^{\\mathrm{tr}}  0$, perform a radial return in deviatoric stress space enforcing the flow rule and the consistency condition to compute $\\Delta \\gamma$, update the deviatoric stress $\\mathbf{s}_{n+1}$, keep the hydrostatic pressure $p$ from the trial state, and update $\\kappa_{n+1}$.\n\nYour program must, for each test case, output the following list:\n- A boolean indicating whether plastic correction occurred (True if $f^{\\mathrm{tr}}  0$, otherwise False).\n- The von Mises equivalent stress at the end of the increment $q_{n+1} = \\sqrt{\\tfrac{3}{2}}\\|\\mathbf{s}_{n+1}\\|$, expressed in kilopascals (kPa) as a floating-point number.\n- The plastic multiplier increment $\\Delta \\gamma$ as a floating-point number.\n- The final mean stress $p_{n+1} = \\tfrac{1}{3}\\operatorname{tr}\\boldsymbol{\\sigma}_{n+1}$, expressed in kilopascals (kPa) as a floating-point number.\n\nAll floating-point outputs must be rounded to $6$ decimal places in the final printed result. Angles do not appear in this problem. No percentages should be used anywhere.\n\nTest suite:\nFor all cases, assume small strains and zero initial stress $\\boldsymbol{\\sigma}_n = \\mathbf{0}$. All moduli are given in kilopascals (kPa). Each strain increment is a symmetric second-order tensor given by its full $3\\times 3$ components. Each test case provides $(E,\\nu,\\sigma_{y0},H,\\kappa_n,\\Delta \\boldsymbol{\\varepsilon})$.\n\n- Test $1$ (elastic, pure shear):\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$.\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.0003  0 \\\\ 0.0003  0  0 \\\\ 0  0  0 \\end{bmatrix}$.\n\n- Test $2$ (plastic, perfect plasticity):\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$.\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.002  0 \\\\ 0.002  0  0 \\\\ 0  0  0 \\end{bmatrix}$.\n\n- Test $3$ (plastic, linear isotropic hardening with nonzero prior $\\kappa_n$):\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 10000$ (kPa), $\\kappa_n = 0.05$.\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.002  0 \\\\ 0.002  0  0 \\\\ 0  0  0 \\end{bmatrix}$.\n\n- Test $4$ (purely volumetric, elastic):\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 5000$ (kPa), $\\kappa_n = 0$.\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.001  0  0 \\\\ 0  0.001  0 \\\\ 0  0  0.001 \\end{bmatrix}$.\n\n- Test $5$ (boundary case exactly on yield, treated as elastic if $f^{\\mathrm{tr}} \\le 0$):\n  - $E = 200000$ (kPa), $\\nu = 0.3$, $\\sigma_{y0} = 200$ (kPa), $H = 0$ (kPa), $\\kappa_n = 0$.\n  - $\\Delta \\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.00075  0 \\\\ 0.00075  0  0 \\\\ 0  0  0 \\end{bmatrix}$.\n\nFinal output format:\nYour program should produce a single line of output containing a list of the per-test-case results, where each result is itself a list in the order [plastic_flag, q_kPa, delta_gamma, p_kPa]. For example, the final printed line must look like:\n\"[[True,123.456789,0.001234,10.000000],[False, ...], ...]\"\n\nNo other text should be printed.",
            "solution": "The user-provided problem requires the implementation of a return mapping algorithm for a rate-independent, small-strain, isotropic $J_2$ elastoplastic model with linear isotropic hardening. The problem is well-posed, scientifically sound, and provides all necessary information for a unique solution. The following details the theoretical foundation and the algorithmic steps for the implementation.\n\n### 1. Constitutive Model\nThe total strain tensor $\\boldsymbol{\\varepsilon}$ is additively decomposed into an elastic part $\\boldsymbol{\\varepsilon}^e$ and a plastic part $\\boldsymbol{\\varepsilon}^p$: $\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^e + \\boldsymbol{\\varepsilon}^p$.\n\n**Elastic Behavior**: The Cauchy stress tensor $\\boldsymbol{\\sigma}$ is related to the elastic strain tensor by Hooke's law for isotropic materials:\n$$ \\boldsymbol{\\sigma} = \\mathbb{C}:\\boldsymbol{\\varepsilon}^e = \\mathbb{C}:(\\boldsymbol{\\varepsilon} - \\boldsymbol{\\varepsilon}^p) $$\nThe fourth-order elasticity tensor $\\mathbb{C}$ is defined by the Lamé parameters $\\lambda$ and $\\mu$ (shear modulus), which are derived from Young's modulus $E$ and Poisson's ratio $\\nu$:\n$$ \\mu = \\frac{E}{2(1+\\nu)}, \\quad \\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} $$\nIt is convenient to express the stress-strain relationship in terms of deviatoric and volumetric components. A tensor $\\mathbf{A}$ is split as $\\mathbf{A} = \\operatorname{dev}(\\mathbf{A}) + \\frac{1}{3}\\operatorname{tr}(\\mathbf{A})\\mathbf{I}$, where $\\operatorname{dev}(\\mathbf{A})$ is the deviatoric part and $\\operatorname{tr}(\\mathbf{A})$ is the trace. Let $\\mathbf{s} = \\operatorname{dev}(\\boldsymbol{\\sigma})$ be the deviatoric stress and $p = \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma})$ be the mean stress (hydrostatic pressure). Similarly, $\\mathbf{e} = \\operatorname{dev}(\\boldsymbol{\\varepsilon})$ and $\\epsilon_v = \\operatorname{tr}(\\boldsymbol{\\varepsilon})$. The elastic relations are:\n$$ \\mathbf{s} = 2\\mu(\\mathbf{e} - \\mathbf{e}^p), \\quad p = K(\\epsilon_v - \\epsilon_v^p) $$\nwhere $K = \\lambda + \\frac{2}{3}\\mu = \\frac{E}{3(1-2\\nu)}$ is the bulk modulus.\n\n**Plastic Behavior**: Plastic flow is governed by a yield function, a flow rule, and a hardening law.\n- **Yield Function**: The onset of plastic deformation is determined by the $J_2$ yield function with linear isotropic hardening:\n  $$ f(\\boldsymbol{\\sigma},\\kappa) = \\|\\mathbf{s}\\| - r(\\kappa) \\le 0 $$\n  where $\\|\\mathbf{s}\\| = \\sqrt{\\mathbf{s}:\\mathbf{s}}$ is the Frobenius norm of the deviatoric stress tensor. The yield surface radius $r(\\kappa)$ depends on the internal hardening variable $\\kappa$, which represents the accumulated equivalent plastic strain:\n  $$ r(\\kappa) = \\sqrt{\\frac{2}{3}}\\left(\\sigma_{y0} + H \\kappa\\right) $$\n  Here, $\\sigma_{y0}$ is the initial yield stress in uniaxial tension and $H$ is the constant hardening modulus. The yield condition can also be expressed in terms of the von Mises equivalent stress $q = \\sqrt{\\frac{3}{2}}\\|\\mathbf{s}\\|$, as $q \\le \\sigma_{y}(\\kappa)$, where $\\sigma_{y}(\\kappa) = \\sigma_{y0} + H\\kappa$.\n\n- **Flow Rule**: An associated flow rule is adopted, meaning the plastic potential $g$ is identical to the yield function $f$. The plastic strain increment $\\Delta \\boldsymbol{\\varepsilon}^p$ is normal to the yield surface:\n  $$ \\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\Delta \\gamma \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\Delta \\gamma \\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|} $$\n  The scalar $\\Delta \\gamma \\ge 0$ is the plastic multiplier. This flow rule implies that plastic deformation is isochoric (volume-preserving), i.e., $\\operatorname{tr}(\\Delta \\boldsymbol{\\varepsilon}^p) = 0$.\n\n- **Hardening Law**: The evolution of the hardening variable $\\kappa$ is given by:\n  $$ \\Delta \\kappa = \\sqrt{\\frac{2}{3}}\\|\\Delta \\boldsymbol{\\varepsilon}^p\\| $$\n  From the flow rule, $\\|\\Delta \\boldsymbol{\\varepsilon}^p\\| = \\Delta \\gamma \\|\\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|}\\| = \\Delta \\gamma$. Thus, the hardening increment is:\n  $$ \\Delta \\kappa = \\sqrt{\\frac{2}{3}}\\Delta \\gamma $$\n  \nThe loading/unloading conditions are specified by the Kuhn-Tucker complementarity conditions:\n$$ f \\le 0, \\quad \\Delta \\gamma \\ge 0, \\quad \\Delta \\gamma f = 0 $$\n\n### 2. Implicit Return Mapping Algorithm\nThe algorithm updates the state from time $n$ to $n+1$ for a given total strain increment $\\Delta\\boldsymbol{\\varepsilon}$. Using a backward Euler integration scheme, we aim to find $(\\boldsymbol{\\sigma}_{n+1}, \\boldsymbol{\\varepsilon}^p_{n+1}, \\kappa_{n+1})$ that satisfy the constitutive relations at time $n+1$.\n\n**Step 1: Elastic Predictor**\nFirst, assume the step is purely elastic ($\\Delta \\boldsymbol{\\varepsilon}^p = \\mathbf{0}$, hence $\\Delta \\gamma = 0$). The trial stress $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ is computed:\n$$ \\boldsymbol{\\sigma}^{\\mathrm{tr}} = \\mathbb{C}:(\\boldsymbol{\\varepsilon}_{n+1} - \\boldsymbol{\\varepsilon}^p_n) = \\boldsymbol{\\sigma}_n + \\mathbb{C}:\\Delta\\boldsymbol{\\varepsilon} $$\nSplitting into deviatoric and volumetric parts:\n$$ \\mathbf{s}^{\\mathrm{tr}} = \\mathbf{s}_n + 2\\mu\\operatorname{dev}(\\Delta\\boldsymbol{\\varepsilon}) $$\n$$ p^{\\mathrm{tr}} = p_n + K\\operatorname{tr}(\\Delta\\boldsymbol{\\varepsilon}) $$\nFor the given problem, the initial state is unstressed, $\\boldsymbol{\\sigma}_n = \\mathbf{0}$, so $\\mathbf{s}_n=\\mathbf{0}$ and $p_n=0$.\n\n**Step 2: Yield Check**\nEvaluate the yield function at the trial state, using the hardening state from the previous step, $\\kappa_n$:\n$$ f^{\\mathrm{tr}} = \\|\\mathbf{s}^{\\mathrm{tr}}\\| - r(\\kappa_n) $$\n- If $f^{\\mathrm{tr}} \\le 0$, the assumption of elasticity is correct. The state is updated to the trial state:\n  $$ \\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}}, \\quad \\boldsymbol{\\varepsilon}^p_{n+1} = \\boldsymbol{\\varepsilon}^p_n, \\quad \\kappa_{n+1} = \\kappa_n, \\quad \\Delta\\gamma = 0 $$\n  This is an **elastic step**.\n\n**Step 3: Plastic Corrector**\n- If $f^{\\mathrm{tr}}  0$, the trial state lies outside the yield surface, indicating plastic yielding has occurred. The state must be \"returned\" to the updated yield surface. This is a **plastic step**. We must find $\\Delta \\gamma  0$ such that the consistency condition $f(\\boldsymbol{\\sigma}_{n+1}, \\kappa_{n+1}) = 0$ is met.\n\nThe stress at $n+1$ is related to the trial stress:\n$$ \\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\mathbb{C}:\\Delta\\boldsymbol{\\varepsilon}^p $$\nSince $\\operatorname{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = 0$, the update splits into:\n$$ p_{n+1} = p^{\\mathrm{tr}} $$\n$$ \\mathbf{s}_{n+1} = \\mathbf{s}^{\\mathrm{tr}} - 2\\mu\\Delta\\boldsymbol{\\varepsilon}^p $$\nSubstituting the flow rule $\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta \\gamma \\frac{\\mathbf{s}_{n+1}}{\\|\\mathbf{s}_{n+1}\\|}$:\n$$ \\mathbf{s}_{n+1} = \\mathbf{s}^{\\mathrm{tr}} - 2\\mu\\Delta\\gamma \\frac{\\mathbf{s}_{n+1}}{\\|\\mathbf{s}_{n+1}\\|} $$\nThis relation shows that $\\mathbf{s}_{n+1}$ is collinear with $\\mathbf{s}^{\\mathrm{tr}}$. Taking the norm of both sides yields:\n$$ \\|\\mathbf{s}_{n+1}\\| = \\|\\mathbf{s}^{\\mathrm{tr}}\\| - 2\\mu\\Delta\\gamma $$\nThe final state must lie on the yield surface: $\\|\\mathbf{s}_{n+1}\\| = r(\\kappa_{n+1})$.\nThe updated yield radius is:\n$$ r(\\kappa_{n+1}) = r(\\kappa_n + \\Delta\\kappa) = \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H(\\kappa_n + \\sqrt{\\frac{2}{3}}\\Delta\\gamma)) = r(\\kappa_n) + \\frac{2}{3}H\\Delta\\gamma $$\nEquating the expressions for $\\|\\mathbf{s}_{n+1}\\|$:\n$$ \\|\\mathbf{s}^{\\mathrm{tr}}\\| - 2\\mu\\Delta\\gamma = r(\\kappa_n) + \\frac{2}{3}H\\Delta\\gamma $$\nSolving for the plastic multiplier $\\Delta\\gamma$:\n$$ \\|\\mathbf{s}^{\\mathrm{tr}}\\| - r(\\kappa_n) = (2\\mu + \\frac{2}{3}H)\\Delta\\gamma \\implies \\Delta\\gamma = \\frac{f^{\\mathrm{tr}}}{2\\mu + \\frac{2}{3}H} $$\nWith $\\Delta \\gamma$ known, the state variables are updated:\n- Deviatoric stress: $\\mathbf{s}_{n+1} = \\left(1 - \\frac{2\\mu \\Delta\\gamma}{\\|\\mathbf{s}^{\\mathrm{tr}}\\|}\\right) \\mathbf{s}^{\\mathrm{tr}}$. This is the radial return.\n- Mean stress: $p_{n+1} = p^{\\mathrm{tr}}$.\n- Total stress: $\\boldsymbol{\\sigma}_{n+1} = \\mathbf{s}_{n+1} + p_{n+1}\\mathbf{I}$.\n- Hardening variable: $\\kappa_{n+1} = \\kappa_n + \\sqrt{\\frac{2}{3}}\\Delta\\gamma$.\n\n**Step 4: Final Output Calculation**\nThe required outputs are computed from the final state at $n+1$:\n- `plastic_flag`: A boolean, `True` if $f^{\\mathrm{tr}}  0$.\n- `q_{n+1}`: The von Mises stress, $q_{n+1} = \\sqrt{\\frac{3}{2}}\\|\\mathbf{s}_{n+1}\\|$.\n- `delta_gamma`: The plastic multiplier increment, $\\Delta\\gamma$.\n- `p_{n+1}`: The mean stress, $p_{n+1} = \\frac{1}{3}\\operatorname{tr}(\\boldsymbol{\\sigma}_{n+1})$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_increment(E, nu, sigma_y0, H, kappa_n, delta_eps_mat):\n    \"\"\"\n    Performs a single increment update for a J2 elastoplastic model.\n\n    Args:\n        E (float): Young's modulus in kPa.\n        nu (float): Poisson's ratio.\n        sigma_y0 (float): Initial yield stress in kPa.\n        H (float): Linear isotropic hardening modulus in kPa.\n        kappa_n (float): Accumulated equivalent plastic strain at step n.\n        delta_eps_mat (list of lists): Total strain increment tensor.\n\n    Returns:\n        list: [plastic_flag, q_n+1, delta_gamma, p_n+1]\n    \"\"\"\n    delta_eps = np.array(delta_eps_mat, dtype=float)\n    I = np.eye(3)\n    TOL = 1e-12\n\n    # 1. Material properties\n    mu = E / (2 * (1 + nu))\n    K = E / (3 * (1 - 2 * nu))\n\n    # All tests start with sigma_n = 0, so s_n = 0, p_n = 0.\n    # In a general implementation, s_n and p_n would be inputs.\n    \n    # 2. Elastic predictor\n    trace_delta_eps = np.trace(delta_eps)\n    delta_e = delta_eps - (1/3) * trace_delta_eps * I\n    \n    # Trial stress (since s_n = 0, p_n = 0)\n    s_tr = 2 * mu * delta_e\n    p_tr = K * trace_delta_eps\n    \n    # 3. Check yield condition\n    norm_s_tr = np.linalg.norm(s_tr)\n    \n    # Handle the case of purely hydrostatic strain to avoid division by zero\n    if norm_s_tr  TOL:\n        plastic_flag = False\n        s_n1 = s_tr\n        p_n1 = p_tr\n        delta_gamma = 0.0\n    else:\n        # Yield radius at step n\n        r_n = np.sqrt(2/3) * (sigma_y0 + H * kappa_n)\n        \n        # Trial yield function value\n        f_tr = norm_s_tr - r_n\n\n        if f_tr = TOL:\n            # 4. Elastic update\n            plastic_flag = False\n            s_n1 = s_tr\n            p_n1 = p_tr\n            delta_gamma = 0.0\n        else:\n            # 5. Plastic corrector (radial return)\n            plastic_flag = True\n            \n            # Calculate plastic multiplier\n            delta_gamma = f_tr / (2 * mu + (2/3) * H)\n            \n            # Update deviatoric stress\n            s_n1 = (1 - (2 * mu * delta_gamma) / norm_s_tr) * s_tr\n            \n            # Update hydrostatic pressure\n            p_n1 = p_tr\n            \n            # Note: kappa_n+1 is not explicitly required for outputs but would be:\n            # kappa_n1 = kappa_n + np.sqrt(2/3) * delta_gamma\n\n    # 6. Calculate output quantities at step n+1\n    norm_s_n1 = np.linalg.norm(s_n1)\n    q_n1 = np.sqrt(3/2) * norm_s_n1\n    p_n1 = p_tr # From elastic predictor, as p is unchanged by J2 plasticity\n    \n    return [plastic_flag, q_n1, delta_gamma, p_n1]\n\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1 (elastic, pure shear)\n        (200000, 0.3, 200, 0, 0, [[0, 0.0003, 0], [0.0003, 0, 0], [0, 0, 0]]),\n        # Test 2 (plastic, perfect plasticity)\n        (200000, 0.3, 200, 0, 0, [[0, 0.002, 0], [0.002, 0, 0], [0, 0, 0]]),\n        # Test 3 (plastic, linear isotropic hardening with nonzero prior kappa_n) -> elastic\n        (200000, 0.3, 200, 10000, 0.05, [[0, 0.002, 0], [0.002, 0, 0], [0, 0, 0]]),\n        # Test 4 (purely volumetric, elastic)\n        (200000, 0.3, 200, 5000, 0, [[0.001, 0, 0], [0, 0.001, 0], [0, 0, 0.001]]),\n        # Test 5 (boundary case exactly on yield, treated as elastic)\n        (200000, 0.3, 200, 0, 0, [[0, 0.00075, 0], [0.00075, 0, 0], [0, 0, 0]]),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = run_increment(*case)\n        all_results.append(result)\n\n    # Format the final output string exactly as required\n    formatted_results = []\n    for res in all_results:\n        flag, q, dg, p = res\n        part = f\"[{str(flag)},{q:.6f},{dg:.6f},{p:.6f}]\"\n        formatted_results.append(part)\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the foundational algorithm, this practice introduces concepts crucial for geomaterials: pressure-dependency and non-associated flow. You will work with the Drucker-Prager model, where plastic yielding depends on both shear and mean stresses, and the direction of plastic flow (related to dilation) is independent of the yield criterion. This exercise  simplifies the analysis to the space of stress invariants $(p,q)$, allowing you to focus on the physical and mathematical consequences of non-associativity without the complexity of a full tensorial implementation.",
            "id": "3551085",
            "problem": "Consider a small-strain isotropic elastoplastic model for geomaterials in terms of the stress invariants $(p,q)$, where $p$ is the mean stress and $q$ is a deviatoric stress invariant. The elastic response is defined by the bulk modulus $K$ and the shear modulus $G$, both strictly positive. The material follows a Drucker–Prager-type yield function $f(p,q)$ and a Drucker–Prager-type plastic potential $g(p,q)$, both linear in the invariants:\n- Yield function: $f(p,q) = q + \\alpha\\,p - k$.\n- Plastic potential: $g(p,q) = q + \\beta\\,p$.\n\nHere, $\\alpha$ and $\\beta$ are material parameters (dimensionless) controlling friction and dilatancy, respectively, and $k$ is a stress-like parameter with the same unit as $p$ and $q$. The plastic flow rule is non-associative in general and uses $g$. The geometric normality rule defines plastic flow directions by the gradients with respect to the Cauchy stress tensor $\\boldsymbol{\\sigma}$:\n- Yield normal: $\\boldsymbol{n}_f = \\dfrac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$.\n- Plastic potential normal: $\\boldsymbol{n}_g = \\dfrac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$.\n\nThe flow rule is defined by the backward (implicit) Euler integration:\n- Plastic strain increment: $\\Delta \\boldsymbol{\\varepsilon}^p = \\Delta\\lambda\\,\\boldsymbol{n}_g$ with plastic multiplier $\\Delta\\lambda \\ge 0$.\n- Stress update: $\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}_{\\text{trial}} - \\mathbb{C}:\\Delta \\boldsymbol{\\varepsilon}^p$, where $\\mathbb{C}$ is the isotropic elastic stiffness.\n\nStart from the fundamental definitions of the invariants $p$ and $q$ in terms of $\\boldsymbol{\\sigma}$, the deviatoric stress $\\boldsymbol{s}$, and the second invariant of deviatoric stress $J_2$, and use the chain rule to obtain the gradients $\\partial p/\\partial \\boldsymbol{\\sigma}$ and $\\partial q/\\partial \\boldsymbol{\\sigma}$. From these, derive $\\boldsymbol{n}_f$ and $\\boldsymbol{n}_g$, compute the angle $\\theta = \\angle(\\boldsymbol{n}_f,\\boldsymbol{n}_g)$ in radians using the Euclidean (Frobenius) inner product, and show how this geometric non-association (i.e., $\\boldsymbol{n}_f \\neq \\boldsymbol{n}_g$) impacts the plastic multiplier $\\Delta\\lambda$ in a discrete return mapping on $(p,q)$ for the given Drucker–Prager forms.\n\nImplement a program that:\n1. Computes the angle $\\theta$ between $\\boldsymbol{n}_f$ and $\\boldsymbol{n}_g$ for a given $(\\alpha,\\beta)$ and current stress state.\n2. Performs a one-step backward Euler return mapping in $(p,q)$-space from an elastically predicted trial state $(p_{\\text{trial}},q_{\\text{trial}})$ to the corrected state $(p_{n+1},q_{n+1})$ as follows:\n   - If the trial state is elastic, i.e., $f(p_{\\text{trial}},q_{\\text{trial}}) \\le 0$, then set $\\Delta\\lambda = 0$ and $(p_{n+1},q_{n+1}) = (p_{\\text{trial}},q_{\\text{trial}})$.\n   - If the trial state violates yield, i.e., $f(p_{\\text{trial}},q_{\\text{trial}})  0$, then enforce consistency $f(p_{n+1},q_{n+1})=0$ with the backward Euler flow rule to determine $\\Delta\\lambda$ and the corrected invariants $(p_{n+1},q_{n+1})$.\n3. Outputs, for each test case, the list $[\\Delta\\lambda,\\,p_{n+1},\\,q_{n+1},\\,\\theta]$.\n\nAdopt the following conventions and bases:\n- Mean stress: $p = \\dfrac{1}{3}\\,\\text{tr}(\\boldsymbol{\\sigma})$ (compression taken as positive).\n- Deviatoric stress: $\\boldsymbol{s} = \\boldsymbol{\\sigma} - p\\,\\boldsymbol{I}$.\n- Second invariant: $J_2 = \\dfrac{1}{2}\\,\\boldsymbol{s}:\\boldsymbol{s}$.\n- Deviatoric invariant: $q = \\sqrt{3\\,J_2}$.\n- Use the Frobenius inner product $A:B = \\text{tr}(A^\\top B)$ and the Frobenius norm $\\|A\\| = \\sqrt{A:A}$.\n\nPhysical units:\n- Report all stresses ($p$, $q$, $k$, $K$, $G$) in kilopascals ($\\mathrm{kPa}$).\n- Report the angle $\\theta$ in radians.\n\nNumerical test suite:\nProvide results for the following four test cases, each specified as $(K,G,\\alpha,\\beta,k,p_{\\text{trial}},q_{\\text{trial}})$, with all stresses in $\\mathrm{kPa}$:\n- Case A (general plastic, associated flow): $(50000,\\,30000,\\,0.25,\\,0.25,\\,30,\\,100,\\,60)$.\n- Case B (general plastic, non-associated flow): $(60000,\\,40000,\\,0.35,\\,0.05,\\,70,\\,120,\\,85)$.\n- Case C (elastic, non-associated flow): $(45000,\\,35000,\\,0.20,\\,0.10,\\,50,\\,80,\\,10)$.\n- Case D (on the yield surface, associated flow): $(50000,\\,30000,\\,0.25,\\,0.25,\\,30,\\,100,\\,5)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the four test cases as a comma-separated list of lists enclosed in square brackets, in the order A, B, C, D. For example: \"[[rA1,rA2,rA3,rA4],[rB1,rB2,rB3,rB4],[rC1,rC2,rC3,rC4],[rD1,rD2,rD3,rD4]]\", where each $r\\cdot$ is a float.",
            "solution": "The problem requires the derivation and implementation of a return mapping algorithm for a small-strain isotropic elastoplastic model governed by a linear Drucker–Prager yield criterion and plastic potential. The flow rule is non-associative. The analysis will be performed in the space of stress invariants, namely the mean stress $p$ and the deviatoric stress invariant $q$.\n\nFirst, we will derive the necessary tensorial quantities, specifically the gradients of the yield function and plastic potential with respect to the Cauchy stress tensor $\\boldsymbol{\\sigma}$. Second, we will use these gradients to find the angle of non-association, $\\theta$. Third, we will formulate the backward Euler return mapping algorithm in $(p,q)$ space to update the stress state. Finally, we will implement this algorithm to solve the provided test cases.\n\nThe key definitions are:\n- Mean stress: $p = \\frac{1}{3}\\text{tr}(\\boldsymbol{\\sigma})$\n- Deviatoric stress: $\\boldsymbol{s} = \\boldsymbol{\\sigma} - p\\boldsymbol{I}$\n- Deviatoric stress invariant: $q = \\sqrt{3J_2}$, where $J_2 = \\frac{1}{2}\\boldsymbol{s}:\\boldsymbol{s}$\n- Yield function: $f(p,q) = q + \\alpha p - k$\n- Plastic potential: $g(p,q) = q + \\beta p$\n\n**1. Gradients with respect to the Stress Tensor**\n\nTo determine the yield normal $\\boldsymbol{n}_f = \\partial f / \\partial \\boldsymbol{\\sigma}$ and the plastic potential normal $\\boldsymbol{n}_g = \\partial g / \\partial \\boldsymbol{\\sigma}$, we use the chain rule:\n$$\n\\frac{\\partial H(p,q)}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial H}{\\partial p}\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} + \\frac{\\partial H}{\\partial q}\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}}\n$$\nWe must first compute the gradients of the invariants $p$ and $q$ with respect to $\\boldsymbol{\\sigma}$.\n\nThe gradient of the mean stress $p = \\frac{1}{3}\\text{tr}(\\boldsymbol{\\sigma}) = \\frac{1}{3}\\boldsymbol{\\sigma} : \\boldsymbol{I}$ is:\n$$\n\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{1}{3}\\frac{\\partial (\\boldsymbol{\\sigma} : \\boldsymbol{I})}{\\partial \\boldsymbol{\\sigma}} = \\frac{1}{3}\\boldsymbol{I}\n$$\nwhere $\\boldsymbol{I}$ is the second-order identity tensor.\n\nThe gradient of the deviatoric invariant $q$ is found via the chain rule, assuming $q  0$:\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\sqrt{3J_2} \\right) = \\sqrt{3} \\frac{1}{2\\sqrt{J_2}} \\frac{\\partial J_2}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\frac{\\partial J_2}{\\partial \\boldsymbol{\\sigma}}\n$$\nThe derivative of $J_2 = \\frac{1}{2}\\boldsymbol{s}:\\boldsymbol{s}$ with respect to $\\boldsymbol{\\sigma}$ is a standard result in continuum mechanics: $\\partial J_2 / \\partial \\boldsymbol{\\sigma} = \\boldsymbol{s}$. This can be shown by applying the chain and product rules, noting that $\\text{tr}(\\boldsymbol{s}) = 0$.\nThus, the gradient of $q$ is:\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\boldsymbol{s}\n$$\nNow we can assemble the normals $\\boldsymbol{n}_f$ and $\\boldsymbol{n}_g$.\nFor the yield function $f(p,q) = q + \\alpha p - k$, the partial derivatives are $\\partial f/\\partial p = \\alpha$ and $\\partial f/\\partial q = 1$. The yield normal is:\n$$\n\\boldsymbol{n}_f = \\alpha \\left(\\frac{1}{3}\\boldsymbol{I}\\right) + (1) \\left(\\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\alpha}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\n$$\nFor the plastic potential $g(p,q) = q + \\beta p$, the partial derivatives are $\\partial g/\\partial p = \\beta$ and $\\partial g/\\partial q = 1$. The plastic potential normal, which dictates the direction of plastic flow, is:\n$$\n\\boldsymbol{n}_g = \\beta \\left(\\frac{1}{3}\\boldsymbol{I}\\right) + (1) \\left(\\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\n$$\n\n**2. Angle of Non-Association $\\theta$**\n\nThe angle $\\theta$ between the vectors $\\boldsymbol{n}_f$ and $\\boldsymbol{n}_g$ is a measure of the non-associativity of the flow rule. It is computed using the Frobenius inner product, $\\boldsymbol{A}:\\boldsymbol{B} = \\text{tr}(\\boldsymbol{A}^\\top \\boldsymbol{B})$.\n$$\n\\cos\\theta = \\frac{\\boldsymbol{n}_f : \\boldsymbol{n}_g}{\\|\\boldsymbol{n}_f\\| \\|\\boldsymbol{n}_g\\|}\n$$\nThe inner product is:\n$$\n\\boldsymbol{n}_f : \\boldsymbol{n}_g = \\left(\\frac{\\alpha}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\\right) : \\left(\\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q}\\boldsymbol{s}\\right) = \\frac{\\alpha\\beta}{9}(\\boldsymbol{I}:\\boldsymbol{I}) + \\left(\\frac{3}{2q}\\right)^2(\\boldsymbol{s}:\\boldsymbol{s})\n$$\nUsing the identities $\\boldsymbol{I}:\\boldsymbol{I} = 3$, $\\boldsymbol{s}:\\boldsymbol{I} = \\text{tr}(\\boldsymbol{s}) = 0$, and $\\boldsymbol{s}:\\boldsymbol{s} = 2J_2 = \\frac{2}{3}q^2$, we get:\n$$\n\\boldsymbol{n}_f : \\boldsymbol{n}_g = \\frac{\\alpha\\beta}{9}(3) + \\frac{9}{4q^2}\\left(\\frac{2}{3}q^2\\right) = \\frac{\\alpha\\beta}{3} + \\frac{3}{2}\n$$\nThe squared norms are found by setting $\\beta=\\alpha$ for $\\|\\boldsymbol{n}_f\\|^2$ and using the expression above:\n$$\n\\|\\boldsymbol{n}_f\\|^2 = \\boldsymbol{n}_f : \\boldsymbol{n}_f = \\frac{\\alpha^2}{3} + \\frac{3}{2}\n$$\n$$\n\\|\\boldsymbol{n}_g\\|^2 = \\boldsymbol{n}_g : \\boldsymbol{n}_g = \\frac{\\beta^2}{3} + \\frac{3}{2}\n$$\nThe cosine of the angle is therefore:\n$$\n\\cos\\theta = \\frac{\\frac{\\alpha\\beta}{3} + \\frac{3}{2}}{\\sqrt{\\left(\\frac{\\alpha^2}{3} + \\frac{3}{2}\\right)\\left(\\frac{\\beta^2}{3} + \\frac{3}{2}\\right)}}\n$$\nThis expression depends only on the material parameters $\\alpha$ and $\\beta$, not on the stress state (for $q0$). If flow is associated ($\\alpha=\\beta$), then $\\cos\\theta=1$ and $\\theta=0$.\n\n**3. Backward Euler Return Mapping in $(p,q)$ Space**\n\nThe return mapping algorithm corrects a trial elastic stress state that violates the yield condition, returning it to the yield surface. The stress update is given by the backward Euler scheme:\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}_{\\text{trial}} - \\mathbb{C}:\\Delta \\boldsymbol{\\varepsilon}^p = \\boldsymbol{\\sigma}_{\\text{trial}} - \\Delta\\lambda\\,\\mathbb{C}:\\boldsymbol{n}_g\n$$\nwhere $\\Delta\\lambda \\ge 0$ is the plastic multiplier and $\\boldsymbol{n}_g$ is evaluated at the final state $\\boldsymbol{\\sigma}_{n+1}$.\nFor an isotropic linear elastic material, the stress-strain relation can be decomposed into volumetric and deviatoric parts:\n- $p = K \\varepsilon_v^e$\n- $\\boldsymbol{s} = 2G \\boldsymbol{e}^e$\nwhere $\\varepsilon_v^e$ and $\\boldsymbol{e}^e$ are the elastic volumetric and deviatoric strains.\nThe stress updates from a trial state are:\n- $p_{n+1} = p_{\\text{trial}} - K \\Delta\\varepsilon_v^p$\n- $\\boldsymbol{s}_{n+1} = \\boldsymbol{s}_{\\text{trial}} - 2G \\Delta\\boldsymbol{e}^p$\n\nThe plastic strain increments are derived from the flow rule $\\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\lambda\\,\\boldsymbol{n}_g$:\n- $\\Delta\\varepsilon_v^p = \\text{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\lambda\\,\\text{tr}(\\boldsymbol{n}_g) = \\Delta\\lambda\\,\\text{tr}\\left(\\frac{\\beta}{3}\\boldsymbol{I} + \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1}\\right) = \\Delta\\lambda\\,\\beta$.\n- $\\Delta\\boldsymbol{e}^p = \\text{dev}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\lambda\\,\\text{dev}(\\boldsymbol{n}_g) = \\Delta\\lambda \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1}$.\n\nSubstituting these into the stress updates:\n- $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n- $\\boldsymbol{s}_{n+1} = \\boldsymbol{s}_{\\text{trial}} - 2G \\left( \\Delta\\lambda \\frac{3}{2q_{n+1}}\\boldsymbol{s}_{n+1} \\right) = \\boldsymbol{s}_{\\text{trial}} - \\frac{3G\\Delta\\lambda}{q_{n+1}}\\boldsymbol{s}_{n+1}$\n\nThe deviatoric update reveals that $\\boldsymbol{s}_{n+1}$ and $\\boldsymbol{s}_{\\text{trial}}$ are coaxial: $\\boldsymbol{s}_{n+1}\\left(1 + \\frac{3G\\Delta\\lambda}{q_{n+1}}\\right) = \\boldsymbol{s}_{\\text{trial}}$. Taking the norm of both sides (scaled by $\\sqrt{3/2}$) yields the update rule for $q$:\n- $q_{n+1} + 3G\\Delta\\lambda = q_{\\text{trial}} \\implies q_{n+1} = q_{\\text{trial}} - 3G\\Delta\\lambda$.\n\nWe now have a system of two equations for the corrected state $(p_{n+1}, q_{n+1})$ in terms of the unknown $\\Delta\\lambda$:\n1. $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n2. $q_{n+1} = q_{\\text{trial}} - 3G \\Delta\\lambda$\n\nThe final piece is the consistency condition: the corrected state must lie on the yield surface, i.e., $f(p_{n+1}, q_{n+1}) = 0$.\n$$\nq_{n+1} + \\alpha p_{n+1} - k = 0\n$$\nSubstituting the update expressions:\n$$\n(q_{\\text{trial}} - 3G \\Delta\\lambda) + \\alpha(p_{\\text{trial}} - K \\beta \\Delta\\lambda) - k = 0\n$$\nRearranging to solve for $\\Delta\\lambda$:\n$$\n(q_{\\text{trial}} + \\alpha p_{\\text{trial}} - k) = \\Delta\\lambda (3G + \\alpha K \\beta)\n$$\nThe term in the first parenthesis is the value of the yield function at the trial state, $f_{\\text{trial}} = f(p_{\\text{trial}}, q_{\\text{trial}})$.\n$$\n\\Delta\\lambda = \\frac{f_{\\text{trial}}}{3G + \\alpha K \\beta}\n$$\nThis expression demonstrates how geometric non-association (i.e., $\\beta \\neq \\alpha$) directly influences the magnitude of plastic deformation through the term $\\alpha K \\beta$ in the denominator. For an associated flow rule, this term would be $\\alpha^2 K$.\n\n**4. Algorithmic Summary**\n\nFor a given trial state $(p_{\\text{trial}}, q_{\\text{trial}})$ and material parameters $(K, G, \\alpha, \\beta, k)$:\n\n1.  Calculate the yield function value at the trial state: $f_{\\text{trial}} = q_{\\text{trial}} + \\alpha p_{\\text{trial}} - k$.\n2.  **Elastic Prediction**: If $f_{\\text{trial}} \\le 0$, the state is admissible (elastic or on the boundary). No plastic correction is needed.\n    - $\\Delta\\lambda = 0$\n    - $p_{n+1} = p_{\\text{trial}}$\n    - $q_{n+1} = q_{\\text{trial}}$\n3.  **Plastic Correction**: If $f_{\\text{trial}}  0$, the state is inadmissible and must be returned to the yield surface.\n    - Compute the plastic multiplier: $\\Delta\\lambda = \\frac{f_{\\text{trial}}}{3G + \\alpha K \\beta}$.\n    - Update the stress invariants:\n        - $p_{n+1} = p_{\\text{trial}} - K \\beta \\Delta\\lambda$\n        - $q_{n+1} = q_{\\text{trial}} - 3G \\Delta\\lambda$\n4.  Compute the angle of non-association $\\theta$ in radians:\n    $$\n    \\theta = \\arccos\\left(\\frac{\\frac{\\alpha\\beta}{3} + 1.5}{\\sqrt{\\left(\\frac{\\alpha^2}{3} + 1.5\\right)\\left(\\frac{\\beta^2}{3} + 1.5\\right)}}\\right)\n    $$\nThe final output for each case is the list $[\\Delta\\lambda, p_{n+1}, q_{n+1}, \\theta]$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Drucker-Prager return mapping problem for a suite of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (K, G, alpha, beta, k, p_trial, q_trial)\n    # Stresses are in kPa.\n    test_cases = [\n        # Case A: general plastic, associated flow\n        (50000.0, 30000.0, 0.25, 0.25, 30.0, 100.0, 60.0),\n        # Case B: general plastic, non-associated flow\n        (60000.0, 40000.0, 0.35, 0.05, 70.0, 120.0, 85.0),\n        # Case C: elastic, non-associated flow\n        (45000.0, 35000.0, 0.20, 0.10, 50.0, 80.0, 10.0),\n        # Case D: on the yield surface, associated flow\n        (50000.0, 30000.0, 0.25, 0.25, 30.0, 100.0, 5.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Using str() on a list automatically creates the bracketed format.\n    # Joining these with commas and wrapping in outer brackets gives the desired output.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _solve_case(K, G, alpha, beta, k, p_trial, q_trial):\n    \"\"\"\n    Performs a one-step backward Euler return mapping for a non-associative\n    Drucker-Prager model.\n\n    Args:\n        K (float): Bulk modulus (kPa).\n        G (float): Shear modulus (kPa).\n        alpha (float): Friction parameter (dimensionless).\n        beta (float): Dilatancy parameter (dimensionless).\n        k (float): Cohesion-related parameter (kPa).\n        p_trial (float): Trial mean stress (kPa).\n        q_trial (float): Trial deviatoric stress (kPa).\n\n    Returns:\n        list: A list containing [delta_lambda, p_n+1, q_n+1, theta].\n    \"\"\"\n    # 1. Calculate the angle of non-association, theta\n    # This calculation is independent of the stress state, only depends on alpha and beta\n    # cos(theta) = (n_f : n_g) / (||n_f|| * ||n_g||)\n    # n_f : n_g = alpha*beta/3 + 3/2\n    # ||n_f||^2 = alpha^2/3 + 3/2\n    # ||n_g||^2 = beta^2/3 + 3/2\n    \n    num = alpha * beta / 3.0 + 1.5\n    den1 = alpha**2 / 3.0 + 1.5\n    den2 = beta**2 / 3.0 + 1.5\n    \n    # Handle the case where the denominator might be zero, although with G,K > 0 this is not expected\n    # and the term 1.5 ensures positivity.\n    cos_theta = num / np.sqrt(den1 * den2)\n    # Clip to handle potential floating-point inaccuracies leading to |cos_theta| > 1\n    cos_theta = np.clip(cos_theta, -1.0, 1.0)\n    theta = np.arccos(cos_theta)\n\n    # 2. Check for yielding\n    # Yield function: f(p,q) = q + alpha*p - k\n    f_trial = q_trial + alpha * p_trial - k\n\n    delta_lambda = 0.0\n    p_new = p_trial\n    q_new = q_trial\n\n    # 3. Perform plastic correction if necessary (return mapping)\n    if f_trial > 0:\n        # Denominator H_denom = 3G + alpha*K*beta\n        H_denom = 3.0 * G + alpha * K * beta\n        \n        if H_denom = 0:\n            # This case is physically unexpected for K>0, G>0\n            # and non-negative parameters but included for robustness.\n            # It indicates a material softening that the current model does not handle.\n            # We treat it as an error or by simply letting the state be elastic.\n            pass\n        else:\n            # Calculate the plastic multiplier\n            delta_lambda = f_trial / H_denom\n\n            # Update the stress invariants\n            p_new = p_trial - K * beta * delta_lambda\n            q_new = q_trial - 3.0 * G * delta_lambda\n\n            # Ensure q_new is not negative (can happen with large steps)\n            if q_new  0:\n                q_new = 0.0\n    \n    return [delta_lambda, p_new, q_new, theta]\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice elevates your understanding to an advanced, research-relevant level by exploring a more sophisticated constitutive model. You will investigate a hybrid Drucker-Prager model where the degree of non-association is dependent on the confining pressure, a feature that better captures the behavior of many real-world geomaterials. The core task in this exercise  is to analyze the mathematical continuity of the plastic flow direction and the resulting algorithmic tangent operator, a critical consideration for ensuring the robustness and quadratic convergence of implicit finite element simulations.",
            "id": "3551067",
            "problem": "Consider an isotropic, small-strain, pressure-dependent elastoplastic material model in three dimensions, expressed in terms of the Cauchy stress tensor $\\sigma \\in \\mathbb{R}^{3 \\times 3}$, with the following definitions and assumptions as the fundamental base:\n\n1. Elasticity is linear and isotropic, with bulk modulus $K$ and shear modulus $G$. The elastic operator $\\mathbb{C}^{\\text{e}}$ maps a symmetric second-order tensor $X$ to stress increments according to\n$$\n\\mathbb{C}^{\\text{e}} : X = K \\, \\text{tr}(X) \\, \\mathbf{I} + 2 G \\, \\text{dev}(X),\n$$\nwhere $\\mathbf{I}$ is the second-order identity tensor, $\\text{tr}(\\cdot)$ denotes the trace, and $\\text{dev}(X) = X - \\tfrac{1}{3} \\text{tr}(X) \\, \\mathbf{I}$ is the deviatoric projection.\n\n2. The pressure (mean stress) invariant $p$, the deviatoric stress $s$, and the second invariant measure $q$ are defined by\n$$\np = \\tfrac{1}{3} \\, \\text{tr}(\\sigma), \\quad s = \\sigma - p \\, \\mathbf{I}, \\quad q = \\sqrt{\\tfrac{3}{2}} \\, \\|s\\|_F,\n$$\nwhere $\\|\\cdot\\|_F$ is the Frobenius norm.\n\n3. The yield function is of Drucker–Prager type,\n$$\nf(\\sigma,\\kappa) = q + \\alpha \\, p - k(\\kappa),\n$$\nwith $\\alpha$ a material constant, $\\kappa$ a hardening variable, and $k(\\kappa)$ a hardening stress. You may assume a constant plastic modulus $H \\ge 0$ defined by the linearization of the consistency condition such that the return-mapping linearization uses a scalar hardening term $H$.\n\n4. The plastic potential is taken as\n$$\ng(\\sigma) = q + \\alpha_g(p) \\, p,\n$$\nwhere $\\alpha_g(p)$ transitions from the associated case $\\alpha_g = \\alpha$ at low $p$ to a non-associated value $\\alpha_g = \\alpha_{\\text{na}}$ at high $p$. The function $\\alpha_g(p)$ is constructed by blending\n$$\n\\alpha_g(p) = (1 - w(p)) \\, \\alpha + w(p) \\, \\alpha_{\\text{na}},\n$$\nwith a scalar transition function $w(p)$ that depends only on $p$.\n\n5. The plastic flow rule is non-associated in general, with plastic flow direction given by\n$$\nn_g(\\sigma) = \\frac{\\partial g}{\\partial \\sigma}.\n$$\n\n6. The algorithmic elastoplastic tangent operator $\\mathbb{C}^{\\text{alg}}$ is defined as the consistent linearization of the stress update returned by the classical return-mapping algorithm for rate-independent plasticity:\n$$\nd\\sigma = \\mathbb{C}^{\\text{e}} : \\left(d\\varepsilon - d\\gamma \\, \\frac{\\partial g}{\\partial \\sigma} \\right), \\quad\n0 = \\frac{\\partial f}{\\partial \\sigma} : d\\sigma + H \\, d\\gamma,\n$$\nwhere $d\\varepsilon$ is the infinitesimal strain increment and $d\\gamma$ is the plastic multiplier increment. The consistent tangent is the linear map such that $d\\sigma = \\mathbb{C}^{\\text{alg}} : d\\varepsilon$.\n\nYour task is to implement a hybrid model in which $w(p)$ controls the transition of the plastic potential from associated at low $p$ to non-associated at high $p$, and to investigate the continuity of both the plastic flow direction $n_g$ and the algorithmic tangent $\\mathbb{C}^{\\text{alg}}$ across the transition. Start from the above fundamental definitions and derive all intermediate relations you need. In particular, use the chain rule to obtain $\\partial g / \\partial \\sigma$ when $\\alpha_g$ depends on $p(\\sigma)$, and use the return-mapping linearization to obtain a computable form of $\\mathbb{C}^{\\text{alg}}$ in terms of $\\mathbb{C}^{\\text{e}}$, $\\partial f / \\partial \\sigma$, $\\partial g / \\partial \\sigma$, and $H$.\n\nContinuity investigation protocol:\n\n- For a given stress state with prescribed $p$ and deviatoric stress $s$ (hence $q$), define two nearby states with pressures $p^{-} = p - h$ and $p^{+} = p + h$ for a small $h  0$, keeping $s$ fixed. Evaluate\n$$\nJ_n = \\left\\| n_g(\\sigma^{+}) - n_g(\\sigma^{-}) \\right\\|_F,\n$$\nwhich measures the jump in the flow direction, and\n$$\nJ_C = \\frac{ \\left\\| \\mathbb{C}^{\\text{alg}}(\\cdot) \\big|_{p^{+}} - \\mathbb{C}^{\\text{alg}}(\\cdot) \\big|_{p^{-}} \\right\\| }{K},\n$$\na dimensionless jump in the algorithmic tangent, where $\\|\\cdot\\|$ for a fourth-order operator is the Frobenius norm induced by the Frobenius norm on symmetric second-order tensors. The normalization by $K$ makes $J_C$ dimensionless. You should compute this operator norm by applying the operator difference to an orthonormal basis of symmetric second-order tensors and summing the squared Frobenius norms of the images.\n\nTransition functions to test:\n\n- Sharp step: $w_{\\text{step}}(p) = 0$ for $p  p_t$ and $w_{\\text{step}}(p) = 1$ for $p \\ge p_t$.\n- Piecewise linear ramp: $w_{\\text{ramp}}(p) = 0$ for $p \\le p_1$, $w_{\\text{ramp}}(p) = \\dfrac{p - p_1}{p_2 - p_1}$ for $p \\in (p_1,p_2)$, and $w_{\\text{ramp}}(p) = 1$ for $p \\ge p_2$.\n- Smooth $C^1$ cubic transition: $w_{\\text{cubic}}(p) = 0$ for $p \\le p_1$, $w_{\\text{cubic}}(p) = 3 \\xi^2 - 2 \\xi^3$ for $p \\in (p_1,p_2)$ with $\\xi = \\dfrac{p - p_1}{p_2 - p_1}$, and $w_{\\text{cubic}}(p) = 1$ for $p \\ge p_2$.\n\nUse the following material parameters and stress-state construction for all tests unless stated otherwise:\n\n- Elastic moduli: $K = 3.0 \\times 10^4$, $G = 1.5 \\times 10^4$ (consistent stress units; outputs will be normalized to be dimensionless).\n- Yield parameter: $\\alpha = 0.2$; non-associated parameter at high pressure: $\\alpha_{\\text{na}} = 0.1$.\n- Plastic modulus: $H = 5.0 \\times 10^3$.\n- Transition bounds: $p_1 = 90$, $p_2 = 110$, $p_t = 100$; perturbation size $h = 10^{-8}$.\n- Deviatoric stress shape: $s = \\text{diag}(2a, -a, -a)$ with $a = q_0/3$, so that $q = 3|a| = q_0$. Unless otherwise noted, take $q_0 = 40$. For the hydrostatic-edge test, use $q_0 = 10^{-8}$.\n\nTest suite:\n\n1. Sharp step at $p_t$: $w = w_{\\text{step}}$, $p = p_t$, $q_0 = 40$.\n2. Piecewise linear at the lower bound: $w = w_{\\text{ramp}}$, $p = p_1$, $q_0 = 40$.\n3. Piecewise linear at the upper bound: $w = w_{\\text{ramp}}$, $p = p_2$, $q_0 = 40$.\n4. Smooth cubic at the lower bound: $w = w_{\\text{cubic}}$, $p = p_1$, $q_0 = 40$.\n5. Smooth cubic at the upper bound with near-hydrostatic state: $w = w_{\\text{cubic}}$, $p = p_2$, $q_0 = 10^{-8}$.\n\nComputational requirements and conventions:\n\n- Implement robust handling of the derivative $\\partial q/\\partial \\sigma$ at $q \\approx 0$ by regularization with a small positive threshold $\\varepsilon_q$, for example by using $q_{\\text{reg}} = \\max(q, \\varepsilon_q)$ in denominators.\n- Use $\\partial p/\\partial \\sigma = \\mathbf{I}/3$ and \n$$\n\\frac{\\partial q}{\\partial \\sigma} = \\frac{3}{2 q_{\\text{reg}}} \\, s.\n$$\n- Apply the product and chain rules to account for $\\alpha_g(p(\\sigma))$ in $\\partial g / \\partial \\sigma$.\n- Derive and implement the algorithmic tangent $\\mathbb{C}^{\\text{alg}}$ from the linearized return-mapping equations stated above, and compute its Frobenius norm jump $J_C$ using an orthonormal basis of symmetric second-order tensors.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a list of five sublists, each sublist containing the two floats $[J_n, J_C]$ for the corresponding test in the order listed above. The line must be exactly a Python-style list with no extra text, for example: [[Jn1,Jc1],[Jn2,Jc2],[Jn3,Jc3],[Jn4,Jc4],[Jn5,Jc5]].\n- All reported numbers must be pure dimensionless floats. No physical units or angle units are required in the output. Percentages, if any, must be expressed as decimals and not with a percent sign.",
            "solution": "The user's request is a well-posed problem in computational geomechanics. It is scientifically grounded, self-contained, and objective. The problem requires the derivation and implementation of a non-associated elastoplastic model with a pressure-dependent plastic potential to investigate the continuity of the plastic flow direction and the algorithmic tangent operator. All necessary data and functional forms are provided. The problem is deemed valid.\n\n### 1. Theoretical Formulation\n\nThe problem is centered around an isotropic, pressure-dependent elastoplastic material. We will first derive the necessary quantities: the plastic flow direction, $\\boldsymbol{n}_g$, and the algorithmic tangent operator, $\\mathbb{C}^{\\text{alg}}$.\n\n#### 1.1 Plastic Flow Direction $\\boldsymbol{n}_g$\n\nThe plastic potential $g$ is given by:\n$$\ng(\\boldsymbol{\\sigma}) = q + \\alpha_g(p) \\, p\n$$\nwhere $p = \\frac{1}{3} \\text{tr}(\\boldsymbol{\\sigma})$ is the pressure, $q = \\sqrt{\\frac{3}{2}} \\|\\boldsymbol{s}\\|_F$ is the second invariant of deviatoric stress $\\boldsymbol{s}$, and $\\alpha_g(p)$ is a pressure-dependent material function. The plastic flow direction is defined as the gradient of the potential with respect to stress, $\\boldsymbol{n}_g = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$.\n\nUsing the chain rule, we have:\n$$\n\\boldsymbol{n}_g = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\frac{\\partial (\\alpha_g(p) \\, p)}{\\partial \\boldsymbol{\\sigma}}\n$$\nWe need to compute the individual derivatives. The derivative of the pressure $p$ with respect to $\\boldsymbol{\\sigma}$ is:\n$$\n\\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\frac{1}{3} \\boldsymbol{\\sigma} : \\mathbf{I} \\right) = \\frac{1}{3} \\mathbf{I}\n$$\nThe derivative of the deviatoric stress invariant $q$ is given in the problem statement, with a regularization for the case $q \\to 0$:\n$$\n\\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s}, \\quad \\text{where } q_{\\text{reg}} = \\max(q, \\varepsilon_q)\n$$\nfor a small positive threshold $\\varepsilon_q$.\n\nThe second term requires the chain rule for the product $\\alpha_g(p)p$ with respect to $\\boldsymbol{\\sigma}$:\n$$\n\\frac{\\partial (\\alpha_g(p) \\, p)}{\\partial \\boldsymbol{\\sigma}} = \\frac{d (\\alpha_g(p) \\, p)}{d p} \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}}\n$$\nThe derivative with respect to pressure is:\n$$\n\\frac{d (\\alpha_g(p) \\, p)}{d p} = \\alpha_g(p) \\frac{dp}{dp} + p \\frac{d\\alpha_g}{dp} = \\alpha_g(p) + p \\frac{d\\alpha_g}{dp}\n$$\nThe function $\\alpha_g(p)$ is defined as a blend: $\\alpha_g(p) = (1 - w(p)) \\, \\alpha + w(p) \\, \\alpha_{\\text{na}}$. Its derivative is:\n$$\n\\frac{d\\alpha_g}{dp} = -\\alpha \\frac{dw}{dp} + \\alpha_{\\text{na}} \\frac{dw}{dp} = (\\alpha_{\\text{na}} - \\alpha) \\frac{dw}{dp}\n$$\nwhere $\\frac{dw}{dp}$ is denoted as $w'(p)$. Substituting this back, we get:\n$$\n\\frac{d (\\alpha_g(p) \\, p)}{d p} = \\alpha_g(p) + p (\\alpha_{\\text{na}} - \\alpha) w'(p)\n$$\nCombining everything, the plastic flow direction $\\boldsymbol{n}_g$ is:\n$$\n\\boldsymbol{n}_g(\\boldsymbol{\\sigma}) = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s} + \\left[ \\alpha_g(p) + p (\\alpha_{\\text{na}} - \\alpha) w'(p) \\right] \\frac{1}{3} \\mathbf{I}\n$$\nThe continuity of $\\boldsymbol{n}_g$ is contingent on the continuity of its components. Since $\\boldsymbol{s}$, $p$, and $\\alpha_g(p)$ (which depends on $w(p)$) are continuous functions of $\\boldsymbol{\\sigma}$ for the chosen blending functions, the continuity of $\\boldsymbol{n}_g$ depends critically on the continuity of $w'(p)$. If $w'(p)$ is discontinuous, $\\boldsymbol{n}_g$ will exhibit a jump discontinuity.\n\n#### 1.2 Algorithmic Tangent Operator $\\mathbb{C}^{\\text{alg}}$\n\nThe problem provides the linearized consistency and flow rule equations to define the tangent operator:\n$$\nd\\boldsymbol{\\sigma} = \\mathbb{C}^{\\text{e}} : (d\\boldsymbol{\\varepsilon} - d\\gamma \\, \\boldsymbol{n}_g)\n$$\n$$\n0 = \\boldsymbol{n}_f : d\\boldsymbol{\\sigma} + H \\, d\\gamma\n$$\nwhere $\\boldsymbol{n}_f = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$ is the gradient of the yield function $f(\\boldsymbol{\\sigma},\\kappa) = q + \\alpha p - k(\\kappa)$, and $H$ is the plastic modulus. The yield surface normal is:\n$$\n\\boldsymbol{n}_f = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\alpha \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2 q_{\\text{reg}}} \\boldsymbol{s} + \\frac{\\alpha}{3} \\mathbf{I}\n$$\nSubstituting the first equation into the second yields:\n$$\n0 = \\boldsymbol{n}_f : [\\mathbb{C}^{\\text{e}} : (d\\boldsymbol{\\varepsilon} - d\\gamma \\, \\boldsymbol{n}_g)] + H \\, d\\gamma = (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon} - d\\gamma (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) + H \\, d\\gamma\n$$\nSolving for the plastic multiplier increment $d\\gamma$:\n$$\nd\\gamma = \\frac{(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon}}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g}\n$$\nSubstituting $d\\gamma$ back into the expression for $d\\boldsymbol{\\sigma}$:\n$$\nd\\boldsymbol{\\sigma} = \\mathbb{C}^{\\text{e}} : d\\boldsymbol{\\varepsilon} - \\mathbb{C}^{\\text{e}} : \\left( \\boldsymbol{n}_g \\frac{(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) : d\\boldsymbol{\\varepsilon}}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g} \\right) = \\left[ \\mathbb{C}^{\\text{e}} - \\frac{(\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) \\otimes (\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}})}{H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g} \\right] : d\\boldsymbol{\\varepsilon}\n$$\nThe term in the brackets is the algorithmic tangent operator $\\mathbb{C}^{\\text{alg}}$. Note that this is the continuum tangent, often used as an approximation to the true consistent algorithmic tangent for simplicity, as implied by the problem statement.\n$$\n\\mathbb{C}^{\\text{alg}} = \\mathbb{C}^{\\text{e}} - \\frac{1}{A} (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g) \\otimes (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f)\n$$\nwhere $A = H + \\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g$ and we have used the major symmetry of $\\mathbb{C}^{\\text{e}}$, so $(\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}}) = (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f)$.\n\nThe continuity of $\\mathbb{C}^{\\text{alg}}$ depends on the continuity of $\\boldsymbol{n}_f$ and $\\boldsymbol{n}_g$. Since $\\boldsymbol{n}_f$ is continuous for $q  0$, the continuity of $\\mathbb{C}^{\\text{alg}}$ also hinges on the continuity of $\\boldsymbol{n}_g$, and thus on the continuity of $w(p)$ and $w'(p)$.\n\nThe elastic operator $\\mathbb{C}^{\\text{e}}$ acting on a second-order tensor $\\boldsymbol{X}$ is $\\mathbb{C}^{\\text{e}} : \\boldsymbol{X} = K \\, \\text{tr}(\\boldsymbol{X}) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{X})$. The terms in $\\mathbb{C}^{\\text{alg}}$ can be calculated as:\n- $\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g = K \\, \\text{tr}(\\boldsymbol{n}_g) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{n}_g)$\n- $\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_f = K \\, \\text{tr}(\\boldsymbol{n}_f) \\, \\mathbf{I} + 2G \\, \\text{dev}(\\boldsymbol{n}_f)$\n- $\\boldsymbol{n}_f : \\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g = \\text{tr}(\\boldsymbol{n}_f^T (\\mathbb{C}^{\\text{e}} : \\boldsymbol{n}_g)) = K \\, \\text{tr}(\\boldsymbol{n}_f) \\text{tr}(\\boldsymbol{n}_g) + 2G \\, \\text{tr}(\\text{dev}(\\boldsymbol{n}_f) \\text{dev}(\\boldsymbol{n}_g))$\n\n#### 1.3 Continuity Analysis and Jump Metrics\n\nThe problem requires computing two jump metrics, $J_n$ and $J_C$, across a pressure point $p$. We evaluate the relevant quantities at $p^{-} = p - h$ and $p^{+} = p + h$.\n$$\nJ_n = \\|\\boldsymbol{n}_g(\\boldsymbol{\\sigma}^{+}) - \\boldsymbol{n}_g(\\boldsymbol{\\sigma}^{-})\\|_F\n$$\n$$\nJ_C = \\frac{\\|\\mathbb{C}^{\\text{alg}}(p^{+}) - \\mathbb{C}^{\\text{alg}}(p^{-})\\|_F}{K}\n$$\nThe Frobenius norm of the fourth-order operator difference $\\Delta\\mathbb{C} = \\mathbb{C}^{\\text{alg}}(p^{+}) - \\mathbb{C}^{\\text{alg}}(p^{-})$ is computed using an orthonormal basis $\\{\\mathbf{E}_i\\}_{i=1}^6$ for the space of symmetric second-order tensors:\n$$\n\\|\\Delta\\mathbb{C}\\|_F^2 = \\sum_{i=1}^6 \\|\\Delta\\mathbb{C} : \\mathbf{E}_i\\|_F^2\n$$\nThe chosen basis consists of one volumetric tensor and five deviatoric tensors.\n\n### 2. Analysis of Transition Functions\n\n1.  **Sharp step ($w_{\\text{step}}$):** At $p = p_t$, $w(p)$ is discontinuous. Its derivative $w'(p)$ is a Dirac delta function. When evaluating at $p_t \\pm h$, $w$ jumps from $0$ to $1$, while $w'$ is $0$ at both points. The term $\\alpha_g(p)$ in $\\boldsymbol{n}_g$ jumps, causing a discontinuity in $\\boldsymbol{n}_g$ and consequently in $\\mathbb{C}^{\\text{alg}}$. We expect $J_n  0$ and $J_C  0$.\n\n2.  **Piecewise linear ramp ($w_{\\text{ramp}}$):** $w(p)$ is continuous ($C^0$), but its derivative $w'(p)$ is piecewise constant and has jump discontinuities at $p = p_1$ and $p = p_2$. The term $p(\\alpha_{\\text{na}}-\\alpha)w'(p)$ in $\\boldsymbol{n}_g$ is therefore discontinuous. We expect $J_n  0$ and $J_C  0$ at both $p_1$ and $p_2$.\n\n3.  **Smooth cubic ($w_{\\text{cubic}}$):** This function is designed to be $C^1$ continuous. Both $w(p)$ and $w'(p)$ are continuous everywhere, including at the transition boundaries $p_1$ and $p_2$. Crucially, a smooth cubic Hermite spline of the form $3\\xi^2 - 2\\xi^3$ has zero derivatives at its endpoints ($\\xi = 0$ and $\\xi = 1$). Therefore, $w'(p_1)=0$ and $w'(p_2)=0$. As a result, $\\boldsymbol{n}_g$ is continuous, and consequently, $\\mathbb{C}^{\\text{alg}}$ is also continuous. For this case, we expect $J_n$ and $J_C$ to be close to zero (non-zero only due to numerical precision and higher-order effects of the finite perturbation $h$).\n\nThe implementation will now follow this theoretical framework.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating continuity jumps for five test cases.\n    \"\"\"\n\n    # --- Material and simulation parameters from the problem statement ---\n    K = 3.0e4\n    G = 1.5e4\n    alpha = 0.2\n    alpha_na = 0.1\n    H = 5.0e3\n    p1 = 90.0\n    p2 = 110.0\n    pt = 100.0\n    h = 1.0e-8\n    eps_q = 1.0e-12 # Regularization parameter for q derivatives\n\n    # --- Orthonormal basis for symmetric 3x3 tensors ---\n    I = np.eye(3)\n    E_basis = [\n        I / np.sqrt(3.0),\n        np.diag([1.0, -1.0, 0.0]) / np.sqrt(2.0),\n        np.diag([1.0, 1.0, -2.0]) / np.sqrt(6.0),\n        np.array([[0, 1, 0], [1, 0, 0], [0, 0, 0]]) / np.sqrt(2.0),\n        np.array([[0, 0, 1], [0, 0, 0], [1, 0, 0]]) / np.sqrt(2.0),\n        np.array([[0, 0, 0], [0, 0, 1], [0, 1, 0]]) / np.sqrt(2.0),\n    ]\n\n    # --- Transition functions and their derivatives ---\n    def w_step(p):\n        return 1.0 if p >= pt else 0.0\n    def w_prime_step(p):\n        return 0.0 # Derivative is zero everywhere except at the jump\n    \n    def w_ramp(p):\n        if p = p1: return 0.0\n        if p >= p2: return 1.0\n        return (p - p1) / (p2 - p1)\n    def w_prime_ramp(p):\n        if p = p1 or p >= p2: return 0.0\n        return 1.0 / (p2 - p1)\n\n    def w_cubic(p):\n        if p = p1: return 0.0\n        if p >= p2: return 1.0\n        xi = (p - p1) / (p2 - p1)\n        return 3.0 * xi**2 - 2.0 * xi**3\n    def w_prime_cubic(p):\n        if p = p1 or p >= p2: return 0.0\n        xi = (p - p1) / (p2 - p1)\n        d_xi_dp = 1.0 / (p2 - p1)\n        return (6.0 * xi - 6.0 * xi**2) * d_xi_dp\n    \n    # --- Function to compute jumps ---\n    def calculate_jumps(p_center, q0, w_func, w_prime_func):\n        \"\"\"\n        Computes the jumps Jn and Jc for a given stress state and transition function.\n        \"\"\"\n        \n        def get_quantities_at_p(p_val, q0_val):\n            \"\"\"Helper to compute n_g, n_f, and C_alg operator at a given p.\"\"\"\n            # Stress state construction\n            a = q0_val / 3.0\n            s = np.diag([2.0*a, -a, -a])\n            sigma = s + p_val * I\n            q = np.sqrt(1.5) * np.linalg.norm(s, 'fro')\n            q_reg = max(q, eps_q)\n\n            # --- n_g: Plastic flow direction ---\n            w = w_func(p_val)\n            w_prime = w_prime_func(p_val)\n            alpha_g = (1.0 - w) * alpha + w * alpha_na\n            \n            d_alphagp_dp = alpha_g + p_val * (alpha_na - alpha) * w_prime\n            \n            dq_dsigma = (3.0 / (2.0 * q_reg)) * s\n            dp_dsigma = I / 3.0\n            \n            n_g = dq_dsigma + d_alphagp_dp * dp_dsigma\n\n            # --- n_f: Yield surface normal ---\n            n_f = dq_dsigma + (alpha / 3.0) * I\n\n            # --- C_alg: Algorithmic tangent operator (as a function) ---\n            tr_ng = np.trace(n_g)\n            dev_ng = n_g - (tr_ng / 3.0) * I\n            Ce_ng = K * tr_ng * I + 2.0 * G * dev_ng\n\n            tr_nf = np.trace(n_f)\n            dev_nf = n_f - (tr_nf / 3.0) * I\n            \n            # Using tr(A*B.T) for A:B\n            nf_Ce_ng = K * tr_nf * tr_ng + 2.0 * G * np.sum(dev_nf * dev_ng)\n            A = H + nf_Ce_ng\n\n            def C_e(X):\n                tr_X = np.trace(X)\n                dev_X = X - (tr_X / 3.0) * I\n                return K * tr_X * I + 2.0 * G * dev_X\n\n            def C_alg(X):\n                # We need nf:Ce:X = tr(nf * (Ce:X))\n                Ce_X = C_e(X)\n                nf_Ce_X = np.sum(n_f * Ce_X)\n                plastic_part = (1.0 / A) * np.outer(Ce_ng, nf_Ce_X).reshape(3,3,-1)[:,:,0] # Hack for outer product result shape\n                \n                # Correct calculation for outer product term\n                # (C^e:n_g) is a 2nd order tensor. (n_f:C^e) is a 2nd order tensor\n                # We need (C^e:n_g) tensorial product (C^e:n_f)\n                # But the formula is (C^e:n_g) tensorial product (n_f:C^e) acting on d_eps\n                # which is equivalent to (C^e:n_g) * ((n_f:C^e):d_eps)\n                # Let's fix C_alg\n                nf_Ce = K * tr_nf * I + 2.0 * G * dev_nf\n                nf_Ce_X_scalar = np.sum(nf_Ce * X)\n                plastic_term = (1.0 / A) * Ce_ng * nf_Ce_X_scalar\n                return C_e(X) - plastic_term\n\n            return n_g, C_alg\n\n        # Evaluate at p-h and p+h\n        p_minus, p_plus = p_center - h, p_center + h\n        n_g_minus, C_alg_minus_func = get_quantities_at_p(p_minus, q0)\n        n_g_plus, C_alg_plus_func = get_quantities_at_p(p_plus, q0)\n\n        # 1. Compute jump in n_g\n        J_n = np.linalg.norm(n_g_plus - n_g_minus, 'fro')\n\n        # 2. Compute jump in C_alg\n        sum_sq_norms = 0.0\n        for E in E_basis:\n            delta_C_E = C_alg_plus_func(E) - C_alg_minus_func(E)\n            sum_sq_norms += np.linalg.norm(delta_C_E, 'fro')**2\n        \n        norm_delta_C = np.sqrt(sum_sq_norms)\n        J_C = norm_delta_C / K\n\n        return [J_n, J_C]\n\n    # --- Test suite execution ---\n    test_cases = [\n        # 1. Sharp step at pt\n        {'p_center': pt, 'q0': 40.0, 'w_func': w_step, 'w_prime_func': w_prime_step},\n        # 2. Piecewise linear at p1\n        {'p_center': p1, 'q0': 40.0, 'w_func': w_ramp, 'w_prime_func': w_prime_ramp},\n        # 3. Piecewise linear at p2\n        {'p_center': p2, 'q0': 40.0, 'w_func': w_ramp, 'w_prime_func': w_prime_ramp},\n        # 4. Smooth cubic at p1\n        {'p_center': p1, 'q0': 40.0, 'w_func': w_cubic, 'w_prime_func': w_prime_cubic},\n        # 5. Smooth cubic at p2 with near-hydrostatic state\n        {'p_center': p2, 'q0': 1.0e-8, 'w_func': w_cubic, 'w_prime_func': w_prime_cubic},\n    ]\n\n    results = []\n    for case in test_cases:\n        jumps = calculate_jumps(case['p_center'], case['q0'], case['w_func'], case['w_prime_func'])\n        results.append(jumps)\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```"
        }
    ]
}