{
    "hands_on_practices": [
        {
            "introduction": "The elegant simplicity of the Karush-Kuhn-Tucker (KKT) conditions, such as $f \\le 0$, belies the subtleties of their numerical implementation. In finite precision arithmetic, deciding if a trial stress state is \"on\" or \"inside\" the yield surface requires tolerances, which can inadvertently blur the sharp line between elastic and plastic behavior. This first practice exercise provides a direct way to explore this fundamental challenge, asking you to compare a theoretically strict KKT-based check with a tolerance-based one in a simple 1D context, and to quantify the errors that arise from incorrect classification.",
            "id": "3539935",
            "problem": "Consider small-strain, rate-independent, one-dimensional elastoplasticity with linear isotropic elasticity and ideal (perfect) plasticity. Let Young's modulus be denoted by $E$ and the tensile yield stress by $\\sigma_{y}$. The body is subjected to a single strain increment from a stress-free and plastic-strain-free state. The elastoplastic model is defined by:\n- Elastic law: $\\sigma = E\\left(\\varepsilon - \\varepsilon^{p}\\right)$, where $\\sigma$ is the Cauchy stress, $\\varepsilon$ is the total strain, and $\\varepsilon^{p}$ is the plastic strain.\n- Yield function: $f(\\sigma) = \\lvert \\sigma \\rvert - \\sigma_{y} \\le 0$.\n- Karush-Kuhn-Tucker (KKT) conditions in incremental form: $\\Delta\\lambda \\ge 0$, $f(\\sigma) \\le 0$, and $\\Delta\\lambda\\, f(\\sigma) = 0$; together with the associated flow rule $\\Delta\\varepsilon^{p} = \\Delta\\lambda\\, \\partial f / \\partial \\sigma$.\n- Elastic trial state (predictor): $\\sigma^{\\text{tr}} = E\\left(\\varepsilon - \\varepsilon^{p}_{n}\\right)$, with $\\varepsilon^{p}_{n}$ the plastic strain at the start of the increment.\n\nA stress update algorithm must decide whether the step is elastic/unloading (stay on the elastic branch with $\\Delta\\lambda=0$) or plastic/loading (perform a return mapping to enforce $f(\\sigma)=0$). In exact theory, the branch selection is governed by the KKT conditions and the consistency principle. In numerical implementations, a scalar tolerance is often introduced that can blur the boundary between elastic and plastic classification.\n\nYour task is to implement and compare two branch-selection strategies for a single increment:\n- Strategy $\\mathcal{S}_{1}$ (KKT-consistent): classify the step as plastic if and only if $f(\\sigma^{\\text{tr}}) > 0$; otherwise classify as elastic/unloading.\n- Strategy $\\mathcal{S}_{2}$ (tolerance-blurred): fix a tolerance $\\eta > 0$ and classify the step as plastic if and only if $f(\\sigma^{\\text{tr}}) > -\\eta$; otherwise classify as elastic/unloading.\n\nFor either strategy, if the step is classified as elastic/unloading, take the updated stress equal to the trial stress, $\\sigma = \\sigma^{\\text{tr}}$. If the step is classified as plastic/loading, perform a radial (in one-dimension, sign-preserving) return to the yield surface, that is, set $\\sigma = \\operatorname{sign}(\\sigma^{\\text{tr}})\\, \\sigma_{y}$. The exact solution for the one-dimensional ideal plasticity update is given by the projection of the trial stress onto the admissible set, i.e., $\\sigma^{\\star} = \\operatorname{sign}(\\sigma^{\\text{tr}})\\, \\min\\left(\\lvert \\sigma^{\\text{tr}} \\rvert, \\sigma_{y}\\right)$.\n\nImplement a program that, for the parameter values and test strains below, computes for each test case:\n- a boolean indicating whether $\\mathcal{S}_{1}$ classifies the step as elastic/unloading,\n- a boolean indicating whether $\\mathcal{S}_{2}$ classifies the step as elastic/unloading,\n- the absolute error in the stress update for $\\mathcal{S}_{1}$ relative to the exact solution, expressed in Pascals,\n- the absolute error in the stress update for $\\mathcal{S}_{2}$ relative to the exact solution, expressed in Pascals.\n\nUse the following data and units:\n- Young's modulus $E = 30 \\times 10^{9}$ Pascal,\n- yield stress $\\sigma_{y} = 50 \\times 10^{6}$ Pascal,\n- tolerance $\\eta = 0.5 \\times 10^{6}$ Pascal,\n- initial stress $\\sigma_{n} = 0$ Pascal and initial plastic strain $\\varepsilon^{p}_{n} = 0$ (dimensionless),\n- total strain increment applied in a single step equals the final total strain $\\varepsilon$ (dimensionless).\n\nTest suite (three distinct cases to probe different facets of branch selection and update accuracy):\n- Case A (strictly inside the yield surface): $\\varepsilon_{A} = \\dfrac{\\sigma_{y} - 0.25 \\times 10^{6}}{E}$, for which $f(\\sigma^{\\text{tr}}) = -0.25 \\times 10^{6}$ Pascal.\n- Case B (exactly on the yield surface): $\\varepsilon_{B} = \\dfrac{\\sigma_{y}}{E}$, for which $f(\\sigma^{\\text{tr}}) = 0$ Pascal.\n- Case C (slightly outside the yield surface): $\\varepsilon_{C} = \\dfrac{\\sigma_{y} + 0.1 \\times 10^{6}}{E}$, for which $f(\\sigma^{\\text{tr}}) = +0.1 \\times 10^{6}$ Pascal.\n\nFor each case, compute the four outputs in the order listed above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets; the list must contain one sublist per test case, with each sublist formatted as $[\\text{bool}, \\text{bool}, \\text{float}, \\text{float}]$. For example, the global output format is $[[b_{A1}, b_{A2}, e_{A1}, e_{A2}], [b_{B1}, b_{B2}, e_{B1}, e_{B2}], [b_{C1}, b_{C2}, e_{C1}, e_{C2}]]$, where the booleans denote elastic/unloading classification and the floats are absolute errors in Pascal.",
            "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. It pertains to a standard procedure in computational plasticity. All required data and definitions are provided.\n\nThe objective is to compare two distinct numerical strategies, $\\mathcal{S}_{1}$ and $\\mathcal{S}_{2}$, for classifying a material's response as elastic or plastic within a one-dimensional, rate-independent, ideal elastoplasticity framework. The comparison is based on the accuracy of the final stress state relative to the exact analytical solution for a single load increment. The model starts from a stress-free and plastic-strain-free state, i.e., $\\sigma_{n} = 0$ and $\\varepsilon^{p}_{n} = 0$.\n\nThe core of the problem lies in the elastic trial step. The trial stress, $\\sigma^{\\text{tr}}$, is computed assuming a purely elastic increment:\n$$ \\sigma^{\\text{tr}} = E(\\varepsilon - \\varepsilon^{p}_{n}) $$\nGiven the initial condition $\\varepsilon^{p}_{n} = 0$, this simplifies to:\n$$ \\sigma^{\\text{tr}} = E\\varepsilon $$\nwhere $\\varepsilon$ is the total strain applied in the single step. The yield function, $f(\\sigma) = \\lvert \\sigma \\rvert - \\sigma_{y}$, is then evaluated at this trial stress, $f(\\sigma^{\\text{tr}})$, to decide on the subsequent step.\n\nThe material parameters are given as:\n- Young's modulus, $E = 30 \\times 10^{9} \\text{ Pa}$\n- Yield stress, $\\sigma_{y} = 50 \\times 10^{6} \\text{ Pa}$\n- Numerical tolerance, $\\eta = 0.5 \\times 10^{6} \\text{ Pa}$\n\nThe two strategies for branch selection are:\n- Strategy $\\mathcal{S}_{1}$ (KKT-consistent): The state is classified as elastic/unloading if $f(\\sigma^{\\text{tr}}) \\le 0$, and plastic otherwise ($f(\\sigma^{\\text{tr}}) > 0$). This directly corresponds to the Karush-Kuhn-Tucker (KKT) conditions where plasticity is activated ($\\Delta\\lambda > 0$) only if the yield condition is violated ($f(\\sigma) > 0$).\n- Strategy $\\mathcal{S}_{2}$ (tolerance-blurred): The state is classified as elastic/unloading if $f(\\sigma^{\\text{tr}}) \\le -\\eta$, and plastic otherwise ($f(\\sigma^{\\text{tr}}) > -\\eta$). This introduces a numerical tolerance, $\\eta$, that effectively expands the plastic loading region into a part of the elastic domain where the trial stress is close to the yield surface.\n\nThe stress update is performed based on the classification:\n- If elastic/unloading, the final stress is the trial stress: $\\sigma = \\sigma^{\\text{tr}}$.\n- If plastic/loading, the final stress is returned to the yield surface: $\\sigma = \\operatorname{sign}(\\sigma^{\\text{tr}}) \\sigma_{y}$.\n\nThe exact analytical solution, $\\sigma^{\\star}$, provides the benchmark for accuracy. It is the projection of the trial stress onto the admissible elastic domain $[-\\sigma_{y}, \\sigma_{y}]$:\n$$ \\sigma^{\\star} = \\operatorname{sign}(\\sigma^{\\text{tr}}) \\min(\\lvert \\sigma^{\\text{tr}} \\rvert, \\sigma_{y}) $$\n\nWe analyze the three test cases provided.\n\n**Case A: Strictly within the yield surface**\nThe total strain is $\\varepsilon_{A} = \\dfrac{\\sigma_{y} - 0.25 \\times 10^{6}}{E}$.\n1.  **Trial State**:\n    The trial stress is $\\sigma^{\\text{tr}}_{A} = E \\varepsilon_{A} = \\sigma_{y} - 0.25 \\times 10^{6} = 50 \\times 10^{6} - 0.25 \\times 10^{6} = 49.75 \\times 10^{6} \\text{ Pa}$.\n    The yield function value is $f(\\sigma^{\\text{tr}}_{A}) = \\lvert \\sigma^{\\text{tr}}_{A} \\rvert - \\sigma_{y} = 49.75 \\times 10^{6} - 50 \\times 10^{6} = -0.25 \\times 10^{6} \\text{ Pa}$.\n\n2.  **Strategy $\\mathcal{S}_{1}$**:\n    The condition for elastic/unloading is $f(\\sigma^{\\text{tr}}_{A}) \\le 0$. Since $-0.25 \\times 10^{6} \\le 0$, the step is classified as **elastic/unloading**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{1}} = \\sigma^{\\text{tr}}_{A} = 49.75 \\times 10^{6} \\text{ Pa}$.\n\n3.  **Strategy $\\mathcal{S}_{2}$**:\n    The condition for elastic/unloading is $f(\\sigma^{\\text{tr}}_{A}) \\le -\\eta$. Here, $-0.25 \\times 10^{6} \\le -0.5 \\times 10^{6}$ is false. Therefore, the step is classified as **plastic**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{2}} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{A}) \\sigma_{y} = 1 \\times 50 \\times 10^{6} = 50 \\times 10^{6} \\text{ Pa}$.\n\n4.  **Exact Solution & Errors**:\n    The exact solution is $\\sigma^{\\star}_{A} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{A}) \\min(\\lvert 49.75 \\times 10^{6} \\rvert, 50 \\times 10^{6}) = 49.75 \\times 10^{6} \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{1}$ is $e_{A1} = \\lvert \\sigma_{\\mathcal{S}_{1}} - \\sigma^{\\star}_{A} \\rvert = \\lvert 49.75 \\times 10^{6} - 49.75 \\times 10^{6} \\rvert = 0 \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{2}$ is $e_{A2} = \\lvert \\sigma_{\\mathcal{S}_{2}} - \\sigma^{\\star}_{A} \\rvert = \\lvert 50 \\times 10^{6} - 49.75 \\times 10^{6} \\rvert = 0.25 \\times 10^{6} \\text{ Pa}$.\n\n5.  **Outputs for Case A**: $[\\text{True}, \\text{False}, 0.0, 250000.0]$\n\n**Case B: Exactly on the yield surface**\nThe total strain is $\\varepsilon_{B} = \\dfrac{\\sigma_{y}}{E}$.\n1.  **Trial State**:\n    The trial stress is $\\sigma^{\\text{tr}}_{B} = E \\varepsilon_{B} = \\sigma_{y} = 50 \\times 10^{6} \\text{ Pa}$.\n    The yield function value is $f(\\sigma^{\\text{tr}}_{B}) = \\lvert \\sigma^{\\text{tr}}_{B} \\rvert - \\sigma_{y} = 50 \\times 10^{6} - 50 \\times 10^{6} = 0 \\text{ Pa}$.\n\n2.  **Strategy $\\mathcal{S}_{1}$**:\n    The condition $f(\\sigma^{\\text{tr}}_{B}) \\le 0$ is met ($0 \\le 0$). The step is classified as **elastic/unloading**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{1}} = \\sigma^{\\text{tr}}_{B} = 50 \\times 10^{6} \\text{ Pa}$.\n\n3.  **Strategy $\\mathcal{S}_{2}$**:\n    The condition $f(\\sigma^{\\text{tr}}_{B}) \\le -\\eta$ ($0 \\le -0.5 \\times 10^{6}$) is false. The step is classified as **plastic**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{2}} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{B}) \\sigma_{y} = 1 \\times 50 \\times 10^{6} = 50 \\times 10^{6} \\text{ Pa}$.\n\n4.  **Exact Solution & Errors**:\n    The exact solution is $\\sigma^{\\star}_{B} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{B}) \\min(\\lvert 50 \\times 10^{6} \\rvert, 50 \\times 10^{6}) = 50 \\times 10^{6} \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{1}$ is $e_{B1} = \\lvert \\sigma_{\\mathcal{S}_{1}} - \\sigma^{\\star}_{B} \\rvert = \\lvert 50 \\times 10^{6} - 50 \\times 10^{6} \\rvert = 0 \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{2}$ is $e_{B2} = \\lvert \\sigma_{\\mathcal{S}_{2}} - \\sigma^{\\star}_{B} \\rvert = \\lvert 50 \\times 10^{6} - 50 \\times 10^{6} \\rvert = 0 \\text{ Pa}$.\n\n5.  **Outputs for Case B**: $[\\text{True}, \\text{False}, 0.0, 0.0]$\n\n**Case C: Strictly outside the yield surface**\nThe total strain is $\\varepsilon_{C} = \\dfrac{\\sigma_{y} + 0.1 \\times 10^{6}}{E}$.\n1.  **Trial State**:\n    The trial stress is $\\sigma^{\\text{tr}}_{C} = E \\varepsilon_{C} = \\sigma_{y} + 0.1 \\times 10^{6} = 50 \\times 10^{6} + 0.1 \\times 10^{6} = 50.1 \\times 10^{6} \\text{ Pa}$.\n    The yield function value is $f(\\sigma^{\\text{tr}}_{C}) = \\lvert \\sigma^{\\text{tr}}_{C} \\rvert - \\sigma_{y} = 50.1 \\times 10^{6} - 50 \\times 10^{6} = 0.1 \\times 10^{6} \\text{ Pa}$.\n\n2.  **Strategy $\\mathcal{S}_{1}$**:\n    The condition $f(\\sigma^{\\text{tr}}_{C}) \\le 0$ ($0.1 \\times 10^{6} \\le 0$) is false. The step is classified as **plastic**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{1}} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{C}) \\sigma_{y} = 1 \\times 50 \\times 10^{6} = 50 \\times 10^{6} \\text{ Pa}$.\n\n3.  **Strategy $\\mathcal{S}_{2}$**:\n    The condition $f(\\sigma^{\\text{tr}}_{C}) \\le -\\eta$ ($0.1 \\times 10^{6} \\le -0.5 \\times 10^{6}$) is false. The step is classified as **plastic**.\n    The updated stress is $\\sigma_{\\mathcal{S}_{2}} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{C}) \\sigma_{y} = 1 \\times 50 \\times 10^{6} = 50 \\times 10^{6} \\text{ Pa}$.\n\n4.  **Exact Solution & Errors**:\n    The exact solution is $\\sigma^{\\star}_{C} = \\operatorname{sign}(\\sigma^{\\text{tr}}_{C}) \\min(\\lvert 50.1 \\times 10^{6} \\rvert, 50 \\times 10^{6}) = 50 \\times 10^{6} \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{1}$ is $e_{C1} = \\lvert \\sigma_{\\mathcal{S}_{1}} - \\sigma^{\\star}_{C} \\rvert = \\lvert 50 \\times 10^{6} - 50 \\times 10^{6} \\rvert = 0 \\text{ Pa}$.\n    The absolute error for $\\mathcal{S}_{2}$ is $e_{C2} = \\lvert \\sigma_{\\mathcal{S}_{2}} - \\sigma^{\\star}_{C} \\rvert = \\lvert 50 \\times 10^{6} - 50 \\times 10^{6} \\rvert = 0 \\text{ Pa}$.\n\n5.  **Outputs for Case C**: $[\\text{False}, \\text{False}, 0.0, 0.0]$\n\nIn summary, the tolerance-based strategy $\\mathcal{S}_{2}$ incorrectly classifies states that are elastic but close to the yield surface (Cases A and B) as plastic. This leads to an erroneous stress update in Case A, where the trial stress is inside the yield surface. The KKT-consistent strategy $\\mathcal{S}_{1}$ provides the correct classification and perfectly accurate stress update for all three cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares two branch-selection strategies for a 1D\n    elastoplastic model.\n    \"\"\"\n    \n    # Define physical and numerical parameters\n    E = 30.0 * 10**9       # Young's modulus in Pascals\n    sigma_y = 50.0 * 10**6 # Yield stress in Pascals\n    eta = 0.5 * 10**6      # Numerical tolerance in Pascals\n\n    # Define test cases based on the given strain definitions\n    # Case A: Strictly inside the yield surface\n    # Case B: Exactly on the yield surface\n    # Case C: Slightly outside the yield surface\n    test_strains = [\n        (sigma_y - 0.25 * 10**6) / E, # Case A\n        sigma_y / E,                   # Case B\n        (sigma_y + 0.1 * 10**6) / E      # Case C\n    ]\n\n    all_results = []\n    for eps in test_strains:\n        # Calculate the elastic trial stress and the yield function value\n        sigma_tr = E * eps\n        f_sigma_tr = abs(sigma_tr) - sigma_y\n\n        # --- Strategy S1 (KKT-consistent) ---\n        # Classify step: elastic if f(sigma_tr) <= 0\n        is_elastic_s1 = (f_sigma_tr <= 0)\n        \n        # Update stress according to S1 classification\n        if is_elastic_s1:\n            sigma_s1 = sigma_tr\n        else:  # Plastic step\n            sigma_s1 = np.sign(sigma_tr) * sigma_y\n\n        # --- Strategy S2 (tolerance-blurred) ---\n        # Classify step: elastic if f(sigma_tr) <= -eta\n        is_elastic_s2 = (f_sigma_tr <= -eta)\n\n        # Update stress according to S2 classification\n        if is_elastic_s2:\n            sigma_s2 = sigma_tr\n        else:  # Plastic step\n            sigma_s2 = np.sign(sigma_tr) * sigma_y\n\n        # --- Exact Solution ---\n        # The exact solution is the projection of the trial stress onto the\n        # admissible stress interval [-sigma_y, sigma_y].\n        sigma_star = np.sign(sigma_tr) * min(abs(sigma_tr), sigma_y)\n\n        # --- Calculate Absolute Errors ---\n        error_s1 = abs(sigma_s1 - sigma_star)\n        error_s2 = abs(sigma_s2 - sigma_star)\n\n        # Store the four required outputs for this case\n        case_results = [is_elastic_s1, is_elastic_s2, float(error_s1), float(error_s2)]\n        all_results.append(case_results)\n\n    # Format the final output string to match the required format:\n    # [[bool,bool,float,float],[bool,bool,float,float],[bool,bool,float,float]]\n    # with no spaces within the inner lists.\n    sublist_strs = []\n    for res in all_results:\n        # res[0] and res[1] are booleans (True/False)\n        # res[2] and res[3] are floats\n        sublist_strs.append(f\"[{res[0]},{res[1]},{res[2]},{res[3]}]\")\n\n    final_output = f\"[{','.join(sublist_strs)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "When a material's stress state lies exactly on the yield surface ($f=0$), its subsequent response depends entirely on the direction of the applied load increment. The KKT framework provides a precise way to distinguish between plastic loading (where the stress attempts to move outside the yield surface) and elastic unloading (where it moves back inside). This exercise delves into this critical distinction by exploring the concept of \"neutral unloading,\" where the stress state evolves elastically away from the yield surface, a process governed by the condition $\\dot{f} < 0$. You will first derive this condition for a pressure-sensitive Drucker-Prager model and then construct numerical simulations to visualize how different strain paths produce loading versus unloading responses.",
            "id": "3539963",
            "problem": "Consider an isotropic, rate-independent, pressure-sensitive plasticity model used in computational geomechanics with the Drucker–Prager yield function $f(\\boldsymbol{\\sigma},\\kappa) = q + \\alpha p - \\kappa$, where $p = \\tfrac{1}{3}\\,\\mathrm{tr}(\\boldsymbol{\\sigma})$ is the mean stress, $q = \\sqrt{\\tfrac{3}{2}}\\,\\|\\mathbf{s}\\|$ is the second deviatoric stress invariant with $\\mathbf{s} = \\boldsymbol{\\sigma} - p\\mathbf{I}$ the deviatoric stress tensor, $\\alpha > 0$ is a friction parameter, and $\\kappa$ is an isotropic hardening variable. The evolution of $\\kappa$ is assumed to be $\\dot{\\kappa} = H \\dot{\\lambda}$, where $\\dot{\\lambda} \\ge 0$ is the plastic multiplier rate and $H \\ge 0$ is a hardening modulus. The plasticity model satisfies the Karush–Kuhn–Tucker (KKT) conditions: $f \\le 0$, $\\dot{\\lambda} \\ge 0$, and $\\dot{\\lambda} f = 0$, together with the consistency condition for plastic loading: if $\\dot{\\lambda} > 0$ then $f = 0$ and $\\dot{f} = 0$.\n\nAssume small strains and isotropic linear elasticity with bulk modulus $K > 0$ and shear modulus $G > 0$, so that the elastic stress rate is related to the strain rate by $\\dot{\\boldsymbol{\\sigma}} = 2G\\,\\dot{\\boldsymbol{e}} + \\lambda_{\\mathrm{L}}\\,\\mathrm{tr}(\\dot{\\boldsymbol{e}})\\,\\mathbf{I}$, where $\\dot{\\boldsymbol{e}}$ is the strain-rate tensor, $\\lambda_{\\mathrm{L}}$ is the first Lamé parameter, and the volumetric strain rate is $\\dot{\\epsilon}_{v} = \\mathrm{tr}(\\dot{\\boldsymbol{e}})$. Under isotropy, the invariant rates satisfy $\\dot{p} = K\\,\\dot{\\epsilon}_{v}$ and, if the deviatoric strain rate is aligned with the deviatoric stress direction, $\\dot{q} = 2G\\,\\dot{\\gamma}$, where $\\dot{\\gamma} = \\sqrt{\\tfrac{2}{3}}\\|\\dot{\\boldsymbol{e}}_{\\mathrm{dev}}\\|$ is the equivalent shear strain rate and $\\dot{\\boldsymbol{e}}_{\\mathrm{dev}}$ is the deviatoric part of $\\dot{\\boldsymbol{e}}$.\n\nYour tasks:\n\n1. Derive, from first principles using the above definitions and the KKT relations, the conditions under which unloading at yield occurs with no plastic strain increment (neutral unloading). Specifically, starting from $f = q + \\alpha p - \\kappa$ and $\\dot{\\kappa} = H\\dot{\\lambda}$, show that at a point where $f = 0$, if $\\dot{\\lambda} = 0$ then the requirement for neutral unloading is $\\dot{f} < 0$. Express $\\dot{f}$ in terms of the elastic invariant rates $\\dot{p}$ and $\\dot{q}$, and then in terms of the strain-rate invariants $\\dot{\\epsilon}_{v}$ and $\\dot{\\gamma}$ via $K$ and $G$. State the inequality that must be satisfied by $(\\dot{\\epsilon}_{v},\\dot{\\gamma})$ for neutral unloading at yield.\n\n2. Prove that, under isotropic linear elasticity, any chosen pair $(\\dot{p},\\dot{q})$ consistent with the above invariant relations can be realized by suitable choices of $(\\dot{\\epsilon}_{v},\\dot{\\gamma})$ and give the constructive mappings $\\dot{p} = K \\dot{\\epsilon}_{v}$ and $\\dot{q} = 2G \\dot{\\gamma}$. Explain why this mapping is sufficient to construct stress paths that satisfy the neutral unloading condition without invoking plastic flow.\n\n3. Construct numerical stress paths to realize the neutral unloading scenario and to test edge cases. For each path, take constant rates $(\\dot{\\epsilon}_{v},\\dot{\\gamma})$ over a time step $\\Delta t > 0$ and $N \\in \\mathbb{N}$ steps. Starting from an initial state at yield defined by $(p_{0},q_{0},\\kappa)$ with $q_{0} + \\alpha p_{0} - \\kappa = 0$, evolve $(p,q)$ elastically according to\n$$\np_{n+1} = p_{n} + K\\,\\dot{\\epsilon}_{v}\\,\\Delta t,\\qquad\nq_{n+1} = q_{n} + 2G\\,\\dot{\\gamma}\\,\\Delta t,\n$$\nwhile keeping $\\dot{\\lambda} = 0$ and thus $\\kappa$ constant. For each path, verify the KKT unloading conditions: $f_{0} = 0$, $\\dot{\\lambda} = 0$, and $\\dot{f} < 0$ at the initial step, and check that $f_{n} \\le 0$ for all steps $n = 1,\\dots,N$.\n\nImplement a complete program that computes the above for the following test suite of parameter values (all stresses in $\\mathrm{MPa}$, moduli in $\\mathrm{MPa}$, strain rates in $\\mathrm{s}^{-1}$, time in $\\mathrm{s}$):\n\n- Test $1$ (neutral unloading via mean stress decrease):\n  - $\\alpha = 0.2$, $K = 15000$, $G = 10000$, $\\kappa = 60$, $p_{0} = 100$, $q_{0} = 60 - 0.2 \\cdot 100 = 40$, $\\Delta t = 0.1$, $N = 10$, $\\dot{\\epsilon}_{v} = -5 \\times 10^{-6}$, $\\dot{\\gamma} = 0$.\n- Test $2$ (boundary case with $\\dot{f} = 0$):\n  - $\\alpha = 0.3$, $K = 12000$, $G = 8000$, $\\kappa = 50$, $p_{0} = 100$, $q_{0} = 50 - 0.3 \\cdot 100 = 20$, $\\Delta t = 0.1$, $N = 10$, $\\dot{\\epsilon}_{v} = -1 \\times 10^{-6}$, $\\dot{\\gamma} = \\left(-\\frac{\\alpha K}{2G}\\right)\\dot{\\epsilon}_{v}$.\n- Test $3$ (loading, violates unloading with $\\dot{f} > 0$):\n  - $\\alpha = 0.2$, $K = 15000$, $G = 10000$, $\\kappa = 60$, $p_{0} = 100$, $q_{0} = 40$, $\\Delta t = 0.1$, $N = 10$, $\\dot{\\epsilon}_{v} = 1 \\times 10^{-6}$, $\\dot{\\gamma} = 1 \\times 10^{-6}$.\n- Test $4$ (neutral unloading via simultaneous $p$ and $q$ decrease):\n  - $\\alpha = 0.4$, $K = 20000$, $G = 12000$, $\\kappa = 100$, $p_{0} = 150$, $q_{0} = 100 - 0.4 \\cdot 150 = 40$, $\\Delta t = 0.1$, $N = 10$, $\\dot{\\epsilon}_{v} = -2 \\times 10^{-6}$, $\\dot{\\gamma} = -1 \\times 10^{-6}$.\n- Test $5$ (not at yield initially, $f_{0} < 0$):\n  - $\\alpha = 0.25$, $K = 18000$, $G = 9000$, $\\kappa = 75$, $p_{0} = 100$, $q_{0} = 30$ (so $f_{0} = 30 + 0.25 \\cdot 100 - 75 = -20$), $\\Delta t = 0.1$, $N = 10$, $\\dot{\\epsilon}_{v} = -1 \\times 10^{-6}$, $\\dot{\\gamma} = -1 \\times 10^{-6}$.\n\nYour program must, for each test, return a boolean indicating whether the neutral unloading at yield conditions are satisfied, defined precisely as:\n- $|f_{0}| \\le \\varepsilon$ with tolerance $\\varepsilon = 10^{-9}$,\n- $\\dot{\\lambda} = 0$ by construction,\n- $\\dot{f} = \\dot{q} + \\alpha \\dot{p} = 2G\\,\\dot{\\gamma} + \\alpha K\\,\\dot{\\epsilon}_{v} < 0$,\n- and $f_{n} \\le \\varepsilon$ for all steps $n = 1,\\dots,N$.\n\nFinal output format: Your program should produce a single line containing the results as a comma-separated list enclosed in square brackets (for example, $\\left[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4},\\mathrm{result5}\\right]$), where each $\\mathrm{result}$ is either $\\mathrm{True}$ or $\\mathrm{False}$.",
            "solution": "The problem posed is a well-defined exercise in computational plasticity, specifically exploring the loading/unloading conditions for a Drucker–Prager yield criterion within the framework of isotropic elastoplasticity. The given definitions, principles, and numerical tasks are scientifically sound, self-contained, and consistent with established theories in continuum mechanics and computational geomechanics. Therefore, the problem is deemed valid and a full solution is provided below.\n\nThe solution is divided into three parts, corresponding to the tasks outlined in the problem statement.\n\n### Part 1: Derivation of the Neutral Unloading Condition\n\nThe state of the material is described by the Drucker–Prager yield function, $f$, defined as:\n$$\nf(\\boldsymbol{\\sigma}, \\kappa) = q + \\alpha p - \\kappa\n$$\nHere, $p$ is the mean stress, $q$ is the von Mises equivalent stress, $\\alpha > 0$ is a material parameter related to internal friction, and $\\kappa$ is an isotropic hardening variable. The material is in a plastic state if $f=0$ and in an elastic state if $f<0$. The condition $f>0$ is inadmissible.\n\nThe Karush–Kuhn–Tucker (KKT) conditions govern the plastic flow and are given as:\n$$\nf \\le 0, \\quad \\dot{\\lambda} \\ge 0, \\quad \\dot{\\lambda} f = 0\n$$\nwhere $\\dot{\\lambda}$ is the rate of the plastic multiplier. The condition $\\dot{\\lambda} f = 0$ is the complementary slackness condition, which implies that plastic flow ($\\dot{\\lambda} > 0$) can only occur when the material is at yield ($f=0$).\n\n\"Neutral unloading at yield\" signifies a process starting from a state on the yield surface ($f=0$) where the material deforms elastically, meaning there is no increment of plastic strain. This corresponds to the case where the plastic multiplier rate is zero, $\\dot{\\lambda}=0$.\n\nThe evolution of the hardening variable is given by $\\dot{\\kappa} = H \\dot{\\lambda}$, where $H \\ge 0$ is the hardening modulus. If $\\dot{\\lambda}=0$, it directly follows that $\\dot{\\kappa}=0$. This means that during elastic unloading, the yield surface remains fixed in stress space.\n\nTo determine the condition for such an unloading path, we evaluate the rate of change of the yield function, $\\dot{f}$. Using the chain rule:\n$$\n\\dot{f} = \\dot{q} + \\alpha \\dot{p} - \\dot{\\kappa}\n$$\nSince we are considering a purely elastic response, we set $\\dot{\\lambda}=0$, which implies $\\dot{\\kappa}=0$. The rate of the yield function, often called the elastic trial rate, becomes:\n$$\n\\dot{f} = \\dot{q} + \\alpha \\dot{p}\n$$\nFor the state to move from the yield surface ($f=0$) into the elastic domain ($f<0$), the rate of change of $f$ must be negative. Thus, the condition for neutral unloading is:\n$$\n\\dot{f} < 0 \\implies \\dot{q} + \\alpha \\dot{p} < 0\n$$\nThe case $\\dot{f}=0$ is termed neutral loading, where the stress state evolves along the yield surface without inducing plastic flow. The problem requires a strict inequality for unloading.\n\nNext, we express this condition in terms of strain-rate invariants. The problem states that for isotropic linear elasticity, the rates of the stress invariants are related to the rates of the strain invariants by:\n$$\n\\dot{p} = K \\dot{\\epsilon}_v\n$$\n$$\n\\dot{q} = 2G \\dot{\\gamma}\n$$\nwhere $K$ is the bulk modulus, $G$ is the shear modulus, $\\dot{\\epsilon}_v = \\mathrm{tr}(\\dot{\\boldsymbol{e}})$ is the volumetric strain rate, and $\\dot{\\gamma} = \\sqrt{\\frac{2}{3}} \\|\\dot{\\boldsymbol{e}}_{\\mathrm{dev}}\\|$ is the equivalent shear strain rate.\n\nSubstituting these elastic relationships into the inequality for $\\dot{f}$:\n$$\n(2G \\dot{\\gamma}) + \\alpha (K \\dot{\\epsilon}_v) < 0\n$$\nThis is the final inequality that the pair of strain-rate invariants $(\\dot{\\epsilon}_v, \\dot{\\gamma})$ must satisfy for neutral unloading to occur from a state at yield.\n\n### Part 2: Sufficiency of the Strain-Rate to Stress-Rate Mapping\n\nThis part requires demonstrating that any desired elastic path for $(\\dot{p}, \\dot{q})$ that satisfies the unloading condition can be achieved by an appropriate choice of strain rates $(\\dot{\\epsilon}_v, \\dot{\\gamma})$.\n\nThe condition for neutral unloading, $\\dot{q} + \\alpha \\dot{p} < 0$, defines a half-plane in the $(\\dot{p}, \\dot{q})$ stress-rate space. Any stress-rate vector $(\\dot{p}, \\dot{q})$ that originates from a point on the yield line $q + \\alpha p - \\kappa = 0$ and points into the elastic region $q + \\alpha p - \\kappa < 0$ will satisfy this condition.\n\nThe problem provides the constitutive relations for isotropic elasticity in terms of invariants:\n$$\n\\dot{p} = K \\dot{\\epsilon}_v \\quad \\text{and} \\quad \\dot{q} = 2G \\dot{\\gamma}\n$$\nGiven that the material moduli $K$ and $G$ are strictly positive constants ($K>0, G>0$), these equations establish an invertible linear transformation between the strain-rate space $(\\dot{\\epsilon}_v, \\dot{\\gamma})$ and the elastic stress-rate space $(\\dot{p}, \\dot{q})$.\n\nThe inverse mapping is:\n$$\n\\dot{\\epsilon}_v = \\frac{1}{K} \\dot{p} \\quad \\text{and} \\quad \\dot{\\gamma} = \\frac{1}{2G} \\dot{q}\n$$\nThis demonstrates that for any desired elastic stress-rate vector $(\\dot{p}_{\\text{target}}, \\dot{q}_{\\text{target}})$, we can uniquely determine the strain-rate vector $(\\dot{\\epsilon}_v, \\dot{\\gamma})$ required to produce it. Since we can choose any real-valued pair $(\\dot{p}_{\\text{target}}, \\dot{q}_{\\text{target}})$ that satisfies the unloading condition $\\dot{q}_{\\text{target}} + \\alpha \\dot{p}_{\\text{target}} < 0$, we can always construct a corresponding strain-rate history $(\\dot{\\epsilon}_v(t), \\dot{\\gamma}(t))$ that generates this stress path elastically.\n\nTherefore, the mapping is sufficient to construct any stress path satisfying the neutral unloading condition without invoking plastic flow ($\\dot{\\lambda}=0$). The ability to control $\\dot{\\epsilon}_v$ and $\\dot{\\gamma}$ independently provides full control over the elastic evolution of $p$ and $q$.\n\n### Part 3: Numerical Implementation and Verification\n\nThe final task is to implement a numerical procedure to simulate stress paths for several test cases and verify if they satisfy the conditions for neutral unloading at yield. A constant strain-rate vector $(\\dot{\\epsilon}_v, \\dot{\\gamma})$ is applied over a duration of $N \\Delta t$.\n\nThe state variables $(p, q)$ are evolved using a forward Euler integration scheme, which is exact for constant rates:\n$$\np_{n+1} = p_{n} + \\dot{p} \\Delta t = p_{n} + K \\dot{\\epsilon}_v \\Delta t\n$$\n$$\nq_{n+1} = q_{n} + \\dot{q} \\Delta t = q_{n} + 2G \\dot{\\gamma} \\Delta t\n$$\nSince the process is assumed elastic, $\\dot{\\lambda}=0$, and the hardening parameter $\\kappa$ remains constant throughout the simulation, $\\kappa_n = \\kappa_0$.\n\nFor each test case, the verification of \"neutral unloading at yield\" requires checking four distinct conditions:\n1.  **Initial Yield Condition:** The initial state $(p_0, q_0)$ must lie on the yield surface. This is checked by evaluating $f_0 = q_0 + \\alpha p_0 - \\kappa_0$ and verifying that $|f_0| \\le \\varepsilon$ for a small tolerance $\\varepsilon=10^{-9}$.\n2.  **No Plastic Flow:** The plastic multiplier rate is zero by construction ($\\dot{\\lambda}=0$). This is an assumption of the simulation path.\n3.  **Unloading Rate Condition:** The elastic trial stress rate must point into the elastic domain. This is checked by verifying that $\\dot{f} = 2G\\dot{\\gamma} + \\alpha K\\dot{\\epsilon}_v < 0$.\n4.  **Path Admissibility:** The entire stress path must remain within or on the yield surface. This is checked by ensuring that at every subsequent step $n=1, \\dots, N$, the yield function $f_n = q_n + \\alpha p_n - \\kappa_0$ satisfies $f_n \\le \\varepsilon$.\n\nA test case is considered to satisfy the conditions only if all four criteria are met. The Python program in the `<final_answer>` section implements this logic for the specified test suite.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geomechanics problem by verifying neutral unloading\n    conditions for a set of test cases.\n    \"\"\"\n\n    # Define the tolerance for floating point comparisons\n    TOLERANCE = 1e-9\n\n    def check_unloading_conditions(alpha, K, G, kappa, p0, q0, dt, N, eps_v_dot, gamma_dot):\n        \"\"\"\n        Checks if the neutral unloading at yield conditions are satisfied for a given test case.\n\n        The conditions are:\n        1. The initial state is on the yield surface: |f_0| <= tolerance.\n        2. The plastic multiplier rate is zero by construction (lambda_dot = 0).\n        3. The elastic trial stress rate indicates unloading: f_dot < 0.\n        4. The stress path remains within the elastic domain: f_n <= tolerance for all n.\n\n        Args:\n            alpha (float): Friction parameter.\n            K (float): Bulk modulus.\n            G (float): Shear modulus.\n            kappa (float): Isotropic hardening variable.\n            p0 (float): Initial mean stress.\n            q0 (float): Initial deviatoric stress.\n            dt (float): Time step.\n            N (int): Number of steps.\n            eps_v_dot (float): Volumetric strain rate.\n            gamma_dot (float): Equivalent shear strain rate.\n\n        Returns:\n            bool: True if all conditions are met, False otherwise.\n        \"\"\"\n        # 1. Check initial yield condition\n        f0 = q0 + alpha * p0 - kappa\n        if not (abs(f0) <= TOLERANCE):\n            return False\n\n        # 2. lambda_dot = 0 is assumed by construction for the elastic path.\n\n        # 3. Check unloading rate condition\n        f_dot = 2 * G * gamma_dot + alpha * K * eps_v_dot\n        if not (f_dot < 0):\n            return False\n\n        # 4. Check if the path remains admissible (elastic)\n        p_current = p0\n        q_current = q0\n        \n        p_dot = K * eps_v_dot\n        q_dot = 2 * G * gamma_dot\n\n        for _ in range(N):\n            p_current += p_dot * dt\n            q_current += q_dot * dt\n            \n            f_current = q_current + alpha * p_current - kappa\n            \n            # The state must remain on or inside the yield surface.\n            # q_current must be non-negative by definition.\n            if f_current > TOLERANCE or q_current < 0:\n                return False\n        \n        # If all checks pass\n        return True\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Test 1 (neutral unloading via mean stress decrease)\n        {\n            'alpha': 0.2, 'K': 15000, 'G': 10000, 'kappa': 60,\n            'p0': 100, 'q0': 40, 'dt': 0.1, 'N': 10,\n            'eps_v_dot': -5e-6, 'gamma_dot': 0\n        },\n        # Test 2 (boundary case with f_dot = 0)\n        {\n            'alpha': 0.3, 'K': 12000, 'G': 8000, 'kappa': 50,\n            'p0': 100, 'q0': 20, 'dt': 0.1, 'N': 10,\n            'eps_v_dot': -1e-6, \n            'gamma_dot': (-0.3 * 12000 / (2 * 8000)) * (-1e-6)\n        },\n        # Test 3 (loading, violates unloading with f_dot > 0)\n        {\n            'alpha': 0.2, 'K': 15000, 'G': 10000, 'kappa': 60,\n            'p0': 100, 'q0': 40, 'dt': 0.1, 'N': 10,\n            'eps_v_dot': 1e-6, 'gamma_dot': 1e-6\n        },\n        # Test 4 (neutral unloading via simultaneous p and q decrease)\n        {\n            'alpha': 0.4, 'K': 20000, 'G': 12000, 'kappa': 100,\n            'p0': 150, 'q0': 40, 'dt': 0.1, 'N': 10,\n            'eps_v_dot': -2e-6, 'gamma_dot': -1e-6\n        },\n        # Test 5 (not at yield initially, f_0 < 0)\n        {\n            'alpha': 0.25, 'K': 18000, 'G': 9000, 'kappa': 75,\n            'p0': 100, 'q0': 30, 'dt': 0.1, 'N': 10,\n            'eps_v_dot': -1e-6, 'gamma_dot': -1e-6\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        # Unpack parameters and call the checking function\n        result = check_unloading_conditions(\n            params['alpha'], params['K'], params['G'], params['kappa'],\n            params['p0'], params['q0'], params['dt'], params['N'],\n            params['eps_v_dot'], params['gamma_dot']\n        )\n        results.append(result)\n\n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world geomechanical models, like the Mohr-Coulomb criterion, introduce further complexities such as non-associated plastic flow and non-smooth yield surfaces with corners and edges. At these corners, where multiple yield planes are active, the direction of plastic flow is not unique, and the loading/unloading check becomes more sophisticated. This advanced practice challenges you to implement an implicit return-mapping algorithm for a 3D non-associated Mohr-Coulomb model and to develop a robust KKT-based diagnostic tool to accurately classify true unloading, neutral loading, and plastic loading, even at these complex, non-differentiable points in stress space.",
            "id": "3540004",
            "problem": "Develop a complete, runnable program that implements an implicit return-mapping stress update for a non-associated Mohr–Coulomb material in three dimensions, together with a diagnostic based on the Karush–Kuhn–Tucker (KKT) relations to distinguish true unloading from neutral loading when the stress state lies at corners of the yield surface. The program must accept no input and must produce a single line of output as specified below.\n\nThe derivation must start from fundamental linear elasticity and the KKT complementarity conditions. Consider small strains and linear isotropic elasticity with Young’s modulus $E$ and Poisson’s ratio $\\nu$, and use compression-positive sign convention. The elastic stiffness operator in index notation is\n$$\n\\sigma_{ij} = 2 G \\left(\\varepsilon_{ij} - \\tfrac{1}{3} \\varepsilon_{kk} \\delta_{ij}\\right) + K \\varepsilon_{kk}\\, \\delta_{ij},\n$$\nwith shear modulus $G = \\dfrac{E}{2(1+\\nu)}$ and bulk modulus $K = \\dfrac{E}{3(1-2\\nu)}$. The stress update over a time step is composed of an elastic predictor followed by an implicit plastic corrector governed by the Mohr–Coulomb yield condition and a non-associated plastic potential.\n\nUse the principal-stress plane representation of the Mohr–Coulomb yield function for compression-positive stresses. For principal stresses $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$, the yield function on any candidate plane defined by a choice of a maximum index $i$ and a minimum index $k$ is\n$$\nf_{ik}(\\boldsymbol{\\sigma}) = (1 - \\sin\\varphi)\\, \\sigma_i - (1 + \\sin\\varphi)\\, \\sigma_k - 2 c \\cos\\varphi,\n$$\nwhere $\\varphi$ is the friction angle and $c$ is the cohesion. The active yield function value is the maximum over all distinct pairs $i \\ne k$. The non-associated plastic potential is defined analogously using the dilation angle $\\psi$,\n$$\ng_{ik}(\\boldsymbol{\\sigma}) = (1 - \\sin\\psi)\\, \\sigma_i - (1 + \\sin\\psi)\\, \\sigma_k.\n$$\nAdopt the Karush–Kuhn–Tucker conditions in rate form,\n$$\n\\dot{\\lambda} \\ge 0,\\quad f(\\boldsymbol{\\sigma}) \\le 0,\\quad \\dot{\\lambda}\\, f(\\boldsymbol{\\sigma}) = 0,\n$$\nand the consistency condition when plastic loading occurs,\n$$\n\\dot{f}(\\boldsymbol{\\sigma}) = 0 \\quad \\text{if } \\dot{\\lambda} > 0.\n$$\nAlong corners (non-differentiable points of the yield surface where multiple planes are active), consider the set of active planes $\\mathcal{A}$ attaining the maximal yield value. Define a diagnostic to distinguish:\n- true unloading: $\\dot{\\lambda} = 0$ and $\\max_{(i,k)\\in \\mathcal{A}} \\dot{f}_{ik}(\\boldsymbol{\\sigma}) < 0$,\n- neutral loading: $\\dot{\\lambda} = 0$ and $\\dot{f}_{ik}(\\boldsymbol{\\sigma}) = 0$ for all $(i,k)\\in \\mathcal{A}$.\n\nImplement the following algorithmic structure.\n\n1) Elastic predictor. Given the previous Cauchy stress tensor $\\boldsymbol{\\sigma}_n$ and a strain increment $\\Delta\\boldsymbol{\\varepsilon}$, compute the trial stress as\n$$\n\\boldsymbol{\\sigma}^{\\text{tr}} = \\boldsymbol{\\sigma}_n + \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon},\n$$\nwhere $\\mathbb{C}$ is the fourth-order isotropic stiffness tensor corresponding to $K$ and $G$.\n\n2) Yield check. Compute the principal values $\\sigma_i^{\\text{tr}}$ of $\\boldsymbol{\\sigma}^{\\text{tr}}$ and evaluate\n$$\nf^{\\text{tr}} = \\max_{i\\ne k} \\left[(1 - \\sin\\varphi)\\, \\sigma_i^{\\text{tr}} - (1 + \\sin\\varphi)\\, \\sigma_k^{\\text{tr}} - 2 c \\cos\\varphi\\right].\n$$\nIf $f^{\\text{tr}} \\le 0$, accept $\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}}$ and set $\\Delta\\lambda = 0$.\n\n3) Plastic corrector (implicit return-mapping to a single plane). If $f^{\\text{tr}} > 0$, identify the trial principal indices $a$ and $b$ corresponding to the maximum and minimum principal stresses, respectively, and assume these define the active plane. Use the non-associated flow direction in principal coordinates with diagonal entries\n$$\nN_a = 1 - \\sin\\psi,\\quad N_b = -\\left(1 + \\sin\\psi\\right),\\quad N_m = 0 \\text{ for the remaining index } m,\n$$\nand compute the elastic-plastic operator action\n$$\n\\mathbb{C} : \\mathbf{N} = K\\, \\mathrm{tr}(\\mathbf{N})\\, \\mathbf{I} + 2 G \\left(\\mathbf{N} - \\tfrac{1}{3} \\mathrm{tr}(\\mathbf{N}) \\mathbf{I}\\right),\n$$\nwith $\\mathrm{tr}(\\mathbf{N}) = -2\\sin\\psi$. In principal components, this gives constants\n$$\nS_a = -2 K \\sin\\psi + 2 G \\left(1 - \\tfrac{1}{3}\\sin\\psi\\right),\\quad\nS_b = -2 K \\sin\\psi - 2 G \\left(1 + \\tfrac{1}{3}\\sin\\psi\\right),\\quad\nS_m = -2 K \\sin\\psi + \\tfrac{4}{3} G \\sin\\psi.\n$$\nEnforce the consistency condition on the chosen plane,\n$$\nf_{ab}(\\boldsymbol{\\sigma}_{n+1}) = 0,\\quad \\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}} - \\Delta\\lambda \\left(\\mathbb{C} : \\mathbf{N}\\right),\n$$\nwhich yields a closed form for the plastic multiplier increment,\n$$\n\\Delta\\lambda = \\frac{f^{\\text{tr}}}{(1 - \\sin\\varphi)\\, S_a - (1 + \\sin\\varphi)\\, S_b},\n$$\nand updated principal stresses\n$$\n\\sigma_a^{n+1} = \\sigma_a^{\\text{tr}} - \\Delta\\lambda\\, S_a,\\quad\n\\sigma_b^{n+1} = \\sigma_b^{\\text{tr}} - \\Delta\\lambda\\, S_b,\\quad\n\\sigma_m^{n+1} = \\sigma_m^{\\text{tr}} - \\Delta\\lambda\\, S_m.\n$$\nAssume coaxiality during the correction and reconstruct $\\boldsymbol{\\sigma}_{n+1}$ using the trial eigenvectors.\n\n4) KKT-based diagnostic. Let $f_n = \\max_{i\\ne k} f_{ik}(\\boldsymbol{\\sigma}_n)$. If $f_n < 0$, declare elastic interior. Otherwise, evaluate the classification as follows.\n- If $\\Delta\\lambda > 0$, declare plastic loading.\n- If $\\Delta\\lambda = 0$, approximate $\\dot{f}_{ik}$ for the active set at $\\boldsymbol{\\sigma}_n$ using the elastic stress rate $\\dot{\\boldsymbol{\\sigma}} = \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}$ and principal stress rates $\\dot{\\sigma}_i$ obtained by projecting $\\dot{\\boldsymbol{\\sigma}}$ onto the eigenbasis of $\\boldsymbol{\\sigma}_n$. For each active plane $(i,k)$ in the set\n$$\n\\mathcal{A} = \\left\\{ (i,k) \\,:\\, i\\ne k,\\ f_{ik}(\\boldsymbol{\\sigma}_n) = \\max_{p\\ne q} f_{pq}(\\boldsymbol{\\sigma}_n) \\right\\},\n$$\ncompute\n$$\n\\dot{f}_{ik} = (1 - \\sin\\varphi)\\, \\dot{\\sigma}_i - (1 + \\sin\\varphi)\\, \\dot{\\sigma}_k.\n$$\nIf $\\max_{(i,k)\\in\\mathcal{A}} \\dot{f}_{ik} < 0$, declare true unloading. If all $\\dot{f}_{ik} = 0$ within a tight numerical tolerance, declare neutral loading.\n\nUse the following material parameters and test suite. All stresses are in megapascals (MPa), all strains are dimensionless, and all angles are in degrees. The time step is one, so the rate symbols correspond to increments.\n\nCommon material parameters for all tests:\n- $E = 10000$ MPa,\n- $\\nu = 0.3$,\n- $\\varphi = 30$ degrees,\n- $\\psi = 10$ degrees,\n- $c = 1$ MPa.\n\nTest suite of four cases (each case is a pair of initial stress tensor and strain increment, both $3\\times 3$ symmetric arrays given in the global Cartesian basis). The principal axes coincide with the global axes for all cases below.\n\n- Case 1 (neutral loading at a corner): $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(33.464,\\,33.464,\\,10)$ MPa (on the triaxial-compression corner), with $\\Delta\\boldsymbol{\\varepsilon} = \\mathrm{diag}(1.0\\times 10^{-5},\\,1.0\\times 10^{-5},\\,-4.444444444444445\\times 10^{-6})$.\n\n- Case 2 (true unloading at a corner): same $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(33.464,\\,33.464,\\,10)$ MPa, with $\\Delta\\boldsymbol{\\varepsilon} = \\mathrm{diag}(1.0\\times 10^{-5},\\,1.0\\times 10^{-5},\\,-3.0\\times 10^{-6})$.\n\n- Case 3 (plastic loading at a corner): same $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(33.464,\\,33.464,\\,10)$ MPa, with $\\Delta\\boldsymbol{\\varepsilon} = \\mathrm{diag}(1.0\\times 10^{-5},\\,1.0\\times 10^{-5},\\,-6.0\\times 10^{-6})$.\n\n- Case 4 (elastic interior): $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(10,\\,10,\\,10)$ MPa, with $\\Delta\\boldsymbol{\\varepsilon} = \\mathrm{diag}(0,\\,0,\\,0)$.\n\nYour program must:\n- Implement the implicit return-mapping scheme above with the non-associated potential and the KKT-based diagnostic.\n- For each case, produce an integer classification code:\n  - $0$ for elastic interior ($f_n < 0$),\n  - $1$ for true unloading at a corner ($\\Delta\\lambda = 0$ and $\\max \\dot{f} < 0$ over active planes),\n  - $2$ for neutral loading at a corner ($\\Delta\\lambda = 0$ and all $\\dot{f} = 0$ over active planes),\n  - $3$ for plastic loading ($\\Delta\\lambda > 0$).\n- Aggregate the four results into a single line of output as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4]$.\n\nThe final output must be exactly one line containing the list of four integers as described.",
            "solution": "The user has requested the development and implementation of an implicit return-mapping stress update algorithm for a non-associated Mohr–Coulomb material. The implementation must include a diagnostic procedure based on the Karush–Kuhn–Tucker (KKT) conditions to distinguish between true unloading and neutral loading at corners of the yield surface. The solution will be presented in two parts: a detailed theoretical derivation and explanation of the algorithm, followed by a complete Python program that applies the algorithm to a specified test suite.\n\nThe analysis is performed under the assumption of small strains and linear isotropic elasticity. The sign convention used is compression-positive.\n\nFirst, we define the material parameters and derived elastic constants.\n- Young's Modulus: $E = 10000$ MPa\n- Poisson's Ratio: $\\nu = 0.3$\n- Cohesion: $c = 1$ MPa\n- Friction Angle: $\\varphi = 30^\\circ$\n- Dilation Angle: $\\psi = 10^\\circ$\n\nFrom these, we derive the elastic shear modulus $G$ and bulk modulus $K$:\n$$\nG = \\frac{E}{2(1+\\nu)} = \\frac{10000}{2(1+0.3)} \\approx 3846.15 \\text{ MPa}\n$$\n$$\nK = \\frac{E}{3(1-2\\nu)} = \\frac{10000}{3(1-2 \\times 0.3)} \\approx 8333.33 \\text{ MPa}\n$$\nThe fourth-order isotropic elastic stiffness tensor $\\mathbb{C}$ relates the stress tensor $\\boldsymbol{\\sigma}$ to the elastic strain tensor $\\boldsymbol{\\varepsilon}^{\\text{e}}$ via $\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{\\text{e}}$. In index notation, this is given by:\n$$\n\\sigma_{ij} = \\lambda_L \\varepsilon_{kk}^{\\text{e}} \\delta_{ij} + 2G \\varepsilon_{ij}^{\\text{e}} = K \\varepsilon_{kk}^{\\text{e}} \\delta_{ij} + 2G \\left(\\varepsilon_{ij}^{\\text{e}} - \\frac{1}{3}\\varepsilon_{kk}^{\\text{e}}\\delta_{ij}\\right)\n$$\nwhere $\\lambda_L$ is the first Lamé parameter, $\\lambda_L = K - \\frac{2}{3}G$.\n\nThe Mohr-Coulomb yield criterion is defined in principal stress space. Let the principal stresses be ordered such that $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$. The yield function $f(\\boldsymbol{\\sigma})$ is the maximum of the functions for the three possible failure planes:\n$$\nf(\\boldsymbol{\\sigma}) = \\max_{i,k \\in \\{1,2,3\\}, i \\ne k} f_{ik}(\\boldsymbol{\\sigma})\n$$\nwhere\n$$\nf_{ik}(\\boldsymbol{\\sigma}) = (1 - \\sin\\varphi)\\, \\sigma_i - (1 + \\sin\\varphi)\\, \\sigma_k - 2 c \\cos\\varphi\n$$\nA stress state is admissible (elastic) if $f(\\boldsymbol{\\sigma}) \\le 0$. Plastic flow occurs when $f(\\boldsymbol{\\sigma}) = 0$ and the state is being loaded.\n\nThe plastic flow is governed by a non-associated plastic potential function $g(\\boldsymbol{\\sigma})$, which has a similar form to the yield function but uses the dilation angle $\\psi$:\n$$\ng_{ik}(\\boldsymbol{\\sigma}) = (1 - \\sin\\psi)\\, \\sigma_i - (1 + \\sin\\psi)\\, \\sigma_k\n$$\nThe plastic strain rate is given by the flow rule $\\dot{\\boldsymbol{\\varepsilon}}^p = \\dot{\\lambda} \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$, where $\\dot{\\lambda}$ is the plastic multiplier rate.\n\nThe algorithm proceeds in discrete time steps. Given the stress $\\boldsymbol{\\sigma}_n$ at step $n$ and a total strain increment $\\Delta\\boldsymbol{\\varepsilon}$, we compute the stress $\\boldsymbol{\\sigma}_{n+1}$ at step $n+1$. The core of the algorithm is the elastic predictor-plastic corrector scheme.\n\n**1. Elastic Predictor**\n\nFirst, a trial stress $\\boldsymbol{\\sigma}^{\\text{tr}}$ is computed by assuming the entire strain increment $\\Delta\\boldsymbol{\\varepsilon}$ is elastic:\n$$\n\\boldsymbol{\\sigma}^{\\text{tr}} = \\boldsymbol{\\sigma}_n + \\Delta\\boldsymbol{\\sigma}^{\\text{el}} = \\boldsymbol{\\sigma}_n + \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}\n$$\nThe elastic stress increment $\\Delta\\boldsymbol{\\sigma}^{\\text{el}}$ is calculated as:\n$$\n\\Delta\\boldsymbol{\\sigma}^{\\text{el}} = K\\,\\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon})\\, \\mathbf{I} + 2 G \\left(\\Delta\\boldsymbol{\\varepsilon} - \\tfrac{1}{3} \\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}) \\mathbf{I}\\right)\n$$\nwhere $\\mathbf{I}$ is the second-order identity tensor and $\\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon})$ is the trace of the strain increment tensor.\n\n**2. Yield Check**\n\nNext, we check if the trial stress state is admissible. We compute the principal stresses of $\\boldsymbol{\\sigma}^{\\text{tr}}$, denoted $\\sigma_1^{\\text{tr}} \\ge \\sigma_2^{\\text{tr}} \\ge \\sigma_3^{\\text{tr}}$, and evaluate the yield function:\n$$\nf^{\\text{tr}} = f(\\boldsymbol{\\sigma}^{\\text{tr}})\n$$\n- If $f^{\\text{tr}} \\le 0$, the step is elastic. The trial stress is the final stress: $\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}}$. The plastic multiplier increment is zero: $\\Delta\\lambda = 0$.\n- If $f^{\\text{tr}} > 0$, the trial stress is outside the yield surface, indicating that plastic deformation has occurred. A plastic corrector step is required.\n\n**3. Plastic Corrector (Implicit Return-Mapping)**\n\nThe plastic corrector step \"returns\" the trial stress to the yield surface. The final stress $\\boldsymbol{\\sigma}_{n+1}$ is related to the trial stress $\\boldsymbol{\\sigma}^{\\text{tr}}$ by:\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}} - \\Delta\\boldsymbol{\\sigma}^p = \\boldsymbol{\\sigma}^{\\text{tr}} - \\Delta\\lambda \\, (\\mathbb{C} : \\mathbf{N})\n$$\nwhere $\\mathbf{N} = \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$ is the plastic flow direction, evaluated at $\\boldsymbol{\\sigma}_{n+1}$. We use an implicit backward Euler scheme, where consistency, $f(\\boldsymbol{\\sigma}_{n+1}) = 0$, must be enforced.\n\nAssuming that the principal directions of stress do not rotate during the correction step (coaxiality), we can work in the principal stress space of $\\boldsymbol{\\sigma}^{\\text{tr}}$. Let the active plane at the trial state be defined by the maximum principal stress $\\sigma_a^{\\text{tr}}$ and minimum principal stress $\\sigma_b^{\\text{tr}}$. The plastic flow direction vector $\\mathbf{N}$ in this principal basis has components:\n$$\nN_a = 1 - \\sin\\psi, \\quad N_b = -(1 + \\sin\\psi), \\quad N_m = 0\n$$\nwhere the index $m$ refers to the intermediate principal stress. The principal components of the tensor $\\mathbb{C} : \\mathbf{N}$ are denoted $S_a, S_b, S_m$ and are given by:\n$$\nS_a = -2 K \\sin\\psi + 2 G \\left(1 - \\tfrac{1}{3}\\sin\\psi\\right) \\\\\nS_b = -2 K \\sin\\psi - 2 G \\left(1 + \\tfrac{1}{3}\\sin\\psi\\right) \\\\\nS_m = -2 K \\sin\\psi + \\tfrac{4}{3} G \\sin\\psi\n$$\nThe consistency condition $f_{ab}(\\boldsymbol{\\sigma}_{n+1}) = 0$ is a linear equation in $\\Delta\\lambda$. Substituting the expression for the updated principal stresses $\\sigma_i^{n+1} = \\sigma_i^{\\text{tr}} - \\Delta\\lambda\\, S_i$ into the yield function gives:\n$$\n(1-\\sin\\varphi)(\\sigma_a^{\\text{tr}} - \\Delta\\lambda S_a) - (1+\\sin\\varphi)(\\sigma_b^{\\text{tr}} - \\Delta\\lambda S_b) - 2c\\cos\\varphi = 0\n$$\nRecognizing that $(1-\\sin\\varphi)\\sigma_a^{\\text{tr}} - (1+\\sin\\varphi)\\sigma_b^{\\text{tr}} - 2c\\cos\\varphi = f^{\\text{tr}}_{ab} = f^{\\text{tr}}$, we can solve for $\\Delta\\lambda$:\n$$\n\\Delta\\lambda = \\frac{f^{\\text{tr}}}{(1 - \\sin\\varphi)\\, S_a - (1 + \\sin\\varphi)\\, S_b}\n$$\nWith $\\Delta\\lambda$ computed, the final principal stresses $\\sigma_i^{n+1}$ are found, and the final stress tensor $\\boldsymbol{\\sigma}_{n+1}$ is reconstructed using the eigenvectors of $\\boldsymbol{\\sigma}^{\\text{tr}}$. For the special cases in this problem, all tensors are diagonal, so reconstruction is trivial.\n\n**4. KKT-Based Loading/Unloading Diagnostic**\n\nThe final step is to classify the event based on the KKT conditions. This is particularly important for initial states $\\boldsymbol{\\sigma}_n$ that are on the yield surface ($f(\\boldsymbol{\\sigma}_n) \\approx 0$).\nLet $f_n = f(\\boldsymbol{\\sigma}_n)$.\n- **Code 0 (Elastic Interior):** If $f_n$ is significantly less than $0$, the initial state is inside the yield domain. Any subsequent state remains elastic or just reaches the yield surface.\n- For states where $f_n \\approx 0$:\n    - **Code 3 (Plastic Loading):** If the return-mapping algorithm was triggered, resulting in a plastic multiplier increment $\\Delta\\lambda > 0$, the event is classified as plastic loading.\n    - If $\\Delta\\lambda = 0$ (i.e., $f^{\\text{tr}} \\le 0$), the state is either undergoing true unloading or neutral loading. To distinguish between them, we examine the rate of change of the yield function, $\\dot{f}$, for the set of active planes $\\mathcal{A}$ at $\\boldsymbol{\\sigma}_n$.\n    $$\n    \\mathcal{A} = \\left\\{ (i,k) \\,:\\, i\\ne k,\\ f_{ik}(\\boldsymbol{\\sigma}_n) = f_n \\right\\}\n    $$\n    The rate $\\dot{f}_{ik}$ is approximated using the elastic stress rate $\\dot{\\boldsymbol{\\sigma}}^{\\text{el}} = \\mathbb{C} : \\dot{\\boldsymbol{\\varepsilon}} \\approx \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}$. We need the principal stress rates, $\\dot{\\sigma}_i$, which are found by projecting $\\dot{\\boldsymbol{\\sigma}}^{\\text{el}}$ onto the eigenbasis of $\\boldsymbol{\\sigma}_n$. For the diagonal tensors in this problem, the principal stress rates are simply the diagonal components of $\\Delta\\boldsymbol{\\sigma}^{\\text{el}}$.\n    $$\n    \\dot{f}_{ik} \\approx (1 - \\sin\\varphi)\\, \\dot{\\sigma}_i - (1 + \\sin\\varphi)\\, \\dot{\\sigma}_k\n    $$\n    - **Code 1 (True Unloading):** If $\\max_{(i,k)\\in\\mathcal{A}} \\dot{f}_{ik} < 0$, the stress trajectory moves into the elastic domain.\n    - **Code 2 (Neutral Loading):** If $\\dot{f}_{ik} = 0$ for all $(i,k)\\in\\mathcal{A}$ (within a numerical tolerance), the stress trajectory moves tangentially to the yield surface.\n\n**Application to Test Cases**\nFor test cases 1, 2, and 3, the initial stress state $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(33.464, 33.464, 10)$ is on a corner of the yield surface where $\\sigma_1 = \\sigma_2 > \\sigma_3$. The active planes are $(1,3)$ and $(2,3)$. The diagnostic must be evaluated for both planes. For case 4, the hydrostatic stress state $\\boldsymbol{\\sigma}_n = \\mathrm{diag}(10, 10, 10)$ yields $f_n = (10)(1-\\sin\\varphi) - (10)(1+\\sin\\varphi) - 2c\\cos\\varphi = -20\\sin\\varphi - 2c\\cos\\varphi < 0$, which is clearly in the elastic interior. The provided Python implementation will execute this complete logic for each case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a Mohr-Coulomb return-mapping algorithm and KKT-based diagnostic\n    for a suite of test cases.\n    \"\"\"\n    \n    # --- Material Parameters ---\n    E = 10000.0  # MPa\n    nu = 0.3\n    phi_deg = 30.0\n    psi_deg = 10.0\n    c = 1.0  # MPa\n    \n    # --- Derived Parameters ---\n    phi_rad = np.radians(phi_deg)\n    psi_rad = np.radians(psi_deg)\n    sin_phi = np.sin(phi_rad)\n    cos_phi = np.cos(phi_rad)\n    sin_psi = np.sin(psi_rad)\n    \n    G = E / (2.0 * (1.0 + nu))\n    K = E / (3.0 * (1.0 - 2.0 * nu))\n    \n    # Pre-calculate factors for yield and potential functions\n    f_factor1 = 1.0 - sin_phi\n    f_factor2 = 1.0 + sin_phi\n    f_const = 2.0 * c * cos_phi\n\n    # --- Test Suite ---\n    # sigma_n arrays are in MPa, delta_eps are dimensionless\n    test_cases = [\n        { # Case 1: Neutral loading at a corner\n            \"sigma_n\": np.diag([33.464, 33.464, 10.0]),\n            \"delta_eps\": np.diag([1.0e-5, 1.0e-5, -4.444444444444445e-6])\n        },\n        { # Case 2: True unloading at a corner\n            \"sigma_n\": np.diag([33.464, 33.464, 10.0]),\n            \"delta_eps\": np.diag([1.0e-5, 1.0e-5, -3.0e-6])\n        },\n        { # Case 3: Plastic loading at a corner\n            \"sigma_n\": np.diag([33.464, 33.464, 10.0]),\n            \"delta_eps\": np.diag([1.0e-5, 1.0e-5, -6.0e-6])\n        },\n        { # Case 4: Elastic interior\n            \"sigma_n\": np.diag([10.0, 10.0, 10.0]),\n            \"delta_eps\": np.diag([0.0, 0.0, 0.0])\n        }\n    ]\n    \n    results = []\n    tol = 1e-9\n\n    # --- Stiffness Tensor Action ---\n    I = np.identity(3)\n    def C_dot_eps(delta_eps_mat):\n        trace_eps = np.trace(delta_eps_mat)\n        # Using K and G formulation from problem statement\n        return K * trace_eps * I + 2 * G * (delta_eps_mat - (1/3) * trace_eps * I)\n\n    # --- Helper Functions ---\n    def get_principal_values(sigma_mat):\n        # eigvalsh returns sorted ascending, we need descending for sigma_1 >= sigma_2 >= sigma_3\n        return np.linalg.eigvalsh(sigma_mat)[::-1]\n\n    def eval_yield_function(prin_stresses):\n        s1, s2, s3 = prin_stresses\n        # Check all three planes\n        f12 = f_factor1 * s1 - f_factor2 * s2 - f_const\n        f13 = f_factor1 * s1 - f_factor2 * s3 - f_const\n        f23 = f_factor1 * s2 - f_factor2 * s3 - f_const\n        f_max = max(f12, f13, f23)\n        return f_max, (f12, f13, f23)\n\n    for case in test_cases:\n        sigma_n = case[\"sigma_n\"]\n        delta_eps = case[\"delta_eps\"]\n\n        # --- Part 1: Perform Stress Update (Predictor-Corrector) ---\n        delta_lambda = 0.0\n        \n        # 1. Elastic predictor\n        delta_sigma_el = C_dot_eps(delta_eps)\n        sigma_tr = sigma_n + delta_sigma_el\n        \n        # Since all input tensors are diagonal, the principal axes are fixed\n        # and we can work directly with the diagonal components (principal values).\n        # We must sort them to maintain convention sigma_1 >= sigma_2 >= sigma_3.\n        # However, for the given cases, sorting might reorder indices,\n        # so we get eigenvectors to map back. This is more general.\n        prin_vals_tr_unsorted, prin_vecs_tr = np.linalg.eigh(sigma_tr)\n        sort_order = np.argsort(prin_vals_tr_unsorted)[::-1]\n        prin_vals_tr = prin_vals_tr_unsorted[sort_order]\n        prin_vecs_tr = prin_vecs_tr[:, sort_order]\n        \n        # 2. Yield check\n        f_tr, _ = eval_yield_function(prin_vals_tr)\n\n        # 3. Plastic corrector\n        if f_tr > tol:\n            # Assumes active plane is (1,3) in the sorted principal stress space\n            a_idx, b_idx = 0, 2\n            \n            # Components of C:N in principal space\n            S_a = -2 * K * sin_psi + 2 * G * (1 - (1/3) * sin_psi)\n            S_b = -2 * K * sin_psi - 2 * G * (1 + (1/3) * sin_psi)\n            S_m = -2 * K * sin_psi + (4/3) * G * sin_psi\n            \n            # Numerator is f_tr for the active plane (1,3)\n            f_tr_active = f_factor1 * prin_vals_tr[a_idx] - f_factor2 * prin_vals_tr[b_idx] - f_const\n\n            # Denominator for plastic multiplier\n            denominator = f_factor1 * S_a - f_factor2 * S_b\n            \n            if abs(denominator) < tol:\n                # Should not happen for valid material parameters\n                delta_lambda = 0.0\n            else:\n                delta_lambda = f_tr_active / denominator\n\n        # Based on delta_lambda, we can now perform classification.\n        \n        # --- Part 2: KKT-based Diagnostic ---\n        prin_vals_n = get_principal_values(sigma_n)\n        f_n, _ = eval_yield_function(prin_vals_n)\n        \n        if f_n < -tol:\n            # Code 0: Elastic Interior\n            results.append(0)\n            continue\n            \n        # If f_n is on the yield surface (within tolerance)\n        if delta_lambda > tol:\n            # Code 3: Plastic Loading\n            results.append(3)\n        else: # delta_lambda is zero\n            # Distinguish between true unloading and neutral loading\n            # Eigenbasis of sigma_n is the standard basis for these test cases\n            prin_stress_rates_el = np.diag(delta_sigma_el)\n            \n            # Since sigma_n is at a corner with sigma1=sigma2, we must check both planes\n            # that form the corner. Here, (1,3) and (2,3) using original indexing.\n            # sigma_n = diag(s1, s2, s3) with s1=s2. Principal stresses are already sorted.\n            # The active planes are defined by (s1, s3) and (s2, s3).\n            f_dot_ik_list = []\n            \n            # Note: For sigma_n=diag(33.464, 33.464, 10), prin_vals_n = [33.464, 33.464, 10]\n            # Active yield function values come from (prin_vals_n[0], prin_vals_n[2]) and (prin_vals_n[1], prin_vals_n[2])\n            \n            # f_dot for plane (1,3)\n            # The indices 0 and 2 correspond to sigma_1 and sigma_3 (descending order)\n            f_dot_13 = f_factor1 * prin_stress_rates_el[0] - f_factor2 * prin_stress_rates_el[2]\n            f_dot_ik_list.append(f_dot_13)\n\n            # f_dot for plane (2,3)\n            f_dot_23 = f_factor1 * prin_stress_rates_el[1] - f_factor2 * prin_stress_rates_el[2]\n            f_dot_ik_list.append(f_dot_23)\n\n            # Note: for the symmetric cases 1-3, f_dot_13 will equal f_dot_23.\n            \n            if max(f_dot_ik_list) < -tol:\n                # Code 1: True Unloading\n                results.append(1)\n            elif all(abs(f_dot) <= tol for f_dot in f_dot_ik_list):\n                # Code 2: Neutral Loading\n                results.append(2)\n            else:\n                # This case (e.g., one f_dot is zero, another is negative) is not\n                # covered by the simple classification codes in the problem spec.\n                # It won't be reached by the provided test cases.\n                # As a fallback, we could consider it a form of unloading.\n                results.append(1) # Fallback, should not be hit\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}