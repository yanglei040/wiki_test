{
    "hands_on_practices": [
        {
            "introduction": "The efficiency of explicit time-stepping schemes is governed by the Courant-Friedrichs-Lewy (CFL) condition, which dictates that the time step must be proportional to the smallest spatial scale in the mesh. This practice allows you to directly calculate the maximum stable local time step for different elements in a Discontinuous Galerkin (DG) discretization . By connecting the element size, polynomial degree, and time integrator properties, this exercise solidifies the fundamental motivation behind local time stepping (LTS).",
            "id": "3396758",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ on a nonuniform mesh consisting of three elements with sizes $h_{1} = 1$, $h_{2} = 1/2$, and $h_{3} = 1/4$. The spatial discretization is performed using the Discontinuous Galerkin (DG) method with polynomial degree $p = 2$ on each element and an upwind numerical flux. Time integration is performed using the Strong Stability-Preserving Runge-Kutta method of order 3 (SSP-RK3). Assume the advection speed is $a = 1$ and that the computation is non-dimensionalized so that time is reported without physical units.\n\nLet $\\Delta t_{K}$ denote the maximal stable local time step on element $K$ under a local time stepping strategy. Starting from the stability requirement for explicit time integration of linear systems and standard DG estimates for the spectral radius under upwind fluxes, derive the functional dependence of $\\Delta t_{K}$ on $h_{K}$, $a$, and $p$, using only the following assumption: there exists a stability constant $C(p)$ such that the forward Euler stable time step satisfies $\\Delta t_{\\mathrm{FE},K} \\le C(p)\\,h_{K}/|a|$, with $C(p) = 1/(2p+1)$. Then, accounting for SSP-RK3, compute the three local time steps $\\Delta t_{1}$, $\\Delta t_{2}$, and $\\Delta t_{3}$ for the given mesh.\n\nExpress each $\\Delta t_{K}$ as an exact fraction; do not round or decimalize. Provide your final answer as a row vector $\\bigl[\\Delta t_{1},\\Delta t_{2},\\Delta t_{3}\\bigr]$.",
            "solution": "The user wants me to solve a numerical analysis problem involving local time stepping for a Discontinuous Galerkin (DG) discretization of the linear advection equation. First, I must validate the problem statement.\n\n### Step 1: Extract Givens\n- **Governing Equation**: The one-dimensional linear advection equation, $u_{t} + a\\,u_{x} = 0$.\n- **Advection Speed**: $a = 1$.\n- **Mesh**: A nonuniform mesh of three elements with sizes $h_{1} = 1$, $h_{2} = 1/2$, and $h_{3} = 1/4$.\n- **Spatial Discretization**: Discontinuous Galerkin (DG) method with polynomial degree $p = 2$ on each element.\n- **Numerical Flux**: Upwind flux.\n- **Time Integration**: Strong Stability Preserving Runge–Kutta method of order $3$ (SSP–RK3).\n- **Stability Assumption**: The forward Euler stable time step for an element $K$ is given by $\\Delta t_{\\mathrm{FE},K} \\le C(p)\\,h_{K}/|a|$.\n- **Stability Constant**: The function $C(p)$ is defined as $C(p) = 1/(2p+1)$.\n- **Objective**: Compute the three maximal stable local time steps $\\Delta t_{1}$, $\\Delta t_{2}$, and $\\Delta t_{3}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to validation against the established criteria.\n- **Scientific Grounding**: The problem is well-grounded in the established theory of numerical methods for partial differential equations. The DG method, SSP time integrators, and Courant-Friedrichs-Lewy (CFL) stability conditions are all standard concepts in computational science and engineering. The provided stability estimate $\\Delta t_{\\mathrm{FE},K} \\le \\frac{h_K}{(2p+1)|a|}$ is a known result for the 1D linear advection equation discretized with DG and an upwind flux.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary parameters ($a$, $p$, $h_K$) and definitions (the specific time integrator and the base stability condition) to determine a unique solution for the local time steps.\n- **Objectivity**: The problem is stated in precise, objective, and unambiguous mathematical terms.\n- **Flaw Checklist**: The problem does not violate any of the specified invalidity criteria. It is scientifically sound, formalizable, complete, realistic, and well-structured.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be provided.\n\nThe semi-discretization of the partial differential equation $u_{t} + a\\,u_{x} = 0$ using the Discontinuous Galerkin method results in a system of ordinary differential equations (ODEs) for the degrees of freedom on each element. This system can be written abstractly as $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}_h(\\mathbf{u})$, where $\\mathbf{L}_h$ is the spatial discretization operator. For an explicit time integration scheme to be stable, the time step $\\Delta t$ must be chosen such that $\\Delta t$ scaled by the spectral radius of $\\mathbf{L}_h$ lies within the stability region of the time integrator.\n\nThe problem provides the stability constraint for the simplest explicit time integrator, the Forward Euler (FE) method. For an element $K$ in the mesh, the maximal stable time step under the FE method is given as:\n$$ \\Delta t_{\\mathrm{FE},K}^{\\max} = C(p)\\,\\frac{h_{K}}{|a|} $$\nWith the provided definition $C(p) = 1/(2p+1)$, this becomes:\n$$ \\Delta t_{\\mathrm{FE},K}^{\\max} = \\frac{1}{2p+1} \\frac{h_{K}}{|a|} $$\nThis is a form of the CFL condition, specific to the DG discretization.\n\nThe problem specifies the use of a Strong Stability Preserving Runge–Kutta method of order $3$ (SSP-RK3). SSP methods are designed such that they remain stable for a given ODE system under any time step $\\Delta t$ that is stable for the Forward Euler method, scaled by a factor known as the SSP coefficient, $c$. The stability condition for an SSP method is:\n$$ \\Delta t \\le c \\cdot \\Delta t_{\\mathrm{FE}}^{\\max} $$\nThe specific method, SSP-RK3, refers to the popular third-order, three-stage scheme developed by Shu and Osher. A fundamental and defining property of this method is that its SSP coefficient is $c=1$. Therefore, for this method, the maximum stable time step is identical to the maximum stable Forward Euler time step.\n\nLet $\\Delta t_K$ be the maximal stable local time step on element $K$ using the SSP-RK3 integrator. We can write:\n$$ \\Delta t_{K} = c_{\\mathrm{SSP-RK3}} \\cdot \\Delta t_{\\mathrm{FE},K}^{\\max} $$\nSince $c_{\\mathrm{SSP-RK3}} = 1$, we have:\n$$ \\Delta t_{K} = \\Delta t_{\\mathrm{FE},K}^{\\max} = \\frac{1}{2p+1} \\frac{h_{K}}{|a|} $$\nThis expression provides the functional dependence of the local time step $\\Delta t_K$ on the element size $h_K$, the advection speed $a$, and the polynomial degree $p$.\n\nNow, we can substitute the specific values given in the problem statement:\n- Polynomial degree: $p = 2$\n- Advection speed: $a = 1$\n\nFirst, we compute the constant factor in the expression for $\\Delta t_K$:\n$$ \\frac{1}{(2p+1)|a|} = \\frac{1}{(2(2)+1)|1|} = \\frac{1}{4+1} = \\frac{1}{5} $$\nThus, the formula for the local time steps simplifies to:\n$$ \\Delta t_{K} = \\frac{h_{K}}{5} $$\n\nWe now apply this formula to each of the three elements using their specified sizes:\n- For element $1$, with $h_{1} = 1$:\n$$ \\Delta t_{1} = \\frac{h_{1}}{5} = \\frac{1}{5} $$\n\n- For element $2$, with $h_{2} = 1/2$:\n$$ \\Delta t_{2} = \\frac{h_{2}}{5} = \\frac{1/2}{5} = \\frac{1}{10} $$\n\n- For element $3$, with $h_{3} = 1/4$:\n$$ \\Delta t_{3} = \\frac{h_{3}}{5} = \\frac{1/4}{5} = \\frac{1}{20} $$\n\nThe three local time steps are $\\Delta t_{1} = 1/5$, $\\Delta t_{2} = 1/10$, and $\\Delta t_{3} = 1/20$. The final answer should be presented as a row vector.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{5} & \\frac{1}{10} & \\frac{1}{20}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While local CFL conditions motivate the use of LTS, they do not guarantee the stability of the coupled, multi-rate system. This practice delves into the crucial topic of global stability analysis by having you construct the exact one-step update operator for a simple LTS scheme . By analyzing the spectral radius of this global operator, you will be able to rigorously determine the stability limit and compare it against simpler, often optimistic, heuristics.",
            "id": "3396681",
            "problem": "Consider the one-dimensional linear advection equation with constant positive speed $a>0$ on a periodic domain of length $L=1$, discretized by a discontinuous Galerkin (DG) method with polynomial degree $p=0$ (piecewise constants) on a uniform mesh of $N$ cells. Let the cell width be $h=L/N$. Using an upwind numerical flux and a forward Euler time integrator, the semi-discrete system can be written in vector form as $\\frac{d\\mathbf{u}}{dt}=\\mathbf{A}\\mathbf{u}$, where $\\mathbf{u}\\in\\mathbb{R}^N$ collects the cell averages and $\\mathbf{A}\\in\\mathbb{R}^{N\\times N}$ is the circulant matrix encoding the upwind DG coupling with periodic boundary conditions.\n\nWe consider a local time stepping (LTS) schedule with two time-step levels alternating along the periodic grid: indices $i$ with even parity use a small step $\\Delta t_s$, and indices $i$ with odd parity use a large step $2\\Delta t_s$. Over one macro-step of duration $T=2\\Delta t_s$, the update schedule is as follows:\n- First substep: simultaneously update all even-indexed cells (the small-step set) with a forward Euler step of size $\\Delta t_s$, using the most recently available neighbor states at the beginning of this substep.\n- Second substep: simultaneously update all even-indexed cells again with a forward Euler step of size $\\Delta t_s$, using current neighbor states available at the beginning of this substep.\n- Third substep: simultaneously update all odd-indexed cells (the large-step set) with a forward Euler step of size $2\\Delta t_s$, using current neighbor states available at the beginning of this substep.\n\nFor the $p=0$ DG upwind discretization with $a>0$, the semi-discrete equation on cell $i$ is\n$$\n\\frac{du_i}{dt} \\;=\\; -\\frac{a}{h}\\,\\big(u_i - u_{i-1}\\big),\n$$\nwith periodic indexing. A forward Euler step of size $\\Delta t$ at a given time uses\n$$\nu_i^{\\text{new}} \\;=\\; u_i^{\\text{old}} \\;-\\; \\Delta t\\,\\frac{a}{h}\\,\\big(u_i^{\\text{old}} - u_{i-1}^{\\text{old}}\\big),\n$$\napplied simultaneously over the selected index set.\n\nDefine the global update operator $\\mathbf{G}\\in\\mathbb{R}^{N\\times N}$ mapping the state from time $t^n$ to $t^{n+1}=t^n+T$ produced by the above three-substep LTS schedule. Because the system and updates are linear, $\\mathbf{G}$ is a linear operator that can be constructed by applying the schedule to basis vectors.\n\nThe Strong Stability Preserving (SSP) forward Euler time-step bound for the $p=0$ upwind semi-discretization is the Courant-Friedrichs-Lewy (CFL) condition $a\\,\\Delta t / h \\le 1$ for any explicit step. In the LTS setting with two levels, this requires both $a\\,\\Delta t_s / h \\le 1$ and $a\\,(2\\Delta t_s)/h \\le 1$, that is, $c \\equiv a\\,\\Delta t_s/h \\le 1/2$.\n\nYour tasks are:\n- Construct the global update operator $\\mathbf{G}$ corresponding to one macro-step $T=2\\Delta t_s$ for the described LTS scheme by applying the substeps to the canonical basis, using the $p=0$ DG upwind forward Euler update at each substep.\n- Compute the spectral radius $\\rho(\\mathbf{G})$, defined as the maximum magnitude of the eigenvalues of $\\mathbf{G}$.\n- Verify stability against the SSP bound by comparing whether $\\rho(\\mathbf{G})\\le 1$ coincides with the SSP condition $c\\le 1/2$.\n\nUse the following test suite with periodic grids and alternating time-step levels:\n- Test $1$: $N=8$, $a=1$, $c=0.45$, hence $h=1/N$ and $\\Delta t_s = c\\,h/a$.\n- Test $2$: $N=8$, $a=1$, $c=0.50$, hence $h=1/N$ and $\\Delta t_s = c\\,h/a$.\n- Test $3$: $N=8$, $a=1$, $c=0.55$, hence $h=1/N$ and $\\Delta t_s = c\\,h/a$.\n- Test $4$: $N=8$, $a=1$, $c=0.10$, hence $h=1/N$ and $\\Delta t_s = c\\,h/a$.\n\nFor each test, compute and report the triple consisting of:\n- the spectral radius $\\rho(\\mathbf{G})$ rounded to six decimals,\n- the boolean value indicating whether $\\rho(\\mathbf{G}) \\le 1$ (with a numerical tolerance appropriate for floating-point eigenvalue computations),\n- the boolean value indicating whether the SSP bound $c \\le 1/2$ holds.\n\nFinal output format: Your program should produce a single line of output containing the results for all tests as a comma-separated list of lists, where each inner list is of the form $[\\rho,\\text{spectral\\_stable},\\text{ssp\\_ok}]$. For example, an output with two tests might look like $[[0.999999,\\text{True},\\text{True}],[1.234567,\\text{False},\\text{False}]]$.",
            "solution": "The problem statement is a well-posed exercise in the field of numerical analysis for partial differential equations. It is scientifically sound, self-contained, and provides all necessary information to construct and analyze the specified local time stepping (LTS) scheme. All parameters and procedures are clearly defined. Therefore, the problem is valid.\n\nThe core task is to derive the global update operator $\\mathbf{G}$ for a three-substep LTS scheme applied to a discontinuous Galerkin (DG) discretization of the $1$D linear advection equation, and subsequently to analyze its stability by computing its spectral radius, $\\rho(\\mathbf{G})$.\n\nLet the state of the system at the beginning of a macro-step be the vector of cell averages $\\mathbf{u}^n \\in \\mathbb{R}^N$. The macro-step has a duration of $T = 2\\Delta t_s$. The constant Courant number for the small time step is defined as $c = a\\Delta t_s/h$.\n\nThe forward Euler update for a single cell $i$ over a time step $\\Delta t$ is given by:\n$$\nu_i^{\\text{new}} = u_i^{\\text{old}} - \\frac{a \\Delta t}{h} (u_i^{\\text{old}} - u_{i-1}^{\\text{old}})\n$$\nwhere indices are taken periodically modulo $N$.\n\nWe will determine the final state $\\mathbf{u}^{n+1} = \\mathbf{G}\\mathbf{u}^n$ by tracking the state vector through the three substeps of the LTS schedule. Let $\\mathbf{u}^{(0)} = \\mathbf{u}^n$.\n\nSubstep 1: Update even-indexed cells with step $\\Delta t_s$.\nFor cells $i$ where $i\\%2=0$ (even), the update uses a time step $\\Delta t_s$, corresponding to the Courant number $c$.\n$$\nu_i^{(1)} = u_i^{(0)} - c (u_i^{(0)} - u_{i-1}^{(0)}) = (1-c)u_i^{(0)} + c u_{i-1}^{(0)} \\quad \\text{for } i \\text{ even}\n$$\nFor cells $i$ where $i\\%2=1$ (odd), the state is unchanged.\n$$\nu_i^{(1)} = u_i^{(0)} \\quad \\text{for } i \\text{ odd}\n$$\n\nSubstep 2: Update even-indexed cells again with step $\\Delta t_s$. The initial state for this step is $\\mathbf{u}^{(1)}$.\n$$\nu_i^{(2)} = u_i^{(1)} - c (u_i^{(1)} - u_{i-1}^{(1)}) = (1-c)u_i^{(1)} + c u_{i-1}^{(1)} \\quad \\text{for } i \\text{ even}\n$$\n$$\nu_i^{(2)} = u_i^{(1)} \\quad \\text{for } i \\text{ odd}\n$$\nTo express $\\mathbf{u}^{(2)}$ in terms of $\\mathbf{u}^{(0)}$, we substitute the expressions for $\\mathbf{u}^{(1)}$.\nFor an even index $i$, the index $i-1$ is odd. Thus, $u_{i-1}^{(1)} = u_{i-1}^{(0)}$.\n$$\nu_i^{(2)} = (1-c) \\left( (1-c)u_i^{(0)} + c u_{i-1}^{(0)} \\right) + c u_{i-1}^{(0)} = (1-c)^2 u_i^{(0)} + c(1-c)u_{i-1}^{(0)} + c u_{i-1}^{(0)}\n$$\n$$\nu_i^{(2)} = (1-c)^2 u_i^{(0)} + c(2-c) u_{i-1}^{(0)} \\quad \\text{for } i \\text{ even}\n$$\nFor an odd index $i$, the state is unchanged through the first two substeps: $u_i^{(2)} = u_i^{(1)} = u_i^{(0)}$.\n\nSubstep 3: Update odd-indexed cells with step $2\\Delta t_s$. The initial state for this step is $\\mathbf{u}^{(2)}$. The corresponding Courant number is $a(2\\Delta t_s)/h = 2c$.\n$$\nu_i^{(3)} = u_i^{(2)} - 2c (u_i^{(2)} - u_{i-1}^{(2)}) = (1-2c)u_i^{(2)} + 2c u_{i-1}^{(2)} \\quad \\text{for } i \\text{ odd}\n$$\n$$\nu_i^{(3)} = u_i^{(2)} \\quad \\text{for } i \\text{ even}\n$$\nThe final state is $\\mathbf{u}^{n+1} = \\mathbf{u}^{(3)}$. To express $\\mathbf{u}^{n+1}$ in terms of $\\mathbf{u}^{(0)}$, we substitute the expressions for $\\mathbf{u}^{(2)}$.\nFor an even index $i$, the state is frozen in this substep:\n$$\nu_i^{n+1} = u_i^{(2)} = (1-c)^2 u_i^{(0)} + c(2-c) u_{i-1}^{(0)} \\quad \\text{for } i \\text{ even}\n$$\nFor an odd index $i$, the index $i-1$ is even. We substitute the expressions for $u_i^{(2)}$ and $u_{i-1}^{(2)}$:\n$$\nu_i^{n+1} = (1-2c)u_i^{(0)} + 2c \\left( (1-c)^2 u_{i-1}^{(0)} + c(2-c) u_{i-2}^{(0)} \\right)\n$$\n$$\nu_i^{n+1} = (1-2c)u_i^{(0)} + 2c(1-c)^2 u_{i-1}^{(0)} + 2c^2(2-c) u_{i-2}^{(0)} \\quad \\text{for } i \\text{ odd}\n$$\n\nThese equations define the linear transformation $\\mathbf{u}^{n+1} = \\mathbf{G}\\mathbf{u}^n$. The matrix $\\mathbf{G}$ can be constructed from these relations. The $i$-th row of $\\mathbf{G}$ contains the coefficients that map the components of $\\mathbf{u}^n$ to $u_i^{n+1}$. Let $G_{ij}$ be the entry in row $i$ and column $j$ of $\\mathbf{G}$.\nIf $i$ is even:\n$$\nG_{i,i} = (1-c)^2\n$$\n$$\nG_{i, j} = c(2-c) \\quad \\text{for } j=(i-1) \\pmod N\n$$\nIf $i$ is odd:\n$$\nG_{i,i} = 1-2c\n$$\n$$\nG_{i, j} = 2c(1-c)^2 \\quad \\text{for } j=(i-1) \\pmod N\n$$\n$$\nG_{i, k} = 2c^2(2-c) \\quad \\text{for } k=(i-2) \\pmod N\n$$\nAll other entries of $\\mathbf{G}$ are zero.\n\nThe stability of the scheme is determined by the spectral radius of the amplification matrix, $\\rho(\\mathbf{G}) = \\max_j |\\lambda_j|$, where $\\{\\lambda_j\\}$ are the eigenvalues of $\\mathbf{G}$. The scheme is stable if and only if $\\rho(\\mathbf{G}) \\le 1$. The problem asks to verify if this condition coincides with the Strong Stability Preserving (SSP) condition derived from the largest time step in the system, which is $a (2\\Delta t_s)/h \\le 1$, or $c \\le 1/2$.\n\nFor each test case specified, we will computationally perform the following steps:\n1.  Construct the $N \\times N$ matrix $\\mathbf{G}$ for the given $c$ value, with $N=8$.\n2.  Compute the eigenvalues of $\\mathbf{G}$ using a numerical library.\n3.  Calculate the spectral radius $\\rho(\\mathbf{G})$ as the maximum absolute value of the computed eigenvalues.\n4.  Determine spectral stability by checking if $\\rho(\\mathbf{G}) \\le 1$ (with a small floating-point tolerance).\n5.  Determine if the SSP condition $c \\le 1/2$ is met.\n6.  Report the results in the specified format.\n\nFor $c \\le 1/2$, all coefficients in the update formulas are non-negative. It can also be verified that the sum of the coefficients for each row is exactly $1$, meaning $\\mathbf{G}$ is a stochastic matrix. By the Perron-Frobenius theorem for non-negative matrices, its spectral radius is exactly $1$. For $c > 1/2$, the term $1-2c$ becomes negative, and the spectral radius may exceed $1$. The numerical experiment will confirm this theoretical expectation.",
            "answer": "```python\nimport numpy as np\n\ndef construct_G(N, c):\n    \"\"\"\n    Constructs the global update operator G for the LTS scheme.\n\n    Args:\n        N (int): The number of cells in the mesh.\n        c (float): The Courant number a*dt_s/h.\n\n    Returns:\n        numpy.ndarray: The N x N global update matrix G.\n    \"\"\"\n    G = np.zeros((N, N))\n    for i in range(N):\n        if i % 2 == 0:  # Even-indexed cells\n            # u_i^{n+1} = (1-c)^2 * u_i^n + c(2-c) * u_{i-1}^n\n            G[i, i] = (1 - c)**2\n            G[i, (i - 1 + N) % N] = c * (2 - c)\n        else:  # Odd-indexed cells\n            # u_i^{n+1} = (1-2c)*u_i^n + 2c(1-c)^2*u_{i-1}^n + 2c^2(2-c)*u_{i-2}^n\n            G[i, i] = 1 - 2 * c\n            G[i, (i - 1 + N) % N] = 2 * c * (1 - c)**2\n            G[i, (i - 2 + N) % N] = 2 * c**2 * (2 - c)\n    return G\n\ndef solve():\n    \"\"\"\n    Runs the analysis for the test cases and prints the results.\n    \"\"\"\n    # Test cases defined in the problem statement\n    # N=8, a=1 are fixed for all tests.\n    test_cases = [0.45, 0.50, 0.55, 0.10]\n    N = 8\n    \n    # Tolerance for checking if spectral radius is <= 1.0\n    TOLERANCE = 1e-9\n\n    results_as_strings = []\n\n    for c in test_cases:\n        # Construct the matrix G\n        G = construct_G(N, c)\n\n        # Compute eigenvalues and spectral radius\n        eigenvalues = np.linalg.eigvals(G)\n        spectral_radius = np.max(np.abs(eigenvalues))\n\n        # Check stability conditions\n        is_spectrally_stable = spectral_radius <= 1.0 + TOLERANCE\n        ssp_condition_holds = c <= 0.5\n\n        # Round spectral radius to 6 decimal places\n        rho_rounded = round(spectral_radius, 6)\n\n        # Format the result list for this test case as a string\n        result_str = f\"[{rho_rounded},{str(is_spectrally_stable)},{str(ssp_condition_holds)}]\"\n        results_as_strings.append(result_str)\n\n    # Print the final output in the required format\n    # Example: [[0.999999,True,True],[1.234567,False,False]]\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A robust numerical scheme must do more than just remain stable; for many physical systems, it must also accurately preserve important steady-state solutions, a property known as being \"well-balanced\". This practice explores a sophisticated challenge where naive LTS coupling can break this delicate balance by introducing inconsistencies between the time integration of fluxes and source terms . You will first provide a counterexample showing this failure and then engineer a solution by designing a custom time quadrature that restores the well-balanced property, illustrating a key principle in designing high-fidelity LTS methods for complex applications.",
            "id": "3396698",
            "problem": "Consider the one-dimensional shallow water equations linearized about a quiescent state of constant mean depth $H>0$ over a stationary bed $b(x)$,\n$$\n\\eta_{t} + m_{x} = 0,\\qquad m_{t} + g H\\, \\eta_{x} = - g H\\, b_{x},\n$$\nwhere $\\eta(x,t)$ is the free-surface elevation relative to $H$, $m(x,t)$ is the discharge, and $g$ is gravitational acceleration. The lake-at-rest equilibrium is defined by $m(x,t)\\equiv 0$ and $\\eta(x,t) + b(x) \\equiv \\text{const}$, which is a steady solution of the partial differential equations.\n\nDiscretize this system by a piecewise-constant Discontinuous Galerkin (DG) method on two adjacent cells $K_{L}$ and $K_{R}$ with a shared interface at $x_{1/2}$. Assume a spatially well-balanced semi-discretization so that the semi-discrete residual vanishes for the lake-at-rest equilibrium. Now apply explicit time integration with Local Time Stepping (LTS): the left cell $K_{L}$ advances with a macro-step of size $\\Delta>0$, while the right cell $K_{R}$ subcycles with three equal substeps of size $\\Delta/3$. Denote the midpoints of the three substeps by $t_{1}=\\Delta/6$, $t_{2}=\\Delta/2$, and $t_{3}=5\\Delta/6$.\n\nAt the shared interface, let the (right-going) numerical momentum flux contribution entering $K_{L}$ be represented, due to a local in-time predictor used on $K_{R}$, by a quadratic-in-time dependence over $[0,\\Delta]$,\n$$\nF(t)\\;=\\;A + B\\, t + C\\, t^{2},\n$$\nwith constants $A$, $B$, and $C$ (independent of $t$ over $[0,\\Delta]$). In exact lake-at-rest conditions, cancellation with the bed-slope source term over $K_{L}$ requires that the time integral of $F(t)$ over $[0,\\Delta]$ matches the time integral of the (equally quadratic) source term contribution $S(t)$, but a naive LTS coupling uses mismatched time quadratures:\n- For the face flux entering $K_{L}$, the slow cell naively consumes an equal-weight average of the three fast substep flux values, i.e., it uses the composite rectangle rule $\\frac{\\Delta}{3}\\sum_{k=1}^{3}F(t_{k})$.\n- For the bed-slope source in $K_{L}$, the slow cell uses a single-stage midpoint rule $\\Delta\\, S(t_{2})$.\n\nAssume $S(t)\\equiv F(t)$ for $t\\in[0,\\Delta]$ to reflect the well-balanced target at the continuum level. Starting from $m\\equiv 0$ at $t=0$, the naive LTS update of $m$ over $K_{L}$ will, in general, not remain zero. First, present a steady-state counterexample by computing the spurious net update\n$$\n\\Delta m_{L}^{\\text{naive}} \\;=\\; \\frac{\\Delta}{\\Delta x}\\left(\\frac{\\Delta}{3}\\sum_{k=1}^{3}F(t_{k}) \\;-\\; \\Delta\\, F(t_{2})\\right),\n$$\nexpressed in terms of the coefficient $C$ and the time step $\\Delta$ (you may regard $\\Delta x>0$ as a constant scaling factor and extract the factor $1/\\Delta x$), thereby showing explicitly that the naive LTS breaks the lake-at-rest equilibrium when $C\\neq 0$.\n\nNext, to fix the imbalance without altering substep times $\\{t_{k}\\}_{k=1}^{3}$, design a face-and-source time quadrature on the slow cell $K_{L}$ supported at the same nodes $\\{t_{1},t_{2},t_{3}\\}$ with weights $\\{w_{1},w_{2},w_{3}\\}$ such that, for any quadratic polynomial in time $Q(t)=\\alpha+\\beta t+\\gamma t^{2}$, the quadrature\n$$\n\\Delta \\sum_{k=1}^{3} w_{k}\\, Q(t_{k})\n$$\nis exactly equal to the exact time integral $\\int_{0}^{\\Delta} Q(t)\\, dt$. This condition enforces exact cancellation of face and source contributions for any quadratic-in-time $F(t)$ and $S(t)$, thereby restoring the discrete well-balanced property under the given LTS.\n\nCompute the exact weights $\\{w_{1},w_{2},w_{3}\\}$ as rational numbers. Report your final answer as the row vector $\\bigl(w_{1},\\,w_{2},\\,w_{3}\\bigr)$, written in exact fractional form. No rounding is required, and no physical units are to be included in the final answer.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It poses a standard question in the numerical analysis of partial differential equations, specifically concerning well-balanced schemes under local time stepping. The prompt contains all necessary information to proceed.\n\nThe problem consists of two parts. First, we must demonstrate that a naive Local Time Stepping (LTS) scheme breaks the lake-at-rest-preserving (well-balanced) property. Second, we must compute a set of quadrature weights that restore this property.\n\nPart 1: Spurious update in the naive LTS scheme.\n\nThe problem asks to compute the spurious net update $\\Delta m_{L}^{\\text{naive}}$ given by the formula:\n$$\n\\Delta m_{L}^{\\text{naive}} = \\frac{\\Delta}{\\Delta x}\\left(\\frac{\\Delta}{3}\\sum_{k=1}^{3}F(t_{k}) - \\Delta F(t_{2})\\right)\n$$\nWe are given $F(t) = A + B t + C t^2$ and the quadrature points $t_1 = \\frac{\\Delta}{6}$, $t_2 = \\frac{\\Delta}{2}$, and $t_3 = \\frac{5\\Delta}{6}$. We need to compute the term in the parenthesis, which represents the difference between the two naive quadrature approximations of the time integral. Let's call this difference $E_{quad}$.\n$$\nE_{quad} = \\frac{\\Delta}{3}\\sum_{k=1}^{3}F(t_{k}) - \\Delta F(t_{2})\n$$\nFirst, we evaluate $F(t)$ at the given time points:\n$F(t_1) = A + B\\left(\\frac{\\Delta}{6}\\right) + C\\left(\\frac{\\Delta}{6}\\right)^2 = A + \\frac{B\\Delta}{6} + \\frac{C\\Delta^2}{36}$\n$F(t_2) = A + B\\left(\\frac{\\Delta}{2}\\right) + C\\left(\\frac{\\Delta}{2}\\right)^2 = A + \\frac{B\\Delta}{2} + \\frac{C\\Delta^2}{4}$\n$F(t_3) = A + B\\left(\\frac{5\\Delta}{6}\\right) + C\\left(\\frac{5\\Delta}{6}\\right)^2 = A + \\frac{5B\\Delta}{6} + \\frac{25C\\Delta^2}{36}$\n\nNext, we compute the sum required for the composite rectangle rule:\n$$\n\\sum_{k=1}^{3}F(t_{k}) = (A+A+A) + B\\Delta\\left(\\frac{1}{6}+\\frac{3}{6}+\\frac{5}{6}\\right) + C\\Delta^2\\left(\\frac{1}{36}+\\frac{9}{36}+\\frac{25}{36}\\right)\n$$\n$$\n\\sum_{k=1}^{3}F(t_{k}) = 3A + B\\Delta\\left(\\frac{9}{6}\\right) + C\\Delta^2\\left(\\frac{35}{36}\\right) = 3A + \\frac{3}{2}B\\Delta + \\frac{35}{36}C\\Delta^2\n$$\nThe first quadrature term is:\n$$\n\\frac{\\Delta}{3}\\sum_{k=1}^{3}F(t_{k}) = \\frac{\\Delta}{3}\\left(3A + \\frac{3}{2}B\\Delta + \\frac{35}{36}C\\Delta^2\\right) = A\\Delta + \\frac{1}{2}B\\Delta^2 + \\frac{35}{108}C\\Delta^3\n$$\nThe second quadrature term is:\n$$\n\\Delta F(t_2) = \\Delta\\left(A + \\frac{B\\Delta}{2} + \\frac{C\\Delta^2}{4}\\right) = A\\Delta + \\frac{1}{2}B\\Delta^2 + \\frac{1}{4}C\\Delta^3\n$$\nNow we compute the difference $E_{quad}$:\n$$\nE_{quad} = \\left(A\\Delta + \\frac{1}{2}B\\Delta^2 + \\frac{35}{108}C\\Delta^3\\right) - \\left(A\\Delta + \\frac{1}{2}B\\Delta^2 + \\frac{1}{4}C\\Delta^3\\right)\n$$\nThe terms with coefficients $A$ and $B$ cancel out, as both quadrature rules are exact for constant and linear functions over $[0, \\Delta]$ (the composite midpoint rule is exact for linear functions, and the single midpoint rule is also exact for linear functions over the interval). The error arises from the quadratic term:\n$$\nE_{quad} = \\left(\\frac{35}{108} - \\frac{1}{4}\\right)C\\Delta^3 = \\left(\\frac{35}{108} - \\frac{27}{108}\\right)C\\Delta^3 = \\frac{8}{108}C\\Delta^3 = \\frac{2}{27}C\\Delta^3\n$$\nSubstituting this into the expression for the spurious update:\n$$\n\\Delta m_{L}^{\\text{naive}} = \\frac{\\Delta}{\\Delta x} E_{quad} = \\frac{\\Delta}{\\Delta x} \\left(\\frac{2}{27}C\\Delta^3\\right) = \\frac{2 C \\Delta^4}{27 \\Delta x}\n$$\nThis expression is non-zero if $C \\neq 0$. Since the momentum in cell $K_L$ was initially zero, this non-zero update $\\Delta m_L^{\\text{naive}}$ demonstrates that the naive LTS coupling breaks the well-balanced property for the lake-at-rest state when the temporal dependency of the flux and source terms has a non-zero quadratic component.\n\nPart 2: Design of a well-balanced quadrature.\n\nTo restore the well-balanced property, we need a single quadrature rule for both flux and source terms that is exact for any quadratic polynomial in time. Let the quadrature be defined by weights $\\{w_1, w_2, w_3\\}$ at nodes $\\{t_1, t_2, t_3\\}$. The condition is:\n$$\n\\int_{0}^{\\Delta} Q(t)\\, dt = \\Delta \\sum_{k=1}^{3} w_{k}\\, Q(t_{k})\n$$\nfor any polynomial $Q(t) = \\alpha + \\beta t + \\gamma t^2$. By linearity, it is sufficient to enforce this condition for the basis polynomials $Q(t)=1$, $Q(t)=t$, and $Q(t)=t^2$.\n\n1. For $Q(t)=1$:\n$\\int_0^\\Delta 1\\, dt = \\Delta$. The quadrature gives $\\Delta(w_1 \\cdot 1 + w_2 \\cdot 1 + w_3 \\cdot 1)$.\nThis yields our first equation:\n$$w_1 + w_2 + w_3 = 1$$\n\n2. For $Q(t)=t$:\n$\\int_0^\\Delta t\\, dt = \\frac{\\Delta^2}{2}$. The quadrature gives $\\Delta(w_1 t_1 + w_2 t_2 + w_3 t_3)$.\nSubstituting $t_1=\\frac{\\Delta}{6}$, $t_2=\\frac{\\Delta}{2}$, $t_3=\\frac{5\\Delta}{6}$:\n$\\frac{\\Delta^2}{2} = \\Delta\\left(w_1\\frac{\\Delta}{6} + w_2\\frac{\\Delta}{2} + w_3\\frac{5\\Delta}{6}\\right) = \\frac{\\Delta^2}{6}(w_1 + 3w_2 + 5w_3)$.\nThis yields our second equation:\n$$w_1 + 3w_2 + 5w_3 = 3$$\n\n3. For $Q(t)=t^2$:\n$\\int_0^\\Delta t^2\\, dt = \\frac{\\Delta^3}{3}$. The quadrature gives $\\Delta(w_1 t_1^2 + w_2 t_2^2 + w_3 t_3^2)$.\nSubstituting the squares of the nodes $t_1^2=\\frac{\\Delta^2}{36}$, $t_2^2=\\frac{\\Delta^2}{4}$, $t_3^2=\\frac{25\\Delta^2}{36}$:\n$\\frac{\\Delta^3}{3} = \\Delta\\left(w_1\\frac{\\Delta^2}{36} + w_2\\frac{\\Delta^2}{4} + w_3\\frac{25\\Delta^2}{36}\\right) = \\frac{\\Delta^3}{36}(w_1 + 9w_2 + 25w_3)$.\nThis yields our third equation:\n$$w_1 + 9w_2 + 25w_3 = 12$$\n\nWe now solve the linear system for $(w_1, w_2, w_3)$:\n(1) $w_1 + w_2 + w_3 = 1$\n(2) $w_1 + 3w_2 + 5w_3 = 3$\n(3) $w_1 + 9w_2 + 25w_3 = 12$\n\nSubtracting (1) from (2):\n$(3-1)w_2 + (5-1)w_3 = 3-1 \\implies 2w_2 + 4w_3 = 2 \\implies w_2 + 2w_3 = 1$ (4)\n\nSubtracting (2) from (3):\n$(9-3)w_2 + (25-5)w_3 = 12-3 \\implies 6w_2 + 20w_3 = 9$ (5)\n\nNow we solve the $2 \\times 2$ system for $w_2$ and $w_3$. From (4), we have $w_2 = 1 - 2w_3$. Substituting this into (5):\n$6(1-2w_3) + 20w_3 = 9$\n$6 - 12w_3 + 20w_3 = 9$\n$8w_3 = 3 \\implies w_3 = \\frac{3}{8}$\n\nNow we find $w_2$:\n$w_2 = 1 - 2w_3 = 1 - 2\\left(\\frac{3}{8}\\right) = 1 - \\frac{6}{8} = 1 - \\frac{3}{4} = \\frac{1}{4}$\n\nFinally, we find $w_1$ using (1):\n$w_1 = 1 - w_2 - w_3 = 1 - \\frac{1}{4} - \\frac{3}{8} = \\frac{8-2-3}{8} = \\frac{3}{8}$\n\nThe required weights are $(w_1, w_2, w_3) = \\left(\\frac{3}{8}, \\frac{1}{4}, \\frac{3}{8}\\right)$.\nWith this choice of weights, the time integral approximation is exact for any quadratic polynomial. Therefore, if $S(t) \\equiv F(t)$, the numerical integrals for the flux and source will be identical, ensuring their cancellation in the momentum update and restoring the well-balanced property for the LTS scheme.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{8} & \\frac{1}{4} & \\frac{3}{8}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}