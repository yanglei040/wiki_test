{
    "hands_on_practices": [
        {
            "introduction": "为了真正理解非重叠舒尔补方法，我们首先从一个基础的计算练习开始。这个练习旨在阐明舒尔补算子 $S$ 的一个核心性质：它与离散调和延拓的能量之间的深刻联系。通过在一个简单的Symmetric Interior Penalty Galerkin (SIPG)离散化框架中手动计算单位位移下的能量 $x^T S x$，你将能够直观地把握舒尔补算子的物理意义和代数构造。",
            "id": "3404183",
            "problem": "考虑在一维域 $\\Omega=[0,1]$ 上的齐次扩散方程 $-u''=0$，其具有齐次 Dirichlet 边界条件 $u(0)=0$ 和 $u(1)=0$。我们使用对称内部罚 Galerkin (SIPG) 方法对其进行离散化。网格由两个相等的子域（单元）$E_{1}=[0,\\frac{1}{2}]$ 和 $E_{2}=[\\frac{1}{2},1]$ 组成，每个单元都配备了1次多项式基，该基由参考区间 $[-1,1]$ 上的局部 Legendre 多项式给出，即 $\\phi_{0}(\\xi)=1$ 和 $\\phi_{1}(\\xi)=\\xi$。其中使用了仿射映射 $x=\\frac{h}{2}(\\xi+1)$，而 $h=\\frac{1}{2}$ 是单元长度。在每个单元 $E_{i}$ 上，离散函数为 $u_{i}(\\xi)=a_{i}\\phi_{0}(\\xi)+b_{i}\\phi_{1}(\\xi)$。\n\n设对称内部罚 Galerkin 双线性形式 $a(\\cdot,\\cdot)$ 在一维情况下定义为\n$$\na(u,v)=\\sum_{E}\\int_{E}u'(x)v'(x)\\,dx-\\sum_{F\\in\\mathcal{F}_{\\mathrm{int}}}\\left(\\{u'\\}\\,[v]+\\{v'\\}\\,[u]\\right)+\\sum_{F\\in\\mathcal{F}_{\\mathrm{int}}}\\frac{\\sigma}{h_{F}}[u][v]+\\sum_{F\\in\\mathcal{F}_{\\partial\\Omega}}\\left(-u' n\\, v - v' n\\, u + \\frac{\\sigma}{h_{F}}u v\\right),\n$$\n其中 $\\mathcal{F}_{\\mathrm{int}}$ 是内部面的集合，$\\mathcal{F}_{\\partial\\Omega}$ 是边界面的集合，$h_{F}$ 是相邻单元的长度，$n$ 是面上的外单位法向量，$[u]$ 表示 $u$ 跨越一个内部面的跳跃，$\\{u'\\}$ 表示法向导数在该面上的平均值。罚参数 $\\sigma>0$ 是一个给定的正常数。\n\n在用于间断 Galerkin 方法的非重叠舒尔补框架中，我们凝聚内部单元的系数，从而得到一个作用于面值向量的骨架算子 $S$。在这个双单元的情况下，骨架向量简化为单个标量界面值。将此界面向量表示为 $\\mathbf{x}\\in\\mathbb{R}$，其唯一分量为 $x$，代表在共享内部面 $x=\\frac{1}{2}$ 的两侧施加的公共迹值。\n\n将离散调和延拓定义为在离散空间 $V_{h}$（由 $E_1$ 和 $E_2$ 上的分片1次多项式构成）上，SIPG 能量 $a(u,u)$ 在迹约束 $u(0)=0$、$u(\\tfrac{1}{2}^{-})=x$、$u(\\tfrac{1}{2}^{+})=x$ 和 $u(1)=0$ 下的极小化子 $u_{h}\\in V_{h}$。对于单位位移 $x=1$ 的特殊情况，计算相应的离散调和延拓，并评估 Schur 补能量 $x^{T}S x=a(u_{h},u_{h})$。\n\n以单个实数的形式提供您的最终答案。无需四舍五入，也无需单位。",
            "solution": "该问题要求计算在对称内部罚 Galerkin (SIPG) 离散化的特定情况下的 Schur 补能量 $x^{T}S x$。问题指出，该能量等于离散调和延拓的 SIPG 能量，即 $x^{T}S x = a(u_{h}, u_{h})$。我们需要计算在界面处单位位移（即设置界面值 $x$ 为 $1$）时该能量的值。\n\n首先，我们必须确定界面值为 $x=1$ 时的离散调和延拓 $u_h$。函数 $u_h$ 属于离散空间 $V_h$，该空间由网格单元 $E_{1}=[0,\\frac{1}{2}]$ 和 $E_{2}=[\\frac{1}{2},1]$ 上的分片1次多项式构成。调和延拓被定义为能量 $a(u,u)$ 在一组迹约束下的极小化子。对于我们 $x=1$ 的情况，这些约束是：\n1. $u(0)=0$\n2. $u(\\frac{1}{2}^{-})=1$\n3. $u(\\frac{1}{2}^{+})=1$\n4. $u(1)=0$\n\n空间 $V_h$ 由在每个单元上呈线性的函数组成。让我们将每个单元 $E_i$ 上的函数 $u_h$ 表示为空间坐标 $x$ 的线性多项式。\n在单元 $E_1 = [0, \\frac{1}{2}]$ 上，设 $u_1(x) = c_1 x + d_1$。约束条件为：\n$u_1(0) = 0 \\implies c_1(0) + d_1 = 0 \\implies d_1 = 0$。\n$u_1(\\frac{1}{2}) = 1 \\implies c_1(\\frac{1}{2}) = 1 \\implies c_1 = 2$。\n因此，在 $E_1$ 上，函数为 $u_1(x) = 2x$。其导数为 $u_1'(x) = 2$。\n\n在单元 $E_2 = [\\frac{1}{2}, 1]$ 上，设 $u_2(x) = c_2 x + d_2$。约束条件为：\n$u_2(\\frac{1}{2}) = 1 \\implies c_2(\\frac{1}{2}) + d_2 = 1$。\n$u_2(1) = 0 \\implies c_2(1) + d_2 = 0 \\implies d_2 = -c_2$。\n将第二个方程代入第一个方程得到 $\\frac{1}{2}c_2 - c_2 = 1$，化简为 $-\\frac{1}{2}c_2 = 1$，所以 $c_2 = -2$。这意味着 $d_2 = -(-2) = 2$。\n因此，在 $E_2$ 上，函数为 $u_2(x) = -2x+2 = 2(1-x)$。其导数为 $u_2'(x) = -2$。\n\n离散函数 $u_h$ 由这些约束唯一确定。由于容许函数集仅包含一个元素，定义的极小化方面被平凡地满足。因此，$x=1$ 的离散调和延拓为：\n$$\nu_h(x) = \\begin{cases} 2x & \\text{for } x \\in [0, \\frac{1}{2}] \\\\ 2(1-x) & \\text{for } x \\in [\\frac{1}{2}, 1] \\end{cases}\n$$\n其导数为：\n$$\nu_h'(x) = \\begin{cases} 2 & \\text{for } x \\in (0, \\frac{1}{2}) \\\\ -2 & \\text{for } x \\in (\\frac{1}{2}, 1) \\end{cases}\n$$\n现在我们必须使用给定的双线性形式计算 $a(u_h, u_h)$：\n$$\na(u,v)=\\sum_{E}\\int_{E}u'(x)v'(x)\\,dx-\\sum_{F\\in\\mathcal{F}_{\\mathrm{int}}}\\left(\\{u'\\}\\,[v]+\\{v'\\}\\,[u]\\right)+\\sum_{F\\in\\mathcal{F}_{\\mathrm{int}}}\\frac{\\sigma}{h_{F}}[u][v]+\\sum_{F\\in\\mathcal{F}_{\\partial\\Omega}}\\left(-u' n\\, v - v' n\\, u + \\frac{\\sigma}{h_{F}}u v\\right)\n$$\n我们逐项计算 $a(u_h, u_h)$。\n\n1. 体积分项：$\\sum_{E}\\int_{E}(u_h'(x))^2\\,dx$\n这是在两个单元 $E_1$ 和 $E_2$ 上的积分之和。\n$$\n\\int_{E_1} (u_1'(x))^2 \\,dx = \\int_{0}^{1/2} (2)^2 \\,dx = 4 \\int_{0}^{1/2} dx = 4 \\left(\\frac{1}{2}\\right) = 2.\n$$\n$$\n\\int_{E_2} (u_2'(x))^2 \\,dx = \\int_{1/2}^{1} (-2)^2 \\,dx = 4 \\int_{1/2}^{1} dx = 4 \\left(1-\\frac{1}{2}\\right) = 2.\n$$\n总和是 $2+2=4$。\n\n2. 内部面项：来自 $F \\in \\mathcal{F}_{\\mathrm{int}} = \\{\\frac{1}{2}\\}$ 的贡献。\n这些项涉及内部面 $x=\\frac{1}{2}$ 处的跳跃 $[u_h]$ 和平均 $\\{u_h'\\}$。我们将面上的跳跃定义为左侧 ($L$) 和右侧 ($R$) 单元上值的差，即 $[q] = q_L - q_R$。函数 $u_h$ 的跳跃是：\n$$\n[u_h] = u_1(\\tfrac{1}{2}) - u_2(\\tfrac{1}{2}) = 1 - 1 = 0.\n$$\n由于 $[u_h]=0$，所有包含该因子的项都为零。具体来说，$-\\sum (\\{u_h'\\}[u_h] + \\{u_h'\\}[u_h])$ 和 $\\sum \\frac{\\sigma}{h_F} [u_h][u_h]$ 两项都为零。\n$$\n-2\\{u_h'\\} [u_h] + \\frac{\\sigma}{h_F}[u_h]^2 = -2\\{u_h'\\}(0) + \\frac{\\sigma}{h_F}(0)^2 = 0.\n$$\n因此，来自内部面的贡献为 $0$。\n\n3. 边界面项：来自 $F \\in \\mathcal{F}_{\\partial\\Omega} = \\{0, 1\\}$ 的贡献。\n该项为 $\\sum_{F\\in\\mathcal{F}_{\\partial\\Omega}}\\left(-2u' n\\, u + \\frac{\\sigma}{h_{F}}u^2\\right)$。\n在边界面 $F=\\{0\\}$ 处，函数值为 $u_h(0)=0$。外法线为 $n=-1$。\n贡献为 $-2u_h'(0)n u_h(0) + \\frac{\\sigma}{h}u_h(0)^2 = -2(2)(-1)(0) + \\frac{\\sigma}{1/2}(0)^2 = 0$。\n在边界面 $F=\\{1\\}$ 处，函数值为 $u_h(1)=0$。外法线为 $n=1$。\n贡献为 $-2u_h'(1)n u_h(1) + \\frac{\\sigma}{h}u_h(1)^2 = -2(-2)(1)(0) + \\frac{\\sigma}{1/2}(0)^2 = 0$。\n因此，来自边界面的总贡献为 $0$。\n\n最后，我们将所有贡献相加，得到总能量 $a(u_h, u_h)$：\n$$\na(u_h, u_h) = 4 + 0 + 0 = 4.\n$$\n因此，$x=1$ 时的 Schur 补能量 $x^T S x$ 为 $4$。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "在掌握了舒尔补算子的基本概念后，我们来探讨一个更贴近实际应用的场景：处理非协调离散化。当相邻单元采用不同阶次的多项式时，界面上的耦合需要通过投影来建立。这个练习将指导你为一个二维非协调界面（$p$-非协调）构建界面质量矩阵和 $L^{2}$ 投影矩阵，最终组装出正确的砂浆（mortar）界面算子，这是高级领域分解方法的一项关键技术。",
            "id": "3404186",
            "problem": "考虑两个共享一个垂直界面的二维仿射四边形单元。设左单元为 $K_{L}=[-1,0]\\times[-1,1]$，右单元为 $K_{R}=[0,1]\\times[-1,1]$。公共界面是垂直线段 $\\Gamma=\\{0\\}\\times[-1,1]$，物理长度为 $2$。假设在每一侧都有一个间断 Galerkin (DG) 迹空间，该空间由张量积模态基（使用沿界面坐标的勒让德多项式）在 $\\Gamma$ 上的限制所张成。在左侧，沿 $\\Gamma$ 使用多项式次数 $p_{L}=2$，迹基为 $\\{\\phi_{i}(s)\\}_{i=0}^{2}$，其中 $\\phi_{i}(s)=P_{i}(s)$；在右侧，使用次数 $p_{R}=3$，迹基为 $\\{\\psi_{j}(s)\\}_{j=0}^{3}$，其中 $\\psi_{j}(s)=P_{j}(\\tilde{s})$。这里，$P_{n}$ 表示 $[-1,1]$ 上的 $n$ 阶勒让德多项式，$s\\in[-1,1]$ 是相对于 $K_{L}$ 沿 $\\Gamma$ 向上定向的坐标，而 $\\tilde{s}\\in[-1,1]$ 是在 $K_{R}$ 的局部定向中沿 $\\Gamma$ 的坐标，选择向下定向，因此 $\\tilde{s}=-s$。\n\n使用以下基本事实：\n- $\\Gamma$ 上的 $L^{2}$ 内积是 $(u,v)_{\\Gamma}=\\int_{-1}^{1}u(s)\\,v(s)\\,ds$，因为对于该几何结构，$\\Gamma$ 上的物理到参考的映射具有单位雅可比。\n- 勒让德多项式满足正交关系 $\\int_{-1}^{1}P_{m}(s)\\,P_{n}(s)\\,ds=\\dfrac{2}{2n+1}\\,\\delta_{mn}$。\n- 从右迹空间到左迹空间的 $L^{2}$ 投影定义如下：给定一个系数向量 $c_{R}\\in\\mathbb{R}^{4}$，找到 $c_{L}\\in\\mathbb{R}^{3}$ 使得 $\\sum_{i=0}^{2}c_{L,i}\\phi_{i}$ 最小化 $\\left\\|\\sum_{i=0}^{2}c_{L,i}\\phi_{i}-\\sum_{j=0}^{3}c_{R,j}\\psi_{j}\\right\\|_{L^{2}(\\Gamma)}$。这会产生正规方程 $M_{L}\\,c_{L}=B\\,c_{R}$，其中 $(M_{L})_{ik}=(\\phi_{i},\\phi_{k})_{\\Gamma}$ 且 $B_{ij}=(\\phi_{i},\\psi_{j})_{\\Gamma}$。\n- 在一个针对具有混合迹的对称正定模型问题的非重叠舒尔补方法中，在选定的砂浆迹空间上组装的界面双线性形式等于相邻单元贡献的总和。当砂浆是左迹空间，并且使用上述 $L^{2}$ 投影来表示左空间中的右贡献时，作用于左迹系数的组装界面算子 $S$ 是通过将左界面质量形式与通过投影表示的右界面质量形式相结合而获得的。\n\n任务：\n1. 使用基 $\\{\\phi_{i}\\}$ 和 $\\{\\psi_{j}\\}$ 以及 $\\Gamma$ 上的 $L^{2}$ 内积，显式构造 $\\Gamma$ 上的左右界面质量矩阵 $M_{L}\\in\\mathbb{R}^{3\\times 3}$ 和 $M_{R}\\in\\mathbb{R}^{4\\times 4}$。\n2. 考虑右侧的方向 $\\tilde{s}=-s$，显式构造投影矩阵 $P\\in\\mathbb{R}^{3\\times 4}$，该矩阵通过上述定义的 $L^2$ 投影将右迹系数映射到左迹系数。\n3. 使用以上要素并通过投影在左迹空间上表示右贡献，组装与界面 $\\Gamma$ 相关的砂浆侧界面算子 $S\\in\\mathbb{R}^{3\\times 3}$。\n4. 计算 $\\det(S)$ 并以精确表达式的形式提供最终答案。不要四舍五入。不需要单位。",
            "solution": "该问题要求计算在一个用于间断 Galerkin (DG) 离散化的非重叠舒尔补方法框架下构造的界面算子 $S$ 的行列式。求解过程需要基于勒让德多项式的性质构造几个矩阵，然后根据砂浆方法的规则将它们组合起来。\n\n步骤如下：\n1.  构造界面质量矩阵 $M_L$ 和 $M_R$。\n2.  构造从右迹空间到左迹空间的投影矩阵 $P$。这首先需要构造交叉质量矩阵 $B$。\n3.  组装砂浆侧界面算子 $S$。\n4.  计算 $S$ 的行列式。\n\n首先，我们列出相关的勒让德多项式 $P_n(s)$：\n$P_0(s) = 1$\n$P_1(s) = s$\n$P_2(s) = \\frac{1}{2}(3s^2 - 1)$\n$P_3(s) = \\frac{1}{2}(5s^3 - 3s)$\n我们将使用的关键性质是正交关系 $\\int_{-1}^{1}P_{m}(s)P_{n}(s)ds=\\frac{2}{2n+1}\\delta_{mn}$ 和奇偶性 $P_n(-s) = (-1)^n P_n(s)$。\n\n**任务 1：构造质量矩阵 $M_L$ 和 $M_R$**\n\n左迹空间由 $\\{\\phi_i(s) = P_i(s)\\}_{i=0}^2$ 张成。左质量矩阵 $M_L \\in \\mathbb{R}^{3\\times 3}$ 的元素为 $(M_L)_{ik} = (\\phi_i, \\phi_k)_{\\Gamma} = \\int_{-1}^{1} P_i(s) P_k(s) ds$。由于勒让德多项式的正交性，该矩阵是对角矩阵：\n$$\n(M_L)_{ik} = \\frac{2}{2i+1} \\delta_{ik}\n$$\n对于 $i, k \\in \\{0, 1, 2\\}$，矩阵为：\n$$\nM_L = \\begin{pmatrix}\n\\frac{2}{2(0)+1} & 0 & 0 \\\\\n0 & \\frac{2}{2(1)+1} & 0 \\\\\n0 & 0 & \\frac{2}{2(2)+1}\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 \\\\\n0 & 0 & \\frac{2}{5}\n\\end{pmatrix}\n$$\n\n右迹空间由 $\\{\\psi_j(s) = P_j(\\tilde{s})\\}_{j=0}^3$ 张成，其中 $\\tilde{s} = -s$。右质量矩阵 $M_R \\in \\mathbb{R}^{4\\times 4}$ 的元素为 $(M_R)_{jk} = (\\psi_j, \\psi_k)_{\\Gamma} = \\int_{-1}^{1} P_j(\\tilde{s}) P_k(\\tilde{s}) ds$。我们进行从 $s$ 到 $\\tilde{s}$ 的变量替换。当 $s$ 从 $-1$ 变到 $1$ 时，$\\tilde{s}$ 从 $1$ 变到 $-1$。并且，$ds = -d\\tilde{s}$。\n$$\n(M_R)_{jk} = \\int_{1}^{-1} P_j(\\tilde{s}) P_k(\\tilde{s}) (-d\\tilde{s}) = \\int_{-1}^{1} P_j(\\tilde{s}) P_k(\\tilde{s}) d\\tilde{s}\n$$\n这是标准正交积分。因此，$M_R$ 也是对角矩阵：\n$$\n(M_R)_{jk} = \\frac{2}{2j+1} \\delta_{jk}\n$$\n对于 $j, k \\in \\{0, 1, 2, 3\\}$，矩阵为：\n$$\nM_R = \\begin{pmatrix}\n\\frac{2}{1} & 0 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & \\frac{2}{5} & 0 \\\\\n0 & 0 & 0 & \\frac{2}{7}\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 & 0 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & \\frac{2}{5} & 0 \\\\\n0 & 0 & 0 & \\frac{2}{7}\n\\end{pmatrix}\n$$\n\n**任务 2：构造投影矩阵 $P$**\n\n问题通过正规方程 $M_L c_L = B c_R$ 定义了 $L^2$ 投影，其中 $c_L$ 和 $c_R$ 是系数向量。因此，将右系数映射到左系数的投影矩阵是 $P = M_L^{-1} B$。我们首先需要计算交叉质量矩阵 $B \\in \\mathbb{R}^{3\\times 4}$。其元素为 $B_{ij} = (\\phi_i, \\psi_j)_{\\Gamma}$。\n$$\nB_{ij} = \\int_{-1}^{1} \\phi_i(s) \\psi_j(s) ds = \\int_{-1}^{1} P_i(s) P_j(\\tilde{s}) ds = \\int_{-1}^{1} P_i(s) P_j(-s) ds\n$$\n使用奇偶性 $P_j(-s) = (-1)^j P_j(s)$：\n$$\nB_{ij} = \\int_{-1}^{1} P_i(s) (-1)^j P_j(s) ds = (-1)^j \\int_{-1}^{1} P_i(s) P_j(s) ds = (-1)^j \\frac{2}{2i+1} \\delta_{ij}\n$$\n考虑到 $i \\in \\{0, 1, 2\\}$ 和 $j \\in \\{0, 1, 2, 3\\}$，得到的矩阵 $B$ 是：\n$$\nB = \\begin{pmatrix}\n(-1)^0 \\frac{2}{1} & 0 & 0 & 0 \\\\\n0 & (-1)^1 \\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & (-1)^2 \\frac{2}{5} & 0\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 & 0 & 0 & 0 \\\\\n0 & -\\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & \\frac{2}{5} & 0\n\\end{pmatrix}\n$$\n现在我们求 $P = M_L^{-1} B$。首先，我们计算 $M_L^{-1}$：\n$$\nM_L^{-1} = \\left( \\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 \\\\\n0 & 0 & \\frac{2}{5}\n\\end{pmatrix} \\right)^{-1} = \\begin{pmatrix}\n\\frac{1}{2} & 0 & 0 \\\\\n0 & \\frac{3}{2} & 0 \\\\\n0 & 0 & \\frac{5}{2}\n\\end{pmatrix}\n$$\n那么，投影矩阵 $P$ 是：\n$$\nP = M_L^{-1} B = \\begin{pmatrix}\n\\frac{1}{2} & 0 & 0 \\\\\n0 & \\frac{3}{2} & 0 \\\\\n0 & 0 & \\frac{5}{2}\n\\end{pmatrix}\n\\begin{pmatrix}\n2 & 0 & 0 & 0 \\\\\n0 & -\\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & \\frac{2}{5} & 0\n\\end{pmatrix}\n= \\begin{pmatrix}\n1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0 \\\\\n0 & 0 & 1 & 0\n\\end{pmatrix}\n$$\n\n**任务 3：组装界面算子 $S$**\n\n问题描述了针对一个对称正定问题的砂浆侧算子 $S \\in \\mathbb{R}^{3\\times 3}$ 的组装。与问题中关于组合贡献的描述一致，这种算子的一个标准构造是基于一个变分形式，其中从迹被约束为主迹的投影。如果 $\\lambda_L$ 和 $\\lambda_R$ 分别是系数向量为 $c_L$ 和 $c_R$ 的迹，并且左侧是砂浆（主），则约束为 $\\lambda_R = \\Pi_R(\\lambda_L)$，其中 $\\Pi_R$ 是从左空间到右空间的 $L^2$ 投影。这导致系数关系 $c_R = M_R^{-1} B^T c_L$。总界面能量为 $E = \\frac{1}{2} c_L^T M_L c_L + \\frac{1}{2} c_R^T M_R c_R$。代入 $c_R$ 的约束：\n$$\nE = \\frac{1}{2} c_L^T M_L c_L + \\frac{1}{2} (M_R^{-1} B^T c_L)^T M_R (M_R^{-1} B^T c_L) = \\frac{1}{2} c_L^T (M_L + B M_R^{-1} B^T) c_L\n$$\n因此，得到的对称砂浆算子是 $S = M_L + B M_R^{-1} B^T$。\n\n我们计算第二项 $B M_R^{-1} B^T$。\n$M_R^{-1} = \\text{diag}(\\frac{1}{2}, \\frac{3}{2}, \\frac{5}{2}, \\frac{7}{2})$。\n$B^T = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & -\\frac{2}{3} & 0 \\\\ 0 & 0 & \\frac{2}{5} \\\\ 0 & 0 & 0 \\end{pmatrix}$。\n项 $B M_R^{-1}$ 是：\n$$\nB M_R^{-1} = \\begin{pmatrix}\n2 & 0 & 0 & 0 \\\\\n0 & -\\frac{2}{3} & 0 & 0 \\\\\n0 & 0 & \\frac{2}{5} & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{1}{2} & 0 & 0 & 0 \\\\\n0 & \\frac{3}{2} & 0 & 0 \\\\\n0 & 0 & \\frac{5}{2} & 0 \\\\\n0 & 0 & 0 & \\frac{7}{2}\n\\end{pmatrix}\n= \\begin{pmatrix}\n1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0 \\\\\n0 & 0 & 1 & 0\n\\end{pmatrix} = P\n$$\n所以，$B M_R^{-1} B^T = P B^T$：\n$$\nP B^T = \\begin{pmatrix}\n1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0 \\\\\n0 & 0 & 1 & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & -\\frac{2}{3} & 0 \\\\\n0 & 0 & \\frac{2}{5} \\\\\n0 & 0 & 0\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 \\\\\n0 & 0 & \\frac{2}{5}\n\\end{pmatrix} = M_L\n$$\n这个非常简洁的结果意味着，来自右单元的投影贡献与来自左单元的贡献相同。因此，组装后的算子 $S$ 是：\n$$\nS = M_L + M_L = 2 M_L = 2 \\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & \\frac{2}{3} & 0 \\\\\n0 & 0 & \\frac{2}{5}\n\\end{pmatrix}\n= \\begin{pmatrix}\n4 & 0 & 0 \\\\\n0 & \\frac{4}{3} & 0 \\\\\n0 & 0 & \\frac{4}{5}\n\\end{pmatrix}\n$$\n\n**任务 4：计算 $S$ 的行列式**\n\n对角矩阵 $S$ 的行列式是其对角元的乘积：\n$$\n\\det(S) = (4) \\times \\left(\\frac{4}{3}\\right) \\times \\left(\\frac{4}{5}\\right) = \\frac{4 \\times 4 \\times 4}{3 \\times 5} = \\frac{64}{15}\n$$\n该值是一个精确分数。",
            "answer": "$$\\boxed{\\frac{64}{15}}$$"
        },
        {
            "introduction": "理解了舒尔补算子的构造之后，我们的下一个关键任务是分析其谱特性，因为这直接决定了求解线性系统的效率。本练习要求你通过编程实现谱元方法，数值化地研究全局舒尔补矩阵 $S$ 的条件数 $\\kappa(S)$。你将探索全局算子的谱（如 $\\lambda_{\\max}(S)$）如何通过局部子区域上的离散Steklov特征问题来估计，并验证一个重要的理论上界，这是开发可扩展预条件子的核心思想。",
            "id": "3404164",
            "problem": "考虑形式为 $-(a(x) u'(x))' = f(x)$ 的一维对称扩散模型问题，该问题定义在闭区间 $[0,1]$ 上，并带有齐次 Dirichlet 边界条件 $u(0) = 0$ 和 $u(1) = 0$。设该区间被剖分为 $N$ 个等长度的不重叠子域（单元）。在每个子域上，使用谱元离散化，该离散化采用 $p$ 次多项式阶数的 Legendre-Gauss-Lobatto (LGL) 节点和求积权重，这些权重使得 Galerkin 双线性形式对于多项式数据是精确的。假设扩散系数 $a(x)$ 在每个子域上为常数，在子域 $e$ 上取值为 $a_e > 0$，并且 $f(x)$ 对矩阵条件数没有影响。\n\n在每个子域 $e$ 内，设节点基为参考坐标 $\\xi \\in [-1,1]$ 中 LGL 节点上的 Lagrange 插值多项式，通过 $x(\\xi) = \\frac{x_L^e + x_R^e}{2} + \\frac{h_e}{2} \\xi$（其中 $h_e = x_R^e - x_L^e$）仿射映射到物理子域 $[x_L^e, x_R^e]$。用 $D$ 表示在参考坐标中 LGL 节点上求值的 Lagrange 基的微分矩阵，用 $\\{w_i\\}_{i=0}^p$ 表示 $[-1,1]$ 上的 LGL 求积权重，用 $W = \\mathrm{diag}(w_0, w_1, \\dots, w_p)$ 表示对角求积矩阵。单元刚度矩阵 $K^{(e)} \\in \\mathbb{R}^{(p+1) \\times (p+1)}$ 由 Galerkin 双线性形式的求积公式定义，\n$$\nK^{(e)} = \\frac{2}{h_e} \\, D^\\top \\, W \\, a_e \\, D,\n$$\n由于 $a_e$ 在子域 $e$ 上是常数，因此它与权重相乘。将每个子域上的自由度划分为边界节点 $b$（两个端点）和内部节点 $i$（其余节点），从而得到分块分解\n$$\nK^{(e)} = \\begin{bmatrix} K^{(e)}_{bb} & K^{(e)}_{bi} \\\\ K^{(e)}_{ib} & K^{(e)}_{ii} \\end{bmatrix}.\n$$\n通过对内部自由度进行静态凝聚，在边界迹空间上定义局部离散 Dirichlet-to-Neumann 映射（也称为局部离散 Steklov 算子），\n$$\nT^{(e)} = K^{(e)}_{bb} - K^{(e)}_{bi} \\left(K^{(e)}_{ii}\\right)^{-1} K^{(e)}_{ib} \\in \\mathbb{R}^{2 \\times 2}.\n$$\n\n通过将每个子域的 $T^{(e)}$ 对其接触的界面节点的贡献求和，并在 $x=0$ 和 $x=1$ 处直接施加齐次 Dirichlet 边界值（这些边界值被设为零，因此不会为 $S$ 引入未知数），来组装全局界面迹自由度上的非重叠 Schur 补 $S$。全局 Schur 补 $S \\in \\mathbb{R}^{(N-1) \\times (N-1)}$ 是对称正定的。其谱条件数定义为\n$$\n\\kappa(S) = \\frac{\\lambda_{\\max}(S)}{\\lambda_{\\min}(S)},\n$$\n其中 $\\lambda_{\\max}(\\cdot)$ 和 $\\lambda_{\\min}(\\cdot)$ 分别是最大和最小特征值。\n\n在每个子域上，将边界迹空间上的局部离散 Steklov 特征问题定义为\n$$\nT^{(e)} v_b = \\lambda \\, v_b,\n$$\n其中 $v_b \\in \\mathbb{R}^2$。令 $\\lambda_{\\max}\\!\\left(T^{(e)}\\right)$ 表示 $T^{(e)}$ 的最大特征值。在一维空间中，每个内部界面最多由 $2$ 个子域共享。使用范数次可加性或 Gershgorin 型论证，可以证明上界\n$$\n\\lambda_{\\max}(S) \\le 2 \\, \\max_{e=1,\\dots,N} \\lambda_{\\max}\\!\\left(T^{(e)}\\right).\n$$\n这提供了一个完全基于局部 Steklov 特征值的可计算的代理界。\n\n任务：\n- 以程序化形式实现所述的谱元构造，该程序构建单元刚度矩阵 $K^{(e)}$，执行静态凝聚以获得 $T^{(e)}$，组装全局 Schur 补 $S$，并数值计算精确的 $\\lambda_{\\max}(S)$ 和 $\\kappa(S)$。\n- 计算代理上界 $U = 2 \\, \\max_{e} \\lambda_{\\max}\\!\\left(T^{(e)}\\right)$，并通过报告比率 $R = \\lambda_{\\max}(S)/U$ 来评估该界的锐度。\n- 对于这个纯数学问题，不需要物理单位；将所有浮点结果报告为原始十进制值。\n\n使用以下参数集测试套件，其中每个测试用例由三元组 $(N, p, \\{a_e\\}_{e=1}^N)$ 指定：\n- 测试用例 1：$N = 2$, $p = 4$, $\\{a_e\\} = [1.0, 1.0]$。\n- 测试用例 2：$N = 2$, $p = 4$, $\\{a_e\\} = [10^{-3}, 10^{3}]$。\n- 测试用例 3：$N = 5$, $p = 3$, $\\{a_e\\} = [1.0, 2.0, 3.0, 4.0, 5.0]$。\n- 测试用例 4：$N = 3$, $p = 6$, $\\{a_e\\} = [1.0, 0.1, 10.0]$。\n- 测试用例 5：$N = 4$, $p = 2$, $\\{a_e\\} = [1.0, 1.0, 1.0, 1.0]$。\n\n您的程序应生成单行输出，其中包含所有测试用例的结果，这些结果汇总到一个列表的列表中，每个内部列表为对应测试用例的 $[\\lambda_{\\max}(S), U, R, \\kappa(S)]$。确切的文本格式必须是带有 Python 风格列表字面量的单行，例如 $[[x_1, y_1, z_1, w_1],[x_2, y_2, z_2, w_2],\\dots]$，不含任何附加文本。",
            "solution": "该问题是有效的。它构成了数值分析领域内，特别是在谱元法和非重叠区域分解方向上，一个定义明确的练习。所有参数均已提供，理论基础扎实，目标明确且可通过计算验证。\n\n求解过程通过编程实现定义的数学对象和过程。整个过程可分为四个主要阶段：(1) 参考单元数据的计算，(2) 局部单元矩阵的构建及其静态凝聚，(3) 全局界面问题的组装，以及 (4) 指定谱特性的计算。\n\n**1. 参考谱元数据**\n\n该方法基于定义在区间 $\\xi \\in [-1, 1]$ 上的参考单元。物理单元的所有计算都是通过从该参考单元的映射来执行的。对于给定的多项式阶数 $p$，我们需要参考单元上的三个基本组成部分：\n\n- **Legendre-Gauss-Lobatto (LGL) 节点 $\\{\\xi_i\\}_{i=0}^p$**：这是用于插值和求积的 $p+1$ 个节点。它们是多项式 $(1-\\xi^2)P'_p(\\xi)$ 的根，其中 $P'_p(\\xi)$ 是 $p$ 阶 Legendre 多项式的导数。该节点集包括端点 $\\xi_0 = -1$ 和 $\\xi_p = 1$。\n\n- **LGL 求积权重 $\\{w_i\\}_{i=0}^p$**：与每个节点 $\\xi_i$ 相关联的是一个求积权重 $w_i$，用于数值积分。权重由以下公式给出：\n$$w_i = \\frac{2}{p(p+1) [P_p(\\xi_i)]^2}$$\n该求积法则对于最高 $2p-1$ 次的多项式是精确的。\n\n- **Lagrange 微分矩阵 $D$**：单元内的局部解表示为 Lagrange 基函数 $L_j(\\xi)$ 的线性组合，每个基函数仅在单个节点 $\\xi_j$ 上非零。微分矩阵 $D \\in \\mathbb{R}^{(p+1) \\times (p+1)}$ 包含在所有节点上计算的这些基函数导数的值。一个元素 $D_{ij}$ 由 $D_{ij} = L'_j(\\xi_i)$ 给出。其元素的标准公式为：\n$$\nD_{ij} = \\begin{cases}\n    \\frac{P_p(\\xi_i)}{P_p(\\xi_j)(\\xi_i - \\xi_j)} & \\text{if } i \\neq j \\\\\n    -\\frac{p(p+1)}{4} & \\text{if } i=j=0 \\\\\n    \\frac{p(p+1)}{4} & \\text{if } i=j=p \\\\\n    0 & \\text{otherwise for diagonal entries}\n\\end{cases}\n$$\n这三个组成部分 $\\{\\xi_i\\}$、$\\{w_i\\}$ 和 $D$ 仅取决于多项式阶数 $p$，并且只需计算一次。\n\n**2. 单元刚度矩阵和静态凝聚**\n\n连续问题为 $-(a(x)u'(x))' = f(x)$。相应的弱形式涉及双线性形式 $B(u, v) = \\int_0^1 a(x) u'(x) v'(x) dx$。对于具有域 $[x_L^e, x_R^e]$ 和常数系数 $a_e$ 的单个单元 $e$，该积分变为 $a_e \\int_{x_L^e}^{x_R^e} u'(x) v'(x) dx$。使用从参考单元的仿射映射 $x(\\xi) = x_L^e + \\frac{h_e}{2}(1+\\xi)$，其中 $h_e = x_R^e - x_L^e$，链式法则给出 $u'(x) = \\frac{du}{d\\xi}\\frac{d\\xi}{dx} = u'(\\xi) \\frac{2}{h_e}$。该积分变换为：\n$$ B^{(e)}(u, v) = a_e \\int_{-1}^{1} u'(\\xi) \\frac{2}{h_e} \\cdot v'(\\xi) \\frac{2}{h_e} \\cdot \\frac{h_e}{2} d\\xi = \\frac{2a_e}{h_e} \\int_{-1}^{1} u'(\\xi) v'(\\xi) d\\xi $$\n使用 Lagrange 基进行离散化并使用 LGL 求积，我们得到单元刚度矩阵 $K^{(e)}$。积分 $\\int (L'_j(\\xi)) (L'_k(\\xi)) d\\xi$ 由 $\\sum_m w_m L'_j(\\xi_m) L'_k(\\xi_m)$ 近似。这对应于矩阵表达式：\n$$ K^{(e)} = \\frac{2a_e}{h_e} D^\\top W D $$\n其中 $W = \\mathrm{diag}(w_0, \\dots, w_p)$。\n\n节点被划分为边界节点（索引 $b = \\{0, p\\}$）和内部节点（索引 $i = \\{1, \\dots, p-1\\}$）。这在 $K^{(e)}$ 上产生了一个分块结构：\n$$ K^{(e)} = \\begin{bmatrix} K^{(e)}_{bb} & K^{(e)}_{bi} \\\\ K^{(e)}_{ib} & K^{(e)}_{ii} \\end{bmatrix} $$\n静态凝聚消去内部自由度，以找到单元边界上的节点值和广义力之间的关系。这产生了局部 Schur 补，或离散 Dirichlet-to-Neumann 映射，$T^{(e)} \\in \\mathbb{R}^{2 \\times 2}$：\n$$ T^{(e)} = K^{(e)}_{bb} - K^{(e)}_{bi} \\left(K^{(e)}_{ii}\\right)^{-1} K^{(e)}_{ib} $$\n矩阵 $T^{(e)}$ 表示单元 $e$ 对其边界节点的刚度贡献。我们为每个单元计算 $T^{(e)}$ 及其最大特征值 $\\lambda_{\\max}(T^{(e)})$。\n\n**3. 全局 Schur 补的组装**\n\n全局 Schur 补矩阵 $S$ 作用于域剖分的 $N-1$ 个内部界面上的未知数值向量。这些界面位于 $x_j = j/N$，$j=1, \\dots, N-1$。矩阵 $S$ 是通过对局部 $T^{(e)}$ 矩阵的贡献求和来组装的。位于 $x_j$ 的界面是单元 $j$ 的右边界和单元 $j+1$ 的左边界。其刚度是来自两侧的刚度之和。\n矩阵 $S$ 是三对角的：\n- 对角线元素为 $S_{j,j} = T^{(j)}_{11} + T^{(j+1)}_{00}$，$j=0, \\dots, N-2$。（注：$T_{11}$ 是右节点的贡献，$T_{00}$ 是左节点的贡献）。\n- 非对角线元素为 $S_{j, j+1} = T^{(j+1)}_{01}$ 和 $S_{j+1, j} = T^{(j+1)}_{10}$，$j=0, \\dots, N-3$。\n\n**4. 谱量的计算**\n\n组装好全局 Schur 补矩阵 $S$ 后，我们计算所需的量：\n- 对称矩阵 $S$ 的特征值通过数值方法计算。我们找出最大特征值 $\\lambda_{\\max}(S)$ 和最小特征值 $\\lambda_{\\min}(S)$。\n- 谱条件数为 $\\kappa(S) = \\frac{\\lambda_{\\max}(S)}{\\lambda_{\\min}(S)}$。\n- $\\lambda_{\\max}(S)$ 的代理上界计算为 $U = 2 \\cdot \\max_{e=1, \\dots, N} \\lambda_{\\max}(T^{(e)})$。\n- 该界的锐度通过比率 $R = \\frac{\\lambda_{\\max}(S)}{U}$ 进行评估。\n\n此过程应用于问题描述中指定的每个测试用例。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre, roots_jacobi\n\nclass SpectralElementSolver:\n    \"\"\"\n    Implements a 1D spectral element method to analyze the Schur complement condition number.\n    \"\"\"\n    \n    def __init__(self, N, p, a_vals):\n        \"\"\"\n        Initializes the solver with problem parameters.\n\n        Args:\n            N (int): Number of nonoverlapping subdomains.\n            p (int): Polynomial degree of LGL approximation.\n            a_vals (list or np.array): Diffusion coefficient values on each subdomain.\n        \"\"\"\n        self.N = N\n        self.p = p\n        self.a_vals = np.array(a_vals)\n        self.h = 1.0 / N\n\n        # Precompute reference element data that depends only on p\n        self._nodes, self._weights = self._lgl_nodes_weights()\n        self._D = self._derivative_matrix()\n        \n        # Will store local and global matrices during computation\n        self.T_elements = []  # List of local Schur complements T^(e)\n        self.S = None         # Global Schur complement\n\n    def _lgl_nodes_weights(self):\n        \"\"\"\n        Computes the Legendre-Gauss-Lobatto (LGL) nodes and weights for a given degree p.\n        \"\"\"\n        if self.p == 0:\n            return np.array([-1.0, 1.0]), np.array([1.0, 1.0]) # Linear element\n        if self.p == 1:\n            nodes = np.array([-1.0, 1.0])\n            weights = np.array([1.0, 1.0])\n            return nodes, weights\n\n        # Interior LGL nodes are the roots of the derivative of the Legendre polynomial P_p.\n        # These are also the roots of the Jacobi polynomial P_{p-1}^{(1,1)}.\n        jacobi_roots, _ = roots_jacobi(self.p - 1, 1, 1)\n        nodes = np.concatenate(([-1.0], jacobi_roots, [1.0]))\n        nodes = np.sort(nodes)\n\n        # LGL weights formula\n        p_poly = legendre(self.p)\n        weights = 2.0 / (self.p * (self.p + 1) * (p_poly(nodes))**2)\n        \n        return nodes, weights\n\n    def _derivative_matrix(self):\n        \"\"\"\n        Computes the differentiation matrix for the Lagrange basis on LGL nodes.\n        \"\"\"\n        n_pts = self.p + 1\n        D = np.zeros((n_pts, n_pts))\n        p_poly = legendre(self.p)\n        p_vals = p_poly(self._nodes)\n        nodes = self._nodes\n\n        # Off-diagonal entries\n        for i in range(n_pts):\n            for j in range(n_pts):\n                if i != j:\n                    D[i, j] = p_vals[i] / (p_vals[j] * (nodes[i] - nodes[j]))\n        \n        # Diagonal entries for endpoints\n        D[0, 0] = -self.p * (self.p + 1) / 4.0\n        D[self.p, self.p] = self.p * (self.p + 1) / 4.0\n        # Interior diagonal entries are 0, which is the default from np.zeros.\n\n        return D\n\n    def build_and_solve(self):\n        \"\"\"\n        Builds all matrices and computes the required spectral quantities.\n        \"\"\"\n        max_lambda_T_list = []\n\n        # 1. Compute local Schur complements (T_e) for each element\n        for e in range(self.N):\n            a_e = self.a_vals[e]\n            \n            # Form element stiffness matrix K_e\n            W_diag = np.diag(self._weights)\n            K_e = (a_e * 2.0 / self.h) * (self._D.T @ W_diag @ self._D)\n\n            # Partition into boundary and interior DoFs\n            b_indices = [0, self.p]\n            i_indices = list(range(1, self.p))\n\n            K_bb = K_e[np.ix_(b_indices, b_indices)]\n            \n            if self.p > 1: # If there are interior nodes\n                K_bi = K_e[np.ix_(b_indices, i_indices)]\n                K_ib = K_e[np.ix_(i_indices, b_indices)]\n                K_ii = K_e[np.ix_(i_indices, i_indices)]\n                # Static condensation\n                T_e = K_bb - K_bi @ np.linalg.inv(K_ii) @ K_ib\n            else: # No interior nodes to condense\n                T_e = K_bb\n\n            self.T_elements.append(T_e)\n\n            # Compute and store max eigenvalue of T_e\n            if T_e.shape[0] > 0:\n                eigvals_T = np.linalg.eigvalsh(T_e)\n                max_lambda_T_list.append(np.max(eigvals_T))\n        \n        # 2. Assemble and analyze global Schur complement S\n        if self.N > 1:\n            self.S = np.zeros((self.N - 1, self.N - 1))\n            \n            # Diagonal entries: sum contributions from adjacent elements\n            for i in range(self.N - 1):\n                # Interface i is shared by element i (right) and i+1 (left)\n                self.S[i, i] = self.T_elements[i][1, 1] + self.T_elements[i+1][0, 0]\n\n            # Off-diagonal entries: from shared element\n            for i in range(self.N - 2):\n                self.S[i, i+1] = self.T_elements[i+1][0, 1]\n                self.S[i+1, i] = self.T_elements[i+1][1, 0]\n\n            eigvals_S = np.linalg.eigvalsh(self.S)\n            lambda_max_S = np.max(eigvals_S)\n            lambda_min_S = np.min(eigvals_S)\n            kappa_S = lambda_max_S / lambda_min_S if lambda_min_S > 0 else np.inf\n        else: # Case with only one element, no interfaces.\n             lambda_max_S = 0.0\n             kappa_S = 1.0\n\n        # 3. Compute the surrogate bound U and the sharpness ratio R\n        U = 2.0 * np.max(max_lambda_T_list) if max_lambda_T_list else 0.0\n        R = lambda_max_S / U if U > 0 else 0.0\n\n        return [lambda_max_S, U, R, kappa_S]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (2, 4, [1.0, 1.0]),\n        (2, 4, [1.0e-3, 1.0e3]),\n        (5, 3, [1.0, 2.0, 3.0, 4.0, 5.0]),\n        (3, 6, [1.0, 0.1, 10.0]),\n        (4, 2, [1.0, 1.0, 1.0, 1.0])\n    ]\n\n    results = []\n    for N, p, a_vals in test_cases:\n        solver = SpectralElementSolver(N, p, a_vals)\n        result = solver.build_and_solve()\n        results.append(result)\n\n    # Print in the specified single-line list-of-lists format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}