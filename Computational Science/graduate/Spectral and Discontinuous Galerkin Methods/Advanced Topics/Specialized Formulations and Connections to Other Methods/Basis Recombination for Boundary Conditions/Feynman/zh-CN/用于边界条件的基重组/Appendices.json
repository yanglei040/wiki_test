{
    "hands_on_practices": [
        {
            "introduction": "理论的基石是能够清晰地分离和理解各个组成部分的角色。此练习将我们的讨论置于一个基础背景下：一个带非齐次狄利克雷边界条件的一维泊松问题。通过构建一个“提升函数”将问题转化为齐次边界条件问题，你将亲自验证一个核心概念：提升函数的选择仅影响系统的载荷向量（即右侧项），而系统的刚度矩阵及其条件数则完全由为齐次问题选择的基底决定。这项实践有助于巩固对基组合法如何将边界数据和核心算子解耦的理解。",
            "id": "3365735",
            "problem": "考虑区间 $[-1,1]$ 上带非齐次狄利克雷边界条件的一维泊松边值问题，\n$$-u''(x)=f(x)\\quad\\text{for }x\\in[-1,1],\\qquad u(-1)=\\alpha,\\quad u(1)=\\beta,$$\n其中 $f$ 是一个给定的足够光滑的函数，$\\alpha,\\beta\\in\\mathbb{R}$ 是指定的边界数据。在谱Galerkin方法中，通过使用提升函数 $w(x)$ 进行基重组来施加边界条件，使得 $u(x)=v(x)+w(x)$ 且 $v(x)$ 满足齐次狄利克雷条件。Galerkin方法由双线性形式\n$$a(u,v)=\\int_{-1}^{1}u'(x)\\,v'(x)\\,\\mathrm{d}x,$$\n和线性泛函\n$$\\ell(v)=\\int_{-1}^{1}f(x)\\,v(x)\\,\\mathrm{d}x$$\n定义。取试探空间为最高次数为3的实多项式空间，并通过将 $w(x)$ 显式地构造为一个满足 $w(-1)=\\alpha$ 和 $w(1)=\\beta$ 的低次多项式来施加边界条件。然后，进行基重组，将问题简化到齐次子空间上。具体来说：\n\n- 构造一个线性提升函数 $w_{L}(x)$ 和一个二次提升函数 $w_{Q}(x)$，使得 $w_{L}(-1)=\\alpha$, $w_{L}(1)=\\beta$ 以及 $w_{Q}(-1)=\\alpha$, $w_{Q}(1)=\\beta$。\n- 使用由两个基函数 $\\phi_{1}(x)=x^{2}-1$ 和 $\\phi_{2}(x)=x^{3}-x$ 张成的齐次子空间，这两个基函数都满足对 $j\\in\\{1,2\\}$ 有 $\\phi_{j}(-1)=\\phi_{j}(1)=0$。\n- 推导 $2\\times 2$ Galerkin刚度矩阵 $K$，其元素为 $K_{ij}=a(\\phi_{i},\\phi_{j})$（对于 $i,j\\in\\{1,2\\}$），并确定其欧几里得条件数 $\\kappa_{2}(K)$。\n\n分析 $w(x)$ 的选择是否影响齐次子空间上约化Galerkin系统的条件数，并以闭式解形式计算 $\\kappa_{2}(K)$ 的精确值。将你的最终答案表示为单个精确数值或单个闭式解析表达式。无需四舍五入。",
            "solution": "该问题要求分析用于求解带非齐次狄利克雷边界条件的一维泊松方程的谱Galerkin方法。核心任务是确定提升函数的选择是否影响约化系统的刚度矩阵的条件数，并为特定的多项式基计算该矩阵的条件数。\n\n首先，我们来分析Galerkin系统的结构。问题由下式给出：\n$$-u''(x)=f(x)\\quad\\text{for }x\\in[-1,1],\\qquad u(-1)=\\alpha,\\quad u(1)=\\beta.$$\n我们将解 $u(x)$ 分解为 $u(x) = v(x) + w(x)$，其中 $w(x)$ 是满足非齐次边界条件 $w(-1)=\\alpha$ 和 $w(1)=\\beta$ 的提升函数，而 $v(x)$ 属于一个函数空间，该空间中的函数满足齐次边界条件，即 $v(-1)=v(1)=0$。\n\n其弱形式是找到 $u(x)$，使得对于所有在边界上为零的合适测试函数 $\\phi$，都有 $a(u, \\phi) = \\ell(\\phi)$。将 $u=v+w$ 代入可得：\n$$a(v+w, \\phi) = \\ell(\\phi)$$\n根据双线性形式 $a(\\cdot, \\cdot)$ 的线性性质，我们有：\n$$a(v, \\phi) + a(w, \\phi) = \\ell(\\phi)$$\n这可以重排以求解未知函数 $v(x)$：\n$$a(v, \\phi) = \\ell(\\phi) - a(w, \\phi)$$\n我们在由满足齐次边界条件的基函数 $\\{\\phi_j\\}_{j=1}^N$ 张成的有限维子空间中寻找 $v(x)$ 的近似解。令 $v(x) = \\sum_{j=1}^{N} c_j \\phi_j(x)$。使用Galerkin方法，我们对每个基函数 $\\phi_i(x)$（对于 $i=1, \\dots, N$）进行测试：\n$$\\sum_{j=1}^{N} c_j a(\\phi_j, \\phi_i) = \\ell(\\phi_i) - a(w, \\phi_i)$$\n这构成了一个线性方程组 $K C = F$，其中：\n- 刚度矩阵 $K$ 的元素为 $K_{ij} = a(\\phi_i, \\phi_j)$。\n- 未知量向量 $C$ 的元素为 $C_j = c_j$。\n- 右端向量 $F$ 的元素为 $F_i = \\ell(\\phi_i) - a(w, \\phi_i) = \\int_{-1}^{1}f(x)\\phi_i(x)\\,\\mathrm{d}x - \\int_{-1}^{1}w'(x)\\phi_i'(x)\\,\\mathrm{d}x$。\n\n约化Galerkin系统的条件数由刚度矩阵 $K$ 的条件数确定。从其定义 $K_{ij} = a(\\phi_i, \\phi_j)$ 可以看出，$K$ 的元素仅依赖于双线性形式 $a(\\cdot, \\cdot)$ 和齐次子空间的基函数 $\\{\\phi_j\\}$。提升函数 $w(x)$ 的选择只影响右端向量 $F$。因此，刚度矩阵 $K$ 及其条件数与 $w(x)$ 的具体选择无关，无论是线性的 $w_L(x)$、二次的 $w_Q(x)$，还是任何其他有效的提升函数。\n\n按照问题的要求，我们可以构造这类提升函数的例子。\n一个线性提升函数 $w_L(x) = ax+b$ 必须满足：\n$$w_L(-1) = -a+b = \\alpha$$\n$$w_L(1) = a+b = \\beta$$\n解这个方程组得到 $a = \\frac{\\beta-\\alpha}{2}$ 和 $b = \\frac{\\alpha+\\beta}{2}$。所以，$w_L(x) = \\frac{\\beta-\\alpha}{2}x + \\frac{\\alpha+\\beta}{2}$。\n一个二次提升函数 $w_Q(x)$ 可以通过在 $w_L(x)$ 上添加一个在边界 $x=\\pm 1$ 处为零的二次项来构造。一个简单的选择是添加 $x^2-1$ 的一个倍数：\n$$w_Q(x) = w_L(x) + C(x^2-1) = \\left(\\frac{\\beta-\\alpha}{2}\\right)x + \\frac{\\alpha+\\beta}{2} + C(x^2-1)$$\n对于任意非零常数 $C \\in \\mathbb{R}$，这确保了该多项式确实是二次的。它满足 $w_Q(-1)=\\alpha$ 和 $w_Q(1)=\\beta$。\n\n现在，我们计算由基函数 $\\phi_{1}(x)=x^{2}-1$ 和 $\\phi_{2}(x)=x^{3}-x$ 张成的齐次子空间的刚度矩阵 $K$。\n双线性形式为 $a(g,h)=\\int_{-1}^{1}g'(x)h'(x)\\,\\mathrm{d}x$。\n基函数的导数是：\n$$\\phi_{1}'(x) = 2x$$\n$$\\phi_{2}'(x) = 3x^{2}-1$$\n$2\\times 2$ 刚度矩阵 $K$ 的元素是 $K_{ij} = a(\\phi_i, \\phi_j)$。\n\n$K_{11} = a(\\phi_1, \\phi_1) = \\int_{-1}^{1} \\phi_1'(x) \\phi_1'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (2x)^2 \\,\\mathrm{d}x = \\int_{-1}^{1} 4x^2 \\,\\mathrm{d}x$\n$$K_{11} = 4 \\left[ \\frac{x^3}{3} \\right]_{-1}^{1} = \\frac{4}{3} (1^3 - (-1)^3) = \\frac{4}{3} (1 - (-1)) = \\frac{8}{3}$$\n\n$K_{12} = a(\\phi_1, \\phi_2) = \\int_{-1}^{1} \\phi_1'(x) \\phi_2'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (2x)(3x^2-1) \\,\\mathrm{d}x = \\int_{-1}^{1} (6x^3 - 2x) \\,\\mathrm{d}x$\n被积函数是一个奇函数，且积分区间是对称的 $[-1, 1]$，所以积分为零。\n$$K_{12} = 0$$\n由于双线性形式是对称的，所以 $K_{21} = K_{12} = 0$。\n\n$K_{22} = a(\\phi_2, \\phi_2) = \\int_{-1}^{1} \\phi_2'(x) \\phi_2'(x) \\,\\mathrm{d}x = \\int_{-1}^{1} (3x^2-1)^2 \\,\\mathrm{d}x = \\int_{-1}^{1} (9x^4 - 6x^2 + 1) \\,\\mathrm{d}x$\n被积函数是一个偶函数。\n$$K_{22} = \\left[ \\frac{9x^5}{5} - \\frac{6x^3}{3} + x \\right]_{-1}^{1} = \\left[ \\frac{9}{5}x^5 - 2x^3 + x \\right]_{-1}^{1}$$\n$$K_{22} = \\left( \\frac{9}{5}(1)^5 - 2(1)^3 + 1 \\right) - \\left( \\frac{9}{5}(-1)^5 - 2(-1)^3 + (-1) \\right)$$\n$$K_{22} = \\left( \\frac{9}{5} - 2 + 1 \\right) - \\left( -\\frac{9}{5} + 2 - 1 \\right) = \\left( \\frac{4}{5} \\right) - \\left( -\\frac{4}{5} \\right) = \\frac{8}{5}$$\n因此，刚度矩阵为：\n$$K = \\begin{pmatrix} \\frac{8}{3} & 0 \\\\ 0 & \\frac{8}{5} \\end{pmatrix}$$\n问题要求计算欧几里得条件数 $\\kappa_2(K)$。对于一个对称正定矩阵，$\\kappa_2(K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}}$，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是 $K$ 的最大和最小特征值。\n由于 $K$ 是一个对角矩阵，其特征值就是其对角元素：$\\lambda_1 = \\frac{8}{3}$ 和 $\\lambda_2 = \\frac{8}{5}$。\n比较这两个特征值：$\\frac{8}{3} = \\frac{40}{15}$ 和 $\\frac{8}{5} = \\frac{24}{15}$。\n所以，$\\lambda_{\\max} = \\frac{8}{3}$ 且 $\\lambda_{\\min} = \\frac{8}{5}$。\n条件数为：\n$$\\kappa_2(K) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{8/3}{8/5} = \\frac{8}{3} \\cdot \\frac{5}{8} = \\frac{5}{3}$$\n最终结果与提升函数 $w_L(x)$ 和 $w_Q(x)$ 无关，正如我们最初的分析所预测的那样。",
            "answer": "$$\\boxed{\\frac{5}{3}}$$"
        },
        {
            "introduction": "从理论到实践的飞跃是掌握任何计算方法的关键。这项综合性编码练习要求你为一个更复杂的混合边界条件问题实现完整的基组合流程。你将把边界约束表示为一个矩阵算子，构造一个提升函数，计算齐次空间的零空间，并最终对得到的基进行质量矩阵正交化以获得最优的数值属性。这个动手实践将理论知识转化为实际代码，让你全面掌握从概念到实现的全过程，并能通过数值结果验证方法的正确性和鲁棒性。",
            "id": "3365793",
            "problem": "考虑区间 $[-1,1]$ 上的经典勒让德 (Legendre) 多项式 $\\{P_n(x)\\}_{n=0}^N$，其标准归一化为 $P_n(1)=1$。令勒让德基下的 $L^2([-1,1])$ 质量矩阵 $M \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 定义为\n$$\nM_{ij} \\equiv \\int_{-1}^{1} P_i(x) P_j(x) \\, dx.\n$$\n你需要通过对勒让德基进行线性重组，构造一个强制执行混合边界条件 $u(-1)=0$ 和 $u'(1)=\\alpha$ 的基。由于条件 $u'(1)=\\alpha$ 是非齐次的，使用标准的提升思想：将 $u(x)$ 写成 $u(x) = \\ell(x) + w(x)$，其中提升函数 $\\ell(x)$ 满足边界数据，而修正函数 $w(x)$ 满足齐次条件。具体来说，施加：\n- $\\ell(-1)=0$ 且 $\\ell'(1)=\\alpha$，\n- $w(-1)=0$ 且 $w'(1)=0$。\n\n起始基础和经过充分检验的事实：\n- 正交性：对于所有整数 $m,n \\ge 0$，有 $\\displaystyle \\int_{-1}^{1} P_m(x) P_n(x)\\, dx = \\frac{2}{2n+1}\\,\\delta_{mn}$。\n- 端点值：对于所有整数 $n \\ge 0$，有 $P_n(-1) = (-1)^n$。\n- 端点导数：对于所有整数 $n \\ge 0$，有 $P_n'(1) = \\frac{n(n+1)}{2}$。\n\n需要执行的任务：\n1. 将任意次数至多为 $N$ 的多项式 $v(x)$ 表示为 $v(x) = \\sum_{n=0}^{N} c_n P_n(x)$，其系数向量为 $c \\in \\mathbb{R}^{N+1}$。通过以下方式编码作用于 $c$ 的边界算子 $A \\in \\mathbb{R}^{2 \\times (N+1)}$\n   $$\n   A\\,c \\equiv \\begin{bmatrix}\n   \\sum_{n=0}^{N} c_n P_n(-1) \\\\\n   \\sum_{n=0}^{N} c_n P_n'(1)\n   \\end{bmatrix}\n   = \\begin{bmatrix}\n   u(-1) \\\\\n   u'(1)\n   \\end{bmatrix}.\n   $$\n   使用上述事实以闭合形式显式构造 $A$。\n\n2. 计算一个满足 $\\ell(-1)=0$ 和 $\\ell'(1)=\\alpha$ 的最小次数的提升函数 $\\ell(x)$。证明一个有效的选择是 $\\ell(x) = \\alpha(1+x)$，并将其在勒让德基中表示。通过直接计算验证 $A\\,c_{\\text{lift}} = [0,\\alpha]^T$ 精确成立，其中 $c_{\\text{lift}}$ 是 $\\ell(x)$ 的勒让德系数。\n\n3. 为齐次子空间构造一个重组基\n   $$\n   \\mathcal{V}_H \\equiv \\left\\{ v(x) = \\sum_{n=0}^{N} c_n P_n(x) \\;:\\; A\\,c = \\begin{bmatrix}0\\\\0\\end{bmatrix} \\right\\}.\n   $$\n   计算一个系数矩阵 $Z \\in \\mathbb{R}^{(N+1)\\times K}$，其列构成了 $\\ker(A)$ 的一个基，其中对于 $N \\ge 2$，有 $K = N-1$。相应的齐次基函数为 $\\{\\psi_k(x)\\}_{k=1}^{K}$，其中 $\\psi_k(x) = \\sum_{n=0}^{N} Z_{n,k} P_n(x)$。\n\n4. 关于 $L^2$ 内积，齐次基中的质量矩阵为 $M_Z = Z^T M Z \\in \\mathbb{R}^{K \\times K}$。计算其 2-范数条件数 $\\kappa(M_Z)$。\n\n5. 关于 $L^2$ 质量矩阵进行标准正交化。令 $W = \\operatorname{diag}\\!\\big(\\sqrt{2/(2n+1)}\\big)_{n=0}^{N}$，从而 $M = W^2$。定义 $Y = W Z$，执行一个薄的实值 $QR$ 分解 $Y = Q R$，其中 $Q \\in \\mathbb{R}^{(N+1)\\times K}$ 具有标准正交列，并设置 $M$-标准正交系数矩阵 $Z_{\\text{ortho}} = W^{-1} Q$。标准正交化的重组基为 $\\{\\phi_k(x)\\}_{k=1}^K$，其中 $\\phi_k(x) = \\sum_{n=0}^{N} (Z_{\\text{ortho}})_{n,k} P_n(x)$。验证 $Z_{\\text{ortho}}^T M Z_{\\text{ortho}} = I_K$ 并且每个 $\\phi_k$ 都满足齐次边界条件。\n\n6. 比较以下条件数：\n   - 原始勒让德基（大小为 $(N+1)$）的 $\\kappa(M)$，即 $M \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 的条件数，\n   - 标准正交化前的 $\\kappa(M_Z)$，\n   - 标准正交化后的 $\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}})$。\n\n7. 通过计算来量化边界条件强制执行误差\n   $$\n   \\varepsilon_{\\text{bc}} \\equiv \\max\\left\\{ \\max_{k} |\\phi_k(-1)| ,\\; \\max_{k} |\\phi_k'(1)| \\right\\},\n   $$\n   以及提升残差\n   $$\n   \\varepsilon_{\\text{lift}} \\equiv \\left\\|A\\,c_{\\text{lift}} - \\begin{bmatrix}0\\\\ \\alpha\\end{bmatrix}\\right\\|_{\\infty}.\n   $$\n\n您的程序必须实现上述步骤，并为以下参数对 $(N,\\alpha)$ 的测试套件生成数值输出：\n- 测试用例 1：$(N,\\alpha)=(3,1.5)$，\n- 测试用例 2：$(N,\\alpha)=(6,0.0)$，\n- 测试用例 3：$(N,\\alpha)=(10,-2.0)$，\n- 测试用例 4：$(N,\\alpha)=(2,0.7)$。\n\n对于每个测试用例，按顺序输出一个包含 5 个浮点值的列表\n$[\\kappa(M),\\;\\kappa(M_Z),\\;\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}}),\\;\\varepsilon_{\\text{bc}},\\;\\varepsilon_{\\text{lift}}]$。\n将所有测试用例的列表聚合成一个单一列表，顺序与上文列出的一致。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表的列表（例如，`[[r_{1,1},\\dots,r_{1,5}],[r_{2,1},\\dots,r_{2,5}],\\dots]`）。\n- 除了有效的 Python 列表格式化所需的空格外，不应打印任何额外的文本或空白。",
            "solution": "该问题已经过验证，并被确定为有效。这是一个数值分析领域（特别是在谱方法领域）中的适定问题，所有提供的数据和数学关系都是正确且自洽的。我们现在开始求解。\n\n核心任务是在区间 $[-1, 1]$ 上构造一个次数至多为 $N$ 的多项式基，该基包含了混合边界条件 $u(-1)=0$ 和 $u'(1)=\\alpha$。这通过将解 $u(x)$ 分解为一个提升部分 $\\ell(x)$ 和一个齐次部分 $w(x)$ 来实现，使得 $u(x)=\\ell(x)+w(x)$。提升函数满足非齐次边界数据 $\\ell(-1)=0$ 和 $\\ell'(1)=\\alpha$，而修正函数 $w(x)$ 满足相应的齐次条件 $w(-1)=0$ 和 $w'(1)=0$。\n\n设任意次数至多为 $N$ 的多项式 $v(x)$ 在勒让德基 $\\{P_n(x)\\}_{n=0}^N$ 中表示为 $v(x) = \\sum_{n=0}^{N} c_n P_n(x)$，其系数向量为 $c = [c_0, c_1, \\dots, c_N]^T$。\n\n**1. 边界算子 $A$**\n\n边界算子 $A$ 将系数向量 $c$ 映射到函数及其导数在边界处的值。\n$$\nA\\,c = \\begin{bmatrix}\n   v(-1) \\\\\n   v'(1)\n   \\end{bmatrix} = \\begin{bmatrix}\n   \\sum_{n=0}^{N} c_n P_n(-1) \\\\\n   \\sum_{n=0}^{N} c_n P_n'(1)\n   \\end{bmatrix}\n$$\n使用所提供的恒等式 $P_n(-1) = (-1)^n$ 和 $P_n'(1) = \\frac{n(n+1)}{2}$，我们可以显式地构造矩阵 $A \\in \\mathbb{R}^{2 \\times (N+1)}$。它的行由这些函数对于 $n=0, \\dots, N$ 的值构成。\n$A$ 的第一行，对应于在 $x=-1$ 处的求值，是：\n$$\nA_{0,n} = P_n(-1) = (-1)^n \\quad \\text{for } n=0, \\dots, N\n$$\n$A$ 的第二行，对应于在 $x=1$ 处的导数求值，是：\n$$\nA_{1,n} = P_n'(1) = \\frac{n(n+1)}{2} \\quad \\text{for } n=0, \\dots, N\n$$\n因此，矩阵 $A$ 是：\n$$\nA = \\begin{bmatrix}\n    1  -1  1  -1  \\dots  (-1)^N \\\\\n    0  1  3  6  \\dots  \\frac{N(N+1)}{2}\n\\end{bmatrix}\n$$\n\n**2. 提升函数 $\\ell(x)$**\n\n我们寻找一个满足 $\\ell(-1)=0$ 和 $\\ell'(1)=\\alpha$ 的最小多项式次数的提升函数 $\\ell(x)$。提出的函数是 $\\ell(x) = \\alpha(1+x)$。\n我们来验证边界条件：\n- $\\ell(-1) = \\alpha(1+(-1)) = 0$。\n- $\\ell'(x) = \\alpha$，所以 $\\ell'(1) = \\alpha$。\n条件得到满足。次数为 0 的多项式无法满足这些条件（除非 $\\alpha=0$），因此次数 1 是最小的。\n\n为了在勒让德基中表示 $\\ell(x)$，我们使用 $P_0(x)=1$ 和 $P_1(x)=x$ 这一事实。\n$$\n\\ell(x) = \\alpha \\cdot 1 + \\alpha \\cdot x = \\alpha P_0(x) + \\alpha P_1(x)\n$$\n因此，相应的系数向量 $c_{\\text{lift}} \\in \\mathbb{R}^{N+1}$ 是：\n$$\nc_{\\text{lift}} = [\\alpha, \\alpha, 0, \\dots, 0]^T\n$$\n我们通过直接计算验证 $A c_{\\text{lift}} = [0, \\alpha]^T$：\n$$\nA c_{\\text{lift}} = \\begin{bmatrix}\n    \\sum_{n=0}^{N} (c_{\\text{lift}})_n (-1)^n \\\\\n    \\sum_{n=0}^{N} (c_{\\text{lift}})_n \\frac{n(n+1)}{2}\n\\end{bmatrix} = \\begin{bmatrix}\n    \\alpha (-1)^0 + \\alpha (-1)^1 \\\\\n    \\alpha \\frac{0(1)}{2} + \\alpha \\frac{1(2)}{2}\n\\end{bmatrix} = \\begin{bmatrix}\n    \\alpha - \\alpha \\\\\n    0 + \\alpha\n\\end{bmatrix} = \\begin{bmatrix}\n    0 \\\\\n    \\alpha\n\\end{bmatrix}\n$$\n验证是精确的。提升残差 $\\varepsilon_{\\text{lift}}$ 解析上为零。\n\n**3. 齐次基的构造**\n\n齐次基函数 $\\{\\psi_k(x)\\}_{k=1}^K$ 张成边界条件为零的子空间 $\\mathcal{V}_H$。这些函数的系数向量必须位于算子 $A$ 的零空间（核）中。\n$$\n\\ker(A) = \\{ c \\in \\mathbb{R}^{N+1} \\;:\\; A\\,c = \\mathbf{0} \\}\n$$\n次数至多为 $N$ 的多项式空间维数为 $N+1$。对于 $N \\ge 1$，$A$ 的两行是线性无关的。因此，它们施加了两个独立的线性约束，$\\ker(A)$ 的维数是 $K = (N+1)-2 = N-1$。我们计算这个零空间的一个基，构成一个矩阵 $Z \\in \\mathbb{R}^{(N+1)\\times K}$ 的列。这可以通过数值方法完成，例如，使用 $A$ 的奇异值分解。$Z$ 的列是齐次基函数 $\\psi_k(x) = \\sum_{n=0}^{N} Z_{n,k} P_n(x)$ 的系数向量。\n\n**4. 质量矩阵和条件数**\n\n在标准勒让德基中，$L^2$ 质量矩阵 $M$ 由于正交性而是对角矩阵：\n$$\nM_{ij} = \\int_{-1}^{1} P_i(x) P_j(x) \\, dx = \\frac{2}{2i+1} \\delta_{ij}\n$$\n所以，$M = \\operatorname{diag}(2, 2/3, 2/5, \\dots, 2/(2N+1))$。\n在新的齐次基 $\\{\\psi_k\\}$ 中的质量矩阵由 $M_Z = Z^T M Z$ 给出。我们计算这个矩阵及其 2-范数条件数 $\\kappa(M_Z) = \\sigma_{\\max}(M_Z) / \\sigma_{\\min}(M_Z)$。\n\n**5. 标准正交化**\n\n为了改善质量矩阵的条件数，我们对齐次基关于 $L^2$ 内积进行标准正交化，这等价于系数向量上的 $M$-内积。令 $M=W^2$，其中 $W=\\operatorname{diag}(\\sqrt{2/(2n+1)})$。我们构成加权基矩阵 $Y=WZ$ 并执行薄 QR 分解 $Y=QR$。新的、$M$-标准正交系数矩阵是 $Z_{\\text{ortho}} = W^{-1}Q$。\n根据构造，新的质量矩阵是单位矩阵：\n$$\nZ_{\\text{ortho}}^T M Z_{\\text{ortho}} = (W^{-1}Q)^T (W^2) (W^{-1}Q) = Q^T W^{-T} W^2 W^{-1} Q = Q^T Q = I_K\n$$\n这是因为 $W$ 是对称的（$W=W^T$，所以 $W^{-T}=W^{-1}$）并且 $Q$ 具有标准正交列（$Q^T Q=I_K$）。基函数 $\\phi_k(x) = \\sum_{n=0}^{N} (Z_{\\text{ortho}})_{n,k} P_n(x)$ 是 $L^2$-标准正交的，并且满足齐次边界条件，因为 $Z_{\\text{ortho}}$ 的列是 $Z$ 的列的线性组合，因此位于 $\\ker(A)$ 中。\n\n**6. 条件数比较**\n我们将计算和比较三个条件数：\n- $\\kappa(M)$：对于对角矩阵 $M$，这是其最大对角元素与最小对角元素之比。$\\kappa(M) = \\max_n(M_{nn})/\\min_n(M_{nn}) = (2/1) / (2/(2N+1)) = 2N+1$。\n- $\\kappa(M_Z)$：重组但未标准正交化的基中的质量矩阵的条件数。预计该值会大于 1。\n- $\\kappa(Z_{\\text{ortho}}^T M Z_{\\text{ortho}})$：根据构造，这是 $\\kappa(I_K) = 1$。这可以作为标准正交化过程的数值验证。与 1 的偏差将由浮点误差引起。\n\n**7. 误差量化**\n我们计算两个误差度量来评估基构造的数值稳定性和准确性。\n- 边界条件误差 $\\varepsilon_{\\text{bc}}$：这衡量了标准正交化基函数 $\\{\\phi_k\\}$ 满足零边界条件的程度。我们计算 $A Z_{\\text{ortho}}$ 并找出其所有项中的最大绝对值。\n$$\n\\varepsilon_{\\text{bc}} = \\max\\left\\{ \\max_{k} |\\phi_k(-1)| ,\\; \\max_{k} |\\phi_k'(1)| \\right\\} = \\|A Z_{\\text{ortho}}\\|_{\\max}\n$$\n- 提升残差 $\\varepsilon_{\\text{lift}}$：这衡量了提升函数在满足非齐次边界条件时的误差。\n$$\n\\varepsilon_{\\text{lift}} = \\left\\|A\\,c_{\\text{lift}} - \\begin{bmatrix}0\\\\ \\alpha\\end{bmatrix}\\right\\|_{\\infty}\n$$\n理论上，两个误差都应为零。在实践中，它们将处于机器精度的量级，反映了线性代数计算过程中浮点误差的累积。\n以下代码为给定的测试用例实现了这些步骤。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (3, 1.5),\n        (6, 0.0),\n        (10, -2.0),\n        (2, 0.7),\n    ]\n\n    all_results = []\n    for N, alpha in test_cases:\n        result = _compute_basis_properties(N, alpha)\n        all_results.append(result)\n\n    # Format the final output as a single list of lists string.\n    # e.g., [[r1, r2, ...], [s1, s2, ...]]\n    # Using a simple string build to avoid extra spaces from standard list repr.\n    output_str = \"[\" + \",\".join([\"[\" + \",\".join(map(str, res)) + \"]\" for res in all_results]) + \"]\"\n    print(output_str)\n\ndef _compute_basis_properties(N, alpha):\n    \"\"\"\n    Performs the calculations for a single test case (N, alpha).\n\n    Args:\n        N (int): The maximum polynomial degree.\n        alpha (float): The value for the inhomogeneous derivative boundary condition.\n\n    Returns:\n        list: A list of 5 floating-point values:\n              [cond(M), cond(M_Z), cond(Z_ortho^T M Z_ortho), eps_bc, eps_lift].\n    \"\"\"\n    if N  2:\n        raise ValueError(\"N must be >= 2 for the kernel dimension to be N-1.\")\n\n    N_plus_1 = N + 1\n    K = N - 1\n\n    # Task 1: Construct the boundary operator matrix A\n    n_vals = np.arange(N_plus_1, dtype=float)\n    row1 = (-1.0)**n_vals  # P_n(-1)\n    row2 = n_vals * (n_vals + 1) / 2.0  # P_n'(1)\n    A = np.vstack([row1, row2])\n\n    # Task 2: Define the lifting coefficient vector c_lift\n    c_lift = np.zeros(N_plus_1)\n    if N_plus_1 > 1:\n        c_lift[0] = alpha\n        c_lift[1] = alpha\n\n    # Task 3: Compute the kernel of A to get the homogeneous basis coefficient matrix Z\n    # scipy.linalg.null_space returns an orthonormal basis for the null space.\n    Z = linalg.null_space(A)\n\n    # Define the L2 mass matrix M for the Legendre basis\n    diag_M = 2.0 / (2.0 * n_vals + 1.0)\n    M = np.diag(diag_M)\n\n    # Task 4: Compute the mass matrix M_Z in the new basis and its condition number\n    # For N=2, K=1, M_Z is a scalar, so its condition number is 1.\n    if K > 0:\n        M_Z = Z.T @ M @ Z\n        cond_M_Z = np.linalg.cond(M_Z)\n    else: # Should not happen based on N>=2\n        cond_M_Z = 1.0\n\n    # Task 5: Orthonormalize the basis with respect to the M inner product\n    W = np.diag(np.sqrt(diag_M))\n    W_inv = np.diag(1.0 / np.sqrt(diag_M))\n    \n    Z_ortho = np.zeros_like(Z)\n    if K > 0:\n        Y = W @ Z\n        # Thin QR decomposition\n        Q, R = np.linalg.qr(Y, mode='reduced')\n        Z_ortho = W_inv @ Q\n\n    # Task 6: Compare condition numbers\n    # Analytical condition number for the diagonal matrix M\n    cond_M = (2.0 / 1.0) / (2.0 / (2.0 * N + 1.0))\n\n    # Condition number of the mass matrix in the M-orthonormal basis (should be ~1)\n    if K > 0:\n        M_ortho = Z_ortho.T @ M @ Z_ortho\n        cond_M_ortho = np.linalg.cond(M_ortho)\n    else:\n        cond_M_ortho = 1.0\n\n    # Task 7: Quantify errors\n    # Boundary condition enforcement error for the orthonormal basis\n    if K > 0:\n        bc_error_matrix = A @ Z_ortho\n        eps_bc = np.max(np.abs(bc_error_matrix))\n    else:\n        eps_bc = 0.0\n\n    # Lifting residual error\n    lift_residual = A @ c_lift - np.array([0.0, alpha])\n    eps_lift = np.max(np.abs(lift_residual))\n\n    return [cond_M, cond_M_Z, cond_M_ortho, eps_bc, eps_lift]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}