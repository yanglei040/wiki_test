{
    "hands_on_practices": [
        {
            "introduction": "The accuracy of a nonintrusive stochastic collocation method hinges on the precision of the numerical quadrature used to compute the polynomial chaos coefficients. When the quadrature rule lacks sufficient polynomial exactness for the integrand, a phenomenon known as aliasing occurs, where energy from high-degree polynomial modes erroneously contaminates the coefficients of low-degree modes. This exercise  provides a foundational analysis of this issue, guiding you to derive the precise conditions under which aliasing corrupts the pseudo-spectral projection and to determine the minimum number of quadrature points required to guarantee exactness.",
            "id": "3403735",
            "problem": "Consider a nonintrusive stochastic collocation procedure for a one-dimensional random input with uniform distribution on the interval $[-1,1]$. Let $\\{\\psi_{k}(x)\\}_{k \\geq 0}$ denote the Legendre polynomial basis, orthonormal with respect to the weight $\\rho(x)=\\frac{1}{2}$ on $[-1,1]$. In a pseudo-spectral projection, generalized polynomial chaos (gPC) coefficients are computed by approximating the inner product\n$$\na_{k}=\\int_{-1}^{1} f(x)\\,\\psi_{k}(x)\\,\\rho(x)\\,dx\n$$\nusing an $n$-point Gauss–Legendre quadrature with nodes $\\{x_{j}\\}_{j=1}^{n}$ and positive weights $\\{w_{j}\\}_{j=1}^{n}$, yielding the discrete sum\n$$\n\\widehat{a}_{k}=\\sum_{j=1}^{n} w_{j} \\, f(x_{j})\\,\\psi_{k}(x_{j}).\n$$\nAssume the deterministic quantity of interest $f(x)$ arising from a nonlinear flux discretized by a polynomial of degree $r$ in a discontinuous Galerkin method is itself a polynomial in $x$ of degree $r$, and suppose we seek gPC coefficients up to degree $p$; that is, $k$ ranges over $0\\leq k \\leq p$. The Gauss–Legendre rule is exact for integrals of polynomials of degree at most $2n-1$.\n\nDerive, from first principles of orthogonality of Legendre polynomials and the polynomial exactness of Gauss–Legendre quadrature, the aliasing condition under which the pseudo-spectral projection mis-estimates coefficients $a_{k}$ with $k0$. Explicitly characterize the degrees $(r,k)$ leading to aliasing due to finite exactness, and explain how high-degree terms can contaminate lower-order coefficients when $r+k$ exceeds the quadrature exactness.\n\nThen, present a principled remedy using sparse grids based on the Smolyak construction: explain how to select one-dimensional nested rules so that the multi-dimensional collocation, when extended to $d$ independent uniform random variables via Smolyak, avoids aliasing for all multi-index coefficients of total degree at most $p$. Your remedy must be stated in terms of one-dimensional polynomial exactness requirements per coordinate and how these propagate through the Smolyak combination.\n\nFinally, provide the minimal number of Gauss–Legendre points $n_{\\min}$, as a closed-form analytic expression in terms of $r$ and $p$, that guarantees the one-dimensional pseudo-spectral projection computes all coefficients $a_{k}$ for $0\\leq k\\leq p$ exactly (i.e., without aliasing). Express your final answer as an analytic expression. No numerical rounding is required.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the theory of numerical analysis, specifically nonintrusive spectral methods and quadrature. It is well-posed, objective, and contains sufficient information to derive the requested conditions and expressions.\n\nThe core of the problem concerns aliasing error in a pseudo-spectral projection method. This error arises when a continuous integral is approximated by a discrete sum (quadrature) that lacks sufficient polynomial exactness for the integrand. We will analyze this phenomenon in one dimension first, then extend the principle to multiple dimensions via sparse grids, and finally derive the condition for avoiding aliasing in one dimension.\n\nLet the quantity of interest $f(x)$ be a polynomial of degree $r$. As such, it has a finite, exact expansion in the orthonormal Legendre basis $\\{\\psi_{k}(x)\\}_{k \\geq 0}$:\n$$\nf(x) = \\sum_{l=0}^{r} c_{l} \\psi_{l}(x)\n$$\nThe coefficients $\\{c_l\\}$ are the true generalized polynomial chaos (gPC) coefficients of $f(x)$. The exact coefficient $a_k$ is defined by the inner product:\n$$\na_{k} = \\int_{-1}^{1} f(x) \\psi_{k}(x) \\rho(x) dx\n$$\nSubstituting the expansion of $f(x)$ and leveraging the orthonormality of the basis, where $\\int_{-1}^{1} \\psi_{l}(x) \\psi_{k}(x) \\rho(x) dx = \\delta_{lk}$, we find:\n$$\na_{k} = \\int_{-1}^{1} \\left( \\sum_{l=0}^{r} c_{l} \\psi_{l}(x) \\right) \\psi_{k}(x) \\rho(x) dx = \\sum_{l=0}^{r} c_{l} \\int_{-1}^{1} \\psi_{l}(x) \\psi_{k}(x) \\rho(x) dx = \\sum_{l=0}^{r} c_{l} \\delta_{lk}\n$$\nThis demonstrates that $a_k = c_k$ for $0 \\leq k \\leq r$, and $a_k = 0$ for $k  r$.\n\nThe pseudo-spectral projection computes an approximation $\\widehat{a}_k$ using an $n$-point Gauss-Legendre quadrature rule:\n$$\n\\widehat{a}_{k} = \\sum_{j=1}^{n} w_{j} f(x_{j}) \\psi_{k}(x_{j})\n$$\nThis sum is the quadrature approximation of the integral for $a_k$, where the integrand is the function $g_k(x) = f(x) \\psi_k(x)$. The problem states that the $n$-point Gauss-Legendre quadrature rule is exact for any polynomial of degree at most $2n-1$. The degree of the integrand $g_k(x)$ is $\\deg(f) + \\deg(\\psi_k) = r+k$. Therefore, $\\widehat{a}_k = a_k$ if and only if $r+k \\leq 2n-1$.\n\nWhen this condition is violated, i.e., $r+k  2n-1$, the quadrature is no longer exact, and aliasing occurs. To characterize this error, we substitute the expansion of $f(x)$ into the formula for $\\widehat{a}_k$:\n$$\n\\widehat{a}_{k} = \\sum_{j=1}^{n} w_{j} \\left( \\sum_{l=0}^{r} c_{l} \\psi_{l}(x_j) \\right) \\psi_{k}(x_{j}) = \\sum_{l=0}^{r} c_{l} \\left( \\sum_{j=1}^{n} w_{j} \\psi_{l}(x_j) \\psi_{k}(x_j) \\right)\n$$\nThe inner sum is the quadrature approximation of $\\int_{-1}^{1} \\psi_{l}(x) \\psi_{k}(x) \\rho(x) dx = \\delta_{lk}$. This approximation is exact if $\\deg(\\psi_l \\psi_k) = l+k \\leq 2n-1$. If $l+k  2n-1$, the discrete sum is not necessarily zero (for $l \\neq k$) or one (for $l=k$).\n\nThe computed coefficient $\\widehat{a}_k$ is therefore:\n$$\n\\widehat{a}_{k} = \\sum_{l \\in \\{0, \\dots, r\\} \\text{ s.t. } l+k \\leq 2n-1} c_l \\delta_{lk} + \\sum_{l \\in \\{0, \\dots, r\\} \\text{ s.t. } l+k  2n-1} c_l \\left( \\sum_{j=1}^{n} w_{j} \\psi_{l}(x_j) \\psi_{k}(x_j) \\right)\n$$\nAssuming $k \\leq 2n-1$, the first term simplifies to $c_k = a_k$. The second term represents the aliasing error.\n$$\n\\widehat{a}_k = a_k + \\sum_{l \\in \\{0, \\dots, r\\}, l \\neq k, l+k  2n-1} c_l \\left( \\sum_{j=1}^{n} w_{j} \\psi_{l}(x_j) \\psi_{k}(x_j) \\right)\n$$\nThis equation explicitly shows how coefficients $c_l$ of high-degree basis functions in $f(x)$ (where $l$ is large enough that $l+k  2n-1$) are aliased and contaminate the estimation of the lower-order coefficient $a_k$. Any pair of degrees $(r,k)$ such that $r+k  2n-1$ will lead to potential aliasing, because the expansion of $f(x)$ may contain terms $\\psi_l(x)$ with degree $l$ high enough to cause the integrand degree $l+k$ to exceed the quadrature's exactness. For this question, we are concerned with $k0$. The aliasing condition is general and holds for any $k \\geq 0$.\n\nNext, we consider the remedy using sparse grids for a $d$-dimensional problem with independent uniform random variables. The goal is to compute coefficients $a_{\\mathbf{k}}$ for multi-indices $\\mathbf{k}$ with total degree $|\\mathbf{k}|_1 = \\sum_{i=1}^d k_i \\leq p$. The quantity of interest $f(\\mathbf{x})$ is assumed to be a polynomial of total degree $r$. The integrand for computing $a_{\\mathbf{k}}$ is $f(\\mathbf{x}) \\Psi_{\\mathbf{k}}(\\mathbf{x})$, where $\\Psi_{\\mathbf{k}}(\\mathbf{x})$ is the tensor-product Legendre polynomial of degree $k_i$ in each coordinate $x_i$. The total degree of this integrand is at most $\\deg(f) + \\deg(\\Psi_{\\mathbf{k}}) = r + |\\mathbf{k}|_1$. To avoid aliasing for all coefficients up to total degree $p$, the quadrature rule must be exact for all integrands $f(\\mathbf{x}) \\Psi_{\\mathbf{k}}(\\mathbf{x})$ where $|\\mathbf{k}|_1 \\leq p$. This requires the rule to be exact for all polynomials of total degree up to $r+p$.\n\nThe Smolyak construction provides a means to build a multi-dimensional quadrature rule from a sequence of 1D rules. The remedy is to select the 1D rules and the Smolyak construction level to achieve the required degree of polynomial exactness. A principled selection is as follows:\n1.  For each dimension, define a sequence of 1D quadrature rules, indexed by a level $i \\in \\{1, 2, \\dots\\}$. To ensure high-degree exactness, one should choose the level-$i$ rule, $\\mathcal{Q}_i$, to be the $i$-point Gauss-Legendre rule. This 1D rule has a polynomial exactness of $2i-1$.\n2.  Construct a multi-dimensional quadrature rule $\\mathcal{A}(L,d)$ using the Smolyak algorithm at a chosen level $L$. This algorithm combines tensor products of the 1D rules $\\mathcal{Q}_i$ for levels $i_1, \\dots, i_d$ satisfying certain criteria, typically $|\\mathbf{i}|_1 \\leq L$ or $L-d+1 \\leq |\\mathbf{i}|_1 \\leq L$.\n3.  The crucial step is to select a level $L$ sufficiently high to guarantee exactness for polynomials of total degree $r+p$. For the choice of 1D rules where $\\mathcal{Q}_i$ is the $i$-point Gauss rule, a standard result states that the Smolyak rule built on levels $|\\mathbf{i}|_1 \\le L$ is exact for all polynomials of total degree at most $2(L-d)+1$.\n4.  Therefore, to avoid aliasing for all coefficients of total degree up to $p$, the level $L$ must be chosen to satisfy: $2(L-d)+1 \\geq r+p$. This inequality dictates the minimum Smolyak level required. In practice, one would often use nested rules (e.g., Clenshaw-Curtis or Gauss-Patterson) for efficiency, which have different exactness properties ($d_i$) but the same principle applies: the Smolyak construction level must be chosen to ensure the resulting multi-dimensional rule is exact for all polynomials of total degree up to $r+p$.\n\nFinally, we derive the minimal number of Gauss-Legendre points, $n_{\\min}$, for the one-dimensional case that guarantees no aliasing for all coefficients $a_k$ where $0 \\leq k \\leq p$.\nAs established, aliasing is avoided for the computation of a specific coefficient $a_k$ if the $n$-point quadrature rule is exact for the integrand $f(x)\\psi_k(x)$. The condition is:\n$$\n\\deg(f \\psi_k) \\leq 2n-1\n$$\nwhich translates to:\n$$\nr + k \\leq 2n-1\n$$\nThis inequality must hold for all coefficients we wish to compute exactly, i.e., for the entire range $k \\in \\{0, 1, \\dots, p\\}$. To ensure this, we must enforce the condition for the most stringent case, which corresponds to the maximum value of $k$ in the range, namely $k=p$.\nThe condition thus becomes:\n$$\nr + p \\leq 2n-1\n$$\nWe seek the minimal integer $n$ that satisfies this inequality. We rearrange the inequality to solve for $n$:\n$$\n2n \\geq r+p+1\n$$\n$$\nn \\geq \\frac{r+p+1}{2}\n$$\nSince the number of quadrature points $n$ must be an integer, the minimal number of points $n_{\\min}$ is the smallest integer that is greater than or equal to $\\frac{r+p+1}{2}$. This is given by the ceiling function:\n$$\nn_{\\min} = \\left\\lceil \\frac{r+p+1}{2} \\right\\rceil\n$$\nThis expression provides the minimum number of Gauss-Legendre points required to prevent aliasing when computing all gPC coefficients up to degree $p$ for a polynomial quantity of interest of degree $r$.",
            "answer": "$$\\boxed{\\left\\lceil \\frac{r+p+1}{2} \\right\\rceil}$$"
        },
        {
            "introduction": "While single-dimensional uncertainty is instructive, real-world problems often involve numerous random parameters, leading to the so-called \"curse of dimensionality\" where the cost of tensor-product grids grows exponentially. Sparse grids, constructed via the Smolyak algorithm, offer a powerful remedy by creating an efficient multi-dimensional quadrature rule from a combination of one-dimensional rules. This practice  offers a direct, hands-on experience with the combinatorial logic of the Smolyak construction, allowing you to build a sparse grid from its constituent multi-indices and appreciate its significant cost savings.",
            "id": "3403649",
            "problem": "Consider a nonintrusive stochastic collocation method (SCM) for a $3$-dimensional parametric input vector $\\boldsymbol{\\xi} = (\\xi_1,\\xi_2,\\xi_3)$ whose components are independent and uniformly distributed on the interval $[-1,1]$. You will construct a sparse grid node set for interpolation based on the Smolyak operator $\\mathcal{A}(q,d)$ with $q=3$ and $d=3$, using nested one-dimensional Clenshaw–Curtis collocation rules.\n\nUse the following foundational definitions:\n\n- The one-dimensional level-$\\ell$ collocation rule has a nested node set $\\mathcal{X}_\\ell$ with cardinality $N_\\ell$, where $N_1 = 1$, $N_2 = 3$, $N_3 = 5$, and, for $\\ell \\geq 2$, $N_\\ell = 2^{\\ell-1} + 1$. Define the hierarchical increment sets by $\\Delta \\mathcal{X}_1 := \\mathcal{X}_1$, and, for $\\ell \\geq 2$, $\\Delta \\mathcal{X}_\\ell := \\mathcal{X}_\\ell \\setminus \\mathcal{X}_{\\ell-1}$, with incremental cardinalities $M_\\ell := |\\Delta \\mathcal{X}_\\ell|$. By definition, $M_1 = 1$, $M_2 = 2$, and, for $\\ell \\geq 3$, $M_\\ell = N_\\ell - N_{\\ell-1} = 2^{\\ell-2}$.\n\n- The Smolyak interpolation operator with nested rules is formed from tensor-product hierarchical increments. Its multi-index set is\n$$\n\\mathcal{I}(q,d) := \\left\\{ \\boldsymbol{i} = (i_1,i_2,i_3) \\in \\mathbb{N}^3 \\;:\\; \\sum_{k=1}^3 i_k \\leq q + d - 1,\\;\\; i_k \\geq 1 \\right\\}.\n$$\nThe associated sparse grid node set is the disjoint union of tensor-product increment sets,\n$$\n\\mathcal{S}(q,d) := \\bigcup_{\\boldsymbol{i} \\in \\mathcal{I}(q,d)} \\left( \\Delta \\mathcal{X}_{i_1} \\times \\Delta \\mathcal{X}_{i_2} \\times \\Delta \\mathcal{X}_{i_3} \\right),\n$$\nand its total number of distinct nodes is\n$$\n|\\mathcal{S}(q,d)| = \\sum_{\\boldsymbol{i} \\in \\mathcal{I}(q,d)} \\prod_{k=1}^3 M_{i_k}.\n$$\n\nTasks:\n1. List all multi-index combinations $\\boldsymbol{i} \\in \\mathcal{I}(q=3,d=3)$ that contribute to the Smolyak operator.\n2. Using the above definitions, compute the total number of distinct collocation nodes in the sparse grid $\\mathcal{S}(3,3)$.\n\nYour final answer must be the single integer equal to $|\\mathcal{S}(3,3)|$.",
            "solution": "The problem statement has been validated and is deemed sound. It is a well-posed mathematical problem based on standard definitions in the field of numerical analysis, specifically for sparse grid methods. All necessary data and definitions are provided, internally consistent, and free of ambiguity.\n\nThe objective is to compute the total number of distinct collocation nodes, denoted by $|\\mathcal{S}(q,d)|$, in a sparse grid constructed using the Smolyak operator. The parameters are given as the level-to-accuracy parameter $q=3$ and the input dimension $d=3$.\n\nThe total number of nodes is given by the formula:\n$$\n|\\mathcal{S}(q,d)| = \\sum_{\\boldsymbol{i} \\in \\mathcal{I}(q,d)} \\prod_{k=1}^d M_{i_k}\n$$\nFor this problem, $d=3$, so the formula is:\n$$\n|\\mathcal{S}(3,3)| = \\sum_{\\boldsymbol{i} \\in \\mathcal{I}(3,3)} M_{i_1} M_{i_2} M_{i_3}\n$$\n\nThe first step is to identify the set of multi-indices $\\mathcal{I}(q,d)$. The definition provided is:\n$$\n\\mathcal{I}(q,d) := \\left\\{ \\boldsymbol{i} = (i_1, \\dots, i_d) \\in \\mathbb{N}^d \\;:\\; \\sum_{k=1}^d i_k \\leq q + d - 1,\\;\\; i_k \\geq 1 \\right\\}\n$$\nWith $q=3$ and $d=3$, the condition on the sum of indices becomes:\n$$\n\\sum_{k=1}^3 i_k \\leq 3 + 3 - 1 = 5\n$$\nSo, we must find all triples of positive integers $\\boldsymbol{i} = (i_1, i_2, i_3)$ whose sum is less than or equal to $5$. We can enumerate these multi-indices by grouping them according to their sum, $|\\boldsymbol{i}|_1 = i_1+i_2+i_3$.\n\nTask 1: List all multi-index combinations $\\boldsymbol{i} \\in \\mathcal{I}(3,3)$.\n\n-   Case $|\\boldsymbol{i}|_1 = 3$:\n    The only combination of three positive integers that sum to $3$ is $(1,1,1)$.\n    Multi-indices: $(1,1,1)$.\n\n-   Case $|\\boldsymbol{i}|_1 = 4$:\n    We need combinations of three positive integers that sum to $4$. The only partition of $4$ into three parts is $2+1+1$. The permutations of $(2,1,1)$ are:\n    Multi-indices: $(2,1,1)$, $(1,2,1)$, $(1,1,2)$.\n\n-   Case $|\\boldsymbol{i}|_1 = 5$:\n    We need combinations of three positive integers that sum to $5$. The partitions of $5$ into three parts are $3+1+1$ and $2+2+1$.\n    Permutations of $(3,1,1)$: $(3,1,1)$, $(1,3,1)$, $(1,1,3)$.\n    Permutations of $(2,2,1)$: $(2,2,1)$, $(2,1,2)$, $(1,2,2)$.\n\nIn total, the set $\\mathcal{I}(3,3)$ contains $1+3+3+3 = 10$ multi-indices:\n$$\n\\mathcal{I}(3,3) = \\{ (1,1,1), (2,1,1), (1,2,1), (1,1,2), (3,1,1), (1,3,1), (1,1,3), (2,2,1), (2,1,2), (1,2,2) \\}\n$$\n\nTask 2: Compute the total number of distinct collocation nodes $|\\mathcal{S}(3,3)|$.\n\nNext, we need the values of the incremental cardinalities, $M_\\ell = |\\Delta\\mathcal{X}_\\ell|$, for the indices that appear in $\\mathcal{I}(3,3)$, which are $\\ell \\in \\{1,2,3\\}$.\nFrom the problem statement:\n-   $M_1 = 1$\n-   $M_2 = 2$\n-   For $\\ell \\geq 3$, $M_\\ell = 2^{\\ell-2}$. For $\\ell=3$, this gives $M_3 = 2^{3-2} = 2^1 = 2$.\n\nNow we can compute the sum $\\sum_{\\boldsymbol{i} \\in \\mathcal{I}(3,3)} M_{i_1} M_{i_2} M_{i_3}$. We can group the terms by the structure of the multi-index $\\boldsymbol{i}$:\n\n-   For $\\boldsymbol{i} = (1,1,1)$:\n    There is one such index. The contribution is $M_1 M_1 M_1 = 1 \\cdot 1 \\cdot 1 = 1$.\n\n-   For permutations of $(2,1,1)$:\n    There are $3$ such indices: $(2,1,1)$, $(1,2,1)$, and $(1,1,2)$. For each, the product of cardinalities is $M_2 M_1 M_1 = 2 \\cdot 1 \\cdot 1 = 2$.\n    The total contribution from this group is $3 \\times 2 = 6$.\n\n-   For permutations of $(3,1,1)$:\n    There are $3$ such indices: $(3,1,1)$, $(1,3,1)$, and $(1,1,3)$. For each, the product of cardinalities is $M_3 M_1 M_1 = 2 \\cdot 1 \\cdot 1 = 2$.\n    The total contribution from this group is $3 \\times 2 = 6$.\n\n-   For permutations of $(2,2,1)$:\n    There are $3$ such indices: $(2,2,1)$, $(2,1,2)$, and $(1,2,2)$. For each, the product of cardinalities is $M_2 M_2 M_1 = 2 \\cdot 2 \\cdot 1 = 4$.\n    The total contribution from this group is $3 \\times 4 = 12$.\n\nFinally, the total number of nodes is the sum of these contributions:\n$$\n|\\mathcal{S}(3,3)| = 1 + 6 + 6 + 12 = 25\n$$\nThus, the total number of distinct collocation nodes in the sparse grid $\\mathcal{S}(3,3)$ is $25$.",
            "answer": "$$\\boxed{25}$$"
        },
        {
            "introduction": "This practice synthesizes the preceding concepts into a complete computational workflow, applying the nonintrusive stochastic collocation method to a boundary value problem discretized with a Discontinuous Galerkin (DG) scheme. You will implement the full NISC pipeline: solving the deterministic PDE at a set of collocation nodes and then projecting the solutions to find the generalized Polynomial Chaos (gPC) coefficients. Crucially, this exercise  also requires you to solve the same problem using an intrusive gPC approach, providing a direct comparison that illuminates the fundamental trade-offs, accuracy, and implementation complexity between these two cornerstone methodologies in uncertainty quantification.",
            "id": "3403720",
            "problem": "Consider the one-dimensional boundary value problem for the unknown field $u(x,\\boldsymbol{\\xi})$ on the spatial domain $[0,1]$ and a single scalar random variable $\\xi \\in [-1,1]$ with uniform probability density $\\rho(\\xi)=\\frac{1}{2}$:\n$$\n-\\frac{d^2}{dx^2} u(x,\\xi) = f(x,\\xi), \\quad u(0,\\xi)=0, \\quad u(1,\\xi)=0,\n$$\nwhere $f(x,\\xi)=f_0(x)+\\xi f_1(x)$ is an affine function of $\\xi$ and the spatial operator is deterministic (independent of $\\xi$). The spatial discretization is the Symmetric Interior Penalty Discontinuous Galerkin (SIPG) method with piecewise-linear basis functions on a uniform mesh of $N$ elements with penalty parameter $\\sigma0$. Assume exact integration of element and face terms in the SIPG bilinear form, and use exact formulas for the volume and face contributions consistent with the SIPG method for the operator $-\\frac{d^2}{dx^2}$ and homogeneous Dirichlet boundary conditions enforced weakly via penalty.\n\nThe generalized Polynomial Chaos (gPC) basis is formed by the first three orthonormal Legendre polynomials on $[-1,1]$ with respect to the weight $\\rho(\\xi)=\\frac{1}{2}$:\n$$\n\\psi_0(\\xi)=1,\\quad \\psi_1(\\xi)=\\sqrt{3}\\,\\xi,\\quad \\psi_2(\\xi)=\\frac{\\sqrt{5}}{2}\\,(3\\xi^2-1).\n$$\nLet the truncated gPC expansion of $u$ up to total degree $2$ be\n$$\nu(x,\\xi) \\approx \\sum_{n=0}^{2} u_n(x)\\,\\psi_n(\\xi),\n$$\nwith coefficient fields $u_n(x)$ to be computed nonintrusively by stochastic collocation and projection. Specifically, use the minimal collocation node set for total degree $2$, namely the $3$-point Gauss–Legendre nodes $\\{\\xi_k\\}_{k=1}^3$ on $[-1,1]$ with weights $\\{w_k\\}_{k=1}^3$, and compute the deterministic DG solution $u(x,\\xi_k)$ for each node $\\xi_k$. Then obtain the gPC coefficients by projection:\n$$\nu_n(x) \\approx \\sum_{k=1}^{3} \\left(\\frac{w_k}{2}\\right) u(x,\\xi_k)\\,\\psi_n(\\xi_k), \\quad n=0,1,2,\n$$\nwhere the factor $\\frac{w_k}{2}$ accounts for the probability density $\\rho(\\xi)=\\frac{1}{2}$.\n\nFor comparison, compute the intrusive gPC coefficients as follows. For the case where the operator is deterministic and only the right-hand side is affine, the Galerkin system in the stochastic dimension decouples:\n$$\nK\\,u_n = b_n, \\quad n=0,1,2,\n$$\nwhere $K$ is the deterministic SIPG stiffness matrix and $b_n$ are the projected loads\n$$\nb_n = \\int_{-1}^{1} \\left( f_0(x) + \\xi f_1(x) \\right)\\psi_n(\\xi)\\,\\rho(\\xi)\\,d\\xi \\quad \\text{applied to the DG test functions in space}.\n$$\nFor the case where the operator depends affinely on $\\xi$ through a scalar diffusion factor $a(\\xi)=a_0+a_1\\xi0$, so that the discrete bilinear form is scaled by $a(\\xi)$, the intrusive gPC satisfies the coupled block system in stochastic space:\n$$\n\\sum_{m=0}^{2} \\mathbb{E}\\!\\left[a(\\xi)\\psi_n(\\xi)\\psi_m(\\xi)\\right]\\,K\\,u_m = \\mathbb{E}\\!\\left[\\psi_n(\\xi)\\right]\\,f_0, \\quad n=0,1,2,\n$$\nwith $f_0$ independent of $\\xi$, $\\mathbb{E}[\\cdot]=\\int_{-1}^{1}(\\cdot)\\rho(\\xi)\\,d\\xi$, and $K$ the SIPG stiffness. This can be written compactly as\n$$\n\\left( \\mathbf{M}_a \\otimes K \\right)\\,\\mathbf{u} = \\mathbf{e}_0 \\otimes f_0,\n$$\nwhere $\\mathbf{M}_a \\in \\mathbb{R}^{3\\times 3}$ has entries $(\\mathbf{M}_a)_{nm}=\\mathbb{E}[a(\\xi)\\psi_n(\\xi)\\psi_m(\\xi)]$, $\\mathbf{e}_0=(1,0,0)^\\top$, and $\\mathbf{u}$ stacks the spatial coefficient vectors $u_0,u_1,u_2$.\n\nStarting from the Discontinuous Galerkin method’s bilinear and linear forms and the orthonormality of the gPC basis, derive the nonintrusive projection formula, and the intrusive system for the two scenarios. Then implement a program that:\n- Assembles the SIPG stiffness matrix $K$ and load vectors for given $f_0(x)$ and $f_1(x)$.\n- Computes $u(x,\\xi_k)$ at the $3$ Gauss–Legendre nodes and projects to obtain $u_0,u_1,u_2$.\n- Computes the intrusive gPC coefficients $u_0,u_1,u_2$ for the case with operator independent of $\\xi$ and $f(x,\\xi)=f_0(x)+\\xi f_1(x)$.\n- Computes both nonintrusive and intrusive gPC coefficients for the case with operator $a(\\xi)K$ and forcing $f_0(x)$ (no $\\xi$ in the load).\n- Compares the coefficients by reporting the relative $2$-norm of the difference over the concatenated coefficient vectors.\n\nUse the following test suite (all functions dimensionless; angles not required):\n1. Happy path: $N=8$, $\\sigma=20$, $f_0(x)=\\sin(\\pi x)$, $f_1(x)=\\cos(2\\pi x)$. Operator independent of $\\xi$. Compute the relative $2$-norm of the difference between nonintrusive and intrusive coefficients.\n2. Affine operator scaling: $N=8$, $\\sigma=20$, $a(\\xi)=1+0.5\\,\\xi$, $f_0(x)=\\sin(\\pi x)$, $f_1(x)=0$. Compare nonintrusive projection coefficients against intrusive coefficients from the coupled system and report the relative $2$-norm difference.\n3. Deterministic edge case: $N=8$, $\\sigma=20$, $f_0(x)=\\sin(\\pi x)$, $f_1(x)=0$. Operator independent of $\\xi$. Report the relative $2$-norm difference between nonintrusive and intrusive coefficients.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). Each result must be a float. Implement the SIPG assembly faithfully, including interior face consistency and penalty terms and homogeneous Dirichlet boundaries enforced weakly via penalty, and use exact $3$-point Gauss–Legendre nodes and weights for the stochastic collocation and projection with the correct density factor $\\frac{1}{2}$ for expectations.",
            "solution": "The problem requires the derivation of numerical methods for solving a stochastic boundary value problem, followed by an implementation to compare these methods on specific test cases. The core numerical methods are the Symmetric Interior Penalty Discontinuous Galerkin (SIPG) method for spatial discretization and generalized Polynomial Chaos (gPC) expansions for the stochastic dimension, handled via both nonintrusive and intrusive approaches.\n\n### Theoretical Derivations\n\n#### 1. SIPG Discretization\nThe problem is the one-dimensional Poisson equation $-\\frac{d^2u}{dx^2} = f$ on $\\Omega=[0,1]$ with homogeneous Dirichlet boundary conditions $u(0)=u(1)=0$. The domain is partitioned into $N$ elements $K_j=[x_j, x_{j+1}]$ of length $h=1/N$. The approximate solution $u_h$ is sought in the space $V_h$ of piecewise polynomials of degree $p=1$.\n\nThe SIPG weak formulation reads: find $u_h \\in V_h$ such that for all $v_h \\in V_h$:\n$$B_h(u_h, v_h) = L_h(v_h)$$\nThe bilinear form $B_h(u,v)$ and linear form $L_h(v)$ are defined as:\n$$B_h(u,v) = \\sum_{j=1}^{N} \\int_{K_j} u'v' dx - \\sum_{F \\in \\mathcal{F}_I} \\int_F \\left( \\{u'\\} [v] + \\{v'\\} [u] \\right) ds + \\sum_{F \\in \\mathcal{F}_I} \\int_F \\frac{\\sigma}{h} [u][v] ds + B_{BC}(u,v)$$\n$$L_h(v) = \\int_0^1 f(x)v(x) dx$$\nHere, $\\mathcal{F}_I$ is the set of interior faces (element boundaries), $[u]=u_L-u_R$ is the jump, and $\\{u'\\}=(u'_L+u'_R)/2$ is the average. The penalty parameter is $\\sigma0$. The boundary condition term $B_{BC}(u,v)$ enforces $u(0)=u(1)=0$ weakly:\n$$B_{BC}(u,v) = \\left( -u'v + \\frac{\\sigma}{h}uv \\right)\\Big|_{x=0} + \\left( u'v + \\frac{\\sigma}{h}uv \\right)\\Big|_{x=1}$$\nExpanding $u_h$ and $v_h$ in a basis for $V_h$, this formulation leads to a matrix system $K\\mathbf{u} = \\mathbf{b}$, where $K$ is the SIPG stiffness matrix derived from $B_h(\\cdot,\\cdot)$ and $\\mathbf{b}$ is the load vector from $L_h(\\cdot)$.\n\n#### 2. Nonintrusive Stochastic Collocation (NISC)\nThe solution $u(x,\\xi)$ is approximated by a truncated gPC expansion $u(x,\\xi) \\approx \\sum_{n=0}^{2} u_n(x)\\psi_n(\\xi)$. The coefficients $u_n(x)$ are determined by projection:\n$$u_n(x) = \\mathbb{E}[u(x,\\xi)\\psi_n(\\xi)] = \\int_{-1}^{1} u(x,\\xi)\\psi_n(\\xi) \\rho(\\xi) d\\xi$$\nwhere $\\rho(\\xi)=1/2$ is the uniform probability density. This integral is approximated using a quadrature rule. For the given problem, which requires accuracy for polynomials up to degree $2$, a $3$-point Gauss-Legendre quadrature is chosen. The nodes $\\{\\xi_k\\}_{k=1}^3$ are the roots of the Legendre polynomial $P_3(\\xi)$, and $\\{w_k\\}_{k=1}^3$ are the corresponding weights for an integral over $[-1,1]$ with weight function $1$. The projection formula becomes:\n$$u_n(x) \\approx \\frac{1}{2} \\int_{-1}^{1} u(x,\\xi)\\psi_n(\\xi) d\\xi \\approx \\frac{1}{2} \\sum_{k=1}^{3} w_k u(x, \\xi_k) \\psi_n(\\xi_k)$$\nThis matches the formula specified in the problem statement. The algorithm is nonintrusive because it treats the deterministic solver as a black box:\n1.  For each collocation node $\\xi_k$, solve the deterministic DG problem $K\\mathbf{u}(\\xi_k) = \\mathbf{b}(\\xi_k)$ to find the solution vector $\\mathbf{u}(\\xi_k)$.\n2.  Compute the coefficient vectors $\\mathbf{u}_n$ using the quadrature formula: $\\mathbf{u}_n = \\frac{1}{2} \\sum_{k=1}^{3} w_k \\mathbf{u}(\\xi_k) \\psi_n(\\xi_k)$.\n\n#### 3. Intrusive Galerkin Projection\n\nThe intrusive method applies a Galerkin projection in the stochastic space. The weak form is $\\mathbb{E}[B_h(u, v\\psi_m)] = \\mathbb{E}[L_h(v\\psi_m)]$ for $m=0,1,2$.\n\n**Case 1: Deterministic Operator, Stochastic RHS**\nThe operator is deterministic, so $B_h(u,v;\\xi) = B_h(u,v)$. The RHS is $f(x,\\xi)=f_0(x)+\\xi f_1(x)$.\nSubstituting the gPC expansion $u=\\sum_n u_n\\psi_n$ into the weak form:\n$$\\sum_{n=0}^{2} B_h(u_n, v) \\mathbb{E}[\\psi_n\\psi_m] = \\mathbb{E}[L_h(f_0+\\xi f_1, v)\\psi_m]$$\nBy orthonormality, $\\mathbb{E}[\\psi_n\\psi_m]=\\delta_{nm}$, so the system decouples:\n$$B_h(u_m, v) = \\mathbb{E}[(L_h(f_0,v) + \\xi L_h(f_1,v))\\psi_m] = L_h(f_0,v)\\mathbb{E}[\\psi_m] + L_h(f_1,v)\\mathbb{E}[\\xi\\psi_m]$$\nWe compute the expectations: $\\mathbb{E}[\\psi_0]=1$, $\\mathbb{E}[\\psi_1]=0$, $\\mathbb{E}[\\psi_2]=0$. Using the identity $\\xi = \\psi_1/\\sqrt{3}$, we find $\\mathbb{E}[\\xi\\psi_0]=0$, $\\mathbb{E}[\\xi\\psi_1]=\\mathbb{E}[\\psi_1^2/\\sqrt{3}]=1/\\sqrt{3}$, and $\\mathbb{E}[\\xi\\psi_2]=0$.\nThis leads to the decoupled systems:\n- For $m=0$: $B_h(u_0, v) = L_h(f_0,v) \\implies K\\mathbf{u}_0 = \\mathbf{b}_0$.\n- For $m=1$: $B_h(u_1, v) = L_h(f_1,v)/\\sqrt{3} \\implies K\\mathbf{u}_1 = \\mathbf{b}_1/\\sqrt{3}$.\n- For $m=2$: $B_h(u_2, v) = 0 \\implies K\\mathbf{u}_2 = \\mathbf{0}$.\n\n**Case 2: Stochastic Operator, Deterministic RHS**\nThe equation is $-\\frac{d}{dx}(a(\\xi)u') = f_0(x)$, where $a(\\xi)=a_0+a_1\\xi$. The bilinear form is $B_h(u,v;\\xi) = a(\\xi)B_h^{det}(u,v)$, where $B_h^{det}$ is the deterministic form. The weak form is:\n$$\\sum_{n=0}^{2} B_h^{det}(u_n, v) \\mathbb{E}[a(\\xi)\\psi_n\\psi_m] = L_h(f_0,v)\\mathbb{E}[\\psi_m]$$\nThe right-hand side is non-zero only for $m=0$, where it is $L_h(f_0,v)$. In matrix form, this yields a coupled block system:\n$$\\sum_{n=0}^{2} (\\mathbf{M}_a)_{mn} K \\mathbf{u}_n = \\delta_{m0} \\mathbf{f}_0$$\nwhere $K$ is the matrix from $B_h^{det}$, $\\mathbf{f}_0$ is from $L_h(f_0,v)$, and $(\\mathbf{M}_a)_{mn} = \\mathbb{E}[a(\\xi)\\psi_n\\psi_m]$. This is equivalent to the Kronecker product formulation $(\\mathbf{M}_a \\otimes K)\\mathbf{U} = \\mathbf{e}_0 \\otimes \\mathbf{f}_0$.\n\n### Implementation Plan\nThe implementation will proceed as follows:\n1.  **SIPG Assembly**: A function will assemble the sparse SIPG stiffness matrix $K$ and the load vector $\\mathbf{b}$ for a given function $f$. Integration for the load vector will use high-precision numerical quadrature (`scipy.integrate.quad`) to satisfy the \"exact integration\" assumption.\n2.  **Test Case 1**:\n    -   *Intrusive*: Solve the three decoupled systems for $\\mathbf{u}_0, \\mathbf{u}_1, \\mathbf{u}_2$.\n    -   *Nonintrusive*: Solve the deterministic DG problem at the three Gauss-Legendre nodes $\\{\\xi_k\\}$ and project the solutions to get $\\mathbf{u}_0, \\mathbf{u}_1, \\mathbf{u}_2$.\n    -   Compute the relative $2$-norm of the difference between the concatenated solution vectors. Since the exact solution $u(x,\\xi)$ is affine in $\\xi$ and the gPC expansion is truncated at a sufficiently high degree, the $3$-point collocation method is exact, and the difference should be near machine precision.\n3.  **Test Case 2**:\n    -   *Intrusive*: Assemble the coupling matrix $\\mathbf{M}_a$ and the global block matrix $\\mathbf{M}_a \\otimes K$. Solve the coupled system for the stacked vector of coefficients $\\mathbf{U}$.\n    -   *Nonintrusive*: At each collocation node $\\xi_k$, assemble the scaled stiffness matrix $a(\\xi_k)K$ and solve the deterministic problem. Project the results.\n    -   Compute the relative $2$-norm of the difference. Here, the true solution is a rational function of $\\xi$, so the NISC method is not exact, and a non-zero difference is expected.\n4.  **Test Case 3**:\n    -   This is a deterministic problem ($f_1=0$) and serves as a sanity check. Both intrusive and nonintrusive methods should yield $\\mathbf{u}_1=\\mathbf{0}$ and $\\mathbf{u}_2=\\mathbf{0}$, with $\\mathbf{u}_0$ being the standard deterministic DG solution. The difference should be near zero.\n\nThe results from the three test cases will be collected and printed in the specified format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, kron\nfrom scipy.sparse.linalg import spsolve\nfrom scipy.integrate import quad\n\ndef assemble_sipg_stiffness(N, sigma):\n    \"\"\"\n    Assembles the SIPG stiffness matrix for the 1D negative Laplacian.\n    \"\"\"\n    h = 1.0 / N\n    num_dofs = 2 * N\n    K = lil_matrix((num_dofs, num_dofs))\n\n    # Volume term: integral of u' v' over each element\n    local_K_vol = (1.0 / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n    for j in range(N):\n        dof1, dof2 = 2 * j, 2 * j + 1\n        K[dof1:dof2 + 1, dof1:dof2 + 1] += local_K_vol\n\n    # Interior face terms\n    for j in range(1, N):\n        dof_L2 = 2 * (j - 1) + 1\n        dof_R1 = 2 * j\n        \n        # Diagonal contributions\n        K[dof_L2, dof_L2] += -1.0 / h + sigma / h\n        K[dof_R1, dof_R1] += -1.0 / h + sigma / h\n        \n        # Off-diagonal contributions\n        K[dof_L2, dof_R1] += 1.0 / h - sigma / h\n        K[dof_R1, dof_L2] += 1.0 / h - sigma / h\n\n    # Boundary face terms (homogeneous Dirichlet)\n    # At x=0\n    K[0, 0] += 1.0 / h + sigma / h\n    # At x=1\n    K[num_dofs - 1, num_dofs - 1] += 1.0 / h + sigma / h\n\n    return K.tocsc()\n\ndef assemble_load_vector(N, f_func):\n    \"\"\"\n    Assembles the load vector using high-precision numerical quadrature.\n    \"\"\"\n    h = 1.0 / N\n    num_dofs = 2 * N\n    b = np.zeros(num_dofs)\n    for j in range(N):\n        x_j, x_jp1 = j * h, (j + 1) * h\n        \n        # Contribution to the first basis function of element j\n        integrand1 = lambda x: f_func(x) * (x_jp1 - x) / h\n        b[2 * j], _ = quad(integrand1, x_j, x_jp1, epsabs=1e-12, epsrel=1e-12)\n        \n        # Contribution to the second basis function of element j\n        integrand2 = lambda x: f_func(x) * (x - x_j) / h\n        b[2 * j + 1], _ = quad(integrand2, x_j, x_jp1, epsabs=1e-12, epsrel=1e-12)\n        \n    return b\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the three test cases.\n    \"\"\"\n    test_cases = [\n        {'type': 1, 'N': 8, 'sigma': 20, 'f0': lambda x: np.sin(np.pi * x), 'f1': lambda x: np.cos(2 * np.pi * x)},\n        {'type': 2, 'N': 8, 'sigma': 20, 'a_func': lambda xi: 1.0 + 0.5 * xi, 'f0': lambda x: np.sin(np.pi * x)},\n        {'type': 3, 'N': 8, 'sigma': 20, 'f0': lambda x: np.sin(np.pi * x), 'f1': lambda x: 0.0}\n    ]\n\n    results = []\n\n    # gPC and Collocation setup\n    sqrt3 = np.sqrt(3.0)\n    sqrt5 = np.sqrt(5.0)\n    psi = [\n        lambda xi: 1.0,\n        lambda xi: sqrt3 * xi,\n        lambda xi: (sqrt5 / 2.0) * (3.0 * xi**2 - 1.0)\n    ]\n    \n    # 3-point Gauss-Legendre nodes and weights on [-1, 1]\n    xi_k = np.array([-np.sqrt(3.0/5.0), 0.0, np.sqrt(3.0/5.0)])\n    w_k = np.array([5.0/9.0, 8.0/9.0, 5.0/9.0])\n    \n    # Pre-evaluate psi_n(xi_k)\n    psi_vals = np.array([[p(x) for x in xi_k] for p in psi])\n\n    for case in test_cases:\n        N = case['N']\n        sigma = case['sigma']\n        num_dofs = 2 * N\n        \n        K_det = assemble_sipg_stiffness(N, sigma)\n\n        if case['type'] == 1 or case['type'] == 3:\n            f0, f1 = case['f0'], case['f1']\n            b0 = assemble_load_vector(N, f0)\n            b1 = assemble_load_vector(N, f1)\n\n            # Intrusive solution\n            u0_intr = spsolve(K_det, b0)\n            u1_intr = spsolve(K_det, b1 / sqrt3)\n            u2_intr = np.zeros(num_dofs)\n            u_intr = np.concatenate([u0_intr, u1_intr, u2_intr])\n            \n            # Nonintrusive solution\n            u_at_nodes = []\n            for xi in xi_k:\n                f_k = lambda x: f0(x) + xi * f1(x)\n                b_k = assemble_load_vector(N, f_k)\n                u_k = spsolve(K_det, b_k)\n                u_at_nodes.append(u_k)\n            u_at_nodes = np.array(u_at_nodes)\n            \n            u_nisc_coeffs = []\n            for n in range(3):\n                u_n = np.sum(0.5 * w_k * psi_vals[n] * u_at_nodes.T, axis=1)\n                u_nisc_coeffs.append(u_n)\n            u_nisc = np.concatenate(u_nisc_coeffs)\n            \n        elif case['type'] == 2:\n            a_func = case['a_func']\n            f0 = case['f0']\n            f0_vec = assemble_load_vector(N, f0)\n\n            # Intrusive solution\n            a0, a1 = 1.0, 0.5\n            sqrt15 = np.sqrt(15.0)\n            C = np.array([\n                [0.0, 1.0/sqrt3, 0.0],\n                [1.0/sqrt3, 0.0, 2.0/sqrt15],\n                [0.0, 2.0/sqrt15, 0.0]\n            ])\n            M_a = a0 * np.eye(3) + a1 * C\n            \n            M_a_kron_K = kron(M_a, K_det)\n            \n            rhs_stacked = np.zeros(3 * num_dofs)\n            rhs_stacked[:num_dofs] = f0_vec\n            \n            u_intr = spsolve(M_a_kron_K, rhs_stacked)\n\n            # Nonintrusive solution\n            u_at_nodes = []\n            for xi in xi_k:\n                a_k = a_func(xi)\n                K_k = a_k * K_det\n                u_k = spsolve(K_k, f0_vec)\n                u_at_nodes.append(u_k)\n            u_at_nodes = np.array(u_at_nodes)\n\n            u_nisc_coeffs = []\n            for n in range(3):\n                u_n = np.sum(0.5 * w_k * psi_vals[n] * u_at_nodes.T, axis=1)\n                u_nisc_coeffs.append(u_n)\n            u_nisc = np.concatenate(u_nisc_coeffs)\n\n        # Comparison\n        norm_intr = np.linalg.norm(u_intr)\n        if norm_intr == 0:\n            rel_diff = np.linalg.norm(u_nisc - u_intr)\n        else:\n            rel_diff = np.linalg.norm(u_nisc - u_intr) / norm_intr\n            \n        results.append(rel_diff)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}