{
    "hands_on_practices": [
        {
            "introduction": "Moving beyond simple isotropic cases, real-world materials often exhibit anisotropy, where electromagnetic properties depend on direction. This exercise () provides foundational practice in extending the Discontinuous Galerkin (DG) formulation to handle such complexity. By deriving the weak form and the characteristic wave speeds for an anisotropic medium, you will develop the analytical tools necessary to construct stable and accurate numerical fluxes for a broader class of physical problems.",
            "id": "3375459",
            "problem": "Consider time-domain electromagnetic wave propagation governed by Maxwell’s equations in a linear, inhomogeneous, anisotropic medium. The constitutive relations are $\\boldsymbol{D} = \\boldsymbol{\\epsilon}(\\boldsymbol{x}) \\boldsymbol{E}$ and $\\boldsymbol{B} = \\boldsymbol{\\mu}(\\boldsymbol{x}) \\boldsymbol{H}$, where $\\boldsymbol{\\epsilon}(\\boldsymbol{x})$ and $\\boldsymbol{\\mu}(\\boldsymbol{x})$ are spatially varying, symmetric, positive-definite tensors. Maxwell’s equations are\n$$\n\\partial_{t} \\boldsymbol{D} = \\nabla \\times \\boldsymbol{H} - \\boldsymbol{J}, \\qquad\n\\partial_{t} \\boldsymbol{B} = - \\nabla \\times \\boldsymbol{E},\n$$\nwith $\\boldsymbol{J}(\\boldsymbol{x},t)$ a given source.\n\nRestrict attention to the two-dimensional transverse-magnetic polarization, where the nonzero field components are $E_{x}(\\boldsymbol{x},t)$, $E_{y}(\\boldsymbol{x},t)$, and $H_{z}(\\boldsymbol{x},t)$. Assume an anisotropic permittivity $\\boldsymbol{\\epsilon}(\\boldsymbol{x}) = \\mathrm{diag}(\\epsilon_{x}(\\boldsymbol{x}), \\epsilon_{y}(\\boldsymbol{x}))$ and anisotropic permeability $\\boldsymbol{\\mu}(\\boldsymbol{x}) = \\mathrm{diag}(0,0,\\mu_{z}(\\boldsymbol{x}))$. Let $\\boldsymbol{J} = \\boldsymbol{0}$.\n\nStarting from the fundamental laws stated above and the constitutive relations, perform the following:\n\n- Write the strong-form partial differential equations for $E_{x}$, $E_{y}$, and $H_{z}$ in this anisotropic medium.\n\n- Derive the element-wise weak form suitable for a Discontinuous Galerkin (DG) method, including the treatment of spatially varying $\\epsilon_{x}(\\boldsymbol{x})$, $\\epsilon_{y}(\\boldsymbol{x})$, and $\\mu_{z}(\\boldsymbol{x})$ in the volume integrals. Clearly state the boundary (face) terms arising from integration by parts, and explain how the numerical flux must be adapted to account for the anisotropy and inhomogeneity.\n\n- Using an energy method and a one-dimensional normal-mode analysis local to a face, determine the characteristic wave speed along a face with unit outward normal $\\boldsymbol{n} = (n_{x}, n_{y})$ that governs the upwind numerical flux and the Courant–Friedrichs–Lewy (CFL) time-step restriction for the TM system in this anisotropic medium. Provide your final expression for this face-normal characteristic speed $c(\\boldsymbol{n})$ in closed form as a function of $\\epsilon_{x}$, $\\epsilon_{y}$, $\\mu_{z}$, $n_{x}$, and $n_{y}$, all evaluated at the face location.\n\nExpress your final answer as a single, closed-form analytic expression. Do not substitute numerical values. If the expression were to be evaluated numerically, the speed should be expressed in meters per second, but in this problem you must present only the analytic expression without units in the final boxed answer.",
            "solution": "The problem as stated is scientifically grounded, self-contained, and well-posed. It is based on the fundamental principles of Maxwell's equations and uses standard models and simplifications for analyzing wave propagation in anisotropic media. The tasks are standard derivations in the field of computational electromagnetics and Discontinuous Galerkin methods. Therefore, the problem is valid, and a full solution is provided below.\n\nThe solution is presented in three parts as requested: derivation of the strong-form partial differential equations (PDEs), derivation of the element-wise weak form, and determination of the characteristic wave speed.\n\n**Part 1: Strong-Form Partial Differential Equations**\n\nWe begin with Maxwell's equations in a source-free ($\\boldsymbol{J}=\\boldsymbol{0}$) medium:\n$$ \\partial_{t} \\boldsymbol{D} = \\nabla \\times \\boldsymbol{H} $$\n$$ \\partial_{t} \\boldsymbol{B} = - \\nabla \\times \\boldsymbol{E} $$\nThe constitutive relations for the linear, inhomogeneous, anisotropic medium are $\\boldsymbol{D} = \\boldsymbol{\\epsilon}(\\boldsymbol{x}) \\boldsymbol{E}$ and $\\boldsymbol{B} = \\boldsymbol{\\mu}(\\boldsymbol{x}) \\boldsymbol{H}$.\n\nFor the two-dimensional transverse-magnetic (TM) case, the fields are restricted to $\\boldsymbol{E}(\\boldsymbol{x},t) = (E_{x}(x,y,t), E_{y}(x,y,t), 0)$ and $\\boldsymbol{H}(\\boldsymbol{x},t) = (0, 0, H_{z}(x,y,t))$. The spatial variation is limited to the $xy$-plane, so all partial derivatives with respect to $z$ are zero, i.e., $\\partial_z \\equiv 0$.\n\nThe permittivity tensor is given as $\\boldsymbol{\\epsilon}(\\boldsymbol{x}) = \\mathrm{diag}(\\epsilon_{x}(\\boldsymbol{x}), \\epsilon_{y}(\\boldsymbol{x}))$. In a 3D context, this implies the full tensor is $\\boldsymbol{\\epsilon}(\\boldsymbol{x}) = \\mathrm{diag}(\\epsilon_{x}(\\boldsymbol{x}), \\epsilon_{y}(\\boldsymbol{x}), \\epsilon_{z}(\\boldsymbol{x}))$. The electric displacement vector $\\boldsymbol{D}$ is:\n$$ \\boldsymbol{D} = \\begin{pmatrix} \\epsilon_x & 0 & 0 \\\\ 0 & \\epsilon_y & 0 \\\\ 0 & 0 & \\epsilon_z \\end{pmatrix} \\begin{pmatrix} E_x \\\\ E_y \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\epsilon_x E_x \\\\ \\epsilon_y E_y \\\\ 0 \\end{pmatrix} $$\nThe permeability tensor is given as $\\boldsymbol{\\mu}(\\boldsymbol{x}) = \\mathrm{diag}(0,0,\\mu_{z}(\\boldsymbol{x}))$. The magnetic induction vector $\\boldsymbol{B}$ is:\n$$ \\boldsymbol{B} = \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & \\mu_z \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ H_z \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\mu_z H_z \\end{pmatrix} $$\nThis form of $\\boldsymbol{\\mu}$ consistently enforces that $B_x=B_y=0$ for the TM mode.\n\nNow, we expand the curl operators in Maxwell's equations.\nFrom Faraday's law, $\\partial_{t} \\boldsymbol{B} = -\\nabla \\times \\boldsymbol{E}$:\n$$ \\nabla \\times \\boldsymbol{E} = \\begin{pmatrix} \\partial_y E_z - \\partial_z E_y \\\\ \\partial_z E_x - \\partial_x E_z \\\\ \\partial_x E_y - \\partial_y E_x \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\partial_x E_y - \\partial_y E_x \\end{pmatrix} $$\nsince $E_z=0$ and $\\partial_z = 0$. Equating components of $\\partial_t \\boldsymbol{B} = -\\nabla \\times \\boldsymbol{E}$:\n$$ \\partial_t B_x = 0 $$\n$$ \\partial_t B_y = 0 $$\n$$ \\partial_t B_z = -(\\partial_x E_y - \\partial_y E_x) $$\nSubstituting $B_z = \\mu_z H_z$ into the third equation, we get the first PDE:\n$$ \\mu_z(\\boldsymbol{x}) \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_x}{\\partial y} - \\frac{\\partial E_y}{\\partial x} $$\n\nFrom Ampère's law, $\\partial_{t} \\boldsymbol{D} = \\nabla \\times \\boldsymbol{H}$:\n$$ \\nabla \\times \\boldsymbol{H} = \\begin{pmatrix} \\partial_y H_z - \\partial_z H_y \\\\ \\partial_z H_x - \\partial_x H_z \\\\ \\partial_x H_y - \\partial_y H_x \\end{pmatrix} = \\begin{pmatrix} \\partial_y H_z \\\\ -\\partial_x H_z \\\\ 0 \\end{pmatrix} $$\nsince $H_x=H_y=0$ and $\\partial_z=0$. Equating components of $\\partial_t \\boldsymbol{D} = \\nabla \\times \\boldsymbol{H}$:\n$$ \\partial_t D_x = \\partial_y H_z $$\n$$ \\partial_t D_y = -\\partial_x H_z $$\n$$ \\partial_t D_z = 0 $$\nSubstituting $D_x = \\epsilon_x E_x$ and $D_y = \\epsilon_y E_y$, we obtain the other two PDEs:\n$$ \\epsilon_x(\\boldsymbol{x}) \\frac{\\partial E_x}{\\partial t} = \\frac{\\partial H_z}{\\partial y} $$\n$$ \\epsilon_y(\\boldsymbol{x}) \\frac{\\partial E_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x} $$\n\nThe strong-form system of PDEs for the nonzero field components $E_x$, $E_y$, and $H_z$ is:\n$$ \\epsilon_x(\\boldsymbol{x}) \\frac{\\partial E_x}{\\partial t} = \\frac{\\partial H_z}{\\partial y} $$\n$$ \\epsilon_y(\\boldsymbol{x}) \\frac{\\partial E_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x} $$\n$$ \\mu_z(\\boldsymbol{x}) \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_x}{\\partial y} - \\frac{\\partial E_y}{\\partial x} $$\n\n**Part 2: Discontinuous Galerkin Weak Form**\n\nTo derive the weak form, we consider a single element $K$ in a mesh discretizing the spatial domain. We multiply each PDE by a test function $\\psi(\\boldsymbol{x})$ from an appropriate function space and integrate over the element $K$. Let the discrete solution fields be denoted by $E_x^h, E_y^h, H_z^h$, which are polynomials on $K$.\n\nFor the first equation:\n$$ \\int_K \\epsilon_x(\\boldsymbol{x}) \\frac{\\partial E_x^h}{\\partial t} \\psi \\, d\\boldsymbol{x} = \\int_K \\frac{\\partial H_z^h}{\\partial y} \\psi \\, d\\boldsymbol{x} $$\nApplying integration by parts (Green's first identity) to the right-hand side:\n$$ \\int_K \\frac{\\partial H_z^h}{\\partial y} \\psi \\, d\\boldsymbol{x} = \\oint_{\\partial K} (H_z^h \\psi) n_y \\, ds - \\int_K H_z^h \\frac{\\partial \\psi}{\\partial y} \\, d\\boldsymbol{x} $$\nwhere $\\boldsymbol{n} = (n_x, n_y)$ is the outward unit normal to the element boundary $\\partial K$. In the DG method, the state variable $H_z^h$ on the boundary is replaced by a numerical flux, denoted $H_z^*$. The flux $H_z^*$ is a function of the states on both sides of the face, i.e., $H_z^*$ depends on the interior state ($H_z^h, E_x^h, E_y^h$) and the exterior state from the neighboring element. This gives the weak form:\n$$ \\int_K \\epsilon_x(\\boldsymbol{x}) \\frac{\\partial E_x^h}{\\partial t} \\psi \\, d\\boldsymbol{x} + \\int_K H_z^h \\frac{\\partial \\psi}{\\partial y} \\, d\\boldsymbol{x} - \\oint_{\\partial K} H_z^* \\psi n_y \\, ds = 0 $$\n\nFor the second equation:\n$$ \\int_K \\epsilon_y(\\boldsymbol{x}) \\frac{\\partial E_y^h}{\\partial t} \\psi \\, d\\boldsymbol{x} = - \\int_K \\frac{\\partial H_z^h}{\\partial x} \\psi \\, d\\boldsymbol{x} $$\nSimilarly, integrating by parts and introducing the numerical flux $H_z^*$:\n$$ \\int_K \\frac{\\partial H_z^h}{\\partial x} \\psi \\, d\\boldsymbol{x} = \\oint_{\\partial K} (H_z^h \\psi) n_x \\, ds - \\int_K H_z^h \\frac{\\partial \\psi}{\\partial x} \\, d\\boldsymbol{x} $$\nThe weak form is:\n$$ \\int_K \\epsilon_y(\\boldsymbol{x}) \\frac{\\partial E_y^h}{\\partial t} \\psi \\, d\\boldsymbol{x} + \\int_K H_z^h \\frac{\\partial \\psi}{\\partial x} \\, d\\boldsymbol{x} - \\oint_{\\partial K} H_z^* \\psi n_x \\, ds = 0 $$\n\nFor the third equation:\n$$ \\int_K \\mu_z(\\boldsymbol{x}) \\frac{\\partial H_z^h}{\\partial t} \\psi \\, d\\boldsymbol{x} = \\int_K \\left(\\frac{\\partial E_x^h}{\\partial y} - \\frac{\\partial E_y^h}{\\partial x}\\right) \\psi \\, d\\boldsymbol{x} $$\nIntegrating both terms on the right-hand side by parts and introducing numerical fluxes $E_x^*$ and $E_y^*$:\n$$ \\int_K \\mu_z(\\boldsymbol{x}) \\frac{\\partial H_z^h}{\\partial t} \\psi \\, d\\boldsymbol{x} + \\int_K \\left(E_x^h \\frac{\\partial \\psi}{\\partial y} - E_y^h \\frac{\\partial \\psi}{\\partial x}\\right) \\, d\\boldsymbol{x} - \\oint_{\\partial K} (E_x^* n_y - E_y^* n_x) \\psi \\, ds = 0 $$\nThe spatially varying material parameters $\\epsilon_x(\\boldsymbol{x})$, $\\epsilon_y(\\boldsymbol{x})$, and $\\mu_z(\\boldsymbol{x})$ simply remain as part of the integrand in the volume integrals. In a practical implementation, these integrals are evaluated using numerical quadrature, and the values of the coefficients are evaluated at the quadrature points.\n\nThe numerical fluxes $E_x^*, E_y^*, H_z^*$ are critical for the stability and accuracy of the DG scheme. For hyperbolic systems like Maxwell's equations, an upwind-biased flux is commonly used. The upwinding direction is determined by the characteristic wave speeds of the system normal to the element face. The anisotropy and inhomogeneity of the medium are accounted for by using the local values of $\\epsilon_x, \\epsilon_y, \\mu_z$ at the face to calculate these characteristic speeds, which in turn define the numerical flux.\n\n**Part 3: Characteristic Wave Speed**\n\nTo find the characteristic wave speed $c(\\boldsymbol{n})$ along a face with normal $\\boldsymbol{n}=(n_x, n_y)$, we analyze the 1D system obtained by projecting the PDEs onto this normal direction. First, we write the system in matrix form. Let $\\boldsymbol{U} = (E_x, E_y, H_z)^T$. The system is $\\boldsymbol{M}(\\boldsymbol{x}) \\partial_t \\boldsymbol{U} + \\boldsymbol{A} \\partial_x \\boldsymbol{U} + \\boldsymbol{B} \\partial_y \\boldsymbol{U} = 0$, where:\n$$ \\boldsymbol{M}(\\boldsymbol{x}) = \\begin{pmatrix} \\epsilon_x(\\boldsymbol{x}) & 0 & 0 \\\\ 0 & \\epsilon_y(\\boldsymbol{x}) & 0 \\\\ 0 & 0 & \\mu_z(\\boldsymbol{x}) \\end{pmatrix} $$\n$$ \\boldsymbol{A} = \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & 1 & 0 \\end{pmatrix}, \\qquad \\boldsymbol{B} = \\begin{pmatrix} 0 & 0 & -1 \\\\ 0 & 0 & 0 \\\\ -1 & 0 & 0 \\end{pmatrix} $$\nThis gives $\\boldsymbol{A}\\partial_x \\boldsymbol{U} + \\boldsymbol{B}\\partial_y \\boldsymbol{U} = (-\\partial_y H_z, \\partial_x H_z, \\partial_x E_y - \\partial_y E_x)^T$, which corresponds to the system:\n$$ \\epsilon_x \\partial_t E_x - \\partial_y H_z = 0 $$\n$$ \\epsilon_y \\partial_t E_y + \\partial_x H_z = 0 $$\n$$ \\mu_z \\partial_t H_z + \\partial_x E_y - \\partial_y E_x = 0 $$\nThis is a small error in the formulation as the system is $\\mu_z \\partial_t H_z = \\partial_y E_x - \\partial_x E_y$. The correct matrix formulation of the spatial operator is needed. The system is $\\boldsymbol{M} \\partial_t \\boldsymbol{U} - \\boldsymbol{\\mathcal{L}}(\\boldsymbol{U}) = 0$. $\\boldsymbol{\\mathcal{L}}(\\boldsymbol{U}) = (\\partial_y H_z, -\\partial_x H_z, \\partial_y E_x - \\partial_x E_y)^T$. Let's rewrite the system to match the form $\\boldsymbol{M}\\partial_t \\boldsymbol{U} + \\boldsymbol{\\nabla} \\cdot \\boldsymbol{F} = 0$.\nThe system is $\\boldsymbol{M} \\partial_t \\boldsymbol{U} + \\boldsymbol{A}' \\partial_x \\boldsymbol{U} + \\boldsymbol{B}' \\partial_y \\boldsymbol{U} = 0$ with:\n$$ \\boldsymbol{A}' = \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & -1 & 0 \\end{pmatrix}, \\qquad \\boldsymbol{B}' = \\begin{pmatrix} 0 & 0 & -1 \\\\ 0 & 0 & 0 \\\\ 1 & 0 & 0 \\end{pmatrix} $$\n\nFor a 1D analysis normal to a face, we consider variations only along the direction $\\eta = \\boldsymbol{n} \\cdot \\boldsymbol{x} = n_x x + n_y y$. Thus, $\\partial_x \\rightarrow n_x \\frac{d}{d\\eta}$ and $\\partial_y \\rightarrow n_y \\frac{d}{d\\eta}$. The system becomes:\n$$ \\boldsymbol{M} \\partial_t \\boldsymbol{U} + (n_x \\boldsymbol{A}' + n_y \\boldsymbol{B}') \\frac{d\\boldsymbol{U}}{d\\eta} = 0 $$\nLet $\\boldsymbol{K}(\\boldsymbol{n}) = n_x \\boldsymbol{A}' + n_y \\boldsymbol{B}'$.\n$$ \\boldsymbol{K}(\\boldsymbol{n}) = n_x \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & -1 \\\\ 0 & -1 & 0 \\end{pmatrix} + n_y \\begin{pmatrix} 0 & 0 & 1 \\\\ 0 & 0 & 0 \\\\ 1 & 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & 0 & n_y \\\\ 0 & 0 & -n_x \\\\ n_y & -n_x & 0 \\end{pmatrix} $$\nThe characteristic speeds, $c$, are the eigenvalues of the generalized eigenvalue problem $\\boldsymbol{K}(\\boldsymbol{n}) \\boldsymbol{v} = c \\boldsymbol{M} \\boldsymbol{v}$. These are the roots of the characteristic equation $\\det(\\boldsymbol{K}(\\boldsymbol{n}) - c\\boldsymbol{M}) = 0$.\n$$ \\det \\begin{pmatrix} -c\\epsilon_x & 0 & n_y \\\\ 0 & -c\\epsilon_y & -n_x \\\\ n_y & -n_x & -c\\mu_z \\end{pmatrix} = 0 $$\nCalculating the determinant:\n$$ (-c\\epsilon_x) \\left[(-c\\epsilon_y)(-c\\mu_z) - (-n_x)(-n_x)\\right] - (0) + (n_y) \\left[(0)(-n_x) - (-c\\epsilon_y)(n_y)\\right] = 0 $$\n$$ (-c\\epsilon_x) (c^2 \\epsilon_y \\mu_z - n_x^2) + n_y (c\\epsilon_y n_y) = 0 $$\n$$ -c^3 \\epsilon_x \\epsilon_y \\mu_z + c \\epsilon_x n_x^2 + c \\epsilon_y n_y^2 = 0 $$\n$$ c (-c^2 \\epsilon_x \\epsilon_y \\mu_z + \\epsilon_x n_x^2 + \\epsilon_y n_y^2) = 0 $$\nOne eigenvalue is $c=0$. The other two are given by the roots of:\n$$ c^2 \\epsilon_x \\epsilon_y \\mu_z = \\epsilon_x n_x^2 + \\epsilon_y n_y^2 $$\n$$ c^2 = \\frac{\\epsilon_x n_x^2 + \\epsilon_y n_y^2}{\\epsilon_x \\epsilon_y \\mu_z} $$\nThe non-zero characteristic speeds are $c = \\pm \\sqrt{\\frac{\\epsilon_x n_x^2 + \\epsilon_y n_y^2}{\\epsilon_x \\epsilon_y \\mu_z}}$.\nThe characteristic wave speed is the magnitude of the largest eigenvalue, which governs the flow of information normal to the face. This speed is used to set the numerical dissipation in an upwind flux and determines the maximum stable time step via the CFL condition.\nThe face-normal characteristic speed $c(\\boldsymbol{n})$ is therefore the absolute value of the non-zero roots:\n$$ c(\\boldsymbol{n}) = \\sqrt{\\frac{\\epsilon_x n_x^2 + \\epsilon_y n_y^2}{\\epsilon_x \\epsilon_y \\mu_z}} $$\nThe values of $\\epsilon_x, \\epsilon_y, \\mu_z, n_x, n_y$ are all evaluated at the location on the element face.",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{\\epsilon_{x} n_{x}^{2} + \\epsilon_{y} n_{y}^{2}}{\\epsilon_{x} \\epsilon_{y} \\mu_{z}}}}\n$$"
        },
        {
            "introduction": "A crucial test for any numerical method in electromagnetics is its ability to handle sharp jumps in material properties without introducing non-physical artifacts. This computational practice () tasks you with building a benchmark to investigate the generation of spurious charges at a dielectric interface. By comparing a physically informed numerical flux with a more naive choice, you will gain concrete insight into how to properly enforce the continuity of the normal component of the electric displacement field, $\\boldsymbol{D}$, to maintain the divergence-free condition.",
            "id": "3375389",
            "problem": "Consider source-free static Maxwell equations in an inhomogeneous isotropic medium, where the electric flux density and electric field are related by $\\mathbf{D} = \\epsilon(\\mathbf{x}) \\mathbf{E}$ and Gauss's law is $\\nabla \\cdot \\mathbf{D} = 0$ with no free charges. For a two-dimensional square domain $[0,1] \\times [0,1]$, construct a divergence-free electric flux density by introducing a scalar stream function $\\psi(x,y)$ and defining $\\mathbf{D}(x,y) = \\nabla \\times \\left( \\psi(x,y) \\hat{\\mathbf{z}} \\right) = \\left( \\partial_y \\psi(x,y), -\\partial_x \\psi(x,y) \\right)$, which ensures $\\nabla \\cdot \\mathbf{D} = 0$ exactly. The electric field is then $\\mathbf{E}(x,y) = \\mathbf{D}(x,y) / \\epsilon(x,y)$, which generally exhibits jumps when $\\epsilon$ is discontinuous while $\\mathbf{D}$ remains continuous in the absence of free charges.\n\nWe will benchmark two discretizations that mimic Discontinuous Galerkin (DG) and Nédélec (edge-based $H(\\mathrm{curl})$-conforming) formulations with respect to discrete enforcement of Gauss's law across sharp jumps in permittivity $\\epsilon$. The discretizations are defined on a uniform $N_x \\times N_y$ cell grid with periodic boundary conditions:\n\n1. A DG-like flux using electric field averaging (incorrect for enforcing Gauss’s law at dielectric interfaces): At each face, define the face electric field by averaging adjacent cell-centered values, $\\mathbf{E}_f = \\tfrac{1}{2}\\left( \\mathbf{E}_L + \\mathbf{E}_R \\right)$, and the face permittivity by arithmetic averaging $\\epsilon_f = \\tfrac{1}{2}\\left( \\epsilon_L + \\epsilon_R \\right)$. The face normal flux is then $D_{n,f}^{\\mathrm{DG}} = \\epsilon_f \\, (\\mathbf{E}_f \\cdot \\mathbf{n}_f)$. This choice tends to enforce continuity of the electric field rather than of the normal component of $\\mathbf{D}$, which can generate spurious discrete charges at material interfaces when $\\epsilon$ jumps.\n\n2. A Nédélec-like edge flux using electric flux averaging (consistent with enforcing the normal continuity of $\\mathbf{D}$ in source-free media): At each face, define the face normal flux by averaging the adjacent normal fluxes, $D_{n,f}^{\\mathrm{NED}} = \\tfrac{1}{2}\\left( \\mathbf{D}_L \\cdot \\mathbf{n}_f + \\mathbf{D}_R \\cdot \\mathbf{n}_f \\right)$. This choice respects the physical continuity of the normal component of $\\mathbf{D}$ across dielectric interfaces and better preserves $\\nabla \\cdot \\mathbf{D} = 0$ discretely.\n\nGiven face normal fluxes $D_{n,f}$, the discrete divergence residual in each cell, which measures the violation of Gauss’s law, is defined by the finite-volume balance\n$$\nr_{i,j} = \\frac{D_{x,\\mathrm{right}} - D_{x,\\mathrm{left}}}{\\Delta x} + \\frac{D_{y,\\mathrm{top}} - D_{y,\\mathrm{bottom}}}{\\Delta y},\n$$\nwhere $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$, and $D_{x,\\mathrm{right}}$ denotes the flux through the right face with outward normal $\\mathbf{n} = (1,0)$, $D_{x,\\mathrm{left}}$ through the left face with outward normal $\\mathbf{n} = (-1,0)$, and analogously for the $y$-faces. The global error measure is the $L^2$ norm\n$$\n\\| \\nabla \\cdot \\mathbf{D} \\|_{L^2} \\approx \\left( \\sum_{i=1}^{N_x} \\sum_{j=1}^{N_y} r_{i,j}^2 \\, \\Delta x \\Delta y \\right)^{1/2},\n$$\ncomputed separately for the DG-like and Nédélec-like fluxes.\n\nTake the stream function\n$$\n\\psi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y),\n$$\nso that\n$$\n\\partial_x \\psi = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y), \\quad \\partial_y \\psi = 2\\pi \\sin(2\\pi x)\\cos(2\\pi y),\n$$\nand hence\n$$\n\\mathbf{D}(x,y) = \\left(2\\pi \\sin(2\\pi x)\\cos(2\\pi y), \\; -2\\pi \\cos(2\\pi x)\\sin(2\\pi y)\\right).\n$$\nLet the permittivity be piecewise constant with a sharp jump at a vertical interface located at $x = s$,\n$$\n\\epsilon(x,y) = \n\\begin{cases}\n\\epsilon_{\\mathrm{L}} & \\text{if } x < s, \\\\\n\\epsilon_{\\mathrm{R}} & \\text{if } x \\ge s,\n\\end{cases}\n$$\nwith $\\epsilon_{\\mathrm{L}} > 0$ and $\\epsilon_{\\mathrm{R}} > 0$.\n\nYour task is to write a program that:\n- Constructs the grid, evaluates $\\mathbf{D}$ and $\\epsilon$ at cell centers, computes $\\mathbf{E} = \\mathbf{D}/\\epsilon$.\n- Computes the discrete divergence residual $r_{i,j}$ and the global $L^2$ norm for both the DG-like and Nédélec-like flux definitions using periodic boundary conditions in both directions.\n- Reports, for each test case, the pair of norms $\\left( \\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{DG}}, \\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{NED}} \\right)$ as dimensionless quantities.\n\nTest Suite:\n- Case 1 (aligned interface, moderate contrast): $N_x = 50$, $N_y = 50$, $\\epsilon_{\\mathrm{L}} = 1.0$, $\\epsilon_{\\mathrm{R}} = 10.0$, $s = 0.5$.\n- Case 2 (misaligned interface, moderate contrast): $N_x = 51$, $N_y = 51$, $\\epsilon_{\\mathrm{L}} = 1.0$, $\\epsilon_{\\mathrm{R}} = 10.0$, $s = 0.47$.\n- Case 3 (aligned interface, extreme contrast): $N_x = 50$, $N_y = 50$, $\\epsilon_{\\mathrm{L}} = 1.0$, $\\epsilon_{\\mathrm{R}} = 1000.0$, $s = 0.5$.\n- Case 4 (aligned interface, no contrast): $N_x = 50$, $N_y = 50$, $\\epsilon_{\\mathrm{L}} = 1.0$, $\\epsilon_{\\mathrm{R}} = 1.0$, $s = 0.5$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list of eight floating-point numbers enclosed in square brackets, ordered as $[\\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{DG}}, \\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{NED}}]$ for Case 1, followed by the same pair for Case 2, Case 3, and Case 4. For example: \"[dg1,ned1,dg2,ned2,dg3,ned3,dg4,ned4]\". All values are dimensionless and should be reported as raw decimal numbers without units.",
            "solution": "We begin with source-free static Maxwell equations in an inhomogeneous medium. The fundamental relation between the electric flux density and the electric field is $\\mathbf{D} = \\epsilon(\\mathbf{x}) \\mathbf{E}$, and Gauss's law states $\\nabla \\cdot \\mathbf{D} = 0$ in the absence of free charges. To construct a divergence-free $\\mathbf{D}$, we employ a scalar stream function. Define\n$$\n\\psi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y).\n$$\nThen the vector field\n$$\n\\mathbf{D}(x,y) = \\nabla \\times (\\psi \\hat{\\mathbf{z}}) = \\left(\\partial_y \\psi, -\\partial_x \\psi\\right)\n$$\nis exactly divergence-free because the divergence of any curl vanishes. Explicitly, with\n$$\n\\partial_x \\psi = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y), \\quad \\partial_y \\psi = 2\\pi \\sin(2\\pi x)\\cos(2\\pi y),\n$$\nwe obtain\n$$\n\\mathbf{D}(x,y) = \\left(2\\pi \\sin(2\\pi x)\\cos(2\\pi y), \\; -2\\pi \\cos(2\\pi x)\\sin(2\\pi y)\\right),\n$$\nand indeed\n$$\n\\nabla \\cdot \\mathbf{D} = \\partial_x D_x + \\partial_y D_y = \\partial_x \\partial_y \\psi - \\partial_y \\partial_x \\psi = 0.\n$$\nSince $\\mathbf{D}$ is divergence-free, choosing $\\mathbf{E} = \\mathbf{D}/\\epsilon$ satisfies $\\nabla \\cdot \\epsilon \\mathbf{E} = \\nabla \\cdot \\mathbf{D} = 0$ exactly in the continuum. However, if the permittivity $\\epsilon$ has sharp jumps, then $\\mathbf{E}$ will generally be discontinuous across material interfaces while the normal component of $\\mathbf{D}$ remains continuous in absence of free charges.\n\nTo design a benchmark that highlights spurious charges, we discretize on a uniform $N_x \\times N_y$ grid of cells covering the unit square, with periodic boundary conditions. We evaluate $\\mathbf{D}$ and $\\epsilon$ at cell centers and define $\\mathbf{E} = \\mathbf{D}/\\epsilon$ at cell centers. The material law is\n$$\n\\epsilon(x,y) =\n\\begin{cases}\n\\epsilon_{\\mathrm{L}}, & x < s, \\\\\n\\epsilon_{\\mathrm{R}}, & x \\ge s,\n\\end{cases}\n$$\nrepresenting a sharp vertical interface at $x = s$.\n\nTo measure discrete enforcement of Gauss's law, we compute the finite-volume divergence residual in each cell. For a given cell $(i,j)$ with width $\\Delta x = 1/N_x$ and height $\\Delta y = 1/N_y$, the divergence residual is\n$$\nr_{i,j} = \\frac{D_{x,\\mathrm{right}} - D_{x,\\mathrm{left}}}{\\Delta x} + \\frac{D_{y,\\mathrm{top}} - D_{y,\\mathrm{bottom}}}{\\Delta y},\n$$\nwhere $D_{x,\\mathrm{right}}$ denotes the normal flux through the right face with outward normal $\\mathbf{n} = (1,0)$, $D_{x,\\mathrm{left}}$ through the left face with outward normal $\\mathbf{n} = (-1,0)$, and similarly for the top and bottom faces with normals $(0,1)$ and $(0,-1)$. With periodic boundary conditions, face neighbors wrap around the domain. The global error measure is the $L^2$ norm of the residual,\n$$\n\\| \\nabla \\cdot \\mathbf{D} \\|_{L^2} \\approx \\left( \\sum_{i=1}^{N_x} \\sum_{j=1}^{N_y} r_{i,j}^2 \\, \\Delta x \\Delta y \\right)^{1/2}.\n$$\n\nWe define two face flux construction strategies:\n\n1. DG-like (electric field averaged) flux. The face electric field is averaged from adjacent cells,\n$$\n\\mathbf{E}_f = \\tfrac{1}{2}\\left(\\mathbf{E}_L + \\mathbf{E}_R\\right),\n$$\nthe face permittivity uses arithmetic averaging,\n$$\n\\epsilon_f = \\tfrac{1}{2}\\left(\\epsilon_L + \\epsilon_R\\right),\n$$\nand the face normal flux is computed by\n$$\nD_{n,f}^{\\mathrm{DG}} = \\epsilon_f \\, (\\mathbf{E}_f \\cdot \\mathbf{n}_f).\n$$\nThis choice tends to enforce continuity of the electric field across faces and, at dielectric interfaces, overly smooths $\\mathbf{E}$ while failing to maintain continuity of the normal component of $\\mathbf{D}$, thereby producing spurious discrete divergence (interpreted as spurious charges).\n\n2. Nédélec-like (electric flux averaged) flux. The face normal flux is computed directly by averaging the adjacent normal components of $\\mathbf{D}$,\n$$\nD_{n,f}^{\\mathrm{NED}} = \\tfrac{1}{2}\\left((\\mathbf{D}_L \\cdot \\mathbf{n}_f) + (\\mathbf{D}_R \\cdot \\mathbf{n}_f)\\right).\n$$\nThis respects the physical interface condition that the normal component of $\\mathbf{D}$ is continuous in source-free media, leading to discrete preservation of $\\nabla \\cdot \\mathbf{D} = 0$.\n\nAlgorithmic steps:\n- Construct grid cell centers $(x_i, y_j)$ for $i=0,\\dots,N_x-1$ and $j=0,\\dots,N_y-1$ with $x_i = (i + \\tfrac{1}{2})/N_x$ and $y_j = (j + \\tfrac{1}{2})/N_y$.\n- Evaluate $\\epsilon_{i,j}$ via the piecewise definition using $x_i$ and interface $s$.\n- Evaluate $\\partial_x \\psi$ and $\\partial_y \\psi$ at cell centers, and set $\\mathbf{D}_{i,j} = \\left(\\partial_y \\psi, -\\partial_x \\psi\\right)$.\n- Compute $\\mathbf{E}_{i,j} = \\mathbf{D}_{i,j}/\\epsilon_{i,j}$.\n- For each face, compute $D_{n,f}^{\\mathrm{DG}}$ and $D_{n,f}^{\\mathrm{NED}}$ as described. With periodic boundaries, neighbor indices wrap modulo $N_x$ and $N_y$.\n- Assemble $r_{i,j}^{\\mathrm{DG}}$ and $r_{i,j}^{\\mathrm{NED}}$ from face normal fluxes using the finite-volume divergence formula.\n- Compute the global norms $\\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{DG}}$ and $\\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{NED}}$.\n\nSpurious charge identification conditions:\n- When the interface is aligned with cell faces and the permittivity contrast is moderate or large, the DG-like flux (electric field averaged with arithmetic permittivity averaging) generates larger discrete divergence compared to the Nédélec-like flux because it enforces continuity of $\\mathbf{E}$ rather than the continuity of $\\mathbf{D} \\cdot \\mathbf{n}$, violating the physical interface condition.\n- When the interface is misaligned with the mesh (interface falls within cells), the effect of incorrect flux based on $\\mathbf{E}$ is exacerbated, and discrete divergence norms increase, especially for higher contrasts.\n- When there is no contrast ($\\epsilon_{\\mathrm{L}} = \\epsilon_{\\mathrm{R}}$), both methods coincide and yield minimal divergence, as averaging $\\epsilon$ has no effect and $\\mathbf{D}$ and $\\mathbf{E}$ are smoothly related.\n\nThe test suite consists of four scenarios: aligned versus misaligned interfaces and moderate versus extreme permittivity contrasts, plus the no-contrast baseline. The program outputs eight dimensionless floating-point numbers: pairs of $\\left( \\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{DG}}, \\| \\nabla \\cdot \\mathbf{D} \\|_{L^2}^{\\mathrm{NED}} \\right)$ for each case, formatted on a single line as specified.",
            "answer": "```python\nimport numpy as np\n\ndef compute_divergence_norms(Nx, Ny, eps_L, eps_R, s):\n    # Grid spacings\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n\n    # Cell-center coordinates\n    x = (np.arange(Nx) + 0.5) * dx\n    y = (np.arange(Ny) + 0.5) * dy\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Permittivity field with sharp interface at x = s\n    eps = np.where(X < s, eps_L, eps_R)\n\n    # Stream function derivatives and D field at cell centers\n    # psi = sin(2πx) sin(2πy)\n    # dpsi_dx = 2π cos(2πx) sin(2πy)\n    # dpsi_dy = 2π sin(2πx) cos(2πy)\n    two_pi = 2.0 * np.pi\n    dpsi_dx = two_pi * np.cos(two_pi * X) * np.sin(two_pi * Y)\n    dpsi_dy = two_pi * np.sin(two_pi * X) * np.cos(two_pi * Y)\n\n    # D = (dpsi_dy, -dpsi_dx)\n    D_x = dpsi_dy\n    D_y = -dpsi_dx\n\n    # E = D / eps\n    E_x = D_x / eps\n    E_y = D_y / eps\n\n    # Periodic neighbor indices\n    ip = (np.arange(Nx) + 1) % Nx  # i+1\n    im = (np.arange(Nx) - 1) % Nx  # i-1\n    jp = (np.arange(Ny) + 1) % Ny  # j+1\n    jm = (np.arange(Ny) - 1) % Ny  # j-1\n\n    # Precompute shifted arrays for neighbors\n    # Right neighbor in x-direction\n    D_x_right_neighbor = D_x[ip, :]\n    E_x_right_neighbor = E_x[ip, :]\n    eps_right_neighbor = eps[ip, :]\n    # Left neighbor in x-direction\n    D_x_left_neighbor = D_x[im, :]\n    E_x_left_neighbor = E_x[im, :]\n    eps_left_neighbor = eps[im, :]\n\n    # Top neighbor in y-direction\n    D_y_top_neighbor = D_y[:, jp]\n    E_y_top_neighbor = E_y[:, jp]\n    eps_top_neighbor = eps[:, jp]\n    # Bottom neighbor in y-direction\n    D_y_bottom_neighbor = D_y[:, jm]\n    E_y_bottom_neighbor = E_y[:, jm]\n    eps_bottom_neighbor = eps[:, jm]\n\n    # Face fluxes: DG-like (E-averaged with arithmetic epsilon) and Nedelec-like (D-averaged)\n\n    # X-faces: right face fluxes\n    # DG-like: epsilon_f * average(E_x)\n    E_x_face_right = 0.5 * (E_x + E_x_right_neighbor)\n    eps_face_right = 0.5 * (eps + eps_right_neighbor)\n    Dn_DG_right = eps_face_right * E_x_face_right\n\n    # Nedelec-like: average(D_x)\n    Dn_NED_right = 0.5 * (D_x + D_x_right_neighbor)\n\n    # X-faces: left face fluxes (or equivalently flux through right face of left neighbor)\n    E_x_face_left = 0.5 * (E_x + E_x_left_neighbor)\n    eps_face_left = 0.5 * (eps + eps_left_neighbor)\n    Dn_DG_left = eps_face_left * E_x_face_left\n    Dn_NED_left = 0.5 * (D_x + D_x_left_neighbor)\n\n    # Y-faces: top face fluxes\n    E_y_face_top = 0.5 * (E_y + E_y_top_neighbor)\n    eps_face_top = 0.5 * (eps + eps_top_neighbor)\n    Dn_DG_top = eps_face_top * E_y_face_top\n    Dn_NED_top = 0.5 * (D_y + D_y_top_neighbor)\n\n    # Y-faces: bottom face fluxes\n    E_y_face_bottom = 0.5 * (E_y + E_y_bottom_neighbor)\n    eps_face_bottom = 0.5 * (eps + eps_bottom_neighbor)\n    Dn_DG_bottom = eps_face_bottom * E_y_face_bottom\n    Dn_NED_bottom = 0.5 * (D_y + D_y_bottom_neighbor)\n\n    # Divergence residuals per cell\n    r_DG = (Dn_DG_right - Dn_DG_left) / dx + (Dn_DG_top - Dn_DG_bottom) / dy\n    r_NED = (Dn_NED_right - Dn_NED_left) / dx + (Dn_NED_top - Dn_NED_bottom) / dy\n\n    # Global L2 norms (dimensionless)\n    area = dx * dy\n    norm_DG = np.sqrt(np.sum(r_DG**2) * area)\n    norm_NED = np.sqrt(np.sum(r_NED**2) * area)\n\n    return float(norm_DG), float(norm_NED)\n\ndef solve():\n    # Define the test cases: (Nx, Ny, eps_L, eps_R, s)\n    test_cases = [\n        (50, 50, 1.0, 10.0, 0.5),   # Case 1: aligned interface, moderate contrast\n        (51, 51, 1.0, 10.0, 0.47),  # Case 2: misaligned interface, moderate contrast\n        (50, 50, 1.0, 1000.0, 0.5), # Case 3: aligned interface, extreme contrast\n        (50, 50, 1.0, 1.0, 0.5),    # Case 4: aligned interface, no contrast\n    ]\n\n    results = []\n    for Nx, Ny, eps_L, eps_R, s in test_cases:\n        norm_DG, norm_NED = compute_divergence_norms(Nx, Ny, eps_L, eps_R, s)\n        results.append(norm_DG)\n        results.append(norm_NED)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "One of the most powerful features of the DG method is its inherent flexibility in accommodating complex and nonconforming meshes, which is essential for adaptive mesh refinement. This hands-on exercise () delves into the practical implementation of \"hanging nodes,\" where elements of different sizes meet. You will implement a mortar-based approach to couple fields across a nonconforming interface, ensuring the overall scheme remains energy-stable through the correct application of upwind fluxes.",
            "id": "3375457",
            "problem": "Consider the two-dimensional transverse electric formulation of Maxwell's equations in a homogeneous, nondimensional medium with unit permittivity and unit permeability. The electromagnetic field consists of the electric field components $E_x$ and $E_y$ and the magnetic field component $H_z$. The Maxwell equations in this case are the conservation laws\n$$\n\\frac{\\partial E_x}{\\partial t} = \\frac{\\partial H_z}{\\partial y}, \\qquad \\frac{\\partial E_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x}, \\qquad \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_y}{\\partial x} - \\frac{\\partial E_x}{\\partial y}.\n$$\nLet us focus on a single vertical interface $\\Gamma$ aligned with the $y$-axis, across which the discontinuous Galerkin (DG) method exchanges fluxes. Along a vertical interface, the outward normal from the left element is $n=(1,0)$, and the tangential direction is along $y$. The interface flux couples the tangential fields $E_y$ and $H_z$. Assume a graded mesh configuration with a nonconforming (hanging-node) interface: one coarse element face on the left of length $L_c$ abuts two fine element faces on the right whose lengths sum to $L_c$. Specifically, take $L_c$ to be $2$, and two stacked fine faces on the right, each of length $1$, covering the interval $[0,2]$ in $y$ by the subintervals $[0,1]$ and $[1,2]$. \n\nStarting from the fundamental dynamical equations and the electromagnetic energy conservation law, derive the energy-stable upwind interface flux for the tangential fields across $\\Gamma$ in terms of the left and right traces of $E_y$ and $H_z$. Explain why the upwind choice dissipates the jump energy and therefore guarantees energy stability of the semi-discrete DG formulation. Then, implement a mortar-based nonconforming interface treatment: for each fine segment on the right, define a local mortar quadrature, evaluate the left coarse-face traces restricted to that segment, evaluate the right fine-face traces on the same segment, apply the upwind flux to obtain the dissipation integrand, and integrate to produce the net interface energy rate contribution. Use orthogonal polynomial representations along the faces: represent each face trace as a Legendre polynomial series on the corresponding interval, using $P_n(\\xi)$ with $\\xi\\in[-1,1]$ mapped from the physical segment $[a,b]$ via $y=\\frac{1}{2}\\left((b-a)\\xi+(b+a)\\right)$. Compute projection coefficients by exact $L^2$ projection using Gauss-Legendre quadrature of sufficient order.\n\nYour program must:\n- Construct Legendre polynomial coefficients by $L^2$ projection for given analytic face-trace functions $E_y(y)$ and $H_z(y)$ on specified intervals and degrees, using Gauss-Legendre quadrature of order at least $2p+2$ to integrate exactly up to degree $2p+1$, where $p$ is the polynomial degree.\n- Evaluate the left coarse-face traces $(E_y^L,H_z^L)$ restricted to each fine segment and the right fine-face traces $(E_y^R,H_z^R)$ on the same local mortar quadrature nodes.\n- Apply the energy-stable upwind interface flux for Maxwell's equations across the vertical interface and compute the corresponding semi-discrete interface energy-rate density. Integrate this density over the interface to obtain a single scalar energy-rate value for the interface. The variables are nondimensional, so the energy-rate should be reported as a dimensionless real number.\n\nTest Suite and parameter specification:\n- Use three test cases, all with left coarse face covering $y\\in[0,2]$ and right fine faces covering $y\\in[0,1]$ and $y\\in[1,2]$.\n\n- Case $1$ (happy path, exact match across the interface):\n  - Coarse-face degree $p_c = 3$. Define the global coarse-face analytic polynomial $f(y) = 0.5 + y - 0.75 y^2 + 0.25 y^3$. Set $E_y^L(y)=f(y)$ and $H_z^L(y)=f(y)$ on $[0,2]$ and project onto the Legendre basis of degree $3$.\n  - Fine-face degrees $p_f = 3$ on both segments. Define $E_y^R(y)=f(y)$ and $H_z^R(y)=f(y)$ on $[0,1]$ and $[1,2]$, and project onto the Legendre bases of degree $3$ on each segment.\n  - Expected interface energy-rate should be exactly $0$.\n\n- Case $2$ (mismatch with piecewise fine traces):\n  - Coarse-face degree $p_c = 0$. Define $E_y^L(y)=1$ and $H_z^L(y)=-1$ on $[0,2]$ and project onto the Legendre basis of degree $0$.\n  - Fine-face segment $[0,1]$: degree $p_f=2$, $E_y^R(y)=y$, $H_z^R(y)=-0.5\\, y$ projected onto the Legendre basis of degree $2$ on $[0,1]$.\n  - Fine-face segment $[1,2]$: degree $p_f=0$, $E_y^R(y)=0$, $H_z^R(y)=0$ projected onto the Legendre basis of degree $0$ on $[1,2]$.\n  - The computed interface energy-rate must be non-positive (energy stability).\n\n- Case $3$ (degree mismatch, general polynomials):\n  - Coarse-face degree $p_c = 5$. Define $E_y^L(y)=y^5 - 2 y^3 + 0.5 y$ and $H_z^L(y)=-y^4 + y$ on $[0,2]$ and project onto the Legendre basis of degree $5$.\n  - Fine-face segment $[0,1]$: degree $p_f=2$, $E_y^R(y)=y^2 - y$, $H_z^R(y)=y - 0.5$ projected onto degree $2$.\n  - Fine-face segment $[1,2]$: degree $p_f=2$, $E_y^R(y)=1 - y$, $H_z^R(y)=0.25 y^2$ projected onto degree $2$.\n  - The computed interface energy-rate must be non-positive (energy stability).\n\nFinal output format:\n- Your program should produce a single line of output containing the results of the three test cases as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), where each result is a single floating-point number representing the dimensionless interface energy-rate value integrated over $y\\in[0,2]$. The angle unit is not applicable. Percentages are not applicable. No physical units are required; report dimensionless values.",
            "solution": "The problem posed is a valid and well-defined exercise in computational electromagnetics, specifically concerning the application of Discontinuous Galerkin (DG) methods to Maxwell's equations on non-conforming grids. It is scientifically grounded, objective, and contains all necessary information for a unique solution. We will first derive the theoretical basis for an energy-stable numerical flux and then describe the computational implementation for a non-conforming interface.\n\n### Principle-Based Derivation and Method\n\n#### 1. Electromagnetic Energy Conservation and DG Formulation\n\nThe starting point for an energy analysis is Poynting's theorem. For the given two-dimensional transverse electric (TE) system with unit permittivity ($\\epsilon=1$) and permeability ($\\mu=1$), the electromagnetic energy density is $\\mathcal{E} = \\frac{1}{2}(E_x^2 + E_y^2 + H_z^2)$. The rate of change of energy within a domain $\\Omega$ is given by\n$$\n\\frac{d}{dt}\\int_\\Omega \\mathcal{E} \\, dV = \\int_\\Omega \\left(E_x \\frac{\\partial E_x}{\\partial t} + E_y \\frac{\\partial E_y}{\\partial t} + H_z \\frac{\\partial H_z}{\\partial t}\\right) dV.\n$$\nSubstituting the given Maxwell's equations:\n$$\n\\frac{d}{dt}\\int_\\Omega \\mathcal{E} \\, dV = \\int_\\Omega \\left(E_x \\frac{\\partial H_z}{\\partial y} - E_y \\frac{\\partial H_z}{\\partial x} + H_z \\left(\\frac{\\partial E_y}{\\partial x} - \\frac{\\partial E_x}{\\partial y}\\right)\\right) dV.\n$$\nThe integrand can be recognized as the negative divergence of the Poynting vector, $\\mathbf{S} = \\mathbf{E} \\times \\mathbf{H} = (E_y H_z, -E_x H_z, 0)$. Thus,\n$$\n\\frac{d}{dt}\\int_\\Omega \\mathcal{E} \\, dV = -\\int_\\Omega \\nabla \\cdot \\mathbf{S} \\, dV = -\\oint_{\\partial\\Omega} \\mathbf{S} \\cdot \\mathbf{n} \\, dS,\n$$\nwhere $\\mathbf{n}$ is the outward normal to the boundary $\\partial\\Omega$. This equation states that the change in energy within a volume is balanced by the flux of energy across its boundary.\n\nIn a DG method, the domain is partitioned into elements $K$. Within each element, the energy balance holds. Summing over all elements, the total energy change rate is the sum of contributions from all element boundaries. For an interior face $\\Gamma$ between two elements, $K^L$ (left) and $K^R$ (right), with outward normals $\\mathbf{n}^L$ and $\\mathbf{n}^R = -\\mathbf{n}^L$, the contribution to the energy rate is the integral over the face of the jump in numerical energy flux. For stability, this contribution must be non-positive, signifying energy dissipation.\n$$\n\\frac{dE_{total}}{dt} = -\\sum_{\\text{faces } \\Gamma} \\int_\\Gamma \\left( (\\mathbf{S} \\cdot \\mathbf{n}^L)^* + (\\mathbf{S} \\cdot \\mathbf{n}^R)^* \\right) dS \\le 0\n$$\nThe numerical flux, denoted by a star ($*$), must be chosen carefully to ensure this condition.\n\n#### 2. Energy-Stable Upwind Flux\n\nThe flux choice is based on the characteristic decomposition of the system. For a vertical interface with normal $\\mathbf{n} = (1,0)$, the relevant part of the system is the flux in the $x$-direction. The system can be written as $\\partial_t \\mathbf{q} + \\mathbf{A}_x \\partial_x \\mathbf{q} + \\dots = 0$, where $\\mathbf{q} = (E_x, E_y, H_z)^T$ and the flux Jacobian is\n$$\n\\mathbf{A}_x = \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & -1 \\\\ 0 & -1 & 0 \\end{pmatrix}.\n$$\nThe eigenvalues of $\\mathbf{A}_x$ are $\\lambda_1 = 0$, $\\lambda_2 = -1$, and $\\lambda_3 = 1$, corresponding to waves propagating with different speeds. The tangential fields $E_y$ and $H_z$ are coupled and associated with the non-zero speed eigenvalues. The corresponding left eigenvectors define the characteristic variables that propagate along the $x$-direction:\n- $w_1 = E_x$ (stationary, $\\lambda=0$)\n- $w_2 = E_y+H_z$ (propagates left, $\\lambda=-1$)\n- $w_3 = H_z-E_y$ (propagates right, $\\lambda=1$)\n\nAn upwind flux is constructed by selecting the value of each characteristic variable from the element it propagates from. At the interface, for a wave propagating left (from right to left), we use the right-side state. For a wave propagating right, we use the left-side state. This leads to the following numerical fluxes for the characteristic variables:\n$$\n(E_y+H_z)^* = E_y^R+H_z^R\n$$\n$$\n(H_z-E_y)^* = H_z^L-E_y^L\n$$\nSolving this system for the numerical fluxes of the field variables, $\\hat{E}_y$ and $\\hat{H}_z$, we get:\n$$\n\\hat{E}_y = \\frac{1}{2}\\left((E_y^L+E_y^R) - (H_z^L-H_z^R)\\right) = \\{E_y\\} - \\frac{1}{2Z_0}[[H_z]]\n$$\n$$\n\\hat{H}_z = \\frac{1}{2}\\left((H_z^L+H_z^R) - (E_y^L-E_y^R)\\right) = \\{H_z\\} - \\frac{Z_0}{2}[[\\mathbf{n} \\times E_y]]\n$$\nwhere $\\{u\\} = (u^L+u^R)/2$ is the average, $[[u]] = u^L - u^R$ is the jump, and the impedance $Z_0=\\sqrt{\\mu/\\epsilon}=1$.\n\nWhen these upwind fluxes for the fields are used in the DG weak formulation, the resulting rate of energy change across the interface is purely dissipative. The energy rate density, which is the integrand of the interface energy rate contribution, is given by:\n$$\nd(y) = -\\frac{1}{2} \\left( \\frac{1}{Z_0} (E_y^L - E_y^R)^2 + Z_0 (H_z^L - H_z^R)^2 \\right)\n$$\nWith $Z_0=1$, this simplifies to:\n$$\nd(y) = -\\frac{1}{2} \\left( (E_y^L(y) - E_y^R(y))^2 + (H_z^L(y) - H_z^R(y))^2 \\right)\n$$\nThis quantity is manifestly non-positive. It is zero if and only if the tangential fields are continuous across the interface ($[[E_y]] = 0$ and $[[H_z]] = 0$). This property guarantees that the semi-discretization does not spuriously generate energy at element interfaces, leading to a robust and stable numerical scheme. The total energy rate contribution from the interface is the integral of this density: $Q = \\int_\\Gamma d(y) dy$.\n\n#### 3. Mortar-Based Non-conforming Interface\n\nThe problem describes a non-conforming mesh where one coarse face on the left, $y \\in [0,2]$, abuts two fine faces on the right, $\\gamma_1 = y \\in [0,1]$ and $\\gamma_2 = y \\in [1,2]$. The mortar method treats this by decomposing the integral over the full interface into a sum of integrals over the finer \"mortar\" segments.\n$$\nQ = \\int_0^2 d(y) dy = \\int_0^1 d(y) dy + \\int_1^2 d(y) dy\n$$\nOn each mortar segment $\\gamma_i$, the jump is computed between the trace of the coarse-face solution (restricted to $\\gamma_i$) and the fine-face solution on that segment. For example, on $\\gamma_1=[0,1]$:\n$$\nQ_1 = \\int_0^1 -\\frac{1}{2} \\left( (E_y^L(y) - E_y^{R1}(y))^2 + (H_z^L(y) - H_z^{R1}(y))^2 \\right) dy\n$$\nA similar expression holds for $Q_2$ on $\\gamma_2 = [1,2]$. The total energy rate is $Q = Q_1 + Q_2$.\n\n#### 4. Numerical Implementation\n\n- **Polynomial Representation and Projection**: Face traces are represented as Legendre polynomial series of a given degree $p$. For a function $f(y)$ on an interval $[a,b]$, we find coefficients $c_k$ for the approximation $f_h(y) = \\sum_{k=0}^p c_k P_k(\\xi)$, where $\\xi=\\frac{2y-(a+b)}{b-a}$. The coefficients are determined via an $L^2$ projection, which requires computing integrals of the form $\\int_a^b f(y) P_k(\\xi(y)) dy$. These integrals are evaluated numerically using a high-order Gauss-Legendre quadrature rule, as specified.\n\n- **Energy Rate Integration**: The total energy rate $Q$ is computed by numerically integrating the dissipation density $d(y)$ over each mortar segment. Since the field traces are polynomials of degree up to $p_{\\max} = \\max(p_c, p_f)$, the integrand $d(y)$ is a polynomial of degree up to $2p_{\\max}$. A Gauss-Legendre quadrature rule with $p_{\\max}+1$ points is sufficient to integrate this exactly. We select the quadrature rule on each mortar segment based on the maximum polynomial degree of traces involved on that segment. We evaluate the polynomial representations of the left and right traces at the quadrature nodes, compute the dissipation density, and perform a weighted sum to obtain the integrated energy rate for that segment.",
            "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import legval, legfit, leggauss\n\ndef project_on_legendre(func, interval, p):\n    \"\"\"\n    Projects an analytic function onto the Legendre basis of degree p on a given interval.\n\n    Args:\n        func (callable): The analytic function to project.\n        interval (tuple): The interval [a, b] for the projection.\n        p (int): The degree of the polynomial basis.\n\n    Returns:\n        numpy.ndarray: The array of Legendre coefficients.\n    \"\"\"\n    a, b = interval\n    # Use a high-order Gauss-Legendre quadrature for an accurate L2 projection.\n    # The problem specifies a rule of order at least 2p+2, which means it should integrate\n    # polynomials up to degree 2p+1 exactly. This requires at least p+1 points.\n    # We use p+10 points for high accuracy, well above the minimum requirement.\n    n_points = p + 10\n    xi_nodes, weights = leggauss(n_points)\n\n    # Map nodes from [-1, 1] to [a, b]\n    y_nodes = 0.5 * (b - a) * xi_nodes + 0.5 * (a + b)\n\n    # Evaluate the function at these nodes\n    y_values = func(y_nodes)\n\n    # Use weighted least squares fit, which is equivalent to L2 projection\n    # when the nodes and weights are from a Gaussian quadrature.\n    # legfit minimizes sum(w[i] * (y[i] - p(x[i]))**2).\n    # For L2 proj, we want to minimize integral((f-p)^2), which is approx\n    # sum(w_quad * (f-p)^2). So the weights for legfit should be the quad weights.\n    coeffs = legfit(xi_nodes, y_values, p, w=weights)\n    return coeffs\n\ndef evaluate_poly(coeffs, interval, y_points):\n    \"\"\"\n    Evaluates a Legendre series at given points.\n\n    Args:\n        coeffs (numpy.ndarray): The Legendre coefficients.\n        interval (tuple): The original interval [a, b] of the polynomial basis.\n        y_points (numpy.ndarray): Points at which to evaluate the polynomial.\n\n    Returns:\n        numpy.ndarray: The evaluated polynomial values.\n    \"\"\"\n    a, b = interval\n    # Map evaluation points from [a, b] to the reference interval [-1, 1]\n    xi_points = (2.0 * y_points - (a + b)) / (b - a)\n    return legval(xi_points, coeffs)\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Happy path, continuous fields\n        {\n            \"p_c\": 3,\n            \"L_funcs\": {\"E\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3,\n                        \"H\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3},\n            \"fine_faces\": [\n                {\"p_f\": 3, \"interval\": [0.0, 1.0],\n                 \"R_funcs\": {\"E\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3,\n                             \"H\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3}},\n                {\"p_f\": 3, \"interval\": [1.0, 2.0],\n                 \"R_funcs\": {\"E\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3,\n                             \"H\": lambda y: 0.5 + y - 0.75 * y**2 + 0.25 * y**3}},\n            ]\n        },\n        # Case 2: Mismatch with piecewise constants/linear traces\n        {\n            \"p_c\": 0,\n            \"L_funcs\": {\"E\": lambda y: np.ones_like(y), \"H\": lambda y: -np.ones_like(y)},\n            \"fine_faces\": [\n                {\"p_f\": 2, \"interval\": [0.0, 1.0],\n                 \"R_funcs\": {\"E\": lambda y: y, \"H\": lambda y: -0.5 * y}},\n                {\"p_f\": 0, \"interval\": [1.0, 2.0],\n                 \"R_funcs\": {\"E\": lambda y: np.zeros_like(y), \"H\": lambda y: np.zeros_like(y)}},\n            ]\n        },\n        # Case 3: Degree mismatch, general polynomials\n        {\n            \"p_c\": 5,\n            \"L_funcs\": {\"E\": lambda y: y**5 - 2*y**3 + 0.5*y, \"H\": lambda y: -y**4 + y},\n            \"fine_faces\": [\n                {\"p_f\": 2, \"interval\": [0.0, 1.0],\n                 \"R_funcs\": {\"E\": lambda y: y**2 - y, \"H\": lambda y: y - 0.5}},\n                {\"p_f\": 2, \"interval\": [1.0, 2.0],\n                 \"R_funcs\": {\"E\": lambda y: 1 - y, \"H\": lambda y: 0.25 * y**2}},\n            ]\n        },\n    ]\n\n    results = []\n    \n    coarse_interval = [0.0, 2.0]\n\n    for case in test_cases:\n        # Project coarse face traces\n        p_c = case[\"p_c\"]\n        coeffs_EL = project_on_legendre(case[\"L_funcs\"][\"E\"], coarse_interval, p_c)\n        coeffs_HL = project_on_legendre(case[\"L_funcs\"][\"H\"], coarse_interval, p_c)\n\n        total_energy_rate = 0.0\n\n        for fine_face in case[\"fine_faces\"]:\n            p_f = fine_face[\"p_f\"]\n            fine_interval = fine_face[\"interval\"]\n            a_f, b_f = fine_interval\n\n            # Project fine face traces\n            coeffs_ER = project_on_legendre(fine_face[\"R_funcs\"][\"E\"], fine_interval, p_f)\n            coeffs_HR = project_on_legendre(fine_face[\"R_funcs\"][\"H\"], fine_interval, p_f)\n\n            # Setup quadrature for integrating the dissipation over this fine segment\n            p_max = max(p_c, p_f)\n            # Integrand degree is 2*p_max, requires p_max+1 GL points for exactness\n            n_quad_pts = p_max + 1\n            xi_quad, w_quad_ref = leggauss(n_quad_pts)\n            \n            # Map quadrature nodes and weights to the fine interval\n            y_quad = 0.5 * (b_f - a_f) * xi_quad + 0.5 * (a_f + b_f)\n            w_quad = 0.5 * (b_f - a_f) * w_quad_ref\n\n            # Evaluate all polynomial traces at the quadrature nodes\n            EL_vals = evaluate_poly(coeffs_EL, coarse_interval, y_quad)\n            HL_vals = evaluate_poly(coeffs_HL, coarse_interval, y_quad)\n            ER_vals = evaluate_poly(coeffs_ER, fine_interval, y_quad)\n            HR_vals = evaluate_poly(coeffs_HR, fine_interval, y_quad)\n\n            # Compute jump^2 terms at quadrature nodes\n            jump_E_sq = (EL_vals - ER_vals)**2\n            jump_H_sq = (HL_vals - HR_vals)**2\n\n            # Dissipation integrand at quadrature nodes (with Z=1)\n            dissipation_density = -0.5 * (jump_E_sq + jump_H_sq)\n\n            # Integrate over the fine segment and add to total\n            segment_energy_rate = np.sum(w_quad * dissipation_density)\n            total_energy_rate += segment_energy_rate\n\n        results.append(total_energy_rate)\n    \n    # Format the final output string\n    # For case 1, the result could be a very small float due to precision, so we round to 0\n    if abs(results[0]) < 1e-14:\n        results[0] = 0.0\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}