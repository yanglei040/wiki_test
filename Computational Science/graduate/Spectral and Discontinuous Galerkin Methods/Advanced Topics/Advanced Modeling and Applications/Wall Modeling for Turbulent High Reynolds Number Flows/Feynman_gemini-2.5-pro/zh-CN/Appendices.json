{
    "hands_on_practices": [
        {
            "introduction": "动手实践始于构建壁面模型的基础：代数平衡壁面模型。练习  将指导您从第一性原理出发，推导并实现该模型。您将把壁面律的对数定律转化为一个关于摩擦速度的可解非线性方程，这是在粗网格大涡模拟中提供正确边界条件的一项关键技能。",
            "id": "3427246",
            "problem": "考虑一个不可压缩、充分发展的湍流平面槽道流，使用高阶谱元法（SEM, Spectral Element Method）或间断Galerkin方法（DG, Discontinuous Galerkin）离散化进行大涡模拟（LES, Large Eddy Simulation），其中离壁第一个解点位于壁面单位距离 $y^{+}\\approx 50$ 处。需要一个最小功能性壁面模型，以便在不解析粘性子层的情况下，为数值格式提供壁面剪切应力 $\\tau_{w}$。您需要构建并实现以下模型及相关的敏感性分析，并将其作为一个自包含的程序。\n\n从壁面标度的标准定义出发，\n- 摩擦速度 $u_{\\tau}$ 满足 $\\tau_{w}=\\rho\\,u_{\\tau}^{2}$，\n- 内尺度标度的速度为 $U^{+}=U/u_{\\tau}$，\n- 内尺度标度的法向壁面距离为 $y^{+}=y\\,u_{\\tau}/\\nu$，\n以及重叠区的对数壁面律，\n$$\nU^{+}=\\frac{1}{\\kappa}\\ln(y^{+})+B,\n$$\n推导出一个关于未知数 $u_{\\tau}$ 的非线性方程，该方程用可测量的局部LES解析的流向速度大小 $U$、法向壁面距离 $y$、运动粘度 $\\nu$、流体密度 $\\rho$ 以及模型常数 $\\kappa$ 和 $B$ 表示。通过分析所得标量残差的单调性，证明物理上可接受的解 $u_{\\tau}>0$ 的存在性和唯一性。\n\n然后，设计一个仅基于第一性原理的稳健求根算法来计算给定参数下的 $u_{\\tau}$。您的算法必须使用一个能保证对任何正输入都收敛的区间套策略，并且可以结合二分法与牛顿更新，或使用带保护的二分法。一旦求得 $u_{\\tau}$，计算壁面剪切应力 $\\tau_{w}$（单位为帕斯卡，将最终的 $\\tau_{w}$ 以 $\\mathrm{Pa}$ 表示），并通过对您的非线性方程进行隐式微分来量化 $\\tau_{w}$ 对模型常数的敏感性，以获得归一化敏感性\n$$\nS_{\\kappa}=\\frac{\\partial \\ln \\tau_{w}}{\\partial \\kappa},\\qquad S_{B}=\\frac{\\partial \\ln \\tau_{w}}{\\partial B}.\n$$\n清晰地陈述这些敏感性关于收敛后的 $u_{\\tau}$ 和输入的表达式。\n\n您的程序必须为每个测试案例实现以下步骤：\n1. 根据提供的 $U$、$y$、$\\nu$、$\\rho$、$\\kappa$ 和 $B$，从上述模型构建非线性方程。\n2. 使用具有显式区间套的全局收敛标量求根过程求解 $u_{\\tau}$。\n3. 计算 $\\tau_{w}=\\rho\\,u_{\\tau}^{2}$，单位为 $\\mathrm{Pa}$。\n4. 使用在收敛的 $u_{\\tau}$ 处求值的解析推导的隐式微分公式，计算归一化敏感性 $S_{\\kappa}$ 和 $S_{B}$。\n\n使用以下参数值测试套件（涵盖一个代表性案例、一个用于对数律的接近缓冲层的低$y^{+}$边界情况、一个第一个点较粗糙的案例，以及一个用于敏感性评估的模型常数变化）。所有量必须按国际单位制（SI）解释：\n- 案例A（$y^{+}\\approx 50$ 的代表性空气流）：$U=8.0\\,\\mathrm{m/s}$，$y=0.002\\,\\mathrm{m}$，$\\nu=1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$，$\\rho=1.2\\,\\mathrm{kg/m^{3}}$，$\\kappa=0.41$，$B=5.2$。\n- 案例B（水中接近缓冲层的边界情况）：$U=0.608\\,\\mathrm{m/s}$，$y=0.0002\\,\\mathrm{m}$，$\\nu=1.0\\times 10^{-6}\\,\\mathrm{m^{2}/s}$，$\\rho=1000.0\\,\\mathrm{kg/m^{3}}$，$\\kappa=0.41$，$B=5.2$。\n- 案例C（第一个点较粗糙的空气案例）：$U=6.08\\,\\mathrm{m/s}$，$y=0.005\\,\\mathrm{m}$，$\\nu=1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$，$\\rho=1.2\\,\\mathrm{kg/m^{3}}$，$\\kappa=0.41$，$B=5.2$。\n- 案例D（用于探测敏感性的模型常数变化）：$U=8.0\\,\\mathrm{m/s}$，$y=0.002\\,\\mathrm{m}$，$\\nu=1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$，$\\rho=1.2\\,\\mathrm{kg/m^{3}}$，$\\kappa=0.384$，$B=4.17$。\n\n要求和数值细节：\n- 您的推导必须仅从核心定义 $U^{+}=U/u_{\\tau}$、$y^{+}=y\\,u_{\\tau}/\\nu$、$\\tau_{w}=\\rho u_{\\tau}^{2}$ 和对数律 $U^{+}=(1/\\kappa)\\ln(y^{+})+B$ 开始；不要假定任何其他经验性封闭模型。\n- 对于数值解，通过证明当 $u_{\\tau}\\to 0^{+}$ 时残差为正，且对于足够大的 $u_{\\tau}$ 残差为负，来确保 $u_{\\tau}$ 的正性并框定根的范围。\n- 将每个案例的最终输出表示为三个浮点数的列表 $[\\tau_{w},S_{\\kappa},S_{B}]$，其中 $\\tau_{w}$ 的单位是 $\\mathrm{Pa}$，$S_{\\kappa}$ 和 $S_{B}$ 是无量纲的。不涉及角度。数值输出中不要包含单位。\n- 您的程序应生成单行输出，其中包含所有四个案例的结果，形式为一个逗号分隔的列表，并用方括号括起来，其中每个案例贡献一个内部列表。例如，您的最终输出必须具有形式 $[[\\tau_{w}^{(A)},S_{\\kappa}^{(A)},S_{B}^{(A)}],[\\tau_{w}^{(B)},S_{\\kappa}^{(B)},S_{B}^{(B)}],[\\tau_{w}^{(C)},S_{\\kappa}^{(C)},S_{B}^{(C)}],[\\tau_{w}^{(D)},S_{\\kappa}^{(D)},S_{B}^{(D)}]]$，其中包含浮点数。",
            "solution": "在进行求解之前，对问题陈述的有效性进行严格评估。\n\n### 步骤 1：提取给定信息\n- **背景**：不可压缩、充分发展的湍流平面槽道流。\n- **模拟方法**：使用高阶谱元法（SEM）或间断Galerkin（DG）方法的大涡模拟（LES）。\n- **壁面模型位置**：离壁第一个点位于 $y^{+} \\approx 50$。\n- **目标**：构建一个功能性壁面模型来计算壁面剪切应力 $\\tau_{w}$。\n- **基本定义**：\n    1. 摩擦速度定义：$\\tau_{w} = \\rho u_{\\tau}^{2}$。\n    2. 内尺度标度的速度：$U^{+} = U/u_{\\tau}$。\n    3. 内尺度标度的法向壁面距离：$y^{+} = y u_{\\tau}/\\nu$。\n- **经验定律**：对数壁面律，$U^{+} = \\frac{1}{\\kappa}\\ln(y^{+}) + B$。\n- **输入参数**：流向速度 $U$，法向壁面距离 $y$，运动粘度 $\\nu$，流体密度 $\\rho$。\n- **模型常数**：von Kármán常数 $\\kappa$，对数律截距 $B$。\n- **主要未知数**：摩擦速度 $u_{\\tau}$。\n- **任务**：\n    1. 推导 $u_{\\tau}$ 的非线性方程。\n    2. 证明物理上可接受的解 $u_{\\tau} > 0$ 的存在性和唯一性。\n    3. 设计一个稳健的、基于区间套的求根算法。\n    4. 计算 $\\tau_{w}$，单位为帕斯卡（$\\mathrm{Pa}$）。\n    5. 推导并计算归一化敏感性 $S_{\\kappa} = \\frac{\\partial \\ln \\tau_{w}}{\\partial \\kappa}$ 和 $S_{B} = \\frac{\\partial \\ln \\tau_{w}}{\\partial B}$。\n- **测试案例（国际单位制）**：\n    - **案例A**：$U=8.0$, $y=0.002$, $\\nu=1.5 \\times 10^{-5}$, $\\rho=1.2$, $\\kappa=0.41$, $B=5.2$。\n    - **案例B**：$U=0.608$, $y=0.0002$, $\\nu=1.0 \\times 10^{-6}$, $\\rho=1000.0$, $\\kappa=0.41$, $B=5.2$。\n    - **案例C**：$U=6.08$, $y=0.005$, $\\nu=1.5 \\times 10^{-5}$, $\\rho=1.2$, $\\kappa=0.41$, $B=5.2$。\n    - **案例D**：$U=8.0$, $y=0.002$, $\\nu=1.5 \\times 10^{-5}$, $\\rho=1.2$, $\\kappa=0.384$, $B=4.17$。\n- **输出格式**：对于每个案例，输出一个包含三个浮点数的列表 $[\\tau_{w}, S_{\\kappa}, S_{B}]$。最终输出是包含这些列表的单行列表。\n\n### 步骤 2：使用提取的给定信息进行验证\n根据验证标准对问题进行评估。\n- **科学基础**：该问题基于湍流边界层理论的基本原理，特别是壁面律，这是LES中壁面模化的基石。定义和关系式在流体力学中是标准的。所有物理参数和常数都是现实的。\n- **适定性**：该问题是适定的。它要求推导并求解一个关于单个未知数 $u_{\\tau}$ 的单标量非线性方程。计算所需的所有输入（$U$, $y$, $\\nu$, $\\rho$, $\\kappa$, $B$）都已提供。分析解的存在性/唯一性以及计算敏感性的任务是标准的数学过程。\n- **客观性**：问题陈述语言精确、技术性强且不偏不倚，没有任何主观性论断。\n\n该问题没有表现出任何已定义的无效性缺陷。它在科学上是合理的、可形式化的、完整的、现实的和结构良好的。\n\n### 步骤 3：判定与行动\n该问题是**有效的**。将提供完整的解决方案。\n\n### 解的推导与分析\n\n**1. $u_{\\tau}$ 的非线性方程推导**\n\n我们从对数壁面律开始：\n$$\nU^{+} = \\frac{1}{\\kappa}\\ln(y^{+}) + B\n$$\n将内尺度量的定义代入此方程：\n$$\n\\frac{U}{u_{\\tau}} = \\frac{1}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right) + B\n$$\n其中 $U$、$y$、$\\nu$、$\\kappa$ 和 $B$ 是已知参数，$u_{\\tau}$ 是未知变量。这就是摩擦速度 $u_{\\tau}$ 的隐式非线性方程。为了数值求解，我们定义一个残差函数 $f(u_{\\tau})$，其根即为解。为了稳健性并与问题中关于区间套的建议保持一致，我们将残差定义为：\n$$\nf(u_{\\tau}) = U - u_{\\tau} \\left[ \\frac{1}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right) + B \\right]\n$$\n壁面模型的解是使 $f(u_{\\tau}) = 0$ 的 $u_{\\tau} > 0$ 的值。\n\n**2. 解的存在性与唯一性**\n\n为了确定物理上可接受的解（$u_{\\tau} > 0$）的存在性和唯一性，我们分析残差函数 $f(u_{\\tau})$ 的行为。\n\n- **当 $u_{\\tau} \\to 0^{+}$ 时的行为**：\n项 $u_{\\tau}\\ln(u_{\\tau})$ 是一个 $0 \\cdot (-\\infty)$ 的不定式。我们使用洛必达法则（L'Hôpital's rule）分析其极限：\n$$\n\\lim_{u_{\\tau} \\to 0^{+}} u_{\\tau}\\ln(u_{\\tau}) = \\lim_{u_{\\tau} \\to 0^{+}} \\frac{\\ln(u_{\\tau})}{1/u_{\\tau}} = \\lim_{u_{\\tau} \\to 0^{+}} \\frac{1/u_{\\tau}}{-1/u_{\\tau}^2} = \\lim_{u_{\\tau} \\to 0^{+}} (-u_{\\tau}) = 0\n$$\n将此结果应用于我们的残差函数：\n$$\n\\lim_{u_{\\tau} \\to 0^{+}} f(u_{\\tau}) = U - \\lim_{u_{\\tau} \\to 0^{+}} \\left[ \\frac{u_{\\tau}}{\\kappa} \\left(\\ln\\left(\\frac{y}{\\nu}\\right) + \\ln(u_{\\tau})\\right) + B u_{\\tau} \\right] = U - 0 = U\n$$\n由于速度 $U$ 严格为正，当 $u_{\\tau}$ 从右侧趋近于 $0$ 时，$f(u_{\\tau})$ 为正。\n\n- **当 $u_{\\tau} \\to \\infty$ 时的行为**：\n当 $u_{\\tau}$ 变得非常大时，对数项 $\\ln(u_{\\tau})$ 也会增长，但比 $u_{\\tau}$ 慢。乘积 $u_{\\tau}\\ln(u_{\\tau})$ 增长到无穷大。因此：\n$$\n\\lim_{u_{\\tau} \\to \\infty} f(u_{\\tau}) = U - \\infty = -\\infty\n$$\n\n- **单调性**：\n我们考察 $f(u_{\\tau})$ 关于 $u_{\\tau}$ 的导数：\n$$\nf'(u_{\\tau}) = \\frac{d}{du_{\\tau}} \\left( U - \\frac{u_{\\tau}}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right) - B u_{\\tau} \\right)\n$$\n对项 $\\frac{u_{\\tau}}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right)$ 使用乘积法则：\n$$\nf'(u_{\\tau}) = - \\left[ \\left(\\frac{1}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right) + \\frac{u_{\\tau}}{\\kappa}\\frac{1}{u_{\\tau}}\\right) + B \\right] = - \\left[ \\frac{1}{\\kappa}\\ln(y^{+}) + \\frac{1}{\\kappa} + B \\right]\n$$\n对数律应用于重叠层，其中 $y^{+}$ 足够大（例如 $y^{+} > 30$），使得 $\\ln(y^{+})$ 为正。模型常数 $\\kappa$ 和 $B$ 也为正。因此，对于任何物理相关的 $u_{\\tau}$，方括号内的项都严格为正。这意味着对于所有 $u_{\\tau} > 0$，$f'(u_{\\tau}) < 0$。\n\n- **结论**：\n函数 $f(u_{\\tau})$ 在 $u_{\\tau} > 0$ 上是连续的，当 $u_{\\tau} \\to 0^{+}$ 时为正，当 $u_{\\tau} \\to \\infty$ 时趋于 $-\\infty$，并且是严格单调递减的。根据介值定理（Intermediate Value Theorem），必须至少存在一个根。因为函数是严格单调的，所以这个根是唯一的。这保证了物理上可接受的解 $u_{\\tau} > 0$ 的存在性和唯一性。\n\n**3. 敏感性表达式的推导**\n\n我们需要找到归一化敏感性 $S_{\\kappa} = \\frac{\\partial \\ln \\tau_{w}}{\\partial \\kappa}$ 和 $S_{B} = \\frac{\\partial \\ln \\tau_{w}}{\\partial B}$。\n由 $\\tau_{w} = \\rho u_{\\tau}^2$ 可得 $\\ln \\tau_{w} = \\ln \\rho + 2 \\ln u_{\\tau}$。关于参数 $p$（其中 $p$ 是 $\\kappa$ 或 $B$）求导得到：\n$$\n\\frac{\\partial \\ln \\tau_{w}}{\\partial p} = \\frac{2}{u_{\\tau}} \\frac{\\partial u_{\\tau}}{\\partial p}\n$$\n我们通过对控制方程进行隐式微分来找到 $\\frac{\\partial u_{\\tau}}{\\partial p}$，该方程可写作 $G(u_{\\tau}, \\kappa, B) = 0$：\n$$\nG = \\frac{U}{u_{\\tau}} - \\frac{1}{\\kappa}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right) - B = 0\n$$\n隐式微分的一般公式是 $\\frac{\\partial u_{\\tau}}{\\partial p} = - \\frac{\\partial G/\\partial p}{\\partial G/\\partial u_{\\tau}}$。\n首先，我们计算关于 $u_{\\tau}$ 的偏导数：\n$$\n\\frac{\\partial G}{\\partial u_{\\tau}} = -\\frac{U}{u_{\\tau}^2} - \\frac{1}{\\kappa u_{\\tau}} = -\\frac{1}{u_{\\tau}} \\left(\\frac{U}{u_{\\tau}} + \\frac{1}{\\kappa}\\right)\n$$\n接下来，我们计算关于 $\\kappa$ 和 $B$ 的偏导数：\n$$\n\\frac{\\partial G}{\\partial \\kappa} = \\frac{1}{\\kappa^2}\\ln\\left(\\frac{y u_{\\tau}}{\\nu}\\right)\n\\quad , \\quad\n\\frac{\\partial G}{\\partial B} = -1\n$$\n现在我们可以找到敏感性。\n\n- **对 $B$ 的敏感性**：\n$$\n\\frac{\\partial u_{\\tau}}{\\partial B} = - \\frac{-1}{-\\frac{1}{u_{\\tau}} \\left(\\frac{U}{u_{\\tau}} + \\frac{1}{\\kappa}\\right)} = -\\frac{u_{\\tau}}{U/u_{\\tau} + 1/\\kappa}\n$$\n归一化敏感性 $S_B$ 则是：\n$$\nS_{B} = \\frac{2}{u_{\\tau}} \\frac{\\partial u_{\\tau}}{\\partial B} = \\frac{2}{u_{\\tau}} \\left( -\\frac{u_{\\tau}}{U/u_{\\tau} + 1/\\kappa} \\right) = -\\frac{2}{U/u_{\\tau} + 1/\\kappa}\n$$\n\n- **对 $\\kappa$ 的敏感性**：\n$$\n\\frac{\\partial u_{\\tau}}{\\partial \\kappa} = - \\frac{\\frac{1}{\\kappa^2}\\ln(y u_{\\tau}/\\nu)}{-\\frac{1}{u_{\\tau}} \\left(\\frac{U}{u_{\\tau}} + \\frac{1}{\\kappa}\\right)} = \\frac{u_{\\tau} \\ln(y u_{\\tau}/\\nu)}{\\kappa^2 (U/u_{\\tau} + 1/\\kappa)}\n$$\n为了简化，我们利用在解处 $\\frac{1}{\\kappa}\\ln(y u_{\\tau}/\\nu) = U/u_{\\tau} - B$ 这一事实。\n$$\n\\frac{\\partial u_{\\tau}}{\\partial \\kappa} =  \\frac{u_{\\tau} \\kappa(U/u_{\\tau} - B)}{\\kappa^2 (U/u_{\\tau} + 1/\\kappa)} = \\frac{u_{\\tau}(U/u_{\\tau} - B)}{\\kappa (U/u_{\\tau} + 1/\\kappa)}\n$$\n归一化敏感性 $S_\\kappa$ 则是：\n$$\nS_{\\kappa} = \\frac{2}{u_{\\tau}} \\frac{\\partial u_{\\tau}}{\\partial \\kappa} = \\frac{2(U/u_{\\tau} - B)}{\\kappa (U/u_{\\tau} + 1/\\kappa)}\n$$\n$S_B$ 和 $S_\\kappa$ 的这些最终表达式仅依赖于收敛解 $u_{\\tau}$ 和输入参数，计算起来很高效。\n\n**4. 数值实现策略**\n$f(u_{\\tau})=0$ 的唯一根可以使用区间套算法稳健地找到。\n- **区间**：我们已经确定当 $u_{\\tau} \\to 0^{+}$ 时 $f(u_{\\tau})>0$，对于大的 $u_{\\tau}$，$f(u_{\\tau})<0$。一个合适的区间是 $[u_{low}, u_{high}]$。我们可以为 $u_{low}$ 选择一个小的正数（例如 $10^{-8}$），为 $u_{high}$ 选择可测量的速度 $U$，因为物理上期望 $u_{\\tau} \\ll U$。测试计算证实，对于给定的参数范围，$f(U)<0$。\n- **算法**：一个标准的、全局收敛的算法，如Brent方法，是理想的选择。`SciPy` 中的 `scipy.optimize.brentq` 提供了该方法，它结合了二分法的安全性与割线法和逆二次插值法的速度，使其既稳健又高效。\n- **流程**：对于每个测试案例，程序将：\n    1. 定义残差函数 $f(u_{\\tau})$。\n    2. 在区间 $[10^{-8}, U]$ 内使用 `brentq` 求解 $u_{\\tau}$。\n    3. 计算 $\\tau_{w} = \\rho u_{\\tau}^2$。\n    4. 使用在计算出的 $u_{\\tau}$ 处求值的解析公式计算 $S_{\\kappa}$ 和 $S_{B}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for wall shear stress and model sensitivities for a series of test cases\n    based on a logarithmic law of the wall model.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (U, y, nu, rho, kappa, B) in SI units.\n    test_cases = [\n        # Case A: representative air flow\n        (8.0, 0.002, 1.5e-5, 1.2, 0.41, 5.2),\n        # Case B: near-buffer edge case in water\n        (0.608, 0.0002, 1.0e-6, 1000.0, 0.41, 5.2),\n        # Case C: coarse first-point air case\n        (6.08, 0.005, 1.5e-5, 1.2, 0.41, 5.2),\n        # Case D: model-constant variation to probe sensitivity\n        (8.0, 0.002, 1.5e-5, 1.2, 0.384, 4.17),\n    ]\n\n    results = []\n    \n    # Machine epsilon can be used for a robust lower bound close to zero.\n    machine_epsilon = np.finfo(float).eps\n\n    for case in test_cases:\n        U, y, nu, rho, kappa, B = case\n\n        # 1. Form the nonlinear equation f(u_tau) = 0\n        # The residual function f(u_tau) = U - u_tau * ( (1/kappa)*ln(y*u_tau/nu) + B )\n        # is defined for u_tau > 0.\n        def residual(u_tau):\n            # Check for domain of log\n            if u_tau = 0:\n                # Return a large positive value to guide the solver away from non-physical domain,\n                # consistent with the limit of the function as u_tau -> 0+.\n                return U\n            \n            y_plus_term = y * u_tau / nu\n            log_term = np.log(y_plus_term)\n            u_plus = (1.0 / kappa) * log_term + B\n            \n            return U - u_tau * u_plus\n\n        # 2. Solve for u_tau using a globally convergent scalar root-finding procedure.\n        # We bracket the root. As shown in the derivation, the residual is positive\n        # for u_tau -> 0+ and becomes negative for large u_tau. U itself serves\n        # as a safe upper bound, since u_tau  U in all physical flows.\n        lower_bound = machine_epsilon # A small positive number\n        upper_bound = U # Physical upper bound\n        \n        try:\n            # Brent's method is robust and guarantees convergence if the root is bracketed.\n            u_tau = optimize.brentq(residual, lower_bound, upper_bound, xtol=1e-12, rtol=1e-12)\n        except ValueError:\n            # This should not happen given the analysis of the residual function.\n            # However, it is good practice to handle potential solver failures.\n            u_tau = np.nan\n            tau_w = np.nan\n            S_kappa = np.nan\n            S_B = np.nan\n            results.append([tau_w, S_kappa, S_B])\n            continue\n\n        # 3. Compute tau_w in Pascals.\n        tau_w = rho * u_tau**2\n\n        # 4. Compute the normalized sensitivities S_kappa and S_B.\n        # These formulas were derived via implicit differentiation.\n        U_over_u_tau = U / u_tau\n        \n        # Denominator for both sensitivities\n        common_denominator = U_over_u_tau + (1.0 / kappa)\n        \n        # Sensitivity to B\n        S_B = -2.0 / common_denominator\n        \n        # Sensitivity to kappa\n        # This form is computationally efficient as it reuses U_over_u_tau\n        S_kappa = (2.0 * (U_over_u_tau - B)) / (kappa * common_denominator)\n        \n        results.append([tau_w, S_kappa, S_B])\n\n    # Format the final output string as per the problem specification.\n    # e.g., [[val1,val2,val3],[val4,val5,val6],...]\n    results_str_parts = []\n    for res in results:\n        # Format each float to a reasonable precision for clean output.\n        results_str_parts.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    final_output_str = f\"[{','.join(results_str_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "一个正确的数值模拟必须遵循其所代表的基本物理定律。练习  提供了一种具体的方法来验证近壁解的物理一致性。通过比较从间断Galerkin单元内的局部速度梯度计算出的壁面剪切应力，与从全局动量平衡（即平均压力梯度）推导出的应力，您将学到一种评估近壁模拟准确性的有效技术。",
            "id": "3427267",
            "problem": "考虑一个统计定常、充分发展的不可压缩平面槽道湍流，其半高为 $\\delta$，由流向上的恒定平均压力梯度 $\\frac{\\mathrm{d}p}{\\mathrm{d}x}$ 驱动。该流动采用高阶不连续伽辽金(DG)方法，在紧邻壁面的一个经过仿射映射的法向单元上进行解析。给定空气的以下数据：密度 $\\rho$、动力粘度 $\\mu$、体速度 $U_{b}$、槽道半高 $\\delta$ 和压力梯度 $\\frac{\\mathrm{d}p}{\\mathrm{d}x}$：\n- $\\rho = 1.20$,\n- $\\mu = 1.80 \\times 10^{-5}$,\n- $U_{b} = 10.0$,\n- $\\delta = 0.05$,\n- $\\frac{\\mathrm{d}p}{\\mathrm{d}x} = -4.00$,\n所有量均采用国际单位制(SI)，压力梯度与流向一致，因此 $x$ 沿下游方向增加。\n\n根据基本原理，对于充分发展的槽道流，平均总剪切应力 $\\langle \\tau_{\\text{tot}} \\rangle(y)$ 满足 $\\frac{\\mathrm{d}\\langle \\tau_{\\text{tot}} \\rangle}{\\mathrm{d}y} = \\frac{\\mathrm{d}p}{\\mathrm{d}x}$，壁面剪切应力 $\\tau_{w}$ 通过 $\\tau_{w} = \\delta \\left(-\\frac{\\mathrm{d}p}{\\mathrm{d}x}\\right)$ 与压力梯度相关。摩擦速度定义为 $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$，槽道流摩阻系数定义为 $C_{f} = 2 \\tau_{w}/\\left(\\rho U_{b}^{2}\\right)$。\n\n另外，DG邻壁单元的物理厚度为 $h_{e} = 1.00 \\times 10^{-3}$，它是通过 $y(\\xi) = \\frac{h_{e}}{2}(\\xi+1)$ 从参考坐标 $\\xi \\in [-1,1]$ 映射到物理坐标 $y$ 的。该单元上的平均流向速度用勒让德多项式模态基表示为\n$$\nu_{h}(\\xi) = \\sum_{k=0}^{3} a_{k} P_{k}(\\xi),\n$$\n其中 $P_{k}$ 是勒让德多项式，满足 $P_{0}(\\xi) = 1$、$P_{1}(\\xi) = \\xi$、$P_{2}(\\xi) = \\frac{1}{2}\\left(3\\xi^{2}-1\\right)$ 和 $P_{3}(\\xi) = \\frac{1}{2}\\left(5\\xi^{3} - 3\\xi\\right)$。模态系数给定为\n- $a_{0} = \\frac{991}{180}$,\n- $a_{1} = \\frac{50}{9}$,\n- $a_{2} = \\frac{1}{20}$,\n- $a_{3} = 0$,\n需要说明的是，无滑移边界条件通过数值通量在壁面处被弱施加，因此在 $\\xi=-1$ 处的多项式迹与壁面值一致。\n\n仅使用上述定义和平衡关系，按如下步骤进行：\n1) 计算基于压力梯度的摩擦速度 $u_{\\tau}^{(p)}$ 和相关的摩阻系数 $C_{f}^{(p)}$。\n2) 使用DG多项式，通过映射和勒让德基，计算在壁面处（$\\xi=-1$）的法向速度梯度 $\\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w}$。然后估算基于梯度的壁面剪切应力 $\\tau_{w}^{(g)} = \\mu \\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w}$ 以及相应的摩擦速度 $u_{\\tau}^{(g)} = \\sqrt{\\tau_{w}^{(g)}/\\rho}$ 和摩阻系数 $C_{f}^{(g)}$。\n3) 定义无量纲比率 $R = u_{\\tau}^{(p)}/u_{\\tau}^{(g)}$。报告 R 的值，四舍五入到四位有效数字。你最终报告的量必须是单个数字 R，并且是无量纲的。不要在最终答案中报告任何单位。",
            "solution": "用户提供了一个计算流体动力学中的适定问题，要求比较源于两种不同物理原理的壁面剪切应力量：全局动量平衡和来自数值近似的局部速度梯度。该问题是有效的，因为它具有科学依据、内容自洽，并提供了所有必要数据。我们将按要求分三部分进行解答。\n\n所有量均以国际单位制(SI)表示。提供的参数如下：\n- 密度: $\\rho = 1.20$\n- 动力粘度: $\\mu = 1.80 \\times 10^{-5}$\n- 体速度: $U_{b} = 10.0$\n- 槽道半高: $\\delta = 0.05$\n- 平均压力梯度: $\\frac{\\mathrm{d}p}{\\mathrm{d}x} = -4.00$\n- DG单元厚度: $h_{e} = 1.00 \\times 10^{-3}$\n\n目标是计算比率 $R = u_{\\tau}^{(p)}/u_{\\tau}^{(g)}$，其中 $u_{\\tau}^{(p)}$ 是由压力梯度导出的摩擦速度，$u_{\\tau}^{(g)}$ 是由DG近似的近壁速度梯度导出的摩擦速度。\n\n**1. 基于压力梯度的量的计算**\n\n在充分发展的平面槽道流中，壁面剪切应力 $\\tau_{w}$ 通过积分动量平衡与平均压力梯度相关。问题中给出了直接关系式：\n$$\n\\tau_{w}^{(p)} = \\delta \\left(-\\frac{\\mathrm{d}p}{\\mathrm{d}x}\\right)\n$$\n代入 $\\delta$ 和 $\\frac{\\mathrm{d}p}{\\mathrm{d}x}$ 的给定值：\n$$\n\\tau_{w}^{(p)} = (0.05) \\left(-(-4.00)\\right) = 0.05 \\times 4.00 = 0.20\n$$\n单位是帕斯卡，即 $\\mathrm{N}/\\mathrm{m}^2$。\n\n摩擦速度 $u_{\\tau}$ 定义为 $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$。使用基于压力梯度的壁面剪切应力，我们求得 $u_{\\tau}^{(p)}$：\n$$\nu_{\\tau}^{(p)} = \\sqrt{\\frac{\\tau_{w}^{(p)}}{\\rho}} = \\sqrt{\\frac{0.20}{1.20}} = \\sqrt{\\frac{1}{6}}\n$$\n\n**2. 基于梯度的量的计算**\n\n第二种方法假设流体为牛顿流体，从壁面处的局部速度梯度估算壁面剪切应力：\n$$\n\\tau_{w}^{(g)} = \\mu \\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w}\n$$\n速度剖面 $u_{h}$ 给出为参考坐标 $\\xi \\in [-1,1]$ 的函数：\n$$\nu_{h}(\\xi) = \\sum_{k=0}^{3} a_{k} P_{k}(\\xi)\n$$\n物理坐标 $y$ 通过 $y(\\xi) = \\frac{h_{e}}{2}(\\xi+1)$ 从 $\\xi$ 映射而来，壁面位于 $y=0$ 处，对应于 $\\xi=-1$。\n\n为求得物理梯度 $\\frac{\\mathrm{d}u}{\\mathrm{d}y}$，我们应用链式法则：\n$$\n\\frac{\\mathrm{d}u}{\\mathrm{d}y} = \\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi} \\frac{\\mathrm{d}\\xi}{\\mathrm{d}y}\n$$\n首先，我们求出映射导数，即变换的雅可比：\n$$\n\\frac{\\mathrm{d}y}{\\mathrm{d}\\xi} = \\frac{\\mathrm{d}}{\\mathrm{d}\\xi}\\left(\\frac{h_{e}}{2}(\\xi+1)\\right) = \\frac{h_{e}}{2}\n$$\n这是一个常数。其逆为 $\\frac{\\mathrm{d}\\xi}{\\mathrm{d}y} = \\frac{2}{h_{e}}$。\n\n接下来，我们求速度剖面关于 $\\xi$ 的导数：\n$$\n\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi} = \\sum_{k=0}^{3} a_{k} \\frac{\\mathrm{d}P_{k}}{\\mathrm{d}\\xi}(\\xi)\n$$\n给定勒让德多项式的导数为：\n$P'_{0}(\\xi) = 0$、$P'_{1}(\\xi) = 1$、$P'_{2}(\\xi) = 3\\xi$、$P'_{3}(\\xi) = \\frac{1}{2}(15\\xi^2 - 3)$。\n我们在壁面处 $\\xi=-1$ 计算该导数的值：\n$$\n\\left.\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi}\\right|_{\\xi=-1} = a_{0}P'_{0}(-1) + a_{1}P'_{1}(-1) + a_{2}P'_{2}(-1) + a_{3}P'_{3}(-1)\n$$\n$$\n\\left.\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi}\\right|_{\\xi=-1} = a_{0}(0) + a_{1}(1) + a_{2}(3(-1)) + a_{3}\\left(\\frac{1}{2}(15(-1)^2 - 3)\\right)\n$$\n$$\n\\left.\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi}\\right|_{\\xi=-1} = a_{1} - 3a_{2} + a_{3}\\left(\\frac{15 - 3}{2}\\right) = a_{1} - 3a_{2} + 6a_{3}\n$$\n代入给定的模态系数 $a_{1} = \\frac{50}{9}$、$a_{2} = \\frac{1}{20}$ 和 $a_{3} = 0$：\n$$\n\\left.\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi}\\right|_{\\xi=-1} = \\frac{50}{9} - 3\\left(\\frac{1}{20}\\right) + 6(0) = \\frac{50}{9} - \\frac{3}{20} = \\frac{50 \\times 20 - 3 \\times 9}{180} = \\frac{1000 - 27}{180} = \\frac{973}{180}\n$$\n现在，我们计算壁面处的物理速度梯度：\n$$\n\\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w} = \\left(\\left.\\frac{\\mathrm{d}u_h}{\\mathrm{d}\\xi}\\right|_{\\xi=-1}\\right) \\left(\\frac{\\mathrm{d}\\xi}{\\mathrm{d}y}\\right) = \\left(\\frac{973}{180}\\right) \\left(\\frac{2}{h_{e}}\\right)\n$$\n当 $h_{e} = 1.00 \\times 10^{-3}$ 时：\n$$\n\\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w} = \\frac{973}{180} \\times \\frac{2}{1.00 \\times 10^{-3}} = \\frac{973}{90} \\times 10^{3} = \\frac{97300}{9}\n$$\n那么，基于梯度的壁面剪切应力为：\n$$\n\\tau_{w}^{(g)} = \\mu \\left.\\frac{\\mathrm{d}u}{\\mathrm{d}y}\\right|_{w} = (1.80 \\times 10^{-5}) \\left(\\frac{97300}{9}\\right)\n$$\n$$\n\\tau_{w}^{(g)} = \\left(\\frac{1.80}{9}\\right) \\times 10^{-5} \\times 97300 = 0.20 \\times 10^{-5} \\times 97300 = 0.20 \\times 0.973 = 0.1946\n$$\n基于梯度的摩擦速度 $u_{\\tau}^{(g)}$ 为：\n$$\nu_{\\tau}^{(g)} = \\sqrt{\\frac{\\tau_{w}^{(g)}}{\\rho}} = \\sqrt{\\frac{0.1946}{1.20}}\n$$\n\n**3. 比率 R 的计算**\n\n最后一步是计算无量纲比率 R：\n$$\nR = \\frac{u_{\\tau}^{(p)}}{u_{\\tau}^{(g)}} = \\frac{\\sqrt{\\tau_{w}^{(p)}/\\rho}}{\\sqrt{\\tau_{w}^{(g)}/\\rho}} = \\sqrt{\\frac{\\tau_{w}^{(p)}}{\\tau_{w}^{(g)}}}\n$$\n代入计算出的两个壁面剪切应力的值：\n$$\nR = \\sqrt{\\frac{0.20}{0.1946}} \\approx \\sqrt{1.027749229} \\approx 1.01377967\n$$\n问题要求将此值四舍五入到四位有效数字。\n$$\nR \\approx 1.014\n$$\n这个接近1的值表明，施加于流场的压力梯度与壁面处速度场的局部数值表示所预测的剪切应力之间具有良好的一致性。",
            "answer": "$$\n\\boxed{1.014}\n$$"
        },
        {
            "introduction": "先进的模拟不仅要求准确性，还要求效率。练习  深入探讨了p-自适应技术，这是一种在高阶方法中优化计算资源的精密技术。您将设计一种算法，根据湍流边界层的物理特性自动为不同单元分配多项式阶数，从而学会在保证对缓冲层等关键区域高保真度解析的同时，节省其他区域的计算开销。",
            "id": "3427198",
            "problem": "考虑用于高雷诺数湍流壁面模拟的一维壁面法向谱元或不连续伽辽金 (DG) 单元堆叠。设壁面位于物理坐标 $y=0$（单位：米），且每个单元 $i$ 由其物理下界和上界 $[y_{i,\\mathrm{low}}, y_{i,\\mathrm{high}}]$（单位：米）定义。给定摩擦速度 $u_{\\tau}$（单位：米/秒）和运动粘度 $\\nu$（单位：平方米/秒）。局部内法向坐标由无量纲量 $y^+ = y\\,u_{\\tau}/\\nu$ 定义，它将近壁区域划分为粘性子层、缓冲层和对数层。在本问题中，缓冲层由闭区间 $[y^+_{\\mathrm{buf,low}}, y^+_{\\mathrm{buf,high}}]$ 定义，粘性子层的阈值为 $y^+  y^+_{\\mathrm{visc,max}}$。\n\n您必须实现具有以下规则和目标的 $p$ 自适应：\n- 规则 1（节点采样）：对于每个单元 $i$，在一组选定的 $n_{\\mathrm{LGL}}$ 个勒让德-高斯-洛巴托（LGL）节点上计算 $y^+$，这些节点从参考区间 $[-1,1]$ 线性映射到物理区间 $[y_{i,\\mathrm{low}}, y_{i,\\mathrm{high}}]$。LGL 节点包括端点 $-1$ 和 $+1$ 以及 $n_{\\mathrm{LGL}}-1$ 阶勒让德多项式导数的根。\n- 规则 2（所需多项式阶数的触发条件）：对于单元 $i$，通过以下分类定义所需的最小多项式阶数 $r_i$：\n  - 如果单元 $i$ 中的任何采样点 $y^+$ 位于闭区间缓冲层 $[y^+_{\\mathrm{buf,low}}, y^+_{\\mathrm{buf,high}}]$ 内，则 $r_i = p_{\\mathrm{buffer}}$。\n  - 否则，如果单元 $i$ 中的任何采样点 $y^+$ 满足 $y^+  y^+_{\\mathrm{visc,max}}$，则 $r_i = p_{\\mathrm{viscous}}$。\n  - 否则 $r_i = p_{\\mathrm{far}}$。\n- 规则 3（全局边界和平滑）：单元 $i$ 中的实际多项式阶数 $p_i$ 必须满足 $p_{\\min} \\le p_i \\le p_{\\max}$ 和 $p_i \\ge r_i$。此外，为控制单元间的数值光滑性，对所有相邻单元强制执行相邻差值约束 $\\lvert p_i - p_{i+1} \\rvert \\le 1$。\n- 目标：在所有满足上述约束的整数值分配 $\\{p_i\\}$ 中，找到使总和 $\\sum_i p_i$ 最小的分配。\n\n如果约束不可行（例如，如果任何 $r_i  p_{\\max}$，或者相邻差值约束迫使某个 $p_i$ 超过 $p_{\\max}$），则该测试用例的输出必须如下文所述指明不可行。\n\n基本原理和定义：\n- 不可压缩湍流边界层的近壁尺度律使用内坐标 $y^+ = y\\,u_{\\tau}/\\nu$。\n- 摩擦速度 $u_{\\tau}$ 定义为 $u_{\\tau} = \\sqrt{\\tau_w/\\rho}$，其中 $\\tau_w$ 是壁面剪切应力，$\\rho$ 是流体密度（这些量不是必需的输入；只提供 $u_{\\tau}$）。\n- 对于 $n_{\\mathrm{LGL}}$ 个点，勒让德-高斯-洛巴托节点是 $-1$、$+1$ 以及参考区间内 $n_{\\mathrm{LGL}}-1$ 阶勒让德多项式导数的 $n_{\\mathrm{LGL}}-2$ 个根。\n\n您必须设计一个算法，根据给定的输入，计算出满足规则 1-3 和目标的最小可行向量 $\\{p_i\\}$。该算法必须是通用的，独立于特定的编程语言，并且必须可以在任何现代语言中实现。\n\n物理单位要求：\n- 距离 $y$ 必须以米为单位。\n- 摩擦速度 $u_{\\tau}$ 必须以米/秒为单位。\n- 运动粘度 $\\nu$ 必须以平方米/秒为单位。\n- 量 $y^+$ 是无量纲的。\n- 输出的多项式阶数 $p_i$ 是无量纲整数。\n\n测试套件：\n提供一个程序，为以下测试用例计算 $\\{p_i\\}$。对于每个用例，程序必须按照最终输出格式生成结果。\n\n- 测试用例 1（通用近壁堆叠，典型参数）：\n  - $u_{\\tau} = 0.4$ (米/秒), $\\nu = 1.5\\times 10^{-5}$ (平方米/秒)。\n  - 单元边界（米）：$\\big[(0.0, 0.0002), (0.0002, 0.0004), (0.0004, 0.0008), (0.0008, 0.0012), (0.0012, 0.0020), (0.0020, 0.0030), (0.0030, 0.0045), (0.0045, 0.0060), (0.0060, 0.0080), (0.0080, 0.0100)\\big]$。\n  - $n_{\\mathrm{LGL}} = 4$。\n  - 阈值：$y^+_{\\mathrm{visc,max}} = 5$, $y^+_{\\mathrm{buf,low}} = 5$, $y^+_{\\mathrm{buf,high}} = 30$。\n  - 阶数：$p_{\\min} = 2$, $p_{\\max} = 6$, $p_{\\mathrm{viscous}} = 4$, $p_{\\mathrm{buffer}} = 5$, $p_{\\mathrm{far}} = 2$。\n\n- 测试用例 2（在精确阈值处的边界包含）：\n  - $u_{\\tau} = 0.3$ (米/秒), $\\nu = 1.0\\times 10^{-5}$ (平方米/秒)。\n  - 单元边界（米）：$\\big[(0.0, 0.0001), (0.0001666666667, 0.0003), (0.0008, 0.0010), (0.0012, 0.0020)\\big]$。\n  - $n_{\\mathrm{LGL}} = 4$。\n  - 阈值：$y^+_{\\mathrm{visc,max}} = 5$, $y^+_{\\mathrm{buf,low}} = 5$, $y^+_{\\mathrm{buf,high}} = 30$。\n  - 阶数：$p_{\\min} = 2$, $p_{\\max} = 6$, $p_{\\mathrm{viscous}} = 4$, $p_{\\mathrm{buffer}} = 5$, $p_{\\mathrm{far}} = 2$。\n\n- 测试用例 3（由于 $p_{\\max}$ 过低而不可行）：\n  - $u_{\\tau} = 0.4$ (米/秒), $\\nu = 1.5\\times 10^{-5}$ (平方米/秒)。\n  - 单元边界（米）：与测试用例 1 相同。\n  - $n_{\\mathrm{LGL}} = 4$。\n  - 阈值：$y^+_{\\mathrm{visc,max}} = 5$, $y^+_{\\mathrm{buf,low}} = 5$, $y^+_{\\mathrm{buf,high}} = 30$。\n  - 阶数：$p_{\\min} = 2$, $p_{\\max} = 3$, $p_{\\mathrm{viscous}} = 4$, $p_{\\mathrm{buffer}} = 5$, $p_{\\mathrm{far}} = 2$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。第 $i$ 个条目对应第 $i$ 个测试用例，并且必须是以下两种情况之一：\n- 一个整数列表，表示该用例中所有单元的优化多项式阶数 $\\{p_i\\}$，或者\n- 如果该用例的约束不可行，则为单元素列表 $[-1]$。\n\n例如，对于三个测试用例，一个有效的最终输出可能看起来像 $\\big[[2,3,4],[3,3,2],[-1]\\big]$。您的程序必须只生成这样的一行输出，不得包含任何其他内容。",
            "solution": "该问题提出了计算流体动力学领域中一个明确定义的任务，具体涉及壁面束缚湍流的自适应数值方法。在尝试解决方案之前，需要对问题陈述进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n问题提供了以下数据、定义和约束：\n- **物理背景**：用于壁面模拟的一维壁面法向谱元或不连续伽辽金 (DG) 单元堆叠。\n- **坐标系**：壁面位于 $y=0$。单元 $i$ 跨越 $[y_{i,\\mathrm{low}}, y_{i,\\mathrm{high}}]$。\n- **流动参数**：摩擦速度 $u_{\\tau}$ (米/秒) 和运动粘度 $\\nu$ (平方米/秒)。\n- **无量纲坐标**：内法向坐标 $y^+ = y\\,u_{\\tau}/\\nu$。\n- **流动分层定义**：缓冲层：闭区间 $[y^+_{\\mathrm{buf,low}}, y^+_{\\mathrm{buf,high}}]$。粘性子层：$y^+  y^+_{\\mathrm{visc,max}}$。\n- **规则 1 (采样)**：对每个单元 $i$，在从 $[-1,1]$ 映射到 $[y_{i,\\mathrm{low}}, y_{i,\\mathrm{high}}]$ 的 $n_{\\mathrm{LGL}}$ 个勒让德-高斯-洛巴托 (LGL) 节点上对 $y^+$ 进行采样。\n- **规则 2 (所需阶数)**：单元 $i$ 所需的最小多项式阶数 $r_i$ 为：如果任何采样点 $y^+$ 在 $[y^+_{\\mathrm{buf,low}}, y^+_{\\mathrm{buf,high}}]$ 内，则为 $p_{\\mathrm{buffer}}$。如果没有任何点在缓冲层内，但有任何采样点 $y^+$ 小于 $y^+_{\\mathrm{visc,max}}$，则为 $p_{\\mathrm{viscous}}$。否则为 $p_{\\mathrm{far}}$。\n- **规则 3 (全局约束)**：单元 $i$ 的实际多项式阶数 $p_i$ 必须满足：$p_{\\min} \\le p_i \\le p_{\\max}$；$p_i \\ge r_i$；相邻差值约束：对于所有相邻单元，$\\lvert p_i - p_{i+1} \\rvert \\le 1$。\n- **目标**：找到满足所有约束并使总和 $\\sum_i p_i$ 最小化的整数值分配 $\\{p_i\\}$。\n- **不可行性**：如果不存在这样的分配，算法必须报告。\n- **测试用例**：为三个不同的测试用例提供了所有参数的具体数值。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n根据验证标准对问题进行评估：\n- **科学依据**：该问题基于湍流边界层理论的基本原理（$y^+$ 尺度律）和成熟的数值技术（DG/谱方法、LGL 求积、p 自适应）。这些是高等计算流体动力学中的标准概念。该问题在科学上是合理的。\n- **适定性**：该问题是一个约束整数优化问题。目标函数 ($\\sum_i p_i$) 和约束条件都已明确定义。规则提供了寻找解的确定性程序，并且承认并处理了不可行性的可能性。存在一个算法可以找到唯一的最小解。\n- **客观性**：语言精确且数学化。所有规则都经过正式陈述，没有主观解释的余地。\n- **完整性和一致性**：提供了解决测试用例所需的所有必要数据。规则内部是一致的，尽管对于某些参数选择可能会导致不可行的设置，但问题明确要求处理这种情况。\n\n**步骤 3：结论与行动**\n\n该问题被判定为 **有效**。这是一个在应用数学和计算工程领域中的适定、有科学依据且客观的问题。将提供一个解决方案。\n\n### 算法解决方案设计\n\n目标是为 $N$ 个单元的堆叠找到一个整型多项式阶数向量 $\\{p_i\\}_{i=0}^{N-1}$，该向量在一系列约束条件下，能使总成本 $\\sum_{i=0}^{N-1} p_i$ 最小化。解决方案可以通过一个多步算法来构建。\n\n**步骤 1：确定所需的多项式阶数 ($r_i$)**\n\n第一步是将物理标准转化为每个单元 $i$ 的最小多项式阶数要求 $r_i$。\n\n1.  **计算 LGL 节点**：对于指定数量的采样点 $n_{\\mathrm{LGL}}$，在参考区间 $[-1, 1]$ 内计算勒让德-高斯-洛巴托节点 $\\{\\xi_j\\}_{j=0}^{n_{\\mathrm{LGL}}-1}$。这些节点包括端点 $-1$ 和 $+1$，以及 $n_{\\mathrm{LGL}}-1$ 阶勒让德多项式的一阶导数（表示为 $P'_{n_{\\mathrm{LGL}}-1}(x)$）的 $n_{\\mathrm{LGL}}-2$ 个根。$P'_{k}(x)$ 的根等价于雅可比多项式 $P_{k-1}^{(1,1)}(x)$ 的根。\n\n2.  **将节点映射到物理坐标和壁面单位坐标**：对于由物理区间 $[y_{i,\\mathrm{low}}, y_{i,\\mathrm{high}}]$ 定义的每个单元 $i$，参考节点 $\\xi_j$被线性映射到物理采样点 $y_{i,j}$：\n    $$y_{i,j} = y_{i,\\mathrm{low}} + \\frac{\\xi_j + 1}{2} (y_{i,\\mathrm{high}} - y_{i,\\mathrm{low}})$$\n    然后将这些物理坐标转换为无量纲的壁面单位 $y^+_{i,j}$：\n    $$y^+_{i,j} = \\frac{y_{i,j} u_{\\tau}}{\\nu}$$\n\n3.  **对单元分类并分配 $r_i$**：根据规则 2，使用单元 $i$ 的采样点集 $\\{y^+_{i,j}\\}$ 来确定 $r_i$：\n    - 如果存在任何 $j$ 使得 $y^+_{i,j} \\in [y^+_{\\mathrm{buf,low}}, y^+_{\\mathrm{buf,high}}]$，则 $r_i = p_{\\mathrm{buffer}}$。\n    - 否则，如果存在任何 $j$ 使得 $y^+_{i,j}  y^+_{\\mathrm{visc,max}}$，则 $r_i = p_{\\mathrm{viscous}}$。\n    - 否则， $r_i = p_{\\mathrm{far}}$。\n\n**步骤 2：建立下界和初始可行性检查**\n\n约束 $p_i \\ge r_i$ 和 $p_i \\ge p_{\\min}$ 被合并为每个单元 $i$ 中多项式阶数的单一有效下界 $L_i$：\n$$L_i = \\max(p_{\\min}, r_i)$$\n在此阶段，执行初步可行性检查。如果任何单元所需的下界超过了允许的绝对最大阶数，则约束立即被违反。\n- 如果对于任何 $i \\in [0, N-1]$，有 $L_i  p_{\\max}$，则问题是**不可行**的。\n\n**步骤 3：通过双通平滑算法进行优化**\n\n如果初始可行性检查通过，我们寻找一个向量 $\\{p_i\\}$，它满足 $L_i \\le p_i \\le p_{\\max}$ 和相邻差值约束 $|\\,p_i - p_{i+1}\\,| \\le 1$，同时最小化 $\\sum p_i$。最小化目标意味着我们应该选择尽可能小的 $p_i$ 值。这可以通过一个标准的双通平滑算法来实现。\n\n1.  **初始化**：通过将每个 $p_i$ 设置为其可能的最小值来创建多项式阶数的初始向量 $\\{p_i\\}$：\n    $$p_i \\leftarrow L_i \\quad \\text{for } i = 0, \\dots, N-1$$\n    此分配通过构造满足 $p_i \\ge L_i$，但可能违反相邻差值约束。\n\n2.  **前向传递（从左到右传播）**：通过从左到右传播调整来强制执行相邻差值约束。对于从 $1$ 到 $N-1$ 的 $i$，我们更新 $p_i$ 以确保 $p_i \\ge p_{i-1} - 1$：\n    $$p_i \\leftarrow \\max(p_i, p_{i-1} - 1)$$\n    这一遍保证了对于任何单元 $i$，其阶数 $p_i$ 至少为 $p_{i-1}-1$，满足了平滑约束的一半。由于左侧单元的高要求而导致的任何必要的阶数增加都会向前传播。\n\n3.  **后向传递（从右到左传播）**：第二遍从右到左传播约束。对于从 $N-2$ 向下到 $0$ 的 $i$，我们更新 $p_i$ 以确保 $p_i \\ge p_{i+1} - 1$：\n    $$p_i \\leftarrow \\max(p_i, p_{i+1} - 1)$$\n    这一遍确保了平滑约束的另一半得到满足。此遍之后，对于所有相邻对，条件 $|\\,p_i - p_{i+1}\\,| \\le 1$ 都完全满足。得到的向量 $\\{p_i\\}$ 是满足局部下界 $L_i$ 和全局平滑约束的最小可能整数值向量。\n\n**步骤 4：最终可行性检查**\n\n平滑算法可能会将某些 $p_i$ 值增加到其初始 $L_i$ 值之上。需要进行最终检查，以确保没有 $p_i$ 被推高到超过允许的最大阶数 $p_{\\max}$。\n- 如果对于任何 $i \\in [0, N-1]$，有 $p_i  p_{\\max}$，则组合约束无法满足，问题是**不可行**的。\n- 否则，最终向量 $\\{p_i\\}$ 是有效的最优解。\n\n该算法确定性地计算出满足所有指定规则同时最小化总多项式成本的多项式阶数向量，或者正确地识别出不存在此类解的情况。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import j_roots\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the results.\n    \"\"\"\n    \n    # Test Case 1: General near-wall stack, typical parameters\n    case1 = {\n        \"u_tau\": 0.4, \"nu\": 1.5e-5,\n        \"element_bounds\": [\n            (0.0, 0.0002), (0.0002, 0.0004), (0.0004, 0.0008),\n            (0.0008, 0.0012), (0.0012, 0.0020), (0.0020, 0.0030),\n            (0.0030, 0.0045), (0.0045, 0.0060), (0.0060, 0.0080),\n            (0.0080, 0.0100)\n        ],\n        \"n_lgl\": 4,\n        \"y_plus_visc_max\": 5, \"y_plus_buf_low\": 5, \"y_plus_buf_high\": 30,\n        \"p_min\": 2, \"p_max\": 6, \"p_viscous\": 4, \"p_buffer\": 5, \"p_far\": 2\n    }\n\n    # Test Case 2: Boundary inclusions at exact thresholds\n    case2 = {\n        \"u_tau\": 0.3, \"nu\": 1.0e-5,\n        \"element_bounds\": [\n            (0.0, 0.0001), \n            (0.00016666666666666666, 0.0003), # Lower bound is y+=5\n            (0.0008, 0.0010),                 # Upper bound is y+=30\n            (0.0012, 0.0020)\n        ],\n        \"n_lgl\": 4,\n        \"y_plus_visc_max\": 5, \"y_plus_buf_low\": 5, \"y_plus_buf_high\": 30,\n        \"p_min\": 2, \"p_max\": 6, \"p_viscous\": 4, \"p_buffer\": 5, \"p_far\": 2\n    }\n\n    # Test Case 3: Infeasible due to low p_max\n    case3 = {\n        \"u_tau\": 0.4, \"nu\": 1.5e-5,\n        \"element_bounds\": case1[\"element_bounds\"], # Same as Case 1\n        \"n_lgl\": 4,\n        \"y_plus_visc_max\": 5, \"y_plus_buf_low\": 5, \"y_plus_buf_high\": 30,\n        \"p_min\": 2, \"p_max\": 3, \"p_viscous\": 4, \"p_buffer\": 5, \"p_far\": 2\n    }\n\n    test_cases = [case1, case2, case3]\n    results = [calculate_p_adaptivity(case) for case in test_cases]\n\n    # Format the final output string to match the required format exactly.\n    # e.g., [[2,3,4],[3,3,2],[-1]]\n    final_output = str(results).replace(\" \", \"\")\n    print(final_output)\n\ndef get_lgl_nodes(n):\n    \"\"\"Computes n Legendre-Gauss-Lobatto nodes on the [-1, 1] interval.\"\"\"\n    if n == 1:\n        return np.array([0.0])\n    if n == 2:\n        return np.array([-1.0, 1.0])\n    \n    # Interior nodes are the roots of P'_{n-1}(x), which corresponds to the\n    # roots of the Jacobi polynomial P_{n-2}^{(1,1)}(x).\n    degree_jacobi = n - 2\n    roots, _ = j_roots(degree_jacobi, 1, 1)\n    \n    return np.sort(np.concatenate(([-1.0], roots, [1.0])))\n\ndef calculate_p_adaptivity(params):\n    \"\"\"\n    Calculates the optimized polynomial degrees {p_i} for a single test case.\n    \"\"\"\n    # Unpack parameters\n    u_tau = params[\"u_tau\"]\n    nu = params[\"nu\"]\n    element_bounds = params[\"element_bounds\"]\n    n_lgl = params[\"n_lgl\"]\n    y_plus_visc_max = params[\"y_plus_visc_max\"]\n    y_plus_buf_low = params[\"y_plus_buf_low\"]\n    y_plus_buf_high = params[\"y_plus_buf_high\"]\n    p_min = params[\"p_min\"]\n    p_max = params[\"p_max\"]\n    p_viscous = params[\"p_viscous\"]\n    p_buffer = params[\"p_buffer\"]\n    p_far = params[\"p_far\"]\n\n    num_elements = len(element_bounds)\n    required_degrees = np.zeros(num_elements, dtype=int)\n    \n    lgl_nodes_ref = get_lgl_nodes(n_lgl)\n    y_plus_converter = u_tau / nu\n\n    # Step 1: Determine the required minimum polynomial degrees r_i\n    for i, (y_low, y_high) in enumerate(element_bounds):\n        # Map LGL nodes from reference [-1, 1] to physical element [y_low, y_high]\n        y_physical_samples = y_low + (lgl_nodes_ref + 1.0) / 2.0 * (y_high - y_low)\n        y_plus_samples = y_physical_samples * y_plus_converter\n        \n        # Apply Rule 2 to classify the element\n        if np.any((y_plus_samples >= y_plus_buf_low)  (y_plus_samples = y_plus_buf_high)):\n            required_degrees[i] = p_buffer\n        elif np.any(y_plus_samples  y_plus_visc_max):\n            required_degrees[i] = p_viscous\n        else:\n            required_degrees[i] = p_far\n\n    # Step 2: Define initial lower bounds L_i and check for immediate infeasibility\n    lower_bounds_p = np.maximum(p_min, required_degrees)\n    \n    if np.any(lower_bounds_p > p_max):\n        return [-1]\n\n    # Step 3: Enforce neighbor-difference constraint via two-pass smoothing\n    p = np.copy(lower_bounds_p)\n    \n    # Forward pass (left-to-right)\n    for i in range(1, num_elements):\n        p[i] = max(p[i], p[i-1] - 1)\n        \n    # Backward pass (right-to-left)\n    for i in range(num_elements - 2, -1, -1):\n        p[i] = max(p[i], p[i+1] - 1)\n        \n    # Step 4: Final feasibility check against p_max\n    if np.any(p > p_max):\n        return [-1]\n\n    return p.tolist()\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}