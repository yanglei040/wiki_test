{
    "hands_on_practices": [
        {
            "introduction": "在任何自适应算法中，最基本的决策是确定要加密哪些单元。Dörfler体标记法是一种标准且高效的策略，它确保加密的单元贡献了误差的主要部分。本练习  提供了应用此准则的动手经验，这是计算出局部误差指标后至关重要的第一步。",
            "id": "3389874",
            "problem": "考虑一个标量椭圆边值问题在一维网格上进行不连续伽辽金 (DG) 离散化，该网格包含$10$个单元，采用$hp$自适应策略，其中网格尺寸($h$)和多项式次数($p$)在后续步骤中均根据局部后验误差指示子进行加密。假设一个可靠且高效的基于残差的估计子为当前网格提供了非负的局部指示子 $\\{\\eta_{K}\\}_{K=1}^{10}$，下面列出了这些指示子及其单元索引 $K=1,2,\\dots,10$：\n- $K=1$: $\\eta_{1}=0.90$,\n- $K=2$: $\\eta_{2}=0.85$,\n- $K=3$: $\\eta_{3}=0.75$,\n- $K=4$: $\\eta_{4}=0.60$,\n- $K=5$: $\\eta_{5}=0.58$,\n- $K=6$: $\\eta_{6}=0.40$,\n- $K=7$: $\\eta_{7}=0.35$,\n- $K=8$: $\\eta_{8}=0.30$,\n- $K=9$: $\\eta_{9}=0.25$,\n- $K=10$: $\\eta_{10}=0.20$.\n\n使用参数为 $\\theta=0.50$ 的Dörfler体标记策略，确定必须标记的最小单元数，使得被标记指示子之和至少是所有指示子总和的 $\\theta$ 倍。然后，在你的推理中，证明你的程序所得到的标记单元集在满足体准则的条件下，其标记单元数量是最小的。\n\n将你的最终答案报告为标记集的最小基数 $m$。无需四舍五入。",
            "solution": "该问题要求将Dörfler体标记策略应用于一组给定的局部误差指示子 $\\{\\eta_K\\}_{K=1}^{10}$，这组指示子来自一维不连续伽辽金 (DG) 离散化。目标是确定为进行加密而必须标记的最小单元数。\n\nDörfler体标记策略确定一个标记单元集，记为 $\\mathcal{M}$，它是全体单元集 $\\mathcal{T}$ 的一个子集。标记的准则是，标记单元的局部误差指示子之和必须大于或等于所有局部误差指示子总和的一个预定分数 $\\theta$。在数学上，这表示为：\n$$\n\\sum_{K \\in \\mathcal{M}} \\eta_K \\ge \\theta \\sum_{K \\in \\mathcal{T}} \\eta_K\n$$\n问题要求满足此条件的集合 $\\mathcal{M}$ 的最小可能基数 $m = |\\mathcal{M}|$。\n\n首先，我们列出给定数据：\n- 10个局部误差指示子集：\n  $\\eta_{1}=0.90$, $\\eta_{2}=0.85$, $\\eta_{3}=0.75$, $\\eta_{4}=0.60$, $\\eta_{5}=0.58$, $\\eta_{6}=0.40$, $\\eta_{7}=0.35$, $\\eta_{8}=0.30$, $\\eta_{9}=0.25$, $\\eta_{10}=0.20$。\n- Dörfler标记参数：$\\theta = 0.50$。\n\n第一步是计算所有误差指示子的总和，我们将其记为 $E_{\\text{total}}$。\n$$\nE_{\\text{total}} = \\sum_{K=1}^{10} \\eta_K = 0.90 + 0.85 + 0.75 + 0.60 + 0.58 + 0.40 + 0.35 + 0.30 + 0.25 + 0.20\n$$\n$$\nE_{\\text{total}} = 5.18\n$$\n接下来，我们计算Dörfler准则所需的目标和，我们将其记为 $E_{\\text{target}}$。\n$$\nE_{\\text{target}} = \\theta \\cdot E_{\\text{total}} = 0.50 \\times 5.18 = 2.59\n$$\n任务是找到一个具有最少单元数的集合 $\\mathcal{M}$，使得 $\\sum_{K \\in \\mathcal{M}} \\eta_K \\ge 2.59$。\n\n为了最小化 $\\mathcal{M}$ 中单元的数量，我们必须选择对总和贡献最大的单元。这表明可以采用贪心算法：我们应该按降序对误差指示子进行排序，然后将它们逐一添加到我们的集合中，直到它们的累积和达到或超过目标和 $E_{\\text{target}}$。\n\n给定的指示子已经按降序排列：\n$\\eta_1 = 0.90 > \\eta_2 = 0.85 > \\eta_3 = 0.75 > \\dots > \\eta_{10} = 0.20$。\n\n让我们计算累积和，从最大的指示子开始，一次添加一个单元：\n1.  标记单元 $K=1$：累积和 = $\\eta_1 = 0.90$。条件 $0.90 \\ge 2.59$ 未满足。\n2.  标记单元 $K=2$：累积和 = $\\eta_1 + \\eta_2 = 0.90 + 0.85 = 1.75$。条件 $1.75 \\ge 2.59$ 未满足。\n3.  标记单元 $K=3$：累积和 = $1.75 + \\eta_3 = 1.75 + 0.75 = 2.50$。条件 $2.50 \\ge 2.59$ 未满足。\n4.  标记单元 $K=4$：累积和 = $2.50 + \\eta_4 = 2.50 + 0.60 = 3.10$。条件 $3.10 \\ge 2.59$ 已满足。\n\n过程在此停止。标记单元集为 $\\mathcal{M} = \\{K=1, K=2, K=3, K=4\\}$。此集合中的单元数为4。因此，最小基数为 $m=4$。\n\n现在，我们必须证明为什么这个过程能得到具有最少单元数的集合。\n设指示子按降序排列：$\\eta_{(1)} \\ge \\eta_{(2)} \\ge \\dots \\ge \\eta_{(10)}$。我们的贪心过程选择前 $m$ 个单元，其中 $m$ 是满足 $\\sum_{i=1}^m \\eta_{(i)} \\ge E_{\\text{target}}$ 的最小整数。在我们的例子中，$m=4$。\n\n考虑任何其他基数为 $m'  m$ 的标记单元集 $\\mathcal{M}'$。我们要证明 $\\mathcal{M}'$ 不能满足Dörfler准则。集合 $\\mathcal{M}'$ 的指示子之和为 $\\sum_{K \\in \\mathcal{M}'} \\eta_K$。对于固定的基数 $m'$，要使这个和最大化，必须选择具有最大指示子的 $m'$ 个单元。因此，对于任何 $|\\mathcal{M}'| = m'$ 的集合 $\\mathcal{M}'$，以下不等式成立：\n$$\n\\sum_{K \\in \\mathcal{M}'} \\eta_K \\le \\sum_{i=1}^{m'} \\eta_{(i)}\n$$\n因为我们假设 $m'  m$，我们知道 $m' \\le m-1$。由于所有指示子都是非负的，和是关于项数的非减函数。因此：\n$$\n\\sum_{i=1}^{m'} \\eta_{(i)} \\le \\sum_{i=1}^{m-1} \\eta_{(i)}\n$$\n从我们贪心算法的停止条件可知，前 $m-1$ 个最大指示子的和严格小于目标和：\n$$\n\\sum_{i=1}^{m-1} \\eta_{(i)}  E_{\\text{target}}\n$$\n结合这些不等式，我们得到：\n$$\n\\sum_{K \\in \\mathcal{M}'} \\eta_K \\le \\sum_{i=1}^{m'} \\eta_{(i)} \\le \\sum_{i=1}^{m-1} \\eta_{(i)}  E_{\\text{target}}\n$$\n这表明任何基数 $m'$ 小于 $m$ 的集合 $\\mathcal{M}'$ 都无法满足Dörfler准则。因此，所需的最小单元数确实是 $m=4$，这是通过贪心选择过程找到的。",
            "answer": "$$\n\\boxed{4}\n$$"
        },
        {
            "introduction": "了解了如何标记单元后，我们来探讨如何生成误差指标本身，特别是针对$p$-自适应的指标。本练习  聚焦于一种常用技术：检查解的谱衰减。通过将节点基转换为模态基，我们可以量化最高阶模式中的能量，并据此判断多项式次数$p$是否足够。",
            "id": "3389829",
            "problem": "考虑在不连续伽辽金 (DG) 离散化中，区间 $[-1,1]$ 上的一个一维谱元，其多项式阶数为 $p=3$。其中，DG基是Gauss–Lobatto–Legendre点上的节点Lagrange多项式。对于 $p=3$，Gauss–Lobatto–Legendre点为 $x_0=-1$, $x_1=-\\frac{1}{\\sqrt{5}}$, $x_2=\\frac{1}{\\sqrt{5}}$ 和 $x_3=1$，对应的求积权重为 $w_0=\\frac{1}{6}$, $w_1=\\frac{5}{6}$, $w_2=\\frac{5}{6}$ 和 $w_3=\\frac{1}{6}$。节点DG系数（即多项式近似在这些节点上的值）由下式给出\n$$\nu_0=-2,\\quad\nu_1=2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5},\\quad\nu_2=2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5},\\quad\nu_3=4.\n$$\n使用 $[-1,1]$ 上的标准Legendre多项式 $L_n(x)$（其中 $L_0(x)=1$, $L_1(x)=x$, $L_2(x)=\\frac{1}{2}(3x^2-1)$, $L_3(x)=\\frac{1}{2}(5x^3-3x)$）和 $L^2([-1,1])$ 内积，通过确定模态系数 $a_n$ 将节点表示转换为分层模态表示 $u(x)=\\sum_{n=0}^{p} a_n L_n(x)$。然后，将总能量定义为\n$$\nE_{\\mathrm{tot}}=\\sum_{n=0}^{p} a_n^2 \\,\\frac{2}{2n+1},\n$$\n并将高阶能量定义为包含在最高两个模态中的能量，\n$$\nE_{\\mathrm{hi}}=a_2^2 \\,\\frac{2}{5}+a_3^2 \\,\\frac{2}{7}.\n$$\n从第一性原理出发，使用 $L^2$ 投影的定义和Legendre多项式的正交性来求得 $a_n$。你可以使用上述的Gauss–Lobatto–Legendre求积法则来计算所需的积分。设 $p$-自适应决策规则为：如果比率 $r=\\frac{E_{\\mathrm{hi}}}{E_{\\mathrm{tot}}}$ 严格小于阈值 $\\tau=0.02$，则将 $p$ 增加1；否则将 $p$ 减少1。计算该元素的下一个多项式阶数 $p_{\\mathrm{next}}$。最终答案必须是单个实数 $p_{\\mathrm{next}}$。无需四舍五入。",
            "solution": "求解过程需要将谱元上函数 $u(x)$ 的给定节点表示转换为分层模态表示。在元素 $[-1, 1]$ 内，函数 $u(x)$ 是一个阶数为 $p=3$ 的多项式。其模态表示由一系列正交Legendre多项式 $L_n(x)$ 给出：\n$$u(x) = \\sum_{n=0}^{p} a_n L_n(x)$$\n模态系数 $a_n$ 是通过将 $u(x)$ 投影到每个基函数 $L_n(x)$ 上来确定的，使用的是定义为 $\\langle f, g \\rangle = \\int_{-1}^1 f(x)g(x) dx$ 的 $L^2([-1,1])$ 内积。Legendre多项式关于此内积是正交的，满足：\n$$\\langle L_n, L_m \\rangle = \\int_{-1}^{1} L_n(x) L_m(x) dx = \\frac{2}{2n+1} \\delta_{nm}$$\n其中 $\\delta_{nm}$ 是Kronecker delta符号。\n\n为了求系数 $a_k$，我们计算 $u(x)$ 与 $L_k(x)$ 的内积：\n$$\\langle u, L_k \\rangle = \\left\\langle \\sum_{n=0}^{3} a_n L_n, L_k \\right\\rangle = \\sum_{n=0}^{3} a_n \\langle L_n, L_k \\rangle = a_k \\langle L_k, L_k \\rangle = a_k \\frac{2}{2k+1}$$\n这给出了模态系数的公式：\n$$a_k = \\frac{2k+1}{2} \\int_{-1}^{1} u(x) L_k(x) dx$$\n问题规定，该积分必须使用给定的Gauss–Lobatto–Legendre (GLL) 求积法则进行计算，该法则有 $p+1=4$ 个节点 $\\{x_j\\}_{j=0}^3$ 和权重 $\\{w_j\\}_{j=0}^3$：\n$$\\int_{-1}^1 f(x) dx \\approx \\sum_{j=0}^{3} f(x_j) w_j$$\n该求积对于阶数最高为 $2p-1 = 2(3)-1=5$ 的多项式是精确的。将此应用于 $a_k$ 的公式，我们得到：\n$$a_k = \\frac{2k+1}{2} \\sum_{j=0}^{3} u(x_j) L_k(x_j) w_j$$\n我们已知节点值 $u_j = u(x_j)$。首先，我们计算Legendre多项式 $L_k(x)$ 在GLL节点 $x_j$ 上的值：\n节点为 $x_0=-1$, $x_1=-1/\\sqrt{5}$, $x_2=1/\\sqrt{5}$, $x_3=1$。\nLegendre多项式为 $L_0(x)=1$, $L_1(x)=x$, $L_2(x)=\\frac{1}{2}(3x^2-1)$, $L_3(x)=\\frac{1}{2}(5x^3-3x)$。\n\n$L_k(x_j)$ 的值为：\n对于 $k=0$：对所有 $j$，$L_0(x_j)=1$。\n对于 $k=1$：$L_1(x_0)=-1$, $L_1(x_1)=-1/\\sqrt{5}$, $L_1(x_2)=1/\\sqrt{5}$, $L_1(x_3)=1$。\n对于 $k=2$：$L_2(x_0)=1$, $L_2(x_1)=-1/5$, $L_2(x_2)=-1/5$, $L_2(x_3)=1$。\n对于 $k=3$：$L_3(x_0)=-1$, $L_3(x_1)=1/\\sqrt{5}$, $L_3(x_2)=-1/\\sqrt{5}$, $L_3(x_3)=1$。\n\n现在我们使用给定的节点值 $u_0=-2$, $u_1=2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}$, $u_2=2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}$, $u_3=4$ 和权重 $w_0=1/6$, $w_1=5/6$, $w_2=5/6$, $w_3=1/6$ 来计算系数 $a_k$。\n\n对于 $a_0$ ($k=0$)：\n$$a_0 = \\frac{1}{2} \\sum_{j=0}^{3} u_j w_j = \\frac{1}{2} \\left[(-2)\\frac{1}{6} + \\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6} + \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6} + (4)\\frac{1}{6}\\right]$$\n$$a_0 = \\frac{1}{12} \\left[-2 + 5\\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5} + 2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right) + 4\\right] = \\frac{1}{12} \\left[2 + 5\\left(4-\\frac{2}{5}\\right)\\right] = \\frac{1}{12} \\left[2 + 20-2\\right] = \\frac{20}{12} = \\frac{5}{3}$$\n\n对于 $a_1$ ($k=1$)：\n$$a_1 = \\frac{3}{2} \\sum_{j=0}^{3} u_j w_j L_1(x_j) = \\frac{3}{2} \\left[(-2)\\frac{1}{6}(-1) + \\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(-\\frac{1}{\\sqrt{5}}\\right) + \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(\\frac{1}{\\sqrt{5}}\\right) + (4)\\frac{1}{6}(1)\\right]$$\n$$a_1 = \\frac{3}{12} \\left[2 + \\frac{5}{\\sqrt{5}}\\left(-\\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right) + \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\right) + 4\\right] = \\frac{1}{4} \\left[6 + \\sqrt{5}\\left(\\frac{6}{\\sqrt{5}}\\right)\\right] = \\frac{1}{4} [6+6] = 3$$\n\n对于 $a_2$ ($k=2$)：\n$$a_2 = \\frac{5}{2} \\sum_{j=0}^{3} u_j w_j L_2(x_j) = \\frac{5}{2} \\left[(-2)\\frac{1}{6}(1) + \\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(-\\frac{1}{5}\\right) + \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(-\\frac{1}{5}\\right) + (4)\\frac{1}{6}(1)\\right]$$\n$$a_2 = \\frac{5}{12} \\left[-2 - \\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5} + 2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right) + 4\\right] = \\frac{5}{12} \\left[2 - \\left(4-\\frac{2}{5}\\right)\\right] = \\frac{5}{12} \\left[2 - \\frac{18}{5}\\right] = \\frac{5}{12} \\left[\\frac{10-18}{5}\\right] = \\frac{5}{12} \\left(-\\frac{8}{5}\\right) = -\\frac{8}{12} = -\\frac{2}{3}$$\n\n对于 $a_3$ ($k=3$)：\n$$a_3 = \\frac{7}{2} \\sum_{j=0}^{3} u_j w_j L_3(x_j) = \\frac{7}{2} \\left[(-2)\\frac{1}{6}(-1) + \\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(\\frac{1}{\\sqrt{5}}\\right) + \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\frac{5}{6}\\left(-\\frac{1}{\\sqrt{5}}\\right) + (4)\\frac{1}{6}(1)\\right]$$\n$$a_3 = \\frac{7}{12} \\left[2 + \\frac{5}{\\sqrt{5}}\\left(\\left(2-\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right) - \\left(2+\\frac{3}{\\sqrt{5}}-\\frac{1}{5}\\right)\\right) + 4\\right] = \\frac{7}{12} \\left[6 + \\sqrt{5}\\left(-\\frac{6}{\\sqrt{5}}\\right)\\right] = \\frac{7}{12} [6-6] = 0$$\n因为给定的节点值定义了一个阶数为2的多项式 $u(x)=2+3x-x^2$，所以 $a_3=0$ 是符合预期的。\n\n模态系数为 $a_0 = \\frac{5}{3}$, $a_1 = 3$, $a_2 = -\\frac{2}{3}$ 和 $a_3=0$。接下来，我们计算总能量 $E_{\\mathrm{tot}}$ 和高阶能量 $E_{\\mathrm{hi}}$。\n$$E_{\\mathrm{tot}}=\\sum_{n=0}^{3} a_n^2 \\frac{2}{2n+1} = a_0^2(2) + a_1^2\\left(\\frac{2}{3}\\right) + a_2^2\\left(\\frac{2}{5}\\right) + a_3^2\\left(\\frac{2}{7}\\right)$$\n$$E_{\\mathrm{tot}} = \\left(\\frac{5}{3}\\right)^2(2) + (3)^2\\left(\\frac{2}{3}\\right) + \\left(-\\frac{2}{3}\\right)^2\\left(\\frac{2}{5}\\right) + (0)^2\\left(\\frac{2}{7}\\right)$$\n$$E_{\\mathrm{tot}} = \\frac{25}{9}(2) + 9\\left(\\frac{2}{3}\\right) + \\frac{4}{9}\\left(\\frac{2}{5}\\right) = \\frac{50}{9} + 6 + \\frac{8}{45}$$\n$$E_{\\mathrm{tot}} = \\frac{250}{45} + \\frac{270}{45} + \\frac{8}{45} = \\frac{528}{45} = \\frac{176}{15}$$\n\n$$E_{\\mathrm{hi}} = a_2^2 \\frac{2}{5} + a_3^2 \\frac{2}{7} = \\left(-\\frac{2}{3}\\right)^2\\left(\\frac{2}{5}\\right) + (0)^2\\left(\\frac{2}{7}\\right) = \\frac{4}{9}\\left(\\frac{2}{5}\\right) = \\frac{8}{45}$$\n\n自适应决策基于比率 $r = \\frac{E_{\\mathrm{hi}}}{E_{\\mathrm{tot}}}$：\n$$r = \\frac{8/45}{176/15} = \\frac{8}{45} \\cdot \\frac{15}{176} = \\frac{8}{3 \\cdot 176} = \\frac{1}{66}$$\n给定的阈值为 $\\tau=0.02 = \\frac{1}{50}$。我们将 $r$ 与 $\\tau$ 进行比较：\n$$\\frac{1}{66}  \\frac{1}{50}$$\n所以，$r  \\tau$。自适应规则规定：“如果比率 $r=\\frac{E_{\\mathrm{hi}}}{E_{\\mathrm{tot}}}$ 严格小于阈值 $\\tau=0.02$，则将 $p$ 增加1；否则将 $p$ 减少1。”\n由于条件 $r  \\tau$ 得到满足，多项式阶数应增加1。当前阶数为 $p=3$。\n因此，下一个多项式阶数为 $p_{\\mathrm{next}} = p+1 = 3+1=4$。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "最后的这项练习将所有内容融会贯通。它模拟了一个完整的$hp$-自适应决策过程，超越了单个指标或标记策略。您将实现一个算法 ，该算法为每个单元权衡$h$-加密与$p$-加密的成本和收益，然后使用全局优化方法（背包问题）在固定的计算预算下选择最佳的加密方案组合。这项练习提供了$hp$-自适应策略在实践中如何运作的整体视图。",
            "id": "3389819",
            "problem": "考虑一个用于谱元法 (SEM) 的单元网格，该方法采用不连续伽辽金 (DG) 公式（Discontinuous Galerkin (DG)）。每个单元 $K$ 由其当前网格尺寸 $h_K$、局部多项式次数 $p_K$ 和一个非负的局部误差指示子 $\\eta_K$ 来表征。区域维度为 $d \\in \\{1,2,3\\}$，每个单元的基函数是张量积多项式。每个单元的标量自由度 (DOF) 数量建模为 $(p_K+1)^d$。您将模拟一个 $hp$-自适应算法在附加自由度预算固定的情况下的单个全局决策步骤，为每个单元决定是执行 $h$-细化（分裂单元）还是 $p$-细化（增加局部多项式次数），然后选择这些候选操作的一个子集以适应预算，同时最大化预测的误差减少量。\n\n使用以下基本原理和经过充分检验的事实作为您模型的基础：\n\n- 在 DG 和谱元法中，对于 $d$ 维中次数为 $p_K$ 的张量积多项式，每个单元的局部基函数数量为 $(p_K+1)^d$。\n- 在 $d$ 维中的一次均匀 $h$-细化会将一个父单元分裂成 $2^d$ 个子单元，从而增加全局自由度。在单个单元 $K$ 上执行此 $h$-细化的附加自由度成本是 $\\Delta\\mathrm{dof}_h(K) = \\big(2^d-1\\big)\\,(p_K+1)^d$。\n- 一次 $p$-细化会将局部多项式次数增加 1，从 $p_K$ 变为 $p_K+1$，其附加自由度成本为 $\\Delta\\mathrm{dof}_p(K) = \\big((p_K+2)^d-(p_K+1)^d\\big)$，前提是 $p_K  p_{\\max}$。\n- 对于光滑解，DG 方法的 $h$-收敛速率是 $p_K+1$ 阶的代数收敛；在正则性有限的情况下，有效速率会受到限制。将单元 $K$ 上进行一次 $h$-细化后的预测误差指示子建模为 $\\eta'_h(K) = \\eta_K\\,2^{-\\mu_K}$，其中 $\\mu_K = \\min(p_K+1, r_{\\max})$，$r_{\\max}$ 是作为全局常数提供的正则性上限。\n- 对于解析解/足够光滑的解，$p$-细化通常表现出指数收敛。将单元 $K$ 上进行一次 $p$-细化后的预测误差指示子建模为 $\\eta'_p(K) = \\eta_K\\,e^{-b}$，其中 $b0$ 是一个全局饱和常数。\n\n将单元 $K$ 上某项操作的局部收益定义为局部误差指示子的预测减少量：\n- $B_h(K) = \\eta_K - \\eta'_h(K)$ 用于 $h$-细化，\n- $B_p(K) = \\eta_K - \\eta'_p(K)$ 用于 $p$-细化（仅当 $p_K  p_{\\max}$ 时）。\n\n将某项操作的局部效率比定义为收益除以附加自由度成本：\n- $R_h(K) = \\dfrac{B_h(K)}{\\Delta\\mathrm{dof}_h(K)}$，\n- $R_p(K) = \\dfrac{B_p(K)}{\\Delta\\mathrm{dof}_p(K)}$ （仅当 $p_K  p_{\\max}$ 时）。\n\n对于每个单元 $K$，按如下方式选择单个建议操作：\n- 如果 $p_K  p_{\\max}$，比较 $R_h(K)$ 和 $R_p(K)$；建议比率较大的操作（如果在数值上相等，则选择 $p$-细化）。\n- 如果 $p_K \\ge p_{\\max}$，则建议 $h$-细化。\n如果建议操作的附加自由度成本超过预算，它仍可能被建议，但只有在预算内的全局选择允许时才会被执行。\n\n给定一个总附加自由度预算 $B$，选择一个建议的单元操作子集，该子集在满足其成本总和 $\\sum \\Delta\\mathrm{dof}(\\cdot) \\le B$ 的约束下，最大化其收益总和 $\\sum B(\\cdot)$。这是一个 $0$-$1$ 背包选择问题。\n\n选定子集后，更新单元状态：\n- 对于单元 $K$ 上选定的 $h$-细化，设置 $h_K \\leftarrow h_K/2$ 并保持 $p_K$ 不变。\n- 对于单元 $K$ 上选定的 $p$-细化，设置 $p_K \\leftarrow p_K+1$ 并保持 $h_K$ 不变。\n未被选择的单元保持不变。不要创建或删除单元；$h$-细化通过将现有单元的 $h_K$ 减半来记录。\n\n在此问题中，所有量都是无量纲的。程序必须实现上述决策和选择，并为每个测试用例返回更新后的状态和摘要指标。\n\n测试套件：\n使用以下四个测试用例。对于每个用例，输入为 $(d, p_{\\max}, r_{\\max}, b, B)$ 以及一个包含三元组 $(h_K, p_K, \\eta_K)$ 的单元列表：\n\n- 用例 1（一般情况）：\n  - $d=2$, $p_{\\max}=6$, $r_{\\max}=3$, $b=0.7$, $B=60$。\n  - 单元：\n    - $K_1$: $(h_{K_1}, p_{K_1}, \\eta_{K_1}) = (0.25, 2, 0.08)$，\n    - $K_2$: $(h_{K_2}, p_{K_2}, \\eta_{K_2}) = (0.10, 3, 0.02)$，\n    - $K_3$: $(h_{K_3}, p_{K_3}, \\eta_{K_3}) = (0.20, 1, 0.15)$，\n    - $K_4$: $(h_{K_4}, p_{K_4}, \\eta_{K_4}) = (0.05, 4, 0.01)$，\n    - $K_5$: $(h_{K_5}, p_{K_5}, \\eta_{K_5}) = (0.30, 0, 0.25)$。\n- 用例 2（零预算边界）：\n  - $d=1$, $p_{\\max}=5$, $r_{\\max}=4$, $b=0.5$, $B=0$。\n  - 单元：\n    - $K_1$: $(h_{K_1}, p_{K_1}, \\eta_{K_1}) = (0.50, 2, 0.12)$，\n    - $K_2$: $(h_{K_2}, p_{K_2}, \\eta_{K_2}) = (0.30, 0, 0.06)$，\n    - $K_3$: $(h_{K_3}, p_{K_3}, \\eta_{K_3}) = (0.25, 4, 0.02)$。\n- 用例 3（高维度且 $p$ 有上限）：\n  - $d=3$, $p_{\\max}=2$, $r_{\\max}=2$, $b=1.0$, $B=100$。\n  - 单元：\n    - $K_1$: $(h_{K_1}, p_{K_1}, \\eta_{K_1}) = (0.20, 2, 0.20)$，\n    - $K_2$: $(h_{K_2}, p_{K_2}, \\eta_{K_2}) = (0.10, 2, 0.05)$，\n    - $K_3$: $(h_{K_3}, p_{K_3}, \\eta_{K_3}) = (0.15, 1, 0.10)$。\n- 用例 4（紧预算下的混合操作）：\n  - $d=2$, $p_{\\max}=5$, $r_{\\max}=2$, $b=0.3$, $B=20$。\n  - 单元：\n    - $K_1$: $(h_{K_1}, p_{K_1}, \\eta_{K_1}) = (0.40, 0, 0.50)$，\n    - $K_2$: $(h_{K_2}, p_{K_2}, \\eta_{K_2}) = (0.10, 5, 0.04)$，\n    - $K_3$: $(h_{K_3}, p_{K_3}, \\eta_{K_3}) = (0.20, 2, 0.12)$，\n    - $K_4$: $(h_{K_4}, p_{K_4}, \\eta_{K_4}) = (0.30, 1, 0.08)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含三个条目的列表：\n- 一个扁平化的更新后状态列表，形式为 $[h_{K_1}, p_{K_1}, h_{K_2}, p_{K_2}, \\dots]$，\n- 已使用的附加自由度整数总和，\n- 预测的总误差减少量（所选收益的总和），为浮点数。\n\n因此，总体输出是这些按用例排列的列表的列表，例如 $[[\\dots], \\mathrm{used\\_dofs}_1, \\mathrm{total\\_reduction}_1], [[\\dots], \\mathrm{used\\_dofs}_2, \\mathrm{total\\_reduction}_2], \\dots$ 打印在同一行上。所有数值都应在输出中表示为 Python 数字。",
            "solution": "我们的设计基于间断 Galerkin (DG) 谱元法的标准建模，将自由度 (DOF) 的缩放与 $h$- 和 $p$-收敛特性相结合，以在自由度预算下制定 $hp$-决策。\n\n基本依据：\n- 在 $d$ 维空间中，次数为 $p_K$ 的张量积多项式的局部基函数数量（即局部标量自由度）为 $(p_K+1)^d$。这是通过计算每个坐标上的一维基函数得出的，每个基函数贡献 $(p_K+1)$ 个模式，在 $d$ 个坐标上进行张量积，总共产生 $(p_K+1)^d$ 个模式。\n- 在 $d$ 维中对一个单元进行均匀 $h$-细化会产生 $2^d$ 个子单元。如果父单元局部有 $(p_K+1)^d$ 个自由度，在保持相同 $p_K$ 的情况下，子单元总共将有 $2^d\\,(p_K+1)^d$ 个自由度。由细化这一个单元引起的全局自由度增量为 $\\Delta\\mathrm{dof}_h(K)=\\big(2^d-1\\big)\\,(p_K+1)^d$。\n- 对一个单元进行 $p$-细化会将其局部次数从 $p_K$ 增加到 $p_K+1$，因此该单元的自由度从 $(p_K+1)^d$ 增加到 $(p_K+2)^d$。增量自由度为 $\\Delta\\mathrm{dof}_p(K)=\\big((p_K+2)^d-(p_K+1)^d\\big)$，前提是 $p_K  p_{\\max}$。\n\n误差指示子模型：\n- 对于 $h$-细化，在光滑区域，DG 方法的 $L^2$ 或能量范数误差通常按 $h^{p_K+1}$ 的比例缩放。在正则性有限的情况下，我们用 $r_{\\max}$ 来限制有效阶数。当将 $h_K$ 减半（在单元上进行均匀细化）时，指示子以 $2^{-\\mu_K}$ 的因子乘法收缩，其中 $\\mu_K=\\min(p_K+1,r_{\\max})$。因此，预测的细化后指示子为 $\\eta'_h(K)=\\eta_K\\,2^{-\\mu_K}$，收益为 $B_h(K)=\\eta_K-\\eta'_h(K)=\\eta_K\\big(1-2^{-\\mu_K}\\big)$。\n- 对于 $p$-细化，在解析区域，误差随 $p$ 呈指数收缩。我们采用饱和模型 $\\eta'_p(K)=\\eta_K\\,e^{-b}$ 来处理单个增量 $p \\mapsto p+1$，其中 $b0$ 是全局给定的。收益为 $B_p(K)=\\eta_K-\\eta'_p(K)=\\eta_K\\big(1-e^{-b}\\big)$。\n\n效率和局部建议：\n- 定义效率比 $R_h(K)=\\dfrac{B_h(K)}{\\Delta\\mathrm{dof}_h(K)}$ 和 $R_p(K)=\\dfrac{B_p(K)}{\\Delta\\mathrm{dof}_p(K)}$（如果 $p_Kp_{\\max}$）。对于每个单元，建议比率较大的操作（$h$ 或 $p$）；如果 $p_K\\ge p_{\\max}$，则只有 $h$ 是符合条件的。在比率相等的情况下，优先选择 $p$。\n\n预算下的全局选择：\n- 在可用的总附加自由度预算 $B$ 下，选择一个建议操作的子集，该子集在附加自由度成本总和不超过 $B$ 的约束下，最大化总预测收益。这是经典的 $0$-$1$ 背包问题。由于成本 $\\Delta\\mathrm{dof}$ 是整数且单元数量适中，使用动态规划对容量从 $0$ 到 $B$ 进行求解可以得到最优子集。\n\n状态更新规则：\n- 如果一个单元选择的操作是 $h$-细化，则设置 $h_K\\leftarrow h_K/2$ 并保持 $p_K$ 不变。如果操作是 $p$-细化，则设置 $p_K\\leftarrow p_K+1$ 并保持 $h_K$ 不变。未选择操作的单元保持不变。我们不改变单元的数量；细化决策记录在更新后的 $(h_K,p_K)$ 对中。\n\n算法步骤：\n- 对于每个测试用例，为每个单元计算 $(\\Delta\\mathrm{dof}_h(K), B_h(K), R_h(K))$，并在符合条件时计算 $(\\Delta\\mathrm{dof}_p(K), B_p(K), R_p(K))$。\n- 根据比率规则为每个单元选择一个建议，形成带有权重（成本）和价值（收益）的项目。\n- 通过动态规划解决 $0$-$1$ 背包问题，以在容量 $B$ 下选择总收益最大的项目。\n- 根据所选项目更新 $(h_K,p_K)$。\n- 为每个测试用例报告扁平化列表 $[h_{K_1}, p_{K_1}, h_{K_2}, p_{K_2}, \\dots]$、使用的总自由度（整数）以及预测的总减少量（浮点数）。\n\n对所提供用例的说明性预期（程序执行精确计算）：\n- 用例 1：当 $d=2$, $p_{\\max}=6$, $r_{\\max}=3$, $b=0.7$, $B=60$ 时，效率比倾向于对所有单元进行 $p$-细化，并且总成本在预算范围内；因此，所有 $p_K$ 增加 1，$h_K$ 保持不变。精确计算已使用的附加自由度和总收益。\n- 用例 2：当 $B=0$ 时，无法选择任何操作；输出等于输入，已用自由度为 0，总减少量为 0.0。\n- 用例 3：当 $d=3$, $p_{\\max}=2$ 时，大多数 $p$-细化不被允许；处于 $p_{\\max}$ 的单元的 $h$-细化成本超过预算，因此只有 $p_K=1$ 的单元符合条件，并根据预算下的比率比较被选中。\n- 用例 4：出现了混合的 $h$ 和 $p$ 建议；在紧张的预算下，背包算法选择能在单位预算内最大化总收益的操作组合。\n\n最终程序确定性地实现上述步骤，并按规定格式打印一个单行列表，汇总每个用例的结果。",
            "answer": "```\n[[[0.25, 3, 0.1, 4, 0.2, 2, 0.05, 5, 0.3, 1], 59, 0.2541097258352683], [[0.5, 2, 0.3, 0, 0.25, 4], 0, 0.0], [[0.2, 2, 0.1, 2, 0.15, 2], 19, 0.0632120558868843], [[0.4, 0, 0.05, 5, 0.2, 3, 0.3, 1], 12, 0.05837699313936997]]\n```"
        }
    ]
}