{
    "hands_on_practices": [
        {
            "introduction": "实践始于基础。本练习将探讨如何将函数的曲率（由其Hessian矩阵捕捉）转化为对网格单元的具体几何要求。通过分析一个具有强方向性特征的函数，我们将计算有效解析该函数所需的最优各向异性比率，从而将数学分析与网格设计直接联系起来 。",
            "id": "3363712",
            "problem": "考虑方形域 $\\Omega=[-1,1]^{2}$ 上的标量场 $u(x,y)=\\exp(-100x^{2}-y^{2})$。在高阶谱元法和间断伽辽金（DG）方法的背景下，各向异性网格细化策略通常由Hessian矩阵中编码的曲率信息，以及沿主方向的局部误差均匀分布原理来指导。从泰勒定理和Hessian矩阵作为二阶偏导数矩阵的定义出发，完成以下任务：\n\n1. 根据定义求导，推导在通用点 $(x,y)$ 处 $u$ 的完整Hessian矩阵 $H_{u}(x,y)$。您必须用 $x$、$y$ 和 $u(x,y)$ 显式地写出 $H_{u}(x,y)$。\n\n2. 计算 $H_{u}(0,0)$，并确定其在原点的特征值和相关的主方向，解释它们在 $u$ 的各向异性曲率方面的含义。\n\n3. 利用对于多项式次数 $p\\geq 2$，光滑函数在单元上的主阶插值误差由其二阶导数决定的观察，构造一个对称正定度量张量 $M(x,y)$，该张量通过与 $H_{u}(x,y)$ 的主方向对齐并根据主曲率的大小进行加权来捕捉 $u$ 的各向异性。然后，在点 $(0,0)$ 处，在主框架中施加规范单位度量边长条件，并确定在 $(0,0)$ 处与主方向对齐的最优单元边长 $h_{y}/h_{x}$ 的各向异性比。\n\n将您的最终答案表示为给出原点处比率 $h_{y}/h_{x}$ 的单个实数。不需要单位，也无需四舍五入。",
            "solution": "该问题是有效的，因为它在科学上基于数值分析和微积分的原理，是适定的、客观的，并包含得出唯一解所需的所有信息。\n\n任务是为各向异性网格细化的目的分析标量场 $u(x,y)=\\exp(-100x^{2}-y^{2})$。这包括三个步骤：计算Hessian矩阵，分析其在原点的性质，并根据这些性质确定最优单元的各向异性比。\n\n**第一部分：Hessian矩阵的推导**\n\nHessian矩阵 $H_{u}(x,y)$ 是标量场 $u(x,y)$ 的二阶偏导数矩阵。\n$$ H_{u}(x,y) = \\begin{pmatrix} \\frac{\\partial^2 u}{\\partial x^2} & \\frac{\\partial^2 u}{\\partial x \\partial y} \\\\ \\frac{\\partial^2 u}{\\partial y \\partial x} & \\frac{\\partial^2 u}{\\partial y^2} \\end{pmatrix} $$\n给定的标量场为 $u(x,y) = \\exp(-100x^{2}-y^{2})$。\n\n首先，我们使用链式法则计算一阶偏导数：\n$$ \\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\exp(-100x^{2}-y^{2}) = \\exp(-100x^{2}-y^{2}) \\cdot (-200x) = -200x u(x,y) $$\n$$ \\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial y} \\exp(-100x^{2}-y^{2}) = \\exp(-100x^{2}-y^{2}) \\cdot (-2y) = -2y u(x,y) $$\n\n接下来，我们使用乘积法则计算二阶偏导数：\n$$ \\frac{\\partial^2 u}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left(-200x u(x,y)\\right) = -200 u(x,y) - 200x \\frac{\\partial u}{\\partial x} $$\n代入 $\\frac{\\partial u}{\\partial x}$ 的表达式：\n$$ \\frac{\\partial^2 u}{\\partial x^2} = -200 u(x,y) - 200x (-200x u(x,y)) = (-200 + 40000x^{2}) u(x,y) $$\n\n$$ \\frac{\\partial^2 u}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left(-2y u(x,y)\\right) = -2 u(x,y) - 2y \\frac{\\partial u}{\\partial y} $$\n代入 $\\frac{\\partial u}{\\partial y}$ 的表达式：\n$$ \\frac{\\partial^2 u}{\\partial y^2} = -2 u(x,y) - 2y (-2y u(x,y)) = (-2 + 4y^{2}) u(x,y) $$\n\n对于混合偏导数，根据克莱罗定理（Clairaut's theorem），由于 $u$ 是无限可微的，我们预期 $\\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial^2 u}{\\partial y \\partial x}$。\n$$ \\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial}{\\partial y} \\left(-200x u(x,y)\\right) = -200x \\frac{\\partial u}{\\partial y} = -200x (-2y u(x,y)) = 400xy u(x,y) $$\n\n组合这些分量，Hessian矩阵 $H_{u}(x,y)$ 为：\n$$ H_{u}(x,y) = \\begin{pmatrix} (40000x^{2} - 200) u(x,y) & 400xy u(x,y) \\\\ 400xy u(x,y) & (4y^{2} - 2) u(x,y) \\end{pmatrix} $$\n这可以因式分解为：\n$$ H_{u}(x,y) = u(x,y) \\begin{pmatrix} 40000x^{2} - 200 & 400xy \\\\ 400xy & 4y^{2} - 2 \\end{pmatrix} $$\n\n**第二部分：在原点的计算**\n\n我们在点 $(x,y) = (0,0)$ 处计算Hessian矩阵。\n首先，注意 $u(0,0) = \\exp(-100(0)^{2}-(0)^{2}) = \\exp(0) = 1$。\n将 $x=0$、$y=0$ 和 $u(0,0)=1$ 代入Hessian矩阵表达式：\n$$ H_{u}(0,0) = 1 \\cdot \\begin{pmatrix} 40000(0)^{2} - 200 & 400(0)(0) \\\\ 400(0)(0) & 4(0)^{2} - 2 \\end{pmatrix} = \\begin{pmatrix} -200 & 0 \\\\ 0 & -2 \\end{pmatrix} $$\n由于 $H_{u}(0,0)$ 是一个对角矩阵，其特征值就是对角线上的元素：\n$$ \\lambda_{1} = -200 $$\n$$ \\lambda_{2} = -2 $$\n对应的特征向量（主方向）是标准基向量：\n对于 $\\lambda_{1} = -200$，主方向是 $\\mathbf{v}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，对应于 $x$ 轴。\n对于 $\\lambda_{2} = -2$，主方向是 $\\mathbf{v}_{2} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，对应于 $y$ 轴。\n\n特征值表示函数在原点处的主曲率。$\\lambda_{1}$ 的大的负值表示在 $x$ 方向上非常高的曲率（一个尖锐的峰）。$\\lambda_{2}$ 小得多的绝对值表示在 $y$ 方向上显著较低的曲率。这描述了一个在原点附近沿 $y$ 轴高度拉伸的函数，需要一个在 $x$ 方向上比在 $y$ 方向上精细得多的网格来准确地解析该特征。\n\n**第三部分：各向异性比**\n\n各向异性网格生成中的误差均匀分布原理要求近似误差在所有主方向上都应为常数。对于基于插值的误差，主项与单元尺寸的平方和二阶导数的大小之积有关。在多维环境中，这表示为 $h_{i}^{2} |\\lambda_{i}| \\approx C$，其中 $h_{i}$ 是沿第 $i$ 个主方向的单元边长，$\\lambda_{i}$ 是Hessian矩阵对应的特征值，而 $C$ 是一个常数。\n\n问题要求使用度量张量 $M(x,y)$ 来形式化这一点。一个合适的度量张量由Hessian矩阵构造，使得变换空间中的各向同性单元对应于物理空间中适应函数特征的各向异性单元。一个常见的选择是 $M = V |\\Lambda| V^T$，其中 $V$ 是Hessian矩阵的特征向量矩阵，而 $|\\Lambda|$ 是特征值绝对值的对角矩阵。在原点 $(0,0)$，特征向量与坐标轴对齐，因此 $V = I$（单位矩阵）。\n$$ M(0,0) \\propto |H_{u}(0,0)| = \\begin{pmatrix} |-200| & 0 \\\\ 0 & |-2| \\end{pmatrix} = \\begin{pmatrix} 200 & 0 \\\\ 0 & 2 \\end{pmatrix} $$\n“规范单位度量边长条件”规定，在度量 $M$ 中测量的最优单元边 $\\mathbf{h}_{i}$ 的长度应为1：$\\mathbf{h}_{i}^{T} M \\mathbf{h}_{i} = 1$。设原点处的最优单元具有与主方向（即坐标轴）对齐的边长 $h_{x}$ 和 $h_{y}$。\n$x$ 方向的边向量是 $\\mathbf{h}_{x} = (h_{x}, 0)^{T}$。该条件变为：\n$$ \\mathbf{h}_{x}^{T} M(0,0) \\mathbf{h}_{x} = \\begin{pmatrix} h_{x} & 0 \\end{pmatrix} \\begin{pmatrix} 200 & 0 \\\\ 0 & 2 \\end{pmatrix} \\begin{pmatrix} h_{x} \\\\ 0 \\end{pmatrix} = 200 h_{x}^{2} $$\n我们设 $200 h_{x}^{2} = C_{M}$，其中 $C_{M}$ 是与度量缩放选择相关的某个常数（这里，我们可以将其吸收到“单位长度”的定义中）。\n\n$y$ 方向的边向量是 $\\mathbf{h}_{y} = (0, h_{y})^{T}$。该条件变为：\n$$ \\mathbf{h}_{y}^{T} M(0,0) \\mathbf{h}_{y} = \\begin{pmatrix} 0 & h_{y} \\end{pmatrix} \\begin{pmatrix} 200 & 0 \\\\ 0 & 2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ h_{y} \\end{pmatrix} = 2 h_{y}^{2} $$\n将其设置为相同的常数，$2 h_{y}^{2} = C_{M}$。\n\n将这两个表达式相等，得到最优边长之间的关系：\n$$ 200 h_{x}^{2} = 2 h_{y}^{2} $$\n题目要求我们找到各向异性比 $h_{y} / h_{x}$。我们重新整理方程来求解这个比率：\n$$ \\frac{h_{y}^{2}}{h_{x}^{2}} = \\frac{200}{2} = 100 $$\n对两边取平方根（因为边长 $h_{x}$ 和 $h_{y}$ 是正的）：\n$$ \\frac{h_{y}}{h_{x}} = \\sqrt{100} = 10 $$\n这个结果表明，为了在原点处最优地解析函数 $u(x,y)$，网格单元在 $y$ 方向的长度应为 $x$ 方向长度的10倍。",
            "answer": "$$\n\\boxed{10}\n$$"
        },
        {
            "introduction": "在度量概念的基础上，本练习将理论付诸实践。给定一个编码了所需网格各向异性的空间变化度量，我们将确定一个三角形单元的哪条边在度量意义下是“最长”的。在许多各向异性细化算法中，最长的边通常是分裂的目标，因此该计算是算法的核心步骤 。",
            "id": "3363774",
            "problem": "考虑一个二维三角形单元，用于标量守恒律的间断 Galerkin (DG) 离散化，其中各向异性网格自适应由一个空间变化的黎曼度量场 $M(\\mathbf{x})$ 驱动。该度量源自局部解的 Hessian 矩阵的谱重构，并保证为对称正定 (SPD)。一个端点为 $\\mathbf{x}_{i}$ 和 $\\mathbf{x}_{j}$、常切向量为 $\\dot{\\gamma}(s)=\\mathbf{e}$ 的直边段 $\\gamma:[0,1]\\to\\mathbb{R}^{2}$ 的黎曼长度由以下基本表达式定义\n$$\nL_{M}(\\gamma)\\;=\\;\\int_{0}^{1}\\sqrt{\\dot{\\gamma}(s)^{\\top}M(\\gamma(s))\\,\\dot{\\gamma}(s)}\\,\\mathrm{d}s,\n$$\n该表达式决定了各向异性加密策略，即优先在度量下分割最长的边，以使单元与 DG 解中高曲率的方向对齐。\n\n给定一个特定的三角形单元，其顶点为\n$$\n\\mathbf{x}_{1}=(0,\\,0),\\quad \\mathbf{x}_{2}=(1,\\,0.5),\\quad \\mathbf{x}_{3}=(0.3,\\,1).\n$$\n度量由 $M(\\mathbf{x})=A(\\mathbf{x})^{\\top}A(\\mathbf{x})$ 指定，其中\n$$\nA(x,\\,y)\\;=\\;\\begin{pmatrix}1+x & y \\\\ 0.5 & 2+0.5\\,y\\end{pmatrix}.\n$$\n为了决定该单元的下一个各向异性加密分割，使用一个一致的两点求积法来近似每条直边上的 $L_{M}(\\gamma)$，该方法在顶点处评估度量并假设沿边切向量为常数。然后选择具有最大离散度量长度的边。使用以下标记：\n$$\n\\text{edge }1:\\ \\overline{\\mathbf{x}_{1}\\mathbf{x}_{2}},\\qquad\n\\text{edge }2:\\ \\overline{\\mathbf{x}_{2}\\mathbf{x}_{3}},\\qquad\n\\text{edge }3:\\ \\overline{\\mathbf{x}_{3}\\mathbf{x}_{1}}.\n$$\n根据此标记，将所选的边报告为单个整数。不需要四舍五入，最终答案中不包含任何单位。",
            "solution": "问题要求识别给定三角形单元的最长边，其中长度由空间变化的黎曼度量 $M(\\mathbf{x})$ 测量。加密策略是分割最长的边。\n\n三角形的顶点如下：\n$$\n\\mathbf{x}_{1}=(0,\\,0),\\quad \\mathbf{x}_{2}=(1,\\,0.5),\\quad \\mathbf{x}_{3}=(0.3,\\,1).\n$$\n黎曼度量定义为 $M(\\mathbf{x}) = A(\\mathbf{x})^{\\top}A(\\mathbf{x})$，其中 $\\mathbf{x}=(x,y)$ 且\n$$\nA(x,\\,y)\\;=\\;\\begin{pmatrix}1+x & y \\\\ 0.5 & 2+0.5\\,y\\end{pmatrix}.\n$$\n具有恒定切向量 $\\mathbf{e}$ 的直边 $\\gamma$ 的长度由积分 $L_{M}(\\gamma)\\;=\\;\\int_{0}^{1}\\sqrt{\\mathbf{e}^{\\top}M(\\gamma(s))\\,\\mathbf{e}}\\,\\mathrm{d}s$ 给出。\n根据要求，我们使用一个在顶点处计算被积函数的两点求积法则来近似此积分。对于连接 $\\mathbf{x}_i$ 和 $\\mathbf{x}_j$ 的边，其参数化为 $\\gamma(s) = (1-s)\\mathbf{x}_i + s\\mathbf{x}_j$（$s \\in [0,1]$），切向量为 $\\mathbf{e}_{ij} = \\mathbf{x}_j - \\mathbf{x}_i$。其长度的梯形法则近似为：\n$$\nL_{ij} \\approx \\frac{1}{2} \\left( \\sqrt{\\mathbf{e}_{ij}^{\\top}M(\\mathbf{x}_i)\\mathbf{e}_{ij}} + \\sqrt{\\mathbf{e}_{ij}^{\\top}M(\\mathbf{x}_j)\\mathbf{e}_{ij}} \\right).\n$$\n为解决该问题，我们将计算三条边中每一条的近似长度，并找出最长的一条。\n\n首先，我们计算三个顶点处的度量矩阵。\n在 $\\mathbf{x}_{1}=(0,0)$ 处：\n$$\nA(\\mathbf{x}_1) = A(0,0) = \\begin{pmatrix} 1 & 0 \\\\ 0.5 & 2 \\end{pmatrix}\n$$\n$$\nM(\\mathbf{x}_1) = A(\\mathbf{x}_1)^{\\top}A(\\mathbf{x}_1) = \\begin{pmatrix} 1 & 0.5 \\\\ 0 & 2 \\end{pmatrix}\\begin{pmatrix} 1 & 0 \\\\ 0.5 & 2 \\end{pmatrix} = \\begin{pmatrix} 1.25 & 1 \\\\ 1 & 4 \\end{pmatrix}\n$$\n在 $\\mathbf{x}_{2}=(1,0.5)$ 处：\n$$\nA(\\mathbf{x}_2) = A(1,0.5) = \\begin{pmatrix} 1+1 & 0.5 \\\\ 0.5 & 2+0.5(0.5) \\end{pmatrix} = \\begin{pmatrix} 2 & 0.5 \\\\ 0.5 & 2.25 \\end{pmatrix}\n$$\n$$\nM(\\mathbf{x}_2) = A(\\mathbf{x}_2)^{\\top}A(\\mathbf{x}_2) = \\begin{pmatrix} 2 & 0.5 \\\\ 0.5 & 2.25 \\end{pmatrix}\\begin{pmatrix} 2 & 0.5 \\\\ 0.5 & 2.25 \\end{pmatrix} = \\begin{pmatrix} 4.25 & 2.125 \\\\ 2.125 & 5.3125 \\end{pmatrix}\n$$\n在 $\\mathbf{x}_{3}=(0.3,1)$ 处：\n$$\nA(\\mathbf{x}_3) = A(0.3,1) = \\begin{pmatrix} 1+0.3 & 1 \\\\ 0.5 & 2+0.5(1) \\end{pmatrix} = \\begin{pmatrix} 1.3 & 1 \\\\ 0.5 & 2.5 \\end{pmatrix}\n$$\n$$\nM(\\mathbf{x}_3) = A(\\mathbf{x}_3)^{\\top}A(\\mathbf{x}_3) = \\begin{pmatrix} 1.3 & 0.5 \\\\ 1 & 2.5 \\end{pmatrix}\\begin{pmatrix} 1.3 & 1 \\\\ 0.5 & 2.5 \\end{pmatrix} = \\begin{pmatrix} 1.94 & 2.55 \\\\ 2.55 & 7.25 \\end{pmatrix}\n$$\n\n接下来，我们计算三条边的长度。\n\n**边 1: $\\overline{\\mathbf{x}_{1}\\mathbf{x}_{2}}$**\n切向量为 $\\mathbf{e}_{12} = \\mathbf{x}_2 - \\mathbf{x}_1 = (1, 0.5)^{\\top}$。\n二次型为：\n$$\nQ_{12,1} = \\mathbf{e}_{12}^{\\top}M(\\mathbf{x}_1)\\mathbf{e}_{12} = \\begin{pmatrix} 1 & 0.5 \\end{pmatrix} \\begin{pmatrix} 1.25 & 1 \\\\ 1 & 4 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0.5 \\end{pmatrix} = 3.25\n$$\n$$\nQ_{12,2} = \\mathbf{e}_{12}^{\\top}M(\\mathbf{x}_2)\\mathbf{e}_{12} = \\begin{pmatrix} 1 & 0.5 \\end{pmatrix} \\begin{pmatrix} 4.25 & 2.125 \\\\ 2.125 & 5.3125 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0.5 \\end{pmatrix} = 7.703125\n$$\n近似长度为 $L_1 \\approx \\frac{1}{2}\\left( \\sqrt{3.25} + \\sqrt{7.703125} \\right)$。\n\n**边 2: $\\overline{\\mathbf{x}_{2}\\mathbf{x}_{3}}$**\n切向量为 $\\mathbf{e}_{23} = \\mathbf{x}_3 - \\mathbf{x}_2 = (0.3-1, 1-0.5)^{\\top} = (-0.7, 0.5)^{\\top}$。\n二次型为：\n$$\nQ_{23,2} = \\mathbf{e}_{23}^{\\top}M(\\mathbf{x}_2)\\mathbf{e}_{23} = \\begin{pmatrix} -0.7 & 0.5 \\end{pmatrix} \\begin{pmatrix} 4.25 & 2.125 \\\\ 2.125 & 5.3125 \\end{pmatrix} \\begin{pmatrix} -0.7 \\\\ 0.5 \\end{pmatrix} = 1.923125\n$$\n$$\nQ_{23,3} = \\mathbf{e}_{23}^{\\top}M(\\mathbf{x}_3)\\mathbf{e}_{23} = \\begin{pmatrix} -0.7 & 0.5 \\end{pmatrix} \\begin{pmatrix} 1.94 & 2.55 \\\\ 2.55 & 7.25 \\end{pmatrix} \\begin{pmatrix} -0.7 \\\\ 0.5 \\end{pmatrix} = 0.9781\n$$\n近似长度为 $L_2 \\approx \\frac{1}{2}\\left( \\sqrt{1.923125} + \\sqrt{0.9781} \\right)$。\n\n**边 3: $\\overline{\\mathbf{x}_{3}\\mathbf{x}_{1}}$**\n切向量为 $\\mathbf{e}_{31} = \\mathbf{x}_1 - \\mathbf{x}_3 = (-0.3, -1)^{\\top}$。二次型对向量的符号不变，因此为方便起见，我们可以使用 $-\\mathbf{e}_{31} = (0.3, 1)^{\\top}$。\n二次型为：\n$$\nQ_{31,3} = \\mathbf{e}_{31}^{\\top}M(\\mathbf{x}_3)\\mathbf{e}_{31} = \\begin{pmatrix} 0.3 & 1 \\end{pmatrix} \\begin{pmatrix} 1.94 & 2.55 \\\\ 2.55 & 7.25 \\end{pmatrix} \\begin{pmatrix} 0.3 \\\\ 1 \\end{pmatrix} = 8.9546\n$$\n$$\nQ_{31,1} = \\mathbf{e}_{31}^{\\top}M(\\mathbf{x}_1)\\mathbf{e}_{31} = \\begin{pmatrix} 0.3 & 1 \\end{pmatrix} \\begin{pmatrix} 1.25 & 1 \\\\ 1 & 4 \\end{pmatrix} \\begin{pmatrix} 0.3 \\\\ 1 \\end{pmatrix} = 4.7125\n$$\n近似长度为 $L_3 \\approx \\frac{1}{2}\\left( \\sqrt{8.9546} + \\sqrt{4.7125} \\right)$。\n\n最后，我们比较长度 $L_1$、$L_2$ 和 $L_3$。由于因子 $\\frac{1}{2}$ 是公共的，我们只需要比较平方根的和。\n令 $S_1 = \\sqrt{3.25} + \\sqrt{7.703125}$，$S_2 = \\sqrt{1.923125} + \\sqrt{0.9781}$ 以及 $S_3 = \\sqrt{8.9546} + \\sqrt{4.7125}$。\n\n比较 $S_3$ 和 $S_1$：\n因为 $8.9546 > 7.703125$，所以 $\\sqrt{8.9546} > \\sqrt{7.703125}$。\n因为 $4.7125 > 3.25$，所以 $\\sqrt{4.7125} > \\sqrt{3.25}$。\n将这两个正数的不等式相加，得到 $S_3 > S_1$。因此，$L_3 > L_1$。\n\n比较 $S_1$ 和 $S_2$：\n因为 $7.703125 > 1.923125$，所以 $\\sqrt{7.703125} > \\sqrt{1.923125}$。\n因为 $3.25 > 0.9781$，所以 $\\sqrt{3.25} > \\sqrt{0.9781}$。\n将这两个不等式相加，得到 $S_1 > S_2$。因此，$L_1 > L_2$。\n\n综合这些结果，我们得到排序 $L_3 > L_1 > L_2$。具有最大度量长度的边是边 3。",
            "answer": "$$\n\\boxed{3}\n$$"
        },
        {
            "introduction": "最后的这个练习旨在全面地展示一个自动化的自适应网格细化循环。我们将模拟一个自适应循环的单次迭代，其目标是在固定的计算预算下最小化误差。通过推导和计算拉格朗日乘子，您将参与解决现代数值模拟中高效资源分配核心的优化问题 。",
            "id": "3363715",
            "problem": "考虑在单位平方域 $\\Omega = [0,1] \\times [0,1]$ 上的一个标量、二维、时不变问题，该问题将使用谱方法和间断 Galerkin 方法进行离散化，每个单元采用固定的多项式次数。目标是设计并分析一个各向异性网格自适应循环的单次迭代，该循环包括：求解、估计、构建度量和生成网格，并计算用于强制施加全局自由度预算的拉格朗日乘子。\n\n自适应循环基于以下基本原则和定义构建。\n\n1. 谱方法和间断 Galerkin 离散化对每个单元使用固定的多项式次数 $p$。对于张量积基，每个单元的自由度 (DoF) 数量与 $(p+1)^2$ 成比例。\n\n2. 各向异性度量是根据已知解析解的 Hessian 矩阵派生的曲率代理构建的。设解析场为 $u(x,y) = \\exp(\\kappa x)\\cos(\\nu \\pi y)$ on $\\Omega$，其中 $\\kappa > 0$ 和 $\\nu > 0$ 是给定常数。在点 $(x,y)$ 处的 Hessian 矩阵为\n$$\nH(u)(x,y) = \\begin{pmatrix}\n\\frac{\\partial^2 u}{\\partial x^2}(x,y) & \\frac{\\partial^2 u}{\\partial x \\partial y}(x,y) \\\\\n\\frac{\\partial^2 u}{\\partial y \\partial x}(x,y) & \\frac{\\partial^2 u}{\\partial y^2}(x,y)\n\\end{pmatrix},\n$$\n其元素通过解析计算得出。定义单元 $e$ 上的曲率代理为\n$$\na_e = \\|H(u)(x_e,y_e)\\|_F \\cdot |e|,\n$$\n其中 $\\| \\cdot \\|_F$ 是 Frobenius 范数，$(x_e,y_e)$ 是单元 $e$ 的重心，而 $|e|$ 是单元 $e$ 的面积。\n\n3. 初始网格是将 $\\Omega$ 均匀划分为 $2 \\times 2$ 个矩形单元，每个单元的面积为 $|e| = 1/4$，重心位于 $(x_e,y_e) \\in \\{(1/4,1/4),(3/4,1/4),(1/4,3/4),(3/4,3/4)\\}$。\n\n4. 误差估计基于二维空间中张量积谱元的标准插值理论：单元 $e$ 上的局部插值误差与 $h_e^{p+1}$ 成比例，其中 $h_e$ 是代表性的单元尺寸。在二维中，如果每个粗单元 $e$ 被各向异性地细分为 $m_e$ 个子单元（在连续优化模型中不一定是整数），则 $h_e \\propto m_e^{-1/2}$，局部误差模型形式为\n$$\nE_e(m_e) = a_e \\, m_e^{-\\beta}, \\quad \\beta = \\frac{p+1}{2}.\n$$\n\n5. 全局自由度预算 $B$ 通过约束条件强制执行\n$$\n\\sum_{e} (p+1)^2 \\, m_e = B,\n$$\n等价地，\n$$\n\\sum_{e} m_e = M_{\\text{target}}, \\quad M_{\\text{target}} = \\frac{B}{(p+1)^2}.\n$$\n\n6. 基于度量的分配是通过在预算约束下最小化总估计误差得到的，使用拉格朗日乘子法。目标是\n$$\n\\min_{\\{m_e>0\\}} \\sum_{e} a_e \\, m_e^{-\\beta}\n\\quad \\text{subject to} \\quad \\sum_{e} m_e = M_{\\text{target}}.\n$$\n\n构造拉格朗日函数并推导一阶最优性条件。证明最优的 $m_e$ 可以用拉格朗日乘子 $\\lambda$ 和曲率代理 $a_e$ 表示，并推导出一个强制执行自由度约束的 $\\lambda$ 的封闭形式表达式。实现一个自适应循环迭代，该迭代执行以下操作：\n- 求解：评估解析解以定义曲率代理，\n- 估计：计算每个单元 $e$ 上的 $a_e$，\n- 构建度量：根据推导出的关于 $\\lambda$ 和 $a_e$ 的公式计算最优的 $m_e$，\n- 生成网格：通过四舍五入将 $m_e$ 映射到整数子单元计数（输出不需要此步骤，但必须在程序中执行以在逻辑上完成循环）。\n\n您的程序必须只计算并报告以下每个测试用例的拉格朗日乘子 $\\lambda$。在所有情况下均使用 $\\kappa = 4$ 和 $\\nu = 8$。粗网格如上所述是固定的。\n\n测试套件：\n- 情况 1：多项式次数 $p = 4$，预算 $B = 400$。\n- 情况 2：多项式次数 $p = 6$，预算 $B = 350$。\n- 情况 3：多项式次数 $p = 5$，预算 $B = 10$。\n- 情况 4：多项式次数 $p = 3$，预算 $B = 1000$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[result_1,result_2,result_3,result_4]$）。输出必须是四个测试用例的 $\\lambda$ 值，以十进制浮点数表示。不涉及物理单位或角度，因此不需要单位转换。",
            "solution": "该问题是有效的，因为它在科学上基于偏微分方程数值分析理论，特别是在谱方法和间断 Galerkin 方法的各向异性网格自适应领域。该问题是适定的、客观的、自包含的，并且所有术语和参数都有明确定义。\n\n任务是找到与约束优化问题相关的拉格朗日乘子 $\\lambda$。目标是在总自由度数量 $B$ 的固定预算下，最小化总估计误差 $\\sum_e E_e$。\n\n单元 $e$ 上的局部误差建模为 $E_e(m_e) = a_e \\, m_e^{-\\beta}$，其中 $m_e$ 是粗单元 $e$ 被细分成的新的子单元数量。参数 $\\beta$ 由 $\\beta = \\frac{p+1}{2}$ 给出，其中 $p$ 是多项式次数。量 $a_e$ 是一个曲率代理。\n\n总自由度 (DoF) 数量由 $\\sum_e (p+1)^2 m_e$ 给出。预算约束为 $\\sum_e (p+1)^2 m_e = B$。这可以根据新的单元总数 $M_{\\text{target}}$ 重写为 $\\sum_e m_e = M_{\\text{target}}$，其中 $M_{\\text{target}} = \\frac{B}{(p+1)^2}$。\n\n因此，优化问题是：\n$$\n\\min_{\\{m_e>0\\}} \\sum_{e} a_e \\, m_e^{-\\beta}\n\\quad \\text{subject to} \\quad \\sum_{e} m_e = M_{\\text{target}}.\n$$\n为解决此约束优化问题，我们使用拉格朗日乘子法。我们将拉格朗日函数 $\\mathcal{L}$ 定义为：\n$$\n\\mathcal{L}(\\{m_e\\}, \\lambda) = \\sum_{e} a_e m_e^{-\\beta} + \\lambda \\left( \\left(\\sum_{e} m_e\\right) - M_{\\text{target}} \\right)\n$$\n其中 $\\lambda$ 是拉格朗日乘子。一阶最优性必要条件通过将 $\\mathcal{L}$ 对每个 $m_e$ 和 $\\lambda$ 的偏导数设为零来获得。\n\n对于任意 $m_k$ 的偏导数为：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial m_k} = \\frac{\\partial}{\\partial m_k} \\left( \\sum_{e} a_e m_e^{-\\beta} \\right) + \\frac{\\partial}{\\partial m_k} \\left( \\lambda \\left( \\left(\\sum_{e} m_e\\right) - M_{\\text{target}} \\right) \\right) = 0\n$$\n$$\n-\\beta a_k m_k^{-\\beta-1} + \\lambda = 0\n$$\n此条件必须对每个单元 $k$ 成立。由此，我们可以用拉格朗日乘子 $\\lambda$ 表示最优的 $m_k$：\n$$\n\\lambda = \\beta a_k m_k^{-(\\beta+1)}\n$$\n$$\nm_k^{\\beta+1} = \\frac{\\beta a_k}{\\lambda}\n$$\n$$\nm_k = \\left( \\frac{\\beta a_k}{\\lambda} \\right)^{\\frac{1}{\\beta+1}}\n$$\n这个方程代表了均分原理，即量 $\\beta a_k m_k^{-(\\beta+1)}$ 在所有单元上是恒定的，且等于 $\\lambda$。\n\n为了求出 $\\lambda$ 的值，我们强制执行预算约束 $\\sum_e m_e = M_{\\text{target}}$。我们将 $m_e$ 的表达式代入约束中：\n$$\n\\sum_{e} \\left( \\frac{\\beta a_e}{\\lambda} \\right)^{\\frac{1}{\\beta+1}} = M_{\\text{target}}\n$$\n我们可以将涉及 $\\beta$ 和 $\\lambda$ 的项提取出来，因为它们对所有单元都是常数：\n$$\n\\left( \\frac{\\beta}{\\lambda} \\right)^{\\frac{1}{\\beta+1}} \\sum_{e} a_e^{\\frac{1}{\\beta+1}} = M_{\\text{target}}\n$$\n现在，我们求解 $\\lambda$：\n$$\n\\left( \\frac{\\beta}{\\lambda} \\right)^{\\frac{1}{\\beta+1}} = \\frac{M_{\\text{target}}}{\\sum_{e} a_e^{\\frac{1}{\\beta+1}}}\n$$\n将两边同时取 $\\beta+1$ 次方：\n$$\n\\frac{\\beta}{\\lambda} = \\left( \\frac{M_{\\text{target}}}{\\sum_{e} a_e^{\\frac{1}{\\beta+1}}} \\right)^{\\beta+1}\n$$\n最后，我们得到 $\\lambda$ 的封闭形式表达式：\n$$\n\\lambda = \\beta \\left( \\frac{\\sum_{e} a_e^{\\frac{1}{\\beta+1}}}{M_{\\text{target}}} \\right)^{\\beta+1}\n$$\n一旦曲率代理 $a_e$ 已知，就可以计算出 $\\lambda$ 的值。代理 $a_e$ 定义为 $a_e = \\|H(u)(x_e,y_e)\\|_F \\cdot |e|$，其中 $(x_e, y_e)$ 是单元重心， $|e|$ 是单元面积， $H(u)$ 是解析解 $u(x,y) = \\exp(\\kappa x)\\cos(\\nu \\pi y)$ 的 Hessian 矩阵。\n\n$u(x,y)$ 的偏导数是：\n- $\\frac{\\partial^2 u}{\\partial x^2} = \\kappa^2 \\exp(\\kappa x) \\cos(\\nu \\pi y)$\n- $\\frac{\\partial^2 u}{\\partial y^2} = -(\\nu \\pi)^2 \\exp(\\kappa x) \\cos(\\nu \\pi y)$\n- $\\frac{\\partial^2 u}{\\partial x \\partial y} = -\\kappa \\nu \\pi \\exp(\\kappa x) \\sin(\\nu \\pi y)$\n\nHessian 矩阵 $H(u)$ 的 Frobenius 范数的平方是：\n$$\n\\|H(u)\\|_F^2 = \\left(\\frac{\\partial^2 u}{\\partial x^2}\\right)^2 + \\left(\\frac{\\partial^2 u}{\\partial y^2}\\right)^2 + 2\\left(\\frac{\\partial^2 u}{\\partial x \\partial y}\\right)^2\n$$\n$$\n\\|H(u)(x,y)\\|_F^2 = e^{2\\kappa x} \\left[ (\\kappa^4 + (\\nu \\pi)^4) \\cos^2(\\nu \\pi y) + 2(\\kappa \\nu \\pi)^2 \\sin^2(\\nu \\pi y) \\right]\n$$\n初始网格由 4 个单元组成，每个单元的面积为 $|e| = 1/4 = 0.25$。重心给出为 $\\{(1/4,1/4),(3/4,1/4),(1/4,3/4),(3/4,3/4)\\}$。对于给定的常数 $\\kappa=4$ 和 $\\nu=8$，以及任何重心坐标 $y_e \\in \\{1/4, 3/4\\}$，项 $\\nu \\pi y_e$ 的计算结果为 $8\\pi/4 = 2\\pi$ 或 $8\\pi(3/4) = 6\\pi$。在这两种情况下，$\\sin(\\nu \\pi y_e)=0$ 且 $\\cos(\\nu \\pi y_e)=1$。这显著简化了 Frobenius 范数的计算：\n$$\n\\|H(u)(x_e,y_e)\\|_F = \\exp(\\kappa x_e) \\sqrt{\\kappa^4 + (\\nu \\pi)^4}\n$$\n计算 $\\lambda$ 的算法如下：\n1. 对于给定的测试用例 ($p, B$)，计算 $\\beta = (p+1)/2$ 和 $M_{\\text{target}} = B/(p+1)^2$。\n2. 对于 4 个单元中的每一个，评估其重心坐标 $(x_e, y_e)$。\n3. 计算曲率代理 $a_e = |e| \\cdot \\exp(\\kappa x_e) \\sqrt{\\kappa^4 + (\\nu \\pi)^4}$。\n4. 计算总和 $S = \\sum_e a_e^{\\frac{1}{\\beta+1}}$。\n5. 计算 $\\lambda = \\beta (S / M_{\\text{target}})^{\\beta+1}$。\n对每个测试用例实施此过程以获得所需结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Lagrange multiplier for anisotropic mesh adaptation based on a given\n    analytic solution, error model, and resource budget.\n    \"\"\"\n    # Global constants from the problem statement.\n    KAPPA = 4.0\n    NU = 8.0\n    # The initial mesh is a 2x2 grid on the unit square.\n    BARYCENTERS = [(0.25, 0.25), (0.75, 0.25), (0.25, 0.75), (0.75, 0.75)]\n    ELEM_AREA = 0.25\n\n    # Test suite from the problem statement.\n    test_cases = [\n        # (polynomial degree p, DoF budget B)\n        (4, 400),\n        (6, 350),\n        (5, 10),\n        (3, 1000),\n    ]\n\n    # Pre-compute the constant part of the Frobenius norm.\n    # For the given barycenters, sin(NU*pi*y_e) is always 0.\n    # So, ||H||_F_sq = exp(2*KAPPA*x_e) * (KAPPA**4 + (NU*pi)**4)\n    norm_const = np.sqrt(KAPPA**4 + (NU * np.pi)**4)\n\n    results = []\n    # Process each test case.\n    for p, B in test_cases:\n        # Step 1: `solve` and `estimate`\n        # Compute problem-specific parameters and curvature surrogates a_e.\n        beta = (p + 1.0) / 2.0\n        dof_per_element = (p + 1.0)**2\n        M_target = B / dof_per_element\n\n        a_e_list = []\n        for x_e, y_e in BARYCENTERS:\n            # The simplified Frobenius norm at the barycenter.\n            norm_H = np.exp(KAPPA * x_e) * norm_const\n            a_e = norm_H * ELEM_AREA\n            a_e_list.append(a_e)\n        \n        a_e_array = np.array(a_e_list)\n\n        # Step 2: `build metric` (part 1: find lambda)\n        # Compute the sum term required for the Lagrange multiplier formula.\n        power = 1.0 / (beta + 1.0)\n        sum_term = np.sum(np.power(a_e_array, power))\n\n        # Compute the Lagrange multiplier lambda.\n        lambda_val = beta * np.power(sum_term / M_target, beta + 1.0)\n        results.append(lambda_val)\n\n        # The subsequent parts of the adaptive loop are included for logical completeness\n        # as per the problem description, but are not required for the final output.\n        \n        # Step 3: `build metric` (part 2: find optimal m_e)\n        # Compute the optimal number of subdivisions m_e for each element.\n        m_e_optimal = np.power(beta * a_e_array / lambda_val, power)\n        \n        # This can be used to verify the constraint is met.\n        # assert np.isclose(np.sum(m_e_optimal), M_target)\n\n        # Step 4: `generate mesh`\n        # Map the continuous m_e values to integer subelement counts, typically by rounding.\n        # These integer values would inform the actual mesh generation process.\n        m_e_integer = np.round(m_e_optimal)\n\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}