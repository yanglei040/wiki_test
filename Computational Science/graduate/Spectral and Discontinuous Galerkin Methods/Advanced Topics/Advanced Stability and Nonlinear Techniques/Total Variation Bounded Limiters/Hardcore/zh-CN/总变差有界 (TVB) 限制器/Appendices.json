{
    "hands_on_practices": [
        {
            "introduction": "对于间断Galerkin（DG）方法，斜率限制器通常作用于谱空间的模态系数，而非物理空间的斜率。本练习旨在为$p=1$的多项式次数建立这两者之间的直接数学关系，这是模态限制器方法论的基石 。理解此关联是在模态框架中实现和分析限制器的第一步。",
            "id": "3424008",
            "problem": "考虑一个用于标量守恒律的一维间断 Galerkin (DG) 方法，其多项式次数为 $p=1$，网格为均匀网格。我们关注单个单元 $I_j=[x_{j-\\frac{1}{2}},x_{j+\\frac{1}{2}}]$，其长度为 $h_j=x_{j+\\frac{1}{2}}-x_{j-\\frac{1}{2}}$，中心为 $x_j=\\frac{1}{2}\\left(x_{j-\\frac{1}{2}}+x_{j+\\frac{1}{2}}\\right)$。限制在 $I_j$ 上的 DG 解以守恒线性形式表示为 $u_h|_{I_j}(x)=\\bar{u}_j+\\sigma_j\\,(x-x_j)$，其中 $\\bar{u}_j$ 是单元平均值，$\\sigma_j$ 是单元斜率。设该单元通过仿射变换 $x=x_j+\\frac{h_j}{2}\\,\\xi$（其中 $\\xi\\in[-1,1]$）映射到参考单元。在参考单元上，考虑 Legendre 多项式基 $\\{P_0(\\xi),P_1(\\xi)\\}$，其中 $P_0(\\xi)=1$ 和 $P_1(\\xi)=\\xi$，并通过关于 $[-1,1]$ 上标准内积的 $L^2$ 投影来定义模态系数。即，写作\n$$\nu_h(x(\\xi))=\\hat{u}_{j,0}\\,P_0(\\xi)+\\hat{u}_{j,1}\\,P_1(\\xi),\n$$\n其中系数 $\\hat{u}_{j,0}$ 和 $\\hat{u}_{j,1}$ 是 Legendre 模态系数。利用 Legendre 多项式的正交性，即 $\\int_{-1}^{1}P_m(\\xi)\\,P_n(\\xi)\\,d\\xi=\\frac{2}{2n+1}\\,\\delta_{mn}$，以及参考映射，从第一性原理推导出一个将物理斜率 $\\sigma_j$ 映射到第一个模态系数 $\\hat{u}_{j,1}$ 的闭式表达式。你的最终答案必须是关于 $\\sigma_j$ 和 $h_j$ 的单个解析表达式。无需四舍五入，也不涉及物理单位。同时，简要解释为什么在次数为 $p=1$ 的 DG 格式中，该映射是全变差有界 (TVB) 限制器的目标。",
            "solution": "该问题是有效的。这是一个在偏微分方程数值分析领域中适定且有科学依据的问题。所有必要信息均已提供，目标是基于间断 Galerkin (DG) 方法的标准原理进行形式推导。\n\n主要目标是为单元 $I_j$ 中多项式次数为 $p=1$ 的 DG 解，推导物理斜率 $\\sigma_j$ 与第一个 Legendre 模态系数 $\\hat{u}_{j,1}$ 之间的关系。\n\n单元 $I_j$ 内的解 $u_h$ 有两种等价的表示形式。在物理坐标 $x \\in I_j = [x_{j-\\frac{1}{2}}, x_{j+\\frac{1}{2}}]$ 中，表示为：\n$$\nu_h(x) = \\bar{u}_j + \\sigma_j (x - x_j)\n$$\n其中 $\\bar{u}_j$ 是单元平均值，$\\sigma_j$ 是单元斜率，而 $x_j$ 是单元中心。\n\n单元 $I_j$ 通过仿射变换映射到参考单元 $\\xi \\in [-1, 1]$：\n$$\nx(\\xi) = x_j + \\frac{h_j}{2} \\xi\n$$\n其中 $h_j$ 是单元 $I_j$ 的长度。通过将此映射代入物理表示，我们可以将解表示为参考坐标 $\\xi$ 的函数：\n$$\nu_h(x(\\xi)) = \\bar{u}_j + \\sigma_j \\left( \\left(x_j + \\frac{h_j}{2} \\xi\\right) - x_j \\right) = \\bar{u}_j + \\sigma_j \\frac{h_j}{2} \\xi\n$$\n\n在参考单元中，解也使用 Legendre 多项式基 $\\{P_0(\\xi), P_1(\\xi)\\}$ 以模态形式表示，其中 $P_0(\\xi) = 1$ 和 $P_1(\\xi) = \\xi$：\n$$\nu_h(x(\\xi)) = \\hat{u}_{j,0} P_0(\\xi) + \\hat{u}_{j,1} P_1(\\xi) = \\hat{u}_{j,0} + \\hat{u}_{j,1} \\xi\n$$\n其中 $\\hat{u}_{j,0}$ 和 $\\hat{u}_{j,1}$ 是模态系数。\n\n问题陈述指出，模态系数由解在基函数上的 $L^2$ 投影确定。函数 $f(\\xi)$ 在区间 $[-1, 1]$ 上到正交基函数 $P_n(\\xi)$ 的投影公式为：\n$$\n\\hat{f}_n = \\frac{\\langle f, P_n \\rangle}{\\langle P_n, P_n \\rangle} = \\frac{\\int_{-1}^{1} f(\\xi) P_n(\\xi) d\\xi}{\\int_{-1}^{1} P_n(\\xi)^2 d\\xi}\n$$\n\n我们应用此公式来求解系数 $\\hat{u}_{j,1}$：\n$$\n\\hat{u}_{j,1} = \\frac{\\int_{-1}^{1} u_h(x(\\xi)) P_1(\\xi) d\\xi}{\\int_{-1}^{1} P_1(\\xi)^2 d\\xi}\n$$\n\n分母由问题陈述中提供的 Legendre 多项式正交性质给出：$\\int_{-1}^{1}P_m(\\xi)P_n(\\xi)d\\xi = \\frac{2}{2n+1}\\delta_{mn}$。对于 $n=1$，这给出：\n$$\n\\int_{-1}^{1} P_1(\\xi)^2 d\\xi = \\frac{2}{2(1)+1} = \\frac{2}{3}\n$$\n因此，$\\hat{u}_{j,1}$ 的表达式简化为：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} u_h(x(\\xi)) P_1(\\xi) d\\xi\n$$\n\n现在，我们将 $u_h(x(\\xi))$ 和 $P_1(\\xi) = \\xi$ 的表达式代入积分中：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} \\left(\\bar{u}_j + \\sigma_j \\frac{h_j}{2} \\xi\\right) \\xi \\,d\\xi\n$$\n我们展开被积函数：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} \\left(\\bar{u}_j \\xi + \\sigma_j \\frac{h_j}{2} \\xi^2\\right) d\\xi\n$$\n利用积分的线性性质，我们可以将其分为两部分：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\left( \\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi + \\int_{-1}^{1} \\sigma_j \\frac{h_j}{2} \\xi^2 \\,d\\xi \\right)\n$$\n第一个积分 $\\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi$ 是奇函数 ($\\xi$) 在对称区间上的积分，其值为零。\n$$\n\\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi = \\bar{u}_j \\left[ \\frac{\\xi^2}{2} \\right]_{-1}^{1} = \\bar{u}_j \\left(\\frac{1}{2} - \\frac{1}{2}\\right) = 0\n$$\n第二个积分为：\n$$\n\\int_{-1}^{1} \\sigma_j \\frac{h_j}{2} \\xi^2 \\,d\\xi = \\sigma_j \\frac{h_j}{2} \\int_{-1}^{1} \\xi^2 \\,d\\xi = \\sigma_j \\frac{h_j}{2} \\left[ \\frac{\\xi^3}{3} \\right]_{-1}^{1} = \\sigma_j \\frac{h_j}{2} \\left(\\frac{1}{3} - \\frac{-1}{3}\\right) = \\sigma_j \\frac{h_j}{2} \\left(\\frac{2}{3}\\right) = \\sigma_j \\frac{h_j}{3}\n$$\n将此结果代回 $\\hat{u}_{j,1}$ 的表达式：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\left( 0 + \\sigma_j \\frac{h_j}{3} \\right) = \\frac{3}{2} \\left( \\frac{\\sigma_j h_j}{3} \\right)\n$$\n简化此表达式，得到从物理斜率 $\\sigma_j$到模态系数 $\\hat{u}_{j,1}$ 的最终映射：\n$$\n\\hat{u}_{j,1} = \\frac{1}{2} \\sigma_j h_j\n$$\n\n关于与全变差有界 (TVB) 限制器的联系：\n对于双曲守恒律的间断解，像 DG 这样的高阶数值方法会在激波或陡峭梯度附近产生伪振荡（Gibbs 现象）。限制器旨在抑制这些振荡，以保持物理真实性和数值稳定性。对于标量守恒律，精确解的全变差 (TV) 随时间不增。TVD（全变差递减）和 TVB（全变差有界）格式旨在对数值解强制施加类似的性质。\n在 $p=1$ 的 DG 格式中，单元 $I_j$ 内的解由单元平均值 $\\bar{u}_j$ 和由斜率 $\\sigma_j$ 表征的线性部分组成。单元平均值 $\\bar{u}_j$ 代表守恒量，对格式的守恒性质至关重要；它通常不被限制器修改。斜率 $\\sigma_j$ 代表解的高阶分量，是造成潜在上冲和下冲的原因。因此，用于 $p=1$ DG 的限制器专注于修改或“限制”这个斜率。\n推导出的关系 $\\hat{u}_{j,1} = \\frac{1}{2} \\sigma_j h_j$ 表明，第一个模态系数 $\\hat{u}_{j,1}$ 与物理斜率 $\\sigma_j$（按单元尺寸 $h_j$ 缩放）成正比。这种正比关系至关重要。它意味着限制模态系数 $\\hat{u}_{j,1}$ 的大小在数学上等价于限制物理斜率 $\\sigma_j$ 的大小。TVB 限制器，例如广泛使用的基于 minmod 的限制器，其工作原理是将当前模态系数 $\\hat{u}_{j,1}$ 与从相邻单元的单元平均值之差导出的量进行比较。这种比较决定了斜率是否“过于陡峭”并有引起振荡的风险。如果是这样，$\\hat{u}_{j,1}$ 会被一个“受限”的值替换，这又会减小物理斜率 $\\sigma_j$，从而局部地将格式推向单元内非振荡的、一阶精确的常数状态。因此，推导出的映射是基本联系，它使得斜率限制的物理概念能够在 DG 方法的模态空间中进行计算实现。",
            "answer": "$$\n\\boxed{\\frac{1}{2}\\sigma_j h_j}\n$$"
        },
        {
            "introduction": "总变差有界（TVB）限制器的一个关键特性是其参数$M$，该参数旨在防止限制器在解的光滑区域被激活，从而保持方法的高阶精度。本练习通过一个构造的光滑解，推导出$M$的恰当取值，为我们提供了区分真实间断和光滑极值的具体方法 。这项实践对于正确“校准”限制器以平衡稳定性和精度至关重要。",
            "id": "3424065",
            "problem": "考虑一维标量守恒律 $u_{t} + (f(u))_{x} = s(x)$，该方程定义在具有均匀网格间距 $h0$ 的周期性区域上，其数值方法为采用总变差有界 (TVB) 斜率限制器的分片线性间断Galerkin (DG) 格式。设通量为 $f(u) = \\frac{1}{2}u^{2}$，并考虑人造稳态解 $u(x) = A \\sin(k x)$（其中振幅 $A0$ 且波数 $k0$），以及源项 $s(x) = (f(u(x)))_{x}$，使得对于所有 $x$，$(f(u))_{x} - s(x) = 0$ 成立，即通量梯度与源项精确平衡。\n\n在TVB限制器中，修正的minmod函数使用一个基于单元平均值二阶差分的光滑度检测器。记单元 $I_{i}$ 中的单元平均值为 $\\bar{u}_{i}$。如果光滑度条件\n$$\n|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}| \\le M h^{2}\n$$\n成立，则认为限制器在单元 $I_{i}$ 中不激活，其中 $M0$ 是一个用户选择的TVB参数。否则，限制器将激活并减小斜率。假设网格足够密，使得 $u(x)$ 被很好地解析，并且未经限制的DG重构在光滑区域能恢复正确的局部斜率。\n\n从光滑解的泰勒展开和上述TVB光滑度检测器的定义出发，推导出一个关于 $A$ 和 $k$ 的最小 $M$ 值的解析表达式。该表达式需保证对于足够小的 $h$，在人造稳态解的所有光滑区域（即所有地方，因为 $(f(u))_{x} - s(x) = 0$ 恒成立），限制器都保持不激活状态。您的最终答案必须是关于 $A$ 和 $k$ 的单一闭式表达式，不得包含数值近似或四舍五入。",
            "solution": "用户提出了一个关于确定间断Galerkin (DG) 数值格式中总变差有界 (TVB) 限制器参数的问题。其目标是找到TVB参数 $M$ 的最小值，以防止限制器在已知的、光滑的稳态解上被激活。\n\n该问题陈述已经过验证，被认为是具有科学依据、适定且客观的。它代表了偏微分方程数值方法领域的一项标准分析。\n\n问题的核心在于TVB光滑度检测器条件，该条件规定了如果以下不等式成立，则斜率限制器在单元 $I_i$ 中不激活：\n$$\n|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}| \\le M h^{2}\n$$\n这里，$\\bar{u}_i$ 是解 $u(x)$ 在单元 $I_i = [x_{i-1/2}, x_{i+1/2}]$ 上的平均值，$h = x_{i+1/2} - x_{i-1/2}$ 是均匀的网格间距，$M$ 是TVB参数。我们被要求找到最小的 $M  0$，以确保对于给定的光滑人造解 $u(x) = A \\sin(k x)$，这个条件对所有单元 $i$ 都成立。\n\n设 $x_i$ 是单元 $I_i$ 的中心。单元平均值 $\\bar{u}_i$ 定义为：\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i - h/2}^{x_i + h/2} u(x) \\, dx\n$$\n对于一个光滑函数 $u(x)$ 和一个小的网格尺寸 $h$，我们可以在 $x_i$ 周围将 $u(x)$ 进行泰勒级数展开：\n$$\nu(x) = u(x_i) + u'(x_i)(x-x_i) + \\frac{u''(x_i)}{2!}(x-x_i)^2 + \\frac{u'''(x_i)}{3!}(x-x_i)^3 + \\dots\n$$\n将此展开式代入单元平均值的积分中，得到：\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i - h/2}^{x_i + h/2} \\left( u(x_i) + u'(x_i)(x-x_i) + \\frac{u''(x_i)}{2}(x-x-i)^2 + \\dots \\right) dx\n$$\n积分后，由于积分区间 $[-h/2, h/2]$ 的对称性，$(x-x_i)$ 的奇数次幂项会消失。\n$$\n\\bar{u}_i = \\frac{1}{h} \\left[ u(x_i)h + u'(x_i) \\cdot 0 + \\frac{u''(x_i)}{2} \\frac{h^3}{12} + \\frac{u^{(4)}(x_i)}{24} \\frac{h^5}{80} + \\dots \\right]\n$$\n这得到了著名的单元平均值展开式：\n$$\n\\bar{u}_i = u(x_i) + \\frac{h^2}{24} u''(x_i) + O(h^4)\n$$\n现在，我们必须分析中心差分项 $|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}|$。我们将每个平均值的展开式代入。单元中心位于 $x_{i-1} = x_i - h$、$x_i$ 和 $x_{i+1} = x_i + h$。\n\\begin{align*}\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = \\left( u(x_{i+1}) + \\frac{h^2}{24} u''(x_{i+1}) + O(h^4) \\right) \\\\\n\\quad - 2 \\left( u(x_i) + \\frac{h^2}{24} u''(x_i) + O(h^4) \\right) \\\\\n\\quad + \\left( u(x_{i-1}) + \\frac{h^2}{24} u''(x_{i-1}) + O(h^4) \\right)\n\\end{align*}\n按被差分的函数对各项进行分组：\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = (u(x_{i+1}) - 2u(x_i) + u(x_{i-1})) + \\frac{h^2}{24}(u''(x_{i+1}) - 2u''(x_i) + u''(x_{i-1})) + O(h^6)\n$$\n括号中的表达式是标准的二阶中心差分近似。它们的泰勒级数展开式为：\n$$\nu(x_{i+1}) - 2u(x_i) + u(x_{i-1}) = h^2 u''(x_i) + \\frac{h^4}{12} u^{(4)}(x_i) + O(h^6)\n$$\n$$\nu''(x_{i+1}) - 2u''(x_i) + u''(x_{i-1}) = h^2 (u'')''(x_i) + O(h^4) = h^2 u^{(4)}(x_i) + O(h^4)\n$$\n将这些代回到平均值差分的表达式中：\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = \\left( h^2 u''(x_i) + \\frac{h^4}{12} u^{(4)}(x_i) \\right) + \\frac{h^2}{24} \\left( h^2 u^{(4)}(x_i) \\right) + O(h^6)\n$$\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = h^2 u''(x_i) + \\left( \\frac{1}{12} + \\frac{1}{24} \\right) h^4 u^{(4)}(x_i) + O(h^6) = h^2 u''(x_i) + O(h^4)\n$$\n问题陈述分析是针对“足够小的 $h$”，这意味着我们关心的是主阶行为。光滑度条件变为：\n$$\n|h^2 u''(x_i) + O(h^4)| \\le M h^2\n$$\n两边除以 $h^2$：\n$$\n|u''(x_i) + O(h^2)| \\le M\n$$\n为使该不等式在 $h \\to 0$ 时对任何给定的 $x_i$ 都成立，我们必须有：\n$$\n|u''(x_i)| \\le M\n$$\n为确保限制器在整个光滑解上保持不激活，该条件必须对所有可能的单元位置 $x_i$ 都满足。随着网格的加密，单元中心集合 $\\{x_i\\}$ 在定义域中变得稠密。因此，参数 $M$ 的选择必须满足：\n$$\nM \\ge \\sup_{x} |u''(x)|\n$$\n因此，保证限制器在光滑解上永不激活的 $M$ 的最小值，是解的二阶导数绝对值的上确界（或最大值，因为在周期性设置所隐含的紧集上函数是连续的）。\n$$\nM_{min} = \\max_x |u''(x)|\n$$\n我们已知人造解为 $u(x) = A \\sin(k x)$。我们计算其一阶和二阶导数：\n一阶导数：\n$$\nu'(x) = \\frac{d}{dx} (A \\sin(k x)) = A k \\cos(k x)\n$$\n二阶导数：\n$$\nu''(x) = \\frac{d}{dx} (A k \\cos(k x)) = -A k^2 \\sin(k x)\n$$\n现在，我们求 $u''(x)$ 的最大绝对值：\n$$\n|u''(x)| = |-A k^2 \\sin(k x)|\n$$\n鉴于 $A  0$ 且 $k  0$，项 $A k^2$ 是一个正常数。\n$$\n|u''(x)| = A k^2 |\\sin(k x)|\n$$\n函数 $|\\sin(\\theta)|$ 的最大值为 $1$。因此，$|u''(x)|$ 的最大值为：\n$$\n\\max_x |u''(x)| = A k^2 \\cdot \\max_x |\\sin(k x)| = A k^2 \\cdot 1 = A k^2\n$$\n确保限制器对给定的光滑解保持不激活的TVB参数 $M$ 的最小值为 $A k^2$。关于具体通量函数 $f(u)$ 和源项 $s(x)$ 的信息，是用来证明 $u(x) = A \\sin(k x)$ 是底层守恒律的一个有效稳态解，但这些信息本身不参与 $M$ 的计算，因为限制器条件仅取决于解变量 $u$。",
            "answer": "$$\n\\boxed{A k^{2}}\n$$"
        },
        {
            "introduction": "尽管TVB限制器能有效控制数值振荡，但其设计有时可能导致非物理解，例如在未充分解析的梯度附近违反熵条件。这个高级练习将指导您构建一个发生此类失效的反例 。它揭示了一个关键问题，并探讨了一种检测和修复此类熵增违反的实用策略，以确保数值模拟的物理正确性。",
            "id": "3424004",
            "problem": "考虑一维标量守恒律 $u_t + f(u)_x = 0$，其中包含无粘伯格斯 (inviscid Burgers) 通量 $f(u) = \\tfrac{1}{2}u^2$ 和凸数学熵 $U(u) = \\tfrac{1}{2}u^2$。在周期性域 $[0,1]$ 上进行计算，该域被划分为 $N=20$ 个均匀单元，单元尺寸为 $\\Delta x = 1/N$。使用 $p=1$ 次的间断伽辽金 (DG) 表示（每个单元上为分片线性），因此在每个以 $x_i$ 为中心的单元 $K_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 上，多项式表示为 $u_i(x) = \\bar{u}_i + s_i (x - x_i)$，其中 $\\bar{u}_i$ 是单元平均值，$s_i$ 是通过将初始条件 $L^2$ 投影到 $K_i$ 上的 1 次多项式而获得的（无限制的）斜率。使用欠解析阶跃进行初始化：\n- 当 $x  x_0$ 时，$u_0(x) = 1$；当 $x \\ge x_0$ 时，$u_0(x) = 0$，\n- 阶跃位于 $x_0 = \\tfrac{1}{3} + \\tfrac{1}{4}\\Delta x$，\n使得间断严格位于单个单元内部（不与界面对齐）。\n\n将全变差有界 (TVB) minmod 限制器应用于斜率 $s_i$，具体如下。令 $\\Delta^+ \\bar{u}_i = \\bar{u}_{i+1} - \\bar{u}_i$ 和 $\\Delta^- \\bar{u}_i = \\bar{u}_i - \\bar{u}_{i-1}$，使用周期性索引。定义 TVB 阈值参数 $M > 0$。TVB 修正的 minmod 斜率为\n- 如果 $(\\Delta x)^2 |s_i| \\le M$，则 $s_i^{\\text{TVB}} = s_i$（不进行限制），\n- 否则 $s_i^{\\text{TVB}} = \\operatorname{minmod}\\!\\big(s_i, \\tfrac{\\Delta^+ \\bar{u}_i}{\\Delta x}, \\tfrac{\\Delta^- \\bar{u}_i}{\\Delta x}\\big)$,\n其中，如果 $\\operatorname{sign}(a)=\\operatorname{sign}(b)=\\operatorname{sign}(c)$，则 $\\operatorname{minmod}(a,b,c)$ 返回 $\\operatorname{sign}(a)\\min(|a|,|b|,|c|)$，否则返回 $0$。\n\n将每个单元的离散熵定义为 $U(u_i(x))$ 在每个 $K_i$ 上的积分：\n$$\nE_i(s) = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} U\\big(\\bar{u}_i + s(x - x_i)\\big)\\,dx,\n$$\n其中 $s$ 实例化为基线限制斜率 $s_i^{\\text{base}}$ 或 $M$-TVB 限制斜率 $s_i^{\\text{TVB}}$。使用以下基线进行比较：严格全变差减小 (TVD) minmod 限制器，对应于 TVB 参数 $M=0$，得到 $s_i^{\\text{base}} = \\operatorname{minmod}\\!\\big(s_i, \\tfrac{\\Delta^+ \\bar{u}_i}{\\Delta x}, \\tfrac{\\Delta^- \\bar{u}_i}{\\Delta x}\\big)$。\n\n你的任务：\n1. 在上述设置中构建一个具体反例，证明不当缩放的 $M$ 会导致在欠解析梯度附近出现熵增。具体来说，识别出包含间断的单个“问题最严重”的单元 $K_j$（即 $|s_i|$ 最大的那个单元），并计算 $E_j(s_j^{\\text{TVB}})$ 和 $E_j(s_j^{\\text{base}})$。如果 $E_j(s_j^{\\text{TVB}}) > E_j(s_j^{\\text{base}}) + \\varepsilon$（其中 $\\varepsilon = 10^{-12}$），则声明发生了熵增。\n2. 检测规则：对于给定的 $M$，计算布尔检测器 $\\mathcal{D}(M)$，如果在上述标准下 $K_j$ 中发生熵增，则其值为 $1$ (true)，否则为 $0$ (false)。\n3. 缓解策略：如果 $\\mathcal{D}(M)=1$，则通过使用基线 TVD 限制器在 $K_j$ 中进行重新限制（即设置 $s_j^{\\text{mit}} = s_j^{\\text{base}}$）来进行后验修复，并重新计算熵。报告经过此缓解措施后，根据相同标准，熵增是否仍然存在。\n\n测试套件：\n- 用例 1（理想情况）：$M = 10^{-3}$，不应用缓解措施。输出布尔值，指示熵增是否仍然存在。\n- 用例 2（反例）：$M = 1$，不应用缓解措施。输出布尔值，指示熵增是否仍然存在。\n- 用例 3（已缓解）：$M = 1$，如果检测器触发，则应用缓解措施。输出缓解后熵增是否仍然存在的布尔值。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述用例的顺序排列结果。例如，如果布尔值为 false、true、false，则输出必须精确打印为：“[False,True,False]”。\n- 所有输出均为布尔值。此任务不涉及物理单位或角度单位。\n\n解决方案必须从间断伽辽金法（使用分片线性基）的基本定义、TVB 限制器定义、凸熵积分以及凸函数的性质推导得出。除这些定义外，不得假定任何快捷公式；所有必需的表达式必须在你的推理中从第一性原理推导。所构建的示例必须能由提供的程序复现，无需任何用户输入，仅使用指定的测试套件参数。",
            "solution": "该问题要求我们构建一个特定的数值反例，以证明全变差有界 (TVB) 限制器在某些条件下可能导致离散数学熵的局部增加，而这正是严格全变差减小 (TVD) 限制器旨在防止的行为。我们将遵循一种系统的、基于原理的方法来推导必要的量并评估测试用例。\n\n### 步骤 1：间断伽辽金法的初始数据投影\n\n该问题设定在周期性域 $[0,1]$ 上，有 $N=20$ 个单元，因此单元宽度为 $\\Delta x = 1/N = 0.05$。单元为 $K_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$，其中 $i=0, \\dots, N-1$，单元界面为 $x_{i-\\frac{1}{2}} = i\\Delta x$，单元中心为 $x_i = (i+0.5)\\Delta x$。\n\n每个单元内的解由一个 $p=1$ 次多项式表示：$u_i(x) = \\bar{u}_i + s_i(x-x_i)$。系数 $\\bar{u}_i$（单元平均值）和 $s_i$（斜率）通过将初始条件 $u_0(x)$ 在 $K_i$ 上 $L^2$ 投影到一个多项式基上确定。与此表示对应的基函数为 $\\{1, x-x_i\\}$，它们在对称单元区间 $[x_i-\\Delta x/2, x_i+\\Delta x/2]$ 上是正交的。\n\n单元平均值 $\\bar{u}_i$ 通过将 $u_0(x)$ 投影到常数基函数上来确定：\n$$\n\\bar{u}_i = \\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) \\, dx\n$$\n\n斜率 $s_i$ 通过将 $u_0(x)$ 投影到线性基函数 $(x-x_i)$ 上来确定：\n$$\ns_i \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} (x - x_i)^2 \\, dx = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) (x - x_i) \\, dx\n$$\n左侧的归一化积分为 $\\int_{-\\Delta x/2}^{\\Delta x/2} \\xi^2 \\, d\\xi = [\\xi^3/3]_{-\\Delta x/2}^{\\Delta x/2} = \\Delta x^3/12$。由此得到斜率的公式：\n$$\ns_i = \\frac{12}{\\Delta x^3} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) (x - x_i) \\, dx\n$$\n\n初始条件是一个阶跃函数：当 $x  x_0$ 时 $u_0(x) = 1$，当 $x \\ge x_0$ 时 $u_0(x) = 0$，间断点位于 $x_0 = \\frac{1}{3} + \\frac{1}{4}\\Delta x = \\frac{1}{3} + \\frac{1}{4}(\\frac{1}{20}) = \\frac{1}{3} + \\frac{1}{80} = \\frac{83}{240}$。\n数值上，$x_0 \\approx 0.34583$。由于 $\\Delta x = 0.05$，包含 $x_0$ 的单元索引 $j$ 可通过 $j = \\lfloor x_0 / \\Delta x \\rfloor = \\lfloor 0.34583 / 0.05 \\rfloor = \\lfloor 6.9166 \\rfloor = 6$ 找到。该单元为 $K_6 = [6\\Delta x, 7\\Delta x] = [0.3, 0.35]$。这是“问题最严重”的单元，因为它是唯一一个斜率不为零的单元。\n\n对于任何 $i  6$ 的单元 $K_i$，$u_0(x)=1$ 在整个单元上成立。因此，$\\bar{u}_i = 1$ 且 $s_i=0$。\n对于任何 $i > 6$ 的单元 $K_i$，$u_0(x)=0$ 在整个单元上成立。因此，$\\bar{u}_i = 0$ 且 $s_i=0$。\n\n对于 $j=6$ 的单元 $K_6$：\n$x_{6-\\frac{1}{2}} = 0.3$，$x_{6+\\frac{1}{2}} = 0.35$，且 $x_6 = 0.325$。\n$$\n\\bar{u}_6 = \\frac{1}{\\Delta x} \\int_{0.3}^{0.35} u_0(x) \\, dx = \\frac{1}{\\Delta x} \\int_{0.3}^{x_0} 1 \\, dx = \\frac{x_0 - 0.3}{\\Delta x} = \\frac{83/240 - 72/240}{12/240} = \\frac{11}{12}\n$$\n$$\ns_6 = \\frac{12}{\\Delta x^3} \\int_{0.3}^{x_0} (x - x_6) \\, dx = \\frac{12}{\\Delta x^3} \\left[ \\frac{(x-x_6)^2}{2} \\right]_{0.3}^{x_0} = \\frac{6}{\\Delta x^3} \\left( (x_0 - x_6)^2 - (0.3 - x_6)^2 \\right)\n$$\n已知 $x_0 = 83/240$，$x_6 = 0.325 = 78/240$，以及 $0.3 = 72/240$，我们有：\n$x_0 - x_6 = 5/240$。且 $0.3 - x_6 = -6/240 = -\\Delta x/2$。\n$$\ns_6 = \\frac{6}{\\Delta x^3} \\left( (\\frac{5}{240})^2 - (-\\frac{6}{240})^2 \\right) = \\frac{6}{(\\frac{12}{240})^3} \\frac{25-36}{240^2} = \\frac{6 \\cdot 240^3}{12^3} \\frac{-11}{240^2} = \\frac{6 \\cdot 240 \\cdot (-11)}{1728} = \\frac{-15840}{1728} = -\\frac{55}{6}\n$$\n因此，问题单元中的初始无限制斜率为 $s_j = s_6 = -55/6 \\approx -9.167$。\n\n### 步骤 2：限制器应用\n\n我们需要基线 TVD 限制斜率 $s_j^{\\text{base}}$ 和 TVB 限制斜率 $s_j^{\\text{TVB}}$。基线斜率为 $s_j^{\\text{base}} = \\operatorname{minmod}(s_j, \\frac{\\Delta^+ \\bar{u}_j}{\\Delta x}, \\frac{\\Delta^- \\bar{u}_j}{\\Delta x})$。\n对于单元 $j=6$：\n$\\bar{u}_{j+1} = \\bar{u}_7 = 0$。\n$\\bar{u}_j = \\bar{u}_6 = 11/12$。\n$\\bar{u}_{j-1} = \\bar{u}_5 = 1$。\n差值为 $\\Delta^+ \\bar{u}_j = 0 - 11/12 = -11/12$ 和 $\\Delta^- \\bar{u}_j = 11/12 - 1 = -1/12$。\nminmod 函数的候选斜率是：\n1. $s_j = -55/6$\n2. $\\frac{\\Delta^+ \\bar{u}_j}{\\Delta x} = \\frac{-11/12}{1/20} = -220/12 = -55/3$\n3. $\\frac{\\Delta^- \\bar{u}_j}{\\Delta x} = \\frac{-1/12}{1/20} = -20/12 = -5/3$\n\n所有三个参数都是负数。minmod 函数将返回绝对值最小的那个：$\\operatorname{minmod}(-55/6, -55/3, -5/3) = \\operatorname{minmod}(-9.167, -18.333, -1.667) = -5/3$。\n因此，基线 TVD 限制斜率为 $s_j^{\\text{base}} = -5/3$。\n\n仅当 $(\\Delta x)^2 |s_j| > M$ 时，TVB 限制器才应用 TVD minmod 限制器。\n我们来计算阈值量：$(\\Delta x)^2 |s_j| = (1/20)^2 |-55/6| = \\frac{1}{400} \\frac{55}{6} = \\frac{55}{2400} = \\frac{11}{480} \\approx 0.0229167$。\nTVB 限制斜率为：\n$$\ns_j^{\\text{TVB}} =\n\\begin{cases}\ns_j = -55/6   \\text{若 } M \\ge 11/480 \\\\\ns_j^{\\text{base}} = -5/3   \\text{若 } M  11/480\n\\end{cases}\n$$\n\n### 步骤 3：离散熵分析\n\n单元 $K_j$ 中的离散熵定义为 $E_j(s) = \\int_{K_j} U(u_j(x)) \\, dx$，其中 $U(u)=\\frac{1}{2}u^2$ 且 $u_j(x) = \\bar{u}_j + s(x-x_j)$。\n$$\nE_j(s) = \\int_{x_j-\\Delta x/2}^{x_j+\\Delta x/2} \\frac{1}{2} (\\bar{u}_j + s(x-x_j))^2 \\, dx\n$$\n令 $\\xi = x-x_j$。\n$$\nE_j(s) = \\frac{1}{2} \\int_{-\\Delta x/2}^{\\Delta x/2} (\\bar{u}_j^2 + 2s\\bar{u}_j\\xi + s^2\\xi^2) \\, d\\xi\n$$\n关于 $\\xi$ 的线性项在对称区间上的积分为零。\n$$\nE_j(s) = \\frac{1}{2} \\left[ \\bar{u}_j^2 \\xi + s^2 \\frac{\\xi^3}{3} \\right]_{-\\Delta x/2}^{\\Delta x/2} = \\frac{1}{2} \\left( \\bar{u}_j^2 \\Delta x + s^2 \\frac{\\Delta x^3}{12} \\right) = \\Delta x \\left( \\frac{1}{2}\\bar{u}_j^2 + \\frac{1}{24} s^2 (\\Delta x)^2 \\right)\n$$\n如果 $E_j(s_j^{\\text{TVB}}) > E_j(s_j^{\\text{base}}) + \\varepsilon$，则声明发生熵增。这等价于：\n$$\n\\Delta x \\left( \\frac{1}{2}\\bar{u}_j^2 + \\frac{1}{24} (s_j^{\\text{TVB}})^2 (\\Delta x)^2 \\right) > \\Delta x \\left( \\frac{1}{2}\\bar{u}_j^2 + \\frac{1}{24} (s_j^{\\text{base}})^2 (\\Delta x)^2 \\right) + \\varepsilon\n$$\n$$\n\\frac{\\Delta x^3}{24} \\left( (s_j^{\\text{TVB}})^2 - (s_j^{\\text{base}})^2 \\right) > \\varepsilon\n$$\n当且仅当 $|s_j^{\\text{TVB}}| > |s_j^{\\text{base}}|$，且差值的量级足够大以超过容差 $\\varepsilon$ 时，熵才会增加。\n\n### 步骤 4：评估测试用例\n\n我们评估每个用例的布尔条件。问题单元的索引是 $j=6$。所用值为：$\\varepsilon = 10^{-12}$，$\\Delta x = 0.05$，$s_j = -55/6$，$s_j^{\\text{base}} = -5/3$，以及 TVB 缩放因子为 $11/480$。\n\n**用例 1：$M = 10^{-3} = 0.001$。**\n我们检查 TVB 条件：$M = 0.001$ 与阈值 $11/480 \\approx 0.0229$ 进行比较。\n由于 $M  11/480$，限制器被激活。\n$s_j^{\\text{TVB}} = s_j^{\\text{base}} = -5/3$。\n熵增检查为 $\\frac{\\Delta x^3}{24} \\left( (s_j^{\\text{base}})^2 - (s_j^{\\text{base}})^2 \\right) > \\varepsilon$，简化为 $0 > \\varepsilon$。此为假。\n**用例 1 的结果：False。**\n\n**用例 2：$M = 1$。**\n我们检查 TVB 条件：$M = 1$ 与阈值 $11/480 \\approx 0.0229$ 进行比较。\n由于 $M > 11/480$，限制器未被激活。\n$s_j^{\\text{TVB}} = s_j = -55/6$。\n熵增检查为 $\\frac{\\Delta x^3}{24} \\left( (-55/6)^2 - (-5/3)^2 \\right) > \\varepsilon$。\n左侧为 $\\frac{(0.05)^3}{24} \\left( \\frac{3025}{36} - \\frac{25}{9} \\right) = \\frac{0.000125}{24} \\left( \\frac{3025-100}{36} \\right) = \\frac{0.000125}{24} \\frac{2925}{36} \\approx 4.23 \\times 10^{-4}$。\n由于 $4.23 \\times 10^{-4} > 10^{-12}$，该条件为真。发生熵增。\n**用例 2 的结果：True。**\n\n**用例 3：$M = 1$，带缓解措施。**\n对于 $M=1$，如用例 2 所示，检测器 $\\mathcal{D}(M)$ 会触发。缓解规则是重新限制单元 $j$ 中的斜率，设置 $s_j^{\\text{mit}} = s_j^{\\text{base}}$。\n因此，用于最终检查的斜率为 $s_j^{\\text{mit}} = -5/3$。\n问题要求使用相同的标准，判断缓解后熵增是否仍然存在。该标准是将当前状态的熵与基线熵进行比较。这里，当前状态是缓解后的状态。\n检查为 $E_j(s_j^{\\text{mit}}) > E_j(s_j^{\\text{base}}) + \\varepsilon$。\n由于 $s_j^{\\text{mit}} = s_j^{\\text{base}}$，这等价于 $E_j(s_j^{\\text{base}}) > E_j(s_j^{\\text{base}}) + \\varepsilon$，简化为 $0 > \\varepsilon$。此为假。缓解措施成功地防止了熵增。\n**用例 3 的结果：False。**\n\n最终的布尔值序列是 [False, True, False]。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DG-TVB limiter problem by constructing the counterexample.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    N = 20\n    dx = 1.0 / N\n    x0 = 1.0 / 3.0 + 0.25 * dx\n    epsilon = 1e-12\n    test_suite = [\n        # Case 1: M, apply_mitigation\n        (1e-3, False),\n        # Case 2: M, apply_mitigation\n        (1.0, False),\n        # Case 3: M, apply_mitigation\n        (1.0, True)\n    ]\n\n    # --- Step 1: Compute Initial State (L2 Projection) ---\n    bar_u = np.zeros(N)\n    s = np.zeros(N)\n    j_troubled = -1\n\n    for i in range(N):\n        x_imhalf = i * dx\n        x_iphalf = (i + 1) * dx\n        x_i = (i + 0.5) * dx\n\n        if x_iphalf = x0:\n            # Cell is entirely to the left of the discontinuity\n            bar_u[i] = 1.0\n            s[i] = 0.0\n        elif x_imhalf >= x0:\n            # Cell is entirely to the right of the discontinuity\n            bar_u[i] = 0.0\n            s[i] = 0.0\n        else:\n            # Cell contains the discontinuity\n            j_troubled = i\n            # Integral for the cell average\n            bar_u[i] = (x0 - x_imhalf) / dx\n            # Integral for the slope\n            # Using formula: integral = (b-a) * ((a+b)/2 - xc)\n            # where a=x_imhalf, b=x0, xc=x_i\n            integral_val = (x0 - x_imhalf) * (0.5 * (x_imhalf + x0) - x_i)\n            s[i] = 12.0 / (dx**3) * integral_val\n\n    # Ensure the troubled cell was found\n    if j_troubled == -1:\n        raise ValueError(\"Discontinuity location x0 was not found in any cell.\")\n\n    s_j_unlimited = s[j_troubled]\n    bar_u_j = bar_u[j_troubled]\n\n    # --- Step 2: Compute Baseline (TVD) Limited Slope ---\n    \n    # Periodic indexing\n    j_plus_1 = (j_troubled + 1) % N\n    j_minus_1 = (j_troubled - 1 + N) % N\n\n    delta_plus_bar_u = bar_u[j_plus_1] - bar_u_j\n    delta_minus_bar_u = bar_u_j - bar_u[j_minus_1]\n\n    s_cand_1 = s_j_unlimited\n    s_cand_2 = delta_plus_bar_u / dx\n    s_cand_3 = delta_minus_bar_u / dx\n\n    def minmod(a, b, c):\n        \"\"\"Standard minmod function for three arguments.\"\"\"\n        if a > 0 and b > 0 and c > 0:\n            return min(a, b, c)\n        elif a  0 and b  0 and c  0:\n            return max(a, b, c)\n        else:\n            return 0.0\n            \n    s_j_base = minmod(s_cand_1, s_cand_2, s_cand_3)\n\n    # --- Step 3: Function for Entropy Difference ---\n    def compute_entropy_difference(s_test, s_ref, dx_val):\n        \"\"\"\n        Computes E(s_test) - E(s_ref).\n        Formula derived in solution: dx^3/24 * (s_test^2 - s_ref^2)\n        \"\"\"\n        return (dx_val**3 / 24.0) * (s_test**2 - s_ref**2)\n\n    # --- Step 4: Evaluate Test Cases ---\n    results = []\n    \n    tvb_threshold_quantity = (dx**2) * abs(s_j_unlimited)\n\n    for M, apply_mitigation in test_suite:\n        \n        # Determine the TVB-limited slope\n        if tvb_threshold_quantity = M:\n            s_j_tvb = s_j_unlimited  # No limiting\n        else:\n            s_j_tvb = s_j_base      # Limit\n\n        # Run the detector: does an entropy increase occur with s_j_tvb?\n        entropy_diff_unmitigated = compute_entropy_difference(s_j_tvb, s_j_base, dx)\n        detector_triggered = entropy_diff_unmitigated > epsilon\n        \n        # Determine the final slope after potential mitigation\n        s_j_final = s_j_tvb\n        if apply_mitigation and detector_triggered:\n            s_j_final = s_j_base # Apply fix\n\n        # Check if entropy increase remains with the final slope\n        final_entropy_diff = compute_entropy_difference(s_j_final, s_j_base, dx)\n        increase_remains = final_entropy_diff > epsilon\n        \n        results.append(increase_remains)\n\n    # --- Final Output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}