{
    "hands_on_practices": [
        {
            "introduction": "理解斜率限制器的第一步是掌握其基本工作原理。本练习  聚焦于有限体积法中的一个经典限制器——单调中心（Monotonized Central, MC）限制器。通过推导其如何确保总变差不增（Total Variation Diminishing, TVD）特性，你将深入理解限制器是如何被设计出来以抑制数值伪振荡的。",
            "id": "3414647",
            "problem": "考虑标量线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a > 0$ 为常数，方程定义在均匀网格上，网格中心为 $x_{i}$，网格宽度为 $\\Delta x$。令 $u_{i}$ 表示 $u$ 在第 $i$ 个网格上的网格平均值。在网格 $i$ 内的二阶精确分段线性重构由 $u_{i}(x) = u_{i} + \\sigma_{i}\\,\\frac{x - x_{i}}{\\Delta x}$ 给出，其中 $\\sigma_{i}$ 是一个待确定的受限斜率。从网格 $i$ 重构的左右界面状态为 $u_{i+1/2}^{-} = u_{i} + \\frac{1}{2}\\sigma_{i}$ 和 $u_{i-1/2}^{+} = u_{i} - \\frac{1}{2}\\sigma_{i}$。使用迎风数值通量 $F(u) = a\\,u$（适用于 $a>0$），向前欧拉有限体积更新为\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\lambda \\big(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\big), \\quad \\lambda = \\frac{\\Delta t}{\\Delta x}, \\quad F_{i+1/2}^{n} = a\\,u_{i+1/2}^{-,n},\n$$\n其中 $u_{i+1/2}^{-,n} = u_{i}^{n} + \\frac{1}{2}\\sigma_{i}^{n}$，$u_{i-1/2}^{-,n}$ 也类似。定义单边差分\n$$\nD_{i}^{-} = u_{i} - u_{i-1}, \\qquad D_{i}^{+} = u_{i+1} - u_{i}.\n$$\n如果一个斜率限制器产生的更新 $u_{i}^{n} \\mapsto u_{i}^{n+1}$，在关于 $\\lambda a$ 的 Courant–Friedrichs–Lewy (CFL) 条件下，使得离散总变差\n$$\n\\operatorname{TV}(u^{n}) = \\sum_{i} \\big|u_{i+1}^{n} - u_{i}^{n}\\big|\n$$\n不增加，即 $\\operatorname{TV}(u^{n+1}) \\le \\operatorname{TV}(u^{n})$，则称该斜率限制器是总变差递减 (TVD) 的。单调中心 (MC) 限制器旨在通过对 $\\sigma_{i}$ 强制执行以下容许条件来保持 TVD 特性：\n1. 如果 $D_{i}^{-} D_{i}^{+} \\le 0$，则 $\\sigma_{i} = 0$。\n2. 如果 $D_{i}^{-} D_{i}^{+} > 0$，则 $\\sigma_{i}$ 与 $D_{i}^{-}$ 和 $D_{i}^{+}$ 的符号相同，并且其大小受限于\n$$\n|\\sigma_{i}| \\le \\min\\!\\left\\{\\, 2|D_{i}^{-}|,\\, 2|D_{i}^{+}|,\\, \\left|\\frac{D_{i}^{-} + D_{i}^{+}}{2}\\right| \\right\\}。\n$$\n从上述有限体积更新和迎风通量的定义出发，使用容许条件来证明，在 $0  \\lambda a \\le 1$ 的条件下，用 MC 限制器构造的格式是 TVD 的。然后，对于 MC 限制器，以 $D_{i}^{-}$ 和 $D_{i}^{+}$ 的显式闭合形式计算受限斜率 $\\sigma_{i}$。你的最终答案必须是单一的闭合形式解析表达式。不需要数值近似或四舍五入。",
            "solution": "我们从标量线性平流方程 $u_{t} + a\\,u_{x} = 0$ 及其采用分段线性重构的有限体积离散化开始。对于 $a>0$，迎风通量为 $F(u) = a\\,u$，因此数值界面通量在每个界面处取左侧状态：\n$$\nF_{i+1/2}^{n} = a\\,u_{i+1/2}^{-,n} = a\\left(u_{i}^{n} + \\frac{1}{2}\\sigma_{i}^{n}\\right), \\qquad F_{i-1/2}^{n} = a\\,u_{i-1/2}^{-,n} = a\\left(u_{i-1}^{n} + \\frac{1}{2}\\sigma_{i-1}^{n}\\right).\n$$\n因此，向前欧拉更新为\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\lambda a \\left[\\left(u_{i}^{n} + \\frac{1}{2}\\sigma_{i}^{n}\\right) - \\left(u_{i-1}^{n} + \\frac{1}{2}\\sigma_{i-1}^{n}\\right)\\right] = (1 - \\lambda a)\\,u_{i}^{n} + \\lambda a\\,u_{i-1}^{n} - \\frac{\\lambda a}{2}\\left(\\sigma_{i}^{n} - \\sigma_{i-1}^{n}\\right).\n$$\n定义离散总变差 $\\operatorname{TV}(u^{n}) = \\sum_{i} |u_{i+1}^{n} - u_{i}^{n}|$。为证明该格式是总变差递减 (TVD) 的，只需证明在 $0  \\lambda a \\le 1$ 的条件下，该更新是单调的且不产生新的极值。一个经典的充分条件是利用相邻网格平均值对重构界面值的有界性。我们分析界面重构：\n$$\nu_{i+1/2}^{-} = u_{i} + \\frac{1}{2}\\sigma_{i}, \\qquad u_{i-1/2}^{+} = u_{i} - \\frac{1}{2}\\sigma_{i}.\n$$\nMC 限制器强制执行容许条件：\n1. 如果 $D_{i}^{-} D_{i}^{+} \\le 0$，设置 $\\sigma_{i} = 0$。那么 $u_{i+1/2}^{-} = u_{i}$，它自然地被界定在 $u_{i}$ 和 $u_{i+1}$ 之间。类似地，$u_{i-1/2}^{-} = u_{i-1}$ 被界定在 $u_{i-1}$ 和 $u_{i}$ 之间。\n2. 如果 $D_{i}^{-} D_{i}^{+} > 0$，$\\sigma_{i}$ 的符号一致性以及大小界限\n$$\n|\\sigma_{i}| \\le \\min\\!\\left\\{\\, 2|D_{i}^{-}|,\\, 2|D_{i}^{+}|,\\, \\left|\\frac{D_{i}^{-} + D_{i}^{+}}{2}\\right| \\right\\}\n$$\n意味着界面值位于相邻网格平均值之间。为证明这一点，假设 $D_{i}^{+} > 0$（$D_{i}^{+}  0$ 的情况论证类似）。那么 $u_{i+1} = u_{i} + D_{i}^{+}$，并且界限 $|\\sigma_{i}| \\le 2|D_{i}^{+}|$ 与 $\\sigma_{i}$ 的符号一起可得\n$$\nu_{i+1/2}^{-} = u_{i} + \\frac{1}{2}\\sigma_{i} \\le u_{i} + \\frac{1}{2}\\cdot 2 D_{i}^{+} = u_{i+1}.\n$$\n类似地，如果 $D_{i}^{-} > 0$，则 $u_{i} = u_{i-1} + D_{i}^{-}$ 且 $|\\sigma_{i}| \\le 2|D_{i}^{-}|$ 保证\n$$\nu_{i-1/2}^{+} = u_{i} - \\frac{1}{2}\\sigma_{i} \\ge u_{i} - D_{i}^{-} = u_{i-1}.\n$$\n当 $D_{i}^{-} D_{i}^{+} > 0$ 时，额外的界限 $|\\sigma_{i}| \\le \\left|\\frac{D_{i}^{-} + D_{i}^{+}}{2}\\right|$ 控制中心斜率以防止即使在单边差分高度不平衡时出现过度陡峭，确保 $u_{i+1/2}^{-}$ 和 $u_{i-1/2}^{+}$ 都保持在各自的邻居区间内：\n$$\n\\min\\{u_{i}, u_{i+1}\\} \\le u_{i+1/2}^{-} \\le \\max\\{u_{i}, u_{i+1}\\}, \\qquad \\min\\{u_{i-1}, u_{i}\\} \\le u_{i-1/2}^{+} \\le \\max\\{u_{i-1}, u_{i}\\}.\n$$\n因此，对于所有的 $i$，重构的界面状态都由相邻的网格平均值所界定。对于迎风通量 $F(u) = a\\,u$（当 $a>0$ 时，它对 $u$ 是单调非递减的），以及在 $0  \\lambda a \\le 1$ 条件下的向前欧拉更新，这种有界性意味着格式在离散极值原理的意义上是单调的：不产生新的局部极值，且界面通量在邻居值范围内插值。根据经典的 Harten–Crandall–Tartar 关于单调格式的 TVD 框架，离散总变差不增加，即 $\\operatorname{TV}(u^{n+1}) \\le \\operatorname{TV}(u^{n})$。因此，在 $0  \\lambda a \\le 1$ 的条件下，带有 MC 限制器的格式是 TVD 的。\n\n我们现在根据单边差分 $D_{i}^{-}$ 和 $D_{i}^{+}$ 计算显式的受限斜率 $\\sigma_{i}$。引入带多个参数的 minmod 函数，\n$$\n\\operatorname{minmod}(a_{1}, a_{2}, \\dots, a_{m}) = \n\\begin{cases}\n\\operatorname{sign}(a_{1}) \\min\\limits_{1 \\le j \\le m} |a_{j}|,  \\text{若 } \\operatorname{sign}(a_{1}) = \\operatorname{sign}(a_{2}) = \\cdots = \\operatorname{sign}(a_{m}),\\\\\n0,  \\text{其他情况}.\n\\end{cases}\n$$\nMC 的容许性要求可以通过选择 $\\sigma_{i}$ 为三个候选斜率的 minmod 值来紧凑地实现：一个中心斜率和两倍的单边斜率，所有这些都在均匀网格上进行了一致的缩放。使用 $D_{i}^{-}$ 和 $D_{i}^{+}$，中心斜率为 $\\frac{D_{i}^{-} + D_{i}^{+}}{2}$，缩放后的单边斜率为 $2D_{i}^{-}$ 和 $2D_{i}^{+}$。因此，MC 限制斜率的闭合形式表达式为\n$$\n\\sigma_{i} = \\operatorname{minmod}\\!\\left( \\frac{D_{i}^{-} + D_{i}^{+}}{2},\\, 2 D_{i}^{-},\\, 2 D_{i}^{+} \\right).\n$$\n此表达式满足 MC 限制器所要求的符号一致性和大小界限。如果 $D_{i}^{-} D_{i}^{+} \\le 0$，则参数符号不同，$\\sigma_{i} = 0$。如果 $D_{i}^{-} D_{i}^{+} > 0$，则所有参数符号相同，$\\sigma_{i}$ 取三者中绝对值最小的那个，从而强制\n$$\n|\\sigma_{i}| \\le \\min\\!\\left\\{\\, \\left|\\frac{D_{i}^{-} + D_{i}^{+}}{2}\\right|,\\, 2|D_{i}^{-}|,\\, 2|D_{i}^{+}| \\right\\}。\n$$\n因此，已经推导出了用单边差分表示的显式 MC 限制斜率，并且证明了在 $0  \\lambda a \\le 1$ 条件下的 TVD 性质。",
            "answer": "$$\\boxed{\\operatorname{minmod}\\!\\left(\\frac{D_{i}^{-} + D_{i}^{+}}{2},\\, 2 D_{i}^{-},\\, 2 D_{i}^{+}\\right)}$$"
        },
        {
            "introduction": "虽然限制器在简单网格上表现良好，但在复杂几何形状上会遇到新的挑战。本练习  提供了一个重要的思想实验，揭示了一个常见陷阱：在曲线单元上对非物理的“守恒”变量应用限制器。它强调了确保限制器作用于真实物理量以保持数值解精度的重要性，例如，正确地保持一个均匀的自由流。",
            "id": "3414596",
            "problem": "考虑一维线性平流守恒律 $\\partial_{t} u + a \\, \\partial_{x} u = 0$，其平流速度 $a$ 为常数。该方程在一个弯曲的单等参单元上，通过一阶间断伽辽金(DG)方法进行离散化。物理坐标 $x$ 通过 $x(\\xi) = \\xi + \\alpha \\, \\xi^{2}$ 从参考坐标 $\\xi \\in [-1,1]$ 映射而来，其中 $\\alpha$ 是一个非零曲率参数，映射的雅可比是 $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\, \\xi$。假设精确物理解是一个自由流 $u(x) \\equiv u_{0}$，其中 $u_{0} \\neq 0$ 为常数。在参考单元上的弱守恒形式中，由DG多项式表示的守恒变量是 $q(\\xi) = J(\\xi) \\, u(\\xi)$。\n\n一个全变差递减(TVD) minmod型斜率限制器在参考坐标系中应用于守恒变量 $q(\\xi)$，使用一阶多项式表示 $q(\\xi) = c_{0} + c_{1} \\, \\xi$。限制器重构 $q^{L}(\\xi) = \\bar{q} + s^{L} \\, \\xi$，其中 $\\bar{q}$ 是由 $\\bar{q} = \\frac{1}{2} \\int_{-1}^{1} q(\\xi) \\, d\\xi$ 定义的参考单元平均值，限制前的斜率为 $s = c_{1}$。如果对于给定的阈值 $\\kappa \\in (0,1)$，有 $S = \\frac{|s|}{|\\bar{q}|} > \\kappa$，则激波探测器会触发。当探测器触发时，限制器设置 $s^{L} = 0$ (否则 $s^{L} = s$)。相比之下，一个物理上一致的限制器应在物理坐标系中对 $u(\\xi)$ 而非 $q(\\xi)$ 进行操作。\n\n从这些定义和映射出发，推导用 $\\alpha$ 和 $\\kappa$ 表示的激活条件，解释为什么在参考坐标系中对 $q(\\xi)$ 进行限制会在弯曲单元上使限制器产生偏差并破坏自由流守恒性，并计算当探测器触发且 $s^{L} = 0$ 时最终得到的受限物理解 $u^{L}(\\xi)$。您的最终答案必须是使用给定 $J(\\xi)$ 的 $u^{L}(\\xi)$ 的单一闭式解析表达式。不需要数值近似或舍入，也无需报告单位。",
            "solution": "该问题经证实是合理的、适定的，并且基于守恒律数值方法的既定原则。我们可以开始求解。\n\n该问题考虑一个一维线性平流方程 $\\partial_{t} u + a \\, \\partial_{x} u = 0$，其精确解为自由流 $u(x) = u_{0}$，其中 $u_{0} \\neq 0$ 是一个常数。离散化是在一个弯曲的单单元上，使用一阶间断伽辽金(DG)方法进行的。几何形状由从参考坐标 $\\xi \\in [-1,1]$到物理坐标 $x$ 的映射 $x(\\xi) = \\xi + \\alpha \\, \\xi^{2}$ 定义。该映射的雅可比为 $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2 \\alpha \\, \\xi$。\n\nDG方法对参考单元中守恒变量的多项式表示进行操作，该变量定义为 $q(\\xi) = J(\\xi) \\, u(\\xi)$。由于物理解是一个常数 $u_{0}$，因此参考坐标系中的对应解也是常数 $u(\\xi) = u_{0}$。\n因此，精确的守恒变量为：\n$$q(\\xi) = J(\\xi) u_{0} = (1 + 2 \\alpha \\, \\xi) u_{0} = u_{0} + 2 \\alpha u_{0} \\, \\xi$$\n这是一个关于 $\\xi$ 的线性多项式。\n\n该变量的一阶DG表示为 $q(\\xi) = c_{0} + c_{1} \\, \\xi$。由于 $q(\\xi)$ 的精确表达式已经是一个一阶多项式，所以DG表示是精确的，我们可以通过比较直接确定系数：\n$$c_{0} = u_{0}$$\n$$c_{1} = 2 \\alpha u_{0}$$\n\n一个minmod型斜率限制器被应用于此表示。限制器对参考单元平均值 $\\bar{q}$ 和限制前的斜率 $s$ 进行操作。\n\n首先，我们计算参考单元平均值 $\\bar{q}$：\n$$\\bar{q} = \\frac{1}{2} \\int_{-1}^{1} q(\\xi) \\, d\\xi = \\frac{1}{2} \\int_{-1}^{1} (u_{0} + 2 \\alpha u_{0} \\, \\xi) \\, d\\xi$$\n$$\\bar{q} = \\frac{u_{0}}{2} \\left[ \\xi + \\alpha \\, \\xi^{2} \\right]_{-1}^{1} = \\frac{u_{0}}{2} \\left( (1 + \\alpha) - (-1 + \\alpha) \\right) = \\frac{u_{0}}{2} (2) = u_{0}$$\n或者，使用多项式系数，在对称区间 $[-1,1]$ 上 $c_{0} + c_{1} \\xi$ 的平均值就是 $c_{0}$。因此，$\\bar{q} = c_{0} = u_{0}$。\n\n限制前的斜率 $s$ 由线性项的系数给出，$s = c_{1}$。\n$$s = 2 \\alpha u_{0}$$\n\n激波探测器定义为 $S = \\frac{|s|}{|\\bar{q}|}$，如果对于给定的阈值 $\\kappa \\in (0,1)$，有 $S > \\kappa$，则探测器会触发。我们可以代入我们计算出的 $s$ 和 $\\bar{q}$ 的值：\n$$S = \\frac{|2 \\alpha u_{0}|}{|u_{0}|} = 2 |\\alpha| \\frac{|u_{0}|}{|u_{0}|}$$\n由于 $u_{0} \\neq 0$，这可以简化为：\n$$S = 2 |\\alpha|$$\n因此，限制器的激活条件是 $S > \\kappa$，即：\n$$2 |\\alpha| > \\kappa$$\n\n这个条件揭示了为什么在参考坐标系中对 $q(\\xi)$ 进行限制可能存在问题并破坏自由流守恒性。物理解 $u(x) = u_{0}$ 是一个常数，代表一个完全光滑的自由流。任何物理上一致的数值方法都应精确地保持此解不变。然而，限制器被应用于 $q(\\xi) = J(\\xi) u(\\xi)$。在一个弯曲单元上（$\\alpha \\neq 0$），雅可比 $J(\\xi)$ 不是常数。将常数物理解 $u_{0}$ 乘以空间变化的雅可比 $J(\\xi)$，会得到一个具有非零斜率 $s = 2 \\alpha u_{0}$ 的守恒变量 $q(\\xi)$。限制器错误地将这个纯粹由单元曲率造成的人为斜率解释为解本身的物理梯度或振荡。如果曲率足够大，使得 $2|\\alpha| > \\kappa$，限制器就会被虚假地激活。对一个完全光滑解的这种修改，就是破坏自由流守恒性的定义。一个一致的限制器需要对物理变量 $u(\\xi)$ 进行操作，它会将其重构为 $u(\\xi) = q(\\xi) / J(\\xi) = (u_0 + 2\\alpha u_0 \\xi)/(1+2\\alpha\\xi) = u_0(1+2\\alpha\\xi)/(1+2\\alpha\\xi) = u_0$。这个重构的物理变量的斜率为零，因此一个物理上一致的限制器不会被触发。\n\n最后，我们计算当探测器触发时最终得到的受限物理解 $u^{L}(\\xi)$。根据问题陈述，当探测器触发时，限制器将新斜率设为零，$s^{L} = 0$。受限的守恒变量随后被重构为：\n$$q^{L}(\\xi) = \\bar{q} + s^{L} \\, \\xi$$\n代入 $\\bar{q} = u_{0}$ 和 $s^{L} = 0$：\n$$q^{L}(\\xi) = u_{0} + (0) \\xi = u_{0}$$\n限制器实际上已将守恒变量的表示平坦化为其单元平均值。\n\n为了找到受限物理解 $u^{L}(\\xi)$，我们必须通过除以雅可比，从参考坐标系中的守恒变量转换回来：\n$$u^{L}(\\xi) = \\frac{q^{L}(\\xi)}{J(\\xi)}$$\n代入 $q^{L}(\\xi) = u_{0}$ 和 $J(\\xi) = 1 + 2 \\alpha \\, \\xi$：\n$$u^{L}(\\xi) = \\frac{u_{0}}{1 + 2 \\alpha \\, \\xi}$$\n这是在虚假的限制作用后，单元内部物理解的最终表达式。它不再是常数，这显示了限制器引入的误差。",
            "answer": "$$\\boxed{\\frac{u_{0}}{1 + 2 \\alpha \\, \\xi}}$$"
        },
        {
            "introduction": "现代的激波捕捉方法通常依赖于直接强制施加物理边界（如密度的正定性），而不仅仅是满足TVD属性。这项综合性练习  将引导你为间断Galerkin方法推导、证明并最终实现一个基于矩的限制器。通过这个从理论到代码的完整过程，你将掌握如何从零开始构建一个鲁棒的、保界的限制器。",
            "id": "3414588",
            "problem": "考虑在一维参考单元 $K = [-1,1]$ 上的标量 Discontinuous Galerkin (DG) 近似，该近似以 Legendre 多项式 $\\{P_k(x)\\}_{k=0}^p$ 的分层模态基表示。设多项式为\n$$\nu_h(x) = \\sum_{k=0}^p \\hat{u}_k P_k(x),\n$$\n其中 $\\hat{u}_k \\in \\mathbb{R}$ 是模态系数，$P_k(x)$ 是 $k$ 次 Legendre 多项式。设 $\\{x_i\\}_{i=1}^m$ 是 $m$ 阶 Gauss–Legendre 求积节点。假设我们给定单元上的界 $u_{\\min}, u_{\\max} \\in \\mathbb{R}$，我们希望在求积点上确保保界性质：\n$$\nu_{\\min} \\le u_h(x_i) \\le u_{\\max} \\quad \\text{对于所有 } i \\in \\{1,\\dots,m\\}.\n$$\n\n任务 A (推导)：从模态表示和 Gauss–Legendre 求积节点的定义出发，推导一个基于矩的限制器，该限制器仅重新缩放高于线性的模态，以在求积节点上强制满足边界。推导基于以下假设：$1$ 次投影\n$$\nu^{(1)}(x) = \\hat{u}_0 P_0(x) + \\hat{u}_1 P_1(x)\n$$\n已经满足求积节点上的边界，即\n$$\nu_{\\min} \\le u^{(1)}(x_i) \\le u_{\\max} \\quad \\text{对于所有 } i.\n$$\n你的限制器应该找到一个缩放因子 $\\theta \\in [0,1]$，使得限制后的多项式\n$$\nu_h^{\\text{lim}}(x) = u^{(1)}(x) + \\theta \\left( u_h(x) - u^{(1)}(x) \\right)\n$$\n对所有求积节点 $x_i$ 满足 $u_{\\min} \\le u_h^{\\text{lim}}(x_i) \\le u_{\\max}$，并且限制后的模态系数为\n$$\n\\hat{u}_0^{\\text{lim}} = \\hat{u}_0, \\quad \\hat{u}_1^{\\text{lim}} = \\hat{u}_1, \\quad \\hat{u}_k^{\\text{lim}} = \\theta \\hat{u}_k \\ \\text{对于所有 } k \\ge 2.\n$$\n基于求积节点上的不等式，从第一性原理出发显式推导 $\\theta$。\n\n任务 B (证明)：证明上述限制器对于 $1$ 次多项式是保线性的。也就是说，证明如果 $u_h$ 的次数至多为 $1$，则限制器保持 $u_h$ 不变。\n\n任务 C (实现与验证)：为参考单元 $K=[-1,1]$ 实现所推导的限制器，使用 Gauss–Legendre 节点作为集合 $\\{x_i\\}_{i=1}^m$。你的程序必须：\n- 在给定节点上计算 Legendre 多项式的值。\n- 应用限制器仅缩放次数大于等于 $2$ 的模态。\n- 在 $\\varepsilon = 10^{-12}$ 的容差范围内，验证限制后的多项式是否满足边界。\n- 当 $1$ 次投影在任何求积节点上违反边界时，检测此不可行性；在这种情况下，报告该测试失败。\n\n使用以下测试套件（每个测试提供 $p$、$m$、系数列表 $[\\hat{u}_0,\\hat{u}_1,\\dots,\\hat{u}_p]$ 以及边界 $u_{\\min},u_{\\max}$）：\n- 测试 1 (理想情况，三次多项式带过冲)：$p=3$，$m=10$，系数 $[0.6,\\,0.1,\\,0.8,\\,-0.5]$，$u_{\\min}=0.0$，$u_{\\max}=1.0$。\n- 测试 2 (因线性部分导致不可行)：$p=1$，$m=10$，系数 $[0.9,\\,0.3]$，$u_{\\min}=0.0$，$u_{\\max}=1.0$。\n- 测试 3 (保持线性，在界内)：$p=1$，$m=10$，系数 $[0.4,\\,0.2]$，$u_{\\min}=0.0$，$u_{\\max}=1.0$。\n- 测试 4 (二次过冲被限制器抑制)：$p=2$，$m=10$，系数 $[0.05,\\,0.0,\\,0.9]$，$u_{\\min}=0.0$，$u_{\\max}=1.0$。\n- 测试 5 (在边界处保持线性)：$p=1$，$m=10$，系数 $[0.5,\\,0.5]$，$u_{\\min}=0.0$，$u_{\\max}=1.0$。\n\n你的程序应返回一个布尔值列表，每个测试一个，定义如下：\n- 对于 $p \\ge 2$ 的测试：如果限制器成功并且所有求积节点上的限制后值位于 $[u_{\\min}-\\varepsilon, u_{\\max}+\\varepsilon]$ 内，则返回 $\\text{True}$；否则返回 $\\text{False}$。\n- 对于 $p \\le 1$ 的测试：如果限制器成功并且限制后的系数在容差 $\\varepsilon$ 内等于原始系数（保线性），且求积节点上的值位于 $[u_{\\min}-\\varepsilon, u_{\\max}+\\varepsilon]$ 内，则返回 $\\text{True}$；否则返回 $\\text{False}$。如果 $1$ 次投影在任何求积节点上违反了边界，测试必须返回 $\\text{False}$。\n\n最终输出格式：你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[ \\text{True},\\text{False},\\text{True} ]$）。",
            "solution": "该问题要求对参考单元 $K = [-1,1]$ 上的 Discontinuous Galerkin 近似，推导、证明和实现一个基于矩的限制器。解是使用 Legendre 多项式的模态基构建的。\n\n### 任务 A：缩放因子 $\\theta$ 的推导\n\n给定一个 $p$ 次多项式近似：\n$$\nu_h(x) = \\sum_{k=0}^p \\hat{u}_k P_k(x)\n$$\n目标是在一组 Gauss-Legendre 求积节点 $\\{x_i\\}_{i=1}^m$ 上强制满足边界 $u_{\\min} \\le u_h(x_i) \\le u_{\\max}$。限制器将多项式修改为以下形式：\n$$\nu_h^{\\text{lim}}(x) = u^{(1)}(x) + \\theta \\left( u_h(x) - u^{(1)}(x) \\right)\n$$\n其中 $u^{(1)}(x) = \\hat{u}_0 P_0(x) + \\hat{u}_1 P_1(x)$ 是解的线性部分，$\\theta \\in [0,1]$ 是一个待确定的缩放因子。推导过程基于一个关键假设，即线性部分已经满足所有求积节点上的边界，即对于所有 $i \\in \\{1, \\dots, m\\}$，$u_{\\min} \\le u^{(1)}(x_i) \\le u_{\\max}$。\n\n限制后的解必须在每个求积节点 $x_i$ 上满足边界：\n$$\nu_{\\min} \\le u_h^{\\text{lim}}(x_i) \\le u_{\\max}\n$$\n代入 $u_h^{\\text{lim}}(x_i)$ 的表达式：\n$$\nu_{\\min} \\le u^{(1)}(x_i) + \\theta \\left( u_h(x_i) - u^{(1)}(x_i) \\right) \\le u_{\\max}\n$$\n我们定义线性部分在节点 $x_i$ 的值为 $u^{(1)}_i = u^{(1)}(x_i)$，完整解与其线性部分之差为 $d_i = u_h(x_i) - u^{(1)}_i$。该双重不等式变为：\n$$\nu_{\\min} \\le u^{(1)}_i + \\theta d_i \\le u_{\\max}\n$$\n这可以分解为两个独立的不等式：\n1. $u_{\\min} - u^{(1)}_i \\le \\theta d_i$\n2. $\\theta d_i \\le u_{\\max} - u^{(1)}_i$\n\n我们必须找到满足所有 $i \\in \\{1,\\dots,m\\}$ 的这两个不等式的最大 $\\theta \\in [0,1]$。我们通过考虑 $d_i$ 的符号来分析对 $\\theta$ 的约束。\n\n**情况 1：$d_i > 0$**\n如果 $d_i > 0$，解 $u_h(x_i)$ 大于其线性部分 $u^{(1)}_i$。这对应于可能超过上界 $u_{\\max}$。用正量 $d_i$ 除不等式，方向保持不变：\n- $\\frac{u_{\\min} - u^{(1)}_i}{d_i} \\le \\theta$\n- $\\theta \\le \\frac{u_{\\max} - u^{(1)}_i}{d_i}$\n\n根据初始假设，$u_{\\min} \\le u^{(1)}_i$，这意味着 $u_{\\min} - u^{(1)}_i \\le 0$。由于 $d_i > 0$，$\\theta$ 的下界为非正值，即 $\\frac{u_{\\min} - u^{(1)}_i}{d_i} \\le 0$。由于我们寻求 $\\theta \\in [0,1]$，这个下界被自动满足。此情况下唯一有效的约束是上界：\n$$\n\\theta \\le \\frac{u_{\\max} - u^{(1)}_i}{d_i}\n$$\n\n**情况 2：$d_i  0$**\n如果 $d_i  0$，解 $u_h(x_i)$ 小于其线性部分 $u^{(1)}_i$。这对应于可能低于下界 $u_{\\min}$。用负量 $d_i$ 除不等式，方向反转：\n- $\\frac{u_{\\min} - u^{(1)}_i}{d_i} \\ge \\theta \\implies \\theta \\le \\frac{u_{\\min} - u^{(1)}_i}{d_i}$\n- $\\theta \\ge \\frac{u_{\\max} - u^{(1)}_i}{d_i}$\n\n根据初始假设，$u^{(1)}_i \\le u_{\\max}$，这意味着 $u_{\\max} - u^{(1)}_i \\ge 0$。由于 $d_i  0$，$\\theta$ 的下界为非正值，即 $\\frac{u_{\\max} - u^{(1)}_i}{d_i} \\le 0$。对于任何 $\\theta \\in [0,1]$，这个下界也同样被满足。有效的约束是上界：\n$$\n\\theta \\le \\frac{u_{\\min} - u^{(1)}_i}{d_i}\n$$\n注意，由于 $u_{\\min} - u^{(1)}_i \\le 0$ 且 $d_i  0$，它们的比值为非负，从而为 $\\theta$ 提供了一个有意义的上界。\n\n**情况 3：$d_i = 0$**\n如果 $d_i = 0$，不等式简化为 $u_{\\min} - u^{(1)}_i \\le 0$ 和 $0 \\le u_{\\max} - u^{(1)}_i$。两者都等价于 $u_{\\min} \\le u^{(1)}_i \\le u_{\\max}$，根据我们的初始假设，这是成立的。因此，这种情况对 $\\theta$ 没有施加任何约束。\n\n**合并约束**\n为了同时满足所有求积节点上的边界，$\\theta$ 必须小于或等于所有节点上推导出的所有上界的最小值。设 $S_+ = \\{i \\mid d_i > 0\\}$ 和 $S_- = \\{i \\mid d_i  0\\}$。约束条件是：\n$$\n\\theta \\le \\min_{i \\in S_+} \\left( \\frac{u_{\\max} - u^{(1)}(x_i)}{u_h(x_i) - u^{(1)}(x_i)} \\right) \\quad \\text{和} \\quad \\theta \\le \\min_{i \\in S_-} \\left( \\frac{u_{\\min} - u^{(1)}(x_i)}{u_h(x_i) - u^{(1)}(x_i)} \\right)\n$$\n为了获得保证在 $[0,1]$ 范围内的尽可能大的 $\\theta$（即耗散最小的限制器），我们合并这些约束，并强制 $\\theta \\le 1$。$\\theta$ 的最终表达式为：\n$$\n\\theta = \\min \\left( \\{1\\} \\cup \\left\\{ \\frac{u_{\\max} - u^{(1)}(x_i)}{u_h(x_i) - u^{(1)}(x_i)} \\;\\middle|\\; i \\in S_+ \\right\\} \\cup \\left\\{ \\frac{u_{\\min} - u^{(1)}(x_i)}{u_h(x_i) - u^{(1)}(x_i)} \\;\\middle|\\; i \\in S_- \\right\\} \\right)\n$$\n如果对所有 $i$ 都有 $u_h(x_i) = u^{(1)}(x_i)$，则集合 $S_+$ 和 $S_-$ 均为空。在这种情况下，不需要限制，该公式正确地得出 $\\theta=1$。\n\n限制后的模态系数由下式给出：\n$$\n\\hat{u}_0^{\\text{lim}} = \\hat{u}_0, \\quad \\hat{u}_1^{\\text{lim}} = \\hat{u}_1, \\quad \\hat{u}_k^{\\text{lim}} = \\theta \\hat{u}_k \\ \\text{对于所有 } k \\ge 2.\n$$\n\n### 任务 B：保线性性的证明\n\n如果给定一个次数至多为 $1$ 的输入多项式 $u_h(x)$，限制后的多项式 $u_h^{\\text{lim}}(x)$ 与 $u_h(x)$ 相同，则称该限制器是保线性的。\n\n**证明：**\n假设 $u_h(x)$ 是一个次数至多为 $1$ 的多项式。根据 Legendre 基的定义，这意味着它的表示只包含前两个模态：\n$$\nu_h(x) = \\hat{u}_0 P_0(x) + \\hat{u}_1 P_1(x)\n$$\n所有更高次的系数均为零：对于所有 $k \\ge 2$，$\\hat{u}_k = 0$。\n\n$u_h(x)$ 的 $1$ 次投影根据定义为：\n$$\nu^{(1)}(x) = \\hat{u}_0 P_0(x) + \\hat{u}_1 P_1(x)\n$$\n因此，对于一个次数至多为 $1$ 的多项式 $u_h(x)$，我们有 $u_h(x) = u^{(1)}(x)$ 对所有 $x \\in [-1,1]$ 成立。\n\n限制后的多项式定义为：\n$$\nu_h^{\\text{lim}}(x) = u^{(1)}(x) + \\theta \\left( u_h(x) - u^{(1)}(x) \\right)\n$$\n将 $u_h(x) = u^{(1)}(x)$ 代入此表达式，我们得到：\n$$\nu_h^{\\text{lim}}(x) = u^{(1)}(x) + \\theta \\left( u^{(1)}(x) - u^{(1)}(x) \\right) = u^{(1)}(x) + \\theta \\cdot 0 = u^{(1)}(x)\n$$\n由于 $u_h(x) = u^{(1)}(x)$，我们得出结论：\n$$\nu_h^{\\text{lim}}(x) = u_h(x)\n$$\n这表明限制器保持次数至多为 $1$ 的多项式不变。\n关于系数，对于 $k \\ge 2$，我们有 $\\hat{u}_k = 0$。限制后的系数是 $\\hat{u}_k^{\\text{lim}} = \\theta \\hat{u}_k = \\theta \\cdot 0 = 0$。因此，对于所有 $k$，$\\hat{u}_k^{\\text{lim}} = \\hat{u}_k$。系数也保持不变。证明完毕。\n\n### 任务 C：实现与验证策略\n\n实现将遵循为 $\\theta$ 推导的公式以及处理不同情况的逻辑。针对给定测试用例（$p$、$m$、系数和边界）的核心算法如下：\n\n1.  **生成求积节点**：使用 `numpy.polynomial.legendre.leggauss(m)` 获取区间 $[-1,1]$ 上的 $m$ 个 Gauss-Legendre 求积节点 $\\{x_i\\}$。\n2.  **计算多项式的值**：\n    - 使用给定的系数 $[\\hat{u}_0, \\dots, \\hat{u}_p]$ 在每个节点 $x_i$ 上计算完整多项式 $u_h(x)$ 的值。这可以使用 `numpy.polynomial.legendre.legval` 高效完成。\n    - 使用系数 $[\\hat{u}_0, \\hat{u}_1]$ 在每个节点 $x_i$ 上计算线性部分 $u^{(1)}(x)$ 的值。\n3.  **检查可行性（假设验证）**：\n    - 验证线性部分 $u^{(1)}(x_i)$ 在所有节点 $x_i$ 上满足边界 $u_{\\min} \\le u^{(1)}(x_i) \\le u_{\\max}$。\n    - 如果该假设在任何节点上被违反，则限制器的问题设置无效。该测试用例被视为失败，函数必须报告这一点。\n4.  **处理线性情况（$p \\le 1$）**：\n    - 如果次数 $p$ 至多为 $1$，$u_h(x) = u^{(1)}(x)$。上一步的可行性检查就足够了。如果 $u^{(1)}$ 在界内，则测试通过（因为限制器是保线性的，$\\theta=1$，没有发生变化）。如果不在界内，则测试失败。\n5.  **计算缩放因子 $\\theta$（对于 $p \\ge 2$）**：\n    - 对所有 $i$ 计算差值 $d_i = u_h(x_i) - u^{(1)}(x_i)$。\n    - 如果所有 $d_i$ 都近似为零，则不需要限制；设置 $\\theta=1$。\n    - 否则，遍历节点并根据 $d_i$ 的符号计算 $\\theta$ 上界的比率，如任务 A 中所推导。\n    - 通过取 $1.0$ 和所有计算出的比率的最小值来确定 $\\theta$。\n6.  **应用限制器并验证**：\n    - 计算限制后的多项式在节点上的值：$u_h^{\\text{lim}}(x_i) = u^{(1)}(x_i) + \\theta d_i$。\n    - 使用给定的容差 $\\varepsilon = 10^{-12}$，检查是否对所有节点 $x_i$ 都有 $u_{\\min} - \\varepsilon \\le u_h^{\\text{lim}}(x_i) \\le u_{\\max} + \\varepsilon$。\n7.  **返回结果**：根据检查结果，对于成功且验证通过的测试返回 `True`，否则根据问题陈述中列出的具体规则返回 `False`。\n\n这个系统化的过程正确地实现了推导的理论，并处理了所有指定的测试条件和边缘情况。",
            "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss, legval\n\ndef process_case(p: int, m: int, coeffs: list, u_min: float, u_max: float, tol: float) -> bool:\n    \"\"\"\n    Applies and verifies the moment-based limiter for a single test case.\n\n    Args:\n        p: Polynomial degree.\n        m: Number of quadrature nodes.\n        coeffs: List of modal Legendre coefficients [u_0, u_1, ..., u_p].\n        u_min: Lower bound for the solution.\n        u_max: Upper bound for the solution.\n        tol: Numerical tolerance for comparisons.\n\n    Returns:\n        True if the test passes according to the problem criteria, False otherwise.\n    \"\"\"\n    # Ensure coeffs is a numpy array for easier slicing and calculations\n    u_coeffs = np.array(coeffs, dtype=float)\n\n    # Step 1: Get Gauss-Legendre quadrature nodes\n    # leggauss returns nodes and weights; we only need the nodes.\n    x_nodes, _ = leggauss(m)\n\n    # Step 2: Evaluate polynomials at the nodes\n    u_h_vals = legval(x_nodes, u_coeffs)\n    \n    # The linear part u^(1) has coefficients [u_0, u_1]\n    # For p=0, coeffs is [u_0]. We need to handle this by padding.\n    if p == 0:\n        u1_coeffs = np.array([u_coeffs[0], 0.0])\n    else:\n        u1_coeffs = u_coeffs[:2]\n    u1_vals = legval(x_nodes, u1_coeffs)\n\n    # Step 3: Check feasibility of the degree-1 projection\n    if np.any(u1_vals  u_min - tol) or np.any(u1_vals > u_max + tol):\n        # The assumption that the linear part is within bounds is violated.\n        return False\n\n    # Step 4: Handle linear cases (p = 1)\n    if p = 1:\n        # For p = 1, u_h = u^(1). We've already checked if it's within bounds.\n        # The limiter should be inactive (theta=1), preserving the solution.\n        # The problem requires checking that limited coeffs == original coeffs.\n        # This is equivalent to checking if no limiting was needed.\n        # If u^(1) is in bounds, the test passes.\n        return True\n\n    # Step 5: Calculate scaling factor theta for p >= 2\n    theta = 1.0\n    d_vals = u_h_vals - u1_vals\n    \n    ratios = []\n    for i in range(m):\n        d_i = d_vals[i]\n        u1_i = u1_vals[i]\n        \n        if d_i > tol: # potential overshoot\n            ratios.append((u_max - u1_i) / d_i)\n        elif d_i  -tol: # potential undershoot\n            ratios.append((u_min - u1_i) / d_i)\n    \n    if ratios:\n        # Theta must be non-negative.\n        # Ratios derived from valid assumptions should be non-negative.\n        # Adding max(0,...) ensures robustness against floating point issues.\n        theta = min(1.0, max(0.0, min(ratios)))\n\n    # Step 6: Apply limiter and verify the result\n    u_lim_vals = u1_vals + theta * d_vals\n    \n    # Verify if the limited solution is within the bounds [u_min, u_max]\n    # with the specified tolerance.\n    is_within_bounds = np.all((u_lim_vals >= u_min - tol)  (u_lim_vals = u_max + tol))\n    \n    return is_within_bounds\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test suite from the problem statement\n    test_cases = [\n        # p, m, coefficients, u_min, u_max\n        (3, 10, [0.6, 0.1, 0.8, -0.5], 0.0, 1.0),   # Test 1\n        (1, 10, [0.9, 0.3], 0.0, 1.0),              # Test 2\n        (1, 10, [0.4, 0.2], 0.0, 1.0),              # Test 3\n        (2, 10, [0.05, 0.0, 0.9], 0.0, 1.0),        # Test 4\n        (1, 10, [0.5, 0.5], 0.0, 1.0),              # Test 5\n    ]\n\n    tolerance = 1e-12\n    results = []\n    \n    for case in test_cases:\n        p, m, coeffs, u_min, u_max = case\n        result = process_case(p, m, coeffs, u_min, u_max, tolerance)\n        results.append(result)\n\n    # Format output as a list of capitalized booleans\n    formatted_results = [str(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}