{
    "hands_on_practices": [
        {
            "introduction": "强稳定性保持（SSP）方法的有效性由其SSP系数$C$来量化，该系数决定了在保持稳定性的前提下，方法允许的最大时间步长。本练习提供了一个基础的理论实践，旨在推导一个特定方法类的最大可能SSP系数。通过对一个三步线性多步格式施加相容性和非负性约束，您将以线性规划的视角探索这些方法的理论极限。",
            "id": "3420318",
            "problem": "考虑一个标量双曲守恒律的线路法半离散化，该离散化采用间断伽辽金 (DG) 空间离散化，并且在前向欧拉时间步进下是单调的，其时间步长限制为 $h \\leq h_{\\mathrm{FE}}$。也就是说，对于半离散系统 $\\frac{\\mathrm{d}}{\\mathrm{d}t} y(t) = f(y(t))$，当 $h \\leq h_{\\mathrm{FE}}$ 时，前向欧拉更新 $y^{n+1} = y^{n} + h f(y^{n})$ 是单调的。一个显式三步线性多步法的形式如下\n$$\ny^{n+1} = a_{0} y^{n} + a_{1} y^{n-1} + a_{2} y^{n-2} + h\\big(b_{0} f(y^{n}) + b_{1} f(y^{n-1}) + b_{2} f(y^{n-2})\\big).\n$$\n该方法的强稳定性保持 (SSP) 系数 $C$ 是使得该方法在类 CFL 限制 $h \\leq C\\,h_{\\mathrm{FE}}$ 下是单调的最大值，前提是该方法可以写成应用于先前已有解值的前向欧拉步的凸组合。在与凸组合和前向欧拉子步相关的系数为非负的充分 SSP 条件下，该方法必须满足 $a_{j} \\geq 0$，$b_{j} \\geq 0$（对于 $j \\in \\{0,1,2\\}$），并且必须存在 $r \\geq 0$ 使得 $a_{j} - r b_{j} \\geq 0$（对于 $j \\in \\{0,1,2\\}$）。通过要求对 $y(t) = 1$ 和 $y(t) = t$ 精确，施加一阶相容性，得到约束条件 $\\sum_{j=0}^{2} a_{j} = 1$ 和 $\\sum_{j=0}^{2} b_{j} = 1 + \\sum_{j=0}^{2} j a_{j}$。\n\n将寻找此三步、一阶、显式 SSP 线性多步法的最大 SSP 系数 $C$ 的问题建立为一个线性规划，即对于一个固定的 $r$，其可行性由关于未知系数的线性不等式和等式确定。然后精确求解这个优化问题，以确定在这些非负性和相容性约束下可实现的最大 $C$ 值。你的最终答案必须是一个精确的数字，不要四舍五入。最终答案无需单位。",
            "solution": "问题要求解一类三步显式线性多步法的最大强稳定性保持 (SSP) 系数 $C$。该方法必须是一阶相容的，并满足一组成为 SSP 的充分条件。\n\n首先，我们将该优化问题形式化。变量是方法系数 $a_0, a_1, a_2, b_0, b_1, b_2$ 和 SSP 系数 $C$。我们的目标是在给定约束下最大化 $C$。\n\n该方法由以下公式给出：\n$$ y^{n+1} = \\sum_{j=0}^{2} a_{j} y^{n-j} + h\\sum_{j=0}^{2} b_{j} f(y^{n-j}) $$\n\n约束条件如下：\n1.  一阶相容性：\n    a. 对 $y(t) = 1$ 精确： $\\sum_{j=0}^{2} a_{j} = 1$。我们称之为 (C1)。\n    b. 对 $y(t) = t$ 精确： $\\sum_{j=0}^{2} b_{j} = 1 + \\sum_{j=0}^{2} j a_{j} = 1 + a_1 + 2a_2$。我们称之为 (C2)。\n\n2.  充分 SSP 条件：\n    a. 凸组合中系数的非负性： $a_{j} \\geq 0$ 对于 $j \\in \\{0,1,2\\}$。我们称之为 (S1)。\n    b. 前向欧拉步系数的非负性： $b_{j} \\geq 0$ 对于 $j \\in \\{0,1,2\\}$。我们称之为 (S2)。\n    c. 存在一个参数 $r \\geq 0$ 使得 $a_{j} - r b_{j} \\geq 0$ 对于 $j \\in \\{0,1,2\\}$。这个参数 $r$ 就是 SSP 系数，我们记为 $C$。因此，$a_j - C b_j \\ge 0$ 对于 $j \\in \\{0,1,2\\}$，并且我们寻求最大化 $C \\geq 0$。我们称之为 (S3)。\n\n问题要求将此问题表述为一个线性规划，其中 SSP 系数（在问题描述中记为 $r$）为固定值。我们固定 $C = C_{\\text{fixed}} > 0$。问题就变成了一个可行性问题：寻找是否存在满足所有约束条件的系数 $\\{a_j, b_j\\}_{j=0}^2$。这可以通过设置一个任意的常数目标函数（例如，最大化 $0$）来表示为一个线性规划。\n\n对于固定的 $C_{\\text{fixed}}$，线性规划如下：\n求解 $a_0, a_1, a_2, b_0, b_1, b_2$。\n目标：最大化 $0$。\n约束条件：\n- $a_0 + a_1 + a_2 = 1$\n- $b_0 + b_1 + b_2 - a_1 - 2 a_2 = 1$\n- $a_j \\geq 0$ 对于 $j \\in \\{0, 1, 2\\}$\n- $b_j \\geq 0$ 对于 $j \\in \\{0, 1, 2\\}$\n- $a_j - C_{\\text{fixed}} b_j \\geq 0$ 对于 $j \\in \\{0, 1, 2\\}$\n\n总体目标是找到使该线性规划可行的 $C$ 的最大值。我们可以解析地求解这个优化问题。\n\n让我们结合这些约束来推导 $C$ 的一个上界。\n从 (S3)，我们有 $a_j \\geq C b_j$ 对于每个 $j \\in \\{0, 1, 2\\}$。\n将此不等式对 $j=0, 1, 2$ 求和：\n$$ \\sum_{j=0}^{2} a_j \\geq \\sum_{j=0}^{2} C b_j = C \\sum_{j=0}^{2} b_j $$\n现在，我们将相容性条件 (C1) 和 (C2) 代入此不等式：\n$$ 1 \\geq C (1 + a_1 + 2a_2) $$\n因为我们要最大化 $C$，可以假设 $C > 0$。为使此不等式成立，必须有 $1 + a_1 + 2a_2 > 0$。条件 (S1) 要求 $a_1 \\geq 0$ 和 $a_2 \\geq 0$，因此这个条件总是满足的。我们可以整理该不等式以找到 $C$ 的一个上界：\n$$ C \\leq \\frac{1}{1 + a_1 + 2a_2} $$\n任何给定形式的方法都必须满足此不等式。为了找到 $C$ 的最大可能值，我们必须找到最紧的上界。这可以通过最大化左侧的表达式来实现，这等价于最小化其分母 $g(a_1, a_2) = 1 + a_1 + 2a_2$。\n\n$g(a_1, a_2)$ 的最小化受限于系数 $a_j$ 的约束。从 (S1) 可知，$a_1 \\geq 0$ 和 $a_2 \\geq 0$。从 (C1) 和 (S1) 可知，$a_0 = 1 - a_1 - a_2 \\geq 0$，这意味着 $a_1 + a_2 \\leq 1$。变量 $(a_1, a_2)$ 的定义域是平面上一个以 $(0,0)$、$(1,0)$ 和 $(0,1)$ 为顶点的闭合有界三角形。函数 $g(a_1, a_2)$ 是 $a_1$ 和 $a_2$ 的线性函数。线性函数在凸多边形上的最小值必然出现在其顶点之一。我们在每个顶点上计算 $g$ 的值：\n- 在 $(a_1, a_2) = (0,0)$ 处：$g(0,0) = 1 + 0 + 2(0) = 1$。\n- 在 $(a_1, a_2) = (1,0)$ 处：$g(1,0) = 1 + 1 + 2(0) = 2$。\n- 在 $(a_1, a_2) = (0,1)$ 处：$g(0,1) = 1 + 0 + 2(1) = 3$。\n\n分母 $1 + a_1 + 2a_2$ 的最小值为 $1$，这在 $a_1 = 0$ 和 $a_2 = 0$ 时取得。\n将这个最小值代入 $C$ 的不等式，我们得到上界的最大可能值：\n$$ C \\leq \\frac{1}{1} = 1 $$\n这表明指定类别中的任何方法都不可能有一个大于 $1$ 的 SSP 系数。\n\n为了证明 $1$ 确实是可实现的最大 SSP 系数，我们必须证明存在一组系数 $\\{a_j, b_j\\}$，对于 $C=1$ 满足所有给定条件。让我们尝试使用得到该上界的值来构造这样一个方法：\n设 $C=1$。根据我们的最小化过程，我们应该选择 $a_1=0$ 和 $a_2=0$。\n由 (C1) 可得，$a_0 = 1 - a_1 - a_2 = 1 - 0 - 0 = 1$。\n所以，我们有 $a_0 = 1, a_1 = 0, a_2 = 0$。\n\n现在我们必须找到满足其余约束条件的系数 $b_j$：\n- (S2)： $b_j \\geq 0$ 对于 $j \\in \\{0, 1, 2\\}$。\n- (S3) 当 $C=1$ 时： $a_j \\geq b_j$。\n    - 对于 $j=0$：$1 \\geq b_0$。\n    - 对于 $j=1$：$0 \\geq b_1$。\n    - 对于 $j=2$：$0 \\geq b_2$。\n- (C2)： $\\sum_{j=0}^{2} b_j = 1 + a_1 + 2a_2 = 1 + 0 + 2(0) = 1$。\n\n从 $b_1 \\geq 0$ 和 $0 \\geq b_1$，我们必须有 $b_1 = 0$。\n类似地，从 $b_2 \\geq 0$ 和 $0 \\geq b_2$，我们必须有 $b_2 = 0$。\n将这些代入 (C2) 的求和式中：\n$b_0 + 0 + 0 = 1 \\implies b_0 = 1$。\n\n我们来验证这组系数： $a_0=1, a_1=0, a_2=0$ 和 $b_0=1, b_1=0, b_2=0$，当 $C=1$ 时。\n- (C1)： $1+0+0 = 1$。(成立)\n- (C2)： $b_0+b_1+b_2=1+0+0 = 1$ 且 $1+a_1+2a_2=1+0+2(0)=1$。(成立)\n- (S1)： $a_j \\geq 0$。(成立)\n- (S2)： $b_j \\geq 0$。(成立)\n- (S3)： $a_0 - Cb_0 = 1 - 1(1) = 0 \\geq 0$。 $a_1 - Cb_1 = 0 - 1(0) = 0 \\geq 0$。 $a_2 - Cb_2 = 0 - 1(0) = 0 \\geq 0$。(成立)\n\n所有条件都满足了。与这些系数对应的方法是：\n$$ y^{n+1} = 1 \\cdot y^n + h(1 \\cdot f(y^n)) = y^n + hf(y^n) $$\n这就是前向欧拉法。根据问题的定义，前向欧拉法在 $h \\leq h_{\\mathrm{FE}}$ 时是单调的，这意味着其 SSP 系数为 $C=1$。\n\n由于我们已经证明了对于指定类别中的任何方法都有 $C \\leq 1$，并且我们已经显式地构造了一个 $C=1$ 的方法，因此可实现的最大 SSP 系数为 $1$。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "从理论基础转向实际应用，SSP方法的主要动机是保持非线性稳定性，例如总变差递减（TVD）特性。对于包含激波或间断的对流问题，TVD特性对于无振荡地捕捉锐利锋面至关重要。在这个编码练习中，您将通过数值实验来直观、定量地验证这一关键性质。通过将一个高阶SSP方法与一个同阶的非SSP方法（经典的四阶龙格-库塔法）进行对比，您将直接观察到它们在处理间断解时的显著行为差异。",
            "id": "3420259",
            "problem": "考虑周期性域上的标量线性平流方程，\n$$u_t + a\\,u_x = 0,$$\n该方程定义在区间 $[0,1]$ 上，具有周期性边界条件和恒定的平流速度 $a>0$。将空间域离散为 $N$ 个宽度为 $\\Delta x = \\frac{1}{N}$ 的均匀网格，并考虑采用零次多项式（分片常数基）的间断 Galerkin (DG) 格式，以及迎风数值通量。使用以下基本要素，从 DG 弱形式推导出网格平均值的半离散常微分方程：\n- 采用分片常数基函数的 DG 方法的定义，\n- 在网格界面上构造与 $a>0$ 的迎风格式一致的数值通量，\n- 在通量计算中解释的周期性边界条件。\n\n使用推导出的半离散算子，实现两种显式时间积分器：\n- 三阶三步强稳定性保持龙格-库塔方法 (SSPRK($3,3$))，基于其在前向欧拉法在时间步长限制下稳定时可表示为前向欧拉步的凸组合这一性质，\n- 一种可比较的非强稳定性保持方法，即经典的四阶显式龙格-库塔方法 (RK4)。\n\n将时间 $t^n$ 时网格平均值的离散全变分定义为\n$$TV(u^n) = \\sum_{i=0}^{N-1} \\left|u_{i+1}^n - u_i^n\\right|,$$\n采用周期性索引，使得 $u_N^n = u_0^n$。\n\n您的任务是通过对半离散系统进行时间推进积分，数值验证 SSPRK($3,3$) 的全变分递减 (TVD) 特性，并展示 RK4 对该特性的违背。对于每个时间步，计算 $TV(u^n)$ 并检查序列 $\\{TV(u^n)\\}_{n\\ge 0}$ 是否为非增序列，即在小的数值容差范围内，$TV(u^{n+1}) \\le TV(u^n)$。\n\n使用以下测试套件，每个套件由 $N$、库朗数 $\\nu = \\frac{a\\,\\Delta t}{\\Delta x}$（其中 $a=1$）、时间步数 $n_\\text{steps}$ 以及初始数据指定：\n- 测试用例 1（粗分辨率下带尖锐间断的顺利情况）：$N=50$，$\\nu=0.99$，$n_\\text{steps}=12$，初始数据\n  $$u(x,0) = \\begin{cases}\n  0   \\text{若 } x \\in [0,0.45),\\\\\n  1   \\text{若 } x \\in [0.45,0.55),\\\\\n  0   \\text{若 } x \\in [0.55,1),\n  \\end{cases}$$\n  在周期性边界条件下按网格进行解释。\n- 测试用例 2（中等分辨率方波脉冲）：$N=200$，$\\nu=0.90$，$n_\\text{steps}=20$，初始数据\n  $$u(x,0) = \\begin{cases}\n  1   \\text{若 } x \\in [0.30,0.70),\\\\\n  0   \\text{其他情况},\n  \\end{cases}$$\n  在周期性边界条件下按网格进行解释。\n- 测试用例 3（三阶分片常数）：$N=100$，$\\nu=1.00$，$n_\\text{steps}=15$，初始数据\n  $$u(x,0) = \\begin{cases}\n  -0.5   \\text{若 } x \\in [0.00,0.20),\\\\\n  1.0    \\text{若 } x \\in [0.20,0.50),\\\\\n  0.0    \\text{若 } x \\in [0.50,1.00),\n  \\end{cases}$$\n  在周期性边界条件下按网格进行解释。\n\n对每个测试用例，计算两个布尔输出：\n- 一个布尔值，指示 SSPRK($3,3$) 方法是否在所有时间步内产生了非增的全变分序列，\n- 一个布尔值，指示 RK4 方法是否在所有时间步内产生了非增的全变分序列。\n\n最终的时间步长必须满足 $\\Delta t = \\nu\\,\\Delta x/a$。程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试结果是一个双元素列表 $[b_\\text{SSP}, b_\\text{RK4}]$。对于上述三个测试用例，最终输出格式必须为\n$$[\\,[b_{1,\\text{SSP}},b_{1,\\text{RK4}}],\\,[b_{2,\\text{SSP}},b_{2,\\text{RK4}}],\\,[b_{3,\\text{SSP}},b_{3,\\text{RK4}}]\\,],$$\n其中布尔值以相应编程语言的原生布尔字面量打印。本问题不涉及物理单位或角度；所有量均为无量纲量。",
            "solution": "本问题旨在数值研究两种时间积分方案——SSPRK($3,3$) 和经典 RK4——在应用于线性平流方程的半离散化时，其全变分递减 (TVD) 的性质。空间离散化采用的是间断 Galerkin (DG) 方法，基函数为分片常数 ($p=0$)，并使用迎风通量。\n\n**1. 使用间断 Galerkin 方法进行半离散化**\n\n控制偏微分方程 (PDE) 为线性平流方程：\n$$\nu_t + a\\,u_x = 0\n$$\n该方程定义在域 $[0,1]$ 上，具有周期性边界条件和恒定的平流速度 $a0$。\n\n将域划分为 $N$ 个网格 $I_i = [x_{i-1/2}, x_{i+1/2}]$（$i=0, \\dots, N-1$），每个网格的宽度为 $\\Delta x = 1/N$。网格界面位于 $x_{i+1/2} = (i+1)\\Delta x$。在每个网格 $I_i$ 内，解由一个分片常数函数（多项式次数 $p=0$）来近似：\n$$\nu_h(x,t) = u_i(t) \\quad \\text{for } x \\in I_i\n$$\n值 $u_i(t)$ 代表解在网格 $I_i$ 内的网格平均值。\n\nDG 弱形式通过将 PDE 乘以一个测试函数 $v_h$，在一个网格 $I_i$ 上积分，并对空间项进行分部积分得到：\n$$\n\\int_{I_i} (u_h)_t v_h \\,dx - \\int_{I_i} a\\,u_h (v_h)_x \\,dx + [a\\,u_h v_h]_{x_{i-1/2}}^{x_{i+1/2}} = 0\n$$\n由于基函数和测试函数都是分片常数，因此在网格内部 $(v_h)_x=0$。方程简化为：\n$$\n\\int_{I_i} \\frac{du_i}{dt} v_h \\,dx + \\left( a\\,u_h(x_{i+1/2}, t)v_h(x_{i+1/2}^-) - a\\,u_h(x_{i-1/2}, t)v_h(x_{i-1/2}^+) \\right) = 0\n$$\n在网格界面处的项 $a\\,u_h$ 是间断的，必须用一个单值的数值通量 $\\hat{f}(u_L, u_R)$ 代替，其中 $u_L$ 和 $u_R$ 分别是界面左右两侧的状态。对于物理通量 $f(u) = au$，弱形式变为：\n$$\n\\int_{I_i} \\frac{du_i}{dt} v_h \\,dx + \\left( \\hat{f}(u_h(x_{i+1/2}^-), u_h(x_{i+1/2}^+)) v_h(x_{i+1/2}^-) - \\hat{f}(u_h(x_{i-1/2}^-), u_h(x_{i-1/2}^+)) v_h(x_{i-1/2}^+) \\right) = 0\n$$\n选择测试函数 $v_h$ 在网格 $I_i$ 中为 $1$，在其他地方为 $0$，我们有 $v_h(x_{i+1/2}^-) = 1$ 和 $v_h(x_{i-1/2}^+) = 1$。时间导数的积分为 $\\Delta x \\frac{du_i}{dt}$。界面处的状态为 $u_h(x_{i+1/2}^-) = u_i$，$u_h(x_{i+1/2}^+) = u_{i+1}$，$u_h(x_{i-1/2}^-) = u_{i-1}$ 以及 $u_h(x_{i-1/2}^+) = u_i$。这导致：\n$$\n\\Delta x \\frac{du_i}{dt} + \\hat{f}(u_i, u_{i+1}) - \\hat{f}(u_{i-1}, u_i) = 0\n$$\n问题指定了当 $a > 0$ 时的迎风通量，即 $\\hat{f}(u_L, u_R) = f(u_L) = a u_L$。将此应用于我们的界面：\n- 在 $x_{i+1/2}$ 处：$\\hat{f}(u_i, u_{i+1}) = a u_i$。\n- 在 $x_{i-1/2}$ 处：$\\hat{f}(u_{i-1}, u_i) = a u_{i-1}$。\n\n将这些通量代入方程得到：\n$$\n\\Delta x \\frac{du_i}{dt} + a u_i - a u_{i-1} = 0\n$$\n整理后，我们得到网格平均值的半离散常微分方程组 (ODEs)：\n$$\n\\frac{du_i}{dt} = -\\frac{a}{\\Delta x} (u_i - u_{i-1})\n$$\n采用周期性索引，使得 $u_{-1} \\equiv u_{N-1}$。这就是著名的一阶迎风有限差分格式。我们可以将该系统写成向量形式 $\\frac{d\\mathbf{u}}{dt} = L(\\mathbf{u})$，其中 $\\mathbf{u} = [u_0, u_1, \\dots, u_{N-1}]^T$ 且 $(L(\\mathbf{u}))_i = -\\frac{a}{\\Delta x} (u_i - u_{i-1})$。\n\n**2. 时间积分方案**\n\n将前向欧拉法应用于此系统，$u_i^{n+1} = u_i^n + \\Delta t L(u^n)_i$，得到：\n$$\nu_i^{n+1} = u_i^n - \\frac{a \\Delta t}{\\Delta x}(u_i^n - u_{i-1}^n) = (1-\\nu)u_i^n + \\nu u_{i-1}^n\n$$\n其中 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 是库朗数。如果 $0 \\le \\nu \\le 1$，该格式是 TVD 的。\n\n**a) 强稳定性保持龙格-库塔 (SSPRK(3,3))**\n这种三阶三步方法旨在保持前向欧拉法的稳定性性质，如 TVD。其公式为：\n$$\n\\mathbf{u}^{(1)} = \\mathbf{u}^n + \\Delta t L(\\mathbf{u}^n)\n$$\n$$\n\\mathbf{u}^{(2)} = \\frac{3}{4} \\mathbf{u}^n + \\frac{1}{4} \\left( \\mathbf{u}^{(1)} + \\Delta t L(\\mathbf{u}^{(1)}) \\right)\n$$\n$$\n\\mathbf{u}^{n+1} = \\frac{1}{3} \\mathbf{u}^n + \\frac{2}{3} \\left( \\mathbf{u}^{(2)} + \\Delta t L(\\mathbf{u}^{(2)}) \\right)\n$$\nSSPRK($3,3$) 可以看作是前向欧拉步的凸组合。如果前向欧拉法是 TVD 的，并且时间步满足 $\\Delta t \\le c \\cdot \\Delta t_{\\text{FE,TVD}}$（其中 $c$ 是 SSP 系数），那么它就是 TVD 的。对于此方案，$c=1$。因此，对于我们的半离散化，只要 $\\nu \\le 1$，SSPRK($3,3$) 就有望是 TVD 的。所有测试用例都满足此条件。\n\n**b) 经典四阶龙格-库塔 (RK4)**\n标准 RK4 方法由以下公式给出：\n$$\n\\mathbf{k}_1 = L(\\mathbf{u}^n)\n$$\n$$\n\\mathbf{k}_2 = L(\\mathbf{u}^n + \\frac{\\Delta t}{2} \\mathbf{k}_1)\n$$\n$$\n\\mathbf{k}_3 = L(\\mathbf{u}^n + \\frac{\\Delta t}{2} \\mathbf{k}_2)\n$$\n$$\n\\mathbf{k}_4 = L(\\mathbf{u}^n + \\Delta t \\mathbf{k}_3)\n$$\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\frac{\\Delta t}{6} (\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\nRK4 不是一种 SSP 方法。它不保证对非线性问题甚至是具有非光滑解的线性问题是 TVD 的，因为它可能在间断附近引入伪振荡，从而增加全变分。\n\n**3. 全变分和数值验证**\n\n离散全变分定义为：\n$$\nTV(\\mathbf{u}^n) = \\sum_{i=0}^{N-1} |u_{i+1}^n - u_i^n|\n$$\n其中周期性索引意味着 $u_N^n = u_0^n$。如果对于所有 $n$ 都有 $TV(\\mathbf{u}^{n+1}) \\le TV(\\mathbf{u}^n)$，则该格式是 TVD 的。为了进行数值验证，我们将在每个时间步为 SSPRK($3,3$) 和 RK4 检查此条件。由于浮点运算，检查实现为 $TV(\\mathbf{u}^{n+1}) \\le TV(\\mathbf{u}^n) + \\epsilon$，其中 $\\epsilon$ 是一个很小的容差（例如，$10^{-12}$）。每个方法都有一个布尔标志，用于记录在整个模拟过程中 TVD 属性是否保持。\n\n实现过程将首先为每个测试用例定义初始条件，建立空间算子 $L(\\mathbf{u})$，然后使用每种时间积分方案迭代指定的步数，并在每一步检查全变分。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running three test cases to verify the TVD property\n    of SSPRK(3,3) and the violation of this property by RK4 for a DG-discretized\n    advection equation.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"N\": 50, \"nu\": 0.99, \"n_steps\": 12,\n            \"u0_func\": lambda x: np.where((x = 0.45)  (x  0.55), 1.0, 0.0)\n        },\n        {\n            \"N\": 200, \"nu\": 0.90, \"n_steps\": 20,\n            \"u0_func\": lambda x: np.where((x = 0.30)  (x  0.70), 1.0, 0.0)\n        },\n        {\n            \"N\": 100, \"nu\": 1.00, \"n_steps\": 15,\n            \"u0_func\": lambda x: np.select(\n                [x  0.20, (x = 0.20)  (x  0.50), x = 0.50],\n                [-0.5, 1.0, 0.0]\n            )\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        N = params[\"N\"]\n        nu = params[\"nu\"]\n        n_steps = params[\"n_steps\"]\n        u0_func = params[\"u0_func\"]\n        \n        # SSPRK(3,3) and RK4 have different stability regions for advection.\n        # However, the problem sets nu = 1, which for the first-order upwind\n        # operator is within the stability regions of both methods.\n        b_ssp, b_rk4 = run_test_case(N, nu, n_steps, u0_func)\n        results.append([b_ssp, b_rk4])\n\n    # Convert native Python bools to lowercase strings for the final output.\n    # The problem description's example `[b_SSP, b_RK4]` suggests a list of lists of booleans,\n    # which in Python's f-string formatting would be `[[True, False], ...]`.\n    # Let's adjust to match the required `print` format.\n    formatted_results = [f\"[{str(r[0])}, {str(r[1])}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\ndef get_spatial_operator(a, dx):\n    \"\"\"Returns the spatial operator L(u) for the semi-discretization.\"\"\"\n    def L(u):\n        # u_i - u_{i-1} with periodic boundaries\n        diff = u - np.roll(u, 1)\n        return -a / dx * diff\n    return L\n    \ndef total_variation(u):\n    \"\"\"Computes the total variation of a 1D array with periodic boundaries.\"\"\"\n    return np.sum(np.abs(u - np.roll(u, -1)))\n\ndef run_test_case(N, nu, n_steps, u0_func):\n    \"\"\"\n    Runs a single test case for both SSPRK(3,3) and RK4, checking the TVD property.\n\n    Returns:\n        A tuple of two booleans: (ssp_is_tvd, rk4_is_tvd)\n    \"\"\"\n    a = 1.0\n    dx = 1.0 / N\n    dt = nu * dx / a\n\n    # Define cell centers and initial condition\n    x = (np.arange(N) + 0.5) * dx\n    u0 = u0_func(x)\n\n    L = get_spatial_operator(a, dx)\n    \n    # Tolerance for floating point comparison of TV\n    tolerance = 1e-12\n\n    # --- SSPRK(3,3) Simulation ---\n    u_ssp = u0.copy()\n    ssp_is_tvd = True\n    tv_old = total_variation(u_ssp)\n    for _ in range(n_steps):\n        # SSPRK(3,3) steps\n        u1 = u_ssp + dt * L(u_ssp)\n        u2 = 0.75 * u_ssp + 0.25 * (u1 + dt * L(u1))\n        u_ssp = (1/3.0) * u_ssp + (2/3.0) * (u2 + dt * L(u2))\n        \n        tv_new = total_variation(u_ssp)\n        if tv_new > tv_old + tolerance:\n            ssp_is_tvd = False\n        tv_old = tv_new\n\n    # --- RK4 Simulation ---\n    u_rk4 = u0.copy()\n    rk4_is_tvd = True\n    tv_old = total_variation(u_rk4)\n    for _ in range(n_steps):\n        # RK4 steps\n        k1 = L(u_rk4)\n        k2 = L(u_rk4 + 0.5 * dt * k1)\n        k3 = L(u_rk4 + 0.5 * dt * k2)\n        k4 = L(u_rk4 + dt * k3)\n        u_rk4 = u_rk4 + (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n        \n        tv_new = total_variation(u_rk4)\n        if tv_new > tv_old + tolerance:\n            rk4_is_tvd = False\n        tv_old = tv_new\n        \n    return ssp_is_tvd, rk4_is_tvd\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们探讨一个更深入也更微妙的概念：SSP保证的条件性。一个SSP方法能够保持某个稳定性（如正定性或TVD），其前提是简单的前向欧拉法对于同一个常微分方程（ODE）系统本身就具有该性质。本练习将构建一个反例，其中一个非线性源项破坏了这一基本假设，导致形式上的SSP方法也无法保持解的正定性。这个编码任务不仅揭示了SSP方法的局限性，还引导您通过算子分裂的思想，实现一种保持正定性的修正方案，这在科学计算中是一种重要且常用的技术。",
            "id": "3420247",
            "problem": "考虑一维标量线性平流-反应方程的零次多项式（分片常数）半离散间断 Galerkin (DG) 方法，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = S(u),\n$$\n其中 $a \\in \\mathbb{R}$ 是一个常数平流速度，$S(u)$ 是一个逐点应用于网格平均值的非线性源项。在宽度为 $h$ 的均匀网格上，对于 $a \\ge 0$ 使用迎风数值通量的 DG 半离散化，得到关于网格平均未知量向量 $u(t) \\in \\mathbb{R}^N$ 的常微分方程 (ODE)，\n$$\n\\frac{d u_i}{d t} = L_i(u) + S(u_i), \\quad L_i(u) = -\\frac{a}{h}\\left(u_i - u_{i-1}\\right),\n$$\n对于 $i = 0, 1, \\dots, N-1$，并采用周期性索引 $u_{-1} := u_{N-1}$。应用于全算子 $F(u) := L(u) + S(u)$ 的前向欧拉法为\n$$\nu^{n+1} = u^n + \\Delta t \\, F(u^n).\n$$\n强稳定性保持 (SSP) 显式 Runge–Kutta 方法的定义性质是，数值更新可以写成应用于 $F(u)$ 的前向欧拉步的凸组合，这保证了在前向欧拉法于某个时间步长限制下保持的任何凸稳定性性质也能被保持。特别地，如果存在一个系数 $c  0$，使得只要前向欧拉法对于所有 $0 \\le \\Delta t \\le \\Delta t_{\\mathrm{FE}}$ 满足 $\\Phi\\left(u^n + \\Delta t \\, F(u^n)\\right) \\le \\Phi(u^n)$，那么 SSP 方法对于所有 $0 \\le \\Delta t \\le c \\, \\Delta t_{\\mathrm{FE}}$ 也满足 $\\Phi(u^{n+1}) \\le \\Phi(u^n)$，则称该方法相对于凸泛函 $\\Phi(u)$ 是 SSP 的。\n\n本问题要求您在上述 DG 背景下构造一个反例，以表明当非线性源项破坏了前向欧拉法相对于正锥的单调性时，SSP 方法会失效。正锥定义为\n$$\n\\mathcal{C}_+ := \\left\\{ u \\in \\mathbb{R}^N \\,:\\, u_i \\ge 0 \\text{ for all } i \\right\\}.\n$$\n具体来说，取非线性源\n$$\nS(u) = -k \\sqrt{u}, \\quad k > 0,\n$$\n该源项逐分量作用于 $u$，并约定 $S(0) = 0$。在仅含源项的 ODE $\\dot{u} = S(u)$ 下的精确演化会保持非负不变集 $\\mathcal{C}_+$，即如果 $u(0) \\in \\mathcal{C}_+$，则对于所有 $t \\ge 0$ 都有 $u(t) \\in \\mathcal{C}_+$。然而，当 $u$ 足够小时，应用于 $S(u)$ 的前向欧拉法即使对于任意小的时间步长 $\\Delta t  0$ 也可能破坏非负性。\n\n您必须：\n- 实现 DG 前向欧拉通量更新\n$$\n\\mathrm{FE\\_flux}(u) := u + \\Delta t \\, L(u),\n$$\n其中 $L(u)$ 如上文为周期性边界条件所定义。\n- 实现全算子 $F(u) = L(u) + S(u)$ 的前向欧拉更新。\n- 实现应用于全算子 $F(u)$ 的强稳定性保持三阶 Runge–Kutta 方法（Shu–Osher 形式）：\n  1. $u^{(1)} = u^n + \\Delta t \\, F(u^n)$,\n  2. $u^{(2)} = \\frac{3}{4} u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, F(u^{(1)})\\right)$,\n  3. $u^{n+1} = \\frac{1}{3} u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, F(u^{(2)})\\right)$.\n- 推导并实现 ODE $\\dot{u} = -k \\sqrt{u}$ 在一个时间步长 $\\Delta t$ 内逐分量作用的精确源演化：\n  从可分离方程 $2 \\frac{d}{dt} \\sqrt{u} = -k$ 出发，可以得到精确更新\n  $$\n  \\sqrt{u^{n+1}} = \\max\\left( \\sqrt{u^n} - \\frac{k \\Delta t}{2}, \\, 0 \\right), \\quad\\text{因此}\\quad\n  u^{n+1} = \\left( \\max\\left( \\sqrt{u^n} - \\tfrac{k \\Delta t}{2}, \\, 0 \\right) \\right)^2.\n  $$\n- 通过将精确源演化与前向欧拉通量更新进行凸混合，构建一个保正校正步，\n$$\nu^{n+1}_{\\mathrm{blend}} = \\theta \\, \\mathrm{ExactSource}(u^n) + (1 - \\theta) \\, \\mathrm{FE\\_flux}(u^n), \\quad \\theta \\in [0,1],\n$$\n并论证当 $\\mathrm{FE\\_flux}$ 保持非负性（例如，在满足 Courant–Friedrichs–Lewy 条件如 $a \\Delta t / h \\le 1$ 时）且 ExactSource 保持非负性时，为何该方法也保持 $\\mathcal{C}_+$。\n\n您的程序应生成一个反例，该反例展示前向欧拉法和 SSP Runge–Kutta 方法在全算子 $F$ 上违反非负性的情况，然后展示凸混合校正能保持非负性。使用以下测试套件。对于每个测试用例，您将获得：\n- $N$：DG 网格数量，\n- $a$：平流速度，\n- $h$：网格宽度，\n- $\\Delta t$：时间步长，\n- $k$：源强度，\n- $\\theta$：混合参数，\n- $u^0$：网格平均值初始向量。\n\n测试套件：\n1. $N=1$，$a=0.0$，$h=1.0$，$\\Delta t=0.1$，$k=10.0$，$\\theta=0.5$，$u^0 = [10^{-8}]$。\n2. $N=3$，$a=1.0$，$h=1.0$，$\\Delta t=0.2$，$k=10.0$，$\\theta=0.5$，$u^0 = [1.0, 10^{-6}, 0.5]$。\n3. $N=3$，$a=1.0$，$h=1.0$，$\\Delta t=0.5$，$k=10.0$，$\\theta=0.5$，$u^0 = [0.0, 0.0, 0.0]$。\n4. $N=3$，$a=1.0$，$h=1.0$，$\\Delta t=10^{-4}$，$k=10.0$，$\\theta=0.5$，$u^0 = [1.0, 10^{-2}, 0.5]$。\n\n对于每个测试用例，计算三个布尔值，分别指示以下方法的 $u^{n+1}$ 的最小值是否为非负：\n- 应用于 $F(u)$ 的前向欧拉更新，\n- 应用于 $F(u)$ 的三阶 SSP Runge–Kutta 更新，\n- 混合校正 $u^{n+1}_{\\mathrm{blend}}$。\n\n最终输出格式必须是单行，包含一个列表的列表，每个内部列表对应一个测试用例，并按上述顺序包含恰好三个布尔值。例如，\n$$\n\\left[ [\\mathrm{True}, \\mathrm{False}, \\mathrm{True}], [\\dots], \\dots \\right].\n$$\n本问题不要求物理单位。不涉及角度。不涉及百分比。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，并使用 Python 布尔字面量。",
            "solution": "该问题要求构造一个数值反例，以证明强稳定性保持 (SSP) 时间积分方法在一个系统中的失效情况，该系统中底层的的前向欧拉 (FE) 方法不保持期望的凸性，具体来说就是解的非负性。其背景是标量平流-反应方程的半离散间断 Galerkin (DG) 方法。\n\n控制偏微分方程是一维平流-反应方程：\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = S(u)\n$$\n其中 $a \\in \\mathbb{R}$ 是一个常数平流速度，$S(u)$ 是一个非线性源项。\n\n在宽度为 $h$ 的均匀网格上，使用零阶（分片常数基函数）DG 方法和 $a \\ge 0$ 的迎风通量进行离散化后，关于网格平均值 $u_i(t)$ 的常微分方程组 (ODEs) 如下：\n$$\n\\frac{d u_i}{d t} = L_i(u) + S(u_i), \\quad \\text{for } i = 0, 1, \\dots, N-1\n$$\n这可以写成向量形式 $\\frac{d u}{d t} = F(u)$，其中 $F(u) = L(u) + S(u)$。空间算子 $L(u)$ 和源算子 $S(u)$ 逐分量定义为：\n$$\nL_i(u) = -\\frac{a}{h}\\left(u_i - u_{i-1}\\right) \\quad (\\text{采用周期性索引 } u_{-1} := u_{N-1})\n$$\n$$\nS(u_i) = -k \\sqrt{u_i}, \\quad k > 0 \\quad (\\text{约定 } S(0) = 0)\n$$\n目标是分析非负性的保持情况，即 $u^n \\in \\mathcal{C}_+$ 是否意味着 $u^{n+1} \\in \\mathcal{C}_+$，其中 $\\mathcal{C}_+ = \\{ u \\in \\mathbb{R}^N : u_i \\ge 0 \\text{ for all } i \\}$。\n\n我们将分析三种时间步进方法：\n1.  **前向欧拉 (FE) 法**：\n    应用于全算子 $F(u)$ 的 FE 方法是：\n    $$\n    u^{n+1} = u^n + \\Delta t \\, F(u^n) = u^n + \\Delta t \\, (L(u^n) + S(u^n))\n    $$\n    对于分量 $u_i$，其形式为 $u_i^{n+1} = u_i^n + \\Delta t \\left(-\\frac{a}{h}(u_i^n - u_{i-1}^n) - k\\sqrt{u_i^n}\\right)$。非负性无法保证。源项本身就可能导致正性丧失。仅含源项的更新 $u_i^{n+1} = u_i^n - \\Delta t k \\sqrt{u_i^n}$ 仅当 $u_i^n - \\Delta t k \\sqrt{u_i^n} \\ge 0$ 时才保持非负，这要求 $\\Delta t \\le \\frac{\\sqrt{u_i^n}}{k}$。这个时间步长限制取决于状态 $u_i^n$，并且当 $u_i^n \\to 0$ 时趋近于 $0$。因此，对于任何固定的 $\\Delta t  0$，总可以找到一个足够小的 $u_i^n  0$ 来违反此条件。\n\n2.  **三阶 SSP Runge-Kutta (SSP-RK3)**：\n    该方法由以下三个阶段给出：\n    $$\n    \\begin{aligned}\n    u^{(1)} = u^n + \\Delta t \\, F(u^n) \\\\\n    u^{(2)} = \\frac{3}{4} u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, F(u^{(1)})\\right) \\\\\n    u^{n+1} = \\frac{1}{3} u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, F(u^{(2)})\\right)\n    \\end{aligned}\n    $$\n    SSP 性质保证，如果 FE 步 $v \\mapsto v + \\delta t F(v)$ 对于所有时间步长 $0 \\le \\delta t \\le \\Delta t_{\\mathrm{FE}}$ 都保持一个凸集，则 SSP-RK3 方法对于时间步长 $0 \\le \\Delta t \\le c \\Delta t_{\\mathrm{FE}}$（其中 SSP 系数 $c  0$）也将保持该集合。然而，如上所述，不存在一个统一的时间步长上限 $\\Delta t_{\\mathrm{FE}}  0$，使得 FE 对所有 $u \\in \\mathcal{C}_+$ 都能保持正性。SSP 保证的前提条件不满足，因此不保证 SSP-RK3 方法能保持正性。我们预计它在 FE 方法失效的情况下也会失效。\n\n3.  **混合保正方法**：\n    该方法使用一种类似算子分裂的方法，将一个保非负性的平流更新与一个保非负性的精确源更新进行混合。其公式为：\n    $$\n    u^{n+1}_{\\mathrm{blend}} = \\theta \\, \\mathrm{ExactSource}(u^n) + (1 - \\theta) \\, \\mathrm{FE\\_flux}(u^n), \\quad \\theta \\in [0,1]\n    $$\n    两个分量分别是：\n    - **前向欧拉通量更新**：$\\mathrm{FE\\_flux}(u^n) := u^n + \\Delta t \\, L(u^n)$。逐分量地，这是 $u_i^{n+1} = u_i^n - \\frac{a \\Delta t}{h}(u_i^n - u_{i-1}^n) = (1 - \\frac{a \\Delta t}{h})u_i^n + (\\frac{a \\Delta t}{h})u_{i-1}^n$。如果 Courant-Friedrichs-Lewy (CFL) 条件 $a \\Delta t / h \\le 1$ 成立且 $u^n \\in \\mathcal{C}_+$，那么系数 $(1-a\\Delta t/h)$ 和 $a\\Delta t/h$ 都是非负的。该更新是非负值的凸组合，因此 $\\mathrm{FE\\_flux}(u^n) \\in \\mathcal{C}_+$。\n    - **精确源更新**：从 ODE $\\frac{d\\sqrt{u}}{dt} = -\\frac{k}{2}$ 出发，在 $[t^n, t^{n+1}]$ 上积分得到 $\\sqrt{u(t^{n+1})} = \\sqrt{u(t^n)} - k\\Delta t/2$。由于解不能变为负数，精确更新为 $u^{n+1} = \\left( \\max\\left( \\sqrt{u^n} - \\frac{k \\Delta t}{2}, \\, 0 \\right) \\right)^2$。根据构造，该更新将非负值映射到非负值，因此 $\\mathrm{ExactSource}(u^n) \\in \\mathcal{C}_+$。\n\n    混合更新是两个向量 $\\mathrm{ExactSource}(u^n)$ 和 $\\mathrm{FE\\_flux}(u^n)$ 的凸组合（因为 $\\theta \\in [0,1]$），这两个向量都位于凸锥 $\\mathcal{C}_+$ 中。因此，只要通量部分满足 CFL 条件，$u^{n+1}_{\\mathrm{blend}}$ 就保证在 $\\mathcalC_+$ 内。所提供的测试用例满足此条件。实现将证明这种鲁棒性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run test cases and generate the final output.\n    \"\"\"\n\n    test_cases = [\n        # (N, a, h, dt, k, theta, u0)\n        (1, 0.0, 1.0, 0.1, 10.0, 0.5, np.array([1e-8])),\n        (3, 1.0, 1.0, 0.2, 10.0, 0.5, np.array([1.0, 1e-6, 0.5])),\n        (3, 1.0, 1.0, 0.5, 10.0, 0.5, np.array([0.0, 0.0, 0.0])),\n        (3, 1.0, 1.0, 1e-4, 10.0, 0.5, np.array([1.0, 1e-2, 0.5])),\n    ]\n\n    # --- Operator Definitions ---\n\n    def L_op(u, a, h):\n        \"\"\"Computes the spatial operator L(u) with periodic BCs.\"\"\"\n        if a == 0.0:\n            return np.zeros_like(u)\n        u_prev = np.roll(u, 1)\n        return -(a / h) * (u - u_prev)\n\n    def S_op(u, k):\n        \"\"\"\n        Computes the nonlinear source term S(u).\n        Uses np.maximum(0, u) to avoid NaN for negative inputs that may\n        arise in intermediate stages of RK methods.\n        \"\"\"\n        return -k * np.sqrt(np.maximum(0, u))\n\n    def F_op(u, a, h, k):\n        \"\"\"Computes the full RHS operator F(u) = L(u) + S(u).\"\"\"\n        return L_op(u, a, h) + S_op(u, k)\n\n    # --- Time Stepping Methods ---\n\n    def fe_step(u0, dt, a, h, k):\n        \"\"\"Performs one Forward Euler step on the full operator F(u).\"\"\"\n        return u0 + dt * F_op(u0, a, h, k)\n\n    def ssprk3_step(u0, dt, a, h, k):\n        \"\"\"Performs one SSP-RK3 step on the full operator F(u).\"\"\"\n        # Stage 1\n        u1 = u0 + dt * F_op(u0, a, h, k)\n        # Stage 2\n        u2 = 0.75 * u0 + 0.25 * (u1 + dt * F_op(u1, a, h, k))\n        # Stage 3 (Final)\n        u_final = (1.0 / 3.0) * u0 + (2.0 / 3.0) * (u2 + dt * F_op(u2, a, h, k))\n        return u_final\n\n    def blended_method(u0, dt, a, h, k, theta):\n        \"\"\"Performs one step of the blended positivity-preserving method.\"\"\"\n        # FE flux-only update\n        fe_flux_update = u0 + dt * L_op(u0, a, h)\n\n        # Exact source update\n        # Use np.maximum on the input u0 to be safe, although it should be non-negative.\n        sqrt_u0 = np.sqrt(np.maximum(0, u0))\n        exact_source_update = np.square(np.maximum(sqrt_u0 - 0.5 * k * dt, 0))\n\n        # Convex blending\n        return theta * exact_source_update + (1.0 - theta) * fe_flux_update\n\n    # --- Main Loop ---\n    \n    results = []\n    for N, a, h, dt, k, theta, u0 in test_cases:\n        \n        # 1. Forward Euler update\n        u_fe = fe_step(u0, dt, a, h, k)\n        fe_is_positive = np.all(u_fe = 0)\n\n        # 2. SSP-RK3 update\n        u_ssprk3 = ssprk3_step(u0, dt, a, h, k)\n        ssprk3_is_positive = np.all(u_ssprk3 = 0)\n\n        # 3. Blended correction update\n        u_blend = blended_method(u0, dt, a, h, k, theta)\n        blend_is_positive = np.all(u_blend = 0)\n\n        results.append([fe_is_positive, ssprk3_is_positive, blend_is_positive])\n    \n    # Format the output as a string representation of a list of lists of Python booleans\n    # str(True) -> 'True'\n    # str(False) -> 'False'\n    # Using repr() for the list will produce Python-like output, e.g., \"[[False, False, True]]\"\n    # To match the requested format with a single comma, we need a custom join.\n    output_str = \"[\" + \",\".join([str(item) for item in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}