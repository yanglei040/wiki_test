{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone in the theory of hyperbolic conservation laws is the understanding that smooth initial data can evolve into discontinuous solutions, or shocks. For these \"weak solutions,\" the governing partial differential equation is insufficient to guarantee uniqueness, necessitating an additional physical selection criterion. This practice delves into the fundamental entropy condition proposed by Kružkov, which provides a rigorous mathematical framework for identifying the physically admissible solution. By deriving the Rankine-Hugoniot condition from first principles and then verifying the Kružkov entropy inequality for the inviscid Burgers' equation, you will gain a foundational understanding of how these conditions exclude non-physical phenomena like expansion shocks .",
            "id": "3384188",
            "problem": "Consider the scalar conservation law for inviscid Burgers’ equation with flux $f(u) = \\frac{u^{2}}{2}$,\n$$u_{t} + f(u)_{x} = 0,$$\nand a single discontinuity (shock) located at an interface $x = s\\,t$ separating constant left and right states $u_{L}$ and $u_{R}$, respectively. In the context of designing entropy-consistent interface fluxes for Discontinuous Galerkin (DG) methods, begin from the integral conservation statement and derive the Rankine–Hugoniot condition for the shock speed $s$ in terms of $u_{L}$ and $u_{R}$. Then, starting from the definition of Kružkov entropies\n$$U(u) = |u - k| \\quad \\text{for arbitrary } k \\in \\mathbb{R},$$\nderive the associated entropy flux $F_{k}(u)$ by using the compatibility condition $F_{k}'(u) = U'(u)\\,f'(u)$ (interpreted in the sense of distributions for the nondifferentiability of $U$ at $u = k$), and verify the entropy inequality across the shock in distributional form\n$$s\\,[U(u)] - [F_{k}(u)] \\ge 0,$$\nfor every $k \\in \\mathbb{R}$, where $[g] := g(u_{R}) - g(u_{L})$ denotes the jump of $g$ across the shock. Conclude with a closed-form expression for the Rankine–Hugoniot shock speed $s$ as a function of $u_{L}$ and $u_{R}$. The final answer must be given as an analytic expression; do not include units and do not round.",
            "solution": "The problem statement is evaluated to be valid. It is a well-posed, scientifically grounded, and objective problem that asks for the standard derivation of the Rankine-Hugoniot condition for the inviscid Burgers' equation and the verification of the Kružkov entropy condition for a shock solution. These are fundamental concepts in the theory of hyperbolic conservation laws and their numerical approximation.\n\nThe scalar conservation law is given by\n$$u_{t} + f(u)_{x} = 0$$\nwhere the flux function for the inviscid Burgers' equation is $f(u) = \\frac{u^{2}}{2}$.\nWe consider a weak solution in the form of a single shock wave, where the solution is piecewise constant:\n$$u(x,t) = \\begin{cases} u_{L} & \\text{if } x < s\\,t \\\\ u_{R} & \\text{if } x > s\\,t \\end{cases}$$\nHere, $u_{L}$ and $u_{R}$ are the constant states to the left and right of the discontinuity, respectively, and $s$ is the constant speed of the shock.\n\nFirst, we derive the Rankine–Hugoniot condition for the shock speed $s$. The integral form of the conservation law over any fixed spatial interval $[x_{1}, x_{2}]$ is\n$$\\frac{d}{dt} \\int_{x_{1}}^{x_{2}} u(x,t)\\,dx = f(u(x_{1},t)) - f(u(x_{2},t))$$\nLet the interval $[x_{1}, x_{2}]$ contain the shock at time $t$, i.e., $x_{1} < s\\,t < x_{2}$. Substituting the piecewise constant solution, the left side becomes:\n$$\\frac{d}{dt} \\left( \\int_{x_{1}}^{s\\,t} u_{L}\\,dx + \\int_{s\\,t}^{x_{2}} u_{R}\\,dx \\right) = \\frac{d}{dt} \\left( u_{L}(s\\,t - x_{1}) + u_{R}(x_{2} - s\\,t) \\right)$$\n$$= \\frac{d}{dt} \\left( s\\,t(u_{L} - u_{R}) - u_{L}x_{1} + u_{R}x_{2} \\right) = s(u_{L} - u_{R})$$\nThe right side of the integral form is $f(u(x_{1},t)) - f(u(x_{2},t)) = f(u_{L}) - f(u_{R})$, since $x_{1}$ is to the left of the shock and $x_{2}$ is to the right.\nEquating the two sides gives the Rankine–Hugoniot condition:\n$$s(u_{L} - u_{R}) = f(u_{L}) - f(u_{R})$$\nThis can be rewritten using the jump notation $[g] := g(u_{R}) - g(u_{L})$ as:\n$$-s[u] = -[f(u)] \\implies s[u] = [f(u)]$$\n$$s = \\frac{[f(u)]}{[u]} = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$$\n\nNext, we derive the entropy flux $F_{k}(u)$ associated with the Kružkov entropy $U(u) = |u - k|$ for an arbitrary constant $k \\in \\mathbb{R}$. The entropy flux $F_{k}(u)$ must satisfy the compatibility condition $F_{k}'(u) = U'(u)f'(u)$.\nFor $f(u) = \\frac{u^{2}}{2}$, we have $f'(u) = u$. The derivative of the entropy function, in the sense of distributions, is $U'(u) = \\frac{d}{du}|u-k| = \\text{sgn}(u-k)$.\nThus, the compatibility condition is $F_{k}'(u) = u\\,\\text{sgn}(u-k)$.\nWe find $F_{k}(u)$ by integrating this expression:\n$$F_{k}(u) = \\int u\\,\\text{sgn}(u-k)\\,du$$\nWe can rewrite the integrand as $u = (u-k) + k$:\n$$F_{k}(u) = \\int ((u-k)+k)\\,\\text{sgn}(u-k)\\,du = \\int (u-k)\\,\\text{sgn}(u-k)\\,du + \\int k\\,\\text{sgn}(u-k)\\,du$$\nThe first term is $\\int |u-k|\\,du$. The second term is $k \\int \\text{sgn}(u-k)\\,du = k|u-k|$.\nThe integral of $|z|$ is $\\frac{1}{2}z|z|$ (with $z=u-k$). So,\n$$\\int |u-k|\\,du = \\frac{1}{2}(u-k)|u-k|$$\nCombining the terms, we get (up to an arbitrary constant of integration, which we set to zero):\n$$F_{k}(u) = \\frac{1}{2}(u-k)|u-k| + k|u-k| = \\left(\\frac{u-k}{2} + k\\right)|u-k| = \\frac{u+k}{2}|u-k|$$\nThis is the entropy flux associated with the Kružkov entropy for Burgers' equation.\n\nNow, we verify the entropy inequality across the shock, which is given in distributional form as:\n$$s\\,[U(u)] - [F_{k}(u)] \\ge 0$$ for every $k \\in \\mathbb{R}$.\nSubstituting the expressions for $s$, $U(u)$, and $F_{k}(u)$:\n$$s\\,[|u-k|] - \\left[\\frac{u+k}{2}|u-k|\\right] \\ge 0$$\nUsing the shock speed $s = \\frac{u_{L}+u_{R}}{2}$ derived from the Rankine-Hugoniot condition for Burgers' flux:\n$$\\frac{u_{L}+u_{R}}{2}\\left(|u_{R}-k| - |u_{L}-k|\\right) - \\left(\\frac{u_{R}+k}{2}|u_{R}-k| - \\frac{u_{L}+k}{2}|u_{L}-k|\\right) \\ge 0$$\nWe group terms with $|u_{R}-k|$ and $|u_{L}-k|$:\n$$\\left(\\frac{u_{L}+u_{R}}{2} - \\frac{u_{R}+k}{2}\\right)|u_{R}-k| - \\left(\\frac{u_{L}+u_{R}}{2} - \\frac{u_{L}+k}{2}\\right)|u_{L}-k| \\ge 0$$\nSimplifying the coefficients:\n$$\\left(\\frac{u_{L}-k}{2}\\right)|u_{R}-k| - \\left(\\frac{u_{R}-k}{2}\\right)|u_{L}-k| \\ge 0$$\nMultiplying by $2$:\n$$(u_{L}-k)|u_{R}-k| - (u_{R}-k)|u_{L}-k| \\ge 0$$\nFor this inequality to hold for all $k \\in \\mathbb{R}$, we must have $u_{L} > u_{R}$. This is the Lax entropy condition for a shock in a convex scalar conservation law like Burgers' equation. Let's verify this. Assume $u_{L} > u_{R}$.\nCase 1: $k \\le u_{R}$. Then $k  u_{L}$.\n$|u_{R}-k| = u_{R}-k$ and $|u_{L}-k|=u_{L}-k$. The inequality becomes $(u_{L}-k)(u_{R}-k) - (u_{R}-k)(u_{L}-k) = 0 \\ge 0$, which is true.\nCase 2: $k \\ge u_{L}$. Then $k > u_{R}$.\n$|u_{R}-k| = -(u_{R}-k) = k-u_{R}$ and $|u_{L}-k|=-(u_{L}-k) = k-u_{L}$. The inequality becomes $(u_{L}-k)(k-u_{R}) - (u_{R}-k)(k-u_{L}) = -(k-u_{L})(k-u_{R}) - (-(k-u_{R}))(k-u_{L}) = -(k-u_{L})(k-u_{R}) + (k-u_{R})(k-u_{L}) = 0 \\ge 0$, which is true.\nCase 3: $u_{R}  k  u_{L}$.\n$|u_{R}-k| = -(u_{R}-k) = k-u_{R}$ and $|u_{L}-k|=u_{L}-k$. The inequality becomes $(u_{L}-k)(k-u_{R}) - (u_{R}-k)(u_{L}-k) = (u_{L}-k)(k-u_{R}) + (k-u_{R})(u_{L}-k) = 2(u_{L}-k)(k-u_{R}) \\ge 0$.\nSince $u_{R}  k  u_{L}$, we have $u_{L}-k > 0$ and $k-u_{R} > 0$. Their product is positive, so the inequality is strictly satisfied.\nThe entropy inequality is satisfied for all $k \\in \\mathbb{R}$ if and only if $u_{L} > u_{R}$, which defines a physically admissible shock.\n\nFinally, we state the closed-form expression for the shock speed $s$. From the Rankine-Hugoniot condition:\n$$s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$$\nSubstituting the flux for Burgers' equation, $f(u) = \\frac{u^{2}}{2}$:\n$$s = \\frac{\\frac{u_{R}^{2}}{2} - \\frac{u_{L}^{2}}{2}}{u_{R} - u_{L}} = \\frac{\\frac{1}{2}(u_{R} - u_{L})(u_{R} + u_{L})}{u_{R} - u_{L}}$$\nAssuming $u_{R} \\neq u_{L}$ (which is necessary for a shock to exist), we can cancel the term $(u_{R} - u_{L})$:\n$$s = \\frac{u_{L} + u_{R}}{2}$$\nThis is the final expression for the shock speed.",
            "answer": "$$\n\\boxed{\\frac{u_{L} + u_{R}}{2}}\n$$"
        },
        {
            "introduction": "While the continuous theory provides clear entropy conditions, the challenge shifts to constructing numerical schemes that respect these principles at the discrete level. A powerful approach is to design \"entropy-conservative\" schemes, which exactly conserve a discrete analogue of the entropy functional for smooth solutions. This practice explores a common technique for achieving this: the use of specially designed \"split forms\" for the nonlinear flux divergence, which rearrange terms into a combination of conservative and non-conservative parts with specific weights. By leveraging the algebraic properties of Summation-By-Parts (SBP) operators, common in high-order discontinuous Galerkin and finite difference methods, you will derive an entropy-conservative split form for Burgers' equation, revealing the elegant connection between algebraic structure and discrete conservation principles .",
            "id": "3384153",
            "problem": "Consider the one-dimensional inviscid Burgers equation on a periodic domain with coordinate $x$,\n$$\n\\partial_{t} u + \\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = 0,\n$$\nwhere $u = u(x,t)$ is a sufficiently smooth scalar field. Let a nodal spectral collocation or nodal Discontinuous Galerkin (DG) discretization be given on $N+1$ nodes with diagonal mass matrix $M = \\operatorname{diag}(w_{0},\\dots,w_{N})$ (with positive quadrature weights $w_{j}$) and differentiation matrix $D$ that satisfies the Summation By Parts (SBP) property. Define $Q := M D$ and assume periodic boundary conditions so that\n$$\nQ + Q^{T} = 0, \\quad D \\boldsymbol{1} = \\boldsymbol{0},\n$$\nwhere $\\boldsymbol{1}$ is the vector of ones. Denote pointwise products by $\\odot$, so $(u^{2})$ is understood componentwise.\n\nYou are asked to construct a split-form discretization of the nonlinear advective term that blends skew-symmetric and conservative averages and then prove discrete entropy conservation for the quadratic entropy.\n\n1. Starting from the advective form $\\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = u \\,\\partial_{x} u$ and the SBP operators $(M,D,Q)$ introduced above, propose a two-parameter split-form ansatz for the discrete approximation of $u \\, u_{x}$ of the form\n$$\n\\mathcal{C}(u) := \\alpha \\, D(u^{2}) + \\beta \\, \\operatorname{diag}(u) \\, D u,\n$$\nwhere $\\alpha$ and $\\beta$ are real coefficients to be determined. Impose the two conditions that:\n- the split-form is consistent with the continuous identity $u \\, u_{x} = \\partial_{x}\\left(\\frac{u^{2}}{2}\\right)$, and\n- the discretization is entropy conservative for the quadratic entropy $U(u) = \\frac{u^{2}}{2}$ under periodic boundary conditions.\n\nDerive the values of $\\alpha$ and $\\beta$ that satisfy both conditions simultaneously and write the resulting split form explicitly.\n\n2. Consider the semi-discrete scheme\n$$\nM \\, \\dot{u} \\;=\\; - M \\, \\mathcal{C}(u),\n$$\nwith $\\mathcal{C}(u)$ given by your split form from Item $1$. Using only the SBP properties stated above and the entropy pair $(U,F)$ given by $U(u) = \\frac{u^{2}}{2}$ and $F(u) = \\frac{u^{3}}{3}$, prove that the time rate of change of the discrete entropy\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left( \\sum_{j=0}^{N} w_{j} \\, U(u_{j}) \\right)\n$$\nis equal to a quantity that depends only on boundary contributions. Then, using periodic boundaries, compute the value of this time rate of change.\n\nYour final answer must be the single real number equal to the value of the discrete entropy production under periodic boundaries. No rounding is needed and no units are required.",
            "solution": "The user wants to construct and analyze an entropy-conservative split-form discretization for the one-dimensional inviscid Burgers' equation, $\\partial_{t} u + \\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = 0$.\n\nThe problem is divided into two parts. First, we determine the coefficients of a split-form discretization that ensure consistency and entropy conservation. Second, we prove a general property about the entropy evolution and compute the rate of change for the specific case of periodic boundaries.\n\n**Part 1: Construction of the Split-Form Discretization**\n\nThe problem asks to find coefficients $\\alpha, \\beta \\in \\mathbb{R}$ for the split-form ansatz\n$$\n\\mathcal{C}(u) := \\alpha \\, D(u^{2}) + \\beta \\, \\operatorname{diag}(u) \\, D u\n$$\nsuch that two conditions are met: consistency with the continuous equation and entropy conservation for the quadratic entropy under periodic boundary conditions. The vector $\\boldsymbol{u}$ represents the solution at the $N+1$ grid nodes. The matrix $D$ is the discrete differentiation operator.\n\n**Condition 1: Consistency**\nThe continuous advection term can be written as $\\partial_{x}\\left(\\frac{u^{2}}{2}\\right)$, which is equivalent to $u \\, \\partial_{x} u$ via the chain rule. The semi-discrete scheme is $\\dot{\\boldsymbol{u}} = -\\mathcal{C}(\\boldsymbol{u})$ (since the mass matrix $M$ is diagonal and appears on both sides), so $\\mathcal{C}(\\boldsymbol{u})$ must be a consistent discretization of $u \\, \\partial_{x}u$. Let's analyze the terms in the ansatz $\\mathcal{C}(\\boldsymbol{u})$:\n- The term $D(\\boldsymbol{u}^{2})$ is a discrete approximation of $\\partial_{x}(u^{2}) = 2 u \\, \\partial_{x}u$. Note that $\\boldsymbol{u}^{2}$ denotes the component-wise square, $\\boldsymbol{u} \\odot \\boldsymbol{u}$.\n- The term $\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u}$ represents the product of the vector $\\boldsymbol{u}$ with the vector $D\\boldsymbol{u}$, and is a discrete approximation of $u \\, \\partial_{x}u$.\n\nFor $\\mathcal{C}(\\boldsymbol{u})$ to be a consistent approximation of $u \\, \\partial_{x}u$, the weighted sum of the continuous terms they represent must equal $u \\, \\partial_{x}u$. This leads to the algebraic condition on the coefficients:\n$$\n\\alpha (2 u \\, \\partial_{x}u) + \\beta (u \\, \\partial_{x}u) = u \\, \\partial_{x}u\n$$\nFor this to hold for any non-trivial $u$, we must have:\n$$\n2\\alpha + \\beta = 1\n$$\n\n**Condition 2: Entropy Conservation**\nThe problem requires the scheme to be entropy conservative for the quadratic entropy $U(u) = \\frac{u^{2}}{2}$ under periodic boundary conditions. The total discrete entropy is the weighted sum over the nodes:\n$$\nS(t) := \\sum_{j=0}^{N} w_{j} \\, U(u_{j}) = \\sum_{j=0}^{N} w_{j} \\frac{u_{j}^{2}}{2}\n$$\nIn vector notation, using the diagonal mass matrix $M = \\operatorname{diag}(w_{0},\\dots,w_{N})$, this is:\n$$\nS(t) = \\frac{1}{2} \\boldsymbol{u}^{T} M \\boldsymbol{u}\n$$\nThe rate of change of the discrete entropy is found by differentiating with respect to time $t$:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\frac{1}{2} \\left( \\dot{\\boldsymbol{u}}^{T} M \\boldsymbol{u} + \\boldsymbol{u}^{T} M \\dot{\\boldsymbol{u}} \\right)\n$$\nSince $M$ is symmetric ($M^{T}=M$), the two terms are equal, so:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\boldsymbol{u}^{T} M \\dot{\\boldsymbol{u}}\n$$\nThe semi-discrete scheme is given as $M \\dot{\\boldsymbol{u}} = -M \\mathcal{C}(\\boldsymbol{u})$. Substituting this into the entropy rate equation gives:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\boldsymbol{u}^{T} (-M \\mathcal{C}(\\boldsymbol{u})) = -\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u})\n$$\nEntropy conservation means that this rate of change is zero. Therefore, we must impose the condition:\n$$\n\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u}) = 0\n$$\nSubstituting the ansatz for $\\mathcal{C}(\\boldsymbol{u})$:\n$$\n\\boldsymbol{u}^{T} M \\left( \\alpha \\, D(\\boldsymbol{u}^{2}) + \\beta \\, \\operatorname{diag}(\\boldsymbol{u}) \\, D \\boldsymbol{u} \\right) = 0\n$$\n$$\n\\alpha \\, \\boldsymbol{u}^{T} M D(\\boldsymbol{u}^{2}) + \\beta \\, \\boldsymbol{u}^{T} M \\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u} = 0\n$$\nLet's analyze the two terms in this expression. Let $Q = MD$.\nThe first term is $\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})$.\nThe second term can be rewritten. The vector $\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u}$ has components $(\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u})_j = u_j \\sum_k D_{jk} u_k$. Then the second term is $\\beta \\sum_j u_j w_j (u_j \\sum_k D_{jk} u_k) = \\beta \\sum_{j,k} u_j^2 (w_j D_{jk}) u_k$. In vector notation, this is $\\beta (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u}$.\nThe condition becomes:\n$$\n\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + \\beta (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = 0\n$$\nThe problem specifies periodic boundary conditions, for which the SBP operator satisfies $Q + Q^{T} = 0$, meaning $Q$ is skew-symmetric. For any vectors $\\boldsymbol{x}$ and $\\boldsymbol{y}$, skew-symmetry implies $\\boldsymbol{x}^{T} Q \\boldsymbol{y} = - \\boldsymbol{y}^{T} Q \\boldsymbol{x}$. Applying this with $\\boldsymbol{x} = \\boldsymbol{u} \\odot \\boldsymbol{u}$ and $\\boldsymbol{y} = \\boldsymbol{u}$, we get:\n$$\n(\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = - \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\nSubstituting this back into the entropy condition:\n$$\n\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) - \\beta \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\n$$\n(\\alpha - \\beta) \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\nFor this equation to hold for any arbitrary state vector $\\boldsymbol{u}$ (for which $\\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})$ is not identically zero), we must have:\n$$\n\\alpha = \\beta\n$$\n\n**Solving for the Coefficients**\nWe now have a system of two linear equations for $\\alpha$ and $\\beta$:\n1. $2\\alpha + \\beta = 1$\n2. $\\alpha = \\beta$\n\nSubstituting ($2$) into ($1$) gives $2\\alpha + \\alpha = 1$, which simplifies to $3\\alpha = 1$, so $\\alpha = \\frac{1}{3}$.\nFrom ($2$), it follows that $\\beta = \\frac{1}{3}$.\n\nThe resulting split-form discretization is:\n$$\n\\mathcal{C}(\\boldsymbol{u}) = \\frac{1}{3} D(\\boldsymbol{u}^{2}) + \\frac{1}{3} \\operatorname{diag}(\\boldsymbol{u}) \\, D \\boldsymbol{u}\n$$\n\n**Part 2: Proof of Entropy Dissipation Structure and Final Value**\n\nWe are asked to analyze the time rate of change of the discrete entropy for the semi-discrete scheme $M \\dot{\\boldsymbol{u}} = -M \\mathcal{C}(\\boldsymbol{u})$, where $\\mathcal{C}(\\boldsymbol{u})$ is the form derived above.\n\nThe rate of change is $\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u})$. Using the split form with $\\alpha=\\beta=\\frac{1}{3}$:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} M D(\\boldsymbol{u}^{2}) + \\boldsymbol{u}^{T} M \\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u} \\right)\n$$\nAs shown before, this is equivalent to:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} \\right)\n$$\nTo show that this quantity depends only on boundary contributions, we consider the general SBP property $Q+Q^T=B$, where $B$ is a boundary operator matrix that is non-zero only for indices corresponding to the domain boundary. Using $\\boldsymbol{y}^T Q \\boldsymbol{x} = \\boldsymbol{x}^T Q^T \\boldsymbol{y}$:\n$$\n(\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = \\boldsymbol{u}^{T} Q^{T} (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\nSubstituting this into the expression for the entropy rate gives:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + \\boldsymbol{u}^{T} Q^{T} (\\boldsymbol{u} \\odot \\boldsymbol{u}) \\right)\n= -\\frac{1}{3} \\boldsymbol{u}^{T} (Q + Q^{T}) (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\nUsing the general SBP property $Q+Q^{T}=B$:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\nFor a standard one-dimensional SBP operator on nodes $j=0, \\dots, N$, the boundary matrix is $B = \\operatorname{diag}(-1, 0, \\dots, 0, 1)$. The term $\\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u})$ is then:\n$$\n\\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u}) = \\sum_{j,k} u_j B_{jk} u_k^2 = -u_0(u_0^2) + u_N(u_N^2) = u_N^3 - u_0^3\n$$\nThis expression depends only on the values of $\\boldsymbol{u}$ at the boundaries (nodes $0$ and $N$), which completes the proof. The rate of change is $-\\frac{1}{3}(u_N^3 - u_0^3) = -(F(u_N)-F(u_0))$, where $F(u)=\\frac{u^3}{3}$ is the entropy flux.\n\nFinally, we compute the value of this rate of change under the specified periodic boundary conditions. The problem states that for periodic boundaries, the SBP property is $Q + Q^{T} = 0$. This implies that the boundary operator $B$ is the zero matrix, $B = \\boldsymbol{0}$.\nSubstituting $B=\\boldsymbol{0}$ into our proven result for the entropy rate of change:\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\boldsymbol{u}^{T} \\boldsymbol{0} (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\nThus, for periodic boundary conditions, the discrete entropy is exactly conserved, and its rate of change is zero.\n\nThe final answer is the value of this rate of change.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "In practice, many widely-used numerical fluxes, such as the Roe flux, are prized for their high resolution at shocks but are not inherently entropy-stable; they can admit entropy-violating solutions at so-called sonic points where the characteristic speed changes sign. The remedy is an \"entropy fix,\" which introduces a small, targeted amount of numerical dissipation to enforce the correct physical behavior. This computational exercise guides you through the implementation of a Discontinuous Galerkin method to investigate the practical effects of the Harten entropy fix parameter, $\\delta$. By comparing a constant $\\delta$ with a simple adaptive strategy, you will analyze the trade-off between ensuring entropy stability and minimizing unwanted numerical diffusion, a critical skill for developing robust and accurate simulations of fluid dynamics .",
            "id": "3384135",
            "problem": "Consider the scalar hyperbolic conservation law on a periodic one-dimensional domain,\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = 0, \\quad x \\in [0,2\\pi], \\; t \\ge 0,\n$$\nwith Burgers flux $f(u) = \\tfrac{1}{2} u^2$. The method of interest is the Discontinuous Galerkin (DG) method of polynomial degree $p=1$ (two nodal degrees of freedom per element), using an exact local mass matrix and a two-point Gauss-Legendre quadrature for volume terms. Numerical fluxes are of Roe type, where the Roe speed is $\\hat{a} = \\tfrac{1}{2}(u_L + u_R)$ and the dissipation uses a smooth entropy fix. Specifically, the absolute value $\\lvert \\hat{a} \\rvert$ is replaced by a patched function $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ defined by\n$$\n\\psi(\\lvert \\hat{a} \\rvert;\\delta) = \\begin{cases}\n\\lvert \\hat{a} \\rvert,  \\text{if } \\lvert \\hat{a} \\rvert \\ge \\delta, \\\\[4pt]\n\\tfrac{1}{2}\\left( \\tfrac{\\hat{a}^2}{\\delta} + \\delta \\right),  \\text{if } \\lvert \\hat{a} \\rvert  \\delta,\n\\end{cases}\n$$\nwith an entropy fix parameter $\\delta \\ge 0$. For the scalar Burgers equation, the characteristic speed is $\\lambda(u) = u$. Two strategies for selecting $\\delta$ are to be considered:\n- A constant choice $\\delta = \\delta_{\\mathrm{const}}$ at all interfaces.\n- An adaptive choice based on local wave speeds across each interface, defined by $\\delta = \\kappa \\max\\{0, \\lambda(u_R) - \\lambda(u_L)\\}$, with proportionality parameter $\\kappa \\ge 0$.\n\nThe time integrator must be a third-order Strong Stability Preserving Runge-Kutta (SSPRK(3)) scheme. The semi-discrete DG scheme is to be advanced with a time step $\\Delta t$ chosen adaptively by a Courant-Friedrichs-Lewy number (CFL) condition\n$$\n\\Delta t = \\min\\left\\{ \\frac{\\mathrm{CFL}\\, h}{(2p+1) \\, s_{\\max}}, \\; \\Delta t_{\\max} \\right\\},\n$$\nwhere $h$ is the uniform element size, $s_{\\max}$ is the maximum over all interfaces of the patched speed $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ for the current solution state, $\\mathrm{CFL}$ is a prescribed constant with $0  \\mathrm{CFL}  1$, and $\\Delta t_{\\max}$ is a prescribed upper bound for time steps. Use periodic boundary conditions on $[0,2\\pi]$, with a uniform mesh of $N_e$ elements.\n\nThe initial condition is a small-amplitude single Fourier mode\n$$\nu(x,0) = \\varepsilon \\sin(k x),\n$$\nwhere $\\varepsilon  0$ is small (so that nonlinearity is weak and linearized wave behavior is dominant at early times) and $k$ is a positive integer. Let the final time be $T0$.\n\nYour tasks are:\n1. Starting from the definitions of a hyperbolic conservation law and the discrete DG weak form with numerical fluxes, explain why an entropy fix is needed for Roe-type fluxes near sonic points for nonlinear flux functions, and how the smooth patch $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ affects dissipation for small-amplitude waves near $\\hat{a} \\approx 0$.\n2. Implement the $p=1$ nodal DG method with Roe flux and the smooth entropy fix above. Include both the constant $\\delta$ strategy and the adaptive wave-speed-based $\\delta$ strategy given by $\\delta = \\kappa \\max\\{0, \\lambda(u_R)-\\lambda(u_L)\\}$ with $\\lambda(u)=u$.\n3. For a given $(\\varepsilon,k)$ and a specified strategy for $\\delta$, evolve the solution to time $T$ and measure:\n   - The dissipation in the fundamental mode, quantified by the amplitude ratio\n     $$\n     \\mathcal{A}_{\\mathrm{ratio}} = \\frac{\\sqrt{a_{\\sin}(T)^2 + a_{\\cos}(T)^2}}{\\sqrt{a_{\\sin}(0)^2 + a_{\\cos}(0)^2}},\n     $$\n     where\n     $$\n     a_{\\sin}(t) = \\frac{1}{\\pi} \\int_0^{2\\pi} u(x,t) \\sin(kx)\\, dx, \\quad\n     a_{\\cos}(t) = \\frac{1}{\\pi} \\int_0^{2\\pi} u(x,t) \\cos(kx)\\, dx,\n     $$\n     approximated numerically by a uniform Riemann sum.\n   - The phase error at time $T$, defined by\n     $$\n     \\phi(T) = \\operatorname{atan2}\\big(-a_{\\cos}(T),\\, a_{\\sin}(T)\\big).\n     $$\n     Report $\\phi(T)$ in radians.\n   Use the same numerical quadrature for $t=0$ and $t=T$ to minimize systematic bias so that the initial amplitude in the denominator is the numerically measured one: $\\sqrt{a_{\\sin}(0)^2 + a_{\\cos}(0)^2}$.\n4. Analyze how varying $\\delta$ changes $\\mathcal{A}_{\\mathrm{ratio}}$ and $\\phi(T)$ in the small-amplitude regime, and implement the adaptive strategy to compare against constant choices.\n\nNumerical parameters to be used in all runs:\n- Period $L = 2\\pi$ so the domain is $[0,2\\pi]$.\n- Polynomial degree $p=1$.\n- Number of elements $N_e = 80$.\n- Final time $T = 1.0$.\n- Courant-Friedrichs-Lewy number $\\mathrm{CFL} = 0.3$.\n- Maximum time step $\\Delta t_{\\max} = 0.1$.\n- For time-step safety, use $s_{\\max} \\ge s_{\\mathrm{floor}}$ with $s_{\\mathrm{floor}} = 10^{-2}$ in the formula for $\\Delta t$.\n\nTest suite:\n- Case $1$: $k=1$, $\\varepsilon = 0.001$, constant $\\delta$ with $\\delta_{\\mathrm{const}} = 0$.\n- Case $2$: $k=1$, $\\varepsilon = 0.001$, constant $\\delta$ with $\\delta_{\\mathrm{const}} = 0.1$.\n- Case $3$: $k=3$, $\\varepsilon = 0.001$, adaptive $\\delta$ with $\\kappa = 1.0$.\n\nFor each case, compute and return two floating-point values $(\\mathcal{A}_{\\mathrm{ratio}}, \\phi(T))$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\big[ \\mathcal{A}_{\\mathrm{ratio}}^{(1)},\\, \\phi^{(1)},\\, \\mathcal{A}_{\\mathrm{ratio}}^{(2)},\\, \\phi^{(2)},\\, \\mathcal{A}_{\\mathrm{ratio}}^{(3)},\\, \\phi^{(3)} \\big],\n$$\nwhere superscripts indicate the test case number. All angles must be in radians. All numbers must be printed in standard decimal floating-point format.",
            "solution": "The problem presented is a well-posed and scientifically sound task in the field of numerical analysis for partial differential equations. It concerns the implementation and analysis of a Discontinuous Galerkin (DG) method for the scalar, nonlinear, hyperbolic Burgers' equation. All parameters and methodologies are clearly specified, standard in the discipline, and present no contradictions or ambiguities. We may therefore proceed with a full solution.\n\nThe problem centers on the scalar hyperbolic conservation law in one dimension,\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = 0,\n$$\non a periodic domain $x \\in [0,2\\pi]$. The flux function is the nonlinear Burgers' flux, $f(u) = \\frac{1}{2} u^2$, for which the characteristic speed is $\\lambda(u) = f'(u) = u$. A key feature of such nonlinear equations is the potential for smooth initial data to evolve into discontinuous solutions, known as shocks. This necessitates the concept of weak solutions, which satisfy an integral form of the PDE. However, weak solutions are not unique. An additional constraint, the entropy condition, is required to select the physically relevant solution. For a convex flux like Burgers', the entropy condition ensures that characteristics enter a shock discontinuity from both sides, and forbids non-physical phenomena like expansion shocks.\n\nThe Discontinuous Galerkin (DG) method is a finite element technique that approximates the solution $u(x,t)$ within each element $K_j$ of the mesh by a polynomial $u_h(x,t)$ of degree $p$. Unlike continuous finite element methods, $u_h$ is allowed to be discontinuous at element interfaces. For this problem, with $p=1$, we use a nodal basis on each element $K_j = [x_j, x_{j+1}]$ of uniform size $h=2\\pi/N_e$. The solution is represented as $u_h(x,t) = u_{j,0}(t) \\psi_0(x) + u_{j,1}(t) \\psi_1(x)$, where $\\psi_0(x) = (x_{j+1}-x)/h$ and $\\psi_1(x) = (x-x_j)/h$ are the linear basis-functions. The degrees of freedom (DoFs) $u_{j,0}$ and $u_{j,1}$ are the values of the solution polynomial at the element endpoints, i.e., $u_h(x_j^+)$ and $u_h(x_{j+1}^-)$.\n\nThe semi-discrete weak formulation for an element $K_j$ is obtained by multiplying the PDE by a test function $v_h$ from the same polynomial space and integrating over $K_j$:\n$$\n\\int_{K_j} (\\partial_t u_h) v_h \\,dx - \\int_{K_j} f(u_h) \\partial_x v_h \\,dx + \\left[ \\hat{f} v_h \\right]_{x_j}^{x_{j+1}} = 0.\n$$\nThe term $\\hat{f}$ is the numerical flux, which is a key component that couples adjacent elements and ensures stability and consistency. This formulation leads to a system of ordinary differential equations (ODEs), $M \\frac{d\\mathbf{U}}{dt} = \\mathbf{R}(\\mathbf{U})$, where $\\mathbf{U}$ is the global vector of DoFs. For the specified nodal basis, the local mass matrix $M$ on each element is\n$$M=\\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}.$$\nThe right-hand side vector $\\mathbf{R}(\\mathbf{U})$ consists of contributions from the volume integral, approximated with a two-point Gauss-Legendre quadrature, and the surface integrals involving the numerical flux.\n\nThe specified numerical flux is of Roe type. For the scalar Burgers' equation, the Roe flux at an interface with left state $u_L$ and right state $u_R$ is\n$$\n\\hat{f}(u_L, u_R) = \\frac{1}{2}\\left( f(u_L) + f(u_R) \\right) - \\frac{1}{2} |\\hat{a}| (u_R - u_L),\n$$\nwhere $\\hat{a} = \\frac{1}{2}(u_L + u_R)$ is the Roe-averaged speed. This flux is derived from an approximate solution to the local Riemann problem at the interface. A critical flaw arises at \"sonic points,\" where the characteristic speed $\\lambda(u)=u$ passes through zero. For instance, in a transonic rarefaction where $u_L  0  u_R$ and $u_L \\approx -u_R$, the Roe speed $\\hat{a} \\approx 0$. The dissipation term, proportional to $|\\hat{a}|$, vanishes. This makes the Roe flux revert to a simple centered flux, which is known to be unstable and permits entropy-violating expansion shocks.\n\nAn \"entropy fix\" remedies this by ensuring the numerical dissipation does not vanish at sonic points. The problem specifies a smooth patch function, $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$, to replace $\\lvert \\hat{a} \\rvert$:\n$$\n\\psi(\\lvert \\hat{a} \\rvert;\\delta) = \\begin{cases}\n\\lvert \\hat{a} \\rvert,  \\text{if } \\lvert \\hat{a} \\rvert \\ge \\delta, \\\\\n\\tfrac{1}{2}\\left( \\tfrac{\\hat{a}^2}{\\delta} + \\delta \\right),  \\text{if } \\lvert \\hat{a} \\rvert  \\delta.\n\\end{cases}\n$$\nThis function guarantees a minimum level of dissipation. When $|\\hat{a}| \\to 0$, $\\psi \\to \\frac{1}{2}\\delta$. This prevents the dissipation from vanishing and enforces the entropy condition numerically. For small-amplitude waves where $|u|$ is small, the Roe speed $\\hat{a}$ is also small, so the behavior is sensitive to the choice of $\\delta$.\n\\begin{itemize}\n    \\item A **constant $\\delta$** (e.g., $\\delta_{\\mathrm{const}} = 0.1$) that is large compared to the wave amplitude $\\varepsilon$ forces the scheme to always use the patched dissipation $\\psi \\approx \\frac{1}{2}\\delta$. This adds a substantial, non-physical amount of dissipation everywhere, leading to rapid damping of the wave.\n    \\item The **adaptive $\\delta = \\kappa \\max\\{0, u_R - u_L\\}$** is more intelligent. It targets dissipation at rarefactions, where $u_R  u_L$. For a smooth sine wave, $u_R - u_L \\approx h u_x$, so $\\delta$ is small and proportional to the local wave steepness. This strategy applies dissipation only where and to the extent it is needed, preserving wave amplitude more effectively while still preventing entropy violations. For shocks, where $u_Lu_R$, this choice correctly gives $\\delta=0$.\n\\end{itemize}\n\nThe semi-discrete system of ODEs, $\\frac{d\\mathbf{U}}{dt} = M^{-1}\\mathbf{R}(\\mathbf{U}) = \\mathbf{L}(\\mathbf{U})$, is evolved in time using a third-order Strong Stability Preserving Runge-Kutta (SSPRK(3)) method. The time step $\\Delta t$ is chosen adaptively based on a Courant-Friedrichs-Lewy (CFL) condition,\n$$ \\Delta t = \\min\\left\\{ \\frac{\\mathrm{CFL}\\, h}{(2p+1) s_{\\max}}, \\Delta t_{\\max} \\right\\}, $$\nwhere $s_{\\max}$ is the maximum patched wave speed $\\psi$ across all interfaces, floored by a minimum value $s_{\\mathrm{floor}}$ for robustness.\n\nFinally, the dissipation and phase error are quantified by projecting the numerical solution onto the fundamental Fourier mode $k$. The amplitude ratio $\\mathcal{A}_{\\mathrm{ratio}}$ measures the decay of the wave amplitude, while the phase error $\\phi(T)$ measures the accumulated lag or lead of the numerical wave compared to its initial position. The integrals for these coefficients are computed via a high-order Riemann sum to ensure accuracy. The analysis of these quantities for the specified test cases will demonstrate the practical effects of the different entropy fix strategies.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the solution of the DG-FEM problem for Burgers' equation.\n    It sets up the simulation parameters, iterates through the test cases,\n    runs the simulation for each case, and prints the final results in the specified format.\n    \"\"\"\n    # Global numerical parameters\n    L = 2.0 * np.pi\n    Ne = 80\n    p = 1\n    T_final = 1.0\n    CFL = 0.3\n    dt_max = 0.1\n    s_floor = 1.0e-2\n    h = L / Ne\n\n    # Test suite definition\n    test_cases = [\n        {'k': 1, 'eps': 0.001, 'delta_strategy': 'const', 'delta_param': 0.0},\n        {'k': 1, 'eps': 0.001, 'delta_strategy': 'const', 'delta_param': 0.1},\n        {'k': 3, 'eps': 0.001, 'delta_strategy': 'adaptive', 'delta_param': 1.0},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Run simulation to get the final state U_T\n        U_T = run_simulation(case, Ne, h, p, T_final, CFL, dt_max, s_floor, L)\n        \n        # Post-processing: calculate amplitude ratio and phase error\n        k = case['k']\n        eps = case['eps']\n        \n        # Generate initial state U0 for analysis\n        x_nodes = np.linspace(0, L, Ne + 1)\n        U0 = np.zeros((Ne, 2))\n        for j in range(Ne):\n            U0[j, 0] = eps * np.sin(k * x_nodes[j])\n            U0[j, 1] = eps * np.sin(k * x_nodes[j+1])\n            \n        # Calculate Fourier coefficients for initial and final states\n        a_sin_0, a_cos_0 = calculate_fourier_coeffs(U0, k, Ne, h, L)\n        initial_amplitude = np.sqrt(a_sin_0**2 + a_cos_0**2)\n        \n        a_sin_T, a_cos_T = calculate_fourier_coeffs(U_T, k, Ne, h, L)\n        final_amplitude = np.sqrt(a_sin_T**2 + a_cos_T**2)\n\n        # Compute metrics\n        A_ratio = final_amplitude / initial_amplitude if initial_amplitude > 1e-12 else 0.0\n        phi_T = np.arctan2(-a_cos_T, a_sin_T)\n        \n        all_results.extend([A_ratio, phi_T])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef flux_burgers(u):\n    \"\"\"Computes the Burgers flux F(u) = 0.5 * u^2.\"\"\"\n    return 0.5 * u**2\n\ndef calculate_rhs(U, Ne, h, case):\n    \"\"\"\n    Computes the right-hand side (RHS) of the semi-discrete DG system, dU/dt = L(U).\n    \n    Args:\n        U (np.ndarray): The current solution state vector (Ne x 2).\n        Ne (int): Number of elements.\n        h (float): Element size.\n        case (dict): Dictionary defining the current test case parameters.\n        \n    Returns:\n        tuple: A tuple containing:\n            - L_U (np.ndarray): The RHS vector (Ne x 2).\n            - speeds (np.ndarray): The patched wave speeds at each interface.\n    \"\"\"\n    fluxes = np.zeros(Ne)\n    speeds = np.zeros(Ne)\n    \n    # 1. Compute numerical fluxes at all interfaces\n    for j in range(Ne):\n        u_L = U[j-1, 1]  # Value at x_j^- from element j-1\n        u_R = U[j, 0]    # Value at x_j^+ from element j\n        \n        a_hat = 0.5 * (u_L + u_R)\n        \n        # Determine delta for entropy fix\n        delta = 0.0\n        if case['delta_strategy'] == 'const':\n            delta = case['delta_param']\n        elif case['delta_strategy'] == 'adaptive':\n            kappa = case['delta_param']\n            lambda_uR = u_R # Characteristic speed for Burgers' is u\n            lambda_uL = u_L\n            delta = kappa * max(0.0, lambda_uR - lambda_uL)\n\n        # Harten's entropy fix (patched function psi)\n        abs_a_hat = np.abs(a_hat)\n        psi_val = 0.0\n        if abs_a_hat >= delta:\n            psi_val = abs_a_hat\n        else:\n            if delta > 1e-12: # Avoid division by zero\n                psi_val = 0.5 * (a_hat**2 / delta + delta)\n            else: # delta is zero, so no entropy fix\n                psi_val = abs_a_hat\n\n        speeds[j] = psi_val\n        fluxes[j] = 0.5*(flux_burgers(u_L) + flux_burgers(u_R)) - 0.5*psi_val*(u_R - u_L)\n\n    L_U = np.zeros_like(U)\n    \n    # 2. Compute RHS for each element\n    # Pre-compute matrices and constants for p=1\n    xi_q = np.array([-1.0/np.sqrt(3.0), 1.0/np.sqrt(3.0)])\n    L1_at_q = (1.0 - xi_q) / 2.0\n    L2_at_q = (1.0 + xi_q) / 2.0\n    M_inv_local = (2.0/h) * np.array([[2.0, -1.0], [-1.0, 2.0]])\n\n    for j in range(Ne):\n        # DoFs for element j\n        u_j0, u_j1 = U[j, 0], U[j, 1]\n        \n        # Evaluate u_h at quadrature points\n        u_at_q = u_j0 * L1_at_q + u_j1 * L2_at_q\n        \n        # Approximate volume integral using 2-point Gauss-Legendre quadrature\n        f_at_q = flux_burgers(u_at_q)\n        F_int = 0.5 * np.sum(f_at_q)\n        \n        # Surface fluxes for element j\n        f_j = fluxes[j]\n        f_jp1 = fluxes[(j + 1) % Ne] # Periodicity\n        \n        # Assemble local RHS without mass matrix\n        RHS_local = np.array([-F_int + f_j, F_int - f_jp1])\n        \n        # Multiply by inverse mass matrix to get dU_j/dt\n        L_U[j, :] = M_inv_local @ RHS_local\n        \n    return L_U, speeds\n\ndef run_simulation(case, Ne, h, p, T_final, CFL, dt_max, s_floor, L):\n    \"\"\"\n    Evolves the solution from t=0 to t=T_final using SSPRK(3) time integration.\n    \"\"\"\n    k = case['k']\n    eps = case['eps']\n    \n    # Initial Condition\n    x_nodes = np.linspace(0, L, Ne + 1)\n    U = np.zeros((Ne, 2))\n    for j in range(Ne):\n        U[j, 0] = eps * np.sin(k * x_nodes[j])\n        U[j, 1] = eps * np.sin(k * x_nodes[j+1])\n        \n    t = 0.0\n    while t  T_final:\n        L_U, speeds = calculate_rhs(U, Ne, h, case)\n        \n        s_max = np.max(speeds)\n        s_max = max(s_max, s_floor)\n        \n        dt = CFL * h / ((2*p + 1) * s_max)\n        dt = min(dt, dt_max)\n        if t + dt > T_final:\n            dt = T_final - t\n        \n        # SSPRK(3)\n        U1 = U + dt * L_U\n        L1, _ = calculate_rhs(U1, Ne, h, case)\n        \n        U2 = 0.75 * U + 0.25 * (U1 + dt * L1)\n        L2, _ = calculate_rhs(U2, Ne, h, case)\n        \n        U = (1.0/3.0) * U + (2.0/3.0) * (U2 + dt * L2)\n        \n        t += dt\n        \n    return U\n\ndef calculate_fourier_coeffs(U, k, Ne, h, L, N_pts_per_elem=10):\n    \"\"\"\n    Calculates the sine and cosine Fourier coefficients of the DG solution.\n    The integral is approximated by a uniform Riemann sum over a fine grid.\n    \"\"\"\n    N_pts = Ne * N_pts_per_elem\n    x_eval = np.linspace(0, L, N_pts, endpoint=False)\n    u_eval = np.zeros(N_pts)\n    \n    for i, x in enumerate(x_eval):\n        j = int(np.floor(x / h))\n        j = min(j, Ne - 1)  # Ensure j is a valid index\n        \n        x_j = j * h\n        x_jp1 = (j + 1) * h\n        \n        U_j0, U_j1 = U[j, 0], U[j, 1]\n        \n        # Linear interpolation within the element\n        u_eval[i] = U_j0 * (x_jp1 - x) / h + U_j1 * (x - x_j) / h\n        \n    dx = L / N_pts\n    a_sin = (1.0/np.pi) * np.sum(u_eval * np.sin(k * x_eval)) * dx\n    a_cos = (1.0/np.pi) * np.sum(u_eval * np.cos(k * x_eval)) * dx\n    \n    return a_sin, a_cos\n\nsolve()\n```"
        }
    ]
}