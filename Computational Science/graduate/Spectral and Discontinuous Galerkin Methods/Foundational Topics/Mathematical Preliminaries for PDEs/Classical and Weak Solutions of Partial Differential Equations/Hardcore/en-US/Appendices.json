{
    "hands_on_practices": [
        {
            "introduction": "The distinction between classical and weak solutions is a cornerstone of modern PDE theory. This practice provides a concrete, hands-on opportunity to understand this difference by constructing a solution from first principles . By solving an elliptic boundary value problem with a discontinuous coefficient, you will derive a function that satisfies the weak formulation in the Sobolev space $H_0^1(0,1)$ but lacks the second-order continuous differentiability required of a classical solution, thereby demonstrating why the framework of weak solutions is essential for a broader class of problems.",
            "id": "3370443",
            "problem": "Let $\\Omega=(0,1)$ and consider the scalar, second-order elliptic boundary value problem for a function $u:\\Omega\\to\\mathbb{R}$,\n$$\n-(a(x)\\,u'(x))'=f(x)\\quad\\text{in }\\Omega,\\qquad u(0)=0,\\quad u(1)=0,\n$$\nwith a coefficient $a:\\Omega\\to\\mathbb{R}$ and a right-hand side $f:\\Omega\\to\\mathbb{R}$. Begin from the definitions of weak solution in the Sobolev space $H_0^1(0,1)$, the distributional derivative, and the standard variational formulation derived via integration by parts. Take\n$$\na(x)=\\begin{cases}\n1, x\\in(0,\\frac{1}{2}),\\\\\n2, x\\in(\\frac{1}{2},1),\n\\end{cases}\n\\qquad f(x)\\equiv 1,\n$$\nso that $a\\in L^{\\infty}(0,1)$ and $f\\in L^2(0,1)$. Using only these fundamentals, derive the weak formulation and construct the unique weak solution $u\\in H_0^1(0,1)$ explicitly by solving on the subintervals and enforcing interface conditions that are implied by the weak formulation and consistent with the treatment of internal interfaces in Discontinuous Galerkin (DG) methods. Prove that the resulting $u$ is not twice continuously differentiable on $(0,1)$.\n\nDefine the classical differentiability defect at the internal interface $x=\\frac{1}{2}$ to be the coefficient of the Dirac measure $\\delta_{1/2}$ in the distributional second derivative $u''$ when $u'$ has a jump across $x=\\frac{1}{2}$. Compute this defect exactly as a single rational number. No rounding is required, and no units are involved.",
            "solution": "The user wants me to solve a one-dimensional elliptic boundary value problem with a discontinuous coefficient.\n\nHere's a plan:\n1.  **Validate the Problem:**\n    *   **Extract Givens:** List the ODE, boundary conditions, domain, and the specific forms of the coefficient `a(x)` and the source term `f(x)`. Note the spaces they belong to.\n    *   **Check for Validity:**\n        *   **Scientifically Grounded:** The problem is a standard second-order elliptic BVP from the theory of PDEs. It's well-established in mathematics.\n        *   **Well-Posed:** The Lax-Milgram theorem guarantees a unique weak solution `u` in `H_0^1(0,1)` for this problem, as the bilinear form will be coercive and continuous, and the linear functional will be continuous.\n        *   **Objective:** The problem is stated in precise mathematical terms.\n        *   **Completeness:** All necessary information is provided.\n        *   **No other flaws:** The problem doesn't seem to have any other issues. It's a standard, well-posed problem in functional analysis and numerical analysis of PDEs.\n    *   **Verdict:** The problem is valid.\n\n2.  **Solve the Problem:**\n    *   **Step 1: Derive the Weak Formulation.**\n        *   Start with the strong form: `-(a(x) u'(x))' = f(x)` for `x in (0,1)`, with `u(0) = u(1) = 0`.\n        *   Multiply by a test function `v` from a suitable space. The space for `v` should be a space of functions that vanish at the boundaries, so `v(0) = v(1) = 0`. The natural choice is `v` in `H_0^1(0,1)`.\n        *   Integrate over the domain `Ω = (0,1)`: `∫_0^1 -(a(x) u'(x))' v(x) dx = ∫_0^1 f(x) v(x) dx`.\n        *   Integrate the left-hand side by parts:\n            `∫_0^1 a(x) u'(x) v'(x) dx - [a(x) u'(x) v(x)]_0^1 = ∫_0^1 f(x) v(x) dx`.\n        *   The boundary term `[a(x) u'(x) v(x)]_0^1` vanishes because `v(0) = v(1) = 0` for any `v` in `H_0^1(0,1)`.\n        *   The resulting weak formulation is: Find `u` in `H_0^1(0,1)` such that `∫_0^1 a(x) u'(x) v'(x) dx = ∫_0^1 f(x) v(x) dx` for all `v` in `H_0^1(0,1)`.\n\n    *   **Step 2: Construct the Explicit Solution.**\n        *   Since `a(x)` is piecewise constant, the solution `u(x)` will be piecewise smooth. Let `u_1(x)` be the solution on `(0, 1/2)` and `u_2(x)` be the solution on `(1/2, 1)`.\n        *   On `(0, 1/2)`, the equation is `-(1 * u_1')' = 1`, which is `-u_1'' = 1`.\n        *   On `(1/2, 1)`, the equation is `-(2 * u_2')' = 1`, which is `-2u_2'' = 1`, or `-u_2'' = 1/2`.\n        *   Integrate these equations twice.\n            *   `u_1''(x) = -1` - `u_1'(x) = -x + C_1` - `u_1(x) = -x^2/2 + C_1x + C_2`.\n            *   `u_2''(x) = -1/2` - `u_2'(x) = -x/2 + C_3` - `u_2(x) = -x^2/4 + C_3x + C_4`.\n        *   Now, apply the boundary and interface conditions to find the four constants `C_1, C_2, C_3, C_4`.\n        *   **Boundary Conditions:**\n            *   `u(0) = 0` - `u_1(0) = 0`. So, `-0^2/2 + C_1*0 + C_2 = 0` - `C_2 = 0`.\n            *   `u(1) = 0` - `u_2(1) = 0`. So, `-1^2/4 + C_3*1 + C_4 = 0` - `-1/4 + C_3 + C_4 = 0`.\n        *   **Interface Conditions at x = 1/2:**\n            *   What are the conditions? The weak formulation requires `u` to be in `H_0^1(0,1)`. A function in `H^1(0,1)` must be continuous. So, `u(x)` must be continuous across the interface `x = 1/2`.\n                *   `u_1(1/2) = u_2(1/2)`.\n            *   The weak formulation also implies a condition on the flux `a(x)u'(x)`. Let's derive this formally. In the weak form `∫_0^1 a u' v' dx = ∫_0^1 f v dx`, let's split the integral:\n                `∫_0^(1/2) a u' v' dx + ∫_(1/2)^1 a u' v' dx = ∫_0^1 f v dx`.\n                Now, integrate by parts back on each sub-interval.\n                `[-a u' v]_0^(1/2) + ∫_0^(1/2) (a u')' v dx + [-a u' v]_(1/2)^1 + ∫_(1/2)^1 (a u')' v dx = -∫_0^1 f v dx`\n                Wait, this is going backwards. The correct way to think about this is what the distributional derivative `-(a u')'` means.\n                For any test function `φ` in `C_c^∞(0,1)`, the distributional derivative is defined by:\n                ` -(a u')', φ  = -  (a u')', φ  =  a u', φ'  = ∫_0^1 a(x) u'(x) φ'(x) dx`.\n                If `u` is `C^2` on each sub-interval, we can integrate by parts on sub-intervals:\n                `∫_0^1 a u' φ' dx = ∫_0^(1/2) 1*u_1' φ' dx + ∫_(1/2)^1 2*u_2' φ' dx`\n                `= [u_1' φ]_0^(1/2) - ∫_0^(1/2) u_1'' φ dx + [2u_2' φ]_(1/2)^1 - ∫_(1/2)^1 2u_2'' φ dx`\n                Since `φ` has compact support, `φ(0)=φ(1)=0`.\n                `= u_1'(1/2)φ(1/2) - 0 - ∫_0^(1/2) u_1'' φ dx + 0 - 2u_2'(1/2)φ(1/2) - ∫_(1/2)^1 2u_2'' φ dx`\n                `= (u_1'(1/2) - 2u_2'(1/2)) φ(1/2) + ∫_0^(1/2) (-u_1'') φ dx + ∫_(1/2)^1 (-2u_2'') φ dx`\n                We also have `f, φ = ∫_0^1 f φ dx = ∫_0^(1/2) 1*φ dx + ∫_(1/2)^1 1*φ dx`.\n                So, `-(a u')' = f` in the sense of distributions means:\n                `∫_0^(1/2) (-u_1'') φ dx + ∫_(1/2)^1 (-2u_2'') φ dx + (a(1/2-)u'(1/2-) - a(1/2+)u'(1/2+)) φ(1/2) = ∫_0^1 f φ dx`.\n                The terms `-u_1''` and `-2u_2''` are equal to `f` (which is `1`) on their respective intervals.\n                So, this gives `∫_0^1 f φ dx + (u_1'(1/2) - 2u_2'(1/2)) φ(1/2) = ∫_0^1 f φ dx`.\n                This implies `(u_1'(1/2) - 2u_2'(1/2)) φ(1/2) = 0` for all test functions `φ`.\n                Therefore, we must have `u_1'(1/2) - 2u_2'(1/2) = 0`.\n                This is the continuity of the flux: `a(x)u'(x)` must be continuous at `x=1/2`.\n                This is a natural interface condition. This is precisely the kind of condition enforced weakly by DG methods across element boundaries. The jump in `a u'` is penalized. Here, for the exact solution, the jump must be zero.\n\n        *   **Summary of conditions:**\n            1. `C_2 = 0`\n            2. `-1/4 + C_3 + C_4 = 0`\n            3. `u_1(1/2) = u_2(1/2)`: `-(1/2)^2/2 + C_1(1/2) = -(1/2)^2/4 + C_3(1/2) + C_4`\n               `-1/8 + C_1/2 = -1/16 + C_3/2 + C_4`\n            4. `a(1/2-)u_1'(1/2) = a(1/2+)u_2'(1/2)`: `1 * u_1'(1/2) = 2 * u_2'(1/2)`\n               `1 * (-(1/2) + C_1) = 2 * (-(1/2)/2 + C_3)`\n               `-1/2 + C_1 = 2 * (-1/4 + C_3) = -1/2 + 2C_3` - `C_1 = 2C_3`.\n\n        *   **Solve the 4x4 system (actually simpler):**\n            *   We have `C_2 = 0`.\n            *   From (4), `C_1 = 2C_3`.\n            *   Substitute `C_1=2C_3` into (3):\n                `-1/8 + (2C_3)/2 = -1/16 + C_3/2 + C_4`\n                `-1/8 + C_3 = -1/16 + C_3/2 + C_4`\n                `C_3/2 - C_4 = 1/8 - 1/16 = 1/16`. So, `C_4 = C_3/2 - 1/16`.\n            *   Substitute this into (2):\n                `-1/4 + C_3 + (C_3/2 - 1/16) = 0`\n                `3C_3/2 = 1/4 + 1/16 = 4/16 + 1/16 = 5/16`\n                `C_3 = (5/16) * (2/3) = 10/48 = 5/24`.\n            *   Now find the other constants:\n                `C_1 = 2C_3 = 2 * (5/24) = 10/24 = 5/12`.\n                `C_4 = C_3/2 - 1/16 = (5/24)/2 - 1/16 = 5/48 - 3/48 = 2/48 = 1/24`.\n                `C_2 = 0`.\n\n        *   **Check the constants:**\n            `C_1 = 5/12`, `C_2 = 0`, `C_3 = 5/24`, `C_4 = 1/24`.\n            (2): `-1/4 + C_3 + C_4 = -1/4 + 5/24 + 1/24 = -6/24 + 6/24 = 0`. Correct.\n            (3): `-1/8 + C_1/2 = -3/24 + (5/12)/2 = -3/24 + 5/24 = 2/24 = 1/12`.\n                 `-1/16 + C_3/2 + C_4 = -3/48 + (5/24)/2 + 1/24 = -3/48 + 5/48 + 2/48 = 4/48 = 1/12`. Correct.\n            (4): `C_1 = 2C_3` - `5/12 = 2 * (5/24) = 10/24 = 5/12`. Correct.\n\n        *   **Explicit solution:**\n            `u(x) = { u_1(x) = -x^2/2 + (5/12)x,   for x in [0, 1/2]`\n                   `{ u_2(x) = -x^2/4 + (5/24)x + 1/24, for x in (1/2, 1]`\n\n    *   **Step 3: Prove u is not in C^2(0,1).**\n        *   Look at the second derivative.\n        *   `u_1'(x) = -x + 5/12` - `u_1''(x) = -1`.\n        *   `u_2'(x) = -x/2 + 5/24` - `u_2''(x) = -1/2`.\n        *   `u'(x)` is piecewise linear. Let's check `u'` at `x=1/2`.\n            *   `u_1'(1/2) = -1/2 + 5/12 = -6/12 + 5/12 = -1/12`.\n            *   `u_2'(1/2) = -(1/2)/2 + 5/24 = -1/4 + 5/24 = -6/24 + 5/24 = -1/24`.\n        *   Since `u_1'(1/2) ≠ u_2'(1/2)`, the first derivative `u'(x)` has a jump discontinuity at `x=1/2`.\n        *   Therefore, `u'(x)` is not differentiable at `x=1/2`, which means `u(x)` is not twice differentiable on `(0,1)`. Specifically, `u` is not in `C^1(0,1)`, let alone `C^2(0,1)`. The problem asks to show `u` is not `C^2`. Since `u` is not even `C^1`, it cannot be `C^2`.\n        *   Let's check the flux continuity again. `a(1/2-) u_1'(1/2) = 1 * (-1/12) = -1/12`. `a(1/2+) u_2'(1/2) = 2 * (-1/24) = -2/24 = -1/12`. The flux is continuous, but the derivative `u'` is not. This is expected due to the jump in `a(x)`.\n\n    *   **Step 4: Compute the Differentiability Defect.**\n        *   The problem defines this as the coefficient of the Dirac delta `δ_{1/2}` in the distributional second derivative `u''`.\n        *   Let `u'` be a function with a jump at `x=1/2`. Its distributional derivative `(u')'` is given by:\n            `(u')' = {u''} + [u']_{1/2} δ_{1/2}`, where `{u''}` is the classical derivative where it exists (piecewise), and `[u']_{1/2}` is the jump in `u'` at `x=1/2`.\n        *   The jump `[u']_{1/2}` is defined as `u'(1/2+) - u'(1/2-)`.\n        *   In our case, `u'(1/2+)` is the limit from the right, i.e., `u_2'(1/2)`. And `u'(1/2-)` is the limit from the left, i.e., `u_1'(1/2)`.\n        *   Jump `[u']_{1/2} = u_2'(1/2) - u_1'(1/2) = (-1/24) - (-1/12) = -1/24 + 2/24 = 1/24`.\n        *   The distributional second derivative is `u'' = { -1, x  1/2; -1/2, x  1/2 } + (1/24) δ_{1/2}`.\n        *   The problem asks for the \"coefficient of the Dirac measure `δ_{1/2}` in the distributional second derivative `u''`\". This is precisely the jump `[u']_{1/2}`.\n        *   The value is `1/24`.\n\nLet me double check the derivation of the distributional derivative formula.\nLet `u'` be given by `u'(x) = g(x) + J H(x-c)`, where `g` is a smooth function, `H` is the Heaviside step function, and `J` is the jump size at `c`.\nThe derivative of `u'` is `u'' = g'(x) + J δ(x-c)`.\nIn our case, `u'(x)` is not in this form. `u'(x)` is `u_1'(x)` for `x1/2` and `u_2'(x)` for `x1/2`.\nWe can write `u'(x) = u_1'(x) + (u_2'(x) - u_1'(x)) H(x - 1/2)`.\nLet's compute the distributional derivative of this expression, `(u')'`.\nFor a test function `φ` in `C_c^∞(0,1)`:\n` (u')', φ  = -  u', φ' `\n`= - ∫_0^1 u'(x) φ'(x) dx`\n`= - [ ∫_0^(1/2) u_1'(x) φ'(x) dx + ∫_(1/2)^1 u_2'(x) φ'(x) dx ]`\nIntegrate by parts on each sub-interval:\n`= - [ ([u_1' φ]_0^(1/2) - ∫_0^(1/2) u_1'' φ dx) + ([u_2' φ]_(1/2)^1 - ∫_(1/2)^1 u_2'' φ dx) ]`\nSince `φ(0)=φ(1)=0`:\n`= - [ u_1'(1/2)φ(1/2) - ∫_0^(1/2) u_1'' φ dx - u_2'(1/2)φ(1/2) - ∫_(1/2)^1 u_2'' φ dx ]`\n`= ∫_0^(1/2) u_1'' φ dx + ∫_(1/2)^1 u_2'' φ dx - (u_1'(1/2) - u_2'(1/2)) φ(1/2)`\n`= ∫_0^(1/2) u_1'' φ dx + ∫_(1/2)^1 u_2'' φ dx + (u_2'(1/2) - u_1'(1/2)) φ(1/2)`\nThis corresponds to the distribution:\n`u_{classical}'' + [u']_{1/2} δ_{1/2}`\nwhere `[u']_{1/2} = u'(1/2+) - u'(1/2-) = u_2'(1/2) - u_1'(1/2)`.\nThis confirms my reasoning.\n\nThe problem asks for the defect as a single rational number. `1/24` is a single rational number.\nThe overall structure of the solution should be:\n1.  **Problem Validation:** State it's valid.\n2.  **Weak Formulation:** Derive `∫ a u' v' dx = ∫ f v dx`.\n3.  **Classical Problem on Subintervals:** State the ODEs for `u_1` and `u_2`.\n4.  **Interface Conditions:** Justify the continuity of `u` and the continuity of the flux `a u'` from the weak formulation. This is a key step. The requirement `u in H_0^1` implies `u` is continuous. The flux condition comes from integrating by parts against a test function on subdomains.\n5.  **Solve for the explicit solution:** Solve the system of equations for the integration constants.\n6.  **Analyze Differentiability:** Show that `u'` is discontinuous at `x=1/2` by computing the left and right limits. Conclude `u` is not `C^2`.\n7.  **Compute the Defect:** Calculate the jump `[u']_{1/2} = u'(1/2+) - u'(1/2-)` which is the coefficient of the Dirac delta in the distributional second derivative.\n\nLet's check the wording of the problem carefully.\n\"...enforcing interface conditions that are implied by the weak formulation and consistent with the treatment of internal interfaces in Discontinuous Galerkin (DG) methods.\"\nMy derived conditions are:\n1.  Continuity of `u`: `[u] = 0`. DG methods do *not* enforce this strongly. They allow jumps in u and penalize them. However, for the *exact weak solution* in `H^1`, continuity is required. So this is the correct condition for the `H^1`-conforming solution.\n2.  Continuity of the flux `a u'`: `[a u'] = 0`. This is a natural condition. In DG methods, the numerical flux is designed to be single-valued, which enforces this condition weakly. For example, the average of the flux `{a∇u}` is used. For the exact solution, the flux must be continuous. So my derivation is correct. The problem is asking to derive the `H^1` weak solution, not a DG approximation. The mention of DG is to hint at the nature of the interface conditions.\n\n\"...Define the classical differentiability defect at the internal interface $x=\\tfrac{1}{2}$ to be the coefficient of the Dirac measure $\\delta_{1/2}$ in the distributional second derivative $u''$ when $u'$ has a jump across $x=\\tfrac{1}{2}$.\"\nThis is a specific definition provided in the problem. I need to compute this value.\nMy calculation was `[u']_{1/2} = u_2'(1/2) - u_1'(1/2) = 1/24`. This matches the definition.\n\nThe whole derivation seems solid. I will now write it down, ensuring all mathematical entities are in LaTeX.\n\n**Summary of the plan:**\n1.  **Validation:** The problem is a standard, well-posed BVP in PDE theory, so it's valid.\n2.  **Solution:**\n    *   Derive the weak formulation: Find $u \\in H_0^1(0,1)$ such that $\\int_0^1 a(x)u'(x)v'(x) \\,dx = \\int_0^1 f(x)v(x) \\,dx$ for all $v \\in H_0^1(0,1)$.\n    *   Solve the classical ODEs piecewise:\n        *   For $x \\in (0, 1/2)$: $-u_1'' = 1 \\implies u_1(x) = -x^2/2 + C_1 x + C_2$.\n        *   For $x \\in (1/2, 1)$: $-2u_2'' = 1 \\implies u_2(x) = -x^2/4 + C_3 x + C_4$.\n    *   Apply boundary and interface conditions:\n        *   $u(0) = 0 \\implies u_1(0) = 0 \\implies C_2 = 0$.\n        *   $u(1) = 0 \\implies u_2(1) = 0 \\implies -1/4 + C_3 + C_4 = 0$.\n        *   Continuity of $u$ at $x=1/2$ (since $u \\in H^1(0,1)$): $u_1(1/2) = u_2(1/2)$.\n           $-(1/2)^2/2 + C_1/2 = -(1/2)^2/4 + C_3/2 + C_4$.\n        *   Continuity of flux $a(x)u'(x)$ at $x=1/2$ (implied by weak form): $1 \\cdot u_1'(1/2) = 2 \\cdot u_2'(1/2)$.\n           $-1/2 + C_1 = 2(- (1/2)/2 + C_3) \\implies C_1 = 2C_3$.\n    *   Solve the system for $C_1, C_2, C_3, C_4$. The solution was:\n        $C_1 = 5/12$, $C_2 = 0$, $C_3 = 5/24$, $C_4 = 1/24$.\n    *   Write the explicit solution $u(x)$.\n    *   Show $u \\notin C^2(0,1)$ by showing $u' \\notin C^1(0,1)$ because $u'$ has a jump at $x=1/2$.\n        *   $u_1'(1/2) = -1/12$.\n        *   $u_2'(1/2) = -1/24$.\n        *   Since these are not equal, $u'$ is discontinuous.\n    *   Compute the defect. The defect is defined as the jump in $u'$ at $x=1/2$.\n        *   Defect = $[u']_{1/2} = u'(1/2+) - u'(1/2-) = u_2'(1/2) - u_1'(1/2)$.\n        *   Defect = $(-1/24) - (-1/12) = -1/24 + 2/24 = 1/24$.\n\nThe logic is sound. I will follow this line of reasoning in the final output, being careful with the LaTeX formatting rules.\nEvery number, variable, operator, needs to be in LaTeX.\ne.g. $1$, $2$, $x$, $\\Omega$, $(0,1)$, $f(x)$, $u(x)$, $u'(x)$, $u(0)=0$.\nThe problem statement itself is a good guide.\n\"Let $\\Omega=(0,1)$ and consider the scalar, second-order elliptic boundary value problem for a function $u:\\Omega\\to\\mathbb{R}$,\"\nSo I will write `$\\Omega=(0,1)$` not just `(0,1)`.\nThe coefficient `a(x)` is given in a cases environment. I will represent it similarly.\nThe value `1/2` should be `\\frac{1}{2}`.\nThe final answer is a single rational number, `1/24`, so it should be `\\boxed{\\frac{1}{24}}`.\nThe question involves concepts from Sobolev spaces, variational formulations, and distributional derivatives, so the answer must be precise in its use of these concepts.\nThe justification for the interface conditions is the most subtle part and must be handled carefully. The problem statement explicitly asks for this connection.\nThe requirement that $u \\in H_0^1(0,1)$ is key. By the Sobolev embedding theorem, for one dimension, $H^1(0,1) \\hookrightarrow C^0([0,1])$, meaning any function in $H^1(0,1)$ is (equivalent to) a continuous function. This directly gives the interface condition $u_1(1/2) = u_2(1/2)$.\nThe second interface condition, continuity of the flux $a(x)u'(x)$, is derived from the weak formulation itself, as I did in my scratchpad. This is the crucial part that relates to DG methods, where this flux continuity is a central concept handled by numerical fluxes at interfaces.\nEverything seems correct. I am ready to write the solution.",
            "answer": "$$\n\\boxed{\\frac{1}{24}}\n$$"
        },
        {
            "introduction": "Once the concept of a weak formulation is established, the next step is to develop methods for finding approximate solutions. This exercise guides you through the process of constructing a spectral Galerkin approximation for the Poisson problem, a fundamental technique in the numerical analysis of PDEs . You will translate the continuous weak problem into a finite-dimensional linear system by deriving the stiffness and mass matrices for a specific basis of Legendre polynomials designed to satisfy the boundary conditions, gaining practical experience with a powerful high-order numerical method.",
            "id": "3370462",
            "problem": "Consider the second-order Poisson boundary value problem on the interval $\\Omega = (-1,1)$ with homogeneous Dirichlet boundary conditions: find a function $u$ such that\n- $-u'' = f$ in $\\Omega$,\n- $u(-1) = 0$ and $u(1) = 0$.\nFormulate the weak problem: find $u \\in H_{0}^{1}(-1,1)$ such that for all $v \\in H_{0}^{1}(-1,1)$,\n$$\n\\int_{-1}^{1} u'(x)\\,v'(x)\\,dx \\;=\\; \\int_{-1}^{1} f(x)\\,v(x)\\,dx.\n$$\nConstruct a spectral Galerkin approximation using a Legendre polynomial-based basis that enforces the boundary conditions. Let $\\{P_{n}\\}_{n \\ge 0}$ denote the Legendre polynomials on $[-1,1]$, and recall the fundamental properties:\n- Orthogonality: $\\displaystyle \\int_{-1}^{1} P_{n}(x)\\,P_{m}(x)\\,dx \\;=\\; \\frac{2}{2n+1}\\,\\delta_{nm}$ for all integers $n,m \\ge 0$.\n- Sturm–Liouville equation: $\\displaystyle \\frac{d}{dx}\\Big((1-x^{2})\\,P_{n}'(x)\\Big) + n(n+1)\\,P_{n}(x) \\;=\\; 0$.\n- Endpoint values: $\\displaystyle P_{n}(1) = 1$, $\\displaystyle P_{n}(-1) = (-1)^{n}$, for all integers $n \\ge 0$.\nDefine the trial and test space $V_{N} = \\operatorname{span}\\{\\phi_{k}\\}_{k=0}^{N-1}$ with\n$$\n\\phi_{k}(x) \\;=\\; P_{k+2}(x) - P_{k}(x), \\quad k=0,1,\\dots,N-1,\n$$\nand seek $u_{N}(x) = \\sum_{k=0}^{N-1} \\widehat{u}_{k}\\,\\phi_{k}(x) \\in V_{N}$ satisfying the Galerkin equations for all $\\phi_{j} \\in V_{N}$:\n$$\n\\int_{-1}^{1} u_{N}'(x)\\,\\phi_{j}'(x)\\,dx \\;=\\; \\int_{-1}^{1} f(x)\\,\\phi_{j}(x)\\,dx, \\quad j=0,1,\\dots,N-1.\n$$\n- Derive the resulting linear system in matrix form with the stiffness matrix $A \\in \\mathbb{R}^{N \\times N}$ and the mass matrix $M \\in \\mathbb{R}^{N \\times N}$ defined by\n$$\nA_{ij} \\;=\\; \\int_{-1}^{1} \\phi_{i}'(x)\\,\\phi_{j}'(x)\\,dx, \n\\qquad \nM_{ij} \\;=\\; \\int_{-1}^{1} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx,\n$$\nand identify their sparsity patterns.\n- Compute explicit analytic formulas for the entries of $A$ and $M$ in terms of $i$ and $j$.\nYour final reported answer must be a single closed-form analytic expression: the general diagonal stiffness entry $A_{nn}$ as a function of $n$. Do not include units. Do not round.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Governing Equation:** $-u'' = f$ on the domain $\\Omega = (-1,1)$.\n- **Boundary Conditions:** $u(-1) = 0$ and $u(1) = 0$.\n- **Weak Formulation:** Find $u \\in H_{0}^{1}(-1,1)$ such that $\\int_{-1}^{1} u'(x)\\,v'(x)\\,dx = \\int_{-1}^{1} f(x)\\,v(x)\\,dx$ for all $v \\in H_{0}^{1}(-1,1)$.\n- **Trial and Test Space:** $V_{N} = \\operatorname{span}\\{\\phi_{k}\\}_{k=0}^{N-1}$.\n- **Basis Functions:** $\\phi_{k}(x) = P_{k+2}(x) - P_{k}(x)$ for $k=0,1,\\dots,N-1$.\n- **Legendre Polynomial Properties:**\n    - Orthogonality: $\\int_{-1}^{1} P_{n}(x)\\,P_{m}(x)\\,dx = \\frac{2}{2n+1}\\,\\delta_{nm}$.\n    - Sturm–Liouville equation: $\\frac{d}{dx}\\Big((1-x^{2})\\,P_{n}'(x)\\Big) + n(n+1)\\,P_{n}(x) = 0$.\n    - Endpoint values: $P_{n}(1) = 1$, $P_{n}(-1) = (-1)^{n}$.\n- **Approximate Solution:** $u_{N}(x) = \\sum_{k=0}^{N-1} \\widehat{u}_{k}\\,\\phi_{k}(x)$.\n- **Galerkin Equations:** $\\int_{-1}^{1} u_{N}'(x)\\,\\phi_{j}'(x)\\,dx = \\int_{-1}^{1} f(x)\\,\\phi_{j}(x)\\,dx$, for $j=0,1,\\dots,N-1$.\n- **Matrix Definitions:**\n    - Stiffness Matrix: $A_{ij} = \\int_{-1}^{1} \\phi_{i}'(x)\\,\\phi_{j}'(x)\\,dx$.\n    - Mass Matrix: $M_{ij} = \\int_{-1}^{1} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as it deals with the well-established spectral Galerkin method for solving a Poisson boundary value problem. It is objective and well-posed. The provided information is self-contained and sufficient for a unique solution. First, we verify that the basis functions $\\phi_k(x)$ satisfy the homogeneous Dirichlet boundary conditions. Using the given endpoint values of Legendre polynomials:\nFor $x=1$: $\\phi_{k}(1) = P_{k+2}(1) - P_{k}(1) = 1 - 1 = 0$.\nFor $x=-1$: $\\phi_{k}(-1) = P_{k+2}(-1) - P_{k}(-1) = (-1)^{k+2} - (-1)^{k} = (-1)^{k} - (-1)^{k} = 0$.\nThus, any function in the trial space $V_N$ satisfies the boundary conditions $u_N(-1)=u_N(1)=0$. All givens are consistent and standard in the field of numerical analysis. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed to the solution.\n\nThe Galerkin formulation seeks a solution $u_{N}(x) = \\sum_{i=0}^{N-1} \\widehat{u}_{i}\\,\\phi_{i}(x)$ such that\n$$\n\\sum_{i=0}^{N-1} \\widehat{u}_{i} \\int_{-1}^{1} \\phi_{i}'(x)\\,\\phi_{j}'(x)\\,dx = \\int_{-1}^{1} f(x)\\,\\phi_{j}(x)\\,dx, \\quad \\text{for } j=0,1,\\dots,N-1.\n$$\nThis can be written as a linear system of equations $A\\widehat{u} = \\vec{b}$, where $A$ is the stiffness matrix with entries $A_{ji} = \\int_{-1}^{1} \\phi_{i}'(x)\\,\\phi_{j}'(x)\\,dx$, $\\widehat{u} = [\\widehat{u}_0, \\dots, \\widehat{u}_{N-1}]^T$ is the vector of unknown coefficients, and $\\vec{b}$ is the load vector with entries $b_j = \\int_{-1}^{1} f(x)\\,\\phi_{j}(x)\\,dx$. Note that the stiffness matrix is symmetric, $A_{ij} = A_{ji}$. We are asked to derive the entries of the stiffness matrix $A$ and the mass matrix $M$.\n\nFirst, we compute the entries of the stiffness matrix $A$. The key is to find a compact expression for the derivative of the basis functions, $\\phi_k'(x)$. We use the standard three-term recurrence relation for the derivatives of Legendre polynomials:\n$$\nP_{n+1}'(x) - P_{n-1}'(x) = (2n+1)P_n(x).\n$$\nThe derivative of our basis function $\\phi_k(x)$ is $\\phi_k'(x) = P_{k+2}'(x) - P_k'(x)$. By setting $n=k+1$ in the recurrence relation, we obtain:\n$$\nP_{k+2}'(x) - P_k'(x) = (2(k+1)+1)P_{k+1}(x) = (2k+3)P_{k+1}(x).\n$$\nThus, we have the remarkably simple expression $\\phi_k'(x) = (2k+3)P_{k+1}(x)$.\n\nNow we can compute the stiffness matrix entries $A_{ij}$:\n$$\nA_{ij} = \\int_{-1}^{1} \\phi_{i}'(x)\\,\\phi_{j}'(x)\\,dx = \\int_{-1}^{1} \\Big((2i+3)P_{i+1}(x)\\Big) \\Big((2j+3)P_{j+1}(x)\\Big)\\,dx.\n$$\n$$\nA_{ij} = (2i+3)(2j+3) \\int_{-1}^{1} P_{i+1}(x)P_{j+1}(x)\\,dx.\n$$\nUsing the orthogonality property of Legendre polynomials, $\\int_{-1}^{1} P_n(x)P_m(x)dx = \\frac{2}{2n+1}\\delta_{nm}$:\n$$\n\\int_{-1}^{1} P_{i+1}(x)P_{j+1}(x)\\,dx = \\frac{2}{2(i+1)+1}\\,\\delta_{i+1,j+1} = \\frac{2}{2i+3}\\,\\delta_{ij}.\n$$\nSubstituting this back into the expression for $A_{ij}$:\n$$\nA_{ij} = (2i+3)(2j+3) \\left(\\frac{2}{2i+3}\\,\\delta_{ij}\\right).\n$$\nSince $\\delta_{ij}$ is non-zero only if $i=j$, we can replace $j$ with $i$:\n$$\nA_{ij} = (2i+3)(2i+3) \\left(\\frac{2}{2i+3}\\,\\delta_{ij}\\right) = 2(2i+3)\\delta_{ij}.\n$$\nThe stiffness matrix $A$ is therefore a diagonal matrix. Its sparsity pattern is diagonal, with all off-diagonal entries being zero. The diagonal entry $A_{nn}$ is given by $A_{nn} = 2(2n+3)$ for $n=0, 1, \\dots, N-1$.\n\nNext, we compute the entries of the mass matrix $M$:\n$$\nM_{ij} = \\int_{-1}^{1} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx = \\int_{-1}^{1} \\Big(P_{i+2}(x) - P_i(x)\\Big) \\Big(P_{j+2}(x) - P_j(x)\\Big)\\,dx.\n$$\nExpanding the product, we get four terms:\n$$\nM_{ij} = \\int_{-1}^{1} P_{i+2}P_{j+2}\\,dx - \\int_{-1}^{1} P_{i+2}P_{j}\\,dx - \\int_{-1}^{1} P_{i}P_{j+2}\\,dx + \\int_{-1}^{1} P_{i}P_{j}\\,dx.\n$$\nApplying the orthogonality property to each term:\n$$\nM_{ij} = \\frac{2}{2(i+2)+1}\\delta_{i+2,j+2} - \\frac{2}{2(i+2)+1}\\delta_{i+2,j} - \\frac{2}{2i+1}\\delta_{i,j+2} + \\frac{2}{2i+1}\\delta_{i,j}.\n$$\nSimplifying the Kronecker deltas and denominators:\n$$\nM_{ij} = \\frac{2}{2i+5}\\delta_{i,j} - \\frac{2}{2i+5}\\delta_{i+2,j} - \\frac{2}{2i+1}\\delta_{i,j+2} + \\frac{2}{2i+1}\\delta_{i,j}.\n$$\nCombining the terms with $\\delta_{ij}$:\n$$\nM_{ij} = \\left(\\frac{2}{2i+1} + \\frac{2}{2i+5}\\right)\\delta_{ij} - \\frac{2}{2i+5}\\delta_{j,i+2} - \\frac{2}{2i+1}\\delta_{j,i-2}.\n$$\nThis expression shows that $M_{ij}$ is non-zero only when $j=i$, $j=i+2$, or $j=i-2$. Therefore, the mass matrix $M$ is a symmetric pentadiagonal matrix (the non-zero entries are on the main diagonal and the second super- and sub-diagonals).\nThe explicit entries are:\n-   Diagonal ($j=i$): $M_{ii} = \\frac{2}{2i+1} + \\frac{2}{2i+5}$.\n-   Second super-diagonal ($j=i+2$): $M_{i,i+2} = -\\frac{2}{2i+5}$.\n-   Second sub-diagonal ($j=i-2$): $M_{i,i-2} = -\\frac{2}{2(i-2)+1}\\delta_{i-2,j+2}$ is not from this formula. My last formula in the thought process was slightly incorrect. The correct one is the one before: $M_{ij} = \\left(\\frac{2}{2i+1} + \\frac{2}{2i+5}\\right)\\delta_{ij} - \\frac{2}{2i+5}\\delta_{i+2,j} - \\frac{2}{2i+1}\\delta_{i,j+2}$.\nLet's check this formula which is derived directly. For $j=i-2$, this formula gives $M_{i,i-2} = - \\frac{2}{2(i-2)+1}\\delta_{i-2,i-2+2} = -\\frac{2}{2i-3}$. No, that's wrong. Let's use the formula with indices $i, j$: $M_{i,i-2} = 0 - 0 - \\frac{2}{2i+1}\\delta_{i, i-2+2} = -\\frac{2}{2i+1}$. This is correct.\nThe mass matrix $M$ is symmetric with non-zero entries:\n$$\nM_{i,j} =\n\\begin{cases}\n\\frac{2}{2i+1} + \\frac{2}{2i+5}  \\text{if } j=i \\\\\n-\\frac{2}{2i+5}  \\text{if } j=i+2 \\\\\n-\\frac{2}{2j+5}  \\text{if } j=i-2 \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n(Note that for $j=i-2$, $2j+5=2(i-2)+5=2i+1$, so $M_{i,i-2}=-\\frac{2}{2i-3}$. No, wait. $M_{i-2,i}=-\\frac{2}{2(i-2)+5}=-\\frac{2}{2i-1+2} = -\\frac{2}{2i+1}$. And $M_{i, i-2} = -\\frac{2}{2i+1}$. Yes, they match.)\n\nThe final question asks only for the general diagonal stiffness entry $A_{nn}$. From our derivation $A_{ij} = 2(2i+3)\\delta_{ij}$, the diagonal entry for index $n$ is obtained by setting $i=j=n$.\n\n$A_{nn} = 2(2n+3)$.",
            "answer": "$$\\boxed{2(2n+3)}$$"
        },
        {
            "introduction": "Spectral methods offer exceptional accuracy for smooth problems, but their behavior becomes more complex when approximating functions with discontinuities, which are common in the study of weak solutions. This computational exercise explores the famous Gibbs phenomenon, where pointwise convergence fails at jumps, and contrasts this with convergence in a weaker norm that is often more relevant for numerical analysis . You will implement a modal filtering technique, a standard practice in Discontinuous Galerkin and spectral methods, to see how it can mitigate spurious oscillations and improve the quality of the numerical solution.",
            "id": "3370457",
            "problem": "Consider the periodic interval $[0,2\\pi)$ and a real-valued piecewise smooth function $u(x)$ with at most finitely many jump discontinuities. Let $\\{e^{\\mathrm{i}k x}\\}_{k\\in\\mathbb{Z}}$ denote the complex Fourier basis on $[0,2\\pi)$, and let the Fourier coefficients of $u$ be $c_k = \\frac{1}{2\\pi} \\int_0^{2\\pi} u(x)\\,e^{-\\mathrm{i}k x}\\,\\mathrm{d}x$. The $N$-mode truncated spectral approximation is the partial sum $u_N(x) = \\sum_{|k|\\le N} c_k e^{\\mathrm{i}k x}$. For piecewise smooth $u$, classical pointwise convergence fails at jumps (Gibbs phenomenon), even though $u_N \\to u$ in the $L^2$ norm. A standard stabilization in spectral and Discontinuous Galerkin (DG) methods is modal filtering: damp higher modes via a filter $\\varphi(k)$ applied to the modal coefficients before reconstruction.\n\nFundamental base for this task:\n- Definition of Fourier coefficients $c_k$ on $[0,2\\pi)$ and truncated Fourier series $u_N(x)$.\n- Concept of weak solutions: distributions pairing with smooth test functions; weak norms such as the negative Sobolev norm quantify convergence in a weak sense.\n- The $H^{-1}$-type weak norm is induced by the dual pairing with $H^1$ test functions and is computable from Fourier coefficients through weights $1/|k|$ for $k\\neq 0$.\n\nYour task is to implement, for several test cases, the following quantitative comparison between a classical error and a weak consistency error, and to demonstrate the effect of modal filtering, which is standard in DG when using a modal basis (for example, Legendre or Fourier modes) to suppress spurious high-frequency oscillations around discontinuities:\n\n1. Domain and sampling. Work on the periodic domain $[0,2\\pi)$, with angles in radians. Use a uniform grid of $G$ points, with $G=65536$, i.e., sample at $x_j = \\frac{2\\pi j}{G}$ for $j=0,1,\\dots,G-1$.\n\n2. Modal approximation. For each test case, approximate the Fourier coefficients $c_k$ numerically by the composite trapezoidal rule via the discrete Fourier transform on the grid. Construct $u_N(x)$ by truncating to modes $|k|\\le N$.\n\n3. Modal filtering. Define a modal filter by $\\varphi(k) = \\exp\\!\\big(-\\alpha \\, (|k|/N)^s\\big)$ for $|k|\\le N$ and $\\varphi(k)=0$ for $|k|>N$, where $\\alpha>0$ is the filter strength and $s$ is the filter order. Apply this $\\varphi(k)$ to the discrete Fourier coefficients before reconstruction to obtain the filtered approximation $u_N^{\\mathrm{f}}(x)$.\n\n4. Errors to quantify.\n   - Classical pointwise error (supremum norm on grid): $E_{\\infty}(u_N) = \\max_j |u_N(x_j) - u(x_j)|$ and $E_{\\infty}(u_N^{\\mathrm{f}}) = \\max_j |u_N^{\\mathrm{f}}(x_j) - u(x_j)|$.\n   - Weak consistency error encoded by an $H^{-1}$-type norm computed from discrete Fourier coefficients. If $e(x)=u_{\\star}(x)-u(x)$ denotes the error, let $\\widehat{e}_k$ denote the discrete Fourier coefficients of $e$ approximating the continuous $c_k$; then compute\n     $$\\|e\\|_{H^{-1}} \\approx \\left(\\sum_{k\\in\\mathbb{Z}\\setminus\\{0\\}} \\frac{|\\widehat{e}_k|^2}{k^2}\\right)^{1/2}.$$\n     Report $E_{-1}(u_N)$ and $E_{-1}(u_N^{\\mathrm{f}})$ computed in this way. This is a weak error in the sense of distributions, as it downweights high-frequency content by $1/|k|$ and corresponds to testing against gradients of smooth functions, mirroring the weak form in DG methods.\n\n5. Test suite. Implement the following four test cases, each executed on the same grid of $G=65536$ points:\n   - Test case $1$: $u_1(x) = \\sin(x) + H(x-\\pi)$, where $H(y)=0$ for $y0$ and $H(y)=1$ for $y\\ge 0$; with $N=8$, $s=8$, $\\alpha=36$.\n   - Test case $2$: $u_1(x)$ as above; with $N=64$, $s=8$, $\\alpha=36$.\n   - Test case $3$: $u_2(x) = |\\sin(x)|$; with $N=16$, $s=8$, $\\alpha=36$.\n   - Test case $4$: $u_3(x) = \\begin{cases}-1, x\\in[0,\\pi)\\\\ 1, x\\in[\\pi,2\\pi)\\end{cases}$; with $N=32$, $s=8$, $\\alpha=36$.\n\n6. Output specification. For each test case, compute the four floats in the order\n   $[$E_{\\infty}(u_N),\\, E_{\\infty}(u_N^{\\mathrm{f}}),\\, E_{-1}(u_N),\\, E_{-1}(u_N^{\\mathrm{f}})]$.\n   Your program should produce a single line of output containing the results for all four test cases as a comma-separated list of these lists, enclosed in square brackets. For example, the output format must be exactly like\n   $[[a_1,a_2,a_3,a_4],[b_1,b_2,b_3,b_4],[c_1,c_2,c_3,c_4],[d_1,d_2,d_3,d_4]]$\n   with no additional text. All numerical values are unitless real numbers.\n\nThe intent is to reason from foundational definitions: the Fourier expansion and truncation define the spectral approximation; DG-style modal filtering is realized here through damping of higher modal coefficients; the weak consistency error is quantified in the negative Sobolev norm that corresponds to distributional testing, in contrast to the classical pointwise error which exhibits Gibbs oscillations. Ensure that your implementation adheres strictly to the sampling, filtering, and error definitions given above and uses the specified grid and parameter values as the test suite for objective evaluation. The solution should be universal and purely mathematical, requiring no physical units.",
            "solution": "The problem statement is a valid, well-posed exercise in numerical analysis, specifically in the context of spectral methods for functions with discontinuities. It requires the implementation and comparison of two error metrics—one classical and one weak—for truncated and filtered Fourier series approximations. All provided definitions, parameters, and functions are mathematically sound and computationally feasible. We may therefore proceed with a full solution.\n\nThe core of this problem lies in the contrasting behavior of different error norms when approximating non-smooth functions. The classical pointwise supremum norm, denoted $E_{\\infty}$, is highly sensitive to localized phenomena such as the Gibbs overshoot at a jump discontinuity. In contrast, a weak norm, such as the $H^{-1}$-type norm denoted $E_{-1}$, measures error in a \"smeared-out\" or distributional sense, making it less sensitive to high-frequency oscillations and more indicative of the approximation's quality as a weak solution.\n\nOur objective is to quantify this contrast for several test functions by following a precise computational procedure.\n\n**1. Discretization and Fourier Analysis**\n\nWe work on the periodic domain $[0, 2\\pi)$. The continuous function $u(x)$ is sampled on a uniform grid of $G=65536$ points, $x_j = \\frac{2\\pi j}{G}$ for $j=0, 1, \\dots, G-1$. The Fourier coefficients $c_k = \\frac{1}{2\\pi} \\int_0^{2\\pi} u(x) e^{-\\mathrm{i}kx} \\mathrm{d}x$ are approximated numerically using the discrete Fourier transform (DFT). For a periodic function on a uniform grid, the composite trapezoidal rule for the integral is spectrally accurate and corresponds to calculating the DFT of the sampled values:\n$$\n\\widehat{c}_k = \\frac{1}{G} \\sum_{j=0}^{G-1} u(x_j) e^{-\\mathrm{i} k x_j} = \\frac{1}{G} \\sum_{j=0}^{G-1} u(x_j) e^{-2\\pi\\mathrm{i}kj/G}\n$$\nThese discrete coefficients $\\widehat{c}_k$ are computed efficiently using the Fast Fourier Transform (FFT) algorithm. The integer wavenumbers $k$ are managed such that they correspond to the modes $\\{e^{\\mathrm{i}kx}\\}_{k \\in \\mathbb{Z}}$. In our implementation, we will use `numpy.fft.fft` to compute the sum, followed by division by $G$, and `numpy.fft.fftfreq` and `numpy.fft.fftshift` to arrange the coefficients $\\widehat{c}_k$ and their corresponding wavenumbers $k$ in a monotonically increasing order, from $-G/2+1$ to $G/2$.\n\n**2. Construction of Spectral Approximations**\n\nGiven the discrete Fourier coefficients $\\widehat{c}_k$ of the exact solution $u(x)$, we construct two approximations.\n\nFirst, the standard $N$-mode truncated spectral approximation, $u_N(x)$, is formed by retaining only the modes for which $|k| \\le N$. Its Fourier coefficients, $\\widehat{(u_N)}_k$, are:\n$$\n\\widehat{(u_N)}_k = \\begin{cases} \\widehat{c}_k  \\text{if } |k| \\le N \\\\ 0  \\text{if } |k| > N \\end{cases}\n$$\nThis represents a sharp, or \"boxcar,\" filter in the frequency domain. The spatial representation $u_N(x_j)$ on the grid is recovered by applying the inverse DFT (via the IFFT algorithm) to the coefficient set $\\{\\widehat{(u_N)}_k\\}$.\n\nSecond, the filtered approximation, $u_N^{\\mathrm{f}}(x)$, is constructed to mitigate the Gibbs phenomenon. This is achieved by applying a smooth exponential filter to the coefficients of $u_N(x)$ before reconstruction:\n$$\n\\varphi(k) = \\exp\\left(-\\alpha \\left(\\frac{|k|}{N}\\right)^s\\right) \\quad \\text{for } |k| \\le N\n$$\nThe Fourier coefficients of the filtered approximation, $\\widehat{(u_N^{\\mathrm{f}})}_k$, are:\n$$\n\\widehat{(u_N^{\\mathrm{f}})}_k = \\varphi(k) \\widehat{(u_N)}_k = \\begin{cases} \\widehat{c}_k \\exp\\left(-\\alpha \\left(\\frac{|k|}{N}\\right)^s\\right)  \\text{if } |k| \\le N \\\\ 0  \\text{if } |k| > N \\end{cases}\n$$\nThis filter smoothly damps higher-frequency modes near the cutoff $N$, which is known to reduce the amplitude of spurious oscillations in the spatial domain. The spatial representation $u_N^{\\mathrm{f}}(x_j)$ is then recovered via the inverse DFT.\n\n**3. Error Quantification**\n\nWe compute two distinct error metrics for each approximation.\n\nThe pointwise error is measured in the discrete supremum norm on the grid:\n$$\nE_{\\infty}(u_{\\star}) = \\max_{j} |u_{\\star}(x_j) - u(x_j)|\n$$\nwhere $u_{\\star}$ is either $u_N$ or $u_N^{\\mathrm{f}}$. This norm captures the single worst deviation and is thus dominated by the peak of the Gibbs oscillations near discontinuities.\n\nThe weak consistency error is measured in a discrete $H^{-1}$-type norm, computed from the Fourier coefficients of the error function $e(x) = u_{\\star}(x) - u(x)$. Let $\\widehat{e}_k$ be the coefficients of the error. The norm is defined as:\n$$\nE_{-1}(u_{\\star}) = \\|e\\|_{H^{-1}} \\approx \\left(\\sum_{k\\in\\mathbb{Z}\\setminus\\{0\\}} \\frac{|\\widehat{e}_k|^2}{k^2}\\right)^{1/2}\n$$\nThe factor of $1/k^2$ heavily penalizes low-frequency errors while down-weighting high-frequency discrepancies. This norm corresponds to the dual of the Sobolev space $H^1$, and measuring error in this norm is akin to testing against the derivatives of smooth functions, a fundamental concept in the theory of weak solutions and finite/discontinuous Galerkin element methods.\n\nTo compute this norm, we first need the Fourier coefficients of the error.\nFor the truncated error $e(x) = u_N(x) - u(x)$, the coefficients are:\n$$\n\\widehat{e}_k = \\widehat{(u_N)}_k - \\widehat{c}_k = \\begin{cases} 0  \\text{if } |k| \\le N \\\\ -\\widehat{c}_k  \\text{if } |k| > N \\end{cases}\n$$\nThus, the sum for its $H^{-1}$ norm is over $|k|>N$:\n$$\nE_{-1}(u_N) = \\left(\\sum_{|k|>N} \\frac{|-\\widehat{c}_k|^2}{k^2}\\right)^{1/2}\n$$\nFor the filtered error $e^{\\mathrm{f}}(x) = u_N^{\\mathrm{f}}(x) - u(x)$, the coefficients are:\n$$\n\\widehat{e^{\\mathrm{f}}}_k = \\widehat{(u_N^{\\mathrm{f}})}_k - \\widehat{c}_k = \\begin{cases} (\\varphi(k) - 1)\\widehat{c}_k  \\text{if } |k| \\le N \\\\ -\\widehat{c}_k  \\text{if } |k| > N \\end{cases}\n$$\nThe corresponding $H^{-1}$ norm involves a sum over two distinct regions:\n$$\nE_{-1}(u_N^{\\mathrm{f}}) = \\left(\\sum_{0|k|\\le N} \\frac{|(\\varphi(k)-1)\\widehat{c}_k|^2}{k^2} + \\sum_{|k|>N} \\frac{|-\\widehat{c}_k|^2}{k^2}\\right)^{1/2}\n$$\nThe first term represents the error introduced by the filter on the retained modes, while the second term is the truncation error, identical to that for $u_N$. This formulation reveals a key trade-off: filtering reduces the pointwise Gibbs oscillations (lowering $E_{\\infty}$) but introduces additional error in the retained modes, which can increase the weak norm $E_{-1}$.\n\nThe implementation will proceed by executing these steps for each of the four specified test cases, collecting the four resulting error values $[E_{\\infty}(u_N), E_{\\infty}(u_N^{\\mathrm{f}}), E_{-1}(u_N), E_{-1}(u_N^{\\mathrm{f}})]$ for each case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares classical pointwise and weak consistency errors for\n    spectral approximations of piecewise smooth functions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (case_id, N, s, alpha)\n        (1, 8, 8, 36),\n        (1, 64, 8, 36),\n        (2, 16, 8, 36),\n        (3, 32, 8, 36),\n    ]\n\n    G = 65536\n    # Define the computational grid on [0, 2*pi)\n    x = (2 * np.pi / G) * np.arange(G)\n\n    # Define the test functions\n    def u1(x_grid):\n        # u(x) = sin(x) + H(x-pi), where H is the Heaviside step function.\n        # H(y) = 1 for y = 0.\n        return np.sin(x_grid) + (x_grid = np.pi).astype(float)\n\n    def u2(x_grid):\n        # u(x) = |sin(x)|\n        return np.abs(np.sin(x_grid))\n\n    def u3(x_grid):\n        # u(x) = -1 for x in [0, pi), 1 for x in [pi, 2pi)\n        # On the grid, x=pi corresponds to index j=G/2.\n        # j  G/2 corresponds to x  pi.\n        res = np.ones_like(x_grid)\n        res[:G // 2] = -1.0\n        return res\n\n    u_funcs = {1: u1, 2: u2, 3: u3}\n    \n    all_results = []\n\n    for case_id, N, s, alpha in test_cases:\n        # 1. Sample the exact function on the grid\n        u_func = u_funcs[case_id]\n        u_grid = u_func(x)\n\n        # 2. Compute discrete Fourier coefficients (c_k) via FFT\n        # c_k = (1/G) * sum(u_j * exp(-i*k*x_j))\n        c_hat = np.fft.fft(u_grid) / G\n        \n        # Get integer wavenumbers k corresponding to FFT output T-periodic on [0, 2pi)\n        k_vec = np.fft.fftfreq(G) * G\n\n        # For easier indexing and filtering, shift frequencies to be monotonic\n        k_shifted = np.fft.fftshift(k_vec)\n        c_hat_shifted = np.fft.fftshift(c_hat)\n\n        # 3. Construct the truncated approximation u_N(x)\n        mask_le_N = np.abs(k_shifted) = N\n        c_N_shifted = np.zeros_like(c_hat_shifted, dtype=complex)\n        c_N_shifted[mask_le_N] = c_hat_shifted[mask_le_N]\n        \n        # Inverse shift and inverse FFT to get spatial representation\n        c_N = np.fft.ifftshift(c_N_shifted)\n        # The result must be real since input u(x) is real and spectrum is conjugate symmetric\n        u_N_grid = np.real(np.fft.ifft(c_N * G))\n\n        # 4. Construct the filtered approximation u_N^f(x)\n        # The filter is applied to the truncated coefficient set\n        phi_filter_values = np.exp(-alpha * (np.abs(k_shifted[mask_le_N]) / N)**s)\n        c_N_f_shifted = np.copy(c_N_shifted)\n        c_N_f_shifted[mask_le_N] *= phi_filter_values\n        \n        # Inverse shift and inverse FFT\n        c_N_f = np.fft.ifftshift(c_N_f_shifted)\n        u_N_f_grid = np.real(np.fft.ifft(c_N_f * G))\n\n        # 5. Compute the four specified error metrics\n        \n        # 5a. Pointwise supremum error (E_infinity)\n        e_inf_uN = np.max(np.abs(u_N_grid - u_grid))\n        e_inf_uNf = np.max(np.abs(u_N_f_grid - u_grid))\n        \n        # 5b. Weak H^-1-type error (E_-1)\n        # Isolate non-zero wavenumbers for the sum\n        nonzero_k_mask = k_shifted != 0\n        k_nonzero = k_shifted[nonzero_k_mask]\n        c_hat_nonzero = c_hat_shifted[nonzero_k_mask]\n\n        # Squared terms for the norm calculation: |c_k|^2 / k^2\n        sq_terms_H_minus_1 = (np.abs(c_hat_nonzero)**2) / (k_nonzero**2)\n\n        # E_-1 for the truncated approximation u_N\n        # Error coefficients are -c_k for |k|>N\n        mask_gt_N_in_nonzero = np.abs(k_nonzero) > N\n        e_minus1_uN_sq = np.sum(sq_terms_H_minus_1[mask_gt_N_in_nonzero])\n        e_minus1_uN = np.sqrt(e_minus1_uN_sq)\n\n        # E_-1 for the filtered approximation u_N^f\n        # The error has two parts\n        # Part 1: Error from filtering on |k| = N. Coefficients are (phi(k)-1)*c_k\n        mask_le_N_in_nonzero = np.abs(k_nonzero) = N\n        \n        k_part1 = k_nonzero[mask_le_N_in_nonzero]\n        c_hat_part1 = c_hat_nonzero[mask_le_N_in_nonzero]\n        phi_part1 = np.exp(-alpha * (np.abs(k_part1) / N)**s)\n        \n        terms_part1 = (np.abs((phi_part1 - 1) * c_hat_part1)**2) / (k_part1**2)\n        sum1_sq = np.sum(terms_part1)\n\n        # Part 2: Error from truncation |k|  N. Same as for u_N.\n        sum2_sq = e_minus1_uN_sq\n        \n        e_minus1_uNf = np.sqrt(sum1_sq + sum2_sq)\n\n        all_results.append([e_inf_uN, e_inf_uNf, e_minus1_uN, e_minus1_uNf])\n\n    # Final print statement in the exact required format.\n    # The repr().replace() trick generates a space-free list-of-lists string.\n    print(repr(all_results).replace(\" \", \"\"))\n\nsolve()\n\n```"
        }
    ]
}