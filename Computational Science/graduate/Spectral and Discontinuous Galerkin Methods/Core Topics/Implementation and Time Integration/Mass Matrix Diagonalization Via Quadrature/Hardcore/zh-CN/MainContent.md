## 引言
在使用[高阶谱](@entry_id:191458)元法或间断Galerkin方法求解瞬态问题时，我们通常会得到一个包含“[质量矩阵](@entry_id:177093)”的[常微分方程组](@entry_id:266774)。对于[显式时间积分](@entry_id:165797)方案而言，每一步都需要求解一个与该[质量矩阵](@entry_id:177093)相关的[线性系统](@entry_id:147850)。如果质量矩阵是稠密的，这一过程将带来巨大的计算开销，严重制约了[高阶方法](@entry_id:165413)的效率优势。本文旨在解决这一核心瓶颈，介绍一种强大而高效的技术：通过[数值求积](@entry_id:136578)实现[质量矩阵对角化](@entry_id:751707)。

接下来，我们将分三部分深入探讨这一主题。在“原理与机制”一章中，我们将揭示如何通过巧妙选择求积规则与[基函数](@entry_id:170178)，将质量矩阵简化为[对角形式](@entry_id:264850)，并分析其背后的数学原理与精度权衡。随后，在“应用与交叉学科联系”一章中，我们将展示该技术在提升[计算效率](@entry_id:270255)、设计高级算法以及与[结构力学](@entry_id:276699)、[流体力学](@entry_id:136788)等领域交叉中的广泛应用。最后，通过一系列“动手实践”练习，您将有机会亲手应用并加深对这些概念的理解。让我们首先从其基本原理与机制开始。

## 原理与机制

在[高阶谱](@entry_id:191458)元法和间断Galerkin（DG）方法中，时间演化问题的[半离散化](@entry_id:163562)形式通常会产生一个常微分方程（ODE）系统。该系统通常表示为：

$$
\mathbf{M} \frac{d\mathbf{u}}{dt} = \mathbf{r}(\mathbf{u})
$$

其中 $\mathbf{u}$ 是解的自由度（例如，节点值或[模态系数](@entry_id:752057)）向量，$\mathbf{M}$ 是**[质量矩阵](@entry_id:177093)**，$\mathbf{r}(\mathbf{u})$ 是包含空间导数、源项和其他物理过程的**残差向量**。[质量矩阵](@entry_id:177093)的元素由[基函数](@entry_id:170178) $\phi_i$ 的[内积](@entry_id:158127)定义，通常形式为 $M_{ij} = \int_K \phi_i \phi_j d\boldsymbol{x}$，其中 $K$ 是一个单元。

当使用[显式时间积分](@entry_id:165797)格式（如[Runge-Kutta方法](@entry_id:144251)）求解该系统时，每个阶段或子步骤都需要计算时间导数 $\frac{d\mathbf{u}}{dt}$。这需要[求解线性系统](@entry_id:146035) $\mathbf{M} \mathbf{v} = \mathbf{r}$，其中 $\mathbf{v} = \frac{d\mathbf{u}}{dt}$。如果[质量矩阵](@entry_id:177093) $\mathbf{M}$ 是一个稠密矩阵（即“[一致质量矩阵](@entry_id:174630)”），即使它是[对称正定](@entry_id:145886)的，求解这个系统也需要大量的计算开销，因为它涉及矩阵求逆或迭代求解，这是一个全局操作，耦合了单元内所有的自由度。

然而，如果质量矩阵是[对角矩阵](@entry_id:637782)（即“[集总质量矩阵](@entry_id:173011)”），其逆矩阵的计算就变得无关紧要。系统可以逐分量求解：

$$
\frac{du_i}{dt} = \frac{r_i(\mathbf{u})}{M_{ii}}
$$

这个方程的[解耦](@entry_id:637294)极大地提高了[显式时间步进](@entry_id:168157)格式的[计算效率](@entry_id:270255)，因为它避免了每次时间步中[求解线性系统](@entry_id:146035)的需要。因此，通过特定方法获得[对角质量矩阵](@entry_id:173002)，是提高谱元和DG方法计算性能的一个核心策略。本章将深入探讨实现这种[对角化](@entry_id:147016)的关键机制——**通过求积的[质量矩阵对角化](@entry_id:751707)**——以及它所带来的原理、应用和权衡。

### 通过求积实现对角化的核心机制

获得[对角质量矩阵](@entry_id:173002)的主要技术，通常称为**质量集总**（mass lumping），是利用数值求积规则的特定属性。其核心思想是选择求积点与[基函数](@entry_id:170178)节点的位置相匹配。

让我们在一个一维[参考单元](@entry_id:168425) $\xi \in [-1, 1]$ 上阐述这个机制。假设我们选择了一套 $N+1$ 个求积点 $\{\xi_k\}_{k=0}^N$ 及其对应的[求积权重](@entry_id:753910) $\{w_k\}_{k=0}^N$。接下来，我们不使用任意的多项式基，而是选择一个**[节点基](@entry_id:752522)**，具体来说是由这些求积点定义的**[拉格朗日多项式](@entry_id:142463)**基 $\{\ell_i(\xi)\}_{i=0}^N$。这些[基函数](@entry_id:170178)属于至多 $N$ 次的[多项式空间](@entry_id:144410) $\mathbb{P}_N$，并满足基本（cardinal）性质：

$$
\ell_i(\xi_j) = \delta_{ij} = \begin{cases} 1  \text{若 } i=j \\ 0  \text{若 } i \neq j \end{cases}
$$

其中 $\delta_{ij}$ 是[克罗内克δ函数](@entry_id:272741)。

现在，我们不精确计算质量矩阵的积分 $M_{ij} = \int_{-1}^{1} \ell_i(\xi) \ell_j(\xi) d\xi$，而是使用我们选定的求积规则来近似它。这样得到的求积质量矩阵，我们记为 $\mathbf{M}^Q$，其元素为：

$$
M^Q_{ij} = \sum_{k=0}^{N} w_k \ell_i(\xi_k) \ell_j(\xi_k)
$$

利用[拉格朗日基](@entry_id:751105)函数的 cardinal 性质，$\ell_i(\xi_k) = \delta_{ik}$ 和 $\ell_j(\xi_k) = \delta_{jk}$，上述求和中的乘积 $\delta_{ik}\delta_{jk}$ 仅在 $k=i$ 和 $k=j$ 同时成立时才为1，这意味着 $i=j$。因此，这个求和对于 $i \neq j$ 的情况自然为零。当 $i=j$ 时，求和中只有一项非零（当 $k=i$ 时）：

$$
M^Q_{ij} = \sum_{k=0}^{N} w_k \delta_{ik} \delta_{jk} = w_i \delta_{ij}
$$

结果是一个对角矩阵，其对角元素就是对应的[求积权重](@entry_id:753910) $w_i$。这个过程将连续的[内积](@entry_id:158127)问题转化为一个离散的正交性关系，从而实现了[质量矩阵](@entry_id:177093)的[对角化](@entry_id:147016)。  这种策略在四边形和[六面体单元](@entry_id:174602)上可以通过张量积构造推广到多维。

### 求积精度及其后果

虽然质量集总在计算上极具吸[引力](@entry_id:175476)，但它本质上是一种近似。一个自然而然的问题是：这种近似的精度如何？以及它对离散系统的其他部分（如[刚度矩阵](@entry_id:178659)）有何影响？

#### 求积的精确性条件

一个求积规则如果能精确积分所有次数不超过 $D$ 的多项式，我们就说它具有 $D$ 次的**[精确度](@entry_id:143382)**。为了使求积质量矩阵 $\mathbf{M}^Q$ 与精确的连续质量矩阵 $\mathbf{M}$ 完全相等，求积规则必须能够精确积分 $\mathbf{M}$ 的所有被积函数。

考虑一个从[参考单元](@entry_id:168425) $\xi \in [-1, 1]$到物理单元 $x \in K$ 的映射，其雅可比行列式为 $J(\xi)$。质量矩阵的积分是在参考单元上计算的：

$$
M_{ij} = \int_{-1}^{1} \ell_i(\xi) \ell_j(\xi) J(\xi) d\xi
$$

其中[基函数](@entry_id:170178) $\ell_i, \ell_j \in \mathbb{P}_N$。如果[雅可比行列式](@entry_id:137120) $J(\xi)$ 是一个次数为 $p$ 的多项式（例如，在使用等参元进行弯曲几何建模时），那么被积函数 $\ell_i(\xi) \ell_j(\xi) J(\xi)$ 的次数最高可达 $2N + p$。因此，要使[集总质量矩阵](@entry_id:173011)与[精确质量](@entry_id:746222)矩阵相等，求积规则的最小[精确度](@entry_id:143382) $d_{\min}$ 必须为：

$$
d_{\min}(N, p) = 2N + p
$$

  这一条件揭示了近似的来源：如果我们为了获得对角矩阵而选择的求积规则不满足此精确度要求，那么 $\mathbf{M}^Q \neq \mathbf{M}$。例如，在[谱元法](@entry_id:755171)中常用的 $(N+1)$ 点 **[Legendre-Gauss-Lobatto](@entry_id:751235) (LGL)** 求积，其[精确度](@entry_id:143382)为 $2N-1$。对于[仿射映射](@entry_id:746332)（$p=0$），被积函数次数为 $2N$，这超出了 LGL 求积的精确范围。因此，LGL 求积导致的质量集总是一种不精确的积分，这种不精确性被称为**混淆（aliasing）**或**变分犯罪（variational crime）**。

#### 对刚度矩阵的影响：一个意外之喜

既然质量矩阵的计算是不精确的，我们必须考察这种不精确性是否会污染其他项，尤其是**刚度矩阵** $K_{ij} = \int_K a(x) \nabla \phi_i \cdot \nabla \phi_j dx$，$a(x)$ 是一个系数。

让我们考虑最简单但最常见的情况：一维[仿射映射](@entry_id:746332)（$J(\xi)$ 是常数）且系数 $a(x)$ 也是常数。在参考单元上，刚度矩阵的被积函数为：

$$
\text{Integrand}_K \propto \frac{d\ell_i(\xi)}{d\xi} \frac{d\ell_j(\xi)}{d\xi}
$$

由于 $\ell_i, \ell_j$ 是 $N$ 次多项式，它们的导数是 $N-1$ 次多项式。因此，被积函数的次数为 $(N-1) + (N-1) = 2N-2$。

这里出现了一个非常有利的“巧合”：$(N+1)$ 点 LGL 求积的精确度为 $2N-1$。由于 $2N-2 \leq 2N-1$，LGL 求积规则可以**精确地**计算刚度矩阵。这意味着，在仿射单元和[常系数](@entry_id:269842)的条件下，我们可以同时获得[对角质量矩阵](@entry_id:173002)（尽管积分不精确）和精确计算的刚度矩阵。我们无需为提高效率而牺牲刚度项的精度。

然而，当单元是弯曲的（$J(\xi)$ 不是常数）或系数 $a(x)$ 是变量时，这个“免费午餐”就消失了。[刚度矩阵](@entry_id:178659)的被积函数次数会增加，或者由于 $1/J(\xi)$ 项的存在而变成有理函数，LGL求积将不再精确。

### 实际影响与高级策略

尽管存在近似，但质量集总的优势通常远大于其劣势，并且可以通过一些高级策略来减轻其负面影响。

#### 对稳定性和时间步长的影响

质量集总不仅简化了计算，有时还能改善[显式时间积分](@entry_id:165797)的稳定性。考虑[一维波动方程](@entry_id:164824)，使用[一致质量矩阵](@entry_id:174630)的[半离散系统](@entry_id:754680)所允许的最大[稳定时间步长](@entry_id:755325) $\Delta t_{\text{cons}}$ 受限于网格尺寸 $h$ 和波速 $c$，即 $\Delta t_{\text{cons}} = \frac{h}{c\sqrt{3}}$。相比之下，使用 LGL 求积得到的[对角质量矩阵](@entry_id:173002)，其最大[稳定时间步长](@entry_id:755325)为 $\Delta t_{\text{diag}} = \frac{h}{c}$。 在这种情况下，质量集总不仅消除了矩阵求逆的需要，还放宽了CFL（[Courant-Friedrichs-Lewy](@entry_id:175598)）条件，允许使用更大的时间步。

此外，由于[对角质量矩阵](@entry_id:173002)解耦了ODE系统，它天然地支持**[局部时间步进](@entry_id:751409)**（local time-stepping）。在[非均匀网格](@entry_id:752607)中，每个单元或节点的稳定性限制可能差异很大（例如，$\Delta t \propto h$）。使用全局统一的时间步长会受到最小单元的严格限制。而采用[对角质量矩阵](@entry_id:173002)后，可以根据每个单元或节点的[局部稳定性](@entry_id:751408)条件，在粗网格区域采用大时间步，在细网格区域采用小时间步（[子循环](@entry_id:755594)），从而大幅提升异构网格上的[计算效率](@entry_id:270255)。 

#### 处理不精确性的策略

当遇到弯曲单元或变系数等导致刚度项积分不精确的情况时，有几种策略可以应对：

1.  **求积分裂（Quadrature Splitting）**：这是一种务实的策略。对于质量矩阵，我们仍然使用 LGL 求积以保持其对角性。但对于刚度矩阵或其他需要更高精度的项（如稳定项），我们采用另一个更高阶的求积规则（例如，点数更多的 Gauss-Legendre 规则）进行**过积分（over-integration）**。这种方法在保持[对角质量矩阵](@entry_id:173002)带来的效率的同时，控制了其他项的混淆误差。 

2.  **分裂形式与保结构离散**：一种更精妙的方法是利用 LGL 节点和权重构成的算子具有**[分部求和](@entry_id:185335)（SBP）**性质。SBP 算子在离散层面模拟了分部积分，这是证明[能量稳定性](@entry_id:748991)的关键。即使存在混淆误差，通过将 PDE 的弱形式重写为代数等价的**分裂形式**（例如，斜对称形式），也可以设计出即使在求积不精确的情况下仍然保持数值稳定（例如，[能量守恒](@entry_id:140514)或耗散）的离散格式。这种方法通过修改方程本身的形式来适应不精确的求积，从而在保持[对角质量矩阵](@entry_id:173002)的同时确保稳定性。

3.  **针对[非线性](@entry_id:637147)的去混淆**：对于[非线性](@entry_id:637147)问题，如 $u_t + \partial_x f(u) = 0$，[非线性](@entry_id:637147)项 $f(u)$ 会产生严重的混淆误差。一种有效的去混淆策略是：在更高阶求积规则的节点上（过积分点）计算[非线性](@entry_id:637147)项 $f(u_h)$，然后通过 $L^2$ 投影将其投影回原始的 $N$ 次多项式空间。所有[内积](@entry_id:158127)（包括时间导数项的[质量矩阵](@entry_id:177093)）仍然使用 LGL求积以保持对角性。这种方法在控制[非线性](@entry_id:637147)混淆的同时，保留了[对角质量矩阵](@entry_id:173002)的优点。

### 几何与维度扩展的挑战

虽然质量集总在基于张量积的矩形单元上非常成功，但将其推广到其他几何形状和更高维度时会遇到新的挑战。

#### 单纯形单元（三角形和四面体）

在三角形和四面体等单纯形单元上，质量集总要困难得多。

-   对于**线性[基函数](@entry_id:170178)**（$p=1$），在单元顶点上使用 nodal quadrature（求积点即节点）确实可以得到一个对角的[集总质量矩阵](@entry_id:173011)。然而，这个矩阵与精确计算的[质量矩阵](@entry_id:177093)**不相等**。例如，在三角形上，顶点求积得到的对角项为 $|K|/3$，而精确积分得到的对角项为 $|K|/6$。
-   对于**二次及更高次[基函数](@entry_id:170178)**（$p \ge 2$），情况变得更糟。精确的[质量矩阵](@entry_id:177093)本身就不是对角的。由于 nodal quadrature 总是会产生一个对角矩阵，这意味着在节点上进行求积**不可能**精确地计算[质量矩阵](@entry_id:177093)。事实上，通常不存在仅使用节点作为求积点并具有正权重的求积规则，能够精确积分所有次数达到 $2p$ 的多项式。这从根本上限制了质量集总在单纯形高阶元上的直接应用。

#### 高维超立方体与[稀疏网格](@entry_id:139655)

在多维[超立方体](@entry_id:273913)上，可以利用[张量积](@entry_id:140694)结构来构造求积规则和[基函数](@entry_id:170178)。然而，随着维度 $d$ 的增加，全[张量积求积](@entry_id:145940)的点数会呈指数增长（即“维度灾难”）。

**[稀疏网格](@entry_id:139655)求积**（例如，通过 Smolyak 算法构造）是一种旨在通过比全[张量积](@entry_id:140694)少得多的点数来积分高维函数的方法。我们能否利用[稀疏网格](@entry_id:139655)来实现[对角质量矩阵](@entry_id:173002)呢？

-   形式上，答案是肯定的。如果我们在一组[稀疏网格](@entry_id:139655)点上定义一个[节点拉格朗日基](@entry_id:752524)，那么使用这个[稀疏网格](@entry_id:139655)求积规则来计算[质量矩阵](@entry_id:177093)，将同样得到一个对角矩阵，其对角元为[稀疏网格](@entry_id:139655)的权重。
-   然而，这里有一个巨大的陷阱：标准的[稀疏网格](@entry_id:139655)构造（特别是当基于非嵌套的1D规则如Gauss-Legendre时）常常会产生**负权重**。一个负的[对角质量矩阵](@entry_id:173002)项 $M_{ii}  0$ 会破坏离散能量范数的[正定性](@entry_id:149643)，通常会导致[显式时间积分](@entry_id:165797)方案的无条件不稳定。
-   此外，[稀疏网格](@entry_id:139655)的[精确度](@entry_id:143382)通常是针对总次数多项式空间，而不是张量积空间。这意味着它们无法精确积分[高阶谱](@entry_id:191458)元法中出现的[张量积](@entry_id:140694)多项式乘积，导致了比 LGL 集总更严重的混淆误差。

因此，虽然[稀疏网格](@entry_id:139655)在形式上可以提供[对角质量矩阵](@entry_id:173002)，但其在稳定性和精度方面的权衡更为复杂，需要谨慎使用，并且通常需要结合分裂形式等稳定性增强技术。

综上所述，通过求积实现[质量矩阵对角化](@entry_id:751707)是一种强大而高效的技术，尤其是在一维和张量积单元上。它不仅极大地提升了[显式时间积分](@entry_id:165797)的效率，甚至可能改善稳定性。然而，这种方法本质上是一种近似，其精度和稳定性后果必须被仔细理解和控制，特别是在处理弯曲几何、变系数、[非线性](@entry_id:637147)问题以及向单纯形等复杂几何推广时。