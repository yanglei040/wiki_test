{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of the Discontinuous Galerkin (DG) method is the conversion of the partial differential equation into a weak form, requiring the evaluation of integrals over each element. The accuracy of the overall simulation hinges on the precision of this integration. This fundamental exercise challenges you to determine the minimum quadrature order needed to compute the volume integral term exactly, a crucial step for ensuring the stability and theoretical accuracy of the scheme. By analyzing the polynomial degrees of the basis functions and the approximated flux, you will establish a direct link between the chosen polynomial degree $p$ and the required numerical machinery .",
            "id": "3376150",
            "problem": "Consider the compressible Euler equations in conservative form, written on a domain partitioned into non-overlapping simplicial elements:\n$$\n\\partial_{t} \\boldsymbol{u} + \\nabla \\cdot \\boldsymbol{f}(\\boldsymbol{u}) = \\boldsymbol{0},\n$$\nwhere $\\boldsymbol{u}$ collects the conserved variables and $\\boldsymbol{f}(\\boldsymbol{u})$ is the flux. On a single element $K$, a Discontinuous Galerkin (DG) method uses a local polynomial trial space of total degree at most $p$, denoted $\\mathbb{P}^{p}(K)$, and test functions $v_{h} \\in \\mathbb{P}^{p}(K)$. Assume the following:\n- The conservative unknown $\\boldsymbol{u}_{h}$ is represented by polynomials in $\\mathbb{P}^{p}(K)$.\n- The flux is approximated by a polynomial projection $\\boldsymbol{f}_{h}(\\boldsymbol{u}_{h})$ whose components lie in $\\mathbb{P}^{p}(K)$; that is, the flux is approximated at order $p$.\n- The volume term is evaluated in the weak form as\n$$\n\\int_{K} \\boldsymbol{f}_{h}(\\boldsymbol{u}_{h}) \\cdot \\nabla v_{h} \\, \\mathrm{d}\\boldsymbol{x}.\n$$\nA quadrature rule over $K$ is said to have order $m$ if it is exact for all polynomials on $K$ of total degree at most $m$.\n\nDetermine, in terms of $p$, the minimum quadrature order $m$ required so that the above volume integral is computed exactly for all choices $v_{h} \\in \\mathbb{P}^{p}(K)$ and for all polynomial flux approximations $\\boldsymbol{f}_{h}(\\boldsymbol{u}_{h}) \\in \\left(\\mathbb{P}^{p}(K)\\right)^{d}$. Express your final answer as a single closed-form expression in terms of $p$.",
            "solution": "The problem asks for the minimum order of a quadrature rule, denoted by $m$, that is required to compute the weak form of the volume integral exactly for a Discontinuous Galerkin (DG) discretization of the compressible Euler equations.\n\nThe integral in question is:\n$$\nI = \\int_{K} \\boldsymbol{f}_{h}(\\boldsymbol{u}_{h}) \\cdot \\nabla v_{h} \\, \\mathrm{d}\\boldsymbol{x}\n$$\nwhere $K$ is a simplicial element in the domain.\n\nAccording to the problem statement, a quadrature rule of order $m$ is exact for all polynomials on $K$ of total degree at most $m$. To find the minimum required order $m$, we must determine the maximum possible total degree of the integrand, which is the scalar function $\\boldsymbol{f}_{h}(\\boldsymbol{u}_{h}) \\cdot \\nabla v_{h}$.\n\nLet us analyze the polynomial degree of each term in the integrand based on the provided information:\n\n1.  **The test function, $v_{h}$**: The problem states that the test functions $v_{h}$ are chosen from the local polynomial space $\\mathbb{P}^{p}(K)$. This space consists of polynomials of total degree at most $p$. We can write this as $\\text{deg}(v_{h}) \\le p$.\n\n2.  **The gradient of the test function, $\\nabla v_{h}$**: The gradient operator, $\\nabla$, applied to a polynomial reduces its total degree by one. Since $v_{h}$ is a polynomial of degree at most $p$, its gradient, $\\nabla v_{h}$, is a vector whose components are polynomials of total degree at most $p-1$. Each component of $\\nabla v_{h}$ belongs to the space $\\mathbb{P}^{p-1}(K)$. If we denote the components of $\\nabla v_{h}$ as $(\\nabla v_{h})_i$, then $\\text{deg}((\\nabla v_{h})_i) \\le p-1$ for each $i \\in \\{1, \\dots, d\\}$, where $d$ is the spatial dimension.\n\n3.  **The approximated flux, $\\boldsymbol{f}_{h}(\\boldsymbol{u}_{h})$**: The problem specifies that \"the flux is approximated by a polynomial projection $\\boldsymbol{f}_{h}(\\boldsymbol{u}_{h})$ whose components lie in $\\mathbb{P}^{p}(K)$\". This is a critical piece of information. It means that regardless of the nonlinearity of the true flux $\\boldsymbol{f}(\\boldsymbol{u})$, the approximation $\\boldsymbol{f}_{h}$ used in the integral is a vector whose components are polynomials of total degree at most $p$. If we denote the components of $\\boldsymbol{f}_{h}$ as $(\\boldsymbol{f}_{h})_i$, then $\\text{deg}((\\boldsymbol{f}_{h})_i) \\le p$.\n\nNow, we can determine the degree of the integrand. The integrand is the dot product of the two vector fields, $\\boldsymbol{f}_{h}$ and $\\nabla v_{h}$:\n$$\n\\boldsymbol{f}_{h} \\cdot \\nabla v_{h} = \\sum_{i=1}^{d} (\\boldsymbol{f}_{h})_i \\, (\\nabla v_{h})_i\n$$\nFor each term in this summation, we are multiplying a component of $\\boldsymbol{f}_{h}$ by a corresponding component of $\\nabla v_{h}$. Let's analyze the degree of one such product, $(\\boldsymbol{f}_{h})_i \\, (\\nabla v_{h})_i$.\nThe degree of a product of two polynomials is the sum of their individual degrees.\n$$\n\\text{deg}((\\boldsymbol{f}_{h})_i \\, (\\nabla v_{h})_i) = \\text{deg}((\\boldsymbol{f}_{h})_i) + \\text{deg}((\\nabla v_{h})_i)\n$$\nTo find the maximum possible degree of this product, we use the maximum degrees of the factors:\n$$\n\\max \\left( \\text{deg}((\\boldsymbol{f}_{h})_i \\, (\\nabla v_{h})_i) \\right) \\le p + (p-1) = 2p-1.\n$$\nThe degree of a sum of polynomials is no greater than the maximum degree of any polynomial in the sum. Since each term in the sum $\\sum_{i=1}^{d} (\\boldsymbol{f}_{h})_i \\, (\\nabla v_{h})_i$ is a polynomial of degree at most $2p-1$, the entire integrand is also a polynomial of degree at most $2p-1$.\n$$\n\\text{deg}(\\boldsymbol{f}_{h} \\cdot \\nabla v_{h}) \\le 2p-1.\n$$\nFor the quadrature rule to compute the integral $I$ exactly, it must be exact for all possible integrands. This means the rule must be exact for any polynomial of degree up to the maximum possible degree of the integrand, which is $2p-1$.\n\nBy the definition provided, a quadrature rule of order $m$ is exact for all polynomials of total degree at most $m$. Therefore, we must have:\n$$\nm \\ge 2p-1.\n$$\nThe problem asks for the minimum quadrature order required. This corresponds to the lowest integer value of $m$ that satisfies the condition for all valid choices of $\\boldsymbol{f}_{h}$ and $v_{h}$. The minimum value is thus achieved when equality holds.\n$$\nm_{\\text{min}} = 2p-1.\n$$\nThis ensures that for any choice of $v_h \\in \\mathbb{P}^p(K)$ and any flux approximation $\\boldsymbol{f}_h \\in (\\mathbb{P}^p(K))^d$, the resulting integrand polynomial, which can have a degree up to $2p-1$, is integrated exactly.",
            "answer": "$$\\boxed{2p-1}$$"
        },
        {
            "introduction": "While volume integrals define the solution's behavior within an element, the true power and complexity of the DG method for hyperbolic systems lie in the surface integrals, which couple adjacent elements. This coupling is achieved through a numerical flux, which acts as an approximate Riemann solver at each interface. This exercise provides hands-on practice in analyzing the behavior of three canonical numerical fluxes—Roe, HLLC, and Lax-Friedrichs—and their ability to resolve a contact discontinuity, a wave that is notoriously difficult for overly dissipative schemes to capture accurately. Understanding these properties is essential for selecting the appropriate flux for a given physical problem .",
            "id": "3376114",
            "problem": "Consider the compressible Euler equations in conservative form for a perfect gas with ratio of specific heats $\\gamma$, written as $\\partial_t \\boldsymbol{U} + \\nabla \\cdot \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{0}$ with conservative variables $\\boldsymbol{U} = [\\rho, \\rho \\boldsymbol{u}, E]^\\top$ and physical flux $\\boldsymbol{F}(\\boldsymbol{U}) = [\\rho \\boldsymbol{u}, \\rho \\boldsymbol{u} \\otimes \\boldsymbol{u} + p \\boldsymbol{I}, (E + p) \\boldsymbol{u}]$, where $\\rho$ is the density, $\\boldsymbol{u} \\in \\mathbb{R}^3$ is the velocity, $E$ is the total energy, $p$ is the pressure, and $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho \\|\\boldsymbol{u}\\|^2\\right)$. In a Discontinuous Galerkin (DG) method, the interface coupling is effected by a numerical flux $\\widehat{\\boldsymbol{F}}_n(\\boldsymbol{U}_L, \\boldsymbol{U}_R; \\boldsymbol{n})$ acting on each face with unit normal $\\boldsymbol{n}$, approximating the normal flux $\\boldsymbol{F}_n(\\boldsymbol{U}) := \\boldsymbol{F}(\\boldsymbol{U}) \\cdot \\boldsymbol{n} = [\\rho u_n, \\rho \\boldsymbol{u} u_n + p \\boldsymbol{n}, (E + p) u_n]^\\top$, where $u_n := \\boldsymbol{u} \\cdot \\boldsymbol{n}$.\n\nA planar contact discontinuity for the Euler equations is characterized by equal pressure and equal normal velocity across the interface, but possibly different density and tangential velocity. In particular, for left and right states with $(\\rho_L, \\boldsymbol{u}_L, p_L)$ and $(\\rho_R, \\boldsymbol{u}_R, p_R)$ and a unit normal $\\boldsymbol{n}$, a planar contact discontinuity satisfies $p_L = p_R$ and $u_{n,L} = u_{n,R}$, where $u_{n,\\star} := \\boldsymbol{u}_\\star \\cdot \\boldsymbol{n}$. The exact Riemann solution across such a discontinuity yields a unique interface flux based on the upwind side with respect to the common normal velocity $u_n$: if $u_n > 0$, $\\boldsymbol{F}_{n,\\mathrm{exact}} = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$; if $u_n < 0$, $\\boldsymbol{F}_{n,\\mathrm{exact}} = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$; if $u_n = 0$, the interface flux is $\\boldsymbol{F}_{n,\\mathrm{exact}} = [0, p \\boldsymbol{n}, 0]^\\top$.\n\nTask: Starting from the definitions above and the Rankine–Hugoniot conditions for conservation laws, derive implementable formulas for three numerical fluxes across a face with unit normal $\\boldsymbol{n}$:\n- the local Lax–Friedrichs (Rusanov) flux, defined by a single characteristic speed bound,\n- the Roe flux constructed from the Roe linearization along $\\boldsymbol{n}$,\n- the Harten–Lax–van Leer–Contact (HLLC) flux along $\\boldsymbol{n}$.\n\nThen, for a set of test cases that isolate planar contacts with $p_L = p_R$ and $u_{n,L} = u_{n,R}$ but allow jumps in $\\rho$ and in the tangential velocity $\\boldsymbol{u}_t := \\boldsymbol{u} - u_n \\boldsymbol{n}$, compute, for each flux, the numerical interface flux $\\widehat{\\boldsymbol{F}}_n$ and compare it to the exact contact-preserving interface flux $\\boldsymbol{F}_{n,\\mathrm{exact}}$. Declare a flux to be “contact-preserving” on a given test if and only if the Euclidean norm of the flux error $\\|\\widehat{\\boldsymbol{F}}_n - \\boldsymbol{F}_{n,\\mathrm{exact}}\\|_2$ is less than or equal to a tolerance $\\varepsilon$ times $(1 + \\|\\boldsymbol{F}_{n,\\mathrm{exact}}\\|_2)$, where $\\varepsilon = 10^{-8}$.\n\nAll quantities are nondimensional. Use $\\gamma = 1.4$ in all cases. Use the following test suite, each specified by $(\\boldsymbol{n}, \\rho_L, \\boldsymbol{u}_L, p_L, \\rho_R, \\boldsymbol{u}_R, p_R)$, where $\\boldsymbol{n}$ is a unit vector and $\\boldsymbol{u}_\\star = (u_x, u_y, u_z)$:\n\n- Case A (stationary planar contact, axis-aligned normal): $\\boldsymbol{n} = (1, 0, 0)$, $\\rho_L = 1.0$, $\\boldsymbol{u}_L = (0, 0.5, 0)$, $p_L = 10^5$, $\\rho_R = 2.0$, $\\boldsymbol{u}_R = (0, -0.5, 0)$, $p_R = 10^5$.\n- Case B (moving planar contact with positive normal speed): $\\boldsymbol{n} = (1, 0, 0)$, $\\rho_L = 0.8$, $\\boldsymbol{u}_L = (100, 20, 0)$, $p_L = 10^5$, $\\rho_R = 1.2$, $\\boldsymbol{u}_R = (100, -30, 0)$, $p_R = 10^5$.\n- Case C (moving planar contact with negative normal speed): $\\boldsymbol{n} = (1, 0, 0)$, $\\rho_L = 1.5$, $\\boldsymbol{u}_L = (-50, 10, 0)$, $p_L = 10^5$, $\\rho_R = 0.7$, $\\boldsymbol{u}_R = (-50, -10, 0)$, $p_R = 10^5$.\n- Case D (oblique planar contact with positive normal speed): $\\boldsymbol{n} = \\frac{1}{\\sqrt{2}}(1, 1, 0)$, $\\rho_L = 1.0$, $\\boldsymbol{u}_L = 30 \\boldsymbol{n} + 15 \\boldsymbol{t}$, $p_L = 10^5$, $\\rho_R = 0.9$, $\\boldsymbol{u}_R = 30 \\boldsymbol{n} - 20 \\boldsymbol{t}$, $p_R = 10^5$, where $\\boldsymbol{t} = \\frac{1}{\\sqrt{2}}(1, -1, 0)$.\n\nFor each case, compute three booleans indicating whether each numerical flux (in the order Roe, Harten–Lax–van Leer–Contact, and Lax–Friedrichs) is contact-preserving according to the criterion above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., “[result1,result2,result3,...]”), where each result is a boolean corresponding to a single flux on a single case, ordered in sequence Case A Roe, Case A Harten–Lax–van Leer–Contact, Case A Lax–Friedrichs, Case B Roe, Case B Harten–Lax–van Leer–Contact, Case B Lax–Friedrichs, and so on through Case D.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It presents a standard exercise in the analysis of numerical fluxes for hyperbolic conservation laws, specifically the compressible Euler equations. The physical model, mathematical equations, and definitions of numerical schemes (Lax-Friedrichs, Roe, HLLC) are standard in the field of computational fluid dynamics. The test cases are correctly constructed to represent planar contact discontinuities. Therefore, the problem is valid, and a solution will be provided.\n\nThe task is to derive the formulas for the Lax-Friedrichs (or Rusanov), Roe, and HLLC numerical fluxes and then to evaluate their ability to preserve contact discontinuities for the compressible Euler equations. A flux is deemed \"contact-preserving\" if the Euclidean norm of the error between the numerical flux and the exact flux for a contact wave is below a specified tolerance.\n\nLet the state vector of conservative variables be $\\boldsymbol{U} = [\\rho, \\rho u_x, \\rho u_y, \\rho u_z, E]^\\top \\in \\mathbb{R}^5$. The compressible Euler equations are given by $\\partial_t \\boldsymbol{U} + \\nabla \\cdot \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{0}$. The pressure $p$ is given by the equation of state for a perfect gas, $p = (\\gamma-1)(E - \\frac{1}{2} \\rho \\|\\boldsymbol{u}\\|^2)$, where $\\gamma$ is the ratio of specific heats. The speed of sound is $c = \\sqrt{\\gamma p / \\rho}$.\n\nAt an interface with unit normal vector $\\boldsymbol{n}$, the flux is projected in the normal direction:\n$\\boldsymbol{F}_n(\\boldsymbol{U}) = \\boldsymbol{F}(\\boldsymbol{U}) \\cdot \\boldsymbol{n} = [\\rho u_n, \\rho u_x u_n + p n_x, \\rho u_y u_n + p n_y, \\rho u_z u_n + p n_z, (E+p)u_n]^\\top$, where $u_n = \\boldsymbol{u} \\cdot \\boldsymbol{n}$ is the normal velocity.\n\nA planar contact discontinuity between a left state $(\\rho_L, \\boldsymbol{u}_L, p_L)$ and a right state $(\\rho_R, \\boldsymbol{u}_R, p_R)$ is characterized by constant pressure $p_L = p_R = p$ and constant normal velocity $u_{n,L} = u_{n,R} = u_n$. The Rankine-Hugoniot condition for such a wave is $\\boldsymbol{F}_n(\\boldsymbol{U}_R) - \\boldsymbol{F}_n(\\boldsymbol{U}_L) = u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$. The exact flux at the interface, moving with speed $u_n$, is given by the upwind state:\n$$\n\\boldsymbol{F}_{n,\\mathrm{exact}} =\n\\begin{cases}\n    \\boldsymbol{F}_n(\\boldsymbol{U}_L) & \\text{if } u_n > 0 \\\\\n    \\boldsymbol{F}_n(\\boldsymbol{U}_R) & \\text{if } u_n  0 \\\\\n    [0, p n_x, p n_y, p n_z, 0]^\\top  \\text{if } u_n = 0\n\\end{cases}\n$$\nWe now derive the formulas for the three requested numerical fluxes.\n\n### Derivation of Numerical Fluxes\n\n#### 1. Local Lax–Friedrichs (Rusanov) Flux\nThe local Lax–Friedrichs flux, also known as the Rusanov flux, is a simple, robust, but dissipative scheme. It is constructed by averaging the physical fluxes and adding a numerical dissipation term proportional to the jump in the conservative variables.\n$$\n\\widehat{\\boldsymbol{F}}_n^{LF}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) = \\frac{1}{2} \\left[ \\boldsymbol{F}_n(\\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_R) \\right] - \\frac{\\alpha}{2} \\left[ \\boldsymbol{U}_R - \\boldsymbol{U}_L \\right]\n$$\nThe dissipation coefficient $\\alpha$ must be an upper bound on the fastest signal speeds propagating away from the interface. The eigenvalues of the flux Jacobian $\\boldsymbol{A}_n = \\partial \\boldsymbol{F}_n / \\partial \\boldsymbol{U}$ are $\\{u_n, u_n, u_n, u_n+c, u_n-c\\}$. A suitable choice for $\\alpha$ (the Rusanov speed) is the maximum magnitude of the eigenvalues evaluated for the left and right states:\n$$\n\\alpha = \\max(|u_{n,L}| + c_L, |u_{n,R}| + c_R)\n$$\nFor a contact discontinuity, $u_{n,L} = u_{n,R} = u_n$, so $\\alpha = |u_n| + \\max(c_L, c_R)$. The flux introduces dissipation proportional to $\\alpha$, which is non-zero even if only density or tangential velocity jump. The error term for a contact with $u_n > 0$ is $\\widehat{\\boldsymbol{F}}_n^{LF} - \\boldsymbol{F}_{n,\\mathrm{exact}} = \\frac{1}{2}(u_n(\\boldsymbol{U}_R-\\boldsymbol{U}_L)) - \\frac{\\alpha}{2}(\\boldsymbol{U}_R-\\boldsymbol{U}_L) = \\frac{1}{2}(u_n - \\alpha)(\\boldsymbol{U}_R-\\boldsymbol{U}_L) = -\\frac{1}{2}\\max(c_L, c_R)(\\boldsymbol{U}_R-\\boldsymbol{U}_L)$. This error is generally non-zero, indicating that the LF/Rusanov flux is not contact-preserving.\n\n#### 2. Roe Flux\nThe Roe flux is designed to be exact for isolated discontinuities. It is defined as:\n$$\n\\widehat{\\boldsymbol{F}}_n^{Roe}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) = \\frac{1}{2} \\left[ \\boldsymbol{F}_n(\\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_R) \\right] - \\frac{1}{2} |\\hat{\\boldsymbol{A}}_n|(\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n$$\nwhere $\\hat{\\boldsymbol{A}}_n = \\boldsymbol{A}_n(\\hat{\\boldsymbol{U}})$ is the flux Jacobian evaluated at a specially constructed Roe-averaged state $\\hat{\\boldsymbol{U}}$. The Roe-averaged state satisfies the property $\\boldsymbol{F}_n(\\boldsymbol{U}_R) - \\boldsymbol{F}_n(\\boldsymbol{U}_L) = \\hat{\\boldsymbol{A}}_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$. The Roe averages for specific enthalpy $h=(E+p)/\\rho$, velocity $\\boldsymbol{u}$, and density $\\rho$ are:\n$$\n\\hat{\\rho} = \\sqrt{\\rho_L \\rho_R}, \\quad \\hat{\\boldsymbol{u}} = \\frac{\\sqrt{\\rho_L} \\boldsymbol{u}_L + \\sqrt{\\rho_R} \\boldsymbol{u}_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\hat{h} = \\frac{\\sqrt{\\rho_L} h_L + \\sqrt{\\rho_R} h_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\nFor a contact discontinuity, the Rankine-Hugoniot condition gives $\\boldsymbol{F}_n(\\boldsymbol{U}_R) - \\boldsymbol{F}_n(\\boldsymbol{U}_L) = u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$. Combining this with the Roe property, we get $\\hat{\\boldsymbol{A}}_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L) = u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$. This shows that for a contact, the jump vector $\\Delta\\boldsymbol{U} = \\boldsymbol{U}_R - \\boldsymbol{U}_L$ is an eigenvector of the Roe matrix $\\hat{\\boldsymbol{A}}_n$ with eigenvalue $u_n$. Also, for a contact, the Roe-averaged normal velocity is $\\hat{u}_n = \\hat{\\boldsymbol{u}} \\cdot \\boldsymbol{n} = u_n$. The dissipation term becomes:\n$$\n|\\hat{\\boldsymbol{A}}_n|(\\boldsymbol{U}_R - \\boldsymbol{U}_L) = |u_n|(\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n$$\nSubstituting this into the Roe flux definition:\n$$\n\\widehat{\\boldsymbol{F}}_n^{Roe} = \\frac{1}{2} \\left[ \\boldsymbol{F}_n(\\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_R) \\right] - \\frac{1}{2} |u_n|(\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n$$\nIf $u_n > 0$, we use $|u_n| = u_n$ and $\\boldsymbol{F}_n(\\boldsymbol{U}_R) = \\boldsymbol{F}_n(\\boldsymbol{U}_L) + u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$:\n$\\widehat{\\boldsymbol{F}}_n^{Roe} = \\frac{1}{2}(\\boldsymbol{F}_n(\\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_L) + u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)) - \\frac{1}{2}u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L) = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$, which is the exact flux.\nIf $u_n  0$, we use $|u_n| = -u_n$ and $\\boldsymbol{F}_n(\\boldsymbol{U}_L) = \\boldsymbol{F}_n(\\boldsymbol{U}_R) - u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$:\n$\\widehat{\\boldsymbol{F}}_n^{Roe} = \\frac{1}{2}(\\boldsymbol{F}_n(\\boldsymbol{U}_R) - u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_R)) + \\frac{1}{2}u_n(\\boldsymbol{U}_R - \\boldsymbol{U}_L) = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$, which is the exact flux.\nIf $u_n = 0$, the dissipation is zero, and $\\widehat{\\boldsymbol{F}}_n^{Roe} = \\frac{1}{2}(\\boldsymbol{F}_n(\\boldsymbol{U}_L) + \\boldsymbol{F}_n(\\boldsymbol{U}_R))$. Since $u_n=0$, $\\boldsymbol{F}_n(\\boldsymbol{U}_L) = \\boldsymbol{F}_n(\\boldsymbol{U}_R) = [0, p\\boldsymbol{n}, 0]^\\top$, so the Roe flux is exact.\nThus, the Roe flux is theoretically exact for contact discontinuities.\n\n#### 3. Harten–Lax–van Leer–Contact (HLLC) Flux\nThe HLLC flux is an extension of the HLL flux that reintroduces the missing contact wave structure. It assumes a Riemann fan consisting of three waves with speeds $S_L$ (leftmost), $S_M$ (middle/contact), and $S_R$ (rightmost), separating four constant states: $\\boldsymbol{U}_L, \\boldsymbol{U}_L^*, \\boldsymbol{U}_R^*, \\boldsymbol{U}_R$.\nThe wave speeds $S_L$ and $S_R$ are estimated. A common choice (Davis' estimates) is:\n$$\nS_L = \\min(u_{n,L}, u_{n,R}) - \\max(c_L, c_R), \\quad S_R = \\max(u_{n,L}, u_{n,R}) + \\max(c_L, c_R)\n$$\nThe contact speed $S_M$ is derived from the Rankine-Hugoniot conditions applied to the full system:\n$$\nS_M = \\frac{p_R - p_L + \\rho_L u_{n,L}(S_L - u_{n,L}) - \\rho_R u_{n,R}(S_R - u_{n,R})}{\\rho_L(S_L - u_{n,L}) - \\rho_R(S_R - u_{n,R})}\n$$\nFor a contact discontinuity, $p_L=p_R$ and $u_{n,L}=u_{n,R}=u_n$, which simplifies $S_M$ to:\n$$\nS_M = \\frac{\\rho_L u_n(S_L - u_n) - \\rho_R u_n(S_R - u_n)}{\\rho_L(S_L - u_n) - \\rho_R(S_R - u_n)} = u_n\n$$\nThe HLLC flux is then selected based on the location of the interface ($x/t=0$) relative to the wave speeds:\n$$\n\\widehat{\\boldsymbol{F}}_n^{HLLC} = \\begin{cases}\n    \\boldsymbol{F}_n(\\boldsymbol{U}_L)  \\text{if } 0 \\le S_L \\\\\n    \\boldsymbol{F}_L^* = \\boldsymbol{F}_n(\\boldsymbol{U}_L) + S_L(\\boldsymbol{U}_L^* - \\boldsymbol{U}_L)  \\text{if } S_L  0 \\le S_M \\\\\n    \\boldsymbol{F}_R^* = \\boldsymbol{F}_n(\\boldsymbol{U}_R) + S_R(\\boldsymbol{U}_R^* - \\boldsymbol{U}_R)  \\text{if } S_M  0  S_R \\\\\n    \\boldsymbol{F}_n(\\boldsymbol{U}_R)  \\text{if } 0 \\ge S_R\n\\end{cases}\n$$\nThe intermediate states $\\boldsymbol{U}_k^*$ ($k=L,R$) are found by applying the Rankine-Hugoniot conditions across the $S_L$ and $S_R$ waves. One can show that for a contact, $\\boldsymbol{U}_L^* = \\boldsymbol{U}_L$ and $\\boldsymbol{U}_R^* = \\boldsymbol{U}_R$. Let's verify for $\\boldsymbol{U}_L^*$. The pressure and normal velocity in the star region are $p^*$ and $S_M$. For a contact, $p^* = p_L + \\rho_L(u_{n,L}-S_L)(u_{n,L}-S_M) = p_L + \\rho_L(u_n-S_L)(u_n-u_n) = p_L=p$. And $u_{n,L}^*=S_M=u_n$. The tangential velocity is unchanged, $\\boldsymbol{u}_{t,L}^*=\\boldsymbol{u}_{t,L}$. The density is $\\rho_L^* = \\rho_L \\frac{S_L-u_{n,L}}{S_L-S_M} = \\rho_L \\frac{S_L-u_n}{S_L-u_n} = \\rho_L$. Since $(\\rho_L, \\boldsymbol{u}_L, p_L)$ are identical to $(\\rho_L^*, \\boldsymbol{u}_L^*, p_L^*)$, we have $\\boldsymbol{U}_L^* = \\boldsymbol{U}_L$. Similarly, $\\boldsymbol{U}_R^* = \\boldsymbol{U}_R$.\n- If $u_n > 0$ and subsonic ($S_L  0  S_R$), then $S_M=u_n>0$. The flux is $\\widehat{\\boldsymbol{F}}_n^{HLLC} = \\boldsymbol{F}_L^* = \\boldsymbol{F}_n(\\boldsymbol{U}_L) + S_L(\\boldsymbol{U}_L-\\boldsymbol{U}_L) = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$.\n- If $u_n  0$ and subsonic, then $S_M=u_n0$. The flux is $\\widehat{\\boldsymbol{F}}_n^{HLLC} = \\boldsymbol{F}_R^* = \\boldsymbol{F}_n(\\boldsymbol{U}_R) + S_R(\\boldsymbol{U}_R-\\boldsymbol{U}_R) = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$.\n- If $u_n = 0$, then $S_M=0$. The flux is $\\boldsymbol{F}_L^*$ or $\\boldsymbol{F}_R^*$. Both evaluate to $[0, p\\boldsymbol{n}, 0]^\\top$.\nIn all cases, the HLLC flux matches the exact flux. Therefore, HLLC is also theoretically contact-preserving.\n\nThe following implementation will compute these fluxes for the given test cases and verify these theoretical properties numerically.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes numerical fluxes for the Euler equations,\n    testing their contact-preserving properties.\n    \"\"\"\n    gamma = 1.4\n    epsilon = 1e-8\n\n    test_cases = [\n        # Case A\n        {'n': np.array([1.0, 0.0, 0.0]),\n         'rho_L': 1.0, 'u_L': np.array([0.0, 0.5, 0.0]), 'p_L': 1e5,\n         'rho_R': 2.0, 'u_R': np.array([0.0, -0.5, 0.0]), 'p_R': 1e5},\n        # Case B\n        {'n': np.array([1.0, 0.0, 0.0]),\n         'rho_L': 0.8, 'u_L': np.array([100.0, 20.0, 0.0]), 'p_L': 1e5,\n         'rho_R': 1.2, 'u_R': np.array([100.0, -30.0, 0.0]), 'p_R': 1e5},\n        # Case C\n        {'n': np.array([1.0, 0.0, 0.0]),\n         'rho_L': 1.5, 'u_L': np.array([-50.0, 10.0, 0.0]), 'p_L': 1e5,\n         'rho_R': 0.7, 'u_R': np.array([-50.0, -10.0, 0.0]), 'p_R': 1e5},\n        # Case D\n        {'n': np.array([1.0/np.sqrt(2), 1.0/np.sqrt(2), 0.0]),\n         'rho_L': 1.0, 'p_L': 1e5,\n         'rho_R': 0.9, 'p_R': 1e5,\n         'u_L': 30 * np.array([1.0/np.sqrt(2), 1.0/np.sqrt(2), 0.0]) + 15 * np.array([1.0/np.sqrt(2), -1.0/np.sqrt(2), 0.0]),\n         'u_R': 30 * np.array([1.0/np.sqrt(2), 1.0/np.sqrt(2), 0.0]) - 20 * np.array([1.0/np.sqrt(2), -1.0/np.sqrt(2), 0.0])\n        }\n    ]\n\n    def get_conservative_state(rho, u, p, gamma_val):\n        \"\"\"Computes conservative state U from primitive variables.\"\"\"\n        E = p / (gamma_val - 1.0) + 0.5 * rho * np.dot(u, u)\n        return np.array([rho, rho * u[0], rho * u[1], rho * u[2], E])\n\n    def get_physical_flux(rho, u, p, n, E, gamma_val):\n        \"\"\"Computes the physical flux vector F_n.\"\"\"\n        u_n = np.dot(u, n)\n        return np.array([\n            rho * u_n,\n            rho * u[0] * u_n + p * n[0],\n            rho * u[1] * u_n + p * n[1],\n            rho * u[2] * u_n + p * n[2],\n            (E + p) * u_n\n        ])\n\n    def flux_lf(U_L, U_R, F_n_L, F_n_R, u_n_L, c_L, u_n_R, c_R):\n        alpha = max(abs(u_n_L) + c_L, abs(u_n_R) + c_R)\n        return 0.5 * (F_n_L + F_n_R) - 0.5 * alpha * (U_R - U_L)\n\n    def flux_roe(U_L, U_R, F_n_L, F_n_R, u_n_L):\n        # For a contact, the Roe flux simplifies significantly\n        F_roe = 0.5 * (F_n_L + F_n_R) - 0.5 * abs(u_n_L) * (U_R - U_L)\n        return F_roe\n\n    def flux_hllc(n, rho_L, u_L, p_L, E_L, c_L, U_L, F_n_L,\n                  rho_R, u_R, p_R, E_R, c_R, U_R, F_n_R, gamma_val):\n        u_n_L = np.dot(u_L, n)\n        u_n_R = np.dot(u_R, n)\n\n        # Wave speed estimates (Davis)\n        S_L = min(u_n_L, u_n_R) - max(c_L, c_R)\n        S_R = max(u_n_L, u_n_R) + max(c_L, c_R)\n        \n        # S_M based on pressure equality in the star region\n        num = p_R - p_L + rho_L * u_n_L * (S_L - u_n_L) - rho_R * u_n_R * (S_R - u_n_R)\n        den = rho_L * (S_L - u_n_L) - rho_R * (S_R - u_n_R)\n        S_M = num / den\n\n        if S_L >= 0:\n            return F_n_L\n        elif S_R = 0:\n            return F_n_R\n        else: # S_L  0 and S_R > 0\n            if S_M >= 0:\n                p_star = p_L + rho_L * (u_n_L - S_L) * (u_n_L - S_M)\n                rho_star_L = rho_L * (S_L - u_n_L) / (S_L - S_M)\n                u_t_L = u_L - u_n_L * n\n                u_star_L = S_M * n + u_t_L\n                \n                E_star_L = (p_star / (gamma_val - 1.0)) + 0.5 * rho_star_L * np.dot(u_star_L, u_star_L)\n                U_star_L = np.array([rho_star_L, rho_star_L * u_star_L[0], rho_star_L * u_star_L[1], rho_star_L * u_star_L[2], E_star_L])\n\n                return F_n_L + S_L * (U_star_L - U_L)\n            else: # S_M  0\n                p_star = p_R + rho_R * (u_n_R - S_R) * (u_n_R - S_M)\n                rho_star_R = rho_R * (S_R - u_n_R) / (S_R - S_M)\n                u_t_R = u_R - u_n_R * n\n                u_star_R = S_M * n + u_t_R\n                \n                E_star_R = (p_star / (gamma_val - 1.0)) + 0.5 * rho_star_R * np.dot(u_star_R, u_star_R)\n                U_star_R = np.array([rho_star_R, rho_star_R * u_star_R[0], rho_star_R * u_star_R[1], rho_star_R * u_star_R[2], E_star_R])\n\n                return F_n_R + S_R * (U_star_R - U_R)\n\n    def check_preservation(F_num, F_exact, tol):\n        error_norm = np.linalg.norm(F_num - F_exact)\n        f_norm = np.linalg.norm(F_exact)\n        return error_norm = tol * (1.0 + f_norm)\n\n    results = []\n\n    for case in test_cases:\n        n = case['n']\n        rho_L, u_L, p_L = case['rho_L'], case['u_L'], case['p_L']\n        rho_R, u_R, p_R = case['rho_R'], case['u_R'], case['p_R']\n        \n        # Left state properties\n        E_L = p_L / (gamma - 1.0) + 0.5 * rho_L * np.dot(u_L, u_L)\n        U_L = get_conservative_state(rho_L, u_L, p_L, gamma)\n        c_L = np.sqrt(gamma * p_L / rho_L)\n        u_n_L = np.dot(u_L, n)\n        F_n_L = get_physical_flux(rho_L, u_L, p_L, n, E_L, gamma)\n\n        # Right state properties\n        E_R = p_R / (gamma - 1.0) + 0.5 * rho_R * np.dot(u_R, u_R)\n        U_R = get_conservative_state(rho_R, u_R, p_R, gamma)\n        c_R = np.sqrt(gamma * p_R / rho_R)\n        u_n_R = np.dot(u_R, n)\n        F_n_R = get_physical_flux(rho_R, u_R, p_R, n, E_R, gamma)\n        \n        # Exact flux for contact\n        if u_n_L > 0:\n            F_exact = F_n_L\n        elif u_n_L  0:\n            F_exact = F_n_R\n        else:\n            F_exact = np.array([0.0, p_L * n[0], p_L * n[1], p_L * n[2], 0.0])\n            \n        # Roe Flux\n        F_roe_val = flux_roe(U_L, U_R, F_n_L, F_n_R, u_n_L)\n        results.append(check_preservation(F_roe_val, F_exact, epsilon))\n\n        # HLLC Flux\n        F_hllc_val = flux_hllc(n, rho_L, u_L, p_L, E_L, c_L, U_L, F_n_L,\n                               rho_R, u_R, p_R, E_R, c_R, U_R, F_n_R, gamma)\n        results.append(check_preservation(F_hllc_val, F_exact, epsilon))\n        \n        # LF Flux\n        F_lf_val = flux_lf(U_L, U_R, F_n_L, F_n_R, u_n_L, c_L, u_n_R, c_R)\n        results.append(check_preservation(F_lf_val, F_exact, epsilon))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A key challenge in applying high-order methods like DG to the compressible Euler equations is the formation of spurious oscillations near discontinuities. Robust solvers require a strategy to detect and then mitigate these non-physical artifacts. The first step in this process is a reliable troubled-cell indicator (TCI) that flags elements containing sharp gradients. This practice explores a popular modal-based TCI, which leverages the fact that discontinuities scatter energy into high-frequency polynomial modes. By implementing and testing indicators based on both density and pressure, you will investigate the subtleties of shock detection and gain critical experience in building a stable, high-fidelity solver for compressible flows .",
            "id": "3376102",
            "problem": "Consider the one-dimensional compressible Euler equations for an ideal gas with ratio of specific heats $\\gamma$ given by\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0,\n$$\nwhere the conservative variables are $\\mathbf{U} = (\\rho, \\rho u, E)$ with density $\\rho$, velocity $u$, and total energy $E$, and the flux function is\n$$\n\\mathbf{F}(\\mathbf{U}) = \\left( \\rho u, \\rho u^2 + p, u(E + p) \\right).\n$$\nThe pressure $p$ satisfies the ideal gas relation\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right).\n$$\nIn a Discontinuous Galerkin (DG) formulation, fields are represented in each cell by polynomials in the Legendre basis $\\{P_n(\\xi)\\}_{n=0}^p$ on the reference interval $\\xi \\in [-1,1]$. For a scalar field $f(x)$, the $L^2$ projection onto degree-$p$ Legendre polynomials in a cell $K_i = [x_i, x_{i+1}]$ is\n$$\nf(x(\\xi)) \\approx \\sum_{n=0}^{p} a_n^{(i)} P_n(\\xi), \\quad \\xi = \\frac{2(x - x_i)}{h_i} - 1, \\quad h_i = x_{i+1} - x_i,\n$$\nwith modal coefficients\n$$\na_n^{(i)} = \\frac{2n+1}{2} \\int_{-1}^{1} f\\big(x(\\xi)\\big) P_n(\\xi)\\, d\\xi,\n$$\nusing the orthogonality $\\int_{-1}^{1} P_m(\\xi) P_n(\\xi)\\, d\\xi = \\frac{2}{2n+1}\\delta_{mn}$.\n\nA troubled-cell indicator (TCI) aims to detect non-smooth cells (e.g., containing a shock) by measuring the relative energy in the highest polynomial mode. The Persson–Peraire-style sensor for a field $f$ in cell $i$ is defined by\n$$\nS_f^{(i)} := \\log_{10}\\left( \\frac{\\left(a_p^{(i)}\\right)^2}{\\sum_{n=0}^{p} \\left(a_n^{(i)}\\right)^2 + \\varepsilon} \\right),\n$$\nwhere $p$ is the polynomial degree and $\\varepsilon$ is a small positive number introduced to avoid division by zero. A cell $i$ is flagged as troubled for field $f$ if $S_f^{(i)}  \\tau_f$, where $\\tau_f$ is a threshold.\n\nYou will compare a density-based indicator $S_\\rho^{(i)}$ and a pressure-based indicator $S_p^{(i)}$ for a synthetic one-dimensional shock–density-wave configuration. The computational domain is $[0,1]$ partitioned into $N$ uniform cells with cell size $h=1/N$. The synthetic field at a fixed time is constructed as follows. Let a shock location be $x_s \\in (0,1)$, a left state $(\\rho_L, p_L)$, a right state $(\\rho_R, p_R)$, a density-wave amplitude $a \\ge 0$, and an integer wave frequency $f_{\\text{w}} \\in \\mathbb{N}$. Define\n$$\nu(x) = 0, \\quad\n(\\rho(x), p(x)) = \\begin{cases}\n(\\rho_L, p_L),  x  x_s, \\\\\n\\left(\\rho_R\\left[1 + a \\sin\\left(2\\pi f_{\\text{w}} (x - x_s)\\right)\\right],\\ p_R\\right),  x \\ge x_s,\n\\end{cases}\n$$\nand compute $E(x)$ from $p(x) = (\\gamma - 1)\\left(E(x) - \\tfrac{1}{2}\\rho(x) u(x)^2\\right)$ with $\\gamma=1.4$. This defines conservative variables $\\mathbf{U}(x)$ that are physically plausible ($\\rho(x)  0$, $p(x)  0$) but need not satisfy the evolution equations at this time.\n\nGround truth troubled cells are defined with respect to the discontinuity at $x_s$: a cell $K_i = [x_i, x_{i+1}]$ is a true troubled cell if its closure intersects the shock location, that is, either $x_i  x_s  x_{i+1}$ or $x_s = x_i$ or $x_s = x_{i+1}$. If $x_s$ coincides with a cell interface $x_j$ for some $j$, then both adjacent cells $[x_{j-1}, x_j]$ and $[x_j, x_{j+1}]$ are true troubled cells.\n\nFor each indicator ($\\rho$-based and $p$-based), compute the false positive rate and false negative rate against this ground truth, defined by\n$$\n\\text{FPR}_f = \\frac{\\text{FP}_f}{\\text{FP}_f + \\text{TN}_f}, \\qquad\n\\text{FNR}_f = \\frac{\\text{FN}_f}{\\text{FN}_f + \\text{TP}_f},\n$$\nwhere $\\text{TP}_f$, $\\text{FP}_f$, $\\text{TN}_f$, and $\\text{FN}_f$ denote counts of true positives, false positives, true negatives, and false negatives for field $f \\in \\{\\rho, p\\}$. If a denominator is zero, define the corresponding rate as $0$.\n\nImplement the $L^2$ projection using Gauss–Legendre quadrature with at least $2p+6$ points per cell to compute the modal coefficients $\\{a_n^{(i)}\\}_{n=0}^{p}$ for both $\\rho(x)$ and $p(x)$. Use the sensor $S_f^{(i)}$ defined above with $\\varepsilon = 10^{-16}$.\n\nYour program must evaluate the indicators on the following test suite, covering typical, extreme, and boundary cases:\n\n- Test case $1$ (happy path): $N = 40$, $p = 3$, $x_s = 0.33$, $\\rho_L = 1.0$, $p_L = 1.0$, $\\rho_R = 0.125$, $p_R = 0.1$, $a = 0.2$, $f_{\\text{w}} = 10$, $\\tau_\\rho = -2.5$, $\\tau_p = -2.5$.\n- Test case $2$ (extreme threshold, no flags): $N = 40$, $p = 3$, $x_s = 0.33$, $\\rho_L = 1.0$, $p_L = 1.0$, $\\rho_R = 0.125$, $p_R = 0.1$, $a = 0.2$, $f_{\\text{w}} = 10$, $\\tau_\\rho = 1.0$, $\\tau_p = 1.0$.\n- Test case $3$ (shock at interface, zero wave amplitude): $N = 40$, $p = 3$, $x_s = 0.5$, $\\rho_L = 1.0$, $p_L = 1.0$, $\\rho_R = 0.125$, $p_R = 0.1$, $a = 0.0$, $f_{\\text{w}} = 10$, $\\tau_\\rho = -4.0$, $\\tau_p = -4.0$.\n- Test case $4$ (higher polynomial degree, stronger wave and asymmetrical thresholds): $N = 60$, $p = 5$, $x_s = 0.7$, $\\rho_L = 1.0$, $p_L = 1.0$, $\\rho_R = 0.125$, $p_R = 0.1$, $a = 0.3$, $f_{\\text{w}} = 15$, $\\tau_\\rho = -3.0$, $\\tau_p = -2.0$.\n\nAll quantities are dimensionless in this synthetic setup. Express the false positive and false negative rates as decimals.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, aggregating the four rates per test case in order $(\\text{FPR}_\\rho, \\text{FNR}_\\rho, \\text{FPR}_p, \\text{FNR}_p)$ for test cases $1$ through $4$. For example, the output format must be\n$$\n[\\text{FPR}_\\rho^{(1)}, \\text{FNR}_\\rho^{(1)}, \\text{FPR}_p^{(1)}, \\text{FNR}_p^{(1)}, \\ldots, \\text{FPR}_\\rho^{(4)}, \\text{FNR}_\\rho^{(4)}, \\text{FPR}_p^{(4)}, \\text{FNR}_p^{(4)}],\n$$\nwith each decimal rounded to six places in the program's final printout.",
            "solution": "The problem asks for the implementation and comparison of two troubled-cell indicators (TCIs), one based on density ($\\rho$) and the other on pressure ($p$), within the framework of a Discontinuous Galerkin (DG) method. The comparison will be performed on a synthetic one-dimensional problem involving a shock and a superimposed density wave. The performance of each indicator is to be quantified by its false positive rate (FPR) and false negative rate (FNR) against a defined ground truth.\n\nThe physical model is the set of one-dimensional compressible Euler equations, given by $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0$, where the vector of conservative variables is $\\mathbf{U} = (\\rho, \\rho u, E)^T$ and the flux vector is $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2 + p, u(E+p))^T$. The variables $\\rho$, $u$, $E$, and $p$ represent the fluid density, velocity, total energy per unit volume, and pressure, respectively. The system is closed by the ideal gas equation of state, $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$, with the ratio of specific heats given as $\\gamma=1.4$.\n\nIn a DG method, the solution within each computational cell $K_i = [x_i, x_{i+1}]$ is approximated by a polynomial of degree $p$. It is convenient to work on a reference element $\\xi \\in [-1, 1]$ by using a linear mapping $\\xi(x) = \\frac{2(x - x_i)}{h_i} - 1$, where $h_i = x_{i+1} - x_i$ is the cell width. A scalar field $f(x)$ is represented as a finite expansion in an orthogonal basis, typically the Legendre polynomials $\\{P_n(\\xi)\\}_{n=0}^p$:\n$$\nf(x(\\xi)) \\approx \\sum_{n=0}^{p} a_n^{(i)} P_n(\\xi).\n$$\nThe coefficients $a_n^{(i)}$ are the modal degrees of freedom for cell $i$. They are determined by an $L^2$ projection of the function $f$ onto the basis functions:\n$$\na_n^{(i)} = \\frac{\\int_{K_i} f(x) P_n(\\xi(x)) dx}{\\int_{K_i} P_n(\\xi(x))^2 dx} = \\frac{\\frac{h_i}{2} \\int_{-1}^{1} f(x(\\xi)) P_n(\\xi) d\\xi}{\\frac{h_i}{2} \\int_{-1}^{1} P_n(\\xi)^2 d\\xi} = \\frac{2n+1}{2} \\int_{-1}^{1} f(x(\\xi)) P_n(\\xi) d\\xi,\n$$\nwhere we have used the orthogonality property $\\int_{-1}^{1} P_m(\\xi) P_n(\\xi) d\\xi = \\frac{2}{2n+1}\\delta_{mn}$.\n\nThe Persson–Peraire troubled-cell indicator is based on the principle that for a smooth function, its modal energy is concentrated in the low-degree polynomials, while a discontinuity (like a shock) scatters energy across all modes, including the highest one. The sensor for a field $f$ in cell $i$ is defined as:\n$$\nS_f^{(i)} := \\log_{10}\\left( \\frac{\\left(a_p^{(i)}\\right)^2}{\\sum_{n=0}^{p} \\left(a_n^{(i)}\\right)^2 + \\varepsilon} \\right).\n$$\nThis expression gives the logarithm of the ratio of energy in the highest mode ($n=p$) to the total energy in all modes. A small positive number $\\varepsilon = 10^{-16}$ is added for numerical stability. A cell $i$ is flagged as \"troubled\" if its sensor value exceeds a prescribed threshold, $S_f^{(i)} > \\tau_f$.\n\nThe core of the task is to implement this procedure for a synthetic data profile. The computational domain is $[0, 1]$, discretized into $N$ uniform cells, so $h=1/N$ and $x_i = i/N$ for $i=0, 1, \\dots, N$. The synthetic field is defined with zero velocity, $u(x)=0$, and piecewise functions for density and pressure:\n$$\n(\\rho(x), p(x)) = \\begin{cases}\n(\\rho_L, p_L),  x  x_s \\\\\n\\left(\\rho_R\\left[1 + a \\sin\\left(2\\pi f_{\\text{w}} (x - x_s)\\right)\\right],\\ p_R\\right),  x \\ge x_s\n\\end{cases}\n$$\nThis profile features a discontinuity at the shock location $x_s$ and, for $a > 0$, a smooth, high-frequency density wave to the right of the shock. The pressure profile is a simple step function.\n\nThe numerical algorithm proceeds as follows:\n1.  For each test case, define the parameters $N, p, x_s, \\rho_L, p_L, \\rho_R, p_R, a, f_{\\text{w}}, \\tau_\\rho, \\tau_p$.\n2.  Define the mesh with cell boundaries $x_i = i/N$ for $i=0, \\dots, N$.\n3.  Establish the ground truth: a cell $K_i=[x_i, x_{i+1}]$ is a true troubled cell if its closure contains the shock, i.e., $x_i \\le x_s \\le x_{i+1}$.\n4.  For each cell $K_i$:\n    a. The modal coefficients $\\{a_n^{(i)}\\}_{n=0}^p$ for both $\\rho(x)$ and $p(x)$ are computed by numerical quadrature. The integral for $a_n^{(i)}$ is approximated using Gauss-Legendre quadrature with $N_q = 2p+6$ points $(\\xi_k, w_k)$:\n       $$\n       a_n^{(i)} \\approx \\frac{2n+1}{2} \\sum_{k=1}^{N_q} w_k f\\big(x_i + \\tfrac{h}{2}(\\xi_k+1)\\big) P_n(\\xi_k).\n       $$\n       The set of Legendre polynomials $P_n(\\xi_k)$ for $n=0, \\dots, p$ is pre-evaluated at the quadrature abscissae $\\xi_k$.\n    b. Using the computed coefficients, calculate the sensor values $S_\\rho^{(i)}$ and $S_p^{(i)}$.\n5.  For each field $f \\in \\{\\rho, p\\}$, classify all cells:\n    -   A cell is flagged if $S_f^{(i)} > \\tau_f$.\n    -   Compare the flagged cells with the ground truth to count the number of true positives (TP), false positives (FP), true negatives (TN), and false negatives (FN).\n6.  Calculate the performance metrics. The false positive rate is $\\text{FPR}_f = \\frac{\\text{FP}_f}{\\text{FP}_f + \\text{TN}_f}$ and the false negative rate is $\\text{FNR}_f = \\frac{\\text{FN}_f}{\\text{FN}_f + \\text{TP}_f}$. If a denominator is zero, the corresponding rate is defined to be $0$.\n7.  The results $(\\text{FPR}_\\rho, \\text{FNR}_\\rho, \\text{FPR}_p, \\text{FNR}_p)$ for each test case are collected and formatted for the final output.\n\nThis process is repeated for all four test cases, which are designed to probe the indicator's robustness under different conditions, such as the presence of smooth waves, the location of the shock relative to cell interfaces, and the choice of polynomial degree and thresholds.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import eval_legendre\n\ndef solve():\n    \"\"\"\n    Computes false positive and false negative rates for density- and pressure-based\n    troubled-cell indicators for a synthetic 1D shock-density-wave problem.\n    \"\"\"\n    test_cases = [\n        {'N': 40, 'p': 3, 'xs': 0.33, 'rho_L': 1.0, 'p_L': 1.0, 'rho_R': 0.125, 'p_R': 0.1, 'a': 0.2, 'fw': 10, 'tau_rho': -2.5, 'tau_p': -2.5},\n        {'N': 40, 'p': 3, 'xs': 0.33, 'rho_L': 1.0, 'p_L': 1.0, 'rho_R': 0.125, 'p_R': 0.1, 'a': 0.2, 'fw': 10, 'tau_rho': 1.0, 'tau_p': 1.0},\n        {'N': 40, 'p': 3, 'xs': 0.5, 'rho_L': 1.0, 'p_L': 1.0, 'rho_R': 0.125, 'p_R': 0.1, 'a': 0.0, 'fw': 10, 'tau_rho': -4.0, 'tau_p': -4.0},\n        {'N': 60, 'p': 5, 'xs': 0.7, 'rho_L': 1.0, 'p_L': 1.0, 'rho_R': 0.125, 'p_R': 0.1, 'a': 0.3, 'fw': 15, 'tau_rho': -3.0, 'tau_p': -2.0},\n    ]\n\n    gamma = 1.4\n    epsilon = 1e-16\n    all_results = []\n\n    for params in test_cases:\n        N, p, xs = params['N'], params['p'], params['xs']\n        rho_L, p_L = params['rho_L'], params['p_L']\n        rho_R, p_R = params['rho_R'], params['p_R']\n        a, fw = params['a'], params['fw']\n        tau_rho, tau_p = params['tau_rho'], params['tau_p']\n\n        def rho_func(x):\n            val = np.piecewise(x, [x  xs],\n                               [rho_L, lambda v: rho_R * (1 + a * np.sin(2 * np.pi * fw * (v - xs)))])\n            return val\n        \n        def p_func(x):\n            val = np.piecewise(x, [x  xs], [p_L, p_R])\n            return val\n\n        h = 1.0 / N\n        cell_boundaries = np.linspace(0, 1, N + 1)\n\n        # Determine ground truth troubled cells\n        true_troubled = (cell_boundaries[:-1] = xs)  (xs = cell_boundaries[1:])\n        \n        # Quadrature setup\n        Nq = 2 * p + 6\n        xi_q, w_q = np.polynomial.legendre.leggauss(Nq)\n        \n        # Pre-evaluate Legendre polynomials at quadrature points\n        P_vals = np.array([eval_legendre(n, xi_q) for n in range(p + 1)])\n\n        S_rho = np.zeros(N)\n        S_p = np.zeros(N)\n\n        for i in range(N):\n            x_i = cell_boundaries[i]\n            \n            # Map reference quadrature points to physical cell\n            x_q = x_i + h / 2.0 * (xi_q + 1.0)\n            \n            # Evaluate fields at physical quadrature points\n            rho_vals_q = rho_func(x_q)\n            p_vals_q = p_func(x_q)\n            \n            # Calculate modal coefficients\n            coeffs_rho = np.zeros(p + 1)\n            coeffs_p = np.zeros(p + 1)\n            \n            for n in range(p + 1):\n                # Using P_vals pre-computation for efficiency\n                integral_rho = np.sum(w_q * rho_vals_q * P_vals[n])\n                integral_p = np.sum(w_q * p_vals_q * P_vals[n])\n                \n                coeffs_rho[n] = (2 * n + 1) / 2.0 * integral_rho\n                coeffs_p[n] = (2 * n + 1) / 2.0 * integral_p\n\n            # Calculate sensor values\n            total_energy_sq_rho = np.sum(coeffs_rho**2)\n            S_rho[i] = np.log10((coeffs_rho[p]**2) / (total_energy_sq_rho + epsilon))\n            \n            total_energy_sq_p = np.sum(coeffs_p**2)\n            S_p[i] = np.log10((coeffs_p[p]**2) / (total_energy_sq_p + epsilon))\n\n        # Classify cells and calculate metrics\n        predicted_troubled_rho = S_rho > tau_rho\n        predicted_troubled_p = S_p > tau_p\n\n        # For rho\n        TP_rho = np.sum(predicted_troubled_rho  true_troubled)\n        FP_rho = np.sum(predicted_troubled_rho  ~true_troubled)\n        TN_rho = np.sum(~predicted_troubled_rho  ~true_troubled)\n        FN_rho = np.sum(~predicted_troubled_rho  true_troubled)\n\n        # Denominators for rates\n        denom_fpr_rho = FP_rho + TN_rho\n        denom_fnr_rho = FN_rho + TP_rho\n        \n        FPR_rho = FP_rho / denom_fpr_rho if denom_fpr_rho > 0 else 0.0\n        FNR_rho = FN_rho / denom_fnr_rho if denom_fnr_rho > 0 else 0.0\n\n        # For p\n        TP_p = np.sum(predicted_troubled_p  true_troubled)\n        FP_p = np.sum(predicted_troubled_p  ~true_troubled)\n        TN_p = np.sum(~predicted_troubled_p  ~true_troubled)\n        FN_p = np.sum(~predicted_troubled_p  true_troubled)\n\n        # Denominators for rates\n        denom_fpr_p = FP_p + TN_p\n        denom_fnr_p = FN_p + TP_p\n        \n        FPR_p = FP_p / denom_fpr_p if denom_fpr_p > 0 else 0.0\n        FNR_p = FN_p / denom_fnr_p if denom_fnr_p > 0 else 0.0\n        \n        all_results.extend([FPR_rho, FNR_rho, FPR_p, FNR_p])\n\n    print(f\"[{','.join(f'{r:.6f}' for r in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}