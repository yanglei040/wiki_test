{
    "hands_on_practices": [
        {
            "introduction": "理论的深度体现在其分析能力上。本实践将通过严格的数学推导，引导您深入探索间断 Galerkin (DG) 方法的内在结构。您将证明，对于线性平流方程，在均匀周期网格上采用迎风格式的 DG 算子具有块循环 (block-circulant) 结构，并推导出其傅里葉符号 (Fourier symbol) 的解析表达式。这项练习不仅能加深您对 DG 方法代数结构的理解，更是掌握色散和稳定性分析等高级工具的基石。",
            "id": "3405176",
            "problem": "考虑线性平流方程 $u_{t} + a\\,u_{x} = 0$，定义在周期性域 $[0,L]$ 上，其中平流速度 $a \\in \\mathbb{R} \\setminus \\{0\\}$ 为常数。使用 $K$ 个大小为 $h=L/K$ 的单元将该域离散化为一个均匀网格。在每个单元上，使用间断 Galerkin (DG) 方法，在由从参考区间 $[-1,1]$ 映射过来的 $(p+1)$ 个 Gauss–Lobatto–Legendre 点组成的节点基上，用 $p$ 次多项式来近似 $u$。对于 $a>0$（右行情况），使用迎风数值通量，并施加周期性边界条件。\n\n1. 从每个单元上映射到参考区间 $[-1,1]$ 的 DG 弱形式出发，利用 Gauss–Lobatto–Legendre 求积的性质（对角质量矩阵和分部求和恒等式），证明在全局自由度向量上得到的半离散 DG 算子是一个块托普利茨 (block Toeplitz) 矩阵，其块大小为 $(p+1)\\times(p+1)$，且仅耦合最近邻单元。精确地，证明该半离散算子是块双循环 (block bi-circulant) 的，有一个对角块 $\\mathbf{A}_{0}$ 和一个次对角块 $\\mathbf{A}_{-1}$，使得对于波数 $\\theta \\in [0,2\\pi)$，其傅里叶符号（块符号）为\n$$\n\\mathbf{A}(\\theta) \\;=\\; \\mathbf{A}_{0} \\;+\\; \\exp(-\\mathrm{i}\\,\\theta)\\,\\mathbf{A}_{-1}.\n$$\n推导 $\\mathbf{A}(\\theta)$ 的一个闭式表达式，用 Gauss–Lobatto–Legendre 求积的对角质量矩阵 $\\mathbf{M}$、一阶导数的分部求和矩阵 $\\mathbf{Q}=\\mathbf{M}\\mathbf{D}$（其中 $\\mathbf{D}$ 是 $[-1,1]$ 上的节点微分矩阵）以及左边界提升矩阵 $\\mathbf{B}^{-}$ 来表示。\n\n2. 使用该闭式符号，分析此半离散系统上精确前向欧拉法的稳定性。证明傅里叶符号如何导出一个形式为 $|a|\\,\\Delta t/h \\leq C_{p}$ 的 Courant–Friedrichs–Lewy (CFL) 界，该界是前向欧拉法稳定性的充分必要条件。你的推导必须仅依赖于分部求和性质和 $p$ 次精确的端点 Gauss–Lobatto–Legendre 权重。\n\n将最终答案表示为关于 $p$ 的 Courant 数常数 $C_{p}$ 的单个闭式解析表达式。不需要数值近似。",
            "solution": "我们从线性平流方程 $u_{t} + a\\,u_{x} = 0$ 及其在均匀周期网格上的间断 Galerkin (DG) 离散化开始。在长度为 $h$ 的单元 $I_{i}=[x_{i-\\frac{1}{2}},x_{i+\\frac{1}{2}}]$ 上，我们通过 $x = x_{i} + \\frac{h}{2}\\,\\xi$ 将 $x \\in I_{i}$ 映射到参考坐标 $\\xi \\in [-1,1]$。将 $[-1,1]$ 上的 $(p+1)$ 个 Gauss–Lobatto–Legendre 节点记为 $\\{\\xi_{j}\\}_{j=1}^{p+1}$，相应的拉格朗日基函数记为 $\\{\\ell_{j}(\\xi)\\}_{j=1}^{p+1}$，求积权重记为 $\\{w_{j}\\}_{j=1}^{p+1}$，其中 $w_{1}=w_{p+1}=\\frac{2}{p(p+1)}$。参考单元上的质量矩阵是对角的，\n$$\n\\mathbf{M} \\;=\\; \\mathrm{diag}(w_{1},w_{2},\\dots,w_{p+1}).\n$$\n设 $\\mathbf{D}$ 是 $(p+1)\\times(p+1)$ 的节点微分矩阵，其元素为 $D_{jk} = \\ell_{k}'(\\xi_{j})$，并定义分部求和 (SBP) 矩阵 $\\mathbf{Q} = \\mathbf{M}\\mathbf{D}$。Gauss–Lobatto–Legendre SBP 恒等式为\n$$\n\\mathbf{Q} \\;+\\; \\mathbf{Q}^{\\top} \\;=\\; \\mathbf{B},\n$$\n其中 $\\mathbf{B} = \\mathrm{diag}(-1,0,\\dots,0,+1)$ 编码了在 $\\xi=-1$ 和 $\\xi=+1$ 处的端点贡献。定义左边界提升矩阵 $\\mathbf{B}^{-} = \\mathrm{diag}(1,0,\\dots,0)$ 和右边界提升矩阵 $\\mathbf{B}^{+} = \\mathrm{diag}(0,\\dots,0,1)$。对于 $a>0$（右行平流），单元 $i$ 的右界面的迎风数值通量使用来自单元 $i$ 的内部迹，而左界面使用来自单元 $i-1$ 的内部迹。\n\n在单元 $i$ 上，通过与节点基函数做内积并使用精确求积，可以得到节点值 $\\mathbf{u}_{i} \\in \\mathbb{R}^{p+1}$ 的强形式 DG 半离散化：\n$$\n\\frac{\\mathrm{d}\\mathbf{u}_{i}}{\\mathrm{d}t}\n\\;=\\;\n-\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\left(\\mathbf{Q}\\,\\mathbf{u}_{i} \\;-\\; \\mathbf{B}^{-}\\,\\mathbf{u}_{i} \\right)\n\\;+\\;\n\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{B}^{-}\\,\\mathbf{u}_{i-1}.\n$$\n该表达式由在界面处插入数值通量的弱形式，然后利用 SBP 性质改写为强形式得到。项 $-\\frac{a}{h}\\mathbf{M}^{-1}\\mathbf{Q}\\mathbf{u}_{i}$ 代表参考单元上的导数贡献，而 $\\mathbf{M}^{-1}\\mathbf{B}^{-}$ 将左界面通量贡献提升到体自由度上。对于 $a>0$，右界面的迎风选择抵消了强形式中的 $\\mathbf{B}^{+}$ 贡献（因为它在同一单元内部），而左界面贡献了来自邻居单元 $\\mathbf{u}_{i-1}$ 的项。\n\n将所有单元向量堆叠成全局向量 $\\mathbf{U} = [\\mathbf{u}_{1}^{\\top},\\dots,\\mathbf{u}_{K}^{\\top}]^{\\top}$，半离散系统可写为\n$$\n\\frac{\\mathrm{d}\\mathbf{U}}{\\mathrm{d}t} \\;=\\; \\mathbf{L}\\,\\mathbf{U},\n$$\n其中全局算子 $\\mathbf{L}$ 由于周期性和均匀性而成为块双循环 (block bi-circulant) 矩阵。具体来说，$\\mathbf{L}$ 是一个块托普利茨（实际上是块循环）矩阵，其块大小为 $(p+1)\\times(p+1)$\n$$\n\\mathbf{A}_{0} \\;=\\; -\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\left(\\mathbf{Q} - \\mathbf{B}^{-}\\right),\n\\qquad\n\\mathbf{A}_{-1} \\;=\\; \\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{B}^{-},\n$$\n并且除了周期性回绕的块外，所有其他非对角块都为零。因此，对于波数为 $\\theta \\in [0,2\\pi)$ 的傅里叶模式 $\\exp(\\mathrm{i}\\,\\theta i)$，其块符号（傅里叶符号）为\n$$\n\\mathbf{A}(\\theta) \\;=\\; \\mathbf{A}_{0} \\;+\\; \\exp(-\\mathrm{i}\\,\\theta)\\,\\mathbf{A}_{-1}\n\\;=\\;\n-\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{Q}\n\\;+\\;\n\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{B}^{-}\\left(\\exp(-\\mathrm{i}\\,\\theta)-1\\right).\n$$\n这就是所求的闭式表达式，它仅通过 $\\mathbf{M}$、$\\mathbf{Q}$ 和 $\\mathbf{B}^{-}$ 依赖于 $p$（所有这些都由 $p$ 次的 Gauss–Lobatto–Legendre 网格确定）。\n\n我们现在使用符号 $\\mathbf{A}(\\theta)$ 来推导前向欧拉法的精确 Courant–Friedrichs–Lewy (CFL) 界。前向欧拉法的更新步骤是\n$$\n\\mathbf{U}^{n+1} \\;=\\; \\mathbf{U}^{n} \\;+\\; \\Delta t\\,\\mathbf{L}\\,\\mathbf{U}^{n}.\n$$\n周期网格上的稳定性问题简化为 $(p+1)$ 维符号动力学的稳定性问题\n$$\n\\widehat{\\mathbf{u}}^{n+1}(\\theta)\n\\;=\\;\n\\left[\\mathbf{I} \\;+\\; \\Delta t\\,\\mathbf{A}(\\theta)\\right]\\,\\widehat{\\mathbf{u}}^{n}(\\theta),\n$$\n对所有 $\\theta\\in[0,2\\pi)$ 一致成立，其中 $\\widehat{\\mathbf{u}}$ 是关于单元的离散傅里叶变换。前向欧拉法的稳定性要求 $\\Delta t\\,\\mathbf{A}(\\theta)$ 的所有特征值 $z$ 都位于闭圆盘 $\\{z: |1+z|\\leq 1\\}$ 内，这等价于对于 $\\mathbf{A}(\\theta)$ 的所有特征值 $\\lambda$ 和所有 $\\theta$，都有 $|1+\\Delta t\\,\\lambda|\\leq 1$。对于一个给定的特征值 $\\lambda = \\rho\\,\\exp(\\mathrm{i}\\,\\varphi)$，前向欧拉法稳定区域的边界由 $|1+\\rho\\,\\exp(\\mathrm{i}\\,\\varphi)|=1$ 给出，从而得到精确的稳定性阈值\n$$\n\\rho_{\\max}(\\varphi)\\,\\Delta t \\;=\\; -\\,2\\,\\cos\\varphi,\n\\quad\n\\text{for } \\cos\\varphi < 0,\n$$\n当 $\\cos\\varphi \\geq 0$ 时没有允许的 $\\Delta t$。因此，最严格的条件发生在特征值位于负实轴上时（$\\varphi=\\pi$），此时有 $\\Delta t \\leq 2/|\\rho|$。\n\n对于上面推导的 DG 符号，由于 SBP 恒等式，项 $\\mathbf{M}^{-1}\\mathbf{Q}$ 在由 $\\mathbf{M}$ 诱导的能量范数下贡献了一个斜对称分量，而项 $\\mathbf{M}^{-1}\\mathbf{B}^{-}(\\exp(-\\mathrm{i}\\,\\theta)-1)$ 贡献了一个秩为一的耗散分量，其对所有 $\\theta$ 的实部都是非正的。耗散最强的情况发生在 $\\theta=\\pi$ 处，此时 $\\exp(-\\mathrm{i}\\,\\theta)-1 = -2$，得到\n$$\n\\mathbf{A}(\\pi) \\;=\\; -\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{Q} \\;-\\; 2\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{B}^{-}.\n$$\n由于 $\\mathbf{M}^{-1}\\mathbf{B}^{-}$ 是对角矩阵，其唯一的非零特征值为 $1/w_{1}$，因此 $\\mathbf{A}(\\pi)$ 的谱横坐标（最负的实部）恰好是\n$$\n\\alpha_{\\min} \\;=\\; -\\,2\\,\\frac{|a|}{h}\\,\\frac{1}{w_{1}}\n\\;=\\;\n-\\,2\\,\\frac{|a|}{h}\\,\\frac{p(p+1)}{2}\n\\;=\\;\n-\\,\\frac{|a|}{h}\\,p(p+1),\n$$\n这里使用了 $w_{1}=\\frac{2}{p(p+1)}$。这个实特征值主导了前向欧拉法的稳定性约束，因为斜对称部分对实部没有贡献。因此，充分必要稳定性条件是\n$$\n\\Delta t \\;\\leq\\; \\frac{2}{|\\alpha_{\\min}|}\n\\;=\\;\n\\frac{2}{\\frac{|a|}{h}\\,p(p+1)}\n\\;=\\;\n\\frac{2\\,h}{|a|\\,p(p+1)}.\n$$\n等价地，由 $|a|\\,\\Delta t/h$ 定义的 Courant 数必须满足\n$$\n\\frac{|a|\\,\\Delta t}{h} \\;\\leq\\; C_{p},\n\\qquad\nC_{p} \\;=\\; \\frac{2}{p(p+1)}.\n$$\n这个 $C_{p}$ 是精确的，因为它源于精确的端点 Gauss–Lobatto–Legendre 权重、$\\mathbf{M}^{-1}\\mathbf{B}^{-}$ 的秩一结构，以及最严格的傅里叶模式是 $\\theta=\\pi$（在此模式下符号的耗散项达到其最大量值）这一事实。\n\n总之，我们已经展示了周期性均匀网格上全局 DG 算子的块托普利茨结构，推导了闭式块符号\n$$\n\\mathbf{A}(\\theta) \\;=\\; -\\,\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{Q}\n\\;+\\;\n\\frac{a}{h}\\,\\mathbf{M}^{-1}\\,\\mathbf{B}^{-}\\left(\\exp(-\\mathrm{i}\\,\\theta)-1\\right),\n$$\n并获得了精确的前向欧拉 Courant 数界 $C_{p} = 2/[p(p+1)]$。",
            "answer": "$$\\boxed{\\frac{2}{p(p+1)}}$$"
        },
        {
            "introduction": "在掌握了 DG 算子的解析结构之后，下一个关键步骤是通过数值实验来直观地探索其谱特性。本实践将指导您编写代码，构建线性平流方程的半离散 DG 算子矩阵，并研究数值通量中的耗散参数 $\\alpha$ 如何影响其特征值谱。通过计算和可视化特征值的分布，您将清晰地看到从中心通量 ($\\alpha=0$) 到迎风通量 ($\\alpha=1$) 的过渡如何将特征值从虚轴推向左半复平面，从而为显式时间积分方案带来稳定性。",
            "id": "3405180",
            "problem": "考虑一维线性平流方程 $u_t + a u_x = 0$，定义在长度为 $L = 1$ 的周期性区域上，其中平流速度为常数 $a = 1$。使用节点型间断伽辽金谱元法 (DGSEM)，每个单元采用 Legendre–Gauss–Lobatto (LGL) 点，并强制执行分部求和 (SBP) 性质。半离散的 DGSEM 算子构建在包含 $K$ 个单元的均匀网格上，每个单元大小为 $h = L/K$，使用参考单元映射和强形式的配置微分。界面处的数值通量取为单参数族：\n$$\n\\widehat{f}(u^-, u^+) = a \\left( \\tfrac{1}{2} (u^- + u^+) - \\tfrac{\\alpha}{2} (u^+ - u^-) \\right),\n$$\n其中 $u^-$ 和 $u^+$ 分别是界面左右两侧的迹，$\\alpha \\in [0,1]$ 是界面跳跃的惩罚强度。特殊情况包括 $\\alpha = 0$ (中心格式)，$\\alpha = 1$ (迎风格式)，以及介于两者之间的 $\\alpha$ 值，对应于带有局部 Lax–Friedrichs 惩罚的斜对称分裂形式通量。\n\n您的任务是：\n1. 从 DG 弱形式和 SBP 性质出发，推导一个半离散矩阵算子 $\\mathbf{L}(\\alpha, p, K)$，使得全局自由度向量 $\\mathbf{u}$ 满足 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}(\\alpha, p, K) \\mathbf{u}$。其中，$p$ 是每个单元的多项式次数，节点基由每个单元上的 $p+1$ 个 LGL 节点构成。\n2. 对每个 $\\alpha$，计算 $\\mathbf{L}(\\alpha, p, K)$ 的特征值，并分析谱的实部和虚部如何依赖于 $p$ 和 $\\alpha$。特别地，识别出那些实部远低于谱主体部分的“离群”特征模态，并量化其大小如何随界面惩罚强度 $\\alpha$ 变化。\n\n在您的推导和构建过程中，请使用以下基础：\n- 每个单元上的 DG 弱形式，其中单元边界处的物理通量被界面数值通量替代。\n- 从物理坐标 $x$ 到参考坐标 $\\xi \\in [-1,1]$ 的映射，$x = x_e + \\frac{h}{2}\\xi$ 且 $u_x = \\frac{2}{h} u_\\xi$。\n- 在 LGL 点上的节点配置，使用基于 LGL 求积权重的对角质量矩阵，以及由 LGL 节点上的拉格朗日基导数获得的微分矩阵。\n- LGL 微分和求积对的分部求和 (SBP) 性质，它确保了中心通量的能量稳定性，并控制了带惩罚项通量的耗散。\n\n数值与算法要求：\n- 使用 $K = 8$ 个单元，并采用周期性边界条件。\n- 对每组 $p \\in \\{1,2,4\\}$ 和 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$，组装 $\\mathbf{L}(\\alpha, p, K)$ 并计算其所有特征值。\n- 使用阈值定义离群值\n$$\n\\theta = \\min\\left( \\mu_{\\Re} - 2 \\sigma_{\\Re}, -10^{-8} \\right),\n$$\n其中 $\\mu_{\\Re}$ 和 $\\sigma_{\\Re}$ 分别是特征值实部的均值和标准差。将实部严格小于 $\\theta$ 的特征值计为离群值。\n- 对每个 $p$，计算 $\\alpha$ 值列表 $[0.0, 0.5, 1.0]$ 与对应的特征值最小实部列表 $\\left[\\min \\Re(\\lambda(\\alpha))\\right]$ 之间的皮尔逊相关系数。该系数用于量化加强界面惩罚如何将最具耗散性的模态在复平面上进一步向左推移。\n- 对每个 $p$，还需计算 $\\Delta_{\\min} = \\min \\Re(\\lambda(\\alpha{=}1.0)) - \\min \\Re(\\lambda(\\alpha{=}0.0))$，以及在 $\\alpha = 1.0$ 时的离群值数量。\n\n测试套件：\n- 单元数 $K = 8$，区域长度 $L = 1$，平流速度 $a = 1$。\n- 多项式次数 $p \\in \\{1, 2, 4\\}$。\n- 惩罚强度 $\\alpha \\in \\{0.0, 0.5, 1.0\\}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于按升序排列的每个 $p$，附加一个三元组\n  - $\\alpha$ 和 $\\min \\Re(\\lambda)$ 之间的相关系数（浮点数），\n  - $\\Delta_{\\min}$ 的值（浮点数），\n  - 在 $\\alpha = 1.0$ 时的离群值数量（整数）。\n- 因此，最终输出必须按 $p = 1, p = 2, p = 4$ 的顺序包含 3 个三元组，总共得到一个包含 9 个条目的列表，例如： \n\"[corr_p1,delta_p1,count_p1,corr_p2,delta_p2,count_p2,corr_p4,delta_p4,count_p4]\"。",
            "solution": "所提出的问题是偏微分方程数值分析中的一个明确定义且标准的任务，具体涉及线性平流方程的间断伽辽金谱元法 (DGSEM) 的谱特性。所有参数和方法，如方程、区域、DGSEM 公式、Legendre-Gauss-Lobatto (LGL) 节点、分部求和 (SBP) 性质以及数值通量的定义，都是标准的且已正确指定。该问题具有科学依据，内容自洽，并且在算法上是可行的。因此，我们可以着手进行推导和求解。\n\n我们的目标是为一维线性平流方程 $u_t + a u_x = 0$ 构建半离散矩阵算子 $\\mathbf{L}(\\alpha, p, K)$ 并分析其特征值。区域是长度为 $L=1$ 的周期性区域，被离散为 $K$ 个大小为 $h=L/K$ 的均匀单元。平流速度为 $a=1$。每个单元内的解由一个次数为 $p$ 的多项式在由 $p+1$ 个 LGL 点定义的节点基上进行近似。\n\n我们从强形式的 DGSEM 公式开始。在每个单元 $k$ 上，我们在 $p+1$ 个 LGL 节点上对偏微分方程进行配置。设 $\\mathbf{u}_k$ 为单元 $k$ 内 LGL 节点上解值的向量。这些节点上解的时间导数由应用于解的空间算子，加上界面通量的修正项给出。空间导数 $u_x$ 通过 $u_x = \\frac{2}{h} u_\\xi$ 映射到参考单元 $\\xi \\in [-1, 1]$。节点上的导数 $u_\\xi$ 通过与 LGL 微分矩阵 $\\mathbf{D}$ 的矩阵向量乘积来近似。\n\n单元 $k$ 中自由度 $\\mathbf{u}_k$ 的半离散方程为\n$$\n\\frac{d\\mathbf{u}_k}{dt} = -a \\frac{2}{h} \\mathbf{D} \\mathbf{u}_k + \\mathbf{C}_k\n$$\n其中 $\\mathbf{C}_k$ 是一个修正向量，它强制执行用户在单元界面处定义的数值通量。此修正仅影响单元的边界节点，对于 LGL 点，即第一个节点 ($\\xi_0 = -1$) 和最后一个节点 ($\\xi_p = 1$) 。节点 $i$ 的修正项由数值通量和物理通量之差导出，并按相应质量矩阵项的倒数进行缩放。对于对角质量矩阵 $\\mathbf{M} = \\text{diag}(w_0, \\dots, w_p)$（由雅可比行列式 $h/2$ 缩放），节点 $i$ 的更新公式为：\n$$\n\\frac{du_{i,k}}{dt} = -a \\frac{2}{h} (\\mathbf{D} \\mathbf{u}_k)_i - \\frac{2}{h} \\frac{1}{w_i} \\left[ \\delta_{ip} (\\widehat{f}(u_p^k, u_0^{k+1}) - f(u_p^k)) - \\delta_{i0} (\\widehat{f}(u_p^{k-1}, u_0^k) - f(u_0^k)) \\right]\n$$\n其中 $f(u) = au$ 是物理通量，$u_j^k$ 表示单元 $k$ 的节点 $j$ 上的解。克罗内克 δ 符号 $\\delta_{ip}$ 和 $\\delta_{i0}$ 确保修正仅分别应用于节点 $p$（右边界, $\\xi=1$）和节点 $0$（左边界, $\\xi=-1$）。相邻单元的索引 $k-1$ 和 $k+1$ 按周期性处理。\n\n数值通量由 $\\widehat{f}(u^-, u^+) = a \\left( \\frac{1}{2} (u^- + u^+) - \\frac{\\alpha}{2} (u^+ - u^-) \\right)$ 给出，可以重写为 $\\widehat{f}(u^-, u^+) = a \\left( \\frac{1+\\alpha}{2} u^- + \\frac{1-\\alpha}{2} u^+ \\right)$。\n\n在单元 $k$ 的左边界（节点 0），我们有 $u^- = u_p^{k-1}$ 和 $u^+ = u_0^k$。通量失配为：\n$$\n\\widehat{f}(u_p^{k-1}, u_0^k) - f(u_0^k) = a \\left( \\frac{1+\\alpha}{2} u_p^{k-1} + \\frac{1-\\alpha}{2} u_0^k \\right) - a u_0^k = a \\frac{1+\\alpha}{2} u_p^{k-1} - a \\frac{1+\\alpha}{2} u_0^k = -a \\frac{1+\\alpha}{2} (u_0^k - u_p^{k-1})\n$$\n在单元 $k$ 的右边界（节点 $p$），我们有 $u^- = u_p^k$ 和 $u^+ = u_0^{k+1}$。通量失配为：\n$$\n\\widehat{f}(u_p^k, u_0^{k+1}) - f(u_p^k) = a \\left( \\frac{1+\\alpha}{2} u_p^k + \\frac{1-\\alpha}{2} u_0^{k+1} \\right) - a u_p^k = a \\frac{1-\\alpha}{2} u_0^{k+1} - a \\frac{1-\\alpha}{2} u_p^k = a \\frac{1-\\alpha}{2} (u_0^{k+1} - u_p^k)\n$$\n将这些代入节点更新方程：\n对于节点 $i=0$：\n$$\n\\frac{du_{0,k}}{dt} = -a \\frac{2}{h} (\\mathbf{D} \\mathbf{u}_k)_0 - \\frac{2}{h} \\frac{1}{w_0} \\left[ - \\left( -a \\frac{1+\\alpha}{2} (u_0^k - u_p^{k-1}) \\right) \\right] = -a \\frac{2}{h} (\\mathbf{D} \\mathbf{u}_k)_0 - \\frac{a(1+\\alpha)}{h w_0} (u_0^k - u_p^{k-1})\n$$\n对于节点 $i=p$：\n$$\n\\frac{du_{p,k}}{dt} = -a \\frac{2}{h} (\\mathbf{D} \\mathbf{u}_k)_p - \\frac{2}{h} \\frac{1}{w_p} \\left[ a \\frac{1-\\alpha}{2} (u_0^{k+1} - u_p^k) \\right] = -a \\frac{2}{h} (\\mathbf{D} \\mathbf{u}_k)_p - \\frac{a(1-\\alpha)}{h w_p} (u_0^{k+1} - u_p^k)\n$$\n现在我们可以组装大小为 $N \\times N$ 的全局矩阵算子 $\\mathbf{L}$，其中 $N=K(p+1)$。全局自由度向量为 $\\mathbf{U} = [\\mathbf{u}_0^T, \\dots, \\mathbf{u}_{K-1}^T]^T$。系统为 $\\frac{d\\mathbf{U}}{dt} = \\mathbf{L} \\mathbf{U}$。矩阵 $\\mathbf{L}$ 具有块循环结构。对角块 $\\mathbf{L}_{k,k}$ 表示单元内贡献，而非对角块 $\\mathbf{L}_{k,k-1}$ 和 $\\mathbf{L}_{k,k+1}$ 表示单元间耦合。\n\n1.  **体积项**：微分项 $-a \\frac{2}{h} \\mathbf{D}$ 对对角块 $\\mathbf{L}_{k,k}$ 有贡献。\n2.  **界面项（对角块）**：\n    - 项 $-\\frac{a(1+\\alpha)}{h w_0} u_0^k$ 加到 $\\mathbf{L}_{k,k}$ 的 $(0,0)$ 元素上。\n    - 项 $+\\frac{a(1-\\alpha)}{h w_p} u_p^k$ 加到 $\\mathbf{L}_{k,k}$ 的 $(p,p)$ 元素上。\n3.  **界面项（非对角块）**：\n    - 项 $+\\frac{a(1+\\alpha)}{h w_0} u_p^{k-1}$ 对块 $\\mathbf{L}_{k,k-1}$ 的 $(0,p)$ 元素有贡献。\n    - 项 $-\\frac{a(1-\\alpha)}{h w_p} u_0^{k+1}$ 对块 $\\mathbf{L}_{k,k+1}$ 的 $(p,0)$ 元素有贡献。\n\n基于 LGL 点的微分算子 $\\mathbf{D}$ 和质量矩阵 $\\mathbf{M}$ 的 SBP 性质为 $\\mathbf{M}\\mathbf{D} + (\\mathbf{M}\\mathbf{D})^T = \\text{diag}(-1, 0, \\dots, 0, 1)$。此性质保证了对于中心通量（$\\alpha=0$），半离散算子是能量稳定的，意味着特征值具有零或非正实部（对于平流方程，理想情况下为零）。对于 $\\alpha > 0$，会引入耗散，将特征值的实部推向严格为负。\n\n数值实现将为每组给定的参数 $(p, \\alpha)$ 构建该矩阵，计算其特征值，并执行指定的分析：计算 $\\alpha$ 与特征值最小实部之间的皮尔逊相关性，迎风通量和中心通量下最小实部的差异，以及计算迎风情况下离群模态的数量。",
            "answer": "[-1.000000,-16.000000,2,-1.000000,-48.000000,2,-1.000000,-160.000000,2]"
        },
        {
            "introduction": "数值通量的设计不仅关乎稳定性和精度，更需在模拟复杂物理系统时保持关键的物理守恒律或平衡态。本实践将带您进入一个更高级的应用领域：针对含科里奥利力的浅水方程，设计一种能够精确保持地转平衡 (geostrophic balance) 的“通量-源项”配对方法。您将通过编程实现 DG 离散，并量化对比“良好平衡” (well-balanced) 格式与非平衡格式在维持定常解时的表现，深刻体会数值格式设计对于物理保真度的重要性。",
            "id": "3405150",
            "problem": "考虑在平坦底面上的二维浅水方程，其中包含科里奥利加速度，方程以流体深度 $h(x,y,t)$ 和深度平均速度 $(u(x,y,t),v(x,y,t))$ 写出：\n$$\n\\partial_t h + \\partial_x (h u) + \\partial_y (h v) = 0,\n$$\n$$\n\\partial_t (h u) + \\partial_x\\left(h u^2 + \\tfrac{1}{2} g h^2\\right) + \\partial_y (h u v) = f_c h v,\n$$\n$$\n\\partial_t (h v) + \\partial_x (h u v) + \\partial_y\\left(h v^2 + \\tfrac{1}{2} g h^2\\right) = - f_c h u,\n$$\n其中 $g$ 是重力加速度，$f_c$ 是科里奥利参数。假设场仅依赖于坐标 $y$ 和时间 $t$（无 $x$ 方向变化），并考虑地转平衡稳态，其中 $(\\partial_t h,\\partial_t u,\\partial_t v)=(0,0,0)$，$v(y)=0$，并且 $u(y)$ 使得 $y$ 方向动量方程平衡了静水压力梯度和科里奥利力。\n\n您将为一维 $y$ 域上的 $y$ 方向动量方程构建并分析一个间断伽辽金 (DG) 离散化：\n$$\n\\partial_t (h v) + \\partial_y\\left(\\tfrac{1}{2} g h^2\\right) = - f_c h u,\n$$\n在地转平衡假设 $v(y)=0$ 下。计算域是区间 $[0,1]$，被划分为两个相等的单元 $[0,\\tfrac{1}{2}]$ 和 $[\\tfrac{1}{2},1]$。在每个单元上，使用勒让德-高斯-洛巴托节点，构建一个 $p$ 次多项式近似，并让 $\\{\\ell_j(y)\\}_{j=0}^{p}$ 表示局部拉格朗日基函数。将静水压力通量和科里奥利源项分别表示为 $F(y) := \\tfrac{1}{2} g h(y)^2$ 和 $S(y) := - f_c h(y) u(y)$。在地转平衡稳态下，$y$ 方向动量方程的 DG 弱形式简化为对每个基函数 $\\ell_j$ 进行测试，并强制离散残差\n$$\n\\mathcal{R}_j = - \\int_{K} \\partial_y \\ell_j(y)\\, F(y)\\, dy + \\left.\\ell_j(y)\\,F^*(y)\\,n(y)\\right|_{\\partial K} - \\int_K \\ell_j(y)\\, S(y)\\, dy,\n$$\n在每个单元 $K$ 上为零。其中 $n(y)$ 是单元边界处的外向单位法向量（在一维中，左侧面 $n=-1$，右侧面 $n=+1$），$F^*(y)$ 是单元边界处的数值通量函数。任务是：\n1. 从连续地转平衡关系（静水压力梯度等于科里奥利力）出发，证明一种通量-源项配对的合理性。在该配对中，界面通量函数 $F^*$ 和一个离散源项被如此选择，使得对于在勒让德-高斯-洛巴托节点上表示的地转平衡态，只要单元边界上的 $h$ 值在共享界面上被一致地求值，离散残差 $\\mathcal{R}_j$ 就能精确地为零。\n2. 量化将体积源积分替换为一个与通量配对不匹配的替代求积法则对离散残差的影响，并解释这种不平衡的机制。\n\n您必须实现一个程序，对于给定的 $p$、重力加速度 $g$、科里奥利参数 $f_c$ 以及一个深度剖面 $h(y)$ 及其对应的地转速度 $u(y)$，计算两个单元上所有自由度的离散残差向量，并返回残差的欧几里得范数。在所有计算中，使用无量纲单位，其中 $g=1$ 和 $f_c=1$（不需要物理单位转换；以浮点数报告无量纲的残差大小）。\n\n对于通量-源项配对，强制执行以下设计选择：\n- 使用的界面数值通量 $F^*$ 等于在 $h$ 的共享边界值处计算的静水压力势（边界坐标对两个相邻单元是共同的，因此在对 $h$ 进行逐点求值时，边界值是单值的）。\n- 为实现精确的地转平衡保持，通过与通量体积项相同的勒让德-高斯-洛巴托微分算子计算的静水压力势的离散导数来离散化科里奥利源。\n- 对于求积不匹配分析，通过在每个单元上使用 $q$ 个点的勒让德-高斯求积来近似科里奥利源体积积分，在这些求积点上计算连续表达式 $S(y)=g h(y)\\,\\partial_y h(y)$ 以及在相同点上的基函数。保持通量体积项和界面通量与精确配对中的相同。\n\n您的程序必须实现以下测试套件，并按照本问题末尾指定的精确格式在单行中输出四个残差范数：\n\n- 测试用例 1（匹配配对，多项式深度）：$p=4$，$h(y)=1+0.2\\,y+0.1\\,y^2$，$g=1$，$f_c=1$。使用精确配对（离散源为使用与静水压力势相同的勒让德-高斯-洛巴托算子计算的离散导数）。返回组装的残差向量的欧几里得范数。\n\n- 测试用例 2（求积不匹配，相同的多项式深度）：$p=4$，$h(y)=1+0.2\\,y+0.1\\,y^2$，$g=1$，$f_c=1$，但使用每个单元 $q=5$ 个点的勒让德-高斯求积来计算源体积积分，并在这些点上计算连续公式 $S(y)=g h(y)\\,\\partial_y h(y)$。返回组装的残差向量的欧几里得范数。\n\n- 测试用例 3（边界度数边缘情况，线性深度与不匹配）：$p=1$，$h(y)=1+0.3\\,y$，$g=1$，$f_c=1$，源积分采用每个单元 $q=2$ 个点的勒让德-高斯求积。返回组装的残差向量的欧几里得范数。\n\n- 测试用例 4（非多项式深度与不匹配）：$p=6$，$h(y)=1+0.1\\sin(2\\pi y)$，$g=1$，$f_c=1$，源积分采用每个单元 $q=6$ 个点的勒让德-高斯求积。返回组装的残差向量的欧几里得范数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个残差范数，格式为方括号内的逗号分隔列表。例如，它应打印如下形式的一行：\n$$\n[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]\n$$\n其中每个条目都是一个浮点数。",
            "solution": "该问题要求构建和分析浅水方程一维 $y$ 方向动量方程的间断伽辽金 (DG) 离散化，并特别针对地转平衡稳态。分析的重点是适定平衡 (well-balancing) 的概念，即数值格式被设计成能够精确地保持这种平衡状态。\n\n首先，我们建立连续地转平衡关系。给定浅水方程，在稳态 ($\\partial_t = 0$)、无 $x$ 方向变化 ($\\partial_x = 0$) 以及 $y$ 方向速度为零 ($v=0$) 的假设下，$y$ 方向动量方程显著简化。\n完整的方程是：\n$$\n\\partial_t (h v) + \\partial_x (h u v) + \\partial_y\\left(h v^2 + \\tfrac{1}{2} g h^2\\right) = - f_c h u\n$$\n应用这些假设，所有包含 $v$ 或 $\\partial_t$ 的项都消失了，并且根据假设 $\\partial_x$ 项为零，剩下：\n$$\n\\partial_y\\left(\\tfrac{1}{2} g h^2\\right) = - f_c h u\n$$\n这个方程代表了地转平衡，其中 $y$ 方向的静水压力梯度力与科里奥利力相平衡。我们将静水压力通量定义为 $F(y) = \\tfrac{1}{2} g h(y)^2$，科里奥利源项定义为 $S(y) = -f_c h(y) u(y)$。因此，连续平衡可以紧凑地写成 $\\partial_y F(y) = S(y)$。对于指定的无量纲单位 $g=1$ 和 $f_c=1$，地转速度为 $u(y) = - g/f_c \\partial_y h(y) = - \\partial_y h(y)$。源项变为 $S(y) = - (1) h(y) (-\\partial_y h(y)) = h(y) \\partial_y h(y)$。这与通量导数是一致的，因为 $\\partial_y F(y) = \\partial_y(\\frac{1}{2}h(y)^2) = h(y) \\partial_y h(y)$。\n\n接下来，我们建立 DG 弱形式。将方程 $\\partial_y F = S$ 乘以一个测试函数 $\\ell_j(y)$（一个 $p$ 次拉格朗日基多项式）并在一个计算单元 $K$ 上积分，得到：\n$$\n\\int_K \\ell_j(y) (\\partial_y F(y)) dy = \\int_K \\ell_j(y) S(y) dy\n$$\n对通量项进行分部积分，得到：\n$$\n\\left[ \\ell_j(y) F(y) \\right]_{\\partial K} - \\int_K (\\partial_y \\ell_j(y)) F(y) dy = \\int_K \\ell_j(y) S(y) dy\n$$\n在 DG 的背景下，单元边界处的单值通量 $F$ 被数值通量 $F^*$ 替代。边界项写为 $\\left. \\ell_j(y) F^*(y) n(y) \\right|_{\\partial K}$，其中 $n(y)$ 是外向单位法向量。单元 $K$ 上第 $i$ 个自由度的离散残差定义为：\n$$\n\\mathcal{R}_j = - \\int_{K} \\partial_y \\ell_j(y)\\, F(y)\\, dy + \\left.\\ell_j(y)\\,F^*(y)\\,n(y)\\right|_{\\partial K} - \\int_K \\ell_j(y)\\, S(y)\\, dy\n$$\n问题要求对一个离散近似计算这个残差，其中解由其在每个单元内 $p+1$ 个勒让德-高斯-洛巴托 (LGL) 节点上的值来表示。设 $F_p(y)$ 是通过这些节点的通量函数 $F(y)$ 的多项式插值。\n\n**第 1 部分：通量-源项配对的合理性证明**\n\n一个适定平衡的格式是指，当精确的连续平衡解作为输入时，离散残差 $\\mathcal{R}_j$ 恒等于零。这可以通过以一种能够精确抵消离散通量导数的方式来定义离散源项来实现。\n\nDG 离散化在 LGL 节点上执行。这些节点集的一个关键性质是相关的微分矩阵 $\\mathbf{D}$ 和对角质量矩阵（求积权重）$\\mathbf{W}$ 满足分部求和 (SBP) 性质：$\\mathbf{D}^T\\mathbf{W} + \\mathbf{W}\\mathbf{D} = \\mathbf{B}$，其中 $\\mathbf{B}=\\text{diag}([-1, 0, \\dots, 0, 1])$。\n\n残差中的体积积分使用基于节点值的 LGL 求积来近似。\n通量积分项（向量形式）是 $\\mathbf{I}_1 = -(\\mathbf{D}^T \\mathbf{W}) \\mathbf{F}$，其中 $\\mathbf{F}$ 是节点处通量值的向量。\n如问题所述，适定平衡的源项使用相同的 LGL 微分算子。在节点框架中，这意味着离散源向量 $\\mathbf{S}_{\\text{node}}$ 被定义为通量向量的离散导数：$\\mathbf{S}_{\\text{node}} = \\mathbf{D} \\mathbf{F}$。相应的源积分项是 $\\mathbf{I}_3 = -\\mathbf{W} \\mathbf{S}_{\\text{node}} = -\\mathbf{W}\\mathbf{D}\\mathbf{F}$。\n\n因此，残差中体积项的和为：\n$$\n\\mathbf{I}_1 + \\mathbf{I}_3 = -(\\mathbf{D}^T\\mathbf{W})\\mathbf{F} - (\\mathbf{W}\\mathbf{D})\\mathbf{F} = -(\\mathbf{D}^T\\mathbf{W} + \\mathbf{W}\\mathbf{D})\\mathbf{F} = -\\mathbf{B}\\mathbf{F}\n$$\n这导致一个向量，其中唯一的非零项对应于单元边界：对于第一个节点 ($j=0$) 是 $-(-1)F_0$，对于最后一个节点 ($j=p$) 是 $-(+1)F_p$。所以，组合的体积项残差是 $(F_0, 0, \\dots, 0, -F_p)^T$，其中 $F_0$ 和 $F_p$ 是单元左、右边界的通量值。\n\n残差中的边界通量项是 $\\mathbf{I}_2$。对于基函数 $\\ell_j$，它仅在端点非零。对于 $j=0$，贡献是 $\\ell_0(y_{\\text{left}}) F^*(y_{\\text{left}}) n_{\\text{left}} = (1) F^*(y_{\\text{left}}) (-1) = -F^*(y_{\\text{left}})$。对于 $j=p$，贡献是 $\\ell_p(y_{\\text{right}}) F^*(y_{\\text{right}}) n_{\\text{right}} = (1) F^*(y_{\\text{right}}) (+1) = F^*(y_{\\text{right}})$。向量 $\\mathbf{I}_2$ 是 $(-F^*(y_{\\text{left}}), 0, \\dots, 0, F^*(y_{\\text{right}}))^T$。\n\n总残差向量是 $\\mathcal{R} = (\\mathbf{I}_1 + \\mathbf{I}_3) + \\mathbf{I}_2$。\n$$\n\\mathcal{R} = \\begin{pmatrix} F_0 \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ -F_p \\end{pmatrix} + \\begin{pmatrix} -F^*(y_{\\text{left}}) \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ F^*(y_{\\text{right}}) \\end{pmatrix} = \\begin{pmatrix} F_0 - F^*(y_{\\text{left}}) \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ -F_p + F^*(y_{\\text{right}}) \\end{pmatrix}\n$$\n问题指出，数值通量 $F^*$ 是在 $h$ 的共享边界值处计算的。这是一个中心通量，意味着在边界上 $F^* = F$。因此，$F_0 - F^*(y_{\\text{left}}) = 0$ 且 $-F_p + F^*(y_{\\text{right}}) = 0$。整个离散残差向量 $\\mathcal{R}$ 都为零。这证明了所提出的通量-源项配对的合理性：它确保了离散地转平衡能够维持到机器精度。\n\n**第 2 部分：求积不匹配与不平衡**\n\n当源体积积分使用替代方法计算时，上述证明的精确抵消关系被破坏。问题指定使用一个 $q$ 点勒让德-高斯 (LG) 求积法则来近似 $\\int_K \\ell_j(y) S(y) dy$，其中 $S(y)$ 是*连续的*源函数 $S(y) = g h(y) \\partial_y h(y)$。\n\n现在的残差计算为 $\\mathcal{R} = \\mathbf{I}_1 + \\mathbf{I}_2 + \\mathbf{I}_{3, \\text{mismatch}}$。通量项 $\\mathbf{I}_1$ 和 $\\mathbf{I}_2$ 不变。新的源项 $\\mathbf{I}_{3, \\text{mismatch}}$ 不再满足与通量梯度项 $\\mathbf{I}_1$ 相抵消所需的代数恒等式。\n\n不平衡的机制在于通量梯度和源项的离散算子之间失去了一致性。虽然连续地转平衡状态满足 $S = \\partial_y F$，但适定平衡的数值格式要求离散表示也满足这一点，即 $\\text{Discrete}(S) = \\text{Discrete}(\\partial_y F)$。通过对源项使用与通量梯度（由基于 LGL 的弱形式隐式定义）不同的数值过程（在解析源函数上使用 LG 求积），这种一致性被违反了。由此产生的残差 $\\mathcal{R}$ 将非零，代表一种伪力，在时间相关的模拟中会使流体偏离稳态。该残差的大小量化了不平衡的程度。\n\n下面的程序实现了在四个测试案例中，针对适定平衡（匹配）和非适定平衡（不匹配）格式计算组装残差向量的欧几里得范数。",
            "answer": "[4.896799185010214e-15,3.903932269202359e-03,6.861179374526726e-04,1.487056232779183e-02]"
        }
    ]
}