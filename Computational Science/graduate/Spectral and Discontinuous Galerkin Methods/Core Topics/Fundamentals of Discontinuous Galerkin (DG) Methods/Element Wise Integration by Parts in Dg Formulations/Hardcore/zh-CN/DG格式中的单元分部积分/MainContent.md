## 引言
间断Galerkin（DG）方法作为一种强大而灵活的数值技术，已在科学与工程计算的众多领域中占据了核心地位。与依赖全局连续函数空间的传统有限元方法（FEM）不同，[DG方法](@entry_id:748369)的精髓在于其允许函数在计算单元的边界上存在间断。这种特性使其在处理包含激波的[对流](@entry_id:141806)主导问题、复杂几何以及[自适应网格](@entry_id:164379)等方面具有无与伦比的优势。然而，这种自由也带来了一个根本性的挑战：如何在这些“破碎”的单元之间建立有效的耦合，以确保格式的稳定性和准确性？答案就蕴藏在DG方法最核心的代数操作中：逐单元分部积分。

本文旨在系统地揭示逐单元[分部积分](@entry_id:136350)这一基本操作如何成为整个DG框架的驱动引擎。我们将深入探讨这一过程不仅是一种数学上的推导技巧，更是一种概念上的[范式](@entry_id:161181)转换，它从根本上定义了[DG方法](@entry_id:748369)的结构、性质和应用潜力。通过本文的学习，读者将理解：

在“原理与机制”一章中，我们将剖析逐单元分部积分的力学过程，阐明它如何必然地引出数值通量的概念，并介绍用于描述界面行为的跳跃和[平均算子](@entry_id:746605)。

在“应用与跨学科联系”一章中，我们将展示这一基本原理如何被应用于构建处理高阶方程、平衡律和复杂几何的高级格式，并探讨其与[Piola变换](@entry_id:163790)、非局域模型等更广泛数学概念的联系。

最后，在“动手实践”部分，通过一系列精心设计的编程练习，您将有机会亲手实现和验证这些理论概念，将抽象的数学转化为具体的计算能力。

让我们从最基本的问题开始：当我们将经典的[分部积分公式](@entry_id:145262)从整个区域“打碎”到每一个独立的计算单元上时，究竟会发生什么？

## 原理与机制

间断 Galerkin (DG) 方法的整个理论和实践框架建立在一个核心操作之上：在计算域的每个单元上逐个应用分部积分。与传统的、依赖于全局[连续函数空间](@entry_id:150395)的有限元方法（FEM）不同，DG 方法允许函数在单元边界上存在间断。这一特性赋予了 DG 方法独特的灵活性和强大的功能，但也引入了新的挑战。本章将系统地阐述逐单元[分部积分](@entry_id:136350)这一基本原理，并揭示它如何引出 DG 方法的关键机制，包括数值通量的产生、对称性与稳定性的构建，以及对守恒性和伴随一致性等理论性质的深刻影响。

### 核心操作：逐单元分部积分

为了处理在单元间可能间断的函数，我们首先需要一个合适的函数空间。这个空间被称为**破碎 Sobolev 空间** (broken Sobolev space)。对于一个被剖分为有限个单元 $K$ 的区域 $\Omega$，破碎 Sobolev 空间 $H^1(\mathcal{T}_h)$ 定义如下 ：
$$
H^1(\mathcal{T}_h) := \left\{ v \in L^2(\Omega) \;\middle|\; v|_K \in H^1(K)\ \text{for all}\ K \in \mathcal{T}_h \right\}
$$
其中 $\mathcal{T}_h$ 是区域 $\Omega$ 的网格剖分。这个定义的核心在于，函数在整个区域上仅需满足平方可积 ($L^2(\Omega)$)，但在**每个单元** $K$ 内部，它必须具有平方可积的弱[一阶导数](@entry_id:749425)（即属于标准的 Sobolev 空间 $H^1(K)$）。这精确地描述了一类在单元内部光滑但在单元间可以“破碎”或“跳跃”的函数。

DG 方法的基石，就是在这样的[破碎函数空间](@entry_id:746988)背景下，将分部积分（或等价地，散度定理）应用于每个单元 $K$ 上。让我们考虑一个泛型的二階偏微分算子，例如拉普拉斯算子。标准的 Green 第一恒等式在一个单元 $K$上叙述为：
$$
\int_K \nabla u \cdot \nabla v \, dx = - \int_K (\Delta u) \, v \, dx + \int_{\partial K} (\nabla u \cdot \boldsymbol{n}_K) v \, ds
$$
其中 $u$ 和 $v$ 是定义在 $K$ 上的函数，$\boldsymbol{n}_K$ 是 $K$ 边界 $\partial K$ 上的单位外法向向量。

DG 方法的威力始于将此恒等式对网格 $\mathcal{T}_h$ 中的**所有**单元求和。假设 $u$ 和 $v$ 属于破碎 Sobolev 空间 $H^1(\mathcal{T}_h)$，并具有足够的逐单元正则性（例如，$u$ 在每个单元内属于 $H^2(K)$），那么对所有单元求和得到**逐单元[分部积分恒等式](@entry_id:197773)** ：
$$
\sum_{K \in \mathcal{T}_h} \int_K \nabla u \cdot \nabla v \, dx = - \sum_{K \in \mathcal{T}_h} \int_K (\Delta u) \, v \, dx + \sum_{K \in \mathcal{T}_h} \int_{\partial K} (\nabla u \cdot \boldsymbol{n}_K) v \, ds
$$
这个公式是 DG 方法推导的出发点。左侧是[体积分](@entry_id:171119)项，右侧是另一个[体积分](@entry_id:171119)项和一系列边界积分之和。正是这个边界积分项 $\sum_{K \in \mathcal{T}_h} \int_{\partial K} \dots$ 包含了 DG 方法的所有关键机制。

### 数值通量的起源

为了理解为何上述边界积分项如此重要，我们需要将其与连续 Galerkin 方法中使用的全局[分部积分](@entry_id:136350)进行对比 。在连续 Galerkin 方法中，[试探函数](@entry_id:756165)和[检验函数](@entry_id:166589)都属于全局连续的 Sobolev 空间（如 $H^1(\Omega)$）。当我们在整个区域 $\Omega$ 上应用 Green 恒等式时，我们得到：
$$
\int_\Omega \nabla u \cdot \nabla v \, dx = - \int_\Omega (\Delta u) \, v \, dx + \int_{\partial \Omega} (\nabla u \cdot \boldsymbol{n}) v \, ds
$$
注意，这里的边界积分**仅仅**在整个区域的外边界 $\partial\Omega$ 上。内部单元的边界在全局积分中没有任何贡献。

然而，在 DG 的逐单元[分部积分恒等式](@entry_id:197773)中，求和 $\sum_{K \in \mathcal{T}_h} \int_{\partial K}$ 遍历了**每一个**单元的边界。这意味着，对于一个位于区域内部、被两个单元 $K^+$ 和 $K^-$ 共享的界面（或称为“面”），它会在此求和中出现两次：一次作为 $K^+$ 的边界，一次作为 $K^-$ 的边界。

如果函数 $v$ 和法向通量 $\nabla u \cdot \boldsymbol{n}$ 在这个内部界面上都是连续的（即它们在界面两侧的值相同），那么由于 $K^+$ 和 $K^-$ 的外法向向量指向相反方向，这两个贡献就会精确地相互抵消，使得内部界面的净贡献为零。这正是连续 Galerkin 方法中隐式发生的情况。

但在 DG 方法中，我们恰恰不要求函数跨单元连续。因此，在内部界面上，$v$ 和 $\nabla u \cdot \boldsymbol{n}$ 的迹（即它们在界面上的值）通常是双值的。例如，从 $K^+$ 逼近界面得到 $v^+$，从 $K^-$ 逼近得到 $v^-$，且 $v^+ \neq v^-$。这导致内部界面上的积分项通常不会抵消，从而在[弱形式](@entry_id:142897)中留下了非零的贡献。

这些遗留下来、在单元界面上定义不清的项，是 DG 方法的核心挑战。因为像 $v$ 和 $\nabla u$ 这样的量在界面上是双值的，表达式 $(\nabla u \cdot \boldsymbol{n}_K) v$ 的值取决于我们从哪一侧来评估它。为了解决这种模糊性并“闭合”方程，我们必须引入一个全新的概念：**[数值通量](@entry_id:752791)**（numerical flux）。数值通量的作用是为界面上的物理通量（如 $\nabla u$ 或[对流](@entry_id:141806)问题中的 $f(u)$）提供一个**单值的、精心设计的近似**，这个近似值同时考虑了来自界面两侧的信息。因此，逐单元分部积分过程直接导致了对[数值通量](@entry_id:752791)的需求，这是 DG 方法与连续方法最根本的区别  。

### 界面积分的力学：法向量、跳跃和平均

要精确地处理界面上的项，我们需要一套系统的记法。考虑一个内部界面 $F$，它是单元 $K^+$ 和 $K^-$ 的公共边界。我们为 $F$ 指定一个固定的[法向量](@entry_id:264185)方向，例如从 $K^+$ 指向 $K^-$，记为 $\boldsymbol{n}$。那么，对于 $K^+$ 而言，其外法向是 $\boldsymbol{n}_{K^+} = \boldsymbol{n}$；对于 $K^-$ 而言，其外法向是 $\boldsymbol{n}_{K^-} = -\boldsymbol{n}$ 。

一个在 DG 空间中的函数（或其导数）$\phi$，在界面 $F$ 上有两个迹：从 $K^+$ 逼近的 $\phi^+$ 和从 $K^-$ 逼近的 $\phi^-$。为了方便地表示这两个值之间的关系，我们定义**跳跃**（jump）和**平均**（average）算子 ：
- **[平均算子](@entry_id:746605)** $\{\!\{ \cdot \}\!\}$：$\{\!\{\phi\}\!\} := \frac{1}{2}(\phi^+ + \phi^-)$
- **跳跃算子** $\llbracket \cdot \rrbracket$：$\llbracket \phi \rrbracket := \phi^+ - \phi^-$

对于向量场 $\boldsymbol{q}$，我们通常关心其法向分量，因此定义：
- **法向跳跃**：$\llbracket \boldsymbol{q} \cdot \boldsymbol{n} \rrbracket := \boldsymbol{q}^+ \cdot \boldsymbol{n} - \boldsymbol{q}^- \cdot \boldsymbol{n}$

这些算子是 DG 方法的通用语言。例如，逐单元分部积分在一个内部界面 $F$ 上产生的两个贡献之和，如 $\int_F (\boldsymbol{a} \cdot \boldsymbol{n}_{K^+}) u^+ v^+ \, ds + \int_F (\boldsymbol{a} \cdot \boldsymbol{n}_{K^-}) u^- v^- \, ds$，可以利用 $\boldsymbol{n}_{K^-} = -\boldsymbol{n}_{K^+}$ 简洁地写成 $\int_F (\boldsymbol{a} \cdot \boldsymbol{n}) (u^+ v^+ - u^- v^-) \, ds$ 。这个表达式又可以通过跳躍和[平均算子](@entry_id:746605)进一步分解，例如，利用恒等式 $a^+b^+ - a^-b^- = \{\!\{a\}\!\} \llbracket b \rrbracket + \{\!\{b\}\!\} \llbracket a \rrbracket$。

### 应用一：构建 DG 格式

逐单元分部积分与[数值通量](@entry_id:752791)的结合，为构建具体的 DG 格式提供了通用蓝图。

#### 双曲问题示例：线性[对流](@entry_id:141806)

考虑一维线性[对流](@entry_id:141806)方程 $u_t + a u_x = 0$ ($a>0$)。在单元 $K$ 上，我们用检验函数 $\phi_i$ 乘以方程并积分，然后对第二项进行[分部积分](@entry_id:136350)：
$$
\int_K \phi_i (a u_x) \, dx = - \int_K (a \phi_i') u \, dx + [a u \phi_i]_{\partial K}
$$
边界项 $[a u \phi_i]_{\partial K}$ 包含在单元出口和入口处的通量。DG 方法将物理通量 $au$ 替换为数值通量 $\widehat{au}$。对于双曲问题，一个自然的选择是**[迎风通量](@entry_id:143931)**（upwind flux），它根据特征速度的方向从“上游”单元取值。例如，如果 $a>0$，在单元右边界（出口），流动信息来自单元内部，故[数值通量](@entry_id:752791)取内部值；在单元左边界（入口），流动信息来自左邻单元，故数值通量取左邻单元的值 。将解 $u$ 用[基函数](@entry_id:170178)展开 $u_h = \sum_j c_j(t) \phi_j(x)$，代入[分部积分](@entry_id:136350)后的[弱形式](@entry_id:142897)，我们就可以计算出质量矩阵 $M_{ij} = \int_K \phi_i \phi_j \, dx$ 和[刚度矩阵](@entry_id:178659) $A_{ij}$，后者由体积积分 $-\int_K (a \phi_i') \phi_j \, dx$ 和边界上的[数值通量](@entry_id:752791)项共同构成。这个过程清晰地展示了如何从[分部积分](@entry_id:136350)出发，通过引入数值通量，最终得到一个可解的代数系统。

#### [椭圆问题](@entry_id:146817)示例：对称内罚法

对于 Poisson 方程 $-\nabla \cdot (\kappa \nabla u) = f$，逐单元[分部积分](@entry_id:136350)后，界面上出现了如 $\kappa \nabla u \cdot \boldsymbol{n}$ 和 $v$ 这样的项。**对称内罚 Galerkin 方法** (Symmetric Interior Penalty Galerkin, SIPG) 是处理这类问题的一种经典 DG 格式 。SIPG 的数值通量设计体现了 DG 格式构建的两个重要思想：**对称性**和**稳定性**。

SIPG 的通量项包含三个部分：
1.  **一致性项**：形如 $-\int_F (\{\!\{\kappa \nabla u \cdot \boldsymbol{n}\!\} \llbracket v \rrbracket) \, ds$。这一项使用梯度的平均值，确保当真解足够光滑时，格式能收敛到真解。
2.  **对称性项**：形如 $-\int_F (\{\!\{\kappa \nabla v \cdot \boldsymbol{n}\!\} \llbracket u \rrbracket) \, ds$。这一项是前一项的对称形式（交换 $u$ 和 $v$），它的引入使得最终的双线性形式是对称的，这对于理论分析和求解效率都至关重要。
3.  **罚项（稳定性项）**：形如 $+\int_F \frac{\eta}{h_F} \llbracket u \rrbracket \llbracket v \rrbracket \, ds$。由于 DG 格式缺少对解的跨单元约束，可能会不稳定。罚项通过惩罚解在界面上的跳跃来施加一种弱形式的连接，从而保证格式的 coercivity（[矫顽性](@entry_id:159399)）和稳定性。其中 $\eta$ 是一个足够大的罚参数。

SIPG 格式完美地展示了如何将[分部积分](@entry_id:136350)产生的“原始”界面项，通过平均、跳跃和罚项，巧妙地塑造成一个具有良好数学性质的、可计算的格式。更广泛地说，许多著名的 DG 格式，如 BR1、BR2、[LDG](@entry_id:751395) 等，都可以被看作是为[分部积分](@entry_id:136350)产生的界面项选择不同的闭合模型（即不同的数值通量）的结果 。

### 高级推论与理论洞察

逐单元[分部积分](@entry_id:136350)不仅是构建格式的工具，它还是进行深入理论分析的钥匙。

#### 伴随一致性

在优化、控制和[目标导向自适应](@entry_id:749945)等领域，算子的伴随问题至关重要。通过对 DG [双线性形式](@entry_id:746794) $B(v, u)$ 中的[检验函数](@entry_id:166589) $v$ 进行“反向”的分部积分，我们可以推导出离散**[伴随算子](@entry_id:140236)**的形式，并识别出其对应的**伴随数值通量** 。一个重要的问题是，原始问题和伴随问题的[数值通量](@entry_id:752791)是否具有相同的形式？这种性质被称为**伴随一致性**。分析表明，对于一个形式为 $\widehat{u} = \alpha u^- + (1-\alpha) u^+$ 的通量，其伴随通量的形式为 $\widehat{v} = (1-\alpha) v^- + \alpha v^+$。只有当 $\alpha = 1/2$ 时，即通量为[中心通量](@entry_id:747204)（平均值）时，原始通量与伴随通量才具有相同的形式，格式才是伴随一致的。这揭示了数值通量的选择如何深刻影响格式的深层结构对称性。

#### 熵稳定性分析

对于复杂的非线性系统，如可压缩 [Navier-Stokes](@entry_id:276387) 方程，证明数值格式的稳定性是一项艰巨的任务。一个强大的工具是熵分析。其思想是证明离散解满足一个半离散的[熵不等式](@entry_id:184404)，即物理熵的总量随时间不增。推导这个不等式的关键步骤，正是将 DG 弱形式与[熵变](@entry_id:138294)量（entropy variables）做[内积](@entry_id:158127)，然后对所有项（包括[对流](@entry_id:141806)项和粘性项）进行细致的逐单元分部积分 。

这个过程会产生两类项：
1.  **耗散项**：来自体积积分和罚项，它们具有确定的符号（通常为负），有助于熵的减少，是“好的”项。
2.  **不定号项**：来自物理通量的一致性项，如 SIPG 中的 $\int_F \{\!\{\kappa \nabla v_h \cdot \boldsymbol{n}\!\} \llbracket v_h \rrbracket \, ds$。这些项的符号不确定，可能导致熵增，是“坏的”项。

[熵稳定性](@entry_id:749023)的关键在于，确保“好的”耗散项能够控制住“坏的”不定号项。通过对不定号的界面项使用 Cauchy-Schwarz 不等式和[迹不等式](@entry_id:756082)，可以将其范数与体积内的梯度范数联系起来。这最终允许我们选择一个足够大的罚参数 $\tau$，使得罚项产生的耗散足以抵消一致性项带来的不确定性，从而保证总的熵变化率为负。整个论证过程完全依赖于逐单元分部积分及其与函数空间范数之间的深刻联系。

#### 精确积分的重要性

DG 方法的[代数结构](@entry_id:137052)和理论性质，如局部守恒性，都建立在[分部积分恒等式](@entry_id:197773)精确成立的基础上。然而，在实际计算中，积分通常由**[数值求积](@entry_id:136578)**（quadrature）近似完成。如果求积规则的精度不足（即所谓的**欠积分**），离散的[分部积分恒等式](@entry_id:197773)就不再成立 。
$$
Q[\phi' g] + Q[\phi g'] \neq [\phi g]_{-1}^{1}
$$
其中 $Q[\cdot]$ 代表一个求积算子。这种不匹配会引入一个“求积误差”，它可能破坏格式的关键性质。一个典型的例子是**局部守恒性**。对于守恒律方程，精确的[分部积分](@entry_id:136350)保证了单元平均值的变化率等于通过边界的净通量。如果使用欠积分的求积规则，这个平衡就会被打破，导致一个非零的“守恒缺陷”。类似地，欠积分也是产生**混淆误差**（aliasing error）的一个来源，它不仅会污染体积积分的计算，还可能污染 DG 方法特有的界[面积分](@entry_id:275394)的计算 。因此，选择足够高精度的求积规则，以确保离散[分部积分恒等式](@entry_id:197773)（或其关键推论）至少对所使用的多项式空间成立，是保证 DG 格式性能的关键实践考量。

总之，逐单元分部积分是贯穿于间断 Galerkin 方法从基本原理到前沿研究的一条主线。它不仅解释了 DG 方法为何需要数值通量，还提供了构建和分析这些通量的力学框架，并最终成为证明稳定性、守恒性等高级理论性质的基石。理解这一核心操作，是掌握 DG 方法精髓的关键。