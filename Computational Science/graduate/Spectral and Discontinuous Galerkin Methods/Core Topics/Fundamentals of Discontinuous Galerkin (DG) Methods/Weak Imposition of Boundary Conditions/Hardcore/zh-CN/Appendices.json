{
    "hands_on_practices": [
        {
            "introduction": "为了对弱边界条件建立坚实的直观理解，我们首先从复杂的间断伽辽金（DG）方法中抽离出来。本练习使用一个简单的图拉普拉斯模型来说明罚方法的核心思想。通过分析罚算子的谱，您将了解弱条件如何逼近强（钳制）条件，并理解罚参数$\\gamma$在这种收敛中所扮演的角色。",
            "id": "3428093",
            "problem": "考虑一个具有$N$个节点的一维路径图，节点标记为$0,1,\\dots,N-1$。令$u\\in\\mathbb{R}^N$表示节点值。图拉普拉斯矩阵$L\\in\\mathbb{R}^{N\\times N}$由经过充分检验的二次能量定义\n$$\n\\mathcal{E}(u)=\\sum_{(i,j)\\in E}(u_i-u_j)^2,\n$$\n其中$E$是路径图的边集，相应的对称半正定矩阵$L$满足$u^\\top L u=\\mathcal{E}(u)$。对于路径图，$L$的对角线元素等于节点度（端点$0$和$N-1$处为1，内部为2），邻接项为$-1$。\n\n在谱方法和不连续伽辽金（DG）方法中，边界条件的弱施加可以通过对边界自由度的罚项来建模。定义带罚项的能量\n$$\n\\mathcal{E}_\\gamma(u)=u^\\top L u + \\gamma\\sum_{i\\in\\partial\\Omega}(u_i-g_i)^2,\n$$\n其中$\\partial\\Omega=\\{0,N-1\\}$表示边界节点，$g\\in\\mathbb{R}^N$指定边界值，$\\gamma\\ge 0$是罚参数。$g \\equiv 0$的情况对应于齐次目标边界值。弱边界条件则引出对称半正定矩阵\n$$\nA_\\gamma=L+\\gamma P,\n$$\n其中$P\\in\\mathbb{R}^{N\\times N}$是对角投影矩阵，在索引$0$和$N-1$处为1，其他位置为0。\n\n强夹持（强狄利克雷施加）相当于将$u$限制在子空间$\\{u\\in\\mathbb{R}^N\\mid u_0=u_{N-1}=0\\}$中，即移除边界自由度。记$A_D\\in\\mathbb{R}^{(N-2)\\times(N-2)}$为通过消除与边界节点对应的行和列从$L$中得到的内部块；对于路径图，这是一个对角线上为$2$，紧邻的次对角线上为$-1$的三对角矩阵。\n\n从特征值的Rayleigh–Ritz变分刻画和上述定义出发，推导与强夹持相比，罚项如何改变谱。特别地，分析当$\\gamma\\to\\infty$时$A_\\gamma$的最小$(N-2)$个特征值的行为，以及它们如何与$A_D$的特征值相关联。然后，实现一个程序，对于给定的$(N,\\gamma)$，计算由弱边界条件相对于强夹持引起的谱移的可量化度量。\n\n你的程序必须：\n- 为具有$N$个节点的路径图构造$L$。\n- 通过从$L$中移除边界行和列来构造$A_D$（等价地，构造一个对角线上为$2$，紧邻的次对角线上为$-1$的$(N-2)\\times(N-2)$三对角矩阵）。\n- 构造$A_\\gamma=L+\\gamma P$，其中$g \\equiv 0$。\n- 计算$A_D$和$A_\\gamma$的特征值，将它们按非递减顺序排序，并比较前$K$个特征值，其中对于每个测试用例，$K=\\min(N-2,k_{\\text{target}})$，$k_{\\text{target}}$为指定的目标值。\n- 为每个测试用例报告前$K$个特征值的最大相对误差，\n$$\n\\max_{1\\le k\\le K}\\frac{\\left|\\lambda_k^{(\\text{weak})}-\\lambda_k^{(\\text{strong})}\\right|}{\\lambda_k^{(\\text{strong})}},\n$$\n其中$\\lambda_k^{(\\text{weak})}$表示$A_\\gamma$的第$k$小的特征值，$\\lambda_k^{(\\text{strong})}$表示$A_D$的第$k$小的特征值。该量是无量纲的，必须作为浮点数输出。\n\n为确保覆盖率，请使用以下测试套件：\n- 大罚项的一般情况：`(21, 100.0, 10)`。\n- 无罚项（自由边界）的边界情况：`(21, 0.0, 10)`。\n- 小系统尺寸：`(4, 10.0, 2)`。\n- 较大系统上的中等罚项：`(50, 1.0, 10)`。\n- 最小内部维度下的近强夹持：`(3, 1000000.0, 1)`。\n\n你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,result3,result4,result5]\"）。每个结果必须是对应测试用例的最大相对误差，表示为浮点数。不应读取任何外部输入；所有参数都应按上文给定进行硬编码。此问题不涉及角度，也没有物理单位。",
            "solution": "本问题涉及一维图拉普拉斯矩阵在两种不同形式的齐次狄利克雷边界条件下的谱分析：强施加和弱施加（基于罚项）。目标是推导所得算子谱之间的关系，并数值化地量化它们的差异。\n\n分析基于对称矩阵特征值的变分刻画，即Courant-Fischer极小极大定理。对于一个$n \\times n$的对称矩阵$M$，其第$k$小的特征值$\\lambda_k(M)$由Rayleigh-Ritz原理给出：\n$$\n\\lambda_k(M) = \\min_{\\substack{S \\subset \\mathbb{R}^n \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top M u}{u^\\top u}\n$$\n\n我们来定义与每种边界条件类型相关的算子。\n强夹持条件，$u_0=u_{N-1}=0$，实际上从系统中移除了边界自由度。相关的向量空间是内部节点值的$(N-2)$维空间，$u_{\\text{int}} = (u_1, \\dots, u_{N-2})^\\top$。系统的能量是这些变量的二次型，由矩阵$A_D \\in \\mathbb{R}^{(N-2)\\times(N-2)}$定义，该矩阵是图拉普拉斯矩阵$L$中对应于内部节点的子矩阵。该系统的特征值，我们记为$\\lambda_k^{(\\text{strong})}$，就是$A_D$的特征值。对于$k=1, \\dots, N-2$：\n$$\n\\lambda_k^{(\\text{strong})} = \\lambda_k(A_D) = \\min_{\\substack{S_{\\text{int}} \\subset \\mathbb{R}^{N-2} \\\\ \\dim(S_{\\text{int}})=k}} \\max_{0 \\neq u_{\\text{int}} \\in S_{\\text{int}}} \\frac{u_{\\text{int}}^\\top A_D u_{\\text{int}}}{u_{\\text{int}}^\\top u_{\\text{int}}}\n$$\n矩阵$A_D$是对称正定的，确保其特征值为实数且严格为正。\n\n弱边界条件通过能量泛函中的罚项来施加，从而得到矩阵$A_\\gamma = L + \\gamma P$，其中$P$是到边界节点$\\{0, N-1\\}$上的对角投影矩阵。该算子作用于完整的$N$维空间$\\mathbb{R}^N$。其特征值，记为$\\lambda_k^{(\\text{weak})}$，由以下公式给出：\n$$\n\\lambda_k^{(\\text{weak})} = \\lambda_k(A_\\gamma) = \\min_{\\substack{S \\subset \\mathbb{R}^N \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top A_\\gamma u}{u^\\top u} = \\min_{\\substack{S \\subset \\mathbb{R}^N \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top L u + \\gamma (u_0^2 + u_{N-1}^2)}{u^\\top u}\n$$\n对于$k=1, \\dots, N$。\n\n为了比较谱，我们将两个变分问题都关联到全空间$\\mathbb{R}^N$。强条件可以看作是将能量泛函$u^\\top L u$限制在子空间$V_0 = \\{u \\in \\mathbb{R}^N \\mid u_0 = u_{N-1} = 0\\}$上。$V_0$的维数是$N-2$。特征值$\\lambda_k^{(\\text{strong})}$正是算子$L$在此子空间上的限制的特征值。\n\n我们可以在特征值之间建立一个不等式。令$S_k^{\\text{(strong)}}$为由$A_D$的前$k$个特征向量张成的$\\mathbb{R}^{N-2}$的$k$维子空间。我们可以将其作为子空间$\\tilde{S}_k \\subset V_0$嵌入到$\\mathbb{R}^N$中。对于任何向量$u \\in \\tilde{S}_k$，其边界值为零，所以$u_0 = u_{N-1} = 0$。因此，对于任何$u \\in \\tilde{S}_k$，$A_\\gamma$的瑞利商中的罚项为零。$\\lambda_k^{(\\text{weak})}$的极小极大原理允许我们使用$\\tilde{S}_k$作为测试子空间：\n$$\n\\lambda_k^{(\\text{weak})} \\le \\max_{0 \\neq u \\in \\tilde{S}_k} \\frac{u^\\top L u + \\gamma (u_0^2 + u_{N-1}^2)}{u^\\top u} = \\max_{0 \\neq u \\in \\tilde{S}_k} \\frac{u^\\top L u}{u^\\top u} = \\lambda_k^{(\\text{strong})}\n$$\n此不等式对$k=1, \\dots, N-2$成立。这表明罚方法引入的约束比强施加更“软”，导致相应模态的特征值更小（或相等）。\n\n当罚参数$\\gamma$趋于无穷大时，瑞利商分子中的$\\gamma (u_0^2 + u_{N-1}^2)$项占主导地位。为了使一个特征值$\\lambda_k^{(\\text{weak})}$在$\\gamma \\to \\infty$时保持有界，其对应的特征向量$v_k$必须具有趋于零的边界分量，即$(v_k)_0 \\to 0$和$(v_k)_{N-1} \\to 0$。这意味着有界模态的特征向量必须收敛到子空间$V_0$内的向量。这就是罚方法的原理：受罚问题的解收敛于约束问题的解。\n\n更形式化地说，特征值的微扰理论表明，对于$k=1, \\dots, N-2$，$A_\\gamma$的特征值$\\lambda_k^{(\\text{weak})}$在$\\gamma \\to \\infty$时收敛于$A_D$的特征值$\\lambda_k^{(\\text{strong})}$。收敛速度通常为$|\\lambda_k^{(\\text{weak})} - \\lambda_k^{(\\text{strong})}| = O(\\gamma^{-1})$。$A_\\gamma$剩下的两个特征值，即$\\lambda_{N-1}^{(\\text{weak})}$和$\\lambda_N^{(\\text{weak})}$，发散到无穷大，对应于局限在边界节点上的特征模态。\n\n量化这种谱移的算法实现如下：\n1. 对于给定的$N$，构造路径图的$N \\times N$图拉普拉斯矩阵$L$。其对角线元素为$L_{0,0}=L_{N-1,N-1}=1$和$L_{i,i}=2$（对于$i=1,\\dots,N-2$）。非零的次对角线元素为$L_{i,i+1} = L_{i+1,i} = -1$。\n2. 构造$(N-2) \\times (N-2)$的强夹持矩阵$A_D$。这对应于$L$的内部块，或者可以直接构造成一个对角线上为$2$，主对角线上下两侧为$-1$的三对角矩阵。\n3. 构造$N \\times N$的弱夹持矩阵$A_\\gamma = L + \\gamma P$，其中$P$是对角矩阵，满足$P_{0,0}=P_{N-1,N-1}=1$且所有其他元素为零。\n4. 计算对称矩阵$A_D$和$A_\\gamma$的特征值。使用稳定的数值特征求解器，例如基于对称矩阵的QR算法。特征值按非递减顺序排序。令这些为$\\{\\lambda_k^{(\\text{strong})}\\}_{k=1}^{N-2}$和$\\{\\lambda_k^{(\\text{weak})}\\}_{k=1}^{N}$。\n5. 确定要比较的特征值数量，$K = \\min(N-2, k_{\\text{target}})$。一个非空的比较要求$K \\ge 1$，这对于所有测试用例都成立。\n6. 谱移的度量是前$K$个特征值的最大相对误差：\n    $$\n    \\max_{1 \\le k \\le K} \\frac{\\left|\\lambda_k^{(\\text{weak})} - \\lambda_k^{(\\text{strong})}\\right|}{\\lambda_k^{(\\text{strong})}}\n    $$\n    由于$A_D$是正定的，$\\lambda_k^{(\\text{strong})} > 0$，所以这个度量是良定义的。\n此过程系统地应用于问题陈述中指定的每个测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spectral shift induced by weak vs. strong boundary conditions\n    for the 1D graph Laplacian.\n    \"\"\"\n    # Test suite of (N, gamma, k_target) parameters.\n    test_cases = [\n        (21, 100.0, 10),\n        (21, 0.0, 10),\n        (4, 10.0, 2),\n        (50, 1.0, 10),\n        (3, 10**6, 1),\n    ]\n\n    results = []\n    for N, gamma, k_target in test_cases:\n        # Step 1: Construct the N x N graph Laplacian L for the path graph.\n        # It has degree-based diagonal and -1 on adjacencies.\n        # Diagonal is [1, 2, ..., 2, 1], off-diagonals are -1.\n        L = np.diag(2 * np.ones(N)) - np.diag(np.ones(N - 1), 1) - np.diag(np.ones(N - 1), -1)\n        L[0, 0] = 1\n        L[N - 1, N - 1] = 1\n\n        # Step 2: Construct the (N-2) x (N-2) strong-clamping matrix A_D.\n        # This is the interior block of L.\n        # A_D is only meaningful for N > 2.\n        dim_D = N - 2\n        A_D = None\n        if dim_D > 0:\n            # Direct construction of the tridiagonal matrix [2, -1].\n            A_D = np.diag(2 * np.ones(dim_D))\n            if dim_D > 1:\n                A_D -= np.diag(np.ones(dim_D - 1), 1)\n                A_D -= np.diag(np.ones(dim_D - 1), -1)\n\n        # Step 3: Construct the N x N weak-clamping matrix A_gamma.\n        # A_gamma = L + gamma * P\n        P = np.zeros((N, N))\n        P[0, 0] = 1\n        P[N - 1, N - 1] = 1\n        A_gamma = L + gamma * P\n\n        # Step 4: Compute the eigenvalues.\n        # np.linalg.eigvalsh is used for symmetric matrices and returns sorted eigenvalues.\n        \n        # Eigenvalues for the weak (penalty) system\n        lambda_weak = np.linalg.eigvalsh(A_gamma)\n\n        # Eigenvalues for the strong (clamped) system\n        lambda_strong = np.array([])\n        if A_D is not None and dim_D > 0:\n            lambda_strong = np.linalg.eigvalsh(A_D)\n\n        # Step 5: Determine the number of eigenvalues to compare.\n        # K cannot exceed the number of eigenvalues available for the strong case.\n        if dim_D == 0:\n            # No interior nodes, so no eigenvalues to compare.\n            # This case does not occur in the provided test suite.\n            results.append(0.0)\n            continue\n            \n        K = min(dim_D, k_target)\n\n        # Select the first K eigenvalues for comparison.\n        # The first dim_D eigenvalues of A_gamma correspond to the dim_D eigenvalues of A_D.\n        lambda_weak_K = lambda_weak[:K]\n        lambda_strong_K = lambda_strong[:K]\n\n        # Step 6: Compute the maximum relative error.\n        # The eigenvalues of A_D are strictly positive, so no division by zero.\n        relative_errors = np.abs(lambda_weak_K - lambda_strong_K) / lambda_strong_K\n        max_relative_error = np.max(relative_errors)\n        \n        results.append(max_relative_error)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "掌握了谱的概念之后，我们现在转向一个实际的编程实现。本练习处理线性平流方程，其中边界数据的弱施加对稳定性至关重要。您将实现迎风数值通量，这需要在每个边界求积点上确定信息流动的方向（即$\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$的符号），以便在内部解和给定的边界数据之间做出正确选择。",
            "id": "3428124",
            "problem": "考虑在二维有界利普希茨域 $\\Omega \\subset \\mathbb{R}^2$ 上的守恒线性平流方程，\n$$\n\\partial_t u + \\nabla \\cdot (\\boldsymbol{\\beta} u) = 0 \\quad \\text{in } \\Omega,\n$$\n其边界 $\\partial \\Omega$ 上的外单位法向量为 $\\boldsymbol{n}$，并具有一个空间变化的平流场 $\\boldsymbol{\\beta}(\\boldsymbol{x})$。在间断 Galerkin (DG) 方法中，弱形式通过分部积分引入边界项，而边界数据则通过数值通量弱施加。该数值通量取决于在边界求积点上计算的 $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$ 的符号。在每个求积点选择的正确边界状态必须反映由 $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$ 引导的特征方向：在流入点，外部迹应等于给定的边界数据；而在流出点，外部迹应等于内部迹。\n\n从守恒平流方程的标准 DG 弱形式和外法向量的定义出发，实现一个逐单元的过程来：\n- 在每个单元的每个边界边的边界求积点上计算 $\\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n}$，以及\n- 根据特征迎风格式，选择用于边界数值通量的边界状态 $u^{\\text{ext}}$。\n\n使用以下科学上一致且自洽的配置，它提供了一个具体的测试套件：\n\n1. 域和网格：\n   - 域为正方形 $\\Omega = [0,1]^2$。\n   - 有两个矩形单元：\n     - 单元 $E_1$ 的顶点为 $(0,0)$、$(0.5,0)$、$(0.5,1)$、$(0,1)$。\n     - 单元 $E_2$ 的顶点为 $(0.5,0)$、$(1,0)$、$(1,1)$、$(0.5,1)$。\n   - 在每个边界边上，外单位法向量 $\\boldsymbol{n}$ 是恒定的：\n     - 左边界 ($x=0$)：$\\boldsymbol{n} = (-1,0)$。\n     - 右边界 ($x=1$)：$\\boldsymbol{n} = (1,0)$。\n     - 底边界 ($y=0$)：$\\boldsymbol{n} = (0,-1)$。\n     - 顶边界 ($y=1$)：$\\boldsymbol{n} = (0,1)$。\n\n2. 速度场和边界数据：\n   - 平流场为 $\\boldsymbol{\\beta}(x,y) = \\big(1 + x^2, \\sin(\\pi y)\\big)$。\n   - 给定的狄利克雷边界数据为 $g(x,y) = \\cos(\\pi x) + y$。\n\n3. 逐单元内部迹：\n   - DG 解的多项式迹（限制在边界上的内部值）按单元给出如下：\n     - 在 $E_1$ 上：$u_h^{E_1}(x,y) = 1 + x + 2y$。\n     - 在 $E_2$ 上：$u_h^{E_2}(x,y) = 2 - x + y$。\n\n4. 边界求积：\n   - 在单元的每个边界边上，对边参数 $s \\in [0,1]$ 使用两点 Gauss–Legendre 求积，这是通过将参考节点 $\\xi_1 = -1/\\sqrt{3}$、$\\xi_2 = 1/\\sqrt{3}$ 映射到 $s_j = (\\xi_j + 1)/2$ 得到的。\n   - 对于位于 $x = \\text{const}$ 的垂直边，求积点为 $(x, y(s_j))$，其中 $y(s) = y_{\\min} + s(y_{\\max} - y_{\\min})$。\n   - 对于位于 $y = \\text{const}$ 的水平边，求积点为 $(x(s_j), y)$，其中 $x(s) = x_{\\min} + s(x_{\\max} - x_{\\min})$。\n\n5. 迎风边界状态选择：\n   - 在单元的每个边界求积点上，计算 $b_n = \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n}$ 并设置\n     $$\n     u^{\\text{ext}}(\\boldsymbol{x}) =\n     \\begin{cases}\n       g(\\boldsymbol{x}),  & \\text{如果 } b_n < 0 \\text{ (流入)}, \\\\\n       u_h^E(\\boldsymbol{x}),  & \\text{如果 } b_n \\ge 0 \\text{ (流出或中性)}.\n     \\end{cases}\n     $$\n   - 此处 $u_h^E$ 表示单元 $E$ 边界上的逐单元内部迹多项式。\n\n6. 要求的输出和顺序：\n   - 按 $E_1$，$E_2$ 的顺序列举单元。\n   - 对每个单元，按以下顺序列举边界边：左、下、右、上；仅包括位于物理边界 $\\partial \\Omega$ 上的那些边。\n   - 在每个包含的边内，按 $s$ 的升序列出两个求积点（即先 $s_1$ 后 $s_2$）。\n   - 对于每个列举的求积点，根据上述迎风法则计算 $u^{\\text{ext}}$ 并收集这些值。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[r1,r2,...,r12]\"），其中每个条目是在边界求积点上 $u^{\\text{ext}}$ 的浮点值，并严格按照指定顺序排列。\n\n测试套件覆盖范围：\n- $E_1$ 的左边（$x=0$）产生流入（$\\boldsymbol{\\beta}\\cdot\\boldsymbol{n} < 0$），必须选择 $g(x,y)$。\n- $E_2$ 的右边（$x=1$）产生流出（$\\boldsymbol{\\beta}\\cdot\\boldsymbol{n} > 0$），必须选择 $u_h^{E_2}(x,y)$。\n- 底边（$y=0$）和顶边（$y=1$）的 $\\boldsymbol{\\beta}\\cdot\\boldsymbol{n} = 0$，必须根据规则 $b_n \\ge 0 \\Rightarrow u^{\\text{ext}} = u_h^E$ 选择内部迹。\n\n不涉及物理单位，也不使用角度。所有输出都是无单位的实数。最终输出必须严格遵守指定的单行格式。",
            "solution": "该问题是有效的，因为它在科学上基于间断 Galerkin (DG) 方法的理论，具有一套完整且一致的数据和规则，是适定的，并且使用客观、正式的语言表述。任务是为给定的线性平流方程的 DG 离散化，在特定的边界求积点上确定外部状态函数 $u^{\\text{ext}}$。这涉及到应用迎风原理，这是稳定 DG 格式的基础。外部状态的选择基于信息流动的方向，该方向由 $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$ 的符号指示，其中 $\\boldsymbol{\\beta}$ 是平流速度，$\\boldsymbol{n}$ 是边界的外单位法向量。\n\n用于计算的给定数据如下：\n-   平流场：$\\boldsymbol{\\beta}(x,y) = \\left(1 + x^2, \\sin(\\pi y)\\right)$。\n-   给定的边界数据：$g(x,y) = \\cos(\\pi x) + y$。\n-   单元 $E_1$ 上的内部解迹：$u_h^{E_1}(x,y) = 1 + x + 2y$。\n-   单元 $E_2$ 上的内部解迹：$u_h^{E_2}(x,y) = 2 - x + y$。\n-   边界 $\\partial\\Omega$ 上一点 $\\boldsymbol{x}$ 的迎风选择规则：\n    $$\n    u^{\\text{ext}}(\\boldsymbol{x}) =\n    \\begin{cases}\n      g(\\boldsymbol{x}),  & \\text{如果 } \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n} < 0 \\text{ (流入)}, \\\\\n      u_h^E(\\boldsymbol{x}),  & \\text{如果 } \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n} \\ge 0 \\text{ (流出或中性)}.\n    \\end{cases}\n    $$\n每个边界边上的求积点是通过变换 $s_j = (\\xi_j + 1)/2$ 将参考区间 $[-1, 1]$ 上的两点 Gauss-Legendre 节点 $\\xi_1 = -1/\\sqrt{3}$ 和 $\\xi_2 = 1/\\sqrt{3}$ 映射到参数空间 $s \\in [0, 1]$ 来确定的。这样每个边上产生两个点，按其参数值 $s$ 排序：\n$s_1 = (1 - 1/\\sqrt{3})/2 \\approx 0.211325$\n$s_2 = (1 + 1/\\sqrt{3})/2 \\approx 0.788675$\n\n计算过程按照指定的顺序遍历单元及其物理边界边。\n\n**单元 $E_1$：域 $[0, 0.5] \\times [0, 1]$**\n$E_1$ 在 $\\partial\\Omega$ 上的边界边是其左边、底边和顶边。\n\n1.  **$E_1$ 的左边 ($x=0, y \\in [0,1]$):**\n    -   外法向量：$\\boldsymbol{n} = (-1, 0)$。\n    -   参数化：$y(s) = s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_1 = (0, s_1)$ 和 $\\boldsymbol{x}_2 = (0, s_2)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+0^2, \\sin(\\pi y)) = (1, \\sin(\\pi y))$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1, \\sin(\\pi y)) \\cdot (-1, 0) = -1$。\n    -   由于 $b_n < 0$，这是一个流入边界。我们选择 $u^{\\text{ext}} = g(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_1 = (0, s_1)$ 处：$u^{\\text{ext}}_1 = g(0, s_1) = \\cos(0) + s_1 = 1 + s_1 = 1.5 - 1/(2\\sqrt{3}) \\approx 1.211325$。\n        -   在 $\\boldsymbol{x}_2 = (0, s_2)$ 处：$u^{\\text{ext}}_2 = g(0, s_2) = \\cos(0) + s_2 = 1 + s_2 = 1.5 + 1/(2\\sqrt{3}) \\approx 1.788675$。\n\n2.  **$E_1$ 的底边 ($y=0, x \\in [0,0.5]$):**\n    -   外法向量：$\\boldsymbol{n} = (0, -1)$。\n    -   参数化：$x(s) = 0.5s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_3 = (0.5s_1, 0)$ 和 $\\boldsymbol{x}_4 = (0.5s_2, 0)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, \\sin(0)) = (1+x^2, 0)$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1+x^2, 0) \\cdot (0, -1) = 0$。\n    -   由于 $b_n \\ge 0$，这是一个中性边界。我们选择 $u^{\\text{ext}} = u_h^{E_1}(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_3 = (0.5s_1, 0)$ 处：$u^{\\text{ext}}_3 = u_h^{E_1}(\\boldsymbol{x}_3) = 1 + (0.5s_1) + 2(0) = 1 + 0.25(1-1/\\sqrt{3}) = 1.25 - 1/(4\\sqrt{3}) \\approx 1.105662$。\n        -   在 $\\boldsymbol{x}_4 = (0.5s_2, 0)$ 处：$u^{\\text{ext}}_4 = u_h^{E_1}(\\boldsymbol{x}_4) = 1 + (0.5s_2) + 2(0) = 1 + 0.25(1+1/\\sqrt{3}) = 1.25 + 1/(4\\sqrt{3}) \\approx 1.394338$。\n\n3.  **$E_1$ 的顶边 ($y=1, x \\in [0,0.5]$):**\n    -   外法向量：$\\boldsymbol{n} = (0, 1)$。\n    -   参数化：$x(s) = 0.5s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_5 = (0.5s_1, 1)$ 和 $\\boldsymbol{x}_6 = (0.5s_2, 1)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, \\sin(\\pi)) = (1+x^2, 0)$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1+x^2, 0) \\cdot (0, 1) = 0$。\n    -   由于 $b_n \\ge 0$，这是一个中性边界。我们选择 $u^{\\text{ext}} = u_h^{E_1}(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_5 = (0.5s_1, 1)$ 处：$u^{\\text{ext}}_5 = u_h^{E_1}(\\boldsymbol{x}_5) = 1 + (0.5s_1) + 2(1) = 3 + 0.25(1-1/\\sqrt{3}) = 3.25 - 1/(4\\sqrt{3}) \\approx 3.105662$。\n        -   在 $\\boldsymbol{x}_6 = (0.5s_2, 1)$ 处：$u^{\\text{ext}}_6 = u_h^{E_1}(\\boldsymbol{x}_6) = 1 + (0.5s_2) + 2(1) = 3 + 0.25(1+1/\\sqrt{3}) = 3.25 + 1/(4\\sqrt{3}) \\approx 3.394338$。\n\n**单元 $E_2$：域 $[0.5, 1] \\times [0, 1]$**\n$E_2$ 在 $\\partial\\Omega$ 上的边界边是其底边、右边和顶边。\n\n1.  **$E_2$ 的底边 ($y=0, x \\in [0.5,1]$):**\n    -   外法向量：$\\boldsymbol{n} = (0, -1)$。\n    -   参数化：$x(s) = 0.5 + 0.5s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_7 = (0.5+0.5s_1, 0)$ 和 $\\boldsymbol{x}_8 = (0.5+0.5s_2, 0)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, 0)$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = 0$。\n    -   由于 $b_n \\ge 0$，我们选择 $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_7 = (0.5+0.5s_1, 0)$ 处：$u^{\\text{ext}}_7 = u_h^{E_2}(\\boldsymbol{x}_7) = 2 - (0.5+0.5s_1) + 0 = 1.5 - 0.25(1-1/\\sqrt{3}) = 1.25 + 1/(4\\sqrt{3}) \\approx 1.394338$。\n        -   在 $\\boldsymbol{x}_8 = (0.5+0.5s_2, 0)$ 处：$u^{\\text{ext}}_8 = u_h^{E_2}(\\boldsymbol{x}_8) = 2 - (0.5+0.5s_2) + 0 = 1.5 - 0.25(1+1/\\sqrt{3}) = 1.25 - 1/(4\\sqrt{3}) \\approx 1.105662$。\n\n2.  **$E_2$ 的右边 ($x=1, y \\in [0,1]$):**\n    -   外法向量：$\\boldsymbol{n} = (1, 0)$。\n    -   参数化：$y(s) = s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_9 = (1, s_1)$ 和 $\\boldsymbol{x}_{10} = (1, s_2)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+1^2, \\sin(\\pi y)) = (2, \\sin(\\pi y))$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (2, \\sin(\\pi y)) \\cdot (1, 0) = 2$。\n    -   由于 $b_n > 0$，这是一个流出边界。我们选择 $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_9 = (1, s_1)$ 处：$u^{\\text{ext}}_9 = u_h^{E_2}(\\boldsymbol{x}_9) = 2 - 1 + s_1 = 1 + s_1 = 1.5 - 1/(2\\sqrt{3}) \\approx 1.211325$。\n        -   在 $\\boldsymbol{x}_{10} = (1, s_2)$ 处：$u^{\\text{ext}}_{10} = u_h^{E_2}(\\boldsymbol{x}_{10}) = 2 - 1 + s_2 = 1 + s_2 = 1.5 + 1/(2\\sqrt{3}) \\approx 1.788675$。\n\n3.  **$E_2$ 的顶边 ($y=1, x \\in [0.5,1]$):**\n    -   外法向量：$\\boldsymbol{n} = (0, 1)$。\n    -   参数化：$x(s) = 0.5 + 0.5s$，对于 $s \\in [0,1]$。\n    -   求积点：$\\boldsymbol{x}_{11} = (0.5+0.5s_1, 1)$ 和 $\\boldsymbol{x}_{12} = (0.5+0.5s_2, 1)$。\n    -   在这些点上，$\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, 0)$。\n    -   特征方向为 $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = 0$。\n    -   由于 $b_n \\ge 0$，我们选择 $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$。\n        -   在 $\\boldsymbol{x}_{11} = (0.5+0.5s_1, 1)$ 处：$u^{\\text{ext}}_{11} = u_h^{E_2}(\\boldsymbol{x}_{11}) = 2 - (0.5+0.5s_1) + 1 = 2.5 - 0.25(1-1/\\sqrt{3}) = 2.25 + 1/(4\\sqrt{3}) \\approx 2.394338$。\n        -   在 $\\boldsymbol{x}_{12} = (0.5+0.5s_2, 1)$ 处：$u^{\\text{ext}}_{12} = u_h^{E_2}(\\boldsymbol{x}_{12}) = 2 - (0.5+0.5s_2) + 1 = 2.5 - 0.25(1+1/\\sqrt{3}) = 2.25 - 1/(4\\sqrt{3}) \\approx 2.105662$。\n\n按要求排序的 $u^{\\text{ext}}$ 计算值的最终序列汇集如下。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the exterior state u^ext at boundary quadrature points\n    for a Discontinuous Galerkin discretization of the linear advection equation.\n    \"\"\"\n\n    # --- Define problem-specific functions ---\n\n    def beta_field(x, y):\n        \"\"\"Advection field beta(x,y) = (1+x^2, sin(pi*y)).\"\"\"\n        return np.array([1 + x**2, np.sin(np.pi * y)])\n\n    def g_data(x, y):\n        \"\"\"Prescribed Dirichlet boundary data g(x,y) = cos(pi*x) + y.\"\"\"\n        return np.cos(np.pi * x) + y\n\n    def u_trace_e1(x, y):\n        \"\"\"Interior trace on element E1: u_h^E1(x,y) = 1 + x + 2y.\"\"\"\n        return 1 + x + 2 * y\n\n    def u_trace_e2(x, y):\n        \"\"\"Interior trace on element E2: u_h^E2(x,y) = 2 - x + y.\"\"\"\n        return 2 - x + y\n\n    # --- Define quadrature and mesh data ---\n\n    # 2-point Gauss-Legendre nodes on reference interval [-1, 1]\n    xi_nodes = np.array([-1/np.sqrt(3), 1/np.sqrt(3)])\n\n    # Map nodes to s in [0, 1]\n    s_points = (xi_nodes + 1) / 2\n\n    # Define elements and their boundary faces on the physical domain boundary\n    # Each face is defined by its type, constant coordinate, variable range,\n    # normal vector, and the element's trace function.\n    problem_setup = [\n        # Element E1\n        {\n            'elem_id': 1, 'u_trace': u_trace_e1,\n            'faces': [\n                {'type': 'left', 'axis': 'x', 'const_coord': 0.0, 'var_range': (0.0, 1.0), 'normal': np.array([-1.0, 0.0])},\n                {'type': 'bottom', 'axis': 'y', 'const_coord': 0.0, 'var_range': (0.0, 0.5), 'normal': np.array([0.0, -1.0])},\n                {'type': 'top', 'axis': 'y', 'const_coord': 1.0, 'var_range': (0.0, 0.5), 'normal': np.array([0.0, 1.0])},\n            ]\n        },\n        # Element E2\n        {\n            'elem_id': 2, 'u_trace': u_trace_e2,\n            'faces': [\n                {'type': 'bottom', 'axis': 'y', 'const_coord': 0.0, 'var_range': (0.5, 1.0), 'normal': np.array([0.0, -1.0])},\n                {'type': 'right', 'axis': 'x', 'const_coord': 1.0, 'var_range': (0.0, 1.0), 'normal': np.array([1.0, 0.0])},\n                {'type': 'top', 'axis': 'y', 'const_coord': 1.0, 'var_range': (0.5, 1.0), 'normal': np.array([0.0, 1.0])},\n            ]\n        }\n    ]\n    \n    # List to store the results in the required order\n    results = []\n\n    # --- Main calculation loop ---\n\n    for element in problem_setup:\n        for face in element['faces']:\n            u_h_E = element['u_trace']\n            var_min, var_max = face['var_range']\n            \n            for s in s_points:\n                # Calculate physical coordinates (x, y) of the quadrature point\n                var_coord = var_min + s * (var_max - var_min)\n                if face['axis'] == 'x':  # Vertical face\n                    x, y = face['const_coord'], var_coord\n                else:  # Horizontal face\n                    x, y = var_coord, face['const_coord']\n\n                # Compute beta . n\n                beta_val = beta_field(x, y)\n                b_n = np.dot(beta_val, face['normal'])\n\n                # Apply upwind rule to select and compute u_ext\n                if b_n  0:\n                    u_ext = g_data(x, y)\n                else:  # b_n >= 0\n                    u_ext = u_h_E(x, y)\n                \n                results.append(u_ext)\n\n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "我们的最后一个练习探讨一个对高阶方法至关重要的高级主题：在弯曲区域上保持精度。本练习将使用Nitsche方法求解泊松方程，我们将研究不充分的数值积分如何破坏方法的伴随一致性。这个练习强调了选择足够强大的求积规则的必要性，以精确地积分包含高阶多项式解（次数为$p$）和复杂边界几何映射（次数为$p_g$）的项。",
            "id": "3428098",
            "problem": "考虑在有界域 $\\Omega \\subset \\mathbb{R}^2$ 上的带有狄利克雷边界条件的标量扩散模型问题，\n$$\n-\\nabla \\cdot (\\kappa \\nabla u) = f \\quad \\text{in } \\Omega, \\qquad u = g \\quad \\text{on } \\partial \\Omega,\n$$\n其扩散系数 $\\kappa$ 为严格为正的常数，且精确解 $u$ 足够光滑。设采用高阶间断伽辽金（DG）方法，通过对称 Nitsche 格式弱形式施加狄利克雷边界条件。记 $V_h^p$ 为每个单元上次数至多为 $p$ 的多项式构成的 DG 空间，并假设弯曲边界边采用多项式次数为 $p_g \\ge 1$ 的等参几何表示。\n\n在弯曲边界边 $F \\subset \\partial \\Omega$ 上，对双线性形式的对称 Nitsche 边界贡献项为\n$$\nb_F(u_h, v_h) = -\\int_F (\\kappa \\nabla u_h \\cdot \\mathbf{n})\\, v_h \\, ds \\;-\\; \\int_F u_h\\, (\\kappa \\nabla v_h \\cdot \\mathbf{n}) \\, ds \\;+\\; \\int_F \\sigma\\, u_h\\, v_h \\, ds,\n$$\n其中 $\\mathbf{n}$ 是单位外法向量，$ds$ 是弧长测度，$\\sigma$ 是罚参数（假设在 $F$ 上为常数），且 $u_h, v_h \\in V_h^p$。从参考边坐标 $\\xi \\in [-1,1]$到物理弯曲边 $F$ 的映射由一个次数为 $p_g$ 的多项式 $\\boldsymbol{x}(\\xi)$ 给出，因此由 $\\boldsymbol{\\nu}(\\xi) = \\partial_\\xi \\boldsymbol{x}(\\xi)^\\perp$ 定义的定向边向量满足几何恒等式 $J_s(\\xi)\\, \\mathbf{n}(\\xi) = \\boldsymbol{\\nu}(\\xi)$，其中 $J_s(\\xi)$ 是弧长雅可比，$(\\cdot)^\\perp$ 表示在 $\\mathbb{R}^2$ 中旋转 $\\pi/2$。假设 $\\boldsymbol{\\nu}$ 是一个次数至多为 $p_g - 1$ 的多项式向量场，而 $J_s$ 是关于 $\\xi$ 的次数至多为 $p_g$ 的多项式。\n\n请仅使用基本定义和经过充分检验的事实作为出发点，回答以下问题：\n\n- 解释为什么 Nitsche 边界项的伴随一致性要求精确计算边界积分，以及积分不足（即，使用一个仅对某个次数 $q$ 精确的边积分法则，而 $q$ 小于被积函数的多项式次数）如何在弯曲边上引入边界混叠项，从而破坏伴随一致性。\n\n- 在所述设定下，推导 $b_F(u_h, v_h)$ 中三个边界被积函数中每一个关于 $\\xi$ 的最大多项式次数，并将其表示为多项式次数 $p$ 和 $p_g$ 的函数。\n\n- 基于该推导，选择一个足够高的高斯型一维边积分精确阶，以避免在弯曲边上所有三个项产生边界混叠，从而保持伴随一致性。\n\n哪个选项正确地指定了足够的边积分精确阶？\n\nA. 在每个边界边上使用对次数至多为 $2p$ 的多项式精确的边积分，无论曲率如何。\n\nB. 在每个边界边上使用对次数至多为 $3p - 1$ 的多项式精确的边积分。\n\nC. 在每个边界边上使用对次数至多为 $p$ 的多项式精确的边积分。\n\nD. 在每个边界边上使用对次数至多为 $2p + p_g$ 的多项式精确的边积分（对于等参几何 $p_g = p$，此次数即为 $3p$）。",
            "solution": "用户需要对问题陈述进行批判性验证，然后是详细的解答和对给定选项的评估。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n-   **模型问题：** 在有界域 $\\Omega \\subset \\mathbb{R}^2$ 内的标量扩散方程 $-\\nabla \\cdot (\\kappa \\nabla u) = f$。\n-   **边界条件：** 在 $\\partial \\Omega$ 上的狄利克雷边界条件 $u = g$。\n-   **扩散系数：** $\\kappa$ 是一个严格为正的常数。\n-   **解的光滑性：** 精确解 $u$ 足够光滑。\n-   **数值方法：** 高阶间断伽辽金（DG）方法。\n-   **逼近空间：** $V_h^p$ 是每个单元上次数至多为 $p$ 的多项式构成的 DG 空间。\n-   **边界条件施加方式：** 通过对称 Nitsche 格式弱形式施加。\n-   **边界几何：** 弯曲边界边 $F \\subset \\partial\\Omega$ 的等参表示，使用一个从参考坐标 $\\xi \\in [-1,1]$ 到物理坐标的次数为 $p_g \\ge 1$ 的多项式映射 $\\boldsymbol{x}(\\xi)$。\n-   **边 F 上的 Nitsche 双线性形式：**\n    $$\n    b_F(u_h, v_h) = -\\int_F (\\kappa \\nabla u_h \\cdot \\mathbf{n})\\, v_h \\, ds \\;-\\; \\int_F u_h\\, (\\kappa \\nabla v_h \\cdot \\mathbf{n}) \\, ds \\;+\\; \\int_F \\sigma\\, u_h\\, v_h \\, ds\n    $$\n-   **几何定义：**\n    -   $\\mathbf{n}$ 是单位外法向量。\n    -   $ds$ 是弧长测度。\n    -   $\\sigma$ 是一个常数罚参数。\n    -   $\\boldsymbol{\\nu}(\\xi) = \\partial_\\xi \\boldsymbol{x}(\\xi)^\\perp$ 是定向边向量。\n    -   $J_s(\\xi)$ 是弧长雅可比。\n    -   几何恒等式：$J_s(\\xi)\\, \\mathbf{n}(\\xi) = \\boldsymbol{\\nu}(\\xi)$。\n-   **几何多项式次数假设：**\n    -   $\\boldsymbol{\\nu}$ 是一个次数至多为 $p_g-1$ 的多项式向量场。\n    -   $J_s$ 是一个次数至多为 $p_g$ 的多项式。\n\n**步骤2：使用提取的已知条件进行验证**\n\n-   **科学基础：** 该问题牢固地植根于偏微分方程数值分析理论，特别是关于间断伽辽金方法。Nitsche 格式是一种标准且成熟的技术。该设定在科学上是合理的。\n-   **适定性和客观性：** 该问题是客观的，并要求基于所提供的设定进行推导。然而，在已知条件中存在一个微妙的矛盾。陈述“$V_h^p$ 是每个单元上次数至多为 $p$ 的多项式构成的 DG 空间”（意味着在物理坐标中 $u_h|_K \\in P_p(K)$）与使用“弯曲边界边的等参几何表示”通常是不兼容的。在标准的等参框架中，物理弯曲单元上的基函数是有理函数，而不是多项式。相反，如果基函数在物理空间中是多项式，它们与弯曲边界映射 $\\boldsymbol{x}(\\xi)$ 的复合将导致关于 $\\xi$ 的次数非常高的函数（例如，$p \\cdot p_g$），这在计算上是有问题的。\n-   **关于模糊性的结论：** 这种模糊性反映了在弯曲域上实现高阶方法时常见的一种两难选择。然而，通过采用该领域使用的标准约定可以解决这个问题，我们假设这是预期的解释：解 $u_h$ 和测试函数 $v_h$ 在参考边界边上的迹被视为参考坐标 $\\xi$ 中次数为 $p$ 的多项式。这种方法虽然简化了完整的二维表示，但却是一种常见的实用选择，并通过确保边界被积函数是多项式而使问题变得可解。在这种解释下，问题是适定的。假设雅可比 $J_s$ 是次数为 $p_g$ 的多项式，虽然通常情况下不完全正确（因为它涉及平方根），但这是一个我们必须为这个问题接受的明确的、简化的假设。\n\n**步骤3：结论与行动**\n\n在解决了多项式解空间和弯曲几何之间的模糊性的标准解释下，该问题被认为是**有效的**。解答将基于此解释进行。\n\n### 解答推导\n\n**基本原理：伴随一致性与精确积分**\n\n连续问题是自伴随的，这意味着相应的精确弱形式具有对称的双线性形式，$b(u,v) = b(v,u)$。为了使数值方法具有鲁棒性和稳定性，非常理想的是离散双线性形式 $b_h(u_h, v_h)$（通过用有限维近似代替连续函数，并用数值积分代替精确积分得到）也保持对称。对于自伴随问题，此属性被称为伴随一致性。\n\n给定的边界边上的 Nitsche 形式 $b_F(u_h, v_h)$ 是通过构造对称的：\n$$\nb_F(u_h, v_h) = \\underbrace{-\\int_F (\\kappa \\nabla u_h \\cdot \\mathbf{n})\\, v_h \\, ds}_{\\text{第1项}} \\underbrace{-\\int_F u_h\\, (\\kappa \\nabla v_h \\cdot \\mathbf{n}) \\, ds}_{\\text{第2项}} \\underbrace{+\\int_F \\sigma\\, u_h\\, v_h \\, ds}_{\\text{第3项}}\n$$\n交换 $u_h$ 和 $v_h$ 会使第1项和第2项互换，而第3项保持不变。因此，$b_F(u_h, v_h) = b_F(v_h, u_h)$。\n\n当使用数值积分时，我们得到一个近似形式 $b_{F,h}(u_h, v_h)$。如果积分法则对被积函数不是精确的，就会引入积分误差。这种误差被称为混叠误差，它会破坏格式中精妙的抵消和性质，可能导致稳定性丧失。“破坏伴随一致性”一词指的是这种混叠误差破坏了离散格式与伴随问题的一致性。为了保持连续形式的性质并避免此类混叠误差，数值积分法则必须对形式中出现的所有多项式被积函数都是精确的。\n\n**被积函数多项式次数的推导**\n\n为了确定所需的积分精确度，我们必须在将 $b_F(u_h, v_h)$ 中的被积函数变换到参考边 $\\xi \\in [-1,1]$ 后，找到它们的最大多项式次数。积分的变换为 $\\int_F (\\cdot) \\, ds = \\int_{-1}^1 (\\cdot) J_s(\\xi) \\, d\\xi$。\n\n使用几何恒等式 $J_s(\\xi) \\mathbf{n}(\\xi) = \\boldsymbol{\\nu}(\\xi)$，我们可以在参考坐标上重写这些项：\n-   第1项：$-\\int_F (\\kappa \\nabla u_h \\cdot \\mathbf{n})\\, v_h \\, ds = -\\int_{-1}^1 \\kappa (\\nabla u_h \\cdot \\frac{\\boldsymbol{\\nu}}{J_s}) v_h J_s \\,d\\xi = -\\int_{-1}^1 \\kappa (\\nabla u_h \\cdot \\boldsymbol{\\nu}) v_h \\,d\\xi$。\n-   第2项：（与第1项对称）。\n-   第3项：$+\\int_F \\sigma\\, u_h\\, v_h \\, ds = +\\int_{-1}^1 \\sigma u_h v_h J_s \\, d\\xi$。\n\n这里，$u_h$，$v_h$ 及其梯度在物理点 $\\boldsymbol{x}(\\xi)$ 处求值。如在验证部分所讨论的，我们采用等参 DG 方法的标准约定：解 $u_h \\in V_h^p$ 在参考边上的迹表示为参考坐标 $\\xi$ 中次数为 $p$ 的多项式。\n-   $u_h(\\boldsymbol{x}(\\xi)) \\in P_p(\\xi)$ 且 $v_h(\\boldsymbol{x}(\\xi)) \\in P_p(\\xi)$。\n\n从问题陈述中，我们有几何因子的次数：\n-   $\\deg(\\boldsymbol{\\nu}(\\xi)) = p_g - 1$。\n-   $\\deg(J_s(\\xi)) = p_g$。\n\n现在我们分析每个被积函数作为 $\\xi$ 的函数的次数：\n\n1.  **罚项 (第 3 项):** 被积函数是 $\\sigma u_h(\\boldsymbol{x}(\\xi)) v_h(\\boldsymbol{x}(\\xi)) J_s(\\xi)$。\n    $$\n    \\deg(\\text{被积函数 3}) = \\deg(u_h) + \\deg(v_h) + \\deg(J_s) = p + p + p_g = 2p + p_g.\n    $$\n\n2.  **对称项 (第 1 和第 2 项):** 第1项的被积函数是 $\\kappa (\\nabla u_h(\\boldsymbol{x}(\\xi)) \\cdot \\boldsymbol{\\nu}(\\xi)) v_h(\\boldsymbol{x}(\\xi))$。关键部分是确定法向导数项的次数。一个一致的框架假设法向通量 $\\nabla u \\cdot \\mathbf{n}$ 的迹与解的迹在同一空间中进行近似，即作为参考坐标 $\\xi$ 中次数为 $p$ 的多项式。\n    -   令 $(\\nabla u_h \\cdot \\mathbf{n})(\\boldsymbol{x}(\\xi)) \\in P_p(\\xi)$。\n    被积函数包含项 $\\nabla u_h \\cdot \\boldsymbol{\\nu}$。使用恒等式 $\\boldsymbol{\\nu} = J_s\\mathbf{n}$，我们有：\n    $$\n    (\\nabla u_h \\cdot \\boldsymbol{\\nu}) = (\\nabla u_h \\cdot \\mathbf{n}) J_s\n    $$\n    此分量的次数为 $\\deg(\\nabla u_h \\cdot \\mathbf{n}) + \\deg(J_s) = p + p_g$。\n    现在我们可以找到第1项的完整被积函数的次数：\n    $$\n    \\deg(\\text{被积函数 1}) = \\deg((\\nabla u_h \\cdot \\mathbf{n}) J_s) + \\deg(v_h) = (p + p_g) + p = 2p + p_g.\n    $$\n\n所有三个项的被积函数都是关于 $\\xi$ 的多项式，其最大次数为 $2p + p_g$。为避免混叠误差并保持离散伴随一致性，边积分法则必须对次数达到此值的多项式是精确的。一个具有 $N_q$ 个点的一维高斯型积分法则对次数为 $2N_q - 1$ 的多项式是精确的。为了对次数 $D = 2p+p_g$ 精确，我们需要 $2N_q - 1 \\ge 2p+p_g$。问题要求的是所需的积分精确阶，即 $D$。\n\n**足够的精确阶：** $2p + p_g$。\n\n### 逐项分析选项\n\n*   **A. 在每个边界边上使用对次数至多为 $2p$ 的多项式精确的边积分，无论曲率如何。**\n    对于直边，我们有 $p_g=1$，但几何映射是仿射的，这意味着 $\\boldsymbol{\\nu}$ 是一个常数向量（次数为0），$J_s$ 是一个常数（次数为0）。在这种特定情况下，被积函数的最大次数将是 $\\deg(u_h v_h J_s) = p+p+0 = 2p$。因此，此选项对于直边是正确的。然而，问题指定了弯曲边（$p_g \\ge 1$），而公式 $2p$ 没有考虑由曲率通过 $J_s(\\xi)$ 引入的额外多项式次数 $p_g$。\n    **结论：不正确。**\n\n*   **B. 在每个边界边上使用对次数至多为 $3p - 1$ 的多项式精确的边积分。**\n    这个次数 $3p-1$ 仅在 $p_g = p-1$ 时才与我们推导出的次数 $2p+p_g$ 相符。这对应于次参数映射。虽然这在实践中是一个有效的选择，但它不具有普遍性。所需的次数取决于 $p$ 和 $p_g$。此选项没有提供一个普遍充分的条件。\n    **结论：不正确。**\n\n*   **C. 在每个边界边上使用对次数至多为 $p$ 的多项式精确的边积分。**\n    这远远不够。即使在直边上，对两个次数为 $p$ 的多项式的乘积（即 $u_h v_h$）进行积分也要求对次数 $2p$ 精确。\n    **结论：不正确。**\n\n*   **D. 在每个边界边上使用对次数至多为 $2p + p_g$ 的多项式精确的边积分（对于等参几何 $p_g = p$，此次数即为 $3p$）。**\n    我们的推导表明，Nitsche 边界形式中被积函数的最大多项式次数是 $2p + p_g$。此选项正确地指出了这个次数。它还正确地指出了等参映射的常见特殊情况，即几何阶数与解的阶数匹配（$p_g=p$），此时所需的次数为 $2p+p = 3p$。\n    **结论：正确。**",
            "answer": "$$\\boxed{D}$$"
        }
    ]
}