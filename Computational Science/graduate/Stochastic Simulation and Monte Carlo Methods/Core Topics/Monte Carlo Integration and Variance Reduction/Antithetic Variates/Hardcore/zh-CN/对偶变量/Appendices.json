{
    "hands_on_practices": [
        {
            "introduction": "对偶变量的核心优势在于其能够减少蒙特卡洛估计的方差。本练习将通过一个理想化的场景，即变量的分布关于原点对称，来从第一性原理出发，探索该技术的工作机制。通过推导方差缩减因子（VRF）并分析其在奇函数和偶函数上的表现，您将深入理解负相关性是如何产生方差缩减的，以及估计函数 $h(x)$ 的性质如何决定了该技术的有效性 。",
            "id": "3288466",
            "problem": "设 $X$ 是一个实值随机变量，其分布关于 $0$ 对称，即其概率密度函数 $f$ 对所有 $x \\in \\mathbb{R}$ 满足 $f(x)=f(-x)$。您的任务是使用固定的计算预算（$M=2n$ 次函数 $h$ 的求值）来估计 $\\mu = \\mathbb{E}[h(X)]$。考虑两种估计量：\n\n1. 标准蒙特卡罗（MC）估计量，它使用 $M$ 个独立同分布的抽样 $Y_{1},\\dots,Y_{M}$，其中 $Y_{j} \\overset{d}{=} X$：\n$$\n\\widehat{\\mu}_{\\mathrm{MC}} \\;=\\; \\frac{1}{M}\\sum_{j=1}^{M} h(Y_{j}) \\, .\n$$\n\n2. 对偶变量（AV）估计量，它通过抽取 $X_{1},\\dots,X_{n}$（其中 $X_{i} \\overset{d}{=} X$）并将其与各自的对偶伙伴 $-X_{i}$ 配对，形成 $n$ 个相关的对：\n$$\n\\widehat{\\mu}_{\\mathrm{AV}} \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} \\frac{h(X_{i}) + h(-X_{i})}{2} \\, .\n$$\n\n从方差和协方差的定义出发，并从第一性原理推导在固定的总预算 $M=2n$ 下，方差缩减因子\n$$\n\\mathrm{VRF} \\;=\\; \\frac{\\mathrm{Var}\\!\\left(\\widehat{\\mu}_{\\mathrm{MC}}\\right)}{\\mathrm{Var}\\!\\left(\\widehat{\\mu}_{\\mathrm{AV}}\\right)}\n$$\n的精确表达式。然后，将您的表达式应用于 $h(x)=x$ 和 $h(x)=x^{2}$ 的情况，并计算相应的 $\\mathrm{VRF}$ 值。最后，利用对称性和奇偶性的性质，定性地解释为什么奇函数和偶函数的结果会有所不同。\n\n将您的最终答案以单行矩阵的形式报告，其中包含按 $h(x)=x$ 和 $h(x)=x^{2}$ 顺序排列的两个 $\\mathrm{VRF}$ 值。不要对结果进行近似。最终数值中不要包含单位。",
            "solution": "题目要求推导对偶变量估计量相对于标准蒙特卡罗估计量的方差缩减因子（VRF），并针对两个特定函数进行求值。该问题提法清晰且科学严谨，基于随机模拟的基本原理。我们开始解答。\n\n首先，我们推导方差缩减因子 $\\mathrm{VRF}$ 的一般表达式。总计算预算固定为 $M=2n$ 次函数 $h$ 的求值。\n\n标准蒙特卡罗（MC）估计量由下式给出：\n$$\n\\widehat{\\mu}_{\\mathrm{MC}} = \\frac{1}{M}\\sum_{j=1}^{M} h(Y_{j})\n$$\n其中 $Y_j$ 是从 $X$ 的分布中抽取的独立同分布（i.i.d.）样本。由于样本 $h(Y_j)$ 是独立同分布的，该估计量的方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MC}}) = \\mathrm{Var}\\left(\\frac{1}{M}\\sum_{j=1}^{M} h(Y_{j})\\right) = \\frac{1}{M^2} \\sum_{j=1}^{M} \\mathrm{Var}(h(Y_j)) = \\frac{M}{M^2} \\mathrm{Var}(h(X)) = \\frac{1}{M} \\mathrm{Var}(h(X))\n$$\n\n对偶变量（AV）估计量由下式给出：\n$$\n\\widehat{\\mu}_{\\mathrm{AV}} = \\frac{1}{n}\\sum_{i=1}^{n} \\frac{h(X_{i}) + h(-X_{i})}{2}\n$$\n让我们定义 $Z_i = \\frac{h(X_i) + h(-X_i)}{2}$。样本 $X_1, \\dots, X_n$ 是独立同分布的，这意味着项 $Z_1, \\dots, Z_n$ 也是独立同分布的。因此，AV 估计量的方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{AV}}) = \\mathrm{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n} Z_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\mathrm{Var}(Z_i) = \\frac{n}{n^2} \\mathrm{Var}(Z_1) = \\frac{1}{n} \\mathrm{Var}(Z_1)\n$$\n现在，我们计算单个项 $Z_1$ 的方差：\n$$\n\\mathrm{Var}(Z_1) = \\mathrm{Var}\\left(\\frac{h(X_1) + h(-X_1)}{2}\\right) = \\frac{1}{4} \\mathrm{Var}(h(X_1) + h(-X_1))\n$$\n使用两个随机变量和的方差公式 $\\mathrm{Var}(A+B) = \\mathrm{Var}(A) + \\mathrm{Var}(B) + 2\\mathrm{Cov}(A,B)$，我们得到：\n$$\n\\mathrm{Var}(Z_1) = \\frac{1}{4} \\left[ \\mathrm{Var}(h(X_1)) + \\mathrm{Var}(h(-X_1)) + 2\\mathrm{Cov}(h(X_1), h(-X_1)) \\right]\n$$\n题目指出 $X$ 的分布关于 $0$ 对称，意味着 $X$ 和 $-X$ 具有相同的分布（$X \\overset{d}{=} -X$）。因此，这些变量的任何函数 $h(X)$ 和 $h(-X)$ 也具有相同的分布。这意味着它们的方差相等：$\\mathrm{Var}(h(X_1)) = \\mathrm{Var}(h(-X_1)) = \\mathrm{Var}(h(X))$。将此代入 $\\mathrm{Var}(Z_1)$ 的表达式中：\n$$\n\\mathrm{Var}(Z_1) = \\frac{1}{4} \\left[ 2\\mathrm{Var}(h(X)) + 2\\mathrm{Cov}(h(X), h(-X)) \\right] = \\frac{1}{2} \\left[ \\mathrm{Var}(h(X)) + \\mathrm{Cov}(h(X), h(-X)) \\right]\n$$\n因此，AV 估计量的方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{AV}}) = \\frac{1}{n} \\mathrm{Var}(Z_1) = \\frac{1}{2n} \\left[ \\mathrm{Var}(h(X)) + \\mathrm{Cov}(h(X), h(-X)) \\right]\n$$\n在固定预算约束 $M=2n$ 下，方差缩减因子是两个方差的比值：\n$$\n\\mathrm{VRF} = \\frac{\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MC}})}{\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{AV}})} = \\frac{\\frac{1}{M}\\mathrm{Var}(h(X))}{\\frac{1}{2n} \\left[ \\mathrm{Var}(h(X)) + \\mathrm{Cov}(h(X), h(-X)) \\right]} = \\frac{\\frac{1}{2n}\\mathrm{Var}(h(X))}{\\frac{1}{2n} \\left[ \\mathrm{Var}(h(X)) + \\mathrm{Cov}(h(X), h(-X)) \\right]}\n$$\n这简化为 VRF 的一般表达式：\n$$\n\\mathrm{VRF} = \\frac{\\mathrm{Var}(h(X))}{\\mathrm{Var}(h(X)) + \\mathrm{Cov}(h(X), h(-X))}\n$$\n这个表达式也可以用相关系数 $\\rho = \\mathrm{Corr}(h(X), h(-X))$ 来表示。由于 $\\mathrm{Var}(h(X))=\\mathrm{Var}(h(-X))$，我们有 $\\rho = \\frac{\\mathrm{Cov}(h(X), h(-X))}{\\mathrm{Var}(h(X))}$，所以 $\\mathrm{Cov}(h(X), h(-X)) = \\rho \\mathrm{Var}(h(X))$。那么 VRF 就是 $\\mathrm{VRF} = \\frac{\\mathrm{Var}(h(X))}{\\mathrm{Var}(h(X)) + \\rho \\mathrm{Var}(h(X))} = \\frac{1}{1+\\rho}$，假设 $\\mathrm{Var}(h(X)) \\neq 0$。\n\n现在，我们将此结果应用于给定的两种情况。\n\n情况 1：$h(x)=x$\n函数 $h(x)=x$ 是一个奇函数。我们需要计算 VRF 表达式中的各项。\n方差为 $\\mathrm{Var}(h(X)) = \\mathrm{Var}(X)$。\n协方差项为 $\\mathrm{Cov}(h(X), h(-X)) = \\mathrm{Cov}(X, -X)$。\n使用属性 $\\mathrm{Cov}(aU, bV) = ab\\mathrm{Cov}(U,V)$，其中 $a=1, b=-1, U=V=X$，我们有：\n$$\n\\mathrm{Cov}(X, -X) = -1 \\cdot \\mathrm{Cov}(X,X) = -\\mathrm{Var}(X)\n$$\n将这些代入通用的 VRF 表达式：\n$$\n\\mathrm{VRF} = \\frac{\\mathrm{Var}(X)}{\\mathrm{Var}(X) + (-\\mathrm{Var}(X))} = \\frac{\\mathrm{Var}(X)}{0}\n$$\n只要 $X$ 不是一个常数（即 $\\mathrm{Var}(X)  0$），这个比值就是无穷大。这表示实现了完美的方差缩减。\n让我们直接分析这种情况下的 AV 估计量：\n$$\n\\widehat{\\mu}_{\\mathrm{AV}} = \\frac{1}{n}\\sum_{i=1}^{n} \\frac{h(X_{i}) + h(-X_{i})}{2} = \\frac{1}{n}\\sum_{i=1}^{n} \\frac{X_i + (-X_i)}{2} = \\frac{1}{n}\\sum_{i=1}^{n} 0 = 0\n$$\n该估计量恒为 $0$，是一个常数。因此，其方差为 $\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{AV}}) = 0$。由于 $X$ 关于 $0$ 对称，真实均值为 $\\mu=\\mathbb{E}[X]=0$。AV 估计量给出了方差为零的精确答案。只要 $\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MC}}) = \\frac{1}{2n}\\mathrm{Var}(X)  0$，方差之比就是无穷大。\n$$\n\\mathrm{VRF}_{h(x)=x} = \\infty\n$$\n\n情况 2：$h(x)=x^2$\n函数 $h(x)=x^2$ 是一个偶函数，意味着 $h(-x)=(-x)^2=x^2=h(x)$。\n方差为 $\\mathrm{Var}(h(X)) = \\mathrm{Var}(X^2)$。\n协方差项为：\n$$\n\\mathrm{Cov}(h(X), h(-X)) = \\mathrm{Cov}(X^2, (-X)^2) = \\mathrm{Cov}(X^2, X^2) = \\mathrm{Var}(X^2)\n$$\n将这些代入 VRF 表达式：\n$$\n\\mathrm{VRF} = \\frac{\\mathrm{Var}(X^2)}{\\mathrm{Var}(X^2) + \\mathrm{Var}(X^2)} = \\frac{\\mathrm{Var}(X^2)}{2\\mathrm{Var}(X^2)}\n$$\n假设 $X^2$ 不是一个常数（除非 $X$ 仅取值 $\\pm c$ 对于某个常数 $c$），我们有 $\\mathrm{Var}(X^2)  0$，表达式简化为：\n$$\n\\mathrm{VRF}_{h(x)=x^2} = \\frac{1}{2}\n$$\n\n最后，我们为这种差异提供一个定性的解释。\n对偶变量的有效性取决于 $h(X)$ 和 $h(-X)$ 之间的协方差。当此协方差为负时，可以实现方差缩减。\n对于函数 $h(x)$ 和一个关于 $0$ 对称分布的随机变量 $X$，$h$ 的性质决定了这个协方差的符号。\n\n- 当 $h(x)$ 是一个奇函数时，$h(-x) = -h(x)$。这意味着 $h(-X) = -h(X)$。$h(X)$ 和 $h(-X)$ 之间的相关性为 $\\mathrm{Corr}(h(X), -h(X)) = -1$。这是一个完全负相关，是方差缩减的理想情况。对偶对的平均值 $\\frac{h(X) + h(-X)}{2} = \\frac{h(X) - h(X)}{2} = 0$ 是一个常数。由于对于对称的 $X$ 和奇函数 $h$，真实均值 $\\mathbb{E}[h(X)]$ 为 $0$，因此该估计量给出了方差为零的精确结果，导致无穷大的 VRF。\n\n- 当 $h(x)$ 是一个偶函数时，$h(-x) = h(x)$。这意味着 $h(-X) = h(X)$。$h(X)$ 和 $h(-X)$ 之间的相关性为 $\\mathrm{Corr}(h(X), h(X)) = +1$。这是一个完全正相关，是方差缩减的最坏情况，因为它最大化了和的方差。对于每一对 $(X_i, -X_i)$，两次函数求值 $h(X_i)$ 和 $h(-X_i)$ 得到相同的值。对偶估计量 $\\widehat{\\mu}_{\\mathrm{AV}} = \\frac{1}{n} \\sum \\frac{h(X_i) + h(X_i)}{2} = \\frac{1}{n} \\sum h(X_i)$ 的行为类似于一个只有 $n$ 个样本的标准 MC 估计量。对于相同的 $2n$ 次函数求值的计算预算，标准 MC 估计量使用 $2n$ 个独立样本。因此，AV 估计量基于一半数量的独立信息，并且由于方差与样本大小成反比，其方差是标准 MC 估计量的两倍。这导致 VRF 为 $1/2$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\infty  \\frac{1}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论上理解了方差缩减之后，一个实际的问题便是：在一次具体的模拟中，我们需要多少样本才能达到期望的精度？本练习将理论与实践联系起来，向您展示如何利用小规模“试点”模拟中得到的方差和协方差估计值，来计算达到目标置信区间宽度所需的对偶样本对数量 $n$。掌握这项技能对于设计高效的蒙特卡洛实验至关重要 。",
            "id": "3288414",
            "problem": "一位从业者正在蒙特卡洛框架内使用对偶变量估计一个模拟输出的均值。设 $U \\sim \\mathrm{Uniform}(0,1)$，并定义 $X = h(U)$ 和 $X' = h(1-U)$，其中 $h(u)$ 是一个具有有限二阶矩的可测函数。具有 $n$ 个独立同分布 (i.i.d.) 对的对偶变量估计量被构造为对平均值的样本均值，即\n$$\nY_i = \\frac{X_i + X'_i}{2}, \\quad \\hat{\\mu}_n = \\frac{1}{n}\\sum_{i=1}^{n} Y_i,\n$$\n其中 $(X_i, X'_i)$ 由 $U_i$ 和 $1-U_i$ 形成，并且各对 $\\{(X_i,X'_i)\\}_{i=1}^n$ 在索引 $i$ 上是独立的。假设通过中心极限定理 (CLT) 满足渐近正态性，并使用标准正态分位数构建均值 $\\mu = \\mathbb{E}[X]$ 的一个双边 $(1-\\alpha)$ 置信区间 (CI)，其半宽为 $\\epsilon$。\n\n一次使用 $n_0$ 个对偶变量对的预备运行产生了单次运行输出的方差和对内协方差的经验估计值：\n$$\n\\hat{\\sigma}^2_X = 0.047, \\quad \\widehat{\\mathrm{Cov}}(X,X') = -0.025.\n$$\n目标是在 $(1-\\alpha) = 0.95$ 的置信水平下，实现目标置信区间半宽 $\\epsilon = 0.01$。将进入中心极限定理的对平均值 $Y_i$ 的方差视为未知，并代入预备运行的估计值来确定所需的对数 $n$，以使半宽至多为 $\\epsilon$。使用标准正态临界值，并选择满足要求的最小整数 $n$。\n\n计算所需的对数 $n$。最终答案必须是一个数字。不涉及单位。",
            "solution": "问题要求确定以指定精度估计均值 $\\mu$ 所需的对偶变量对数 $n$。我们首先分析对偶变量估计量的统计特性。\n\n均值 $\\mu = \\mathbb{E}[X]$ 的估计量由 $\\hat{\\mu}_n = \\frac{1}{n} \\sum_{i=1}^{n} Y_i$ 给出，其中每个 $Y_i$ 是一个对偶对的平均值，即 $Y_i = \\frac{X_i + X'_i}{2}$。随机变量 $X_i$ 和 $X'_i$ 通过 $X_i = h(U_i)$ 和 $X'_i = h(1-U_i)$ 生成，其中 $\\{U_i\\}_{i=1}^n$ 是来自 $\\mathrm{Uniform}(0,1)$ 分布的独立同分布 (i.i.d.) 随机变量。\n\n首先，我们证明 $\\hat{\\mu}_n$ 是 $\\mu$ 的无偏估计量。$Y_i$ 的期望值为：\n$$\n\\mathbb{E}[Y_i] = \\mathbb{E}\\left[\\frac{X_i + X'_i}{2}\\right] = \\frac{1}{2}(\\mathbb{E}[X_i] + \\mathbb{E}[X'_i])\n$$\n由于 $U_i \\sim \\mathrm{Uniform}(0,1)$，随机变量 $1-U_i$ 也服从 $\\mathrm{Uniform}(0,1)$ 分布。这意味着 $X_i = h(U_i)$ 和 $X'_i = h(1-U_i)$ 是同分布的。因此，它们具有相同的期望：\n$$\n\\mathbb{E}[X_i] = \\mathbb{E}[X'_i] = \\mu\n$$\n因此，$Y_i$ 的期望值为：\n$$\n\\mathbb{E}[Y_i] = \\frac{1}{2}(\\mu + \\mu) = \\mu\n$$\n那么，总估计量 $\\hat{\\mu}_n$ 的期望值为：\n$$\n\\mathbb{E}[\\hat{\\mu}_n] = \\mathbb{E}\\left[\\frac{1}{n}\\sum_{i=1}^{n} Y_i\\right] = \\frac{1}{n}\\sum_{i=1}^{n} \\mathbb{E}[Y_i] = \\frac{1}{n}(n\\mu) = \\mu\n$$\n因此，该估计量是无偏的。\n\n接下来，我们确定估计量的方差。由于对 $(X_i, X'_i)$ 在索引 $i$ 上是独立的，所以随机变量 $Y_i$ 是独立同分布的。$\\hat{\\mu}_n$ 的方差为：\n$$\n\\mathrm{Var}(\\hat{\\mu}_n) = \\mathrm{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n} Y_i\\right) = \\frac{1}{n^2}\\sum_{i=1}^{n} \\mathrm{Var}(Y_i) = \\frac{1}{n}\\mathrm{Var}(Y_1)\n$$\n我们记 $\\sigma_Y^2 = \\mathrm{Var}(Y_1)$。单个对平均值 $Y_1$ 的方差为：\n$$\n\\sigma_Y^2 = \\mathrm{Var}\\left(\\frac{X_1 + X'_1}{2}\\right) = \\frac{1}{4}\\mathrm{Var}(X_1 + X'_1)\n$$\n使用相关随机变量和的方差公式：\n$$\n\\mathrm{Var}(X_1 + X'_1) = \\mathrm{Var}(X_1) + \\mathrm{Var}(X'_1) + 2\\mathrm{Cov}(X_1, X'_1)\n$$\n由于 $X_1$ 和 $X'_1$ 是同分布的，它们有相同的方差，即 $\\mathrm{Var}(X_1) = \\mathrm{Var}(X'_1) = \\sigma_X^2$。将此代入 $\\sigma_Y^2$ 的表达式中：\n$$\n\\sigma_Y^2 = \\frac{1}{4}(\\sigma_X^2 + \\sigma_X^2 + 2\\mathrm{Cov}(X_1, X'_1)) = \\frac{1}{2}(\\sigma_X^2 + \\mathrm{Cov}(X_1, X'_1))\n$$\n中心极限定理 (CLT) 指出，对于大的 $n$，$\\hat{\\mu}_n$ 的分布近似为正态分布：\n$$\n\\hat{\\mu}_n \\approx \\mathcal{N}\\left(\\mu, \\frac{\\sigma_Y^2}{n}\\right)\n$$\n$\\mu$ 的一个双边 $(1-\\alpha)$ 置信区间由 $\\hat{\\mu}_n \\pm \\epsilon$ 给出，其中半宽 $\\epsilon$ 为：\n$$\n\\epsilon = z_{1-\\alpha/2} \\frac{\\sigma_Y}{\\sqrt{n}}\n$$\n此处，$z_{1-\\alpha/2}$ 是标准正态分布的 $(1-\\alpha/2)$-分位数。给定目标半宽 $\\epsilon$，需要找到所需的最小对数 $n$。重新整理方程求解 $n$：\n$$\n\\sqrt{n} = \\frac{z_{1-\\alpha/2} \\sigma_Y}{\\epsilon} \\implies n = \\left(\\frac{z_{1-\\alpha/2} \\sigma_Y}{\\epsilon}\\right)^2\n$$\n真实的方差 $\\sigma_Y^2$ 是未知的。问题要求使用预备运行的估计值来确定 $n$。我们将样本估计值代入真实的总体参数：\n$$\n\\hat{\\sigma}_Y^2 = \\frac{1}{2}(\\hat{\\sigma}_X^2 + \\widehat{\\mathrm{Cov}}(X,X'))\n$$\n预备运行给出的值为：\n- 单个输出的估计方差：$\\hat{\\sigma}_X^2 = 0.047$。\n- 对偶对的估计协方差：$\\widehat{\\mathrm{Cov}}(X,X') = -0.025$。\n\n使用这些值，我们计算对平均输出的估计方差：\n$$\n\\hat{\\sigma}_Y^2 = \\frac{1}{2}(0.047 + (-0.025)) = \\frac{1}{2}(0.022) = 0.011\n$$\n要求的置信水平为 $(1-\\alpha) = 0.95$，因此 $\\alpha = 0.05$。临界值为 $z_{1-\\alpha/2} = z_{0.975}$，这是对应于累积概率 $0.975$ 的标准正态分位数。该值为 $z_{0.975} \\approx 1.96$。目标半宽为 $\\epsilon = 0.01$。\n\n现在我们将所有值代入 $n$ 的公式中：\n$$\nn = \\left(\\frac{z_{0.975} \\hat{\\sigma}_Y}{\\epsilon}\\right)^2 = \\left(\\frac{1.96 \\times \\sqrt{0.011}}{0.01}\\right)^2\n$$\n计算该值为：\n$$\nn = \\frac{(1.96)^2 \\times 0.011}{(0.01)^2} = \\frac{3.8416 \\times 0.011}{0.0001} = \\frac{0.0422576}{0.0001} = 422.576\n$$\n由于对数 $n$ 必须是整数，我们必须选择满足条件 $n \\ge 422.576$ 的最小整数。这通过对计算值向上取整来实现：\n$$\nn = \\lceil 422.576 \\rceil = 423\n$$\n因此，需要 $423$ 个对偶变量对才能达到期望的置信区间半宽。",
            "answer": "$$\\boxed{423}$$"
        },
        {
            "introduction": "将算法转化为高效且正确的代码是随机模拟的最后也是关键的一步。现代计算统计严重依赖向量化操作以获得最佳性能。本练习旨在挑战您思考如何设计正确的数据结构（例如张量或数组），以忠实地实现对偶变量配对，同时确保在计算多个估计量时，能够保持关键的配对关系并且避免不同估计量之间的数据“污染” 。",
            "id": "3288419",
            "problem": "考虑估计 $K$ 个形如 $\\mu_k = \\mathbb{E}[g_k(U)]$ 的期望，其中 $k \\in \\{1,\\dots,K\\}$，每个 $g_k:[0,1]^d \\to \\mathbb{R}$ 是一个可测函数，且 $U \\sim \\text{Uniform}([0,1]^d)$。蒙特卡洛方法通过对在 $U$ 的独立样本上计算的 $g_k$ 值求平均来估计每个 $\\mu_k$。对偶变量技术使用成对样本 $\\left(U_i, 1 - U_i\\right)$（其中 $i \\in \\{1,\\dots,m\\}$）以在评估值之间引入负相关，目的是降低平均估计量的方差。您打算以向量化的方式实现对偶配对，以使样本对 $\\left(U_i, 1 - U_i\\right)$ 保持匹配，并且样本协方差的计算严格在样本对内部进行，不与其他样本对或不同的估计量 $k$ 相混合。\n\n实现必须满足以下两个源于经典的蒙特卡洛设置和对偶变量定义的要求：\n\n1. 每个 $\\mu_k$ 的估计量使用每个对偶对内的成对平均值，即对于每个 $i$，\n$$A_{i,k} = \\frac{1}{2}\\left(g_k(U_i) + g_k(1-U_i)\\right),$$\n最终的估计量为\n$$\\hat{\\mu}_k = \\frac{1}{m}\\sum_{i=1}^m A_{i,k}.$$\n\n2. 用于诊断每个 $k$ 的对偶相关的样本协方差必须严格在每个样本对 $i$ 内部计算，仅使用该相同 $i$ 和相同 $k$ 的两个对偶副本，然后对所有样本对进行平均。也就是说，令 $Y_{i,0,k} = g_k(U_i)$ 和 $Y_{i,1,k} = g_k(1-U_i)$，一个有效的估计量 $k$ 的对内样本协方差的形式为\n$$C_k = \\frac{1}{m}\\sum_{i=1}^{m} \\left(Y_{i,0,k} - A_{i,k}\\right)\\left(Y_{i,1,k} - A_{i,k}\\right),$$\n确保不同样本对之间或不同 $k$ 之间没有交叉污染。\n\n您将以向量化的形式实现此计算，通过将数据组织成数组，并沿对应于对偶对维度和对索引维度的轴取平均值，不进行任何破坏 $U_i$ 和 $1-U_i$ 之间的一对一匹配的操作，或聚合不同 $k$ 之间的协方差。\n\n哪个选项正确描述了一种向量化的排列和聚合方案，该方案保证了对偶配对得以保留，并且协方差在对内计算，而不会在估计量之间产生交叉污染？\n\nA. 构建一个三维张量 $X \\in [0,1]^{m \\times 2 \\times d}$，其条目为 $X_{i,0,:} = U_i$ 和 $X_{i,1,:} = 1 - U_i$。对于每个 $k \\in \\{1,\\dots,K\\}$，评估 $Y_{i,j,k} = g_k(X_{i,j,:})$ 以获得一个张量 $Y \\in \\mathbb{R}^{m \\times 2 \\times K}$。通过沿对偶轴 $j$ 求平均来计算成对均值 $A_{i,k} = \\frac{1}{2}\\sum_{j=0}^{1} Y_{i,j,k}$，然后通过沿对索引 $i$ 求平均来计算 $\\hat{\\mu}_k = \\frac{1}{m}\\sum_{i=1}^{m} A_{i,k}$。将每个 $k$ 的对内协方差计算为 $C_k = \\frac{1}{m}\\sum_{i=1}^{m} \\left(Y_{i,0,k} - A_{i,k}\\right)\\left(Y_{i,1,k} - A_{i,k}\\right)$。这种方法使用一个专门的对偶轴，并且从不混合不同的 $i$ 或不同的 $k$。\n\nB. 通过沿单个样本轴堆叠所有 $U_i$ 然后是所有 $1-U_i$ 来形成一个矩阵 $Z \\in [0,1]^{2m \\times d}$。对于每个 $k$，评估 $W_{t,k} = g_k(Z_{t,:})$（其中 $t \\in \\{1,\\dots,2m\\}$）并计算 $\\hat{\\mu}_k = \\frac{1}{2m}\\sum_{t=1}^{2m} W_{t,k}$。通过对所有 $2m$ 个值 $W_{t,k}$ 相对于 $\\hat{\\mu}_k$ 取样本协方差来计算协方差，例如，$C_k = \\frac{1}{2m}\\sum_{t=1}^{2m} \\left(W_{t,k} - \\hat{\\mu}_k\\right)^2$，将所有 $2m$ 个值视为一个单一的池。\n\nC. 生成 $U_1,\\dots,U_m$ 并计算 $1-U_1,\\dots,1-U_m$。对 $U_i$ 排序以产生 $U_{(1)},\\dots,U_{(m)}$，并对 $1-U_i$ 排序以产生 $V_{(1)},\\dots,V_{(m)}$。将 $U_{(i)}$ 与 $V_{(i)}$ 配对（其中 $i \\in \\{1,\\dots,m\\}$）。通过对每个 $k$ 的 $2m$ 个排序后的条目进行平均和协方差计算来计算 $\\hat{\\mu}_k$ 和 $C_k$。\n\nD. 如选项 A 中所述，构建 $X \\in [0,1]^{m \\times 2 \\times d}$ 和 $Y \\in \\mathbb{R}^{m \\times 2 \\times K}$，并如选项 A 中所述计算 $A_{i,k}$ 和 $\\hat{\\mu}_k$，但计算一个单一的汇集协方差 $C_{\\text{pooled}} = \\frac{1}{m K}\\sum_{k=1}^{K}\\sum_{i=1}^{m} \\left(Y_{i,0,k} - \\hat{\\mu}_k\\right)\\left(Y_{i,1,k} - \\hat{\\mu}_k\\right)$，该协方差是对所有 $k$ 进行的，使用全局均值 $\\hat{\\mu}_k$ 而不是成对均值 $A_{i,k}$，然后将 $C_{\\text{pooled}}$ 作为每个 $k$ 的对偶协方差进行报告。",
            "solution": "问题陈述是有效的。它描述了蒙特卡洛估计中用于减少方差的对偶变量法，这是一种随机模拟中的标准技术。问题为估计量和诊断性样本协方差提供了精确的数学定义，以及明确的实现约束（向量化、保留配对、无交叉污染）。问题在于要确定所提供的计算方案中哪一个正确地实现了这个定义明确的算法。该问题具有科学依据，提法明确且客观。\n\n核心挑战是以向量化的方式排列数据，以尊重对偶变量法的内在结构。该结构涉及三个关键索引：\n1. 对索引，$i \\in \\{1, \\dots, m\\}$。\n2. 对偶索引，用于区分一对中的原始样本及其对偶对应项（例如，$j \\in \\{0, 1\\}$ 代表 $U_i$ 和 $1-U_i$）。\n3. 估计量索引，$k \\in \\{1, \\dots, K\\}$，用于不同的函数 $g_k$。\n\n一个正确的向量化实现必须使用一种数据结构，例如多维数组（张量），它具有与这些索引相对应的不同轴。这可以按要求保留配对并防止“交叉污染”。让我们基于这样的结构来形式化所需的计算。\n\n令 $U_i$ 为 $m$ 个从 $\\text{Uniform}([0,1]^d)$ 中抽取的独立样本。对偶对为 $(U_i, 1-U_i)$。\n函数评价值可以组织成一个三维张量 $Y \\in \\mathbb{R}^{m \\times 2 \\times K}$，其中的轴分别对应对索引 $i$、对偶索引 $j$ 和估计量索引 $k$。该张量的条目为：\n$$Y_{i,0,k} = g_k(U_i)$$\n$$Y_{i,1,k} = g_k(1-U_i)$$\n问题定义了两个必需的计算：\n\n1.  **估计量 $\\hat{\\mu}_k$**：这涉及一个两步平均过程。\n    a. 首先，对于每个对 $i$ 和估计量 $k$，计算成对平均值：\n    $$A_{i,k} = \\frac{1}{2}(Y_{i,0,k} + Y_{i,1,k})$$\n    在向量化方案中，这对应于沿对偶轴（轴 $j$）取张量 $Y$ 的均值。此操作将产生一个中间张量 $A \\in \\mathbb{R}^{m \\times K}$。\n    b. 其次，对这些成对均值在所有对上求平均：\n    $$\\hat{\\mu}_k = \\frac{1}{m}\\sum_{i=1}^m A_{i,k}$$\n    这对应于沿对索引轴（轴 $i$）取中间张量 $A$ 的均值。这将产生一个长度为 $K$ 的向量。\n\n2.  **诊断性协方差 $C_k$**：这必须严格在每个对内部且为每个估计量计算。\n    $$C_k = \\frac{1}{m}\\sum_{i=1}^{m} (Y_{i,0,k} - A_{i,k})(Y_{i,1,k} - A_{i,k})$$\n    为了以向量化的方式计算这个值：\n    a. 使用先前计算的成对均值 $A_{i,k}$。注意，对于对应于对 $i$ 的项，我们必须使用来自该特定对的均值 $A_{i,k}$，而不是总均值 $\\hat{\\mu}_k$。\n    b. 对于每个 $i$ 和 $k$，计算偏差的乘积：$(Y_{i,0,k} - A_{i,k})(Y_{i,1,k} - A_{i,k})$。这需要将张量 $A$（形状为 $m \\times K$）广播以匹配 $Y$ 的形状（$m \\times 2 \\times K$）以进行减法，然后在对偶轴上执行乘积。\n    c. 最后，对这些乘积在所有对上求平均：\n    $$C_k = \\frac{1}{m}\\sum_{i=1}^m [\\text{对 } i \\text{ 的乘积}]$$\n    这对应于沿对索引轴（轴 $i$）的平均。这种结构确保了对于给定 $k$ 的计算仅使用与 $g_k$ 相关的数据，并且对于给定对 $i$ 的计算仅使用来自该对的数据。\n\n现在我们根据这个正确的方案来评估每个选项。\n\nA. 构建一个三维张量 $X \\in [0,1]^{m \\times 2 \\times d}$，其条目为 $X_{i,0,:} = U_i$ 和 $X_{i,1,:} = 1 - U_i$。对于每个 $k \\in \\{1,\\dots,K\\}$，评估 $Y_{i,j,k} = g_k(X_{i,j,:})$ 以获得一个张量 $Y \\in \\mathbb{R}^{m \\times 2 \\times K}$。通过沿对偶轴 $j$ 求平均来计算成对均值 $A_{i,k} = \\frac{1}{2}\\sum_{j=0}^{1} Y_{i,j,k}$，然后通过沿对索引 $i$ 求平均来计算 $\\hat{\\mu}_k = \\frac{1}{m}\\sum_{i=1}^{m} A_{i,k}$。将每个 $k$ 的对内协方差计算为 $C_k = \\frac{1}{m}\\sum_{i=1}^{m} \\left(Y_{i,0,k} - A_{i,k}\\right)\\left(Y_{i,1,k} - A_{i,k}\\right)$。这种方法使用一个专门的对偶轴，并且从不混合不同的 $i$ 或不同的 $k$。\n\n该选项完全符合推导出的正确程序。数据被组织成一个 $m \\times 2 \\times K$ 的张量，正确地表示了问题的三层结构。$\\hat{\\mu}_k$ 的计算遵循两步平均过程（首先沿对偶轴，然后沿对索引轴）。$C_k$ 的计算与问题定义的要求完全一致，意味着使用特定于对的均值 $A_{i,k}$ 并为每个 $k$ 进行单独计算。结尾的句子准确地总结了为什么这种方法是正确的。\n结论：**正确**。\n\nB. 通过沿单个样本轴堆叠所有 $U_i$ 然后是所有 $1-U_i$ 来形成一个矩阵 $Z \\in [0,1]^{2m \\times d}$。对于每个 $k$，评估 $W_{t,k} = g_k(Z_{t,:})$（其中 $t \\in \\{1,\\dots,2m\\}$）并计算 $\\hat{\\mu}_k = \\frac{1}{2m}\\sum_{t=1}^{2m} W_{t,k}$。通过对所有 $2m$ 个值 $W_{t,k}$ 相对于 $\\hat{\\mu}_k$ 取样本协方差来计算协方差，例如，$C_k = \\frac{1}{2m}\\sum_{t=1}^{2m} \\left(W_{t,k} - \\hat{\\mu}_k\\right)^2$，将所有 $2m$ 个值视为一个单一的池。\n\n该选项未能保留协方差计算所需的配对结构。虽然 $\\hat{\\mu}_k$ 的计算得出了正确的数值，但该方法（“将所有 $2m$ 个值视为一个单一的池”）违反了依赖于成对平均的对偶估计量的精神。更关键的是，协方差的计算是完全错误的。它计算的是 $2m$ 个汇集结果的*样本方差*，而不是 $g_k(U_i)$ 和 $g_k(1-U_i)$ 之间的对内*样本协方差*。这违反了要求2，因为它没有计算协方差，使用了全局均值 $\\hat{\\mu}_k$ 而不是成对均值 $A_{i,k}$，并且打破了“严格在每个对内部”的约束。\n结论：**不正确**。\n\nC. 生成 $U_1,\\dots,U_m$ 并计算 $1-U_1,\\dots,1-U_m$。对 $U_i$ 排序以产生 $U_{(1)},\\dots,U_{(m)}$，并对 $1-U_i$ 排序以产生 $V_{(1)},\\dots,V_{(m)}$。将 $U_{(i)}$ 与 $V_{(i)}$ 配对（其中 $i \\in \\{1,\\dots,m\\}$）。通过对每个 $k$ 的 $2m$ 个排序后的条目进行平均和协方差计算来计算 $\\hat{\\mu}_k$ 和 $C_k$。\n\n该选项描述了一个根本不同的过程。通过独立地对集合 $\\{U_i\\}$ 和 $\\{1-U_i\\}$ 进行排序，然后根据排名重新配对，它完全破坏了原始的 $(U_i, 1-U_i)$ 对偶配对。所得到的对 $(U_{(i)}, V_{(i)})$ 并不是该方法所要求的意义上的对偶对。因此，任何基于这些新对的后续估计量或协方差计算都没有实现指定的对偶变量技术。这违反了问题陈述的核心前提。\n结论：**不正确**。\n\nD. 如选项 A 中所述，构建 $X \\in [0,1]^{m \\times 2 \\times d}$ 和 $Y \\in \\mathbb{R}^{m \\times 2 \\times K}$，并如选项 A 中所述计算 $A_{i,k}$ 和 $\\hat{\\mu}_k$，但在协方差计算上存在严重缺陷，以两种不同的方式违反了要求2。首先，它在偏差计算中使用了估计量 $k$ 的全局均值 $\\hat{\\mu}_k$，而不是所要求的特定于对的均值 $A_{i,k}$。要求2明确规定了使用 $A_{i,k}$。其次，它将所有估计量 $k=1, \\dots, K$ 的结果汇集在一起计算一个单一的 $C_{\\text{pooled}}$，这违反了协方差必须“不混合不同的估计量 $k$”的约束。问题要求为每个估计量 $k$ 提供一个诊断值 $C_k$，而不是一个单一的汇集值。\n结论：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}