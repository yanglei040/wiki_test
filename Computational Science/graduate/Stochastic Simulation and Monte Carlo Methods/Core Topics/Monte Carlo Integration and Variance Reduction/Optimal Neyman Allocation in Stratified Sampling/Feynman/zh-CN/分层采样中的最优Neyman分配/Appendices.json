{
    "hands_on_practices": [
        {
            "introduction": "要掌握分层抽样的威力，我们首先需要理解其核心优化原理。第一个练习将引导你从最基本的原则出发，推导并应用奈曼分配（Neyman Allocation）公式。通过一个清晰的假设场景，你将学习如何在总样本量固定的情况下，通过巧妙地分配各层样本数，从而最小化总体均值估计的方差，为更复杂的应用奠定坚实的基础 。",
            "id": "3324923",
            "problem": "一个研究团队计划进行一次分层蒙特卡洛调查，以在随机模拟和蒙特卡洛方法的背景下，使用分层抽样来估计总体均值。总体被划分为 $H=4$ 个层，各层的大小 $\\left(N_{h}\\right)=\\left(1000,2000,500,1500\\right)$，相应的层标准差为 $\\left(S_{h}\\right)=\\left(2,5,1,3\\right)$。总抽样预算是固定的抽样数 $n=400$，且各层的每次抽样成本相等。令 $N=\\sum_{h=1}^{H}N_{h}$ 且 $W_{h}=N_{h}/N$ 表示层权重。\n\n从第一性原理出发，考虑在每层中进行独立简单随机抽样的情况下，总体均值的标准无偏分层估计量。在大总体情况下，当有限总体修正常数相对于层大小可忽略不计时，分层均值估计量的方差可以很好地近似为各层贡献之和，并且取决于样本在各层间的分配 $\\left(n_{h}\\right)$。推导在约束条件 $\\sum_{h=1}^{H}n_{h}=n$ 下使该方差最小化的分配 $\\left(n_{h}^{*}\\right)$，然后根据给定数据计算这个最优分配。使用最小化分配，以闭式形式计算得到的最小方差。\n\n您的推导只能使用分层估计的定义、期望的线性性质以及独立层间方差的可加性作为基本依据。假设各层单位抽样成本相等，并忽略有限总体修正。将最终的分配向量 $\\left(n_{1}^{*},n_{2}^{*},n_{3}^{*},n_{4}^{*}\\right)$ 和最小化方差精确地表示为有理数。不要四舍五入。最终答案必须以单行向量的形式给出，包含四个分配项和方差。",
            "solution": "所述问题具有科学依据，提法恰当，客观且内部一致。所有推导唯一、有意义解所需的数据和约束条件均已提供。该问题是分层抽样理论中优化的一个标准应用。因此，该问题是有效的，并将提供解答。\n\n目标是找到在总样本量 $n$ 固定的约束下，使分层均值估计量方差最小的样本分配 $(n_1, n_2, n_3, n_4)$。\n\n首先，让我们定义关键量。总总体被划分为 $H$ 个层。令 $N_h$ 为第 $h$ 层的大小，$N = \\sum_{h=1}^{H} N_h$ 为总总体大小。层权重定义为 $W_h = N_h / N$。总体均值 $\\mu$ 可以表示为层均值 $\\mu_h$ 的加权平均：\n$$\n\\mu = \\sum_{h=1}^{H} \\frac{N_h}{N} \\mu_h = \\sum_{h=1}^{H} W_h \\mu_h\n$$\n总体均值的分层估计量 $\\hat{\\mu}_{st}$ 是通过从每层 $h$ 中抽取大小为 $n_h$ 的简单随机样本并计算样本均值 $\\bar{y}_h$ 来构建的。该估计量为：\n$$\n\\hat{\\mu}_{st} = \\sum_{h=1}^{H} W_h \\bar{y}_h\n$$\n这个估计量是无偏的。利用期望的线性性质以及层内样本均值 $\\bar{y}_h$ 是层均值 $\\mu_h$ 的无偏估计量（即 $E[\\bar{y}_h] = \\mu_h$）这一事实：\n$$\nE[\\hat{\\mu}_{st}] = E\\left[\\sum_{h=1}^{H} W_h \\bar{y}_h\\right] = \\sum_{h=1}^{H} W_h E[\\bar{y}_h] = \\sum_{h=1}^{H} W_h \\mu_h = \\mu\n$$\n分层估计量的方差是基于各层间样本的独立性推导出来的。这使得和的方差等于方差的和：\n$$\nV(\\hat{\\mu}_{st}) = V\\left(\\sum_{h=1}^{H} W_h \\bar{y}_h\\right) = \\sum_{h=1}^{H} V(W_h \\bar{y}_h) = \\sum_{h=1}^{H} W_h^2 V(\\bar{y}_h)\n$$\n从大小为 $N_h$、标准差为 $S_h$ 的层中抽取的样本均值 $\\bar{y}_h$ 的方差由 $V(\\bar{y}_h) = \\frac{S_h^2}{n_h} \\left(1 - \\frac{n_h}{N_h}\\right)$ 给出，其中项 $\\left(1 - \\frac{n_h}{N_h}\\right)$ 是有限总体修正 (FPC)。问题指定忽略 FPC，这等同于假设抽样是带放回的，或者抽样比 $n_h/N_h$ 可以忽略不计。这得出了近似式：\n$$\nV(\\bar{y}_h) \\approx \\frac{S_h^2}{n_h}\n$$\n因此，需要最小化的方差（我们记为 $V$）是：\n$$\nV(n_1, \\dots, n_H) = \\sum_{h=1}^{H} \\frac{W_h^2 S_h^2}{n_h}\n$$\n优化问题是在总样本量 $n$ 固定的约束下最小化此方差：\n$$\n\\text{Minimize} \\quad V = \\sum_{h=1}^{H} \\frac{W_h^2 S_h^2}{n_h} \\quad \\text{subject to} \\quad \\sum_{h=1}^{H} n_h = n\n$$\n我们使用拉格朗日乘数法。拉格朗日函数 $\\mathcal{L}$ 是：\n$$\n\\mathcal{L}(n_1, \\dots, n_H, \\lambda) = \\sum_{h=1}^{H} \\frac{W_h^2 S_h^2}{n_h} + \\lambda \\left(\\sum_{h=1}^{H} n_h - n\\right)\n$$\n为了找到最小值，我们将关于每个 $n_h$ 的偏导数设为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial n_h} = -\\frac{W_h^2 S_h^2}{n_h^2} + \\lambda = 0 \\quad \\implies \\quad n_h^2 = \\frac{W_h^2 S_h^2}{\\lambda}\n$$\n假设 $W_h, S_h, n_h$ 均为正，我们取正平方根：\n$$\nn_h = \\frac{W_h S_h}{\\sqrt{\\lambda}}\n$$\n这表明最优分配 $n_h^*$ 与 $W_h S_h$ 成正比。为了求出 $\\sqrt{\\lambda}$ 的值，我们使用约束条件 $\\sum n_h = n$：\n$$\n\\sum_{h=1}^{H} n_h = \\sum_{h=1}^{H} \\frac{W_h S_h}{\\sqrt{\\lambda}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{h=1}^{H} W_h S_h = n\n$$\n解出 $\\sqrt{\\lambda}$：\n$$\n\\sqrt{\\lambda} = \\frac{\\sum_{j=1}^{H} W_j S_j}{n}\n$$\n将此代回 $n_h$ 的表达式，我们得到最优分配，即奈曼分配 (Neyman allocation)：\n$$\nn_h^* = \\frac{W_h S_h}{\\left( \\frac{\\sum_{j=1}^{H} W_j S_j}{n} \\right)} = n \\frac{W_h S_h}{\\sum_{j=1}^{H} W_j S_j}\n$$\n由于 $W_h = N_h/N$，这等价于 $n_h^* = n \\frac{N_h S_h}{\\sum_{j=1}^{H} N_j S_j}$。\n\n现在，我们将此应用于给定数据：\n$H=4$， $n=400$。\n层大小： $(N_h) = (1000, 2000, 500, 1500)$。\n层标准差： $(S_h) = (2, 5, 1, 3)$。\n\n首先，计算每个层的乘积 $N_h S_h$：\n$N_1 S_1 = 1000 \\times 2 = 2000$。\n$N_2 S_2 = 2000 \\times 5 = 10000$。\n$N_3 S_3 = 500 \\times 1 = 500$。\n$N_4 S_4 = 1500 \\times 3 = 4500$。\n\n和为 $\\sum_{h=1}^{4} N_h S_h = 2000 + 10000 + 500 + 4500 = 17000$。\n\n现在，我们计算最优分配 $n_h^*$：\n$n_1^* = n \\frac{N_1 S_1}{\\sum N_j S_j} = 400 \\times \\frac{2000}{17000} = 400 \\times \\frac{2}{17} = \\frac{800}{17}$。\n$n_2^* = n \\frac{N_2 S_2}{\\sum N_j S_j} = 400 \\times \\frac{10000}{17000} = 400 \\times \\frac{10}{17} = \\frac{4000}{17}$。\n$n_3^* = n \\frac{N_3 S_3}{\\sum N_j S_j} = 400 \\times \\frac{500}{17000} = 400 \\times \\frac{5}{170} = 400 \\times \\frac{1}{34} = \\frac{200}{17}$。\n$n_4^* = n \\frac{N_4 S_4}{\\sum N_j S_j} = 400 \\times \\frac{4500}{17000} = 400 \\times \\frac{45}{170} = 400 \\times \\frac{9}{34} = \\frac{1800}{17}$。\n\n最优分配向量 $(n_h^*)$ 是 $\\left(\\frac{800}{17}, \\frac{4000}{17}, \\frac{200}{17}, \\frac{1800}{17}\\right)$。\n\n接下来，我们通过将 $n_h^*$ 代入方差公式来计算最小化方差 $V_{min}$：\n$$\nV_{min} = \\sum_{h=1}^{H} \\frac{W_h^2 S_h^2}{n_h^*} = \\sum_{h=1}^{H} \\frac{W_h^2 S_h^2}{n \\frac{W_h S_h}{\\sum_{j} W_j S_j}} = \\sum_{h=1}^{H} \\frac{W_h S_h (\\sum_{j} W_j S_j)}{n} = \\frac{(\\sum_{h} W_h S_h)(\\sum_{j} W_j S_j)}{n} = \\frac{1}{n}\\left(\\sum_{h=1}^{H} W_h S_h\\right)^2\n$$\n为了计算这个值，我们首先需要层权重 $W_h$。\n总总体大小 $N = 1000 + 2000 + 500 + 1500 = 5000$。\n$W_1 = 1000/5000 = 1/5$。\n$W_2 = 2000/5000 = 2/5$。\n$W_3 = 500/5000 = 1/10$。\n$W_4 = 1500/5000 = 3/10$。\n\n现在计算和 $\\sum_{h=1}^{4} W_h S_h$：\n$\\sum W_h S_h = \\left(\\frac{1}{5} \\times 2\\right) + \\left(\\frac{2}{5} \\times 5\\right) + \\left(\\frac{1}{10} \\times 1\\right) + \\left(\\frac{3}{10} \\times 3\\right)$\n$= \\frac{2}{5} + 2 + \\frac{1}{10} + \\frac{9}{10} = \\frac{4}{10} + \\frac{20}{10} + \\frac{1}{10} + \\frac{9}{10} = \\frac{34}{10} = \\frac{17}{5}$。\n\n最后，计算最小方差：\n$$\nV_{min} = \\frac{1}{n}\\left(\\sum_{h=1}^{4} W_h S_h\\right)^2 = \\frac{1}{400}\\left(\\frac{17}{5}\\right)^2 = \\frac{1}{400} \\times \\frac{289}{25} = \\frac{289}{10000}\n$$\n最优分配为 $(n_1^*, n_2^*, n_3^*, n_4^*) = \\left(\\frac{800}{17}, \\frac{4000}{17}, \\frac{200}{17}, \\frac{1800}{17}\\right)$ 且得到的最小方差为 $\\frac{289}{10000}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{800}{17}  \\frac{4000}{17}  \\frac{200}{17}  \\frac{1800}{17}  \\frac{289}{10000} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在现实世界的研究中，预算往往是决定抽样设计的关键因素，而不同层级的抽样成本也可能千差万别。这个练习将基础的奈曼分配模型扩展到了一个更贴近实际的场景：在总成本固定的约束下实现最优分配。通过推导考虑成本的分配公式，并分析当某一层的抽样成本变得极其高昂时的极限行为，你将深刻体会到最优分配策略如何兼顾统计效率与经济可行性 。",
            "id": "3324873",
            "problem": "一个有限总体被划分为 $L \\geq 2$ 个层，各层的大小分别为 $N_{1}, \\ldots, N_{L}$，总体大小为 $N = \\sum_{h=1}^{L} N_{h}$。在第 $h$ 层内，目标变量具有有限的正标准差 $S_{h} \\in (0, \\infty)$，$W_{h} = N_{h}/N \\in (0,1)$ 表示层权重。假设我们从每层 $h$ 中抽取一个大小为 $n_{h} \\in (0, \\infty)$ 的独立不放回简单随机样本（SRSWOR），单位抽样成本为 $c_{h} \\in (0, \\infty)$。总成本受固定预算 $C > 0$ 的约束，因此 $\\sum_{h=1}^{L} c_{h} n_{h} = C$。假设 $N_{h}$ 相对于 $n_{h}$ 足够大，以至于在设计优化时可以忽略有限总体校正。\n\n回顾在不放回简单随机抽样和可忽略的有限总体校正下，分层总体均值估计量的方差由下式给出：\n$$\n\\operatorname{Var}(\\hat{\\mu}) \\approx \\sum_{h=1}^{L} \\frac{W_{h}^{2} S_{h}^{2}}{n_{h}}.\n$$\n将 $\\{W_{h}, S_{h}, c_{h}\\}_{h=1}^{L}$ 和 $C$ 视为已知的确定性设计输入。考虑一个约束优化问题，即选择 $\\{n_{h}\\}_{h=1}^{L}$ 以最小化 $\\operatorname{Var}(\\hat{\\mu})$，同时满足成本约束和对所有 $h$ 都有 $n_{h} > 0$。\n\n从上述方差公式和成本约束出发，推导该问题的一阶最优性条件，并求解它们，以获得最优分配 $\\{n_{h}^{*}\\}_{h=1}^{L}$ 关于 $\\{W_{h}, S_{h}, c_{h}\\}_{h=1}^{L}$ 和 $C$ 的闭式表达式。然后，固定所有 $\\{W_{h}, S_{h}\\}_{h=1}^{L}$，对于某个选定的层索引 $k \\in \\{1,\\ldots,L\\}$ 固定 $\\{c_{h}\\}_{h \\neq k}$，并固定预算 $C$。考虑第 $k$ 层的单位成本发散的渐近状态，即 $c_{k} \\to \\infty$，而所有其他问题输入保持不变。确定极限\n$$\n\\lim_{c_{k} \\to \\infty} n_{k}^{*}(c_{k}),\n$$\n并将其作为您的最终答案。您的最终答案必须是单个实数或单个闭式解析表达式。无需四舍五入，也无需报告单位。",
            "solution": "该问题是在分层抽样设计中，找到样本量 $\\{n_h\\}_{h=1}^L$ 的最优分配，以在固定预算下最小化样本均值估计量的方差。随后，我们必须分析当特定层 $k$ 的单位抽样成本 $c_k$ 趋于无穷大时，其最优样本量 $n_k^*$ 的行为。\n\n### 步骤1：提取给定条件\n给定的量和条件如下：\n- 层的数量：$L \\geq 2$。\n- 层的大小：$N_1, \\ldots, N_L$。\n- 总体总大小：$N = \\sum_{h=1}^{L} N_h$。\n- 层的标准差：$S_h \\in (0, \\infty)$，对于 $h=1, \\ldots, L$。\n- 层的权重：$W_h = N_h/N \\in (0,1)$，对于 $h=1, \\ldots, L$。\n- 层的样本量：$n_h \\in (0, \\infty)$，对于 $h=1, \\ldots, L$。\n- 单位抽样成本：$c_h \\in (0, \\infty)$，对于 $h=1, \\ldots, L$。\n- 总预算：$C > 0$。\n- 成本约束：$\\sum_{h=1}^{L} c_h n_h = C$。\n- 分层估计量的方差（待最小化的目标函数）：$\\operatorname{Var}(\\hat{\\mu}) \\approx V(n_1, \\ldots, n_L) = \\sum_{h=1}^{L} \\frac{W_h^2 S_h^2}{n_h}$。\n- 假设有限总体校正可忽略不计。\n- 所有 $W_h, S_h, c_h$ 和 $C$ 都被视为已知的、确定性的正常数。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题在科学上和数学上是合理的。它描述了分层抽样中的经典最优分配问题，通常称为针对可变成本修正的 Neyman 分配，这是抽样调查理论和统计学中的一个标准课题。目标函数和线性成本约束是标准的。该问题是适定的：它是一个凸优化问题（目标函数是凸函数 $1/n_h$ 的和，且约束域是线性的），这保证了存在唯一最小值。符号是标准的，所有术语都定义清晰。该问题是自洽且一致的。未发现任何缺陷。该问题是有效的。\n\n### 步骤3：最优分配的推导\n我们需要在成本约束 $\\sum_{h=1}^{L} c_h n_h = C$ 下最小化方差 $V = \\sum_{h=1}^{L} \\frac{W_h^2 S_h^2}{n_h}$。样本量 $n_h$ 必须为正。我们使用拉格朗日乘数法。拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(n_1, \\ldots, n_L, \\lambda) = \\sum_{h=1}^{L} \\frac{W_h^2 S_h^2}{n_h} + \\lambda \\left( \\left( \\sum_{h=1}^{L} c_h n_h \\right) - C \\right)\n$$\n其中 $\\lambda$ 是拉格朗日乘数。\n\n为求最小值，我们计算 $\\mathcal{L}$ 关于每个 $n_h$ 的偏导数并令其为零。这些是一阶最优性条件。对于每个 $h \\in \\{1, \\ldots, L\\}$：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial n_h} = -\\frac{W_h^2 S_h^2}{n_h^2} + \\lambda c_h = 0\n$$\n由于 $W_h, S_h, c_h$ 均为正，且我们寻求 $n_h > 0$ 的解，我们可以重排这个方程：\n$$\n\\frac{W_h^2 S_h^2}{n_h^2} = \\lambda c_h \\implies n_h^2 = \\frac{W_h^2 S_h^2}{\\lambda c_h}\n$$\n取平方根（我们需要 $n_h > 0$），我们得到：\n$$\nn_h = \\frac{W_h S_h}{\\sqrt{\\lambda} \\sqrt{c_h}}\n$$\n此方程表明，最优样本量 $n_h^*$ 与 $W_h S_h / \\sqrt{c_h}$ 成正比。为了找到比例常数（它依赖于 $\\lambda$），我们将 $n_h$ 的这个表达式代入成本约束方程：\n$$\n\\sum_{j=1}^{L} c_j n_j = C \\implies \\sum_{j=1}^{L} c_j \\left( \\frac{W_j S_j}{\\sqrt{\\lambda} \\sqrt{c_j}} \\right) = C\n$$\n$$\n\\frac{1}{\\sqrt{\\lambda}} \\sum_{j=1}^{L} W_j S_j \\sqrt{c_j} = C\n$$\n解出 $\\sqrt{\\lambda}$：\n$$\n\\sqrt{\\lambda} = \\frac{1}{C} \\sum_{j=1}^{L} W_j S_j \\sqrt{c_j}\n$$\n现在，我们将 $\\sqrt{\\lambda}$ 的这个表达式代回 $n_h$ 的方程中：\n$$\nn_h^* = \\frac{W_h S_h}{\\sqrt{c_h}} \\cdot \\frac{1}{\\sqrt{\\lambda}} = \\frac{W_h S_h}{\\sqrt{c_h}} \\cdot \\frac{C}{\\sum_{j=1}^{L} W_j S_j \\sqrt{c_j}}\n$$\n这给出了每层 $h$ 的最优分配的闭式表达式：\n$$\nn_h^* = C \\frac{W_h S_h / \\sqrt{c_h}}{\\sum_{j=1}^{L} W_j S_j \\sqrt{c_j}}\n$$\n\n### 步骤4：确定 $n_k^*$ 的极限\n题目要求我们求当特定层 $k$ 的成本 $c_k$ 发散（即 $c_k \\to \\infty$）时 $n_k^*$ 的极限，而所有其他成本 $c_j$（$j \\neq k$）以及所有 $W_j, S_j$ 和 $C$ 保持不变。\n\n$n_k^*$ 的表达式为：\n$$\nn_k^*(c_k) = C \\frac{W_k S_k / \\sqrt{c_k}}{\\sum_{j=1}^{L} W_j S_j \\sqrt{c_j}}\n$$\n为了分析极限，我们可以将分母中的求和项分开，以分离出包含 $c_k$ 的项：\n$$\n\\sum_{j=1}^{L} W_j S_j \\sqrt{c_j} = \\left( \\sum_{j \\neq k} W_j S_j \\sqrt{c_j} \\right) + W_k S_k \\sqrt{c_k}\n$$\n让我们定义一个常数 $A = \\sum_{j \\neq k} W_j S_j \\sqrt{c_j}$。由于所有 $W_j, S_j, c_j$（对于 $j \\neq k$）都是固定的正值，所以 $A$ 是一个正常数。同样，令 $B = W_k S_k$，这是另一个正常数。$n_k^*$ 的表达式变为：\n$$\nn_k^*(c_k) = C \\frac{B / \\sqrt{c_k}}{A + B \\sqrt{c_k}}\n$$\n为了简化极限计算，我们可以将其写为：\n$$\nn_k^*(c_k) = \\frac{C B}{ \\sqrt{c_k} (A + B \\sqrt{c_k}) } = \\frac{C B}{A \\sqrt{c_k} + B c_k}\n$$\n我们需要计算当 $c_k \\to \\infty$ 时此表达式的极限：\n$$\n\\lim_{c_k \\to \\infty} n_k^*(c_k) = \\lim_{c_k \\to \\infty} \\frac{C B}{A \\sqrt{c_k} + B c_k}\n$$\n分子是正常数 $CB$。\n分母是两项之和，$A \\sqrt{c_k}$ 和 $B c_k$。当 $c_k \\to \\infty$ 时，两项都趋于无穷大。因此，整个分母趋于无穷大：\n$$\n\\lim_{c_k \\to \\infty} (A \\sqrt{c_k} + B c_k) = \\infty\n$$\n因此，该表达式的极限是一个常数除以无穷大，结果为零。\n$$\n\\lim_{c_k \\to \\infty} n_k^*(c_k) = 0\n$$\n这个结果表明，当某一层的抽样成本变得极其昂贵时，最优分配要求从该层抽取的样本数量应趋于零。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "理论模型通往实际应用的道路上，我们必须学会处理不确定性和现实约束。本练习模拟了一个更为复杂的挑战：我们用于分配计算的层内方差本身只是基于初步研究的估计值，存在一定误差，同时，出于研究的严谨性，每个层级都必须保证一个最小的样本量。你将学习如何构建一个“稳健”的分配方案，该方案旨在最小化最坏情况下的估计方差，从而在面对信息不完全和操作限制时，依然能做出明智和可靠的设计决策 。",
            "id": "3324836",
            "problem": "一个总体均值的蒙特卡洛（MC）估计量是通过对 $H=4$ 个不相交的层进行分层抽样来构建的，已知的层权重 $W_{h}$ 满足 $\\sum_{h=1}^{4} W_{h} = 1$。设 $W_{1}=0.1$，$W_{2}=0.2$，$W_{3}=0.5$ 以及 $W_{4}=0.2$。在第 $h$ 层内，一项预调查提供了层内标准差的估计值 $\\hat{\\sigma}_{h}$，其中 $\\hat{\\sigma}_{1}=3$，$\\hat{\\sigma}_{2}=7$，$\\hat{\\sigma}_{3}=2$ 以及 $\\hat{\\sigma}_{4}=4$。已知预调查的相对误差以 $10\\%$ 为界，因此真实的 $\\sigma_{h}$ 已知位于区间 $[(1-\\delta)\\hat{\\sigma}_{h},(1+\\delta)\\hat{\\sigma}_{h}]$ 内，其中 $\\delta=0.1$。\n\n假设：(i) 各层的单位样本成本相等；(ii) 抽样比可忽略不计，因此可以忽略有限总体校正；(iii) 层内和层间的样本是独立的，层内变异性由 $\\sigma_{h}$ 刻画。给定总样本量预算为 $n=180$ 个样本，并且每个层都有一个硬性下限 $n_{h}^{\\min}=10$。\n\n从这些假设下的分层均值估计量的方差出发，并将预调查不确定性集 $\\sigma_{h}\\in[(1-\\delta)\\hat{\\sigma}_{h},(1+\\delta)\\hat{\\sigma}_{h}]$ 视为对抗性的，建立并求解稳健分配问题，该问题在约束条件 $\\sum_{h=1}^{4} n_{h}=n$ 和 $n_{h}\\geq n_{h}^{\\min}$ 下最小化此不确定性集上的最坏情况方差。使用最大余数法计算得到的整数分配向量 $(n_{1},n_{2},n_{3},n_{4})$，以在保持总预算不变的同时强制取整。\n\n简要讨论这种稳健分配相对于忽略预调查不确定性的名义（非稳健）分配在方差方面的影响，但不要提供任何方差数值。您的最终分配表示为按 $(h=1,2,3,4)$ 顺序排列的四个整数。",
            "solution": "用户提供了一个关于分层抽样中稳健最优分配的问题。第一步是验证问题陈述。\n\n### 步骤1：提取给定条件\n- 层数：$H=4$。\n- 层权重：$W_1=0.1$, $W_2=0.2$, $W_3=0.5$, $W_4=0.2$。总和为 $\\sum_{h=1}^{4} W_{h} = 0.1+0.2+0.5+0.2 = 1.0$。\n- 来自预调查的层内标准差估计值：$\\hat{\\sigma}_{1}=3$，$\\hat{\\sigma}_{2}=7$，$\\hat{\\sigma}_{3}=2$，$\\hat{\\sigma}_{4}=4$。\n- 标准差的不确定性：真实的 $\\sigma_h$ 位于区间 $[(1-\\delta)\\hat{\\sigma}_{h},(1+\\delta)\\hat{\\sigma}_{h}]$ 内，其中 $\\delta=0.1$。\n- 各层的单位样本成本相等。\n- 抽样比可忽略不计。\n- 层内和层间的样本是独立的。\n- 总样本量（预算）：$n=180$。\n- 每层最小样本量：对于所有 $h \\in \\{1, 2, 3, 4\\}$，$n_{h}^{\\min}=10$。\n- 任务：求解稳健分配问题以最小化最坏情况方差。\n- 整数转换方法：最大余数法。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题在科学上植根于分层抽样理论和稳健优化，这是统计学和运筹学中的一个合理研究领域。语言客观，问题适定，所有必要的数据和约束条件均已提供。给定条件在数值上和概念上都是一致的。不存在任何会使问题无效的矛盾、科学缺陷或歧义。诸如成本相等和抽样比可忽略等假设，是该主题入门性处理中的标准简化假设。\n\n### 步骤3：结论和行动\n该问题被视为**有效**。将提供完整解答。\n\n### 解答推导\n\n目标是找到一个整数分配向量 $(n_1, n_2, n_3, n_4)$，以解决一个稳健分配问题。该问题旨在最小化分层均值估计量 $\\hat{\\mu}_{st} = \\sum_{h=1}^{H} W_h \\bar{Y}_h$ 的最坏情况方差。\n\n在抽样比可忽略不计的假设下，该估计量的方差由下式给出：\n$$ V(\\hat{\\mu}_{st}) = \\sum_{h=1}^{H} \\frac{W_h^2 \\sigma_h^2}{n_h} $$\n这是一个极小化极大问题，我们试图在分配 $\\{n_h\\}$ 上最小化该方差，而自然（对手）则从其不确定性集中选择 $\\{\\sigma_h\\}$ 的值以最大化方差。该问题的公式为：\n$$ \\min_{\\{n_h\\}} \\max_{\\{\\sigma_h\\}} \\sum_{h=1}^{H} \\frac{W_h^2 \\sigma_h^2}{n_h} $$\n受以下约束：\n1. $\\sum_{h=1}^{4} n_h = n = 180$\n2. $n_h \\ge n_h^{\\min} = 10$ for $h=1,2,3,4$\n3. $\\sigma_h \\in [(1-\\delta)\\hat{\\sigma}_{h}, (1+\\delta)\\hat{\\sigma}_{h}]$ for $h=1,2,3,4$, where $\\delta=0.1$.\n\n首先，我们针对固定的分配 $\\{n_h\\}$ 求解内部的最大化问题。为了最大化方差，我们必须从每个 $\\sigma_h$ 的不确定性集中选择能使总和最大的值。由于所有项 $\\frac{W_h^2 \\sigma_h^2}{n_h}$ 都是非负的，我们可以通过单独最大化每一项来最大化总和。当 $\\sigma_h^2$ 最大化时，第 $h$ 层的项达到最大值，这发生在 $\\sigma_h$ 取其最大可能值时。\n第 $h$ 层的最坏情况标准差是 $\\sigma_h^{WC} = (1+\\delta)\\hat{\\sigma}_h$。\n\n因此，最坏情况方差为：\n$$ V_{WC}(\\{n_h\\}) = \\sum_{h=1}^{H} \\frac{W_h^2 ((1+\\delta)\\hat{\\sigma}_h)^2}{n_h} = (1+\\delta)^2 \\sum_{h=1}^{H} \\frac{W_h^2 \\hat{\\sigma}_h^2}{n_h} $$\n现在，我们求解外部的最小化问题。我们需要找到在预算和最小样本量约束下，使 $V_{WC}(\\{n_h\\})$ 最小化的分配 $\\{n_h\\}$。\n$$ \\min_{\\{n_h\\}} (1+\\delta)^2 \\sum_{h=1}^{H} \\frac{W_h^2 \\hat{\\sigma}_h^2}{n_h} $$\n正常数因子 $(1+\\delta)^2$ 不影响最优分配 $\\{n_h\\}$。因此，该问题等价于最小化 $\\sum_{h=1}^{H} \\frac{(W_h \\hat{\\sigma}_h)^2}{n_h}$。这是最优分配问题（奈曼分配）的标准形式，其中分配 $n_h$ 与 $W_h \\hat{\\sigma}_h$ 成正比。\n\n首先，我们计算乘积 $W_h \\hat{\\sigma}_h$：\n- $W_1 \\hat{\\sigma}_1 = 0.1 \\times 3 = 0.3$\n- $W_2 \\hat{\\sigma}_2 = 0.2 \\times 7 = 1.4$\n- $W_3 \\hat{\\sigma}_3 = 0.5 \\times 2 = 1.0$\n- $W_4 \\hat{\\sigma}_4 = 0.2 \\times 4 = 0.8$\n\n这些乘积的总和是 $\\sum_{k=1}^{4} W_k \\hat{\\sigma}_k = 0.3 + 1.4 + 1.0 + 0.8 = 3.5$。\n\n理想的（无约束、非整数）分配 $n_h^*$ 由下式给出：\n$$ n_h^* = n \\frac{W_h \\hat{\\sigma}_h}{\\sum_{k=1}^{4} W_k \\hat{\\sigma}_k} $$\n代入数值：\n- $n_1^* = 180 \\times \\frac{0.3}{3.5} = \\frac{54}{3.5} = \\frac{108}{7} \\approx 15.4286$\n- $n_2^* = 180 \\times \\frac{1.4}{3.5} = 180 \\times \\frac{2}{5} = 72$\n- $n_3^* = 180 \\times \\frac{1.0}{3.5} = \\frac{180}{3.5} = \\frac{360}{7} \\approx 51.4286$\n- $n_4^* = 180 \\times \\frac{0.8}{3.5} = \\frac{144}{3.5} = \\frac{288}{7} \\approx 41.1429$\n\n接下来，我们检查这些分配是否满足最小样本量约束 $n_h \\ge 10$。\n- $n_1^* \\approx 15.43 > 10$\n- $n_2^* = 72 > 10$\n- $n_3^* \\approx 51.43 > 10$\n- $n_4^* \\approx 41.14 > 10$\n所有约束都得到满足，因此不需要重新分配。理想的比例得以保持。\n\n最后，我们必须使用最大余数法将这个实值分配转换为总样本数为 180 的整数分配 $(n_1, n_2, n_3, n_4)$。\n分配的整数部分是：\n- $\\lfloor n_1^* \\rfloor = 15$\n- $\\lfloor n_2^* \\rfloor = 72$\n- $\\lfloor n_3^* \\rfloor = 51$\n- $\\lfloor n_4^* \\rfloor = 41$\n\n这些整数部分的总和是 $15 + 72 + 51 + 41 = 179$。我们有 $180 - 179 = 1$ 个剩余样本需要分配。\n小数余数是：\n- $n_1$ 的余数：$n_1^* - \\lfloor n_1^* \\rfloor = \\frac{108}{7} - 15 = \\frac{108-105}{7} = \\frac{3}{7} \\approx 0.4286$\n- $n_2$ 的余数：$n_2^* - \\lfloor n_2^* \\rfloor = 72 - 72 = 0$\n- $n_3$ 的余数：$n_3^* - \\lfloor n_3^* \\rfloor = \\frac{360}{7} - 51 = \\frac{360-357}{7} = \\frac{3}{7} \\approx 0.4286$\n- $n_4$ 的余数：$n_4^* - \\lfloor n_4^* \\rfloor = \\frac{288}{7} - 41 = \\frac{288-287}{7} = \\frac{1}{7} \\approx 0.1429$\n\n在第 1 层和第 3 层之间，最大余数出现了平局。问题没有指定打破平局的规则。一种符合科学原则的打破平局方法是将额外的样本分配给能产生最大方差减少量的层。通过向 $n_h$ 的分配中增加一个样本，目标函数 $\\sum \\frac{(W_h\\hat{\\sigma}_h)^2}{n_h}$ 的边际减少量为 $\\frac{(W_h\\hat{\\sigma}_h)^2}{n_h} - \\frac{(W_h\\hat{\\sigma}_h)^2}{n_h+1} = \\frac{(W_h\\hat{\\sigma}_h)^2}{n_h(n_h+1)}$。\n我们比较 $h=1$（此时 $n_1=15$）和 $h=3$（此时 $n_3=51$）的这个值。\n- 对于 $h=1$：$\\frac{(W_1\\hat{\\sigma}_1)^2}{n_1(n_1+1)} = \\frac{(0.3)^2}{15(16)} = \\frac{0.09}{240} = 0.000375$\n- 对于 $h=3$：$\\frac{(W_3\\hat{\\sigma}_3)^2}{n_3(n_3+1)} = \\frac{(1.0)^2}{51(52)} = \\frac{1}{2652} \\approx 0.00037707$\n\n由于第 3 层的边际方差减少量略大，我们将剩余的样本分配给第 3 层。\n最终的整数分配是：\n- $n_1 = 15$\n- $n_2 = 72$\n- $n_3 = 51 + 1 = 52$\n- $n_4 = 41$\n\n总和为 $15+72+52+41 = 180$，并且所有 $n_h \\ge 10$，因此解是有效的。\n\n### 关于方差影响的讨论\n\n稳健分配问题要求最小化最坏情况方差，这等价于最小化 $(1+\\delta)^2 \\sum_{h=1}^{H} \\frac{(W_h \\hat{\\sigma}_h)^2}{n_h}$。而名义（非稳健）分配会忽略预调查的不确定性，并最小化名义方差，即 $\\sum_{h=1}^{H} \\frac{(W_h \\hat{\\sigma}_h)^2}{n_h}$。\n由于稳健问题的目标函数仅仅是名义问题目标函数的一个常数倍，因此最小化该表达式的最优分配 $\\{n_h\\}$ 在两种情况下是相同的。稳健分配与 $W_h\\hat{\\sigma}_h$ 成正比，这与名义上的奈曼分配相同。\n\n主要的影响不在于分配策略本身，而在于有保证的性能。名义方法得出一个分配方案及其相关的方差估计 $V_{nom} = \\sum \\frac{W_h^2\\hat{\\sigma}_h^2}{n_h^{opt}}$。然而，这个估计是乐观的，因为它依赖于预调查估计值 $\\hat{\\sigma}_h$ 的完全准确性。稳健方法承认不确定性，并提供了一个最坏情况下的保证。最小化的最坏情况方差是 $V_{WC} = (1+\\delta)^2 V_{nom}$。在本例中，$\\delta=0.1$，保证的方差是乐观名义估计的 $(1.1)^2 = 1.21$ 倍，即高出 $21\\%$。稳健公式迫使我们认识到并量化由 $\\sigma_h$ 估计误差导致的潜在更高方差，尽管在这种特定的问题结构中，它并没有改变分配计划。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 15  72  52  41 \\end{pmatrix} } $$"
        }
    ]
}