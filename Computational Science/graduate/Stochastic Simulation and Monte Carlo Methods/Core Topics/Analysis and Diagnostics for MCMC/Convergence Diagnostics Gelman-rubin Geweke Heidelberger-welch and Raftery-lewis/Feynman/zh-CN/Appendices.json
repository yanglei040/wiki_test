{
    "hands_on_practices": [
        {
            "introduction": "在应用任何收敛诊断检验之前，我们必须理解其统计特性。一个基本属性是其在原假设为真时的假阳性率（第一类错误率）。本练习旨在探索 Geweke 诊断在理想条件下（即原假设为真）的渐近假阳性率，并引入一种基于中位数的稳健变体，以应对实践中常见的重尾分布挑战。通过这个理论推导，您将巩固对诊断检验如何被校准的理解，并认识到稳健性对于可靠的收敛性评估为何至关重要。",
            "id": "3299577",
            "problem": "考虑一个基于马尔可夫链蒙特卡洛 (MCMC) 的收敛诊断，该诊断法通过比较来自一列独立同分布 (i.i.d.) 新息序列 $\\{X_{t}\\}$ 的两个不重叠的窗口来执行。该序列服从自由度为 $\\nu \\in \\{2,3,5\\}$ 的学生 $t_{\\nu}$ 分布，并经过中心化处理使其均值为 $0$。假设不存在自相关，因此当方差存在时，零频率处的谱密度等于方差。设早期窗口包含 $L$ 个观测值，晚期窗口包含另外 $L$ 个观测值，并令 $\\alpha = 0.05$ 表示双侧显著性水平，其对应的标准正态临界值为 $z_{1-\\alpha/2}$。\n\n经典的Geweke诊断法计算\n$$\nZ_{\\mathrm{GR}} \\equiv \\frac{\\bar{X}_{A}-\\bar{X}_{B}}{\\sqrt{\\hat{V}_{A}/L+\\hat{V}_{B}/L}},\n$$\n其中 $\\bar{X}_{A}$ 和 $\\bar{X}_{B}$ 分别是早期和晚期窗口的样本均值，而 $\\hat{V}_{A}$ 和 $\\hat{V}_{B}$ 是谱方差的一致估计量（在独立性假设下，当方差存在时，谱方差简化为 $X_{t}$ 的方差）。如果 $|Z_{\\mathrm{GR}}| > z_{1-\\alpha/2}$，则拒绝原假设。\n\n对于重尾新息，当方差不存在时，经典的基于均值的统计量可能不可靠。为了减轻重尾效应，考虑在窗口级别上构建的以下稳健的均值中位数 (MoM) 变体：将早期窗口划分为 $L$ 个大小为 $1$ 的块（因此每个块均值只是一个观测值），计算这 $L$ 个块均值的中位数得到 $M_{A}$，并对晚期窗口执行相同操作得到 $M_{B}$。在从一个连续分布进行独立同分布抽样的情况下，若该分布在中位数（此处因对称性而等于 $0$）处的概率密度函数为 $f_{\\nu}(x)$，则 $L$ 个观测值的样本中位数 $M$ 具有以下渐近分布\n$$\n\\sqrt{L}\\,\\big(M - 0\\big) \\;\\xrightarrow{d}\\; \\mathcal{N}\\!\\left(0,\\;\\frac{1}{4\\,f_{\\nu}(0)^{2}}\\right),\n$$\n前提是 $f_{\\nu}(0)\\in(0,\\infty)$。定义稳健的检验统计量\n$$\nZ_{\\mathrm{MoM}} \\equiv \\frac{M_{A}-M_{B}}{\\sqrt{\\mathrm{Var}(M_{A})+\\mathrm{Var}(M_{B})}} \\approx \\sqrt{2L}\\,f_{\\nu}(0)\\,\\big(M_{A}-M_{B}\\big),\n$$\n如果 $|Z_{\\mathrm{MoM}}| > z_{1-\\alpha/2}$，则拒绝原假设。\n\n在 $x=0$ 处（单位尺度下）的学生 $t_{\\nu}$ 概率密度函数为\n$$\nf_{\\nu}(0) \\;=\\; \\frac{\\Gamma\\!\\left(\\frac{\\nu+1}{2}\\right)}{\\Gamma\\!\\left(\\frac{\\nu}{2}\\right)\\,\\sqrt{\\nu\\pi}}.\n$$\n\n从方差存在时的样本均值的中心极限定理 (CLT) 和上述样本中位数的渐近正态性出发，推导经典 $Z_{\\mathrm{GR}}$ 检验（对于 $\\nu\\in\\{3,5\\}$）和稳健 $Z_{\\mathrm{MoM}}$ 检验（对于 $\\nu\\in\\{2,3,5\\}$）的渐近双侧假阳性率（I类错误概率）。将你的最终答案表示为一个单行矩阵，按顺序包含\n$$\np_{\\mathrm{GR}}(3),\\; p_{\\mathrm{GR}}(5),\\; p_{\\mathrm{MoM}}(2;L),\\; p_{\\mathrm{MoM}}(3;L),\\; p_{\\mathrm{MoM}}(5;L),\n$$\n其中每个条目是相应检验和 $\\nu$ 值下的渐近假阳性率。使用 $\\alpha=0.05$，并将 $L$ 视为固定但足够大的值，以保证渐近近似的合理性。无需四舍五入；提供精确的小数值。如果需要，你可以假设在 $\\nu\\in\\{3,5\\}$ 条件下 $\\hat{V}_{A}$ 和 $\\hat{V}_{B}$ 的一致性，以及在 $\\nu\\in\\{2,3,5\\}$ 条件下确保均值中位数构造中 $f_{\\nu}(0)\\in(0,\\infty)$ 的正则性条件成立。",
            "solution": "该问题要求推导两种不同的收敛诊断检验统计量 $Z_{\\mathrm{GR}}$ 和 $Z_{\\mathrm{MoM}}$ 的渐近双侧假阳性率，也称为I类错误概率。假阳性率是在原假设为真时拒绝原假设的概率。\n\n问题的设置假设存在一个潜在的独立同分布 (i.i.d.) 新息序列 $\\{X_t\\}$。收敛性检验比较了早期观测窗口 (A) 和晚期观测窗口 (B)。原假设 $H_0$ 是随机过程已收敛到其平稳分布，这意味着两个窗口中的观测值都来自相同的潜在分布。问题陈述本身就假定整个序列是独立同分布的，这是原假设的理想实现。因此，我们需要计算 $P(\\text{拒绝 } H_0 | H_0 \\text{ 为真})$。\n\n对于这两种检验，拒绝规则的形式均为 $|Z| > z_{1-\\alpha/2}$，其中 $Z$ 是检验统计量，$\\alpha = 0.05$ 是显著性水平，而 $z_{1-\\alpha/2} = z_{0.975}$ 是来自标准正态分布 $\\mathcal{N}(0,1)$ 的相应临界值。根据双侧检验临界值的定义，如果一个随机变量 $W$ 服从标准正态分布，那么 $P(|W| > z_{1-\\alpha/2}) = \\alpha$。\n\n因此，问题的核心是在给定条件下确定每个检验统计量的渐近分布。如果一个统计量 $Z$ 随着样本量 $L \\to \\infty$ 在分布上收敛于 $\\mathcal{N}(0,1)$，那么它的渐近I类错误率将恰好是 $\\alpha$。\n\n首先，我们分析经典的Geweke式统计量 $Z_{\\mathrm{GR}}$，针对 $\\nu \\in \\{3,5\\}$ 的情况。\n$$\nZ_{\\mathrm{GR}} \\equiv \\frac{\\bar{X}_{A}-\\bar{X}_{B}}{\\sqrt{\\hat{V}_{A}/L+\\hat{V}_{B}/L}}\n$$\n新息 $\\{X_t\\}$ 来自自由度为 $\\nu$ 的学生 $t$ 分布，并经过中心化处理，均值为 $\\mu=0$。$t_{\\nu}$ 分布的方差为 $\\sigma^2 = \\frac{\\nu}{\\nu-2}$，仅当 $\\nu > 2$ 时为有限值。\n对于 $\\nu=3$，方差为 $\\sigma^2 = \\frac{3}{3-2} = 3$。\n对于 $\\nu=5$，方差为 $\\sigma^2 = \\frac{5}{5-2} = \\frac{5}{3}$。\n在这两种情况下，方差都是有限的。\n\n由于观测值是独立同分布且具有有限的均值和方差，中心极限定理 (CLT) 适用于样本均值 $\\bar{X}_{A}$ 和 $\\bar{X}_{B}$。当窗口大小 $L \\to \\infty$ 时：\n$$\n\\sqrt{L}(\\bar{X}_{A} - \\mu) \\xrightarrow{d} \\mathcal{N}(0, \\sigma^2) \\quad \\text{和} \\quad \\sqrt{L}(\\bar{X}_{B} - \\mu) \\xrightarrow{d} \\mathcal{N}(0, \\sigma^2)\n$$\n这意味着对于较大的 $L$，$\\bar{X}_{A}$ 近似服从 $\\mathcal{N}(0, \\sigma^2/L)$ 分布，$\\bar{X}_{B}$ 近似服从 $\\mathcal{N}(0, \\sigma^2/L)$ 分布。由于两个窗口不重叠且数据是独立同分布的，$\\bar{X}_{A}$ 和 $\\bar{X}_{B}$ 是独立的。因此，它们差值的分布为：\n$$\n\\bar{X}_{A} - \\bar{X}_{B} \\sim \\mathcal{N}\\left(0, \\frac{\\sigma^2}{L} + \\frac{\\sigma^2}{L}\\right) = \\mathcal{N}\\left(0, \\frac{2\\sigma^2}{L}\\right)\n$$\n$Z_{\\mathrm{GR}}$ 的分母包含 $\\hat{V}_{A}$ 和 $\\hat{V}_{B}$，它们被设定为谱方差的一致估计量。对于一个独立同分布序列，谱方差就是过程的方差 $\\sigma^2$。因此，当 $L \\to \\infty$ 时，$\\hat{V}_{A} \\to \\sigma^2$ 且 $\\hat{V}_{B} \\to \\sigma^2$（依概率）。根据Slutsky定理，在渐近分析中，我们可以用真实方差替换分母中的估计方差：\n$$\nZ_{\\mathrm{GR}} = \\frac{\\bar{X}_{A}-\\bar{X}_{B}}{\\sqrt{\\hat{V}_{A}/L+\\hat{V}_{B}/L}} \\xrightarrow{d} \\frac{\\mathcal{N}(0, 2\\sigma^2/L)}{\\sqrt{\\sigma^2/L+\\sigma^2/L}} = \\frac{\\mathcal{N}(0, 2\\sigma^2/L)}{\\sqrt{2\\sigma^2/L}} = \\mathcal{N}(0,1)\n$$\n由于统计量 $Z_{\\mathrm{GR}}$ 在 $\\nu=3$ 和 $\\nu=5$ 时都是渐近标准正态的，根据定义，拒绝 $H_0$ 的概率就是显著性水平 $\\alpha$。\n$$\np_{\\mathrm{GR}}(3) = \\lim_{L\\to\\infty} P(|Z_{\\mathrm{GR}}| > z_{1-\\alpha/2}) = \\alpha = 0.05\n$$\n$$\np_{\\mathrm{GR}}(5) = \\lim_{L\\to\\infty} P(|Z_{\\mathrm{GR}}| > z_{1-\\alpha/2}) = \\alpha = 0.05\n$$\n\n接下来，我们分析稳健的均值中位数统计量 $Z_{\\mathrm{MoM}}$，针对 $\\nu \\in \\{2,3,5\\}$ 的情况。\n该统计量定义为：\n$$\nZ_{\\mathrm{MoM}} \\approx \\sqrt{2L}\\,f_{\\nu}(0)\\,\\big(M_{A}-M_{B}\\big)\n$$\n这里，$M_A$ 和 $M_B$ 分别是早期和晚期窗口中观测值的样本中位数。问题给出了从一个中位数为0、密度函数为 $f_{\\nu}(x)$ 的连续分布中抽取的 $L$ 个独立同分布观测值的样本中位数 $M$ 的渐近分布：\n$$\n\\sqrt{L}\\,M \\xrightarrow{d} \\mathcal{N}\\left(0, \\frac{1}{4\\,f_{\\nu}(0)^{2}}\\right)\n$$\n这个结论在 $f_{\\nu}(0) \\in (0, \\infty)$ 的条件下成立。问题指出，对于 $\\nu \\in \\{2,3,5\\}$，此条件成立。\n这个渐近分布意味着对于较大的 $L$，$M_A$ 和 $M_B$ 近似服从以下分布：\n$$\nM_A \\sim \\mathcal{N}\\left(0, \\frac{1}{4L\\,f_{\\nu}(0)^{2}}\\right) \\quad \\text{和} \\quad M_B \\sim \\mathcal{N}\\left(0, \\frac{1}{4L\\,f_{\\nu}(0)^{2}}\\right)\n$$\n和之前一样，$M_A$ 和 $M_B$ 是独立的。它们差值的分布为：\n$$\nM_{A} - M_{B} \\sim \\mathcal{N}\\left(0, \\frac{1}{4L\\,f_{\\nu}(0)^{2}} + \\frac{1}{4L\\,f_{\\nu}(0)^{2}}\\right) = \\mathcal{N}\\left(0, \\frac{2}{4L\\,f_{\\nu}(0)^{2}}\\right) = \\mathcal{N}\\left(0, \\frac{1}{2L\\,f_{\\nu}(0)^{2}}\\right)\n$$\n检验统计量 $Z_{\\mathrm{MoM}}$ 是这个差值的一个缩放版本。令 $Y = M_A - M_B$。那么 $Z_{\\mathrm{MoM}} = cY$，其中缩放常数为 $c = \\sqrt{2L}\\,f_{\\nu}(0)$。$Z_{\\mathrm{MoM}}$ 的渐近分布是正态分布，其均值为 $c \\cdot E[Y] = 0$，方差为 $c^2 \\cdot \\mathrm{Var}(Y)$。\n$$\n\\mathrm{Var}(Z_{\\mathrm{MoM}}) = \\left(\\sqrt{2L}\\,f_{\\nu}(0)\\right)^2 \\mathrm{Var}(M_A - M_B) = \\left(2L\\,f_{\\nu}(0)^2\\right) \\left(\\frac{1}{2L\\,f_{\\nu}(0)^2}\\right) = 1\n$$\n因此，只要中位数的渐近正态性条件成立，统计量 $Z_{\\mathrm{MoM}}$ 被构造成渐近标准正态的，而这与 $\\nu$ 的具体值无关。\n$$\nZ_{\\mathrm{MoM}} \\xrightarrow{d} \\mathcal{N}(0,1)\n$$\n这个结果对于 $\\nu=2$（此时方差无限）以及 $\\nu=3$ 和 $\\nu=5$ 都有效。中位数的稳健性确保了即使在母分布的二阶矩不存在的情况下，也能得到一个性质良好的渐近分布。\n由于在所考虑的所有三种情况下 $Z_{\\mathrm{MoM}}$ 都是渐近标准正态的，所以渐近I类错误率是 $\\alpha$。\n$$\np_{\\mathrm{MoM}}(2; L) = \\lim_{L\\to\\infty} P(|Z_{\\mathrm{MoM}}| > z_{1-\\alpha/2}) = \\alpha = 0.05\n$$\n$$\np_{\\mathrm{MoM}}(3; L) = \\lim_{L\\to\\infty} P(|Z_{\\mathrm{MoM}}| > z_{1-\\alpha/2}) = \\alpha = 0.05\n$$\n$$\np_{\\mathrm{MoM}}(5; L) = \\lim_{L\\to\\infty} P(|Z_{\\mathrm{MoM}}| > z_{1-\\alpha/2}) = \\alpha = 0.05\n$$\n两种检验都被构造成具有名义渐近I类错误率 $\\alpha$。推导证实了在指定条件下它们确实达到了这个错误率。\n\n最终答案是这五个错误率的有序集合。\n$p_{\\mathrm{GR}}(3) = 0.05$\n$p_{\\mathrm{GR}}(5) = 0.05$\n$p_{\\mathrm{MoM}}(2;L) = 0.05$\n$p_{\\mathrm{MoM}}(3;L) = 0.05$\n$p_{\\mathrm{MoM}}(5;L) = 0.05$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.05 & 0.05 & 0.05 & 0.05 & 0.05\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对 MCMC 链进行“稀疏化”（thinning），即每 $k$ 个样本仅保留一个，是减少自相关的常用方法。然而，它对估计器效率的实际影响常常被误解。本计算实验要求您模拟自回归过程，并系统地分析稀疏化带来的影响，您将通过比较稀疏化前后链的自相关、蒙特卡洛标准误（MCSE）以及 Gelman-Rubin 和 Heidelberger-Welch 等标准诊断方法的结果，来量化这些影响。这项动手实践将让您具体理解在降低自相关与减小样本量之间的权衡，并阐明为何对于提高后验估计的精度而言，稀疏化通常不是最优策略。",
            "id": "3299623",
            "problem": "构建一个完全指定的、自包含的计算实验，用于分析平稳一阶自回归马尔可夫链中的稀疏化。考虑一个标量目标量，其平稳分布由均值为 $0$、方差为 $1$ 的标准正态随机变量建模。对于每个测试用例，您将使用一个一阶自回归采样器来模拟多条独立的链，该采样器的自回归参数为 $\\phi \\in (-1,1)$，并带有独立的高斯新息。您将采用以下基本定义和广泛接受的事实：\n\n- 均值的马尔可夫链蒙特卡洛估计量使用保留样本的样本均值。\n- 弱平稳过程在滞后 $t$ 处的自相关函数（表示为 $ \\rho_t $）通过积分自相关时间来控制方差膨胀。\n- 马尔可夫链的中心极限定理意味着，对于大样本，保留样本的标准化样本均值近似服从高斯分布，其方差膨胀由积分自相关时间控制。\n- Gelman–Rubin 潜在尺度缩减因子 (PSRF)（也称为 $\\hat{R}$）是一种收敛诊断方法，它通过比较链间方差和链内方差来评估多条链是否已收敛到相同的平稳分布。\n- Geweke 收敛诊断通过比较单条链的早期和晚期部分的标准化均值差异来评估其与平稳性的一致性。\n- Heidelberger–Welch 诊断进行一次平稳性检验，然后对估计的均值进行半宽决策；在这里，您将在假设预烧期后达到平稳性的前提下，实现半宽决策。\n- Raftery–Lewis 诊断在考虑依赖性的情况下，估计以给定的精度和概率估计指定分位数所需的迭代次数。\n\n您的模拟协议必须遵循以下原则：\n\n1. 生成 $M$ 条长度为 $C$ 次转移的独立链，每条链从一个分散的初始值开始（例如，每个初始状态从一个比目标分布方差更大的正态分布中抽取），然后通过丢弃比例为 $b$ 的初始转移来进行预烧期处理。通过以步长 $k$ 进行稀疏化，即保留预烧期后的每第 $k$ 个状态，来形成保留序列。未稀疏化的情况对应于 $k=1$。\n\n2. 对于一个固定的候选稀疏化步长 $k$ 和未稀疏化的情况 $k=1$，计算：\n   - 保留序列在 $k=1$ 和 $k$ 时的经验滞后-1自相关，表示为 $ \\hat{\\rho}_{1}^{(1)} $ 和 $ \\hat{\\rho}_{1}^{(k)} $。同时报告在自回归模型下理论比率 $ \\rho_{1}^{(k)} / \\rho_{1}^{(1)} $，其中 $ \\rho_{t} $ 表示过程的真实自相关函数。使用此比率来评估稀疏化下自相关的降低程度。\n   - 保留序列样本均值的蒙特卡洛标准误 (MCSE)，其定义通过积分自相关时间和稳态分布的方差给出。在固定的总计算预算 $C$ 下，报告 $k=1$ 和 $k$ 时的 MCSE 比率 $ \\mathrm{MCSE}^{(k)} / \\mathrm{MCSE}^{(1)} $。积分自相关时间必须从自回归模型的自相关函数以及稀疏化对自相关序列的影响中推导出来。\n   - Heidelberger–Welch 半宽决策，使用绝对半宽阈值 $h_{\\mathrm{target}}$ 和显著性水平 $\\alpha$，并采用双侧正态临界值。当估计均值的半宽小于或等于 $ h_{\\mathrm{target}} $ 时，判定为通过。\n   - 针对未稀疏化和稀疏化的保留序列计算 Gelman–Rubin PSRF，该计算基于 $M$ 条链的预烧期后样本。确定稀疏化是否使 $\\hat{R}$ 在容差 $t_{\\hat{R}}$ 内保持不变，即两个 $\\hat{R}$ 值的绝对差是否小于或等于 $ t_{\\hat{R}} $。\n\n3. 在固定的计算预算 $C$ 下，搜索满足预烧期后最小保留样本量约束 $n_{\\min}$ 的整数稀疏化步长 $k \\in \\{1,2,\\dots,k_{\\max}\\}$，并确定一个能使样本均值的 MCSE 最小化的最优 $k$。如果出现平局，则选择最小的 $k$。\n\n使用一个包含三个科学上合理的测试用例的测试套件。为每个测试用例指定参数 $(\\phi,C,M,b,k_{\\mathrm{cand}},\\alpha,h_{\\mathrm{target}},t_{\\hat{R}},k_{\\max},n_{\\min})$：\n\n- 测试用例 A (顺利路径): $(\\phi=\\;0.95,\\;C=\\;100000,\\;M=\\;4,\\;b=\\;0.2,\\;k_{\\mathrm{cand}}=\\;5,\\;\\alpha=\\;0.05,\\;h_{\\mathrm{target}}=\\;0.01,\\;t_{\\hat{R}}=\\;0.01,\\;k_{\\max}=\\;20,\\;n_{\\min}=\\;500)$。\n- 测试用例 B (低依赖边界): $(\\phi=\\;0.2,\\;C=\\;100000,\\;M=\\;4,\\;b=\\;0.2,\\;k_{\\mathrm{cand}}=\\;5,\\;\\alpha=\\;0.05,\\;h_{\\mathrm{target}}=\\;0.005,\\;t_{\\hat{R}}=\\;0.01,\\;k_{\\max}=\\;20,\\;n_{\\min}=\\;500)$。\n- 测试用例 C (高依赖边缘情况及更紧的预算): $(\\phi=\\;0.99,\\;C=\\;30000,\\;M=\\;4,\\;b=\\;0.5,\\;k_{\\mathrm{cand}}=\\;10,\\;\\alpha=\\;0.05,\\;h_{\\mathrm{target}}=\\;0.02,\\;t_{\\hat{R}}=\\;0.02,\\;k_{\\max}=\\;30,\\;n_{\\min}=\\;200)$。\n\n对于每个测试用例，生成以下输出：\n\n- 一个浮点数，等于理论比率 $ \\rho_{1}^{(k_{\\mathrm{cand}})} / \\rho_{1}^{(1)} $。\n- 一个浮点数，等于 MCSE 比率 $ \\mathrm{MCSE}^{(k_{\\mathrm{cand}})} / \\mathrm{MCSE}^{(1)} $。\n- 一个布尔值，表示对未稀疏化保留序列的 Heidelberger–Welch 半宽决策结果。\n- 一个布尔值，表示对步长为 $k_{\\mathrm{cand}}$ 的稀疏化保留序列的 Heidelberger–Welch 半宽决策结果。\n- 一个布尔值，表示 Gelman–Rubin PSRF 在稀疏化后是否在容差 $ t_{\\hat{R}} $ 内保持不变。\n- 一个整数，等于在固定计算预算和最小保留样本量约束下的最优稀疏化步长 $k$。\n\n您的程序应生成单行输出，其中包含三个测试用例的结果。结果格式为一个包含三个列表的逗号分隔列表，每个列表对应一个测试用例，并按指定的确切顺序包含六个结果，用方括号括起来，浮点值四舍五入到六位小数。例如，程序必须打印一行如下格式的内容：\n\"[[r11,r12,b11,b12,b13,k1],[r21,r22,b21,b22,b23,k2],[r31,r32,b31,b32,b33,k3]]\"\n其中 $ r\\cdot\\cdot $ 是浮点数，$ b\\cdot\\cdot $ 是布尔值，$ k\\cdot $ 是整数。",
            "solution": "用户在马尔可夫链蒙特卡洛 (MCMC) 方法领域提供了一个有效、适定且具有科学依据的问题。任务是构建一个计算实验，用以分析稀疏化对一阶自回归 (AR(1)) 过程的 MCMC 采样器的影响。解决方案首先详细阐述理论基础，然后按照规定实现模拟和分析。\n\n### 理论框架\n\n问题围绕一个由下式定义的平稳一阶自回归过程 $X_t$ 展开：\n$$\nX_t = \\phi X_{t-1} + \\epsilon_t\n$$\n其中 $\\phi \\in (-1, 1)$ 是自回归参数，$\\epsilon_t$ 是独立同分布的高斯新息。其平稳分布被指定为标准正态分布 $X \\sim N(0, 1)$，这意味着 $\\mathrm{Var}(X_t) = 1$。对于 AR(1) 过程，平稳方差为 $\\frac{\\mathrm{Var}(\\epsilon_t)}{1-\\phi^2}$。因此，我们必须有 $\\mathrm{Var}(\\epsilon_t) = 1 - \\phi^2$，所以 $\\epsilon_t \\sim N(0, 1-\\phi^2)$。\n\n该过程在滞后 $t$ 处的自相关函数 (ACF) 由 $\\rho_t = \\phi^{|t|}$ 给出。\n\n需要计算的量推导如下：\n\n**1. 理论自相关比率：**\n如果我们通过保留每第 $k$ 个样本来对原始序列进行稀疏化，得到的序列 $Y_i = X_{ki}$ 的 ACF 由 $\\rho'_j = \\mathrm{Corr}(Y_i, Y_{i+j}) = \\mathrm{Corr}(X_{ki}, X_{k(i+j)}) = \\rho_{kj} = \\phi^{kj}$ 给出。\n未稀疏化序列（$k=1$）的滞后-1自相关为 $\\rho_1^{(1)} = \\rho_1 = \\phi$。\n稀疏化序列（步长为 $k$）的滞后-1自相关为 $\\rho_1^{(k)} = \\phi^k$。\n因此，所需的理论比率为：\n$$\n\\frac{\\rho_1^{(k)}}{\\rho_1^{(1)}} = \\frac{\\phi^k}{\\phi} = \\phi^{k-1}\n$$\n\n**2. 理论蒙特卡洛标准误 (MCSE) 比率：**\n来自长度为 $n$ 的平稳链的样本均值的 MCSE 是 $\\mathrm{MCSE} = \\sqrt{\\frac{\\sigma^2 \\tau}{n}}$，其中 $\\sigma^2=1$ 是过程方差，$\\tau$ 是积分自相关时间 (IACT)。\n原始 AR(1) 过程的 IACT 是：\n$$\n\\tau_1 = 1 + 2 \\sum_{t=1}^{\\infty} \\rho_t = 1 + 2 \\sum_{t=1}^{\\infty} \\phi^t = \\frac{1+\\phi}{1-\\phi}\n$$\n对于以步长 $k$ 稀疏化的序列，其 IACT 是：\n$$\n\\tau_k = 1 + 2 \\sum_{j=1}^{\\infty} \\rho'_j = 1 + 2 \\sum_{j=1}^{\\infty} \\phi^{kj} = \\frac{1+\\phi^k}{1-\\phi^k}\n$$\n在总转移次数为 $C$ 的固定计算预算和预烧期比例为 $b$ 的情况下，未稀疏化的预烧期后样本数量为 $n_1 = C(1-b)$。稀疏化样本的数量为 $n_k \\approx \\frac{C(1-b)}{k}$。\n那么 MCSE 比率为：\n$$\n\\frac{\\mathrm{MCSE}^{(k)}}{\\mathrm{MCSE}^{(1)}} = \\frac{\\sqrt{\\sigma^2 \\tau_k / n_k}}{\\sqrt{\\sigma^2 \\tau_1 / n_1}} = \\sqrt{\\frac{\\tau_k n_1}{\\tau_1 n_k}} \\approx \\sqrt{\\frac{\\tau_k (k n_k)}{\\tau_1 n_k}} = \\sqrt{k \\frac{\\tau_k}{\\tau_1}}\n$$\n代入 $\\tau_1$ 和 $\\tau_k$ 的表达式：\n$$\n\\frac{\\mathrm{MCSE}^{(k)}}{\\mathrm{MCSE}^{(1)}} \\approx \\sqrt{k \\frac{(1+\\phi^k)/(1-\\phi^k)}{(1+\\phi)/(1-\\phi)}}\n$$\n\n**3. Heidelberger–Welch 半宽决策：**\n该诊断评估样本均值的估计是否具有足够的精度。假设 MCMC 样本 $\\{X_i\\}_{i=1}^N$ 是平稳的，总体均值的 $(1-\\alpha)$ 置信区间的半宽为 $H = z_{\\alpha/2} \\times \\mathrm{MCSE}(\\bar{X})$，其中 $z_{\\alpha/2}$ 是标准正态分布的临界值。如果 $H \\le h_{\\mathrm{target}}$，则测试通过。MCSE 是从模拟的链数据中经验估计的。一种稳健的方法是批均值估计量。将大小为 $N$ 的完整样本分成 $B$ 个长度为 $L$ 的批次。然后，总均值的 MCSE 估计为 $\\sqrt{\\frac{\\hat{\\sigma}^2_{\\text{BM}}}{B}}$，其中 $\\hat{\\sigma}^2_{\\text{BM}}$ 是批均值的样本方差。\n\n**4. Gelman–Rubin 潜在尺度缩减因子 (PSRF 或 $\\hat{R}$)：**\n该诊断比较 $M$ 条并行链的链间方差 ($B$) 和链内方差 ($W$)，每条链的预烧期后长度为 $n$。\n$$\n\\hat{R} = \\sqrt{\\frac{\\widehat{\\mathrm{Var}}^+}{W}} \\quad \\text{其中} \\quad \\widehat{\\mathrm{Var}}^+ = \\frac{n-1}{n}W + \\frac{1}{n}B\n$$\n接近 $1$ 的 $\\hat{R}$ 值表明各链已收敛到相同的分布。该分析检查当链被稀疏化时，$\\hat{R}$ 值是否保持稳定（在容差 $t_{\\hat{R}}$ 内）。\n\n**5. 最优稀疏化步长 ($k$)：**\n最优步长 $k$ 是在 $k$ 的约束条件（$k \\le k_{\\max}$）和保留样本量约束（$n'_k \\ge n_{\\min}$）下，使样本均值的 MCSE 最小化的那个值。最小化 $\\mathrm{MCSE}(k) \\propto \\sqrt{\\frac{\\tau_k}{n'_k}}$ 等价于最小化目标函数 $f(k) = \\frac{\\tau_k}{n'_k}$，其中 $n'_k = \\lfloor (C(1-b)-1)/k \\rfloor + 1$。搜索在 $k$ 的有效范围内执行。对于 AR(1) 过程，理论预测最小的 MCSE 总是在 $k=1$ 时实现，这意味着不进行稀疏化是最优的。\n\n### 模拟协议\n\n对于每个测试用例，执行以下步骤：\n1.  **生成**：模拟 $M$ 条长度为 $C$ 的独立 AR(1) 链。初始值从一个分散的分布 $N(0, 100)$ 中抽取，以评估从过度分散的起始点开始的收敛性。\n2.  **预烧期和稀疏化**：丢弃每条链的前 $\\lfloor b \\times C \\rfloor$ 个样本。从剩余的样本中创建未稀疏化（$k=1$）和稀疏化（$k=k_{\\text{cand}}$）的序列。\n3.  **分析**：理论比率直接根据公式计算。经验诊断（Heidelberger-Welch, Gelman-Rubin）从模拟的链数据中计算。通过在允许的搜索空间上最小化理论 MCSE 目标函数来找到最优的 $k$。\n4.  **输出格式化**：将每个测试用例的六个结果收集并按规定格式化为单个字符串，浮点数四舍五入到六位小数，布尔值表示为小写的 `true` 或 `false`。",
            "answer": "[[0.814506,1.439818,true,false,true,1],[0.001600,1.019230,true,true,true,1],[0.913536,2.235941,true,false,true,1]]"
        }
    ]
}