{
    "hands_on_practices": [
        {
            "introduction": "蛙跳积分器是哈密顿蒙特卡洛（HMC）方法的核心引擎，其数值积分的成败很大程度上取决于步长 $\\epsilon$ 的选择。过大的步长会导致数值不稳定，使模拟发散。本练习将通过分析一个简单但极具代表性的谐振子模型，从第一性原理出发，推导出蛙跳积分器的稳定性条件，从而帮助你深入理解步长调节的根本原因。",
            "id": "3311274",
            "problem": "考虑一个一维哈密顿蒙特卡洛 (HMC) 系统，其哈密顿量定义为 $H(q,p)=U(q)+K(p)$，其中势能为 $U(q)=\\frac{1}{2}\\omega^{2}q^{2}$，动能为 $K(p)=\\frac{1}{2}p^{2}$。运动方程由哈密顿方程给出，即 $\\dot{q}=\\frac{\\partial H}{\\partial p}=p$ 和 $\\dot{p}=-\\frac{\\partial H}{\\partial q}=-\\omega^{2}q$。步长为 $\\epsilon$ 的蛙跳（也称 Störmer–Verlet）积分器由以下更新序列定义：\n$$\np_{n+\\frac{1}{2}}=p_{n}-\\frac{\\epsilon}{2}\\,\\nabla U(q_{n}),\\quad\nq_{n+1}=q_{n}+\\epsilon\\,p_{n+\\frac{1}{2}},\\quad\np_{n+1}=p_{n+\\frac{1}{2}}-\\frac{\\epsilon}{2}\\,\\nabla U(q_{n+1}).\n$$\n对于此二次势，$\\nabla U(q)=\\omega^{2}q$，因此蛙跳积分器是 $(q,p)$ 上的一个线性辛映射。在 HMC 参数调优的背景下，积分器的稳定性对于控制能量误差的增长和保持高接受概率至关重要。\n\n从上述基本定义出发，将蛙跳积分器的单步更新映射推导为一个作用于状态向量 $(q_{n},p_{n})$ 的 $2\\times 2$ 矩阵，并使用线性稳定性分析来找到使该单步映射的特征值位于复平面单位圆上时 $\\epsilon$ 需满足的条件。将确保稳定性的最大 $\\epsilon$ 定义为使映射保持稳定的 $\\epsilon$ 的上确界值。然后将此阈值与通过在长度为 $\\epsilon$ 的一个时间间隔上解析地积分谐振子所获得的精确离散时间流映射进行比较。\n\n你的最终答案必须是最大稳定步长 $\\epsilon_{\\max}$，以关于 $\\omega$ 的闭式解析表达式给出。无需四舍五入，也无需指定单位。",
            "solution": "在尝试解答之前，对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- **系统**：一维哈密顿蒙特卡洛 (HMC) 系统。\n- **哈密顿量**：$H(q,p)=U(q)+K(p)$。\n- **势能**：$U(q)=\\frac{1}{2}\\omega^{2}q^{2}$。\n- **动能**：$K(p)=\\frac{1}{2}p^{2}$。\n- **运动方程**：$\\dot{q}=\\frac{\\partial H}{\\partial p}=p$ 和 $\\dot{p}=-\\frac{\\partial H}{\\partial q}=-\\omega^{2}q$。\n- **积分器**：步长为 $\\epsilon$ 的蛙跳（Störmer–Verlet）积分器。\n- **蛙跳更新规则**：\n  $$p_{n+\\frac{1}{2}}=p_{n}-\\frac{\\epsilon}{2}\\,\\nabla U(q_{n})$$\n  $$q_{n+1}=q_{n}+\\epsilon\\,p_{n+\\frac{1}{2}}$$\n  $$p_{n+1}=p_{n+\\frac{1}{2}}-\\frac{\\epsilon}{2}\\,\\nabla U(q_{n+1})$$\n- **势能梯度**：$\\nabla U(q)=\\omega^{2}q$。\n- **任务**：将单步更新映射推导为 $2 \\times 2$ 矩阵。使用线性稳定性分析找到使映射的特征值位于单位圆上的 $\\epsilon$ 条件。定义并求出最大稳定步长 $\\epsilon_{\\max}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据且定义明确。它描述了将一个标准的数值积分方案（蛙跳法）应用于物理学中的一个基本模型（谐振子）。任务是进行线性稳定性分析，这是评估数值方法的标准而严谨的数学程序。问题陈述是客观的，使用了计算物理和数学中精确定义的术语。它是自洽的，提供了所有必要的定义和方程。该问题并非无足轻重，需要多步推导，但它有一个唯一且有意义的解。它与 HMC 参数调优的指定主题直接相关，因为积分器稳定性是一个核心问题。没有科学或事实上的不健全之处，没有矛盾，也没有歧义。\n\n### 步骤 3：结论与行动\n问题有效。将提供解答。\n\n### 解答\n目标是求出应用于谐振子的蛙跳积分器的最大稳定步长 $\\epsilon_{\\max}$。这通过推导单步更新矩阵并分析其特征值来实现。\n\n哈密顿量为 $H(q,p) = \\frac{1}{2}\\omega^{2}q^{2} + \\frac{1}{2}p^{2}$。势能的梯度为 $\\nabla U(q) = \\frac{dU}{dq} = \\omega^{2}q$。\n\n蛙跳更新步骤如下：\n$1$. $p_{n+\\frac{1}{2}}=p_{n}-\\frac{\\epsilon}{2}\\nabla U(q_{n}) = p_{n}-\\frac{\\epsilon}{2}\\omega^{2}q_{n}$\n$2$. $q_{n+1}=q_{n}+\\epsilon p_{n+\\frac{1}{2}}$\n$3$. $p_{n+1}=p_{n+\\frac{1}{2}}-\\frac{\\epsilon}{2}\\nabla U(q_{n+1}) = p_{n+\\frac{1}{2}}-\\frac{\\epsilon}{2}\\omega^{2}q_{n+1}$\n\n我们将状态 $(q_{n+1}, p_{n+1})$ 表示为状态 $(q_n, p_n)$ 的一个线性变换。\n首先，将步骤 1 中 $p_{n+\\frac{1}{2}}$ 的表达式代入步骤 2：\n$$q_{n+1} = q_{n} + \\epsilon \\left(p_{n} - \\frac{\\epsilon}{2}\\omega^{2}q_{n}\\right)$$\n$$q_{n+1} = \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)q_{n} + \\epsilon p_{n} \\quad (*)$$\n\n接下来，我们推导 $p_{n+1}$ 的表达式。将步骤 1 中 $p_{n+\\frac{1}{2}}$ 的表达式代入步骤 3：\n$$p_{n+1} = \\left(p_{n} - \\frac{\\epsilon}{2}\\omega^{2}q_{n}\\right) - \\frac{\\epsilon}{2}\\omega^{2}q_{n+1}$$\n现在，将方程 $(*)$ 中 $q_{n+1}$ 的表达式代入：\n$$p_{n+1} = p_{n} - \\frac{\\epsilon}{2}\\omega^{2}q_{n} - \\frac{\\epsilon}{2}\\omega^{2}\\left[ \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)q_{n} + \\epsilon p_{n} \\right]$$\n按 $q_n$ 和 $p_n$ 对各项进行分组：\n$$p_{n+1} = \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)p_{n} + \\left(-\\frac{\\epsilon}{2}\\omega^{2} - \\frac{\\epsilon}{2}\\omega^{2}\\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)\\right)q_{n}$$\n$$p_{n+1} = \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)p_{n} + \\left(-\\epsilon\\omega^{2} + \\frac{\\epsilon^{3}\\omega^{4}}{4}\\right)q_{n}$$\n$$p_{n+1} = -\\epsilon\\omega^{2}\\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{4}\\right)q_{n} + \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)p_{n} \\quad (**)$$\n\n方程 $(*)$ 和 $(**)$ 定义了单步更新映射 $\\begin{pmatrix} q_{n+1} \\\\ p_{n+1} \\end{pmatrix} = M \\begin{pmatrix} q_{n} \\\\ p_{n} \\end{pmatrix}$，其中 $M$ 是 $2 \\times 2$ 的转移矩阵：\n$$M = \\begin{pmatrix} 1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}  \\epsilon \\\\ -\\epsilon\\omega^{2}\\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{4}\\right)  1 - \\frac{\\epsilon^{2}\\omega^{2}}{2} \\end{pmatrix}$$\n为了满足线性稳定性，$M$ 的特征值必须位于复平面的单位圆上，即它们的模必须为 $1$。设 $\\lambda$ 表示一个特征值。特征值是特征方程 $\\det(M - \\lambda I) = 0$ 的根。\n蛙跳积分器是辛的，这意味着它保持相空间体积不变。对于一个线性映射，这意味着 $\\det(M) = 1$。我们可以验证这个性质：\n$$\\det(M) = \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right)^{2} - \\epsilon\\left[-\\epsilon\\omega^{2}\\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{4}\\right)\\right]$$\n$$\\det(M) = \\left(1 - \\epsilon^{2}\\omega^{2} + \\frac{\\epsilon^{4}\\omega^{4}}{4}\\right) + \\epsilon^{2}\\omega^{2}\\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{4}\\right)$$\n$$\\det(M) = 1 - \\epsilon^{2}\\omega^{2} + \\frac{\\epsilon^{4}\\omega^{4}}{4} + \\epsilon^{2}\\omega^{2} - \\frac{\\epsilon^{4}\\omega^{4}}{4} = 1$$\n特征方程为 $\\lambda^{2} - \\text{Tr}(M)\\lambda + \\det(M) = 0$，化简为 $\\lambda^{2} - \\text{Tr}(M)\\lambda + 1 = 0$。\n$M$ 的迹为：\n$$\\text{Tr}(M) = \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right) + \\left(1 - \\frac{\\epsilon^{2}\\omega^{2}}{2}\\right) = 2 - \\epsilon^{2}\\omega^{2}$$\n特征值为 $\\lambda = \\frac{\\text{Tr}(M) \\pm \\sqrt{\\text{Tr}(M)^{2}-4}}{2}$。为了使特征值位于单位圆上 ($|\\lambda|=1$)，它们必须是形如 $e^{\\pm i\\theta}$ 的复共轭对。这要求特征方程的判别式为非正：\n$$\\text{Tr}(M)^{2} - 4 \\le 0 \\implies \\text{Tr}(M)^{2} \\le 4$$\n这等价于条件 $|\\text{Tr}(M)| \\le 2$。\n代入迹的表达式：\n$$|2 - \\epsilon^{2}\\omega^{2}| \\le 2$$\n这个不等式可以写成：\n$$-2 \\le 2 - \\epsilon^{2}\\omega^{2} \\le 2$$\n我们分别分析不等式的两个部分。\n$1$. 右边部分：$2 - \\epsilon^{2}\\omega^{2} \\le 2 \\implies -\\epsilon^{2}\\omega^{2} \\le 0 \\implies \\epsilon^{2}\\omega^{2} \\ge 0$。对于实数 $\\epsilon$ 和 $\\omega$，这总是成立的。\n$2$. 左边部分：$-2 \\le 2 - \\epsilon^{2}\\omega^{2} \\implies \\epsilon^{2}\\omega^{2} \\le 4$。\n假设 $\\epsilon  0$ 且 $\\omega  0$（因为这对时间步长和振荡频率具有物理意义），我们可以对两边取平方根：\n$$\\epsilon\\omega \\le 2$$\n这给出了积分器保持稳定所需满足的步长条件：\n$$\\epsilon \\le \\frac{2}{\\omega}$$\n最大稳定步长 $\\epsilon_{\\max}$ 是使积分器保持稳定的 $\\epsilon$ 值集合的上确界。这对应于条件中等号成立的情况。\n因此，最大稳定步长为：\n$$\\epsilon_{\\max} = \\frac{2}{\\omega}$$\n在此阈值处，$\\epsilon\\omega = 2$，且 $\\text{Tr}(M) = 2 - (2)^{2} = -2$。特征方程变为 $\\lambda^2 + 2\\lambda + 1 = (\\lambda+1)^2=0$，得到一个简并特征值 $\\lambda=-1$。当 $\\epsilon  \\epsilon_{\\max}$ 时，$\\text{Tr}(M)  -2$，导致出现实数特征值，其中一个的模大于 $1$，从而引起数值解指数级增长并变得不稳定。",
            "answer": "$$\\boxed{\\frac{2}{\\omega}}$$"
        },
        {
            "introduction": "在保证数值稳定性的前提下，为了让 HMC 采样器高效运行，我们还需要精细地调整其参数。本练习将引导你建立一个分析模型，该模型假设哈密顿量的变化量 $\\Delta H$ 服从正态分布，并据此计算期望接受率。通过这个练习，你将能从数学上理解数值积分误差的均值 $\\mu$ 和方差 $\\sigma^2$ 如何共同影响采样性能，并为设置目标接受率提供理论依据。",
            "id": "3311225",
            "problem": "考虑哈密顿蒙特卡洛 (HMC)，其中提议是通过使用具有有限步长的蛙跳积分器对哈密顿动力学进行数值积分来生成的。由于积分器不精确，单个提议中的哈密顿量变化（记为 $\\Delta H$）是一个随机变量，其分布取决于积分器参数，如步长和蛙跳步数。假设 $\\Delta H$ 可以很好地用均值为 $\\mu$、方差为 $\\sigma^{2}$ 的正态分布来近似，即 $\\Delta H \\sim \\mathcal{N}(\\mu,\\sigma^{2})$，其中 $\\sigma0$。在HMC使用的Metropolis-Hastings (MH)检验中，单个提议的接受概率为 $\\min\\!\\big(1, \\exp(-\\Delta H)\\big)$。\n\n仅使用关于MH接受函数和高斯积分的基本事实，推导期望 $\\mathbb{E}\\!\\left[\\min\\!\\big(1, \\exp(-\\Delta H)\\big)\\right]$ 的闭式解析表达式，用 $\\mu$ 和 $\\sigma$ 表示。用标准正态随机变量的累积分布函数（记为 $\\Phi$）表示你的最终答案。然后，根据基本原理，解释参数 $\\mu$ 和 $\\sigma$ 如何影响期望接受概率，讨论由蛙跳参数调优引起的 $\\Delta H$ 中的偏差和变异性的作用。\n\n提供精确的解析表达式；不要近似或四舍五入。最终答案不需要单位。",
            "solution": "该问题要求在哈密顿蒙特卡洛（HMC）框架下，推导期望接受概率，假设哈密顿量的变化 $\\Delta H$ 服从正态分布。随后，要求在HMC参数调优的背景下对结果进行解释。\n\n令哈密顿量变化的随机变量为 $h \\equiv \\Delta H$。问题陈述 $h$ 服从均值为 $\\mu$、方差为 $\\sigma^2$ 的正态分布，其中 $\\sigma  0$。$h$ 的概率密度函数（PDF）由下式给出：\n$$\np(h) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(h-\\mu)^2}{2\\sigma^2}\\right)\n$$\n一个提议的Metropolis-Hastings接受概率为 $\\alpha(h) = \\min\\!\\big(1, \\exp(-h)\\big)$。我们需要计算这个量的期望 $\\mathbb{E}[\\alpha(h)]$。\n\n根据定义，一个连续随机变量函数的期望是该函数乘以该变量的概率密度函数在其支撑集上的积分。\n$$\n\\mathbb{E}[\\alpha(h)] = \\int_{-\\infty}^{\\infty} \\min\\!\\big(1, \\exp(-h)\\big) \\, p(h) \\, dh\n$$\n$\\min$ 函数可以根据其参数进行分段。条件 $\\exp(-h)  1$ 等价于 $-h  \\ln(1)$，可简化为 $-h  0$，即 $h  0$。因此：\n$$\n\\min\\!\\big(1, \\exp(-h)\\big) =\n\\begin{cases}\n1  \\text{若 } h \\le 0 \\\\\n\\exp(-h)  \\text{若 } h  0\n\\end{cases}\n$$\n现在我们可以将积分分成对应这两种情况的两部分：\n$$\n\\mathbb{E}[\\alpha(h)] = \\int_{-\\infty}^{0} 1 \\cdot p(h) \\, dh + \\int_{0}^{\\infty} \\exp(-h) \\cdot p(h) \\, dh\n$$\n我们分别计算每个积分。\n\n第一个积分，我们称之为 $I_1$，是：\n$$\nI_1 = \\int_{-\\infty}^{0} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(h-\\mu)^2}{2\\sigma^2}\\right) dh\n$$\n这个积分代表概率 $P(h \\le 0)$。我们可以通过标准化随机变量来计算它。令 $z = \\frac{h-\\mu}{\\sigma}$，这意味着 $dh = \\sigma \\, dz$。积分限相应改变：当 $h \\to -\\infty$ 时，$z \\to -\\infty$；当 $h = 0$ 时，$z = \\frac{-\\mu}{\\sigma}$。\n$$\nI_1 = \\int_{-\\infty}^{-\\mu/\\sigma} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right) dz\n$$\n这是标准正态随机变量的累积分布函数（CDF）的定义，记为 $\\Phi(z)$，在 $z = -\\mu/\\sigma$ 处求值。因此，\n$$\nI_1 = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right)\n$$\n\n第二个积分 $I_2$ 是：\n$$\nI_2 = \\int_{0}^{\\infty} \\exp(-h) \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(h-\\mu)^2}{2\\sigma^2}\\right) dh\n$$\n我们可以合并指数项：\n$$\n\\exp(-h) \\exp\\left(-\\frac{(h-\\mu)^2}{2\\sigma^2}\\right) = \\exp\\left(-h - \\frac{h^2 - 2h\\mu + \\mu^2}{2\\sigma^2}\\right)\n$$\n指数的参数是：\n$$\n-\\frac{2\\sigma^2 h + h^2 - 2h\\mu + \\mu^2}{2\\sigma^2} = -\\frac{h^2 - 2(\\mu-\\sigma^2)h + \\mu^2}{2\\sigma^2}\n$$\n我们对分子中包含 $h$ 的项进行配方：$h^2 - 2(\\mu-\\sigma^2)h = \\left(h - (\\mu-\\sigma^2)\\right)^2 - (\\mu-\\sigma^2)^2$。将其代回指数的参数中得到：\n$$\n-\\frac{\\left(h - (\\mu-\\sigma^2)\\right)^2 - (\\mu-\\sigma^2)^2 + \\mu^2}{2\\sigma^2} = -\\frac{\\left(h - (\\mu-\\sigma^2)\\right)^2}{2\\sigma^2} + \\frac{(\\mu-\\sigma^2)^2 - \\mu^2}{2\\sigma^2}\n$$\n第二项简化为：\n$$\n\\frac{\\mu^2 - 2\\mu\\sigma^2 + \\sigma^4 - \\mu^2}{2\\sigma^2} = \\frac{\\sigma^4 - 2\\mu\\sigma^2}{2\\sigma^2} = \\frac{\\sigma^2}{2} - \\mu\n$$\n所以，合并后的指数项是：\n$$\n\\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\exp\\left(-\\frac{\\left(h - (\\mu-\\sigma^2)\\right)^2}{2\\sigma^2}\\right)\n$$\n现在，将其代回到 $I_2$ 的积分中：\n$$\nI_2 = \\int_{0}^{\\infty} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\exp\\left(-\\frac{\\left(h - (\\mu-\\sigma^2)\\right)^2}{2\\sigma^2}\\right) dh\n$$\n项 $\\exp(-\\mu + \\frac{\\sigma^2}{2})$ 相对于 $h$ 是一个常数，可以被提出来。剩余的被积函数是均值为 $\\mu' = \\mu - \\sigma^2$、方差为 $\\sigma^2$ 的正态分布的概率密度函数。\n$$\nI_2 = \\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\int_{0}^{\\infty} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(h-\\mu')^2}{2\\sigma^2}\\right) dh\n$$\n该积分代表概率 $P(X \\ge 0)$，其中 $X \\sim \\mathcal{N}(\\mu', \\sigma^2)$。我们可以将其写为 $1 - P(X  0)$。$P(X  0)$ 是这个正态分布在0处的累积分布函数值，即 $\\Phi\\left(\\frac{0 - \\mu'}{\\sigma}\\right) = \\Phi\\left(-\\frac{\\mu - \\sigma^2}{\\sigma}\\right) = \\Phi\\left(\\frac{\\sigma^2 - \\mu}{\\sigma}\\right)$。\n所以积分部分是 $1 - \\Phi\\left(\\frac{\\sigma^2 - \\mu}{\\sigma}\\right)$。使用恒等式 $\\Phi(-z) = 1 - \\Phi(z)$，这等于 $\\Phi\\left(-\\frac{\\sigma^2 - \\mu}{\\sigma}\\right) = \\Phi\\left(\\frac{\\mu - \\sigma^2}{\\sigma}\\right)$。\n因此，\n$$\nI_2 = \\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\Phi\\left(\\frac{\\mu - \\sigma^2}{\\sigma}\\right)\n$$\n最后，我们将两部分相加得到总的期望接受概率：\n$$\n\\mathbb{E}[\\alpha(h)] = I_1 + I_2 = \\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\Phi\\left(\\frac{\\mu - \\sigma^2}{\\sigma}\\right)\n$$\n\n根据基本原理，我们解释参数 $\\mu$ 和 $\\sigma$ 的影响。\n参数 $\\mu = \\mathbb{E}[\\Delta H]$ 代表由数值积分器引入的能量误差中的平均值或系统性偏差。对于一个完美的、时间可逆的、辛的积分器，哈密顿量将被精确守恒，意味着 $\\Delta H=0$。在实践中，对于有限步长，蛙跳积分器并不精确，通常会导致能量上出现一个小的正偏差，即 $\\mu  0$。期望接受概率对 $\\mu$ 的导数是 $\\frac{\\partial \\mathbb{E}[\\alpha]}{\\partial \\mu} = -\\exp(-\\mu + \\sigma^2/2) \\Phi(\\frac{\\mu - \\sigma^2}{\\sigma})$，对于所有有效的 $\\mu$ 和 $\\sigma$，该导数是非正的。这表明增加平均能量误差 $\\mu$ 会单调地降低期望接受概率。这是直观的：能量的系统性增加越大，提议的状态被拒绝的可能性就越大。\n\n参数 $\\sigma = \\sqrt{\\text{Var}(\\Delta H)}$ 代表能量误差的可变性或随机波动。它是积分数值不稳定性的一个度量。$\\mu$ 和 $\\sigma$ 都受积分器参数的影响，主要是步长 $\\epsilon$。通常，两者都随 $\\epsilon$ 的增加而增加。$\\sigma$ 对接受率的影响比 $\\mu$ 更复杂。在 $\\sigma \\to 0$ 的极限情况下，期望接受率收敛于 $\\min(1, \\exp(-\\mu))$。对于非零的 $\\sigma$，其影响取决于 $\\mu$ 的值。当 $\\mu$ 很大且为正时，$\\Delta H$ 几乎总是正的，接受率约等于 $\\mathbb{E}[\\exp(-\\Delta H)]$。由于 $\\exp(-h)$ 是一个凸函数，根据琴生不等式（Jensen's inequality），有 $\\mathbb{E}[\\exp(-\\Delta H)] \\ge \\exp(-\\mathbb{E}[\\Delta H]) = \\exp(-\\mu)$。事实上，我们推导的表达式中的项 $\\exp(\\sigma^2/2)$ 表明，对于给定的 $\\mu  0$，增加 $\\sigma$ 可以提高期望接受率。这是因为变异性引入了 $\\Delta H$ 小于其均值（甚至为负）的可能性，由于 $\\exp(-h)$ 的非线性和在1处的上限，这会导致接受概率不成比例地大幅增加。然而，在通常调整HMC的区域（高接受率，因此 $\\mu$ 很小），$\\sigma$ 的增加会引入更频繁的大的正能量误差，从而降低平均接受率。在HMC调优中，目标是使数值积分尽可能精确以确保高接受率，这意味着要最小化能量误差的偏差 $\\mu$ 和变异性 $\\sigma$。",
            "answer": "$$\n\\boxed{\\Phi\\left(-\\frac{\\mu}{\\sigma}\\right) + \\exp\\left(-\\mu + \\frac{\\sigma^2}{2}\\right) \\Phi\\left(\\frac{\\mu - \\sigma^2}{\\sigma}\\right)}\n$$"
        },
        {
            "introduction": "理论上我们知道了需要将接受率调整到一个理想范围，但在实践中如何自动找到对应的步长 $\\epsilon$ 呢？对偶平均算法正是解决此问题的标准方法。本练习将提供一个具体的计算场景，让你手动执行几轮对偶平均更新步骤，从而亲身体验现代 HMC 软件中步长自适应调节的内部工作机制。",
            "id": "3311213",
            "problem": "考虑通过对偶平均方案进行哈密顿蒙特卡洛 (HMC) 步长自适应，该方案用于将期望的 Metropolis 接受概率引导至一个目标值。给定三个合成的接受概率观测值 $a_1$、$a_2$ 和 $a_3$，一个目标接受水平 $\\delta$，以及对偶平均超参数。假设将标准的对偶平均递归应用于对数步长，其噪声项由目标接受水平与观测到的接受概率之间的差异驱动，并且对偶平均统计量按常规初始化为零。\n\n数据与设置：\n- 目标接受水平：$\\delta = 0.8$。\n- 接受概率观测值：$a_1 = 0.2$，$a_2 = 0.9$，$a_3 = 0.7$。\n- 对偶平均超参数：$t_0 = 10$，$\\gamma = 0.05$，$\\kappa = 0.75$。\n- 初始步长猜测值：$\\epsilon_0 = 0.1$。\n- 对数步长的中心化参数：$\\mu = \\ln(10\\,\\epsilon_0)$。\n- 将对偶平均统计量初始化为零。\n\n应用三次对偶平均迭代，并计算在迭代 $t=3$ 时产生的原始步长 $\\epsilon_3$。将最终答案四舍五入至四位有效数字。",
            "solution": "对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- 目标接受水平：$\\delta = 0.8$。\n- 接受概率观测值：$a_1 = 0.2$，$a_2 = 0.9$，$a_3 = 0.7$。\n- 对偶平均超参数：$t_0 = 10$，$\\gamma = 0.05$，$\\kappa = 0.75$。\n- 初始步长猜测值：$\\epsilon_0 = 0.1$。\n- 对数步长的中心化参数：$\\mu = \\ln(10\\,\\epsilon_0)$。\n- 对偶平均统计量的初始化：$\\bar{H}_0 = 0$。\n- 任务：应用三次对偶平均迭代，计算原始步长 $\\epsilon_3$，并将结果四舍五入至四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题描述了一个标准的数值程序，即对偶平均方案，用于统计算法中的超参数调整，特别是用于调整哈密顿蒙特卡洛 (HMC) 中的步长。\n- **科学依据**：该算法及其背景在计算统计学和机器学习文献中已经很成熟（例如，Hoffman  Gelman, 2014, \"The No-U-Turn Sampler\"）。其公式基于标准的随机近似理论。该问题在科学上是合理的。\n- **适定性**：该问题提供了所有必要的参数和初始条件，以唯一地确定指定递归算法前三次迭代的结果。对特定输出 $\\epsilon_3$ 的要求是明确的。\n- **客观性**：该问题使用精确的数学和算法术语进行陈述。没有主观或模糊的语言。\n\n参数 $\\kappa$ 是完整对偶平均方案的一部分，它控制一个独立的平均步长的收敛速度，但对于计算原始步长序列 $\\epsilon_t$ 而言并非必需。包含这个参数不会造成矛盾，对于所问的具体问题而言，它只是一个无关信息。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解法。\n\n对偶平均方案调整 HMC 步长 $\\epsilon$，以将期望的 Metropolis-Hastings 接受概率引导至目标值 $\\delta$。这种自适应是针对步长的对数 $\\log \\epsilon$ 进行的。该算法的核心是一组递归方程。\n\n设 $t$ 为迭代指数。更新方程如下：\n1.  代表在迭代 $t$ 时的误差的统计量是 $H_t = \\delta - a_t$，其中 $a_t$ 是在迭代 $t$ 观测到的接受概率。\n2.  对偶平均统计量 $\\bar{H}_t$ 通过加权平均进行更新：\n    $$ \\bar{H}_t = \\left(1 - \\frac{1}{t + t_0}\\right) \\bar{H}_{t-1} + \\frac{1}{t + t_0} H_t $$\n3.  下一次迭代的原始步长的对数 $\\log \\epsilon_t$ 由下式确定：\n    $$ \\log \\epsilon_t = \\mu - \\frac{\\sqrt{t}}{\\gamma} \\bar{H}_t $$\n    其中 $\\mu$ 是一个中心点，$\\gamma$ 是一个控制向 $\\mu$ 收缩的参数。\n\n我们已知以下值：\n- 目标接受水平：$\\delta = 0.8$\n- 观测到的接受概率：$a_1 = 0.2$，$a_2 = 0.9$，$a_3 = 0.7$\n- 对偶平均超参数：$t_0 = 10$，$\\gamma = 0.05$\n- 初始步长猜测值：$\\epsilon_0 = 0.1$\n- 初始对偶平均统计量：$\\bar{H}_0 = 0$\n\n首先，我们计算中心化参数 $\\mu$：\n$$ \\mu = \\ln(10\\,\\epsilon_0) = \\ln(10 \\times 0.1) = \\ln(1) = 0 $$\n这简化了后续对 $\\log \\epsilon_t$ 的计算。\n\n我们通过迭代来求解 $\\epsilon_3$。\n\n**迭代 $t=1$:**\n- 接受概率为 $a_1 = 0.2$。\n- 误差统计量为 $H_1 = \\delta - a_1 = 0.8 - 0.2 = 0.6$。\n- 对偶平均统计量 $\\bar{H}_1$ 从 $\\bar{H}_0 = 0$ 更新：\n$$ \\bar{H}_1 = \\left(1 - \\frac{1}{1 + 10}\\right) \\bar{H}_0 + \\frac{1}{1 + 10} H_1 = \\left(1 - \\frac{1}{11}\\right)(0) + \\frac{1}{11}(0.6) = \\frac{0.6}{11} $$\n- 计算对数步长 $\\log \\epsilon_1$：\n$$ \\log \\epsilon_1 = \\mu - \\frac{\\sqrt{1}}{\\gamma} \\bar{H}_1 = 0 - \\frac{1}{0.05} \\left(\\frac{0.6}{11}\\right) = -20 \\left(\\frac{0.6}{11}\\right) = -\\frac{12}{11} $$\n下一次 HMC 运行的步长将是 $\\epsilon_1 = \\exp(-\\frac{12}{11})$。\n\n**迭代 $t=2$:**\n- 接受概率为 $a_2 = 0.9$。\n- 误差统计量为 $H_2 = \\delta - a_2 = 0.8 - 0.9 = -0.1$。\n- 对偶平均统计量 $\\bar{H}_2$ 从 $\\bar{H}_1 = \\frac{0.6}{11}$ 更新：\n$$ \\bar{H}_2 = \\left(1 - \\frac{1}{2 + 10}\\right) \\bar{H}_1 + \\frac{1}{2 + 10} H_2 = \\frac{11}{12} \\left(\\frac{0.6}{11}\\right) + \\frac{1}{12} (-0.1) $$\n$$ \\bar{H}_2 = \\frac{0.6}{12} - \\frac{0.1}{12} = \\frac{0.5}{12} $$\n- 计算对数步长 $\\log \\epsilon_2$：\n$$ \\log \\epsilon_2 = \\mu - \\frac{\\sqrt{2}}{\\gamma} \\bar{H}_2 = 0 - \\frac{\\sqrt{2}}{0.05} \\left(\\frac{0.5}{12}\\right) = -20\\sqrt{2} \\left(\\frac{0.5}{12}\\right) = -\\frac{10\\sqrt{2}}{12} = -\\frac{5\\sqrt{2}}{6} $$\n下一次 HMC 运行的步长将是 $\\epsilon_2 = \\exp(-\\frac{5\\sqrt{2}}{6})$。\n\n**迭代 $t=3$:**\n- 接受概率为 $a_3 = 0.7$。\n- 误差统计量为 $H_3 = \\delta - a_3 = 0.8 - 0.7 = 0.1$。\n- 对偶平均统计量 $\\bar{H}_3$ 从 $\\bar{H}_2 = \\frac{0.5}{12}$ 更新：\n$$ \\bar{H}_3 = \\left(1 - \\frac{1}{3 + 10}\\right) \\bar{H}_2 + \\frac{1}{3 + 10} H_3 = \\frac{12}{13} \\left(\\frac{0.5}{12}\\right) + \\frac{1}{13} (0.1) $$\n$$ \\bar{H}_3 = \\frac{0.5}{13} + \\frac{0.1}{13} = \\frac{0.6}{13} $$\n- 计算对数步长 $\\log \\epsilon_3$，这是求得最终答案所必需的量：\n$$ \\log \\epsilon_3 = \\mu - \\frac{\\sqrt{3}}{\\gamma} \\bar{H}_3 = 0 - \\frac{\\sqrt{3}}{0.05} \\left(\\frac{0.6}{13}\\right) = -20\\sqrt{3} \\left(\\frac{0.6}{13}\\right) = -\\frac{12\\sqrt{3}}{13} $$\n\n最后，我们计算原始步长 $\\epsilon_3$：\n$$ \\epsilon_3 = \\exp\\left(-\\frac{12\\sqrt{3}}{13}\\right) $$\n为了给出数值答案，我们计算这个表达式：\n$$ \\epsilon_3 \\approx \\exp\\left(-\\frac{12 \\times 1.7320508}{13}\\right) \\approx \\exp\\left(-\\frac{20.7846096}{13}\\right) \\approx \\exp(-1.5988161) $$\n$$ \\epsilon_3 \\approx 0.20213904 $$\n将结果四舍五入到四位有效数字，得到 $0.2021$。\n\n参数 $\\kappa = 0.75$ 没有被使用，因为它关系到一个独立的“平均”步长 $\\bar{\\epsilon}_t$ 的计算，而这不是问题所要求的。“原始”步长 $\\epsilon_t$ 完全由上面显示的递归确定。",
            "answer": "$$\\boxed{0.2021}$$"
        }
    ]
}