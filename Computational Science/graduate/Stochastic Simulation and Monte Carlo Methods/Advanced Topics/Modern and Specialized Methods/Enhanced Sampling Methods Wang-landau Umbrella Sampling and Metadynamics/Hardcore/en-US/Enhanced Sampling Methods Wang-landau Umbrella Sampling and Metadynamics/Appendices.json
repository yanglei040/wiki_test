{
    "hands_on_practices": [
        {
            "introduction": "Well-Tempered Metadynamics (WTMetaD) is a cornerstone of modern enhanced sampling, but its effectiveness hinges on how the adaptive bias potential reshapes the underlying free energy landscape. This exercise takes you directly to the heart of the method's mechanics. By deriving the relationship between the converged bias potential and the free energy, you will uncover the mathematical foundation for how WTMetaD systematically lowers energy barriers and quantifies the resulting acceleration in sampling rare events.",
            "id": "3305295",
            "problem": "Consider a classical system with microscopic coordinates $\\mathbf{x}$ evolving at temperature $T$ in the canonical ensemble, with potential energy $U(\\mathbf{x})$. Let $\\xi(\\mathbf{x})$ be a differentiable collective variable. The unbiased equilibrium marginal along $\\xi$ is $P_{0}(\\xi) \\propto \\int \\mathrm{d}\\mathbf{x}\\,\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)\\exp\\!\\left[-\\beta U(\\mathbf{x})\\right]$, where $\\beta = 1/(k_{B}T)$ and $k_{B}$ is the Boltzmann constant. Define the free energy along $\\xi$ by $F(\\xi) = -\\beta^{-1}\\ln P_{0}(\\xi) + C$, where $C$ is an arbitrary constant.\n\nNow apply well-tempered metadynamics (WTMetaD), that is, a history-dependent bias potential $V(\\xi,t)$ that is updated by depositing a kernel centered at the instantaneous $\\xi(t)$ with an amplitude tempered by $\\exp\\!\\left[-V(\\xi(t),t)/(k_{B}\\Delta T)\\right]$, where $\\Delta T>0$ is a tunable parameter and the bias factor is $\\gamma = (T+\\Delta T)/T$. Assume a narrow, normalized kernel so that in the long-time limit the mean deposition rate at any fixed $\\xi$ is proportional to the stationary expectation of $\\exp\\!\\left[-V(\\xi(\\mathbf{x}),t)/(k_{B}\\Delta T)\\right]\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)$ under the biased dynamics. In the asymptotic long-time regime, suppose the bias converges to a time-independent limit $V_{\\infty}(\\xi)$ and the $\\xi$-marginal under the biased dynamics is $P_{\\infty}(\\xi) \\propto \\exp\\!\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right]$. Impose the stationarity condition that the mean deposition rate with respect to $\\xi$ becomes independent of $\\xi$.\n\n(a) Starting only from these definitions and conditions, derive the functional relation between the asymptotic bias $V_{\\infty}(\\xi)$ and the free energy $F(\\xi)$, up to an additive constant.\n\n(b) Let $\\Delta F$ denote the unbiased free-energy barrier between two metastable basins along $\\xi$. Using the Arrhenius-type barrier dependence of the Kramers barrier-crossing rate in the overdamped regime, and assuming that WTMetaD modifies the barrier height via the effective free energy $F(\\xi)+V_{\\infty}(\\xi)$ while leaving dynamical prefactors unchanged, compute the acceleration factor $\\alpha$ (the ratio of the biased to unbiased rate) in terms of $\\beta$, $\\Delta F$, and $\\gamma$.\n\nYour final answer must be given as a single row matrix with two entries using the LaTeX $\\mathrm{pmatrix}$ environment: the first entry is your closed-form expression for $V_{\\infty}(\\xi)$ (set the irrelevant additive constant to zero by convention), and the second entry is your closed-form expression for the acceleration factor $\\alpha$. No numerical evaluation is required, and no units are to be reported in the final answer.",
            "solution": "The problem is found to be valid as it is scientifically grounded in the principles of statistical mechanics and enhanced sampling methods, is well-posed, objective, and internally consistent.\n\nPart (a): Derivation of the asymptotic bias potential $V_{\\infty}(\\xi)$.\n\nThe problem states that in the well-tempered metadynamics (WTMetaD) scheme, the history-dependent bias potential $V(\\xi,t)$ is updated with a deposition rate that is tempered. It is given that in the long-time limit ($t \\to \\infty$), the mean deposition rate at a fixed value of the collective variable $\\xi$ is proportional to the stationary expectation of the tempering factor multiplied by a delta function specifying the location. Let's denote the asymptotic mean deposition rate as $R_{\\infty}(\\xi)$. The bias potential converges to a time-independent limit $V_{\\infty}(\\xi)$.\n\nThe stationary expectation is taken with respect to the biased canonical ensemble, characterized by the potential energy $U(\\mathbf{x}) + V_{\\infty}(\\xi(\\mathbf{x}))$. The expectation of an observable $A(\\mathbf{x})$ is $\\langle A(\\mathbf{x}) \\rangle_{V_{\\infty}}$.\nAccording to the problem statement, the deposition rate is proportional to:\n$$R_{\\infty}(\\xi) \\propto \\left\\langle \\exp\\left[-\\frac{V(\\xi(\\mathbf{x}),t)}{k_{B}\\Delta T}\\right] \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\nIn the asymptotic limit, $V(\\xi(\\mathbf{x}),t) \\to V_{\\infty}(\\xi(\\mathbf{x}))$. The expression becomes:\n$$R_{\\infty}(\\xi) \\propto \\left\\langle \\exp\\left[-\\frac{V_{\\infty}(\\xi(\\mathbf{x}))}{k_{B}\\Delta T}\\right] \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\nThe delta function $\\delta\\left(\\xi-\\xi(\\mathbf{x})\\right)$ forces $\\xi(\\mathbf{x})$ to be equal to $\\xi$. Therefore, inside the expectation integral, the term $\\exp\\left[-V_{\\infty}(\\xi(\\mathbf{x}))/(k_{B}\\Delta T)\\right]$ can be replaced by $\\exp\\left[-V_{\\infty}(\\xi)/(k_{B}\\Delta T)\\right]$. Since this term no longer depends on the integration variable $\\mathbf{x}$, it can be pulled out of the expectation:\n$$R_{\\infty}(\\xi) \\propto \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] \\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\nThe term $\\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$ is, by definition, the marginal probability density of the collective variable $\\xi$ under the biased dynamics, which we denote as $P_{\\infty}(\\xi)$.\n$$P_{\\infty}(\\xi) = \\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}} = \\frac{\\int \\mathrm{d}\\mathbf{x}\\,\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)\\exp\\!\\left[-\\beta \\left(U(\\mathbf{x})+V_{\\infty}(\\xi(\\mathbf{x}))\\right)\\right]}{\\int \\mathrm{d}\\mathbf{x}\\,\\exp\\!\\left[-\\beta \\left(U(\\mathbf{x})+V_{\\infty}(\\xi(\\mathbf{x}))\\right)\\right]}$$\nThus, the asymptotic deposition rate is proportional to the product of the tempering factor and the biased probability density:\n$$R_{\\infty}(\\xi) \\propto \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi)$$\nThe problem imposes a stationarity condition: in the long-time limit, the deposition rate $R_{\\infty}(\\xi)$ becomes independent of $\\xi$. Let us set it to a constant, $K$.\n$$K = \\text{const} \\cdot \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi)$$\nThis implies that the product itself must be constant:\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi) = \\text{constant}$$\nThe problem also provides the relationship between the biased marginal $P_{\\infty}(\\xi)$ and the free energy $F(\\xi)$:\n$$P_{\\infty}(\\xi) \\propto \\exp\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right]$$\nSubstituting this into the stationarity equation:\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] \\exp\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right] = \\text{constant}$$\nCombining the exponents yields:\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T} - \\beta F(\\xi) - \\beta V_{\\infty}(\\xi)\\right] = \\text{constant}$$\nTaking the natural logarithm of both sides:\n$$-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T} - \\beta F(\\xi) - \\beta V_{\\infty}(\\xi) = \\text{constant}$$\nWe solve for $V_{\\infty}(\\xi)$ in terms of $F(\\xi)$. Let $\\beta = 1/(k_B T)$.\n$$-V_{\\infty}(\\xi) \\left(\\frac{1}{k_{B}\\Delta T} + \\frac{1}{k_{B}T}\\right) = \\frac{1}{k_{B}T} F(\\xi) + \\text{constant}$$\n$$-V_{\\infty}(\\xi) \\left(\\frac{T+\\Delta T}{k_{B}T\\Delta T}\\right) = \\frac{1}{k_{B}T} F(\\xi) + \\text{constant}$$\n$$V_{\\infty}(\\xi) = -\\left(\\frac{k_{B}T\\Delta T}{T+\\Delta T}\\right)\\left(\\frac{1}{k_{B}T} F(\\xi) + \\text{constant}'\\right)$$\n$$V_{\\infty}(\\xi) = -\\frac{\\Delta T}{T+\\Delta T} F(\\xi) + \\text{constant}''$$\nThe bias factor is given as $\\gamma = (T+\\Delta T)/T$. From this, we can express the prefactor in terms of $\\gamma$:\n$$\\gamma - 1 = \\frac{T+\\Delta T}{T} - 1 = \\frac{\\Delta T}{T}$$\nThe prefactor is $\\frac{\\Delta T}{T+\\Delta T} = \\frac{\\Delta T/T}{(T+\\Delta T)/T} = \\frac{\\gamma-1}{\\gamma}$.\nSo, the relationship is:\n$$V_{\\infty}(\\xi) = -\\frac{\\gamma - 1}{\\gamma} F(\\xi) + \\text{constant}''$$\nSetting the arbitrary additive constant to zero as per convention, we obtain the final expression for part (a):\n$$V_{\\infty}(\\xi) = -\\frac{\\gamma-1}{\\gamma} F(\\xi)$$\n\nPart (b): Calculation of the acceleration factor $\\alpha$.\n\nThe problem states that the barrier-crossing rate follows an Arrhenius-type dependence on the free-energy barrier $\\Delta F$. For the unbiased system, the rate $k_{\\text{unbiased}}$ is:\n$$k_{\\text{unbiased}} = A \\exp(-\\beta \\Delta F)$$\nwhere $A$ is a dynamical prefactor.\n\nIn WTMetaD, the system evolves under an effective free energy $F_{\\text{eff}}(\\xi) = F(\\xi) + V_{\\infty}(\\xi)$. Using the result from part (a):\n$$F_{\\text{eff}}(\\xi) = F(\\xi) - \\frac{\\gamma-1}{\\gamma}F(\\xi) = \\left(1 - \\frac{\\gamma-1}{\\gamma}\\right)F(\\xi) = \\frac{1}{\\gamma}F(\\xi)$$\nThis shows that the effective free-energy landscape is a scaled version of the original one. If the original free-energy barrier between two basins is $\\Delta F = F_{\\text{max}} - F_{\\text{min}}$, the new effective barrier $\\Delta F_{\\text{eff}}$ is:\n$$\\Delta F_{\\text{eff}} = F_{\\text{eff,max}} - F_{\\text{eff,min}} = \\frac{1}{\\gamma}F_{\\text{max}} - \\frac{1}{\\gamma}F_{\\text{min}} = \\frac{1}{\\gamma}\\Delta F$$\nThe biased rate $k_{\\text{biased}}$ is determined by this effective barrier. The problem assumes the prefactor $A$ remains unchanged.\n$$k_{\\text{biased}} = A \\exp(-\\beta \\Delta F_{\\text{eff}}) = A \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)$$\nThe acceleration factor $\\alpha$ is the ratio of the biased rate to the unbiased rate:\n$$\\alpha = \\frac{k_{\\text{biased}}}{k_{\\text{unbiased}}} = \\frac{A \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)}{A \\exp(-\\beta \\Delta F)}$$\n$$\\alpha = \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma} + \\beta \\Delta F\\right) = \\exp\\left[\\beta \\Delta F \\left(1 - \\frac{1}{\\gamma}\\right)\\right]$$\nThis can be written as:\n$$\\alpha = \\exp\\left[\\beta \\Delta F \\left(\\frac{\\gamma-1}{\\gamma}\\right)\\right]$$\nThis is the final expression for part (b).",
            "answer": "$$\\boxed{\\begin{pmatrix} -\\frac{\\gamma-1}{\\gamma} F(\\xi)  \\exp\\left[\\beta \\Delta F \\left(\\frac{\\gamma - 1}{\\gamma}\\right)\\right] \\end{pmatrix}}$$"
        },
        {
            "introduction": "Idealized theoretical models often assume infinite simulation time, but practical applications of metadynamics must contend with finite, non-converged trajectories. This practice introduces a powerful technique to bridge this gap, allowing for the recovery of accurate equilibrium free energies from biased simulations that have not yet reached their stationary limit. You will derive the time-dependent correction term central to the Tiwary-Parrinello reweighting framework for a model system, providing crucial hands-on experience in analyzing data from real-world, time-limited simulations.",
            "id": "3305310",
            "problem": "Consider a single collective variable $s \\in \\mathbb{R}$ whose unbiased equilibrium free energy is harmonic, $F(s) = \\frac{1}{2} k s^{2}$, with stiffness $k > 0$ at temperature $T$. Let the system be subject to Well-Tempered Metadynamics (WTMetaD), defined by a bias factor $\\gamma > 1$, and suppose that at a finite time $t$ the bias has not fully converged but is well-approximated by the fractionally converged form\n$$\nV(s,t) = -\\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\, F(s),\n$$\nwhere the fraction of convergence $f(t)$ is determined by the bias deposition rate through\n$$\nf(t) = 1 - \\exp(-\\lambda t),\n$$\nwith deposition-rate parameter $\\lambda > 0$. Under this partially converged bias, the instantaneous biased distribution of $s$ is\n$$\nP_{\\mathrm{bias}}(s,t) \\propto \\exp\\!\\left(-\\beta \\big[ F(s) + V(s,t) \\big]\\right),\n$$\nwhere $\\beta = 1/(k_{B} T)$ and $k_{B}$ is the Boltzmann constant.\n\nIn the Tiwary–Parrinello framework for reweighting partial metadynamics, unbiased equilibrium expectations are recovered from the biased trajectory by the time-dependent weight\n$$\nW(t) = \\exp\\!\\big(\\beta[ V(s(t),t) - c(t) ]\\big),\n$$\nwhere the correction energy $c(t)$ is chosen so that $\\langle W(t) \\rangle_{\\mathrm{bias}} = 1$, with the average taken over the biased ensemble at time $t$.\n\nStarting from the canonical-ensemble definitions above and enforcing the normalization $\\langle W(t) \\rangle_{\\mathrm{bias}} = 1$, derive and compute a closed-form analytic expression for the correction energy $c(t)$ as a function of $\\gamma$, $\\lambda$, $t$, $k$, and $\\beta$. Express the final correction energy in Joules. No numerical values are to be substituted; present the exact symbolic expression. No rounding is required.",
            "solution": "The problem asks for a closed-form expression for the correction energy $c(t)$ used in the Tiwary–Parrinello reweighting scheme for a system undergoing Well-Tempered Metadynamics. The correction $c(t)$ is determined by the normalization condition $\\langle W(t) \\rangle_{\\mathrm{bias}} = 1$.\n\nFirst, we write the normalization condition explicitly. The average of an observable $A(s)$ over the biased ensemble at time $t$ is given by:\n$$\n\\langle A(s) \\rangle_{\\mathrm{bias}} = \\frac{\\int_{-\\infty}^{\\infty} A(s) P_{\\mathrm{bias}}(s,t) ds}{\\int_{-\\infty}^{\\infty} P_{\\mathrm{bias}}(s,t) ds}\n$$\nThe instantaneous biased probability distribution is $P_{\\mathrm{bias}}(s,t) \\propto \\exp(-\\beta [F(s) + V(s,t)])$. Let's denote the normalization constant (partition function) of the biased ensemble as $Z_{\\mathrm{bias}}(t) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta [F(s) + V(s,t)]) ds$. Thus, $P_{\\mathrm{bias}}(s,t) = \\frac{1}{Z_{\\mathrm{bias}}(t)} \\exp(-\\beta [F(s) + V(s,t)])$.\n\nThe reweighting factor is $W(t) = \\exp(\\beta[V(s(t),t) - c(t)])$. The quantity $c(t)$ is a function of time $t$ but is constant with respect to the integration variable $s$. The normalization condition becomes:\n$$\n\\langle W(t) \\rangle_{\\mathrm{bias}} = \\frac{\\int_{-\\infty}^{\\infty} \\exp(\\beta[V(s,t) - c(t)]) \\frac{1}{Z_{\\mathrm{bias}}(t)} \\exp(-\\beta[F(s) + V(s,t)]) ds}{\\int_{-\\infty}^{\\infty} \\frac{1}{Z_{\\mathrm{bias}}(t)} \\exp(-\\beta[F(s) + V(s,t)]) ds} = 1\n$$\nThe denominator is simply $1$ due to the normalization of $P_{\\mathrm{bias}}(s,t)$. We can expand the terms in the numerator's integral:\n$$\n\\frac{1}{Z_{\\mathrm{bias}}(t)} \\int_{-\\infty}^{\\infty} \\exp(\\beta V(s,t)) \\exp(-\\beta c(t)) \\exp(-\\beta F(s)) \\exp(-\\beta V(s,t)) ds = 1\n$$\nThe terms $\\exp(\\beta V(s,t))$ and $\\exp(-\\beta V(s,t))$ cancel. The term $\\exp(-\\beta c(t))$ can be taken out of the integral since it does not depend on $s$.\n$$\n\\frac{\\exp(-\\beta c(t))}{Z_{\\mathrm{bias}}(t)} \\int_{-\\infty}^{\\infty} \\exp(-\\beta F(s)) ds = 1\n$$\nThe integral in the numerator is the partition function of the unbiased system, $Z_0 = \\int_{-\\infty}^{\\infty} \\exp(-\\beta F(s)) ds$.\nSo, we have:\n$$\n\\exp(-\\beta c(t)) \\frac{Z_0}{Z_{\\mathrm{bias}}(t)} = 1\n$$\nSolving for $c(t)$:\n$$\n\\exp(-\\beta c(t)) = \\frac{Z_{\\mathrm{bias}}(t)}{Z_0}\n$$\n$$\n-\\beta c(t) = \\ln\\left(\\frac{Z_{\\mathrm{bias}}(t)}{Z_0}\\right)\n$$\n$$\nc(t) = -\\frac{1}{\\beta} \\ln\\left(\\frac{Z_{\\mathrm{bias}}(t)}{Z_0}\\right)\n$$\nThis expression relates $c(t)$ to the ratio of the biased and unbiased partition functions. Now we must compute these partition functions for the given potentials.\n\nThe unbiased free energy is $F(s) = \\frac{1}{2} k s^2$. The unbiased partition function $Z_0$ is a standard Gaussian integral:\n$$\nZ_0 = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2} k s^2\\right) ds = \\sqrt{\\frac{2\\pi}{\\beta k}}\n$$\nThe total potential in the biased ensemble is $U_{\\mathrm{bias}}(s,t) = F(s) + V(s,t)$. Substituting the given expressions for $F(s)$ and $V(s,t)$:\n$$\nU_{\\mathrm{bias}}(s,t) = \\frac{1}{2} k s^2 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t) \\left(\\frac{1}{2} k s^2\\right)\n$$\n$$\nU_{\\mathrm{bias}}(s,t) = \\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right] \\frac{1}{2} k s^2\n$$\nThis is also a harmonic potential, $\\frac{1}{2} k_{\\mathrm{eff}}(t) s^2$, with a time-dependent effective stiffness $k_{\\mathrm{eff}}(t) = k \\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right]$.\n\nThe biased partition function $Z_{\\mathrm{bias}}(t)$ is therefore:\n$$\nZ_{\\mathrm{bias}}(t) = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2} k_{\\mathrm{eff}}(t) s^2\\right) ds = \\sqrt{\\frac{2\\pi}{\\beta k_{\\mathrm{eff}}(t)}}\n$$\nNow we compute the ratio of the partition functions:\n$$\n\\frac{Z_{\\mathrm{bias}}(t)}{Z_0} = \\frac{\\sqrt{2\\pi/(\\beta k_{\\mathrm{eff}}(t))}}{\\sqrt{2\\pi/(\\beta k)}} = \\sqrt{\\frac{k}{k_{\\mathrm{eff}}(t)}} = \\sqrt{\\frac{k}{k \\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right]}} = \\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right]^{-\\frac{1}{2}}\n$$\nNotably, the ratio is independent of the stiffness constant $k$.\n\nSubstituting this ratio back into the expression for $c(t)$:\n$$\nc(t) = -\\frac{1}{\\beta} \\ln\\left( \\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right]^{-\\frac{1}{2}} \\right)\n$$\nUsing the logarithm property $\\ln(x^a) = a \\ln(x)$:\n$$\nc(t) = -\\frac{1}{\\beta} \\left(-\\frac{1}{2}\\right) \\ln\\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right] = \\frac{1}{2\\beta} \\ln\\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) f(t)\\right]\n$$\nFinally, we substitute the given expression for the fraction of convergence, $f(t) = 1 - \\exp(-\\lambda t)$:\n$$\nc(t) = \\frac{1}{2\\beta} \\ln\\left[1 - \\left(1 - \\frac{1}{\\gamma}\\right) \\left(1 - \\exp(-\\lambda t)\\right)\\right]\n$$\nThis expression gives $c(t)$ as a function of $\\beta$, $\\gamma$, $\\lambda$, and $t$. It is independent of $k$, as this parameter cancelled during the calculation of the partition function ratio. The expression has units of energy (Joules in SI), as required, since $1/\\beta = k_B T$ has units of energy and the argument of the logarithm is dimensionless.\n\nFor a more compact final expression, we can simplify the argument of the logarithm:\n$$\n1 - \\left(1 - \\frac{1}{\\gamma}\\right) \\left(1 - \\exp(-\\lambda t)\\right) = 1 - \\left(1 - \\exp(-\\lambda t) - \\frac{1}{\\gamma} + \\frac{1}{\\gamma}\\exp(-\\lambda t)\\right)\n$$\n$$\n= \\frac{1}{\\gamma} + \\exp(-\\lambda t) - \\frac{1}{\\gamma}\\exp(-\\lambda t) = \\frac{1}{\\gamma} + \\left(1 - \\frac{1}{\\gamma}\\right)\\exp(-\\lambda t)\n$$\n$$\n= \\frac{1}{\\gamma} \\left(1 + (\\gamma - 1)\\exp(-\\lambda t)\\right)\n$$\nTherefore, an equivalent expression for $c(t)$ is:\n$$\nc(t) = \\frac{1}{2\\beta} \\ln\\left[\\frac{1}{\\gamma} \\left(1 + (\\gamma - 1)\\exp(-\\lambda t)\\right)\\right]\n$$\nThis is the final closed-form expression for the correction energy.",
            "answer": "$$\n\\boxed{\\frac{1}{2\\beta} \\ln\\left[\\frac{1}{\\gamma} \\left(1 + (\\gamma - 1)\\exp(-\\lambda t)\\right)\\right]}\n$$"
        },
        {
            "introduction": "Choosing the right simulation method is as much an art as a science, requiring a deep understanding of the trade-offs between different algorithms. This problem provides a quantitative arena to compare two distinct enhanced sampling strategies: the classic Umbrella Sampling and a modern hybrid scheme based on Wang-Landau sampling. By deriving the threshold at which one method outperforms the other, you will gain insight into the competing sources of statistical and systematic error, a critical skill for designing efficient and accurate computational studies.",
            "id": "3305331",
            "problem": "Consider a one-dimensional collective variable (CV) $s$ for a complex system at inverse temperature $\\beta = 1/(k_B T)$, where $k_B$ is Boltzmann’s constant and $T$ is the absolute temperature. The canonical probability density of $s$ is $P_{\\beta}(s)$, and the associated free energy (also called the potential of mean force) is $F(s) = -k_B T \\ln P_{\\beta}(s) + C$, where $C$ is an irrelevant constant.\n\nTwo enhanced sampling strategies are considered to estimate $F(s)$ at a target bin $s^{\\star}$:\n- Umbrella sampling (US) based on a set of harmonic bias windows, combined through a statistically optimal estimator (such as the Weighted Histogram Analysis Method) to yield an effective, approximately unbiased count $H_{\\mathrm{US}}(s^{\\star})$ with mean $n_{\\mathrm{US}}$ and negligible bias at $s^{\\star}$, under the assumption of sufficient overlap and correct global normalization.\n- A hybrid scheme that first performs Wang-Landau (WL) sampling directly in CV space to flatten the histogram of $s$ by adaptively updating a bias $V_{\\mathrm{WL}}(s)$ until histogram flatness, then reconstructs the canonical free energy via reweighting of the WL trajectory, i.e., using samples with weight $\\exp(\\beta V_{\\mathrm{WL}}(s))$ to obtain an estimator $\\widehat{P}_{\\beta}(s)$ and hence $\\widehat{F}(s)$.\n\nAssume the following scientifically standard conditions:\n1. The CV range is discretized into $B$ bins, and histogram counts per bin can be modeled as independent Poisson random variables for large sampling duration. For a bin with mean count $n$, the variance of the log count satisfies $\\mathrm{Var}[\\ln H] \\approx 1/n$ by the delta method applied to a Poisson random variable with mean $n$.\n2. In the US case, at $s^{\\star}$ the effective count is $H_{\\mathrm{US}}(s^{\\star})$ with mean $n_{\\mathrm{US}}$ and negligible estimator bias in $\\ln P_{\\beta}(s^{\\star})$ due to overlap and self-consistent normalization. Correlations are negligible at the level of the derived variance.\n3. In the WL-reweighting case, after WL convergence the histogram of $s$ is approximately flat, so $H_{\\mathrm{WL}}(s)$ has mean $n_{\\mathrm{WL}}$ for every bin. The WL bias $V_{\\mathrm{WL}}(s)$ used for reweighting is imperfect: write $V_{\\mathrm{WL}}(s) = V^{\\star}(s) + \\epsilon(s)$, where $V^{\\star}(s)$ is the unknown true bias that would exactly flatten the canonical $P_{\\beta}(s)$, and $\\epsilon(s)$ is a small, zero-mean error. Model $\\epsilon(s)$ as independent of histogram counts, with variance $\\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$.\n4. Ignoring global normalization fluctuations that affect all bins equally at first order, the WL-reweighted estimator of the free energy at $s^{\\star}$ is dominated by the local contributions from $H_{\\mathrm{WL}}(s^{\\star})$ and $V_{\\mathrm{WL}}(s^{\\star})$.\n\nStarting only from the above definitions and assumptions, and without invoking any pre-packaged variance formulae for these methods, derive the threshold condition under which the WL-reweighting hybrid scheme has strictly smaller mean-squared error in the free energy estimate at $s^{\\star}$ than umbrella sampling. Express your final result as a single, closed-form analytic expression for the maximum tolerable WL bias error variance $\\sigma_{V,\\max}^{2}$ as a function of $n_{\\mathrm{WL}}$, $n_{\\mathrm{US}}$, $k_B$, and $T$, such that the WL-reweighting estimator’s variance at $s^{\\star}$ does not exceed that of umbrella sampling.\n\nYour answer must be a single expression. No numerical evaluation is required. Do not include any units in your final answer. If intermediate approximations are needed, justify them from first principles within your derivation.",
            "solution": "The user wants to find the threshold condition under which a hybrid Wang-Landau (WL) reweighting scheme provides a more accurate estimate of the free energy $F(s)$ at a specific collective variable value $s^{\\star}$ than an Umbrella Sampling (US) scheme. The accuracy is to be measured by the mean-squared error (MSE). The problem asks for the maximum tolerable variance of the WL bias potential, $\\sigma_{V,\\max}^{2}$, for the WL method's variance to not exceed that of the US method.\n\nLet us begin by establishing the expressions for the Mean-Squared Error (MSE) of the free energy estimate for each method, based on the provided definitions and assumptions. The free energy $F(s)$ is related to the canonical probability density $P_{\\beta}(s)$ by $F(s) = -k_B T \\ln P_{\\beta}(s) + C$, where $\\beta = 1/(k_B T)$. The MSE of an estimator $\\widehat{F}(s^{\\star})$ for the true value $F(s^{\\star})$ is defined as $\\mathrm{MSE} = E[(\\widehat{F}(s^{\\star}) - F(s^{\\star}))^2] = \\mathrm{Var}[\\widehat{F}(s^{\\star})] + (\\mathrm{Bias}[\\widehat{F}(s^{\\star})])^2$.\n\nFirst, we analyze the Umbrella Sampling (US) method.\nThe estimator for the free energy, $\\widehat{F}_{\\mathrm{US}}(s^{\\star})$, is derived from the effective histogram count $H_{\\mathrm{US}}(s^{\\star})$. Since $F(s) \\propto -\\ln P_{\\beta}(s)$ and $P_{\\beta}(s)$ is estimated from the counts $H(s)$, the estimator for the free energy takes the form $\\widehat{F}_{\\mathrm{US}}(s^{\\star}) \\approx -k_B T \\ln H_{\\mathrm{US}}(s^{\\star}) + C'$, where $C'$ is a constant.\nThe problem states that for the US method, there is \"negligible estimator bias in $\\ln P_{\\beta}(s^{\\star})$\". This implies that the bias of $\\widehat{F}_{\\mathrm{US}}(s^{\\star})$ is also negligible. Consequently, the MSE is dominated by the variance:\n$\\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) \\approx \\mathrm{Var}[\\widehat{F}_{\\mathrm{US}}(s^{\\star})]$.\nWe compute the variance as follows:\n$\\mathrm{Var}[\\widehat{F}_{\\mathrm{US}}(s^{\\star})] = \\mathrm{Var}[ -k_B T \\ln H_{\\mathrm{US}}(s^{\\star}) + C' ] = (-k_B T)^2 \\mathrm{Var}[\\ln H_{\\mathrm{US}}(s^{\\star})]$.\nAssumption 2 provides that for a bin with mean count $n$, $\\mathrm{Var}[\\ln H] \\approx 1/n$. For the US case at $s^{\\star}$, the mean count is given as $n_{\\mathrm{US}}$.\nTherefore, the MSE for the US method is:\n$$ \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) \\approx (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} $$\n\nNext, we analyze the hybrid WL-reweighting scheme.\nThe problem states that the canonical free energy is reconstructed via reweighting. The estimator for the canonical probability is $\\widehat{P}_{\\beta}(s) \\propto H_{\\mathrm{WL}}(s) \\exp(\\beta V_{\\mathrm{WL}}(s))$, where $H_{\\mathrm{WL}}(s)$ is the count in the bin $s$ from the WL simulation and $V_{\\mathrm{WL}}(s)$ is the final WL bias potential.\nThe corresponding free energy estimator is:\n$\\widehat{F}_{\\mathrm{WL}}(s) = -k_B T \\ln \\widehat{P}_{\\beta}(s) + C'' = -k_B T \\ln(H_{\\mathrm{WL}}(s)) - k_B T \\ln(\\exp(\\beta V_{\\mathrm{WL}}(s))) + \\text{const}$.\nUsing $\\beta = 1/(k_B T)$, this simplifies to:\n$\\widehat{F}_{\\mathrm{WL}}(s) = -V_{\\mathrm{WL}}(s) - k_B T \\ln H_{\\mathrm{WL}}(s) + \\text{const}$.\nThe error in this estimator arises from two independent sources as per the problem statement:\n1. The residual error in the WL bias potential, $\\epsilon(s) = V_{\\mathrm{WL}}(s) - V^{\\star}(s)$, where $V^{\\star}(s) = -F(s) + \\text{const}$ is the true potential that flattens the landscape. This error is a random variable with mean $E[\\epsilon(s^{\\star})] = 0$ and variance $\\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$.\n2. The statistical fluctuation in the histogram counts, $H_{\\mathrm{WL}}(s^{\\star})$, which is a Poisson random variable with mean $n_{\\mathrm{WL}}$.\n\nThe total variance of the estimator $\\widehat{F}_{\\mathrm{WL}}(s^{\\star})$ is the sum of the variances from these two independent sources. We also assume that any bias in this estimator is of higher order in $1/n_{\\mathrm{WL}}$ and can be neglected for large sampling, similar to the US case. Thus, we approximate the MSE with the variance.\n$\\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) \\approx \\mathrm{Var}[\\widehat{F}_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star}) - k_B T \\ln H_{\\mathrm{WL}}(s^{\\star})]$.\nGiven the independence of $\\epsilon(s^{\\star})$ (and thus $V_{\\mathrm{WL}}(s^{\\star})$) and $H_{\\mathrm{WL}}(s^{\\star})$:\n$\\mathrm{Var}[\\widehat{F}_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star})] + \\mathrm{Var}[-k_B T \\ln H_{\\mathrm{WL}}(s^{\\star})]$.\nThe first term is $\\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-(V^{\\star}(s^{\\star}) + \\epsilon(s^{\\star}))] = \\mathrm{Var}[-\\epsilon(s^{\\star})] = \\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$, since $V^{\\star}(s^{\\star})$ is a constant.\nThe second term is $(k_B T)^2 \\mathrm{Var}[\\ln H_{\\mathrm{WL}}(s^{\\star})]$. Using Assumption 2 again with the mean count $n_{\\mathrm{WL}}$ for the WL histogram, this variance is $(k_B T)^2 (1/n_{\\mathrm{WL}})$.\nCombining these terms, the MSE for the WL-reweighting method is:\n$$ \\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) \\approx \\sigma_{V}^{2} + (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} $$\n\nThe problem asks for the condition under which the WL scheme is strictly better, i.e., $\\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star}))  \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star}))$. The threshold for this condition is found by setting the two MSEs equal. The maximum tolerable variance, $\\sigma_{V,\\max}^{2}$, is the value of $\\sigma_{V}^{2}$ at this threshold.\n$ \\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) = \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) $\n$$ \\sigma_{V,\\max}^{2} + (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} = (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} $$\nSolving for $\\sigma_{V,\\max}^{2}$:\n$$ \\sigma_{V,\\max}^{2} = (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} - (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} $$\nThis expression can be factored to yield the final result.\n$$ \\sigma_{V,\\max}^{2} = (k_B T)^2 \\left( \\frac{1}{n_{\\mathrm{US}}} - \\frac{1}{n_{\\mathrm{WL}}} \\right) $$\nThis result represents the maximum allowable error variance in the converged Wang-Landau potential for the hybrid method to match the precision of the umbrella sampling method. For the WL method to be superior, $\\sigma_V^2$ must be less than this value. A positive solution for $\\sigma_{V,\\max}^{2}$ exists only if $n_{\\mathrm{WL}}  n_{\\mathrm{US}}$, signifying that the WL simulation must achieve higher effective sampling in the bin of interest to compensate for the additional error source from the imperfect bias potential.",
            "answer": "$$\\boxed{(k_B T)^2 \\left(\\frac{1}{n_{\\mathrm{US}}} - \\frac{1}{n_{\\mathrm{WL}}}\\right)}$$"
        }
    ]
}