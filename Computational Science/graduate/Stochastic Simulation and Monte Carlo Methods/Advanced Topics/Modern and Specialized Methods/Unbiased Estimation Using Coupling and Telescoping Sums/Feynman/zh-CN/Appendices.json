{
    "hands_on_practices": [
        {
            "introduction": "理解多层蒙特卡洛方法中层级差异 $\\Delta_\\ell$ 的方差行为是至关重要的第一步。本练习将通过一个具体的随机微分方程模型——奥恩斯坦-乌伦贝克过程，来实践如何推导层级差异的均方误差 $\\mathbb{E}[\\Delta_\\ell^2]$。这个练习能够帮助你将方差衰减的抽象概念与离散化格式和耦合技术的具体计算联系起来。",
            "id": "3358889",
            "problem": "考虑由随机微分方程 $dX_{t} = -\\lambda X_{t}\\, dt + \\sigma\\, dW_{t}$ 定义的奥恩斯坦-乌伦贝克过程，其确定性初始条件为 $X_{0} = x_{0}$，其中 $\\lambda > 0$，$\\sigma > 0$，$t \\in [0,T]$，且 $W_{t}$ 是一个标准维纳过程。令 $f(x) = x$，并为时间步长 $h_{\\ell} = T/N_{\\ell}$ 定义欧拉-丸山时间离散化，其递推关系为\n$$\nX^{(\\ell)}_{n+1} = X^{(\\ell)}_{n} - \\lambda X^{(\\ell)}_{n}\\, h_{\\ell} + \\sigma\\, \\Delta W_{n}^{(\\ell)},\n$$\n对于 $n = 0,1,\\dots,N_{\\ell}-1$，其中 $X^{(\\ell)}_{0} = x_{0}$ 且独立正态增量为 $\\Delta W_{n}^{(\\ell)} \\sim \\mathcal{N}(0,h_{\\ell})$。在多层蒙特卡洛 (MLMC) 伸缩求和构造中，层级差由层级 $\\ell$ 的步长为 $h_{\\ell}$ 的精细离散化与层级 $\\ell-1$ 的步长为 $h_{\\ell-1} = 2 h_{\\ell}$ 的粗糙离散化之间形成。假设采用标准的布朗桥耦合，其中每个粗糙增量是两个连续精细增量之和，即对于 $m = 0,1,\\dots,N_{\\ell}/2 - 1$，\n$$\n\\Delta W_{m}^{(\\ell-1)} = \\Delta W_{2m}^{(\\ell)} + \\Delta W_{2m+1}^{(\\ell)}.\n$$\n将终端泛函的耦合层级差定义为\n$$\n\\Delta_{\\ell} := X_{T}^{(\\ell)} - X_{T}^{(\\ell-1)}.\n$$\n在小步长极限 $h_{\\ell} \\to 0$ 下，已知层级差的二阶矩具有形式为\n$$\n\\mathbb{E}\\!\\left[ \\Delta_{\\ell}^{2} \\right] \\approx C\\, h_{\\ell}^{2}\n$$\n的二次渐近性。在上述耦合与伸缩求和构造下，根据模型参数 $\\lambda$、$\\sigma$、$T$ 和 $x_{0}$ 显式地推导领头阶常数 $C$。您的最终答案必须是关于 $C$ 的单个闭式解析表达式，不含任何未指定常数。不需要进行数值近似。",
            "solution": "该问题是适定的，有科学依据，并为得到唯一解提供了所有必要信息。我们开始进行推导。\n\n设 $h \\equiv h_{\\ell}$ 为精细离散化（层级 $\\ell$）的时间步长，$2h \\equiv h_{\\ell-1}$ 为粗糙离散化（层级 $\\ell-1$）的时间步长。时间步数分别为 $N_{\\ell} = T/h$ 和 $N_{\\ell-1} = T/(2h) = N_{\\ell}/2$。设 $X_{n}^{(\\ell)}$ 和 $X_{m}^{(\\ell-1)}$ 分别表示精细和粗糙的数值路径。我们关注的量是终端差 $\\Delta_{\\ell} = X_{T}^{(\\ell)} - X_{T}^{(\\ell-1)}$ 的二阶矩，即 $\\mathbb{E}[\\Delta_{\\ell}^2]$。我们寻求常数 $C$，使得对于小 $h$ 有 $\\mathbb{E}[\\Delta_{\\ell}^2] \\approx C h^2$。\n\n奥恩斯坦-乌伦贝克过程是一个线性随机微分方程。我们可以将解 $X_t$ 分解为其确定性部分（均值常微分方程的解）和其随机部分。类似地，我们也可以分解数值解。\n令 $X_{n}^{(\\ell)} = \\hat{X}_{n}^{(\\ell)} + S_{n}^{(\\ell)}$，其中 $\\hat{X}_{n}^{(\\ell)}$ 是确定性部分（$\\sigma=0$）的数值解，$S_{n}^{(\\ell)}$ 是随机部分（$x_0=0$）的数值解。\n递推关系为：\n- 确定性部分：$\\hat{X}_{n+1}^{(\\ell)} = (1-\\lambda h)\\hat{X}_{n}^{(\\ell)}$，其中 $\\hat{X}_0^{(\\ell)} = x_0$。\n- 随机部分：$S_{n+1}^{(\\ell)} = (1-\\lambda h)S_{n}^{(\\ell)} + \\sigma \\Delta W_n^{(\\ell)}$，其中 $S_0^{(\\ell)} = 0$。\n\n终端差为 $\\Delta_{\\ell} = (\\hat{X}_{T}^{(\\ell)} - \\hat{X}_{T}^{(\\ell-1)}) + (S_{T}^{(\\ell)} - S_{T}^{(\\ell-1)})$。我们分别将这些差记为 $\\hat{\\Delta}_{\\ell}$ 和 $\\tilde{\\Delta}_{\\ell}$。$\\Delta_{\\ell} = \\hat{\\Delta}_{\\ell} + \\tilde{\\Delta}_{\\ell}$。\n随机部分 $\\tilde{\\Delta}_{\\ell}$ 的均值为零，因为 $S_0=0$ 且维纳增量的均值为零。确定性部分 $\\hat{\\Delta}_{\\ell}$ 是非随机的。因此，均方误差为：\n$$\n\\mathbb{E}[\\Delta_{\\ell}^2] = \\mathbb{E}[(\\hat{\\Delta}_{\\ell} + \\tilde{\\Delta}_{\\ell})^2] = \\hat{\\Delta}_{\\ell}^2 + 2\\hat{\\Delta}_{\\ell}\\mathbb{E}[\\tilde{\\Delta}_{\\ell}] + \\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2] = \\hat{\\Delta}_{\\ell}^2 + \\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2]\n$$\n我们将分别计算这两项。\n\n1.  **确定性部分：$\\hat{\\Delta}_{\\ell}^2$**\n\n确定性部分的终端值为：\n$$\n\\hat{X}_{T}^{(\\ell)} = (1 - \\lambda h)^{N_{\\ell}} x_0 = (1 - \\lambda h)^{T/h} x_0\n$$\n$$\n\\hat{X}_{T}^{(\\ell-1)} = (1 - 2\\lambda h)^{N_{\\ell-1}} x_0 = (1 - 2\\lambda h)^{T/(2h)} x_0\n$$\n对于小 $h$，我们使用展开式 $\\ln(1-z) = -z - \\frac{z^2}{2} - O(z^3)$。\n$$\n\\hat{X}_{T}^{(\\ell)} = x_0 \\exp\\left(\\frac{T}{h} \\ln(1-\\lambda h)\\right) = x_0 \\exp\\left(\\frac{T}{h} \\left(-\\lambda h - \\frac{\\lambda^2 h^2}{2} - O(h^3)\\right)\\right) = x_0 \\exp\\left(- \\lambda T - \\frac{\\lambda^2 T h}{2} - O(h^2)\\right)\n$$\n对小 $z$ 使用 $\\exp(-z) \\approx 1-z$，我们得到：\n$$\n\\hat{X}_{T}^{(\\ell)} \\approx x_0 \\exp(-\\lambda T) \\left(1 - \\frac{\\lambda^2 T h}{2}\\right)\n$$\n对粗糙路径进行类似处理：\n$$\n\\hat{X}_{T}^{(\\ell-1)} = x_0 \\exp\\left(\\frac{T}{2h} \\ln(1-2\\lambda h)\\right) = x_0 \\exp\\left(\\frac{T}{2h} \\left(-2\\lambda h - \\frac{(2\\lambda h)^2}{2} - O(h^3)\\right)\\right) = x_0 \\exp\\left(- \\lambda T - \\lambda^2 T h - O(h^2)\\right)\n$$\n$$\n\\hat{X}_{T}^{(\\ell-1)} \\approx x_0 \\exp(-\\lambda T) (1 - \\lambda^2 T h)\n$$\n差值为：\n$$\n\\hat{\\Delta}_{\\ell} = \\hat{X}_{T}^{(\\ell)} - \\hat{X}_{T}^{(\\ell-1)} \\approx x_0 \\exp(-\\lambda T) \\left( \\left(1 - \\frac{\\lambda^2 T h}{2}\\right) - (1 - \\lambda^2 T h) \\right) = \\frac{1}{2}\\lambda^2 T h x_0 \\exp(-\\lambda T)\n$$\n差的平方，在 $h$ 的领头阶上为：\n$$\n\\hat{\\Delta}_{\\ell}^2 \\approx \\frac{1}{4} \\lambda^4 T^2 x_0^2 \\exp(-2\\lambda T) h^2\n$$\n\n2.  **随机部分：$\\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2]$**\n\n令 $s_m = S_{2m}^{(\\ell)} - S_m^{(\\ell-1)}$ 为在粗糙时间点 $t_m = m(2h)$ 处随机部分的差。\n$S_{2m+2}^{(\\ell)} = (1-\\lambda h)^2 S_{2m}^{(\\ell)} + \\sigma(1-\\lambda h)\\Delta W_{2m}^{(\\ell)} + \\sigma \\Delta W_{2m+1}^{(\\ell)}$。\n$S_{m+1}^{(\\ell-1)} = (1-2\\lambda h)S_{m}^{(\\ell-1)} + \\sigma \\Delta W_{m}^{(\\ell-1)} = (1-2\\lambda h)S_{m}^{(\\ell-1)} + \\sigma(\\Delta W_{2m}^{(\\ell)} + \\Delta W_{2m+1}^{(\\ell)})$。\n差 $s_{m+1} = S_{2m+2}^{(\\ell)} - S_{m+1}^{(\\ell-1)}$ 为：\n$$\ns_{m+1} = (1-\\lambda h)^2 S_{2m}^{(\\ell)} - (1-2\\lambda h)S_{m}^{(\\ell-1)} - \\sigma\\lambda h \\Delta W_{2m}^{(\\ell)}\n$$\n代入 $S_{2m}^{(\\ell)} = s_m + S_m^{(\\ell-1)}$：\n$$\ns_{m+1} = (1-\\lambda h)^2 (s_m + S_m^{(\\ell-1)}) - (1-2\\lambda h)S_{m}^{(\\ell-1)} - \\sigma\\lambda h \\Delta W_{2m}^{(\\ell)}\n$$\n$$\ns_{m+1} = \\left((1-\\lambda h)^2 - (1-2\\lambda h)\\right)S_{m}^{(\\ell-1)} + (1-\\lambda h)^2 s_m - \\sigma\\lambda h \\Delta W_{2m}^{(\\ell)}\n$$\n$$\ns_{m+1} = \\lambda^2 h^2 S_{m}^{(\\ell-1)} + (1-2\\lambda h+\\lambda^2 h^2) s_m - \\sigma\\lambda h \\Delta W_{2m}^{(\\ell)}\n$$\n令 $\\rho_h = 1-2\\lambda h+\\lambda^2 h^2$。此递推关系在 $s_0=0$ 时的解为：\n$$\ns_{N_{\\ell-1}} = \\sum_{m=0}^{N_{\\ell-1}-1} \\rho_h^{N_{\\ell-1}-1-m} \\left( \\lambda^2 h^2 S_{m}^{(\\ell-1)} - \\sigma \\lambda h \\Delta W_{2m}^{(\\ell)} \\right)\n$$\n由于 $\\mathbb{E}[s_{N_{\\ell-1}}]=0$，我们需要求方差 $\\mathbb{E}[s_{N_{\\ell-1}}^2] = \\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2]$。\n方差的计算涉及到对和求平方。对于不同的 $m$，增量 $\\Delta W_{2m}^{(\\ell)}$ 是独立的。同样，对于 $k \\ge m$，$S_m^{(\\ell-1)}$ 与 $\\Delta W_{2k}^{(\\ell)}$ 独立。期望中的交叉项将消失或为更高阶项。主要贡献来自涉及 $\\Delta W_{2m}^{(\\ell)}$ 的项，其阶为 $h^{3/2}$，而 $S_m^{(\\ell-1)}$ 项的阶为 $h^2$。\n领头阶为：\n$$\n\\tilde{\\Delta}_{\\ell} = s_{N_{\\ell-1}} \\approx \\sum_{m=0}^{N_{\\ell-1}-1} \\rho_h^{N_{\\ell-1}-1-m} (-\\sigma \\lambda h \\Delta W_{2m}^{(\\ell)})\n$$\n方差为：\n$$\n\\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2] \\approx \\mathbb{E}\\left[ \\left( \\sum_{m=0}^{N_{\\ell-1}-1} \\rho_h^{N_{\\ell-1}-1-m} (-\\sigma \\lambda h \\Delta W_{2m}^{(\\ell)}) \\right)^2 \\right]\n$$\n由于维纳增量的独立性，$\\mathbb{E}[\\Delta W_{2m}^{(\\ell)}\\Delta W_{2k}^{(\\ell)}] = h \\delta_{mk}$。\n$$\n\\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2] \\approx \\sum_{m=0}^{N_{\\ell-1}-1} (\\rho_h^{N_{\\ell-1}-1-m})^2 (-\\sigma \\lambda h)^2 \\mathbb{E}[(\\Delta W_{2m}^{(\\ell)})^2] = \\sigma^2 \\lambda^2 h^3 \\sum_{m=0}^{N_{\\ell-1}-1} \\rho_h^{2(N_{\\ell-1}-1-m)}\n$$\n令 $k = N_{\\ell-1}-1-m$。该和是一个几何级数 $\\sum_{k=0}^{N_{\\ell-1}-1} (\\rho_h^2)^k = \\frac{1-(\\rho_h^2)^{N_{\\ell-1}}}{1-\\rho_h^2}$。\n对于小 $h$：\n$1-\\rho_h^2 = 1-(1-2\\lambda h+\\lambda^2 h^2)^2 = 1-(1-4\\lambda h+O(h^2)) \\approx 4\\lambda h$。\n$(\\rho_h^2)^{N_{\\ell-1}} = ((1-2\\lambda h+\\lambda^2 h^2)^2)^{T/(2h)} \\approx (1-4\\lambda h)^{T/(2h)} \\to \\exp(-2\\lambda T)$ as $h \\to 0$。\n所以该和约为 $\\approx \\frac{1-\\exp(-2\\lambda T)}{4\\lambda h}$。\n将此代回方差表达式：\n$$\n\\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2] \\approx \\sigma^2 \\lambda^2 h^3 \\left( \\frac{1-\\exp(-2\\lambda T)}{4\\lambda h} \\right) = \\frac{\\sigma^2 \\lambda}{4}(1-\\exp(-2\\lambda T)) h^2\n$$\n\n3.  **总均方误差**\n结合这两个部分，得到总均方误差：\n$$\n\\mathbb{E}[\\Delta_{\\ell}^2] = \\hat{\\Delta}_{\\ell}^2 + \\mathbb{E}[\\tilde{\\Delta}_{\\ell}^2] \\approx \\frac{1}{4} \\lambda^4 T^2 x_0^2 \\exp(-2\\lambda T) h^2 + \\frac{\\sigma^2 \\lambda}{4}(1-\\exp(-2\\lambda T)) h^2\n$$\n$$\n\\mathbb{E}[\\Delta_{\\ell}^2] \\approx \\left( \\frac{1}{4} \\lambda^4 T^2 x_0^2 \\exp(-2\\lambda T) + \\frac{\\sigma^2 \\lambda}{4}(1-\\exp(-2\\lambda T)) \\right) h^2\n$$\n通过将其与给定的渐近形式 $\\mathbb{E}[\\Delta_{\\ell}^2] \\approx C h^2$ 进行比较，我们可以确定常数 $C$。\n\n$$\nC = \\frac{1}{4} \\lambda^4 T^2 x_0^2 \\exp(-2\\lambda T) + \\frac{\\sigma^2 \\lambda}{4}(1-\\exp(-2\\lambda T))\n$$\n该表达式可以重新整理为：\n$$\nC = \\frac{\\lambda}{4} \\left( \\lambda^3 T^2 x_0^2 \\exp(-2\\lambda T) + \\sigma^2 (1-\\exp(-2\\lambda T)) \\right)\n$$",
            "answer": "$$\\boxed{\\frac{1}{4} \\lambda^4 T^2 x_{0}^{2} \\exp(-2\\lambda T) + \\frac{\\sigma^2 \\lambda}{4} (1-\\exp(-2\\lambda T))}$$"
        },
        {
            "introduction": "将理论付诸实践需要一套可靠的诊断工具来验证我们的假设。本练习挑战你像从业者一样思考，在进行大规模模拟之前，设计一套必要的经验性检查流程。它强调了验证方差衰减率和随机截断分布选择的正确性，这是确保无偏估计量有效性和可靠性的关键步骤。",
            "id": "3358899",
            "problem": "您正在使用多层伸缩求和上的随机化来设计一个无偏估计量。设 $\\{Y_\\ell\\}_{\\ell \\ge 0}$ 表示对目标量 $\\mu = \\mathbb{E}[f(X)]$ 的一系列有偏近似，其中层级 $\\ell$ 的计算成本为 $c_\\ell$，其构造方式使得耦合模拟器允许您形成增量 $\\Delta_\\ell := G_\\ell - G_{\\ell-1}$ (对于 $\\ell \\ge 1$) 和 $\\Delta_0 := G_0$，其中 $G_\\ell$ 是层级 $\\ell$ 模拟器的输出。设 $L$ 是一个非负整数值的随机截断层级，其分布为 $W$，尾部概率为 $p_\\ell := \\mathbb{P}(L \\ge \\ell)$。考虑无偏和估计量\n$$\nZ := \\sum_{\\ell=0}^{L} \\frac{\\Delta_\\ell}{p_\\ell},\n$$\n要求 $L$ 独立于用于构造 $\\{\\Delta_\\ell\\}_{\\ell \\ge 0}$ 的随机性。在运行大规模蒙特卡洛 (MC) 模拟之前，您希望经验性地诊断二阶矩 $\\mathbb{E}[\\Delta_\\ell^2]$ 是否随 $\\ell$ 充分衰减，以及所选的截断分布 $W$ 是否合适。\n\n在多层耦合范式下，$Z$ 的二阶矩有限的一个关键充分条件是级数 $\\sum_{\\ell \\ge 0} \\mathbb{E}[\\Delta_\\ell^2]/p_\\ell$ 收敛，并且由耦合引起的跨层级依赖不会产生爆炸性的交叉项。在许多实际情境中，当耦合较强时，我们期望 $\\mathbb{E}[\\Delta_\\ell^2]$ 随 $\\ell$ 近似几何衰减。\n\n在进行大规模无偏模拟之前，以下哪些经验性程序是评估 $\\mathbb{E}[\\Delta_\\ell^2]$ 衰减并验证截断分布 $W$ 选择的有原则的诊断方法？选择所有适用的选项。\n\nA. 在层级 $\\ell \\in \\{0,1,\\dots,\\ell_{\\max}\\}$ 上运行一个短暂的耦合试验，收集 $\\Delta_\\ell$ 的独立复制样本，计算样本二阶矩 $\\hat{v}_\\ell := \\frac{1}{n_\\ell}\\sum_{i=1}^{n_\\ell} \\Delta_{\\ell,i}^2$，并拟合 $\\log \\hat{v}_\\ell$ 相对于 $\\ell$ 的线性模型来估计几何衰减率。使用这个估计出的率来选择具有几何尾部 $p_\\ell \\propto r^{-\\ell}$ 的 $p_\\ell$，使其衰减速度不快于 $\\hat{v}_\\ell$，并数值验证当 $\\ell_{\\max}$ 增长时 $\\sum_{\\ell=0}^{\\ell_{\\max}} \\hat{v}_\\ell/p_\\ell$ 表现出稳定性。\n\nB. 生成 $L \\sim W$ 的独立样本，并验证事件 $\\{L \\ge \\ell\\}$ 的经验频率 $\\hat{p}_\\ell$ 在试验所用 $\\ell$ 的范围内近似于设计的 $p_\\ell$。此外，计算权重 $w_\\ell := 1/p_\\ell$ 在 $L$ 的支撑集上的经验变异系数 (CV)，并确保其不会过大，这表明罕见的大 $\\ell$ 值不会贡献爆炸性的权重。\n\nC. 对试验中的每个 $\\Delta_\\ell$ 应用 Kolmogorov–Smirnov (KS) 正态性检验，并且只有当 $\\Delta_\\ell$ 表现为近似高斯分布时才接受 $W$，理由是高斯性确保了样本方差能可靠地估计 $\\mathbb{E}[\\Delta_\\ell^2]$。\n\nD. 在用于定义 $\\Delta_\\ell$ 的耦合下，计算 $G_\\ell$ 和 $G_{\\ell-1}$ 之间的经验相关性 $\\rho_\\ell$。要求对于中等大小的 $\\ell$，$\\rho_\\ell$ 接近 $1$，以此作为强耦合质量的代理指标，并用它来预期 $\\mathbb{E}[\\Delta_\\ell^2]$ 的更快衰减。\n\nE. 选择 $W$ 使得 $p_\\ell \\propto c_\\ell^{-1}$ 以均衡每个层级的期望计算工作量，忽略 $\\mathbb{E}[\\Delta_\\ell^2]$ 的行为，因为在实践中成本是主要约束。\n\nF. 在至少两种不同的截断分布 $W$ 和 $W'$ 下，使用正确的权重 $\\{1/p_\\ell\\}$ 和 $\\{1/p'_\\ell\\}$，构造试验性无偏估计 $Z$。检查在不同 $W$ 选择下，$Z$ 的经验均值在蒙特卡洛误差范围内是否一致。系统性差异表明 $L$ 和 $\\{\\Delta_\\ell\\}$ 之间存在依赖性或权重实现不正确，从而使该方案无效。\n\n答案选项可能包含多个正确选择。在首次使用时定义任何缩略词：蒙特卡洛 (MC)、变异系数 (CV)、Kolmogorov–Smirnov (KS)。",
            "solution": "从多层伸缩求和的核心无偏随机化原理开始。设 $\\{\\Delta_\\ell\\}_{\\ell \\ge 0}$ 是耦合增量，且 $L$ 独立于 $\\{\\Delta_\\ell\\}_{\\ell \\ge 0}$，其尾部概率为 $p_\\ell := \\mathbb{P}(L \\ge \\ell)$。估计量\n$$\nZ := \\sum_{\\ell=0}^{L} \\frac{\\Delta_\\ell}{p_\\ell}\n$$\n在控制收敛和独立性条件下，是 $\\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell]$ 的无偏估计，因为\n$$\n\\mathbb{E}[Z] = \\sum_{\\ell=0}^{\\infty} \\mathbb{E}\\left[ \\frac{\\Delta_\\ell \\, \\mathbf{1}\\{L \\ge \\ell\\}}{p_\\ell} \\right]\n= \\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell] \\, \\frac{\\mathbb{P}(L \\ge \\ell)}{p_\\ell}\n= \\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell].\n$$\n在适当的伸缩构造下，$\\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell] = \\mu$。为了使二阶矩有限（从而方差有限），一个充分的经验条件是\n$$\n\\sum_{\\ell=0}^{\\infty} \\frac{\\mathbb{E}[\\Delta_\\ell^2]}{p_\\ell}  \\infty,\n$$\n并且由耦合引起的跨层级协方差项不会导致发散。更精确地说，通过展开 $Z^2$，\n$$\n\\mathbb{E}[Z^2] = \\sum_{\\ell=0}^{\\infty} \\frac{\\mathbb{E}\\left[\\Delta_\\ell^2 \\, \\mathbf{1}\\{L \\ge \\ell\\}\\right]}{p_\\ell^2}\n+ 2 \\sum_{0 \\le j  k  \\infty} \\frac{\\mathbb{E}\\left[\\Delta_j \\Delta_k \\, \\mathbf{1}\\{L \\ge k\\}\\right]}{p_j p_k}.\n$$\n利用 $L$ 和 $\\{\\Delta_\\ell\\}$ 之间的独立性，$\\mathbb{E}\\left[\\Delta_\\ell^2 \\, \\mathbf{1}\\{L \\ge \\ell\\}\\right] = p_\\ell \\, \\mathbb{E}[\\Delta_\\ell^2]$，所以第一项的和变为 $\\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell^2]/p_\\ell$。在典型的衰减和耦合假设下，交叉项和可以用相同的尾部结构来界定。例如，对于几何衰减 $\\mathbb{E}[\\Delta_\\ell^2] \\approx C r^{-\\ell}$（其中 $C > 0$ 和 $r > 1$），选择具有几何尾部 $p_\\ell \\propto s^{-\\ell}$ 且 $s  r$ 的 $p_\\ell$ 可确保对角贡献 $\\sum_{\\ell=0}^{\\infty} \\mathbb{E}[\\Delta_\\ell^2]/p_\\ell \\approx \\sum_{\\ell=0}^{\\infty} (r/s)^{-\\ell}$ 收敛。强耦合通常使得交叉项可忽略不计或至少是可求和的，但这必须通过经验性地检验。\n\n因此，诊断方法应包括：估计 $\\mathbb{E}[\\Delta_\\ell^2]$ 的衰减率；验证所实现的 $W$ 的尾部行为；评估耦合质量；以及对无偏性和权重实现进行合理性检查。我们现在分析每个选项。\n\n选项 A：所提出的试验计算 $\\hat{v}_\\ell := \\frac{1}{n_\\ell} \\sum_{i=1}^{n_\\ell} \\Delta_{\\ell,i}^2$，并拟合 $\\log \\hat{v}_\\ell$ 相对于 $\\ell$。如果 $\\hat{v}_\\ell$ 在对数尺度上近似线性衰减，这表明存在几何衰减 $\\hat{v}_\\ell \\approx \\hat{C} \\hat{r}^{-\\ell}$，并且可以选择 $p_\\ell \\propto \\hat{s}^{-\\ell}$ 且 $\\hat{s}  \\hat{r}$ 以保持 $\\sum \\hat{v}_\\ell/p_\\ell$ 有限。计算部分和 $\\sum_{\\ell=0}^{\\ell_{\\max}} \\hat{v}_\\ell/p_\\ell$ 并验证当 $\\ell_{\\max}$ 增长时其稳定性，是充分条件 $\\sum \\mathbb{E}[\\Delta_\\ell^2]/p_\\ell  \\infty$ 的一个直接的经验代理指标。这个程序针对了正确的目标量（二阶矩），使用了保持独立性的试验，并将衰减与一个有原则的尾部选择联系起来。结论：正确。\n\n选项 B：独立地从 $L \\sim W$ 中抽样并验证经验尾部概率 $\\hat{p}_\\ell$ 与 $p_\\ell$ 匹配，是对所实现的截断分布在感兴趣的范围内是正确的直接验证。计算权重 $w_\\ell := 1/p_\\ell$ 在实现支撑集上的变异系数 (CV) 有助于检测产生过大权重的重尾；这种爆炸性的权重会通过对角项和交叉项的贡献放大方差。虽然仅凭 CV 不能保证方差有限，但结合对 $\\mathbb{E}[\\Delta_\\ell^2]$ 的衰减评估，它是一个合理的压力测试，以避免病态的尾部。结论：正确。\n\n选项 C：$\\Delta_\\ell$ 的正态性既不是必需的，也没有特别的信息价值。在温和的条件下（例如，有限四阶矩），样本二阶矩 $\\hat{v}_\\ell$ 是 $\\mathbb{E}[\\Delta_\\ell^2]$ 的一致估计量，而与分布的形状无关。Kolmogorov–Smirnov (KS) 正态性检验可能会因为形状上的特殊性而拒绝或接受，但它没有解决 $\\hat{v}_\\ell$ 是否随 $\\ell$ 衰减或 $\\sum \\hat{v}_\\ell/p_\\ell$ 是否有限的问题。将接受 $W$ 的条件建立在高斯性之上是一种误导性的诊断方法。结论：不正确。\n\n选项 D：增量 $\\Delta_\\ell = G_\\ell - G_{\\ell-1}$ 受益于 $G_\\ell$ 和 $G_{\\ell-1}$ 之间的强耦合。接近 1 的高经验相关性 $\\rho_\\ell$ 表明 $G_\\ell$ 和 $G_{\\ell-1}$ 的波动是一致的，使得 $\\Delta_\\ell$ 较小，从而促进 $\\mathbb{E}[\\Delta_\\ell^2]$ 的更快衰减。尽管相关性是一个代理指标，并不直接估计 $\\mathbb{E}[\\Delta_\\ell^2]$，但它是一个有原则的耦合质量定性诊断方法，特别是与定量的方差衰减估计相结合时。结论：正确。\n\n选项 E：仅基于计算成本 $c_\\ell$ 选择 $W$，使得 $p_\\ell \\propto c_\\ell^{-1}$，忽略了 $\\mathbb{E}[\\Delta_\\ell^2]$ 的行为。如果 $p_\\ell$ 相对于 $\\mathbb{E}[\\Delta_\\ell^2]$ 的衰减速度过快，级数 $\\sum \\mathbb{E}[\\Delta_\\ell^2]/p_\\ell$ 可能会发散，导致无穷大方差。即使方差有限，这种选择在单位成本的方差方面也可能远非最优。因此，仅考虑成本的选择对于方差控制和截断验证来说不是一个有效的诊断方法。结论：不正确。\n\n选项 F：在至少两种不同的截断分布 $W$ 和 $W'$ 下，使用正确实现的权重 $\\{1/p_\\ell\\}$ 和 $\\{1/p'_\\ell\\}$ 构造试验性无偏估计 $Z$，应该产生相同的期望值 $\\mu$。如果 $W$ 和 $W'$ 下的经验试验均值的差异超出了蒙特卡洛误差，这表明违反了 $L$ 和 $\\{\\Delta_\\ell\\}$ 之间的独立性要求或存在权重或截断逻辑的实现错误。这是对无偏性和正确 $W$ 实现的直接经验性检查，并且它间接验证了对推导至关重要的独立性假设。结论：正确。\n\n总结：选项 A、B、D 和 F 是有原则的诊断方法；选项 C 和 E 与必要的方差衰减评估和截断验证不一致。",
            "answer": "$$\\boxed{ABDF}$$"
        },
        {
            "introduction": "计算方法的最终目标之一是效率。在正确构建和诊断了无偏估计量之后，下一步是调整其参数以获得最佳性能。本练习将指导你通过选择最优的随机化策略，来最小化“功-方差乘积”，这是一个衡量估计量效率的关键指标。",
            "id": "3358913",
            "problem": "考虑一个由伸缩求和产生的层级差异序列的无偏去偏构造。设 $\\{\\Delta_{\\ell}\\}_{\\ell \\ge 0}$ 表示无偏层级增量，其独立的蒙特卡洛实现为 $\\{\\widehat{\\Delta}_{\\ell}\\}_{\\ell \\ge 0}$，对于所有 $\\ell \\ge 0$ 满足方差模型 $\\mathrm{Var}(\\widehat{\\Delta}_{\\ell}) = c \\, 2^{-\\kappa \\ell}$，其中 $c \\in (0,\\infty)$ 且 $\\kappa \\in (0,\\infty)$。假设生成一个 $\\widehat{\\Delta}_{\\ell}$ 实现的计算成本为 $a \\, 2^{\\gamma \\ell}$，其中 $a \\in (0,\\infty)$ 且 $\\gamma \\in (0,\\infty)$。令 $L$ 为一个非负整数值的随机截断层级，它与 $\\widehat{\\Delta}_{\\ell}$ 无关，并定义了耦合和无偏估计量\n$$\nY \\;=\\; \\sum_{\\ell = 0}^{L} \\frac{\\widehat{\\Delta}_{\\ell}}{q_{\\ell}},\n$$\n其中 $q_{\\ell} \\equiv \\mathbb{P}(L \\ge \\ell)$ 是尾部概率。假设选择的截断具有几何重尾，即 $q_{\\ell} = 2^{- r \\ell}$，对于某个参数 $r \\in (0,\\infty)$ 且 $q_{0} = 1$。假设 $\\{\\widehat{\\Delta}_{\\ell}\\}_{\\ell \\ge 0}$ 在不同 $\\ell$ 之间是独立的，并且与 $L$ 无关，且 $\\mathrm{Var}(Y) = \\sum_{\\ell \\ge 0} \\mathrm{Var}(\\widehat{\\Delta}_{\\ell}) / q_{\\ell}$ 以及 $\\mathbb{E}[\\mathrm{Work}] = \\sum_{\\ell \\ge 0} q_{\\ell} \\, a \\, 2^{\\gamma \\ell}$。定义功-方差乘积\n$$\n\\Pi(r) \\;\\equiv\\; \\mathrm{Var}(Y) \\times \\mathbb{E}[\\mathrm{Work}] \\, .\n$$\n假设 $\\kappa > \\gamma$，从而可以实现有限方差和有限功的机制。确定使 $\\Pi(r)$ 在 $r \\in (\\gamma,\\kappa)$ 上最小化的值 $r^{\\star}$，并以 $a$、$c$、$\\kappa$ 和 $\\gamma$ 的函数形式，推导出相应的最小化乘积 $\\Pi^{\\star} \\equiv \\Pi(r^{\\star})$ 的闭式解。将您的最终答案表示为一个行向量，按顺序包含 $r^{\\star}$ 和 $\\Pi^{\\star}$，作为一个单一的解析表达式。不需要四舍五入。",
            "solution": "用户要求我找到最小化功-方差乘积 $\\Pi(r)$ 的最优参数 $r^{\\star}$，并确定相应的最小值 $\\Pi^{\\star}$。\n\n功-方差乘积定义为 $\\Pi(r) = \\mathrm{Var}(Y) \\times \\mathbb{E}[\\mathrm{Work}]$。首先，我们必须将方差 $\\mathrm{Var}(Y)$ 和期望功 $\\mathbb{E}[\\mathrm{Work}]$ 这两个因子表示为参数 $r$ 的函数。\n\n估计量 $Y$ 的方差由公式 $\\mathrm{Var}(Y) = \\sum_{\\ell = 0}^{\\infty} \\frac{\\mathrm{Var}(\\widehat{\\Delta}_{\\ell})}{q_{\\ell}}$ 给出。我们已知方差模型 $\\mathrm{Var}(\\widehat{\\Delta}_{\\ell}) = c \\, 2^{-\\kappa \\ell}$ 和尾部概率 $q_{\\ell} = 2^{-r \\ell}$。将这些代入 $\\mathrm{Var}(Y)$ 的公式，得到：\n$$\n\\mathrm{Var}(Y) = \\sum_{\\ell = 0}^{\\infty} \\frac{c \\, 2^{-\\kappa \\ell}}{2^{-r \\ell}} = c \\sum_{\\ell = 0}^{\\infty} 2^{(r - \\kappa)\\ell} = c \\sum_{\\ell = 0}^{\\infty} (2^{r - \\kappa})^{\\ell}\n$$\n这是一个公比为 $2^{r-\\kappa}$ 的几何级数。为使级数收敛，其公比的绝对值必须小于 $1$。由于 $2^{r-\\kappa} > 0$，这要求 $2^{r-\\kappa}  1$，等价于 $r - \\kappa  0$，即 $r  \\kappa$。问题指定了我们优化的范围是 $r \\in (\\gamma, \\kappa)$，因此该条件得到满足。级数的和为 $\\frac{1}{1 - \\text{公比}}$。因此，方差为：\n$$\n\\mathrm{Var}(Y) = c \\left( \\frac{1}{1 - 2^{r - \\kappa}} \\right)\n$$\n\n期望计算功由 $\\mathbb{E}[\\mathrm{Work}] = \\sum_{\\ell = 0}^{\\infty} q_{\\ell} \\, a \\, 2^{\\gamma \\ell}$ 给出。我们代入 $q_{\\ell} = 2^{-r \\ell}$ 并使用给定的每层成本 $a \\, 2^{\\gamma \\ell}$：\n$$\n\\mathbb{E}[\\mathrm{Work}] = \\sum_{\\ell = 0}^{\\infty} (2^{-r \\ell}) (a \\, 2^{\\gamma \\ell}) = a \\sum_{\\ell = 0}^{\\infty} 2^{(\\gamma - r)\\ell} = a \\sum_{\\ell = 0}^{\\infty} (2^{\\gamma - r})^{\\ell}\n$$\n这是另一个几何级数，公比为 $2^{\\gamma-r}$。为使其收敛，我们需要 $2^{\\gamma-r}  1$，这意味着 $\\gamma - r  0$，即 $r > \\gamma$。对于 $r \\in (\\gamma, \\kappa)$，此条件也得到满足。该级数的和为：\n$$\n\\mathbb{E}[\\mathrm{Work}] = a \\left( \\frac{1}{1 - 2^{\\gamma - r}} \\right)\n$$\n\n现在，我们可以通过将方差和期望功的表达式相乘来写出功-方差乘积 $\\Pi(r)$：\n$$\n\\Pi(r) = \\left( c \\frac{1}{1 - 2^{r - \\kappa}} \\right) \\left( a \\frac{1}{1 - 2^{\\gamma - r}} \\right) = \\frac{ac}{(1 - 2^{r - \\kappa})(1 - 2^{\\gamma - r})}\n$$\n为了找到最小化 $\\Pi(r)$ 的值 $r^{\\star}$，我们计算它关于 $r$ 的导数并将其设为 $0$。为了简化求导，我们可以处理 $\\Pi(r)$ 的自然对数，因为 $\\ln(x)$ 是一个单调递增函数，其最小值点与 $x$ 的最小值点相同。\n$$\n\\ln(\\Pi(r)) = \\ln(ac) - \\ln(1 - 2^{r - \\kappa}) - \\ln(1 - 2^{\\gamma - r})\n$$\n关于 $r$ 求导：\n$$\n\\frac{d}{dr}\\ln(\\Pi(r)) = 0 - \\frac{-2^{r - \\kappa} \\ln(2)}{1 - 2^{r - \\kappa}} - \\frac{-(-2^{\\gamma - r} \\ln(2))}{1 - 2^{\\gamma - r}} = \\frac{2^{r - \\kappa} \\ln(2)}{1 - 2^{r - \\kappa}} - \\frac{2^{\\gamma - r} \\ln(2)}{1 - 2^{\\gamma - r}}\n$$\n将导数设为 $0$ 以找到临界点 $r^{\\star}$：\n$$\n\\frac{2^{r^{\\star} - \\kappa} \\ln(2)}{1 - 2^{r^{\\star} - \\kappa}} = \\frac{2^{\\gamma - r^{\\star}} \\ln(2)}{1 - 2^{\\gamma - r^{\\star}}}\n$$\n由于 $\\ln(2) \\neq 0$，我们可以将其约掉：\n$$\n\\frac{2^{r^{\\star} - \\kappa}}{1 - 2^{r^{\\star} - \\kappa}} = \\frac{2^{\\gamma - r^{\\star}}}{1 - 2^{\\gamma - r^{\\star}}}\n$$\n函数 $f(x) = \\frac{x}{1-x}$ 在其定义域上是严格递增的。对于 $r \\in (\\gamma, \\kappa)$，两个自变量 $2^{r-\\kappa}$ 和 $2^{\\gamma-r}$ 都在区间 $(0,1)$ 内。因此，对于 $f(x_1) = f(x_2)$，我们必须有 $x_1=x_2$。将此应用于我们的方程：\n$$\n2^{r^{\\star} - \\kappa} = 2^{\\gamma - r^{\\star}}\n$$\n由于底数是 $2$，我们可以令指数相等：\n$$\nr^{\\star} - \\kappa = \\gamma - r^{\\star} \\implies 2r^{\\star} = \\gamma + \\kappa \\implies r^{\\star} = \\frac{\\gamma + \\kappa}{2}\n$$\n这个临界点 $r^{\\star}$ 确实在指定的定义域 $(\\gamma, \\kappa)$ 内，因为 $\\gamma  \\kappa$ 意味着 $\\gamma = \\frac{\\gamma+\\gamma}{2}  \\frac{\\gamma+\\kappa}{2}  \\frac{\\kappa+\\kappa}{2} = \\kappa$。$\\ln(\\Pi(r))$ 的二阶导数在定义域上为正，证实了 $\\ln(\\Pi(r))$ 是一个凸函数，且 $r^{\\star}$ 是唯一的极小值点。\n\n最后，我们通过将 $r^{\\star}$ 代回 $\\Pi(r)$ 的表达式来计算最小化乘积 $\\Pi^{\\star} = \\Pi(r^{\\star})$：\n$$\n\\Pi^{\\star} = \\Pi\\left(\\frac{\\gamma + \\kappa}{2}\\right) = \\frac{ac}{\\left(1 - 2^{\\frac{\\gamma + \\kappa}{2} - \\kappa}\\right)\\left(1 - 2^{\\gamma - \\frac{\\gamma + \\kappa}{2}}\\right)}\n$$\n指数简化为：\n$$\n\\frac{\\gamma + \\kappa}{2} - \\kappa = \\frac{\\gamma - \\kappa}{2}\n$$\n$$\n\\gamma - \\frac{\\gamma + \\kappa}{2} = \\frac{\\gamma - \\kappa}{2}\n$$\n分母中的两项是相同的。因此，\n$$\n\\Pi^{\\star} = \\frac{ac}{\\left(1 - 2^{\\frac{\\gamma - \\kappa}{2}}\\right)\\left(1 - 2^{\\frac{\\gamma - \\kappa}{2}}\\right)} = \\frac{ac}{\\left(1 - 2^{\\frac{\\gamma - \\kappa}{2}}\\right)^2}\n$$\n最优参数是 $r^{\\star} = \\frac{\\gamma + \\kappa}{2}$，最小功-方差乘积是 $\\Pi^{\\star} = \\frac{ac}{(1 - 2^{(\\gamma - \\kappa)/2})^2}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\gamma + \\kappa}{2}  \\frac{ac}{\\left(1 - 2^{\\frac{\\gamma - \\kappa}{2}}\\right)^2}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}