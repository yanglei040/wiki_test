{
    "hands_on_practices": [
        {
            "introduction": "我们从最基本的层面开始审视 Euler-Maruyama 格式：单个时间步。这个练习要求你将单步 EM 格式后的状态均值和协方差，与真实解的矩在对步长 $h$ 进行一阶展开后进行比较 。通过直接计算这种差异，你将揭示局部误差的来源和阶数，为理解误差如何随时间累积奠定关键基础。",
            "id": "3352555",
            "problem": "考虑二维线性随机微分方程 (SDE)\n$$\ndX_{t} \\;=\\; A X_{t}\\, dt \\;+\\; b\\, dt \\;+\\; B\\, dW_{t},\n$$\n其中 $X_{t} \\in \\mathbb{R}^{2}$ 是状态， $A \\in \\mathbb{R}^{2 \\times 2}$ 是漂移雅可比矩阵， $b \\in \\mathbb{R}^{2}$ 是常数漂移向量， $B \\in \\mathbb{R}^{2 \\times 2}$ 是扩散矩阵， $W_{t} \\in \\mathbb{R}^{2}$ 是一个具有独立分量的二维标准维纳过程（布朗运动）。假设初始条件 $X_{0}$ 是高斯分布 $X_{0} \\sim \\mathcal{N}(m_{0}, \\Sigma_{0})$，且独立于 $W_{t}$。步长为 $h$ 的欧拉-丸山 (Euler–Maruyama, EM) 格式定义为\n$$\nX_{1} \\;=\\; X_{0} \\;+\\; \\big(A X_{0} + b\\big)\\, h \\;+\\; B\\, \\Delta W,\n$$\n其中 $\\Delta W \\sim \\mathcal{N}(0, h I_{2})$ 独立于 $X_{0}$， $I_{2}$ 是 $2 \\times 2$ 的单位矩阵。设系统参数为\n$$\nA \\;=\\; \\begin{pmatrix} -1.2  0.8 \\\\ -2.0  -0.5 \\end{pmatrix}, \\quad\nb \\;=\\; \\begin{pmatrix} 0.05 \\\\ -0.08 \\end{pmatrix}, \\quad\nB \\;=\\; \\begin{pmatrix} 0.6  0.3 \\\\ 0.1  0.7 \\end{pmatrix},\n$$\n初始均值和协方差为\n$$\nm_{0} \\;=\\; \\begin{pmatrix} 0.4 \\\\ -0.2 \\end{pmatrix}, \\quad\n\\Sigma_{0} \\;=\\; \\begin{pmatrix} 0.5  0.15 \\\\ 0.15  0.4 \\end{pmatrix},\n$$\n步长 $h = 0.02$。\n\n使用线性 SDE 和伊藤积分 (Itô calculus) 的第一性原理，完成以下任务：\n\n1. 推导在时间 $t = h$ 时，均值向量 $m_{\\text{exact}}(h)$ 和协方差矩阵 $\\Sigma_{\\text{exact}}(h)$ 的精确短时展开（到 $h$ 的一阶），用 $A$、$b$、$B$、$m_{0}$ 和 $\\Sigma_{0}$ 表示。除了期望、协方差和伊藤乘积法则的定义外，不要假设任何解的公式。\n\n2. 推导单步欧拉-丸山均值 $m_{\\text{EM}}$ 和协方差 $\\Sigma_{\\text{EM}}$，用 $A$、$b$、$B$、$m_{0}$、$\\Sigma_{0}$ 和 $h$ 表示。\n\n3. 对给定的参数，数值计算 $m_{\\text{EM}}$ 和 $\\Sigma_{\\text{EM}}$，并写出第1部分中相应的精确短时均值和协方差。\n\n4. 比较 $\\Sigma_{\\text{EM}}$ 与 $\\Sigma_{\\text{exact}}(h)$，并计算标量\n$$\n\\operatorname{tr}\\!\\big(\\Sigma_{\\text{EM}} - \\Sigma_{\\text{exact}}(h)\\big),\n$$\n其中 $\\operatorname{tr}(\\cdot)$ 表示迹。将最终答案表示为单个实数。将最终答案四舍五入到四位有效数字。",
            "solution": "首先对问题进行严格的验证过程。\n\n### 步骤1：提取已知条件\n问题提供了以下信息：\n- 一个二维线性随机微分方程 (SDE)：$dX_{t} = (A X_{t} + b) dt + B dW_{t}$，其中 $X_{t} \\in \\mathbb{R}^{2}$，$W_{t} \\in \\mathbb{R}^{2}$ 是一个标准维纳过程。\n- 初始条件：$X_{0} \\sim \\mathcal{N}(m_{0}, \\Sigma_{0})$，独立于 $W_{t}$。\n- 步长为 $h$ 的欧拉-丸山 (EM) 格式：$X_{1} = X_{0} + (A X_{0} + b) h + B \\Delta W$，其中 $\\Delta W \\sim \\mathcal{N}(0, h I_{2})$ 独立于 $X_{0}$。\n- 漂移雅可比矩阵：$A = \\begin{pmatrix} -1.2  0.8 \\\\ -2.0  -0.5 \\end{pmatrix}$。\n- 常数漂移向量：$b = \\begin{pmatrix} 0.05 \\\\ -0.08 \\end{pmatrix}$。\n- 扩散矩阵：$B = \\begin{pmatrix} 0.6  0.3 \\\\ 0.1  0.7 \\end{pmatrix}$。\n- 初始均值向量：$m_{0} = \\begin{pmatrix} 0.4 \\\\ -0.2 \\end{pmatrix}$。\n- 初始协方差矩阵：$\\Sigma_{0} = \\begin{pmatrix} 0.5  0.15 \\\\ 0.15  0.4 \\end{pmatrix}$。\n- 步长：$h = 0.02$。\n- 任务是推导和比较精确解（到一阶）和EM格式的均值和协方差，并计算 $\\operatorname{tr}(\\Sigma_{\\text{EM}} - \\Sigma_{\\text{exact}}(h))$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 这个问题是随机微分方程数值分析领域的一个标准练习。它涉及线性SDE、维纳过程、高斯分布和欧拉-丸山法等成熟概念。所有原理都植根于随机微积分，并且在事实上是正确的。\n- **适定性：** 问题陈述清晰，提供了所有必要的参数和定义。它要求进行特定的推导和数值计算，从而得到一个唯一且有意义的解。\n- **客观性：** 问题以精确的数学语言表达，没有任何主观性或歧义。\n- **完整性和一致性：** 问题是自洽的。所有给定的矩阵和参数都具有兼容的维度。设置中没有矛盾之处。\n- **未检测到其他缺陷。** 问题是可形式化的、相关的、现实的且非平凡的。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n---\n\n### 第1部分：精确短时展开\n我们推导精确均值 $m(t) = E[X_t]$ 和协方差 $\\Sigma(t) = \\operatorname{Cov}(X_t)$ 的演化方程。\n对SDE取期望，并使用 $E[dW_t] = 0$：\n$$\ndE[X_t] = E[(A X_t + b) dt + B dW_t] = (A E[X_t] + b) dt\n$$\n这给出了均值向量的常微分方程 (ODE)：\n$$\n\\frac{dm(t)}{dt} = A m(t) + b\n$$\n对于一个短时间间隔 $h$，我们可以使用在 $t=0$ 附近的一阶泰勒展开来近似 $m(h)$：\n$$\nm_{\\text{exact}}(h) \\approx m(0) + h \\frac{dm}{dt}\\bigg|_{t=0} = m_0 + h (A m_0 + b)\n$$\n这就是均值的一阶展开。\n\n对于协方差，我们首先推导其控制ODE。协方差是 $\\Sigma(t) = E[(X_t - m(t))(X_t - m(t))^T]$。让我们首先找到二阶矩 $M_2(t) = E[X_t X_t^T]$ 的ODE。对 $X_t X_t^T$ 使用伊藤乘积法则：\n$$\nd(X_t X_t^T) = (dX_t)X_t^T + X_t(dX_t)^T + (dX_t)(dX_t)^T\n$$\n二次变差项是 $(dX_t)(dX_t)^T = (B dW_t)(B dW_t)^T = B (dW_t dW_t^T) B^T = B (I_2 dt) B^T = BB^T dt$。\n代入 $dX_t$ 并取期望：\n$$\ndE[X_t X_t^T] = E[(AX_t + b)X_t^T dt + X_t(AX_t + b)^T dt + BB^T dt]\n$$\n注意到随机积分项的期望为零，我们得到 $M_2(t)$ 的ODE：\n$$\n\\frac{dM_2(t)}{dt} = A M_2(t) + b m(t)^T + M_2(t) A^T + m(t) b^T + BB^T\n$$\n现在，由于 $\\Sigma(t) = M_2(t) - m(t)m(t)^T$，我们有 $\\frac{d\\Sigma}{dt} = \\frac{dM_2}{dt} - \\frac{d(mm^T)}{dt}$。\n$$\n\\frac{d(mm^T)}{dt} = \\frac{dm}{dt}m^T + m\\frac{dm^T}{dt} = (Am+b)m^T + m(Am+b)^T = Amm^T + bm^T + mm^TA^T + mb^T\n$$\n从 $M_2(t)$ 的ODE中减去此式：\n$$\n\\frac{d\\Sigma}{dt} = A(M_2 - mm^T) + (M_2 - mm^T)A^T + BB^T = A\\Sigma + \\Sigma A^T + BB^T\n$$\n这是协方差矩阵的李雅普诺夫 (Lyapunov) 微分方程。\n$\\Sigma(h)$ 在 $t=0$ 附近的一阶泰勒展开是：\n$$\n\\Sigma_{\\text{exact}}(h) \\approx \\Sigma(0) + h \\frac{d\\Sigma}{dt}\\bigg|_{t=0} = \\Sigma_0 + h(A\\Sigma_0 + \\Sigma_0 A^T + BB^T)\n$$\n\n### 第2部分：欧拉-丸山均值和协方差\n单步欧拉-丸山近似由下式给出：\n$$\nX_1 = X_0 + (A X_0 + b)h + B\\Delta W = (I_2 + Ah)X_0 + bh + B\\Delta W\n$$\n$X_1$ 的均值，记为 $m_{\\text{EM}}$，通过取期望得到。已知 $E[X_0] = m_0$ 且 $E[\\Delta W] = 0$：\n$$\nm_{\\text{EM}} = E[X_1] = E[(I_2 + Ah)X_0 + bh + B\\Delta W] = (I_2 + Ah)E[X_0] + bh + B E[\\Delta W]\n$$\n$$\nm_{\\text{EM}} = (I_2 + Ah)m_0 + bh = m_0 + (Am_0 + b)h\n$$\n$X_1$ 的协方差，记为 $\\Sigma_{\\text{EM}}$，是 $\\operatorname{Cov}(X_1) = E[(X_1 - m_{\\text{EM}})(X_1 - m_{\\text{EM}})^T]$。\n首先，我们求出与均值的偏差：\n$$\nX_1 - m_{\\text{EM}} = ((I_2 + Ah)X_0 + bh + B\\Delta W) - ((I_2 + Ah)m_0 + bh) = (I_2 + Ah)(X_0 - m_0) + B\\Delta W\n$$\n现在我们计算协方差。由于 $X_0$ 和 $\\Delta W$ 是独立的，期望中的交叉项消失：$E[(X_0 - m_0)(\\Delta W)^T] = E[X_0 - m_0]E[(\\Delta W)^T] = 0$。\n$$\n\\Sigma_{\\text{EM}} = E[((I_2 + Ah)(X_0-m_0) + B\\Delta W)((I_2+Ah)(X_0-m_0) + B\\Delta W)^T]\n$$\n$$\n\\Sigma_{\\text{EM}} = E[(I_2+Ah)(X_0-m_0)(X_0-m_0)^T(I_2+Ah)^T] + E[B\\Delta W (\\Delta W)^T B^T]\n$$\n使用 $E[(X_0-m_0)(X_0-m_0)^T] = \\Sigma_0$ 和 $E[\\Delta W (\\Delta W)^T] = \\operatorname{Cov}(\\Delta W) = hI_2$：\n$$\n\\Sigma_{\\text{EM}} = (I_2+Ah)\\Sigma_0(I_2+Ah)^T + B(hI_2)B^T = (I_2+Ah)\\Sigma_0(I_2+hA^T) + hBB^T\n$$\n展开乘积：\n$$\n\\Sigma_{\\text{EM}} = \\Sigma_0 + h\\Sigma_0 A^T + hA\\Sigma_0 + h^2 A\\Sigma_0 A^T + hBB^T = \\Sigma_0 + h(A\\Sigma_0 + \\Sigma_0 A^T + BB^T) + h^2 A\\Sigma_0 A^T\n$$\n\n### 第3部分：数值计算\n我们有 $h=0.02$, $A = \\begin{pmatrix} -1.2  0.8 \\\\ -2.0  -0.5 \\end{pmatrix}$, $b = \\begin{pmatrix} 0.05 \\\\ -0.08 \\end{pmatrix}$, $B = \\begin{pmatrix} 0.6  0.3 \\\\ 0.1  0.7 \\end{pmatrix}$, $m_0 = \\begin{pmatrix} 0.4 \\\\ -0.2 \\end{pmatrix}$, $\\Sigma_0 = \\begin{pmatrix} 0.5  0.15 \\\\ 0.15  0.4 \\end{pmatrix}$。\n\n首先，我们计算 $m_{\\text{EM}}$：\n$$\nAm_0 + b = \\begin{pmatrix} -1.2(0.4) + 0.8(-0.2) \\\\ -2.0(0.4) - 0.5(-0.2) \\end{pmatrix} + \\begin{pmatrix} 0.05 \\\\ -0.08 \\end{pmatrix} = \\begin{pmatrix} -0.64 \\\\ -0.7 \\end{pmatrix} + \\begin{pmatrix} 0.05 \\\\ -0.08 \\end{pmatrix} = \\begin{pmatrix} -0.59 \\\\ -0.78 \\end{pmatrix}\n$$\n$$\nm_{\\text{EM}} = m_0 + h(Am_0+b) = \\begin{pmatrix} 0.4 \\\\ -0.2 \\end{pmatrix} + 0.02 \\begin{pmatrix} -0.59 \\\\ -0.78 \\end{pmatrix} = \\begin{pmatrix} 0.4 - 0.0118 \\\\ -0.2 - 0.0156 \\end{pmatrix} = \\begin{pmatrix} 0.3882 \\\\ -0.2156 \\end{pmatrix}\n$$\n一阶精确均值 $m_{\\text{exact}}(h)$ 具有相同的公式，所以 $m_{\\text{exact}}(h) \\approx \\begin{pmatrix} 0.3882 \\\\ -0.2156 \\end{pmatrix}$。\n\n接下来，我们计算协方差。我们需要几个中间矩阵：\n$$\nA^T = \\begin{pmatrix} -1.2  -2.0 \\\\ 0.8  -0.5 \\end{pmatrix}\n$$\n$$\nA\\Sigma_0 = \\begin{pmatrix} -1.2  0.8 \\\\ -2.0  -0.5 \\end{pmatrix} \\begin{pmatrix} 0.5  0.15 \\\\ 0.15  0.4 \\end{pmatrix} = \\begin{pmatrix} -0.48  0.14 \\\\ -1.075  -0.5 \\end{pmatrix}\n$$\n$$\n\\Sigma_0 A^T = (A\\Sigma_0)^T = \\begin{pmatrix} -0.48  -1.075 \\\\ 0.14  -0.5 \\end{pmatrix}\n$$\n$$\nBB^T = \\begin{pmatrix} 0.6  0.3 \\\\ 0.1  0.7 \\end{pmatrix} \\begin{pmatrix} 0.6  0.1 \\\\ 0.3  0.7 \\end{pmatrix} = \\begin{pmatrix} 0.45  0.27 \\\\ 0.27  0.5 \\end{pmatrix}\n$$\n精确协方差的一阶展开是：\n$$\n\\Sigma_{\\text{exact}}(h) \\approx \\Sigma_0 + h(A\\Sigma_0 + \\Sigma_0 A^T + BB^T)\n$$\n$$\nA\\Sigma_0 + \\Sigma_0 A^T + BB^T = \\begin{pmatrix} -0.96  -0.935 \\\\ -0.935  -1.0 \\end{pmatrix} + \\begin{pmatrix} 0.45  0.27 \\\\ 0.27  0.5 \\end{pmatrix} = \\begin{pmatrix} -0.51  -0.665 \\\\ -0.665  -0.5 \\end{pmatrix}\n$$\n$$\n\\Sigma_{\\text{exact}}(h) \\approx \\begin{pmatrix} 0.5  0.15 \\\\ 0.15  0.4 \\end{pmatrix} + 0.02 \\begin{pmatrix} -0.51  -0.665 \\\\ -0.665  -0.5 \\end{pmatrix} = \\begin{pmatrix} 0.5 - 0.0102  0.15 - 0.0133 \\\\ 0.15 - 0.0133  0.4 - 0.01 \\end{pmatrix}\n$$\n$$\n\\Sigma_{\\text{exact}}(h) \\approx \\begin{pmatrix} 0.4898  0.1367 \\\\ 0.1367  0.39 \\end{pmatrix}\n$$\nEM协方差是 $\\Sigma_{\\text{EM}} = (\\Sigma_0 + h(A\\Sigma_0 + \\Sigma_0 A^T + BB^T)) + h^2 A\\Sigma_0 A^T$。括号中的项是 $\\Sigma_{\\text{exact}}(h)$ 的近似值。\n$$\nA\\Sigma_0 A^T = (A\\Sigma_0) A^T = \\begin{pmatrix} -0.48  0.14 \\\\ -1.075  -0.5 \\end{pmatrix} \\begin{pmatrix} -1.2  -2.0 \\\\ 0.8  -0.5 \\end{pmatrix} = \\begin{pmatrix} 0.688  0.89 \\\\ 0.89  2.4 \\end{pmatrix}\n$$\n$$\nh^2 A\\Sigma_0 A^T = (0.02)^2 \\begin{pmatrix} 0.688  0.89 \\\\ 0.89  2.4 \\end{pmatrix} = 0.0004 \\begin{pmatrix} 0.688  0.89 \\\\ 0.89  2.4 \\end{pmatrix} = \\begin{pmatrix} 0.0002752  0.000356 \\\\ 0.000356  0.00096 \\end{pmatrix}\n$$\n$$\n\\Sigma_{\\text{EM}} = \\begin{pmatrix} 0.4898  0.1367 \\\\ 0.1367  0.39 \\end{pmatrix} + \\begin{pmatrix} 0.0002752  0.000356 \\\\ 0.000356  0.00096 \\end{pmatrix} = \\begin{pmatrix} 0.4900752  0.137056 \\\\ 0.137056  0.39096 \\end{pmatrix}\n$$\n\n### 第4部分：比较与迹计算\n问题要求比较 $\\Sigma_{\\text{EM}}$ 与 $\\Sigma_{\\text{exact}}(h)$，其中后者是第1部分中推导的一阶展开。差值为：\n$$\n\\Sigma_{\\text{EM}} - \\Sigma_{\\text{exact}}(h) \\approx \\Sigma_{\\text{EM}} - (\\Sigma_0 + h(A\\Sigma_0 + \\Sigma_0 A^T + BB^T)) = h^2 A\\Sigma_0 A^T\n$$\n我们计算这个差分矩阵的迹：\n$$\n\\operatorname{tr}(\\Sigma_{\\text{EM}} - \\Sigma_{\\text{exact}}(h)) = \\operatorname{tr}(h^2 A\\Sigma_0 A^T) = h^2 \\operatorname{tr}(A\\Sigma_0 A^T)\n$$\n使用我们对 $A\\Sigma_0 A^T$ 的数值计算结果：\n$$\n\\operatorname{tr}(A\\Sigma_0 A^T) = 0.688 + 2.4 = 3.088\n$$\n因此，所求的量是：\n$$\n\\operatorname{tr}(\\Sigma_{\\text{EM}} - \\Sigma_{\\text{exact}}(h)) = (0.02)^2 \\times 3.088 = 0.0004 \\times 3.088 = 0.0012352\n$$\n将此值四舍五入到四位有效数字，得到 $0.001235$。",
            "answer": "$$\n\\boxed{1.235 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "在分析了局部误差之后，我们现在来研究其对一个关键的长时间特性——平稳分布——的累积效应。对于具有众所周知平衡态的 Ornstein-Uhlenbeck 过程，该练习要求你推导 EM 离散时间过程的平稳方差，并将其与真实值进行比较 。这将表明 EM 格式会引入一个不会随时间消失的系统性偏差，这对于旨在从不变测度中采样的模拟是一个至关重要的考虑因素。",
            "id": "3352613",
            "problem": "考虑由随机微分方程（SDE）$dX_{t} = -\\lambda X_{t}\\,dt + \\sigma\\,dW_{t}$ 定义的 Ornstein–Uhlenbeck 过程，其中 $\\lambda > 0$ 且 $\\sigma > 0$，$W_{t}$ 是一个标准维纳过程。已知该 SDE 的精确不变分布是均值为零、方差为 $\\sigma^{2}/(2\\lambda)$ 的高斯分布。令 $X_{n}$ 表示该 SDE 的 Euler–Maruyama (EM) 离散化（步长 $h > 0$），由递推关系 $X_{n+1} = X_{n} - \\lambda X_{n} h + \\sigma \\sqrt{h}\\,\\xi_{n}$ 给出，其中 $(\\xi_{n})_{n\\ge 0}$ 是独立同分布的标准正态随机变量，且 $X_{0}$ 独立于 $(\\xi_{n})_{n\\ge 0}$。假设 $0  h  2/\\lambda$，以使生成的马尔可夫链是稳定的。\n\n从线性高斯马尔可夫链的基本定义和事实出发，推导 EM 方案的精确离散时间不变测度，并计算 $X_{n}$ 的平稳方差。然后，通过将 EM 平稳方差与连续时间 SDE 的精确不变方差进行比较，来量化由 EM 引起的平稳二阶矩的偏差。将此偏差表示为关于 $\\lambda$、$\\sigma$ 和 $h$ 的单一闭式解析表达式，并给出其在 $h \\to 0$ 时的首阶渐近行为。\n\n作为最终答案，提供方差偏差 $\\operatorname{Var}_{\\mathrm{EM}}(X_{n}) - \\sigma^{2}/(2\\lambda)$ 的精确闭式表达式。不要提供任何数值近似；无需四舍五入。最终表达式中不使用任何单位。",
            "solution": "我们从 Ornstein–Uhlenbeck SDE $dX_{t} = -\\lambda X_{t}\\,dt + \\sigma\\,dW_{t}$ 开始，其中 $\\lambda > 0$ 且 $\\sigma > 0$。对于这个线性 SDE，一个经典结果是它有唯一的不变分布，即均值为 $0$、方差为 $\\sigma^{2}/(2\\lambda)$ 的高斯分布，这可以通过求解平稳 Fokker–Planck 方程或等价地求解线性系统协方差的连续时间 Lyapunov 方程得到。\n\n现在我们考虑将步长为 $h > 0$ 的 Euler–Maruyama (EM) 方案应用于此 SDE。EM 更新为\n$$\nX_{n+1} = X_{n} - \\lambda X_{n} h + \\sigma \\sqrt{h}\\,\\xi_{n}\n= (1 - \\lambda h) X_{n} + \\sigma \\sqrt{h}\\,\\xi_{n},\n$$\n其中 $(\\xi_{n})_{n\\ge 0}$ 是独立同分布的标准正态随机变量。这定义了一个一阶线性高斯自回归马尔可夫链，\n$$\nX_{n+1} = a X_{n} + b \\xi_{n}, \\quad \\text{其中} \\quad a = 1 - \\lambda h, \\quad b = \\sigma \\sqrt{h}.\n$$\n对于形式为 $X_{n+1} = a X_{n} + b \\xi_{n}$ 且 $|a|  1$（在此处对 $0  h  2/\\lambda$ 成立）的线性递推关系，不变分布存在且为均值为 $0$ 的高斯分布。平稳方差 $v_{h} = \\operatorname{Var}(X_{n})$ 求解通过在平稳状态下对两边取方差得到的离散 Lyapunov 方程：\n$$\nv_{h} = \\operatorname{Var}(X_{n+1}) = \\operatorname{Var}(a X_{n} + b \\xi_{n})\n= a^{2} \\operatorname{Var}(X_{n}) + b^{2} = a^{2} v_{h} + b^{2}.\n$$\n求解 $v_{h}$ 得\n$$\nv_{h} = \\frac{b^{2}}{1 - a^{2}} = \\frac{\\sigma^{2} h}{1 - (1 - \\lambda h)^{2}}\n= \\frac{\\sigma^{2} h}{1 - \\left(1 - 2\\lambda h + \\lambda^{2} h^{2}\\right)}\n= \\frac{\\sigma^{2} h}{2\\lambda h - \\lambda^{2} h^{2}}\n= \\frac{\\sigma^{2}}{2\\lambda - \\lambda^{2} h}.\n$$\n因此，EM 链的精确离散时间不变测度是均值为 $0$、方差为\n$$\n\\operatorname{Var}_{\\mathrm{EM}}(X_{n}) = \\frac{\\sigma^{2}}{2\\lambda - \\lambda^{2} h}.\n$$\n的高斯分布。\n\n现在我们量化由 EM 引起的平稳方差偏差，定义为 EM 平稳方差与连续时间 SDE 的精确不变方差之差：\n$$\n\\Delta(h) = \\operatorname{Var}_{\\mathrm{EM}}(X_{n}) - \\frac{\\sigma^{2}}{2\\lambda}\n= \\frac{\\sigma^{2}}{2\\lambda - \\lambda^{2} h} - \\frac{\\sigma^{2}}{2\\lambda}.\n$$\n我们通过通分来简化这个表达式：\n$$\n\\Delta(h) = \\sigma^{2} \\left( \\frac{1}{2\\lambda - \\lambda^{2} h} - \\frac{1}{2\\lambda} \\right)\n= \\sigma^{2} \\cdot \\frac{2\\lambda - (2\\lambda - \\lambda^{2} h)}{(2\\lambda)(2\\lambda - \\lambda^{2} h)}\n= \\sigma^{2} \\cdot \\frac{\\lambda^{2} h}{4\\lambda^{2} - 2\\lambda^{3} h}\n= \\frac{\\sigma^{2} h}{4 - 2\\lambda h}.\n$$\n这就给出了方差偏差作为 $\\lambda$、$\\sigma$ 和 $h$ 函数的精确闭式表达式。\n\n为了理解当 $h \\to 0$ 时的误差，我们将 $\\Delta(h)$ 在 $h=0$ 附近进行泰勒级数展开。写出\n$$\n\\Delta(h) = \\frac{\\sigma^{2} h}{4 - 2\\lambda h}\n= \\frac{\\sigma^{2} h}{4} \\cdot \\frac{1}{1 - (\\lambda h)/2}\n= \\frac{\\sigma^{2} h}{4} \\left( 1 + \\frac{\\lambda h}{2} + \\left(\\frac{\\lambda h}{2}\\right)^{2} + \\cdots \\right).\n$$\n因此，首阶渐近行为是\n$$\n\\Delta(h) = \\frac{\\sigma^{2} h}{4} + \\frac{\\sigma^{2} \\lambda h^{2}}{8} + \\mathcal{O}(h^{3}), \\quad \\text{当 } h \\to 0,\n$$\n这表明 EM 平稳方差高估了精确不变方差，其量在一阶上与 $h$ 呈线性关系，首项系数为 $\\sigma^{2}/4$。\n\n总结来说，EM 方案的离散时间不变测度是 $\\mathcal{N}\\!\\left(0,\\,\\sigma^{2}/(2\\lambda - \\lambda^{2} h)\\right)$，精确的方差偏差是 $\\Delta(h) = \\sigma^{2} h/(4 - 2\\lambda h)$，当 $h \\to 0$ 时，其首阶项为 $\\sigma^{2} h/4$。",
            "answer": "$$\\boxed{\\frac{\\sigma^{2} h}{4 - 2\\lambda h}}$$"
        },
        {
            "introduction": "最后的练习将从解析推导转向计算实践。你将为 Ornstein-Uhlenbeck 过程实现 Euler-Maruyama 格式和一个精确的模拟算法，并使用相同的随机数以确保公平比较 。通过衡量关键路径性质的差异，你将对 EM 近似的实际后果获得切实的理解，并学习到如数值稳定性等重要的实现细节。",
            "id": "3226711",
            "problem": "您将实现并比较奥恩斯坦-乌伦贝克过程的两种离散时间近似方法，从其定义的随机微分方程 (SDE) 以及线性SDE和高斯过程的核心性质出发。考虑奥恩斯坦-乌伦贝克 (OU) SDE\n$$\ndX_t = -\\lambda X_t \\, dt + \\sigma \\, dW_t, \\quad X_0 = x_0,\n$$\n其中 $W_t$ 是标准维纳过程（也称为布朗运动），$\\lambda \\ge 0$ 是均值回归率，$\\sigma \\ge 0$ 是波动率。\n\n从欧拉-丸山 (EM) 方法的基本定义，以及OU SDE是具有有限区间上高斯转移律的线性SDE这一事实出发，推导以下内容，且不假设任何专用公式：\n- 由维纳过程在步长为 $ \\Delta t = T/N $ 的均匀时间网格上的增量驱动的欧拉-丸山单步递推，其中 $N$ 是一个正整数。\n- 通过求解线性SDE并确定随机积分的正态分布，得到的单步长为 $\\Delta t$ 的精确离散时间转移律。请确保您的推导包含当 $\\lambda \\to 0$ 时的正确连续极限。\n\n然后，在相同的离散网格上实现这两种方案，并通过使用相同的独立标准正态随机变量序列 $\\{\\xi_n\\}_{n=0}^{N-1}$ 将它们耦合，使得布朗增量满足 $ \\Delta W_n = \\sqrt{\\Delta t}\\,\\xi_n $。对于网格 $t_n = n \\Delta t$ 上的一条路径 $\\{X_n\\}_{n=0}^{N}$，定义以下路径泛函：\n- 在时间 $T$ 的终端值 $X_N$。\n- 时间积分 $A = \\sum_{n=0}^{N-1} X_n \\,\\Delta t$ 的左黎曼和近似。\n- 离散二次变分 $Q = \\sum_{n=0}^{N-1} (X_{n+1} - X_n)^2$。\n\n您的程序必须：\n- 对于下方的每个测试用例，使用从固定的伪随机种子生成的相同序列 $\\{\\xi_n\\}$，模拟一对耦合路径，一条使用欧拉-丸山方法，另一条使用精确转移律。使用双精度算术。\n- 计算两条路径在三个路径泛函上的绝对差，即\n$$\nd_T = \\left|X_N^{\\text{EM}} - X_N^{\\text{Exact}}\\right|,\\quad\nd_A = \\left|A^{\\text{EM}} - A^{\\text{Exact}}\\right|,\\quad\nd_Q = \\left|Q^{\\text{EM}} - Q^{\\text{Exact}}\\right|.\n$$\n- 对于任何可能出现（数值）对消的公式，使用数值稳定的表达式，并为精确转移律实现正确的小λ极限，以处理λ接近零的情况。\n\n测试套件。对以下每组参数 $(x_0,\\lambda,\\sigma,T,N,\\text{seed})$ 运行三指标评估：\n- 情况 $1$：$(x_0,\\lambda,\\sigma,T,N,\\text{seed}) = (\\,1.0,\\,0.7,\\,0.8,\\,2.0,\\,4096,\\,20231105\\,)$。\n- 情况 $2$：$(x_0,\\lambda,\\sigma,T,N,\\text{seed}) = (\\,1.0,\\,0.7,\\,0.8,\\,2.0,\\,8192,\\,42\\,)$。\n- 情况 $3$：$(x_0,\\lambda,\\sigma,T,N,\\text{seed}) = (\\,{-}0.2,\\,10.0,\\,0.5,\\,1.0,\\,5000,\\,7\\,)$。\n- 情况 $4$：$(x_0,\\lambda,\\sigma,T,N,\\text{seed}) = (\\,{-}0.3,\\,10^{-6},\\,1.2,\\,1.0,\\,4096,\\,999\\,)$。\n\n所有时间均采用抽象单位；无需物理单位。本问题不使用角度。不使用百分比。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按以下顺序包含十二个浮点结果：\n$$\n[\\,d_T^{(1)},\\,d_A^{(1)},\\,d_Q^{(1)},\\,d_T^{(2)},\\,d_A^{(2)},\\,d_Q^{(2)},\\,d_T^{(3)},\\,d_A^{(3)},\\,d_Q^{(3)},\\,d_T^{(4)},\\,d_A^{(4)},\\,d_Q^{(4)}\\,],\n$$\n其中上标表示测试用例的索引。不应打印任何额外文本。",
            "solution": "目标是实现并比较奥恩斯坦-乌伦贝克 (OU) 随机微分方程 (SDE) 的两种数值方案：欧拉-丸山方法和基于精确转移律的方法。比较将基于为每个过程的单次实现计算出的三个路径泛函的绝对差，这些实现通过使用相同的基础随机新息序列进行耦合。\n\n奥恩斯坦-乌伦贝克SDE由下式给出：\n$$\ndX_t = -\\lambda X_t dt + \\sigma dW_t, \\quad X_0 = x_0\n$$\n其中 $X_t$ 是过程的状态，$\\lambda \\ge 0$ 是均值回归率，$\\sigma \\ge 0$ 是波动率，$W_t$ 是标准维纳过程。\n\n**欧拉-丸山 (EM) 方案的推导**\n\n欧拉-丸山方法通过在离散时间网格 $t_n = n \\Delta t$（其中 $n=0, 1, \\dots, N$）上构建SDE的前向差分近似来推导。无穷小增量近似为：\n- $dt \\approx \\Delta t = t_{n+1} - t_n$\n- $dX_t \\approx X_{n+1} - X_n$\n- $dW_t \\approx W_{t_{n+1}} - W_{t_n} = \\Delta W_n$\n\n维纳过程的增量 $\\Delta W_n$ 是一个随机变量，服从均值为0、方差为 $\\Delta t$ 的正态分布。因此，我们可以写成 $\\Delta W_n = \\sqrt{\\Delta t} \\xi_n$，其中 $\\xi_n$ 是一个标准正态随机变量，$\\xi_n \\sim N(0, 1)$。\n\n将这些近似值代入SDE，得到离散递推关系：\n$$\nX_{n+1} - X_n = -\\lambda X_n \\Delta t + \\sigma \\Delta W_n\n$$\n对 $X_{n+1}$ 进行整理，我们得到欧拉-丸山方案的单步递推公式：\n$$\nX_{n+1} = X_n - \\lambda X_n \\Delta t + \\sigma \\sqrt{\\Delta t} \\xi_n = (1 - \\lambda \\Delta t) X_n + \\sigma \\sqrt{\\Delta t} \\xi_n\n$$\n此公式用于将过程从一个时间步推进到下一个时间步。\n\n**精确转移律的推导**\n\nOU SDE是一个线性SDE，可以精确求解。我们将SDE重写为：\n$$\ndX_t + \\lambda X_t dt = \\sigma dW_t\n$$\n这种形式提示我们使用积分因子 $I_t = e^{\\lambda t}$。将SDE乘以 $I_t$ 等价于考虑乘积 $Y_t = e^{\\lambda t} X_t$ 的微分。使用伊藤乘积法则：\n$$\nd(e^{\\lambda t} X_t) = (\\lambda e^{\\lambda t} dt) X_t + e^{\\lambda t} dX_t = e^{\\lambda t} (\\lambda X_t dt + dX_t)\n$$\n从SDE代入，我们得到：\n$$\nd(e^{\\lambda t} X_t) = e^{\\lambda t} (\\sigma dW_t) = \\sigma e^{\\lambda t} dW_t\n$$\n对两边从时间 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 进行积分：\n$$\n\\int_{t_n}^{t_{n+1}} d(e^{\\lambda s} X_s) = \\int_{t_n}^{t_{n+1}} \\sigma e^{\\lambda s} dW_s\n$$\n$$\ne^{\\lambda t_{n+1}} X_{t_{n+1}} - e^{\\lambda t_n} X_{t_n} = \\sigma \\int_{t_n}^{t_{n+1}} e^{\\lambda s} dW_s\n$$\n求解 $X_{t_{n+1}}$（记作 $X_{n+1}$）：\n$$\nX_{n+1} = e^{-\\lambda (t_{n+1} - t_n)} X_{t_n} + \\sigma \\int_{t_n}^{t_{n+1}} e^{-\\lambda(t_{n+1}-s)} dW_s\n$$\n第二项是一个伊藤积分，其被积函数是确定性的。这样的积分是一个均值为零的正态分布随机变量。其方差使用伊藤等距定理计算：\n$$\n\\text{Var}\\left( \\sigma \\int_{t_n}^{t_{n+1}} e^{-\\lambda(t_{n+1}-s)} dW_s \\right) = \\sigma^2 \\int_{t_n}^{t_{n+1}} \\left( e^{-\\lambda(t_{n+1}-s)} \\right)^2 ds = \\sigma^2 \\int_{t_n}^{t_{n+1}} e^{-2\\lambda(t_{n+1}-s)} ds\n$$\n通过替换 $u = t_{n+1}-s$，积分变为 $\\int_0^{\\Delta t} e^{-2\\lambda u} du$。假设 $\\lambda > 0$，计算结果为：\n$$\n\\left[ \\frac{e^{-2\\lambda u}}{-2\\lambda} \\right]_0^{\\Delta t} = \\frac{e^{-2\\lambda \\Delta t} - 1}{-2\\lambda} = \\frac{1 - e^{-2\\lambda \\Delta t}}{2\\lambda}\n$$\n因此，该随机积分可以表示为 $\\sqrt{\\text{Var}} \\cdot \\xi_n$，其中 $\\xi_n \\sim N(0, 1)$。为了耦合这两种方案，我们使用与EM方法中相同的 $\\xi_n$。精确的单步递推公式为：\n$$\nX_{n+1} = e^{-\\lambda \\Delta t} X_n + \\sigma \\sqrt{\\frac{1 - e^{-2\\lambda \\Delta t}}{2\\lambda}} \\xi_n\n$$\n\n**数值稳定性与小λ极限**\n\n在极限 $\\lambda \\to 0$ 下，SDE变为 $dX_t = \\sigma dW_t$，即一个缩放的布朗运动。精确的递推关系应反映这一点。当 $\\lambda \\to 0$ 时，$e^{-\\lambda \\Delta t} \\to 1$。$\\xi_n$ 的系数需要更仔细地处理。使用小 $x$ 的泰勒级数 $e^{-x} \\approx 1 - x$：\n$$\n\\lim_{\\lambda \\to 0} \\sigma \\sqrt{\\frac{1 - e^{-2\\lambda \\Delta t}}{2\\lambda}} = \\sigma \\sqrt{\\lim_{\\lambda \\to 0} \\frac{1 - (1 - 2\\lambda \\Delta t + O((\\lambda \\Delta t)^2))}{2\\lambda}} = \\sigma \\sqrt{\\lim_{\\lambda \\to 0} \\frac{2\\lambda \\Delta t}{2\\lambda}} = \\sigma \\sqrt{\\Delta t}\n$$\n这与 $\\lambda=0$ 时EM方案中的系数相匹配。然而，对于小但非零的 $\\lambda$，直接计算 $\\frac{1-e^{-2\\lambda\\Delta t}}{2\\lambda}$ 可能导致灾难性对消，因为分子趋近于零。为确保稳定性，我们分析函数 $f(y) = \\frac{1-e^{-y}}{y}$ 在 $y = 2\\lambda\\Delta t$ 较小的情况。其泰勒级数展开为 $f(y) = 1 - \\frac{y}{2} + \\frac{y^2}{6} - \\dots$。当参数 $2\\lambda\\Delta t$ 接近于零时，该展开式用于方差计算，以防止数值不稳定性。具体来说，随机项的方差可以计算为 $\\sigma^2 \\Delta t \\cdot f(2\\lambda\\Delta t)$。\n\n**模拟与评估**\n\n对于每个测试用例，我们执行以下步骤：\n1.  设置参数 $(x_0, \\lambda, \\sigma, T, N, \\text{seed})$。\n2.  计算时间步长 $\\Delta t = T/N$。\n3.  使用指定的种子生成一个包含 $N$ 个标准正态随机数的向量 $\\{\\xi_n\\}_{n=0}^{N-1}$。\n4.  从 $X_0 = x_0$ 开始，使用各自的递推公式和相同的序列 $\\{\\xi_n\\}$，同时模拟两条长度为 $N+1$ 的路径 $\\{X_n^{\\text{EM}}\\}$ 和 $\\{X_n^{\\text{Exact}}\\}$。\n5.  为每条路径计算三个路径泛函：\n    -   终端值：$X_N = X[N]$\n    -   积分近似：$A = \\sum_{n=0}^{N-1} X_n \\Delta t$\n    -   二次变分：$Q = \\sum_{n=0}^{N-1} (X_{n+1} - X_n)^2$\n6.  计算EM路径和精确路径泛函之间的绝对差 $d_T$、$d_A$ 和 $d_Q$。\n最终输出汇总了来自四个测试用例的这十二个差值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares Euler-Maruyama and exact simulation schemes for the\n    Ornstein-Uhlenbeck process, computing differences in path functionals.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (x0, lambda, sigma, T, N, seed)\n        (1.0, 0.7, 0.8, 2.0, 4096, 20231105),\n        (1.0, 0.7, 0.8, 2.0, 8192, 42),\n        (-0.2, 10.0, 0.5, 1.0, 5000, 7),\n        (-0.3, 1e-6, 1.2, 1.0, 4096, 999),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        x0, lam, sigma, T, N, seed = case\n        \n        dt = T / N\n        \n        # Generate the common sequence of standard normal random variables\n        rng = np.random.default_rng(seed)\n        xi = rng.standard_normal(N)\n        \n        # Initialize path arrays with double precision floating point numbers\n        X_em = np.zeros(N + 1, dtype=np.float64)\n        X_exact = np.zeros(N + 1, dtype=np.float64)\n        X_em[0] = x0\n        X_exact[0] = x0\n        \n        # --- Coefficients for simulation step ---\n        # 1. Euler-Maruyama coefficients\n        em_drift_factor = 1.0 - lam * dt\n        em_diffusion_term = sigma * np.sqrt(dt)\n\n        # 2. Exact scheme coefficients\n        exact_drift_factor = np.exp(-lam * dt)\n        \n        # Numerically stable calculation for the exact diffusion term's standard deviation\n        # The variance is sigma^2 * (1 - exp(-2*lam*dt)) / (2*lam).\n        # Let arg = 2*lam*dt. The variance factor is (1 - exp(-arg)) / (2*lam).\n        arg = 2.0 * lam * dt\n        if np.abs(arg)  1e-8:\n            # Use Taylor expansion for variance term to avoid cancellation:\n            # (1-exp(-x))/x = 1 - x/2 + x^2/6 - ...\n            # The variance is sigma^2 * dt * (1 - arg/2 + arg^2/6 - ...)\n            var_factor = dt * (1.0 - arg / 2.0 + arg**2 / 6.0)\n        else:\n            var_factor = (1.0 - np.exp(-arg)) / (2.0 * lam)\n        \n        exact_diffusion_term = sigma * np.sqrt(var_factor)\n\n        # --- Simulation loop ---\n        for n in range(N):\n            # Euler-Maruyama step\n            X_em[n+1] = em_drift_factor * X_em[n] + em_diffusion_term * xi[n]\n            \n            # Exact propagator step\n            X_exact[n+1] = exact_drift_factor * X_exact[n] + exact_diffusion_term * xi[n]\n            \n        # --- Compute path functionals ---\n        # 1. Terminal value X_N\n        X_N_em = X_em[N]\n        X_N_exact = X_exact[N]\n        \n        # 2. Left Riemann sum approximation of the time integral A\n        A_em = np.sum(X_em[:-1]) * dt\n        A_exact = np.sum(X_exact[:-1]) * dt\n        \n        # 3. Discrete quadratic variation Q\n        Q_em = np.sum(np.diff(X_em)**2)\n        Q_exact = np.sum(np.diff(X_exact)**2)\n        \n        # --- Compute absolute differences ---\n        d_T = np.abs(X_N_em - X_N_exact)\n        d_A = np.abs(A_em - A_exact)\n        d_Q = np.abs(Q_em - Q_exact)\n        \n        results.extend([d_T, d_A, d_Q])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}