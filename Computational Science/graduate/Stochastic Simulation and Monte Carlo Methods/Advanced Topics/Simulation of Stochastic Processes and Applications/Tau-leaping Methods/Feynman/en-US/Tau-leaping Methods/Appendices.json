{
    "hands_on_practices": [
        {
            "introduction": "The tau-leaping method accelerates stochastic simulation by taking discrete time steps of size $\\tau$. This first exercise explores the fundamental nature of this approximation by directly comparing its effect on the system's expected state to that of the exact Stochastic Simulation Algorithm (SSA). By deriving the ratio of these expected changes for a simple birth-death model, you will gain insight into how $\\tau$ controls the aggregation of individual reaction events. ",
            "id": "3350254",
            "problem": "Consider a continuous-time Markov jump process for a single-species birthâ€“death system with state $X(t) \\in \\mathbb{N}$ and two reaction channels: a birth reaction with propensity $a_{1}(x)=\\lambda x$ and a death reaction with propensity $a_{2}(x)=\\mu x$, where $\\lambda>0$ and $\\mu>0$. Assume that over a short interval $[t,t+\\tau]$ the propensities can be treated as constant at the value $X(t)=x$, and consider a single step of the tau-leaping method defined by\n$$\nX(t+\\tau)=X(t)+K_{1}-K_{2},\n$$\nwhere $K_{1}\\sim \\mathrm{Poisson}(\\lambda x \\tau)$ and $K_{2}\\sim \\mathrm{Poisson}(\\mu x \\tau)$ are independent. Separately, consider one event generated by the Stochastic Simulation Algorithm (SSA), that is, one reaction firing chosen according to the reaction probabilities determined by the propensities at state $x$.\n\nStarting from the definitions of independent Poisson random variables and the construction of the Stochastic Simulation Algorithm (SSA), derive the expected change in the state over one tau-leap, $\\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x]$, and the expected change in the state due to one SSA firing, $\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]$. Then, under the assumption $\\lambda\\neq \\mu$, compute the ratio\n$$\nR(x,\\tau,\\lambda,\\mu)=\\frac{\\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x]}{\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]}.\n$$\nProvide $R(x,\\tau,\\lambda,\\mu)$ as a single closed-form analytic expression. No rounding is required. Express your final answer without units.",
            "solution": "The user wants me to solve a problem about stochastic simulation methods.\n\n### Step 1: Extract Givens\n- A continuous-time Markov jump process for a single-species system.\n- State: $X(t) \\in \\mathbb{N}$.\n- Reaction 1 (Birth): Propensity $a_{1}(x) = \\lambda x$, with $\\lambda > 0$. State change is $+1$.\n- Reaction 2 (Death): Propensity $a_{2}(x) = \\mu x$, with $\\mu > 0$. State change is $-1$.\n- Tau-leaping method update over an interval $[t, t+\\tau]$: $X(t+\\tau) = X(t) + K_{1} - K_{2}$.\n- $K_{1} \\sim \\mathrm{Poisson}(\\lambda x \\tau)$, where $x = X(t)$.\n- $K_{2} \\sim \\mathrm{Poisson}(\\mu x \\tau)$, where $x = X(t)$.\n- $K_{1}$ and $K_{2}$ are independent.\n- Stochastic Simulation Algorithm (SSA): One event is a single reaction firing chosen based on propensities at state $x$.\n- Assumption: $\\lambda \\neq \\mu$.\n- Goal: Compute the ratio $R(x,\\tau,\\lambda,\\mu) = \\frac{\\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x]}{\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem describes a standard birth-death process, a fundamental model in stochastic population dynamics and chemical kinetics. Both the tau-leaping method and the Stochastic Simulation Algorithm (SSA, also known as Gillespie's algorithm) are well-established, cornerstone methods for simulating such systems. The mathematical formulation is standard and correct.\n2.  **Well-Posed**: The problem asks for the derivation of two expected values and their ratio. These are well-defined mathematical quantities. The condition $\\lambda \\neq \\mu$ is provided, which is necessary to avoid a zero-valued denominator in the ratio's definition, ensuring the ratio is well-defined. The problem is self-contained and provides all necessary information.\n3.  **Objective**: The problem is stated in precise, objective mathematical language. There are no subjective or opinion-based elements.\n\nThe problem is valid as it is scientifically sound, well-posed, and objective. There are no flaws found in the validation checklist. I will proceed with the solution.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will provide a complete, reasoned solution.\n\nThe problem requires the calculation of two distinct expected values and their ratio. We will compute each component separately.\n\nFirst, we calculate the expected change in the state over one tau-leap, $\\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x]$.\nThe state update is given by:\n$$X(t+\\tau) = X(t) + K_{1} - K_{2}$$\nThe change in state over the interval $[t, t+\\tau]$ is therefore $\\Delta X_{\\tau} = X(t+\\tau) - X(t) = K_{1} - K_{2}$.\nWe are asked to find the expectation of this change, conditioned on the state at time $t$ being $x$.\n$$ \\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x] = \\mathbb{E}[K_{1} - K_{2} \\mid X(t)=x] $$\nBy the linearity of expectation, this becomes:\n$$ \\mathbb{E}[K_{1} \\mid X(t)=x] - \\mathbb{E}[K_{2} \\mid X(t)=x] $$\nThe problem states that $K_{1}$ and $K_{2}$ are drawn from Poisson distributions whose parameters depend on the state $x$. Specifically, $K_{1} \\sim \\mathrm{Poisson}(\\lambda x \\tau)$ and $K_{2} \\sim \\mathrm{Poisson}(\\mu x \\tau)$. The expected value of a Poisson-distributed random variable $\\mathrm{Poisson}(\\nu)$ is simply $\\nu$.\nTherefore, the expected values of $K_{1}$ and $K_{2}$ are:\n$$ \\mathbb{E}[K_{1} \\mid X(t)=x] = \\lambda x \\tau $$\n$$ \\mathbb{E}[K_{2} \\mid X(t)=x] = \\mu x \\tau $$\nSubstituting these back into the expression for the expected change gives our first result:\n$$ \\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x] = \\lambda x \\tau - \\mu x \\tau = (\\lambda - \\mu)x\\tau $$\n\nSecond, we calculate the expected change in the state due to a single event firing in the Stochastic Simulation Algorithm (SSA), $\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]$.\nIn the SSA framework, at any given time, one reaction is chosen to occur from the set of all possible reactions. The probability of choosing a specific reaction $j$ is proportional to its propensity, $a_j(x)$.\nThe total propensity for all reactions is $a_{0}(x) = \\sum_j a_j(x)$. In our case, this is:\n$$ a_{0}(x) = a_{1}(x) + a_{2}(x) = \\lambda x + \\mu x = (\\lambda + \\mu)x $$\nThe probability of the next reaction being a birth (reaction $1$) is:\n$$ P_{1} = \\frac{a_{1}(x)}{a_{0}(x)} = \\frac{\\lambda x}{(\\lambda + \\mu)x} = \\frac{\\lambda}{\\lambda + \\mu} $$\nThis simplification is valid for $x > 0$. If $x=0$, both propensities are $0$, no reaction occurs, and the change is deterministically $0$. We proceed assuming $x>0$.\nThe probability of the next reaction being a death (reaction $2$) is:\n$$ P_{2} = \\frac{a_{2}(x)}{a_{0}(x)} = \\frac{\\mu x}{(\\lambda + \\mu)x} = \\frac{\\mu}{\\lambda + \\mu} $$\nA birth reaction changes the state by $\\Delta X = +1$. A death reaction changes the state by $\\Delta X = -1$.\nThe expected change in state for a single SSA step, $\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]$, is the weighted average of these two outcomes:\n$$ \\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x] = (+1) \\cdot P_{1} + (-1) \\cdot P_{2} $$\n$$ \\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x] = (1) \\left(\\frac{\\lambda}{\\lambda + \\mu}\\right) + (-1) \\left(\\frac{\\mu}{\\lambda + \\mu}\\right) = \\frac{\\lambda - \\mu}{\\lambda + \\mu} $$\nThis expectation is notably independent of $x$ for $x > 0$.\n\nFinally, we compute the ratio $R(x,\\tau,\\lambda,\\mu)$ as defined in the problem statement:\n$$ R(x,\\tau,\\lambda,\\mu) = \\frac{\\mathbb{E}[X(t+\\tau)-X(t)\\mid X(t)=x]}{\\mathbb{E}[\\Delta X_{\\mathrm{SSA}}\\mid X(t)=x]} $$\nSubstituting the two derived expressions:\n$$ R(x,\\tau,\\lambda,\\mu) = \\frac{(\\lambda - \\mu)x\\tau}{\\frac{\\lambda - \\mu}{\\lambda + \\mu}} $$\nThe problem states that $\\lambda \\neq \\mu$, which ensures that $\\lambda - \\mu \\neq 0$. Therefore, we can safely cancel this term from the numerator and the denominator.\n$$ R(x,\\tau,\\lambda,\\mu) = x\\tau (\\lambda + \\mu) $$\nThis is the final closed-form analytic expression for the ratio.",
            "answer": "$$\n\\boxed{(\\lambda + \\mu)x\\tau}\n$$"
        },
        {
            "introduction": "A critical aspect of a robust tau-leaping algorithm is the adaptive selection of the step size, $\\tau$. If $\\tau$ is too large, the \"leap condition\" is violated, and the simulation becomes inaccurate. This practice challenges you to derive a widely used step-size control rule from first principles by bounding the relative change in species populations, translating a qualitative requirement into a concrete mathematical formula. ",
            "id": "3350266",
            "problem": "Consider a well-mixed stochastic reaction network with $d$ chemical species and $M$ reaction channels. Let the system state at time $t$ be $X(t) \\in \\mathbb{N}^d$. For each reaction channel $j \\in \\{1,\\dots,M\\}$, let $\\nu_j \\in \\mathbb{Z}^d$ denote its stoichiometric change vector and $a_j(X)$ its propensity function evaluated at state $X$. In the $\\tau$-leaping approximation over a time increment $\\tau > 0$, conditioned on $X(t)$, the number of firings of reaction $j$ is modeled as a Poisson random variable with mean $a_j(X(t))\\,\\tau$, and different reaction channels fire independently.\n\nYour task is to design a step-size control rule that enforces the following requirement at time $t$: for each species index $i \\in \\{1,\\dots,d\\}$, the absolute change in that species over the leap is bounded in a relative sense by a user-chosen fraction $\\delta \\in (0,1)$ of its current count $X_i(t)$. Use only fundamental properties of Poisson random variables and linearity of expectation and variance to derive a sufficient condition on $\\tau$ that enforces this requirement componentwise. Specifically, starting from the definition of the $\\tau$-leaping approximation and the independence of reaction counts, derive an explicit, closed-form expression for the largest $\\tau$ as a function of $X(t)$, $\\delta$, the propensities $a_j(X(t))$, and the stoichiometric coefficients $\\nu_{ij}$ that ensures, for each $i$, that both the expected absolute change and the variance of the change in species $i$ are bounded by $\\delta\\,X_i(t)$ and $\\delta^2 X_i(t)^2$, respectively.\n\nExpress your final answer as a single closed-form analytic expression for $\\tau$. You may assume that $X_i(t) > 0$ for all $i \\in \\{1,\\dots,d\\}$. The final answer must be a single symbolic expression. No numerical evaluation is required.",
            "solution": "The user has provided a valid, well-posed problem statement from the field of stochastic simulation. The task is to derive a step-size selection formula for the $\\tau$-leaping method based on controlling the relative change in species populations.\n\nLet the state of the system at time $t$ be the vector of species populations $X(t) = (X_1(t), \\dots, X_d(t))$. The system evolves through $M$ reaction channels. For each reaction $j \\in \\{1, \\dots, M\\}$, we are given its propensity function $a_j(X)$ and its stoichiometric change vector $\\nu_j = (\\nu_{1j}, \\dots, \\nu_{dj})^T$.\n\nIn the $\\tau$-leaping approximation, the number of times reaction $j$ fires in the time interval $[t, t+\\tau)$, denoted by the random variable $K_j$, is drawn from a Poisson distribution conditioned on the state $X(t)$.\n$$K_j \\sim \\text{Poisson}(\\lambda_j)$$\nwhere the mean $\\lambda_j = a_j(X(t))\\tau$. The problem states that the random variables $K_1, K_2, \\dots, K_M$ are mutually independent.\n\nThe total change in the population of species $i$, denoted $\\Delta X_i$, over the time interval $[t, t+\\tau)$ is given by the sum of contributions from all reaction channels:\n$$\\Delta X_i = \\sum_{j=1}^{M} \\nu_{ij} K_j$$\nOur goal is to find the largest time step $\\tau > 0$ that satisfies two conditions for every species $i \\in \\{1, \\dots, d\\}$, given a control parameter $\\delta \\in (0,1)$ and assuming $X_i(t) > 0$.\n\nFirst, we compute the expectation of the change $\\Delta X_i$. Using the linearity of expectation:\n$$E[\\Delta X_i] = E\\left[\\sum_{j=1}^{M} \\nu_{ij} K_j\\right] = \\sum_{j=1}^{M} \\nu_{ij} E[K_j]$$\nThe expectation of a Poisson random variable $K_j$ with parameter $\\lambda_j$ is $E[K_j] = \\lambda_j = a_j(X(t))\\tau$. Substituting this into the previous equation gives:\n$$E[\\Delta X_i] = \\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))\\tau = \\tau \\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))$$\n\nThe first condition bounds the magnitude of this expected change. The problem text \"expected absolute change\" is interpreted, consistent with the standard literature and the supplied toolkit (linearity of expectation and variance), as the absolute value of the expected change:\n$$|E[\\Delta X_i]| \\le \\delta X_i(t)$$\nSubstituting our expression for $E[\\Delta X_i]$:\n$$\\left|\\tau \\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))\\right| \\le \\delta X_i(t)$$\nSince $\\tau > 0$, we have:\n$$\\tau \\left|\\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))\\right| \\le \\delta X_i(t)$$\nIf the term $\\left|\\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))\\right|$ is non-zero, we can isolate $\\tau$ to find the first upper bound for each species $i$:\n$$\\tau \\le \\frac{\\delta X_i(t)}{\\left|\\sum_{j=1}^{M} \\nu_{ij} a_j(X(t))\\right|}$$\nIf the summation term is zero, this condition imposes no upper bound on $\\tau$ for that species $i$.\n\nSecond, we compute the variance of the change $\\Delta X_i$. Since the random variables $\\{K_j\\}_{j=1}^M$ are independent, the variance of their weighted sum is the weighted sum of their variances:\n$$\\text{Var}(\\Delta X_i) = \\text{Var}\\left(\\sum_{j=1}^{M} \\nu_{ij} K_j\\right) = \\sum_{j=1}^{M} \\text{Var}(\\nu_{ij} K_j) = \\sum_{j=1}^{M} \\nu_{ij}^2 \\text{Var}(K_j)$$\nThe variance of a Poisson random variable $K_j$ with parameter $\\lambda_j$ is $\\text{Var}(K_j) = \\lambda_j = a_j(X(t))\\tau$. Substituting this gives:\n$$\\text{Var}(\\Delta X_i) = \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t))\\tau = \\tau \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t))$$\n\nThe second condition bounds this variance:\n$$\\text{Var}(\\Delta X_i) \\le \\delta^2 X_i(t)^2$$\nSubstituting our expression for $\\text{Var}(\\Delta X_i)$:\n$$\\tau \\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t)) \\le \\delta^2 X_i(t)^2$$\nThe term $\\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t))$ is non-negative since $a_j(X(t)) \\ge 0$ and $\\nu_{ij}^2 \\ge 0$. If this sum is positive, we can isolate $\\tau$ to find the second upper bound for each species $i$:\n$$\\tau \\le \\frac{\\delta^2 X_i(t)^2}{\\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t))}$$\nIf the summation term is zero, this condition imposes no upper bound on $\\tau$ for that species $i$.\n\nTo ensure the stability and accuracy of the leap for the entire system, the time step $\\tau$ must satisfy both inequalities for all species $i \\in \\{1, \\dots, d\\}$. Therefore, $\\tau$ must be less than or equal to the minimum of all derived upper bounds. The largest permissible value for $\\tau$ is the minimum of these bounds over all species and both conditions.\n$$\\tau = \\min_{i \\in \\{1,\\dots,d\\}} \\left\\{ \\tau_{1,i}, \\tau_{2,i} \\right\\}$$\nwhere $\\tau_{1,i}$ and $\\tau_{2,i}$ represent the bounds from the expectation and variance conditions, respectively, for species $i$. If a denominator is zero, the corresponding term does not constrain the minimum (it can be treated as infinite). Combining these gives the final expression for the largest allowed $\\tau$:\n$$\\tau = \\min_{i \\in \\{1,\\dots,d\\}} \\left\\{ \\frac{\\delta X_i(t)}{\\left| \\sum_{j=1}^M \\nu_{ij} a_j(X(t)) \\right|}, \\frac{\\delta^2 X_i(t)^2}{\\sum_{j=1}^M \\nu_{ij}^2 a_j(X(t))} \\right\\}$$\nThis single expression provides the necessary sufficient condition on $\\tau$.",
            "answer": "$$\\boxed{\\min_{i \\in \\{1,\\dots,d\\}} \\left\\{ \\frac{\\delta X_i(t)}{\\left| \\sum_{j=1}^{M} \\nu_{ij} a_j(X(t)) \\right|}, \\frac{\\delta^2 X_i(t)^2}{\\sum_{j=1}^{M} \\nu_{ij}^2 a_j(X(t))} \\right\\}}$$"
        },
        {
            "introduction": "Stiff systems, which contain reactions operating on vastly different timescales, pose a significant challenge for explicit simulation methods like the basic tau-leap. This final exercise introduces the implicit tau-leaping method as a powerful technique for maintaining stability in such scenarios. You will derive the underlying linear system for this method and apply it to a concrete example, highlighting how to handle stiffness by incorporating information about the future state into the current time step. ",
            "id": "3350319",
            "problem": "Consider a well-mixed stochastic reaction network with $d$ chemical species and $m$ unimolecular reactions. Let the state at time $t$ be the population vector $x(t) \\in \\mathbb{Z}_{\\ge 0}^{d}$, and suppose the network is modeled as a continuous-time, discrete-state Markov jump process consistent with the Chemical Master Equation (CME). The state changes due to reactions with stoichiometric matrix $S \\in \\mathbb{Z}^{d \\times m}$ whose $j$-th column is the net change induced by reaction $j$. Assume the propensities are linear in the state, so that $a(x) = C x$ for some matrix $C \\in \\mathbb{R}^{m \\times d}$, where $a(x)$ is the vector of reaction propensities and $x \\in \\mathbb{R}^{d}$ is treated as a real-valued approximation of the integer-valued state. The explicit tau-leaping scheme uses independent Poisson random variables to approximate reaction counts over a short time step $\\tau > 0$. An implicit tau-leap can be constructed by using the next-step state inside the mean of the reaction count while retaining an explicit representation of the centered (zero-mean) noise from the current state.\n\nStarting from first principles of Markov jump processes and the Poisson nature of reaction counts over short intervals, derive the linear system that must be solved at each step of an implicit tau-leap method for unimolecular networks with $a(x) = C x$. Clearly show how the implicit use of $a(x^{n+1})$ in the mean of the reaction counts leads to a linear system for $x^{n+1}$, and identify the matrix that must be inverted to advance the solution.\n\nThen, solve this system explicitly for the following two-species, two-reaction network:\n- Reactions: $X_{1} \\rightarrow X_{2}$ with rate constant $k_{1}$, and $X_{2} \\rightarrow X_{1}$ with rate constant $k_{2}$.\n- Stoichiometric matrix and propensity matrix:\n$$\nS = \\begin{pmatrix}\n-1 & 1 \\\\\n1 & -1\n\\end{pmatrix},\n\\qquad\nC = \\begin{pmatrix}\nk_{1} & 0 \\\\\n0 & k_{2}\n\\end{pmatrix}.\n$$\n- Current state $x^{n} = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix}$, time step $\\tau = \\frac{1}{2}$, and rate constants $k_{1} = 1$, $k_{2} = 2$.\n- The implicit tau-leap uses the next-step propensities $a(x^{n+1})$ inside the mean and the centered Poisson noise computed at the current state. Let the independent Poisson random variables based on current means $\\lambda_{1} = a_{1}(x^{n}) \\tau$ and $\\lambda_{2} = a_{2}(x^{n}) \\tau$ realize as $P_{1} = 1$ and $P_{2} = 4$.\n\nCompute the updated state $x^{n+1}$ exactly. Express your final answer as a row matrix using exact rational numbers; do not round.",
            "solution": "The problem is valid. It presents a well-posed question in the established scientific domain of stochastic chemical kinetics and its numerical simulation, specifically concerning the tau-leaping method. All givens are scientifically sound, consistent, and sufficient to derive a unique solution.\n\nWe begin by addressing the first part of the problem: deriving the linear system for the specified implicit tau-leap method.\n\nLet the state of the system at time $t_n$ be $x^n$. The state at the next time step, $t_{n+1} = t_n + \\tau$, is given by the tau-leaping update equation:\n$$x^{n+1} = x^n + \\sum_{j=1}^{m} S_j K_j = x^n + S K$$\nwhere $K_j$ is the number of times reaction $j$ occurs in the time interval $[\\,t_n, t_{n+1}\\,)$, and $S_j$ is the $j$-th column of the stoichiometric matrix $S$. The vector $K$ is a column vector of these reaction counts.\n\nIn the standard explicit tau-leap method, $K_j$ is approximated by a Poisson random variable $P_j$ with mean $\\lambda_j = a_j(x^n)\\tau$. The problem defines a specific implicit scheme. The number of reactions $K_j$ is to be approximated by using the mean evaluated at the future state, $a_j(x^{n+1})\\tau$, and adding the centered noise from the current state.\n\nThe centered noise for a Poisson process is the random variable itself minus its mean. For a process with mean $\\lambda = a(x^n)\\tau$, the noise is $P - \\lambda$, where $P$ is a Poisson random variable with mean $\\lambda$. The problem states that this noise term is to be computed \"explicitly\", i.e., using the current state $x^n$.\n\nLet $P$ be a vector of independent Poisson random variables, where each component $P_j$ has a mean of $\\lambda_j = a_j(x^n)\\tau$. The explicit centered noise vector is $P - a(x^n)\\tau$.\nThe implicit mean vector is $a(x^{n+1})\\tau$.\n\nFollowing the problem's prescription, the approximation for the reaction count vector $K$ is:\n$$K \\approx a(x^{n+1})\\tau + (P - a(x^n)\\tau)$$\n\nSubstituting this into the state update equation:\n$$x^{n+1} = x^n + S \\left( a(x^{n+1})\\tau + P - a(x^n)\\tau \\right)$$\n\nThe problem specifies that the reaction network is unimolecular, so the propensities are linear in the state: $a(x) = Cx$. Substituting this into the equation:\n$$x^{n+1} = x^n + S \\left( (Cx^{n+1})\\tau + P - (Cx^n)\\tau \\right)$$\n$$x^{n+1} = x^n + \\tau S C x^{n+1} + S P - \\tau S C x^n$$\n\nTo solve for $x^{n+1}$, we rearrange the terms to group all instances of $x^{n+1}$ on the left side. Let $I_d$ be the $d \\times d$ identity matrix.\n$$x^{n+1} - \\tau S C x^{n+1} = x^n - \\tau S C x^n + S P$$\n$$(I_d - \\tau S C) x^{n+1} = (I_d - \\tau S C) x^n + S P$$\n\nThis is the linear system that must be solved for $x^{n+1}$. The matrix that must be inverted to advance the solution is:\n$$A = I_d - \\tau S C$$\nThe solution for $x^{n+1}$ is given by $x^{n+1} = (I_d - \\tau S C)^{-1} \\left( (I_d - \\tau S C)x^n + SP \\right)$, which simplifies to:\n$$x^{n+1} = x^n + (I_d - \\tau S C)^{-1} S P$$\n\nNow we apply this result to the specific two-species, two-reaction network. The given parameters are:\n$$S = \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}, \\qquad C = \\begin{pmatrix} k_1 & 0 \\\\ 0 & k_2 \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 2 \\end{pmatrix}$$\n$$x^n = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix}, \\qquad \\tau = \\frac{1}{2}$$\nThe problem provides the realized values of the Poisson random variables $P_1$ and $P_2$:\n$$P = \\begin{pmatrix} P_1 \\\\ P_2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 4 \\end{pmatrix}$$\n\nFirst, we compute the matrix $A = I_2 - \\tau S C$.\nThe product $SC$ is:\n$$SC = \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} \\begin{pmatrix} 1 & 0 \\\\ 0 & 2 \\end{pmatrix} = \\begin{pmatrix} (-1)(1) + (1)(0) & (-1)(0) + (1)(2) \\\\ (1)(1) + (-1)(0) & (1)(0) + (-1)(2) \\end{pmatrix} = \\begin{pmatrix} -1 & 2 \\\\ 1 & -2 \\end{pmatrix}$$\nNext, we compute $\\tau S C$:\n$$\\tau SC = \\frac{1}{2} \\begin{pmatrix} -1 & 2 \\\\ 1 & -2 \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{2} & 1 \\\\ \\frac{1}{2} & -1 \\end{pmatrix}$$\nNow, we find $A$:\n$$A = I_2 - \\tau SC = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} - \\begin{pmatrix} -\\frac{1}{2} & 1 \\\\ \\frac{1}{2} & -1 \\end{pmatrix} = \\begin{pmatrix} 1 - (-\\frac{1}{2}) & 0-1 \\\\ 0 - \\frac{1}{2} & 1 - (-1) \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{2} & -1 \\\\ -\\frac{1}{2} & 2 \\end{pmatrix}$$\n\nTo solve the system, we need the inverse of $A$, which is $A^{-1} = \\frac{1}{\\det(A)} \\text{adj}(A)$.\nThe determinant of $A$ is:\n$$\\det(A) = \\left(\\frac{3}{2}\\right)(2) - (-1)\\left(-\\frac{1}{2}\\right) = 3 - \\frac{1}{2} = \\frac{5}{2}$$\nThe inverse $A^{-1}$ is:\n$$A^{-1} = \\frac{1}{5/2} \\begin{pmatrix} 2 & 1 \\\\ \\frac{1}{2} & \\frac{3}{2} \\end{pmatrix} = \\frac{2}{5} \\begin{pmatrix} 2 & 1 \\\\ \\frac{1}{2} & \\frac{3}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{4}{5} & \\frac{2}{5} \\\\ \\frac{1}{5} & \\frac{3}{5} \\end{pmatrix}$$\n\nNext, we compute the vector $SP$:\n$$SP = \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} (-1)(1) + (1)(4) \\\\ (1)(1) + (-1)(4) \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ -3 \\end{pmatrix}$$\n\nFinally, we compute $x^{n+1}$ using the derived formula $x^{n+1} = x^n + A^{-1}SP$:\n$$x^{n+1} = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} \\frac{4}{5} & \\frac{2}{5} \\\\ \\frac{1}{5} & \\frac{3}{5} \\end{pmatrix} \\begin{pmatrix} 3 \\\\ -3 \\end{pmatrix}$$\n$$x^{n+1} = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} (\\frac{4}{5})(3) + (\\frac{2}{5})(-3) \\\\ (\\frac{1}{5})(3) + (\\frac{3}{5})(-3) \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} \\frac{12}{5} - \\frac{6}{5} \\\\ \\frac{3}{5} - \\frac{9}{5} \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} \\frac{6}{5} \\\\ -\\frac{6}{5} \\end{pmatrix}$$\n$$x^{n+1} = \\begin{pmatrix} 4 + \\frac{6}{5} \\\\ 3 - \\frac{6}{5} \\end{pmatrix} = \\begin{pmatrix} \\frac{20}{5} + \\frac{6}{5} \\\\ \\frac{15}{5} - \\frac{6}{5} \\end{pmatrix} = \\begin{pmatrix} \\frac{26}{5} \\\\ \\frac{9}{5} \\end{pmatrix}$$\n\nThe updated state is $x^{n+1} = \\begin{pmatrix} 26/5 \\\\ 9/5 \\end{pmatrix}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{26}{5} & \\frac{9}{5}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}