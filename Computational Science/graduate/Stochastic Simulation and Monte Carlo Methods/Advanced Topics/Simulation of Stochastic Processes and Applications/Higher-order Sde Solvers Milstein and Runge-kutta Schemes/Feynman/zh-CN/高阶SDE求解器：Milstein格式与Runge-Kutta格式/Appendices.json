{
    "hands_on_practices": [
        {
            "introduction": "第一个实践对 Milstein 格式的准确性进行了基础分析。通过将该方法应用于我们熟知的几何布朗运动模型，您将从 Itô-Taylor 展开式中推导出一阶步长公式，并通过计算其主导的局部强误差项来精确量化其相对于 Euler-Maruyama 格式的改进。这个练习将巩固 Milstein 格式具有 1 阶强收敛性的理论基础。",
            "id": "3311886",
            "problem": "考虑几何布朗运动的一维随机微分方程 (SDE)，\n$$\ndX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t},\n$$\n其中 $W_{t}$ 是一个标准布朗运动，$\\mu\\in\\mathbb{R}$ 和 $\\sigma>0$ 是常数，且 $X_{t}>0$。以 Itô 微积分和 Itô–Taylor 展开为基本工具，对大小为 $h>0$ 的单个时间步长执行以下操作：\n- 从应用于 $\\ln X_{t}$ 的 Itô 公式出发，推导 $X_{t+h}$ 关于 $X_{t}$ 和布朗增量 $\\Delta W:=W_{t+h}-W_{t}$ 的单步精确解表达式。\n- 从该 SDE 的 Itô–Taylor 展开式中，构建专门针对此 SDE 的单步 Milstein 离散格式，并通过关于 $h$ 和 $\\Delta W$ 幂的系统级数展开，将其与单步精确解进行比较。\n- 证明在强意义下（即，在关于布朗增量的 $L^{2}$ 意义下），Milstein 更新与精确的指数解相合，其误差项的阶为 $h^{3/2}$。\n- 计算由以下渐近展开式定义的领先强局部均方误差常数 $C(\\mu,\\sigma)$\n$$\n\\mathbb{E}\\!\\left[\\left(X_{t+h}-X_{t+h}^{\\mathrm{Mil}}\\right)^{2}\\,\\big|\\,X_{t}\\right]=C(\\mu,\\sigma)\\,X_{t}^{2}\\,h^{3}+o(h^{3})\\quad\\text{as }h\\to 0,\n$$\n其中 $X_{t+h}^{\\mathrm{Mil}}$ 表示单步 Milstein 更新。\n\n将你的最终答案表示为 $C(\\mu,\\sigma)$ 的一个单一闭式解析表达式。不需要进行数值近似。",
            "solution": "用户想要解决一个关于随机微分方程（SDEs）数值分析的问题，特别是针对几何布朗运动（GBM）。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n- 几何布朗运动的 SDE 是 $dX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t}$。\n- $W_{t}$ 是一个标准布朗运动。\n- $\\mu\\in\\mathbb{R}$ 和 $\\sigma>0$ 是常数。\n- 状态为正，$X_{t}>0$。\n- 时间步长为 $h>0$。\n- 布朗增量是 $\\Delta W:=W_{t+h}-W_{t}$。\n- 任务是：\n    1. 使用关于 $\\ln X_{t}$ 的 Itô 公式推导 $X_{t+h}$ 的单步精确解。\n    2. 构建此 SDE 的单步 Milstein 离散格式。\n    3. 通过级数展开将 Milstein 格式与精确解进行比较。\n    4. 证明 Milstein 更新与精确解匹配，其强阶误差为 $h^{3/2}$。\n    5. 根据渐近关系式 $\\mathbb{E}\\!\\left[\\left(X_{t+h}-X_{t+h}^{\\mathrm{Mil}}\\right)^{2}\\,\\big|\\,X_{t}\\right]=C(\\mu,\\sigma)\\,X_{t}^{2}\\,h^{3}+o(h^{3})$（当 $h\\to 0$ 时）计算领先的强局部均方误差常数 $C(\\mu,\\sigma)$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地植根于随机微积分和 SDE 数值分析的既定数学理论。GBM、Itô 公式、Itô-Taylor 展开和 Milstein 格式是该领域的标准和基本概念。\n- **适定性：** 该问题是适定的，提供了一个明确定义的 SDE 和一系列任务，这些任务导向一个唯一的、可确定的常数 $C(\\mu,\\sigma)$。所有必要的参数和定义都已提供。\n- **客观性：** 该问题使用精确、无歧义的数学语言和符号进行陈述。没有主观或基于观点的内容。\n- **缺陷检查表：**\n    1.  没有科学或事实上的不健全之处。\n    2.  该问题是一个直接切题的正式数学练习。\n    3.  设置是完整和一致的。\n    4.  该问题是理论性的，不涉及不切实际的物理条件。\n    5.  该问题结构良好，并导向一个唯一的解。\n    6.  该问题是一个标准的、非平凡的练习，用于测试核心概念。\n    7.  结果在数学上是可验证的。\n\n**步骤 3：结论和行动**\n该问题被判定为**有效**。将按照指定的任务推导解答。\n\n**分步解答**\n\n目标是计算常数 $C(\\mu,\\sigma)$，该常数刻画了应用于几何布朗运动 SDE 的 Milstein 格式的局部均方误差的主项。这将按照要求分四个阶段完成。\n\n**1. 精确解的推导**\n\n我们考虑 SDE $dX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t}$。设函数为 $f(x) = \\ln x$。其导数为 $f'(x) = 1/x$ 和 $f''(x) = -1/x^2$。我们将 Itô 公式应用于 $Y_t = f(X_t) = \\ln X_t$：\n$$\ndY_{t} = f'(X_{t})\\,dX_{t} + \\frac{1}{2}f''(X_{t})\\,(dX_{t})^{2}\n$$\n二次变差项 $(dX_{t})^2$ 由 $(\\sigma X_{t}\\,dW_{t})^2 = \\sigma^2 X_{t}^2\\,dt$ 给出。将 SDE 和二次变差项代入 Itô 公式，得到：\n$$\nd(\\ln X_{t}) = \\frac{1}{X_{t}}(\\mu X_{t}\\,dt + \\sigma X_{t}\\,dW_{t}) + \\frac{1}{2}\\left(-\\frac{1}{X_{t}^{2}}\\right)(\\sigma^{2}X_{t}^{2}\\,dt)\n$$\n$$\nd(\\ln X_{t}) = (\\mu\\,dt + \\sigma\\,dW_{t}) - \\frac{1}{2}\\sigma^{2}\\,dt\n$$\n$$\nd(\\ln X_{t}) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)dt + \\sigma\\,dW_{t}\n$$\n将此式从 $t$ 积分到 $t+h$：\n$$\n\\int_{t}^{t+h} d(\\ln X_{s}) = \\int_{t}^{t+h} \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)ds + \\int_{t}^{t+h} \\sigma\\,dW_{s}\n$$\n$$\n\\ln X_{t+h} - \\ln X_{t} = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma(W_{t+h} - W_{t})\n$$\n使用定义 $\\Delta W = W_{t+h} - W_{t}$，我们得到：\n$$\n\\ln\\left(\\frac{X_{t+h}}{X_{t}}\\right) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma \\Delta W\n$$\n对两边取指数，得到 $X_{t+h}$ 的精确解：\n$$\nX_{t+h} = X_{t} \\exp\\left(\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma \\Delta W\\right)\n$$\n\n**2. Milstein 离散格式的构建**\n\n对于 SDE $dX_t = a(X_t)dt + b(X_t)dW_t$，其通用的单步 Milstein 离散格式由 Itô-Taylor 展开给出：\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t} + a(X_{t})h + b(X_{t})\\Delta W + \\frac{1}{2}b(X_{t})b'(X_{t})\\left((\\Delta W)^{2} - h\\right)\n$$\n对于 GBM SDE，我们有漂移项 $a(x) = \\mu x$ 和扩散项 $b(x) = \\sigma x$。扩散系数关于 $x$ 的导数是 $b'(x) = \\sigma$。\n因此，项 $b(X_{t})b'(X_{t}) = (\\sigma X_{t})(\\sigma) = \\sigma^{2}X_{t}$。\n将这些代入通用的 Milstein 公式中，得到：\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t} + (\\mu X_{t})h + (\\sigma X_{t})\\Delta W + \\frac{1}{2}(\\sigma^{2}X_{t})\\left((\\Delta W)^{2} - h\\right)\n$$\n提出因子 $X_{t}$：\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t}\\left[1 + \\mu h + \\sigma \\Delta W + \\frac{1}{2}\\sigma^{2}\\left((\\Delta W)^{2} - h\\right)\\right]\n$$\n\n**3. 比较和强误差阶**\n\n为了将 Milstein 近似与精确解进行比较，我们将精确解展开为泰勒级数。令 $K = \\mu - \\frac{1}{2}\\sigma^{2}$。精确解为 $X_{t+h} = X_{t}\\exp(Kh + \\sigma \\Delta W)$。\n指数函数的展开式为 $\\exp(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\dots$。\n令 $z = Kh + \\sigma\\Delta W$。\n$$\n\\frac{X_{t+h}}{X_{t}} = 1 + (Kh + \\sigma \\Delta W) + \\frac{1}{2}(Kh + \\sigma \\Delta W)^{2} + \\frac{1}{6}(Kh + \\sigma \\Delta W)^{3} + O(h^{2})\n$$\nMilstein 格式可以重写为：\n$$\n\\frac{X_{t+h}^{\\mathrm{Mil}}}{X_{t}} = 1 + (\\mu - \\frac{1}{2}\\sigma^{2})h + \\frac{1}{2}\\sigma^{2}h + \\sigma \\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2} - \\frac{1}{2}\\sigma^{2}h = 1 + Kh + \\sigma\\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2}\n$$\n局部误差为 $E_{t+h} = X_{t+h} - X_{t+h}^{\\mathrm{Mil}}$。两边除以 $X_t$：\n$$\n\\frac{E_{t+h}}{X_{t}} = \\left(\\frac{X_{t+h}}{X_{t}}\\right) - \\left(\\frac{X_{t+h}^{\\mathrm{Mil}}}{X_{t}}\\right)\n$$\n$$\n\\frac{E_{t+h}}{X_{t}} = \\left[1 + (Kh + \\sigma \\Delta W) + \\frac{1}{2}(Kh + \\sigma \\Delta W)^{2} + \\dots\\right] - \\left[1 + Kh + \\sigma\\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2}\\right]\n$$\n项 $1$、$Kh$ 和 $\\sigma\\Delta W$ 相互抵消。\n$$\n\\frac{E_{t+h}}{X_{t}} = \\frac{1}{2}\\left[(Kh + \\sigma \\Delta W)^{2} - \\sigma^{2}(\\Delta W)^{2}\\right] + \\frac{1}{6}(Kh + \\sigma \\Delta W)^{3} + \\dots\n$$\n展开平方项和立方项：\n$$\n\\frac{E_{t+h}}{X_{t}} = \\frac{1}{2}\\left[K^{2}h^{2} + 2K\\sigma h \\Delta W + \\sigma^{2}(\\Delta W)^{2} - \\sigma^{2}(\\Delta W)^{2}\\right] + \\frac{1}{6}\\left[\\sigma^{3}(\\Delta W)^{3} + 3K\\sigma^{2}h(\\Delta W)^{2} + \\dots\\right] + \\dots\n$$\n$$\n\\frac{E_{t+h}}{X_{t}} = K\\sigma h \\Delta W + \\frac{1}{2}K^{2}h^{2} + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3} + \\frac{1}{2}K\\sigma^{2}h(\\Delta W)^{2} + \\dots\n$$\n一个项的强阶由其 $L^{2}$ 范数决定。我们有 $\\|\\Delta W\\|_{L^2} \\propto h^{1/2}$。\n误差中的主项是 $K\\sigma h \\Delta W$ 和 $\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}$。\n第一项的 $L^2$-范数是 $\\|K\\sigma h \\Delta W\\|_{L^2} = |K\\sigma| h \\|\\Delta W\\|_{L^2} = |K\\sigma| h^{3/2}$，其阶为 $h^{3/2}$。\n第二项的 $L^2$-范数是 $\\|\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\|_{L^2} = \\frac{1}{6}|\\sigma^{3}| (\\mathbb{E}[(\\Delta W)^{6}])^{1/2} = \\frac{1}{6}|\\sigma^{3}| (15h^{3})^{1/2} \\propto h^{3/2}$。\n由于最低阶误差项的强阶为 $h^{3/2}$，Milstein 格式与精确解的匹配达到了这个阶。\n\n**4. 误差常数 $C(\\mu, \\sigma)$ 的计算**\n\n我们需要计算 $\\mathbb{E}[E_{t+h}^{2} | X_{t}]$，即 $X_{t}^{2} \\mathbb{E}[ (E_{t+h}/X_{t})^{2} ]$。我们需要找到该期望中 $h^3$ 的系数。上面找到的误差主项就足够了。令 $R_{h} = E_{t+h}/X_{t}$。\n$R_h$ 中对 $\\mathbb{E}[R_h^2]$ 的 $h^3$ 项有贡献的部分，由强阶为 $h^{3/2}$ 的项组成。\n$$\nR_{h}^{(1.5)} = K\\sigma h \\Delta W + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\n$$\n$R_h$ 中的更高阶项包含诸如 $h^2$、$h(\\Delta W)^2$ 等项，它们的强阶为 $h^2$。平方后，这些项对均方误差的贡献将是 $h^4$ 阶或更高阶。由于 $\\Delta W$ 的奇数阶矩为零，$R_{h}^{(1.5)}$ 与具有 $\\Delta W$ 偶次幂的高阶项之间的交叉项的期望将为零。因此，我们只需要计算 $\\mathbb{E}[(R_h^{(1.5)})^2]$。\n$$\n\\mathbb{E}\\left[\\left(K\\sigma h \\Delta W + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right)^{2}\\right] = \\mathbb{E}\\left[ (K\\sigma h \\Delta W)^{2} + 2(K\\sigma h \\Delta W)\\left(\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right) + \\left(\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right)^{2} \\right]\n$$\n$$\n= K^{2}\\sigma^{2}h^{2}\\mathbb{E}[(\\Delta W)^{2}] + \\frac{1}{3}K\\sigma^{4}h\\,\\mathbb{E}[(\\Delta W)^{4}] + \\frac{1}{36}\\sigma^{6}\\mathbb{E}[(\\Delta W)^{6}]\n$$\n布朗增量 $\\Delta W \\sim N(0,h)$ 的矩为 $\\mathbb{E}[(\\Delta W)^{2}] = h$、$\\mathbb{E}[(\\Delta W)^{4}] = 3h^{2}$ 和 $\\mathbb{E}[(\\Delta W)^{6}] = 15h^{3}$。将它们代入：\n$$\n= K^{2}\\sigma^{2}h^{2}(h) + \\frac{1}{3}K\\sigma^{4}h(3h^{2}) + \\frac{1}{36}\\sigma^{6}(15h^{3})\n$$\n$$\n= \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{15}{36}\\sigma^{6}\\right)h^{3} = \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\\right)h^{3}\n$$\n因此，$\\mathbb{E}[E_{t+h}^2 | X_t] = X_t^2 \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\\right)h^{3} + o(h^3)$。\n该常数为 $C(\\mu,\\sigma) = K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}$。\n现在代回 $K = \\mu - \\frac{1}{2}\\sigma^{2}$：\n$$\nC(\\mu,\\sigma) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)^{2}\\sigma^{2} + \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\n$$\n展开各项：\n$$\n= \\left(\\mu^{2} - \\mu\\sigma^{2} + \\frac{1}{4}\\sigma^{4}\\right)\\sigma^{2} + \\left(\\mu\\sigma^{4} - \\frac{1}{2}\\sigma^{6}\\right) + \\frac{5}{12}\\sigma^{6}\n$$\n$$\n= \\mu^{2}\\sigma^{2} - \\mu\\sigma^{4} + \\frac{1}{4}\\sigma^{6} + \\mu\\sigma^{4} - \\frac{1}{2}\\sigma^{6} + \\frac{5}{12}\\sigma^{6}\n$$\n项 $-\\mu\\sigma^4$ 和 $+\\mu\\sigma^4$ 相互抵消。我们合并 $\\sigma^6$ 的系数：\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{1}{4} - \\frac{1}{2} + \\frac{5}{12}\\right)\n$$\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{3}{12} - \\frac{6}{12} + \\frac{5}{12}\\right)\n$$\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{2}{12}\\right)\n$$\n$$\nC(\\mu,\\sigma) = \\mu^{2}\\sigma^{2} + \\frac{1}{6}\\sigma^{6}\n$$\n这就是领先的强局部均方误差常数的最终表达式。",
            "answer": "$$\\boxed{\\mu^{2}\\sigma^{2}+\\frac{1}{6}\\sigma^{6}}$$"
        },
        {
            "introduction": "从一维转向多维揭示了高阶求解器中的一个关键精妙之处，这也是本练习的重点。您将研究 Milstein 格式的准确性如何依赖于扩散向量场的交换性，并发现对于非交换系统，Lévy 面积的必要性。这个实践展示了为何简单地扩展标量 Milstein 格式可能会失败，并为通用多维随机微分方程的更复杂方法的发展提供了动力。",
            "id": "3311879",
            "problem": "考虑标量情形下的伊藤随机微分方程 (SDE)\n$$\ndX_{t} \\;=\\; a\\!\\left(X_{t}\\right) \\, dt \\;+\\; b\\!\\left(X_{t}\\right) \\, dW_{t}, \\qquad X_{0} \\in \\mathbb{R},\n$$\n其中 $a:\\mathbb{R}\\to\\mathbb{R}$ 和 $b:\\mathbb{R}\\to\\mathbb{R}$ 是充分光滑的函数，其有界导数的阶数足以满足下文论证所需，且 $W_{t}$ 是一个标准布朗运动。使用伊藤-泰勒展开和强近似下的有色根树理论来解决以下问题。\n\n首先，从伊藤公式和与有色根树相关的基本微分的定义出发，验证一个单步格式。该格式通过在一维情况下唯一的$1$阶随机修正项来增强欧la-丸山增量，并证明其在标量情形下满足所有直到$1$阶的基于树的强阶条件。你的推导必须显式地将伊藤-泰勒展开的系数与该格式对所有阶数至多为$1$的树的基本权重进行匹配，不得依赖任何预先给定的离散化公式。\n\n接下来，考虑无漂移项的多维伊藤SDE\n$$\ndX_{t} \\;=\\; b_{1}\\!\\left(X_{t}\\right) \\, dW^{1}_{t} \\;+\\; b_{2}\\!\\left(X_{t}\\right) \\, dW^{2}_{t}, \\qquad X_{t}\\in\\mathbb{R}^{2},\n$$\n其中 $W^{1}_{t}$ 和 $W^{2}_{t}$ 是相互独立标准布朗运动，扩散向量场为\n$$\nb_{1}(x) \\;=\\; \\begin{pmatrix} x_{2} \\\\ 0 \\end{pmatrix}, \n\\qquad \nb_{2}(x) \\;=\\; \\begin{pmatrix} 0 \\\\ x_{1} \\end{pmatrix},\n\\qquad x \\;=\\; \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}.\n$$\n从斯特拉托诺维奇-泰勒展开以及对称和反对称迭代随机积分之间的关系出发，确定哪些基于树的$1$阶条件必然涉及列维面积。解释为什么在存在非对易扩散向量场的情况下，在米尔斯坦型方法中省略列维面积的模拟会导致这些条件失效。\n\n最后，假设一个单步法，该方法包含了所有可通过布朗增量乘积表示的对称迭代随机积分贡献，但没有模拟列维面积。对于从确定性初值 $X_{t}=x$ 开始的长度为 $h>0$ 的单个时间步，定义局部强误差为 $e_{h} \\coloneqq X_{t+h} - X_{t+h}^{\\text{num}}$。通过计算以下极限，求出仅由缺失的列维面积引起的领先阶均方局部误差系数\n$$\nC(x) \\;=\\; \\lim_{h \\to 0} \\; \\frac{12}{h^{2}} \\, \\mathbb{E}\\!\\left[ \\, \\| e_{h} \\|^{2} \\, \\big| \\, X_{t}=x \\right],\n$$\n其中 $\\| \\cdot \\|$ 是 $\\mathbb{R}^{2}$ 上的欧几里得范数。将你的最终答案表示为一个关于 $x_{1}$ 和 $x_{2}$ 的简化解析表达式。不需要数值近似。最终答案必须以一个无单位的、单一的封闭形式解析表达式给出。",
            "solution": "用户希望我解决一个关于随机微分方程（SDEs）高阶数值方法的三部分问题。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n**第1部分：**\n- 标量伊藤SDE：$dX_{t} = a(X_{t}) dt + b(X_{t}) dW_{t}$，其中 $X_{0} \\in \\mathbb{R}$。\n- $a:\\mathbb{R}\\to\\mathbb{R}$ 和 $b:\\mathbb{R}\\to\\mathbb{R}$ 是具有有界导数的充分光滑函数。\n- $W_{t}$ 是标准布朗运动。\n- 任务：验证一个由欧拉-丸山增量加上唯一的$1$阶随机修正项组成的单步格式，在标量情况下满足所有直到$1$阶的基于树的强阶条件。\n- 方法：使用伊藤-泰勒展开和有色根树。推导必须对所有阶数不超过$1$的树匹配系数。\n\n**第2部分：**\n- 多维伊藤SDE：$dX_{t} = b_{1}(X_{t}) dW^{1}_{t} + b_{2}(X_{t}) dW^{2}_{t}$，其中 $X_{t}\\in\\mathbb{R}^{2}$。\n- $W^{1}_{t}$ 和 $W^{2}_{t}$ 是独立标准布朗运动。\n- 扩散向量场：$b_{1}(x) = \\begin{pmatrix} x_{2} \\\\ 0 \\end{pmatrix}$，$b_{2}(x) = \\begin{pmatrix} 0 \\\\ x_{1} \\end{pmatrix}$，对于 $x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}$。\n- 任务：从斯特拉托诺维奇-泰勒展开出发，确定哪些基于树的$1$阶条件涉及列维面积。解释为什么对于非对易扩散场，省略列维面积模拟会导致这些条件失效。\n\n**第3部分：**\n- 格式：一个包含所有对称迭代随机积分贡献但不模拟列维面积的单步法。\n- 时间步长 $h > 0$，从确定性初值 $X_{t}=x$ 开始。\n- 局部强误差：$e_{h} \\coloneqq X_{t+h} - X_{t+h}^{\\text{num}}$。\n- 任务：计算领先阶均方局部误差系数：$C(x) = \\lim_{h \\to 0} \\frac{12}{h^{2}} \\mathbb{E}[ \\| e_{h} \\|^{2} | X_{t}=x ]$。\n- 范数 $\\| \\cdot \\|$ 是 $\\mathbb{R}^{2}$ 上的欧几里得范数。\n- 答案必须是关于 $x_1$ 和 $x_2$ 的解析表达式。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固植根于SDE数值分析理论，这是一个成熟的数学领域。它使用了伊藤-泰勒展开、根树理论（SDE的B-series）、列维面积和李括号等标准概念。所有概念都是标准的、数学上严谨的。给定的SDE是标准示例。\n- **适定性：** 问题的每个部分都有明确定义。第1部分要求验证，第2部分要求解释，第3部分要求计算。设置提供了所有必要信息（SDE、定义和要计算的量），从而导出一个唯一且有意義的解。\n- **客观性：** 问题以精确的数学语言陈述，没有任何主观性或偏见。\n\n**第3步：结论与行动**\n问题是有效的。这是随机数值分析中的一个标准且具有挑战性的问题。我将继续进行求解。\n\n### 第1部分：标量SDE和1阶格式验证\n\n数值格式的强阶条件关系到其再现真实解的伊藤-泰勒展开中各项的能力。这种匹配通过有色根树来形式化。如果一个格式的基本权重与真实解对所有阶数小于或等于$p$的树的基本随机变量相匹配，则该格式具有强收敛阶$p$。\n\n对于标量SDE $dX_{t} = a(X_{t}) dt + b(X_{t}) dW_{t}$，解 $X_{t+h}$ 在 $X_t$ 附近的伊藤-泰勒展开由一个包含迭代伊藤积分的级数给出。这些项可以与有色根树相关联。我们关心的是阶数至多为$1$的树。\n\n相关的树是：\n1.  空树 $\\emptyset$，阶数为$0$。它对应于解值 $X_t$ 本身。\n2.  树 $\\tau_1 = \\bullet_1$（一个白色单根，索引$1$代表维纳过程），阶数为$0.5$。它对应于基本微分 $F(\\tau_1) = b$ 和基本随机变量 $\\alpha_h(\\tau_1) = I_{(1)} = \\int_t^{t+h} dW_s = \\Delta W_h$。\n3.  树 $\\tau_0 = \\bullet_0$（一个黑色单根，索引$0$代表时间），阶数为$1$。它对应于基本微分 $F(\\tau_0) = a$ 和基本随机变量 $\\alpha_h(\\tau_0) = I_{(0)} = \\int_t^{t+h} ds = h$。\n4.  树 $\\tau_{11} = [\\bullet_1]_1$（一个带单个白色子节点的白色根），阶数为 $g(\\bullet_1)+g(\\bullet_1) = 0.5+0.5=1$。它对应于基本微分 $F(\\tau_{11}) = b'b$ （其中 $b'=\\frac{db}{dx}$）和基本随机变量 $\\alpha_h(\\tau_{11}) = I_{(1,1)} = \\int_t^{t+h}\\int_t^s dW_{s'}dW_s = \\frac{1}{2}((\\Delta W_h)^2 - h)$。\n\n更高阶的树，如 $\\tau_{01}$ ($g=1.5$) 和 $\\tau_{10}$ ($g=1.5$)，与$1$阶条件无关。\n\n真实解直到$1$阶项的伊藤-泰勒展开为：\n$$\nX_{t+h} = X_t + F(\\tau_0)(X_t) \\alpha_h(\\tau_0) + F(\\tau_1)(X_t) \\alpha_h(\\tau_1) + F(\\tau_{11})(X_t) \\alpha_h(\\tau_{11}) + O(h^{3/2})\n$$\n$$\nX_{t+h} = X_t + a(X_t) h + b(X_t) \\Delta W_h + b(X_t)b'(X_t) \\frac{1}{2}((\\Delta W_h)^2 - h) + O(h^{3/2})\n$$\n\n问题描述了一个用“唯一的$1$阶随机修正项”来增强欧拉-丸山增量的格式。欧拉-丸山格式为 $X_{n+1}^{\\text{EM}} = X_n + a(X_n)h + b(X_n)\\Delta W_h$。唯一缺失的$1$阶项是对应于树 $\\tau_{11}$ 的项。因此，“随机修正项”就是正确逼近 $I_{(1,1)}$ 积分贡献的项。这就导出了米尔斯坦格式。\n\n该格式为：\n$$\nX_{t+h}^{\\text{num}} = X_t + \\underbrace{a(X_t)h + b(X_t)\\Delta W_h}_{\\text{Euler-Maruyama increment}} + \\underbrace{\\frac{1}{2}b(X_t)b'(X_t) ((\\Delta W_h)^2 - h)}_{\\text{order-1 stochastic correction}}\n$$\n\n为验证阶条件，我们必须通过将其项与形式 $\\sum_{\\tau} F(\\tau)(X_t) \\phi(\\tau)$ 进行匹配，来确定格式的基本权重 $\\phi(\\tau)$。\n通过直接比较：\n- 对于 $\\tau_0$：$F(\\tau_0)=a$ 的系数是 $h$。所以，$\\phi(\\tau_0) = h$。\n- 对于 $\\tau_1$：$F(\\tau_1)=b$ 的系数是 $\\Delta W_h$。所以，$\\phi(\\tau_1) = \\Delta W_h$。\n- 对于 $\\tau_{11}$：$F(\\tau_{11})=b'b$ 的系数是 $\\frac{1}{2}((\\Delta W_h)^2 - h)$。所以，$\\phi(\\tau_{11}) = \\frac{1}{2}((\\Delta W_h)^2 - h)$。\n\n现在我们检查这些权重是否与所有阶数 $\\le 1$ 的树的基本随机变量相匹配：\n- 阶数 $0.5$: $\\phi(\\tau_1) = \\Delta W_h = \\alpha_h(\\tau_1)$。条件满足。\n- 阶数 $1$: $\\phi(\\tau_0) = h = \\alpha_h(\\tau_0)$。条件满足。\n- 阶数 $1$: $\\phi(\\tau_{11}) = \\frac{1}{2}((\\Delta W_h)^2 - h) = \\alpha_h(\\tau_{11})$。条件满足。\n\n由于所有直到$1$阶的基于树的强阶条件都得到满足，验证完成。\n\n### 第2部分：多维SDE和列维面积\n\n我们考虑SDE $dX_{t} = b_{1}(X_{t}) dW^{1}_{t} + b_{2}(X_{t}) dW^{2}_{t}$。一个强$1$阶格式必须正确逼近伊藤-泰勒展开直到$h$阶项。对于一个无漂移项的SDE，其展开式为：\n$$\nX_{t+h} = X_t + \\sum_{j=1,2} b_j(X_t) I_{(j)} + \\sum_{j,k=1,2} (L^k b_j)(X_t) I_{(k,j)} + O(h^{3/2})\n$$\n其中 $I_{(j)} = \\Delta W^j_h$, $I_{(k,j)} = \\int_t^{t+h} \\int_t^s dW^k_{s'} dW^j_s$, $L^k$是微分算子$L^k = \\sum_{i=1,2} b_k^i \\frac{\\partial}{\\partial x_i}$。\n\n$1$阶条件对应于阶数为$1$的树，即 $j,k \\in \\{1,2\\}$ 时的 $\\tau_{jk}$。对于树 $\\tau_{kj}$ 的条件是，格式必须正确表示项 $(L^k b_j) I_{(k,j)}$。\n\n多重随机积分 $I_{(k,j)}$可以被分解。对于 $j \\ne k$，我们有以下恒等式：\n1.  对称部分：$I_{(k,j)} + I_{(j,k)} = \\Delta W^j_h \\Delta W^k_h$\n2.  反对称部分（列维面积）：$A_{jk} = \\frac{1}{2} (I_{(j,k)} - I_{(k,j)})$\n\n由此，我们可以将积分 $I_{(k,j)}$ 表示为：\n$I_{(k,j)} = \\frac{1}{2}\\Delta W^j_h \\Delta W^k_h - A_{jk} = \\frac{1}{2}\\Delta W^j_h \\Delta W^k_h + A_{kj}$。\n\n我们来检验展开式中的交叉项（$j \\neq k$）之和：\n$$\n(L^2 b_1) I_{(2,1)} + (L^1 b_2) I_{(1,2)} = (L^2 b_1) \\left(\\frac{1}{2}\\Delta W^1_h \\Delta W^2_h + A_{21}\\right) + (L^1 b_2) \\left(\\frac{1}{2}\\Delta W^1_h \\Delta W^2_h + A_{12}\\right)\n$$\n使用 $A_{21} = -A_{12}$，表达式变为：\n$$\n\\frac{1}{2} (L^1 b_2 + L^2 b_1) \\Delta W^1_h \\Delta W^2_h + (L^1 b_2 - L^2 b_1) A_{12}\n$$\n项 $L^1 b_2 - L^2 b_1$ 是李括号 $[b_1, b_2]$。一个不模拟列维面积的米尔斯坦型方法仅包含对称部分，该部分可以用布朗增量 $\\Delta W^j_h$ 的乘积来表示。这样的格式用 $\\frac{1}{2}\\Delta W^j_h \\Delta W^k_h$ 来逼近 $I_{(k,j)}$。\n\n对于树 $\\tau_{kj}$（其中 $k \\neq j$），其基本微分为 $F(\\tau_{kj}) = L^k b_j$，如果格式使用权重 $\\tilde{\\phi}(\\tau_{kj}) = \\frac{1}{2}\\Delta W^k_h \\Delta W^j_h$ 而不是真实的随机变量 $\\alpha_h(\\tau_{kj}) = I_{(k,j)}$，则其阶条件会失效。差值为：\n$$\n\\alpha_h(\\tau_{kj}) - \\tilde{\\phi}(\\tau_{kj}) = I_{(k,j)} - \\frac{1}{2}\\Delta W^k_h \\Delta W^j_h = A_{kj}\n$$\n由这种错误近似引入的误差正比于 $(L^k b_j - L^j b_k) A_{kj} = [b_k,b_j] A_{kj}$。如果李括号 $[b_k, b_j]$ 非零，则该项非零。对于给定的向量场：\n$L^1 = x_2 \\frac{\\partial}{\\partial x_1}$, $L^2 = x_1 \\frac{\\partial}{\\partial x_2}$。\n$$\n[b_1, b_2] = L^1 b_2 - L^2 b_1 = x_2 \\frac{\\partial}{\\partial x_1} \\begin{pmatrix} 0 \\\\ x_1 \\end{pmatrix} - x_1 \\frac{\\partial}{\\partial x_2} \\begin{pmatrix} x_2 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ x_2 \\end{pmatrix} - \\begin{pmatrix} x_1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix}\n$$\n由于 $[b_1, b_2] \\neq 0$，扩散向量场不对易。因此，对应于树 $\\tau_{12}$ 和 $\\tau_{21}$ 的基于树的$1$阶条件必然涉及列维面积 $A_{12}$。省略其模拟会导致这些条件失效，从而使强收敛阶从$1.0$降至$0.5$。\n\n### 第3部分：均方局部误差计算\n\n局部强误差 $e_h = X_{t+h} - X_{t+h}^{\\text{num}}$。所考虑的数值格式包含对称贡献，但省略了列维面积项。这意味着它使用 $\\frac{1}{2}\\Delta W_h^k \\Delta W_h^j$ 来近似交叉迭代积分 $I_{(k,j)}$。\n\n真实解的伊藤-泰勒展开式与数值解的展开式之间的差值中，领先项来自于对交叉积分的近似误差。我们有：\n$$\ne_h = (X_t + \\dots + \\sum_{j \\neq k} L^k b_j I_{(k,j)}) - (X_t + \\dots + \\sum_{j \\neq k} L^k b_j \\frac{1}{2}\\Delta W_h^k \\Delta W_h^j) + O(h^{3/2})\n$$\n$$\ne_h \\approx \\sum_{j \\neq k} L^k b_j (I_{(k,j)} - \\frac{1}{2}\\Delta W_h^k \\Delta W_h^j)\n$$\n利用关系 $I_{(k,j)} = \\frac{1}{2}\\Delta W_h^k \\Delta W_h^j + A_{kj}$，其中 $A_{kj}$ 是列维面积，我们得到：\n$$\ne_h \\approx \\sum_{j \\neq k} L^k b_j A_{kj}\n$$\n在我们的二维案例中 ($j,k \\in \\{1,2\\}$)，并使用 $A_{21} = -A_{12}$：\n$$\ne_h \\approx L^2 b_1 A_{21} + L^1 b_2 A_{12} = (L^1 b_2 - L^2 b_1) A_{12} = [b_1, b_2] A_{12}\n$$\n我们已经计算出李括号为 $[b_1, b_2](x) = \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix}$。因此，领先的局部误差为：\n$$\ne_h(x) \\approx \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix} A_{12}\n$$\n接下来，我们计算其均方范数。\n$$\n\\mathbb{E}[\\|e_h\\|^2 | X_t=x] \\approx \\mathbb{E}\\left[ \\left\\| \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix} A_{12} \\right\\|^2 \\right] = \\mathbb{E}[ ((-x_1)^2 + x_2^2) A_{12}^2 ]\n$$\n$$\n\\mathbb{E}[\\|e_h\\|^2 | X_t=x] \\approx (x_1^2 + x_2^2) \\mathbb{E}[A_{12}^2]\n$$\n一个标准结果是，对于时间步长为 $h$ 的独立布朗运动，$I_{(1,2)}$ 和 $I_{(2,1)}$ 的相关性结构导致列维面积 $A_{12} = \\frac{1}{2}(I_{(1,2)} - I_{(2,1)})$ 的方差为 $\\mathbb{E}[A_{12}^2] = \\frac{h^2}{12}$。\n将此结果代入：\n$$\n\\mathbb{E}[\\|e_h\\|^2 | X_t=x] \\approx (x_1^2 + x_2^2) \\frac{h^2}{12}\n$$\n最后，我们计算问题中定义的常数 $C(x)$：\n$$\nC(x) = \\lim_{h \\to 0} \\frac{12}{h^2} \\mathbb{E}[ \\| e_{h} \\|^{2} | X_{t}=x ] = \\lim_{h \\to 0} \\frac{12}{h^2} \\left( (x_1^2 + x_2^2) \\frac{h^2}{12} + o(h^2) \\right)\n$$\n$$\nC(x) = x_1^2 + x_2^2\n$$\n这是仅由缺失的列维面积项引起的领先阶均方局部误差系数。",
            "answer": "$$\\boxed{x_{1}^{2} + x_{2}^{2}}$$"
        },
        {
            "introduction": "我们最后的实践从欧几里得空间转向了重要的曲面流形设置，特别是旋转群 $SO(3)$。您将为一个随机姿态动力学模型实现并比较不同的积分器，将忽略结构的方法与保持结构的李群积分器进行对比。这个动手模拟突出了在非线性空间上精确建模随机系统时所面临的实际挑战和解决方案，这是物理学和工程学中的一项常见任务。",
            "id": "3311871",
            "problem": "构造一个完整、可运行的程序，用于比较在带有乘性噪声的特殊正交群 $SO(3)$ 上的一个左不变随机微分方程的三种数值积分器。该随机模型以 Stratonovich 形式由下式给出\n$$\n\\mathrm{d}R(t)=R(t)\\circ\\left(A\\,\\mathrm{d}t+B\\,\\mathrm{d}W(t)\\right),\\qquad R(0)=I_{3},\n$$\n其中 $R(t)\\in SO(3)$ 是一个旋转矩阵，$I_{3}$ 是 $3\\times 3$ 单位矩阵，$W(t)$ 是一维标准布朗运动，而 $A,B\\in\\mathfrak{so}(3)$ 是生成围绕同一固定轴旋转的常数斜对称矩阵。具体来说，使用\n$$\nK_{z}=\\begin{bmatrix}0  -1  0 \\\\ 1  0  0 \\\\ 0  0  0 \\end{bmatrix},\\qquad A=\\omega K_{z},\\qquad B=\\sigma K_{z},\n$$\n其中 $\\omega$ 和 $\\sigma$ 为标量参数。布朗增量必须使用方差为 $\\Delta t$ 的独立正态随机变量进行模拟。\n\n您必须实现并比较以下三种格式：\n\n- 一种 Itō 意义下的 Milstein 方法，应用于上述 Stratonovich 系统转换后的 Itō 形式，在矩阵的环境欧几里得空间中运行。在两种模式下对其进行评估：不进行任何校正，以及每一步之后都投影到 $SO(3)$ 上。\n- 一种用于 Stratonovich 方程的随机 Runge-Kutta (SRK) 方法，具体为随机 Heun 格式，在矩阵的环境欧几里得空间中运行。在两种模式下对其进行评估：不进行任何校正，以及每一步之后都投影到 $SO(3)$ 上。\n- 一种李群指数积分器，它通过右乘每个时间步的李代数增量的矩阵指数来进行更新，从而通过构造保留 $SO(3)$ 结构。\n\n您可以依赖的基本定义如下：\n- 矩阵值随机微分方程的 Stratonovich 到 Itō 转换，其中对于一个具有常数 $B$ 的左不变向量场 $V(R)=R B$，校正项为 $\\tfrac{1}{2}R B^{2}\\,\\mathrm{d}t$。\n- Milstein 方法是继 Euler-Maruyama 之后更高阶的强格式，它通过由扩散项的雅可比矩阵驱动的一阶校正来包含迭代随机积分。\n- 用于 Stratonovich 方程的随机 Runge-Kutta (SRK) Heun 方法是一种预测-校正格式，在系数足够光滑的情况下，其强阶为一。\n- 在 Frobenius 范数意义下，一个实 $3\\times 3$ 矩阵 $M$ 到 $SO(3)$ 的最近投影是通过使用奇异值分解 $M=U\\Sigma V^{\\top}$ 的极分解得到的，并取 $Q=U\\operatorname{diag}(1,1,\\det(UV^{\\top}))V^{\\top}$ 以强制 $\\det(Q)=+1$。\n- $R_{1},R_{2}\\in SO(3)$ 之间的测地线旋转角距离由下式计算\n$$\n\\theta(R_{1},R_{2})=\\arccos\\!\\left(\\frac{\\operatorname{tr}(R_{1}^{\\top}R_{2})-1}{2}\\right),\n$$\n其结果必须以弧度为单位进行评估，其中 $\\arccos$ 的参数在数值上被限制在区间 $\\left[-1,1\\right]$ 内。\n\n由于在此设置中 $A$ 和 $B$ 是可交换的，对于给定的布朗路径，在时间 $T$ 的精确 Stratonovich 解为：\n$$\nR_{\\text{exact}}(T)=R(0)\\,\\exp\\!\\big(A\\,T+B\\,W(T)\\big),\n$$\n其中 $W(T)$ 是由数值格式中使用的相同增量累积而成的布朗运动终值。\n\n您的程序必须：\n- 对每个测试用例，使用指定的种子生成一个固定的布朗增量序列，并在该测试用例中对所有三种方法使用相同的增量，以实现逐路径比较。\n- 为环境空间中的 Milstein 和 SRK-Heun 方法实现未投影和投影两种变体，其中在投影变体中，每一步之后都执行到 $SO(3)$ 的投影。\n- 将李群指数方法实现为逐步更新 $R_{n+1}=R_{n}\\exp\\!\\left(A\\,\\Delta t+B\\,\\Delta W_{n}\\right)$。\n\n对于每个测试用例，计算并报告以下八个量：\n1. 未投影的 Milstein 方法在最终时刻的 Frobenius 范数正交性缺陷 $||R^{\\top}R-I_{3}||_{F}$。\n2. 未投影的 SRK-Heun 方法在最终时刻的 Frobenius 范数正交性缺陷 $||R^{\\top}R-I_{3}||_{F}$。\n3. 未投影的 Milstein 方法在最终时刻的绝对行列式误差 $\\left|\\det(R)-1\\right|$。\n4. 未投影的 SRK-Heun 方法在最终时刻的绝对行列式误差 $\\left|\\det(R)-1\\right|$。\n5. 投影的 Milstein 解在最终时刻与精确解之间的测地线旋转角误差（以弧度为单位）。\n6. 投影的 SRK-Heun 解在最终时刻与精确解之间的测地线旋转角误差（以弧度为单位）。\n7. 李群指数方法在最终时刻的 Frobenius 范数正交性缺陷 $||R^{\\top}R-I_{3}||_{F}$。\n8. 李群指数解在最终时刻与精确解之间的测地线旋转角误差（以弧度为单位）。\n\n使用以下测试套件，其中总时间 $T$ 的单位与 $t$ 相同，时间步长为 $\\Delta t$，并且角度必须以弧度报告：\n- 案例 A (理想路径)：$T=1.0$，$\\Delta t=0.02$，$\\omega=1.3$，$\\sigma=0.7$，种子 $=1234$。\n- 案例 B (粗糙步长和更强噪声)：$T=1.0$，$\\Delta t=0.2$，$\\omega=1.3$，$\\sigma=1.5$，种子 $=5678$。\n- 案例 C (确定性边界)：$T=1.0$，$\\Delta t=0.05$，$\\omega=1.3$，$\\sigma=0.0$，种子 $=42$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。该列表必须按上面列出的确切顺序连接案例 A 的八个结果，然后是案例 B 的八个结果，最后是案例 C 的八个结果。所有角度都必须以弧度为单位。除弧度外，不需要其他单位。",
            "solution": "所提出的问题是在李群上的随机微分方程的几何数值积分领域中一个适定且科学上合理的任务。所有必要的参数、定义和评估指标均已提供，其基础数学框架也是标准的。因此，该问题被认为是有效的，并给出完整的解决方案。\n\n问题的核心是比较用于求解特殊正交群 $SO(3)$ 上的左不变随机微分方程 (SDE) 的数值方法，该方程以 Stratonovich 形式给出：\n$$\n\\mathrm{d}R(t) = R(t) \\circ (A\\,\\mathrm{d}t + B\\,\\mathrm{d}W(t)), \\quad R(0) = I_3\n$$\n其中 $R(t) \\in SO(3)$ 是一个 $3 \\times 3$ 旋转矩阵，$I_3$ 是单位矩阵，$W(t)$ 是一个一维标准布朗运动。矩阵 $A, B \\in \\mathfrak{so}(3)$ 是由 $A = \\omega K_z$ 和 $B = \\sigma K_z$ 定义的常数斜对称生成元，其中 $\\omega, \\sigma$ 是标量参数，且\n$$\nK_z = \\begin{bmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  0 \\end{bmatrix}.\n$$\n由于 $A$ 和 $B$ 是同一矩阵 $K_z$ 的标量倍，它们是可交换的：$[A, B] = AB - BA = 0$。这个性质至关重要，因为它能导出精确解的闭式表达式，该表达式可作为数值格式的基准。给定一个终值为 $W(T) = \\int_0^T \\mathrm{d}W(t)$ 的布朗路径实现，在时间 $T$ 的精确解为：\n$$\nR_{\\text{exact}}(T) = R(0) \\exp(A\\,T + B\\,W(T)) = \\exp(A\\,T + B\\,W(T))\n$$\n矩阵指数是针对斜对称矩阵 $A\\,T + B\\,W(T)$ 计算的，这保证了 $R_{\\text{exact}}(T) \\in SO(3)$。\n\n我们将实现并比较三种不同的数值积分格式。其中两种在环境欧几里得空间 $\\mathbb{R}^{3 \\times 3}$ 中运行，而第三种是通过构造来保持 $SO(3)$ 群结构的几何积分器。\n\n对于环境空间方法，我们必须区分 SDE 的 Stratonovich 形式和 Itō 形式。给定的方程是 Stratonovich 形式的。要应用像 Milstein 方法这样基于 Itō 的求解器，我们必须首先转换 SDE。对于一个噪声项为 $R(t) B$ 的左不变 SDE，其 Itō 校正项是 $\\frac{1}{2} R(t) B^2 \\mathrm{d}t$。将此应用于我们的 SDE，得到等价的 Itō 形式：\n$$\n\\mathrm{d}R(t) = R(t) (A + \\tfrac{1}{2}B^2)\\,\\mathrm{d}t + R(t) B\\,\\mathrm{d}W(t)\n$$\n\n数值格式的实现如下：\n\n1.  **Itō-Milstein 方法**：这是一种用于 Itō SDE 的 1.0 阶强格式。对于一般的矩阵 SDE $\\mathrm{d}X_t = f(X_t)\\mathrm{d}t + g(X_t)\\mathrm{d}W_t$，其格式为 $X_{n+1} = X_n + f(X_n)\\Delta t + g(X_n)\\Delta W_n + \\frac{1}{2}(Dg(X_n)[g(X_n)])((\\Delta W_n)^2 - \\Delta t)$，其中 $D g[v]$ 是方向导数。对于我们的 Itō SDE，我们有 $f(R) = R(A + \\frac{1}{2}B^2)$ 和 $g(R) = RB$。方向导数为 $Dg(R)[V] = VB$。因此，$Dg(R_n)[g(R_n)] = g(R_n)B = R_n B^2$。$R_{n+1} = R(t_n + \\Delta t)$ 的更新规则变为：\n    $$\n    R_{n+1} = R_n + R_n(A + \\tfrac{1}{2}B^2)\\Delta t + R_n B \\Delta W_n + \\tfrac{1}{2} R_n B^2 ((\\Delta W_n)^2 - \\Delta t)\n    $$\n    其中 $\\Delta W_n \\sim N(0, \\Delta t)$。这可以因式分解为：\n    $$\n    R_{n+1} = R_n \\left(I_3 + A\\Delta t + B\\Delta W_n + \\tfrac{1}{2}B^2(\\Delta W_n)^2\\right)\n    $$\n    此格式在矩阵的环境空间中实现。其解通常不会保持在 $SO(3)$ 中。我们分别在不进行校正和每步之后投影到 $SO(3)$ 两种情况下对其进行评估。\n\n2.  **随机 Runge-Kutta (SRK) 方法 (Heun 格式)**：这是一种用于 Stratonovich SDE 的 1.0 阶强预测-校正格式。对于 $\\mathrm{d}R = R A\\,\\mathrm{d}t + R B \\circ \\mathrm{d}W$，其步骤为：\n    - 预测步： $\\hat{R}_{n+1} = R_n + R_n A \\Delta t + R_n B \\Delta W_n$\n    - 校正步： $R_{n+1} = R_n + \\frac{1}{2}(R_n A + \\hat{R}_{n+1} A)\\Delta t + \\frac{1}{2}(R_n B + \\hat{R}_{n+1} B)\\Delta W_n$\n    与 Milstein 方法类似，此方法在 $\\mathbb{R}^{3 \\times 3}$ 中实现，并在有和没有每步投影到 $SO(3)$ 的情况下进行评估。\n\n3.  **李群指数积分器**：此方法直接利用李群结构。更新通过将当前状态右乘李代数增量的指数来执行。这内在地保留了群结构，确保对所有 $n$ 都有 $R_n \\in SO(3)$（在机器精度范围内）。更新规则如下：\n    $$\n    R_{n+1} = R_n \\exp(A \\Delta t + B \\Delta W_n)\n    $$\n    斜对称矩阵的矩阵指数始终是一个特殊正交矩阵。\n\n评估指标如下：\n- **正交性缺陷**：对于数值解 $R_{final}$，其与正交性的偏差由 Frobenius 范数 $||R_{final}^\\top R_{final} - I_3||_F$ 衡量。对于一个真正的正交矩阵，此值应为零。\n- **行列式误差**：与特殊正交群约束 $\\det(R)=+1$ 的偏差由 $|\\det(R_{final}) - 1|$ 衡量。\n- **测地线误差**：对于在 $SO(3)$ 中产生结果的方法（即投影方法和李群方法），其强误差是通过使用流形上的自然距离——测地线旋转角距离——与精确解进行比较来衡量的：\n$$\n\\theta(R_1, R_2) = \\arccos\\left(\\frac{\\operatorname{tr}(R_1^\\top R_2) - 1}{2}\\right)\n$$\n$\\arccos$ 函数的参数被限制在区间 $[-1, 1]$ 内，以处理潜在的浮点不精确性。\n\n实现过程首先是为给定的测试用例生成一个单一的布朗增量序列 $\\Delta W_n$。然后将此相同序列用于所有已实现的方法，以确保公平的、逐路径的比较。随后，在最终时间 $T$ 为三个测试用例中的每一个计算所需的八个指标。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, svd, det, norm\n\ndef project_so3(M):\n    \"\"\"Projects a 3x3 matrix M onto SO(3) using SVD.\"\"\"\n    U, _, Vt = svd(M)\n    d = det(U @ Vt)\n    # Ensure the determinant is +1\n    diag = np.array([1.0, 1.0, d])\n    Q = U @ np.diag(diag) @ Vt\n    return Q\n\ndef geodesic_dist(R1, R2):\n    \"\"\"Computes the geodesic rotation-angle distance between R1, R2 in SO(3).\"\"\"\n    # Angle is arccos((tr(R1^T R2) - 1)/2)\n    arg = (np.trace(R1.T @ R2) - 1.0) / 2.0\n    # Clamp argument to [-1, 1] to avoid domain errors from floating point inaccuracies\n    clamped_arg = np.clip(arg, -1.0, 1.0)\n    return np.arccos(clamped_arg)\n\ndef run_simulation(T, dt, omega, sigma, seed):\n    \"\"\"\n    Runs the simulation for a single test case and returns the 8 required metrics.\n    \"\"\"\n    # --- Setup ---\n    I_3 = np.identity(3)\n    Kz = np.array([[0., -1., 0.], [1., 0., 0.], [0., 0., 0.]])\n    A = omega * Kz\n    B = sigma * Kz\n    B_sq = B @ B\n\n    # Number of steps\n    if dt == 0:\n        raise ValueError(\"Time step dt must be positive.\")\n    N = int(T / dt)\n    # Re-adjust dt to exactly fit T\n    dt = T / N\n\n    # Generate the single path of Wiener increments for all methods\n    rng = np.random.default_rng(seed)\n    dZ = rng.normal(0, 1, N)\n    dW = np.sqrt(dt) * dZ\n    W_T = np.sum(dW)\n\n    # --- Initial states ---\n    R_mil_u = I_3.copy()\n    R_mil_p = I_3.copy()\n    R_srk_u = I_3.copy()\n    R_srk_p = I_3.copy()\n    R_lie = I_3.copy()\n\n    # --- Time-stepping loop ---\n    for n in range(N):\n        dW_n = dW[n]\n\n        # 1. Itō-Milstein method (unprojected and projected)\n        # R_{n+1} = R_n (I + A*dt + B*dW + 0.5*B^2*(dW^2))\n        mil_update_factor = I_3 + A*dt + B*dW_n + 0.5*B_sq*(dW_n**2)\n        R_mil_u_next = R_mil_u @ mil_update_factor\n        R_mil_u = R_mil_u_next\n        R_mil_p_next = R_mil_p @ mil_update_factor\n        R_mil_p = project_so3(R_mil_p_next)\n\n        # 2. SRK-Heun method (unprojected and projected)\n        # Predictor: \\hat{R} = R_n (I + A*dt + B*dW)\n        # Corrector: R_{n+1} = R_n + 0.5*(RA + \\hat{R}A)dt + 0.5*(RB + \\hat{R}B)dW\n        \n        # Unprojected SRK-Heun\n        R_hat_srk_u = R_srk_u @ (I_3 + A*dt + B*dW_n)\n        update_u = 0.5 * (R_srk_u @ A + R_hat_srk_u @ A) * dt + \\\n                   0.5 * (R_srk_u @ B + R_hat_srk_u @ B) * dW_n\n        R_srk_u = R_srk_u + update_u\n        \n        # Projected SRK-Heun\n        R_hat_srk_p = R_srk_p @ (I_3 + A*dt + B*dW_n)\n        update_p = 0.5 * (R_srk_p @ A + R_hat_srk_p @ A) * dt + \\\n                   0.5 * (R_srk_p @ B + R_hat_srk_p @ B) * dW_n\n        R_srk_p_next = R_srk_p + update_p\n        R_srk_p = project_so3(R_srk_p_next)\n\n        # 3. Lie-group exponential method\n        # R_{n+1} = R_n exp(A*dt + B*dW)\n        lie_increment = A*dt + B*dW_n\n        R_lie = R_lie @ expm(lie_increment)\n\n    # --- Post-simulation calculations ---\n    # Exact solution\n    exact_increment = A*T + B*W_T\n    R_exact = expm(exact_increment)\n\n    # Calculate 8 required metrics\n    # 1. Milstein unprojected orthogonality defect\n    mil_u_defect = norm(R_mil_u.T @ R_mil_u - I_3, 'fro')\n    # 2. SRK-Heun unprojected orthogonality defect\n    srk_u_defect = norm(R_srk_u.T @ R_srk_u - I_3, 'fro')\n    # 3. Milstein unprojected determinant error\n    mil_u_det_err = abs(det(R_mil_u) - 1.0)\n    # 4. SRK-Heun unprojected determinant error\n    srk_u_det_err = abs(det(R_srk_u) - 1.0)\n    # 5. Milstein projected geodesic error\n    mil_p_geo_err = geodesic_dist(R_mil_p, R_exact)\n    # 6. SRK-Heun projected geodesic error\n    srk_p_geo_err = geodesic_dist(R_srk_p, R_exact)\n    # 7. Lie-group orthogonality defect\n    lie_defect = norm(R_lie.T @ R_lie - I_3, 'fro')\n    # 8. Lie-group geodesic error\n    lie_geo_err = geodesic_dist(R_lie, R_exact)\n    \n    return (mil_u_defect, srk_u_defect, mil_u_det_err, srk_u_det_err,\n            mil_p_geo_err, srk_p_geo_err, lie_defect, lie_geo_err)\n\ndef solve():\n    \"\"\"Main function to run test cases and print results.\"\"\"\n    test_cases = [\n        # (T, dt, omega, sigma, seed)\n        (1.0, 0.02, 1.3, 0.7, 1234),  # Case A\n        (1.0, 0.2, 1.3, 1.5, 5678),  # Case B\n        (1.0, 0.05, 1.3, 0.0, 42),    # Case C\n    ]\n\n    results = []\n    for case in test_cases:\n        case_results = run_simulation(*case)\n        results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}