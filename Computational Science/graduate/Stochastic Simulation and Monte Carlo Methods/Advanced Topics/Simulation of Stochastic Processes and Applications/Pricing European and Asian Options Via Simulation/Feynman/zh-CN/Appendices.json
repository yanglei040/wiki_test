{
    "hands_on_practices": [
        {
            "introduction": "在为亚式期权定价时，我们必须对路径平均进行离散化，这自然引出了不同数值积分方案的比较问题。本练习旨在通过一个实际的编程任务，让您运用“共同随机数”这一方差缩减技术，来设计一个配对样本显著性检验，从而精确地评估两种离散化方案（左黎曼和与梯形法则）之间的差异。通过这个练习，您不仅能掌握几何布朗运动的精确模拟，还能深化对蒙特卡洛模拟中统计严谨性的理解。",
            "id": "3331249",
            "problem": "考虑一个风险中性市场模型，其中标的资产价格过程 $\\{S_t: t \\in [0,T]\\}$ 在风险中性测度下遵循几何布朗运动，其随机微分方程为 $dS_t = r S_t \\, dt + \\sigma S_t \\, dW_t$，其中 $r$ 是连续复利无风险利率，$\\sigma$ 是波动率，$\\{W_t\\}$ 是标准布朗运动。在区间 $[0,T]$ 上，资产的连续监测算术平均值定义为 $A = \\frac{1}{T} \\int_0^T S_t \\, dt$。考虑执行价为 $K$ 的亚式看涨期权收益 $(A - K)^+ = \\max\\{A - K, 0\\}$，以及相应的无套利价格 $V = \\mathbb{E}\\left[e^{-r T} (A - K)^+ \\right]$。\n\n我们希望研究平均值 $A$ 的时间离散化对蒙特卡洛价格估计的影响。设均匀时间网格为 $0 = t_0 < t_1 < \\cdots < t_N = T$，其中 $t_k = k \\Delta t$ 且 $\\Delta t = T/N$。定义两种用于逼近 $A$ 的时间离散化格式：\n- 左黎曼格式：$A_N^{(\\mathrm{L})} = \\frac{1}{N} \\sum_{k=0}^{N-1} S_{t_k}$，\n- 梯形格式：$A_N^{(\\mathrm{T})} = \\frac{1}{2N} \\left(S_{t_0} + 2 \\sum_{k=1}^{N-1} S_{t_k} + S_{t_N}\\right)$。\n\n沿网格使用几何布朗运动的精确模拟，$S_{t_{k+1}} = S_{t_k} \\exp\\left((r - \\tfrac{1}{2}\\sigma^2)\\Delta t + \\sigma \\sqrt{\\Delta t} \\, Z_{k+1}\\right)$，其中 $(Z_1,\\dots,Z_N)$ 是独立的标准正态变量。对于每条模拟路径，构建一对折现收益\n$P_i^{(\\mathrm{L})} = e^{-r T} \\max\\left\\{A_N^{(\\mathrm{L})} - K, 0\\right\\}$ 和 $P_i^{(\\mathrm{T})} = e^{-r T} \\max\\left\\{A_N^{(\\mathrm{T})} - K, 0\\right\\}$。\n采用公共随机数（CRN），即对每条路径，两种格式都使用相同的序列 $(Z_1,\\dots,Z_N)$，从而使格式之间的差异仅由 $A$ 的离散化引起。\n\n设计并实现一个针对均值差异 $\\mu_D = \\mathbb{E}\\left[P^{(\\mathrm{T})} - P^{(\\mathrm{L})}\\right]$ 的配对样本显著性检验，使用 $M$ 条独立的配对路径产生差异 $D_i = P_i^{(\\mathrm{T})} - P_i^{(\\mathrm{L})}$, $i = 1,\\dots,M$。您的检验必须：\n- 计算样本均值 $\\bar{D}_M = \\frac{1}{M} \\sum_{i=1}^M D_i$ 和无偏样本方差 $S_D^2 = \\frac{1}{M-1} \\sum_{i=1}^M (D_i - \\bar{D}_M)^2$，\n- 构建学生t统计量 $T_{\\text{stat}} = \\bar{D}_M / (S_D / \\sqrt{M})$，\n- 在原假设 $H_0: \\mu_D = 0$ 下，使用具有 $M-1$ 自由度的t分布计算双边p值，\n- 在给定的显著性水平 $\\alpha$ 下，决定是否拒绝 $H_0$。\n\n从基本原理出发，即在风险中性定价下，期权价值是折现收益的期望，并且几何布朗运动允许在离散时间点进行精确抽样。使用公共随机数以确保对于每个模拟路径，两种离散化格式共享相同的随机性，从而使配对差异能分离出离散化效应。使用独立同分布差异和有限方差蒙特卡洛估计量的性质来证明配对样本检验的合理性。\n\n将您的解决方案实现为一个完整的、可运行的程序，对以下参数值测试套件执行上述配对检验（每个案例指定 $(S_0,K,r,\\sigma,T,N,M,\\alpha)$）：\n- 案例1（一般情况）：$(\\,100,\\,100,\\,0.05,\\,0.20,\\,1,\\,16,\\,50000,\\,0.05\\,)$，\n- 案例2（边界粗网格）：$(\\,100,\\,100,\\,0.05,\\,0.20,\\,1,\\,1,\\,50000,\\,0.01\\,)$，\n- 案例3（高执行价，可能零收益）：$(\\,100,\\,200,\\,0.05,\\,0.20,\\,1,\\,16,\\,50000,\\,0.05\\,)$，\n- 案例4（确定性路径，零方差差异）：$(\\,100,\\,90,\\,0,\\,0,\\,1,\\,16,\\,10000,\\,0.05\\,)$。\n\n您的程序必须：\n- 对于每个案例，在给定网格上使用精确的几何布朗运动抽样模拟 $M$ 条配对路径，\n- 在每个案例中，对两种离散化使用公共随机数，\n- 计算配对t统计量和双边p值，\n- 输出一行，包含一个布尔值列表，每个案例一个，指示在该案例给定的 $\\alpha$ 水平下，$H_0$ 是否被拒绝。输出格式必须是单行列表，按案例顺序列出，例如 $[b_1,b_2,b_3,b_4]$，其中每个 $b_j$ 为 $\\text{True}$ 或 $\\text{False}$。\n\n不允许用户输入；所有参数均如上指定。所有概率必须表示为小数。不涉及角度。不适用物理单位。程序必须是自包含的，并必须遵循科学现实主义，使用精确的几何布朗运动抽样和明确定义的统计检验。",
            "solution": "用户提供的问题陈述被评估为有效。它在科学上基于金融工程和统计学原理，问题定义良好，目标明确，数据充分，并以客观、正式的语言表述。该问题要求实现一个配对样本t检验，以比较两种用于亚式期权价格的数值逼近格式。该框架基于标准的风险中性定价理论和几何布朗运动的蒙特卡洛模拟。\n\n解决方案从第一性原理出发，如下所述，从而得出一个完整的计算实现。\n\n**1. 风险中性定价与蒙特卡洛模拟**\n\n到期日为 $T$、收益为 $\\text{Payoff}(S)$ 的欧式衍生品的无套利价格 $V$ 由其在风险中性测度 $\\mathbb{Q}$ 下的折现收益期望给出：\n$$V = \\mathbb{E}_{\\mathbb{Q}}\\left[e^{-r T} \\text{Payoff}(S)\\right]$$\n对于亚式看涨期权，其收益取决于资产价格的算术平均值 $A = \\frac{1}{T} \\int_0^T S_t \\, dt$，因此价格为 $V = \\mathbb{E}_{\\mathbb{Q}}\\left[e^{-r T} (A - K)^+\\right]$。这个期望通常在解析上难以处理。蒙特卡洛方法通过对大量 $M$ 条模拟的资产价格路径的折现收益进行平均来近似这个期望：\n$$\\hat{V} \\approx \\frac{1}{M} \\sum_{i=1}^M e^{-r T} \\left(A^{(i)} - K\\right)^+$$\n其中 $A^{(i)}$ 是第 $i$ 条模拟路径的平均价格。\n\n**2. 使用精确GBM抽样的资产路径模拟**\n\n资产价格 $S_t$ 由几何布朗运动（GBM）建模，其随机微分方程（SDE）为 $dS_t = r S_t \\, dt + \\sigma S_t \\, dW_t$。此SDE的精确解提供了一个公式，用于在离散时间步长 $t_{k+1} = t_k + \\Delta t$ 上模拟资产价格，而不会在路径模拟本身引入任何时间步进误差：\n$$S_{t_{k+1}} = S_{t_k} \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^2\\right)\\Delta t + \\sigma \\sqrt{\\Delta t} \\, Z_{k+1}\\right)$$\n此处，$\\{Z_k\\}_{k=1}^N$ 是独立同分布（i.i.d.）的标准正态随机变量。该公式用于生成 $M$ 条独立的资产价格路径，每条路径包含 $N+1$ 个点 $\\{S_{t_0}, S_{t_1}, \\ldots, S_{t_N}\\}$。\n\n**3. 路径平均值的数值逼近**\n\n由于无法计算平均值 $A$ 的连续积分，因此使用离散路径值对其进行数值逼近。问题指定了两种格式：\n- **左黎曼格式**：此格式使用每个子区间左端点的值来逼近积分。相应的平均值为：\n  $$A_N^{(\\mathrm{L})} = \\frac{1}{T} \\sum_{k=0}^{N-1} S_{t_k} \\Delta t = \\frac{1}{N} \\sum_{k=0}^{N-1} S_{t_k}$$\n- **梯形格式**：此格式通过对每个子区间上的左右端点值进行平均来逼近积分。对于光滑函数，所得平均值更准确：\n  $$A_N^{(\\mathrm{T})} = \\frac{1}{T} \\left( \\sum_{k=0}^{N-1} \\frac{S_{t_k} + S_{t_{k+1}}}{2} \\Delta t \\right) = \\frac{1}{2N} \\left(S_{t_0} + 2 \\sum_{k=1}^{N-1} S_{t_k} + S_{t_N}\\right)$$\n\n对于每个模拟路径 $i$，我们使用 $A_N^{(\\mathrm{L}, i)}$ 计算一个估计收益 $P_i^{(\\mathrm{L})}$，并使用 $A_N^{(\\mathrm{T}, i)}$ 计算另一个估计收益 $P_i^{(\\mathrm{T})}$。\n\n**4. 使用公共随机数的配对样本t检验**\n\n为了比较这两种逼近格式，我们检验它们估计的期权价格的均值差异是否为零。原假设为 $H_0: \\mu_D = 0$，其中 $\\mu_D = \\mathbb{E}[P^{(\\mathrm{T})} - P^{(\\mathrm{L})}]$。\n\n一个关键要素是使用**公共随机数（CRN）**。对于 $M$ 次试验中的每一次，都使用相同的随机变量序列 $\\{Z_k\\}$ 来生成资产路径。然后，此路径用于计算 $A_N^{(\\mathrm{L})}$ 和 $A_N^{(\\mathrm{T})}$，并随后计算 $P_i^{(\\mathrm{L})}$ 和 $P_i^{(\\mathrm{T})}$。该技术在配对的估计量之间产生了强正相关。差异 $D_i = P_i^{(\\mathrm{T})} - P_i^{(\\mathrm{L})}$ 的方差由下式给出：\n$$\\text{Var}(D_i) = \\text{Var}(P_i^{(\\mathrm{T})}) + \\text{Var}(P_i^{(\\mathrm{L})}) - 2\\text{Cov}(P_i^{(\\mathrm{T})}, P_i^{(\\mathrm{L})})$$\n由于CRN引起的正协方差，$\\text{Var}(D_i)$ 远小于使用独立随机数时的方差。这增加了检验的统计功效，使我们能够检测到更小的真实差异。\n\n差异 $D_1, D_2, \\ldots, D_M$ 构成一个独立同分布（i.i.d.）随机变量的样本。根据中心极限定理，它们的样本均值 $\\bar{D}_M$ 近似服从正态分布。因此，配对样本t检验是一种合适的统计工具。我们计算以下统计量：\n- **样本均值差异**：$\\bar{D}_M = \\frac{1}{M} \\sum_{i=1}^M D_i$\n- **差异的无偏样本方差**：$S_D^2 = \\frac{1}{M-1} \\sum_{i=1}^M (D_i - \\bar{D}_M)^2$\n- **学生t统计量**：$T_{\\text{stat}} = \\frac{\\bar{D}_M}{S_D / \\sqrt{M}}$\n\n在原假设 $H_0$ 下，该统计量遵循具有 $M-1$ 自由度的学生t分布。\n\n**5. 假设判定**\n\n计算双边p值，即在 $H_0$ 为真的情况下，观察到t统计量至少与 $T_{\\text{stat}}$ 一样极端或更极端的概率：$p = \\text{Pr}(|t_{M-1}| \\geq |T_{\\text{stat}}|)$。当 $S_D = 0$ 时（如案例4中 $\\sigma=0$），会出现特殊情况，这意味着所有差异 $D_i$ 都相同。如果它们都为零，则 $\\bar{D}_M = 0$，数据完全支持 $H_0$，因此p值为1。最后，如果计算出的p值小于显著性水平 $\\alpha$，我们拒绝 $H_0$。\n\n该实现将为每个测试案例执行整个过程，并利用 `numpy` 中的向量化操作来提高效率。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import t\n\ndef run_paired_test(S0, K, r, sigma, T, N, M, alpha):\n    \"\"\"\n    Performs a paired-samples t-test for the difference in Asian option prices\n    estimated using Left Riemann and Trapezoidal averaging schemes.\n\n    Args:\n        S0 (float): Initial asset price.\n        K (float): Strike price.\n        r (float): Risk-free rate.\n        sigma (float): Volatility.\n        T (float): Time to maturity.\n        N (int): Number of time steps.\n        M (int): Number of Monte Carlo paths.\n        alpha (float): Significance level for the test.\n\n    Returns:\n        bool: True if the null hypothesis is rejected, False otherwise.\n    \"\"\"\n    dt = T / N\n\n    # Generate M x N matrix of standard normal randoms for Common Random Numbers\n    # This ensures both schemes use the same randomness for each path.\n    Z = np.random.randn(M, N)\n\n    # Simulate M paths, each with N+1 time points (t_0, ..., t_N)\n    # S is a M x (N+1) matrix\n    S = np.zeros((M, N + 1))\n    S[:, 0] = S0\n\n    # GBM simulation using the exact solution, vectorized over M paths\n    drift = (r - 0.5 * sigma**2) * dt\n    vol = sigma * np.sqrt(dt)\n    for k in range(N):\n        S[:, k + 1] = S[:, k] * np.exp(drift + vol * Z[:, k])\n\n    # Calculate averages for each path (vectorized)\n    # Left Riemann scheme: A_L = (1/N) * sum_{k=0}^{N-1} S_{t_k}\n    A_L = np.mean(S[:, :-1], axis=1)\n\n    # Trapezoidal scheme: A_T = (1/2N) * (S_0 + 2*sum_{k=1}^{N-1} S_k + S_N)\n    # which is equivalent to (1/N) * (0.5*S_0 + sum_{k=1}^{N-1} S_k + 0.5*S_N)\n    # This implementation is robust and works for N=1, where the sum term is empty.\n    sum_middle_terms = np.sum(S[:, 1:-1], axis=1) if N > 1 else 0\n    A_T = (0.5 * S[:, 0] + sum_middle_terms + 0.5 * S[:, -1]) / N\n\n    # Calculate discounted payoffs for both schemes\n    discount_factor = np.exp(-r * T)\n    P_L = discount_factor * np.maximum(0, A_L - K)\n    P_T = discount_factor * np.maximum(0, A_T - K)\n\n    # Compute the paired differences\n    D = P_T - P_L\n\n    # Perform the paired-samples t-test\n    D_bar = np.mean(D)\n    S_D = np.std(D, ddof=1)  # Unbiased sample standard deviation\n\n    # Handle the special case of zero variance\n    # This occurs if all differences D_i are identical (e.g., in the deterministic case)\n    if np.isclose(S_D, 0.0):\n        # If the mean difference is also zero, all D_i are zero.\n        # The data perfectly supports the null hypothesis. p-value is 1.\n        if np.isclose(D_bar, 0.0):\n            p_value = 1.0\n        # If the mean difference is non-zero, it means a constant, non-zero difference.\n        # This is infinite evidence against the null hypothesis. p-value is 0.\n        else:\n            p_value = 0.0\n    else:\n        # Standard t-test calculation\n        t_stat = D_bar / (S_D / np.sqrt(M))\n        df = M - 1\n        # Two-sided p-value from the survival function (1 - cdf)\n        p_value = 2 * t.sf(np.abs(t_stat), df)\n\n    # Decision rule: reject H0 if p-value is less than the significance level\n    return p_value < alpha\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement:\n    # (S0, K, r, sigma, T, N, M, alpha)\n    test_cases = [\n        (100.0, 100.0, 0.05, 0.20, 1.0, 16, 50000, 0.05),\n        (100.0, 100.0, 0.05, 0.20, 1.0, 1, 50000, 0.01),\n        (100.0, 200.0, 0.05, 0.20, 1.0, 16, 50000, 0.05),\n        (100.0, 90.0, 0.0, 0.0, 1.0, 16, 10000, 0.05),\n    ]\n\n    # Set a random seed for reproducibility of the results\n    np.random.seed(42)\n\n    results = []\n    for case in test_cases:\n        reject_h0 = run_paired_test(*case)\n        results.append(reject_h0)\n\n    # Final print statement in the exact required format: [True,False,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solution\nsolve()\n\n```"
        },
        {
            "introduction": "上一个练习直观地展示了共同随机数（CRN）在比较不同情景时的威力，但其效率究竟有多高？本练习将引导您从理论层面深入剖析CRN方法的有效性。您需要运用多元中心极限定理，推导出使用CRN时两个估计量之差的置信区间，并与独立抽样的情况进行量化比较。这项练习旨在将您对CRN的直观认识提升到严谨的数学证明与量化分析层面。",
            "id": "3331290",
            "problem": "考虑一个无摩擦市场，其中标的资产价格过程在风险中性测度下服从几何布朗運動，其动态为 $dS_{t} = r S_{t}\\,dt + \\sigma S_{t}\\,dW_{t}$，其中 $r$ 为恒定无风险利率，$\\sigma$ 为波动率，$W_{t}$ 为标准布朗运动。设 $S_{0} = 100$，到期时间 $T = 1$ (年)，执行价格 $K = 100$。考虑一个离散监测的算术平均亚式看涨期权，在 $m = 12$ 个等距时间点 $t_{j} = j T/m$, $j = 1,\\dots,m$ 进行监测，其折现后收益为 $X(\\sigma) = \\exp(-rT) \\max\\!\\big(\\frac{1}{m}\\sum_{j=1}^{m} S_{t_{j}} - K, 0\\big)$。\n\n您希望估计价格差异 $\\Delta = P(\\sigma_{2}) - P(\\sigma_{1})$，其中 $P(\\sigma) = \\mathbb{E}[X(\\sigma)]$，两种情景分别为 $\\sigma_{1} = 0.20$ 和 $\\sigma_{2} = 0.22$。您通过对每条路径使用相同的标准正态向量（即公共随机数）来驱动两种情景，从而模拟 $n$ 个独立同分布的配对 $\\{(X_{i}(\\sigma_{1}), X_{i}(\\sigma_{2}))\\}_{i=1}^{n}$，也就是说，对每一对使用相同的布朗增量，因此每对中的两个分量是相关的。\n\n- 仅使用风险中性定价的基本原理、多元中心极限定理以及线性变换下协方差的性质，完成以下任务：\n\n1) 从应用于折现后收益的二元向量 $(X(\\sigma_{1}), X(\\sigma_{2}))$ 的多元中心极限定理出发，推导配对差分公共随机数估计量 $\\widehat{\\Delta}_{n} = \\overline{X}_{n}(\\sigma_{2}) - \\overline{X}_{n}(\\sigma_{1})$ 下 $\\Delta$ 的大样本 $(1-\\alpha)$ 置信区间，并用 $n$, $\\operatorname{Var}[X(\\sigma_{1})]$, $\\operatorname{Var}[X(\\sigma_{2})]$ 和 $\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2}))$ 明确表示。\n\n2) 假设您将 $n$ 次配对复制分成大小为 $b$ 的 $B$ 个区块（因此 $n = B b$）。在每个区块内，对两种波动率情景使用公共随机数，并为每种情景计算区块均值及其配对差分。基于这 $B$ 个区块配对差分，推导 $\\Delta$ 的相应大样本 $(1-\\alpha)$ 置信区间，并展示其与您在第 1) 部分中得到的表达式的关系。\n\n3) 一次 $n = 10000$ 条配对路径的预跑产生了无偏估计 $\\widehat{\\operatorname{Var}}[X(\\sigma_{1})] = 225$，$\\widehat{\\operatorname{Var}}[X(\\sigma_{2})] = 400$ 和 $\\widehat{\\operatorname{Cov}}(X(\\sigma_{1}), X(\\sigma_{2})) = 280$。为进行此计算，将这些值视为真实的二阶矩。计算在使用配对差分公共随机数方法时置信水平为 $0.95$ 的双侧置信区间的半宽度，与如果您使用相同总路径数且不使用公共随机数独立模拟两种情景所获得的半宽度之间的渐近比率 $R$。将您的答案四舍五入到四位有效数字。\n\n您的最终答案应该是 $R$ 的单个实数值。",
            "solution": "本问题要求推导通过蒙特卡洛模拟估计的两个期望之差的置信区间，并比较公共随机数（CRN）技术与独立抽样技术的效率。\n\n1) 配对差分估计量的置信区间推导。\n\n令二元随机向量 $\\mathbf{Y}_{i}$ 表示第 $i$ 个模拟的折现后收益配对：\n$$\n\\mathbf{Y}_{i} = \\begin{pmatrix} X_{i}(\\sigma_{1}) \\\\ X_{i}(\\sigma_{2}) \\end{pmatrix}\n$$\n这些向量 $\\{\\mathbf{Y}_{i}\\}_{i=1}^{n}$ 是独立同分布的（i.i.d.）。每个向量的期望是真实的价格对：\n$$\n\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{Y}_{i}] = \\begin{pmatrix} \\mathbb{E}[X(\\sigma_{1})] \\\\ \\mathbb{E}[X(\\sigma_{2})] \\end{pmatrix} = \\begin{pmatrix} P(\\sigma_{1}) \\\\ P(\\sigma_{2}) \\end{pmatrix}\n$$\n$\\mathbf{Y}_{i}$ 的协方差矩阵由下式给出：\n$$\n\\mathbf{\\Sigma} = \\begin{pmatrix} \\operatorname{Var}[X(\\sigma_{1})] & \\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\\\ \\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) & \\operatorname{Var}[X(\\sigma_{2})] \\end{pmatrix}\n$$\n样本均值向量为 $\\overline{\\mathbf{Y}}_{n} = \\frac{1}{n}\\sum_{i=1}^{n}\\mathbf{Y}_{i} = (\\overline{X}_{n}(\\sigma_{1}), \\overline{X}_{n}(\\sigma_{2}))^T$。根据多元中心极限定理（MCLT），当 $n$ 很大时，样本均值向量的分布近似为多元正态分布：\n$$\n\\sqrt{n}(\\overline{\\mathbf{Y}}_{n} - \\boldsymbol{\\mu}) \\xrightarrow{D} \\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma})\n$$\n其中 $\\xrightarrow{D}$ 表示依分布收敛。\n\n我们感兴趣的是差异 $\\Delta = P(\\sigma_{2}) - P(\\sigma_{1})$。这可以表示为使用向量 $\\mathbf{c} = (-1, 1)^T$ 对均值向量 $\\boldsymbol{\\mu}$ 进行的线性变换，使得 $\\Delta = \\mathbf{c}^T \\boldsymbol{\\mu}$。$\\Delta$ 的估计量是 $\\widehat{\\Delta}_{n} = \\overline{X}_{n}(\\sigma_{2}) - \\overline{X}_{n}(\\sigma_{1}) = \\mathbf{c}^T \\overline{\\mathbf{Y}}_{n}$。\n\n将相同的线性变换应用于 MCLT 结果，我们得到我们估计量的渐近分布：\n$$\n\\sqrt{n}(\\widehat{\\Delta}_{n} - \\Delta) = \\mathbf{c}^T \\left( \\sqrt{n}(\\overline{\\mathbf{Y}}_{n} - \\boldsymbol{\\mu}) \\right) \\xrightarrow{D} \\mathcal{N}(0, \\mathbf{c}^T \\mathbf{\\Sigma} \\mathbf{c})\n$$\n极限分布的方差 $\\sigma_{\\Delta}^2 = \\mathbf{c}^T \\mathbf{\\Sigma} \\mathbf{c}$ 计算如下：\n$$\n\\sigma_{\\Delta}^2 = \\begin{pmatrix} -1 & 1 \\end{pmatrix} \\begin{pmatrix} \\operatorname{Var}[X(\\sigma_{1})] & \\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\\\ \\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) & \\operatorname{Var}[X(\\sigma_{2})] \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}\n$$\n$$\n\\sigma_{\\Delta}^2 = \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2}))\n$$\n这就是两个随机变量之差的方差，即 $\\operatorname{Var}[X(\\sigma_{2}) - X(\\sigma_{1})]$。\n当 $n$ 很大时，$\\widehat{\\Delta}_{n}$ 近似服从均值为 $\\Delta$，方差为 $\\frac{\\sigma_{\\Delta}^2}{n}$ 的正态分布。因此，标准化变量\n$$\n\\frac{\\widehat{\\Delta}_{n} - \\Delta}{\\sqrt{\\sigma_{\\Delta}^2/n}} \\approx \\mathcal{N}(0, 1)\n$$\n$\\Delta$ 的大样本 $(1-\\alpha)$ 置信区间构建如下：\n$$\n\\widehat{\\Delta}_{n} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{\\sigma_{\\Delta}^2}{n}}\n$$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的 $(1-\\alpha/2)$-分位数。代入 $\\sigma_{\\Delta}^2$ 的表达式，置信区间为：\n$$\n\\widehat{\\Delta}_{n} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{\\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2}))}{n}}\n$$\n\n2) 分块法的推导。\n\n$n$ 次模拟被分成大小为 $b$ 的 $B$ 个区块，其中 $n = Bb$。对于每个区块 $k \\in \\{1, \\dots, B\\}$，我们计算区块均值的配对差分：\n$$\nD_{k} = \\overline{X}_{b,k}(\\sigma_{2}) - \\overline{X}_{b,k}(\\sigma_{1}) = \\frac{1}{b}\\sum_{i=(k-1)b+1}^{kb} X_{i}(\\sigma_{2}) - \\frac{1}{b}\\sum_{i=(k-1)b+1}^{kb} X_{i}(\\sigma_{1})\n$$\n变量 $D_{1}, \\dots, D_{B}$ 是独立同分布的，因为它们是由 i.i.d. 模拟的不重叠区块计算得出的。\n每个 $D_k$ 的期望是 $\\mathbb{E}[D_k] = \\mathbb{E}[\\overline{X}_{b,k}(\\sigma_{2})] - \\mathbb{E}[\\overline{X}_{b,k}(\\sigma_{1})] = P(\\sigma_{2}) - P(\\sigma_{1}) = \\Delta$。\n每个 $D_k$ 的方差是 $\\operatorname{Var}(D_k) = \\operatorname{Var}(\\overline{X}_{b,k}(\\sigma_{2}) - \\overline{X}_{b,k}(\\sigma_{1}))$。利用 $b$ 个 i.i.d. 变量的样本均值的方差是单个变量方差的 $\\frac{1}{b}$ 倍这一性质，我们有：\n$$\n\\operatorname{Var}(D_k) = \\operatorname{Var}(\\overline{X}_{b,k}(\\sigma_{2})) + \\operatorname{Var}(\\overline{X}_{b,k}(\\sigma_{1})) - 2\\operatorname{Cov}(\\overline{X}_{b,k}(\\sigma_{1}), \\overline{X}_{b,k}(\\sigma_{2}))\n$$\n$$\n\\operatorname{Var}(D_k) = \\frac{\\operatorname{Var}[X(\\sigma_{2})]}{b} + \\frac{\\operatorname{Var}[X(\\sigma_{1})]}{b} - 2 \\frac{\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2}))}{b}\n$$\n$$\n\\operatorname{Var}(D_k) = \\frac{1}{b} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\right)\n$$\n总体估计量是这些区块差分的平均值，$\\widehat{\\Delta}_{B} = \\frac{1}{B}\\sum_{k=1}^B D_k$。注意这与原始估计量是相同的：$\\widehat{\\Delta}_{B} = \\frac{1}{B}\\sum_{k=1}^B \\frac{1}{b}\\sum_{i \\in \\text{block } k} (X_i(\\sigma_2) - X_i(\\sigma_1)) = \\frac{1}{Bb}\\sum_{i=1}^n(X_i(\\sigma_2) - X_i(\\sigma_1)) = \\widehat{\\Delta}_{n}$。\n根据应用于 i.i.d. 变量 $D_k$ 的标准中心极限定理，当 $B$ 很大时，估计量 $\\widehat{\\Delta}_{B}$ 近似服从均值为 $\\Delta$，方差为 $\\frac{\\operatorname{Var}(D_k)}{B}$ 的正态分布。置信区间为：\n$$\n\\widehat{\\Delta}_{B} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{\\operatorname{Var}(D_k)}{B}}\n$$\n代入 $\\operatorname{Var}(D_k)$：\n$$\n\\widehat{\\Delta}_{B} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{1}{Bb} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\right)}\n$$\n由于 $n=Bb$ 且 $\\widehat{\\Delta}_{B} = \\widehat{\\Delta}_{n}$，这可以简化为：\n$$\n\\widehat{\\Delta}_{n} \\pm z_{1-\\alpha/2} \\sqrt{\\frac{\\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2}))}{n}}\n$$\n这个表达式与第 1) 部分推导出的表达式相同。它们之间的关系是两种方法是渐近等价的。分块法提供了一种实用的方法，通过计算区块差分 $D_k$ 的样本方差来估计总体估计量的方差，而无需明确地估计各个方差和协方差项。\n\n3) 半宽度比率的计算。\n\n双侧置信区间的半宽度（HW）由 $HW = z_{1-\\alpha/2} \\times SE$ 给出，其中 $SE$ 是估计量的标准误差。我们需要计算比率 $R = \\frac{HW_{\\text{CRN}}}{HW_{\\text{Ind}}}$。$z_{1-\\alpha/2}$ 项会消掉，因此 $R = \\frac{SE_{\\text{CRN}}}{SE_{\\text{Ind}}}$。\n\n对于配对差分公共随机数（CRN）方法，估计量为 $\\widehat{\\Delta}_n = \\overline{X}_n(\\sigma_2) - \\overline{X}_n(\\sigma_1)$。该估计量的方差为：\n$$\n\\operatorname{Var}[\\widehat{\\Delta}_n]_{\\text{CRN}} = \\frac{1}{n} \\operatorname{Var}[X(\\sigma_{2}) - X(\\sigma_{1})] = \\frac{1}{n} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\right)\n$$\n使用给定的值 $\\operatorname{Var}[X(\\sigma_{1})] = 225$，$\\operatorname{Var}[X(\\sigma_{2})] = 400$，$\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) = 280$ 和 $n=10000$：\n$$\n\\operatorname{Var}[\\widehat{\\Delta}_n]_{\\text{CRN}} = \\frac{1}{10000} (225 + 400 - 2 \\times 280) = \\frac{625 - 560}{10000} = \\frac{65}{10000}\n$$\n标准误差为 $SE_{\\text{CRN}} = \\sqrt{\\frac{65}{10000}} = \\frac{\\sqrt{65}}{100}$。\n\n对于独立模拟的情况，我们用来自 $n$ 条路径的 $\\overline{X}_n(\\sigma_1)$ 估计 $P(\\sigma_1)$，并用来自另外 $n$ 条路径的 $\\overline{X}_n(\\sigma_2)$ 估计 $P(\\sigma_2)$，其中这两组模拟是独立的。$\\overline{X}_n(\\sigma_1)$ 和 $\\overline{X}_n(\\sigma_2)$ 之间的协方差为零。差分估计量 $\\widehat{\\Delta}_n$ 的方差为：\n$$\n\\operatorname{Var}[\\widehat{\\Delta}_n]_{\\text{Ind}} = \\operatorname{Var}[\\overline{X}_n(\\sigma_{2}) - \\overline{X}_n(\\sigma_{1})] = \\operatorname{Var}[\\overline{X}_n(\\sigma_{2})] + \\operatorname{Var}[\\overline{X}_n(\\sigma_{1})]\n$$\n$$\n\\operatorname{Var}[\\widehat{\\Delta}_n]_{\\text{Ind}} = \\frac{\\operatorname{Var}[X(\\sigma_{2})]}{n} + \\frac{\\operatorname{Var}[X(\\sigma_{1})]}{n} = \\frac{1}{n} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] \\right)\n$$\n使用给定的值：\n$$\n\\operatorname{Var}[\\widehat{\\Delta}_n]_{\\text{Ind}} = \\frac{1}{10000} (225 + 400) = \\frac{625}{10000}\n$$\n标准误差为 $SE_{\\text{Ind}} = \\sqrt{\\frac{625}{10000}} = \\frac{25}{100}$。\n\n半宽度的比率 $R$ 就是标准误差的比率：\n$$\nR = \\frac{SE_{\\text{CRN}}}{SE_{\\text{Ind}}} = \\frac{\\sqrt{V_{\\text{CRN}}}}{\\sqrt{V_{\\text{Ind}}}} = \\sqrt{\\frac{V_{\\text{CRN}}}{V_{\\text{Ind}}}}\n$$\n$$\nR = \\sqrt{\\frac{\\frac{1}{n} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] - 2\\operatorname{Cov}(X(\\sigma_{1}), X(\\sigma_{2})) \\right)}{\\frac{1}{n} \\left( \\operatorname{Var}[X(\\sigma_{1})] + \\operatorname{Var}[X(\\sigma_{2})] \\right)}}\n$$\n$$\nR = \\sqrt{\\frac{225 + 400 - 2(280)}{225 + 400}} = \\sqrt{\\frac{625 - 560}{625}} = \\sqrt{\\frac{65}{625}} = \\frac{\\sqrt{65}}{25}\n$$\n现在，我们计算其数值：\n$$\nR = \\frac{\\sqrt{65}}{25} \\approx \\frac{8.0622577}{25} \\approx 0.3224903\n$$\n四舍五入到四位有效数字，我们得到 $0.3225$。",
            "answer": "$$\\boxed{0.3225}$$"
        },
        {
            "introduction": "除了共同随机数，控制变量法是另一种极其强大的方差缩减技术。然而，在实际应用中，最优控制系数 $\\beta$ 通常是未知的，需要从样本数据中估计，这给估计器的方差带来了额外的不确定性。本练习将引导您在一个理想化的假设（联合正态分布）下，推导控制变量估计量 $\\widehat{\\mu}_{n}^{\\mathrm{cv}}$ 的精确有限样本方差，从而深刻理解估计控制系数所付出的“代价”。",
            "id": "3331327",
            "problem": "考虑使用控制变量法通过蒙特卡洛（MC）模拟为路径依赖期权定价的问题。令 $Y$ 表示目标期权（例如，Black–Scholes 模型下的算术亚式看涨期权）的折现收益，令 $X$ 表示一个相关的、期望已知为 $E[X]=\\nu$ 的控制变量的折现收益（例如，其价值有闭式解的几何亚式看涨期权）。假设 $(Y,X)$ 服从联合正态分布，其均值向量为 $(\\mu_{Y},\\mu_{X})$，协方差矩阵为\n$$\n\\Sigma \\;=\\; \\begin{pmatrix}\n\\sigma_{X}^{2} & \\sigma_{XY} \\\\\n\\sigma_{XY} & \\sigma_{Y}^{2}\n\\end{pmatrix},\n$$\n并定义相关系数 $\\rho$ 为 $\\rho \\;=\\; \\sigma_{XY}/(\\sigma_{X}\\sigma_{Y})$。假设抽取了 $n$ 个独立同分布的样本 $\\{(Y_{i},X_{i})\\}_{i=1}^{n}$。使用估计的控制系数得到的 $E[Y]$ 的控制变量估计量为\n$$\n\\widehat{\\mu}_{n}^{\\mathrm{cv}} \\;=\\; \\overline{Y}_{n} \\;-\\; \\widehat{\\beta}_{n}\\,\\big(\\overline{X}_{n} \\;-\\; \\nu\\big),\n$$\n其中 $\\overline{Y}_{n} \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} Y_{i}$，$\\overline{X}_{n} \\;=\\; \\frac{1}{n}\\sum_{i=1}^{n} X_{i}$，且 $\\widehat{\\beta}_{n}$ 是由下式定义的样本控制系数\n$$\n\\widehat{\\beta}_{n} \\;=\\; \\frac{\\sum_{i=1}^{n} (X_{i}-\\overline{X}_{n})(Y_{i}-\\overline{Y}_{n})}{\\sum_{i=1}^{n} (X_{i}-\\overline{X}_{n})^{2}} \\;=\\; \\frac{S_{XY}}{S_{XX}}.\n$$\n从基本概率事实（联合正态性、多元正态分布的性质以及正态性假设下样本协方差的 Wishart 分布）出发，推导 $\\widehat{\\beta}_{n}$ 的抽样分布，并用它来量化估计 $\\beta$ 对 $\\widehat{\\mu}_{n}^{\\mathrm{cv}}$ 不确定性的贡献。将精确的有限样本方差 $\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}})$ 以 $n$、$\\sigma_{Y}$、$\\sigma_{X}$ 和 $\\rho$ 的函数形式表示为闭式解。\n\n请给出在所述假设下 $\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}})$ 的单一闭式解析表达式作为最终答案。无需进行数值计算。",
            "solution": "该问题要求在目标收益 $Y$ 和控制收益 $X$ 服从联合正态分布的假设下，推导控制变量估计量 $\\widehat{\\mu}_{n}^{\\mathrm{cv}}$ 的精确有限样本方差。\n\n给定的估计量为 $\\widehat{\\mu}_{n}^{\\mathrm{cv}} = \\overline{Y}_{n} - \\widehat{\\beta}_{n}(\\overline{X}_{n} - \\nu)$，其中 $\\nu = E[X] = \\mu_{X}$。需要计算的量是 $\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}})=E\\left[\\left(\\widehat{\\mu}_{n}^{\\mathrm{cv}} - E[\\widehat{\\mu}_{n}^{\\mathrm{cv}}]\\right)^2\\right]$。首先，我们分析该估计量的结构。\n\n$(Y, X)$ 的联合正态性意味着线性的条件期望。给定 $X$ 时 $Y$ 的条件分布是正态分布，其均值为 $E[Y|X] = \\mu_{Y} + \\frac{\\sigma_{XY}}{\\sigma_{X}^{2}}(X - \\mu_{X})$，方差为 $\\mathrm{Var}(Y|X) = \\sigma_{Y}^{2}(1-\\rho^{2})$。\n这使我们能够为每个观测值 $Y_i$ 写出一个线性回归模型：\n$$Y_{i} = \\mu_{Y} + \\beta(X_{i} - \\mu_{X}) + \\epsilon_{i}$$\n其中 $\\beta = \\frac{\\sigma_{XY}}{\\sigma_{X}^{2}}$ 是理论回归系数。误差项 $\\epsilon_{i}$ 是独立同分布的，服从 $N(0, \\sigma_{\\epsilon}^{2})$，其中 $\\sigma_{\\epsilon}^{2} = \\sigma_{Y}^{2}(1-\\rho^{2})$。此外，对于所有的 $i,j$，误差项 $\\epsilon_i$ 都独立于预测变量 $X_j$。\n对 $n$ 个样本求平均可得：\n$$\\overline{Y}_{n} = \\mu_{Y} + \\beta(\\overline{X}_{n} - \\mu_{X}) + \\overline{\\epsilon}_{n}$$\n其中 $\\overline{\\epsilon}_{n} = \\frac{1}{n}\\sum_{i=1}^{n}\\epsilon_{i}$。\n\n$Y$ 的均值估计量为 $\\widehat{\\mu}_{n}^{\\mathrm{cv}} = \\overline{Y}_{n} - \\widehat{\\beta}_{n}(\\overline{X}_{n} - \\mu_{X})$，其中 $\\widehat{\\beta}_{n}$ 是 $\\beta$ 的普通最小二乘（OLS）估计量。该估计量与真实均值 $\\mu_Y$ 的偏差为：\n$$\\widehat{\\mu}_{n}^{\\mathrm{cv}} - \\mu_{Y} = \\left(\\overline{Y}_{n} - \\mu_{Y}\\right) - \\widehat{\\beta}_{n}(\\overline{X}_{n} - \\mu_{X})$$\n代入 $\\overline{Y}_{n}$ 的表达式：\n$$\\widehat{\\mu}_{n}^{\\mathrm{cv}} - \\mu_{Y} = \\left(\\mu_{Y} + \\beta(\\overline{X}_{n} - \\mu_{X}) + \\overline{\\epsilon}_{n} - \\mu_{Y}\\right) - \\widehat{\\beta}_{n}(\\overline{X}_{n} - \\mu_{X})$$\n$$\\widehat{\\mu}_{n}^{\\mathrm{cv}} - \\mu_{Y} = \\beta(\\overline{X}_{n} - \\mu_{X}) + \\overline{\\epsilon}_{n} - \\widehat{\\beta}_{n}(\\overline{X}_{n} - \\mu_{X})$$\n$$\\widehat{\\mu}_{n}^{\\mathrm{cv}} - \\mu_{Y} = \\overline{\\epsilon}_{n} - (\\widehat{\\beta}_{n} - \\beta)(\\overline{X}_{n} - \\mu_{X})$$\n现在，我们可以计算方差。方差是该偏差平方的期望，因为在正态性假设下，我们可以证明该估计量是无偏的（$E[\\widehat{\\mu}_{n}^{\\mathrm{cv}}] = \\mu_{Y}$）。\n$$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = E\\left[ \\left( \\overline{\\epsilon}_{n} - (\\widehat{\\beta}_{n} - \\beta)(\\overline{X}_{n} - \\mu_{X}) \\right)^{2} \\right]$$\n展开平方项可得：\n$$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = E[\\overline{\\epsilon}_{n}^{2}] - 2E[\\overline{\\epsilon}_{n}(\\widehat{\\beta}_{n} - \\beta)(\\overline{X}_{n} - \\mu_{X})] + E[(\\widehat{\\beta}_{n} - \\beta)^{2}(\\overline{X}_{n} - \\mu_{X})^{2}]$$\n我们分别计算每一项。\n\n1.  **第一项：$E[\\overline{\\epsilon}_{n}^{2}]$**\n    由于 $E[\\overline{\\epsilon}_{n}]=0$，该项即为 $\\overline{\\epsilon}_{n}$ 的方差。$\\epsilon_{i}$ 是独立同分布的，其方差为 $\\sigma_{\\epsilon}^{2} = \\sigma_{Y}^{2}(1-\\rho^{2})$。\n    $$E[\\overline{\\epsilon}_{n}^{2}] = \\mathrm{Var}(\\overline{\\epsilon}_{n}) = \\mathrm{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n}\\epsilon_{i}\\right) = \\frac{1}{n^{2}}\\sum_{i=1}^{n}\\mathrm{Var}(\\epsilon_{i}) = \\frac{n\\sigma_{\\epsilon}^{2}}{n^{2}} = \\frac{\\sigma_{\\epsilon}^{2}}{n} = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n}$$\n\n2.  **第二项（交叉项）：$-2E[\\overline{\\epsilon}_{n}(\\widehat{\\beta}_{n} - \\beta)(\\overline{X}_{n} - \\mu_{X})]$**\n    首先，我们用误差项 $\\epsilon_i$ 来表示 $(\\widehat{\\beta}_{n} - \\beta)$。\n    OLS 估计量为 $\\widehat{\\beta}_{n} = \\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})(Y_{i}-\\overline{Y}_{n})}{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})^{2}}$。\n    从 $Y_i = \\mu_Y + \\beta(X_i-\\mu_X) + \\epsilon_i$，我们得到 $Y_i - \\overline{Y}_n = \\beta(X_i - \\overline{X}_n) + (\\epsilon_i - \\overline{\\epsilon}_n)$。\n    将此代入 $\\widehat{\\beta}_{n}$ 的分子中：\n    $$\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})(Y_{i}-\\overline{Y}_{n}) = \\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})[\\beta(X_{i}-\\overline{X}_{n}) + (\\epsilon_i - \\overline{\\epsilon}_n)]$$\n    $$= \\beta \\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})^{2} + \\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i} - \\overline{\\epsilon}_{n}\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})$$\n    由于 $\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n}) = 0$，最后一项为零。令 $S_{XX} = \\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})^{2}$。\n    $$\\widehat{\\beta}_{n} = \\frac{\\beta S_{XX} + \\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}} = \\beta + \\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}}$$\n    因此，$\\widehat{\\beta}_{n} - \\beta = \\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}}$。\n    交叉项的期望为：\n    $$E\\left[\\left(\\frac{1}{n}\\sum_{j=1}^{n}\\epsilon_{j}\\right) \\left(\\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}}\\right) (\\overline{X}_{n}-\\mu_{X})\\right]$$\n    我们通过以序列 $\\mathbf{X} = \\{X_1, ..., X_n\\}$ 为条件，使用全期望定律。误差项 $\\epsilon_i$ 独立于 $\\mathbf{X}$。\n    $$E_{\\mathbf{X}}\\left[\\frac{\\overline{X}_{n}-\\mu_{X}}{n S_{XX}} E_{\\epsilon|\\mathbf{X}}\\left[ \\left(\\sum_{j=1}^{n}\\epsilon_{j}\\right) \\left(\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}\\right) \\right]\\right]$$\n    内部的条件期望为：\n    $$E\\left[ \\sum_{i,j} (X_{i}-\\overline{X}_{n})\\epsilon_{i}\\epsilon_{j} \\right] = \\sum_{i,j} (X_{i}-\\overline{X}_{n})E[\\epsilon_{i}\\epsilon_{j}]$$\n    由于 $E[\\epsilon_{i}\\epsilon_{j}] = \\sigma_{\\epsilon}^{2}\\delta_{ij}$ （其中 $\\delta_{ij}$ 是克罗内克 $\\delta$ 函数），此式简化为：\n    $$\\sum_{i=1}^{n} (X_{i}-\\overline{X}_{n})\\sigma_{\\epsilon}^{2} = \\sigma_{\\epsilon}^{2}\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n}) = 0$$\n    因此，整个交叉项为零。\n\n3.  **第三项：$E[(\\widehat{\\beta}_{n} - \\beta)^{2}(\\overline{X}_{n} - \\mu_{X})^{2}]$**\n    使用 $\\widehat{\\beta}_n - \\beta$ 的表达式，该项为：\n    $$E\\left[ \\left(\\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}}\\right)^{2} (\\overline{X}_{n}-\\mu_{X})^{2} \\right]$$\n    再次，我们以 $\\mathbf{X}$ 为条件：\n    $$E_{\\mathbf{X}}\\left[ (\\overline{X}_{n}-\\mu_{X})^{2} E_{\\epsilon|\\mathbf{X}}\\left[ \\left(\\frac{\\sum_{i=1}^{n}(X_{i}-\\overline{X}_{n})\\epsilon_{i}}{S_{XX}}\\right)^{2} \\right] \\right]$$\n    内部的条件期望为：\n    $$E\\left[ \\frac{1}{S_{XX}^{2}} \\sum_{i,j} (X_i-\\overline{X}_n)(X_j-\\overline{X}_n)\\epsilon_i\\epsilon_j \\right] = \\frac{1}{S_{XX}^{2}}\\sum_{i,j} (X_i-\\overline{X}_n)(X_j-\\overline{X}_n)E[\\epsilon_i\\epsilon_j]$$\n    $$= \\frac{\\sigma_{\\epsilon}^{2}}{S_{XX}^{2}} \\sum_{i=1}^{n} (X_{i}-\\overline{X}_{n})^{2} = \\frac{\\sigma_{\\epsilon}^{2}S_{XX}}{S_{XX}^{2}} = \\frac{\\sigma_{\\epsilon}^{2}}{S_{XX}}$$\n    将此代回，第三项变为：\n    $$E_{\\mathbf{X}}\\left[ (\\overline{X}_{n}-\\mu_{X})^{2} \\frac{\\sigma_{\\epsilon}^{2}}{S_{XX}} \\right] = \\sigma_{\\epsilon}^{2} E\\left[ (\\overline{X}_{n}-\\mu_{X})^{2} \\frac{1}{S_{XX}} \\right]$$\n    对于独立同分布的正态样本，根据 Cochran 定理，样本均值 $\\overline{X}_n$ 独立于离差平方和 $S_{XX}$。因此，积的期望等于期望的积：\n    $$\\sigma_{\\epsilon}^{2} E\\left[ (\\overline{X}_{n}-\\mu_{X})^{2} \\right] E\\left[ \\frac{1}{S_{XX}} \\right]$$\n    我们计算这两个期望：\n    a) $E\\left[ (\\overline{X}_{n}-\\mu_{X})^{2} \\right] = \\mathrm{Var}(\\overline{X}_{n}) = \\frac{\\sigma_{X}^{2}}{n}$。\n    b) 为了求 $E[1/S_{XX}]$，我们利用这样一个事实：$W = S_{XX}/\\sigma_{X}^{2}$ 服从自由度为 $k=n-1$ 的卡方分布，即 $W \\sim \\chi_{n-1}^{2}$。我们需要求这个变量倒数的期望。一个 $\\chi_k^2$ 变量的 m 阶矩为 $E[W^m] = 2^m \\frac{\\Gamma(k/2+m)}{\\Gamma(k/2)}$。对于 $m=-1$，我们得到：\n    $$E[W^{-1}] = 2^{-1} \\frac{\\Gamma(k/2-1)}{\\Gamma(k/2)} = \\frac{1}{2} \\frac{\\Gamma(k/2-1)}{(k/2-1)\\Gamma(k/2-1)} = \\frac{1}{k-2}$$\n    该期望仅在 $k/2-1 > 0$ 时有限，即 $k>2$。由于 $k=n-1$，我们需要 $n-1>2$，即 $n>3$。\n    所以，对于 $n>3$，$E[1/W] = 1/(n-3)$，这意味着 $E[1/S_{XX}] = \\frac{1}{\\sigma_{X}^{2}(n-3)}$。\n    结合这些部分，第三项是：\n    $$\\sigma_{\\epsilon}^{2} \\left(\\frac{\\sigma_{X}^{2}}{n}\\right) \\left(\\frac{1}{\\sigma_{X}^{2}(n-3)}\\right) = \\frac{\\sigma_{\\epsilon}^{2}}{n(n-3)} = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n(n-3)}$$\n\n4.  **最终组合**\n    对于 $n>3$，组合 $\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}})$ 的各项：\n    $$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n} + 0 + \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n(n-3)}$$\n    $$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n} \\left(1 + \\frac{1}{n-3}\\right)$$\n    $$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})}{n} \\left(\\frac{n-3+1}{n-3}\\right)$$\n    $$\\mathrm{Var}(\\widehat{\\mu}_{n}^{\\mathrm{cv}}) = \\frac{\\sigma_{Y}^{2}(1-\\rho^{2})(n-2)}{n(n-3)}$$\n这是对于 $n>3$ 的精确有限样本方差。与已知 $\\beta$ 时可以达到的理想方差 $\\frac{\\sigma_Y^2(1-\\rho^2)}{n}$ 相比，因子 $\\frac{n-2}{n-3}$ 代表了因从样本中估计最优控制系数 $\\beta$ 而产生的代价。对于 $n \\le 3$，方差是无穷大的。",
            "answer": "$$\\boxed{\\frac{\\sigma_{Y}^{2}(1-\\rho^{2})(n-2)}{n(n-3)}}$$"
        }
    ]
}