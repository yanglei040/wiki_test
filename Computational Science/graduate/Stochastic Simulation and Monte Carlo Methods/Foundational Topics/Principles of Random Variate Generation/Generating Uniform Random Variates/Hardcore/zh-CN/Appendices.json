{
    "hands_on_practices": [
        {
            "introduction": "线性同余生成器 (LCGs) 是伪随机数生成的基础。除了简单的逐个生成，我们常常需要在序列中“向前跳跃”很长的距离。LCG 的代数结构使其能够进行高效的“跨步”，这对于并行蒙特卡洛模拟至关重要，因为它能确保不同处理器从同一序列中不重叠的远处开始。这个练习  将引导您从第一性原理出发，推导并高效实现这一功能。",
            "id": "3310000",
            "problem": "考虑一个定义在整数模 $m$ 环 $\\mathbb{Z}_m$ 上的线性同余生成器 (LCG)，其递归关系为 $X_{n+1} \\equiv a X_n + c \\pmod{m}$，其中参数 $a \\in \\mathbb{Z}_m$, $c \\in \\mathbb{Z}_m$ 为固定值，且 $m \\geq 2$。对应的均匀变量序列为 $U_n = X_n / m$。从这个定义和 $\\mathbb{Z}_m$ 的代数性质出发，推导一个用 $X_n$, $a$, $c$, $t$ 和 $m$ 表示 $X_{n+t}$ 的封闭形式表达式，推导过程不应假设 $a$, $c$ 或 $m$ 具有任何特殊的数论性质。然后，仅使用第一性原理推导和环代数，解释如何通过结合 $\\mathbb{Z}_m$ 中的平方求幂和模逆元（当其存在时，即 $\\gcd(a-1, m) = 1$），以 $\\mathcal{O}(\\log t)$ 的时间复杂度高效地计算跳跃后的 $X_{n+t}$。如果 $\\gcd(a-1, m) \\neq 1$，解释一种避免在 $\\mathbb{Z}_m$ 中进行除法的替代方法。\n\n最后，将你的推导和方法应用于具体实例：$m = 1009$, $a = 7$, $c = 11$，初始状态 $X_0 = 123$，跳跃长度 $t = 20$。计算满足 $0 \\leq X_{20}  m$ 的 $X_{20}$ 的精确整数值。最终答案无需四舍五入，也不涉及单位。",
            "solution": "问题要求推导线性同余生成器 (LCG) 的封闭形式表达式，解释其高效计算方法，并进行一个具体计算。\n\n首先，我们推导 $X_{n+t}$ 的封闭形式表达式。LCG 由递归关系 $X_{k+1} \\equiv a X_k + c \\pmod{m}$ (对 $k \\ge 0$) 定义。我们可以从状态 $X_n$ 开始展开这个递归。\n当 $t=1$ 时：\n$X_{n+1} \\equiv a X_n + c \\pmod{m}$\n\n当 $t=2$ 时：\n$X_{n+2} \\equiv a X_{n+1} + c \\equiv a(a X_n + c) + c \\equiv a^2 X_n + ac + c \\pmod{m}$\n\n当 $t=3$ 时：\n$X_{n+3} \\equiv a X_{n+2} + c \\equiv a(a^2 X_n + ac + c) + c \\equiv a^3 X_n + a^2 c + ac + c \\pmod{m}$\n\n一个模式浮现出来。对于一般的整数 $t \\ge 1$，表达式似乎是：\n$$X_{n+t} \\equiv a^t X_n + c(a^{t-1} + a^{t-2} + \\dots + a + 1) \\pmod{m}$$\n这可以用求和符号更紧凑地写成：\n$$X_{n+t} \\equiv a^t X_n + c \\sum_{i=0}^{t-1} a^i \\pmod{m}$$\n我们用关于 $t$ 的数学归纳法证明这个公式。$t=1$ 的基础情况是 $X_{n+1} \\equiv a^1 X_n + c \\sum_{i=0}^{0} a^i \\equiv a X_n + c a^0 \\equiv aX_n + c$，这就是 LCG 的定义。\n假设该公式对某个整数 $k \\ge 1$ 成立：$X_{n+k} \\equiv a^k X_n + c \\sum_{i=0}^{k-1} a^i \\pmod{m}$。\n我们接着证明它对 $k+1$ 也成立：\n\\begin{align*} X_{n+k+1}  \\equiv a X_{n+k} + c \\\\  \\equiv a \\left( a^k X_n + c \\sum_{i=0}^{k-1} a^i \\right) + c \\\\  \\equiv a^{k+1} X_n + c \\left( a \\sum_{i=0}^{k-1} a^i \\right) + c \\\\  \\equiv a^{k+1} X_n + c \\left( \\sum_{i=0}^{k-1} a^{i+1} \\right) + c \\\\  \\equiv a^{k+1} X_n + c \\left( \\sum_{j=1}^{k} a^j + 1 \\right) \\\\  \\equiv a^{k+1} X_n + c \\sum_{j=0}^{k} a^j \\pmod{m}\\end{align*}\n公式对 $k+1$ 成立，因此根据数学归纳法原理，对于任何 $t \\ge 1$，$X_{n+t}$ 的封闭形式表达式是：\n$$X_{n+t} \\equiv a^t X_n + c \\sum_{i=0}^{t-1} a^i \\pmod{m}$$\n这个表达式仅通过递归定义和 $\\mathbb{Z}_m$ 的环性质推导得出，不依赖于 $a, c, m$ 的任何特殊性质。\n\n接下来，我们解释如何在 $\\mathcal{O}(\\log t)$ 时间内高效计算 $X_{n+t}$。计算需要求出 $a^t \\pmod{m}$ 和几何级数和 $S_t = \\sum_{i=0}^{t-1} a^i \\pmod{m}$。\n\n情况 1：$\\gcd(a-1, m) = 1$。\n在这种情况下，元素 $(a-1)$ 在环 $\\mathbb{Z}_m$ 中有乘法逆元，记作 $(a-1)^{-1}$。有限几何级数求和有一个著名的公式，该公式在任何分母可逆的环中都成立：\n$$\\sum_{i=0}^{t-1} a^i = (a^t - 1)(a-1)^{-1}$$\n将此代入封闭形式表达式，得到：\n$$X_{n+t} \\equiv a^t X_n + c (a^t - 1)(a-1)^{-1} \\pmod{m}$$\n计算过程如下：\n1. 计算 $A = a^t \\pmod{m}$。这可以通过平方求幂在 $\\mathcal{O}(\\log t)$ 时间内高效完成。\n2. 计算 $B = (a-1)^{-1} \\pmod{m}$。这可以使用扩展欧几里得算法求得，其时间复杂度为 $\\mathcal{O}(\\log m)$。\n3. 使用模运算组合最终结果：$X_{n+t} \\equiv A \\cdot X_n + c \\cdot (A - 1) \\cdot B \\pmod{m}$。这些是常数次操作。\n主要成本是模幂运算，所以总时间复杂度为 $\\mathcal{O}(\\log t+\\log m)$，由于 $t$ 是跳跃计算中的关键变量，通常简化为 $\\mathcal{O}(\\log t)$。\n\n情况 2：$\\gcd(a-1, m) \\neq 1$。\n在这种情况下，$(a-1)$ 在模 $m$ 下不可逆，几何级数和的分数形式公式不能直接使用。我们必须使用一种替代方法。该递归关系可以通过增广状态向量表示为矩阵形式：\n$$\\begin{pmatrix} X_{k+1} \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} a  c \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} X_k \\\\ 1 \\end{pmatrix}$$\n这是对增广状态向量的线性变换。应用此变换 $t$ 次，得到：\n$$\\begin{pmatrix} X_{n+t} \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} a  c \\\\ 0  1 \\end{pmatrix}^t \\begin{pmatrix} X_n \\\\ 1 \\end{pmatrix}$$\n问题简化为计算 $2 \\times 2$ 矩阵 $M = \\begin{pmatrix} a  c \\\\ 0  1 \\end{pmatrix}$ 的 $t$ 次幂。这可以使用矩阵的平方求幂在 $\\mathcal{O}(\\log t)$ 时间内完成。通过归纳法可以发现 $M^t$ 的各项为：\n$$M^t = \\begin{pmatrix} a^t  c \\sum_{i=0}^{t-1} a^i \\\\ 0  1 \\end{pmatrix}$$\n因此，执行矩阵平方求幂可以同时计算出 $a^t$ 和 $c \\sum_{i=0}^{t-1} a^i$，而无需任何模除法。在平方算法的每一步中，都涉及一次 $2 \\times 2$ 矩阵乘法，其中包括在 $\\mathbb{Z}_m$ 中的 8 次整数乘法和 4 次整数加法。因此，总复杂度为 $\\mathcal{O}(\\log t)$。这种方法是通用的，适用于任何参数 $a, c, m$。\n\n最后，我们将此方法应用于具体实例：$m = 1009$, $a = 7$, $c = 11$, $X_0 = 123$, $t = 20$。我们需要计算 $X_{20}$。\n首先，我们检查使用较简单方法（情况 1）的条件。我们计算 $\\gcd(a-1, m) = \\gcd(7-1, 1009) = \\gcd(6, 1009)$。由于 $1009$ 不能被 $2$ 整除（它是奇数）也不能被 $3$ 整除（其各位数字之和为 $1+0+0+9=10$），我们有 $\\gcd(6, 1009) = 1$。因此，我们可以使用涉及模逆元的方法。\n\n公式为 $X_{20} \\equiv a^{20} X_0 + c (a^{20} - 1)(a-1)^{-1} \\pmod m$。\n\n1. 计算 $a^{20} \\pmod m$，即 $7^{20} \\pmod{1009}$。我们使用平方求幂。$t=20$ 的二进制表示是 $10100_2$，所以 $20 = 16+4$。\n$7^1 \\equiv 7 \\pmod{1009}$\n$7^2 \\equiv 49 \\pmod{1009}$\n$7^4 \\equiv 49^2 = 2401 \\equiv 2 \\cdot 1009 + 383 \\equiv 383 \\pmod{1009}$\n$7^8 \\equiv 383^2 = 146689 \\equiv 145 \\cdot 1009 + 384 \\equiv 384 \\pmod{1009}$\n$7^{16} \\equiv 384^2 = 147456 \\equiv 146 \\cdot 1009 + 142 \\equiv 142 \\pmod{1009}$\n$7^{20} = 7^{16} \\cdot 7^4 \\equiv 142 \\cdot 383 = 54386 \\equiv 53 \\cdot 1009 + 909 \\equiv 909 \\pmod{1009}$。\n\n2. 计算 $(a-1)^{-1} \\pmod m$，即 $6^{-1} \\pmod{1009}$。我们对 $1009$ 和 $6$ 使用扩展欧几里得算法。\n$1009 = 168 \\cdot 6 + 1$\n重新整理得到 Bézout 恒等式：$1 = 1009 - 168 \\cdot 6$。\n将此方程模 $1009$ 运算，我们得到 $1 \\equiv -168 \\cdot 6 \\pmod{1009}$。\n所以，$6^{-1} \\equiv -168 \\equiv -168 + 1009 \\equiv 841 \\pmod{1009}$。\n\n3. 组合结果以求得 $X_{20}$。\n$X_{20} \\equiv 7^{20} \\cdot X_0 + 11 \\cdot (7^{20} - 1) \\cdot 6^{-1} \\pmod{1009}$\n$X_{20} \\equiv 909 \\cdot 123 + 11 \\cdot (909 - 1) \\cdot 841 \\pmod{1009}$\n$X_{20} \\equiv 909 \\cdot 123 + 11 \\cdot 908 \\cdot 841 \\pmod{1009}$\n\n分别计算这两个项：\n第 1 项：$909 \\cdot 123 = 111807$。\n$111807 = 110 \\cdot 1009 + 817$。所以，$909 \\cdot 123 \\equiv 817 \\pmod{1009}$。\n\n第 2 项：$11 \\cdot 908 \\cdot 841 \\pmod{1009}$。\n$11 \\cdot 908 = 9988$。$9988 = 9 \\cdot 1009 + 907$。所以，$11 \\cdot 908 \\equiv 907 \\pmod{1009}$。\n现在计算 $907 \\cdot 841 = 762787$。\n$762787 = 755 \\cdot 1009 + 992$。所以，$907 \\cdot 841 \\equiv 992 \\pmod{1009}$。\n\n最后，将两项相加：\n$X_{20} \\equiv 817 + 992 \\pmod{1009}$\n$X_{20} \\equiv 1809 \\pmod{1009}$\n$X_{20} \\equiv 1 \\cdot 1009 + 800 \\pmod{1009}$\n$X_{20} \\equiv 800 \\pmod{1009}$\n\n$X_{20}$ 的值是 $800$。",
            "answer": "$$\\boxed{800}$$"
        },
        {
            "introduction": "随机数生成器通常产生整数，但科学模拟需要的是 $(0,1)$ 区间内的浮点数。从整数到浮点数的转换精度至关重要。此练习  探讨如何将多个低精度随机整数组合起来，以构建一个无偏且符合浮点数标准（如 IEEE 754）的高精度均匀随机变量。通过将这种精心设计的方法与简单的缩放方法进行对比并计算其偏差，您将深刻理解生成高质量均匀分布随机变量过程中所涉及的精妙之处。",
            "id": "3309957",
            "problem": "考虑一个独立同分布的32位无符号整数$Y$的源，其在有限集合$\\{0,1,\\dots,2^{32}-1\\}$上均匀分布。您希望根据国际电气与电子工程师协会（IEEE）754 binary64标准，生成一个尽可能接近Uniform$(0,1)$分布的双精度实数变量，并量化由朴素映射引入的任何偏差。\n\n从均匀分布、实数的二进制表示的核心定义出发，并利用IEEE 754 binary64数具有53位尾数这一事实，完成以下任务：\n\n1. 使用来自给定源的最多两次独立抽取$Y_1$和$Y_2$，构造一个从$(Y_1,Y_2)$到双精度随机变量$V\\in(0,1)$的映射，该变量的分布在一个间距至多为$2^{-53}$的格点上是严格均匀的。该构造必须避免产生端点0和1，并且必须仅使用整数算术和一个固定的2的幂的倒数来指定。从第一性原理出发，论证所得到的离散分布在其支撑集上是均匀的，并且$\\mathbb{E}[V]=\\tfrac{1}{2}$。\n\n2. 分析在精确算术中执行然后以IEEE 754 binary64表示的天真实践$U=Y/2^{32}$。从期望和离散均匀分布的基本性质出发，推导精确的偏差$\\mathbb{E}[U]-\\tfrac{1}{2}$。\n\n请给出$\\mathbb{E}[U]-\\tfrac{1}{2}$的精确封闭形式表达式作为最终答案。无需舍入，不适用单位。",
            "solution": "该问题分为两部分。第一部分要求构造并论证一种在$(0,1)$上生成高精度均匀随机变量的方法。第二部分要求分析一个更简单的朴素方法的偏差。\n\n### 第1部分：高精度变量$V$的构造与论证\n\n目标是构造一个随机变量$V$，它在区间$(0,1)$内的一个离散点集上是均匀分布的。该变量的精度应与IEEE 754 binary64格式的53位尾数相匹配。随机源由独立同分布的32位无符号整数$Y$组成，其在集合$\\{0, 1, \\dots, 2^{32}-1\\}$上均匀分布。\n\n**构造：**\n我们需要至少53位的随机性来构造目标变量的尾数。由于单次抽取$Y$只提供32位，我们必须使用两次抽取，$Y_1$和$Y_2$。这两次抽取总共提供64位的随机性，这是足够的。\n\n1.  **生成一个53位的均匀整数$I$：** 我们可以组合$Y_1$和$Y_2$的位来形成一个53位的整数。一种标准方法是使用$Y_1$作为最高有效位，并使用$Y_2$的一部分作为最低有效位。我们如下构造一个53位整数$I$，使用对应于位移和拼接的整数算术运算：\n    $$I = Y_1 \\cdot 2^{21} + \\lfloor Y_2 / 2^{11} \\rfloor$$\n    此处，$Y_1$被视为一个32位整数，乘以$2^{21}$实际上将其位移到占据位置21到52。项$\\lfloor Y_2 / 2^{11} \\rfloor$提取了32位整数$Y_2$的最高有效21位，这些位随后占据位置0到20。\n\n2.  **论证$I$的均匀性：** 变量$Y_1$可以取$\\{0, 1, \\dots, 2^{32}-1\\}$中的任意整数值。变量$\\lfloor Y_2 / 2^{11} \\rfloor$可以取$\\{0, 1, \\dots, 2^{21}-1\\}$中的任意整数值。因此，组合$I$可以取从$0 \\cdot 2^{21} + 0 = 0$到$(2^{32}-1) \\cdot 2^{21} + (2^{21}-1) = 2^{53} - 2^{21} + 2^{21} - 1 = 2^{53}-1$的任意整数值。所以，$I$是集合$\\{0, 1, \\dots, 2^{53}-1\\}$中的一个整数。\n\n    为证明$I$是均匀分布的，我们考虑映射到特定值$i \\in \\{0, 1, \\dots, 2^{53}-1\\}$的数对$(Y_1, Y_2)$的数量。对于任何这样的$i$，我们可以唯一地确定所需的$Y_1$值和$Y_2$的高位值：\n    -   $Y_1 = \\lfloor i / 2^{21} \\rfloor$。这唯一地确定了$Y_1$。\n    -   $\\lfloor Y_2 / 2^{11} \\rfloor = i \\pmod{2^{21}}$。设这个值为$y'_2$。对$Y_2$的条件是$y'_2 \\cdot 2^{11} \\le Y_2  (y'_2+1) \\cdot 2^{11}$。满足此条件的$Y_2$整数值的数量为$(y'_2+1) \\cdot 2^{11} - y'_2 \\cdot 2^{11} = 2^{11}$。\n    因此，对于$I$范围内的任何给定值$i$，恰好有$1 \\times 2^{11} = 2^{11}$个数对$(Y_1, Y_2)$会产生它。由于每个数对$(Y_1, Y_2)$都是等可能的，其概率为$(1/2^{32})^2 = 1/2^{64}$，所以获得任何特定值$i$的概率是$P(I=i) = 2^{11} \\cdot (1/2^{64}) = 1/2^{53}$。这证实了$I$在$\\{0, 1, \\dots, 2^{53}-1\\}$上是均匀分布的。\n\n3.  **构造最终变量$V$：** 我们需要将整数$I$映射到一个实数$V \\in (0,1)$，使得得到的离散分布在其支撑集上是均匀的，并且间距至多为$2^{-53}$。该构造必须只使用整数算术，然后乘以一个2的幂的倒数。\n    让我们定义一个中间整数$K = 2I+1$。由于$I$在$\\{0, 1, \\dots, 2^{53}-1\\}$上是均匀分布的，$K$在奇数集合$\\{1, 3, 5, \\dots, 2(2^{53}-1)+1\\} = \\{1, 3, 5, \\dots, 2^{54}-1\\}$上是均匀分布的。\n    现在，将$V$定义为：\n    $$V = K \\cdot 2^{-54} = (2I+1) \\cdot 2^{-54}$$\n    $V$的值构成集合$\\{\\frac{1}{2^{54}}, \\frac{3}{2^{54}}, \\dots, \\frac{2^{54}-1}{2^{54}}\\}$。所有这些值都严格介于0和1之间。连续值之间的间距为$\\frac{2}{2^{54}} = \\frac{1}{2^{53}}$，这满足了至多为$2^{-53}$的条件。该构造只涉及整数算术($2I+1$)，然后乘以单个倒数$2^{-54}$。\n\n**$V$的均匀性和期望值的论证：**\n-   **均匀性：** 从$I$到$K$的映射是一个双射。由于$I$在其大小为$2^{53}$的支撑集上是均匀的，所以$K$也在其支撑集上是均匀的，其大小同样为$2^{53}$。最终变量$V$是$K$的线性变换，因此$V$在其支撑集上是均匀的。\n-   **期望值：** 我们必须证明$\\mathbb{E}[V] = \\frac{1}{2}$。我们可以使用期望的线性性质。\n    $$ \\mathbb{E}[V] = \\mathbb{E}[(2I+1) \\cdot 2^{-54}] = 2^{-54} \\cdot (2\\mathbb{E}[I]+1) $$\n    随机变量$I$在$\\{0, 1, \\dots, N-1\\}$上均匀分布，其中$N=2^{53}$。这样一个变量的期望是：\n    $$ \\mathbb{E}[I] = \\frac{1}{N} \\sum_{i=0}^{N-1} i = \\frac{1}{N} \\frac{(N-1)N}{2} = \\frac{N-1}{2} $$\n    代入$N=2^{53}$，我们得到$\\mathbb{E}[I] = \\frac{2^{53}-1}{2}$。\n    现在，将此代入$\\mathbb{E}[V]$的表达式中：\n    $$ \\mathbb{E}[V] = 2^{-54} \\cdot \\left(2 \\cdot \\frac{2^{53}-1}{2} + 1\\right) = 2^{-54} \\cdot ((2^{53}-1)+1) = 2^{-54} \\cdot 2^{53} = \\frac{1}{2} $$\n    因此，该构造从第一性原理得到了验证。\n\n### 第2部分：朴素缩放$U = Y/2^{32}$的偏差\n\n我们分析朴素方法，其中单个32位无符号整数$Y$被缩放。$Y$是一个在集合$\\{0, 1, \\dots, 2^{32}-1\\}$上服从离散均匀分布的随机变量。朴素变量是$U = Y/2^{32}$。\n\n问题指定除法在精确算术中执行，然后结果表示为IEEE 754 binary64数。$U$的值的形式为$k/2^{32}$，其中$k$是整数。这些是二进有理数。任何分母是小于或等于$2^{52}$（对于规格化数）的2的幂的此类数字，在二进制浮点算术中都有精确的有限表示。由于$32 \\le 52$，所有值$k/2^{32}$在binary64中都可以精确表示。因此，随机变量$U$恰好是$Y/2^{32}$。\n\n$U$的支撑集是集合$\\{0, \\frac{1}{2^{32}}, \\frac{2}{2^{32}}, \\dots, \\frac{2^{32}-1}{2^{32}}\\}$。由于$Y$是均匀分布的，这$2^{32}$个值中的每一个都以相等的概率$p = 1/2^{32}$被取到。\n\n为了求偏差，我们首先计算期望值$\\mathbb{E}[U]$。令$N = 2^{32}$。变量$Y$在$\\{0, 1, \\dots, N-1\\}$上均匀分布。\n根据期望的基本性质，我们有：\n$$ \\mathbb{E}[U] = \\mathbb{E}\\left[\\frac{Y}{N}\\right] = \\frac{1}{N}\\mathbb{E}[Y] $$\n离散均匀变量$Y$的期望是其支撑集中所有值的平均值：\n$$ \\mathbb{E}[Y] = \\frac{1}{N} \\sum_{k=0}^{N-1} k = \\frac{1}{N} \\frac{(N-1)N}{2} = \\frac{N-1}{2} $$\n将此代入$\\mathbb{E}[U]$的表达式中：\n$$ \\mathbb{E}[U] = \\frac{1}{N} \\left(\\frac{N-1}{2}\\right) = \\frac{N-1}{2N} $$\n偏差定义为该期望值与真实Uniform$(0,1)$分布的均值$\\frac{1}{2}$之间的差异。\n$$ \\text{Bias} = \\mathbb{E}[U] - \\frac{1}{2} = \\frac{N-1}{2N} - \\frac{1}{2} $$\n为了合并这些项，我们使用公分母$2N$：\n$$ \\text{Bias} = \\frac{N-1}{2N} - \\frac{N}{2N} = \\frac{(N-1)-N}{2N} = \\frac{-1}{2N} $$\n最后，代入$N = 2^{32}$：\n$$ \\text{Bias} = \\frac{-1}{2 \\cdot 2^{32}} = -\\frac{1}{2^{33}} $$\n这个负偏差表明朴素生成的变量的均值略小于$\\frac{1}{2}$，这是预料之中的，因为$U$的支撑集是$[0, 1 - 2^{-32}]$，这是一个不关于$\\frac{1}{2}$对称的区间。",
            "answer": "$$\\boxed{-\\frac{1}{2^{33}}}$$"
        },
        {
            "introduction": "理论上的均匀分布 $U(0,1)$ 定义在开区间上，但其在计算机中的离散近似可能包含端点 0 或 1。这个微小的差异重要吗？本练习  旨在探究生成精确的 0 或 1 可能带来的严重后果，尤其是在使用逆变换采样方法时。通过分析像帕累托分布这样的重尾分布，您将看到生成 $U=1$ 的一个看似微不足道的概率如何导致灾难性的数值结果（无穷大），从而强调了理解生成器确切输出范围的极端重要性。",
            "id": "3309936",
            "problem": "一个伪随机数生成器（PRNG, pseudorandom number generator）产生独立同分布的比特。考虑使用两种基于 $b=53$ 比特精度的整数到浮点数映射方案，来生成单位区间上均匀分布的浮点近似值。这种精度通常用于填充双精度浮点数的尾数。\n\n- 方案 A（右开离散化）：从离散集合 $\\{0,1,2,\\ldots,2^{53}-1\\}$ 中均匀采样 $I$，并设 $U_{A} = I / 2^{53}$。\n- 方案 B（闭合离散化）：从离散集合 $\\{0,1,2,\\ldots,2^{53}\\}$ 中均匀采样 $J$，并设 $U_{B} = J / 2^{53}$。\n\n你将分析在每种方案下生成边界值 $U=0$ 和 $U=1$ 的确切概率，然后评估这些概率对重尾分布的逆变换采样的影响。\n\n设 $F$ 是一个帕累托分布的累积分布函数，其尾指数为 $\\alpha  0$，尺度参数为 $x_{m}  0$，即\n$$\nF(x) =\n\\begin{cases}\n0,  x  x_{m} \\\\\n1 - \\left(\\frac{x_{m}}{x}\\right)^{\\alpha},  x \\ge x_{m}\n\\end{cases}\n$$\n在逆变换采样中，我们设 $X = F^{-1}(U)$，其中 $U$ 在 $[0,1]$ 上均匀分布。\n\n根据有限集上的离散均匀分布和逆变换法的定义，完成以下任务：\n\n1. 推导 $P(U_{A} = 0)$、$P(U_{A} = 1)$、$P(U_{B} = 0)$ 和 $P(U_{B} = 1)$。\n2. 仅使用上述帕累托累积分布函数的定义，推导对于 $u \\in [0,1]$ 的 $F^{-1}(u)$，并在每种方案下，确定 $X$ 为无穷大的确切概率，即 $P(X = +\\infty)$。\n3. 现在假设你在方案 B 下生成了 $N = 10^{12}$ 个独立变量 $U_{B}^{(1)},\\ldots,U_{B}^{(N)}$，并将每个变量转换为 $X^{(i)} = F^{-1}(U_{B}^{(i)})$。计算至少有一个 $X^{(i)}$ 为 $+\\infty$ 的概率。将你最终的数值答案四舍五入到四位有效数字。\n\n你的最终答案必须是第 3 项中要求的单个数值，按规定进行四舍五入，不带单位。",
            "solution": "本题要求分析两种在单位区间上生成均匀随机变量的离散近似值的不同方案，以及这些方案对帕累托分布逆变换采样的影响。解答按要求分为三个部分。\n\n### 第一部分：边界值的概率\n\n设 $b=53$。\n\n**方案 A（右开离散化）**\n\n在方案 A 下，一个随机整数 $I$ 从集合 $\\mathcal{I} = \\{0, 1, 2, \\ldots, 2^{b}-1\\}$ 中均匀抽取。该集合的大小为 $|\\mathcal{I}| = 2^{b}$。$I$ 的概率质量函数为 $P(I=i) = \\frac{1}{2^{b}}$，适用于任何 $i \\in \\mathcal{I}$。该随机变量为 $U_{A} = I / 2^{b}$。\n\n我们确定生成边界值 $0$ 和 $1$ 的概率。\n\n-   **生成 $U_{A}=0$ 的概率**：\n    事件 $U_{A}=0$ 发生当且仅当 $I=0$。因为 $0 \\in \\mathcal{I}$，所以这个事件是可能发生的。其概率为：\n    $$P(U_{A}=0) = P(I=0) = \\frac{1}{2^{b}} = \\frac{1}{2^{53}}$$\n\n-   **生成 $U_{A}=1$ 的概率**：\n    事件 $U_{A}=1$ 发生当且仅当 $I/2^{b}=1$，这意味着 $I=2^{b}$。然而，集合 $\\mathcal{I}$ 中的最大值是 $2^{b}-1$。因此，$I=2^{b}$ 是一个不可能事件。\n    $$P(U_{A}=1) = P(I=2^{b}) = 0$$\n\n**方案 B（闭合离散化）**\n\n在方案 B 下，一个随机整数 $J$ 从集合 $\\mathcal{J} = \\{0, 1, 2, \\ldots, 2^{b}\\}$ 中均匀抽取。该集合的大小为 $|\\mathcal{J}| = 2^{b}+1$。$J$ 的概率质量函数为 $P(J=j) = \\frac{1}{2^{b}+1}$，适用于任何 $j \\in \\mathcal{J}$。该随机变量为 $U_{B} = J / 2^{b}$。\n\n我们确定生成边界值 $0$ 和 $1$ 的概率。\n\n-   **生成 $U_{B}=0$ 的概率**：\n    事件 $U_{B}=0$ 发生当且仅当 $J=0$。因为 $0 \\in \\mathcal{J}$，所以这个事件是可能发生的。其概率为：\n    $$P(U_{B}=0) = P(J=0) = \\frac{1}{2^{b}+1} = \\frac{1}{2^{53}+1}$$\n\n-   **生成 $U_{B}=1$ 的概率**：\n    事件 $U_{B}=1$ 发生当且仅当 $J/2^{b}=1$，这意味着 $J=2^{b}$。因为 $2^{b} \\in \\mathcal{J}$，所以这个事件是可能发生的。其概率为：\n    $$P(U_{B}=1) = P(J=2^{b}) = \\frac{1}{2^{b}+1} = \\frac{1}{2^{53}+1}$$\n\n### 第二部分：逆累积分布函数和无穷大概率\n\n首先，我们推导帕累托分布的逆累积分布函数 $F^{-1}(u)$。其 CDF 由 $F(x) = 1 - (x_{m}/x)^{\\alpha}$（对于 $x \\ge x_{m}$）给出。我们设 $u = F(x)$，其中 $u$ 在 $F$ 的值域 $[0, 1)$ 内，然后解出 $x$：\n$$u = 1 - \\left(\\frac{x_{m}}{x}\\right)^{\\alpha}$$\n$$\\left(\\frac{x_{m}}{x}\\right)^{\\alpha} = 1 - u$$\n$$\\frac{x_{m}}{x} = (1 - u)^{1/\\alpha}$$\n$$x = \\frac{x_{m}}{(1 - u)^{1/\\alpha}} = x_{m}(1-u)^{-1/\\alpha}$$\n因此，对于 $u \\in [0, 1)$，逆 CDF 为 $F^{-1}(u) = x_{m}(1-u)^{-1/\\alpha}$。\n\n题目要求考虑 $u \\in [0, 1]$。我们必须考察在 $u=1$ 处的行为。当 $u \\to 1^{-}$ 时，项 $(1-u) \\to 0^{+}$，因此由于 $\\alpha > 0$，$(1-u)^{-1/\\alpha} \\to +\\infty$。因此，通常定义 $F^{-1}(1) = +\\infty$。\n\n使用逆变换法 $X = F^{-1}(U)$ 从帕累托分布中采样得到的值 $X$ 将为无穷大，当且仅当均匀变量 $U$ 恰好为 1。因此，概率 $P(X=+\\infty)$ 等于概率 $P(U=1)$。\n\n我们现在可以使用第一部分的结果来计算每种方案下的这个概率。\n\n-   **方案 A**：\n    $$P(X=+\\infty) = P(U_{A}=1) = 0$$\n\n-   **方案 B**：\n    $$P(X=+\\infty) = P(U_{B}=1) = \\frac{1}{2^{53}+1}$$\n\n这凸显了一个关键差异：方案 A 永远不能生成无穷大值，而方案 B 则可以，尽管概率非常小。\n\n### 第三部分：至少一个无穷大变量的概率\n\n给定在方案 B 下生成的 $N = 10^{12}$ 个独立变量 $U_{B}^{(i)}$。对于每个 $i \\in \\{1, \\ldots, N\\}$，我们将其转换为 $X^{(i)} = F^{-1}(U_{B}^{(i)})$。我们需要计算这些 $X^{(i)}$ 中至少有一个为 $+\\infty$ 的概率。\n\n设 $E_{i}$ 为事件 $X^{(i)} = +\\infty$。根据第二部分的结论，单次试验中此事件的概率为：\n$$p = P(E_{i}) = P(X = +\\infty \\text{ under Scheme B}) = \\frac{1}{2^{53}+1}$$\n试验是独立的。至少有一个事件 $E_{i}$ 发生的概率是 1 减去所有事件都不发生的概率。单个事件 $E_{i}$ 不发生的概率是 $1-p$。$N$ 个独立事件全都不发生的概率是 $(1-p)^{N}$。\n\n所求概率为：\n$$P(\\text{at least one } X^{(i)} = +\\infty) = 1 - (1-p)^{N} = 1 - \\left(1 - \\frac{1}{2^{53}+1}\\right)^{10^{12}}$$\n\n这个表达式是精确的。为了计算其数值，我们注意到 $N$ 非常大而 $p$ 非常小。在这种情况下，“成功”（即 $X^{(i)}=+\\infty$ 发生）的次数可以很好地用参数为 $\\lambda = Np$ 的泊松分布来近似。零次成功的概率是 $\\exp(-\\lambda)$。至少有一次成功的概率是 $1 - \\exp(-\\lambda)$。这个近似非常精确。\n\n我们来计算 $\\lambda$：\n$$\\lambda = Np = \\frac{10^{12}}{2^{53}+1}$$\n使用 $2^{53} = 9007199254740992$，我们得到：\n$$\\lambda = \\frac{10^{12}}{9007199254740993} \\approx 0.0001110223024625$$\n现在我们计算概率：\n$$P(\\text{at least one } \\infty) \\approx 1 - \\exp(-\\lambda) = 1 - \\exp(-0.0001110223024625)$$\n使用计算器，\n$$P(\\text{at least one } \\infty) \\approx 1 - 0.9998889838318...$$\n$$P(\\text{at least one } \\infty) \\approx 0.00011101616818...$$\n题目要求将最终答案四舍五入到四位有效数字。前四位有效数字是 $1, 1, 1, 0$。第五位有效数字是 $1$，所以我们不对第四位进行进位。\n\n最终的数值是 $0.0001110$。",
            "answer": "$$\\boxed{0.0001110}$$"
        }
    ]
}