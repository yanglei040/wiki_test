{
    "hands_on_practices": [
        {
            "introduction": "A robust computational tool begins with a solid foundation. This first practice guides you through the essential task of translating the mathematical definition of the Kirkwood-Buff integral, $G_{ij}$, into a working numerical code. By testing your implementation in the ideal gas limit, where spatial correlations vanish and the exact result is known to be zero , you will build and validate a reliable tool for the more complex analyses to come.",
            "id": "3419765",
            "problem": "Consider a binary mixture in the ideal gas limit, where particles do not interact and the structure is isotropic in three dimensions. Let the Radial Distribution Function (RDF) between species $i$ and $j$ be denoted by $g_{ij}(r)$. In the ideal gas limit, there are no spatial correlations and the RDF satisfies $g_{ij}(r) = 1$ for all $r  0$. The Kirkwood-Buff (KB) integral $G_{ij}$ is defined as the integral over all space of the total correlation function $h_{ij}(\\mathbf{r}) = g_{ij}(\\mathbf{r}) - 1$. In an isotropic fluid, this integral can be expressed in terms of the radial coordinate $r$ and the appropriate spherical measure. \n\nYour task is to derive, implement, and unit test a numerical estimator for $G_{ij}$ based on a discretized RDF sampled on a uniform radial grid. The derivation must start from the definition of the RDF and the definition of the KB integral as a three-dimensional integral of the total correlation function over space, specialized to isotropic systems through the correct spherical measure. Then, design a consistent numerical quadrature to approximate the isotropic three-dimensional integral using a uniform grid with spacing $\\Delta r$ over the interval $[0, R_{\\max}]$. The estimator must support at least two quadrature rules: a composite trapezoidal rule and a composite Simpson’s rule (the latter requiring an odd number of grid points). \n\nIn the ideal gas limit, $g_{ij}(r) = 1$, so the exact integral must be $G_{ij} = 0$. Use this fact to construct a unit test suite that checks whether the numerical estimator yields a value close to $0$ within a specified absolute tolerance. To emulate realistic finite-sampling artifacts from Molecular Dynamics (MD) data without leaving the ideal gas limit, optionally perturb the ideal gas RDF by adding mean-zero Gaussian noise of specified standard deviation $\\sigma$ to $g_{ij}(r)$ prior to integration; this preserves the ideal gas expectation $G_{ij}=0$ but introduces numerical deviations that a robust estimator should keep within a tolerance that you must specify. If noise is used, you must use the provided random seed to ensure reproducibility.\n\nImplementation details and requirements:\n- Construct the uniform grid as $r_k = k\\,\\Delta r$ for $k = 0, 1, \\dots, N$ with $N = R_{\\max}/\\Delta r$ assumed to be an integer, so that the grid includes both $0$ and $R_{\\max}$. Distances $r$ must be in nanometers (nm). The final Kirkwood-Buff integral must be reported and compared in cubic nanometers (nm$^3$).\n- The numerical estimator must implement both a composite trapezoidal rule and a composite Simpson’s rule to approximate the isotropic three-dimensional integral of $g_{ij}(r) - 1$ over space using the correct spherical measure for isotropic systems in three dimensions.\n- For unit testing, use the following test suite. For each case, construct $g_{ij}(r)$ as $1$ plus optional Gaussian noise $\\mathcal{N}(0,\\sigma^2)$ added independently at each grid point, using the provided random seed when $\\sigma  0$. Compute the numerical estimate $\\widehat{G}_{ij}$ and return a boolean indicating whether $|\\widehat{G}_{ij}| \\le \\text{tol}$, where $\\text{tol}$ is the stated absolute tolerance in nm$^3$.\n    1. Case A (happy path, trapezoid, fine grid, no noise): $\\Delta r = 0.01$ nm, $R_{\\max} = 10.0$ nm, quadrature rule = trapezoid, $\\sigma = 0$, tolerance $\\text{tol} = 1.0\\times 10^{-12}$ nm$^3$.\n    2. Case B (happy path, Simpson, fine grid, no noise): $\\Delta r = 0.0025$ nm, $R_{\\max} = 5.0$ nm, quadrature rule = Simpson, $\\sigma = 0$, tolerance $\\text{tol} = 1.0\\times 10^{-12}$ nm$^3$.\n    3. Case C (noisy, moderate grid): $\\Delta r = 0.005$ nm, $R_{\\max} = 5.0$ nm, quadrature rule = trapezoid, $\\sigma = 1.0\\times 10^{-7}$, random seed $12345$, tolerance $\\text{tol} = 1.0\\times 10^{-4}$ nm$^3$.\n    4. Case D (boundary condition, very coarse grid, no noise): $\\Delta r = 1.0$ nm, $R_{\\max} = 1.0$ nm, quadrature rule = trapezoid, $\\sigma = 0$, tolerance $\\text{tol} = 1.0\\times 10^{-12}$ nm$^3$.\n    5. Case E (small cutoff with noise): $\\Delta r = 0.01$ nm, $R_{\\max} = 0.5$ nm, quadrature rule = trapezoid, $\\sigma = 1.0\\times 10^{-6}$, random seed $24680$, tolerance $\\text{tol} = 1.0\\times 10^{-6}$ nm$^3$.\n\nYour program must:\n- Implement the numerical estimator for $G_{ij}$ using the correct three-dimensional isotropic measure and the specified quadrature rule.\n- For each test case, build the grid and $g_{ij}(r)$ as described, compute $\\widehat{G}_{ij}$, compare $|\\widehat{G}_{ij}|$ to the provided tolerance, and collect a boolean result.\n- Produce a single line of output containing the boolean results for Cases A through E as a comma-separated list enclosed in square brackets, for example, `[True,False,True,True,True]`.\n\nNote: Ensure that any angles, if they appeared, would be in radians, but no angles are used here. Distances must be in nanometers (nm), and the Kirkwood-Buff integral must be in cubic nanometers (nm$^3$). The final program must run without external input and must print exactly one line in the specified format.",
            "solution": "The problem requires the derivation and implementation of a numerical estimator for the Kirkwood-Buff (KB) integral, $G_{ij}$, for a binary mixture in the ideal gas limit. The validation of this estimator is performed using a unit test suite where the ideal gas condition implies that the theoretical value of the integral is zero.\n\n### Derivation of the Isotropic KB Integral Estimator\n\nThe Kirkwood-Buff integral, $G_{ij}$, is defined as the volume integral of the total correlation function, $h_{ij}(\\mathbf{r})$, over all space. The total correlation function is related to the radial distribution function (RDF), $g_{ij}(\\mathbf{r})$, by $h_{ij}(\\mathbf{r}) = g_{ij}(\\mathbf{r}) - 1$.\nThe definition of $G_{ij}$ is:\n$$\nG_{ij} = \\int_{\\mathbb{R}^3} h_{ij}(\\mathbf{r}) \\, d\\mathbf{r}\n$$\n\nFor an isotropic system, the correlation functions depend only on the scalar distance $r = |\\mathbf{r}|$, so $g_{ij}(\\mathbf{r}) = g_{ij}(r)$ and $h_{ij}(\\mathbf{r}) = h_{ij}(r)$. This symmetry allows for a significant simplification of the three-dimensional integral by transforming it into spherical coordinates. In spherical coordinates, the differential volume element is $d\\mathbf{r} = r^2 \\sin\\theta \\, dr \\, d\\theta \\, d\\phi$, where $r \\in [0, \\infty)$, $\\theta \\in [0, \\pi]$, and $\\phi \\in [0, 2\\pi]$.\n\nThe integral for $G_{ij}$ can be rewritten as:\n$$\nG_{ij} = \\int_0^\\infty \\int_0^\\pi \\int_0^{2\\pi} h_{ij}(r) \\, r^2 \\sin\\theta \\, d\\phi \\, d\\theta \\, dr\n$$\n\nSince the integrand $h_{ij}(r) r^2$ does not depend on the angular variables $\\theta$ and $\\phi$, we can perform the angular integration separately:\n$$\n\\int_0^{2\\pi} d\\phi = 2\\pi\n$$\n$$\n\\int_0^\\pi \\sin\\theta \\, d\\theta = [-\\cos\\theta]_0^\\pi = (-\\cos(\\pi)) - (-\\cos(0)) = 1 - (-1) = 2\n$$\n\nThe product of the angular integrals is the total solid angle, $4\\pi$. Thus, the $G_{ij}$ integral simplifies to a one-dimensional integral over the radial coordinate $r$:\n$$\nG_{ij} = 4\\pi \\int_0^\\infty h_{ij}(r) \\, r^2 \\, dr = 4\\pi \\int_0^\\infty (g_{ij}(r) - 1) \\, r^2 \\, dr\n$$\n\nIn practical applications, such as analyzing data from molecular dynamics simulations, the RDF is only known up to a finite cutoff distance, $R_{\\max}$. Beyond this cutoff, the correlations are assumed to have vanished, i.e., $g_{ij}(r) = 1$ for $r  R_{\\max}$. This implies $h_{ij}(r) = 0$ for $r  R_{\\max}$, so the integral can be truncated at $R_{\\max}$ without loss of accuracy under this assumption. The numerical estimator, $\\widehat{G}_{ij}$, is therefore based on the definite integral:\n$$\n\\widehat{G}_{ij} = 4\\pi \\int_0^{R_{\\max}} (g_{ij}(r) - 1) \\, r^2 \\, dr\n$$\n\n### Numerical Quadrature\n\nTo compute this integral numerically, we discretize the radial domain $[0, R_{\\max}]$ into a uniform grid defined by points $r_k = k \\Delta r$ for $k = 0, 1, \\dots, N$, where $N = R_{\\max} / \\Delta r$ is an integer. Let the integrand be denoted by $f(r) = 4\\pi (g_{ij}(r) - 1) r^2$, and its value at grid point $r_k$ be $f_k = f(r_k)$. Two numerical quadrature methods are specified:\n\n1.  **Composite Trapezoidal Rule**: This method approximates the integral by summing the areas of trapezoids formed by adjacent grid points. The formula for the integral is:\n    $$\n    \\widehat{G}_{ij} \\approx \\frac{\\Delta r}{2} \\sum_{k=0}^{N-1} (f_k + f_{k+1}) = \\Delta r \\left( \\frac{f_0 + f_N}{2} + \\sum_{k=1}^{N-1} f_k \\right)\n    $$\n\n2.  **Composite Simpson's Rule**: This method provides a more accurate approximation by fitting parabolic segments to adjacent pairs of intervals. It requires an even number of intervals, $N$, which means the total number of grid points, $N+1$, must be odd. The formula is:\n    $$\n    \\widehat{G}_{ij} \\approx \\frac{\\Delta r}{3} [f_0 + 4f_1 + 2f_2 + 4f_3 + \\dots + 2f_{N-2} + 4f_{N-1} + f_N]\n    $$\n\n### Implementation for Unit Testing\n\nThe implementation will compute $\\widehat{G}_{ij}$ for several test cases. For each case, we first construct the radial grid $r_k$ and the RDF values $g_{ij}(r_k)$. In the ideal gas limit, $g_{ij}(r) = 1$ for $r  0$. At $r_0 = 0$, the $r^2$ term in the integrand $f(r)$ ensures that $f(0) = 4\\pi (g_{ij}(0) - 1) \\cdot 0^2 = 0$, making the value of $g_{ij}(0)$ irrelevant. Therefore, with no noise, the integrand $f(r_k)$ is identically $0$ for all $k$, and any correct quadrature implementation should return a result of exactly $0.0$.\n\nFor cases with noise, the RDF is modeled as $g_{ij}(r_k) = 1 + \\epsilon_k$, where $\\epsilon_k$ is a random variable drawn from a Gaussian distribution $\\mathcal{N}(0, \\sigma^2)$. The integrand becomes $f(r_k) = 4\\pi \\epsilon_k r_k^2$. The resulting integral is a weighted sum of random variables. While its expectation value is $0$, any single realization will yield a small, non-zero value. The unit tests verify that this numerical noise remains within a specified tolerance, $\\text{tol}$, by checking if $|\\widehat{G}_{ij}| \\le \\text{tol}$. The provided `numpy` and `scipy` libraries offer robust implementations of these quadrature rules.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef compute_kb_integral(delta_r: float, r_max: float, quadrature_rule: str, sigma: float, seed: int | None) - float:\n    \"\"\"\n    Computes the Kirkwood-Buff integral for a given set of parameters.\n\n    Args:\n        delta_r: The radial grid spacing in nm.\n        r_max: The cutoff radius for the integration in nm.\n        quadrature_rule: The name of the quadrature rule ('trapezoid' or 'Simpson').\n        sigma: The standard deviation of the Gaussian noise to add to g_ij(r).\n        seed: The random seed for noise generation.\n\n    Returns:\n        The numerically estimated Kirkwood-Buff integral in nm^3.\n    \"\"\"\n    # Ensure N is an integer, as per problem statement\n    if not np.isclose(r_max % delta_r, 0) and not np.isclose(r_max % delta_r, delta_r):\n        raise ValueError(\"r_max must be an integer multiple of delta_r\")\n    N = int(round(r_max / delta_r))\n    \n    num_points = N + 1\n\n    # For Simpson's rule, the number of intervals N must be even,\n    # which means the number of points (N+1) must be odd.\n    if quadrature_rule.lower() == 'simpson' and num_points % 2 == 0:\n        raise ValueError(\"Simpson's rule requires an odd number of grid points (even number of intervals).\")\n\n    # 1. Construct the uniform radial grid from 0 to r_max\n    r = np.linspace(0.0, r_max, num=num_points)\n\n    # 2. Construct the radial distribution function g_ij(r)\n    # In the ideal gas limit, g_ij(r) = 1.\n    g_ij = np.ones_like(r)\n\n    # 3. Add optional mean-zero Gaussian noise\n    if sigma  0:\n        if seed is None:\n            raise ValueError(\"A seed must be provided for noise generation.\")\n        rng = np.random.default_rng(seed)\n        noise = rng.normal(loc=0.0, scale=sigma, size=g_ij.shape)\n        g_ij += noise\n\n    # 4. Calculate the integrand: 4 * pi * (g_ij(r) - 1) * r^2\n    # The term (g_ij - 1) is simply the noise if present, or zero otherwise.\n    total_correlation_h = g_ij - 1.0\n    integrand = 4.0 * np.pi * total_correlation_h * r**2\n\n    # 5. Perform the numerical integration\n    g_kb = 0.0\n    if quadrature_rule.lower() == 'trapezoid':\n        g_kb = np.trapz(integrand, x=r)\n    elif quadrature_rule.lower() == 'simpson':\n        g_kb = simpson(integrand, x=r)\n    else:\n        raise ValueError(f\"Unknown quadrature rule: {quadrature_rule}\")\n\n    return g_kb\n    \n\ndef solve():\n    \"\"\"\n    Runs the unit test suite for the Kirkwood-Buff integral estimator.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path, trapezoid, fine grid, no noise\n        {'delta_r': 0.01, 'r_max': 10.0, 'rule': 'trapezoid', 'sigma': 0.0, 'seed': None, 'tol': 1.0e-12},\n        # Case B: happy path, Simpson, fine grid, no noise\n        {'delta_r': 0.0025, 'r_max': 5.0, 'rule': 'Simpson', 'sigma': 0.0, 'seed': None, 'tol': 1.0e-12},\n        # Case C: noisy, moderate grid\n        {'delta_r': 0.005, 'r_max': 5.0, 'rule': 'trapezoid', 'sigma': 1.0e-7, 'seed': 12345, 'tol': 1.0e-4},\n        # Case D: boundary condition, very coarse grid, no noise\n        {'delta_r': 1.0, 'r_max': 1.0, 'rule': 'trapezoid', 'sigma': 0.0, 'seed': None, 'tol': 1.0e-12},\n        # Case E: small cutoff with noise\n        {'delta_r': 0.01, 'r_max': 0.5, 'rule': 'trapezoid', 'sigma': 1.0e-6, 'seed': 24680, 'tol': 1.0e-6},\n    ]\n\n    results = []\n    for case in test_cases:\n        g_kb_estimate = compute_kb_integral(\n            delta_r=case['delta_r'],\n            r_max=case['r_max'],\n            quadrature_rule=case['rule'],\n            sigma=case['sigma'],\n            seed=case['seed']\n        )\n        \n        # Check if the absolute value of the estimate is within the tolerance\n        test_passed = abs(g_kb_estimate) = case['tol']\n        results.append(test_passed)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In practice, correlation functions obtained from simulations are only known up to a finite cutoff distance, $R$. Simply truncating the Kirkwood-Buff integral at this distance can introduce significant errors, as long-range correlations are neglected. This exercise tackles this crucial issue by having you compute $G_{ij}$ for several analytical models of $g_{ij}(r)$ and implement the corresponding analytical \"tail corrections\" to account for the integral from $R$ to infinity , a vital skill for obtaining accurate results from real simulation data.",
            "id": "3419771",
            "problem": "Consider an isotropic, homogeneous fluid mixture in three spatial dimensions. Let the pair radial distribution function between species $i$ and $j$ be denoted $g_{ij}(r)$, defined such that the expected number of $j$-type particles in a spherical shell of radius $r$ and thickness $\\mathrm{d}r$ around a tagged $i$-type particle equals the product of the bulk number density of species $j$, the shell volume, and $g_{ij}(r)$. Starting only from this definition and geometrical facts about spherical shells in three dimensions, derive the expression for the Kirkwood–Buff integral that quantifies the spatial integral of the total correlation function between $i$ and $j$. Then design a numerical estimator, based on a discretized radial grid, to evaluate this integral from a given $g_{ij}(r)$ sampled on a finite interval $[0,R]$. Your estimator must:\n- Be consistent with spherical symmetry in three dimensions.\n- Use a well-posed Riemann sum approximation on a uniform grid of $r$-values with spacing $\\Delta r$.\n- Address the finite cut-off $R$ by either showing that the tail contribution beyond $R$ is negligible, or by adding a mathematically justified tail correction derived from the asymptotic form of $g_{ij}(r)$ for the specific case.\n\nAll radii are in nanometers (nm). Your program must return the Kirkwood–Buff integral in cubic nanometers (nm$^3$) as floating-point numbers.\n\nImplement a program that constructs $g_{ij}(r)$ for each of the following four test cases on the specified grids, applies your numerical estimator (including exact analytic tail corrections where requested), and outputs the results as a single line containing a comma-separated list enclosed in square brackets.\n\nTest suite:\n- Case A (ideal gas reference): $g_{ij}(r) = 1$ for all $r \\in [0,R]$. Grid: $R = 5.0$ nm, $N = 10000$ uniform intervals, so $\\Delta r = R/N$. No tail correction is needed.\n- Case B (purely decaying correlation): $g_{ij}(r) = 1 + A \\exp(-\\alpha r)$ with $A = 0.5$ and $\\alpha = 3.0$ nm$^{-1}$. Grid: $R = 6.0$ nm, $N = 12000$. Add the exact analytic tail correction for $r \\in (R,\\infty)$ implied by this functional form.\n- Case C (hard-core exclusion): $g_{ij}(r) = 0$ for $0 \\le r  r_{0}$ and $g_{ij}(r) = 1$ for $r \\ge r_{0}$ with $r_{0} = 0.3$ nm. Grid: $R = 5.0$ nm, $N = 10000$. No tail correction is needed.\n- Case D (damped oscillatory correlation): $g_{ij}(r) = 1 + A \\exp(-\\alpha r)\\frac{\\sin(\\beta r)}{\\beta r}$ with $A = 0.8$, $\\alpha = 2.0$ nm$^{-1}$, and $\\beta = 5.0$ nm$^{-1}$. At $r=0$, define the value by continuity using the limit of $\\frac{\\sin(\\beta r)}{\\beta r}$ as $r \\to 0$. Grid: $R = 8.0$ nm, $N = 16000$. Add the exact analytic tail correction for $r \\in (R,\\infty)$ implied by this functional form.\n\nNumerical requirements:\n- Use the trapezoidal rule on the uniform grid for the integral over $[0,R]$.\n- For Case B, use the exact analytic value of the tail integral $\\int_{R}^{\\infty} \\left(g_{ij}(r) - 1\\right)$ with the given functional form. For Case D, use the exact analytic value of the tail integral derived from the given damped oscillatory form. In both cases, the tail correction must be derived from elementary calculus and complex-exponential representation and then implemented exactly.\n- Express each final result in nm$^3$ as a floating-point number. You must output six digits after the decimal point.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[resultA,resultB,resultC,resultD]\"), where each result corresponds respectively to Case A, Case B, Case C, and Case D, each rounded to six digits after the decimal point.",
            "solution": "The problem requires the derivation of the Kirkwood-Buff integral (KBI), denoted $G_{ij}$, for an isotropic fluid mixture, and the design of a numerical estimator to compute its value for several test cases. The derivation must start from the definition of the pair radial distribution function, $g_{ij}(r)$.\n\n**1. Definition and Derivation of the Kirkwood-Buff Integral**\n\nThe pair radial distribution function $g_{ij}(r)$ describes the probability of finding a particle of species $j$ at a distance $r$ from a particle of species $i$, relative to a uniform random distribution. For large separations $r \\to \\infty$, particles become uncorrelated, so $g_{ij}(r) \\to 1$.\n\nThe total correlation function, $h_{ij}(r)$, quantifies the deviation from this uncorrelated state and is defined as:\n$$ h_{ij}(r) = g_{ij}(r) - 1 $$\nThis function approaches $0$ as $r \\to \\infty$.\n\nThe Kirkwood-Buff integral, $G_{ij}$, is defined as the spatial integral of the total correlation function over all three-dimensional space:\n$$ G_{ij} = \\int_{\\mathbb{R}^3} h_{ij}(\\mathbf{r}) \\, \\mathrm{d}\\mathbf{r} $$\nFor an isotropic system, the correlation function depends only on the radial distance $r = |\\mathbf{r}|$, so we can write $h_{ij}(\\mathbf{r}) = h_{ij}(r)$. To evaluate the integral, we switch to spherical coordinates, where the volume element is $\\mathrm{d}\\mathbf{r} = r^2 \\sin\\theta \\, \\mathrm{d}r \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$. The integral becomes:\n$$ G_{ij} = \\int_0^\\infty \\int_0^\\pi \\int_0^{2\\pi} h_{ij}(r) \\, r^2 \\sin\\theta \\, \\mathrm{d}\\phi \\, \\mathrm{d}\\theta \\, \\mathrm{d}r $$\nSince $h_{ij}(r)$ and $r^2$ do not depend on the angles $\\theta$ and $\\phi$, the angular integrals can be performed separately:\n$$ \\int_0^{2\\pi} \\mathrm{d}\\phi = 2\\pi $$\n$$ \\int_0^\\pi \\sin\\theta \\, \\mathrm{d}\\theta = [-\\cos\\theta]_0^\\pi = -(-1) - (-1) = 2 $$\nThe product of the angular integrals is $4\\pi$, which is the total solid angle of a sphere. Substituting this back gives the final expression for the Kirkwood-Buff integral in terms of the radial functions:\n$$ G_{ij} = 4\\pi \\int_0^\\infty r^2 h_{ij}(r) \\, \\mathrm{d}r = 4\\pi \\int_0^\\infty r^2 (g_{ij}(r) - 1) \\, \\mathrm{d}r $$\n\n**2. Numerical Estimation Strategy**\n\nThe integral is over an infinite domain $[0, \\infty)$. For numerical evaluation from data sampled over a finite interval $[0, R]$, we decompose the integral into two parts:\n$$ G_{ij} = 4\\pi \\left[ \\int_0^R r^2 (g_{ij}(r) - 1) \\, \\mathrm{d}r + \\int_R^\\infty r^2 (g_{ij}(r) - 1) \\, \\mathrm{d}r \\right] $$\nThe first term, $(G_{ij})_\\text{num}$, is evaluated numerically, while the second term, $(G_{ij})_\\text{tail}$, is the tail correction.\n\nThe numerical part is approximated using the trapezoidal rule on a uniform grid. The interval $[0, R]$ is divided into $N$ subintervals of width $\\Delta r = R/N$. The grid points are $r_k = k \\Delta r$ for $k = 0, 1, \\dots, N$. The integrand is $f(r) = 4\\pi r^2 (g_{ij}(r) - 1)$. The integral is approximated as:\n$$ (G_{ij})_\\text{num} = \\int_0^R f(r) \\, \\mathrm{d}r \\approx \\Delta r \\left( \\frac{f(r_0) + f(r_N)}{2} + \\sum_{k=1}^{N-1} f(r_k) \\right) $$\nSince $r_0 = 0$, and $g_{ij}(0)$ is finite, the integrand $f(0) = 4\\pi (0)^2 (g_{ij}(0) - 1) = 0$.\n\nThe tail correction $(G_{ij})_\\text{tail}$ must be evaluated analytically based on the asymptotic form of $g_{ij}(r)$ for $r  R$.\n\n**3. Analysis of Test Cases**\n\n**Case A (Ideal Gas):**\n$g_{ij}(r) = 1$ for all $r$. This implies $h_{ij}(r) = g_{ij}(r) - 1 = 0$ for all $r$.\nTherefore, the integral is identically zero:\n$$ G_{ij} = 4\\pi \\int_0^\\infty r^2 (0) \\, \\mathrm{d}r = 0 \\, \\text{nm}^3 $$\nNo numerical calculation is needed, but a correct implementation must yield $0$.\n\n**Case B (Purely Decaying Correlation):**\n$g_{ij}(r) = 1 + A \\exp(-\\alpha r)$, with $A = 0.5$ and $\\alpha = 3.0 \\, \\text{nm}^{-1}$.\n$h_{ij}(r) = A \\exp(-\\alpha r)$. The numerical part is computed using the trapezoidal rule for the integral of $4\\pi r^2 A \\exp(-\\alpha r)$ from $r=0$ to $r=R=6.0 \\, \\text{nm}$.\nThe tail correction is:\n$$ (G_{ij})_\\text{tail} = 4\\pi A \\int_R^\\infty r^2 \\exp(-\\alpha r) \\, \\mathrm{d}r $$\nThis integral can be solved by repeated integration by parts, yielding:\n$$ \\int_R^\\infty r^2 e^{-\\alpha r} \\mathrm{d}r = \\left[ -e^{-\\alpha r} \\left( \\frac{r^2}{\\alpha} + \\frac{2r}{\\alpha^2} + \\frac{2}{\\alpha^3} \\right) \\right]_R^\\infty = e^{-\\alpha R} \\left( \\frac{R^2}{\\alpha} + \\frac{2R}{\\alpha^2} + \\frac{2}{\\alpha^3} \\right) $$\nThus, the tail contribution is:\n$$ (G_{ij})_\\text{tail} = 4\\pi A e^{-\\alpha R} \\left( \\frac{R^2}{\\alpha} + \\frac{2R}{\\alpha^2} + \\frac{2}{\\alpha^3} \\right) $$\n\n**Case C (Hard-Core Exclusion):**\n$g_{ij}(r) = 0$ for $r  r_0 = 0.3 \\, \\text{nm}$ and $g_{ij}(r) = 1$ for $r \\ge r_0$.\n$h_{ij}(r) = -1$ for $r  r_0$ and $h_{ij}(r) = 0$ for $r \\ge r_0$.\nSince the cutoff for the numerical grid is $R = 5.0 \\, \\text{nm}  r_0$, the correlation function $h_{ij}(r)$ is identically zero for $r  R$. Therefore, the tail correction is zero. The exact value of the integral is:\n$$ G_{ij} = 4\\pi \\int_0^{r_0} r^2 (-1) \\, \\mathrm{d}r = -4\\pi \\left[ \\frac{r^3}{3} \\right]_0^{r_0} = -\\frac{4}{3}\\pi r_0^3 $$\nFor $r_0 = 0.3 \\, \\text{nm}$, $G_{ij} = -\\frac{4}{3}\\pi (0.3)^3 = -0.036\\pi \\approx -0.113097 \\, \\text{nm}^3$. The numerical method should accurately approximate this value.\n\n**Case D (Damped Oscillatory Correlation):**\n$g_{ij}(r) = 1 + A \\exp(-\\alpha r)\\,\\frac{\\sin(\\beta r)}{\\beta r}$, with $A = 0.8$, $\\alpha = 2.0 \\, \\text{nm}^{-1}$, $\\beta = 5.0 \\, \\text{nm}^{-1}$.\n$h_{ij}(r) = A \\exp(-\\alpha r)\\,\\frac{\\sin(\\beta r)}{\\beta r}$. The numerical part is computed for the integrand $f(r) = 4\\pi r^2 h_{ij}(r) = \\frac{4\\pi A}{\\beta} r \\sin(\\beta r) \\exp(-\\alpha r)$ from $r=0$ to $r=R=8.0 \\, \\text{nm}$.\nAt $r=0$, the value is defined by continuity: $\\lim_{r\\to 0} \\frac{\\sin(\\beta r)}{\\beta r} = 1$, so $g_{ij}(0) = 1+A$. The integrand $f(0)$ is $0$.\nThe tail correction is:\n$$ (G_{ij})_\\text{tail} = \\int_R^\\infty \\frac{4\\pi A}{\\beta} r \\sin(\\beta r) \\exp(-\\alpha r) \\, \\mathrm{d}r $$\nThis integral is evaluated using complex exponentials. Let $\\sin(\\beta r) = \\text{Im}(e^{i\\beta r})$. We need to compute $\\text{Im} \\left[ \\int_R^\\infty r e^{-(\\alpha-i\\beta)r} \\, \\mathrm{d}r \\right]$. The primitive is $\\int r e^{-\\gamma r} \\mathrm{d}r = -e^{-\\gamma r}(\\frac{r}{\\gamma} + \\frac{1}{\\gamma^2})$.\nThe definite integral from $R$ to $\\infty$ is $e^{-\\gamma R}(\\frac{R}{\\gamma} + \\frac{1}{\\gamma^2})$.\nTaking the imaginary part of the result with $\\gamma = \\alpha - i\\beta$ leads to the following expression for the integral part:\n$$ \\int_R^\\infty r e^{-\\alpha r} \\sin(\\beta r) \\mathrm{d}r = \\frac{e^{-\\alpha R}}{(\\alpha^2+\\beta^2)^2} \\left[ (R\\alpha(\\alpha^2+\\beta^2) + \\alpha^2-\\beta^2)\\sin(\\beta R) + (R\\beta(\\alpha^2+\\beta^2) + 2\\alpha\\beta)\\cos(\\beta R) \\right] $$\nThe total tail contribution is $(G_{ij})_\\text{tail} = \\frac{4\\pi A}{\\beta}$ times this expression.\nThe final $G_{ij}$ is the sum of the numerical integral over $[0, R]$ and this analytical tail correction.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Kirkwood-Buff integral for four test cases\n    using numerical integration and analytical tail corrections.\n    \"\"\"\n\n    test_cases = [\n        {'case': 'A', 'R': 5.0, 'N': 10000},\n        {'case': 'B', 'R': 6.0, 'N': 12000, 'A': 0.5, 'alpha': 3.0},\n        {'case': 'C', 'R': 5.0, 'N': 10000, 'r0': 0.3},\n        {'case': 'D', 'R': 8.0, 'N': 16000, 'A': 0.8, 'alpha': 2.0, 'beta': 5.0},\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        case = params['case']\n        R = params['R']\n        N = params['N']\n\n        r_grid = np.linspace(0, R, N + 1)\n        g_ij = np.zeros_like(r_grid)\n\n        tail_correction = 0.0\n\n        if case == 'A':\n            # g_ij(r) = 1, so h_ij(r) = 0 everywhere.\n            g_ij.fill(1.0)\n            \n        elif case == 'B':\n            A = params['A']\n            alpha = params['alpha']\n            \n            g_ij = 1.0 + A * np.exp(-alpha * r_grid)\n\n            # Analytical tail correction for G_ij = 4*pi*Integral[r^2*A*exp(-alpha*r), {r, R, inf}]\n            # Integral part is exp(-alpha*R) * (R^2/alpha + 2*R/alpha^2 + 2/alpha^3)\n            exp_term = np.exp(-alpha * R)\n            poly_term = (R**2 / alpha) + (2 * R / alpha**2) + (2 / alpha**3)\n            tail_correction = 4.0 * np.pi * A * exp_term * poly_term\n\n        elif case == 'C':\n            r0 = params['r0']\n            g_ij = np.where(r_grid  r0, 0.0, 1.0)\n            # No tail correction needed as h_ij(r) = 0 for r = r0, and R  r0.\n            \n        elif case == 'D':\n            A = params['A']\n            alpha = params['alpha']\n            beta = params['beta']\n            \n            # handle r=0 by continuity, where sin(beta*r)/(beta*r) - 1\n            g_ij[0] = 1.0 + A\n            # for r  0\n            r_positive = r_grid[1:]\n            g_ij[1:] = 1.0 + A * np.exp(-alpha * r_positive) * np.sin(beta * r_positive) / (beta * r_positive)\n\n            # Analytical tail correction for G_ij = Integral[4*pi*r^2 * h_ij(r), {r, R, inf}]\n            # h_ij(r) = A * exp(-alpha*r) * sin(beta*r)/(beta*r)\n            # Integrand for tail is (4*pi*A/beta) * r * exp(-alpha*r) * sin(beta*r)\n            exp_R = np.exp(-alpha * R)\n            sin_R = np.sin(beta * R)\n            cos_R = np.cos(beta * R)\n            alpha2_beta2 = alpha**2 + beta**2\n            \n            term1_sin = (R * alpha * alpha2_beta2 + alpha**2 - beta**2) * sin_R\n            term2_cos = (R * beta * alpha2_beta2 + 2 * alpha * beta) * cos_R\n            \n            integral_part = exp_R * (term1_sin + term2_cos) / (alpha2_beta2**2)\n            \n            tail_correction = (4.0 * np.pi * A / beta) * integral_part\n\n        # Integrand for the numerical part\n        h_ij = g_ij - 1.0\n        integrand = 4.0 * np.pi * r_grid**2 * h_ij\n        \n        # Numerical integration using the trapezoidal rule\n        numerical_integral = np.trapz(integrand, r_grid)\n\n        total_g_ij = numerical_integral + tail_correction\n        results.append(f\"{total_g_ij:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The power of Kirkwood-Buff theory lies in its deep connections to multiple facets of statistical mechanics. This advanced practice explores a powerful alternative route to determining $G_{ij}$ that bypasses the calculation of $g_{ij}(r)$ altogether. You will learn to extract these integrals directly from particle number fluctuations in subvolumes, demonstrating the profound link between local solution structure and macroscopic thermodynamic properties .",
            "id": "3419775",
            "problem": "You are given subvolume number fluctuation data for homogeneous, isotropic solutions simulated in a large periodic box. The goal is to estimate the Kirkwood–Buff integrals, which quantify the integrals of pair correlation deviations from unity, directly from number fluctuations without computing pair correlation functions. Your task is to start from fundamental statistical mechanical definitions and thermodynamic relations to derive an algorithm that estimates the matrix of Kirkwood–Buff integrals from measured particle-number covariances in embedded subvolumes.\n\nAssume the following foundational base:\n- The microscopic number of species $i$ in a spatial subvolume of volume $V$ is $N_i$, with number fluctuation $\\Delta N_i = N_i - \\langle N_i \\rangle$ and covariance $\\langle \\Delta N_i \\Delta N_j \\rangle$.\n- For a homogeneous fluid, the pair correlation function $g_{ij}(r)$ relates to the total correlation function $h_{ij}(r)$ by $h_{ij}(r) = g_{ij}(r) - 1$.\n- The Kirkwood–Buff integral $G_{ij}$ is defined as $G_{ij} = \\int_{\\mathbb{R}^3} h_{ij}(r) \\, d\\mathbf{r}$ in the thermodynamic limit, under conditions ensuring absolute integrability.\n- For a sufficiently large subvolume with characteristic length $L$ (so that $V = L^3$ for a cube), the dominant finite-size corrections to volume-averaged two-point integrals scale as surface-to-volume, that is as $\\mathcal{O}(L^{-1})$.\n\nFrom these bases, reason to a computable estimator that uses measured $\\langle \\Delta N_i \\Delta N_j \\rangle$ in cubic subvolumes of different linear sizes $L$ embedded within a much larger simulation, together with known bulk number densities $\\rho_i$, to infer the Kirkwood–Buff integrals. The estimator must:\n- Use only the given number fluctuation matrices and subvolume sizes.\n- Account for leading finite-size effects by modeling the per-volume covariance as an affine function of $L^{-1}$ and extrapolating to $L \\to \\infty$.\n- Then, use the thermodynamic-limit relation between per-volume covariances, densities, and Kirkwood–Buff integrals to infer $G_{ij}$.\n\nPhysical units:\n- Lengths $L$ are given in $\\mathrm{nm}$, volumes $V$ are thus in $\\mathrm{nm}^3$, densities $\\rho_i$ are in $\\mathrm{nm}^{-3}$, and covariances $\\langle \\Delta N_i \\Delta N_j \\rangle$ are dimensionless counts. The Kirkwood–Buff integrals $G_{ij}$ must be reported in $\\mathrm{nm}^3$.\n\nAngle units do not arise. All outputs must be numerical, in the specified units.\n\nProgram input is fixed by this problem; your program must use the provided test suite embedded in code. Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each number rounded to six decimal places. The list must be the concatenation, over the test cases in the order given, of the row-major flattened $G_{ij}$ matrices for each test.\n\nTest suite:\n- Test case 1 (binary solution, general case):\n  - Species count $m = 2$.\n  - Densities $\\boldsymbol{\\rho} = [0.8, 0.6] \\, \\mathrm{nm}^{-3}$.\n  - Subvolume linear sizes $L \\in \\{5, 6, 8\\} \\, \\mathrm{nm}$, with $V = L^3$.\n  - Measured covariance matrices $\\langle \\Delta \\mathbf{N} \\Delta \\mathbf{N}^\\top \\rangle$ for each $L$:\n    - For $L=5 \\mathrm{nm}$, matrix [[147.5, -8.5], [-8.5, 89.0]].\n    - For $L=6 \\mathrm{nm}$, matrix [[252.72, -13.968], [-13.968, 152.352]].\n    - For $L=8 \\mathrm{nm}$, matrix [[592.64, -30.976], [-30.976, 356.864]].\n- Test case 2 (single-component, near-ideal boundary case):\n  - Species count $m = 1$.\n  - Density $\\boldsymbol{\\rho} = [1.0] \\, \\mathrm{nm}^{-3}$.\n  - Subvolume linear sizes $L \\in \\{4, 7\\} \\, \\mathrm{nm}$, with $V = L^3$.\n  - Measured covariance matrices:\n    - For $L=4 \\mathrm{nm}$, matrix [[68.0]].\n    - For $L=7 \\mathrm{nm}$, matrix [[355.25]].\n- Test case 3 (binary solution with vanishing cross Kirkwood–Buff as an edge feature):\n  - Species count $m = 2$.\n  - Densities $\\boldsymbol{\\rho} = [0.5, 1.2] \\, \\mathrm{nm}^{-3}$.\n  - Subvolume linear sizes $L \\in \\{6, 9, 12\\} \\, \\mathrm{nm}$.\n  - Measured covariance matrices:\n    - For $L=6 \\mathrm{nm}$, matrix [[118.8, 1.8], [1.8, 387.216]].\n    - For $L=9 \\mathrm{nm}$, matrix [[394.875, 4.05], [4.05, 1302.804]].\n    - For $L=12 \\mathrm{nm}$, matrix [[928.8, 7.2], [7.2, 3083.328]].\n\nQuantifiable answer requirements:\n- For each test case, output the row-major flattened list of the estimated $G_{ij}$ in $\\mathrm{nm}^3$, each as a float rounded to six decimal places.\n- Aggregate the results over the three test cases by concatenation into one flat list, printed on a single line as a comma-separated list enclosed in square brackets, for example `[...]`.\n\nYour program must be a complete, runnable program that performs these computations without any external input.",
            "solution": "The problem of estimating Kirkwood–Buff integrals, denoted $G_{ij}$, from particle number fluctuations in subvolumes is a classic topic in the statistical mechanics of solutions. The solution requires establishing a quantitative link between the covariance of particle numbers, $\\langle \\Delta N_i \\Delta N_j \\rangle$, in a subvolume of volume $V$, and the integrals $G_{ij}$, which are defined in the thermodynamic limit.\n\nWe begin with the fundamental expression for number fluctuations in a grand canonical ensemble, which is applicable to an open subvolume $V$ embedded within a much larger system. The covariance between the number of particles of species $i$, $N_i$, and species $j$, $N_j$, is given by:\n$$\n\\langle \\Delta N_i \\Delta N_j \\rangle = \\langle (N_i - \\langle N_i \\rangle)(N_j - \\langle N_j \\rangle) \\rangle = \\delta_{ij} \\langle N_i \\rangle + \\frac{\\langle N_i \\rangle \\langle N_j \\rangle}{V^2} \\int_V \\int_V \\left( g_{ij}(\\mathbf{r}_1, \\mathbf{r}_2) - 1 \\right) d\\mathbf{r}_1 d\\mathbf{r}_2\n$$\nwhere $\\delta_{ij}$ is the Kronecker delta, $\\langle N_i \\rangle$ is the average number of particles of species $i$ in the subvolume $V$, and $g_{ij}$ is the pair correlation function. For a homogeneous and isotropic fluid, $g_{ij}(\\mathbf{r}_1, \\mathbf{r}_2)$ depends only on the distance $r = |\\mathbf{r}_1 - \\mathbf{r}_2|$, and we can write $g_{ij}(r)$. The total correlation function is defined as $h_{ij}(r) = g_{ij}(r) - 1$. The average number of particles is related to the bulk number density $\\rho_i$ by $\\langle N_i \\rangle = \\rho_i V$. Substituting these into the equation yields:\n$$\n\\langle \\Delta N_i \\Delta N_j \\rangle = \\delta_{ij} \\rho_i V + \\rho_i \\rho_j \\int_V \\int_V h_{ij}(|\\mathbf{r}_1 - \\mathbf{r}_2|) d\\mathbf{r}_1 d\\mathbf{r}_2\n$$\nDividing by the volume $V$ gives the per-volume covariance:\n$$\n\\frac{\\langle \\Delta N_i \\Delta N_j \\rangle}{V} = \\delta_{ij} \\rho_i + \\rho_i \\rho_j \\frac{1}{V} \\int_V \\int_V h_{ij}(|\\mathbf{r}_1 - \\mathbf{r}_2|) d\\mathbf{r}_1 d\\mathbf{r}_2\n$$\nIn the thermodynamic limit, where the subvolume $V$ becomes infinitely large, the double integral term simplifies. The integral $\\int_V \\int_V h_{ij}(|\\mathbf{r}_1 - \\mathbf{r}_2|) d\\mathbf{r}_1 d\\mathbf{r}_2$ becomes $V \\int_{\\mathbb{R}^3} h_{ij}(r) d\\mathbf{r}$, where the second integral is the Kirkwood–Buff integral, $G_{ij} = \\int_{0}^{\\infty} h_{ij}(r) 4\\pi r^2 dr$. Therefore, in the limit $V \\to \\infty$:\n$$\n\\lim_{V \\to \\infty} \\frac{\\langle \\Delta N_i \\Delta N_j \\rangle}{V} = \\delta_{ij} \\rho_i + \\rho_i \\rho_j G_{ij}\n$$\nLet us define the matrix of per-volume covariances in the thermodynamic limit as $A_{ij}(\\infty) = \\lim_{V \\to \\infty} \\frac{\\langle \\Delta N_i \\Delta N_j \\rangle}{V}$. The equation becomes:\n$$\nA_{ij}(\\infty) = \\delta_{ij} \\rho_i + \\rho_i \\rho_j G_{ij}\n$$\nThis equation provides a direct connection between the extrapolated per-volume fluctuations and the Kirkwood–Buff integrals.\n\nFor a finite subvolume, such as a cube of side length $L$ and volume $V = L^3$, the measured per-volume covariance, $A_{ij}(L) = \\frac{\\langle \\Delta N_i \\Delta N_j \\rangle}{L^3}$, deviates from its thermodynamic limit value. The problem states that the leading finite-size correction scales as the surface-to-volume ratio, which is proportional to $L^{-1}$. We can model this behavior with an affine function of $L^{-1}$:\n$$\nA_{ij}(L) = A_{ij}(\\infty) + \\frac{B_{ij}}{L}\n$$\nwhere $B_{ij}$ is a constant that captures the surface effects. This equation suggests a clear algorithmic path to determine $A_{ij}(\\infty)$ from measurements at different subvolume sizes. By calculating $A_{ij}(L_k)$ for a set of different sizes $L_k$, we obtain a set of points $(x_k, y_k) = (1/L_k, A_{ij}(L_k))$. A linear regression on these points yields the slope $B_{ij}$ and, crucially, the y-intercept $A_{ij}(\\infty)$.\n\nThe overall algorithm is as follows:\n1.  For each species pair $(i, j)$ in the $m$-component system, collect the measured number covariances $[\\langle \\Delta N_i \\Delta N_j \\rangle]_k$ for each corresponding cubic subvolume of side length $L_k$.\n2.  For each size $L_k$, calculate the volume $V_k = L_k^3$ and the per-volume covariance $A_{ij}(L_k) = [\\langle \\Delta N_i \\Delta N_j \\rangle]_k / V_k$.\n3.  Perform a linear least-squares fit on the data points $(1/L_k, A_{ij}(L_k))$ to the model $y = mx+c$. The intercept $c$ from this fit is the estimate for $A_{ij}(\\infty)$.\n4.  Repeat this for all pairs $(i, j)$ to construct the full matrix $[A_{ij}(\\infty)]$.\n5.  Finally, rearrange the thermodynamic limit equation to solve for each Kirkwood–Buff integral $G_{ij}$:\n    $$\n    G_{ij} = \\frac{A_{ij}(\\infty) - \\delta_{ij} \\rho_i}{\\rho_i \\rho_j}\n    $$\nThis procedure directly uses the provided fluctuation data and densities to compute the desired $G_{ij}$ matrix, while systematically accounting for the leading finite-size effects via extrapolation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Kirkwood-Buff integrals from number fluctuation data in subvolumes\n    by extrapolating to the thermodynamic limit.\n    \"\"\"\n    test_cases = [\n        {\n            \"m\": 2,\n            \"rho\": np.array([0.8, 0.6]),\n            \"L\": np.array([5.0, 6.0, 8.0]),\n            \"covs\": [\n                np.array([[147.5, -8.5], [-8.5, 89.0]]),\n                np.array([[252.72, -13.968], [-13.968, 152.352]]),\n                np.array([[592.64, -30.976], [-30.976, 356.864]]),\n            ],\n        },\n        {\n            \"m\": 1,\n            \"rho\": np.array([1.0]),\n            \"L\": np.array([4.0, 7.0]),\n            \"covs\": [\n                np.array([[68.0]]),\n                np.array([[355.25]]),\n            ],\n        },\n        {\n            \"m\": 2,\n            \"rho\": np.array([0.5, 1.2]),\n            \"L\": np.array([6.0, 9.0, 12.0]),\n            \"covs\": [\n                np.array([[118.8, 1.8], [1.8, 387.216]]),\n                np.array([[394.875, 4.05], [4.05, 1302.804]]),\n                np.array([[928.8, 7.2], [7.2, 3083.328]]),\n            ],\n        },\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        m = case[\"m\"]\n        rho = case[\"rho\"]\n        L = case[\"L\"]\n        covs = case[\"covs\"]\n\n        # The independent variable for the linear fit is 1/L.\n        x_vals = 1.0 / L\n        \n        # Calculate the extrapolated per-volume covariance matrix A_inf.\n        A_inf_matrix = np.zeros((m, m))\n        \n        for i in range(m):\n            for j in range(m):\n                # Calculate the per-volume covariance for each subvolume size.\n                volumes = L**3\n                y_vals = np.array([covs[k][i, j] / volumes[k] for k in range(len(L))])\n                \n                # Perform a linear fit y = mx + c, where x = 1/L.\n                # The intercept c is the extrapolated value A_ij(infinity).\n                # np.polyfit returns [slope, intercept] for degree 1.\n                fit_params = np.polyfit(x_vals, y_vals, 1)\n                A_inf_matrix[i, j] = fit_params[1]\n\n        # Calculate the Kirkwood-Buff integral matrix G from A_inf.\n        G_matrix = np.zeros((m, m))\n        \n        for i in range(m):\n            for j in range(m):\n                # The Kronecker delta is 1 if i==j, else 0.\n                delta_ij = 1.0 if i == j else 0.0\n                \n                # G_ij = (A_ij(inf) - delta_ij * rho_i) / (rho_i * rho_j)\n                numerator = A_inf_matrix[i, j] - delta_ij * rho[i]\n                denominator = rho[i] * rho[j]\n                \n                G_matrix[i, j] = numerator / denominator\n\n        # Flatten the G matrix in row-major order and add to results.\n        all_results.extend(G_matrix.flatten().tolist())\n\n    # Format the final output as a comma-separated list of floats\n    # rounded to six decimal places, enclosed in square brackets.\n    output_str = f\"[{','.join(f'{val:.6f}' for val in all_results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}