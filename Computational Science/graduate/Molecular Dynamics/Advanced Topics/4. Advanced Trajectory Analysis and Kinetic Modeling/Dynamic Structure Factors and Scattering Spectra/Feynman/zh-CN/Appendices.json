{
    "hands_on_practices": [
        {
            "introduction": "我们的实践始于最基本的问题。我们将从第一性原理出发，推导简单理想气体的动态结构因子。这项练习  提供了一个独特的机会，让您理解计算中的选择（特别是模拟盒子中的边界条件）如何产生人为结果，并影响散射谱计算的准确性，这是任何模拟研究都必须考虑的关键问题。",
            "id": "3408646",
            "problem": "要求您编写一个完整、可运行的程序，以评估边界条件如何改变分子动力学中可及的波矢网格，并因此影响在小波矢模下动态结构因子的估算。您的程序必须从密度涨落和自由粒子运动的第一性原理定义出发，不得依赖问题中陈述的任何快捷公式。必须在三种边界策略之间进行比较：立方盒子中的简单周期性、立方盒子中的扭转平均边界条件，以及非立方长方体盒子中的简单周期性。\n\n您将要编码的推导所基于的基本原理如下。\n\n- 微观密度场为 $ \\rho(\\mathbf{r},t) = \\sum_{j=1}^{N} \\delta(\\mathbf{r} - \\mathbf{r}_j(t)) $。其在波矢 $ \\mathbf{k} $ 处的空间傅里叶变换为 $ \\rho_{\\mathbf{k}}(t) = \\sum_{j=1}^{N} e^{-i \\mathbf{k}\\cdot\\mathbf{r}_j(t)} $。\n- 对于一个由质量为 $ m $、温度为 $ T $、速度服从麦克斯韦-玻尔兹曼分布的无相互作用经典粒子组成的系统，自由粒子运动遵循 $ \\mathbf{r}_j(t) = \\mathbf{r}_j(0) + \\mathbf{v}_j t $，其中 $ \\mathbf{v}_j $ 根据麦克斯韦-玻尔兹曼分布进行分布， $ k_{\\mathrm{B}} $ 是玻尔兹曼常数。假设 $ k_{\\mathrm{B}} = 1 $ (约化单位)。\n- 动态结构因子 $ S(\\mathbf{k},\\omega) $ 是 $ \\rho_{\\mathbf{k}}(t) $ 自相关的经归一化处理的时间傅里叶变换，归一化使得其频率积分等于理想气体的静态结构因子。\n\n在有限的模拟盒子中，允许的波矢 $ \\mathbf{k} $ 取决于边界条件。\n\n- 对于边长为 $ L_x, L_y, L_z $ 的长方体盒子中的周期性边界条件，其分量为 $ k_\\alpha = 2\\pi n_\\alpha / L_\\alpha $，其中整数 $ n_\\alpha \\in \\mathbb{Z} $ 且 $ \\alpha \\in \\{x,y,z\\} $。\n- 对于扭转矢量 $ \\boldsymbol{\\phi} $（其分量在区间 $ [-\\pi,\\pi) $ 内）的扭转边界条件，有 $ k_\\alpha = (2\\pi n_\\alpha + \\phi_\\alpha)/L_\\alpha $。扭转平均边界条件是对一组扭转 $ \\{\\boldsymbol{\\phi}\\} $ 的可观测量进行平均。\n\n您的任务是：\n\n- 从上述基本原理出发，推导在给定模 $ k = \\lVert \\mathbf{k} \\rVert $ 和温度 $ T $ 下，理想气体动态结构因子 $ S(\\mathbf{k},\\omega) $ 的显式表达式。\n- 使用该表达式，通过比较在最接近的可及 $ k $ 处的估算谱与在指定目标模 $ k_{\\mathrm{target}} $ 处的连续目标谱，来量化由于不同边界选择下 $ \\mathbf{k} $ 网格的离散性而引起的 $ S(k,\\omega) $ 估算中的有限尺寸效应。\n\n实现细节和约束：\n\n- 在三维空间中使用约化单位 $ k_{\\mathrm{B}} = 1 $ 进行工作。温度 $ T $ 以能量单位表示，质量 $ m $ 以质量单位表示，长度 $ L_\\alpha $ 以长度单位表示，时间 $ t $ 以时间单位表示。频率 $ \\omega $ 必须以时间单位的倒数表示。\n- 仅关注对模的依赖性。在理想气体的情况下，$ S(\\mathbf{k},\\omega) $ 依赖于 $ k = \\lVert \\mathbf{k} \\rVert $ 而非方向；因此，要选择一个可及的离散波矢来近似给定的 $ k_{\\mathrm{target}} $，应从允许的网格中选择使 $ \\lvert \\lVert \\mathbf{k} \\rVert - k_{\\mathrm{target}} \\rvert $ 最小的 $ \\mathbf{k} $，不包括零矢量。在此问题的所有情况下，您必须在有界范围 $ n_\\alpha \\in \\{-1,0,1\\} $ 内搜索整数三元组 $ (n_x,n_y,n_z) $。\n- 对于扭转平均边界条件，在相同的整数搜索范围内，对一组固定的 $ 27 $ 个扭转 $ \\boldsymbol{\\phi} $（其分量在 $ \\{-\\pi/2, 0, \\pi/2\\} $ 中）上对 $ S(\\mathbf{k},\\omega) $ 进行平均。对于每个扭转，从相应的扭转网格中选择与 $ k_{\\mathrm{target}} $ 在模上最接近的单个 $ \\mathbf{k} $。\n- 定义在精确模 $ k_{\\mathrm{target}} $ 以及与评估案例相同的 $ T $ 和 $ m $ 下的连续理想气体目标谱。使用一个在区间 $ [-\\omega_{\\max}, \\omega_{\\max}] $ 上有 $ N_\\omega = 4001 $ 个均匀间隔点的频率网格，其中 $ \\omega_{\\max} = 6 \\sqrt{T/m}\\, k_{\\mathrm{target}} $。通过计算估算谱与目标谱之间差值平方在此频率网格上的平均值，来计算均方误差。在所选的归一化下，该误差是无量纲的。\n- 您的程序必须实现基于基本假设推导出的理想气体 $ S(k,\\omega) $ 的公式，并且不得假设任何适用于相互作用系统的结构因子。\n\n测试套件：\n\n您的程序必须计算并打印以下五个参数集的均方误差，并按顺序将它们汇总成一个单一的输出列表。\n\n- 案例 $ 1 $ (周期性立方体，目标值低于最小网格)：边界类型为周期性，$ L_x = L_y = L_z = 10.0 $，$ m = 1.0 $，$ T = 1.0 $，目标模 $ k_{\\mathrm{target}} = \\frac{1}{2} \\frac{2\\pi}{10.0} $。\n- 案例 $ 2 $ (扭转平均立方体，相同目标值)：在指定的 $ 27 $ 个扭转上使用扭转平均边界条件，$ L_x = L_y = L_z = 10.0 $，$ m = 1.0 $，$ T = 1.0 $，目标模 $ k_{\\mathrm{target}} = \\frac{1}{2} \\frac{2\\pi}{10.0} $。\n- 案例 $ 3 $ (周期性非立方长方体，相同目标值)：周期性边界条件，$ L_x = 9.5 $，$ L_y = 11.3 $，$ L_z = 20.0 $，$ m = 1.0 $，$ T = 1.0 $，目标模 $ k_{\\mathrm{target}} = \\frac{1}{2} \\frac{2\\pi}{10.0} $。\n- 案例 $ 4 $ (周期性立方体，目标值在第一个网格壳层上)：周期性边界条件，$ L_x = L_y = L_z = 10.0 $，$ m = 1.0 $，$ T = 1.0 $，目标模 $ k_{\\mathrm{target}} = \\frac{2\\pi}{10.0} $。\n- 案例 $ 5 $ (更高温度下的扭转平均立方体)：在指定的 $ 27 $ 个扭转上使用扭转平均边界条件，$ L_x = L_y = L_z = 10.0 $，$ m = 1.0 $，$ T = 2.0 $，目标模 $ k_{\\mathrm{target}} = \\frac{1}{2} \\frac{2\\pi}{10.0} $。\n\n最终输出格式：\n\n您的程序必须生成单行输出，其中包含按上述顺序列出的五个案例的均方误差，格式为方括号括起来的逗号分隔列表，例如 $ [e_1,e_2,e_3,e_4,e_5] $。每个 $ e_i $ 必须是十进制表示的实数。不应打印任何其他文本。\n\n扭转中使用的角度以弧度为单位。频率如上所述，以时间单位的倒数表示。在理想气体动态结构因子的所选归一化下，所有结果都是无量纲的。程序必须是确定性的，且不应需要任何用户输入或外部文件。使用 Python 语言和数值数组实现所有计算。",
            "solution": "用户提供的问题经评估被确认为科学上合理、定义明确且客观。这是一个计算统计力学中的标准问题，涉及在各种边界条件下计算理想气体的动态结构因子，适合通过计算方法解决。\n\n### 步骤1：理想气体动态结构因子 $S(k, \\omega)$ 的推导\n\n第一步是从提供的基本定义中推导出一个无相互作用的经典粒子系统（理想气体）的动态结构因子 $S(\\mathbf{k}, \\omega)$ 的解析表达式。\n\n微观粒子密度由 $\\rho(\\mathbf{r},t) = \\sum_{j=1}^{N} \\delta(\\mathbf{r} - \\mathbf{r}_j(t))$ 给出，其中 $\\mathbf{r}_j(t)$ 是粒子 $j$ 在时间 $t$ 的位置。其空间傅里叶变换是波矢为 $\\mathbf{k}$ 的微观密度涨落：\n$$ \\rho_{\\mathbf{k}}(t) = \\sum_{j=1}^{N} e^{-i \\mathbf{k}\\cdot\\mathbf{r}_j(t)} $$\n动态结构因子 $S(\\mathbf{k}, \\omega)$ 与中间散射函数 $F(\\mathbf{k}, t)$ 的时间傅里叶变换有关。后者被定义为密度涨落的归一化时间自相关函数：\n$$ F(\\mathbf{k}, t) = \\frac{1}{N} \\langle \\rho_{\\mathbf{k}}(t) \\rho_{-\\mathbf{k}}(0) \\rangle $$\n其中 $\\rho_{-\\mathbf{k}}(0) = \\sum_{l=1}^{N} e^{i \\mathbf{k}\\cdot\\mathbf{r}_l(0)}$，尖括号 $\\langle \\dots \\rangle$ 表示对粒子初始位置和速度的系综平均。\n\n代入 $\\rho_{\\mathbf{k}}(t)$ 和 $\\rho_{-\\mathbf{k}}(0)$ 的表达式：\n$$ F(\\mathbf{k}, t) = \\frac{1}{N} \\left\\langle \\sum_{j=1}^{N} \\sum_{l=1}^{N} e^{-i \\mathbf{k}\\cdot\\mathbf{r}_j(t)} e^{i \\mathbf{k}\\cdot\\mathbf{r}_l(0)} \\right\\rangle $$\n对于理想气体，不同粒子（$j \\neq l$）的位置和速度是不相关的。$j \\neq l$ 的项的平均值包含诸如 $\\langle e^{-i\\mathbf{k}\\cdot\\mathbf{r}_j(t)} \\rangle$ 和 $\\langle e^{i\\mathbf{k}\\cdot\\mathbf{r}_l(0)} \\rangle$ 的因子。对于任何非零波矢 $\\mathbf{k}$，由于粒子位置在体积内均匀随机分布，这些平均值为零。因此，只有 $j=l$ 的项在平均后保留下来：\n$$ F(\\mathbf{k}, t) = \\frac{1}{N} \\left\\langle \\sum_{j=1}^{N} e^{-i \\mathbf{k}\\cdot(\\mathbf{r}_j(t) - \\mathbf{r}_j(0))} \\right\\rangle $$\n由于所有粒子都是相同的，每个粒子 $j$ 的平均值都相同。求和得到 $N$ 个相同的项，这与 $1/N$ 的前置因子相抵消：\n$$ F(\\mathbf{k}, t) = \\langle e^{-i \\mathbf{k}\\cdot(\\mathbf{r}(t) - \\mathbf{r}(0))} \\rangle $$\n自由粒子的运动由 $\\mathbf{r}(t) = \\mathbf{r}(0) + \\mathbf{v}t$ 给出，所以位移就是 $\\mathbf{r}(t) - \\mathbf{r}(0) = \\mathbf{v}t$。中间散射函数变为：\n$$ F(\\mathbf{k}, t) = \\langle e^{-i (\\mathbf{k}\\cdot\\mathbf{v}) t} \\rangle $$\n现在的平均是对速度 $\\mathbf{v}$ 的分布进行的。对于温度为 $T$ 的经典系统，速度遵循麦克斯韦-玻尔兹曼分布。单个速度分量 $v_\\alpha$ 的概率分布是一个高斯函数：$P(v_\\alpha) = \\sqrt{\\frac{m}{2\\pi k_{\\mathrm{B}} T}} \\exp\\left(-\\frac{m v_\\alpha^2}{2 k_{\\mathrm{B}} T}\\right)$。各分量是独立的。平均值可以写成：\n$$ F(\\mathbf{k}, t) = \\left\\langle \\prod_{\\alpha \\in \\{x,y,z\\}} e^{-i k_\\alpha v_\\alpha t} \\right\\rangle = \\prod_{\\alpha \\in \\{x,y,z\\}} \\langle e^{-i k_\\alpha v_\\alpha t} \\rangle $$\n每一项 $\\langle e^{-i k_\\alpha v_\\alpha t} \\rangle$ 是高斯分布的傅里叶变换，结果是另一个高斯函数。进行积分得到：\n$$ \\langle e^{-i k_\\alpha v_\\alpha t} \\rangle = \\exp\\left(-\\frac{k_{\\mathrm{B}} T k_\\alpha^2 t^2}{2m}\\right) $$\n将各分量相乘得到：\n$$ F(\\mathbf{k}, t) = \\exp\\left(-\\frac{k_{\\mathrm{B}} T (k_x^2 + k_y^2 + k_z^2) t^2}{2m}\\right) = \\exp\\left(-\\frac{k_{\\mathrm{B}} T k^2 t^2}{2m}\\right) $$\n其中 $k = \\lVert \\mathbf{k} \\rVert$。该函数仅依赖于 $\\mathbf{k}$ 的模。我们将其表示为 $F(k, t)$。\n\n动态结构因子 $S(k, \\omega)$ 是 $F(k, t)$ 的时间傅里叶变换：\n$$ S(k, \\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} dt \\, F(k, t) e^{i\\omega t} = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} dt \\, \\exp\\left(-\\frac{k_{\\mathrm{B}} T k^2 t^2}{2m}\\right) e^{i\\omega t} $$\n这是另一个高斯积分。计算它得到理想气体动态结构因子的最终表达式。使用 $k_{\\mathrm{B}}=1$ 的约化单位系统：\n$$ S(k, \\omega) = \\sqrt{\\frac{m}{2\\pi T k^2}} \\exp\\left(-\\frac{m \\omega^2}{2 T k^2}\\right) $$\n该表达式是关于频率 $\\omega$ 的高斯函数，其标准差为 $\\sigma_\\omega = k \\sqrt{T/m}$。\n\n### 步骤2：实现策略\n\n程序逻辑旨在量化由于有限尺寸边界条件施加的离散波矢网格而导致的动态结构因子估算误差。\n\n1.  **理想气体谱函数**：根据推导出的公式实现一个函数 `S_k_omega(k, omega, m, T)`。它接受波矢模 $k$、频率数组 $\\omega$、质量 $m$ 和温度 $T$ 来计算谱。\n\n2.  **目标谱**：对于每个测试案例，使用 `S_k_omega` 函数和精确指定的目标波矢模 $k_{\\mathrm{target}}$ 以及案例特定的参数 $m$ 和 $T$ 来计算目标谱 $S_{\\text{target}}(\\omega)$。该谱在均匀频率网格 $\\omega \\in [-\\omega_{\\max}, \\omega_{\\max}]$ 上进行评估，其中 $\\omega_{\\max} = 6 \\sqrt{T/m}\\, k_{\\mathrm{target}}$。\n\n3.  **估算谱**：问题的核心在于计算依赖于边界条件的估算谱 $S_{\\text{est}}(\\omega)$。\n    *   **可及波矢**：允许的波矢 $\\mathbf{k}$ 由盒子尺寸 $(L_x, L_y, L_z)$ 和边界条件规则确定。\n        *   周期性：$k_\\alpha = 2\\pi n_\\alpha / L_\\alpha$，对于整数三元组 $(n_x, n_y, n_z) \\in \\mathbb{Z}^3$。\n        *   扭转：$k_\\alpha = (2\\pi n_\\alpha + \\phi_\\alpha) / L_\\alpha$，对于整数三元组 $(n_x, n_y, n_z)$ 和给定的扭转矢量 $\\boldsymbol{\\phi}$。\n    *   **搜索最接近的 k**：对于每种情景（扭转平均案例中的给定扭转，或周期性案例中的一次），我们遍历范围为 `{-1, 0, 1}` 的整数三元组 $(n_x, n_y, n_z)$。我们计算相应的波矢 $\\mathbf{k}$（不包括 $\\mathbf{k}=\\mathbf{0}$），并找到其模 $k = \\lVert \\mathbf{k} \\rVert$ 最接近 $k_{\\mathrm{target}}$ 的那个。设这个模为 $k_{\\text{est}}$。\n    *   **谱计算**：\n        *   对于**周期性边界条件**，估算谱就是 $S_{\\text{est}}(\\omega) = S(k_{\\text{est}}, \\omega, m, T)$。\n        *   对于**扭转平均边界条件**，对 $27$ 个指定的扭转矢量 $\\boldsymbol{\\phi}$ 中的每一个重复此过程。对于每个扭转，我们找到最接近的可及波矢模 $k_{\\text{twist}, i}$ 并计算其谱 $S_i(\\omega)$。最终的估算谱是所有扭转的平均值：$S_{\\text{est}}(\\omega) = \\frac{1}{27} \\sum_{i=1}^{27} S(k_{\\text{twist}, i}, \\omega, m, T)$。\n\n4.  **误差计算**：有限尺寸效应通过估算谱和目标谱之间的均方误差 (MSE) 来量化，该误差在离散频率网格上取平均：\n    $$ \\text{MSE} = \\frac{1}{N_\\omega} \\sum_{j=1}^{N_\\omega} \\left( S_{\\text{est}}(\\omega_j) - S_{\\text{target}}(\\omega_j) \\right)^2 $$\n\n此过程应用于五个测试案例中的每一个，收集并打印所得的 MSE 值。案例1和4突显了周期性网格的离散性。案例2显示了扭转平均如何通过提供更密集的有效波矢集来显著减少误差。案例3演示了非立方盒子如何可能偶然地拥有一个非常接近给定目标值的可及波矢。案例5探讨了这些效应的温度依赖性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Computes finite-size errors in dynamic structure factor estimates\n    for an ideal gas under different boundary conditions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: periodic cubic, small target k\n        {'type': 'periodic', 'L': (10.0, 10.0, 10.0), 'm': 1.0, 'T': 1.0, 'k_target': 0.5 * 2.0 * np.pi / 10.0},\n        # Case 2: twist-averaged cubic, small target k\n        {'type': 'twist', 'L': (10.0, 10.0, 10.0), 'm': 1.0, 'T': 1.0, 'k_target': 0.5 * 2.0 * np.pi / 10.0},\n        # Case 3: periodic non-cubic, small target k\n        {'type': 'periodic', 'L': (9.5, 11.3, 20.0), 'm': 1.0, 'T': 1.0, 'k_target': 0.5 * 2.0 * np.pi / 10.0},\n        # Case 4: periodic cubic, target k on grid\n        {'type': 'periodic', 'L': (10.0, 10.0, 10.0), 'm': 1.0, 'T': 1.0, 'k_target': 2.0 * np.pi / 10.0},\n        # Case 5: twist-averaged cubic, higher T\n        {'type': 'twist', 'L': (10.0, 10.0, 10.0), 'm': 1.0, 'T': 2.0, 'k_target': 0.5 * 2.0 * np.pi / 10.0},\n    ]\n\n    results = []\n\n    def S_k_omega(k, omega, m, T):\n        \"\"\"\n        Calculates the ideal-gas dynamic structure factor S(k, omega).\n        \"\"\"\n        # The k=0 case is excluded by the search logic, but this handles it safely.\n        if k  1e-9:\n            return np.zeros_like(omega)\n        \n        prefactor = np.sqrt(m / (2.0 * np.pi * T * k**2))\n        exponent = - (m * omega**2) / (2.0 * T * k**2)\n        return prefactor * np.exp(exponent)\n\n    # Define the search space for integer vectors n\n    n_range = [-1, 0, 1]\n    n_triplets = list(itertools.product(n_range, repeat=3))\n\n    # Define the set of twist vectors phi\n    phi_vals = [-np.pi / 2.0, 0.0, np.pi / 2.0]\n    twists = list(itertools.product(phi_vals, repeat=3))\n\n    for case in test_cases:\n        bc_type = case['type']\n        Lx, Ly, Lz = case['L']\n        m = case['m']\n        T = case['T']\n        k_target = case['k_target']\n\n        # Define the frequency grid\n        N_omega = 4001\n        omega_max = 6.0 * np.sqrt(T / m) * k_target\n        omega_grid = np.linspace(-omega_max, omega_max, N_omega)\n\n        # Compute the target spectrum\n        S_target = S_k_omega(k_target, omega_grid, m, T)\n\n        S_est = np.zeros_like(omega_grid)\n\n        if bc_type == 'periodic':\n            min_dist = float('inf')\n            k_best = -1.0\n            \n            for nx, ny, nz in n_triplets:\n                if nx == 0 and ny == 0 and nz == 0:\n                    continue\n\n                kx = 2.0 * np.pi * nx / Lx\n                ky = 2.0 * np.pi * ny / Ly\n                kz = 2.0 * np.pi * nz / Lz\n                \n                k = np.sqrt(kx**2 + ky**2 + kz**2)\n                dist = abs(k - k_target)\n\n                if dist  min_dist:\n                    min_dist = dist\n                    k_best = k\n            \n            S_est = S_k_omega(k_best, omega_grid, m, T)\n\n        elif bc_type == 'twist':\n            S_est_sum = np.zeros_like(omega_grid)\n            \n            for phi_x, phi_y, phi_z in twists:\n                min_dist_twist = float('inf')\n                k_best_twist = -1.0\n\n                for nx, ny, nz in n_triplets:\n                    # Exclude the zero vector, which only occurs if n=(0,0,0) and phi=(0,0,0)\n                    if nx == 0 and ny == 0 and nz == 0 and phi_x == 0 and phi_y == 0 and phi_z == 0:\n                        continue\n\n                    kx = (2.0 * np.pi * nx + phi_x) / Lx\n                    ky = (2.0 * np.pi * ny + phi_y) / Ly\n                    kz = (2.0 * np.pi * nz + phi_z) / Lz\n                    \n                    k = np.sqrt(kx**2 + ky**2 + kz**2)\n                    dist = abs(k - k_target)\n\n                    if dist  min_dist_twist:\n                        min_dist_twist = dist\n                        k_best_twist = k\n\n                S_twist = S_k_omega(k_best_twist, omega_grid, m, T)\n                S_est_sum += S_twist\n            \n            S_est = S_est_sum / len(twists)\n\n        # Calculate the Mean Squared Error\n        mse = np.mean((S_est - S_target)**2)\n        results.append(mse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在理论基础上，我们现在转向一个更实际的应用：从散射数据中提取物理性质。这项练习  模拟了一个常见的实验场景，即流体中粒子的运动是扩散性的。您将学习如何对观测到的散射谱进行建模（该谱是真实物理信号与仪器效应的卷积），并利用此模型推断出关键的输运性质——扩散系数 $D$。",
            "id": "3408603",
            "problem": "考虑一种均匀、各向同性的流体，其中粒子的运动是扩散性的。van Hove 关联函数的自部分表示为 $G_{\\mathrm{s}}(\\mathbf{r},t)$，中间散射函数 (ISF) 定义为 $G_{\\mathrm{s}}(\\mathbf{r},t)$ 的空间傅里叶变换，由 $F_{\\mathrm{s}}(\\mathbf{q},t)$ 给出。动态结构因子 (DSF) 是 ISF 的时间傅里叶变换，表示为 $S_{\\mathrm{s}}(\\mathbf{q},\\omega)$。在适用于布朗扩散的长时、小波矢区间，粒子位移分布呈高斯分布，且均方位移随时间线性增长。在实验中，测得的 DSF 会因仪器分辨率而展宽，而仪器分辨率通常在角频率上近似为高斯函数。\n\n从相关函数及其傅里叶关系的基本定义出发，你的任务是推导一个算法，该算法通过对固定波矢大小 $q=\\lvert \\mathbf{q} \\rvert$ 下观测到的散射谱的离散测量来推断扩散系数 $D$。观测谱是真实 DSF 线型与仪器分辨率函数的卷积。你应该假设介质是各向同性的，并且体系由自散射主导。\n\n你编写的程序必须：\n1. 使用物理上合理的参数为三个测试案例构建合成的观测谱，其中每个谱都是真实的扩散 DSF 和高斯仪器分辨率的卷积。卷积结果为福伊特（Voigt）线型。程序必须在均匀的角频率网格上生成观测谱，并包含小的加性高斯噪声以模拟测量瑕疵。\n2. 通过将观测谱拟合到角频率的福伊特线型模型，提取特征洛伦兹半峰半宽，并使用适当的物理关系将此宽度转换为 $D$，从而推断每个测试案例的扩散系数 $D$。\n3. 以米²/秒为单位输出推断出的 $D$ 值，采用六位有效数字的科学记数法表示。\n\n使用以下测试套件。对于每个案例，在以 $0$ 为中心、跨度为 $10(\\sigma + \\Gamma)$ 半宽的均匀角频率网格上构建观测谱，其中 $\\sigma$ 是仪器分辨率的标准差（单位 $\\mathrm{s}^{-1}$），$\\Gamma$ 是真实的洛伦兹半峰半宽（单位 $\\mathrm{s}^{-1}$）。使用 $1025$ 个网格点。在添加噪声之前，真实的观测谱的面积应为单位面积。添加均值为零的高斯噪声，其标准差等于无噪声谱最大值的 $0.02$ 倍。\n\n- 案例 1（分辨率与动力学平衡）：\n  - $q = 1.0\\times 10^{9}\\ \\mathrm{m}^{-1}$\n  - $D_{\\mathrm{true}} = 2.0\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$\n  - $\\sigma = 5.0\\times 10^{8}\\ \\mathrm{s}^{-1}$\n\n- 案例 2（分辨率主导）：\n  - $q = 2.0\\times 10^{8}\\ \\mathrm{m}^{-1}$\n  - $D_{\\mathrm{true}} = 1.0\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$\n  - $\\sigma = 3.0\\times 10^{8}\\ \\mathrm{s}^{-1}$\n\n- 案例 3（动力学主导）：\n  - $q = 3.0\\times 10^{9}\\ \\mathrm{m}^{-1}$\n  - $D_{\\mathrm{true}} = 2.5\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$\n  - $\\sigma = 5.0\\times 10^{9}\\ \\mathrm{s}^{-1}$\n\n在每个案例中，你必须从拟合得到的洛伦兹宽度推断出 $D$（单位 $\\mathrm{m}^{2}/\\mathrm{s}$）并报告结果。不涉及角度，频率必须以 $\\mathrm{s}^{-1}$ 为单位处理。最终输出必须是单行文本，包含三个案例推断出的扩散系数，按所列顺序排列，格式为方括号括起来的逗号分隔列表。每个元素必须以六位有效数字的科学记数法表示，例如 $\\texttt{[1.234567e-09,2.345678e-09,3.456789e-09]}$。",
            "solution": "**问题验证**\n\n**步骤 1：提取已知条件**\n\n- **物理模型**：均匀、各向同性的流体，具有扩散性粒子运动。\n- **相关函数**：\n    - van Hove 关联函数的自部分：$G_{\\mathrm{s}}(\\mathbf{r},t)$。\n    - 中间散射函数 (ISF)：$F_{\\mathrm{s}}(\\mathbf{q},t) = \\mathcal{F}_{\\mathbf{r} \\to \\mathbf{q}}[G_{\\mathrm{s}}(\\mathbf{r},t)]$。\n    - 动态结构因子 (DSF)：$S_{\\mathrm{s}}(\\mathbf{q},\\omega) = \\mathcal{F}_{t \\to \\omega}[F_{\\mathrm{s}}(\\mathbf{q},t)]$。\n- **假设**：\n    - 长时、小波矢范围（布朗扩散）。\n    - 粒子位移分布是高斯分布。\n    - 均方位移随时间线性增长。\n    - 各向同性介质，自散射主导。\n- **测量模型**：\n    - 测得的 DSF 被仪器分辨率展宽。\n    - 观测谱是真实 DSF 和仪器分辨率函数的卷积。\n    - 仪器分辨率函数是角频率 $\\omega$ 的高斯函数。\n- **任务**：\n    1. 从固定波矢大小 $q = \\lvert \\mathbf{q} \\rvert$ 的观测散射谱的离散测量中推断扩散系数 $D$。\n    2. 为三个测试案例构建合成的观测谱。\n    3. 合成谱是扩散 DSF 和高斯仪器分辨率的卷积（即福伊特线型）。\n    4. 在均匀角频率网格上生成谱。\n    5. 添加加性高斯噪声。\n    6. 通过将谱拟合到福伊特线型模型来推断每个案例的 $D$。\n    7. 提取洛伦兹半峰半宽并将其转换为 $D$。\n- **谱生成参数**：\n    - 角频率网格：均匀，中心在 $0$，半宽为 $10(\\sigma + \\Gamma)$，有 $1025$ 个点。\n    - $\\sigma$：仪器分辨率标准差（单位 $\\mathrm{s}^{-1}$）。\n    - $\\Gamma$：真实的洛伦兹半峰半宽（单位 $\\mathrm{s}^{-1}$）。\n    - 归一化：真实的观测谱（无噪声卷积）面积为单位 1。\n    - 噪声：零均值高斯噪声，标准差等于无噪声谱最大值的 $0.02$ 倍。\n- **测试案例**：\n    - 案例 1：$q = 1.0\\times 10^{9}\\ \\mathrm{m}^{-1}$，$D_{\\mathrm{true}} = 2.0\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$，$\\sigma = 5.0\\times 10^{8}\\ \\mathrm{s}^{-1}$。\n    - 案例 2：$q = 2.0\\times 10^{8}\\ \\mathrm{m}^{-1}$，$D_{\\mathrm{true}} = 1.0\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$，$\\sigma = 3.0\\times 10^{8}\\ \\mathrm{s}^{-1}$。\n    - 案例 3：$q = 3.0\\times 10^{9}\\ \\mathrm{m}^{-1}$，$D_{\\mathrm{true}} = 2.5\\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$，$\\sigma = 5.0\\times 10^{9}\\ \\mathrm{s}^{-1}$。\n- **输出格式**：单行 `[D1,D2,D3]`，其中每个 $D$ 的单位为 $\\mathrm{m}^{2}/\\mathrm{s}$，采用六位有效数字的科学记数法。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n根据验证标准对问题陈述进行评估：\n\n1.  **科学或事实的合理性**：该问题在科学上是合理的。关于扩散运动的描述、流体动力学极限下 van Hove 函数自部分 $G_{\\mathrm{s}}(\\mathbf{r}, t)$ 的高斯性质，以及由此导致的中间散射函数 $F_{\\mathrm{s}}(\\mathbf{q}, t)$ 的指数衰减，都是简单液体理论的基石。$G_{\\mathrm{s}}(\\mathbf{r}, t)$、$F_{\\mathrm{s}}(\\mathbf{q}, t)$ 和动态结构因子 $S_{\\mathrm{s}}(\\mathbf{q}, \\omega)$ 之间的傅里叶关系是标准定义。$S_{\\mathrm{s}}(\\mathbf{q}, \\omega)$ 最终呈现的洛伦兹线型及其与高斯分辨率函数卷积形成的福伊特线型，精确地模拟了许多准弹性散射实验（例如中子或 X 射线散射）。\n2.  **非形式化或不相关**：该问题是高度形式化的，并且与分子动力学和实验散射中的动态结构因子主题直接相关。\n3.  **不完整或矛盾的设置**：该问题是自洽的，没有矛盾。所有必要的参数（$q$、$D_{\\mathrm{true}}$、$\\sigma$）、模型（扩散、高斯分辨率）和程序（网格生成、噪声添加、拟合方法）都得到了明确且一致的定义。\n4.  **不切实际或不可行**：提供的波矢 $q$、扩散系数 $D$ 和分辨率 $\\sigma$ 的参数值对于典型的分子液体准弹性中子散射实验是物理上现实的。\n5.  **不适定或结构不良**：该问题是适定的。它描述了如何从已知的正向模型生成合成数据，然后通过标准的非线性最小二乘拟合程序来恢复模型参数。预计会有一个唯一且稳定的解，特别是考虑到从真实模型生成了中等噪声水平的数据。\n6.  **伪深刻、琐碎或同义反复**：该问题是计算物理和数据分析方面的一个实质性练习。它要求理解底层的物理理论，实现数据生成模型，并应用一个标准但非平凡的拟合算法来推断物理参数。它避免了过度简化，并代表了实验数据分析中的一项常见任务。\n7.  **超出科学可验证范围**：该问题完全在科学计算的范畴内，并且可以通过实现所述算法来验证。\n\n**步骤 3：结论与行动**\n\n该问题有效。将提供完整的解决方案。\n\n**基于原理的设计**\n\n任务是从散射谱中推断扩散系数 $D$。这需要一个两阶段的方法：首先，一个正向模型来生成模拟实验的合成数据；其次，一个逆问题来拟合这些数据并提取感兴趣的参数。\n\n理论基础始于对粒子运动的描述。对于简单的菲克扩散，van Hove 关联函数的自部分 $G_{\\mathrm{s}}(\\mathbf{r},t)$（它给出了粒子在时间 $t$ 内位移为 $\\mathbf{r}$ 的概率密度）是一个高斯函数：\n$$\nG_{\\mathrm{s}}(\\mathbf{r},t) = \\frac{1}{(4\\pi D t)^{3/2}} \\exp\\left(-\\frac{r^2}{4Dt}\\right)\n$$\n其中 $D$ 是扩散系数，$r=|\\mathbf{r}|$。\n\n自中间散射函数 $F_{\\mathrm{s}}(\\mathbf{q},t)$ 是 $G_{\\mathrm{s}}(\\mathbf{r},t)$ 的空间傅里叶变换：\n$$\nF_{\\mathrm{s}}(\\mathbf{q},t) = \\int G_{\\mathrm{s}}(\\mathbf{r},t) e^{-i\\mathbf{q}\\cdot\\mathbf{r}} d^3\\mathbf{r} = \\exp(-q^2 Dt)\n$$\n对于 $t \\geq 0$，其中 $q = |\\mathbf{q}|$。该函数描述了在给定波矢 $\\mathbf{q}$ 下密度涨落的弛豫。\n\n自动态结构因子 $S_{\\mathrm{s}}(\\mathbf{q},\\omega)$ 是 $F_{\\mathrm{s}}(\\mathbf{q},t)$ 的时间傅里叶变换。对于一个经典系统，我们使用偶延拓 $F_{\\mathrm{s}}(\\mathbf{q},t) = \\exp(-q^2 D|t|)$，其傅里叶变换得到一个关于角频率 $\\omega$ 的洛伦兹函数：\n$$\nS_{\\mathrm{s}}(\\mathbf{q},\\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} e^{-q^2 D|t|} e^{i\\omega t} dt = \\frac{1}{\\pi} \\frac{Dq^2}{(Dq^2)^2 + \\omega^2} = \\frac{1}{\\pi} \\frac{\\Gamma}{\\Gamma^2 + \\omega^2}\n$$\n这个洛伦兹峰以 $\\omega=0$ 为中心，其半峰半宽 (HWHM) 为 $\\Gamma = Dq^2$。这个关系是分析的基石：通过测量 $\\Gamma$ 并知道 $q$，我们就可以确定 $D$。\n\n实验测量总是会受到仪器展宽的影响。问题规定，观测到的谱 $S_{\\mathrm{obs}}(\\mathbf{q},\\omega)$ 是真实的物理谱 $S_{\\mathrm{s}}(\\mathbf{q},\\omega)$ 与一个高斯仪器分辨率函数 $R(\\omega)$ 的卷积，该函数的标准差为 $\\sigma$：\n$$\nR(\\omega) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\omega^2}{2\\sigma^2}\\right)\n$$\n最终的线型是洛伦兹函数和高斯函数的卷积，这被称为福伊特（Voigt）线型。\n$$\nS_{\\mathrm{obs}}(\\mathbf{q},\\omega) = (S_{\\mathrm{s}}(\\mathbf{q},\\cdot) * R(\\cdot))(\\omega)\n$$\n我们的算法方法利用了这些物理原理。\n\n**步骤 1：合成数据生成**\n对于每个测试案例，我们构建测量的谱 $S_{\\mathrm{observed}}(\\omega)$。\n1.  根据给定的 $q$ 和 $D_{\\mathrm{true}}$，我们计算真实的洛伦兹半峰半宽 $\\Gamma_{\\mathrm{true}} = q^2 D_{\\mathrm{true}}$。\n2.  我们构建一个包含 $1025$ 个点的均匀角频率网格 $\\omega$，中心在 $0$，半宽为 $10(\\sigma + \\Gamma_{\\mathrm{true}})$。\n3.  使用 `scipy.special.voigt_profile` 函数生成无噪声谱 $S_{\\mathrm{noiseless}}(\\omega)$。该函数计算由标准差为 $\\sigma$ 的高斯函数和半峰半宽为 $\\Gamma_{\\mathrm{true}}$ 的洛伦兹函数卷积得到的福伊特线型，并且方便地按要求归一化到单位面积。\n4.  为模拟实验瑕疵，添加零均值高斯噪声。噪声的标准差设为无噪声谱峰值的 $2\\%$，即 $\\sigma_{\\mathrm{noise}} = 0.02 \\times \\max(S_{\\mathrm{noiseless}})$。最终的合成谱是 $S_{\\mathrm{observed}}(\\omega) = S_{\\mathrm{noiseless}}(\\omega) + \\mathcal{N}(0, \\sigma_{\\mathrm{noise}}^2)$。为确保可复现性，每个案例使用固定的随机种子。\n\n**步骤 2：通过拟合进行参数推断**\n我们执行非线性最小二乘拟合，从合成数据中推断福伊特线型的参数。\n1.  定义一个模型函数来表示一个具有四个自由参数的任意福伊特线型：总面积 $A$、中心频率 $\\omega_0$、高斯宽度 $\\sigma_{\\mathrm{fit}}$ 和洛伦兹宽度 $\\Gamma_{\\mathrm{fit}}$。\n$$\n\\text{model}(\\omega; A, \\omega_0, \\sigma_{\\mathrm{fit}}, \\Gamma_{\\mathrm{fit}}) = A \\cdot \\texttt{voigt\\_profile}(\\omega - \\omega_0; \\sigma_{\\mathrm{fit}}, \\Gamma_{\\mathrm{fit}})\n$$\n2.  使用 `scipy.optimize.curve_fit` 函数将此模型拟合到生成的数据对 $(\\omega, S_{\\mathrm{observed}})$。\n3.  为确保稳健快速的收敛，为拟合算法提供高质量的初始猜测值 ($p_0$)：使用真实参数（$A_0=1$, $\\omega_{0,0}=0$, $\\sigma_{\\mathrm{fit},0}=\\sigma$, $\\Gamma_{\\mathrm{fit},0}=\\Gamma_{\\mathrm{true}}$），并通过对含噪数据进行积分来稍微精炼面积的猜测值。\n4.  拟合得到优化后的参数，我们从中提取推断出的洛伦兹半峰半宽 $\\Gamma_{\\mathrm{inferred}}$。\n\n**步骤 3：扩散系数的计算**\n最后，我们反转基本关系 $\\Gamma = Dq^2$ 来计算推断的扩散系数：\n$$\nD_{\\mathrm{inferred}} = \\frac{\\Gamma_{\\mathrm{inferred}}}{q^2}\n$$\n对所有三个测试案例重复此计算，并按规定格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import voigt_profile\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Generates synthetic scattering spectra for a diffusive system,\n    then infers the diffusion coefficient by fitting a Voigt profile.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (balanced resolution and dynamics):\n        # q (m^-1), D_true (m^2/s), sigma (s^-1)\n        (1.0e9, 2.0e-9, 5.0e8),\n        # Case 2 (resolution-dominated):\n        (2.0e8, 1.0e-9, 3.0e8),\n        # Case 3 (dynamics-dominated):\n        (3.0e9, 2.5e-9, 5.0e9),\n    ]\n\n    results = []\n\n    def voigt_model(x, A, x0, sig, gam):\n        \"\"\"\n        Voigt profile model for curve fitting.\n        \n        Args:\n            x (np.ndarray): Independent variable (angular frequency).\n            A (float): Total area (amplitude).\n            x0 (float): Center of the profile.\n            sig (float): Standard deviation of the Gaussian component.\n            gam (float): Half-width at half-maximum (HWHM) of the Lorentzian component.\n        \n        Returns:\n            np.ndarray: The Voigt profile evaluated at x.\n        \"\"\"\n        # scipy's voigt_profile is normalized to unit area.\n        # We scale it by the amplitude A.\n        return A * voigt_profile(x - x0, sig, gam)\n\n    for i, case in enumerate(test_cases):\n        q, D_true, sigma = case\n\n        # Use a different seed for each case for independent, reproducible noise.\n        np.random.seed(i)\n\n        # 1. Construct synthetic observed spectrum\n        # Calculate the true Lorentzian HWHM from the diffusion model\n        gamma_true = q**2 * D_true\n        \n        # Define the angular frequency grid\n        omega_half_width = 10.0 * (sigma + gamma_true)\n        num_points = 1025\n        omega = np.linspace(-omega_half_width, omega_half_width, num_points)\n\n        # Generate the noiseless Voigt profile (area is normalized to 1)\n        S_noiseless = voigt_profile(omega, sigma, gamma_true)\n        \n        # Add zero-mean Gaussian noise\n        noise_std = 0.02 * np.max(S_noiseless)\n        noise = np.random.normal(loc=0.0, scale=noise_std, size=num_points)\n        S_observed = S_noiseless + noise\n\n        # 2. Infer diffusion coefficient by fitting\n        # Initial guesses for the fit parameters [A, x0, sigma_fit, gamma_fit]\n        # A_guess is the area under the noisy curve.\n        A_guess = np.trapz(S_observed, omega)\n        p0 = [A_guess, 0.0, sigma, gamma_true]\n\n        # Fit the model to the observed data\n        popt, _ = curve_fit(voigt_model, omega, S_observed, p0=p0)\n        \n        # Extract the fitted Lorentzian HWHM\n        gamma_inferred = popt[3]\n        \n        # Infer the diffusion coefficient D using the fundamental relation\n        D_inferred = gamma_inferred / q**2\n        results.append(D_inferred)\n\n    # Final print statement in the exact required format.\n    # Format each result to scientific notation with 6 significant figures.\n    formatted_results = [f\"{res:.5e}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "我们的探索最终将深入到复杂系统的动力学，特别是二元混合物。这项高级实践  探讨了偏结构因子和集体扩散的领域，模拟了不同物种如何协同运动以及相对运动。您还将研究如何设计同位素标记等实验技术，以选择性地探测这些复杂动力学的不同方面，从而将复杂的理论与实验设计直接联系起来。",
            "id": "3408594",
            "problem": "考虑一个由两种组分（标记为 $\\alpha \\in \\{A,B\\}$ 和 $\\beta \\in \\{A,B\\}$）组成的二元混合物，在流体动力学扩散适用的长波长下进行分子动力学模拟。数密度涨落 $\\delta \\rho_{\\alpha}(\\mathbf{r},t)$ 遵循守恒定律和 Fick 型本构关系。在波矢大小为 $k$ 的傅里叶空间中，偏密度矢量 $\\boldsymbol{\\delta \\rho}(k,t)$ 的线性化动力学可以用一个扩散矩阵来建模，从而导致模式的指数弛豫。定义中间散射函数矩阵 $F_{\\alpha\\beta}(k,t) = \\langle \\delta \\rho_{\\alpha}(k,t)\\,\\delta \\rho_{\\beta}(-k,0) \\rangle$ 和相应的动态结构因子矩阵 $S_{\\alpha\\beta}(k,\\omega)$ 为 $F_{\\alpha\\beta}(k,t)$ 的时间傅里叶变换，其中 $\\omega$ 是角频率。对于所有组分和小 $k$ 值，热力学静态偏结构矩阵 $S_{\\alpha\\beta}(k)$ 是对称正定的。在流体动力学扩散极限下，集体密度涨落根据一个带有对称正定集体扩散矩阵 $D_{\\alpha\\beta}$ 的线性矩阵扩散方程进行弛豫，而单粒子自涨落则以特定于组分的自扩散系数 $D_{s,\\alpha}$ 进行弛豫。\n\n相干散射强度是由不同粒子和组分之间的密度涨落干涉产生的，对于固定 $k$ 和 $\\omega$ 的单色散射，测量的相干强度 $I_{\\text{coh}}(k,\\omega)$ 可以建模为动态结构因子矩阵的加权和：\n$$\nI_{\\text{coh}}(k,\\omega) = \\sum_{\\alpha,\\beta} b_{\\alpha}\\,b_{\\beta}\\,S_{\\alpha\\beta}(k,\\omega),\n$$\n其中 $b_{\\alpha}$ 是组分 $\\alpha$ 的相干散射长度。非相干散射强度 $I_{\\text{inc}}(k,\\omega)$ 源于单粒子自相关，可以使用按组分分辨的自部分动态结构因子 $S^{(s)}_{\\alpha}(k,\\omega)$ 来建模：\n$$\nI_{\\text{inc}}(k,\\omega) = \\sum_{\\alpha} \\sigma_{\\alpha}\\,S^{(s)}_{\\alpha}(k,\\omega),\n$$\n其中 $\\sigma_{\\alpha}$ 是组分 $\\alpha$ 的非相干散射截面权重。在长波长扩散区，自部分动态结构因子可以很好地用洛伦兹函数近似：$S^{(s)}_{\\alpha}(k,\\omega) = \\frac{1}{\\pi}\\,\\frac{D_{s,\\alpha}\\,k^2}{\\omega^2 + \\left(D_{s,\\alpha}\\,k^2\\right)^2}$。\n\n您的任务是构建一个程序，对于一组给定的组分和扩散区内的物理参数，在固定的 $k$ 和 $\\omega$ 下，为每个测试用例计算以下内容：\n1. 使用基于对称正定扩散矩阵 $D_{\\alpha\\beta}$ 和对称正定静态结构矩阵 $S_{\\alpha\\beta}(k)$ 的扩散集体模型，通过线性弛豫算子的豫解算子，计算总相干强度 $I_{\\text{coh}}(k,\\omega)$。\n2. 使用特定于组分的自扩散系数 $D_{s,\\alpha}$ 和洛伦兹自部分动态结构因子，计算总非相干强度 $I_{\\text{inc}}(k,\\omega)$。\n3. 对一个提议的同位素标记方案是否通过使 $I_{\\text{inc}}(k,\\omega)$ 远小于 $I_{\\text{coh}}(k,\\omega)$ 或反之，从而实现相干和非相干贡献的有效分离，做出二元决策。这种分离由阈值比率 $T$ 来量化。\n4. 通过比较最慢的集体弛豫速率（$k^2 D$ 的最小特征值）与自弛豫速率中较快者（$k^2 D_{s,\\alpha}$），评估集体扩散与自扩散，以确定在该组分下集体扩散是否比最快的自扩散慢。\n\n基本和建模假设：\n- 数密度守恒和线性本构关系意味着 $\\boldsymbol{\\delta \\rho}(k,t)$ 的小振幅傅里葉模式遵循 $\\partial_t \\boldsymbol{\\delta \\rho}(k,t) = -k^2\\,D\\,\\boldsymbol{\\delta \\rho}(k,t)$，其中 $D$ 是一个元素为 $D_{\\alpha\\beta}$ 的对称正定 $2 \\times 2$ 矩阵，而 $k$ 是一个标量。\n- 集体涨落的中间散射函数矩阵满足 $F(k,t) = \\exp\\!\\left(-k^2 D t\\right)\\,S(k)$（对于 $t \\ge 0$），其中 $S(k)$ 是波矢大小为 $k$ 时的静态偏结构因子矩阵。\n- 频率为 $\\omega$ 的动态结构因子矩阵通过对 $F(k,t)$ 进行时间傅里叶变换获得，从而得到豫解算子表示 $S(k,\\omega) = \\frac{1}{\\pi}\\,\\Re\\!\\left[\\left(i\\omega I + k^2 D\\right)^{-1}\\,S(k)\\right]$，其中 $I$ 是单位矩阵，$\\Re$ 表示实部。\n- 在扩散区，组分 $\\alpha$ 的自部分动态结构因子为 $S^{(s)}_{\\alpha}(k,\\omega) = \\frac{1}{\\pi}\\,\\frac{D_{s,\\alpha}\\,k^2}{\\omega^2 + \\left(D_{s,\\alpha}\\,k^2\\right)^2}$。\n\n使用以下固定的物理参数（这些参数在科学上是合理的且内部一致）：\n- 波矢大小：$k = 1.0 \\times 10^{10}\\ \\text{m}^{-1}$。\n- 角频率：$\\omega = 5.0 \\times 10^{10}\\ \\text{s}^{-1}$。\n- 有效分离的阈值比率：$T = 0.10$（无量纲）。\n- 纯组分中的基线自扩散系数：$D_{s,A}^{0} = 2.0 \\times 10^{-9}\\ \\text{m}^2/\\text{s}$ 和 $D_{s,B}^{0} = 1.0 \\times 10^{-9}\\ \\text{m}^2/\\text{s}$。\n- 自扩散的组分依赖性：$D_{s,A}(x_A) = D_{s,A}^{0}\\,\\left(1 - 0.50\\,x_B\\right)$ 和 $D_{s,B}(x_A) = D_{s,B}^{0}\\,\\left(1 - 0.30\\,x_A\\right)$，其中 $x_A$ 是组分 A 的摩尔分数，$x_B = 1 - x_A$。\n- 集体扩散矩阵元作为组分的函数：\n  $$\n  D_{AA}(x_A) = D_{s,A}(x_A)\\,\\left(1 + \\eta\\,x_B\\right),\\quad\n  D_{BB}(x_A) = D_{s,B}(x_A)\\,\\left(1 + \\eta\\,x_A\\right),\\quad\n  D_{AB}(x_A) = \\left(0.05 + 0.30\\,x_A x_B\\right)\\,\\sqrt{D_{s,A}(x_A)\\,D_{s,B}(x_A)},\n  $$\n  其中 $\\eta = 0.20$ 且 $D$ 是对称的，$D_{BA} = D_{AB}$。\n- 小 $k$ 值下的静态偏结构因子矩阵元：\n  $$\n  S_{AA}(x_A) = x_A\\,\\left(1 + c_{AA}\\,x_B\\right),\\quad\n  S_{BB}(x_A) = x_B\\,\\left(1 + c_{BB}\\,x_A\\right),\\quad\n  S_{AB}(x_A) = c_{AB}\\,x_A x_B,\n  $$\n  其中 $c_{AA} = 0.30$，$c_{BB} = 0.25$，$c_{AB} = 0.10$ 且 $S$ 是对称的，$S_{BA} = S_{AB}$。\n- 未标记方案的相干散射长度和非相干权重：$b_A = 6.0$（任意长度单位），$b_B = 1.0$，$\\sigma_A = 0.50$（任意强度单位），$\\sigma_B = 4.00$。\n- 标记方案的相干散射长度和非相干权重（该同位素选择旨在减少组分 A 的非相干散射并抑制组分 B 的相干散射）：$b_A^{(\\ell)} = 6.0$, $b_B^{(\\ell)} = 0.01$, $\\sigma_A^{(\\ell)} = 0.01$, $\\sigma_B^{(\\ell)} = 1.00$。\n\n为每个测试用例在固定的 $k$ 和 $\\omega$ 下定义以下输出：\n- $R_{\\text{unlab}} = I_{\\text{inc}}^{\\text{unlabeled}}(k,\\omega)\\,/\\,I_{\\text{coh}}^{\\text{unlabeled}}(k,\\omega)$，一个无量纲浮点数。\n- $R_{\\text{lab}} = I_{\\text{inc}}^{\\text{labeled}}(k,\\omega)\\,/\\,I_{\\text{coh}}^{\\text{labeled}}(k,\\omega)$，一个无量纲浮点数。\n- 一个布尔值 $B_{\\text{sep}}$，指示标记方案是否实现了有效分离，定义为\n  $$\n  B_{\\text{sep}} = \\left(R_{\\text{lab}} \\le T\\right)\\ \\text{or}\\ \\left(R_{\\text{lab}}^{-1} \\le T\\right),\n  $$\n  即在标记下，非相干贡献是否远小于相干贡献，或反之亦然。\n- 一个布尔值 $B_{\\text{coll\\_slower}}$，指示最慢的集体弛豫速率是否小于最快的自弛豫速率，定义为\n  $$\n  B_{\\text{coll\\_slower}} = \\left(k^2\\,\\lambda_{\\min}(D)  k^2\\,\\min\\left(D_{s,A},D_{s,B}\\right)\\right),\n  $$\n  其中 $\\lambda_{\\min}(D)$ 是对称矩阵 $D$ 的最小特征值。\n\n测试套件：\n使用以下组分 A 的组分，其中 $x_A$ 是组分 A 的摩尔分数，$x_B = 1 - x_A$：\n- 用例 1: $x_A = 0.05$。\n- 用例 2: $x_A = 0.20$。\n- 用例 3: $x_A = 0.50$。\n- 用例 4: $x_A = 0.80$。\n- 用例 5: $x_A = 0.95$。\n\n您的程序应为每个用例计算列表 $[B_{\\text{sep}}, B_{\\text{coll\\_slower}}, R_{\\text{unlab}}, R_{\\text{lab}}]$。最终输出必须是单行文本，包含所有用例结果的列表，格式为逗号分隔的用例列表，并用方括号括起，例如 \"[[true,false,0.12,0.03],[...],...]\"。仅使用 Python 布尔值字符串转换产生的 \"true\" 或 \"false\" 小写字母。所有输出均为无量纲数；不应打印或在输出中包含任何物理单位字符串。",
            "solution": "此问题被判定为有效。它在科学上基于液体动态散射理论，问题定义明确且客观。所有必需的参数和函数形式都已提供，使得每个测试用例都有唯一的解。\n\n在布尔值 $B_{\\text{coll\\_slower}}$ 的定义中注意到一个微小的不一致。文本描述“比自弛豫速率中较快者更慢”暗示了与自扩散系数的最大值进行比较，即 $\\max(D_{s,A}, D_{s,B})$。然而，所提供的数学公式指定了与最小值进行比较，即 $\\min(D_{s,A}, D_{s,B})$。本解决方案将严格遵守明确无误的数学公式 $B_{\\text{coll\\_slower}} = (k^2\\,\\lambda_{\\min}(D)  k^2\\,\\min(D_{s,A}, D_{s,B}))$，因为这是唯一严谨的前进路径。\n\n解决方案的步骤是，首先为每个测试用例计算所有依赖于组分的物理性质，然后计算相干和非相干散射强度，最后评估所需的输出量。\n\n所有计算使用的固定物理参数为：\n- 波矢大小：$k = 1.0 \\times 10^{10}\\ \\text{m}^{-1}$。\n- 角频率：$\\omega = 5.0 \\times 10^{10}\\ \\text{s}^{-1}$。\n- 分离阈值：$T = 0.10$。\n\n对于每个由组分 A 的摩尔分数 $x_A$ 指定的测试用例，执行以下步骤：\n\n1.  **计算依赖于组分的性质**\n    组分 B 的摩尔分数为 $x_B = 1 - x_A$。特定于组分的自扩散系数 $D_{s,A}$ 和 $D_{s,B}$ 作为 $x_A$ 的函数计算：\n    $$D_{s,A}(x_A) = D_{s,A}^{0}\\,(1 - 0.50\\,x_B)$$\n    $$D_{s,B}(x_A) = D_{s,B}^{0}\\,(1 - 0.30\\,x_A)$$\n    基线系数为 $D_{s,A}^{0} = 2.0 \\times 10^{-9}\\ \\text{m}^2/\\text{s}$ 和 $D_{s,B}^{0} = 1.0 \\times 10^{-9}\\ \\text{m}^2/\\text{s}$。\n\n    构建 $2 \\times 2$ 对称集体扩散矩阵 $D$ 和静态偏结构因子矩阵 $S(k)$。它们的元素由以下公式给出：\n    $$D_{AA}(x_A) = D_{s,A}(x_A)\\,(1 + 0.20\\,x_B)$$\n    $$D_{BB}(x_A) = D_{s,B}(x_A)\\,(1 + 0.20\\,x_A)$$\n    $$D_{AB}(x_A) = (0.05 + 0.30\\,x_A x_B)\\,\\sqrt{D_{s,A}(x_A)\\,D_{s,B}(x_A)}$$\n    以及\n    $$S_{AA}(x_A) = x_A\\,(1 + 0.30\\,x_B)$$\n    $$S_{BB}(x_A) = x_B\\,(1 + 0.25\\,x_A)$$\n    $$S_{AB}(x_A) = 0.10\\,x_A x_B$$\n    这些矩阵是对称的，所以 $D_{BA} = D_{AB}$ 且 $S_{BA} = S_{AB}$。\n\n2.  **计算非相干散射强度 $I_{\\text{inc}}(k,\\omega)$**\n    非相干强度源于单粒子自相关。对于每个组分 $\\alpha$，扩散区中的自部分动态结构因子 $S^{(s)}_{\\alpha}(k,\\omega)$ 是一个洛伦兹函数：\n    $$S^{(s)}_{\\alpha}(k,\\omega) = \\frac{1}{\\pi}\\,\\frac{D_{s,\\alpha}\\,k^2}{\\omega^2 + \\left(D_{s,\\alpha}\\,k^2\\right)^2}$$\n    总非相干强度是各组分的加权和：\n    $$I_{\\text{inc}}(k,\\omega) = \\sum_{\\alpha} \\sigma_{\\alpha}\\,S^{(s)}_{\\alpha}(k,\\omega) = \\sigma_A S^{(s)}_{A}(k,\\omega) + \\sigma_B S^{(s)}_{B}(k,\\omega)$$\n    此计算执行两次：一次使用权重 $(\\sigma_A, \\sigma_B) = (0.50, 4.00)$ 用于未标记方案，另一次使用 $(\\sigma_A^{(\\ell)}, \\sigma_B^{(\\ell)}) = (0.01, 1.00)$ 用于标记方案。\n\n3.  **计算相干散射强度 $I_{\\text{coh}}(k,\\omega)$**\n    相干强度源于集体密度涨落。它是动态结构因子矩阵元素 $S_{\\alpha\\beta}(k,\\omega)$ 的加权和。用矩阵表示，这是一个二次型：\n    $$I_{\\text{coh}}(k,\\omega) = \\sum_{\\alpha,\\beta} b_{\\alpha}\\,b_{\\beta}\\,S_{\\alpha\\beta}(k,\\omega) = \\mathbf{b}^T S(k,\\omega) \\mathbf{b}$$\n    其中 $\\mathbf{b}$ 是相干散射长度的矢量 $[b_A, b_B]^T$。\n\n    动态结构因子矩阵 $S(k,\\omega)$ 从线性弛豫模型导出。中间散射函数 $F(k,t) = \\exp(-k^2 D t)\\,S(k)$ 的时间傅里叶变换得到豫解算子公式：\n    $$S(k,\\omega) = \\frac{1}{\\pi}\\,\\Re\\!\\left[\\left(i\\omega I + k^2 D\\right)^{-1}\\,S(k)\\right]$$\n    其中 $I$ 是 $2 \\times 2$ 单位矩阵，$\\Re$ 表示逐元素的实部。计算过程包括构建复数矩阵 $M = i\\omega I + k^2 D$，计算其逆矩阵 $M^{-1}$，然后右乘静态结构矩阵 $S(k)$，取结果矩阵的实部，并乘以 $1/\\pi$。\n\n    此过程得到矩阵 $S(k,\\omega)$。随后，使用二次型为未标记方案（$\\mathbf{b}_{\\text{unlab}} = [6.0, 1.0]^T$）和标记方案（$\\mathbf{b}_{\\text{lab}} = [6.0, 0.01]^T$）计算 $I_{\\text{coh}}(k,\\omega)$。\n\n4.  **计算最终输出量**\n    每个测试用例的四个输出值计算如下：\n    - 未标记情况的比率是 $R_{\\text{unlab}} = I_{\\text{inc}}^{\\text{unlabeled}}(k,\\omega) / I_{\\text{coh}}^{\\text{unlabeled}}(k,\\omega)$。\n    - 标记情况的比率是 $R_{\\text{lab}} = I_{\\text{inc}}^{\\text{labeled}}(k,\\omega) / I_{\\text{coh}}^{\\text{labeled}}(k,\\omega)$。\n    - 分离的布尔值 $B_{\\text{sep}}$ 为真，如果标记方案使得一个贡献远小于另一个，由阈值 $T = 0.10$ 定义：\n      $$B_{\\text{sep}} = (R_{\\text{lab}} \\le T) \\text{ or } (R_{\\text{lab}}^{-1} \\le T)$$\n    - 用于比较集体扩散和自扩散的布尔值 $B_{\\text{coll\\_slower}}$ 根据提供的公式进行评估。这涉及到计算对称矩阵 $D$ 的特征值。最小特征值 $\\lambda_{\\min}(D)$ 对应于最慢的集体弛豫速率。比较是：\n      $$B_{\\text{coll\\_slower}} = (\\lambda_{\\min}(D)  \\min(D_{s,A}, D_{s,B}))$$\n      注意，因子 $k^2$ 在问题描述的不等式两边都存在，可以消去，从而简化数值比较。\n    这四个值 $[B_{\\text{sep}}, B_{\\text{coll\\_slower}}, R_{\\text{unlab}}, R_{\\text{lab}}]$ 构成一个测试用例的结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes scattering intensities and related properties for a binary mixture.\n    \"\"\"\n    # Fixed physical parameters\n    k = 1.0e10  # Wavevector magnitude in m^-1\n    omega = 5.0e10  # Angular frequency in s^-1\n    T = 0.10  # Threshold ratio for separation\n\n    # Baseline self-diffusion coefficients in m^2/s\n    DsA0 = 2.0e-9\n    DsB0 = 1.0e-9\n\n    # Composition dependence parameters for D and S matrices\n    eta = 0.20\n    c_AA = 0.30\n    c_BB = 0.25\n    c_AB = 0.10\n\n    # Scattering parameters for unlabeled scheme\n    b_unlab_vec = np.array([6.0, 1.0])\n    sigma_unlab_vec = np.array([0.50, 4.00])\n\n    # Scattering parameters for labeled scheme\n    b_lab_vec = np.array([6.0, 0.01])\n    sigma_lab_vec = np.array([0.01, 1.00])\n\n    # Test suite of mole fractions for species A\n    test_cases_xA = [0.05, 0.20, 0.50, 0.80, 0.95]\n\n    all_results = []\n\n    for xA in test_cases_xA:\n        # Step 1: Calculate composition-dependent properties\n        xB = 1.0 - xA\n\n        DsA = DsA0 * (1.0 - 0.50 * xB)\n        DsB = DsB0 * (1.0 - 0.30 * xA)\n\n        # Construct the collective diffusion matrix D\n        DAA = DsA * (1.0 + eta * xB)\n        DBB = DsB * (1.0 + eta * xA)\n        DAB = (0.05 + 0.30 * xA * xB) * np.sqrt(DsA * DsB)\n        D_matrix = np.array([[DAA, DAB], [DAB, DBB]])\n\n        # Construct the static partial structure factor matrix S\n        SAA = xA * (1.0 + c_AA * xB)\n        SBB = xB * (1.0 + c_BB * xA)\n        SAB = c_AB * xA * xB\n        S_matrix = np.array([[SAA, SAB], [SAB, SBB]])\n\n        # Step 2: Calculate incoherent scattering intensity\n        k_squared = k ** 2\n        omega_squared = omega ** 2\n\n        S_s_A = (1.0 / np.pi) * (DsA * k_squared) / (omega_squared + (DsA * k_squared)**2)\n        S_s_B = (1.0 / np.pi) * (DsB * k_squared) / (omega_squared + (DsB * k_squared)**2)\n        S_s_vec = np.array([S_s_A, S_s_B])\n\n        I_inc_unlab = np.dot(sigma_unlab_vec, S_s_vec)\n        I_inc_lab = np.dot(sigma_lab_vec, S_s_vec)\n\n        # Step 3: Calculate coherent scattering intensity\n        M_matrix = 1j * omega * np.identity(2) + k_squared * D_matrix\n        M_inv_S = np.linalg.inv(M_matrix) @ S_matrix\n        S_kw = (1.0 / np.pi) * np.real(M_inv_S)\n\n        I_coh_unlab = b_unlab_vec.T @ S_kw @ b_unlab_vec\n        I_coh_lab = b_lab_vec.T @ S_kw @ b_lab_vec\n        \n        # Step 4: Compute final output quantities\n        R_unlab = I_inc_unlab / I_coh_unlab if I_coh_unlab != 0 else float('inf')\n        R_lab = I_inc_lab / I_coh_lab if I_coh_lab != 0 else float('inf')\n\n        B_sep = (R_lab = T) or ((1.0 / R_lab) = T if R_lab != 0 else False)\n\n        # Use eigvalsh for symmetric matrices for better performance and stability\n        eigvals_D = np.linalg.eigvalsh(D_matrix)\n        lambda_min_D = np.min(eigvals_D)\n        \n        B_coll_slower = lambda_min_D  min(DsA, DsB)\n        \n        all_results.append([B_sep, B_coll_slower, R_unlab, R_lab])\n\n    # Format the final output string exactly as specified.\n    case_strs = []\n    for res_case in all_results:\n        b_sep, b_coll, r_unlab, r_lab = res_case\n        case_str = f\"[{str(b_sep).lower()},{str(b_coll).lower()},{r_unlab},{r_lab}]\"\n        case_strs.append(case_str)\n    \n    print(f\"[{','.join(case_strs)}]\")\n\nsolve()\n```"
        }
    ]
}