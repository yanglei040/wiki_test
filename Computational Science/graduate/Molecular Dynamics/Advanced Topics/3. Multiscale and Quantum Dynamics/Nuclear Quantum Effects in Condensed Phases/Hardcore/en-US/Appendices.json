{
    "hands_on_practices": [
        {
            "introduction": "The quantum harmonic oscillator is a cornerstone model in physics, providing an exactly solvable framework for understanding vibrations in molecules and crystals. By calculating the thermal expectation values of its kinetic and potential energy, we can analytically derive the key signatures of nuclear quantum effects. This exercise  illuminates the concepts of zero-point energy and thermal suppression, providing a clear, quantitative contrast with the predictions of classical statistical mechanics.",
            "id": "3430050",
            "problem": "Consider a single localized nuclear vibrational mode in a condensed phase modeled as an isotropic three-dimensional quantum harmonic oscillator with mass $m$ and angular frequency $\\omega$. Its Hamiltonian operator is\n$$\n\\hat{H} \\;=\\; \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right].\n$$\nAssume the mode is in thermal equilibrium at temperature $T$ in the canonical ensemble. Starting from the canonical partition function definition $Z \\,=\\, \\mathrm{Tr}\\left[\\exp(-\\beta \\hat{H})\\right]$ with $\\beta \\,=\\, 1/(k_{B} T)$, and using fundamental statistical mechanics and quantum mechanics principles, derive analytic expressions for the thermal expectation values of the kinetic energy $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle$ and the potential energy $\\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ of this mode. Compare these quantum results to the classical equipartition limit and explain how Nuclear Quantum Effects (NQE) manifest as zero-point contributions and thermal suppression at finite temperature, referencing their dependence on $\\omega$ and $T$.\n\nExpress your final answer as the pair $\\big(\\langle \\hat{E}_{\\mathrm{kin}} \\rangle,\\langle \\hat{E}_{\\mathrm{pot}} \\rangle\\big)$ in a single row matrix. Do not evaluate numerically.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It represents a standard, solvable problem in quantum statistical mechanics with no internal contradictions or missing information. We may therefore proceed with the derivation.\n\nThe system is an isotropic three-dimensional quantum harmonic oscillator (QHO). Its Hamiltonian operator $\\hat{H}$ is given by\n$$\n\\hat{H} = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right]\n$$\nThis Hamiltonian is separable, meaning it is a sum of three independent one-dimensional (1D) QHO Hamiltonians, $\\hat{H} = \\hat{H}_x + \\hat{H}_y + \\hat{H}_z$, where $\\hat{H}_{\\alpha} = \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2}$. Due to this independence and the isotropy of the oscillator ($\\omega$ is the same for all three dimensions), the total kinetic and potential energy expectation values are simply three times the respective expectation values for a 1D QHO:\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} \\quad \\text{and} \\quad \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m \\omega^2 \\hat{q}^2 \\right\\rangle_{1D}\n$$\nWe will therefore calculate the thermal expectation values $\\langle \\hat{p}^2 \\rangle_{1D}$ and $\\langle \\hat{q}^2 \\rangle_{1D}$ for a single degree of freedom in the canonical ensemble at inverse temperature $\\beta = 1/(k_B T)$.\n\nFor a 1D QHO, it is convenient to express the position operator $\\hat{q}$ and momentum operator $\\hat{p}$ in terms of the lowering ($\\hat{a}$) and raising ($\\hat{a}^{\\dagger}$) operators:\n$$\n\\hat{q} = \\sqrt{\\frac{\\hbar}{2m\\omega}}(\\hat{a} + \\hat{a}^{\\dagger})\n$$\n$$\n\\hat{p} = i\\sqrt{\\frac{\\hbar m\\omega}{2}}(\\hat{a}^{\\dagger} - \\hat{a})\n$$\nThe Hamiltonian for the 1D QHO can then be written as $\\hat{H}_{1D} = \\hbar\\omega(\\hat{a}^{\\dagger}\\hat{a} + \\frac{1}{2})$, where $\\hat{n} = \\hat{a}^{\\dagger}\\hat{a}$ is the number operator with eigenvalues $n = 0, 1, 2, \\dots$. The thermal average of an operator $\\hat{O}$ is given by $\\langle \\hat{O} \\rangle = \\mathrm{Tr}[\\hat{O} \\exp(-\\beta \\hat{H}_{1D})] / Z_{1D}$, where $Z_{1D} = \\mathrm{Tr}[\\exp(-\\beta \\hat{H}_{1D})]$.\n\nThe thermal average of the number operator, $\\langle \\hat{n} \\rangle$, corresponds to the average occupation number of the oscillator mode, which follows the Bose-Einstein distribution for a single bosonic mode:\n$$\n\\langle \\hat{n} \\rangle = \\frac{1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\n\nNow we compute the expectation values of $\\hat{q}^2$ and $\\hat{p}^2$.\nLet's start with $\\langle \\hat{q}^2 \\rangle_{1D}$:\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a} + \\hat{a}^{\\dagger})^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2)\n$$\nUsing the commutation relation $[\\hat{a}, \\hat{a}^{\\dagger}] = 1$, we have $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$. Substituting this into the expression for $\\hat{q}^2$:\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2) = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger})^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\nWhen taking the thermal average, which is a trace over the energy eigenbasis $|n\\rangle$, the terms $\\hat{a}^2$ and $(\\hat{a}^{\\dagger})^2$ have zero diagonal elements, so their trace is zero. Thus, only the terms with $\\hat{a}^{\\dagger}\\hat{a} = \\hat{n}$ and the constant contribute:\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\langle 2\\hat{n} + 1 \\rangle = \\frac{\\hbar}{m\\omega} \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right)\n$$\nSubstituting the expression for $\\langle \\hat{n} \\rangle$:\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{m\\omega} \\left(\\frac{1}{\\exp(\\beta\\hbar\\omega) - 1} + \\frac{1}{2}\\right) = \\frac{\\hbar}{2m\\omega} \\left(\\frac{2 + \\exp(\\beta\\hbar\\omega) - 1}{\\exp(\\beta\\hbar\\omega) - 1}\\right) = \\frac{\\hbar}{2m\\omega} \\frac{\\exp(\\beta\\hbar\\omega) + 1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\nThis expression can be simplified using the definition of the hyperbolic cotangent function, $\\coth(x) = \\frac{\\exp(x) + \\exp(-x)}{\\exp(x) - \\exp(-x)} = \\frac{\\exp(2x) + 1}{\\exp(2x) - 1}$:\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\nThe average potential energy for the 3D isotropic QHO is then:\n$$\n\\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m\\omega^2 \\hat{q}^2 \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2} m\\omega^2 \\left[ \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n\nSimilarly, we compute $\\langle \\hat{p}^2 \\rangle_{1D}$:\n$$\n\\hat{p}^2 = (i)^2 \\frac{\\hbar m\\omega}{2}(\\hat{a}^{\\dagger} - \\hat{a})^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^2)\n$$\nUsing $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$:\n$$\n\\hat{p}^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^2) = \\frac{\\hbar m\\omega}{2}(-(\\hat{a}^{\\dagger})^2 - \\hat{a}^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\nTaking the thermal average, the off-diagonal terms again vanish:\n$$\n\\langle \\hat{p}^2 \\rangle_{1D} = \\frac{\\hbar m\\omega}{2} \\langle 2\\hat{n} + 1 \\rangle = \\hbar m\\omega \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right) = \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\nThe average kinetic energy for the 3D isotropic QHO is:\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2m} \\left[ \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\nThis result confirms the quantum virial theorem for the harmonic oscillator, which dictates that $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$.\n\nNow, we analyze these results in the context of Nuclear Quantum Effects (NQE).\n\n1.  **Classical Limit ($T \\to \\infty$, or $\\beta \\to 0$):**\n    In this limit, the argument of the cotangent function $x = \\beta\\hbar\\omega/2$ approaches zero. The Taylor expansion of $\\coth(x)$ for small $x$ is $\\coth(x) \\approx 1/x$.\n    $$\n    \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle \\approx \\frac{3\\hbar\\omega}{4} \\left( \\frac{1}{\\beta\\hbar\\omega/2} \\right) = \\frac{3\\hbar\\omega}{4} \\frac{2}{\\beta\\hbar\\omega} = \\frac{3}{2\\beta} = \\frac{3}{2}k_B T\n    $$\n    This is precisely the result from the classical equipartition theorem, where each of the three kinetic and three potential quadratic degrees of freedom contributes $\\frac{1}{2}k_B T$ to the average energy, for a total of $\\frac{3}{2}k_B T$ for kinetics and $\\frac{3}{2}k_B T$ for potential.\n\n2.  **Quantum Limit and NQE ($T \\to 0$, or $\\beta \\to \\infty$):**\n    In this limit, $x = \\beta\\hbar\\omega/2 \\to \\infty$, and $\\coth(x) \\to 1$.\n    $$\n    \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4}\n    $$\n    This reveals a non-zero energy even at absolute zero temperature. The total energy $\\langle \\hat{H} \\rangle = \\langle \\hat{E}_{\\mathrm{kin}} \\rangle + \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ approaches $\\frac{3\\hbar\\omega}{2}$, which is the ground state energy, or Zero-Point Energy (ZPE), of the 3D isotropic QHO. This ZPE is a direct manifestation of NQE, arising from the Heisenberg uncertainty principle. Classically, the energy at $T=0$ would be zero.\n\n3.  **NQE at Finite Temperature:** The dimensionless parameter $\\hbar\\omega/(k_B T)$ governs the importance of quantum effects.\n    -   **Zero-Point Contribution:** We can rewrite the energy expressions to explicitly show the ZPE contribution:\n        $$\n        \\coth\\left(\\frac{x}{2}\\right) = 1 + \\frac{2}{\\exp(x)-1}\n        $$\n        Therefore,\n        $$\n        \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4} \\left[ 1 + \\frac{2}{\\exp(\\beta\\hbar\\omega) - 1} \\right] = \\frac{3\\hbar\\omega}{4} + \\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}\n        $$\n        The first term, $\\frac{3\\hbar\\omega}{4}$, is the constant zero-point contribution to kinetic and potential energy. The second term is the thermal contribution.\n    -   **Thermal Suppression:** The thermal part of the quantum energy is always less than the classical thermal energy. The classical prediction is $\\frac{3}{2}k_B T$, which can be written as $\\frac{3}{2 \\beta}$. The quantum thermal contribution to the kinetic/potential energy is $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}$. A comparison shows that for any finite temperature ($T>0$), $\\exp(\\beta\\hbar\\omega) - 1 > \\beta\\hbar\\omega$, which implies $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)} < \\frac{3}{2\\beta} = \\frac{3}{2}k_B T$. This suppression is significant when $k_B T \\ll \\hbar\\omega$. In this regime, the thermal energy is insufficient to populate higher vibrational energy levels, causing the degrees of freedom to be \"frozen out.\" This leads to a heat capacity that approaches zero as $T \\to 0$, in stark contrast to the constant classical heat capacity of $3k_B$.\n\nIn summary, NQE manifest as a constant positive energy offset (ZPE) from the classical value, which is particularly evident at low temperatures ($T \\ll \\hbar\\omega/k_B$), and a suppression of the capacity to absorb thermal energy compared to the classical prediction at all finite temperatures.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) & \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Path Integral Molecular Dynamics (PIMD) simulations rely on the Trotter factorization to approximate the continuous quantum path with a discrete 'ring polymer' of beads. This practice  delves into the mathematical origin of the error introduced by this essential approximation. By using the Baker-Campbell-Hausdorff formula to derive the leading-order error, you will gain a rigorous understanding of how simulation accuracy depends on the number of beads, $P$.",
            "id": "3430011",
            "problem": "Consider a single quantum nuclear coordinate embedded in a condensed phase that can be approximated by a one-dimensional harmonic oscillator with Hamiltonian $H = T + V$, where $T = \\frac{p^{2}}{2 m}$, $V = \\frac{1}{2} m \\omega^{2} x^{2}$, $m$ is the nuclear mass, $\\omega$ is the oscillator angular frequency, $x$ is the position operator, and $p$ is the momentum operator. In Path Integral Molecular Dynamics (PIMD), the finite-temperature quantum Boltzmann operator $\\exp(- \\beta H)$, with inverse temperature $\\beta$, is represented by a product of $P$ imaginary-time slices using the symmetric Trotter factorization (Strang splitting)\n$$\n\\left[ \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\exp\\!\\left( - \\frac{\\beta}{P} T \\right) \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\right]^{P}.\n$$\nStarting from the canonical commutation relation $[x, p] = i \\hbar$, the Baker–Campbell–Hausdorff (BCH) formula, and operator algebra, derive the leading-order discretization error in the quantum partition function caused by the finite number of slices $P$. Specifically, obtain the leading-order term in the asymptotic expansion of the relative error\n$$\n\\delta \\equiv \\frac{Z_{P} - Z}{Z},\n$$\nwhere $Z_{P}$ is the partition function obtained from the symmetric Trotter factorization with $P$ slices and $Z$ is the exact quantum partition function, in the limit of large $P$. Your derivation must start from the stated Hamiltonian, use only fundamental commutation relations and standard expansions, and proceed through the BCH-based assessment of the symmetric Trotter splitting error. Express the final result for $\\delta$ as a closed-form analytic expression in terms of $\\beta$, $\\hbar$, $\\omega$, and $P$. No numerical evaluation is required. State your final answer as an analytic expression. If any intermediate thermal expectation values are required, express them using well-tested formulas for the quantum harmonic oscillator. The final answer must be a single expression. Do not include units in your final answer.",
            "solution": "We consider the one-dimensional quantum harmonic oscillator with Hamiltonian $H = T + V$, where $T = \\frac{p^{2}}{2 m}$ and $V = \\frac{1}{2} m \\omega^{2} x^{2}$. The exact quantum partition function is $Z = \\mathrm{Tr} \\left( \\exp(- \\beta H) \\right)$. Path Integral Molecular Dynamics (PIMD) approximates $\\exp(- \\beta H)$ by slicing into $P$ factors using the symmetric Trotter factorization:\n$$\nU_{P} \\equiv \\left[ \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\exp\\!\\left( - \\frac{\\beta}{P} T \\right) \\exp\\!\\left( - \\frac{\\beta}{2 P} V \\right) \\right]^{P}.\n$$\nLet $\\epsilon \\equiv \\frac{\\beta}{P}$. For a single symmetric Trotter step,\n$$\nS(\\epsilon) \\equiv \\exp\\!\\left( - \\frac{\\epsilon}{2} V \\right) \\exp\\!\\left( - \\epsilon T \\right) \\exp\\!\\left( - \\frac{\\epsilon}{2} V \\right).\n$$\nWe apply the Baker–Campbell–Hausdorff (BCH) formula to the symmetric product. A standard result for the Strang splitting gives\n$$\nS(\\epsilon) = \\exp\\!\\left( - \\epsilon (T + V) + \\epsilon^{3} K + O(\\epsilon^{5}) \\right),\n$$\nwhere $K$ is an operator constructed from nested commutators of $T$ and $V$. Denoting $A \\equiv - V$ and $B \\equiv - T$ for compactness, the Strang error exponent is\n$$\nK = \\frac{1}{24} \\left( [A, [A, B]] + 2 [B, [A, B]] \\right).\n$$\nBecause $[A, B] = [-V, -T] = [V, T]$, and linearity of commutators implies $[A, [A, B]] = - [V, [V, T]]$ and $[B, [A, B]] = - [T, [V, T]]$, we obtain\n$$\nK = \\frac{1}{24} \\left( - [V, [V, T]] - 2 [T, [V, T]] \\right).\n$$\nWe now evaluate these commutators for the harmonic oscillator using $[x, p] = i \\hbar$. First compute $[V, T]$:\n\\begin{align*}\n[V, T] &= \\left[ \\frac{1}{2} m \\omega^{2} x^{2}, \\frac{p^{2}}{2 m} \\right] = \\frac{1}{4} \\omega^{2} [x^{2}, p^{2}] \\\\\n[x^{2}, p^{2}] &= x^{2} p^{2} - p^{2} x^{2} = 2 i \\hbar (x p + p x),\n\\end{align*}\nso\n$$\n[V, T] = \\frac{i \\hbar \\omega^{2}}{2} (x p + p x).\n$$\nNext evaluate $[V, [V, T]]$. First,\n\\begin{align*}\n[x^{2}, x p + p x] &= [x^{2}, x p] + [x^{2}, p x] \\\\\n[x^{2}, x p] &= 2 i \\hbar x^{2}, \\quad [x^{2}, p x] = 2 i \\hbar x^{2},\n\\end{align*}\nhence $[x^{2}, x p + p x] = 4 i \\hbar x^{2}$. Therefore,\n\\begin{align*}\n[V, [V, T]] &= \\frac{i \\hbar \\omega^{2}}{2} [V, x p + p x] = \\frac{i \\hbar \\omega^{2}}{2} \\left[ \\frac{1}{2} m \\omega^{2} x^{2}, x p + p x \\right] \\\\\n&= \\frac{i \\hbar \\omega^{2}}{2} \\cdot \\frac{1}{2} m \\omega^{2} \\cdot 4 i \\hbar x^{2} = - \\hbar^{2} m \\omega^{4} x^{2}.\n\\end{align*}\nNow evaluate $[T, [V, T]]$. First,\n\\begin{align*}\n[p^{2}, x p + p x] &= [p^{2}, x p] + [p^{2}, p x] \\\\\n[p^{2}, x p] &= [p^{2}, x] p = (- 2 i \\hbar p) p = - 2 i \\hbar p^{2}, \\\\\n[p^{2}, p x] &= p [p^{2}, x] = p (- 2 i \\hbar p) = - 2 i \\hbar p^{2},\n\\end{align*}\nso $[p^{2}, x p + p x] = - 4 i \\hbar p^{2}$. Therefore,\n\\begin{align*}\n[T, [V, T]] &= \\frac{i \\hbar \\omega^{2}}{2} [T, x p + p x] = \\frac{i \\hbar \\omega^{2}}{2} \\left[ \\frac{p^{2}}{2 m}, x p + p x \\right] \\\\\n&= \\frac{i \\hbar \\omega^{2}}{2} \\cdot \\frac{1}{2 m} \\cdot (- 4 i \\hbar p^{2}) = \\hbar^{2} \\frac{\\omega^{2}}{m} p^{2}.\n\\end{align*}\nCombining these results in $K$,\n\\begin{align*}\nK &= \\frac{1}{24} \\left( - [V, [V, T]] - 2 [T, [V, T]] \\right) \\\\\n&= \\frac{1}{24} \\left( - ( - \\hbar^{2} m \\omega^{4} x^{2} ) - 2 \\left( \\hbar^{2} \\frac{\\omega^{2}}{m} p^{2} \\right) \\right) \\\\\n&= \\frac{\\hbar^{2}}{24} \\left( m \\omega^{4} x^{2} - 2 \\frac{\\omega^{2}}{m} p^{2} \\right).\n\\end{align*}\nThe full $P$-step product is\n$$\nU_{P} = \\left( S(\\epsilon) \\right)^{P} = \\exp\\!\\left( - \\beta H + P \\epsilon^{3} K + O(P \\epsilon^{5}) \\right).\n$$\nUsing $\\epsilon = \\frac{\\beta}{P}$, we have $P \\epsilon^{3} = \\frac{\\beta^{3}}{P^{2}}$. Hence,\n$$\nU_{P} = \\exp\\!\\left( - \\beta H + \\frac{\\beta^{3}}{P^{2}} K + O\\!\\left( \\frac{\\beta^{5}}{P^{4}} \\right) \\right).\n$$\nThe corresponding partition function is\n$$\nZ_{P} = \\mathrm{Tr} \\left( U_{P} \\right) = \\mathrm{Tr} \\left( \\exp\\!\\left( - \\beta H \\right) \\exp\\!\\left( \\frac{\\beta^{3}}{P^{2}} K + \\cdots \\right) \\right).\n$$\nTo leading order in $\\frac{1}{P^{2}}$, expand the exponential of $K$ and use cyclicity of the trace:\n\\begin{align*}\nZ_{P} &= \\mathrm{Tr} \\left( \\exp( - \\beta H ) \\left[ 1 + \\frac{\\beta^{3}}{P^{2}} K + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right) \\right] \\right) \\\\\n&= Z + \\frac{\\beta^{3}}{P^{2}} \\mathrm{Tr} \\left( \\exp( - \\beta H ) K \\right) + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right),\n\\end{align*}\nso the relative error is\n$$\n\\delta \\equiv \\frac{Z_{P} - Z}{Z} = \\frac{\\beta^{3}}{P^{2}} \\left\\langle K \\right\\rangle_{\\beta} + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right),\n$$\nwhere $\\left\\langle \\cdot \\right\\rangle_{\\beta}$ denotes the canonical thermal expectation value with respect to $H$. Using the expression for $K$,\n$$\n\\left\\langle K \\right\\rangle_{\\beta} = \\frac{\\hbar^{2}}{24} \\left( m \\omega^{4} \\left\\langle x^{2} \\right\\rangle_{\\beta} - 2 \\frac{\\omega^{2}}{m} \\left\\langle p^{2} \\right\\rangle_{\\beta} \\right).\n$$\nFor the quantum harmonic oscillator, the well-tested thermal averages are\n$$\n\\left\\langle x^{2} \\right\\rangle_{\\beta} = \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right), \\quad \\left\\langle p^{2} \\right\\rangle_{\\beta} = \\frac{m \\hbar \\omega}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n$$\nSubstituting these into $\\left\\langle K \\right\\rangle_{\\beta}$,\n\\begin{align*}\nm \\omega^{4} \\left\\langle x^{2} \\right\\rangle_{\\beta} &= m \\omega^{4} \\cdot \\frac{\\hbar}{2 m \\omega} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) = \\frac{\\hbar \\omega^{3}}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right), \\\\\n\\frac{\\omega^{2}}{m} \\left\\langle p^{2} \\right\\rangle_{\\beta} &= \\frac{\\omega^{2}}{m} \\cdot \\frac{m \\hbar \\omega}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) = \\frac{\\hbar \\omega^{3}}{2} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n\\end{align*}\nTherefore,\n\\begin{align*}\n\\left\\langle K \\right\\rangle_{\\beta} &= \\frac{\\hbar^{2}}{24} \\left( \\frac{\\hbar \\omega^{3}}{2} - 2 \\cdot \\frac{\\hbar \\omega^{3}}{2} \\right) \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) \\\\\n&= - \\frac{\\hbar^{3} \\omega^{3}}{48} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right).\n\\end{align*}\nThus, the leading-order relative error is\n$$\n\\delta = - \\frac{\\beta^{3}}{P^{2}} \\frac{\\hbar^{3} \\omega^{3}}{48} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right) + O\\!\\left( \\frac{\\beta^{6}}{P^{4}} \\right).\n$$\nDropping the higher-order term gives the requested closed-form analytic expression for the leading-order discretization error in the symmetric Trotter factorization of the quantum partition function for the harmonic oscillator.",
            "answer": "$$\\boxed{- \\frac{\\beta^{3} \\hbar^{3} \\omega^{3}}{48 P^{2}} \\coth\\!\\left( \\frac{1}{2} \\beta \\hbar \\omega \\right)}$$"
        },
        {
            "introduction": "This final practice moves from theory to direct computational application, addressing a critical question for any PIMD practitioner: 'How many beads are sufficient?' You will implement a program  to investigate the convergence of the path integral energy with respect to the number of beads, $P$. This exercise tests a common rule of thumb against realistic vibrational spectra, revealing how system properties like temperature and atomic mass dictate the computational cost of achieving accurate quantum results.",
            "id": "3430035",
            "problem": "You must write a complete and runnable program that conducts a first-principles convergence study of the path-integral bead count for nuclear quantum effects in condensed phases using the harmonic approximation for vibrational modes. The program must implement a criterion based on the inequality $P_{\\text{beads}} \\gtrsim \\beta \\hbar \\omega_{\\max}$ and test its adequacy across heterogeneous mode spectra representative of liquid water and methane. The study must be constructed from the following foundational base and requirements.\n\nBegin from the canonical quantum partition function $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ for a set of independent one-dimensional harmonic oscillators with angular frequencies $\\{\\omega_i\\}$. The exact quantum average energy per mode is obtained from widely accepted principles of quantum statistical mechanics. For a converged path integral discretization using Path Integral Molecular Dynamics (PIMD), the bead number $P_{\\text{beads}}$ controls the Trotter factorization error. Use the primitive Trotter factorization of the imaginary-time path integral in $P$ slices and the ring polymer representation. The discretized partition function for a harmonic oscillator can be expressed as a multidimensional Gaussian in bead coordinates, which is exactly integrable by diagonalization into ring polymer normal modes. The average energy for finite $P$ must be computed by differentiating the discretized partition function with respect to $\\beta$ without resorting to stochastic sampling. Do not assume any shortcut formulas beyond the diagonalization of a quadratic form and the rules for differentiating $\\ln Z$ with respect to $\\beta$. You must use constants $\\hbar$ and the Boltzmann constant $k_{\\mathrm{B}}$ in SI units.\n\nYour program must perform the following steps for each test case.\n1. Convert all provided vibrational mode inputs from wavenumbers in $\\mathrm{cm}^{-1}$ to angular frequencies in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ using $\\omega = 2\\pi c \\tilde{\\nu}$ with $c$ in $\\mathrm{cm}\\,\\mathrm{s}^{-1}$.\n2. Compute $\\beta = 1/(k_{\\mathrm{B}} T)$ in $\\mathrm{J}^{-1}$ for the given temperature $T$ in Kelvin.\n3. Compute the exact total quantum average energy $E_{\\text{exact,tot}}$ for the independent-mode system by summing the exact harmonic oscillator energies over all modes.\n4. Compute the finite-$P$ discretized approximation $E_{P,\\text{tot}}$ to the total energy by evaluating the discretized Gaussian integral for the ring polymer representation and differentiating $-\\partial \\ln Z_P/\\partial \\beta$. You must obtain $E_{P,\\text{tot}}$ deterministically for any positive integer $P$ without Monte Carlo sampling.\n5. Define the rule-of-thumb bead count as $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$, where $\\omega_{\\max}$ is the maximum angular frequency in the mode set and $\\lceil \\cdot \\rceil$ denotes the ceiling to the next integer. Enforce $P_{\\text{rule}} \\ge 1$.\n6. For a specified tolerance $\\delta_{\\text{tot}}$ for the total relative error and a specified tolerance $\\delta_{\\text{single}}$ for the worst single-mode relative error, determine:\n   a. The minimal bead count $P_{\\text{tot}}$ such that $\\left|E_{P,\\text{tot}} - E_{\\text{exact,tot}}\\right|/E_{\\text{exact,tot}} \\le \\delta_{\\text{tot}}$.\n   b. The minimal bead count $P_{\\text{worst}}$ such that $\\max_i \\left( \\left|E_{P}(\\omega_i) - E_{\\text{exact}}(\\omega_i)\\right|/E_{\\text{exact}}(\\omega_i) \\right) \\le \\delta_{\\text{single}}$.\n7. Evaluate two booleans: whether the rule-of-thumb bead count $P_{\\text{rule}}$ meets the total criterion and whether it meets the worst-mode criterion, by checking the corresponding relative errors at $P = P_{\\text{rule}}$.\n8. Report an overkill factor $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$ as a floating-point number.\n\nAll physical constants must be in SI units: use $\\hbar$ in $\\mathrm{J}\\cdot\\mathrm{s}$, $k_{\\mathrm{B}}$ in $\\mathrm{J}\\cdot\\mathrm{K}^{-1}$, and $c$ in $\\mathrm{cm}\\cdot\\mathrm{s}^{-1}$. All frequencies in the input are given in $\\mathrm{cm}^{-1}$ and must be converted to angular frequencies in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ before use. Temperatures are given in Kelvin.\n\nThe test suite consists of four cases, each defined by a tuple of $(T, \\{\\tilde{\\nu}_i\\}, \\delta_{\\text{tot}}, \\delta_{\\text{single}})$, where $T$ is temperature in Kelvin, $\\{\\tilde{\\nu}_i\\}$ is a list of wavenumbers in $\\mathrm{cm}^{-1}$, and the tolerances are dimensionless decimals.\n1. Case $1$ (liquid water-like at $300$ Kelvin): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$.\n2. Case $2$ (methane-like at $300$ Kelvin): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$.\n3. Case $3$ (liquid water-like at $100$ Kelvin): $T = 100$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$.\n4. Case $4$ (low-frequency boundary at $300$ Kelvin): $T = 300$, $\\{\\tilde{\\nu}_i\\} = [100, 200, 300, 400, 500, 600]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of six elements in the order $[P_{\\text{tot}}, P_{\\text{worst}}, P_{\\text{rule}}, \\text{pass}_{\\text{tot}}, \\text{pass}_{\\text{worst}}, \\mathcal{O}]$, where the first three are integers, the next two are booleans, and the last is a float. The overall output should therefore be a list of four such lists, for the four test cases, printed as a single line, for example $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$. No additional text should be printed. All angles are in radians by construction, and no other units appear in the output because the reported quantities are dimensionless or counts. All percentage-type comparisons must be handled as decimals as specified (for example, $0.01$ for one percent).",
            "solution": "The solution is structured around the principles of quantum statistical mechanics and the path-integral formulation of quantum systems. The core of the problem is to determine the convergence of the path-integral representation of a system of independent harmonic oscillators with respect to the number of beads, $P$, used in the discretization.\n\n**1. Fundamental Theory**\n\n**1.1. Exact Quantum Energy of a Harmonic Oscillator**\n\nFor a single quantum harmonic oscillator with angular frequency $\\omega$, the energy levels are given by $E_n = \\hbar\\omega(n + 1/2)$, where $n=0, 1, 2, \\dots$. The canonical partition function $Z_{\\text{exact}}$ at an inverse temperature $\\beta = 1/(k_B T)$ is the sum over all states:\n$$ Z_{\\text{exact}}(\\omega) = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta\\hbar\\omega(n+1/2)} = \\frac{e^{-\\beta\\hbar\\omega/2}}{1 - e^{-\\beta\\hbar\\omega}} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega/2)} $$\nThe average energy $E_{\\text{exact}}(\\omega)$ is obtained by differentiating the logarithm of the partition function with respect to $\\beta$:\n$$ E_{\\text{exact}}(\\omega) = -\\frac{\\partial \\ln Z_{\\text{exact}}(\\omega)}{\\partial \\beta} = \\frac{\\hbar\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) $$\nThis expression gives the exact quantum mechanical average energy for a single harmonic mode. For a system of independent oscillators with frequencies $\\{\\omega_i\\}$, the total exact energy is simply the sum over all modes:\n$$ E_{\\text{exact,tot}} = \\sum_i E_{\\text{exact}}(\\omega_i) $$\n\n**1.2. Path-Integral Discretized Energy**\n\nThe path-integral formulation represents a quantum particle as a classical \"ring polymer\" of $P$ beads. Using the primitive Trotter factorization for a harmonic oscillator, the discretized partition function $Z_P$ can be written as a multidimensional Gaussian integral over the bead positions $\\mathbf{x} = (x_1, \\dots, x_P)$. This integral can be solved exactly by diagonalizing the quadratic form in the exponent, which corresponds to a transformation to ring-polymer normal modes.\n\nThe derivation, as required, proceeds by differentiating the resulting closed-form expression for $\\ln Z_P$. The discretized partition function for a particle of mass $m$ in a harmonic potential is:\n$$ Z_P = \\left( \\frac{mP}{2\\pi\\beta\\hbar^2} \\right)^{P/2} \\int d\\mathbf{x} \\exp\\left( -\\sum_{s=1}^P \\left[ \\frac{mP}{2\\beta\\hbar^2}(x_s - x_{s+1})^2 + \\frac{\\beta m\\omega^2}{2P}x_s^2 \\right] \\right) $$\nwhere $x_{P+1} \\equiv x_1$. The term in the exponent is a quadratic form $-\\frac{1}{2}\\mathbf{x}^T \\mathbf{A} \\mathbf{x}$. The matrix $\\mathbf{A}$ is a circulant matrix whose eigenvalues $\\lambda_k$ (for $k=0, \\dots, P-1$) are:\n$$ \\lambda_k = \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} $$\nThe integral evaluates to $(2\\pi)^{P/2}(\\det \\mathbf{A})^{-1/2} = (2\\pi)^{P/2} (\\prod_k \\lambda_k)^{-1/2}$. This leads to the expression for the partition function:\n$$ Z_P = \\left(\\frac{mP}{\\beta\\hbar^2}\\right)^{P/2} \\left(\\prod_{k=0}^{P-1} \\lambda_k\\right)^{-1/2} $$\nTaking the logarithm gives:\n$$ \\ln Z_P = \\frac{P}{2}\\ln\\left(\\frac{mP}{\\beta\\hbar^2}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\ln\\left( \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} \\right) $$\nThe energy $E_P(\\omega)$ is found by computing $-\\partial(\\ln Z_P)/\\partial\\beta$. After performing the differentiation and simplifying, one obtains the \"thermodynamic\" energy estimator:\n$$ E_P(\\omega) = \\frac{P}{2\\beta} + \\frac{1}{2} \\sum_{k=0}^{P-1} \\frac{\\frac{\\omega^2}{P} - \\frac{4P}{\\beta^2\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)}{\\frac{\\beta \\omega^2}{P} + \\frac{4P}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)} $$\nNote that the mass $m$ cancels out, as expected for a property of a harmonic oscillator that depends only on $\\omega$. This formula is deterministic and allows for the calculation of the energy for any finite bead count $P$ without resorting to stochastic sampling. The total energy for a set of modes is the sum $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$.\n\n**2. Algorithmic Implementation**\n\nThe program implements the above theoretical framework to perform the requested convergence study.\n\n**Step 1: Initialization**\nThe physical constants are defined in SI units as specified: $\\hbar = 1.054571817 \\times 10^{-34} \\, \\mathrm{J}\\cdot\\mathrm{s}$, $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\cdot\\mathrm{K}^{-1}$, and $c = 2.99792458 \\times 10^{10} \\, \\mathrm{cm}\\cdot\\mathrm{s}^{-1}$.\n\n**Step 2: Input Conversion**\nFor each test case, the temperature $T$ is used to compute $\\beta = 1/(k_B T)$. The vibrational wavenumbers $\\{\\tilde{\\nu}_i\\}$ (in $\\mathrm{cm}^{-1}$) are converted to angular frequencies $\\{\\omega_i\\}$ (in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$) using the relation $\\omega = 2\\pi c \\tilde{\\nu}$.\n\n**Step 3: Exact and Approximate Energy Calculation**\nFunctions are implemented to calculate $E_{\\text{exact}}(\\omega)$ and $E_P(\\omega)$ using the derived formulas. These functions are vectorized using `numpy` to efficiently compute energies for the entire set of frequencies $\\{\\omega_i\\}$ simultaneously.\n\n**Step 4: Convergence Analysis**\nA search loop is initiated, starting from $P=1$. In each iteration, the program calculates the total PIMD energy $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$ and the individual mode energies $E_P(\\omega_i)$. It then computes the relative errors:\n- Total relative error: $\\epsilon_{\\text{tot}}(P) = |E_{P,\\text{tot}} - E_{\\text{exact,tot}}| / E_{\\text{exact,tot}}$\n- Worst-mode relative error: $\\epsilon_{\\text{worst}}(P) = \\max_i(|E_P(\\omega_i) - E_{\\text{exact}}(\\omega_i)| / E_{\\text{exact}}(\\omega_i))$\n\nThe loop continues, incrementing $P$, until the minimal values $P_{\\text{tot}}$ and $P_{\\text{worst}}$ are found that satisfy $\\epsilon_{\\text{tot}}(P_{\\text{tot}}) \\le \\delta_{\\text{tot}}$ and $\\epsilon_{\\text{worst}}(P_{\\text{worst}}) \\le \\delta_{\\text{single}}$, respectively.\n\n**Step 5: Rule-of-Thumb Evaluation**\nThe heuristic bead count $P_{\\text{rule}}$ is calculated as $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$, where $\\omega_{\\max}$ is the highest frequency in the set. A minimum value of $1$ is enforced. The performance of this rule is then tested by computing the total and worst-mode relative errors at $P=P_{\\text{rule}}$ and checking if they satisfy the specified tolerances ($\\delta_{\\text{tot}}$ and $\\delta_{\\text{single}}$).\n\n**Step 6: Reporting**\nFinally, the results for each test case—$P_{\\text{tot}}$, $P_{\\text{worst}}$, $P_{\\text{rule}}$, the two boolean pass/fail checks, and the overkill factor $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$—are collected and formatted into the required list of lists structure for the final output.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the PIMD convergence study for all test cases.\n    \"\"\"\n    \n    # Physical constants in SI units, except for c as specified\n    HBAR = 1.054571817e-34  # J.s\n    KB = 1.380649e-23        # J/K\n    C_CMS = 2.99792458e10   # cm/s\n\n    test_cases = [\n        # Case 1 (water-like at 300 K)\n        (300, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 2 (methane-like at 300 K)\n        (300, [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200], 0.01, 0.01),\n        # Case 3 (water-like at 100 K)\n        (100, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 4 (low-frequency at 300 K)\n        (300, [100, 200, 300, 400, 500, 600], 0.01, 0.01),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        T_kelvin, nu_cm_inv, delta_tot, delta_single = case\n        \n        # 1. Convert inputs\n        beta = 1.0 / (KB * T_kelvin)\n        omegas = 2.0 * np.pi * C_CMS * np.array(nu_cm_inv)\n        \n        # 3. Compute exact energies\n        def calc_E_exact(omega_arr, beta_val, hbar_val):\n            x = beta_val * hbar_val * omega_arr / 2.0\n            # Handle potential overflow in np.exp(2*x) for coth(x)\n            large_x_mask = x > 35\n            coth_x = np.zeros_like(x)\n            # For large x, coth(x) is 1\n            coth_x[large_x_mask] = 1.0\n            # For other x, use standard definition\n            non_large_x = ~large_x_mask\n            # Avoid division by zero if x is very small sinh(x->0) -> 0\n            small_x_mask = x  1e-8\n            x_safe = np.copy(x[non_large_x])\n            x_safe[x_safe  1e-8] = 1e-8 # Prevent division by zero, coth(x) ~ 1/x for small x\n            coth_x[non_large_x] = np.cosh(x_safe) / np.sinh(x_safe)\n            return (hbar_val * omega_arr / 2.0) * coth_x\n\n        E_exact_per_mode = calc_E_exact(omegas, beta, HBAR)\n        E_exact_tot = np.sum(E_exact_per_mode)\n\n        # 4. PIMD energy calculator\n        def calc_E_P(omega_arr, beta_val, P, hbar_val):\n            k = np.arange(P)\n            sin_k = np.sin(np.pi * k / P)\n            sin_k_sq = sin_k**2\n            \n            omega_arr_sq = omega_arr[:, np.newaxis]**2\n\n            num_part1 = omega_arr_sq / P\n            num_part2 = (4 * P / (beta_val**2 * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            numerator = num_part1 - num_part2\n            \n            den_part1 = (beta_val / P) * omega_arr_sq\n            den_part2 = (4 * P / (beta_val * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            denominator = den_part1 + den_part2\n            \n            sum_term = np.sum(numerator / denominator, axis=1)\n            \n            E_p_per_mode = P / (2 * beta_val) + 0.5 * sum_term\n            return E_p_per_mode, np.sum(E_p_per_mode)\n\n        # 5. Rule-of-thumb bead count\n        omega_max = np.max(omegas) if omegas.size > 0 else 0\n        P_rule_float = beta * HBAR * omega_max\n        P_rule = max(1, math.ceil(P_rule_float))\n\n        # 6. Find minimal P_tot and P_worst\n        P = 1\n        P_tot, P_worst = None, None\n        \n        while P_tot is None or P_worst is None:\n            E_p_per_mode, E_p_tot = calc_E_P(omegas, beta, P, HBAR)\n            \n            if P_tot is None:\n                rel_err_tot = np.abs(E_p_tot - E_exact_tot) / E_exact_tot\n                if rel_err_tot = delta_tot:\n                    P_tot = P\n            \n            if P_worst is None:\n                rel_err_per_mode = np.abs(E_p_per_mode - E_exact_per_mode) / E_exact_per_mode\n                max_rel_err = np.max(rel_err_per_mode)\n                if max_rel_err = delta_single:\n                    P_worst = P\n\n            P += 1\n            if P > 500:\n                 if P_tot is None: P_tot = -1\n                 if P_worst is None: P_worst = -1\n                 break\n\n        # 7. Evaluate P_rule\n        E_prule_per_mode, E_prule_tot = calc_E_P(omegas, beta, P_rule, HBAR)\n        \n        err_tot_at_prule = np.abs(E_prule_tot - E_exact_tot) / E_exact_tot\n        pass_tot = err_tot_at_prule = delta_tot\n        \n        err_worst_at_prule = np.max(np.abs(E_prule_per_mode - E_exact_per_mode) / E_exact_per_mode)\n        pass_worst = err_worst_at_prule = delta_single\n        \n        # 8. Overkill factor\n        overkill = float(P_rule) / P_tot if P_tot != 0 else float('inf')\n\n        all_results.append([P_tot, P_worst, P_rule, pass_tot, pass_worst, overkill])\n\n    # Format output string manually to match the exact requirement\n    # \"[[item1,item2,...],[item1,item2,...]]\" with no spaces.\n    list_of_list_strs = []\n    for res_list in all_results:\n        str_items = [str(x) for x in res_list]\n        list_str = \"[\" + \",\".join(str_items) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}