{
    "hands_on_practices": [
        {
            "introduction": "A robust understanding of shear simulation begins with the fundamental kinematics. This exercise grounds the abstract concept of homogeneous shear flow by tasking you with deriving the affine particle trajectories directly from the continuum velocity field. By working through this derivation, you will see how these trajectories naturally give rise to the specific coordinate remapping required by the Lees-Edwards boundary conditions, a cornerstone technique for simulating bulk shear .",
            "id": "3445268",
            "problem": "Consider a three-dimensional molecular dynamics simulation of a homogeneous, planar simple shear flow with flow along the $x$-direction and gradient along the $y$-direction. The imposed shear rate is constant and denoted by $\\dot{\\gamma}$. The continuum velocity field is therefore homogeneous and given by $v_{x}(\\mathbf{r},t)=\\dot{\\gamma}\\,y$, $v_{y}(\\mathbf{r},t)=0$, and $v_{z}(\\mathbf{r},t)=0$. Let the initial position of a material point be $\\mathbf{r}(0)=(x_{0},y_{0},z_{0})$ and define the accumulated strain as $\\gamma(t)=\\dot{\\gamma}\\,t$. Assume purely affine deformation (no nonaffine fluctuations).\n\nStarting solely from the kinematic relation $\\mathrm{d}\\mathbf{r}/\\mathrm{d}t=\\mathbf{v}(\\mathbf{r},t)$ and the stated velocity field, derive the explicit time evolution $\\mathbf{r}(t)$ in Cartesian components $(x(t),y(t),z(t))$ for arbitrary $t\\ge 0$. Then, consider a triclinic periodic cell specialized to an orthorhombic reference with edge lengths $L_{x}$, $L_{y}$, and $L_{z}$, subject to Lees–Edwards boundary conditions (sliding periodic boundaries). When a particle crosses the top boundary at $y=+L_{y}/2$ and is remapped back into the primary box by setting $y\\mapsto y-L_{y}$, determine the single affine $x$-shift $\\Delta x_{\\mathrm{LE}}(t)$ that must be applied simultaneously to preserve the homogeneous shear mapping in the periodically continued system.\n\nYour final answer must be a single row matrix containing, in order, $x(t)$, $y(t)$, $z(t)$, and $\\Delta x_{\\mathrm{LE}}(t)$, expressed in terms of $x_{0}$, $y_{0}$, $z_{0}$, $\\gamma(t)$, and $L_{y}$. Do not include units in the final answer. No numerical rounding is required.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of continuum mechanics and molecular dynamics, is well-posed with sufficient information for a unique solution, and is stated using objective, formal language.\n\nThe solution is determined in two parts: first, the derivation of the particle trajectory under affine shear deformation, and second, the determination of the coordinate shift required by the Lees-Edwards boundary conditions.\n\nPart 1: Derivation of the particle trajectory $\\mathbf{r}(t)$\n\nThe motion of a material point is governed by the kinematic relation $\\mathrm{d}\\mathbf{r}/\\mathrm{d}t = \\mathbf{v}(\\mathbf{r},t)$, where $\\mathbf{r}(t) = (x(t), y(t), z(t))$ is the position vector at time $t$. The imposed velocity field is given as $v_{x}(\\mathbf{r},t)=\\dot{\\gamma}\\,y$, $v_{y}(\\mathbf{r},t)=0$, and $v_{z}(\\mathbf{r},t)=0$. This yields a system of first-order ordinary differential equations (ODEs) for the components of $\\mathbf{r}(t)$:\n$$\n\\frac{\\mathrm{d}x}{\\mathrm{d}t} = \\dot{\\gamma}\\,y(t)\n$$\n$$\n\\frac{\\mathrm{d}y}{\\mathrm{d}t} = 0\n$$\n$$\n\\frac{\\mathrm{d}z}{\\mathrm{d}t} = 0\n$$\nThe initial condition is specified as $\\mathbf{r}(0) = (x_0, y_0, z_0)$.\n\nWe solve the equations for $y(t)$ and $z(t)$ first.\nIntegrating $\\mathrm{d}y/\\mathrm{d}t = 0$ from $t=0$ to an arbitrary time $t$:\n$$\n\\int_{y(0)}^{y(t)} \\mathrm{d}y' = \\int_{0}^{t} 0\\,\\mathrm{d}t' \\implies y(t) - y_0 = 0 \\implies y(t) = y_0\n$$\nSimilarly, for the $z$-component:\n$$\n\\int_{z(0)}^{z(t)} \\mathrm{d}z' = \\int_{0}^{t} 0\\,\\mathrm{d}t' \\implies z(t) - z_0 = 0 \\implies z(t) = z_0\n$$\nThe $y$ and $z$ coordinates of the material point remain constant over time, equal to their initial values.\n\nNow, we solve for the $x$-component. Substituting $y(t) = y_0$ into the ODE for $x(t)$:\n$$\n\\frac{\\mathrm{d}x}{\\mathrm{d}t} = \\dot{\\gamma}\\,y_0\n$$\nSince $\\dot{\\gamma}$ and $y_0$ are both constants, we can directly integrate this equation with respect to time from $t=0$ to $t$:\n$$\n\\int_{x(0)}^{x(t)} \\mathrm{d}x' = \\int_{0}^{t} \\dot{\\gamma}\\,y_0\\,\\mathrm{d}t' \\implies x(t) - x_0 = \\dot{\\gamma}\\,y_0\\,t\n$$\nThis gives the solution for $x(t)$:\n$$\nx(t) = x_0 + \\dot{\\gamma}\\,y_0\\,t\n$$\nThe problem defines the accumulated strain as $\\gamma(t) = \\dot{\\gamma}\\,t$. Substituting this into the expression for $x(t)$:\n$$\nx(t) = x_0 + y_0\\,\\gamma(t)\n$$\nIn summary, the time evolution of the position vector for a purely affine deformation is:\n$$\n\\mathbf{r}(t) = (x(t), y(t), z(t)) = (x_0 + y_0\\,\\gamma(t), y_0, z_0)\n$$\n\nPart 2: Derivation of the Lees-Edwards boundary condition shift $\\Delta x_{\\mathrm{LE}}(t)$\n\nLees-Edwards boundary conditions simulate shear in a periodic system by distorting the simulation cell over time. An initially orthorhombic box with basis vectors $\\mathbf{a}_1(0)=(L_x, 0, 0)$, $\\mathbf{a}_2(0)=(0, L_y, 0)$, and $\\mathbf{a}_3(0)=(0, 0, L_z)$ deforms into a triclinic box. The time-dependent basis vectors are found by applying the deformation gradient tensor, which corresponds to the affine mapping derived above.\nThe affine transformation is $\\mathbf{r}(t) = \\mathbf{F}(t)\\cdot\\mathbf{r}(0)$, where the deformation gradient tensor $\\mathbf{F}(t)$ is:\n$$\n\\mathbf{F}(t) = \\begin{pmatrix} 1 & \\gamma(t) & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThe basis vectors at time $t$ are $\\mathbf{a}_i(t) = \\mathbf{F}(t)\\cdot\\mathbf{a}_i(0)$.\n$$\n\\mathbf{a}_1(t) = \\mathbf{F}(t)\\cdot(L_x, 0, 0)^T = (L_x, 0, 0)^T\n$$\n$$\n\\mathbf{a}_2(t) = \\mathbf{F}(t)\\cdot(0, L_y, 0)^T = (\\gamma(t) L_y, L_y, 0)^T\n$$\n$$\n\\mathbf{a}_3(t) = \\mathbf{F}(t)\\cdot(0, 0, L_z)^T = (0, 0, L_z)^T\n$$\nThe geometry of the periodic-image lattice is described by these time-dependent vectors. The position of an image particle $\\mathbf{r}_{\\text{image}}$ is related to the primary particle's position $\\mathbf{r}_{\\text{primary}}$ by $\\mathbf{r}_{\\text{image}} = \\mathbf{r}_{\\text{primary}} + n_1\\mathbf{a}_1(t) + n_2\\mathbf{a}_2(t) + n_3\\mathbf{a}_3(t)$ for integers $n_1, n_2, n_3$.\n\nThe problem considers a particle crossing the top boundary of the primary simulation cell (typically defined as $y \\in [-L_y/2, L_y/2)$). When a particle's $y$-coordinate exceeds $L_y/2$, it has effectively entered the periodic image cell \"above\" the primary one, which corresponds to the lattice vector $\\mathbf{a}_2(t)$ (i.e., $n_2=1$, $n_1=0$, $n_3=0$).\n\nTo remap the particle back into the primary cell, its coordinates must be shifted by the negative of this lattice vector. Let $\\mathbf{r}_{\\text{old}}$ be the coordinates before remapping and $\\mathbf{r}_{\\text{new}}$ be the coordinates after remapping. The transformation is:\n$$\n\\mathbf{r}_{\\text{new}} = \\mathbf{r}_{\\text{old}} - \\mathbf{a}_2(t)\n$$\nIn component form, this gives:\n$$\nx_{\\text{new}} = x_{\\text{old}} - (\\gamma(t) L_y)\n$$\n$$\ny_{\\text{new}} = y_{\\text{old}} - L_y\n$$\n$$\nz_{\\text{new}} = z_{\\text{old}} - 0\n$$\nThe problem states that when the remapping $y \\mapsto y-L_y$ occurs, a simultaneous shift $\\Delta x_{\\mathrm{LE}}(t)$ is applied to the $x$-coordinate, such that $x_{\\text{new}} = x_{\\text{old}} + \\Delta x_{\\mathrm{LE}}(t)$.\nBy comparing our derived transformation for $x$ with this definition, we can identify the shift:\n$$\n\\Delta x_{\\mathrm{LE}}(t) = - \\gamma(t) L_y\n$$\nThis shift is affine, as it depends only on the global accumulated strain $\\gamma(t)$ and the box height $L_y$, not on the individual particle's coordinates.\n\nThe four requested quantities are therefore:\n1. $x(t) = x_0 + y_0\\,\\gamma(t)$\n2. $y(t) = y_0$\n3. $z(t) = z_0$\n4. $\\Delta x_{\\mathrm{LE}}(t) = - \\gamma(t) L_y$\nThese are combined into a single row matrix for the final answer.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} x_0 + y_0 \\gamma(t) & y_0 & z_0 & -\\gamma(t) L_y \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from theory to practice, this exercise highlights the critical importance of correctly implementing periodic boundary conditions in a sheared system. You will validate the sheared minimum-image convention by quantifying the force errors that arise from a naive, incorrect implementation . This practice provides a concrete example of how subtle algorithmic flaws can lead to significant physical inaccuracies, especially for particle interactions near the potential cutoff distance.",
            "id": "3445317",
            "problem": "You are to write a complete, runnable program that validates the minimum-image convention under sheared periodic remapping in a two-dimensional Molecular Dynamics setting with Lees-Edwards boundary conditions, and quantifies the force errors that arise if the shear-induced horizontal shifts are omitted during periodic wrapping. The program must implement physics and geometry from first principles and produce a single-line output aggregating the results for a given test suite.\n\nThe fundamental base you must use is Newton's Laws and core definitions of kinematics and interparticle forces: (i) Newton's Second Law, $m\\,d^2\\mathbf{r}/dt^2=\\mathbf{F}$, (ii) $\\mathbf{v}=d\\mathbf{r}/dt$, (iii) interparticle force as the negative gradient of a potential, $\\mathbf{F}(\\mathbf{r})=-\\nabla U(\\mathbf{r})$. The shear flow is simple shear along the $x$-direction with gradient in the $y$-direction. The periodic boundary condition is Lees-Edwards, which prescribes an $x$-direction shift proportional to the number of $y$-slab crossings when performing minimum-image wrapping.\n\nGeometry and remapping:\n- Consider two particles with positions $\\mathbf{r}_i=(x_i,y_i)$ and $\\mathbf{r}_j=(x_j,y_j)$ in a two-dimensional rectangular domain with side lengths $L_x$ and $L_y$.\n- Let $s$ denote the shear-induced $x$-shift per $y$-cell crossing, equal to $s=\\dot{\\gamma}\\,t\\,L_y$, where $\\dot{\\gamma}$ is the shear rate and $t$ is time. In this problem, $s$ is treated as a given parameter.\n- Define the raw separation components as $\\Delta x_{\\text{raw}}=x_j-x_i$ and $\\Delta y_{\\text{raw}}=y_j-y_i$.\n- Under Lees-Edwards boundary conditions, the correct sheared minimum-image separation is constructed as follows:\n  1. Compute $n_y=\\operatorname{round}(\\Delta y_{\\text{raw}}/L_y)$, the nearest integer number of $y$-cell crossings required to bring the separation in $y$ into the principal interval.\n  2. Compute the $y$-wrapped separation $\\Delta y=\\Delta y_{\\text{raw}}-n_y\\,L_y$.\n  3. Apply the shear-induced $x$-shift and $x$ wrapping: $\\Delta x=\\Delta x_{\\text{raw}}-n_y\\,s$, then compute $n_x=\\operatorname{round}(\\Delta x/L_x)$ and finally $\\Delta x\\leftarrow\\Delta x-n_x\\,L_x$.\n- The naive, incorrect minimum-image separation that ignores shear uses only standard wrapping (no $x$-shift): $\\Delta y_{\\text{naive}}=\\Delta y_{\\text{raw}}-n_y\\,L_y$ with $n_y=\\operatorname{round}(\\Delta y_{\\text{raw}}/L_y)$, and $\\Delta x_{\\text{naive}}=\\Delta x_{\\text{raw}}-n_x\\,L_x$ with $n_x=\\operatorname{round}(\\Delta x_{\\text{raw}}/L_x)$.\n\nInterparticle force:\n- Use the Lennard–Jones pair potential in reduced units (Lennard–Jones units), where $\\sigma=1$ and $\\epsilon=1$, and a pairwise cutoff $r_c$.\n- The pairwise force must be computed from the negative gradient of the potential. The cutoff is enforced as follows: if the scalar separation $r=\\sqrt{\\Delta x^2+\\Delta y^2}$ satisfies $r\\ge r_c$, the force is $\\mathbf{F}=\\mathbf{0}$; otherwise compute the nonzero Lennard–Jones force.\n\nQuantify force error:\n- For each test case, compute the force vector using the correct sheared minimum-image separation $\\mathbf{F}_{\\text{correct}}$ and the naive force that ignores shear $\\mathbf{F}_{\\text{naive}}$.\n- Define the error metric as the Euclidean norm of the difference of the two force vectors: $E=\\|\\mathbf{F}_{\\text{correct}}-\\mathbf{F}_{\\text{naive}}\\|$. This quantity is dimensionless in Lennard–Jones reduced units.\n\nUnits:\n- All lengths must be treated in Lennard–Jones reduced units, with $\\sigma=1$. The force must be dimensionless in Lennard–Jones reduced units. The final answers must be dimensionless floats.\n\nTest suite:\nImplement the following four test cases, each specified by $(L_x,L_y,s,x_i,y_i,x_j,y_j,r_c)$:\n1. Baseline, no shear: $(L_x,L_y,s)=(10,10,0)$, particles $(x_i,y_i)=(1.0,1.0)$ and $(x_j,y_j)=(3.4,2.0)$, cutoff $r_c=2.5$. This is a happy-path case where both methods coincide.\n2. Shear with small $L_y$ producing an edge case near the cutoff (correct inside, naive outside): $(L_x,L_y,s)=(10,2,2)$, particles $(x_i,y_i)=(9.0,0.95)$ and $(x_j,y_j)=(1.55,2.05)$, cutoff $r_c=2.5$.\n3. Shear with small $L_y$ producing the opposite edge case (correct outside, naive inside): $(L_x,L_y,s)=(10,2,2)$, particles $(x_i,y_i)=(9.0,0.95)$ and $(x_j,y_j)=(7.0,2.05)$, cutoff $r_c=2.5$.\n4. Large shear magnitude to test robustness of sheared wrapping: $(L_x,L_y,s)=(10,2,12)$, particles $(x_i,y_i)=(9.0,0.95)$ and $(x_j,y_j)=(1.55,2.05)$, cutoff $r_c=2.5$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the error results for the four test cases as a comma-separated list enclosed in square brackets, for example, $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$, where each $\\text{result}_k$ is a float in Lennard–Jones reduced units.",
            "solution": "The problem requires a quantitative analysis of the error introduced by incorrectly applying the minimum-image convention (MIC) in a two-dimensional molecular dynamics simulation under steady shear flow. Specifically, we are to compare the interparticle force calculated using the correct Lees-Edwards periodic boundary conditions against a naive implementation that ignores the shear-induced coupling between spatial dimensions. The analysis will be conducted for four specific test cases.\n\nThe scientific foundation for this problem rests on Newtonian mechanics and the statistical mechanics of condensed matter. The force between particles is derived from a potential energy function, and the simulation domain's periodicity is handled by a specific geometric mapping algorithm appropriate for sheared systems.\n\nFirst, let us define the interparticle interaction. The problem specifies the Lennard-Jones (LJ) potential, $U(r)$, in reduced units where the energy scale $\\epsilon$ and length scale $\\sigma$ are both unity. The potential is given by:\n$$\nU(r) = 4\\epsilon \\left[ \\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6} \\right] \\quad \\xrightarrow{\\epsilon=1, \\sigma=1} \\quad U(r) = 4\\left(r^{-12} - r^{-6}\\right)\n$$\nwhere $r$ is the scalar distance between two particles. A cutoff distance, $r_c$, is applied, such that the interaction is zero for $r \\ge r_c$.\n\nThe force $\\mathbf{F}$ on a particle due to another is the negative gradient of the potential, $\\mathbf{F} = -\\nabla U(r)$. Since $U$ is a function of the magnitude $r = \\|\\mathbf{r}\\|$, where $\\mathbf{r}$ is the separation vector, we use the chain rule:\n$$\n\\mathbf{F}(\\mathbf{r}) = -\\frac{dU}{dr} \\frac{\\partial r}{\\partial \\mathbf{r}} = -\\frac{dU}{dr} \\frac{\\mathbf{r}}{r}\n$$\nThe derivative of the potential with respect to $r$ is:\n$$\n\\frac{dU}{dr} = 4 \\left( -12r^{-13} + 6r^{-7} \\right) = -24 \\left( 2r^{-13} - r^{-7} \\right)\n$$\nSubstituting this into the force expression gives:\n$$\n\\mathbf{F}(\\mathbf{r}) = 24 \\left( 2r^{-13} - r^{-7} \\right) \\frac{\\mathbf{r}}{r} = \\left( 48r^{-14} - 24r^{-8} \\right) \\mathbf{r}\n$$\nThis force is calculated if $r < r_c$; otherwise, $\\mathbf{F} = \\mathbf{0}$.\n\nNext, we address the core of the problem: the calculation of the minimum-image separation vector $\\mathbf{r} = (\\Delta x, \\Delta y)$ in a sheared periodic domain of size $L_x \\times L_y$. For two particles at absolute positions $\\mathbf{r}_i = (x_i, y_i)$ and $\\mathbf{r}_j = (x_j, y_j)$, the raw separation is $\\mathbf{r}_{\\text{raw}} = \\mathbf{r}_j - \\mathbf{r}_i = (\\Delta x_{\\text{raw}}, \\Delta y_{\\text{raw}})$.\n\nThe naive minimum-image convention ignores the shear. It wraps the $x$ and $y$ components of the separation vector independently into the central periodic box, which ranges from $-L/2$ to $L/2$.\n1. Wrap the $y$-component: $\\Delta y_{\\text{naive}} = \\Delta y_{\\text{raw}} - L_y \\cdot \\operatorname{round}(\\Delta y_{\\text{raw}} / L_y)$.\n2. Wrap the $x$-component: $\\Delta x_{\\text{naive}} = \\Delta x_{\\text{raw}} - L_x \\cdot \\operatorname{round}(\\Delta x_{\\text{raw}} / L_x)$.\nThe naive separation vector is $\\mathbf{r}_{\\text{naive}} = (\\Delta x_{\\text{naive}}, \\Delta y_{\\text{naive}})$.\n\nThe correct Lees-Edwards boundary condition accounts for the fact that the simulation box is deforming. A particle crossing a boundary in the $y$-direction is remapped with an additional displacement in the $x$-direction. The total accumulated $x$-shift is given by $s$. The algorithm is as follows:\n1. Compute the number of $y$-images crossed: $n_y = \\operatorname{round}(\\Delta y_{\\text{raw}} / L_y)$.\n2. Wrap the $y$-component as before: $\\Delta y = \\Delta y_{\\text{raw}} - n_y L_y$.\n3. Apply the shear-induced displacement to the raw $x$-separation: $\\Delta x_{\\text{shifted}} = \\Delta x_{\\text{raw}} - n_y s$.\n4. Wrap the shifted $x$-component: $\\Delta x = \\Delta x_{\\text{shifted}} - L_x \\cdot \\operatorname{round}(\\Delta x_{\\text{shifted}} / L_x)$.\nThe correct sheared separation vector is $\\mathbf{r}_{\\text{correct}} = (\\Delta x, \\Delta y)$.\n\nThe error to be quantified is the Euclidean norm of the difference between the force vector calculated with the correct Lees-Edwards separation, $\\mathbf{F}_{\\text{correct}}$, and the force vector from the naive separation, $\\mathbf{F}_{\\text{naive}}$:\n$$\nE = \\| \\mathbf{F}_{\\text{correct}} - \\mathbf{F}_{\\text{naive}} \\|\n$$\n\nWe now apply this framework to the four test cases. All calculations will use the $\\operatorname{round()}$ function as rounding to the nearest integer, with halves rounded to the nearest even integer (the standard behavior in Python/NumPy).\n\nCase 1: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 10, 0, 1.0, 1.0, 3.4, 2.0, 2.5)$.\n- $\\mathbf{r}_{\\text{raw}} = (2.4, 1.0)$.\n- Since $s=0$ and no boundary is crossed ($n_y=\\operatorname{round}(1.0/10)=0$, $n_x=\\operatorname{round}(2.4/10)=0$), both methods yield the same separation vector: $\\mathbf{r}_{\\text{correct}} = \\mathbf{r}_{\\text{naive}} = (2.4, 1.0)$.\n- The distance is $r = \\sqrt{2.4^2 + 1.0^2} = \\sqrt{6.76} = 2.6$.\n- Since $r = 2.6 > r_c = 2.5$, both forces are zero: $\\mathbf{F}_{\\text{correct}} = \\mathbf{F}_{\\text{naive}} = \\mathbf{0}$.\n- The error is $E_1 = \\|\\mathbf{0} - \\mathbf{0}\\| = 0.0$.\n\nCase 2: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 2, 9.0, 0.95, 1.55, 2.05, 2.5)$.\n- $\\mathbf{r}_{\\text{raw}} = (1.55 - 9.0, 2.05 - 0.95) = (-7.45, 1.1)$.\n- Correct Lees-Edwards:\n  - $n_y = \\operatorname{round}(1.1/2) = \\operatorname{round}(0.55) = 1$.\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$.\n  - $\\Delta x_{\\text{shifted}} = -7.45 - 1 \\cdot s = -7.45 - 2 = -9.45$.\n  - $\\Delta x = -9.45 - 10 \\cdot \\operatorname{round}(-9.45/10) = -9.45 - 10 \\cdot (-1) = 0.55$.\n  - $\\mathbf{r}_{\\text{correct}} = (0.55, -0.9)$. $r_{\\text{correct}} = \\sqrt{0.55^2 + (-0.9)^2} = \\sqrt{1.1125} \\approx 1.055 < r_c$.\n- Naive MIC:\n  - $\\Delta y_{\\text{naive}} = 1.1 - 1 \\cdot 2 = -0.9$.\n  - $\\Delta x_{\\text{naive}} = -7.45 - 10 \\cdot \\operatorname{round}(-7.45/10) = -7.45 - 10 \\cdot (-1) = 2.55$.\n  - $\\mathbf{r}_{\\text{naive}} = (2.55, -0.9)$. $r_{\\text{naive}} = \\sqrt{2.55^2 + (-0.9)^2} = \\sqrt{7.3125} \\approx 2.704 > r_c$.\n- Here, $\\mathbf{F}_{\\text{correct}}$ is non-zero, while $\\mathbf{F}_{\\text{naive}} = \\mathbf{0}$. The error $E_2$ is the magnitude of $\\mathbf{F}_{\\text{correct}}$.\n- For $\\mathbf{r}_{\\text{correct}}$, the scalar prefactor for the force is $(48(1.055)^{-14} - 24(1.055)^{-8}) \\approx 6.566$.\n- $\\mathbf{F}_{\\text{correct}} \\approx 6.566 \\cdot (0.55, -0.9) = (3.611, -5.909)$.\n- $E_2 = \\|\\mathbf{F}_{\\text{correct}}\\| = \\sqrt{3.611^2 + (-5.909)^2} \\approx 6.925$.\n\nCase 3: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 2, 9.0, 0.95, 7.0, 2.05, 2.5)$.\n- $\\mathbf{r}_{\\text{raw}} = (7.0 - 9.0, 2.05 - 0.95) = (-2.0, 1.1)$.\n- Correct Lees-Edwards:\n  - $n_y = \\operatorname{round}(1.1/2) = 1$.\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$.\n  - $\\Delta x_{\\text{shifted}} = -2.0 - 1 \\cdot s = -2.0 - 2 = -4.0$.\n  - $\\Delta x = -4.0 - 10 \\cdot \\operatorname{round}(-4.0/10) = -4.0 - 10 \\cdot 0 = -4.0$.\n  - $\\mathbf{r}_{\\text{correct}} = (-4.0, -0.9)$. $r_{\\text{correct}} = \\sqrt{(-4.0)^2 + (-0.9)^2} = \\sqrt{16.81} = 4.1 > r_c$.\n- Naive MIC:\n  - $\\Delta y_{\\text{naive}} = 1.1 - 1 \\cdot 2 = -0.9$.\n  - $\\Delta x_{\\text{naive}} = -2.0 - 10 \\cdot \\operatorname{round}(-2.0/10) = -2.0 - 10 \\cdot 0 = -2.0$.\n  - $\\mathbf{r}_{\\text{naive}} = (-2.0, -0.9)$. $r_{\\text{naive}} = \\sqrt{(-2.0)^2 + (-0.9)^2} = \\sqrt{4.81} \\approx 2.193  r_c$.\n- Here, $\\mathbf{F}_{\\text{correct}} = \\mathbf{0}$, while $\\mathbf{F}_{\\text{naive}}$ is non-zero. The error $E_3$ is the magnitude of $\\mathbf{F}_{\\text{naive}}$.\n- For $\\mathbf{r}_{\\text{naive}}$, the scalar prefactor for the force is $(48(2.193)^{-14} - 24(2.193)^{-8}) \\approx -0.044$.\n- $\\mathbf{F}_{\\text{naive}} \\approx -0.044 \\cdot (-2.0, -0.9) = (0.089, 0.040)$.\n- $E_3 = \\|\\mathbf{F}_{\\text{naive}}\\| = \\sqrt{0.089^2 + 0.040^2} \\approx 0.097$.\n\nCase 4: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 12, 9.0, 0.95, 1.55, 2.05, 2.5)$.\n- Particle positions and domain are identical to Case 2, only the shear displacement $s$ is changed from $2$ to $12$.\n- $\\mathbf{r}_{\\text{raw}} = (-7.45, 1.1)$.\n- Correct Lees-Edwards:\n  - $n_y = \\operatorname{round}(1.1/2) = 1$.\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$.\n  - $\\Delta x_{\\text{shifted}} = -7.45 - 1 \\cdot s = -7.45 - 12 = -19.45$.\n  - $\\Delta x = -19.45 - 10 \\cdot \\operatorname{round}(-19.45/10) = -19.45 - 10 \\cdot (-2) = 0.55$.\n  - $\\mathbf{r}_{\\text{correct}} = (0.55, -0.9)$, which is identical to the result in Case 2. The Lees-Edwards algorithm correctly handles the large shear by appropriately selecting the periodic image in $x$.\n- Naive MIC:\n  - The naive calculation is independent of $s$, so its result is identical to Case 2: $\\mathbf{r}_{\\text{naive}} = (2.55, -0.9)$.\n- Since both $\\mathbf{r}_{\\text{correct}}$ and $\\mathbf{r}_{\\text{naive}}$ are identical to those in Case 2, the calculated forces $\\mathbf{F}_{\\text{correct}}$ and $\\mathbf{F}_{\\text{naive}}$ are also identical.\n- Therefore, the error is the same: $E_4 = E_2 \\approx 6.925$.\nThis confirms the robustness of the Lees-Edwards algorithm. The large shear $s=12$ is equivalent to a shift of $s=2$ because the extra shift of $10$ is an integer multiple of $L_x$ and is absorbed by wrapping to a different periodic image in the $x$ direction.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates and solves the problem of calculating force errors in a 2D sheared\n    system with Lees-Edwards boundary conditions versus a naive implementation.\n    \"\"\"\n\n    def calculate_force(r_vec, r_c, epsilon=1.0, sigma=1.0):\n        \"\"\"\n        Calculates the Lennard-Jones force for a given separation vector.\n\n        Args:\n            r_vec (np.ndarray): The 2D separation vector (dx, dy).\n            r_c (float): The cutoff distance.\n            epsilon (float): The LJ energy parameter (set to 1.0 for reduced units).\n            sigma (float): The LJ length parameter (set to 1.0 for reduced units).\n\n        Returns:\n            np.ndarray: The 2D force vector.\n        \"\"\"\n        r_sq = np.dot(r_vec, r_vec)\n        r_c_sq = r_c * r_c\n        \n        if r_sq = r_c_sq:\n            return np.array([0.0, 0.0])\n\n        # Use r_sq for calculations to avoid unnecessary sqrt\n        sigma_sq = sigma * sigma\n        inv_r_sq = sigma_sq / r_sq\n        inv_r_6 = inv_r_sq * inv_r_sq * inv_r_sq\n        inv_r_12 = inv_r_6 * inv_r_6\n\n        # F = (48 * eps * (inv_r_12 / sigma^2) - 24 * eps * (inv_r_6 / sigma^2)) * r_vec\n        # In reduced units (sigma=1, eps=1), this simplifies:\n        force_magnitude_over_r_sq = 4.0 * epsilon * (12.0 * inv_r_12 - 6.0 * inv_r_6) / r_sq\n        \n        # The formula from the derivation is F = (48*r^-14 - 24*r^-8)*r_vec\n        # Let's use it directly for clarity.\n        r = np.sqrt(r_sq)\n        scalar_part = 48.0 * epsilon * (sigma**12) / (r**14) - 24.0 * epsilon * (sigma**6) / (r**8)\n        \n        return scalar_part * r_vec\n\n    def get_separation(r_i, r_j, L, s, is_naive):\n        \"\"\"\n        Computes the minimum-image separation vector.\n\n        Args:\n            r_i (np.ndarray): Position of particle i.\n            r_j (np.ndarray): Position of particle j.\n            L (np.ndarray): Box dimensions (Lx, Ly).\n            s (float): Shear displacement.\n            is_naive (bool): True for naive MIC, False for Lees-Edwards.\n\n        Returns:\n            np.ndarray: The 2D minimum-image separation vector.\n        \"\"\"\n        r_raw = r_j - r_i\n        Lx, Ly = L[0], L[1]\n\n        if is_naive:\n            # Naive MIC: independent wrapping\n            ny = np.round(r_raw[1] / Ly)\n            dy = r_raw[1] - ny * Ly\n            \n            nx = np.round(r_raw[0] / Lx)\n            dx = r_raw[0] - nx * Lx\n        else:\n            # Correct Lees-Edwards MIC\n            ny = np.round(r_raw[1] / Ly)\n            dy = r_raw[1] - ny * Ly\n            \n            dx_shifted = r_raw[0] - ny * s\n            nx = np.round(dx_shifted / Lx)\n            dx = dx_shifted - nx * Lx\n\n        return np.array([dx, dy])\n\n    # (Lx, Ly, s, xi, yi, xj, yj, rc)\n    test_cases = [\n        (10.0, 10.0, 0.0, 1.0, 1.0, 3.4, 2.0, 2.5),\n        (10.0, 2.0, 2.0, 9.0, 0.95, 1.55, 2.05, 2.5),\n        (10.0, 2.0, 2.0, 9.0, 0.95, 7.0, 2.05, 2.5),\n        (10.0, 2.0, 12.0, 9.0, 0.95, 1.55, 2.05, 2.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx, Ly, s, xi, yi, xj, yj, rc = case\n        \n        r_i = np.array([xi, yi])\n        r_j = np.array([xj, yj])\n        L = np.array([Lx, Ly])\n\n        # Calculate separation vectors\n        r_correct = get_separation(r_i, r_j, L, s, is_naive=False)\n        r_naive = get_separation(r_i, r_j, L, s, is_naive=True)\n\n        # Calculate forces\n        F_correct = calculate_force(r_correct, rc)\n        F_naive = calculate_force(r_naive, rc)\n\n        # Calculate error\n        force_diff = F_correct - F_naive\n        error = np.linalg.norm(force_diff)\n        results.append(error)\n    \n    # Format a list of floats into the required string format\n    formatted_results = [f\"{res:.8f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Simulations of molecular fluids introduce complexities not present in simple atomic systems. This advanced practice delves into a subtle but profound interaction between the SLLOD algorithm and thermostatting methods for rigid molecules . By analyzing two different thermostat schemes, you will uncover how certain choices can introduce unphysical torques, violate angular momentum conservation, and manifest as an observable antisymmetric stress tensor, a crucial consideration for accurate molecular rheology.",
            "id": "3445327",
            "problem": "Consider a two-dimensional molecular dynamics model of a rigid diatomic molecule (a dumbbell) composed of two identical atoms of mass $m$ separated by a fixed bond of length $a$, centered at the origin so that the center of mass is at position $\\mathbf{R} = \\mathbf{0}$. Let the system be subject to homogeneous simple shear characterized by the velocity gradient tensor $\\boldsymbol{\\kappa}$, where for simple shear $\\boldsymbol{\\kappa}$ has a single nonzero element $\\kappa_{xy} = \\dot{\\gamma}$, and periodicity is enforced conceptually via Lees-Edwards Boundary Conditions (LEBC). Use the streaming/peculiar decomposition and the SLLOD equations of motion as the fundamental base: for each atom $i$, the peculiar position $\\mathbf{r}_i$, peculiar momentum $\\mathbf{p}_i$, and force $\\mathbf{F}_i$ enter Newton’s second law in noninertial form, and the kinematics satisfy $\\mathrm{d}\\mathbf{r}_i/\\mathrm{d}t = \\mathbf{p}_i/m + \\boldsymbol{\\kappa}\\,\\mathbf{r}_i$. Assume the only interatomic forces are those enforcing the rigid constraint (no other potentials), and take the rigid-body representation as exact. \n\nLet the dumbbell’s orientation be given by a unit vector $\\mathbf{u} = (\\cos\\theta, \\sin\\theta)$, so that the atomic positions relative to the center of mass are $\\mathbf{r}_1 = (a/2)\\,\\mathbf{u}$ and $\\mathbf{r}_2 = -(a/2)\\,\\mathbf{u}$. Let the total center-of-mass peculiar momentum be $\\mathbf{P} = (P_x,P_y)$, and the out-of-plane angular momentum about the center of mass be $L_z$. For a two-dimensional rigid dumbbell with equal masses, the scalar moment of inertia about the center of mass is $I = m a^2/2$, and the angular velocity is $\\omega = L_z/I$. The rotational peculiar momentum of atom $i$ is $m\\,\\omega\\,\\hat{\\mathbf{z}}\\times\\mathbf{r}_i$, where $\\hat{\\mathbf{z}}$ is the unit vector normal to the plane. Thus the atomic peculiar momenta are $\\mathbf{p}_i = \\mathbf{P}/2 + m\\,\\omega\\,\\hat{\\mathbf{z}}\\times\\mathbf{r}_i$.\n\nYou will compare two thermostatting schemes under SLLOD to assess angular-momentum conservation and its consequences for measured stresses:\n\n1) A Gaussian Isokinetic Thermostat (GIK) applied per atom (henceforth “atomic GIK”), in which the thermostat multiplier $ \\alpha $ acts identically on each atomic peculiar momentum via a non-Hamiltonian term $-\\alpha\\,\\mathbf{p}_i$ in the momentum equation, chosen so that the instantaneous peculiar kinetic energy $K = \\sum_i \\mathbf{p}_i^2/(2m)$ is constant in time.\n\n2) A Gaussian Isokinetic Thermostat applied at the molecular center-of-mass only (henceforth “molecular GIK”), in which a multiplier $ \\alpha_{\\mathrm{trans}} $ acts on the total center-of-mass peculiar momentum $\\mathbf{P}$ so that the translational kinetic energy $K_{\\mathrm{trans}} = \\mathbf{P}^2/(4m)$ is constant in time; equal and parallel thermostat forces are distributed to the atoms so that the net thermostat torque about the center of mass is zero.\n\nStarting from the fundamental base consisting of: Newton’s second law, the SLLOD streaming kinematics, the rigid constraint kinematics, and the isokinetic constraints $\\mathrm{d}K/\\mathrm{d}t = 0$ (for atomic GIK) or $\\mathrm{d}K_{\\mathrm{trans}}/\\mathrm{d}t = 0$ (for molecular GIK), derive:\n\n- An expression for the instantaneous thermostat multipliers $ \\alpha $ and $ \\alpha_{\\mathrm{trans}} $ in terms of the current peculiar momenta, the shear rate $ \\dot{\\gamma} $, and the isokinetic conditions, for two-dimensional simple shear.\n\n- The resulting instantaneous net thermostat torque about the center of mass, $ M_z = \\sum_i (r_{i,x} F_{i,y} - r_{i,y} F_{i,x}) $, where $ \\mathbf{F}_i $ are the thermostat forces on atom $ i $. Use this to determine whether rotational invariants (angular momentum about the center of mass in the absence of external torques) are broken by the chosen thermostat under the given state.\n\n- The contribution of the thermostat forces to the measured Cauchy stress tensor via the Irving–Kirkwood momentum flux form at an instant, restricted here to the body-force term $ \\boldsymbol{\\sigma}^{(\\mathrm{th})} = (1/V) \\sum_i \\mathbf{r}_i \\otimes \\mathbf{F}_i $, where $ V $ is the system area in two dimensions. From this, extract the antisymmetric part quantified by $ \\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})} $ and the shear component $ \\sigma_{xy}^{(\\mathrm{th})} $. Explain how a nonzero thermostat torque density relates to an antisymmetric stress.\n\nThen implement a program that, for a prescribed set of test cases, computes the following for each case using your derived formulas:\n\n- A boolean flag indicating whether rotational invariants are broken by the thermostat under the given state, defined as “true” if $ |M_z|  \\varepsilon $ with a tolerance $ \\varepsilon = 10^{-12} $.\n\n- The antisymmetric stress contribution from the thermostat, $ S_{\\mathrm{asym}} = (\\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})}) = M_z / V $.\n\n- The thermostat contribution to the shear component, $ \\sigma_{xy}^{(\\mathrm{th})} $.\n\nUse reduced Lennard–Jones units (dimensionless) with $ m = 1 $, $ a = 1 $, and a square simulation cell of side length $L_x = L_y = 10$ so that $ V = L_x L_y = 100 $. Angles must be provided in radians. There are no other forces besides those enforcing rigidity and the thermostat forces described. All quantities are computed at a single instant from the specified initial state (no time integration required).\n\nTest Suite (each test case is a tuple consisting of $(\\dot{\\gamma}, P_x, P_y, L_z, \\theta, \\text{thermostat})$ where $\\text{thermostat} \\in \\{\\text{atomic}, \\text{molecular}, \\text{none}\\}$):\n\n- Case A (happy path with atomic GIK under shear): $(0.5, 1.0, 0.5, 0.3, \\pi/6, \\text{atomic})$.\n\n- Case B (molecular GIK comparison under same shear): $(0.5, 1.0, 0.5, 0.3, \\pi/6, \\text{molecular})$.\n\n- Case C (no shear, atomic GIK): $(0.0, 1.0, 0.5, 0.3, \\pi/6, \\text{atomic})$.\n\n- Case D (edge case with zero angular momentum): $(0.8, 0.3, -0.2, 0.0, \\pi/3, \\text{atomic})$.\n\n- Case E (edge case with zero center-of-mass momentum but finite angular momentum at $45^\\circ$): $(1.2, 0.0, 0.0, 0.4, \\pi/4, \\text{atomic})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is itself a list of three entries in the order $[\\text{broken}, S_{\\mathrm{asym}}, \\sigma_{xy}^{(\\mathrm{th})}]$, with $\\text{broken}$ reported as $1$ for true and $0$ for false. For example, a valid overall output format is $[[1,0.001,-0.0005],[0,0.0,0.0],\\dots]$. All stresses must be reported in reduced Lennard–Jones units (dimensionless).",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of non-equilibrium molecular dynamics, is well-posed with sufficient and consistent information, and requires a formal, verifiable derivation and calculation.\n\nThe task is to derive expressions for thermostat multipliers, torques, and stresses for two different thermostatting schemes under SLLOD dynamics, and then to compute these quantities for a given set of test cases.\n\nLet us begin with the necessary derivations. The system is a two-dimensional rigid dumbbell with atoms of mass $m=1$ and bond length $a=1$. The simulation volume is $V=100$.\n\nThe fundamental SLLOD equations of motion for the peculiar position $\\mathbf{r}_i$ and peculiar momentum $\\mathbf{p}_i$ of atom $i$ are:\n$$\n\\frac{\\mathrm{d}\\mathbf{r}_i}{\\mathrm{d}t} = \\frac{\\mathbf{p}_i}{m} + \\boldsymbol{\\kappa}\\mathbf{r}_i\n$$\n$$\n\\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i\n$$\nwhere $\\mathbf{F}_i^{\\text{int}}$ represents all internal forces (here, only constraint forces), $\\mathbf{F}_i^{\\text{th}}$ is the thermostat force, and $\\boldsymbol{\\kappa}$ is the velocity gradient tensor, which for simple shear in two dimensions is $\\boldsymbol{\\kappa} = \\begin{pmatrix} 0  \\dot{\\gamma} \\\\ 0  0 \\end{pmatrix}$. The term $-\\boldsymbol{\\kappa}\\mathbf{p}_i$ is the non-inertial SLLOD term. The time derivative of the total peculiar kinetic energy $K = \\sum_i \\frac{\\mathbf{p}_i^2}{2m}$ is:\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\sum_i \\frac{\\mathbf{p}_i}{m} \\cdot \\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (\\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i)\n$$\nFor a rigid body, the internal constraint forces do no work on the peculiar momenta, so $\\sum_i \\mathbf{p}_i \\cdot \\mathbf{F}_i^{\\text{int}} = 0$. The expression simplifies to:\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot \\mathbf{F}_i^{\\text{th}} - \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (\\boldsymbol{\\kappa}\\mathbf{p}_i)\n$$\nThe SLLOD term expands as $\\sum_i \\mathbf{p}_i \\cdot (\\boldsymbol{\\kappa}\\mathbf{p}_i) = \\sum_i p_{i,x}(\\dot{\\gamma}p_{i,y}) = \\dot{\\gamma}\\sum_i p_{i,x}p_{i,y}$.\n\n### 1. Derivation of Thermostat Multipliers\n\n**a) Atomic Gaussian Isokinetic Thermostat (GIK)**\n\nFor this thermostat, the force on each atom is $\\mathbf{F}_i^{\\text{th}} = -\\alpha \\mathbf{p}_i$. The isokinetic constraint is $\\frac{\\mathrm{d}K}{\\mathrm{d}t} = 0$.\nSubstituting the force into the $\\frac{\\mathrm{d}K}{\\mathrm{d}t}$ equation:\n$$\n0 = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (-\\alpha \\mathbf{p}_i) - \\frac{\\dot{\\gamma}}{m}\\sum_i p_{i,x}p_{i,y}\n$$\n$$\n0 = -\\frac{\\alpha}{m} \\sum_i \\mathbf{p}_i^2 - \\frac{\\dot{\\gamma}}{m}\\sum_i p_{i,x}p_{i,y}\n$$\nNoting that $\\sum_i \\mathbf{p}_i^2 = 2mK$, we can solve for the multiplier $\\alpha$:\n$$\n\\alpha = - \\frac{\\dot{\\gamma} \\sum_i p_{i,x}p_{i,y}}{2mK} = - \\frac{\\dot{\\gamma} \\sum_i p_{i,x}p_{i,y}}{\\sum_i \\mathbf{p}_i^2}\n$$\n\n**b) Molecular Gaussian Isokinetic Thermostat (GIK)**\n\nThis thermostat acts only on the center-of-mass (COM) peculiar momentum $\\mathbf{P} = \\sum_i \\mathbf{p}_i$. The thermostat force on each atom is $\\mathbf{F}_i^{\\text{th}} = -\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}$. The isokinetic constraint is on the translational kinetic energy $K_{\\mathrm{trans}} = \\frac{\\mathbf{P}^2}{4m}$, requiring $\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = 0$.\n\nThe time evolution of the total peculiar momentum $\\mathbf{P}$ is:\n$$\n\\frac{\\mathrm{d}\\mathbf{P}}{\\mathrm{d}t} = \\sum_i \\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\sum_i (\\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i) = \\mathbf{0} + \\sum_i \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\sum_i \\mathbf{p}_i = -\\alpha_{\\mathrm{trans}}\\mathbf{P} - \\boldsymbol{\\kappa}\\mathbf{P}\n$$\nThe time derivative of $K_{\\mathrm{trans}}$ is:\n$$\n\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{\\mathbf{P}^2}{4m}\\right) = \\frac{2\\mathbf{P} \\cdot \\dot{\\mathbf{P}}}{4m} = \\frac{\\mathbf{P}}{2m} \\cdot (-\\alpha_{\\mathrm{trans}}\\mathbf{P} - \\boldsymbol{\\kappa}\\mathbf{P}) = -\\frac{\\alpha_{\\mathrm{trans}}\\mathbf{P}^2}{2m} - \\frac{\\mathbf{P} \\cdot \\boldsymbol{\\kappa}\\mathbf{P}}{2m}\n$$\nApplying the constraint $\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = 0$ and noting that $\\mathbf{P} \\cdot \\boldsymbol{\\kappa}\\mathbf{P} = \\dot{\\gamma}P_xP_y$:\n$$\n0 = -\\frac{\\alpha_{\\mathrm{trans}}\\mathbf{P}^2}{2m} - \\frac{\\dot{\\gamma}P_xP_y}{2m}\n$$\nSolving for $\\alpha_{\\mathrm{trans}}$ (assuming $\\mathbf{P}^2 \\neq 0$):\n$$\n\\alpha_{\\mathrm{trans}} = - \\frac{\\dot{\\gamma}P_xP_y}{\\mathbf{P}^2}\n$$\n\n### 2. Derivation of Net Thermostat Torque ($M_z$)\n\nThe net thermostat torque about the COM is $M_z = \\sum_i (\\mathbf{r}_i \\times \\mathbf{F}_i^{\\text{th}})_z$.\n\n**a) Atomic GIK**\nWith $\\mathbf{F}_i^{\\text{th}} = -\\alpha \\mathbf{p}_i$:\n$$\nM_z = \\sum_i (\\mathbf{r}_i \\times (-\\alpha\\mathbf{p}_i))_z = -\\alpha \\sum_i (\\mathbf{r}_i \\times \\mathbf{p}_i)_z\n$$\nThe term $\\sum_i (\\mathbf{r}_i \\times \\mathbf{p}_i)_z$ is the definition of the angular momentum about the COM, $L_z$. Thus:\n$$\nM_z^{\\text{atomic}} = -\\alpha L_z\n$$\nSince $\\alpha$ is generally non-zero under shear ($\\dot{\\gamma} \\neq 0$), this thermostat exerts a net torque on the molecule, causing $L_z$ to change over time. Therefore, rotational invariants are broken by the atomic GIK thermostat.\n\n**b) Molecular GIK**\nWith $\\mathbf{F}_i^{\\text{th}} = -\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}$:\n$$\nM_z = \\sum_i \\left(\\mathbf{r}_i \\times \\left(-\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}\\right)\\right)_z = -\\frac{1}{2}\\alpha_{\\mathrm{trans}} \\left( \\left(\\sum_i \\mathbf{r}_i\\right) \\times \\mathbf{P} \\right)_z\n$$\nSince the COM is at the origin, $\\sum_i m_i \\mathbf{r}_i = \\mathbf{0}$. For identical masses, this implies $\\sum_i \\mathbf{r}_i = \\mathbf{0}$. Therefore:\n$$\nM_z^{\\text{molecular}} = 0\n$$\nThis thermostat is designed to be torque-free and thus conserves the molecule's angular momentum.\n\n### 3. Derivation of Thermostat Stress Contribution ($\\boldsymbol{\\sigma}^{(\\mathrm{th})}$)\n\nThe body-force contribution to the stress tensor is given by $\\boldsymbol{\\sigma}^{(\\mathrm{th})} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes \\mathbf{F}_i^{\\text{th}}$.\n\n**a) Atomic GIK**\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{atomic}} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes (-\\alpha\\mathbf{p}_i) = -\\frac{\\alpha}{V} \\sum_i \\mathbf{r}_i \\otimes \\mathbf{p}_i\n$$\nThe components of interest are:\n$$\n\\sigma_{xy}^{(\\mathrm{th})} = -\\frac{\\alpha}{V} \\sum_i r_{i,x} p_{i,y}\n\\qquad\n\\sigma_{yx}^{(\\mathrm{th})} = -\\frac{\\alpha}{V} \\sum_i r_{i,y} p_{i,x}\n$$\n\n**b) Molecular GIK**\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{molecular}} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes \\left(-\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}\\right) = -\\frac{\\alpha_{\\mathrm{trans}}}{2V} \\left(\\sum_i \\mathbf{r}_i\\right) \\otimes \\mathbf{P}\n$$\nAs $\\sum_i \\mathbf{r}_i = \\mathbf{0}$, the stress contribution is identically zero:\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{molecular}} = \\mathbf{0}\n$$\n\n**Antisymmetric Stress and Relation to Torque**\nThe antisymmetric part of the stress is $S_{\\mathrm{asym}} = \\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})}$.\n$$\nS_{\\mathrm{asym}} = \\frac{1}{V} \\sum_i (r_{i,x} F_{i,y}^{\\text{th}} - r_{i,y} F_{i,x}^{\\text{th}}) = \\frac{1}{V} \\sum_i (\\mathbf{r}_i \\times \\mathbf{F}_i^{\\text{th}})_z = \\frac{M_z}{V}\n$$\nThis demonstrates a direct correspondence between the net thermostat torque density ($M_z/V$) and the antisymmetric part of the stress tensor. In continuum mechanics, a symmetric stress tensor is a consequence of the absence of body couples (torques per unit volume). A thermostat that applies a net torque, like the atomic GIK under SLLOD, acts as a microscopic body couple, leading to an observable antisymmetric stress.\n\n### 4. Formulae for Implementation\n\nFor calculation, we express the sums in terms of the given state variables $(\\mathbf{P}, L_z, \\theta)$. Using $m=1, a=1$:\n*   The angular velocity is $\\omega = L_z/I = L_z/(ma^2/2) = 2L_z$.\n*   The atomic momenta decompose as:\n    $\\mathbf{p}_1 = \\mathbf{P}/2 + (\\-L_z \\sin\\theta, L_z \\cos\\theta)$\n    $\\mathbf{p}_2 = \\mathbf{P}/2 - (\\-L_z \\sin\\theta, L_z \\cos\\theta)$\n*   The required sums are:\n    $\\sum_i \\mathbf{p}_i^2 = \\frac{\\mathbf{P}^2}{2} + 2L_z^2$\n    $\\sum_i p_{i,x}p_{i,y} = \\frac{P_x P_y}{2} - L_z^2 \\sin(2\\theta)$\n    $\\sum_i r_{i,x} p_{i,y} = \\frac{\\cos\\theta}{2}(p_{1,y}-p_{2,y}) = \\frac{\\cos\\theta}{2}(2L_z\\cos\\theta) = L_z \\cos^2\\theta$\n\nWith these, the quantities to compute for the atomic GIK are:\n1.  $\\alpha = - \\dot{\\gamma} \\frac{P_x P_y/2 - L_z^2 \\sin(2\\theta)}{\\mathbf{P}^2/2 + 2L_z^2}$\n2.  $M_z = -\\alpha L_z$. The flag `broken` is $1$ if $|M_z|  10^{-12}$, else $0$.\n3.  $S_{\\mathrm{asym}} = M_z/V$.\n4.  $\\sigma_{xy}^{(\\mathrm{th})} = -\\frac{\\alpha}{V}\\sum_i r_{i,x} p_{i,y} = -\\frac{\\alpha L_z \\cos^2\\theta}{V} = \\frac{M_z \\cos^2\\theta}{V} = S_{\\mathrm{asym}}\\cos^2\\theta$.\n\nFor the molecular GIK and no thermostat cases, $M_z=0$, $S_{\\mathrm{asym}}=0$, and $\\sigma_{xy}^{(\\mathrm{th})}=0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the molecular dynamics thermostat problem for a series of test cases.\n    \"\"\"\n    # System parameters in reduced units\n    m = 1.0\n    a = 1.0\n    V = 100.0\n    \n    # Tolerance for checking if rotational invariants are broken\n    epsilon = 1e-12\n\n    test_cases = [\n        # (gamma_dot, Px, Py, Lz, theta, thermostat_type)\n        (0.5, 1.0, 0.5, 0.3, np.pi / 6, 'atomic'),      # Case A\n        (0.5, 1.0, 0.5, 0.3, np.pi / 6, 'molecular'),    # Case B\n        (0.0, 1.0, 0.5, 0.3, np.pi / 6, 'atomic'),      # Case C\n        (0.8, 0.3, -0.2, 0.0, np.pi / 3, 'atomic'),     # Case D\n        (1.2, 0.0, 0.0, 0.4, np.pi / 4, 'atomic'),      # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma_dot, Px, Py, Lz, theta, thermostat_type = case\n\n        # Initialize results to zero\n        broken = 0\n        S_asym = 0.0\n        sigma_xy_th = 0.0\n\n        if thermostat_type == 'atomic' and gamma_dot != 0:\n            # Calculate terms based on derived formulas\n            P_sq = Px**2 + Py**2\n            \n            # Sum of p_i^2 = P^2/2 + 2*Lz^2 for m=1\n            sum_p_sq = P_sq / 2.0 + 2.0 * Lz**2\n            \n            # Sum of p_ix * p_iy = (Px*Py)/2 - Lz^2*sin(2*theta)\n            sum_px_py = (Px * Py) / 2.0 - (Lz**2) * np.sin(2 * theta)\n            \n            # The thermostat multiplier alpha\n            # Denominator sum_p_sq cannot be zero unless the system is fully at rest.\n            if sum_p_sq == 0:\n                alpha = 0.0\n            else:\n                alpha = -gamma_dot * sum_px_py / sum_p_sq\n            \n            # Net thermostat torque M_z\n            Mz = -alpha * Lz\n            \n            # Check if rotational invariants are broken\n            if abs(Mz)  epsilon:\n                broken = 1\n            \n            # Antisymmetric stress S_asym = M_z / V\n            S_asym = Mz / V\n\n            # Shear component of thermostat stress\n            # sigma_xy_th = S_asym * cos^2(theta)\n            sigma_xy_th = S_asym * (np.cos(theta)**2)\n\n        elif thermostat_type == 'molecular':\n            # For molecular GIK, torque and stress contribution are zero by design.\n            broken = 0\n            S_asym = 0.0\n            sigma_xy_th = 0.0\n\n        elif thermostat_type == 'none':\n            # With no thermostat, there is no thermostat force, torque, or stress.\n            broken = 0\n            S_asym = 0.0\n            sigma_xy_th = 0.0\n\n        results.append([broken, S_asym, sigma_xy_th])\n    \n    # Format the final output string as specified\n    # The str() of a list is its string representation, e.g., '[1, 0.1, 0.2]'\n    # We join these string representations with a comma.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}