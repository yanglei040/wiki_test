{
    "hands_on_practices": [
        {
            "introduction": "Before embarking on complex computational analysis, it is essential to build a solid foundation by verifying the fundamentals. This first practice serves as a critical sanity check on the Green-Kubo relation for shear viscosity. By performing a dimensional analysis, you will confirm that this celebrated formula, which connects microscopic stress fluctuations to a macroscopic transport coefficient, is physically consistent. ",
            "id": "3445650",
            "problem": "Consider a homogeneous equilibrium fluid in three spatial dimensions, simulated by Molecular Dynamics (MD). Let $P_{xy}(t)$ denote the $xy$-component of the microscopic stress tensor (also called the microscopic pressure tensor) at time $t$, and let $\\langle \\cdot \\rangle$ denote an equilibrium ensemble average. The Green–Kubo expression for the shear viscosity relates the shear viscosity $\\eta$ to an equilibrium time-correlation function of $P_{xy}(t)$ via an expression of the form\n$$\n\\eta \\;=\\; \\frac{V}{k_{B} T} \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt,\n$$\nwhere $V$ is the system volume, $T$ is the absolute temperature, and $k_{B}$ is the Boltzmann constant. Assume that $P_{xy}$ has the dimensions of pressure, and that the autocorrelation function $\\langle P_{xy}(0)\\,P_{xy}(t)\\rangle$ inherits the product dimensions of its factors. Using only the following fundamental bases and definitions:\n- Newton’s second law implies force has dimensions $M L T^{-2}$.\n- Pressure is force per area.\n- Energy is force times length.\n- The product $k_{B}T$ has the dimensions of energy.\n- Volume has dimensions $L^{3}$.\n- Time integration contributes a factor with the dimensions of time.\nverify by dimensional analysis that $\\eta$ indeed has the dimensions of a shear viscosity. Express your final result as a product of base dimensions $M$, $L$, and $T$, using powers to indicate exponents. Do not use named units. Provide your final answer as a single analytic expression in terms of $M$, $L$, and $T$ only.",
            "solution": "The problem requires a dimensional analysis of the Green–Kubo expression for shear viscosity, $\\eta$, to verify its dimensional correctness. The given expression is:\n$$\n\\eta = \\frac{V}{k_{B} T} \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt\n$$\nLet $[Q]$ denote the dimensions of a physical quantity $Q$. Our goal is to determine $[\\eta]$ in terms of the base dimensions of mass ($M$), length ($L$), and time ($T$). The dimensional equation corresponding to the given formula is:\n$$\n[\\eta] = \\frac{[V]}{[k_{B} T]} \\left[ \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt \\right]\n$$\nWe will determine the dimensions of each term on the right-hand side based on the provided definitions.\n\n1.  **Dimensions of Volume, $[V]$**:\n    The problem states that volume has dimensions $L^3$.\n    $$\n    [V] = L^{3}\n    $$\n\n2.  **Dimensions of Thermal Energy, $[k_{B}T]$**:\n    The problem states that the product $k_{B}T$ has the dimensions of energy. It also states that energy is force times length, and force has dimensions $M L T^{-2}$.\n    $$\n    [\\text{Force}] = M L T^{-2}\n    $$\n    $$\n    [\\text{Energy}] = [\\text{Force}] \\times [\\text{Length}] = (M L T^{-2}) \\times L = M L^{2} T^{-2}\n    $$\n    Therefore, the dimensions of $k_{B}T$ are:\n    $$\n    [k_{B}T] = M L^{2} T^{-2}\n    $$\n\n3.  **Dimensions of the Time Integral**:\n    The dimensions of the integral term are the product of the dimensions of the integrand, $\\langle P_{xy}(0)\\,P_{xy}(t)\\rangle$, and the dimensions of the differential element, $dt$, which is time.\n    $$\n    \\left[ \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt \\right] = [\\langle P_{xy}(0)\\,P_{xy}(t)\\rangle] \\times [t]\n    $$\n    First, we need the dimensions of the stress tensor component, $P_{xy}$. The problem states that $P_{xy}$ has the dimensions of pressure, and pressure is defined as force per area. Area has dimensions $L^2$.\n    $$\n    [\\text{Pressure}] = \\frac{[\\text{Force}]}{[\\text{Area}]} = \\frac{M L T^{-2}}{L^{2}} = M L^{-1} T^{-2}\n    $$\n    Thus, $[P_{xy}] = M L^{-1} T^{-2}$. The problem specifies that the autocorrelation function $\\langle P_{xy}(0)\\,P_{xy}(t)\\rangle$ inherits the product dimensions of its factors.\n    $$\n    [\\langle P_{xy}(0)\\,P_{xy}(t)\\rangle] = [P_{xy}(0)] \\times [P_{xy}(t)] = [P_{xy}]^2 = (M L^{-1} T^{-2})^{2} = M^{2} L^{-2} T^{-4}\n    $$\n    The integration over time contributes a factor with the dimensions of time, $T$.\n    $$\n    \\left[ \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt \\right] = (M^{2} L^{-2} T^{-4}) \\times T = M^{2} L^{-2} T^{-3}\n    $$\n\n4.  **Assembling the Dimensions of $\\eta$**:\n    Now we substitute the dimensions of each component back into the dimensional equation for $\\eta$.\n    $$\n    [\\eta] = \\frac{[V]}{[k_{B} T]} \\left[ \\int_{0}^{\\infty} \\langle P_{xy}(0)\\,P_{xy}(t)\\rangle \\, dt \\right] = \\frac{L^{3}}{M L^{2} T^{-2}} \\times (M^{2} L^{-2} T^{-3})\n    $$\n    We simplify this expression by combining the powers of $M$, $L$, and $T$. First, let's simplify the fraction.\n    $$\n    \\frac{L^{3}}{M L^{2} T^{-2}} = M^{-1} L^{3-2} T^{2} = M^{-1} L^{1} T^{2}\n    $$\n    Now, multiply this by the dimensions of the integral part.\n    $$\n    [\\eta] = (M^{-1} L^{1} T^{2}) \\times (M^{2} L^{-2} T^{-3})\n    $$\n    Combining the exponents for each base dimension:\n    -   For mass, $M$: $M^{-1+2} = M^{1}$\n    -   For length, $L$: $L^{1-2} = L^{-1}$\n    -   For time, $T$: $T^{2-3} = T^{-1}$\n    So, the resulting dimensions for $\\eta$ are:\n    $$\n    [\\eta] = M L^{-1} T^{-1}\n    $$\n\nTo verify that these are indeed the dimensions of shear viscosity, we can recall the defining constitutive relation for a Newtonian fluid, where shear stress $\\tau_{xy}$ is proportional to the shear rate $\\partial v_{x} / \\partial y$.\n$$\n\\tau_{xy} = \\eta \\frac{\\partial v_{x}}{\\partial y}\n$$\nThe shear stress $\\tau_{xy}$ has dimensions of pressure, so $[\\tau_{xy}] = M L^{-1} T^{-2}$. The shear rate has dimensions of velocity ($L T^{-1}$) divided by length ($L$), so $[\\partial v_{x} / \\partial y] = (L T^{-1}) / L = T^{-1}$. From this definition, the dimensions of viscosity are:\n$$\n[\\eta] = \\frac{[\\tau_{xy}]}{[\\partial v_{x}/\\partial y]} = \\frac{M L^{-1} T^{-2}}{T^{-1}} = M L^{-1} T^{-1}\n$$\nThis result matches the one derived from the Green–Kubo formula, thus verifying the dimensional consistency of the expression. The final result expressed as a product of base dimensions is $M L^{-1} T^{-1}$.",
            "answer": "$$ \\boxed{M L^{-1} T^{-1}} $$"
        },
        {
            "introduction": "This exercise bridges the gap between the abstract theory of the stress tensor and the concrete data produced by molecular dynamics simulations. You will first reconcile the common practice of reporting per-atom virial quantities in units of energy with the macroscopic definition of stress in units of pressure. Using this understanding, you will then calculate the shear viscosity from a simplified model of the stress autocorrelation function, completing the path from simulation output to a macroscopic transport property. ",
            "id": "3445590",
            "problem": "A classical atomistic fluid of $N$ particles is simulated with Molecular Dynamics (MD) in a cubic periodic box of side length $L=6.0 \\,\\mathrm{nm}$ at temperature $T=300 \\,\\mathrm{K}$. The MD code reports a per-atom symmetric stress contribution $s_i^{\\alpha\\beta}(t)$ defined so that the extensive summed quantity $S^{\\alpha\\beta}(t) \\equiv \\sum_{i=1}^{N} s_i^{\\alpha\\beta}(t)$ satisfies $S^{\\alpha\\beta}(t) = - V \\,\\sigma^{\\alpha\\beta}(t)$, where $V=L^3$ and $\\sigma^{\\alpha\\beta}(t)$ is the instantaneous Cauchy stress tensor component. The per-atom quantity $s_i^{\\alpha\\beta}(t)$ includes both kinetic and virial (force-position) contributions and is reported in Joules. You may assume the Irving–Kirkwood microscopic momentum-flux operator and standard classical mechanics.\n\n1. Starting from the microscopic momentum-flux representation of stress and the Irving–Kirkwood decomposition into kinetic $m_i v_i^{\\alpha} v_i^{\\beta}$ and configurational $r_{ij}^{\\alpha} f_{ij}^{\\beta}$ contributions, justify the code’s convention $S^{\\alpha\\beta}(t) = - V \\,\\sigma^{\\alpha\\beta}(t)$ by demonstrating that (i) the summed per-atom quantity $S^{\\alpha\\beta}(t)$ has units of energy and (ii) dividing $-S^{\\alpha\\beta}(t)$ by the volume $V$ recovers a stress with units of pressure and the correct magnitude.\n\n2. In equilibrium, the Green–Kubo (GK) fluctuation–dissipation relation connects the shear viscosity $\\eta$ to the time integral of an equilibrium shear stress autocorrelation function. Let $C_{S}(t) \\equiv \\langle S^{xy}(t)\\,S^{xy}(0)\\rangle$ denote the autocorrelation of the summed per-atom quantity for the $xy$ component, measured by the MD code, and suppose that $C_{S}(t)$ is well fit by a single-exponential form\n$$\nC_{S}(t) = C_{0}\\,\\exp\\!\\left(-\\frac{t}{\\tau}\\right),\n$$\nwith $C_{0} = 4.80 \\times 10^{-37}\\,\\mathrm{J}^2$ and $\\tau = 2.10\\,\\mathrm{ps}$. Using the fluctuation–dissipation connection and your reconciliation from part 1, derive an expression for $\\eta$ in terms of $C_{0}$, $\\tau$, $k_{B}$, $T$, and $V$, and then evaluate it numerically for the parameters above. Round your final numerical result to three significant figures and express the viscosity in millipascal–second (mPa·s).",
            "solution": "This problem is divided into two parts. The first part requires a justification of a convention used in a Molecular Dynamics (MD) code for the stress tensor. The second part asks for the calculation of the shear viscosity using the Green-Kubo relation and data from the simulation.\n\nPart 1: Justification of the Stress Tensor Convention\n\nThe instantaneous microscopic stress tensor, $\\sigma^{\\alpha\\beta}(t)$, in a volume $V$ containing $N$ particles is given by the Irving–Kirkwood formula, which is derived from the conservation of momentum on a microscopic level. For a system of particles interacting via pairwise forces, the expression is:\n$$\n\\sigma^{\\alpha\\beta}(t) = -\\frac{1}{V} \\left( \\sum_{i=1}^{N} m_i v_i^{\\alpha}(t) v_i^{\\beta}(t) + \\frac{1}{2} \\sum_{i \\neq j} r_{ij}^{\\alpha}(t) f_{ij}^{\\beta}(t) \\right)\n$$\nHere, $m_i$ is the mass of particle $i$, $v_i^{\\alpha}$ is the $\\alpha$-component of its velocity, $r_{ij}^{\\alpha}$ is the $\\alpha$-component of the separation vector $\\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i$, and $f_{ij}^{\\beta}$ is the $\\beta$-component of the force exerted on particle $i$ by particle $j$. The first sum is the kinetic contribution, and the second sum is the virial or configurational contribution. We assume the system has zero average (stream) velocity, so particle velocities $\\mathbf{v}_i$ can be used directly.\n\nThe problem states that the MD code uses a convention $S^{\\alpha\\beta}(t) = -V \\sigma^{\\alpha\\beta}(t)$, where $S^{\\alpha\\beta}(t)$ is an extensive quantity. Let's substitute the expression for $\\sigma^{\\alpha\\beta}(t)$ into this convention:\n$$\nS^{\\alpha\\beta}(t) = -V \\left[ -\\frac{1}{V} \\left( \\sum_{i=1}^{N} m_i v_i^{\\alpha}(t) v_i^{\\beta}(t) + \\frac{1}{2} \\sum_{i \\neq j} r_{ij}^{\\alpha}(t) f_{ij}^{\\beta}(t) \\right) \\right]\n$$\nThis simplifies to:\n$$\nS^{\\alpha\\beta}(t) = \\sum_{i=1}^{N} m_i v_i^{\\alpha}(t) v_i^{\\beta}(t) + \\frac{1}{2} \\sum_{i \\neq j} r_{ij}^{\\alpha}(t) f_{ij}^{\\beta}(t)\n$$\nThis quantity $S^{\\alpha\\beta}(t)$ is what many MD codes compute. It is also stated that $S^{\\alpha\\beta}(t)$ is a sum of per-atom contributions, $S^{\\alpha\\beta}(t) = \\sum_{i=1}^{N} s_i^{\\alpha\\beta}(t)$. This is achieved by partitioning the pair-wise virial term among the individual atoms. A standard way to do this is to define the per-atom quantity $s_i^{\\alpha\\beta}(t)$ as:\n$$\ns_i^{\\alpha\\beta}(t) = m_i v_i^{\\alpha}(t) v_i^{\\beta}(t) + \\frac{1}{2} \\sum_{j \\neq i} r_{ij}^{\\alpha}(t) f_{ij}^{\\beta}(t)\n$$\n\nNow we address the two points required for the justification.\n\n(i) The units of $S^{\\alpha\\beta}(t)$.\nThe quantity $S^{\\alpha\\beta}(t)$ is a sum of a kinetic term and a virial term. Let's analyze the physical dimensions (units) of each.\nThe kinetic term has units of mass $\\times$ (velocity)$^{2}$:\n$$\n[\\text{Kinetic Term}] = \\mathrm{M} \\cdot \\left(\\frac{\\mathrm{L}}{\\mathrm{T}}\\right)^2 = \\frac{\\mathrm{ML}^2}{\\mathrm{T}^2}\n$$\nIn SI units, this is $\\mathrm{kg} \\cdot (\\mathrm{m}/\\mathrm{s})^2 = \\mathrm{kg} \\cdot \\mathrm{m}^2/\\mathrm{s}^2$, which are Joules ($\\mathrm{J}$), the unit of energy.\n\nThe virial term has units of distance $\\times$ force:\n$$\n[\\text{Virial Term}] = \\mathrm{L} \\cdot \\mathrm{F} = \\mathrm{L} \\cdot \\left(\\frac{\\mathrm{ML}}{\\mathrm{T}^2}\\right) = \\frac{\\mathrm{ML}^2}{\\mathrm{T}^2}\n$$\nIn SI units, this is $\\mathrm{m} \\cdot \\mathrm{N} = \\mathrm{m} \\cdot (\\mathrm{kg} \\cdot \\mathrm{m}/\\mathrm{s}^2) = \\mathrm{kg} \\cdot \\mathrm{m}^2/\\mathrm{s}^2$, which are also Joules ($\\mathrm{J}$).\n\nSince both contributions to $S^{\\alpha\\beta}(t)$ have units of energy, the total quantity $S^{\\alpha\\beta}(t)$ has units of energy. This is consistent with the problem statement that the per-atom contribution $s_i^{\\alpha\\beta}(t)$ is reported in Joules.\n\n(ii) Recovering stress from $-S^{\\alpha\\beta}(t)/V$.\nAccording to the given convention, the Cauchy stress tensor is obtained by $\\sigma^{\\alpha\\beta}(t) = -S^{\\alpha\\beta}(t)/V$. To show that this recovers a stress, we check the units.\n$$\n[\\sigma^{\\alpha\\beta}] = \\frac{[S^{\\alpha\\beta}]}{[V]} = \\frac{[\\text{Energy}]}{[\\text{Volume}]} = \\frac{\\mathrm{ML}^2/\\mathrm{T}^2}{\\mathrm{L}^3} = \\frac{\\mathrm{M}}{\\mathrm{LT}^2}\n$$\nIn SI units, this is $\\mathrm{J}/\\mathrm{m}^3 = (\\mathrm{N} \\cdot \\mathrm{m})/\\mathrm{m}^3 = \\mathrm{N}/\\mathrm{m}^2$, which are Pascals ($\\mathrm{Pa}$), the unit of pressure and stress.\nThe \"correct magnitude\" is guaranteed by the fact that the Irving–Kirkwood formula is the correct microscopic expression for the macroscopic Cauchy stress tensor, derived from the fundamental principle of momentum conservation. The quantity $S^{\\alpha\\beta}(t)$ is precisely the extensive part of the momentum flux expression, so dividing it by volume (and including the conventional negative sign) yields the stress tensor. The convention $S^{\\alpha\\beta}(t) = -V\\sigma^{\\alpha\\beta}(t)$ is therefore physically sound and commonly used in molecular simulations.\n\nPart 2: Calculation of Shear Viscosity $\\eta$\n\nThe shear viscosity $\\eta$ is a transport coefficient that can be calculated from equilibrium fluctuations of the stress tensor using the Green–Kubo formula. The formula connects $\\eta$ to the time integral of the autocorrelation function of an off-diagonal component of the stress tensor. There are several equivalent forms of this relation. A common one is:\n$$\n\\eta = \\frac{1}{V k_B T} \\int_0^{\\infty} \\langle S^{xy}(t) S^{xy}(0) \\rangle \\, dt\n$$\nwhere $k_B$ is the Boltzmann constant and $T$ is the absolute temperature. The angled brackets $\\langle \\dots \\rangle$ denote an ensemble average, which in an ergodic system is equal to a time average. The quantity $\\langle S^{xy}(t) S^{xy}(0) \\rangle$ is the stress autocorrelation function for the $xy$-component, which the problem denotes as $C_S(t)$.\n\nThe problem provides a single-exponential fit for this correlation function:\n$$\nC_S(t) = \\langle S^{xy}(t) S^{xy}(0) \\rangle = C_0 \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\nSubstituting this into the Green-Kubo formula, we get:\n$$\n\\eta = \\frac{1}{V k_B T} \\int_0^{\\infty} C_0 \\exp\\left(-\\frac{t}{\\tau}\\right) \\, dt\n$$\nThe integral can be evaluated analytically:\n$$\n\\int_0^{\\infty} C_0 \\exp\\left(-\\frac{t}{\\tau}\\right) \\, dt = C_0 \\left[ -\\tau \\exp\\left(-\\frac{t}{\\tau}\\right) \\right]_0^{\\infty} = C_0 \\left( -\\tau \\cdot 0 - (-\\tau \\cdot 1) \\right) = C_0 \\tau\n$$\nSubstituting this result back, we obtain the expression for $\\eta$ in terms of the given parameters:\n$$\n\\eta = \\frac{C_0 \\tau}{V k_B T}\n$$\nNow we can evaluate this expression numerically. The given parameters are:\n$C_0 = 4.80 \\times 10^{-37}\\,\\mathrm{J}^2$\n$\\tau = 2.10\\,\\mathrm{ps} = 2.10 \\times 10^{-12}\\,\\mathrm{s}$\n$T = 300\\,\\mathrm{K}$\n$L = 6.0\\,\\mathrm{nm} = 6.0 \\times 10^{-9}\\,\\mathrm{m}$\nThe volume of the simulation box is $V = L^3 = (6.0 \\times 10^{-9}\\,\\mathrm{m})^3 = 216 \\times 10^{-27}\\,\\mathrm{m}^3 = 2.16 \\times 10^{-25}\\,\\mathrm{m}^3$.\nThe Boltzmann constant is $k_B \\approx 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$.\n\nFirst, let's calculate the numerator, $C_0 \\tau$:\n$$\nC_0 \\tau = (4.80 \\times 10^{-37}\\,\\mathrm{J}^2) \\times (2.10 \\times 10^{-12}\\,\\mathrm{s}) = 1.008 \\times 10^{-48}\\,\\mathrm{J}^2 \\cdot \\mathrm{s}\n$$\nNext, we calculate the denominator, $V k_B T$:\n$$\nk_B T = (1.380649 \\times 10^{-23}\\,\\mathrm{J/K}) \\times (300\\,\\mathrm{K}) \\approx 4.141947 \\times 10^{-21}\\,\\mathrm{J}\n$$\n$$\nV k_B T = (2.16 \\times 10^{-25}\\,\\mathrm{m}^3) \\times (4.141947 \\times 10^{-21}\\,\\mathrm{J}) \\approx 8.9466055 \\times 10^{-46}\\,\\mathrm{J} \\cdot \\mathrm{m}^3\n$$\nNow, we compute the viscosity $\\eta$:\n$$\n\\eta = \\frac{1.008 \\times 10^{-48}\\,\\mathrm{J}^2 \\cdot \\mathrm{s}}{8.9466055 \\times 10^{-46}\\,\\mathrm{J} \\cdot \\mathrm{m}^3} \\approx 1.12669 \\times 10^{-3}\\,\\frac{\\mathrm{J} \\cdot \\mathrm{s}}{\\mathrm{m}^3}\n$$\nThe units are $\\mathrm{J} \\cdot \\mathrm{s} / \\mathrm{m}^3 = (\\mathrm{N} \\cdot \\mathrm{m} \\cdot \\mathrm{s}) / \\mathrm{m}^3 = \\mathrm{N} \\cdot \\mathrm{s} / \\mathrm{m}^2 = \\mathrm{Pa} \\cdot \\mathrm{s}$, which are the correct SI units for dynamic viscosity.\n\nThe problem asks for the result in millipascal-seconds ($\\mathrm{mPa} \\cdot \\mathrm{s}$). The conversion is $1\\,\\mathrm{Pa} \\cdot \\mathrm{s} = 1000\\,\\mathrm{mPa} \\cdot \\mathrm{s}$.\n$$\n\\eta \\approx (1.12669 \\times 10^{-3}\\,\\mathrm{Pa} \\cdot \\mathrm{s}) \\times \\left(\\frac{1000\\,\\mathrm{mPa} \\cdot \\mathrm{s}}{1\\,\\mathrm{Pa} \\cdot \\mathrm{s}}\\right) \\approx 1.12669\\,\\mathrm{mPa} \\cdot \\mathrm{s}\n$$\nFinally, we round the result to three significant figures:\n$$\n\\eta \\approx 1.13\\,\\mathrm{mPa} \\cdot \\mathrm{s}\n$$\nThis value is physically reasonable, for example, it is close to the viscosity of water at room temperature (approximately $0.89\\,\\mathrm{mPa} \\cdot \\mathrm{s}$).",
            "answer": "$$\n\\boxed{1.13}\n$$"
        },
        {
            "introduction": "A key challenge in molecular dynamics is overcoming the limitations of simulating finite-sized systems to predict the properties of macroscopic matter. This advanced practice tackles the systematic errors arising from finite-size effects on viscosity. You will learn to apply hydrodynamically-motivated scaling models to extrapolate simulation results from various system sizes to the infinite-system limit, a crucial technique for producing research-grade transport coefficients. ",
            "id": "3445656",
            "problem": "Consider a periodic, classical many-particle system simulated via equilibrium molecular dynamics, obeying Newton’s equations of motion. The shear viscosity $\\eta$ may be computed in reduced units through the time integral of an equilibrium stress autocorrelation (the Green–Kubo relation), which can be written generically as $\\eta = \\frac{V}{k_{\\mathrm{B}} T} \\int_{0}^{\\infty} C_{P_{xy}}(t) \\, dt$, where $V$ is the system volume, $T$ is the absolute temperature, $k_{\\mathrm{B}}$ is the Boltzmann constant, $P_{xy}$ is the off-diagonal component of the microscopic stress tensor, and $C_{P_{xy}}(t)$ is the equilibrium autocorrelation function of $P_{xy}$. Due to finite-size effects in a periodic box of linear size $L$, hydrodynamic fluctuations and long-wavelength modes modify the measured $\\hat{\\eta}(L)$ away from its infinite-size limit $\\eta_{\\infty}$. Theoretical hydrodynamics constrains the leading finite-size corrections, with different asymptotic forms in two dimensions and three dimensions, and motivates testing specific scaling ansätze against data to extract $\\eta_{\\infty}$.\n\nYour task is to write a program that, given a small test suite of system sizes $L$, measured shear viscosities $\\hat{\\eta}(L)$ with known standard deviations $\\sigma(L)$ (reflecting sampling uncertainty of the Green–Kubo integral), and the nominal spatial dimensionality $d$, performs controlled extrapolation to estimate the infinite-size shear viscosity $\\eta_{\\infty}$ in reduced, dimensionless units. The extrapolation must be based on weighted nonlinear least squares fits (using the reported $\\sigma(L)$) to hydrodynamically motivated candidate models, and a model selection criterion must be used to choose the most appropriate scaling form before reporting $\\eta_{\\infty}$.\n\nYou must base your reasoning on fundamental principles that are appropriate to molecular dynamics and continuum hydrodynamics: Newtonian microdynamics leading to equilibrium time correlations, the Green–Kubo relation for transport coefficients, and the existence of hydrodynamic modes and long-time tails that create finite-size corrections. From this base, implement a robust algorithm to fit and compare the following candidate finite-size scaling models:\n\n- Three-dimensional candidate model: $\\eta(L) = \\eta_{\\infty} \\left( 1 + \\frac{A}{L} \\right)$, with amplitude $A$ to be determined from the data.\n- Two-dimensional candidate model: $\\eta(L) = \\eta_{\\infty} \\left( 1 + \\frac{A_{\\log} \\ln(L/L_{0})}{L} \\right)$, with amplitude $A_{\\log}$ to be determined from the data and $L_{0} = 1$ (so that the logarithm argument is dimensionless).\n- Baseline constant model (for comparison and to capture the large-$L$ regime if corrections are negligible): $\\eta(L) = \\eta_{\\infty}$.\n\nYou must implement weighted nonlinear least squares fits with the provided $\\sigma(L)$ as standard deviations, and you must select the model using the Akaike Information Criterion (AIC) suitable for Gaussian errors with known variances. Treat the AIC up to an additive constant by defining $\\,\\mathrm{AIC} = 2k + \\sum_{i} \\left( \\frac{r_{i}}{\\sigma_{i}} \\right)^{2} \\,$, where $k$ is the number of fitted parameters and $r_{i}$ are residuals of the fit. For each test case, apply only physically relevant hydrodynamic models for its dimension $d$ together with the baseline constant model, compute the AIC for each, choose the lowest-AIC model, and report the corresponding $\\eta_{\\infty}$ estimate. For clarity: for $d = 3$, compare the three-dimensional candidate model against the baseline; for $d = 2$, compare the two-dimensional candidate model against the baseline.\n\nExpress the final result $\\eta_{\\infty}$ in reduced, dimensionless units (no unit), rounded to six decimal places.\n\nTest Suite:\nProvide the following four test cases to your program. Each test case is a tuple of dimensionality $d$, sizes $L$, measured values $\\hat{\\eta}(L)$, and standard deviations $\\sigma(L)$. All arrays are ordered lists aligned by index.\n\n- Test Case $1$ (three-dimensional, general “happy path”):\n  - $d = 3$,\n  - $L = [10, 20, 40, 80, 160]$,\n  - $\\hat{\\eta}(L) = [3.52, 2.99, 2.765, 2.62, 2.5625]$,\n  - $\\sigma(L) = [0.02, 0.02, 0.015, 0.015, 0.01]$.\n- Test Case $2$ (two-dimensional, logarithmic correction regime):\n  - $d = 2$,\n  - $L = [10, 20, 40, 80, 160]$,\n  - $\\hat{\\eta}(L) = [2.0189306, 1.75423181, 1.526999151, 1.397191199, 1.324191411]$,\n  - $\\sigma(L) = [0.02, 0.02, 0.015, 0.015, 0.01]$.\n- Test Case $3$ (three-dimensional, small-size boundary case with exact values):\n  - $d = 3$,\n  - $L = [5, 8, 12]$,\n  - $\\hat{\\eta}(L) = [3.0, 2.25, 1.8333333333]$,\n  - $\\sigma(L) = [0.05, 0.03, 0.02]$.\n- Test Case $4$ (two-dimensional, large sizes with weak corrections—model ambiguity challenge):\n  - $d = 2$,\n  - $L = [20, 40, 80, 160, 320]$,\n  - $\\hat{\\eta}(L) = [1.929807953, 1.886999788, 1.850297800, 1.830547853, 1.816223403]$,\n  - $\\sigma(L) = [0.02, 0.015, 0.015, 0.01, 0.01]$.\n\nAlgorithmic Requirements:\n- Implement weighted nonlinear least squares for each candidate model and compute parameter estimates and residuals.\n- Compute the Akaike Information Criterion as defined above and select the lowest-AIC model among those relevant to the specified dimension $d$ and the baseline constant model.\n- Extract $\\eta_{\\infty}$ from the selected model and round to six decimal places.\n\nFinal Output Format:\nYour program should produce a single line of output containing the four estimated infinite-size viscosities as a comma-separated list enclosed in square brackets, in the order of the test cases, with each value rounded to six decimal places. For example, output of the form $[\\eta_{\\infty,1},\\eta_{\\infty,2},\\eta_{\\infty,3},\\eta_{\\infty,4}]$ is required, where each entry is a float rounded to six decimal places.",
            "solution": "The problem requires the estimation of the infinite-size shear viscosity, $\\eta_{\\infty}$, from a series of equilibrium molecular dynamics simulations performed on systems of varying finite size, $L$. This is a standard procedure in computational statistical mechanics, grounded in the principles of linear response theory and hydrodynamics.\n\nThe starting point is the Green-Kubo relation for shear viscosity, $\\eta$, which connects a macroscopic transport coefficient to the time integral of an equilibrium time correlation function of a microscopic flux. In this case, the flux is the off-diagonal component of the stress tensor, $P_{xy}$. The relation is given by:\n$$ \\eta = \\frac{V}{k_{\\mathrm{B}} T} \\int_{0}^{\\infty} C_{P_{xy}}(t) \\, dt $$\nwhere $V$ is the system volume, $T$ is the temperature, $k_{\\mathrm{B}}$ is the Boltzmann constant, and $C_{P_{xy}}(t) = \\langle P_{xy}(t) P_{xy}(0) \\rangle$ is the stress autocorrelation function.\n\nIn a computer simulation of a periodic system with linear dimension $L$, the integral is evaluated numerically, yielding a size-dependent estimate, $\\hat{\\eta}(L)$. The finite size of the simulation box introduces systematic errors because the periodic boundary conditions artificially cut off long-wavelength fluctuations. Hydrodynamic theory predicts the leading-order correction to the viscosity. The form of this correction depends on the spatial dimensionality, $d$, of the system.\nFor a three-dimensional system ($d=3$), the leading correction is known to scale as $1/L$. This motivates the following scaling ansatz for fitting the simulation data:\n$$ \\eta(L) = \\eta_{\\infty} \\left( 1 + \\frac{A}{L} \\right) $$\nwhere $\\eta_{\\infty}$ is the desired infinite-system viscosity and $A$ is a non-universal amplitude.\n\nFor a two-dimensional system ($d=2$), the correction is more complex, involving a logarithmic term, and is given by:\n$$ \\eta(L) = \\eta_{\\infty} \\left( 1 + \\frac{A_{\\log} \\ln(L/L_{0})}{L} \\right) $$\nHere, $A_{\\log}$ is the corresponding amplitude and $L_{0}$ is a reference length, which is set to $L_{0}=1$ in reduced units as specified.\n\nTo determine the best estimate for $\\eta_{\\infty}$, we fit these theoretically motivated models to the provided data $(\\{L_i\\}, \\{\\hat{\\eta}(L_i)\\})$. Since the measurements $\\hat{\\eta}(L_i)$ have associated uncertainties $\\sigma_i$, a weighted nonlinear least squares procedure is the appropriate statistical method. This method seeks to find the set of model parameters $\\mathbf{p}$ (e.g., $\\mathbf{p} = [\\eta_{\\infty}, A]$) that minimizes the chi-squared statistic, $\\chi^2$:\n$$ \\chi^2(\\mathbf{p}) = \\sum_{i} \\left( \\frac{\\hat{\\eta}(L_i) - \\eta(L_i; \\mathbf{p})}{\\sigma_i} \\right)^2 $$\nThe weight for each data point is $w_i = 1/\\sigma_i^2$, giving more importance to more precise measurements.\n\nThe problem presents a choice between a model with finite-size corrections and a simpler, baseline constant model, $\\eta(L) = \\eta_{\\infty}$. The constant model corresponds to the case where finite-size effects are negligible within the range of $L$ and the statistical uncertainty. Choosing between models of differing complexity (i.e., different numbers of fitting parameters) requires a formal model selection criterion to avoid overfitting. The Akaike Information Criterion (AIC) provides such a framework. As specified, we use the form:\n$$ \\mathrm{AIC} = 2k + \\chi^2_{\\text{min}} $$\nwhere $k$ is the number of free parameters in the model and $\\chi^2_{\\text{min}}$ is the minimum value of $\\chi^2$ achieved by the fit. The term $2k$ penalizes model complexity. The model with the lower AIC is considered a better description of the data, providing a more parsimonious balance between goodness of fit and simplicity. The baseline constant model has $k=1$ (for $\\eta_{\\infty}$), while the 3D and 2D scaling models have $k=2$ (for $\\eta_{\\infty}$ and the amplitude $A$ or $A_{\\log}$).\n\nThe algorithm for each test case is as follows:\n1. Identify the system dimensionality $d$.\n2. Select the set of candidate models: the baseline constant model and the appropriate hydrodynamic model for dimension $d$.\n3. For each candidate model:\n    a. Perform a weighted nonlinear least squares fit to the data $(\\{L_i\\}, \\{\\hat{\\eta}(L_i)\\}, \\{\\sigma_i\\})$ to find the optimal parameters and the corresponding minimum chi-squared value, $\\chi^2_{\\text{min}}$.\n    b. Calculate the AIC using the formula $\\mathrm{AIC} = 2k + \\chi^2_{\\text{min}}$.\n4. Compare the AIC values of the candidate models.\n5. Choose the model that yields the minimum AIC.\n6. The final estimate for the infinite-size viscosity is the value of $\\eta_{\\infty}$ obtained from the selected model. This value is then rounded to six decimal places as required.\n\nThis procedure is applied to each of the four test cases provided.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves for the infinite-size shear viscosity by fitting finite-size data\n    to hydrodynamic models and using AIC for model selection.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"d\": 3,\n            \"L\": np.array([10, 20, 40, 80, 160]),\n            \"eta_hat\": np.array([3.52, 2.99, 2.765, 2.62, 2.5625]),\n            \"sigma\": np.array([0.02, 0.02, 0.015, 0.015, 0.01]),\n        },\n        {\n            \"d\": 2,\n            \"L\": np.array([10, 20, 40, 80, 160]),\n            \"eta_hat\": np.array([2.0189306, 1.75423181, 1.526999151, 1.397191199, 1.324191411]),\n            \"sigma\": np.array([0.02, 0.02, 0.015, 0.015, 0.01]),\n        },\n        {\n            \"d\": 3,\n            \"L\": np.array([5, 8, 12]),\n            \"eta_hat\": np.array([3.0, 2.25, 1.8333333333]),\n            \"sigma\": np.array([0.05, 0.03, 0.02]),\n        },\n        {\n            \"d\": 2,\n            \"L\": np.array([20, 40, 80, 160, 320]),\n            \"eta_hat\": np.array([1.929807953, 1.886999788, 1.850297800, 1.830547853, 1.816223403]),\n            \"sigma\": np.array([0.02, 0.015, 0.015, 0.01, 0.01]),\n        },\n    ]\n\n    # --- Model Functions ---\n    def model_3d(L, eta_inf, A):\n        return eta_inf * (1 + A / L)\n\n    def model_2d(L, eta_inf, A_log):\n        # L0 is 1, so ln(L/L0) = ln(L)\n        return eta_inf * (1 + A_log * np.log(L) / L)\n\n    def model_const(L, eta_inf):\n        return np.full_like(L, eta_inf, dtype=np.float64)\n\n    results = []\n\n    for case in test_cases:\n        d = case[\"d\"]\n        L = case[\"L\"]\n        eta_hat = case[\"eta_hat\"]\n        sigma = case[\"sigma\"]\n\n        # Define candidate models based on dimensionality\n        models_to_test = [\n            {'name': 'Constant', 'func': model_const, 'k': 1}\n        ]\n        if d == 3:\n            models_to_test.append({'name': '3D Hydro', 'func': model_3d, 'k': 2})\n        elif d == 2:\n            models_to_test.append({'name': '2D Hydro', 'func': model_2d, 'k': 2})\n\n        best_model_info = {'aic': np.inf, 'eta_inf': np.nan}\n\n        for model in models_to_test:\n            try:\n                # Perform weighted nonlinear least squares fit\n                popt, _ = curve_fit(\n                    model['func'],\n                    L,\n                    eta_hat,\n                    sigma=sigma,\n                    absolute_sigma=True,\n                    # Provide reasonable initial guesses for stability\n                    p0=[np.mean(eta_hat)] * model['k'] \n                )\n                \n                # Calculate residuals\n                eta_pred = model['func'](L, *popt)\n                residuals = eta_hat - eta_pred\n                \n                # Calculate chi-squared\n                chi_squared = np.sum((residuals / sigma)**2)\n                \n                # Calculate AIC\n                k = model['k']\n                aic = 2 * k + chi_squared\n                \n                # Check if this model is better\n                if aic < best_model_info['aic']:\n                    best_model_info['aic'] = aic\n                    best_model_info['eta_inf'] = popt[0]\n\n            except RuntimeError:\n                # curve_fit can fail if the fit is poor.\n                # In this case, this model will not be selected as its AIC remains infinite.\n                pass\n        \n        results.append(best_model_info['eta_inf'])\n\n    # Format the final output string\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}