{
    "hands_on_practices": [
        {
            "introduction": "To truly appreciate the power of multiple time step methods, we must first quantify their primary benefit: computational efficiency. This first exercise guides you through a fundamental calculation to estimate the performance gains offered by RESPA in a common simulation scenario involving long-range electrostatics. By deriving the relationship between the subcycling ratio and the number of expensive Particle Mesh Ewald (PME) calculations, you will gain a concrete understanding of how RESPA translates a simple change in integration strategy into significant computational savings .",
            "id": "3427660",
            "problem": "Consider a molecular dynamics (MD) simulation in which the total force is split into a fast, short-range component and a slow, long-range component. The slow component is evaluated using Particle Mesh Ewald (PME), which employs three-dimensional Fast Fourier Transforms (3D FFTs). The MD integrator is constructed using a time-scale separation via the Reference System Propagator Algorithm (RESPA), with an inner (fast) time step $\\delta t$ and an outer (slow) time step $\\Delta t$ that obeys $\\Delta t = M \\, \\delta t$, where $M \\in \\mathbb{N}$ is the subcycling ratio. The slow PME component is evaluated once per outer step. Assume each PME evaluation executes exactly two 3D FFTs. Take a typical constrained MD inner time step of $\\delta t = 2 \\,\\mathrm{fs}$, and define $\\delta t_{\\mathrm{fs}}$ to be the numerical value of $\\delta t$ expressed in femtoseconds, so that $\\delta t_{\\mathrm{fs}} = 2$.\n\nStarting from first principles of time-discretized dynamics and the definition of RESPA subcycling, derive the number of 3D FFTs executed per nanosecond under RESPA, as a function of the subcycling ratio $M$ and the given typical time step size. As a reference baseline, consider a single-time-step integrator in which PME is evaluated at every inner step $\\delta t$. Use the fact that $1 \\,\\mathrm{ns} = 10^{6} \\,\\mathrm{fs}$.\n\nYour final answer must be a single closed-form analytic expression giving the number of 3D FFTs per nanosecond under RESPA, written solely as a function of $M$ (with the given typical time step implicitly used). Express the answer as a dimensionless count with no units. No rounding is required.",
            "solution": "The problem requires the derivation of the number of three-dimensional Fast Fourier Transforms (3D FFTs) executed per nanosecond in a molecular dynamics (MD) simulation using the Reference System Propagator Algorithm (RESPA). The derivation must start from first principles.\n\nLet us define the relevant quantities provided in the problem statement.\nThe total force on the particles is partitioned into a fast-varying component, $F_{\\text{fast}}$, and a slow-varying component, $F_{\\text{slow}}$.\nThe simulation employs two time steps: an inner, fast time step $\\delta t$, and an outer, slow time step $\\Delta t$.\nThese time steps are related by the subcycling ratio, $M \\in \\mathbb{N}$, as given by the equation:\n$$\n\\Delta t = M \\delta t\n$$\nThe slow force component, which is computed using the Particle Mesh Ewald (PME) method, is evaluated once per outer time step, $\\Delta t$.\nEach PME evaluation requires the execution of exactly two 3D FFTs.\nThe value of the inner time step is given as $\\delta t = 2 \\, \\mathrm{fs}$. The problem also defines $\\delta t_{\\mathrm{fs}}$ as the numerical value of $\\delta t$ in femtoseconds, so $\\delta t_{\\mathrm{fs}} = 2$.\nWe are asked to find the number of 3D FFTs executed per nanosecond, denoted here as $\\mathcal{N}_{\\text{FFT/ns}}$. The conversion factor between nanoseconds and femtoseconds is $1 \\, \\mathrm{ns} = 10^6 \\, \\mathrm{fs}$.\n\nThe frequency at which an event occurs is the reciprocal of the time period between consecutive events. The PME calculation is performed every outer time step $\\Delta t$. Therefore, the frequency of PME evaluations, $f_{\\text{PME}}$, is:\n$$\nf_{\\text{PME}} = \\frac{1}{\\Delta t}\n$$\nThe problem states that each PME evaluation executes $n_{\\text{FFT}} = 2$ FFTs. The rate at which FFTs are executed, $R_{\\text{FFT}}$, is therefore twice the frequency of PME evaluations:\n$$\nR_{\\text{FFT}} = n_{\\text{FFT}} \\times f_{\\text{PME}} = \\frac{2}{\\Delta t}\n$$\nThis rate has units of events per unit time, where the time unit is determined by the units of $\\Delta t$. Since $\\delta t$ is given in femtoseconds, we will express $\\Delta t$ in femtoseconds as well.\nUsing the relation $\\Delta t = M \\delta t$, we can write the rate as:\n$$\nR_{\\text{FFT}} = \\frac{2}{M \\delta t}\n$$\nTo express this rate in the specific units of \"FFTs per nanosecond\", we must establish a relationship between the time unit of the rate (femtoseconds) and the desired time unit (nanoseconds).\nThe number of events per nanosecond is the rate of events (in events per femtosecond) multiplied by the number of femtoseconds in one nanosecond.\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = R_{\\text{FFT}} \\times \\left( \\frac{10^6 \\, \\mathrm{fs}}{1 \\, \\mathrm{ns}} \\right)\n$$\nSubstituting the expression for $R_{\\text{FFT}}$, we have:\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = \\left( \\frac{2}{M \\delta t} \\right) \\times 10^6 \\, \\mathrm{ns}^{-1}\n$$\nHere, $\\delta t$ must be expressed in units of femtoseconds for dimensional consistency. Let $\\delta t = \\delta t_{\\mathrm{fs}} \\, \\mathrm{fs}$, where $\\delta t_{\\mathrm{fs}}$ is the numerical value. The expression becomes:\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = \\frac{2}{M (\\delta t_{\\mathrm{fs}} \\, \\mathrm{fs})} \\times 10^6 \\, \\mathrm{fs}\n$$\nThe unit of femtoseconds ($\\mathrm{fs}$) cancels, leaving a dimensionless count, as expected.\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = \\frac{2 \\times 10^6}{M \\delta t_{\\mathrm{fs}}}\n$$\nThe problem specifies the typical value for the inner time step, which is $\\delta t = 2 \\, \\mathrm{fs}$. This corresponds to $\\delta t_{\\mathrm{fs}} = 2$. Substituting this value into the equation yields the final expression as a function of $M$:\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = \\frac{2 \\times 10^6}{M \\times 2}\n$$\nSimplifying the expression by canceling the factor of $2$:\n$$\n\\mathcal{N}_{\\text{FFT/ns}} = \\frac{10^6}{M}\n$$\nThis is the number of 3D FFTs executed per nanosecond of simulation time under the RESPA scheme, as a function of the subcycling ratio $M$.\n\nAs a consistency check, we can consider the reference baseline case mentioned in the problem, where PME is evaluated at every inner step $\\delta t$. This corresponds to a RESPA scheme with no subcycling for the slow force, i.e., $M=1$. For $M=1$, our derived formula gives $\\mathcal{N}_{\\text{FFT/ns}} = \\frac{10^6}{1} = 10^6$.\nLet's verify this from first principles for the baseline case. The number of inner steps per nanosecond is $\\frac{1 \\, \\mathrm{ns}}{\\delta t} = \\frac{10^6 \\, \\mathrm{fs}}{2 \\, \\mathrm{fs}} = 5 \\times 10^5$. Since PME is called at every step, there are $5 \\times 10^5$ PME calls per nanosecond. With $2$ FFTs per PME call, the total number of FFTs per nanosecond is $(5 \\times 10^5) \\times 2 = 10^6$. This matches our formula for $M=1$, confirming the correctness of the derivation.",
            "answer": "$$\\boxed{\\frac{10^6}{M}}$$"
        },
        {
            "introduction": "While the previous exercise showed that a larger subcycling ratio $M$ leads to greater computational savings, we cannot increase it indefinitely. The integrity of a simulation is bound by numerical stability, which dictates the maximum permissible time step. This practice explores this crucial constraint by modeling the system's motions as harmonic oscillators, allowing you to connect the physical properties of your system—specifically, its fastest and slowest vibrational frequencies—to the stability limits of the inner and outer time steps. By working through this, you will learn how to determine the maximum allowable subcycling ratio, ensuring your simulation remains stable while maximizing efficiency .",
            "id": "3427664",
            "problem": "You are designing a reversible multiple time step integrator based on the Reversible Reference System Propagator Algorithm (RESPA) for a classical molecular dynamics Hamiltonian split as $H = T(\\mathbf{p}) + V_{\\mathrm{fast}}(\\mathbf{q}) + V_{\\mathrm{slow}}(\\mathbf{q})$, where $V_{\\mathrm{fast}}$ contains bonded and short-range terms dominated by the fastest vibrations, and $V_{\\mathrm{slow}}$ contains slowly varying long-range terms. The inner subcycle integrates the fast forces with time step $\\Delta t_{\\mathrm{inner}}$, and the outer cycle updates the slow forces every $\\Delta t_{\\mathrm{outer}} = L \\, \\Delta t_{\\mathrm{inner}}$, where $L \\in \\mathbb{N}$.\n\nAssume the fastest normal mode frequency measured for $V_{\\mathrm{fast}}$ is $\\omega_{\\max} = 3.0 \\times 10^{14} \\ \\mathrm{s}^{-1}$ and the dominant slow fluctuation frequency in $V_{\\mathrm{slow}}$ is $\\Omega = 6.0 \\times 10^{13} \\ \\mathrm{s}^{-1}$. You adopt conservative safety factors $c = 0.2$ for the fast inner updates and $C = 0.5$ for the slow outer updates, where these safety factors quantify the maximum allowable nondimensional phase advance per step for, respectively, the fastest and slowest modes resolved on each level.\n\nStarting from Newton’s equations and the harmonic oscillator model for each normal mode, argue how constraints on $\\Delta t_{\\mathrm{inner}}$ and $\\Delta t_{\\mathrm{outer}}$ follow from limiting the per-step phase advance for the corresponding angular frequencies, and then determine the largest integer outer-to-inner subcycling factor $L$ that ensures both the inner fast-mode and outer slow-mode constraints can be satisfied simultaneously when $\\Delta t_{\\mathrm{inner}}$ is chosen at the largest value consistent with its constraint.\n\nReport only the integer $L$. No units are required in the final answer.",
            "solution": "The problem requires determining the largest integer subcycling factor $L$ for a RESPA multiple time step integration scheme, given constraints on the phase advance for the fastest and slowest modes of the system. The analysis begins with the harmonic oscillator model, which serves as a prototype for oscillatory motion in molecular dynamics.\n\nNewton's equation of motion for a single normal mode coordinate $q_i$ with frequency $\\omega_i$ is that of a simple harmonic oscillator:\n$$ \\ddot{q}_i(t) = -\\omega_i^2 q_i(t) $$\nThe solution to this equation is sinusoidal, $q_i(t) = A_i \\cos(\\omega_i t + \\phi_i)$, where the term $\\omega_i t + \\phi_i$ is the phase. In a numerical integration scheme with time step $\\Delta t$, the phase advances by an amount $\\omega_i \\Delta t$ per step. For the integration to be stable and accurately capture the oscillatory behavior, this phase advance must be kept small. The problem defines this stability criterion through safety factors $c$ and $C$.\n\nFirst, we consider the inner time step, $\\Delta t_{\\mathrm{inner}}$, which is used to integrate the fast forces $V_{\\mathrm{fast}}$. The stability of this integration is limited by the fastest frequency in the system, $\\omega_{\\max}$. The nondimensional phase advance for this mode in a single inner step is $\\omega_{\\max} \\Delta t_{\\mathrm{inner}}$. The problem states this must be less than or equal to the safety factor $c$:\n$$ \\omega_{\\max} \\Delta t_{\\mathrm{inner}} \\le c $$\nThe problem specifies that $\\Delta t_{\\mathrm{inner}}$ should be chosen at the largest value consistent with this constraint. This means we set the inequality to an equality:\n$$ \\omega_{\\max} \\Delta t_{\\mathrm{inner}} = c $$\nThis allows us to express the inner time step as:\n$$ \\Delta t_{\\mathrm{inner}} = \\frac{c}{\\omega_{\\max}} $$\n\nSecond, we consider the outer time step, $\\Delta t_{\\mathrm{outer}}$, which is used to update the slow forces $V_{\\mathrm{slow}}$. The stability criterion for this step is determined by the dominant slow fluctuation frequency, $\\Omega$. The phase advance for this mode per outer step is $\\Omega \\Delta t_{\\mathrm{outer}}$. This is constrained by the safety factor $C$:\n$$ \\Omega \\Delta t_{\\mathrm{outer}} \\le C $$\n\nThe outer and inner time steps are related by the integer subcycling factor $L$, where $\\Delta t_{\\mathrm{outer}} = L \\Delta t_{\\mathrm{inner}}$. We can substitute this relationship into the outer step constraint:\n$$ \\Omega (L \\Delta t_{\\mathrm{inner}}) \\le C $$\n\nNow we have a system of two conditions. We substitute the expression for the maximal $\\Delta t_{\\mathrm{inner}}$ from the first constraint into the second one:\n$$ \\Omega L \\left(\\frac{c}{\\omega_{\\max}}\\right) \\le C $$\n\nWe are asked to find the largest integer $L$ that satisfies this inequality. We can rearrange the inequality to solve for $L$:\n$$ L \\le \\frac{C}{c} \\frac{\\omega_{\\max}}{\\Omega} $$\n\nNow, we substitute the given numerical values into this expression:\n- Fast mode safety factor, $c = 0.2$\n- Slow mode safety factor, $C = 0.5$\n- Fastest frequency, $\\omega_{\\max} = 3.0 \\times 10^{14} \\ \\mathrm{s}^{-1}$\n- Dominant slow frequency, $\\Omega = 6.0 \\times 10^{13} \\ \\mathrm{s}^{-1}$\n\n$$ L \\le \\frac{0.5}{0.2} \\frac{3.0 \\times 10^{14}}{6.0 \\times 10^{13}} $$\n$$ L \\le 2.5 \\times \\frac{3.0}{0.6} $$\n$$ L \\le 2.5 \\times 5 $$\n$$ L \\le 12.5 $$\n\nSince $L$ must be an integer ($L \\in \\mathbb{N}$), the largest integer value of $L$ that satisfies this condition is the floor of $12.5$.\n$$ L_{\\max} = \\lfloor 12.5 \\rfloor = 12 $$\nTherefore, the largest integer outer-to-inner subcycling factor is $12$.",
            "answer": "$$\n\\boxed{12}\n$$"
        },
        {
            "introduction": "Moving beyond simple stability, the choice of an optimal subcycling ratio $M$ involves a sophisticated trade-off between computational cost and numerical accuracy. Merely choosing the largest stable $M$ may not be the most efficient strategy if it introduces unacceptable errors in conserved quantities like energy. This final practice elevates your understanding by framing the selection of RESPA parameters as a formal optimization problem: how to minimize computational cost while guaranteeing that the simulation's energy drift remains below a predefined tolerance. This exercise introduces a realistic model for error accumulation and guides you to a principled criterion for selecting the most efficient $M$, transforming you from a user of methods into a designer of optimal simulation protocols .",
            "id": "3427621",
            "problem": "A molecular dynamics practitioner wishes to accelerate simulations of a solvated protein by using a reversible multiple time step scheme of the Reference System Propagator Algorithm (RESPA) type. The total force is split into a fast, short-ranged part with characteristic frequencies much higher than those of the slow, long-ranged part. The fast part is integrated with an inner time step $\\Delta t$, and the slow part is updated every outer step $H = M \\,\\Delta t$, where $M$ is a positive integer subcycling ratio. The per-evaluation computational costs of the fast and slow force components are $c_{f}$ and $c_{s}$, respectively. The code is known to be linearly stable provided $\\Delta t \\le \\Delta t_{\\max}^{(f)}$ and $H \\le H_{\\max}^{(s)}$; these limits arise from the highest fast vibrational frequency and from avoiding resonance with the fast spectrum in the outer update, respectively.\n\nThe scientist will run long equilibrium trajectories without constraints on holonomic degrees of freedom and estimates the acceptable root-mean-square (RMS) energy drift rate per nanosecond, denoted $\\mathcal{E}_{\\mathrm{rms}}^{\\max}$, from validation studies. For reversible, symplectic, second-order operator-splitting integrators, it is a well-tested fact that, for sufficiently small steps within the stability domain, the leading RMS energy drift rate scales quadratically with the relevant step sizes. When force-splitting is used, the dominant contributions arise from the inner fast update and from the slow-fast splitting error. For a given molecular system and force field, the corresponding proportionality coefficients can be obtained by short calibration runs; denote them by $\\alpha$ and $\\beta$, so that the RMS drift rate exhibits the small-step scaling\n$$\n\\mathcal{E}_{\\mathrm{rms}} \\;\\lesssim\\; \\alpha \\, \\Delta t^{2} \\;+\\; \\beta \\, H^{2}\n\\quad\\text{for}\\quad \\Delta t \\le \\Delta t_{\\max}^{(f)},\\; H \\le H_{\\max}^{(s)}.\n$$\nAssume this bound is tight enough to be used as a design constraint.\n\nFor a fixed simulated time interval of $1$ nanosecond, the expected computational cost is proportional to the number of inner steps times $c_{f}$ plus the number of outer slow-force evaluations times $c_{s}$.\n\nWhich of the following criteria is the correct, principled way to choose the subcycling ratio $M$ so as to minimize the computational cost per nanosecond under the RMS energy drift bound $\\mathcal{E}_{\\mathrm{rms}} \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$ and the stability constraints?\n\nA. Choose $M$ to minimize\n$$\n\\mathcal{C}(M) \\;=\\; \\frac{c_{f} + c_{s}/M}{\\Delta t_{\\mathrm{eff}}(M)} \\,,\n\\quad\n\\Delta t_{\\mathrm{eff}}(M) \\;=\\; \\min\\!\\left\\{ \\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^{2}}}\\,,\\; \\Delta t_{\\max}^{(f)}\\,,\\; \\frac{H_{\\max}^{(s)}}{M} \\right\\},\n$$\nand, in the regime where the drift constraint is active (i.e., $\\Delta t_{\\mathrm{eff}}(M) = \\sqrt{\\mathcal{E}_{\\mathrm{rms}}^{\\max}/(\\alpha + \\beta M^{2})}$), select the integer $M$ nearest to\n$$\nM^{\\star} \\;=\\; \\left(\\frac{c_{s}\\,\\alpha}{\\beta\\,c_{f}}\\right)^{\\!1/3},\n$$\nsubject to satisfying the stability constraints.\n\nB. Balance the cost of fast and slow force calculations per inner step by choosing $M$ such that $c_{s}/M = c_{f}$, i.e., $M^{\\star} = c_{s}/c_{f}$, and then set $\\Delta t$ as large as allowed by stability.\n\nC. Maximize $M$ within the slow-force stability limit by setting $M^{\\star} = \\left\\lfloor H_{\\max}^{(s)}/\\Delta t_{\\max}^{(f)} \\right\\rfloor$ so that slow forces are evaluated as infrequently as possible.\n\nD. Equalize the fast and slow components of the RMS drift bound by choosing $M$ such that $\\alpha \\Delta t^{2} = \\beta H^{2}$, i.e., $M^{\\star} = \\sqrt{\\alpha/\\beta}$, and then pick $\\Delta t$ to saturate the drift constraint.",
            "solution": "The user has requested a critical evaluation of a problem concerning the optimization of a multiple time step molecular dynamics simulation. The process begins with a rigorous validation of the problem statement.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Integration scheme**: Reversible multiple time step Reference System Propagator Algorithm (RESPA).\n*   **Force splitting**: Total force is split into a fast part and a slow part.\n*   **Time steps**:\n    *   Inner time step (fast forces): $\\Delta t$.\n    *   Outer time step (slow forces): $H = M \\Delta t$, where $M$ is a positive integer subcycling ratio.\n*   **Computational costs**:\n    *   Per-evaluation cost of the fast force: $c_{f}$.\n    *   Per-evaluation cost of the slow force: $c_{s}$.\n*   **Stability constraints**:\n    *   $\\Delta t \\le \\Delta t_{\\max}^{(f)}$.\n    *   $H \\le H_{\\max}^{(s)}$.\n*   **Accuracy constraint (energy conservation)**:\n    *   Maximum acceptable root-mean-square (RMS) energy drift rate per nanosecond: $\\mathcal{E}_{\\mathrm{rms}}^{\\max}$.\n    *   Scaling of the RMS drift rate: $\\mathcal{E}_{\\mathrm{rms}} \\approx \\alpha \\, \\Delta t^{2} + \\beta \\, H^{2}$.\n    *   Constraint to be enforced: $\\alpha \\, \\Delta t^{2} + \\beta \\, H^{2} \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$.\n*   **Optimization goal**: Minimize the computational cost per nanosecond.\n*   **Cost function definition**: For a fixed simulated time interval $T = 1$ ns, the cost is proportional to the total number of fast force evaluations plus the total number of slow force evaluations.\n    *   Number of fast-force evaluations: $N_f = T / \\Delta t$.\n    *   Number of slow-force evaluations: $N_s = T / H = T / (M \\Delta t)$.\n    *   Total cost is proportional to $N_f c_f + N_s c_s = \\frac{T}{\\Delta t} c_f + \\frac{T}{M \\Delta t} c_s$. To minimize cost per unit time, we minimize the function $\\mathcal{C}(\\Delta t, M) = \\frac{1}{\\Delta t} \\left(c_f + \\frac{c_s}{M}\\right)$.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded**: The problem is firmly rooted in the established theory and practice of numerical integration for molecular dynamics. The use of RESPA, the splitting of forces based on characteristic time scales, the concept of stability limits for numerical integrators (e.g., Verlet-type), and the analysis of energy drift as a measure of accuracy are all standard concepts in computational statistical mechanics. The quadratic scaling of the energy drift error with the time step for second-order symplectic integrators is a well-known result. The problem is scientifically sound.\n*   **Well-Posed**: The problem is a constrained optimization problem. It asks to minimize a well-defined cost function, $\\mathcal{C}(\\Delta t, M)$, subject to a set of inequality constraints on the variables $\\Delta t$ and $M$. Such a problem is mathematically well-posed and has a meaningful solution.\n*   **Objective**: The problem is formulated using precise mathematical language and objective physical quantities ($c_f$, $c_s$, $\\alpha$, $\\beta$, etc.). There are no subjective or ambiguous statements.\n*   **Completeness and Consistency**: The problem provides all necessary information: the objective function, the variables to be optimized ($\\Delta t$ and $M$), and all relevant constraints (stability and accuracy). The definitions are self-consistent.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is valid. It is scientifically sound, well-posed, objective, and self-contained. Therefore, I will proceed with deriving the solution.\n\n### Solution Derivation\n\nThe goal is to minimize the computational cost per nanosecond, given by the function $\\mathcal{C}(\\Delta t, M) = \\frac{1}{\\Delta t} \\left(c_f + \\frac{c_s}{M}\\right)$, subject to a set of constraints.\n\nThe constraints on the integration parameters $\\Delta t$ and $M$ are:\n1.  **Fast stability**: $\\Delta t \\le \\Delta t_{\\max}^{(f)}$.\n2.  **Slow stability**: $H \\le H_{\\max}^{(s)}$, which translates to $M \\Delta t \\le H_{\\max}^{(s)}$, or $\\Delta t \\le \\frac{H_{\\max}^{(s)}}{M}$.\n3.  **Accuracy (Energy Drift)**: $\\mathcal{E}_{\\mathrm{rms}} \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$. Using the provided scaling, this is $\\alpha \\Delta t^2 + \\beta H^2 \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$. Substituting $H = M \\Delta t$, we get $\\alpha \\Delta t^2 + \\beta (M \\Delta t)^2 \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$, which simplifies to $(\\alpha + \\beta M^2) \\Delta t^2 \\le \\mathcal{E}_{\\mathrm{rms}}^{\\max}$. This gives a third upper bound on $\\Delta t$: $\\Delta t \\le \\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^2}}$.\n\nTo minimize the cost function $\\mathcal{C}(\\Delta t, M)$, which is inversely proportional to $\\Delta t$, one must choose the largest possible value of $\\Delta t$ for any given subcycling ratio $M$. The largest permissible $\\Delta t$ is the minimum of the three upper bounds derived from the constraints:\n$$\n\\Delta t_{\\text{opt}}(M) = \\min\\left\\{ \\Delta t_{\\max}^{(f)}, \\; \\frac{H_{\\max}^{(s)}}{M}, \\; \\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^2}} \\right\\}\n$$\nThis expression is identical to the $\\Delta t_{\\mathrm{eff}}(M)$ defined in option A.\n\nThe problem is now reduced to a one-dimensional optimization problem: find the positive integer $M$ that minimizes the cost function where $\\Delta t$ is set to its optimal value for that $M$:\n$$\n\\mathcal{C}(M) = \\frac{c_f + c_s/M}{\\Delta t_{\\text{opt}}(M)}\n$$\n\nThis is a general formulation. In many practical scenarios, simulations are run in a regime where accuracy is the limiting factor, not linear stability. This corresponds to the case where the third term in the `min` function is the smallest, i.e., the drift constraint is \"active\". Let us analyze this specific, yet common, regime as suggested in option A.\n\nAssuming the drift constraint is active, we have:\n$$\n\\Delta t = \\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^2}}\n$$\nSubstituting this into the cost function gives:\n$$\n\\mathcal{C}(M) = \\frac{c_f + c_s/M}{\\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^2}}} = \\frac{1}{\\sqrt{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}} \\left(c_f + \\frac{c_s}{M}\\right) \\sqrt{\\alpha + \\beta M^2}\n$$\nTo find the optimal $M$ that minimizes $\\mathcal{C}(M)$, we can treat $M$ as a continuous variable, find the extremum by differentiation, and then select the integer nearest to this optimal real value. We can ignore the constant prefactor $1/\\sqrt{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}$ and minimize the function $f(M) = (c_f + c_s/M) \\sqrt{\\alpha + \\beta M^2}$. It is often simpler to minimize the square of the function, $f(M)^2$, as this removes the square root and yields the same extremum for positive functions.\nLet $g(M) = f(M)^2 = (c_f + c_s/M)^2 (\\alpha + \\beta M^2)$. To find the minimum, we set its derivative with respect to $M$ to zero.\n$$\n\\frac{dg}{dM} = \\frac{d}{dM} \\left[ \\left(c_f + \\frac{c_s}{M}\\right)^2 (\\alpha + \\beta M^2) \\right] = 0\n$$\nUsing the product rule:\n$$\n2\\left(c_f + \\frac{c_s}{M}\\right)\\left(-\\frac{c_s}{M^2}\\right)(\\alpha + \\beta M^2) + \\left(c_f + \\frac{c_s}{M}\\right)^2(2\\beta M) = 0\n$$\nSince $c_f + c_s/M > 0$, we can divide by a factor of $2(c_f + c_s/M)$:\n$$\n-\\frac{c_s}{M^2}(\\alpha + \\beta M^2) + \\left(c_f + \\frac{c_s}{M}\\right)(\\beta M) = 0\n$$\n$$\n-\\frac{c_s \\alpha}{M^2} - c_s \\beta + c_f \\beta M + c_s \\beta = 0\n$$\n$$\nc_f \\beta M = \\frac{c_s \\alpha}{M^2}\n$$\n$$\nM^3 = \\frac{c_s \\alpha}{c_f \\beta}\n$$\n$$\nM^{\\star} = \\left(\\frac{c_s \\alpha}{\\beta c_f}\\right)^{1/3}\n$$\nThis result gives the optimal subcycling ratio $M$ when the accuracy constraint is dominant. The complete, principled procedure involves first defining the cost function $\\mathcal{C}(M)$ over all possible regimes (stability-limited or accuracy-limited) and then finding the integer $M$ which minimizes it. The expression for $M^{\\star}$ is the specific solution for the accuracy-limited regime.\n\n### Option-by-Option Analysis\n\n**A. Choose $M$ to minimize $\\mathcal{C}(M) = \\frac{c_{f} + c_{s}/M}{\\Delta t_{\\mathrm{eff}}(M)}$, with $\\Delta t_{\\mathrm{eff}}(M) = \\min\\!\\left\\{ \\sqrt{\\frac{\\mathcal{E}_{\\mathrm{rms}}^{\\max}}{\\alpha + \\beta M^{2}}}\\,,\\; \\Delta t_{\\max}^{(f)}\\,,\\; \\frac{H_{\\max}^{(s)}}{M} \\right\\}$, and, in the regime where the drift constraint is active, select the integer $M$ nearest to $M^{\\star} = \\left(\\frac{c_{s}\\,\\alpha}{\\beta\\,c_{f}}\\right)^{\\!1/3}$, subject to satisfying the stability constraints.**\n\nThis option first correctly formulates the full optimization problem by defining the cost as a function of $M$, where $\\Delta t$ is maximized according to all constraints. It then provides the correct analytical solution for the optimal $M$ in the common and important regime where performance is limited by the required accuracy (energy drift) rather than numerical stability. The procedure to select an integer $M$ near this analytical optimum, while checking that the choice is consistent with the initial assumption (i.e., the stability constraints are not violated), is the correct approach.\n**Verdict: Correct.**\n\n**B. Balance the cost of fast and slow force calculations per inner step by choosing $M$ such that $c_{s}/M = c_{f}$, i.e., $M^{\\star} = c_{s}/c_{f}$, and then set $\\Delta t$ as large as allowed by stability.**\n\nThis is an ad-hoc heuristic that attempts to balance the computational workload. The cost of slow forces, when averaged over one inner step, is $c_s/M$. Equating this to the cost of one fast force evaluation, $c_f$, yields $M = c_s/c_f$. This approach completely ignores the physics of error accumulation, represented by the parameters $\\alpha$ and $\\beta$. The optimal trade-off between cost and accuracy must involve these parameters, as shown in the derivation. This heuristic is not guaranteed to be optimal.\n**Verdict: Incorrect.**\n\n**C. Maximize $M$ within the slow-force stability limit by setting $M^{\\star} = \\left\\lfloor H_{\\max}^{(s)}/\\Delta t_{\\max}^{(f)} \\right\\rfloor$ so that slow forces are evaluated as infrequently as possible.**\n\nThis strategy corresponds to pushing both the inner and outer time steps to their respective stability limits simultaneously: $\\Delta t = \\Delta t_{\\max}^{(f)}$ and $H = M \\Delta t = H_{\\max}^{(s)}$. While this maximizes the time steps with respect to stability, it completely disregards the accuracy constraint $\\mathcal{E}_{\\mathrm{rms}}^{\\max}$. If the resulting energy drift is unacceptably high, this choice of parameters is invalid. Even if the drift is acceptable, this choice is not generally optimal, as a different combination of $M$ and $\\Delta t$ might yield the same accuracy for a lower computational cost.\n**Verdict: Incorrect.**\n\n**D. Equalize the fast and slow components of the RMS drift bound by choosing $M$ such that $\\alpha \\Delta t^{2} = \\beta H^{2}$, i.e., $M^{\\star} = \\sqrt{\\alpha/\\beta}$, and then pick $\\Delta t$ to saturate the drift constraint.**\n\nThis heuristic, known as \"error equipartitioning,\" suggests balancing the two main sources of error. From $\\alpha \\Delta t^2 = \\beta (M\\Delta t)^2$, we get $M^2 = \\alpha/\\beta$, or $M = \\sqrt{\\alpha/\\beta}$. This approach ignores the computational costs, $c_f$ and $c_s$, associated with controlling each error component. The true optimum must balance the marginal cost of reducing the error from each source. The derived optimal condition, $M^3 = (c_s \\alpha)/(c_f \\beta)$, clearly shows that the costs $c_f$ and $c_s$ play a crucial role. Equipartitioning the error is only optimal in the specific case where the effective costs of managing each error source are equal, which is not true in general.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}