{
    "hands_on_practices": [
        {
            "introduction": "在增强采样方法中，我们面临一个核心的权衡：既要快速跨越能垒，又不能以破坏原始自由能信息为代价。温火元动力学（Well-Tempered Metadynamics）通过偏置因子 $\\gamma$ 提供了一个优雅的解决方案，它允许我们控制模拟的“有效温度”。本练习  将指导你从第一性原理出发，建立一个量化模型，以平衡类阿伦尼乌斯（Arrhenius-like）的速率提升与通过有效样本量（Effective Sample Size, ESS）衡量的统计精度损失，从而做出明智的参数选择。",
            "id": "3425192",
            "problem": "设计并实现一个完整的、可运行的程序，用于在单维集体变量设定下选择适温元动力学 (WTMetaD) 的偏置因子 $\\gamma$，以平衡势垒穿越频率与自由能分辨率。该系统被建模为在集体变量 $s$ 中由一个高度为 $\\Delta F$ 的势垒分隔开的两个势阱。温度为 $T$ 的正则系综具有逆温度 $\\beta = 1/(k_B T)$，其中 $k_B$ 是以千焦/摩尔·开尔文为单位的玻尔兹曼常数。在 WTMetaD 中，沿 $s$ 的稳态分布被偏置所修改，使得有效温度 $T^*$ 满足 $T^* = \\gamma T$，其中 $\\gamma \\geq 1$ 是一个无量纲的偏置因子。势垒穿越频率可以用一个类阿伦尼乌斯尝试频率乘以一个玻尔兹曼因子来建模。偏置下及后续重加权的自由能分辨率可以通过重要性采样权重获得的的有效样本量 (ESS) 比率来量化。您必须：\n\n- 从第一性原理出发，具体包括：\n  - 基于玻尔兹曼因子的正则系综定义。\n  - 热激活过程中的类阿伦尼乌斯势垒穿越原理。\n  - WTMetaD 沿集体变量的稳态测度及其与有效温度的关系。\n  - 重要性采样和重加权的定义，重点关注 ESS 如何在双态模型中由权重方差产生。\n\n- 构建一个双态模型，其中左势阱的自由能为 $F_L = 0$，右势阱的自由能为 $F_R = \\Delta F$。在 WTMetaD 下，稳态分布被改变，必须通过重加权恢复无偏估计。利用这一点推导出 ESS 比率 $R(\\gamma)$ 作为 $\\gamma$ 和模型参数的函数。\n\n- 定义一个程序化决策规则，以在给定以下约束条件的情况下选择 $\\gamma$：\n  1. 势垒穿越频率要求：WTMetaD 下的穿越频率应至少达到一个指定的目标频率 $r_{\\text{target}}$ (单位为 $s^{-1}$)。\n  2. 分辨率要求：ESS 比率 $R(\\gamma)$ 应至少达到一个指定的阈值 $R_{\\min}$ (无量纲)。\n\n- 对于每个测试用例，您的程序必须计算满足势垒穿越频率要求的最小 $\\gamma \\geq 1$。如果这个 $\\gamma$ 也满足分辨率要求，则输出该 $\\gamma$ 值，四舍五入到三位小数。如果没有 $\\gamma$ 能同时满足这两个约束条件（包括所需穿越频率超过尝试频率的情况），则为该测试用例输出整数 $-1$。\n\n- 物理常数和单位：\n  - 使用 $k_B = 0.008314462618$，单位为千焦/摩尔·开尔文。\n  - $\\Delta F$ 以千焦/摩尔为单位提供。\n  - $T$ 以开尔文为单位提供。\n  - 尝试频率 $\\nu_0$ 以秒的倒数 ($s^{-1}$) 为单位提供。\n  - $r_{\\text{target}}$ 以秒的倒数 ($s^{-1}$) 为单位提供。\n  - 输出的 $\\gamma$ 是无量纲的。\n\n- 测试套件：\n  - 程序必须评估以下测试用例，每个用例指定为一个元组 $(\\Delta F, T, \\nu_0, r_{\\text{target}}, R_{\\min})$：\n    1. $(20, 300, 10^{12}, 10^{9}, 0.95)$\n    2. $(20, 300, 10^{12}, 10^{11}, 0.92)$\n    3. $(2, 300, 10^{12}, 10^{12}, 0.99)$\n    4. $(50, 300, 10^{12}, 10^{6}, 0.98)$\n    5. $(15, 300, 10^{12}, 10^{9}, 0.99)$\n\n- 最终输出格式：\n  - 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号内以逗号分隔的列表，例如 $[1.234,-1,2.000]$，其中每个条目对应选择的 $\\gamma$（四舍五入到三位小数）或在没有可行 $\\gamma$ 时为 $-1$。\n\n本问题陈述中不得给出任何公式；您必须从上面列出的基本依据出发，并推导出所有必要的关系。确保场景和参数在科学上是合理且自洽的。所有角度（如有）必须以弧度为单位。所有百分比（如有）必须表示为小数或分数，不得使用百分号。",
            "solution": "该问题要求确定适温元动力学 (WTMetaD) 模拟的最优偏置因子 $\\gamma$。$\\gamma$ 的选择必须平衡两个相互竞争的目标：加速穿越自由能势垒和保持对无偏自由能地景的高质量重构。我们将从第一性原理推导必要的关系，并建立一个决策规则来找到满足这两个标准的最小 $\\gamma \\geq 1$。\n\n设系统由一维集体变量 $s$ 描述。沿 $s$ 的自由能地景包含两个由高度为 $\\Delta F$ 的势垒分隔的势阱。系统处于温度为 $T$ 的正则系综中，逆温度定义为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是玻尔兹曼常数。\n\n**1. WTMetaD 中的势垒穿越频率**\n\n热激活过程（如穿越能垒）的速率可以通过阿伦尼乌斯方程建模。对于无偏系统，穿越频率 $r$ 与尝试频率 $\\nu_0$ 和一个依赖于势垒高度 $\\Delta F$ 的玻尔兹曼因子成正比：\n$$r_{\\text{unbiased}} = \\nu_0 \\exp(-\\beta \\Delta F) = \\nu_0 \\exp\\left(-\\frac{\\Delta F}{k_B T}\\right)$$\n\n在适温元动力学中，会添加一个偏置势，在长时间极限下，这会导致一个修正的稳态概率分布。该分布对应于一个更高有效温度 $T^* = \\gamma T$ 下的正则系综，其中 $\\gamma \\geq 1$ 是无量纲偏置因子。因此，有效逆温度为 $\\beta^* = 1/(k_B T^*) = \\beta/\\gamma$。\n\n偏置模拟中的势垒穿越过程受此有效温度控制。因此，加速后的穿越频率 $r(\\gamma)$ 由采用有效逆温度 $\\beta^*$ 的阿伦尼乌斯方程给出：\n$$r(\\gamma) = \\nu_0 \\exp(-\\beta^* \\Delta F) = \\nu_0 \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right) = \\nu_0 \\exp\\left(-\\frac{\\Delta F}{\\gamma k_B T}\\right)$$\n该表达式量化了偏置因子 $\\gamma$ 如何提高势垒穿越的速率。\n\n**2. 自由能分辨率和有效样本量 (ESS)**\n\n虽然 WTMetaD 加速了采样，但数据是从一个有偏分布中收集的，必须进行重加权以恢复无偏正则系综的属性。此重加权过程会带来统计上的损失，这可以通过有效样本量 (ESS) 来量化。\n\n具有自由能 $F(s)$ 的状态的无偏概率为 $p_u(s) \\propto \\exp(-\\beta F(s))$。WTMetaD 下的偏置概率为 $p_b(s) \\propto \\exp(-\\beta^* F(s)) = \\exp(-\\beta F(s)/\\gamma)$。用于将来自偏置系综的样本重加权到无偏系综的重要性权重 $w(s)$ 是目标概率与采样概率之比：\n$$w(s) = \\frac{p_u(s)}{p_b(s)} = \\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta F(s))}{\\exp(-\\beta F(s)/\\gamma)}$$\n其中 $Z_u = \\int \\exp(-\\beta F(s)) ds$ 和 $Z_b = \\int \\exp(-\\beta F(s)/\\gamma) ds$ 分别是无偏和偏置系综的配分函数。\n\n重加权的质量由 ESS 比率 $R = ESS/N_{total}$ 来衡量，其中 $N_{total}$ 是总样本数。该比率由下式给出：\n$$R = \\frac{\\left(\\mathbb{E}_{b}[w]\\right)^2}{\\mathbb{E}_{b}[w^2]}$$\n其中期望值是关于偏置分布 $p_b(s)$ 计算的。可以证明 $\\mathbb{E}_{b}[w] = 1$，因此表达式简化为 $R = 1 / \\mathbb{E}_{b}[w^2]$。\n\n我们现在将此应用于指定的双态模型，其状态为 $L$ 和 $R$，自由能分别为 $F_L = 0$ 和 $F_R = \\Delta F$。\n配分函数为 $Z_u = e^{-\\beta F_L} + e^{-\\beta F_R} = 1 + e^{-\\beta \\Delta F}$ 和 $Z_b = e^{-\\beta F_L/\\gamma} + e^{-\\beta F_R/\\gamma} = 1 + e^{-\\beta \\Delta F/\\gamma}$。\n这些状态的偏置概率为 $P_b(L) = \\frac{1}{Z_b}$ 和 $P_b(R) = \\frac{\\exp(-\\beta \\Delta F/\\gamma)}{Z_b}$。\n两种状态的权重为：\n$$w(L) = \\frac{Z_b}{Z_u}$$\n$$w(R) = \\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta \\Delta F)}{\\exp(-\\beta \\Delta F/\\gamma)}$$\n权重平方的期望值为：\n$$\\mathbb{E}_{b}[w^2] = P_b(L)w(L)^2 + P_b(R)w(R)^2$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{1}{Z_b} \\left(\\frac{Z_b}{Z_u}\\right)^2 + \\frac{\\exp(-\\beta \\Delta F/\\gamma)}{Z_b} \\left(\\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta \\Delta F)}{\\exp(-\\beta \\Delta F/\\gamma)}\\right)^2$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{Z_b}{Z_u^2} \\left[1 + \\exp(-\\beta \\Delta F/\\gamma) \\frac{\\exp(-2\\beta \\Delta F)}{\\exp(-2\\beta \\Delta F/\\gamma)}\\right]$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{Z_b}{Z_u^2} \\left[1 + \\exp(-2\\beta \\Delta F + \\beta \\Delta F/\\gamma)\\right]$$\n代入 $Z_u$ 和 $Z_b$ 并定义 $x = \\exp(-\\beta \\Delta F)$：\n$$\\mathbb{E}_{b}[w^2] = \\frac{1+x^{1/\\gamma}}{(1+x)^2} \\left[1 + x^{2-1/\\gamma}\\right]$$\n因此，ESS 比率 $R(\\gamma) = 1 / \\mathbb{E}_{b}[w^2]$ 为：\n$$R(\\gamma) = \\frac{(1+x)^2}{(1+x^{1/\\gamma})(1+x^{2-1/\\gamma})} = \\frac{(1+e^{-\\beta \\Delta F})^2}{(1+e^{-\\beta \\Delta F/\\gamma})(1+e^{-\\beta \\Delta F(2-1/\\gamma)})}$$\n对于 $\\gamma \\geq 1$，此函数是单调递减的。\n\n**3. 选择 $\\gamma$ 的决策规则**\n\n我们必须找到满足以下两个约束条件的最小 $\\gamma \\geq 1$：\n1. $r(\\gamma) \\geq r_{\\text{target}}$\n2. $R(\\gamma) \\geq R_{\\min}$\n\n从频率约束出发：\n$$\\nu_0 \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right) \\geq r_{\\text{target}}$$\n可能的最大频率是 $\\nu_0$（当 $\\gamma \\to \\infty$ 时）。如果 $r_{\\text{target}} > \\nu_0$，则不可能有解。如果 $r_{\\text{target}} = \\nu_0$ 且 $\\Delta F > 0$，不等式要求 $\\exp(-\\beta \\Delta F/\\gamma) \\geq 1$，这对于有限的 $\\gamma \\geq 1$ 是不可能的。因此，我们必须有 $r_{\\text{target}}  \\nu_0$（或者如果 $\\Delta F=0$，则 $r_{\\text{target}} \\le \\nu_0$）。\n解出 $\\gamma$：\n$$-\\frac{\\beta \\Delta F}{\\gamma} \\geq \\ln\\left(\\frac{r_{\\text{target}}}{\\nu_0}\\right)$$\n$$\\frac{\\beta \\Delta F}{\\gamma} \\leq -\\ln\\left(\\frac{r_{\\text{target}}}{\\nu_0}\\right) = \\ln\\left(\\frac{\\nu_0}{r_{\\text{target}}}\\right)$$\n$$\\gamma \\geq \\frac{\\beta \\Delta F}{\\ln(\\nu_0/r_{\\text{target}})}$$\n我们称右侧为 $\\gamma_{\\text{freq}}$。为满足频率约束和基本约束 $\\gamma \\geq 1$，所需的最小偏置因子为 $\\gamma_{\\text{cand}} = \\max(1, \\gamma_{\\text{freq}})$。\n\n这个候选值 $\\gamma_{\\text{cand}}$ 是满足速率要求的最小可能 $\\gamma$。我们现在必须检查它是否也满足分辨率要求。由于 $R(\\gamma)$ 是一个对于 $\\gamma \\ge 1$ 的单调递减函数，如果 $\\gamma_{\\text{cand}}$ 未通过分辨率测试，即 $R(\\gamma_{\\text{cand}})  R_{\\min}$，那么任何更大的 $\\gamma$（虽然也能满足频率约束）也将失败。在这种情况下，不存在解。\n\n算法如下：\n1.  对于给定的参数集 $(\\Delta F, T, \\nu_0, r_{\\text{target}}, R_{\\min})$，首先检查可解性。如果 $r_{\\text{target}} > \\nu_0$，或者如果 $r_{\\text{target}} = \\nu_0$ 且 $\\Delta F > 0$，则无解。\n2.  计算 $\\beta = 1/(k_B T)$。\n3.  如果 $r_{\\text{target}}  \\nu_0$，计算 $\\gamma_{\\text{freq}} = (\\beta \\Delta F) / \\ln(\\nu_0 / r_{\\text{target}})$。\n4.  确定候选偏置因子：$\\gamma_{\\text{cand}} = \\max(1, \\gamma_{\\text{freq}})$。如果 $\\Delta F=0$ 且 $r_{\\text{target}} \\le \\nu_0$，任何 $\\gamma \\ge 1$ 都满足频率要求，因此 $\\gamma_{cand}=1$。\n5.  使用上面推导的公式计算 ESS 比率 $R(\\gamma_{\\text{cand}})$。\n6.  如果 $R(\\gamma_{\\text{cand}}) \\geq R_{\\min}$，那么 $\\gamma_{\\text{cand}}$ 就是解。\n7.  如果 $R(\\gamma_{\\text{cand}})  R_{\\min}$，则不存在可行的 $\\gamma$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal Well-Tempered Metadynamics bias factor gamma\n    for a series of test cases based on barrier crossing and resolution constraints.\n    \"\"\"\n\n    # Physical constant in kJ/(mol·K)\n    K_B = 0.008314462618\n\n    # Test cases: (delta_F, T, nu_0, r_target, R_min)\n    test_cases = [\n        (20, 300, 10**12, 10**9, 0.95),\n        (20, 300, 10**12, 10**11, 0.92),\n        (2, 300, 10**12, 10**12, 0.99),\n        (50, 300, 10**12, 10**6, 0.98),\n        (15, 300, 10**12, 10**9, 0.99),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_F, T, nu_0, r_target, R_min = case\n\n        # --- Problem Validation and Edge Cases ---\n        \n        # Condition 1: Target frequency cannot exceed attempt frequency.\n        if r_target > nu_0:\n            results.append(-1)\n            continue\n\n        # Condition 2: If target equals attempt frequency, barrier must be non-existent.\n        # Otherwise, exp(-beta*delta_F/gamma) must be >= 1, which is impossible for delta_F > 0.\n        if r_target == nu_0:\n            if delta_F > 0:\n                results.append(-1)\n                continue\n            # If delta_F is 0, any gamma works for frequency. Smallest is gamma=1.\n            gamma_cand = 1.0\n        else:\n            # --- Calculate Candidate Gamma from Frequency Constraint ---\n            if delta_F == 0:\n                # If there's no barrier, unbiased rate is nu_0.\n                # Since r_target  nu_0, no bias is needed. Choose smallest gamma.\n                gamma_cand = 1.0\n            else:\n                beta = 1.0 / (K_B * T)\n                log_nu0_over_rtarget = np.log(nu_0 / r_target)\n                \n                gamma_freq = (beta * delta_F) / log_nu0_over_rtarget\n\n                # The bias factor must be at least 1. If the unbiased system is\n                # already fast enough (gamma_freq = 1), we use the minimum bias (gamma=1).\n                gamma_cand = max(1.0, gamma_freq)\n\n        # --- Check Resolution Constraint (ESS Ratio) ---\n        beta = 1.0 / (K_B * T)\n        x = np.exp(-beta * delta_F)\n\n        # Handle the case where gamma_cand is 1, so 2 - 1/gamma_cand is 1\n        # Avoids potential precision issues with x**(1.0)\n        if gamma_cand == 1.0:\n            # R(gamma=1) simplifies to 1\n            ess_ratio = 1.0\n        else:\n            # R(gamma) = (1+x)^2 / [(1 + x^(1/gamma)) * (1 + x^(2 - 1/gamma))]\n            # Using np.power for potentially large exponents\n            one_over_gamma = 1.0 / gamma_cand\n            x_pow_1_over_gamma = np.power(x, one_over_gamma)\n            x_pow_2_minus_1_over_gamma = np.power(x, 2.0 - one_over_gamma)\n            \n            numerator = (1.0 + x)**2\n            denominator = (1.0 + x_pow_1_over_gamma) * (1.0 + x_pow_2_minus_1_over_gamma)\n            \n            # Avoid division by zero, though denominator should be > 1\n            if denominator == 0:\n                results.append(-1)\n                continue\n            \n            ess_ratio = numerator / denominator\n\n        # --- Final Decision ---\n        if ess_ratio >= R_min:\n            # Format to 3 decimal places as a string\n            results.append(f\"{gamma_cand:.3f}\")\n        else:\n            # If the minimal gamma for frequency fails resolution, no solution exists\n            results.append(-1)\n\n    # Print the final result in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "优化模拟参数只是成功的一半；如果选择的集合变量（Collective Variable, CV）本身存在缺陷，模拟仍会失败。一个常见的陷阱是，CV未能区分能量上相近但结构迥异的“隐藏”亚稳态（如  所述）。本练习  构建了一个包含粗粒度CV和隐藏自由度的理论模型，引导你通过实施一种高级分析技术——条件扩散分析（conditional diffusion analysis），来量化探测这种隐藏能垒如何“泄漏”其影响并扭曲表观动力学。",
            "id": "3425186",
            "problem": "考虑二维空间中的过阻尼随机动力学，它构成了一个用于集体变量设计和元动力学偏置的最小模型。设微观状态为 $(x(t), y(t))$，其在势能 $U(x,y)$ 和一个仅通过粗粒度集体变量 $s_0(x)$ 施加的元动力学偏置 $V(s_0(x), t)$ 下，根据过阻尼朗之万方程演化：\n$$\n\\dot{x}(t) = -\\mu \\,\\frac{\\partial}{\\partial x} \\left[ U(x,y) + V(s_0(x), t) \\right] + \\sqrt{2 D_0} \\,\\xi_x(t),\n$$\n$$\n\\dot{y}(t) = -\\mu \\,\\frac{\\partial}{\\partial y} U(x,y) + \\sqrt{2 D_0} \\,\\xi_y(t),\n$$\n其中 $\\mu$ 是迁移率，$D_0$ 是裸扩散常数，$\\xi_x(t)$ 和 $\\xi_y(t)$ 是均值为零、方差为单位的独立高斯白噪声。使用约化单位，其中玻尔兹曼常数乘以温度 $k_{\\mathrm{B}} T = 1$，摩擦系数 $\\zeta = 1$，因此 $\\mu = 1/\\zeta = 1$ 且 $D_0 = \\mu k_{\\mathrm{B}} T = 1$。时间以大小为 $dt$ 的模拟步长来衡量，长度是无量纲的。\n\n将集体变量的粗粒度部分定义为 $s_0(x) = \\tanh(x/\\ell)$，其中平滑尺度 $\\ell  0$；将精细修正定义为 $\\delta s = y$，因此多尺度集体变量为 $s = s_0 + \\delta s$，但偏置仅沉积在 $s_0$ 上。势能面结合了沿 $x$ 轴的粗粒度双势阱和沿 $y$ 轴的隐藏精细势垒，其高度依赖于 $x$：\n$$\nU(x,y) = U_0(x) + U_1(y; x),\n$$\n$$\nU_0(x) = \\frac{\\alpha}{4} x^4 - \\frac{\\beta}{2} x^2,\n\\quad\nU_1(y; x) = B(x)\\left(\\frac{y^4}{4} - \\frac{y^2}{2}\\right),\n$$\n$$\nB(x) = B_0 + B_1 \\exp\\left(-\\frac{x^2}{2\\sigma_x^2}\\right),\n$$\n其中参数 $\\alpha  0$, $\\beta  0$, $B_0 \\ge 0$, $B_1 \\ge 0$, 以及 $\\sigma_x  0$。元动力学偏置通过每隔固定的沉积步长 $\\tau_{\\mathrm{dep}}$，在访问过的 $s_0(x)$ 位置为中心，以离散步长沉积高度为 $W$、宽度为 $\\sigma_s$ 的高斯山来构建：\n$$\nV(s_0, t_n) = \\sum_{j=1}^{N_{\\mathrm{dep}}(n)} W \\exp\\left( -\\frac{(s_0 - s_0^{(j)})^2}{2 \\sigma_s^2} \\right),\n$$\n其中 $s_0^{(j)}$ 是第 $j$ 个沉积中心，$N_{\\mathrm{dep}}(n)$ 是截至第 $n$ 步的沉积次数。元动力学偏置对 $x$ 方程贡献的力为 $- \\frac{\\partial V}{\\partial s_0} \\frac{d s_0}{d x}$，其中 $\\frac{d s_0}{d x} = \\frac{1}{\\ell} \\operatorname{sech}^2(x/\\ell)$。\n\n你的任务是实现这些方程的 Euler–Maruyama 积分以生成轨迹，然后沿精细修正 $\\delta s = y$ 进行条件扩散分析。定义在延迟 $\\tau = n_{\\mathrm{lag}} dt$ 下沿 $y$ 的条件均方根位移，条件是在该延迟区间内 $s_0$ 保持在区间 $B = [a,b]$ 内：\n$$\n\\operatorname{MSD}_B(\\tau) = \\left\\langle \\left( y(t + \\tau) - y(t) \\right)^2 \\,\\Big|\\, s_0(t') \\in [a,b] \\ \\forall\\, t' \\in [t, t+\\tau] \\right\\rangle,\n$$\n以及相应的条件扩散系数\n$$\nD_{y \\mid B} \\approx \\frac{\\operatorname{MSD}_B(\\tau)}{2 \\tau},\n$$\n此式在小的 $\\tau$ 下有效。使用两个分析区间：一个过渡区间 $B_{\\mathrm{tr}} = [-0.1, 0.1]$ 和两个势阱区间 $B_{\\mathrm{wl}} = [-1.0, -0.8]$ 与 $B_{\\mathrm{wr}} = [0.8, 1.0]$。定义泄漏指数\n$$\n\\Lambda = \\frac{D_{y \\mid B_{\\mathrm{tr}}}}{\\frac{1}{2}\\left( D_{y \\mid B_{\\mathrm{wl}}} + D_{y \\mid B_{\\mathrm{wr}}} \\right)},\n$$\n该指数用于量化当仅对粗粒度变量施加偏置时，隐藏势垒在多大程度上泄漏到精细修正动力学中。\n\n使用以下规范实现模拟：\n- 步长为 $dt$ 的离散时间积分。\n- 每一步为 $x$ 和 $y$ 独立生成方差为 $2 D_0 dt$、均值为零的高斯噪声。\n- 在 $(x_0, y_0)$ 初始化 $(x,y)$。\n- 每隔 $\\tau_{\\mathrm{dep}}$ 步在当前的 $s_0(x)$ 处沉积元动力学高斯函数。\n\n使用以下参数集测试套件来评估隐藏势垒异质性和偏置强度在不同机制下的表现。每个测试用例是一个元组，指定了 $(\\text{steps}, dt, \\alpha, \\beta, B_0, B_1, \\sigma_x, \\ell, W, \\sigma_s, \\tau_{\\mathrm{dep}}, n_{\\mathrm{lag}}, x_0, y_0, \\text{seed})$：\n1. $(40000, 0.002, 1.0, 2.0, 0.5, 4.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 12345)$\n2. $(40000, 0.002, 1.0, 2.0, 0.5, 0.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 23456)$\n3. $(40000, 0.002, 1.0, 2.0, 0.5, 8.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 34567)$\n4. $(40000, 0.002, 1.0, 2.0, 0.5, 4.0, 0.6, 0.7, 0.40, 0.20, 250, 20, -1.0, 0.0, 45678)$\n\n对于每个测试用例，运行模拟，按规定计算 $D_{y \\mid B_{\\mathrm{tr}}}$ 和 $D_{y \\mid B_{\\mathrm{wl}}}, D_{y \\mid B_{\\mathrm{wr}}}$，并返回泄漏指数 $\\Lambda$（一个浮点数）。在所选的约化单位中，所有量都是无量纲的。你的程序应生成单行输出，其中包含测试套件的四个泄漏指数，以逗号分隔并用方括号括起来（例如，\"[0.75,0.98,0.40,0.77]\"）。",
            "solution": "该问题要求模拟一个二维随机系统，并随后分析其扩散性质。该方法基于统计力学原理，特别是通过过阻尼朗之万方程描述的布朗运动理论，以及用于增强采样的元动力学计算技术。\n\n系统的状态由坐标 $(x(t), y(t))$ 给出，其演化由以下过阻尼极限下的耦合随机微分方程（SDEs）控制：\n$$\n\\dot{x}(t) = -\\mu \\frac{\\partial}{\\partial x} \\left[ U(x,y) + V(s_0(x), t) \\right] + \\sqrt{2 D_0} \\,\\xi_x(t)\n$$\n$$\n\\dot{y}(t) = -\\mu \\frac{\\partial}{\\partial y} U(x,y) + \\sqrt{2 D_0} \\,\\xi_y(t)\n$$\n这里，$U(x,y)$ 是静态势能，$V(s_0(x), t)$ 是来自元动力学的时间依赖性偏置势，仅沿粗粒度集体变量 $s_0(x)$ 施加。项 $\\xi_x(t)$ 和 $\\xi_y(t)$ 代表不相关的高斯白噪声。问题指定了约化单位，其中迁移率为 $\\mu=1$，扩散常数为 $D_0=1$。\n\n该问题分两个主要阶段解决：通过数值积分生成轨迹和模拟后的数据分析。\n\n**1. 轨迹生成：Euler-Maruyama 积分**\nSDEs 使用 Euler-Maruyama 方法进行数值积分，这是将常微分方程的欧拉方法直接扩展到随机微分方程的方法。对于时间步长 $dt$，第 $n+1$ 步的坐标由第 $n$ 步更新如下：\n$$\nx_{n+1} = x_n + F_x(x_n, y_n, t_n) \\, dt + \\sqrt{2 D_0 dt} \\, \\mathcal{N}_{x,n}\n$$\n$$\ny_{n+1} = y_n + F_y(x_n, y_n) \\, dt + \\sqrt{2 D_0 dt} \\, \\mathcal{N}_{y,n}\n$$\n其中 $x_n = x(t_n)$，$y_n = y(t_n)$，$\\mathcal{N}_{x,n}, \\mathcal{N}_{y,n}$ 是从标准正态分布 $\\mathcal{N}(0,1)$ 中抽取的独立随机数。力 $F_x$ 和 $F_y$ 根据总势能 $U_{\\text{tot}}(x,y,t) = U(x,y) + V(s_0(x), t)$ 计算。\n\n力的分量为：\n$F_y = -\\frac{\\partial U}{\\partial y}$\n$F_x = -\\frac{\\partial U}{\\partial x} - \\frac{\\partial V}{\\partial x}$\n\n静态势 $U(x,y) = U_0(x) + U_1(y;x)$ 产生以下力：\n$$\nF_{U,y} = -\\frac{\\partial U_1}{\\partial y} = -B(x)(y^3 - y)\n$$\n$$\nF_{U,x} = -\\frac{\\partial U_0}{\\partial x} - \\frac{\\partial U_1}{\\partial x} = -(\\alpha x^3 - \\beta x) - \\frac{\\partial B(x)}{\\partial x}\\left(\\frac{y^4}{4} - \\frac{y^2}{2}\\right)\n$$\n其中 $\\frac{\\partial B(x)}{\\partial x} = -B_1 \\frac{x}{\\sigma_x^2} \\exp\\left(-\\frac{x^2}{2\\sigma_x^2}\\right)$。\n\n元动力学力 $F_{V,x}$ 使用链式法则计算，$F_{V,x} = - \\frac{\\partial V}{\\partial s_0} \\frac{d s_0}{d x}$。各项为：\n$$\n\\frac{d s_0}{dx} = \\frac{d}{dx}\\tanh(x/\\ell) = \\frac{1}{\\ell} \\operatorname{sech}^2(x/\\ell) = \\frac{1}{\\ell}(1 - s_0^2)\n$$\n偏置势 $V(s_0, t_n)$ 是在先前时刻沉积的高斯函数之和。在每个模拟步骤中，其导数计算如下：\n$$\n\\frac{\\partial V}{\\partial s_0} = \\sum_{j=1}^{N_{\\mathrm{dep}}(n)} W \\left( -\\frac{s_0 - s_0^{(j)}}{\\sigma_s^2} \\right) \\exp\\left( -\\frac{(s_0 - s_0^{(j)})^2}{2 \\sigma_s^2} \\right)\n$$\n其中中心集合 $\\{s_0^{(j)}\\}$ 每隔 $\\tau_{\\mathrm{dep}}$ 步通过添加 $s_0(x_n)$ 的当前值进行更新。\n\n模拟在 $(x_0, y_0)$ 处初始化，并运行指定的总步数。完整的 $x(t)$ 和 $y(t)$ 轨迹被存储以供分析。\n\n**2. 数据分析：条件扩散**\n生成轨迹后，我们分析“隐藏”自由度 $y$ 的动力学，条件是粗粒度变量 $s_0(x) = \\tanh(x/\\ell)$ 的值。\n\n首先，从存储的 $x(t_n)$ 轨迹计算粗粒度变量的轨迹 $s_0(t_n)$。\n\n要计算的核心量是 $y$ 坐标的条件均方根位移（MSD），$\\operatorname{MSD}_B(\\tau)$。它被定义为在时间延迟 $\\tau = n_{\\mathrm{lag}} dt$ 内 $y$ 的平均平方位移，仅考虑那些在整个延迟区间 $[t, t+\\tau]$ 内粗粒度变量 $s_0(t')$ 保持在特定区间 $B=[a,b]$ 内的轨迹段。从离散轨迹来看，其计算方式为：\n$$\n\\operatorname{MSD}_B(\\tau) = \\frac{1}{N_B} \\sum_{i \\in S_B} (y_{i+n_{\\mathrm{lag}}} - y_i)^2\n$$\n其中 $S_B$ 是时间索引 $i$ 的集合，使得对于从 $i$ 到 $i+n_{\\mathrm{lag}}$ 的所有整数 $k$，都有 $s_0(t_k) \\in [a,b]$。$N_B$ 是此类有效段的总数。\n\n相应的条件扩散系数随后使用短时近似进行估计：\n$$\nD_{y \\mid B} \\approx \\frac{\\operatorname{MSD}_B(\\tau)}{2 \\tau}\n$$\n此计算针对 $s_0$ 的三个不同区间进行：一个过渡区域区间 $B_{\\mathrm{tr}} = [-0.1, 0.1]$，以及两个势阱区域区间 $B_{\\mathrm{wl}} = [-1.0, -0.8]$ 和 $B_{\\mathrm{wr}} = [0.8, 1.0]$。这些区间分别对应于 $U_0(x)$ 中势垒顶部（在 $x=0$ 处，因此 $s_0=0$）的邻域和 $U_0(x)$ 势能最小值（在 $x \\approx \\pm \\sqrt{\\beta/\\alpha}$ 处，因此 $s_0 \\approx \\pm 1$）的邻域。\n\n最后，计算泄漏指数 $\\Lambda$。这是一个无量纲比率，用于量化在过渡区域中 $y$ 坐标的局域扩散与势阱区域中的平均扩散相比被抑制的程度：\n$$\n\\Lambda = \\frac{D_{y \\mid B_{\\mathrm{tr}}}}{\\frac{1}{2}\\left( D_{y \\mid B_{\\mathrm{wl}}} + D_{y \\mid B_{\\mathrm{wr}}} \\right)}\n$$\n$\\Lambda  1$ 的值表示在 $x=0$ 处最大的势垒高度 $B(x)$ 在 $y$ 动力学中产生了一个“瓶颈”，而这并未被粗粒度变量 $s_0$ 单独捕捉到。这种现象正是问题所指的隐藏势垒信息的“泄漏”。$\\Lambda \\approx 1$ 的值表明，要么势垒调制可以忽略不计，要么粗粒度变量足以描述系统的慢动力学。对测试套件中提供的每个参数集重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and analysis for all test cases.\n    \"\"\"\n    test_cases = [\n        # (steps, dt, alpha, beta, B0, B1, sigma_x, l, W, sigma_s, tau_dep, n_lag, x0, y0, seed)\n        (40000, 0.002, 1.0, 2.0, 0.5, 4.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 12345),\n        (40000, 0.002, 1.0, 2.0, 0.5, 0.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 23456),\n        (40000, 0.002, 1.0, 2.0, 0.5, 8.0, 0.6, 0.7, 0.15, 0.20, 250, 20, -1.0, 0.0, 34567),\n        (40000, 0.002, 1.0, 2.0, 0.5, 4.0, 0.6, 0.7, 0.40, 0.20, 250, 20, -1.0, 0.0, 45678),\n    ]\n\n    results = []\n    for params in test_cases:\n        leakage_index = run_simulation_and_analysis(params)\n        results.append(leakage_index)\n\n    # Format the final output string exactly as required.\n    print(f\"[{','.join(map(str, np.round(results, 2)))}]\")\n\n\ndef run_simulation_and_analysis(params):\n    \"\"\"\n    Performs the simulation and subsequent analysis for a single test case.\n    \"\"\"\n    (steps, dt, alpha, beta, B0, B1, sigma_x, l, W, sigma_s,\n     tau_dep, n_lag, x0, y0, seed) = params\n\n    # Reduced units constants\n    D0 = 1.0\n    mu = 1.0\n    sqrt_2D0dt = np.sqrt(2 * D0 * dt)\n\n    # Initialize random number generator\n    rng = np.random.default_rng(seed)\n\n    # Initialize trajectories and metadynamics\n    x_traj, y_traj = np.zeros(steps), np.zeros(steps)\n    x, y = x0, y0\n    meta_centers = []\n\n    # Simulation loop\n    for i in range(steps):\n        x_traj[i], y_traj[i] = x, y\n\n        # --- Metadynamics update ---\n        if i > 0 and i % tau_dep == 0:\n            s0_current = np.tanh(x / l)\n            meta_centers.append(s0_current)\n\n        # --- Force Calculation ---\n        # Force from U0(x)\n        F_U0_x = -(alpha * x**3 - beta * x)\n\n        # Force from U1(y; x)\n        B_x = B0 + B1 * np.exp(-x**2 / (2 * sigma_x**2))\n        F_U1_y = -B_x * (y**3 - y)\n        \n        dBdx = -B1 * (x / sigma_x**2) * np.exp(-x**2 / (2 * sigma_x**2))\n        F_U1_x = -dBdx * (y**4 / 4 - y**2 / 2)\n\n        # Force from Metadynamics V(s0, t)\n        s0 = np.tanh(x / l)\n        ds0_dx = (1 / l) * (1 - s0**2)\n        \n        F_V_x = 0.0\n        if meta_centers:\n            s0_diff = s0 - np.array(meta_centers)\n            exp_term = np.exp(-s0_diff**2 / (2 * sigma_s**2))\n            # dV/ds0 = sum over Gaussians\n            dV_ds0 = np.sum(W * exp_term * (-s0_diff / sigma_s**2))\n            F_V_x = -dV_ds0 * ds0_dx\n\n        # Total forces\n        F_x = F_U0_x + F_U1_x + F_V_x\n        F_y = F_U1_y\n\n        # --- Euler-Maruyama Step ---\n        noise_x = rng.normal(0, 1)\n        noise_y = rng.normal(0, 1)\n        \n        x += F_x * dt * mu + sqrt_2D0dt * noise_x\n        y += F_y * dt * mu + sqrt_2D0dt * noise_y\n        \n    # --- Analysis ---\n    s0_traj = np.tanh(x_traj / l)\n    \n    bins = {\n        \"tr\": [-0.1, 0.1],\n        \"wl\": [-1.0, -0.8],\n        \"wr\": [0.8, 1.0]\n    }\n\n    D_y_cond = {}\n    for key, bin_range in bins.items():\n        D_y_cond[key] = calculate_conditional_diffusion(y_traj, s0_traj, bin_range, n_lag, dt)\n\n    # --- Leakage Index Calculation ---\n    D_tr = D_y_cond[\"tr\"]\n    D_wells_avg = 0.5 * (D_y_cond[\"wl\"] + D_y_cond[\"wr\"])\n\n    if D_wells_avg == 0:\n        # This case suggests no motion was sampled in the wells, which is unlikely.\n        # Return NaN to indicate a pathological result.\n        leakage_index = np.nan\n    else:\n        leakage_index = D_tr / D_wells_avg\n    \n    return leakage_index\n\n\ndef calculate_conditional_diffusion(y_traj, s0_traj, bin_range, n_lag, dt):\n    \"\"\"\n    Calculates the conditional diffusion coefficient D_{y|B}.\n    \"\"\"\n    total_sq_disp = 0.0\n    count = 0\n    num_steps = len(y_traj)\n    \n    for i in range(num_steps - n_lag):\n        s0_segment = s0_traj[i : i + n_lag + 1]\n        \n        # Check if the entire segment is within the bin\n        if np.all((s0_segment >= bin_range[0])  (s0_segment = bin_range[1])):\n            sq_disp = (y_traj[i + n_lag] - y_traj[i])**2\n            total_sq_disp += sq_disp\n            count += 1\n            \n    if count == 0:\n        return 0.0\n\n    msd = total_sq_disp / count\n    tau = n_lag * dt\n    D = msd / (2 * tau)\n    \n    return D\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "元动力学中的偏置势是一个持续对系统做功的外部作用力，但这部分能量的注入会对系统的动力学产生什么影响？本练习  探讨了这一关键但常被忽视的问题，要求你为无控温（NVE）和有控温（Langevin）的系统建立“能量收支”模型。通过这种方式，你将学会如何预测偏置何时可能导致非物理性的局部加热或动力学伪影，确保模拟结果的物理真实性。",
            "id": "3425171",
            "problem": "要求您为元动力学中的含时偏置形式化一个能量收支准则，并在不同的动力学设定下测试其影响。请在一个简化描述下进行分析，其中偏置作为对系统的均匀功率注入，并从第一性原理出发，对能量平衡和热化进行论证。\n\n起始点与定义：\n- 考虑一个在温度 $T$ 下拥有 $N_{\\text{dof}}$ 个二次自由度的系统。玻尔兹曼常数为 $k_{\\mathrm{B}}$。能量均分定理意味着每个自由度的特征能量标度为 $k_{\\mathrm{B}} T$。\n- 一个类元动力学偏置以恒定功率速率 $r$（单位 $\\mathrm{J}/\\mathrm{s}$）沉积能量，这可以被解释为在当前集体变量位置频繁添加微小高斯势垒的理想化极限。\n- 定义无量纲收支\n$$\n\\eta(t) \\equiv \\frac{E_{\\text{store}}(t)}{N_{\\text{dof}}\\, k_{\\mathrm{B}}\\, T},\n$$\n其中 $E_{\\text{store}}(t)$ 是在时间 $t$（单位 $\\mathrm{s}$）时，系统中由偏置引起的、超出热基线储存的过剩能量（单位 $\\mathrm{J}$）。\n- 假设一个无量纲阈值 $\\epsilon$，并规定当且仅当 $\\eta(t)$ 在相关时间尺度上超过或等于 $\\epsilon$ 时，预期会出现动力学赝象。\n\n您的任务：\n1. 仅使用基本原理，推导在以下两种情况下 $E_{\\text{store}}(t)$ 的形式：\n   - 牛顿微正则系综动力学（无控温器），也称为恒定粒子数、体积和能量的动力学 (NVE)：除偏置所做的功外，能量守恒，因此总能量根据偏置所做的功而增加。\n   - 在温度 $T$ 下，具有线性摩擦系数 $\\gamma$（单位 $\\mathrm{s}^{-1}$）的 Langevin 动力学：由偏置注入的能量根据速度的 Langevin 方程，以一个由 $\\gamma$ 控制的特征弛豫过程耗散掉，并且在没有偏置的情况下，温度为 $T$ 的能量均分是其稳态。\n2. 针对 Langevin 动力学（输入为 $(N_{\\text{dof}}, T, r, t, \\gamma, \\epsilon)$）和 NVE 动力学（输入为 $(N_{\\text{dof}}, T, r, t, \\epsilon)$），提出一个简洁的代数检验，该检验需输出一个布尔值，以指示在时间 $t$ 之前是否预期会出现赝象。此检验必须显式地将 $\\eta(t)$ 与 $\\epsilon$ 进行比较。\n\n物理单位与常数：\n- 使用国际单位制。具体来说，$N_{\\text{dof}}$ 是无量纲的，$T$ 的单位是 $\\mathrm{K}$，$\\gamma$ 的单位是 $\\mathrm{s}^{-1}$，$r$ 的单位是 $\\mathrm{J}/\\mathrm{s}$，$t$ 的单位是 $\\mathrm{s}$。能量以 $\\mathrm{J}$ 表示。\n- 使用精确值 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$。\n- 不涉及角度。\n- 如果需要与阈值进行比较，请将其视为实数比较并返回一个布尔值。\n\n测试组：\n实现您的程序以评估以下六个测试用例。对于每个用例，使用您推导出的表达式计算一个布尔值，以指示在时间 $t$ 之前是否预期会出现赝象，约定为当且仅当 $\\eta(t) \\ge \\epsilon$ 时预期会出现赝象。这些用例涵盖了 Langevin 和 NVE 设定、正常路径、边界条件和时间尺度效应。\n\n- 用例 $\\mathrm{A}$ (Langevin, 在长时间安全): $N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $\\gamma = 10^{12}\\ \\mathrm{s}^{-1}$, $r = 3.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n- 用例 $\\mathrm{B}$ (Langevin, 在长时间出现赝象): $N_{\\text{dof}} = 100$, $T = 300\\ \\mathrm{K}$, $\\gamma = 5.0 \\times 10^{11}\\ \\mathrm{s}^{-1}$, $r = 6.6271152 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 1.0 \\times 10^{-11}\\ \\mathrm{s}$, $\\epsilon = 0.15$。\n- 用例 $\\mathrm{C}$ (Langevin, 即使稳态会超过阈值，但在短时间内快速耗散占主导): $N_{\\text{dof}} = 50$, $T = 300\\ \\mathrm{K}$, $\\gamma = 10^{12}\\ \\mathrm{s}^{-1}$, $r = 4.141947 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-14}\\ \\mathrm{s}$, $\\epsilon = 0.05$。\n- 用例 $\\mathrm{D}$ (NVE, 在短时间安全): $N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $r = 1.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 1.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n- 用例 $\\mathrm{E}$ (NVE, 在较长时间出现赝象): $N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $r = 1.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n- 用例 $\\mathrm{F}$ (NVE, 边界恰好在阈值上): $N_{\\text{dof}} = 100$, $T = 300\\ \\mathrm{K}$, $r = 3.10646025 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 2.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.15$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含结果，格式为方括号内以逗号分隔的 Python 布尔字面量列表（例如，$\\left[\\mathrm{True},\\mathrm{False},\\ldots\\right]$），顺序为 $\\mathrm{A}, \\mathrm{B}, \\mathrm{C}, \\mathrm{D}, \\mathrm{E}, \\mathrm{F}$。",
            "solution": "在进行求解之前，对问题陈述的有效性进行评估。\n\n### 第 1 步：提取已知条件\n- **系统属性**：一个在温度 $T$ 下拥有 $N_{\\text{dof}}$ 个二次自由度的系统。\n- **常数**：玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$。\n- **偏置定义**：一个类元动力学偏置以恒定功率速率 $r$（单位 $\\mathrm{J}/\\mathrm{s}$）沉积能量。\n- **无量纲收支定义**：$\\eta(t) \\equiv \\frac{E_{\\text{store}}(t)}{N_{\\text{dof}}\\, k_{\\mathrm{B}}\\, T}$，其中 $E_{\\text{store}}(t)$ 是由偏置引起的储存的过剩能量。\n- **赝象判据**：当且仅当 $\\eta(t) \\ge \\epsilon$ 时，预期会出现动力学赝象，其中 $\\epsilon$ 是给定的无量纲阈值。\n- **动力学模型**：\n    1.  **牛顿微正则动力学 (NVE)**：除偏置所做的功外，能量守恒。输入：$(N_{\\text{dof}}, T, r, t, \\epsilon)$。\n    2.  **Langevin 动力学**：在温度 $T$ 下，具有线性摩擦系数 $\\gamma$（单位 $\\mathrm{s}^{-1}$），能量被耗散。输入：$(N_{\\text{dof}}, T, r, t, \\gamma, \\epsilon)$。\n- **任务**：\n    1.  为 NVE 和 Langevin 动力学推导 $E_{\\text{store}}(t)$ 的形式。\n    2.  提出并实现一个代数检验，以确定在时间 $t$ 之前是否预期会出现赝象。\n- **单位**：国际单位制 (SI)。\n- **测试用例**：\n    - 用例 A (Langevin)：$N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $\\gamma = 10^{12}\\ \\mathrm{s}^{-1}$, $r = 3.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n    - 用例 B (Langevin)：$N_{\\text{dof}} = 100$, $T = 300\\ \\mathrm{K}$, $\\gamma = 5.0 \\times 10^{11}\\ \\mathrm{s}^{-1}$, $r = 6.6271152 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 1.0 \\times 10^{-11}\\ \\mathrm{s}$, $\\epsilon = 0.15$。\n    - 用例 C (Langevin)：$N_{\\text{dof}} = 50$, $T = 300\\ \\mathrm{K}$, $\\gamma = 10^{12}\\ \\mathrm{s}^{-1}$, $r = 4.141947 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-14}\\ \\mathrm{s}$, $\\epsilon = 0.05$。\n    - 用例 D (NVE)：$N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $r = 1.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 1.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n    - 用例 E (NVE)：$N_{\\text{dof}} = 300$, $T = 300\\ \\mathrm{K}$, $r = 1.0 \\times 10^{-7}\\ \\mathrm{J}/\\mathrm{s}$, $t = 5.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.2$。\n    - 用例 F (NVE)：$N_{\\text{dof}} = 100$, $T = 300\\ \\mathrm{K}$, $r = 3.10646025 \\times 10^{-8}\\ \\mathrm{J}/\\mathrm{s}$, $t = 2.0 \\times 10^{-12}\\ \\mathrm{s}$, $\\epsilon = 0.15$。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，对分子动力学中的能量注入和耗散进行建模，这是计算物理学中一个标准且被充分理解的课题。它使用了标准的形式体系（NVE 和 Langevin 动力学）和已确立的原理（能量均分定理、能量守恒、涨落-耗散）。问题是适定的，提供了所有必要的参数和定义以得出唯一解。语言客观而精确。恒定功率注入的理想化是构建形式模型时的一个有效简化。该问题不违反任何无效性标准。\n\n### 第 3 步：结论与行动\n问题是**有效**的。将提供解答。\n\n### 解答推导\n\n分析从储存的过剩能量 $E_{\\text{store}}(t)$ 的能量平衡原理开始。该能量的变化率是偏置注入的功率与耗散到环境中的功率之差。\n$$\n\\frac{dE_{\\text{store}}(t)}{dt} = P_{\\text{in}} - P_{\\text{diss}}\n$$\n问题陈述指出，偏置提供恒定的功率注入，因此 $P_{\\text{in}} = r$。\n\n**1. 牛顿微正则 (NVE) 动力学**\n\n在 NVE 系综中，孤立系统的总能量是守恒的。在这里，系统并非孤立；一个外部偏置力对其做功。问题明确指出没有控温器，意味着没有能量耗散机制。因此，$P_{\\text{diss}} = 0$。能量平衡方程简化为：\n$$\n\\frac{dE_{\\text{store}}(t)}{dt} = r\n$$\n在初始条件 $E_{\\text{store}}(0) = 0$（开始时没有过剩能量）下对此方程积分，得到时间 $t$ 时的储存能量：\n$$\nE_{\\text{store}}(t) = \\int_0^t r \\, d\\tau = rt\n$$\n能量只是随时间线性累积。\n\n**2. Langevin 动力学**\n\n在 Langevin 动力学中，系统通过摩擦力和随机力与温度为 $T$ 的热浴耦合。这种耦合提供了一种能量耗散机制。耗散速率 $P_{\\text{diss}}$ 取决于系统状态偏离与热浴的热平衡有多远。在线性响应区域，净耗散功率与系统中储存的过剩能量 $E_{\\text{store}}(t)$ 成正比。\n$$\nP_{\\text{diss}}(t) = k_{\\text{diss}} E_{\\text{store}}(t)\n$$\n速率常数 $k_{\\text{diss}}$ 与摩擦系数 $\\gamma$ 相关。粒子速度 $v$ 的 Langevin 方程中的摩擦项为 $-\\gamma_{\\text{particle}} v$，它导致速度扰动以速率 $\\gamma = \\gamma_{\\text{particle}}/m$（单位为 $\\mathrm{s}^{-1}$）指数衰减。由于动能与 $v^2$ 成正比，动能的扰动以 $2\\gamma$ 的速率弛豫。假设 $N_{\\text{dof}}$ 个自由度在热化方面表现相似，我们假设总过剩能量以这个速率耗散。因此，$k_{\\text{diss}} = 2\\gamma$。\n\n能量平衡方程变成一个一阶线性常微分方程：\n$$\n\\frac{dE_{\\text{store}}(t)}{dt} = r - 2\\gamma E_{\\text{store}}(t)\n$$\n该方程可以在初始条件 $E_{\\text{store}}(0) = 0$ 下求解。整理后得到：\n$$\n\\frac{dE_{\\text{store}}}{r - 2\\gamma E_{\\text{store}}} = dt\n$$\n对两边积分：\n$$\n\\int_0^{E_{\\text{store}}(t)} \\frac{dE'}{r - 2\\gamma E'} = \\int_0^t d\\tau\n$$\n$$\n\\left[ -\\frac{1}{2\\gamma} \\ln(r - 2\\gamma E') \\right]_0^{E_{\\text{store}}(t)} = t\n$$\n$$\n-\\frac{1}{2\\gamma} \\left[ \\ln(r - 2\\gamma E_{\\text{store}}(t)) - \\ln(r) \\right] = t\n$$\n$$\n\\ln\\left(\\frac{r - 2\\gamma E_{\\text{store}}(t)}{r}\\right) = -2\\gamma t\n$$\n$$\n1 - \\frac{2\\gamma E_{\\text{store}}(t)}{r} = e^{-2\\gamma t}\n$$\n求解 $E_{\\text{store}}(t)$ 得到 Langevin 动力学的最终表达式：\n$$\nE_{\\text{store}}(t) = \\frac{r}{2\\gamma} \\left(1 - e^{-2\\gamma t}\\right)\n$$\n这个结果正确地捕捉了两个极限情况。对于短时间（$t \\ll 1/(2\\gamma)$），使用泰勒展开 $e^{-x} \\approx 1-x$，我们得到 $E_{\\text{store}}(t) \\approx \\frac{r}{2\\gamma}(1 - (1-2\\gamma t)) = rt$，这恢复了 NVE 的结果。对于长时间（$t \\to \\infty$），系统达到稳态，此时 $E_{\\text{store}}(t) \\to \\frac{r}{2\\gamma}$，在这一点上，功率注入 $r$ 与耗散 $P_{\\text{diss}} = 2\\gamma \\left(\\frac{r}{2\\gamma}\\right) = r$ 完全平衡。\n\n**3. 赝象的代数检验**\n\n动力学赝象的判据是 $\\eta(t) \\ge \\epsilon$。该检验通过计算给定动力学下的 $\\eta(t)$ 并将其与阈值 $\\epsilon$ 进行比较来实现。\n\n- **对于 NVE 动力学**：\n  检验是评估布尔表达式：\n  $$\n  \\frac{rt}{N_{\\text{dof}} k_{\\mathrm{B}} T} \\ge \\epsilon\n  $$\n\n- **对于 Langevin 动力学**：\n  检验是评估布尔表达式：\n  $$\n  \\frac{r}{2\\gamma N_{\\text{dof}} k_{\\mathrm{B}} T} \\left(1 - e^{-2\\gamma t}\\right) \\ge \\epsilon\n  $$\n这些表达式在提供的代码中实现，用以评估测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the metadynamics energy budget problem for the given test cases.\n    \"\"\"\n    \n    # Define physical constants\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n\n    def check_artifact_nve(n_dof, T, r, t, epsilon):\n        \"\"\"\n        Calculates if an artifact is expected for NVE dynamics.\n\n        Args:\n            n_dof (int): Number of degrees of freedom.\n            T (float): Temperature in Kelvin.\n            r (float): Power injection rate in J/s.\n            t (float): Time in seconds.\n            epsilon (float): Dimensionless artifact threshold.\n        \n        Returns:\n            bool: True if an artifact is expected, False otherwise.\n        \"\"\"\n        # Thermal energy scale E_char = N_dof * k_B * T\n        e_char = n_dof * K_B * T\n        \n        # Stored energy for NVE: E_store = r * t\n        e_store = r * t\n        \n        # Dimensionless budget eta = E_store / E_char\n        eta = e_store / e_char\n        \n        return eta >= epsilon\n\n    def check_artifact_langevin(n_dof, T, r, t, gamma, epsilon):\n        \"\"\"\n        Calculates if an artifact is expected for Langevin dynamics.\n\n        Args:\n            n_dof (int): Number of degrees of freedom.\n            T (float): Temperature in Kelvin.\n            r (float): Power injection rate in J/s.\n            t (float): Time in seconds.\n            gamma (float): Friction coefficient in 1/s.\n            epsilon (float): Dimensionless artifact threshold.\n\n        Returns:\n            bool: True if an artifact is expected, False otherwise.\n        \"\"\"\n        # Thermal energy scale E_char = N_dof * k_B * T\n        e_char = n_dof * K_B * T\n        \n        # Stored energy for Langevin: E_store = (r / 2*gamma) * (1 - exp(-2*gamma*t))\n        # Handle the case where the argument of exp is very small or large.\n        # Numpy's exp is numerically stable and handles this well.\n        exponent_arg = -2.0 * gamma * t\n        e_store = (r / (2.0 * gamma)) * (1.0 - np.exp(exponent_arg))\n        \n        # Dimensionless budget eta = E_store / E_char\n        eta = e_store / e_char\n        \n        return eta >= epsilon\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (Langevin): N_dof=300, T=300, gamma=1e12, r=3.0e-7, t=5.0e-12, eps=0.2\n        {'type': 'langevin', 'params': {'n_dof': 300, 'T': 300.0, 'gamma': 1.0e12, 'r': 3.0e-7, 't': 5.0e-12, 'epsilon': 0.2}},\n        \n        # Case B (Langevin): N_dof=100, T=300, gamma=5.0e11, r=6.6271152e-8, t=1.0e-11, eps=0.15\n        {'type': 'langevin', 'params': {'n_dof': 100, 'T': 300.0, 'gamma': 5.0e11, 'r': 6.6271152e-8, 't': 1.0e-11, 'epsilon': 0.15}},\n        \n        # Case C (Langevin): N_dof=50, T=300, gamma=1e12, r=4.141947e-8, t=5.0e-14, eps=0.05\n        {'type': 'langevin', 'params': {'n_dof': 50, 'T': 300.0, 'gamma': 1.0e12, 'r': 4.141947e-8, 't': 5.0e-14, 'epsilon': 0.05}},\n        \n        # Case D (NVE): N_dof=300, T=300, r=1.0e-7, t=1.0e-12, eps=0.2\n        {'type': 'nve', 'params': {'n_dof': 300, 'T': 300.0, 'r': 1.0e-7, 't': 1.0e-12, 'epsilon': 0.2}},\n        \n        # Case E (NVE): N_dof=300, T=300, r=1.0e-7, t=5.0e-12, eps=0.2\n        {'type': 'nve', 'params': {'n_dof': 300, 'T': 300.0, 'r': 1.0e-7, 't': 5.0e-12, 'epsilon': 0.2}},\n\n        # Case F (NVE): N_dof=100, T=300, r=3.10646025e-8, t=2.0e-12, eps=0.15\n        {'type': 'nve', 'params': {'n_dof': 100, 'T': 300.0, 'r': 3.10646025e-8, 't': 2.0e-12, 'epsilon': 0.15}},\n    ]\n\n    results = []\n    for case in test_cases:\n        if case['type'] == 'langevin':\n            # Unpack parameters for Langevin dynamics\n            p = case['params']\n            result = check_artifact_langevin(\n                n_dof=p['n_dof'], T=p['T'], r=p['r'], t=p['t'], gamma=p['gamma'], epsilon=p['epsilon']\n            )\n        elif case['type'] == 'nve':\n            # Unpack parameters for NVE dynamics\n            p = case['params']\n            result = check_artifact_nve(\n                n_dof=p['n_dof'], T=p['T'], r=p['r'], t=p['t'], epsilon=p['epsilon']\n            )\n        results.append(result)\n\n    # Convert boolean to lowercase string for Python-style output\n    formatted_results = [str(r) for r in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}