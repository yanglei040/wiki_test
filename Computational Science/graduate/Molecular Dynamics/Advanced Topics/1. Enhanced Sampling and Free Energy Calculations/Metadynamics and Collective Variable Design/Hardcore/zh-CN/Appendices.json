{
    "hands_on_practices": [
        {
            "introduction": "任何元动力学研究的第一步也是最关键的一步是选择一组好的集体变量 (CVs)。如果一个 CV 无法区分系统中重要的长寿命状态，那么它就是无用的。本练习  展示了一个典型的失败场景，并要求您找出其根本原因，从而强化 CV 设计的基本原则。",
            "id": "2457761",
            "problem": "为加速溶液中从反应物态 $R$ 到产物态 $P$ 的异构化反应，我们进行了一次元动力学模拟。该模拟使用单个集体变量 (CV)，即原子 $X$ 和 $Y$ 之间的距离 $s(\\mathbf{R}) = d_{X Y}$，其中 $\\mathbf{R}$ 表示完整的原子坐标集。在偏置运行期间，$s$ 的时间序列显示其在 $s \\approx s_{0}$ 附近有长时间的停留和间歇性的逃逸，但向 $P$ 的转变极为罕见。对 $s \\approx s_{0}$ 的帧进行的独立结构分析揭示了2个结构上不同的微观状态：预期的反应物 $R$ 和一个偏离路径的捕获态 $T$。当模拟在 $R$ 和 $T$ 之间交替时，历史依赖的偏置在 $s \\approx s_{0}$ 附近累积，但在沿 $s$ 重建的自由能面上，朝向 $P$ 的能垒仍然很高。未检测到积分时间步长不稳定性或能量漂移，并且温度控制表现正常。\n\n根据元动力学和集体变量设计的基本原理，哪个选项最能诊断失败模式并确定最合适的纠正措施？\n\nA. 高斯势的高度和沉积频率太小；增加它们将通过更快地填充 $R$ 势阱来解决问题，而无需考虑CV的质量。\n\nB. 所选的CV $s(\\mathbf{R}) = d_{X Y}$ 不具有区分性，因为它将 $R$ 和 $T$ 映射到相同的值 $s \\approx s_{0}$，导致非马尔可夫的投影动力学和偏置沉积，从而混淆了不同的势阱；补救措施是重新设计CV以区分 $R$ 和 $T$，例如，通过增加维度将其扩展为多维集合 $(d_{X Y}, c)$（其中 $c$ 是一个配位数），或通过引入一个可以分离 $R$ 和 $T$ 的二面角 $\\phi$。\n\nC. 高斯势的宽度 $\\sigma$ 太大；减小 $\\sigma$ 将会分离 $R$ 和 $T$，即使它们的 $s(\\mathbf{R})$ 值完全相同。\n\nD. 切换到适温元动力学（Well-Tempered Metadynamics, WTMetaD）将通过调和偏置的增长来自动解开 $R$ 和 $T$，而无需改变CV。\n\nE. 后处理重加权可以在CV简并的情况下重建沿 $s$ 到达 $P$ 的正确能垒，因此不需要改变CV。",
            "solution": "首先必须验证问题陈述的科学合理性和逻辑一致性。\n\n**第一步：提取已知条件**\n- 使用元动力学模拟来研究异构化反应 $R \\rightarrow P$。\n- 集体变量 (CV) 是单个原子距离，$s(\\mathbf{R}) = d_{X Y}$。\n- 模拟在特定CV值 $s \\approx s_{0}$ 附近表现出长时间的停留。\n- 向产物态 $P$ 的转变极为罕见。\n- 结构分析揭示了两个不同的微观状态，反应物 $R$ 和一个捕获态 $T$，两者都对应于 $s \\approx s_{0}$。\n- 当体系在 $R$ 和 $T$ 之间转变时，历史依赖的偏置势在 $s \\approx s_{0}$ 区域累积。\n- 沿 $s$ 重建的自由能面 (FES) 仍然显示出朝向 $P$ 的巨大能垒。\n- 模拟在技术上是可靠的（没有积分错误，温度稳定）。\n\n**第二步：使用提取的已知条件进行验证**\n该问题描述了在使用增强采样方法（如元动力学）的分子模拟中一个典型且经常遇到的问题。问题的核心在于集体变量的选择。\n- **科学依据：** 该场景完全基于统计力学和计算化学的既定原理。集体变量、自由能面、元动力学偏置以及隐藏的慢自由度等概念是该领域的核心。所描述的情况是因CV选择不当而导致模拟失败的教科书式案例。\n- **问题定义良好：** 问题提供了一组清晰的观察结果，并要求进行诊断和提出补救措施。给出的信息是自洽的，足以根据元动力学方法的原理得出一个唯一的、理由充分的结论。\n- **客观性：** 语言技术性强且精确。它描述了模拟中可观察到的现象，没有使用主观或模糊的术语。\n\n**第三步：结论与行动**\n问题陈述是有效的。它科学合理、定义良好且客观。我将继续对选项进行全面推导和分析。\n\n**解题推导**\n元动力学的基本原理是通过构建一个历史依赖的偏置势 $V_G(\\vec{\\xi}, t)$ 来加速沿一组选定的集体变量 $\\vec{\\xi} = \\{\\xi_1, \\xi_2, ..., \\xi_d\\}$ 的采样。该势通常是在CV空间中，体系访问过的位置上随时间沉积的高斯函数之和：\n$$ V_G(\\vec{\\xi}, t) = \\sum_{t'  t, t'=\\tau, 2\\tau, \\dots} W \\exp\\left(-\\sum_{i=1}^{d} \\frac{(\\xi_i(t') - \\xi_i)^2}{2\\sigma_i^2}\\right) $$\n其中 $W$ 是高斯势的高度，$\\sigma_i$ 是第 $i$ 个CV的宽度，$\\tau$ 是沉积步长。目标是让 $V_G$ 最终补偿底层的自由能面 (FES) $F(\\vec{\\xi})$，从而实现对CV空间的均匀采样。\n\n元动力学成功的一个关键要求是，所选的CVs $\\vec{\\xi}$ 必须足以区分所有相关的长寿命状态（反应物、产物、中间体和捕获态）。换句话说，CV集合必须包含所有控制目标转变的“慢”自由度。如果存在一个与所选CV空间正交的慢自由度（我们称之为 $q$），该方法就会失败。\n\n在这个问题中，单个CV是 $s = d_{XY}$。关键信息是两个结构上不同的状态，反应物 $R$ 和捕获态 $T$，具有几乎相同的CV值：$s(R) \\approx s_0$ 和 $s(T) \\approx s_0$。这意味着必须存在至少另一个慢变量 $q$ 来区分 $R$ 和 $T$。例如，$R$ 和 $T$ 可能是不同的构象异构体，其中距离 $d_{XY}$ 恰好相同。系统的真实状态由坐标 $(s, q)$ 描述，但偏置势只是 $s$ 的函数，即 $V_G(s, t)$。\n\n当系统处于状态 $R$ 时，其坐标约为 $(s_0, q_R)$。当处于状态 $T$ 时，其坐标为 $(s_0, q_T)$。元动力学模拟在 $s \\approx s_0$ 处沉积高斯偏置，试图将系统推出这个自由能阱。然而，由于偏置 $V_G(s, t)$ 不依赖于 $q$，它对状态 $R$ 和 $T$ 的作用是相同的。模拟将其计算资源消耗在同时填充 $R$ 和 $T$ 两个势阱上。偏置势实际上被“浪费”在试图克服沿隐藏坐标 $q$ 方向上 $R$ 和 $T$ 之间的能垒，而它无法在这个方向上施加有针对性的力。因为在 $s_0$ 附近累积了如此多的偏置来处理 $R$ 和 $T$ 两个状态，沿 $s$ 朝向产物 $P$ 的探索效率低下，并且通往 $P$ 的能垒采样不足，因此在重建的FES中显得很高。投影到CV $s$ 上的动力学是非马尔可夫的，因为从 $s(t)$ 开始的未来演化依赖于未被观测的状态变量 $q(t)$。\n\n唯一有效的补救措施是增加CV集以打破这种简并性。必须选择一个新的CV $\\xi_2$，使得 $\\xi_2(R) \\neq \\xi_2(T)$。这使得系统状态在新的二维CV空间 $(s, \\xi_2)$ 中变得可区分，从而允许元动力学算法正确识别并填充 $R$ 和 $T$ 的不同自由能盆地。\n\n**逐项分析**\n\nA. 高斯势的高度和沉积频率太小；增加它们将通过更快地填充 $R$ 势阱来解决问题，而无需考虑CV的质量。\n**分析：** 这是不正确的。增加高斯势高度 $W$ 或沉积频率（即减小 $\\tau$）意味着以更快的速率增加偏置势。鉴于CV不具区分性的根本问题，这只会加速这个有缺陷的过程。更多的偏置将被沉积在 $s \\approx s_0$ 处，可能导致更大、不受控制的涨落和更扭曲的FES。它没有解决根本原因，即偏置势无法区分状态 $R$ 和 $T$。声称这样做“无论CV质量如何”都有效，这直接违背了增强采样的基本原理。\n**结论：** 不正确。\n\nB. 所选的CV $s(\\mathbf{R}) = d_{X Y}$ 不具有区分性，因为它将 $R$ 和 $T$ 映射到相同的值 $s \\approx s_{0}$，导致非马尔可夫的投影动力学和偏置沉积，从而混淆了不同的势阱；补救措施是重新设计CV以区分 $R$ 和 $T$，例如，通过增加维度将其扩展为多维集合 $(d_{X Y}, c)$（其中 $c$ 是一个配位数），或通过引入一个可以分离 $R$ 和 $T$ 的二面角 $\\phi$。\n**分析：** 这个选项提供了完美的诊断和正确的补救措施。它正确地指出，由于状态 $R$ 和 $T$ 的简并性，CV $s$ 是“不具区分性的”。它准确地描述了其后果：投影到 $s$ 上的动力学非马尔可夫，并且偏置势无法区分两个盆地，导致采样效率低下。提议的解决方案——通过添加另一个可以区分 $R$ 和 $T$ 的变量（如配位数或二面角）来重新设计CV——是解决此类失败的标准且有原则的方法。\n**结论：** 正确。\n\nC. 高斯势的宽度 $\\sigma$ 太大；减小 $\\sigma$ 将会分离 $R$ 和 $T$，即使它们的 $s(\\mathbf{R})$ 值完全相同。\n**分析：** 这是不正确的。高斯势宽度 $\\sigma$ 控制偏置势*沿CV轴*的空间分辨率。较小的 $\\sigma$ 会产生更尖锐的偏置峰。然而，偏置势严格地是 $s$ 的函数，$V_G(s, t)$。如果两个状态 $R$ 和 $T$ 具有相同的CV值，$s(R) = s(T)$，那么作用于它们的偏置将始终相同，$V_G(s(R), t) = V_G(s(T), t)$，无论 $\\sigma$ 的值是多少。参数 $\\sigma$ 无法解决与CV空间正交方向上的简并性。\n**结论：** 不正确。\n\nD. 切换到适温元动力学（Well-Tempered Metadynamics, WTMetaD）将通过调和偏置的增长来自动解开 $R$ 和 $T$，而无需改变CV。\n**分析：** 这是不正确的。适温元动力学（Well-Tempered Metadynamics, WTMetaD）是对标准元动力学的一种改进，其中沉积的高斯势的高度随着该区域偏置的累积而减小。这可以防止自由能阱的“过度填充”，并确保偏置势的更平滑收敛。然而，WTMetaD仍然依赖于所选的CV。偏置势虽然经过调和，但仍然只是 $s$ 的函数。WTMetaD会更温和地填充 $s \\approx s_0$ 处的简并盆地，但它无法“解开”$R$ 和 $T$，因为它没有关于区分它们俩的隐藏坐标 $q$ 的信息。CV选择不当的根本问题依然存在。\n**结论：** 不正确。\n\nE. 后处理重加权可以在CV简并的情况下重建沿 $s$ 到达 $P$ 的正确能垒，因此不需要改变CV。\n**分析：** 这是不正确的。后处理重加权用于从偏置模拟中恢复无偏置的概率分布。公式 $F(s) = -k_B T \\ln P(s)$，其中 $P(s) \\propto \\langle \\delta(s(\\mathbf{R}) - s) \\rangle_{unbiased}$，依赖于对所有相关构象的充分采样。问题明确指出，向 $P$ 的转变“极为罕见”。这表示对过渡态区域和产物盆地的灾难性欠采样。重加权无法从无到有地创造信息；它无法可靠地估计未访问区域的自由能。此外，沿单一坐标 $s$ 进行重加权将产生一个对隐藏变量 $q$ 进行平均的FES，这并不代表 $R \\to P$ 反应的真实最低自由能路径。\n**结论：** 不正确。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "即使当一个 CV 似乎能够分离开反应物和产物状态时，元动力学揭示的自由能垒也可能不是物理真实的。它们有时可能是从高维空间到低维 CV 投影的人为产物。本练习  探讨了这一高级主题，提出了几种诊断方案，以确定观察到的能垒是真实的焓特征还是由 CV 的几何形状引起的人为熵瓶颈。",
            "id": "2655500",
            "problem": "一个溶液中的反应网络通过适温元动力学方法进行探索，使用单个集体变量 (CV) $s = \\xi(\\mathbf{x}) \\in [0,1]$，该变量在 $s \\approx 0$ 处的势阱 $A$ 和 $s \\approx 1$ 处的势阱 $B$ 之间进行插值。沿 $s$ 的边际自由能定义为 $F(s) = -k_{\\mathrm{B}} T \\ln P(s) + C$，其中 $P(s)$ 是在平衡态下观测到 $s$ 的边际概率，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$C$ 是一个任意常数。在元动力学中，偏置势被施加在不常访问的区域以促进探索，并且渐进地，该偏置势会补偿沿所选CV的边际自由能。经过长时间的模拟后，发现在边界 $s \\approx 0$ 附近积累了大量的偏置势。你必须判断这种积累是指示一个真实的微观自由能垒（例如，由于底层势能的增加），还是由CV映射引起的非物理熵瓶颈（例如，由于 $\\xi$ 的几何形状导致边界附近可及相空间体积的减少）。\n\n你的推理只能基于以下基本定义和事实：\n- 沿CV的自由能是平衡边际概率的对数，$F(s) = -k_{\\mathrm{B}} T \\ln P(s) + C$。\n- 如果集合 $\\{\\mathbf{x} : \\xi(\\mathbf{x}) = s\\}$ 的测度（相空间体积）随着 $s$ 趋近边界而迅速缩小，即使微观势能在该处没有系统性增加，也可能出现沿CV的熵瓶颈。\n- 提交函数 (committor function) $p_B(\\mathbf{x})$ 是在无偏置动力学下，微观状态 $\\mathbf{x}$ 在到达势阱 $A$ 之前先到达势阱 $B$ 的概率；一个完美的反应坐标，在重参数化下，是提交函数的一个单调函数。\n\n下列哪种实用的诊断方案最能可靠地检测出边界附近的偏置势积累是由CV定义引起的非物理熵瓶颈，而不是真实的微观自由能垒？可能有一个以上的选项是正确的。\n\nA. 将高斯沉积的高度和宽度都减小2倍，然后重复元动力学模拟。如果大量的偏置势仍然在 $s \\approx 0$ 附近积累，则断定它是一个真实的能垒。\n\nB. 使用重加权方法从有偏置的轨迹中恢复无偏置的统计数据，计算条件平均势能 $\\langle U \\rangle_{\\xi=s}$ 和局部CV度规的估计值 $g(s) = \\langle \\nabla \\xi(\\mathbf{x}) \\cdot \\nabla \\xi(\\mathbf{x}) \\rangle_{\\xi=s}$。如果在 $s \\approx 0$ 附近 $F(s)$ 的增加没有伴随着 $\\langle U \\rangle_{\\xi=s}$ 的增加，而是与局部体积元所隐含的熵项（例如，通过 $\\ln \\sqrt{g(s)}$）的尖峰相关，并且如果通过增加一个缺失的正交描述符来扩充CV集后，表观能垒消失，则断定这是一个由CV引起的熵瓶颈。\n\nC. 将恒温器温度提高10%并重复元动力学模拟。如果在较高的温度 $T$ 下 $s \\approx 0$ 附近的偏置势减少，则断定原始能垒是熵致的。\n\nD. 进行提交函数 (committor) 分析：在表观能垒附近收集 $\\xi(\\mathbf{x}) \\approx s^{\\ast}$ 的微观状态，并通过短时间的无偏置轨迹估计 $p_B(\\mathbf{x})$。如果在固定的 $s^{\\ast}$ 下，$p_B(\\mathbf{x})$ 的分布很宽或呈双峰分布，并且在表观过渡区域不近似以1/2为中心，这表明 $s$ 不是 $p_B$ 的单调函数，则断定该能垒是虚假的，并且是由不良的CV引起的。\n\nE. 通过映射 $s \\mapsto \\mathrm{mod}(s,1)$ 使CV人为地周期化，并重复元动力学模拟。如果边界附近的偏置势积累消失，则断定原始能垒是非物理的。",
            "solution": "该问题要求评估用于区分真实微观自由能垒和由集体变量（CV）定义在元动力学模拟中产生的非物理熵瓶颈的诊断方案。在CV边界 $s \\approx 0$ 附近的大量偏置势积累表明该区域具有高自由能。任务是确定这个高自由能 $\\Delta F$ 是源于底层势能的增加 $\\Delta U$，还是源于可用相空间体积的急剧减少，这对应于熵的负变化 $\\Delta S  0$。自由能定义为 $F(s) = -k_{\\mathrm{B}} T \\ln P(s) + C$，其中 $P(s)$ 是边际概率密度。\n\n一个真实的微观自由能垒通常由焓贡献主导，这意味着能垒区域中的构象 $\\mathbf{x}$ 具有高势能 $U(\\mathbf{x})$。因此，条件平均势能 $\\langle U \\rangle_{\\xi=s} = \\frac{\\int d\\mathbf{x} \\, U(\\mathbf{x}) e^{-U(\\mathbf{x})/(k_{\\mathrm{B}}T)} \\delta(\\xi(\\mathbf{x})-s)}{\\int d\\mathbf{x} \\, e^{-U(\\mathbf{x})/(k_{\\mathrm{B}}T)} \\delta(\\xi(\\mathbf{x})-s)}$ 在能垒区域将显示出显著增加。\n\n一个非物理熵瓶颈，也称为度规诱导能垒，是将高维动力学投影到不良的一维CV $s$ 上的产物。边际概率 $P(s)$ 可以表示为在由 $\\xi(\\mathbf{x}) = s$ 定义的超曲面上的积分：\n$$P(s) = \\int d\\mathbf{x} \\, \\delta(\\xi(\\mathbf{x}) - s) e^{-U(\\mathbf{x})/(k_{\\mathrm{B}}T)}$$\n项 $\\int d\\mathbf{x} \\, \\delta(\\xi(\\mathbf{x}) - s)$ 表示对应于值 $s$ 的超曲面的体积。如果当 $s \\to 0$ 时该体积迅速缩小，$P(s)$ 将会减小，因此 $F(s)$ 将会增加，从而形成一个能垒。即使 $\\langle U \\rangle_{\\xi=s}$ 保持不变，这种情况也可能发生。这种情况表明所选的CV $s$ 是对真实反应路径的不良描述，并忽略了其他重要的自由度。\n\n我们现在将评估每个提议的方案。\n\nA. 将高斯沉积的高度和宽度都减小2倍，然后重复元动力学模拟。如果大量的偏置势仍然在 $s \\approx 0$ 附近积累，则断定它是一个真实的能垒。\n\n该方案解决了元动力学模拟的数值收敛问题。适温元动力学变体旨在收敛到正确的自由能剖面，其中总偏置势 $V_{\\text{bias}}(s)$ 趋近于 $-F(s)$。使用更小更窄的高斯山（减小高度和宽度）可以更精细、更准确地（尽管更慢地）重建 $F(s)$。如果一个特征，如能垒，在更保守的模拟参数下仍然存在，这证实了该特征存在于所选CV $s$ 的收敛 $F(s)$ 中，而不是过度激进的偏置（例如，创建人为极小值）所产生的伪影。然而，这个过程没有提供任何信息来区分能垒的*性质*。在 $F(s)$ 中收敛的能垒既可能是真实的势能垒，也可能是CV引起的熵瓶颈。该方案无法区分这两者。因此，这个结论是不合理的。\n\n结论：**错误**。\n\nB. 使用重加权方法从有偏置的轨迹中恢复无偏置的统计数据，计算条件平均势能 $\\langle U \\rangle_{\\xi=s}$ 和局部CV度规的估计值 $g(s) = \\langle \\nabla \\xi(\\mathbf{x}) \\cdot \\nabla \\xi(\\mathbf{x}) \\rangle_{\\xi=s}$。如果在 $s \\approx 0$ 附近 $F(s)$ 的增加没有伴随着 $\\langle U \\rangle_{\\xi=s}$ 的增加，而是与局部体积元所隐含的熵项（例如，通过 $\\ln \\sqrt{g(s)}$）的尖峰相关，并且如果通过增加一个缺失的正交描述符来扩充CV集后，表观能垒消失，则断定这是一个由CV引起的熵瓶颈。\n\n该方案是一种全面且物理上合理的方​​法。它直接研究了自由能的组成部分。\n1.  自由能的分解：自由能 $F(s)$ 在概念上可以分解为势能和熵的贡献。通过从重加权的轨迹计算 $\\langle U \\rangle_{\\xi=s}$，可以直接测试是否存在焓垒。如果 $F(s)$ 中的能垒与 $\\langle U \\rangle_{\\xi=s}$ 中的相应峰值不匹配，这强烈暗示其具有熵的起源。\n2.  度规分析：与CV参数化本身相关的熵贡献可以通过度规张量进行分析。对于单个CV，有效自由能包含一个与度规 $g(s) = \\langle |\\nabla \\xi(\\mathbf{x})|^2 \\rangle_s$ 相关的项，通常称为Fixman势。该项的形式为 $+\\frac{k_B T}{2} \\ln g(s)$，解释了路径周围构象管的体积。CV等值面的几何形状的快速变化可能导致 $g(s)$ 的急剧变化，这在 $F(s)$ 中表现为能垒。检查能垒与该度规项中的特征之间的相关性，为CV引起的伪影提供了进一步的证据。\n3.  扩充CV集：对投影伪影的最终测试是改进对系统的描述。如果能垒是由于不良的一维投影造成的，这意味着重要的运动发生在与 $\\nabla \\xi$ 正交的方向上。通过识别这样一个正交坐标，比如说 $s_{\\perp}$，并在二维空间 $(s, s_{\\perp})$ 中进行新的模拟，真实的、能量更低的路径将在二维自由能面上显现出来，而在一维投影到 $s$ 上的虚假能垒将会消失。\n这种多步骤验证是该领域的标准且稳健的方法。\n\n结论：**正确**。\n\nC. 将恒温器温度提高10%并重复元动力学模拟。如果在较高的温度 $T$ 下 $s \\approx 0$ 附近的偏置势减少，则断定原始能垒是熵致的。\n\n该方案检验了能垒高度的温度依赖性。自由能垒的高度由 $\\Delta F^\\ddagger = \\Delta U^\\ddagger - T \\Delta S^\\ddagger$ 给出。其温度依赖性为 $\\frac{\\partial \\Delta F^\\ddagger}{\\partial T} = -\\Delta S^\\ddagger$。一个熵垒或熵瓶颈的特征是过渡态熵的减少，即 $\\Delta S^\\ddagger  0$。这意味着 $\\frac{\\partial \\Delta F^\\ddagger}{\\partial T} > 0$。因此，一个真实熵垒的高度应该随温度的升高而*增加*。该方案建议，如果在较高的温度 $T$ 下偏置势（能垒高度 $\\Delta F^\\ddagger$ 的代理）*减少*，则能垒是熵致的。这个结论是基于错误的推理。能垒高度随温度降低（$\\frac{\\partial \\Delta F^\\ddagger}{\\partial T}  0$）将意味着 $\\Delta S^\\ddagger > 0$，这是一个“熵阱”，而不是一个能垒。此外，在更高的温度 $T$ 下，由于热涨落（$k_B T$）的增加，任何能垒都更容易被跨越，这可能会使对有限时间模拟期间沉积的偏置量的解释复杂化。基本的热力学论证表明该前提是错误的。\n\n结论：**错误**。\n\nD. 进行提交函数 (committor) 分析：在表观能垒附近收集 $\\xi(\\mathbf{x}) \\approx s^{\\ast}$ 的微观状态，并通过短时间的无偏置轨迹估计 $p_B(\\mathbf{x})$。如果在固定的 $s^{\\ast}$ 下，$p_B(\\mathbf{x})$ 的分布很宽或呈双峰分布，并且在表观过渡区域不近似以1/2为中心，这表明 $s$ 不是 $p_B$ 的单调函数，则断定该能垒是虚假的，并且是由不良的CV引起的。\n\n该方案使用了反应坐标的基本定义。一个完美的反应坐标，在一个单调变换下，与提交函数 (committor function) $p_B(\\mathbf{x})$ 是相同的。这意味着一个好的反应坐标的任何等值面 $s(\\mathbf{x})=s^{\\ast}$，也应该是一个等提交函数面 (iso-committor surface)，即该表面上的所有构象 $\\mathbf{x}$ 都具有相同的 $p_B(\\mathbf{x})$ 值。真正的过渡态是 $p_B(\\mathbf{x})=1/2$ 的表面。\n提议的测试正是检查这一属性。从沿 $s$ 的表观能垒顶部，$s=s^{\\ast}$，采样构象。如果CV $s$ 是一个好的反应坐标，所有这些构象都应该有 $p_B(\\mathbf{x}) \\approx 1/2$。相反，如果这些构象的 $p_B$ 值分布很宽（例如，从0到1）或呈双峰分布，这是确凿的证据，表明等值面 $s=s^{\\ast}$ 包含了已经类似反应物 ($p_B \\approx 0$) 和类似产物 ($p_B \\approx 1$) 的构象混合物。这意味着 $s$ 不是一个好的反应坐标；它未能将反应物、产物和真正的过渡态分离开来。投影到这样一个不良坐标上的自由能中出现的能垒必然是“虚假”的投影伪影。这是一个由不充分的CV引起的非物理能垒的经典标志，其功能上等同于所描述的“熵瓶颈”。\n\n结论：**正确**。\n\nE. 通过映射 $s \\mapsto \\mathrm{mod}(s,1)$ 使CV人为地周期化，并重复元动力学模拟。如果边界附近的偏置势积累消失，则断定原始能垒是非物理的。\n\n该方案测试的是由施加在CV范围 $[0,1]$ 上的边界条件引起的伪影。在非周期性元动力学模拟中，边界通常通过反射壁或约束势来强制执行。如果系统被迫靠在这样的墙上，就会产生一个人为的自由能惩罚，这将被偏置势的积累所补偿。使CV周期化通过将 $s=1$ 连接到 $s=0$ 来消除这些边界。如果偏置势积累消失，这证实了能垒是由这种人为的模拟边界引起的。然而，此方案无法区分真实的微观能垒和CV固有的熵瓶颈，因为两者都会持续存在。由 $\\xi(\\mathbf{x})=s$ 超曲面体积随 $s \\to 0$ 缩小引起的固有熵瓶颈是函数 $\\xi(\\mathbf{x})$ 本身的属性，与模拟盒的边界无关。位于 $s=0$ 附近的真实势能垒也依然会存在。因此，这个测试是针对另一类伪影的，并不能解决所述的问题。\n\n结论：**错误**。",
            "answer": "$$\\boxed{BD}$$"
        },
        {
            "introduction": "一旦建立了一组好的 CV，良好调节元动力学 (WTMetaD) 模拟的效率就取决于选择一个合适的偏置因子 $\\gamma$。较大的 $\\gamma$ 会加速越过能垒，但会降低重建的自由能形貌的质量。这个动手编程练习  将引导您推导并实现一种策略，以选择最佳的 $\\gamma$ 值，使其既满足最低采样速度的要求，又保证最高的统计质量。",
            "id": "3425192",
            "problem": "设计并实现一个完整的、可运行的程序，用于在一维集体变量设定中选择良好调节元动力学 (WTMetaD) 的偏置因子 $\\gamma$，以平衡势垒穿越频率与自由能分辨率。该系统被建模为在集体变量 $s$ 中，由高度为 $\\Delta F$ 的势垒隔开的两个盆地。温度为 $T$ 的正则系综的逆温度为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是以千焦耳/摩尔/开尔文为单位的玻尔兹曼常数。在 WTMetaD 中，沿 $s$ 的稳态分布被偏置所修改，使得有效温度 $T^*$ 满足 $T^* = \\gamma T$，其中 $\\gamma \\geq 1$ 是一个无量纲的偏置因子。势垒穿越频率可以用一个类阿伦尼乌斯尝试频率乘以一个玻尔兹曼因子来建模。在偏置和随后的重加权下的自由能分辨率可以通过重要性采样权重获得的的有效样本量 (ESS) 比率来量化。您必须：\n\n- 从第一性原理出发，具体包括：\n  - 基于玻尔兹曼因子的正则系综定义。\n  - 热激活过程中的类阿伦尼乌斯势垒穿越原理。\n  - WTMetaD 沿集体变量的稳态测度及其与有效温度的关系。\n  - 重要性采样和重加权的定义，重点关注 ESS 如何在二态模型中从权重方差中产生。\n\n- 构建一个二态模型，其中左盆地的自由能为 $F_L = 0$，右盆地的自由能为 $F_R = \\Delta F$。在 WTMetaD 下，稳态分布被改变，必须通过重加权恢复无偏估计。利用此模型推导出 ESS 比率 $R(\\gamma)$ 作为 $\\gamma$ 和模型参数的函数。\n\n- 定义一个程序化决策规则，以在给定以下约束条件的情况下选择 $\\gamma$：\n  1. 势垒穿越频率要求：WTMetaD 下的穿越频率应至少为指定的目标频率 $r_{\\text{target}}$ (单位 $s^{-1}$)。\n  2. 分辨率要求：ESS 比率 $R(\\gamma)$ 应至少为指定的阈值 $R_{\\min}$ (无量纲)。\n\n- 对于每个测试用例，您的程序必须计算满足势垒穿越频率要求的最小 $\\gamma \\geq 1$。如果这个 $\\gamma$ 也满足分辨率要求，则输出该 $\\gamma$ 值，四舍五入到三位小数。如果没有 $\\gamma$ 能同时满足两个约束条件（包括所需穿越频率超过尝试频率的情况），则对该测试用例输出整数 $-1$。\n\n- 物理常数和单位：\n  - 使用 $k_B = 0.008314462618$，单位为千焦耳/摩尔/开尔文。\n  - $\\Delta F$ 以千焦耳/摩尔为单位提供。\n  - $T$ 以开尔文为单位提供。\n  - 尝试频率 $\\nu_0$ 以秒的倒数为单位提供。\n  - $r_{\\text{target}}$ 以秒的倒数为单位提供。\n  - 输出的 $\\gamma$ 是无量纲的。\n\n- 测试套件：\n  - 程序必须评估以下测试用例，每个用例指定为一个元组 $(\\Delta F, T, \\nu_0, r_{\\text{target}}, R_{\\min})$：\n    1. $(20, 300, 10^{12}, 10^{9}, 0.95)$\n    2. $(20, 300, 10^{12}, 10^{11}, 0.92)$\n    3. $(2, 300, 10^{12}, 10^{12}, 0.99)$\n    4. $(50, 300, 10^{12}, 10^{6}, 0.98)$\n    5. $(15, 300, 10^{12}, 10^{9}, 0.99)$\n\n- 最终输出格式：\n  - 您的程序应生成单行输出，包含所有测试用例的结果，形式为方括号内以逗号分隔的列表，例如 $[1.234,-1,2.000]$，其中每个条目对应选择的 $\\gamma$（四舍五入到三位小数）或在没有可行 $\\gamma$ 时为 $-1$。\n\n本问题陈述中不得给出任何公式；您必须从上面列出的基本原理出发，推导出所有必要的关系。确保场景和参数在科学上是合理且自洽的。所有角度（如有）必须以弧度为单位。所有百分比（如有）必须表示为小数或分数，不得使用百分号。",
            "solution": "此问题要求确定良好调节元动力学 (WTMetaD) 模拟的最佳偏置因子 $\\gamma$。$\\gamma$ 的选择必须平衡两个相互竞争的目标：加速穿越自由能势垒和保持对无偏自由能形貌的高质量重建。我们将从第一性原理推导必要的关系，并建立一个决策规则来找到满足这两个标准的最小 $\\gamma \\geq 1$。\n\n设系统由一维集体变量 $s$ 描述。沿 $s$ 的自由能形貌由两个盆地组成，它们被一个高度为 $\\Delta F$ 的势垒隔开。系统处于温度为 $T$ 的正则系综中，逆温度定义为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是玻尔兹曼常数。\n\n**1. WTMetaD 中的势垒穿越频率**\n\n像穿越能垒这样的热激活过程的速率可以通过阿伦尼乌斯方程来建模。对于无偏系统，穿越频率 $r$ 与尝试频率 $\\nu_0$ 和一个依赖于势垒高度 $\\Delta F$ 的玻尔兹曼因子成正比：\n$$r_{\\text{unbiased}} = \\nu_0 \\exp(-\\beta \\Delta F) = \\nu_0 \\exp\\left(-\\frac{\\Delta F}{k_B T}\\right)$$\n\n在良好调节元动力学中，会添加一个偏置势，在长时间极限下，这会导致一个修正的稳态概率分布。该分布对应于一个处于更高有效温度 $T^* = \\gamma T$ 的正则系综的分布，其中 $\\gamma \\geq 1$ 是无量纲偏置因子。因此，有效逆温度为 $\\beta^* = 1/(k_B T^*) = \\beta/\\gamma$。\n\n偏置模拟中的势垒穿越过程受此有效温度控制。因此，加速后的穿越频率 $r(\\gamma)$ 由使用有效逆温度 $\\beta^*$ 的阿伦尼乌斯方程给出：\n$$r(\\gamma) = \\nu_0 \\exp(-\\beta^* \\Delta F) = \\nu_0 \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right) = \\nu_0 \\exp\\left(-\\frac{\\Delta F}{\\gamma k_B T}\\right)$$\n该表达式量化了偏置因子 $\\gamma$ 如何提高势垒穿越的速率。\n\n**2. 自由能分辨率和有效样本量 (ESS)**\n\n虽然 WTMetaD 加速了采样，但数据是从一个偏置分布中收集的，必须进行重加权以恢复无偏正则系综的性质。这种重加权过程会产生统计损失，这可以通过有效样本量 (ESS) 来量化。\n\n具有自由能 $F(s)$ 的状态的无偏概率为 $p_u(s) \\propto \\exp(-\\beta F(s))$。WTMetaD 下的偏置概率为 $p_b(s) \\propto \\exp(-\\beta^* F(s)) = \\exp(-\\beta F(s)/\\gamma)$。用于将偏置系综中的样本重加权到无偏系综的重要性权重 $w(s)$ 是目标概率与采样概率之比：\n$$w(s) = \\frac{p_u(s)}{p_b(s)} = \\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta F(s))}{\\exp(-\\beta F(s)/\\gamma)}$$\n其中 $Z_u = \\int \\exp(-\\beta F(s)) ds$ 和 $Z_b = \\int \\exp(-\\beta F(s)/\\gamma) ds$ 分别是无偏和偏置系综的配分函数。\n\n重加权的质量由 ESS 比率 $R = ESS/N_{total}$ 衡量，其中 $N_{total}$ 是总样本数。该比率由下式给出：\n$$R = \\frac{\\left(\\mathbb{E}_{b}[w]\\right)^2}{\\mathbb{E}_{b}[w^2]}$$\n其中期望值是在偏置分布 $p_b(s)$ 上计算的。可以证明 $\\mathbb{E}_{b}[w] = 1$，因此表达式简化为：\n$$R = 1 / \\mathbb{E}_{b}[w^2]$$\n\n我们现在将此应用于具有状态 $L$ 和 $R$ 的指定二态模型，其自由能分别为 $F_L = 0$ 和 $F_R = \\Delta F$。\n配分函数为 $Z_u = e^{-\\beta F_L} + e^{-\\beta F_R} = 1 + e^{-\\beta \\Delta F}$ 和 $Z_b = e^{-\\beta F_L/\\gamma} + e^{-\\beta F_R/\\gamma} = 1 + e^{-\\beta \\Delta F/\\gamma}$。\n这些状态的偏置概率为 $P_b(L) = \\frac{1}{Z_b}$ 和 $P_b(R) = \\frac{\\exp(-\\beta \\Delta F/\\gamma)}{Z_b}$。\n这两个状态的权重为：\n$$w(L) = \\frac{Z_b}{Z_u}$$\n$$w(R) = \\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta \\Delta F)}{\\exp(-\\beta \\Delta F/\\gamma)}$$\n权重平方的期望值为：\n$$\\mathbb{E}_{b}[w^2] = P_b(L)w(L)^2 + P_b(R)w(R)^2$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{1}{Z_b} \\left(\\frac{Z_b}{Z_u}\\right)^2 + \\frac{\\exp(-\\beta \\Delta F/\\gamma)}{Z_b} \\left(\\frac{Z_b}{Z_u} \\frac{\\exp(-\\beta \\Delta F)}{\\exp(-\\beta \\Delta F/\\gamma)}\\right)^2$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{Z_b}{Z_u^2} \\left[1 + \\exp(-\\beta \\Delta F/\\gamma) \\frac{\\exp(-2\\beta \\Delta F)}{\\exp(-2\\beta \\Delta F/\\gamma)}\\right]$$\n$$\\mathbb{E}_{b}[w^2] = \\frac{Z_b}{Z_u^2} \\left[1 + \\exp(-2\\beta \\Delta F + \\beta \\Delta F/\\gamma)\\right]$$\n代入 $Z_u$ 和 $Z_b$ 并定义 $x = \\exp(-\\beta \\Delta F)$：\n$$\\mathbb{E}_{b}[w^2] = \\frac{1+x^{1/\\gamma}}{(1+x)^2} \\left[1 + x^{2-1/\\gamma}\\right]$$\n因此，ESS 比率 $R(\\gamma) = 1 / \\mathbb{E}_{b}[w^2]$ 为：\n$$R(\\gamma) = \\frac{(1+x)^2}{(1+x^{1/\\gamma})(1+x^{2-1/\\gamma})} = \\frac{(1+e^{-\\beta \\Delta F})^2}{(1+e^{-\\beta \\Delta F/\\gamma})(1+e^{-\\beta \\Delta F(2-1/\\gamma)})}$$\n对于 $\\gamma \\geq 1$，此函数是单调递减的。\n\n**3. 选择 $\\gamma$ 的决策规则**\n\n我们必须找到满足以下两个约束条件的最小 $\\gamma \\geq 1$：\n1. $r(\\gamma) \\geq r_{\\text{target}}$\n2. $R(\\gamma) \\geq R_{\\min}$\n\n从频率约束条件：\n$$\\nu_0 \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right) \\geq r_{\\text{target}}$$\n可能的最大频率是 $\\nu_0$（当 $\\gamma \\to \\infty$ 时）。如果 $r_{\\text{target}}  \\nu_0$，则无解。如果 $r_{\\text{target}} = \\nu_0$ 且 $\\Delta F  0$，不等式要求 $\\exp(-\\beta \\Delta F/\\gamma) \\geq 1$，这对于有限的 $\\gamma \\geq 1$ 是不可能的。因此，我们必须有 $r_{\\text{target}}  \\nu_0$（或者如果 $\\Delta F=0$，则 $r_{\\text{target}} = \\nu_0$）。\n解出 $\\gamma$：\n$$-\\frac{\\beta \\Delta F}{\\gamma} \\geq \\ln\\left(\\frac{r_{\\text{target}}}{\\nu_0}\\right)$$\n$$\\frac{\\beta \\Delta F}{\\gamma} \\leq -\\ln\\left(\\frac{r_{\\text{target}}}{\\nu_0}\\right) = \\ln\\left(\\frac{\\nu_0}{r_{\\text{target}}}\\right)$$\n$$\\gamma \\geq \\frac{\\beta \\Delta F}{\\ln(\\nu_0/r_{\\text{target}})}$$\n让我们将右侧称为 $\\gamma_{\\text{freq}}$。为了满足频率约束和基本约束 $\\gamma \\geq 1$，所需的最小偏置因子为 $\\gamma_{\\text{cand}} = \\max(1, \\gamma_{\\text{freq}})$。\n\n此候选值 $\\gamma_{\\text{cand}}$ 是满足速度要求的最小可能 $\\gamma$。我们现在必须检查它是否也满足分辨率要求。由于 $R(\\gamma)$ 是一个对于 $\\gamma \\ge 1$ 的单调递减函数，如果 $\\gamma_{\\text{cand}}$ 未通过分辨率测试，即 $R(\\gamma_{\\text{cand}})  R_{\\min}$，那么任何更大的 $\\gamma$（同样满足频率约束）也将失败。在这种情况下，不存在解。\n\n算法如下：\n1.  对于给定的一组参数 $(\\Delta F, T, \\nu_0, r_{\\text{target}}, R_{\\min})$，首先检查可解性。如果 $r_{\\text{target}} > \\nu_0$，或者如果 $r_{\\text{target}} = \\nu_0$ 且 $\\Delta F > 0$，则不存在解。\n2.  计算 $\\beta = 1/(k_B T)$。\n3.  如果 $r_{\\text{target}}  \\nu_0$，计算 $\\gamma_{\\text{freq}} = (\\beta \\Delta F) / \\ln(\\nu_0 / r_{\\text{target}})$。\n4.  确定候选偏置因子：$\\gamma_{\\text{cand}} = \\max(1, \\gamma_{\\text{freq}})$。如果 $\\Delta F=0$ 且 $r_{\\text{target}} \\le \\nu_0$，任何 $\\gamma \\ge 1$ 都满足频率要求，所以 $\\gamma_{cand}=1$。\n5.  使用上面推导的公式计算 ESS 比率 $R(\\gamma_{\\text{cand}})$。\n6.  如果 $R(\\gamma_{\\text{cand}}) \\geq R_{\\min}$，则 $\\gamma_{\\text{cand}}$ 是解。\n7.  如果 $R(\\gamma_{\\text{cand}})  R_{\\min}$，则不存在可行的 $\\gamma$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal Well-Tempered Metadynamics bias factor gamma\n    for a series of test cases based on barrier crossing and resolution constraints.\n    \"\"\"\n\n    # Physical constant in kJ/(mol·K)\n    K_B = 0.008314462618\n\n    # Test cases: (delta_F, T, nu_0, r_target, R_min)\n    test_cases = [\n        (20, 300, 10**12, 10**9, 0.95),\n        (20, 300, 10**12, 10**11, 0.92),\n        (2, 300, 10**12, 10**12, 0.99),\n        (50, 300, 10**12, 10**6, 0.98),\n        (15, 300, 10**12, 10**9, 0.99),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_F, T, nu_0, r_target, R_min = case\n\n        # --- Problem Validation and Edge Cases ---\n        \n        # Condition 1: Target frequency cannot exceed attempt frequency.\n        if r_target  nu_0:\n            results.append(-1)\n            continue\n\n        # Condition 2: If target equals attempt frequency, barrier must be non-existent.\n        # Otherwise, exp(-beta*delta_F/gamma) must be = 1, which is impossible for delta_F  0.\n        if r_target == nu_0:\n            if delta_F  0:\n                results.append(-1)\n                continue\n            # If delta_F is 0, any gamma works for frequency. Smallest is gamma=1.\n            gamma_cand = 1.0\n        else:\n            # --- Calculate Candidate Gamma from Frequency Constraint ---\n            if delta_F == 0:\n                # If there's no barrier, unbiased rate is nu_0.\n                # Since r_target  nu_0, no bias is needed. Choose smallest gamma.\n                gamma_cand = 1.0\n            else:\n                beta = 1.0 / (K_B * T)\n                log_nu0_over_rtarget = np.log(nu_0 / r_target)\n                \n                # This should not happen due to prior checks, but as a safeguard:\n                if log_nu0_over_rtarget = 0:\n                     results.append(-1)\n                     continue\n                \n                gamma_freq = (beta * delta_F) / log_nu0_over_rtarget\n\n                # The bias factor must be at least 1. If the unbiased system is\n                # already fast enough (gamma_freq  1), we use the minimum bias (gamma=1).\n                gamma_cand = max(1.0, gamma_freq)\n\n        # --- Check Resolution Constraint (ESS Ratio) ---\n        beta = 1.0 / (K_B * T)\n        x = np.exp(-beta * delta_F)\n\n        # Handle the case where gamma_cand is 1, so 2 - 1/gamma_cand is 1\n        # Avoids potential precision issues with x**(1.0)\n        if gamma_cand == 1.0:\n            # R(gamma=1) simplifies to 1\n            ess_ratio = 1.0\n        else:\n            # R(gamma) = (1+x)^2 / [(1 + x^(1/gamma)) * (1 + x^(2 - 1/gamma))]\n            # Using np.power for potentially large exponents\n            one_over_gamma = 1.0 / gamma_cand\n            x_pow_1_over_gamma = np.power(x, one_over_gamma)\n            x_pow_2_minus_1_over_gamma = np.power(x, 2.0 - one_over_gamma)\n            \n            numerator = (1.0 + x)**2\n            denominator = (1.0 + x_pow_1_over_gamma) * (1.0 + x_pow_2_minus_1_over_gamma)\n            \n            # Avoid division by zero, though denominator should be  1\n            if denominator == 0:\n                results.append(-1)\n                continue\n            \n            ess_ratio = numerator / denominator\n\n        # --- Final Decision ---\n        if ess_ratio = R_min:\n            # Format to 3 decimal places as a string\n            results.append(f\"{gamma_cand:.3f}\")\n        else:\n            # If the minimal gamma for frequency fails resolution, no solution exists\n            results.append(-1)\n\n    # Print the final result in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}