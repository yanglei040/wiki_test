{
    "hands_on_practices": [
        {
            "introduction": "许多先进的增强采样方法依赖于重加权技术（如重要性采样）来从偏置模拟中恢复真实的自由能形貌。本练习旨在深入探讨这一过程的统计学核心 。通过推导重加权估计量的方差，你将理解“有效样本量”（$N_{\\text{eff}}$）的概念，并精确地看到采样分布与目标分布之间重叠不佳会如何削弱它，从而为为何良好的采样策略设计至关重要提供严格的理论基础。",
            "id": "3410765",
            "problem": "考虑一个分子动力学（MD）增强采样方案，该方案在逆温度 $\\beta$ 下，使用一个偏置势 $V(z)$ 来对一个低维集体变量 $z$ 的采样施加偏置。设无偏目标密度为 $p(z) \\propto \\exp(-\\beta U(z))$，有偏采样密度为 $q(z) \\propto \\exp(-\\beta U(z) - \\beta V(z))$。假设样本 $\\{z_i\\}_{i=1}^{N}$ 的采集步长大于去相关时间，因此它们在 $q(z)$ 分布下是独立同分布的。定义重要性权重 $w(z) = p(z)/q(z)$，并使用自归一化重要性采样估计量来估计可观测量 $A(z)$ 的目标期望，\n$$\n\\hat{\\mu} = \\frac{\\sum_{i=1}^{N} w(z_i) A(z_i)}{\\sum_{i=1}^{N} w(z_i)}\n$$\n假设 $A(z)$ 在目标分布 $p(z)$ 下具有有限方差，记为 $\\sigma_A^2$，并且 $A(z)$ 的涨落与权重 $w(z)$ 不相关，即在给定实现的权重条件下，$A(z_i)$ 是独立的，其方差为 $\\sigma_A^2$，且独立于 $\\{w(z_i)\\}$。\n\n1. 仅从上述定义和标准概率论事实出发，推导 $\\hat{\\mu}$ 的方差关于 $N$ 和权重在 $q$ 分布下的二阶矩 $\\mathbb{E}_q[w^2]$ 的渐近表达式（大 $N$ 情况）。引入有效样本量 $N_{\\mathrm{eff}}$，并用 $N_{\\mathrm{eff}}$ 表示该方差。\n\n2. 定义从 $p$ 到 $q$ 的2阶Rényi散度为 $D_{2}(p\\|q) = \\ln \\int \\frac{p(z)^{2}}{q(z)} \\, dz$。用 $D_{2}(p\\|q)$ 表示比率 $N_{\\mathrm{eff}}/N$。现在，施加一个定量可靠性准则，即权重的变异系数的平方 $\\mathrm{CV}^{2}(w) = \\frac{\\mathrm{Var}_q(w)}{(\\mathbb{E}_q[w])^{2}}$ 不超过 $1$。在此准则下，计算 $D_{2}(p\\|q)$ 对应的上界，并给出其数值，四舍五入到四位有效数字。\n\n将你的最终答案表示为一个双元素行矩阵，其中第一个元素是第1部分推导出的渐近方差的闭式表达式，第二个元素是第2部分得到的 $D_{2}(p\\|q)$ 的数值阈值。将第二个元素四舍五入到四位有效数字。不需要单位。",
            "solution": "这个问题是有效的，因为它在统计力学和重要性采样理论方面有科学依据，是良定的，并使用了客观、正式的语言。我们可以开始求解。\n\n这个问题分为两部分。首先，我们推导自归一化重要性采样估计量的渐近方差。其次，我们将采样效率与Rényi散度联系起来，并评估一个可靠性准则。\n\n第1部分：$\\hat{\\mu}$ 的渐近方差\n\n期望 $\\mu = \\mathbb{E}_p[A(z)]$ 的自归一化重要性采样估计量由下式给出\n$$ \\hat{\\mu} = \\frac{\\sum_{i=1}^{N} w(z_i) A(z_i)}{\\sum_{i=1}^{N} w(z_i)} = \\frac{\\frac{1}{N} \\sum_{i=1}^{N} w_i A_i}{\\frac{1}{N} \\sum_{i=1}^{N} w_i} $$\n其中 $w_i = w(z_i)$ 且 $A_i = A(z_i)$，样本 $\\{z_i\\}$ 从有偏分布 $q(z)$ 中独立同分布地抽取。这是一个两个样本均值的比率，$\\hat{\\mu} = \\bar{X}/\\bar{Y}$，其中 $X_i = w_i A_i$ 且 $Y_i = w_i$。\n\n为了找到大 $N$ 时 $\\hat{\\mu}$ 的渐近方差，我们使用delta方法，该方法涉及对分子和分母期望周围的比率进行一阶泰勒展开。首先，我们计算在采样分布 $q(z)$ 下的这些期望：\n$Y_i = w_i$ 的期望是\n$$ \\mathbb{E}_q[w] = \\int w(z) q(z) \\, dz = \\int \\frac{p(z)}{q(z)} q(z) \\, dz = \\int p(z) \\, dz = 1 $$\n因为 $p(z)$ 是一个概率密度。\n$X_i = w_i A_i$ 的期望是\n$$ \\mathbb{E}_q[wA] = \\int w(z) A(z) q(z) \\, dz = \\int \\frac{p(z)}{q(z)} A(z) q(z) \\, dz = \\int A(z) p(z) \\, dz = \\mathbb{E}_p[A(z)] = \\mu $$\n比率 $\\hat{\\mu} = \\bar{X}/\\bar{Y}$ 的方差的delta方法近似由下式给出：\n$$ \\mathrm{Var}_q(\\hat{\\mu}) \\approx \\frac{1}{N} \\frac{1}{(\\mathbb{E}_q[w])^2} \\mathrm{Var}_q(wA - \\mu w) $$\n代入 $\\mathbb{E}_q[w]=1$：\n$$ \\mathrm{Var}_q(\\hat{\\mu}) \\approx \\frac{1}{N} \\mathrm{Var}_q(w(A - \\mu)) $$\n方差项为 $\\mathrm{Var}_q(w(A - \\mu)) = \\mathbb{E}_q[(w(A - \\mu))^2] - (\\mathbb{E}_q[w(A - \\mu)])^2$。第二项为零，因为 $\\mathbb{E}_q[w(A - \\mu)] = \\mathbb{E}_q[wA] - \\mu \\mathbb{E}_q[w] = \\mu - \\mu \\cdot 1 = 0$。\n因此，我们需要计算 $\\mathbb{E}_q[w^2(A - \\mu)^2]$：\n$$ \\mathbb{E}_q[w^2(A - \\mu)^2] = \\int w(z)^2 (A(z) - \\mu)^2 q(z) \\, dz = \\int \\frac{p(z)}{q(z)} (A(z) - \\mu)^2 p(z) \\, dz = \\mathbb{E}_p[w(A - \\mu)^2] $$\n问题陈述“$A(z)$ 的涨落与权重 $w(z)$ 不相关”。这是一个简化假设。在这种情况下，通常将其解释为权重函数与可观测量的函数之间的协方差可以忽略不计，即对于相关函数 $g$，有 $\\mathrm{Cov}_p(w, g(A)) \\approx 0$。这里，我们假设 $\\mathrm{Cov}_p(w, (A-\\mu)^2) = 0$。这意味着：\n$$ \\mathbb{E}_p[w(A - \\mu)^2] \\approx \\mathbb{E}_p[w] \\mathbb{E}_p[(A - \\mu)^2] $$\n第二项是 $A$ 在 $p$ 分布下的方差，给定为 $\\sigma_A^2$。第一项是：\n$$ \\mathbb{E}_p[w] = \\int w(z) p(z) \\, dz = \\int \\frac{p(z)}{q(z)} p(z) \\, dz = \\int \\frac{p(z)^2}{q(z)} \\, dz $$\n这可以表示为在 $q$ 分布上的期望：\n$$ \\int \\frac{p(z)^2}{q(z)^2} q(z) \\, dz = \\int w(z)^2 q(z) \\, dz = \\mathbb{E}_q[w^2] $$\n结合这些结果，我们得到：\n$$ \\mathbb{E}_q[w^2(A - \\mu)^2] \\approx \\mathbb{E}_q[w^2] \\sigma_A^2 $$\n将此代回 $\\hat{\\mu}$ 的方差表达式中：\n$$ \\mathrm{Var}_q(\\hat{\\mu}) \\approx \\frac{\\sigma_A^2 \\mathbb{E}_q[w^2]}{N} $$\n这个表达式给出了作为 $N$ 和 $\\mathbb{E}_q[w^2]$ 函数的渐近方差。\n\n有效样本量 $N_{\\mathrm{eff}}$ 的定义是通过将该估计量的方差与具有 $N_{\\mathrm{eff}}$ 个样本的简单蒙特卡洛估计的方差相等来确定的，即 $\\mathrm{Var}_q(\\hat{\\mu}) = \\sigma_A^2 / N_{\\mathrm{eff}}$。将其与我们推导的表达式进行比较，得到：\n$$ \\frac{\\sigma_A^2}{N_{\\mathrm{eff}}} = \\frac{\\sigma_A^2 \\mathbb{E}_q[w^2]}{N} \\implies N_{\\mathrm{eff}} = \\frac{N}{\\mathbb{E}_q[w^2]} $$\n因此，方差也可以写为 $\\mathrm{Var}_q(\\hat{\\mu}) \\approx \\sigma_A^2/N_{\\mathrm{eff}}$。\n\n第2部分：Rényi散度和可靠性准则\n\n2阶Rényi散度由 $D_{2}(p\\|q) = \\ln \\int \\frac{p(z)^{2}}{q(z)} \\, dz$ 给出。从第1部分的推导中，我们认出该积分为 $\\mathbb{E}_q[w^2]$。\n$$ D_{2}(p\\|q) = \\ln(\\mathbb{E}_q[w^2]) $$\n这意味着 $\\mathbb{E}_q[w^2] = \\exp(D_{2}(p\\|q))$。\n有效样本量与总样本数之比为：\n$$ \\frac{N_{\\mathrm{eff}}}{N} = \\frac{1}{\\mathbb{E}_q[w^2]} = \\frac{1}{\\exp(D_{2}(p\\|q))} = \\exp(-D_{2}(p\\|q)) $$\n接下来，我们分析可靠性准则。权重的变异系数的平方 $\\mathrm{CV}^{2}(w)$ 定义为：\n$$ \\mathrm{CV}^{2}(w) = \\frac{\\mathrm{Var}_q(w)}{(\\mathbb{E}_q[w])^{2}} $$\n我们已经计算了均值，并可以表示权重的方差：\n$$ \\mathbb{E}_q[w] = 1 $$\n$$ \\mathrm{Var}_q(w) = \\mathbb{E}_q[w^2] - (\\mathbb{E}_q[w])^2 = \\mathbb{E}_q[w^2] - 1 $$\n将这些代入 $\\mathrm{CV}^{2}(w)$ 的表达式中：\n$$ \\mathrm{CV}^{2}(w) = \\frac{\\mathbb{E}_q[w^2] - 1}{1^2} = \\mathbb{E}_q[w^2] - 1 $$\n可靠性准则是 $\\mathrm{CV}^{2}(w) \\le 1$。应用我们的表达式：\n$$ \\mathbb{E}_q[w^2] - 1 \\le 1 \\implies \\mathbb{E}_q[w^2] \\le 2 $$\n为了找到Rényi散度对应的上界，我们使用关系式 $D_{2}(p\\|q) = \\ln(\\mathbb{E}_q[w^2])$。由于自然对数是一个单调递增函数，其自变量上的不等式直接转换为函数值上的不等式：\n$$ D_{2}(p\\|q) \\le \\ln(2) $$\n此上界的数值，四舍五入到四位有效数字，为：\n$$ \\ln(2) \\approx 0.693147... \\approx 0.6931 $$\n\n最终答案要求一个双元素行矩阵，包含第1部分的渐近方差和第2部分的 $D_2(p\\|q)$ 的数值阈值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\sigma_A^2 \\mathbb{E}_q[w^2]}{N}  0.6931\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在对采样效率有了理论认识之后，这个问题将让你扮演一名计算科学家的角色，来设计一个伞形采样实验。你将把对平均力势（PMF）的期望精度转化为一个具体的模拟参数：所需的最小伞形窗数量 。这个练习展示了在模拟成本（窗口数量、采样时间）和最终结果质量之间的关键权衡。",
            "id": "3410749",
            "problem": "考虑在分子动力学 (MD) 模拟中使用伞形采样来估算沿集体变量 (CV) $s$ 的一维平均力势 $F(s)$。需要覆盖的 CV 域是闭区间 $[s_{\\min}, s_{\\max}]$，其中 $s_{\\min} = 0\\,\\mathrm{nm}$ 且 $s_{\\max} = 2\\,\\mathrm{nm}$。每个伞形窗采用一个谐波偏置 $U_{i}(s) = \\frac{1}{2} k (s - s_{i})^{2}$，其中力常数 $k$ 相同，窗口中心 $\\{ s_{i} \\}$ 等间距分布，间距为 $\\Delta s$。模拟在绝对温度 $T$ 下进行。\n\n假设以下基于物理动机的简化，它们构成了一个一致的设计基线：\n- 在任意窗口中心 $s_{i}$ 附近，无偏置的自由能 $F(s)$ 相对于施加的谐波曲率变化缓慢，因此窗口 $i$ 中 $s$ 的偏置分布近似为高斯分布，其方差为 $\\sigma^{2} = k_{B} T / k$，其中 $k_{B}$ 是玻尔兹曼常数。\n- 每个窗口中的时间序列 $s(t)$ 是平稳的，其积分自相关时间 (IAT) 为 $\\tau_{\\mathrm{int}}$。对于给定窗口中时长为 $t_{w}$ 的轨迹，统计独立的有效样本数为 $N_{\\mathrm{eff}} \\approx t_{w}/(2 \\tau_{\\mathrm{int}})$。\n- 设计要求相邻窗口之间有稳定的重叠。使用两个等方差高斯偏置密度之间的 Bhattacharyya 系数 $O$ 作为定量的重叠度量。对于相隔 $\\Delta s$ 且方差为 $\\sigma^{2}$ 的两个相邻窗口，其重叠为 $O(\\Delta s) = \\exp\\!\\left(-\\Delta s^{2}/(8 \\sigma^{2})\\right)$。\n- 使用 delta 方法近似来处理重叠位置处无偏置自由能的统计不确定度，其中 $F(s) = -k_{B} T \\ln P(s)$，且重叠区域的有效样本数可缩放为 $N_{\\mathrm{ov}} \\approx 2 N_{\\mathrm{eff}} O(\\Delta s)$。通过强制执行 $\\mathrm{Var}(F) \\approx (k_{B} T)^{2}/N_{\\mathrm{ov}} \\leq \\delta F^{2}$，来设定重叠区域最坏情况下的自由能不确定度目标为 $\\delta F$。\n\n给定参数值 $T = 300\\,\\mathrm{K}$，$k = 1200\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-2}$，$t_{w} = 60\\,\\mathrm{ns}$ 和 $\\tau_{\\mathrm{int}} = 0.15\\,\\mathrm{ns}$，并将目标自由能不确定度设为 $\\delta F = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$，请根据上述设计模型确定覆盖区间 $[s_{\\min}, s_{\\max}]$ 所需的最小整数窗口数 $M$。使用 $k_{B} = 8.314462618 \\times 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$，并假设窗口中心等间距分布，从 $s_{\\min}$ 开始，到 $s_{\\max}$ 结束，间距为 $\\Delta s$，因此 $M = \\left\\lceil \\frac{s_{\\max} - s_{\\min}}{\\Delta s} \\right\\rceil + 1$。最终答案以无量纲的整数形式报告。如果在中间步骤中需要四舍五入，请保留足够的精度以确保最终整数的正确性，并报告不带任何单位的整数。\n\n计算出 $M$ 后，根据推导的表达式和假设，简要解释窗口数 $M$、刚度 $k$ 和每个窗口的采样时间 $t_{w}$ 之间的权衡关系，无需更改您计算出的 $M$ 值。",
            "solution": "用户希望确定跨越集体变量 (CV) 范围 $[s_{\\min}, s_{\\max}]$ 所需的最小整数伞形窗口数 $M$，同时确保在相邻窗口之间的重叠点处，自由能估计的最大统计不确定度为 $\\delta F$。\n\n题目提供了一组基于物理动机的假设，将模拟参数与此不确定度目标联系起来。问题的核心是求解这些方程，以获得窗口中心之间的最大允许间距 $\\Delta s$，然后用该值计算最小窗口数 $M$。\n\n首先，我们列出给定的参数和关系：\n- CV 范围：$s_{\\min} = 0\\,\\mathrm{nm}$ 到 $s_{\\max} = 2\\,\\mathrm{nm}$。总长度为 $L = s_{\\max} - s_{\\min} = 2\\,\\mathrm{nm}$。\n- 温度：$T = 300\\,\\mathrm{K}$。\n- 伞形力常数：$k = 1200\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-2}$。\n- 每个窗口的轨迹时长：$t_{w} = 60\\,\\mathrm{ns}$。\n- 积分自相关时间：$\\tau_{\\mathrm{int}} = 0.15\\,\\mathrm{ns}$。\n- 目标自由能不确定度：$\\delta F = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n- 玻尔兹曼常数：$k_{B} = 8.314462618 \\times 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。\n\n求解过程遵循以下步骤：\n1.  使用不确定度约束来找到相邻偏置分布之间的最小所需重叠 $O_{\\min}$。\n2.  使用重叠公式 $O(\\Delta s)$，找到与 $O_{\\min}$ 对应的最大允许窗口间距 $\\Delta s_{\\max}$。\n3.  计算以间距 $\\Delta s_{\\max}$ 覆盖总范围 $L$ 所需的最小窗口数 $M$。\n\n步骤 1：确定最小所需重叠 $O_{\\min}$。\n自由能方差的约束条件如下：\n$$\\mathrm{Var}(F) \\leq \\delta F^{2}$$\n题目给出了重叠区域方差的近似公式：\n$$\\mathrm{Var}(F) \\approx \\frac{(k_{B} T)^{2}}{N_{\\mathrm{ov}}}$$\n其中 $N_{\\mathrm{ov}} \\approx 2 N_{\\mathrm{eff}} O(\\Delta s)$ 是重叠区域的有效样本数。\n将这些结合起来，我们得到：\n$$\\frac{(k_{B} T)^{2}}{2 N_{\\mathrm{eff}} O(\\Delta s)} \\leq \\delta F^{2}$$\n为了最小化窗口数量，我们需要最大化间距 $\\Delta s$。由于 $O(\\Delta s)$ 是 $\\Delta s$ 的递减函数，最大化 $\\Delta s$ 对应于最小化重叠 $O(\\Delta s)$。因此，我们应该使此不等式在其边界处成立，这定义了最小所需重叠 $O_{\\min}$：\n$$O_{\\min} = \\frac{(k_{B} T)^{2}}{2 N_{\\mathrm{eff}} \\delta F^{2}}$$\n我们首先计算必要的中间量。\n热能为：\n$$k_{B} T = (8.314462618 \\times 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}) \\times (300\\,\\mathrm{K}) = 2.4943387854\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n每个窗口的独立有效样本数为：\n$$N_{\\mathrm{eff}} \\approx \\frac{t_{w}}{2 \\tau_{\\mathrm{int}}} = \\frac{60\\,\\mathrm{ns}}{2 \\times 0.15\\,\\mathrm{ns}} = \\frac{60}{0.3} = 200$$\n现在我们可以计算 $O_{\\min}$：\n$$O_{\\min} = \\frac{(2.4943387854\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1})^{2}}{2 \\times 200 \\times (0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1})^{2}} = \\frac{6.221727...}{2 \\times 200 \\times 0.0625} = \\frac{6.221727...}{25} \\approx 0.248869$$\n\n步骤 2：确定最大允许间距 $\\Delta s_{\\max}$。\n重叠由两个高斯分布的 Bhattacharyya 系数给出：\n$$O(\\Delta s) = \\exp\\left(-\\frac{\\Delta s^{2}}{8 \\sigma^{2}}\\right)$$\n其中 $\\sigma^{2} = k_{B} T / k$ 是每个窗口中偏置分布的方差。为了找到最大间距 $\\Delta s_{\\max}$，我们设 $O(\\Delta s_{\\max}) = O_{\\min}$：\n$$\\exp\\left(-\\frac{\\Delta s_{\\max}^{2}}{8 \\sigma^{2}}\\right) = O_{\\min}$$\n求解 $\\Delta s_{\\max}$：\n$$-\\frac{\\Delta s_{\\max}^{2}}{8 \\sigma^{2}} = \\ln(O_{\\min})$$\n$$\\Delta s_{\\max}^{2} = -8 \\sigma^{2} \\ln(O_{\\min}) = 8 \\sigma^{2} \\ln\\left(\\frac{1}{O_{\\min}}\\right)$$\n$$\\Delta s_{\\max} = \\sqrt{8 \\sigma^{2} \\ln\\left(\\frac{1}{O_{\\min}}\\right)}$$\n首先，我们计算方差 $\\sigma^2$：\n$$\\sigma^{2} = \\frac{k_{B} T}{k} = \\frac{2.4943387854\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}}{1200\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-2}} \\approx 0.0020786\\,\\mathrm{nm}^{2}$$\n现在，我们可以计算 $\\Delta s_{\\max}$：\n$$\\Delta s_{\\max} = \\sqrt{8 \\times (0.0020786\\,\\mathrm{nm}^{2}) \\times \\ln\\left(\\frac{1}{0.248869}\\right)} = \\sqrt{0.016629\\,\\mathrm{nm}^{2} \\times \\ln(4.018177...)}$$\n$$\\Delta s_{\\max} = \\sqrt{0.016629\\,\\mathrm{nm}^{2} \\times 1.390812} = \\sqrt{0.0231365\\,\\mathrm{nm}^{2}} \\approx 0.152107\\,\\mathrm{nm}$$\n\n步骤 3：计算最小窗口数 $M$。\n题目指定了用间距 $\\Delta s$ 覆盖范围 $L = s_{\\max} - s_{\\min} = 2\\,\\mathrm{nm}$ 所需的窗口数 $M$ 的公式：\n$$M = \\left\\lceil \\frac{s_{\\max} - s_{\\min}}{\\Delta s} \\right\\rceil + 1$$\n为了找到最小整数 $M$，我们必须使用最大可能间距 $\\Delta s_{\\max}$：\n$$M = \\left\\lceil \\frac{2\\,\\mathrm{nm}}{0.152107\\,\\mathrm{nm}} \\right\\rceil + 1$$\n$$M = \\lceil 13.1486 \\rceil + 1 = 14 + 1 = 15$$\n所需的最小整数窗口数为 15。\n\n权衡关系的简要说明：\n上面推导出的关系阐明了设计伞形采样模拟时的关键权衡。窗口数 $M$ 主要由最大允许间距 $\\Delta s_{\\max}$ 决定，其中 $M$ 与 $\\Delta s_{\\max}$ 成反比。\n- 与力常数 $k$ 的权衡：间距由 $\\Delta s_{\\max} = \\sqrt{8(k_B T/k) \\ln(1/O_{\\min})}$ 给出，因此 $\\Delta s_{\\max} \\propto 1/\\sqrt{k}$。一个更强的谐波限制（更大的 $k$）会导致更窄的采样分布（更小的 $\\sigma^2$）。为了保持窗口间必要的重叠，它们必须放得更近（更小的 $\\Delta s_{\\max}$），从而增加了总窗口数 $M$。\n- 与采样时间 $t_{w}$ 的权衡：间距通过最小重叠依赖于采样时间，$O_{\\min} = \\frac{(k_B T)^2}{2(t_w/2\\tau_{int}) \\delta F^2} \\propto 1/t_w$。每个窗口更长的模拟时间 $t_w$ 会增加有效样本数 $N_{\\mathrm{eff}}$，这意味着只需要较小的重叠程度 $O_{\\min}$ 就足以达到目标精度 $\\delta F$。一个更小的 $O_{\\min}$ 允许更大的间距 $\\Delta s_{\\max}$（因为 $\\Delta s_{\\max} \\propto \\sqrt{\\ln(1/O_{\\min})}$）。因此，增加 $t_w$ 会减少所需的窗口数 $M$。这代表了一个基本的权衡：在固定的 $k$ 和 $\\delta F$ 下，可以运行更多窗口但每个窗口时间更短，或者运行更少窗口但每个窗口时间更长，以在最终的 PMF 中达到相同的总体质量。",
            "answer": "$$\\boxed{15}$$"
        },
        {
            "introduction": "一个精心设计的模拟方案只是第一步；稳健的执行和验证对于得出可靠的科学结论同等重要。本练习聚焦于质量控制这一关键任务，要求你评估用于验证每个模拟窗口是否达到平衡并进行了充分采样的不同方案 。通过这个过程，你将学会识别用于判断平稳性和统计收敛性的基本诊断检查，这些检查是区分高质量模拟与不可靠模拟的标志。",
            "id": "3410782",
            "problem": "考虑一个分子体系在温度 $T = 300 \\ \\mathrm{K}$ 下，沿着一维集体变量 $s(t)$ 进行伞形采样，其谐波偏置势为 $U_{\\mathrm{b}}(s) = \\frac{1}{2} k (s - s_{0})^{2}$。使用朗之万动力学来演化轨迹，以便在每个伞形窗内对正则分布进行采样。您希望为每个窗口设计并验证一个平衡方案，并为生产采样指定接受标准，使用两个诊断指标：$s$ 的去相关时间估计值和势能漂移。\n\n作为基本依据，假设以下陈述为真，并可用于证明您的设计和解读的合理性：(i) 窗口内的平衡意味着在偏置作用下，$s(t)$ 和势能 $U(t)$ 具有平稳性；(ii) $s(t)$ 的自相关函数 $C_{s}(\\Delta t)$ 决定了积分自相关时间 $\\tau_{\\mathrm{int}}$，该时间设定了过程的记忆时间尺度；(iii) 可以通过线性回归估计斜率 $\\alpha$ 及其置信区间来评估 $U(t)$ 是否缺乏显著漂移。您可以假设采样间隔是固定的，且采样在时间上是均匀的。\n\n您在一个代表性窗口中进行了一次初步运行，使用标准的时间序列分析方法对轨迹的后期部分进行估计，得到了以下诊断指标：\n- $s(t)$ 的积分自相关时间为 $\\hat{\\tau}_{\\mathrm{int}} = 0.8 \\ \\mathrm{ps}$，95% 置信区间为 $[0.6, 1.2] \\ \\mathrm{ps}$。\n- 对势能时间序列 $U(t)$ 进行线性拟合，返回的斜率估计值为 $\\hat{\\alpha} = -0.001 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$，95% 置信区间为 $[-0.004, 0.002] \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$。在 $T = 300 \\ \\mathrm{K}$ 时，热能为 $k_{\\mathrm{B}} T \\approx 2.5 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1}$。\n- 在此窗口中，带偏置的 $s$ 分布的标准差为 $\\sigma_{s} = 0.20$。\n\n您将从以下候选方案中选择一个，用于验证所有窗口的平衡过程并定义生产采样的接受标准。每个方案都规定了 (i) 如何确定一个窗口的初始预烧（平衡）时长，(ii) 宣布达到平衡的诊断指标和阈值，以及 (iii) 每个窗口的最小生产时长和生产采样的接受标准。\n\n哪一个方案与关于平稳性、去相关性和漂移诊断的第一性原理推理最为一致，并能保证每个窗口有足够大的有效统计独立样本数量，从而进行稳健的自由能估计？\n\n- A. 平衡预烧时长是自适应设定的：丢弃数据，直到一个长度至少为 $5 \\hat{\\tau}_{\\mathrm{int}}$ 的连续尾部片段同时满足两个标准：(i) $s$ 的反向累积平均值稳定，即时长为 $\\hat{\\tau}_{\\mathrm{int}}$ 的连续不重叠窗口的块平均值之差小于 $0.1 \\sigma_{s}$，以及 (ii) 势能漂移斜率的 95% 置信区间包含零且 $|\\hat{\\alpha}|  0.01 \\, k_{\\mathrm{B}} T \\ \\mathrm{ps}^{-1}$。每个窗口的生产时长设置为 $T_{\\mathrm{prod}} \\ge 1600 \\ \\mathrm{ps}$，接受标准要求每个窗口的有效独立样本数 $N_{\\mathrm{eff}} \\ge 1000$，通过生产阶段中 $s$ 块平均值的一致性来验证平稳性，并且沿 $s$ 轴的相邻窗口重叠度（由 $O = \\int \\min\\{p_{i}(s), p_{i+1}(s)\\} \\, ds$ 衡量）至少为 $0.10$。\n\n- B. 平衡预烧时长固定为 $5 \\ \\mathrm{ps}$，不论 $\\hat{\\tau}_{\\mathrm{int}}$ 为何值，并在拟合的能量斜率精确等于 $0 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$ 时宣布达到平衡。每个窗口的生产时长设置为 $T_{\\mathrm{prod}} = 40 \\ \\mathrm{ps}$，接受标准要求收集至少 $100$ 个样本；如果每个窗口都单独满足这些标准，则不需要进行相邻窗口之间的重叠度检查。\n\n- C. 平衡预烧时长设置为 $2 \\hat{\\tau}_{\\mathrm{int}}$，并在 $|\\hat{\\alpha}|  0.1 \\, k_{\\mathrm{B}} T \\ \\mathrm{ps}^{-1}$ 时宣布达到平衡，不要求斜率置信区间包含零。每个窗口的生产时长为 $T_{\\mathrm{prod}} = 80 \\ \\mathrm{ps}$，接受标准要求生产阶段的 $s$ 平均值与最后一个预烧块平均值之差在 $0.5 \\sigma_{s}$ 以内；没有强制规定独立样本数量的显式最小值。\n\n- D. 平衡预烧仅由能量漂移定义：丢弃数据，直到斜率检验的 $p$-value 超过 $0.05$，然后在不参考 $s$ 的情况下接受平衡。每个窗口的生产时长使用势能的积分自相关时间 $\\hat{\\tau}_{\\mathrm{int}}(U)$ 来设置，取 $T_{\\mathrm{prod}} = 800 \\ \\mathrm{ps}$ 并使用 $\\hat{\\tau}_{\\mathrm{int}}(U)$ 计算样本独立性，不对 $s$ 的平稳性或窗口重叠度进行进一步检查。\n\n选择唯一的最佳选项。",
            "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知信息\n- **系统描述**：分子体系的伞形采样。\n- **热力学状态**：温度 $T = 300 \\ \\mathrm{K}$。\n- **集体变量 (CV)**：一维变量 $s(t)$。\n- **偏置势**：谐波势，$U_{\\mathrm{b}}(s) = \\frac{1}{2} k (s - s_{0})^{2}$。\n- **动力学**：朗之万动力学，用于对正则分布进行采样。\n- **假设原则**：\n    - (i) 平衡意味着 $s(t)$ 和势能 $U(t)$ 的平稳性。\n    - (ii) 集体变量 $s(t)$ 的自相关函数 $C_{s}(\\Delta t)$ 决定了积分自相关时间 $\\tau_{\\mathrm{int}}$。\n    - (iii) 能量漂移通过线性回归的斜率 $\\alpha$ 及其置信区间进行评估。\n- **初步诊断数据**：\n    - $s(t)$ 的积分自相关时间：$\\hat{\\tau}_{\\mathrm{int}} = 0.8 \\ \\mathrm{ps}$，95% 置信区间为 $[0.6, 1.2] \\ \\mathrm{ps}$。\n    - 势能漂移斜率：$\\hat{\\alpha} = -0.001 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$，95% 置信区间为 $[-0.004, 0.002] \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$。\n    - 热能：$k_{\\mathrm{B}} T \\approx 2.5 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1}$。\n    - 窗口中 $s$ 的标准差：$\\sigma_{s} = 0.20$。\n- **目标**：选择与第一性原理推理最一致且能保证稳健自由能估计的平衡和生产采样方案。\n\n### 步骤 2：使用提取的已知信息进行验证\n问题陈述具有科学依据、适定且客观。它描述了计算化学/物理学中的一个标准且现实的场景：设计并验证一个增强采样模拟方案。所使用的概念——伞形采样、朗之万动力学、自相关时间、平稳性和统计诊断——都是分子模拟领域的基础。所提供的数值数据对于一个分子体系来说是物理上合理的。问题表述清晰，要求根据已建立的统计力学原理评估给定的方案。问题是自洽的，并提供了进行所要求分析的全部必要信息。未发现任何缺陷。\n\n### 步骤 3：结论与行动\n问题陈述是**有效**的。将通过评估每个提议的方案来推导详细解法。\n\n### 推导与选项分析\n\n核心任务是为伞形采样模拟确定最严谨且统计上可靠的方案。一个稳健的方案必须解决三个关键方面：\n1.  **平衡**：系统必须经过足够长时间的模拟，以消除其初始非平衡态的记忆。这个“预烧”阶段必须相对于系统的最长弛豫时间足够长，而最長弛豫時間通常是最慢的相关变量（这里是集体变量 $s$）的积分自相关时间 $\\tau_{\\mathrm{int}}$。平衡过程必须通过定量诊断指标来验证，例如监控可观测量的稳定性以及是否存在能量漂移。\n2.  **生产采样**：生产运行必须足够长，以产生足够数量的统计独立样本，从而确保计算出的平均值以及最终的自由能曲线的精度。有效独立样本的数量由 $N_{\\mathrm{eff}} \\approx T_{\\mathrm{prod}} / (2\\tau_{\\mathrm{int}})$ 给出，其中 $T_{\\mathrm{prod}}$ 是总生产时间。\n3.  **伞形采样的特殊要求**：为了使加权直方图分析方法 (WHAM) 或类似的重加权技术有效工作，来自相邻伞形窗的集体变量概率分布 $p_i(s)$ 必须有足够的重叠。\n\n基于这些原则，我们评估每个选项。\n\n**选项 A 分析**\n- **平衡**：提出一个自适应的预烧方案，丢弃数据直到一个长度至少为 $5 \\hat{\\tau}_{\\mathrm{int}}$ 的尾部片段显示出平稳性。这是一个优秀的方法。时长与系统的内在时间尺度（$\\hat{\\tau}_{\\mathrm{int}}$）挂钩，并且是一个安全的倍数（$5\\times$）。\n- **平衡诊断**：它使用了两个独立且可靠的标准：\n    1.  集体变量 $s$ 的稳定性，通过比较大小为 $\\hat{\\tau}_{\\mathrm{int}}$ 的不重叠块的平均值来检查。使用相对于集体变量标准差（$0.1 \\sigma_s$）的阈值是一种稳健且与尺度无关的方法。使用反向累积平均值是一种强大的可视化和编程工具，用于找到平衡点。\n    2.  无能量漂移，通过要求斜率 $\\hat{\\alpha}$ 的 95% 置信区间包含零来检查。这是检验漂移不显著的统计上正确的方法。$|\\hat{\\alpha}|  0.01 \\, k_{\\mathrm{B}} T \\ \\mathrm{ps}^{-1}$ 的额外要求是一种很好的实践，可以防止统计上不显著的漂移在物理上仍然很大的情况（例如，由于噪声很大的数据导致置信区间很宽）。\n- **生产**：设置最小生产时长 $T_{\\mathrm{prod}} \\ge 1600 \\ \\mathrm{ps}$。对于给定的 $\\hat{\\tau}_{\\mathrm{int}} = 0.8 \\ \\mathrm{ps}$，这会产生 $N_{\\mathrm{eff}} = T_{\\mathrm{prod}} / (2\\hat{\\tau}_{\\mathrm{int}}) = 1600 / (2 \\times 0.8) = 1000$。$N_{\\mathrm{eff}} \\ge 1000$ 的要求确保了高统计精度。\n- **生产接受标准**：\n    1.  要求 $N_{\\mathrm{eff}} \\ge 1000$，这是采样质量的有力保证。\n    2.  通过*在*生产运行期间检查 $s$ 的块平均值来重新验证平稳性，这是一个关键的质量控制步骤。\n    3.  要求相邻窗口之间有最小重叠度（$O \\ge 0.10$），这对于通过 WHAM 进行精确的自由能重构至关重要。定义 $O = \\int \\min\\{p_{i}(s), p_{i+1}(s)\\} \\, ds$ 是一种标准的重叠度衡量方法。\n\n- **结论**：**正确**。该方案全面、统计上严谨，并遵循了高质量增强采样模拟的所有已建立的最佳实践。\n\n**选项 B 分析**\n- **平衡**：为所有窗口提出一个固定的 $5 \\ \\mathrm{ps}$ 预烧时间，而不考虑其特定的 $\\hat{\\tau}_{\\mathrm{int}}$。这存在根本性缺陷，因为集体变量空间的不同区域可能有截然不同的弛豫动力学。\n- **平衡诊断**：当拟合斜率 $\\hat{\\alpha}$ *精确*等于 $0 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$ 时宣布达到平衡。对于随机数据，这是一个统计上不可能的条件。即使对于完全平稳的过程，来自有限样本的点估计几乎永远不会精确为零。\n- **生产**：设置 $T_{\\mathrm{prod}} = 40 \\ \\mathrm{ps}$。这太短了。它仅产生 $N_{\\mathrm{eff}} = 40 / (2 \\times 0.8) = 25$ 个独立样本，这对于稳健的统计来说是不够的。“至少收集 100 个样本”的标准是无意义的，因为它忽略了数据中强烈的时间相关性。\n- **生产接受标准**：明确且错误地指出“不需要...重叠度检查”。对于从伞形采样进行精确的自由能计算，足够的重叠是不可或缺的。\n- **结论**：**错误**。该方案在每个主要方面都存在缺陷：平衡时长、平衡诊断、生产长度和接受标准。\n\n**选项 C 分析**\n- **平衡**：将预烧时间设置为 $2 \\hat{\\tau}_{\\mathrm{int}}$。这通常被认为太短，无法可靠地消除初始条件的记忆。更安全的选择通常是 $\\ge 5 \\hat{\\tau}_{\\mathrm{int}}$。\n- **平衡诊断**：当 $|\\hat{\\alpha}|  0.1 \\, k_{\\mathrm{B}} T \\ \\mathrm{ps}^{-1}$ 时宣布达到平衡，但“不要求斜率置信区间包含零”。这在统计上是不可靠的。如果一个小的点估计 $\\hat{\\alpha}$ 的置信区间很窄且不包含零，它仍然可以是统计上显著的，表明存在真实但缓慢的漂移。阈值也非常宽松：$0.1 k_{\\mathrm{B}} T \\ \\mathrm{ps}^{-1} \\approx 0.25 \\ \\mathrm{kJ} \\ \\mathrm{mol}^{-1} \\ \\mathrm{ps}^{-1}$。\n- **生产**：设置 $T_{\\mathrm{prod}} = 80 \\ \\mathrm{ps}$，产生 $N_{\\mathrm{eff}} = 80 / (2 \\times 0.8) = 50$ 个独立样本。这对于高精度结果来说太低了。\n- **生产接受标准**：将生产阶段 $s$ 的平均值与预烧阶段的单个块平均值进行比较。这是对平稳性的弱检查。它没有强制规定 $N_{\\mathrm{eff}}$ 的显式最小值，并且完全忽略了对窗口重叠的关键检查。\n- **结论**：**错误**。该方案使用的预烧时间太短，采用了统计上有缺陷的漂移测试，产生的独立样本太少，并且缺乏必要的质量检查。\n\n**选项 D 分析**\n- **平衡**：仅根据能量漂移定义平衡（$p$-value > 0.05）。这是能量平稳性的有效检验，但其本身并不足够。它完全忽略了主要关注变量——集体变量 $s$ 的动力学。必须为所有相关的慢自由度建立平衡。\n- **生产**：使用势能的自相关时间 $\\hat{\\tau}_{\\mathrm{int}}(U)$ 来定义采样独立性。这是一个关键错误。目标是获得沿 $s$ 的自由能曲线，因此统计不确定性取决于 $s$ 的采样效率。应使用的正确时间是 $\\hat{\\tau}_{\\mathrm{int}}(s)$。能量和复杂集体变量的去相关时间通常非常不同。\n- **生产接受标准**：包括“不对 $s$ 的平稳性或窗口重叠度进行进一步检查”。与其他有缺陷的选项一样，这忽略了有效方案的两个必要组成部分。\n- **结论**：**错误**。该方案错误地关注势能动力学而非集体变量动力学，并且未能包含对集体变量平稳性和窗口重叠的必要检查。\n\n**总结**\n方案 A 是唯一系统且正确地包含了进行严谨而稳健的伞形采样研究所需的所有必要组成部分的方案。它使用了适当的、自适应的时间尺度，对平衡和平稳性都进行了可靠的统计检验，要求有足够数量的统计独立样本，并包含了对相邻窗口重叠度的必要检查。其他方案包含一个或多个基本的概念或统计错误，这些错误会损害模拟结果的质量和有效性。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}