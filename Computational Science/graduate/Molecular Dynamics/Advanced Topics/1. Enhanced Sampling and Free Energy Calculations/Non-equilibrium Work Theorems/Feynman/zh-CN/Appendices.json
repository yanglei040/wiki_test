{
    "hands_on_practices": [
        {
            "introduction": "为了开始我们的实践探索，我们首先将非平衡功的概念置于一个具体的物理模型中。这个练习  要求你分析一个在被拖拽的谐振子势阱中的过阻尼布朗粒子，这是随机热力学中的一个基石系统。通过从朗之万方程推导功分布的方差，你将对外部驱动如何影响系统涨落并产生耗散功建立起基本的理解。",
            "id": "317561",
            "problem": "考虑一个一维过阻尼布朗粒子，被限制在一个谐波势 $V(x, \\lambda) = \\frac{1}{2} k (x - \\lambda)^2$ 中。该粒子与一个恒定温度为 $T$ 的热库接触。系统在时间 $t=0$ 时处于热平衡状态，此时势的中心位于 $\\lambda(0) = 0$。\n\n从 $t=0$ 开始，谐波势阱的中心以恒定速度 $u$ 被拖动，持续时间为 $\\tau$。因此，在时间 $t$ 时势阱中心的位置由 $\\lambda(t) = ut$ 给出，其中 $0 \\le t \\le \\tau$。粒子位置 $x(t)$ 的动力学由过阻尼朗之万方程描述：\n$$\n\\gamma \\frac{dx}{dt} = -\\frac{\\partial V(x, \\lambda(t))}{\\partial x} + \\xi(t)\n$$\n其中 $\\gamma$ 是摩擦系数，$k$ 是势阱刚度，$\\xi(t)$ 是一个高斯白噪声项，其均值为零 $\\langle \\xi(t) \\rangle = 0$，关联为 $\\langle \\xi(t) \\xi(t') \\rangle = 2 \\gamma k_B T \\delta(t-t')$，其中 $k_B$ 是玻尔兹曼常数。\n\n在此过程中对系统所做的功 $W$ 由施加在控制参数 $\\lambda$ 上的力乘以其位移的积分给出：\n$$\nW = \\int_0^\\tau \\frac{\\partial V(x(t), \\lambda(t))}{\\partial \\lambda} \\frac{d\\lambda}{dt} dt\n$$\n\n推导功分布的方差 $\\sigma_W^2 = \\langle W^2 \\rangle - \\langle W \\rangle^2$ 的一个封闭形式解析表达式，该表达式是参数 $\\gamma, k, T, u,$ 和 $\\tau$ 的函数。",
            "solution": "1. 朗之万方程和功的表达式\n伽马摩擦与势阱中心拖动给出\n$$\\gamma\\dot x=-k[x-\\lambda(t)]+\\xi(t),\\quad \\lambda(t)=ut.$$\n功为\n$$W=\\int_0^\\tau\\frac{\\partial V}{\\partial\\lambda}\\dot\\lambda\\,dt\n=\\int_0^\\tau k[x(t)-\\lambda(t)]\\,u\\,dt.$$\n\n2. 定义位移坐标 $y(t)=x(t)-ut$。则\n$$\\dot y=\\dot x-u=-\\frac{k}{\\gamma}y-u+\\frac{\\xi(t)}{\\gamma}$$\n初始条件 $y(0)$ 从平衡态中抽样得到，$\\langle y(0)\\rangle=0$，$\\mathrm{Var}[y(0)]=k_B T/k$。\n\n3. 平均功\n$$\\langle W\\rangle=k\\,u\\int_0^\\tau\\langle y(t)\\rangle dt,\\quad\n\\langle y(t)\\rangle=-\\frac{u}{\\alpha}(1-e^{-\\alpha t}),\\;\\alpha=\\frac{k}{\\gamma}.$$\n因此\n$$\\langle W\\rangle\n=\\frac{k\\,u^2}{\\alpha}\\int_0^\\tau(1-e^{-\\alpha t})dt\n=\\gamma u^2\\Bigl(\\tau-\\frac{\\gamma}{k}(1-e^{-k\\tau/\\gamma})\\Bigr).$$\n\n4. 功的方差\n由于 $y(t)=\\langle y(t)\\rangle+z(t)$，其中 $z(t)$ 是一个OU过程，其协方差为\n$$\\langle z(t_1)z(t_2)\\rangle=\\frac{k_B T}{k}e^{-\\alpha|t_1-t_2|},$$\n我们有\n$$\\sigma_W^2\n=k^2u^2\\iint_0^\\tau\\langle z(t_1)z(t_2)\\rangle dt_1dt_2\n=k^2u^2\\frac{k_B T}{k}I,$$\n其中\n$$I=\\int_0^\\tau\\!\\!\\int_0^\\tau e^{-\\alpha|t_1-t_2|}dt_1dt_2\n=2\\int_0^\\tau\\Bigl[\\int_0^{t}e^{-\\alpha(t-s)}ds\\Bigr]dt\n=\\frac{2}{\\alpha}\\Bigl(\\tau-\\frac{1-e^{-\\alpha\\tau}}{\\alpha}\\Bigr).$$\n因此\n$$\\sigma_W^2\n=2\\gamma u^2k_B T\\Bigl(\\tau-\\frac{\\gamma}{k}(1-e^{-k\\tau/\\gamma})\\Bigr).$$",
            "answer": "$$\\boxed{2\\gamma\\,k_B T\\,u^2\\Bigl(\\tau-\\frac{\\gamma}{k}\\bigl(1-e^{-k\\tau/\\gamma}\\bigr)\\Bigr)}$$"
        },
        {
            "introduction": "在了解了功分布如何产生之后，我们现在转向非平衡功定理的核心应用：从非平衡过程中提取平衡信息。这个练习  挑战你根据给定的功分布计算自由能差，这模拟了你从模拟中获得数据的场景。你将直接应用 Jarzynski 等式，并探索其与 Crooks 涨落定理以及正向和反向过程之间对称性的深刻联系。",
            "id": "3428948",
            "problem": "一个一维过阻尼粒子在谐波势中通过分子动力学（MD）进行模拟，其刚度参数 $\\lambda(t)$ 在有限的协议时长 $\\tau$ 内，于恒定温度 $T$ 下，从初始值 $\\lambda_{0}$ 被驱动至最终值 $\\lambda_{1}$。微观动力学是时间反演不变的，系统最初在正则系综中于 $\\lambda_{0}$ 处达到平衡，其概率密度为 $\\rho_{0}(x) = Z_{0}^{-1} \\exp(-\\beta H(x;\\lambda_{0}))$，其中 $H(x;\\lambda)$ 是哈密顿量，$Z_{0}$ 是配分函数，$\\beta = 1/(R T)$，$R$ 为摩尔气体常数。对于协议的任何单次实现，功由广义力-位移泛函定义：$W = \\int_{0}^{\\tau} (\\partial H/\\partial \\lambda)\\, \\dot{\\lambda}(t)\\, dt$。\n\n从大量的正向过程实现（驱动 $\\lambda_{0} \\to \\lambda_{1}$）的系综中，测得的功值 $W$ 的分布可以用均值为 $\\mu_{F}$、标准差为 $\\sigma_{F}$ 的高斯分布很好地描述。独立地，一个逆向过程实现（驱动 $\\lambda_{1} \\to \\lambda_{0}$）的系综产生的功值也呈高斯分布，其均值为 $\\mu_{R}$，标准差为 $\\sigma_{R}$。对于此处研究的协议，获得了以下经验表征：\n- 正向：$\\mu_{F} = 7.50\\,\\text{kJ/mol}$，$\\sigma_{F} = 2.50\\,\\text{kJ/mol}$。\n- 逆向：$\\mu_{R} = -4.994\\,\\text{kJ/mol}$，$\\sigma_{R} = 2.50\\,\\text{kJ/mol}$。\n温度为 $T = 300\\,\\text{K}$，摩尔气体常数为 $R = 8.314462618\\,\\text{J}\\,(\\text{mol}\\,\\text{K})^{-1}$。\n\n从平衡的正则系综定义、微观功泛函以及动力学的微观可逆性出发，推导将正向和逆向功分布与平衡自由能差 $\\Delta F = F(\\lambda_{1}) - F(\\lambda_{0})$ 联系起来的约束条件。然后，仅使用这些基础和给定的正向功系综的高斯表征，通过对正向功系综进行指数平均来计算平衡自由能差，并以 $\\text{kJ/mol}$ 为单位表示您的最终结果。将您的答案四舍五入到四位有效数字。此外，在相同的基础上，分析证明您获得的值等于唯一的交叉点 $W_{c}$，在该点处正向功密度等于在 $-W$ 处评估的逆向功密度，即 $p_{F}(W_{c}) = p_{R}(-W_{c})$。",
            "solution": "该问题要求根据非平衡过程中所做功的统计数据计算平衡自由能差 $\\Delta F$，并分析证明该量与正向和逆向功分布的交叉点之间的关系。将非平衡功与平衡自由能联系起来的基本原理是 Jarzynski 等式。\n\nJarzynski 等式是基于以下前提推导出来的：系统初始处于正则平衡态，并遵循哈密顿动力学（即使与维持恒温的热浴耦合，如本题中由朗之万方程描述的过阻尼情况）演化，且其动力学过程是微观可逆的。该等式指出，对系统所做功 $W$ 的指数平均值与控制参数值为 $\\lambda_{1}$ 和 $\\lambda_{0}$ 对应的最终和初始平衡态之间的自由能差 $\\Delta F = F(\\lambda_{1}) - F(\\lambda_{0})$ 相关：\n$$\n\\langle \\exp(-\\beta W) \\rangle = \\exp(-\\beta \\Delta F)\n$$\n此处，$\\beta = (RT)^{-1}$，其中 $R$ 是摩尔气体常数，$T$ 是绝对温度。尖括号表示对正向过程（驱动 $\\lambda$ 从 $\\lambda_{0}$ 到 $\\lambda_{1}$）的实现系综所做的平均。\n\n问题陈述指出，正向过程的功值分布 $p_{F}(W)$ 是一个均值为 $\\mu_{F}$、标准差为 $\\sigma_{F}$ 的高斯分布：\n$$\np_{F}(W) = \\frac{1}{\\sigma_{F} \\sqrt{2\\pi}} \\exp\\left(-\\frac{(W-\\mu_{F})^2}{2\\sigma_{F}^2}\\right)\n$$\n为了应用 Jarzynski 等式，我们必须计算系综平均 $\\langle \\exp(-\\beta W) \\rangle$。对于一个高斯分布的随机变量 $W \\sim \\mathcal{N}(\\mu_F, \\sigma_F^2)$，其指数平均值有一个标准结果：对于任意常数 $k$，$\\langle \\exp(kW) \\rangle = \\exp(k\\mu_F + k^2\\sigma_F^2/2)$。令 $k = -\\beta$，我们得到：\n$$\n\\langle \\exp(-\\beta W) \\rangle = \\exp\\left(-\\beta\\mu_{F} + \\frac{\\beta^2\\sigma_{F}^2}{2}\\right)\n$$\n将此结果与 Jarzynski 等式相等：\n$$\n\\exp(-\\beta \\Delta F) = \\exp\\left(-\\beta\\mu_{F} + \\frac{\\beta^2\\sigma_{F}^2}{2}\\right)\n$$\n对两边取自然对数，得到：\n$$\n-\\beta \\Delta F = -\\beta\\mu_{F} + \\frac{\\beta^2\\sigma_{F}^2}{2}\n$$\n两边同除以 $-\\beta$（因为 $\\beta \\neq 0$）来求解 $\\Delta F$：\n$$\n\\Delta F = \\mu_{F} - \\frac{\\beta\\sigma_{F}^2}{2}\n$$\n现在，我们代入给定的数值：\n$\\mu_{F} = 7.50\\,\\text{kJ/mol}$\n$\\sigma_{F} = 2.50\\,\\text{kJ/mol}$\n$T = 300\\,\\text{K}$\n$R = 8.314462618\\,\\text{J}\\,(\\text{mol}\\,\\text{K})^{-1}$\n\n首先，我们计算乘积 $RT$ 并将其表示为 $\\text{kJ/mol}$：\n$$\nRT = (8.314462618\\,\\text{J}\\,(\\text{mol}\\,\\text{K})^{-1})(300\\,\\text{K}) = 2494.3387854\\,\\text{J/mol} = 2.4943387854\\,\\text{kJ/mol}\n$$\n项 $\\beta\\sigma_{F}^2/2$ 为：\n$$\n\\frac{\\beta\\sigma_{F}^2}{2} = \\frac{\\sigma_{F}^2}{2RT} = \\frac{(2.50\\,\\text{kJ/mol})^2}{2 \\times 2.4943387854\\,\\text{kJ/mol}} = \\frac{6.25\\,(\\text{kJ/mol})^2}{4.9886775708\\,\\text{kJ/mol}} \\approx 1.252839\\,\\text{kJ/mol}\n$$\n最后，我们计算 $\\Delta F$：\n$$\n\\Delta F = 7.50\\,\\text{kJ/mol} - 1.252839\\,\\text{kJ/mol} = 6.247161\\,\\text{kJ/mol}\n$$\n按要求四舍五入到四位有效数字，我们得到 $\\Delta F = 6.247\\,\\text{kJ/mol}$。\n\n任务的第二部分是证明这个 $\\Delta F$ 的值等于交叉点 $W_{c}$，该交叉点由 $p_{F}(W_{c}) = p_{R}(-W_{c})$ 定义。这个等式是 Crooks 涨落定理的直接推论，该定理是比 Jarzynski 等式更强的陈述，从相同的基础推导而来。Crooks 定理关联了正向（$p_{F}(W)$）和逆向（$p_{R}(W)$）过程的功的概率分布：\n$$\n\\frac{p_{F}(W)}{p_{R}(-W)} = \\exp(\\beta (W - \\Delta F))\n$$\n这里，$p_{R}(-W)$ 是在逆向协议中观察到功值为 $-W$ 的概率密度。\n根据定义，交叉点 $W_{c}$ 是使 $p_{F}(W_{c}) = p_{R}(-W_{c})$ 成立的 $W$ 值。在这一点上，Crooks 定理左侧的比值为 1：\n$$\n\\frac{p_{F}(W_{c})}{p_{R}(-W_{c})} = 1\n$$\n将此代入定理中，得到：\n$$\n1 = \\exp(\\beta (W_{c} - \\Delta F))\n$$\n对两边取自然对数意味着指数必须为零：\n$$\n\\beta(W_{c} - \\Delta F) = 0 \\implies W_{c} = \\Delta F\n$$\n这个一般性结果证实了自由能差对应于正向和逆向功分布相交处的功值。\n\n为了使用给定的高斯形式进一步验证这一点，我们明确地求解 $W_c$。逆向功分布是均值为 $\\mu_{R}$、标准差为 $\\sigma_{R}$ 的高斯分布，因此 $-W$ 的分布（来自逆向过程）是均值为 $-\\mu_{R}$、标准差为 $\\sigma_{R}$ 的高斯分布。\n条件 $p_{F}(W_{c}) = p_{R}(-W_{c})$ 变为：\n$$\n\\frac{1}{\\sigma_{F} \\sqrt{2\\pi}} \\exp\\left(-\\frac{(W_{c}-\\mu_{F})^2}{2\\sigma_{F}^2}\\right) = \\frac{1}{\\sigma_{R} \\sqrt{2\\pi}} \\exp\\left(-\\frac{(W_{c}-(-\\mu_{R}))^2}{2\\sigma_{R}^2}\\right)\n$$\n为了使 Crooks 定理对所有 $W$ 的高斯分布都成立，必须有 $\\sigma_{F} = \\sigma_{R}$。给定数据 $\\sigma_F = \\sigma_R = 2.50\\,\\text{kJ/mol}$ 满足此条件。设 $\\sigma = \\sigma_F = \\sigma_R$。方程简化为：\n$$\n(W_{c}-\\mu_{F})^2 = (W_{c}+\\mu_{R})^2\n$$\n$$\nW_{c}^2 - 2W_{c}\\mu_{F} + \\mu_{F}^2 = W_{c}^2 + 2W_{c}\\mu_{R} + \\mu_{R}^2\n$$\n$$\n\\mu_{F}^2 - \\mu_{R}^2 = 2W_{c}(\\mu_{F} + \\mu_{R})\n$$\n$$\n(\\mu_{F} - \\mu_{R})(\\mu_{F} + \\mu_{R}) = 2W_{c}(\\mu_{F} + \\mu_{R})\n$$\n因为 $\\mu_{F} + \\mu_{R} = 7.50 - 4.994 = 2.506 \\neq 0$，我们可以除以这一项来找到 $W_c$：\n$$\nW_{c} = \\frac{\\mu_{F} - \\mu_{R}}{2}\n$$\n此外，从将 Crooks 定理应用于高斯功分布推导出的一个必要条件是关系式 $\\mu_{F} + \\mu_{R} = \\beta\\sigma^2$。利用这一点，我们可以证明我们关于 $\\Delta F$ 和 $W_c$ 的两个表达式是相同的。从 Jarzynski 计算中，我们得到：\n$$\n\\Delta F = \\mu_{F} - \\frac{\\beta\\sigma^2}{2}\n$$\n代入 $\\beta\\sigma^2 = \\mu_{F} + \\mu_{R}$：\n$$\n\\Delta F = \\mu_{F} - \\frac{\\mu_{F} + \\mu_{R}}{2} = \\frac{2\\mu_{F} - \\mu_{F} - \\mu_{R}}{2} = \\frac{\\mu_{F} - \\mu_{R}}{2}\n$$\n这恰好是 $W_c$ 的表达式，因此我们在高斯功分布模型的背景下分析证明了 $\\Delta F = W_c$。两种推导都得出相同的数值结果：\n$$\n\\Delta F = W_c = \\frac{7.50\\,\\text{kJ/mol} - (-4.994\\,\\text{kJ/mol})}{2} = \\frac{12.494\\,\\text{kJ/mol}}{2} = 6.247\\,\\text{kJ/mol}\n$$\n这证实了问题数据与涨落定理的一致性，并提供了相同的最终答案。",
            "answer": "$$\n\\boxed{6.247}\n$$"
        },
        {
            "introduction": "功定理对于无限系综是精确的，但在任何真实或计算实验中，我们都使用有限数量的样本。最后一个练习  通过研究 Jarzynski 估计量的统计特性来解决这个关键的实际问题。通过推导和计算有限数据集的偏差和方差，你将深入了解这些估计量的收敛性以及在自由能计算中理解统计误差的重要性。",
            "id": "3428984",
            "problem": "考虑一个分子动力学方案，它将一个系统从逆温度为 $\\beta$ 的初始平衡态驱动到一个最终状态，并在每条轨迹上产生随机功 $W$。定义最终和初始平衡态之间的自由能差为 $\\Delta F$。目标是从第一性原理出发，推导非平衡功定理及其估计量，然后实现一个程序来计算与统计误差和估计量偏差相关的特定量。\n\n从正则系综出发，其中微观态 $\\Gamma$ 上的平衡概率密度与哈密顿量 $H(\\Gamma)$ 的 $\\exp(-\\beta H(\\Gamma))$ 成正比，通过 $F = -\\beta^{-1} \\ln Z$ 定义平衡自由能 $F$，其中 $Z$ 是配分函数。设 $W$ 是在一个从初始平衡分布开始的非平衡方案中完成的机械功。利用微观可逆性以及平衡态由正则分布表征这一事实，推导 $\\Delta F$ 与随机功 $W$ 的指数平均值之间的关系。将 $W$ 视为一个标量随机变量。对于一个正向方案产生高斯分布的功 $W \\sim \\mathcal{N}(\\mu,\\sigma^2)$（参数为 $\\mu$ 和 $\\sigma$）的模型，推导用 $\\beta$、$\\mu$ 和 $\\sigma$ 表示的 $\\Delta F$ 的表达式。\n\n对于有限数量的独立同分布样本 $W_1,\\ldots,W_N$，将Jarzynski估计量定义为\n$$\n\\widehat{\\Delta F}_N = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{N} \\sum_{i=1}^N \\exp(-\\beta W_i)\\right).\n$$\n假设 $W$ 为高斯模型，推导当 $N$ 趋于无穷大时 $\\widehat{\\Delta F}_N$ 的领头阶渐近偏差和方差。你的推导必须从正则平衡的定义开始，不得假定快捷公式；使用适当的变换和中心极限定理，以获得用 $\\beta$、$\\mu$、$\\sigma$ 和 $N$ 表示的表达式。\n\n另外，考虑一个逆向方案，其产生的功也服从高斯分布 $W_{\\mathrm{R}} \\sim \\mathcal{N}(\\mu_{\\mathrm{R}},\\sigma^2)$，且其方差 $\\sigma^2$ 与正向方案相同。使用Crooks涨落定理（该定理通过微观可逆性关联了正向和逆向功分布），推导当两种分布均为高斯分布时，$\\mu_{\\mathrm{F}}$、$\\mu_{\\mathrm{R}}$、$\\sigma$、$\\beta$ 和 $\\Delta F$ 之间的关系。由此，获得用正向和逆向分布的高斯参数表示的 $\\Delta F$ 表达式，并证明它与通过正向分布的指数平均推导出的表达式是一致的。\n\n单位：功 $W$、能量 $F$ 和自由能差 $\\Delta F$ 必须以 $k_{\\mathrm{B}}T$ 的约化能量单位表示，即能量以 $k_{\\mathrm{B}}T$ 的倍数度量，且 $\\beta=1$ 的单位是约化能量的倒数。所有输出必须以这些约化单位的数值形式表示。不出现角度。不出现百分比。\n\n实现一个程序，针对以下测试套件，为每种情况计算以下量：\n- 对于仅有正向高斯模型的情况，计算高斯功模型所蕴含的真实 $\\Delta F$、Jarzynski估计量的领头阶渐近偏差，以及Jarzynski估计量的领头阶渐近标准差。\n- 对于正向和逆向高斯模型，分别根据正向模型和正逆向关系计算 $\\Delta F$，并报告它们是否在数值容差范围内一致。\n\n测试套件：\n- 情况1（理想路径）：$\\beta=1$，$\\mu=5$，$\\sigma=2$，$N=1000$。\n- 情况2（小方差边界）：$\\beta=1$，$\\mu=3$，$\\sigma=0.01$，$N=50$。\n- 情况3（大耗散边缘）：$\\beta=1$，$\\mu=0$，$\\sigma=3$，$N=100$。\n- 情况4（Crooks一致性检查）：$\\beta=1$，正向 $\\mu_{\\mathrm{F}}=2.0$，逆向 $\\mu_{\\mathrm{R}}=\\mu_{\\mathrm{F}}-\\beta\\sigma^2$，其中 $\\sigma=1.5$。\n\n你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，顺序如下：\n$[\\Delta F_1,\\mathrm{bias}_1,\\mathrm{std}_1,\\Delta F_2,\\mathrm{bias}_2,\\mathrm{std}_2,\\Delta F_3,\\mathrm{bias}_3,\\mathrm{std}_3,\\mathrm{crooks\\_agreement}]$\n其中 $\\Delta F_i$ 是以约化能量单位表示的浮点数，$\\mathrm{bias}_i$ 是以约化能量单位表示的浮点数，$\\mathrm{std}_i$ 是以约化能量单位表示的浮点数，$\\mathrm{crooks\\_agreement}$ 是一个布尔值，表示仅正向和正逆向 $\\Delta F$ 表达式之间的差异是否在约化能量单位 $10^{-12}$ 的容差范围内。",
            "solution": "所提出的问题要求从非平衡功定理中推导针对特定功分布的关键结果，然后进行数值实现。我们将首先验证问题陈述的有效性，然后进行完整的推导和求解。\n\n### 问题验证\n该问题在科学上基于非平衡统计力学的既定原理，特别是Jarzynski等式和Crooks涨落定理。其前提，包括使用高斯模型来描述功分布，是文献中用以阐释这些概念的标准做法。该问题是良置的，为获得唯一解提供了所有必要的定义、参数和约束。语言客观且正式。计算任务是所推导理论结果的直接应用。因此，该问题被认为是**有效的**。\n\n### 理论推导\n\n#### 1. 从Jarzynski等式推导自由能差\nJarzynski等式将两个平衡态之间的自由能差 $\\Delta F$ 与通过连接这两个状态的非平衡过程对系统所做的功 $W$ 联系起来：\n$$\n\\exp(-\\beta \\Delta F) = \\langle \\exp(-\\beta W) \\rangle\n$$\n在这里，$\\beta = (k_B T)^{-1}$ 是逆温度，尖括号表示对从热平衡开始的轨迹系综进行的平均。如果功 $W$ 服从概率分布 $P(W)$，则平均值由 $\\int P(W) \\exp(-\\beta W) dW$ 给出。\n\n问题陈述功 $W$ 从高斯分布 $W \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 中抽取，其概率密度函数 (PDF) 为：\n$$\nP(W) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu)^2}{2\\sigma^2}\\right)\n$$\n我们必须计算期望值 $\\langle \\exp(-\\beta W) \\rangle$：\n$$\n\\langle \\exp(-\\beta W) \\rangle = \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(W-\\mu)^2}{2\\sigma^2}\\right) \\exp(-\\beta W) dW\n$$\n为了求解这个积分，我们将指数中的项合并，并对 $W$ 进行配方：\n$$\n-\\frac{(W-\\mu)^2}{2\\sigma^2} - \\beta W = -\\frac{1}{2\\sigma^2} (W^2 - 2\\mu W + \\mu^2 + 2\\sigma^2\\beta W) = -\\frac{1}{2\\sigma^2} [W^2 - 2(\\mu - \\beta\\sigma^2)W + \\mu^2]\n$$\n对含 $W$ 的项进行配方：\n$$\nW^2 - 2(\\mu - \\beta\\sigma^2)W = [W - (\\mu - \\beta\\sigma^2)]^2 - (\\mu - \\beta\\sigma^2)^2\n$$\n将此代入指数中得到：\n$$\n-\\frac{1}{2\\sigma^2} \\left[ [W - (\\mu - \\beta\\sigma^2)]^2 - (\\mu - \\beta\\sigma^2)^2 + \\mu^2 \\right] = -\\frac{[W - (\\mu - \\beta\\sigma^2)]^2}{2\\sigma^2} + \\frac{(\\mu - \\beta\\sigma^2)^2 - \\mu^2}{2\\sigma^2}\n$$\n积分变为：\n$$\n\\langle \\exp(-\\beta W) \\rangle = \\exp\\left(\\frac{(\\mu - \\beta\\sigma^2)^2 - \\mu^2}{2\\sigma^2}\\right) \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{[W - (\\mu - \\beta\\sigma^2)]^2}{2\\sigma^2}\\right) dW\n$$\n该积分是对一个完整的、归一化为 $1$ 的高斯PDF进行的。指数前因子简化为：\n$$\n\\exp\\left(\\frac{\\mu^2 - 2\\mu\\beta\\sigma^2 + \\beta^2\\sigma^4 - \\mu^2}{2\\sigma^2}\\right) = \\exp\\left(\\frac{-2\\mu\\beta\\sigma^2 + \\beta^2\\sigma^4}{2\\sigma^2}\\right) = \\exp\\left(-\\beta\\mu + \\frac{\\beta^2\\sigma^2}{2}\\right)\n$$\n将此结果与Jarzynski等式中的 $\\exp(-\\beta \\Delta F)$ 相等：\n$$\n\\exp(-\\beta \\Delta F) = \\exp\\left(-\\beta\\mu + \\frac{\\beta^2\\sigma^2}{2}\\right)\n$$\n取自然对数并除以 $-\\beta$，得到自由能差的表达式：\n$$\n\\Delta F = \\mu - \\frac{\\beta\\sigma^2}{2}\n$$\n\n#### 2. Jarzynski估计量的渐近偏差和方差\n来自 $N$ 个样本的 $\\Delta F$ 的Jarzynski估计量为：\n$$\n\\widehat{\\Delta F}_N = -\\frac{1}{\\beta} \\ln \\left(\\frac{1}{N} \\sum_{i=1}^N \\exp(-\\beta W_i)\\right) = g(\\hat{y}_N)\n$$\n其中 $y_i = \\exp(-\\beta W_i)$，$\\hat{y}_N = \\frac{1}{N}\\sum y_i$，且 $g(x) = -\\frac{1}{\\beta}\\ln(x)$。\n真实值为 $\\Delta F = g(y)$，其中 $y = E[y_i] = \\langle \\exp(-\\beta W) \\rangle$。对于大的 $N$，我们可以通过对 $g(\\hat{y}_N)$ 在 $y$ 附近进行二阶泰勒展开来分析估计量的性质：\n$$\ng(\\hat{y}_N) \\approx g(y) + g'(y)(\\hat{y}_N - y) + \\frac{1}{2}g''(y)(\\hat{y}_N - y)^2\n$$\n$g(x)$ 的导数为 $g'(x) = -1/(\\beta x)$ 和 $g''(x) = 1/(\\beta x^2)$。\n偏差为 $B[\\widehat{\\Delta F}_N] = E[g(\\hat{y}_N)] - g(y)$。对展开式取期望：\n$$\nE[g(\\hat{y}_N)] \\approx g(y) + g'(y)E[\\hat{y}_N - y] + \\frac{1}{2}g''(y)E[(\\hat{y}_N - y)^2]\n$$\n由于 $E[\\hat{y}_N - y] = 0$ 且 $E[(\\hat{y}_N - y)^2] = \\mathrm{Var}(\\hat{y}_N) = \\frac{1}{N}\\mathrm{Var}(y_i)$，领头阶偏差为：\n$$\nB[\\widehat{\\Delta F}_N] \\approx \\frac{1}{2} g''(y) \\frac{\\mathrm{Var}(y_i)}{N} = \\frac{1}{2N\\beta y^2} \\mathrm{Var}(y_i)\n$$\n为了求 $\\mathrm{Var}(y_i)$，我们需要 $E[y_i^2] = \\langle \\exp(-2\\beta W) \\rangle$。使用与第1部分相同的方法，但用 $2\\beta$ 代替 $\\beta$：\n$$\nE[y_i^2] = \\exp\\left(-2\\beta\\mu + \\frac{(2\\beta)^2\\sigma^2}{2}\\right) = \\exp(-2\\beta\\mu + 2\\beta^2\\sigma^2)\n$$\n我们还有 $y = E[y_i] = \\exp(-\\beta\\mu + \\beta^2\\sigma^2/2)$。所以，$\\mathrm{Var}(y_i) = E[y_i^2] - y^2$：\n$$\n\\mathrm{Var}(y_i) = \\exp(-2\\beta\\mu + 2\\beta^2\\sigma^2) - \\left[\\exp\\left(-\\beta\\mu + \\frac{\\beta^2\\sigma^2}{2}\\right)\\right]^2 = \\exp(-2\\beta\\mu + 2\\beta^2\\sigma^2) - \\exp(-2\\beta\\mu + \\beta^2\\sigma^2)\n$$\n$$\n\\mathrm{Var}(y_i) = \\exp(-2\\beta\\mu + \\beta^2\\sigma^2)[\\exp(\\beta^2\\sigma^2) - 1]\n$$\n偏差表达式的分母中包含 $y^2 = \\exp(-2\\beta\\mu + \\beta^2\\sigma^2)$。将此式和 $\\mathrm{Var}(y_i)$ 代入偏差公式：\n$$\nB[\\widehat{\\Delta F}_N] \\approx \\frac{1}{2N\\beta} \\frac{\\exp(-2\\beta\\mu + \\beta^2\\sigma^2)[\\exp(\\beta^2\\sigma^2) - 1]}{\\exp(-2\\beta\\mu + \\beta^2\\sigma^2)} = \\frac{\\exp(\\beta^2\\sigma^2) - 1}{2N\\beta}\n$$\n估计量的方差，到领头阶（通过Delta方法），为：\n$$\n\\mathrm{Var}(\\widehat{\\Delta F}_N) \\approx [g'(y)]^2 \\mathrm{Var}(\\hat{y}_N) = \\left(-\\frac{1}{\\beta y}\\right)^2 \\frac{\\mathrm{Var}(y_i)}{N} = \\frac{\\mathrm{Var}(y_i)}{N\\beta^2 y^2}\n$$\n这得到：\n$$\n\\mathrm{Var}(\\widehat{\\Delta F}_N) \\approx \\frac{\\exp(\\beta^2\\sigma^2) - 1}{N\\beta^2}\n$$\n标准差是其平方根：\n$$\n\\mathrm{StdDev}(\\widehat{\\Delta F}_N) \\approx \\sqrt{\\frac{\\exp(\\beta^2\\sigma^2) - 1}{N\\beta^2}} = \\frac{\\sqrt{\\exp(\\beta^2\\sigma^2) - 1}}{\\beta\\sqrt{N}}\n$$\n\n#### 3. Crooks涨落定理分析\nCrooks定理关联了正向功分布 $P_{\\mathrm{F}}(W)$ 和逆向功分布 $P_{\\mathrm{R}}(W_{\\mathrm{R}})$：\n$$\n\\frac{P_{\\mathrm{F}}(W)}{P_{\\mathrm{R}}(-W)} = \\exp(\\beta (W - \\Delta F))\n$$\n给定 $P_{\\mathrm{F}}(W) = \\mathcal{N}(W; \\mu_{\\mathrm{F}}, \\sigma^2)$ 和 $P_{\\mathrm{R}}(W_{\\mathrm{R}}) = \\mathcal{N}(W_{\\mathrm{R}}; \\mu_{\\mathrm{R}}, \\sigma^2)$，则 $P_{\\mathrm{R}}(-W) = \\mathcal{N}(-W; \\mu_{\\mathrm{R}}, \\sigma^2) = \\mathcal{N}(W; -\\mu_{\\mathrm{R}}, \\sigma^2)$。PDF的比值为：\n$$\n\\frac{\\exp\\left(-\\frac{(W-\\mu_{\\mathrm{F}})^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(W-(-\\mu_{\\mathrm{R}}))^2}{2\\sigma^2}\\right)} = \\exp\\left( \\frac{(W+\\mu_{\\mathrm{R}})^2 - (W-\\mu_{\\mathrm{F}})^2}{2\\sigma^2} \\right) = \\exp\\left( \\frac{2W(\\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}}) + \\mu_{\\mathrm{R}}^2 - \\mu_{\\mathrm{F}}^2}{2\\sigma^2} \\right)\n$$\n将此表达式的对数与 $\\beta W - \\beta\\Delta F$ 相等：\n$$\n\\frac{\\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}}}{\\sigma^2}W + \\frac{\\mu_{\\mathrm{R}}^2 - \\mu_{\\mathrm{F}}^2}{2\\sigma^2} = \\beta W - \\beta\\Delta F\n$$\n为了使此恒等式对所有 $W$ 成立，$W$ 的系数和常数项必须相等。\n1.  从 $W$ 的系数：$\\frac{\\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}}}{\\sigma^2} = \\beta \\implies \\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}} = \\beta\\sigma^2$。这是两个高斯功分布能通过Crooks定理关联起来的必要条件。\n2.  从常数项：$\\frac{\\mu_{\\mathrm{R}}^2 - \\mu_{\\mathrm{F}}^2}{2\\sigma^2} = -\\beta\\Delta F \\implies \\Delta F = \\frac{\\mu_{\\mathrm{F}}^2 - \\mu_{\\mathrm{R}}^2}{2\\beta\\sigma^2}$。\n\n为证明一致性，我们假设条件 $\\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}} = \\beta\\sigma^2$ 成立。我们可以重写 $\\Delta F$ 的表达式：\n$$\n\\Delta F = \\frac{(\\mu_{\\mathrm{F}} - \\mu_{\\mathrm{R}})(\\mu_{\\mathrm{F}} + \\mu_{\\mathrm{R}})}{2\\beta\\sigma^2} = \\frac{(\\mu_{\\mathrm{F}} - \\mu_{\\mathrm{R}})(\\beta\\sigma^2)}{2\\beta\\sigma^2} = \\frac{\\mu_{\\mathrm{F}} - \\mu_{\\mathrm{R}}}{2}\n$$\n将 $\\mu_{\\mathrm{R}} = \\beta\\sigma^2 - \\mu_{\\mathrm{F}}$ 代入这个简化形式得到：\n$$\n\\Delta F = \\frac{\\mu_{\\mathrm{F}} - (\\beta\\sigma^2 - \\mu_{\\mathrm{F}})}{2} = \\frac{2\\mu_{\\mathrm{F}} - \\beta\\sigma^2}{2} = \\mu_{\\mathrm{F}} - \\frac{\\beta\\sigma^2}{2}\n$$\n这正是从Jarzynski等式中得到的 $\\Delta F$ 的表达式，证实了这两个框架的一致性。\n\n对于情况4，问题定义了 $\\mu_{\\mathrm{R}} = \\mu_{\\mathrm{F}} - \\beta\\sigma^2$。这个定义通常不满足条件 $\\mu_{\\mathrm{F}}+\\mu_{\\mathrm{R}} = \\beta\\sigma^2$。因此，这组参数可能代表一个物理上不一致的情景。然而，问题要求比较Jarzynski公式和从Crooks推导出的公式 $\\Delta F = (\\mu_{\\mathrm{F}}^2 - \\mu_{\\mathrm{R}}^2)/(2\\beta\\sigma^2)$ 的数值结果。如推导所示，如果 $\\mu_{\\mathrm{R}}$ 定义为 $\\mu_{\\mathrm{F}} - \\beta\\sigma^2$，这两个公式在代数上是恒等的，因此结果必然一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes quantities related to non-equilibrium work theorems\n    for a series of test cases.\n    \"\"\"\n    \n    # Test suite defined in the problem statement.\n    # Cases 1-3: (beta, mu, sigma, N) for Jarzynski estimator analysis.\n    # Case 4: (beta, mu_F, sigma, mu_R_def) for Crooks consistency check.\n    # mu_R_def is a lambda function to define mu_R based on forward parameters.\n    test_cases = [\n        (1.0, 5.0, 2.0, 1000),      # Case 1\n        (1.0, 3.0, 0.01, 50),       # Case 2\n        (1.0, 0.0, 3.0, 100),       # Case 3\n    ]\n    \n    case4_params = {\n        \"beta\": 1.0, \n        \"mu_F\": 2.0, \n        \"sigma\": 1.5,\n        \"mu_R_def\": lambda beta, mu_F, sigma: mu_F - beta * sigma**2\n    }\n\n    results = []\n\n    # Process cases 1-3 for Jarzynski estimator properties\n    for beta, mu, sigma, N in test_cases:\n        # 1. True Delta F from the forward Gaussian model\n        # Formula: Delta_F = mu - (beta * sigma^2) / 2\n        delta_F = mu - (beta * sigma**2) / 2.0\n        \n        # 2. Leading-order asymptotic bias of the Jarzynski estimator\n        # Formula: Bias = (exp(beta^2 * sigma^2) - 1) / (2 * N * beta)\n        # Using np.expm1 for better precision when the argument is small\n        exp_arg = beta**2 * sigma**2\n        bias = np.expm1(exp_arg) / (2.0 * N * beta)\n        \n        # 3. Leading-order asymptotic standard deviation\n        # Formula: StdDev = sqrt(exp(beta^2 * sigma^2) - 1) / (beta * sqrt(N))\n        std_dev = np.sqrt(np.expm1(exp_arg)) / (beta * np.sqrt(N))\n        \n        results.extend([delta_F, bias, std_dev])\n\n    # Process case 4 for Crooks consistency check\n    beta = case4_params[\"beta\"]\n    mu_F = case4_params[\"mu_F\"]\n    sigma = case4_params[\"sigma\"]\n    \n    # Define mu_R as per the problem statement for this specific case\n    mu_R = case4_params[\"mu_R_def\"](beta, mu_F, sigma)\n    \n    # Calculate Delta F from the forward-only Jarzynski model\n    # Formula: Delta_F_J = mu_F - (beta * sigma^2) / 2\n    delta_F_Jarzynski = mu_F - (beta * sigma**2) / 2.0\n    \n    # Calculate Delta F from the forward-reverse relation (Crooks)\n    # Formula: Delta_F_C = (mu_F^2 - mu_R^2) / (2 * beta * sigma^2)\n    numerator = mu_F**2 - mu_R**2\n    denominator = 2.0 * beta * sigma**2\n    delta_F_Crooks = numerator / denominator\n    \n    # Check for agreement within the specified tolerance\n    tolerance = 1e-12\n    crooks_agreement = np.abs(delta_F_Jarzynski - delta_F_Crooks)  tolerance\n    \n    results.append(crooks_agreement)\n\n    # Format and print the final output\n    formatted_results = []\n    for item in results:\n        if isinstance(item, bool):\n            formatted_results.append(str(item).lower())\n        else:\n            formatted_results.append(f\"{item:.12g}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solution\nsolve()\n\n```"
        }
    ]
}