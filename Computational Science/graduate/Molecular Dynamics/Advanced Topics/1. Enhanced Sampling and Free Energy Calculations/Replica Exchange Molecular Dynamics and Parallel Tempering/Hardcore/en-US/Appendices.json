{
    "hands_on_practices": [
        {
            "introduction": "The practical success of any Replica Exchange Molecular Dynamics simulation hinges on the careful design of its temperature ladder. To ensure configurations can efficiently travel between the lowest and highest temperatures, there must be sufficient overlap in the energy distributions of neighboring replicas. This practice challenges you to design a temperature schedule that maintains a constant, optimal exchange acceptance probability across the entire ladder, linking a key thermodynamic property—the heat capacity $C_V$—to the algorithmic parameters of the simulation (). Mastering this calculation is a fundamental first step in setting up an effective REMD study.",
            "id": "3442135",
            "problem": "A classical molecular system is to be simulated with Replica Exchange Molecular Dynamics (REMD), also known as parallel tempering, between a minimum temperature of $300$ K and a maximum temperature of $600$ K. The intent is to design a geometric temperature ladder so that the expected acceptance probability of exchanging configurations between any pair of neighboring replicas is constant and equal to a specified target.\n\nAssume the following fundamental bases and modeling assumptions:\n- The canonical ensemble at inverse temperature $\\beta$ assigns probability density $P_{\\beta}(E) \\propto g(E)\\exp(-\\beta E)$ to energy $E$, where $g(E)$ is the density of states and $\\beta = 1/(k_{B}T)$ with $k_{B}$ the Boltzmann constant.\n- In the canonical ensemble, the energy variance satisfies $\\sigma^{2}(T) = \\langle (E - \\langle E \\rangle)^{2} \\rangle_{T} = k_{B}T^{2}C_{V}(T)$, and the mean energy satisfies $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}T = C_{V}(T)$, where $C_{V}(T)$ is the heat capacity at constant volume.\n- Over the temperature range of interest, the heat capacity is constant and equal to $C_{V} = 60\\,k_{B}$, and the energy distribution at each temperature is well-approximated by a Gaussian with the above mean and variance.\n- The REMD swap between neighboring replicas at inverse temperatures $\\beta$ and $\\beta'$ uses the Metropolis acceptance rule consistent with detailed balance: an attempted swap of configurations with energies $E$ and $E'$ is accepted with probability $a = \\min\\{1, \\exp[(\\beta - \\beta')(E' - E)]\\}$.\n- The temperature ladder is geometric, i.e., adjacent temperatures satisfy $T' = r\\,T$ for a constant ratio $r  1$ across the ladder.\n\nLet the target nearest-neighbor exchange acceptance probability be $p^{\\star} = 0.3$. Starting from the canonical ensemble definitions and the Metropolis acceptance rule, use the Gaussian approximation for the energy distributions and the constancy of $C_{V}$ to derive an analytical expression for the required geometric ratio $r$ as a function of $p^{\\star}$ and $C_{V}$. Then determine the minimal integer number of replicas $N$ needed so that a geometric ladder with this ratio spans from $300$ K to $600$ K inclusive, i.e., $T_{\\min} = 300$ K and $T_{\\max} = 600$ K lie at the ends of the ladder.\n\nGive your final answer as the minimal integer $N$ with no units. No rounding instruction is needed beyond the fact that $N$ must be an integer.",
            "solution": "The user wants to find the minimal number of replicas for a Replica Exchange Molecular Dynamics (REMD) simulation.\n\n### Step 1: Extract Givens\n- Minimum temperature: $T_{\\min} = 300\\,\\text{K}$\n- Maximum temperature: $T_{\\max} = 600\\,\\text{K}$\n- Heat capacity at constant volume: $C_V = 60\\,k_B$ (constant over the temperature range)\n- Probability density in the canonical ensemble: $P_{\\beta}(E) \\propto g(E)\\exp(-\\beta E)$, with $\\beta = 1/(k_B T)$\n- Energy variance: $\\sigma^{2}(T) = k_{B}T^{2}C_{V}(T)$\n- Mean energy relation: $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}T = C_{V}(T)$\n- Energy distributions are approximated by Gaussians.\n- Metropolis acceptance probability for a swap between configurations with energies $E$ and $E'$ at inverse temperatures $\\beta$ and $\\beta'$: $a = \\min\\{1, \\exp[(\\beta - \\beta')(E' - E)]\\}$\n- Temperature ladder is geometric: $T' = r\\,T$ for a constant ratio $r  1$.\n- Target nearest-neighbor exchange acceptance probability: $p^{\\star} = 0.3$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined and scientifically grounded in the principles of statistical mechanics and computational physics, specifically the theory behind the REMD method. All necessary physical quantities, constants, and modeling assumptions (Gaussian energy distributions, constant $C_V$) are explicitly provided. The problem is self-contained, objective, and does not contain any scientific or logical contradictions. The question is well-posed and leads to a unique, meaningful solution. The problem is valid.\n\n### Step 3: Proceed to Solution\n\nThe problem requires a two-part solution: first, to derive an analytical expression for the geometric ratio $r$, and second, to calculate the minimum integer number of replicas $N$.\n\n#### Derivation of the Geometric Ratio $r$\n\nThe Metropolis acceptance probability for exchanging configurations between two adjacent replicas at temperatures $T_i$ and $T_{i+1}$ (with corresponding inverse temperatures $\\beta_i  \\beta_{i+1}$) is given by:\n$$a = \\min\\{1, \\exp[(\\beta_i - \\beta_{i+1})(E_i - E_{i+1})]\\}$$\nHere, $E_i$ is the energy of the configuration currently at temperature $T_i$ and $E_{i+1}$ is the energy of the configuration currently at temperature $T_{i+1}$. Before the exchange attempt, the system is in equilibrium, so $E_i$ is a random variable drawn from the canonical distribution $P_{\\beta_i}(E)$, and $E_{i+1}$ is drawn from $P_{\\beta_{i+1}}(E)$.\n\nLet $Y = (\\beta_i - \\beta_{i+1})(E_i - E_{i+1})$. The expected acceptance probability $p^{\\star}$ is the average of $a$ over the distributions of $E_i$ and $E_{i+1}$:\n$$p^{\\star} = \\langle \\min\\{1, \\exp(Y)\\} \\rangle$$\nThe problem states that the energy distributions are Gaussian. Since $E_i$ and $E_{i+1}$ are independent random variables, their difference is also a Gaussian random variable. Consequently, $Y$ is a Gaussian random variable. Let its mean be $\\mu_Y$ and its variance be $\\sigma_Y^2$.\n\nA standard result for a Gaussian variable $Y \\sim \\mathcal{N}(\\mu_Y, \\sigma_Y^2)$ is that if the approximation $\\mu_Y \\approx -\\sigma_Y^2/2$ holds, the expected acceptance probability simplifies to:\n$$p^{\\star} = 2 \\Phi_Z\\left(-\\frac{\\sigma_Y}{2}\\right)$$\nwhere $\\Phi_Z$ is the cumulative distribution function (CDF) of the standard normal distribution. This approximation is valid for small differences between adjacent temperatures, which is the typical condition for efficient REMD.\n\nLet's verify the condition $\\mu_Y \\approx -\\sigma_Y^2/2$. Let $\\Delta\\beta = \\beta_i - \\beta_{i+1}$.\nThe mean of $Y$ is $\\mu_Y = \\Delta\\beta (\\langle E_i \\rangle - \\langle E_{i+1} \\rangle)$.\nUsing the fundamental relation $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}\\beta = -\\sigma^2(T)$, we can approximate the difference in mean energies:\n$$\\langle E_{i+1} \\rangle - \\langle E_i \\rangle \\approx \\frac{\\mathrm{d}\\langle E \\rangle}{\\mathrm{d}\\beta} (\\beta_{i+1} - \\beta_i) = -\\sigma^2(T_i)(-\\Delta\\beta) = \\sigma^2(T_i)\\Delta\\beta$$\nSo, $\\mu_Y \\approx \\Delta\\beta (-\\sigma^2(T_i)\\Delta\\beta) = -(\\Delta\\beta)^2 \\sigma^2(T_i)$.\nThe variance of $Y$ is $\\sigma_Y^2 = (\\Delta\\beta)^2 \\text{Var}(E_i - E_{i+1}) = (\\Delta\\beta)^2 (\\text{Var}(E_i) + \\text{Var}(E_{i+1}))$.\n$$\\sigma_Y^2 = (\\Delta\\beta)^2 (\\sigma^2(T_i) + \\sigma^2(T_{i+1}))$$\nFor small temperature differences, $\\sigma^2(T_{i+1}) \\approx \\sigma^2(T_i)$, so $\\sigma_Y^2 \\approx (\\Delta\\beta)^2 (2\\sigma^2(T_i))$.\nComparing the expressions, we see that indeed $\\mu_Y \\approx -\\sigma_Y^2/2$.\n\nThe relationship $p^{\\star} = 2 \\Phi_Z(-\\sigma_Y/2)$ can be inverted to find $\\sigma_Y$:\n$$ \\Phi_Z\\left(-\\frac{\\sigma_Y}{2}\\right) = \\frac{p^{\\star}}{2} \\implies -\\frac{\\sigma_Y}{2} = \\Phi_Z^{-1}\\left(\\frac{p^{\\star}}{2}\\right) $$\n$$ \\sigma_Y = -2 \\Phi_Z^{-1}\\left(\\frac{p^{\\star}}{2}\\right) $$\nLet $K = -2 \\Phi_Z^{-1}(p^{\\star}/2)$. Then $\\sigma_Y^2 = K^2$.\n\nNow, we express $\\sigma_Y^2$ in terms of the geometric ratio $r$ and the heat capacity $C_V$.\nThe temperatures are related by $T_{i+1} = r T_i$. The inverse temperatures are $\\beta_i = 1/(k_B T_i)$ and $\\beta_{i+1} = 1/(k_B T_{i+1}) = \\beta_i/r$.\nThe energy variance at a temperature $T$ is $\\sigma^2(T) = k_B T^2 C_V$.\n$$ \\sigma_Y^2 = \\left(\\beta_i - \\frac{\\beta_i}{r}\\right)^2 (\\sigma^2(T_i) + \\sigma^2(rT_i)) $$\n$$ \\sigma_Y^2 = \\beta_i^2 \\left(1 - \\frac{1}{r}\\right)^2 (k_B T_i^2 C_V + k_B (rT_i)^2 C_V) $$\nSubstituting $\\beta_i = 1/(k_B T_i)$:\n$$ \\sigma_Y^2 = \\frac{1}{k_B^2 T_i^2} \\left(\\frac{r-1}{r}\\right)^2 (k_B C_V T_i^2 (1+r^2)) $$\n$$ \\sigma_Y^2 = \\frac{C_V}{k_B} \\frac{(r-1)^2}{r^2} (1+r^2) $$\nLet $C_V' = C_V/k_B$. The condition for the desired acceptance probability is:\n$$ K^2 = C_V' \\frac{(r-1)^2(1+r^2)}{r^2} $$\nThis is a quartic equation for $r$. We can rearrange and solve it.\n$$ \\left(\\frac{K^2}{C_V'}\\right)r^2 = (r^2-2r+1)(r^2+1) = r^4 - 2r^3 + 2r^2 - 2r + 1 $$\n$$ r^4 - 2r^3 + \\left(2 - \\frac{K^2}{C_V'}\\right)r^2 - 2r + 1 = 0 $$\nThis is a reciprocal equation. Dividing by $r^2$ (since $r\\neq0$):\n$$ \\left(r^2 + \\frac{1}{r^2}\\right) - 2\\left(r + \\frac{1}{r}\\right) + \\left(2 - \\frac{K^2}{C_V'}\\right) = 0 $$\nLet $y = r + 1/r$. Then $r^2 + 1/r^2 = y^2 - 2$. The equation becomes a quadratic in $y$:\n$$ (y^2 - 2) - 2y + \\left(2 - \\frac{K^2}{C_V'}\\right) = 0 \\implies y^2 - 2y - \\frac{K^2}{C_V'} = 0$$\nSolving for $y$:\n$$ y = \\frac{2 \\pm \\sqrt{4 - 4(-K^2/C_V')}}{2} = 1 \\pm \\sqrt{1 + \\frac{K^2}{C_V'}} $$\nSince $r1$, we must have $y = r+1/r  2$. We thus take the positive root:\n$$ y = 1 + \\sqrt{1 + \\frac{K^2}{C_V/k_B}} $$\nNow we solve $r + 1/r = y$, which is $r^2 - yr + 1 = 0$.\n$$ r = \\frac{y \\pm \\sqrt{y^2-4}}{2} $$\nSince we require $r1$, we must choose the positive sign. The final analytical expression for $r$ is:\n$$ r = \\frac{y + \\sqrt{y^2-4}}{2} \\quad \\text{where} \\quad y = 1 + \\sqrt{1 + \\frac{4\\left(\\Phi_Z^{-1}(p^{\\star}/2)\\right)^2}{C_V/k_B}} $$\n\n#### Calculation of the Number of Replicas $N$\n\nWe are given $C_V = 60 k_B$, so $C_V' = C_V/k_B = 60$. The target acceptance probability is $p^{\\star} = 0.3$.\nFirst, we find the value of $\\Phi_Z^{-1}(p^{\\star}/2) = \\Phi_Z^{-1}(0.15)$. Using standard statistical tables or a calculator, $\\Phi_Z^{-1}(0.15) \\approx -1.03643$.\nThen, $K = -2 \\Phi_Z^{-1}(0.15) \\approx -2(-1.03643) = 2.07286$.\nSo, $K^2 \\approx 4.2967$.\n\nNow we calculate $y$:\n$$ y = 1 + \\sqrt{1 + \\frac{4.2967}{60}} = 1 + \\sqrt{1 + 0.07161} = 1 + \\sqrt{1.07161} \\approx 1 + 1.03519 = 2.03519 $$\nNext, we calculate $r$:\n$$ r = \\frac{2.03519 + \\sqrt{(2.03519)^2 - 4}}{2} = \\frac{2.03519 + \\sqrt{4.14199 - 4}}{2} = \\frac{2.03519 + \\sqrt{0.14199}}{2} $$\n$$ r \\approx \\frac{2.03519 + 0.37682}{2} = \\frac{2.41201}{2} \\approx 1.2060 $$\nThe temperature ladder must span from $T_{\\min} = 300\\,\\text{K}$ to $T_{\\max} = 600\\,\\text{K}$. Let there be $N$ replicas, indexed from $0$ to $N-1$. Then $T_0 = T_{\\min}$ and $T_{i} = T_0 r^i$. The highest temperature must be at least $T_{\\max}$:\n$$ T_{N-1} = T_0 r^{N-1} \\ge T_{\\max} $$\n$$ r^{N-1} \\ge \\frac{T_{\\max}}{T_{\\min}} = \\frac{600}{300} = 2 $$\nTaking the natural logarithm of both sides:\n$$ (N-1)\\ln(r) \\ge \\ln(2) $$\n$$ N-1 \\ge \\frac{\\ln(2)}{\\ln(r)} $$\n$$ N \\ge 1 + \\frac{\\ln(2)}{\\ln(r)} $$\nUsing our calculated value for $r$:\n$$ N \\ge 1 + \\frac{\\ln(2)}{\\ln(1.2060)} \\approx 1 + \\frac{0.69315}{0.18727} \\approx 1 + 3.7013 = 4.7013 $$\nSince the number of replicas $N$ must be an integer, the minimal integer value for $N$ is the smallest integer greater than or equal to $4.7013$, which is $5$.\nA ladder with $N=5$ replicas and ratio $r \\approx 1.2060$ starting at $T_0=300\\,\\text{K}$ would have temperatures $300.0, 361.8, 436.4, 526.4, 634.8$ K, which spans the required range.",
            "answer": "$$\\boxed{5}$$"
        },
        {
            "introduction": "Once a REMD simulation is running, how do we measure its efficiency? A key metric is the 'mixing time,' or how long it takes for a replica to traverse the entire temperature ladder, which is essential for overcoming energy barriers. In this exercise, you will model the movement of a replica through the temperature landscape as a one-dimensional random walk (). By deriving and calculating the expected round-trip time, you will develop a quantitative tool to analyze simulation performance and diagnose potential bottlenecks in sampling.",
            "id": "3442032",
            "problem": "Consider a Replica Exchange Molecular Dynamics (REMD) simulation of a biomolecular system performing Parallel Tempering across a ladder of $M$ temperatures $\\{T_{1}  T_{2}  \\dots  T_{M}\\}$ with inverse temperatures $\\{\\beta_{1}  \\beta_{2}  \\dots  \\beta_{M}\\}$, where $\\beta_{i} = 1/(k_{B} T_{i})$ and $k_{B}$ is the Boltzmann constant. Exchanges are attempted between neighboring temperatures following the standard replica exchange Metropolis criterion: an exchange between replicas at $(\\beta_{i}, \\beta_{i+1})$ holding instantaneous potential energies $(E_{i}, E_{i+1})$ is accepted with probability $A_{i} = \\min\\left(1, \\exp\\left((\\beta_{i} - \\beta_{i+1})(E_{i+1} - E_{i})\\right)\\right)$. Assume the system has reached equilibrium and that, due to detailed balance under symmetric proposals, the average acceptance probability across edge $i$ (between temperatures $T_{i}$ and $T_{i+1}$) is equal in both directions; denote this average by $a_{i}$.\n\nAt each exchange attempt, the simulation alternates between proposing swaps for all odd-even neighboring pairs and all even-odd neighboring pairs. For the purpose of modeling movement of a single tagged replica through temperature index space, this scheduling can be represented as a discrete-time birth-death Markov chain on states $i \\in \\{1, 2, \\dots, M\\}$, where a move across edge $i$ (in either direction) is proposed with probability $1/2$ and accepted with probability $a_{i}$. Hence, the probability to move from state $i$ to $i+1$ in one exchange attempt is $u_{i} = \\frac{1}{2} a_{i}$, and the probability to move from state $i$ to $i-1$ is $d_{i} = \\frac{1}{2} a_{i-1}$, with $d_{1} = 0$ and $u_{M} = 0$. The remaining probability corresponds to staying at the current state.\n\nYou are given $M = 8$ and the set of neighbor acceptances\n$$\na_{1} = 0.30,\\quad a_{2} = 0.25,\\quad a_{3} = 0.20,\\quad a_{4} = 0.15,\\quad a_{5} = 0.20,\\quad a_{6} = 0.25,\\quad a_{7} = 0.30.\n$$\nThe exchange attempt period is $\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$, i.e., one discrete-time step in the Markov chain corresponds to $2.0\\,\\mathrm{ps}$ of simulation time.\n\nStarting from first principles of detailed balance and Markov chain dynamics, derive an analytical expression for the expected round-trip time (from $T_{1}$ up to $T_{8}$ and back down to $T_{1}$) in units of discrete exchange attempts, and then compute its value in physical time. Express the final answer in nanoseconds and round your answer to four significant figures.",
            "solution": "The user wants me to solve a problem related to Replica Exchange Molecular Dynamics (REMD).\n\n### Step 1: Extract Givens\n-   A Replica Exchange Molecular Dynamics (REMD) simulation with Parallel Tempering.\n-   Number of temperatures (replicas): $M = 8$.\n-   Temperature ladder: $\\{T_{1}  T_{2}  \\dots  T_{M}\\}$ with inverse temperatures $\\{\\beta_{1}  \\beta_{2}  \\dots  \\beta_{M}\\}$, where $\\beta_{i} = 1/(k_{B} T_{i})$.\n-   Exchange acceptance probability between replicas at $(\\beta_{i}, \\beta_{i+1})$ with energies $(E_{i}, E_{i+1})$: $A_{i} = \\min\\left(1, \\exp\\left((\\beta_{i} - \\beta_{i+1})(E_{i+1} - E_{i})\\right)\\right)$.\n-   Average acceptance probability for neighbor exchanges between $T_i$ and $T_{i+1}$ is $a_i$.\n-   Replica movement is modeled as a discrete-time birth-death Markov chain on states $i \\in \\{1, 2, \\dots, M\\}$.\n-   Probability to move from state $i$ to $i+1$: $u_{i} = \\frac{1}{2} a_{i}$, with $u_{M} = 0$.\n-   Probability to move from state $i$ to $i-1$: $d_{i} = \\frac{1}{2} a_{i-1}$, with $d_{1} = 0$.\n-   Given acceptance probabilities: $a_{1} = 0.30$, $a_{2} = 0.25$, $a_{3} = 0.20$, $a_{4} = 0.15$, $a_{5} = 0.20$, $a_{6} = 0.25$, $a_{7} = 0.30$.\n-   Exchange attempt period: $\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$.\n-   The task is to derive an analytical expression for the expected round-trip time ($T_1 \\to T_8 \\to T_1$) and compute its value in nanoseconds, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is grounded in the well-established statistical mechanics methodology of Replica Exchange Molecular Dynamics (REMD) or Parallel Tempering. The Metropolis acceptance criterion is correctly stated. Modeling replica diffusion as a 1D birth-death process is a standard and valid simplification used in the analysis of REMD simulations.\n2.  **Well-Posed**: The problem is well-posed. It provides a clearly defined Markov chain model and asks for a computable quantity, the mean first passage time for a round trip. All necessary parameters ($M$, $a_i$, $\\tau_{\\mathrm{ex}}$) are provided. A unique, stable, and meaningful solution exists.\n3.  **Objective**: The problem is stated in precise, objective language. There are no subjective or opinion-based statements.\n4.  **No other flaws**: The problem is self-contained, not contradictory, and the data are consistent. It is a formalizable problem directly relevant to its stated topic. It is not trivial, as it requires derivation of mean first passage times for a specific birth-death process.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. The solution process will now proceed.\n\n### Derivation and Solution\n\nThe problem asks for the expected round-trip time for a replica starting at the lowest temperature $T_1$ (state $i=1$), traveling to the highest temperature $T_M$ (state $i=M=8$), and returning to $T_1$. This time, $\\tau_{RT}$, is the sum of two mean first passage times (MFPT):\n1.  The MFPT from state $1$ to state $M$, denoted $\\tau_{1 \\to M}$.\n2.  The MFPT from state $M$ to state $1$, denoted $\\tau_{M \\to 1}$.\n\nSo, $\\tau_{RT} = \\tau_{1 \\to M} + \\tau_{M \\to 1}$. We will derive expressions for these two quantities in terms of discrete exchange attempts.\n\nThe replica's movement is described by a discrete-time birth-death Markov chain on the states $\\{1, 2, \\dots, M\\}$. The transition probabilities are given as:\n-   $u_i = P(i \\to i+1) = \\frac{1}{2} a_i$ for $i \\in \\{1, \\dots, M-1\\}$.\n-   $d_i = P(i \\to i-1) = \\frac{1}{2} a_{i-1}$ for $i \\in \\{2, \\dots, M\\}$.\n-   $r_i = P(i \\to i) = 1 - u_i - d_i$.\nThe boundary conditions are $d_1 = 0$ and $u_M = 0$, which correspond to reflecting boundaries.\n\nA key property of this model is the relationship between the up-transition probability from state $i$ and the down-transition probability from state $i+1$:\n$u_i = \\frac{1}{2} a_i$\n$d_{i+1} = \\frac{1}{2} a_i$\nTherefore, $u_i = d_{i+1}$ for $i \\in \\{1, \\dots, M-1\\}$. This simplifies the analysis considerably.\n\n**1. Calculation of $\\tau_{1 \\to M}$**\nLet $k_i$ be the expected number of steps (MFPT) to reach state $M$ for the first time, starting from state $i$. We are interested in $k_1$. The target state $M$ is treated as an absorbing state for this calculation, so $k_M = 0$.\nFor any state $i \\in \\{1, \\dots, M-1\\}$, the expected time is given by the one-step recurrence relation:\n$$ k_i = 1 + u_i k_{i+1} + d_i k_{i-1} + (1 - u_i - d_i)k_i $$\nRearranging this gives:\n$$ u_i(k_i - k_{i+1}) + d_i(k_i - k_{i-1}) = 1 $$\n$$ u_i(k_i - k_{i+1}) - d_i(k_{i-1} - k_i) = 1 $$\nAt the reflecting boundary $i=1$, we have $d_1=0$, so a special relation holds:\n$$ u_1(k_1 - k_2) = 1 \\implies k_1 - k_2 = \\frac{1}{u_1} $$\nFor $i  1$, we can use the general recurrence. Let's establish a pattern. For $i=2$:\n$$ u_2(k_2 - k_3) - d_2(k_1 - k_2) = 1 $$\nUsing $d_2 = u_1$ and $k_1-k_2 = 1/u_1$:\n$$ u_2(k_2 - k_3) - u_1\\left(\\frac{1}{u_1}\\right) = 1 \\implies u_2(k_2 - k_3) = 2 \\implies k_2 - k_3 = \\frac{2}{u_2} $$\nWe can show by induction that $k_i - k_{i+1} = i/u_i$.\nAssume $k_{i-1} - k_i = (i-1)/u_{i-1}$. The recurrence is $u_i(k_i-k_{i+1}) = 1 + d_i(k_{i-1}-k_i)$.\nUsing $d_i = u_{i-1}$ and the hypothesis:\n$$ u_i(k_i - k_{i+1}) = 1 + u_{i-1}\\left(\\frac{i-1}{u_{i-1}}\\right) = 1 + (i-1) = i $$\nThus, $k_i - k_{i+1} = i/u_i$ for $i \\in \\{1, \\dots, M-1\\}$. The induction is successful.\n\nTo find $k_1$, we use a telescoping sum:\n$$ k_1 - k_M = \\sum_{i=1}^{M-1} (k_i - k_{i+1}) $$\nSince $k_M=0$, we get the expression for $\\tau_{1 \\to M}$:\n$$ \\tau_{1 \\to M} = k_1 = \\sum_{i=1}^{M-1} (k_i - k_{i+1}) = \\sum_{i=1}^{M-1} \\frac{i}{u_i} $$\n\n**2. Calculation of $\\tau_{M \\to 1}$**\nLet $g_i$ be the MFPT to reach state $1$ for the first time, starting from state $i$. We want to find $g_M$. State $1$ is now the absorbing state, so $g_1 = 0$. The recurrence relation is the same, but the boundary conditions are different.\n$$ u_i(g_i - g_{i+1}) - d_i(g_{i-1} - g_i) = 1 $$\nAt the reflecting boundary $i=M$, we have $u_M=0$:\n$$ -d_M(g_{M-1} - g_M) = 1 \\implies g_M - g_{M-1} = \\frac{1}{d_M} $$\nFor $i=M-1$:\n$$ u_{M-1}(g_{M-1} - g_M) - d_{M-1}(g_{M-2} - g_{M-1}) = 1 $$\nUsing $g_M-g_{M-1} = 1/d_M$ and $u_{M-1}=d_M$:\n$$ d_M\\left(-\\frac{1}{d_M}\\right) - d_{M-1}(g_{M-2} - g_{M-1}) = 1 \\implies -1 + d_{M-1}(g_{M-1} - g_{M-2}) = 1 $$\n$$ d_{M-1}(g_{M-1} - g_{M-2}) = 2 \\implies g_{M-1} - g_{M-2} = \\frac{2}{d_{M-1}} $$\nWe can show by induction that $g_{i+1} - g_i = (M-i)/d_{i+1}$.\nThis holds for $i=M-1$ ($g_M-g_{M-1} = (M-(M-1))/d_M = 1/d_M$) and for $i=M-2$ ($g_{M-1}-g_{M-2}=(M-(M-2))/d_{M-1}=2/d_{M-1}$). The general proof is analogous to the one for $k_i$.\n\nTo find $g_M$, we use a telescoping sum:\n$$ g_M - g_1 = \\sum_{i=1}^{M-1} (g_{i+1} - g_i) $$\nSince $g_1=0$, we get the expression for $\\tau_{M \\to 1}$:\n$$ \\tau_{M \\to 1} = g_M = \\sum_{i=1}^{M-1} (g_{i+1} - g_i) = \\sum_{i=1}^{M-1} \\frac{M-i}{d_{i+1}} $$\n\n**3. Total Round-Trip Time $\\tau_{RT}$**\nThe total expected round-trip time in units of exchange attempts is:\n$$ \\tau_{RT\\_steps} = \\tau_{1 \\to M} + \\tau_{M \\to 1} = \\sum_{i=1}^{M-1} \\frac{i}{u_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{d_{i+1}} $$\nUsing the identities $u_i = \\frac{1}{2} a_i$ and $d_{i+1} = \\frac{1}{2} a_i$:\n$$ \\tau_{RT\\_steps} = \\sum_{i=1}^{M-1} \\frac{i}{(1/2)a_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{(1/2)a_i} = 2 \\left( \\sum_{i=1}^{M-1} \\frac{i}{a_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{a_i} \\right) $$\nCombining the sums:\n$$ \\tau_{RT\\_steps} = 2 \\sum_{i=1}^{M-1} \\left( \\frac{i + M - i}{a_i} \\right) = 2 \\sum_{i=1}^{M-1} \\frac{M}{a_i} $$\nThis yields the final analytical expression for the expected number of steps:\n$$ \\tau_{RT\\_steps} = 2M \\sum_{i=1}^{M-1} \\frac{1}{a_i} $$\n\n**4. Numerical Calculation**\nWe are given $M=8$ and the acceptance probabilities $a_1, \\dots, a_7$.\nFirst, we compute the sum:\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{1}{a_1} + \\frac{1}{a_2} + \\frac{1}{a_3} + \\frac{1}{a_4} + \\frac{1}{a_5} + \\frac{1}{a_6} + \\frac{1}{a_7} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{1}{0.30} + \\frac{1}{0.25} + \\frac{1}{0.20} + \\frac{1}{0.15} + \\frac{1}{0.20} + \\frac{1}{0.25} + \\frac{1}{0.30} $$\nUsing fractions to maintain precision:\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{10}{3} + 4 + 5 + \\frac{100}{15} + 5 + 4 + \\frac{10}{3} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{10}{3} + 4 + 5 + \\frac{20}{3} + 5 + 4 + \\frac{10}{3} = 2 \\left(\\frac{10}{3} + 4 + 5\\right) + \\frac{20}{3} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = 2 \\left(\\frac{10}{3} + \\frac{12}{3} + \\frac{15}{3}\\right) + \\frac{20}{3} = 2 \\left(\\frac{37}{3}\\right) + \\frac{20}{3} = \\frac{74}{3} + \\frac{20}{3} = \\frac{94}{3} $$\nNow, we calculate the total number of steps:\n$$ \\tau_{RT\\_steps} = 2M \\sum_{i=1}^{M-1} \\frac{1}{a_i} = 2(8) \\left(\\frac{94}{3}\\right) = 16 \\times \\frac{94}{3} = \\frac{1504}{3} $$\nThis is approximately $501.333...$ exchange attempts.\n\n**5. Conversion to Physical Time**\nThe duration of one exchange attempt is $\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$. The total physical time for the round trip is:\n$$ \\tau_{RT} = \\tau_{RT\\_steps} \\times \\tau_{\\mathrm{ex}} = \\frac{1504}{3} \\times 2.0\\,\\mathrm{ps} = \\frac{3008}{3}\\,\\mathrm{ps} $$\n$\\tau_{RT} \\approx 1002.666...\\,\\mathrm{ps}$.\nThe question asks for the answer in nanoseconds (ns), where $1\\,\\mathrm{ns} = 1000\\,\\mathrm{ps}$.\n$$ \\tau_{RT} = \\frac{1002.666...}{1000}\\,\\mathrm{ns} = 1.002666...\\,\\mathrm{ns} $$\nRounding to four significant figures, we get $1.003\\,\\mathrm{ns}$.",
            "answer": "$$\n\\boxed{1.003}\n$$"
        },
        {
            "introduction": "The swap attempt is the fundamental move that powers REMD, and its formulation must rigorously satisfy the principle of detailed balance to ensure correct statistical sampling. This exercise probes the subtle but critical details of the exchange mechanism, comparing the consequences of swapping only coordinates versus swapping the entire phase-space state (). By working through the statistical mechanics from first principles, you will clarify why momentum rescaling is sometimes necessary and gain a deeper appreciation for the theoretical integrity of the parallel tempering algorithm.",
            "id": "3442037",
            "problem": "Consider parallel tempering (also called Replica Exchange Molecular Dynamics (REMD)) among $2$ replicas of the same classical system in the constant Number, Volume, and Temperature ($NVT$) ensemble at inverse temperatures $\\beta_i = 1/(k_{\\mathrm{B}} T_i)$ and $\\beta_j = 1/(k_{\\mathrm{B}} T_j)$, where $k_{\\mathrm{B}}$ is the Boltzmann constant and $T_i, T_j$ are temperatures. Each replica evolves under the same separable Hamiltonian $H(q,p) = U(q) + K(p)$ with coordinate vector $q$ and momentum vector $p$, and with a quadratic kinetic energy $K(p) = \\sum_\\alpha p_\\alpha^2/(2 m_\\alpha)$ unless otherwise stated. Between exchange attempts, each replica is thermostatted so that its phase-space marginal is canonical at its assigned temperature. Assume exchange proposals are chosen symmetrically between the two replicas, and that Metropolis-Hastings acceptance with detailed balance with respect to the joint product canonical density is enforced. You are to compare the following exchange concepts at the level of preserving the correct canonical measure and the dependence of the acceptance probability on potential versus kinetic energies:\n- Swapping only coordinates between replicas.\n- Swapping full phase-space states between replicas.\n- Swapping only the temperature labels associated with the replicas.\nFor each concept, reason from first principles starting from the canonical distribution and detailed balance, and determine whether momentum rescaling is required to preserve the canonical measure when seeking an acceptance rule that depends only on potential energies. Select all statements that are correct.\n\nA. In canonical $NVT$ with separable Hamiltonian, proposing to swap only coordinates $q_i \\leftrightarrow q_j$ while leaving momenta $p_i, p_j$ with their original replicas yields a Metropolis-Hastings acceptance that depends only on $U(q)$ and satisfies detailed balance without any momentum rescaling.\n\nB. Exchanging full phase-space states $(q_i,p_i) \\leftrightarrow (q_j,p_j)$ between temperatures and using an acceptance criterion that depends only on $U(q)$ (ignoring $K(p)$) preserves the canonical measure without momentum rescaling for $\\beta_i \\neq \\beta_j$.\n\nC. If one swaps only the temperature labels $\\beta_i \\leftrightarrow \\beta_j$ attached to otherwise unchanged $(q_i,p_i)$ and $(q_j,p_j)$, then to maintain an acceptance rule that depends only on $U(q)$, one must rescale the momenta as $p_i \\leftarrow \\sqrt{\\beta_i/\\beta_j}\\, p_i$ and $p_j \\leftarrow \\sqrt{\\beta_j/\\beta_i}\\, p_j$.\n\nD. When $\\beta_i = \\beta_j$, swapping full phase-space states, swapping only coordinates, or swapping temperature labels are all equivalent with respect to preserving the canonical measure, and any momentum rescaling has no effect on acceptance.\n\nE. If the kinetic energy is non-quadratic and not homogeneous of degree $2$, the linear rescaling $p \\leftarrow \\sqrt{\\beta_i/\\beta_j}\\, p$ still guarantees that the acceptance probability can be made to depend only on $U(q)$.",
            "solution": "The problem asks for an evaluation of several statements concerning different exchange schemes in Replica Exchange Molecular Dynamics (REMD), also known as Parallel Tempering. The analysis will be based on the principles of statistical mechanics, specifically the canonical ensemble and the Metropolis-Hastings algorithm.\n\nThe state of a system of two non-interacting replicas, $i$ and $j$, in the canonical ($NVT$) ensemble is described by the joint probability density function $\\rho_{joint}$. This function is the product of the individual canonical densities:\n$$ \\rho_{joint}(q_i, p_i, q_j, p_j; \\beta_i, \\beta_j) = \\rho(q_i, p_i; \\beta_i) \\rho(q_j, p_j; \\beta_j) $$\nwhere $\\rho(q, p; \\beta) = \\frac{1}{Z(\\beta)} e^{-\\beta H(q,p)}$ is the probability density for a single replica at inverse temperature $\\beta = 1/(k_{\\mathrm{B}}T)$. The Hamiltonian is given as separable, $H(q,p) = U(q) + K(p)$, and the partition function is $Z(\\beta)$. The joint density is therefore:\n$$ \\rho_{joint} \\propto \\exp\\left(-\\beta_i [U(q_i) + K(p_i)] - \\beta_j [U(q_j) + K(p_j)]\\right) $$\nAn exchange move is proposed from an 'old' state to a 'new' state. According to the Metropolis-Hastings algorithm, the acceptance probability $P_{acc}$ must satisfy the detailed balance condition. As the problem states that exchange proposals are chosen symmetrically, the proposal probabilities cancel, and the acceptance probability simplifies to:\n$$ P_{acc}(\\text{old} \\to \\text{new}) = \\min\\left(1, \\frac{\\rho(\\text{new})}{\\rho(\\text{old})}\\right) $$\nLet the old state be defined by replica $i$ having state $(q_i, p_i)$ at $\\beta_i$ and replica $j$ having state $(q_j, p_j)$ at $\\beta_j$. The exponent in the density is $E_{exp, old} = -\\beta_i H(q_i,p_i) - \\beta_j H(q_j,p_j)$. The ratio of densities is then $\\exp(E_{exp, new} - E_{exp, old})$. We will now analyze each proposed scheme.\n\n### Analysis of Option A\nThis scheme proposes swapping only the coordinates, $q_i \\leftrightarrow q_j$, while the momenta $p_i$ and $p_j$ remain with their original replicas (and thus original temperatures).\n- **Old state:** Replica $i$ has $(q_i, p_i)$ at $\\beta_i$; Replica $j$ has $(q_j, p_j)$ at $\\beta_j$.\n- **New state:** Replica $i$ has $(q_j, p_i)$ at $\\beta_i$; Replica $j$ has $(q_i, p_j)$ at $\\beta_j$.\n\nThe exponent of the joint probability density for the new state is:\n$$ E_{exp, new} = -\\beta_i H(q_j, p_i) - \\beta_j H(q_i, p_j) = -\\beta_i [U(q_j) + K(p_i)] - \\beta_j [U(q_i) + K(p_j)] $$\nThe change in the exponent, $\\Delta E_{exp} = E_{exp, new} - E_{exp, old}$, is:\n$$ \\Delta E_{exp} = \\left(-\\beta_i U(q_j) - \\beta_i K(p_i) - \\beta_j U(q_i) - \\beta_j K(p_j)\\right) - \\left(-\\beta_i U(q_i) - \\beta_i K(p_i) - \\beta_j U(q_j) - \\beta_j K(p_j)\\right) $$\n$$ \\Delta E_{exp} = (-\\beta_i U(q_j) - \\beta_j U(q_i)) - (-\\beta_i U(q_i) - \\beta_j U(q_j)) $$\nThe kinetic energy terms $(-\\beta_i K(p_i) - \\beta_j K(p_j))$ cancel out completely. Rearranging the potential energy terms:\n$$ \\Delta E_{exp} = (\\beta_i - \\beta_j)U(q_i) - (\\beta_i - \\beta_j)U(q_j) = (\\beta_i - \\beta_j)(U(q_i) - U(q_j)) $$\nThe acceptance probability is $P_{acc} = \\min(1, \\exp[\\Delta E_{exp}])$. This expression depends only on the potential energies $U(q)$ and the inverse temperatures $\\beta$. No momentum rescaling is needed to achieve this. The move satisfies detailed balance with respect to the joint canonical distribution.\n**Verdict: A is Correct.**\n\n### Analysis of Option B\nThis scheme proposes exchanging the full phase-space states, $(q_i, p_i) \\leftrightarrow (q_j, p_j)$, between the temperatures.\n- **Old state:** Replica $i$ has $(q_i, p_i)$ at $\\beta_i$; Replica $j$ has $(q_j, p_j)$ at $\\beta_j$.\n- **New state:** Replica $i$ has $(q_j, p_j)$ at $\\beta_i$; Replica $j$ has $(q_i, p_i)$ at $\\beta_j$.\n\nThe exponent for the new state is:\n$$ E_{exp, new} = -\\beta_i H(q_j, p_j) - \\beta_j H(q_i, p_i) $$\nThe change in the exponent is:\n$$ \\Delta E_{exp} = \\left(-\\beta_i H(q_j, p_j) - \\beta_j H(q_i, p_i)\\right) - \\left(-\\beta_i H(q_i, p_i) - \\beta_j H(q_j, p_j)\\right) $$\n$$ \\Delta E_{exp} = (\\beta_i - \\beta_j)H(q_i, p_i) - (\\beta_i - \\beta_j)H(q_j, p_j) = (\\beta_i - \\beta_j)(H_i - H_j) $$\n$$ \\Delta E_{exp} = (\\beta_i - \\beta_j)(U_i - U_j) + (\\beta_i - \\beta_j)(K_i - K_j) $$\nThe acceptance probability that satisfies detailed balance is $P_{acc} = \\min(1, \\exp[\\Delta E_{exp}])$, which depends on both potential and kinetic energies. The statement suggests using an acceptance criterion that depends only on $U(q)$, which would be $P'_{acc} = \\min(1, \\exp[(\\beta_i - \\beta_j)(U_i - U_j)])$. Unless $(\\beta_i - \\beta_j)(K_i - K_j) = 0$ for all states (which is not true if $\\beta_i \\neq \\beta_j$), $P'_{acc} \\neq P_{acc}$. Using $P'_{acc}$ would violate detailed balance and thus would not preserve the canonical measure.\n**Verdict: B is Incorrect.**\n\n### Analysis of Option C\nThis scheme discusses swapping temperature labels, $\\beta_i \\leftrightarrow \\beta_j$, which is physically equivalent to the full state swap in B. It proposes that to use an acceptance rule depending only on $U(q)$, one must rescale momenta. This involves a composite move: swapping temperatures and simultaneously transforming the momenta.\nLet the move be from an old state $(q_i, p_i, \\beta_i; q_j, p_j, \\beta_j)$ to a new state $(q_i, p'_i, \\beta_j; q_j, p'_j, \\beta_i)$. The scaling is proposed as $p'_i = p_i \\sqrt{\\beta_i/\\beta_j}$ and $p'_j = p_j \\sqrt{\\beta_j/\\beta_i}$.\nFor this move to satisfy detailed balance with an acceptance probability $P_{acc} = \\min(1, \\exp[(\\beta_i - \\beta_j)(U_i - U_j)])$, the ratio of probability densities $\\rho(\\text{new})/\\rho(\\text{old})$ must equal $\\exp[(\\beta_i - \\beta_j)(U_i - U_j)]$.\nThe ratio is $\\rho(\\text{new})/\\rho(\\text{old}) = \\exp[-\\beta_j H(q_i,p'_i) - \\beta_i H(q_j,p'_j) + \\beta_i H(q_i,p_i) + \\beta_j H(q_j,p_j)]$.\nThe Jacobian of this momentum transformation is $|\\frac{\\partial(p'_i, p'_j)}{\\partial(p_i, p_j)}| = (\\sqrt{\\beta_i/\\beta_j})^{N_f} (\\sqrt{\\beta_j/\\beta_i})^{N_f} = 1$, where $N_f$ is the number of momentum degrees of freedom. So the phase space volume element is invariant, and the proposal is symmetric.\nLet's analyze the exponent:\n$\\Delta E_{exp} = (\\beta_i - \\beta_j)(U_i - U_j) + [(\\beta_i K_i - \\beta_j K(p'_i)) + (\\beta_j K_j - \\beta_i K(p'_j))]$.\nFor kinetic energy $K(p)$ that is a homogeneous function of degree $2$ (like the given quadratic form), $K(s p) = s^2 K(p)$.\n$K(p'_i) = K(p_i \\sqrt{\\beta_i/\\beta_j}) = (\\beta_i/\\beta_j) K(p_i)$.\n$K(p'_j) = K(p_j \\sqrt{\\beta_j/\\beta_i}) = (\\beta_j/\\beta_i) K(p_j)$.\nSubstituting this into the kinetic energy part of the exponent:\n$KE_{part} = (\\beta_i K_i - \\beta_j [(\\beta_i/\\beta_j) K_i]) + (\\beta_j K_j - \\beta_i [(\\beta_j/\\beta_i) K_j])$\n$KE_{part} = (\\beta_i K_i - \\beta_i K_i) + (\\beta_j K_j - \\beta_j K_j) = 0$.\nThe kinetic energy terms cancel exactly. Thus, the ratio of densities becomes $\\exp[(\\beta_i - \\beta_j)(U_i - U_j)]$, and an acceptance rule based only on potential energies is valid. This specific rescaling is necessary (\"must\") for this cancellation to occur.\n**Verdict: C is Correct.**\n\n### Analysis of Option D\nThis statement considers the case where $\\beta_i = \\beta_j$. Let $\\beta_i = \\beta_j = \\beta$. The two replicas are at the same temperature and are therefore statistically identical.\n- **Scheme A (Coord swap):** $\\Delta E_{exp} = (\\beta - \\beta)(U_i - U_j) = 0$. So $P_{acc} = \\min(1, e^0) = 1$.\n- **Scheme B/C (Full swap/Temp swap without scaling):** $\\Delta E_{exp} = (\\beta - \\beta)(H_i - H_j) = 0$. So $P_{acc} = \\min(1, e^0) = 1$.\n- **Scheme C (Temp swap with scaling):** The scaling factors $\\sqrt{\\beta_i/\\beta_j}$ and $\\sqrt{\\beta_j/\\beta_i}$ both become $1$. No rescaling occurs. The acceptance probability depends on $(\\beta_i-\\beta_j)(U_i-U_j) = 0$, so $P_{acc}=1$.\n\nIn all cases, the acceptance probability is $1$. This is expected, as swapping parts of two identical systems should not change the overall statistical state. All three methods preserve the canonical measure, and in this specific case, they are equivalent in that they all result in an accepted move (a simple relabeling of identical replicas). The momentum rescaling from C becomes an identity transformation ($p \\to 1 \\cdot p$), so it has no effect on the state or the acceptance. Thus, the statement is correct.\n**Verdict: D is Correct.**\n\n### Analysis of Option E\nThis statement proposes that the linear rescaling from C, $p \\to s p$ with $s = (\\beta_{old}/\\beta_{new})^{1/2}$, would still work if the kinetic energy $K(p)$ is not homogeneous of degree $2$.\nAs shown in the analysis of C, the cancellation of the kinetic energy terms relies critically on the property $K(sp) = s^2 K(p)$. This property is characteristic of homogeneous functions of degree $2$. If $K(p)$ is, for example, homogeneous of degree $k \\neq 2$, then $K(sp) = s^k K(p)$. The kinetic terms would not cancel. If $K(p)$ is not homogeneous at all (e.g., relativistic kinetic energy), there is no simple relationship between $K(sp)$ and $K(p)$, and the cancellation condition\n$$ (\\beta_i K_i - \\beta_j K(p_i \\sqrt{\\beta_i/\\beta_j})) + (\\beta_j K_j - \\beta_i K(p_j \\sqrt{\\beta_j/\\beta_i})) = 0 $$\nwill not hold in general. Therefore, the linear rescaling with the factor $\\sqrt{\\beta_{old}/\\beta_{new}}$ does not guarantee that the acceptance probability can be made to depend only on $U(q)$ if $K(p)$ is not quadratic or homogeneous of degree $2$.\n**Verdict: E is Incorrect.**",
            "answer": "$$\\boxed{ACD}$$"
        }
    ]
}