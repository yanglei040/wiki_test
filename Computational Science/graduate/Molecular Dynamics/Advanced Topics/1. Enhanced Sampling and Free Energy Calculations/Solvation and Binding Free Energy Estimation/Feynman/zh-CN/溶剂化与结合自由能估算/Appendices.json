{
    "hands_on_practices": [
        {
            "introduction": "热力学积分 (Thermodynamic Integration, TI) 是计算自由能差异的基石方法之一。本练习 () 超越了简单地使用现有工具，它要求学习者亲手实现数值积分方案，并且至关重要地，要处理来自模拟数据的统计误差的传播。通过这项实践，您将深入理解自由能值 $\\Delta G$ 是如何从原始的系综平均值 $\\langle \\partial U/\\partial \\lambda \\rangle$ 中精确计算出来的。",
            "id": "3447320",
            "problem": "您正在通过分子动力学中的热力学积分方法研究溶剂化或结合自由能的差异。考虑一个系统，其拥有一个可微的耦合参数 $\\lambda \\in [0,1]$，该参数用于调整构型 $\\mathbf{x}$ 上的势能函数 $U(\\mathbf{x};\\lambda)$。亥姆霍兹自由能 $A(\\lambda)$ 由配分函数定义，其中逆温度 $\\beta = 1/(k_{\\mathrm{B}} T)$，$A(\\lambda) = -\\beta^{-1} \\ln Z(\\lambda)$，而 $Z(\\lambda) = \\int \\exp\\{-\\beta U(\\mathbf{x};\\lambda)\\} \\, d\\mathbf{x}$。您已获得在离散 $\\lambda$ 值处采样的系综平均值 $\\langle \\partial U/\\partial \\lambda \\rangle_{\\lambda_i}$ 及其相关的不确定度，并且在一种情况下，还提供了一个非对角协方差矩阵，用于捕捉不同 $\\lambda$ 值处估计值之间的交叉相关性。\n\n任务1（推导）：从亥姆霍兹自由能 $A(\\lambda)$ 的基本定义和统计力学中公认的热力学恒等式出发，推导一个表达式，将一个 $\\lambda$ 区间上的自由能差 $\\Delta G$ 与势能对 $\\lambda$ 的导数的系综平均值的积分联系起来。推导如何在一个任意的、严格递增的网格 $\\{\\lambda_i\\}_{i=0}^{N-1}$ 上，使用一种复合求积法则来近似这个积分。该法则：\n- 尽可能在不重叠的三元组 $(\\lambda_i,\\lambda_{i+1},\\lambda_{i+2})$ 上使用局域二次插值法则，即对 $[\\lambda_i,\\lambda_{i+2}]$ 上的唯一二次拉格朗日插值多项式进行积分。\n- 当三元组不可用时（例如，当末尾剩下最后两个点，或总区间数为奇数时），在单个区间 $[\\lambda_i,\\lambda_{i+1}]$ 上回退到使用梯形法则。\n您的推导应表明，总的估计量可以写成数据值的单个线性泛函，即加权和 $\\widehat{\\Delta G} = \\sum_{i=0}^{N-1} w_i \\, y_i$，其中 $y_i \\equiv \\langle \\partial U/\\partial \\lambda \\rangle_{\\lambda_i}$，而权重 $w_i$ 仅取决于 $\\lambda$ 网格和所选的复合求积方法。\n\n任务2（不确定度传播）：在两种情况下推导 $\\widehat{\\Delta G}$ 的方差表达式：\n- 如果在每个 $\\lambda_i$ 处只有独立的标准误差 $s_i$ 可用，展示如何使用求积权重和 $s_i$ 计算 $\\mathrm{Var}(\\widehat{\\Delta G})$。\n- 如果一个具有元素 $C_{ij}$ 的完整协方差矩阵 $\\mathbf{C}$ 可用，展示如何使用 $\\mathbf{C}$ 和求积权重计算 $\\mathrm{Var}(\\widehat{\\Delta G})$。\n\n任务3（算法）：设计一个算法，给定任意严格递增的 $\\{\\lambda_i\\}$、对应的 $y_i$ 以及标准误差 $s_i$ 或完整协方差矩阵 $\\mathbf{C}$，通过以下方式构建复合求积权重 $\\{w_i\\}$：\n- 从最小到最大的 $\\lambda$ 将网格划分为尽可能多的不重叠三元组，在每个三元组上应用二次拉格朗日法则，为涉及的三个索引贡献权重，然后\n- 如有需要，在任何剩余的最后一个区间上应用梯形法则。\n然后，根据这些权重和不确定度计算 $\\widehat{\\Delta G}$ 及其标准误差。如果输入的 $\\lambda$ 值未按升序提供，您的算法必须对其进行排序，并必须将相同的置换一致地应用于 $y_i$ 和 $s_i$ 或 $\\mathbf{C}$。假设所有 $\\lambda$ 都是唯一的。\n\n实现和测试要求：\n- 单位：每个 $y_i$ 的单位是 $\\mathrm{kJ/mol}$，$\\lambda$ 是无量纲的，因此您的 $\\widehat{\\Delta G}$ 必须以 $\\mathrm{kJ/mol}$ 报告。所有不确定度和标准误差也必须以 $\\mathrm{kJ/mol}$ 报告。将最终结果以 $\\mathrm{kJ/mol}$ 表示，并将每个报告的浮点数四舍五入到 $6$ 位小数。\n- 角度单位不适用于此问题。\n- 您的程序必须实现上述算法，并评估以下四个测试用例。对于每个测试用例，计算并报告一对浮点数：首先是 $\\widehat{\\Delta G}$（单位 $\\mathrm{kJ/mol}$），然后是其标准误差（单位 $\\mathrm{kJ/mol}$），两者均四舍五入到 $6$ 位小数。\n\n测试套件：\n- 测试用例 $1$（均匀网格，二次信号）：\n  - $\\lambda = [\\,0.0,\\,0.25,\\,0.5,\\,0.75,\\,1.0\\,]$。\n  - 对于每个 $\\lambda_i$，有 $y_i = 2 + 3\\lambda_i - \\lambda_i^2$。\n  - 对于所有 $i$，有 $s_i = 0.05$。\n  - 未提供交叉协方差；将测量误差视为独立的。\n- 测试用例 $2$（非均匀网格，含相关误差）：\n  - $\\lambda = [\\,0.0,\\,0.1,\\,0.4,\\,0.9,\\,1.0\\,]$。\n  - 对于每个 $\\lambda_i$，有 $y_i = 1.5 + 0.5\\lambda_i + 2\\lambda_i^2$。\n  - 标准误差：$s = [\\,0.08,\\,0.10,\\,0.07,\\,0.09,\\,0.08\\,]$。\n  - 使用一个完整的协方差矩阵 $\\mathbf{C}$，其对角线元素为 $C_{ii} = s_i^2$，相邻点之间的非对角线元素为 $C_{i,i+1} = C_{i+1,i} = \\rho_1 s_i s_{i+1}$（其中 $\\rho_1 = 0.3$），次近邻点之间的非对角线元素为 $C_{i,i+2} = C_{i+2,i} = \\rho_2 s_i s_{i+2}$（其中 $\\rho_2 = 0.1$），所有其他非对角线元素均为 $0$。\n- 测试用例 $3$（两点边界情况）：\n  - $\\lambda = [\\,0.0,\\,1.0\\,]$。\n  - $y = [\\,1.0,\\,3.0\\,]$。\n  - $s = [\\,0.2,\\,0.2\\,]$。\n  - 未提供交叉协方差；将测量误差视为独立的。\n- 测试用例 $4$（奇数个区间，非均匀网格，平滑非多项式信号）：\n  - $\\lambda = [\\,0.0,\\,0.05,\\,0.2,\\,0.6,\\,0.85,\\,1.0\\,]$。\n  - 对于每个 $\\lambda_i$，有 $y_i = 2 + \\sin(\\pi \\lambda_i)$，其中 $\\pi$ 是圆周率。\n  - $s = [\\,0.05,\\,0.06,\\,0.04,\\,0.05,\\,0.07,\\,0.05\\,]$。\n  - 未提供交叉协方差；将测量误差视为独立的。\n\n最终输出规范：\n- 您的程序应生成一行输出，其中包含一个方括号内的逗号分隔列表。该列表必须按顺序包含测试用例 $1$ 到 $4$ 的结果，即每个用例的估计自由能差及其标准误差。例如，输出必须类似于\n  - $[g_1,e_1,g_2,e_2,g_3,e_3,g_4,e_4]$，\n其中每个 $g_i$ 和 $e_i$ 是一个四舍五入到 $6$ 位小数的浮点数，单位为 $\\mathrm{kJ/mol}$。",
            "solution": "此问题是有效的，因为它在统计力学方面有科学依据，在数学上是适定的，并且为获得唯一解提供了所有必要的数据和定义。\n\n### 任务1：自由能估计量的推导\n\n热力学积分的基本关系源于亥姆霍兹自由能 $A(\\lambda)$ 作为耦合参数 $\\lambda$ 的函数的定义。自由能与逆温度 $\\beta = 1/(k_{\\mathrm{B}} T)$ 下的正则配分函数 $Z(\\lambda)$ 相关：\n$$A(\\lambda) = -\\frac{1}{\\beta} \\ln Z(\\lambda)$$\n其中 $Z(\\lambda) = \\int \\exp\\{-\\beta U(\\mathbf{x};\\lambda)\\} \\, d\\mathbf{x}$ 是对系统所有构型态 $\\mathbf{x}$ 的积分，其势能为 $U(\\mathbf{x};\\lambda)$。\n\n为了找到自由能差，我们首先对 $A(\\lambda)$ 关于 $\\lambda$ 求导：\n$$ \\frac{dA(\\lambda)}{d\\lambda} = -\\frac{1}{\\beta Z(\\lambda)} \\frac{dZ(\\lambda)}{d\\lambda} $$\n配分函数的导数为：\n$$ \\frac{dZ(\\lambda)}{d\\lambda} = \\int \\frac{\\partial}{\\partial\\lambda} e^{-\\beta U(\\mathbf{x};\\lambda)} \\, d\\mathbf{x} = \\int \\left(-\\beta \\frac{\\partial U(\\mathbf{x};\\lambda)}{\\partial\\lambda}\\right) e^{-\\beta U(\\mathbf{x};\\lambda)} \\, d\\mathbf{x} $$\n将此代入 $dA/d\\lambda$ 的表达式中：\n$$ \\frac{dA(\\lambda)}{d\\lambda} = -\\frac{1}{\\beta Z(\\lambda)} \\int \\left(-\\beta \\frac{\\partial U}{\\partial\\lambda}\\right) e^{-\\beta U(\\mathbf{x};\\lambda)} \\, d\\mathbf{x} = \\frac{\\int \\frac{\\partial U}{\\partial\\lambda} e^{-\\beta U(\\mathbf{x};\\lambda)} \\, d\\mathbf{x}}{\\int e^{-\\beta U(\\mathbf{x};\\lambda)} \\, d\\mathbf{x}} $$\n右侧是在给定 $\\lambda$ 值下，量 $\\partial U/\\partial \\lambda$ 的正则系综平均的定义。因此，我们得到核心恒等式：\n$$ \\frac{dA(\\lambda)}{d\\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} $$\n$\\lambda=0$ 和 $\\lambda=1$ 之间的总自由能差 $\\Delta G$ 是通过对该导数进行积分得到的。（我们按照问题中的规定使用 $\\Delta G$，并注意到它在 NVT 系综中等同于 $\\Delta A$）。令 $y(\\lambda) = \\langle \\partial U/\\partial \\lambda \\rangle_{\\lambda}$。\n$$ \\Delta G = A(1) - A(0) = \\int_0^1 \\frac{dA(\\lambda)}{d\\lambda} \\, d\\lambda = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda = \\int_0^1 y(\\lambda) d\\lambda $$\n我们在一组离散点 $\\{\\lambda_i\\}_{i=0}^{N-1}$ 上获得了该函数的样本 $y_i = y(\\lambda_i)$。任务是使用一种特定的复合求积法则来数值近似此积分。总积分是网格上不重叠的段上的积分之和。该法则是通过将相邻区间两两分组来处理网格，这对应于使用点三元组 $(\\lambda_i, \\lambda_{i+1}, \\lambda_{i+2})$，并应用二次插值法则。如果奇数个区间导致最后剩下一个单独的区间 $[\\lambda_{N-2}, \\lambda_{N-1}]$，则使用梯形法则。\n\n**在三元组 $(\\lambda_i, \\lambda_{i+1}, \\lambda_{i+2})$ 上的二次法则**\n对于三个非共线点 $(\\lambda_i, y_i)$、$(\\lambda_{i+1}, y_{i+1})$ 和 $(\\lambda_{i+2}, y_{i+2})$，存在一个唯一的二次多项式 $P_2(\\lambda)$ 通过它们。$y(\\lambda)$ 在 $[\\lambda_i, \\lambda_{i+2}]$ 上的积分通过对此多项式积分来近似。结果是函数值 $y_i$、$y_{i+1}$ 和 $y_{i+2}$ 的加权和。对于非均匀间隔的横坐标，令 $h_1 = \\lambda_{i+1} - \\lambda_i$ 和 $h_2 = \\lambda_{i+2} - \\lambda_{i+1}$。拉格朗日插值多项式的积分为：\n$$ \\int_{\\lambda_i}^{\\lambda_{i+2}} P_2(\\lambda) \\, d\\lambda = w'_{i} y_i + w'_{i+1} y_{i+1} + w'_{i+2} y_{i+2} $$\n其中权重为：\n$$ w'_{i} = \\frac{h_1+h_2}{6h_1 h_2} h_2(2h_1-h_2) $$\n$$ w'_{i+1} = \\frac{h_1+h_2}{6h_1 h_2} (h_1+h_2)^2 $$\n$$ w'_{i+2} = \\frac{h_1+h_2}{6h_1 h_2} h_1(2h_2-h_1) $$\n这些权重的和是 $w'_i+w'_{i+1}+w'_{i+2} = h_1+h_2 = \\lambda_{i+2}-\\lambda_i$，即积分子区间的长度。\n\n**在点对 $(\\lambda_i, \\lambda_{i+1})$ 上的梯形法则**\n如果剩下一个单独的区间 $[\\lambda_i, \\lambda_{i+1}]$，我们使用梯形法则，该法则将积分近似为梯形的面积：\n$$ \\int_{\\lambda_i}^{\\lambda_{i+1}} y(\\lambda) \\, d\\lambda \\approx \\frac{\\lambda_{i+1}-\\lambda_i}{2}(y_i + y_{i+1}) = w'_{i} y_i + w'_{i+1} y_{i+1} $$\n其中权重贡献为 $w'_{i} = w'_{i+1} = (\\lambda_{i+1}-\\lambda_i)/2$。\n\n**复合求积法则和线性泛函形式**\n总积分的近似值 $\\widehat{\\Delta G}$ 是将这些法则应用于划分后的网格所得结果的总和。例如，在一个有 $N$ 个点和 $M=N-1$ 个区间的网格上，我们从 $i=0$ 开始，步长为 $2$ 进行迭代。对于每个 $i$ 使得 $i+2  N$，我们将二次法则应用于三元组 $(\\lambda_i, \\lambda_{i+1}, \\lambda_{i+2})$，将计算出的贡献加到一个全局权重向量中。如果 $M$ 是奇数，则会留下一个最后的区间 $[\\lambda_{N-2}, \\lambda_{N-1}]$，我们对其应用梯形法则。\n总估计自由能为：\n$$ \\widehat{\\Delta G} = \\sum_{\\text{子积分}} (\\text{$y_k$ 的局域加权和}) $$\n由于每个 $y_k$ 可能对一个或两个相邻的子积分有贡献（例如，$y_2$ 在 $\\int_{\\lambda_0}^{\\lambda_2}$ 和 $\\int_{\\lambda_2}^{\\lambda_4}$ 中都有贡献），这个过程可以被形式化为计算一组唯一的权重 $\\{w_i\\}$，使得：\n$$ \\widehat{\\Delta G} = \\sum_{i=0}^{N-1} w_i y_i $$\n每个 $w_i$ 是所有涉及点 $(\\lambda_i, y_i)$ 的局域法则所贡献的权重之和。这表明估计量是数据值 $\\{y_i\\}$ 的一个线性泛函。\n\n### 任务2：不确定度传播\n\n估计量 $\\widehat{\\Delta G}$ 是测量量 $y_i$ 的线性组合，这些 $y_i$ 是随机变量。令 $\\mathbf{w} = [w_0, \\dots, w_{N-1}]^T$ 为权重向量，$\\mathbf{y} = [y_0, \\dots, y_{N-1}]^T$ 为测量值向量。估计量为 $\\widehat{\\Delta G} = \\mathbf{w}^T \\mathbf{y}$。\n\n**一般情况：完整协方差矩阵**\n相关随机变量的线性组合的方差由通用公式给出：\n$$ \\mathrm{Var}(\\widehat{\\Delta G}) = \\mathrm{Var}(\\mathbf{w}^T \\mathbf{y}) = \\mathbf{w}^T \\mathbf{C} \\mathbf{w} $$\n其中 $\\mathbf{C}$ 是 $\\mathbf{y}$ 的协方差矩阵，其元素为 $C_{ij} = \\mathrm{Cov}(y_i, y_j)$。展开形式为：\n$$ \\mathrm{Var}(\\widehat{\\Delta G}) = \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} w_i C_{ij} w_j $$\n\n**特殊情况：独立误差**\n如果每个 $\\lambda_i$ 处的测量误差是独立的，则协方差矩阵 $\\mathbf{C}$ 是对角矩阵。非对角元素为零，$C_{ij} = 0$ for $i \\neq j$。对角元素是每个测量的方差，$C_{ii} = \\mathrm{Var}(y_i) = s_i^2$，其中 $s_i$ 是 $y_i$ 的标准误差。\n在这种情况下，方差的双重求和显著简化为：\n$$ \\mathrm{Var}(\\widehat{\\Delta G}) = \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} w_i (\\delta_{ij} s_j^2) w_j = \\sum_{i=0}^{N-1} w_i^2 s_i^2 $$\n在两种情况下，估计值 $\\widehat{\\Delta G}$ 的标准误差都是方差的平方根，即 $\\sigma_{\\widehat{\\Delta G}} = \\sqrt{\\mathrm{Var}(\\widehat{\\Delta G})}$。\n\n### 任务3：算法设计\n\n该算法根据一组点 $\\{\\lambda_i\\}$、相应的值 $\\{y_i\\}$ 以及不确定度（标准误差 $\\{s_i\\}$ 或协方差矩阵 $\\mathbf{C}$）来计算 $\\widehat{\\Delta G}$ 及其标准误差。\n\n1.  **输入排序**：给定输入 $\\lambda = \\{\\lambda_i\\}$、$y = \\{y_i\\}$ 和不确定度，首先确保数据按 $\\lambda$ 排序。计算将 $\\lambda$ 按升序排序的置换 `p`。将此置换应用于 $\\lambda$、$y$ 和不certainties（向量 $s$ 或矩阵 $\\mathbf{C}$ 的行和列）。将排序后的数据表示为 $\\lambda^{\\text{s}}, y^{\\text{s}}, s^{\\text{s}}, \\mathbf{C}^{\\text{s}}$。令 $N$ 为数据点数。\n\n2.  **权重计算**：初始化一个大小为 $N$ 的权重向量 $w$，其所有元素均为零。从头开始遍历网格，成对处理区间。\n    - 让计数器 `i` 从 $0$ 开始。\n    - 当 `i + 2  N` 时，我们可以形成一个三元组 $(\\lambda^{\\text{s}}_i, \\lambda^{\\text{s}}_{i+1}, \\lambda^{\\text{s}}_{i+2})$。\n        - 计算步长 $h_1 = \\lambda^{\\text{s}}_{i+1} - \\lambda^{\\text{s}}_i$ 和 $h_2 = \\lambda^{\\text{s}}_{i+2} - \\lambda^{\\text{s}}_{i+1}$。\n        - 使用任务1中的二次法则公式计算此三元组的权重贡献 $w'_i, w'_{i+1}, w'_{i+2}$。\n        - 将这些贡献加到全局权重中：$w_i \\leftarrow w_i + w'_i$，$w_{i+1} \\leftarrow w_{i+1} + w'_{i+1}$，$w_{i+2} \\leftarrow w_{i+2} + w'_{i+2}$。\n        - 增加计数器：`i \\leftarrow i + 2`。\n    - 循环结束后，如果总区间数（$N-1$）为奇数，将会留下一个区间 $[\\lambda^{\\text{s}}_{N-2}, \\lambda^{\\text{s}}_{N-1}]$。这对应于 `i == N-2`。\n        - 计算步长 $\\Delta\\lambda = \\lambda^{\\text{s}}_{N-1} - \\lambda^{\\text{s}}_{N-2}$。\n        - 应用梯形法则：将 $\\Delta\\lambda/2$ 同时加到 $w_{N-2}$ 和 $w_{N-1}$ 上。\n\n3.  **自由能估计**：通过计算最终权重向量和排序后的值向量的点积来计算估计的自由能差：\n    $$ \\widehat{\\Delta G} = \\sum_{i=0}^{N-1} w_i y^{\\text{s}}_i $$\n\n4.  **不确定度估计**：计算估计值的方差。\n    - 如果提供的是独立的标准误差 $s^{\\text{s}}$：\n      $$ \\mathrm{Var}(\\widehat{\\Delta G}) = \\sum_{i=0}^{N-1} w_i^2 (s^{\\text{s}}_i)^2 $$\n    - 如果提供的是协方差矩阵 $\\mathbf{C}^{\\text{s}}$：\n      $$ \\mathrm{Var}(\\widehat{\\Delta G}) = \\mathbf{w}^T \\mathbf{C}^{\\text{s}} \\mathbf{w} $$\n    - 标准误差为 $\\sigma_{\\widehat{\\Delta G}} = \\sqrt{\\mathrm{Var}(\\widehat{\\Delta G})}$。\n\n5.  **输出**：按要求格式返回计算出的 $\\widehat{\\Delta G}$ 及其标准误差 $\\sigma_{\\widehat{\\Delta G}}$。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_free_energy(lambdas, y_values, uncertainties):\n    \"\"\"\n    Calculates the free energy difference and its uncertainty using a custom\n    composite quadrature rule.\n\n    Args:\n        lambdas (np.ndarray): 1D array of lambda values.\n        y_values (np.ndarray): 1D array of"
        },
        {
            "introduction": "在使用双解耦 (double-decoupling) 等方法计算结合自由能时，施加人为约束是至关重要的一步，它能防止配体在与受体相互作用被关闭时漂移出结合位点。然而，施加这些约束本身会产生自由能代价，这个代价必须通过解析计算进行扣除。本练习 () 深入探讨了这些关键校正项背后的统计力学原理，从简单的平动约束过渡到广泛使用的 Boresch 约束，揭示了其理论基础和不同近似水平下的差异。",
            "id": "3447410",
            "problem": "考虑经典统计力学中，用于估算刚性配体在刚性结合位点中结合自由能的双解耦方法。关注在解耦过程中，用于将非相互作用配体局域化在结合构象上的限制（restraints）的构型贡献。配体被视为一个刚体，其相对于受体的相对姿态由一个分子间距离 $r$、两个极角 $\\theta_A$ 和 $\\theta_B$ 以及三个二面角 $\\phi_1$、$\\phi_2$ 和 $\\phi_3$ 参数化。我们感兴趣的热力学量是，相对于由标准浓度定义的参考态，对非相互作用配体施加限制所需的可逆功。使用经典系统的正则系综，并将每摩尔逆温度定义为 $\\beta = 1/(R T)$，其中 $R$ 是通用气体常数，$T$ 是绝对温度。假设所有能量都是经典势能，并且限制条件在其各自坐标上相对于指定参考值是二次（谐波）的。\n\n仅从以下基本原理出发：\n- 正则构型积分通过 $\\exp(-\\beta U)$ 对构型进行加权，其中 $U$ 是势能。\n- 在标准浓度 $c^0$ 下，每个分子的平动体积为 $V^0 = 1/(c^0 N_A)$，其中 $N_A$ 是阿伏伽德罗常数。对于 $c^0 = 1$ mol/L，$V^0$ 必须以 $\\mathrm{nm}^3$ 为单位。\n- 刚体旋转群的总测度为 $8 \\pi^2$。\n- 对于具有二次能量 $U(x) = \\tfrac{1}{2} k (x - x_0)^2$ 的一维谐波自由度 $x$，曲率 $k$ 决定了构型积分中的高斯权重。\n\n任务：\n1) 从第一性原理出发，推导施加一个纯平动的、各向同性的谐波势 $U(\\mathbf{r}) = \\tfrac{1}{2} k_t \\lVert \\mathbf{r} \\rVert^2$ 所需的限制自由能。该势将配体的质心限制在原点附近，但不限制其取向。将结果表示为 $k_t$、$T$、$R$ 和 $V^0$ 的函数。自由能必须以 $\\mathrm{kJ/mol}$ 为单位表示。\n\n2) 从第一性原理出发，推导对由一个距离 $r$、两个极角 $\\theta_A$ 和 $\\theta_B$ 以及三个二面角 $\\phi_1$、$\\phi_2$ 和 $\\phi_3$ 定义的刚体姿态施加一组六个 Boresch 型谐波限制所需的限制自由能。谐波能量为 $U = \\tfrac{1}{2} k_r (r - r_0)^2 + \\tfrac{1}{2} k_{\\theta A} (\\theta_A - \\theta_{A0})^2 + \\tfrac{1}{2} k_{\\theta B} (\\theta_B - \\theta_{B0})^2 + \\sum_{i=1}^3 \\tfrac{1}{2} k_{\\phi i} (\\phi_i - \\phi_{i0})^2$。您必须得到两种解析校正：\n   - 一种窄方差（拉普拉斯）近似，其中变量变换的测度因子 $r^2 \\sin \\theta_A \\sin \\theta_B$ 在受限姿态 $(r_0,\\theta_{A0},\\theta_{B0})$ 处进行求值。\n   - 一种改进的解析校正，该校正在精确积分谐波限制的完整高斯权重的同时，在由谐波限制势所隐含的独立高斯分布下，计算雅可比因子的期望值。\n\n3) 实现一个程序来计算：\n   - 针对三个测试刚度 $k_t$ 的平动谐波限制自由能。\n   - 对于三个 Boresch 限制参数集，计算在任务2中推导的拉普拉斯近似校正与改进的解析校正之间的差值（绝对值）。\n\n所有能量必须以 $\\mathrm{kJ/mol}$ 报告。距离必须以 $\\mathrm{nm}$ 为单位，角度以 $\\mathrm{rad}$ 为单位，刚度对于平动弹簧以 $\\mathrm{kJ \\, mol^{-1} \\, nm^{-2}}$ 为单位，对于角弹簧以 $\\mathrm{kJ \\, mol^{-1} \\, rad^{-2}}$ 为单位。使用 $T = 300$ $\\mathrm{K}$，$R = 8.314462618 \\times 10^{-3}$ $\\mathrm{kJ \\, mol^{-1} \\, K^{-1}}$，$c^0 = 1$ $\\mathrm{mol/L}$，以及 $N_A = 6.02214076 \\times 10^{23}$ $\\mathrm{mol^{-1}}$。将 $V^0$ 转换为 $\\mathrm{nm}^3$。\n\n测试套件：\n- 平动谐波案例：$k_t \\in \\{100, 1000, 10000\\}$，单位为 $\\mathrm{kJ \\, mol^{-1} \\, nm^{-2}}$。\n- Boresch 案例（所有 $k$ 的单位均为 $\\mathrm{kJ \\, mol^{-1}}$ 和相应的单位，所有角度单位为 $\\mathrm{rad}$，距离单位为 $\\mathrm{nm}$）：\n  - 案例 A：$r_0 = 0.5$, $k_r = 5000$, $\\theta_{A0} = 1.6$, $\\theta_{B0} = 1.3$, $k_{\\theta A} = 1000$, $k_{\\theta B} = 800$, $k_{\\phi 1} = 200$, $k_{\\phi 2} = 200$, $k_{\\phi 3} = 200$。\n  - 案例 B：$r_0 = 0.4$, $k_r = 20000$, $\\theta_{A0} = 1.2$, $\\theta_{B0} = 2.1$, $k_{\\theta A} = 5000$, $k_{\\theta B} = 5000$, $k_{\\phi 1} = 1000$, $k_{\\phi 2} = 1000$, $k_{\\phi 3} = 1000$。\n  - 案例 C：$r_0 = 0.6$, $k_r = 3000$, $\\theta_{A0} = 0.2$, $\\theta_{B0} = 2.94$, $k_{\\theta A} = 1500$, $k_{\\theta B} = 1500$, $k_{\\phi 1} = 150$, $k_{\\phi 2} = 150$, $k_{\\phi 3} = 150$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，前三个条目是三个平动谐波限制自由能（按 $k_t = 100, 1000, 10000$ 的顺序），后跟案例 A、B、C 的拉普拉斯校正和改进的解析 Boresch 校正之间的三个绝对差值（单位为 $\\mathrm{kJ/mol}$）。例如，输出必须看起来像 $[x_1,x_2,x_3,x_4,x_5,x_6]$，其中每个 $x_i$ 是一个浮点数。",
            "solution": "与热力学过程相关的自由能变化 $\\Delta G$ 通过统计力学的基本关系与最终（受限）和初始（参考）正则配分函数 $Q_{restr}$ 和 $Q_{ref}$ 的比值相关联：\n$$ \\Delta G = -R T \\ln \\left( \\frac{Q_{restr}}{Q_{ref}} \\right) = -\\frac{1}{\\beta} \\ln \\left( \\frac{Q_{restr}}{Q_{ref}} \\right) $$\n其中 $\\beta = 1/(RT)$ 是每摩尔逆温度，$R$ 是通用气体常数，$T$ 是绝对温度。我们正在计算从非相互作用配体的参考态开始施加限制所需的功。\n\n参考态是单个配体分子，可在标准体积 $V^0 = 1/(c^0 N_A)$ 内自由平动，并可在所有可能取向上自由旋转。刚体旋转群的体积为 $8\\pi^2$。参考构型积分是平动体积和旋转体积的乘积：\n$$ Q_{ref} = \\int_{V^0} d\\mathbf{r} \\int d\\Omega = V^0 \\cdot 8\\pi^2 $$\n其中 $\\mathbf{r}$ 表示平动坐标，$\\Omega$ 表示取向坐标。\n\n受限态施加了一个势能函数 $U_{restr}$。此状态的构型积分为：\n$$ Q_{restr} = \\int e^{-\\beta U_{restr}} d\\mathbf{r} d\\Omega $$\n积分遍及所有可及的位置和取向。\n\n对应于标准浓度 $c^0 = 1$ mol/L 的标准体积 $V^0$ 必须以 $\\mathrm{nm}^3$ 表示。给定 $N_A = 6.02214076 \\times 10^{23}$ mol$^{-1}$ 且 1 L $= 10^{24}$ nm$^3$：\n$$ V^0 = \\frac{1 \\text{ L}}{N_A} = \\frac{10^{24} \\text{ nm}^3}{6.02214076 \\times 10^{23}} \\approx 1.660539 \\text{ nm}^3 $$\n\n**任务1：各向同性平动谐波限制**\n\n对于此任务，限制势仅作用于配体的质心位置 $\\mathbf{r}=(x,y,z)$，由 $U_{restr}(\\mathbf{r}) = \\frac{1}{2} k_t \\lVert \\mathbf{r} \\rVert^2 = \\frac{1}{2} k_t (x^2 + y^2 + z^2)$ 给出。该势与取向无关。\n受限构型积分为：\n$$ Q_{restr} = \\int e^{-\\beta U_{restr}(\\mathbf{r})} d\\mathbf{r} \\int d\\Omega $$\n取向积分得到 $8\\pi^2$。平动积分可分离为三个相同的一维高斯积分：\n$$ \\int e^{-\\frac{1}{2}\\beta k_t (x^2+y^2+z^2)} dx dy dz = \\left( \\int_{-\\infty}^{\\infty} e^{-\\frac{1}{2}\\beta k_t x^2} dx \\right)^3 $$\n使用高斯积分的标准结果 $\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\pi/a}$，其中 $a = \\frac{1}{2} \\beta k_t$，我们得到：\n$$ \\int_{-\\infty}^{\\infty} e^{-\\frac{1}{2}\\beta k_t x^2} dx = \\sqrt{\\frac{\\pi}{\\frac{1}{2}\\beta k_t}} = \\sqrt{\\frac{2\\pi}{\\beta k_t}} $$\n因此，三维平动积分为 $(\\frac{2\\pi}{\\beta k_t})^{3/2}$。\n因此，受限构型积分为：\n$$ Q_{restr} = 8\\pi^2 \\left( \\frac{2\\pi}{\\beta k_t} \\right)^{3/2} $$\n限制自由能 $\\Delta G_{trans}$ 则为：\n$$ \\Delta G_{trans} = -\\frac{1}{\\beta} \\ln \\left( \\frac{Q_{restr}}{Q_{ref}} \\right) = -\\frac{1}{\\beta} \\ln \\left( \\frac{8\\pi^2 (2\\pi / (\\beta k_t))^{3/2}}{8\\pi^2 V^0} \\right) = -\\frac{1}{\\beta} \\ln \\left( \\frac{1}{V^0} \\left( \\frac{2\\pi}{\\beta k_t} \\right)^{3/2} \\right) $$\n$$ \\Delta G_{trans} = \\frac{1}{\\beta} \\ln \\left( V^0 \\left( \\frac{\\beta k_t}{2\\pi} \\right)^{3/2} \\right) = RT \\ln \\left( V^0 \\left( \\frac{k_t}{2\\pi RT} \\right)^{3/2} \\right) $$\n这是平动限制自由能的最终表达式。\n\n**任务2：Boresch 型谐波限制**\n\n这里，六个谐波限制施加在一组内部坐标上：距离 $r$、角度 $\\theta_A, \\theta_B$ 和二面角 $\\phi_1, \\phi_2, \\phi_3$。势能为 $U_{restr} = \\sum_{i=1}^6 \\frac{1}{2} k_i (\\xi_i - \\xi_{i0})^2$，其中 $\\xi_i$ 是六个坐标。\n这些坐标的微分体积元包含一个雅可比因子 $J = r^2 \\sin\\theta_A \\sin\\theta_B$。构型积分为：\n$$ Q_{restr} = \\int (r^2 \\sin\\theta_A \\sin\\theta_B) e^{-\\beta U_{restr}} dr d\\theta_A d\\theta_B d\\phi_1 d\\phi_2 d\\phi_3 $$\n由于势能 $U_{restr}$ 是独立项的和，我们可以将积分写成期望值的形式。设 $p(\\xi_1, ..., \\xi_6) = \\prod_{i=1}^6 p(\\xi_i)$ 是由谐波势定义的概率分布，其中每个 $p(\\xi_i)$ 是均值为 $\\xi_{i0}$、方差为 $\\sigma_i^2 = RT/k_i$ 的高斯分布。\n$$ Q_{restr} = \\left( \\prod_{i=1}^6 \\int e^{-\\frac{1}{2}\\beta k_i (\\xi_i - \\xi_{i0})^2} d\\xi_i \\right) \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle_{U_{restr}} $$\n积分的乘积为 $Q_{harm} = \\prod_{i=1}^6 \\sqrt{2\\pi/(\\beta k_i)}$。我们保留乘积形式。\n限制自由能为：\n$$ \\Delta G_{restr} = -\\frac{1}{\\beta} \\ln \\left( \\frac{Q_{harm} \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle}{8\\pi^2 V^0} \\right) = \\Delta G_{ideal} + \\Delta G_{corr} $$\n其中 $\\Delta G_{ideal} = -RT \\ln \\left( \\frac{Q_{harm}}{8\\pi^2 V^0} \\right)$，校正项为 $\\Delta G_{corr} = -RT \\ln \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle$。我们需要推导此校正项的两种近似。\n\n**拉普拉斯近似：**\n此方法假设限制很强，因此雅可比因子可以在平衡位置 $(r_0, \\theta_{A0}, \\theta_{B0})$ 处求值并视为常数：\n$$ \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle \\approx r_0^2 \\sin\\theta_{A0} \\sin\\theta_{B0} $$\n校正自由能则为：\n$$ \\Delta G_{corr}^{Laplace} = -RT \\ln(r_0^2 \\sin\\theta_{A0} \\sin\\theta_{B0}) $$\n\n**改进的解析校正：**\n此方法通过对独立坐标的高斯分布进行平均来计算期望值：\n$$ \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle = \\langle r^2 \\rangle_r \\langle \\sin\\theta_A \\rangle_{\\theta_A} \\langle \\sin\\theta_B \\rangle_{\\theta_B} $$\n对于变量 $\\xi \\sim \\mathcal{N}(\\xi_0, \\sigma^2)$，其中 $\\sigma^2=RT/k$：\n1. $r^2$ 的期望值为 $\\langle r^2 \\rangle = \\sigma_r^2 + r_0^2 = (RT/k_r) + r_0^2$。这利用了随机变量 $X$ 的性质 $E[X^2] = Var(X) + (E[X])^2$。\n2. $\\sin\\theta$ 的期望值为 $\\langle \\sin\\theta \\rangle = \\sin(\\theta_0) e^{-\\sigma_\\theta^2/2} = \\sin(\\theta_0) \\exp(-RT/(2k_\\theta))$。此结果源于正态分布的特征函数。\n结合这些结果：\n$$ \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle = \\left(r_0^2 + \\frac{RT}{k_r}\\right) \\sin(\\theta_{A0})\\sin(\\theta_{B0}) \\exp\\left(-\\frac{RT}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right)\\right) $$\n改进的校正自由能为：\n$$ \\Delta G_{corr}^{improved} = -RT \\ln \\left[ \\left(r_0^2 + \\frac{RT}{k_r}\\right) \\sin(\\theta_{A0})\\sin(\\theta_{B0}) \\exp\\left(-\\frac{RT}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right)\\right) \\right] $$\n\n**校正之间的差值：**\n问题要求计算绝对差值 $|\\Delta G_{corr}^{Laplace} - \\Delta G_{corr}^{improved}|$。\n$$ \\Delta G_{corr}^{Laplace} - \\Delta G_{corr}^{improved} = -RT \\ln(r_0^2 \\sin\\theta_{A0} \\sin\\theta_{B0}) - (-RT \\ln \\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle) $$\n$$ = -RT \\ln \\left( \\frac{r_0^2 \\sin\\theta_{A0} \\sin\\theta_{B0}}{\\langle r^2 \\sin\\theta_A \\sin\\theta_B \\rangle} \\right) $$\n代入期望值的表达式并简化：\n$$ = -RT \\ln \\left( \\frac{r_0^2}{r_0^2 + \\frac{RT}{k_r}} \\frac{1}{\\exp\\left(-\\frac{RT}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right)\\right)} \\right) $$\n$$ = -RT \\left[ \\ln\\left(\\frac{r_0^2}{r_0^2 + \\frac{RT}{k_r}}\\right) + \\frac{RT}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right) \\right] $$\n$$ = RT \\ln\\left(\\frac{r_0^2 + \\frac{RT}{k_r}}{r_0^2}\\right) - \\frac{(RT)^2}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right) $$\n$$ = RT \\ln\\left(1 + \\frac{RT}{k_r r_0^2}\\right) - \\frac{(RT)^2}{2}\\left(\\frac{1}{k_{\\theta A}} + \\frac{1}{k_{\\theta B}}\\right) $$\n程序将计算给定测试案例下此量的绝对值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates restraint free energies based on derivations from classical statistical mechanics.\n\n    Task 1: Computes the free energy to apply an isotropic translational harmonic\n            restraint on a ligand, relative to a standard concentration state.\n\n    Task 2  3: Computes the absolute difference between two analytic approximations\n                (Laplace and improved) for the Boresch-type restraint correction free energy.\n    \"\"\"\n    # Define physical and chemical constants as specified in the problem.\n    R = 8.314462618e-3  # Universal gas constant in kJ mol^-1 K^-1\n    T = 300.0           # Absolute temperature in K\n    NA = 6.02214076e23  # Avogadro's number in mol^-1\n    # c0 = 1.0          # Standard concentration in mol/L, implicitly used in V0 calculation\n\n    # Calculate the product RT for frequent use.\n    RT = R * T\n\n    # Calculate the standard volume V^0 per molecule in nm^3 for c^0 = 1 mol/L.\n    # 1 L = 1 dm^3 = 10^-3 m^3.\n    # 1 m = 10^9 nm, so 1 m^3 = 10^27 nm^3.\n    # Therefore, 1 L = 10^24 nm^3.\n    # V^0 = 1 / (c^0 * N_A) in liters/molecule. For c^0=1 mol/L, V^0 = (1 L) / N_A.\n    liters_to_nm3_conversion_factor = 1e24\n    V0 = liters_to_nm3_conversion_factor / NA  # in nm^3\n\n    results = []\n\n    # === Part 1: Translational-harmonic restraint free energy ===\n    \n    # Formula derived: ΔG_trans = RT * ln( V^0 * (k_t / (2*pi*RT))^(3/2) )\n    kt_cases = [100.0, 1000.0, 10000.0]  # units: kJ mol^-1 nm^-2\n    \n    for kt in kt_cases:\n        term_inside_power = kt / (2.0 * np.pi * RT)\n        term_in_log = V0 * np.power(term_inside_power, 1.5)\n        delta_g_trans = RT * np.log(term_in_log)\n        results.append(delta_g_trans)\n\n    # === Part 2: Difference between Boresch correction approximations ===\n    \n    # The Boresch-type restraint parameters for the three test cases.\n    # Each tuple contains: (r0, kr, k_thetaA, k_thetaB)\n    # Units: r0 (nm), kr (kJ mol^-1 nm^-2), k_thetaA/B (kJ mol^-1 rad^-2)\n    boresch_cases = [\n        # Case A\n        (0.5, 5000.0, 1000.0, 800.0),\n        # Case B\n        (0.4, 20000.0, 5000.0, 5000.0),\n        # Case C\n        (0.6, 3000.0, 1500.0, 1500.0),\n    ]\n\n    # Formula for the difference D = ΔG_corr_Laplace - ΔG_corr_improved\n    # D = RT * ln(1 + RT/(k_r * r_0^2)) - (RT^2)/2 * (1/k_thetaA + 1/k_thetaB)\n    # The final result required is the absolute value |D|.\n    \n    for r0, kr, k_thetaA, k_thetaB in boresch_cases:\n        # First term of the difference expression\n        log_argument = 1.0 + RT / (kr * r0**2)\n        term1 = RT * np.log(log_argument)\n        \n        # Second term of the difference expression\n        inverse_k_sum = (1.0 / k_thetaA) + (1.0 / k_thetaB)\n        term2 = (RT**2 / 2.0) * inverse_k_sum\n        \n        # Calculate the difference and take its absolute value\n        difference = abs(term1 - term2)\n        results.append(difference)\n\n    # Print the final results in the specified single-line format.\n    # The list contains three free energies and three absolute differences.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "获得自由能数值后，下一个关键步骤是进行物理解释。单个温度下的自由能值 $\\Delta G$ 往往信息有限。本练习 () 将展示如何利用在多个温度下计算得到的自由能数据，将其分解为更具物理直观性的焓变 ($\\Delta H$) 和熵变 ($\\Delta S$) 贡献，从而揭示出驱动生物过程（如分子结合）的热力学驱动力。",
            "id": "3447345",
            "problem": "给定随温度变化的溶剂化或结合自由能测量值 $\\Delta G(T)$（包含测量不确定度），温度范围为 $290 \\,\\mathrm{K}$ 到 $320 \\,\\mathrm{K}$。假设一个适用于分子动力学分析的热力学模型，其中热容变 $\\Delta C_p$ 在所考虑的温度范围内是恒定的。您必须从基本热力学定义出发，并以参考温度 $T_0 = 300 \\,\\mathrm{K}$ 为基准表示温度依赖性，使用加权最小二乘法 (WLS) 从 $\\Delta G(T)$ 数据中拟合模型中隐含的参数，然后计算在 $T = 298 \\,\\mathrm{K}$ 时的焓变 $\\Delta H$ 和熵变 $\\Delta S$，以及通过参数协方差矩阵传播得到的标准不确定度。\n\n您的推导必须从以下基本关系开始：\n- 吉布斯自由能的定义：$\\Delta G(T) = \\Delta H(T) - T \\, \\Delta S(T)$。\n- 热容变的定义：$\\Delta C_p = \\frac{d \\Delta H}{dT}$ 及其与熵的一致性关系 $T \\frac{d \\Delta S}{dT} = \\Delta C_p$。\n\n您必须对这些关系所隐含的模型进行WLS拟合。WLS定义为最小化 $\\sum_i w_i \\left[\\Delta G(T_i) - \\text{model}(T_i)\\right]^2$，其中 $w_i = 1/\\sigma_i^2$，$\\sigma_i$ 是 $\\Delta G(T_i)$ 测量的报告标准差。根据拟合结果，通过拟合参数协方差矩阵进行线性传播，估算 $\\Delta H(298 \\,\\mathrm{K})$ 和 $\\Delta S(298 \\,\\mathrm{K})$ 及其标准不确定度。\n\n所有能量必须以 $\\mathrm{kJ/mol}$ 为单位报告，所有熵以 $\\mathrm{kJ/(mol\\,K)}$ 为单位报告，所有温度以 $\\mathrm{K}$ 为单位报告。最终数值输出四舍五入至六位小数。\n\n测试套件：\n- 情况 A（$\\Delta C_p$ 不为零的一般情况）：\n  - $T_0 = 300 \\,\\mathrm{K}$\n  - 温度点 $T = [290, 295, 300, 305, 310, 315, 320] \\,\\mathrm{K}$\n  - 测得的 $\\Delta G(T)$（单位 $\\mathrm{kJ/mol}$）：$[-7.620200, -7.305000, -7.000000, -6.705000, -6.419700, -6.144268, -5.878458]$\n  - 不确定度 $\\sigma$（单位 $\\mathrm{kJ/mol}$）：$[0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]$\n- 情况 B（$\\Delta C_p \\approx 0$ 的边界情况）：\n  - $T_0 = 300 \\,\\mathrm{K}$\n  - 温度点 $T = [290, 295, 300, 305, 310, 315, 320] \\,\\mathrm{K}$\n  - 测得的 $\\Delta G(T)$（单位 $\\mathrm{kJ/mol}$）：$[-9.200000, -9.100000, -9.000000, -8.900000, -8.800000, -8.700000, -8.600000]$\n  - 不确定度 $\\sigma$（单位 $\\mathrm{kJ/mol}$）：$[0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05]$\n- 情况 C（数据点较少且不确定度较大的边缘情况）：\n  - $T_0 = 300 \\,\\mathrm{K}$\n  - 温度点 $T = [290, 295, 300, 305] \\,\\mathrm{K}$\n  - 测得的 $\\Delta G(T)$（单位 $\\mathrm{kJ/mol}$）：$[-7.933725, -7.958440, -8.000000, -8.058293]$\n  - 不确定度 $\\sigma$（单位 $\\mathrm{kJ/mol}$）：$[0.50, 0.40, 0.50, 0.60]$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个包含四个浮点数的列表，顺序为 $[\\Delta H(298\\,\\mathrm{K}), \\sigma_{\\Delta H(298\\,\\mathrm{K})}, \\Delta S(298\\,\\mathrm{K}), \\sigma_{\\Delta S(298\\,\\mathrm{K})}]$，所有数值均四舍五入至六位小数。例如，输出格式必须类似于：“[[hA,sig_hA,sA,sig_sA],[hB,sig_hB,sB,sig_sB],[hC,sig_hC,sC,sig_sC]]”，并用所需的数值替换。",
            "solution": "目标是根据一组随温度变化的吉布斯自由能测量值 $\\Delta G(T_i)$，确定在特定目标温度 $T_{target} = 298\\,\\mathrm{K}$ 下的焓变 $\\Delta H$ 和熵变 $\\Delta S$。该分析假设在实验温度范围内，热容变 $\\Delta C_p$ 是一个常数。该问题将通过以下步骤解决：首先推导 $\\Delta G(T)$ 的函数形式，然后使用加权最小二乘法 (WLS) 拟合其参数，最后将拟合的不确定度传播到所需量 $\\Delta H(T_{target})$ 和 $\\Delta S(T_{target})$。\n\n**1. $\\Delta G(T)$ 的热力学模型推导**\n\n推导从所提供的基本热力学关系开始：\n焓变 $\\Delta H$ 和熵变 $\\Delta S$ 随温度的变化由热容变 $\\Delta C_p$ 决定：\n$$\n\\frac{d \\Delta H}{dT} = \\Delta C_p\n$$\n$$\n\\frac{d \\Delta S}{dT} = \\frac{\\Delta C_p}{T}\n$$\n假设 $\\Delta C_p$ 在目标温度范围内为常数，我们可以将这些方程从参考温度 $T_0$ 积分到任意温度 $T$：\n$$\n\\int_{\\Delta H(T_0)}^{\\Delta H(T)} d(\\Delta H') = \\int_{T_0}^{T} \\Delta C_p \\, dT' \\implies \\Delta H(T) = \\Delta H(T_0) + \\Delta C_p (T - T_0)\n$$\n$$\n\\int_{\\Delta S(T_0)}^{\\Delta S(T)} d(\\Delta S') = \\int_{T_0}^{T} \\frac{\\Delta C_p}{T'} \\, dT' \\implies \\Delta S(T) = \\Delta S(T_0) + \\Delta C_p \\ln\\left(\\frac{T}{T_0}\\right)\n$$\n为方便起见，我们记 $\\Delta H_0 \\equiv \\Delta H(T_0)$ 和 $\\Delta S_0 \\equiv \\Delta S(T_0)$。吉布斯自由能定义为 $\\Delta G(T) = \\Delta H(T) - T \\Delta S(T)$。代入 $\\Delta H(T)$ 和 $\\Delta S(T)$ 的表达式可得：\n$$\n\\Delta G(T) = [\\Delta H_0 + \\Delta C_p (T - T_0)] - T [\\Delta S_0 + \\Delta C_p \\ln(T/T_0)]\n$$\n为了构建一个适合拟合的线性模型，我们用参考温度下的自由能 $\\Delta G_0 \\equiv \\Delta G(T_0) = \\Delta H_0 - T_0 \\Delta S_0$ 来表示 $\\Delta H_0$。这得到 $\\Delta H_0 = \\Delta G_0 + T_0 \\Delta S_0$。将其代入 $\\Delta G(T)$ 的方程中：\n$$\n\\Delta G(T) = (\\Delta G_0 + T_0 \\Delta S_0) - T \\Delta S_0 + \\Delta C_p (T - T_0) - T \\Delta C_p \\ln(T/T_0)\n$$\n整理各项，将被拟合的参数（$\\Delta G_0$, $\\Delta S_0$, $\\Delta C_p$）分组：\n$$\n\\Delta G(T) = \\Delta G_0 - (T - T_0)\\Delta S_0 + \\Delta C_p \\left[ (T - T_0) - T \\ln\\left(\\frac{T}{T_0}\\right) \\right]\n$$\n这是最终的模型方程，它在三个参数 $\\Delta G_0$、$\\Delta S_0$ 和 $\\Delta C_p$ 上是线性的。\n\n**2. 加权最小二乘法 (WLS) 公式**\n\n该模型可以用矩阵形式表示为 $\\mathbf{y} = \\mathbf{Xp}$，其中 $\\mathbf{y}$ 是观测到的 $\\Delta G(T_i)$ 值的向量，$\\mathbf{p}$ 是参数向量，$\\mathbf{X}$ 是设计矩阵。\n对于 $N$ 个数据点，它们是：\n$$\n\\mathbf{y} = \\begin{bmatrix} \\Delta G(T_1) \\\\ \\vdots \\\\ \\Delta G(T_N) \\end{bmatrix}, \\quad\n\\mathbf{p} = \\begin{bmatrix} \\Delta G_0 \\\\ \\Delta S_0 \\\\ \\Delta C_p \\end{bmatrix}\n$$\n设计矩阵 $\\mathbf{X}$ 的第 $i$ 行对应于第 $i$ 次测量（温度为 $T_i$）时各参数的系数：\n$$\n\\mathbf{X}_i = \\begin{bmatrix} 1  -(T_i - T_0)  (T_i - T_0) - T_i \\ln(T_i/T_0) \\end{bmatrix}\n$$\nWLS方法最小化加权残差平方和 $\\chi^2 = (\\mathbf{y} - \\mathbf{Xp})^T \\mathbf{W} (\\mathbf{y} - \\mathbf{Xp})$，其中 $\\mathbf{W}$ 是对角权重矩阵，其元素为 $W_{ii} = 1/\\sigma_i^2$，$\\sigma_i$ 是 $\\Delta G(T_i)$ 的测量不确定度。\n参数向量 $\\mathbf{p}$ 的解由正规方程给出：\n$$\n\\mathbf{p} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y}\n$$\n拟合参数的协方差矩阵 $\\mathbf{C_p}$ 是 $\\chi^2$ 的Hessian矩阵的逆：\n$$\n\\mathbf{C_p} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1}\n$$\n\n**3. 目标量的计算与不确定度传播**\n\n目标是计算在 $T_{target} = 298\\,\\mathrm{K}$ 时的 $\\Delta H(T_{target})$ 和 $\\Delta S(T_{target})$ 及其标准不确定度。我们首先将这些量表示为拟合参数 $\\mathbf{p} = [\\Delta G_0, \\Delta S_0, \\Delta C_p]^T$ 的线性函数。\n\n对于在 $T_{target}$ 的焓：\n$$\n\\Delta H(T_{target}) = \\Delta H_0 + \\Delta C_p (T_{target} - T_0) = (\\Delta G_0 + T_0 \\Delta S_0) + \\Delta C_p (T_{target} - T_0)\n$$\n这是拟合参数的一个线性组合：\n$$\n\\Delta H(T_{target}) = \\begin{bmatrix} 1  T_0  T_{target} - T_0 \\end{bmatrix} \\begin{bmatrix} \\Delta G_0 \\\\ \\Delta S_0 \\\\ \\Delta C_p \\end{bmatrix} = \\mathbf{j}_H^T \\mathbf{p}\n$$\n其中 $\\mathbf{j}_H = [1, T_0, T_{target} - T_0]^T$ 是 $\\Delta H(T_{target})$ 关于参数的雅可比向量。\n\n对于在 $T_{target}$ 的熵：\n$$\n\\Delta S(T_{target}) = \\Delta S_0 + \\Delta C_p \\ln(T_{target}/T_0)\n$$\n这同样是拟合参数的一个线性组合：\n$$\n\\Delta S(T_{target}) = \\begin{bmatrix} 0  1  \\ln(T_{target}/T_0) \\end{bmatrix} \\begin{bmatrix} \\Delta G_0 \\\\ \\Delta S_0 \\\\ \\Delta C_p \\end{bmatrix} = \\mathbf{j}_S^T \\mathbf{p}\n$$\n其中 $\\mathbf{j}_S = [0, 1, \\ln(T_{target}/T_0)]^T$ 是相应的雅可比向量。\n\n一个量 $F = \\mathbf{j}^T \\mathbf{p}$ 的方差由误差传播公式 $\\sigma_F^2 = \\mathbf{j}^T \\mathbf{C_p} \\mathbf{j}$ 给出。将此应用于我们的目标量：\n$\\Delta H(T_{target})$ 的方差是：\n$$\n\\sigma_{\\Delta H}^2 = \\mathbf{j}_H^T \\mathbf{C_p} \\mathbf{j}_H\n$$\n$\\Delta S(T_{target})$ 的方差是：\n$$\n\\sigma_{\\Delta S}^2 = \\mathbf{j}_S^T \\mathbf{C_p} \\mathbf{j}_S\n$$\n标准不确定度 $\\sigma_{\\Delta H}$ 和 $\\sigma_{\\Delta S}$ 是这些方差的平方根。\n\n计算步骤如下：\n1.  对于每个测试用例，根据给定的 $\\Delta G_i$ 和 $\\sigma_i$ 构建测量向量 $\\mathbf{y}$ 和权重矩阵 $\\mathbf{W}$。\n2.  使用温度点 $T_i$ 和参考温度 $T_0 = 300\\,\\mathrm{K}$ 构建设计矩阵 $\\mathbf{X}$。\n3.  求解参数向量 $\\mathbf{p}$ 和协方差矩阵 $\\mathbf{C_p}$。\n4.  使用拟合的参数计算 $\\Delta H(298\\,\\mathrm{K})$ 和 $\\Delta S(298\\,\\mathrm{K})$ 的值。\n5.  为 $T_{target} = 298\\,\\mathrm{K}$ 构建雅可比向量 $\\mathbf{j}_H$ 和 $\\mathbf{j}_S$。\n6.  计算方差 $\\sigma_{\\Delta H}^2$ 和 $\\sigma_{\\Delta S}^2$，并取其平方根以求得标准不确定度。\n所有能量的单位为 $\\mathrm{kJ/mol}$，熵的单位为 $\\mathrm{kJ/(mol \\cdot K)}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"T\": [290, 295, 300, 305, 310, 315, 320],\n            \"dG\": [-7.620200, -7.305000, -7.000000, -6.705000, -6.419700, -6.144268, -5.878458],\n            \"sigma\": [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]\n        },\n        {\n            \"T\": [290, 295, 300, 305, 310, 315, 320],\n            \"dG\": [-9.200000, -9.100000, -9.000000, -8.900000, -8.800000, -8.700000, -8.600000],\n            \"sigma\": [0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05]\n        },\n        {\n            \"T\": [290, 295, 300, 305],\n            \"dG\": [-7.933725, -7.958440, -8.000000, -8.058293],\n            \"sigma\": [0.50, 0.40, 0.50, 0.60]\n        }\n    ]\n\n    T0 = 300.0  # Reference temperature in K\n    T_target = 298.0  # Target temperature in K\n\n    results = []\n    for case in test_cases:\n        T_arr = np.array(case[\"T\"])\n        dG_arr = np.array(case[\"dG\"])\n        sigma_arr = np.array(case[\"sigma\"])\n\n        result = fit_thermo_model(T_arr, dG_arr, sigma_arr, T0, T_target)\n        results.append(result)\n\n    # Format the output string as per problem specification.\n    case_results_str = []\n    for res in results:\n        case_results_str.append(\n            f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{res[3]:.6f}]\"\n        )\n    \n    print(f\"[{','.join(case_results_str)}]\")\n\ndef fit_thermo_model(T, dG, sigma, T0, T_target):\n    \"\"\"\n    Performs a Weighted Least Squares fit to the thermodynamic model and propagates uncertainties.\n\n    Args:\n        T (np.ndarray): Array of temperatures in K.\n        dG (np.ndarray): Array of measured Gibbs free energies in kJ/mol.\n        sigma (np.ndarray): Array of uncertainties for dG in kJ/mol.\n        T0 (float): Reference temperature in K.\n        T_target (float): Target temperature for calculation in K.\n\n    Returns:\n        tuple: A tuple containing (dH_target, sigma_dH, dS_target, sigma_dS) at T_target.\n    \"\"\"\n    # 1. Construct the design matrix X\n    # The model is dG(T) = dG0 - (T-T0)*dS0 + dCp*[(T-T0) - T*ln(T/T0)]\n    # Parameters p = [dG0, dS0, dCp]\n    num_points = len(T)\n    X = np.zeros((num_points, 3))\n    \n    # Using np.errstate to handle the case T=T0 for the log term, where the result is 0.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        col0 = np.ones(num_points)\n        col1 = -(T - T0)\n        # The third column's expression is zero when T = T0\n        col2 = (T - T0) - T * np.log(T / T0)\n        col2[T == T0] = 0.0\n\n    X[:, 0] = col0\n    X[:, 1] = col1\n    X[:, 2] = col2\n\n    # 2. Construct the weight matrix W (as a vector for efficiency)\n    w = 1.0 / (sigma**2)\n\n    # 3. Solve the normal equations for parameters and covariance matrix\n    # p = (X^T W X)^-1 X^T W y\n    # Cov(p) = (X^T W X)^-1\n    XT_W = X.T * w  # Broadcasting w to rows of X.T\n    XT_W_X = XT_W @ X\n    \n    # Parameter covariance matrix\n    Cp = np.linalg.inv(XT_W_X)\n    \n    XT_W_y = XT_W @ dG\n    \n    # Best-fit parameters\n    p = Cp @ XT_W_y\n    dG0, dS0, dCp = p\n\n    # 4. Calculate target quantities (dH and dS at T_target)\n    # dH(T) = dG0 + T0*dS0 + (T-T0)*dCp\n    dH_target = dG0 + T0 * dS0 + (T_target - T0) * dCp\n    \n    # dS(T) = dS0 + dCp*ln(T/T0)\n    # Handle the case where T_target might be T0, for which ln(1)=0\n    log_term_S = np.log(T_target / T0) if T_target != T0 else 0.0\n    dS_target = dS0 + dCp * log_term_S\n\n    # 5. Propagate uncertainties\n    # Variance(F) = j^T * Cov(p) * j\n    \n    # Jacobian for dH(T_target) w.r.t p=[dG0, dS0, dCp]\n    jH = np.array([1.0, T0, T_target - T0])\n    \n    # Jacobian for dS(T_target) w.r.t p=[dG0, dS0, dCp]\n    jS = np.array([0.0, 1.0, log_term_S])\n\n    # Calculate variances\n    var_dH = jH.T @ Cp @ jH\n    var_dS = jS.T @ Cp @ jS\n\n    # Standard uncertainties are the square roots of the variances\n    sigma_dH = np.sqrt(var_dH)\n    sigma_dS = np.sqrt(var_dS)\n    \n    return dH_target, sigma_dH, dS_target, sigma_dS\n\n# Execute the main function when the script is run\nsolve()\n```"
        }
    ]
}