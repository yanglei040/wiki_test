{
    "hands_on_practices": [
        {
            "introduction": "在模拟退火中，初始温度 $T_0$ 的选择至关重要。它必须足够高，以确保系统有足够的能量跨越构象空间中的最高能垒，从而在搜索初期能够广泛探索。这个练习  将指导你如何基于体系的能垒高度和一个预设的跨越概率，来定量地计算出所需的初始温度，为设计一个有效的降温方案奠定基础。",
            "id": "3445992",
            "problem": "一个模型肽具有三个侧链二面角，其在旋转异构态之间的跃迁主要由扭转势垒决定。势垒高度定义为相对于当前旋转异构体能量最小值、达到过渡态所需的能量增加量，其测量值分别为 $\\Delta E_{\\chi_1} = 12 \\ \\mathrm{kJ/mol}$、$\\Delta E_{\\chi_2} = 18 \\ \\mathrm{kJ/mol}$ 和 $\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。考虑一个用于分子动力学中构象搜索的模拟退火方案，该方案对二面角旋转采用对称提议，并使用 Metropolis 接受准则。\n\n使用以下基本原理：\n- 在温度 $T$ 下，对于一个使能量增加 $\\Delta U$ 的提议移动，其 Metropolis 接受概率为 $p_{\\mathrm{acc}} = \\exp(-\\Delta U/(k_B T))$，其中 $k_B$ 是玻尔兹曼常数。\n- 当势垒高度以每摩尔为单位指定时，相关的热学因子是摩尔气体常数 $R$，定义为 $R = N_A k_B$，因此跨越一个摩尔势垒 $\\Delta E$ 的接受概率为 $p(T) = \\exp(-\\Delta E/(R T))$。\n- 对于在固定温度下的 $N$ 次统计独立的提议，每次的成功概率为 $p(T)$，则在该区块中至少有一次成功跨越的概率为 $P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$。\n\n假设在一个包含 $N=100$ 次提议的区块内，在固定温度 $T$ 下，跨越势垒的各次提议是相互独立的，这是一个合理的近似。对于每个势垒 $\\Delta E_{\\chi_i}$，计算温度 $T_i$，使得在 $N = 100$ 次提议中至少跨越一次势垒的概率满足 $P_{\\mathrm{block}} = 0.10$。然后，设计一个几何降温方案 $T_k = T_0 \\alpha^k$（其中 $0  \\alpha  1$ 且 $k$ 为非负整数），该方案从一个足以跨越最高势垒的温度 $T_0$ 开始，然后分阶段降温，以便在淬火前能访问与 $\\chi_2$ 和 $\\chi_1$ 相关的所有旋转异构体。\n\n最后，确定最低初始温度 $T_0$（单位为开尔文），该温度能保证在 $N=100$ 次提议中，跨越最高势垒 $\\Delta E_{\\chi_3}$ 的概率为 $P_{\\mathrm{block}} = 0.10$。请用开尔文表示最终的 $T_0$，并将答案四舍五入至四位有效数字。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n-   肽侧链扭转势垒高度：$\\Delta E_{\\chi_1} = 12 \\ \\mathrm{kJ/mol}$、$\\Delta E_{\\chi_2} = 18 \\ \\mathrm{kJ/mol}$ 和 $\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。\n-   该方案是使用 Metropolis 接受准则的模拟退火。\n-   在温度 $T$ 下，能量增加 $\\Delta U$ 的 Metropolis 接受概率：$p_{\\mathrm{acc}} = \\exp(-\\Delta U/(k_B T))$。\n-   玻尔兹曼常数记为 $k_B$。\n-   跨越摩尔势垒 $\\Delta E$ 的接受概率：$p(T) = \\exp(-\\Delta E/(R T))$，其中摩尔气体常数 $R = N_A k_B$。\n-   一个区块中统计独立的提议次数：$N = 100$。\n-   在一个包含 $N$ 次提议的区块中至少有一次成功跨越的概率：$P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$。\n-   至少一次跨越的目标概率：$P_{\\mathrm{block}} = 0.10$。\n-   几何降温方案形式：$T_k = T_0 \\alpha^k$，其中 $0  \\alpha  1$ 且 $k$ 为非负整数。\n-   目标：确定最低初始温度 $T_0$（单位为开尔文），使得最高势垒 $\\Delta E_{\\chi_3}$ 以 $P_{\\mathrm{block}} = 0.10$ 的概率在 $N=100$ 次提议中被跨越，结果四舍五入至四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n-   **科学依据充分**：该问题牢固地植根于统计力学和计算化学的原理。扭转能垒、模拟退火、Metropolis-Hastings 算法和玻尔兹曼分布等概念是分子动力学和构象分析的基石。所有给定的方程和原理都是标准且正确的。\n-   **适定性**：该问题是适定的。它提供了一个明确的目标（计算 $T_0$），以及获得唯一、有意义的解所需的所有数学关系和数值。所提供的关于完整降温方案的背景信息有助于定义 $T_0$ 的作用，但并未引入歧义，因为最终任务是明确孤立的。\n-   **客观性**：问题以精确、定量和无偏见的语言陈述。\n-   **一致性与完整性**：该问题是自洽且内部一致的。虽然没有明确给出摩尔气体常数 $R$ 的值，但它是一个普适物理常数，在此类问题中使用它是标准做法。问题不包含相互矛盾的约束条件。\n\n### 步骤 3：结论与行动\n该问题被判定为 **有效**。这是一个物理化学或生物物理学中的标准、定义明确的问题。现在将推导完整的解。\n\n主要目标是确定模拟退火方案的初始温度 $T_0$。这个温度必须足够高，以允许系统以指定的概率克服最高的能垒 $\\Delta E_{\\chi_3}$。条件是在一个包含 $N=100$ 次提议的区块中，至少有一次成功跨越的概率为 $P_{\\mathrm{block}} = 0.10$。\n\n至少一次成功跨越的概率 $P_{\\mathrm{block}}$ 通过给定公式与单次尝试成功概率 $p(T)$ 相关联：\n$$P_{\\mathrm{block}} = 1 - (1 - p(T))^{N}$$\n\n给定 $P_{\\mathrm{block}} = 0.10$ 和 $N = 100$。我们可以重新整理这个方程来求解所需的单次尝试概率 $p(T_0)$：\n$$1 - P_{\\mathrm{block}} = (1 - p(T_0))^{N}$$\n$$(1 - P_{\\mathrm{block}})^{1/N} = 1 - p(T_0)$$\n$$p(T_0) = 1 - (1 - P_{\\mathrm{block}})^{1/N}$$\n\n接受一个使能量增加势垒高度 $\\Delta E$ 的移动的单次尝试概率，由适用于摩尔能量的 Metropolis 准则给出：\n$$p(T) = \\exp\\left(-\\frac{\\Delta E}{R T}\\right)$$\n\n将 $p(T_0)$ 的两个表达式相等，我们得到：\n$$\\exp\\left(-\\frac{\\Delta E}{R T_0}\\right) = 1 - (1 - P_{\\mathrm{block}})^{1/N}$$\n\n为求解 $T_0$，我们对两边取自然对数：\n$$-\\frac{\\Delta E}{R T_0} = \\ln\\left(1 - (1 - P_{\\mathrm{block}})^{1/N}\\right)$$\n\n最后，我们分离出 $T_0$：\n$$T_0 = -\\frac{\\Delta E}{R \\ln\\left(1 - (1 - P_{\\mathrm{block}})^{1/N}\\right)}$$\n\n这是跨越势垒 $\\Delta E$ 所需温度的通用公式。问题指定 $T_0$ 为初始温度，设计得足够高以穿越最高的能垒，即 $\\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol}$。\n\n我们将给定值代入此推导出的表达式中：\n-   $\\Delta E = \\Delta E_{\\chi_3} = 25 \\ \\mathrm{kJ/mol} = 2.5 \\times 10^4 \\ \\mathrm{J/mol}$\n-   $N = 100$\n-   $P_{\\mathrm{block}} = 0.10$\n-   摩尔气体常数 $R$ 是一个基本物理常数。我们将使用其 CODATA 值，$R \\approx 8.314462618 \\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}}$。\n\n$T_0$ 的表达式变为：\n$$T_0 = -\\frac{2.5 \\times 10^4}{R \\ln\\left(1 - (1 - 0.10)^{1/100}\\right)}$$\n$$T_0 = -\\frac{2.5 \\times 10^4}{R \\ln\\left(1 - (0.9)^{0.01}\\right)}$$\n\n现在，我们进行数值计算。\n首先，计算对数中的项：\n$$(0.9)^{0.01} \\approx 0.99894709$$\n$$1 - (0.9)^{0.01} \\approx 1 - 0.99894709 = 0.00105291$$\n该值的自然对数是：\n$$\\ln(0.00105291) \\approx -6.85549$$\n将此值代入 $T_0$ 的方程中：\n$$T_0 = -\\frac{2.5 \\times 10^4 \\ \\mathrm{J/mol}}{8.31446 \\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}} \\times (-6.85549)}$$\n$$T_0 = \\frac{2.5 \\times 10^4}{8.31446 \\times 6.85549} \\ \\mathrm{K}$$\n$$T_0 = \\frac{2.5 \\times 10^4}{56.9935} \\ \\mathrm{K}$$\n$$T_0 \\approx 438.647 \\ \\mathrm{K}$$\n\n问题要求答案四舍五入到四位有效数字。\n$$T_0 \\approx 438.6 \\ \\mathrm{K}$$\n这就是模拟退火方案所需的最低初始温度，以确保能够以指定的概率跨越最高的构象势垒。",
            "answer": "$$\\boxed{438.6}$$"
        },
        {
            "introduction": "成功的构象搜索可以看作是一场与时间的赛跑：系统必须在温度降得过低之前找到全局能量最低点，否则就会被“冻结”在当前的局部能量阱中。当存在可能错误地指向非天然构象的外部约束（例如，来自实验数据的噪声）时，这种被称为动力学捕获（kinetic trapping）的风险会变得更加严峻。这个练习  通过一个简化的模型，精确地模拟了全局重排与陷入错误约束之间的竞争，让你亲身体会降温速率 $\\tau_{\\text{cool}}$ 如何成为决定搜索成败的关键因素。",
            "id": "3446033",
            "problem": "考虑一个正在进行模拟退火的大分子的一维粗粒化构象坐标 $x \\in \\mathbb{R}$。其构象能量被建模为\n$$\nU(x,t) \\;=\\; U_0(x) \\;+\\; w(t)\\,R(x),\n$$\n其中 $U_0(x)$ 是一个代表全局盆地的原生双阱势，$R(x)$ 是一个编码了含噪声实验约束的二次约束。原生双阱势为\n$$\nU_0(x) \\;=\\; a\\,(x^2 - 1)^2 + \\delta\\,x,\n$$\n其中 $a>0$，还有一个小的倾斜 $\\delta > 0$ 使得 $x\\approx -1$ 成为能量较低的全局盆地，而 $x\\approx +1$ 成为能量较高的非原生盆地。约束为\n$$\nR(x) \\;=\\; (x - x_r)^2,\n$$\n其目标 $x_r$ 位于非原生盆地 $x_r = +1$ 处，这有意地模拟了一个偏向错误盆地的含噪声或错误指定的约束。\n\n模拟退火的温度调度是指数式的，\n$$\nT(t) \\;=\\; T_0\\,\\exp\\!\\left(-\\frac{t}{\\tau_{\\text{cool}}}\\right),\n$$\n其中 $T_0>0$ 是初始温度，$\\tau_{\\text{cool}}>0$ 是冷却时间尺度。约束权重 $w(t)$ 随时间收紧，遵循\n$$\nw(t) \\;=\\; w_0 \\;+\\; b_w\\left( 1 - \\exp\\!\\left(-\\frac{t}{\\tau_{\\text{rest}}}\\right)\\right),\n$$\n其中 $w_0 \\ge 0$ 是初始权重，$b_w > 0$ 是总增量，$\\tau_{\\text{rest}}>0$ 是约束收紧的时间尺度。这种同步收紧是实际方案中的一个常见特征。\n\n我们对两个过程之间的竞争进行建模：\n- 从约束所偏好的非原生盆地重排到全局盆地，其瞬时速率为\n$$\nk_{\\text{rearr}}(t) \\;=\\; \\nu_r \\,\\exp\\!\\left(-\\frac{\\Delta E_{\\text{eff}}(t)}{T(t)}\\right),\n$$\n其中 $\\nu_r > 0$ 是一个尝试频率，$\\Delta E_{\\text{eff}}(t)$ 是在当前约束权重下，从非原生盆地 $x\\approx +1$ 到鞍点 $x\\approx 0$ 的有效势垒，\n$$\n\\Delta E_{\\text{eff}}(t) \\;=\\; \\big[U_0(0) - U_0(+1)\\big] \\;+\\; w(t)\\,\\big[R(0) - R(+1)\\big].\n$$\n- 在非原生盆地内为满足含噪声约束而过度受缚，表现为一个竞争事件，其瞬时速率为\n$$\nk_{\\text{commit}}(t) \\;=\\; c\\,w(t),\n$$\n其中 $c > 0$ 是一个比例常数，反映了随着约束收紧，局部弛豫会加快。该项捕捉了收紧含噪声的约束如何能将轨迹锁定在错误的盆地中。\n\n假设这两个过程为独立的竞争性指数时钟。那么，在时间 $t=N$（此处视为单位时间步长的离散蒙特卡洛步数）之前，重排先于约束过度受缚发生的概率为\n$$\nP_{\\text{rearr}}(N) \\;=\\; \\int_0^N k_{\\text{rearr}}(t)\\,\\exp\\!\\left(-\\int_0^t \\big[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\big]\\,du\\right)\\,dt.\n$$\n此表达式遵循竞争性非齐次泊松过程的标准性质，并为随机模拟退火动力学提供了一个可处理的近似，特别是当关注竞争过程中第一个事件的发生时机时。\n\n您的任务是实现一个程序，对于指定的参数，通过将积分数值近似为单位时间步长的离散求和来计算 $P_{\\text{rearr}}(N)$。请使用以下固定的参数，这些参数的选择在科学上是合理的且内部一致的：\n- 原生双阱势参数：$a = 20.0$, $\\delta = 0.25$。\n- 约束目标：$x_r = +1.0$。\n- 约束调度参数：$w_0 = 0.0$, $b_w = 12.0$, $\\tau_{\\text{rest}} = 200.0$。\n- 退火参数：$T_0 = 3.0$。\n- 速率参数：$\\nu_r = 0.3$, $c = 0.01$。\n所有量都采用无量纲蒙特卡洛单位。时间 $t$ 和总步数 $N$ 以蒙特卡洛步数为单位进行测量。\n\n根据双阱势和约束明确定义有效势垒的各部分：\n- 鞍点和非原生盆地的位置满足 $x_{\\text{saddle}} = 0$ 和 $x_{\\text{non-native}} = +1$，所以\n$$\n\\Delta E_0 \\equiv U_0(0) - U_0(+1) = a - \\delta,\n$$\n且\n$$\n\\Delta R \\equiv R(0) - R(+1) = (0-1)^2 - (1-1)^2 = 1.\n$$\n因此，\n$$\n\\Delta E_{\\text{eff}}(t) = \\Delta E_0 + w(t)\\,\\Delta R = (a - \\delta) + w(t).\n$$\n\n测试套件：\n为以下三种情况计算 $P_{\\text{rearr}}(N)$，这三种情况旨在探究冷却、重排和约束收紧之间不同的时间尺度机制：\n- 情况 1（理想路径）：$\\tau_{\\text{cool}} = 100.0$, $N = 4000$。\n- 情况 2（冷却过慢且时间表延长）：$\\tau_{\\text{cool}} = 1000.0$, $N = 20000$。\n- 情况 3（极速淬火）：$\\tau_{\\text{cool}} = 1.0$, $N = 4000$。\n\n对于每种情况，您的程序应将 $P_{\\text{rearr}}(N)$ 计算为一个浮点数。最终输出格式必须是单行，包含一个用方括号括起来的、由逗号分隔的三个概率列表，例如 $[p_1,p_2,p_3]$，其中 $p_i$ 是使用标准 Python 字符串格式化的计算浮点数。无需报告物理单位，因为所有量都是无量纲的蒙特卡洛步数和约化单位能量。\n\n您的实现必须是鲁棒且数值稳定的，在单位时间步长上使用简单的黎曼和离散化来处理积分：\n$$\nP_{\\text{rearr}}(N) \\approx \\sum_{t=0}^{N-1} k_{\\text{rearr}}(t)\\,\\exp\\!\\left(-\\sum_{u=0}^{t-1}\\big[k_{\\text{rearr}}(u)+k_{\\text{commit}}(u)\\big]\\right).\n$$\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的列表形式的结果（例如，$[p_1,p_2,p_3]$）。",
            "solution": "所呈现的问题是一个定义明确且具有科学依据的随机过程建模练习，特别是在大分子构象搜索的模拟退火背景下。它是自洽的，提供了所有必要的参数和函数形式，并提出了一个明确的计算任务。该模型虽然简化，但捕捉到了探索构象空间以寻找全局能量最小值与被可能错误的外部约束所偏好的局部最小值动力学捕获之间的本质竞争。该问题是有效的，并且可以通过直接的数值求解来解决。\n\n问题的核心是计算概率 $P_{\\text{rearr}}(N)$，即在总共 $N$ 步的模拟时间内，期望的构象重排在不期望的“过度受缚”于非原生状态之前发生的概率。这个场景被建模为两个独立的、时间非齐次的泊松过程之间的竞争。\n\n系统的总构象能量由 $U(x,t) = U_0(x) + w(t)R(x)$ 给出，其中 $x$ 是一维构象坐标。\n\n固有能量分量 $U_0(x) = a(x^2 - 1)^2 + \\delta x$ 是一个双阱势，参数为 $a=20.0$ 和 $\\delta=0.25$。小的正倾斜 $\\delta$ 确立了 $x \\approx -1$ 附近的盆地为全局最小值（原生状态），而 $x \\approx +1$ 附近的盆地为能量较高的局部最小值（非原生状态）。\n\n约束分量是 $R(x) = (x - x_r)^2$，其目标 $x_r = +1.0$ 被有意地放置在非原生最小值处。此约束的强度由一个随时间变化的权重 $w(t) = w_0 + b_w\\left( 1 - \\exp(-t/\\tau_{\\text{rest}})\\right)$ 调节。参数为 $w_0=0.0$、$b_w=12.0$ 和 $\\tau_{\\text{rest}}=200.0$，该约束从零强度开始，随时间增加，逐渐偏向不正确的盆地。\n\n模拟退火协议由一个指数冷却的温度调度定义，$T(t) = T_0\\exp(-t/\\tau_{\\text{cool}})$，初始温度为 $T_0=3.0$。冷却时间尺度 $\\tau_{\\text{cool}}$ 在不同测试用例中有所变化。\n\n竞争发生在两个具有瞬时速率的过程中：\n1.  从非原生状态到原生状态的重排，这是一个活化过程，具有类阿伦尼乌斯速率：\n    $$\n    k_{\\text{rearr}}(t) = \\nu_r \\exp\\left(-\\frac{\\Delta E_{\\text{eff}}(t)}{T(t)}\\right)\n    $$\n    这里，$\\nu_r = 0.3$ 是一个尝试频率。有效活化能垒 $\\Delta E_{\\text{eff}}(t)$ 是在当前约束影响下，鞍点（$x \\approx 0$）与非原生最小值（$x \\approx +1$）之间的能量差。问题提供了简化表达式：\n    $$\n    \\Delta E_{\\text{eff}}(t) = (a - \\delta) + w(t)\n    $$\n    这是从 $\\Delta E_0 = U_0(0) - U_0(+1) = a - \\delta$ 和 $\\Delta R = R(0) - R(+1) = 1$ 推导出来的。$w(t)$ 项表明，收紧的约束增加了逃离非原生盆地的势垒。\n\n2.  对非原生状态的过度受缚，这是一个捕获过程，其速率被建模为与约束强度成正比：\n    $$\n    k_{\\text{commit}}(t) = c\\,w(t)\n    $$\n    比例常数为 $c = 0.01$。这个唯象项反映了这样一种思想，即更强的约束会导致更快的局部弛豫，从而有更高的几率被锁定在错误的状态。\n\n在时间 $N$ 之前，重排先于过度受缚发生的概率由竞争性泊松过程中首达时间概率的标准公式给出：\n$$\nP_{\\text{rearr}}(N) = \\int_0^N k_{\\text{rearr}}(t) \\exp\\left(-\\int_0^t \\left[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\right] du\\right) dt\n$$\n指数项代表“存活概率”，即在时间 $t$ 之前两个事件都未发生的概率。$k_{\\text{rearr}}(t)$ 项是在时间 $t$ 发生重排事件的概率密度。该积分将这些概率在整个区间 $[0, N]$ 上求和。\n\n任务是使用数值近似来计算这个量，其中积分被替换为离散时间步长 $\\Delta t=1$ 上的求和：\n$$\nP_{\\text{rearr}}(N) \\approx \\sum_{t=0}^{N-1} k_{\\text{rearr}}(t) \\exp\\left(-\\sum_{u=0}^{t-1} \\left[k_{\\text{rearr}}(u) + k_{\\text{commit}}(u)\\right]\\right)\n$$\n这个计算针对三个不同的测试用例进行，这些用例改变了 $\\tau_{\\text{cool}}$ 和 $N$。一个高效的实现应避免嵌套循环结构，因为那将具有 $O(N^2)$ 的复杂度。取而代之的是，我们可以将所有 $t \\in [0, N-1]$ 的时间依赖速率预先计算为向量。设 $K(t) = k_{\\text{rearr}}(t) + k_{\\text{commit}}(t)$。内部和 $\\sum_{u=0}^{t-1} K(u)$ 可以通过首先计算 $K(t)$ 值的向量然后使用累积和操作来为所有 $t$ 高效地计算。最终结果则是各项 $k_{\\text{rearr}}(t) \\exp(-\\sum_{u=0}^{t-1} K(u))$ 的和。这种向量化方法的总时间复杂度为 $O(N)$，适用于指定的 $N$ 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_prearr(tau_cool, N, a, delta, w0, bw, tau_rest, T0, nu_r, c):\n    \"\"\"\n    Computes the probability of rearrangement P_rearr(N) using numerical discretization.\n\n    Args:\n        tau_cool (float): Cooling timescale.\n        N (int): Total number of Monte Carlo steps.\n        a (float): Parameter for the native double-well potential.\n        delta (float): Tilt parameter for the native double-well potential.\n        w0 (float): Initial restraint weight.\n        bw (float): Total increase in restraint weight.\n        tau_rest (float): Restraint-tightening timescale.\n        T0 (float): Initial temperature.\n        nu_r (float): Attempt frequency for rearrangement.\n        c (float): Proportionality constant for the commitment rate.\n\n    Returns:\n        float: The calculated probability P_rearr(N).\n    \"\"\"\n    # Use float64 for better precision in numerical sums and exponents.\n    t_steps = np.arange(N, dtype=np.float64)\n\n    # Calculate time-dependent temperature and restraint weight schedules\n    T_t = T0 * np.exp(-t_steps / tau_cool)\n    w_t = w0 + bw * (1.0 - np.exp(-t_steps / tau_rest))\n\n    # Calculate the effective energy barrier\n    # delta_E_eff(t) = (a - delta) + w(t)\n    delta_E0 = a - delta\n    delta_E_eff_t = delta_E0 + w_t\n\n    # Calculate the instantaneous rates for rearrangement and commitment\n    # The argument to np.exp is negative, so overflow is not a concern.\n    # Underflow to zero is handled correctly and is physically meaningful.\n    k_rearr_t = nu_r * np.exp(-delta_E_eff_t / T_t)\n    k_commit_t = c * w_t\n\n    # Total rate of any event occurring\n    K_t = k_rearr_t + k_commit_t\n\n    # The discrete approximation for the probability is:\n    # Sum_{t=0}^{N-1} k_rearr(t) * exp(-Sum_{u=0}^{t-1} K(u))\n    # We can compute this efficiently using vectorization.\n\n    # 1. Compute the inner sum for the survival probability exponent.\n    # inner_sum_at_t corresponds to Sum_{u=0}^{t-1} K(u)\n    inner_sum = np.zeros_like(K_t)\n    # np.cumsum(K_t) at index `i` is sum up to `i`. We need sum up to `i-1`.\n    inner_sum[1:] = np.cumsum(K_t[:-1])\n\n    # 2. Compute the survival probability S(t) = exp(-inner_sum_at_t)\n    survival_prob_t = np.exp(-inner_sum)\n\n    # 3. Compute the full term to be summed at each time step t\n    # This is k_rearr(t) * S(t), which is the probability density of\n    # rearranging at time t, given no event occurred before t.\n    summand_t = k_rearr_t * survival_prob_t\n\n    # 4. Sum all terms to get the total probability over the horizon N\n    # The time step Delta_t is 1, so it's a direct sum.\n    total_prob = np.sum(summand_t)\n\n    return total_prob\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    # All quantities are in nondimensional Monte Carlo units.\n    a = 20.0\n    delta = 0.25\n    w0 = 0.0\n    bw = 12.0\n    tau_rest = 200.0\n    T0 = 3.0\n    nu_r = 0.3\n    c = 0.01\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (tau_cool, N)\n    test_cases = [\n        (100.0, 4000),   # Case 1: happy path\n        (1000.0, 20000), # Case 2: overly slow cooling with extended schedule\n        (1.0, 4000),     # Case 3: extremely fast quench\n    ]\n\n    results = []\n    for tau_cool, N in test_cases:\n        p_rearr = calculate_prearr(tau_cool, N, a, delta, w0, bw, tau_rest, T0, nu_r, c)\n        results.append(p_rearr)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了单次退火运行的要点之后，我们需要将视角提升到整个搜索项目的高度。在有限的计算资源（如计算时间）下，我们面临一个经典的策略权衡：是应该进行几次非常缓慢、深入的退火模拟，还是应该进行大量快速、广泛的独立模拟？这个问题  将此权衡构建为一个资源分配优化问题。通过求解该问题，你将学会如何推导出在重启次数 $R$ 和单次运行时长 $L$ 之间取得最佳平衡，从而在给定的总计算预算内最大化找到全局最小值的总体概率。",
            "id": "3445986",
            "problem": "在一个使用模拟退火（SA）的分子动力学（MD）构象搜索工作流中，你有一个固定的总计算预算 $B$ 个基本积分步长，需要分配给 $R$ 次独立的 SA 重启和每次重启的退火长度 $L$。每次重启会产生一个确定性的 $L_{0}$ 步的初始化开销（用于恒温器重新初始化、速度随机化和局部最小化），之后 $L$ 步用于退火过程。因此，资源约束为 $R(L + L_{0}) = B$。假设各次重启在统计上是独立的，并且单次重启成功（在一次长度为 $L$ 的重启中发现真正的全局最小值）的概率的经验表征为\n$$\np(L) = 1 - \\exp\\!\\big(-a\\, L^{\\beta}\\big),\n$$\n其中 $a > 0$ 和 $0  \\beta \\le 1$ 是描述依赖于势能面的动力学的常数。仅使用重启的独立性和预算约束，从第一性原理推导出在预算 $B$ 内能够最大化至少有一次成功概率的分配方案 $(R,L)$，然后针对特定参数 $B = 2.5 \\times 10^{6}$、$L_{0} = 2.0 \\times 10^{3}$、$a = 7.5 \\times 10^{-4}$ 和 $\\beta = \\frac{1}{2}$ 计算最优重启次数。将你的最终答案表示为一个精确整数，该整数等于这些参数下连续最优解所隐含的最优重启次数 $R^{\\star}$（假设对于所提供的数据，$R^{\\star}$ 恰好是一个整数）。最终答案不需要单位。不要四舍五入，报告精确的整数。",
            "solution": "用户希望我解决以下问题：\n在一个使用模拟退火（SA）的分子动力学（MD）构象搜索工作流中，你有一个固定的总计算预算 $B$ 个基本积分步长，需要分配给 $R$ 次独立的 SA 重启和每次重启的退火长度 $L$。每次重启会产生一个确定性的 $L_{0}$ 步的初始化开销（用于恒温器重新初始化、速度随机化和局部最小化），之后 $L$ 步用于退火过程。因此，资源约束为 $R(L + L_{0}) = B$。假设各次重启在统计上是独立的，并且单次重启成功（在一次长度为 $L$ 的重启中发现真正的全局最小值）的概率的经验表征为\n$$\np(L) = 1 - \\exp\\!\\big(-a\\, L^{\\beta}\\big),\n$$\n其中 $a > 0$ 和 $0  \\beta \\le 1$ 是描述依赖于势能面的动力学的常数。仅使用重启的独立性和预算约束，从第一性原理推导出在预算 $B$ 内能够最大化至少有一次成功概率的分配方案 $(R,L)$，然后针对特定参数 $B = 2.5 \\times 10^{6}$、$L_{0} = 2.0 \\times 10^{3}$、$a = 7.5 \\times 10^{-4}$ 和 $\\beta = \\frac{1}{2}$ 计算最优重启次数。将你的最终答案表示为一个精确整数，该整数等于这些参数下连续最优解所隐含的最优重启次数 $R^{\\star}$（假设对于所提供的数据，$R^{\\star}$ 恰好是一个整数）。最终答案不需要单位。不要四舍五入，报告精确的整数。\n\n### 步骤 1：提取已知条件\n-   总计算预算：$B$\n-   独立 SA 重启次数：$R$\n-   每次重启的退火长度：$L$\n-   每次重启的初始化开销：$L_0$\n-   预算约束：$R(L + L_0) = B$\n-   单次重启成功概率：$p(L) = 1 - \\exp(-a L^{\\beta})$\n-   常数：$a > 0$, $0  \\beta \\le 1$\n-   具体参数值：$B = 2.5 \\times 10^{6}$，$L_0 = 2.0 \\times 10^{3}$，$a = 7.5 \\times 10^{-4}$，$\\beta = \\frac{1}{2}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在计算化学和优化理论领域具有科学依据。模拟退火是寻找全局最小值的一种标准启发式方法。该问题描述了在固定计算预算下，独立搜索次数（$R$）与每次搜索长度（$L$）之间的现实权衡。成功概率 $p(L)$ 的函数形式是一个合理的经验模型。该问题是自洽的，提供了所有必要的数据和约束条件。语言精确客观。没有矛盾、歧义或违反科学原理之处。\n\n### 步骤 3：结论与行动\n问题有效。将提供一个完整的、有理有据的解决方案。\n\n### 解题推导\n\n目标是最大化在 $R$ 次独立重启中至少取得一次成功的概率。长度为 $L$ 的单次重启的成功概率由 $p(L) = 1 - \\exp(-a L^{\\beta})$ 给出。因此，单次重启的失败概率为 $1 - p(L) = \\exp(-a L^{\\beta})$。\n\n由于 $R$ 次重启在统计上是独立的，所有 $R$ 次重启都失败的概率是它们各自失败概率的乘积：\n$$\nP_{\\text{all fail}} = (1 - p(L))^R = \\left( \\exp(-a L^{\\beta}) \\right)^R = \\exp(-R a L^{\\beta})\n$$\n至少有一次成功的概率 $P_{\\text{success}}$ 是所有重启都失败的补集：\n$$\nP_{\\text{success}}(R,L) = 1 - P_{\\text{all fail}} = 1 - \\exp(-R a L^{\\beta})\n$$\n为了最大化 $P_{\\text{success}}$，我们必须最大化指数项的参数 $R a L^{\\beta}$。由于 $a$ 是一个正常数，这等价于在预算约束 $R(L + L_0) = B$ 下最大化函数 $f(R,L) = R L^{\\beta}$。\n\n在此优化问题中，我们将 $R$ 和 $L$ 视为连续正变量。约束条件可以用来将一个变量表示为另一个变量的函数。让我们将 $L$ 表示为 $R$ 的函数：\n$$\nL(R) = \\frac{B}{R} - L_0\n$$\n对于一个有物理意义的退火过程，我们必须有 $L > 0$，这意味着 $\\frac{B}{R} > L_0$，即 $R  \\frac{B}{L_0}$。\n\n现在我们可以将被最大化的函数写成单变量 $R$ 的形式：\n$$\nf(R) = R \\left( \\frac{B}{R} - L_0 \\right)^{\\beta}\n$$\n为了找到最优重启次数 $R^{\\star}$，我们将 $f(R)$ 对 $R$ 求导，并令导数为零。我们使用微分的乘法法则，$\\frac{d}{dR}(uv) = u \\frac{dv}{dR} + v \\frac{du}{dR}$。令 $u(R) = R$ 和 $v(R) = (\\frac{B}{R} - L_0)^{\\beta}$。\n$$\n\\frac{du}{dR} = 1\n$$\n$$\n\\frac{dv}{dR} = \\beta \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} \\cdot \\left( -\\frac{B}{R^2} \\right)\n$$\n$f(R)$ 的导数是：\n$$\n\\frac{df}{dR} = (1) \\cdot \\left( \\frac{B}{R} - L_0 \\right)^{\\beta} + R \\cdot \\left[ \\beta \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} \\left( -\\frac{B}{R^2} \\right) \\right]\n$$\n令 $\\frac{df}{dR} = 0$ 以求极值：\n$$\n\\left( \\frac{B}{R} - L_0 \\right)^{\\beta} - \\frac{\\beta B}{R} \\left( \\frac{B}{R} - L_0 \\right)^{\\beta - 1} = 0\n$$\n由于 $L = \\frac{B}{R} - L_0 > 0$，我们可以将方程两边同除以 $(\\frac{B}{R} - L_0)^{\\beta - 1}$：\n$$\n\\left( \\frac{B}{R} - L_0 \\right) - \\frac{\\beta B}{R} = 0\n$$\n重新整理各项以求解 $R$：\n$$\n\\frac{B}{R} - \\frac{\\beta B}{R} = L_0\n$$\n$$\n\\frac{B}{R} (1 - \\beta) = L_0\n$$\n这就得出了最优重启次数 $R^{\\star}$：\n$$\nR^{\\star} = \\frac{B(1 - \\beta)}{L_0}\n$$\n该表达式给出了最优重启次数 $R^{\\star}$，它是预算 $B$、开销 $L_0$ 和动力学参数 $\\beta$ 的函数。值得注意的是，最优分配与参数 $a$ 无关。\n\n现在，我们代入给定的数值来计算 $R^{\\star}$ 的具体值：\n-   $B = 2.5 \\times 10^6$\n-   $L_0 = 2.0 \\times 10^3$\n-   $\\beta = \\frac{1}{2}$\n\n$$\nR^{\\star} = \\frac{(2.5 \\times 10^6) \\left(1 - \\frac{1}{2}\\right)}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{(2.5 \\times 10^6) \\left(\\frac{1}{2}\\right)}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{1.25 \\times 10^6}{2.0 \\times 10^3}\n$$\n$$\nR^{\\star} = \\frac{1.25}{2.0} \\times 10^{6-3}\n$$\n$$\nR^{\\star} = 0.625 \\times 10^3\n$$\n$$\nR^{\\star} = 625\n$$\n问题陈述要求假设 $R^{\\star}$ 是一个整数，而我们的计算结果恰好是 $625$。因此，最优重启次数是 $625$。",
            "answer": "$$\\boxed{625}$$"
        }
    ]
}