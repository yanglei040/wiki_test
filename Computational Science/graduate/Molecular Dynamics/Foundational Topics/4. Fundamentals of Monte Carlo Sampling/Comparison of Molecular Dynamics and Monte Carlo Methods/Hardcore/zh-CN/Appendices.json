{
    "hands_on_practices": [
        {
            "introduction": "本练习深入探讨了分子动力学（MD）与蒙特卡洛（MC）方法之间的一个根本区别：运动方程的积分。通过分析简谐振子的速度-Verlet算法，您将推导出限制MD模拟的稳定性判据，而这一概念在MC方法中是不存在的，从而阐明了含时模拟所特有的挑战与特性。",
            "id": "3403189",
            "problem": "考虑一个质量为 $m$ 的一维粒子，处于谐振子势 $U(x) = \\frac{1}{2} k x^{2}$ 中。设 $\\omega = \\sqrt{\\frac{k}{m}}$。由速度-Verlet积分器生成的分子动力学（MD）轨迹根据牛顿第二定律在离散时间 $t_{n} = n \\Delta t$ 更新位置和速度。从第一性原理（牛顿第二定律和速度-Verlet方法的定义）出发，完成以下任务：\n\n- 推导将状态向量 $y_{n} = \\begin{pmatrix} x_{n} \\\\ v_{n} \\end{pmatrix}$ 推进到 $y_{n+1}$ 的线性齐次递推关系（时间步长为 $\\Delta t$），并将其表示为 $y_{n+1} = M(\\Delta t) \\, y_{n}$ 的形式，其中 $M(\\Delta t)$ 是一个用 $\\omega$ 和 $\\Delta t$ 表示的显式 $2 \\times 2$ 放大矩阵。\n\n- 仅使用线性常系数递推的稳定性判据（即 $M(\\Delta t)$ 的谱半径不得超过 $1$ 以保证线性稳定性），推导此谐振子的速度-Verlet积分线性稳定的 $\\Delta t$ 条件。以 $\\omega$ 的闭式表达式报告最大稳定时间步长。\n\n- 从 $M(\\Delta t)$ 的特征值，求出离散振荡频率 $\\Omega(\\Delta t, \\omega)$，并确定积分器在小 $\\Delta t$ 情况下的领头阶相位误差。参考影子（修正）哈密顿量的存在，解释稳定性界限如何影响用于构型采样和能量守恒的MD准确性。\n\n- 在与蒙特卡洛（MC）方法比较的背景下，简要论证为何针对相同谐振子系统、以温度 $T$ 下的玻尔兹曼分布为目标的Metropolis算法，其提议步长尺度没有类似的线性稳定性限制，并解释提议步长大小影响MC准确性和效率的不同机制。\n\n以 $\\omega$ 的闭式表达式表示你的最终答案，即最大稳定时间步长。在最终数值答案中不要包含单位。无需四舍五入。",
            "solution": "所提出的问题是有效的，因为它在科学上基于经典力学和数值分析的原理，信息充分，问题明确，有唯一解，并且陈述客观。我们可以着手求解。\n\n该问题要求对应用于一维谐振子的速度-Verlet算法进行多部分分析，然后与Metropolis蒙特卡洛方法进行概念性比较。\n\n该系统是一个质量为 $m$ 的粒子，处于谐振子势 $U(x) = \\frac{1}{2} k x^2$ 中。运动方程由牛顿第二定律给出：\n$$F = m \\ddot{x} = -\\frac{dU}{dx} = -kx$$\n这可以根据角频率 $\\omega = \\sqrt{k/m}$ 改写为：\n$$\\ddot{x} + \\omega^2 x = 0$$\n任何时刻的加速度是位置的函数：$a(x) = -\\omega^2 x$。我们将时间 $t_n = n \\Delta t$ 时的加速度表示为 $a_n = a(x_n) = -\\omega^2 x_n$。\n\n**第一部分：推导放大矩阵**\n\n速度-Verlet积分器包含以下对位置 $x$ 和速度 $v$ 在一个时间步长 $\\Delta t$ 内的更新步骤：\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{1}{2} a_n (\\Delta t)^2$$\n$$v_{n+1} = v_n + \\frac{1}{2} (a_n + a_{n+1}) \\Delta t$$\n我们将把这些更新表示为对状态向量 $y_n = \\begin{pmatrix} x_n \\\\ v_n \\end{pmatrix}$ 的矩阵变换形式。\n\n首先，我们将 $a_n = -\\omega^2 x_n$ 代入位置更新方程：\n$$x_{n+1} = x_n + v_n \\Delta t - \\frac{1}{2} \\omega^2 x_n (\\Delta t)^2$$\n$$x_{n+1} = \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + (\\Delta t) v_n$$\n这个方程提供了放大矩阵 $M(\\Delta t)$ 的第一行。\n\n接下来，我们处理速度更新。这需要下一个时间步的加速度 $a_{n+1} = -\\omega^2 x_{n+1}$。我们代入刚才推导出的 $x_{n+1}$ 的表达式：\n$$a_{n+1} = -\\omega^2 \\left[ \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + (\\Delta t) v_n \\right]$$\n现在，将 $a_n$ 和 $a_{n+1}$ 都代入速度更新方程：\n$$v_{n+1} = v_n + \\frac{1}{2} \\Delta t \\left( -\\omega^2 x_n - \\omega^2 \\left[ \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + (\\Delta t) v_n \\right] \\right)$$\n$$v_{n+1} = v_n - \\frac{\\omega^2 \\Delta t}{2} \\left( x_n + \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + (\\Delta t) v_n \\right)$$\n$$v_{n+1} = v_n - \\frac{\\omega^2 \\Delta t}{2} \\left( \\left(2 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) x_n + (\\Delta t) v_n \\right)$$\n展开各项得到：\n$$v_{n+1} = -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}\\omega^2 (\\Delta t)^2\\right) x_n + \\left(1 - \\frac{1}{2}\\omega^2 (\\Delta t)^2\\right) v_n$$\n这提供了放大矩阵的第二行。\n\n结合 $x_{n+1}$ 和 $v_{n+1}$ 的表达式，我们可以写出完整的递推关系：\n$$ y_{n+1} = \\begin{pmatrix} x_{n+1} \\\\ v_{n+1} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{1}{2}(\\omega \\Delta t)^2  \\Delta t \\\\ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}(\\omega \\Delta t)^2\\right)  1 - \\frac{1}{2}(\\omega \\Delta t)^2 \\end{pmatrix} \\begin{pmatrix} x_n \\\\ v_n \\end{pmatrix} $$\n因此，放大矩阵为：\n$$ M(\\Delta t) = \\begin{pmatrix} 1 - \\frac{1}{2}(\\omega \\Delta t)^2  \\Delta t \\\\ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}(\\omega \\Delta t)^2\\right)  1 - \\frac{1}{2}(\\omega \\Delta t)^2 \\end{pmatrix} $$\n\n**第二部分：推导稳定性条件**\n\n线性稳定性要求放大矩阵的谱半径 $\\rho(M) = \\max_i |\\lambda_i|$ 不超过 $1$。$M$ 的特征值 $\\lambda$ 可从特征方程 $\\det(M - \\lambda I) = 0$ 求得。\n令 $c = 1 - \\frac{1}{2}(\\omega \\Delta t)^2$。特征方程为：\n$$ (c - \\lambda)^2 - (\\Delta t) \\left[ -\\omega^2 \\Delta t \\left(1 - \\frac{1}{4}(\\omega \\Delta t)^2\\right) \\right] = 0 $$\n$$ (c - \\lambda)^2 = - (\\omega \\Delta t)^2 \\left(1 - \\frac{1}{4}(\\omega \\Delta t)^2\\right) $$\n$$ \\lambda - c = \\pm i (\\omega \\Delta t) \\sqrt{1 - \\frac{1}{4}(\\omega \\Delta t)^2} $$\n特征值为：\n$$ \\lambda_{\\pm} = 1 - \\frac{1}{2}(\\omega \\Delta t)^2 \\pm i (\\omega \\Delta t) \\sqrt{1 - \\frac{1}{4}(\\omega \\Delta t)^2} $$\n稳定性取决于平方根下项的性质。\n\n情况1：$1 - \\frac{1}{4}(\\omega \\Delta t)^2 \\ge 0$，这意味着 $(\\omega \\Delta t)^2 \\le 4$，或 $\\omega \\Delta t \\le 2$。\n在这种情况下，特征值是一对复共轭。每个特征值的模长的平方是：\n$$ |\\lambda|^2 = \\left(1 - \\frac{1}{2}(\\omega \\Delta t)^2\\right)^2 + \\left((\\omega \\Delta t) \\sqrt{1 - \\frac{1}{4}(\\omega \\Delta t)^2}\\right)^2 $$\n$$ |\\lambda|^2 = \\left(1 - (\\omega \\Delta t)^2 + \\frac{1}{4}(\\omega \\Delta t)^4\\right) + (\\omega \\Delta t)^2 \\left(1 - \\frac{1}{4}(\\omega \\Delta t)^2\\right) $$\n$$ |\\lambda|^2 = 1 - (\\omega \\Delta t)^2 + \\frac{1}{4}(\\omega \\Delta t)^4 + (\\omega \\Delta t)^2 - \\frac{1}{4}(\\omega \\Delta t)^4 = 1 $$\n因此，对于所有 $\\omega \\Delta t \\le 2$ 的情况，$|\\lambda| = 1$。在该区域内，该方法是稳定的。\n\n情况2：$\\omega \\Delta t > 2$。\n在这种情况下，平方根下的项为负，特征值变为实数：\n$$ \\lambda_{\\pm} = 1 - \\frac{1}{2}(\\omega \\Delta t)^2 \\pm (\\omega \\Delta t) \\sqrt{\\frac{1}{4}(\\omega \\Delta t)^2 - 1} $$\n考虑特征值 $\\lambda_{-}$。由于 $\\omega \\Delta t > 2$，项 $1 - \\frac{1}{2}(\\omega \\Delta t)^2$ 小于 $1 - \\frac{1}{2}(4) = -1$。第二项也是负的。因此，$\\lambda_{-}  -1$，且 $|\\lambda_{-}| > 1$。\n谱半径 $\\rho(M)$ 大于 $1$，积分不稳定。\n\n稳定性边界恰好在 $\\omega \\Delta t = 2$。因此，线性稳定性的条件是 $\\omega \\Delta t \\le 2$。最大稳定时间步长为：\n$$ \\Delta t_{\\text{max}} = \\frac{2}{\\omega} $$\n这对应于每个振荡周期 $T = 2\\pi/\\omega$ 大约3个积分步，因为 $ T / \\Delta t_{\\text{max}} = \\pi \\approx 3.14$。\n\n**第三部分：离散频率、相位误差及其影响**\n\n在稳定区域内，特征值为 $\\lambda_{\\pm} = \\exp(\\pm i \\Omega \\Delta t)$，其中 $\\Omega$ 是离散（数值）频率。矩阵的迹为 $\\text{Tr}(M) = \\lambda_{+} + \\lambda_{-} = 2 \\cos(\\Omega \\Delta t)$。从我们的矩阵 $M$ 可知，$\\text{Tr}(M) = 2 \\left(1 - \\frac{1}{2}(\\omega \\Delta t)^2\\right)$。令两者相等：\n$$ 2 \\cos(\\Omega \\Delta t) = 2 - (\\omega \\Delta t)^2 $$\n$$ \\cos(\\Omega \\Delta t) = 1 - \\frac{1}{2}(\\omega \\Delta t)^2 $$\n该方程隐式定义了 $\\Omega$。对于小的 $\\Delta t$，我们可以找到领头阶误差。我们使用 $\\cos(\\theta) = 1 - \\theta^2/2! + \\theta^4/4! - \\dots$ 的泰勒级数。令 $\\theta = \\Omega \\Delta t$ 且 $z = \\omega \\Delta t$。\n$$ 1 - \\frac{(\\Omega \\Delta t)^2}{2} + \\frac{(\\Omega \\Delta t)^4}{24} - \\dots = 1 - \\frac{(\\omega \\Delta t)^2}{2} $$\n假设对于小 $\\Delta t$，$\\Omega \\approx \\omega$，我们可以在一阶修正项中近似 $(\\Omega \\Delta t)^4 \\approx (\\omega \\Delta t)^4$：\n$$ \\frac{(\\Omega \\Delta t)^2}{2} \\approx \\frac{(\\omega \\Delta t)^2}{2} + \\frac{(\\omega \\Delta t)^4}{24} $$\n$$ \\Omega^2 \\approx \\omega^2 \\left(1 + \\frac{(\\omega \\Delta t)^2}{12}\\right) $$\n$$ \\Omega \\approx \\omega \\sqrt{1 + \\frac{(\\omega \\Delta t)^2}{12}} \\approx \\omega \\left(1 + \\frac{(\\omega \\Delta t)^2}{24}\\right) $$\n领头阶相对相位误差为 $(\\Omega - \\omega) / \\omega = (\\omega \\Delta t)^2 / 24$。这是一个相位超前，意味着数值振荡器比真实振荡器稍快。\n\n稳定性界限和准确性具有重要意义。速度-Verlet算法是辛算法，这意味着对于稳定区域内的任何 $\\Delta t$，数值轨迹都精确地守恒一个与真实哈密顿量 $H$ 相近的“影子哈密顿量” $H_{\\text{shadow}}$。误差为 $H_{\\text{shadow}} - H = O((\\Delta t)^2)$。这确保了优异的长期能量守恒（无漂移），真实能量 $H$ 只有有界振荡。\n然而，构型采样的准确性要求 $H_{\\text{shadow}}$ 是 $H$ 的良好近似，这仅在 $\\Delta t \\ll \\Delta t_{\\text{max}}$ 时才成立。当 $\\Delta t$ 接近稳定性极限 $2/\\omega$ 时，相位误差变大，轨迹显著偏离真实动力学，即使它仍然保持在一个受扰动的（影子）恒定能量面上。对于计算静态性质，这可能是可容忍的，但对于时间相关性质，这种相位误差会引入显著的不准确性。\n\n**第四部分：与蒙特卡洛方法的比较**\n\n相同谐振子系统的Metropolis蒙特卡洛（MC）模拟旨在生成一系列遵循玻尔兹曼分布 $P(x) \\propto \\exp(-U(x)/k_B T)$ 的位置 $x$。一个提议移动被提出，$x_{\\text{trial}} = x_{\\text{old}} + \\delta$，其中 $\\delta$ 是一个随机位移。该移动以概率 $p_{\\text{acc}} = \\min(1, \\exp(-\\Delta U/k_B T))$ 被接受。\n\n此过程没有与MD的线性稳定性限制相类似的概念，原因如下：\n1.  **随机动力学与确定性动力学**：MD积分一个确定性的运动方程。大的时间步长会导致离散化误差灾难性地放大，从而导致不稳定。MC生成一个随机马尔可夫链。没有会变得不稳定的“动力学”。\n2.  **内置的稳定机制**：接受准则 $\\min(1, \\exp(-\\Delta U/k_B T))$ 内在地防止系统“爆炸”。一个非常大的提议步长 $\\delta$ 很可能导致一个大的正能量变化 $\\Delta U$，使得接受概率 $\\exp(-\\Delta U/k_B T)$ 趋近于零。系统将仅仅拒绝该移动并保持在其当前的有限能量状态。不存在无界能量增长的机制。\n\nMC中的提议步长大小不影响稳定性，但深刻地影响**效率**。\n-   如果提议步长太小，几乎所有的移动都被接受，但系统探索构型空间非常缓慢（连续状态之间的高度相关性）。\n-   如果提议步长太大，几乎所有的移动都被拒绝，系统探索构型空间也非常缓慢（它停留在同一状态）。\nMC模拟的效率通过调整提议步长以达到一个适度的接受率（通常在 $20-50\\%$ 范围内）来优化，这最大化了状态的去相关速率，并允许快速探索相空间。这通过减少计算平均值的统计误差来影响有限长度模拟的实际“准确性”。",
            "answer": "$$\\boxed{\\frac{2}{\\omega}}$$"
        },
        {
            "introduction": "分子动力学（MD）本身在物理时间内运行，而蒙特卡洛（MC）轨迹则是一系列没有内在时间尺度的状态序列。本练习通过展示如何根据一个物理过程（布朗动力学）来校准MC模拟，从而提供了一个强大的概念桥梁。这使您能够为MC步赋予一个“有效时间”，从而实现与MD更直接的比较。",
            "id": "3403190",
            "problem": "考虑一个质量为 $m$ 的单个粒子，在 $d$ 维空间中进行过阻尼随机运动。在过阻尼极限下，基于高摩擦和可忽略惯性的假设，布朗动力学（BD）可由朗之万方程导出。爱因斯坦关系式给出了均方位移 $\\langle r^{2}(t)\\rangle = 2 d D t$，其中 $D$ 是扩散系数，$t$ 是时间。在马尔可夫链蒙特卡洛（MC）模拟中，可以从一个各向同性的分布中独立抽取试探位移 $\\delta \\mathbf{r}$。假设每个分量的提议步长服从均值为零、方差为 $\\Delta^{2}$ 的高斯分布（因此总步长平方的期望值为 $d \\Delta^{2}$），并且每次尝试的接受概率是一个常数 $0  \\alpha \\leq 1$，该常数概括了相互作用的效应。每次 MC 尝试都会产生一个恒定的计算成本 $c_{\\mathrm{MC}}$ 秒，无论该尝试是否被接受。\n\n您的任务是：\n\n- 根据基本定义，推导出每次 MC 尝试在单位中央处理器（CPU）时间内累积的期望均方位移，将其表示为 $d$、$D$、$\\Delta$、$\\alpha$ 和 $c_{\\mathrm{MC}}$ 的函数。\n- 强制要求 MC 算法通过匹配单位 CPU 时间内的 MC 均方位移与 BD 均方位移速率来模拟 BD。根据此要求，推导出提议方差参数 $\\Delta$ 的校准公式，用 $D$、$\\alpha$ 和 $c_{\\mathrm{MC}}$ 表示。\n- 使用爱因斯坦关系式，推导出有效时间映射 $t_{\\mathrm{eff}}(N)$，该映射为包含 $N$ 次 MC 尝试的轨迹分配一个等效的 BD 时间，用 $D$、$\\Delta$、$\\alpha$ 和 $N$ 表示。解释其与维度 $d$ 的任何依赖性或独立性。\n- 证明使用校准后的 $\\Delta$，$t_{\\mathrm{eff}}(N)$ 可以简化为一种形式，使得 MC 轨迹能以挂钟时间单位进行直接解释。\n\n在实现方面，编写一个完整的可运行程序，对下面测试套件中的每个参数元组 $(d, D, c_{\\mathrm{MC}}, \\alpha, N)$，计算两个输出：校准后的提议尺度 $\\Delta$ 和对应于 $N$ 次 MC 尝试的有效时间 $t_{\\mathrm{eff}}(N)$。使用以下测试套件，其中 $D$ 的单位为 $\\mathrm{m}^{2}/\\mathrm{s}$，$c_{\\mathrm{MC}}$ 的单位为 $\\mathrm{s}$/次尝试，$\\alpha$ 是无单位的小数，而 $N$ 是整数：\n\n- 情况 1：$d = 3$, $D = 1.0 \\times 10^{-12}\\ \\mathrm{m}^{2}/\\mathrm{s}$, $c_{\\mathrm{MC}} = 5.0 \\times 10^{-7}\\ \\mathrm{s}$, $\\alpha = 0.8$, $N = 100000$。\n- 情况 2：$d = 2$, $D = 2.5 \\times 10^{-9}\\ \\mathrm{m}^{2}/\\mathrm{s}$, $c_{\\mathrm{MC}} = 1.0 \\times 10^{-5}\\ \\mathrm{s}$, $\\alpha = 0.2$, $N = 5000$。\n- 情况 3：$d = 1$, $D = 1.0 \\times 10^{-10}\\ \\mathrm{m}^{2}/\\mathrm{s}$, $c_{\\mathrm{MC}} = 1.0 \\times 10^{-4}\\ \\mathrm{s}$, $\\alpha = 0.01$, $N = 100$。\n- 情况 4：$d = 3$, $D = 1.0 \\times 10^{-11}\\ \\mathrm{m}^{2}/\\mathrm{s}$, $c_{\\mathrm{MC}} = 1.0 \\times 10^{-6}\\ \\mathrm{s}$, $\\alpha = 0.5$, $N = 0$。\n\n您的程序应输出单行，其中包含一个逗号分隔的对列表，每个测试用例对应一对，每对本身也写成方括号内的逗号分隔列表。每对的第一个元素必须是单位为 $\\mathrm{m}$ 的 $\\Delta$，第二个元素必须是单位为 $\\mathrm{s}$ 的 $t_{\\mathrm{eff}}(N)$。例如，您的输出格式必须类似于 $[[\\Delta_{1},t_{\\mathrm{eff},1}],[\\Delta_{2},t_{\\mathrm{eff},2}],\\ldots]$，在同一行上，无额外空格。",
            "solution": "该问题要求推导蒙特卡洛（MC）模拟参数与布朗动力学（BD）物理参数之间的关系，然后实现所推导的公式。对问题陈述的验证确认了其科学上的合理性、问题的良定性，并包含了所有必要信息。\n\n推导过程按要求分四步进行。\n\n**1. MC 中单位 CPU 时间的期望均方位移**\n\n在马尔可夫链蒙特卡洛（MC）模拟中，粒子的位置通过一系列试探移动进行更新。对于每次尝试，都会提出一个试探位移 $\\delta \\mathbf{r}$。此移动以恒定概率 $\\alpha$ 被接受，得到新位置 $\\mathbf{r}' = \\mathbf{r} + \\delta \\mathbf{r}$。此移动以概率 $1 - \\alpha$ 被拒绝，位置保持不变，即 $\\mathbf{r}' = \\mathbf{r}$。\n\n让我们计算单次 MC 尝试的期望平方位移。如果移动被接受，平方位移为 $|\\delta \\mathbf{r}|^2$；如果被拒绝，则为 $0$。因此，单次尝试的期望值 $\\langle (\\Delta \\mathbf{r})^2 \\rangle_{\\text{attempt}}$ 为：\n$$ \\langle (\\Delta \\mathbf{r})^2 \\rangle_{\\text{attempt}} = \\alpha \\cdot E[|\\delta \\mathbf{r}|^2] + (1 - \\alpha) \\cdot 0 = \\alpha E[|\\delta \\mathbf{r}|^2] $$\n问题陈述，试探位移的每个分量 $\\delta r_i$（其中 $i=1, \\ldots, d$）均从一个均值为零、方差为 $\\Delta^2$ 的各向同性高斯分布中抽取。这样一个分量平方的期望值为 $E[(\\delta r_i)^2] = \\text{Var}(\\delta r_i) + (E[\\delta r_i])^2 = \\Delta^2 + 0^2 = \\Delta^2$。\n\n提议步长的总平方大小为 $|\\delta \\mathbf{r}|^2 = \\sum_{i=1}^{d} (\\delta r_i)^2$。根据期望的线性性质，其期望值为：\n$$ E[|\\delta \\mathbf{r}|^2] = E\\left[\\sum_{i=1}^{d} (\\delta r_i)^2\\right] = \\sum_{i=1}^{d} E[(\\delta r_i)^2] = \\sum_{i=1}^{d} \\Delta^2 = d\\Delta^2 $$\n将其代回，每次 MC 尝试的期望平方位移为：\n$$ \\langle (\\Delta \\mathbf{r})^2 \\rangle_{\\text{attempt}} = \\alpha d \\Delta^2 $$\n每次尝试产生 $c_{\\mathrm{MC}}$ 秒的计算成本。因此，单位 CPU 时间内累积的期望均方位移（MSD），记为 $\\mathcal{R}_{\\mathrm{MC}}$，是每次尝试的期望 MSD 除以每次尝试的成本：\n$$ \\mathcal{R}_{\\mathrm{MC}} = \\frac{\\langle (\\Delta \\mathbf{r})^2 \\rangle_{\\text{attempt}}}{c_{\\mathrm{MC}}} = \\frac{\\alpha d \\Delta^2}{c_{\\mathrm{MC}}} $$\n该表达式给出了 MC 模拟中 MSD 累积的速率，单位为 $(\\text{长度})^2 / (\\text{CPU 时间})$。\n\n**2. 提议方差参数 $\\Delta$ 的校准**\n\n为了模拟布朗动力学（BD），我们必须将 MC 模拟的长期扩散行为与 BD 的行为相匹配。对于 BD，爱因斯坦关系式给出了作为物理时间 $t$ 函数的均方位移：\n$$ \\langle r^2(t) \\rangle_{\\mathrm{BD}} = 2 d D t $$\n其中 $D$ 是扩散系数。BD 在物理时间内的 MSD 累积速率为：\n$$ \\mathcal{R}_{\\mathrm{BD}} = \\frac{d}{dt} \\langle r^2(t) \\rangle_{\\mathrm{BD}} = \\frac{d}{dt}(2 d D t) = 2dD $$\n问题要求通过将 MC 单位 CPU 时间的 MSD 累积速率与 BD 单位物理时间的 MSD 累积速率相等来校准 MC 模拟。这建立了一种对应关系，即模拟中的一个单位 CPU 时间对应于一个单位的物理时间。\n$$ \\mathcal{R}_{\\mathrm{MC}} = \\mathcal{R}_{\\mathrm{BD}} $$\n$$ \\frac{\\alpha d \\Delta^2}{c_{\\mathrm{MC}}} = 2dD $$\n我们可以求解这个方程以得到提议方差参数 $\\Delta$。维度 $d$ 从两侧消去：\n$$ \\alpha \\Delta^2 = 2 D c_{\\mathrm{MC}} $$\n$$ \\Delta^2 = \\frac{2 D c_{\\mathrm{MC}}}{\\alpha} $$\n由于 $\\Delta$ 代表一个尺度（标准差），我们取正平方根：\n$$ \\Delta = \\sqrt{\\frac{2 D c_{\\mathrm{MC}}}{\\alpha}} $$\n这就是提议尺度 $\\Delta$ 的校准值，它使得以 CPU 时间度量的 MC 模拟的扩散行为等效于物理上的 BD 过程。\n\n**3. 有效时间映射 $t_{\\mathrm{eff}}(N)$**\n\n通过将 MC 模拟中累积的总 MSD 与 BD 过程在该有效时间内的 MSD 相等，可以为 $N$ 次 MC 尝试的轨迹分配一个有效物理时间 $t_{\\mathrm{eff}}(N)$。\n\n$N$ 次独立的 MC 尝试后的总期望 MSD 为：\n$$ \\langle r^2(N) \\rangle_{\\mathrm{MC}} = N \\cdot \\langle (\\Delta \\mathbf{r})^2 \\rangle_{\\text{attempt}} = N \\alpha d \\Delta^2 $$\n持续时间为 $t_{\\mathrm{eff}}$ 的 BD 过程的 MSD 为：\n$$ \\langle r^2(t_{\\mathrm{eff}}) \\rangle_{\\mathrm{BD}} = 2 d D t_{\\mathrm{eff}}(N) $$\n令两个 MSD 相等，得到：\n$$ N \\alpha d \\Delta^2 = 2 d D t_{\\mathrm{eff}}(N) $$\n求解 $t_{\\mathrm{eff}}(N)$：\n$$ t_{\\mathrm{eff}}(N) = \\frac{N \\alpha \\Delta^2}{2D} $$\n这个有效时间的表达式依赖于 MC 参数 $N$、$\\alpha$ 和 $\\Delta$，以及物理参数 $D$。值得注意的是，它与空间维度 $d$ 无关。这种独立性是因为对于各向同性系统，MC 和 BD 的均方位移都与 $d$ 呈线性关系，导致因子 $d$ 在推导过程中被消去。\n\n**4. 使用校准后的 $\\Delta$ 简化 $t_{\\mathrm{eff}}(N)$**\n\n现在，我们将第 2 步中校准的 $\\Delta^2$ 表达式代入第 3 步中的 $t_{\\mathrm{eff}}(N)$ 公式。\n校准的 $\\Delta^2$ 为 $\\Delta^2 = \\frac{2 D c_{\\mathrm{MC}}}{\\alpha}$。\n有效时间为 $t_{\\mathrm{eff}}(N) = \\frac{N \\alpha \\Delta^2}{2D}$。\n代入：\n$$ t_{\\mathrm{eff}}(N) = \\frac{N \\alpha}{2D} \\left( \\frac{2 D c_{\\mathrm{MC}}}{\\alpha} \\right) $$\n分子和分母中的项 $2D$ 被消去，接受概率 $\\alpha$ 也被消去。这导出了一个非常简单的结果：\n$$ t_{\\mathrm{eff}}(N) = N c_{\\mathrm{MC}} $$\n这个结果表明，当 MC 提议宽度 $\\Delta$ 被正确校准时，由 $N$ 次 MC 尝试模拟的有效物理时间恰好等于在这些尝试上花费的总 CPU 时间（$T_{\\mathrm{CPU}} = N c_{\\mathrm{MC}}$）。这种直接的对应关系使得人们能够以物理时间单位来解释 MC 模拟的计算成本，这是将模拟结果与实验时间尺度进行比较的关键环节。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the calibrated MC proposal scale (Delta) and the effective\n    time (t_eff) for a series of test cases based on derived formulas\n    linking Monte Carlo and Brownian Dynamics simulations.\n    \"\"\"\n    # Test suite: (d, D, c_MC, alpha, N)\n    # D is in m^2/s, c_MC is in s, alpha is unitless, N is an integer.\n    test_cases = [\n        # Case 1\n        (3, 1.0e-12, 5.0e-7, 0.8, 100000),\n        # Case 2\n        (2, 2.5e-9, 1.0e-5, 0.2, 5000),\n        # Case 3\n        (1, 1.0e-10, 1.0e-4, 0.01, 100),\n        # Case 4\n        (3, 1.0e-11, 1.0e-6, 0.5, 0),\n    ]\n\n    results = []\n    for case in test_cases:\n        d, D, c_mc, alpha, N = case\n\n        # Task 2: Calculate the calibrated proposal scale Delta.\n        # Formula: Delta = sqrt(2 * D * c_mc / alpha)\n        # The dimension 'd' does not appear in this formula.\n        delta_squared = (2 * D * c_mc) / alpha\n        delta = np.sqrt(delta_squared)\n\n        # Task 4: Calculate the effective time t_eff(N) using the simplified form.\n        # Formula: t_eff(N) = N * c_mc\n        t_eff = N * c_mc\n\n        results.append([delta, t_eff])\n\n    # Format the output string as specified: [[Δ₁,t_eff,₁],[Δ₂,t_eff,₂],...]\n    # without any extra spaces.\n    output_parts = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(output_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "模拟的最终目标通常是高效地对构型空间进行采样并计算出精确的平均值。本实践练习将指导您计算有效样本量（$N_{\\mathrm{eff}}$），这是一个同时考虑了计算成本和统计相关性的关键指标。通过这个指标，您可以在固定的计算预算下，对MD和MC针对给定可观测量进行采样效率的量化比较。",
            "id": "3403222",
            "problem": "一个标量可观测量 $A$ 在每一步都被记录下来，这些数据分别来自对同一个正则系综进行采样的分子动力学 (MD) 轨迹和蒙特卡洛 (MC) 马尔可夫链。对于每种方法，长时间的初步运行产生了经验拟合的归一化离散自相关函数，其形式对于延迟 $k \\in \\{1,2,\\ldots\\}$ 如下\n$$\n\\rho^{\\mathrm{MD}}_{k} = p_{\\mathrm{MD}}\\, a_{\\mathrm{MD}}^{k} + \\left(1 - p_{\\mathrm{MD}}\\right)\\, b_{\\mathrm{MD}}^{k}, \\quad \\rho^{\\mathrm{MC}}_{k} = p_{\\mathrm{MC}}\\, a_{\\mathrm{MC}}^{k} + \\left(1 - p_{\\mathrm{MC}}\\right)\\, b_{\\mathrm{MC}}^{k},\n$$\n其经验确定的参数为\n$$\np_{\\mathrm{MD}} = 0.6,\\quad a_{\\mathrm{MD}} = 0.85,\\quad b_{\\mathrm{MD}} = 0.30,\\qquad p_{\\mathrm{MC}} = 0.5,\\quad a_{\\mathrm{MC}} = 0.50,\\quad b_{\\mathrm{MC}} = 0.10.\n$$\n假设两个时间序列都是平稳和遍历的，采样在每一步记录一个值，并且积分自相关可以通过上述拟合所隐含的对延迟的无穷求和很好地近似。MD 每步的计算成本为 $c_{\\mathrm{MD}} = 2.0 \\times 10^{-6}~\\mathrm{s}$，MC 每步的计算成本为 $c_{\\mathrm{MC}} = 3.0 \\times 10^{-6}~\\mathrm{s}$。在固定的墙钟时间预算 $W = 120~\\mathrm{s}$下，使用相关时间序列采样的第一性原理来估计在预算 $W$ 内的有效样本量 $N_{\\mathrm{eff},\\mathrm{MD}}$ 和 $N_{\\mathrm{eff},\\mathrm{MC}}$，然后计算效率比 $R = N_{\\mathrm{eff},\\mathrm{MD}} / N_{\\mathrm{eff},\\mathrm{MC}}$。将您最终的 $R$ 数值四舍五入到四位有效数字，并将其表示为一个无量纲数。",
            "solution": "问题要求计算在固定的总计算时间预算 $W$ 下运行的分子动力学 (MD) 和蒙特卡洛 (MC) 模拟的有效样本量之比，$R = N_{\\mathrm{eff},\\mathrm{MD}} / N_{\\mathrm{eff},\\mathrm{MC}}$。\n\n分析始于一个长度为 $N$ 的平稳遍历时间序列的有效样本量 $N_{\\mathrm{eff}}$ 的基本概念。由于样本之间的序列相关性，有效独立样本的数量会减少。这通过积分自相关时间 $\\tau_{\\mathrm{int}}$ 来量化，使得：\n$$\nN_{\\mathrm{eff}} = \\frac{N}{\\tau_{\\mathrm{int}}}\n$$\n积分自相关时间根据延迟为 $k$ 的离散归一化自相关函数 $\\rho_k$ 定义为：\n$$\n\\tau_{\\mathrm{int}} = 1 + 2 \\sum_{k=1}^{\\infty} \\rho_k\n$$\n问题为 MD 和 MC 方法都提供了 $\\rho_k$ 的函数形式，这使我们能够计算它们各自的积分自相关时间。\n\n首先，我们计算 $\\tau_{\\mathrm{int,MD}}$。自相关函数由下式给出：\n$$\n\\rho^{\\mathrm{MD}}_{k} = p_{\\mathrm{MD}}\\, a_{\\mathrm{MD}}^{k} + \\left(1 - p_{\\mathrm{MD}}\\right)\\, b_{\\mathrm{MD}}^{k}\n$$\n无穷和是两个几何级数的和。对于公比为 $r$ 且 $|r|  1$ 的几何级数，从 $k=1$ 到无穷大的和为 $\\sum_{k=1}^{\\infty} r^k = \\frac{r}{1-r}$。\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MD}}_{k} = \\sum_{k=1}^{\\infty} \\left[ p_{\\mathrm{MD}}\\, a_{\\mathrm{MD}}^{k} + \\left(1 - p_{\\mathrm{MD}}\\right)\\, b_{\\mathrm{MD}}^{k} \\right] = p_{\\mathrm{MD}} \\left( \\sum_{k=1}^{\\infty} a_{\\mathrm{MD}}^{k} \\right) + \\left(1 - p_{\\mathrm{MD}}\\right) \\left( \\sum_{k=1}^{\\infty} b_{\\mathrm{MD}}^{k} \\right)\n$$\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MD}}_{k} = p_{\\mathrm{MD}} \\frac{a_{\\mathrm{MD}}}{1 - a_{\\mathrm{MD}}} + \\left(1 - p_{\\mathrm{MD}}\\right) \\frac{b_{\\mathrm{MD}}}{1 - b_{\\mathrm{MD}}}\n$$\n代入给定的 MD 参数（$p_{\\mathrm{MD}} = 0.6$，$a_{\\mathrm{MD}} = 0.85$，$b_{\\mathrm{MD}} = 0.30$）：\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MD}}_{k} = (0.6) \\frac{0.85}{1 - 0.85} + (1 - 0.6) \\frac{0.30}{1 - 0.30} = (0.6) \\frac{0.85}{0.15} + (0.4) \\frac{0.30}{0.70}\n$$\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MD}}_{k} = (0.6) \\left(\\frac{17}{3}\\right) + (0.4) \\left(\\frac{3}{7}\\right) = \\frac{3}{5} \\cdot \\frac{17}{3} + \\frac{2}{5} \\cdot \\frac{3}{7} = \\frac{17}{5} + \\frac{6}{35} = \\frac{119}{35} + \\frac{6}{35} = \\frac{125}{35} = \\frac{25}{7}\n$$\n现在，我们求出 MD 的积分自相关时间：\n$$\n\\tau_{\\mathrm{int,MD}} = 1 + 2 \\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MD}}_{k} = 1 + 2 \\left(\\frac{25}{7}\\right) = 1 + \\frac{50}{7} = \\frac{7+50}{7} = \\frac{57}{7}\n$$\n\n接下来，我们对 MC 方法执行相同的计算。自相关函数为：\n$$\n\\rho^{\\mathrm{MC}}_{k} = p_{\\mathrm{MC}}\\, a_{\\mathrm{MC}}^{k} + \\left(1 - p_{\\mathrm{MC}}\\right)\\, b_{\\mathrm{MC}}^{k}\n$$\n代入 MC 的参数（$p_{\\mathrm{MC}} = 0.5$，$a_{\\mathrm{MC}} = 0.50$，$b_{\\mathrm{MC}} = 0.10$）：\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MC}}_{k} = p_{\\mathrm{MC}} \\frac{a_{\\mathrm{MC}}}{1 - a_{\\mathrm{MC}}} + \\left(1 - p_{\\mathrm{MC}}\\right) \\frac{b_{\\mathrm{MC}}}{1 - b_{\\mathrm{MC}}} = (0.5) \\frac{0.50}{1 - 0.50} + (1 - 0.5) \\frac{0.10}{1 - 0.10}\n$$\n$$\n\\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MC}}_{k} = (0.5) \\frac{0.5}{0.5} + (0.5) \\frac{0.1}{0.9} = (0.5)(1) + (0.5)\\left(\\frac{1}{9}\\right) = \\frac{1}{2}\\left(1 + \\frac{1}{9}\\right) = \\frac{1}{2}\\left(\\frac{10}{9}\\right) = \\frac{5}{9}\n$$\nMC 的积分自相关时间是：\n$$\n\\tau_{\\mathrm{int,MC}} = 1 + 2 \\sum_{k=1}^{\\infty} \\rho^{\\mathrm{MC}}_{k} = 1 + 2 \\left(\\frac{5}{9}\\right) = 1 + \\frac{10}{9} = \\frac{9+10}{9} = \\frac{19}{9}\n$$\n在墙钟时间预算 $W$ 内，以每步成本 $c$ 可以执行的总步数 $N$ 为 $N = W/c$。\n因此，对于 MD，$N_{\\mathrm{MD}} = W/c_{\\mathrm{MD}}$，对于 MC，$N_{\\mathrm{MC}} = W/c_{\\mathrm{MC}}$。\n\n那么有效样本量为：\n$$\nN_{\\mathrm{eff,MD}} = \\frac{N_{\\mathrm{MD}}}{\\tau_{\\mathrm{int,MD}}} = \\frac{W/c_{\\mathrm{MD}}}{\\tau_{\\mathrm{int,MD}}} = \\frac{W}{c_{\\mathrm{MD}} \\tau_{\\mathrm{int,MD}}}\n$$\n$$\nN_{\\mathrm{eff,MC}} = \\frac{N_{\\mathrm{MC}}}{\\tau_{\\mathrm{int,MC}}} = \\frac{W/c_{\\mathrm{MC}}}{\\tau_{\\mathrm{int,MC}}} = \\frac{W}{c_{\\mathrm{MC}} \\tau_{\\mathrm{int,MC}}}\n$$\n效率比 $R$ 是这些有效样本量之比：\n$$\nR = \\frac{N_{\\mathrm{eff,MD}}}{N_{\\mathrm{eff,MC}}} = \\frac{W / (c_{\\mathrm{MD}} \\tau_{\\mathrm{int,MD}})}{W / (c_{\\mathrm{MC}} \\tau_{\\mathrm{int,MC}})} = \\frac{c_{\\mathrm{MC}} \\tau_{\\mathrm{int,MC}}}{c_{\\mathrm{MD}} \\tau_{\\mathrm{int,MD}}}\n$$\n总预算 $W$ 被消掉，因为只要总模拟时间足够长，效率之比就与总模拟时间无关。\n我们代入给定的每步成本 $c_{\\mathrm{MD}} = 2.0 \\times 10^{-6}~\\mathrm{s}$ 和 $c_{\\mathrm{MC}} = 3.0 \\times 10^{-6}~\\mathrm{s}$，以及我们计算出的 $\\tau_{\\mathrm{int}}$ 值：\n$$\nR = \\frac{(3.0 \\times 10^{-6}) \\left(\\frac{19}{9}\\right)}{(2.0 \\times 10^{-6}) \\left(\\frac{57}{7}\\right)} = \\frac{3 \\cdot \\frac{19}{9}}{2 \\cdot \\frac{57}{7}} = \\frac{\\frac{19}{3}}{\\frac{114}{7}}\n$$\n由于 $114 = 6 \\times 19$，我们可以简化表达式：\n$$\nR = \\frac{19}{3} \\cdot \\frac{7}{114} = \\frac{19}{3} \\cdot \\frac{7}{6 \\cdot 19} = \\frac{7}{3 \\cdot 6} = \\frac{7}{18}\n$$\n为了提供数值答案，我们计算小数值并四舍五入到四位有效数字：\n$$\nR = \\frac{7}{18} \\approx 0.388888... \\approx 0.3889\n$$\n这个结果表明，对于给定的可观测量和系统，在固定的时间预算下，MC 模拟在生成独立样本方面的效率比 MD 模拟高，其效率大约是 MD 的 $1/R \\approx 2.57$ 倍。",
            "answer": "$$\n\\boxed{0.3889}\n$$"
        }
    ]
}