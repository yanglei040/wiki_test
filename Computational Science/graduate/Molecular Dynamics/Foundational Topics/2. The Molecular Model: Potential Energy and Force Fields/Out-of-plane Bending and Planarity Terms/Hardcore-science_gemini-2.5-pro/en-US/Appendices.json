{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any classical force field lies in its ability to accurately reproduce the potential energy surfaces of molecules. This first practice challenges you to think like a force field developer by designing a robust computational protocol for parameterizing an out-of-plane bending term. By evaluating different proposed methods, you will learn to distinguish rigorous scientific procedure from flawed approaches, focusing on how to correctly map a quantum mechanical energy landscape onto a simplified harmonic potential. Mastering this workflow is a fundamental skill for anyone looking to extend or customize molecular models .",
            "id": "3431323",
            "problem": "In classical molecular dynamics parameterization, the out-of-plane bending associated with an improper torsion angle is often modeled near a planar minimum by a harmonic term whose parameters must be obtained from the Born–Oppenheimer potential energy surface. Consider a model system such as acetamide, and let the out-of-plane angle $\\chi$ be the improper torsion constructed on four atoms $(i,j,k,l)$ such that atom $j$ is the atom whose deviation from the reference plane is penalized. Your goal is to select a protocol that, starting from the fundamental fact that small displacements from a minimum are governed by the second-order Taylor expansion of the potential energy with respect to the displacement coordinate, produces physically meaningful estimates of the curvature parameter $k_{\\chi}$ and the reference angle $\\chi_{0}$ for a planarity term. The protocol must be scientifically realistic: it should map the electronic potential energy surface in a neighborhood of the planar minimum, isolate the coordinate $\\chi$ by an appropriate constraint, handle unit consistency, and choose a sampling range and step that keep the deformation within the harmonic regime while providing enough data for a stable fit.\n\nWhich of the following protocols most appropriately achieves these aims for acetamide?\n\nA. Constrain the improper out-of-plane angle $\\chi$ about the planar amide group and perform a symmetric scan with $\\chi \\in [-25^\\circ, +25^\\circ]$ in $2.5^\\circ$ increments. At each value of $\\chi$, carry out a full geometry optimization of all other internal coordinates under the fixed-$\\chi$ constraint on the Born–Oppenheimer surface (for example, using Density Functional Theory (DFT) at $0\\,\\mathrm{K}$), record relative energies, convert $\\chi$ to radians, and fit the resulting energy profile to a quadratic function of $\\chi$ via least squares to obtain $k_{\\chi}$ (with units of energy per $\\mathrm{rad}^{2}$) and $\\chi_{0}$. Validate harmonicity by checking that adding a cubic term does not significantly improve the fit within the chosen range.\n\nB. Run an unconstrained molecular dynamics trajectory of acetamide for $1\\,\\mathrm{ns}$ at $300\\,\\mathrm{K}$, compute the histogram of $\\chi$ over the trajectory, and estimate $k_{\\chi}$ from the variance of $\\chi$ using equipartition, treating $\\chi$ in degrees. Take $\\chi_{0}$ as the mean of the distribution. No constraints or geometry optimizations are needed.\n\nC. Define the torsional dihedral $\\omega$ around the amide bond and scan $\\omega \\in [-90^\\circ, +90^\\circ]$ in $10^\\circ$ increments. At each $\\omega$, compute single-point energies without geometry optimization, and fit a sinusoidal function to determine $k_{\\chi}$ and $\\chi_{0}$.\n\nD. Constrain $\\chi$ only at $\\chi = 0^\\circ, 60^\\circ, 120^\\circ, 180^\\circ$, perform full geometry optimizations, and fit a cubic polynomial in degrees to extract $k_{\\chi}$ and $\\chi_{0}$.\n\nE. Constrain $\\chi \\in [-10^\\circ, +10^\\circ]$ at $0.5^\\circ$ increments, compute single-point energies (no relaxation of other coordinates), and perform a quadratic fit in degrees to obtain $k_{\\chi}$ and $\\chi_{0}$.\n\nSelect the best protocol.",
            "solution": "The objective is to determine the parameters for a harmonic potential energy term, $V(\\chi) = \\frac{1}{2}k_{\\chi}(\\chi - \\chi_0)^2$, which models the out-of-plane bending motion in a classical force field. This term must accurately represent the \"true\" potential energy landscape, as described by the Born-Oppenheimer potential energy surface (PES), for small displacements from the equilibrium geometry.\n\n1.  **Isolating the Degree of Freedom**: The potential energy of a molecule is a function of all its internal coordinates. To determine the potential associated *only* with the distortion $\\chi$, we must isolate its effect. The standard and correct method for this is a \"relaxed surface scan\" or \"constrained optimization\". In this procedure, the coordinate of interest, $\\chi$, is fixed at a specific value, and then the energy of the molecule is minimized with respect to all other internal coordinates (bond lengths, bond angles, etc.). This process is repeated for a series of values of $\\chi$. The resulting energies, $E(\\chi)$, represent the minimum energy of the system given the constraint on $\\chi$, thus defining the potential energy profile for that specific deformation. A \"rigid scan\", where only $\\chi$ is changed and all other coordinates are frozen, would yield an artificially steep potential and is incorrect for parameterizing a flexible model.\n\n2.  **Harmonic Approximation and Sampling**: The model is a harmonic term, valid for small displacements near the minimum. To determine the force constant $k_{\\chi}$ and equilibrium angle $\\chi_0$ by fitting, we must sample points in a range where the quadratic approximation is valid. This range should be symmetric around the expected minimum ($\\chi_0=0^\\circ$ for a planar group) to ensure a robust fit. A range of $\\pm 20^\\circ$ to $\\pm 30^\\circ$ is generally appropriate for such improper torsions, as it probes thermally accessible energies without venturing too far into anharmonic regions.\n\n3.  **Unit Consistency and Fitting**: The mathematical form of the harmonic potential requires the displacement $(\\chi - \\chi_0)$ to be in radians for the force constant $k_{\\chi}$ to have standard units of energy/radian$^2$. Therefore, the angle values in degrees must be converted to radians before performing a least-squares fit to the quadratic function $E = E_{min} + \\frac{1}{2}k_{\\chi}(\\chi-\\chi_0)^2$.\n\n**Option-by-Option Analysis**\n\n**A. Correct.** This protocol is scientifically rigorous and aligns perfectly with the principles derived above. It correctly uses a constrained scan with full geometry optimization (a relaxed scan) at each step. The scan range ($-25^\\circ$ to $+25^\\circ$) and step size ($2.5^\\circ$) are physically reasonable. It explicitly addresses the critical issue of unit consistency by converting angles to radians, ensuring $k_{\\chi}$ is obtained in the standard units. The final validation step demonstrates methodological rigor.\n\n**B. Incorrect.** This protocol is fundamentally flawed. Its basis, the equipartition theorem, is used to analyze the results of a simulation, not to generate the parameters for it. To run the molecular dynamics trajectory in the first place, one needs a force field, including a parameter for $k_{\\chi}$. Deriving $k_{\\chi}$ from a simulation that uses $k_{\\chi}$ is circular reasoning. Furthermore, it incorrectly suggests treating $\\chi$ in degrees, which would lead to a numerically incorrect value for $k_{\\chi}$.\n\n**C. Incorrect.** This protocol has multiple critical errors. It scans the wrong coordinate, the proper torsion $\\omega$ instead of the improper torsion $\\chi$. It uses single-point energies (\"rigid scan\"), which fails to properly isolate the potential energy profile by not allowing other geometric parameters to relax. Finally, it proposes fitting to a sinusoidal function, which is appropriate for a proper torsion but not for the specified harmonic out-of-plane potential.\n\n**D. Incorrect.** This protocol is physically unsound. The sampling points ($60^\\circ, 120^\\circ, 180^\\circ$) represent massive, high-energy deformations, far outside the harmonic region relevant for parameterizing small fluctuations around the planar minimum. The sampling is sparse and not symmetric. Fitting a cubic polynomial is also inappropriate for a symmetric harmonic potential.\n\n**E. Incorrect.** This protocol has a critical methodological flaw. While the scan range is reasonable, it specifies using single-point energies (a \"rigid scan\"). This approach does not allow the rest of the molecule to relax in response to the distortion, leading to an artificially high energy penalty and a significant overestimation of the force constant $k_{\\chi}$. A relaxed scan is required.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "A well-parameterized potential energy function is not just a descriptive model; it is a predictive tool. This exercise bridges the gap between the microscopic parameters of a potential function and macroscopic thermodynamic observables. Using the principles of statistical mechanics, you will calculate the free energy difference, $\\Delta G$, between the planar and pyramidal configurations of an amide group based on a simplified potential energy model. This practice highlights how the stiffness of the potential ($k$) and the height of energy barriers ($V_b$) directly influence conformational equilibria and the relative populations of different states at a given temperature .",
            "id": "3431280",
            "problem": "Consider a simplified one-dimensional model for the out-of-plane bending coordinate of an amide nitrogen, denoted by the signed improper angle $\\chi$ (in radians), where the planar configuration is centered at $\\chi=0$ and the two symmetry-related pyramidal configurations are centered at $\\chi=+\\chi_{0}$ and $\\chi=-\\chi_{0}$. Assume the potential energy in each basin can be approximated by a harmonic well, and that the two pyramidal wells have the same stiffness and the same energy offset relative to the planar minimum. Specifically, let the planar basin have $U_{\\text{pl}}(\\chi)=\\frac{1}{2}k_{\\text{impr}}\\chi^{2}$ with its minimum taken as zero reference energy, and let each pyramidal basin have $U_{\\text{py}}^{\\pm}(\\chi)=V_{b}+\\frac{1}{2}k_{\\text{py}}(\\chi\\mp\\chi_{0})^{2}$, where $V_{b}$ is the energy offset penalizing pyramidalization and $k_{\\text{py}}$ is the local curvature (stiffness) around the pyramidal minimum. Assume $\\chi_{0}$ is large enough that the harmonic neighborhoods do not overlap and the barrier region between basins contributes negligibly to the equilibrium thermodynamics when basins are treated independently.\n\nUsing the canonical ensemble at temperature $T$, start from the definition of the partition function for a continuous coordinate and the Boltzmann distribution. Treat each basin as an independent harmonic contribution and account for the twofold degeneracy of the pyramidal basins. Derive an analytic expression for the free energy difference $\\Delta G$ between the pyramidal and planar configurations, defined as $\\Delta G=G_{\\text{py}}-G_{\\text{pl}}$, and evaluate it numerically for the following parameters at temperature $T$: $k_{\\text{impr}}=400\\,\\mathrm{kJ\\,mol^{-1}\\,rad^{-2}}$, $k_{\\text{py}}=120\\,\\mathrm{kJ\\,mol^{-1}\\,rad^{-2}}$, $V_{b}=25\\,\\mathrm{kJ\\,mol^{-1}}$, and $T=298\\,\\mathrm{K}$. Express your final answer in $\\mathrm{kJ\\,mol^{-1}}$ and round to four significant figures. State clearly how the result depends on the improper stiffness $k_{\\text{impr}}$ and the barrier height $V_{b}$ through your derived expression. Angles must be treated in radians.",
            "solution": "The problem asks for the free energy difference, $\\Delta G = G_{\\text{py}} - G_{\\text{pl}}$, between the pyramidal and planar configurations of an amide nitrogen, modeled as a one-dimensional system. The derivation will be performed within the framework of the canonical ensemble.\n\nThe fundamental relationship between the Gibbs free energy $G$ of a state and its canonical partition function $Z$ at temperature $T$ is given by $G = -k_B T \\ln Z$, where $k_B$ is the Boltzmann constant. Since the parameters are given in molar units (e.g., $\\mathrm{kJ\\,mol^{-1}}$), we must use the molar gas constant $R$ instead of $k_B$. Thus, the expression becomes $G = -RT \\ln Z$. The partition function $Z$ for a one-dimensional continuous coordinate $\\chi$ with potential energy $U(\\chi)$ is given by the integral over all possible values of $\\chi$:\n$$Z = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{U(\\chi)}{RT}\\right) d\\chi$$\nHere, for convenience, we define $\\beta = \\frac{1}{RT}$.\n\nFirst, we calculate the partition function for the planar configuration, $Z_{\\text{pl}}$. The potential energy is given as $U_{\\text{pl}}(\\chi) = \\frac{1}{2}k_{\\text{impr}}\\chi^2$.\n$$Z_{\\text{pl}} = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2}k_{\\text{impr}}\\chi^2\\right) d\\chi$$\nThis is a standard Gaussian integral of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2) dx = \\sqrt{\\frac{\\pi}{a}}$. In our case, the constant $a$ is $\\frac{\\beta k_{\\text{impr}}}{2}$. Therefore, the partition function for the planar basin is:\n$$Z_{\\text{pl}} = \\sqrt{\\frac{\\pi}{\\frac{\\beta k_{\\text{impr}}}{2}}} = \\sqrt{\\frac{2\\pi}{\\beta k_{\\text{impr}}}}$$\n\nNext, we calculate the partition function for the pyramidal configuration, $Z_{\\text{py}}$. This configuration consists of two degenerate basins, one centered at $\\chi=+\\chi_0$ and the other at $\\chi=-\\chi_0$. The total partition function is the sum of the contributions from each basin, $Z_{\\text{py}} = Z_{\\text{py}}^{+} + Z_{\\text{py}}^{-}$.\n\nThe potential for the basin at $\\chi=+\\chi_0$ is $U_{\\text{py}}^{+}(\\chi) = V_b + \\frac{1}{2}k_{\\text{py}}(\\chi - \\chi_0)^2$. Its partition function is:\n$$Z_{\\text{py}}^{+} = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\left[V_b + \\frac{1}{2}k_{\\text{py}}(\\chi - \\chi_0)^2\\right]\\right) d\\chi$$\nWe can factor out the constant energy term $V_b$:\n$$Z_{\\text{py}}^{+} = \\exp(-\\beta V_b) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2}k_{\\text{py}}(\\chi - \\chi_0)^2\\right) d\\chi$$\nThis is another Gaussian integral. By performing a change of variables $y = \\chi - \\chi_0$, the integral becomes identical in form to the one for $Z_{\\text{pl}}$, but with $k_{\\text{py}}$ instead of $k_{\\text{impr}}$. The integral evaluates to $\\sqrt{\\frac{2\\pi}{\\beta k_{\\text{py}}}}$.\n$$Z_{\\text{py}}^{+} = \\exp(-\\beta V_b) \\sqrt{\\frac{2\\pi}{\\beta k_{\\text{py}}}}$$\nDue to symmetry, the partition function for the basin at $\\chi=-\\chi_0$, $Z_{\\text{py}}^{-}$, is identical to $Z_{\\text{py}}^{+}$. Therefore, the total partition function for the pyramidal state, accounting for its twofold degeneracy, is:\n$$Z_{\\text{py}} = Z_{\\text{py}}^{+} + Z_{\\text{py}}^{-} = 2 \\exp(-\\beta V_b) \\sqrt{\\frac{2\\pi}{\\beta k_{\\text{py}}}}$$\n\nNow we can derive the expression for the free energy difference $\\Delta G = G_{\\text{py}} - G_{\\text{pl}}$:\n$$\\Delta G = (-RT \\ln Z_{\\text{py}}) - (-RT \\ln Z_{\\text{pl}}) = -RT \\ln\\left(\\frac{Z_{\\text{py}}}{Z_{\\text{pl}}}\\right)$$\nLet's compute the ratio of the partition functions:\n$$\\frac{Z_{\\text{py}}}{Z_{\\text{pl}}} = \\frac{2 \\exp(-\\beta V_b) \\sqrt{\\frac{2\\pi}{\\beta k_{\\text{py}}}}}{\\sqrt{\\frac{2\\pi}{\\beta k_{\\text{impr}}}}} = 2 \\exp(-\\beta V_b) \\sqrt{\\frac{k_{\\text{impr}}}{k_{\\text{py}}}}$$\nSubstituting this ratio into the expression for $\\Delta G$:\n$$\\Delta G = -RT \\ln\\left(2 \\exp(-\\beta V_b) \\sqrt{\\frac{k_{\\text{impr}}}{k_{\\text{py}}}}\\right)$$\nUsing the properties of logarithms, $\\ln(abc) = \\ln(a) + \\ln(b) + \\ln(c)$:\n$$\\Delta G = -RT \\left[ \\ln(2) + \\ln(\\exp(-\\beta V_b)) + \\ln\\left(\\left(\\frac{k_{\\text{impr}}}{k_{\\text{py}}}\\right)^{1/2}\\right) \\right]$$\n$$\\Delta G = -RT \\left[ \\ln(2) - \\beta V_b + \\frac{1}{2}\\ln\\left(\\frac{k_{\\text{impr}}}{k_{\\text{py}}}\\right) \\right]$$\nSubstituting $\\beta = \\frac{1}{RT}$, we get the final analytical expression:\n$$\\Delta G = -RT \\ln(2) + V_b - \\frac{RT}{2}\\ln\\left(\\frac{k_{\\text{impr}}}{k_{\\text{py}}}\\right)$$\nThis can be rearranged as:\n$$\\Delta G = V_b - RT\\left(\\ln(2) + \\frac{1}{2}\\ln\\left(\\frac{k_{\\text{impr}}}{k_{\\text{py}}}\\right)\\right)$$\n\nFrom this expression, we can state the dependence of $\\Delta G$ on $V_b$ and $k_{\\text{impr}}$.\n1.  **Dependence on $V_b$**: $\\Delta G$ increases linearly with $V_b$. $V_b$ is the potential energy offset of the pyramidal minima relative to the planar minimum. It acts as a direct enthalpic penalty, making the pyramidal state less favorable as $V_b$ increases.\n2.  **Dependence on $k_{\\text{impr}}$**: $\\Delta G$ depends logarithmically on $k_{\\text{impr}}$ via the term $-\\frac{RT}{2}\\ln(k_{\\text{impr}})$. As $k_{\\text{impr}}$ increases, the planar well becomes narrower (stiffer), which reduces its entropy. This makes the planar state relatively less favorable from an entropic standpoint, thus decreasing the free energy difference $\\Delta G$ and making the pyramidal configuration relatively more stable.\n\nFinally, we evaluate $\\Delta G$ numerically using the given parameters:\n$k_{\\text{impr}} = 400\\,\\mathrm{kJ\\,mol^{-1}\\,rad^{-2}}$\n$k_{\\text{py}} = 120\\,\\mathrm{kJ\\,mol^{-1}\\,rad^{-2}}$\n$V_b = 25\\,\\mathrm{kJ\\,mol^{-1}}$\n$T = 298\\,\\mathrm{K}$\n$R \\approx 8.31446 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$\n\nFirst, we calculate the thermal energy term $RT$:\n$$RT = (8.31446 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (298\\,\\mathrm{K}) \\approx 2.47771\\,\\mathrm{kJ\\,mol^{-1}}$$\nNext, we calculate the ratio of the stiffness constants:\n$$\\frac{k_{\\text{impr}}}{k_{\\text{py}}} = \\frac{400}{120} = \\frac{10}{3}$$\nNow, substitute the numerical values into the derived formula for $\\Delta G$:\n$$\\Delta G = 25\\,\\mathrm{kJ\\,mol^{-1}} - (2.47771\\,\\mathrm{kJ\\,mol^{-1}})\\left(\\ln(2) + \\frac{1}{2}\\ln\\left(\\frac{10}{3}\\right)\\right)$$\nUsing the values $\\ln(2) \\approx 0.69315$ and $\\ln(\\frac{10}{3}) \\approx 1.20397$:\n$$\\Delta G \\approx 25 - 2.47771 \\left(0.69315 + \\frac{1}{2}(1.20397)\\right)$$\n$$\\Delta G \\approx 25 - 2.47771 (0.69315 + 0.601985)$$\n$$\\Delta G \\approx 25 - 2.47771 (1.295135)$$\n$$\\Delta G \\approx 25 - 3.20897$$\n$$\\Delta G \\approx 21.79103\\,\\mathrm{kJ\\,mol^{-1}}$$\nRounding to four significant figures as requested, we get $21.79\\,\\mathrm{kJ\\,mol^{-1}}$.",
            "answer": "$$\\boxed{21.79}$$"
        },
        {
            "introduction": "Modern force field parameterization is a sophisticated balancing act, often requiring the reconciliation of data from multiple experimental and computational sources. This final, comprehensive practice guides you through a realistic multi-objective optimization workflow to determine the ideal parameters for a thioamide improper dihedral. You will write a program that seeks a single set of parameters $(k, \\chi_0)$ that simultaneously satisfies constraints from quantum mechanical energies, vibrational spectroscopy, and experimental dipole moments. This capstone exercise introduces the concept of Pareto optimality, demonstrating how to navigate the inherent trade-offs in model development to arrive at a scientifically robust and versatile parameter set .",
            "id": "3431310",
            "problem": "You are tasked with calibrating the planarity-restoring improper dihedral parameters for an out-of-plane bending coordinate in a thioamide functional group containing $sp^2$ sulfur, using a principled, multi-objective approach consistent with Molecular Dynamics (MD). For out-of-plane bending, the improper dihedral coordinate $\\chi$ measures the deviation from planarity. Under small distortions near planarity, the potential energy is approximated by a harmonic model derived from a Taylor expansion about the equilibrium geometry. The target is to determine a force constant $k$ (in $kJ\\cdot mol^{-1}\\cdot rad^{-2}$) and an equilibrium angle $\\chi_0$ (in radians) that together minimize discrepancies between model predictions and three sources of data: Quantum Mechanics (QM) energies, vibrational wavenumbers, and experimental dipole moments. You must formulate the problem mathematically, implement a multi-objective optimizer over a bounded parameter grid, and report Pareto trade-offs for specified thioamide test cases.\n\nBase the derivation and algorithm on the following fundamental laws and definitions:\n- The harmonic approximation for a single coordinate implies a potential energy $U(\\chi) \\approx \\frac{1}{2} k (\\chi - \\chi_0)^2$, derived from the second-order Taylor series about an equilibrium geometry where the first derivative vanishes.\n- In the small-oscillation limit for a single generalized coordinate, the Lagrangian has kinetic energy $T = \\frac{1}{2} I_\\chi \\dot{\\chi}^2$, where $I_\\chi$ is the effective moment of inertia for the coordinate $\\chi$. The normal-mode angular frequency is $\\omega = \\sqrt{k/I_\\chi}$, and the corresponding vibrational wavenumber is $\\tilde{\\nu} = \\omega/(2\\pi c)$, where $c$ is the speed of light.\n- For small distortions, a linearized dipole response can be modeled as $\\mu(\\chi) \\approx \\mu_{\\mathrm{ref}} + \\alpha\\,\\chi$, where $\\mu_{\\mathrm{ref}}$ and $\\alpha$ are molecule-specific constants. Under the harmonic model, the minimum-energy geometry is at $\\chi_{\\mathrm{eq}} = \\chi_0$, so the predicted dipole at equilibrium is $\\mu_{\\mathrm{pred}} = \\mu_{\\mathrm{ref}} + \\alpha\\,\\chi_0$.\n\nYour program must solve the following, using explicit units and angle conventions:\n- Angles $\\chi$ must be expressed in radians.\n- Energies must be in $kJ/mol$.\n- Vibrational wavenumbers must be in $cm^{-1}$.\n- Dipole moments must be in Debye.\n- The speed of light is $c = 2.99792458\\times 10^{10}\\ \\mathrm{cm/s}$.\n- Effective moments of inertia $I_\\chi$ are given in $kJ\\cdot mol^{-1}\\cdot s^{2}\\cdot rad^{-2}$, ensuring dimensional consistency so that $\\omega = \\sqrt{k/I_\\chi}$ has units of $s^{-1}$.\n\nFor each molecule below, you are provided with QM reference energies for specific out-of-plane angles, an experimental vibrational wavenumber, and a reference dipole model with an experimental dipole. You must:\n- Predict energies using $U_{\\mathrm{model}}(\\chi; k,\\chi_0) = \\frac{1}{2}k(\\chi-\\chi_0)^2$.\n- Predict the vibrational wavenumber using $\\tilde{\\nu}_{\\mathrm{model}}(k) = \\sqrt{k/I_\\chi}/(2\\pi c)$.\n- Predict the dipole at equilibrium using $\\mu_{\\mathrm{pred}}(\\chi_0) = \\mu_{\\mathrm{ref}} + \\alpha\\,\\chi_0$.\n\nDefine three objective functions to be minimized:\n- Energy objective: root-mean-square (RMS) error over provided angles, $\\mathrm{RMS}_E = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\left(U_{\\mathrm{model}}(\\chi_i;k,\\chi_0)-E_{\\mathrm{QM}}(\\chi_i)\\right)^2}$, in $kJ/mol$.\n- Frequency objective: absolute wavenumber error, $\\Delta \\tilde{\\nu} = \\left|\\tilde{\\nu}_{\\mathrm{model}}(k) - \\tilde{\\nu}_{\\mathrm{exp}}\\right|$, in $cm^{-1}$.\n- Dipole objective: absolute dipole error, $\\Delta \\mu = \\left|\\mu_{\\mathrm{pred}}(\\chi_0) - \\mu_{\\mathrm{exp}}\\right|$, in Debye.\n\nPerform a bounded grid search in parameter space $\\{(k,\\chi_0)\\}$ for each molecule with:\n- $k \\in [10.0, 40.0]$ in $kJ\\cdot mol^{-1}\\cdot rad^{-2}$, sampled at integer steps: $10.0, 11.0, \\ldots, 40.0$.\n- $\\chi_0 \\in [-0.10, 0.10]$ in radians, sampled at steps of $0.01$: $-0.10, -0.09, \\ldots, 0.10$.\n\nCompute the Pareto-optimal set for each molecule, where a parameter pair $(k_1,\\chi_{0,1})$ dominates $(k_2,\\chi_{0,2})$ if all three objectives are less than or equal for the first pair and strictly less in at least one. Also compute a single “knee” solution by normalizing each objective over the grid to $[0,1]$ via division by its maximum, and selecting the $(k,\\chi_0)$ that minimizes the Euclidean norm of the normalized objective vector; in case of a tie within numerical tolerance, prefer the pair with the smaller $\\mathrm{RMS}_E$.\n\nTest suite data (three molecules with scientifically consistent parameters):\n- Molecule $1$ (“Thioacetamide-like”):\n  - Angles (radians): $[-0.2,-0.1,0.0,0.1,0.2]$\n  - QM energies (kJ/mol): $[0.484,0.144,0.004,0.064,0.324]$\n  - Effective moment of inertia $I_\\chi$ ($kJ\\cdot mol^{-1}\\cdot s^{2}\\cdot rad^{-2}$): $3.196\\times 10^{-27}$\n  - Experimental wavenumber (cm$^{-1}$): $420.0$\n  - Dipole model: $\\mu_{\\mathrm{ref}}=3.20$ Debye, $\\alpha=1.00$ Debye/rad\n  - Experimental dipole (Debye): $3.22$\n- Molecule $2$ (“N,N-dimethyl thioformamide-like”):\n  - Angles (radians): $[-0.25,-0.125,0.0,0.125,0.25]$\n  - QM energies (kJ/mol): $[1.09375,0.2734375,0.0,0.2734375,1.09375]$\n  - Effective moment of inertia $I_\\chi$ ($kJ\\cdot mol^{-1}\\cdot s^{2}\\cdot rad^{-2}$): $3.145\\times 10^{-27}$\n  - Experimental wavenumber (cm$^{-1}$): $560.0$\n  - Dipole model: $\\mu_{\\mathrm{ref}}=2.95$ Debye, $\\alpha=0.50$ Debye/rad\n  - Experimental dipole (Debye): $2.95$\n- Molecule $3$ (“Bulky thioamide-like”):\n  - Angles (radians): $[-0.3,-0.15,0.0,0.15,0.3]$\n  - QM energies (kJ/mol): $[1.2996,0.4761,0.0576,0.0441,0.4356]$\n  - Effective moment of inertia $I_\\chi$ ($kJ\\cdot mol^{-1}\\cdot s^{2}\\cdot rad^{-2}$): $4.660\\times 10^{-27}$\n  - Experimental wavenumber (cm$^{-1}$): $330.0$\n  - Dipole model: $\\mu_{\\mathrm{ref}}=3.50$ Debye, $\\alpha=1.50$ Debye/rad\n  - Experimental dipole (Debye): $3.62$\n\nYour program must, for each molecule, compute:\n- The size of the Pareto-optimal set (an integer).\n- The knee solution parameter pair $(k^\\star,\\chi_0^\\star)$ (floats), chosen as described.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[p_1,k_1,\\chi_{0,1},p_2,k_2,\\chi_{0,2},p_3,k_3,\\chi_{0,3}]$, where $p_i$ is the Pareto set size for molecule $i$, and $(k_i,\\chi_{0,i})$ is the knee solution for molecule $i$.\n- All floating-point values in the output must be rounded to six decimal places.\n- No additional text may be printed.\n\nAngles must be handled in radians throughout. Energies must be handled in $kJ/mol$. Wavenumbers must be handled in $cm^{-1}$. Dipoles must be handled in Debye. Adhere to these units strictly. The output must follow the exact format described above.",
            "solution": "The problem requires the determination of optimal harmonic potential parameters, a force constant $k$ and an equilibrium angle $\\chi_0$, for an out-of-plane bending coordinate in a thioamide functional group. The optimization is framed as a multi-objective problem, aiming to simultaneously minimize the discrepancy between a molecular mechanics (MM) model and three distinct data sources: Quantum Mechanical (QM) potential energy scans, an experimental vibrational wavenumber, and an experimental dipole moment. This is a standard and principled approach in the development of force fields for molecular dynamics (MD) simulations.\n\nThe problem statement has been validated and is found to be scientifically sound, well-posed, and complete. All provided data, physical laws, and definitions are consistent with established principles of classical mechanics, spectroscopy, and computational chemistry. The units are dimensionally consistent. The algorithmic procedure for optimization is clearly defined.\n\nThe solution proceeds by first formalizing the mathematical models and objective functions, then detailing the computational algorithm for finding the Pareto-optimal set and a single \"knee\" solution for each of three test molecules.\n\n**1. Mathematical Formulation**\n\nThe parameterization is based on three predictive models derived from fundamental principles:\n\n- **Potential Energy Model:** The potential energy $U$ associated with the out-of-plane distortion angle $\\chi$ is approximated by a harmonic function, which is the second-order Taylor expansion of the true potential around the equilibrium angle $\\chi_0$:\n$$ U_{\\mathrm{model}}(\\chi; k, \\chi_0) = \\frac{1}{2} k (\\chi - \\chi_0)^2 $$\nHere, $k$ is the force constant in units of $kJ\\cdot mol^{-1}\\cdot rad^{-2}$ and $\\chi_0$ is the equilibrium angle in radians.\n\n- **Vibrational Frequency Model:** Within the small-oscillation (harmonic) approximation, the vibrational angular frequency $\\omega$ is related to the force constant $k$ and the effective moment of inertia $I_\\chi$ for the coordinate $\\chi$ by:\n$$ \\omega(k) = \\sqrt{\\frac{k}{I_\\chi}} $$\nThis angular frequency (in $s^{-1}$) is converted to a vibrational wavenumber $\\tilde{\\nu}$ (in $cm^{-1}$) using the speed of light, $c$:\n$$ \\tilde{\\nu}_{\\mathrm{model}}(k) = \\frac{\\omega(k)}{2\\pi c} = \\frac{1}{2\\pi c} \\sqrt{\\frac{k}{I_\\chi}} $$\nThe provided units for $k$ ($kJ\\cdot mol^{-1}\\cdot rad^{-2}$), $I_\\chi$ ($kJ\\cdot mol^{-1}\\cdot s^2\\cdot rad^{-2}$), and $c$ ($cm\\cdot s^{-1}$) are dimensionally consistent, yielding $\\tilde{\\nu}$ in $cm^{-1}$.\n\n- **Dipole Moment Model:** The total molecular dipole moment $\\mu$ is modeled as a linear function of the small distortion $\\chi$ around a reference geometry:\n$$ \\mu(\\chi) = \\mu_{\\mathrm{ref}} + \\alpha \\chi $$\nThe model's predicted dipole moment at its own equilibrium geometry ($\\chi = \\chi_0$) is therefore:\n$$ \\mu_{\\mathrm{pred}}(\\chi_0) = \\mu_{\\mathrm{ref}} + \\alpha \\chi_0 $$\n\nFrom these models, three objective functions are constructed to quantify the error against reference data. These functions are to be minimized over the parameter space of $(k, \\chi_0)$:\n\n- **Energy Objective (RMS Error):**\n$$ \\mathrm{RMS}_E(k, \\chi_0) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} \\left( U_{\\mathrm{model}}(\\chi_i; k, \\chi_0) - E_{\\mathrm{QM}}(\\chi_i) \\right)^2 } $$\nwhere $(\\chi_i, E_{\\mathrm{QM}}(\\chi_i))$ are the $N$ pairs of QM-calculated angles and energies.\n\n- **Frequency Objective (Absolute Error):**\n$$ \\Delta\\tilde{\\nu}(k) = \\left| \\tilde{\\nu}_{\\mathrm{model}}(k) - \\tilde{\\nu}_{\\mathrm{exp}} \\right| $$\nwhere $\\tilde{\\nu}_{\\mathrm{exp}}$ is the experimental vibrational wavenumber.\n\n- **Dipole Objective (Absolute Error):**\n$$ \\Delta\\mu(\\chi_0) = \\left| \\mu_{\\mathrm{pred}}(\\chi_0) - \\mu_{\\mathrm{exp}} \\right| $$\nwhere $\\mu_{\\mathrm{exp}}$ is the experimental molecular dipole moment.\n\n**2. Algorithmic Procedure**\n\nThe optimization is performed via a bounded grid search over the parameter space $(k, \\chi_0)$.\n\n- The force constant $k$ is sampled from $10.0$ to $40.0$ $kJ\\cdot mol^{-1}\\cdot rad^{-2}$ in integer steps.\n- The equilibrium angle $\\chi_0$ is sampled from $-0.10$ to $0.10$ radians with a step size of $0.01$.\n\nThis defines a discrete grid of $31 \\times 21 = 651$ parameter pairs. For each pair, the three objective functions are evaluated, yielding an objective vector $(\\mathrm{RMS}_E, \\Delta\\tilde{\\nu}, \\Delta\\mu)$ for each point in the parameter grid.\n\n**2.1. Pareto Optimality**\n\nA parameter pair $P_1 = (k_1, \\chi_{0,1})$ with an objective vector $\\vec{O}_1$ is said to **dominate** another pair $P_2 = (k_2, \\chi_{0,2})$ with an objective vector $\\vec{O}_2$ if and only if every component of $\\vec{O}_1$ is less than or equal to the corresponding component of $\\vec{O}_2$, and at least one component is strictly less. The **Pareto-optimal set** consists of all parameter pairs that are not dominated by any other pair on the grid. The size of this set is computed by iterating through all pairs of grid points and identifying the non-dominated ones.\n\n**2.2. Knee Solution**\n\nA single compromise solution, the \"knee\" of the Pareto front, is identified. This is done by first normalizing the objective values. For each objective function, its maximum value across the entire grid is found ($f_{\\mathrm{max}}$). Each evaluated objective value $f_i$ is then normalized to the range $[0, 1]$ by computing $f_{i, \\mathrm{norm}} = f_i / f_{\\mathrm{max}}$. This creates a normalized objective vector for each parameter pair. The Euclidean norm ($L_2$ norm) of this normalized vector is calculated:\n$$ L_2 = \\sqrt{ \\left(\\frac{\\mathrm{RMS}_E}{\\mathrm{RMS}_{E, \\mathrm{max}}}\\right)^2 + \\left(\\frac{\\Delta \\tilde{\\nu}}{\\Delta \\tilde{\\nu}_{\\mathrm{max}}}\\right)^2 + \\left(\\frac{\\Delta \\mu}{\\Delta \\mu_{\\mathrm{max}}}\\right)^2 } $$\nThe parameter pair $(k^\\star, \\chi_0^\\star)$ that minimizes this $L_2$ norm is selected as the knee solution. In case of a tie in the minimum $L_2$ norm (within numerical tolerance), the pair with the smaller $\\mathrm{RMS}_E$ is chosen. This procedure provides a balanced solution that performs reasonably well across all three conflicting objectives.\n\nThe implementation will process each of the three molecule test cases according to this defined algorithm.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multi-objective optimization problem for thioamide force field parameters.\n    \"\"\"\n    # Define physical constants\n    C_LIGHT = 2.99792458e10  # Speed of light in cm/s\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Molecule 1\",\n            \"angles_rad\": np.array([-0.2, -0.1, 0.0, 0.1, 0.2]),\n            \"energies_qm\": np.array([0.484, 0.144, 0.004, 0.064, 0.324]),\n            \"I_chi\": 3.196e-27,\n            \"nu_exp\": 420.0,\n            \"mu_ref\": 3.20,\n            \"alpha\": 1.00,\n            \"mu_exp\": 3.22,\n        },\n        {\n            \"name\": \"Molecule 2\",\n            \"angles_rad\": np.array([-0.25, -0.125, 0.0, 0.125, 0.25]),\n            \"energies_qm\": np.array([1.09375, 0.2734375, 0.0, 0.2734375, 1.09375]),\n            \"I_chi\": 3.145e-27,\n            \"nu_exp\": 560.0,\n            \"mu_ref\": 2.95,\n            \"alpha\": 0.50,\n            \"mu_exp\": 2.95,\n        },\n        {\n            \"name\": \"Molecule 3\",\n            \"angles_rad\": np.array([-0.3, -0.15, 0.0, 0.15, 0.3]),\n            \"energies_qm\": np.array([1.2996, 0.4761, 0.0576, 0.0441, 0.4356]),\n            \"I_chi\": 4.660e-27,\n            \"nu_exp\": 330.0,\n            \"mu_ref\": 3.50,\n            \"alpha\": 1.50,\n            \"mu_exp\": 3.62,\n        },\n    ]\n\n    # Grid search parameters\n    k_grid = np.arange(10.0, 41.0, 1.0)\n    # Use linspace for robust float range generation\n    chi0_grid = np.linspace(-0.10, 0.10, 21)\n\n    final_results = []\n    \n    for case_data in test_cases:\n        grid_results = []\n\n        # --- Step 1: Grid Search and Objective Calculation ---\n        for k in k_grid:\n            # Pre-calculate frequency objective as it only depends on k\n            nu_model = (1 / (2 * np.pi * C_LIGHT)) * np.sqrt(k / case_data[\"I_chi\"])\n            delta_nu = np.abs(nu_model - case_data[\"nu_exp\"])\n\n            for chi0 in chi0_grid:\n                # Energy objective\n                energies_model = 0.5 * k * (case_data[\"angles_rad\"] - chi0)**2\n                rms_e = np.sqrt(np.mean((energies_model - case_data[\"energies_qm\"])**2))\n\n                # Dipole objective\n                mu_pred = case_data[\"mu_ref\"] + case_data[\"alpha\"] * chi0\n                delta_mu = np.abs(mu_pred - case_data[\"mu_exp\"])\n                \n                grid_results.append({\n                    \"params\": (k, chi0),\n                    \"objectives\": (rms_e, delta_nu, delta_mu),\n                })\n\n        # --- Step 2: Pareto Set Calculation ---\n        pareto_set = []\n        for i, res_i in enumerate(grid_results):\n            is_dominated = False\n            obj_i = res_i[\"objectives\"]\n            for j, res_j in enumerate(grid_results):\n                if i == j:\n                    continue\n                obj_j = res_j[\"objectives\"]\n                \n                # Check if point j dominates point i\n                if (obj_j[0] <= obj_i[0] and obj_j[1] <= obj_i[1] and obj_j[2] <= obj_i[2]) and \\\n                   (obj_j[0] < obj_i[0] or obj_j[1] < obj_i[1] or obj_j[2] < obj_i[2]):\n                    is_dominated = True\n                    break\n            \n            if not is_dominated:\n                pareto_set.append(res_i)\n        \n        final_results.append(len(pareto_set))\n\n        # --- Step 3: Knee Solution Identification ---\n        objectives_matrix = np.array([res[\"objectives\"] for res in grid_results])\n        max_objectives = np.max(objectives_matrix, axis=0)\n\n        # Normalize objectives, handling cases where a max objective is 0\n        norm_objectives_matrix = np.copy(objectives_matrix)\n        for col in range(3):\n            if max_objectives[col] > 0:\n                norm_objectives_matrix[:, col] /= max_objectives[col]\n        \n        norms = np.linalg.norm(norm_objectives_matrix, axis=1)\n        min_norm = np.min(norms)\n        \n        # Find all candidates with the minimum norm (using tolerance)\n        candidate_indices = np.where(np.isclose(min_norm, norms, atol=1e-9))[0]\n        \n        # Apply tie-breaking rule: select candidate with the smallest RMS_E\n        knee_solution_idx = -1\n        min_rms_e_for_tie = float('inf')\n        \n        for idx in candidate_indices:\n            rms_e_candidate = grid_results[idx][\"objectives\"][0]\n            if rms_e_candidate < min_rms_e_for_tie:\n                min_rms_e_for_tie = rms_e_candidate\n                knee_solution_idx = idx\n        \n        knee_params = grid_results[knee_solution_idx][\"params\"]\n        final_results.extend(knee_params)\n\n    # Final print statement in the exact required format.\n    formatted_results = []\n    for item in final_results:\n        if isinstance(item, int):\n            formatted_results.append(str(item))\n        else:\n            formatted_results.append(f\"{item:.6f}\")\n            \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}