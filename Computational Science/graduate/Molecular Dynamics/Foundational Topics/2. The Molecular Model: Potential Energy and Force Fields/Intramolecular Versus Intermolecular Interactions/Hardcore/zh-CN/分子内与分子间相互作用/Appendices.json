{
    "hands_on_practices": [
        {
            "introduction": "这个实践从基本原理出发，旨在揭示平均力背后的物理。我们将沿着一个分子内（二面角）和一个分子间（接触距离）的反应坐标推导平均力势 (PMF)，通过这个过程，你会发现一个关键的区别：分子间坐标的平均力中出现了一个源于几何和相空间因素的“熵力”。这项练习阐明了在热力学体系中，有效力并不仅仅是势能的简单导数，从而深化了对分子间相互作用复杂性的理解。",
            "id": "3418858",
            "problem": "考虑一个温度为 $T$ 的经典正则系综，其位形矢量为 $x$，势能为 $U(x)$。其概率密度为 $p(x) \\propto \\exp(-\\beta U(x))$，其中 $\\beta = 1/(k_\\mathrm{B} T)$，$k_\\mathrm{B}$ 是玻尔兹曼常数。对于一个反应坐标 $q(x)$，其平均力势 (PMF) $W(q)$ 通过约束配分函数 $Z(q) = \\int \\mathrm{d}x \\, \\exp(-\\beta U(x)) \\, \\delta(q - q(x))$ 定义，即 $W(q) = -k_\\mathrm{B} T \\ln Z(q) + C$，其中 $C$ 是一个与 $q$ 无关的加性常数。沿 $q$ 方向的平均力定义为 $\\langle F_q \\rangle = - \\mathrm{d}W/\\mathrm{d}q$。\n\n您将通过在以下模型中沿两个物理上解耦的反应坐标评估 $\\langle F_q \\rangle$ 来比较分子内与分子间的贡献：\n\n- 分子内二面角坐标 $q_\\mathrm{dihedral} = \\theta \\in [0, 2\\pi)$，其分子内扭转势为 $U_\\mathrm{intra}(\\theta) = k_t \\left(1 - \\cos(n \\theta)\\right)$，其中 $k_t > 0$ 且 $n \\in \\mathbb{N}$。\n- 分子间接触坐标 $q_\\mathrm{contact} = r > 0$，等于通过 Lennard–Jones 势 $U_\\mathrm{inter}(r) = 4 \\varepsilon \\left[(\\sigma/r)^{12} - (\\sigma/r)^6\\right]$ 相互作用的两个点粒子之间的间距。\n\n假设总势能是可分离的，即 $U(x) = U_\\mathrm{intra}(\\theta) + U_\\mathrm{inter}(r) + U_\\mathrm{other}(\\text{所有其他独立自由度})$，并且剩余的自由度除了坐标选择所隐含的常规度规因子外，不与 $\\theta$ 或 $r$ 耦合。角度必须以弧度表示。在约化的 Lennard–Jones 单位制中进行计算，其中长度单位为 $\\sigma$，能量单位为 $\\varepsilon$，力单位为 $\\varepsilon/\\sigma$。在这些约化单位中，设 $k_\\mathrm{B} = 1$。\n\n您的任务是，仅使用上述定义和标准的坐标测度考量，从第一性原理出发，推导计算沿 $q_\\mathrm{dihedral}$ 和 $q_\\mathrm{contact}$ 的平均力 $\\langle F_{q} \\rangle$ 的表达式。然后，实现一个程序，为以下每个独立测试用例计算平均力：\n\n基于二面角的反应坐标用例（分子内）：\n1. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/6$。\n2. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/3$。\n3. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/2$。\n4. $k_t = 2.5$, $n = 2$, $\\theta = \\pi/4$。\n\n基于接触的反应坐标用例（分子间）：\n5. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 2^{1/6} \\, \\sigma$。\n6. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 0.9 \\, \\sigma$。\n7. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 3.0 \\, \\sigma$。\n8. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 0.1$, $r = 3.0 \\, \\sigma$。\n9. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 0.01$, $r = 1.5 \\, \\sigma$。\n\n所有答案必须以约化的 Lennard–Jones 力单位 $\\varepsilon/\\sigma$ 表示。您的程序应产生单行输出，其中包含 9 个测试用例的结果，形式为逗号分隔的浮点数列表，四舍五入到六位小数，并用方括号括起来（例如 $[a_1,a_2,\\dots,a_9]$）。不得打印任何额外文本。\n\n设计考量：\n- 从 $p(x) \\propto \\exp(-\\beta U(x))$ 和 $W(q)$ 的定义开始。不要假定任何无法从这些基础推导出的特化或黑箱公式。在为接触坐标 $r$ 构建 $Z(q)$ 时，请仔细考虑坐标空间测度。\n- 确保您的表达式在所述的可分离性假设下有效，并且单位一致。\n- 程序必须是自包含的，无需任何输入。它必须以指定的精确格式计算并打印九个结果。",
            "solution": "目标是推导沿分子内二面角坐标 $q=\\theta$ 和分子间接触坐标 $q=r$ 的平均力 $\\langle F_q \\rangle$ 的表达式，然后为一系列测试用例计算这些力。推导将从问题描述中所陈述的统计力学第一性原理开始。我们将在约化的 Lennard-Jones 单位制中进行计算，其中特征能量 $\\varepsilon$、长度 $\\sigma$ 和玻尔兹曼常数 $k_\\mathrm{B}$ 均设为 1。因此，温度 $T$ 的单位是 $\\varepsilon$，参数 $\\beta = 1/(k_\\mathrm{B}T)$ 变为 $\\beta=1/T$。\n\n沿反应坐标 $q$ 的平均力定义为平均力势 (PMF) $W(q)$ 的负导数：\n$$\n\\langle F_q \\rangle = - \\frac{\\mathrm{d}W}{\\mathrm{d}q}\n$$\nPMF 通过约束配分函数 $Z(q)$ 定义如下：\n$$\nW(q) = -k_\\mathrm{B} T \\ln Z(q) + C = -T \\ln Z(q) + C\n$$\n其中 $C$ 是一个常数，$Z(q) = \\int \\mathrm{d}x \\, \\exp(-\\beta U(x)) \\, \\delta(q - q(x))$。积分遍及整个位形空间 $x$。解决问题的关键在于，通过恰当考虑势能的可分离性和积分测度，为每种坐标类型计算 $Z(q)$。\n\n### 情况1：分子内二面角坐标 ($q_\\mathrm{dihedral} = \\theta$)\n\n对于分子内情况，反应坐标是二面角 $\\theta$。势能被设定为可分离的：\n$$\nU(x) = U_\\mathrm{intra}(\\theta) + U_\\mathrm{rest}(y)\n$$\n其中 $y$ 代表所有其他自由度（包括分子间距离 $r$ 等），并且 $U_\\mathrm{rest}(y) = U_\\mathrm{inter}(r) + U_\\mathrm{other}(\\dots)$。问题陈述了其他自由度是独立的，这意味着积分测度（雅可比行列式）也是可分离的。对于作为广义坐标的二面角，相应的度规张量分量通常是恒定的。因此，体积元可以写为 $\\mathrm{d}x = c \\cdot \\mathrm{d}\\theta \\mathrm{d}y$，其中 $c$ 是一个常数。\n\n对于二面角的特定值 $\\theta'$，约束配分函数 $Z(\\theta')$ 为：\n$$\nZ(\\theta') = \\int c_1 \\mathrm{d}\\theta \\mathrm{d}y \\, e^{-\\beta (U_\\mathrm{intra}(\\theta) + U_\\mathrm{rest}(y))} \\, \\delta(\\theta'-\\theta)\n$$\n利用 Dirac delta 函数的性质对 $\\theta$ 进行积分，我们得到：\n$$\nZ(\\theta') = c_1 \\int \\mathrm{d}y \\, e^{-\\beta (U_\\mathrm{intra}(\\theta') + U_\\mathrm{rest}(y))} = c_1 e^{-\\beta U_\\mathrm{intra}(\\theta')} \\int \\mathrm{d}y \\, e^{-\\beta U_\\mathrm{rest}(y)}\n$$\n剩余的积分 $Z_\\mathrm{rest} = \\int \\mathrm{d}y \\, e^{-\\beta U_\\mathrm{rest}(y)}$ 是一个关于 $\\theta'$ 的常数。因此，$Z(\\theta')$ 与分子内势本身的玻尔兹曼因子成正比：\n$$\nZ(\\theta') = C_1 e^{-\\beta U_\\mathrm{intra}(\\theta')}\n$$\n其中 $C_1$ 是一个常数。于是 PMF 为：\n$$\nW(\\theta') = -T \\ln(C_1 e^{-\\beta U_\\mathrm{intra}(\\theta')}) + C = -T \\ln(C_1) -T(-\\beta U_\\mathrm{intra}(\\theta')) + C = U_\\mathrm{intra}(\\theta') + C_2\n$$\n其中 $C_2$ 是另一个常数。这表明，当一个自由度完全解耦时，其 PMF 与其势能在相差一个加性常数的情况下是相同的。\n\n平均力（在此情况下为平均力矩）为：\n$$\n\\langle F_\\theta \\rangle = -\\frac{\\mathrm{d}W}{\\mathrm{d}\\theta} = -\\frac{\\mathrm{d}}{\\mathrm{d}\\theta} (U_\\mathrm{intra}(\\theta) + C_2) = -\\frac{\\mathrm{d}U_\\mathrm{intra}}{\\mathrm{d}\\theta}\n$$\n给定二面角势的形式为 $U_\\mathrm{intra}(\\theta) = k_t (1 - \\cos(n \\theta))$，其导数为：\n$$\n\\frac{\\mathrm{d}U_\\mathrm{intra}}{\\mathrm{d}\\theta} = k_t (n \\sin(n \\theta))\n$$\n因此，平均力矩的表达式为：\n$$\n\\langle F_\\theta \\rangle = -n k_t \\sin(n \\theta)\n$$\n这个量纲是能量。题目要求答案以力单位 $\\varepsilon/\\sigma$ 表示。在 $\\sigma=1$ 的约化单位中，力单位在数值上等于能量单位。因此，我们报告以约化能量单位计算的力矩的数值。\n\n### 情况2：分子间接触坐标 ($q_\\mathrm{contact} = r$)\n\n对于分子间情况，反应坐标 $q$ 是两个粒子之间的间距 $r$。势能是可分离的：$U(x) = U_\\mathrm{inter}(r) + U_\\mathrm{rest}(y)$，其中 $y$ 现在包括二面角 $\\theta$ 和其他自由度。\n对于特定距离 $r'$ 的约束配分函数是：\n$$\nZ(r') = \\int \\mathrm{d}x \\, e^{-\\beta (U_\\mathrm{inter}(r(x)) + U_\\mathrm{rest}(y))} \\, \\delta(r' - r(x))\n$$\n将对剩余坐标的积分因子分离出来，我们得到：\n$$\nZ(r') = C_3 \\int_{\\text{pair}} e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\n其中积分是针对相互作用对的自由度。设它们的位置为 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$。位形元为 $\\mathrm{d}\\mathbf{r}_1 \\mathrm{d}\\mathbf{r}_2$。我们变换到质心坐标 $\\mathbf{R} = (\\mathbf{r}_1 + \\mathbf{r}_2)/2$ 和相对坐标 $\\mathbf{r} = \\mathbf{r}_1 - \\mathbf{r}_2$。积分元变为 $\\mathrm{d}\\mathbf{R} \\mathrm{d}\\mathbf{r}$。势 $U_\\mathrm{inter}$ 只依赖于模 $r = |\\mathbf{r}|$。对 $\\mathbf{R}$ 的积分给出了系统体积 $V$，这是另一个常数。我们剩下对相对坐标 $\\mathbf{r}$ 的积分：\n$$\nZ(r') \\propto \\int \\mathrm{d}\\mathbf{r} \\, e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\n为了计算这个积分，我们切换到 $\\mathbf{r}$ 的球坐标。体积元是 $\\mathrm{d}\\mathbf{r} = r^2 \\sin\\phi \\, \\mathrm{d}r \\mathrm{d}\\phi \\mathrm{d}\\psi$。这个雅可比因子 $r^2$ 就是问题中提到的关键的“坐标空间测度”。\n$$\nZ(r') \\propto \\int_0^{2\\pi} \\mathrm{d}\\psi \\int_0^\\pi \\mathrm{d}\\phi \\, \\sin\\phi \\int_0^\\infty \\mathrm{d}r \\, r^2 e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\n角向积分的结果是 $4\\pi$。径向积分通过 delta 函数求解：\n$$\nZ(r') \\propto 4\\pi (r')^2 e^{-\\beta U_\\mathrm{inter}(r')}\n$$\n于是 PMF $W(r')$ 为：\n$$\nW(r') = -T \\ln(Z(r')) + C = -T \\ln(C_4 (r')^2 e^{-\\beta U_\\mathrm{inter}(r')}) + C = U_\\mathrm{inter}(r') - 2T \\ln(r') + C_5\n$$\nPMF 是直接势能 $U_\\mathrm{inter}(r')$ 和一个熵项 $-2T\\ln(r')$ 的和，该熵项的出现是因为半径为 $r'$、厚度为 $\\mathrm{d}r$ 的球壳中可用的相空间体积与 $4\\pi (r')^2 \\mathrm{d}r$ 成正比。\n\n平均力是 PMF 对 $r$ 的负导数：\n$$\n\\langle F_r \\rangle = -\\frac{\\mathrm{d}W}{\\mathrm{d}r} = -\\frac{\\mathrm{d}U_\\mathrm{inter}}{\\mathrm{d}r} - \\frac{\\mathrm{d}}{\\mathrm{d}r}(-2T\\ln(r)) = -\\frac{\\mathrm{d}U_\\mathrm{inter}}{\\mathrm{d}r} + \\frac{2T}{r}\n$$\n第一项是来自 Lennard-Jones 势的直接力。对于 $U_\\mathrm{inter}(r) = 4\\varepsilon [(\\sigma/r)^{12} - (\\sigma/r)^6]$，其在约化单位（$\\varepsilon=1, \\sigma=1$）下的负导数是 $F_\\mathrm{direct} = 24(2r^{-13} - r^{-7})$。总平均力为：\n$$\n\\langle F_r \\rangle = 24(2r^{-13} - r^{-7}) + \\frac{2T}{r}\n$$\n这个表达式具有正确的力单位 $\\varepsilon/\\sigma$。\n\n### 实现\n所提供的 Python 代码实现了这两个推导出的公式。对于分子内用例（1-4），它计算 $\\langle F_\\theta \\rangle = -n k_t \\sin(n\\theta)$。对于分子间用例（5-9），它使用给定的约化单位参数计算 $\\langle F_r \\rangle = 24(2r^{-13} - r^{-7}) + 2T/r$。所有九个用例的结果被收集起来，并以指定格式打印，四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the mean force for 9 test cases, based on derived formulas for\n    intramolecular (dihedral) and intermolecular (contact) reaction coordinates.\n    \"\"\"\n\n    # Test cases are defined as tuples. The first element is a string identifier.\n    # For 'dihedral': (kt, n, theta_rad)\n    # For 'contact': (T, r)\n    test_cases = [\n        ('dihedral', (4.0, 3, np.pi/6)),\n        ('dihedral', (4.0, 3, np.pi/3)),\n        ('dihedral', (4.0, 3, np.pi/2)),\n        ('dihedral', (2.5, 2, np.pi/4)),\n        ('contact', (1.0, 2**(1/6))),\n        ('contact', (1.0, 0.9)),\n        ('contact', (1.0, 3.0)),\n        ('contact', (0.1, 3.0)),\n        ('contact', (0.01, 1.5)),\n    ]\n\n    results = []\n    \n    for case_type, params in test_cases:\n        if case_type == 'dihedral':\n            # Mean force (torque) for a dihedral potential U = kt * (1 - cos(n*theta))\n            # F_theta = -dU/d(theta) = -kt * (n * sin(n*theta))\n            kt, n, theta = params\n            force = -n * kt * np.sin(n * theta)\n            results.append(force)\n        elif case_type == 'contact':\n            # Mean force for a contact potential F_r = -dU/dr + 2T/r\n            # U_inter(r) = 4 * (r^-12 - r^-6) in reduced units\n            # -dU/dr = 24 * (2*r^-13 - r^-7)\n            T, r = params\n            f_direct = 24.0 * (2.0 * r**-13 - r**-7)\n            f_entropic = 2.0 * T / r\n            force = f_direct + f_entropic\n            results.append(force)\n\n    # Format and print the results as per the problem description\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了力的分解之后，我们将视角从单个坐标上的力转向宏观的热力学性质。本练习将利用一个计算模型来模拟能量涨落，并应用统计力学中的涨落-耗散定理，来探究分子内、分子间以及它们之间的交叉项如何共同贡献于体系的总热容$C_V$。这个实践展示了如何通过模拟将宏观可观测量分解为其微观根源，揭示了不同类型相互作用在决定材料热学性质中的作用。",
            "id": "3418835",
            "problem": "考虑一个在恒定粒子数、体积和温度 (NVT) 系综中进行的正则系综分子动力学 (MD) 实验，其中总势能分解为 $U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$。对定容热容的构型贡献可以通过广为接受的正则涨落关系式 $C_V^{\\mathrm{conf}} = \\left(\\langle U^2 \\rangle - \\langle U \\rangle^2\\right) / \\left(k_B T^2\\right)$ 从势能涨落中获得，其中 $k_B$ 是玻尔兹曼常数，$T$ 是绝对温度。你的任务是设计一个计算实验，该实验使用一个基于统计的 MD 涨落代理模型，将 $C_V^{\\mathrm{conf}}$ 归因于分子内和分子间分量，并探究溶剂极性参数如何改变此划分。\n\n你必须实现一个程序，该程序为 $U_{\\mathrm{intra}}$ 和 $U_{\\mathrm{inter}}$ 的联合涨落构建一个高斯代理模型，其动机源于中心极限定理以及平衡态附近小振幅涨落的近简谐特性。具体来说，假设：\n- $U_{\\mathrm{intra}}$ 源于温度 $T$ 下的 $N_{\\mathrm{intra}}$ 个独立的二次（谐振）分子内模式。这意味着方差的标度与二次自由度一致。\n- $U_{\\mathrm{inter}}$ 源于 $N_{\\mathrm{inter}}$ 个有效的分子间模式，其涨落幅度取决于一个无量纲的溶剂极性参数 $p$，该参数捕捉了极性相互作用的增强。引入一个无量纲振幅因子 $\\beta(p)$ 和一个无量纲交叉耦合 $\\gamma(p)$，它们调节 $U_{\\mathrm{intra}}$ 和 $U_{\\mathrm{inter}}$ 之间的协方差。\n\n为该代理模型定义如下：\n- 玻尔兹曼常数为 $k_B = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$。\n- 分子内涨落的方差为 $\\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right) = N_{\\mathrm{intra}} \\left(k_B^2 T^2\\right) / 2$。\n- 分子间涨落的方差为 $\\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) = \\beta(p)\\, N_{\\mathrm{inter}} \\left(k_B^2 T^2\\right) / 2$，其中 $\\beta(p) = 1 + b_1 p$ 且 $b_1 = 0.5$。\n- 协方差为 $\\mathrm{Cov}\\!\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right) = \\gamma(p)\\, \\sqrt{\\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right)\\, \\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right)}$，其中 $\\gamma(p) = c_0 \\tanh(p)$ 且 $c_0 = 0.5$。这一选择确保了对于所有 $p \\ge 0$，协方差矩阵都是半正定的。\n\n从一个零均值的多元正态分布中生成 $N=100000$ 个二元涨落向量 $\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right)$ 的样本，其协方差矩阵由上述方差和协方差确定。对于任何 $\\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) = 0$ 的情况，将 $U_{\\mathrm{inter}}$ 视为恒等于零，并从具有指定方差的单变量正态分布中对 $U_{\\mathrm{intra}}$ 进行采样。\n\n对每个测试用例，计算并报告以下量，所有量均以焦耳每开尔文 ($\\mathrm{J}\\ \\mathrm{K}^{-1}$) 为单位表示：\n- $C_{\\mathrm{intra}} = \\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right) / \\left(k_B T^2\\right)$，\n- $C_{\\mathrm{inter}} = \\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) / \\left(k_B T^2\\right)$，\n- $C_{\\mathrm{cross}} = 2\\, \\mathrm{Cov}\\!\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right) / \\left(k_B T^2\\right)$，\n- $C_{\\mathrm{total}} = \\left(\\langle U^2 \\rangle - \\langle U \\rangle^2\\right) / \\left(k_B T^2\\right)$，其中 $U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$。\n\n你的程序必须实现上述构造，并使用生成样本的经验矩（而非封闭形式的表达式）来计算这四个量。使用固定的随机种子以保证可复现性。所有输出均以包含 $6$ 位有效数字的科学记数法表示。\n\n测试套件：\n- 用例 1：$T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 0.2$。\n- 用例 2：$T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 1.0$。\n- 用例 3：$T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 0$, $p = 0.5$。\n- 用例 4：$T = 600\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 0.2$。\n- 用例 5：$T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 5.0$。\n\n最终输出格式：\n你的程序应产生单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，每个元素是对应测试用例的一个内部列表 $[C_{\\mathrm{intra}}, C_{\\mathrm{inter}}, C_{\\mathrm{cross}}, C_{\\mathrm{total}}]$，以 $\\mathrm{J}\\ \\mathrm{K}^{-1}$ 为单位，用包含 $6$ 位有效数字的科学记数法表示。例如，外层列表应类似于 $[[\\cdots],[\\cdots],\\ldots]$，前后不含任何附加文本。",
            "solution": "该问题要求设计并实现一个计算实验，以将定容构型热容 $C_V^{\\mathrm{conf}}$ 分解为源自分子内和分子间势能涨落的分量。问题的核心在于统计力学，具体来说是涨落-耗散定理，该定理将热平衡状态下的热力学响应函数（如热容）与微观量（如能量）的统计涨落联系起来。\n\n在正则 ($NVT$) 系综中的基本关系式为：\n$$\nC_V^{\\mathrm{conf}} = \\frac{\\langle U^2 \\rangle - \\langle U \\rangle^2}{k_B T^2} = \\frac{\\mathrm{Var}(U)}{k_B T^2}\n$$\n其中 $U$ 是总势能，$k_B$ 是玻尔兹曼常数 ($1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$)，$T$ 是绝对温度，而 $\\mathrm{Var}(U)$ 是势能的方差。\n\n总势能被分解为分子内和分子间的贡献，$U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$。利用方差的性质，总能量的方差可以展开为：\n$$\n\\mathrm{Var}(U) = \\mathrm{Var}(U_{\\mathrm{intra}} + U_{\\mathrm{inter}}) = \\mathrm{Var}(U_{\\mathrm{intra}}) + \\mathrm{Var}(U_{\\mathrm{inter}}) + 2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})\n$$\n将此分解代入 $C_V^{\\mathrm{conf}}$ 的表达式中，得到热容的一个划分：\n$$\nC_V^{\\mathrm{conf}} = \\frac{\\mathrm{Var}(U_{\\mathrm{intra}})}{k_B T^2} + \\frac{\\mathrm{Var}(U_{\\mathrm{inter}})}{k_B T^2} + \\frac{2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})}{k_B T^2}\n$$\n这自然地定义了我们需要计算的三个分量：\n1.  分子内贡献：$C_{\\mathrm{intra}} = \\mathrm{Var}(U_{\\mathrm{intra}}) / (k_B T^2)$\n2.  分子间贡献：$C_{\\mathrm{inter}} = \\mathrm{Var}(U_{\\mathrm{inter}}) / (k_B T^2)$\n3.  交叉相关贡献：$C_{\\mathrm{cross}} = 2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) / (k_B T^2)$\n\n总构型热容是这三项之和：$C_{\\mathrm{total}} = C_{\\mathrm{intra}} + C_{\\mathrm{inter}} + C_{\\mathrm{cross}}$。\n\n问题指示我们使用一个能量涨落的代理模型，该模型受中心极限定理的启发，该定理表明许多独立随机变量之和趋向于正态分布。我们将 $(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})$ 的联合涨落建模为二元正态分布。由于我们关心的是围绕平均能量的涨落，我们可以用一个零均值分布 $\\mathcal{N}(\\mathbf{0}, \\Sigma)$ 来对它们建模，其中 $\\mathbf{0}$ 是零向量，$\\Sigma$ 是 $2 \\times 2$ 协方差矩阵。\n\n协方差矩阵 $\\Sigma$ 的元素由问题陈述定义如下：\n- 分子内能量的方差 $\\sigma_{11} = \\mathrm{Var}(U_{\\mathrm{intra}})$ 由一个包含 $N_{\\mathrm{intra}}$ 个独立谐振模式的模型给出。对于一个经典谐振子，其势能的方差为 $(k_B T)^2/2$。因此，对于 $N_{\\mathrm{intra}}$ 个模式：\n  $$\n  \\sigma_{11} = \\mathrm{Var}(U_{\\mathrm{intra}}) = N_{\\mathrm{intra}} \\frac{(k_B T)^2}{2} = N_{\\mathrm{intra}} \\frac{k_B^2 T^2}{2}\n  $$\n- 分子间能量的方差 $\\sigma_{22} = \\mathrm{Var}(U_{\\mathrm{inter}})$ 的建模方式类似，但受溶剂极性参数 $p$ 的调节：\n  $$\n  \\sigma_{22} = \\mathrm{Var}(U_{\\mathrm{inter}}) = \\beta(p) N_{\\mathrm{inter}} \\frac{k_B^2 T^2}{2}\n  $$\n  其中振幅因子为 $\\beta(p) = 1 + b_1 p$，且 $b_1 = 0.5$。\n\n- 两个能量分量之间的协方差 $\\sigma_{12} = \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})$ 由一个无量纲交叉耦合函数 $\\gamma(p)$ 决定：\n  $$\n  \\sigma_{12} = \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) = \\gamma(p) \\sqrt{\\mathrm{Var}(U_{\\mathrm{intra}}) \\mathrm{Var}(U_{\\mathrm{inter}})} = \\gamma(p) \\sqrt{\\sigma_{11} \\sigma_{22}}\n  $$\n  其中 $\\gamma(p) = c_0 \\tanh(p)$，且 $c_0 = 0.5$。这种形式确保了相关系数 $\\rho = \\gamma(p)$ 是有界的，$|\\rho| \\le 0.5$，这保证了协方差矩阵是半正定的。\n\n计算流程如下：\n1.  对于每个由 ($T, N_{\\mathrm{intra}}, N_{\\mathrm{inter}}, p$) 指定的测试用例，首先计算协方差矩阵元素 $\\sigma_{11}$、$\\sigma_{22}$ 和 $\\sigma_{12}$ 的理论值。如果 $N_{\\mathrm{inter}} = 0$，则 $\\sigma_{22} = 0$ 且 $\\sigma_{12} = 0$。\n2.  构建 $2 \\times 2$ 协方差矩阵 $\\Sigma = \\begin{pmatrix} \\sigma_{11}  \\sigma_{12} \\\\ \\sigma_{12}  \\sigma_{22} \\end{pmatrix}$。\n3.  从二元正态分布 $\\mathcal{N}(\\mathbf{0}, \\Sigma)$ 中生成大量样本，$N = 100000$。每个样本是一个向量 $(\\delta U_{\\mathrm{intra}}^{(i)}, \\delta U_{\\mathrm{inter}}^{(i)})$。\n4.  关键的是，根据问题要求，我们不使用理论方差和协方差来计算热容。相反，我们从生成的样本中计算*经验*矩。对于一组 $N$ 个样本，计算无偏经验协方差矩阵。设生成的样本为 $\\mathbf{u}_i = (U_{\\mathrm{intra}}^{(i)}, U_{\\mathrm{inter}}^{(i)})$。经验方差和协方差为：\n    $$\n    \\widehat{\\mathrm{Var}}(U_{\\mathrm{intra}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{intra}}^{(i)} - \\bar{U}_{\\mathrm{intra}})^2\n    $$\n    $$\n    \\widehat{\\mathrm{Var}}(U_{\\mathrm{inter}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{inter}}^{(i)} - \\bar{U}_{\\mathrm{inter}})^2\n    $$\n    $$\n    \\widehat{\\mathrm{Cov}}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{intra}}^{(i)} - \\bar{U}_{\\mathrm{intra}})(U_{\\mathrm{inter}}^{(i)} - \\barU}_{\\mathrm{inter}})\n    $$\n    其中 $\\bar{U}$ 表示样本均值。\n5.  每个样本的总能量涨落为 $U^{(i)} = U_{\\mathrm{intra}}^{(i)} + U_{\\mathrm{inter}}^{(i)}$。总能量的经验方差 $\\widehat{\\mathrm{Var}}(U)$ 也从样本集 $\\{U^{(i)}\\}$ 中计算得出。\n6.  最后，通过将这些经验矩代入定义方程来计算四个热容量：\n    - $C_{\\mathrm{intra}} = \\widehat{\\mathrm{Var}}(U_{\\mathrm{intra}}) / (k_B T^2)$\n    - $C_{\\mathrm{inter}} = \\widehat{\\mathrm{Var}}(U_{\\mathrm{inter}}) / (k_B T^2)$\n    - $C_{\\mathrm{cross}} = 2 \\widehat{\\mathrm{Cov}}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) / (k_B T^2)$\n    - $C_{\\mathrm{total}} = \\widehat{\\mathrm{Var}}(U) / (k_B T^2)$\n\n这个过程模拟了一个计算实验，区分了底层的理论模型（用于生成数据）和对结果数据的统计分析（用于计算可观测量）。使用固定的随机种子以确保伪随机生成的样本的可复现性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational problem of partitioning heat capacity\n    based on a surrogate model of molecular energy fluctuations.\n    \"\"\"\n    # Define constants\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    b_1 = 0.5\n    c_0 = 0.5\n    N_samples = 100000\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (T in K, N_intra, N_inter, p)\n        (300.0, 9, 12, 0.2),\n        (300.0, 9, 12, 1.0),\n        (300.0, 9, 0, 0.5),\n        (600.0, 9, 12, 0.2),\n        (300.0, 9, 12, 5.0),\n    ]\n\n    # Set a fixed random seed for reproducibility\n    np.random.seed(42)\n\n    all_case_results = []\n\n    for T, N_intra, N_inter, p in test_cases:\n        # Step 1: Calculate the theoretical covariance matrix elements\n        k_B_T_sq = (k_B * T)**2\n        \n        # Variance of intramolecular energy\n        var_intra = N_intra * k_B_T_sq / 2.0\n        \n        # Variance of intermolecular energy\n        if N_inter > 0:\n            beta_p = 1.0 + b_1 * p\n            var_inter = beta_p * N_inter * k_B_T_sq / 2.0\n        else:\n            var_inter = 0.0\n\n        # Covariance\n        if var_intra > 0 and var_inter > 0:\n            gamma_p = c_0 * np.tanh(p)\n            covar = gamma_p * np.sqrt(var_intra * var_inter)\n        else:\n            covar = 0.0\n\n        # Step 2: Construct the covariance matrix\n        cov_matrix = np.array([[var_intra, covar], [covar, var_inter]])\n        \n        # Step 3: Generate samples from the bivariate normal distribution\n        # The mean vector is zero, representing fluctuations\n        mean_vec = [0.0, 0.0]\n        samples = np.random.multivariate_normal(mean_vec, cov_matrix, size=N_samples)\n        \n        u_intra_samples = samples[:, 0]\n        u_inter_samples = samples[:, 1]\n        \n        # Step 4: Compute empirical moments from the samples\n        # We use ddof=1 for the unbiased sample variance/covariance\n        \n        # Calculate empirical individual variances and covariance\n        # np.cov returns the covariance matrix of the samples\n        emp_cov_matrix = np.cov(samples, rowvar=False, ddof=1)\n        emp_var_intra = emp_cov_matrix[0, 0]\n        emp_var_inter = emp_cov_matrix[1, 1]\n        emp_covar = emp_cov_matrix[0, 1]\n\n        # Step 5: Compute empirical total energy variance\n        u_total_samples = u_intra_samples + u_inter_samples\n        emp_var_total = np.var(u_total_samples, ddof=1)\n\n        # Step 6: Calculate heat capacity components\n        denom = k_B * T**2\n        \n        C_intra = emp_var_intra / denom\n        C_inter = emp_var_inter / denom\n        C_cross = 2.0 * emp_covar / denom\n        C_total = emp_var_total / denom\n\n        # Store results for this case\n        current_results = [C_intra, C_inter, C_cross, C_total]\n        all_case_results.append(current_results)\n\n    # Final print statement in the exact required format.\n    # Format each number to scientific notation with 6 significant digits (1.dddddde+xx)\n    formatted_results = []\n    for res_list in all_case_results:\n        formatted_list = [f\"{val:.5e}\" for val in res_list]\n        formatted_results.append(f\"[{','.join(formatted_list)}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}