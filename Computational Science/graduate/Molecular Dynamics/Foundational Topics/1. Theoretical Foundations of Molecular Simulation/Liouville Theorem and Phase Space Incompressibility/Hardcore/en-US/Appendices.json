{
    "hands_on_practices": [
        {
            "introduction": "To grasp Liouville's theorem in practice, we must first master the tool for measuring changes in phase space volume: the Jacobian determinant. This exercise provides a foundational workout, asking you to calculate the volume distortion caused by a simple momentum scaling—a transformation analogous to those used in some temperature control schemes. By applying first principles of calculus to this scaling map , you will solidify your understanding of how coordinate transformations directly impact the measure of the phase space.",
            "id": "3421866",
            "problem": "Consider a classical molecular dynamics system of $N$ point particles in three spatial dimensions with positions $\\mathbf{q} = (\\mathbf{q}_{1},\\dots,\\mathbf{q}_{N}) \\in \\mathbb{R}^{3N}$, momenta $\\mathbf{p} = (\\mathbf{p}_{1},\\dots,\\mathbf{p}_{N}) \\in \\mathbb{R}^{3N}$, and positive masses $\\mathbf{m} = (m_{1},\\dots,m_{N}) \\in \\mathbb{R}^{N}_{>0}$. The Hamiltonian is $H(\\mathbf{q},\\mathbf{p}) = \\sum_{i=1}^{N} \\frac{|\\mathbf{p}_{i}|^{2}}{2 m_{i}} + U(\\mathbf{q})$, where $U(\\mathbf{q})$ is a smooth potential. The canonical phase-space measure is the Lebesgue measure $\\mathrm{d}\\mathbf{q}\\,\\mathrm{d}\\mathbf{p}$ on $\\mathbb{R}^{6N}$, and the extended measure that also includes the masses is $\\mathrm{d}\\mathbf{q}\\,\\mathrm{d}\\mathbf{p}\\,\\mathrm{d}\\mathbf{m}$ on $\\mathbb{R}^{7N}$.\n\nAt an instant $t_{0}$, an instantaneous “temperature jump” operation is applied that rescales momenta by a uniform factor $\\alpha>0$ for all particles, leaving positions and masses initially unchanged: $\\mathbf{p}_{i} \\mapsto \\alpha\\,\\mathbf{p}_{i}$ for all $i=1,\\dots,N$.\n\nUsing only first principles (definitions of the Jacobian determinant of a coordinate transformation and the structure of the canonical phase-space measure), do the following:\n\n1. Compute the magnitude of the Jacobian determinant of the transformation on $(\\mathbf{q},\\mathbf{p})$ induced by the momentum rescaling $\\mathbf{p}\\mapsto \\alpha\\,\\mathbf{p}$ with $\\mathbf{q}$ unchanged.\n\n2. To enforce phase-space incompressibility of an otherwise non-Hamiltonian instantaneous map, one can design a combined instantaneous scaling that, in addition to $\\mathbf{p}\\mapsto \\alpha\\,\\mathbf{p}$, rescales coordinates and masses as $\\mathbf{q}\\mapsto \\beta\\,\\mathbf{q}$ with $\\beta>0$ and $\\mathbf{m}\\mapsto \\gamma\\,\\mathbf{m}$ with $\\gamma>0$. Treating $(\\mathbf{q},\\mathbf{p},\\mathbf{m})$ as coordinates on the extended space with measure $\\mathrm{d}\\mathbf{q}\\,\\mathrm{d}\\mathbf{p}\\,\\mathrm{d}\\mathbf{m}$, compute the magnitude of the Jacobian determinant of the combined map and derive the condition on $\\beta$ and $\\gamma$ (in terms of $\\alpha$) that makes the extended-space volume element invariant, that is, $|\\det J|=1$.\n\nReport your final result as a row matrix containing, in this order: (i) the magnitude of the Jacobian determinant for the pure momentum scaling in part 1, and (ii) the explicit expression for $\\gamma$ as a function of $\\alpha$ and $\\beta$ that guarantees $|\\det J|=1$ in part 2. No numerical evaluation is required; provide a closed-form analytic expression. Do not include any units in your final answer.",
            "solution": "The solution requires computing the Jacobian determinants for two specified coordinate transformations. The Jacobian determinant of a transformation measures the factor by which volume elements are stretched or compressed.\n\n**Part 1: Jacobian of the Momentum Rescaling**\n\nLet the initial coordinates be denoted by $X = (\\mathbf{q}, \\mathbf{p})$ and the transformed coordinates by $X' = (\\mathbf{q}', \\mathbf{p}')$. The transformation is given by:\n$$ \\mathbf{q}' = \\mathbf{q} $$\n$$ \\mathbf{p}' = \\alpha \\mathbf{p} $$\nThe phase space is $6N$-dimensional, with coordinates $(q_{1,1}, \\dots, q_{N,3}, p_{1,1}, \\dots, p_{N,3})$. The Jacobian matrix of the transformation, $J_1$, is a $6N \\times 6N$ matrix whose elements are $J_{ij} = \\frac{\\partial X'_i}{\\partial X_j}$. Due to the structure of the transformation, this matrix is block-diagonal:\n$$ J_1 = \\begin{pmatrix} \\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{q}} & \\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{p}} \\\\ \\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{q}} & \\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{p}} \\end{pmatrix} $$\nWe evaluate each block:\n- $\\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{q}}$: Since $\\mathbf{q}' = \\mathbf{q}$, this is the $3N \\times 3N$ identity matrix, $I_{3N}$.\n- $\\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{p}}$: Since $\\mathbf{q}'$ has no dependence on $\\mathbf{p}$, this is the $3N \\times 3N$ zero matrix, $0_{3N \\times 3N}$.\n- $\\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{q}}$: Since $\\mathbf{p}'$ has no dependence on $\\mathbf{q}$, this is the $3N \\times 3N$ zero matrix, $0_{3N \\times 3N}$.\n- $\\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{p}}$: Since $\\mathbf{p}' = \\alpha \\mathbf{p}$, the derivative of the $i$-th component of $\\mathbf{p}'$ with respect to the $j$-th component of $\\mathbf{p}$ is $\\frac{\\partial (\\alpha p_i)}{\\partial p_j} = \\alpha \\delta_{ij}$. Thus, this block is $\\alpha$ times the $3N \\times 3N$ identity matrix, $\\alpha I_{3N}$.\n\nThe Jacobian matrix is therefore:\n$$ J_1 = \\begin{pmatrix} I_{3N} & 0_{3N \\times 3N} \\\\ 0_{3N \\times 3N} & \\alpha I_{3N} \\end{pmatrix} $$\nThe determinant of a block-diagonal matrix is the product of the determinants of its diagonal blocks:\n$$ \\det(J_1) = \\det(I_{3N}) \\cdot \\det(\\alpha I_{3N}) $$\nThe determinant of an identity matrix is $1$. The determinant of a scalar multiple of the identity matrix $cI_k$ is $c^k$. Therefore:\n$$ \\det(J_1) = 1 \\cdot \\alpha^{3N} = \\alpha^{3N} $$\nSince $\\alpha > 0$, the determinant is positive, and its magnitude is $|\\det(J_1)| = \\alpha^{3N}$.\n\n**Part 2: Jacobian of the Combined Scaling in Extended Space**\n\nLet the initial coordinates in the extended space be $Y = (\\mathbf{q}, \\mathbf{p}, \\mathbf{m})$ and the transformed coordinates be $Y' = (\\mathbf{q}', \\mathbf{p}', \\mathbf{m}')$. The transformation is defined by:\n$$ \\mathbf{q}' = \\beta \\mathbf{q} $$\n$$ \\mathbf{p}' = \\alpha \\mathbf{p} $$\n$$ \\mathbf{m}' = \\gamma \\mathbf{m} $$\nThe dimension of this extended space is $3N + 3N + N = 7N$. The Jacobian matrix of this transformation, $J_2$, is a $7N \\times 7N$ matrix. As the transformations on $\\mathbf{q}$, $\\mathbf{p}$, and $\\mathbf{m}$ are mutually independent, the Jacobian matrix is block-diagonal:\n$$ J_2 = \\begin{pmatrix} \\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{q}} & 0 & 0 \\\\ 0 & \\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{p}} & 0 \\\\ 0 & 0 & \\frac{\\partial \\mathbf{m}'}{\\partial \\mathbf{m}} \\end{pmatrix} $$\nWe compute the determinant of each block:\n- $\\frac{\\partial \\mathbf{q}'}{\\partial \\mathbf{q}}$: This is the $3N \\times 3N$ matrix $\\beta I_{3N}$. Its determinant is $\\det(\\beta I_{3N}) = \\beta^{3N}$.\n- $\\frac{\\partial \\mathbf{p}'}{\\partial \\mathbf{p}}$: This is the $3N \\times 3N$ matrix $\\alpha I_{3N}$. Its determinant is $\\det(\\alpha I_{3N}) = \\alpha^{3N}$.\n- $\\frac{\\partial \\mathbf{m}'}{\\partial \\mathbf{m}}$: This is the $N \\times N$ matrix $\\gamma I_{N}$. Its determinant is $\\det(\\gamma I_{N}) = \\gamma^{N}$.\n\nThe determinant of the full Jacobian $J_2$ is the product of the determinants of these blocks:\n$$ \\det(J_2) = \\det(\\beta I_{3N}) \\cdot \\det(\\alpha I_{3N}) \\cdot \\det(\\gamma I_{N}) = \\beta^{3N} \\alpha^{3N} \\gamma^{N} $$\nThe problem requires the magnitude of the Jacobian to be unity, which enforces the invariance of the extended volume element $\\mathrm{d}\\mathbf{q}\\,\\mathrm{d}\\mathbf{p}\\,\\mathrm{d}\\mathbf{m}$. Since $\\alpha, \\beta, \\gamma > 0$, the determinant is positive, so we set $\\det(J_2) = 1$:\n$$ \\alpha^{3N} \\beta^{3N} \\gamma^{N} = 1 $$\nTo find the condition on $\\gamma$, we solve for it:\n$$ \\gamma^{N} = (\\alpha^{3N} \\beta^{3N})^{-1} = \\alpha^{-3N} \\beta^{-3N} = (\\alpha \\beta)^{-3N} $$\nTaking the $N$-th root of both sides (and knowing $\\gamma > 0$):\n$$ \\gamma = \\left( (\\alpha \\beta)^{-3N} \\right)^{1/N} = (\\alpha \\beta)^{-3} = \\frac{1}{(\\alpha \\beta)^3} $$\nThis is the required condition on $\\gamma$ to ensure the transformation is volume-preserving in the extended space.\n\nThe final results are $|\\det(J_1)| = \\alpha^{3N}$ for part 1, and the expression $\\gamma = (\\alpha \\beta)^{-3}$ for part 2.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\alpha^{3N} & (\\alpha \\beta)^{-3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "With the Jacobian as our tool, we can now analyze the very algorithms used to propagate dynamics. While Hamiltonian flows are perfectly volume-preserving, their numerical approximations may not be. This problem  explores a subtle but critical issue in algorithm design: the use of an adaptive, state-dependent time step. By deriving the Jacobian determinant of a generic one-step integrator, you will uncover the precise mathematical reason why this seemingly efficient optimization can violate phase space incompressibility, a key insight for ensuring the long-term stability of simulations.",
            "id": "3421858",
            "problem": "Consider a $2N$-dimensional molecular dynamics system evolving under Hamiltonian dynamics with Hamiltonian $H(q,p)$ and phase space point $\\Gamma = (q,p) \\in \\mathbb{R}^{2N}$. Let $\\mathbb{J}$ denote the canonical symplectic matrix, and define the Hamiltonian phase space velocity field by $v(\\Gamma) = \\mathbb{J}\\nabla H(\\Gamma)$. The exact Hamiltonian flow satisfies phase space incompressibility (Liouville's theorem), meaning the divergence of $v(\\Gamma)$ is zero.\n\nA commonly used one-step numerical integrator in molecular dynamics can be written as a map $\\Phi: \\mathbb{R}^{2N} \\to \\mathbb{R}^{2N}$ defined by\n$$\n\\Phi(\\Gamma) = \\Gamma + \\Delta t(\\Gamma)\\, v(\\Gamma),\n$$\nwhere $\\Delta t(\\Gamma)$ is a smooth, strictly positive, state-dependent adaptive time-step. Assume that $\\Delta t(\\Gamma)$ is small enough to justify truncation at first order in $\\Delta t$ and its spatial derivatives.\n\nUsing only foundational definitions from vector calculus and Hamiltonian dynamics (Jacobian matrices, determinants, divergence, and Hamilton's equations), compute the first-order expression for the Jacobian determinant $\\det\\left(D\\Phi(\\Gamma)\\right)$ of the one-step map $\\Phi$. Express your final answer as a closed-form analytic expression in terms of $\\Delta t(\\Gamma)$, $v(\\Gamma)$, and their derivatives, simplified using the incompressibility of Hamiltonian flows. The final answer must be a single analytic expression without units. Do not include terms beyond first order.",
            "solution": "The objective is to compute the Jacobian determinant of the one-step map $\\Phi(\\Gamma)$ to first order in the adaptive time-step $\\Delta t(\\Gamma)$ and its derivatives.\n\nThe map is given by:\n$$\n\\Phi(\\Gamma) = \\Gamma + \\Delta t(\\Gamma)\\, v(\\Gamma)\n$$\nwhere $\\Gamma \\in \\mathbb{R}^{2N}$ is the phase space vector, $v(\\Gamma)$ is the Hamiltonian vector field, and $\\Delta t(\\Gamma)$ is the state-dependent time-step.\n\nWe begin by computing the Jacobian matrix of the map, $D\\Phi(\\Gamma)$. The elements of this matrix are given by $(D\\Phi)_{ij} = \\frac{\\partial \\Phi_i}{\\partial \\Gamma_j}$ for $i, j \\in \\{1, \\dots, 2N\\}$. Writing the map in component form:\n$$\n\\Phi_i(\\Gamma) = \\Gamma_i + \\Delta t(\\Gamma)\\, v_i(\\Gamma)\n$$\nWe differentiate with respect to the component $\\Gamma_j$ using the product rule for differentiation:\n$$\n\\frac{\\partial \\Phi_i}{\\partial \\Gamma_j} = \\frac{\\partial \\Gamma_i}{\\partial \\Gamma_j} + \\frac{\\partial}{\\partial \\Gamma_j} \\left( \\Delta t(\\Gamma)\\, v_i(\\Gamma) \\right)\n$$\n$$\n\\frac{\\partial \\Phi_i}{\\partial \\Gamma_j} = \\delta_{ij} + v_i(\\Gamma) \\frac{\\partial \\Delta t(\\Gamma)}{\\partial \\Gamma_j} + \\Delta t(\\Gamma) \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_j}\n$$\nwhere $\\delta_{ij}$ is the Kronecker delta, representing the components of the identity matrix $\\mathbb{I}$.\n\nThe Jacobian matrix $D\\Phi(\\Gamma)$ can therefore be written as:\n$$\nD\\Phi(\\Gamma) = \\mathbb{I} + A(\\Gamma)\n$$\nwhere $A(\\Gamma)$ is a matrix whose components are:\n$$\nA_{ij} = v_i(\\Gamma) \\frac{\\partial \\Delta t(\\Gamma)}{\\partial \\Gamma_j} + \\Delta t(\\Gamma) \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_j}\n$$\nThe problem states that we should truncate at first order in $\\Delta t$ and its derivatives. The matrix $A(\\Gamma)$ contains all the first-order terms.\n\nNext, we compute the determinant of $D\\Phi(\\Gamma)$. We use the general identity for the determinant of a matrix that is a small perturbation of the identity matrix: for any matrix $M$,\n$$\n\\det(\\mathbb{I} + \\epsilon M) = 1 + \\epsilon \\operatorname{Tr}(M) + O(\\epsilon^2)\n$$\nIn our case, the matrix $A(\\Gamma)$ plays the role of the perturbation. Since its terms are first-order in $\\Delta t$ and its derivatives, retaining terms up to first order in the determinant gives:\n$$\n\\det(D\\Phi(\\Gamma)) \\approx 1 + \\operatorname{Tr}(A(\\Gamma))\n$$\nNow, we must compute the trace of the matrix $A(\\Gamma)$. The trace is the sum of the diagonal elements:\n$$\n\\operatorname{Tr}(A(\\Gamma)) = \\sum_{i=1}^{2N} A_{ii} = \\sum_{i=1}^{2N} \\left( v_i(\\Gamma) \\frac{\\partial \\Delta t(\\Gamma)}{\\partial \\Gamma_i} + \\Delta t(\\Gamma) \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_i} \\right)\n$$\nWe can separate this sum into two parts:\n$$\n\\operatorname{Tr}(A(\\Gamma)) = \\sum_{i=1}^{2N} v_i(\\Gamma) \\frac{\\partial \\Delta t(\\Gamma)}{\\partial \\Gamma_i} + \\sum_{i=1}^{2N} \\Delta t(\\Gamma) \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_i}\n$$\nLet's analyze each part. The first sum is the definition of the dot product between the vector field $v(\\Gamma)$ and the gradient of the scalar field $\\Delta t(\\Gamma)$:\n$$\n\\sum_{i=1}^{2N} v_i(\\Gamma) \\frac{\\partial \\Delta t(\\Gamma)}{\\partial \\Gamma_i} = v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma))\n$$\nIn the second sum, $\\Delta t(\\Gamma)$ is a scalar function and can be factored out of the summation:\n$$\n\\sum_{i=1}^{2N} \\Delta t(\\Gamma) \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_i} = \\Delta t(\\Gamma) \\sum_{i=1}^{2N} \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_i}\n$$\nThe remaining sum is the definition of the divergence of the vector field $v(\\Gamma)$:\n$$\n\\sum_{i=1}^{2N} \\frac{\\partial v_i(\\Gamma)}{\\partial \\Gamma_i} = \\nabla \\cdot v(\\Gamma)\n$$\nCombining these results, the trace of $A(\\Gamma)$ is:\n$$\n\\operatorname{Tr}(A(\\Gamma)) = v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma)) + \\Delta t(\\Gamma) (\\nabla \\cdot v(\\Gamma))\n$$\nThe problem statement provides the crucial information that the exact Hamiltonian flow is incompressible, which is Liouville's theorem. This means the divergence of the Hamiltonian vector field is zero:\n$$\n\\nabla \\cdot v(\\Gamma) = 0\n$$\nApplying this condition to our expression for the trace simplifies it significantly:\n$$\n\\operatorname{Tr}(A(\\Gamma)) = v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma)) + \\Delta t(\\Gamma) (0) = v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma))\n$$\nFinally, we substitute this simplified trace back into our first-order approximation for the determinant:\n$$\n\\det(D\\Phi(\\Gamma)) = 1 + \\operatorname{Tr}(A(\\Gamma)) = 1 + v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma))\n$$\nThis expression represents the change in phase space volume element under one step of the numerical map. It shows that the volume is not preserved (i.e., $\\det(D\\Phi) \\neq 1$) if the time-step $\\Delta t$ is state-dependent, with the deviation from unity being proportional to the projection of the time-step gradient onto the phase space velocity.",
            "answer": "$$\n\\boxed{1 + v(\\Gamma) \\cdot \\nabla(\\Delta t(\\Gamma))}\n$$"
        },
        {
            "introduction": "Theoretical insights are powerful, but their practical consequences are what truly matter in simulation science. This final practice moves from analytical derivation to computational verification, providing a direct, hands-on demonstration of phase space conservation. You will implement and compare two classic integrators: the symplectic Velocity Verlet algorithm and the non-symplectic fourth-order Runge-Kutta method . By numerically tracking the evolution of a phase space volume element, you will witness firsthand the superior long-term stability of symplectic integrators, confirming why they are the bedrock of modern molecular dynamics.",
            "id": "3421857",
            "problem": "Consider a one-dimensional anharmonic oscillator with Hamiltonian $$H(q,p)=\\frac{p^2}{2m}+\\frac{k}{2}q^2+\\frac{\\alpha}{4}q^4,$$ where $q$ is position, $p$ is momentum, $m$ is mass, $k$ is a linear stiffness, and $\\alpha$ is a quartic anharmonic coefficient. The associated Hamilton's equations are $$\\dot{q}=\\frac{p}{m},\\quad \\dot{p}=-\\frac{\\partial V}{\\partial q}=-k\\,q-\\alpha\\,q^3.$$ Define the phase-space flow map $\\Gamma_t:\\,(q_0,p_0)\\mapsto (q(t),p(t))$, where $(q(t),p(t))$ is the state at time $t$ evolved from the initial condition $(q_0,p_0)$ under these equations.\n\nLiouville's theorem states that the divergence of the Hamiltonian vector field in canonical coordinates is zero, implying that the exact flow preserves phase-space volume. Numerically, one integrates the ordinary differential equations using discrete time steps $\\Delta t$ and a chosen integration algorithm. A symplectic method, such as velocity Verlet, is designed to preserve the symplectic structure and hence phase-space volume, while a general method like the classical fourth-order Runge–Kutta method may not. To quantify phase-space volume change induced by a numerical flow over a finite time, one can estimate the determinant of the Jacobian of the flow map with respect to the initial condition. Specifically, for $t=N\\Delta t$, define the discrete numerical flow map $\\Phi_{N\\Delta t}$ induced by a given integrator, and estimate $$\\left|\\det\\left(\\frac{\\partial \\Gamma_t}{\\partial \\Gamma_0}\\right)\\right|\\approx \\left|\\det\\left(\\frac{\\partial \\Phi_{N\\Delta t}}{\\partial (q_0,p_0)}\\right)\\right|.$$ For the exact Hamiltonian flow, this determinant should be $1$ for all $t$. Deviations from $1$ indicate phase-space compressibility or expansion introduced by the numerical method.\n\nYour task is to write a complete program that:\n- Implements two time-discretization methods to approximate the flow $\\Phi_{N\\Delta t}$:\n  1. Velocity Verlet (a symplectic scheme) applied to the separable Hamiltonian $H(q,p)=T(p)+V(q)$ with $T(p)=p^2/(2m)$ and $V(q)=(k/2)q^2+(\\alpha/4)q^4$.\n  2. Classical fourth-order Runge–Kutta (RK4) applied directly to the system $\\dot{q}=p/m$ and $\\dot{p}=-kq-\\alpha q^3$.\n- Approximates the Jacobian matrix $\\partial \\Phi_{N\\Delta t}/\\partial (q_0,p_0)$ at a given $(q_0,p_0)$ via central finite differences using a perturbation of magnitude $\\varepsilon>0$ in the basis directions of the initial condition:\n  - The first column is approximated as $$\\frac{1}{2\\varepsilon}\\left(\\Phi_{N\\Delta t}(q_0+\\varepsilon,p_0)-\\Phi_{N\\Delta t}(q_0-\\varepsilon,p_0)\\right),$$\n  - The second column as $$\\frac{1}{2\\varepsilon}\\left(\\Phi_{N\\Delta t}(q_0,p_0+\\varepsilon)-\\Phi_{N\\Delta t}(q_0,p_0-\\varepsilon)\\right).$$\n- Computes the determinant of this $2\\times 2$ Jacobian matrix for both methods and returns the absolute deviation from unity, namely $$E=\\left|\\det(J)-1\\right|.$$\n\nAll quantities are nondimensional; no physical units are required. Angles do not appear in this problem. Use the following fixed perturbation magnitude for finite differences: $\\varepsilon=10^{-7}$.\n\nImplement the program to evaluate the following test suite. In all cases, set $m=1$, $k=1$, and $\\alpha=0.2$. Let the total evolution time be $t=N\\Delta t$ with $N=\\text{round}(t/\\Delta t)$, where $t$ and $\\Delta t$ are chosen to make $t/\\Delta t$ an integer by construction.\n\nTest suite (each case is a tuple $(q_0,p_0,\\Delta t,t)$):\n1. $(q_0,p_0,\\Delta t,t)=\\left(0.5,\\,0.0,\\,0.01,\\,10\\right)$,\n2. $(q_0,p_0,\\Delta t,t)=\\left(1.0,\\,1.0,\\,0.1,\\,10\\right)$,\n3. $(q_0,p_0,\\Delta t,t)=\\left(0.0,\\,2.0,\\,0.25,\\,10\\right)$,\n4. $(q_0,p_0,\\Delta t,t)=\\left(-1.0,\\,0.5,\\,0.01,\\,100\\right)$.\n\nFor each test case, compute two floating-point numbers:\n- $E_{\\text{VV}}=\\left|\\det(J_{\\text{VV}})-1\\right|$ using velocity Verlet,\n- $E_{\\text{RK4}}=\\left|\\det(J_{\\text{RK4}})-1\\right|$ using RK4.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by test case and method as:\n$$\\left[E_{\\text{VV}}^{(1)},E_{\\text{RK4}}^{(1)},E_{\\text{VV}}^{(2)},E_{\\text{RK4}}^{(2)},E_{\\text{VV}}^{(3)},E_{\\text{RK4}}^{(3)},E_{\\text{VV}}^{(4)},E_{\\text{RK4}}^{(4)}\\right],$$\nwith each float formatted to $10$ decimal places.",
            "solution": "The goal is to assess phase-space volume preservation properties of two numerical integrators for a one-dimensional anharmonic oscillator by estimating the determinant of the Jacobian of the numerical flow map with respect to the initial condition. The starting point is Hamilton's equations derived from the Hamiltonian $$H(q,p)=\\frac{p^2}{2m}+\\frac{k}{2}q^2+\\frac{\\alpha}{4}q^4.$$ The canonical equations of motion are $$\\dot{q}=\\frac{\\partial H}{\\partial p}=\\frac{p}{m},\\quad \\dot{p}=-\\frac{\\partial H}{\\partial q}=-k\\,q-\\alpha\\,q^3.$$ The exact flow generated by these equations is volume-preserving in the phase space $(q,p)$ according to Liouville's theorem. The theorem follows from the divergence of the Hamiltonian vector field, which is $$\\nabla\\cdot(\\dot{q},\\dot{p})=\\frac{\\partial \\dot{q}}{\\partial q}+\\frac{\\partial \\dot{p}}{\\partial p}=\\frac{\\partial}{\\partial q}\\left(\\frac{p}{m}\\right)+\\frac{\\partial}{\\partial p}\\left(-\\frac{\\partial H}{\\partial q}\\right)=0+0=0,$$ since $\\dot{q}$ depends only on $p$ and $\\dot{p}$ depends only on $q$ in canonical coordinates. A zero divergence implies the volume element in phase space is preserved under the continuous flow, which yields $$\\left|\\det\\left(\\frac{\\partial \\Gamma_t}{\\partial \\Gamma_0}\\right)\\right|=1$$ for all times $t$.\n\nFor numerical integration, we consider two discrete-time maps $\\Phi_{\\Delta t}$:\n1. Velocity Verlet, derived by Strang splitting of the separable Hamiltonian $H=T(p)+V(q)$. Each sub-flow (kinetic and potential) is an exact canonical transformation with unit Jacobian determinant, and their symmetric composition yields a symplectic, time-reversible map. Therefore, in exact arithmetic, the composed discrete map is symplectic with $\\left|\\det\\left(\\partial \\Phi_{N\\Delta t}/\\partial (q_0,p_0)\\right)\\right|=1$ for any step size, although numerical roundoff and finite-difference approximation may introduce small deviations from unity.\n2. Classical fourth-order Runge–Kutta (RK4), which accurately approximates local truncation errors but is not symplectic for general Hamiltonian systems. As such, it does not strictly preserve the symplectic form nor phase-space volume, and deviations of $\\left|\\det\\left(\\partial \\Phi_{N\\Delta t}/\\partial (q_0,p_0)\\right)\\right|$ from $1$ are expected to accumulate with larger step sizes and longer integration times.\n\nTo estimate the Jacobian $\\partial \\Phi_{N\\Delta t}/\\partial (q_0,p_0)$ at a given initial condition $(q_0,p_0)$ for a chosen integrator, we compute the numerical flow $\\Phi_{N\\Delta t}$ by iterating the one-step map $N$ times, where $N=t/\\Delta t$ is an integer. The Jacobian is approximated via central finite differences in the directions of the initial condition basis vectors:\n- Let $\\varepsilon>0$ be a small scalar. Compute perturbed final states:\n  - $(q^{+q},p^{+q})=\\Phi_{N\\Delta t}(q_0+\\varepsilon,p_0)$ and $(q^{-q},p^{-q})=\\Phi_{N\\Delta t}(q_0-\\varepsilon,p_0)$,\n  - $(q^{+p},p^{+p})=\\Phi_{N\\Delta t}(q_0,p_0+\\varepsilon)$ and $(q^{-p},p^{-p})=\\Phi_{N\\Delta t}(q_0,p_0-\\varepsilon)$.\n- Form the numerical Jacobian matrix $J\\in\\mathbb{R}^{2\\times 2}$ with columns\n  $$J_{:,1}=\\frac{1}{2\\varepsilon}\\begin{bmatrix}q^{+q}-q^{-q}\\\\p^{+q}-p^{-q}\\end{bmatrix},\\quad J_{:,2}=\\frac{1}{2\\varepsilon}\\begin{bmatrix}q^{+p}-q^{-p}\\\\p^{+p}-p^{-p}\\end{bmatrix}.$$\n- Compute the determinant $\\det(J)$ and report the absolute deviation from unity $E=\\left|\\det(J)-1\\right|$.\n\nFor velocity Verlet, the one-step map is constructed by half a momentum update using the force $F(q)=-\\partial V/\\partial q=-k\\,q-\\alpha\\,q^3$, followed by a full position update using the updated half-step momentum, and then another half-step momentum update using the force evaluated at the new position. Explicitly, denoting $(q_n,p_n)$ as the state at discrete time $n$, the updates are:\n- Half-step momentum: $p_{n+\\frac{1}{2}}=p_n+\\frac{\\Delta t}{2}F(q_n)$,\n- Full position: $q_{n+1}=q_n+\\Delta t\\,\\frac{p_{n+\\frac{1}{2}}}{m}$,\n- Half-step momentum: $p_{n+1}=p_{n+\\frac{1}{2}}+\\frac{\\Delta t}{2}F(q_{n+1})$.\nThis map is symplectic due to the composition of exact sub-flows of $T$ and $V$.\n\nFor RK4, the one-step map applies the classical fourth-order scheme to the vector field $(\\dot{q},\\dot{p})=(p/m,-k\\,q-\\alpha\\,q^3)$. With $x=(q,p)$ and $f(x)=(p/m,\\,-k\\,q-\\alpha\\,q^3)$, the step is\n$$x_{n+1}=x_n+\\frac{\\Delta t}{6}\\left(k_1+2k_2+2k_3+k_4\\right),$$\nwhere $k_1=f(x_n)$, $k_2=f\\left(x_n+\\frac{\\Delta t}{2}k_1\\right)$, $k_3=f\\left(x_n+\\frac{\\Delta t}{2}k_2\\right)$, and $k_4=f\\left(x_n+\\Delta t\\,k_3\\right)$.\n\nUsing the specified test suite with $m=1$, $k=1$, $\\alpha=0.2$, and $\\varepsilon=10^{-7}$, the program integrates each case for both methods, constructs the finite-difference Jacobian, computes $\\det(J)$, and outputs the list of eight floats\n$$\\left[E_{\\text{VV}}^{(1)},E_{\\text{RK4}}^{(1)},E_{\\text{VV}}^{(2)},E_{\\text{RK4}}^{(2)},E_{\\text{VV}}^{(3)},E_{\\text{RK4}}^{(3)},E_{\\text{VV}}^{(4)},E_{\\text{RK4}}^{(4)}\\right],$$\neach formatted to $10$ decimal places. The expectation, grounded in Liouville's theorem and the properties of symplectic integrators, is that $E_{\\text{VV}}$ will be near machine precision across the cases, while $E_{\\text{RK4}}$ will generally be larger and increase with the step size $\\Delta t$ and total integration time $t$, reflecting phase-space volume deviation introduced by the non-symplectic discretization.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef force(q, k, alpha):\n    # Force F(q) = -dV/dq = -k*q - alpha*q^3\n    return -k * q - alpha * (q ** 3)\n\ndef velocity_verlet_flow(q0, p0, dt, steps, m, k, alpha):\n    q = float(q0)\n    p = float(p0)\n    for _ in range(steps):\n        p_half = p + 0.5 * dt * force(q, k, alpha)\n        q = q + dt * (p_half / m)\n        p = p_half + 0.5 * dt * force(q, k, alpha)\n    return np.array([q, p], dtype=np.float64)\n\ndef rk4_flow(q0, p0, dt, steps, m, k, alpha):\n    q = float(q0)\n    p = float(p0)\n\n    def f(q, p):\n        dqdt = p / m\n        dpdt = -k * q - alpha * (q ** 3)\n        return dqdt, dpdt\n\n    for _ in range(steps):\n        k1_q, k1_p = f(q, p)\n        k2_q, k2_p = f(q + 0.5 * dt * k1_q, p + 0.5 * dt * k1_p)\n        k3_q, k3_p = f(q + 0.5 * dt * k2_q, p + 0.5 * dt * k2_p)\n        k4_q, k4_p = f(q + dt * k3_q, p + dt * k3_p)\n\n        q += (dt / 6.0) * (k1_q + 2.0 * k2_q + 2.0 * k3_q + k4_q)\n        p += (dt / 6.0) * (k1_p + 2.0 * k2_p + 2.0 * k3_p + k4_p)\n    return np.array([q, p], dtype=np.float64)\n\ndef jacobian_det_numeric(flow_func, q0, p0, dt, steps, m, k, alpha, eps):\n    # Central finite differences to approximate Jacobian columns\n    x_plus_q = flow_func(q0 + eps, p0, dt, steps, m, k, alpha)\n    x_minus_q = flow_func(q0 - eps, p0, dt, steps, m, k, alpha)\n    col_q = (x_plus_q - x_minus_q) / (2.0 * eps)\n\n    x_plus_p = flow_func(q0, p0 + eps, dt, steps, m, k, alpha)\n    x_minus_p = flow_func(q0, p0 - eps, dt, steps, m, k, alpha)\n    col_p = (x_plus_p - x_minus_p) / (2.0 * eps)\n\n    J = np.column_stack((col_q, col_p))\n    detJ = J[0, 0] * J[1, 1] - J[0, 1] * J[1, 0]\n    return detJ\n\ndef solve():\n    # Parameters\n    m = 1.0\n    k = 1.0\n    alpha = 0.2\n    eps = 1e-7\n\n    # Define the test cases from the problem statement:\n    # Each test case: (q0, p0, dt, t)\n    test_cases = [\n        (0.5, 0.0, 0.01, 10.0),\n        (1.0, 1.0, 0.1, 10.0),\n        (0.0, 2.0, 0.25, 10.0),\n        (-1.0, 0.5, 0.01, 100.0),\n    ]\n\n    results = []\n    for (q0, p0, dt, t_total) in test_cases:\n        steps = int(round(t_total / dt))\n        # Velocity Verlet\n        det_vv = jacobian_det_numeric(velocity_verlet_flow, q0, p0, dt, steps, m, k, alpha, eps)\n        err_vv = abs(det_vv - 1.0)\n        results.append(f\"{err_vv:.10f}\")\n\n        # RK4\n        det_rk4 = jacobian_det_numeric(rk4_flow, q0, p0, dt, steps, m, k, alpha, eps)\n        err_rk4 = abs(det_rk4 - 1.0)\n        results.append(f\"{err_rk4:.10f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}