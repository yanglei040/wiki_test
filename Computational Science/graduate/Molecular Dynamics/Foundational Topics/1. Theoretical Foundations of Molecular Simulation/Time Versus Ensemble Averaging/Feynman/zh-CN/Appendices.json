{
    "hands_on_practices": [
        {
            "introduction": "对于一个遍历系统，有限时间的模拟只能给出系综平均值的一个估计。此练习将推导一个关键关系，它通过自相关函数将模拟时长与该估计的统计误差联系起来，这是评估模拟数据质量的基本功。",
            "id": "3455645",
            "problem": "考虑从一个温度为 $T_{\\mathrm{therm}}$ 的稳态遍历系统的长时间平衡分子动力学 (MD) 轨迹中记录的单个标量可观测量 $A(t)$。定义涨落 $\\delta A(t) = A(t) - \\langle A \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示系综平均，在有限轨迹长度 $T$ 上的时间平均定义为\n$$\n\\overline{A}_T = \\frac{1}{T} \\int_{0}^{T} A(t) \\, dt.\n$$\n令自协方差函数为 $C_A(t) = \\langle \\delta A(0) \\, \\delta A(t) \\rangle$，假设其是稳态的，因此 $C_A(t)$ 仅依赖于时间差，并假设 $C_A(t)$ 按指数形式衰减\n$$\nC_A(t) = C_A(0) \\, \\exp\\!\\left(-\\frac{|t|}{\\tau}\\right),\n$$\n其中 $C_A(0)$ 是方差 $\\langle \\delta A^2 \\rangle$，$\\tau$ 是特征衰减时间。对于稳态过程，时间平均 $\\overline{A}_T$ 的方差可以根据第一性原理用 $C_A(t)$ 表示。有效样本量 $N_{\\mathrm{eff}}$ 被定义为，如果 $\\delta A$ 是独立同分布的，能够产生与 $\\overline{A}_T$ 相同方差的统计独立样本数量，即通过将 $\\mathrm{Var}(\\overline{A}_T)$ 等同于 $C_A(0)/N_{\\mathrm{eff}}$ 来定义。\n\n从 $\\overline{A}_T$ 的定义和稳态自协方差的性质出发，在 $C_A(t)$ 指数衰减的假设下，推导 $N_{\\mathrm{eff}}$ 和时间平均的标准误差 $\\mathrm{SE}(\\overline{A}_T) = \\sqrt{\\mathrm{Var}(\\overline{A}_T)}$ 关于 $T$、$\\tau$ 和 $C_A(0)$ 的大 $T$ 渐近表达式。\n\n将你的最终答案以包含封闭形式解析表达式的行向量 $(N_{\\mathrm{eff}}, \\mathrm{SE}(\\overline{A}_T))$ 的形式报告。不需要进行数值计算。",
            "solution": "问题陈述具有科学依据，提法恰当，客观且内部一致。它提出了一个在分子动力学模拟时间序列统计分析中标准的、但并非无足轻重的理论练习。所有必要的定义和条件都已提供，以推导出一个唯一且有意义的解。因此，该问题被认为是有效的。\n\n目标是推导有效样本量 $N_{\\mathrm{eff}}$ 和时间平均的标准误差 $\\mathrm{SE}(\\overline{A}_T)$ 的大 $T$ 渐近表达式。我们从时间平均可观测量 $\\overline{A}_T$ 的方差定义开始。\n\n$\\overline{A}_T$ 的方差由 $\\mathrm{Var}(\\overline{A}_T) = \\langle (\\overline{A}_T - \\langle \\overline{A}_T \\rangle)^2 \\rangle$ 给出。\n对于一个稳态过程，系综平均 $\\langle A(t) \\rangle$ 在所有时间 $t$ 上都是恒定的，并且等于 $\\langle A \\rangle$。于是，时间平均的期望值为：\n$$\n\\langle \\overline{A}_T \\rangle = \\left\\langle \\frac{1}{T} \\int_{0}^{T} A(t) \\, dt \\right\\rangle = \\frac{1}{T} \\int_{0}^{T} \\langle A(t) \\rangle \\, dt = \\frac{1}{T} \\int_{0}^{T} \\langle A \\rangle \\, dt = \\frac{1}{T} (T \\langle A \\rangle) = \\langle A \\rangle\n$$\n因此，时间平均值与真实平均值的偏差为：\n$$\n\\overline{A}_T - \\langle A \\rangle = \\frac{1}{T} \\int_{0}^{T} A(t) \\, dt - \\langle A \\rangle = \\frac{1}{T} \\int_{0}^{T} (A(t) - \\langle A \\rangle) \\, dt = \\frac{1}{T} \\int_{0}^{T} \\delta A(t) \\, dt\n$$\n于是，方差用涨落 $\\delta A(t)$ 表示为：\n$$\n\\mathrm{Var}(\\overline{A}_T) = \\left\\langle \\left( \\frac{1}{T} \\int_{0}^{T} \\delta A(t) \\, dt \\right)^2 \\right\\rangle = \\frac{1}{T^2} \\left\\langle \\int_{0}^{T} dt_1 \\int_{0}^{T} dt_2 \\, \\delta A(t_1) \\delta A(t_2) \\right\\rangle\n$$\n根据 Fubini 定理，我们可以交换期望和积分算子：\n$$\n\\mathrm{Var}(\\overline{A}_T) = \\frac{1}{T^2} \\int_{0}^{T} dt_1 \\int_{0}^{T} dt_2 \\, \\langle \\delta A(t_1) \\delta A(t_2) \\rangle\n$$\n积分内的项是自协方差函数。由于稳态性，它仅依赖于时间差 $t_2 - t_1$：\n$$\nC_A(t_2 - t_1) = \\langle \\delta A(t_1) \\delta A(t_2) \\rangle\n$$\n所以，方差变为：\n$$\n\\mathrm{Var}(\\overline{A}_T) = \\frac{1}{T^2} \\int_{0}^{T} dt_1 \\int_{0}^{T} dt_2 \\, C_A(t_2 - t_1)\n$$\n这个二重积分可以被简化。对于稳态过程，一个标准结果是：\n$$\n\\int_{0}^{T} dt_1 \\int_{0}^{T} dt_2 \\, C_A(t_2 - t_1) = 2 \\int_{0}^{T} (T-t) C_A(t) dt\n$$\n这给出的方差为：\n$$\n\\mathrm{Var}(\\overline{A}_T) = \\frac{2}{T^2} \\int_{0}^{T} (T-t) C_A(t) dt = \\frac{2}{T} \\int_{0}^{T} \\left(1 - \\frac{t}{T}\\right) C_A(t) dt\n$$\n现在，我们代入给定的自协方差函数指数形式，$C_A(t) = C_A(0) \\exp(-|t|/\\tau)$。对于 $t \\ge 0$，即为 $C_A(t) = C_A(0) \\exp(-t/\\tau)$。\n$$\n\\mathrm{Var}(\\overline{A}_T) = \\frac{2 C_A(0)}{T} \\int_{0}^{T} \\left(1 - \\frac{t}{T}\\right) \\exp\\left(-\\frac{t}{\\tau}\\right) dt\n$$\n问题要求大 $T$ 渐近表达式，这对应于 $T \\gg \\tau$ 的极限。在此极限下，积分主要由 $t$ 与 $\\tau$ 同数量级的区域贡献。对于这些 $t$ 值，项 $t/T$ 是可以忽略的，即 $t/T \\ll 1$。因此，因子 $(1 - t/T)$ 可以近似为 $1$。此外，由于 $T \\gg \\tau$，自协方差函数 $\\exp(-t/\\tau)$ 将在 $t$ 达到积分上限 $T$ 之前早已衰减到接近零。因此，我们可以将积分上限扩展到无穷大，而误差可以忽略不计。\n$$\n\\mathrm{Var}(\\overline{A}_T) \\approx \\frac{2 C_A(0)}{T} \\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau}\\right) dt\n$$\n剩余的积分是初等的：\n$$\n\\int_{0}^{\\infty} \\exp\\left(-\\frac{t}{\\tau}\\right) dt = \\left[-\\tau \\exp\\left(-\\frac{t}{\\tau}\\right)\\right]_{0}^{\\infty} = 0 - (-\\tau \\exp(0)) = \\tau\n$$\n将此结果代回，我们得到方差的渐近表达式：\n$$\n\\mathrm{Var}(\\overline{A}_T) \\approx \\frac{2 C_A(0) \\tau}{T}\n$$\n有效样本量 $N_{\\mathrm{eff}}$ 是通过将此方差与 $N_{\\mathrm{eff}}$ 个独立样本的平均值的方差（即 $C_A(0)/N_{\\mathrm{eff}}$）相等来定义的：\n$$\n\\frac{C_A(0)}{N_{\\mathrm{eff}}} = \\frac{2 C_A(0) \\tau}{T}\n$$\n假设是一个非平凡的可观测量，其中 $C_A(0) \\neq 0$，我们可以解出 $N_{\\mathrm{eff}}$：\n$$\nN_{\\mathrm{eff}} = \\frac{T}{2 \\tau}\n$$\n这个表达式表明，在长度为 $T$ 的相关时间序列中，有效独立样本的数量是总时间除以特征时间 $2\\tau$，后者代表了相关性持续的时间跨度。\n\n最后，时间平均的标准误差 $\\mathrm{SE}(\\overline{A}_T)$ 是其方差的平方根。使用我们得到的大 $T$ 方差渐近结果：\n$$\n\\mathrm{SE}(\\overline{A}_T) = \\sqrt{\\mathrm{Var}(\\overline{A}_T)} \\approx \\sqrt{\\frac{2 C_A(0) \\tau}{T}}\n$$\n这提供了从有限时间轨迹估计平均值的统计误差的渐近表达式。",
            "answer": "$$\n\\boxed{\n\\left( \\frac{T}{2 \\tau}, \\sqrt{\\frac{2 C_A(0) \\tau}{T}} \\right)\n}\n$$"
        },
        {
            "introduction": "遍历性假说并非理所当然，特定动力学系统可能无法充分探索其相空间。本练习通过分析一个著名的反例——Nosé-Hoover恒温器下的谐振子，让你从第一性原理出发，证明其时间平均值可以与系综平均值完全不符，从而揭示确定性恒温器的潜在缺陷。",
            "id": "3455646",
            "problem": "考虑一个质量为 $m$、力常数为 $k$ 的一维谐振子，其处于热力学温度 $T$ 下。其物理运动方程是牛顿方程，力为 $F(x)=-kx$。与努斯-胡佛（Nosé-Hoover）类型的确定性恒温器接触后，扩展系统根据以下常微分方程演化\n$$\n\\dot{x}=\\frac{p}{m},\\qquad \\dot{p}=-kx-\\xi\\,p,\\qquad \\dot{\\xi}=\\frac{1}{Q}\\left(\\frac{p^{2}}{m}-k_{B}T\\right),\n$$\n其中 $x$ 是坐标，$p$ 是共轭动量，$\\xi$ 是恒温器摩擦变量，$Q$ 是恒温器质量参数，$k_{B}$ 是玻尔兹曼常数。设初始条件为 $x(0)=0$，$p(0)=0$ 和 $\\xi(0)=0$。\n\n从平衡态统计力学（哈密顿量为 $H(x,p)=\\frac{p^{2}}{2m}+\\frac{kx^{2}}{2}$ 的正则系综）和经典动力学的第一性原理出发，完成以下任务：\n\n- 对于未与恒温器耦合的谐振子，在温度 $T$ 下推导其正则系综平均值 $\\langle x^{2}\\rangle_{\\mathrm{ens}}$。\n- 对于给定的初始条件，确定上述努斯-胡佛动力学产生的长时间平均值 $\\overline{x^{2}}=\\lim_{t\\to\\infty}\\frac{1}{t}\\int_{0}^{t}x(s)^{2}\\,ds$。\n- 计算无量纲比率\n$$\nR=\\frac{\\overline{x^{2}}}{\\langle x^{2}\\rangle_{\\mathrm{ens}}}.\n$$\n\n然后，基于运动方程和相空间输运（确定性刘维算符与随机福克-普朗克方程的对比）进行推理，解释为什么添加 (i) 努斯-胡佛链（将第二个恒温器变量耦合到 $\\xi$ 上，该变量有其自身的恒温器质量）或 (ii) 随机朗之万项（满足涨落-耗散关系的线性摩擦和高斯白噪声）会改变动力学的遍历性，从而改变谐振子长时间平均值与系综平均值之间的等价关系。\n\n最终答案只报告 $R$ 的数值。最终答案应表示为精确数，无需四舍五入。最终答案是无量纲的，因此不需要单位。",
            "solution": "该问题要求计算一个无量纲比率 $R$，该比率比较了来自努斯-胡佛（Nosé-Hoover）分子动力学模拟的长时间平均值与一维谐振子的正则系综平均值。问题还要求解释为什么对动力学的某些修改会改变结果。\n\n首先，我们验证问题陈述的有效性。\n给定系统是一个质量为 $m$、力常数为 $k$ 的经典一维谐振子。其动力学由一组关于位置 $x$、动量 $p$ 和恒温器变量 $\\xi$ 的三个耦合常微分方程描述。\n运动方程为：\n$$\n\\dot{x}=\\frac{p}{m}\n$$\n$$\n\\dot{p}=-kx-\\xi\\,p\n$$\n$$\n\\dot{\\xi}=\\frac{1}{Q}\\left(\\frac{p^{2}}{m}-k_{B}T\\right)\n$$\n初始条件为 $x(0)=0$，$p(0)=0$ 和 $\\xi(0)=0$。相应的未与恒温器耦合系统的哈密顿量为 $H(x,p)=\\frac{p^{2}}{2m}+\\frac{kx^{2}}{2}$。\n问题要求完成三项任务：\n1. 推导未与恒温器耦合的谐振子的正则系综平均值 $\\langle x^{2}\\rangle_{\\mathrm{ens}}$。\n2. 根据给定的初始条件，通过努斯-胡佛动力学确定长时间平均值 $\\overline{x^{2}}=\\lim_{t\\to\\infty}\\frac{1}{t}\\int_{0}^{t}x(s)^{2}\\,ds$。\n3. 计算比率 $R=\\frac{\\overline{x^{2}}}{\\langle x^{2}\\rangle_{\\mathrm{ens}}}$。\n问题陈述具有科学依据、问题明确、客观且内部一致。该初始条件是一个特殊的选择，旨在凸显努斯-胡佛动力学的一个已知特性，即对于像谐振子这样的简单系统，它缺乏遍历性。因此，该问题是有效的。\n\n我们开始求解。\n\n**1. 正则系综平均值 $\\langle x^{2}\\rangle_{\\mathrm{ens}}$ 的推导**\n\n在温度 $T$ 下，物理量 $A(x,p)$ 的正则系综平均值由 $\\langle A \\rangle_{\\mathrm{ens}} = \\frac{\\int \\int A(x,p) \\exp(-\\beta H(x,p)) \\,dx\\,dp}{\\int \\int \\exp(-\\beta H(x,p)) \\,dx\\,dp}$ 给出，其中 $\\beta = (k_B T)^{-1}$，$H(x,p)$ 是哈密顿量。对于谐振子，$H(x,p)=\\frac{p^{2}}{2m}+\\frac{1}{2}kx^{2}$。\n\n求 $\\langle x^2 \\rangle_{\\mathrm{ens}}$ 的一个直接方法是使用经典统计力学中的能量均分定理。该定理指出，哈密顿量中每个独立的二次型自由度对系统的总平均能量贡献 $\\frac{1}{2}k_{B}T$。势能项 $U(x) = \\frac{1}{2}kx^{2}$ 是坐标 $x$ 的二次函数。因此，其在正则系综中的平均值为：\n$$\n\\left\\langle \\frac{1}{2}kx^{2} \\right\\rangle_{\\mathrm{ens}} = \\frac{1}{2}k_{B}T\n$$\n由于 $k$ 是一个常数，我们可以写出：\n$$\n\\frac{1}{2}k \\langle x^{2} \\rangle_{\\mathrm{ens}} = \\frac{1}{2}k_{B}T\n$$\n解出 $\\langle x^{2} \\rangle_{\\mathrm{ens}}$ 可得：\n$$\n\\langle x^{2} \\rangle_{\\mathrm{ens}} = \\frac{k_{B}T}{k}\n$$\n这是经典谐振子在温度 $T$ 下处于热平衡时位置的期望方差。\n\n**2. 长时间平均值 $\\overline{x^{2}}$ 的确定**\n\n我们必须求解给定初始条件下的微分方程组：$x(0)=0$，$p(0)=0$ 和 $\\xi(0)=0$。\n方程组为：\n1. $\\dot{x} = p/m$\n2. $\\dot{p} = -kx - \\xi p$\n3. $\\dot{\\xi} = \\frac{1}{Q}(p^{2}/m - k_{B}T)$\n\n我们来检验平庸轨道 $x(t)=0$ 和 $p(t)=0$（对于所有 $t \\ge 0$）是否为解。\n将 $x(t)=0$ 和 $p(t)=0$ 代入前两个方程：\n1. $\\dot{x}(t) = 0$。方程 $\\dot{x}=p/m$ 变为 $0=0/m$，成立。\n2. $\\dot{p}(t) = 0$。方程 $\\dot{p}=-kx-\\xi p$ 变为 $0=-k(0)-\\xi(t)(0)$，对于任何函数 $\\xi(t)$ 都成立。\n\n现在我们将此轨道代入关于 $\\xi(t)$ 的第三个方程：\n3. $\\dot{\\xi} = \\frac{1}{Q}\\left(\\frac{0^{2}}{m} - k_{B}T\\right) = -\\frac{k_{B}T}{Q}$。\n这是一个关于 $\\xi(t)$ 的简单一阶微分方程，初始条件为 $\\xi(0)=0$。其解为：\n$$\n\\xi(t) = \\int_{0}^{t} \\left(-\\frac{k_{B}T}{Q}\\right) \\,ds + \\xi(0) = -\\frac{k_{B}T}{Q}t\n$$\n因此，轨道 $(x(t), p(t), \\xi(t)) = (0, 0, -\\frac{k_{B}T}{Q}t)$ 满足所有三个微分方程和初始条件。根据常微分方程组解的唯一性定理（方程右侧是光滑的），这是给定初值问题的唯一解。\n\n有了轨道的显式解，我们现在可以计算 $x^{2}$ 的时间平均值：\n$$\n\\overline{x^{2}} = \\lim_{t\\to\\infty}\\frac{1}{t}\\int_{0}^{t}x(s)^{2}\\,ds\n$$\n由于对所有 $s \\ge 0$ 都有 $x(s) = 0$，我们得到 $x(s)^{2}=0$。因此积分为：\n$$\n\\int_{0}^{t} 0 \\,ds = 0\n$$\n因此，时间平均值为：\n$$\n\\overline{x^{2}} = \\lim_{t\\to\\infty}\\frac{1}{t} (0) = 0\n$$\n\n**3. 比率 $R$ 的计算**\n\n比率 $R$ 定义为 $R = \\frac{\\overline{x^{2}}}{\\langle x^{2}\\rangle_{\\mathrm{ens}}}$。\n代入前面部分得到的结果：\n$$\nR = \\frac{0}{k_{B}T/k}\n$$\n假设温度非零 $T > 0$（这在恒温器的定义中是隐含的），分母 $k_{B}T/k$ 是一个正的有限值。\n因此，该比率为：\n$$\nR = 0\n$$\n\n**4. 遍历性的解释**\n\n时间平均值（$\\overline{x^{2}}=0$）与系综平均值（$\\langle x^{2}\\rangle_{\\mathrm{ens}} = k_B T/k \\neq 0$）之间的差异是努斯-胡佛恒温器应用于单个谐振子时**遍历性失效**的直接后果。遍历性假设断言，系统的单条长轨道将探索整个可及相空间，从而使得时间平均值等于系综平均值。谐振子的努斯-胡佛动力学不是遍历的，因为其相空间流是规则的，而不是混沌的。轨道被限制在三维 $(x, p, \\xi)$ 相空间内的二维不变环面上，这意味着它们无法对完整的正则分布进行采样。特定的初始条件 $x(0)=0, p(0)=0, \\xi(0)=0$ 位于一条特别简单且病态的轨道上，在该轨道上振子永远保持静止，这表现出系统在热化以及探索具有非零位置或动量的状态方面发生了灾难性的失败。\n\n问题描述了如何解决这个问题：\n- **(i) 努斯-胡佛链（Nosé-Hoover Chain）：** 努斯-胡佛链恒温器通过将第一个恒温器变量 $\\xi$ 耦合到第二个变量 $\\eta$（而 $\\eta$ 又耦合到其自身的热浴，对于更长的链也是如此）来扩展相空间。一个双变量链的运动方程可能看起来像 $\\dot{\\xi}=\\frac{1}{Q_1}\\left(\\frac{p^{2}}{m}-k_{B}T\\right)-\\eta\\xi$ 和 $\\dot{\\eta}=\\frac{1}{Q_2}\\left(Q_1\\xi^2-k_{B}T\\right)$。这种分层耦合创建了更复杂的反馈机制。对于谐振子，这种增加的复杂性足以打破由简单刘维算符控制的动力学的规则、准周期结构。该链可以引发混沌，导致扩展相空间中的混合流。结果是，轨道不再被困住，可以遍历地探索相空间，从而恢复等价关系 $\\overline{A} = \\langle A \\rangle_{\\mathrm{ens}}$。\n\n- **(ii) 随机朗之万项（Stochastic Langevin Term）：** 朗之万动力学用一种随机方法取代了确定性恒温器。动量方程被修改为 $\\dot{p}=-kx-\\gamma p + F_{rand}(t)$，其中 $-\\gamma p$ 是一个摩擦阻力项，$F_{rand}(t)$ 是一个代表来自环境的热涨落的随机力。为使系统在温度 $T$ 下达到平衡，随机力必须满足涨落-耗散定理，该定理将其强度与摩擦系数 $\\gamma$ 和温度 $T$ 联系起来，通常表示为 $\\langle F_{rand}(t) F_{rand}(t') \\rangle = 2m\\gamma k_B T \\delta(t-t')$。系统的演化不再由确定性的刘维算符控制，而是由描述概率分布的随机福克-普朗克方程描述。随机力项作为一种持续的“踢动”源，防止系统陷入规则的、非遍历的轨道。这种随机性确保系统最终将访问所有与正则系综一致的可及相空间区域，从而保证遍历性以及时间平均值与系综平均值的相等。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "理论上的遍历性失效之外，更常见的是“实际遍历性破缺”，即系统因高能垒而被困于相空间的某一区域。本编程练习将通过模拟经典的二维伊辛模型，让你亲手验证在低温下，由于自发对称性破缺，系统的时间平均磁化强度如何依赖于初始构型，从而无法在有限时间内复现系综平均值零。",
            "id": "3455685",
            "problem": "考虑一个经典的铁磁伊辛自旋系统，该系统位于具有周期性边界条件的二维方格晶格上，旨在作为热接触下自旋晶格分子动力学（MD）的最小模型。该系统由位于方格网格上的 $N = L \\times L$ 个自旋 $s_i \\in \\{-1,+1\\}$ 组成，其哈密顿量为\n$$\nH(\\mathbf{s}) = - J \\sum_{\\langle i,j\\rangle} s_i s_j,\n$$\n其中，求和遍历最近邻对，且 $J>0$ 是铁磁耦合。我们关注的宏观可观测量是瞬时磁化强度\n$$\nm(t) = \\frac{1}{N} \\sum_{i=1}^{N} s_i(t).\n$$\n系统与一个无量纲温度为 $T$ 的热浴耦合，其中玻尔兹曼常数设为1（$k_{\\mathrm{B}} = 1$），因此所有温度和能量都以约化单位表示。\n\n动力学：在每个离散时间步 $t=1,2,\\dots,M$，对于每个格点 $i$，都独立地以概率 $\\gamma \\in [0,1]$ 生成一个自旋翻转提议 $s_i \\to -s_i$。在温度 $T>0$ 时，一个提议的翻转以标准的 Metropolis 概率被接受\n$$\nP_{\\mathrm{acc}} = \\min\\left(1, e^{-\\Delta E / T}\\right), \\quad \\Delta E = 2 J s_i \\sum_{j \\in \\mathrm{nn}(i)} s_j,\n$$\n其中 $\\mathrm{nn}(i)$ 是格点 $i$ 的四个最近邻。在恰好 $T=0$ 时，如果 $\\Delta E < 0$，提议的翻转被接受；如果 $\\Delta E > 0$，则被拒绝；如果 $\\Delta E = 0$，则以概率 $1/2$ 被接受。观测时间内的（离散）磁化强度时间平均值为\n$$\n\\overline{m} = \\frac{1}{M} \\sum_{t=1}^{M} m(t).\n$$\n在零外场下，根据任何有限晶格（$L<\\infty$）上吉布斯分布的自旋翻转对称性，平衡（系综）平均值满足\n$$\n\\langle m \\rangle = 0.\n$$\n\n目标：数值研究在弱耦合和低温下，磁化强度的时间平均值 $\\overline{m}$ 是否等于系综平均值 $\\langle m \\rangle$，并描绘出时间平均值依赖于初始自旋构型的参数区域。使用以下精确的判定规则：\n- 为初始条件 $\\mathcal{I}$ 定义与系综均值相等的指示器为\n$$\n\\mathrm{equal}(\\mathcal{I}) = \\left[\\, \\left| \\overline{m}_{\\mathcal{I}} - \\langle m \\rangle \\right| \\le \\varepsilon_m \\, \\right],\n$$\n容差为 $\\varepsilon_m = 0.1$（无量纲）。\n- 定义对初始条件依赖性的指示器为\n$$\n\\mathrm{depends} = \\left[\\, \\left| \\overline{m}_{\\mathrm{up}} - \\overline{m}_{\\mathrm{down}} \\right| \\ge \\delta_m \\, \\right],\n$$\n其中 $\\overline{m}_{\\mathrm{up}}$ 和 $\\overline{m}_{\\mathrm{down}}$ 分别是从所有自旋为 $+1$ 和所有自旋为 $-1$ 开始的时间平均磁化强度，且 $\\delta_m = 0.8$（无量纲）。\n\n每个测试用例 $(L, T, \\gamma, M, \\mathrm{seed}_{\\mathrm{up}}, \\mathrm{seed}_{\\mathrm{down}})$ 的协议：\n1. 将自旋初始化为 $s_i(0)=+1$（全部向上），使用给定的 $T$ 和 $\\gamma$ 模拟动力学 $M$ 步，并计算 $\\overline{m}_{\\mathrm{up}}$。\n2. 将自旋初始化为 $s_i(0)=-1$（全部向下），模拟 $M$ 步（独立的随机性），并计算 $\\overline{m}_{\\mathrm{down}}$。\n3. 对所有情况，设置 $\\langle m \\rangle = 0$。\n4. 计算三个布尔值：\n   - $\\mathrm{equal}(\\mathrm{up})$,\n   - $\\mathrm{equal}(\\mathrm{down})$, \n   - $\\mathrm{depends}$.\n此处，$L$ 是每边晶格位点的整数数量，$T$ 和 $\\gamma$ 是约化单位下的实数，$M$ 是离散时间步的整数数量，种子是用于确定性伪随机数生成的整数。除了所述的约化单位外，不需要其他物理单位。\n\n待执行的测试套件：\n- 情况1（高温，强耦合；预期快速混合）：$(L, T, \\gamma, M, \\mathrm{seed}_{\\mathrm{up}}, \\mathrm{seed}_{\\mathrm{down}}) = (24, 5.0, 1.0, 4000, 123, 124)$。\n- 情况2（低温，弱耦合；预期在有限观测窗口内发生实际的遍历性破缺）：$(24, 0.2, 0.05, 10000, 456, 457)$。\n- 情况3（零温；吸收态引起的遍历性破缺）：$(24, 0.0, 1.0, 5000, 789, 790)$。\n\n你的任务：编写一个完整的程序，对每个测试用例执行上述模拟和决策。该程序应生成单行输出，其中包含结果，格式为一个逗号分隔的布尔值列表的列表，并用方括号括起来。每个测试用例的列表必须按 $[\\mathrm{equal}(\\mathrm{up}), \\mathrm{equal}(\\mathrm{down}), \\mathrm{depends}]$ 的顺序排列。例如，一个有效的输出格式是\n$$\n\\texttt{[[True,False,True],[...],[...]]}.\n$$",
            "solution": "该问题是有效的。它提出了一个定义明确的统计物理计算任务，其基础是伊辛模型和蒙特卡洛模拟方法的标准理论。所有必要的参数和定义都已提供，确保了结果的唯一性和可验证性。该问题要求通过比较模拟得到的时间平均值与有限二维伊辛自旋系统的理论系综平均值，来研究遍历性的概念。\n\n解决方案涉及根据指定的动力学开发蒙特卡洛模拟，并将其应用于一组旨在探测不同物理机制的测试用例。解决方案的核心在于根据 Metropolis 算法和所述的特定更新方案，正确地实现自旋翻转动力学。\n\n**1. 物理模型与理论背景**\n\n该系统是一个位于 $L \\times L$ 方格晶格上的二维铁磁伊辛模型，具有 $N=L^2$ 个格点和周期性边界条件。每个格点 $i$ 有一个自旋 $s_i$，其取值为 $s_i \\in \\{-1, +1\\}$。一个自旋构型 $\\mathbf{s} = \\{s_1, \\dots, s_N\\}$ 的总能量由哈密顿量给出：\n$$\nH(\\mathbf{s}) = - J \\sum_{\\langle i,j\\rangle} s_i s_j\n$$\n其中 $J > 0$ 是铁磁耦合常数，求和遍历所有最近邻对 $\\langle i,j\\rangle$。由于问题指定温度 $T$ 和能量采用约化单位，我们采用标准约定，将耦合常数设为 $J=1$，玻尔兹曼常数设为 $k_{\\mathrm{B}}=1$。\n\n主要的可观测量是单位自旋的瞬时磁化强度 $m(t)$，定义为：\n$$\nm(t) = \\frac{1}{N} \\sum_{i=1}^{N} s_i(t)\n$$\n在统计物理学中，遍历性假设断言，对于一个处于热平衡的系统，一个可观测量的长时间平均值等于其系综平均值。时间平均值 $\\overline{m}$ 是通过对 $M$ 步的有限模拟计算得出的：\n$$\n\\overline{m} = \\frac{1}{M} \\sum_{t=1}^{M} m(t)\n$$\n对于一个零外磁场下的有限尺寸系统，由于哈密顿量的自旋翻转对称性（对所有 $i$，$s_i \\to -s_i$），系综平均值 $\\langle m \\rangle$ 恰好为零，即 $\\langle m \\rangle=0$。本问题测试的是上述等式 $\\overline{m} = \\langle m \\rangle$ 在有限模拟时间内是否在实践中成立。如果系统被困在亚稳态中（一种被称为实际遍历性破缺的现象），该等式可能会被打破。\n\n**2. 模拟算法设计**\n\n模拟遵循一个离散时间的蒙特卡洛过程。从初始构型 $\\mathbf{s}(0)$ 开始，系统经过一系列状态 $\\mathbf{s}(1), \\mathbf{s}(2), \\dots, \\mathbf{s}(M)$。从 $\\mathbf{s}(t-1)$ 到 $\\mathbf{s}(t)$ 的每一步都由以下规则控制：\n\n*   **并行翻转提议**：在每个时间步 $t$，对于晶格上的每个格点 $i$，都独立地以概率 $\\gamma \\in [0,1]$ 提议一次自旋翻转尝试 $s_i \\to -s_i$。\n*   **Metropolis 接受准则**：在格点 $i$ 处提议的翻转是否被接受，取决于它将引起的能量变化 $\\Delta E$。能量变化由下式给出：\n    $$\n    \\Delta E = E_{\\text{final}} - E_{\\text{initial}} = 2 J s_i \\sum_{j \\in \\mathrm{nn}(i)} s_j\n    $$\n    其中 $\\mathrm{nn}(i)$ 是格点 $i$ 的四个最近邻。\n    *   对于正温度 $T > 0$，翻转以如下概率被接受：\n        $$\n        P_{\\mathrm{acc}} = \\min\\left(1, e^{-\\Delta E / T}\\right)\n        $$\n    *   在零温 $T = 0$ 时，动力学是确定性的，旨在最小化能量。如果 $\\Delta E < 0$，提议的翻转被接受；如果 $\\Delta E > 0$，则被拒绝；如果 $\\Delta E = 0$，则以概率 $1/2$ 被接受。\n\n**3. 实现策略**\n\n该算法使用 Python 的 `numpy` 库实现，以便在自旋晶格上进行高效的矢量化操作。\n\n*   **晶格表示**：$L \\times L$ 的自旋晶格由一个二维 `numpy` 整数数组表示（具体来说，为了节省内存，使用 `np.int8`），其值为 $+1$ 或 $-1$。\n*   **周期性边界条件**：使用 `numpy.roll()` 可以高效地处理周期性边界条件下的邻居相互作用计算。所有格点的邻居自旋之和可以同时计算如下：\n    `neighbor_sum = np.roll(spins, 1, axis=0) + np.roll(spins, -1, axis=0) + np.roll(spins, 1, axis=1) + np.roll(spins, -1, axis=1)`\n*   **矢量化更新步骤**：为了最大化性能，每个时间步都采用完全矢量化的方法。\n    1.  生成一个形状为 $(L,L)$ 的布尔掩码 `propose_mask`，其中每个元素以概率 $\\gamma$ 为 `True`。这标识了所有提议翻转的格点。\n    2.  计算一个形状为 $(L,L)$ 的数组 `delta_E`，其中包含每个格点自旋翻转将导致的能量变化。\n    3.  根据 Metropolis 准则创建一个布尔掩码 `accept_mask`。对于 $T > 0$，这涉及到生成一个随机数数组，并将其与 $e^{-\\Delta E / T}$ 进行比较。对于 $T=0$，则使用涉及 $\\Delta E$ 的比较的逻辑组合。\n    4.  最终要翻转的自旋集合由 `propose_mask` 和 `accept_mask` 的逻辑与运算确定。然后通过乘以 $-1$ 来反转这些位置的自旋。\n*   **模拟执行**：对于问题中定义的每个测试用例，都会调用一个专用的函数 `run_simulation`。该函数初始化晶格，运行主时间演化循环 $M$ 步，同时记录每一步的瞬时磁化强度，并返回时间平均磁化强度 $\\overline{m}$。\n*   **决策逻辑**：主脚本遍历所有测试用例。对于每个用例，它会为“全部向上”（$s_i(0)=+1$）和“全部向下”（$s_i(0)=-1$）两种初始条件运行模拟。然后，返回的时间平均磁化强度 $\\overline{m}_{\\mathrm{up}}$ 和 $\\overline{m}_{\\mathrm{down}}$ 将根据其定义用于评估两个布尔指示器：\n    *   $\\mathrm{equal}(\\mathcal{I}) = [|\\overline{m}_{\\mathcal{I}} - \\langle m \\rangle| \\le \\varepsilon_m]$，其中 $\\langle m \\rangle=0$ 且 $\\varepsilon_m = 0.1$。\n    *   $\\mathrm{depends} = [|\\overline{m}_{\\mathrm{up}} - \\overline{m}_{\\mathrm{down}}| \\ge \\delta_m]$，其中 $\\delta_m = 0.8$。\n最终的布尔结果列表被格式化为指定的字符串表示。使用带种子的伪随机数生成器确保了模拟的确定性和可复现性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(L, T, gamma, M, seed, initial_state_val):\n    \"\"\"\n    Performs a single Monte Carlo simulation of the 2D Ising model.\n\n    Args:\n        L (int): Lattice size per dimension.\n        T (float): Dimensionless temperature.\n        gamma (float): Probability of proposing a spin flip at a site.\n        M (int): Number of time steps.\n        seed (int): Seed for the random number generator.\n        initial_state_val (int): Initial spin value, either +1 or -1.\n\n    Returns:\n        float: The time-averaged magnetization.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    N = L * L\n    spins = np.full((L, L), initial_state_val, dtype=np.int8)\n    magnetizations = np.zeros(M, dtype=np.float64)\n    J = 1.0  # Ferromagnetic coupling constant set to 1 for reduced units.\n\n    for t in range(M):\n        # Determine which sites to propose a flip for\n        if gamma == 1.0:\n            propose_mask = np.full((L, L), True, dtype=bool)\n        else:\n            propose_mask = rng.random(size=(L, L)) < gamma\n\n        # Calculate sum of nearest neighbors for all spins using periodic boundaries\n        neighbor_sum = (np.roll(spins, 1, axis=0) +\n                        np.roll(spins, -1, axis=0) +\n                        np.roll(spins, 1, axis=1) +\n                        np.roll(spins, -1, axis=1))\n\n        # Calculate energy change for a flip at every site\n        delta_E = 2 * J * spins * neighbor_sum\n\n        # Determine which proposed flips are accepted based on temperature\n        if T > 0:\n            # Metropolis criterion for T > 0\n            # Note: np.exp handles large negative exponents gracefully (underflow to 0).\n            # The min(1, p) is implicitly handled by the random number comparison.\n            p_acc = np.exp(-delta_E / T)\n            accept_mask = rng.random(size=(L, L)) < p_acc\n        else:  # T == 0\n            # Energy minimization dynamics for T = 0\n            # Accept if delta_E < 0, or with P=1/2 if delta_E = 0.\n            accept_mask = (delta_E < 0) | ((delta_E == 0) & (rng.random(size=(L, L)) < 0.5))\n\n        # Combine proposal and acceptance masks to get the final flip mask\n        flip_mask = propose_mask & accept_mask\n\n        # Apply the flips to the spin lattice\n        spins[flip_mask] *= -1\n\n        # Record the magnetization for the current time step\n        magnetizations[t] = np.sum(spins) / N\n\n    # Return the time-averaged magnetization\n    return np.mean(magnetizations)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, T, gamma, M, seed_up, seed_down)\n        (24, 5.0, 1.0, 4000, 123, 124),   # Case 1\n        (24, 0.2, 0.05, 10000, 456, 457), # Case 2\n        (24, 0.0, 1.0, 5000, 789, 790),   # Case 3\n    ]\n\n    results = []\n    \n    # Define decision rule parameters\n    eps_m = 0.1\n    delta_m = 0.8\n    ensemble_m = 0.0\n\n    for case in test_cases:\n        L, T, gamma, M, seed_up, seed_down = case\n\n        # Run simulation starting with all spins up (+1)\n        m_up = run_simulation(L, T, gamma, M, seed_up, 1)\n        \n        # Run simulation starting with all spins down (-1)\n        m_down = run_simulation(L, T, gamma, M, seed_down, -1)\n        \n        # Apply the decision rules to get the three boolean indicators\n        equal_up = abs(m_up - ensemble_m) <= eps_m\n        equal_down = abs(m_down - ensemble_m) <= eps_m\n        depends = abs(m_up - m_down) >= delta_m\n        \n        results.append([equal_up, equal_down, depends])\n\n    # Final print statement in the exact required format.\n    # str(results) gives a representation like '[[True, False], [True, True]]'\n    # .replace(' ', '') removes all spaces to match the output format.\n    print(str(results).replace(' ', ''))\n\nsolve()\n```"
        }
    ]
}