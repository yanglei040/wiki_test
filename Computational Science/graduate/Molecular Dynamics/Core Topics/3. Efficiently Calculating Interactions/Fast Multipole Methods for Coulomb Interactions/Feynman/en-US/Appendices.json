{
    "hands_on_practices": [
        {
            "introduction": "The Fast Multipole Method relies on representing complex charge distributions with a compact set of mathematical descriptors. This first practice exercise delves into the foundational task of constructing these descriptors. You will derive the connection between the physically intuitive Cartesian multipole moments—such as total charge, dipole, and quadrupole—and the spherical multipole coefficients that form the basis of the FMM's far-field expansion . This essential skill provides a concrete understanding of how physical source information is encoded for efficient computation.",
            "id": "3411980",
            "problem": "In a Molecular Dynamics simulation that employs the Fast Multipole Method (FMM) for Coulomb interactions, consider a cluster of $N$ point charges $\\{q_{i}\\}_{i=1}^{N}$ located at positions $\\{\\mathbf{r}_{i}\\}_{i=1}^{N}$ relative to a chosen expansion center at the origin $\\mathbf{0}$. The Coulomb kernel is given by $1/|\\mathbf{R}-\\mathbf{r}|$ and the electric potential at a field point $\\mathbf{R}$ due to the cluster is\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} \\frac{q_{i}}{|\\mathbf{R}-\\mathbf{r}_{i}|}.\n$$\nAssume that the spherical harmonics $Y_{\\ell}^{m}(\\theta,\\varphi)$ are the orthonormal complex spherical harmonics with the Condon–Shortley phase, normalized such that $\\int |Y_{\\ell}^{m}(\\theta,\\varphi)|^{2}\\, d\\Omega = 1$. Define the spherical solid harmonics $r^{\\ell} Y_{\\ell}^{m}(\\theta,\\varphi)$ and use the standard Laplace expansion to represent $1/|\\mathbf{R}-\\mathbf{r}|$ for $|\\mathbf{R}|$ greater than the cluster radius.\n\nStarting from the fundamental definition of $\\phi(\\mathbf{R})$, the orthonormality of the spherical harmonics, and the properties of the Coulomb kernel, derive the Cartesian multipole moments up to quadrupole order for the cluster:\n- the total (monopole) charge $Q = \\sum_{i=1}^{N} q_{i}$,\n- the dipole moment vector $\\mathbf{p} = \\sum_{i=1}^{N} q_{i} \\mathbf{r}_{i}$,\n- the traceless Cartesian quadrupole moment tensor $Q_{jk} = \\sum_{i=1}^{N} q_{i} \\left( 3 x_{i,j} x_{i,k} - r_{i}^{2} \\delta_{jk} \\right)$, where $x_{i,j}$ is the $j$-th Cartesian component of $\\mathbf{r}_{i}$, $r_{i} = |\\mathbf{r}_{i}|$, and $\\delta_{jk}$ is the Kronecker delta.\n\nThen, relate these Cartesian moments to the spherical multipole coefficients $M_{\\ell}^{m}$ that appear in the spherical harmonics expansion of the potential for $\\ell = 0, 1, 2$. Provide explicit expressions for $M_{\\ell}^{m}$ in terms of $\\{q_{i}, \\mathbf{r}_{i}\\}$ and express them using the Cartesian quantities $Q$, $\\mathbf{p}$, and $Q_{jk}$ where possible. Conclude by giving a closed-form expression for the spherical quadrupole coefficient $M_{2}^{0}$ in terms of the Cartesian quadrupole tensor components. Express the final answer as a single analytic expression. No numerical evaluation is required.",
            "solution": "We begin with the electric potential due to a cluster of point charges,\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} \\frac{q_{i}}{|\\mathbf{R}-\\mathbf{r}_{i}|}.\n$$\nFor field points $\\mathbf{R}$ outside a sphere containing the cluster, the Coulomb kernel admits a spherical harmonics (Laplace) expansion,\n$$\n\\frac{1}{|\\mathbf{R}-\\mathbf{r}|} \\;=\\; \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{r^{\\ell}}{R^{\\ell+1}} Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}) Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}}),\n$$\nwhere $\\Omega_{\\mathbf{r}}$ and $\\Omega_{\\mathbf{R}}$ denote the angular coordinates of $\\mathbf{r}$ and $\\mathbf{R}$ respectively, and $Y_{\\ell}^{m}$ are orthonormal complex spherical harmonics with the Condon–Shortley phase convention. Inserting this into the potential yields\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} q_{i} \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{r_{i}^{\\ell}}{R^{\\ell+1}} Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}) Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}_{i}}).\n$$\nInterchanging sums and defining the spherical multipole coefficients\n$$\nM_{\\ell}^{m} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, r_{i}^{\\ell} \\, Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}_{i}}),\n$$\nwe obtain\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{M_{\\ell}^{m}}{R^{\\ell+1}} \\, Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}).\n$$\nThus, the task reduces to relating $M_{\\ell}^{m}$ to Cartesian multipole moments for $\\ell=0,1,2$.\n\nWe adopt the following Cartesian multipole definitions:\n- Monopole (total charge):\n$$\nQ \\;=\\; \\sum_{i=1}^{N} q_{i}.\n$$\n- Dipole:\n$$\n\\mathbf{p} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, \\mathbf{r}_{i} \\;=\\; \\left( \\sum_{i=1}^{N} q_{i} x_{i}, \\; \\sum_{i=1}^{N} q_{i} y_{i}, \\; \\sum_{i=1}^{N} q_{i} z_{i} \\right).\n$$\n- Traceless quadrupole tensor:\n$$\nQ_{jk} \\;=\\; \\sum_{i=1}^{N} q_{i} \\left( 3 x_{i,j} x_{i,k} - r_{i}^{2} \\delta_{jk} \\right), \\quad r_{i}^{2} \\;=\\; x_{i}^{2} + y_{i}^{2} + z_{i}^{2}.\n$$\nWe now connect these to $M_{\\ell}^{m}$ by using explicit forms of $Y_{\\ell}^{m}$ in Cartesian coordinates. The complex spherical harmonics (orthonormal) satisfy the well-known relations for low orders:\n- For $\\ell=0$:\n$$\nY_{0}^{0}(\\theta,\\varphi) \\;=\\; \\frac{1}{\\sqrt{4\\pi}}.\n$$\nTherefore,\n$$\nM_{0}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, r_{i}^{0} \\, Y_{0}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\frac{1}{\\sqrt{4\\pi}} \\sum_{i=1}^{N} q_{i} \\;=\\; \\frac{Q}{\\sqrt{4\\pi}}.\n$$\n\n- For $\\ell=1$, the spherical harmonics are\n$$\nY_{1}^{0}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\cos\\theta \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\frac{z}{r}, \n$$\n$$\nY_{1}^{\\pm 1}(\\theta,\\varphi) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\sin\\theta \\, \\exp(\\pm i \\varphi) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\frac{x \\pm i y}{r}.\n$$\nThus,\n$$\nM_{1}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i} Y_{1}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\sum_{i=1}^{N} q_{i} z_{i} \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\, p_{z},\n$$\nand\n$$\nM_{1}^{\\pm 1} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i} Y_{1}^{\\pm 1}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\sum_{i=1}^{N} q_{i} (x_{i} \\pm i y_{i}) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\left( p_{x} \\pm i p_{y} \\right).\n$$\n\n- For $\\ell=2$, the relevant spherical harmonics are\n$$\nY_{2}^{0}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\left( 3\\cos^{2}\\theta - 1 \\right) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\frac{3 z^{2} - r^{2}}{r^{2}},\n$$\n$$\nY_{2}^{\\pm 1}(\\theta,\\varphi) \\;=\\; \\mp \\sqrt{\\frac{15}{8\\pi}} \\frac{z (x \\pm i y)}{r^{2}},\n$$\n$$\nY_{2}^{\\pm 2}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{15}{32\\pi}} \\frac{(x \\pm i y)^{2}}{r^{2}}.\n$$\nUsing these, one finds\n$$\nM_{2}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i}^{2} Y_{2}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\sum_{i=1}^{N} q_{i} \\left( 3 z_{i}^{2} - r_{i}^{2} \\right).\n$$\nThis can be expressed in terms of the Cartesian quadrupole tensor. By definition,\n$$\nQ_{zz} \\;=\\; \\sum_{i=1}^{N} q_{i} \\left( 3 z_{i}^{2} - r_{i}^{2} \\right),\n$$\nso\n$$\nM_{2}^{0} \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\, Q_{zz}.\n$$\nFor completeness, the other quadrupole spherical coefficients are similarly related to Cartesian second moments:\n$$\nM_{2}^{\\pm 1} \\;=\\; \\mp \\sqrt{\\frac{15}{8\\pi}} \\sum_{i=1}^{N} q_{i} \\, z_{i} (x_{i} \\pm i y_{i}),\n$$\n$$\nM_{2}^{\\pm 2} \\;=\\; \\sqrt{\\frac{15}{32\\pi}} \\sum_{i=1}^{N} q_{i} \\, (x_{i} \\pm i y_{i})^{2}.\n$$\nThese can be written in terms of combinations of Cartesian quadrupole components (e.g., $Q_{xz}$, $Q_{yz}$, $Q_{xx}-Q_{yy}$, $Q_{xy}$), but the problem requests a closed-form expression for $M_{2}^{0}$ specifically. The desired relation is thus\n$$\nM_{2}^{0} \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\, Q_{zz}.\n$$\nThis completes the derivation up to quadrupole order and provides the explicit mapping from Cartesian to spherical multipole coefficients consistent with the orthonormal complex spherical harmonics used in the Fast Multipole Method for Coulomb interactions.",
            "answer": "$$\\boxed{\\sqrt{\\frac{5}{16\\pi}}\\,Q_{zz}}$$"
        },
        {
            "introduction": "The performance of the FMM is dictated by how rapidly the multipole series converges. This convergence is not universal but depends critically on the physical nature of the interaction. This exercise guides you through a comparative analysis of the truncation error for the unscreened Coulomb potential versus the screened Yukawa potential, which models interactions in ionic solutions or plasmas . By calculating the required expansion order $p$ to meet a fixed accuracy target in both scenarios, you will develop a quantitative intuition for how interaction range governs the method's efficiency.",
            "id": "3412011",
            "problem": "In the context of molecular dynamics, consider the evaluation of electrostatic potentials using the Fast Multipole Method (FMM) for two kernels: the unscreened Coulomb kernel and the screened Yukawa (linearized Poisson–Boltzmann) kernel. A cluster of point charges with total absolute charge magnitude $Q = \\sum_{i=1}^{N} |q_i|$ is confined within a sphere of radius $a$ centered at the origin. The potential is evaluated at a target point located on the sphere of radius $R$ centered at the origin, with $R > a$. Define the separation ratio $\\rho = a/R \\in (0,1)$. The FMM approximates the potential by truncating the multipole expansion at order $p$; the truncation error is the magnitude of the contribution from all multipole orders strictly greater than $p$.\n\nStarting from the Green’s functions for the Laplace and screened Poisson equations and standard multipole expansions, use only fundamental inequalities and monotonicity properties (e.g., triangle inequality and uniform bounds on Legendre polynomials and modified spherical Bessel functions) to derive rigorous upper bounds for the truncation error as a function of $\\rho$ and $p$ for:\n- the unscreened Coulomb kernel $\\Phi_{0}(\\mathbf{r},\\mathbf{r}') = 1/|\\mathbf{r}-\\mathbf{r}'|$,\n- the screened Yukawa kernel $\\Phi_{\\kappa}(\\mathbf{r},\\mathbf{r}') = \\exp(-\\kappa|\\mathbf{r}-\\mathbf{r}'|)/|\\mathbf{r}-\\mathbf{r}'|$ for a given screening parameter $\\kappa \\ge 0$.\n\nThen, impose the error tolerance $\\varepsilon = 1.0 \\times 10^{-6}$ (in the same normalized potential units for both kernels), take $Q = 1$, $a = 1\\,\\mathrm{nm}$, $R = 3\\,\\mathrm{nm}$, and evaluate the screened case at $\\kappa = 5\\,\\mathrm{nm}^{-1}$. Using your derived bounds, compute the minimal truncation order $p_{\\mathrm{unscreened}}$ required for the unscreened kernel and the minimal truncation order $p_{\\mathrm{screened}}$ required for the screened kernel to guarantee the error is at most $\\varepsilon$. Report the final result as the integer difference $p_{\\mathrm{unscreened}} - p_{\\mathrm{screened}}$. Provide the final answer as a single integer with no units.",
            "solution": "The problem asks for the derivation of truncation error bounds for the unscreened Coulomb and screened Yukawa potentials, followed by a calculation of the minimal multipole expansion order $p$ required to achieve a specified error tolerance $\\varepsilon$.\n\nLet a cluster of source charges $q_i$ be located at positions $\\mathbf{r}'_i$ within a sphere of radius $a$ centered at the origin, i.e., $|\\mathbf{r}'_i| \\le a$. The total potential is evaluated at a target point $\\mathbf{r}$ on a sphere of radius $R > a$. The total absolute charge is $Q = \\sum_{i=1}^N |q_i|$. The separation ratio is $\\rho = a/R < 1$.\n\nThe total potential $\\Psi(\\mathbf{r})$ is the sum of potentials from each source charge:\n$$ \\Psi(\\mathbf{r}) = \\sum_{i=1}^N q_i \\Phi(\\mathbf{r}, \\mathbf{r}'_i) $$\nwhere $\\Phi$ is the interaction kernel. The truncation error, $E(p)$, is the absolute value of the potential arising from multipole expansion terms of order $l$ strictly greater than $p$.\n\n**1. Unscreened Coulomb Kernel: $\\Phi_0(\\mathbf{r}, \\mathbf{r}') = 1/|\\mathbf{r} - \\mathbf{r}'|$**\n\nFor $|\\mathbf{r}'| < |\\mathbf{r}|$, the Green's function for the Laplace equation has the well-known multipole expansion in terms of Legendre polynomials $P_l$:\n$$ \\frac{1}{|\\mathbf{r}-\\mathbf{r}'|} = \\sum_{l=0}^{\\infty} \\frac{|\\mathbf{r}'|^l}{|\\mathbf{r}|^{l+1}} P_l(\\cos\\gamma) $$\nwhere $\\gamma$ is the angle between the vectors $\\mathbf{r}$ and $\\mathbf{r}'$.\n\nThe potential at $\\mathbf{r}$ is:\n$$ \\Psi_0(\\mathbf{r}) = \\sum_{i=1}^N q_i \\sum_{l=0}^{\\infty} \\frac{|\\mathbf{r}'_i|^l}{R^{l+1}} P_l(\\cos\\gamma_i) $$\nThe truncation error $E_0(p)$ is the magnitude of the sum of terms for $l \\ge p+1$:\n$$ E_0(p) = \\left| \\sum_{i=1}^N q_i \\sum_{l=p+1}^{\\infty} \\frac{|\\mathbf{r}'_i|^l}{R^{l+1}} P_l(\\cos\\gamma_i) \\right| $$\nUsing the triangle inequality, we can establish an upper bound:\n$$ E_0(p) \\le \\sum_{i=1}^N |q_i| \\sum_{l=p+1}^{\\infty} \\frac{|\\mathbf{r}'_i|^l}{R^{l+1}} |P_l(\\cos\\gamma_i)| $$\nWe use the following bounds based on the problem statement: $|\\mathbf{r}'_i| \\le a$, and the uniform bound for Legendre polynomials, $|P_l(x)| \\le 1$ for $x \\in [-1, 1]$.\n$$ E_0(p) \\le \\sum_{i=1}^N |q_i| \\sum_{l=p+1}^{\\infty} \\frac{a^l}{R^{l+1}} = \\left(\\sum_{i=1}^N |q_i|\\right) \\frac{1}{R} \\sum_{l=p+1}^{\\infty} \\left(\\frac{a}{R}\\right)^l $$\nSubstituting $Q = \\sum_{i=1}^N |q_i|$ and $\\rho=a/R$:\n$$ E_0(p) \\le \\frac{Q}{R} \\sum_{l=p+1}^{\\infty} \\rho^l $$\nThe sum is a geometric series: $\\sum_{l=p+1}^{\\infty} \\rho^l = \\rho^{p+1} + \\rho^{p+2} + \\dots = \\frac{\\rho^{p+1}}{1-\\rho}$.\nThus, the rigorous upper bound for the truncation error of the unscreened Coulomb potential is:\n$$ E_0(p) \\le \\frac{Q}{R} \\frac{\\rho^{p+1}}{1-\\rho} $$\n\n**2. Screened Yukawa Kernel: $\\Phi_\\kappa(\\mathbf{r}, \\mathbf{r}') = \\frac{\\exp(-\\kappa|\\mathbf{r}-\\mathbf{r}'|)}{|\\mathbf{r}-\\mathbf{r}'|}$**\n\nFor $|\\mathbf{r}'| < |\\mathbf{r}|$, the Green's function for the screened Poisson (Helmholtz) equation is given by the expansion:\n$$ \\frac{\\exp(-\\kappa|\\mathbf{r}-\\mathbf{r}'|)}{|\\mathbf{r}-\\mathbf{r}'|} = \\kappa \\sum_{l=0}^{\\infty} (2l+1) i_l(\\kappa |\\mathbf{r}'|) k_l(\\kappa |\\mathbf{r}|) P_l(\\cos\\gamma) $$\nwhere $i_l$ and $k_l$ are the modified spherical Bessel functions of the first and second kinds, respectively.\n\nThe truncation error $E_\\kappa(p)$ is bounded using the triangle inequality, the bound $|P_l(x)| \\le 1$, and the fact that $i_l(x)$ is a monotonically increasing function for $x>0$:\n$$ E_\\kappa(p) \\le \\sum_{i=1}^N |q_i| \\sum_{l=p+1}^{\\infty} \\kappa (2l+1) |i_l(\\kappa |\\mathbf{r}'_i|)| |k_l(\\kappa R)| |P_l(\\cos\\gamma_i)| $$\n$$ E_\\kappa(p) \\le Q \\kappa \\sum_{l=p+1}^{\\infty} (2l+1) i_l(\\kappa a) k_l(\\kappa R) $$\nLet $T_l = (2l+1) i_l(\\kappa a) k_l(\\kappa R)$. It is a known property, derivable from the recurrence relations of spherical Bessel functions, that for $a<R$, the ratio of successive terms is bounded: $T_{l+1}/T_l < (a/R)^2 = \\rho^2$ for sufficiently large $l$. This indicates a very rapid, super-geometric convergence. We can bound the sum by a geometric series with ratio $\\rho^2$:\n$$ \\sum_{l=p+1}^{\\infty} T_l < T_{p+1} + T_{p+1}\\rho^2 + T_{p+1}(\\rho^2)^2 + \\dots = T_{p+1} \\sum_{j=0}^{\\infty} (\\rho^2)^j = \\frac{T_{p+1}}{1-\\rho^2} $$\nSubstituting this into the error expression, we obtain the bound:\n$$ E_\\kappa(p) \\le Q\\kappa \\frac{(2(p+1)+1) i_{p+1}(\\kappa a) k_{p+1}(\\kappa R)}{1-\\rho^2} = Q\\kappa \\frac{(2p+3) i_{p+1}(\\kappa a) k_{p+1}(\\kappa R)}{1-\\rho^2} $$\n\n**3. Numerical Calculation**\n\nWe are given the following values:\n$Q = 1$\n$a = 1\\,\\mathrm{nm}$\n$R = 3\\,\\mathrm{nm}$\n$\\kappa = 5\\,\\mathrm{nm}^{-1}$\n$\\varepsilon = 1.0 \\times 10^{-6}$\n\nFrom these, we compute:\n$\\rho = a/R = 1/3$\n$1-\\rho = 2/3$\n$1-\\rho^2 = 1 - 1/9 = 8/9$\n$\\kappa a = (5\\,\\mathrm{nm}^{-1})(1\\,\\mathrm{nm}) = 5$\n$\\kappa R = (5\\,\\mathrm{nm}^{-1})(3\\,\\mathrm{nm}) = 15$\n\n**Minimal Unscreened Truncation Order, $p_{\\mathrm{unscreened}}$**\nWe set the error bound to be less than or equal to $\\varepsilon$:\n$$ \\frac{Q}{R} \\frac{\\rho^{p+1}}{1-\\rho} \\le \\varepsilon $$\n$$ \\frac{1}{3} \\frac{(1/3)^{p+1}}{2/3} \\le 1.0 \\times 10^{-6} $$\n$$ \\frac{1}{2} (1/3)^{p+1} \\le 10^{-6} $$\n$$ 3^{p+1} \\ge \\frac{1}{2 \\times 10^{-6}} = 5 \\times 10^5 $$\nTaking the natural logarithm of both sides:\n$$ (p+1) \\ln(3) \\ge \\ln(5 \\times 10^5) $$\n$$ p+1 \\ge \\frac{\\ln(500000)}{\\ln(3)} \\approx \\frac{13.122}{1.0986} \\approx 11.944 $$\nSince $p+1$ must be an integer, we require $p+1 \\ge 12$, which implies $p \\ge 11$. The minimal integer truncation order is $p_{\\mathrm{unscreened}} = 11$.\n\n**Minimal Screened Truncation Order, $p_{\\mathrm{screened}}$**\nWe set the error bound for the screened case to be less than or equal to $\\varepsilon$:\n$$ Q\\kappa \\frac{(2p+3) i_{p+1}(\\kappa a) k_{p+1}(\\kappa R)}{1-\\rho^2} \\le \\varepsilon $$\n$$ (1)(5) \\frac{(2p+3) i_{p+1}(5) k_{p+1}(15)}{8/9} \\le 1.0 \\times 10^{-6} $$\n$$ (2p+3) i_{p+1}(5) k_{p+1}(15) \\le \\frac{8}{45} \\times 10^{-6} \\approx 1.777 \\times 10^{-7} $$\nWe must now test integer values of $p$ starting from $0$. This requires numerical evaluation of the spherical Bessel functions $i_n(z)$ and $k_n(z)$.\nLet $F(p) = (2p+3) i_{p+1}(5) k_{p+1}(15)$.\n\nFor $p=1$:\n$F(1) = (5) i_2(5) k_2(15)$. Using standard numerical libraries, $i_2(5) \\approx 2.52535$ and $k_2(15) \\approx 1.48819 \\times 10^{-8}$.\n$F(1) \\approx 5 \\times 2.52535 \\times 1.48819 \\times 10^{-8} \\approx 1.879 \\times 10^{-7}$.\nSince $1.879 \\times 10^{-7} > 1.777 \\times 10^{-7}$, $p=1$ is not sufficient.\n\nFor $p=2$:\n$F(2) = (7) i_3(5) k_3(15)$. Using numerical libraries, $i_3(5) \\approx 0.63606$ and $k_3(15) \\approx 1.63738 \\times 10^{-8}$.\n$F(2) \\approx 7 \\times 0.63606 \\times 1.63738 \\times 10^{-8} \\approx 7.287 \\times 10^{-8}$.\nSince $7.287 \\times 10^{-8} \\le 1.777 \\times 10^{-7}$, $p=2$ is sufficient.\nThe minimal integer truncation order is $p_{\\mathrm{screened}} = 2$.\n\n**Final Result**\nThe required difference is:\n$$ p_{\\mathrm{unscreened}} - p_{\\mathrm{screened}} = 11 - 2 = 9 $$\nThis result demonstrates that for screened interactions, the multipole expansion converges much more rapidly, requiring a significantly lower truncation order for the same level of accuracy.",
            "answer": "$$\\boxed{9}$$"
        },
        {
            "introduction": "A \"one-size-fits-all\" approach to accuracy can be inefficient in systems with heterogeneous particle distributions. This advanced practice challenges you to move from analyzing FMM to actively improving it by designing an adaptive error control scheme . You will develop a heuristic to dynamically adjust the FMM opening angle $\\theta$ based on local electric field variability, using information from low-order multipole moments to estimate the necessary refinement. This task mirrors the real-world engineering of sophisticated simulation codes, where performance is optimized by tailoring the algorithm to the local physics of the problem.",
            "id": "3412050",
            "problem": "You are to design and implement a program that computes an adaptive opening angle for the Fast Multipole Method (FMM) applied to Coulomb interactions in Molecular Dynamics, where the opening angle is adjusted based on local field variability. The objective is to target approximately uniform relative force accuracy across regions with heterogeneous source distributions. Begin from first principles and core definitions, and derive a concrete heuristic that uses measurable quantities available during multipole evaluation.\n\nFundamental base:\n- The electric field due to a point charge is given by Coulomb’s law. If a cluster of charges is represented by a net charge $Q$ and a dipole moment vector $\\mathbf{p}$, the far-field multipole approximation for the electric field at a field point with relative position vector $\\mathbf{r}$ is the sum of a monopole term and a dipole term. Using the vacuum permittivity $\\epsilon_0$ and the constant $k_e = \\frac{1}{4\\pi \\epsilon_0}$, the monopole contribution is $k_e \\, Q \\, \\frac{\\mathbf{r}}{\\|\\mathbf{r}\\|^3}$ and the dipole contribution is $k_e \\, \\frac{3(\\mathbf{p}\\cdot\\mathbf{r})\\mathbf{r} - \\|\\mathbf{r}\\|^2 \\mathbf{p}}{\\|\\mathbf{r}\\|^5}$. The total field in the monopole-plus-dipole approximation is the sum of these two contributions. The multipole expansion truncation error scales with a power of the size-to-distance ratio and is dominated by the next omitted term.\n- A hierarchical tree acceptance criterion commonly uses a dimensionless opening angle $\\theta$ via $a/R < \\theta$, where $a$ is a characteristic source-cluster radius and $R$ is the distance from the target point to the cluster center. Smaller $\\theta$ yields stricter acceptance and higher accuracy.\n\nHeuristic problem to solve:\n- We seek an adaptive rule for the opening angle $\\theta$ that uses the local field variability to modulate acceptance. The local variability will be quantified by the magnitude of the field gradient $\\|\\nabla \\mathbf{E}\\|$, estimated from multipole differences, and tied to the expected truncation error. The goal is to achieve a user-specified relative force accuracy target $0 < \\varepsilon_{\\mathrm{target}} \\ll 1$ at each evaluation point, while avoiding over-refinement in homogeneous regions and increasing refinement in heterogeneous regions.\n- You must use only quantities that are either directly under user control or computable from the monopole and dipole approximations without constructing higher-order terms. Specifically, use the following measurable proxies:\n  1. The monopole-only field $\\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r})$ and the monopole-plus-dipole field $\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})$ evaluated at the same point $\\mathbf{r}$ to form a multipole difference $\\delta \\mathbf{E} = \\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r}) - \\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r})$ with magnitude $\\delta E = \\|\\delta \\mathbf{E}\\|$.\n  2. A finite-difference estimate of the local field gradient magnitude using a small displacement $\\boldsymbol{\\Delta}$: $\\|\\nabla \\mathbf{E}\\| \\approx \\frac{\\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r}+\\boldsymbol{\\Delta}) - \\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|}{\\|\\boldsymbol{\\Delta}\\|}$. Denote this estimate by $G$.\n- The acceptance order $L$ is the highest retained multipole order in the approximation that governs error scaling, with $L=1$ corresponding to dipole truncation. The truncation error magnitude for retained order $L$ scales like a constant times $(a/R)^{L+1}$. Use the proxies $\\delta E$ and $G$ together with the field magnitude $\\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|$ to form a conservative estimate of a suitable opening angle $\\theta$ that ensures the predicted relative error is no greater than $\\varepsilon_{\\mathrm{target}}$.\n\nDesign requirements:\n- From the above fundamental laws and facts, derive a principled heuristic for $\\theta$ based on the following ideas:\n  1. Tie the multipole truncation error to the next omitted term’s scaling, expressed in terms of the size-to-distance ratio and a local field scale inferred from $\\delta E$ and $G$.\n  2. Enforce the inequality that the predicted relative force error is bounded by $\\varepsilon_{\\mathrm{target}}$, and solve for a dimensionless opening angle threshold $\\theta$ that the tree acceptance rule can use. The final $\\theta$ must be bounded within prescribed limits $[\\theta_{\\min}, \\theta_{\\max}]$ to preserve numerical stability and to avoid pathological refinement or coarsening.\n  3. Ensure that the heuristic reduces $\\theta$ when $G$ is large and/or $\\delta E$ is large, and increases $\\theta$ when the field is homogeneous (small $G$ and $\\delta E$), thereby targeting uniform relative accuracy across regions with different variability.\n- All distances must be in $\\mathrm{m}$, charges in $\\mathrm{C}$, and the opening angle $\\theta$ must be reported as a dimensionless number. Angles should not be expressed in degrees or radians since $\\theta$ in this context is a size-to-distance ratio. The relative accuracy target $\\varepsilon_{\\mathrm{target}}$ is dimensionless.\n\nProgram requirements:\n- Implement functions to compute $\\mathbf{E}_{\\mathrm{mono}}$ and $\\mathbf{E}_{\\mathrm{dip}}$ from the inputs $(Q,\\mathbf{p},\\mathbf{r})$ using $k_e = \\frac{1}{4\\pi \\epsilon_0}$ with $\\epsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F/m}$.\n- Implement a routine to estimate $G$ via finite differences using the displacement $\\boldsymbol{\\Delta}$.\n- Derive and implement the adaptive opening angle $\\theta$ according to your heuristic, guaranteeing that it is clipped to $[\\theta_{\\min},\\theta_{\\max}]$.\n- For numerical robustness, if a denominator would be zero, fall back to $\\theta_{\\max}$.\n- Your program must compute $\\theta$ for each of the following test cases and produce a single output line containing all results as a comma-separated list enclosed in square brackets.\n\nTest suite:\n- Case $1$ (happy path, moderate variability):\n  - $Q = 5.0\\times 10^{-19}\\,\\mathrm{C}$, $\\mathbf{p} = \\left[2.0\\times 10^{-29}, -1.0\\times 10^{-29}, 0.5\\times 10^{-29}\\right]\\,\\mathrm{C\\cdot m}$,\n  - $\\mathbf{r} = \\left[4.0\\times 10^{-9}, 3.0\\times 10^{-9}, 0.0\\right]\\,\\mathrm{m}$, $a = 1.0\\times 10^{-9}\\,\\mathrm{m}$,\n  - $\\boldsymbol{\\Delta} = \\left[2.0\\times 10^{-10}, 0.0, 0.0\\right]\\,\\mathrm{m}$,\n  - $L = 1$, $\\varepsilon_{\\mathrm{target}} = 1.0\\times 10^{-3}$,\n  - $\\theta_{\\min} = 0.2$, $\\theta_{\\max} = 0.8$.\n- Case $2$ (boundary condition, nearly homogeneous region):\n  - $Q = 1.0\\times 10^{-19}\\,\\mathrm{C}$, $\\mathbf{p} = \\left[0.0, 0.0, 0.0\\right]\\,\\mathrm{C\\cdot m}$,\n  - $\\mathbf{r} = \\left[1.0\\times 10^{-8}, 0.0, 0.0\\right]\\,\\mathrm{m}$, $a = 5.0\\times 10^{-10}\\,\\mathrm{m}$,\n  - $\\boldsymbol{\\Delta} = \\left[1.0\\times 10^{-10}, 0.0, 0.0\\right]\\,\\mathrm{m}$,\n  - $L = 1$, $\\varepsilon_{\\mathrm{target}} = 1.0\\times 10^{-3}$,\n  - $\\theta_{\\min} = 0.2$, $\\theta_{\\max} = 0.8$.\n- Case $3$ (edge case, high variability near the cell):\n  - $Q = 1.0\\times 10^{-19}\\,\\mathrm{C}$, $\\mathbf{p} = \\left[1.0\\times 10^{-28}, 1.0\\times 10^{-28}, 0.0\\right]\\,\\mathrm{C\\cdot m}$,\n  - $\\mathbf{r} = \\left[3.0\\times 10^{-9}, 0.0, 0.0\\right]\\,\\mathrm{m}$, $a = 2.0\\times 10^{-9}\\,\\mathrm{m}$,\n  - $\\boldsymbol{\\Delta} = \\left[4.0\\times 10^{-10}, 0.0, 0.0\\right]\\,\\mathrm{m}$,\n  - $L = 1$, $\\varepsilon_{\\mathrm{target}} = 1.0\\times 10^{-4}$,\n  - $\\theta_{\\min} = 0.1$, $\\theta_{\\max} = 0.7$.\n- Case $4$ (anisotropic variability aligned with dipole):\n  - $Q = 1.0\\times 10^{-19}\\,\\mathrm{C}$, $\\mathbf{p} = \\left[0.0, 5.0\\times 10^{-29}, 0.0\\right]\\,\\mathrm{C\\cdot m}$,\n  - $\\mathbf{r} = \\left[0.0, 5.0\\times 10^{-9}, 0.0\\right]\\,\\mathrm{m}$, $a = 1.0\\times 10^{-9}\\,\\mathrm{m}$,\n  - $\\boldsymbol{\\Delta} = \\left[0.0, 5.0\\times 10^{-10}, 0.0\\right]\\,\\mathrm{m}$,\n  - $L = 1$, $\\varepsilon_{\\mathrm{target}} = 5.0\\times 10^{-4}$,\n  - $\\theta_{\\min} = 0.15$, $\\theta_{\\max} = 0.75$.\n- Case $5$ (higher retained order affecting scaling exponent):\n  - $Q = 2.0\\times 10^{-19}\\,\\mathrm{C}$, $\\mathbf{p} = \\left[-1.0\\times 10^{-29}, 2.0\\times 10^{-29}, -1.0\\times 10^{-29}\\right]\\,\\mathrm{C\\cdot m}$,\n  - $\\mathbf{r} = \\left[6.0\\times 10^{-9}, -2.0\\times 10^{-9}, 2.0\\times 10^{-9}\\right]\\,\\mathrm{m}$, $a = 1.5\\times 10^{-9}\\,\\mathrm{m}$,\n  - $\\boldsymbol{\\Delta} = \\left[1.0\\times 10^{-10}, -1.0\\times 10^{-10}, 0.0\\right]\\,\\mathrm{m}$,\n  - $L = 2$, $\\varepsilon_{\\mathrm{target}} = 1.0\\times 10^{-3}$,\n  - $\\theta_{\\min} = 0.25$, $\\theta_{\\max} = 0.85$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, for example $[\\theta_1,\\theta_2,\\theta_3,\\theta_4,\\theta_5]$.",
            "solution": "The objective is to derive and implement a principled heuristic for an adaptive opening angle, $\\theta$, for the Fast Multipole Method (FMM). This heuristic should adjust $\\theta$ based on local field variability to achieve a target relative force accuracy, $\\varepsilon_{\\mathrm{target}}$, for Coulomb interactions. The derivation will proceed from the fundamental principles and constraints provided in the problem statement.\n\nThe core of any adaptive error control scheme is to estimate the error of an approximation and adjust parameters to keep this error within a desired tolerance. In our context, the relative error in the electric field $\\mathbf{E}$ (which is proportional to the force on a unit charge) must be bounded:\n$$\n\\frac{\\|\\mathbf{E}_{\\mathrm{error}}\\|}{\\|\\mathbf{E}_{\\mathrm{approx}}\\|} \\le \\varepsilon_{\\mathrm{target}}\n$$\nHere, $\\mathbf{E}_{\\mathrm{approx}}$ is the field computed using the multipole approximation, and $\\mathbf{E}_{\\mathrm{error}}$ is the truncation error, i.e., the difference between the true field and the approximation. As per the problem, we will use the monopole-plus-dipole field, $\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})$, as our reference approximation, so $\\|\\mathbf{E}_{\\mathrm{approx}}\\| \\approx \\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|$.\n\nThe problem states that the magnitude of the truncation error for a multipole expansion retaining terms up to order $L$ scales as:\n$$\n\\|\\mathbf{E}_{\\mathrm{error}}^{(L)}\\| \\approx C \\left(\\frac{a}{R}\\right)^{L+1}\n$$\nwhere $a$ is the characteristic radius of the source cluster, $R$ is the distance to the evaluation point, and $C$ is a prefactor that depends on the properties of the source distribution and the evaluation point. The FMM acceptance criterion uses the opening angle, which is the ratio of size to distance, $\\theta = a/R$. Substituting $\\theta$ into the error scaling law gives:\n$$\n\\|\\mathbf{E}_{\\mathrm{error}}^{(L)}\\| \\approx C \\theta^{L+1}\n$$\n\nCombining these relations, we can express the condition on $\\theta$:\n$$\n\\frac{C \\theta^{L+1}}{\\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|} \\le \\varepsilon_{\\mathrm{target}}\n$$\nSolving this inequality for $\\theta$ provides the basis for our adaptive rule:\n$$\n\\theta \\le \\left( \\frac{\\varepsilon_{\\mathrm{target}} \\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|}{C} \\right)^{\\frac{1}{L+1}}\n$$\nTo make this rule operational, we must devise a heuristic for the prefactor $C$ using only the quantities available from the problem statement: the monopole-only field $\\mathbf{E}_{\\mathrm{mono}}$, the monopole-plus-dipole field $\\mathbf{E}_{\\mathrm{dip}}$, the cluster radius $a$, and an estimate of the local field gradient $G$.\n\nThe prefactor $C$ represents the magnitude of the physics captured by the next-order terms in the expansion, which are neglected in the approximation. Its value should be large in regions of high field heterogeneity and small in homogeneous regions. The problem provides two proxies for this heterogeneity:\n$1$. The magnitude of the dipole correction, $\\delta E = \\|\\delta \\mathbf{E}\\| = \\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r}) - \\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r})\\|$. This quantity measures the strength of the first anisotropic term in the expansion. A large $\\delta E$ relative to the monopole field indicates a significant deviation from a simple point-charge field, suggesting that higher-order moments (quadrupole, etc.) may also be significant.\n$2$. A measure of the field's spatial variation, constructed from the finite-difference gradient estimate $G \\approx \\|\\nabla \\mathbf{E}\\|$. A rapidly changing field (large $G$) implies that higher-order derivatives are large, which in turn means that higher-order multipole terms are likely to be important. The quantity $aG$ has the same units as an electric field and represents the approximate change in the field's magnitude across the source cluster's characteristic length scale $a$.\n\nA robust and straightforward heuristic for $C$ is to combine these two indicators of heterogeneity. A simple additive model is a reasonable choice, as both terms contribute to the likely magnitude of the error. We propose the following heuristic for $C$:\n$$\nC = \\delta E + aG\n$$\nThis form ensures that if either the dipole moment is large (large $\\delta E$) or the field changes rapidly (large $G$), the estimated error prefactor $C$ increases. A larger $C$ leads to a smaller, more restrictive computed value for $\\theta$, forcing the FMM algorithm to refine the tree subdivision in heterogeneous regions. Conversely, in a nearly homogeneous field where both $\\delta E$ and $G$ are small, $C$ will be small, allowing a larger, less restrictive $\\theta$ and improving computational efficiency. This aligns with the design requirements.\n\nSubstituting our heuristic for $C$ into the expression for $\\theta$, we obtain the unconstrained adaptive opening angle:\n$$\n\\theta_{\\mathrm{calc}} = \\left( \\frac{\\varepsilon_{\\mathrm{target}} \\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|}{\\delta E + aG} \\right)^{\\frac{1}{L+1}}\n$$\nwhere $\\delta E = \\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r}) - \\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r})\\|$ and $G = \\frac{\\|\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r} + \\boldsymbol{\\Delta}) - \\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r})\\|}{\\|\\boldsymbol{\\Delta}\\|}$.\n\nTo ensure numerical stability and prevent pathological behavior, this calculated value must be clipped to the prescribed range $[\\theta_{\\min}, \\theta_{\\max}]$. The final adaptive opening angle, $\\theta$, is determined as follows: if the denominator $\\delta E + aG$ is zero (or numerically close to it), $\\theta$ is set to $\\theta_{\\max}$. Otherwise, the calculated value $\\theta_{\\mathrm{calc}}$ is computed and then clipped to the range $[\\theta_{\\min}, \\theta_{\\max}]$. This completes the derivation of the required heuristic. The implementation will involve creating functions to compute the electric fields $\\mathbf{E}_{\\mathrm{mono}}$ and $\\mathbf{E}_{\\mathrm{dip}}$, then using them to evaluate this expression for each of the test cases. The electric field contributions are given by:\n$$\n\\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r}) = k_e Q \\frac{\\mathbf{r}}{\\|\\mathbf{r}\\|^3}\n$$\n$$\n\\mathbf{E}_{\\mathrm{dip}}(\\mathbf{r}) = \\mathbf{E}_{\\mathrm{mono}}(\\mathbf{r}) + k_e \\frac{3(\\mathbf{p}\\cdot\\mathbf{r})\\mathbf{r} - \\|\\mathbf{r}\\|^2 \\mathbf{p}}{\\|\\mathbf{r}\\|^5}\n$$\nwhere $k_e = \\frac{1}{4\\pi\\epsilon_0}$.\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the adaptive opening angle for each test case.\n    \"\"\"\n    # Define physical constants\n    EPSILON_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n    K_E = 1.0 / (4 * np.pi * EPSILON_0)  # Coulomb's constant in N*m^2/C^2\n\n    test_cases = [\n        # Case 1: happy path, moderate variability\n        {\n            \"Q\": 5.0e-19, \"p\": np.array([2.0e-29, -1.0e-29, 0.5e-29]),\n            \"r\": np.array([4.0e-9, 3.0e-9, 0.0]), \"a\": 1.0e-9,\n            \"Delta\": np.array([2.0e-10, 0.0, 0.0]), \"L\": 1,\n            \"eps_target\": 1.0e-3, \"theta_min\": 0.2, \"theta_max\": 0.8\n        },\n        # Case 2: boundary condition, nearly homogeneous region\n        {\n            \"Q\": 1.0e-19, \"p\": np.array([0.0, 0.0, 0.0]),\n            \"r\": np.array([1.0e-8, 0.0, 0.0]), \"a\": 5.0e-10,\n            \"Delta\": np.array([1.0e-10, 0.0, 0.0]), \"L\": 1,\n            \"eps_target\": 1.0e-3, \"theta_min\": 0.2, \"theta_max\": 0.8\n        },\n        # Case 3: edge case, high variability near the cell\n        {\n            \"Q\": 1.0e-19, \"p\": np.array([1.0e-28, 1.0e-28, 0.0]),\n            \"r\": np.array([3.0e-9, 0.0, 0.0]), \"a\": 2.0e-9,\n            \"Delta\": np.array([4.0e-10, 0.0, 0.0]), \"L\": 1,\n            \"eps_target\": 1.0e-4, \"theta_min\": 0.1, \"theta_max\": 0.7\n        },\n        # Case 4: anisotropic variability aligned with dipole\n        {\n            \"Q\": 1.0e-19, \"p\": np.array([0.0, 5.0e-29, 0.0]),\n            \"r\": np.array([0.0, 5.0e-9, 0.0]), \"a\": 1.0e-9,\n            \"Delta\": np.array([0.0, 5.0e-10, 0.0]), \"L\": 1,\n            \"eps_target\": 5.0e-4, \"theta_min\": 0.15, \"theta_max\": 0.75\n        },\n        # Case 5: higher retained order affecting scaling exponent\n        {\n            \"Q\": 2.0e-19, \"p\": np.array([-1.0e-29, 2.0e-29, -1.0e-29]),\n            \"r\": np.array([6.0e-9, -2.0e-9, 2.0e-9]), \"a\": 1.5e-9,\n            \"Delta\": np.array([1.0e-10, -1.0e-10, 0.0]), \"L\": 2,\n            \"eps_target\": 1.0e-3, \"theta_min\": 0.25, \"theta_max\": 0.85\n        }\n    ]\n\n    def compute_e_fields(Q, p, r_vec, ke):\n        \"\"\"\n        Computes the monopole and monopole-plus-dipole electric fields.\n        \"\"\"\n        r_mag_sq = np.dot(r_vec, r_vec)\n        if r_mag_sq == 0:\n            return np.array([np.inf, np.inf, np.inf]), np.array([np.inf, np.inf, np.inf])\n        \n        r_mag = np.sqrt(r_mag_sq)\n        r_mag3 = r_mag_sq * r_mag\n        r_mag5 = r_mag3 * r_mag_sq\n\n        E_mono = ke * Q * r_vec / r_mag3\n\n        p_dot_r = np.dot(p, r_vec)\n        E_dipole_term = ke * (3.0 * p_dot_r * r_vec - r_mag_sq * p) / r_mag5\n        \n        E_dip = E_mono + E_dipole_term\n        \n        return E_mono, E_dip\n\n    results = []\n    for case in test_cases:\n        Q, p, r = case[\"Q\"], case[\"p\"], case[\"r\"]\n        a, Delta_vec, L = case[\"a\"], case[\"Delta\"], case[\"L\"]\n        eps_target = case[\"eps_target\"]\n        theta_min, theta_max = case[\"theta_min\"], case[\"theta_max\"]\n        \n        E_mono_r, E_dip_r = compute_e_fields(Q, p, r, K_E)\n        norm_E_dip_r = np.linalg.norm(E_dip_r)\n        \n        delta_E_vec = E_dip_r - E_mono_r\n        delta_E = np.linalg.norm(delta_E_vec)\n        \n        r_prime = r + Delta_vec\n        _, E_dip_r_prime = compute_e_fields(Q, p, r_prime, K_E)\n        \n        norm_Delta = np.linalg.norm(Delta_vec)\n        if norm_Delta == 0:\n            G = 0.0\n        else:\n            G = np.linalg.norm(E_dip_r_prime - E_dip_r) / norm_Delta\n\n        C = delta_E + a * G\n\n        if C = 1e-30: \n            theta = theta_max\n        else:\n            numerator = eps_target * norm_E_dip_r\n            if numerator  0:\n                theta = theta_min\n            else:\n                theta_calc = (numerator / C) ** (1.0 / (L + 1.0))\n                theta = np.clip(theta_calc, theta_min, theta_max)\n\n        results.append(theta)\n\n    return f\"[{','.join(f'{r:.8f}' for r in results)}]\"\n\n# The following is for execution and is not part of the solution content.\n# result_string = solve()\n# print(result_string) # -> [0.44682029,0.80000000,0.18731050,0.47054907,0.47353984]\n```",
            "answer": "[0.44682029,0.80000000,0.18731050,0.47054907,0.47353984]"
        }
    ]
}