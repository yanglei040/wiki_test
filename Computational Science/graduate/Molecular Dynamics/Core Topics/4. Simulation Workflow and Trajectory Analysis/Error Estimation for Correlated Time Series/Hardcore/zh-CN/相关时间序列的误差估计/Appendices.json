{
    "hands_on_practices": [
        {
            "introduction": "为了理解相关性如何影响统计误差，从一个简单的、可解的模型入手是很有帮助的。我们将使用一阶自回归（AR(1)）过程来为我们的时间序列数据建模，这个模型捕捉了时间相关性的本质——即每个数据点都依赖于前一个数据点。通过从第一性原理推导该模型的标准误差，您将清楚地看到相关系数 $\\phi$ 是如何直接放大与独立数据相比的不确定性的。这个练习  为解释为何简单的误差公式在分子动力学模拟中会失效提供了坚实的理论基础。",
            "id": "3411615",
            "problem": "一个从分子动力学（MD）中获得的标量可观测量的时间序列，记为 $X_{t}$，在均匀时间步长下采样，被假定为严格平稳的，并且可以由一个一阶自回归（AR）过程，具体来说是一阶自回归模型（AR(1)），很好地建模。也就是说，该过程满足 $X_{t} = \\mu + \\phi \\left(X_{t-1} - \\mu\\right) + \\varepsilon_{t}$，其中 $|\\phi|  1$，$\\mu$ 是平稳均值，$\\varepsilon_{t}$ 是均值为 $0$ 且方差有限的独立同分布新息。令 $\\bar{X}_{N} = \\frac{1}{N} \\sum_{t=1}^{N} X_{t}$ 表示 $N$ 个连续观测值的样本均值。\n\n从自协方差和相关随机变量之和的方差的定义出发，仅使用 AR(1) 结构和平稳性，推导在 $N$ 很大时的极限情况下 $\\bar{X}_{N}$ 的渐近标准误差。然后，通过确定 AR(1) 过程的 $\\bar{X}_{N}$ 的渐近标准误差与具有相同边际方差的独立同分布（i.i.d.）过程的渐近标准误差相比所差的乘法因子，给出与 i.i.d. 情况的定量比较。\n\n将您的最终答案表示为仅依赖于 $\\phi$ 的单个闭式解析表达式。不需要进行数值计算，最终表达式中也不应包含单位。不要对结果进行四舍五入或近似。",
            "solution": "该问题经验证具有科学依据、适定且客观。它是时间序列分析和统计力学中的一个标准推导。所有必要信息均已提供，且无矛盾之处。\n\n主要目标是推导 AR(1) 过程的样本均值 $\\bar{X}_N$ 的渐近标准误差与具有相同边际方差的独立同分布（i.i.d.）过程相比所差的乘法因子。该因子是两个标准误差之比。\n\n设时间序列为 $\\{X_t\\}$。$N$ 个观测值的样本均值为 $\\bar{X}_N = \\frac{1}{N} \\sum_{t=1}^{N} X_t$。样本均值的方差由下式给出：\n$$\n\\text{Var}(\\bar{X}_N) = \\text{Var}\\left(\\frac{1}{N} \\sum_{t=1}^{N} X_t\\right) = \\frac{1}{N^2} \\text{Var}\\left(\\sum_{t=1}^{N} X_t\\right)\n$$\n相关随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\text{Var}\\left(\\sum_{t=1}^{N} X_t\\right) = \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\text{Cov}(X_i, X_j)\n$$\n对于平稳过程，协方差 $\\text{Cov}(X_i, X_j)$ 仅取决于时间滞后 $|i-j|$。我们定义自协方差函数为 $\\gamma(k) = \\text{Cov}(X_t, X_{t+k})$。请注意，$\\gamma(0) = \\text{Var}(X_t) \\equiv \\sigma_X^2$ 是该过程的边际方差，且 $\\gamma(k) = \\gamma(-k)$。\n\n我们可以通过合并具有相同滞后 $k$ 的项来重写双重求和：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} \\text{Cov}(X_i, X_j) = \\sum_{i=1}^{N} \\text{Var}(X_i) + \\sum_{i \\neq j} \\text{Cov}(X_i, X_j) = N\\gamma(0) + 2 \\sum_{k=1}^{N-1} (N-k)\\gamma(k)\n$$\n因子 $(N-k)$ 计算了滞后为 $k$ 的观测值对的数量。将其代入 $\\text{Var}(\\bar{X}_N)$ 的表达式中：\n$$\n\\text{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\left[ N\\gamma(0) + 2 \\sum_{k=1}^{N-1} (N-k)\\gamma(k) \\right] = \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{k=1}^{N-1} \\left(1-\\frac{k}{N}\\right)\\gamma(k) \\right]\n$$\n对于大量样本，即 $N \\to \\infty$，对于任何固定的 $k$，项 $(1 - k/N)$ 趋近于 $1$。如果自协方差函数衰减得足够快，使得 $\\sum_{k=1}^{\\infty} \\gamma(k)$ 收敛，我们可以取其渐近极限：\n$$\n\\lim_{N\\to\\infty} N \\text{Var}(\\bar{X}_N) = \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(k) = \\sum_{k=-\\infty}^{\\infty} \\gamma(k)\n$$\n因此，对于较大的 $N$，均值的方差近似为：\n$$\n\\text{Var}(\\bar{X}_N) \\approx \\frac{1}{N} \\left( \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(k) \\right)\n$$\n接下来，我们确定指定的 AR(1) 过程 $X_t = \\mu + \\phi(X_{t-1} - \\mu) + \\varepsilon_t$ 的自协方差函数 $\\gamma(k)$。令 $Y_t = X_t - \\mu$。用中心化变量 $Y_t$ 表示的过程为 $Y_t = \\phi Y_{t-1} + \\varepsilon_t$。\n\n方差 $\\gamma(0) = \\text{Var}(X_t) = \\text{Var}(Y_t)$。利用平稳性性质 $\\text{Var}(Y_t) = \\text{Var}(Y_{t-1})$，我们可以写出：\n$$\n\\text{Var}(Y_t) = \\text{Var}(\\phi Y_{t-1} + \\varepsilon_t)\n$$\n由于 $Y_{t-1}$ 是过去新息 $\\{\\varepsilon_{t-1}, \\varepsilon_{t-2}, \\dots\\}$ 的函数，它与当前新息 $\\varepsilon_t$ 不相关。因此：\n$$\n\\text{Var}(Y_t) = \\phi^2 \\text{Var}(Y_{t-1}) + \\text{Var}(\\varepsilon_t)\n$$\n$$\n\\gamma(0) = \\phi^2 \\gamma(0) + \\sigma_\\varepsilon^2 \\implies \\gamma(0)(1-\\phi^2) = \\sigma_\\varepsilon^2 \\implies \\gamma(0) = \\frac{\\sigma_\\varepsilon^2}{1-\\phi^2}\n$$\n其中 $\\sigma_\\varepsilon^2 = \\text{Var}(\\varepsilon_t)$。由于 $|\\phi|1$，此式成立。所以，边际方差为 $\\sigma_X^2 = \\gamma(0)$。\n\n现在我们求滞后 $k  0$ 的自协方差：\n$$\n\\gamma(k) = \\text{Cov}(Y_t, Y_{t-k}) = E[Y_t Y_{t-k}] = E[(\\phi Y_{t-1} + \\varepsilon_t)Y_{t-k}]\n$$\n由于当 $k  0$ 时，$Y_{t-k}$ 与 $\\varepsilon_t$ 不相关：\n$$\n\\gamma(k) = \\phi E[Y_{t-1} Y_{t-k}] = \\phi \\text{Cov}(Y_{t-1}, Y_{t-k}) = \\phi \\gamma(k-1)\n$$\n这是一个递推关系。其解为 $\\gamma(k) = \\gamma(0)\\phi^k$（对于 $k \\ge 0$）。由于 $\\gamma(-k) = \\gamma(k)$，我们得到一般形式 $\\gamma(k) = \\gamma(0)\\phi^{|k|}$。\n\n现在我们可以将其代入均值方差的渐近公式中：\n$$\n\\text{Var}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\frac{1}{N} \\left( \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(0)\\phi^k \\right) = \\frac{\\gamma(0)}{N} \\left( 1 + 2 \\sum_{k=1}^{\\infty} \\phi^k \\right)\n$$\n该和是一个几何级数，由于 $|\\phi|1$，它收敛：\n$$\n\\sum_{k=1}^{\\infty} \\phi^k = \\frac{\\phi}{1-\\phi}\n$$\n将这个和代回方差表达式中：\n$$\n\\text{Var}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\frac{\\gamma(0)}{N} \\left( 1 + 2\\frac{\\phi}{1-\\phi} \\right) = \\frac{\\gamma(0)}{N} \\left( \\frac{1-\\phi+2\\phi}{1-\\phi} \\right) = \\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)\n$$\nAR(1) 过程的均值渐近标准误差是此方差的平方根：\n$$\n\\text{SE}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\sqrt{\\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}\n$$\n对于具有相同边际方差 $\\sigma_X^2 = \\gamma(0)$ 的 i.i.d. 过程这一参考情况，观测值是不相关的，因此对于 $k \\neq 0$，$\\gamma(k) = 0$。样本均值的方差为：\n$$\n\\text{Var}_{\\text{i.i.d.}}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{t=1}^N \\text{Var}(X_t) = \\frac{1}{N^2} N\\gamma(0) = \\frac{\\gamma(0)}{N}\n$$\ni.i.d. 情况的标准误差为：\n$$\n\\text{SE}_{\\text{i.i.d.}}(\\bar{X}_N) = \\sqrt{\\frac{\\gamma(0)}{N}}\n$$\n最后，AR(1) 过程的渐近标准误差与 i.i.d. 情况相比所差的乘法因子是它们的标准误差之比：\n$$\n\\text{Factor} = \\frac{\\text{SE}_{\\text{AR(1)}}(\\bar{X}_N)}{\\text{SE}_{\\text{i.i.d.}}(\\bar{X}_N)} = \\frac{\\sqrt{\\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}}{\\sqrt{\\frac{\\gamma(0)}{N}}} = \\sqrt{\\frac{1+\\phi}{1-\\phi}}\n$$\n这个因子通常与积分自相关时间的概念相关，它量化了序列相关性对样本均值估计不确定性的影响。",
            "answer": "$$\\boxed{\\sqrt{\\frac{1+\\phi}{1-\\phi}}}$$"
        },
        {
            "introduction": "虽然 AR(1) 模型很有启发性，但真实的模拟数据具有更复杂的相关结构。这节练习介绍了积分自相关时间（IACT），即 $\\tau_{\\mathrm{int}}$，这是一个关键指标，它概括了时间序列中的总相关性。您将推导平均值的方差与 $\\tau_{\\mathrm{int}}$ 的关系，并将其应用于一种常见的误差估计方法：分块平均法（block averaging）。这项练习  构架了理论与实践之间的桥梁，您将学会一套从相关数据中估计置信区间的稳健工作流程，以及一个选择合理块大小的实用规则。",
            "id": "3411613",
            "problem": "给定一个离散时间、平稳、遍历的时间序列 $\\{X_t\\}_{t=1}^N$，它代表了从分子动力学 (MD) 模拟中抽样的势能。令 $\\mu = \\mathbb{E}[X_t]$ 和 $\\sigma^2 = \\mathrm{Var}(X_t)$ 分别表示每样本的均值和方差。令自协方差函数为 $\\gamma(t) = \\mathrm{Cov}(X_s, X_{s+t})$，自相关函数为 $\\rho(t) = \\gamma(t)/\\gamma(0)$，其中整数延迟 $t \\ge 0$。积分自相关时间 (IACT) $\\tau_{\\mathrm{int}}$ 定义为 $\\tau_{\\mathrm{int}} = \\tfrac{1}{2} + \\sum_{t=1}^{\\infty} \\rho(t)$，假设 $\\rho(t)$ 是绝对可和的。样本均值为 $\\bar{X}_N = \\tfrac{1}{N}\\sum_{t=1}^N X_t$。\n\n任务1（推导）：仅使用上述定义以及平稳、混合过程的自协方差和的渐近行为，推导出一个关于 $\\mathrm{Var}(\\bar{X}_N)$ 的大$N$渐近表达式，该表达式需明确包含 $\\sigma^2$、$\\tau_{\\mathrm{int}}$ 和 $N$。在正态近似下，使用您的推导结果构建一个关于 $\\bar{X}_N$ 的双边 $95\\%$ 置信区间，该区间用 $\\sigma^2$、$\\tau_{\\mathrm{int}}$ 和 $N$ 表示。必须使用 $95\\%$ 的双边高斯分位数，对应于 $z_{0.975}$。\n\n任务2（块大小选择）：非重叠块平均是将相关数据组织成近似独立的块均值的标准设计选择。令块大小为整数 $b \\ge 1$，完整块的数量为 $M = \\lfloor N/b \\rfloor$。根据以下确定性策略选择 $b$，该策略的动机是要求有足够多的块以满足中心极限定理的条件，同时倾向于选择比相关尺度长的块：\n- 计算首选大小 $b_0 = \\lceil 20 \\, \\tau_{\\mathrm{int}} \\rceil$。\n- 如果 $\\lfloor N / b_0 \\rfloor \\ge 30$，则设置 $b = b_0$；否则，设置 $b = \\max\\{1, \\lfloor N/30 \\rfloor\\}$。\n\n任务3（数值评估）：对于下面的每个测试用例，给定 $N$、$\\tau_{\\mathrm{int}}$ 的估计值以及每样本标准差 $s$ 的估计值（因此 $\\sigma \\approx s$）。计算：\n- 使用任务2中的策略选择的块大小 $b$（无单位整数）。\n- 使用任务1的结果计算 $\\bar{X}_N$ 的双边 $95\\%$ 置信区间的半宽 $h$。将 $h$ 以千焦/摩尔 (kJ/mol) 为单位表示，并四舍五入到三位有效数字。\n\n使用以下测试套件（每个三元组为 $(N, \\tau_{\\mathrm{int}}, s)$，其中 $s$ 的单位是 kJ/mol）：\n- 用例 A: $(N, \\tau_{\\mathrm{int}}, s) = (10^6, 500, 50)$。\n- 用例 B: $(N, \\tau_{\\mathrm{int}}, s) = (5 \\times 10^4, 0.5, 10)$。\n- 用例 C: $(N, \\tau_{\\mathrm{int}}, s) = (2 \\times 10^4, 3000, 20)$。\n- 用例 D: $(N, \\tau_{\\mathrm{int}}, s) = (10^3, 600, 5)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含按 A、B、C、D 顺序排列的四个用例的结果列表。每个结果必须是一个双元素列表 $[b, h]$，其中 $b$ 是一个整数，$h$ 是一个四舍五入到三位有效数字的浮点数。整个输出必须是包含在方括号中的单个逗号分隔列表，例如 $[[b_A,h_A],[b_B,h_B],[b_C,h_C],[b_D,h_D]]$。半宽 $h$ 必须以 kJ/mol 为单位表示。不应打印任何附加文本。",
            "solution": "该问题被评估为有效。它在科学上基于统计力学和时间序列分析的原理，特别是关于分子动力学 (MD) 模拟中相关数据的分析。问题陈述清晰，提供了所有必要的定义、数据和约束，以便推导和计算所要求的量。任务是客观且可形式化的。\n\n解决方案按规定分为三个部分：理论推导、块大小选择算法描述以及给定测试用例的数值评估。\n\n任务1：样本均值方差和置信区间的推导\n\n设 $\\{X_t\\}_{t=1}^N$ 是一个平稳时间序列，其均值为 $\\mu = \\mathbb{E}[X_t]$，方差为 $\\sigma^2 = \\mathrm{Var}(X_t)$。样本均值定义为 $\\bar{X}_N = \\frac{1}{N}\\sum_{t=1}^N X_t$。我们寻求其方差 $\\mathrm{Var}(\\bar{X}_N)$ 的一个渐近表达式。\n\n根据方差的性质，\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{t=1}^N X_t\\right) = \\frac{1}{N^2} \\mathrm{Var}\\left(\\sum_{t=1}^N X_t\\right)\n$$\n随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\mathrm{Var}\\left(\\sum_{t=1}^N X_t\\right) = \\sum_{i=1}^N \\sum_{j=1}^N \\mathrm{Cov}(X_i, X_j)\n$$\n由于平稳性，自协方差 $\\mathrm{Cov}(X_i, X_j)$ 仅取决于时间延迟 $\\tau = |i-j|$，我们将其表示为 $\\gamma(i-j)$。\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{i=1}^N \\sum_{j=1}^N \\gamma(j-i)\n$$\n这个双重求和可以通过延迟 $t = j-i$ 重新索引，其范围从 $-(N-1)$ 到 $N-1$。对于给定的延迟 $t$，有 $N-|t|$ 个对 $(i,j)$ 满足 $j-i=t$。\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{t=-(N-1)}^{N-1} (N-|t|) \\gamma(t)\n$$\n在求和内部将项 $(N-|t|)$ 除以 $N$ 可得：\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N} \\sum_{t=-(N-1)}^{N-1} \\left(1 - \\frac{|t|}{N}\\right) \\gamma(t)\n$$\n利用自协方差函数的对称性 $\\gamma(t) = \\gamma(-t)$，我们可以写出：\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{t=1}^{N-1} \\left(1 - \\frac{t}{N}\\right) \\gamma(t) \\right]\n$$\n对于大样本量 $N$，以及相关性衰减足够快的过程（一个“混合”过程，这在遍历 MD 模拟中很典型），对于 $\\gamma(t)$ 显著不为零的延迟 $t$，项 $t/N$ 可以忽略不计。由于当 $t$ 很大时 $\\gamma(t) \\to 0$，求和也可以扩展到无穷大。这给出了大 $N$ 的渐近表达式：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{t=1}^{\\infty} \\gamma(t) \\right]\n$$\n回顾定义 $\\gamma(0) = \\sigma^2$ 和自相关函数 $\\rho(t) = \\gamma(t)/\\gamma(0)$，我们可以提出因子 $\\sigma^2$：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t) \\right]\n$$\n问题将积分自相关时间 (IACT) 定义为 $\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{t=1}^{\\infty} \\rho(t)$。根据这个定义，我们可以将求和表示为 $2\\sum_{t=1}^{\\infty} \\rho(t) = 2\\tau_{\\mathrm{int}} - 1$。将此代入方差表达式中：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + (2\\tau_{\\mathrm{int}} - 1) \\right] = \\frac{2 \\tau_{\\mathrm{int}} \\sigma^2}{N}\n$$\n这就是所求的样本均值方差的渐近表达式。量 $N_{\\mathrm{eff}} = N / (2\\tau_{\\mathrm{int}})$ 可以解释为有效独立样本数。\n\n对于真实均值 $\\mu$ 的双边 $95\\%$ 置信区间，我们援引平稳时间序列的中心极限定理，该定理指出对于大 $N$ 值，$\\bar{X}_N$ 近似服从正态分布。标准化变量 $Z = (\\bar{X}_N - \\mu) / \\sqrt{\\mathrm{Var}(\\bar{X}_N)}$ 服从标准正态分布。置信区间由 $\\bar{X}_N \\pm h$ 给出，其中 $h$ 是半宽：\n$$\nh = z_{0.975} \\sqrt{\\mathrm{Var}(\\bar{X}_N)} = z_{0.975} \\sqrt{\\frac{2 \\tau_{\\mathrm{int}} \\sigma^2}{N}}\n$$\n其中 $z_{0.975}$ 是标准正态分布的 $0.975$ 分位数。使用数值库，该值为 $z_{0.975} \\approx 1.959964$。\n\n任务2：块大小选择策略\n\n选择块大小 $b$ 的策略是一个基于总样本数 $N$ 和 IACT $\\tau_{\\mathrm{int}}$ 的确定性算法。\n1.  计算首选块大小 $b_0 = \\lceil 20 \\, \\tau_{\\mathrm{int}} \\rceil$。此举旨在使块的长度远大于相关时间（$2\\tau_{\\mathrm{int}}$）。\n2.  计算这将产生的块数 $M_0 = \\lfloor N / b_0 \\rfloor$。\n3.  如果 $M_0 \\ge 30$，则有足够的块数使得中心极限定理适用于块平均值。在这种情况下，块大小设置为 $b = b_0$。\n4.  如果 $M_0  30$，则首选块大小 $b_0$ 对于给定的 $N$ 来说太大了。该策略随后通过将块大小设置为 $b = \\max\\{1, \\lfloor N/30 \\rfloor\\}$ 来优先保证至少有 30 个块。$\\max\\{1, ...\\}$ 确保块大小至少为 1。\n\n任务3：数值评估\n\n对于每个测试用例 $(N, \\tau_{\\mathrm{int}}, s)$，我们计算块大小 $b$ 和置信区间半宽 $h$。\n块大小 $b$ 根据任务2中的逻辑计算为整数值。\n半宽 $h$ 使用任务1中的公式计算，将给定的估计值 $s$ 代替 $\\sigma$：\n$$\nh = z_{0.975} \\cdot s \\cdot \\sqrt{\\frac{2 \\tau_{\\mathrm{int}}}{N}}\n$$\n然后将结果 $h$ 四舍五入到三位有效数字。为了实现此舍入并保持正确的格式（例如，尾随零），用于舍入的小数位数 $d$ 由该值的以 10 为底的对数确定：$d = \\text{sf} - 1 - \\lfloor \\log_{10}|h| \\rfloor$，其中 $\\text{sf}=3$。然后将最终值格式化为 $d$ 位小数。\n\n四个测试用例按如下方式处理：\n- 用例 A: $(N, \\tau_{\\mathrm{int}}, s) = (10^6, 500, 50)$\n  $b_0 = \\lceil 20 \\times 500 \\rceil = 10000$。$\\lfloor 10^6 / 10000 \\rfloor = 100 \\ge 30$，所以 $b=10000$。\n  $h = 1.959964 \\times 50 \\times \\sqrt{2 \\times 500 / 10^6} \\approx 3.0989$ kJ/mol。四舍五入到3位有效数字， $h=3.10$ kJ/mol。\n- 用例 B: $(N, \\tau_{\\mathrm{int}}, s) = (5 \\times 10^4, 0.5, 10)$\n  $b_0 = \\lceil 20 \\times 0.5 \\rceil = 10$。$\\lfloor 5 \\times 10^4 / 10 \\rfloor = 5000 \\ge 30$，所以 $b=10$。\n  $h = 1.959964 \\times 10 \\times \\sqrt{2 \\times 0.5 / (5 \\times 10^4)} \\approx 0.08765$ kJ/mol。四舍五入到3位有效数字， $h=0.0877$ kJ/mol。\n- 用例 C: $(N, \\tau_{\\mathrm{int}}, s) = (2 \\times 10^4, 3000, 20)$\n  $b_0 = \\lceil 20 \\times 3000 \\rceil = 60000$。$\\lfloor 2 \\times 10^4 / 60000 \\rfloor = 0  30$，所以 $b = \\max\\{1, \\lfloor 2 \\times 10^4 / 30 \\rfloor\\} = 666$。\n  $h = 1.959964 \\times 20 \\times \\sqrt{2 \\times 3000 / (2 \\times 10^4)} \\approx 21.471$ kJ/mol。四舍五入到3位有效数字， $h=21.5$ kJ/mol。\n- 用例 D: $(N, \\tau_{\\mathrm{int}}, s) = (10^3, 600, 5)$\n  $b_0 = \\lceil 20 \\times 600 \\rceil = 12000$。$\\lfloor 10^3 / 12000 \\rfloor = 0  30$，所以 $b = \\max\\{1, \\lfloor 10^3 / 30 \\rfloor\\} = 33$。\n  $h = 1.959964 \\times 5 \\times \\sqrt{2 \\times 600 / 10^3} \\approx 10.735$ kJ/mol。四舍五入到3位有效数字， $h=10.7$ kJ/mol。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating block size and confidence interval half-width\n    for a set of test cases related to correlated time series analysis.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, tau_int, s)\n    test_cases = [\n        (10**6, 500.0, 50.0),        # Case A\n        (5 * 10**4, 0.5, 10.0),    # Case B\n        (2 * 10**4, 3000.0, 20.0),  # Case C\n        (10**3, 600.0, 5.0),         # Case D\n    ]\n\n    # Pre-calculate the 95% two-sided Gaussian quantile (z_{0.975})\n    z_975 = norm.ppf(0.975)\n    \n    # This list will store the final results for all test cases.\n    results_list = []\n\n    for case in test_cases:\n        N, tau_int, s = case\n\n        # Task 2: Block size selection\n        # Compute the preferred block size b_0\n        b0 = np.ceil(20 * tau_int)\n        \n        # Check if using b_0 yields at least 30 blocks\n        if np.floor(N / b0) >= 30:\n            b = int(b0)\n        else:\n            # Otherwise, set block size to ensure about 30 blocks\n            b = int(max(1, np.floor(N / 30)))\n\n        # Task 3: Numerical evaluation of the half-width h\n        # Formula derived in Task 1: h = z * s * sqrt(2 * tau_int / N)\n        # We must handle the case where N or tau_int is zero to avoid division errors,\n        # although the test cases prevent this.\n        if N > 0 and tau_int >= 0:\n            h_unrounded = z_975 * s * np.sqrt(2 * tau_int / N)\n        else:\n            h_unrounded = 0.0\n\n        results_list.append([b, h_unrounded])\n\n    # Format the final output string according to the problem specification.\n    # The half-width 'h' must be represented as a number rounded to three\n    # significant figures, which requires careful string formatting to handle\n    # cases like 3.10 correctly.\n    formatted_results = []\n    for b_val, h_val in results_list:\n        if h_val == 0:\n            h_str = \"0.0\"\n        else:\n            # Calculate the number of decimal places required for 3 significant figures.\n            # a) Find the magnitude of the number: floor(log10(|h|))\n            # b) Decimal places = sf - 1 - magnitude, where sf=3\n            magnitude = np.floor(np.log10(np.abs(h_val)))\n            decimals = 3 - 1 - int(magnitude)\n            if decimals  0: decimals = 0\n            h_str = f\"{h_val:.{decimals}f}\"\n        \n        # In Python 3, str(float) might not produce the required trailing zeros,\n        # e.g., str(3.10) is '3.1'. To conform to the \"three significant figures\"\n        # requirement in the output representation, we format it as a string.\n        # However, the final output must not have quotes around numbers.\n        # Python's list-to-string conversion will handle this. We must convert\n        # the formatted string back to a float for cases like '3.10' -> 3.1,\n        # yet this loses the formatting. The most compliant interpretation\n        # is to construct the final string manually.\n        formatted_results.append(f\"[{b_val},{h_str}]\")\n        \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "我们已经看到分块平均法是一种有用的技术，但块大小的选择至关重要，一个糟糕的选择可能会导致有偏的或高度不确定的误差估计。这项高级练习深入探讨了分块平均法本身的统计特性，通过将底层数据建模为连续时间的 Ornstein-Uhlenbeck 过程，我们可以分析方差估计量的均方误差（MSE），它由偏差和方差两部分组成。通过最小化这个 MSE，您将推导出*最优*的块长度，作为模拟总时长和系统内在弛豫时间的函数 ，这展示了严谨的理论分析如何能够引导出强大的、实用的数据分析指南。",
            "id": "3411678",
            "problem": "在使用随机压力控制器的等温等压分子动力学（MD）中，模拟单元体积的微小平衡涨落可以被建模为对热力学力和随机热噪声的线性响应。假设压力控制器引起一个单一的特征弛豫速率，称为压力控制器摩擦速率，用 $\\xi$ 表示，单位为时间倒数，并且对于围绕平衡态的微小偏差，体积时间序列 $V(t)$ 作为一个平稳高斯马尔可夫过程演化。将压力控制器驱动的 $V(t)$ 视为一个奥恩斯坦-乌伦贝克（OU）过程，其弛豫由 $\\xi$ 控制，平稳方差为 $\\sigma_{V}^{2}$，并假设轨迹在总观测时间 $T$ 内被连续记录。\n\n您需要将轨迹划分为 $m$ 个相等且连续的块，每个块的时间跨度为 $L$，因此 $m = T/L$。令 $Y_{j}$ 为第 $j$ 个块上 $V(t)$ 的均值，并通过计算块均值的样本方差并按块数缩放来定义总时间平均值 $\\bar{V}$ 的方差估计量：$\\widehat{\\mathrm{Var}}(\\bar{V}) := s_{Y}^{2}/m$，其中 $s_{Y}^{2}$ 是 $\\{Y_{j}\\}_{j=1}^{m}$ 的样本方差。\n\n从奥恩斯坦-乌伦贝克过程的标准随机动力学假设以及方差和自协方差的基本时间序列定义出发，执行以下操作：\n\n- 推导 $V(t)$ 的自相关结构，作为压力控制器摩擦速率 $\\xi$ 和积分自相关时间的函数。\n- 计算单个块均值 $Y_{j}$ 的精确方差以及两个块均值 $Y_{j}$ 和 $Y_{j+k}$ 之间的互协方差。\n- 使用这些结果，以 $\\sigma_{V}^{2}$、$\\xi$ 和 $T$ 表示 $\\mathrm{Var}(\\bar{V})$ 的精确表达式。\n- 在忽略块间相关性的情况下，分析 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差，并在假设对于足够大的 $L$，块均值是近似独立的高斯变量的情况下，估计 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的方差。\n- 构建一个显式的近似均方误差函数 $\\mathrm{MSE}(L)$，该函数能够捕捉 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差和方差之间的主导阶权衡，作为块持续时间 $L$、总观测时间 $T$ 和压力控制器摩擦速率 $\\xi$ 的函数。\n- 对此 $\\mathrm{MSE}(L)$ 关于 $L$ 进行最小化，以获得最优块持续时间 $L^{\\ast}$ 的闭式解析表达式。\n\n将最优块持续时间 $L^{\\ast}$ 表示为以秒为单位、用 $T$ 和 $\\xi$ 表示的单一解析表达式，最终表达式中不应包含其他参数。无需进行数值舍入。最终答案必须是单一的闭式表达式，并且在最终的方框表达式内不得包含任何单位。",
            "solution": "用户在分子动力学模拟的统计分析领域提供了一个有效且适定的问题。该问题要求推导用于估计时间平均属性方差的最优块长度，该属性被建模为奥恩斯坦-乌伦贝克过程。解答过程遵循问题陈述中概述的任务序列。\n\n体积涨落 $V(t)$ 被建模为一个平稳的奥恩斯坦-乌伦贝克（OU）过程。对应的 $V(t)$ 的朗之万方程（为方便协方差计算，不失一般性地将其均值 $\\mu_V$ 设为 $0$）为：\n$$\n\\frac{dV(t)}{dt} = -\\xi V(t) + \\eta(t)\n$$\n其中 $\\xi$ 是压力控制器摩擦速率，$\\eta(t)$ 是一个白噪声项，满足 $\\langle \\eta(t) \\eta(t') \\rangle = 2D \\delta(t-t')$。该过程的平稳方差为 $\\sigma_V^2 = \\langle V(t)^2 \\rangle = D/\\xi$。\n\n**1. $V(t)$ 的自相关结构**\n\n对于一个平稳的OU过程，其自相关函数（ACF）由下式给出：\n$$\nC_V(\\tau) = \\text{Cov}(V(t), V(t+\\tau)) = \\langle V(t)V(t+\\tau) \\rangle = \\sigma_V^2 \\exp(-\\xi |\\tau|)\n$$\n归一化自相关函数为 $\\rho_V(\\tau) = C_V(\\tau) / C_V(0) = \\exp(-\\xi |\\tau|)$。\n\n积分自相关时间 $\\tau_{int}$ 是归一化ACF的积分：\n$$\n\\tau_{int} = \\int_0^\\infty \\rho_V(\\tau) d\\tau = \\int_0^\\infty \\exp(-\\xi \\tau) d\\tau = \\left[ -\\frac{1}{\\xi} \\exp(-\\xi \\tau) \\right]_0^\\infty = \\frac{1}{\\xi}\n$$\n因此，相关的特征时间尺度是压力控制器摩擦速率的倒数。\n\n**2. 块均值的方差和协方差**\n\n在持续时间为 $L$ 的第 $j$ 个块上，$V(t)$ 的均值为 $Y_j = \\frac{1}{L} \\int_{(j-1)L}^{jL} V(t) \\, dt$。由于 $\\langle V(t) \\rangle = 0$，我们有 $\\langle Y_j \\rangle = 0$。\n\n单个块均值的方差 $\\mathrm{Var}(Y_j)$ 由ACF在该块上的二重积分给出：\n$$\n\\mathrm{Var}(Y_j) = \\langle Y_j^2 \\rangle = \\frac{1}{L^2} \\int_{(j-1)L}^{jL} \\int_{(j-1)L}^{jL} \\langle V(t)V(t') \\rangle \\, dt \\, dt'\n$$\n为简化起见，我们将积分域平移到 $[0, L]$：\n$$\n\\mathrm{Var}(Y_j) = \\frac{\\sigma_V^2}{L^2} \\int_0^L \\int_0^L \\exp(-\\xi|t-t'|) \\, dt \\, dt' = \\frac{2\\sigma_V^2}{L^2} \\int_0^L dt \\int_0^t dt' \\exp(-\\xi(t-t'))\n$$\n内部积分为 $\\int_0^t \\exp(-\\xi(t-t')) \\, dt' = \\exp(-\\xi t) \\left[\\frac{1}{\\xi}\\exp(\\xi t')\\right]_0^t = \\frac{1}{\\xi}(1 - \\exp(-\\xi t))$。\n外部积分变为：\n$$\n\\frac{2\\sigma_V^2}{L^2} \\int_0^L \\frac{1}{\\xi}(1 - \\exp(-\\xi t)) \\, dt = \\frac{2\\sigma_V^2}{\\xi L^2} \\left[t + \\frac{1}{\\xi}\\exp(-\\xi t)\\right]_0^L = \\frac{2\\sigma_V^2}{\\xi L^2} \\left(L + \\frac{1}{\\xi}(\\exp(-\\xi L) - 1)\\right)\n$$\n因此，块均值的精确方差为：\n$$\n\\mathrm{Var}(Y_j) = \\frac{2\\sigma_V^2}{\\xi^2 L^2} \\left(\\xi L - 1 + \\exp(-\\xi L)\\right)\n$$\n对于 $k \\ge 1$，块均值 $Y_j$ 和 $Y_{j+k}$ 之间的互协方差为：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{1}{L^2} \\int_{(j-1)L}^{jL} dt \\int_{(j+k-1)L}^{(j+k)L} dt' \\, \\sigma_V^2 \\exp(-\\xi(t'-t))\n$$\n因为 $t'  t$。令 $u = t - (j-1)L$ 和 $v = t' - (j+k-1)L$。那么 $t'-t = v-u+kL$。\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{\\sigma_V^2}{L^2} \\int_0^L du \\int_0^L dv \\, \\exp(-\\xi(v-u+kL)) = \\frac{\\sigma_V^2}{L^2} \\exp(-\\xi kL) \\left(\\int_0^L \\exp(\\xi u) du\\right) \\left(\\int_0^L \\exp(-\\xi v) dv\\right)\n$$\n这两个积分分别得到 $\\frac{1}{\\xi}(\\exp(\\xi L) - 1)$ 和 $\\frac{1}{\\xi}(1 - \\exp(-\\xi L))$。它们的乘积是 $\\frac{1}{\\xi^2}(\\exp(\\xi L) - 2 + \\exp(-\\xi L)) = \\frac{1}{\\xi^2}(\\exp(\\xi L/2) - \\exp(-\\xi L/2))^2$。\n乘积的一个更简单的形式是 $\\frac{1}{\\xi^2}(\\exp(\\xi L)-1)(1-\\exp(-\\xi L)) = \\frac{1}{\\xi^2}\\exp(\\xi L)(1-\\exp(-\\xi L))^2$。\n所以，协方差为：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{\\sigma_V^2}{\\xi^2 L^2} \\exp(-\\xi kL) (\\exp(\\xi L)-1)(1-\\exp(-\\xi L)) = \\frac{\\sigma_V^2}{\\xi^2 L^2} (1 - \\exp(-\\xi L))^2 \\exp(-\\xi(k-1)L)\n$$\n\n**3. 总均值 $\\bar{V}$ 的精确方差**\n\n总均值为 $\\bar{V} = \\frac{1}{T} \\int_0^T V(t) \\, dt$。其方差 $\\mathrm{Var}(\\bar{V})$ 的函数形式与 $\\mathrm{Var}(Y_j)$ 相同，只需将 $L$ 替换为 $T$：\n$$\n\\mathrm{Var}(\\bar{V}) = \\frac{2\\sigma_V^2}{\\xi^2 T^2} \\left(\\xi T - 1 + \\exp(-\\xi T)\\right)\n$$\n在长观测时间极限 $T \\gg 1/\\xi$ 下，该表达式简化为众所周知的结果：\n$$\n\\mathrm{Var}(\\bar{V}) \\approx \\frac{2\\sigma_V^2}{\\xi T} = \\frac{2 \\sigma_V^2 \\tau_{int}}{T}\n$$\n\n**4. 估计量 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差和方差**\n\n估计量为 $\\widehat{\\mathrm{Var}}(\\bar{V}) = s_Y^2 / m$，其中 $s_Y^2 = \\frac{1}{m-1}\\sum_{j=1}^m (Y_j - \\bar{Y})^2$ 且 $m=T/L$。\n估计量的期望为 $\\mathrm{E}[\\widehat{\\mathrm{Var}}(\\bar{V})] = \\frac{1}{m} \\mathrm{E}[s_Y^2]$。相关时间序列的样本方差的期望为 $\\mathrm{E}[s_Y^2] = \\mathrm{Var}(Y_j) - \\frac{2}{m-1}\\sum_{k=1}^{m-1}(1-k/m)\\mathrm{Cov}(Y_j, Y_{j+k})$。\n估计量的偏差为 $\\mathrm{Bias} = \\mathrm{E}[\\widehat{\\mathrm{Var}}(\\bar{V})] - \\mathrm{Var}(\\bar{V})$。\n为了找到最优的 $L$，我们需要块长度 $L \\gg \\tau_{int} = 1/\\xi$ 时偏差的主导阶行为。在此极限下，块之间的相关性很弱且迅速衰减。偏差的主要贡献来自相邻块之间的协方差，即 $k=1$。\n$$\n\\mathrm{Bias} \\approx \\frac{1}{m} \\left( \\mathrm{Var}(Y_j) - \\mathrm{Var}(Y_j) - 2\\mathrm{Cov}(Y_j, Y_{j+1}) \\right) = -\\frac{2}{m} \\mathrm{Cov}(Y_j, Y_{j+1})\n$$\n使用 $\\mathrm{Cov}(Y_j, Y_{j+1})$ 的表达式并取极限 $L \\gg 1/\\xi$：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+1}) = \\frac{\\sigma_V^2}{\\xi^2 L^2} (1 - \\exp(-\\xi L))^2 \\approx \\frac{\\sigma_V^2}{\\xi^2 L^2}\n$$\n则偏差为：\n$$\n\\mathrm{Bias} \\approx -\\frac{2}{m} \\frac{\\sigma_V^2}{\\xi^2 L^2} = -\\frac{2L}{T} \\frac{\\sigma_V^2}{\\xi^2 L^2} = -\\frac{2\\sigma_V^2}{T\\xi^2 L}\n$$\n偏差的平方为：\n$$\n(\\mathrm{Bias})^2 \\approx \\left(-\\frac{2\\sigma_V^2}{T\\xi^2 L}\\right)^2 = \\frac{4\\sigma_V^4}{T^2\\xi^4 L^2}\n$$\n现在我们估计估计量的方差。问题要求我们假设对于大的 $L$，块均值 $Y_j$ 是近似独立的高斯变量。在此假设下，$(m-1)s_Y^2/\\mathrm{Var}(Y_j)$ 近似服从自由度为 $m-1$ 的卡方分布。那么 $s_Y^2$ 的方差为 $\\mathrm{Var}(s_Y^2) \\approx \\frac{2(\\mathrm{Var}(Y_j))^2}{m-1}$。\n我们估计量的方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V})) = \\frac{1}{m^2} \\mathrm{Var}(s_Y^2) \\approx \\frac{2(\\mathrm{Var}(Y_j))^2}{m^2(m-1)}\n$$\n对于大的 $m$（通常 $T \\gg L$），我们可以近似 $m-1 \\approx m$。对于大的 $L$，$\\mathrm{Var}(Y_j) \\approx \\frac{2\\sigma_V^2}{\\xi L}$。\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V})) \\approx \\frac{2}{m^3} \\left(\\frac{2\\sigma_V^2}{\\xi L}\\right)^2 = \\frac{8\\sigma_V^4}{m^3 \\xi^2 L^2}\n$$\n代入 $m=T/L$：\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V})) \\approx \\frac{8\\sigma_V^4}{(T/L)^3 \\xi^2 L^2} = \\frac{8\\sigma_V^4 L^3}{T^3 \\xi^2 L^2} = \\frac{8\\sigma_V^4 L}{T^3 \\xi^2}\n$$\n\n**5. 均方误差函数**\n\n均方误差（MSE）是偏差平方与方差之和：\n$$\n\\mathrm{MSE}(L) = (\\mathrm{Bias})^2 + \\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V}))\n$$\n使用我们的主导阶近似，我们构建MSE函数：\n$$\n\\mathrm{MSE}(L) \\approx \\frac{4\\sigma_V^4}{T^2\\xi^4 L^2} + \\frac{8\\sigma_V^4 L}{T^3 \\xi^2}\n$$\n这个函数抓住了本质的权衡：偏差平方项随 $L^{-2}$ 减小，而方差项随 $L^1$ 增加。\n\n**6. 最优块持续时间 $L^{\\ast}$**\n\n为了找到最小化MSE的最优块持续时间 $L^{\\ast}$，我们将 $\\mathrm{MSE}(L)$ 对 $L$ 求导并令其为零。\n$$\n\\frac{d}{dL} \\mathrm{MSE}(L) = \\frac{d}{dL} \\left( \\frac{4\\sigma_V^4}{T^2\\xi^4} L^{-2} + \\frac{8\\sigma_V^4}{T^3 \\xi^2} L \\right) = 0\n$$\n$$\n-2 \\cdot \\frac{4\\sigma_V^4}{T^2\\xi^4} L^{-3} + \\frac{8\\sigma_V^4}{T^3 \\xi^2} = 0\n$$\n$$\n\\frac{8\\sigma_V^4}{T^2\\xi^4 L^3} = \\frac{8\\sigma_V^4}{T^3 \\xi^2}\n$$\n我们可以消去公因子 $8\\sigma_V^4$：\n$$\n\\frac{1}{T^2\\xi^4 L^3} = \\frac{1}{T^3 \\xi^2}\n$$\n求解 $L^3$：\n$$\nL^3 = \\frac{T^3 \\xi^2}{T^2\\xi^4} = \\frac{T}{\\xi^2}\n$$\n取立方根得到最优块持续时间 $L^{\\ast}$：\n$$\nL^{\\ast} = \\left(\\frac{T}{\\xi^2}\\right)^{1/3} = T^{1/3} \\xi^{-2/3}\n$$\n这是以总观测时间 $T$ 和压力控制器摩擦速率 $\\xi$ 表示的最优块持续时间的闭式解析表达式。",
            "answer": "$$ \\boxed{ \\left( \\frac{T}{\\xi^2} \\right)^{1/3} } $$"
        }
    ]
}