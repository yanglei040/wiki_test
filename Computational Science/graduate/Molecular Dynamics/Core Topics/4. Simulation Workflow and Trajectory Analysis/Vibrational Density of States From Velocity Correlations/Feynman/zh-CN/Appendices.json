{
    "hands_on_practices": [
        {
            "introduction": "在理想的简谐近似中，振动模式对应于频谱中无限尖锐的狄拉克$\\delta$函数峰。然而，在真实系统中，原子与环境（如热浴）的相互作用会导致能量耗散和谱线展宽。本练习将通过分析一个受朗之万动力学支配的阻尼谐振子，从物理原理上探讨这种展宽效应，并推导出洛伦兹线型，帮助你理解谱峰宽度的物理起源。",
            "id": "3460868",
            "problem": "一个质量为 $m$ 的经典粒子在一维谐振子势中运动，其自然角频率为 $\\omega_{0}$。该粒子通过朗之万动力学与温度为 $T$ 的热浴耦合。其运动遵循\n$$\nm\\,\\ddot{x}(t)+m\\,\\gamma\\,\\dot{x}(t)+m\\,\\omega_{0}^{2}\\,x(t)=\\xi(t),\n$$\n其中 $\\gamma$ 是摩擦系数，$\\xi(t)$ 是一个零均值高斯白噪声，其自相关由涨落-耗散关系 $\\langle \\xi(t)\\,\\xi(t')\\rangle=2\\,m\\,\\gamma\\,k_{B}\\,T\\,\\delta(t-t')$ 确定。定义速度 $v(t)=\\dot{x}(t)$ 和速度自相关函数 $C_{v}(t)=\\langle v(t)\\,v(0)\\rangle$。双边速度谱密度 $S_{v}(\\omega)$ 定义为 $C_{v}(t)$ 的傅里叶变换，\n$$\nS_{v}(\\omega)=\\int_{-\\infty}^{\\infty}\\exp(i\\,\\omega\\,t)\\,C_{v}(t)\\,dt.\n$$\n从运动方程出发，并仅使用傅里叶变换、线性响应以及上述指定的涨落-耗散关系的标准性质，推导 $S_{v}(\\omega)$ 关于 $\\omega$、$\\omega_{0}$、$\\gamma$、 $m$、$k_{B}$ 和 $T$ 的闭式解析表达式。然后，在欠阻尼情况 $\\gamma \\ll 2\\omega_{0}$ 下，确定 $S_{v}(\\omega)$ 在 $\\omega\\approx\\omega_{0}$ 附近共振峰的半高全宽。宽度以弧度每秒为单位表示。最终答案仅报告半高全宽。无需四舍五入；请提供精确的符号表达式。",
            "solution": "该问题要求推导一个在谐振子势中受朗之万动力学影响的粒子的双边速度谱密度 $S_{v}(\\omega)$，然后在欠阻尼情况下计算 $S_{v}(\\omega)$ 共振峰的半高全宽 (FWHM)。\n\n运动方程如下：\n$$\nm\\,\\ddot{x}(t)+m\\,\\gamma\\,\\dot{x}(t)+m\\,\\omega_{0}^{2}\\,x(t)=\\xi(t)\n$$\n两边同除以质量 $m$ 得到：\n$$\n\\ddot{x}(t)+\\gamma\\,\\dot{x}(t)+\\omega_{0}^{2}\\,x(t)=f(t)\n$$\n其中 $f(t) = \\xi(t)/m$ 是单位质量的随机力。\n\n我们对运动方程进行傅里叶变换。傅里叶变换定义为 $g(\\omega) = \\int_{-\\infty}^{\\infty} \\exp(i\\,\\omega\\,t)\\,g(t)\\,dt$。导数的变换为 $\\mathcal{F}\\{\\dot{g}(t)\\} = -i\\,\\omega\\,g(\\omega)$ 和 $\\mathcal{F}\\{\\ddot{g}(t)\\} = (-i\\,\\omega)^{2}\\,g(\\omega) = -\\omega^{2}\\,g(\\omega)$。将此应用于运动方程得到：\n$$\n-\\omega^{2}\\,x(\\omega) - i\\,\\omega\\,\\gamma\\,x(\\omega) + \\omega_{0}^{2}\\,x(\\omega) = f(\\omega)\n$$\n解出 $x(\\omega)$：\n$$\nx(\\omega) \\left(\\omega_{0}^{2} - \\omega^{2} - i\\,\\omega\\,\\gamma\\right) = f(\\omega)\n$$\n$$\nx(\\omega) = \\frac{1}{\\omega_{0}^{2} - \\omega^{2} - i\\,\\omega\\,\\gamma} f(\\omega)\n$$\n速度为 $v(t) = \\dot{x}(t)$，所以其傅里叶变换为 $v(\\omega) = -i\\,\\omega\\,x(\\omega)$。代入 $x(\\omega)$ 的表达式：\n$$\nv(\\omega) = \\frac{-i\\,\\omega}{\\omega_{0}^{2} - \\omega^{2} - i\\,\\omega\\,\\gamma} f(\\omega)\n$$\n这个关系式的形式为 $v(\\omega) = \\chi_{v}(\\omega)\\,f(\\omega)$，其中 $\\chi_{v}(\\omega)$ 是速度响应函数：\n$$\n\\chi_{v}(\\omega) = \\frac{-i\\,\\omega}{\\omega_{0}^{2} - \\omega^{2} - i\\,\\omega\\,\\gamma}\n$$\n速度谱密度 $S_{v}(\\omega)$ 通过公式 $S_{v}(\\omega) = |\\chi_{v}(\\omega)|^{2}\\,S_{f}(\\omega)$ 与力的谱密度 $S_{f}(\\omega)$ 相关。我们首先需要求出 $S_{f}(\\omega)$。\n\n随机力 $f(t)$ 的自相关函数是 $C_{f}(t) = \\langle f(t)\\,f(0)\\rangle$。\n$$\nC_{f}(t) = \\left\\langle \\frac{\\xi(t)}{m}\\,\\frac{\\xi(0)}{m} \\right\\rangle = \\frac{1}{m^{2}} \\langle \\xi(t)\\,\\xi(0)\\rangle\n$$\n使用给定的涨落-耗散关系 $\\langle \\xi(t)\\,\\xi(t')\\rangle=2\\,m\\,\\gamma\\,k_{B}\\,T\\,\\delta(t-t')$：\n$$\nC_{f}(t) = \\frac{1}{m^{2}} \\left(2\\,m\\,\\gamma\\,k_{B}\\,T\\,\\delta(t)\\right) = \\frac{2\\,\\gamma\\,k_{B}\\,T}{m}\\,\\delta(t)\n$$\n谱密度 $S_{f}(\\omega)$ 是 $C_{f}(t)$ 的傅里叶变换：\n$$\nS_{f}(\\omega) = \\int_{-\\infty}^{\\infty} \\exp(i\\,\\omega\\,t)\\,C_{f}(t)\\,dt = \\frac{2\\,\\gamma\\,k_{B}\\,T}{m} \\int_{-\\infty}^{\\infty} \\exp(i\\,\\omega\\,t)\\,\\delta(t)\\,dt = \\frac{2\\,\\gamma\\,k_{B}\\,T}{m}\n$$\n接下来，我们计算 $|\\chi_{v}(\\omega)|^{2}$：\n$$\n|\\chi_{v}(\\omega)|^{2} = \\left|\\frac{-i\\,\\omega}{\\left(\\omega_{0}^{2} - \\omega^{2}\\right) - i\\,\\omega\\,\\gamma}\\right|^{2} = \\frac{|-i\\,\\omega|^{2}}{|\\left(\\omega_{0}^{2} - \\omega^{2}\\right) - i\\,\\omega\\,\\gamma|^{2}} = \\frac{\\omega^{2}}{\\left(\\omega_{0}^{2} - \\omega^{2}\\right)^{2} + (\\omega\\,\\gamma)^{2}}\n$$\n结合这些结果，速度谱密度 $S_{v}(\\omega)$ 为：\n$$\nS_{v}(\\omega) = |\\chi_{v}(\\omega)|^{2}\\,S_{f}(\\omega) = \\frac{\\omega^{2}}{\\left(\\omega_{0}^{2} - \\omega^{2}\\right)^{2} + \\omega^{2}\\gamma^{2}} \\cdot \\frac{2\\,\\gamma\\,k_{B}\\,T}{m}\n$$\n这就是 $S_{v}(\\omega)$ 的闭式表达式。\n\n现在，我们确定共振峰的半高全宽。峰值的位置可以通过最大化 $\\omega > 0$ 时的 $S_{v}(\\omega)$ 来找到。我们只需要最大化与频率相关的部分 $g(\\omega) = \\frac{\\omega^{2}}{\\left(\\omega_{0}^{2} - \\omega^{2}\\right)^{2} + \\omega^{2}\\gamma^{2}}$。令 $u = \\omega^{2}$。我们通过将其导数设为零来最大化 $u > 0$ 时的 $h(u) = \\frac{u}{\\left(\\omega_{0}^{2} - u\\right)^{2} + u\\gamma^{2}}$。\n$$\n\\frac{dh}{du} = \\frac{1 \\cdot ((\\omega_{0}^{2} - u)^{2} + u\\gamma^{2}) - u \\cdot (2(\\omega_{0}^{2} - u)(-1) + \\gamma^{2})}{(\\text{denominator})^{2}} = 0\n$$\n分子必须为零：\n$$\n(\\omega_{0}^{2} - u)^{2} + u\\gamma^{2} + 2u(\\omega_{0}^{2} - u) - u\\gamma^{2} = 0\n$$\n$$\n(\\omega_{0}^{2} - u) [(\\omega_{0}^{2} - u) + 2u] = 0 \\implies (\\omega_{0}^{2} - u)(\\omega_{0}^{2} + u) = 0\n$$\n因为 $u = \\omega^{2} > 0$ 且 $\\omega_{0}^{2}>0$，所以 $(\\omega_{0}^{2}+u)$ 项总是正的。最大值出现在 $u = \\omega_{0}^{2}$ 处，对应的峰值频率为 $\\omega_{max} = \\omega_{0}$。\n\n谱密度的最大值为 $S_{v,max} = S_{v}(\\omega_{0})$：\n$$\nS_{v,max} = \\frac{2\\gamma\\,k_{B}\\,T}{m} \\frac{\\omega_{0}^{2}}{(\\omega_{0}^{2} - \\omega_{0}^{2})^{2} + \\omega_{0}^{2}\\gamma^{2}} = \\frac{2\\gamma\\,k_{B}\\,T}{m} \\frac{\\omega_{0}^{2}}{\\omega_{0}^{2}\\gamma^{2}} = \\frac{2\\,k_{B}\\,T}{m\\,\\gamma}\n$$\n半高全宽是满足 $S_{v}(\\omega) = \\frac{1}{2}S_{v,max}$ 的两个频率 $\\omega$ 之差。\n$$\n\\frac{2\\gamma\\,k_{B}\\,T}{m} \\frac{\\omega^{2}}{(\\omega_{0}^{2} - \\omega^{2})^{2} + \\omega^{2}\\gamma^{2}} = \\frac{1}{2} \\left(\\frac{2\\,k_{B}\\,T}{m\\,\\gamma}\\right)\n$$\n$$\n\\frac{\\gamma\\,\\omega^{2}}{(\\omega_{0}^{2} - \\omega^{2})^{2} + \\omega^{2}\\gamma^{2}} = \\frac{1}{2\\gamma}\n$$\n$$\n2\\gamma^{2}\\omega^{2} = (\\omega_{0}^{2} - \\omega^{2})^{2} + \\omega^{2}\\gamma^{2}\n$$\n$$\n\\gamma^{2}\\omega^{2} = (\\omega_{0}^{2} - \\omega^{2})^{2}\n$$\n两边取平方根得到 $\\pm \\gamma\\omega = \\omega_{0}^{2} - \\omega^{2}$，这给出了关于 $\\omega$ 的两个二次方程：\n1.  $\\omega^{2} + \\gamma\\omega - \\omega_{0}^{2} = 0$\n2.  $\\omega^{2} - \\gamma\\omega - \\omega_{0}^{2} = 0$\n\n使用二次公式求解 $\\omega > 0$：\n对于方程($1$)：$\\omega_{1} = \\frac{-\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}}}{2}$。\n对于方程($2$)：$\\omega_{2} = \\frac{\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}}}{2}$。\n\n半高全宽 $\\Delta\\omega$ 是 $\\omega_{2}$ 与 $\\omega_{1}$ 之差：\n$$\n\\Delta\\omega = \\omega_{2} - \\omega_{1} = \\frac{\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}}}{2} - \\frac{-\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}}}{2}\n$$\n$$\n\\Delta\\omega = \\frac{(\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}}) - (-\\gamma + \\sqrt{\\gamma^{2} + 4\\omega_{0}^{2}})}{2} = \\frac{2\\gamma}{2} = \\gamma\n$$\n共振峰的半高全宽等于摩擦系数 $\\gamma$。$\\gamma$ 的单位是时间的倒数，即弧度每秒。",
            "answer": "$$\n\\boxed{\\gamma}\n$$"
        },
        {
            "introduction": "从理论模型转向实际的分子动力学模拟后，我们面临着如何从离散且有限的轨迹数据中计算振动谱的挑战。计算出的谱的质量受到两个基本限制：总观测时间决定了频率分辨率，而采样时间步长决定了可分析的最大频率。本练习将引导你推导这些关键的采样理论约束，这对于设计有效的模拟和正确解释计算出的谱至关重要。",
            "id": "3460896",
            "problem": "考虑一个包含$N$个原子的系统的平衡分子动力学（MD）模拟，其中粒子速度$\\mathbf{v}_{i}(t)$在总观测时长$T$内以固定的采样间隔$\\Delta t$进行均匀时间记录。设总采样数为$M$，其中$M$是满足$M \\Delta t = T$的唯一正整数。定义速度自相关函数（VACF）为 $C_{v}(t) = \\frac{1}{N} \\sum_{i=1}^{N} \\langle \\mathbf{v}_{i}(0) \\cdot \\mathbf{v}_{i}(t) \\rangle$，并设振动态密度（VDOS）与VACF相关的谱密度$S_{v}(\\omega)$成正比。这一关联基于一个基本事实：时间相关性与谱通过傅里叶变换相关联，此关系由Wiener–Khinchin定理形式化。假设系统是平稳的、遍历的，且VACF是时间的偶函数。\n\n给定唯一的均匀采样速度时间序列 $\\{\\mathbf{v}_{i}(t_{n})\\}_{n=0}^{M-1}$，其中 $t_{n} = n \\Delta t$，你必须使用VACF估计量的离散傅里叶变换（DFT）来构建$S_{v}(\\omega)$的有限样本离散近似。请从第一性原理出发：\n\n1. 基于均匀采样的速度和$C_{v}(t)$的对称性，推导连续VACF $C_{v}(t)$的离散、有限时长估计量$C[n]$。然后，在可用时间窗口上使用黎曼和近似傅里叶变换，推导$S_{v}(\\omega_{k})$在离散角频率网格$\\{\\omega_{k}\\}_{k}$上的闭式DFT表达式，该网格与DFT所隐含的长度为$T$的周期性延拓一致。你的表达式必须是显式实数值，并且必须用$C[n]$、$\\Delta t$、$M$和$\\omega_{k}$表示。\n\n2. 使用均匀采样连续时间信号的采样理论，推导混叠约束，并量化由有限观测时间和均匀采样所决定的角频率域分辨率极限。将频率分辨率$\\Delta \\omega$和最大无混叠角频率$\\omega_{\\max}$表示为关于$T$和$\\Delta t$的闭式表达式。\n\n3. 对于一个特定的MD轨迹，采样间隔$\\Delta t = 0.5 \\,\\text{fs}$，总时长$T = 20 \\,\\text{ps}$，计算$\\Delta \\omega$和$\\omega_{\\max}$的数值，并将两者四舍五入到四位有效数字。用弧度/秒表示这些数值答案。\n\n你的最终答案必须包含三个部分并一起呈现：第1部分推导出的$S_{v}(\\omega_{k})$的DFT表达式、第3部分的$\\Delta \\omega$值以及第3部分的$\\omega_{\\max}$值。仅对数值进行四舍五入，不要在最终答案框内包含物理单位，但请确保按照指示在数值计算中使用了弧度/秒。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的、客观的且内部一致的。它描述了计算统计力学中一个标准且基本的过程，即如何从分子动力学轨迹计算振动态密度。所提供的数据和参数在物理上是现实的。因此，将提供一个合理的解答。\n\n解答分为三个部分，对应问题中列出的三个任务。\n\n### 第1部分：离散谱密度估计量$S_{v}(\\omega_{k})$的推导\n\n振动态密度（VDOS）与速度自相关函数（VACF）$C_{v}(t)$的谱密度$S_{v}(\\omega)$成正比。根据Wiener–Khinchin定理，谱密度是自相关函数的傅里叶变换：\n$$S_{v}(\\omega) = \\int_{-\\infty}^{\\infty} C_{v}(t) \\exp(-i\\omega t) dt$$\n问题陈述指出，VACF $C_{v}(t)$是时间的偶函数，即$C_{v}(-t) = C_{v}(t)$。此性质可以简化傅里叶变换。我们可以将积分拆分并使用变量替换（$t' = -t$）：\n$$S_{v}(\\omega) = \\int_{0}^{\\infty} C_{v}(t) \\exp(-i\\omega t) dt + \\int_{-\\infty}^{0} C_{v}(t) \\exp(-i\\omega t) dt$$\n$$S_{v}(\\omega) = \\int_{0}^{\\infty} C_{v}(t) \\exp(-i\\omega t) dt + \\int_{0}^{\\infty} C_{v}(-t') \\exp(i\\omega t') dt'$$\n由于$C_{v}(-t') = C_{v}(t')$，表达式变为：\n$$S_{v}(\\omega) = \\int_{0}^{\\infty} C_{v}(t) (\\exp(-i\\omega t) + \\exp(i\\omega t)) dt$$\n使用欧拉公式 $\\exp(ix) + \\exp(-ix) = 2\\cos(x)$，我们得到实值的傅里叶余弦变换：\n$$S_{v}(\\omega) = 2 \\int_{0}^{\\infty} C_{v}(t) \\cos(\\omega t) dt$$\n为了从离散、有限时长的MD轨迹计算这个值，我们必须引入两个近似：\n1.  基于采样速度的VACF的离散估计量$C[n]$。\n2.  在有限观测窗口上对积分进行数值近似。\n\n首先，我们推导$C_{v}(t_n)$的估计量$C[n]$，其中$t_n = n\\Delta t$。问题定义了$C_{v}(t) = \\frac{1}{N} \\sum_{i=1}^{N} \\langle \\mathbf{v}_{i}(0) \\cdot \\mathbf{v}_{i}(t) \\rangle$。对于遍历系统，系综平均$\\langle \\cdot \\rangle$可以被模拟轨迹上的时间平均所替代。给定$M$个速度样本$\\{\\mathbf{v}_{i}(t_{m})\\}_{m=0}^{M-1}$，在延迟时间$t_n = n\\Delta t$下VACF的时间平均估计量为：\n$$C[n] = \\frac{1}{N(M-n)} \\sum_{m=0}^{M-n-1} \\sum_{i=1}^{N} \\mathbf{v}_{i}(t_m) \\cdot \\mathbf{v}_{i}(t_{m+n})$$\n该估计量定义于离散延迟$n = 0, 1, \\dots, M-1$。\n\n接下来，我们近似$S_v(\\omega)$的积分。我们只有总时长为$T = M\\Delta t$的数据，因此积分被截断到区间$[0, T]$。我们使用具有$M$个宽度为$\\Delta t$的区间的左手黎曼和来近似该积分：\n$$S_{v}(\\omega) \\approx 2 \\int_{0}^{T} C_{v}(t) \\cos(\\omega t) dt \\approx 2 \\sum_{n=0}^{M-1} C_{v}(n\\Delta t) \\cos(\\omega n\\Delta t) \\Delta t$$\n用离散估计量$C[n]$替代$C_v(n\\Delta t)$，我们得到：\n$$S_{v}(\\omega) \\approx 2 \\Delta t \\sum_{n=0}^{M-1} C[n] \\cos(\\omega n\\Delta t)$$\n问题要求在与长度为$T$的周期性延拓一致的离散频率网格$\\{\\omega_k\\}$上进行评估，这对应于$M$点离散傅里叶变换（DFT）的频率。这些角频率由以下公式给出：\n$$\\omega_{k} = \\frac{2\\pi k}{T} = \\frac{2\\pi k}{M\\Delta t}, \\quad \\text{for } k = 0, 1, \\dots, M-1$$\n将此代入我们对$S_{v}(\\omega)$的近似中，得到离散谱密度估计量$S_{v}(\\omega_{k})$的最终表达式：\n$$S_{v}(\\omega_{k}) = 2 \\Delta t \\sum_{n=0}^{M-1} C[n] \\cos\\left(n\\Delta t \\cdot \\frac{2\\pi k}{M\\Delta t}\\right)$$\n$$S_{v}(\\omega_{k}) = 2 \\Delta t \\sum_{n=0}^{M-1} C[n] \\cos\\left(\\frac{2\\pi nk}{M}\\right)$$\n该表达式是显式实数值，并用所需变量表示。它对应于单边VACF估计量$C[n]$的$M$点DFT实部的$2\\Delta t$倍。\n\n### 第2部分：混叠约束与频率分辨率\n\n连续时间信号与其均匀采样的离散版本之间的关系由Nyquist-Shannon采样定理决定。\n采样间隔给定为$\\Delta t$。因此，采样频率为$f_s = 1/\\Delta t$。\n\n**混叠约束（$\\omega_{\\max}$）：** 该定理指出，要从样本中完美重构连续时间信号，采样频率$f_s$必须至少是信号中存在的最大频率分量的两倍。反之，如果一个信号以频率$f_s$采样，能够唯一表示而无混叠的最高频率是Nyquist频率，$f_{\\text{Nyquist}} = f_s / 2$。原始信号中高于$f_{\\text{Nyquist}}$的任何频率都将被折叠回范围$[0, f_{\\text{Nyquist}}]$内，这种效应称为混叠。\n因此，最大无混叠角频率$\\omega_{\\max}$为：\n$$\\omega_{\\max} = 2\\pi f_{\\text{Nyquist}} = 2\\pi \\left(\\frac{f_s}{2}\\right) = \\pi f_s = \\frac{\\pi}{\\Delta t}$$\n\n**频率分辨率（$\\Delta \\omega$）：** 在频谱中分辨不同频率的能力受总观测时间$T$的限制。截断为时长$T$的信号的傅里叶变换产生的频谱中，独立频率分量之间的最小间隔为$\\Delta f = 1/T$。在对时长为$T=M\\Delta t$的$M$个样本进行DFT的背景下，此间隔对应于相邻频率点$\\omega_k$之间的间距。\n角频率分辨率$\\Delta \\omega$为：\n$$\\Delta \\omega = 2\\pi \\Delta f = \\frac{2\\pi}{T}$$\n\n### 第3部分：数值计算\n\n对于一个特定的MD轨迹，我们给定以下参数：\n- 采样间隔：$\\Delta t = 0.5 \\,\\text{fs} = 0.5 \\times 10^{-15} \\,\\text{s}$\n- 总时长：$T = 20 \\,\\text{ps} = 20 \\times 10^{-12} \\,\\text{s}$\n\n使用第2部分推导的表达式，我们可以计算$\\Delta \\omega$和$\\omega_{\\max}$的数值。\n\n**角频率分辨率（$\\Delta \\omega$）：**\n$$\\Delta \\omega = \\frac{2\\pi}{T} = \\frac{2\\pi}{20 \\times 10^{-12} \\,\\text{s}} = \\frac{\\pi}{10 \\times 10^{-12}} \\,\\text{rad/s} = \\pi \\times 10^{11} \\,\\text{rad/s}$$\n数值上，这等于$\\Delta \\omega \\approx 3.14159265 \\times 10^{11} \\,\\text{rad/s}$。四舍五入到四位有效数字，得到：\n$$\\Delta \\omega \\approx 3.142 \\times 10^{11} \\,\\text{rad/s}$$\n\n**最大无混叠角频率（$\\omega_{\\max}$）：**\n$$\\omega_{\\max} = \\frac{\\pi}{\\Delta t} = \\frac{\\pi}{0.5 \\times 10^{-15} \\,\\text{s}} = 2\\pi \\times 10^{15} \\,\\text{rad/s}$$\n数值上，这等于$\\omega_{\\max} \\approx 6.2831853 \\times 10^{15} \\,\\text{rad/s}$。四舍五入到四位有效数字，得到：\n$$\\omega_{\\max} \\approx 6.283 \\times 10^{15} \\,\\text{rad/s}$$\n这些值以要求的单位弧度/秒表示。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nS_{v}(\\omega_{k}) = 2 \\Delta t \\sum_{n=0}^{M-1} C[n] \\cos\\left(\\frac{2\\pi nk}{M}\\right) \\quad 3.142 \\times 10^{11} \\quad 6.283 \\times 10^{15}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在谱分析的实际操作中，一个常用且有时被误解的技巧是“零填充”（zero-padding）。虽然它不能突破由观测时长决定的物理分辨率极限，但它能显著改善谱图的可视化效果。本计算练习旨在通过一个具体的编程任务，让你亲手验证零填充的作用：它通过在频域上进行更密集的采样来平滑谱线，从而帮助我们更精确地确定峰位和峰宽，但并不能分辨出原本因分辨率不足而无法区分的模式。",
            "id": "3460862",
            "problem": "您的任务是通过推导和计算来论证速度自相关函数与振动态密度之间的关系，并解释在应用快速傅里叶变换（FFT）之前进行补零操作的影响。您需要从适合分子动力学的基础概念出发，使用以下定义和事实：速度自相关函数定义为 $C_v(t) = \\langle \\mathbf{v}(0) \\cdot \\mathbf{v}(t) \\rangle$，振动态密度 $g(\\omega)$ 与 $C_v(t)$ 的余弦变换成正比，以及在时长为 $T$ 的有限窗口内进行离散时间采样等效于在时间上乘以一个矩形窗函数，该窗函数的傅里叶变换主瓣宽度约为 $1/T$。您必须基于这些基础进行推理，而不能直接使用简化的公式。\n\n您的程序必须生成合成的速度自相关信号 $C_v(t)$，其形式为无阻尼余弦模式的叠加，并在有限窗口内进行离散采样，然后使用快速傅里叶变换计算其频谱以近似余弦变换。程序必须比较不进行补零和进行补零时所获得的频谱，并量化其对峰形的影响。具体来说，您必须证明，补零并不会增加物理信息，也无法解析超出有限时间分辨率的模式，但它能够细化频率采样并改善可视化效果。\n\n实现以下任务：\n-   构建离散时间数组 $t_n = n\\,\\Delta t$（其中 $n = 0,1,\\dots,N-1$）以及相应的自相关信号 $C_v(t_n) = \\sum_{j} \\cos(2\\pi f_j t_n)$，使用指定的模式频率 $f_j$。\n-   通过对 $C_v(t_n)$ 应用快速傅里叶变换来计算频谱，并采用两种设置：长度为 $N$ 不进行填充，以及通过附加零点填充到长度 $M = p N$（其中 $p$ 为正整数）。提取非负频率轴和相应的谱振幅，使用由 $\\Delta t$ 缩放的单边 FFT 的实部作为余弦变换的近似。\n-   对于每个频谱，识别主峰频率，并计算主峰的半峰全宽（FWHM）。计算方法为：在最大值的两侧定位谱振幅穿过峰值一半的频率点，并在相邻采样点之间进行线性插值来精确估计交叉点。\n-   对于双模情况，使用峰值查找程序确定频谱中检测到的峰数。该程序的参数为：最小间隔为 $1/T$（以频率采样点距离表示），最小突起度为最大振幅的 $0.3$ 倍，以避免将旁瓣计入。\n\n使用以下测试套件，该套件包含三个参数集，旨在覆盖一般情况、短窗口边界情况和分辨率极限情况。在所有情况下，频率必须以太赫兹（THz）为单位报告，宽度也以太赫兹为单位，您必须确保您的程序计算并输出以太赫兹为单位的浮点数。时间步长对所有测试都是通用的，并已明确给出。所有物理量必须以指定单位表示。\n\n-   测试用例 1（一般情况，单模，较长窗口）：\n    -   时间步长 $\\Delta t = 1\\times 10^{-14}\\ \\mathrm{s}$。\n    -   采样点数 $N = 4096$，总窗口时长 $T = N\\,\\Delta t$。\n    -   单模频率 $f_1 = 5\\ \\mathrm{THz}$，即 $f_1 = 5\\times 10^{12}\\ \\mathrm{Hz}$。\n    -   补零因子 $p = 16$，即填充后长度 $M = 16\\,N$。\n    -   输出以下浮点数列表：$[\\text{peak}_{\\text{unpadded}}, \\text{peak}_{\\text{padded}}, \\text{FWHM}_{\\text{unpadded}}, \\text{FWHM}_{\\text{padded}}, 0.886/T,\\ 1/T]$，所有值均以 $\\mathrm{THz}$ 为单位。其中 $0.886/T$ 是矩形窗函数主瓣在频率上的理论半峰全宽，而 $1/T$ 是主瓣零点到零点的宽度参数，两者均以 $\\mathrm{THz}$ 为单位表示。\n\n-   测试用例 2（边界情况，单模，较短窗口）：\n    -   时间步长 $\\Delta t = 1\\times 10^{-14}\\ \\mathrm{s}$。\n    -   采样点数 $N = 256$，总窗口时长 $T = N\\,\\Delta t$。\n    -   单模频率 $f_1 = 5\\ \\mathrm{THz}$，即 $f_1 = 5\\times 10^{12}\\ \\mathrm{Hz}$。\n    -   补零因子 $p = 16$，即填充后长度 $M = 16\\,N$。\n    -   输出以下浮点数列表：$[\\text{peak}_{\\text{unpadded}}, \\text{peak}_{\\text{padded}}, \\text{FWHM}_{\\text{unpadded}}, \\text{FWHM}_{\\text{padded}}, 0.886/T,\\ 1/T]$，所有值均以 $\\mathrm{THz}$ 为单位。\n\n-   测试用例 3（两个模式，其间距小于分辨率极限）：\n    -   时间步长 $\\Delta t = 1\\times 10^{-14}\\ \\mathrm{s}$。\n    -   采样点数 $N = 4096$，总窗口时长 $T = N\\,\\Delta t$。\n    -   两个模式频率 $f_1 = 5\\ \\mathrm{THz}$ 和 $f_2 = 5\\ \\mathrm{THz} + 0.5/T$，其中 $0.5/T$ 以 $\\mathrm{THz}$ 表示，因此 $f_2 = 5\\times 10^{12}\\ \\mathrm{Hz} + 0.5/T \\times 10^{12}\\ \\mathrm{Hz}$。\n    -   补零因子 $p = 16$，即填充后长度 $M = 16\\,N$。\n    -   输出以下整数列表：$[\\text{numpeaks}_{\\text{unpadded}}, \\text{numpeaks}_{\\text{padded}}]$，其中峰数的计数条件为最小间隔为 $1/T$（以频率采样点表示），最小突起度为最大振幅的 $0.3$ 倍。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，该列表由测试用例 1、2 和 3 的结果列表按顺序组成，例如 $[[a_1,b_1,c_1,d_1,e_1,f_1],[a_2,b_2,c_2,d_2,e_2,f_2],[g_3,h_3]]$，其中对于测试 1 和 2，$a_i,b_i,\\dots$ 是以 $\\mathrm{THz}$ 为单位的浮点数，对于测试 3，$g_3,h_3$ 是整数。",
            "solution": "该问题要求展示粒子速度自相关函数 $C_v(t)$ 与振动态密度 (VDOS) $g(\\omega)$ 之间的关系，并特别关注数字信号处理的实际影响，即有限时间加窗和补零。我们将首先推导理论基础，然后构建计算解决方案。\n\n### 基于原理的推导\n\n**1. 从相关到频谱：维纳-辛钦定理**\n\n在统计力学中，振动态密度 $g(\\omega)$ 用于量化在给定频率 $\\omega$ 下可用的振动模式数量。它从根本上与原子速度的功率谱密度相关。维纳-辛钦定理提供了关键的联系：该定理指出，一个广义平稳随机过程的功率谱密度是其自相关函数的傅里叶变换。\n\n对于处于热平衡状态的系统，原子的速度矢量可以被视为这样的过程。速度自相关函数 (VACF) 定义为某个原子的速度与其在稍后时间 $t$ 的速度的点积的系综平均值：\n$$\nC_v(t) = \\langle \\mathbf{v}(0) \\cdot \\mathbf{v}(t) \\rangle\n$$\n根据该定理，VDOS $g(\\omega)$ 与 $C_v(t)$ 的傅里叶变换成正比：\n$$\ng(\\omega) \\propto \\int_{-\\infty}^{\\infty} C_v(t) e^{-i\\omega t} dt\n$$\n其中 $\\omega = 2\\pi f$ 是角频率。由于底层微观动力学的时间反演对称性（在没有磁场的情况下），$C_v(t)$ 是一个实偶函数，即 $C_v(t) = C_v(-t)$。此性质将其傅里叶变换简化为纯余弦变换：\n$$\n\\int_{-\\infty}^{\\infty} C_v(t) e^{-i\\omega t} dt = \\int_{-\\infty}^{\\infty} C_v(t) (\\cos(\\omega t) - i\\sin(\\omega t)) dt = \\int_{-\\infty}^{\\infty} C_v(t) \\cos(\\omega t) dt = 2 \\int_{0}^{\\infty} C_v(t) \\cos(\\omega t) dt\n$$\n这证实了问题的前提，即 $g(\\omega)$ 与 $C_v(t)$ 的余弦变换成正比。我们旨在计算的正是这个积分。\n\n**2. 有限时间加窗的必然影响**\n\n在任何实际测量或模拟中，我们只能在有限的时间段内观察信号，例如从 $t=0$ 到 $t=T$。这在数学上等效于将“真实”的无限时长信号 $C_v(t)$ 乘以一个矩形窗函数 $w_R(t)$：\n$$\nw_R(t) = \n\\begin{cases} \n1 & 0 \\le t \\le T \\\\ \n0 & \\text{otherwise} \n\\end{cases}\n$$\n我们实际分析的信号是 $C_v^{\\text{win}}(t) = C_v(t) \\cdot w_R(t)$。卷积定理指出，函数乘积的傅里叶变换是它们各自傅里叶变换的卷积：\n$$\n\\mathcal{F}\\{C_v^{\\text{win}}(t)\\} = \\mathcal{F}\\{C_v(t)\\} * \\mathcal{F}\\{w_R(t)\\}\n$$\n对于纯谐振系统，$C_v(t)$ 将是余弦函数的和，例如 $C_v(t) = A \\cos(\\omega_j t)$，其傅里叶变换将是在频率 $\\pm \\omega_j$ 处的一对无限尖锐的狄拉克δ函数。然而，矩形窗的傅里叶变换不是δ函数，而是一个复数的 sinc 函数。因此，卷积运算将每个理想的δ函数峰替换为窗函数变换的展宽形状。这种现象被称为**频谱泄漏**，它内在地展宽了谱峰。窗函数变换的主瓣宽度与窗口时长 $T$ 成反比。具体来说，sinc 函数包络的第一个零点出现在相对于中心频率的 $\\pm 1/T$ 处，这定义了一个特征分辨率极限。间距小于约 $1/T$ 的两条谱线无法被分辨。\n\n问题给出了矩形窗信号*功率谱*的理论半峰全宽 (FWHM) 约为 $\\approx 0.886/T$。功率谱是傅里叶变换的幅值平方 $|\\mathcal{F}\\{C_v^{\\text{win}}(t)\\}|^2$，其形状与 $\\text{sinc}^2(\\pi f T)$ 成正比。我们被要求使用快速傅里叶变换 (FFT) 的实部来计算频谱，这近似于余弦变换。这导致峰形与 $\\text{sinc}^2$ 不完全相同，因此我们应预期我们数值计算的 FWHM 会与此理论值有所不同，这是本练习隐含强调的一个微妙之处。\n\n**3. 离散化与补零的作用**\n\n在计算环境中，我们使用在时间步长 $t_n = n\\Delta t$（$n = 0, 1, \\ldots, N-1$）上采样的离散信号 $C_v(t_n)$。我们通过 FFT 算法实现的离散傅里叶变换 (DFT) 来近似连续傅里叶变换。$N$ 点信号的 DFT 给了我们 $N$ 个频率分量。\n\n补零是在执行 FFT 之前，在时域信号后附加零，将其长度从 $N$ 增加到 $M = pN$（其中 $p$ 是填充因子）的过程。这会得到一个 $M$ 点的 FFT。其关键影响如下：\n-   **频率采样**：一个 $M$ 点信号的 DFT 会产生一个在 $M$ 个离散频率点上采样的频谱。DFT 输出的频率分辨率（相邻频率点之间的间距）变为 $\\Delta f = 1/(M\\Delta t) = 1/(pT)$。通过增加 $M$，我们获得了频率轴上更密集的采样。\n-   **物理分辨率**：由观测窗口 $T$ 决定的基本物理分辨率保持不变。展宽谱峰的形状，即真实频谱与持续时间为 $T$ 的窗口变换的卷积，是固定的。补零不会改变这个底层的连续形状。它只是沿着该形状提供了更多的采样点，从而得到更平滑、更易于观察的曲线。它无法解析那些间距小于 $\\sim 1/T$ 极限的特征。\n\n总而言之，本练习旨在证明：\n1.  有限的观测时间 $T$ 限制了频谱分辨率，导致峰具有与 $1/T$ 成比例的最小宽度。\n2.  补零增加了计算出的频谱中的频率点数量，改善了可视化和峰参数估计（例如峰频率和 FWHM）的精度，但它不增加物理信息，也不提高基本分辨率极限。这一点将通过测试用例 3 来展示，其中两个相隔 $0.5/T$ 的模式即使在大量补零后仍然无法被分辨。\n\n### 计算实现\n\n在 Python 代码中实现了以下步骤：\n1.  **信号生成**：对于每个测试用例，根据给定的参数（$N, \\Delta t, f_j$）构建离散时间数组 $t_n$ 和相应的 VACF 信号 $C_v(t_n)$。\n2.  **频谱计算**：一个函数用于计算单边频谱。它接收信号 $C_v(t_n)$，将其补零至长度 $M=pN$，使用 `numpy.fft.rfft`（对实值输入效率高）计算 FFT，并取其实部。结果乘以 $\\Delta t$ 以近似余弦变换积分。同时生成相应的频率轴。\n3.  **FWHM 分析**：实现了一个函数来寻找主峰的 FWHM。它定位峰值最大值，计算半峰值，然后在峰的两侧搜索频谱穿过该值的点。使用相邻离散点之间的线性插值来精确估计这些交叉点的频率。FWHM 是这两个频率之差。\n4.  **峰值计数**：对于双模测试用例，实现了一个自定义的峰值查找程序。它首先识别频谱中所有的局部最大值。然后根据与全局最大值的相对最小突起度进行筛选。最后，根据最小间隔距离（以数组索引表示，对应于 $1/T$ 的频率间隔）对剩余的峰进行筛选，确保旁瓣不会被误识别为独立的物理模式。\n5.  **测试执行**：程序遍历三个指定的测试用例，对未填充和填充的信号执行所需的计算，并按照要求的精确格式组装结果。所有频率和宽度量都被转换并以 THz 为单位报告。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing synthetic velocity autocorrelation functions.\n    The function iterates through three test cases, calculates spectra with and without\n    zero-padding, and quantifies the effects on peak frequency, width, and resolution.\n    \"\"\"\n\n    def compute_spectrum(signal, dt, pad_factor):\n        \"\"\"\n        Computes the one-sided spectrum of a signal using the real part of the FFT.\n\n        Args:\n            signal (np.ndarray): The input time-domain signal.\n            dt (float): The time step of the signal.\n            pad_factor (int): The factor by which to zero-pad the signal.\n\n        Returns:\n            tuple: A tuple containing:\n                - freqs (np.ndarray): The frequency axis (in THz).\n                - spectrum (np.ndarray): The computed spectral amplitudes.\n        \"\"\"\n        n_samples = len(signal)\n        m_padded = n_samples * pad_factor\n        \n        # Use rfft for real-valued input\n        fft_result = np.fft.rfft(signal, n=m_padded)\n        \n        # Spectrum is the real part of the FFT, scaled by dt\n        spectrum = np.real(fft_result) * dt\n        \n        # Frequency axis for rfft\n        freqs_hz = np.fft.rfftfreq(m_padded, d=dt)\n        freqs_thz = freqs_hz / 1e12  # Convert Hz to THz\n        \n        return freqs_thz, spectrum\n\n    def find_fwhm(freqs, spectrum):\n        \"\"\"\n        Calculates the full width at half maximum (FWHM) of the dominant peak.\n\n        Args:\n            freqs (np.ndarray): The frequency axis.\n            spectrum (np.ndarray): The spectral amplitudes.\n\n        Returns:\n            float: The FWHM of the dominant peak, or 0.0 if not found.\n        \"\"\"\n        if len(spectrum)  3:\n            return 0.0\n\n        peak_idx = np.argmax(spectrum)\n        peak_val = spectrum[peak_idx]\n        half_max = peak_val / 2.0\n\n        # Find left crossing (interpolated)\n        freq_left = np.interp(half_max, spectrum[:peak_idx+1], freqs[:peak_idx+1])\n        \n        # Find right crossing (interpolated)\n        # Note: np.interp needs ascending x-values, so we give it the ascending part of y\n        # and it will find the corresponding x.\n        freq_right = np.interp(half_max, spectrum[peak_idx:][::-1], freqs[peak_idx:][::-1])\n\n        # Check if crossings were found (e.g., if peak is at the edge)\n        if freq_left == freqs[0] or freq_right == freqs[-1]:\n            # Fallback to a simpler, non-interpolated search if interpolation fails at edges\n            try:\n                left_idx = np.where(spectrum[:peak_idx]  half_max)[0][-1]\n                right_idx = np.where(spectrum[peak_idx:]  half_max)[0][0] + peak_idx\n                # This fallback is less precise but robust\n                return freqs[right_idx] - freqs[left_idx]\n            except IndexError:\n                return 0.0\n\n        return freq_right - freq_left\n\n    def count_peaks(freqs, spectrum, min_sep_freq, min_prominence_ratio):\n        \"\"\"\n        Counts peaks in a spectrum based on separation and prominence criteria.\n\n        Args:\n            freqs (np.ndarray): Frequency axis.\n            spectrum (np.ndarray): Spectral amplitudes.\n            min_sep_freq (float): Minimum separation between peaks in frequency units (THz).\n            min_prominence_ratio (float): Minimum prominence as a fraction of max amplitude.\n\n        Returns:\n            int: The number of detected peaks.\n        \"\"\"\n        if len(spectrum)  3:\n            return 0\n\n        # 1. Find all local maxima\n        local_max_indices = []\n        for i in range(1, len(spectrum) - 1):\n            if spectrum[i] > spectrum[i-1] and spectrum[i] > spectrum[i+1]:\n                local_max_indices.append(i)\n        \n        if not local_max_indices:\n            return 0\n\n        # 2. Filter by prominence\n        max_amplitude = np.max(spectrum)\n        prominence_threshold = min_prominence_ratio * max_amplitude\n        \n        prominent_peak_indices = [\n            i for i in local_max_indices if spectrum[i] > prominence_threshold\n        ]\n        \n        if not prominent_peak_indices:\n            return 0\n\n        # 3. Sort by height and filter by separation\n        sorted_peaks = sorted(prominent_peak_indices, key=lambda i: spectrum[i], reverse=True)\n        \n        final_peaks = []\n        for peak_idx in sorted_peaks:\n            is_separated = True\n            for final_peak_idx in final_peaks:\n                if abs(freqs[peak_idx] - freqs[final_peak_idx])  min_sep_freq:\n                    is_separated = False\n                    break\n            if is_separated:\n                final_peaks.append(peak_idx)\n                \n        return len(final_peaks)\n\n    # --- Test Cases ---\n    \n    dt_common = 1e-14  # s\n    pad_factor_common = 16\n    \n    test_cases = [\n        # Case 1: General case, single mode, longer window\n        {'N': 4096, 'freqs_thz': [5.0], 'type': 'fwhm'},\n        # Case 2: Edge case, single mode, short window\n        {'N': 256, 'freqs_thz': [5.0], 'type': 'fwhm'},\n        # Case 3: Two modes, resolution limit\n        {'N': 4096, 'freqs_thz': [5.0], 'type': 'peaks'} # f2 is calculated from T\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        N = case['N']\n        T = N * dt_common\n        T_thz_inv = (1 / T) / 1e12\n\n        # --- Signal Generation ---\n        t = np.arange(N) * dt_common\n        freqs_hz = [f * 1e12 for f in case['freqs_thz']]\n        if case['type'] == 'peaks':\n            # Add second frequency for case 3\n            f2_hz = freqs_hz[0] + 0.5 / T\n            freqs_hz.append(f2_hz)\n        \n        signal = np.zeros_like(t)\n        for f_hz in freqs_hz:\n            signal += np.cos(2 * np.pi * f_hz * t)\n        \n        if case['type'] == 'fwhm':\n            # --- Unpadded Analysis ---\n            freqs_unpad, spec_unpad = compute_spectrum(signal, dt_common, 1)\n            peak_freq_unpad = freqs_unpad[np.argmax(spec_unpad)]\n            fwhm_unpad = find_fwhm(freqs_unpad, spec_unpad)\n        \n            # --- Padded Analysis ---\n            freqs_pad, spec_pad = compute_spectrum(signal, dt_common, pad_factor_common)\n            peak_freq_pad = freqs_pad[np.argmax(spec_pad)]\n            fwhm_pad = find_fwhm(freqs_pad, spec_pad)\n            \n            # --- Theoretical values ---\n            fwhm_theory = 0.886 * T_thz_inv\n            t_inv_theory = T_thz_inv\n            \n            all_results.append([\n                peak_freq_unpad, peak_freq_pad, fwhm_unpad, fwhm_pad, \n                fwhm_theory, t_inv_theory\n            ])\n            \n        elif case['type'] == 'peaks':\n            min_sep_freq_thz = T_thz_inv\n            min_prom_ratio = 0.3\n\n            # --- Unpadded Analysis ---\n            freqs_unpad, spec_unpad = compute_spectrum(signal, dt_common, 1)\n            num_peaks_unpad = count_peaks(freqs_unpad, spec_unpad, min_sep_freq_thz, min_prom_ratio)\n\n            # --- Padded Analysis ---\n            freqs_pad, spec_pad = compute_spectrum(signal, dt_common, pad_factor_common)\n            num_peaks_pad = count_peaks(freqs_pad, spec_pad, min_sep_freq_thz, min_prom_ratio)\n            \n            all_results.append([num_peaks_unpad, num_peaks_pad])\n\n    # Format final output as specified\n    output_str_parts = [str(res_list).replace(\" \", \"\") for res_list in all_results]\n    print(f\"[{','.join(output_str_parts)}]\")\n\n\nsolve()\n```"
        }
    ]
}