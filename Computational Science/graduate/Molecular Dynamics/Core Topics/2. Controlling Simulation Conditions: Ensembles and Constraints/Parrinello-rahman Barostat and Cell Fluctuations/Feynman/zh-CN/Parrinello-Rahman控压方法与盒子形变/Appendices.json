{
    "hands_on_practices": [
        {
            "introduction": "Parrinello-Rahman 恒压器不仅仅是控制压力的工具，它本质上是一个与系统耦合的动力学系统。为了确保它能正确复现等温等压系综（$NPT$）的统计性质，其运动方程必须满足一个基本物理原理。本练习将引导你推导这个核心关系——涨落-耗散定理——它精确地指明了为了维持目标温度$T$，施加在盒子矩阵上的随机力（涨落）与摩擦项（耗散）之间必须满足的数学关系。这个推导对于深刻理解所有随机恒温/恒压算法的理论基础至关重要。",
            "id": "3432719",
            "problem": "考虑一个 Parrinello–Rahman (PR) 恒压器作用于模拟晶胞矩阵 $h \\in \\mathbb{R}^{3 \\times 3}$，其虚拟恒压器质量参数为 $W$，该恒压器耦合到一个在等温等压 (NPT) 系综中，温度为 $T$、外部静水压力为 $p_{\\mathrm{ext}}$ 的三维系统。重点关注围绕立方参考晶胞 $h_{0} = a_{0} I$（其中 $a_{0} > 0$，$I$ 是 $3 \\times 3$ 单位矩阵）的微小均匀形变。定义小对称拉格朗日应变张量为\n$$\n\\epsilon \\equiv \\frac{1}{2}\\!\\left(h h_{0}^{-1} + h_{0}^{-T} h^{T}\\right) - I \\;\\;\\approx\\;\\; \\mathrm{sym}\\!\\left(h h_{0}^{-1} - I\\right),\n$$\n并假设形变足够小，使得关于 $h_{0}$ 的线性化是有效的。\n\n设恒压器动能为原始 PR 公式中的形式，\n$$\nT_{\\mathrm{baro}} = \\frac{W}{2}\\,\\mathrm{Tr}\\!\\left(\\dot{h}^{T}\\dot{h}\\right),\n$$\n并假设在体积为 $V_{0} = \\det(h_{0})$ 的参考态附近，弹性自由能密度为二次型，\n$$\nU_{\\mathrm{el}}(\\epsilon) = \\frac{V_{0}}{2}\\,\\epsilon : C : \\epsilon,\n$$\n其中 $C$ 是四阶弹性模量张量，$A:B \\equiv A_{ij}B_{ij}$ 表示双点积。考虑对称应变 $\\epsilon$ 的线性朗之万动力学形式为\n$$\nM : \\ddot{\\epsilon} = -\\,\\frac{\\partial U_{\\mathrm{el}}}{\\partial \\epsilon} \\;-\\; \\Gamma : \\dot{\\epsilon} \\;+\\; \\eta(t),\n$$\n其中有一个由 $T_{\\mathrm{baro}}$ 导出的恒定的四阶质量度规 $M$，一个线性摩擦张量 $\\Gamma = \\gamma M$（其中 $\\gamma > 0$），以及一个零均值高斯白噪声 $\\eta(t)$，其协方差为\n$$\n\\left\\langle \\eta_{ij}(t)\\,\\eta_{kl}(t') \\right\\rangle \\;=\\; \\mathcal{Q}_{ij,kl}\\,\\delta(t-t'),\n$$\n其中 $\\mathcal{Q}$ 是某个待确定的恒定的四阶张量。设对称投影算子定义为\n$$\nS_{ij,kl} \\equiv \\frac{1}{2}\\left(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk}\\right).\n$$\n\n从第一性原理出发，包括牛顿第二定律、PR 动能、对称应变的定义，以及 $(\\epsilon,\\dot{\\epsilon})$ 的稳态分布是在温度 $T$ 下的玻尔兹曼分布这一要求，\n$$\n\\rho_{\\mathrm{eq}}(\\epsilon,\\dot{\\epsilon}) \\;\\propto\\; \\exp\\!\\left[-\\beta\\left(\\frac{1}{2}\\,\\dot{\\epsilon}:M:\\dot{\\epsilon} + U_{\\mathrm{el}}(\\epsilon)\\right)\\right], \\quad \\beta \\equiv (k_{B}T)^{-1},\n$$\n推导确定噪声协方差 $\\mathcal{Q}$ 的涨落-耗散关系 (FDR)，从而使得稳态应变涨落 $\\langle \\epsilon_{ij}\\epsilon_{kl}\\rangle$ 与等温等压 (NPT) 系综的涨落相匹配。在你的推导中，首先用 $W$、$a_{0}$ 和 $S$ 表示出质量度规 $M$ 的显式形式，然后确定所需的张量 $\\mathcal{Q}$。将你的最终答案表示为 $\\mathcal{Q}_{ij,kl}$ 关于 $W$、$a_{0}$、$\\gamma$、$k_{B}$、$T$ 和 $S_{ij,kl}$ 的单一闭式解析表达式。无需进行数值计算；最终方框内的表达式不应包含物理单位。",
            "solution": "该问题要求推导线性化的 Parrinello-Rahman 恒压器的涨落-耗散关系。具体而言，我们必须确定应变张量 $\\epsilon$ 的朗之万方程中随机噪声项 $\\eta(t)$ 的协方差张量 $\\mathcal{Q}$。其基本原理是，朗之万动力学必须能在给定温度 $T$ 下，得出应变及其时间导数的正确稳态玻尔兹曼分布。\n\n推导过程主要分为三个步骤：\n1. 通过用应变率 $\\dot{\\epsilon}$ 表示恒压器的动能，确定应变自由度的质量度规张量 $M$。\n2. 应用朗之万系统的一般涨落-耗散定理 (FDT)，该定理将噪声协方差 $\\mathcal{Q}$ 与摩擦张量 $\\Gamma$ 和温度 $T$ 联系起来。\n3. 结合这些结果以获得 $\\mathcal{Q}$ 的最终表达式。\n\n步骤 1：质量度规 $M$ 的推导\n\n出发点是恒压器的动能，它是晶胞矩阵速度 $\\dot{h}$ 的函数：\n$$\nT_{\\mathrm{baro}} = \\frac{W}{2}\\,\\mathrm{Tr}\\!\\left(\\dot{h}^{T}\\dot{h}\\right) = \\frac{W}{2} \\dot{h}_{ij}\\dot{h}_{ij} = \\frac{W}{2} (\\dot{h} : \\dot{h})\n$$\n我们需要用对称应变率张量 $\\dot{\\epsilon}$ 来表示这个动能。应变 $\\epsilon$ 定义为围绕参考立方晶胞 $h_0 = a_0 I$ 的微小形变：\n$$\n\\epsilon \\approx \\mathrm{sym}\\!\\left(h h_{0}^{-1} - I\\right)\n$$\n代入 $h_0 = a_0 I$，我们得到 $h_{0}^{-1} = \\frac{1}{a_0}I$。\n$$\n\\epsilon \\approx \\mathrm{sym}\\!\\left(\\frac{1}{a_0}h - I\\right) = \\frac{1}{2}\\left( \\left(\\frac{1}{a_0}h - I\\right) + \\left(\\frac{1}{a_0}h^{T} - I\\right) \\right) = \\frac{1}{2 a_0} (h+h^{T}) - I\n$$\n对时间求导，我们找到应变率 $\\dot{\\epsilon}$ 和晶胞矩阵速度 $\\dot{h}$ 之间的关系：\n$$\n\\dot{\\epsilon} = \\frac{1}{2 a_0} (\\dot{h}+\\dot{h}^{T}) = \\frac{1}{a_0} \\mathrm{sym}(\\dot{h})\n$$\n晶胞速度矩阵 $\\dot{h}$ 可以分解为其对称部分 $\\dot{h}_S$ 和反对称部分 $\\dot{h}_A$，即 $\\dot{h} = \\dot{h}_S + \\dot{h}_A$。根据上述关系，对称部分为 $\\dot{h}_S = a_0 \\dot{\\epsilon}$。动能可以写为：\n$$\nT_{\\mathrm{baro}} = \\frac{W}{2} (\\dot{h}_S + \\dot{h}_A) : (\\dot{h}_S + \\dot{h}_A) = \\frac{W}{2} \\left( \\dot{h}_S : \\dot{h}_S + 2 \\dot{h}_S : \\dot{h}_A + \\dot{h}_A : \\dot{h}_A \\right)\n$$\n对称张量 ($\\dot{h}_S$) 和反对称张量 ($\\dot{h}_A$) 的双点积为零。因此，动能解耦为来自晶胞对称（应变）运动和反对称（旋转）运动的贡献：\n$$\nT_{\\mathrm{baro}} = \\frac{W}{2} \\left( \\dot{h}_S : \\dot{h}_S + \\dot{h}_A : \\dot{h}_A \\right)\n$$\n问题中提供的朗之万方程仅描述应变 $\\epsilon$ 的动力学。因此，与这些动力学相关的动能是与应变率关联的部分，我们将其记为 $T_{\\epsilon}$：\n$$\nT_{\\epsilon} = \\frac{W}{2} (\\dot{h}_S : \\dot{h}_S) = \\frac{W}{2} (a_0 \\dot{\\epsilon}) : (a_0 \\dot{\\epsilon}) = \\frac{W a_0^2}{2} (\\dot{\\epsilon} : \\dot{\\epsilon}) = \\frac{W a_0^2}{2} \\dot{\\epsilon}_{ij}\\dot{\\epsilon}_{ij}\n$$\n问题指明玻尔兹曼分布的动能部分由 $\\frac{1}{2}\\dot{\\epsilon}:M:\\dot{\\epsilon}$ 给出。我们将其与我们推導出的 $T_\\epsilon$ 表达式相等：\n$$\n\\frac{1}{2} \\dot{\\epsilon} : M : \\dot{\\epsilon} = \\frac{1}{2} M_{ijkl} \\dot{\\epsilon}_{ij} \\dot{\\epsilon}_{kl} = \\frac{W a_0^2}{2} \\dot{\\epsilon}_{ij}\\dot{\\epsilon}_{ij}\n$$\n我们需要找到一个四阶张量 $M$，使得该等式对任何对称张量 $\\dot{\\epsilon}$ 都成立。让我们检验 $M_{ijkl} = C S_{ijkl}$ 的形式，其中 $C$ 是某个常数，$S$ 是对称投影算子 $S_{ij,kl} = \\frac{1}{2}(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk})$。\n$$\n(M:\\dot{\\epsilon})_{ij} = M_{ijkl}\\dot{\\epsilon}_{kl} = C S_{ijkl} \\dot{\\epsilon}_{kl} = C \\frac{1}{2}(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk}) \\dot{\\epsilon}_{kl} = C \\frac{1}{2}(\\dot{\\epsilon}_{ij} + \\dot{\\epsilon}_{ji})\n$$\n由于 $\\dot{\\epsilon}$ 是对称的（$\\dot{\\epsilon}_{ij} = \\dot{\\epsilon}_{ji}$），这可以简化为 $(M:\\dot{\\epsilon})_{ij} = C \\dot{\\epsilon}_{ij}$。\n于是，动能表达式变为：\n$$\n\\frac{1}{2} \\dot{\\epsilon}_{ij} (M:\\dot{\\epsilon})_{ij} = \\frac{1}{2} \\dot{\\epsilon}_{ij} (C \\dot{\\epsilon}_{ij}) = \\frac{C}{2} \\dot{\\epsilon}_{ij}\\dot{\\epsilon}_{ij}\n$$\n将此与 $T_\\epsilon = \\frac{W a_0^2}{2} \\dot{\\epsilon}_{ij}\\dot{\\epsilon}_{ij}$ 比较，我们确定常数 $C = W a_0^2$。\n因此，质量度规张量为：\n$$\nM_{ijkl} = W a_0^2 S_{ijkl}\n$$\n\n步骤 2：涨落-耗散定理\n\n问题指定了 $\\epsilon$ 动力学的线性朗之万方程：\n$$\nM : \\ddot{\\epsilon} = -\\,\\frac{\\partial U_{\\mathrm{el}}}{\\partial \\epsilon} \\;-\\; \\Gamma : \\dot{\\epsilon} \\;+\\; \\eta(t)\n$$\n系统需要弛豫到由玻尔兹曼分布表征的稳态：\n$$\n\\rho_{\\mathrm{eq}}(\\epsilon,\\dot{\\epsilon}) \\;\\propto\\; \\exp\\!\\left[-\\beta\\left(\\frac{1}{2}\\,\\dot{\\epsilon}:M:\\dot{\\epsilon} + U_{\\mathrm{el}}(\\epsilon)\\right)\\right]\n$$\n其中 $\\beta = (k_B T)^{-1}$。对于一个由哈密顿量 $H(q,p)$ 描述并受到线性耗散和白噪声影响的系统，动量 $p$ 的朗之万方程形式为 $\\dot{p} = F_{\\mathrm{cons}} - \\Lambda p + \\eta(t)$。为使该系统正确地热化到正则分布 $\\rho \\propto \\exp(-\\beta H)$，随机力 $\\eta(t)$ 的协方差必须与摩擦矩阵 $\\Lambda$ 和温度相关。这就是涨落-耗散定理的内容。\n\n在我们的例子中，变量是 $\\epsilon$ 和 $\\dot{\\epsilon}$，方程是关于时间的二阶方程。将其重写为关于 $(\\epsilon, \\dot{\\epsilon})$ 的一阶系统，并应用非平衡统计力学的标准结果，系统平衡到目标玻尔兹曼分布的条件是噪声协方差张量 $\\mathcal{Q}$ 和摩擦张量 $\\Gamma$ 之间的直接关系：\n$$\n\\mathcal{Q} = 2 k_B T \\Gamma \\quad\\text{或以分量形式表示,}\\quad \\mathcal{Q}_{ij,kl} = 2 k_B T \\Gamma_{ij,kl}\n$$\n这种关系确保了由摩擦项耗散的能量平均而言被随机噪声项注入的能量所平衡，从而使系统保持在恒定的平均动能温度。\n\n步骤 3：噪声协方差 $\\mathcal{Q}$ 的最终表达式\n\n我们现在结合前面步骤的结果。问题陈述摩擦张量与质量度规成正比：\n$$\n\\Gamma = \\gamma M\n$$\n其中 $\\gamma > 0$ 是一个恒定的摩擦率。\n\n将此代入步骤 2 的涨落-耗散关系中：\n$$\n\\mathcal{Q}_{ij,kl} = 2 k_B T \\Gamma_{ij,kl} = 2 k_B T (\\gamma M_{ij,kl}) = 2 \\gamma k_B T M_{ij,kl}\n$$\n现在，我们代入在步骤 1 中推导出的质量度规 $M_{ijkl}$ 的表达式：\n$$\nM_{ijkl} = W a_0^2 S_{ijkl}\n$$\n这就得出了噪声协方差张量的最终表达式：\n$$\n\\mathcal{Q}_{ij,kl} = 2 \\gamma k_B T (W a_0^2 S_{ij,kl})\n$$\n这个表达式将随机力 $\\eta(t)$ 的强度与系统的基本参数（$W$、$a_0$、$\\gamma$）和热能标度（$k_B T$）联系起来，确保在稳态下能够产生正确的模拟晶胞热力学涨落。\n最终表达式为：\n$$\n\\mathcal{Q}_{ij,kl} = 2 W a_0^2 \\gamma k_B T S_{ij,kl}\n$$\n这就是线性化 Parrinello-Rahman 恒压器所要求的涨落-耗散关系。",
            "answer": "$$\\boxed{2 W a_{0}^{2} \\gamma k_{B} T S_{ij,kl}}$$"
        },
        {
            "introduction": "恒压器产生的模拟盒子形状和大小的涨落并非无用的噪声，它们蕴含着关于材料力学响应的深刻信息。本练习将带你实践分子动力学中一个强大的应用：利用应变张量$\\epsilon$的协方差来计算材料的弹性柔度张量$C^{-1}$，进而得到弹性刚度张量$C_{ijkl}$ 。你还将学习一种专业的数据处理方法，即通过改变恒压器质量$W$并外推到$W \\to \\infty$的极限，来消除动力学人为因素导致的系统性偏差，从而获得精确的材料属性。",
            "id": "3432721",
            "problem": "考虑一个在零外部应力下，使用 Parrinello–Rahman (PR) 控压器控制的晶体固体的热力学系综。令 $h$ 为 $3 \\times 3$ 的晶胞矩阵，$g = h^{\\mathrm{T}} h$ 为度规张量，$g_0$ 为参考度规。在小应变极限下，无穷小拉格朗日应变定义为 $ \\epsilon = \\frac{1}{2} \\left( g g_0^{-1} - I \\right) $，其中 $I$ 是单位矩阵。在线性弹性力学中，围绕参考态展开的亥姆霍兹自由能密度为 $ f(\\epsilon) = \\frac{1}{2} \\epsilon : C : \\epsilon $，其中 $C$ 是四阶弹性劲度张量，其分量为 $C_{ijkl}$，而 $:$ 表示双点积。PR 控压器在温度 $T$ 下达到热平衡时，会根据玻尔兹曼权重抽样与应变涨落的平衡分布相符的样本。\n\n从这些基础出发，并忽略动力学细节，推导应变协方差关系式\n$$\n\\langle \\epsilon_{ij} \\epsilon_{kl} \\rangle = \\frac{k_B T}{V} \\left( C^{-1} \\right)_{ijkl},\n$$\n其中 $V$ 是体积，$k_B$ 是玻尔兹曼常数，$\\left( C^{-1} \\right)_{ijkl}$ 表示弹性柔度张量（$C$ 在四阶张量意义下的逆）的分量。使用 Voigt 工程记法 $e = [\\epsilon_{11}, \\epsilon_{22}, \\epsilon_{33}, 2\\epsilon_{23}, 2\\epsilon_{13}, 2\\epsilon_{12}]^{\\mathrm{T}}$，使得自由能为 $ F = \\frac{V}{2} e^{\\mathrm{T}} C^{(V)} e $，其中 $C^{(V)}$ 是 Voigt 记法下的 $6 \\times 6$ 劲度矩阵，$F$ 是总自由能。证明在此约定下，$e$ 的协方差为\n$$\n\\langle e e^{\\mathrm{T}} \\rangle = \\frac{k_B T}{V} \\left( C^{(V)} \\right)^{-1}.\n$$\n\n在实际的 PR 模拟中，控压器质量参数 $W$ 设定了晶胞动力学的特征时间尺度。对于有限的 $W$ 和有限的时间步长，离散化和动力学滤波会在抽样协方差中引入系统偏差，该偏差在固定时间步长下通常近似地按 $O\\!\\left( \\frac{1}{W} \\right)$ 比例变化。一个估算 $C_{ijkl}$ 的实用方案是，在多个 $W$ 值下运行模拟，计算 $e$ 的样本协方差矩阵，将其转换为柔度，然后通过对 $1/W$ 进行线性回归，外推至 $W \\to \\infty$ 的极限。\n\n你的任务是实现这一方案，并在合成的、科学上一致的案例上进行测试。具体来说：\n\n1. 实现一个程序，该程序在给定温度 $T$ (单位 K)、体积 $V$ (单位 m³)、一组控压器质量 $W$ (单位 amu·Å²) 以及针对这些 $W$ 测得的协方差矩阵 $\\Sigma_e(W) = \\langle e e^{\\mathrm{T}} \\rangle$ 的情况下，执行以下步骤：\n   - 使用 $ J(W) = \\frac{V}{k_B T} \\Sigma_e(W) $ 将每个 $\\Sigma_e(W)$ 转换为柔度估计值 $J(W)$。\n   - 对每个矩阵元素，使用线性模型 $ J_{pq}(W) = J_{pq}^{\\ast} + A_{pq} \\frac{1}{W} $ 对 $J(W)$ 以 $x = \\frac{1}{W}$ 进行回归，并提取截距 $J_{pq}^{\\ast}$，从而形成去偏差的柔度矩阵 $J^{\\ast}$。\n   - 对 $J^{\\ast}$ 求逆，以获得劲度矩阵 $C^{(V)}$ 的估计值。\n   - 以吉帕斯卡 (GPa) 为单位报告 $C^{(V)}$ 的指定分量，并四舍五入到三位小数。\n\n2. 如下文所述，在每种情况下对劲度矩阵使用 Voigt 工程记法和标准的对称性简化形式。\n\n3. 使用以下合成测试套件。在每种情况下，“测得的”协方差矩阵 $\\Sigma_e(W)$ 是从一个“真实的”劲度矩阵 $C_{\\text{true}}^{(V)}$ 生成的：首先获得真实柔度 $J_{\\text{true}} = \\left( C_{\\text{true}}^{(V)} \\right)^{-1}$，然后逐元素应用受控偏差模型 $J_{\\text{meas}}(W) = J_{\\text{true}} \\left( 1 + \\frac{\\alpha}{W} \\right)$，最后设置 $\\Sigma_e(W) = \\frac{k_B T}{V} J_{\\text{meas}}(W)$。你的程序中的回归不能使用 $\\alpha$；它应从对 $W$ 的依赖关系中推断出截距。\n\n- 常量：\n  - $k_B = 1.380649 \\times 10^{-23}$，单位 J/K。\n  - $T = 300$，单位 K。\n  - $V = 1.0 \\times 10^{-26}$，单位 m³。\n  - $W$ 值：$[10.0, 20.0, 50.0]$，单位 amu·Å²。\n  - 偏差幅度 $\\alpha$ 视具体情况而定，如下文所述。\n\n- 案例 1 (立方对称性，理想路径)：\n  - 真实劲度分量（单位 GPa）：$C_{11} = 200$, $C_{12} = 120$, $C_{44} = 80$。\n  - 构建 $C_{\\text{true}}^{(V)}$ 如下：\n    $$\n    \\begin{pmatrix}\n    C_{11}  C_{12}  C_{12}  0  0  0 \\\\\n    C_{12}  C_{11}  C_{12}  0  0  0 \\\\\n    C_{12}  C_{12}  C_{11}  0  0  0 \\\\\n    0  0  0  C_{44}  0  0 \\\\\n    0  0  0  0  C_{44}  0 \\\\\n    0  0  0  0  0  C_{44}\n    \\end{pmatrix}\n    $$\n  - 偏差幅度：$\\alpha = 0.40$。\n\n- 案例 2 (六方对称性，各向异性覆盖)：\n  - 真实劲度分量（单位 GPa）：$C_{11} = 160$, $C_{12} = 80$, $C_{13} = 65$, $C_{33} = 180$, $C_{44} = 50$，以及 $C_{66} = \\frac{C_{11}-C_{12}}{2}$。\n  - 构建 $C_{\\text{true}}^{(V)}$ 如下：\n    $$\n    \\begin{pmatrix}\n    C_{11}  C_{12}  C_{13}  0  0  0 \\\\\n    C_{12}  C_{11}  C_{13}  0  0  0 \\\\\n    C_{13}  C_{13}  C_{33}  0  0  0 \\\\\n    0  0  0  C_{44}  0  0 \\\\\n    0  0  0  0  C_{44}  0 \\\\\n    0  0  0  0  0  C_{66}\n    \\end{pmatrix}\n    $$\n  - 偏差幅度：$\\alpha = 0.25$。\n\n- 案例 3 (近各向同性，具有不同模量的边界情况)：\n  - 真实体积模量和剪切模量（单位 GPa）：$K = 160$，$G = 70$。计算 $\\lambda = K - \\frac{2}{3}G$，然后 $C_{11} = \\lambda + 2G$，$C_{12} = \\lambda$，$C_{44} = G$，并设置：\n    $$\n    C_{\\text{true}}^{(V)} =\n    \\begin{pmatrix}\n    C_{11}  C_{12}  C_{12}  0  0  0 \\\\\n    C_{12}  C_{11}  C_{12}  0  0  0 \\\\\n    C_{12}  C_{12}  C_{11}  0  0  0 \\\\\n    0  0  0  C_{44}  0  0 \\\\\n    0  0  0  0  C_{44}  0 \\\\\n    0  0  0  0  0  C_{44}\n    \\end{pmatrix}\n    $$\n  - 偏差幅度：$\\alpha = 0.50$。\n\n上述所有劲度矩阵 $C_{\\text{true}}^{(V)}$ 均以 GPa 为单位指定，但在计算时必须转换为 Pa，最终报告的值必须以 GPa 为单位。\n\n最终输出格式：\n- 对于每种情况，以列表形式按 $[C_{11}, C_{12}, C_{13}, C_{33}, C_{44}, C_{66}]$ 的顺序报告估计的劲度分量（单位 GPa），并四舍五入到三位小数。对于立方和各向同性情况，其中 $C_{13}$ 和 $C_{33}$ 未独立指定，使用 $C_{13} = C_{12}$ 和 $C_{33} = C_{11}$；对于立方和各向同性情况下的 $C_{66}$，使用 $C_{66} = C_{44}$。\n- 你的程序应生成单行输出，其中包含所有三种情况的结果，格式为用方括号括起来的、逗号分隔的列表的列表，例如：“[[...],[...],[...]]”。\n\n角度不属于此问题的一部分。物理单位必须严格遵循上述规范。确保计算中的科学真实性，并使用给定的常量。该测试套件涵盖了一个通用案例、一个各向异性案例和一个近各向同性的边界案例，数值结果必须是浮点数。",
            "solution": "该问题要求实现一个数据分析方案，用于从合成生成的模拟数据中确定弹性常数，并考虑系统偏差。在实现该方案之前，我们必须验证其背后的物理和数学原理。\n\n首先，我们在恒定温度 $T$ 和零外部应力下的 Parrinello-Rahman 系综背景下，推导应变涨落与弹性柔度张量之间的关系。在均匀应变 $\\epsilon$ 下，体积为 $V$ 的固体的亥姆霍兹自由能 $F$ 由 $F = V f(\\epsilon)$ 给出，其中 $f(\\epsilon)$ 是自由能密度。在线性弹性区域，这是应变的二次函数：\n$$\nf(\\epsilon) = \\frac{1}{2} \\epsilon : C : \\epsilon = \\frac{1}{2} \\sum_{i,j,k,l=1}^{3} \\epsilon_{ij} C_{ijkl} \\epsilon_{kl}\n$$\n此处，$C$ 是四阶弹性劲度张量。为便于计算，这可以使用 6 分量的 Voigt 应变向量 $e = [\\epsilon_{11}, \\epsilon_{22}, \\epsilon_{33}, 2\\epsilon_{23}, 2\\epsilon_{13}, 2\\epsilon_{12}]^{\\mathrm{T}}$ 和 $6 \\times 6$ 的 Voigt 劲度矩阵 $C^{(V)}$ 来表示。总自由能则为：\n$$\nF(e) = \\frac{V}{2} e^{\\mathrm{T}} C^{(V)} e\n$$\n根据统计力学，在平衡态的热力学系综中，宏观变量（此处为应变 $e$）涨落的概率分布遵循玻尔兹曼分布：\n$$\nP(e) \\propto \\exp\\left(-\\frac{F(e)}{k_B T}\\right) = \\exp\\left(-\\frac{V}{2k_B T} e^{\\mathrm{T}} C^{(V)} e\\right)\n$$\n其中 $k_B$ 是玻尔兹曼常数。这是向量 $e$ 的均值为零的多元正态分布的函数形式。对于一个向量 $\\mathbf{x}$，一般的零均值多元正态分布具有概率密度函数 $P(\\mathbf{x}) \\propto \\exp\\left(-\\frac{1}{2} \\mathbf{x}^{\\mathrm{T}} \\Sigma^{-1} \\mathbf{x}\\right)$，其中 $\\Sigma = \\langle \\mathbf{x} \\mathbf{x}^{\\mathrm{T}} \\rangle$ 是协方差矩阵。\n\n通过将应变分布的指数与一般形式进行比较，我们可以确定应变协方差矩阵 $\\Sigma_e = \\langle e e^{\\mathrm{T}} \\rangle$ 的逆：\n$$\n\\Sigma_e^{-1} = \\frac{V}{k_B T} C^{(V)}\n$$\n对此表达式求逆，即可得到所求的应变涨落协方差矩阵：\n$$\n\\Sigma_e = \\langle e e^{\\mathrm{T}} \\rangle = \\left(\\frac{V}{k_B T} C^{(V)}\\right)^{-1} = \\frac{k_B T}{V} \\left(C^{(V)}\\right)^{-1}\n$$\n矩阵 $J^{(V)} = (C^{(V)})^{-1}$ 是 Voigt 记法下的弹性柔度矩阵。关系式 $\\langle e e^{\\mathrm{T}} \\rangle = \\frac{k_B T}{V} J^{(V)}$ 是本问题的核心，因为它将一个可测量的量——应变协方差，与一个基本材料属性——弹性柔度联系起来。这是涨落-耗散定理的一个具体实例。等效的张量形式 $\\langle \\epsilon_{ij} \\epsilon_{kl} \\rangle = \\frac{k_B T}{V} (C^{-1})_{ijkl}$ 也可由此直接得出。\n\n接下来，问题引入了一个计算假象：测得的协方差中存在一个系统偏差，该偏差依赖于控压器质量参数 $W$。所提出的分析方案旨在校正此偏差。在有限 $W$ 下估计的“测得的”柔度 $J(W) = \\frac{V}{k_B T} \\Sigma_e(W)$，被假定与 $1/W$ 遵循线性关系：\n$$\nJ_{pq}(W) = J_{pq}^{\\ast} + A_{pq} \\frac{1}{W}\n$$\n此处，$J_{pq}^{\\ast}$ 是对应于 $W \\to \\infty$ 极限的真实、无偏的柔度分量，$A_{pq}$ 是偏差项的常数系数。为求得 $J^{\\ast}$，我们对每个矩阵元素 $(p, q)$ 执行线性回归。通过对来自不同 $W_i$ 下模拟的数据点 $(x_i, y_i) = (1/W_i, J_{pq}(W_i))$ 拟合一条直线，该直线的截距即为所求的估计值 $J_{pq}^{\\ast}$。\n\n计算任务是在合成数据上实现此方案。对于每个测试案例：\n1. 一个“真实的”劲度矩阵 $C_{\\text{true}}^{(V)}$ 以 GPa 为单位定义，并转换为 Pa ($1 \\text{ GPa} = 10^9 \\text{ Pa}$)。\n2. 计算真实柔度 $J_{\\text{true}} = (C_{\\text{true}}^{(V)})^{-1}$。\n3. 使用指定的偏差模型 $J_{\\text{meas}}(W) = J_{\\text{true}} (1 + \\alpha/W)$（逐元素应用），为给定的一组 $W$ 值生成“测得的”柔度矩阵 $J_{\\text{meas}}(W)$。\n4. 对每个元素 $(p,q)$，将 $J_{\\text{meas}, pq}(W)$ 的值对 $1/W$ 进行回归。由于合成数据是从一个完全线性的模型生成的，使用两个或更多点的线性拟合将能精确确定截距。我们使用 `numpy.polyfit` 来执行此过程。\n5. 收集这些截距以形成去偏差的柔度矩阵 $J^{\\ast}$。由于数据生成是精确的，我们期望 $J^{\\ast} \\approx J_{\\text{true}}$。\n6. 通过对去偏差的柔度矩阵求逆，得到最终估计的劲度矩阵：$C^{(V)}_{\\text{est}} = (J^{\\ast})^{-1}$。\n7. 将 $C^{(V)}_{\\text{est}}$ 的所需分量从 Pa 转换回 GPa 并报告。\n\n提供的常量为：$k_B=1.380649 \\times 10^{-23} \\text{ J/K}$，$T=300 \\text{ K}$，以及 $V=1.0 \\times 10^{-26} \\text{ m}^3$。$W$ 的值为 $[10.0, 20.0, 50.0]$ amu·Å²。$W$ 和 $\\alpha$ 的单位是一致的，使得 $\\alpha/W$ 成为一个无量纲因子。立方、六方和各向同性对称性的 $C_{\\text{true}}^{(V)}$ 的具体形式按所述构建。最终的实现将处理每种情况，执行回归分析，并按指定格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    # Define constants\n    K_B = 1.380649e-23  # J/K\n    T = 300.0           # K\n    V = 1.0e-26         # m^3\n    W_VALUES = [10.0, 20.0, 50.0]\n\n    # --- Test Case Definitions ---\n    \n    # Case 1: Cubic symmetry\n    C11_1, C12_1, C44_1 = 200.0, 120.0, 80.0\n    C_true_1 = np.array([\n        [C11_1, C12_1, C12_1, 0, 0, 0],\n        [C12_1, C11_1, C12_1, 0, 0, 0],\n        [C12_1, C12_1, C11_1, 0, 0, 0],\n        [0, 0, 0, C44_1, 0, 0],\n        [0, 0, 0, 0, C44_1, 0],\n        [0, 0, 0, 0, 0, C44_1]\n    ])\n    alpha_1 = 0.40\n\n    # Case 2: Hexagonal symmetry\n    C11_2, C12_2, C13_2, C33_2, C44_2 = 160.0, 80.0, 65.0, 180.0, 50.0\n    C66_2 = (C11_2 - C12_2) / 2.0\n    C_true_2 = np.array([\n        [C11_2, C12_2, C13_2, 0, 0, 0],\n        [C12_2, C11_2, C13_2, 0, 0, 0],\n        [C13_2, C13_2, C33_2, 0, 0, 0],\n        [0, 0, 0, C44_2, 0, 0],\n        [0, 0, 0, 0, C44_2, 0],\n        [0, 0, 0, 0, 0, C66_2]\n    ])\n    alpha_2 = 0.25\n\n    # Case 3: Isotropic material\n    K_3, G_3 = 160.0, 70.0\n    lambda_3 = K_3 - (2.0 / 3.0) * G_3\n    C11_3 = lambda_3 + 2.0 * G_3\n    C12_3 = lambda_3\n    C44_3 = G_3\n    C_true_3 = np.array([\n        [C11_3, C12_3, C12_3, 0, 0, 0],\n        [C12_3, C11_3, C12_3, 0, 0, 0],\n        [C12_3, C12_3, C11_3, 0, 0, 0],\n        [0, 0, 0, C44_3, 0, 0],\n        [0, 0, 0, 0, C44_3, 0],\n        [0, 0, 0, 0, 0, C44_3]\n    ])\n    alpha_3 = 0.50\n\n    test_cases = [\n        (C_true_1, alpha_1),\n        (C_true_2, alpha_2),\n        (C_true_3, alpha_3)\n    ]\n\n    all_results = []\n\n    for C_true_gpa, alpha in test_cases:\n        result = process_case(C_true_gpa, alpha, W_VALUES, K_B, T, V)\n        all_results.append(result)\n\n    # Format the final output string\n    formatted_results = []\n    for res_list in all_results:\n        # Format each number to three decimal places\n        s_list = [f\"{val:.3f}\" for val in res_list]\n        formatted_results.append(f\"[{','.join(s_list)}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\ndef process_case(C_true_gpa, alpha, W_values, k_b, T, V):\n    \"\"\"\n    Processes a single test case: generates synthetic data, performs regression, \n    and returns the estimated stiffness components.\n    \n    Args:\n        C_true_gpa (np.ndarray): The 6x6 true stiffness matrix in GPa.\n        alpha (float): The bias amplitude.\n        W_values (list): List of barostat mass values.\n        k_b, T, V: Physical constants.\n\n    Returns:\n        list: A list of the 6 estimated stiffness components in GPa.\n    \"\"\"\n    # 1. Convert stiffness from GPa to Pa and compute true compliance\n    C_true_pa = C_true_gpa * 1e9\n    J_true = np.linalg.inv(C_true_pa)\n\n    # 2. Generate \"measured\" compliance data with bias\n    # The problem implies covariance Sigma_e is measured, and J is derived.\n    # J(W) = V/(k_B T) * Sigma_e(W).\n    # The synthetic bias model is applied directly to J.\n    J_measured_list = []\n    for W in W_values:\n        J_meas = J_true * (1 + alpha / W)\n        J_measured_list.append(J_meas)\n    \n    # 3. Perform linear regression for each matrix element to find the intercept\n    J_star = np.zeros((6, 6))\n    x_reg = [1.0 / W for W in W_values]\n\n    for p in range(6):\n        for q in range(6):\n            y_reg = [J_measured[p, q] for J_measured in J_measured_list]\n            \n            # np.polyfit(x, y, 1) returns [slope, intercept]\n            # Since the data is generated from a perfect line, the fit is exact.\n            slope, intercept = np.polyfit(x_reg, y_reg, 1)\n            J_star[p, q] = intercept\n\n    # 4. Invert the de-biased compliance matrix to get the estimated stiffness\n    C_est_pa = np.linalg.inv(J_star)\n\n    # 5. Convert stiffness from Pa to GPa\n    C_est_gpa = C_est_pa / 1e9\n\n    # 6. Extract and report the required components\n    # The required components are C11, C12, C13, C33, C44, C66\n    # corresponding to C[0,0], C[0,1], C[0,2], C[2,2], C[3,3], C[5,5]\n    report_components = [\n        C_est_gpa[0, 0],\n        C_est_gpa[0, 1],\n        C_est_gpa[0, 2],\n        C_est_gpa[2, 2],\n        C_est_gpa[3, 3],\n        C_est_gpa[5, 5]\n    ]\n    \n    return report_components\n\nsolve()\n\n```"
        },
        {
            "introduction": "在前一个练习的基础上，我们将焦点转向一个更具体、更直观的方面：晶胞角度的涨落。对于像单斜晶体这样的各向异性材料，其晶胞角度$\\alpha$、$\\beta$、$\\gamma$的涨落并非相互独立，而是通过非对角弹性常数耦合在一起。本练习将指导你如何通过分析模拟数据中不同角度之间的协方差，来量化这种耦合，并将其与基于谐振子模型的理论预测进行比较。这有助于加深理解，将模拟中观察到的统计关联与描述材料内在物理特性的抽象弹性张量联系起来。",
            "id": "3432725",
            "problem": "在静水压力 $P$ 下，使用 Parrinello–Rahman 压力控制器，在等温等压系综中模拟一个单斜晶体。在小涨落体系中，三个晶胞角 $(\\alpha,\\beta,\\gamma)$ 围绕其平衡角 $(\\alpha_0,\\beta_0,\\gamma_0)$ 涨落，并可以通过谐波弹性模型进行建模。设角度偏差矢量为 $\\Delta \\boldsymbol{\\theta} = (\\Delta \\alpha,\\Delta \\beta,\\Delta \\gamma)^{\\mathsf{T}}$，谐波弹性能为\n$$\nU(\\Delta \\boldsymbol{\\theta}) = \\frac{1}{2}\\,\\Delta \\boldsymbol{\\theta}^{\\mathsf{T}}\\,\\mathbf{K}\\,\\Delta \\boldsymbol{\\theta},\n$$\n其中 $\\mathbf{K}$ 是一个对称正定的刚度矩阵，单位为焦耳每弧度平方 ($\\mathrm{J}/\\mathrm{rad}^2$)。热能为 $k_{\\mathrm{B}}T$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度。假设角度以弧度为单位。\n\n从基本原理（牛顿力学、玻尔兹曼分布和谐波近似）出发，$\\Delta \\boldsymbol{\\theta}$ 的平衡分布预期为一个多元正态分布，其特征由一个依赖于 $\\mathbf{K}$、$k_{\\mathrm{B}}$ 和 $T$ 的协方差矩阵决定。每个角度的边际分布是均值为 $(\\alpha_0,\\beta_0,\\gamma_0)$ 且方差等于协方差矩阵对角线元素的正态分布。\n\n您的任务是：\n- 在谐波模型下，计算 $(\\alpha,\\beta,\\gamma)$ 的预期平衡边际分布，并针对给定的区间边界计算每个角度的预测区间概率。\n- 使用 Jensen–Shannon 散度（无量纲，自然对数底）将这些预测与提供的每个角度的 Parrinello–Rahman 模拟直方图进行比较。对于相同的区间上的两个离散分布 $p$ 和 $q$，其定义为 $D_{\\mathrm{JS}}(p\\|q)=\\frac{1}{2}D_{\\mathrm{KL}}(p\\|m)+\\frac{1}{2}D_{\\mathrm{KL}}(q\\|m)$，其中 $m=\\frac{1}{2}(p+q)$ 且 $D_{\\mathrm{KL}}(p\\|q)=\\sum_i p_i \\ln\\frac{p_i}{q_i}$。\n- 利用协方差与刚度之间的谐波系综关系，从提供的 $(\\alpha,\\beta,\\gamma)$ 模拟协方差中推断非对角弹性耦合（$\\mathbf{K}$ 中对应于 $(\\alpha,\\beta)$、$(\\alpha,\\gamma)$ 和 $(\\beta,\\gamma)$ 耦合的元素 $K_{12},K_{13},K_{23}$）。\n\n使用以下约定和数据：\n- 角度以弧度为单位。\n- 非对角弹性耦合必须以 $\\mathrm{J}/\\mathrm{rad}^2$ 为单位报告。\n- 静水压力 $P$ 作为背景信息提供且为常数；在谐波近似中，它不直接用于角分布的计算。\n- 对于区间概率，将正态边际分布在由连续边界定义的每个区间上进行积分。\n- 对于散度计算，将直方图计数归一化为概率向量。\n\n对于数值常数，使用 $k_{\\mathrm{B}}=1.380649\\times 10^{-23}\\,\\mathrm{J}/\\mathrm{K}$。\n\n参数集和数据的测试套件：\n- 案例1（理想路径）：\n  - $T=300\\,\\mathrm{K}$, $P=1.0\\times 10^{9}\\,\\mathrm{Pa}$。\n  - $(\\alpha_0,\\beta_0,\\gamma_0) = (1.570796,\\,1.100000,\\,1.570796)$。\n  - 刚度矩阵 $\\mathbf{K} = \\begin{bmatrix}2.5\\times 10^{-18}0.3\\times 10^{-18}-0.1\\times 10^{-18}\\\\0.3\\times 10^{-18}3.0\\times 10^{-18}0.2\\times 10^{-18}\\\\-0.1\\times 10^{-18}0.2\\times 10^{-18}2.2\\times 10^{-18}\\end{bmatrix}\\,\\mathrm{J}/\\mathrm{rad}^2$。\n  - 所有三个角度的区间规格：以相应的平衡角为中心；半程 $0.11\\,\\mathrm{rad}$；均匀区间宽度 $0.02\\,\\mathrm{rad}$；从而得到11个区间和12个等间距的边界。\n  - 提供的 Parrinello–Rahman 直方图计数（每个角度，对应11个区间）：\n    - $\\alpha$：$[5,12,35,80,160,260,320,260,160,80,35]$。\n    - $\\beta$：$[2,5,20,60,140,260,300,260,140,60,20]$。\n    - $\\gamma$：$[4,10,28,70,150,240,280,240,150,70,28]$。\n  - 提供的 $(\\alpha,\\beta,\\gamma)$ 模拟协方差矩阵，单位为 $\\mathrm{rad}^2$：\n    $$\n    \\boldsymbol{\\Sigma}_{\\mathrm{PR}}^{(1)}=\\begin{bmatrix}\n    1.60\\times 10^{-3}  2.00\\times 10^{-4}  -1.00\\times 10^{-4}\\\\\n    2.00\\times 10^{-4}  1.40\\times 10^{-3}  1.20\\times 10^{-4}\\\\\n    -1.00\\times 10^{-4}  1.20\\times 10^{-4}  1.90\\times 10^{-3}\n    \\end{bmatrix}.\n    $$\n- 案例2（强非对角耦合）：\n  - $T=150\\,\\mathrm{K}$, $P=2.0\\times 10^{9}\\,\\mathrm{Pa}$。\n  - $(\\alpha_0,\\beta_0,\\gamma_0) = (1.600000,\\,1.050000,\\,1.580000)$。\n  - 刚度矩阵 $\\mathbf{K} = \\begin{bmatrix}3.2\\times 10^{-18}0.9\\times 10^{-18}0.6\\times 10^{-18}\\\\0.9\\times 10^{-18}2.6\\times 10^{-18}-0.5\\times 10^{-18}\\\\0.6\\times 10^{-18}-0.5\\times 10^{-18}2.4\\times 10^{-18}\\end{bmatrix}\\,\\mathrm{J}/\\mathrm{rad}^2$。\n  - 区间规格：半程 $0.11\\,\\mathrm{rad}$；区间宽度 $0.02\\,\\mathrm{rad}$；每个角度11个区间，以相应的平衡角为中心。\n  - 提供的 Parrinello–Rahman 直方图计数：\n    - $\\alpha$：$[1,3,10,30,90,180,240,180,90,30,10]$。\n    - $\\beta$：$[1,2,8,25,80,160,220,160,80,25,8]$。\n    - $\\gamma$：$[1,3,9,28,85,170,230,170,85,28,9]$。\n  - 提供的模拟协方差矩阵，单位为 $\\mathrm{rad}^2$：\n    $$\n    \\boldsymbol{\\Sigma}_{\\mathrm{PR}}^{(2)}=\\begin{bmatrix}\n    9.00\\times 10^{-4}  3.50\\times 10^{-4}  2.50\\times 10^{-4}\\\\\n    3.50\\times 10^{-4}  1.00\\times 10^{-3}  -2.00\\times 10^{-4}\\\\\n    2.50\\times 10^{-4}  -2.00\\times 10^{-4}  1.10\\times 10^{-3}\n    \\end{bmatrix}.\n    $$\n- 案例3（一个角度刚度非常大的边缘案例）：\n  - $T=600\\,\\mathrm{K}$, $P=5.0\\times 10^{8}\\,\\mathrm{Pa}$。\n  - $(\\alpha_0,\\beta_0,\\gamma_0) = (1.500000,\\,1.350000,\\,1.550000)$。\n  - 刚度矩阵 $\\mathbf{K} = \\begin{bmatrix}1.0\\times 10^{-17}0.2\\times 10^{-18}0.0\\\\0.2\\times 10^{-18}1.5\\times 10^{-18}0.3\\times 10^{-18}\\\\0.00.3\\times 10^{-18}1.2\\times 10^{-18}\\end{bmatrix}\\,\\mathrm{J}/\\mathrm{rad}^2$。\n  - 区间规格：半程 $0.11\\,\\mathrm{rad}$；区间宽度 $0.02\\,\\mathrm{rad}$；每个角度11个区间，以相应的平衡角为中心。\n  - 提供的 Parrinello–Rahman 直方图计数：\n    - $\\alpha$：$[3,8,20,60,140,260,320,260,140,60,20]$。\n    - $\\beta$：$[5,12,30,70,140,220,260,220,140,70,30]$。\n    - $\\gamma$：$[6,14,32,75,150,240,300,240,150,75,32]$。\n  - 提供的模拟协方差矩阵，单位为 $\\mathrm{rad}^2$：\n    $$\n    \\boldsymbol{\\Sigma}_{\\mathrm{PR}}^{(3)}=\\begin{bmatrix}\n    8.00\\times 10^{-4}  1.00\\times 10^{-4}  0.00\\\\\n    1.00\\times 10^{-4}  5.00\\times 10^{-3}  3.00\\times 10^{-4}\\\\\n    0.00  3.00\\times 10^{-4}  4.00\\times 10^{-3}\n    \\end{bmatrix}.\n    $$\n\n算法任务：\n- 对于每个案例，根据协方差和刚度之间的关系计算对角方差，并评估 $(\\alpha,\\beta,\\gamma)$ 的正态边际分布。\n- 对于每个角度，通过在给定边界定义的区间上积分正态分布，计算预测的区间概率。\n- 对每个角度提供的直方图计数进行归一化，并计算归一化直方图与预测概率之间的 Jensen–Shannon 散度。\n- 对于每个案例，通过 $\\mathbf{K}_{\\mathrm{est}} = k_{\\mathrm{B}}T\\,\\boldsymbol{\\Sigma}_{\\mathrm{PR}}^{-1}$ 从提供的模拟协方差 $\\boldsymbol{\\Sigma}_{\\mathrm{PR}}$ 计算估计值 $\\mathbf{K}_{\\mathrm{est}}$，并以 $\\mathrm{J}/\\mathrm{rad}^2$ 为单位报告非对角元素 $(K_{12},K_{13},K_{23})$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个案例，按顺序附加三个 Jensen–Shannon 散度值 $(\\alpha,\\beta,\\gamma)$，后跟三个非对角耦合 $(K_{12},K_{13},K_{23})$，最终形成一个扁平列表，每个案例6个值，总共18个值。例如：\"[d_alpha_case1,d_beta_case1,d_gamma_case1,K12_case1,K13_case1,K23_case1,d_alpha_case2,...,K23_case3]\"。",
            "solution": "该问题在科学上是有效的、定义明确的，并包含推导唯一解所需的所有必要信息。它基于统计力学原理在分子动力学模拟中的应用。我们首先验证问题的前提，然后进行分步求解。\n\n**问题验证**\n\n1.  **已知条件提取**：所有数据，包括三个不同案例的温度（$T$）、平衡角（$\\alpha_0, \\beta_0, \\gamma_0$）、理论刚度矩阵（$\\mathbf{K}$）、区间划分规格、直方图计数以及模拟协方差矩阵（$\\boldsymbol{\\Sigma}_{\\mathrm{PR}}$），都已明确提供。玻尔兹曼常数 $k_{\\mathrm{B}}$ 的值也已给出。\n\n2.  **标准验证**：\n    *   **科学基础**：该问题建立在统计力学中正则系综或等温等压系综的坚实基础上。其核心思想是，系统状态的概率由玻尔兹曼因子 $e^{-E/(k_{\\mathrm{B}}T)}$ 控制。对于围绕力学平衡点的小涨落，势能可以近似为谐波势 $U(\\Delta \\boldsymbol{\\theta}) = \\frac{1}{2}\\,\\Delta \\boldsymbol{\\theta}^{\\mathsf{T}}\\,\\mathbf{K}\\,\\Delta \\boldsymbol{\\theta}$，其中 $\\Delta \\boldsymbol{\\theta}$ 代表偏离平衡的量。这导致涨落服从多元正态分布。由此导出的关系 $\\boldsymbol{\\Sigma} = k_{\\mathrm{B}}T\\,\\mathbf{K}^{-1}$ 是统计物理学中的一个标准结果，代表了涨落-耗散定理的一个具体实例。使用 Jensen-Shannon 散度是信息论中比较概率分布的标准方法。所有物理量及其单位都是一致的。\n    *   **定义明确且一致**：该问题需要进行两组计算。第一组是预测性的：给定一个模型（$\\mathbf{K}$），预测可观测量（区间概率），并将其与模拟数据（直方图）进行比较。第二组是推断性的：给定模拟数据（$\\boldsymbol{\\Sigma}_{\\mathrm{PR}}$），推断模型参数（$\\mathbf{K}_{\\mathrm{est}}$）。这些任务是独立的、定义明确的，并且互不矛盾。它们代表了计算物理学中的一个典型工作流程，即用理论模型检验模拟结果。给定的刚度矩阵 $\\mathbf{K}$ 被说明为对称正定的，而从数据中导出的模拟协方差矩阵 $\\boldsymbol{\\Sigma}_{\\mathrm{PR}}$ 也应如此。这确保了所需的矩阵求逆在数学上是合理的。\n\n3.  **结论**：问题有效。\n\n**理论框架**\n\n角度偏差矢量 $\\Delta\\boldsymbol{\\theta} = (\\Delta\\alpha, \\Delta\\beta, \\Delta\\gamma)^{\\mathsf{T}}$ 在谐波近似下的概率分布由玻尔兹曼分布给出：\n$$\np(\\Delta\\boldsymbol{\\theta}) = \\frac{1}{Z} \\exp\\left(-\\frac{U(\\Delta\\boldsymbol{\\theta})}{k_{\\mathrm{B}}T}\\right)\n$$\n其中 $Z$ 是归一化常数（配分函数），$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度，$U$ 是谐波势能：\n$$\nU(\\Delta \\boldsymbol{\\theta}) = \\frac{1}{2}\\,\\Delta \\boldsymbol{\\theta}^{\\mathsf{T}}\\,\\mathbf{K}\\,\\Delta \\boldsymbol{\\theta}\n$$\n代入势能表达式，我们得到：\n$$\np(\\Delta\\boldsymbol{\\theta}) = \\frac{1}{Z} \\exp\\left(-\\frac{1}{2k_{\\mathrm{B}}T}\\,\\Delta \\boldsymbol{\\theta}^{\\mathsf{T}}\\,\\mathbf{K}\\,\\Delta \\boldsymbol{\\theta}\\right)\n$$\n这是均值为零（$\\boldsymbol{\\mu} = \\mathbf{0}$）且协方差矩阵 $\\boldsymbol{\\Sigma}$ 的逆为 $\\boldsymbol{\\Sigma}^{-1} = \\mathbf{K}/(k_{\\mathrm{B}}T)$ 的多元正态分布的概率密度函数（PDF）。\n因此，角度涨落的协方差矩阵由下式给出：\n$$\n\\boldsymbol{\\Sigma} = k_{\\mathrm{B}}T\\,\\mathbf{K}^{-1}\n$$\n这个基本关系将在给定温度下系统的力学刚度（$\\mathbf{K}$）与统计涨落（$\\boldsymbol{\\Sigma}$）联系起来。绝对角度 $(\\alpha, \\beta, \\gamma)$ 的分布也是一个多元正态分布，其均值为 $(\\alpha_0, \\beta_0, \\gamma_0)$，协方差矩阵同样为 $\\boldsymbol{\\Sigma}$。\n\n对于每个案例，问题分为两个主要任务：\n\n**任务1：计算 Jensen–Shannon 散度**\n\n1.  **计算理论协方差**：使用提供的刚度矩阵 $\\mathbf{K}$ 和温度 $T$，我们计算理论协方差矩阵 $\\boldsymbol{\\Sigma}_{\\mathrm{th}} = k_{\\mathrm{B}}T\\,\\mathbf{K}^{-1}$。\n2.  **边际分布**：每个角度（例如 $\\alpha$）的边际分布是一个正态分布，其均值为 $\\alpha_0$，方差为 $\\sigma_\\alpha^2 = (\\boldsymbol{\\Sigma}_{\\mathrm{th}})_{11}$，即 $\\boldsymbol{\\Sigma}_{\\mathrm{th}}$ 的第一个对角元素。\n3.  **预测区间概率**：对于每个角度，我们根据问题规格定义一组区间。一个角度落入边界为 $[e_i, e_{i+1}]$ 的区间内的理论概率是通过在该区间上对正态 PDF 进行积分来计算的。最有效的方法是计算累积分布函数（CDF）的差值：$p_i = \\mathrm{CDF}(e_{i+1}) - \\mathrm{CDF}(e_i)$。这将给出一个预测概率向量 $p$。\n4.  **模拟概率**：将提供的直方图计数通过其总和进行归一化，以获得离散概率分布 $q$。\n5.  **Jensen–Shannon 散度**：预测分布 $p$ 和模拟导出的分布 $q$ 之间的散度使用公式 $D_{\\mathrm{JS}}(p\\|q)=\\frac{1}{2}D_{\\mathrm{KL}}(p\\|m)+\\frac{1}{2}D_{\\mathrm{KL}}(q\\|m)$ 计算，其中 $m=\\frac{1}{2}(p+q)$ 且 $D_{\\mathrm{KL}}(p\\|q)=\\sum_i p_i \\ln(p_i/q_i)$。\n\n**任务2：推断非对角弹性耦合**\n\n1.  **估计刚度矩阵**：我们使用模拟导出的协方差矩阵 $\\boldsymbol{\\Sigma}_{\\mathrm{PR}}$ 和温度 $T$ 来推断与模拟数据最一致的刚度矩阵。这通过反转基本关系来完成：$\\mathbf{K}_{\\mathrm{est}} = k_{\\mathrm{B}}T\\,\\boldsymbol{\\Sigma}_{\\mathrm{PR}}^{-1}$。\n2.  **提取耦合**：$\\mathbf{K}_{\\mathrm{est}}$ 的非对角元素代表推断出的角间弹性耦合。我们提取 $K_{12} = (\\mathbf{K}_{\\mathrm{est}})_{0,1}$、$K_{13} = (\\mathbf{K}_{\\mathrm{est}})_{0,2}$ 和 $K_{23} = (\\mathbf{K}_{\\mathrm{est}})_{1,2}$（使用0基索引）。\n\n将此程序应用于提供的三个测试案例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\nfrom scipy.special import rel_entr\n\ndef solve():\n    \"\"\"\n    Solves the problem for all given test cases.\n    \"\"\"\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n\n    def analyze_case(T, means, K_theory, bin_spec, hist_counts, Sigma_sim):\n        \"\"\"\n        Performs the full analysis for a single case.\n        \n        Returns:\n            A list containing 3 JS divergence values and 3 inferred couplings.\n        \"\"\"\n        # --- Part A: Jensen-Shannon Divergence Calculation ---\n        \n        # 1. Compute theoretical covariance matrix from theoretical K\n        Sigma_theory = k_B * T * np.linalg.inv(K_theory)\n        \n        variances = np.diag(Sigma_theory)\n        stds = np.sqrt(variances)\n        \n        js_divergences = []\n        \n        for i in range(3):  # For each angle alpha, beta, gamma\n            # 2. Define bin edges\n            mean = means[i]\n            half_range = bin_spec['half_range']\n            width = bin_spec['bin_width']\n            num_bins = int(round(2 * half_range / width))\n            edges = np.linspace(mean - half_range, mean + half_range, num_bins + 1)\n            \n            # 3. Compute theoretical bin probabilities (p)\n            cdf_vals = norm.cdf(edges, loc=mean, scale=stds[i])\n            p = np.diff(cdf_vals)\n            p /= np.sum(p)  # Normalize to ensure sum is 1\n            \n            # 4. Normalize histogram counts to get simulation probabilities (q)\n            q = np.array(hist_counts[i], dtype=float)\n            q /= np.sum(q)\n            \n            # 5. Compute Jensen-Shannon divergence\n            m = 0.5 * (p + q)\n            kl_pm = np.sum(rel_entr(p, m))\n            kl_qm = np.sum(rel_entr(q, m))\n            jsd = 0.5 * kl_pm + 0.5 * kl_qm\n            js_divergences.append(jsd)\n\n        # --- Part B: Infer Off-Diagonal Couplings ---\n\n        # 1. Compute estimated stiffness matrix K_est from simulation Sigma\n        K_est = k_B * T * np.linalg.inv(Sigma_sim)\n        \n        # 2. Extract off-diagonal couplings\n        k12_est = K_est[0, 1]\n        k13_est = K_est[0, 2]\n        k23_est = K_est[1, 2]\n        couplings = [k12_est, k13_est, k23_est]\n        \n        return js_divergences + couplings\n\n    # --- Test Case Data ---\n    \n    test_cases = [\n        # Case 1\n        {\n            \"T\": 300.0,\n            \"means\": (1.570796, 1.100000, 1.570796),\n            \"K_theory\": np.array([\n                [2.5e-18, 0.3e-18, -0.1e-18],\n                [0.3e-18, 3.0e-18, 0.2e-18],\n                [-0.1e-18, 0.2e-18, 2.2e-18]\n            ]),\n            \"bin_spec\": {\"half_range\": 0.11, \"bin_width\": 0.02},\n            \"hist_counts\": [\n                [5, 12, 35, 80, 160, 260, 320, 260, 160, 80, 35],\n                [2, 5, 20, 60, 140, 260, 300, 260, 140, 60, 20],\n                [4, 10, 28, 70, 150, 240, 280, 240, 150, 70, 28]\n            ],\n            \"Sigma_sim\": np.array([\n                [1.60e-3, 2.00e-4, -1.00e-4],\n                [2.00e-4, 1.40e-3, 1.20e-4],\n                [-1.00e-4, 1.20e-4, 1.90e-3]\n            ])\n        },\n        # Case 2\n        {\n            \"T\": 150.0,\n            \"means\": (1.600000, 1.050000, 1.580000),\n            \"K_theory\": np.array([\n                [3.2e-18, 0.9e-18, 0.6e-18],\n                [0.9e-18, 2.6e-18, -0.5e-18],\n                [0.6e-18, -0.5e-18, 2.4e-18]\n            ]),\n            \"bin_spec\": {\"half_range\": 0.11, \"bin_width\": 0.02},\n            \"hist_counts\": [\n                [1, 3, 10, 30, 90, 180, 240, 180, 90, 30, 10],\n                [1, 2, 8, 25, 80, 160, 220, 160, 80, 25, 8],\n                [1, 3, 9, 28, 85, 170, 230, 170, 85, 28, 9]\n            ],\n            \"Sigma_sim\": np.array([\n                [9.00e-4, 3.50e-4, 2.50e-4],\n                [3.50e-4, 1.00e-3, -2.00e-4],\n                [2.50e-4, -2.00e-4, 1.10e-3]\n            ])\n        },\n        # Case 3\n        {\n            \"T\": 600.0,\n            \"means\": (1.500000, 1.350000, 1.550000),\n            \"K_theory\": np.array([\n                [1.0e-17, 0.2e-18, 0.0],\n                [0.2e-18, 1.5e-18, 0.3e-18],\n                [0.0, 0.3e-18, 1.2e-18]\n            ]),\n            \"bin_spec\": {\"half_range\": 0.11, \"bin_width\": 0.02},\n            \"hist_counts\": [\n                [3, 8, 20, 60, 140, 260, 320, 260, 140, 60, 20],\n                [5, 12, 30, 70, 140, 220, 260, 220, 140, 70, 30],\n                [6, 14, 32, 75, 150, 240, 300, 240, 150, 75, 32]\n            ],\n            \"Sigma_sim\": np.array([\n                [8.00e-4, 1.00e-4, 0.00],\n                [1.00e-4, 5.00e-3, 3.00e-4],\n                [0.00, 3.00e-4, 4.00e-3]\n            ])\n        }\n    ]\n\n    all_results = []\n    for case_data in test_cases:\n        results = analyze_case(**case_data)\n        all_results.extend(results)\n\n    # Final print statement in the exact required format.\n    # Using .6e for scientific notation with 6 decimal places.\n    print(f\"[{','.join(f'{x:.6e}' for x in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}