{
    "hands_on_practices": [
        {
            "introduction": "在任何大气化学反演问题中，一个精确的正向模型是整个框架的基石。此练习将引导你深入探讨如何为传输-化学方程建立物理上恰当的边界条件，这些边界条件是连接模型与真实世界物理过程（如地表排放和干沉降）的桥梁。通过推导和分析质量平衡方程，你将能够深刻理解这些过程如何影响大气中污染物的整体收支。",
            "id": "3365808",
            "problem": "考虑一个无源被动大气示踪剂，其浓度场 $c(\\boldsymbol{x},t)$ 在一个三维区域 $\\Omega \\subset \\mathbb{R}^{3}$ 上演变。该区域代表地球表面 $\\Gamma_{s}$ 和模式大气层顶 $\\Gamma_{t}$ 之间的对流层，其侧边界为 $\\Gamma_{\\ell}$，因此 $\\partial \\Omega = \\Gamma_{s} \\cup \\Gamma_{t} \\cup \\Gamma_{\\ell}$。该示踪剂由已知的风场 $\\boldsymbol{u}(\\boldsymbol{x},t)$ 输运，并通过由对称正定扩散张量 $\\mathbf{K}(\\boldsymbol{x},t)$ 建模的湍流扩散进行混合。浓度满足平流-扩散-反应偏微分方程 (PDE)\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot \\left( \\boldsymbol{u}\\, c \\right) \\;=\\; \\nabla \\cdot \\left( \\mathbf{K} \\nabla c \\right) \\;-\\; \\lambda(\\boldsymbol{x},t)\\, c \\;+\\; q_{v}(\\boldsymbol{x},t)\\,, \\quad \\text{在 } \\Omega \\text{ 中},\n$$\n其中 $\\lambda(\\boldsymbol{x},t) \\ge 0$ 是一阶耗失率，$q_{v}(\\boldsymbol{x},t)$ 是一个已知的体源。令 $\\boldsymbol{n}$ 表示 $\\partial \\Omega$ 上的外向单位法向量。在表面 $\\Gamma_{s}$，示踪剂通过以下方式与地面相互作用：\n- 一个规定的地表排放通量 $E(\\boldsymbol{x},t)$，单位为质量/面积/时间，\n- 由沉降速度 $v_{d}(\\boldsymbol{x},t) \\ge 0$（单位为长度/时间）参数化的干沉降。\n在顶部 $\\Gamma_{t}$，对流层通过由传输速度 $k_{e}(\\boldsymbol{x},t) \\ge 0$（单位为长度/时间）表征的湍流夹带，与一个已知浓度为 $c_{a}(\\boldsymbol{x},t)$ 的外部储库进行交换。平流边界条件需要在 $\\boldsymbol{n}\\cdot \\boldsymbol{u}  0$ 的流入子集上指定。假设表面对解析的平流是不可渗透的，因此在 $\\Gamma_{s}$ 上 $\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$。考虑全球质量趋势\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\\,,\n$$\n它必须遵循质量守恒和散度定理，并包括跨越 $\\partial \\Omega$ 的显式边通量项。\n\n哪个选项给出了在 $\\Gamma_{s}$ 和 $\\Gamma_{t}$ 上一组物理上恰当且自洽的边界条件，根据排放、沉降以及与上层储库的交换来论证其物理意义，并为 $\\displaystyle \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega$ 提供了具有正确符号和流入-流出处理的正确全球质量平衡？\n\nA. 地表：$\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$ 和在 $\\Gamma_{s}$ 上的 Robin 边界条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = v_{d}\\, c - E$。顶部：在 $\\Gamma_{t}$ 上应用 Robin 扩散交换 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = k_{e}\\, (\\,c - c_{a}\\,)$，并且只在流入子集 $\\Gamma_{t}^{-}=\\{\\boldsymbol{x}\\in \\Gamma_{t}: \\boldsymbol{n}\\cdot \\boldsymbol{u}  0\\}$ 上施加 Dirichlet 流入条件 $c=c_{a}$；在流出部分 $\\Gamma_{t}^{+}=\\{\\boldsymbol{x}\\in \\Gamma_{t}: \\boldsymbol{n}\\cdot \\boldsymbol{u} > 0\\}$ 上无平流规定。在 $\\Gamma_{\\ell}$ 上扩散通量为零时，全球质量平衡为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\n= - \\int_{\\Gamma_{\\ell} \\cup \\Gamma_{t}} \\boldsymbol{n}\\cdot (\\boldsymbol{u}\\, c)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{s}} \\big( v_{d}\\, c - E \\big)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{t}} k_{e}\\, (\\,c - c_{a}\\,)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega\n\\;+\\; \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega.\n$$\n这意味着当 $c > c_{a}$ 时，沉降 $v_{d}\\,c$ 和夹带 $k_{e}(c-c_{a})$ 移除质量，而排放 $E$ 增加质量；平流在流出部分输出质量，在流入部分输入质量，其中 $c$ 由施加的流入值设定。\n\nB. 地表：$\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$ 和在 $\\Gamma_{s}$ 上的 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = E + v_{d}\\, c$，解释为排放和沉降均为向外通量。顶部：与 A 中相同。全球质量平衡：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\n= - \\int_{\\Gamma_{\\ell} \\cup \\Gamma_{t}} \\boldsymbol{n}\\cdot (\\boldsymbol{u}\\, c)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{s}} \\big( E + v_{d}\\, c \\big)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{t}} k_{e}\\, (\\,c - c_{a}\\,)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega\n\\;+\\; \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega.\n$$\n因此，排放和沉降都减少了大气质量。\n\nC. 地表：与 A 中相同。顶部：在 $\\Gamma_{t}$ 上有一个密封盖，满足 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = 0$ 和 $\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$。全球质量平衡：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\n= - \\int_{\\Gamma_{\\ell}} \\boldsymbol{n}\\cdot (\\boldsymbol{u}\\, c)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{s}} \\big( v_{d}\\, c - E \\big)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega\n\\;+\\; \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega.\n$$\n这模拟了与上层大气没有净交换。\n\nD. 地表：与 A 中相同。顶部：在 $\\Gamma_{t}$ 上有反符号的 Robin 条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = k_{e}\\, (\\,c_{a} - c\\,)$，并在流出子集 $\\Gamma_{t}^{+}$ 上施加 $c=c_{a}$，同时不约束流入。全球质量平衡：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\n= - \\int_{\\Gamma_{\\ell} \\cup \\Gamma_{t}} \\boldsymbol{n}\\cdot (\\boldsymbol{u}\\, c)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{s}} \\big( v_{d}\\, c - E \\big)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Gamma_{t}} k_{e}\\, (\\,c_{a} - c\\,)\\, \\mathrm{d}S\n\\;-\\; \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega\n\\;+\\; \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega.\n$$\n这意味着当 $c > c_{a}$ 时质量从高处进入，并约束了流出值。\n\nE. 地表：通过在 $\\Gamma_{s}$ 上施加 Dirichlet 条件 $c=0$ 来模拟沉降，使 $c$ 在地面消失；没有显式的通量条件。顶部：在 $\\Gamma_{t}$ 的所有部分（包括流入和流出）施加 $c=c_{a}$。全球质量平衡省略了边通量，因为 $c$ 是被规定的：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega\n= - \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega\n\\;+\\; \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega.\n$$",
            "solution": "分析分两个阶段进行。首先，使用给定的偏微分方程（PDE）和散度定理从第一性原理推导出全球质量平衡方程。其次，根据此推导和基本物理原理对每个选项进行评估。\n\n**1. 全球质量平衡方程的推导**\n\n示踪剂浓度 $c(\\boldsymbol{x},t)$ 的控制方程（平流-扩散-反应方程）如下：\n$$\n\\frac{\\partial c}{\\partial t} + \\nabla \\cdot \\left( \\boldsymbol{u}\\, c \\right) \\;=\\; \\nabla \\cdot \\left( \\mathbf{K} \\nabla c \\right) \\;-\\; \\lambda(\\boldsymbol{x},t)\\, c \\;+\\; q_{v}(\\boldsymbol{x},t)\n$$\n为了求出区域 $\\Omega$ 中示踪剂总质量随时间的变化率，我们将 PDE 在 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\frac{\\partial c}{\\partial t} \\, \\mathrm{d}\\Omega + \\int_{\\Omega} \\nabla \\cdot \\left( \\boldsymbol{u}\\, c \\right) \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\nabla \\cdot \\left( \\mathbf{K} \\nabla c \\right) \\, \\mathrm{d}\\Omega - \\int_{\\Omega} \\lambda c \\, \\mathrm{d}\\Omega + \\int_{\\Omega} q_{v} \\, \\mathrm{d}\\Omega\n$$\n假设区域 $\\Omega$ 不随时间变化，时间导数的积分可以与微分算子互换：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c \\, \\mathrm{d}\\Omega + \\int_{\\Omega} \\nabla \\cdot \\left( \\boldsymbol{u}\\, c \\right) \\, \\mathrm{d}\\Omega = \\int_{\\Omega} \\nabla \\cdot \\left( \\mathbf{K} \\nabla c \\right) \\, \\mathrm{d}\\Omega - \\int_{\\Omega} \\lambda c \\, \\mathrm{d}\\Omega + \\int_{\\Omega} q_{v} \\, \\mathrm{d}\\Omega\n$$\n我们对两个散度项应用散度定理（高斯定理），它将散度的体积分转换成穿过边界 $\\partial \\Omega$ 的通量的面积分：\n$$\n\\int_{\\Omega} \\nabla \\cdot \\mathbf{F} \\, \\mathrm{d}\\Omega = \\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot \\mathbf{F} \\, \\mathrm{d}S\n$$\n其中 $\\boldsymbol{n}$ 是外向单位法向量。应用该定理可得：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c \\, \\mathrm{d}\\Omega + \\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\boldsymbol{u}c) \\, \\mathrm{d}S = \\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S - \\int_{\\Omega} \\lambda c \\, \\mathrm{d}\\Omega + \\int_{\\Omega} q_{v} \\, \\mathrm{d}\\Omega\n$$\n重新整理以分离出质量趋势，得到全球质量平衡的一般形式：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c \\, \\mathrm{d}\\Omega = - \\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\boldsymbol{u}c) \\, \\mathrm{d}S + \\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S - \\int_{\\Omega} \\lambda c \\, \\mathrm{d}\\Omega + \\int_{\\Omega} q_{v} \\, \\mathrm{d}\\Omega\n$$\n右侧的各项分别代表由以下因素引起的净质量变化率：跨越边界的平流通量、跨越边界的扩散通量、内部化学耗失和内部体源。\n\n现在，我们必须根据所描述的物理过程来构建边界条件。\n\n**地表边界 $\\Gamma_{s}$：**\n地表的总非平流通量是排放和沉降之和。\n- 排放 $E(\\boldsymbol{x},t)$ 是大气的一个质量源。它代表一个*进入*区域 $\\Omega$ 的通量。由于 $\\boldsymbol{n}$ 是外向法向量，一个向内的通量对应于 $\\boldsymbol{n} \\cdot \\boldsymbol{F}_{\\text{flux}}$ 的负值。\n- 由 $v_{d}(\\boldsymbol{x},t)c$ 参数化的干沉降是一个质量汇。它代表一个*流出*区域 $\\Omega$ 的通量。这对应于 $\\boldsymbol{n} \\cdot \\boldsymbol{F}_{\\text{flux}}$ 的正值。\n\n流出区域的总非平流（模拟为扩散）通量是沉降通量（向外）和排放通量（向内，因此是负的向外通量）之和。流出区域的扩散通量由 $-\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c)$ 给出。因此，边界条件必须是：\n$$\n-\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) = v_d c - E\n$$\n这是一个 Robin 型边界条件。\n\n**顶部边界 $\\Gamma_{t}$：**\n与浓度为 $c_a$ 的外部储库的交换由传输速度 $k_e$ 参数化。\n- 如果区域内浓度 $c$ 大于外部浓度 $c_a$，应该有一个净通量*流出*区域。这个向外通量的大小是 $k_e(c-c_a)$。\n- 如果 $c  c_a$，应该有一个净通量*进入*区域。\n这可以通过将向外通量定义为 $k_e(c-c_a)$ 来体现。将此物理通量与流出区域的扩散通量相等，得到边界条件：\n$$\n-\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) = k_e(c-c_a)\n$$\n对于顶部边界的平流部分，在平流主导的系统中，必须在流入部分指定边界条件，外部信息通过流入部分传播到区域内。流入边界是 $\\boldsymbol{n} \\cdot \\boldsymbol{u}  0$ 的地方。将流入流体的浓度设置为外部储库的浓度，即在 $\\Gamma_t^- = \\{\\boldsymbol{x}\\in \\Gamma_{t}: \\boldsymbol{n}\\cdot \\boldsymbol{u}  0\\}$ 上 $c=c_a$，是物理上合理的。在流出部分（$\\boldsymbol{n} \\cdot \\boldsymbol{u} > 0$）不应指定任何条件，因为那里的浓度由 $\\Omega$ 内的解决定。\n\n现在我们将这些边界条件代入一般的质量平衡方程。边界积分 $\\int_{\\partial \\Omega}$ 被分成在 $\\Gamma_{s}$、$\\Gamma_{t}$ 和 $\\Gamma_{\\ell}$ 上的积分。\n项 $\\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S$ 变为：\n$$\n\\int_{\\Gamma_s} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S + \\int_{\\Gamma_t} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S + \\int_{\\Gamma_\\ell} \\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) \\, \\mathrm{d}S\n$$\n使用边界条件：\n- 在 $\\Gamma_s$ 上： $\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) = -(v_d c - E)$\n- 在 $\\Gamma_t$ 上： $\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) = -k_e(c-c_a)$\n- 在 $\\Gamma_\\ell$ 上： 对于远处的侧边界，一个常见且合理的假设是扩散通量为零，即 $\\boldsymbol{n} \\cdot (\\mathbf{K} \\nabla c) = 0$。\n\n平流通量项 $-\\int_{\\partial \\Omega} \\boldsymbol{n} \\cdot (\\boldsymbol{u}c) \\, \\mathrm{d}S$ 是：\n- 在 $\\Gamma_s$ 上：问题陈述了 $\\boldsymbol{n} \\cdot \\boldsymbol{u} = 0$，所以积分为零。\n- 这只剩下在 $\\Gamma_t \\cup \\Gamma_\\ell$ 上的积分。\n\n综合所有内容，最终的质量平衡方程是：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} c\\, \\mathrm{d}\\Omega = - \\int_{\\Gamma_{\\ell} \\cup \\Gamma_{t}} \\boldsymbol{n}\\cdot (\\boldsymbol{u}\\, c)\\, \\mathrm{d}S - \\int_{\\Gamma_{s}} \\big( v_{d}\\, c - E \\big)\\, \\mathrm{d}S - \\int_{\\Gamma_{t}} k_{e}\\, (\\,c - c_{a}\\,)\\, \\mathrm{d}S - \\int_{\\Omega} \\lambda\\, c\\, \\mathrm{d}\\Omega + \\int_{\\Omega} q_{v}\\, \\mathrm{d}\\Omega\n$$\n\n**2. 选项评估**\n\n**A. 地表：$\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$ 和在 $\\Gamma_{s}$ 上的 Robin 边界条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = v_{d}\\, c - E$。顶部：在 $\\Gamma_{t}$ 上应用 Robin 扩散交换 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = k_{e}\\, (\\,c - c_{a}\\,)$，并且只在流入子集 $\\Gamma_{t}^{-}=\\{\\boldsymbol{x}\\in \\Gamma_{t}: \\boldsymbol{n}\\cdot \\boldsymbol{u}  0\\}$ 上施加 Dirichlet 流入条件 $c=c_{a}$；在流出部分 $\\Gamma_{t}^{+}=\\{\\boldsymbol{x}\\in \\Gamma_{t}: \\boldsymbol{n}\\cdot \\boldsymbol{u} > 0\\}$ 上无平流规定。...**\n在 $\\Gamma_s$ 和 $\\Gamma_t$ 上针对扩散和平流输运提出的边界条件与我们的推导完全吻合。它们在物理上是合理的，在数学上是适定的。得到的全球质量平衡方程也与使用这些边界条件从第一性原理推导出的方程完全一致。所提供的物理释义也是正确的：沉降 $v_{d}c$ 是一个耗失项（对积分的负贡献）；排放 $E$ 是一个增益项（通过 $-(-E)$ 产生正贡献）；当 $c > c_a$ 时，夹带 $k_e(c-c_a)$ 是一个耗失项。\n**结论：正确。**\n\n**B. 地表：$\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$ 和在 $\\Gamma_{s}$ 上的 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = E + v_{d}\\, c$，解释为排放和沉降均为向外通量。...**\n地表边界条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = E + v_{d}\\, c$ 在物理上是不正确的。它将排放 $E$ 视为与沉降 $v_d c$ 方向相同的通量，即一个从大气中移除质量的向外通量。排放是大气的一个源，必须是一个向内的通量。\n**结论：不正确。**\n\n**C. 地表：与 A 中相同。顶部：在 $\\Gamma_{t}$ 上有一个密封盖，满足 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = 0$ 和 $\\boldsymbol{n}\\cdot \\boldsymbol{u} = 0$。...**\n虽然密封盖在某些情况下是一个有效的物理模型，但它与问题陈述相矛盾，问题明确描述了与上层储库的交换：“对流层通过...与一个外部储库...进行交换”。通过将通量设为零，该选项未能模拟指定的物理过程。尽管推导出的质量平衡与其提出的（但不合适的）边界条件是自洽的，但它没有正确地表示问题所述的情况。\n**结论：不正确。**\n\n**D. 地表：与 A 中相同。顶部：在 $\\Gamma_{t}$ 上有反符号的 Robin 条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = k_{e}\\, (\\,c_{a} - c\\,)$，并在流出子集 $\\Gamma_{t}^{+}$ 上施加 $c=c_{a}$，同时不约束流入。...**\n这个选项至少包含两个关键错误。首先，Robin 条件 $-\\boldsymbol{n}\\cdot \\mathbf{K}\\nabla c = k_{e}\\,(c_{a} - c)$ 意味着当 $c > c_a$ 时，通量是向内的，而当 $c  c_a$ 时，通量是向外的。这是一个正反馈，会导致不物理的浓度差异放大，而不是趋向平衡。其次，在流出边界（$\\Gamma_t^+$）上规定 Dirichlet 条件会过度约束问题，在物理和数学上都是不适定的。信息在该边界流出区域；其状态应由区域内部的解决定，而不是被外部强制。\n**结论：不正确。**\n\n**E. 地表：通过在 $\\Gamma_{s}$ 上施加 Dirichlet 条件 $c=0$ 来模拟沉降，使 $c$ 在地面消失；没有显式的通量条件。顶部：在 $\\Gamma_{t}$ 的所有部分（包括流入和流出）施加 $c=c_{a}$。...**\n这个选项在多个方面都有缺陷。地表条件 $c=0$ 代表一个完美的汇，但完全忽略了规定的排放通量 $E(\\boldsymbol{x},t)$，与问题陈述相矛盾。在整个边界 $\\Gamma_t$ （包括流出部分）上施加的顶部条件 $c=c_a$，如选项 D 中所解释的，是一个不适定的过度约束。最后，所提出的省略所有边通量的全球质量平衡是根本错误的。规定的浓度（Dirichlet 条件）并不意味着通量为零；相反，通量必须调整以维持该浓度，并且必须在预算中加以考虑。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "四维变分（4D-Var）等先进的反演方法依赖于高效地计算成本函数相对于控制变量（如初始条件或排放源）的梯度。直接计算和存储雅可比矩阵在实际大气模型中是不可行的，因此我们转而使用切线性和伴随模型。本练习将指导你从第一性原理出发，推导一个典型的化学传输模型的切线性模型及其伴随模型，从而掌握支撑大规模资料同化系统的核心计算方法。",
            "id": "3365830",
            "problem": "考虑一个三维化学物种，其受时变输运-化学模型控制，该模型在空间上通过守恒有限体积格式离散，在时间上通过具有均匀时间步长 $\\Delta t > 0$ 的一阶前向欧拉方法离散。令 $x_{k} \\in \\mathbb{R}^{n}$ 表示在离散时间 $t_{k} = k \\Delta t$（$k = 0, 1, \\dots, K$）的网格平均物种浓度向量。离散的预报更新方程为\n$$\nx_{k+1} \\;=\\; T_{k} \\, x_{k} \\;+\\; \\Delta t \\; c(x_{k}) \\;+\\; s_{k},\n$$\n其中 $T_{k} \\in \\mathbb{R}^{n \\times n}$ 代表由时间 $t_{k}$ 的已知气象场决定的线性输运-混合算子，$c: \\mathbb{R}^{n} \\to \\mathbb{R}^{n}$ 是一个非线性的局地化学倾向项，假设其连续可微且雅可比矩阵是利普希茨连续的，而 $s_{k} \\in \\mathbb{R}^{n}$ 是一个已知的源项（例如，排放和边界通量）。观测在时间子集 $\\{t_{\\ell_{i}}\\}_{i=1}^{m}$（其中 $\\ell_{i} \\in \\{1,\\dots,K\\}$）通过线性观测算子 $H_{i} \\in \\mathbb{R}^{p_{i} \\times n}$ 收集，得到 $y_{i} = H_{i} x_{\\ell_{i}} + \\varepsilon_{i}$，其中 $\\varepsilon_{i}$ 是独立的、零均值的高斯误差，其协方差 $R_{i} \\in \\mathbb{R}^{p_{i} \\times p_{i}}$ 已知。\n\n您的任务是进行初始状态反演。令控制变量为初始条件 $x_{0}$，其具有高斯背景（先验）$x_{b}$ 和协方差 $B \\in \\mathbb{R}^{n \\times n}$（对称正定）。定义非线性观测映射\n$$\n\\mathcal{G}(x_{0}) \\;=\\; \\begin{pmatrix} H_{1} \\, x_{\\ell_{1}}(x_{0}) \\\\ \\vdots \\\\ H_{m} \\, x_{\\ell_{m}}(x_{0}) \\end{pmatrix} \\in \\mathbb{R}^{p}, \\quad p \\;=\\; \\sum_{i=1}^{m} p_{i},\n$$\n其中状态轨迹 $\\{x_{k}(x_{0})\\}_{k=0}^{K}$ 是由上述离散模型以初始条件 $x_{0}$ 生成的。弱约束四维变分数据同化（模型误差固定为已知的 $s_{k}$）的代价函数为\n$$\nJ(x_{0}) \\;=\\; \\tfrac{1}{2} \\, (x_{0} - x_{b})^{\\top} B^{-1} (x_{0} - x_{b}) \\;+\\; \\tfrac{1}{2} \\, \\big(\\mathcal{G}(x_{0}) - y\\big)^{\\top} R^{-1} \\big(\\mathcal{G}(x_{0}) - y\\big),\n$$\n其中 $y = (y_{1}^{\\top}, \\dots, y_{m}^{\\top})^{\\top}$ 且 $R$ 为块对角矩阵 $R = \\mathrm{diag}(R_{1}, \\dots, R_{m})$。\n\n从线性化（一阶泰勒展开）的第一性原理和应用于离散动力系统的链式法则出发，执行以下操作：\n\n1) 推导切线性模型，即围绕由当前迭代 $x_{0}$ 生成的给定参考轨迹 $\\{x_{k}\\}_{k=0}^{K}$ 的扰动 $\\delta x_{k}$ 的线性化动力学。\n\n2) 使用切线性模型，推导任意方向 $v \\in \\mathbb{R}^{n}$ 的雅可比-向量积 $\\mathrm{J}(x_{0}) \\, v$，其中 $\\mathrm{J}(x_{0})$ 是 $\\mathcal{G}$ 关于 $x_{0}$ 的雅可比矩阵，在参考轨迹上求值。您的结果应该是一个以 $\\{T_{k}\\}$、$\\{\\nabla c(x_{k})\\}$、$\\{H_{i}\\}$ 和矩阵乘积表示的闭式解析表达式。\n\n3) 解释如何在迭代高斯-牛顿方法中高效计算 $\\mathrm{J}(x_{0}) \\, v$ 而无需显式构建完整的雅可比矩阵，并简要描述无矩阵克雷洛夫求解器所需的转置-向量积 $\\mathrm{J}(x_{0})^{\\top} w$ 的相应高效计算方法。\n\n以 $\\mathrm{J}(x_{0}) \\, v$ 的单一解析表达式的形式提供最终答案。无需进行数值计算。以符号形式表达您的最终答案，并且不包含任何单位。最终答案必须是单一的闭式表达式。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行严格评估。\n\n### 问题验证\n\n**第 1 步：提取的已知条件**\n- **离散预报模型：** $x_{k+1} = T_{k} x_{k} + \\Delta t c(x_{k}) + s_{k}$，对于 $k = 0, 1, \\dots, K$。\n- **状态向量：** $x_{k} \\in \\mathbb{R}^{n}$，在时间 $t_{k} = k \\Delta t$。\n- **时间步长：** $\\Delta t > 0$。\n- **输运算子：** $T_{k} \\in \\mathbb{R}^{n \\times n}$，线性的。\n- **化学倾向项：** $c: \\mathbb{R}^{n} \\to \\mathbb{R}^{n}$，非线性的，连续可微且雅可比矩阵是利普希茨连续的。\n- **源项：** $s_{k} \\in \\mathbb{R}^{n}$，已知的。\n- **观测：** $y_{i} = H_{i} x_{\\ell_{i}} + \\varepsilon_{i}$，在时间 $\\{t_{\\ell_{i}}\\}_{i=1}^{m}$，其中 $\\ell_{i} \\in \\{1,\\dots,K\\}$。\n- **观测算子：** $H_{i} \\in \\mathbb{R}^{p_{i} \\times n}$，线性的。\n- **观测误差：** $\\varepsilon_{i}$ 是独立的、零均值的高斯分布，协方差为 $R_{i} \\in \\mathbb{R}^{p_{i} \\times p_{i}}$。\n- **控制变量：** 初始条件 $x_{0} \\in \\mathbb{R}^{n}$。\n- **背景信息：** 先验估计 $x_{b}$，协方差为 $B \\in \\mathbb{R}^{n \\times n}$，对称正定。\n- **非线性观测映射：** $\\mathcal{G}(x_{0}) = (H_{1} x_{\\ell_{1}}(x_{0})^{\\top}, \\dots, H_{m} x_{\\ell_{m}}(x_{0})^{\\top})^{\\top}$。\n- **代价函数：** $J(x_{0}) = \\frac{1}{2} (x_{0} - x_{b})^{\\top} B^{-1} (x_{0} - x_{b}) + \\frac{1}{2} (\\mathcal{G}(x_{0}) - y)^{\\top} R^{-1} (\\mathcal{G}(x_{0}) - y)$。\n\n**第 2 步：使用提取的已知条件进行验证**\n根据验证标准对问题进行评估。\n- **科学依据：** 该问题描述了应用于大气化学输运模型的四维变分数据同化（4D-Var）的标准框架。这是地球物理科学、反问题和数值优化领域中一个已广为确立的基础课题。所有组成部分——离散模型、观测过程和贝叶斯代价函数——都是标准的且在科学上是合理的。\n- **适定的：** 该问题要求进行特定的数学推导（切线性模型、雅可比-向量积）和算法解释。假设（例如 $c(x)$ 的连续可微性）确保了所需的线性化是定义明确的。任务是精确的，并能得出唯一的解析表达式和算法描述。\n- **客观性：** 该问题以客观的数学语言表述，没有歧义或主观断言。\n- **完整性与一致性：** 该问题提供了执行所需推导所需的自洽和完整的描述。虽然问题标题提到了“弱约束”4D-Var，但所提供的代价函数对应于“强约束”提法，其中模型动力学被假定为是完美的。这是一个微小的术语不一致，但不影响数学有效性，因为任务是分析明确给出的方程。该提法是明确的。\n\n**第 3 步：结论与行动**\n该问题被判定为 **有效**。这是一个在数据同化领域中严谨、科学上合理且适定的问题。现在将开始求解过程。\n\n### 解答\n\n解答按要求分为三部分呈现。首先推导切线性模型，然后是雅可比-向量积，最后解释高效的计算方法。\n\n**1) 切线性模型的推导**\n\n切线性模型（TLM）描述了对状态向量的微小扰动的演化。设 $\\{x_{k}\\}_{k=0}^{K}$ 是从初始条件 $x_{0}$ 开始由非线性模型生成的参考状态轨迹：\n$$\nx_{k+1} = T_{k} x_{k} + \\Delta t c(x_{k}) + s_{k}\n$$\n考虑一个扰动的初始条件 $x'_{0} = x_{0} + \\delta x_{0}$，它生成一个扰动轨迹 $\\{x'_{k}\\}_{k=0}^{K}$：\n$$\nx'_{k+1} = T_{k} x'_{k} + \\Delta t c(x'_{k}) + s_{k}\n$$\n令时间 $t_{k}$ 的扰动为 $\\delta x_{k} = x'_{k} - x_{k}$。从扰动模型的方程中减去参考模型的方程，得到精确扰动的演化：\n$$\nx'_{k+1} - x_{k+1} = T_{k} (x'_{k} - x_{k}) + \\Delta t (c(x'_{k}) - c(x_{k}))\n$$\n$$\n\\delta x_{k+1} = T_{k} \\delta x_{k} + \\Delta t (c(x_{k} + \\delta x_{k}) - c(x_{k}))\n$$\n对于一个微小的扰动 $\\delta x_{k}$，我们可以使用围绕参考状态 $x_{k}$ 的一阶泰勒展开来线性化非线性化学项 $c(x_{k} + \\delta x_{k})$。由于 $c$ 是连续可微的，其雅可比矩阵（记为 $\\nabla c(x_{k}) \\in \\mathbb{R}^{n \\times n}$）存在。\n$$\nc(x_{k} + \\delta x_{k}) \\approx c(x_{k}) + \\nabla c(x_{k}) \\delta x_{k}\n$$\n将此近似代入扰动演化方程，得到：\n$$\n\\delta x_{k+1} \\approx T_{k} \\delta x_{k} + \\Delta t (\\nabla c(x_{k}) \\delta x_{k})\n$$\n这给出了切线性模型：\n$$\n\\delta x_{k+1} = (T_{k} + \\Delta t \\nabla c(x_{k})) \\delta x_{k}\n$$\n我们定义切线性传播子或模型矩阵 $M_{k} \\in \\mathbb{R}^{n \\times n}$ 为：\n$$\nM_{k} = T_{k} + \\Delta t \\nabla c(x_{k})\n$$\n于是，TLM 是控制扰动一阶演化的线性、时变离散系统：\n$$\n\\delta x_{k+1} = M_{k} \\delta x_{k}\n$$\n该模型在时间 $t_{0}$ 以扰动 $\\delta x_{0}$ 初始化。\n\n**2) 雅可比-向量积 $\\mathrm{J}(x_{0}) \\, v$ 的推导**\n\n非线性观测映射 $\\mathcal{G}(x_{0})$ 关于初始状态 $x_{0}$ 的雅可比矩阵记为 $\\mathrm{J}(x_{0}) = \\frac{\\partial \\mathcal{G}}{\\partial x_{0}}$。对于任意方向 $v \\in \\mathbb{R}^{n}$ 的雅可比-向量积 $\\mathrm{J}(x_{0}) v$ 是 $\\mathcal{G}$ 在 $x_{0}$ 处沿方向 $v$ 的方向导数。这对应于对初始状态 $x_{0}$ 施加扰动 $v$ 所引起的模型预测观测 $\\mathcal{G}(x_{0})$ 的一阶变化。\n\n这种扰动的演化由第 1 部分推导的切线性模型控制。我们设初始扰动为 $\\delta x_{0} = v$。任何后续时间 $t_{k}$ 的扰动可以通过递归地应用 TLM 传播子找到：\n$$\n\\delta x_{1} = M_{0} \\delta x_{0}\n$$\n$$\n\\delta x_{2} = M_{1} \\delta x_{1} = M_{1} M_{0} \\delta x_{0}\n$$\n通常，在时间 $t_{k}$ 的扰动由下式给出：\n$$\n\\delta x_{k} = (M_{k-1} M_{k-2} \\cdots M_{0}) \\delta x_{0} = \\left( \\prod_{j=0}^{k-1} M_{j} \\right) \\delta x_{0}\n$$\n这里，乘积符号 $\\prod_{j=0}^{k-1} M_{j}$ 表示矩阵乘积 $M_{k-1} M_{k-2} \\cdots M_{0}$。\n\n非线性观测映射为 $\\mathcal{G}(x_{0}) = (H_{1} x_{\\ell_{1}}(x_{0})^{\\top}, \\dots, H_{m} x_{\\ell_{m}}(x_{0})^{\\top})^{\\top}$。由于观测算子 $H_{i}$ 是线性的，$\\mathcal{G}$ 输出的一阶扰动是通过将 $H_{i}$ 应用于状态扰动 $\\delta x_{\\ell_{i}}$ 得到的：\n$$\n\\mathrm{J}(x_{0}) v = \\delta \\mathcal{G} = \\begin{pmatrix} H_{1} \\delta x_{\\ell_{1}} \\\\ \\vdots \\\\ H_{m} \\delta x_{\\ell_{m}} \\end{pmatrix}\n$$\n将 $\\delta x_{k}$ 的表达式与 $\\delta x_{0} = v$ 代入，我们得到每个观测时间 $t_{\\ell_{i}}$ 的扰动：\n$$\n\\delta x_{\\ell_{i}} = \\left( \\prod_{j=0}^{\\ell_{i}-1} M_{j} \\right) v\n$$\n因此，雅可比-向量积由下式给出：\n$$\n\\mathrm{J}(x_{0}) v = \\begin{pmatrix} H_{1} \\left( \\prod_{j=0}^{\\ell_{1}-1} M_{j} \\right) v \\\\ \\vdots \\\\ H_{m} \\left( \\prod_{j=0}^{\\ell_{m}-1} M_{j} \\right) v \\end{pmatrix}\n$$\n代入 $M_{j}$ 的定义，得到最终的解析表达式：\n$$\n\\mathrm{J}(x_{0}) v = \\begin{pmatrix} H_{1} \\left( \\prod_{j=0}^{\\ell_{1}-1} [T_{j} + \\Delta t \\nabla c(x_{j})] \\right) v \\\\ \\vdots \\\\ H_{m} \\left( \\prod_{j=0}^{\\ell_{m}-1} [T_{j} + \\Delta t \\nabla c(x_{j})] \\right) v \\end{pmatrix}\n$$\n\n**3) $\\mathrm{J}(x_{0}) v$ 和 $\\mathrm{J}(x_{0})^{\\top} w$ 的高效计算**\n\n大多数用于大规模数据同化的优化算法，如高斯-牛顿或拟牛顿方法，都需要计算雅可比-向量积和雅可比转置-向量积。显式地构建稠密的雅可比矩阵 $\\mathrm{J}(x_{0})$ 在计算上是不可行的。因此，采用无矩阵方法。\n\n**$\\mathrm{J}(x_{0}) v$ 的高效计算（切线性模型运行）：**\n上面推导的 $\\mathrm{J}(x_{0}) v$ 表达式暗示了一种高效的序贯算法。我们不构建大型矩阵乘积，而是使用 TLM 将扰动向量 $v$ 在时间上向前传播。\n\n算法如下：\n1. 必须从初始状态 $x_{0}$ 计算并存储参考轨迹 $\\{x_{k}\\}_{k=0}^{K}$，或动态地重新计算。这是评估化学项的雅可比矩阵 $\\nabla c(x_{k})$ 所必需的。\n2. 初始化扰动向量：$\\delta x = v$。\n3. 初始化一个空的输出结果向量。\n4. 从 $k=0$ 到 $K-1$ 在时间上向前迭代：\n    a. 如果 $t_{k+1}$ 是一个观测时间，即对某个 $i$ 有 $k+1 = \\ell_{i}$，计算观测到的扰动 $H_{i} \\delta x_{\\ell_{i}}$（其中 $\\delta x_{\\ell_{i}}$ 是扰动的当前状态）并存储它。然而，更常见的做法是先传播，然后观测。因此，将循环结构化为从 $k=0$ 到 $K$，并在时间 $k$ 检查观测会更好。\n    修订后的循环：\n    1. 初始化 $\\delta x_0 = v$。\n    2. 循环 $k=1, \\dots, K$：\n       a. $\\delta x_k = M_{k-1} \\delta x_{k-1} = (T_{k-1} + \\Delta t \\nabla c(x_{k-1})) \\delta x_{k-1}$。\n       b. 如果 $k \\in \\{\\ell_1, \\dots, \\ell_m\\}$，找到对应的索引 $i$ 使得 $k=\\ell_i$。计算 $z_i = H_i \\delta x_k$。\n    3. 将得到的结果向量 $z_i$ 组合成最终向量 $\\mathrm{J}(x_{0}) v$。\n\n这个过程被称为 TLM 运行，其计算成本与完整非线性模型的一次运行相当，前提是计算 $\\nabla c(x_k)$ 和执行矩阵-向量乘积的成本是可控的。\n\n**$\\mathrm{J}(x_{0})^{\\top} w$ 的高效计算（伴随模型运行）：**\n代价函数 $J(x_{0})$ 的梯度需要项 $\\mathrm{J}(x_{0})^{\\top} R^{-1} (\\mathcal{G}(x_{0}) - y)$。这需要计算雅可比转置-向量积 $\\mathrm{J}(x_{0})^{\\top} w$，其中 $w = R^{-1}(\\mathcal{G}(x_{0}) - y)$。\n\n$\\mathrm{J}(x_{0})^{\\top}$ 的结构涉及矩阵乘积的转置，这会颠倒它们的顺序：$(\\prod_{j=0}^{k-1} M_{j})^{\\top} = M_{0}^{\\top} M_{1}^{\\top} \\cdots M_{k-1}^{\\top}$。这暗示了一个在时间上向后积分的算法。这就是伴随模型。\n\n计算 $u = \\mathrm{J}(x_{0})^{\\top} w$ 的算法，其中 $w = (w_{1}^{\\top}, \\dots, w_{m}^{\\top})^{\\top}$：\n1. 与 TLM 运行一样，需要参考轨迹 $\\{x_{k}\\}$。\n2. 初始化一个伴随状态向量 $\\lambda_{K} = 0 \\in \\mathbb{R}^{n}$。\n3. 从 $k = K-1$ 向下到 $0$ 在时间上向后迭代：\n    a. 将伴随状态向后传播一步：$\\lambda_{k} = M_{k}^{\\top} \\lambda_{k+1} = (T_{k}^{\\top} + \\Delta t \\nabla c(x_{k})^{\\top}) \\lambda_{k+1}$。\n    b. 检查时间步 $k+1$ 是否为观测时间。如果对某个 $i$ 有 $k+1 = \\ell_{i}$，则从观测残差向量 $w$ 中添加相应的强迫项：$\\lambda_{k+1} \\rightarrow \\lambda_{k+1} + H_i^{\\top} w_i$。这个强迫项必须在计算 $M_{k}^{\\top} \\lambda_{k+1}$ 之前应用于 $\\lambda_{k+1}$。一个更精确的循环表述是：\n       1. 初始化 $\\lambda_{K} = 0$。\n       2. 从 $k=K-1$ 向下循环到 0：\n          $\\lambda_{k} = M_{k}^{\\top} \\lambda_{k+1}$。\n          如果 $k \\in \\{\\ell_1, \\dots, \\ell_m\\}$，找到索引 $i$ 使得 $k=\\ell_i$，并更新：$\\lambda_{k} \\leftarrow \\lambda_{k} + H_i^{\\top} w_i$。\n       这看起来有些偏差。通过拉格朗日方法或直接检视进行更严格的推导表明，正确的更新是：\n       1. 初始化伴随状态 $\\lambda = 0 \\in \\mathbb{R}^n$。\n       2. 从 $k=K$ 向后循环到 1：\n          a. 如果 $k$ 是一个观测时间，即 $k=\\ell_i$，添加强迫项：$\\lambda \\leftarrow \\lambda + H_i^{\\top}w_i$。\n          b. 向后传播：$\\lambda \\leftarrow M_{k-1}^{\\top}\\lambda = (T_{k-1}^{\\top} + \\Delta t \\nabla c(x_{k-1})^{\\top})\\lambda$。\n4. 循环完成后最终的向量 $\\lambda$ 即为结果 $u=\\lambda_0 = \\mathrm{J}(x_0)^{\\top}w$。\n\n这次伴随模型运行计算转置-向量积的成本也与单次非线性模型运行相当。高效计算代价函数梯度（或更一般地，$\\mathrm{J}^{\\top}w$ 积）的能力是实用 4D-Var 的基石。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nH_{1} \\left( \\prod_{j=0}^{\\ell_{1}-1} \\left[ T_{j} + \\Delta t \\nabla c(x_{j}) \\right] \\right) v \\\\\n\\vdots \\\\\nH_{m} \\left( \\prod_{j=0}^{\\ell_{m}-1} \\left[ T_{j} + \\Delta t \\nabla c(x_{j}) \\right] \\right) v\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在大气反演中，我们优化的许多参数，例如污染物排放通量，具有明确的物理约束——它们不能为负值。将这种不等式约束纳入优化过程对于获得物理上真实的结果至关重要。本练习通过一个简化的反演问题，探讨了两种实现非负约束的经典方法：对数障碍法和投影梯度法，并要求你通过一个具体的数值案例来应用这些理论。",
            "id": "3365849",
            "problem": "考虑一个针对非负排放通量的单网格大气化学传输反演问题，其中观测算子是线性的。令 $x \\in \\mathbb{R}$ 表示该网格单元的排放通量，令 $y \\in \\mathbb{R}$ 表示单个观测值，该观测值通过标量传输灵敏度 $h \\in \\mathbb{R}$ 线性依赖于 $x$。假设存在方差为 $r > 0$ 的加性高斯测量误差 $\\varepsilon$，即 $y = h\\,x + \\varepsilon$，并且对 $x$ 有一个均值为 $x_b$、方差为 $b > 0$ 的高斯先验。需要在物理不等式约束 $x \\ge 0$ 下，求解最大后验 (MAP) 估计。\n\n从贝叶斯定理和所述的高斯假设出发，推导无约束的最大后验目标函数，该函数是数据失配项和先验正则化项之和。然后，论证并推导两种施加不等式约束 $x \\ge 0$ 的方法：\n\n1. 对数障碍法，通过在目标函数中增加一个障碍项来强制 $x > 0$。\n2. 使用 Karush–Kuhn–Tucker (KKT) 条件的投影梯度法，其中梯度被投影到可行集 $x \\ge 0$ 上。\n\n对于每种方法，推导适用于该约束问题的修正后的一阶最优性条件。解释这些条件对于约束后的 MAP 解的平稳性和可行性意味着什么，以及它们如何与大气化学传输反演中非负排放的物理原理相关联。\n\n最后，对于对数障碍法公式，考虑以下具体的标量配置：\n- 传输灵敏度 $h = 0.6$，\n- 观测值 $y = 3.0$，\n- 测量误差方差 $r = 0.25$，\n- 先验均值 $x_b = 2.0$，\n- 先验方差 $b = 1.0$，\n- 对数障碍参数 $\\mu = 0.1$。\n\n使用推导出的障碍法一阶最优性条件，计算此配置下障碍增广目标函数的唯一正平稳点 $x^\\star(\\mu)$。用单位 $\\mathrm{kmol\\ s^{-1}}$ 表示你最终的排放通量答案，并将结果四舍五入到四位有效数字。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它代表了大气科学中一个标准的、尽管是简化的约束反演问题的公式。为求得唯一解，所有必要信息均已提供。\n\n目标是在非负约束 $x \\ge 0$ 下，找到单网格排放通量 $x \\in \\mathbb{R}$ 的最大后验 (MAP) 估计。该估计基于线性观测模型、高斯误差统计以及通量的高斯先验。\n\n首先，我们从贝叶斯定理推导无约束的最大后验目标函数。给定观测值 $y$ 时状态 $x$ 的后验概率分布由贝叶斯定理给出：\n$$\nP(x|y) \\propto P(y|x)P(x)\n$$\n其中 $P(y|x)$ 是似然函数，$P(x)$ 是先验概率分布。\n\n观测模型为 $y = hx + \\varepsilon$，其中测量误差 $\\varepsilon$ 服从零均值、方差为 $r > 0$ 的高斯分布，即 $\\varepsilon \\sim \\mathcal{N}(0, r)$。因此，给定状态 $x$ 时观测到 $y$ 的似然函数为：\n$$\nP(y|x) = \\frac{1}{\\sqrt{2\\pi r}} \\exp\\left(-\\frac{(y - hx)^2}{2r}\\right)\n$$\n排放通量 $x$ 的先验分布是均值为 $x_b$、方差为 $b > 0$ 的高斯分布，即 $x \\sim \\mathcal{N}(x_b, b)$。其先验概率分布为：\n$$\nP(x) = \\frac{1}{\\sqrt{2\\pi b}} \\exp\\left(-\\frac{(x - x_b)^2}{2b}\\right)\n$$\n将这些代入贝叶斯定理，后验分布为：\n$$\nP(x|y) \\propto \\exp\\left(-\\left[\\frac{(y - hx)^2}{2r} + \\frac{(x - x_b)^2}{2b}\\right]\\right)\n$$\n$x$ 的 MAP 估计是使该后验概率 $P(x|y)$ 最大化的值。这等价于最小化后验概率的负对数。我们定义目标函数 $J(x)$ 为后验概率负对数的两倍，并省略常数项：\n$$\nJ(x) = \\frac{(hx-y)^2}{r} + \\frac{(x-x_b)^2}{b}\n$$\n习惯上，会包含一个 $1/2$ 的因子，从而得到：\n$$\nJ(x) = \\frac{1}{2r}(hx - y)^2 + \\frac{1}{2b}(x - x_b)^2\n$$\n这就是无约束的最大后验目标函数。第一项 $\\frac{1}{2r}(hx - y)^2$ 是数据失配项，它惩罚模型预测值 $hx$ 与观测值 $y$ 之间的偏差，并由测量误差方差 $r$ 的倒数加权。第二项 $\\frac{1}{2b}(x - x_b)^2$ 是先验（或背景）正则化项，它惩罚解 $x$ 与先验估计值 $x_b$ 之间的偏差，并由先验方差 $b$ 的倒数加权。\n\n接下来，我们使用两种不同的方法来施加物理约束 $x \\ge 0$。\n\n**1. 对数障碍法**\n\n此方法通过向目标函数中添加一个障碍项来强制施加更严格的约束 $x > 0$，该障碍项会惩罚接近边界 $x=0$ 的解。增广目标函数 $J_\\mu(x)$ 包含障碍项 $-\\mu \\ln(x)$，其中 $\\mu > 0$ 是障碍参数：\n$$\nJ_\\mu(x) = J(x) - \\mu \\ln(x) = \\frac{1}{2r}(hx - y)^2 + \\frac{(x-x_b)^2}{2b} - \\mu \\ln(x)\n$$\n该增广目标函数的平稳点可以通过将其对 $x$ 的一阶导数设为零来找到。无约束目标函数 $J(x)$ 的导数为：\n$$\n\\frac{dJ}{dx} = \\frac{1}{r}(hx-y)h + \\frac{1}{b}(x-x_b) = \\left(\\frac{h^2}{r} + \\frac{1}{b}\\right)x - \\left(\\frac{hy}{r} + \\frac{x_b}{b}\\right)\n$$\n障碍增广问题的一阶最优性条件是 $\\frac{dJ_\\mu}{dx} = 0$：\n$$\n\\frac{dJ_\\mu}{dx} = \\frac{dJ}{dx} - \\frac{\\mu}{x} = 0\n$$\n代入 $\\frac{dJ}{dx}$ 的表达式，我们得到：\n$$\n\\left(\\frac{h^2}{r} + \\frac{1}{b}\\right)x - \\left(\\frac{hy}{r} + \\frac{x_b}{b}\\right) - \\frac{\\mu}{x} = 0\n$$\n这就是对数障碍法的修正后的一阶最优性条件。该方程的解 $x^\\star(\\mu)$ 保证为正，因为当 $x \\to 0^+$ 时，项 $-\\mu \\ln(x)$ 趋近于 $+\\infty$，从而在边界上有效地创建了一个无限的势垒。在物理上，这个势垒起到一种排斥力的作用，防止排放估计值变为非物理的（零或负）。通过递减 $\\mu \\to 0^+$ 的一系列解，可以逼近真实的约束最小值。\n\n**2. 使用 Karush–Kuhn–Tucker (KKT) 条件的投影梯度法**\n\n这种方法直接处理约束优化问题 $\\min J(x)$，约束条件为 $g(x) = -x \\le 0$。Karush–Kuhn–Tucker (KKT) 条件为最优性提供了必要条件。拉格朗日函数为 $\\mathcal{L}(x, \\lambda) = J(x) + \\lambda g(x) = J(x) - \\lambda x$，其中 $\\lambda$ 是拉格朗日乘子。对于解 $x^\\star$，KKT 条件如下：\n1.  **平稳性 (Stationarity)**：$\\nabla_x \\mathcal{L}(x^\\star, \\lambda) = \\frac{dJ}{dx}\\bigg|_{x=x^\\star} - \\lambda = 0 \\implies \\lambda = \\frac{dJ}{dx}\\bigg|_{x=x^\\star}$\n2.  **原始可行性 (Primal Feasibility)**：$x^\\star \\ge 0$\n3.  **对偶可行性 (Dual Feasibility)**：$\\lambda \\ge 0$\n4.  **互补松弛性 (Complementary Slackness)**：$\\lambda x^\\star = 0$\n\n综合这些条件，最优解 $x^\\star$ 有两种不同的情况：\n-   情况 A：如果 $x^\\star > 0$，互补松弛性要求 $\\lambda=0$。根据平稳性条件，这意味着 $\\frac{dJ}{dx}\\big|_{x=x^\\star} = 0$。这说明 $J(x)$ 的无约束最小值已经位于可行域内。\n-   情况 B：如果 $x^\\star = 0$，互补松弛性得到满足。原始可行性也满足。根据平稳性和对偶可行性，我们必须有 $\\lambda = \\frac{dJ}{dx}\\big|_{x=0} \\ge 0$。\n\n令 $x_{unc}$ 为通过求解 $\\frac{dJ}{dx} = 0$ 找到的无约束极小值点。根据导数的表达式，$x_{unc} = \\left(\\frac{hy}{r} + \\frac{x_b}{b}\\right) / \\left(\\frac{h^2}{r} + \\frac{1}{b}\\right)$。KKT 条件可以总结为：\n$$\nx^\\star = \\begin{cases} x_{unc},   \\text{若 } x_{unc} \\ge 0 \\\\ 0,   \\text{若 } x_{unc}  0 \\end{cases}\n$$\n这等价于将无约束解投影到可行集上，即 $x^\\star = \\max(0, x_{unc})$。投影梯度法迭代地使用这个思想。一阶最优性条件是解是投影算子的不动点，可以表示为 $x^\\star = P_{[0, \\infty)}(x^\\star - \\alpha \\nabla J(x^\\star))$，对于任意步长 $\\alpha > 0$，其中 $P_{[0, \\infty)}(z) = \\max(0, z)$。\n在物理上，这种方法有一个清晰的解释。如果观测证据和先验知识（$x_{unc}$）的组合指向一个物理上合理的正排放值，那么就接受该值。如果它指向一个非物理的负排放值，则将估计值截断为最合理的物理值，即零，这承认了一个硬性的物理限制。\n\n**对数障碍法的数值计算**\n\n给定以下配置：\n-   $h = 0.6$\n-   $y = 3.0$\n-   $r = 0.25$\n-   $x_b = 2.0$\n-   $b = 1.0$\n-   $\\mu = 0.1$\n\n假设数值采用一套一致的单位，使得最终的通量 $x$ 的单位为 $\\mathrm{kmol\\ s^{-1}}$。\n\n我们使用推导出的对数障碍法的一阶最优性条件：\n$$\n\\left(\\frac{h^2}{r} + \\frac{1}{b}\\right)x - \\left(\\frac{hy}{r} + \\frac{x_b}{b}\\right) - \\frac{\\mu}{x} = 0\n$$\n首先，我们计算系数：\n$$\n\\frac{h^2}{r} = \\frac{0.6^2}{0.25} = \\frac{0.36}{0.25} = 1.44\n$$\n$$\n\\frac{1}{b} = \\frac{1}{1.0} = 1.0\n$$\n$$\n\\frac{hy}{r} = \\frac{0.6 \\times 3.0}{0.25} = \\frac{1.8}{0.25} = 7.2\n$$\n$$\n\\frac{x_b}{b} = \\frac{2.0}{1.0} = 2.0\n$$\n将这些值以及 $\\mu=0.1$ 代入最优性条件，得到：\n$$\n(1.44 + 1.0)x - (7.2 + 2.0) - \\frac{0.1}{x} = 0\n$$\n$$\n2.44x - 9.2 - \\frac{0.1}{x} = 0\n$$\n为了找到正平稳点 $x^\\star(\\mu)$，我们方程两边乘以 $x$（因为 $x > 0$），得到一个二次方程：\n$$\n2.44x^2 - 9.2x - 0.1 = 0\n$$\n我们使用二次方程求根公式 $x = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A}$ 求解此方程，其中 $A = 2.44$，$B = -9.2$，$C = -0.1$。\n$$\nx = \\frac{9.2 \\pm \\sqrt{(-9.2)^2 - 4(2.44)(-0.1)}}{2(2.44)}\n$$\n$$\nx = \\frac{9.2 \\pm \\sqrt{84.64 + 0.976}}{4.88}\n$$\n$$\nx = \\frac{9.2 \\pm \\sqrt{85.616}}{4.88}\n$$\n$$\nx \\approx \\frac{9.2 \\pm 9.25289}{4.88}\n$$\n我们寻找的是正解（$x > 0$），所以我们必须取正根：\n$$\nx^\\star(\\mu) \\approx \\frac{9.2 + 9.25289}{4.88} = \\frac{18.45289}{4.88} \\approx 3.78133\n$$\n题目要求将结果四舍五入到四位有效数字。\n$$\nx^\\star(\\mu) \\approx 3.781\n$$",
            "answer": "$$\\boxed{3.781}$$"
        }
    ]
}