{
    "hands_on_practices": [
        {
            "introduction": "在深入研究高级方法之前，理解标准蒙特卡洛方法的成本和局限性至关重要。第一个练习要求您计算单层估计器达到给定精度所需的样本数量，从而巩固样本量、方差和误差之间的基本关系。通过这个计算 ，您将直接体会到为何 $O(\\varepsilon^{-2})$ 的成本缩放使得高精度估计的计算量异常庞大，进而理解方差缩减技术为何如此重要。",
            "id": "3405131",
            "problem": "考虑一个贝叶斯逆问题，其中未知参数 $U$ 是根据数据通过一个适定的似然和先验推断出来的，从而得到后验分布 $\\pi$。设 $\\varphi(U)$ 是一个平方可积的目标量，并将其后验期望表示为 $\\mu=\\mathbb{E}_{\\pi}[\\varphi(U)]$。您计划使用基于从 $\\pi$ 中抽取的 $N$ 个独立同分布样本 $U^{(i)}\\sim \\pi$ 的单层蒙特卡罗估计器来估计 $\\mu$，即 $\\hat{\\mu}_{N}=\\frac{1}{N}\\sum_{i=1}^{N}\\varphi\\!\\left(U^{(i)}\\right)$。假设如下：\n- 已知被积函数的后验方差为 $\\operatorname{Var}_{\\pi}[\\varphi(U)]=\\sigma^{2}=4$。\n- 在所选分辨率下，正向模型的离散化误差可以忽略不计，因此蒙特卡罗估计器相对于 $\\mu$ 是有效无偏的。\n- 每个样本的计算成本为单位成本，因此总成本等于样本数量 $N$。\n\n仅使用独立平均值的均方误差和方差的定义，确定所需的最小样本量 $N$，以确保均方误差满足 $\\mathbb{E}\\!\\left[(\\hat{\\mu}_{N}-\\mu)^{2}\\right]\\le \\varepsilon^{2}$，容差 $\\varepsilon=0.01$。然后，在单位成本模型下计算相关的总计算成本。将最小 $N$（无量纲计数）和成本（以单位成本计数）都报告为无舍入的精确整数。",
            "solution": "问题陈述的验证如下。\n\n**第1步：提取已知条件**\n- 待估计的量是后验期望 $\\mu=\\mathbb{E}_{\\pi}[\\varphi(U)]$。\n- 估计器是单层蒙特卡罗估计器 $\\hat{\\mu}_{N}=\\frac{1}{N}\\sum_{i=1}^{N}\\varphi\\!\\left(U^{(i)}\\right)$，其中 $\\{U^{(i)}\\}_{i=1}^{N}$ 是从后验分布 $\\pi$ 中抽取的独立同分布（i.i.d.）样本。\n- 目标量的后验方差给定为 $\\operatorname{Var}_{\\pi}[\\varphi(U)] = \\sigma^{2} = 4$。\n- 假设估计器 $\\hat{\\mu}_{N}$ 相对于 $\\mu$ 是无偏的。\n- 一个样本的计算成本为 $1$，因此总成本为 $N$。\n- 均方误差（MSE）的目标是 $\\mathbb{E}\\!\\left[(\\hat{\\mu}_{N}-\\mu)^{2}\\right]\\le \\varepsilon^{2}$。\n- 容差指定为 $\\varepsilon=0.01$。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于蒙特卡罗估计和误差分析的基本原理，这些是计算统计学和逆问题数值方法中的标准内容。所有概念都是公认的。\n- **适定性：** 问题提供了所有必要信息，并要求根据明确的标准确定一个唯一可确定的量（最小样本量）。其结构逻辑清晰，可导出一个单一、稳定的解。\n- **客观性：** 问题以精确的数学语言陈述，没有歧义或主观论断。\n\n**第3步：结论与行动**\n该问题是有效的。现在提供完整解答。\n\n估计器 $\\hat{\\mu}_{N}$ 相对于真值 $\\mu$ 的均方误差（MSE）定义为 $\\mathbb{E}\\!\\left[(\\hat{\\mu}_{N}-\\mu)^{2}\\right]$。MSE可以分解为估计器偏差的平方和估计器的方差：\n$$\n\\text{MSE} = \\mathbb{E}\\!\\left[(\\hat{\\mu}_{N}-\\mu)^{2}\\right] = \\left(\\mathbb{E}[\\hat{\\mu}_{N}]-\\mu\\right)^{2} + \\operatorname{Var}(\\hat{\\mu}_{N})\n$$\n\n首先，我们确定估计器的偏差。$\\hat{\\mu}_{N}$ 的期望值为：\n$$\n\\mathbb{E}[\\hat{\\mu}_{N}] = \\mathbb{E}\\left[\\frac{1}{N}\\sum_{i=1}^{N}\\varphi(U^{(i)})\\right]\n$$\n根据期望的线性性质，上式变为：\n$$\n\\mathbb{E}[\\hat{\\mu}_{N}] = \\frac{1}{N}\\sum_{i=1}^{N}\\mathbb{E}[\\varphi(U^{(i)})]\n$$\n由于每个样本 $U^{(i)}$ 都是从后验分布 $\\pi$ 中抽取的，因此 $\\varphi(U^{(i)})$ 的期望是后验均值 $\\mu$：\n$$\n\\mathbb{E}[\\varphi(U^{(i)})] = \\mathbb{E}_{\\pi}[\\varphi(U)] = \\mu \\quad \\text{for all } i \\in \\{1, \\dots, N\\}\n$$\n将其代回，我们得到：\n$$\n\\mathbb{E}[\\hat{\\mu}_{N}] = \\frac{1}{N}\\sum_{i=1}^{N}\\mu = \\frac{1}{N}(N\\mu) = \\mu\n$$\n因此，估计器的偏差为 $\\mathbb{E}[\\hat{\\mu}_{N}]-\\mu = \\mu-\\mu = 0$。这证实了问题陈述中估计器可被视为无偏的说法。\n\n当偏差为零时，MSE等于估计器的方差：\n$$\n\\mathbb{E}\\!\\left[(\\hat{\\mu}_{N}-\\mu)^{2}\\right] = \\operatorname{Var}(\\hat{\\mu}_{N})\n$$\n接下来，我们计算估计器 $\\hat{\\mu}_{N}$ 的方差：\n$$\n\\operatorname{Var}(\\hat{\\mu}_{N}) = \\operatorname{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N}\\varphi(U^{(i)})\\right)\n$$\n使用性质 $\\operatorname{Var}(aX) = a^{2}\\operatorname{Var}(X)$，我们有：\n$$\n\\operatorname{Var}(\\hat{\\mu}_{N}) = \\frac{1}{N^{2}}\\operatorname{Var}\\left(\\sum_{i=1}^{N}\\varphi(U^{(i)})\\right)\n$$\n由于样本 $U^{(i)}$ 是独立的，随机变量 $\\varphi(U^{(i)})$ 也是独立的。对于独立随机变量之和，其和的方差等于方差之和：\n$$\n\\operatorname{Var}\\left(\\sum_{i=1}^{N}\\varphi(U^{(i)})\\right) = \\sum_{i=1}^{N}\\operatorname{Var}(\\varphi(U^{(i)}))\n$$\n由于样本也是同分布的，每一项 $\\varphi(U^{(i)})$ 的方差都相同，且等于后验方差 $\\sigma^2$：\n$$\n\\operatorname{Var}(\\varphi(U^{(i)})) = \\operatorname{Var}_{\\pi}[\\varphi(U)] = \\sigma^{2} \\quad \\text{for all } i\n$$\n因此，方差之和为：\n$$\n\\sum_{i=1}^{N}\\operatorname{Var}(\\varphi(U^{(i)})) = \\sum_{i=1}^{N}\\sigma^{2} = N\\sigma^{2}\n$$\n将此结果代回 $\\operatorname{Var}(\\hat{\\mu}_{N})$ 的表达式，得到：\n$$\n\\operatorname{Var}(\\hat{\\mu}_{N}) = \\frac{1}{N^{2}}(N\\sigma^{2}) = \\frac{\\sigma^{2}}{N}\n$$\n问题要求MSE不大于 $\\varepsilon^{2}$。我们现在可以将这个条件写为：\n$$\n\\frac{\\sigma^{2}}{N} \\le \\varepsilon^{2}\n$$\n为了求得最小样本量 $N$，我们对 $N$ 解这个不等式：\n$$\nN \\ge \\frac{\\sigma^{2}}{\\varepsilon^{2}}\n$$\n问题给定了值 $\\sigma^{2}=4$ 和 $\\varepsilon=0.01$。代入这些值：\n$$\nN \\ge \\frac{4}{(0.01)^{2}} = \\frac{4}{(10^{-2})^{2}} = \\frac{4}{10^{-4}} = 4 \\times 10^{4} = 40000\n$$\n满足此条件的最小整数样本量 $N$ 是 $N=40000$。\n\n问题的第二部分要求计算相关的总计算成本。问题陈述每个样本的成本为 $1$，总成本等于样本数量 $N$。因此，总计算成本也是 $40000$。\n\n要求的两个值是最小样本量 $N$ 和总成本。\n最小样本量：$N = 40000$。\n总计算成本：成本 = $40000$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n40000  40000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在了解了单层方法的局限性后，我们转向更强大的多层蒙特卡洛 (Multilevel Monte Carlo, MLMC) 方法。MLMC 的威力来自于将计算量最优地分配到具有不同成本和精度的一系列模型层级上。本练习  将引导您解决 MLMC 的核心优化问题：在给定目标误差下，推导如何为每个层级分配最优的样本数量以最小化总成本。掌握这个推导过程是理解 MLMC 如何实现显著成本节省的关键。",
            "id": "3405129",
            "problem": "考虑一个构建在几何层级上的多层蒙特卡罗 (MLMC) 估计量，其网格尺寸为 $h_{l}=2^{-l}$，层级为 $l=0,1,\\dots,L$。设层级差为 $\\Delta P_{l}=P_{l}-P_{l-1}$，其中 $P_{-1}\\equiv 0$，并假设 $\\Delta P_{l}$ 在不同层级 $l$ 之间是独立的。假设每个层级差的方差和每个层级上单个样本的成本满足\n$$\n\\operatorname{Var}[\\Delta P_{l}]=v_{0}\\,2^{-\\beta l},\\qquad C_{l}=c_{0}\\,2^{\\gamma l},\n$$\n其中 $v_{0}$、$c_{0}$ 为固定的正常数，指数 $\\beta0$、$\\gamma0$，且 $\\beta\\neq\\gamma$。MLMC 估计量为\n$$\n\\widehat{P}_{\\mathrm{ML}}=\\sum_{l=0}^{L}\\frac{1}{N_{l}}\\sum_{n=1}^{N_{l}}\\Delta P_{l}^{(n)},\n$$\n其中 $N_{l}\\in\\mathbb{N}$ 表示在层级 $l$ 上抽取的样本数量。\n\n在独立性和有限二阶矩的条件下，估计量的方差为\n$$\n\\operatorname{Var}[\\widehat{P}_{\\mathrm{ML}}]=\\sum_{l=0}^{L}\\frac{\\operatorname{Var}[\\Delta P_{l}]}{N_{l}},\n$$\n总计算工作量为\n$$\nW=\\sum_{l=0}^{L}N_{l}\\,C_{l}.\n$$\n\n仅从这些定义出发，选择样本数 $\\{N_{l}\\}_{l=0}^{L}$ 以最小化 $W$，并满足约束条件 $\\operatorname{Var}[\\widehat{P}_{\\mathrm{ML}}]=\\sigma^{2}$，其中 $\\sigma^{2}0$ 是给定的目标方差。推导最优实数值 $N_{l}$ 作为 $l$、$L$、$v_{0}$、$c_{0}$、$\\beta$、$\\gamma$ 和 $\\sigma^{2}$ 的函数的闭式表达式，并将任何求和式表示为闭式形式。你的最终答案必须是给出 $N_{l}$ 关于这些参数的单个解析表达式。",
            "solution": "该问题旨在找到最优的样本分配 $\\{N_l\\}_{l=0}^{L}$，以在多层蒙特卡罗 (MLMC) 估计量的总方差固定为 $\\sigma^2$ 的约束下，最小化总计算工作量 $W$。这是一个经典的约束优化问题，可以使用拉格朗日乘子法求解。\n\n首先，我们陈述要最小化的目标函数和约束方程。总计算工作量由下式给出：\n$$\nW(\\{N_l\\}) = \\sum_{l=0}^{L} N_l C_l = \\sum_{l=0}^{L} N_l c_0 2^{\\gamma l}\n$$\nMLMC 估计量的方差约束为：\n$$\n\\operatorname{Var}[\\widehat{P}_{\\mathrm{ML}}] = \\sum_{l=0}^{L} \\frac{\\operatorname{Var}[\\Delta P_l]}{N_l} = \\sum_{l=0}^{L} \\frac{v_0 2^{-\\beta l}}{N_l} = \\sigma^2\n$$\n问题要求最优的实数值 $N_l$，这允许我们使用微分学。我们定义拉格朗日函数 $\\mathcal{L}$，其为目标函数与约束函数乘以拉格朗日乘子 $\\lambda$ 的和：\n$$\n\\mathcal{L}(\\{N_l\\}, \\lambda) = W + \\lambda \\left( \\sum_{l=0}^{L} \\frac{v_0 2^{-\\beta l}}{N_l} - \\sigma^2 \\right) = \\sum_{l=0}^{L} N_l c_0 2^{\\gamma l} + \\lambda \\left( \\sum_{l=0}^{L} \\frac{v_0 2^{-\\beta l}}{N_l} - \\sigma^2 \\right)\n$$\n为求最小值，我们计算 $\\mathcal{L}$ 对每个 $N_l$ 的偏导数并令其为零。对于每个 $l \\in \\{0, 1, \\dots, L\\}$：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial N_l} = c_0 2^{\\gamma l} - \\lambda \\frac{v_0 2^{-\\beta l}}{N_l^2} = 0\n$$\n解出 $N_l^2$，我们得到：\n$$\nN_l^2 = \\lambda \\frac{v_0 2^{-\\beta l}}{c_0 2^{\\gamma l}} = \\lambda \\frac{v_0}{c_0} 2^{-(\\beta+\\gamma)l}\n$$\n为使 $N_l$ 为正实数，必须有 $\\lambda > 0$。取平方根，得到用未知乘子 $\\lambda$ 表示的最优 $N_l$：\n$$\nN_l = \\sqrt{\\lambda} \\sqrt{\\frac{v_0}{c_0}} 2^{-(\\beta+\\gamma)l/2}\n$$\n下一步是通过将 $N_l$ 的表达式代回方差约束方程来确定 $\\sqrt{\\lambda}$ 的值：\n$$\n\\sum_{l=0}^{L} \\frac{v_0 2^{-\\beta l}}{N_l} = \\sigma^2\n$$\n$$\n\\sum_{l=0}^{L} \\frac{v_0 2^{-\\beta l}}{\\sqrt{\\lambda} \\sqrt{\\frac{v_0}{c_0}} 2^{-(\\beta+\\gamma)l/2}} = \\sigma^2\n$$\n我们可以将不依赖于求和索引 $l$ 的项提取出来：\n$$\n\\frac{1}{\\sqrt{\\lambda}} \\sum_{l=0}^{L} \\frac{v_0}{\\sqrt{v_0/c_0}} \\frac{2^{-\\beta l}}{2^{-(\\beta+\\gamma)l/2}} = \\sigma^2\n$$\n$$\n\\frac{\\sqrt{v_0 c_0}}{\\sqrt{\\lambda}} \\sum_{l=0}^{L} 2^{-\\beta l + (\\beta+\\gamma)l/2} = \\sigma^2\n$$\n$$\n\\frac{\\sqrt{v_0 c_0}}{\\sqrt{\\lambda}} \\sum_{l=0}^{L} 2^{(\\gamma-\\beta)l/2} = \\sigma^2\n$$\n该和是一个有限几何级数。令 $r = 2^{(\\gamma-\\beta)/2}$。该和为 $\\sum_{l=0}^{L} r^l$。由于问题陈述 $\\beta \\neq \\gamma$，我们有 $r \\neq 1$。该和的闭式表达式为：\n$$\nS = \\sum_{l=0}^{L} r^l = \\frac{1 - r^{L+1}}{1 - r} = \\frac{1 - (2^{(\\gamma-\\beta)/2})^{L+1}}{1 - 2^{(\\gamma-\\beta)/2}} = \\frac{1 - 2^{(\\gamma-\\beta)(L+1)/2}}{1 - 2^{(\\gamma-\\beta)/2}}\n$$\n将此代回，我们可以解出 $\\sqrt{\\lambda}$：\n$$\n\\frac{\\sqrt{v_0 c_0}}{\\sqrt{\\lambda}} S = \\sigma^2 \\implies \\sqrt{\\lambda} = \\frac{\\sqrt{v_0 c_0}}{\\sigma^2} S\n$$\n最后，我们将 $\\sqrt{\\lambda}$ 的这个表达式代入我们关于 $N_l$ 的方程中：\n$$\nN_l = \\left( \\frac{\\sqrt{v_0 c_0}}{\\sigma^2} S \\right) \\left( \\sqrt{\\frac{v_0}{c_0}} 2^{-(\\beta+\\gamma)l/2} \\right)\n$$\n$$\nN_l = \\frac{S}{\\sigma^2} \\left( \\sqrt{v_0 c_0} \\sqrt{\\frac{v_0}{c_0}} \\right) 2^{-(\\beta+\\gamma)l/2}\n$$\n项 $\\sqrt{v_0 c_0} \\sqrt{v_0/c_0} = \\sqrt{v_0^2} = v_0$。因此，成本常数 $c_0$ 被消掉，表明最优样本分配与其绝对值无关。\n$$\nN_l = \\frac{v_0 S}{\\sigma^2} 2^{-(\\beta+\\gamma)l/2}\n$$\n代入和 $S$ 的闭式表达式，我们得到层级 $l$ 上最优样本数的最终答案：\n$$\nN_l = \\frac{v_0}{\\sigma^2} \\left( \\frac{1 - 2^{(\\gamma-\\beta)(L+1)/2}}{1 - 2^{(\\gamma-\\beta)/2}} \\right) 2^{-(\\beta+\\gamma)l/2}\n$$\n该表达式给出了最优实数值 $N_l$ 作为指定参数 $l$、$L$、$v_0$、$\\beta$、$\\gamma$ 和 $\\sigma^2$ 的函数。如前所述，它与 $c_0$ 无关。",
            "answer": "$$ \\boxed{ \\frac{v_{0}}{\\sigma^{2}} \\left( \\frac{1 - 2^{\\frac{(\\gamma-\\beta)(L+1)}{2}}}{1 - 2^{\\frac{\\gamma-\\beta}{2}}} \\right) 2^{-\\frac{(\\beta+\\gamma)l}{2}} } $$"
        },
        {
            "introduction": "与 MLMC 并行，多保真蒙特卡洛 (Multifidelity Monte Carlo, MFMC) 提供了另一种强大的方差缩减策略，它通常通过利用一个相关的低保真模型来实现。本练习  聚焦于一种基于控制变量技术的流行 MFMC 变体。您将推导该估计器的方差，找到组合高、低保真度样本的最优方式，并量化由此带来的效率增益，从而揭示模型间的相关性及成本比如何关键地决定了方法的性能。",
            "id": "3405112",
            "problem": "考虑一个数据同化中的反问题，其目标是估计一个由高保真度正演模型产生的标量关注量的后验期望。设高保真度输出为随机变量 $Y_h$，其均值为 $\\mu_h$，方差为 $\\sigma_h^2$；并设一个相关的、更廉价的代理模型为 $Y_c$，其均值为 $\\mu_c$，方差为 $\\sigma_c^2$。在相同输入上评估时，它与 $Y_h$ 的相关系数为 $\\rho$。假设 $Y_h$ 和 $Y_c$ 是具有有限协方差的联合二阶随机变量，并且相关系数 $\\rho$ 在采样策略中是已知且恒定的。$Y_h$ 的单个样本成本为 $C_h$，$Y_c$ 的单个样本成本为 $C_c$。定义计算预算为 $B$，并假设除非明确配对，否则所有样本在不同抽取中都是独立的。\n\n您将构建并分析一个多保真度控制变量估计量，该估计量使用一个包含 $N_h$ 个样本的配对集（其中 $Y_h$ 和 $Y_c$ 都在相同的输入上进行评估），以及一个额外的、包含 $N_c$ 个 $Y_c$ 样本的独立廉价样本集，用于估计廉价模型的均值。该估计量定义为\n$$\n\\widehat{\\mu}_{\\mathrm{MF}} \\;=\\; \\overline{Y}_h \\;-\\; \\beta\\left(\\overline{Y}_c^{(h)} \\;-\\; \\overline{Y}_c\\right),\n$$\n其中 $\\overline{Y}_h$ 和 $\\overline{Y}_c^{(h)}$ 表示对 $N_h$ 个配对样本的样本均值，而 $\\overline{Y}_c$ 表示对 $N_c$ 个仅廉价样本的样本均值。用于 $\\overline{Y}_c^{(h)}$ 和 $\\overline{Y}_c$ 的样本是独立的。考虑所有评估的总成本为 $B = N_h C_h + (N_h + N_c) C_c$。在相同预算 $B$ 下，仅使用高保真度模型的基准单层蒙特卡罗估计量为 $\\widehat{\\mu}_{\\mathrm{SL}} = \\overline{Y}_h$，其预算为 $B = N_h^{\\mathrm{SL}} C_h$，方差为 $\\sigma_h^2/N_h^{\\mathrm{SL}}$。\n\n仅从方差、协方差和成本预算约束的定义出发，并且不引用预先推导出的最优公式，执行以下操作：\n1. 推导 $\\widehat{\\mu}_{\\mathrm{MF}}$ 的方差，将其表示为 $N_h$、$N_c$、$\\beta$、$\\sigma_h^2$、$\\sigma_c^2$ 和 $\\rho$ 的函数。\n2. 对于固定的 $N_h$ 和 $N_c$，确定使该方差最小化的 $\\beta$ 值，并求出以 $N_h$、$N_c$、$\\sigma_h^2$ 和 $\\rho$ 表示的最小化方差。\n3. 在固定的总预算 $B$ 下，仅用无量纲比率 $x = N_c/N_h$、相关系数 $\\rho$ 和成本比率 $k = C_h/C_c$ 来表示最小化方差。\n4. 定义方差缩减因子 $R$ 为在成本 $B$ 下的基准单层高保真度方差与在相同成本 $B$ 下的 $\\widehat{\\mu}_{\\mathrm{MF}}$ 最小化方差之比。求出 $R$ 作为 $x$、$\\rho$ 和 $k$ 的函数，然后找出使 $R$ 最大化（等效于最小化多保真度方差）的最优 $x$。\n5. 当 $C_h/C_c = 100$ 且 $\\rho = 0.9$ 时，计算方差缩减因子 $R$ 和最优比率 $N_c/N_h$。\n\n将您的两个数值答案四舍五入至四位有效数字。以 $R$ 和 $N_c/N_h$ 的顺序，将您的最终答案表示为两个无量纲数。",
            "solution": "在进行求解之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n- 高保真度模型输出：随机变量 $Y_h$，均值 $\\mu_h$，方差 $\\sigma_h^2$。\n- 廉价代理模型输出：随机变量 $Y_c$，均值 $\\mu_c$，方差 $\\sigma_c^2$。\n- $Y_h$ 和 $Y_c$ 之间的相关系数：$\\rho$。\n- $Y_h$ 的单个样本成本：$C_h$。\n- $Y_c$ 的单个样本成本：$C_c$。\n- 总计算预算：$B$。\n- 配对样本 $(Y_h, Y_c)$ 的数量：$N_h$。\n- 独立的仅廉价样本的数量：$N_c$。\n- 多保真度估计量：$\\widehat{\\mu}_{\\mathrm{MF}} = \\overline{Y}_h - \\beta(\\overline{Y}_c^{(h)} - \\overline{Y}_c)$。\n- $N_h$ 个高保真度样本的样本均值：$\\overline{Y}_h$。\n- $N_h$ 个配对廉价样本的样本均值：$\\overline{Y}_c^{(h)}$。\n- $N_c$ 个独立廉价样本的样本均值：$\\overline{Y}_c$。\n- 总成本约束：$B = N_h C_h + (N_h + N_c) C_c$。\n- 单层蒙特卡罗估计量：$\\widehat{\\mu}_{\\mathrm{SL}} = \\overline{Y}_h$，成本为 $B = N_h^{\\mathrm{SL}} C_h$。\n- 单层估计量的方差：$\\sigma_h^2/N_h^{\\mathrm{SL}}$。\n- 要求将最终数值答案四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是分析多保真度蒙特卡罗估计量（特别是控制变量法的一个变体）的标准练习。\n- **科学基础与客观性（关键）**：该问题基于已建立的方差和协方差统计原理以及蒙特卡罗方法的框架。这些概念在计算科学和工程中是标准的。语言精确客观。\n- **适定性**：问题定义明确，提供了所有必要的变量和关系。它要求进行一系列推导和优化，从而得到一个唯一的、有意义的解。\n- **完备性与一致性**：问题是自洽的。估计量和成本模型的定义是明确且一致的。样本集的独立性已明确说明。\n\n### 步骤3：结论与行动\n该问题被认为是有效的。下面提供一个完整的、带推理的解答。\n\n### 第1部分：多保真度估计量的方差\n多保真度估计量由 $\\widehat{\\mu}_{\\mathrm{MF}} = \\overline{Y}_h - \\beta(\\overline{Y}_c^{(h)} - \\overline{Y}_c)$ 给出。为了求其方差，我们使用方差的性质。项 $\\overline{Y}_c$ 是由一组 $N_c$ 个样本构成的，这些样本独立于用于 $\\overline{Y}_h$ 和 $\\overline{Y}_c^{(h)}$ 的 $N_h$ 个配对样本。因此，项 $(\\overline{Y}_h - \\beta\\overline{Y}_c^{(h)})$ 与 $\\beta\\overline{Y}_c$ 是独立的。\n独立随机变量之和的方差等于它们方差的和：\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MF}}) = \\mathrm{Var}(\\overline{Y}_h - \\beta\\overline{Y}_c^{(h)}) + \\mathrm{Var}(\\beta\\overline{Y}_c)\n$$\n第一项 $\\mathrm{Var}(\\overline{Y}_h - \\beta\\overline{Y}_c^{(h)})$ 涉及来自 $N_h$ 个独立同分布（i.i.d.）样本对 $(Y_{h,i}, Y_{c,i})$ 的样本均值。\n$$\n\\overline{Y}_h - \\beta\\overline{Y}_c^{(h)} = \\frac{1}{N_h}\\sum_{i=1}^{N_h} Y_{h,i} - \\beta \\frac{1}{N_h}\\sum_{i=1}^{N_h} Y_{c,i} = \\frac{1}{N_h}\\sum_{i=1}^{N_h} (Y_{h,i} - \\beta Y_{c,i})\n$$\n因此，方差为：\n$$\n\\mathrm{Var}\\left(\\frac{1}{N_h}\\sum_{i=1}^{N_h} (Y_{h,i} - \\beta Y_{c,i})\\right) = \\frac{1}{N_h^2} \\sum_{i=1}^{N_h} \\mathrm{Var}(Y_{h,i} - \\beta Y_{c,i}) = \\frac{1}{N_h}\\mathrm{Var}(Y_h - \\beta Y_c)\n$$\n我们使用方差和协方差的定义展开 $\\mathrm{Var}(Y_h - \\beta Y_c)$：\n$$\n\\mathrm{Var}(Y_h - \\beta Y_c) = \\mathrm{Var}(Y_h) + \\beta^2\\mathrm{Var}(Y_c) - 2\\beta\\mathrm{Cov}(Y_h, Y_c) = \\sigma_h^2 + \\beta^2\\sigma_c^2 - 2\\beta\\rho\\sigma_h\\sigma_c\n$$\n所以，第一项是 $\\frac{1}{N_h}(\\sigma_h^2 - 2\\beta\\rho\\sigma_h\\sigma_c + \\beta^2\\sigma_c^2)$。\n\n第二项 $\\mathrm{Var}(\\beta\\overline{Y}_c)$ 涉及来自 $N_c$ 个 i.i.d. 样本 $Y_{c,j}'$ 的样本均值：\n$$\n\\mathrm{Var}(\\beta\\overline{Y}_c) = \\beta^2\\mathrm{Var}(\\overline{Y}_c) = \\beta^2\\mathrm{Var}\\left(\\frac{1}{N_c}\\sum_{j=1}^{N_c} Y_{c,j}'\\right) = \\beta^2 \\frac{1}{N_c}\\mathrm{Var}(Y_c) = \\frac{\\beta^2\\sigma_c^2}{N_c}\n$$\n结合两项，总方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MF}}) = \\frac{1}{N_h}(\\sigma_h^2 - 2\\beta\\rho\\sigma_h\\sigma_c + \\beta^2\\sigma_c^2) + \\frac{\\beta^2\\sigma_c^2}{N_c}\n$$\n$$\n\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MF}}) = \\frac{\\sigma_h^2}{N_h} - \\frac{2\\beta\\rho\\sigma_h\\sigma_c}{N_h} + \\beta^2\\sigma_c^2\\left(\\frac{1}{N_h} + \\frac{1}{N_c}\\right)\n$$\n\n### 第2部分：最优 $\\beta$ 和最小化方差\n为了找到使方差最小化的最优 $\\beta$ 值，我们将 $\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MF}})$ 对 $\\beta$ 求导，并令结果为零：\n$$\n\\frac{\\partial}{\\partial\\beta}\\mathrm{Var}(\\widehat{\\mu}_{\\mathrm{MF}}) = -\\frac{2\\rho\\sigma_h\\sigma_c}{N_h} + 2\\beta\\sigma_c^2\\left(\\frac{1}{N_h} + \\frac{1}{N_c}\\right) = 0\n$$\n$$\n\\beta\\sigma_c^2\\left(\\frac{N_c + N_h}{N_h N_c}\\right) = \\frac{\\rho\\sigma_h\\sigma_c}{N_h}\n$$\n求解 $\\beta$，我们得到最优值 $\\beta_{opt}$：\n$$\n\\beta_{opt} = \\frac{\\rho\\sigma_h\\sigma_c}{N_h} \\frac{N_h N_c}{\\sigma_c^2(N_h+N_c)} = \\frac{\\rho\\sigma_h}{\\sigma_c}\\frac{N_c}{N_h+N_c}\n$$\n二阶导数 $2\\sigma_c^2(1/N_h + 1/N_c)$ 为正，证实了这是一个最小值。\n现在，我们将 $\\beta_{opt}$ 代回方差表达式。方差是关于 $\\beta$ 的二次式，形式为 $A - 2B\\beta + C\\beta^2$，在 $\\beta = B/C$ 时有最小值 $A - B^2/C$。\n这里，$A = \\frac{\\sigma_h^2}{N_h}$，$B = \\frac{\\rho\\sigma_h\\sigma_c}{N_h}$，以及 $C = \\sigma_c^2\\left(\\frac{1}{N_h} + \\frac{1}{N_c}\\right)$。\n最小化方差为：\n$$\n\\mathrm{Var}_{\\mathrm{min}} = \\frac{\\sigma_h^2}{N_h} - \\frac{\\left(\\frac{\\rho\\sigma_h\\sigma_c}{N_h}\\right)^2}{\\sigma_c^2\\left(\\frac{1}{N_h} + \\frac{1}{N_c}\\right)} = \\frac{\\sigma_h^2}{N_h} - \\frac{\\frac{\\rho^2\\sigma_h^2\\sigma_c^2}{N_h^2}}{\\sigma_c^2\\frac{N_h+N_c}{N_h N_c}}\n$$\n$$\n\\mathrm{Var}_{\\mathrm{min}} = \\frac{\\sigma_h^2}{N_h} - \\frac{\\rho^2\\sigma_h^2}{N_h^2} \\frac{N_h N_c}{N_h+N_c} = \\frac{\\sigma_h^2}{N_h} - \\frac{\\rho^2\\sigma_h^2 N_c}{N_h(N_h+N_c)}\n$$\n该表达式可以通过提取因子 $\\sigma_h^2/N_h$ 来简化：\n$$\n\\mathrm{Var}_{\\mathrm{min}} = \\frac{\\sigma_h^2}{N_h}\\left(1 - \\frac{\\rho^2 N_c}{N_h+N_c}\\right) = \\frac{\\sigma_h^2}{N_h}\\left(\\frac{N_h + N_c - \\rho^2 N_c}{N_h+N_c}\\right) = \\frac{\\sigma_h^2}{N_h}\\frac{N_h + (1-\\rho^2)N_c}{N_h + N_c}\n$$\n\n### 第3部分：以无量纲比率表示的最小化方差\n成本预算为 $B = N_h C_h + (N_h + N_c) C_c$。给定 $x = N_c/N_h$ 和 $k = C_h/C_c$。\n我们可以用总预算 $B$ 来表示 $N_h$。\n$$\nB = N_h C_h + N_h C_c + N_c C_c = N_h (C_h + C_c) + N_c C_c\n$$\n代入 $N_c = x N_h$ 和 $C_h = k C_c$：\n$$\nB = N_h (k C_c + C_c) + x N_h C_c = N_h C_c (k + 1 + x)\n$$\n解出 $N_h$：\n$$\nN_h = \\frac{B}{C_c(k+1+x)}\n$$\n现在，将此式代入最小化方差公式。比率项变为 $\\frac{N_h + (1-\\rho^2)x N_h}{N_h + x N_h} = \\frac{1+(1-\\rho^2)x}{1+x}$。\n$$\n\\mathrm{Var}_{\\mathrm{min}} = \\frac{\\sigma_h^2}{N_h} \\frac{1+(1-\\rho^2)x}{1+x} = \\sigma_h^2 \\frac{C_c(k+1+x)}{B} \\frac{1+(1-\\rho^2)x}{1+x}\n$$\n$$\n\\mathrm{Var}_{\\mathrm{min}} = \\frac{\\sigma_h^2 C_c}{B} \\frac{(k+1+x)(1+(1-\\rho^2)x)}{1+x}\n$$\n\n### 第4部分：方差缩减因子和最优样本比率\n基准单层蒙特卡罗方差为 $\\mathrm{Var}_{\\mathrm{SL}} = \\sigma_h^2/N_h^{\\mathrm{SL}}$。预算为 $B = N_h^{\\mathrm{SL}} C_h$，所以 $N_h^{\\mathrm{SL}} = B/C_h$。\n$$\n\\mathrm{Var}_{\\mathrm{SL}} = \\sigma_h^2 \\frac{C_h}{B}\n$$\n方差缩减因子 $R$ 是比率 $\\mathrm{Var}_{\\mathrm{SL}}/\\mathrm{Var}_{\\mathrm{min}}$：\n$$\nR = \\frac{\\sigma_h^2 C_h/B}{\\frac{\\sigma_h^2 C_c}{B} \\frac{(k+1+x)(1+(1-\\rho^2)x)}{1+x}} = \\frac{C_h/C_c}{\\frac{(k+1+x)(1+(1-\\rho^2)x)}{1+x}}\n$$\n$$\nR(x) = \\frac{k(1+x)}{(k+1+x)(1+(1-\\rho^2)x)}\n$$\n为了最大化 $R(x)$，我们可以最小化其倒数 $g(x) = 1/R(x) = \\frac{(k+1+x)(1+(1-\\rho^2)x)}{k(1+x)}$。我们对 $g(x)$ 关于 $x$ 求导并设为0。我们可以忽略常数 $k$，最小化 $g_0(x) = \\frac{(k+1+x)(1+(1-\\rho^2)x)}{1+x}$。\n$$\ng_0(x) = \\frac{(1-\\rho^2)x^2 + (k+2-(k+1)\\rho^2)x + k+1}{1+x}\n$$\n$$\n\\frac{dg_0}{dx} = \\frac{(1+x)[2(1-\\rho^2)x+k+2-(k+1)\\rho^2] - [(1-\\rho^2)x^2 + (k+2-(k+1)\\rho^2)x + k+1]}{(1+x)^2} = 0\n$$\n分子可简化为：\n$$\n(1-\\rho^2)x^2 + 2(1-\\rho^2)x + 1-(k+1)\\rho^2 = 0\n$$\n解这个关于 $x$ 的二次方程：\n$$\nx = \\frac{-2(1-\\rho^2) \\pm \\sqrt{4(1-\\rho^2)^2 - 4(1-\\rho^2)(1-(k+1)\\rho^2)}}{2(1-\\rho^2)}\n$$\n$$\nx = -1 \\pm \\sqrt{1 - \\frac{1-(k+1)\\rho^2}{1-\\rho^2}} = -1 \\pm \\sqrt{\\frac{1-\\rho^2 - 1 + (k+1)\\rho^2}{1-\\rho^2}}\n$$\n$$\nx = -1 \\pm \\sqrt{\\frac{k\\rho^2}{1-\\rho^2}} = -1 \\pm \\frac{\\rho\\sqrt{k}}{\\sqrt{1-\\rho^2}}\n$$\n由于 $x=N_c/N_h$ 必须为非负数，我们取正根：\n$$\nx_{opt} = -1 + \\frac{\\rho\\sqrt{k}}{\\sqrt{1-\\rho^2}}\n$$\n\n### 第5部分：数值计算\n给定 $k = C_h/C_c = 100$ 和 $\\rho = 0.9$。\n首先，我们计算最优比率 $x_{opt} = N_c/N_h$：\n$$\nx_{opt} = -1 + \\frac{0.9\\sqrt{100}}{\\sqrt{1-0.9^2}} = -1 + \\frac{9}{\\sqrt{1-0.81}} = -1 + \\frac{9}{\\sqrt{0.19}}\n$$\n$$\nx_{opt} \\approx -1 + \\frac{9}{0.43588989} \\approx -1 + 20.647416 \\approx 19.647416\n$$\n四舍五入至四位有效数字，$x_{opt} \\approx 19.65$。\n\n接下来，我们计算最大方差缩减因子 $R_{max}$。我们可以将 $x_{opt}$ 代入 $R(x)$ 的表达式中。一个更简洁的方法是找到 $R_{max}$ 的简化表达式。\n$g(x)$ 的最小值为 $g(x_{opt}) = \\frac{(\\sqrt{k}\\sqrt{1-\\rho^2}+\\rho)^2}{k}$。\n$$\nR_{max} = \\frac{1}{g(x_{opt})} = \\frac{k}{(\\sqrt{k}\\sqrt{1-\\rho^2}+\\rho)^2}\n$$\n代入数值：\n$$\nR_{max} = \\frac{100}{(\\sqrt{100}\\sqrt{1-0.9^2} + 0.9)^2} = \\frac{100}{(10\\sqrt{0.19} + 0.9)^2}\n$$\n$$\nR_{max} \\approx \\frac{100}{(10 \\times 0.43588989 + 0.9)^2} = \\frac{100}{(4.3588989 + 0.9)^2} = \\frac{100}{(5.2588989)^2}\n$$\n$$\nR_{max} \\approx \\frac{100}{27.65599} \\approx 3.61587\n$$\n四舍五入至四位有效数字，$R \\approx 3.616$。\n\n所要求的两个数值是方差缩减因子 $R$ 和最优比率 $N_c/N_h$。\n$R \\approx 3.616$\n$N_c/N_h \\approx 19.65$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.616  19.65\n\\end{pmatrix}\n}\n$$"
        }
    ]
}