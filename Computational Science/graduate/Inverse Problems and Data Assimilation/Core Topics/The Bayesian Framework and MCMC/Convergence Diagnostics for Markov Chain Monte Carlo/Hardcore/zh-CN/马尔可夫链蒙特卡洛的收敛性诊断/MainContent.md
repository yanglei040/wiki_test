## 引言
[马尔可夫链蒙特卡洛](@entry_id:138779)（MCMC）方法是现代贝叶斯统计推断的基石，它为我们从复杂、高维的[后验概率](@entry_id:153467)[分布](@entry_id:182848)中抽取样本提供了强大的计算框架。通过这些样本，我们可以近似计算后验期望、可信区间以及其他各种推断量。然而，[MCMC方法](@entry_id:137183)的力量依赖于一个核心假设：生成的[马尔可夫链](@entry_id:150828)在经过足够长时间的运行后，其样本的[分布](@entry_id:182848)会收敛到我们期望的目标[后验分布](@entry_id:145605)。

这个假设引出了一个至关重要的实践问题：我们如何判断“足够长”的时间是多长？如果过早地停止采样，或者链未能充分探索整个后验分布空间，那么基于这些样本得出的科学结论可能是片面、不准确甚至是完全错误的。这便是本文所要解决的知识鸿沟——[MCMC收敛](@entry_id:137600)性诊断的必要性与实践。不加批判地信任MCMC的输出而不进行严格的收敛性评估，是[贝叶斯分析](@entry_id:271788)中最危险的陷阱之一。

本文旨在为您提供一个关于[MCMC收敛](@entry_id:137600)性诊断的全面指南。通过学习本章，您将能够理解并应用一系列诊断工具，以确保您的MCMC分析结果的可靠性。我们将首先在“原理与机制”一章中，深入探讨收敛性的数学定义，揭示其背后的理论基础，并详细介绍[Gelman-Rubin诊断](@entry_id:749773)、[有效样本量](@entry_id:271661)（ESS）等核心诊断工具的工作原理。接着，在“应用与[交叉](@entry_id:147634)学科联系”一章中，我们将视野扩展到化学、生物学、地球物理等多个领域，展示这些诊断原则如何在真实的、复杂的科学问题中被巧妙地应用、扩展和整合，以应对多模态、高维病态等挑战。最后，在“动手实践”部分，您将通过具体的编程练习，将理论知识转化为实践技能，从而真正掌握评估MCMC样本质量的艺术。

## 原理与机制

在上一章中，我们介绍了在贝叶斯[反问题](@entry_id:143129)和数据同化中，[马尔可夫链蒙特卡洛](@entry_id:138779)（Markov Chain [Monte Carlo](@entry_id:144354), MCMC）方法作为从复杂后验分布中采样、近似后验期望的关键计算工具。然而，[MCMC算法](@entry_id:751788)的有效性取决于其核心假设：即生成的样本链最终能“收敛”到目标后验分布。不加批判地使用MCMC的输出而不评估其收敛性，可能会导致灾难性的、具有误导性的科学结论。因此，理解并应用收敛性诊断是MCMC实践中不可或缺的一环。

本章将深入探讨[MCMC收敛](@entry_id:137600)性诊断的原理与机制。我们将从收敛性的数学定义出发，阐明其理论基础，然后系统地介绍一系列用于评估收敛性的实用诊断工具。我们将不仅关注这些工具如何运作，更重要的是，它们旨在回答哪些关于收敛性的具体问题。

### [MCMC收敛](@entry_id:137600)性的理论基础

为了构建有效的诊断工具，我们首先必须精确定义“收敛”的含义。[MCMC算法](@entry_id:751788)的核心是构建一个[马尔可夫链](@entry_id:150828)，其状态在[参数空间](@entry_id:178581) $\Theta$ 中演化，并以目标[后验分布](@entry_id:145605) $\pi(\theta | y)$ 为其唯一的**[平稳分布](@entry_id:194199)（stationary distribution）**。

#### 平稳性与[分布](@entry_id:182848)收敛

一个马尔可夫链，由其转移核 $K(\theta, A)$ 定义（表示从状态 $\theta$ 转移到集合 $A$ 的概率），如果其初始状态 $\theta_0$ 是从目标分布 $\pi$ 中抽取的，那么其后续所有状态 $\theta_t$ 的[分布](@entry_id:182848)都将保持为 $\pi$，我们就称 $\pi$ 是该链的[平稳分布](@entry_id:194199)。用数学语言来说，这意味着对于所有可测集 $A$，以下[不变性](@entry_id:140168)方程成立 ：
$$
\int_{\Theta} \pi(\mathrm{d}\theta) K(\theta, A) = \pi(A)
$$
这个方程通常简记为 $\pi K = \pi$。这一定义描述了一种理想的平衡状态。

然而，在实践中，我们无法从我们想要采样的[目标分布](@entry_id:634522) $\pi$ 开始。我们通常从一个任意的初始点或[分布](@entry_id:182848) $\mu$ 开始。因此，[MCMC算法](@entry_id:751788)的第二个关键要求是**收敛性（convergence）**：无论初始[分布](@entry_id:182848) $\mu$ 是什么，在经过足够多的迭代后，链的状态 $\theta_t$ 的[分布](@entry_id:182848) $\mathcal{L}(\theta_t)$ 必须接近[平稳分布](@entry_id:194199) $\pi$。

这种接近程度通常用**[全变差距离](@entry_id:143997)（total variation distance）**来衡量。两个概率测度 $\nu_1$ 和 $\nu_2$ 之间的[全变差距离](@entry_id:143997)定义为：
$$
\lVert \nu_1 - \nu_2 \rVert_{\mathrm{TV}} = \sup_{A \in \mathcal{B}(\Theta)} |\nu_1(A) - \nu_2(A)|
$$
其中 $\mathcal{B}(\Theta)$ 是参数空间 $\Theta$ 上的Borel $\sigma$-代数。因此，[MCMC算法](@entry_id:751788)的收敛性形式化地定义为，对于任何初始[分布](@entry_id:182848) $\mu$，当 $t \to \infty$ 时 ：
$$
\lVert \mathcal{L}(\theta_t) - \pi \rVert_{\mathrm{TV}} = \lVert \mu K^t - \pi \rVert_{\mathrm{TV}} \to 0
$$
这里 $K^t$ 表示应用转移核 $t$ 次。

值得注意的是，许多[MCMC算法](@entry_id:751788)（如Metropolis-Hastings）通过满足一个更强的**[细致平衡条件](@entry_id:265158)（detailed balance condition）**来确保[平稳性](@entry_id:143776)。但[细致平衡](@entry_id:145988)是平稳性的充分非必要条件。

#### 收敛的理论保证

那么，哪些性质可以保证一个[马尔可夫链收敛](@entry_id:261538)到唯一的一个[平稳分布](@entry_id:194199)呢？在通用（例如连续）状态空间上，答案由马尔可夫链的遍历理论给出。三个关键性质分别是**$\psi$-不可约性（$\psi$-irreducibility）**、**[正常返](@entry_id:195139)（Harris recurrence）**和**[非周期性](@entry_id:275873)（aperiodicity）** 。

- **$\psi$-不可约性**：这确保了链可以从任何初始状态出发，在有限步内以正概率到达[状态空间](@entry_id:177074)中任何“有意义”的区域。这里的“有意义”是由一个非平凡的测度 $\psi$ 来定义的。它防止了链被困在状态空间的某个[子集](@entry_id:261956)中。

- **[正常返](@entry_id:195139)**：一个$\psi$-不可约的链如果能以概率1返回到任何“有意义”的区域，则被称为**常返的（recurrent）**。如果这种返回的期望时间是有限的，则链是**[正常返](@entry_id:195139)的（positive recurrent）**。[正常返](@entry_id:195139)保证了链存在一个平稳**概率**[分布](@entry_id:182848)。如果链是常返但非正常的，它可能存在一个$\sigma$-有限的平稳测度，但这对于MCMC来说是不够的。

- **非周期性**：这排除了链以固定的周期在[状态空间](@entry_id:177074)的不同[子集](@entry_id:261956)之间循环的可能性。例如，一个链可能在偶数时间步访问集合$A_1$，在奇数时间步访问集合$A_2$。[非周期性](@entry_id:275873)保证了链的混合行为。

**马尔可夫链遍历理论的核心定理**表明：如果一个[马尔可夫链](@entry_id:150828)是$\psi$-不可约、[正常返](@entry_id:195139)且非周期的，那么它存在唯一的平稳[概率分布](@entry_id:146404) $\pi$，并且对于任何初始状态，链的[分布](@entry_id:182848)都将在[全变差距离](@entry_id:143997)下收敛到 $\pi$。

### 两种[收敛模式](@entry_id:189917)：[分布](@entry_id:182848)收敛与遍历收敛

理解了收敛的理论基础后，我们需要区分两种在MCMC上下文中都称为“收敛”但含义不同的概念 。

1.  **[分布](@entry_id:182848)收敛（Distributional Convergence）**：这是我们上面讨论的收敛，即链的边缘[分布](@entry_id:182848) $\mathcal{L}(\theta_t)$ 随时间 $t$ 趋近于[平稳分布](@entry_id:194199) $\pi$。这关系到链的“预热”（warm-up）或**老化（burn-in）**阶段。诊断这个过程是为了回答：“我的链是否已经忘记了它的初始状态，并开始在[目标分布](@entry_id:634522)的典型区域内探索？”

2.  **遍历收敛（Ergodic Convergence）**：这是指**[马尔可夫链](@entry_id:150828)强（或弱）大数定律**。它保证了对于一个[可积函数](@entry_id:191199) $f(\theta)$，其样本均值（或遍历均值）会收敛到其在[平稳分布](@entry_id:194199) $\pi$下的[期望值](@entry_id:153208)：
    $$
    \bar{f}_T = \frac{1}{T}\sum_{t=1}^T f(\theta_t) \to \mathbb{E}_{\pi}[f] = \int f(\theta)\,\pi(\mathrm{d}\theta) \quad (\text{as } T \to \infty)
    $$
    这种收敛是[MCMC方法](@entry_id:137183)的核心 justification，因为它允许我们使用样本均值来近似后验期望。诊断这个过程是为了回答：“我用来估计后验期望的样本均值有多精确？”

这两种收敛是相关的，但并不等价。[分布](@entry_id:182848)收敛是遍历收敛的前提。一个设计良好的[MCMC采样](@entry_id:751801)器在满足遍历理论的条件下，两种收敛都会发生。然而，在实践中，我们用不同的工具来诊断它们。例如，**[潜在尺度缩减因子](@entry_id:753645)（Potential Scale Reduction Factor, PSRF）**主要用于诊断[分布](@entry_id:182848)收敛，而**[有效样本量](@entry_id:271661)（Effective Sample Size, ESS）**则用于量化遍历均值的精度。

### 实用诊断工具

理论告诉我们收敛终将发生，但实践中的问题是“何时”发生？我们永远无法在有限时间内“证明”收敛，只能寻找“未收敛”的证据。以下是几种主流的诊断工具，每种工具都旨在从不同角度审视收敛性。

#### [老化期](@entry_id:747019)（Burn-in）的确定

由于MCMC链从远离目标分布的区域开始，其初始样本并不代表平稳分布。因此，我们通常会丢弃链的前 $b$ 个样本，这个过程称为**老化**或**预热**。如何确定[老化期](@entry_id:747019) $b$ 的长度是一个关键问题。

从理论上讲，[老化期](@entry_id:747019)的长度与链的**[混合时间](@entry_id:262374)（mixing time）**有关。[混合时间](@entry_id:262374) $t_{\mathrm{mix}}(\epsilon)$ 定义为链的[全变差距离](@entry_id:143997)从最坏的初始状态开始下降到 $\epsilon$ 以下所需的时间 ：
$$
t_{\mathrm{mix}}(\epsilon) := \inf \left\{ t \in \mathbb{N} \,:\, \sup_{x \in \mathcal{X}} \lVert P^t(x,\cdot) - \pi \rVert_{\mathrm{TV}} \le \epsilon \right\}
$$
丢弃[老化](@entry_id:198459)样本的目的是减少由非平稳起始点引入的**偏差（bias）**。对于一个[有界函数](@entry_id:176803) $f$（$\|f\|_\infty \le B$），[老化](@entry_id:198459)后样本均值 $\bar{f}_T^{(b)}$ 的期望偏差可以被界定。如果我们选择一个[老化期](@entry_id:747019) $b \ge t_{\mathrm{mix}}(\epsilon)$，那么对于任意数量的保留样本 $T$ 和任意初始[分布](@entry_id:182848)，偏差的界为：
$$
\left| \mathbb{E}[\bar{f}_T^{(b)}] - \int f \,\mathrm{d}\pi \right| \le 2 B \epsilon
$$
这个结果清晰地表明，足够长的[老化期](@entry_id:747019)可以任意控制住估计的偏差。例如，要将偏差控制在 $\delta$ 以内，我们只需选择 $\epsilon = \delta/(2B)$ 并运行链至少 $t_{\mathrm{mix}}(\delta/(2B))$ 步作为[老化期](@entry_id:747019)。不幸的是，[混合时间](@entry_id:262374)本身在实际问题中几乎无法计算。因此，[老化期](@entry_id:747019)的选择通常依赖于下面将要讨论的[启发式](@entry_id:261307)诊断。

#### [Gelman-Rubin诊断](@entry_id:749773) ($\hat{R}$)

[Gelman-Rubin诊断](@entry_id:749773)，也称为**[潜在尺度缩减因子](@entry_id:753645)（Potential Scale Reduction Factor, PSRF）**或 $\hat{R}$，是应用最广泛的[分布](@entry_id:182848)[收敛诊断](@entry_id:137754)工具之一。

**原理**：
$\hat{R}$ 的核心思想是同时运行 $M$ 条并行的MCMC链，每条链从一个与目标后验分布相比“过度分散”（overdispersed）的初始点开始。其逻辑是：如果所有链，无论从多么分散的起点出发，最终都混合并探索相同的[分布区](@entry_id:204061)域，那么我们就有理由相信它们已经收敛到了共同的[平稳分布](@entry_id:194199)。如果链被困在后验分布的不同模态中，或者混合缓慢，那么它们各自的样本统计特性将会不同  。

**机制**：
$\hat{R}$ 通过比较**链间[方差](@entry_id:200758)（between-chain variance, $B$）**和**链内[方差](@entry_id:200758)（within-chain variance, $W$）**来量化这种混合程度。对于一个标量参数 $\theta$，设我们有 $M$ 条链，每条链长为 $N$。

1.  **链内[方差](@entry_id:200758) $W$** 是各链样本[方差](@entry_id:200758)的均值。它主要反映了已探索区域的[方差](@entry_id:200758)。
    $$
    W = \frac{1}{M} \sum_{j=1}^{M} s_{j}^{2} = \frac{1}{M(N-1)} \sum_{j=1}^{M} \sum_{i=1}^{N} (\theta_{j,i} - \bar{\theta}_{j})^{2}
    $$
    其中 $s_j^2$ 和 $\bar{\theta}_j$ 分别是第 $j$ 条链的样本[方差](@entry_id:200758)和样本均值。

2.  **链间[方差](@entry_id:200758) $B$** 反映了各链均值之间的变异程度，并按链长 $N$ 进行缩放。
    $$
    B = \frac{N}{M-1} \sum_{j=1}^{M} (\bar{\theta}_{j} - \bar{\theta}_{\cdot})^{2}
    $$
    其中 $\bar{\theta}_{\cdot}$ 是所有链均值的均值。

3.  总[方差](@entry_id:200758)的估计 $\hat{V}$ 是 $W$ 和 $B$ 的加权平均，旨在估计 $\theta$ 的真实后验[方差](@entry_id:200758)。如果链未收敛，$W$ 会低估真实[方差](@entry_id:200758)，而 $B$ 会很大，$\hat{V}$ 通过结合两者来修正这一估计。
    $$
    \hat{V} = \frac{N-1}{N}W + \frac{1}{N}B
    $$

4.  $\hat{R}$ 最终定义为总[方差估计](@entry_id:268607)与链内[方差估计](@entry_id:268607)之比的平方根 ：
    $$
    \hat{R} = \sqrt{\frac{\hat{V}}{W}} = \sqrt{\frac{N-1}{N} + \frac{B}{NW}}
    $$
    当链收敛时，各链均值 $\bar{\theta}_j$ 会趋于一致，导致 $B$ 变小，$\hat{V}$ 趋近于 $W$，因此 $\hat{R}$ 趋近于1。一个远大于1的 $\hat{R}$ 值（例如，大于1.01或1.1）是链未收敛的强烈信号。

为了使 $\hat{R}$ 有效，**过度分散的初始化**至关重要。一个实用的方法是从一个[方差比](@entry_id:162608)[先验分布](@entry_id:141376)更宽的[分布](@entry_id:182848)中采样初始点。例如，如果先验是 $\mathcal{N}(m_0, C_0)$，我们可以从 $\mathcal{N}(m_0, \alpha C_0)$（其中 $\alpha > 1$）中采样初始点。或者，可以从一个温度更低的先验 $p(\theta)^\beta$（其中 $\beta > 1$）中采样，对于[高斯先验](@entry_id:749752)，这等价于从 $\mathcal{N}(m_0, \beta^{-1} C_0)$ 中采样 。

#### [Geweke诊断](@entry_id:749891) ($z$-score)

与需要多条链的 $\hat{R}$ 不同，[Geweke诊断](@entry_id:749891)是**单链诊断**。

**原理**：
其思想是，如果一条链已经达到平稳状态，那么链的任何两个不重叠的部分的均值应该相等。[Geweke诊断](@entry_id:749891)通过比较链早期[部分和](@entry_id:162077)晚期部分的均值来检验这一假设。

**机制**：
1.  从一条长度为 $N$ 的链中选取两个不重叠的窗口，例如，早期窗口 $a$（如前10%的样本）和晚期窗口 $b$（如后50%的样本）。设其长度分别为 $n_a$ 和 $n_b$，样本均值分别为 $\bar{g}_a$ 和 $\bar{g}_b$。

2.  计算均值之差 $\bar{g}_a - \bar{g}_b$。在[平稳性](@entry_id:143776)的零假设下，这个差的期望为0。

3.  为了构造一个检验统计量，我们需要[标准化](@entry_id:637219)这个差。由于MCMC样本是自相关的，我们不能使用简单的样本[方差](@entry_id:200758)。我们需要估计每个均值的**长程[方差](@entry_id:200758)（long-run variance）**，即**零频处的谱密度（spectral density at zero）**，记为 $S_g$。这个量考虑了序列中所有的[自协方差](@entry_id:270483)。

4.  使用**异[方差](@entry_id:200758)和[自相关](@entry_id:138991)一致（HAC）**的谱[密度估计](@entry_id:634063)器（如使用Bartlett或Parzen窗），分别从窗口 $a$ 和 $b$ 的样本中得到谱[密度估计](@entry_id:634063) $\hat{S}_a$ 和 $\hat{S}_b$。

5.  Geweke $z$-score 统计量构造如下 ：
    $$
    z = \frac{\bar{g}_a - \bar{g}_b}{\sqrt{\frac{\hat{S}_a}{n_a} + \frac{\hat{S}_b}{n_b}}}
    $$
    在[平稳性](@entry_id:143776)的[零假设](@entry_id:265441)下，只要窗口 $a$ 和 $b$ 足够大且分隔得足够远（使其近似独立），$z$ 统计量近似服从标准正态分布 $N(0, 1)$。如果 $|z|$ 的值很大（例如大于2），则表明链可能尚未收敛。为了保证谱[密度估计](@entry_id:634063)的一致性，HAC估计器的带宽 $L$ 必须满足 $L\to\infty$ 且 $L/n \to 0$ 。

#### [有效样本量](@entry_id:271661) (ESS)

ESS 不是一个收敛性检验，而是对遍历均值**精度**的度量。

**原理**：
MCMC生成的 $N$ 个样本因为自相关，其包含的信息量要少于 $N$ 个[独立同分布](@entry_id:169067)（i.i.d.）的样本。ESS 回答的问题是：“我这 $N$ 个相关样本，等价于多少个[独立样本](@entry_id:177139)？”

**机制**：
一个平稳时间序列样本均值的[方差近似](@entry_id:268585)为：
$$
\mathrm{Var}(\bar{x}) \approx \frac{\sigma^2}{N} \left(1 + 2\sum_{k=1}^{\infty}\rho_k\right)
$$
其中 $\sigma^2$ 是序列的边缘[方差](@entry_id:200758)，$\rho_k$ 是滞后$k$的[自相关](@entry_id:138991)。相比之下， $N_{eff}$ 个[独立样本](@entry_id:177139)均值的[方差](@entry_id:200758)是 $\sigma^2 / N_{eff}$。通过令两者相等，我们可以定义ESS ：
$$
\mathrm{ESS} = \frac{N}{1 + 2\sum_{k=1}^{\infty}\rho_k}
$$
其中 $N$ 是总样本数（如果有 $M$ 条链，则 $N$ 是 $M \times (\text{chain length})$）。分母被称为**[积分自相关时间](@entry_id:637326)（integrated autocorrelation time, IAT）**。IAT 越高，样本间的相关性越强，ESS就越低。

在实践中，无限和必须被截断。一个糟糕的截断会因为噪声导致IAT估计为负。Geyer提出的**初始正序列法**是一种稳健的截断方法：将[自相关](@entry_id:138991)两两配对求和（$\Gamma_k = \hat{\rho}_{2k} + \hat{\rho}_{2k+1}$），并只累加到最后一个使所有[前期](@entry_id:170157)配对和都为正的项。这保证了IAT的估计为正，因为它与零频处的谱密度成正比，而谱密度必须为非负 。一个低的ESS值（例如，小于几百）表明，尽管链可能很长，但我们对[后验均值](@entry_id:173826)的估计仍然很不确定。

#### Raftery-Lewis 诊断

这个诊断工具的目标与ESS不同，它专注于估计**后验[分位数](@entry_id:178417)**所需的迭代次数。

**原理**：
它回答了一个非常具体的问题：“为了以概率 $s$ 将第 $q$ 个[分位数](@entry_id:178417)估计到精度 $\pm r$ 之内，我需要运行MCMC多少步？”

**机制**：
1.  该方法首先将连续的MCMC链 $\{\theta_t\}$ **二值化**为一个两状态马尔可夫链 $\{Y_t\}$。这通过一个从短试点运行中得到的初始[分位数](@entry_id:178417)估计 $\hat{x}_q$ 来实现：$Y_t = \mathbf{1}\{\theta_t \le \hat{x}_q\}$。

2.  $\{Y_t\}$ 是一个两状态（0或1）[马尔可夫链](@entry_id:150828)。Raftery和Lewis分析了这个链的性质。它的动力学可以用一个 $2 \times 2$ 的转移矩阵 $P$ 来描述。

3.  估计[分位数](@entry_id:178417)的问题被转化为估计二项分布比例 $q$ 的问题。对于[独立样本](@entry_id:177139)，所需样本数 $N_{min}$ 可以通过[正态近似](@entry_id:261668)得到。

4.  然而，$\{Y_t\}$ 样本是相关的。这种相关性导致的[方差膨胀](@entry_id:756433)由一个**依赖因子（dependence inflation factor, $I$）**来量化。这个因子可以通过二值链的转移概率 $(a, b)$ 计算得出。具体来说，$I = (1+\lambda)/(1-\lambda)$，其中 $\lambda = 1-a-b$ 是二值链[转移矩阵](@entry_id:145510)的次[特征值](@entry_id:154894)。

5.  最终，所需的总迭代次数 $N$ 就是[独立样本](@entry_id:177139)数乘以依赖因子：$N = N_{min} \times I$ 。
    $$
    N = \left\lceil \frac{z_{(1+s)/2}^2 \, q(1-q)}{r^2} \times \frac{1+\hat{\lambda}}{1-\hat{\lambda}} \right\rceil
    $$
    其中 $\hat{\lambda} = 1-\hat{a}-\hat{b}$ 是从试点运行中估计的次[特征值](@entry_id:154894)。该诊断还会给出所需的[老化期](@entry_id:747019)长度。

### 高级主题与稳健诊断

标准的诊断工具在面对具有挑战性的后验分布时可能会失效。例如，存在缓慢趋势的非平稳链，或具有[重尾](@entry_id:274276)（可能导致[方差](@entry_id:200758)无穷）的后验。现代诊断方法通过对标准方法进行改进来提高其稳健性。

#### Split-$\hat{R}$：检测[非平稳性](@entry_id:180513)

一个看似收敛的链（例如，其unsplit-$\hat{R}$接近1）可能内部存在缓慢的漂移或趋势。**Split-$\hat{R}$** 通过将每条链分成前后两半，然后将这 $2M$ 个半链视为独立的链来计算$\hat{R}$，从而提高了对**[非平稳性](@entry_id:180513)（non-stationarity）**的敏感度。

例如，如果所有链都在从负值向正值缓慢漂移，那么每条链的前半段均值都会系统性地低于后半段均值。当计算split-$\hat{R}$时，这会导致巨大的链间[方差](@entry_id:200758)（因为所有前半段的均值聚在一块，所有后半段的均值聚在另一块），从而得到一个远大于1的 $\hat{R}$ 值，正确地警示了[非平稳性](@entry_id:180513) 。

#### Rank-Normalized-$\hat{R}$ 与 Folded-$\hat{R}$：处理[重尾分布](@entry_id:142737)

在[数据同化](@entry_id:153547)中，使用如Student-t分布等[重尾](@entry_id:274276)误差模型是常见的，这会导致[重尾](@entry_id:274276)的[后验分布](@entry_id:145605)。[重尾分布](@entry_id:142737)会产生极端离群值，这会使基于样本矩（如均值和[方差](@entry_id:200758)）的$\hat{R}$变得极不稳定。

- **秩归一化（Rank-Normalization）**：为了解决这个问题，可以先将所有链的所有样本汇集在一起，计算每个样本的秩，然后通过标准正态分布的逆CDF将秩转换为近似正态的分数。在这些秩归一化后的值上计算$\hat{R}$。这个过程有两大好处：(1) 它对任意单调变换都是不变的；(2) 它将离群值的影响“压缩”到一个有界范围内，使得诊断对于重尾和[无限方差](@entry_id:637427)的[分布](@entry_id:182848)依然**稳健（robust）** 。

- **折叠（Folding）**：有时链可能在均值上一致，但在尾部探索上不一致。**折叠变换** $x \mapsto |x - \text{median}(x)|$ 将关于位置的探索问题转化为关于尺度（离散度）的探索问题。对折叠后的样本计算$\hat{R}$，可以检测出一条链是否比其他链更倾向于探索尾部。

这两种技术可以结合使用，提供对收敛性更全面的、不受离群值和参数化影响的评估。例如，秩归一化可以防止离群值伪造出大的$\hat{R}$值，而折叠变换则可以进一步检查链在尾部行为上是否一致 。

总之，没有任何单一的诊断工具是万能的。在实践中，应结合使用多种诊断方法——包括可视化工具（如[迹线](@entry_id:261720)图）和多种定量诊断（如 $\hat{R}$, ESS, Geweke）——从不同角度审视MCMC输出，以建立对其可靠性的信心。