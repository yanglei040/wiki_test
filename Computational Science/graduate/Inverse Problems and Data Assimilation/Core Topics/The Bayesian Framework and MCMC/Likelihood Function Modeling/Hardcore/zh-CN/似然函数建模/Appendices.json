{
    "hands_on_practices": [
        {
            "introduction": "许多逆问题从业者习惯于将问题构建为最小二乘形式，但这本质上是假设误差服从具有已知方差的高斯分布。当我们放松这些假设时，草率地简化似然函数可能会导致严重的后果。本练习  揭示了这种过度简化的隐藏危险，通过一个假设场景，我们将会发现，错误地忽略一个依赖于参数的归一化项会导致一个系统性偏差的估计器。这个例子强调了构建完整且理论上正确的似然函数对于可靠的参数推断是多么重要。",
            "id": "3397329",
            "problem": "考虑一个常用于启发逆问题和数据同化中似然构建的简单标量观测模型。设 $\\{y_i\\}_{i=1}^{n}$ 是来自一个高斯测量模型的独立同分布（i.i.d.）样本，其均值和方差依赖于参数，由 $y_i \\mid \\theta \\sim \\mathcal{N}(\\theta, \\theta)$ 给出，其中 $\\theta \\in (0,\\infty)$ 是待估计的未知物理参数。\n\n已知，高斯模型的科学上正确的似然必须包含依赖于协方差行列式的归一化因子。在此一维情境下，归一化因子是 $\\theta$ 的函数。然而，一位分析师错误地构建了一个不当伪似然，方法是删除了每一个依赖于 $\\theta$ 的归一化因子，并仅保留了指数项。这等价于最大化一个仅由指数中的负二次型构建的似然。\n\n仅使用第一性原理，即独立高斯数据的似然定义和样本均值的标准极限定理，执行以下步骤：\n\n1. 从高斯密度的定义和 $\\{y_i\\}_{i=1}^{n}$ 的独立性出发，写下正确的对数似然和不当伪对数似然（省略了所有依赖于 $\\theta$ 的归一化因子）。仔细指明在形成不当伪对数似然时删除了哪一项。\n2. 推导不当伪对数似然在 $\\theta \\in (0,\\infty)$ 上的最大化子 $\\tilde{\\theta}_n$。\n3. 在真实数据生成参数 $\\theta_0 \\in (0,\\infty)$ 下，计算当 $n \\to \\infty$ 时 $\\tilde{\\theta}_n$ 的概率极限（依概率收敛意义下），并将你的答案表示为 $\\theta_0$ 的闭式函数。\n\n你的最终答案必须是该概率极限的单个闭式解析表达式。无需四舍五入，也不涉及单位。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、是良定的和客观的。\n\n### 问题验证\n\n**第1步：提取已知条件**\n- 数据 $\\{y_i\\}_{i=1}^{n}$ 是独立同分布（i.i.d.）的样本。\n- 数据生成模型是一个高斯分布，其均值和方差都等于未知参数 $\\theta$：$y_i \\mid \\theta \\sim \\mathcal{N}(\\theta, \\theta)$。\n- $\\theta$ 的参数空间是 $(0, \\infty)$。\n- 通过从正确的似然中删除所有依赖于 $\\theta$ 的归一化因子来构建一个不当伪似然，这等价于从指数中的负二次型构建似然。\n- 真实的数据生成参数值表示为 $\\theta_0 \\in (0, \\infty)$。\n\n**第2步：使用提取的已知条件进行验证**\n- **有科学依据**：该问题基于统计推断的既定原则，即高斯模型的最大似然估计。所选模型 $\\mathcal{N}(\\theta, \\theta)$ 是一个有效的统计模型，它提供了一个非平凡但易于处理的情境，用以探讨模型设定错误的后果。该问题在数学上和科学上都是合理的。\n- **良定性**：该问题是良定的。它提供了所有必要的信息：统计模型、正确似然和不当似然的定义，以及一个明确的目标。任务序列导向一个唯一且有意义的解。\n- **客观性**：该问题以精确、客观的语言陈述，没有主观论断或模糊不清之处。\n\n该问题没有表现出任何诸如科学上不合理、信息缺失或病态结构等缺陷。这是一个理论统计学中的标准、有效的问题，与逆问题和数据同化领域相关，在这些领域中，正确的似然设定至关重要。\n\n**第3步：结论与行动**\n问题被判定为**有效**。将提供完整解答。\n\n### 解答推导\n\n解答过程遵循问题陈述中概述的三个步骤。\n\n**1. 正确与不当的对数似然**\n\n来自高斯分布 $\\mathcal{N}(\\mu, \\sigma^2)$ 的单个观测值 $y_i$ 的概率密度函数（PDF）由 $f(y_i \\mid \\mu, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_i - \\mu)^2}{2\\sigma^2}\\right)$ 给出。\n在本问题中，均值为 $\\mu = \\theta$，方差为 $\\sigma^2 = \\theta$。将这些代入PDF中得到：\n$$f(y_i \\mid \\theta) = \\frac{1}{\\sqrt{2\\pi\\theta}} \\exp\\left(-\\frac{(y_i - \\theta)^2}{2\\theta}\\right)$$\n由于观测值 $\\{y_i\\}_{i=1}^{n}$ 是独立同分布的，总似然函数 $L(\\theta \\mid \\{y_i\\})$ 是各个PDF的乘积：\n$$L(\\theta) = \\prod_{i=1}^{n} f(y_i \\mid \\theta) = \\prod_{i=1}^{n} \\frac{1}{(2\\pi\\theta)^{1/2}} \\exp\\left(-\\frac{(y_i - \\theta)^2}{2\\theta}\\right)$$\n$$L(\\theta) = (2\\pi\\theta)^{-n/2} \\exp\\left(-\\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i - \\theta)^2\\right)$$\n正确的对数似然函数 $\\ell(\\theta)$ 是 $L(\\theta)$ 的自然对数：\n$$\\ell(\\theta) = \\ln(L(\\theta)) = \\ln\\left((2\\pi\\theta)^{-n/2}\\right) + \\ln\\left(\\exp\\left(-\\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i - \\theta)^2\\right)\\right)$$\n$$\\ell(\\theta) = -\\frac{n}{2}\\ln(2\\pi\\theta) - \\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i - \\theta)^2$$\n$$\\ell(\\theta) = -\\frac{n}{2}\\ln(2\\pi) - \\frac{n}{2}\\ln(\\theta) - \\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i - \\theta)^2$$\n问题陈述，不当伪似然是通过删除所有依赖于 $\\theta$ 的归一化因子形成的。在完整似然 $L(\\theta)$ 中，项 $(2\\pi\\theta)^{-n/2}$ 包含了归一化因子。其中依赖于 $\\theta$ 的部分是 $\\theta^{-n/2}$。在对数似然 $\\ell(\\theta)$ 中，这对应于项 $-\\frac{n}{2}\\ln(\\theta)$。删除此项（以及不影响最大化的常数项 $-\\frac{n}{2}\\ln(2\\pi)$）即可得到不当伪对数似然 $\\tilde{\\ell}(\\theta)$：\n$$\\tilde{\\ell}(\\theta) = -\\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i - \\theta)^2$$\n这与问题描述中仅保留指数项的对数相符。从正确对数似然中删除以得到不当似然核的项正是 $-\\frac{n}{2}\\ln(\\theta)$。\n\n**2. 不当最大化子 $\\tilde{\\theta}_n$ 的推导**\n\n为求不当伪对数似然 $\\tilde{\\ell}(\\theta)$ 的最大化子 $\\tilde{\\theta}_n$，我们首先展开表达式，然后对 $\\theta$ 求导。\n$$\\tilde{\\ell}(\\theta) = -\\frac{1}{2\\theta}\\sum_{i=1}^{n} (y_i^2 - 2y_i\\theta + \\theta^2) = -\\frac{1}{2\\theta}\\left(\\sum_{i=1}^{n}y_i^2 - 2\\theta\\sum_{i=1}^{n}y_i + n\\theta^2\\right)$$\n$$\\tilde{\\ell}(\\theta) = -\\frac{1}{2\\theta}\\sum_{i=1}^{n}y_i^2 + \\sum_{i=1}^{n}y_i - \\frac{n\\theta}{2}$$\n现在，我们计算关于 $\\theta$ 的一阶导数，并令其为零以找到临界点：\n$$\\frac{d\\tilde{\\ell}}{d\\theta} = \\frac{d}{d\\theta}\\left(-\\frac{1}{2}\\theta^{-1}\\sum_{i=1}^{n}y_i^2 + \\sum_{i=1}^{n}y_i - \\frac{n\\theta}{2}\\right) = \\frac{1}{2}\\theta^{-2}\\sum_{i=1}^{n}y_i^2 - \\frac{n}{2}$$\n将导数设为零：\n$$\\frac{1}{2\\theta^2}\\sum_{i=1}^{n}y_i^2 - \\frac{n}{2} = 0 \\implies \\frac{1}{\\theta^2}\\sum_{i=1}^{n}y_i^2 = n$$\n$$\\theta^2 = \\frac{1}{n}\\sum_{i=1}^{n}y_i^2$$\n由于参数空间为 $\\theta \\in (0,\\infty)$，我们取正平方根。最大化子 $\\tilde{\\theta}_n$ 是：\n$$\\tilde{\\theta}_n = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}y_i^2}$$\n为确认这是一个最大值点，我们检查二阶导数：\n$$\\frac{d^2\\tilde{\\ell}}{d\\theta^2} = \\frac{d}{d\\theta}\\left(\\frac{1}{2}\\theta^{-2}\\sum_{i=1}^{n}y_i^2 - \\frac{n}{2}\\right) = -\\theta^{-3}\\sum_{i=1}^{n}y_i^2 = -\\frac{1}{\\theta^3}\\sum_{i=1}^{n}y_i^2$$\n对于 $\\theta > 0$ 并假设并非所有 $y_i$ 都为零（一个零概率事件），则有 $\\sum y_i^2 > 0$，因此 $\\frac{d^2\\tilde{\\ell}}{d\\theta^2}  0$。这证实了 $\\tilde{\\theta}_n$ 确实是一个局部最大值点。由于它是 $(0, \\infty)$ 中唯一的临界点，因此它是全局最大化子。\n\n**3. $\\tilde{\\theta}_n$ 的概率极限**\n\n我们需要计算当 $n \\to \\infty$ 时 $\\tilde{\\theta}_n$ 的概率极限。真实数据是从 $\\mathcal{N}(\\theta_0, \\theta_0)$ 中独立同分布生成的。\n$$\\text{plim}_{n\\to\\infty} \\tilde{\\theta}_n = \\text{plim}_{n\\to\\infty} \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}y_i^2}$$\n平方根内的表达式 $\\frac{1}{n}\\sum_{i=1}^{n}y_i^2$ 是随机变量 $Z_i = y_i^2$ 的样本均值。根据大数定律，独立同分布随机变量的样本均值依概率收敛于它们的期望值，前提是期望存在。\n$$\\frac{1}{n}\\sum_{i=1}^{n}y_i^2 \\xrightarrow{p} E[y^2]$$\n此处的期望是关于真实数据生成分布 $y \\sim \\mathcal{N}(\\theta_0, \\theta_0)$ 计算的。二阶矩 $E[y^2]$ 可以通过均值 $E[y]$ 和方差 $\\text{Var}(y)$ 使用公式 $E[y^2] = \\text{Var}(y) + (E[y])^2$ 计算得出。对于我们的分布，我们有：\n$$E[y] = \\theta_0$$\n$$\\text{Var}(y) = \\theta_0$$\n将这些代入二阶矩的公式中得到：\n$$E[y^2] = \\theta_0 + (\\theta_0)^2 = \\theta_0 + \\theta_0^2$$\n现在，我们应用连续映射定理。由于平方根函数 $g(x)=\\sqrt{x}$ 在 $x  0$ 上是连续的，并且 $\\theta_0  0$ 意味着 $\\theta_0 + \\theta_0^2  0$，我们可以将概率极限移入函数内部：\n$$\\text{plim}_{n\\to\\infty} \\tilde{\\theta}_n = \\sqrt{\\text{plim}_{n\\to\\infty} \\frac{1}{n}\\sum_{i=1}^{n}y_i^2} = \\sqrt{E[y^2]}$$\n因此，不当估计量的概率极限是：\n$$\\text{plim}_{n\\to\\infty} \\tilde{\\theta}_n = \\sqrt{\\theta_0 + \\theta_0^2}$$\n这个结果表明，从不当伪似然推导出的估计量是不一致的，因为它不收敛于真实的参数值 $\\theta_0$。",
            "answer": "$$\\boxed{\\sqrt{\\theta_0 + \\theta_0^2}}$$"
        },
        {
            "introduction": "在认识到构建正确模型的重要性之后，我们现在转向一个更实际的挑战：真实世界的观测数据常常包含不符合简单高斯假设的离群值（outliers）。本练习  介绍了一种强大的工具——高斯混合模型（Gaussian Mixture Model, GMM），它能够为具有重尾（heavy-tailed）特征的误差分布构建更稳健的似然函数。我们将推导期望最大化（Expectation-Maximization, EM）算法来拟合该模型，这是处理数据中潜在变量和复杂结构的一项基石技术。",
            "id": "3397447",
            "problem": "考虑一个一维逆问题，其观测模型由 $y_i = h_i(x) + \\varepsilon_i$ 给出（$i = 1, \\dots, N$），其中 $x$ 表示未知状态，$h_i(x)$ 是在 $x$ 处求值的已知正演模型。假设在当前迭代点 $x^{(t)}$，残差 $r_i = y_i - h_i(x^{(t)})$ 被建模为来自双组分高斯混合分布的独立抽样，以捕捉重尾误差过程：残差以概率 $\\pi_1$ 从 $\\mathcal{N}(\\mu_1, \\sigma_1^2)$（“内点”组分）中抽取，以概率 $\\pi_2$ 从 $\\mathcal{N}(\\mu_2, \\sigma_2^2)$（“离群点”组分）中抽取，其中 $\\pi_1 + \\pi_2 = 1$，$\\sigma_1^2$ 和 $\\sigma_2^2$ 是已知的正常数，且 $\\sigma_1^2 \\ll \\sigma_2^2$。均值 $\\mu_1$、$\\mu_2$ 和权重 $\\pi_1$、$\\pi_2$ 是未知的，必须进行估计。目标是建立似然函数模型，并使用期望最大化（EM; Expectation-Maximization）算法推导估算更新。\n\n从混合模型的观测数据似然的基本定义出发，并引入潜在指示变量 $z_{ik} \\in \\{0,1\\}$（其中 $k \\in \\{1,2\\}$ 且 $z_{i1} + z_{i2} = 1$），为该混合误差模型推导 EM 算法：\n\n1. 推导期望步骤（E-step）的“责任”（responsibilities）$\\gamma_{ik} = \\mathbb{E}[z_{ik} \\mid r_i, \\theta^{(t)}]$，其中 $\\theta^{(t)} = (\\pi_1^{(t)}, \\pi_2^{(t)}, \\mu_1^{(t)}, \\mu_2^{(t)})$ 表示当前的参数估计值。\n2. 推导最大化步骤（M-step）中混合权重和均值的参数更新，假设方差 $\\sigma_1^2$ 和 $\\sigma_2^2$ 是固定的已知值。您的推导必须仅使用核心原理，包括独立似然的乘积形式、混合模型的定义以及 EM 所需的 Jensen 不等式，避免使用任何预先给出的简化公式。\n3. 分析此模型 EM 算法的收敛性质，解释为什么观测数据的对数似然在迭代过程中是非递减的，并描述不动点的性质。在固定方差与自由方差的背景下，讨论与混合模型相关的潜在退化和病态问题（例如标签切换对称性、组分坍缩和似然奇点），并指出在此特定设置下缓解这些问题的条件。\n\n最后，对于任意残差 $r_i$ 和当前参数值 $(\\pi_1, \\pi_2, \\mu_1, \\mu_2)$ 以及已知的 $\\sigma_1^2, \\sigma_2^2$，给出内点组分的责任 $\\gamma_{i1}$ 的闭式解析表达式。这个单一表达式是您最终答案中唯一需要返回的量。无需四舍五入，不涉及单位；请用精确的符号形式表示您的答案。",
            "solution": "首先根据指定标准验证问题。\n\n### 步骤 1：提取已知条件\n-   **观测模型**：$y_i = h_i(x) + \\varepsilon_i$，对于 $i = 1, \\dots, N$。\n-   **未知状态**：$x$。\n-   **正演模型**：$h_i(x)$ 已知。\n-   **当前迭代点**：$x^{(t)}$。\n-   **残差**：$r_i = y_i - h_i(x^{(t)})$。\n-   **误差模型**：残差 $r_i$ 是来自双组分高斯混合分布的独立抽样。\n-   **组分 1 (内点)**：以概率 $\\pi_1$ 从 $\\mathcal{N}(\\mu_1, \\sigma_1^2)$ 中抽取。\n-   **组分 2 (离群点)**：以概率 $\\pi_2$ 从 $\\mathcal{N}(\\mu_2, \\sigma_2^2)$ 中抽取。\n-   **混合约束**：$\\pi_1 + \\pi_2 = 1$。\n-   **已知参数**：方差 $\\sigma_1^2$ 和 $\\sigma_2^2$ 是已知的正常数，且 $\\sigma_1^2 \\ll \\sigma_2^2$。\n-   **待估参数**：均值 $\\mu_1, \\mu_2$ 和混合权重 $\\pi_1, \\pi_2$。\n-   **潜在变量**：指示变量 $z_{ik} \\in \\{0,1\\}$，对于 $k \\in \\{1,2\\}$ 且 $z_{i1} + z_{i2} = 1$，其中如果残差 $r_i$ 源于组分 $k$，则 $z_{ik}=1$。\n-   **参数向量**：$\\theta = (\\pi_1, \\pi_2, \\mu_1, \\mu_2)$。当前估计值为 $\\theta^{(t)}$。\n-   **任务 1**：推导 E-步的责任 $\\gamma_{ik} = \\mathbb{E}[z_{ik} \\mid r_i, \\theta^{(t)}]$。\n-   **任务 2**：推导 M-步中 $\\pi_k$ 和 $\\mu_k$ 的参数更新。\n-   **任务 3**：分析此模型 EM 算法的收敛性和潜在病态问题。\n-   **最终答案**：提供内点责任 $\\gamma_{i1}$ 的闭式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n评估问题的有效性。\n-   **科学基础**：该问题描述了期望最大化 (EM) 算法在高斯混合模型 (GMM) 中的应用。这是统计学、机器学习和数据同化中用于建模异构数据和进行稳健估计的一项标准和基础技术。在逆问题中使用重尾混合模型来处理残差是一种科学上合理的方法，用于处理离群点。\n-   **适定性**：该问题定义良好。它提供了清晰的模型规范，并要求推导 EM 算法的具体步骤、分析其性质以及一个最终的、特定的数学表达式。推导的每个部分都存在唯一且有意义的解。\n-   **客观性**：该问题以精确、客观、形式化的数学语言陈述。它没有任何主观或模糊的术语。\n\n该问题没有指令中列出的任何缺陷。它在科学上是合理的、自洽的并且可以形式化。约束条件（固定方差）被明确陈述，并且是分析的关键。因此，该问题被认定为有效。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n***\n\n按照要求，解答分三部分推导。令 $\\theta = (\\pi_1, \\pi_2, \\mu_1, \\mu_2)$ 为待估计的参数向量。方差 $\\sigma_1^2$ 和 $\\sigma_2^2$ 是已知的常数。给定一组 $N$ 个残差 $R = \\{r_1, \\dots, r_N\\}$。\n\n在此混合模型下，单个残差 $r_i$ 的概率密度函数 (PDF) 为：\n$$p(r_i \\mid \\theta) = \\sum_{k=1}^2 \\pi_k \\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2)$$\n其中 $\\mathcal{N}(r \\mid \\mu, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(r-\\mu)^2}{2\\sigma^2}\\right)$ 是高斯 PDF。\n\n我们引入潜在指示变量 $z_{ik} \\in \\{0,1\\}$，使得如果 $r_i$ 由组分 $k$ 生成，则 $z_{ik}=1$，否则 $z_{ik}=0$，且 $\\sum_{k=1}^2 z_{ik}=1$。所有潜在变量的集合是 $Z = \\{z_{ik}\\}_{i=1, k=1}^{N, 2}$。单个观测 $(r_i, z_i)$ 的完全数据似然是 $p(r_i, z_i \\mid \\theta) = \\prod_{k=1}^2 [\\pi_k \\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2)]^{z_{ik}}$。\n\n### 1. E-步：责任的推导\n期望步骤（E-step）计算给定观测数据和当前参数估计值 $\\theta^{(t)}$ 时潜在变量的期望。这个期望是第 $k$ 个组分产生观测值 $r_i$ 的后验概率，称为责任，记为 $\\gamma_{ik}$。\n\n$$ \\gamma_{ik} \\equiv \\mathbb{E}[z_{ik} \\mid r_i, \\theta^{(t)}] = P(z_{ik}=1 \\mid r_i, \\theta^{(t)}) $$\n\n使用贝叶斯定理，这个后验概率是：\n$$ \\gamma_{ik} = \\frac{P(r_i \\mid z_{ik}=1, \\theta^{(t)}) P(z_{ik}=1 \\mid \\theta^{(t)})}{P(r_i \\mid \\theta^{(t)})} $$\n\n各项可确定为：\n-   $P(r_i \\mid z_{ik}=1, \\theta^{(t)}) = \\mathcal{N}(r_i \\mid \\mu_k^{(t)}, \\sigma_k^2)$ 是在给定 $r_i$ 来自组分 $k$ 的条件下观测到 $r_i$ 的似然。\n-   $P(z_{ik}=1 \\mid \\theta^{(t)}) = \\pi_k^{(t)}$ 是选择组分 $k$ 的先验概率。\n-   $P(r_i \\mid \\theta^{(t)}) = \\sum_{j=1}^2 P(r_i \\mid z_{ij}=1, \\theta^{(t)}) P(z_{ij}=1 \\mid \\theta^{(t)}) = \\sum_{j=1}^2 \\pi_j^{(t)} \\mathcal{N}(r_i \\mid \\mu_j^{(t)}, \\sigma_j^2)$ 是 $r_i$ 的边际似然，通过对所有可能的组分求和得到。\n\n将这些代入 $\\gamma_{ik}$ 的表达式中，得到 E-步的更新规则：\n$$ \\gamma_{ik} = \\frac{\\pi_k^{(t)} \\mathcal{N}(r_i \\mid \\mu_k^{(t)}, \\sigma_k^2)}{\\sum_{j=1}^2 \\pi_j^{(t)} \\mathcal{N}(r_i \\mid \\mu_j^{(t)}, \\sigma_j^2)} $$\n对每个数据点 $i=1, \\dots, N$ 和每个组分 $k=1, 2$ 计算这些责任值。\n\n### 2. M-步：参数更新的推导\n最大化步骤（M-step）更新参数 $\\theta$ 以最大化期望的完全数据对数似然 $Q(\\theta \\mid \\theta^{(t)})$，其中期望是关于在 E-步中计算的潜在变量的后验分布来求的。\n\n整个数据集 $R$ 和潜在变量 $Z$ 的完全数据对数似然为：\n$$ \\ln p(R, Z \\mid \\theta) = \\ln \\left( \\prod_{i=1}^N \\prod_{k=1}^2 [\\pi_k \\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2)]^{z_{ik}} \\right) = \\sum_{i=1}^N \\sum_{k=1}^2 z_{ik} \\left( \\ln \\pi_k + \\ln \\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2) \\right) $$\n\n在 M-步中要最大化的函数是 $Q(\\theta \\mid \\theta^{(t)}) = \\mathbb{E}_{Z \\mid R, \\theta^{(t)}}[\\ln p(R, Z \\mid \\theta)]$:\n$$ Q(\\theta \\mid \\theta^{(t)}) = \\sum_{i=1}^N \\sum_{k=1}^2 \\mathbb{E}[z_{ik}] \\left( \\ln \\pi_k + \\ln \\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2) \\right) $$\n其中 $\\mathbb{E}[z_{ik}]$ 是在 E-步中计算的责任 $\\gamma_{ik}$。\n$$ Q(\\theta \\mid \\theta^{(t)}) = \\sum_{i=1}^N \\sum_{k=1}^2 \\gamma_{ik} \\left( \\ln \\pi_k - \\frac{1}{2}\\ln(2\\pi\\sigma_k^2) - \\frac{(r_i - \\mu_k)^2}{2\\sigma_k^2} \\right) $$\n\n我们对该函数关于 $\\mu_k$ 和 $\\pi_k$ 进行最大化。\n\n**均值 $\\mu_k$ 的更新**：\n我们通过将 $Q$ 对 $\\mu_k$ 的偏导数设为零来找到最大值。我们只需要考虑包含 $\\mu_k$ 的项。\n$$ \\frac{\\partial Q}{\\partial \\mu_k} = \\frac{\\partial}{\\partial \\mu_k} \\sum_{i=1}^N \\gamma_{ik} \\left( -\\frac{(r_i - \\mu_k)^2}{2\\sigma_k^2} \\right) = \\sum_{i=1}^N \\gamma_{ik} \\left( \\frac{r_i - \\mu_k}{\\sigma_k^2} \\right) = 0 $$\n由于 $\\sigma_k^2  0$，我们可以将其乘掉：\n$$ \\sum_{i=1}^N \\gamma_{ik} (r_i - \\mu_k) = 0 \\implies \\sum_{i=1}^N \\gamma_{ik} r_i - \\mu_k \\sum_{i=1}^N \\gamma_{ik} = 0 $$\n求解 $\\mu_k$ 得到新估计值 $\\mu_k^{(t+1)}$ 的更新规则：\n$$ \\mu_k^{(t+1)} = \\frac{\\sum_{i=1}^N \\gamma_{ik} r_i}{\\sum_{i=1}^N \\gamma_{ik}} $$\n这是残差的加权平均，权重是责任值。令 $N_k = \\sum_{i=1}^N \\gamma_{ik}$ 为分配给组分 $k$ 的有效点数。则 $\\mu_k^{(t+1)} = \\frac{1}{N_k} \\sum_{i=1}^N \\gamma_{ik} r_i$。\n\n**混合权重 $\\pi_k$ 的更新**：\n我们在约束条件 $\\sum_{k=1}^2 \\pi_k = 1$ 下最大化 $Q$ 中包含 $\\pi_k$ 的项。$Q$ 的相关部分是 $\\sum_{i=1}^N \\sum_{k=1}^2 \\gamma_{ik} \\ln \\pi_k$。我们使用拉格朗日乘子 $\\lambda$：\n$$ \\mathcal{L}(\\pi_1, \\pi_2, \\lambda) = \\sum_{i=1}^N \\sum_{k=1}^2 \\gamma_{ik} \\ln \\pi_k + \\lambda \\left( \\sum_{k=1}^2 \\pi_k - 1 \\right) $$\n对 $\\pi_k$ 求导并设为零：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial \\pi_k} = \\sum_{i=1}^N \\frac{\\gamma_{ik}}{\\pi_k} + \\lambda = 0 \\implies \\pi_k = -\\frac{\\sum_{i=1}^N \\gamma_{ik}}{\\lambda} = -\\frac{N_k}{\\lambda} $$\n对 $k$ 求和并使用约束条件：\n$$ \\sum_{k=1}^2 \\pi_k = 1 \\implies \\sum_{k=1}^2 \\left(-\\frac{N_k}{\\lambda}\\right) = 1 \\implies -\\frac{1}{\\lambda} \\sum_{k=1}^2 N_k = 1 $$\n我们知道 $\\sum_{k=1}^2 N_k = \\sum_{k=1}^2 \\sum_{i=1}^N \\gamma_{ik} = \\sum_{i=1}^N \\sum_{k=1}^2 \\gamma_{ik} = \\sum_{i=1}^N 1 = N$。\n因此，$-\\frac{N}{\\lambda} = 1 \\implies \\lambda = -N$。\n将 $\\lambda$ 代回到 $\\pi_k$ 的表达式中：\n$$ \\pi_k^{(t+1)} = -\\frac{N_k}{(-N)} = \\frac{N_k}{N} = \\frac{\\sum_{i=1}^N \\gamma_{ik}}{N} $$\n这是组分 $k$ 在所有数据点上的平均责任。\n\n### 3. 收敛性质与病态问题\n**收敛性**：EM 算法产生一个参数估计序列 $\\theta^{(t)}$，使得观测数据的对数似然 $\\ell(\\theta^{(t)}) = \\ln p(R|\\theta^{(t)}) = \\sum_{i=1}^N \\ln p(r_i|\\theta^{(t)})$ 在每次迭代中都是非递减的，即 $\\ell(\\theta^{(t+1)}) \\geq \\ell(\\theta^{(t)})$。该性质源于对数似然与 $Q$ 函数之间的关系。对数似然的变化可以写为：\n$$ \\ell(\\theta) - \\ell(\\theta^{(t)}) = [Q(\\theta|\\theta^{(t)}) - Q(\\theta^{(t)}|\\theta^{(t)})] + [\\text{KL}(p(Z|R,\\theta^{(t)})||p(Z|R,\\theta))] $$\n其中 KL 是 Kullback-Leibler 散度。M-步旨在找到最大化 $Q(\\theta|\\theta^{(t)})$ 的 $\\theta^{(t+1)}$，因此第一项 $[Q(\\theta^{(t+1)}|\\theta^{(t)}) - Q(\\theta^{(t)}|\\theta^{(t)})]$ 是非负的。KL 散度总是非负的。因此，设置 $\\theta = \\theta^{(t+1)}$ 保证了 $\\ell(\\theta^{(t+1)}) - \\ell(\\theta^{(t)}) \\geq 0$。由于对数似然有上界（如下所示），序列 $\\ell(\\theta^{(t)})$ 必须收敛到似然函数的一个稳定点（局部最大值或鞍点）。\n\n**病态问题**：\n1.  **标签切换对称性**：混合模型的似然函数对于组分索引的置换是不变的。即，$p(r_i \\mid \\pi_1, \\mu_1, \\sigma_1^2; \\pi_2, \\mu_2, \\sigma_2^2) = p(r_i \\mid \\pi_2, \\mu_2, \\sigma_2^2; \\pi_1, \\mu_1, \\sigma_1^2)$。这意味着似然曲面有多个等价的最大值。在这个问题中，条件 $\\sigma_1^2 \\ll \\sigma_2^2$ 通过将组分 1 识别为“内点”，组分 2 识别为“离群点”，提供了一种打破这种对称性的自然方式，从而使解具有可解释性。\n\n2.  **似然奇点（组分坍缩）**：这是 GMM 中一个严重的病态问题，当方差也需要估计时会出现。如果某个组分的均值 $\\mu_k$ 变得等于一个数据点 $r_i$，并且其方差 $\\sigma_k^2$ 被允许趋近于零，那么项 $\\mathcal{N}(r_i \\mid \\mu_k, \\sigma_k^2)$ 会趋于无穷大，使得总似然无界。这会导致一个虚假的、退化的解。**在这个具体问题中，这种病态问题被完全避免了，因为方差 $\\sigma_1^2$ 和 $\\sigma_2^2$ 被指定为已知的、固定的正常数。**在固定的正常数方差下，高斯 PDF $\\mathcal{N}(r \\mid \\mu, \\sigma^2)$ 对于所有的 $r$ 和 $\\mu$ 都是有界的。因此，对数似然函数也有上界，不会出现奇点。\n\n3.  **边界上的退化**：EM 算法可能会收敛到某个混合权重 $\\pi_k$ 趋近于 0 的解。如果某个组分对数据的解释能力非常差，以至于其责任值 $\\gamma_{ik}$ 对所有 $i$ 都变得可以忽略不计时，就会发生这种情况。虽然这有时被视为一种病态，但它也可能表明一个更简单的模型（具有更少的组分）足以描述数据。在这个双组分模型中，如果 $\\pi_2 \\to 0$，则意味着数据可以由单个高斯分布充分描述，而没有显著的离群点群体。如果非常希望得到一个双组分的解，可以对 $\\pi_k$ 使用正则化或贝叶斯先验来防止这种情况。\n\n最后的要求是，对于任意残差 $r_i$ 和当前参数 $(\\pi_1, \\pi_2, \\mu_1, \\mu_2)$，给出内点组分责任 $\\gamma_{i1}$ 的闭式表达式。基于 E-步的推导：\n$$ \\gamma_{i1} = \\frac{\\pi_1 \\mathcal{N}(r_i \\mid \\mu_1, \\sigma_1^2)}{\\pi_1 \\mathcal{N}(r_i \\mid \\mu_1, \\sigma_1^2) + \\pi_2 \\mathcal{N}(r_i \\mid \\mu_2, \\sigma_2^2)} $$\n代入高斯 PDF 的完整表达式：\n$$ \\gamma_{i1} = \\frac{\\pi_1 \\frac{1}{\\sqrt{2\\pi\\sigma_1^2}} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right)}{\\pi_1 \\frac{1}{\\sqrt{2\\pi\\sigma_1^2}} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right) + \\pi_2 \\frac{1}{\\sqrt{2\\pi\\sigma_2^2}} \\exp\\left(-\\frac{(r_i - \\mu_2)^2}{2\\sigma_2^2}\\right)} $$\n分子和分母中的公因子 $\\frac{1}{\\sqrt{2\\pi}}$ 可以消去：\n$$ \\gamma_{i1} = \\frac{\\frac{\\pi_1}{\\sigma_1} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right)}{\\frac{\\pi_1}{\\sigma_1} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right) + \\frac{\\pi_2}{\\sigma_2} \\exp\\left(-\\frac{(r_i - \\mu_2)^2}{2\\sigma_2^2}\\right)} $$\n这就是最终的解析表达式。",
            "answer": "$$\\boxed{\\frac{\\frac{\\pi_1}{\\sigma_1} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right)}{\\frac{\\pi_1}{\\sigma_1} \\exp\\left(-\\frac{(r_i - \\mu_1)^2}{2\\sigma_1^2}\\right) + \\frac{\\pi_2}{\\sigma_2} \\exp\\left(-\\frac{(r_i - \\mu_2)^2}{2\\sigma_2^2}\\right)}}$$"
        },
        {
            "introduction": "最后，我们来应对大规模数据同化中最严峻的挑战之一：如何为时空相关的误差建模。在地球物理学等领域，误差场通常在空间和时间上都存在强烈的相关性，直接处理由此产生的巨大协方差矩阵在计算上是不可行的。本练习  演示了一种在频域中处理该问题的优雅而高效的解决方案——Whittle似然。该方法将观测数据的周期图（periodogram）与误差谱密度的参数化模型直接联系起来，从而在处理大规模相关误差时极大地提高了计算效率。",
            "id": "3397430",
            "problem": "考虑一个定义在规则二维空间格点上的零均值、二阶平稳高斯时空误差场 $e(\\mathbf{s}, t)$，其空间索引为 $(i,j)$，$i=0,1,\\dots,N_x-1$，$j=0,1,\\dots,N_y-1$，时间索引为离散的 $k=0,1,\\dots,N_t-1$。令 $y_{i,j,k}$ 表示在该网格上采样的此误差场的单个实现。在反演问题和数据同化中，对 $p(y \\mid x)$（其中 $x$ 表示参数化谱密度的参数）进行建模的一种常用方法是使用 Whittle 似然近似在频域中进行处理。Whittle 近似利用了离散傅里叶变换 (DFT) 对卷积算子的对角化性质，以及对于大尺寸格点而言傅里叶系数的渐近独立性。你的任务是，在此近似下，根据周期图和参数化谱密度推导并实现负对数似然。\n\n从以下基本依据出发：\n- 零均值二阶平稳高斯随机场的定义及其谱表示。\n- 离散傅里叶变换 (DFT) 和快速傅里叶变换 (FFT) 的性质，特别是时/空域中的卷积对应于频域中的乘积。\n- 一阶离散时间自回归 (AR(1)) 过程的已知谱密度，以及在二维空间中平滑度参数为 $\\nu=\\frac{1}{2}$（指数协方差）的 Matérn 谱密度的已知函数形式。\n\n请按以下步骤进行，不要使用问题陈述中的现成公式：\n1. 推导观测场 $y_{i,j,k}$ 的负对数似然的 Whittle 近似，用周期图和参数化谱密度 $S_x(\\omega_t,\\omega_x,\\omega_y)$ 表示，其中角频率 $(\\omega_x,\\omega_y,\\omega_t)$ 的单位为弧度。推导必须从高斯场在谱域中的联合概率密度函数 (PDF) 开始，解释为什么对于大尺寸网格 DFT 能近似地将协方差矩阵对角化，并论证导致 Whittle 形式的傅里叶系数独立性近似的合理性。\n2. 构建一个形式为\n   $$S_x(\\omega_t,\\omega_x,\\omega_y) = \\sigma^2 \\, S_t(\\omega_t;\\phi) \\, S_s(\\omega_x,\\omega_y;\\kappa),$$\n   的可分离时空参数化谱密度，其中：\n   - $S_t(\\omega_t;\\phi)$ 是由自回归系数 $\\phi$（其中 $|\\phi|1$）参数化的一阶离散时间 AR(1) 过程的谱密度，并且必须使用时间序列分析的标准结果以 $\\omega_t$ 表示。\n   - $S_s(\\omega_x,\\omega_y;\\kappa)$ 对应于二维空间中平滑度为 $\\nu=\\frac{1}{2}$（指数协方差）的 Matérn 谱密度，由逆长度尺度 $\\kappa0$ 参数化，并且必须使用空间统计的标准结果以 $\\omega_x$ 和 $\\omega_y$ 表示。你可以将任何比例常数吸收到 $\\sigma^2$ 中。\n3. 实现一个程序，该程序：\n   - 通过\n     $$y_{i,j,k} = 0.7 \\sin\\!\\left(\\frac{2\\pi k}{N_t}\\right) \\cos\\!\\left(\\frac{2\\pi i}{N_x}\\right) + 0.3 \\cos\\!\\left(\\frac{2\\pi j}{N_y}\\right) \\sin\\!\\left(\\frac{2\\pi (i+j)}{N_x}\\right) + 0.1 \\sin\\!\\left(\\frac{2\\pi (k+i)}{N_t}\\right),$$\n     在大小为 $N_x=8$，$N_y=8$，$N_t=16$ 的网格上构建一个确定性的时空测试场，适用于所有 $i,j,k$，然后减去样本均值以强制零均值。角度单位为弧度。\n   - 计算三维 DFT $Y(\\omega_x,\\omega_y,\\omega_t)$ 和相应的周期图 $I(\\omega_x,\\omega_y,\\omega_t) = \\frac{1}{N_x N_y N_t}\\,\\big|Y(\\omega_x,\\omega_y,\\omega_t)\\big|^2$；这里 $\\omega_x$、$\\omega_y$ 和 $\\omega_t$ 是与 DFT 频率仓相关联的角频率（单位为弧度）。\n   - 对以下三个参数集 $x=(\\sigma^2,\\phi,\\kappa)$ 计算负 Whittle 对数似然（相差一个与 $x$ 无关的加法常数）：\n     - 情况 A（一般相关情况）：$(\\sigma^2,\\phi,\\kappa)=(1.0,\\,0.7,\\,0.8)$。\n     - 情况 B（近白噪声极限）：$(\\sigma^2,\\phi,\\kappa)=(1.0,\\,0.0,\\,100.0)$。\n     - 情况 C（强相关）：$(\\sigma^2,\\phi,\\kappa)=(2.0,\\,0.95,\\,0.2)$。\n   - 使用数值稳定的实现，在计算对数时确保谱密度严格为正。\n4. 将三个负对数似然值报告为无单位的浮点数。\n\n测试套件和输出规范：\n- 所列的三个参数集构成了测试套件：它们探测了典型的相关行为、近白噪声边界条件和强相关性。\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[resultA,resultB,resultC]”）。\n- 输出是无单位的，并且必须表示为浮点数；不涉及百分比或物理单位。\n\n你的实现必须是一个完整的、可运行的程序，遵循指定的执行环境和输出格式。不允许用户输入或外部文件。在整个推导和实现过程中，角度单位必须是弧度。",
            "solution": "我们从定义在格点上的一个零均值、二阶平稳高斯随机场 $e(\\mathbf{s}, t)$ 开始。平稳性意味着协方差仅依赖于滞后量，并且该场允许通过一个谱测度进行谱表示，该谱测度的密度即为谱密度。对于离散格点，我们在空间和时间上使用离散傅里叶变换 (DFT)。DFT 将原域中与平稳核的卷积映射为频域中与谱密度的乘积。这种对角化性质意味着，对于大尺寸网格，观测场的傅里叶系数近似表现为独立的复高斯随机变量，其方差等于在相应频率上求值的谱密度。这就是 Whittle 近似的本质。\n\n令 $Y(\\omega_x,\\omega_y,\\omega_t)$ 表示场 $y_{i,j,k}$ 的 DFT，并令 $(\\omega_x,\\omega_y,\\omega_t)$ 表示与 DFT 频率仓对应的角频率（单位为弧度）。在 Whittle 近似下，傅里叶系数的联合概率密度函数 (PDF) 近似地分解为复正态 PDF 的乘积，每个 PDF 的方差为参数化谱密度 $S_x(\\omega_x,\\omega_y,\\omega_t)$。忽略不依赖于 $x$ 的常数，负对数似然近似为对所有频率求和，求和项结合了谱密度的对数以及由谱密度倒数缩放的傅里叶系数的模平方。傅里叶系数的模平方，经样本数量归一化后，即为周期图\n$$I(\\omega_x,\\omega_y,\\omega_t) = \\frac{1}{N_x N_y N_t}\\, \\big|Y(\\omega_x,\\omega_y,\\omega_t)\\big|^2.$$\n将其代入 Whittle 形式，便得到近似负对数似然的标准表达式，即在频域上对一个关于 $\\log S_x$ 和 $I/S_x$ 的函数求和。这通过频域高斯似然近似，将周期图与 $p(y \\mid x)$ 直接联系起来。\n\n我们现在构建一个可分离的时空参数化谱密度\n$$S_x(\\omega_t,\\omega_x,\\omega_y) = \\sigma^2\\, S_t(\\omega_t;\\phi)\\, S_s(\\omega_x,\\omega_y;\\kappa),$$\n其中 $\\sigma^20$ 是一个振幅参数，$\\phi$ 是 AR(1) 自回归系数且 $|\\phi|1$，$\\kappa0$ 是空间逆长度尺度。\n\n时间分量。考虑一个一阶离散时间自回归 (AR(1)) 过程 $e_k = \\phi e_{k-1} + w_k$，其中白噪声新息 $w_k$ 的方差为 $\\sigma_w^2$ 且 $|\\phi|1$。该过程谱密度的常用公式，用角频率 $\\omega_t$ 表示为\n$$S_t(\\omega_t;\\phi) = \\frac{\\sigma_w^2}{\\big|1 - \\phi e^{-i\\omega_t}\\big|^2} = \\frac{\\sigma_w^2}{1 + \\phi^2 - 2\\phi \\cos(\\omega_t)}.$$\n由于我们在外部有一个全局振幅参数 $\\sigma^2$，我们可以将 $\\sigma_w^2$ 吸收到 $\\sigma^2$ 中，并使用无量纲的形式\n$$S_t(\\omega_t;\\phi) \\propto \\frac{1}{1 + \\phi^2 - 2\\phi \\cos(\\omega_t)}.$$\n\n空间分量。对于二维空间中平滑度为 $\\nu=\\tfrac{1}{2}$（指数协方差）的 Matérn 类，其谱密度已知与空间角频率平方的有理函数成正比。记 $\\omega = \\sqrt{\\omega_x^2 + \\omega_y^2}$，一个经过充分检验的函数形式为\n$$S_s(\\omega_x,\\omega_y;\\kappa) \\propto \\frac{1}{(\\kappa^2 + \\omega^2)^{\\nu + d/2}} = \\frac{1}{\\big(\\kappa^2 + \\omega_x^2 + \\omega_y^2\\big)^{3/2}},$$\n其中 $d=2$ 是空间维度，$\\nu=\\tfrac{1}{2}$ 给出指数 $\\nu + d/2 = \\tfrac{1}{2} + 1 = \\tfrac{3}{2}$。与时间分量一样，任何比例常数都可以被吸收到 $\\sigma^2$ 中。\n\n结合这些，我们得到参数化谱密度的形式\n$$S_x(\\omega_t,\\omega_x,\\omega_y) = \\sigma^2 \\,\\frac{1}{1 + \\phi^2 - 2\\phi \\cos(\\omega_t)} \\,\\frac{1}{\\big(\\kappa^2 + \\omega_x^2 + \\omega_y^2\\big)^{3/2}},$$\n其中 $\\sigma^2$ 捕捉了整体的缩放尺度。\n\n实现的算法步骤：\n1. 在指定的网格上构建确定性测试场：\n   $$y_{i,j,k} = 0.7 \\sin\\!\\left(\\frac{2\\pi k}{N_t}\\right) \\cos\\!\\left(\\frac{2\\pi i}{N_x}\\right) + 0.3 \\cos\\!\\left(\\frac{2\\pi j}{N_y}\\right) \\sin\\!\\left(\\frac{2\\pi (i+j)}{N_x}\\right) + 0.1 \\sin\\!\\left(\\frac{2\\pi (k+i)}{N_t}\\right),$$\n   其中 $N_x=8$，$N_y=8$，$N_t=16$。减去样本均值以强制零均值。\n2. 计算三维 FFT $Y(\\omega_x,\\omega_y,\\omega_t)$ 和周期图 $I(\\omega_x,\\omega_y,\\omega_t) = \\frac{1}{N_x N_y N_t}\\,\\big|Y(\\omega_x,\\omega_y,\\omega_t)\\big|^2$。通过 FFT 频率仓获取角频率（单位为弧度）：对于每个轴，计算 $\\omega = 2\\pi f$，其中 $f$ 由标准 FFT 频率数组给出。\n3. 对于每个参数集 $x=(\\sigma^2,\\phi,\\kappa)$：\n   - 计算 $S_t(\\omega_t;\\phi) = \\big(1 + \\phi^2 - 2\\phi \\cos(\\omega_t)\\big)^{-1}$。\n   - 计算 $S_s(\\omega_x,\\omega_y;\\kappa) = \\big(\\kappa^2 + \\omega_x^2 + \\omega_y^2\\big)^{-3/2}$。\n   - 构造 $S_x(\\omega_t,\\omega_x,\\omega_y) = \\sigma^2\\, S_t(\\omega_t;\\phi)\\, S_s(\\omega_x,\\omega_y;\\kappa)$。\n   - 为保证数值稳定性，在取对数之前对 $S_x$ 强制施加一个严格的正下界（例如，用一个小的 $\\epsilon0$ 进行截断）。\n   - 计算 Whittle 负对数似然（相差不依赖于 $x$ 的加法常数），即对所有频率求和 $\\log S_x(\\omega_t,\\omega_x,\\omega_y) + I(\\omega_t,\\omega_x,\\omega_y)/S_x(\\omega_t,\\omega_x,\\omega_y)$。\n4. 以单行、方括号括起的逗号分隔列表形式，输出与指定测试套件对应的三个无单位的负对数似然值。\n\n设计考量与覆盖范围：\n- 情况 A $(\\sigma^2,\\phi,\\kappa)=(1.0,\\,0.7,\\,0.8)$ 检验了时间和空间上的典型相关行为。\n- 情况 B $(\\sigma^2,\\phi,\\kappa)=(1.0,\\,0.0,\\,100.0)$ 在时间和空间上都趋近于白噪声，测试了谱因子的边界行为。\n- 情况 C $(\\sigma^2,\\phi,\\kappa)=(2.0,\\,0.95,\\,0.2)$ 引入了强相关性，测试了似然对近单位根时间行为和长程空间相关的敏感性。\n\n所有角度单位均为弧度，结果为无量纲浮点数。最终程序仅使用指定的库，无需输入，并精确打印一行包含三个结果的规定格式的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_field(Nx, Ny, Nt):\n    \"\"\"\n    Construct the deterministic spatio-temporal field and enforce zero mean.\n    y[i,j,k] = 0.7 * sin(2π k / Nt) * cos(2π i / Nx)\n             + 0.3 * cos(2π j / Ny) * sin(2π (i + j) / Nx)\n             + 0.1 * sin(2π (k + i) / Nt)\n    \"\"\"\n    i = np.arange(Nx).reshape(Nx, 1, 1)\n    j = np.arange(Ny).reshape(1, Ny, 1)\n    k = np.arange(Nt).reshape(1, 1, Nt)\n\n    two_pi = 2.0 * np.pi\n\n    term1 = 0.7 * np.sin(two_pi * k / Nt) * np.cos(two_pi * i / Nx)\n    term2 = 0.3 * np.cos(two_pi * j / Ny) * np.sin(two_pi * (i + j) / Nx)\n    term3 = 0.1 * np.sin(two_pi * (k + i) / Nt)\n\n    y = term1 + term2 + term3\n    y = y - np.mean(y)  # enforce zero mean\n    return y\n\ndef angular_frequencies(Nx, Ny, Nt):\n    \"\"\"\n    Compute angular frequency arrays (in radians) for each axis and broadcast to 3D.\n    \"\"\"\n    fx = np.fft.fftfreq(Nx)  # cycles per sample\n    fy = np.fft.fftfreq(Ny)\n    ft = np.fft.fftfreq(Nt)\n\n    wx = 2.0 * np.pi * fx  # radians\n    wy = 2.0 * np.pi * fy\n    wt = 2.0 * np.pi * ft\n\n    # Broadcast to 3D using separable shapes\n    WX = wx.reshape(Nx, 1, 1)\n    WY = wy.reshape(1, Ny, 1)\n    WT = wt.reshape(1, 1, Nt)\n    return WX, WY, WT\n\ndef periodogram(y):\n    \"\"\"\n    Compute the 3D FFT and periodogram I = |Y|^2 / N, where N = Nx * Ny * Nt.\n    \"\"\"\n    Nx, Ny, Nt = y.shape\n    N = Nx * Ny * Nt\n    Y = np.fft.fftn(y)\n    I = (np.abs(Y) ** 2) / N\n    return I\n\ndef spectral_density(sigma2, phi, kappa, WX, WY, WT, eps=1e-12):\n    \"\"\"\n    Construct separable spectral density:\n    S_x = sigma2 * S_t(phi; WT) * S_s(kappa; WX, WY),\n    where\n      S_t = 1 / (1 + phi^2 - 2 phi cos(WT)),\n      S_s = 1 / (kappa^2 + WX^2 + WY^2)^(3/2)\n    Clip by eps for numerical stability to ensure positivity.\n    \"\"\"\n    # Temporal component\n    St_denom = 1.0 + (phi ** 2) - 2.0 * phi * np.cos(WT)\n    # Prevent division by zero; phi must satisfy |phi|1 in meaningful cases\n    St = 1.0 / St_denom\n\n    # Spatial component (2D exponential covariance, Matérn nu=1/2)\n    wxy2 = WX ** 2 + WY ** 2\n    Ss = 1.0 / np.power(kappa ** 2 + wxy2, 1.5)\n\n    Sx = sigma2 * St * Ss\n    # Numerical stability\n    Sx = np.maximum(Sx, eps)\n    return Sx\n\ndef whittle_nll(y, params):\n    \"\"\"\n    Compute the Whittle negative log-likelihood (up to additive constant) for given params:\n    params = (sigma2, phi, kappa)\n    nll = sum_{freq} [ log S_x + I / S_x ]\n    \"\"\"\n    Nx, Ny, Nt = y.shape\n    I = periodogram(y)\n    WX, WY, WT = angular_frequencies(Nx, Ny, Nt)\n    sigma2, phi, kappa = params\n    Sx = spectral_density(sigma2, phi, kappa, WX, WY, WT, eps=1e-12)\n    nll = np.sum(np.log(Sx) + I / Sx)\n    return float(nll)\n\ndef solve():\n    # Grid sizes\n    Nx, Ny, Nt = 8, 8, 16\n\n    # Construct deterministic test field\n    y = construct_field(Nx, Ny, Nt)\n\n    # Define the test cases from the problem statement.\n    # Each is a tuple (sigma2, phi, kappa)\n    test_cases = [\n        (1.0, 0.7, 0.8),    # Case A: general correlated\n        (1.0, 0.0, 100.0),  # Case B: near-white-noise limit\n        (2.0, 0.95, 0.2),   # Case C: strong correlation\n    ]\n\n    results = []\n    for case in test_cases:\n        result = whittle_nll(y, case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}