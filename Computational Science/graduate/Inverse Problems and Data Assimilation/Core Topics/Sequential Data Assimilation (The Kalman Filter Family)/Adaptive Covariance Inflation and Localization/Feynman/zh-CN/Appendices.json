{
    "hands_on_practices": [
        {
            "introduction": "集合卡尔曼滤波器常常会因使用有限集合以及模型不完美而导致协方差被低估。一个常见的补救措施是“协方差膨胀”，但我们应该膨胀多少呢？这第一个练习将我们带回基础，为一个简单的标量系统推导最优的恒定膨胀因子，在该系统中，模型系统性地忽略了过程噪声。通过解决这个问题，您将对协方差膨胀如何直接补偿特定的模型误差来源以最小化分析不确定性，有一个基本的理解。",
            "id": "3363104",
            "problem": "考虑标量线性高斯状态空间模型\n$$x_{k+1}=a\\,x_{k}+\\eta_{k},\\qquad y_{k}=x_{k}+\\epsilon_{k},$$\n其中 $x_{k}\\in\\mathbb{R}$ 且 $y_{k}\\in\\mathbb{R}$，噪声 $\\eta_{k}\\sim\\mathcal{N}(0,N)$ 和 $\\epsilon_{k}\\sim\\mathcal{N}(0,R)$ 是相互独立的高斯噪声，给定 $a\\in\\mathbb{R}$，$N0$ 和 $R0$。一个在大集合极限下的集合卡尔曼滤波器 (EnKF) 被应用，其确定性预报在预报步骤中忽略了过程噪声（即，它通过线性模型传播分析协方差，而不加上 $N$）。为了缓解由此导致的离散度不足，在每个同化周期计算分析之前，对预报方差应用一个乘性协方差膨胀 $\\lambda0$。假设系统是平稳的，并且时间平均等于集合和噪声期望，因此时间平均的分析均方误差等于稳态分析误差方差。\n\n仅从线性高斯滤波和标量卡尔曼更新的定义出发，从第一性原理推导使稳态分析均方误差最小化的常数膨胀因子 $\\lambda$。用 $a$、$N$ 和 $R$ 将最终答案表示为一个闭式解析表达式。除已说明的情况外，不要假设任何额外的建模捷径。你的最终答案必须是单一的解析表达式。不需要四舍五入，也无需报告单位。",
            "solution": "用户希望我为一个标量线性高斯系统推导最优的乘性协方差膨胀因子 $\\lambda$，在该系统中，集合卡尔曼滤波器 (EnKF) 的实现在预报协方差传播中忽略了过程噪声。\n\n### 1. 问题表述与稳态方程\n\n设 $x_k \\in \\mathbb{R}$ 为时间步 $k$ 的真实状态，$y_k \\in \\mathbb{R}$ 为观测值。状态空间模型由以下公式给出：\n$$x_{k+1} = a x_k + \\eta_k, \\quad \\eta_k \\sim \\mathcal{N}(0, N)$$\n$$y_k = x_k + \\epsilon_k, \\quad \\epsilon_k \\sim \\mathcal{N}(0, R)$$\n其中 $\\eta_k$ 和 $\\epsilon_k$ 分别是方差为 $N0$ 和 $R0$ 的相互独立的零均值高斯噪声。\n\n设 $\\hat{x}_k^a$ 为分析（后验）状态估计，$P_k^a$ 为相应的分析误差方差，$P_k^a = E[(x_k - \\hat{x}_k^a)^2]$。\n\n**预报步骤（真实误差传播）：**\n预报状态为 $\\hat{x}_{k+1}^f = a \\hat{x}_k^a$。真实预报误差为 $e_{k+1}^f = x_{k+1} - \\hat{x}_{k+1}^f = a(x_k - \\hat{x}_k^a) + \\eta_k$。真实预报误差方差 $P_{k+1}^f$ 的演变如下：\n$$P_{k+1}^f = E[(a(x_k - \\hat{x}_k^a) + \\eta_k)^2] = a^2 E[(x_k - \\hat{x}_k^a)^2] + E[\\eta_k^2] = a^2 P_k^a + N$$\n\n**预报步骤（滤波器的内部传播）：**\n问题陈述指出，滤波器在传播其自身协方差时忽略了过程噪声方差 $N$。因此，膨胀前滤波器的内部预报方差为：\n$$P_{k+1, \\text{filt}}^f = a^2 P_k^a$$\n然后应用一个乘性膨胀因子 $\\lambda  0$。滤波器实际用于计算卡尔曼增益的预报方差为：\n$$P_{k+1, \\text{used}}^f = \\lambda P_{k+1, \\text{filt}}^f = \\lambda a^2 P_k^a$$\n\n**分析更新步骤：**\n卡尔曼增益 $K_{k+1}$ 使用滤波器（膨胀后）的预报方差计算：\n$$K_{k+1} = \\frac{P_{k+1, \\text{used}}^f}{P_{k+1, \\text{used}}^f + R}$$\n分析状态更新为 $\\hat{x}_{k+1}^a = \\hat{x}_{k+1}^f + K_{k+1}(y_{k+1} - \\hat{x}_{k+1}^f)$。真实分析误差 $e_{k+1}^a = x_{k+1} - \\hat{x}_{k+1}^a$ 可以表示为：\n$$e_{k+1}^a = (1-K_{k+1})e_{k+1}^f - K_{k+1}\\epsilon_{k+1}$$\n由于预报误差 $e_{k+1}^f$ 和观测误差 $\\epsilon_{k+1}$ 不相关，真实分析误差方差 $P_{k+1}^a$ 由协方差更新的 Joseph 型给出：\n$$P_{k+1}^a = (1-K_{k+1})^2 P_{k+1}^f + K_{k+1}^2 R$$\n请注意，我们必须在此方程中使用真实的预报误差方差 $P_{k+1}^f$，因为我们正在计算真实误差的方差。\n\n在平稳性假设下，我们有 $P_k^a = P_{k+1}^a = P^a$。方程变为：\n1. 真实预报方差：$P^f = a^2 P^a + N$\n2. 滤波器使用的预报方差：$P_{\\text{used}}^f = \\lambda a^2 P^a$\n3. 卡尔曼增益：$K = \\frac{P_{\\text{used}}^f}{P_{\\text{used}}^f + R} = \\frac{\\lambda a^2 P^a}{\\lambda a^2 P^a + R}$\n4. 稳态分析方差：$P^a = (1-K)^2 P^f + K^2 R$\n\n将(1)、(2)和(3)代入(4)，得到稳态分析方差 $P^a$ 作为膨胀因子 $\\lambda$ 的函数：\n$$P^a(\\lambda) = \\left(1 - \\frac{\\lambda a^2 P^a}{\\lambda a^2 P^a + R}\\right)^2 (a^2 P^a + N) + \\left(\\frac{\\lambda a^2 P^a}{\\lambda a^2 P^a + R}\\right)^2 R$$\n$$P^a(\\lambda) = \\frac{R^2 (a^2 P^a + N) + (\\lambda a^2 P^a)^2 R}{(\\lambda a^2 P^a + R)^2}$$\n\n### 2. 优化以找到 $\\lambda$\n\n我们的目标是找到使 $P^a$ 最小化的 $\\lambda$ 值。我们可以通过将导数 $\\frac{dP^a}{d\\lambda}$ 设为零来实现。我们将 $P^a$ 视为 $\\lambda$ 的隐函数，并对稳态方程关于 $\\lambda$ 求导。为方便起见，我们将方程重写为：\n$$P^a (\\lambda a^2 P^a + R)^2 = R^2 (a^2 P^a + N) + \\lambda^2 a^4 (P^a)^2 R$$\n对 $\\lambda$ 求导并将 $\\frac{dP^a}{d\\lambda}$ 设为 0：\n$$0 \\cdot (\\dots) + P^a \\cdot 2(\\lambda a^2 P^a + R) \\cdot (a^2 P^a) = R^2 (a^2 \\cdot 0) + (2\\lambda a^4 (P^a)^2 R + \\lambda^2 a^4 (2 P^a \\cdot 0) R)$$\n$$2 a^2 (P^a)^2 (\\lambda a^2 P^a + R) = 2 \\lambda a^4 (P^a)^2 R$$\n假设 $a \\neq 0$ 且 $P^a  0$，我们可以除以 $2 a^2 (P^a)^2$：\n$$\\lambda a^2 P^a + R = \\lambda a^2 R$$\n$$R = \\lambda a^2 R - \\lambda a^2 P^a = \\lambda a^2 (R - P^a)$$\n这给出了最优性条件：\n$$\\lambda = \\frac{R}{a^2(R - P^a)}$$\n这个条件有深刻的解释。让我们将其代入滤波器使用的预报方差表达式 $P_{\\text{used}}^f = \\lambda a^2 P^a$ 中：\n$$P_{\\text{used}}^f = \\frac{R}{a^2(R - P^a)} a^2 P^a = \\frac{R P^a}{R - P^a}$$\n现在让我们看看在此条件下，真实预报方差 $P^f = a^2 P^a + N$ 是什么。我们首先必须找到 $P^a$。让我们将 $\\lambda a^2 = \\frac{R}{R-P^a}$ 代入稳态分析中：\n条件 $\\lambda a^2 P^a + R = \\lambda a^2 R$ 等价于 $K = \\frac{\\lambda a^2 P^a}{\\lambda a^2 R} = \\frac{P^a}{R}$。让我们验证一下。使用 $\\lambda$ 的表达式，我们有 $K = \\frac{P^a_{\\text{used}}}{P^a_{\\text{used}}+R} = \\frac{\\frac{R P^a}{R-P^a}}{\\frac{R P^a}{R-P^a}+R} = \\frac{R P^a}{R P^a + R(R-P^a)} = \\frac{R P^a}{R^2} = \\frac{P^a}{R}$，这与之一致。\n$1-K=1-\\frac{P^a}{R} = \\frac{R-P^a}{R}$。\n将这些代入稳态方程 $P^a=(1-K)^2P^f+K^2R$ 中：\n$P^a = (\\frac{R-P^a}{R})^2(a^2P^a+N)+(\\frac{P^a}{R})^2R$\n$P^a R^2 = (R-P^a)^2(a^2P^a+N)+(P^a)^2R$\n$P^a R^2 - (P^a)^2 R = (R-P^a)^2(a^2P^a+N)$\n$P^a R(R-P^a) = (R-P^a)^2(a^2P^a+N)$\n假设 $P^a \\neq R$，我们除以 $(R-P^a)$：\n$P^a R = (R-P^a)(a^2 P^a + N) = a^2 P^a R - a^2 (P^a)^2 + NR - N P^a$\n重新整理后得到关于最优分析方差 $P^a$ 的二次方程：\n$$a^2 (P^a)^2 + P^a(R - a^2 R + N) - NR = 0$$\n$$a^2 (P^a)^2 + P^a(R(1-a^2) + N) - NR = 0$$\n这是一个过程噪声为 $N$、观测噪声为 $R$、动力学为 $a$ 的系统的稳态代数里卡蒂方程。这意味着最优膨胀因子 $\\lambda$ 正是使滤波器内部方差与真实方差相匹配（$P_{\\text{used}}^f = P^f$）的那个因子，从而使卡尔曼增益达到最优。\n\n### 3. 求解 $\\lambda$\n\n由 $P_{\\text{used}}^f = P^f$，我们有 $\\lambda a^2 P^a = a^2 P^a + N$。求解 $\\lambda$ 得：\n$$\\lambda = 1 + \\frac{N}{a^2 P^a}$$\n为了找到 $\\lambda$，我们必须首先通过求解关于 $P^a$ 的二次方程来找到 $a^2 P^a$。设 $p=P^a$。\n$p = \\frac{-(R(1-a^2)+N) \\pm \\sqrt{(R(1-a^2)+N)^2 - 4(a^2)(-NR)}}{2a^2}$\n因为 $p=P^a$ 必须为正，我们取正根：\n$P^a = \\frac{-(R(1-a^2)+N) + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2a^2}$\n乘以 $a^2$：\n$a^2 P^a = \\frac{-(R(1-a^2)+N) + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2}$\n现在将此代入 $\\lambda$ 的表达式中：\n$\\lambda = 1 + \\frac{N}{a^2 P^a} = 1 + \\frac{2N}{-(R(1-a^2)+N) + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}$\n为了简化，我们使分母有理化：\n$\\lambda = 1 + \\frac{2N \\left( -(R(1-a^2)+N) - \\sqrt{\\dots} \\right)}{ (-(R(1-a^2)+N))^2 - ((R(1-a^2)+N)^2 + 4a^2NR) }$\n$\\lambda = 1 + \\frac{2N \\left( -(R(1-a^2)+N) - \\sqrt{\\dots} \\right)}{-4a^2NR} = 1 - \\frac{-(R(1-a^2)+N) - \\sqrt{\\dots}}{2a^2R}$\n$\\lambda = 1 + \\frac{R(1-a^2)+N + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2a^2R}$\n$\\lambda = \\frac{2a^2R + R(1-a^2)+N + \\sqrt{\\dots}}{2a^2R} = \\frac{2a^2R + R-Ra^2+N + \\sqrt{\\dots}}{2a^2R}$\n$\\lambda = \\frac{Ra^2 + R + N + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2a^2R}$\n从分子中的前两项提取因子 $R$ 得到最终表达式：\n$\\lambda = \\frac{R(1+a^2) + N + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2a^2R}$",
            "answer": "$$\\boxed{\\frac{R(1+a^2) + N + \\sqrt{(R(1-a^2)+N)^2 + 4a^2NR}}{2a^2R}}$$"
        },
        {
            "introduction": "虽然协方差膨胀是一个强大的工具，但它并非解决所有类型预报误差的万能钥匙。本练习探讨了一种通常会考虑使用另一种误差校正方法——局域化——的情景。通过一个精心设计的二维系统，您将发现当潜在误差只是简单的系统性离散度不足时，为何局域化可能是无效甚至有害的，从而强调了膨胀才是针对该特定问题的正确工具。这个练习阐明了膨胀和局域化在处理预报误差协方差中不同结构性缺陷时所扮演的独特角色。",
            "id": "3363130",
            "problem": "考虑一个线性高斯状态估计问题中的单个同化步骤，其状态为二维向量 $x \\in \\mathbb{R}^{2}$，观测为标量。$x$ 的真实先验（预报）分布均值为零，协方差为\n$$\nP_{\\mathrm{t}} \\;=\\; \\begin{pmatrix} a  c \\\\ c  b \\end{pmatrix},\n$$\n其中 $a0$, $b0$, 且 $|c| \\ll \\sqrt{ab}$，这代表一个几乎不可观测的第二模态。观测算子为 $H = \\begin{pmatrix} 1  0 \\end{pmatrix}$，观测值 $y \\in \\mathbb{R}$ 满足 $y = H x + v$，其中 $v$ 是均值为零、方差为 $R0$ 的高斯变量，且与 $x$ 独立。\n\n一个基于集合的滤波器形成了一个内部预报协方差 $P_{\\mathrm{e}}$，该协方差系统性地离散度不足，并满足 $P_{\\mathrm{e}} = s\\, P_{\\mathrm{t}}$，其中 $s \\in (0,1)$ 是一个标量。该滤波器可选择性地应用 Schur 积（逐元素）局地化，其相关-局地化矩阵为\n$$\nL(\\phi) \\;=\\; \\begin{pmatrix} 1  \\phi \\\\ \\phi  1 \\end{pmatrix}, \\quad \\phi \\in [0,1],\n$$\n以及因子为 $\\lambda  0$ 的乘性协方差膨胀。用于计算增益的协方差为\n$$\n\\widetilde{P}(\\lambda,\\phi) \\;=\\; \\lambda \\left( P_{\\mathrm{e}} \\circ L(\\phi) \\right),\n$$\n其中 $\\circ$ 表示 Hadamard (Schur) 积。滤波器计算一个 Kalman 型线性分析\n$$\nx^{\\mathrm{a}} \\;=\\; x^{\\mathrm{f}} \\;+\\; K(\\lambda,\\phi)\\,\\bigl(y - H x^{\\mathrm{f}}\\bigr), \\qquad\nK(\\lambda,\\phi) \\;=\\; \\widetilde{P}(\\lambda,\\phi)\\, H^{\\top}\\,\\bigl(H\\,\\widetilde{P}(\\lambda,\\phi)\\,H^{\\top} + R\\bigr)^{-1},\n$$\n其中 $x^{\\mathrm{f}}$ 表示预报状态，其真实的预报误差协方差为 $P_{\\mathrm{t}}$。\n\n仅使用基本的线性高斯估计恒等式（具体而言，是应用于真实先验协方差 $P_{\\mathrm{t}}$ 和观测噪声方差 $R$ 的、具有任意增益 $K$ 的线性估计器的均方分析误差协方差），回答以下问题：\n\n- 从第一性原理出发，论证为什么在这个具有单一观测的二维设置中，Schur 积局地化无法将第二个状态分量的分析均方误差减小到超越选择 $\\phi = 1$ 的程度（也就是说，局地化实际上是无用的，无法帮助几乎不可观测的模态）。\n\n- 然后，专注于乘性膨胀，推导出一个显式的闭式表达式，用于计算能使第二个状态分量的后验方差 $\\bigl(P^{\\mathrm{a}}(\\lambda,\\phi)\\bigr)_{22}$ 最小化的膨胀因子 $\\lambda^{\\ast}$。其中，$P^{\\mathrm{a}}(\\lambda,\\phi)$ 是使用真实先验协方差 $P_{\\mathrm{t}}$、观测模型 $(H,R)$ 和上面定义的增益 $K(\\lambda,\\phi)$ 计算出的分析误差协方差。你可以假设联合最优的局地化选择是 $\\phi=1$。\n\n将你的最终答案表示为 $\\lambda^{\\ast}$ 的单个闭式解析表达式。不需要进行数值四舍五入，也不涉及任何单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 状态向量：$x \\in \\mathbb{R}^{2}$。\n- 真实先验（预报）分布：均值为零，协方差为 $P_{\\mathrm{t}} = \\begin{pmatrix} a  c \\\\ c  b \\end{pmatrix}$，其中 $a0$, $b0$, 且 $|c| \\ll \\sqrt{ab}$。\n- 观测算子：$H = \\begin{pmatrix} 1  0 \\end{pmatrix}$。\n- 观测模型：$y = H x + v$，其中 $v$ 是均值为零、方差为 $R0$ 的高斯随机变量，且与 $x$ 独立。\n- 集合预报协方差：$P_{\\mathrm{e}} = s\\, P_{\\mathrm{t}}$，其中 $s \\in (0,1)$ 为一个标量。\n- 局地化矩阵：$L(\\phi) = \\begin{pmatrix} 1  \\phi \\\\ \\phi  1 \\end{pmatrix}$，其中 $\\phi \\in [0,1]$。\n- 乘性协方差膨胀因子：$\\lambda  0$。\n- 用于增益计算的修正协方差：$\\widetilde{P}(\\lambda,\\phi) = \\lambda ( P_{\\mathrm{e}} \\circ L(\\phi) )$，其中 $\\circ$ 是 Hadamard 积。\n- Kalman 型分析更新：$x^{\\mathrm{a}} = x^{\\mathrm{f}} + K(\\lambda,\\phi)\\,\\bigl(y - H x^{\\mathrm{f}}\\bigr)$，其中 $x^{\\mathrm{f}}$ 是预报状态，其真实预报误差协方差为 $P_{\\mathrm{t}}$。\n- 增益矩阵：$K(\\lambda,\\phi) = \\widetilde{P}(\\lambda,\\phi)\\, H^{\\top}\\,\\bigl(H\\,\\widetilde{P}(\\lambda,\\phi)\\,H^{\\top} + R\\bigr)^{-1}$。\n- 分析误差协方差：$P^{\\mathrm{a}}(\\lambda,\\phi)$ 将使用真实先验协方差 $P_{\\mathrm{t}}$ 和观测模型 $(H,R)$，针对给定的增益 $K(\\lambda,\\phi)$ 进行计算。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础：** 该问题是数据同化领域的一个标准练习，特别是在集合 Kalman 滤波器的背景下。协方差膨胀、局地化以及次优增益的使用是该领域的基本概念。所有定义和模型都是标准的。\n- **适定性：** 该问题提供了执行所要求的推导所需的所有必要信息。它要求基于第一性原理的论证和最优参数的推导，这两者都是明确定义的任务。\n- **客观性：** 问题以精确、形式化的数学语言陈述，没有主观或模糊的术语。\n- **结论：** 问题陈述有效、科学上合理、完整且适定。未发现任何缺陷。\n\n### 步骤 3：结论与行动\n问题有效。将提供解答。\n\n### 解答推导\n\n分析误差由 $x^{\\mathrm{a}} - x = (x^{\\mathrm{f}} - x) - K(y - Hx^{\\mathrm{f}})$ 给出。代入 $y=Hx+v$，我们得到 $x^{\\mathrm{a}} - x = (x^{\\mathrm{f}} - x) - K(Hx+v-Hx^{\\mathrm{f}}) = (I-KH)(x^{\\mathrm{f}}-x) - Kv$。\n分析误差协方差 $P^{\\mathrm{a}}$ 是分析误差与其自身外积的期望。由于预报误差 $x^{\\mathrm{f}}-x$ 和观测误差 $v$ 不相关，我们有：\n$$\nP^{\\mathrm{a}}(K) = \\mathbb{E}\\left[ \\bigl((I-KH)(x^{\\mathrm{f}}-x) - Kv\\bigr) \\bigl((I-KH)(x^{\\mathrm{f}}-x) - Kv\\bigr)^{\\top} \\right]\n$$\n$$\nP^{\\mathrm{a}}(K) = (I-KH)\\mathbb{E}\\left[(x^{\\mathrm{f}}-x)(x^{\\mathrm{f}}-x)^{\\top}\\right](I-KH)^{\\top} + K\\mathbb{E}\\left[vv^{\\top}\\right]K^{\\top}\n$$\n这就得到了对于任意增益 $K$ 的 Joseph 形式的分析误差协方差：\n$$\nP^{\\mathrm{a}}(K) = (I-KH)P_{\\mathrm{t}}(I-KH)^{\\top} + K R K^{\\top}\n$$\n我们的目标是理解并最小化第二个状态分量的方差 $(P^{\\mathrm{a}})_{22}$。\n\n首先，我们计算增益 $K(\\lambda,\\phi)$。修正后的协方差为：\n$$\n\\widetilde{P}(\\lambda,\\phi) = \\lambda \\left( \\left( s \\begin{pmatrix} a  c \\\\ c  b \\end{pmatrix} \\right) \\circ \\begin{pmatrix} 1  \\phi \\\\ \\phi  1 \\end{pmatrix} \\right) = \\lambda s \\begin{pmatrix} a  c\\phi \\\\ c\\phi  b \\end{pmatrix}\n$$\n增益计算所需的项为：\n$$\n\\widetilde{P} H^{\\top} = \\lambda s \\begin{pmatrix} a  c\\phi \\\\ c\\phi  b \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\lambda s \\begin{pmatrix} a \\\\ c\\phi \\end{pmatrix}\n$$\n$$\nH \\widetilde{P} H^{\\top} = \\begin{pmatrix} 1  0 \\end{pmatrix} \\left( \\lambda s \\begin{pmatrix} a \\\\ c\\phi \\end{pmatrix} \\right) = \\lambda s a\n$$\n因此，Kalman 增益为：\n$$\nK(\\lambda,\\phi) = \\left( \\lambda s \\begin{pmatrix} a \\\\ c\\phi \\end{pmatrix} \\right) (\\lambda s a + R)^{-1} = \\frac{\\lambda s}{\\lambda s a + R} \\begin{pmatrix} a \\\\ c\\phi \\end{pmatrix}\n$$\n令增益的分量为 $K_1 = \\frac{\\lambda s a}{\\lambda s a + R}$ 和 $K_2 = \\frac{\\lambda s c \\phi}{\\lambda s a + R}$。\n\n现在，我们计算 $(P^{\\mathrm{a}})_{22}$。我们有 $K = \\begin{pmatrix} K_1 \\\\ K_2 \\end{pmatrix}$ 和 $H = \\begin{pmatrix} 1  0 \\end{pmatrix}$。\n$$\nI-KH = I - \\begin{pmatrix} K_1 \\\\ K_2 \\end{pmatrix} \\begin{pmatrix} 1  0 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} K_1  0 \\\\ K_2  0 \\end{pmatrix} = \\begin{pmatrix} 1-K_1  0 \\\\ -K_2  1 \\end{pmatrix}\n$$\nJoseph 形式中第一项的 $(2,2)$ 元素是：\n$$\n\\left( (I-KH)P_{\\mathrm{t}}(I-KH)^{\\top} \\right)_{22} = \\begin{pmatrix} -K_2  1 \\end{pmatrix} P_{\\mathrm{t}} \\begin{pmatrix} -K_2 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -K_2  1 \\end{pmatrix} \\begin{pmatrix} a  c \\\\ c  b \\end{pmatrix} \\begin{pmatrix} -K_2 \\\\ 1 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} -K_2 a + c  -K_2 c + b \\end{pmatrix} \\begin{pmatrix} -K_2 \\\\ 1 \\end{pmatrix} = (-K_2 a + c)(-K_2) + (-K_2 c + b) = aK_2^2 - 2cK_2 + b\n$$\n第二项的 $(2,2)$ 元素是 $(KRK^{\\top})_{22} = R K_2^2$。\n将它们结合起来，第二个分量的分析方差是：\n$$\n(P^{\\mathrm{a}})_{22} = (aK_2^2 - 2cK_2 + b) + R K_2^2 = (a+R)K_2^2 - 2cK_2 + b\n$$\n\n### 第 1 部分：局地化（$\\phi$）的作用\n\n分析方差 $(P^{\\mathrm{a}})_{22}$ 是 $K_2$ 的二次函数。当 $\\frac{d}{dK_2}(P^{\\mathrm{a}})_{22} = 2(a+R)K_2 - 2c = 0$ 时，它达到最小值，这给出了最优值 $K_2^{\\mathrm{opt}} = \\frac{c}{a+R}$。这恰好是最优 Kalman 增益 $K_{\\mathrm{opt}} = P_{\\mathrm{t}}H^{\\top}(HP_{\\mathrm{t}}H^{\\top}+R)^{-1} = \\frac{1}{a+R}\\begin{pmatrix} a \\\\ c \\end{pmatrix}$ 的第二个分量。\n\n滤波器使用的增益为 $K_2 = \\frac{\\lambda s c \\phi}{\\lambda s a + R}$。为了最小化 $(P^{\\mathrm{a}})_{22}$，我们必须选择 $\\phi$ 以使 $K_2$ 尽可能接近 $K_2^{\\mathrm{opt}}$。\n\n从第一性原理出发的论证如下：\n局地化，由参数 $\\phi \\in [0,1]$ 表示，是一种主要用于减轻由集合协方差矩阵估计中的抽样误差引起的伪长程相关影响的技术。在一个典型的集合 Kalman 滤波器中，样本协方差 $P_{\\mathrm{e}}$ 与真实协方差 $P_{\\mathrm{t}}$ 相比存在结构性误差。\n\n然而，该问题为集合协方差指定了一个高度理想化的模型：$P_{\\mathrm{e}} = s P_{\\mathrm{t}}$。这意味着集合估计的协方差具有与真实协方差*完全相同的相关结构*；它仅仅是被一个因子 $s1$ 缩小了。没有需要滤除的伪相关。\n\n增益分量 $K_2$ 负责根据对第一个变量的观测来更新未观测的第二个变量。其值与两个变量之间的交叉协方差成正比。最优更新需要真实的交叉协方差，即 $P_{\\mathrm{t}}$ 的 $(1,2)$ 元素，也就是 $c$。滤波器使用修正后的协方差 $\\widetilde{P}$ 计算其增益，该协方差的交叉协方差为 $\\lambda s c \\phi$。\n\n通过选择一个局地化因子 $\\phi  1$，我们正在主动地扭曲存在于 $P_{\\mathrm{e}}$ 中的完美相关结构，用一个被刻意削弱的版本 $sc\\phi$ 替换了真实的交叉协方差 $c$（按 $s$ 缩放）。这为同化系统提供了结构上不正确的信息，使得增益分量 $K_2$ 比必要时更远离其最优值。\n\n在模型 $P_e$ 中，对交叉协方差结构可用的最佳表示是在其相关性未被改变时实现的。这对应于选择 $\\phi=1$，这将 $L(\\phi)$ 设置为一个全一矩阵，因此 $P_{\\mathrm{e}} \\circ L(\\phi) = P_{\\mathrm{e}}$。任何 $\\phi  1$ 的选择都代表了对真实协方差结构的破坏，因此是次优的。这解释了为什么在这个特定的理想化场景中，局地化不能改善分析，最佳选择是 $\\phi=1$。\n\n### 第 2 部分：最优膨胀因子 ($\\lambda^{\\ast}$)\n\n我们被要求找到能够最小化第二个分量的后验方差 $(P^{\\mathrm{a}})_{22}$ 的膨胀因子 $\\lambda^{\\ast}$，假设最优的局地化选择是 $\\phi=1$。\n我们在 $K_2$ 的表达式中设置 $\\phi=1$：\n$$\nK_2(\\lambda, 1) = \\frac{\\lambda s c}{\\lambda s a + R}\n$$\n需要最小化的方差是 $(P^{\\mathrm{a}})_{22} = (a+R)K_2^2 - 2cK_2 + b$。如前所述，当 $K_2$ 等于其最优值 $K_2^{\\mathrm{opt}} = \\frac{c}{a+R}$ 时，该表达式相对于 $K_2$ 达到最小值。\n\n因此，最优膨胀因子 $\\lambda^{\\ast}$ 是使滤波器的增益分量 $K_2(\\lambda, 1)$ 等于最优增益分量 $K_2^{\\mathrm{opt}}$ 的 $\\lambda$ 值。\n我们建立方程：\n$$\nK_2(\\lambda^{\\ast}, 1) = K_2^{\\mathrm{opt}}\n$$\n$$\n\\frac{\\lambda^{\\ast} s c}{\\lambda^{\\ast} s a + R} = \\frac{c}{a+R}\n$$\n假设 $c \\neq 0$（根据问题中 $|c| \\ll \\sqrt{ab}$ 的含义），我们可以将两边都除以 $c$：\n$$\n\\frac{\\lambda^{\\ast} s}{\\lambda^{\\ast} s a + R} = \\frac{1}{a+R}\n$$\n交叉相乘得到：\n$$\n\\lambda^{\\ast} s (a+R) = \\lambda^{\\ast} s a + R\n$$\n展开左侧：\n$$\n\\lambda^{\\ast} s a + \\lambda^{\\ast} s R = \\lambda^{\\ast} s a + R\n$$\n两边减去 $\\lambda^{\\ast} s a$：\n$$\n\\lambda^{\\ast} s R = R\n$$\n由于 $R0$，我们可以除以 $R$ 来解出 $\\lambda^{\\ast}$：\n$$\n\\lambda^{\\ast} s = 1 \\implies \\lambda^{\\ast} = \\frac{1}{s}\n$$\n这个结果在直觉上是正确的。滤波器的协方差 $P_{\\mathrm{e}}$ 系统性地以因子 $s$ 离散度不足。为了获得最优增益，滤波器必须使用真实的协方差 $P_{\\mathrm{t}}$。通过选择 $\\phi=1$ 和 $\\lambda^{\\ast}=1/s$，用于增益计算的修正协方差变为 $\\widetilde{P} = \\lambda^{\\ast} s P_{\\mathrm{t}} = (1/s) s P_{\\mathrm{t}} = P_{\\mathrm{t}}$。这为滤波器提供了真实的协方差，从而得到最优的 Kalman 增益，并因此得到最小可能的分析误差方差。",
            "answer": "$$\n\\boxed{\\frac{1}{s}}\n$$"
        },
        {
            "introduction": "手动调整一个恒定的膨胀因子可能非常繁琐，这使得根据滤波器性能自动调整膨胀因子的自适应方案极具吸引力。一种常见的方法是使观测到的新息方差与其理论预测值相匹配。这最后一个练习是一个至关重要的警示性案例，它构建了一个反例，其中这种朴素的自适应方案因未建模的观测偏差而灾难性地发散。通过分析这种发散现象，您将体会到自动调参的潜在危险，并理解进行稳健的诊断以确保滤波器假设得到满足的至关重要性。",
            "id": "3363181",
            "problem": "考虑一个带有恒定、未建模观测偏差的标量线性高斯数据同化场景。真实状态按 $x_{k+1} = x_{k}$ 进行确定性演化，每次同化时间的先验（预报）误差方差为 $P^{f} = p$，其中 $p  0$ 是已知常数。观测由 $y_{k} = x_{k} + b + v_{k}$ 给出，其中 $b \\neq 0$ 是一个滤波器未建模的恒定偏差，$v_{k} \\sim \\mathcal{N}(0, r)$ 且其方差 $r  0$ 已知。该滤波器是一个集合卡尔曼滤波器（Ensemble Kalman Filter, EnKF），它使用一个时变因子 $\\alpha_{k}  0$ 进行乘性协方差膨胀，因此进入分析步骤的预报协方差为 $\\alpha_{k} P^{f}$。\n\n一位实践者使用了一种朴素的、基于新息的自适应膨胀方案，该方案通过将观测到的新息平方与预测的新息方差进行匹配来更新 $\\alpha_{k}$，即\n$$\n\\alpha_{k+1} = \\alpha_{k} \\cdot \\frac{d_{k}^{2}}{S_{k}},\n$$\n其中 $d_{k} = y_{k} - x^{f}_{k}$ 是新息，$S_{k} = \\alpha_{k} p + r$ 是此标量情况下的预测新息方差。此处 $x^{f}_{k}$ 表示预报均值。假设线性高斯滤波的标准独立性条件成立，因此在以 $\\alpha_{k}$ 为条件时，新息的分布为 $d_{k} \\sim \\mathcal{N}(b, S_{k})$。\n\n要求您构造一个具体的反例，在该反例中，由于未建模的偏差，这个朴素的方案在期望上是发散的。取具体值 $p = 1$，$r = \\frac{1}{4}$ 和 $b = 1$。从线性高斯新息统计的基本原理和上述自适应更新的定义出发，推导条件期望 $\\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}]$，证明当 $\\alpha_{k} \\to \\infty$ 时，它保持严格为正且不趋于零，并计算其在 $\\alpha_{k} \\to \\infty$ 时的极限值。然后，解释为什么这表明在该朴素方案下 $\\alpha_{k}$ 是发散的。最后，简要论证一个能够从基于新息的匹配中移除估计偏差平方的、具备偏差意识的诊断方法将如何改变这一结论。\n\n对于这个反例，膨胀的渐近期望单步增量是多少，即以下表达式的值：\n$$\n\\lim_{\\alpha_{k} \\to \\infty} \\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}]\n$$\n对于 $p = 1$，$r = \\frac{1}{4}$ 和 $b = 1$？请以单个实数形式提供您的答案，不带单位。无需四舍五入。",
            "solution": "该问题要求分析在存在未建模观测偏差的情况下，一种朴素的、基于新息的自适应协方差膨胀方案。我们需要推导膨胀因子的期望单步变化，分析其渐近行为，解释由此导致的发散，并思考一种偏差感知的修正方法。\n\n首先，我们验证问题陈述。\n\n**步骤1：提取已知条件**\n- 真实状态演化：$x_{k+1} = x_{k}$\n- 先验误差方差：$P^{f} = p$，其中 $p  0$\n- 观测模型：$y_{k} = x_{k} + b + v_{k}$\n- 观测偏差：$b \\neq 0$，恒定且未建模\n- 观测误差：$v_{k} \\sim \\mathcal{N}(0, r)$，其中 $r  0$\n- 自适应膨胀因子：$\\alpha_{k}  0$\n- 膨胀后的预报协方差：$\\alpha_{k} p$\n- 自适应更新规则：$\\alpha_{k+1} = \\alpha_{k} \\cdot \\frac{d_{k}^{2}}{S_{k}}$\n- 新息：$d_{k} = y_{k} - x^{f}_{k}$\n- 预测新息方差：$S_{k} = \\alpha_{k} p + r$\n- 条件新息分布：给定 $\\alpha_{k}$，有 $d_{k} \\sim \\mathcal{N}(b, S_{k})$\n- 反例的具体参数值：$p = 1$，$r = \\frac{1}{4}$，$b = 1$\n- 任务：计算给定参数值下 $\\lim_{\\alpha_{k} \\to \\infty} \\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}]$ 的值。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上植根于数据同化领域，并涉及集合卡尔曼滤波器、协方差膨胀和观测偏差等标准概念。其设定是一个简化但适定（well-posed）的线性高斯模型，这是理论分析的常用工具。所有变量、参数和分布都得到了明确定义，并且它们之间的关系在数学上是一致的。新息 $d_{k} = y_k - x^f_k = (x_k - x^f_k) + b + v_k$。假设预报均值 $x_k^f$ 相对于真实状态 $x_k$ 是无偏的，其期望为 $\\mathbb{E}[d_k] = \\mathbb{E}[x_k - x^f_k] + b + \\mathbb{E}[v_k] = 0 + b + 0 = b$。其方差为 $\\mathrm{Var}(d_k) = \\mathrm{Var}(x_k - x^f_k) + \\mathrm{Var}(v_k)$。滤波器模型假设预报误差方差为 $\\alpha_k P^f = \\alpha_k p$，观测误差方差为 $r$。因此，预测的新息方差确实是 $S_k = \\alpha_k p + r$。给定的条件分布 $d_k \\sim \\mathcal{N}(b, S_k)$ 与这些假设是一致的。该问题是适定的、客观的，并且不包含科学缺陷。\n\n**步骤3：结论与行动**\n问题有效。我们继续进行求解。\n\n主要任务是计算膨胀因子单步变化量的条件期望 $\\alpha_{k+1} - \\alpha_{k}$。\n从更新规则 $\\alpha_{k+1} = \\alpha_{k} \\frac{d_{k}^{2}}{S_{k}}$ 开始，变化量为：\n$$\n\\alpha_{k+1} - \\alpha_{k} = \\alpha_{k} \\frac{d_{k}^{2}}{S_{k}} - \\alpha_{k} = \\alpha_{k} \\left( \\frac{d_{k}^{2}}{S_{k}} - 1 \\right)\n$$\n我们计算这个量在以 $\\alpha_{k}$ 为条件下的期望。当以 $\\alpha_{k}$ 为条件时，$\\alpha_{k}$ 和 $S_{k} = \\alpha_{k}p + r$ 都被视为常数。\n$$\n\\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}] = \\mathbb{E}\\left[ \\alpha_{k} \\left( \\frac{d_{k}^{2}}{S_{k}} - 1 \\right) \\mid \\alpha_{k} \\right] = \\frac{\\alpha_{k}}{S_{k}} \\mathbb{E}[d_{k}^{2} \\mid \\alpha_{k}] - \\alpha_{k}\n$$\n给定在以 $\\alpha_{k}$ 为条件时，新息 $d_{k}$ 服从正态分布 $d_{k} \\sim \\mathcal{N}(b, S_{k})$。其均值为 $\\mathbb{E}[d_{k} \\mid \\alpha_{k}] = b$，方差为 $\\mathrm{Var}(d_{k} \\mid \\alpha_{k}) = S_{k}$。\n对于任意随机变量 $X$，其二阶矩与其均值 $\\mu$ 和方差 $\\sigma^2$ 的关系由公式 $\\mathbb{E}[X^2] = \\sigma^2 + \\mu^2$ 给出。将此应用于 $d_{k}$：\n$$\n\\mathbb{E}[d_{k}^{2} \\mid \\alpha_{k}] = \\mathrm{Var}(d_{k} \\mid \\alpha_{k}) + (\\mathbb{E}[d_{k} \\mid \\alpha_{k}])^2 = S_{k} + b^2\n$$\n将此结果代回期望变化的表达式中：\n$$\n\\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}] = \\frac{\\alpha_{k}}{S_{k}}(S_{k} + b^2) - \\alpha_{k} = \\alpha_{k}\\left(1 + \\frac{b^2}{S_{k}}\\right) - \\alpha_{k} = \\frac{\\alpha_{k} b^2}{S_{k}}\n$$\n现在，我们代入 $S_{k} = \\alpha_{k} p + r$ 的定义：\n$$\n\\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}] = \\frac{\\alpha_{k} b^2}{\\alpha_{k} p + r}\n$$\n这个表达式表示在给定当前值 $\\alpha_{k}$ 的情况下，膨胀因子的期望单步增量。由于问题指定 $p0$，$r0$，$\\alpha_k  0$ 且 $b \\neq 0$（因此 $b^{2}  0$），分子 $\\alpha_{k} b^2$ 严格为正，分母 $\\alpha_{k} p + r$ 也严格为正。因此，对于所有 $\\alpha_{k}  0$，期望变化 $\\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}]$ 都是严格为正的。\n\n这意味着，在期望上，膨胀因子在每一步都会增加。滤波器将恒定的偏差 $b$ 误解为预报方差不足的信号，并试图通过增加 $\\alpha_k$ 来补偿。\n\n为了确定这个过程是否稳定，我们分析当 $\\alpha_{k}$ 变得很大时期望增量的行为。我们计算其极限：\n$$\n\\lim_{\\alpha_{k} \\to \\infty} \\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}] = \\lim_{\\alpha_{k} \\to \\infty} \\frac{\\alpha_{k} b^2}{\\alpha_{k} p + r}\n$$\n这是一个关于 $\\alpha_{k}$ 的有理函数的极限。由于分子（次数为1）和分母（次数为1）的次数相同，该极限等于首项系数之比。\n$$\n\\lim_{\\alpha_{k} \\to \\infty} \\frac{\\alpha_{k} b^2}{\\alpha_{k} p + r} = \\frac{b^2}{p}\n$$\n由于 $b \\neq 0$ 且 $p  0$，这个极限是一个正常数。期望的单步增量不会消失；它趋近于一个非零的正值。这种行为意味着膨胀因子 $\\alpha_{k}$ 将会发散。对于大的 $k$，序列 $\\mathbb{E}[\\alpha_k]$ 近似线性增长，导致无界增长。这证实了朴素方案由于未建模的偏差而发散。\n\n一个具备偏差意识的诊断方法可以纠正这一点。它会识别出新息具有非零均值 $b$。新息平方 $d_k^2$ 中可归因于随机误差的部分不是 $d_k^2$ 本身，而是 $(d_k-b)^2$。一个理想的、具备偏差意识的方案会有效地将 $\\mathbb{E}[(d_k-b)^2] = S_k$ 与基于样本的估计进行匹配。如果更新规则基于偏差校正后的新息，例如 $\\alpha_{k+1} = \\alpha_k \\frac{d_k^2 - b^2}{S_k}$（假设对 $b$ 有完美估计），那么期望变化将变为：\n$$\n\\mathbb{E}[\\alpha_{k+1} - \\alpha_k \\mid \\alpha_k] = \\frac{\\alpha_k}{S_k}\\mathbb{E}[d_k^2 - b^2 \\mid \\alpha_k] - \\alpha_k = \\frac{\\alpha_k}{S_k}((S_k+b^2) - b^2) - \\alpha_k = \\alpha_k - \\alpha_k = 0\n$$\n通过将新息的均值正确地归因于偏差，正反馈循环被打破，虚假的膨胀增长得以停止。\n\n最后，我们被要求为给定的反例参数 $p = 1$，$r = \\frac{1}{4}$ 和 $b = 1$ 计算渐近期望单步增量的具体值。使用推导出的极限：\n$$\n\\lim_{\\alpha_{k} \\to \\infty} \\mathbb{E}[\\alpha_{k+1} - \\alpha_{k} \\mid \\alpha_{k}] = \\frac{b^2}{p} = \\frac{1^2}{1} = 1\n$$\n对于这个反例，膨胀的渐近期望单步增量为 $1$。",
            "answer": "$$\n\\boxed{1}\n$$"
        }
    ]
}