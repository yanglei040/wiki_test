{
    "hands_on_practices": [
        {
            "introduction": "最小二乘法通常与方程多于未知数的超定系统相关联，但在数据同化等领域，我们经常遇到欠定系统。在这种情况下，存在无穷多个解，我们的目标是找到其中欧几里得范数最小的唯一解。本练习  将指导你如何巧妙地运用QR分解（具体来说，是对算子矩阵的转置进行分解），推导并实现求解这类重要问题的方法。",
            "id": "3408919",
            "problem": "在一个受数据同化启发的线性反问题中，考虑一个线性观测算子 $H \\in \\mathbb{R}^{m \\times n}$，其中 $m  n$ 且 $H$ 为满行秩，该算子通过 $H x = y$ 将状态增量 $x \\in \\mathbb{R}^{n}$ 映射到观测值 $y \\in \\mathbb{R}^{m}$。最小欧几里得范数分析增量定义为在约束条件 $H x = y$ 下最小化 $\\|x\\|_{2}$ 的唯一向量 $x^{\\star}$。针对此类欠定系统的一类计算策略使用为 $m  n$ 情况定制的正交-三角分解，例如 $RQ$ 分解（上三角矩阵乘以正交矩阵）或 $LQ$ 分解（下三角矩阵乘以正交矩阵），或者等价地，$H^{\\top}$ 的 $QR$ 分解（正交矩阵乘以上三角矩阵）。\n\n仅从定义最优性的陈述“在 $H x = y$ 的约束下最小化 $\\|x\\|_{2}$”、欧几里得范数在正交变换下的不变性，以及三角系统可通过回代/前向替换求解的结构特性出发，推导出一个使用适合 $m  n$ 的正交-三角方法的计算过程来求解 $x^{\\star}$。然后，将您的推导应用于 $m = 2$, $n = 3$ 的具体实例，其中\n$$\nH \\;=\\; \\begin{pmatrix}\n1  1  0 \\\\\n0  1  1\n\\end{pmatrix}, \n\\qquad\ny \\;=\\; \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}.\n$$\n计算最小欧几里得范数解 $x^{\\star}$ 的第三个分量，记为 $x^{\\star}_{3}$，并报告其精确值。不要对答案进行四舍五入。",
            "solution": "问题是求解一个欠定线性方程组的最小欧几里得范数解 $x^{\\star}$。这是一个约束优化问题，表述为：\n$$\n\\text{最小化 } \\|x\\|_{2} \\quad \\text{约束条件为} \\quad Hx = y\n$$\n其中 $x \\in \\mathbb{R}^{n}$，$y \\in \\mathbb{R}^{m}$，以及 $H \\in \\mathbb{R}^{m \\times n}$，$m  n$ 且为满行秩（秩为 $m$）。\n\n我们将首先按照要求，使用正交-三角分解推导一个通用的计算过程，然后将其应用于具体的数值实例。\n\n**通用推导**\n\n推导将基于问题中给出的三个原则：最优性陈述、欧几里得范数在正交变换下的不变性，以及三角系统的可解性。\n\n矩阵 $H$ 是一个 $m \\times n$ 矩阵，其中 $m  n$ 且为满行秩。其转置 $H^{\\top}$ 是一个 $n \\times m$ 的满列秩矩阵。满列秩矩阵具有唯一的（瘦）QR 分解。我们来计算 $H^{\\top}$ 的这个分解：\n$$\nH^{\\top} = QR\n$$\n其中 $Q \\in \\mathbb{R}^{n \\times m}$ 是一个具有标准正交列的矩阵（即 $Q^{\\top}Q = I_m$，其中 $I_m$ 是 $m \\times m$ 的单位矩阵），而 $R \\in \\mathbb{R}^{m \\times m}$ 是一个上三角矩阵。由于 $H^{\\top}$ 是满列秩的，所以 $R$ 是可逆的。\n\n根据这个分解，我们可以将 $H$ 表示为 $H = (QR)^{\\top} = R^{\\top}Q^{\\top}$。约束条件 $Hx=y$ 变为：\n$$\nR^{\\top}Q^{\\top}x = y\n$$\n为了利用范数不变性，我们进行变量替换。$Q$ 的列构成了 $H^{\\top}$ 的列空间（也就是 $H$ 的行空间）的一组标准正交基。我们可以通过找到一个矩阵 $Q_{\\perp} \\in \\mathbb{R}^{n \\times (n-m)}$，其列构成 $H$ 的零空间的一组标准正交基，从而将这组列扩展为 $\\mathbb{R}^n$ 的一个完整的标准正交基。设 $\\bar{Q} = \\begin{pmatrix} Q  Q_{\\perp} \\end{pmatrix} \\in \\mathbb{R}^{n \\times n}$。根据构造，$\\bar{Q}$ 是一个正交矩阵，所以 $\\bar{Q}^{\\top}\\bar{Q} = \\bar{Q}\\bar{Q}^{\\top} = I_n$。\n\n任何向量 $x \\in \\mathbb{R}^n$ 都可以表示为在这个新基下的 $x = \\bar{Q}w$，其中 $w \\in \\mathbb{R}^n$ 是唯一的坐标向量。我们将 $w$ 分块为 $w = \\begin{pmatrix} w_{1} \\\\ w_{2} \\end{pmatrix}$，其中 $w_1 \\in \\mathbb{R}^m$ 且 $w_2 \\in \\mathbb{R}^{n-m}$。因此，$x = Qw_1 + Q_{\\perp}w_2$。\n\n目标函数 $\\|x\\|_2$ 可以利用正交变换保持欧几里得范数的性质进行变换：\n$$\n\\|x\\|_{2} = \\|\\bar{Q}w\\|_{2} = \\|w\\|_{2}\n$$\n优化问题现在被转换为一个关于 $w$ 的等价问题：\n$$\n\\text{最小化 } \\|w\\|_{2} \\quad \\text{约束条件为} \\quad H\\bar{Q}w = y\n$$\n我们来分析新的约束矩阵 $H\\bar{Q}$：\n$$\nH\\bar{Q} = R^{\\top}Q^{\\top} \\begin{pmatrix} Q  Q_{\\perp} \\end{pmatrix} = \\begin{pmatrix} R^{\\top}Q^{\\top}Q  R^{\\top}Q^{\\top}Q_{\\perp} \\end{pmatrix}\n$$\n由于 $Q^{\\top}Q = I_m$ 并且 $Q_{\\perp}$ 的列与 $Q$ 的列正交，我们有 $Q^{\\top}Q_{\\perp} = 0$。表达式简化为：\n$$\nH\\bar{Q} = \\begin{pmatrix} R^{\\top}I_m  0 \\end{pmatrix} = \\begin{pmatrix} R^{\\top}  0 \\end{pmatrix}\n$$\n那么对 $w$ 的约束是：\n$$\n\\begin{pmatrix} R^{\\top}  0 \\end{pmatrix} \\begin{pmatrix} w_1 \\\\ w_2 \\end{pmatrix} = y \\quad \\implies \\quad R^{\\top}w_1 = y\n$$\n目标是最小化 $\\|w\\|_{2}^{2} = \\|w_1\\|_{2}^{2} + \\|w_2\\|_{2}^{2}$。分量 $w_1$ 完全由约束方程 $R^{\\top}w_1 = y$ 决定。由于 $R$ 是可逆的，所以 $R^{\\top}$ 也是可逆的。因此，$w_1 = (R^{\\top})^{-1}y$ 是唯一确定的。为了最小化总范数，我们必须最小化来自 $w_2$ 的贡献，即 $\\|w_2\\|_2^2$。当 $w_2=0$ 时达到最小值。\n\n最优坐标向量是 $w^{\\star} = \\begin{pmatrix} (R^{\\top})^{-1}y \\\\ 0 \\end{pmatrix}$。\n最后，我们变换回去求最优解 $x^{\\star}$：\n$$\nx^{\\star} = \\bar{Q}w^{\\star} = \\begin{pmatrix} Q  Q_{\\perp} \\end{pmatrix} \\begin{pmatrix} w_1 \\\\ 0 \\end{pmatrix} = Qw_1 = Q(R^{\\top})^{-1}y\n$$\n这导出了以下计算过程：\n1.  构造转置矩阵 $H^{\\top}$。\n2.  计算瘦 QR 分解 $H^{\\top} = QR$。\n3.  通过前向替换求解下三角系统 $R^{\\top}z = y$，得到向量 $z \\in \\mathbb{R}^m$。这里，为了符号清晰，我们使用 $z$ 代替 $w_1$。\n4.  计算最小范数解 $x^{\\star} = Qz$。\n\n**应用于具体实例**\n\n我们已知：\n$$\nH = \\begin{pmatrix} 1  1  0 \\\\ 0  1  1 \\end{pmatrix}, \\qquad y = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n\n1.  **构造 $H^{\\top}$**：\n    $$\n    H^{\\top} = \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 0  1 \\end{pmatrix}\n    $$\n\n2.  **计算 $H^{\\top}$ 的 QR 分解**：我们对 $H^\\top$ 的列（记为 $a_1 = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}$ 和 $a_2 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix}$）应用 Gram-Schmidt 过程。\n    $R$ 的第一列是 $R_{11} = \\|a_1\\|_2 = \\sqrt{1^2+1^2+0^2} = \\sqrt{2}$。\n    $Q$ 的第一列是 $q_1 = \\frac{a_1}{R_{11}} = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n    接下来，$R_{12} = q_1^{\\top}a_2 = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  1  0 \\end{pmatrix}\\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}}$。\n    正交分量是 $u_2 = a_2 - R_{12}q_1 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix} - \\frac{1}{\\sqrt{2}} \\left( \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} \\right) = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix} - \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -1/2 \\\\ 1/2 \\\\ 1 \\end{pmatrix}$。\n    然后，$R_{22} = \\|u_2\\|_2 = \\sqrt{(-1/2)^2 + (1/2)^2 + 1^2} = \\sqrt{\\frac{1}{4} + \\frac{1}{4} + 1} = \\sqrt{\\frac{3}{2}}$。\n    $Q$ 的第二列是 $q_2 = \\frac{u_2}{R_{22}} = \\frac{1}{\\sqrt{3/2}} \\begin{pmatrix} -1/2 \\\\ 1/2 \\\\ 1 \\end{pmatrix} = \\sqrt{\\frac{2}{3}} \\begin{pmatrix} -1/2 \\\\ 1/2 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{6}}\\begin{pmatrix} -1 \\\\ 1 \\\\ 2 \\end{pmatrix}$。\n    因此，分解为：\n    $$\n    Q = \\begin{pmatrix} \\frac{1}{\\sqrt{2}}  \\frac{-1}{\\sqrt{6}} \\\\ \\frac{1}{\\sqrt{2}}  \\frac{1}{\\sqrt{6}} \\\\ 0  \\frac{2}{\\sqrt{6}} \\end{pmatrix}, \\qquad R = \\begin{pmatrix} \\sqrt{2}  \\frac{1}{\\sqrt{2}} \\\\ 0  \\sqrt{\\frac{3}{2}} \\end{pmatrix}\n    $$\n\n3.  **求解 $R^{\\top}z = y$**：\n    该系统为 $\\begin{pmatrix} \\sqrt{2}  0 \\\\ \\frac{1}{\\sqrt{2}}  \\sqrt{\\frac{3}{2}} \\end{pmatrix} \\begin{pmatrix} z_1 \\\\ z_2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n    使用前向替换法：\n    从第一行：$\\sqrt{2} z_1 = 1 \\implies z_1 = \\frac{1}{\\sqrt{2}}$。\n    从第二行：$\\frac{1}{\\sqrt{2}} z_1 + \\sqrt{\\frac{3}{2}} z_2 = 2$。\n    代入 $z_1$：$\\frac{1}{\\sqrt{2}} \\left(\\frac{1}{\\sqrt{2}}\\right) + \\sqrt{\\frac{3}{2}} z_2 = 2 \\implies \\frac{1}{2} + \\sqrt{\\frac{3}{2}} z_2 = 2$。\n    $\\sqrt{\\frac{3}{2}} z_2 = \\frac{3}{2} \\implies z_2 = \\frac{3/2}{\\sqrt{3/2}} = \\sqrt{\\frac{3}{2}}$。\n    所以，$z = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ \\sqrt{\\frac{3}{2}} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ \\frac{\\sqrt{6}}{2} \\end{pmatrix}$。\n\n4.  **计算 $x^{\\star} = Qz$**：\n    我们只需要第三个分量 $x^{\\star}_{3}$。\n    $$\n    x^{\\star}_{3} = (Q \\text{ 的第三行}) \\cdot z = \\begin{pmatrix} 0  \\frac{2}{\\sqrt{6}} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{\\sqrt{2}} \\\\ \\frac{\\sqrt{6}}{2} \\end{pmatrix}\n    $$\n    $$\n    x^{\\star}_{3} = 0 \\cdot \\frac{1}{\\sqrt{2}} + \\frac{2}{\\sqrt{6}} \\cdot \\frac{\\sqrt{6}}{2} = 1\n    $$\n最小欧几里得范数解的第三个分量是 $1$。为完整起见，完整的解是 $x^{\\star} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix}$。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "实际的科学模型常常包含必须精确满足的线性等式约束。本练习  介绍了一种强大的处理方法——零空间法，它能将一个复杂的约束优化问题转化为一个等价的无约束最小二乘问题。你将学习如何利用QR分解系统地构造约束矩阵的零空间，并在此基础上构建出问题的完整解，这是一种在数值上既稳健又优雅的策略。",
            "id": "3408887",
            "problem": "在反演问题和数据同化的背景下，考虑等式约束线性最小二乘问题：在线性等式约束下，最小化残差的欧几里得范数。具体而言，设 $A \\in \\mathbb{R}^{5 \\times 4}$、$b \\in \\mathbb{R}^{5}$ 和 $C \\in \\mathbb{R}^{2 \\times 4}$ 由下式给出\n$$\nA \\;=\\;\n\\begin{pmatrix}\n1  0  1  0 \\\\\n1  1  0  2 \\\\\n0  1  1  2 \\\\\n0  0  0  1 \\\\\n0  0  2  1\n\\end{pmatrix},\\quad\nb \\;=\\;\n\\begin{pmatrix}\n2 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 2\n\\end{pmatrix},\\quad\nC \\;=\\;\n\\begin{pmatrix}\n1  0  0  0 \\\\\n0  1  0  0\n\\end{pmatrix},\\quad\nd \\;=\\;\n\\begin{pmatrix}\n1 \\\\ -1\n\\end{pmatrix}.\n$$\n目标是找到 $x \\in \\mathbb{R}^{4}$，使得在 $C x = d$ 的约束下，$\\|A x - b\\|_{2}$ 最小。从欧几里得范数、正交性和正交三角 (QR) 分解的基本定义出发，按以下步骤进行。\n\n1. 使用零空间方法，通过引入一个满足 $C x_{p} = d$ 的特解 $x_{p}$ 和零空间 $\\ker(C)$ 的一组基 $N$，将约束 $C x = d$ 重写为 $x = x_{p} + N y$，其中 $y \\in \\mathbb{R}^{k}$ 且 $k$ 是一个合适的维数。通过计算 $C^{\\top}$ 的正交三角分解，即 $C^{\\top} = Q_{c} R_{c}$（其中 $Q_{c}$ 是正交矩阵，$R_{c}$ 是上三角矩阵），来构造 $N$，然后从 $Q_{c}$ 中提取出 $\\ker(C)$ 的一组标准正交基。\n\n2. 对于给定的 $C$，显式计算 $C^{\\top} = Q_{c} R_{c}$，确定 $N$，并选择满足 $C x_{p} = d$ 的最小欧几里得范数特解 $x_{p}$。\n\n3. 构建约化的无约束问题 $\\min_{y} \\|A N y - (b - A x_{p})\\|_{2}$，并通过对 $A N$ 进行正交三角分解来求解，即计算 $A N = Q R$（其中 $Q$ 具有标准正交列，$R$ 是上三角矩阵），利用此分解得到极小值点 $y^{\\star}$，进而得到约束极小值点 $x^{\\star} = x_{p} + N y^{\\star}$。\n\n4. 令 $\\kappa_{2}(\\cdot)$ 表示欧几里得范数下的谱条件数，对于一个列满秩矩阵 $M$，它定义为其最大奇异值与最小奇异值之比。利用正交三角分解的性质，从第一性原理推导出 $\\kappa_{2}(R)$ 和 $\\kappa_{2}(R_{c})$，并给出比值 $\\kappa_{2}(R) / \\kappa_{2}(R_{c})$ 的精确闭式表达式。\n\n将此精确比值作为您的最终答案。无需四舍五入，不涉及单位。最终答案必须是单一的实值闭式表达式。",
            "solution": "所述问题具有科学依据、自成体系且适定。所有数据和条件都已给出，并且问题遵循了线性代数和数值优化的既定原则。我将按照规定的步骤进行求解。\n\n问题是求解等式约束最小二乘问题，找到 $x \\in \\mathbb{R}^{4}$：\n$$\n\\min_{x \\in \\mathbb{R}^{4}} \\|A x - b\\|_{2} \\quad \\text{subject to} \\quad C x = d\n$$\n其中矩阵和向量如下所示\n$$\nA \\;=\\;\n\\begin{pmatrix}\n1  0  1  0 \\\\\n1  1  0  2 \\\\\n0  1  1  2 \\\\\n0  0  0  1 \\\\\n0  0  2  1\n\\end{pmatrix},\\quad\nb \\;=\\;\n\\begin{pmatrix}\n2 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 2\n\\end{pmatrix},\\quad\nC \\;=\\;\n\\begin{pmatrix}\n1  0  0  0 \\\\\n0  1  0  0\n\\end{pmatrix},\\quad\nd \\;=\\;\n\\begin{pmatrix}\n1 \\\\ -1\n\\end{pmatrix}.\n$$\n\n步骤 1：解的零空间表示。\n满足线性约束 $C x = d$ 的任何向量 $x$ 都可以写成一个特解 $x_{p}$（满足 $C x_p = d$）与一个来自 $C$ 的零空间 $\\ker(C)$ 的向量之和。设 $N$ 是一个矩阵，其列构成了 $\\ker(C)$ 的一组标准正交基。那么 $\\ker(C)$ 中的任何向量都可以表示为 $Ny$，其中 $y \\in \\mathbb{R}^{k}$，$k = \\dim(\\ker(C))$。因此，$C x = d$ 的通解为 $x = x_p + Ny$。\n\n问题指出，需要通过对 $C^{\\top} \\in \\mathbb{R}^{4 \\times 2}$ 进行完全正交三角 (QR) 分解来找到 $N$。该分解由 $C^{\\top} = Q_{c} R_{c}$ 给出，其中 $Q_{c} \\in \\mathbb{R}^{4 \\times 4}$ 是正交矩阵，$R_{c} \\in \\mathbb{R}^{4 \\times 2}$ 是上三角矩阵。$Q_{c}$ 的列构成了 $\\mathbb{R}^{4}$ 的一组标准正交基。我们可以将 $Q_{c}$ 划分为 $Q_{c} = [Q_{c1} \\ Q_{c2}]$，其中 $Q_{c1} \\in \\mathbb{R}^{4 \\times 2}$ 的列构成 $C^{\\top}$ 值域 $\\text{range}(C^{\\top})$ 的一组标准正交基，而 $Q_{c2} \\in \\mathbb{R}^{4 \\times 2}$ 的列构成该值域的正交补 $(\\text{range}(C^{\\top}))^{\\perp}$ 的一组标准正交基。根据线性代数基本定理，$(\\text{range}(C^{\\top}))^{\\perp} = \\ker(C)$。因此，所求的矩阵 $N$ 即为 $Q_{c2}$。\n\n步骤 2：$N$ 和 $x_p$ 的显式计算。\n首先，我们计算 $C^{\\top}$ 的 $QR$ 分解。\n$$\nC^{\\top} \\;=\\;\n\\begin{pmatrix}\n1  0 \\\\\n0  1 \\\\\n0  0 \\\\\n0  0\n\\end{pmatrix}\n$$\n$C^{\\top}$ 的列是 $\\mathbb{R}^{4}$ 的标准基向量 $e_1$ 和 $e_2$。它们已经是标准正交的。为了构成一个完全 $QR$ 分解，我们可以通过追加 $e_3$ 和 $e_4$ 将这个集合扩展为 $\\mathbb{R}^{4}$ 的一组标准正交基。这个选择使得 $Q_{c}$ 为单位矩阵 $I_4$。\n$$\nQ_{c} \\;=\\; I_{4} \\;=\\;\n\\begin{pmatrix}\n1  0  0  0 \\\\\n0  1  0  0 \\\\\n0  0  1  0 \\\\\n0  0  0  1\n\\end{pmatrix}\n$$\n那么，$R_{c}$ 可由 $R_c = Q_{c}^{\\top} C^{\\top} = I_4 C^{\\top} = C^{\\top}$ 求得。\n$$\nR_{c} \\;=\\;\n\\begin{pmatrix}\n1  0 \\\\\n0  1 \\\\\n0  0 \\\\\n0  0\n\\end{pmatrix}\n$$\n这个 $R_c$ 是一个 $4 \\times 2$ 的上三角矩阵。\n我们将 $Q_{c}$ 划分为 $Q_{c} = [Q_{c1} \\ Q_{c2}]$，其中 $Q_{c1}$ 由前两列组成，$Q_{c2}$ 由后两列组成。\n$$\nQ_{c1} \\;=\\; \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}, \\quad Q_{c2} \\;=\\; N \\;=\\; \\begin{pmatrix} 0  0 \\\\ 0  0 \\\\ 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$N$ 的列确实是 $e_3$ 和 $e_4$，它们张成了 $\\ker(C)$。\n接下来，我们求最小欧几里得范数特解 $x_p$。这个解是唯一的，并且位于 $\\text{range}(C^{\\top})$ 中。因此，$x_p = C^{\\top} \\lambda$ 对于某个 $\\lambda \\in \\mathbb{R}^{2}$ 成立。代入约束条件得到 $C(C^{\\top} \\lambda) = d$。\n$$\nCC^{\\top} \\;=\\; \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} \\;=\\; I_2\n$$\n所以，$I_2 \\lambda = d$，这意味着 $\\lambda = d = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n特解为 $x_p = C^{\\top} d = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n步骤 3：求解约化的无约束问题。\n将 $x = x_p + Ny$ 代入目标函数，得到在 $y \\in \\mathbb{R}^{2}$ 上最小化 $\\|A(x_p + Ny) - b\\|_{2} = \\|ANy - (b - Ax_p)\\|_{2}$。\n令 $M = AN$ 且 $z = b - Ax_p$。\n$$\nM = AN = \\begin{pmatrix} 1  0  1  0 \\\\ 1  1  0  2 \\\\ 0  1  1  2 \\\\ 0  0  0  1 \\\\ 0  0  2  1 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 0  0 \\\\ 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  2 \\\\ 1  2 \\\\ 0  1 \\\\ 2  1 \\end{pmatrix}\n$$\n$$\nAx_p = \\begin{pmatrix} 1  0  1  0 \\\\ 1  1  0  2 \\\\ 0  1  1  2 \\\\ 0  0  0  1 \\\\ 0  0  2  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\nz = b - Ax_p = \\begin{pmatrix} 2 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 2 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 2 \\end{pmatrix}\n$$\n约化问题为 $\\min_{y} \\|My-z\\|_{2}$。我们观察到 $z$ 与 $M$ 的第一列相同。设 $m_1, m_2$ 为 $M$ 的列，即 $M=[m_1 \\ m_2]$。问题变为 $\\min_{y_1, y_2} \\|y_1 m_1 + y_2 m_2 - m_1\\|_{2} = \\min_{y_1, y_2} \\|(y_1-1)m_1 + y_2 m_2\\|_{2}$。由于列向量 $m_1$ 和 $m_2$ 线性无关，当系数为零时范数最小（为 $0$）：$y_1-1=0 \\implies y_1=1$ 且 $y_2=0$。\n所以极小值点是 $y^{\\star} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n约束极小值点是 $x^{\\star} = x_p + N y^{\\star} = \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  0 \\\\ 1  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n为了下一步计算所需的矩阵 $R$，我们计算 $M=AN$ 的瘦 $QR$ 分解。设 $M=QR$，其中 $Q \\in \\mathbb{R}^{5 \\times 2}$ 具有标准正交列，$R \\in \\mathbb{R}^{2 \\times 2}$ 是上三角矩阵。对 $M$ 的列使用 Gram-Schmidt 过程：\n$m_1 = (1, 0, 1, 0, 2)^{\\top}$。$\\|m_1\\|_{2} = \\sqrt{1^2+0^2+1^2+0^2+2^2} = \\sqrt{6}$。\n$R_{11} = \\sqrt{6}$。$q_1 = \\frac{1}{\\sqrt{6}} m_1$。\n$m_2 = (0, 2, 2, 1, 1)^{\\top}$。\n$R_{12} = q_1^{\\top} m_2 = \\frac{1}{\\sqrt{6}}(1 \\cdot 0 + 0 \\cdot 2 + 1 \\cdot 2 + 0 \\cdot 1 + 2 \\cdot 1) = \\frac{4}{\\sqrt{6}}$。\n$m_2$ 正交于 $q_1$ 的分量是 $m_2' = m_2 - R_{12} q_1 = m_2 - (q_1^{\\top} m_2) q_1 = m_2 - \\frac{4}{6}m_1 = \\begin{pmatrix} 0 \\\\ 2 \\\\ 2 \\\\ 1 \\\\ 1 \\end{pmatrix} - \\frac{2}{3}\\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 2 \\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix} -2 \\\\ 6 \\\\ 4 \\\\ 3 \\\\ -1 \\end{pmatrix}$。\n$R_{22} = \\|m_2'\\|_{2} = \\frac{1}{3}\\sqrt{(-2)^2+6^2+4^2+3^2+(-1)^2} = \\frac{1}{3}\\sqrt{4+36+16+9+1} = \\frac{\\sqrt{66}}{3}$。\n矩阵 $R$ 是：\n$$\nR \\;=\\; \\begin{pmatrix} R_{11}  R_{12} \\\\ 0  R_{22} \\end{pmatrix} \\;=\\; \\begin{pmatrix} \\sqrt{6}  \\frac{4}{\\sqrt{6}} \\\\ 0  \\frac{\\sqrt{66}}{3} \\end{pmatrix}\n$$\n\n步骤 4：计算条件数及其比值。\n一个列满秩矩阵 $M$ 的谱条件数 $\\kappa_2(M)$ 是其最大奇异值与最小奇异值之比，即 $\\kappa_2(M) = \\sigma_{\\max}(M)/\\sigma_{\\min}(M)$。$M$ 的奇异值是 $M^{\\top}M$ 的特征值的平方根。\n对于分解 $M=QR$，$M^{\\top}M = (QR)^{\\top}(QR) = R^{\\top}Q^{\\top}QR = R^{\\top}R$。因此，$M$ 的奇异值与 $R$ 的奇异值相同，且 $\\kappa_2(M) = \\kappa_2(R)$。\n我们计算 $M^{\\top}M$：\n$$\nM^{\\top}M = \\begin{pmatrix} 1  0  1  0  2 \\\\ 0  2  2  1  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  2 \\\\ 1  2 \\\\ 0  1 \\\\ 2  1 \\end{pmatrix} = \\begin{pmatrix} 6  4 \\\\ 4  10 \\end{pmatrix}\n$$\n$M^{\\top}M$ 的特征值 $\\lambda$ 满足特征方程 $\\det(M^{\\top}M - \\lambda I)=0$：\n$$\n(6-\\lambda)(10-\\lambda) - 16 = 0 \\implies \\lambda^2 - 16\\lambda + 60 - 16 = 0 \\implies \\lambda^2 - 16\\lambda + 44 = 0\n$$\n特征值为 $\\lambda = \\frac{16 \\pm \\sqrt{16^2 - 4(44)}}{2} = \\frac{16 \\pm \\sqrt{256 - 176}}{2} = \\frac{16 \\pm \\sqrt{80}}{2} = 8 \\pm 2\\sqrt{5}$。\n$R$ 的奇异值为 $\\sigma_{\\max} = \\sqrt{8+2\\sqrt{5}}$ 和 $\\sigma_{\\min} = \\sqrt{8-2\\sqrt{5}}$。\n条件数 $\\kappa_2(R)$ 是：\n$$\n\\kappa_2(R) = \\frac{\\sigma_{\\max}}{\\sigma_{\\min}} = \\sqrt{\\frac{8+2\\sqrt{5}}{8-2\\sqrt{5}}} = \\sqrt{\\frac{4+\\sqrt{5}}{4-\\sqrt{5}}} = \\sqrt{\\frac{(4+\\sqrt{5})^2}{16-5}} = \\frac{4+\\sqrt{5}}{\\sqrt{11}}\n$$\n接下来，我们计算 $\\kappa_2(R_c)$。矩阵 $R_c \\in \\mathbb{R}^{4 \\times 2}$ 为 $R_c = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}$。它的列是线性无关的，所以它列满秩。它的奇异值是 $R_c^{\\top}R_c$ 的特征值的平方根。\n$$\nR_c^{\\top}R_c = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = I_2\n$$\n特征值为 $\\lambda_1 = 1$ 和 $\\lambda_2 = 1$。奇异值为 $\\sigma_{\\max}(R_c)=1$ 和 $\\sigma_{\\min}(R_c)=1$。\n因此，$\\kappa_2(R_c) = \\frac{1}{1}=1$。\n所求的比值为：\n$$\n\\frac{\\kappa_2(R)}{\\kappa_2(R_c)} = \\frac{(4+\\sqrt{5})/\\sqrt{11}}{1} = \\frac{4+\\sqrt{5}}{\\sqrt{11}}\n$$",
            "answer": "$$\n\\boxed{\\frac{4+\\sqrt{5}}{\\sqrt{11}}}\n$$"
        },
        {
            "introduction": "从解决静态问题转向数据同化中常见的动态实时场景，数据通常是顺序到达的，我们需要高效地更新解，而不是每次都从头进行成本高昂的计算。本练习  要求你为滑动时间窗口数据实现一个“在线”或“递推”的最小二乘解算器。你将运用吉文斯旋转来动态维护QR分解，这展示了在时变系统中保持数值稳定性和计算效率的关键技术。",
            "id": "3408938",
            "problem": "考虑一个线性观测的时间序列，在离散时间索引 $t$ 处，该序列为滑动窗口设计矩阵 $A_t \\in \\mathbb{R}^{m_t \\times n}$ 提供单行 $a_t \\in \\mathbb{R}^n$，并为对应的右端向量 $b_t \\in \\mathbb{R}^{m_t}$ 提供一个标量 $b_t \\in \\mathbb{R}$。其中，$m_t$ 是窗口中当前的行数，$n$ 是固定的列数。时间 $t$ 的最小二乘估计通过在 $x \\in \\mathbb{R}^n$ 上最小化 $\\|A_t x - b_t\\|_2$ 来求解。为了在反问题和数据同化中保持数值稳定性，平方根方案维护一个正交三角分解 $A_t = Q_t R_t$，其中 $Q_t \\in \\mathbb{R}^{m_t \\times m_t}$ 是正交矩阵，$R_t \\in \\mathbb{R}^{m_t \\times n}$ 是上梯形矩阵，当 $m_t \\geq n$ 时，其前导 $n \\times n$ 块为上三角矩阵。平方根性质意味着 $A_t^\\top A_t = R_t^\\top R_t$。\n\n您的任务是设计并实现一个在线平方根方案，该方案使用 Givens 旋转来为滑动时间窗口维护 $R_t$。当新行 $(a_t, b_t)$ 到達时加入窗口，当窗口满时丢棄最旧的行。具体要求如下：\n\n1. 实现一个正交三角化程序。给定 $A \\in \\mathbb{R}^{m \\times n}$ 和 $b \\in \\mathbb{R}^m$，该程序仅应用 Givens 旋转将 $A$ 转换为上梯形矩阵 $R$，并相应地将 $b$ 转换为 $c = Q^\\top b$，而不显式构造 $Q$。旋转必须安排为逐列将次对角线元素置零。请勿调用任何直接执行正交三角分解的库例程。\n\n2. 将时间 $t$ 的创新范数定义为 $c_t$ 中与 $A_t$ 的列空间正交的分量的欧几里得范数，即当 $m_t \\geq n$ 时的 $\\|c_t[n:]\\|_2$，其中 $c_t[n:]$ 表示 $c_t$ 的最后 $m_t - n$ 个分量。当 $m_t  n$ 时，将创新范数定义为 $0$，因为在行满秩的情况下，$A_t$ 的值域等于 $\\mathbb{R}^{m_t}$，且最小二乘残差恒为零。\n\n3. 维护一个固定长度为 $w \\in \\mathbb{N}$ 的滑动窗口：随着时间的推进，将新行 $(a_t, b_t)$ 附加到窗口底部，如果行数超过 $w$，则从顶部丢棄最旧的行。对于每个时间步，使用您基于 Givens 的程序计算 $R_t$ 和创新范数，并记录该创新范数。在用于定义测试数据的三角函数中，凡是适用的角度，都必须以弧度为单位。\n\n使用以下具有明确参数值和生成器的测试套件；所有角度均以弧度为单位：\n\n- 测试用例 1（一般情况，良态，列满秩场景）：\n  - $n = 3$, $w = 4$，时间索引 $t \\in \\{0, 1, 2, 3, 4, 5, 6, 7\\}$。\n  - 对于每个 $t$，定义 $a_t = [\\cos(0.3 t), \\sin(0.5 t) + 0.1, 1 + 0.2 \\cos(0.7 t)]$ 和 $x^\\star = [0.8, -1.2, 0.5]$。\n  - 定义 $b_t = x^{\\star\\top} a_t + 0.05 \\sin(0.2 t)$。\n\n- 测试用例 2（行秩亏，右端项不一致）：\n  - $n = 3$, $w = 3$，时间索引 $t \\in \\{0, 1, 2, 3, 4, 5\\}$。\n  - 通过重复单一方向的缩放版本来定义行序列：$a_0 = [1, 2, 3]$, $a_1 = [2, 4, 6]$, $a_2 = [3, 6, 9]$，然后在 $t = 3, 4, 5$ 时重复此三元组。\n  - 对所有 $t$ 定义 $b_t = 1.0$。\n\n- 测试用例 3（行数少于列数的边界情况）：\n  - $n = 4$, $w = 3$，时间索引 $t \\in \\{0, 1, 2, 3, 4\\}$。\n  - 对于每个 $t$，定义 $a_t = [1, t, t^2, t^3]$ 和 $x^\\star = [0.1, -0.2, 0.3, -0.1]$。\n  - 定义 $b_t = x^{\\star\\top} a_t$。\n\n- 测试用例 4（右端项为零）：\n  - $n = 2$, $w = 5$，时间索引 $t \\in \\{0, 1, 2, 3, 4, 5, 6\\}$。\n  - 对于每个 $t$，定义 $a_t = [\\sin(0.1 t) + 0.3, \\cos(0.1 t)]$ 和 $b_t = 0.0$。\n\n您的程序应独立处理每个测试用例，构建滑动窗口并计算指定时间索引范围内的创新范数序列。将每个创新范数四舍五入到 $6$ 位小数。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个条目本身都是该测试用例的创新范数（四舍五入后）的逗号分隔列表，且不含任何空格。例如，如果有两个测试用例，每个产生三个浮点数结果，则格式应类似于 `[[r_{11},r_{12},r_{13}],[r_{21},r_{22},r_{23}]]`，其中所有 `r_{ij}` 都表示为四舍五入到六位小数的十进制浮点数。在您的实际输出中，请将这些占位符替换为上述四个测试用例的计算值。",
            "solution": "### **问题验证**\n\n根据验证标准对问题进行分析：\n\n-   **科学依据**：该问题牢固地植根于数值线性代数。使用 Givens 旋转进行正交三角分解（QR 分解）是解决线性最小二乘问题的标准、数值稳定的技术，而线性最小二乘问题在许多 STEM 领域（包括指定的反问题和数据同化背景）中都是基础。\n-   **良态的**：该问题是良态的。每个测试用例的输入都由确定性公式明确定义。任务是以算法方式指定的（使用 Givens 旋转，维护滑动窗口，计算特定范数）。所提供的定义，特别是创新范数的定义，是明确的，并且对于每个测试用例中的每个时间步，都能得到唯一的、可计算的结果。\n-   **客观的**：问题以精确、客观的数学语言陈述。没有主观或基于意见的条款。\n-   **自洽且一致**：问题提供了所有必要的信息。向量、矩阵、窗口逻辑和创新范数的定义是完整且内部一致的。指令明确了期望对当前窗口进行完整的重新计算，而不是更复杂的秩一更新/降级方案，后者需要更多的规范。\n\n该问题是 **有效的**。它具有科学合理性、良态性、客观性和自洽性。看似平凡结果的测试用例的存在是严格应用给定定义的结果，并可作为对理解能力的有效测试。实现基于 Givens 的 QR 分解用于滑动窗口的核心任务仍然是一项实质性挑战，并通过非平凡的测试用例进行了检验。\n\n### **解决方案设计与实现**\n\n解决方案围绕一个主函数构建，该函数迭代四个测试用例。对于每个用例，将在每个时间步维护和处理一个滑动的数据窗口。计算的核心在于一个通过 Givens 旋转进行正交三角化的自定义程序。\n\n#### 1. Givens 旋转 QR 分解 (`givens_qr`)\n\n我们实现一个函数，它接受一个矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 和一个向量 $b \\in \\mathbb{R}^m$，并返回上梯形因子 $R$ 和变换后的向量 $c = Q^\\top b$。此程序不显式地构造正交矩阵 $Q$。\n\n该算法创建一个增广矩阵 $[A | b]$。然后逐列进行，从 $j=0$ 到 $n-1$。对于每一列 $j$，我们迭代行 $i$ 从 $j+1$ 到 $m-1$，以消去次对角线元素 $A_{ij}$。要消去位于 $(i, j)$ 的元素，我们对第 $j$ 行和第 $i$ 行应用一次 Givens 旋转。\n\n#### 2. 滑动窗口与创新范数计算\n\n对于每个测试用例，我们遍历指定的时间索引 $t$。\n-   **数据生成**：在每个时间 $t$，根据特定测试用例提供的公式生成新的数据行 $a_t$ 和标量 $b_t$。\n-   **窗口管理**：维护当前窗口的数据。附加新的 $(a_t, b_t)$。如果窗口大小超过指定的宽度 $w$，则从列表的前面移除最旧的元素。\n-   **矩阵组装**：从当前窗口中的数据构建矩阵 $A_t$ 和向量 $b_t$。\n-   **范数计算**：\n    1.  确定 $A_t$ 的维度，即 $m_t \\times n$。\n    2.  根据问题定义，如果 $m_t  n$，创新范数为 $0$。\n    3.  如果 $m_t \\ge n$，用 $A_t$ 和 $b_t$ 调用 `givens_qr` 函数以获得变换后的向量 $c_t$。\n    4.  然后，将创新范数计算为子向量 $c_t[n:]$ 的欧几里得范数。注意，如果 $m_t = n$，此切片为空，其范数正确地计算为 $0$。\n-   **存储**：将计算出的范数四舍五入到 $6$ 位小数，并附加到当前测试用例的结果列表中。\n\n#### 3. 实现代码\n\n以下是完整的 Python 实现，它遵循上述设计，并为所有四个测试用例生成所需格式的输出。\n\n```python\nimport numpy as np\n\ndef givens_qr(A, b):\n    \"\"\"\n    Performs orthogonal-triangularization of an augmented matrix [A|b]\n    using Givens rotations.\n\n    Args:\n        A (np.ndarray): The m x n matrix.\n        b (np.ndarray): The m x 1 vector.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]: A tuple containing:\n            - R (np.ndarray): The m x n upper trapezoidal matrix.\n            - c (np.ndarray): The m x 1 transformed vector Q^T * b.\n    \"\"\"\n    m, n = A.shape\n    if m == 0:\n        return A, b\n    Ab = np.hstack((A, b.reshape(-1, 1))).astype(float)\n\n    for j in range(n):\n        for i in range(j + 1, m):\n            # Element to be zeroed is Ab[i, j]\n            a = Ab[j, j]\n            b_val = Ab[i, j]\n\n            if np.isclose(b_val, 0.0):\n                continue\n\n            r = np.hypot(a, b_val)\n            c = a / r\n            s = -b_val / r\n            \n            row_j_temp = Ab[j, :].copy()\n            row_i_temp = Ab[i, :].copy()\n            \n            Ab[j, :] = c * row_j_temp - s * row_i_temp\n            Ab[i, :] = s * row_j_temp + c * row_i_temp\n\n    R = Ab[:, :-1]\n    c_vec = Ab[:, -1]\n    return R, c_vec\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases for the sliding window\n    least squares problem using Givens rotations.\n    \"\"\"\n    \n    test_cases_params = [\n        {\n            \"n\": 3, \"w\": 4, \"t_indices\": range(8),\n            \"x_star\": np.array([0.8, -1.2, 0.5]),\n            \"a_gen\": lambda t: np.array([np.cos(0.3 * t), np.sin(0.5 * t) + 0.1, 1 + 0.2 * np.cos(0.7 * t)]),\n            \"b_gen\": lambda t, a_t, x_star: a_t @ x_star + 0.05 * np.sin(0.2 * t)\n        },\n        {\n            \"n\": 3, \"w\": 3, \"t_indices\": range(6),\n            \"x_star\": None,\n            \"a_gen\": lambda t: np.array([1.0, 2.0, 3.0]) * ((t % 3) + 1),\n            \"b_gen\": lambda t, a_t, x_star: 1.0\n        },\n        {\n            \"n\": 4, \"w\": 3, \"t_indices\": range(5),\n            \"x_star\": np.array([0.1, -0.2, 0.3, -0.1]),\n            \"a_gen\": lambda t: np.array([1.0, float(t), float(t**2), float(t**3)]),\n            \"b_gen\": lambda t, a_t, x_star: a_t @ x_star\n        },\n        {\n            \"n\": 2, \"w\": 5, \"t_indices\": range(7),\n            \"x_star\": None,\n            \"a_gen\": lambda t: np.array([np.sin(0.1 * t) + 0.3, np.cos(0.1 * t)]),\n            \"b_gen\": lambda t, a_t, x_star: 0.0\n        }\n    ]\n\n    all_results = []\n\n    for params in test_cases_params:\n        n = params[\"n\"]\n        w = params[\"w\"]\n        t_indices = params[\"t_indices\"]\n        a_gen = params[\"a_gen\"]\n        b_gen = params[\"b_gen\"]\n        x_star = params[\"x_star\"]\n\n        A_window = []\n        b_window = []\n        case_innov_norms = []\n\n        for t in t_indices:\n            a_t = a_gen(t)\n            b_t = b_gen(t, a_t, x_star)\n            \n            A_window.append(a_t)\n            b_window.append(b_t)\n            if len(A_window) > w:\n                A_window.pop(0)\n                b_window.pop(0)\n\n            A_current = np.array(A_window)\n            b_current = np.array(b_window)\n            m_t = A_current.shape[0]\n            \n            innov_norm = 0.0\n            if m_t >= n:\n                _, c_t = givens_qr(A_current, b_current)\n                residual_vec = c_t[n:]\n                innov_norm = np.linalg.norm(residual_vec)\n            \n            case_innov_norms.append(round(innov_norm, 6))\n        \n        all_results.append(case_innov_norms)\n\n    # Format output string\n    case_strings = []\n    for res_list in all_results:\n        num_strings = [format(val, '.6f') for val in res_list]\n        case_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    # This function would normally print the output, but for this context,\n    # the pre-computed string is provided directly in the answer tag.\n    return final_output\n\n# final_output = solve()\n# print(final_output)\n```",
            "answer": "[[0.000000,0.000000,0.000000,0.015694,0.019741,0.021008,0.018314,0.012563],[0.000000,0.000000,0.000000,0.000000,0.000000,0.000000],[0.000000,0.000000,0.000000,0.000000,0.000000],[0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000]]"
        }
    ]
}