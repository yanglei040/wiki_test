{
    "hands_on_practices": [
        {
            "introduction": "在将势函数拟合到散射数据时，一个关键步骤是验证所得结果的自洽性。一个成功的势模型不仅要能重现散射数据，还必须与系统的其他已知物理性质（如其束缚态谱）相符。本练习  将引导您应用散射理论中的一个基本定理——Levinson定理。该定理将相移与束缚态数量直接联系起来，为您提供一个量化给定势模型内部一致性的实用工具。",
            "id": "3559829",
            "problem": "一个短程中心核子-核势被用于拟合三个分波（$l=0,1,2$）的弹性散射数据。该拟合为波数 $k$（单位为 $\\mathrm{fm}^{-1}$）生成了以下解析相移模型（单位为弧度）：\n$$\n\\delta_{0}(k)=3.12\\,\\exp\\!\\left(-\\left(\\frac{k}{1.5}\\right)^{2}\\right),\\quad\n\\delta_{1}(k)=0.05\\,\\exp\\!\\left(-\\left(\\frac{k}{1.0}\\right)^{2}\\right),\\quad\n\\delta_{2}(k)=0.01\\,\\exp\\!\\left(-\\left(\\frac{k}{0.8}\\right)^{2}\\right).\n$$\n一个针对同一拟合势的独立束缚态求解器发现在 $l=0,1,2$ 分波道中分别有 $n_{0}=1$, $n_{1}=0$, 和 $n_{2}=0$ 个束缚态。假设该势是短程的，没有阈值反常（即没有半束缚态），并且每个相移的高能极限满足 $\\delta_{l}(k\\to\\infty)\\to 0$。利用散射理论中经过充分检验的谱关系，该关系将分波相移的低能和高能极限与该分波道中的束缚态数量联系起来，定义无量纲一致性度量\n$$\nM=\\sum_{l=0}^{2}\\left(\\frac{\\delta_{l}(0)-\\delta_{l}(\\infty)}{\\pi}-n_{l}\\right)^{2},\n$$\n并为上述拟合集计算 $M$。将最终数值结果四舍五入到四位有效数字。答案表示为纯数（无量纲）。",
            "solution": "该问题要求评估一致性度量 $M$，它量化了对于给定的核子-核势，散射数据（以相移形式给出）与束缚态数据之间的一致性。此比较的理论基础是 Levinson 定理。\n\nLevinson 定理提供了散射相移的低能行为与一个势所能支持的束缚态数量之间的基本联系。对于一个在原点处奇异性低于 $1/r^2$ 的短程中心势 $V(r)$，并且假设不存在零能束缚态（或“半束缚态”），对于角动量量子数为 $l$ 的给定分波，该定理表示为：\n$$\n\\delta_{l}(0) - \\delta_{l}(\\infty) = n_{l}\\pi\n$$\n其中 $\\delta_l(k)$ 是作为波数 $k$ 函数的相移，$n_l$ 是该分波的束缚态数量，并且相移以弧度为单位测量。\n\n问题提供了检验此关系所需的所有信息。它给出了 $l=0, 1, 2$ 时相移 $\\delta_l(k)$ 的解析模型、每个分波道的束缚态数量 $n_l$ 以及相移的高能极限。\n\n一致性度量 $M$ 定义为每个分波偏离 Levinson 定理的平方偏差之和：\n$$\nM = \\sum_{l=0}^{2}\\left(\\frac{\\delta_{l}(0)-\\delta_{l}(\\infty)}{\\pi}-n_{l}\\right)^{2}\n$$\n一个完全一致的模型，其散射计算和束缚态计算完全吻合，将得到 $M=0$。\n\n我们必须首先确定每个分波 $l \\in \\{0, 1, 2\\}$ 的 $\\delta_l(0)$ 和 $\\delta_l(\\infty)$ 的值。\n\n给定的相移模型为：\n$$\n\\delta_{0}(k) = 3.12\\,\\exp\\!\\left(-\\left(\\frac{k}{1.5}\\right)^{2}\\right)\n$$\n$$\n\\delta_{1}(k) = 0.05\\,\\exp\\!\\left(-\\left(\\frac{k}{1.0}\\right)^{2}\\right)\n$$\n$$\n\\delta_{2}(k) = 0.01\\,\\exp\\!\\left(-\\left(\\frac{k}{0.8}\\right)^{2}\\right)\n$$\n问题明确指出高能极限为 $\\delta_{l}(k\\to\\infty) \\to 0$。这与给定的解析形式一致，因为每个函数中的指数项在 $k \\to \\infty$ 时趋近于零。因此，对于所有三个分波，我们有：\n$$\n\\delta_{l}(\\infty) = 0 \\quad \\text{for } l = 0, 1, 2\n$$\n接下来，我们计算每个相移的低能极限（$k=0$）：\n对于 $l=0$：\n$$\n\\delta_{0}(0) = 3.12\\,\\exp\\!\\left(-\\left(\\frac{0}{1.5}\\right)^{2}\\right) = 3.12\\,\\exp(0) = 3.12\n$$\n对于 $l=1$：\n$$\n\\delta_{1}(0) = 0.05\\,\\exp\\!\\left(-\\left(\\frac{0}{1.0}\\right)^{2}\\right) = 0.05\\,\\exp(0) = 0.05\n$$\n对于 $l=2$：\n$$\n\\delta_{2}(0) = 0.01\\,\\exp\\!\\left(-\\left(\\frac{0}{0.8}\\right)^{2}\\right) = 0.01\\,\\exp(0) = 0.01\n$$\n束缚态的数量给定为：\n$$\nn_{0} = 1\n$$\n$$\nn_{1} = 0\n$$\n$$\nn_{2} = 0\n$$\n现在我们可以计算 $M$ 的求和中的各个项。\n\n对于 $l=0$ 分波：\n该项为 $\\left(\\frac{\\delta_{0}(0)-\\delta_{0}(\\infty)}{\\pi}-n_{0}\\right)^{2}$。代入数值：\n$$\n\\left(\\frac{3.12 - 0}{\\pi} - 1\\right)^{2} = \\left(\\frac{3.12}{\\pi} - 1\\right)^{2}\n$$\n对于 $l=1$ 分波：\n该项为 $\\left(\\frac{\\delta_{1}(0)-\\delta_{1}(\\infty)}{\\pi}-n_{1}\\right)^{2}$。代入数值：\n$$\n\\left(\\frac{0.05 - 0}{\\pi} - 0\\right)^{2} = \\left(\\frac{0.05}{\\pi}\\right)^{2}\n$$\n对于 $l=2$ 分波：\n该项为 $\\left(\\frac{\\delta_{2}(0)-\\delta_{2}(\\infty)}{\\pi}-n_{2}\\right)^{2}$。代入数值：\n$$\n\\left(\\frac{0.01 - 0}{\\pi} - 0\\right)^{2} = \\left(\\frac{0.01}{\\pi}\\right)^{2}\n$$\n总度量 $M$ 是这三项之和：\n$$\nM = \\left(\\frac{3.12}{\\pi} - 1\\right)^{2} + \\left(\\frac{0.05}{\\pi}\\right)^{2} + \\left(\\frac{0.01}{\\pi}\\right)^{2}\n$$\n现在，我们使用 $\\pi \\approx 3.14159265$ 的值进行数值计算。\n第一项 ($l=0$):\n$$\n\\left(\\frac{3.12}{3.14159265} - 1\\right)^{2} \\approx (0.99312678 - 1)^{2} = (-0.00687322)^{2} \\approx 4.72410 \\times 10^{-5}\n$$\n第二项 ($l=1$):\n$$\n\\left(\\frac{0.05}{3.14159265}\\right)^{2} \\approx (0.01591549)^{2} \\approx 2.53303 \\times 10^{-4}\n$$\n第三项 ($l=2$):\n$$\n\\left(\\frac{0.01}{3.14159265}\\right)^{2} \\approx (0.00318310)^{2} \\approx 1.01321 \\times 10^{-5}\n$$\n将这些值相加得到 $M$：\n$$\nM \\approx 4.72410 \\times 10^{-5} + 2.53303 \\times 10^{-4} + 1.01321 \\times 10^{-5}\n$$\n$$\nM \\approx 0.472410 \\times 10^{-4} + 2.53303 \\times 10^{-4} + 0.101321 \\times 10^{-4}\n$$\n$$\nM \\approx (0.472410 + 2.53303 + 0.101321) \\times 10^{-4} = 3.106761 \\times 10^{-4}\n$$\n问题要求最终答案四舍五入到四位有效数字。前四位有效数字是 $3$、$1$、$0$ 和 $6$。随后的数字是 $7$，大于或等于 $5$，因此我们将最后一位有效数字向上舍入。\n$$\nM \\approx 3.107 \\times 10^{-4}\n$$\n这个小的非零值表明，对于同一势，散射相移模型与束缚态的计算之间存在轻微的不一致性。",
            "answer": "$$\n\\boxed{3.107 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "本章的最后一个练习将引导您完成工作流程的最终环节：拟合一个具有明确物理动机的特定模型，并对其结果进行评估。虽然非参数化方法具有灵活性，但许多模型建立在特定的理论思想之上，例如核力的非定域性。这个高级练习  不仅涉及拟合一个参数化的非定域势（Perey-Buck模型），更重要的是，它超越了简单地寻找最佳拟合参数，而是利用协方差矩阵来量化这些参数的不确定性及其相关性。这种分析对于理解您的数据在何种程度上能够约束您的模型至关重要。",
            "id": "3559738",
            "problem": "您的任务是，从第一性原理出发，构建一个计算模型，用以将一个具有高斯非局域性（力程为 $\\beta$）的非局域Perey–Buck光学势拟合到弹性散射角分布数据上，并量化在多个实验室能量 $E_{\\text{lab}}$ 下的弹性角分布如何约束 $\\beta$ 与局域深度参数的关系。您必须生成一个完整、可运行的程序，该程序实现下述模型和拟合逻辑，并以单一、明确定义的格式输出指定的量化指标。\n\n从标准的非相对论量子散射理论基础开始。使用一级玻恩近似处理来自中心势的弹性散射。假设一个球对称的局域势具有高斯形式 $U_{\\text{L}}(r) = -V \\exp\\left(-r^2/a^2\\right)$，其中 $V$ 是以 $\\mathrm{MeV}$ 为单位的实数深度参数，$a$ 是以 $\\mathrm{fm}$ 为单位的固定力程。通过一个力程为 $\\beta$ 的高斯核来引入Perey–Buck类型的非局域性，即一个非局域势核 $U(\\mathbf{r},\\mathbf{r}')$ 正比于 $\\exp\\left(-|\\mathbf{r}-\\mathbf{r}'|^2/\\beta^2\\right)$，其局域强度在 $(\\mathbf{r}+\\mathbf{r}')/2$ 处取值。在一级玻恩近似和平面波态下，该非局域高斯核在动量空间中分解为作用于局域势傅里叶变换上的一个乘性阻尼因子 $\\exp\\left(-\\beta^2 q^2/4\\right)$，其中 $q$ 是动量转移。对于高斯局域势 $U_{\\text{L}}(r)$，其三维傅里叶变换得到一个关于 $q$ 的高斯函数，因此散射振幅可以写成一个常数乘以 $\\exp\\left(-(a^2+\\beta^2)q^2/4\\right)$，而微分截面是该振幅的模平方。\n\n具体来说，程序必须实现以下基于物理的步骤并使用指定的单位：\n- 使用质量数为 $A$ 的靶核与核子质量为 $m_N$（单位 $\\mathrm{MeV}$）的入射核子构成的系统的折合质量 $\\mu$ 以及质心能量 $E_{\\text{cm}}$，通过以下公式计算在壳动量 $k$（单位 $\\mathrm{fm}^{-1}$）：\n$$\n\\mu = \\frac{m_N \\, (A m_N)}{m_N + A m_N}, \\quad E_{\\text{cm}} = E_{\\text{lab}} \\, \\frac{A m_N}{m_N + A m_N}, \\quad\nk = \\frac{\\sqrt{2 \\mu E_{\\text{cm}}}}{\\hbar c},\n$$\n其中 $\\hbar c$ 的单位是 $\\mathrm{MeV}\\cdot\\mathrm{fm}$，$c=1$。对于散射角 $\\theta$（以度为单位），需将其转换为弧度，并使用 $q = 2 k \\sin(\\theta/2)$。\n- 在一级玻恩近似下，对于具有高斯非局域性的非局域Perey–Buck核，将微分截面建模为：\n$$\n\\frac{d\\sigma}{d\\Omega}(E_{\\text{lab}},\\theta; \\beta,V,a) =\n\\left|\n\\frac{2\\mu}{\\hbar^2} \\frac{1}{4\\pi} \\, \\widetilde{U}_{\\text{L}}(q) \\, \\exp\\left(-\\frac{\\beta^2 q^2}{4}\\right)\n\\right|^2,\n\\quad\n\\widetilde{U}_{\\text{L}}(q) = -V \\, \\pi^{3/2} a^3 \\exp\\left(-\\frac{a^2 q^2}{4}\\right),\n$$\n因此\n$$\n\\frac{d\\sigma}{d\\Omega} =\n\\left[\n\\frac{2\\mu}{\\hbar^2} \\frac{1}{4\\pi} \\, \\pi^{3/2} a^3 V\n\\right]^2\n\\exp\\left(-\\frac{(a^2+\\beta^2) q^2}{2}\\right).\n$$\n微分截面以 $\\mathrm{fm}^2/\\mathrm{sr}$ 表示，角度以度表示，能量以 $\\mathrm{MeV}$ 表示，长度以 $\\mathrm{fm}$ 表示。\n\n使用已知的“真实”参数 $(\\beta_{\\text{true}}, V_{\\text{true}}, a)$ 和上述模型，在多个能量点构建合成的“实验”弹性角分布。然后，执行加权非线性最小二乘拟合来估计 $(\\beta,V)$，方法是最小化模型与合成数据之间的残差。残差由相对测量不确定度 $\\epsilon$ 加权，因此数据点 $i$ 的残差为：\n$$\nr_i = \\frac{ \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i} - \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i} }{ \\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i} }.\n$$\n收敛后，使用加权最小二乘估计的线性化协方差矩阵来量化参数的约束：\n$$\n\\mathbf{C} \\approx \\left( \\mathbf{J}^\\top \\mathbf{J} \\right)^{-1},\n$$\n其中 $\\mathbf{J}$ 是残差关于 $(\\beta,V)$ 在解处求值的雅可比矩阵。报告边缘标准差 $\\sigma_\\beta = \\sqrt{C_{\\beta\\beta}}$ 和 $\\sigma_V = \\sqrt{C_{VV}}$，以及相关系数：\n$$\n\\rho_{\\beta,V} = \\frac{C_{\\beta V}}{\\sigma_\\beta \\sigma_V}.\n$$\n如果 $\\mathbf{J}^\\top \\mathbf{J}$ 是病态的，则通过添加一个小的对角Tikhonov项 $\\lambda \\mathbf{I}$ 对其进行正则化，其中 $\\lambda$ 的选择应足够小以避免使结果产生偏差，同时又能允许求逆。\n\n明确假设并声明以下数值常量和单位：\n- 使用 $\\hbar c = 197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}$，\n- 使用 $m_N = 939.0\\,\\mathrm{MeV}$，\n- 使用 $A=40$（钙靶），\n- 使用 $\\epsilon = 0.05$，\n- 在所有拟合和数据生成中使用 $a=1.2\\,\\mathrm{fm}$。\n\n实现一个包含四个旨在实现覆盖率的测试用例的测试套件：\n- 用例A（理想路径）：$E_{\\text{lab}} = [30, 50]\\,\\mathrm{MeV}$，$\\theta = [20,40,60,80,100]^\\circ$，其中 $\\beta_{\\text{true}}=0.9\\,\\mathrm{fm}$，$V_{\\text{true}}=50\\,\\mathrm{MeV}$。\n- 用例B（低能边界）：$E_{\\text{lab}} = [5]\\,\\mathrm{MeV}$，$\\theta = [20,40,60,80,100,120,140,160]^\\circ$，其中 $\\beta_{\\text{true}}=0.9\\,\\mathrm{fm}$，$V_{\\text{true}}=50\\,\\mathrm{MeV}$。\n- 用例C（高能、大角度）：$E_{\\text{lab}} = [100, 150]\\,\\mathrm{MeV}$，$\\theta = [20,40,60,80,100,120,140,160]^\\circ$，其中 $\\beta_{\\text{true}}=0.9\\,\\mathrm{fm}$，$V_{\\text{true}}=50\\,\\mathrm{MeV}$。\n- 用例D（前向角边界）：$E_{\\text{lab}} = [50]\\,\\mathrm{MeV}$，$\\theta = [5,10,15]^\\circ$，其中 $\\beta_{\\text{true}}=0.9\\,\\mathrm{fm}$，$V_{\\text{true}}=50\\,\\mathrm{MeV}$。\n\n对于每个用例，从一个合理的初始猜测值和边界（$\\beta \\in [0.2,2.0]\\,\\mathrm{fm}$，$V \\in [1.0,200.0]\\,\\mathrm{MeV}$）开始拟合 $(\\beta,V)$。计算并返回浮点数元组 $(\\hat{\\beta}, \\hat{V}, \\sigma_\\beta, \\sigma_V, \\rho_{\\beta,V})$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含所有测试用例的串联结果，形式为方括号括起来的逗号分隔列表，每个浮点数四舍五入到小数点后六位，顺序如下：\n$$\n[\\hat{\\beta}_{A}, \\hat{V}_{A}, \\sigma_{\\beta,A}, \\sigma_{V,A}, \\rho_{\\beta,V;A}, \\hat{\\beta}_{B}, \\hat{V}_{B}, \\sigma_{\\beta,B}, \\sigma_{V,B}, \\rho_{\\beta,V;B}, \\hat{\\beta}_{C}, \\hat{V}_{C}, \\sigma_{\\beta,C}, \\sigma_{V,C}, \\rho_{\\beta,V;C}, \\hat{\\beta}_{D}, \\hat{V}_{D}, \\sigma_{\\beta,D}, \\sigma_{V,D}, \\rho_{\\beta,V;D} ].\n$$\n不得打印任何其他文本。所有数值必须使用指定的单位：$\\beta$ 的单位为 $\\mathrm{fm}$，$V$ 的单位为 $\\mathrm{MeV}$。角度以度为单位输入；程序必须在内部将其转换为弧度，并使用以弧度为单位的 $\\theta$ 计算 $q$。微分截面必须以 $\\mathrm{fm}^2/\\mathrm{sr}$ 为单位进行计算和比较。",
            "solution": "该问题被评估为有效。这是一个在计算核物理领域中提法恰当、有科学依据的问题，要求实现一个标准的模型拟合程序。问题陈述是自洽的，为获得唯一解提供了所有必需的物理公式、常数和程序要求。\n\n问题的核心是将核子-原子核弹性散射的理论模型拟合到综合生成的数据上，并分析模型参数受到的统计约束。该模型基于Perey-Buck型非局域光学势的一级玻恩近似。\n\n问题提供了微分截面 $\\frac{d\\sigma}{d\\Omega}$ 的基本物理模型，它是一组给定的势参数 $(\\beta, V, a)$ 下，关于实验室能量 $E_{\\text{lab}}$ 和散射角 $\\theta$ 的函数。这些参数分别是：非局域性力程 $\\beta$、局域势深度 $V$ 和局域势力程 $a$。其推导始于标准的非相对论运动学关系，用于从实验室坐标系转换到质心 (CM) 坐标系。\n\n入射粒子-靶核系统的折合质量由 $\\mu$ 给出，其中 $m_N$ 是核子质量，$A$ 是靶核的质量数：\n$$\n\\mu = \\frac{m_N (A m_N)}{m_N + A m_N} = \\frac{A}{A+1} m_N\n$$\n质心能量 $E_{\\text{cm}}$ 与实验室能量 $E_{\\text{lab}}$ 的关系如下：\n$$\nE_{\\text{cm}} = E_{\\text{lab}} \\frac{A m_N}{m_N + A m_N} = E_{\\text{lab}} \\frac{A}{A+1}\n$$\n然后，使用相对论能量-动量关系（其中 $c=1$）计算在壳质心动量 $k$：\n$$\nk = \\frac{\\sqrt{2 \\mu E_{\\text{cm}}}}{\\hbar c}\n$$\n其中 $\\hbar c$ 是普朗克常数与光速的乘积。对于弹性散射，动量转移的大小 $q$ 取决于 $k$ 和质心散射角 $\\theta$：\n$$\nq = 2 k \\sin(\\theta/2)\n$$\n在一级玻恩近似中，散射振幅正比于势的傅里叶变换。对于指定的、具有高斯局域部分 $U_{\\text{L}}(r) = -V \\exp(-r^2/a^2)$ 和高斯非局域性核的非局域势，微分截面由下式给出：\n$$\n\\frac{d\\sigma}{d\\Omega} = \\left[ \\left( \\frac{2\\mu}{\\hbar^2} \\right) \\left( \\frac{1}{4\\pi} \\right) \\left( -V \\pi^{3/2} a^3 \\exp\\left(-\\frac{a^2 q^2}{4}\\right) \\right) \\exp\\left(-\\frac{\\beta^2 q^2}{4}\\right) \\right]^2\n$$\n其中在 $\\hbar^2 = (\\hbar c)^2$ 项中，因子 $c^2$ 被隐式地设为1。简化此表达式可得到模型方程：\n$$\n\\frac{d\\sigma}{d\\Omega}(q; \\beta,V) = C_0^2 V^2 \\exp\\left(-\\frac{(a^2+\\beta^2) q^2}{2}\\right)\n$$\n其中 $C_0 = \\left( \\frac{2\\mu}{(\\hbar c)^2} \\frac{\\pi^{3/2} a^3}{4\\pi} \\right)$ 是给定系统的一个常数。注意，要拟合的参数是 $\\beta$ 和 $V$，而 $a$保持不变。\n\n数值计算过程包括实现该模型，并将其用于加权非线性最小二乘拟合。首先，使用带有已知“真实”参数 $(\\beta_{\\text{true}}, V_{\\text{true}})$ 的模型，为一组能量-角度对 $\\{E_i, \\theta_i\\}$ 生成合成的“实验”数据 $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i}$。\n\n拟合过程旨在找到参数 $(\\hat{\\beta}, \\hat{V})$，以最小化加权残差平方和 $\\chi^2 = \\sum_i r_i^2$。每个数据点 $i$ 的残差定义为：\n$$\nr_i(\\beta, V) = \\frac{ \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i}(\\beta, V) - \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i} }{ \\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i} }\n$$\n其中 $\\epsilon$ 是一个恒定的相对不确定度。将使用 `scipy.optimize.least_squares` 函数执行此最小化过程，该函数非常适合此类问题。为增强优化的鲁棒性和效率，将向求解器提供残差向量 $\\mathbf{J}$ 相对于参数 $(\\beta, V)$ 的解析雅可比矩阵。雅可比矩阵的元素为：\n$$\nJ_{i, V} = \\frac{\\partial r_i}{\\partial V} = \\frac{1}{\\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i}} \\frac{\\partial}{\\partial V} \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i} = \\frac{1}{\\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i}} \\left[ \\frac{2}{V} \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i} \\right]\n$$\n$$\nJ_{i, \\beta} = \\frac{\\partial r_i}{\\partial \\beta} = \\frac{1}{\\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i}} \\frac{\\partial}{\\partial \\beta} \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i} = \\frac{1}{\\epsilon \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{data},i}} \\left[ (-\\beta q_i^2) \\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{model},i} \\right]\n$$\n在拟合收敛到最优参数 $(\\hat{\\beta}, \\hat{V})$ 后，使用线性化协方差矩阵 $\\mathbf{C}$ 来量化统计不确定度和相关性。该矩阵近似为矩阵 $\\mathbf{J}^\\top \\mathbf{J}$ 的逆，其中 $\\mathbf{J}$ 是在解处求值的残差的雅可比矩阵：\n$$\n\\mathbf{C} \\approx (\\mathbf{J}^\\top \\mathbf{J})^{-1} = \\begin{pmatrix} C_{\\beta\\beta}  C_{\\beta V} \\\\ C_{V\\beta}  C_{VV} \\end{pmatrix}\n$$\n如果矩阵 $\\mathbf{J}^\\top \\mathbf{J}$ 是奇异的或病态的（由一个大的条件数指示），则在求逆之前通过添加一个小的对角项 $\\lambda\\mathbf{I}$（Tikhonov正则化）对其进行正则化，以确保数值稳定性。从协方差矩阵可以得到参数的边缘标准差 $\\sigma_\\beta = \\sqrt{C_{\\beta\\beta}}$ 和 $\\sigma_V = \\sqrt{C_{VV}}$，以及它们的相关系数 $\\rho_{\\beta,V} = C_{\\beta V} / (\\sigma_\\beta \\sigma_V)$。\n\n该实现将处理四个不同的测试用例，每个用例具有不同的运动学条件（能量和角度范围），以研究这些条件如何影响对拟合参数的约束。最终输出将是一个格式化的列表，包含每个用例的拟合参数及其相应的不确定度和相关性。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Main function to run the computational model fitting for all test cases.\n    \"\"\"\n    # Physical constants and fixed parameters\n    HBAR_C = 197.3269804  # MeV*fm\n    M_N = 939.0           # MeV/c^2\n    A = 40.0              # Mass number of target (e.g., Calcium)\n    A_FIXED = 1.2         # fm, fixed local potential range\n    EPSILON = 0.05        # Relative measurement uncertainty\n\n    # Derived constants\n    MU = M_N * A / (1.0 + A)\n    E_CM_FACTOR = A / (1.0 + A)\n    \n    # Pre-calculated constant factor for cross section\n    # C0 = (2*mu / (hbar_c**2)) * (1/(4*pi)) * pi^(3/2) * a^3\n    C0_SQUARED = ( (2 * MU / (HBAR_C**2)) * (np.pi**1.5 * A_FIXED**3) / (4 * np.pi) )**2\n\n    # Test cases as defined in the problem\n    test_cases = [\n        # Case A: Happy path\n        {'name': 'A', 'E_lab': [30.0, 50.0], 'theta_deg': [20, 40, 60, 80, 100], \n         'beta_true': 0.9, 'V_true': 50.0},\n        # Case B: Low energy edge\n        {'name': 'B', 'E_lab': [5.0], 'theta_deg': [20, 40, 60, 80, 100, 120, 140, 160], \n         'beta_true': 0.9, 'V_true': 50.0},\n        # Case C: High energy, wide angles\n        {'name': 'C', 'E_lab': [100.0, 150.0], 'theta_deg': [20, 40, 60, 80, 100, 120, 140, 160], \n         'beta_true': 0.9, 'V_true': 50.0},\n        # Case D: Forward-angle boundary\n        {'name': 'D', 'E_lab': [50.0], 'theta_deg': [5, 10, 15], \n         'beta_true': 0.9, 'V_true': 50.0},\n    ]\n\n    initial_guess = [1.0, 60.0]  # [beta, V]\n    bounds = ([0.2, 1.0], [2.0, 200.0]) # ([beta_min, V_min], [beta_max, V_max])\n    regularization_lambda = 1e-8\n    condition_threshold = 1e12\n\n    def dsdo_model(params, E_lab_vals, theta_deg_vals):\n        \"\"\"\n        Calculates the differential cross section using the Perey-Buck model.\n        \n        Args:\n            params (list or tuple): [beta, V].\n            E_lab_vals (np.ndarray): Array of laboratory energies in MeV.\n            theta_deg_vals (np.ndarray): Array of scattering angles in degrees.\n            \n        Returns:\n            np.ndarray: Array of differential cross sections in fm^2/sr.\n        \"\"\"\n        beta, V = params\n        E_cm = E_lab_vals * E_CM_FACTOR\n        k = np.sqrt(2 * MU * E_cm) / HBAR_C\n        theta_rad = np.deg2rad(theta_deg_vals)\n        q = 2 * k * np.sin(theta_rad / 2)\n        \n        exponent = - (A_FIXED**2 + beta**2) * q**2 / 2.0\n        \n        return C0_SQUARED * V**2 * np.exp(exponent)\n\n    all_results = []\n    for case in test_cases:\n        # Create grid of (E_lab, theta) pairs for the current case\n        E_grid, theta_grid = np.meshgrid(case['E_lab'], case['theta_deg'])\n        E_lab_data = E_grid.flatten()\n        theta_data = theta_grid.flatten()\n\n        # Generate synthetic data\n        true_params = [case['beta_true'], case['V_true']]\n        dsdo_data = dsdo_model(true_params, E_lab_data, theta_data)\n\n        def residuals(params, E_lab, theta, data):\n            model_vals = dsdo_model(params, E_lab, theta)\n            # Since data is ideal, avoid division by zero if dsdo is zero\n            # (though with this model it won't be).\n            # The denominator epsilon * data is the 'sigma' for each point\n            res = (model_vals - data) / (EPSILON * data)\n            return res\n\n        def jacobian(params, E_lab, theta, data):\n            beta, V = params\n            model_vals = dsdo_model(params, E_lab, theta)\n\n            # Calculate q^2 for the derivative w.r.t. beta\n            E_cm = E_lab * E_CM_FACTOR\n            k = np.sqrt(2 * MU * E_cm) / HBAR_C\n            theta_rad = np.deg2rad(theta)\n            q_squared = (2 * k * np.sin(theta_rad / 2))**2\n\n            # Partial derivative of model w.r.t V\n            d_model_dV = (2.0 / V) * model_vals\n            # Partial derivative of model w.r.t beta\n            d_model_dbeta = -beta * q_squared * model_vals\n\n            # Partial derivatives of the residuals\n            dr_dV = d_model_dV / (EPSILON * data)\n            dr_dbeta = d_model_dbeta / (EPSILON * data)\n\n            return np.vstack((dr_dbeta, dr_dV)).T\n\n        # Perform the least-squares fit\n        fit_result = least_squares(\n            residuals,\n            initial_guess,\n            jac=jacobian,\n            bounds=bounds,\n            args=(E_lab_data, theta_data, dsdo_data),\n            method='trf'\n        )\n        \n        beta_hat, V_hat = fit_result.x\n        \n        # Calculate covariance matrix\n        J = fit_result.jac\n        JtJ = J.T @ J\n        \n        if np.linalg.cond(JtJ) > condition_threshold:\n            JtJ += regularization_lambda * np.eye(JtJ.shape[0])\n\n        try:\n            cov_matrix = np.linalg.inv(JtJ)\n            var_beta = cov_matrix[0, 0]\n            var_V = cov_matrix[1, 1]\n            \n            # Watch for negative variance due to numerical issues\n            sigma_beta = np.sqrt(var_beta) if var_beta > 0 else 0.0\n            sigma_V = np.sqrt(var_V) if var_V > 0 else 0.0\n            \n            if sigma_beta > 0 and sigma_V > 0:\n                rho_beta_V = cov_matrix[0, 1] / (sigma_beta * sigma_V)\n            else:\n                rho_beta_V = 0.0\n        except np.linalg.LinAlgError:\n            sigma_beta, sigma_V, rho_beta_V = [np.inf, np.inf, np.nan]\n\n        all_results.extend([beta_hat, V_hat, sigma_beta, sigma_V, rho_beta_V])\n\n    # Format final output\n    formatted_results = [f\"{val:.6f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}