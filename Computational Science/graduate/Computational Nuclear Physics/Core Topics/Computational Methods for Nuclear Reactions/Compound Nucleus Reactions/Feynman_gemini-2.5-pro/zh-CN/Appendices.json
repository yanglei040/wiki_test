{
    "hands_on_practices": [
        {
            "introduction": "第一个实践练习的核心是直接应用Hauser-Feshbach公式，这是计算复合核反应的基石。该练习要求您将形成复合核的概率与其各种衰变道的概率结合起来，同时严格遵守角动量和宇称守恒。通过完成这个练习 ，您将掌握在统计模型框架内确定反应截面的基本计算技能。",
            "id": "3551257",
            "problem": "您的任务是推导并实现铁上的中子诱发质子发射反应的复合核反应截面计算，具体为入射中子能量 $E_n = 1\\,\\mathrm{MeV}$ 时的 $n + {}^{56}\\mathrm{Fe} \\to p + {}^{56}\\mathrm{Mn}$ 道。该计算必须基于复合核（Hauser-Feshbach）框架，并运用基本原理：角动量和宇称守恒、由自旋简并度加权的复合核统计形成概率，以及通过透射系数表示的平均分支比。问题陈述中不得使用任何预先推导的公式；相反，您必须从这些原理出发，并在解法中推导出必要的表达式。\n\n已知的物理输入：\n- 靶核为处于基态的 ${}^{56}\\mathrm{Fe}$，其自旋宇称为 $I^\\pi = 0^+$。\n- 入射中子的自旋为 $s_n = \\tfrac{1}{2}$。\n- 入射中子的实验室能量为 $E_n = 1\\,\\mathrm{MeV}$。\n- 使用通过折合质量和质心能量计算的非相对论波数：\n  - 中子质量为 $m_n = 939.5654133\\,\\mathrm{MeV}/c^2$。\n  - ${}^{56}\\mathrm{Fe}$ 的原子质量为 $m_{\\mathrm{Fe}} = 55.9349375\\,\\mathrm{u}$，且 $1\\,\\mathrm{u} = 931.49410242\\,\\mathrm{MeV}/c^2$。\n  - 折合质量为 $\\mu = \\dfrac{m_n m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}}$。\n  - 质心能量为 $E_{\\mathrm{cm}} = E_n \\dfrac{m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}}$。\n  - 使用 $\\hbar c = 197.3269804\\,\\mathrm{MeV}\\,\\mathrm{fm}$ 来获得以 $\\mathrm{fm}^{-1}$ 为单位的波数 $k = \\sqrt{2 \\mu E_{\\mathrm{cm}}}/(\\hbar c)$。\n- 反应截面必须以靶恩（barn）为单位表示；回顾 $1\\,\\mathrm{barn} = 100\\,\\mathrm{fm}^2$。\n\n核反应模型输入：\n- 对于每个由总自旋 $J$ 和宇称 $\\pi$ 标记的可及复合核态，给定在指定 $E_n$ 对应的复合激发能下，各道 $c \\in \\{n, p, \\alpha, \\gamma\\}$ 的无量纲透射系数 $T_c^{J\\pi}$。\n- 这些透射系数代表与各道的平均耦合概率，并且必须与适当的自旋统计权重以及从 $T_c^{J\\pi}$ 推导出的平均分支比相结合。\n- 您必须包含基于 $s_n$ 和 $I$ 的正确入射道自旋统计因子，并对所有提供的 $J^\\pi$ 求和。\n- 假设不存在宽度涨落修正（即，使用平均统计处理，不含额外的相关因子），并假设列表中的 $T_c^{J\\pi}$ 已包含了入射道中任何相关的轨道角动量平均。\n\n测试套件：\n实现您的程序，为以下四组参数集计算 $(n,p)$ 截面 $\\sigma_{n,p}$。在每组参数中，提供了一个复合核态 $(J^\\pi)$ 列表，以及相应的道透射系数 $T_n^{J\\pi}$、$T_p^{J\\pi}$、$T_\\alpha^{J\\pi}$ 和 $T_\\gamma^{J\\pi}$。所有 $T$ 值都是无量纲的。\n\n- 测试用例 1（多个有贡献的 $J^\\pi$，质子透射系数小但开放）：\n  - $J^\\pi = \\tfrac{1}{2}^+$: $T_n = 0.90$, $T_p = 0.002$, $T_\\alpha = 1\\times 10^{-5}$, $T_\\gamma = 0.05$。\n  - $J^\\pi = \\tfrac{3}{2}^+$: $T_n = 0.80$, $T_p = 0.003$, $T_\\alpha = 2\\times 10^{-5}$, $T_\\gamma = 0.06$。\n  - $J^\\pi = \\tfrac{5}{2}^-$: $T_n = 0.10$, $T_p = 0.0005$, $T_\\alpha = 1\\times 10^{-6}$, $T_\\gamma = 0.02$。\n- 测试用例 2（在此能量下质子道有效关闭）：\n  - $J^\\pi = \\tfrac{1}{2}^+$: $T_n = 0.85$, $T_p = 0.0$, $T_\\alpha = 1\\times 10^{-5}$, $T_\\gamma = 0.04$。\n  - $J^\\pi = \\tfrac{3}{2}^-$: $T_n = 0.60$, $T_p = 0.0$, $T_\\alpha = 1\\times 10^{-5}$, $T_\\gamma = 0.03$。\n- 测试用例 3（混合宇称集，其中一个不可及的入射分量由 $T_n = 0$ 反映）：\n  - $J^\\pi = \\tfrac{1}{2}^-$: $T_n = 0.50$, $T_p = 0.002$, $T_\\alpha = 5\\times 10^{-6}$, $T_\\gamma = 0.10$。\n  - $J^\\pi = \\tfrac{3}{2}^+$: $T_n = 0.0$, $T_p = 0.004$, $T_\\alpha = 1\\times 10^{-5}$, $T_\\gamma = 0.08$。\n  - $J^\\pi = \\tfrac{5}{2}^+$: $T_n = 0.20$, $T_p = 0.0002$, $T_\\alpha = 1\\times 10^{-5}$, $T_\\gamma = 0.05$。\n- 测试用例 4（透射系数非常小的边缘情况）：\n  - $J^\\pi = \\tfrac{1}{2}^+$: $T_n = 0.01$, $T_p = 1\\times 10^{-6}$, $T_\\alpha = 1\\times 10^{-7}$, $T_\\gamma = 0.001$。\n  - $J^\\pi = \\tfrac{3}{2}^-$: $T_n = 0.02$, $T_p = 2\\times 10^{-6}$, $T_\\alpha = 1\\times 10^{-7}$, $T_\\gamma = 0.0015$。\n\n编程与输出要求：\n- 根据所述原理推导截面表达式并实现它。\n- 使用给定的物理常数和定义来计算入射道波数 $k$ 和几何前置因子。\n- 对于每个测试用例，计算以靶恩为单位的 $(n,p)$ 截面 $\\sigma_{n,p}$。\n- 您的程序应生成单行输出，包含四个结果，格式为方括号内的逗号分隔列表，每个值四舍五入到六位小数，例如 $\\texttt{[x_1,x_2,x_3,x_4]}$。",
            "solution": "该问题要求使用 Hauser-Feshbach 统计模型推导并实现反应 $n + {}^{56}\\mathrm{Fe} \\to p + {}^{56}\\mathrm{Mn}$ 的复合核反应截面。如题目要求，推导必须源于量子力学和统计物理学的基本原理。\n\n### Hauser-Feshbach 公式的推导\n\n从入射道 $n$ 经过复合核到出射道 $p$ 的反应的角积分截面 $\\sigma_{n,p}$ 的计算，遵循 Bohr 独立性假说提出的两步过程。\n1.  由靶核 ${}^{56}\\mathrm{Fe}$ 和入射中子 $n$ 形成复合核 ($^{57}\\mathrm{Fe}^*$)。\n2.  复合核衰变到出射道，该道由剩余核 ${}^{56}\\mathrm{Mn}$ 和发射的质子 $p$ 组成。\n\n截面是通过对所有可能的复合核中间态的贡献求和来计算的，这些中间态由总角动量 $J$ 和宇称 $\\pi$ 表征。总截面由下式给出：\n$$\n\\sigma_{n,p} = \\sum_{J,\\pi} \\sigma_{\\mathrm{CN}}(J^\\pi) \\cdot P_{p}(J^\\pi)\n$$\n其中 $\\sigma_{\\mathrm{CN}}(J^\\pi)$ 是形成自旋宇称为 $J^\\pi$ 的复合核态的截面，而 $P_{p}(J^\\pi)$ 是该态衰变到质子道的分支比（或概率）。\n\n**1. 复合核形成截面**\n从入射道（中子 + ${}^{56}\\mathrm{Fe}$）形成复合核态 $J^\\pi$ 的截面由分波反应截面给出。对于非极化束和靶，它表示为：\n$$\n\\sigma_{\\mathrm{CN}}(J^\\pi) = \\frac{\\pi}{k^2} g_J T_n^{J\\pi}\n$$\n这里，$k$ 是入射道质心系中相对运动的波数。$\\pi/k^2$ 项是 s 波反应截面的几何极限。\n\n$g_J$ 项是自旋统计因子，表示入射粒子自旋 $s_n$、靶核自旋 $I$ 以及它们的相对轨道角动量耦合到总角动量 $J$ 的概率。它由下式给出：\n$$\ng_J = \\frac{2J+1}{(2s_n+1)(2I+1)}\n$$\n对于本问题，靶核是基态自旋为 $I=0$ 的 ${}^{56}\\mathrm{Fe}$，入射粒子是自旋为 $s_n = \\tfrac{1}{2}$ 的中子。因此，自旋统计因子的分母为 $(2 \\cdot \\tfrac{1}{2} + 1)(2 \\cdot 0 + 1) = 2$。\n\n量 $T_n^{J\\pi}$ 是入射中子道的透射系数。它表示一个具有形成 $J^\\pi$ 态所需的正确角动量和宇称的中子到达核表面后，被吸收形成复合核的概率。问题陈述中说明这些系数是已知的，并且已经对有贡献的轨道角动量进行了平均。\n\n波数 $k$ 按非相对论方式计算：\n$$\nk = \\frac{\\sqrt{2\\mu E_{\\mathrm{cm}}}}{\\hbar}\n$$\n其中 $\\mu$ 是 $n$-${}^{56}\\mathrm{Fe}$ 体系的折合质量，$E_{\\mathrm{cm}}$ 是质心能量，$\\hbar$ 是约化普朗克常数。问题提供了 $\\hbar c$，所以我们使用等效形式 $k = \\sqrt{2\\mu E_{\\mathrm{cm}}}/(\\hbar c)$。必要的质量和能量为：\n- 折合质量：$\\mu = \\dfrac{m_n m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}}$\n- 质心能量：$E_{\\mathrm{cm}} = E_n \\dfrac{m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}}$，其中 $E_n = 1\\,\\mathrm{MeV}$。\n\n**2. 复合核衰变概率（分支比）**\n一旦形成，复合核态 $J^\\pi$ 可以衰变到任何能量上可及的道 $c$（例如，$n, p, \\alpha, \\gamma$）。统计模型假设衰变与形成过程无关。衰变到特定道 $p$ 的概率由该道的分衰变宽度 $\\Gamma_p^{J\\pi}$ 与总衰变宽度 $\\Gamma_{\\mathrm{tot}}^{J\\pi}$（即所有分衰变宽度之和）的比值给出：\n$$\nP_p(J^\\pi) = \\frac{\\Gamma_p^{J\\pi}}{\\Gamma_{\\mathrm{tot}}^{J\\pi}} = \\frac{\\Gamma_p^{J\\pi}}{\\sum_c \\Gamma_c^{J\\pi}}\n$$\n统计模型的一个基本原则是，平均分宽度 $\\langle\\Gamma_c^{J\\pi}\\rangle$ 与该道的透射系数 $T_c^{J\\pi}$ 成正比。由于我们处理的是平均截面（无宽度涨落修正），我们可以用透射系数代替宽度：\n$$\nP_p(J^\\pi) \\approx \\frac{T_p^{J\\pi}}{\\sum_c T_c^{J\\pi}}\n$$\n问题指定了四个衰变道：弹性/非弹性中子散射 ($n$)、质子发射 ($p$)、alpha 发射 ($\\alpha$) 和 gamma 衰变 ($\\gamma$)。因此，总透射系数为 $T_{\\mathrm{tot}}^{J\\pi} = T_n^{J\\pi} + T_p^{J\\pi} + T_\\alpha^{J\\pi} + T_\\gamma^{J\\pi}$。衰变到质子道的分支比变为：\n$$\nP_p(J^\\pi) = \\frac{T_p^{J\\pi}}{T_{\\mathrm{tot}}^{J\\pi}}\n$$\n\n**3. 总 (n,p) 截面**\n结合形成和衰变的表达式，并对所有有贡献的态 $J^\\pi$ 求和：\n$$\n\\sigma_{n,p} = \\sum_{J,\\pi} \\left[ \\frac{\\pi}{k^2} \\frac{2J+1}{(2s_n+1)(2I+1)} T_n^{J\\pi} \\right] \\left[ \\frac{T_p^{J\\pi}}{T_n^{J\\pi} + T_p^{J\\pi} + T_\\alpha^{J\\pi} + T_\\gamma^{J\\pi}} \\right]\n$$\n将不依赖于求和指标 $(J,\\pi)$ 的项提取出来，我们得到截面的最终表达式：\n$$\n\\sigma_{n,p} = \\frac{\\pi}{k^2} \\frac{1}{(2s_n+1)(2I+1)} \\sum_{J,\\pi} (2J+1) \\frac{T_n^{J\\pi} T_p^{J\\pi}}{\\sum_c T_c^{J\\pi}}\n$$\n\n### 实现\n算法首先计算常数前置因子，然后对每个测试用例，将每个指定的复合核态的贡献求和。\n\n**常数和前置因子计算：**\n使用提供的物理常数：\n- $m_n = 939.5654133\\,\\mathrm{MeV}/c^2$\n- $m_{\\mathrm{Fe}} = 55.9349375\\,\\mathrm{u} \\times 931.49410242\\,\\mathrm{MeV}/c^2/\\mathrm{u} \\approx 52101.4081\\,\\mathrm{MeV}/c^2$\n- $E_n = 1\\,\\mathrm{MeV}$\n- $\\hbar c = 197.3269804\\,\\mathrm{MeV}\\,\\mathrm{fm}$\n- $s_n = \\tfrac{1}{2}$, $I=0$\n\n推导出的量为：\n- $\\mu = \\dfrac{m_n m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}} \\approx 922.9550\\,\\mathrm{MeV}/c^2$\n- $E_{\\mathrm{cm}} = E_n \\dfrac{m_{\\mathrm{Fe}}}{m_n + m_{\\mathrm{Fe}}} \\approx 0.982286\\,\\mathrm{MeV}$\n- $k^2 = \\dfrac{2 \\mu E_{\\mathrm{cm}}}{(\\hbar c)^2} \\approx \\dfrac{2 \\cdot 922.9550 \\cdot 0.982286}{(197.3269804)^2} \\approx 0.0465696\\,\\mathrm{fm}^{-2}$\n- 自旋因子分母：$(2s_n+1)(2I+1) = 2$\n\n截面的总前置因子为：\n$$\n\\text{Prefactor} = \\frac{\\pi}{k^2} \\frac{1}{2} \\approx \\frac{\\pi}{0.0465696} \\frac{1}{2} \\approx 33.7441\\,\\mathrm{fm}^2\n$$\n为了以靶恩（barn）表示最终结果，我们使用转换关系 $1\\,\\mathrm{barn} = 100\\,\\mathrm{fm}^2$。\n$$\n\\text{Prefactor (barns)} = 33.7441\\,\\mathrm{fm}^2 \\times \\frac{1\\,\\mathrm{barn}}{100\\,\\mathrm{fm}^2} \\approx 0.337441\\,\\mathrm{barns}\n$$\n\n**测试用例的计算：**\n对于每个测试用例，我们计算总和：\n$$\nS = \\sum_{J,\\pi} (2J+1) \\frac{T_n^{J\\pi} T_p^{J\\pi}}{T_{\\mathrm{tot}}^{J\\pi}}\n$$\n该用例的最终截面为 $\\sigma_{n,p} = \\text{Prefactor (barns)} \\times S$。提供的 Python 代码精确地实现了这一逻辑，计算前置因子，然后遍历测试用例来计算并格式化结果。请注意，如果 $T_n^{J\\pi}$ 或 $T_p^{J\\pi}$ 为零，或者如果某个态通过入射道不可及（如 $T_n^{J\\pi} = 0$ 所示），其对总和的贡献为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the compound-nucleus reaction cross section for\n    n + 56-Fe -> p + 56-Mn at E_n = 1 MeV using the Hauser-Feshbach framework.\n    \"\"\"\n    \n    # --- Part 1: Define physical constants and calculate prefactor ---\n    \n    # Known physical inputs from the problem statement\n    M_N_MEV = 939.5654133      # Neutron mass in MeV/c^2\n    M_FE_U = 55.9349375       # 56Fe mass in atomic mass units (u)\n    U_TO_MEV = 931.49410242    # Conversion factor from u to MeV/c^2\n    HBARC_MEV_FM = 197.3269804 # h-bar * c in MeV*fm\n    BARN_TO_FM2 = 100.0         # 1 barn = 100 fm^2\n    \n    E_N_LAB_MEV = 1.0           # Incident neutron laboratory energy in MeV\n    S_N = 0.5                   # Neutron spin\n    I_TGT = 0.0                 # Target 56Fe spin\n\n    # Calculate derived quantities for the prefactor\n    m_fe_mev = M_FE_U * U_TO_MEV\n    \n    # Reduced mass of the n-56Fe system in MeV/c^2\n    mu_mev = (M_N_MEV * m_fe_mev) / (M_N_MEV + m_fe_mev)\n    \n    # Center-of-mass energy in MeV\n    e_cm_mev = E_N_LAB_MEV * m_fe_mev / (M_N_MEV + m_fe_mev)\n    \n    # Square of the wave number in the entrance channel, in fm^-2\n    k_squared_fm_inv2 = (2 * mu_mev * e_cm_mev) / (HBARC_MEV_FM ** 2)\n    \n    # Spin statistical factor denominator: (2*s_n + 1) * (2*I + 1)\n    spin_stat_denom = (2 * S_N + 1) * (2 * I_TGT + 1)\n    \n    # Overall prefactor for the cross section formula, converted to barns.\n    # The formula is sigma = (pi/k^2) * (1/spin_stat_denom) * sum(...)\n    prefactor_barns = (np.pi / k_squared_fm_inv2) / spin_stat_denom / BARN_TO_FM2\n\n    # --- Part 2: Define test cases ---\n    # Each test case is a list of dictionaries, where each dictionary\n    # represents a compound nucleus state (J^pi) and its transmission coefficients.\n    test_cases = [\n        # Test case 1\n        [\n            {'J': 0.5, 'Tn': 0.90, 'Tp': 0.002, 'Ta': 1e-5, 'Tg': 0.05},\n            {'J': 1.5, 'Tn': 0.80, 'Tp': 0.003, 'Ta': 2e-5, 'Tg': 0.06},\n            {'J': 2.5, 'Tn': 0.10, 'Tp': 0.0005, 'Ta': 1e-6, 'Tg': 0.02},\n        ],\n        # Test case 2\n        [\n            {'J': 0.5, 'Tn': 0.85, 'Tp': 0.0, 'Ta': 1e-5, 'Tg': 0.04},\n            {'J': 1.5, 'Tn': 0.60, 'Tp': 0.0, 'Ta': 1e-5, 'Tg': 0.03},\n        ],\n        # Test case 3\n        [\n            {'J': 0.5, 'Tn': 0.50, 'Tp': 0.002, 'Ta': 5e-6, 'Tg': 0.10},\n            {'J': 1.5, 'Tn': 0.0, 'Tp': 0.004, 'Ta': 1e-5, 'Tg': 0.08},\n            {'J': 2.5, 'Tn': 0.20, 'Tp': 0.0002, 'Ta': 1e-5, 'Tg': 0.05},\n        ],\n        # Test case 4\n        [\n            {'J': 0.5, 'Tn': 0.01, 'Tp': 1e-6, 'Ta': 1e-7, 'Tg': 0.001},\n            {'J': 1.5, 'Tn': 0.02, 'Tp': 2e-6, 'Ta': 1e-7, 'Tg': 0.0015},\n        ]\n    ]\n\n    results = []\n    # --- Part 3: Calculate the cross section for each test case ---\n    for case_states in test_cases:\n        sum_term = 0.0\n        for state in case_states:\n            J = state['J']\n            Tn = state['Tn']\n            Tp = state['Tp']\n            Ta = state['Ta']\n            Tg = state['Tg']\n            \n            T_total = Tn + Tp + Ta + Tg\n            \n            # The contribution is non-zero only if Tn > 0, Tp > 0, and T_total > 0.\n            # We check T_total > 0 to avoid division by zero in the unlikely event\n            # that all transmission coefficients are zero.\n            if T_total > 0:\n                # This is the term inside the sum: (2J+1) * (Tn * Tp) / T_total\n                sum_term += (2 * J + 1) * (Tn * Tp) / T_total\n        \n        # Final cross section in barns is the prefactor times the summed term.\n        cross_section_barns = prefactor_barns * sum_term\n        results.append(f\"{cross_section_barns:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在学习了如何实现完整的Hauser-Feshbach理论之后，一个富有启发性的步骤是将其与一个更简单的近似模型进行比较，以理解其关键的物理基础。这个实践练习将角动量依赖的Hauser-Feshbach模型与更简单的Weisskopf-Ewing模型的结果进行对比，后者在衰变过程中对自旋和宇称 ($J^\\pi$) 的依赖性进行了平均。通过量化Weisskopf-Ewing近似所引入的误差，尤其是在具有强自旋选择性的情况下，这个练习  突显了为什么显式考虑角动量守恒是Hauser-Feshbach理论的一个关键特征。",
            "id": "3551261",
            "problem": "构建一个程序，该程序针对一组指定的复合核形成与衰变参数，为单个出射道计算两个反应截面：一个完全遵循总角动量和宇称（记作 $J^\\pi$）依赖关系，另一个则本着魏斯科普夫-尤因（Weisskopf-Ewing）假设的精神移除了这种依赖关系。目的是量化在表现出强自旋选择性的反应中，因忽略 $J^\\pi$ 依赖性而产生的误差。程序必须为每个测试用例计算相对误差，定义为 $(\\sigma_{\\mathrm{WE}} - \\sigma_{\\mathrm{HF}})/\\sigma_{\\mathrm{HF}}$，并以保留六位小数的十进制数表示。\n\n推导和实现中必须使用的基本依据包括以下广为接受的原则和定义：\n- 复合核反应中角动量和宇称守恒，这意味着入射和出射过程通过标记有 $J$ 和 $\\pi$ 的复合态进行。\n- 复合核衰变的统计性质，通过将每个衰变道视为微观相互作用和可用相空间的函数——即透射系数——来处理。\n- 质心系中波数 $k$ 的定义，由 $k = \\sqrt{2 \\mu E}/(\\hbar c)$ 给出，其中 $E$ 是质心能量，$\\mu$ 是约化质量，$\\hbar c$ 是一个常数。\n- 考虑初始自旋取向数量的自旋统计因子，基于入射粒子自旋 $s_a$ 和靶核自旋 $I_A$。\n\n程序必须实现两种模型：\n- 具有 $J^\\pi$ 依赖性的模型在计算所选出射道的截面时，使用形成和衰变对 $J$ 和 $\\pi$ 的完全依赖关系。\n- 魏斯科普夫-尤因型模型通过使用与 $J^\\pi$ 无关的平均发射概率来移除分支概率中的 $J^\\pi$ 依赖性，同时保留正确的形成截面。\n\n您必须遵守以下算法和数值要求：\n1. 对于每个测试用例，使用入射粒子质量 $m_a$ 和靶核质量 $m_A$ 计算约化质量 $\\mu$，然后计算波数 $k$。使用 $\\hbar c = 197.3269804\\,\\mathrm{MeV\\cdot fm}$。质量以 $\\mathrm{MeV}/c^2$ 为单位，能量以 $\\mathrm{MeV}$ 为单位。将 $c=1$ 处理。\n2. 使用适合入射构型的自旋统计因子，该因子由入射粒子自旋 $s_a$ 和靶核自旋 $I_A$ 构成。\n3. 在具有 $J^\\pi$ 依赖性的模型中，对所提供的 $J^\\pi$ 态进行聚合，每个态都具有入射透射系数 $T_a^{J\\pi}$、出射道透射系数 $T_b^{J\\pi}$ 和竞争道透射系数 $T_{\\mathrm{rest}}^{J\\pi}$。总衰变透射系数为 $T_{\\mathrm{tot}}^{J\\pi} = T_b^{J\\pi} + T_{\\mathrm{rest}}^{J\\pi}$。只有指定的 $J^\\pi$ 态有贡献，这与自旋选择性一致。\n4. 在魏斯科普夫-尤因型模型中，根据提供的 $J^\\pi$ 透射系数构建一个与 $J^\\pi$ 无关的出射道分支概率，然后将其乘以正确计算的形成截面。\n5. 在最终截面中，将面积单位从 $\\mathrm{fm}^2$ 转换为靶（barns），使用 $1\\,\\mathrm{barn} = 100\\,\\mathrm{fm}^2$。\n6. 对于每个测试用例，计算相对误差 $(\\sigma_{\\mathrm{WE}} - \\sigma_{\\mathrm{HF}})/\\sigma_{\\mathrm{HF}}$ 并四舍五入到六位小数。\n\n物理单位：内部以靶（barns）报告截面，最终仅输出无单位的相对误差，表示为四舍五入到六位小数的十进制数。\n\n角度单位：不适用。\n\n百分比：相对误差必须表示为十进制数，而非百分比。\n\n测试套件和参数：\n- 所有用例的通用常数：$\\hbar c = 197.3269804\\,\\mathrm{MeV\\cdot fm}$；入射粒子为中子，其 $s_a = \\tfrac{1}{2}$，$m_a = 939.565\\,\\mathrm{MeV}/c^2$；靶核宇称 $\\pi_A = +1$。靶核质量由 $m_A = A \\times 931.494\\,\\mathrm{MeV}/c^2$ 给出，其中 $A=59$。\n- 对于每个用例，指定靶核自旋 $I_A$、质心能量 $E$ 以及有贡献的 $(J,\\pi)$ 态及其透射系数 $(T_a^{J\\pi}, T_b^{J\\pi}, T_{\\mathrm{rest}}^{J\\pi})$ 的列表。所有透射系数都是无量纲的，且介于 0 和 1 之间。\n\n测试用例：\n1. 一般强选择性情况：\n   - $I_A = \\tfrac{7}{2}$，$E = 2.0\\,\\mathrm{MeV}$。\n   - 态：\n     - $(J=\\tfrac{7}{2}, \\pi=+1): T_a^{J\\pi}=0.6, T_b^{J\\pi}=0.3, T_{\\mathrm{rest}}^{J\\pi}=0.5$。\n     - $(J=\\tfrac{9}{2}, \\pi=+1): T_a^{J\\pi}=0.9, T_b^{J\\pi}=0.05, T_{\\mathrm{rest}}^{J\\pi}=0.7$。\n     - $(J=\\tfrac{11}{2}, \\pi=+1): T_a^{J\\pi}=0.2, T_b^{J\\pi}=0.4, T_{\\mathrm{rest}}^{J\\pi}=0.3$。\n2. 极端单-$J$ 选择性情况：\n   - $I_A = \\tfrac{7}{2}$，$E = 1.0\\,\\mathrm{MeV}$。\n   - 态：\n     - $(J=\\tfrac{7}{2}, \\pi=+1): T_a^{J\\pi}=0.95, T_b^{J\\pi}=0.02, T_{\\mathrm{rest}}^{J\\pi}=0.90$。\n     - $(J=\\tfrac{9}{2}, \\pi=+1): T_a^{J\\pi}=0.0, T_b^{J\\pi}=0.40, T_{\\mathrm{rest}}^{J\\pi}=0.20$。\n     - $(J=\\tfrac{11}{2}, \\pi=+1): T_a^{J\\pi}=0.0, T_b^{J\\pi}=0.10, T_{\\mathrm{rest}}^{J\\pi}=0.40$。\n3. 弱选择性（均匀入射）情况：\n   - $I_A = \\tfrac{7}{2}$，$E = 3.0\\,\\mathrm{MeV}$。\n   - 态（负宇称主导）：\n     - $(J=\\tfrac{7}{2}, \\pi=-1): T_a^{J\\pi}=0.5, T_b^{J\\pi}=0.25, T_{\\mathrm{rest}}^{J\\pi}=0.25$。\n     - $(J=\\tfrac{9}{2}, \\pi=-1): T_a^{J\\pi}=0.5, T_b^{J\\pi}=0.25, T_{\\mathrm{rest}}^{J\\pi}=0.25$。\n     - $(J=\\tfrac{11}{2}, \\pi=-1): T_a^{J\\pi}=0.5, T_b^{J\\pi}=0.25, T_{\\mathrm{rest}}^{J\\pi}=0.25$。\n4. 宇称过滤入射情况：\n   - $I_A = \\tfrac{7}{2}$，$E = 2.0\\,\\mathrm{MeV}$。\n   - 态（仅形成负宇称）：\n     - $(J=\\tfrac{7}{2}, \\pi=+1): T_a^{J\\pi}=0.0, T_b^{J\\pi}=0.30, T_{\\mathrm{rest}}^{J\\pi}=0.40$。\n     - $(J=\\tfrac{9}{2}, \\pi=-1): T_a^{J\\pi}=0.8, T_b^{J\\pi}=0.10, T_{\\mathrm{rest}}^{J\\pi}=0.60$。\n     - $(J=\\tfrac{11}{2}, \\pi=-1): T_a^{J\\pi}=0.6, T_b^{J\\pi}=0.20, T_{\\mathrm{rest}}^{J\\pi}=0.50$。\n5. 竞争道主导情况：\n   - $I_A = \\tfrac{7}{2}$，$E = 4.0\\,\\mathrm{MeV}$。\n   - 态：\n     - $(J=\\tfrac{7}{2}, \\pi=+1): T_a^{J\\pi}=0.7, T_b^{J\\pi}=0.01, T_{\\mathrm{rest}}^{J\\pi}=0.90$。\n     - $(J=\\tfrac{9}{2}, \\pi=+1): T_a^{J\\pi}=0.4, T_b^{J\\pi}=0.05, T_{\\mathrm{rest}}^{J\\pi}=0.95$。\n     - $(J=\\tfrac{11}{2}, \\pi=+1): T_a^{J\\pi}=0.3, T_b^{J\\pi}=0.02, T_{\\mathrm{rest}}^{J\\pi}=0.98$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，`[r1,r2,r3,r4,r5]`），其中每个条目是相应测试用例的相对误差，按上述要求四舍五入到六位小数。",
            "solution": "该问题已经过仔细验证，被确定为科学上合理、问题明确且完整。所有提供的参数在物理上都是合理的，并且理论框架是核反应理论中的标准框架。因此，该问题被视为**有效**。\n\n这个问题的核心是比较计算复合核反应 $A(a, b)B$ 截面的两种模型。第一个模型是完整的豪瑟-费施巴赫（Hauser-Feshbach, HF）形式体系，它在反应的每一步都遵循总角动量 $J$ 和宇称 $\\pi$ 的守恒。第二个是简化的魏斯科普夫-尤因（Weisskopf-Ewing, WE）类型模型，它对衰变性质进行平均，从而打破了给定 $J^\\pi$ 的形成道和衰变道之间的严格关联。\n\n首先，我们定义两种模型共有的量。反应在质心系中进行考察。入射道（入射粒子 $a$ 轰击靶核 $A$）的约化质量 $\\mu$ 由下式给出：\n$$ \\mu = \\frac{m_a m_A}{m_a + m_A} $$\n其中 $m_a$ 和 $m_A$ 分别是入射粒子和靶核的质量。质心波数 $k$ 则为：\n$$ k = \\frac{\\sqrt{2 \\mu E}}{\\hbar c} $$\n其中 $E$ 是质心能量，$\\hbar c$ 是普朗克常数与光速的乘积。\n\n从具有入射粒子自旋 $s_a$ 和靶核自旋 $I_A$ 的初始道形成具有特定量子数 $(J, \\pi)$ 的复合核的截面由下式给出：\n$$ \\sigma_{CN}^{J\\pi} = \\frac{\\pi}{k^2} \\frac{2J+1}{(2s_a+1)(2I_A+1)} T_a^{J\\pi} $$\n此处，$T_a^{J\\pi}$ 是通向复合态 $(J, \\pi)$ 的入射道‘a’的透射系数。项 $\\frac{2J+1}{(2s_a+1)(2I_A+1)}$ 是自旋统计因子。\n\n**1. 豪瑟-费施巴赫（$J^\\pi$-依赖）模型 ($\\sigma_{\\mathrm{HF}}$)**\n\n豪瑟-费施巴赫理论假定反应分两个独立的步骤进行：复合核的形成及其随后的衰变。然而，衰变概率特定于衰变态的 $(J, \\pi)$。反应进入特定出射道‘b’的截面是形成截面乘以该衰变的分支比：\n$$ \\sigma_{ab}^{J\\pi} = \\sigma_{CN}^{J\\pi} \\times P_b^{J\\pi} $$\n分支比 $P_b^{J\\pi}$ 是出射道 $b$ 的透射系数 $T_b^{J\\pi}$ 与所有可能衰变道的透射系数之和的比值：\n$$ P_b^{J\\pi} = \\frac{T_b^{J\\pi}}{\\sum_c T_c^{J\\pi}} = \\frac{T_b^{J\\pi}}{T_{\\mathrm{tot}}^{J\\pi}} $$\n该问题为感兴趣的道提供了 $T_b^{J\\pi}$，并为所有其他竞争道提供了一个集总系数 $T_{\\mathrm{rest}}^{J\\pi}$，使得 $T_{\\mathrm{tot}}^{J\\pi} = T_b^{J\\pi} + T_{\\mathrm{rest}}^{J\\pi}$。\n\n总截面 $\\sigma_{\\mathrm{HF}}$ 是对所有有贡献的复合核态 $(J, \\pi)$ 的非相干求和：\n$$ \\sigma_{\\mathrm{HF}} = \\sum_{J,\\pi} \\sigma_{ab}^{J\\pi} = \\frac{\\pi}{k^2} \\frac{1}{(2s_a+1)(2I_A+1)} \\sum_{J,\\pi} (2J+1) T_a^{J\\pi} \\frac{T_b^{J\\pi}}{T_b^{J\\pi} + T_{\\mathrm{rest}}^{J\\pi}} $$\n\n**2. 魏斯科普夫-尤因（近似）模型 ($\\sigma_{\\mathrm{WE}}$)**\n\n魏斯科普夫-尤因模型引入了一个关键的简化：复合核的衰变与其形成模式无关，包括其特定的 $J$ 和 $\\pi$。因此，截面由总形成截面乘以一个与 $J^\\pi$ 无关的单一分支比给出。\n\n首先，总形成截面 $\\sigma_{CN}$ 是所有部分形成截面之和：\n$$ \\sigma_{CN} = \\sum_{J,\\pi} \\sigma_{CN}^{J\\pi} = \\frac{\\pi}{k^2} \\frac{1}{(2s_a+1)(2I_A+1)} \\sum_{J,\\pi} (2J+1) T_a^{J\\pi} $$\n接下来，我们构建一个与 $J^\\pi$ 无关的平均分支概率 $P_b^{\\mathrm{WE}}$。这是通过将出射道‘b’的自旋加权透射系数求和，然后除以所有自旋加权总衰变透射系数之和来实现的：\n$$ P_b^{\\mathrm{WE}} = \\frac{\\sum_{J,\\pi}(2J+1)T_b^{J\\pi}}{\\sum_{J,\\pi}(2J+1)T_{\\mathrm{tot}}^{J\\pi}} = \\frac{\\sum_{J,\\pi}(2J+1)T_b^{J\\pi}}{\\sum_{J,\\pi}(2J+1)(T_b^{J\\pi} + T_{\\mathrm{rest}}^{J\\pi})} $$\nWE 截面是这两个量的乘积：\n$$ \\sigma_{\\mathrm{WE}} = \\sigma_{CN} \\times P_b^{\\mathrm{WE}} = \\left( \\frac{\\pi}{k^2} \\frac{\\sum_{J,\\pi} (2J+1) T_a^{J\\pi}}{(2s_a+1)(2I_A+1)} \\right) \\times \\left( \\frac{\\sum_{J,\\pi}(2J+1)T_b^{J\\pi}}{\\sum_{J,\\pi}(2J+1)T_{\\mathrm{tot}}^{J\\pi}} \\right) $$\n\n**3. 相对误差计算**\n\n目标是计算相对误差 $\\epsilon$，定义为：\n$$ \\epsilon = \\frac{\\sigma_{\\mathrm{WE}} - \\sigma_{\\mathrm{HF}}}{\\sigma_{\\mathrm{HF}}} $$\n注意到 $\\sigma_{\\mathrm{HF}}$ 和 $\\sigma_{\\mathrm{WE}}$ 都包含共同因子 $C = \\frac{\\pi}{k^2} \\frac{1}{(2s_a+1)(2I_A+1)}$。在计算相对误差时，这个因子会抵消掉。\n令 $S_{\\mathrm{HF}} = \\sum_{J,\\pi} (2J+1) T_a^{J\\pi} \\frac{T_b^{J\\pi}}{T_{\\mathrm{tot}}^{J\\pi}}$。\n令 $S_{\\mathrm{form}} = \\sum_{J,\\pi} (2J+1) T_a^{J\\pi}$。\n令 $S_{\\mathrm{decay},b} = \\sum_{J,\\pi} (2J+1) T_b^{J\\pi}$。\n令 $S_{\\mathrm{decay,tot}} = \\sum_{J,\\pi} (2J+1) T_{\\mathrm{tot}}^{J\\pi}$。\n那么 $\\sigma_{\\mathrm{HF}} = C \\cdot S_{\\mathrm{HF}}$ 且 $\\sigma_{\\mathrm{WE}} = C \\cdot S_{\\mathrm{form}} \\frac{S_{\\mathrm{decay},b}}{S_{\\mathrm{decay,tot}}}$。\n相对误差简化为：\n$$ \\epsilon = \\frac{S_{\\mathrm{form}} \\cdot S_{\\mathrm{decay},b} / S_{\\mathrm{decay,tot}}}{S_{\\mathrm{HF}}} - 1 $$\n这避免了计算前置因子 $C$以及从 $\\mathrm{fm}^2$ 到靶（barns）的转换，因为它们对于最终的无单位量是无关紧要的。实现将为每个测试用例计算这些中间和，然后计算相对误差，并按要求四舍五入到六位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative error between the Hauser-Feshbach and Weisskopf-Ewing\n    cross section models for several test cases of compound nucleus reactions.\n    \"\"\"\n    \n    # Define physical constants and common parameters\n    HBARC = 197.3269804  # MeV fm\n    M_NEUTRON = 939.565  # MeV/c^2\n    MASS_PER_AMU = 931.494 # MeV/c^2\n    \n    # Common parameters for all test cases\n    s_a = 0.5  # Projectile (neutron) spin\n    m_a = M_NEUTRON\n    A_target = 59.0\n    m_A = A_target * MASS_PER_AMU\n    # Reduced mass is not needed as the prefactor cancels in relative error.\n    # mu = (m_a * m_A) / (m_a + m_A)\n\n    test_cases = [\n        {\n            \"I_A\": 7.0/2.0, \"E\": 2.0,\n            \"states\": [\n                {\"J\": 7.0/2.0, \"Ta\": 0.6, \"Tb\": 0.3, \"Trest\": 0.5},\n                {\"J\": 9.0/2.0, \"Ta\": 0.9, \"Tb\": 0.05, \"Trest\": 0.7},\n                {\"J\": 11.0/2.0, \"Ta\": 0.2, \"Tb\": 0.4, \"Trest\": 0.3},\n            ]\n        },\n        {\n            \"I_A\": 7.0/2.0, \"E\": 1.0,\n            \"states\": [\n                {\"J\": 7.0/2.0, \"Ta\": 0.95, \"Tb\": 0.02, \"Trest\": 0.90},\n                {\"J\": 9.0/2.0, \"Ta\": 0.0, \"Tb\": 0.40, \"Trest\": 0.20},\n                {\"J\": 11.0/2.0, \"Ta\": 0.0, \"Tb\": 0.10, \"Trest\": 0.40},\n            ]\n        },\n        {\n            \"I_A\": 7.0/2.0, \"E\": 3.0,\n            \"states\": [\n                {\"J\": 7.0/2.0, \"Ta\": 0.5, \"Tb\": 0.25, \"Trest\": 0.25},\n                {\"J\": 9.0/2.0, \"Ta\": 0.5, \"Tb\": 0.25, \"Trest\": 0.25},\n                {\"J\": 11.0/2.0, \"Ta\": 0.5, \"Tb\": 0.25, \"Trest\": 0.25},\n            ]\n        },\n        {\n            \"I_A\": 7.0/2.0, \"E\": 2.0,\n            \"states\": [\n                {\"J\": 7.0/2.0, \"Ta\": 0.0, \"Tb\": 0.30, \"Trest\": 0.40},\n                {\"J\": 9.0/2.0, \"Ta\": 0.8, \"Tb\": 0.10, \"Trest\": 0.60},\n                {\"J\": 11.0/2.0, \"Ta\": 0.6, \"Tb\": 0.20, \"Trest\": 0.50},\n            ]\n        },\n        {\n            \"I_A\": 7.0/2.0, \"E\": 4.0,\n            \"states\": [\n                {\"J\": 7.0/2.0, \"Ta\": 0.7, \"Tb\": 0.01, \"Trest\": 0.90},\n                {\"J\": 9.0/2.0, \"Ta\": 0.4, \"Tb\": 0.05, \"Trest\": 0.95},\n                {\"J\": 11.0/2.0, \"Ta\": 0.3, \"Tb\": 0.02, \"Trest\": 0.98},\n            ]\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Sums for the unscaled cross sections\n        sum_hf = 0.0\n        sum_form_we = 0.0\n        sum_decay_b_we = 0.0\n        sum_decay_tot_we = 0.0\n\n        for state in case[\"states\"]:\n            J = state[\"J\"]\n            Ta = state[\"Ta\"]\n            Tb = state[\"Tb\"]\n            Trest = state[\"Trest\"]\n            \n            J_weight = 2 * J + 1\n            T_tot = Tb + Trest\n\n            # Hauser-Feshbach sum\n            if T_tot > 1e-12: # Avoid division by zero\n                branch_ratio_hf = Tb / T_tot\n                sum_hf += J_weight * Ta * branch_ratio_hf\n            \n            # Weisskopf-Ewing sums\n            sum_form_we += J_weight * Ta\n            sum_decay_b_we += J_weight * Tb\n            sum_decay_tot_we += J_weight * T_tot\n            \n        # Calculate the unscaled cross section terms\n        sigma_hf_unscaled = sum_hf\n        \n        if sum_decay_tot_we > 1e-12:\n             branch_ratio_we = sum_decay_b_we / sum_decay_tot_we\n        else:\n            branch_ratio_we = 0.0\n        \n        sigma_we_unscaled = sum_form_we * branch_ratio_we\n\n        # Calculate relative error\n        if abs(sigma_hf_unscaled)  1e-12:\n            # If sigma_hf is zero, sigma_we is also zero under non-pathological\n            # conditions. The relative error is defined as 0.\n            relative_error = 0.0\n        else:\n            relative_error = (sigma_we_unscaled - sigma_hf_unscaled) / sigma_hf_unscaled\n            \n        results.append(round(relative_error, 6))\n\n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "前面的练习将透射系数作为给定的参数。这个高级实践练习将深入探讨这些统计量的微观起源。在这里，您将不再直接使用透射系数来建模反应，而是将其构建为对许多独立的、起伏的Breit-Wigner共振的求和，这幅图像更贴近复合核内部潜在的量子混沌现象。您的任务是在这个微观框架下，数值上验证细致平衡原理——这是时间反演不变性的一个深刻推论——即使在包含了宽度起伏修正等复杂效应时也是如此。这个练习  展示了统计模型的内在一致性，并将唯象的透射系数与更基本的共振图像联系起来。",
            "id": "3551295",
            "problem": "复合核反应被建模为由稠密的复合态谱介导的入射道和出射道之间的共振散射。其微观动力学建立在以下原则之上：散射矩阵的时间反演不变性、散射矩阵的幺正性，以及复合核形成的共振图像。考虑在一组由 $c \\in \\{1,\\dots,C\\}$ 索引的建模道中，有两个标记为 $a$ 和 $b$ 的开放道。对于每个标记为 $j$ 的共振，为其分配一个共振质心能量 $E_{R,j}$ 和针对建模道的分波宽度 $\\Gamma_{c,j}$。共振 $j$ 的总宽度为 $\\Gamma_{j} = \\sum_{c=1}^{C} \\Gamma_{c,j} + \\Gamma_{\\text{miss}}$，其中 $\\Gamma_{\\text{miss}}$ 将来自未建模道的贡献聚合为每个共振的恒定光学吸收宽度。在能量 $E$ 时，由共振 $j$ 引起的 $a \\to b$ 跃迁的约化角积分跃迁截面由不含入射道统计因子的 Breit-Wigner 共振形式构建，\n$$\n\\tilde{\\sigma}_{a\\to b}^{(j)}(E) = \\frac{\\pi}{k_a^2} \\frac{\\Gamma_{a,j}\\,\\Gamma_{b,j}}{(E - E_{R,j})^2 + \\Gamma_{j}^2 / 4}\\,,\n$$\n其中 $k_a$ 是道 $a$ 中的波数。然后，系综和能量平均的约化截面被定义为在能量网格 $E \\in [E_0 - \\Delta E/2, E_0 + \\Delta E/2]$ 上和在共振系综上的算术平均。\n\n为了引入宽度涨落修正（WFC），分波宽度 $\\Gamma_{c,j}$ 必须在不同共振之间涨落。通过从零均值正态分布中抽取特定于道的振幅变量 $A_{c,j}$ 来模拟这些在固定平均值下的涨落，并设置 $\\Gamma_{c,j} = A_{c,j}^2$，这会产生具有一个自由度的宽度的 Porter-Thomas 分布（PT）。道 $c$ 的分波宽度平均值通过复合核衰变的 Fermi 黄金规则与透射系数 $T_c$ 和能级密度 $\\rho$ 相关联，$T_c = 2\\pi \\rho \\,\\langle \\Gamma_c \\rangle$，因此 $\\langle \\Gamma_c \\rangle = T_c/(2\\pi \\rho)$。未建模的道由一个恒定的光学吸收宽度 $\\Gamma_{\\text{miss}} = T_{\\text{miss}}/(2\\pi \\rho)$ 表示，其中 $T_{\\text{miss}}$ 是被忽略的道的总透射系数。\n\n定义道 $a$ 的入射道统计因子 $g_a$。时间反演不变性和互易性意味着细致平衡条件\n$$\n\\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 = \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2\\,,\n$$\n其中 $\\tilde{\\sigma}_{a\\to b}$ 和 $\\tilde{\\sigma}_{b\\to a}$ 是在没有计算入射统计因子的情况下计算出的能量和系综平均的约化截面。目标是当只有一部分道被建模，其余的被吸收到 $\\Gamma_{\\text{miss}}$ 中时，在 WFC 条件下数值验证此等式。\n\n您的任务是实现一个完整的、可运行的程序，该程序：\n- 构建一个包含 $N_{\\text{res}}$ 个共振的系综，其质心能量 $E_{R,j}$ 在以 $E_0$ 为中心、宽度为 $\\Delta E$ 的区间内均匀分布（单位为兆电子伏特，$\\mathrm{MeV}$）。\n- 对于每个共振和建模的道 $c$，从方差为 $\\langle \\Gamma_c \\rangle$ 的零均值正态分布中抽取振幅 $A_{c,j}$，并设置 $\\Gamma_{c,j} = A_{c,j}^2$。\n- 使用一个包含 $N_E$ 个点的能量网格来计算约化截面 $\\tilde{\\sigma}_{a\\to b}(E)$ 和 $\\tilde{\\sigma}_{b\\to a}(E)$，然后在该网格上对它们进行平均，以获得 $\\tilde{\\sigma}_{a\\to b}$ 和 $\\tilde{\\sigma}_{b\\to a}$。\n- 通过计算无量纲相对偏差来验证细致平衡等式\n$$\nD = \\frac{\\left| \\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 - \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2 \\right|}{\\tfrac{1}{2}\\left( \\left| \\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 \\right| + \\left| \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2 \\right| \\right)}\\,.\n$$\n程序应为每个提供的测试用例输出 $D$。\n\n单位：\n- 能量 $E$、$E_{R,j}$ 和宽度 $\\Gamma$ 必须以 $\\mathrm{MeV}$ 为单位处理。\n- 波数 $k_a$ 和 $k_b$ 必须以逆费米为单位提供，即 $\\mathrm{fm}^{-1}$。\n- 能级密度 $\\rho$ 必须以态/$\\mathrm{MeV}$ 为单位提供。\n- 透射系数 $T_c$ 和 $T_{\\text{miss}}$ 是无量纲的。\n\n测试套件：\n提供以下测试用例以在不同条件下评估正确性。对于每个用例，程序必须将 $D$ 计算为一个浮点数。\n\n- 用例 1（理想情况，所有道都已建模）：\n    - 建模的道 $C = 3$，索引 $a=1$，$b=2$。\n    - 对于道 $1,2,3$，$k = [\\,0.8,\\,1.2,\\,0.9\\,]$，单位为 $\\mathrm{fm}^{-1}$。\n    - 对于道 $1,2,3$，$g = [\\,1.0,\\,2.0,\\,1.0\\,]$。\n    - $T = [\\,0.4,\\,0.4,\\,0.2\\,]$，$T_{\\text{miss}} = 0.0$。\n    - $\\rho = 80$，单位为 $\\mathrm{MeV}^{-1}$；$E_0 = 0.0$，单位为 $\\mathrm{MeV}$；$\\Delta E = 0.2$，单位为 $\\mathrm{MeV}$。\n    - $N_{\\text{res}} = 600$，$N_E = 600$。\n\n- 用例 2（子集建模，未建模道中有中等吸收）：\n    - 建模的道 $C = 2$，索引 $a=1$，$b=2$。\n    - $k = [\\,0.5,\\,1.5\\,]$，单位为 $\\mathrm{fm}^{-1}$。\n    - $g = [\\,3.0,\\,1.0\\,]$。\n    - $T = [\\,0.3,\\,0.6\\,]$，$T_{\\text{miss}} = 0.1$。\n    - $\\rho = 50$，单位为 $\\mathrm{MeV}^{-1}$；$E_0 = 0.0$，单位为 $\\mathrm{MeV}$；$\\Delta E = 0.3$，单位为 $\\mathrm{MeV}$。\n    - $N_{\\text{res}} = 800$，$N_E = 600$。\n\n- 用例 3（边缘情况，透射系数和波数高度不对称）：\n    - 建模的道 $C = 2$，索引 $a=1$，$b=2$。\n    - $k = [\\,0.2,\\,1.8\\,]$，单位为 $\\mathrm{fm}^{-1}$。\n    - $g = [\\,5.0,\\,1.0\\,]$。\n    - $T = [\\,10^{-3},\\,0.7\\,]$，$T_{\\text{miss}} = 0.3$。\n    - $\\rho = 100$，单位为 $\\mathrm{MeV}^{-1}$；$E_0 = 0.0$，单位为 $\\mathrm{MeV}$；$\\Delta E = 0.3$，单位为 $\\mathrm{MeV}$。\n    - $N_{\\text{res}} = 800$，$N_E = 600$。\n\n- 用例 4（边界情况，少量共振且无未建模道）：\n    - 建模的道 $C = 2$，索引 $a=1$，$b=2$。\n    - $k = [\\,1.0,\\,1.0\\,]$，单位为 $\\mathrm{fm}^{-1}$。\n    - $g = [\\,1.0,\\,1.0\\,]$。\n    - $T = [\\,0.5,\\,0.5\\,]$，$T_{\\text{miss}} = 0.0$。\n    - $\\rho = 10$，单位为 $\\mathrm{MeV}^{-1}$；$E_0 = 0.0$，单位为 $\\mathrm{MeV}$；$\\Delta E = 0.1$，单位为 $\\mathrm{MeV}$。\n    - $N_{\\text{res}} = 50$，$N_E = 200$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，例如，\n$$\n[\\,D_1, D_2, D_3, D_4\\,]\n$$\n其中每个 $D_i$ 是为相应测试用例计算的浮点相对偏差。不应打印任何其他文本。",
            "solution": "用户的请求是验证和解决一个计算核物理问题。该问题要求在复合核反应的背景下，对细致平衡原理进行数值验证，包括宽度涨落修正（WFC）的影响。\n\n**问题验证**\n\n问题陈述经过了严格审查，并被确定为 **有效**。\n\n1.  **给定条件提取**：为模型和测试用例提供了所有必要的参数：道索引（$a, b, c$）、建模道数（$C$）、波数（$k_c$）、统计因子（$g_c$）、透射系数（$T_c, T_{\\text{miss}}$）、能级密度（$\\rho$）、能量范围参数（$E_0, \\Delta E$）以及模拟参数（$N_{\\text{res}}, N_E$）。\n2.  **科学依据**：该问题基于成熟的核反应统计理论（Hauser-Feshbach 理论）。诸如 Breit-Wigner 共振公式、分波宽度的 Porter-Thomas 分布（由宽度涨落修正引起）、平均宽度与透射系数之间的关系（$T_c = 2\\pi\\rho\\langle\\Gamma_c\\rangle$）以及细致平衡原理等关键概念都是标准的，并且表述正确。\n3.  **适定性**：该问题是适定的。目标是计算一个无量纲的相对偏差 $D$，并且 $D$ 的公式已明确给出。计算步骤清晰明了，对于给定的随机种子，可以得到唯一的数值结果。\n4.  **一致性**：不存在内部矛盾。虽然能量窗口 $\\Delta E$ 内模拟的共振数 $N_{\\text{res}}$ 意味着一个密度 $N_{\\text{res}}/\\Delta E$，这个密度可能不等于输入的能级密度 $\\rho$，但这并非矛盾。参数 $\\rho$ 仅用于根据透射系数定义平均分波宽度，代表了被建模物理系统的一个属性。参数 $N_{\\text{res}}$ 是在窗口 $\\Delta E$ 内为保证模拟统计质量而做出的数值选择。\n5.  **清晰度**：该问题使用精确的科学语言表述。所有术语在核反应理论领域都是标准的。\n\n该问题是计算物理学中一个有效、定义明确的任务。\n\n**基于原理的解决方案设计**\n\n目标是数值验证复合核反应中道间跃迁 $a \\to b$ 的细致平衡关系。这个关系是时间反演不变性的一个推论，其表述为：\n$$\n\\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 = \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2\n$$\n其中 $\\tilde{\\sigma}_{a\\to b}$ 是能量和系综平均的约化截面（即不包括入射道统计因子 $g_a$），$g_a$ 是入射道的统计因子，$k_a$ 是波数。验证将通过基于统计共振模型的反应过程的蒙特卡洛模拟来执行。\n\n**1. 复合核共振建模**\n\n复合核被建模为一组 $N_{\\text{res}}$ 个分立共振态。每个共振 $j$ 由其能量 $E_{R,j}$ 和其到各个开放道 $c$ 的分衰变宽度 $\\Gamma_{c,j}$ 来表征。\n\n-   **共振能量**：$N_{\\text{res}}$ 个共振质心能量 $E_{R,j}$ 从能量区间 $[E_0 - \\Delta E/2, E_0 + \\Delta E/2]$ 上的均匀分布中采样。\n\n-   **分波宽度和宽度涨落修正（WFC）**：分波宽度 $\\Gamma_{c,j}$ 不是恒定的，而是在不同共振之间涨落。这是一个关键的物理效应。我们通过假设分波宽度振幅 $A_{c,j}$ 从零均值高斯分布中抽取来对此进行建模。分波宽度则为 $\\Gamma_{c,j} = A_{c,j}^2$。这导致分波宽度遵循 Porter-Thomas 分布（一个自由度为1的 $\\chi^2$ 分布）。该分布的平均值 $\\langle\\Gamma_c\\rangle$ 由道的透射系数 $T_c$ 和核能级密度 $\\rho$ 通过以下关系确定：\n    $$\n    \\langle \\Gamma_c \\rangle = \\frac{T_c}{2\\pi\\rho}\n    $$\n    为了生成具有此平均值的宽度，道 $c$ 的振幅 $A_{c,j}$ 从方差为 $\\sigma_c^2 = \\langle\\Gamma_c\\rangle$ 的正态分布 $\\mathcal{N}(0, \\sigma_c^2)$ 中采样。\n\n-   **总宽度**：共振 $j$ 的总衰变宽度 $\\Gamma_j$ 是其在所有道上的分波宽度之和，包括显式建模的道（$c=1, \\dots, C$）和任何未建模的道。来自未建模道的贡献被视为一个恒定的吸收宽度 $\\Gamma_{\\text{miss}}$，它同样由一个总透射系数 $T_{\\text{miss}}$ 计算得出：\n    $$\n    \\Gamma_j = \\left( \\sum_{c=1}^{C} \\Gamma_{c,j} \\right) + \\Gamma_{\\text{miss}} \\quad \\text{where} \\quad \\Gamma_{\\text{miss}} = \\frac{T_{\\text{miss}}}{2\\pi\\rho}\n    $$\n\n**2. 计算截面**\n\n单个共振 $j$ 在入射能量 $E$ 时对 $a \\to b$ 跃迁的约化截面的贡献由 Breit-Wigner 公式给出：\n$$\n\\tilde{\\sigma}_{a\\to b}^{(j)}(E) = \\frac{\\pi}{k_a^2} \\frac{\\Gamma_{a,j}\\,\\Gamma_{b,j}}{(E - E_{R,j})^2 + \\Gamma_{j}^2 / 4}\n$$\n能量 $E$ 处的总约化截面是所有共振贡献的非相干和：\n$$\n\\tilde{\\sigma}_{a\\to b}(E) = \\sum_{j=1}^{N_{\\text{res}}} \\tilde{\\sigma}_{a\\to b}^{(j)}(E)\n$$\n这代表了在能量 $E$ 时实验上可以观测到的截面。为了获得细致平衡检验所需的平均截面 $\\tilde{\\sigma}_{a\\to b}$，我们在一个跨越区间 $[E_0 - \\Delta E/2, E_0 + \\Delta E/2]$ 的、包含 $N_E$ 个能量点的精细网格上计算 $\\tilde{\\sigma}_{a\\to b}(E)$ 的算术平均值。\n\n**3. 算法实现**\n\n该模拟将使用 Python 和 `numpy` 库来实现高效的向量化计算。固定的随机种子确保了可复现性。\n\n对每个测试用例，算法按以下步骤进行：\n1.  **初始化**：根据输入参数（$T_c, \\rho, T_{\\text{miss}}$），计算平均分波宽度 $\\langle\\Gamma_c\\rangle$ 和缺失宽度 $\\Gamma_{\\text{miss}}$。\n2.  **系综生成**：\n    -   使用 `numpy.random.uniform` 生成一个包含 $N_{\\text{res}}$ 个共振能量 $E_{R,j}$ 的数组。\n    -   对于 $C$ 个建模道中的每一个，从 $\\mathcal{N}(0, \\langle\\Gamma_c\\rangle)$ 中生成一个包含 $N_{\\text{res}}$ 个分波宽度振幅 $A_{c,j}$ 的数组。这是通过从标准正态分布中采样并按 $\\sqrt{\\langle\\Gamma_c\\rangle}$ 进行缩放来完成的。\n    -   将振幅平方以获得分波宽度 $\\Gamma_{c,j}$。这将产生一个大小为 $(N_{\\text{res}}, C)$ 的矩阵。\n    -   通过对每个共振的分波宽度求和并加上 $\\Gamma_{\\text{miss}}$ 来计算总宽度 $\\Gamma_j$ 的数组。\n3.  **截面计算**：\n    -   定义一个包含 $N_E$ 个点的能量网格。\n    -   使用 `numpy` 的广播功能，以向量化的方式计算所有共振 $j$ 和能量点 $i$ 的 $\\tilde{\\sigma}_{a\\to b}^{(j)}(E_i)$，避免了对能量或共振的显式循环。计算出一个大小为 $(N_E, N_{\\text{res}})$ 的截面贡献矩阵。\n    -   通过沿共振轴对此矩阵求和，找到每个能量点的总截面 $\\tilde{\\sigma}_{a\\to b}(E_i)$。\n    -   最终的平均截面 $\\tilde{\\sigma}_{a\\to b}$ 是得到的能量相关截面数组的平均值。\n    -   对逆反应 $\\tilde{\\sigma}_{b\\to a}$ 重复此过程。\n4.  **验证**：使用提供的公式计算无量纲相对偏差 $D$：\n    $$\n    D = \\frac{\\left| \\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 - \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2 \\right|}{\\tfrac{1}{2}\\left( \\left| \\tilde{\\sigma}_{a\\to b}\\, g_a\\, k_b^2 \\right| + \\left| \\tilde{\\sigma}_{b\\to a}\\, g_b\\, k_a^2 \\right| \\right)}\n    $$\n    较小的 $D$ 值表明，在模拟的统计不确定性范围内，细致平衡原理成立。\n\n这种计算方法在标准的、具有物理动机的统计模型内，提供了一个对基本对称性原理的直接数值检验。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Use a fixed random seed for reproducibility of the Monte Carlo simulation.\n    RANDOM_SEED = 42\n    \n    # Test cases as defined in the problem statement.\n    test_cases = [\n        # Case 1: happy path, all channels modeled\n        {\n            \"C\": 3, \"a\": 1, \"b\": 2,\n            \"k\": np.array([0.8, 1.2, 0.9]),\n            \"g\": np.array([1.0, 2.0, 1.0]),\n            \"T\": np.array([0.4, 0.4, 0.2]),\n            \"T_miss\": 0.0,\n            \"rho\": 80.0, \"E0\": 0.0, \"DeltaE\": 0.2,\n            \"N_res\": 600, \"N_E\": 600,\n        },\n        # Case 2: subset modeled, moderate absorption in missing channels\n        {\n            \"C\": 2, \"a\": 1, \"b\": 2,\n            \"k\": np.array([0.5, 1.5]),\n            \"g\": np.array([3.0, 1.0]),\n            \"T\": np.array([0.3, 0.6]),\n            \"T_miss\": 0.1,\n            \"rho\": 50.0, \"E0\": 0.0, \"DeltaE\": 0.3,\n            \"N_res\": 800, \"N_E\": 600,\n        },\n        # Case 3: edge case, strongly asymmetric transmissions and wave numbers\n        {\n            \"C\": 2, \"a\": 1, \"b\": 2,\n            \"k\": np.array([0.2, 1.8]),\n            \"g\": np.array([5.0, 1.0]),\n            \"T\": np.array([1e-3, 0.7]),\n            \"T_miss\": 0.3,\n            \"rho\": 100.0, \"E0\": 0.0, \"DeltaE\": 0.3,\n            \"N_res\": 800, \"N_E\": 600,\n        },\n        # Case 4: boundary case, few resonances and no missing channels\n        {\n            \"C\": 2, \"a\": 1, \"b\": 2,\n            \"k\": np.array([1.0, 1.0]),\n            \"g\": np.array([1.0, 1.0]),\n            \"T\": np.array([0.5, 0.5]),\n            \"T_miss\": 0.0,\n            \"rho\": 10.0, \"E0\": 0.0, \"DeltaE\": 0.1,\n            \"N_res\": 50, \"N_E\": 200,\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _compute_deviation(params, seed=RANDOM_SEED)\n        results.append(result)\n\n    # Format the final output as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _compute_deviation(params, seed):\n    \"\"\"\n    Computes the relative deviation D for a single test case.\n    \"\"\"\n    # Unpack parameters\n    C = params[\"C\"]\n    a_idx, b_idx = params[\"a\"] - 1, params[\"b\"] - 1\n    k, g, T = params[\"k\"], params[\"g\"], params[\"T\"]\n    T_miss, rho = params[\"T_miss\"], params[\"rho\"]\n    E0, DeltaE = params[\"E0\"], params[\"DeltaE\"]\n    N_res, N_E = params[\"N_res\"], params[\"N_E\"]\n\n    rng = np.random.default_rng(seed)\n\n    # 1. Calculate mean widths and missing width\n    mean_Gamma_c = T / (2.0 * np.pi * rho)\n    Gamma_miss = T_miss / (2.0 * np.pi * rho)\n\n    # 2. Generate resonance ensemble\n    # Resonance energies\n    E_R_j = rng.uniform(low=E0 - DeltaE / 2.0, high=E0 + DeltaE / 2.0, size=N_res)\n\n    # Partial widths (from Porter-Thomas distribution)\n    # Amplitudes A_cj are drawn from N(0, mean_Gamma_c)\n    # std_dev = sqrt(variance), variance = mean_Gamma_c\n    std_dev_c = np.sqrt(mean_Gamma_c)\n    # Generate standard normal variates and scale them\n    A_cj = rng.normal(loc=0.0, scale=1.0, size=(N_res, C)) * std_dev_c\n    Gamma_cj = A_cj**2  # Shape: (N_res, C)\n\n    # Total widths\n    Gamma_j = np.sum(Gamma_cj, axis=1) + Gamma_miss # Shape: (N_res,)\n\n    # 3. Calculate energy-averaged cross sections\n    # Energy grid\n    E_grid = np.linspace(E0 - DeltaE / 2.0, E0 + DeltaE / 2.0, N_E)\n\n    # Use broadcasting for vectorized calculation\n    # Reshape for broadcasting: E_grid (N_E, 1), E_R_j (N_res,), Gamma_j (N_res,)\n    E_grid_reshaped = E_grid[:, np.newaxis] \n\n    # Breit-Wigner denominator term, shape (N_E, N_res)\n    denominator = (E_grid_reshaped - E_R_j)**2 + (Gamma_j**2) / 4.0\n\n    # Numerator term for a->b cross section, shape (N_res,)\n    Gamma_a_j = Gamma_cj[:, a_idx]\n    Gamma_b_j = Gamma_cj[:, b_idx]\n    numerator_ab = Gamma_a_j * Gamma_b_j\n\n    # Reduced cross section for a->b, shape (N_E, N_res)\n    k_a = k[a_idx]\n    sigma_j_ab_matrix = (np.pi / k_a**2) * (numerator_ab / denominator)\n\n    # Total cross section at each energy by summing over resonances, shape (N_E,)\n    sigma_E_ab = np.sum(sigma_j_ab_matrix, axis=1)\n    \n    # Energy-averaged cross section\n    avg_sigma_ab = np.mean(sigma_E_ab)\n\n    # Repeat for b->a. Numerator is the same, just k_b is different.\n    k_b = k[b_idx]\n    sigma_j_ba_matrix = (np.pi / k_b**2) * (numerator_ab / denominator)\n    sigma_E_ba = np.sum(sigma_j_ba_matrix, axis=1)\n    avg_sigma_ba = np.mean(sigma_E_ba)\n\n    # 4. Compute detailed balance deviation D\n    g_a, g_b = g[a_idx], g[b_idx]\n\n    lhs = avg_sigma_ab * g_a * k_b**2\n    rhs = avg_sigma_ba * g_b * k_a**2\n\n    numerator_D = np.abs(lhs - rhs)\n    denominator_D = 0.5 * (np.abs(lhs) + np.abs(rhs))\n    \n    # Handle case where denominator is zero to avoid division errors\n    if denominator_D == 0:\n        return 0.0\n    else:\n        return numerator_D / denominator_D\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}