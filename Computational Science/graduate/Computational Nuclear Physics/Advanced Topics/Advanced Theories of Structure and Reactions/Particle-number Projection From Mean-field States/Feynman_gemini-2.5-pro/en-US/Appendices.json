{
    "hands_on_practices": [
        {
            "introduction": "The first step in numerically implementing particle-number projection is to replace the continuous gauge-angle integral with a discrete sum. A crucial question arises: how many discretization points are needed to accurately capture the physics of the mean-field state? This exercise reveals the answer by connecting the projection integral to the Discrete Fourier Transform, establishing the minimum number of gauge points required to avoid numerical artifacts like aliasing .",
            "id": "3579450",
            "problem": "Consider a Hartree-Fock-Bogoliubov (HFB) mean-field state with broken particle-number symmetry. The particle-number projection operator onto the sector with particle number $N$ is defined by the gauge-angle integral\n$$\n\\hat P_N = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{i\\phi(\\hat N - N)},\n$$\nwhere $\\hat N$ is the number operator. For a general mean-field state $\\lvert \\Phi \\rangle$, the corresponding generating function\n$$\nG(\\phi) \\equiv \\langle \\Phi \\lvert e^{i\\phi \\hat N} \\rvert \\Phi \\rangle\n$$\nis $2\\pi$-periodic in $\\phi$, and the probability distribution for particle number $n$ in the state $\\lvert \\Phi \\rangle$ can be obtained as the inverse Fourier transform,\n$$\nw_n \\equiv \\langle \\Phi \\lvert \\hat P_n \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi).\n$$\nIn computation, the gauge-angle integral is replaced by a discrete quadrature over angles. Assume $G(\\phi)$ is sufficiently band-limited in Fourier space such that its non-negligible Fourier components $w_n$ lie within a contiguous integer range $n \\in [N_{\\min}, N_{\\max}]$ with span $L \\equiv N_{\\max} - N_{\\min} + 1$. You are asked to propose a discrete quadrature for evaluating $\\hat P_N$ and to justify the minimal number of points required to resolve the particle-number distribution without aliasing by appealing to the discrete Fourier transform (DFT) of the sampled $G(\\phi)$.\n\nWhich option correctly states a discrete quadrature rule using equally spaced gauge angles with equal weights, and gives the minimal requirement on the number of quadrature points based on the maximum resolvable particle-number range via the DFT, including the numerical consequence for a case with $N_{\\min} = 116$ and $N_{\\max} = 128$?\n\nA. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max} - N_{\\min} + 1$ to avoid aliasing in the DFT of $G(\\phi_m)$; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $13$.\n\nB. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M-1}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max}$ to avoid aliasing; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $128$.\n\nC. Choose $M$ points $\\phi_m = \\dfrac{2\\pi (m + 1/2)}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and $M$ can be arbitrary because the trapezoidal rule is exact for periodic analytic functions; for $N_{\\min} = 116$ and $N_{\\max} = 128$, any $M$ suffices.\n\nD. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with weights $\\dfrac{2\\pi}{M}$, and require $M$ to be even to correctly capture even-number parity states; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal even $M$ is $14$.\n\nE. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M = 2\\big(N_{\\max} - N_{\\min}\\big) + 1$ by a Nyquist criterion; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $25$.",
            "solution": "The problem statement is critically validated as follows.\n\n### Step 1: Extract Givens\n- The particle-number projection operator is $\\hat P_N = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{i\\phi(\\hat N - N)}$.\n- The mean-field state is $\\lvert \\Phi \\rangle$.\n- The generating function is $G(\\phi) \\equiv \\langle \\Phi \\lvert e^{i\\phi \\hat N} \\rvert \\Phi \\rangle$, which is $2\\pi$-periodic.\n- The probability distribution for particle number $n$ is $w_n \\equiv \\langle \\Phi \\lvert \\hat P_n \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi)$.\n- Assumption: The non-negligible Fourier components $w_n$ of $G(\\phi)$ are within a contiguous range $n \\in [N_{\\min}, N_{\\max}]$.\n- The span of this range is $L \\equiv N_{\\max} - N_{\\min} + 1$.\n- Task: Propose a discrete quadrature for $\\hat P_N$ and find the minimal number of quadrature points $M$ to avoid aliasing.\n- Specific case: $N_{\\min} = 116$ and $N_{\\max} = 128$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem describes particle-number projection via gauge-angle integration. This is a standard, well-established method in computational nuclear physics and many-body theory, used to restore a symmetry broken at the mean-field level (e.g., in Hartree-Fock-Bogoliubov theory). The mathematical formulation using a Fourier integral is correct. The problem is scientifically sound.\n- **Well-Posed:** The problem asks for the minimum number of sample points required to correctly compute a set of Fourier coefficients of a band-limited periodic function. This is a classic problem in signal processing with a unique, well-defined answer based on the sampling theorem. The problem is well-posed.\n- **Objective:** The problem is stated in precise mathematical and physical language, free of any subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid** as it is scientifically sound, well-posed, and objective. Proceeding with the solution.\n\n### Derivation\nThe probability $w_n$ of finding $n$ particles in the state $\\lvert \\Phi \\rangle$ is given by the integral\n$$\nw_n = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi).\n$$\nThis expression is precisely the formula for the $n$-th coefficient of the Fourier series expansion of the $2\\pi$-periodic generating function $G(\\phi)$:\n$$\nG(\\phi) = \\sum_{k=-\\infty}^{\\infty} w_k e^{i k \\phi}.\n$$\nThe problem states that $G(\\phi)$ is effectively band-limited, meaning its Fourier coefficients $w_n$ are non-negligible only for $n$ within the integer range $[N_{\\min}, N_{\\max}]$. Thus, the sum can be approximated as:\n$$\nG(\\phi) \\approx \\sum_{n=N_{\\min}}^{N_{\\max}} w_n e^{i n \\phi}.\n$$\nTo compute the coefficients $w_n$ numerically, we discretize the integral. We sample the function $G(\\phi)$ at $M$ equally spaced points $\\phi_m = \\frac{2\\pi m}{M}$ for $m = 0, 1, \\dots, M-1$. Let the samples be $g_m = G(\\phi_m)$.\nThe integral for $w_n$ is approximated using the trapezoidal rule, which for a periodic function integrated over its period simplifies to an equally weighted sum:\n$$\nw_n \\approx \\frac{1}{2\\pi} \\sum_{m=0}^{M-1} G(\\phi_m) e^{-i n \\phi_m} \\Delta\\phi,\n$$\nwhere the step size is $\\Delta\\phi = \\frac{2\\pi}{M}$. Substituting $\\phi_m$ and $\\Delta\\phi$:\n$$\nw_n \\approx \\frac{1}{2\\pi} \\sum_{m=0}^{M-1} g_m e^{-i n \\frac{2\\pi m}{M}} \\frac{2\\pi}{M} = \\frac{1}{M} \\sum_{m=0}^{M-1} g_m e^{-i n \\frac{2\\pi m}{M}}.\n$$\nThis is the definition of the Discrete Fourier Transform (DFT) of the sequence $\\{g_m\\}_{m=0}^{M-1}$, which yields a sequence of approximated coefficients $\\{\\tilde{w}_k\\}_{k=0}^{M-1}$. Let us analyze the effect of this discretization. The computed coefficient $\\tilde{w}_k$ is:\n$$\n\\tilde{w}_k = \\frac{1}{M} \\sum_{m=0}^{M-1} G(\\phi_m) e^{-i k \\frac{2\\pi m}{M}} = \\frac{1}{M} \\sum_{m=0}^{M-1} \\left( \\sum_{n=N_{\\min}}^{N_{\\max}} w_n e^{i n \\frac{2\\pi m}{M}} \\right) e^{-i k \\frac{2\\pi m}{M}}.\n$$\nSwapping the order of summation:\n$$\n\\tilde{w}_k = \\sum_{n=N_{\\min}}^{N_{\\max}} w_n \\left( \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i (n-k) \\frac{2\\pi m}{M}} \\right).\n$$\nThe term in the parenthesis is a discrete sum of roots of unity, which equals $1$ if $n-k$ is an integer multiple of $M$ (i.e., $n \\equiv k \\pmod M$) and $0$ otherwise. Therefore, the computed DFT coefficient $\\tilde{w}_k$ is a sum of all true Fourier coefficients $w_n$ whose indices $n$ are congruent to $k$ modulo $M$:\n$$\n\\tilde{w}_k = \\sum_{j=-\\infty}^{\\infty} w_{k+jM}.\n$$\nThis phenomenon is known as aliasing. To avoid aliasing and recover the true coefficients $w_n$ for $n \\in [N_{\\min}, N_{\\max}]$, we must choose $M$ large enough such that for any two distinct indices $n_1, n_2$ in this range, they are not congruent modulo $M$. That is, $n_1 \\not\\equiv n_2 \\pmod M$ for all $n_1 \\neq n_2$ where $n_1, n_2 \\in [N_{\\min}, N_{\\max}]$.\nThis condition is equivalent to requiring $n_1 - n_2 \\neq jM$ for any non-zero integer $j$. The magnitude of the difference $|n_1 - n_2|$ is at most $N_{\\max} - N_{\\min}$. To prevent any non-zero difference from being a multiple of $M$, we must choose $M$ to be larger than the maximum possible difference:\n$$\nM > N_{\\max} - N_{\\min}.\n$$\nAlternatively, consider the number of distinct integer indices in the support of our signal, which is $L = N_{\\max} - N_{\\min} + 1$. If we choose $M < L$, then by the pigeonhole principle, at least two distinct indices from the set $\\{N_{\\min}, \\dots, N_{\\max}\\}$ must map to the same value modulo $M$, causing aliasing. Therefore, we must have $M \\geq L$.\nThe minimum integer value of $M$ that satisfies this is:\n$$\nM_{\\min} = L = N_{\\max} - N_{\\min} + 1.\n$$\nWith this choice, for any $n_1, n_2 \\in [N_{\\min}, N_{\\max}]$, if $n_1 \\equiv n_2 \\pmod{M_{\\min}}$, then $|n_1 - n_2|$ must be a multiple of $M_{\\min}$. But $|n_1 - n_2| \\leq N_{\\max} - N_{\\min} = M_{\\min} - 1$. The only multiple of $M_{\\min}$ with magnitude less than $M_{\\min}$ is $0$. Thus, $n_1-n_2=0$, which implies $n_1=n_2$. No aliasing occurs between the desired components.\n\nThe discrete approximation of the projection operator $\\hat P_N$ is\n$$\n\\hat P_N \\approx \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i\\phi_m(\\hat N - N)} = \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i\\frac{2\\pi m}{M}(\\hat N - N)}.\n$$\nThis corresponds to a quadrature rule with points $\\phi_m = \\frac{2\\pi m}{M}$ and equal weights $\\frac{1}{M}$.\n\nFor the specific case given, $N_{\\min} = 116$ and $N_{\\max} = 128$:\nThe minimal number of quadrature points is\n$$\nM_{\\min} = N_{\\max} - N_{\\min} + 1 = 128 - 116 + 1 = 12 + 1 = 13.\n$$\n\n### Option-by-Option Analysis\n\n**A. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max} - N_{\\min} + 1$ to avoid aliasing in the DFT of $G(\\phi_m)$; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $13$.**\n- The choice of points corresponds to the standard setup for DFT on a periodic function.\n- The weights $\\frac{1}{M}$ are correct for the discretized operator $\\hat P_N$, resulting from the $\\frac{1}{2\\pi}$ prefactor and the trapezoidal rule step size $\\Delta\\phi = \\frac{2\\pi}{M}$.\n- The condition $M \\geq N_{\\max} - N_{\\min} + 1$ is precisely the condition derived to avoid aliasing.\n- The calculation for the minimal $M$ yields $128 - 116 + 1 = 13$, which matches the statement.\n- **Verdict: Correct.**\n\n**B. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M-1}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max}$ to avoid aliasing; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $128$.**\n- The choice of points $\\phi_m = \\frac{2\\pi m}{M-1}$ means that $\\phi_0 = 0$ and $\\phi_{M-1} = 2\\pi$. Since $G(\\phi)$ is periodic, $G(\\phi_0) = G(\\phi_{M-1})$, so this sampling scheme is redundant and does not align with the standard $M$-point DFT.\n- The requirement $M \\geq N_{\\max}$ is incorrect. The sampling requirement depends on the bandwidth ($N_{\\max} - N_{\\min}$), not the maximum frequency index ($N_{\\max}$). For a bandpass signal far from zero, this condition is grossly excessive.\n- **Verdict: Incorrect.**\n\n**C. Choose $M$ points $\\phi_m = \\dfrac{2\\pi (m + 1/2)}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and $M$ can be arbitrary because the trapezoidal rule is exact for periodic analytic functions; for $N_{\\min} = 116$ and $N_{\\max} = 128$, any $M$ suffices.**\n- While the midpoint rule is a valid quadrature, the claim that \"$M$ can be arbitrary\" is false. The trapezoidal rule (and related rules) is exact for a trigonometric polynomial of degree $K$ only if the number of points is sufficiently large (e.g., $M > 2K$). For a band-limited function, if $M$ is less than the number of non-zero Fourier components, aliasing occurs and the integral is not computed correctly. The minimal number of points is determined by the bandwidth, as derived above.\n- **Verdict: Incorrect.**\n\n**D. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with weights $\\dfrac{2\\pi}{M}$, and require $M$ to be even to correctly capture even-number parity states; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal even $M$ is $14$.**\n- The weights $\\frac{2\\pi}{M}$ would be for the integral itself, but the operator $\\hat P_N$ includes a $\\frac{1}{2\\pi}$ prefactor, making the effective weights $\\frac{1}{M}$. This is a minor ambiguity.\n- The crucial error is the requirement that \"$M$ to be even\". There is no such general requirement for particle number projection. An odd number of points is perfectly valid. Indeed, for the given case, the minimal number of points is $13$, which is odd. The ability to resolve different particle numbers $n$ depends on the number of points $M$, not its parity.\n- **Verdict: Incorrect.**\n\n**E. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M = 2\\big(N_{\\max} - N_{\\min}\\big) + 1$ by a Nyquist criterion; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $25$.**\n- This is a misapplication of the Nyquist-Shannon sampling theorem. The theorem, in its simplest form, applies to real-valued low-pass signals. The signal here is complex and band-pass. The number of degrees of freedom to determine is the number of complex Fourier coefficients, which is $L = N_{\\max} - N_{\\min} + 1$. This requires at least $L$ complex samples. The condition $M \\geq L$ is the correct one. The proposed condition $M \\geq 2(N_{\\max} - N_{\\min}) + 1 = 2(L-1)+1 = 2L-1$ is overly stringent and incorrect.\n- For the given case, this incorrect formula yields $M=2(12)+1 = 25$, whereas the true minimum is $13$.\n- **Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "With the required number of grid points established, the next practical concern for any large-scale calculation is computational efficiency. How does the cost of particle-number projection scale with the size of the system and the numerical precision required? This practice guides you through an analysis of the asymptotic complexity, highlighting the indispensable role of efficient algorithms like the Fast Fourier Transform (FFT) in making these calculations feasible .",
            "id": "3579480",
            "problem": "Consider a Hartree-Fock-Bogoliubov (HFB) vacuum in the canonical basis with $K$ time-reversed canonical pairs labeled by $k=1,\\dots,K$, each characterized by real Bogoliubov amplitudes $u_k$ and $v_k$ satisfying $u_k^{2}+v_k^{2}=1$. Let $\\hat{R}(\\phi)=\\exp(i\\phi \\hat{N})$ be the gauge rotation generated by the particle-number operator $\\hat{N}$, with gauge angle $\\phi$ measured in radians. The gauge-angle overlap generating function is defined as $G(\\phi)=\\langle \\Phi|\\hat{R}(\\phi)|\\Phi\\rangle$, which factorizes in the canonical basis as\n$$\nG(\\phi)=\\prod_{k=1}^{K}\\left(u_k^{2}+v_k^{2}\\,\\exp\\!\\left(i\\,2\\phi\\right)\\right).\n$$\nDiscretize the gauge angle on the uniform mesh $\\phi_m=\\frac{2\\pi m}{M}$ for $m=0,1,\\dots,M-1$, and define the discrete number-projected weights\n$$\nn_{N}=\\frac{1}{M}\\sum_{m=0}^{M-1}\\exp\\!\\left(-i\\,N\\,\\phi_m\\right)\\,G(\\phi_m),\\quad N=0,1,\\dots,M-1,\n$$\nwhich constitute the discrete Fourier transform of the samples $G(\\phi_m)$. Assume a unit-cost arithmetic model in which each complex multiplication and each complex addition has cost $1$, precomputation of $\\exp(i\\,2\\phi_m)$ over all $m$ has cost proportional to $M$, and that no reuse across different $m$ beyond this precomputation is possible when forming $G(\\phi_m)$.\n\nStarting from these definitions and cost-model assumptions only, and using the well-established arithmetic complexity of the Fast Fourier Transform (FFT) for a length-$M$ transform, derive the asymptotic arithmetic operation count required to compute all $G(\\phi_m)$ and then all $n_N$ for $N=0,\\dots,M-1$ by:\n- first forming all $G(\\phi_m)$ directly from the canonical-factor product, and\n- then computing all $n_N$ using a single length-$M$ FFT.\n\nExpress your final answer as a single asymptotic complexity in Big-$\\mathcal{O}$ notation as a function of $M$ and $K$. No numerical rounding is required, and no physical units apply to the final answer. The angle $\\phi$ is in radians.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the established theory of Hartree-Fock-Bogoliubov (HFB) mean-field models and the standard technique of particle-number projection. The problem is well-posed, objective, and provides a clear computational task with a self-contained cost model.\n\nThe objective is to determine the asymptotic arithmetic operation count required to compute a set of number-projected weights, $\\{n_N\\}$, from an HFB state. The computation is specified to proceed in two distinct stages:\n1.  Direct computation of the gauge-angle overlap generating function $G(\\phi_m)$ for $M$ discrete gauge angles $\\phi_m$.\n2.  Computation of the weights $n_N$ from the values of $G(\\phi_m)$ using a single Fast Fourier Transform (FFT).\n\nWe will analyze the arithmetic complexity of each stage separately and then sum them to find the total complexity. The analysis will strictly adhere to the provided unit-cost model for complex arithmetic, where each complex multiplication and each complex addition incurs a cost of $1$.\n\n**Stage 1: Computation of the Generating Function $G(\\phi_m)$**\n\nThe generating function is given by the product over $K$ canonical pairs:\n$$\nG(\\phi_m) = \\prod_{k=1}^{K}\\left(u_k^{2}+v_k^{2}\\,\\exp\\!\\left(i\\,2\\phi_m\\right)\\right)\n$$\nwhere $\\phi_m = \\frac{2\\pi m}{M}$ for $m=0, 1, \\dots, M-1$.\n\nThe problem specifies that these values are to be computed by directly evaluating the product for each value of $m$. The values of $\\exp(i\\,2\\phi_m)$ are precomputed for all $m$ at a total cost stated to be proportional to $M$, which is $\\mathcal{O}(M)$. Let us denote the precomputed complex numbers as $W_m = \\exp(i\\,2\\phi_m)$. Furthermore, the real-valued squares of the Bogoliubov amplitudes, $u_k^2$ and $v_k^2$, can be precomputed for all $k=1, \\dots, K$. This requires $2K$ real multiplications, which is a cost of $\\mathcal{O}(K)$.\n\nWe first analyze the cost to compute a single value $G(\\phi_m)$ for a fixed $m$. The computation involves calculating $K$ terms of the form $T_{k,m} = u_k^2 + v_k^2 W_m$ and then multiplying them together.\n\nFor a fixed $k$ and $m$:\n1.  The product $v_k^2 W_m$ involves multiplying a real number ($v_k^2$) by a complex number ($W_m$). Under the specified cost model, this is counted as $1$ complex multiplication.\n2.  The sum $u_k^2 + (v_k^2 W_m)$ involves adding a real number ($u_k^2$) to the resulting complex number. This is counted as $1$ complex addition.\n\nThus, computing one term $T_{k,m}$ requires $2$ arithmetic operations. To compute all $K$ terms for a fixed $m$, the cost is $2K$ operations.\n\nNext, these $K$ complex terms must be multiplied together to form $G(\\phi_m)$. This requires $K-1$ complex multiplications.\nThe total cost to compute a single $G(\\phi_m)$ is therefore $(2K) + (K-1) = 3K-1$ operations. In asymptotic notation, the cost for a single $G(\\phi_m)$ is $\\mathcal{O}(K)$.\n\nThe problem states that this calculation must be performed for each $m=0, 1, \\dots, M-1$, and explicitly prohibits any reuse of intermediate calculations across different values of $m$. Therefore, we must multiply the cost for a single point by the number of points, $M$. The total cost for computing all $\\{G(\\phi_m)\\}_{m=0}^{M-1}$ is $M \\times \\mathcal{O}(K) = \\mathcal{O}(MK)$.\n\nThe total cost for Stage 1 is the sum of costs for precomputation and the main calculation: $\\mathcal{O}(M) + \\mathcal{O}(K) + \\mathcal{O}(MK)$. Since $K \\ge 1$ and $M \\ge 1$ for a non-trivial problem, the $\\mathcal{O}(MK)$ term is dominant. The asymptotic complexity of Stage 1 is $\\mathcal{O}(MK)$.\n\n**Stage 2: Computation of the Projected Weights $n_N$ via FFT**\n\nThe discrete number-projected weights are defined by:\n$$\nn_{N}=\\frac{1}{M}\\sum_{m=0}^{M-1}G(\\phi_m)\\,\\exp\\!\\left(-i\\,N\\,\\phi_m\\right) = \\frac{1}{M}\\sum_{m=0}^{M-1}G(\\phi_m)\\,\\exp\\!\\left(-\\frac{2\\pi i}{M} Nm\\right)\n$$\nfor $N=0, 1, \\dots, M-1$. This expression is precisely the definition of the Discrete Fourier Transform (DFT) of the sequence $\\{G(\\phi_m)\\}_{m=0}^{M-1}$, followed by a scaling of all components by $\\frac{1}{M}$.\n\nThe problem instructs to use the Fast Fourier Transform (FFT) algorithm. The arithmetic complexity of a length-$M$ FFT is well-established to be $\\mathcal{O}(M \\log M)$. This single transform computes the value of the sum for all $N=0, 1, \\dots, M-1$.\n\nAfter the FFT computes the sums, each of the $M$ resulting values must be multiplied by the scalar factor $\\frac{1}{M}$. This final scaling step requires $M$ additional multiplications, which corresponds to a cost of $\\mathcal{O}(M)$.\n\nThe total complexity for Stage 2 is the sum of the FFT cost and the scaling cost: $\\mathcal{O}(M \\log M) + \\mathcal{O}(M)$. The logarithmic term is dominant, so the asymptotic complexity of Stage 2 is $\\mathcal{O}(M \\log M)$.\n\n**Total Asymptotic Complexity**\n\nThe total arithmetic complexity of the entire procedure is the sum of the complexities of the two stages:\n$$\n\\text{Total Cost} = \\text{Cost(Stage 1)} + \\text{Cost(Stage 2)} = \\mathcal{O}(MK) + \\mathcal{O}(M \\log M)\n$$\nThis can be written more compactly by factoring out $M$:\n$$\n\\text{Total Cost} = \\mathcal{O}(M(K + \\log M))\n$$\nThis final expression represents the total asymptotic arithmetic operation count as a function of the number of canonical pairs, $K$, and the number of discretization points, $M$.",
            "answer": "$$\n\\boxed{\\mathcal{O}\\left(M\\left(K+\\log M\\right)\\right)}\n$$"
        },
        {
            "introduction": "Theory and efficiency analysis culminate in practical implementation and validation, the cornerstones of computational science. This exercise challenges you to build a complete program to calculate the projected energy for a model system and, more importantly, to systematically test the convergence of your results. By varying the number of gauge points and truncating the model space, you will gain hands-on experience in ensuring the reliability and accuracy of your numerical predictions .",
            "id": "3579430",
            "problem": "You are given a mean-field quasiparticle vacuum for a system of independent time-reversal-conjugate canonical pairs in computational nuclear physics and asked to assess the convergence of the particle-number projected energy with respect to two numerical controls: the number of gauge-angle points and the truncation of weakly occupied canonical states. Your task is to design and implement a program that, for a given test suite, evaluates whether the projected energies have converged within prescribed tolerances.\n\nThe physical and mathematical setting uses the following foundational bases:\n\n- The particle-number projection operator onto particle number $N$ is\n$$\n\\hat{P}_N \\equiv \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}\\varphi \\, e^{i \\varphi (N - \\hat{N})}.\n$$\n- The system Hamiltonian is the constant-pairing Hamiltonian\n$$\n\\hat{H} \\equiv \\sum_{i=1}^{\\Omega} 2 \\varepsilon_i \\hat{N}_i - G \\sum_{i=1}^{\\Omega}\\sum_{j=1}^{\\Omega} \\hat{P}_i^\\dagger \\hat{P}_j,\n$$\nwhere $i$ labels canonical time-reversal-conjugate pairs, $\\hat{N}_i$ counts particles in the pair subspace, and $\\hat{P}_i^\\dagger$ creates a pair in level $i$. The single-particle energies are $\\varepsilon_i$ in megaelectronvolts (MeV), and $G$ is a constant pairing strength in MeV.\n- The mean-field (Bardeen–Cooper–Schrieffer) quasiparticle vacuum is\n$$\n\\lvert \\Phi \\rangle \\equiv \\prod_{i=1}^{\\Omega} \\left(u_i + v_i \\, \\hat{P}_i^\\dagger \\right) \\lvert 0 \\rangle,\n$$\nwith $u_i, v_i \\in \\mathbb{R}$ and $u_i^2 + v_i^2 = 1$ for all $i$.\n\nFrom these foundations, the projected energy is defined as the ratio of projected kernels,\n$$\nE_N \\equiv \\frac{\\langle \\Phi \\lvert \\hat{H} \\hat{P}_N \\rvert \\Phi \\rangle}{\\langle \\Phi \\lvert \\hat{P}_N \\rvert \\Phi \\rangle}.\n$$\n\nYour program must implement the following, deduced from the definitions above:\n\n1. Express the norm kernel $\\langle \\Phi \\lvert e^{-i \\varphi \\hat{N}} \\rvert \\Phi \\rangle$ and the Hamiltonian kernel $\\langle \\Phi \\lvert \\hat{H} e^{-i \\varphi \\hat{N}} \\rvert \\Phi \\rangle$ in terms of canonical pair factors that follow from the independent-pair structure of $\\lvert \\Phi \\rangle$ and standard many-body contractions. Use the angle $\\varphi$ in radians.\n\n2. Discretize the gauge-angle integral over $\\varphi \\in [0, 2\\pi)$ with $M$ equidistant points $\\varphi_k \\equiv 2\\pi k/M$ for $k=0,\\dots,M-1$ and equal weights, to approximate $E_N$ by a discrete quadrature. This is the Fomenko/trapezoidal rule on the unit circle.\n\n3. Implement canonical-space truncation by removing any level $i$ whose occupation $v_i^2$ is smaller than a specified threshold $\\eta \\ge 0$. All remaining levels must be used consistently in both kernels.\n\n4. For each test case, compute a high-fidelity reference projected energy $E_N^{\\mathrm{ref}}$ using a very large $M_{\\mathrm{ref}}$ and no truncation $\\eta_{\\mathrm{ref}} = 0$, and then evaluate the maximum absolute deviation over a supplied grid of $(M,\\eta)$:\n$$\n\\Delta \\equiv \\max_{(M,\\eta)} \\left| E_N(M,\\eta) - E_N^{\\mathrm{ref}} \\right|.\n$$\nReturn a boolean value that is $\\,\\mathrm{True}\\,$ if $\\,\\Delta \\le \\tau\\,$ and $\\,\\mathrm{False}\\,$ otherwise, where $\\tau$ is the prescribed tolerance for that test case.\n\nAngle units must be radians. Energies are to be consistently treated in megaelectronvolts (MeV). The boolean outcomes are dimensionless.\n\nTest suite to implement:\n\n- Case $1$:\n  - Single-particle energies (MeV): $\\varepsilon = [-6.0, -3.5, -2.0, -1.0, 0.5, 1.2]$.\n  - Canonical occupations: $v^2 = [0.98, 0.90, 0.70, 0.30, 0.10, 0.02]$, with $u^2 = 1 - v^2$.\n  - Pairing strength (MeV): $G = 0.4$.\n  - Target particle number: $N = 6$.\n  - Gauge-point counts: $M \\in \\{13, 17, 25\\}$.\n  - Truncation thresholds: $\\eta \\in \\{0.0, 10^{-6}, 10^{-3}, 10^{-2}\\}$.\n  - Tolerance (MeV): $\\tau = 0.02$.\n\n- Case $2$:\n  - Single-particle energies (MeV): $\\varepsilon = [-9.0, -7.0, -5.0, -3.0, -1.0, 1.0, 3.0, 5.0, 7.0, 9.0]$.\n  - Canonical occupations: $v^2 = [0.995, 0.97, 0.90, 0.75, 0.60, 0.40, 0.25, 0.10, 0.03, 0.001]$, with $u^2 = 1 - v^2$.\n  - Pairing strength (MeV): $G = 0.5$.\n  - Target particle number: $N = 10$.\n  - Gauge-point counts: $M \\in \\{21, 33, 65\\}$.\n  - Truncation thresholds: $\\eta \\in \\{0.0, 10^{-6}, 10^{-4}, 5 \\times 10^{-3}\\}$.\n  - Tolerance (MeV): $\\tau = 0.02$.\n\n- Case $3$:\n  - Single-particle energies (MeV): $\\varepsilon = [-4.0, -2.0, -1.0, -0.2, 0.2, 1.0, 2.0, 4.0]$.\n  - Canonical occupations: $v^2 = [0.999, 0.99, 0.98, 0.6, 0.4, 0.02, 0.01, 0.001]$, with $u^2 = 1 - v^2$.\n  - Pairing strength (MeV): $G = 0.3$.\n  - Target particle number: $N = 8$.\n  - Gauge-point counts: $M \\in \\{17, 33, 65\\}$.\n  - Truncation thresholds: $\\eta \\in \\{0.0, 10^{-6}, 10^{-4}, 10^{-3}\\}$.\n  - Tolerance (MeV): $\\tau = 0.02$.\n\nReference energy computation must use $M_{\\mathrm{ref}} = 4096$ and $\\eta_{\\mathrm{ref}} = 0$, and the final projected energy must be taken as the real part of the complex ratio after discretization.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the boolean results for the three cases as a comma-separated list enclosed in square brackets (e.g., $[{\\rm True},{\\rm False},{\\rm True}]$). No other text should be printed.",
            "solution": "The problem has been analyzed and is deemed valid. It is scientifically grounded in the principles of quantum many-body theory, specifically the Bardeen–Cooper–Schrieffer (BCS) formalism and particle-number projection techniques used in computational nuclear physics. The problem is well-posed, with all necessary parameters, definitions, and constraints provided to specify a unique and computable result. The language is objective and the setup is internally consistent.\n\nThe core of the task is to compute the particle-number projected energy $E_N$ for a system described by a constant-pairing Hamiltonian $\\hat{H}$ and a BCS-type mean-field state $|\\Phi\\rangle$. The projected energy is given by the ratio of projected Hamiltonian and norm kernels:\n$$\nE_N \\equiv \\frac{\\langle \\Phi \\lvert \\hat{H} \\hat{P}_N \\rvert \\Phi \\rangle}{\\langle \\Phi \\lvert \\hat{P}_N \\rvert \\Phi \\rangle}\n$$\nThe particle-number projection operator $\\hat{P}_N$ is defined through a gauge-angle integral:\n$$\n\\hat{P}_N = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}\\varphi \\, e^{i \\varphi (N - \\hat{N})}\n$$\nSubstituting this into the expressions for the numerator and denominator yields:\n$$\n\\langle \\Phi \\lvert \\hat{P}_N \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}\\varphi \\, e^{i\\varphi N} \\langle \\Phi \\lvert e^{-i\\varphi\\hat{N}} \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\mathrm{d}\\varphi \\, e^{i\\varphi N} n(\\varphi)\n$$\n$$\n\\langle \\Phi \\lvert \\hat{H} \\hat{P}_N \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}\\varphi \\, e^{i\\varphi N} \\langle \\Phi \\lvert \\hat{H} e^{-i\\varphi\\hat{N}} \\rvert \\Phi \\rangle = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\mathrm{d}\\varphi \\, e^{i\\varphi N} h(\\varphi)\n$$\nwhere we have defined the norm kernel $n(\\varphi) \\equiv \\langle \\Phi \\lvert e^{-i\\varphi\\hat{N}} \\rvert \\Phi \\rangle$ and the Hamiltonian kernel $h(\\varphi) \\equiv \\langle \\Phi \\lvert \\hat{H} e^{-i\\varphi\\hat{N}} \\rvert \\Phi \\rangle$.\n\nThe state $|\\Phi\\rangle$ is a product of states for independent canonical pairs: $|\\Phi\\rangle = \\prod_{i=1}^\\Omega (u_i + v_i \\hat{P}_i^\\dagger) |0\\rangle = \\prod_{i=1}^\\Omega |\\phi_i\\rangle$. The number operator is also a sum of single-pair operators, $\\hat{N} = \\sum_i \\hat{N}_i$, where $\\hat{N}_i$ has eigenvalues $0$ and $2$. This separability allows the kernels to be expressed as products over the canonical levels.\n\nFirst, we derive the norm kernel $n(\\varphi)$. Due to the product structure of $|\\Phi\\rangle$ and $e^{-i\\varphi\\hat{N}}$, the kernel factorizes:\n$$\nn(\\varphi) = \\langle \\Phi \\lvert e^{-i\\varphi\\hat{N}} \\rvert \\Phi \\rangle = \\prod_{i=1}^{\\Omega} \\langle \\phi_i \\lvert e^{-i\\varphi\\hat{N}_i} \\rvert \\phi_i \\rangle\n$$\nFor a single level $i$, the matrix element is:\n$$\n\\langle \\phi_i \\lvert e^{-i\\varphi\\hat{N}_i} \\rvert \\phi_i \\rangle = \\left( u_i \\langle 0 |_i + v_i \\langle 0 |_i \\hat{P}_i \\right) e^{-i\\varphi\\hat{N}_i} \\left( u_i |0\\rangle_i + v_i \\hat{P}_i^\\dagger |0\\rangle_i \\right) = u_i^2 + v_i^2 e^{-i 2\\varphi}\n$$\nThus, the full norm kernel is:\n$$\nn(\\varphi) = \\prod_{i=1}^{\\Omega} \\left( u_i^2 + v_i^2 e^{-i 2\\varphi} \\right)\n$$\n\nNext, we derive the Hamiltonian kernel $h(\\varphi)$. The Hamiltonian consists of a single-particle part, $\\hat{H}_{\\mathrm{sp}} = \\sum_{i} 2\\varepsilon_i \\hat{N}_i$, and a pairing part, $\\hat{H}_{\\mathrm{pair}} = -G \\sum_{i,j} \\hat{P}_i^\\dagger \\hat{P}_j$. The kernel is the sum of contributions from these two parts, $h(\\varphi) = h_{\\mathrm{sp}}(\\varphi) + h_{\\mathrm{pair}}(\\varphi)$.\nIt is convenient to express $h(\\varphi)$ using the so-called transition expectation value $ \\langle \\hat{O} \\rangle_\\varphi \\equiv \\langle \\Phi | \\hat{O} | \\Phi(\\varphi) \\rangle / \\langle \\Phi | \\Phi(\\varphi) \\rangle $, where $|\\Phi(\\varphi)\\rangle \\equiv e^{-i\\varphi\\hat{N}}|\\Phi\\rangle$. Then $h(\\varphi) = n(\\varphi) \\langle \\hat{H} \\rangle_\\varphi$.\n\nFor the single-particle part:\n$$\n\\langle \\hat{H}_{\\mathrm{sp}} \\rangle_\\varphi = \\sum_{j=1}^{\\Omega} 2\\varepsilon_j \\frac{\\langle \\Phi | \\hat{N}_j | \\Phi(\\varphi) \\rangle}{n(\\varphi)} = \\sum_{j=1}^{\\Omega} 2\\varepsilon_j \\frac{\\langle \\phi_j | \\hat{N}_j | \\phi_j(\\varphi) \\rangle}{n_j(\\varphi)}\n$$\nwhere $n_j(\\varphi) = u_j^2 + v_j^2 e^{-i2\\varphi}$ and $|\\phi_j(\\varphi)\\rangle = e^{-i\\varphi\\hat{N}_j}|\\phi_j\\rangle$. The single-level matrix element $\\langle \\phi_j | \\hat{N}_j | \\phi_j(\\varphi) \\rangle$ evaluates to $2 v_j^2 e^{-i2\\varphi}$. This gives:\n$$\n\\langle \\hat{H}_{\\mathrm{sp}} \\rangle_\\varphi = \\sum_{j=1}^{\\Omega} 2\\varepsilon_j \\frac{2 v_j^2 e^{-i2\\varphi}}{u_j^2 + v_j^2 e^{-i2\\varphi}} = \\sum_{j=1}^{\\Omega} \\frac{4 \\varepsilon_j v_j^2 e^{-i2\\varphi}}{u_j^2 + v_j^2 e^{-i2\\varphi}}\n$$\nFor the pairing part, the structure of the interaction and the BCS state allows for factorization via the generalized Wick theorem:\n$$\n\\langle \\hat{H}_{\\mathrm{pair}} \\rangle_\\varphi = -G \\left\\langle \\sum_i \\hat{P}_i^\\dagger \\right\\rangle_\\varphi \\left\\langle \\sum_j \\hat{P}_j \\right\\rangle_\\varphi\n$$\nwhere the transition expectation values of the pair creation and annihilation operators are:\n$$\n\\left\\langle \\hat{P}_j^\\dagger \\right\\rangle_\\varphi = \\frac{\\langle \\phi_j | \\hat{P}_j^\\dagger | \\phi_j(\\varphi) \\rangle}{n_j(\\varphi)} = \\frac{u_j v_j}{u_j^2 + v_j^2 e^{-i2\\varphi}}\n$$\n$$\n\\left\\langle \\hat{P}_j \\right\\rangle_\\varphi = \\frac{\\langle \\phi_j | \\hat{P}_j | \\phi_j(\\varphi) \\rangle}{n_j(\\varphi)} = \\frac{u_j v_j e^{-i2\\varphi}}{u_j^2 + v_j^2 e^{-i2\\varphi}}\n$$\nCombining these results yields the full Hamiltonian kernel:\n$$\nh(\\varphi) = n(\\varphi) \\left[ \\sum_j \\frac{4 \\varepsilon_j v_j^2 e^{-i 2\\varphi}}{u_j^2 + v_j^2 e^{-i 2\\varphi}} - G \\left( \\sum_j \\frac{u_j v_j}{u_j^2 + v_j^2 e^{-i 2\\varphi}} \\right) \\left( \\sum_k \\frac{u_k v_k e^{-i 2\\varphi}}{u_k^2 + v_k^2 e^{-i 2\\varphi}} \\right) \\right]\n$$\n\nThe numerical procedure involves two main components:\n$1$. **Discretization**: The gauge-angle integral is approximated by a sum over $M$ equidistant points $\\varphi_k = 2\\pi k/M$ for $k=0,\\dots,M-1$. The integral $\\frac{1}{2\\pi} \\int_0^{2\\pi} (\\dots) \\mathrm{d}\\varphi$ becomes $\\frac{1}{M} \\sum_{k=0}^{M-1} (\\dots)$. The projected energy is then:\n$$\nE_N(M, \\eta) \\approx \\mathrm{Re}\\left[ \\frac{\\sum_{k=0}^{M-1} e^{i\\varphi_k N} h(\\varphi_k)}{\\sum_{k=0}^{M-1} e^{i\\varphi_k N} n(\\varphi_k)} \\right]\n$$\nThe real part is taken as specified in the problem statement.\n\n$2$. **Truncation**: The canonical space is truncated by including only levels $i$ for which the occupation probability $v_i^2$ is greater than or equal to a threshold $\\eta$. In the formulas for $n(\\varphi)$ and $h(\\varphi)$, all sums and products over level indices $i, j, k$ are restricted to this active set of levels.\n\nThe convergence analysis algorithm proceeds as follows:\n$1$. For each test case, a high-fidelity reference energy $E_N^{\\mathrm{ref}}$ is computed using a large number of gauge points ($M_{\\mathrm{ref}} = 4096$) and no truncation ($\\eta_{\\mathrm{ref}} = 0$).\n$2$. For each pair of numerical controls $(M, \\eta)$ from the specified test grid, the projected energy $E_N(M, \\eta)$ is calculated.\n$3$. The absolute deviation from the reference, $|E_N(M, \\eta) - E_N^{\\mathrm{ref}}|$, is computed for each pair.\n$4$. The maximum deviation $\\Delta$ is found over the entire grid: $\\Delta = \\max_{(M,\\eta)} |E_N(M, \\eta) - E_N^{\\mathrm{ref}}|$.\n$5$. This maximum deviation is compared to the prescribed tolerance $\\tau$. The result is True if $\\Delta \\le \\tau$ and False otherwise.\n\nThis structured procedure reliably assesses the numerical convergence of the projected energy.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_projected_energy(M, eta, eps, v2, G, N):\n    \"\"\"\n    Calculates the particle-number projected energy.\n\n    Args:\n        M (int): Number of gauge-angle points.\n        eta (float): Truncation threshold for canonical occupations.\n        eps (np.ndarray): Array of single-particle energies.\n        v2 (np.ndarray): Array of canonical occupations.\n        G (float): Pairing strength.\n        N (int): Target particle number.\n\n    Returns:\n        float: The real part of the projected energy.\n    \"\"\"\n    # 1. Apply canonical-space truncation\n    indices = np.where(v2 >= eta)[0]\n    \n    # Handle the case where no levels remain after truncation\n    if len(indices) == 0:\n        if N == 0:\n            return 0.0  # Energy of the vacuum\n        else:\n            # Projection onto N > 0 from vacuum is zero, resulting in 0/0.\n            return np.nan\n\n    active_eps = eps[indices]\n    active_v2 = v2[indices]\n    active_u2 = 1.0 - active_v2\n    active_u = np.sqrt(active_u2)\n    active_v = np.sqrt(active_v2)\n    \n    # 2. Set up gauge-angle grid and integrands\n    phi_k = 2 * np.pi * np.arange(M) / M\n    \n    # Complex-valued sums for numerator and denominator of E_N\n    projected_norm_sum = 0.0 + 0.0j\n    projected_hamiltonian_sum = 0.0 + 0.0j\n    \n    # 3. Loop over gauge angles and compute kernels\n    for phi in phi_k:\n        # Complex phase factor for rotation\n        z = np.exp(-2j * phi)\n        \n        # Per-level factors for kernels\n        n_i_phi = active_u2 + active_v2 * z\n        \n        # Avoid division by zero if n_i_phi is close to zero\n        # This is unlikely for physical parameters but is good practice.\n        if np.any(np.abs(n_i_phi) < 1e-15):\n            continue\n\n        # Norm kernel n(phi)\n        n_phi = np.prod(n_i_phi)\n        \n        # Hamiltonian kernel h(phi): h(phi) = n(phi) * <H>_phi\n        # Single-particle part\n        term_sp = np.sum(4 * active_eps * active_v2 * z / n_i_phi)\n        \n        # Pairing part\n        S1 = np.sum(active_u * active_v / n_i_phi)\n        S2 = np.sum(active_u * active_v * z / n_i_phi)\n        term_pair = -G * S1 * S2\n        \n        h_phi = n_phi * (term_sp + term_pair)\n        \n        # Projection phase factor e^(i*phi*N)\n        phase = np.exp(1j * phi * N)\n        \n        # Accumulate the sums for the discretized integral\n        projected_norm_sum += phase * n_phi\n        projected_hamiltonian_sum += phase * h_phi\n        \n    # 4. Compute final projected energy\n    if np.abs(projected_norm_sum) < 1e-15:\n        # This implies the projected norm is zero, which means the state with N particles\n        # is not present in the mean-field state. E_N is ill-defined.\n        return np.nan\n        \n    energy = (projected_hamiltonian_sum / projected_norm_sum).real\n    return energy\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and evaluate convergence.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            \"eps\": np.array([-6.0, -3.5, -2.0, -1.0, 0.5, 1.2]),\n            \"v2\": np.array([0.98, 0.90, 0.70, 0.30, 0.10, 0.02]),\n            \"G\": 0.4,\n            \"N\": 6,\n            \"M_grid\": [13, 17, 25],\n            \"eta_grid\": [0.0, 1e-6, 1e-3, 1e-2],\n            \"tau\": 0.02\n        },\n        # Case 2\n        {\n            \"eps\": np.array([-9.0, -7.0, -5.0, -3.0, -1.0, 1.0, 3.0, 5.0, 7.0, 9.0]),\n            \"v2\": np.array([0.995, 0.97, 0.90, 0.75, 0.60, 0.40, 0.25, 0.10, 0.03, 0.001]),\n            \"G\": 0.5,\n            \"N\": 10,\n            \"M_grid\": [21, 33, 65],\n            \"eta_grid\": [0.0, 1e-6, 1e-4, 5e-3],\n            \"tau\": 0.02\n        },\n        # Case 3\n        {\n            \"eps\": np.array([-4.0, -2.0, -1.0, -0.2, 0.2, 1.0, 2.0, 4.0]),\n            \"v2\": np.array([0.999, 0.99, 0.98, 0.6, 0.4, 0.02, 0.01, 0.001]),\n            \"G\": 0.3,\n            \"N\": 8,\n            \"M_grid\": [17, 33, 65],\n            \"eta_grid\": [0.0, 1e-6, 1e-4, 1e-3],\n            \"tau\": 0.02\n        }\n    ]\n    \n    M_ref = 4096\n    eta_ref = 0.0\n    results = []\n\n    for case in test_cases:\n        # Calculate the high-fidelity reference energy\n        E_ref = calculate_projected_energy(\n            M_ref, eta_ref,\n            case[\"eps\"], case[\"v2\"], case[\"G\"], case[\"N\"]\n        )\n        \n        max_deviation = 0.0\n        # Iterate over the grid of numerical controls (M, eta)\n        for M in case[\"M_grid\"]:\n            for eta in case[\"eta_grid\"]:\n                E = calculate_projected_energy(\n                    M, eta,\n                    case[\"eps\"], case[\"v2\"], case[\"G\"], case[\"N\"]\n                )\n                deviation = np.abs(E - E_ref)\n                if deviation > max_deviation:\n                    max_deviation = deviation\n        \n        # Check if the maximum deviation is within the tolerance\n        results.append(max_deviation <= case[\"tau\"])\n\n    # Format the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}