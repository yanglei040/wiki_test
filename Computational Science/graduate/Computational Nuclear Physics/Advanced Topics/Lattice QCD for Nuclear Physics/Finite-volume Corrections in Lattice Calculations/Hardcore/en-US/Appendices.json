{
    "hands_on_practices": [
        {
            "introduction": "A foundational practice in understanding finite-volume effects is to compute the corrections to a particle's mass or binding energy. This exercise guides you through the process of calculating and distinguishing the two most common types of corrections: power-law shifts arising from massless particle exchange (electromagnetism) and exponentially suppressed shifts from massive particle exchange (the strong interaction) . By implementing both an Ewald sum for the Coulomb potential and an image-sum method for a Yukawa potential, you will gain hands-on experience with the distinct mathematical and computational techniques required for each and observe their different scaling behaviors with the volume size $L$.",
            "id": "3559421",
            "problem": "Consider a non-relativistic two-nucleon bound state (the deuteron) placed in a finite cubic spatial volume of side length $L$ with periodic boundary conditions. The long-range electromagnetic interaction is included through Non-Relativistic Quantum Electrodynamics in finite volume (NRQED$_L$), defined as Non-Relativistic Quantum Electrodynamics (NRQED) with the spatial zero mode of the photon field removed to avoid infrared divergences. The strong interaction tail is modeled by a Yukawa potential controlled by the pion mass. The task is to quantitatively isolate and compare the finite-volume effects that scale as $1/L$ (from the electromagnetic Coulomb tail) with exponentially suppressed effects that scale like $\\mathrm{e}^{-m_\\pi L}$ (from the strong interaction tail), using physically sound approximations and numerical evaluation of convergent sums and integrals.\n\nFundamental bases and definitions to be used:\n- The non-relativistic deuteron binding energy in infinite volume is $B_0$ (in $\\mathrm{MeV}$). The reduced mass of the proton-neutron system is $\\mu = \\dfrac{m_p m_n}{m_p + m_n}$ (in $\\mathrm{MeV}$), where $m_p$ is the proton mass and $m_n$ is the neutron mass. The asymptotic binding momentum is $\\,\\gamma = \\dfrac{\\sqrt{2 \\mu B_0}}{\\hbar c}\\,$ (in $\\mathrm{fm}^{-1}$), with $\\hbar c$ the product of the reduced Planck constant and the speed of light, expressed as $\\hbar c = 197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}$.\n- The long-range tail of the strong interaction is modeled by a Yukawa potential with pion mass $m_\\pi$ (in $\\mathrm{MeV}$), which, in coordinate space, is $\\,V_Y(r) = - C_Y \\,\\dfrac{\\hbar c}{4\\pi}\\,\\dfrac{\\mathrm{e}^{-\\mu_\\pi r}}{r}\\,$ (in $\\mathrm{MeV}$), where $\\,\\mu_\\pi = \\dfrac{m_\\pi}{\\hbar c}\\,$ (in $\\mathrm{fm}^{-1}$), $\\,C_Y\\,$ is a dimensionless coupling constant, and $\\,r\\,$ is in $\\mathrm{fm}$.\n- The electromagnetic Coulomb kernel in three dimensions is the Green's function $\\,G_C(\\boldsymbol{r}) = \\dfrac{1}{4\\pi r}\\,$, whose finite-volume modification under periodic boundary conditions with zero-mode removal can be handled by Ewald splitting. Let $\\,\\eta > 0\\,$ be the splitting parameter. Introducing integer triplets $\\,\\boldsymbol{n} = (n_x,n_y,n_z)\\,$ for the direct lattice and $\\,\\boldsymbol{m} = (m_x,m_y,m_z)\\,$ for the reciprocal lattice, with $\\,r_{\\boldsymbol{n}} = \\|\\boldsymbol{n}\\|\\,$ and $\\,m_{\\boldsymbol{m}} = \\|\\boldsymbol{m}\\|\\,$, the dimensionless Ewald-sum constant\n$$\nc(\\eta) \\equiv \\sum_{\\boldsymbol{n}\\neq \\mathbf{0}} \\frac{\\operatorname{erfc}\\!\\left(\\sqrt{\\eta}\\, r_{\\boldsymbol{n}}\\right)}{r_{\\boldsymbol{n}}}\n\\;+\\;\n\\frac{1}{\\pi}\\sum_{\\boldsymbol{m}\\neq \\mathbf{0}} \\frac{\\exp\\!\\left(-\\frac{\\pi^2\\, m_{\\boldsymbol{m}}^2}{\\eta}\\right)}{m_{\\boldsymbol{m}}^2}\n\\;-\\;\n\\frac{2\\sqrt{\\eta}}{\\sqrt{\\pi}}\n$$\nis independent of $L$ when the sums are performed to convergence, and governs the leading $1/L$ finite-volume energy shift for a point-like charged particle in NRQED$_L$.\n\nYou must derive and implement the following steps and quantities:\n\n1. Electromagnetic $1/L$ Coulomb-tail energy shift for the deuteron:\n   - Treat the deuteron as a charged state with net charge $q=+1$. The leading electromagnetic finite-volume energy shift of a localized charged state in NRQED$_L$ is controlled by the Ewald-sum constant $c(\\eta)$ and scales as $1/L$. From the definition of $c(\\eta)$, show algorithmically how to evaluate the dimensionless constant numerically by truncating the lattice sums (to maintain computational feasibility while ensuring convergence), and then compute\n   $$\n   \\Delta E_{\\mathrm{EM}}(L) = \\frac{q^2\\,\\alpha\\,\\hbar c}{2\\,L}\\; c(\\eta)\n   $$\n   in $\\mathrm{MeV}$, where $\\alpha$ is the fine-structure constant. You must not assume or use any pre-tabulated value of $c(\\eta)$; instead, compute it from first principles via the above definition.\n\n2. Strong-interaction $\\mathrm{e}^{-m_\\pi L}$ tail using method of images and the asymptotic bound-state wavefunction:\n   - Use the normalized $s$-wave asymptotic deuteron wavefunction $\\,\\psi(r) = \\sqrt{\\dfrac{\\gamma}{2\\pi}}\\,\\dfrac{\\mathrm{e}^{-\\gamma r}}{r}\\,$ to approximate the probability density at long distances. The leading strong finite-volume shift can be estimated by the expectation value of the Yukawa tail from periodic images at positions $\\,\\boldsymbol{R}_{\\boldsymbol{n}} = L\\,\\boldsymbol{n}\\,$, $\\,\\boldsymbol{n}\\neq \\mathbf{0}$. For a given shell at distance $R = \\|\\boldsymbol{R}_{\\boldsymbol{n}}\\|$, using the spherical angle average identity\n   $$\n   \\left\\langle \\frac{\\mathrm{e}^{-\\mu_\\pi |\\boldsymbol{r}-\\boldsymbol{R}|}}{|\\boldsymbol{r}-\\boldsymbol{R}|} \\right\\rangle_{\\Omega} \\;=\\; \\frac{\\sinh\\!\\left(\\mu_\\pi\\, r_<\\right)}{\\mu_\\pi\\, r_<}\\;\\frac{\\mathrm{e}^{-\\mu_\\pi\\, r_>}}{r_>}\n   \\quad\\text{with}\\quad\n   r_< = \\min(r,R),\\; r_> = \\max(r,R),\n   $$\n   derive the radial integrals that enter the energy shift from one image:\n   $$\n   I_1(R) = \\frac{\\mathrm{e}^{-\\mu_\\pi R}}{R} \\int_0^R \\! 2\\gamma\\, \\mathrm{e}^{-2\\gamma r}\\, \\frac{\\sinh(\\mu_\\pi r)}{\\mu_\\pi r}\\, \\mathrm{d}r,\n   \\qquad\n   I_2(R) = \\frac{\\sinh(\\mu_\\pi R)}{\\mu_\\pi R} \\int_R^\\infty \\! 2\\gamma\\, \\frac{\\mathrm{e}^{-(2\\gamma+\\mu_\\pi) r}}{r}\\, \\mathrm{d}r.\n   $$\n   Explain how to evaluate $I_1(R)$ numerically using standard quadrature and show that $I_2(R)$ can be evaluated in closed form using the exponential integral $\\,E_1(x) = \\int_x^\\infty \\frac{e^{-t}}{t}\\,dt\\,$ via the change of variables $\\,t = (2\\gamma + \\mu_\\pi)\\,r\\,$. Then compute the strong-image sum\n   $$\n   \\Delta E_{\\mathrm{strong}}(L) \\;=\\; -C_Y \\frac{\\hbar c}{4\\pi} \\sum_{\\boldsymbol{n}\\neq \\mathbf{0}} \\left[ I_1\\!\\left(L\\|\\boldsymbol{n}\\|\\right) + I_2\\!\\left(L\\|\\boldsymbol{n}\\|\\right) \\right]\n   $$\n   in $\\mathrm{MeV}$. Truncate the image sum to a small cube of shells $\\,\\|\\boldsymbol{n}\\|\\le N_{\\mathrm{img}}\\,$ and argue the exponential suppression justifies the truncation.\n\n3. Magnetic property coefficient controlled by the same long-range Coulomb kernel:\n   - Many NRQED$_L$ operator renormalizations that are governed by the long-range Coulomb kernel at leading order share the same universal $1/L$ coefficient $\\,c(\\eta)\\,$. Define the dimensionless quantity\n   $$\n   S_{\\mathrm{mag}}(L;\\eta) \\equiv c(\\eta),\n   $$\n   computed from the same Ewald sums, to represent the leading finite-volume coefficient that would multiply $\\,\\alpha / L\\,$ in a magnetic operator’s renormalization (for example, the Pauli term). Demonstrate numerically that $\\,S_{\\mathrm{mag}}\\,$ is independent of $\\,L\\,$ once the sums are converged.\n\nScientific and numerical requirements:\n- Use only the above fundamental bases and definitions. Do not use any shortcut formula that directly gives the final finite-volume coefficients without derivation from sums or integrals.\n- Physical and numerical units must be consistent: report energy shifts in $\\mathrm{MeV}$ and lengths in $\\mathrm{fm}$. Angles are not used. Dimensionless quantities (like $\\,S_{\\mathrm{mag}}\\,$) need no units.\n- Provide a test suite comprising four cases with varied $L$ values to explore regimes where the $1/L$ electromagnetic tail dominates and where the $\\mathrm{e}^{-m_\\pi L}$ strong tail is visible. Use the following parameters for all tests unless specified in a case:\n  - $\\,\\alpha = 1/137.035999084\\,$,\n  - $\\,\\hbar c = 197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}\\,$,\n  - $\\,q = +1\\,$,\n  - $\\,m_p = 938.2720813\\,\\mathrm{MeV}\\,$,\n  - $\\,m_n = 939.5654133\\,\\mathrm{MeV}\\,$,\n  - $\\,B_0 = 2.224575\\,\\mathrm{MeV}\\,$,\n  - $\\,m_\\pi = 138.0\\,\\mathrm{MeV}\\,$,\n  - $\\,C_Y = 0.30\\,$,\n  - Ewald parameter $\\,\\eta = 2.0\\,$,\n  - Coulomb Ewald truncation $\\,N_{\\mathrm{Ewald}} = 6\\,$ (include all integer lattice vectors $\\,\\boldsymbol{n}\\,$ and $\\,\\boldsymbol{m}\\,$ with components in $[-6,6]$ excluding the origin),\n  - Strong-image truncation $\\,N_{\\mathrm{img}} = 2\\,$.\n- The four test cases:\n  1. $\\,L = 8.0\\,\\mathrm{fm}\\,$,\n  2. $\\,L = 12.0\\,\\mathrm{fm}\\,$,\n  3. $\\,L = 20.0\\,\\mathrm{fm}\\,$,\n  4. $\\,L = 40.0\\,\\mathrm{fm}\\,$.\n- For each test case, compute and return a list $[\\Delta E_{\\mathrm{EM}}(L), \\Delta E_{\\mathrm{strong}}(L), S_{\\mathrm{mag}}(L;\\eta)]$ where the first two entries are floats in $\\mathrm{MeV}$ and the last entry is a dimensionless float. Your program should produce a single line of output containing the results for all test cases as a comma-separated list of these lists enclosed in square brackets (e.g., \"[[...],[...],[...],[...]]\").\n\nYour derivations should start from the stated bases, explain why each term scales as it does, and describe the numerical algorithms you implement to evaluate the sums and integrals reliably and efficiently with the given truncations.",
            "solution": "The user has provided a well-posed problem in computational nuclear physics. The problem is scientifically grounded, requires the application of standard methods for computing finite-volume corrections, and all necessary parameters and definitions are provided. The problem is declared **valid**.\n\nThe solution proceeds in three stages as specified:\n1.  Computation of the leading electromagnetic finite-volume energy shift, $\\Delta E_{\\mathrm{EM}}(L)$, which scales as $1/L$.\n2.  Computation of the leading strong-interaction finite-volume energy shift, $\\Delta E_{\\mathrm{strong}}(L)$, which is exponentially suppressed with scale $\\mathrm{e}^{-m_\\pi L}$.\n3.  Computation of the universal coefficient $S_{\\mathrm{mag}}$, which is identical to the Ewald constant $c(\\eta)$.\n\nFirst, we define and calculate several key physical parameters from the givens:\n- Fine-structure constant: $\\alpha = 1/137.035999084$\n- Reduced Planck constant-speed of light product: $\\hbar c = 197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}$\n- Proton mass: $m_p = 938.2720813\\,\\mathrm{MeV}$\n- Neutron mass: $m_n = 939.5654133\\,\\mathrm{MeV}$\n- Deuteron binding energy: $B_0 = 2.224575\\,\\mathrm{MeV}$\n- Pion mass: $m_\\pi = 138.0\\,\\mathrm{MeV}$\n\nFrom these, we derive:\n- The reduced mass of the two-nucleon system:\n$$\n\\mu = \\frac{m_p m_n}{m_p + m_n} = \\frac{(938.2720813\\,\\mathrm{MeV})(939.5654133\\,\\mathrm{MeV})}{938.2720813\\,\\mathrm{MeV} + 939.5654133\\,\\mathrm{MeV}} \\approx 469.459415\\,\\mathrm{MeV}\n$$\n- The asymptotic binding momentum $\\gamma$:\n$$\n\\gamma = \\frac{\\sqrt{2 \\mu B_0}}{\\hbar c} = \\frac{\\sqrt{2 (469.459415\\,\\mathrm{MeV})(2.224575\\,\\mathrm{MeV})}}{197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}} \\approx 0.231597\\,\\mathrm{fm}^{-1}\n$$\n- The momentum scale associated with the pion mass, $\\mu_\\pi$:\n$$\n\\mu_\\pi = \\frac{m_\\pi}{\\hbar c} = \\frac{138.0\\,\\mathrm{MeV}}{197.3269804\\,\\mathrm{MeV}\\cdot\\mathrm{fm}} \\approx 0.699343\\,\\mathrm{fm}^{-1}\n$$\n\n### 1. Electromagnetic $1/L$ Coulomb-tail Energy Shift\n\nThe leading electromagnetic finite-volume energy shift for a point-like charge $+q$ in a periodic volume with the photon zero-mode removed is given by:\n$$\n\\Delta E_{\\mathrm{EM}}(L) = \\frac{q^2\\,\\alpha\\,\\hbar c}{2\\,L}\\; c(\\eta)\n$$\nThis $1/L$ scaling is characteristic of a massless force carrier (the photon). The core of this calculation is the numerical evaluation of the dimensionless Ewald constant $c(\\eta)$:\n$$\nc(\\eta) \\equiv \\sum_{\\mathbf{n}\\neq \\mathbf{0}} \\frac{\\operatorname{erfc}\\!\\left(\\sqrt{\\eta}\\, r_{\\mathbf{n}}\\right)}{r_{\\mathbf{n}}}\n\\;+\\;\n\\frac{1}{\\pi}\\sum_{\\mathbf{m}\\neq \\mathbf{0}} \\frac{\\exp\\!\\left(-\\frac{\\pi^2\\, m_{\\mathbf{m}}^2}{\\eta}\\right)}{m_{\\mathbf{m}}^2}\n\\;-\\;\n\\frac{2\\sqrt{\\eta}}{\\sqrt{\\pi}}\n$$\nwhere $\\mathbf{n}=(n_x, n_y, n_z)$ and $\\mathbf{m}=(m_x, m_y, m_z)$ are vectors of integers, and $r_{\\mathbf{n}}=\\|\\mathbf{n}\\|$, $m_{\\mathbf{m}}=\\|\\mathbf{m}\\|$. The parameter $\\eta$ partitions the sum into a rapidly converging direct-space sum (via the complementary error function, $\\operatorname{erfc}$) and a rapidly converging reciprocal-space sum. The result for $c(\\eta)$ is independent of $\\eta$.\n\nTo compute $c(\\eta)$ numerically with $\\eta=2.0$, we truncate the sums. The problem specifies including all integer vectors where each component lies in $[-N_{\\mathrm{Ewald}}, N_{\\mathrm{Ewald}}] = [-6, 6]$, excluding the zero vector $\\mathbf{0}=(0,0,0)$. The algorithm is as follows:\n1. Initialize two sums, $S_n = 0$ and $S_m = 0$.\n2. Loop through a cubic grid of integers $i, j, k$ from $-6$ to $6$.\n3. For each triplet $(i,j,k)$, if it is not $(0,0,0)$:\n   a. Calculate the squared magnitude $d^2 = i^2 + j^2 + k^2$ and magnitude $d = \\sqrt{d^2}$.\n   b. Add $\\operatorname{erfc}(\\sqrt{\\eta} d) / d$ to $S_n$.\n   c. Add $\\exp(-\\pi^2 d^2 / \\eta) / d^2$ to $S_m$.\n4. Compute the final constant as $c(\\eta) = S_n + S_m/\\pi - 2\\sqrt{\\eta}/\\sqrt{\\pi}$.\nThis value is then used to compute $\\Delta E_{\\mathrm{EM}}(L)$ for each given value of $L$.\n\n### 2. Strong-interaction $\\mathrm{e}^{-m_\\pi L}$ Tail Energy Shift\n\nThe leading finite-volume correction from the strong force arises from the exponentially decaying tail of the nuclear potential, modeled here by a Yukawa potential $V_Y$. The shift is estimated as the expectation value of the potential from all periodic images of the deuteron interacting with the original deuteron centered at the origin.\n$$\n\\Delta E_{\\mathrm{strong}}(L) \\approx \\sum_{\\mathbf{n}\\neq \\mathbf{0}} \\langle \\psi | V_Y(|\\mathbf{r}-\\mathbf{R}_{\\mathbf{n}}|) | \\psi \\rangle\n$$\nwhere $\\mathbf{R}_{\\mathbf{n}}=L\\mathbf{n}$ are the positions of the images. The s-wave asymptotic deuteron wavefunction is $\\psi(r) = \\sqrt{\\gamma/(2\\pi)} \\mathrm{e}^{-\\gamma r}/r$. The probability density integrated over angles for a radial shell is $4\\pi r^2 |\\psi(r)|^2 \\mathrm{d}r = 2\\gamma \\mathrm{e}^{-2\\gamma r} \\mathrm{d}r$.\n\nThe expectation value for a single image at a distance $R = |\\mathbf{R}_{\\mathbf{n}}|$ involves an integral over the deuteron's volume, which, after averaging over solid angles $\\Omega$, becomes a radial integral. The potential from the image is $V_Y(|\\mathbf{r}-\\mathbf{R}|) = -C_Y \\frac{\\hbar c}{4\\pi} \\frac{\\mathrm{e}^{-\\mu_\\pi |\\mathbf{r}-\\mathbf{R}|}}{|\\mathbf{r}-\\mathbf{R}|}$. Using the provided identity for the angle average, the contribution from one image is:\n$$\n\\langle V_Y(R) \\rangle = \\int_0^\\infty 2\\gamma \\mathrm{e}^{-2\\gamma r} \\left( -C_Y \\frac{\\hbar c}{4\\pi} \\right) \\left\\langle \\frac{\\mathrm{e}^{-\\mu_\\pi |\\mathbf{r}-\\mathbf{R}|}}{|\\mathbf{r}-\\mathbf{R}|} \\right\\rangle_{\\Omega} \\mathrm{d}r\n$$\n$$\n\\langle V_Y(R) \\rangle = -C_Y \\frac{\\hbar c}{4\\pi} \\int_0^\\infty 2\\gamma \\mathrm{e}^{-2\\gamma r} \\left( \\frac{\\sinh(\\mu_\\pi r_<)}{\\mu_\\pi r_<} \\frac{\\mathrm{e}^{-\\mu_\\pi r_>}}{r_>} \\right) \\mathrm{d}r\n$$\nwhere $r_<=\\min(r,R)$ and $r_>=\\max(r,R)$. Splitting the integral at $r=R$ yields the terms corresponding to the definitions of $I_1(R)$ and $I_2(R)$ provided in the problem. The total strong shift $\\Delta E_{\\mathrm{strong}}(L)$ is then the sum of these contributions over all image shells.\n\nThe evaluation of the integrals is as follows:\n- **$I_1(R)$**: The integrand $2\\gamma \\mathrm{e}^{-2\\gamma r} \\sinh(\\mu_\\pi r)/(\\mu_\\pi r)$ is well-behaved, with the limit at $r=0$ being $2\\gamma$. This definite integral can be computed using standard numerical quadrature routines, such as `scipy.integrate.quad`.\n- **$I_2(R)$**: The integral component is $\\int_R^\\infty 2\\gamma \\frac{\\mathrm{e}^{-(2\\gamma+\\mu_\\pi) r}}{r} \\mathrm{d}r$. Let $k = 2\\gamma+\\mu_\\pi$ and substitute $t=kr$. Then $\\mathrm{d}t=k\\mathrm{d}r$. The integral becomes $2\\gamma \\int_{kR}^\\infty \\frac{\\mathrm{e}^{-t}}{t/k} \\frac{\\mathrm{d}t}{k} = 2\\gamma \\int_{kR}^\\infty \\frac{\\mathrm{e}^{-t}}{t} \\mathrm{d}t$. This is precisely the definition of the exponential integral $E_1(x)$, so the integral evaluates to $2\\gamma E_1((2\\gamma+\\mu_\\pi)R)$, which is computed using `scipy.special.exp1`.\n\nThe total strong shift $\\Delta E_{\\mathrm{strong}}(L)$ is then a sum over image shells, truncated at vectors with components in $[-N_{\\mathrm{img}}, N_{\\mathrm{img}}] = [-2,2]$. This truncation is justified because the contribution from each image at distance $R$ is exponentially suppressed, scaling roughly as $\\mathrm{e}^{-\\mu_\\pi R}$. Contributions from farther images ($R=L\\sqrt{2}, L\\sqrt{3}, \\ldots$) are therefore negligible compared to the nearest images ($R=L$), especially for large $L$. The sum is performed by finding all unique squared norms $\\|\\mathbf{n}\\|^2$ for the specified range, counting their multiplicities, and summing the contributions.\n\n### 3. Magnetic Property Coefficient $S_{\\mathrm{mag}}(L;\\eta)$\n\nThe problem defines $S_{\\mathrm{mag}}(L;\\eta) \\equiv c(\\eta)$. This reflects a general principle in effective field theories where different observables can have finite-volume corrections governed by the same universal, long-range geometric coefficients. Since the Ewald constant $c(\\eta)$ is computed from sums over dimensionless lattice vectors and is independent of the box size $L$, $S_{\\mathrm{mag}}$ will also be independent of $L$. Our calculation will verify this by computing $c(\\eta)$ once and reporting the same value for all four test cases.\n\nThe numerical implementation will use the specified values for physical constants and computational parameters to evaluate $[\\Delta E_{\\mathrm{EM}}(L), \\Delta E_{\\mathrm{strong}}(L), S_{\\mathrm{mag}}(L;\\eta)]$ for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special, integrate\n\ndef solve():\n    \"\"\"\n    Solves the finite-volume corrections problem for the deuteron.\n    \"\"\"\n    # Define physical and numerical parameters from the problem statement.\n    alpha = 1 / 137.035999084\n    hbar_c = 197.3269804  # MeV*fm\n    q = 1.0\n    m_p = 938.2720813    # MeV\n    m_n = 939.5654133    # MeV\n    B0 = 2.224575        # MeV\n    m_pi = 138.0         # MeV\n    C_Y = 0.30\n    eta = 2.0\n    N_Ewald = 6\n    N_img = 2\n\n    # Test cases for L (in fm)\n    test_cases = [8.0, 12.0, 20.0, 40.0]\n\n    # --- Pre-calculate derived constants ---\n    mu_mass = (m_p * m_n) / (m_p + m_n)\n    gamma = np.sqrt(2 * mu_mass * B0) / hbar_c  # fm^-1\n    mu_pi = m_pi / hbar_c                      # fm^-1\n\n    # --- Stage 1 & 3: Ewald constant c(eta) for EM shift and S_mag ---\n    def compute_c_eta(p_eta, p_N_ewald):\n        \"\"\"\n        Computes the dimensionless Ewald sum constant c(eta).\n        \"\"\"\n        s_n_sum = 0.0\n        s_m_sum = 0.0\n        \n        # Iterate over a cubic grid of integers\n        for nx in range(-p_N_ewald, p_N_ewald + 1):\n            for ny in range(-p_N_ewald, p_N_ewald + 1):\n                for nz in range(-p_N_ewald, p_N_ewald + 1):\n                    if nx == 0 and ny == 0 and nz == 0:\n                        continue\n                    \n                    d_sq = float(nx**2 + ny**2 + nz**2)\n                    d = np.sqrt(d_sq)\n                    \n                    # Direct lattice sum part\n                    s_n_sum += special.erfc(np.sqrt(p_eta) * d) / d\n                    \n                    # Reciprocal lattice sum part\n                    s_m_sum += np.exp(-np.pi**2 * d_sq / p_eta) / d_sq\n        \n        c = s_n_sum + (1.0 / np.pi) * s_m_sum - (2.0 * np.sqrt(p_eta) / np.sqrt(np.pi))\n        return c\n\n    c_eta_val = compute_c_eta(eta, N_Ewald)\n    s_mag = c_eta_val # By definition in the problem\n\n    # --- Stage 2: Strong interaction shift ---\n\n    def e_strong_integrand(r, local_gamma, local_mu_pi):\n        \"\"\"Integrand for the I_1 integral.\"\"\"\n        if r == 0:\n            return 2.0 * local_gamma\n        return 2.0 * local_gamma * np.exp(-2.0 * local_gamma * r) * np.sinh(local_mu_pi * r) / (local_mu_pi * r)\n\n    def compute_i1_plus_i2(R, local_gamma, local_mu_pi):\n        \"\"\"Computes I_1(R) + I_2(R).\"\"\"\n        # I_1(R) calculation\n        integral_i1, _ = integrate.quad(e_strong_integrand, 0, R, args=(local_gamma, local_mu_pi))\n        i1 = (np.exp(-local_mu_pi * R) / R) * integral_i1\n        \n        # I_2(R) calculation\n        k = 2.0 * local_gamma + local_mu_pi\n        integral_i2 = 2.0 * local_gamma * special.exp1(k * R)\n        \n        # Guard against R=0 case for sinh(x)/x\n        if R == 0:\n            sinh_term = 1.0\n        else:\n            sinh_term = np.sinh(local_mu_pi * R) / (local_mu_pi * R)\n\n        i2 = sinh_term * integral_i2\n        \n        return i1 + i2\n\n    # Pre-compute multiplicities of image shells up to N_img\n    shell_multiplicities = {}\n    for nx in range(-N_img, N_img + 1):\n        for ny in range(-N_img, N_img + 1):\n            for nz in range(-N_img, N_img + 1):\n                if nx == 0 and ny == 0 and nz == 0:\n                    continue\n                norm_sq = nx**2 + ny**2 + nz**2\n                shell_multiplicities[norm_sq] = shell_multiplicities.get(norm_sq, 0) + 1\n\n    unique_shells = sorted(shell_multiplicities.keys())\n\n    # --- Main calculation loop for each test case ---\n    results = []\n    for L in test_cases:\n        # Calculate EM shift\n        delta_e_em = (q**2 * alpha * hbar_c / (2.0 * L)) * c_eta_val\n        \n        # Calculate strong shift\n        sum_i_total = 0.0\n        for norm_sq in unique_shells:\n            R = L * np.sqrt(norm_sq)\n            multiplicity = shell_multiplicities[norm_sq]\n            sum_i_total += multiplicity * compute_i1_plus_i2(R, gamma, mu_pi)\n\n        # Apply the corrected formula including the 1/(4*pi) factor.\n        delta_e_strong = -C_Y * hbar_c / (4 * np.pi) * sum_i_total\n        \n        results.append([delta_e_em, delta_e_strong, s_mag])\n\n    # Final print statement in the exact required format.\n    # Using a more robust formatting to avoid scientific notation issues with str()\n    formatted_results = []\n    for res_list in results:\n        formatted_list = f\"[{res_list[0]:.12f},{res_list[1]:.12f},{res_list[2]:.12f}]\"\n        formatted_results.append(formatted_list)\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Moving beyond simple energy shifts, we next consider how the finite volume affects more complex observables, such as the electromagnetic moments of a bound state like the deuteron. This practice demonstrates how the cubic geometry of the lattice breaks continuous rotational symmetry, introducing orientation-dependent artifacts into calculations of quantities that have a non-trivial multipole structure . You will implement a powerful, symmetry-based method—averaging over the discrete rotations of the cubic group—to systematically eliminate these leading-order anisotropic errors, a crucial technique for precision calculations of hadronic structure.",
            "id": "3559434",
            "problem": "You are tasked with designing and implementing a computational procedure to study finite-volume corrections to the deuteron quadrupole moment and the asymptotic D-to-S ratio in a periodic cubic box. The goal is to model the leading dependence on the finite spatial extent and to mitigate the dominant anisotropies through averaging over cubic group rotations, using only well-established physical principles as the starting point.\n\nStart from the following principled bases:\n\n1. For a shallow two-nucleon bound state (the deuteron) with binding momentum $\\kappa>0$ in infinite volume, the asymptotic radial wave function decays as $\\exp(-\\kappa r)$ and solves the Helmholtz equation outside the interaction range. In a periodic cubic box of spatial period $L$, the long-distance field is well approximated by an image sum that modifies observables through interactions with periodic images.\n\n2. For a local observable $\\mathcal{O}$, the leading finite-volume correction at large $L$ arises from overlap between the exponentially decaying asymptotic bound-state tail and its periodic images, and scales as a weighted sum of the form\n$$\n\\Delta \\mathcal{O}(L,\\hat{\\boldsymbol{n}}) \\propto \\sum_{\\boldsymbol{R}\\neq \\boldsymbol{0}} \\frac{e^{-\\kappa |\\boldsymbol{R}|}}{|\\boldsymbol{R}|} \\,\\mathcal{A}(\\hat{\\boldsymbol{n}},\\hat{\\boldsymbol{R}}),\n$$\nwhere $\\boldsymbol{R}$ runs over nonzero lattice vectors connecting the origin to images, $\\hat{\\boldsymbol{R}}=\\boldsymbol{R}/|\\boldsymbol{R}|$, and $\\hat{\\boldsymbol{n}}$ denotes the spin-quantization axis of the deuteron. The angular structure $\\mathcal{A}$ arises from multipoles of the bound state.\n\n3. For the deuteron, the asymptotic wave function includes an $S$-wave and a small $D$-wave component, whose interference induces a leading quadrupolar angular dependence in observables. Axisymmetric projection around $\\hat{\\boldsymbol{n}}$ yields an angular factor proportional to the Legendre polynomial $P_{2}(\\cos\\theta)$ with $\\cos\\theta = \\hat{\\boldsymbol{n}}\\cdot \\hat{\\boldsymbol{R}}$.\n\n4. The rotational symmetry group of the cube (proper octahedral group) has $24$ elements. Group averaging over these discrete rotations projects any angular function onto the trivial irreducible representation of the cubic group. Because the $\\ell=2$ representation in three dimensions decomposes into nontrivial irreducible representations under the cubic group and contains no trivial representation, the group average of any pure $\\ell=2$ object over the cubic rotations vanishes.\n\nUsing only the points above, do the following:\n\nA. Starting from the Helmholtz asymptotics and the periodic image argument, construct the leading-order, large-$L$ model for the finite-volume deuteron quadrupole moment $Q_{d}(L,\\hat{\\boldsymbol{n}})$ as a sum of an isotropic component and a quadrupolar anisotropic component. Your model must have the form\n$$\nQ_{d}(L,\\hat{\\boldsymbol{n}}) \\equiv Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L) + b_{Q}\\,S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}}),\n$$\nwhere\n$$\nS_{\\mathrm{iso}}(L) = \\sum_{i} \\frac{e^{-\\kappa r_{i}}}{r_{i}}, \\qquad\nS_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}}) = \\sum_{i} \\frac{e^{-\\kappa r_{i}}}{r_{i}}\\,P_{2}\\!\\big(\\hat{\\boldsymbol{n}}\\cdot \\hat{\\boldsymbol{R}}_{i}\\big),\n$$\nand $Q_{\\infty}$ is the infinite-volume quadrupole moment, $a_{Q}$ and $b_{Q}$ are constants, and the sum runs over a judiciously truncated set of image directions $\\hat{\\boldsymbol{R}}_{i}$ at distances $r_{i}$. You must use, for computational concreteness and physical plausibility, the first two cubic image shells:\n- The six axis-neighbor images at distance $r=L$ with directions $\\pm \\hat{\\boldsymbol{e}}_{x}$, $\\pm \\hat{\\boldsymbol{e}}_{y}$, $\\pm \\hat{\\boldsymbol{e}}_{z}$.\n- The twelve face-diagonal images at distance $r=\\sqrt{2}\\,L$ with directions proportional to $\\pm(\\hat{\\boldsymbol{e}}_{x}\\pm \\hat{\\boldsymbol{e}}_{y})$, $\\pm(\\hat{\\boldsymbol{e}}_{x}\\pm \\hat{\\boldsymbol{e}}_{z})$, $\\pm(\\hat{\\boldsymbol{e}}_{y}\\pm \\hat{\\boldsymbol{e}}_{z})$, each normalized to unit length.\n\nB. Using the same logic, construct a leading-order model for the finite-volume deformation of the asymptotic D-to-S ratio,\n$$\n\\eta_{d}(L,\\hat{\\boldsymbol{n}}) \\equiv \\eta_{\\infty} + a_{\\eta}\\,S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}}),\n$$\nwhere $\\eta_{\\infty}$ is the infinite-volume ratio and $a_{\\eta}$ is a constant, consistent with the idea that the leading distortion is quadrupolar and decays as $e^{-\\kappa r}/r$.\n\nC. Show that averaging $Q_{d}(L,\\hat{\\boldsymbol{n}})$ and $\\eta_{d}(L,\\hat{\\boldsymbol{n}})$ over the $24$ proper rotations of the cube acting on $\\hat{\\boldsymbol{n}}$ eliminates the anisotropic piece, leaving\n$$\n\\overline{Q_{d}}(L) = Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L), \\qquad\n\\overline{\\eta_{d}}(L) = \\eta_{\\infty}.\n$$\n\nD. Implement a program that computes, for specified parameters, the un-averaged and averaged values for a given orientation and three box sizes. Use the following numerical parameters (all symbols in the equations above must be used consistently with these values):\n- Infinite-volume quadrupole moment: $Q_{\\infty} = 0.2859$ in $\\mathrm{fm}^{2}$.\n- Infinite-volume D-to-S ratio: $\\eta_{\\infty} = 0.0256$ (dimensionless).\n- Binding momentum: $\\kappa = 0.23$ in $\\mathrm{fm}^{-1}$.\n- Coefficients: $a_{Q} = 0.20$ in $\\mathrm{fm}^{3}$, $b_{Q} = 0.10$ in $\\mathrm{fm}^{3}$, $a_{\\eta} = 0.50$ in $\\mathrm{fm}$.\n- Orientation: $\\hat{\\boldsymbol{n}}_{0} = (1,2,3)/\\sqrt{14}$.\n- Image directions: include the first two shells as specified in item A.\n- The discrete cubic rotation average must be implemented by constructing the $24$ proper rotation matrices of the cube and applying them to $\\hat{\\boldsymbol{n}}_{0}$.\n\nE. Test Suite. For the three box sizes $L\\in\\{4.0, 8.0, 20.0\\}$ in $\\mathrm{fm}$, compute the following four quantities for each $L$:\n- $Q_{d}(L,\\hat{\\boldsymbol{n}}_{0})$ in $\\mathrm{fm}^{2}$,\n- $\\overline{Q_{d}}(L)$ in $\\mathrm{fm}^{2}$,\n- $\\eta_{d}(L,\\hat{\\boldsymbol{n}}_{0})$ (dimensionless),\n- $\\overline{\\eta_{d}}(L)$ (dimensionless).\n\nYour program should produce a single line of output containing the twelve floating-point results, ordered by increasing $L$ and grouped per $L$ as listed above, as a comma-separated list enclosed in square brackets, for example,\n\"[Q_unavg_L1,Q_avg_L1,eta_unavg_L1,eta_avg_L1,Q_unavg_L2,Q_avg_L2,eta_unavg_L2,eta_avg_L2,Q_unavg_L3,Q_avg_L3,eta_unavg_L3,eta_avg_L3]\".\nAll quadrupole moments must be expressed in $\\mathrm{fm}^{2}$, and all D-to-S ratios must be dimensionless. Print each number rounded to eight decimal places.\n\nImportant constraints:\n- Angles are pure dot products between unit vectors and therefore do not require unit conversion.\n- You must implement the $24$ proper cubic rotations algorithmically (do not hard-code the averaged result).\n- The output must be exactly one line in the required format, containing only the numeric list.",
            "solution": "The problem requires the formulation and implementation of a computational model for finite-volume corrections to the deuteron quadrupole moment, $Q_d$, and asymptotic D-to-S ratio, $\\eta_d$, within a periodic cubic volume of side length $L$. The solution is developed following the specified principles.\n\n### Part A & B: Model Construction for $Q_d$ and $\\eta_d$\n\nThe problem postulates that for a shallow bound state like the deuteron, the leading finite-volume corrections are dominated by the interaction of the particle with its periodic images. The effect of an image at a lattice displacement vector $\\boldsymbol{R}$ on a local observable scales as $\\frac{e^{-\\kappa |\\boldsymbol{R}|}}{|\\boldsymbol{R}|}$, where $\\kappa$ is the binding momentum.\n\nThe deuteron possesses a non-zero intrinsic quadrupole moment, which couples to the geometry of the finite volume. This coupling introduces an anisotropic dependence on the spin-quantization axis $\\hat{\\boldsymbol{n}}$. The angular dependence is dominated by the lowest-multipole interference term, which for the deuteron is quadrupolar, described by the Legendre polynomial $P_2(\\cos\\theta)$, where $\\theta$ is the angle between $\\hat{\\boldsymbol{n}}$ and the image direction $\\hat{\\boldsymbol{R}} = \\boldsymbol{R}/|\\boldsymbol{R}|$.\n\nBased on these principles, the problem provides models for the finite-volume quadrupole moment $Q_d(L, \\hat{\\boldsymbol{n}})$ and D-to-S ratio $\\eta_d(L, \\hat{\\boldsymbol{n}})$:\n$$\nQ_{d}(L,\\hat{\\boldsymbol{n}}) = Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L) + b_{Q}\\,S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})\n$$\n$$\n\\eta_{d}(L,\\hat{\\boldsymbol{n}}) = \\eta_{\\infty} + a_{\\eta}\\,S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})\n$$\nHere, $Q_{\\infty}$ and $\\eta_{\\infty}$ are the infinite-volume values, and $a_Q$, $b_Q$, and $a_\\eta$ are constants that parameterize the strength of the finite-volume effects. The functions $S_{\\mathrm{iso}}(L)$ and $S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})$ represent the isotropic and anisotropic contributions from the sum over periodic images, respectively. They are defined as:\n$$\nS_{\\mathrm{iso}}(L) = \\sum_{i} \\frac{e^{-\\kappa r_{i}}}{r_{i}}\n$$\n$$\nS_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}}) = \\sum_{i} \\frac{e^{-\\kappa r_{i}}}{r_{i}}\\,P_{2}\\!\\big(\\hat{\\boldsymbol{n}}\\cdot \\hat{\\boldsymbol{R}}_{i}\\big)\n$$\nwhere the sum over $i$ runs over the set of included image vectors $\\boldsymbol{R}_i$, with $r_i = |\\boldsymbol{R}_i|$ and $\\hat{\\boldsymbol{R}}_i = \\boldsymbol{R}_i/r_i$. The Legendre polynomial is $P_2(x) = \\frac{1}{2}(3x^2 - 1)$.\n\nThe calculation is restricted to the first two shells of nearest images in the cubic lattice:\n1.  **Shell 1**: Six axis-neighbor images at a distance $r_1=L$. The vectors are permutations of $(\\pm L, 0, 0)$. The corresponding normalized direction vectors $\\hat{\\boldsymbol{R}}_i$ are permutations of $(\\pm 1, 0, 0)$.\n2.  **Shell 2**: Twelve face-diagonal images at a distance $r_2=\\sqrt{L^2+L^2} = \\sqrt{2}L$. The vectors are permutations of $(\\pm L, \\pm L, 0)$. The corresponding normalized direction vectors $\\hat{\\boldsymbol{R}}_i$ are permutations of $(\\pm 1/\\sqrt{2}, \\pm 1/\\sqrt{2}, 0)$.\n\nSubstituting these into the definitions of the sums, we obtain explicit expressions:\n$$\nS_{\\mathrm{iso}}(L) = 6 \\frac{e^{-\\kappa L}}{L} + 12 \\frac{e^{-\\kappa \\sqrt{2}L}}{\\sqrt{2}L}\n$$\n$$\nS_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}}) = \\frac{e^{-\\kappa L}}{L} \\sum_{i \\in \\text{Shell 1}} P_2(\\hat{\\boldsymbol{n}}\\cdot\\hat{\\boldsymbol{R}}_i) + \\frac{e^{-\\kappa \\sqrt{2}L}}{\\sqrt{2}L} \\sum_{i \\in \\text{Shell 2}} P_2(\\hat{\\boldsymbol{n}}\\cdot\\hat{\\boldsymbol{R}}_i)\n$$\nThese expressions complete the construction of the models for $Q_d$ and $\\eta_d$.\n\n### Part C: Cubic Group Averaging\n\nThe problem asks to show that averaging over the $24$ proper rotations of a cube eliminates the anisotropic contributions. The average of an observable $\\mathcal{O}(\\hat{\\boldsymbol{n}})$ over the proper cubic (octahedral) group $O$ is defined as:\n$$\n\\overline{\\mathcal{O}} = \\frac{1}{|O|} \\sum_{g \\in O} \\mathcal{O}(g\\hat{\\boldsymbol{n}}) = \\frac{1}{24} \\sum_{g \\in O} \\mathcal{O}(g\\hat{\\boldsymbol{n}})\n$$\nwhere $g\\hat{\\boldsymbol{n}}$ is the vector $\\hat{\\boldsymbol{n}}$ transformed by the rotation $g$.\n\nLet's apply this to the models. The terms $Q_{\\infty}$, $\\eta_{\\infty}$, and $S_{\\mathrm{iso}}(L)$ are independent of $\\hat{\\boldsymbol{n}}$, so they are invariant under the averaging procedure. The only term affected is $S_{\\mathrm{aniso}}(L, \\hat{\\boldsymbol{n}})$. Its average is:\n$$\n\\overline{S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})} = \\sum_{i} \\frac{e^{-\\kappa r_{i}}}{r_{i}} \\left( \\frac{1}{24} \\sum_{g \\in O} P_{2}\\big((g\\hat{\\boldsymbol{n}})\\cdot \\hat{\\boldsymbol{R}}_{i}\\big) \\right)\n$$\nAs stated in the problem, the angular function $P_2(\\hat{\\boldsymbol{a}} \\cdot \\hat{\\boldsymbol{b}})$ is an object with angular momentum $\\ell=2$. In the language of group theory, it transforms according to the $D^{(2)}$ representation of the rotation group $SO(3)$. When restricted to the cubic subgroup $O$, this representation decomposes into irreducible representations of $O$. The decomposition is $D^{(2)} \\rightarrow E_g \\oplus T_{2g}$. Crucially, this decomposition does not contain the trivial (scalar) representation $A_{1g}$. The group averaging operator $\\frac{1}{|O|} \\sum_{g \\in O}$ is a projection operator onto the $A_{1g}$ irreducible representation. Since the $\\ell=2$ space has no component in the $A_{1g}$ representation, the average of any pure $\\ell=2$ object over the cubic group must be zero.\nTherefore, for any fixed vector $\\hat{\\boldsymbol{R}}_i$, the average of $P_2((g\\hat{\\boldsymbol{n}})\\cdot \\hat{\\boldsymbol{R}}_i)$ over all rotations $g$ vanishes. This implies:\n$$\n\\overline{S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})} = 0\n$$\nConsequently, the averaged observables are:\n$$\n\\overline{Q_{d}}(L) = \\frac{1}{24} \\sum_{g \\in O} \\left( Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L) + b_{Q}\\,S_{\\mathrm{aniso}}(L,g\\hat{\\boldsymbol{n}}) \\right) = Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L) + b_{Q}\\,\\overline{S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})} = Q_{\\infty} + a_{Q}\\,S_{\\mathrm{iso}}(L)\n$$\n$$\n\\overline{\\eta_{d}}(L) = \\frac{1}{24} \\sum_{g \\in O} \\left( \\eta_{\\infty} + a_{\\eta}\\,S_{\\mathrm{aniso}}(L,g\\hat{\\boldsymbol{n}}) \\right) = \\eta_{\\infty} + a_{\\eta}\\,\\overline{S_{\\mathrm{aniso}}(L,\\hat{\\boldsymbol{n}})} = \\eta_{\\infty}\n$$\nThis demonstrates that cubic averaging systematically removes the leading-order anisotropic finite-volume artifacts.\n\n### Part D & E: Computational Implementation\n\nThe computational procedure involves implementing the formulas derived above for the specified numerical parameters and test cases.\n\n1.  **Define Constants**: All given parameters ($Q_{\\infty}$, $\\eta_{\\infty}$, $\\kappa$, $a_Q$, $b_Q$, $a_\\eta$) are defined. The specific orientation vector is $\\hat{\\boldsymbol{n}}_0 = (1,2,3)/\\sqrt{14}$.\n2.  **Generate Image Vectors**: The $18$ unit direction vectors $\\hat{\\boldsymbol{R}}_i$ for the first two shells are generated and stored.\n3.  **Generate Cubic Rotation Matrices**: The $24$ rotation matrices of the proper cubic group $O$ are generated. A systematic method is to consider all permutations of the columns of the identity matrix, combined with sign flips that maintain a determinant of $+1$.\n4.  **Calculate Sums**:\n    -   A function computes $S_{\\mathrm{iso}}(L)$ for a given $L$.\n    -   A function computes $S_{\\mathrm{aniso}}(L, \\hat{\\boldsymbol{n}})$ for a given $L$ and orientation $\\hat{\\boldsymbol{n}}$.\n5.  **Main Loop**: The calculation iterates over the box sizes $L \\in \\{4.0, 8.0, 20.0\\}$. For each $L$:\n    a. The un-averaged quantities, $Q_d(L, \\hat{\\boldsymbol{n}}_0)$ and $\\eta_d(L, \\hat{\\boldsymbol{n}}_0)$, are calculated directly using $\\hat{\\boldsymbol{n}}_0$.\n    b. The averaged quantities are computed by explicitly performing the numerical average. A loop iterates through the $24$ rotation matrices $g_j$. For each, the rotated vector $\\hat{\\boldsymbol{n}}_j = g_j \\hat{\\boldsymbol{n}}_0$ is found, and $S_{\\mathrm{aniso}}(L, \\hat{\\boldsymbol{n}}_j)$ is calculated. The average of these $24$ values, ${\\overline{S_{\\mathrm{aniso}}}}^{\\text{num}}$, is then determined.\n    c. Due to the group theory principle, ${\\overline{S_{\\mathrm{aniso}}}}^{\\text{num}}$ is expected to be numerically close to zero (up to floating-point precision).\n    d. The averaged observables $\\overline{Q_d}(L)$ and $\\overline{\\eta_d}(L)$ are calculated using this numerical average.\n6.  **Output Formatting**: The twelve resulting floating-point numbers are rounded to eight decimal places and formatted into the required single-line string.\n\nThis procedure provides a concrete computational test of the physical principles outlined in the problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Computes finite-volume corrections for the deuteron quadrupole moment\n    and D-to-S ratio based on a periodic image sum model.\n    \"\"\"\n\n    # Part D: Define numerical parameters from the problem statement\n    Q_inf = 0.2859      # fm^2\n    eta_inf = 0.0256    # dimensionless\n    kappa = 0.23        # fm^-1\n    a_Q = 0.20          # fm^3\n    b_Q = 0.10          # fm^3\n    a_eta = 0.50        # fm\n    n0 = np.array([1, 2, 3]) / np.sqrt(14)\n    L_values = [4.0, 8.0, 20.0]  # fm\n\n    # Generate the 18 image direction vectors for the first two shells\n    R_hat_vectors = []\n    # Shell 1: distance L, 6 vectors\n    for i in range(3):\n        for sign in [-1, 1]:\n            vec = np.zeros(3)\n            vec[i] = sign\n            R_hat_vectors.append(vec)\n            \n    # Shell 2: distance sqrt(2)*L, 12 vectors\n    for i, j in itertools.combinations(range(3), 2):\n        for si in [-1, 1]:\n            for sj in [-1, 1]:\n                vec = np.zeros(3)\n                vec[i] = si\n                vec[j] = sj\n                R_hat_vectors.append(vec / np.sqrt(2))\n    \n    R_hat_vectors = np.array(R_hat_vectors)\n\n    # Generate the 24 proper cubic rotation matrices\n    def get_sgn_permutation(p):\n        \"\"\"Calculate the sign of a permutation.\"\"\"\n        inversions = 0\n        n = len(p)\n        for i in range(n):\n            for j in range(i + 1, n):\n                if p[i] > p[j]:\n                    inversions += 1\n        return 1 if inversions % 2 == 0 else -1\n\n    rotation_matrices = []\n    permutations = list(itertools.permutations([0, 1, 2]))\n    \n    for p in permutations:\n        sgn_p = get_sgn_permutation(p)\n        P_matrix = np.zeros((3, 3))\n        for i in range(3):\n            P_matrix[p[i], i] = 1\n\n        for s1, s2, s3 in itertools.product([-1, 1], repeat=3):\n            if s1 * s2 * s3 * sgn_p == 1:\n                S_matrix = np.diag([s1, s2, s3])\n                R_matrix = P_matrix @ S_matrix\n                rotation_matrices.append(R_matrix.T) # Use transpose for R@v convention\n\n    # Helper function for Legendre polynomial P2(x)\n    def P2(x):\n        return 0.5 * (3 * x**2 - 1)\n\n    # Functions to calculate the sums\n    def calculate_S_iso(L, k):\n        term1 = np.exp(-k * L) / L\n        term2 = np.exp(-k * np.sqrt(2) * L) / (np.sqrt(2) * L)\n        return 6 * term1 + 12 * term2\n\n    def calculate_S_aniso(L, k, n_vec):\n        term1 = np.exp(-k * L) / L\n        term2 = np.exp(-k * np.sqrt(2) * L) / (np.sqrt(2) * L)\n        \n        s_aniso = 0.0\n        # Shell 1\n        for i in range(6):\n            dot_product = np.dot(n_vec, R_hat_vectors[i])\n            s_aniso += term1 * P2(dot_product)\n        \n        # Shell 2\n        for i in range(6, 18):\n            dot_product = np.dot(n_vec, R_hat_vectors[i])\n            s_aniso += term2 * P2(dot_product)\n            \n        return s_aniso\n\n    # Part E: Main calculation loop\n    results = []\n    for L in L_values:\n        # Calculate S_iso and S_aniso for the un-averaged case\n        S_iso_val = calculate_S_iso(L, kappa)\n        S_aniso_n0 = calculate_S_aniso(L, kappa, n0)\n        \n        # Un-averaged quantities\n        Qd_unavg = Q_inf + a_Q * S_iso_val + b_Q * S_aniso_n0\n        eta_unavg = eta_inf + a_eta * S_aniso_n0\n        \n        # Averaged quantities: must perform the average algorithmically\n        S_aniso_avg = 0.0\n        for R_mat in rotation_matrices:\n            n_rotated = R_mat @ n0\n            S_aniso_avg += calculate_S_aniso(L, kappa, n_rotated)\n        S_aniso_avg /= 24.0\n\n        Qd_avg = Q_inf + a_Q * S_iso_val + b_Q * S_aniso_avg\n        eta_avg = eta_inf + a_eta * S_aniso_avg\n        \n        # Append formatted results for this L\n        results.extend([\n            f\"{Qd_unavg:.8f}\",\n            f\"{Qd_avg:.8f}\",\n            f\"{eta_unavg:.8f}\",\n            f\"{eta_avg:.8f}\",\n        ])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "One of the most powerful applications of finite-volume formalism is the extraction of scattering phase shifts from the discrete energy spectrum measured in lattice simulations. This advanced exercise tackles a subtle but critical source of systematic error in the Lüscher method: the necessary truncation of the infinite partial-wave expansion . By modeling the contamination from a higher, neglected partial wave, you will learn to quantify the resulting bias in an extracted resonance parameter and explore how to strategically choose kinematic setups to minimize this effect, a key skill for modern hadron spectroscopy.",
            "id": "3559431",
            "problem": "Consider two identical, spinless particles undergoing elastic scattering in a cubic periodic box of side length $L$, analyzed using the finite-volume quantization condition derived from the determinant equation $\\det\\left(\\mathcal{K}^{-1}(E)+\\mathcal{F}(E,L)\\right)=0$, where $\\mathcal{K}(E)$ is the infinite-volume, partial-wave diagonal scattering $\\mathcal{K}$-matrix and $\\mathcal{F}(E,L)$ encodes finite-volume geometric effects. In the infinite-volume limit, partial waves labeled by orbital angular momentum $l$ decouple, while in the finite volume their contributions mix within irreducible representations (irreps) of the cubic symmetry group appropriate to the chosen frame. Truncating to a finite set of partial waves in the determinant condition introduces a bias in phase shifts when higher waves contribute within the same irrep.\n\nYou will study a simplified, single-channel model of a broad $p$-wave ($l=1$) resonance with leading contamination from an odd higher partial wave $l=5$. The center-of-mass energy $E$ is treated as dimensionless, and the center-of-mass momentum is $q(E)=\\sqrt{E}$ (dimensionless). The $p$-wave phase shift near a broad resonance is modeled by a Breit–Wigner form\n$$\n\\delta_1(E) = \\arctan\\left(\\frac{\\Gamma(E)}{E_R - E}\\right),\n\\quad\n\\Gamma(E) = \\gamma\\, q(E)^{3},\n$$\nwhere $E_R>0$ is the resonance energy and $\\gamma>0$ controls the energy-dependent width. The background $l=5$ phase shift is taken to be small and smooth,\n$$\n\\delta_5(E) = \\kappa_5\\, q(E)^{11},\n$$\nwith $\\kappa_5>0$ a small constant.\n\nWithin a fixed irrep $\\Lambda$, define simplified forms for the diagonal finite-volume geometric functions and the leading off-diagonal mixing term as\n$$\n\\phi_{l,\\Lambda}(E,L) \\equiv \\frac{a_{l,\\Lambda}}{L^{3}\\, q(E)^{l+1}},\n\\quad\nF_{1,5}^{\\Lambda}(E,L) \\equiv \\frac{b_{\\Lambda}}{L^{3}\\, q(E)^3},\n$$\nwhere $a_{l,\\Lambda}>0$ and $b_{\\Lambda}>0$ are irrep-dependent dimensionless constants that encode the relative strength of geometric subduction, and the overall $L^{-3}$ scaling reflects the typical finite-volume suppression.\n\nWorking in the subspace spanned by $\\{l=1\\}$ and treating the omitted higher partial wave $l=5$ through a Schur-complement approximation, the exact determinant condition projected to the truncated subspace induces an energy-dependent correction to the effective geometric function,\n$$\n\\Delta \\phi_{\\Lambda}(E,L) \\equiv -\\frac{\\left(F_{1,5}^{\\Lambda}(E,L)\\right)^{2}}{\\cot\\delta_{5}(E)+\\phi_{5,\\Lambda}(E,L)} = -\\frac{\\left(b_{\\Lambda}/(L^{3}\\, q(E)^{3})\\right)^{2}}{\\cot\\left(\\delta_{5}(E)\\right)+a_{5,\\Lambda}/(L^{3}\\, q(E)^{6})}.\n$$\nThe true finite-volume energy levels $E^\\star$ in a given irrep $\\Lambda$ solve\n$$\n\\cot\\delta_{1}(E^\\star) + \\phi_{1,\\Lambda}(E^\\star,L) + \\Delta \\phi_{\\Lambda}(E^\\star,L) = 0,\n$$\nwhere $\\cot\\delta_{1}(E) = \\frac{E_R - E}{\\Gamma(E)}$. If one ignores higher partial waves and fits using the truncated condition,\n$$\n\\cot\\delta_{1}^{\\text{(trunc)}}(E) + \\phi_{1,\\Lambda}(E,L) = 0,\n$$\nthe phase shift inferred from the measured energy $E^\\star$ is the solution $\\delta_{1}^{\\text{(trunc)}}(E^\\star)$ satisfying $\\cot\\delta_{1}^{\\text{(trunc)}}(E^\\star) = -\\phi_{1,\\Lambda}(E^\\star,L)$, selected on the branch closest to the true $\\delta_1(E^\\star) \\in (0,\\pi)$.\n\nYour tasks are:\n1. For each test case below, numerically find the energy $E^\\star$ that solves the exact condition and then evaluate the phase shift bias defined as\n$$\n\\Delta\\delta \\equiv \\delta_{1}^{\\text{(trunc)}}(E^\\star) - \\delta_{1}(E^\\star),\n$$\nexpressed in radians. Use the convention $\\delta_{1}(E) = \\arctan2\\left(\\Gamma(E),\\,E_R-E\\right)$ mapped to $(0,\\pi)$, and choose the branch of $\\delta_{1}^{\\text{(trunc)}}(E^\\star)$ to minimize $|\\delta_{1}^{\\text{(trunc)}}(E^\\star)-\\delta_{1}(E^\\star)|$.\n\n2. For each irrep option $\\Lambda\\in\\{0,1,2\\}$ with parameters specified below, compute the contamination metric at the solved $E^\\star$ for each test case,\n$$\n\\mathcal{M}_{\\Lambda}(E^\\star,L) \\equiv \\frac{\\left(F_{1,5}^{\\Lambda}(E^\\star,L)\\right)^{2}}{\\left|\\cot\\delta_{5}(E^\\star)+\\phi_{5,\\Lambda}(E^\\star,L)\\right|},\n$$\nand then average these metrics across all test cases. Determine the two irreps with the smallest averages; report their integer codes in ascending order.\n\nIrrep parameterization (dimensionless):\n- $\\Lambda=0$: $a_{1,0}=5.0$, $a_{5,0}=0.5$, $b_{0}=0.10$.\n- $\\Lambda=1$: $a_{1,1}=3.0$, $a_{5,1}=0.3$, $b_{1}=0.06$.\n- $\\Lambda=2$: $a_{1,2}=1.5$, $a_{5,2}=0.15$, $b_{2}=0.02$.\n\nTest suite (dimensionless inputs; angles in radians):\n- Case 1: $(E_R,\\gamma,\\kappa_5,L,\\Lambda) = (1.00,\\,0.80,\\,0.020,\\,18,\\,0)$.\n- Case 2 (edge: very broad and smaller volume): $(E_R,\\gamma,\\kappa_5,L,\\Lambda) = (1.00,\\,1.10,\\,0.030,\\,12,\\,1)$.\n- Case 3 (large volume): $(E_R,\\gamma,\\kappa_5,L,\\Lambda) = (1.00,\\,0.60,\\,0.020,\\,28,\\,2)$.\n\nAlgorithmic requirements:\n- Implement a robust root-finding procedure to solve for $E^\\star$ in each case by locating a zero of\n$$\nf(E) \\equiv \\frac{E_R - E}{\\gamma\\, q(E)^3} + \\frac{a_{1,\\Lambda}}{L^{3}\\, q(E)^{2}} - \\frac{\\left(\\frac{b_{\\Lambda}}{L^{3}\\, q(E)^{3}}\\right)^{2}}{\\frac{1}{\\tan\\left(\\kappa_5\\, q(E)^{11}\\right)} + \\frac{a_{5,\\Lambda}}{L^{3}\\, q(E)^{6}}},\n$$\nover a reasonable bracket around $E_R$. If a bracketing sign change cannot be found, minimize $|f(E)|$ over a bounded interval containing the resonance and treat the minimizer as $E^\\star$.\n\n- Compute $\\delta_{1}(E^\\star)$ and $\\delta_{1}^{\\text{(trunc)}}(E^\\star)$ as prescribed, then $\\Delta\\delta$.\n\nOutput specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, namely\n$$\n[\\Delta\\delta_1,\\,\\Delta\\delta_2,\\,\\Delta\\delta_3,\\,\\Lambda_{\\text{best},1},\\,\\Lambda_{\\text{best},2}],\n$$\nwhere the first three entries are the biases for the three cases (floats in radians), and the last two entries are the integer codes of the two irreps with the smallest average contamination metrics across the three cases.\n\nNo external input is required. All quantities are dimensionless, and angles must be reported in radians.",
            "solution": "The problem requires a numerical solution to a model of two-particle scattering in a finite volume, with a focus on quantifying the systematic error arising from partial-wave truncation. The solution methodology involves three main steps: first, numerically solving a transcendental equation for the finite-volume energy spectrum; second, calculating the bias in the extracted scattering phase shift due to the truncation; and third, evaluating a metric to quantify the level of contamination from higher partial waves for different kinematic setups (irreducible representations, or irreps).\n\nThe theoretical foundation is Lüscher's method and its extensions, which relate the discrete energy spectrum of a system in a finite volume to the infinite-volume scattering amplitudes. In a cubic volume, spherical symmetry is broken to cubic symmetry, causing mixing between partial waves that would be decoupled in infinite volume. We are given a model where a dominant $p$-wave ($l=1$) resonance is contaminated by a small $l=5$ partial wave.\n\nThe first step is to determine the discrete energy levels $E^\\star$ for each test case. These are the roots of the exact quantization condition, which is a non-linear equation given by:\n$$\n\\cot\\delta_{1}(E^\\star) + \\phi_{1,\\Lambda}(E^\\star,L) + \\Delta \\phi_{\\Lambda}(E^\\star,L) = 0\n$$\nwhere all terms are functions of the center-of-mass energy $E$. Substituting the provided definitions, we seek the roots of the function $f(E)$:\n$$\nf(E) \\equiv \\underbrace{\\frac{E_R - E}{\\gamma\\, q(E)^3}}_{\\cot\\delta_1(E)} + \\underbrace{\\frac{a_{1,\\Lambda}}{L^{3}\\, q(E)^{2}}}_{\\phi_{1,\\Lambda}(E,L)} - \\underbrace{\\frac{\\left(\\frac{b_{\\Lambda}}{L^{3}\\, q(E)^{3}}\\right)^{2}}{\\frac{1}{\\tan\\left(\\kappa_5\\, q(E)^{11}\\right)} + \\frac{a_{5,\\Lambda}}{L^{3}\\, q(E)^{6}}}}_{-\\Delta\\phi_\\Lambda(E,L)} = 0\n$$\nHere, $q(E) = \\sqrt{E}$. This is a transcendental equation for $E$ that does not admit a simple analytical solution. Therefore, a numerical root-finding algorithm is required. The problem specifies a robust procedure: we first attempt to find a bracket $[E_a, E_b]$ where $f(E_a)$ and $f(E_b)$ have opposite signs, and then use a bracketing algorithm like Brent's method (`scipy.optimize.brentq`) to find the root $E^\\star$. The resonance energy $E_R$ provides a natural location to search for a root. If bracketing fails, due to either the absence of a root or the presence of poles in $f(E)$, we fall back to finding the energy $E^\\star$ that minimizes the absolute value $|f(E)|$ over a bounded interval, using a method like `scipy.optimize.minimize_scalar`.\n\nOnce $E^\\star$ for a given test case is found, the second task is to compute the phase-shift bias, $\\Delta\\delta$. This bias represents the error one would make by incorrectly assuming the system contains only the $p$-wave. The \"true\" $p$-wave phase shift at this energy is calculated directly from its model definition:\n$$\n\\delta_{1}(E^\\star) = \\arctan2\\left(\\Gamma(E^\\star),\\,E_R - E^\\star\\right)\n$$\nwhere $\\Gamma(E) = \\gamma\\,q(E)^3$. The use of the two-argument arctangent function, `arctan2(y,x)`, correctly maps the angle to the interval $(0, \\pi)$ for a resonance where the width $\\Gamma(E)$ is positive. The \"truncated\" phase shift, $\\delta_{1}^{\\text{(trunc)}}(E^\\star)$, is what one would infer from the measured $E^\\star$ using the simplified (incorrect) quantization condition:\n$$\n\\cot\\delta_{1}^{\\text{(trunc)}}(E^\\star) = -\\phi_{1,\\Lambda}(E^\\star,L) = -\\frac{a_{1,\\Lambda}}{L^{3}\\, q(E^\\star)^{2}}\n$$\nTo find $\\delta_{1}^{\\text{(trunc)}}(E^\\star)$, we must invert the cotangent. The arccotangent function is multi-valued, with solutions of the form $\\operatorname{arccot}(x) + n\\pi$ for any integer $n$. The problem specifies that we must choose the branch (the value of $n$) that minimizes the absolute difference $|\\delta_{1}^{\\text{(trunc)}}(E^\\star) - \\delta_{1}(E^\\star)|$. This is achieved by first computing the principal value, $\\delta_{\\text{base}} = \\arctan2(1, \\cot\\delta_{1}^{\\text{(trunc)}}(E^\\star)) \\in (0,\\pi)$, and then adding the integer multiple of $\\pi$ that brings it closest to the true value $\\delta_{1}(E^\\star)$. The bias is then the difference:\n$$\n\\Delta\\delta = \\delta_{1}^{\\text{(trunc)}}(E^\\star) - \\delta_{1}(E^\\star)\n$$\n\nThe third task is to assess which of the three irreps, labeled $\\Lambda=0, 1, 2$, is least susceptible to contamination from the $l=5$ partial wave. This is done using the contamination metric:\n$$\n\\mathcal{M}_{\\Lambda}(E^\\star,L) \\equiv \\frac{\\left(F_{1,5}^{\\Lambda}(E^\\star,L)\\right)^{2}}{\\left|\\cot\\delta_{5}(E^\\star)+\\phi_{5,\\Lambda}(E^\\star,L)\\right|}\n$$\nThis quantity is precisely the absolute value of the correction term, $|\\Delta\\phi_{\\Lambda}(E^\\star,L)|$, which directly measures the magnitude of the effect of the higher partial wave on the quantization condition. For each of the three test cases, we use the solved energy $E^\\star$ and its corresponding parameters ($L, \\kappa_5$) to compute this metric for all three irrep choices $\\Lambda \\in \\{0,1,2\\}$. The results for each irrep are then averaged across the three test cases. The two irreps with the smallest average metrics are deemed \"best\" or least contaminated, and their integer codes are reported in ascending order.\n\nThe implementation will structure this logic by first defining the parameters for the irreps and test cases. For each test case, the root $E^\\star$ is found. Then, this $E^\\star$ value is used to compute both the phase shift bias for that specific case and the three contamination metrics (one for each $\\Lambda \\in \\{0, 1, 2\\}$). After processing all cases, the biases are collected, the average contamination for each irrep is calculated, and the best two irreps are identified.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq, minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the finite-volume scattering problem as described.\n    1. Finds the energy level E* for each test case by root-finding.\n    2. Calculates the phase shift bias for each case.\n    3. Calculates contamination metrics for each irrep across all cases,\n       averages them, and identifies the two best irreps.\n    \"\"\"\n\n    # Irrep parameters (dimensionless)\n    # Lambda: {a_{1,Lambda}, a_{5,Lambda}, b_{Lambda}}\n    irrep_params = {\n        0: {'a1': 5.0, 'a5': 0.5, 'b': 0.10},\n        1: {'a1': 3.0, 'a5': 0.3, 'b': 0.06},\n        2: {'a1': 1.5, 'a5': 0.15, 'b': 0.02},\n    }\n\n    # Test cases\n    # (E_R, gamma, kappa_5, L, Lambda_idx)\n    test_cases = [\n        (1.00, 0.80, 0.020, 18, 0),\n        (1.00, 1.10, 0.030, 12, 1),\n        (1.00, 0.60, 0.020, 28, 2),\n    ]\n\n    biases = []\n    # Store metrics as [[M0_c1, M1_c1, M2_c1], [M0_c2, ...], ...]\n    all_metrics = []\n\n    for case in test_cases:\n        E_R, gamma, kappa_5, L, Lambda_idx = case\n        params = irrep_params[Lambda_idx]\n        a1, a5, b = params['a1'], params['a5'], params['b']\n        L3 = L**3\n\n        def f(E):\n            \"\"\"The function whose root E_star is sought.\"\"\"\n            if E <= 0:\n                return np.inf\n\n            q = np.sqrt(E)\n            q2 = E\n            q3 = q * q2\n            q6 = q3 * q3\n            q11 = q**11\n\n            term1 = (E_R - E) / (gamma * q3)  # cot(delta_1)\n            term2 = a1 / (L3 * q2)          # phi_{1,Lambda}\n            \n            # Correction term, -Delta phi_Lambda\n            delta5_arg = kappa_5 * q11\n            # Avoid poles of tan by checking argument\n            if np.abs(np.cos(delta5_arg)) < 1e-12:\n                cot_delta5 = np.inf\n            else:\n                cot_delta5 = 1.0 / np.tan(delta5_arg)\n            \n            num_corr = (b / (L3 * q3))**2\n            den_corr = cot_delta5 + (a5 / (L3 * q6))\n            \n            if np.abs(den_corr) < 1e-12: # Avoid division by zero\n                term3 = np.sign(num_corr) * np.inf\n            else:\n                term3 = num_corr / den_corr\n            \n            return term1 + term2 - term3\n        \n        # --- Find E_star ---\n        E_star = None\n        search_bracket = [0.1 * E_R, 2.0 * E_R]\n        try:\n            # First, attempt root-finding with a bracket\n            E_star = brentq(f, search_bracket[0], search_bracket[1], xtol=1e-12, rtol=1e-12)\n        except ValueError:\n            # Fallback: minimize the absolute value of the function\n            res = minimize_scalar(lambda E: np.abs(f(E)), bounds=search_bracket, method='bounded')\n            E_star = res.x\n\n        # --- Calculate Phase Shift Bias ---\n        q_star = np.sqrt(E_star)\n        \n        # True phase shift\n        Gamma_E_star = gamma * q_star**3\n        delta1_true = np.arctan2(Gamma_E_star, E_R - E_star)\n        \n        # Truncated phase shift\n        cot_delta1_trunc = -params['a1'] / (L3 * q_star**2)\n        # Principal value of arccot in (0, pi)\n        base_angle_trunc = np.arctan2(1.0, cot_delta1_trunc)\n        \n        # Choose branch closest to the true angle\n        k = np.round((delta1_true - base_angle_trunc) / np.pi)\n        delta1_trunc = base_angle_trunc + k * np.pi\n        \n        bias = delta1_trunc - delta1_true\n        biases.append(bias)\n\n        # --- Calculate Contamination Metrics for all irreps ---\n        case_metrics = []\n        for i in range(3): # Iterate through irreps Lambda = 0, 1, 2\n            p_eval = irrep_params[i]\n            a5_eval, b_eval = p_eval['a5'], p_eval['b']\n            \n            q2 = E_star\n            q3 = q_star * q2\n            q6 = q3 * q3\n            q11 = q_star**11\n\n            F_15_sq = (b_eval / (L3 * q3))**2\n            \n            delta5_arg_eval = kappa_5 * q11\n            if np.abs(np.cos(delta5_arg_eval)) < 1e-12:\n                cot_delta5_eval = np.inf\n            else:\n                cot_delta5_eval = 1.0 / np.tan(delta5_arg_eval)\n            \n            phi5_eval = a5_eval / (L3 * q6)\n            \n            den_metric = cot_delta5_eval + phi5_eval\n            \n            if np.abs(den_metric) < 1e-12:\n                metric = np.inf\n            else:\n                metric = F_15_sq / np.abs(den_metric)\n            \n            case_metrics.append(metric)\n        all_metrics.append(case_metrics)\n        \n    # --- Determine the best irreps ---\n    metrics_array = np.array(all_metrics)\n    avg_metrics = np.mean(metrics_array, axis=0)\n    \n    # Pair metrics with their irrep index and sort\n    sorted_irreps = sorted(enumerate(avg_metrics), key=lambda x: x[1])\n    \n    best_irrep1_idx = sorted_irreps[0][0]\n    best_irrep2_idx = sorted_irreps[1][0]\n    \n    # Report in ascending order\n    best_irreps = sorted([best_irrep1_idx, best_irrep2_idx])\n    \n    # --- Format final output ---\n    final_results = biases + best_irreps\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}