{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的核结构计算之前，建立我们所研究现象的物理标度是至关重要的。核磁子 $\\mu_N$ 为核磁矩提供了一个基本的尺度单位。这个练习将通过结合电动力学和量子力学的基本关系，从第一性原理出发推导并计算核磁子，从而巩固对自然基本常数与原子核特性特征尺度之间联系的理解。",
            "id": "3574845",
            "problem": "在核物理学中，磁偶极矩的特征标度是由一个带电荷 $q$、质量为 $m$、角动量为 $L$ 的点状粒子的磁矩决定的，该磁矩由经过充分检验的电动力学和量子力学所支配。从点电荷的磁偶极矩与角动量之间的基本关系，以及角动量以约化普朗克常数为单位的量子化出发，构建自然的核磁矩标度并计算其数值。然后将此标度转换为每磁场的能量单位，以方便对核电磁相互作用进行计算建模。\n\n具体要求如下：\n1. 使用带电粒子的磁偶极矩与角动量之间的关系，结合角动量的量子化，来定义核磁子。将质子作为参考粒子，其电荷量为 $e$，质量为 $m_{p}$。除了一的量级的推断外，不要假定任何经验性的核 g 因子。\n2. 使用国际科技数据委员会 (CODATA) 推荐的常数，计算核磁子的数值，单位分别为焦耳/特斯拉 $\\left(\\mathrm{J/T}\\right)$ 和兆电子伏特/特斯拉 $\\left(\\mathrm{MeV/T}\\right)$。\n3. 使用量级为一的无量纲旋磁因子和核自旋，估算核磁偶极矩在同样单位下的典型大小。\n\n采用以下约定和换算关系：\n- 约化普朗克常数为 $\\hbar = h/(2\\pi)$。\n- 电子伏特满足 $1~\\mathrm{eV} = e~\\mathrm{J}$，因此 $1~\\mathrm{MeV} = 10^{6}~\\mathrm{eV} = 1.602176634 \\times 10^{-13}~\\mathrm{J}$。\n\n将所有要求的数值四舍五入到 $9$ 位有效数字。用 $\\mathrm{J/T}$ 和 $\\mathrm{MeV/T}$ 表示核磁子，并用相同的两个单位表示核磁偶极矩的典型大小。最终报告的数字必须在带框的最终答案中以无单位形式呈现，但在整个推导过程和问题陈述中必须使用单位。",
            "solution": "该问题要求推导和计算作为核磁偶极矩基本标度的核磁子。这涉及到结合经典电动力学和量子力学的原理。该问题分三部分解决：首先，核磁子的形式化定义；其次，在指定单位下进行数值计算；第三，估算核磁矩的典型大小。\n\n### 第一部分：核磁子的定义\n\n一个带电荷 $q$、质量为 $m$、轨道角动量为 $\\vec{L}$ 的经典点状粒子的磁偶极矩 $\\vec{\\mu}$ 由以下关系式给出：\n$$\n\\vec{\\mu} = \\frac{q}{2m} \\vec{L}\n$$\n该关系是通过考虑粒子在圆形轨道上运动（形成一个电流环）而推导出来的。量 $\\gamma = q/(2m)$ 被称为旋磁比。\n\n在核物理学中，相关粒子是质子和中子。特征电荷是基本电荷 $e$，特征质量是质子质量 $m_p$。对于一个质子，$q=e$ 且 $m=m_p$，因此关系式变为：\n$$\n\\vec{\\mu} = \\frac{e}{2m_p} \\vec{L}\n$$\n根据量子力学，角动量是量子化的。角动量的基本单位是约化普朗克常数 $\\hbar$。为了建立磁矩的自然标度，我们考虑与大小为 $\\hbar$ 的特征角动量相关联的磁矩。这就定义了核磁子，记为 $\\mu_N$。\n$$\n\\mu_N = \\frac{e\\hbar}{2m_p}\n$$\n这个量代表了由核子的轨道运动或点状质子的内禀自旋产生的磁矩的预期数量级。\n\n### 第二部分：核磁子的数值计算\n\n为了计算 $\\mu_N$ 的数值，我们使用 2018 年 CODATA 推荐的基本常数值：\n- 基本电荷, $e = 1.602176634 \\times 10^{-19}~\\mathrm{C}$\n- 约化普朗克常数, $\\hbar = 1.054571817 \\times 10^{-34}~\\mathrm{J \\cdot s}$\n- 质子质量, $m_p = 1.67262192369 \\times 10^{-27}~\\mathrm{kg}$\n\n$\\mu_N$ 的单位是 $(\\mathrm{C} \\cdot \\mathrm{J} \\cdot \\mathrm{s}) / \\mathrm{kg}$。我们需要将其表示为焦耳/特斯拉 ($\\mathrm{J/T}$)。磁偶极矩 $\\vec{\\mu}$ 在磁场 $\\vec{B}$ 中的能量 $U$ 为 $U = -\\vec{\\mu} \\cdot \\vec{B}$。这意味着磁矩的单位是能量除以磁场强度，即 $\\mathrm{J/T}$。我们可以验证这等价于更常见的单位安培·米平方 ($\\mathrm{A \\cdot m^2}$):\n$$\n\\frac{\\mathrm{J}}{\\mathrm{T}} = \\frac{\\mathrm{kg \\cdot m^2 \\cdot s^{-2}}}{\\mathrm{kg \\cdot s^{-2} \\cdot A^{-1}}} = \\mathrm{A \\cdot m^2}\n$$\n我们 $\\mu_N$ 表达式的单位是：\n$$\n\\frac{\\mathrm{C} \\cdot (\\mathrm{kg \\cdot m^2 \\cdot s^{-2}}) \\cdot s}{\\mathrm{kg}} = \\mathrm{C \\cdot m^2 \\cdot s^{-1}} = (\\mathrm{C \\cdot s^{-1}}) \\cdot \\mathrm{m^2} = \\mathrm{A \\cdot m^2}\n$$\n单位是一致的。现在我们以 $\\mathrm{J/T}$ 为单位对 $\\mu_N$ 进行数值计算。\n$$\n\\mu_N = \\frac{(1.602176634 \\times 10^{-19}) \\times (1.054571817 \\times 10^{-34})}{2 \\times (1.67262192369 \\times 10^{-27})}~\\mathrm{J/T}\n$$\n$$\n\\mu_N = \\frac{1.6896996638... \\times 10^{-53}}{3.34524384738 \\times 10^{-27}}~\\mathrm{J/T}\n$$\n$$\n\\mu_N = 0.50507837461... \\times 10^{-26}~\\mathrm{J/T}\n$$\n四舍五入到 $9$ 位有效数字，我们得到：\n$$\n\\mu_N = 5.05078375 \\times 10^{-27}~\\mathrm{J/T}\n$$\n接下来，我们将此值转换为兆电子伏特/特斯拉 ($\\mathrm{MeV/T}$)。问题中提供了换算因子：\n$$\n1~\\mathrm{MeV} = 1.602176634 \\times 10^{-13}~\\mathrm{J}\n$$\n因此，$1~\\mathrm{J} = (1 / (1.602176634 \\times 10^{-13}))~\\mathrm{MeV}$。\n$$\n\\mu_N~(\\text{in MeV/T}) = \\frac{\\mu_N~(\\text{in J/T})}{1.602176634 \\times 10^{-13}}\n$$\n$$\n\\mu_N = \\frac{5.0507837461... \\times 10^{-27}}{1.602176634 \\times 10^{-13}}~\\mathrm{MeV/T}\n$$\n$$\n\\mu_N = 3.152451296... \\times 10^{-14}~\\mathrm{MeV/T}\n$$\n四舍五入到 $9$ 位有效数字，我们得到：\n$$\n\\mu_N = 3.15245130 \\times 10^{-14}~\\mathrm{MeV/T}\n$$\n\n### 第三部分：典型核磁矩的估算\n\n具有自旋角动量 $\\vec{I}$ 的原子核的磁矩通常表示为：\n$$\n\\vec{\\mu} = g_N \\frac{e}{2m_p} \\vec{I} = g_N \\frac{\\mu_N}{\\hbar} \\vec{I}\n$$\n其中 $g_N$ 是无量纲的核 g 因子。磁矩的大小通常以其最大可观测分量来表示，即 $\\mu = g_N \\mu_N I$，其中 $I$ 是核自旋量子数。\n\n问题要求在无量纲旋磁因子 $g_N$ 和核自旋 $I$ 的量级为一（即 $g_N \\sim 1$ 和 $I \\sim 1$）的假设下，估算“典型大小”。这个假设有物理依据，因为对大多数原子核而言，$g_N$ 因子是单位数，而自旋量子数是小的整数或半整数。\n\n在这些近似下，核磁偶极矩的典型大小 $\\mu_{\\text{typical}}$ 为：\n$$\n\\mu_{\\text{typical}} \\approx (1) \\times \\mu_N \\times (1) = \\mu_N\n$$\n因此，核磁子 $\\mu_N$ 本身就代表了特征标度，也是对核磁偶极矩典型大小的合​​理估计。因此，所要求的值在数值上与第二部分中计算的 $\\mu_N$ 值相同。\n\n以 $\\mathrm{J/T}$ 为单位的典型大小估计值：\n$$\n\\mu_{\\text{typical}} = 5.05078375 \\times 10^{-27}~\\mathrm{J/T}\n$$\n以 $\\mathrm{MeV/T}$ 为单位的典型大小估计值：\n$$\n\\mu_{\\text{typical}} = 3.15245130 \\times 10^{-14}~\\mathrm{MeV/T}\n$$\n\n所要求的四个值按顺序分别为：以 $\\mathrm{J/T}$ 为单位的核磁子，以 $\\mathrm{MeV/T}$ 为单位的核磁子，以 $\\mathrm{J/T}$ 为单位的核矩典型大小，以及以 $\\mathrm{MeV/T}$ 为单位的核矩典型大小。",
            "answer": "$$\\boxed{\\begin{pmatrix} 5.05078375 \\times 10^{-27}  3.15245130 \\times 10^{-14}  5.05078375 \\times 10^{-27}  3.15245130 \\times 10^{-14} \\end{pmatrix}}$$"
        },
        {
            "introduction": "现代核结构计算由于多体波函数的复杂性而很少直接处理它，转而采用更简洁的描述方式，如单体密度矩阵。任何单体算符（例如电磁矩算符）的期望值都可以通过计算该算符的矩阵表示与单体密度矩阵乘积的迹来高效获得。这项实践介绍了计算多体物理学的一个基石，展示了一种计算可观测量强大的通用技术，并验证了其在基矢变换下的不变性。",
            "id": "3574860",
            "problem": "您的任务是为有限维单粒子基，从单体密度矩阵实现核电磁矩的评估。您的程序必须为一组固定的测试用例计算期望值，并按如下规定生成单行输出。\n\n基本出发点如下。在二次量子化形式中，任意一个单体算符通过在选定的单粒子基中的矩阵元作用于多体态。单体密度矩阵编码了在该基中双线性费米子算符的期望值。仅使用期望值的线性性质、费米子的正则反对易关系以及二次量子化中单体算符的定义。基于这些，推导出单体算符矩阵与单体密度矩阵之间的正确缩并，从而得到可观测量的期望值。然后，实现一个计算程序，该程序：\n- 在一个共同的正交归一单粒子基中，接受厄米算符矩阵和厄米单体密度矩阵，\n- 正确处理复值矩阵，\n- 并且在单粒子基的幺正变换下，保持期望值的不变性。\n\n本问题中所有的物理结果代表一个固定原子核的电四极矩，并且必须以 $e \\cdot \\mathrm{fm}^{2}$ 为单位表示。您的程序必须输出四舍五入到八位小数的结果。角度（如果存在）以弧度为单位。\n\n测试套件。实现以下四个测试用例。对于每一个用例，计算电磁矩的期望值，结果为浮点数，单位为 $e \\cdot \\mathrm{fm}^{2}$：\n\n- 用例1（基本实数矩阵）：\n  - 维度 $d = 2$。\n  - 算符矩阵 $O_{(1)}$，单位 $e \\cdot \\mathrm{fm}^{2}$：\n    $$\n    O_{(1)} = \\begin{bmatrix}\n    1.0  0.2 \\\\\n    0.2  -0.5\n    \\end{bmatrix}.\n    $$\n  - 单体密度矩阵 $\\rho_{(1)}$（无量纲）：\n    $$\n    \\rho_{(1)} = \\begin{bmatrix}\n    1.0  0.3 \\\\\n    0.3  1.0\n    \\end{bmatrix}.\n    $$\n  - 计算期望值，单位 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 用例2（复厄米矩阵）：\n  - 维度 $d = 3$。\n  - 算符矩阵 $O_{(2)}$，单位 $e \\cdot \\mathrm{fm}^{2}$：\n    $$\n    O_{(2)} =\n    \\begin{bmatrix}\n    0.5  0.1 + 0.2 i  0.0 \\\\\n    0.1 - 0.2 i  -0.3  0.05 \\\\\n    0.0  0.05  0.2\n    \\end{bmatrix}.\n    $$\n  - 单体密度矩阵 $\\rho_{(2)}$（无量纲）：\n    $$\n    \\rho_{(2)} =\n    \\begin{bmatrix}\n    1.0  0.2 - 0.1 i  0.0 \\\\\n    0.2 + 0.1 i  0.6  0.3 \\\\\n    0.0  0.3  0.2\n    \\end{bmatrix}.\n    $$\n  - 计算期望值，单位 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 用例3（幺正基不变性检验）：\n  - 使用与用例2中相同的 $O_{(2)}$ 和 $\\rho_{(2)}$。\n  - 定义一个幺正变换 $U$ 为乘积 $U = R \\, D$，其中：\n    - $R$ 是在 $0$–$1$ 子空间中旋转角度 $t = 0.7$（弧度）的旋转矩阵：\n      $$\n      R = \\begin{bmatrix}\n      \\cos t  \\sin t  0 \\\\\n      -\\sin t  \\cos t  0 \\\\\n      0  0  1\n      \\end{bmatrix}.\n      $$\n    - $D$ 是一个对角相位矩阵，相位为 $\\alpha = 0.2$ 和 $\\beta = -0.5$：\n      $$\n      D = \\mathrm{diag}\\!\\left(1, e^{i \\alpha}, e^{i \\beta}\\right).\n      $$\n  - 通过 $O' = U^{\\dagger} O_{(2)} U$ 和 $\\rho' = U^{\\dagger} \\rho_{(2)} U$ 将输入变换到旋转后的基。\n  - 使用旋转后的矩阵 $O'$ 和 $\\rho'$ 计算期望值，单位 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 用例4（来自归一化态矢量的秩一密度）：\n  - 维度 $d = 3$。\n  - 算符矩阵 $O_{(4)}$（单位 $e \\cdot \\mathrm{fm}^{2}$）是对角矩阵：\n    $$\n    O_{(4)} = \\mathrm{diag}\\!\\left(2.0, -1.0, 0.5\\right).\n    $$\n  - 定义一个带有非平凡相位的归一化态矢量 $v$：\n    $$\n    v = \\begin{bmatrix}\n    \\sqrt{0.7} \\\\\n    e^{i \\cdot 0.3} \\sqrt{0.3} \\\\\n    0\n    \\end{bmatrix}.\n    $$\n  - 将单体密度矩阵构造为 $\\rho_{(4)} = v \\, v^{\\dagger}$（无量纲）。\n  - 计算期望值，单位 $e \\cdot \\mathrm{fm}^{2}$。\n\n算法和数值要求：\n- 您的实现必须基于所述的基本定义，并且必须能处理复值输入。\n- 对于所有用例，确保在进行缩并时，算符矩阵和密度矩阵使用相同的单粒子基。\n- 对于用例3，在计算期望值之前执行指定的幺正相似变换，并依赖于在此类变换下的不变性。\n- 将每个最终结果四舍五入到八位小数。\n- 程序必须生成单行输出，其中包含用方括号括起来的逗号分隔列表，没有空格，例如 $[r_{1},r_{2},r_{3},r_{4}]$，其中每个 $r_{k}$ 是一个浮点数，单位为 $e \\cdot \\mathrm{fm}^{2}$，并四舍五入到八位小数。\n\n您的输出必须是符合上述格式的单行。不应打印任何额外文本。",
            "solution": "问题要求计算一个单体可观测量在多体量子态中的期望值。该可观测量由矩阵 $O$ 表示，多体量子态由单体密度矩阵 $\\rho$ 描述。从第一性原理推导计算公式为实现提供了必要的理论基础。\n\n让我们考虑一个由正交归一基 $\\{|k\\rangle\\}_{k=1}^d$ 张成的有限维单粒子希尔伯特空间。在二次量子化中，任意一个单体算符 $\\hat{O}$ 可以用与该基对应的费米子产生 ($a_k^\\dagger$) 和湮灭 ($a_k$) 算符表示：\n$$\n\\hat{O} = \\sum_{i,j=1}^d O_{ij} a_i^\\dagger a_j\n$$\n其中 $O_{ij} = \\langle i | \\hat{O}_{\\mathrm{op}} | j \\rangle$ 是初次量子化算符 $\\hat{O}_{\\mathrm{op}}$ 在所选基中的矩阵元。具有元素 $O_{ij}$ 的矩阵 $O$ 是厄米矩阵，因为物理可观测量对应于厄米算符。\n\n多体系统的状态由一个态矢量 $|\\Psi\\rangle$ 描述。所有关于单体可观测量的信息都编码在单体密度矩阵 $\\rho$ 中。密度矩阵的元素被定义为产生和湮灭算符双线性乘积的期望值：\n$$\n\\rho_{ji} = \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle\n$$\n在这里，索引的排序遵循核物理学中的一个通用约定。具有元素 $\\rho_{ij}$ 的矩阵 $\\rho$ 也是厄米矩阵，这可以通过取复共轭来证明：$(\\rho_{ji})^* = \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle^* = \\langle \\Psi | (a_i^\\dagger a_j)^\\dagger | \\Psi \\rangle = \\langle \\Psi | a_j^\\dagger a_i | \\Psi \\rangle = \\rho_{ij}$。\n\n算符 $\\hat{O}$ 在态 $|\\Psi\\rangle$ 中的期望值由 $\\langle \\hat{O} \\rangle = \\langle \\Psi | \\hat{O} | \\Psi \\rangle$ 给出。代入 $\\hat{O}$ 的二次量子化形式并利用期望值的线性性质，我们得到：\n$$\n\\langle \\hat{O} \\rangle = \\left\\langle \\Psi \\left| \\sum_{i,j=1}^d O_{ij} a_i^\\dagger a_j \\right| \\Psi \\right\\rangle = \\sum_{i,j=1}^d O_{ij} \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle\n$$\n识别出密度矩阵元素 $\\rho_{ji}$ 的定义，该表达式变为：\n$$\n\\langle \\hat{O} \\rangle = \\sum_{i,j=1}^d O_{ij} \\rho_{ji}\n$$\n这个和恰好是矩阵乘积 $O\\rho$ 的迹的定义。乘积矩阵 $O\\rho$ 的第 $i$ 个对角元素是 $(O\\rho)_{ii} = \\sum_{j=1}^d O_{ij} \\rho_{ji}$。对 $i$ 求和得到迹：\n$$\n\\mathrm{Tr}(O\\rho) = \\sum_{i=1}^d (O\\rho)_{ii} = \\sum_{i,j=1}^d O_{ij} \\rho_{ji}\n$$\n因此，单体算符期望值的基本公式是：\n$$\n\\langle \\hat{O} \\rangle = \\mathrm{Tr}(O \\rho)\n$$\n由于 $O$ 和 $\\rho$ 是厄米矩阵 ($O=O^\\dagger$, $\\rho=\\rho^\\dagger$)，期望值必须是一个实数。这一点可以通过以下方式得到证实：注意到 $\\mathrm{Tr}(O\\rho)^* = \\mathrm{Tr}((O\\rho)^\\dagger) = \\mathrm{Tr}(\\rho^\\dagger O^\\dagger) = \\mathrm{Tr}(\\rho O)$。利用迹的循环性质 $\\mathrm{Tr}(\\rho O) = \\mathrm{Tr}(O \\rho)$，我们看到 $\\mathrm{Tr}(O\\rho)^* = \\mathrm{Tr}(O \\rho)$，这证明了结果是实数。\n\n这个期望值是一个物理可观测量，必须与单粒子基的选择无关。从基 $\\{|k\\rangle\\}$ 到一个新的正交归一基 $\\{|k'\\rangle\\}$ 的基变换由一个幺正矩阵 $U$ 表示。新基中的算符和密度矩阵由相似变换 $O' = U^\\dagger O U$ 和 $\\rho' = U^\\dagger \\rho U$ 给出。在新基中计算的期望值是：\n$$\n\\langle \\hat{O} \\rangle' = \\mathrm{Tr}(O'\\rho') = \\mathrm{Tr}\\left( (U^\\dagger O U) (U^\\dagger \\rho U) \\right)\n$$\n使用 $U U^\\dagger = I$（其中 $I$ 是单位矩阵）和迹的循环性质：\n$$\n\\mathrm{Tr}(O'\\rho') = \\mathrm{Tr}(U^\\dagger O (U U^\\dagger) \\rho U) = \\mathrm{Tr}(U^\\dagger O \\rho U) = \\mathrm{Tr}((O \\rho) U U^\\dagger) = \\mathrm{Tr}(O\\rho)\n$$\n这证实了期望值在幺正变换下的不变性，这是在用例3中检验的一个关键原则。\n\n实现直接应用了这些原则。每个测试用例的期望值是通过计算给定算符矩阵和密度矩阵乘积的迹得到的。\n\n- 对于用例1和用例2，我们直接使用提供的实数和复厄米矩阵计算 $\\mathrm{Tr}(O\\rho)$。用例2的计算涉及复数算术，但最终结果保证是实数。\n\n- 对于用例3，我们首先构造幺正变换矩阵 $U = R D$，其中 $R$ 是一个旋转矩阵，$D$ 是一个对角相位矩阵。然后我们将用例2中的算符和密度矩阵变换到新基：$O' = U^\\dagger O_{(2)} U$ 和 $\\rho' = U^\\dagger \\rho_{(2)} U$。期望值计算为 $\\mathrm{Tr}(O'\\rho')$。结果必须与用例2的结果相同，从而为基不变性提供了数值检验。\n\n- 对于用例4，密度矩阵对应于由归一化矢量 $v$ 表示的纯态。密度矩阵被构造为投影算子 $\\rho_{(4)} = v v^\\dagger$。然后期望值计算为 $\\mathrm{Tr}(O_{(4)} \\rho_{(4)})$。这等价于更熟悉的纯态公式 $\\langle v | \\hat{O} | v \\rangle = v^\\dagger O_{(4)} v$，这可以通过迹的循环性质来证明：$\\mathrm{Tr}(O_{(4)} v v^\\dagger) = \\mathrm{Tr}(v^\\dagger O_{(4)} v)$。由于 $v^\\dagger O_{(4)} v$ 是一个 $1 \\times 1$ 的矩阵（一个标量），它的迹就是这个标量本身。\n\n所有计算都使用数值矩阵代数执行，最终结果按要求四舍五入到八位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    # Case 1\n    O1 = np.array([[1.0, 0.2], [0.2, -0.5]], dtype=float)\n    rho1 = np.array([[1.0, 0.3], [0.3, 1.0]], dtype=float)\n    r1 = np.trace(O1 @ rho1)\n\n    # Case 2\n    O2 = np.array([[0.5, 0.1+0.2j, 0.0], [0.1-0.2j, -0.3, 0.05], [0.0, 0.05, 0.2]], dtype=complex)\n    rho2 = np.array([[1.0, 0.2-0.1j, 0.0], [0.2+0.1j, 0.6, 0.3], [0.0, 0.3, 0.2]], dtype=complex)\n    r2 = np.trace(O2 @ rho2).real\n\n    # Case 3\n    t = 0.7\n    alpha = 0.2\n    beta = -0.5\n    cos_t = np.cos(t)\n    sin_t = np.sin(t)\n    R = np.array([[cos_t, sin_t, 0], [-sin_t, cos_t, 0], [0, 0, 1]], dtype=float)\n    D = np.diag([1, np.exp(1j*alpha), np.exp(1j*beta)])\n    U = R @ D\n    O_prime = U.conj().T @ O2 @ U\n    rho_prime = U.conj().T @ rho2 @ U\n    r3 = np.trace(O_prime @ rho_prime).real\n\n    # Case 4\n    O4 = np.diag([2.0, -1.0, 0.5])\n    v = np.array([np.sqrt(0.7), np.exp(1j*0.3)*np.sqrt(0.3), 0], dtype=complex)\n    rho4 = np.outer(v, v.conj())\n    r4 = np.trace(O4 @ rho4).real\n\n    # Format and print the final output as a single line\n    print(f\"[{r1:.8f},{r2:.8f},{r3:.8f},{r4:.8f}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "壳模型计算通常在截断的模型空间中进行，这意味着必须有效地包含该空间之外的物理效应，例如核芯极化。这可以通过为质子和中子引入有效电荷来实现，这些电荷并非基本常数，而是吸收了复杂核芯激发物理的有效模型参数。这项高级练习将演示如何通过使用实验数据来确定这些有效电荷，从而架起理论与实验之间的桥梁，这是一个计算物理学中常见的反问题，展示了理论模型如何被校准和验证。",
            "id": "3574819",
            "problem": "给定一个关于核壳模型中核电磁矩的计算任务。目标是分析谱学四极矩对质子和中子有效电荷的敏感性，并确定能再现实验谱学四极矩的有效电荷。你的推导和算法必须从电磁四极张量的基本定义和标准的角动量代数出发，不得使用目标快捷方式。\n\n使用以下基本依据：\n- 原子核的电四极张量算符由原子核的电荷分布和位置算符构建，构成一个2阶球张量。\n- 在壳模型中，总电四极算符是质子和中子贡献的总和，其中中子通过核心极化，以有效电荷分配的方式产生有效贡献。\n- 球张量算符在角动量本征态之间的矩阵元可通过维格纳-埃卡特定理 (Wigner–Eckart theorem)进行因式分解，该定理将角度依赖性从约化矩阵元中分离出来。\n- 总角动量为 $J$ 的状态的谱学四极矩定义为四极张量在 $M=J$ 投影下于实验室坐标系中的期望值。\n\n从此基础出发，推导一个线性模型，将一个状态的谱学四极矩与质子贡献和中子贡献的组合联系起来，每个贡献都由一个有效电荷进行缩放。展示谱学四极矩对每个有效电荷的敏感性是如何由该状态相应的结构系数决定的。然后，通过求解一个线性反问题，推导出一个适定的计算方法，从一个或多个测量的谱学四极矩中推断出有效电荷。你的方法必须使用一个基于第一性原理的稳定方法来处理恰定系统、超定系统和欠定系统的情况。\n\n实现一个程序，该程序：\n- 使用质子和中子的态依赖结构系数数组以及相应的实验谱学四极矩，构建一个或多个状态的线性系统。\n- 通过最小化平方失配来求解质子和中子有效电荷，可选择使用吉洪诺夫（岭）正则化 (Tikhonov (ridge) regularization)，这在欠定或病态情况下保证了唯一的最小范数解。\n- 通过对推导出的线性模型求导，计算每个状态的谱学四极矩对每个有效电荷的局部敏感性。敏感性无需打印，但必须指导算法设计。\n\n测试套件的数值和物理设置：\n- 对于下面的每个测试用例，给定与角动量为 $J$ 的状态相对应的裸结构系数数组。这些系数是相应状态的裸质子和裸中子四极算符的谱学贡献，以 $\\mathrm{fm}^2$ 为单位。测量的谱学四极矩以 $e \\,\\mathrm{fm}^2$ 为单位。有效电荷是无量纲的，应不带单位报告。每个测试用例还指定了一个非负的正则化强度 $\\lambda$；使用 $\\lambda=0$ 恢复摩尔-彭若斯 (Moore–Penrose) 最小范数解，使用 $\\lambda>0$ 进行吉洪诺夫正则化。\n- 设设计矩阵由每个状态的裸质子和裸中子谱学系数组成的行向量构成，数据向量收集这些状态的测量谱学四极矩。通过最小化平方残差加上强度为 $\\lambda$ 的正则化惩罚项来求解线性反问题。\n\n测试套件（三个用例）：\n- 用例 A（理想情况，恰定）：\n  - 状态数：$N=\\{2\\}$，其中 $J=\\{2,2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,12.0,\\,-8.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,3.5,\\,2.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,17.35,\\,-9.4\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n- 用例 B（欠定，一个方程，两个未知数；恢复最小范数解）：\n  - 状态数：$N=\\{1\\}$，其中 $J=\\{2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,10.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,4.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,18.0\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n- 用例 C（超定，且存在近共线性，以测试稳定性和敏感性）：\n  - 状态数：$N=\\{3\\}$，其中 $J=\\{2,2,2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,5.0,\\,15.0,\\,-7.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,2.0,\\,6.0,\\,3.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,8.2,\\,24.6,\\,-8.0\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n\n编程要求：\n- 对每个用例，通过堆叠由相应裸系数构成的行向量，构建一个大小为 $N\\times 2$ 的设计矩阵。\n- 通过最小化正则化最小二乘目标函数来求解有效电荷的双分量向量，正则化强度为 $\\lambda$。使用数值稳定的方法。如果 $\\lambda=0$，则简化为摩尔-彭若斯 (Moore–Penrose) 伪逆（最小范数）解。如果 $\\lambda>0$，则对应于吉洪诺夫正则化。\n- 程序必须计算每个测试用例的解，并仅按指定的最终格式输出每个用例的质子和中子有效电荷。\n\n最终输出格式：\n- 你的程序应生成一行输出，包含一个用方括号括起来的逗号分隔列表。每个项目必须是一个子列表 $[e_p^{\\mathrm{eff}},e_n^{\\mathrm{eff}}]$，其中两个值都四舍五入到六位小数，按A、B、C的顺序对应于相应的测试用例。例如：$[[e_{p,A},e_{n,A}],[e_{p,B},e_{n,B}],[e_{p,C},e_{n,C}]]$。\n- 所有输出都是无量纲数。不应打印任何物理单位。",
            "solution": "我们从有限原子核的电磁四极张量算符开始。球坐标分量下的电四极张量定义为\n$$\n\\hat{Q}_{2\\mu} = \\sum_{i=1}^{A} \\hat{q}_i \\, r_i^2 \\, Y_{2\\mu}(\\hat{\\mathbf{r}}_i),\n$$\n其中 $A$ 是核子数，$\\hat{q}_i$ 是作用在第 $i$ 个核子上的电荷算符，$r_i$ 是其径向坐标，$Y_{2\\mu}$ 是一个球谐函数。在壳模型的描述中，中子通过核心极化对电磁可观测量做出贡献，这通过引入质子和中子有效电荷来解释，记为 $e_p^{\\mathrm{eff}}$ 和 $e_n^{\\mathrm{eff}}$，它们作为无量纲的缩放因子乘以相应的裸质子和裸中子四极算符。\n\n设 $\\lvert J M \\rangle$ 表示一个总角动量为 $J$、投影为 $M$ 的核本征态。谱学四极矩 $Q_s$ 定义为在拉伸投影 $M=J$ 下，$\\mu=0$ 分量在实验室坐标系中的期望值，\n$$\nQ_s(J) \\equiv \\langle J J \\lvert \\hat{Q}_{20} \\rvert J J \\rangle.\n$$\n根据维格纳-埃卡特 (Wigner–Eckart) 定理，$\\hat{Q}_{2\\mu}$ 的约化矩阵元将角动量依赖性因式分解，因此 $Q_s(J)$ 与相应的约化矩阵元 $\\langle J \\lVert \\hat{Q}_2 \\rVert J \\rangle$ 乘以一个已知的角度因子成正比。在壳模型中，该算符分解为质子部分和中子部分之和。引入有效电荷导致裸质子和裸中子对 $Q_s(J)$ 的贡献呈线性缩放：\n$$\nQ_s(J) = e_p^{\\mathrm{eff}}\\; q_p(J) + e_n^{\\mathrm{eff}}\\; q_n(J),\n$$\n其中 $q_p(J)$ 和 $q_n(J)$ 分别是从裸质子和裸中子四极算符得到的自旋为 $J$ 的状态的谱学贡献（单位为 $\\mathrm{fm}^2$）。这种线性关系直接源于期望值的线性性质以及算符分解为质子和中子部分并乘以标量有效电荷。\n\n敏感性。对线性模型关于 $e_p^{\\mathrm{eff}}$ 和 $e_n^{\\mathrm{eff}}$ 求导，立即得到给定状态的敏感性：\n$$\n\\frac{\\partial Q_s(J)}{\\partial e_p^{\\mathrm{eff}}} = q_p(J), \\qquad\n\\frac{\\partial Q_s(J)}{\\partial e_n^{\\mathrm{eff}}} = q_n(J).\n$$\n因此，结构系数 $q_p(J)$ 和 $q_n(J)$ 完全决定了每个有效电荷的微小变化如何影响 $Q_s(J)$。\n\n跨多个状态的反问题。对于 $N$ 个测量状态，我们将线性关系整理成矩阵形式。设\n$$\n\\mathbf{A} = \n\\begin{bmatrix}\nq_p(J_1)  q_n(J_1) \\\\\n\\vdots  \\vdots \\\\\nq_p(J_N)  q_n(J_N)\n\\end{bmatrix}\n\\in \\mathbb{R}^{N\\times 2}, \\quad\n\\mathbf{e} =\n\\begin{bmatrix}\ne_p^{\\mathrm{eff}} \\\\ e_n^{\\mathrm{eff}}\n\\end{bmatrix} \\in \\mathbb{R}^{2}, \\quad\n\\mathbf{b} =\n\\begin{bmatrix}\nQ_s^{(\\mathrm{exp})}(J_1) \\\\ \\vdots \\\\ Q_s^{(\\mathrm{exp})}(J_N)\n\\end{bmatrix}\\in \\mathbb{R}^{N}.\n$$\n正演模型为 $\\mathbf{A}\\mathbf{e}=\\mathbf{b}$。为了对任意 $N$ 都能稳健地推断 $\\mathbf{e}$，我们构建正则化最小二乘问题\n$$\n\\min_{\\mathbf{e}\\in\\mathbb{R}^2}\\; \\lVert \\mathbf{A}\\mathbf{e}-\\mathbf{b}\\rVert_2^2 + \\lambda^2 \\lVert \\mathbf{e}\\rVert_2^2,\n$$\n正则化强度 $\\lambda \\ge 0$。该问题有唯一解\n$$\n\\mathbf{e}_\\lambda = (\\mathbf{A}^\\mathsf{T}\\mathbf{A} + \\lambda^2 \\mathbf{I})^{-1}\\mathbf{A}^\\mathsf{T}\\mathbf{b}.\n$$\n等价地，用奇异值分解 $\\mathbf{A}=\\mathbf{U}\\mathbf{\\Sigma}\\mathbf{V}^\\mathsf{T}$（其中奇异值为 $\\{\\sigma_k\\}$）表示，解为\n$$\n\\mathbf{e}_\\lambda = \\mathbf{V}\\,\\mathrm{diag}\\!\\left(\\frac{\\sigma_k}{\\sigma_k^2+\\lambda^2}\\right)\\mathbf{U}^\\mathsf{T}\\mathbf{b},\n$$\n当 $\\lambda=0$ 时，该解简化为摩尔-彭若斯 (Moore–Penrose) 最小范数伪逆解。这种基于SVD的形式是数值稳定的，并揭示了由 $\\lambda$ 控制的对小奇异值（病态条件）的敏感性。\n\n程序的算法设计：\n- 对每个测试用例，根据给定的 $q_p(J_i)$ 和 $q_n(J_i)$ 构建 $\\mathbf{A}$，并根据 $Q_s^{(\\mathrm{exp})}(J_i)$ 构建 $\\mathbf{b}$。\n- 使用上述基于SVD的公式和指定的 $\\lambda$ 计算 $\\mathbf{e}_\\lambda$。\n- 尽管敏感性 $\\partial Q_s/\\partial e_p^{\\mathrm{eff}}=q_p(J_i)$ 和 $\\partial Q_s/\\partial e_n^{\\mathrm{eff}}=q_n(J_i)$ 不被打印，但它们直接构成了求解器使用的雅可比矩阵（矩阵 $\\mathbf{A}$ 正是雅可比矩阵）。\n- 将 $\\mathbf{e}_\\lambda$ 的每个分量四舍五入到六位小数，并按照要求的格式输出。\n\n对所提供测试套件的解析检验：\n- 用例 A:\n  - 数据：$q_p=[\\,12.0,\\,-8.0\\,]$，$q_n=[\\,3.5,\\,2.0\\,]$，$Q_s^{(\\mathrm{exp})}=[\\,17.35,\\,-9.4\\,]$，$\\lambda=0.0$。\n  - 线性系统为\n    $12.0\\,e_p^{\\mathrm{eff}} + 3.5\\,e_n^{\\mathrm{eff}} = 17.35$ 和 $-8.0\\,e_p^{\\mathrm{eff}} + 2.0\\,e_n^{\\mathrm{eff}} = -9.4$，\n    恰好得到 $e_p^{\\mathrm{eff}}=1.3$ 和 $e_n^{\\mathrm{eff}}=0.5$。\n- 用例 B:\n  - 数据：$q_p=[\\,10.0\\,]$，$q_n=[\\,4.0\\,]$，$Q_s^{(\\mathrm{exp})}=[\\,18.0\\,]$，$\\lambda=0.0$。\n  - 只有一个方程和两个未知数，摩尔-彭若斯 (Moore–Penrose) 最小范数解与 $\\mathbf{A}$ 的行向量对齐：\n    $\\mathbf{e}_0 = \\mathbf{A}^\\mathsf{T}(\\mathbf{A}\\mathbf{A}^\\mathsf{T})^{-1}\\mathbf{b}\n    = \\dfrac{18.0}{10.0^2+4.0^2}\\begin{bmatrix}10.0\\\\4.0\\end{bmatrix}\n    = \\begin{bmatrix}1.551724\\ldots\\\\0.620689\\ldots\\end{bmatrix}$。\n- 用例 C:\n  - 数据：$q_p=[\\,5.0,\\,15.0,\\,-7.0\\,]$，$q_n=[\\,2.0,\\,6.0,\\,3.0\\,]$，$Q_s^{(\\mathrm{exp})}=[\\,8.2,\\,24.6,\\,-8.0\\,]$，$\\lambda=0.0$。\n  - 数据与 $e_p^{\\mathrm{eff}}=1.4$ 和 $e_n^{\\mathrm{eff}}=0.6$ 完全一致，因此最小二乘解能精确地恢复这些值。\n\n因此，程序必须为这三种情况计算向量 $[\\,e_p^{\\mathrm{eff}},e_n^{\\mathrm{eff}}\\,]$，并打印形如 $[[e_{p,A},e_{n,A}],[e_{p,B},e_{n,B}],[e_{p,C},e_{n,C}]]$ 的单行输出，其中每个数字都四舍五入到六位小数。所有输出都是无量纲的，因此打印的行中不应出现物理单位。",
            "answer": "```python\nimport numpy as np\n\ndef tikhonov_solution(A: np.ndarray, b: np.ndarray, lam: float) -> np.ndarray:\n    \"\"\"\n    Compute the 2-parameter Tikhonov-regularized solution e to minimize\n    ||A e - b||_2^2 + lam^2 ||e||_2^2 using a stable method.\n    For lam=0, this reduces to the Moore-Penrose minimum-norm solution.\n    \"\"\"\n    if lam  0:\n        raise ValueError(\"Regularization parameter lam must be nonnegative.\")\n    \n    if lam == 0.0:\n        # Use the Moore-Penrose pseudoinverse for the minimum-norm least-squares solution.\n        # This is stable for all cases: exactly determined, overdetermined, and underdetermined.\n        e = np.linalg.pinv(A) @ b\n    else:\n        # Standard Tikhonov (ridge regression) solution.\n        A_T_A = A.T @ A\n        A_T_b = A.T @ b\n        I = np.identity(A.shape[1])\n        e = np.linalg.inv(A_T_A + lam**2 * I) @ A_T_b\n    return e\n\ndef solve():\n    \"\"\"\n    Solves for effective charges for the three test cases and prints the result.\n    \"\"\"\n    # Case A: exactly determined (2 states)\n    qp_A = np.array([12.0, -8.0], dtype=float)\n    qn_A = np.array([3.5, 2.0], dtype=float)\n    Qexp_A = np.array([17.35, -9.4], dtype=float)\n    lam_A = 0.0\n    A_A = np.column_stack([qp_A, qn_A])\n    sol_A = tikhonov_solution(A_A, Qexp_A, lam_A)\n\n    # Case B: underdetermined (1 state), minimum-norm solution\n    qp_B = np.array([10.0], dtype=float)\n    qn_B = np.array([4.0], dtype=float)\n    Qexp_B = np.array([18.0], dtype=float)\n    lam_B = 0.0\n    A_B = np.column_stack([qp_B, qn_B])\n    sol_B = tikhonov_solution(A_B, Qexp_B, lam_B)\n\n    # Case C: overdetermined with consistent data\n    qp_C = np.array([5.0, 15.0, -7.0], dtype=float)\n    qn_C = np.array([2.0, 6.0, 3.0], dtype=float)\n    Qexp_C = np.array([8.2, 24.6, -8.0], dtype=float)\n    lam_C = 0.0\n    A_C = np.column_stack([qp_C, qn_C])\n    sol_C = tikhonov_solution(A_C, Qexp_C, lam_C)\n\n    results = [\n        [round(sol_A[0], 6), round(sol_A[1], 6)],\n        [round(sol_B[0], 6), round(sol_B[1], 6)],\n        [round(sol_C[0], 6), round(sol_C[1], 6)]\n    ]\n\n    # Produce output in the specified format: [[epA,enA],[epB,enB],[epC,enC]]\n    # The str() representation of a list of lists is correct, but we must remove spaces.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}