{
    "hands_on_practices": [
        {
            "introduction": "在现代核结构计算中，由于多体波函数的复杂性，我们通常不直接处理它，而是采用更紧凑的表示，例如单体密度矩阵（OBDM）。本练习介绍了一个基本公式 $\\langle \\hat{O} \\rangle = \\mathrm{Tr}(O \\rho)$，这是在多体系统中计算任何单体可观测量（包括电磁矩）的基石。通过这项实践，您将巩固对这一强大形式主义及其在不同基底下不变性的理解 。",
            "id": "3574860",
            "problem": "您的任务是为有限维单粒子基实现从单体密度矩阵计算原子核电磁矩。您的程序必须计算一组固定测试用例的期望值，并产生一行指定的输出。\n\n基本出发点如下。在二次量子化形式中，任意一个单体算符通过在所选单粒子基中的矩阵元作用于多体态。单体密度矩阵在该基中编码了双线性费米子算符的期望值。请仅使用期望值的线性性质、费米子的正则反对易关系以及二次量子化中单体算符的定义。由此，推导出单体算符矩阵与单体密度矩阵之间的正确缩并，从而得到可观测量的期望值。然后，实现一个计算程序，该程序：\n- 接受在共同正交归一单粒子基中的厄米算符矩阵和厄米单体密度矩阵，\n- 正确处理复数值矩阵，\n- 并遵守期望值在单粒子基的幺正变换下的不变性。\n\n本问题中所有物理结果均代表某个固定原子核的电四极矩，并且必须以 $e \\cdot \\mathrm{fm}^{2}$ 为单位表示。您的程序必须输出四舍五入到八位小数的结果。角度（如果存在）以弧度为单位给出。\n\n测试套件。实现以下四个测试用例。对每个用例，计算电磁矩的期望值，结果为浮点数，单位为 $e \\cdot \\mathrm{fm}^{2}$：\n\n- 情况1（基本实数矩阵）：\n  - 维度 $d = 2$。\n  - 算符矩阵 $O_{(1)}$，单位为 $e \\cdot \\mathrm{fm}^{2}$：\n    $$\n    O_{(1)} = \\begin{bmatrix}\n    1.0  0.2 \\\\\n    0.2  -0.5\n    \\end{bmatrix}.\n    $$\n  - 单体密度矩阵 $\\rho_{(1)}$（无量纲）：\n    $$\n    \\rho_{(1)} = \\begin{bmatrix}\n    1.0  0.3 \\\\\n    0.3  1.0\n    \\end{bmatrix}.\n    $$\n  - 计算期望值，单位为 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 情况2（复数厄米矩阵）：\n  - 维度 $d = 3$。\n  - 算符矩阵 $O_{(2)}$，单位为 $e \\cdot \\mathrm{fm}^{2}$：\n    $$\n    O_{(2)} =\n    \\begin{bmatrix}\n    0.5  0.1 + 0.2 i  0.0 \\\\\n    0.1 - 0.2 i  -0.3  0.05 \\\\\n    0.0  0.05  0.2\n    \\end{bmatrix}.\n    $$\n  - 单体密度矩阵 $\\rho_{(2)}$（无量纲）：\n    $$\n    \\rho_{(2)} =\n    \\begin{bmatrix}\n    1.0  0.2 - 0.1 i  0.0 \\\\\n    0.2 + 0.1 i  0.6  0.3 \\\\\n    0.0  0.3  0.2\n    \\end{bmatrix}.\n    $$\n  - 计算期望值，单位为 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 情况3（幺正基不变性检验）：\n  - 使用与情况2中相同的 $O_{(2)}$ 和 $\\rho_{(2)}$。\n  - 定义一个幺正变换 $U$ 作为乘积 $U = R \\, D$，其中：\n    - $R$ 是在 $0$–$1$ 子空间中旋转角度 $t = 0.7$（弧度）的旋转矩阵：\n      $$\n      R = \\begin{bmatrix}\n      \\cos t  \\sin t  0 \\\\\n      -\\sin t  \\cos t  0 \\\\\n      0  0  1\n      \\end{bmatrix}.\n      $$\n    - $D$ 是一个对角相位矩阵，相位为 $\\alpha = 0.2$ 和 $\\beta = -0.5$：\n      $$\n      D = \\mathrm{diag}\\!\\left(1, e^{i \\alpha}, e^{i \\beta}\\right).\n      $$\n  - 通过 $O' = U^{\\dagger} O_{(2)} U$ 和 $\\rho' = U^{\\dagger} \\rho_{(2)} U$ 将输入变换到旋转后的基。\n  - 使用旋转后的矩阵 $O'$ 和 $\\rho'$ 计算期望值，单位为 $e \\cdot \\mathrm{fm}^{2}$。\n\n- 情况4（由归一化态矢量得到的秩一密度）：\n  - 维度 $d = 3$。\n  - 算符矩阵 $O_{(4)}$（单位为 $e \\cdot \\mathrm{fm}^{2}$）是对角矩阵：\n    $$\n    O_{(4)} = \\mathrm{diag}\\!\\left(2.0, -1.0, 0.5\\right).\n    $$\n  - 定义一个具有非平凡相位的归一化态矢量 $v$：\n    $$\n    v = \\begin{bmatrix}\n    \\sqrt{0.7} \\\\\n    e^{i \\cdot 0.3} \\sqrt{0.3} \\\\\n    0\n    \\end{bmatrix}.\n    $$\n  - 将单体密度矩阵构造为 $\\rho_{(4)} = v \\, v^{\\dagger}$（无量纲）。\n  - 计算期望值，单位为 $e \\cdot \\mathrm{fm}^{2}$。\n\n算法和数值要求：\n- 您的实现必须基于所述的基本定义，并且必须适用于复数值输入。\n- 对于所有情况，确保在进行缩并时，算符和密度矩阵使用相同的单粒子基。\n- 对于情况3，在计算期望值之前执行指定的幺正相似变换，并依赖于在此类变换下的不变性。\n- 将每个最终结果四舍五入到八位小数。\n- 程序必须产生单行输出，其中包含用方括号括起来的逗号分隔的结果列表，无空格，例如 $[r_{1},r_{2},r_{3},r_{4}]$，其中每个 $r_{k}$ 是一个以 $e \\cdot \\mathrm{fm}^{2}$ 为单位、四舍五入到八位小数的浮点数。\n\n您的输出必须是符合上述格式的单行文本。不应打印任何额外文本。",
            "solution": "该问题要求计算一个由矩阵 $O$ 表示的单体可观测量在由单体密度矩阵 $\\rho$ 描述的多体量子态中的期望值。从第一性原理推导计算公式为该实现提供了必要的理论基础。\n\n我们考虑一个由正交归一基 $\\{|k\\rangle\\}_{k=1}^d$ 张成的有限维单粒子希尔伯特空间。在二次量子化中，任意一个单体算符 $\\hat{O}$ 可以用与此基对应的费米子产生算符 ($a_k^\\dagger$) 和湮灭算符 ($a_k$) 表示：\n$$\n\\hat{O} = \\sum_{i,j=1}^d O_{ij} a_i^\\dagger a_j\n$$\n其中 $O_{ij} = \\langle i | \\hat{O}_{\\mathrm{op}} | j \\rangle$ 是一次量子化算符 $\\hat{O}_{\\mathrm{op}}$ 在所选基中的矩阵元。由于物理可观测量对应于厄米算符，所以由元素 $O_{ij}$ 构成的矩阵 $O$ 是厄米矩阵。\n\n多体系统的状态由一个态矢量 $|\\Psi\\rangle$ 描述。关于单体可观测量的一切信息都编码在单体密度矩阵 $\\rho$ 中。密度矩阵的矩阵元定义为产生和湮灭算符双线性乘积的期望值：\n$$\n\\rho_{ji} = \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle\n$$\n此处的指标排序遵循核物理学中的一个通用约定。由元素 $\\rho_{ij}$ 构成的矩阵 $\\rho$ 也是厄米矩阵，这可以通过取复共轭来验证：$(\\rho_{ji})^* = \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle^* = \\langle \\Psi | (a_i^\\dagger a_j)^\\dagger | \\Psi \\rangle = \\langle \\Psi | a_j^\\dagger a_i | \\Psi \\rangle = \\rho_{ij}$。\n\n算符 $\\hat{O}$ 在态 $|\\Psi\\rangle$ 中的期望值由 $\\langle \\hat{O} \\rangle = \\langle \\Psi | \\hat{O} | \\Psi \\rangle$ 给出。代入 $\\hat{O}$ 的二次量子化形式，并利用期望值的线性性质，我们得到：\n$$\n\\langle \\hat{O} \\rangle = \\left\\langle \\Psi \\left| \\sum_{i,j=1}^d O_{ij} a_i^\\dagger a_j \\right| \\Psi \\right\\rangle = \\sum_{i,j=1}^d O_{ij} \\langle \\Psi | a_i^\\dagger a_j | \\Psi \\rangle\n$$\n根据密度矩阵元 $\\rho_{ji}$ 的定义，该表达式变为：\n$$\n\\langle \\hat{O} \\rangle = \\sum_{i,j=1}^d O_{ij} \\rho_{ji}\n$$\n这个求和恰好是矩阵乘积 $O\\rho$ 的迹的定义。乘积矩阵 $O\\rho$ 的第 $i$ 个对角元素是 $(O\\rho)_{ii} = \\sum_{j=1}^d O_{ij} \\rho_{ji}$。对 $i$ 求和便得到迹：\n$$\n\\mathrm{Tr}(O\\rho) = \\sum_{i=1}^d (O\\rho)_{ii} = \\sum_{i,j=1}^d O_{ij} \\rho_{ji}\n$$\n因此，单体算符期望值的基本公式为：\n$$\n\\langle \\hat{O} \\rangle = \\mathrm{Tr}(O \\rho)\n$$\n由于 $O$ 和 $\\rho$ 是厄米矩阵（$O=O^\\dagger$, $\\rho=\\rho^\\dagger$），期望值必须是实数。这一点可以通过以下方式证实：$\\mathrm{Tr}(O\\rho)^* = \\mathrm{Tr}((O\\rho)^\\dagger) = \\mathrm{Tr}(\\rho^\\dagger O^\\dagger) = \\mathrm{Tr}(\\rho O)$。利用迹的循环性质 $\\mathrm{Tr}(\\rho O) = \\mathrm{Tr}(O \\rho)$，我们看到 $\\mathrm{Tr}(O\\rho)^* = \\mathrm{Tr}(O \\rho)$，这证明了结果是实数。\n\n该期望值是一个物理可观测量，必须与单粒子基的选择无关。从 $\\{|k\\rangle\\}$ 到新的正交归一基 $\\{|k'\\rangle\\}$ 的基变换由一个幺正矩阵 $U$ 表示。在新基中的算符和密度矩阵通过相似变换给出：$O' = U^\\dagger O U$ 和 $\\rho' = U^\\dagger \\rho U$。在新基中计算的期望值为：\n$$\n\\langle \\hat{O} \\rangle' = \\mathrm{Tr}(O'\\rho') = \\mathrm{Tr}\\left( (U^\\dagger O U) (U^\\dagger \\rho U) \\right)\n$$\n利用 $U U^\\dagger = I$（其中 $I$ 是单位矩阵）和迹的循环性质：\n$$\n\\mathrm{Tr}(O'\\rho') = \\mathrm{Tr}(U^\\dagger O (U U^\\dagger) \\rho U) = \\mathrm{Tr}(U^\\dagger O \\rho U) = \\mathrm{Tr}((O \\rho) U U^\\dagger) = \\mathrm{Tr}(O\\rho)\n$$\n这证实了期望值在幺正变换下的不变性，这是情况3中测试的一个关键原理。\n\n实现过程直接应用了这些原理。每个测试用例的期望值通过计算给定算符矩阵和密度矩阵乘积的迹来得到。\n\n- 对于情况1和情况2，我们直接使用所提供的实数和复数厄米矩阵计算 $\\mathrm{Tr}(O\\rho)$。情况2的计算涉及复数算术，但最终结果保证为实数。\n\n- 对于情况3，我们首先构造幺正变换矩阵 $U = R D$，其中 $R$ 是一个旋转矩阵，$D$ 是一个对角相位矩阵。然后，我们将情况2中的算符和密度矩阵变换到新基：$O' = U^\\dagger O_{(2)} U$ 和 $\\rho' = U^\\dagger \\rho_{(2)} U$。期望值计算为 $\\mathrm{Tr}(O'\\rho')$。其结果必须与情况2的结果相同，从而为基不变性提供了一个数值检验。\n\n- 对于情况4，密度矩阵对应于由一个归一化矢量 $v$ 表示的纯态。密度矩阵被构造为投影算符 $\\rho_{(4)} = v v^\\dagger$。然后期望值计算为 $\\mathrm{Tr}(O_{(4)} \\rho_{(4)})$。这等价于更熟悉的纯态公式 $\\langle v | \\hat{O} | v \\rangle = v^\\dagger O_{(4)} v$，这一点可以通过迹的循环性质来证明：$\\mathrm{Tr}(O_{(4)} v v^\\dagger) = \\mathrm{Tr}(v^\\dagger O_{(4)} v)$。由于 $v^\\dagger O_{(4)} v$ 是一个 $1 \\times 1$ 矩阵（一个标量），它的迹就是该标量本身。\n\n所有计算均使用数值矩阵代数完成，最终结果按要求四舍五入到八位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the expectation value of electromagnetic moments for four test cases\n    based on the formula\n```"
        },
        {
            "introduction": "虽然密度矩阵形式主义非常优雅，但在截断的有限基组（如谐振子基）中的实际应用会带来一些复杂问题。本练习旨在解决一个关键问题：平移不变性的破坏，这要求我们进行修正，以将原子核的内部运动与其质心运动分离开来。对于电四极矩而言，推导并实现这种修正是获得具有物理意义的计算结果的一项基本技能 。",
            "id": "3574822",
            "problem": "考虑一个在有限谐振子（HO）基中表示的多体核态，其中有限的截断通常会破坏精确的平移不变性。电四极矩算符必须作用在内禀坐标上才具有物理意义。谱学四极矩定义为在拉伸角动量态下，四极矩算符在实验室系中的期望值。然而，由于基截断，质心（COM）无法精确地分离，因此必须通过减去质心坐标来修正实验室系中的四极矩算符。\n\n从质子电四极矩算符和整个原子核质心坐标的基本定义出发，从第一性原理推导经过质心修正的谱学四极矩的表达式，该表达式应使用实验室系笛卡尔坐标矩来表示。仅使用以下基础：\n- 质子的电四极矩算符（以笛卡尔形式）定义为一个单体算符，对于每个质子，其包含与 $2 z^2 - x^2 - y^2$ 成比例的项，并且对所有质子是可加的。\n- 整个 $A$-核子系统的质心（COM）坐标定义为 $X_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} x_i$， $Y_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} y_i$， $Z_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} z_i$。\n- 作用在内禀坐标上的物理算符，是在求期望值之前通过替换 $x \\to x - X_{\\mathrm{cm}}$，$y \\to y - Y_{\\mathrm{cm}}$，$z \\to z - Z_{\\mathrm{cm}}$ 得到的。\n\n不要使用任何假定旋转对称性或关联内禀与实验室四极矩的专门核结构模型公式。直接使用可加的单体算符、质心坐标和期望值的线性性质进行计算。\n\n你的程序必须以一种可在提供的总期望值测试套件上进行数值测试的形式，实现所推导的表达式。具体来说，对于每个测试用例，你将获得：\n- $A$：总核子数（无量纲）。\n- $Z$：质子数（无量纲）。\n- $S^{(p)}_{x^2}$，$S^{(p)}_{y^2}$，$S^{(p)}_{z^2}$：对所有质子求和的 $\\sum_{p=1}^{Z} x_p^2$，$\\sum_{p=1}^{Z} y_p^2$，$\\sum_{p=1}^{Z} z_p^2$ 在实验室系中的期望值（单位为 $\\mathrm{fm}^2$）。\n- $S^{(\\mathrm{all})}_{xx}$，$S^{(\\mathrm{all})}_{yy}$，$S^{(\\mathrm{all})}_{zz}$：对所有核子求和的 $\\left(\\sum_{i=1}^{A} x_i\\right)^2$，$\\left(\\sum_{i=1}^{A} y_i\\right)^2$，$\\left(\\sum_{i=1}^{A} z_i\\right)^2$ 在实验室系中的期望值（单位为 $\\mathrm{fm}^2$）。\n- $T_x$，$T_y$，$T_z$：实验室系中的混合二阶矩 $T_x = \\left\\langle \\left(\\sum_{i=1}^{A} x_i\\right)\\left(\\sum_{p=1}^{Z} x_p\\right) \\right\\rangle$，$T_y = \\left\\langle \\left(\\sum_{i=1}^{A} y_i\\right)\\left(\\sum_{p=1}^{Z} y_p\\right) \\right\\rangle$，$T_z = \\left\\langle \\left(\\sum_{i=1}^{A} z_i\\right)\\left(\\sum_{p=1}^{Z} z_p\\right) \\right\\rangle$（单位为 $\\mathrm{fm}^2$）。\n\n基于以上基础，推导一个算法，为每个测试用例计算：\n1. 未经修正的实验室系谱学四极矩，\n   $$Q_s^{\\mathrm{lab}} = e \\left( 2 S^{(p)}_{z^2} - S^{(p)}_{x^2} - S^{(p)}_{y^2} \\right),$$\n   以 $e\\,\\mathrm{fm}^2$ 为单位表示。\n2. 必须加到 $Q_s^{\\mathrm{lab}}$ 上以获得内禀的、经质心修正的谱学四极矩的质心修正项 $\\Delta Q_s$，\n   $$Q_s^{\\mathrm{intr}} = Q_s^{\\mathrm{lab}} + \\Delta Q_s,$$\n   以 $e\\,\\mathrm{fm}^2$ 为单位表示。\n3. 相对变化量\n   $$\\delta = \\frac{Q_s^{\\mathrm{intr}} - Q_s^{\\mathrm{lab}}}{Q_s^{\\mathrm{lab}}},$$\n   表示为一个纯小数，不带百分号。如果 $Q_s^{\\mathrm{lab}} = 0$，按约定定义 $\\delta = 0$。\n\n所有 $Q_s^{\\mathrm{lab}}$ 和 $Q_s^{\\mathrm{intr}}$ 的输出必须以 $e\\,\\mathrm{fm}^2$ 为单位报告，并四舍五入到六位小数。所有 $\\delta$ 的输出必须四舍五入到六位小数。\n\n测试套件：\n为以下五个测试用例提供结果。每个元组列出 $\\left(A, Z, S^{(p)}_{x^2}, S^{(p)}_{y^2}, S^{(p)}_{z^2}, S^{(\\mathrm{all})}_{xx}, S^{(\\mathrm{all})}_{yy}, S^{(\\mathrm{all})}_{zz}, T_x, T_y, T_z\\right)$，其中所有二阶矩量的单位均为 $\\mathrm{fm}^2$：\n- 情况 1：$\\left(1, 1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5\\right)$。\n- 情况 2：$\\left(4, 2, 1.42, 1.42, 1.42, 2.84, 2.84, 2.84, 1.42, 1.42, 1.42\\right)$。\n- 情况 3：$\\left(20, 10, 8.4, 8.4, 9.8, 16.8, 16.8, 20.0, 8.4, 8.4, 9.8\\right)$。\n- 情况 4：$\\left(24, 12, 9.6, 8.8, 12.0, 21.6, 19.2, 26.4, 9.6, 8.8, 12.0\\right)$。\n- 情况 5：$\\left(100, 40, 36.0, 36.0, 44.0, 90.0, 90.0, 110.0, 36.0, 36.0, 44.0\\right)$。\n\n你的程序应该生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个测试用例的结果是一个三元列表 $[Q_s^{\\mathrm{lab}}, Q_s^{\\mathrm{intr}}, \\delta]$。例如，整体输出格式必须是\n\"[[q1_lab,q1_intr,d1],[q2_lab,q2_intr,d2],...]\"，在单行上，所有数值条目四舍五入到六位小数。使用 $e = 1$，以便输出直接以 $e\\,\\mathrm{fm}^2$ 为单位。",
            "solution": "该问题要求推导一个对谱学电四极矩的修正，该修正源于需要将算符表示在相对于原子核质心（COM）的内禀坐标中。这在截断基的计算中尤其重要，例如使用有限谐振子基的计算，其中平移不变性没有被精确地保持。我们将从第一性原理推导这个修正。\n\n设元电荷为 $e$。根据问题说明，为计算方便，我们设 $e=1$，因此所有四极矩都以 $e\\,\\mathrm{fm}^2$ 为单位表示。谱学四极矩算符是相对于实验室参考系的 $z$ 轴定义的。它是一个单体算符，对原子核（质量数为 $A$）中的所有 $Z$ 个质子求和：\n$$\n\\hat{Q}_{\\mathrm{lab}} = \\sum_{p=1}^{Z} (2 z_p^2 - x_p^2 - y_p^2)\n$$\n未经修正的谱学四极矩 $Q_s^{\\mathrm{lab}}$ 是该算符对于所讨论核态的期望值：\n$$\nQ_s^{\\mathrm{lab}} = \\left\\langle \\hat{Q}_{\\mathrm{lab}} \\right\\rangle = \\left\\langle \\sum_{p=1}^{Z} (2 z_p^2 - x_p^2 - y_p^2) \\right\\rangle\n$$\n根据期望值的线性性质，这变为：\n$$\nQ_s^{\\mathrm{lab}} = 2 \\left\\langle \\sum_{p=1}^{Z} z_p^2 \\right\\rangle - \\left\\langle \\sum_{p=1}^{Z} x_p^2 \\right\\rangle - \\left\\langle \\sum_{p=1}^{Z} y_p^2 \\right\\rangle\n$$\n使用问题中提供的实验室系期望值定义 $S^{(p)}_{k^2} = \\left\\langle \\sum_{p=1}^{Z} k_p^2 \\right\\rangle$ （其中 $k \\in \\{x, y, z\\}$），我们得到：\n$$\nQ_s^{\\mathrm{lab}} = 2 S^{(p)}_{z^2} - S^{(p)}_{x^2} - S^{(p)}_{y^2}\n$$\n此表达式与问题陈述中给出的第一个待计算量的表达式相符。\n\n物理上有意义的四极矩是在原子核的内禀系中定义的，该坐标系随质心一起运动。内禀算符 $\\hat{Q}_{\\mathrm{intr}}$ 通过将每个质子的实验室坐标 $(x_p, y_p, z_p)$ 替换为其相对于质心坐标 $(X_{\\mathrm{cm}}, Y_{\\mathrm{cm}}, Z_{\\mathrm{cm}})$ 定义的内禀坐标 $(x'_p, y'_p, z'_p)$ 来获得：\n$$\nx'_p = x_p - X_{\\mathrm{cm}}, \\quad y'_p = y_p - Y_{\\mathrm{cm}}, \\quad z'_p = z_p - Z_{\\mathrm{cm}}\n$$\n质心坐标定义为对所有 $A$ 个核子（质子和中子）的求和：\n$$\nX_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} x_i, \\quad Y_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} y_i, \\quad Z_{\\mathrm{cm}} = \\frac{1}{A} \\sum_{i=1}^{A} z_i\n$$\n因此，内禀四极矩算符是：\n$$\n\\hat{Q}_{\\mathrm{intr}} = \\sum_{p=1}^{Z} (2 (z'_p)^2 - (x'_p)^2 - (y'_p)^2) = \\sum_{p=1}^{Z} \\left[ 2(z_p - Z_{\\mathrm{cm}})^2 - (x_p - X_{\\mathrm{cm}})^2 - (y_p - Y_{\\mathrm{cm}})^2 \\right]\n$$\n我们展开平方项。对于一个通用坐标 $k \\in \\{x, y, z\\}$：\n$$\n\\sum_{p=1}^{Z} (k_p - K_{\\mathrm{cm}})^2 = \\sum_{p=1}^{Z} (k_p^2 - 2 k_p K_{\\mathrm{cm}} + K_{\\mathrm{cm}}^2) = \\left( \\sum_{p=1}^{Z} k_p^2 \\right) - 2 K_{\\mathrm{cm}} \\left( \\sum_{p=1}^{Z} k_p \\right) + Z K_{\\mathrm{cm}}^2\n$$\n将此展开式应用于 $\\hat{Q}_{\\mathrm{intr}}$ 的表达式，得到：\n$$\n\\hat{Q}_{\\mathrm{intr}} = \\sum_{p=1}^{Z} \\left[ (2z_p^2 - x_p^2 - y_p^2) + (-4z_p Z_{\\mathrm{cm}} + 2x_p X_{\\mathrm{cm}} + 2y_p Y_{\\mathrm{cm}}) + (2Z_{\\mathrm{cm}}^2 - X_{\\mathrm{cm}}^2 - Y_{\\mathrm{cm}}^2) \\right]\n$$\n我们可以将这些项分组：\n$$\n\\hat{Q}_{\\mathrm{intr}} = \\underbrace{\\left( \\sum_{p=1}^{Z} (2z_p^2 - x_p^2 - y_p^2) \\right)}_{\\hat{Q}_{\\mathrm{lab}}} + \\underbrace{\\left( 2 X_{\\mathrm{cm}} \\sum_{p=1}^{Z} x_p + 2 Y_{\\mathrm{cm}} \\sum_{p=1}^{Z} y_p - 4 Z_{\\mathrm{cm}} \\sum_{p=1}^{Z} z_p \\right)}_{\\Delta\\hat{Q}_{\\mathrm{cross}}} + \\underbrace{Z (2Z_{\\mathrm{cm}}^2 - X_{\\mathrm{cm}}^2 - Y_{\\mathrm{cm}}^2)}_{\\Delta\\hat{Q}_{\\mathrm{COM}}}\n$$\n内禀算符是实验室系算符与一个修正项 $\\Delta\\hat{Q} = \\Delta\\hat{Q}_{\\mathrm{cross}} + \\Delta\\hat{Q}_{\\mathrm{COM}}$ 的和。为了找到对四极矩的修正 $\\Delta Q_s$，我们取 $\\Delta\\hat{Q}$ 的期望值。\n\n首先，将质心坐标的定义代入 $\\Delta\\hat{Q}_{\\mathrm{cross}}$ 和 $\\Delta\\hat{Q}_{\\mathrm{COM}}$：\n$$\n\\Delta\\hat{Q}_{\\mathrm{cross}} = \\frac{2}{A} \\left( \\sum_{i=1}^{A} x_i \\right) \\left( \\sum_{p=1}^{Z} x_p \\right) + \\frac{2}{A} \\left( \\sum_{i=1}^{A} y_i \\right) \\left( \\sum_{p=1}^{Z} y_p \\right) - \\frac{4}{A} \\left( \\sum_{i=1}^{A} z_i \\right) \\left( \\sum_{p=1}^{Z} z_p \\right)\n$$\n$$\n\\Delta\\hat{Q}_{\\mathrm{COM}} = \\frac{Z}{A^2} \\left[ 2\\left( \\sum_{i=1}^{A} z_i \\right)^2 - \\left( \\sum_{i=1}^{A} x_i \\right)^2 - \\left( \\sum_{i=1}^{A} y_i \\right)^2 \\right]\n$$\n总修正 $\\Delta Q_s$ 是期望值 $\\langle \\Delta\\hat{Q} \\rangle = \\langle \\Delta\\hat{Q}_{\\mathrm{cross}} \\rangle + \\langle \\Delta\\hat{Q}_{\\mathrm{COM}} \\rangle$。使用问题陈述中提供的期望值：\n-   $T_k = \\left\\langle \\left(\\sum_{i=1}^{A} k_i\\right)\\left(\\sum_{p=1}^{Z} k_p\\right) \\right\\rangle$\n-   $S^{(\\mathrm{all})}_{kk} = \\left\\langle \\left(\\sum_{i=1}^{A} k_i\\right)^2 \\right\\rangle$\n\n交叉项的期望值为：\n$$\n\\langle \\Delta\\hat{Q}_{\\mathrm{cross}} \\rangle = \\frac{2}{A} T_x + \\frac{2}{A} T_y - \\frac{4}{A} T_z = \\frac{2}{A} (T_x + T_y - 2 T_z)\n$$\n质心项的期望值为：\n$$\n\\langle \\Delta\\hat{Q}_{\\mathrm{COM}} \\rangle = \\frac{Z}{A^2} \\left[ 2 \\left\\langle \\left( \\sum_{i=1}^{A} z_i \\right)^2 \\right\\rangle - \\left\\langle \\left( \\sum_{i=1}^{A} x_i \\right)^2 \\right\\rangle - \\left\\langle \\left( \\sum_{i=1}^{A} y_i \\right)^2 \\right\\rangle \\right]\n$$\n$$\n\\langle \\Delta\\hat{Q}_{\\mathrm{COM}} \\rangle = \\frac{Z}{A^2} (2 S^{(\\mathrm{all})}_{zz} - S^{(\\mathrm{all})}_{xx} - S^{(\\mathrm{all})}_{yy})\n$$\n将这些结合起来，得到谱学四极矩质心修正的最终表达式：\n$$\n\\Delta Q_s = \\frac{2}{A} (T_x + T_y - 2 T_z) + \\frac{Z}{A^2} (2 S^{(\\mathrm{all})}_{zz} - S^{(\\mathrm{all})}_{xx} - S^{(\\mathrm{all})}_{yy})\n$$\n于是，内禀的、经质心修正的四极矩为 $Q_s^{\\mathrm{intr}} = Q_s^{\\mathrm{lab}} + \\Delta Q_s$。相对变化量为 $\\delta = \\Delta Q_s / Q_s^{\\mathrm{lab}}$，特殊情况是如果 $Q_s^{\\mathrm{lab}} = 0$，则 $\\delta = 0$。\n\n对每个测试用例，要实现的算法如下：\n1.  读取输入参数：$A, Z, S^{(p)}_{x^2}, S^{(p)}_{y^2}, S^{(p)}_{z^2}, S^{(\\mathrm{all})}_{xx}, S^{(\\mathrm{all})}_{yy}, S^{(\\mathrm{all})}_{zz}, T_x, T_y, T_z$。\n2.  计算未经修正的实验室系四极矩：$Q_s^{\\mathrm{lab}} = 2 S^{(p)}_{z^2} - S^{(p)}_{x^2} - S^{(p)}_{y^2}$。\n3.  计算质心修正项：$\\Delta Q_s = \\frac{2}{A} (T_x + T_y - 2 T_z) + \\frac{Z}{A^2} (2 S^{(\\mathrm{all})}_{zz} - S^{(\\mathrm{all})}_{xx} - S^{(\\mathrm{all})}_{yy})$。\n4.  计算内禀四极矩：$Q_s^{\\mathrm{intr}} = Q_s^{\\mathrm{lab}} + \\Delta Q_s$。\n5.  计算相对变化量 $\\delta$。如果 $Q_s^{\\mathrm{lab}}$ 非零，则 $\\delta = \\Delta Q_s / Q_s^{\\mathrm{lab}}$。否则，$\\delta = 0$。\n6.  将 $Q_s^{\\mathrm{lab}}$、$Q_s^{\\mathrm{intr}}$ 和 $\\delta$ 分别四舍五入到六位小数。\n7.  按要求格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the COM-corrected spectroscopic quadrupole moment based on\n    a set of aggregate expectation values.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple contains:\n    # (A, Z, S_p_x2, S_p_y2, S_p_z2, S_all_xx, S_all_yy, S_all_zz, T_x, T_y, T_z)\n    test_cases = [\n        (1, 1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5),\n        (4, 2, 1.42, 1.42, 1.42, 2.84, 2.84, 2.84, 1.42, 1.42, 1.42),\n        (20, 10, 8.4, 8.4, 9.8, 16.8, 16.8, 20.0, 8.4, 8.4, 9.8),\n        (24, 12, 9.6, 8.8, 12.0, 21.6, 19.2, 26.4, 9.6, 8.8, 12.0),\n        (100, 40, 36.0, 36.0, 44.0, 90.0, 90.0, 110.0, 36.0, 36.0, 44.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        A, Z, Sp_x2, Sp_y2, Sp_z2, Sall_xx, Sall_yy, Sall_zz, Tx, Ty, Tz = case\n        \n        # 1. Calculate the uncorrected laboratory-frame spectroscopic quadrupole moment (e=1)\n        q_lab = 2 * Sp_z2 - Sp_x2 - Sp_y2\n\n        # 2. Calculate the COM correction term\n        # The derivation yields:\n        # delta_q = (2/A)*(Tx + Ty - 2*Tz) + (Z/A^2)*(2*Sall_zz - Sall_xx - Sall_yy)\n        term_T = (2.0 / A) * (Tx + Ty - 2.0 * Tz)\n        term_S_all = (float(Z) / (A**2)) * (2.0 * Sall_zz - Sall_xx - Sall_yy)\n        delta_q = term_T + term_S_all\n\n        # 3. Calculate the COM-corrected intrinsic quadrupole moment\n        q_intr = q_lab + delta_q\n\n        # 4. Calculate the fractional change\n        if q_lab == 0:\n            delta = 0.0\n        else:\n            delta = delta_q / q_lab\n            \n        # 5. Round all results to six decimal places\n        q_lab_rounded = round(q_lab, 6)\n        q_intr_rounded = round(q_intr, 6)\n        delta_rounded = round(delta, 6)\n        \n        results.append([q_lab_rounded, q_intr_rounded, delta_rounded])\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists, with no spaces.\n    # Ex: [[q1_lab,q1_intr,d1],[q2_lab,q2_intr,d2]]\n    formatted_cases = []\n    for res in results:\n        # Convert each rounded number to string representation. str() handles \n        # dropping unnecessary trailing zeros (e.g., 16.0 instead of 16.000000).\n        case_str = f\"[{str(res[0])},{str(res[1])},{str(res[2])}]\"\n        formatted_cases.append(case_str)\n    \n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了连接理论与实验，我们需要弥合模型与现实之间的差距。由于壳模型计算在有限的模型空间中进行，因此被排除的组态所产生的影响通过“有效”算符来体现，例如为核子引入有效电荷。本练习将演示如何通过构建并求解一个线性反问题，来确定能够最佳再现实验测量的四极矩值的有效电荷。这项实践介绍了在模型校准和处理真实实验数据方面非常有价值的计算技术 。",
            "id": "3574819",
            "problem": "您将执行一项关于核壳模型中核电磁矩的计算任务。目标是分析谱学四极矩对质子和中子有效电荷的敏感性，并确定能重现实验谱学四极矩的有效电荷。您的推导和算法必须从电磁四极矩张量的基本定义和标准角动量代数出发，不得使用特定目标的快捷方式。\n\n使用以下基本依据：\n- 原子核的电四极矩张量算符由原子核的电荷分布和位置算符构成，形成一个秩为 $2$ 的球张量。\n- 在壳模型中，总电四极矩算符是质子和中子贡献之和，其中中子通过核芯极化（通过分配有效电荷）来产生有效贡献。\n- 根据 Wigner–Eckart 定理，球张量算符在角动量本征态之间的矩阵元可以分解，从而将角相关性与约化矩阵元分离。\n- 总角动量为 $J$ 的状态的谱学四极矩定义为在实验室坐标系中，四极矩张量在 $M=J$ 投影下的期望值。\n\n以此为基础，推导出一个线性模型，将一个状态的谱学四极矩与质子贡献和中子贡献的组合联系起来，其中每个贡献都由一个有效电荷进行缩放。展示谱学四极矩对每种有效电荷的敏感性是如何由该状态相应的结构系数决定的。然后，通过求解一个线性反问题，推导出一个适定的计算方法，用以从一个或多个测量的谱学四极矩中推断出有效电荷。您的方法必须能处理恰定系统、超定系统和欠定系统的情况，并使用一个基于第一性原理证明的稳定方法。\n\n实现一个程序，该程序：\n- 使用质子和中子的依赖于状态的结构系数数组，以及相应的实验谱学四极矩，构建跨越一个或多个状态的线性系统。\n- 通过最小化平方失配来求解质子和中子有效电荷，可选择使用 Tikhonov (ridge) 正则化，这种方法在欠定或病态情况下能保证唯一的最小范数解。\n- 通过对推导出的线性模型求导，计算每个状态的谱学四极矩对每种有效电荷的局部敏感性。敏感性无需打印，但必须用于指导算法设计。\n\n测试套件的数值和物理设置：\n- 对于下面的每个测试用例，您将获得与角动量为 $J$ 的状态相对应的裸结构系数数组。这些系数是裸质子和裸中子四极矩算符对相应状态的谱学贡献，以 $\\mathrm{fm}^2$ 为单位表示。测量的谱学四极矩以 $e \\,\\mathrm{fm}^2$ 为单位给出。有效电荷是无量纲的，报告时应不带单位。每个测试用例还指定一个非负正则化强度 $\\lambda$；使用 $\\lambda=0$ 来恢复 Moore–Penrose 最小范数解，使用 $\\lambda>0$ 来进行 Tikhonov 正则化。\n- 设设计矩阵由每个状态的裸质子和裸中子谱学系数组成的行构成，设数据向量收集这些状态的测量谱学四极矩。通过最小化残差平方和加上强度为 $\\lambda$ 的正则化惩罚项来求解线性反问题。\n\n测试套件（三种情况）：\n- 情况 A（理想情况，恰定系统）：\n  - 状态数：$N=\\{2\\}$，角动量 $J=\\{2,2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,12.0,\\,-8.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,3.5,\\,2.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,17.35,\\,-9.4\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n- 情况 B（欠定系统，一个方程，两个未知数；恢复最小范数解）：\n  - 状态数：$N=\\{1\\}$，角动量 $J=\\{2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,10.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,4.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,18.0\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n- 情况 C（超定系统，具有近共线性，以测试稳定性和敏感性）：\n  - 状态数：$N=\\{3\\}$，角动量 $J=\\{2,2,2\\}$。\n  - 裸质子系数（单位 $\\mathrm{fm}^2$）：$q_p = [\\,5.0,\\,15.0,\\,-7.0\\,]$。\n  - 裸中子系数（单位 $\\mathrm{fm}^2$）：$q_n = [\\,2.0,\\,6.0,\\,3.0\\,]$。\n  - 实验谱学四极矩（单位 $e\\,\\mathrm{fm}^2$）：$Q_s^{(\\mathrm{exp})} = [\\,8.2,\\,24.6,\\,-8.0\\,]$。\n  - 正则化强度：$\\lambda = 0.0$。\n\n编程要求：\n- 对于每种情况，通过堆叠由相应裸系数构成的行，构建一个大小为 $N\\times 2$ 的设计矩阵。\n- 通过最小化正则化强度为 $\\lambda$ 的正则化最小二乘目标函数，求解包含两个分量的有效电荷向量。使用数值稳定的方法。如果 $\\lambda=0$，则简化为 Moore–Penrose 伪逆（最小范数）解。如果 $\\lambda>0$，则对应于 Tikhonov 正则化。\n- 程序必须计算每个测试用例的解，并仅按指定的最终格式输出每种情况下质子和中子的有效电荷。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个项目必须是一个子列表 $[e_p^{\\mathrm{eff}},e_n^{\\mathrm{eff}}]$，其中两个值都四舍五入到六位小数，并按 A、B、C 的顺序对应相应的测试用例。例如：$[[e_{p,A},e_{n,A}],[e_{p,B},e_{n,B}],[e_{p,C},e_{n,C}]]$。\n- 所有输出均为无量纲数。不应打印任何物理单位。",
            "solution": "我们从有限原子核的电磁四极矩张量算符开始。电四极矩张量的球分量定义为\n$$\n\\hat{Q}_{2\\mu} = \\sum_{i=1}^{A} \\hat{q}_i \\, r_i^2 \\, Y_{2\\mu}(\\hat{\\mathbf{r}}_i),\n$$\n其中 $A$ 是核子数，$\\hat{q}_i$ 是作用在第 $i$ 个核子上的电荷算符，$r_i$ 是其径向坐标，$Y_{2\\mu}$ 是一个球谐函数。在壳模型描述中，中子通过核芯极化对电磁可观测量做出贡献，这通过引入质子和中子有效电荷来解释，记为 $e_p^{\\mathrm{eff}}$ 和 $e_n^{\\mathrm{eff}}$，它们是乘以相应裸质子和裸中子四极矩算符的无量纲缩放因子。\n\n令 $\\lvert J M \\rangle$ 表示一个总角动量为 $J$、投影为 $M$ 的核本征态。谱学四极矩 $Q_s$ 定义为在拉伸投影 $M=J$ 下，$\\mu=0$ 分量的实验室系期望值，\n$$\nQ_s(J) \\equiv \\langle J J \\lvert \\hat{Q}_{20} \\rvert J J \\rangle.\n$$\n根据 Wigner–Eckart 定理，$\\hat{Q}_{2\\mu}$ 的约化矩阵元将角动量依赖性分离出来，因此 $Q_s(J)$ 与相应的约化矩阵元 $\\langle J \\lVert \\hat{Q}_2 \\rVert J \\rangle$ 成正比，乘以一个已知的角因子。在壳模型中，该算符分解为质子部分和中子部分之和。引入有效电荷导致对 $Q_s(J)$ 的裸质子和裸中子贡献进行线性缩放：\n$$\nQ_s(J) = e_p^{\\mathrm{eff}}\\; q_p(J) + e_n^{\\mathrm{eff}}\\; q_n(J),\n$$\n其中 $q_p(J)$ 和 $q_n(J)$ 分别是从裸质子和裸中子四极矩算符中得到的对自旋为 $J$ 的状态的谱学贡献（单位为 $\\mathrm{fm}^2$）。这种线性关系直接源于期望值的线性性质以及算符分解为质子和中子部分并乘以标量有效电荷。\n\n敏感性。对线性模型关于 $e_p^{\\mathrm{eff}}$ 和 $e_n^{\\mathrm{eff}}$ 求导，立即得到给定状态的敏感性：\n$$\n\\frac{\\partial Q_s(J)}{\\partial e_p^{\\mathrm{eff}}} = q_p(J), \\qquad\n\\frac{\\partial Q_s(J)}{\\partial e_n^{\\mathrm{eff}}} = q_n(J).\n$$\n因此，结构系数 $q_p(J)$ 和 $q_n(J)$ 完全决定了每个有效电荷的微小变化如何影响 $Q_s(J)$。\n\n跨多个状态的反问题。对于 $N$ 个测量状态，我们将线性关系整理成矩阵形式。令\n$$\n\\mathbf{A} = \n\\begin{bmatrix}\nq_p(J_1)  q_n(J_1) \\\\\n\\vdots  \\vdots \\\\\nq_p(J_N)  q_n(J_N)\n\\end{bmatrix}\n\\in \\mathbb{R}^{N\\times 2}, \\quad\n\\mathbf{e} =\n\\begin{bmatrix}\ne_p^{\\mathrm{eff}} \\\\ e_n^{\\mathrm{eff}}\n\\end{bmatrix} \\in \\mathbb{R}^{2}, \\quad\n\\mathbf{b} =\n\\begin{bmatrix}\nQ_s^{(\\mathrm{exp})}(J_1) \\\\ \\vdots \\\\ Q_s^{(\\mathrm{exp})}(J_N)\n\\end{bmatrix}\\in \\mathbb{R}^{N}.\n$$\n前向模型为 $\\mathbf{A}\\mathbf{e}=\\mathbf{b}$。为了对任意 $N$ 稳健地推断 $\\mathbf{e}$，我们提出正则化最小二乘问题\n$$\n\\min_{\\mathbf{e}\\in\\mathbb{R}^2}\\; \\lVert \\mathbf{A}\\mathbf{e}-\\mathbf{b}\\rVert_2^2 + \\lambda^2 \\lVert \\mathbf{e}\\rVert_2^2,\n$$\n其中正则化强度 $\\lambda \\ge 0$。该问题有唯一解\n$$\n\\mathbf{e}_\\lambda = (\\mathbf{A}^\\mathsf{T}\\mathbf{A} + \\lambda^2 \\mathbf{I})^{-1}\\mathbf{A}^\\mathsf{T}\\mathbf{b}.\n$$\n等价地，用奇异值分解 $\\mathbf{A}=\\mathbf{U}\\mathbf{\\Sigma}\\mathbf{V}^\\mathsf{T}$（奇异值为 $\\{\\sigma_k\\}$）表示，解为\n$$\n\\mathbf{e}_\\lambda = \\mathbf{V}\\,\\mathrm{diag}\\!\\left(\\frac{\\sigma_k}{\\sigma_k^2+\\lambda^2}\\right)\\mathbf{U}^\\mathsf{T}\\mathbf{b},\n$$\n当 $\\lambda=0$ 时，该解简化为 Moore–Penrose 最小范数伪逆解。这种基于 SVD 的形式是数值稳定的，并揭示了由 $\\lambda$ 控制的对小奇异值（病态）的敏感性。\n\n程序的算法设计：\n- 对每个测试用例，根据给定的 $q_p(J_i)$ 和 $q_n(J_i)$ 构建 $\\mathbf{A}$，并根据 $Q_s^{(\\mathrm{exp})}(J_i)$ 构建 $\\mathbf{b}$。\n- 使用上述基于 SVD 的公式和指定的 $\\lambda$ 计算 $\\mathbf{e}_\\lambda$。\n- 尽管敏感性 $\\partial Q_s/\\partial e_p^{\\mathrm{eff}}=q_p(J_i)$ 和 $\\partial Q_s/\\partial e_n^{\\mathrm{eff}}=q_n(J_i)$ 不会被打印，但它们直接为求解器使用的雅可比矩阵（矩阵 $\\mathbf{A}$ 正是雅可比矩阵）提供信息。\n- 将 $\\mathbf{e}_\\lambda$ 的每个分量四舍五入到六位小数，并按要求的格式输出。\n\n所提供测试套件的解析验证：\n- 情况 A：\n  - 数据：$q_p=[\\,12.0,\\,-8.0\\,]$, $q_n=[\\,3.5,\\,2.0\\,]$, $Q_s^{(\\mathrm{exp})}=[\\,17.35,\\,-9.4\\,]$, $\\lambda=0.0$。\n  - 线性系统是\n    $12.0\\,e_p^{\\mathrm{eff}} + 3.5\\,e_n^{\\mathrm{eff}} = 17.35$ 和 $-8.0\\,e_p^{\\mathrm{eff}} + 2.0\\,e_n^{\\mathrm{eff}} = -9.4$，\n    恰好解得 $e_p^{\\mathrm{eff}}=1.3$ 和 $e_n^{\\mathrm{eff}}=0.5$。\n- 情况 B：\n  - 数据：$q_p=[\\,10.0\\,]$, $q_n=[\\,4.0\\,]$, $Q_s^{(\\mathrm{exp})}=[\\,18.0\\,]$, $\\lambda=0.0$。\n  - 对于一个方程和两个未知数，Moore–Penrose 最小范数解与 $\\mathbf{A}$ 的行对齐：\n    $\\mathbf{e}_0 = \\mathbf{A}^\\mathsf{T}(\\mathbf{A}\\mathbf{A}^\\mathsf{T})^{-1}\\mathbf{b}\n    = \\dfrac{18.0}{10.0^2+4.0^2}\\begin{bmatrix}10.0\\\\4.0\\end{bmatrix}\n    = \\begin{bmatrix}1.551724\\ldots\\\\0.620689\\ldots\\end{bmatrix}$。\n- 情况 C：\n  - 数据：$q_p=[\\,5.0,\\,15.0,\\,-7.0\\,]$, $q_n=[\\,2.0,\\,6.0,\\,3.0\\,]$, $Q_s^{(\\mathrm{exp})}=[\\,8.2,\\,24.6,\\,-8.0\\,]$, $\\lambda=0.0$。\n  - 数据与 $e_p^{\\mathrm{eff}}=1.4$ 和 $e_n^{\\mathrm{eff}}=0.6$ 完全一致，因此最小二乘解能精确恢复这些值。\n\n因此，程序必须为这三种情况计算向量\n$[\\,e_p^{\\mathrm{eff}},e_n^{\\mathrm{eff}}\\,]$ 并打印一行形如\n$[[e_{p,A},e_{n,A}],[e_{p,B},e_{n,B}],[e_{p,C},e_{n,C}]]$ 的结果，每个数字四舍五入到六位小数。所有输出都是无量纲的，因此打印的行中不出现物理单位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef tikhonov_solution(A: np.ndarray, b: np.ndarray, lam: float) -> np.ndarray:\n    \"\"\"\n    Compute the 2-parameter Tikhonov-regularized solution e to minimize\n    ||A e - b||_2^2 + lam^2 ||e||_2^2 using an SVD-based filter.\n    For lam=0, this reduces to the Moore-Penrose minimum-norm solution.\n    \"\"\"\n    # SVD of A\n    U, s, VT = np.linalg.svd(A, full_matrices=False)\n    # Build filter factors sigma / (sigma^2 + lam^2)\n    if lam  0:\n        raise ValueError(\"Regularization parameter lam must be nonnegative.\")\n    if lam == 0.0:\n        # Avoid division by zero: only invert nonzero singular values\n        tol = np.finfo(float).eps * max(A.shape) * (s[0] if s.size > 0 else 1.0)\n        inv_s = np.array([1/si if si > tol else 0.0 for si in s])\n        e = VT.T @ (inv_s * (U.T @ b))\n    else:\n        filt = s / (s**2 + lam**2)\n        e = VT.T @ (filt * (U.T @ b))\n    return e\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Case A: exactly determined (2 states)\n    qp_A = np.array([12.0, -8.0], dtype=float)   # fm^2\n    qn_A = np.array([3.5,  2.0], dtype=float)    # fm^2\n    Qexp_A = np.array([17.35, -9.4], dtype=float)  # e fm^2\n    lam_A = 0.0\n\n    # Case B: underdetermined (1 state), minimum-norm solution\n    qp_B = np.array([10.0], dtype=float)  # fm^2\n    qn_B = np.array([4.0], dtype=float)   # fm^2\n    Qexp_B = np.array([18.0], dtype=float)  # e fm^2\n    lam_B = 0.0\n\n    # Case C: overdetermined with near-collinearity\n    qp_C = np.array([5.0, 15.0, -7.0], dtype=float)  # fm^2\n    qn_C = np.array([2.0, 6.0, 3.0], dtype=float)    # fm^2\n    Qexp_C = np.array([8.2, 24.6, -8.0], dtype=float)  # e fm^2\n    lam_C = 0.0\n\n    test_cases = [\n        (qp_A, qn_A, Qexp_A, lam_A),\n        (qp_B, qn_B, Qexp_B, lam_B),\n        (qp_C, qn_C, Qexp_C, lam_C),\n    ]\n\n    results = []\n    for qp, qn, Qexp, lam in test_cases:\n        # Construct A and b\n        A = np.column_stack([qp, qn])  # shape (N, 2)\n        b = Qexp\n\n        # Solve for effective charges using Tikhonov/pseudoinverse\n        e_eff = tikhonov_solution(A, b, lam)  # [e_p_eff, e_n_eff]\n\n        # Round to six decimals for final output\n        ep = float(f\"{e_eff[0]:.6f}\")\n        en = float(f\"{e_eff[1]:.6f}\")\n        results.append([ep, en])\n\n    # Final print statement in the exact required format.\n    # Produce e.g., [[epA,enA],[epB,enB],[epC,enC]]\n    formatted = \"[\" + \",\".join(f\"[{pair[0]},{pair[1]}]\" for pair in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        }
    ]
}