{
    "hands_on_practices": [
        {
            "introduction": "核“面食”相的形成源于短程核吸引力（表现为表面能）和长程库仑排斥力之间的精妙竞争。本练习将通过一个简化的维格纳-赛茨（Wigner-Seitz）胞模型，引导您亲手计算并比较在不同物质密度下，球状（“丸子”）、柱状（“意面”）和板状（“千层面”）结构的能量。通过最小化每种几何构型的自由能，您将能够重现中子星内壳中“面食”相随密度增加而发生的典型相序演化，从而直观地理解其背后的核心物理机制。",
            "id": "3579770",
            "problem": "要求您编写一个完整、可运行的程序，通过比较三种候选几何构型：球体（$d=3$；“液滴”）、圆柱体（$d=2$；“棒状”）和板状体（$d=1$；“板状”）的最小化自由能密度，来确定随重子数密度增加而出现的最优核意面几何构型。对于每个指定的重子数密度，都必须进行比较，方法是对于每种几何构型，使用规定的表面张力、质子分数和线性电子屏蔽模型，最小化表面能和库仑能对自由能密度的贡献之和。\n\n需要实现的物理和数值模型如下。\n\n1. 几何构型与 Wigner–Seitz 原胞构造。对于每个几何维度 $d \\in \\{1,2,3\\}$，假设存在一个由相同团簇构成的周期性排列，每个团簇由一个半径为 $R_{\\mathrm{c}}$ 的 Wigner–Seitz 原胞和一个内部团簇尺寸 $r_{\\mathrm{N}}$ 来描述。重子数密度为 $n$（单位为 $\\mathrm{fm}^{-3}$）。团簇内部的致密核物质相具有固定的重子数密度 $n_{\\mathrm{in}} = 0.16\\,\\mathrm{fm}^{-3}$。致密相所占的体积分数为\n$$\nu = \\frac{n}{n_{\\mathrm{in}}}, \\quad \\text{为保证数值稳定性，限制在 } 10^{-2} \\le u \\le 0.99 \\text{ 的范围内}。\n$$\n团簇尺寸与原胞半径之间的 Wigner–Seitz 关系为\n$$\nu = \\left(\\frac{r_{\\mathrm{N}}}{R_{\\mathrm{c}}}\\right)^{d} \\quad \\Rightarrow \\quad R_{\\mathrm{c}} = \\frac{r_{\\mathrm{N}}}{u^{1/d}}.\n$$\n球体使用 $d=3$，圆柱体使用 $d=2$，板状体使用 $d=1$。\n\n2. 质子分数与电子密度。质子分数 $Y_p(n)$ 是由 $n$ 决定的函数，其规定如下\n$$\nY_{p}(n) = 0.05 + 0.1 \\exp\\!\\left(-\\frac{n}{0.06\\,\\mathrm{fm}^{-3}}\\right).\n$$\n致密相内部的质子数密度为 $n_{p,\\mathrm{in}}(n)=Y_{p}(n)\\,n_{\\mathrm{in}}$。电子提供全局电中性，并通过一个依赖于平均电子密度 $n_{e} = u\\,n_{p,\\mathrm{in}}$ 的屏蔽长度在线性响应框架下处理。\n\n3. 表面能密度。表面张力规定为\n$$\n\\sigma(n) = \\max\\!\\left(0.3, \\, 1.0 - 0.4\\,\\frac{n}{0.16\\,\\mathrm{fm}^{-3}}\\right)\\ \\mathrm{MeV/fm^{2}},\n$$\n对于给定几何构型，其表面能密度为\n$$\n\\varepsilon_{S}(d,n,r_{\\mathrm{N}}) = \\frac{d\\,\\sigma(n)\\,u}{r_{\\mathrm{N}}}\\ \\mathrm{MeV/fm^{3}}.\n$$\n\n4. 电子屏蔽长度。使用一个依赖于平均电子密度 $n_{e}$ 的经验屏蔽长度来模拟超相对论电子的屏蔽效应：\n$$\n\\lambda_{e}(n) = 20\\,\\mathrm{fm}\\ \\left(\\frac{0.05\\,\\mathrm{fm}^{-3}}{n_{e}}\\right)^{1/3}.\n$$\n\n5. 通过有屏蔽的泊松问题计算库仑能密度。通过求解每种几何构型的一维径向有屏蔽的散度形式泊松方程来处理库仑能：\n$$\n\\frac{1}{r^{d-1}} \\frac{d}{dr} \\!\\left(r^{d-1} \\frac{d\\phi}{dr}\\right) - \\frac{\\phi}{\\lambda_{e}^{2}} = - \\rho_{p}(r),\n$$\n边界条件为 Neumann 条件 $d\\phi/dr\\vert_{r=0} = 0$ 和 $d\\phi/dr\\vert_{r=R_{\\mathrm{c}}} = 0$。质子电荷密度在团簇内部被认为是均匀的，在外部为零，\n$$\n\\rho_{p}(r) = \\begin{cases}\nn_{p,\\mathrm{in}}(n),  0 \\le r  r_{\\mathrm{N}},\\\\\n0,  r_{\\mathrm{N}} \\le r \\le R_{\\mathrm{c}}.\n\\end{cases}\n$$\n您必须在 $r \\in [0, R_{\\mathrm{c}}]$ 区间内，使用一种散度形式的守恒有限差分格式对该方程进行离散化，该格式在 $r=0$ 处对 $d \\in \\{1,2,3\\}$ 均保持数值稳定。库仑能密度计算如下\n$$\n\\varepsilon_{C}(d,n,r_{\\mathrm{N}}) = \\frac{1}{2 V_{\\mathrm{cell}}} \\int_{0}^{R_{\\mathrm{c}}} \\rho_{p}(r)\\,\\phi(r)\\, S_{d}\\, r^{d-1}\\, dr,\n$$\n其中 $S_{1}=2$，$S_{2}=2\\pi$，$S_{3}=4\\pi$，原胞体积为 $V_{\\mathrm{cell}} = S_{d} R_{\\mathrm{c}}^{d}/d$。总的电磁常数已被吸收到单位中，因此只需要在相同 $n$ 下对不同几何构型进行相对比较；程序必须确保不同几何构型间的标度在内部是一致的。\n\n6. 总自由能密度与最小化。对于每种几何构型和每个密度 $n$，最小化\n$$\n\\varepsilon_{\\mathrm{tot}}(d,n,r_{\\mathrm{N}}) = \\varepsilon_{S}(d,n,r_{\\mathrm{N}}) + \\varepsilon_{C}(d,n,r_{\\mathrm{N}})\n$$\n在物理上合理的定义域 $r_{\\mathrm{N}} \\in [0.5\\,\\mathrm{fm},\\,30\\,\\mathrm{fm}]$ 上，使用稳健的一维搜索算法对 $r_{\\mathrm{N}}$ 进行最小化。必须为每种几何构型独立执行最小化。\n\n7. 相选择。对于每个密度 $n$，选择能够得到最小化 $\\varepsilon_{\\mathrm{tot}}(d,n)$ 的几何构型 $d$。\n\n8. 输出编码。将每种密度下选择的几何构型编码为整数：\n- 球体（$d=3$）为 $3$，\n- 圆柱体（$d=2$）为 $2$，\n- 板状体（$d=1$）为 $1$。\n\n最终输出应为单行文本，其中包含整个测试套件的结果，格式为方括号内用逗号分隔的列表。\n\n测试套件。使用以下重子数密度（单位为 $\\mathrm{fm}^{-3}$）作为输入：\n- 正常路径，低至中等密度，此时液滴相和棒状相竞争：$n \\in \\{0.01,\\,0.03,\\,0.06\\}$。\n- 过渡区域，此时棒状相和板状相竞争：$n \\in \\{0.09,\\,0.12\\}$。\n- 接近 $n_{\\mathrm{in}}$ 的高亚饱和密度，用于探测板状相的主导地位：$n = 0.15$。\n\n您的程序应生成一行输出，其中包含这些密度下最优几何构型的整数编码，顺序与输入相同，格式为方括号内用逗号分隔的列表（例如，“[3,3,2,1,1,1]”）。不允许有任何其他输出。由于输出是整数代码，最终答案行不需要物理单位。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它提出了一个植根于核天体物理学领域的、具有科学依据、适定且客观的计算任务。该模型虽然经过简化，但基于研究“核意面”相的既定原理，即 Wigner-Seitz 原胞框架内表面能与库仑能之间的竞争。所有必需的方程、常数和数值参数均已提供，构成了一个自洽且一致的问题定义。我现在将开始进行求解。\n\n核心任务是确定作为平均重子数密度 $n$ 的函数，热力学上最优的核几何构型——球体（$d=3$）、圆柱体（$d=2$）或板状体（$d=1$）。最优几何构型是使总自由能密度 $\\varepsilon_{\\mathrm{tot}}$ 最小化的构型，该总自由能密度是表面能贡献 $\\varepsilon_S$ 和库仑能贡献 $\\varepsilon_C$ 的总和。\n\n对于给定的几何维度 $d$ 和重子密度 $n$，总能量密度是致密核团簇尺寸 $r_{\\mathrm{N}}$ 的函数：\n$$\n\\varepsilon_{\\mathrm{tot}}(d, n, r_{\\mathrm{N}}) = \\varepsilon_{S}(d, n, r_{\\mathrm{N}}) + \\varepsilon_{C}(d, n, r_{\\mathrm{N}})\n$$\n对于每个指定的密度 $n$，我们的方法包括两个主要步骤：\n1. 对于每种几何构型 $d \\in \\{1, 2, 3\\}$，我们在指定域 $r_{\\mathrm{N}} \\in [0.5\\,\\mathrm{fm},\\,30\\,\\mathrm{fm}]$ 上，对总能量密度 $\\varepsilon_{\\mathrm{tot}}(d, n, r_{\\mathrm{N}})$ 关于团簇尺寸 $r_{\\mathrm{N}}$ 进行最小化。这将为每种几何构型产生一个最小化能量，$\\varepsilon_{\\mathrm{min}}(d, n) = \\min_{r_{\\mathrm{N}}} \\varepsilon_{\\mathrm{tot}}(d, n, r_{\\mathrm{N}})$。\n2. 我们比较这些最小化能量，并选择具有最低能量的几何构型 $d^*$：对于所有 $d \\in \\{1, 2, 3\\}$，均有 $\\varepsilon_{\\mathrm{min}}(d^*, n) \\le \\varepsilon_{\\mathrm{min}}(d, n)$。\n\n表面能密度 $\\varepsilon_S$ 由下式给出：\n$$\n\\varepsilon_{S}(d,n,r_{\\mathrm{N}}) = \\frac{d\\,\\sigma(n)\\,u}{r_{\\mathrm{N}}}\n$$\n其中 $\\sigma(n)$ 是规定的表面张力，$u = n/n_{\\mathrm{in}}$ 是致密相的体积分数。这一项倾向于形成更大的结构（即增加 $r_{\\mathrm{N}}$），以最小化表面积与体积之比。\n\n库仑能密度 $\\varepsilon_C$ 源于团簇内质子间的排斥力，该排斥力被周围的电子气所屏蔽。它通过求解静电势 $\\phi(r)$ 的一维径向有屏蔽泊松方程来计算：\n$$\n\\frac{1}{r^{d-1}} \\frac{d}{dr} \\!\\left(r^{d-1} \\frac{d\\phi}{dr}\\right) - \\frac{\\phi}{\\lambda_{e}^{2}} = - \\rho_{p}(r)\n$$\n该方程服从零梯度（Neumann）边界条件，$\\phi'(0)=0$ 和 $\\phi'(R_c)=0$，其中 $R_c = r_{\\mathrm{N}}/u^{1/d}$ 是 Wigner-Seitz 原胞半径。这里，$\\lambda_e$ 是电子屏蔽长度，$\\rho_p(r)$ 是质子数密度，在团簇内部（$r  r_{\\mathrm{N}}$）为常数，在外部为零。\n\n该方程可以重写为：\n$$\n\\frac{d^2\\phi}{dr^2} + \\frac{d-1}{r}\\frac{d\\phi}{dr} - k^2\\phi = -\\rho_p(r)\n$$\n其中 $k = 1/\\lambda_e$。这是一个线性二阶边值问题。我们使用有限差分法，在从 $r=0$ 到 $r=R_c$ 的一个包含 $N_{\\text{grid}}=500$ 个点的均匀径向网格上对其进行数值求解。\n- 对于内部网格点，使用标准的二阶中心差分来计算导数。\n- 在原点 $r=0$ 处，当 $d1$ 时，项 $\\frac{d-1}{r}\\phi'$ 是奇异的。应用洛必达法则和边界条件 $\\phi'(0)=0$，方程变为 $d\\cdot\\phi''(0) - k^2\\phi(0) = -\\rho_p(0)$。我们使用从虚点法导出的 $\\phi''(0)$ 的前向差分来对其进行离散化。\n- 在外边界 $r=R_c$ 处，条件 $\\phi'(R_c)=0$ 使用同样从虚点法导出的后向差分来实现。\n\n这种离散化将微分方程转换为一个三对角线性代数方程组，我们使用 `scipy.linalg.solve_banded` 在每个网格点上高效地求解电势 $\\phi$。\n\n一旦电势 $\\phi(r)$ 已知，就使用梯形法则（`numpy.trapz`）对电荷分布进行数值积分，以计算库仑能密度：\n$$\n\\varepsilon_{C}(d,n,r_{\\mathrm{N}}) = \\frac{d}{2 R_c^d} \\int_{0}^{r_{\\mathrm{N}}} n_{p,\\mathrm{in}} \\phi(r) r^{d-1} dr\n$$\n然后，使用稳健的 `scipy.optimize.minimize_scalar` 函数和 'bounded' 方法，对总能量 $\\varepsilon_{\\mathrm{tot}}(r_{\\mathrm{N}})$ 关于 $r_{\\mathrm{N}}$ 进行最小化。\n\n对测试套件中的每个密度重复整个过程，并将每个密度下得到的最优几何构型编码为整数（$1, 2$ 或 $3$），并以指定的输出格式呈现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\nfrom scipy.linalg import solve_banded\n\n# Define constants as per the problem statement.\nN_IN_DENSITY = 0.16  # fm^-3\nN_GRID_POINTS = 500  # Number of grid points for the finite-difference solver.\n\ndef _get_physical_params(n):\n    \"\"\"\n    Calculates density-dependent physical parameters.\n\n    Args:\n        n (float): Baryon number density in fm^-3.\n\n    Returns:\n        tuple: A tuple containing u, n_p_in, sigma_n, lambda_e.\n    \"\"\"\n    u = n / N_IN_DENSITY\n    u = np.clip(u, 1e-2, 0.99)\n    \n    yp_n = 0.05 + 0.1 * np.exp(-n / 0.06)\n    n_p_in = yp_n * N_IN_DENSITY\n    n_e = u * n_p_in\n    \n    sigma_n = max(0.3, 1.0 - 0.4 * n / N_IN_DENSITY)\n    \n    # Avoid division by zero if n_e is extremely small or zero.\n    if n_e = 1e-12:\n        lambda_e = np.inf\n    else:\n        lambda_e = 20.0 * (0.05 / n_e)**(1.0/3.0)\n        \n    return u, n_p_in, sigma_n, lambda_e\n\ndef _calculate_coulomb_energy(d, u, n_p_in, lambda_e, r_N):\n    \"\"\"\n    Solves the screened Poisson equation and computes the Coulomb energy density.\n    \n    Args:\n        d (int): Geometry dimension (1, 2, or 3).\n        u (float): Volume fraction.\n        n_p_in (float): Proton density inside the cluster.\n        lambda_e (float): Electron screening length.\n        r_N (float): Cluster radius.\n\n    Returns:\n        float: The calculated Coulomb energy density in MeV/fm^3 (with absorbed constants).\n    \"\"\"\n    if r_N == 0: return 0.0\n    R_c = r_N / (u**(1.0/d))\n    if R_c = r_N: return np.inf # Unphysical situation where u = 1\n\n    # 1. Set up the grid and physical parameters for the solver.\n    r = np.linspace(0, R_c, N_GRID_POINTS)\n    dr = r[1] - r[0]\n    \n    k_sq = 1.0 / lambda_e**2 if np.isfinite(lambda_e) else 0.0\n    \n    # 2. Define the source term (proton charge density).\n    N_r_idx = np.searchsorted(r, r_N, side='left')\n    rho_p = np.zeros(N_GRID_POINTS)\n    rho_p[:N_r_idx] = n_p_in\n\n    # 3. Build and solve the tridiagonal system for the potential phi.\n    # The system is M*phi = b, where b = -rho_p.\n    # The matrix M is stored in banded format `ab`.\n    dr_sq = dr**2\n    main_diag = np.zeros(N_GRID_POINTS)\n    upper_diag = np.zeros(N_GRID_POINTS - 1)\n    lower_diag = np.zeros(N_GRID_POINTS - 1)\n\n    # Discretization for interior points: 1 = i = N_GRID_POINTS - 2\n    for i in range(1, N_GRID_POINTS - 1):\n        main_diag[i] = -2.0/dr_sq - k_sq\n        upper_diag[i] = 1.0/dr_sq + (d-1.0)/(2.0 * r[i] * dr)\n        lower_diag[i-1] = 1.0/dr_sq - (d-1.0)/(2.0 * r[i] * dr)\n    \n    # Boundary condition at r=0 (i=0)\n    main_diag[0] = -2.0*d/dr_sq - k_sq\n    upper_diag[0] = 2.0*d/dr_sq\n\n    # Boundary condition at r=R_c (i=N_GRID_POINTS-1)\n    main_diag[-1] = -2.0/dr_sq - k_sq\n    lower_diag[-1] = 2.0/dr_sq\n\n    ab = np.zeros((3, N_GRID_POINTS))\n    ab[1, :] = main_diag\n    ab[0, 1:] = upper_diag\n    ab[2, :-1] = lower_diag\n    \n    try:\n        phi = solve_banded((1, 1), ab, -rho_p, check_finite=False)\n    except np.linalg.LinAlgError:\n        return np.inf\n\n    # 4. Compute Coulomb energy density by numerical integration of (1/2) * rho * phi.\n    integrand = phi[:N_r_idx] * (r[:N_r_idx]**(d-1))\n    integral_val = np.trapz(integrand, x=r[:N_r_idx])\n    \n    if R_c == 0: return 0.0\n    \n    e_coul = (d * n_p_in / (2.0 * R_c**d)) * integral_val\n    return e_coul\n\ndef _get_preferred_geometry(n):\n    \"\"\"\n    Finds the pasta geometry with the minimum free energy at a given density n.\n    \n    Args:\n        n (float): Baryon number density in fm^-3.\n        \n    Returns:\n        int: The integer code (1, 2, or 3) for the preferred geometry.\n    \"\"\"\n    u, n_p_in, sigma_n, lambda_e = _get_physical_params(n)\n    \n    min_energies = {}\n    \n    # Iterate through geometries: 3=spheres, 2=cylinders, 1=slabs.\n    for d in [3, 2, 1]:\n        def total_energy(r_N):\n            e_surf = d * sigma_n * u / r_N\n            e_coul = _calculate_coulomb_energy(d, u, n_p_in, lambda_e, r_N)\n            return e_surf + e_coul\n            \n        res = minimize_scalar(\n            total_energy,\n            bounds=(0.5, 30.0),\n            method='bounded'\n        )\n        min_energies[d] = res.fun\n        \n    # Determine the geometry that yields the minimum total energy.\n    preferred_d = min(min_energies, key=min_energies.get)\n    return preferred_d\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite of densities.\n    The results are printed in the specified single-line format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [0.01, 0.03, 0.06, 0.09, 0.12, 0.15]\n\n    results = []\n    for n in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        result = _get_preferred_geometry(n)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了表面能和库仑能的基本竞争之后，一个自然而然的问题是：表面能本身由哪些更基本的物理相互作用贡献？本练习将引入一个更真实的能量密度泛函（EDF）模型，让您能够剖析对“面食”相稳定性起关键作用的能量项，特别是自旋轨道相互作用和配对能的贡献。通过在一个简化的液滴模型框架下，系统地开启或关闭这些相互作用，您将量化它们对不同“面食”构型（板状与柱状）能量差异的影响。",
            "id": "3579784",
            "problem": "您将使用可压缩液滴模型近似下的能量密度泛函 (EDF) 框架，对两种理想化的核面食相形态——板状结构和棒状结构——进行计算比较。目标是计算在固定的重子数密度和质子分数下，板状和棒状构型之间的每重子能量差，并评估包含自旋轨道项和对偶项如何改变其稳定性。该问题必须从第一性原理出发解决，并使用数学和物理上一致的规则来表述。\n\n使用以下物理和建模设置。\n\n1. 基本基础和物理背景：\n   - 考虑中子星内壳中核物质的两相混合物，其重子数密度 $n$ 和质子分数 $Y_p$ 固定。一相是密度近似为饱和密度的高密核物质，另一相是稀薄气体。\n   - 能量密度泛函 (EDF) 模型包括来自体核物质、梯度（表面）能、库仑能、自旋轨道能和对偶能的贡献。对于均匀相，自旋轨道和对偶的贡献可以通过界面附近的有效修正来近似。\n\n2. 全局常数和固定条件：\n   - 使用固定的重子数密度 $n = 0.06\\,\\mathrm{fm}^{-3}$。\n   - 使用固定的质子分数 $Y_p = 0.05$。\n   - 核饱和密度 $n_0 = 0.16\\,\\mathrm{fm}^{-3}$。\n   - 核单位下的基本库仑常数：$e^2 = 1.44\\,\\mathrm{MeV\\,fm}$。\n   - 界面厚度（相干长度）$\\xi = 2\\,\\mathrm{fm}$。\n   - 梯度系数 $C_{\\mathrm{grad}} = 20\\,\\mathrm{MeV\\,fm}^5$。\n   - 基准自旋轨道系数 $C_{\\mathrm{so,0}} = 6\\,\\mathrm{MeV\\,fm}^5$。\n   - 单位面积的基准对偶抑制尺度 $P_s = 1.0\\,\\mathrm{MeV\\,fm}^{-2}$。\n\n3. 几何和热力学设置：\n   - 假设高密相的重子密度为 $n_{\\mathrm{in}} \\approx n_0$，稀薄相的重子密度为 $n_{\\mathrm{out}} \\approx 0$。高密相所占的体积分数为 $u = n/n_0$，其中 $0  u  1$。如果为了数值稳健性需要，将 $u$ 严格限制在 $(0,1)$ 区间内。\n   - 相间的质子密度差为 $\\Delta n_p = Y_p\\,(n_{\\mathrm{in}} - n_{\\mathrm{out}}) \\approx Y_p\\,n_0$。\n   - 对于板状（平面）和棒状（圆柱）两种几何构型，用高密区域的单一特征尺寸 $l$ 来表示其形态（对于板状，是板的厚度 $t$；对于棒状，是圆柱的半径 $R$）。在每单元单区域近似下，两种几何构型的单位体积界面面积可表示为 $S/V \\approx 2u/l$。\n   - 依赖于几何构型的库仑能量密度与特征尺寸 $l$ 成平方关系，并取决于一个无量纲形状因子 $f_d(u)$ 和一个依赖于几何构型的前置因子 $A_d$：\n     - 对于板状结构（维度 $d=1$），使用 $A_1 = \\pi$ 和 $f_1(u) = u\\,(1 - u)$。\n     - 对于棒状结构（维度 $d=2$），使用 $A_2 = \\pi/2$ 和 $f_2(u) = u\\,(1 - u/2)$。\n   - 梯度（表面）能量密度通过一个与 $S/V$ 呈线性关系的项来近似：$E_{\\mathrm{surf}}/V \\approx \\sigma_{\\mathrm{surf}}\\,(S/V)$，其中 $\\sigma_{\\mathrm{surf}} = C_{\\mathrm{grad}}\\,\\Delta n^2/\\xi$ 且 $\\Delta n = n_{\\mathrm{in}} - n_{\\mathrm{out}} \\approx n_0$。\n   - 自旋轨道能量密度类似地建模为一个界面线性修正：$E_{\\mathrm{so}}/V \\approx \\sigma_{\\mathrm{so}}\\,(S/V)$，其中 $\\sigma_{\\mathrm{so}} = C_{\\mathrm{so}}\\,\\Delta n^2/\\xi$，而 $C_{\\mathrm{so}}$ 是一个可调系数，通过一个比例因子从基准值 $C_{\\mathrm{so,0}}$ 导出。\n   - 对偶能量密度在界面附近表现出抑制效应。将依赖于几何构型的抑制建模为 $E_{\\mathrm{pair}}/V \\approx \\sigma_{\\mathrm{pair}}\\,(S/V)$，其中 $\\sigma_{\\mathrm{pair}} = P_s\\,Y_p$（可能乘以一个比例因子）。在比较固定 $n$ 和 $Y_p$ 下的不同几何构型时，均匀体对偶贡献会相互抵消，因此计算能量差时只需要考虑依赖于界面的抑制项。\n\n4. 优化原理：\n   - 对于给定的几何构型，其能量密度中依赖于几何构型的部分是特征尺寸 $l$ 的一个界面线性项和一个库仑二次项之和：\n     $$\\frac{E_{\\mathrm{geom}}}{V}(l) = \\underbrace{\\left(\\sigma_{\\mathrm{surf}} + \\sigma_{\\mathrm{so}} + \\sigma_{\\mathrm{pair}}\\right)\\frac{2u}{l}}_{\\text{interface-linear}} + \\underbrace{A_d\\,e^2\\,(\\Delta n_p)^2\\,u\\,f_d(u)\\,l^2}_{\\text{Coulomb-quadratic}}.$$\n   - 您必须对每种几何构型，就 $l  0$ 对 $\\frac{E_{\\mathrm{geom}}}{V}(l)$ 进行最小化，以获得优化后的依赖于几何构型的能量密度。然后，通过除以 $n$ 将其转换为每重子能量。\n\n5. 交付内容：\n   - 实现一个程序，使用上述模型计算板状和棒状结构在指定的固定 $n$ 和 $Y_p$ 下的每重子能量，单位为每重子 $\\mathrm{MeV}$。\n   - 为一组测试用例计算每重子能量差 $\\Delta E = E_{\\mathrm{slab}} - E_{\\mathrm{rod}}$（单位为 $\\mathrm{MeV}$），这些测试用例会打开或关闭自旋轨道项和对偶项，并调整其强度。\n\n6. 单位和数值报告：\n   - 所有能量差均以每重子 $\\mathrm{MeV}$ 为单位表示，并四舍五入到六位小数。\n   - 不使用角度；不需要角度单位。\n\n7. 测试套件：\n   - 在上述固定的 $n$ 和 $Y_p$ 值下，使用以下六个测试用例。每个用例都为是否包含自旋轨道项和对偶项设置了布尔开关，并设置了相对于基准值的比例因子：\n     1. 自旋轨道开启，对偶开启，自旋轨道比例因子 $1.0$，对偶比例因子 $1.0$。\n     2. 自旋轨道关闭，对偶关闭，自旋轨道比例因子 $1.0$，对偶比例因子 $1.0$。\n     3. 自旋轨道开启，对偶关闭，自旋轨道比例因子 $1.0$，对偶比例因子 $1.0$。\n     4. 自旋轨道关闭，对偶开启，自旋轨道比例因子 $1.0$，对偶比例因子 $1.0$。\n     5. 自旋轨道开启，对偶开启，自旋轨道比例因子 $2.0$，对偶比例因子 $1.0$。\n     6. 自旋轨道开启，对偶开启，自旋轨道比例因子 $1.0$，对偶比例因子 $2.0$。\n   - 对于每个测试用例，输出两个量：每重子能量差 $\\Delta E$ 和一个布尔值，该布尔值指示在最优点板状构型是否比棒状构型更稳定（即 $\\Delta E  0$ 是否成立）。\n\n8. 最终输出格式：\n   - 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须首先包含六个能量差（单位为每重子 $\\mathrm{MeV}$，每个都四舍五入到六位小数），然后是六个布尔值，顺序与测试用例相同。例如，一个有效的输出形式是\n     $$[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5,\\Delta E_6,\\mathrm{stable}_1,\\mathrm{stable}_2,\\mathrm{stable}_3,\\mathrm{stable}_4,\\mathrm{stable}_5,\\mathrm{stable}_6].$$\n\n您的实现必须是一个完整的、可运行的程序，它遵守指定的运行时环境，并且只打印上面描述的单行内容。",
            "solution": "用户希望解决一个关于中子星中“面食相”的计算核物理问题。\n这个问题的目标是在可压缩液滴模型的能量密度泛函 (EDF) 框架内，比较两种理想化的核面食相形态（板状和棒状）的能量稳定性。通过在优化每种相的几何构型后，计算每重子能量差 $\\Delta E = E_{\\mathrm{slab}} - E_{\\mathrm{rod}}$ 来评估稳定性。该分析还将探讨自旋轨道和对偶相互作用对该能量差的影响。\n\n该模型的核心是能量密度中依赖于几何构型的部分 $\\mathcal{E}_{\\mathrm{geom}}/V$，它是特征尺寸 $l$（板厚或棒半径）的函数。对于给定的几何构型（按维度 $d$ 索引，$d=1$ 代表板状，$d=2$ 代表棒状），该能量密度由与界面相关的项和库仑项之和给出：\n$$\n\\frac{E_{\\mathrm{geom}}}{V}(l) \\equiv \\mathcal{E}_d(l) = \\frac{C_1}{l} + C_{2,d} l^2\n$$\n第一项说明了在高密和稀薄核相之间创建界面所需的能量代价。系数 $C_1$ 与总表面张力 $\\sigma_{\\mathrm{total}}$ 以及单位体积的界面面积成正比，后者近似为 $S/V \\approx 2u/l$。表面张力本身是核梯度能 ($\\sigma_{\\mathrm{surf}}$)、自旋轨道相互作用 ($\\sigma_{\\mathrm{so}}$) 和对偶能 ($\\sigma_{\\mathrm{pair}}$) 贡献的总和。因此，系数为：\n$$\nC_1 = (\\sigma_{\\mathrm{surf}} + \\sigma_{\\mathrm{so}} + \\sigma_{\\mathrm{pair}}) \\cdot 2u\n$$\n其中 $u=n/n_0$ 是高密相的体积分数。各个表面张力项定义如下：\n- $\\sigma_{\\mathrm{surf}} = C_{\\mathrm{grad}}\\,\\Delta n^2/\\xi$\n- $\\sigma_{\\mathrm{so}} = C_{\\mathrm{so}}\\,\\Delta n^2/\\xi$\n- $\\sigma_{\\mathrm{pair}} = P_s\\,Y_p \\cdot (\\text{scale factor})$\n此处，$\\Delta n \\approx n_0$ 是相间的重子密度差。根据测试用例的规范，可以开启或关闭自旋轨道项和对偶项，并对其进行缩放。\n\n第二项 $C_{2,d} l^2$ 代表带电荷的高密结构内部的排斥性库仑能。系数 $C_{2,d}$ 依赖于几何构型：\n$$\nC_{2,d} = A_d\\,e^2\\,(\\Delta n_p)^2\\,u\\,f_d(u)\n$$\n其中 $\\Delta n_p \\approx Y_p n_0$ 是质子密度差，$e^2$ 是库仑常数，$A_d$ 是一个依赖于几何构型的前置因子（板状为 $A_1=\\pi$，棒状为 $A_2=\\pi/2$），$f_d(u)$ 是一个无量纲形状因子（板状为 $f_1(u) = u(1 - u)$，棒状为 $f_2(u) = u(1-u/2)$）。\n\n对于每种形态，我们通过对 $\\mathcal{E}_d(l)$ 就 $l0$ 进行最小化来找到最优特征尺寸 $l_{d,\\text{opt}}$。我们在能量密度导数为零的地方求解 $l$：\n$$\n\\frac{d\\mathcal{E}_d(l)}{dl} = -\\frac{C_1}{l^2} + 2 C_{2,d} l = 0\n$$\n这给出了最优尺寸：\n$$\nl_{d,\\text{opt}} = \\left( \\frac{C_1}{2 C_{2,d}} \\right)^{1/3}\n$$\n将 $l_{d,\\text{opt}}$ 代回能量密度表达式，得到最小化的能量密度 $\\mathcal{E}_{d,\\text{min}}$：\n$$\n\\mathcal{E}_{d,\\text{min}} = \\mathcal{E}_d(l_{d,\\text{opt}}) = \\frac{C_1}{l_{d,\\text{opt}}} + C_{2,d} l_{d,\\text{opt}}^2\n$$\n使用关系式 $C_1 = 2 C_{2,d} l_{d,\\text{opt}}^3$，我们可以将其简化为：\n$$\n\\mathcal{E}_{d,\\text{min}} = 2 C_{2,d} l_{d,\\text{opt}}^2 + C_{2,d} l_{d,\\text{opt}}^2 = 3 C_{2,d} l_{d,\\text{opt}}^2 = 3 C_{2,d} \\left( \\frac{C_1}{2 C_{2,d}} \\right)^{2/3}\n$$\n这可以进一步简化为：\n$$\n\\mathcal{E}_{d,\\text{min}} = \\frac{3}{2^{2/3}} C_1^{2/3} C_{2,d}^{1/3}\n$$\n问题要求的是每重子能量 $E_{d, \\text{baryon}}$，这可以通过将最小能量密度除以平均重子密度 $n$ 来获得：\n$$\nE_{d, \\text{baryon}} = \\frac{\\mathcal{E}_{d,\\text{min}}}{n} = \\frac{3}{n \\cdot 2^{2/3}} C_1^{2/3} C_{2,d}^{1/3}\n$$\n我们关心的量是板状（$d=1$）和棒状（$d=2$）构型之间的每重子能量差：\n$$\n\\Delta E = E_{\\mathrm{slab}} - E_{\\mathrm{rod}} = E_{1, \\text{baryon}} - E_{2, \\text{baryon}}\n$$\n提取公因式后，我们得到用于计算的最终表达式：\n$$\n\\Delta E = \\frac{3}{n \\cdot 2^{2/3}} C_1^{2/3} \\left( C_{2,1}^{1/3} - C_{2,2}^{1/3} \\right)\n$$\n如果 $\\Delta E  0$，则板状构型比棒状构型更稳定。\n\n计算步骤如下：\n1.  定义所有物理常数（$n, Y_p, n_0, e^2, \\xi, C_{\\mathrm{grad}}, C_{\\mathrm{so,0}}, P_s$）并预先计算派生常数（$u, \\Delta n, \\Delta n_p, \\sigma_{\\mathrm{surf}}$）。\n2.  预先计算依赖于几何构型的库仑系数 $C_{2,1}$ 和 $C_{2,2}$，因为它们在所有测试用例中都是恒定的。\n3.  遍历六个测试用例。对于每个用例：\n    a. 根据布尔标志和缩放因子确定 $\\sigma_{\\mathrm{so}}$ 和 $\\sigma_{\\mathrm{pair}}$ 的值。\n    b. 计算总表面张力 $\\sigma_{\\mathrm{total}} = \\sigma_{\\mathrm{surf}} + \\sigma_{\\mathrm{so}} + \\sigma_{\\mathrm{pair}}$。\n    c. 计算界面系数 $C_1 = \\sigma_{\\mathrm{total}} \\cdot 2u$。\n    d. 使用最终推导出的公式计算 $\\Delta E$。\n    e. 确定稳定性布尔值（$\\Delta E  0$）。\n4.  收集结果并将其格式化为指定的单行输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the energy difference between slab and rod nuclear pasta phases.\n    \"\"\"\n    # 1. Fundamental base and physical context\n    # Fixed global constants and conditions\n    n = 0.06  # Baryon number density in fm^-3\n    Y_p = 0.05  # Proton fraction\n    n_0 = 0.16  # Nuclear saturation density in fm^-3\n    e2 = 1.44  # Elementary Coulomb constant in MeV fm\n    xi = 2.0  # Interface thickness in fm\n    C_grad = 20.0  # Gradient coefficient in MeV fm^5\n    C_so_0 = 6.0  # Baseline spin-orbit coefficient in MeV fm^5\n    P_s = 1.0  # Baseline pairing suppression scale in MeV fm^-2\n\n    # Derived constants from geometric and thermodynamic setup\n    u = n / n_0  # Volume fraction of dense phase\n    delta_n = n_0  # Baryon density contrast (n_in - n_out)\n    delta_np = Y_p * n_0  # Proton density contrast\n\n    # Interface tension contributions\n    sigma_surf = C_grad * (delta_n**2) / xi\n    \n    # Pre-calculate geometry-dependent Coulomb coefficients C_2,d\n    # These are constant across all test cases.\n    \n    # Common factor for C_2,d\n    c2_common_factor = e2 * (delta_np**2) * u\n    \n    # For slabs (d=1)\n    A1 = np.pi\n    f1_u = u * (1.0 - u)\n    C_2_1 = A1 * c2_common_factor * f1_u\n    \n    # For rods (d=2)\n    A2 = np.pi / 2.0\n    f2_u = u * (1.0 - u / 2.0)\n    C_2_2 = A2 * c2_common_factor * f2_u\n\n    # Test suite\n    test_cases = [\n        # (so_on, pairing_on, so_scale, pairing_scale)\n        (True, True, 1.0, 1.0),\n        (False, False, 1.0, 1.0),\n        (True, False, 1.0, 1.0),\n        (False, True, 1.0, 1.0),\n        (True, True, 2.0, 1.0),\n        (True, True, 1.0, 2.0),\n    ]\n\n    delta_e_results = []\n    stability_results = []\n\n    # Optimization and calculation loop\n    for so_on, pairing_on, so_scale, pairing_scale in test_cases:\n        # Calculate case-dependent interface tension terms\n        sigma_so = 0.0\n        if so_on:\n            C_so = C_so_0 * so_scale\n            sigma_so = C_so * (delta_n**2) / xi\n\n        sigma_pair = 0.0\n        if pairing_on:\n            scaled_P_s = P_s * pairing_scale\n            sigma_pair = scaled_P_s * Y_p\n\n        # Total interface tension for the case\n        sigma_total = sigma_surf + sigma_so + sigma_pair\n        \n        # Calculate interface coefficient C_1\n        C_1 = sigma_total * 2.0 * u\n        \n        # Calculate energy difference using the derived formula\n        # Delta_E = (3 / (n * 2^(2/3))) * C_1^(2/3) * (C_2_1^(1/3) - C_2_2^(1/3))\n        \n        const_factor = 3.0 / (n * np.cbrt(4.0))\n        c1_factor = np.cbrt(C_1**2)\n        c2_diff_factor = np.cbrt(C_2_1) - np.cbrt(C_2_2)\n        \n        delta_E = const_factor * c1_factor * c2_diff_factor\n        \n        # Determine stability (slab is more stable if Delta_E = 0)\n        is_slab_stable = delta_E = 0.0\n        \n        delta_e_results.append(delta_E)\n        stability_results.append(is_slab_stable)\n\n    # Format the final output string\n    # Round delta_E values to six decimal places\n    formatted_delta_e = [f\"{val:.6f}\" for val in delta_e_results]\n    \n    # Convert booleans to strings 'True' or 'False'\n    formatted_stability = [str(val) for val in stability_results]\n    \n    final_output = f\"[{','.join(formatted_delta_e)},{','.join(formatted_stability)}]\"\n\n    # Print the final output in the exact required format\n    print(final_output)\n\nsolve()\n\n```"
        },
        {
            "introduction": "中子星中的“面食”结构可能远比简单的棒状和板状构型复杂，例如具有三重周期性的“螺旋”相（gyroid）。本练习将引导您进入“面食”相研究的前沿，使用基于水平集（level-set）方法和快速傅里叶变换（FFT）的三维模拟技术，来计算并比较这些复杂拓扑结构的能量。此练习不仅能让您掌握更高级的计算物理工具，还将引入“亚稳态”这一关键概念，帮助您理解为何某些能量并非最低的相也可能在特定的物理条件下存在。",
            "id": "3579768",
            "problem": "您的任务是构建一个完整的、可运行的程序，为拓扑受限的核意面候选结构计算类螺旋二十四面体（gyroid-like）构型相对于板状（slabs）和棒状（rods）结构的无量纲能量差 $\\Delta E$，并评估其亚稳窗口。\n\n计算设置必须是纯数学和自洽的，从与致密物质中核意面微观结构相关的已确立能量分量出发。\n\n从以下基本基础开始，这在受液滴模型启发的核意面建模中是标准做法：总能量密度被建模为表面项和库仑相互作用项之和。系统占据一个周期性的立方体区域，并接纳由解析的三重周期函数生成的候选形态；拓扑由所选的解析形式约束。所有量在构造上都是无量纲的。\n\n设周期性立方体区域为 $[0,1]^3$，具有周期性边界条件。设空间网格每轴有 $N$ 个点，均匀间距为 $dx = 1/N$，笛卡尔网格坐标为 $\\{x_i\\}$, $\\{y_j\\}$, $\\{z_k\\}$，其中 $i,j,k \\in \\{0,1,\\dots,N-1\\}$。\n\n对于每种候选形态，通过一个三角函数拟设来定义一个底层标量场 $\\phi(\\mathbf{r})$，该拟设具有整数波数 $k \\in \\mathbb{Z}^{+}$，角频率 $\\omega = 2\\pi k$，且振幅固定为单位1。三个候选族是：\n- 板状（lamella，常被称为“lasagna”）：$\\phi_{\\mathrm{slab}}(x,y,z;k) = \\sin(\\omega x)$。\n- 棒状（圆柱阵列，在理想化的可分离替代模型中常被称为“spaghetti”）：$\\phi_{\\mathrm{rod}}(x,y,z;k) = \\sin(\\omega x) + \\sin(\\omega y)$。\n- 类螺旋二十四面体三重周期最小曲面替代物（节面螺旋二十四面体近似）：$\\phi_{\\mathrm{gyro}}(x,y,z;k) = \\sin(\\omega x)\\cos(\\omega y) + \\sin(\\omega y)\\cos(\\omega z) + \\sin(\\omega z)\\cos(\\omega x)$。\n\n对于指定的密相体积分数 $f \\in (0,1)$，隐式地定义等值面阈值 $t$，使得密相是超水平集 $\\{\\mathbf{r} \\, | \\, \\phi(\\mathbf{r}) \\ge t\\}$，并且该集合的体积分数等于 $f$。在数值上，可以通过将 $t$ 设置为网格上 $\\phi$ 的离散样本的 $(1-f)$-分位数来实现。\n\n令相指示函数为 $h(\\mathbf{r}) = H(\\phi(\\mathbf{r}) - t)$，其中 $H$ 是 Heaviside 函数，$H(u) = 1$ 如果 $u \\ge 0$，$H(u) = 0$ 否则。通过定义无量纲电荷密度 $\\rho(\\mathbf{r}) = h(\\mathbf{r}) - f$ 来强制电荷中性，当体积分数约束被精确满足时，该密度根据构造其空间平均值为零。\n\n使用水平集表面积公式定义表面贡献。等值面 $\\phi(\\mathbf{r}) = t$ 的表面积由下式给出\n$$\nA = \\int_{[0,1]^3} \\delta(\\phi(\\mathbf{r}) - t)\\,\\lVert \\nabla \\phi(\\mathbf{r}) \\rVert \\, d^3\\mathbf{r},\n$$\n其中 $\\delta$ 是 Dirac delta 函数。数值上，用宽度为 $\\varepsilon  0$ 的窄高斯函数来近似 $\\delta$：\n$$\n\\delta_{\\varepsilon}(u) = \\frac{1}{\\sqrt{\\pi}\\,\\varepsilon} \\exp\\!\\left(-\\frac{u^2}{\\varepsilon^2}\\right),\n$$\n并用带周期性边界条件的中心有限差分来近似梯度：\n$$\n\\partial_x \\phi \\approx \\frac{\\phi(x+dx,y,z) - \\phi(x-dx,y,z)}{2\\,dx}, \\quad \\text{对于 } \\partial_y, \\partial_z \\text{ 也类似}.\n$$\n令表面能系数为 $a_s  0$。表面能密度贡献为 $E_{\\mathrm{surf}} = a_s\\,A$。\n\n通过求解带周期性边界条件的无量纲泊松方程的静电势 $\\varphi$ 来定义库仑贡献，\n$$\n-\\nabla^2 \\varphi(\\mathbf{r}) = 4\\pi\\,\\rho(\\mathbf{r}),\n$$\n并令 $a_c  0$ 为库仑耦合前置因子。库仑能量密度贡献为\n$$\nE_{\\mathrm{C}} = \\frac{1}{2} a_c \\int_{[0,1]^3} \\rho(\\mathbf{r})\\,\\varphi(\\mathbf{r}) \\, d^3\\mathbf{r}.\n$$\n在数值上，使用快速傅里叶变换（FFT）谱方法求解器计算 $\\varphi$：如果 $\\widehat{\\rho}(\\mathbf{k})$ 是 $\\rho$ 的离散傅里叶变换，$\\mathbf{k}$ 是模长平方为 $\\lVert \\mathbf{k} \\rVert^2$ 的波矢，则对于所有非零模式，\n$$\n\\widehat{\\varphi}(\\mathbf{k}) = \\frac{4\\pi \\widehat{\\rho}(\\mathbf{k})}{\\lVert \\mathbf{k} \\rVert^2},\n$$\n并将零模式设置为 $0$ 以强制中性。通过逆 FFT 恢复 $\\varphi(\\mathbf{r})$，然后构成离散化积分。\n\n在波数 $k$ 下，一个候选形状的总能量密度是各项之和：\n$$\nE_{\\mathrm{tot}}(k; \\text{shape}, f, a_s, a_c, \\varepsilon) = E_{\\mathrm{surf}}(k) + E_{\\mathrm{C}}(k).\n$$\n\n拓扑约束最小化：对于每个形状族，在整数波数 $k \\in \\{k_{\\min}, k_{\\min}+1, \\dots, k_{\\max}\\}$ 上最小化 $E_{\\mathrm{tot}}$，同时保持解析族固定（这强制了拓扑约束）。为每个形状确定最小化波数 $k_{\\star}$ 和最小能量 $E_{\\min}$。用二阶有限差分评估离散最小化子处的局部曲率\n$$\nE''(k_{\\star}) \\approx E_{\\mathrm{tot}}(k_{\\star}+1) - 2\\,E_{\\mathrm{tot}}(k_{\\star}) + E_{\\mathrm{tot}}(k_{\\star}-1),\n$$\n前提是 $k_{\\star}$ 严格位于搜索区间内部，以检查是否为局部最小值。\n\n能量差与亚稳性：计算螺旋二十四面体（gyroid）的最小能量 $E_{\\min}^{\\mathrm{gyro}}$ 以及板状和棒状的最小能量 $E_{\\min}^{\\mathrm{slab}}$ 和 $E_{\\min}^{\\mathrm{rod}}$。定义能量差\n$$\n\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{s}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{slab}}, \\quad\n\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{r}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{rod}}.\n$$\n令基准能量为 $E_{\\min}^{\\mathrm{base}} = \\min\\!\\big(E_{\\min}^{\\mathrm{slab}}, E_{\\min}^{\\mathrm{rod}}\\big)$，并定义 $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{base}}$。对于给定的非负窗口参数 $\\delta_{\\max}$，如果以下所有条件均成立，则宣布螺旋二十四面体是亚稳的：（i）$E''(k_{\\star}^{\\mathrm{gyro}})  0$（内部局部最小值），（ii）$\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}}  0$，以及（iii）$\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}} \\le \\delta_{\\max}$。\n\n所有量都是无量纲的。不使用角度。不需要物理单位转换。\n\n使用以下测试套件实现所述计算。对于每个案例，使用 $N = 32$，$k_{\\min} = 1$，$k_{\\max} = 6$（除非另有说明），并按下文描述的精确输出格式报告结果。\n- 案例 1：$f = 0.3$, $a_s = 1.0$, $a_c = 0.1$, $\\varepsilon = 0.03$, $\\delta_{\\max} = 0.05$。\n- 案例 2：$f = 0.5$, $a_s = 0.8$, $a_c = 0.2$, $\\varepsilon = 0.03$, $\\delta_{\\max} = 0.10$。\n- 案例 3：$f = 0.15$, $a_s = 1.2$, $a_c = 0.05$, $\\varepsilon = 0.03$, $\\delta_{\\max} = 0.05$。\n- 案例 4：$f = 0.85$, $a_s = 0.9$, $a_c = 0.25$, $\\varepsilon = 0.03$, $\\delta_{\\max} = 0.10$。\n\n您的程序必须：\n- 对于每个案例，对螺旋二十四面体（gyroid）、板状（slab）和棒状（rod）族在 $k \\in \\{1,2,3,4,5,6\\}$ 上执行拓扑约束的最小化。\n- 计算 $E_{\\min}^{\\mathrm{gyro}}$, $E_{\\min}^{\\mathrm{slab}}$, $E_{\\min}^{\\mathrm{rod}}$, $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{s}}$, $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{r}}$，以及如上定义的亚稳性布尔值。\n- 生成单行输出，其中包含一个按案例排列的结果列表，每个案例的结果本身是一个格式为 $[E_{\\min}^{\\mathrm{gyro}}, E_{\\min}^{\\mathrm{slab}}, E_{\\min}^{\\mathrm{rod}}, \\Delta E_{\\mathrm{g}\\text{-}\\mathrm{s}}, \\Delta E_{\\mathrm{g}\\text{-}\\mathrm{r}}, \\text{metastable}]$ 的列表。能量是无量纲单位的浮点数；亚稳性标志是一个布尔值。\n\n最终的单行输出必须是这些按案例排序的列表的顶层列表，以标准 Python 列表语法打印，例如 $[[\\ldots],[\\ldots],[\\ldots],[\\ldots]]$。",
            "solution": "所提供的问题是计算物理学中一个自洽且良定的练习，其科学基础是已建立的核物质液滴模型。所有参数、方程和数值方法都已明确指定，没有内部矛盾、模糊之处或事实错误。因此，该问题被认为是有效的，并按如下方式构建解决方案。\n\n任务的核心是计算三种核意面形态族——板状、棒状和类螺旋二十四面体结构——的总能量密度，并确定能量上更优的构型。总能量密度 $E_{\\mathrm{tot}}$ 是表面能贡献 $E_{\\mathrm{surf}}$ 和库仑能贡献 $E_{\\mathrm{C}}$ 的和。计算在离散化的周期性立方体区域 $[0,1]^3$ 上进行。\n\n首先，我们建立计算网格。该区域被离散化为一个 $N \\times N \\times N$ 点的均匀网格。网格间距为 $dx=1/N$。我们使用带有 `'ij'` 索引的 `numpy.meshgrid` 生成三维坐标数组 $(x, y, z)$，使得数组索引直接对应于空间维度。\n\n对于每种形态族（板状、棒状、螺旋二十四面体），一个标量场 $\\phi(\\mathbf{r})$ 由特定的三角函数拟设定义。它们如下：\n- 板状（Slab）：$\\phi_{\\mathrm{slab}}(x,y,z;k) = \\sin(\\omega x)$\n- 棒状（Rod）：$\\phi_{\\mathrm{rod}}(x,y,z;k) = \\sin(\\omega x) + \\sin(\\omega y)$\n- 类螺旋二十四面体（Gyroid-like）：$\\phi_{\\mathrm{gyro}}(x,y,z;k) = \\sin(\\omega x)\\cos(\\omega y) + \\sin(\\omega y)\\cos(\\omega z) + \\sin(\\omega z)\\cos(\\omega x)$\n这里，$k \\in \\mathbb{Z}^{+}$ 是一个整数波数，$\\omega = 2\\pi k$ 是相应的角频率。这些场在三维网格的每个点上进行评估。\n\n系统根据 $\\phi(\\mathbf{r})$ 的值被划分为密相和稀相。对于给定的密相体积分数 $f$，确定一个等值面阈值 $t$，使得 $\\phi(\\mathbf{r}) \\ge t$ 区域的体积等于 $f$。在数值上，这可以通过找到网格上离散场 $\\phi$ 所有值的 $(1-f)$-分位数来稳健地实现。然后定义一个相指示场 $h(\\mathbf{r})$，对于密相（$\\phi(\\mathbf{r}) \\ge t$）$h(\\mathbf{r})=1$，对于稀相 $h(\\mathbf{r})=0$。这是使用条件 `phi = t` 实现的。为确保整体电荷中性，定义了无量纲电荷密度 $\\rho(\\mathbf{r}) = h(\\mathbf{r}) - f$。根据构造，$\\rho(\\mathbf{r})$ 在整个区域上的空间平均值近似为零。\n\n表面能密度由 $E_{\\mathrm{surf}} = a_s A$ 给出，其中 $a_s$ 是给定系数，$A$ 是单位体积内两相界面的总表面积。面积由水平集积分计算得出：\n$$\nA = \\int_{[0,1]^3} \\delta(\\phi(\\mathbf{r}) - t)\\,\\lVert \\nabla \\phi(\\mathbf{r}) \\rVert \\, d^3\\mathbf{r}\n$$\n在数值上，该积分通过对网格单元求和来近似。Dirac delta 函数 $\\delta(u)$ 使用窄高斯函数 $\\delta_{\\varepsilon}(u) = (\\sqrt{\\pi}\\varepsilon)^{-1} \\exp(-u^2/\\varepsilon^2)$ 进行正则化，其宽度 $\\varepsilon$ 很小。梯度向量 $\\nabla\\phi$ 在每个网格点上使用二阶中心有限差分格式计算，这对于周期性区域可以通过使用 `numpy.roll` 访问相邻网格点来高效实现。梯度范数 $\\lVert \\nabla \\phi \\rVert$ 是其分量的标准欧几里得范数。该积分近似为所有网格点 $i$ 上的离散和：$A \\approx \\sum_i \\delta_{\\varepsilon}(\\phi_i - t)\\,\\lVert \\nabla \\phi_i \\rVert \\, (dx)^3$。\n\n库仑能量密度 $E_{\\mathrm{C}}$ 是通过求解泊松方程 $-\\nabla^2 \\varphi(\\mathbf{r}) = 4\\pi\\,\\rho(\\mathbf{r})$ （受周期性边界条件约束）的解来计算的。这可以使用基于快速傅里叶变换（FFT）的谱方法高效求解。\n1.  计算电荷密度的三维FFT，$\\widehat{\\rho}(\\mathbf{k}) = \\mathcal{F}[\\rho(\\mathbf{r})]$。\n2.  生成与离散傅里叶模式对应的波矢 $\\mathbf{k}$ 网格。对于大小为 $N$、间距为 $dx=1/N$ 的网格，波矢分量为 $k_i = 2\\pi m_i$，其中整数 $m_i$ 由 `numpy.fft.fftfreq(N)` 给出。\n3.  在傅里叶空间中，泊松方程变成一个代数方程：$\\lVert \\mathbf{k} \\rVert^2 \\widehat{\\varphi}(\\mathbf{k}) = 4\\pi \\widehat{\\rho}(\\mathbf{k})$。\n4.  于是，傅里叶空间中的势为 $\\widehat{\\varphi}(\\mathbf{k}) = 4\\pi \\widehat{\\rho}(\\mathbf{k}) / \\lVert \\mathbf{k} \\rVert^2$，适用于所有非零波矢 $\\mathbf{k} \\neq \\mathbf{0}$。对于零模式（$\\mathbf{k}=\\mathbf{0}$），我们设置 $\\widehat{\\varphi}(\\mathbf{0})=0$，这强制了电荷中性并使平均势为零。通过识别并单独处理零模式，可以避免除以零的错误。\n5.  通过对 $\\widehat{\\varphi}(\\mathbf{k})$ 执行三维逆FFT，可以恢复实空间中的势 $\\varphi(\\mathbf{r})$。\n库仑能量密度随后通过将积分 $E_{\\mathrm{C}} = \\frac{1}{2} a_c \\int \\rho(\\mathbf{r})\\varphi(\\mathbf{r}) \\, d^3\\mathbf{r}$ 近似为网格上的离散和来计算：$E_{\\mathrm{C}} \\approx \\frac{1}{2} a_c \\sum_i \\rho_i \\varphi_i \\, (dx)^3$。\n\n总能量 $E_{\\mathrm{tot}} = E_{\\mathrm{surf}} + E_{\\mathrm{C}}$ 是为每种形态和指定范围 $\\{k_{\\min}, \\dots, k_{\\max}\\}$ 内的每个整数波数 $k$ 计算的。对于每种形态，通过从计算出的能量中选择最小值来找到最小能量 $E_{\\min}$ 和相应的最优波数 $k_{\\star}$。\n\n最后，评估螺旋二十四面体相的亚稳性。计算能量差 $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{s}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{slab}}$ 和 $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{r}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{rod}}$。建立基准能量 $E_{\\min}^{\\mathrm{base}} = \\min(E_{\\min}^{\\mathrm{slab}}, E_{\\min}^{\\mathrm{rod}})$，并计算螺旋二十四面体相对于此基准的能量 $\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}} = E_{\\min}^{\\mathrm{gyro}} - E_{\\min}^{\\mathrm{base}}$。如果同时满足三个条件，则宣布螺旋二十四面体是亚稳的：\n1.  构型对应于关于 $k$ 的局部最小值。这通过用中心有限差分近似二阶导数 $E''(k_{\\star}^{\\mathrm{gyro}})$ 来检查。条件是 $E''(k_{\\star}^{\\mathrm{gyro}})  0$，这要求 $k_{\\star}^{\\mathrm{gyro}}$ 是搜索范围的内点（即，$k_{\\min}  k_{\\star}^{\\mathrm{gyro}}  k_{\\max}$）。\n2.  螺旋二十四面体不是基态：$\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}}  0$。\n3.  螺旋二十四面体的能量与基态足够接近，即在给定窗口内：$\\Delta E_{\\mathrm{g}\\text{-}\\mathrm{base}} \\le \\delta_{\\max}$。\n\n整体算法遍历每个提供的测试案例，为三种形态执行这些计算，确定最小能量和亚稳性，并将结果整理成指定的列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_total_energy(shape, k, f, a_s, a_c, epsilon, N):\n    \"\"\"\n    Computes the total energy density for a given morphology.\n    \"\"\"\n    # 1. Grid Setup\n    dx = 1.0 / N\n    coords_1d = np.linspace(0, 1.0, N, endpoint=False)\n    # 'ij' indexing: xx varies along axis 0, yy axis 1, zz axis 2\n    xx, yy, zz = np.meshgrid(coords_1d, coords_1d, coords_1d, indexing='ij')\n\n    # 2. Scalar Field phi Calculation\n    omega = 2.0 * np.pi * k\n    if shape == 'slab':\n        phi = np.sin(omega * xx)\n    elif shape == 'rod':\n        phi = np.sin(omega * xx) + np.sin(omega * yy)\n    elif shape == 'gyro':\n        phi = (np.sin(omega * xx) * np.cos(omega * yy) +\n               np.sin(omega * yy) * np.cos(omega * zz) +\n               np.sin(omega * zz) * np.cos(omega * xx))\n    else:\n        raise ValueError(\"Unknown shape.\")\n\n    # 3. Isosurface Threshold t\n    t = np.quantile(phi, 1.0 - f)\n\n    # 4. Surface Energy E_surf\n    # Gradient of phi using centered differences with periodic boundaries\n    grad_x = (np.roll(phi, -1, axis=0) - np.roll(phi, 1, axis=0)) / (2.0 * dx)\n    grad_y = (np.roll(phi, -1, axis=1) - np.roll(phi, 1, axis=1)) / (2.0 * dx)\n    grad_z = (np.roll(phi, -1, axis=2) - np.roll(phi, 1, axis=2)) / (2.0 * dx)\n    \n    grad_phi_norm = np.sqrt(grad_x**2 + grad_y**2 + grad_z**2)\n    \n    # Regularized delta function\n    u_arg = (phi - t) / epsilon\n    delta_eps = (1.0 / (np.sqrt(np.pi) * epsilon)) * np.exp(-u_arg**2)\n    \n    # Surface area integral approximation\n    surface_area = np.sum(delta_eps * grad_phi_norm) * (dx**3)\n    E_surf = a_s * surface_area\n\n    # 5. Coulomb Energy E_C\n    # Phase indicator and charge density\n    h = (phi = t).astype(float)\n    rho = h - f\n\n    # FFT-based Poisson solver\n    rho_hat = np.fft.fftn(rho)\n    \n    # Wavevector grid\n    k_freq = np.fft.fftfreq(N, d=dx)\n    kx, ky, kz = np.meshgrid(k_freq, k_freq, k_freq, indexing='ij')\n    # Physical wavevector, k = 2*pi*f\n    k_sq = (2 * np.pi)**2 * (kx**2 + ky**2 + kz**2)\n    \n    # Solve for potential in Fourier space\n    phi_potential_hat = np.zeros_like(rho_hat, dtype=complex)\n    # Avoid division by zero at k=0\n    nonzero_k = k_sq  1e-9 # A small tolerance for floating point k_sq[0,0,0]\n    phi_potential_hat[nonzero_k] = 4 * np.pi * rho_hat[nonzero_k] / k_sq[nonzero_k]\n\n    # Inverse FFT to get potential in real space\n    phi_potential = np.fft.ifftn(phi_potential_hat).real\n    \n    # Coulomb energy integral approximation\n    E_c = 0.5 * a_c * np.sum(rho * phi_potential) * (dx**3)\n\n    return E_surf + E_c\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (f, a_s, a_c, epsilon, delta_max)\n        (0.3, 1.0, 0.1, 0.03, 0.05),\n        (0.5, 0.8, 0.2, 0.03, 0.10),\n        (0.15, 1.2, 0.05, 0.03, 0.05),\n        (0.85, 0.9, 0.25, 0.03, 0.10),\n    ]\n\n    # Shared parameters\n    N = 32\n    k_min = 1\n    k_max = 6\n    k_range = list(range(k_min, k_max + 1))\n    shapes = ['gyro', 'slab', 'rod']\n    \n    all_results = []\n\n    for case in test_cases:\n        f, a_s, a_c, epsilon, delta_max = case\n        \n        min_energies = {}\n        k_stars = {}\n        all_energies = {}\n\n        for shape in shapes:\n            energies_for_shape = [\n                calculate_total_energy(shape, k, f, a_s, a_c, epsilon, N)\n                for k in k_range\n            ]\n            all_energies[shape] = np.array(energies_for_shape)\n            min_idx = np.argmin(all_energies[shape])\n            min_energies[shape] = all_energies[shape][min_idx]\n            k_stars[shape] = k_range[min_idx]\n\n        E_min_gyro = min_energies['gyro']\n        E_min_slab = min_energies['slab']\n        E_min_rod = min_energies['rod']\n\n        # Energy differences\n        dE_gs = E_min_gyro - E_min_slab\n        dE_gr = E_min_gyro - E_min_rod\n\n        # Metastability check\n        is_metastable = False\n        k_star_gyro = k_stars['gyro']\n\n        # Condition (i): Local minimum (curvature check)\n        is_interior = k_min  k_star_gyro  k_max\n        curvature_check = False\n        if is_interior:\n            idx = k_range.index(k_star_gyro)\n            gyro_energies = all_energies['gyro']\n            E_double_prime = gyro_energies[idx + 1] - 2 * gyro_energies[idx] + gyro_energies[idx - 1]\n            if E_double_prime  0:\n                curvature_check = True\n        \n        # Conditions (ii) and (iii): Energy hierarchy\n        E_min_base = min(E_min_slab, E_min_rod)\n        dE_g_base = E_min_gyro - E_min_base\n        \n        energy_diff_check_1 = dE_g_base  0\n        energy_diff_check_2 = dE_g_base = delta_max\n        \n        if curvature_check and energy_diff_check_1 and energy_diff_check_2:\n            is_metastable = True\n\n        case_result = [\n            E_min_gyro, E_min_slab, E_min_rod,\n            dE_gs, dE_gr,\n            is_metastable\n        ]\n        all_results.append(case_result)\n\n    # Final print statement in the exact required format.\n    print(str(all_results))\n\nsolve()\n```"
        }
    ]
}