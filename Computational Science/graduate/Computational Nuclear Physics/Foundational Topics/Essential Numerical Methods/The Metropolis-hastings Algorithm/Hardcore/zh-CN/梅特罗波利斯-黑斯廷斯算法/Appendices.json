{
    "hands_on_practices": [
        {
            "introduction": "在物理建模中，一个常见的挑战是确保贝叶斯参数估计尊重已知的物理定律或约束。本练习  演示了一种强大的技术：使用拉格朗日乘子增广状态空间，在 Metropolis-Hastings 框架内施加此类约束。通过这个练习，你将实践推导此增广系统的接受概率，并特别注意来自先验、似然和提议机制的每个项如何贡献于最终结果。",
            "id": "3604490",
            "problem": "考虑在饱和密度 $\\rho_{0} = 0.16$ $\\mathrm{fm}^{-3}$ 下建模的对称核物质，其中每核子能量由一个类Skyrme平均场代理模型 $E/A(\\theta)$ 表示，其参数矢量为 $\\theta = (t_{0}, t_{3}, \\sigma)$。定义\n$$\n\\frac{E(\\theta)}{A} \\equiv \\alpha + \\beta\\, t_{0} + \\zeta\\, t_{3}\\, \\rho_{0}^{\\sigma},\n$$\n其中已知常数为 $\\alpha = 22$，$\\beta = 0.02$ 和 $\\zeta = -0.001$。为了强制执行体性质 $\\frac{E(\\theta)}{A} = E_{0}$ (其中 $E_{0} = -16$)，引入一个正的拉格朗日乘子 $\\lambda$，并根据以下方式增广 $(\\theta, \\lambda)$ 的后验分布\n$$\n\\pi(\\theta,\\lambda) \\propto p(D \\mid \\theta)\\, \\exp\\!\\big[-\\lambda\\big(\\tfrac{E(\\theta)}{A} - E_{0}\\big)\\big]\\, p(\\theta)\\, p(\\lambda),\n$$\n其中 $p(D \\mid \\theta)$ 是数据似然，$p(\\theta)$ 是 $\\theta$ 的先验，$p(\\lambda)$ 是 $\\lambda$ 的先验。观测代理数据由高斯似然建模\n$$\np(D \\mid \\theta) \\propto \\exp\\!\\Big(-\\frac{(y(\\theta) - y_{D})^{2}}{2 s^{2}}\\Big),\n$$\n其中 $y(\\theta) \\equiv d_{0} + d_{1}\\, t_{0} + d_{3}\\, t_{3}$，$d_{0} = 0$，$d_{1} = 0.001$，$d_{3} = -0.00005$，$y_{D} = 5$，$s = 2$。假设独立的的高斯先验\n$$\nt_{0} \\sim \\mathcal{N}(\\mu_{0}, \\sigma_{0}^{2}), \\quad t_{3} \\sim \\mathcal{N}(\\mu_{3}, \\sigma_{3}^{2}), \\quad \\sigma \\sim \\mathcal{N}(\\mu_{\\sigma}, \\sigma_{\\sigma}^{2}),\n$$\n其中 $(\\mu_{0}, \\sigma_{0}) = (-1900, 300)$，$(\\mu_{3}, \\sigma_{3}) = (13000, 2000)$，$(\\mu_{\\sigma}, \\sigma_{\\sigma}) = (0.5, 0.05)$，以及 $\\lambda$ 的伽马先验，\n$$\n\\lambda \\sim \\mathrm{Gamma}(a,b), \\quad a = 2, \\quad b = 1,\n$$\n其密度为 $p(\\lambda) \\propto \\lambda^{a-1} \\exp(-b \\lambda)$。考虑在增广空间 $(\\theta,\\lambda)$ 上的一个Metropolis-Hastings (MH) 采样器，其提议分布如下：\n- 对 $\\theta$ 的对称高斯随机游走提议：$\\theta' = \\theta + \\xi$，其中 $\\xi \\sim \\mathcal{N}(0, \\Sigma_{q})$，$\\Sigma_{q}$ 为一个固定的正定协方差矩阵，\n- 在 $\\ln \\lambda$ 上的随机游走：$\\ln \\lambda' = \\ln \\lambda + \\eta$，其中 $\\eta \\sim \\mathcal{N}(0, s_{\\ell}^{2})$，这意味着边际提议密度 $q(\\lambda' \\mid \\lambda)$ 是对数正态的。\n\n任务：\n1. 从贝叶斯定理和Metropolis-Hastings (MH) 接受概率的定义出发，推导对于这个增广目标 $\\pi(\\theta,\\lambda)$ 和指定的提议分布，通用的MH接受概率 $\\alpha\\big((\\theta,\\lambda) \\to (\\theta',\\lambda')\\big)$。您的推导必须明确说明由$\\lambda$中的对数正态提议分布引起的提议不对称性。\n2. 对于从当前状态 $(\\theta,\\lambda)$ 到提议状态 $(\\theta',\\lambda')$ 的单个提议更新，使用以下数值计算接受概率：\n   - 当前状态：$t_{0} = -1800$，$t_{3} = 14000$，$\\sigma = 0.5$，$\\lambda = 0.8$。\n   - 提议状态：$t_{0}' = -1750$，$t_{3}' = 15000$，$\\sigma' = 0.45$，$\\lambda' = 1.1$。\n使用上面给出的量和模型，不进行任何额外的近似。将您的最终数值答案表示为纯小数，并四舍五入到四位有效数字。",
            "solution": "该问题要求完成两个任务：首先，对于给定的增广后验和提议机制，推导通用的Metropolis-Hastings (MH)接受概率；其次，为一个特定的状态转移计算此概率。\n\n## 第一部分：接受概率的推导\n\n马尔可夫链的状态由向量 $X = (\\theta, \\lambda)$ 给出，其中 $\\theta = (t_0, t_3, \\sigma)$。目标分布是后验分布 $\\pi(\\theta, \\lambda)$。从当前状态 $X$ 到提议状态 $X'$ 的MH接受概率 $\\alpha(X \\to X')$ 定义为：\n$$\n\\alpha(X \\to X') = \\min\\left(1, R\\right)\n$$\n其中 $R$ 是Hastings比率，由下式给出：\n$$\nR = \\frac{\\pi(X') q(X|X')}{\\pi(X) q(X'|X)}\n$$\n此处，$\\pi(X) = \\pi(\\theta, \\lambda)$ 是目标后验密度，$q(X'|X)$ 是提议密度。\n\n提议分布可分解为对 $\\theta$ 和 $\\lambda$ 的独立提议：$q(X'|X) = q(\\theta'|\\theta)q(\\lambda'|\\lambda)$。\n\n1.  **$\\theta$ 的提议比率**：对 $\\theta$ 的提议是一个对称高斯随机游走，$\\theta' = \\theta + \\xi$，其中 $\\xi \\sim \\mathcal{N}(0, \\Sigma_q)$。提议密度为 $q(\\theta'|\\theta) = \\mathcal{N}(\\theta'; \\theta, \\Sigma_q)$。高斯密度的一个关键性质是其参数的对称性，即 $\\mathcal{N}(\\theta'; \\theta, \\Sigma_q) = \\mathcal{N}(\\theta; \\theta', \\Sigma_q)$。因此，$q(\\theta'|\\theta) = q(\\theta|\\theta')$，且 $\\theta$ 的提议比率为1：\n    $$\n    \\frac{q(\\theta|\\theta')}{q(\\theta'|\\theta)} = 1\n    $$\n\n2.  **$\\lambda$ 的提议比率**：对 $\\lambda$ 的提议是在 $\\lambda$ 的对数上的随机游走，即 $\\ln \\lambda' = \\ln \\lambda + \\eta$，其中 $\\eta \\sim \\mathcal{N}(0, s_\\ell^2)$。设 $g(\\eta)$ 是 $\\eta$ 的密度，它是对称的：$g(\\eta) = g(-\\eta)$。为了求提议密度 $q(\\lambda'|\\lambda)$，我们使用变量变换公式。设 $u = \\ln \\lambda$，所以提议为 $u' = u + \\eta$。以 $u$ 表示的提议密度是 $q_u(u'|u) = g(u'-u)$。则 $\\lambda$ 的提议密度为：\n    $$\n    q(\\lambda'|\\lambda) = q_u(\\ln\\lambda'|\\ln\\lambda) \\left|\\frac{d(\\ln \\lambda')}{d\\lambda'}\\right| = g(\\ln\\lambda' - \\ln\\lambda) \\frac{1}{\\lambda'}\n    $$\n    类似地，逆向提议密度为：\n    $$\n    q(\\lambda|\\lambda') = g(\\ln\\lambda - \\ln\\lambda') \\frac{1}{\\lambda}\n    $$\n    因此，$\\lambda$ 的提议比率为：\n    $$\n    \\frac{q(\\lambda|\\lambda')}{q(\\lambda'|\\lambda)} = \\frac{g(\\ln\\lambda - \\ln\\lambda') / \\lambda}{g(\\ln\\lambda' - \\ln\\lambda) / \\lambda'} = \\frac{g(-(\\ln\\lambda' - \\ln\\lambda)) / \\lambda}{g(\\ln\\lambda' - \\ln\\lambda) / \\lambda'}\n    $$\n    利用 $g$ 的对称性，这简化为著名的雅可比校正因子：\n    $$\n    \\frac{q(\\lambda|\\lambda')}{q(\\lambda'|\\lambda)} = \\frac{1/\\lambda}{1/\\lambda'} = \\frac{\\lambda'}{\\lambda}\n    $$\n\n综合这些结果，完整的提议比率为 $\\frac{q(X|X')}{q(X'|X)} = \\frac{\\lambda'}{\\lambda}$。\n\nHastings比率 $R$ 变为：\n$$\nR = \\frac{\\pi(\\theta', \\lambda')}{\\pi(\\theta, \\lambda)} \\frac{\\lambda'}{\\lambda}\n$$\n\n现在我们来表示后验密度的比率。后验分布由下式给出：\n$$\n\\pi(\\theta,\\lambda) \\propto p(D \\mid \\theta)\\, \\exp\\!\\big[-\\lambda\\big(\\tfrac{E(\\theta)}{A} - E_{0}\\big)\\big]\\, p(\\theta)\\, p(\\lambda)\n$$\n该比率为：\n$$\n\\frac{\\pi(\\theta', \\lambda')}{\\pi(\\theta, \\lambda)} = \\frac{p(D \\mid \\theta')}{p(D \\mid \\theta)} \\frac{\\exp[-\\lambda'(\\frac{E(\\theta')}{A}-E_0)]}{\\exp[-\\lambda(\\frac{E(\\theta)}{A}-E_0)]} \\frac{p(\\theta')}{p(\\theta)} \\frac{p(\\lambda')}{p(\\lambda)}\n$$\n让我们分析比率中的每一项：\n-   **似然比**：$p(D \\mid \\theta) \\propto \\exp(-\\frac{(y(\\theta) - y_{D})^{2}}{2 s^{2}})$\n    $$\n    \\frac{p(D \\mid \\theta')}{p(D \\mid \\theta)} = \\exp\\left( \\frac{(y(\\theta) - y_{D})^{2} - (y(\\theta') - y_{D})^{2}}{2 s^{2}} \\right)\n    $$\n-   **约束项比率**：\n    $$\n    \\frac{\\exp[-\\lambda'(\\frac{E(\\theta')}{A}-E_0)]}{\\exp[-\\lambda(\\frac{E(\\theta)}{A}-E_0)]} = \\exp\\left( \\lambda\\left(\\tfrac{E(\\theta)}{A} - E_{0}\\right) - \\lambda'\\left(\\tfrac{E(\\theta')}{A} - E_{0}\\right) \\right)\n    $$\n-   **参数先验比率**：$p(\\theta) = p(t_0)p(t_3)p(\\sigma)$，因为独立性。\n    $$\n    \\frac{p(\\theta')}{p(\\theta)} = \\frac{p(t_0')}{p(t_0)} \\frac{p(t_3')}{p(t_3)} \\frac{p(\\sigma')}{p(\\sigma)}\n    $$\n    对于一个通用的高斯先验 $x \\sim \\mathcal{N}(\\mu_x, \\sigma_x^2)$，比率为 $\\frac{p(x')}{p(x)} = \\exp\\left( \\frac{(x - \\mu_x)^2 - (x' - \\mu_x)^2}{2\\sigma_x^2} \\right)$。\n-   **拉格朗日乘子先验比率**：$\\lambda \\sim \\mathrm{Gamma}(a,b)$，所以 $p(\\lambda) \\propto \\lambda^{a-1} \\exp(-b\\lambda)$。\n    $$\n    \\frac{p(\\lambda')}{p(\\lambda)} = \\frac{(\\lambda')^{a-1}\\exp(-b\\lambda')}{\\lambda^{a-1}\\exp(-b\\lambda)} = \\left(\\frac{\\lambda'}{\\lambda}\\right)^{a-1} \\exp(-b(\\lambda' - \\lambda))\n    $$\n将 $\\lambda$ 的先验比率与提议比率 $\\lambda'/\\lambda$ 结合：\n$$\n\\frac{p(\\lambda')}{p(\\lambda)} \\frac{\\lambda'}{\\lambda} = \\left(\\frac{\\lambda'}{\\lambda}\\right)^{a-1} \\exp(-b(\\lambda' - \\lambda)) \\frac{\\lambda'}{\\lambda} = \\left(\\frac{\\lambda'}{\\lambda}\\right)^{a} \\exp(-b(\\lambda' - \\lambda))\n$$\n最后，组合所有部分，Hastings比率 $R$ 为：\n$$\nR = \\left(\\frac{\\lambda'}{\\lambda}\\right)^{a} \\exp\\left(-b(\\lambda' - \\lambda)\\right) \\times \\exp\\left( \\frac{(y(\\theta) - y_{D})^{2} - (y(\\theta') - y_{D})^{2}}{2 s^{2}} \\right) \\times \\exp\\left( \\lambda\\left(\\tfrac{E(\\theta)}{A} - E_{0}\\right) - \\lambda'\\left(\\tfrac{E(\\theta')}{A} - E_{0}\\right) \\right) \\times \\prod_{i \\in \\{0,3,\\sigma\\}} \\exp\\left( \\frac{(x_i - \\mu_i)^2 - (x_i' - \\mu_i)^2}{2\\sigma_i^2} \\right)\n$$\n其中乘积是对参数 $t_0, t_3, \\sigma$ 进行的。接受概率为 $\\alpha = \\min(1,R)$。\n\n## 第二部分：数值计算\n\n我们已知当前状态 $(\\theta, \\lambda)$ 和提议状态 $(\\theta', \\lambda')$，以及所有必要的常数和模型参数。我们着手计算Hastings比率 $R$ 的每一项。\n\n**给定值：**\n-   当前状态：$t_0 = -1800$，$t_3 = 14000$，$\\sigma = 0.5$，$\\lambda = 0.8$。\n-   提议状态：$t'_0 = -1750$，$t'_3 = 15000$，$\\sigma' = 0.45$，$\\lambda' = 1.1$。\n-   常数：$\\rho_0=0.16$，$\\alpha=22$，$\\beta=0.02$，$\\zeta=-0.001$，$E_0=-16$。\n-   似然：$d_0=0$，$d_1=0.001$，$d_3=-0.00005$，$y_D=5$，$s=2$。\n-   先验：$(\\mu_0, \\sigma_0) = (-1900, 300)$，$(\\mu_3, \\sigma_3) = (13000, 2000)$，$(\\mu_\\sigma, \\sigma_\\sigma) = (0.5, 0.05)$。\n-   伽马先验：$a=2, b=1$。\n\n**1. 似然比：**\n$y(\\theta) = d_1 t_0 + d_3 t_3 = 0.001(-1800) - 0.00005(14000) = -1.8 - 0.7 = -2.5$。\n$y(\\theta') = d_1 t'_0 + d_3 t'_3 = 0.001(-1750) - 0.00005(15000) = -1.75 - 0.75 = -2.5$。\n因为 $y(\\theta) = y(\\theta')$，所以似然比为 $\\exp(0) = 1$。\n\n**2. 约束项比率：**\n$E/A(\\theta) = \\alpha + \\beta t_0 + \\zeta t_3 \\rho_0^\\sigma = 22 + 0.02(-1800) - 0.001(14000)(0.16)^{0.5} = 22 - 36 - 14(0.4) = -19.6$。\n$E/A(\\theta') = \\alpha + \\beta t'_0 + \\zeta t'_3 \\rho_0^{\\sigma'} = 22 + 0.02(-1750) - 0.001(15000)(0.16)^{0.45}$。\n我们计算 $(0.16)^{0.45} \\approx 0.4383845$。\n$E/A(\\theta') \\approx 22 - 35 - 15(0.4383845) = -13 - 6.5757675 = -19.5757675$。\n比率的指数为 $\\lambda(\\tfrac{E(\\theta)}{A} - E_0) - \\lambda'(\\tfrac{E(\\theta')}{A} - E_0)$。\n$0.8(-19.6 - (-16)) - 1.1(-19.5757675 - (-16)) = 0.8(-3.6) - 1.1(-3.5757675) = -2.88 + 3.93334425 = 1.05334425$。\n该比率为 $\\exp(1.05334425) \\approx 2.86725$。\n\n**3. 参数先验比率：**\n-   **$t_0$ 先验：** $\\exp\\left( \\frac{(-1800 - (-1900))^2 - (-1750 - (-1900))^2}{2(300)^2} \\right) = \\exp\\left( \\frac{100^2 - 150^2}{180000} \\right) = \\exp\\left( \\frac{-12500}{180000} \\right) = \\exp(-5/72) \\approx 0.93291$。\n-   **$t_3$ 先验：** $\\exp\\left( \\frac{(14000 - 13000)^2 - (15000 - 13000)^2}{2(2000)^2} \\right) = \\exp\\left( \\frac{1000^2 - 2000^2}{8000000} \\right) = \\exp\\left( \\frac{-3000000}{8000000} \\right) = \\exp(-3/8) \\approx 0.68729$。\n-   **$\\sigma$ 先验：** $\\exp\\left( \\frac{(0.5 - 0.5)^2 - (0.45 - 0.5)^2}{2(0.05)^2} \\right) = \\exp\\left( \\frac{0 - (-0.05)^2}{0.005} \\right) = \\exp\\left( \\frac{-0.0025}{0.005} \\right) = \\exp(-0.5) \\approx 0.60653$。\n\n**4. $\\lambda$ 先验与提议比率 (组合)：**\n当 $a=2, b=1, \\lambda=0.8, \\lambda'=1.1$ 时：\n比率为 $\\left(\\frac{1.1}{0.8}\\right)^{2} \\exp(-1(1.1 - 0.8)) = (1.375)^2 \\exp(-0.3) = 1.890625 \\times 0.740818 \\approx 1.40061$。\n\n**5. 总Hastings比率 R：**\n$R$ 是所有这些项的乘积：\n$R \\approx 1 \\times 2.86725 \\times 0.93291 \\times 0.68729 \\times 0.60653 \\times 1.40061$。\n$R \\approx (2.86725) \\times (0.93291) \\times (0.68729) \\times (0.60653) \\times (1.40061) \\approx 1.56150$。\n\n**6. 接受概率 $\\alpha$：**\n接受概率为 $\\alpha = \\min(1, R)$。\n由于 $R \\approx 1.5615 > 1$，接受概率为 $\\alpha = 1$。\n四舍五入到四位有效数字，结果是 $1.000$。",
            "answer": "$$\\boxed{1.000}$$"
        },
        {
            "introduction": "虽然随机游走提议简单易行，但在高维空间中可能效率低下。本练习介绍了一种更高效的算法——Metropolis-校正的朗之万算法 (MALA)，它利用目标分布的梯度信息来提出更智能的移动。本练习  进一步挑战你将此算法应用于带有边界约束的问题，例如确保物理密度保持非负性，这是核物理计算中的常见要求。",
            "id": "3604515",
            "problem": "考虑通过一种基于Metropolis调整的朗之万算法（MALA）的约束马爾可夫鏈蒙特卡洛（MCMC）方法，在一个包含 $\\,d\\,$ 个半径的网格上对离散化的非负径向核子密度 $\\,\\rho(r)\\,$ 进行采样。我们将非归一化的目标建模为一个带正性约束的对数凹场后验：\n$$\n\\log \\pi(\\boldsymbol{\\rho}) \\;\\propto\\; -\\tfrac{1}{2}\\,\\boldsymbol{\\rho}^\\top \\mathbf{K}\\,\\boldsymbol{\\rho} \\;+\\; \\mathbf{b}^\\top \\boldsymbol{\\rho}, \\quad \\text{其中 } \\boldsymbol{\\rho}\\in \\mathbb{R}^d \\text{ 且对所有 } i \\text{ 都有 } \\rho_i \\ge 0,\n$$\n其中 $\\,\\mathbf{K}\\,$ 是一个对称正定精度矩阵，它通过一个离散化的半正定微分算子编码了光滑性，而 $\\,\\mathbf{b}\\,$ 编码了数据驱动的线性项。令 $\\,\\nabla \\log \\pi(\\boldsymbol{\\rho}) = -\\mathbf{K}\\boldsymbol{\\rho} + \\mathbf{b}\\,$。\n\n您需要实现一个保持正性、带反射边界的MALA积分器，该积分器使用投影梯度和折疊高斯提议，并推导用于校正边界碰撞的接受概率。此构造必须遵循以下基本原理：\n- 用于在凸域中对目标密度 $\\,\\pi(\\cdot)\\,$ 进行采样的带反射的过阻尼朗之万扩散，$\\,\\mathrm{d}\\mathbf{X}_t = \\tfrac{1}{2}\\nabla \\log \\pi(\\mathbf{X}_t)\\,\\mathrm{d}t + \\mathrm{d}\\mathbf{W}_t\\,$，在边界上进行瞬时反射。\n- Metropolis-Hastings算法，它使用一个提议核 $\\,q(\\cdot\\mid\\cdot)\\,$ 和接受概率 $\\,\\alpha(\\mathbf{x},\\mathbf{y}) = \\min\\!\\left\\{1, \\dfrac{\\pi(\\mathbf{y})\\,q(\\mathbf{x}\\mid\\mathbf{y})}{\\pi(\\mathbf{x})\\,q(\\mathbf{y}\\mid\\mathbf{x})}\\right\\}$ 来构造一个关于 $\\,\\pi(\\cdot)\\,$ 的可逆马爾可夫鏈。\n\n需要实现的算法规范：\n1. 给定当前状态 $\\,\\mathbf{x}\\in \\mathbb{R}^d_{\\ge 0}\\,$，逐坐标地计算投影梯度 $\\,\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{x})\\,$\n$$\ng_{\\mathrm{proj},i}(\\mathbf{x}) \\;=\\; \n\\begin{cases}\n0,   \\text{if } x_i=0 \\text{ and } \\left[ \\nabla \\log\\pi(\\mathbf{x}) \\right]_i  0, \\\\\n\\left[ \\nabla \\log\\pi(\\mathbf{x}) \\right]_i,   \\text{otherwise}.\n\\end{cases}\n$$\n2. 构建预提议均值\n$$\n\\boldsymbol{\\mu}(\\mathbf{x}) \\;=\\; \\mathbf{x} + \\tfrac{\\varepsilon^2}{2}\\,\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{x}),\n$$\n其中 $\\,\\varepsilon0\\,$ 是步长。\n3. 抽取一个高斯增量 $\\,\\boldsymbol{\\xi}\\sim \\mathcal{N}(\\mathbf{0},\\mathbf{I}_d)\\,$ 并计算一个暂定点 $\\,\\mathbf{z}=\\boldsymbol{\\mu}(\\mathbf{x})+\\varepsilon\\,\\boldsymbol{\\xi}\\,$，然后逐分量反射以强制正性，从而获得提议\n$$\n\\mathbf{y} \\;=\\; |\\mathbf{z}|, \\text{其中对所有 } i \\text{ 都有 } y_i \\;=\\; |z_i|.\n$$\n4. 对于 $\\,\\mathbf{y}\\in \\mathbb{R}^d_{\\ge 0}\\,$，正向提议密度 $\\,q_R(\\mathbf{y}\\mid \\mathbf{x})\\,$ 是由反射映射引起的折叠高斯分布：\n$$\nq_R(\\mathbf{y}\\mid \\mathbf{x}) \\;=\\; \\sum_{\\mathbf{s}\\in\\{-1,+1\\}^d} \n\\varphi_d\\!\\left(\\mathbf{s}\\odot \\mathbf{y};\\, \\boldsymbol{\\mu}(\\mathbf{x}),\\, \\varepsilon^2 \\mathbf{I}_d\\right),\n$$\n其中 $\\,\\mathbf{s}\\odot \\mathbf{y}\\,$ 是逐元素乘积，$\\,\\varphi_d(\\cdot;\\boldsymbol{\\mu},\\varepsilon^2\\mathbf{I}_d)\\,$ 是均值为 $\\,\\boldsymbol{\\mu}\\,$、各向同性协方差为 $\\,\\varepsilon^2\\mathbf{I}_d\\,$ 的 $\\,d\\,$ 维高斯密度。对于各向同性协方差，这可以分解为一维折叠正态分布的乘积：\n$$\nq_R(\\mathbf{y}\\mid \\mathbf{x}) \\;=\\; \\prod_{i=1}^d \\left[ \\varphi_1\\!\\left(y_i;\\,\\mu_i(\\mathbf{x}),\\,\\varepsilon^2\\right) + \\varphi_1\\!\\left(-y_i;\\,\\mu_i(\\mathbf{x}),\\,\\varepsilon^2\\right) \\right].\n$$\n5. 使用Metropolis-Hastings接受概率\n$$\n\\alpha(\\mathbf{x},\\mathbf{y}) \\;=\\; \\min\\!\\left\\{1,\\; \n\\frac{\\pi(\\mathbf{y})\\, q_R(\\mathbf{x}\\mid \\mathbf{y})}{\\pi(\\mathbf{x})\\, q_R(\\mathbf{y}\\mid \\mathbf{x})} \\right\\}。\n$$\n\n任务：\n- 从第一性原理推导，当使用投影梯度漂移和反射提议时，为何上述接受概率能产生一个关于 $\\,\\pi(\\cdot)\\,$ 的可逆马尔可夫链。明确论证 $\\,q_R(\\cdot\\mid\\cdot)\\,$ 中的折叠高斯混合作为对边界碰撞的接受概率校正的作用。\n- 实现一个完整的程序，该程序：\n  - 计算 $\\,\\log \\pi(\\mathbf{x}) = -\\tfrac{1}{2}\\mathbf{x}^\\top \\mathbf{K}\\mathbf{x} + \\mathbf{b}^\\top \\mathbf{x}\\,$（对于 $\\,\\mathbf{x}\\in\\mathbb{R}^d_{\\ge 0}\\,$），否则为 $\\, -\\infty\\,$。\n  - 计算 $\\,\\nabla \\log \\pi(\\mathbf{x}) = -\\mathbf{K}\\mathbf{x} + \\mathbf{b}\\,$ 和投影梯度 $\\,\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{x})\\,$。\n  - 构造 $\\,\\boldsymbol{\\mu}(\\mathbf{x})\\,$，应用反射，通过稳定的对数-和-指数（log-sum-exp）运算评估 $\\,\\log q_R(\\mathbf{y}\\mid \\mathbf{x})\\,$ 和 $\\,\\log q_R(\\mathbf{x}\\mid \\mathbf{y})\\,$，并返回 $\\,\\alpha(\\mathbf{x},\\mathbf{y})$。\n  - 对于一个测试，通过计算两个对数通量之差的绝对值，数值上验证细致平衡。\n$$\n\\left|\\log\\left(\\pi(\\mathbf{x})\\,q_R(\\mathbf{y}\\mid \\mathbf{x})\\,\\alpha(\\mathbf{x},\\mathbf{y})\\right) - \\log\\left(\\pi(\\mathbf{y})\\,q_R(\\mathbf{x}\\mid \\mathbf{y})\\,\\alpha(\\mathbf{y},\\mathbf{x})\\right)\\right|\n$$\n\n测试套件：\n使用以下参数化测试。所有向量均按索引递增的行主序排列。所有常数必须完全按照规定实现。\n\n- 测试 $\\,1\\,$ (内部，无边界碰撞 d=1):\n  - $\\,\\mathbf{K} = [ [ 1.0 ] ]\\,$, $\\,\\mathbf{b} = [ 1.0 ]\\,$,\n  - $\\,\\mathbf{x} = [ 0.8 ]\\,$, $\\,\\varepsilon = 0.3\\,$, 噪声 $\\,\\boldsymbol{\\xi} = [ 0.2 ]\\,$.\n  - 输出接受概率 $\\,\\alpha(\\mathbf{x},\\mathbf{y})\\,$.\n\n- 测试 $\\,2\\,$ (边界碰撞, d=1):\n  - $\\,\\mathbf{K} = [ [ 1.0 ] ]\\,$, $\\,\\mathbf{b} = [ -0.2 ]\\,$,\n  - $\\,\\mathbf{x} = [ 0.0 ]\\,$, $\\,\\varepsilon = 0.2\\,$, 噪声 $\\,\\boldsymbol{\\xi} = [ -1.5 ]\\,$.\n  - 输出接受概率 $\\,\\alpha(\\mathbf{x},\\mathbf{y})\\,$.\n\n- 测试 $\\,3\\,$ (混合坐标, d=3): 构建 $\\,\\mathbf{K} = \\gamma \\mathbf{I}_3 + \\beta \\mathbf{S}\\,$，其中 $\\,\\gamma=0.1\\,$, $\\,\\beta=0.5\\,$，$\\,\\mathbf{S}\\,$ 是主对角线元素为 $\\,2\\,$、紧邻的次对角线元素为 $\\, -1\\,$ 的三对角矩阵。令 $\\,\\mathbf{b}\\,$ 的元素为 $\\,b_i = \\kappa \\exp\\!\\left( - (r_i/R_0)^2 \\right)\\,$，其中 $\\,\\kappa=0.8\\,$, $\\,R_0=2.0\\,$，半径 $\\,r_i = (i+1)\\Delta r\\,$，$\\,\\Delta r = 1.0\\,$ 且 $\\,i=0,1,2\\,$。使用\n  - $\\,\\mathbf{x} = [ 0.0,\\; 0.2,\\; 0.0 ]\\,$, $\\,\\varepsilon = 0.25\\,$, 噪声 $\\,\\boldsymbol{\\xi} = [ -0.3,\\; 0.1,\\; -0.7 ]\\,$.\n  - 输出接受概率 $\\,\\alpha(\\mathbf{x},\\mathbf{y})\\,$.\n\n- 测试 $\\,4\\,$ (对测试 $\\,3$ 的配对进行数值细致平衡残差计算):\n  - 使用测试 $\\,3\\,$ 中的 $\\,\\mathbf{x}\\,$ 和产生的 $\\,\\mathbf{y}\\,$，计算\n    $$\n    \\delta \\;=\\; \\left| \\log\\!\\left(\\pi(\\mathbf{x})\\,q_R(\\mathbf{y}\\mid \\mathbf{x})\\,\\alpha(\\mathbf{x},\\mathbf{y})\\right) \\;-\\; \\log\\!\\left(\\pi(\\mathbf{y})\\,q_R(\\mathbf{x}\\mid \\mathbf{y})\\,\\alpha(\\mathbf{y},\\mathbf{x})\\right) \\right|.\n    $$\n  - 输出 $\\,\\delta\\,$.\n\n最终输出格式：\n- 您的程序必须生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，按测试 $\\,1\\,$ 到 $\\,4\\,$ 的顺序排列。所有值都必须是四舍五入到 $\\,6\\,$ 位小数的浮点数。例如：\"[0.123456,0.234567,0.345678,0.000001]\"。",
            "solution": "该问题要求两部分回应：一个关于带反射边界的Metropolis调整朗之万算法（MALA）接受概率的理论推导，以及一个实现该算法以解决四个特定计算任务的程序。该问题陈述经确认为科学上合理、良定且客观。所有提供的数据和定义都是一致的，足以得出唯一解。\n\n### 理论推导\n\n目标是构造一个关于定义在非负象限 $\\mathbb{R}^d_{\\ge 0}$ 上的目标概率分布 $\\pi(\\boldsymbol{\\rho})$ 的可逆马尔可夫链。可逆性，也称为细致平衡条件，是确保 $\\pi$ 为该链的平稳分布的一个充分条件。对于任意两个状态 $\\mathbf{x}, \\mathbf{y} \\in \\mathbb{R}^d_{\\ge 0}$，细致平衡条件由下式给出：\n$$\n\\pi(\\mathbf{x})\\,P(\\mathbf{y} \\mid \\mathbf{x}) = \\pi(\\mathbf{y})\\,P(\\mathbf{x} \\mid \\mathbf{y})\n$$\n其中 $P(\\mathbf{y} \\mid \\mathbf{x})$ 是马尔可夫链的转移核，表示从状态 $\\mathbf{x}$ 移动到状态 $\\mathbf{y}$ 的概率密度。\n\nMetropolis-Hastings（MH）算法为构造此类核提供了一个通用框架。转移是一个两阶段过程：从一个提议分布 $q(\\mathbf{y} \\mid \\mathbf{x})$ 生成一个提议，然后以概率 $\\alpha(\\mathbf{x}, \\mathbf{y})$ 接受该提议。从 $\\mathbf{x}$ 到 $\\mathbf{y}$（其中 $\\mathbf{y} \\neq \\mathbf{x}$）的完整转移核为 $P(\\mathbf{y} \\mid \\mathbf{x}) = q(\\mathbf{y} \\mid \\mathbf{x})\\,\\alpha(\\mathbf{x}, \\mathbf{y})$。著名的接受概率选择是：\n$$\n\\alpha(\\mathbf{x}, \\mathbf{y}) = \\min\\left\\{1, \\frac{\\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})}{\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})}\\right\\}\n$$\n对于接受的移动，这种形式确定性地满足细致平衡方程。为了验证这一点，我们可以检查乘积 $\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})\\,\\alpha(\\mathbf{x}, \\mathbf{y})$ 并证明其在交换 $\\mathbf{x}$ 和 $\\mathbf{y}$ 时的对称性：\n\\begin{align*}\n\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})\\,\\alpha(\\mathbf{x}, \\mathbf{y}) = \\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})\\,\\min\\left\\{1, \\frac{\\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})}{\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})}\\right\\} \\\\\n= \\min\\left\\{\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x}), \\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})\\right\\} \\\\\n= \\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})\\,\\min\\left\\{\\frac{\\pi(\\mathbf{x})\\,q(\\mathbf{y} \\mid \\mathbf{x})}{\\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})}, 1\\right\\} \\\\\n= \\pi(\\mathbf{y})\\,q(\\mathbf{x} \\mid \\mathbf{y})\\,\\alpha(\\mathbf{y}, \\mathbf{x})\n\\end{align*}\n只要提议分布 $q(\\cdot \\mid \\cdot)$ 在整个状态空间上都有支撑，该等式就对任何选择都成立。因此，挑战的核心不是证明MH公式本身，而是正确推导出与指定算法过程相对应的提议密度 $q_R(\\mathbf{y} \\mid \\mathbf{x})$。\n\n该算法通过以下步骤从当前状态 $\\mathbf{x}$ 提议一个新状态 $\\mathbf{y}$：\n1. 计算一个漂移项（预提议均值）：$\\boldsymbol{\\mu}(\\mathbf{x}) = \\mathbf{x} + \\tfrac{\\varepsilon^2}{2}\\,\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{x})$。\n2. 从高斯分布中抽取一个暂定点 $\\mathbf{z}$：$\\mathbf{z} \\sim \\mathcal{N}(\\boldsymbol{\\mu}(\\mathbf{x}), \\varepsilon^2 \\mathbf{I}_d)$。\n3. 通过将 $\\mathbf{z}$ 反射到非负象限中获得最终提议 $\\mathbf{y}$：$\\mathbf{y} = |\\mathbf{z}|$。\n\n暂定点 $\\mathbf{z}$ 的密度，我们记为 $p_{\\mathbf{x}}(\\mathbf{z})$，是多元高斯概率密度函数（PDF）：\n$$\np_{\\mathbf{x}}(\\mathbf{z}) = \\varphi_d(\\mathbf{z}; \\boldsymbol{\\mu}(\\mathbf{x}), \\varepsilon^2 \\mathbf{I}_d) = \\frac{1}{(2\\pi\\varepsilon^2)^{d/2}} \\exp\\left(-\\frac{\\|\\mathbf{z} - \\boldsymbol{\\mu}(\\mathbf{x})\\|^2}{2\\varepsilon^2}\\right)\n$$\n提议 $\\mathbf{y}$ 是随机变量 $\\mathbf{z}$ 的一个确定性函数，通过逐分量的绝对值映射 $\\mathbf{y} = |\\mathbf{z}|$ 实现。这个映射不是一对一的（非单射）。对于任何给定的 $\\mathbf{y} \\in \\mathbb{R}^d_{\\ge 0}$（所有 $i$ 都有 $y_i > 0$），其原像中有 $2^d$ 个不同的点，即有 $2^d$ 个不同的 $\\mathbf{z}$ 值映射到 $\\mathbf{y}$。这些原像的形式为 $\\mathbf{s} \\odot \\mathbf{y}$，其中 $\\mathbf{s} \\in \\{-1, +1\\}^d$ 是一个符号向量，$\\odot$ 表示逐元素乘积。对于 $y_i=0$ 的分量，其原像 $z_i=0$ 是唯一的。\n\n提议 $\\mathbf{y}$ 的概率密度 $q_R(\\mathbf{y} \\mid \\mathbf{x})$ 是其所有原像在高斯定律下密度的总和。这是非单射变换的变量替换公式的一个标准结果。\n$$\nq_R(\\mathbf{y} \\mid \\mathbf{x}) = \\sum_{\\mathbf{z} \\text{ s.t. } |\\mathbf{z}| = \\mathbf{y}} p_{\\mathbf{x}}(\\mathbf{z}) = \\sum_{\\mathbf{s} \\in \\{-1, +1\\}^d} p_{\\mathbf{x}}(\\mathbf{s} \\odot \\mathbf{y})\n$$\n代入高斯PDF，我们得到：\n$$\nq_R(\\mathbf{y} \\mid \\mathbf{x}) = \\sum_{\\mathbf{s} \\in \\{-1, +1\\}^d} \\varphi_d(\\mathbf{s} \\odot \\mathbf{y}; \\boldsymbol{\\mu}(\\mathbf{x}), \\varepsilon^2 \\mathbf{I}_d)\n$$\n这正是问题中指定的折叠高斯提议密度。因为协方差矩阵 $\\varepsilon^2 \\mathbf{I}_d$ 是对角矩阵，所以 $d$ 维高斯密度可以分解为 $d$ 个一维密度的乘积。求和也分布在乘积上，得到：\n\\begin{align*}\nq_R(\\mathbf{y} \\mid \\mathbf{x}) = \\prod_{i=1}^d \\sum_{s_i \\in \\{-1, +1\\}} \\varphi_1(s_i y_i; \\mu_i(\\mathbf{x}), \\varepsilon^2) \\\\\n= \\prod_{i=1}^d \\left[ \\varphi_1(y_i; \\mu_i(\\mathbf{x}), \\varepsilon^2) + \\varphi_1(-y_i; \\mu_i(\\mathbf{x}), \\varepsilon^2) \\right]\n\\end{align*}\n这证实了提议密度 $q_R(\\cdot\\mid\\cdot)$ 是“抽取并反射”过程的正确统计表示。反射（边界碰撞）是迫使提议密度成为高斯混合分布的原因。若未能考虑多个原像（即仅使用 $\\varphi_d(\\mathbf{y}; \\boldsymbol{\\mu}(\\mathbf{x}), \\varepsilon^2 \\mathbf{I}_d)$），将导致不正确的提议密度，破坏细致平衡，并产生一个具有错误平稳分布的采样器。\n\n投影梯度 $\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{x})$ 在漂移项 $\\boldsymbol{\\mu}(\\mathbf{x})$ 中的作用是为底层的反射朗之万随机微分方程提供一个更好的类Euler-Maruyama离散化。通过防止漂移项在边界处指向允许域的“外部”，它倾向于产生具有更高接受概率的提议，从而提高算法的效率。然而，Metropolis-Hastings方案的形式正确性仅依赖于一个事实，即对于任何提议机制，其对应的提议密度 $q_R$ 在接受率中被正确指定。在这里，该过程是计算一个漂移 $\\boldsymbol{\\mu}(\\mathbf{x})$，抽取一个高斯变量，然后反射。反向提议密度 $q_R(\\mathbf{x} \\mid \\mathbf{y})$ 的计算逻辑完全相同，但从状态 $\\mathbf{y}$ 开始：首先计算 $\\boldsymbol{\\mu}(\\mathbf{y}) = \\mathbf{y} + \\tfrac{\\varepsilon^2}{2}\\,\\mathbf{g}_{\\mathrm{proj}}(\\mathbf{y})$，然后用均值 $\\boldsymbol{\\mu}(\\mathbf{y})$ 在 $\\mathbf{x}$ 处评估折叠高斯密度。\n\n总之，指定的接受概率 $\\alpha(\\mathbf{x},\\mathbf{y}) = \\min\\{1, \\frac{\\pi(\\mathbf{y})\\, q_R(\\mathbf{x}\\mid \\mathbf{y})}{\\pi(\\mathbf{x})\\, q_R(\\mathbf{y}\\mid \\mathbf{x})}\\}$ 与折叠高斯 $q_R$ 一起正确地解释了包括边界反射在内的提议生成机制。这种对Metropolis-Hastings原则的遵守保证了所得的马尔可夫链满足细致平衡，从而能正确地从目标分布 $\\pi(\\boldsymbol{\\rho})$ 中采样。\n\n### 实现与数值验证\n\n该算法被实现为一组Python函数，以执行四个测试案例所需的计算。\n\n```python\nimport numpy as np\nimport math\n\ndef log_pi(rho, K, b):\n    \"\"\"Computes the log of the unnormalized target density.\"\"\"\n    if np.any(rho  0):\n        return -np.inf\n    log_p = -0.5 * rho.T @ K @ rho + b.T @ rho\n    return log_p\n\ndef grad_log_pi(rho, K, b):\n    \"\"\"Computes the gradient of the log-target density.\"\"\"\n    return -K @ rho + b\n\ndef projected_gradient(rho, K, b):\n    \"\"\"Computes the projected gradient.\"\"\"\n    grad = grad_log_pi(rho, K, b)\n    g_proj = grad.copy()\n    g_proj[(rho == 0.0)  (grad  0)] = 0.0\n    return g_proj\n\ndef log_q_R(prop, mean, epsilon):\n    \"\"\"\n    Computes the log of the reflecting (folded-Gaussian) proposal density.\n    log q_R(prop | current_state) where mean is mu(current_state).\n    \"\"\"\n    d = len(prop)\n    log_norm_const = -np.log(np.sqrt(2 * np.pi) * epsilon)\n    e2_2 = 2 * epsilon**2\n    \n    total_log_q = 0.0\n    for i in range(d):\n        yi = prop[i]\n        mui = mean[i]\n        \n        # Log of the two Gaussian densities in the mixture\n        log_p1 = log_norm_const - ((yi - mui)**2) / e2_2\n        log_p2 = log_norm_const - ((-yi - mui)**2) / e2_2\n        \n        # Stable log-sum-exp for two terms\n        max_log = np.maximum(log_p1, log_p2)\n        term_log = max_log + np.log(np.exp(log_p1 - max_log) + np.exp(log_p2 - max_log))\n        total_log_q += term_log\n        \n    return total_log_q\n\ndef acceptance_prob(x, y, K, b, epsilon):\n    \"\"\"Computes the Metropolis-Hastings acceptance probability alpha(x, y).\"\"\"\n    log_pi_x = log_pi(x, K, b)\n    log_pi_y = log_pi(y, K, b)\n\n    if log_pi_y == -np.inf:\n        return 0.0\n\n    # Forward proposal: x -> y\n    g_proj_x = projected_gradient(x, K, b)\n    mu_x = x + (epsilon**2 / 2) * g_proj_x\n    log_q_y_given_x = log_q_R(y, mu_x, epsilon)\n\n    # Reverse proposal: y -> x\n    g_proj_y = projected_gradient(y, K, b)\n    mu_y = y + (epsilon**2 / 2) * g_proj_y\n    log_q_x_given_y = log_q_R(x, mu_y, epsilon)\n    \n    # Log of the acceptance ratio\n    log_ratio = (log_pi_y + log_q_x_given_y) - (log_pi_x + log_q_y_given_x)\n    \n    if log_ratio >= 0:\n        return 1.0\n    else:\n        return np.exp(log_ratio)\n\ndef detailed_balance_residual(x, y, K, b, epsilon):\n    \"\"\"Computes the numerical residual of the detailed balance equation.\"\"\"\n    log_pi_x = log_pi(x, K, b)\n    log_pi_y = log_pi(y, K, b)\n    \n    g_proj_x = projected_gradient(x, K, b)\n    mu_x = x + (epsilon**2 / 2) * g_proj_x\n    log_q_y_given_x = log_q_R(y, mu_x, epsilon)\n\n    g_proj_y = projected_gradient(y, K, b)\n    mu_y = y + (epsilon**2 / 2) * g_proj_y\n    log_q_x_given_y = log_q_R(x, mu_y, epsilon)\n    \n    log_ratio_xy = (log_pi_y + log_q_x_given_y) - (log_pi_x + log_q_y_given_x)\n    alpha_xy = 1.0 if log_ratio_xy >= 0 else np.exp(log_ratio_xy)\n\n    log_ratio_yx = -log_ratio_xy\n    alpha_yx = 1.0 if log_ratio_yx >= 0 else np.exp(log_ratio_yx)\n\n    finfo = np.finfo(float)\n    if alpha_xy == 0.0 or alpha_yx == 0.0:\n         if log_q_y_given_x > -np.inf and log_q_x_given_y > -np.inf:\n             return 0.0\n    \n    log_p_forward = log_pi_x + log_q_y_given_x + np.log(alpha_xy)\n    log_p_reverse = log_pi_y + log_q_x_given_y + np.log(alpha_yx)\n    \n    delta = np.abs(log_p_forward - log_p_reverse)\n    return delta\n```\n该Python代码实现了所要求的算法。主脚本（未显示）为每个测试案例定义参数，从给定的 $\\mathbf{x}$ 和噪声 $\\boldsymbol{\\xi}$ 计算提议 $\\mathbf{y}$，然后计算所需的量：测试1-3的 $\\alpha(\\mathbf{x}, \\mathbf{y})$，以及测试4的细致平衡残差 $\\delta$。测试4得到的微小非零结果在浮点精度范围内证实了理论推导的正确性。",
            "answer": "[0.970222,0.474668,0.781878,0.000000]"
        },
        {
            "introduction": "除了在单个模型内进行参数估计，科学研究中的一项关键任务是比较相互竞争的模型。本练习  介绍了可逆跳转 Metropolis-Hastings (RJ-MH) 算法，它允许 MCMC 采样器在不同维度的模型之间“跳转”。通过完成一个新参数的“诞生”过程，你将掌握跨维度设置中的细致平衡条件，学会如何通过提议比率和雅可比行列式正确处理维度变化。",
            "id": "3604527",
            "problem": "在从头计算核理论中，人们常将一个两核 (2N) 相互作用模型 $M_{1}$ 与一个增强模型 $M_{2}$ 进行比较，后者在 2N 力的基础上还包含一个主导的三核 (3N) 力。考虑一个可逆跳转 Metropolis-Hastings (RJ-MH) 方案，用于从模型指数 $M \\in \\{M_{1},M_{2}\\}$ 和以数据 $\\mathcal{D}$ 为条件的模型参数的联合后验分布中进行抽样。目标分布是由贝叶斯定理所蕴含的联合后验，即 $p(\\theta_{k},M_{k}\\mid \\mathcal{D}) \\propto p(\\mathcal{D}\\mid \\theta_{k},M_{k})\\,p(\\theta_{k}\\mid M_{k})\\,p(M_{k})$，其中 $k\\in\\{1,2\\}$。\n\n假设以下与低能核物理校准相关的、具有科学动机的设定：\n- 2N 模型 $M_{1}$ 的参数矢量为 $\\theta_{1}=(C_{S},C_{T})\\in \\mathbb{R}^{2}$。2N+3N 模型 $M_{2}$ 的参数矢量为 $\\theta_{2}=(C_{S},C_{T},c_{E})\\in \\mathbb{R}^{3}$，其中 $c_{E}\\in \\mathbb{R}$ 是一个 3N 低能常数。\n- 2N 参数在两个模型下共享相同的先验：$p(\\theta_{1}\\mid M_{1})=p(\\theta_{1}\\mid M_{2})$（因此当它们保持不变时，在比率中会相互抵消）。\n- 3N 耦合的先验是高斯分布：$p(c_{E}\\mid M_{2})=\\mathcal{N}(0,\\tau^{2})$，其中 $\\tau=1$。\n- 模型先验为 $p(M_{1})=0.6$ 和 $p(M_{2})=0.4$。\n- 观测到一个标量差异统计量 $y$，它总结了氚核结合能的残差（实验值减去理论值），其值为 $y=0$。数据模型为高斯分布，已知误差标准差 $\\sigma=0.3$：\n  - 在 $M_{1}$ 下，$y\\mid \\theta_{1},M_{1}\\sim \\mathcal{N}(\\mu_{1},\\sigma^{2})$，其中 $\\mu_{1}=b$ 且 $b=0.5$。\n  - 在 $M_{2}$ 下，$y\\mid \\theta_{2},M_{2}\\sim \\mathcal{N}(\\mu_{2},\\sigma^{2})$，其中 $\\mu_{2}=b+a\\,c_{E}$，$a=-2.0$ 表示在当前校准点附近，残差对 $c_{E}$ 的线性化灵敏度。\n\n考虑一个从 $(M_{1},\\theta_{1})$ 到 $(M_{2},\\theta_{2})$ 的“诞生”移动，它由确定性维度匹配映射 $\\mathcal{T}:(\\theta_{1},u)\\mapsto \\theta_{2}=(\\theta_{1},c_{E})$ 定义，其中 $c_{E}=u$。辅助变量的提议分布为 $u\\sim q_{12}(u\\mid \\theta_{1})=\\mathcal{N}(m,s^{2})$，其中 $m=-0.1$ 和 $s=0.5$。从 $(M_{2},\\theta_{2})$ 到 $(M_{1},\\theta_{1})$ 的逆向“消亡”移动确定性地丢弃 $c_{E}$，并且没有逆向辅助抽样，因此 $q_{21}(\\cdot\\mid \\theta_{2})$ 在逆向随机变量的空集上是常数 $1$。变换的雅可比行列式为 $J=\\left|\\partial \\theta_{2}/\\partial(\\theta_{1},u)\\right|=1$。假设移动类型选择概率为 $r_{12}=r_{21}=0.5$。\n\n您当前处于模型 $M_{1}$，具有某个固定的 $\\theta_{1}$，并且一次特定的前向提议抽样实现为 $u^{\\star}=-0.3$，因此 $c_{E}^{\\star}=-0.3$ 且 $\\theta_{2}^{\\star}=(\\theta_{1},c_{E}^{\\star})$。使用马尔可夫链的细致平衡定义和贝叶斯定理作为基本原则，推导这个特定诞生移动的 RJ-MH 接受概率 $\\alpha_{\\text{birth}}$，并对其进行数值计算。将您的最终答案表示为四舍五入到四位有效数字的小数。不要包含单位。",
            "solution": "该问题要求计算在可逆跳转 Metropolis-Hastings (RJ-MH) 框架中一次“诞生”移动的接受概率。此移动试图从模型 $M_1$ 中的一个状态转移到更高维度模型 $M_2$ 中的一个状态。\n\n模型 $M_k$ 中的状态由模型指数 $k$ 和参数矢量 $\\theta_k$ 指定。目标分布是联合后验 $p(\\theta_k, M_k \\mid \\mathcal{D})$，其中数据 $\\mathcal{D}$ 包含单个观测值 $y=0$。当前状态为 $x = (M_1, \\theta_1)$。提议状态为 $x' = (M_2, \\theta_2^\\star)$。\n\nRJ-MH 接受概率 $\\alpha(x \\to x')$ 的通用公式为：\n$$ \\alpha(x \\to x') = \\min(1, R) $$\n其中 $R$ 是接受率。对于从状态 $(M_1, \\theta_1)$ 到 $(M_2, \\theta_2^\\star)$ 的特定诞生移动，比率 $R$（此处定义为 $\\alpha_{\\text{birth}}$，但它实际上是 $\\min$ 里的比率）由下式给出：\n$$ R = \\underbrace{\\frac{p(M_2, \\theta_2^\\star \\mid y)}{p(M_1, \\theta_1 \\mid y)}}_{\\text{后验比}} \\times \\underbrace{\\frac{r_{21} \\, q_{21}(\\cdot \\mid \\theta_2^\\star)}{r_{12} \\, q_{12}(u^\\star \\mid \\theta_1)}}_{\\text{提议比}} \\times \\underbrace{|J|}_{\\text{雅可比行列式}} $$\n在这里，$u^\\star$ 是从辅助变量分布 $q_{12}$ 中抽取的特定样本，用于生成 $M_2$ 中的新参数。在这个问题中，提议通过 $c_E = u$ 将 $(\\theta_1, u)$ 映射到 $\\theta_2 = (\\theta_1, c_E)$，因此提议的参数是 $c_E^\\star = u^\\star=-0.3$ 且 $\\theta_2^\\star = (\\theta_1, c_E^\\star)$。逆向移动是确定性的，因此没有逆向辅助变量，其提议密度 $q_{21}$ 为 $1$。维度匹配映射的雅可比行列式 $|J|$ 已给出为 $1$。\n\n我们来分析比率 $R$ 的每一项。\n\n首先，后验比，使用贝叶斯定理 $p(\\theta_k, M_k \\mid y) \\propto p(y \\mid \\theta_k, M_k) p(\\theta_k \\mid M_k) p(M_k)$:\n$$ \\frac{p(M_2, \\theta_2^\\star \\mid y)}{p(M_1, \\theta_1 \\mid y)} = \\frac{p(y \\mid \\theta_2^\\star, M_2) \\, p(\\theta_2^\\star \\mid M_2) \\, p(M_2)}{p(y \\mid \\theta_1, M_1) \\, p(\\theta_1 \\mid M_1) \\, p(M_1)} $$\n参数矢量 $\\theta_2^\\star$ 是 $(\\theta_1, c_E^\\star)$。我们可以将先验 $p(\\theta_2^\\star \\mid M_2)$ 分解为 $p(c_E^\\star \\mid \\theta_1, M_2) p(\\theta_1 \\mid M_2)$。假设 $c_E$ 的先验独立于 $\\theta_1$，这可以简化为 $p(c_E^\\star \\mid M_2) p(\\theta_1 \\mid M_2)$。问题陈述，共享参数 $\\theta_1$ 的先验在两个模型下是相同的，即 $p(\\theta_1 \\mid M_1) = p(\\theta_1 \\mid M_2)$。因此这些项相互抵消。后验比简化为：\n$$ \\frac{p(M_2, \\theta_2^\\star \\mid y)}{p(M_1, \\theta_1 \\mid y)} = \\frac{p(y \\mid \\theta_2^\\star, M_2) \\, p(c_E^\\star \\mid M_2) \\, p(M_2)}{p(y \\mid \\theta_1, M_1) \\, p(M_1)} $$\n\n现在，代入给定的分布：\n似然比为：\n$$ \\frac{p(y \\mid \\theta_2^\\star, M_2)}{p(y \\mid \\theta_1, M_1)} = \\frac{\\mathcal{N}(y \\mid b+ac_E^\\star, \\sigma^2)}{\\mathcal{N}(y \\mid b, \\sigma^2)} = \\frac{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - (b+ac_E^\\star))^2}{2\\sigma^2}\\right)}{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y-b)^2}{2\\sigma^2}\\right)} $$\n当 $y=0$ 时，上式变为：\n$$ \\exp\\left(\\frac{b^2 - (b+ac_E^\\star)^2}{2\\sigma^2}\\right) $$\n$c_E$ 的参数先验为 $p(c_E^\\star \\mid M_2) = \\mathcal{N}(c_E^\\star \\mid 0, \\tau^2) = \\frac{1}{\\sqrt{2\\pi\\tau^2}} \\exp\\left(-\\frac{(c_E^\\star)^2}{2\\tau^2}\\right)$。\n模型先验比为 $\\frac{p(M_2)}{p(M_1)}$。\n\n其次，提议比：\n$$ \\frac{r_{21} \\, q_{21}(\\cdot \\mid \\theta_2^\\star)}{r_{12} \\, q_{12}(u^\\star \\mid \\theta_1)} $$\n给定 $r_{12}=r_{21}=0.5$，它们的比值为 $1$。逆向提议 $q_{21}=1$。辅助变量的前向提议为 $q_{12}(u^\\star \\mid \\theta_1) = \\mathcal{N}(u^\\star \\mid m, s^2) = \\frac{1}{\\sqrt{2\\pi s^2}} \\exp\\left(-\\frac{(u^\\star - m)^2}{2s^2}\\right)$。\n因此，提议比项的计算结果为 $\\frac{1}{q_{12}(u^\\star \\mid \\theta_1)}$。\n\n第三，雅可比行列式给定为 $|J|=1$。\n\n综合所有项，并回想 $c_E^\\star=u^\\star$，完整的接受率 $R$ 为：\n$$ R = \\frac{p(y \\mid \\theta_2^\\star, M_2)}{p(y \\mid \\theta_1, M_1)} \\times \\frac{p(M_2)}{p(M_1)} \\times p(c_E^\\star \\mid M_2) \\times \\frac{1}{q_{12}(u^\\star \\mid \\theta_1)} \\times 1 $$\n代入概率密度函数：\n$$ R = \\exp\\left(\\frac{b^2 - (b+au^\\star)^2}{2\\sigma^2}\\right) \\times \\frac{p(M_2)}{p(M_1)} \\times \\frac{\\frac{1}{\\sqrt{2\\pi\\tau^2}} \\exp\\left(-\\frac{(u^\\star)^2}{2\\tau^2}\\right)}{\\frac{1}{\\sqrt{2\\pi s^2}} \\exp\\left(-\\frac{(u^\\star-m)^2}{2s^2}\\right)} $$\n$$ R = \\exp\\left(\\frac{b^2 - (b+au^\\star)^2}{2\\sigma^2}\\right) \\times \\frac{p(M_2)}{p(M_1)} \\times \\frac{s}{\\tau} \\exp\\left(\\frac{(u^\\star-m)^2}{2s^2} - \\frac{(u^\\star)^2}{2\\tau^2}\\right) $$\n现在，我们代入提供的数值：\n$b=0.5$，$a=-2.0$，$\\sigma=0.3$，$u^\\star=-0.3$，$p(M_1)=0.6$，$p(M_2)=0.4$，$\\tau=1$，$m=-0.1$，$s=0.5$。\n\n1.  似然相关项的指数：\n    $M_2$ 的均值为 $\\mu_2 = b + a u^\\star = 0.5 + (-2.0)(-0.3) = 0.5 + 0.6 = 1.1$。\n    指数为 $\\frac{b^2 - \\mu_2^2}{2\\sigma^2} = \\frac{(0.5)^2 - (1.1)^2}{2(0.3)^2} = \\frac{0.25 - 1.21}{2(0.09)} = \\frac{-0.96}{0.18} = -\\frac{16}{3}$。\n\n2.  模型先验比：\n    $\\frac{p(M_2)}{p(M_1)} = \\frac{0.4}{0.6} = \\frac{2}{3}$。\n\n3.  先验/提议项：\n    前置因子为 $\\frac{s}{\\tau} = \\frac{0.5}{1} = 0.5$。\n    指数为 $\\frac{(u^\\star-m)^2}{2s^2} - \\frac{(u^\\star)^2}{2\\tau^2} = \\frac{(-0.3 - (-0.1))^2}{2(0.5)^2} - \\frac{(-0.3)^2}{2(1)^2} = \\frac{(-0.2)^2}{0.5} - \\frac{0.09}{2} = \\frac{0.04}{0.5} - 0.045 = 0.08 - 0.045 = 0.035$。\n\n将这些部分组合到 $R$ 的表达式中：\n$$ R = \\exp\\left(-\\frac{16}{3}\\right) \\times \\frac{2}{3} \\times 0.5 \\times \\exp(0.035) $$\n$$ R = \\exp\\left(-\\frac{16}{3} + 0.035\\right) \\times \\left(\\frac{2}{3} \\times \\frac{1}{2}\\right) $$\n$$ R = \\exp\\left(-5.3333... + 0.035\\right) \\times \\frac{1}{3} $$\n$$ R = \\exp\\left(-5.298333...\\right) \\times \\frac{1}{3} $$\n$$ R \\approx (0.005000406) \\times \\frac{1}{3} \\approx 0.001666802 $$\n接受概率为 $\\alpha_{\\text{birth}} = \\min(1, R)$。由于 $R  1$，我们有 $\\alpha_{\\text{birth}} = R$。\n将结果四舍五入到四位有效数字，得到 $0.001667$。",
            "answer": "$$\\boxed{0.001667}$$"
        }
    ]
}