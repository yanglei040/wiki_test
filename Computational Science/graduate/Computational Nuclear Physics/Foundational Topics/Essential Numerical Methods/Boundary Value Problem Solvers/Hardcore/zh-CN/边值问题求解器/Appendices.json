{
    "hands_on_practices": [
        {
            "introduction": "当我们将微分方程离散化时，我们将其转化为一个矩阵系统。数值解的稳定性和准确性在很大程度上取决于该矩阵的属性。本练习  将指导您分析典型的一维泊松方程，让您从第一性原理出发，推导有限差分矩阵的条件数，并理解其对网格间距 $h$ 的关键依赖性。",
            "id": "3545166",
            "problem": "在计算核物理中，边值问题求解器常用于平板上的一维（$1\\text{D}$）稳态中子扩散模型，其中输运和吸收被简化为具有指定真空边界的扩散问题。考虑区间 $[0,1]$ 上的典范标量椭圆边值问题，\n$$\n-u''(x) = f(x), \\quad x \\in [0,1], \\quad u(0) = 0, \\quad u(1) = 0,\n$$\n作为此类求解器中出现的主阶扩散算子。使用 $n$ 个内点 $x_i = i h$（$i = 1,2,\\dots,n$）和网格间距 $h = \\frac{1}{n+1}$ 对区间进行离散化，并采用标准的二阶中心有限差分（Finite Difference (FD)）格式，得到线性系统 $A \\boldsymbol{u} = \\boldsymbol{f}$，其中 $A \\in \\mathbb{R}^{n \\times n}$ 是刚度矩阵。矩阵 $A$ 是对称正定（Symmetric Positive Definite (SPD)）的三对角托普利茨矩阵，其元素为\n$$\nA_{ii} = \\frac{2}{h^{2}}, \\quad A_{i,i+1} = A_{i+1,i} = -\\frac{1}{h^{2}}, \\quad i = 1,2,\\dots,n-1.\n$$\n从矩阵 $2$-范数条件数 $\\kappa_{2}(A) = \\|A\\|_{2} \\,\\|A^{-1}\\|_{2}$ 的定义和满足齐次狄利克雷边界编码 $\\boldsymbol{v}_0 = \\boldsymbol{v}_{n+1} = \\boldsymbol{0}$ 的离散特征值问题 $A \\boldsymbol{v} = \\lambda \\boldsymbol{v}$ 出发，推导 $A$ 的谱，并用它来获得 $\\kappa_{2}(A)$ 作为 $n$ 的函数的闭式表达式。在 $h \\to 0$（等价于 $n \\to \\infty$）的极限情况下，使用渐近分析从第一性原理证明 $\\kappa_{2}(A)$ 表现出 $O(h^{-2})$ 的增长，并确定乘以 $h^{-2}$ 的主阶常数。将您的最终答案表示为 $\\kappa_{2}(A)$ 关于 $n$ 的单一闭式解析表达式。不需要四舍五入；条件数是无量纲的，应不带单位报告。",
            "solution": "问题需要经过验证。\n\n### 步骤 1：提取已知条件\n-   **方程：** $-u''(x) = f(x)$\n-   **定义域：** $x \\in [0,1]$\n-   **边界条件：** $u(0) = 0$, $u(1) = 0$\n-   **离散化：** $n$ 个内点 $x_i = i h$，其中 $i = 1,2,\\dots,n$\n-   **网格间距：** $h = \\frac{1}{n+1}$\n-   **格式：** 二阶中心有限差分\n-   **线性系统：** $A \\boldsymbol{u} = \\boldsymbol{f}$\n-   **矩阵性质：** $A \\in \\mathbb{R}^{n \\times n}$ 是对称正定（SPD）的三对角托普利茨矩阵。\n-   **矩阵元素：** $A_{ii} = \\frac{2}{h^{2}}$, $A_{i,i+1} = A_{i+1,i} = -\\frac{1}{h^{2}}$，其中 $i = 1,2,\\dots,n-1$。\n-   **定义：** $\\kappa_{2}(A) = \\|A\\|_{2} \\,\\|A^{-1}\\|_{2}$\n-   **特征值问题：** $A \\boldsymbol{v} = \\lambda \\boldsymbol{v}$，其中 $\\boldsymbol{v}_0 = \\boldsymbol{v}_{n+1} = 0$。\n-   **任务 1：** 推导 $A$ 的谱，并获得 $\\kappa_{2}(A)$ 作为 $n$ 的函数的闭式表达式。\n-   **任务 2：** 在 $h \\to 0$（$n \\to \\infty$）时进行渐近分析，以显示 $\\kappa_{2}(A)$ 具有 $O(h^{-2})$ 的增长并求出主阶常数。\n-   **最终答案格式：** $\\kappa_{2}(A)$ 关于 $n$ 的单一闭式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据、是适定且客观的。它描述了一维泊松方程的标准有限差分离散，这是数值分析中的一个典范问题，也是包括中子扩散在内的计算物理学中的一个基本模型。所有的数学定义和性质都陈述正确且一致。该问题是自洽的，提供了推导出解所需的所有必要信息。不存在矛盾、歧义或不科学的前提。\n\n### 步骤 3：结论与行动\n问题有效。现在开始求解过程。\n\n矩阵 $A$ 是对称正定（SPD）的。对于任何 SPD 矩阵，其矩阵 $2$-范数 $\\|A\\|_2$ 是其最大特征值（$\\lambda_{\\text{max}}$），其逆矩阵的 $2$-范数 $\\|A^{-1}\\|_2$ 是其最小特征值（$\\lambda_{\\text{min}}$）的倒数。因此，条件数 $\\kappa_2(A)$ 由最大特征值与最小特征值之比给出：\n$$\n\\kappa_2(A) = \\|A\\|_2 \\|A^{-1}\\|_2 = \\frac{\\lambda_{\\text{max}}(A)}{\\lambda_{\\text{min}}(A)}\n$$\n为了求得 $\\kappa_2(A)$，我们必须首先确定矩阵 $A$ 的谱（所有特征值的集合）。特征值问题是 $A \\boldsymbol{v} = \\lambda \\boldsymbol{v}$，其中 $\\boldsymbol{v}$ 是一个特征向量，$\\lambda$ 是其对应的特征值。\n\n矩阵 $A$ 由 $A = \\frac{1}{h^2} T$ 给出，其中 $T$ 是三对角托普利茨矩阵：\n$$\nT = \\begin{pmatrix}\n2   -1  0  \\cdots  0 \\\\\n-1  2  -1  \\cdots  0 \\\\\n0   \\ddots  \\ddots  \\ddots  \\vdots \\\\\n\\vdots    -1  2  -1 \\\\\n0   \\cdots  0  -1  2\n\\end{pmatrix} \\in \\mathbb{R}^{n \\times n}\n$$\n特征值问题 $A \\boldsymbol{v} = \\lambda \\boldsymbol{v}$ 可以写成 $T\\boldsymbol{v} = (\\lambda h^2) \\boldsymbol{v}$。设 $\\mu = \\lambda h^2$ 为 $T$ 的一个特征值。该方程的第 $i$ 个分量是：\n$$\n-v_{i-1} + 2v_i - v_{i+1} = \\mu v_i, \\quad i = 1, 2, \\dots, n\n$$\n我们将其重排成一个齐次二阶线性差分方程：\n$$\n-v_{i-1} + (2-\\mu)v_i - v_{i+1} = 0\n$$\n问题陈述中指出，离散化包含了齐次狄利克雷边界条件，编码为 $v_0 = 0$ 和 $v_{n+1} = 0$。我们寻求特征向量分量 $v_i$ 的非平凡解。我们采用设解形式 $v_i = z^i$，其中 $z$ 为某个复数。将其代入差分方程得到：\n$$\n-z^{i-1} + (2-\\mu)z^i - z^{i+1} = 0\n$$\n两边同除以 $z^{i-1}$（假设 $z \\neq 0$），我们得到特征方程：\n$$\n-1 + (2-\\mu)z - z^2 = 0 \\quad \\implies \\quad z^2 - (2-\\mu)z + 1 = 0\n$$\n该二次方程的根为 $z_{1,2} = \\frac{(2-\\mu) \\pm \\sqrt{(2-\\mu)^2-4}}{2}$。由于根的乘积为 $z_1 z_2 = 1$，我们可以将它们表示为 $z$ 和 $z^{-1}$。我们设 $z = e^{i\\theta}$，其中 $\\theta$ 为某个值。$v_i$ 的通解是两种形式的线性组合：\n$$\nv_i = C_1 z^i + C_2 z^{-i}\n$$\n应用边界条件 $v_0 = 0$：\n$$\nv_0 = C_1 z^0 + C_2 z^{-0} = C_1 + C_2 = 0 \\implies C_2 = -C_1\n$$\n这将解简化为 $v_i = C_1(z^i - z^{-i})$。如果我们设 $z = e^{i\\theta}$，它就变成：\n$$\nv_i = C_1(e^{i\\theta i} - e^{-i\\theta i}) = 2i C_1 \\sin(i\\theta)\n$$\n设新常数 $C = 2i C_1$。那么特征向量分量的形式是 $v_i = C \\sin(i\\theta)$。\n现在，我们应用第二个边界条件 $v_{n+1}=0$：\n$$\nv_{n+1} = C \\sin((n+1)\\theta) = 0\n$$\n对于非平凡特征向量，有 $C \\neq 0$，所以必须有 $\\sin((n+1)\\theta) = 0$。这意味着 $(n+1)\\theta = k\\pi$，其中 $k$ 是一个整数。因此，$\\theta$ 的可能值为：\n$$\n\\theta_k = \\frac{k\\pi}{n+1}, \\quad k = 1, 2, \\dots, n\n$$\n$k=0$ 和 $k=n+1$ 的值会产生平凡特征向量（对所有 $i$ 都有 $v_i=0$），而 $k$ 的其他整数值所导出的特征向量与 $k \\in \\{1, \\dots, n\\}$ 的特征向量等价（最多相差一个符号）。因此，我们有 $n$ 个不同的特征向量，其分量由下式给出：\n$$\n(v_k)_i = \\sin\\left(\\frac{ik\\pi}{n+1}\\right), \\quad i=1, \\dots, n \\quad \\text{for each } k=1, \\dots, n\n$$\n现在我们求出与每个特征向量 $v_k$ 对应的特征值 $\\mu_k$。根据特征方程，我们有 $2-\\mu = z + z^{-1}$。当 $z = e^{i\\theta_k}$ 时，该式变为：\n$$\n2-\\mu_k = e^{i\\theta_k} + e^{-i\\theta_k} = 2\\cos(\\theta_k)\n$$\n求解 $\\mu_k$：\n$$\n\\mu_k = 2 - 2\\cos(\\theta_k) = 4\\sin^2\\left(\\frac{\\theta_k}{2}\\right)\n$$\n代入 $\\theta_k = \\frac{k\\pi}{n+1}$：\n$$\n\\mu_k = 4\\sin^2\\left(\\frac{k\\pi}{2(n+1)}\\right), \\quad k = 1, 2, \\dots, n\n$$\n这些是矩阵 $T$ 的特征值。原始矩阵 $A = \\frac{1}{h^2}T$ 的特征值 $\\lambda_k$ 是：\n$$\n\\lambda_k = \\frac{\\mu_k}{h^2} = \\frac{4}{h^2}\\sin^2\\left(\\frac{k\\pi}{2(n+1)}\\right), \\quad k = 1, 2, \\dots, n\n$$\n正弦函数在区间 $[0, \\frac{\\pi}{2}]$ 上是单调递增的。对于所有 $k \\in \\{1, \\dots, n\\}$，其自变量 $\\frac{k\\pi}{2(n+1)}$ 都在这个范围内，因为 $\\frac{n\\pi}{2(n+1)}  \\frac{\\pi}{2}$。\n最小特征值 $\\lambda_{\\text{min}}$ 在 $k=1$ 时取得：\n$$\n\\lambda_{\\text{min}} = \\lambda_1 = \\frac{4}{h^2}\\sin^2\\left(\\frac{\\pi}{2(n+1)}\\right)\n$$\n最大特征值 $\\lambda_{\\text{max}}$ 在 $k=n$ 时取得：\n$$\n\\lambda_{\\text{max}} = \\lambda_n = \\frac{4}{h^2}\\sin^2\\left(\\frac{n\\pi}{2(n+1)}\\right)\n$$\n现在，我们可以计算条件数：\n$$\n\\kappa_2(A) = \\frac{\\lambda_{\\text{max}}}{\\lambda_{\\text{min}}} = \\frac{\\frac{4}{h^2}\\sin^2\\left(\\frac{n\\pi}{2(n+1)}\\right)}{\\frac{4}{h^2}\\sin^2\\left(\\frac{\\pi}{2(n+1)}\\right)} = \\frac{\\sin^2\\left(\\frac{n\\pi}{2(n+1)}\\right)}{\\sin^2\\left(\\frac{\\pi}{2(n+1)}\\right)}\n$$\n使用恒等式 $\\sin(x) = \\cos(\\frac{\\pi}{2}-x)$，我们可以重写分子：\n$$\n\\sin\\left(\\frac{n\\pi}{2(n+1)}\\right) = \\sin\\left(\\frac{(n+1-1)\\pi}{2(n+1)}\\right) = \\sin\\left(\\frac{\\pi}{2} - \\frac{\\pi}{2(n+1)}\\right) = \\cos\\left(\\frac{\\pi}{2(n+1)}\\right)\n$$\n将此代回 $\\kappa_2(A)$ 的表达式中：\n$$\n\\kappa_2(A) = \\frac{\\cos^2\\left(\\frac{\\pi}{2(n+1)}\\right)}{\\sin^2\\left(\\frac{\\pi}{2(n+1)}\\right)} = \\cot^2\\left(\\frac{\\pi}{2(n+1)}\\right)\n$$\n这就是 $\\kappa_2(A)$ 作为 $n$ 的函数的闭式表达式。\n\n对于 $h \\to 0$（意味着 $n \\to \\infty$）时的渐近分析，我们考虑余切函数的自变量 $x = \\frac{\\pi}{2(n+1)}$。当 $n \\to \\infty$ 时，$x \\to 0$。我们使用余切函数的小角度近似，这可以从正弦和余弦的泰勒级数推导出来：$\\sin(x) = x - O(x^3)$ 和 $\\cos(x) = 1 - O(x^2)$。\n$$\n\\cot(x) = \\frac{\\cos(x)}{\\sin(x)} \\approx \\frac{1}{x} \\quad \\text{for } x \\ll 1\n$$\n因此，对于大的 $n$：\n$$\n\\kappa_2(A) = \\cot^2(x) \\approx \\left(\\frac{1}{x}\\right)^2 = \\frac{1}{x^2} = \\frac{1}{\\left(\\frac{\\pi}{2(n+1)}\\right)^2} = \\frac{4(n+1)^2}{\\pi^2}\n$$\n根据定义 $h = \\frac{1}{n+1}$，我们可以用 $h$ 来表示这个结果：\n$$\n\\kappa_2(A) \\approx \\frac{4(1/h)^2}{\\pi^2} = \\frac{4}{\\pi^2 h^2} = \\frac{4}{\\pi^2} h^{-2}\n$$\n这从第一性原理证明了 $\\kappa_2(A)$ 表现出 $O(h^{-2})$ 的增长，且乘以 $h^{-2}$ 的主阶常数是 $\\frac{4}{\\pi^2}$。问题要求给出 $\\kappa_2(A)$ 关于 $n$ 的单一闭式表达式，这在渐近分析之前已经推导出。",
            "answer": "$$\n\\boxed{\\cot^2\\left(\\frac{\\pi}{2(n+1)}\\right)}\n$$"
        },
        {
            "introduction": "虽然有限差分法很直观，但有限元法 (Finite Element Method, FEM) 为处理具有可变系数的复杂问题提供了更大的灵活性，而这在核物理中是常见情况。本练习  为中子扩散问题提供了一个完整的有限元法实践演练。您将推导弱形式，学习使用提升函数处理非齐次狄利克雷边界条件，并通过单元级计算组装最终的线性系统。",
            "id": "3545228",
            "problem": "考虑区间 $[0,1]$ 上的无量纲、一维、稳态、单群中子扩散边值问题：\n$$\n-\\frac{d}{dx}\\!\\left(p(x)\\,\\frac{du}{dx}\\right) + q(x)\\,u(x) = s(x),\n$$\n其狄利克雷边界条件为 $u(0)=\\alpha$ 和 $u(1)=\\beta$。此处，$p(x)$ 模拟了空间变化的扩散系数，$q(x)$ 模拟了空间变化的宏观吸收，$s(x)$ 是一个体积中子源。请使用无量纲单位进行计算。\n\n任务：\n- 从强形式出发，使用二阶线性椭圆算子的标准变分框架推导弱形式。清晰地指出双线性形式和线性泛函，并指明相关的函数空间。在首次使用时定义所有缩略词（例如，有限元法 (FEM)，偏微分方程 (PDE)）。\n- 引入一个提升函数 $l(x)$ 来施加狄利克雷边界数据，记 $u = w + l$，其中 $w \\in H_0^1(0,1)$，并展示弱形式中的右端项是如何被修正的。\n- 对于使用连续分段线性形函数的有限元法，在一个长度为 $h_i = x_{i+1}-x_i$ 的一般单元 $e = [x_i,x_{i+1}]$ 上，从第一性原理出发，推导以 $p(x)$、$q(x)$、$s(x)$ 和提升函数 $l(x)$ 表示的单元刚度矩阵和单元载荷向量：\n  - 将 $a,b \\in \\{i,i+1\\}$ 的 $K^{(e)}_{ab}$ 表示为包含 $p(x)$、$q(x)$以及单元形函数及其导数的积分。\n  - 将 $a \\in \\{i,i+1\\}$ 的 $f^{(e)}_{a}$ 表示为包含 $s(x)$、$p(x)$、$q(x)$、$l(x)$ 以及单元形函数及其导数的积分。\n- 将问题具体化到以下情况：\n$$\np(x) = 1 + x,\\qquad q(x) = x,\\qquad s(x) = 1 + x^2,\n$$\n狄利克雷数据为 $\\alpha = 0.2$ 和 $\\beta = 0.6$。选择线性提升函数 $l(x) = \\alpha + (\\beta-\\alpha)\\,x$。使用包含2个线性有限元和节点 $x_0=0$、$x_1=0.5$、$x_2=1$ 的均匀网格。为单个内部未知数组装全局系统，并精确计算有限元近似解 $u_h(x_1)$。\n\n答案形式：\n- 以 $u_h(0.5)$ 的单个标量值的形式提供最终答案。\n- 将最终答案表示为一个精确的有理数。不包含单位。",
            "solution": "我们从稳态单群中子扩散偏微分方程 (PDE) 开始：\n$$\n-\\frac{d}{dx}\\!\\left(p(x)\\,\\frac{du}{dx}\\right) + q(x)\\,u(x) = s(x)\\quad \\text{in } (0,1),\n$$\n其狄利克雷边界条件为 $u(0)=\\alpha$ 和 $u(1)=\\beta$。我们在 Sobolev 空间 $H^1(0,1)$ 上寻求一个弱（变分）形式，其中试探函数满足边界条件。令 $V := H_0^1(0,1)$，并设检验函数 $v \\in V$。将 PDE 乘以 $v$ 并对扩散项进行分部积分：\n$$\n\\int_0^1 p(x)\\,u'(x)\\,v'(x)\\,dx + \\int_0^1 q(x)\\,u(x)\\,v(x)\\,dx = \\int_0^1 s(x)\\,v(x)\\,dx,\n$$\n其中边界项因 $v(0)=v(1)=0$ 而消失。定义双线性形式\n$$\na(u,v) := \\int_0^1 p(x)\\,u'(x)\\,v'(x)\\,dx + \\int_0^1 q(x)\\,u(x)\\,v(x)\\,dx,\n$$\n和线性泛函\n$$\n\\ell(v) := \\int_0^1 s(x)\\,v(x)\\,dx.\n$$\n弱问题是：求 $u \\in H^1(0,1)$，满足 $u(0)=\\alpha$，$u(1)=\\beta$，使得\n$$\na(u,v) = \\ell(v)\\quad \\forall v \\in V.\n$$\n\n为通过提升函数施加狄利克雷边界数据，选择 $l \\in H^1(0,1)$，满足 $l(0)=\\alpha$ 和 $l(1)=\\beta$，并记 $u = w + l$，其中 $w \\in V$。代入弱形式得到\n$$\na(w+l,v) = \\ell(v)\\quad \\forall v \\in V,\n$$\n因此\n$$\na(w,v) = \\ell(v) - a(l,v) = \\int_0^1 s(x)\\,v(x)\\,dx - \\int_0^1 p(x)\\,l'(x)\\,v'(x)\\,dx - \\int_0^1 q(x)\\,l(x)\\,v(x)\\,dx.\n$$\n这样，提升函数只修改了右端项为\n$$\nf(v) := \\int_0^1 s(x)\\,v(x)\\,dx - \\int_0^1 p(x)\\,l'(x)\\,v'(x)\\,dx - \\int_0^1 q(x)\\,l(x)\\,v(x)\\,dx,\n$$\n而 $V$ 上的双线性形式 $a(\\cdot,\\cdot)$ 保持不变。\n\n对于有限元法 (FEM)，考虑一个长度为 $h_i = x_{i+1}-x_i$ 的单元 $e=[x_i,x_{i+1}]$。设 $\\{N_i,N_{i+1}\\}$ 为该单元的线性形函数，满足 $N_i(x_i)=1$，$N_i(x_{i+1})=0$，$N_{i+1}(x_i)=0$，$N_{i+1}(x_{i+1})=1$，且 $N_i' = -1/h_i$，$N_{i+1}' = 1/h_i$。单元刚度矩阵的各项直接从双线性形式推导得出：\n$$\nK^{(e)}_{ab} = \\int_{x_i}^{x_{i+1}} p(x)\\,N_a'(x)\\,N_b'(x)\\,dx + \\int_{x_i}^{x_{i+1}} q(x)\\,N_a(x)\\,N_b(x)\\,dx,\\quad a,b\\in\\{i,i+1\\}.\n$$\n使用经过提升的右端项，单元载荷向量的各项为：\n$$\nf^{(e)}_{a} = \\int_{x_i}^{x_{i+1}} s(x)\\,N_a(x)\\,dx - \\int_{x_i}^{x_{i+1}} p(x)\\,l'(x)\\,N_a'(x)\\,dx - \\int_{x_i}^{x_{i+1}} q(x)\\,l(x)\\,N_a(x)\\,dx,\\quad a\\in\\{i,i+1\\}.\n$$\n全局组装遵循标准的有限元流程，通过将相邻单元对共享全局自由度的贡献相加来完成。\n\n现在将问题具体化到\n$$\np(x)=1+x,\\quad q(x)=x,\\quad s(x)=1+x^2,\n$$\n狄利克雷数据为 $\\alpha=0.2$ 和 $\\beta=0.6$。选择线性提升函数\n$$\nl(x) = \\alpha + (\\beta-\\alpha)\\,x = 0.2 + 0.4\\,x,\n$$\n因此 $l'(x)=0.4$。使用包含2个单元和节点 $x_0=0$、$x_1=0.5$、$x_2=1$ 的均匀网格。离散未知数是与全局帽子基函数 $\\phi_1$ 相关联的单个内部自由度 $w_1 \\approx w(x_1)$。$w_1$ 的全局刚度为\n$$\nK_{11} = \\int_0^1 p(x)\\,(\\phi_1'(x))^2\\,dx + \\int_0^1 q(x)\\,(\\phi_1(x))^2\\,dx.\n$$\n在 $[0,0.5]$ 上，$\\phi_1(x)=2x$ 且 $\\phi_1'(x)=2$。在 $[0.5,1]$ 上，$\\phi_1(x)=2(1-x)$ 且 $\\phi_1'(x)=-2$。\n\n计算扩散部分：\n$$\n\\int_0^{0.5} (1+x)\\,(2)^2 dx = 4\\int_0^{0.5} (1+x)\\,dx = 4\\left(\\frac{5}{8}\\right)=\\frac{5}{2},\n$$\n$$\n\\int_{0.5}^{1} (1+x)\\,( -2)^2 dx = 4\\int_{0.5}^{1} (1+x)\\,dx = 4\\left(\\frac{7}{8}\\right)=\\frac{7}{2}.\n$$\n因此扩散项贡献总和为 $\\frac{5}{2}+\\frac{7}{2}=6$。\n\n计算吸收部分：\n$$\n\\int_0^{0.5} x\\,(2x)^2\\,dx = \\int_0^{0.5} 4x^3\\,dx = \\left[x^4\\right]_0^{0.5} = \\frac{1}{16},\n$$\n$$\n\\int_{0.5}^{1} x\\,[2(1-x)]^2\\,dx = \\int_{0.5}^{1} 4x(1-2x+x^2)\\,dx = \\frac{5}{48}.\n$$\n因此吸收项贡献为 $\\frac{1}{16}+\\frac{5}{48}=\\frac{1}{6}$。所以\n$$\nK_{11} = 6 + \\frac{1}{6} = \\frac{37}{6}.\n$$\n\n接下来为单个检验函数 $\\phi_1$ 计算经过提升的右端项：\n$$\nf_1 = \\int_0^1 s(x)\\,\\phi_1(x)\\,dx - \\int_0^1 p(x)\\,l'(x)\\,\\phi_1'(x)\\,dx - \\int_0^1 q(x)\\,l(x)\\,\\phi_1(x)\\,dx.\n$$\n分段计算每一项。\n\n源项：\n在 $[0,0.5]$ 上，$(1+x^2)\\,(2x) = 2x + 2x^3$ 得到\n$$\n\\int_0^{0.5} (2x + 2x^3)\\,dx = \\left[x^2 + \\frac{x^4}{2}\\right]_0^{0.5} = \\frac{1}{4}+\\frac{1}{32} = \\frac{9}{32}.\n$$\n在 $[0.5,1]$ 上，$(1+x^2)\\,2(1-x) = 2 - 2x + 2x^2 - 2x^3$ 得到\n$$\n\\int_{0.5}^{1} (2 - 2x + 2x^2 - 2x^3)\\,dx = \\left[2x - x^2 + \\frac{2}{3}x^3 - \\frac{1}{2}x^4\\right]_{0.5}^{1} = \\frac{35}{96}.\n$$\n因此\n$$\n\\int_0^1 s(x)\\,\\phi_1(x)\\,dx = \\frac{9}{32} + \\frac{35}{96} = \\frac{31}{48}.\n$$\n\n提升-扩散耦合项：\n由于 $l'(x)=0.4=\\frac{2}{5}$ 且 $\\phi_1'$ 在每个子区间上为常数，\n$$\n\\int_0^1 p(x)\\,l'(x)\\,\\phi_1'(x)\\,dx = \\frac{2}{5}\\left[2\\int_0^{0.5}(1+x)\\,dx - 2\\int_{0.5}^{1}(1+x)\\,dx\\right]\n= \\frac{2}{5}\\left[2\\cdot\\frac{5}{8} - 2\\cdot\\frac{7}{8}\\right] = -\\frac{1}{5}.\n$$\n\n提升-吸收耦合项：\n在 $[0,0.5]$ 上，$x\\,l(x)\\,\\phi_1(x) = x\\,(0.2+0.4x)\\,(2x) = 0.4 x^2 + 0.8 x^3$，因此\n$$\n\\int_0^{0.5} \\left(0.4 x^2 + 0.8 x^3\\right)\\,dx = \\frac{1}{60} + \\frac{1}{80} = \\frac{7}{240}.\n$$\n在 $[0.5,1]$ 上，$x\\,l(x)\\,\\phi_1(x) = x\\,(0.2+0.4x)\\,2(1-x) = 0.4 x + 0.4 x^2 - 0.8 x^3$，因此\n$$\n\\int_{0.5}^{1} \\left(0.4 x + 0.4 x^2 - 0.8 x^3\\right)\\,dx \n= \\left[\\frac{1}{5}x^2 + \\frac{2}{15}x^3 - \\frac{1}{5}x^4\\right]_{0.5}^{1} = \\frac{19}{240}.\n$$\n所以\n$$\n\\int_0^1 q(x)\\,l(x)\\,\\phi_1(x)\\,dx = \\frac{7}{240} + \\frac{19}{240} = \\frac{13}{120}.\n$$\n\n汇总各项，\n$$\nf_1 = \\frac{31}{48} - \\left(-\\frac{1}{5}\\right) - \\frac{13}{120} = \\frac{31}{48} + \\frac{1}{5} - \\frac{13}{120} = \\frac{177}{240} = \\frac{59}{80}.\n$$\n\n单个未知数 $w_1$ 的离散方程是\n$$\nK_{11}\\,w_1 = f_1 \\quad \\Longrightarrow \\quad w_1 = \\frac{f_1}{K_{11}} = \\frac{\\frac{59}{80}}{\\frac{37}{6}} = \\frac{177}{1480}.\n$$\n通过加上提升函数来恢复内部节点上的 $u_h$：\n$$\nu_h(0.5) = w_1 + l(0.5) = \\frac{177}{1480} + \\left(0.2 + 0.4\\cdot 0.5\\right) = \\frac{177}{1480} + \\frac{2}{5} = \\frac{177}{1480} + \\frac{592}{1480} = \\frac{769}{1480}.\n$$\n这就是给定数据下，在 $x=0.5$ 处有限元近似解的精确有理数值。",
            "answer": "$$\\boxed{\\frac{769}{1480}}$$"
        },
        {
            "introduction": "一个强大的数值求解器的优劣，取决于它所要解决的物理问题是否被正确地设定。在计算核物理中，根据系统的物理参数正确定义问题域和边界条件是至关重要的第一步。本练习  挑战您将物理原理转化为一个实用算法，该算法能自动选择适当的渐近边界条件并估算所需的计算域大小。",
            "id": "3545155",
            "problem": "你需要构建一个完整、可运行的程序，该程序用于解决计算核物理中的一个双体径向薛定谔边界值问题，能够自动选择合适的大半径边界条件并估算径向域的大小。其物理背景是球对称双体问题的径向方程，其中约化径向波函数 $u(r)$ 满足\n$$\nu''(r) + \\left[k^2 - \\frac{2\\mu}{\\hbar^2}V(r) - \\frac{l(l+1)}{r^2}\\right]u(r) = 0,\n$$\n其中 $\\mu$ 是约化质量，$l$ 是轨道角动量量子数，$E$ 是质心能量。有效势为 $V_{\\mathrm{eff}}(r) = V(r) + \\hbar^2 l(l+1)/(2\\mu r^2)$。对于核相互作用，短程核势 $V(r)$ 在 $r$ 足够大时消失；而对于带电炮弹，则存在一个持续的库仑尾 $V_C(r) = Z e^2/r$，其中 $Z$ 是以基本电荷单位表示的炮弹和靶电荷的乘积。解的渐近形式决定了边界条件的类别：自由波、库仑波或吸收。\n\n你的任务是实现一个边界条件选择器，它能根据 $(Z,l,E)$ 从以下选项中做出选择：\n- 自由波渐近行为（编码为整数 $0$），\n- 库仑波渐近行为（编码为整数 $1$），\n- 吸收边界条件（编码为整数 $2$）。\n\n该选择必须根据第一性原理推导得出，具体如下。\n\n从径向薛定谔方程和有效势的定义出发。利用物理要求，即在渐近区域，剩余势的贡献与动能或束缚能标度相比很小。具体来说，在大 $r$ 处施加势小性判据：\n$$\n\\left|\\frac{Z e^2}{r}\\right| \\le \\varepsilon |E|,\\quad \\frac{\\hbar^2 l(l+1)}{2\\mu r^2} \\le \\varepsilon |E|,\n$$\n其中 $\\varepsilon$ 是一个小的、固定的无量纲阈值。该阈值定义了一个渐近半径 $r_{\\mathrm{asym}}$，超过此半径，解的行为近似于自由解或库仑解。$E$ 的符号区分了类散射 $(E0)$ 和类束缚 $(E\\le 0)$ 的渐近行为。当 $E0$ 时使用德布罗意波数 $k$，当 $E\\le 0$ 时使用衰减常数 $\\kappa$，其中\n$$\nk = \\frac{\\sqrt{2 \\mu E}}{\\hbar c},\\qquad \\kappa = \\frac{\\sqrt{2 \\mu |E|}}{\\hbar c}.\n$$\n此处 $c$ 是光速，我们使用一种混合单位约定，其中能量单位为兆电子伏特，长度单位为飞米，并设 $c=1$，$\\hbar c$ 的值如下文所示。为确保数值边界条件施加在出射或入射特性已能被清晰分辨的区域，对于 $E0$ 的情况，要求有一个固定波长数的额外缓冲：\n$$\nr_k = N_{\\lambda}\\times \\frac{2\\pi}{k}.\n$$\n\n你的程序必须基于这些原理实现并论证以下决策逻辑：\n- 如果 $E \\le 0$：当 $Z = 0$ 时选择自由波渐近行为，当 $Z \\ne 0$ 时选择库仑波渐近行为。将 $r_{\\max}$ 估算为由势小性判据设定的渐近半径与将振幅减小到容差 $\\tau$ 所需的衰减距离中的最大值：\n$$\nr_{\\max} = \\max\\left(r_{\\mathrm{asym}}, \\frac{\\ln(1/\\tau)}{\\kappa}\\right).\n$$\n- 如果 $E  0$：根据上述小性判据计算 $r_{\\mathrm{asym}}$ 和波长缓冲 $r_k$。形成一个初步估计\n$$\nr_{\\max}^{\\mathrm{pre}} = \\max\\left(r_{\\mathrm{asym}}, r_k\\right).\n$$\n如果 $r_{\\max}^{\\mathrm{pre}} \\le r_{\\mathrm{cap}}$，当 $Z=0$ 时选择自由波，当 $Z \\ne 0$ 时选择库仑波，并设置 $r_{\\max} = r_{\\max}^{\\mathrm{pre}}$。如果 $r_{\\max}^{\\mathrm{pre}}  r_{\\mathrm{cap}}$，选择吸收边界条件，并设置 $r_{\\max} = r_{\\mathrm{cap}}$。\n\n使用以下固定的常数和设计参数，所有数值均以指定单位表示：\n- 约化质量 $\\mu = 469.459\\ \\mathrm{MeV}$（取 $c=1$）。\n- $\\hbar c = 197.3269804\\ \\mathrm{MeV\\ fm}$。\n- 库仑常数 $e^2 = 1.439964\\ \\mathrm{MeV\\ fm}$。\n- 势小性阈值 $\\varepsilon = 0.05$。\n- 波长缓冲 $N_{\\lambda} = 3$。\n- 束缚态尾部容差 $\\tau = 10^{-6}$（无量纲）。\n- 最大实用域 $r_{\\mathrm{cap}} = 60\\ \\mathrm{fm}$。\n\n你的程序必须在不使用任何预封装的核物理库的情况下实现上述逻辑。对于每个测试用例，它必须输出一个包含两个元素的列表，其中包括：\n- 所选边界条件的代码（整数），以及\n- 估算的 $r_{\\max}$（浮点数）。\n\n所有的 $r_{\\max}$ 必须以飞米为单位表示，并四舍五入到三位小数。你必须评估的测试套件是以下参数元组 $(Z,l,E)$ 的列表，其中 $E$ 的单位是兆电子伏特，$l$ 是整数：\n- $(0,0,10.0)$，\n- $(1,0,5.0)$，\n- $(40,0,5.0)$，\n- $(0,2,10.0)$，\n- $(0,0,-2.0)$，\n- $(1,1,-0.5)$，\n- $(0,0,1.0\\times 10^{-4})$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，每个结果本身是按上述顺序排列的双元素列表（例如，$[[0,12.345],[1,67.890]]$）。不应打印任何附加文本。",
            "solution": "用户提供的问题陈述已经过分析，并被认为是有效的。它在科学上基于量子力学原理，特别是双体薛定谔方程，并构成一个适定的计算物理问题。所有必需的常数、参数和逻辑步骤均已提供，不存在任何会妨碍为给定测试用例找到唯一解的内部矛盾或模糊之处。\n\n目标是创建一个算法，用于确定求解核物理中双体径向薛定谔方程所需的适当边界条件和必要的径向域大小 $r_{\\max}$。输入是电荷乘积 $Z$、轨道角动量量子数 $l$ 和质心能量 $E$。\n\n约化径向波函数 $u(r)$ 的控制方程是：\n$$\nu''(r) + \\left[k^2 - \\frac{2\\mu}{\\hbar^2}V(r) - \\frac{l(l+1)}{r^2}\\right]u(r) = 0\n$$\n此处，$\\mu$ 是约化质量，项 $\\frac{\\hbar^2 l(l+1)}{2\\mu r^2}$ 是离心势。核势 $V(r)$ 是短程的。对于带电粒子 ($Z \\neq 0$)，还必须考虑长程库仑势 $V_C(r) = Z e^2/r$。边界条件的选择和积分域的大小 $r_{\\max}$ 取决于解在大 $r$ 处的行为，此时核势已经消失。\n\n该算法的核心逻辑植根于物理原理，并通过一系列计算步骤实现。决策过程首先根据能量 $E$ 的符号进行划分。\n\n1.  **能量符号与渐近行为**：\n    -   如果 $E  0$，状态为散射态。波函数 $u(r)$ 在渐近区域是振荡的。其行为由德布罗意波数 $k = \\frac{\\sqrt{2\\mu E}}{\\hbar}$ 决定。使用所提供的常数，其中质量是能量等效值 $\\mu c^2$ 且给定了 $\\hbar c$，正确的公式是 $k = \\frac{\\sqrt{2(\\mu c^2) E}}{\\hbar c}$。\n    -   如果 $E \\le 0$，状态为束缚态或准束缚态。一个物理上可接受的解必须在远距离处呈指数衰减。这种衰减由衰减常数 $\\kappa = \\frac{\\sqrt{2\\mu|E|}}{\\hbar}$ 控制。同样，使用所提供的常数，其计算公式为 $\\kappa = \\frac{\\sqrt{2(\\mu c^2) |E|}}{\\hbar c}$。\n\n2.  **渐近半径 ($r_{\\mathrm{asym}}$)**：\n    数值边界条件应施加在这样一个区域，即长程势（库仑势和离心势）与系统的能量标度 $|E|$ 相比可以忽略不计。这定义了一个渐近半径 $r_{\\mathrm{asym}}$。问题指定了一个量化判据：\n    $$\n    \\left|\\frac{Z e^2}{r}\\right| \\le \\varepsilon |E| \\quad \\text{and} \\quad \\frac{\\hbar^2 l(l+1)}{2\\mu r^2} \\le \\varepsilon |E|\n    $$\n    其中 $\\varepsilon$ 是一个小的无量纲阈值。对这些不等式求解 $r$ 可以得到两个最小半径：\n    -   来自库仑项：$r \\ge \\frac{|Z| e^2}{\\varepsilon |E|} =: r_C$。如果 $Z=0$，此半径为 $0$。\n    -   来自离心项：$r \\ge \\sqrt{\\frac{\\hbar^2 l(l+1)}{2\\mu \\varepsilon |E|}} = \\sqrt{\\frac{(\\hbar c)^2 l(l+1)}{2(\\mu c^2) \\varepsilon |E|}} =: r_L$。如果 $l=0$，此半径为 $0$。\n    渐近区域始于两个条件都满足的地方，因此我们必须取这两个值的最大值：$r_{\\mathrm{asym}} = \\max(r_C, r_L)$。\n\n3.  **边界条件选择与 $r_{\\max}$ 估算**：\n    算法根据 $E$ 的符号继续进行。\n\n    **情况1：类束缚态 ($E \\le 0$)**\n    -   **边界条件**：渐近解由最长程的势决定。如果 $Z=0$，势在大 $r$ 处完全消失，导致自由粒子的指数衰减（自由波渐近行为，代码 $0$）。如果 $Z \\neq 0$，库仑势持续存在，导致一个衰减的惠特克函数（库仑波渐近行为，代码 $1$）。\n    -   **域大小 ($r_{\\max}$)**：两个物理约束决定了 $r_{\\max}$：\n        1.  半径必须在渐近区域内，即 $r \\ge r_{\\mathrm{asym}}$。\n        2.  波函数的振幅（按 $e^{-\\kappa r}$ 衰减）在计算上必须可以忽略。我们要求其大小小于容差 $\\tau$：$e^{-\\kappa r} \\le \\tau$，这意味着 $r \\ge \\frac{\\ln(1/\\tau)}{\\kappa}$。我们将此衰减半径记为 $r_{\\tau}$。\n        为同时满足这两个约束，$r_{\\max}$ 被选为这两个半径的最大值：$r_{\\max} = \\max(r_{\\mathrm{asym}}, r_{\\tau})$。\n\n    **情况2：散射态 ($E  0$)**\n    -   **初步域大小 ($r_{\\max}^{\\mathrm{pre}}$)**：与束缚态情况类似，我们有两个约束：\n        1.  半径必须在渐近区域内，即 $r \\ge r_{\\mathrm{asym}}$。\n        2.  为正确施加振荡边界条件，计算域必须跨越数个波长。波长为 $\\lambda = 2\\pi/k$。需要一个 $N_{\\lambda}$ 个波长的缓冲，得出一个半径 $r_k = N_{\\lambda} \\times \\frac{2\\pi}{k}$。\n        域大小的初步估计为 $r_{\\max}^{\\mathrm{pre}} = \\max(r_{\\mathrm{asym}}, r_k)$。\n    -   **基于实际限制 ($r_{\\mathrm{cap}}$) 的最终选择**：对于非常低的能量，$k$ 很小，所需的 $r_{\\max}^{\\mathrm{pre}}$ 在计算上可能变得不可行。因此引入了一个实际的最大域 $r_{\\mathrm{cap}}$。\n        -   如果 $r_{\\max}^{\\mathrm{pre}} \\le r_{\\mathrm{cap}}$：计算是可行的。边界条件根据 $Z$ 选择（$Z=0$ 为自由波，代码 $0$；$Z \\ne 0$ 为库仑波，代码 $1$），域大小设置为 $r_{\\max} = r_{\\max}^{\\mathrm{pre}}$。\n        -   如果 $r_{\\max}^{\\mathrm{pre}}  r_{\\mathrm{cap}}$：所需域太大。需要一种不同的数值技术。我们切换到吸收边界条件（代码 $2$），并在实际限制处截断域，即 $r_{\\max} = r_{\\mathrm{cap}}$。\n\n4.  **常数与参数**：\n    实现将使用以下固定值：\n    -   $\\mu c^2 = 469.459\\ \\mathrm{MeV}$\n    -   $\\hbar c = 197.3269804\\ \\mathrm{MeV\\ fm}$\n    -   $e^2 = 1.439964\\ \\mathrm{MeV\\ fm}$\n    -   $\\varepsilon = 0.05$\n    -   $N_{\\lambda} = 3$\n    -   $\\tau = 10^{-6}$\n    -   $r_{\\mathrm{cap}} = 60\\ \\mathrm{fm}$\n\n现在将实施这个基于原理的详细逻辑来处理指定的测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Selects a boundary condition and estimates the radial domain size for a\n    two-body Schrödinger boundary value problem.\n    \"\"\"\n    # Define physical constants and design parameters\n    MU_C2 = 469.459  # Reduced mass equivalent in MeV\n    HBAR_C = 197.3269804  # h-bar * c in MeV fm\n    E2 = 1.439964  # Coulomb constant e^2 in MeV fm\n    EPSILON = 0.05  # Potential smallness threshold (dimensionless)\n    N_LAMBDA = 3.0  # Wavelength buffer multiplier\n    TAU = 1e-6  # Bound-state tail tolerance (dimensionless)\n    R_CAP = 60.0  # Maximum practical domain in fm\n\n    # Test cases: tuples of (Z, l, E)\n    # Z: product of charges (dimensionless integer)\n    # l: orbital angular momentum (dimensionless integer)\n    # E: center-of-mass energy (MeV)\n    test_cases = [\n        (0, 0, 10.0),\n        (1, 0, 5.0),\n        (40, 0, 5.0),\n        (0, 2, 10.0),\n        (0, 0, -2.0),\n        (1, 1, -0.5),\n        (0, 0, 1.0e-4),\n    ]\n\n    results = []\n    for case in test_cases:\n        Z, l, E = case\n        bc_code = 0\n        r_max = 0.0\n\n        if E = 0:\n            # Bound-like state logic\n            abs_E = abs(E)\n            \n            # A production-grade code would need special handling for E=0.\n            # Based on the test cases, we can assume E is never exactly 0.\n            if abs_E == 0:\n                pass\n\n            # Calculate the asymptotic radius r_asym\n            r_C = 0.0\n            if Z != 0:\n                r_C = abs(Z) * E2 / (EPSILON * abs_E)\n            \n            r_L = 0.0\n            if l > 0:\n                r_L = np.sqrt((HBAR_C**2 * l * (l + 1)) / (2 * MU_C2 * EPSILON * abs_E))\n\n            r_asym = max(r_C, r_L)\n\n            # Calculate the decay radius r_tau\n            kappa = np.sqrt(2 * MU_C2 * abs_E) / HBAR_C\n            r_tau = np.log(1.0 / TAU) / kappa\n\n            # r_max is the larger of the two required radii\n            r_max = max(r_asym, r_tau)\n\n            # Select boundary condition code\n            bc_code = 1 if Z != 0 else 0\n\n        else:  # E > 0\n            # Scattering state logic\n            \n            # Calculate the asymptotic radius r_asym\n            r_C = 0.0\n            if Z != 0:\n                r_C = abs(Z) * E2 / (EPSILON * E)\n            \n            r_L = 0.0\n            if l > 0:\n                r_L = np.sqrt((HBAR_C**2 * l * (l + 1)) / (2 * MU_C2 * EPSILON * E))\n            \n            r_asym = max(r_C, r_L)\n\n            # Calculate the wavelength buffer radius r_k\n            k = np.sqrt(2 * MU_C2 * E) / HBAR_C\n            r_k = N_LAMBDA * 2 * np.pi / k\n            \n            r_max_pre = max(r_asym, r_k)\n\n            # Compare with the practical domain cap\n            if r_max_pre = R_CAP:\n                r_max = r_max_pre\n                bc_code = 1 if Z != 0 else 0\n            else:\n                r_max = R_CAP\n                bc_code = 2  # Absorbing boundary condition\n\n        results.append([bc_code, round(r_max, 3)])\n\n    # Format the output string exactly as required\n    formatted_results = [f\"[{res[0]},{res[1]:.3f}]\" for res in results]\n    output_string = f\"[{','.join(formatted_results)}]\"\n    print(output_string)\n\nsolve()\n```"
        }
    ]
}