{
    "hands_on_practices": [
        {
            "introduction": "第一个练习是瑞利-里兹方法的一个直接的解析应用。通过在一个截断的二能级基中计算简谐振子的变分基态能量，你将具体地理解该方法如何为真实能量提供一个上限。这个实践巩固了在有限维子空间中最小化瑞利商的核心概念 。",
            "id": "3610839",
            "problem": "在计算核物理中，一个自伴哈密顿量 $h$ 的基态能量的变分表征由瑞利商 $R[\\psi] = \\langle \\psi | h | \\psi \\rangle / \\langle \\psi | \\psi \\rangle$ 给出，而瑞利-里兹 (RR) 方法通过在一个有限维子空间上最小化 $R[\\psi]$ 来近似基态。考虑一个在一维笛卡尔坐标下的单体哈密顿量，\n$$\nh = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\omega^{2} x^{2},\n$$\n其中质量为 $m$，用于构建谐振子 (HO) 基的参考频率参数为 $\\Omega$，而定义 $h$ 的物理频率为 $\\omega$。令 $\\{ \\phi_{0}(x;\\Omega), \\phi_{1}(x;\\Omega) \\}$ 表示参考哈密顿量\n$$\nh_{\\Omega} = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\Omega^{2} x^{2}\n$$\n的前两个归一化谐振子本征函数。仅使用正则对易关系 $[x,p] = i \\hbar$ 以及 $h_{\\Omega}$ 的谐振子基态的正交归一性和升降算符结构，构建 $h$ 在由 $\\{ \\phi_{0}, \\phi_{1} \\}$ 张成的子空间中的 $2 \\times 2$ 矩阵表示，并确定该子空间上的最小瑞利商，即投影哈密顿量的最小本征值。$h$ 的精确基态能量为 $E_{0} = \\frac{1}{2} \\hbar \\omega$。请以相对误差的形式提供您的比较结果\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}},\n$$\n其中 $E_{\\mathrm{var}}$ 是在指定子空间中的最小瑞利商。请用一个关于 $\\Omega$ 和 $\\omega$ 的单一闭合形式解析表达式来表达您的最终答案。不需要进行数值取整，并且由于该量是无量纲的，因此无需报告单位。",
            "solution": "问题陈述已经过仔细审查，并被确定是有效的。其科学基础是量子力学原理，特别是谐振子和瑞利-里兹变分法。该问题提法恰当、客观，并包含得出唯一解所需的所有信息。\n\n任务是：在一个双态试探空间内，为谐振子哈密顿量 $h$ 找到能量最低的变分近似 $E_{\\mathrm{var}}$，然后计算其相对于精确基态能量 $E_0$ 的相对误差。\n\n该物理系统的哈密顿量由下式给出：\n$$\nh = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\omega^{2} x^{2}\n$$\n变分子空间由参考谐振子哈密顿量 $h_{\\Omega}$ 的前两个正交归一的本征函数 $\\{ \\phi_{0}, \\phi_{1} \\}$ 张成：\n$$\nh_{\\Omega} = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\Omega^{2} x^{2}\n$$\n本征函数 $\\phi_n \\equiv \\phi_n(x; \\Omega)$ 满足 $h_{\\Omega} \\phi_n = E_n^{(\\Omega)} \\phi_n$，其本征值为 $E_n^{(\\Omega)} = (n + \\frac{1}{2})\\hbar\\Omega$。\n\n瑞利-里兹方法要求我们构建哈密顿量 $h$ 在基 $\\{ \\phi_{0}, \\phi_{1} \\}$ 中的矩阵表示，并找到其最低本征值。该本征值对应于最小瑞利商 $E_{\\mathrm{var}}$。矩阵元为 $H_{ij} = \\langle \\phi_i | h | \\phi_j \\rangle$。\n\n为简化矩阵元的计算，我们可以用 $h_{\\Omega}$ 来表示 $h$：\n$$\nh = h_{\\Omega} - \\frac{1}{2} m \\Omega^{2} x^{2} + \\frac{1}{2} m \\omega^{2} x^{2} = h_{\\Omega} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) x^{2}\n$$\n因此，矩阵元为：\n$$\nH_{ij} = \\langle \\phi_i | h_{\\Omega} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) x^{2} | \\phi_j \\rangle\n$$\n利用 $\\phi_j$ 是 $h_{\\Omega}$ 的本征函数以及基是正交归一的（$\\langle \\phi_i | \\phi_j \\rangle = \\delta_{ij}$）这一事实：\n$$\nH_{ij} = \\langle \\phi_i | E_j^{(\\Omega)} | \\phi_j \\rangle + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_i | x^{2} | \\phi_j \\rangle\n$$\n$$\nH_{ij} = E_j^{(\\Omega)} \\delta_{ij} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_i | x^{2} | \\phi_j \\rangle\n$$\n谐振子的本征函数具有确定的宇称：$\\phi_n(-x) = (-1)^n \\phi_n(x)$。因此，$\\phi_0$ 是偶函数，$\\phi_1$ 是奇函数。算符 $x^2$ 是偶算符，因为 $x^2 = (-x)^2$。矩阵元 $\\langle \\phi_i | x^2 | \\phi_j \\rangle$ 涉及形式为 $\\int \\phi_i^*(x) x^2 \\phi_j(x) dx$ 的积分。对于非对角元 ($i \\neq j$)，被积函数是一个偶函数 ($\\phi_0$)、一个偶函数 ($x^2$) 和一个奇函数 ($\\phi_1$) 的乘积。整个被积函数是奇函数，其在对称区间 $(-\\infty, \\infty)$ 上的积分为零。\n因此，$\\langle \\phi_0 | x^{2} | \\phi_1 \\rangle = 0$ 且 $\\langle \\phi_1 | x^{2} | \\phi_0 \\rangle = 0$。\n这意味着 $h$ 在此基中的矩阵表示是对角的：\n$$\nH = \\begin{pmatrix} H_{00} & 0 \\\\ 0 & H_{11} \\end{pmatrix}\n$$\n本征值就是对角元 $H_{00}$ 和 $H_{11}$。我们现在必须计算这些元。这需要期望值 $\\langle \\phi_0 | x^2 | \\phi_0 \\rangle$ 和 $\\langle \\phi_1 | x^2 | \\phi_1 \\rangle$。我们使用参考哈密顿量 $h_{\\Omega}$ 的升降算符形式。位置算符 $x$ 用湮灭算符 ($a$) 和产生算符 ($a^{\\dagger}$) 表示：\n$$\nx = \\sqrt{\\frac{\\hbar}{2 m \\Omega}}(a + a^{\\dagger})\n$$\n平方后得到：\n$$\nx^{2} = \\frac{\\hbar}{2 m \\Omega} (a + a^{\\dagger})^{2} = \\frac{\\hbar}{2 m \\Omega} (a^2 + (a^{\\dagger})^2 + a a^{\\dagger} + a^{\\dagger} a)\n$$\n使用对易关系 $[a, a^{\\dagger}] = 1$，我们可以写出 $a a^{\\dagger} = a^{\\dagger} a + 1$。数算符为 $N = a^{\\dagger} a$。\n$$\nx^{2} = \\frac{\\hbar}{2 m \\Omega} (a^2 + (a^{\\dagger})^2 + 2N + 1)\n$$\n我们现在计算期望值。注意，由于正交性，$\\langle \\phi_n | a^2 | \\phi_n \\rangle = 0$ 和 $\\langle \\phi_n | (a^{\\dagger})^2 | \\phi_n \\rangle = 0$。\n对于态 $\\phi_0$ ($n=0$)：\n$$\n\\langle \\phi_0 | x^2 | \\phi_0 \\rangle = \\frac{\\hbar}{2 m \\Omega} \\langle \\phi_0 | 2N + 1 | \\phi_0 \\rangle = \\frac{\\hbar}{2 m \\Omega} (2(0) + 1) = \\frac{\\hbar}{2 m \\Omega}\n$$\n对于态 $\\phi_1$ ($n=1$)：\n$$\n\\langle \\phi_1 | x^2 | \\phi_1 \\rangle = \\frac{\\hbar}{2 m \\Omega} \\langle \\phi_1 | 2N + 1 | \\phi_1 \\rangle = \\frac{\\hbar}{2 m \\Omega} (2(1) + 1) = \\frac{3\\hbar}{2 m \\Omega}\n$$\n现在我们可以构建 $H$ 的对角矩阵元：\n$$\nH_{00} = E_0^{(\\Omega)} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_0 | x^{2} | \\phi_0 \\rangle = \\frac{1}{2}\\hbar\\Omega + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\frac{\\hbar}{2 m \\Omega}\n$$\n$$\nH_{00} = \\frac{1}{2}\\hbar\\Omega + \\frac{\\hbar(\\omega^{2} - \\Omega^{2})}{4\\Omega} = \\frac{\\hbar}{4\\Omega} [2\\Omega^2 + \\omega^2 - \\Omega^2] = \\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n对于 $H_{11}$：\n$$\nH_{11} = E_1^{(\\Omega)} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_1 | x^{2} | \\phi_1 \\rangle = \\frac{3}{2}\\hbar\\Omega + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\frac{3\\hbar}{2 m \\Omega}\n$$\n$$\nH_{11} = \\frac{3}{2}\\hbar\\Omega + \\frac{3\\hbar(\\omega^{2} - \\Omega^{2})}{4\\Omega} = \\frac{3\\hbar}{4\\Omega} [2\\Omega^2 + \\omega^2 - \\Omega^2] = \\frac{3\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n投影哈密顿量的本征值为 $H_{00}$ 和 $H_{11}$。最小瑞利商 $E_{\\mathrm{var}}$ 是这两个值的最小值。由于 $\\hbar, \\Omega, \\omega^2, \\Omega^2$ 均为正值，所以 $H_{00} < H_{11}$。\n因此：\n$$\nE_{\\mathrm{var}} = H_{00} = \\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n物理哈密顿量 $h$ 的精确基态能量为 $E_0 = \\frac{1}{2} \\hbar \\omega$。我们需要计算相对误差：\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}} = \\frac{E_{\\mathrm{var}}}{E_{0}} - 1\n$$\n代入 $E_{\\mathrm{var}}$ 和 $E_0$ 的表达式：\n$$\n\\frac{E_{\\mathrm{var}}}{E_{0}} = \\frac{\\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)}{\\frac{1}{2}\\hbar\\omega} = \\frac{\\Omega^2 + \\omega^2}{2\\Omega\\omega}\n$$\n于是相对误差为：\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}} = \\frac{\\Omega^2 + \\omega^2}{2\\Omega\\omega} - 1 = \\frac{\\Omega^2 + \\omega^2 - 2\\Omega\\omega}{2\\Omega\\omega} = \\frac{(\\Omega - \\omega)^2}{2\\Omega\\omega}\n$$\n此结果与变分定理一致，该定理保证 $E_{\\mathrm{var}} \\ge E_0$，因为该表达式始终为非负。只有当 $\\Omega = \\omega$ 时误差为零，此时基态 $\\phi_0(x; \\Omega)$ 与 $h$ 的真实基态完全相同。",
            "answer": "$$\n\\boxed{\\frac{(\\Omega - \\omega)^2}{2\\Omega\\omega}}\n$$"
        },
        {
            "introduction": "从解析模型到实际计算，这个练习将挑战你为一个双核子系统实现一个完整的组态相互作用计算。这个综合性问题要求构建多体算符，并处理基截断带来的影响，例如伪质心运动。你将学习如何诊断和过滤这些非物理态，这是实际原子核结构计算中的一项关键技能 。",
            "id": "3610851",
            "problem": "您将为一个一维空间中的双核子系统实现一个完整的瑞利-里兹变分计算，以诊断和变分地过滤在截断的组态相互作用（CI）空间中的质心污染。您的实现必须是一个单一的可运行程序，该程序构建多体哈密顿量，计算其最低本征态，为每个本征态评估质心哈密顿量的期望值，并通过用质心惩罚项增强哈密顿量来应用变分过滤器。所有步骤都必须从第一性原理出发，不得使用简化推导过程的闭合形式矩阵元。\n\n物理模型如下。考虑两个质量为 $m$ 的可区分核子在一维空间中运动。采用自然单位制，其中约化普朗克常数 $\\hbar = 1$，质量 $m = 1$。单粒子囚禁场是一个角频率为 $\\omega > 0$ 的谐振子。两体相互作用是平移不变的，仅依赖于相对坐标，取为强度为 $V_0$、范围为 $a > 0$ 的有限程高斯势：\n$$\nV(x_1, x_2) = V_0 \\exp\\!\\left(-\\frac{(x_1 - x_2)^2}{2 a^2}\\right).\n$$\n完整的两体哈密顿量为\n$$\nH = \\sum_{i=1}^2 \\left(\\frac{p_i^2}{2 m} + \\frac{1}{2} m \\omega^2 x_i^2\\right) + V(x_1, x_2),\n$$\n在所有数值结果中均使用 $\\hbar = 1$ 和 $m = 1$。对于 $A=2$ 个粒子，一维质心（CM）哈密顿量为\n$$\nH_{\\mathrm{cm}} = \\frac{P_{\\mathrm{cm}}^2}{2 A m} + \\frac{1}{2} A m \\omega^2 R_{\\mathrm{cm}}^2 - \\frac{1}{2}\\,\\hbar\\omega,\n$$\n其中 $A = 2$，$R_{\\mathrm{cm}} = \\frac{x_1 + x_2}{2}$，以及 $P_{\\mathrm{cm}} = p_1 + p_2$。减去 $\\frac{1}{2}\\,\\hbar\\omega$ 项是为了将基态 $0S$ 质心模式的期望值设为零。在具有平移不变相互作用的精确（未截断）计算中，任何具有质心基态分量的本征态都满足 $\\langle H_{\\mathrm{cm}} \\rangle = 0$，而伪质心激发则会产生 $\\langle H_{\\mathrm{cm}} \\rangle \\approx n_{\\mathrm{cm}} \\,\\hbar\\omega$，其中 $n_{\\mathrm{cm}} \\ge 1$ 为整数。在截断的CI空间中，伪混合会导致那些本应没有质心激发的态出现非零的 $\\langle H_{\\mathrm{cm}} \\rangle$。\n\n您的计算任务是在截断的CI空间中执行瑞利-里兹计算，并量化和过滤质心污染。\n\n1. 基矢和截断。使用一维谐振子单粒子本征函数 $\\{\\varphi_n(x)\\}_{n=0}^{n_{\\max}}$ 作为每个粒子的有限基矢，振子长度为 $b = \\sqrt{\\hbar/(m\\omega)}$。双体CI基矢是直积基矢 $\\{\\varphi_{n_1}(x_1)\\varphi_{n_2}(x_2)\\}$，其中 $0 \\le n_1, n_2 \\le n_{\\max}$，这构成了由单粒子最大量子数 $n_{\\max}$ 决定的截断。这种截断不强制要求总量子数固定，因此破坏了内禀运动和质心运动的精确分解，从而使伪污染得以出现。\n\n2. 变分原理和瑞利-里兹方法。从定态薛定谔方程和瑞利商出发\n$$\n\\mathcal{E}[\\psi] = \\frac{\\langle \\psi| H | \\psi\\rangle}{\\langle \\psi|\\psi\\rangle},\n$$\n通过在截断的CI基矢中展开试验态 $|\\psi\\rangle$ 并对角化哈密顿量矩阵来应用瑞利-里兹方法，以获得近似的本征值和本征向量。\n\n3. 算符构造。使用正则对易关系和升降算符构造单粒子位置和动量算符，\n$$\nx = \\sqrt{\\frac{\\hbar}{2 m \\omega}}\\,(a + a^\\dagger),\\qquad p = \\mathrm{i}\\sqrt{\\frac{m\\hbar\\omega}{2}}\\,(a^\\dagger - a),\n$$\n然后在截断的单粒子基矢中通过矩阵乘法形成 $x^2$ 和 $p^2$ 矩阵。通过克罗内克积组装双体算符，以在CI基矢上形成 $H$ 的单体部分。对于双体高斯相互作用，不要使用闭合形式的矩阵元。相反，应数值计算矩阵元\n$$\n\\langle n_1 n_2 | V | n_1' n_2' \\rangle = \\int_{-\\infty}^{\\infty}\\!\\!\\int_{-\\infty}^{\\infty} \\varphi_{n_1}(x_1)\\varphi_{n_2}(x_2) V(x_1-x_2) \\varphi_{n_1'}(x_1)\\varphi_{n_2'}(x_2)\\, \\mathrm{d}x_1 \\mathrm{d}x_2\n$$\n使用高斯-埃尔米特求积法，并采用足够数量的求积点，以在所提供的测试用例中获得稳定的结果。您可以利用 $\\varphi_n$ 的多项式-高斯结构，使用高斯-埃尔米特积分规则来对形如 $e^{-y^2}$ 乘以一个平滑函数的形式进行积分，注意对于一般的 $\\omega$ 要使用正确的振子长度标度。\n\n4. 质心哈密顿量。在不变换到相对坐标和质心坐标的情况下，在CI基矢上用单粒子算符 $x_1, x_2, p_1, p_2$ 推导并实现 $H_{\\mathrm{cm}}$。然后为每个CI本征态计算 $\\langle H_{\\mathrm{cm}} \\rangle$ 作为伪污染的诊断指标。\n\n5. 变分过滤（Lawson方法）。定义惩罚哈密顿量\n$$\nH_\\beta = H + \\beta\\, H_{\\mathrm{cm}},\n$$\n其中惩罚参数 $\\beta \\ge 0$。对角化 $H_\\beta$ 以获得最低的几个本征态。使用一个阈值 $\\tau > 0$，在最低的 $k$ 个本征态中，过滤掉任何满足 $\\langle H_{\\mathrm{cm}} \\rangle > \\tau$ 的态，其中 $k$ 由每个测试用例指定。\n\n实现要求：\n- 采用 $\\hbar = 1$ 和 $m = 1$ 的单位制，因此所有能量单位为 $\\omega$，长度单位为 $b = \\sqrt{1/\\omega}$。\n- 不涉及角度，因此不需要角度单位。\n- 您的程序必须为每个测试用例生成一个整数计数，该计数是在 $H_\\beta$ 的最低 $k$ 个本征态中，其质心期望值满足 $\\langle H_{\\mathrm{cm}} \\rangle \\le \\tau$ 的态的数量。将所有测试用例的这些计数汇总到如下所述的单行输出中。\n\n测试套件。在以下参数集上运行您的程序，每个参数集指定为一个元组 $\\left(n_{\\max}, \\omega, V_0, a, k, \\tau, \\beta\\right)$：\n- 情况 1：$\\left(4,\\, 1.0,\\, -0.6,\\, 0.8,\\, 6,\\, 0.02,\\, 0.0\\right)$\n- 情况 2：$\\left(4,\\, 1.0,\\, -0.6,\\, 0.8,\\, 6,\\, 0.02,\\, 10.0\\right)$\n- 情况 3：$\\left(3,\\, 1.2,\\, -0.6,\\, 0.5,\\, 6,\\, 0.02,\\, 10.0\\right)$\n\n最终输出格式。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来。对于上述三种情况，输出必须是以下形式\n$$\n[\\text{count}_1,\\text{count}_2,\\text{count}_3],\n$$\n其中每个 $\\text{count}_i$ 是如上定义的整数。不应打印任何其他文本。所有数值计算都必须由您的代码执行；不要硬编码期望值。",
            "solution": "用户提供的问题是计算量子物理学中一个有效的练习。它要求在截断的组态相互作用（CI）空间内为一个双核子系统实现瑞利-里兹变分计算。该问题在科学上基于量子力学和数值方法的原理，特别是壳模型和变分技术。该问题定义明确，提供了所有必要的参数、物理模型定义以及清晰的计算目标。指定的使用升降算符从第一性原理构建算符以及使用数值求积法计算矩阵元的方法，是该领域中一个标准且具有指导意义的方法。包含了质心污染诊断和Lawson过滤方法，使其真实地再现了核结构理论中的挑战。问题中没有矛盾、歧义或科学上不成立的前提。\n\n解决方案的步骤如下：\n首先，对于每个测试用例，我们定义模型的参数：单粒子基矢截断 $n_{\\max}$、谐振子频率 $\\omega$、相互作用强度 $V_0$ 和范围 $a$，以及Lawson过滤方法的参数 $k, \\tau, \\beta$。我们在自然单位制中工作，其中 $\\hbar=1$，核子质量 $m=1$。\n\n单粒子基矢由一维量子谐振子（QHO）的本征态 $\\{|n\\rangle\\}$ 组成，并在 $n=n_{\\max}$ 处截断。这个单粒子空间的维度是 $N_{sp} = n_{\\max}+1$。\n\n在这个截断的基矢中构造单粒子位置算符 $x$ 和动量算符 $p$。我们从升降算符 $a$ 和 $a^\\dagger$ 的矩阵表示开始，它们通过对基矢态的作用来定义：$\\langle n' | a | n \\rangle = \\sqrt{n}\\,\\delta_{n',n-1}$ 和 $\\langle n' | a^\\dagger | n \\rangle = \\sqrt{n+1}\\,\\delta_{n',n+1}$。然后使用它们在 $a$ 和 $a^\\dagger$ 方面的标准定义来形成 $x$ 和 $p$ 矩阵：\n$$\nx = \\sqrt{\\frac{1}{2 \\omega}}\\,(a + a^\\dagger),\\qquad p = \\mathrm{i}\\sqrt{\\frac{\\omega}{2}}\\,(a^\\dagger - a)\n$$\n$x^2$ 和 $p^2$ 的矩阵分别通过 $x$ 和 $p$ 矩阵的矩阵乘法得到。需要注意的是，由于基矢截断，正则对易关系 $[x,p]=i$ 并未被完美满足，这是该方法预期的产物。\n\n双体CI基矢是单粒子基矢的直积：$\\{|n_1 n_2\\rangle = |n_1\\rangle \\otimes |n_2\\rangle\\}$，其中 $0 \\le n_1, n_2 \\le n_{\\max}$。这个双体空间的维度是 $N_{basis} = N_{sp}^2$。双体算符由单粒子算符的克罗内克积构造而成。例如，$x_1$ 由 $x \\otimes I$ 表示，$x_2$ 由 $I \\otimes x$ 表示，其中 $I$ 是单粒子空间中的单位矩阵。\n\n在双体基矢中构造完整的哈密顿量 $H = H_{1-body} + V$。表示动能和谐振子囚禁的单体部分，由单粒子哈密顿量矩阵 $h = p^2/2 + \\omega^2 x^2/2$ 构造成 $H_{1-body} = h \\otimes I + I \\otimes h$。\n\n双体高斯相互作用的矩阵元 $\\langle n_1 n_2 | V | n_1' n_2' \\rangle$ 按照要求使用高斯-埃尔米特求积法进行数值计算。积分被变换到无量纲坐标 $y_i = x_i/b$，其中 $b=\\sqrt{1/\\omega}$ 是振子长度。由QHO波函数产生的因子 $e^{-y_1^2-y_2^2}$ 被吸收到求积权重中，剩余的平滑函数在求积点上进行求值。使用足够多的求积点以确保数值稳定性和准确性。\n\n质心哈密顿量 $H_{cm}$ 也在双体基矢中由单粒子算符根据其定义构造：\n$$\nH_{\\mathrm{cm}} = \\frac{P_{\\mathrm{cm}}^2}{4} + \\omega^2 R_{\\mathrm{cm}}^2 - \\frac{\\hbar\\omega}{2}\n$$\n其中 $R_{cm} = (x_1+x_2)/2$ 和 $P_{cm} = p_1+p_2$。\n\n通过构建惩罚哈密顿量 $H_\\beta = H + \\beta H_{cm}$ 来实现Lawson方法。对该矩阵进行对角化，以找到其本征值和本征向量。根据瑞利-里兹方法，本征向量代表了系统的近似本征态。\n\n最后，对于从对角化 $H_\\beta$ 得到的 $k$ 个能量最低的本征态中的每一个，我们计算原始质心哈密顿量的期望值 $\\langle H_{cm} \\rangle$。然后我们统计这 $k$ 个态中有多少满足条件 $\\langle H_{cm} \\rangle \\le \\tau$。这个计数就是一个测试用例的结果。对测试套件中提供的所有用例重复此过程。",
            "answer": "```python\n# language: Python\n# version: 3.12\n# libraries:\n#   name: numpy\n#   version: 1.23.5\n#   name: scipy\n#   version: 1.11.4\n\nimport numpy as np\nfrom scipy.special import roots_hermite, eval_hermite\nfrom scipy.linalg import eigh\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases.\n    It implements the Rayleigh-Ritz method for a two-nucleon system in a \n    truncated harmonic oscillator basis, including diagnostics and filtering \n    of center-of-mass excitations.\n    \"\"\"\n    \n    test_cases = [\n        # (n_max, omega, V0, a, k, tau, beta)\n        (4, 1.0, -0.6, 0.8, 6, 0.02, 0.0),\n        (4, 1.0, -0.6, 0.8, 6, 0.02, 10.0),\n        (3, 1.2, -0.6, 0.5, 6, 0.02, 10.0),\n    ]\n\n    results = []\n    N_quad = 60\n    yq, wq = roots_hermite(N_quad)\n\n    for case in test_cases:\n        n_max, omega, V0, a, k, tau, beta = case\n        \n        N_sp = n_max + 1\n        N_basis = N_sp ** 2\n        hbar = 1.0\n        m = 1.0\n        b = np.sqrt(hbar / (m * omega))\n\n        a_op = np.zeros((N_sp, N_sp), dtype=float)\n        for n in range(1, N_sp):\n            a_op[n - 1, n] = np.sqrt(n)\n        adag_op = a_op.T\n        \n        x_sp = np.sqrt(hbar / (2 * m * omega)) * (a_op + adag_op)\n        p_sp = 1j * np.sqrt(m * hbar * omega / 2) * (adag_op - a_op)\n        \n        I_sp = np.identity(N_sp)\n        \n        X1 = np.kron(x_sp, I_sp)\n        X2 = np.kron(I_sp, x_sp)\n        P1 = np.kron(p_sp, I_sp)\n        P2 = np.kron(I_sp, p_sp)\n        \n        p2_sp = p_sp @ p_sp\n        x2_sp = x_sp @ x_sp\n        h_sp = (1 / (2 * m)) * p2_sp + (m * omega**2 / 2) * x2_sp\n        H_1body = np.kron(h_sp, I_sp) + np.kron(I_sp, h_sp)\n        \n        fact = [math.factorial(i) for i in range(2 * n_max + 2)]\n        hermite_vals = np.zeros((N_sp, N_quad))\n        for n in range(N_sp):\n            hermite_vals[n, :] = eval_hermite(n, yq)\n            \n        psi_poly_parts = np.zeros((N_sp, N_quad))\n        for n in range(N_sp):\n            norm = 1.0 / np.sqrt(np.sqrt(np.pi) * (2**n) * fact[n])\n            psi_poly_parts[n, :] = norm * hermite_vals[n, :]\n            \n        V_mat = np.zeros((N_basis, N_basis))\n\n        def get_n_tuple(idx, n_sp_dim):\n            return idx // n_sp_dim, idx % n_sp_dim\n\n        for i in range(N_basis):\n            for j in range(i, N_basis):\n                n1, n2 = get_n_tuple(i, N_sp)\n                n1p, n2p = get_n_tuple(j, N_sp)\n\n                term_y1 = psi_poly_parts[n1, :] * psi_poly_parts[n1p, :]\n                term_y2 = psi_poly_parts[n2, :] * psi_poly_parts[n2p, :]\n                poly_part = np.outer(term_y1, term_y2)\n                \n                y1_grid, y2_grid = np.meshgrid(yq, yq)\n                exp_arg = -b**2 * (y1_grid - y2_grid)**2 / (2 * a**2)\n                interaction_part = V0 * np.exp(exp_arg)\n                \n                integrand = poly_part * interaction_part\n                integral = np.einsum('i,j,ij->', wq, wq, integrand)\n                \n                V_mat[i, j] = integral\n                if i != j:\n                    V_mat[j, i] = integral\n\n        H_mat = np.real(H_1body + V_mat)\n\n        A = 2.0\n        I_basis = np.identity(N_basis)\n        R_cm_op = (X1 + X2) / A\n        P_cm_op = P1 + P2\n        \n        H_cm_mat = (1 / (2 * A * m)) * (P_cm_op @ P_cm_op) + \\\n                   (A * m * omega**2 / 2) * (R_cm_op @ R_cm_op) - \\\n                   0.5 * hbar * omega * I_basis\n        H_cm_mat = np.real(H_cm_mat)\n\n        H_beta_mat = H_mat + beta * H_cm_mat\n        eigenvalues, eigenvectors = eigh(H_beta_mat)\n        \n        count = 0\n        num_states_to_check = min(k, N_basis)\n        for i in range(num_states_to_check):\n            eigenvector = eigenvectors[:, i]\n            h_cm_exp_val = eigenvector.T.conj() @ H_cm_mat @ eigenvector\n            if np.abs(h_cm_exp_val) = tau:\n                count += 1\n        results.append(count)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "这个高级实践将变分原理从优化线性系数扩展到优化基函数本身。通过计算能量对非线性基参数的解析梯度，你将探索赫尔曼-费曼定理和普莱力的概念。这个练习为强大的变分优化技术奠定了基础，这些技术旨在寻找描述量子系统的最佳可能基组 。",
            "id": "3610859",
            "problem": "考虑一个一维非相对论粒子，采用自然单位制，其中 $\\hbar=1$ 且 $m=1$。物理哈密顿量 $H_{\\mathrm{phys}}(b)$ 定义为 $H_{\\mathrm{phys}}(b)=T+V(b)$，其中 $T=-\\frac{1}{2}\\frac{d^2}{dx^2}$，$V(b)=\\frac{1}{2}\\omega(b)^2 x^2$，且 $\\omega(b)=b$。设试验态 $|\\psi(b)\\rangle$ 是通过 Rayleigh-Ritz 方法（变分近似）使用非正交高斯基组 $\\{\\phi_i(x;b)\\}_{i=0}^{N-1}$ 得到的，其中 $\\phi_i(x;b)=\\exp\\!\\big(-\\alpha_i(b)x^2\\big)$ 且 $\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$。这里，$N$ 是基函数数量，$\\alpha_0$ 是一个正常数标度，$r1$ 是一个几何比率，$b0$ 是变分长度参数。对于这个非正交基组，Rayleigh-Ritz 广义特征值问题 (GEP) 为 $H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$，其中 $H_{ij}(b)=\\langle \\phi_i(b)|H_{\\mathrm{phys}}(b)|\\phi_j(b)\\rangle$，$S_{ij}(b)=\\langle \\phi_i(b)|\\phi_j(b)\\rangle$，而 $\\mathbf{c}$ 是近似基态 $|\\psi(b)\\rangle = \\sum_i c_i |\\phi_i(b)\\rangle$ 的系数向量。在这些单位中，所有能量和 $b$ 都是无量纲的。\n\n您的任务是在给定的 $(N,\\alpha_0,r,b)$ 下，通过将其分解为 Hellmann–Feynman (HF) 贡献和 Pulay 贡献来计算解析梯度 $dE/db$，并通过有限差分法验证数值一致性。具体来说：\n\n- Rayleigh-Ritz 能量是在 GEP $H(b)\\mathbf{c}=E(b)S(b)\\mathbf{c}$ 的定态解处的 Rayleigh 商 $E(b) = \\dfrac{\\mathbf{c}^\\top H(b)\\mathbf{c}}{\\mathbf{c}^\\top S(b)\\mathbf{c}}$。\n- Hellmann–Feynman (HF) 贡献定义为在固定基函数下，物理哈密顿量对 $b$ 的显式导数的期望值，$E_{\\mathrm{HF}}(b)=\\mathbf{c}^\\top\\big(\\partial H_{\\mathrm{phys}}(b)/\\partial b\\big)_{\\mathrm{proj}}\\mathbf{c}$，其中下标 \"proj\" 表示矩阵元是在固定基组 $\\{\\phi_i(x;b)\\}$ 中计算的，而不对基函数本身求导。\n- Pulay 贡献定义为 $E_{\\mathrm{Pulay}}(b)=\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b)$，其中 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 是从应用于非正交基组和广义归一化约束的变分原理得到的解析导数。\n- 数值上验证 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 与中心有限差分近似 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}} \\approx \\dfrac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon}$ 在小步长 $\\varepsilon0$ 下是一致的。\n\n所有矩阵元必须通过高斯积分精确计算。对于由 $\\alpha_i(b)$ 和 $\\alpha_j(b)$ 表征的高斯函数对，定义 $\\gamma_{ij}(b)=\\alpha_i(b)+\\alpha_j(b)$ 并使用以下积分事实（将在解答中推导）：\n\n- $S_{ij}(b) = \\displaystyle \\int_{-\\infty}^{\\infty} e^{-\\gamma_{ij}(b)x^2}\\,dx = \\dfrac{\\sqrt{\\pi}}{\\sqrt{\\gamma_{ij}(b)}}$。\n- $T_{ij}(b) = \\displaystyle \\frac{1}{2}\\int_{-\\infty}^{\\infty}\\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx}\\,dx = \\dfrac{\\alpha_i(b)\\alpha_j(b)\\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}}$。\n- $V_{ij}(b) = \\displaystyle \\frac{1}{2}\\omega(b)^2 \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij}(b)x^2}\\,dx = \\dfrac{\\omega(b)^2 \\sqrt{\\pi}}{4\\,\\gamma_{ij}(b)^{3/2}}$。\n\n此外，您必须利用 $\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$ 和 $\\omega(b)=b$ 的依赖关系计算解析导数 $dS/db$ 和 $dH/db$，其中 $H=T+V$。Hellmann–Feynman 贡献仅包括在固定 $\\gamma_{ij}$ 下的显式导数 $\\partial V/\\partial b$。\n\n测试套件：\n提供以下参数集 $(N,\\alpha_0,r,b,\\varepsilon)$ 的结果：\n\n1. $(3,0.5,1.7,1.0,10^{-6})$。\n2. $(5,0.4,1.5,0.8,10^{-6})$。\n3. $(2,0.6,2.0,1.2,10^{-6})$。\n4. $(6,0.3,1.7,1.6,10^{-6})$。\n\n您的程序应：\n- 对每种情况求解广义特征值问题，以获得最低特征值 $E(b)$ 和满足 $\\mathbf{c}^\\top S(b)\\mathbf{c}=1$ 的相应 $S$-归一化特征向量 $\\mathbf{c}$。\n- 使用步长 $\\varepsilon$ 的中心差分法计算 $E_{\\mathrm{HF}}(b)$、$E_{\\mathrm{Pulay}}(b)$、总解析导数 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 以及有限差分导数 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}}$。\n- 对于每个测试用例，返回列表 $[E_{\\mathrm{HF}}(b),E_{\\mathrm{Pulay}}(b),\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}},\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}},|\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}-\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}}|]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由逗号分隔的列表的列表，并用方括号括起来；例如，输出应类似于 $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],\\ldots]$。所有量均为无量纲，并且必须以浮点数形式报告，不带单位。",
            "solution": "### 问题验证\n\n对问题陈述进行了严格的验证过程。\n\n#### 步骤 1：提取已知条件\n\n- **系统**：一维非相对论粒子。\n- **单位**：自然单位制，其中 $\\hbar=1$ 且 $m=1$。\n- **哈密顿量**：$H_{\\mathrm{phys}}(b)=T+V(b)$。\n- **动能算符**：$T=-\\frac{1}{2}\\frac{d^2}{dx^2}$。\n- **势能算符**：$V(b)=\\frac{1}{2}\\omega(b)^2 x^2$，且 $\\omega(b)=b$。\n- **试验态**：来自 Rayleigh-Ritz 方法的变分近似 $|\\psi(b)\\rangle = \\sum_i c_i |\\phi_i(b)\\rangle$。\n- **基组**：非正交高斯基组 $\\{\\phi_i(x;b)\\}_{i=0}^{N-1}$。\n- **基函数**：$\\phi_i(x;b)=\\exp(-\\alpha_i(b)x^2)$。\n- **基函数参数**：$\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$，其中 $N$ 是基函数数量，$\\alpha_0  0$ 是一个标度，$r1$ 是一个比率，$b0$ 是一个变分长度参数。\n- **广义特征值问题 (GEP)**：$H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$。\n- **矩阵元**：$H_{ij}(b)=\\langle \\phi_i(b)|H_{\\mathrm{phys}}(b)|\\phi_j(b)\\rangle$，$S_{ij}(b)=\\langle \\phi_i(b)|\\phi_j(b)\\rangle$。\n- **Rayleigh-Ritz 能量**：$E(b) = \\frac{\\mathbf{c}^\\top H(b)\\mathbf{c}}{\\mathbf{c}^\\top S(b)\\mathbf{c}}$。\n- **Hellmann–Feynman 贡献**：$E_{\\mathrm{HF}}(b)=\\mathbf{c}^\\top\\big(\\partial H_{\\mathrm{phys}}(b)/\\partial b\\big)_{\\mathrm{proj}}\\mathbf{c}$。\n- **Pulay 贡献**：$E_{\\mathrm{Pulay}}(b)=\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b)$。\n- **数值验证**：比较 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 与 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}} \\approx \\dfrac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon}$。\n- **积分公式**：\n    - $S_{ij}(b) = \\frac{\\sqrt{\\pi}}{\\sqrt{\\gamma_{ij}(b)}}$ 其中 $\\gamma_{ij}(b)=\\alpha_i(b)+\\alpha_j(b)$。\n    - $T_{ij}(b) = \\frac{\\alpha_i(b)\\alpha_j(b)\\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}}$。\n    - $V_{ij}(b) = \\frac{\\omega(b)^2 \\sqrt{\\pi}}{4\\,\\gamma_{ij}(b)^{3/2}}$。\n- **测试用例**：$(N,\\alpha_0,r,b,\\varepsilon)$ 分别为 $(3,0.5,1.7,1.0,10^{-6})$，$(5,0.4,1.5,0.8,10^{-6})$，$(2,0.6,2.0,1.2,10^{-6})$，$(6,0.3,1.7,1.6,10^{-6})$。\n- **所需输出**：对于每个测试用例，一个列表 $[E_{\\mathrm{HF}}(b), E_{\\mathrm{Pulay}}(b), \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}}, \\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}, |\\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}}-\\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}|]$。\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题是量子力学中变分原理的标准应用，是理论和计算物理的基石。参数依赖基组的使用、Hellmann-Feynman 定理以及 Pulay 力的概念在电子结构理论和计算核物理领域都是成熟完善的。哈密顿量描述了一个量子谐振子，这是一个基本的模型系统。该问题在科学上是合理的。\n- **良态性**：该问题是良态的。使用实对称矩阵 $H(b)$ 和正定交叠矩阵 $S(b)$ 的 GEP 保证了实数特征值和基态的稳定解。所有必要的参数和定义都已提供，以获得唯一的数值解。\n- **客观性**：该问题以精确的数学语言陈述，并要求定量的、可验证的结果。它没有歧义和主观性。\n- **完整性**：该问题是自洽的。它提供了所有必要的公式、参数和定义。\n- **一致性**：提供的积分公式是正确的，并且可以从标准高斯积分推导出来。定义在内部是一致的。\n\n#### 步骤 3：结论与行动\n\n问题陈述是 **有效的**。这是一个严谨且定义明确的计算物理任务，基于已建立的科学原理。我将继续进行解答。\n\n### 基于原理的解答设计\n\n解答要求计算通过 Rayleigh-Ritz 变分法获得的量子谐振子基态能量关于参数 $b$ 的导数，该参数同时出现在哈密顿量和基组中。\n\n#### 1. 矩阵元的推导\n\n矩阵元是通过计算高斯函数的积分来求得的。关键的标准积分是：\n$$ I_0(a) = \\int_{-\\infty}^{\\infty} e^{-ax^2}\\,dx = \\sqrt{\\frac{\\pi}{a}} $$\n$$ I_2(a) = \\int_{-\\infty}^{\\infty} x^2 e^{-ax^2}\\,dx = -\\frac{dI_0}{da} = \\frac{\\sqrt{\\pi}}{2a^{3/2}} $$\n令 $\\gamma_{ij}(b) = \\alpha_i(b) + \\alpha_j(b)$。矩阵元为：\n- **交叠矩阵 $S(b)$**：\n$$ S_{ij}(b) = \\langle\\phi_i|\\phi_j\\rangle = \\int_{-\\infty}^{\\infty} e^{-\\alpha_i x^2} e^{-\\alpha_j x^2}\\,dx = \\int_{-\\infty}^{\\infty} e^{-\\gamma_{ij} x^2}\\,dx = \\sqrt{\\frac{\\pi}{\\gamma_{ij}(b)}} $$\n- **势能矩阵 $V(b)$**：对于 $V(x,b) = \\frac{1}{2}b^2 x^2$：\n$$ V_{ij}(b) = \\langle\\phi_i|V|\\phi_j\\rangle = \\frac{1}{2}b^2 \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij} x^2}\\,dx = \\frac{1}{2}b^2 \\left(\\frac{\\sqrt{\\pi}}{2\\gamma_{ij}^{3/2}}\\right) = \\frac{b^2 \\sqrt{\\pi}}{4\\gamma_{ij}(b)^{3/2}} $$\n- **动能矩阵 $T$**：对 $\\langle\\phi_i|T|\\phi_j\\rangle = -\\frac{1}{2}\\int \\phi_i (d^2\\phi_j/dx^2) dx$ 使用分部积分法：\n$$ T_{ij}(b) = \\frac{1}{2} \\int_{-\\infty}^{\\infty} \\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx}\\,dx = \\frac{1}{2}\\int_{-\\infty}^{\\infty} (-2\\alpha_i x e^{-\\alpha_i x^2})(-2\\alpha_j x e^{-\\alpha_j x^2})\\,dx = 2\\alpha_i\\alpha_j \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij}x^2}\\,dx = 2\\alpha_i\\alpha_j \\left(\\frac{\\sqrt{\\pi}}{2\\gamma_{ij}^{3/2}}\\right) = \\frac{\\alpha_i\\alpha_j \\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}} $$\n这些推导证实了问题陈述中提供的公式。哈密顿矩阵为 $H(b) = T(b) + V(b)$。\n\n#### 2. 广义特征值问题 (GEP)\n对于一组给定的参数 $(N,\\alpha_0, r, b)$，我们构造 $N \\times N$ 矩阵 $S(b)$ 和 $H(b)$。求解 GEP $H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$ 以找到特征值 $E_k(b)$ 和相应的特征向量 $\\mathbf{c}_k$。最低的特征值是基态能量 $E(b)$。相关的特征向量 $\\mathbf{c}$ 被归一化，使得 $\\mathbf{c}^\\top S(b)\\mathbf{c} = 1$。\n\n#### 3. 能量的总解析导数\n对于依赖于参数 $b$ 的非正交基，Rayleigh 商在解点处的导数由广义 Hellmann-Feynman 定理给出：\n$$ \\frac{dE}{db} = \\mathbf{c}^\\top\\left(\\frac{dH}{db} - E\\frac{dS}{db}\\right)\\mathbf{c} $$\n这需要计算矩阵元相对于 $b$ 的导数。依赖关系为 $\\alpha_k(b) = \\alpha_0 r^k b^{-2}$ 和 $\\omega(b)=b$。\n基函数参数的导数为 $\\frac{d\\alpha_k}{db} = -2\\alpha_0 r^k b^{-3} = -2\\frac{\\alpha_k}{b}$。因此，$\\frac{d\\gamma_{ij}}{db} = -2\\frac{\\gamma_{ij}}{b}$。\n\n- **$S_{ij}(b)$ 的导数**：\n$$ \\frac{dS_{ij}}{db} = \\frac{d}{db}\\left(\\sqrt{\\pi}\\gamma_{ij}^{-1/2}\\right) = \\sqrt{\\pi}\\left(-\\frac{1}{2}\\gamma_{ij}^{-3/2}\\right)\\frac{d\\gamma_{ij}}{db} = -\\frac{\\sqrt{\\pi}}{2}\\gamma_{ij}^{-3/2}\\left(-2\\frac{\\gamma_{ij}}{b}\\right) = \\frac{\\sqrt{\\pi}\\gamma_{ij}^{-1/2}}{b} = \\frac{S_{ij}}{b} $$\n- **$T_{ij}(b)$ 的导数**：\n$T_{ij}$ 正比于 $\\alpha_i\\alpha_j \\gamma_{ij}^{-3/2} \\propto (b^{-4})(b^2)^{3/2} = b^{-4}b^3 = b^{-1}$。\n$$ \\frac{dT_{ij}}{db} = -\\frac{T_{ij}}{b} $$\n- **$V_{ij}(b)$ 的导数**：\n$V_{ij}$ 正比于 $b^2 \\gamma_{ij}^{-3/2} \\propto b^2 (b^2)^{-3/2} = b^2 b^{-3} = b^{-1}$。\n(Correction in original thought process: `b^2 * (b^2)^(-3/2)` is correct, not `b^2 * (b^2)^(3/2)`. $\\gamma$ is proportional to $b^{-2}$. So $\\gamma^{-3/2}$ is proportional to $(b^{-2})^{-3/2} = b^3$. So $V_{ij} \\propto b^2 \\cdot b^3 = b^5$ is wrong. It should be $V_{ij} \\propto b^2 \\cdot (b^{-2})^{-3/2} = b^2 \\cdot b^3 = b^5$. Wait, what? $\\gamma \\propto b^{-2}$, so $\\gamma^{-3/2} \\propto (b^{-2})^{-3/2} = b^3$. $V_{ij} \\propto \\omega^2 \\gamma^{-3/2} \\propto b^2 \\cdot b^3 = b^5$. Let me re-calculate $\\frac{dV_{ij}}{db}$ using the chain rule properly.\n$$ \\frac{dV_{ij}}{db} = \\frac{\\partial V_{ij}}{\\partial \\omega^2} \\frac{d\\omega^2}{db} + \\frac{\\partial V_{ij}}{\\partial \\gamma_{ij}} \\frac{d\\gamma_{ij}}{db} = \\left(\\frac{\\sqrt{\\pi}}{4\\gamma_{ij}^{3/2}}\\right)(2b) + \\left(\\frac{b^2\\sqrt{\\pi}}{4} (-\\frac{3}{2})\\gamma_{ij}^{-5/2}\\right)(-2\\frac{\\gamma_{ij}}{b}) = \\frac{2b}{b^2}V_{ij} + \\frac{3b^2\\sqrt{\\pi}}{4b}\\gamma_{ij}^{-3/2} = \\frac{2}{b}V_{ij} + \\frac{3}{b}V_{ij} = \\frac{5V_{ij}}{b} $$\nYes, the original simple scaling argument was correct.\nThus, $\\frac{dH_{ij}}{db} = \\frac{dT_{ij}}{db} + \\frac{dV_{ij}}{db} = \\frac{1}{b}(-T_{ij} + 5V_{ij})$。\n将这些代入总导数公式：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = \\mathbf{c}^\\top\\left(\\frac{1}{b}(-T + 5V) - E \\frac{S}{b}\\right)\\mathbf{c} = \\frac{1}{b}(-\\langle T \\rangle + 5\\langle V \\rangle - E) $$\n其中 $\\langle O \\rangle = \\mathbf{c}^\\top O \\mathbf{c}$ 且 $\\mathbf{c}^\\top S \\mathbf{c}=1$。因为 $E=\\langle T \\rangle + \\langle V \\rangle$，我们可以简化：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = \\frac{1}{b}(-\\langle T \\rangle + 5\\langle V \\rangle - (\\langle T \\rangle + \\langle V \\rangle)) = \\frac{2}{b}(2\\langle V \\rangle - \\langle T \\rangle) $$\n\n#### 4. Hellmann-Feynman 和 Pulay 贡献\n- **Hellmann-Feynman 项 ($E_{\\mathrm{HF}}$)**：这被定义为物理哈密顿量的显式导数的期望值，同时保持基组固定。\n$H_{\\mathrm{phys}}(b) = T + \\frac{1}{2}b^2x^2$。显式导数为 $\\frac{\\partial H_{\\mathrm{phys}}(b)}{\\partial b} = b x^2$。\n该算符的矩阵是 $(\\frac{\\partial H}{\\partial b})_{\\mathrm{proj}, ij} = \\langle \\phi_i | b x^2 | \\phi_j \\rangle = b \\int x^2 e^{-\\gamma_{ij}x^2}dx$。\n从 $V_{ij}$ 的定义可知，$\\langle\\phi_i|\\frac{1}{2}b^2x^2|\\phi_j\\rangle = V_{ij}$，所以 $\\langle\\phi_i|x^2|\\phi_j\\rangle = \\frac{2V_{ij}}{b^2}$。\n因此，$(\\frac{\\partial H}{\\partial b})_{\\mathrm{proj}, ij} = b \\left(\\frac{2V_{ij}}{b^2}\\right) = \\frac{2V_{ij}}{b}$。\nHF 贡献是该矩阵的期望值：\n$$ E_{\\mathrm{HF}}(b) = \\mathbf{c}^\\top \\left(\\frac{2V}{b}\\right) \\mathbf{c} = \\frac{2}{b}\\langle V \\rangle $$\n- **Pulay 项 ($E_{\\mathrm{Pulay}}$)**：这被定义为总导数的剩余部分，它说明了基函数对 $b$ 的依赖性。\n$$ E_{\\mathrm{Pulay}}(b) = \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b) = \\frac{2}{b}(2\\langle V \\rangle - \\langle T \\rangle) - \\frac{2}{b}\\langle V \\rangle = \\frac{2}{b}(\\langle V \\rangle - \\langle T \\rangle) $$\n\n#### 5. 数值验证\n解析导数通过与数值中心有限差分近似进行对比来验证：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}} = \\frac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon} $$\n这需要求解两个略微扰动的 $b$ 值（$b+\\varepsilon$ 和 $b-\\varepsilon$）的 GEP，以找到相应的基态能量。\n\n#### 计算算法摘要\n对于每个测试用例 $(N,\\alpha_0,r,b,\\varepsilon)$：\n1. 定义一个函数 `calculate_matrices(b_val, N, alpha0, r)`，它为给定的参数 $b_{\\text{val}}$ 构建并返回矩阵 $S$、$T$ 和 $V$。\n2. 使用中心值 $b$ 调用此函数以获得 $S, T, V$。构建 $H=T+V$。\n3. 求解 GEP $H\\mathbf{c}=ES\\mathbf{c}$ 以找到最低特征值 $E(b)$ 和相应的 $S$-归一化特征向量 $\\mathbf{c}$。\n4. 计算期望值 $\\langle T \\rangle = \\mathbf{c}^\\top T \\mathbf{c}$ 和 $\\langle V \\rangle = \\mathbf{c}^\\top V \\mathbf{c}$。\n5. 使用推導出的公式计算导数分量：\n   - $E_{\\mathrm{HF}}(b) = \\frac{2}{b}\\langle V \\rangle$\n   - $E_{\\mathrm{Pulay}}(b) = \\frac{2}{b}(\\langle V \\rangle - \\langle T \\rangle)$\n   - $\\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = E_{\\mathrm{HF}}(b) + E_{\\mathrm{Pulay}}(b)$\n6. 使用 $b+\\varepsilon$ 和 $b-\\varepsilon$ 调用矩阵/能量函数以获得 $E(b+\\varepsilon)$ 和 $E(b-\\varepsilon)$。\n7. 计算有限差分导数 $\\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}$。\n8. 计算解析导数和数值导数之间的绝对差。\n9. 将五个所需量存储在列表中以供最终输出。",
            "answer": "```python\n# language: Python\n# version: 3.12\n# libraries:\n#   name: numpy\n#   version: 1.23.5\n#   name: scipy\n#   version: 1.11.4\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It calculates the analytic and finite-difference derivatives of the ground state energy\n    of a quantum harmonic oscillator using a parameter-dependent Gaussian basis set.\n    \"\"\"\n    test_cases = [\n        (3, 0.5, 1.7, 1.0, 10**-6),\n        (5, 0.4, 1.5, 0.8, 10**-6),\n        (2, 0.6, 2.0, 1.2, 10**-6),\n        (6, 0.3, 1.7, 1.6, 10**-6),\n    ]\n\n    results = []\n\n    def get_matrices(b_val, N, alpha0, r):\n        S = np.zeros((N, N))\n        T = np.zeros((N, N))\n        V = np.zeros((N, N))\n        \n        alphas = [alpha0 * (r**i) / (b_val**2) for i in range(N)]\n        \n        for i in range(N):\n            for j in range(i, N + 1):\n                if j >= N: continue\n                alpha_i = alphas[i]\n                alpha_j = alphas[j]\n                gamma = alpha_i + alpha_j\n                \n                s_ij = np.sqrt(np.pi / gamma)\n                S[i, j] = S[j, i] = s_ij\n                \n                t_ij = alpha_i * alpha_j * np.sqrt(np.pi) / (gamma**(3/2))\n                T[i, j] = T[j, i] = t_ij\n                \n                omega_sq = b_val**2\n                v_ij = omega_sq * np.sqrt(np.pi) / (4 * gamma**(3/2))\n                V[i, j] = V[j, i] = v_ij\n                \n        return S, T, V\n\n    def get_energy(b_val, N, alpha0, r):\n        S_mat, T_mat, V_mat = get_matrices(b_val, N, alpha0, r)\n        H_mat = T_mat + V_mat\n        eigenvalues, _ = eigh(H_mat, S_mat)\n        return eigenvalues[0]\n\n    for case in test_cases:\n        N, alpha0, r, b, epsilon = case\n        \n        # --- Step 1: Solve GEP at the central point b ---\n        S, T, V = get_matrices(b, N, alpha0, r)\n        H = T + V\n        \n        eigenvalues, eigenvectors = eigh(H, V=S)\n        \n        energy = eigenvalues[0]\n        c = eigenvectors[:, 0]\n        \n        # --- Step 2: Compute expectation values ---\n        exp_T = c.T @ T @ c\n        exp_V = c.T @ V @ c\n        \n        # --- Step 3: Compute analytic derivatives ---\n        E_hf = (2.0 / b) * exp_V\n        E_pulay = (2.0 / b) * (exp_V - exp_T)\n        dE_db_analytic = E_hf + E_pulay\n        \n        # --- Step 4: Compute finite difference derivative ---\n        E_p = get_energy(b + epsilon, N, alpha0, r)\n        E_m = get_energy(b - epsilon, N, alpha0, r)\n        dE_db_fd = (E_p - E_m) / (2 * epsilon)\n\n        # --- Step 5: Calculate the absolute difference and store results ---\n        diff = abs(dE_db_analytic - dE_db_fd)\n        \n        results.append(f\"[{E_hf},{E_pulay},{dE_db_analytic},{dE_db_fd},{diff}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}