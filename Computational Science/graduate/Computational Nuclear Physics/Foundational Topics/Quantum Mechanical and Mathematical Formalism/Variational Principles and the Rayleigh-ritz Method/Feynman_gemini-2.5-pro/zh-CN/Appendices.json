{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握变分原理，最好的方法是从一个可以解析求解的简单模型开始。这项实践将带你回到量子力学的基础——简谐振子，并运用瑞利-里兹（Rayleigh-Ritz）方法，在一个仅由两个基函数构成的截断空间中去近似其基态能量。通过这个练习，你不仅能亲手实践构建哈密顿量矩阵和求解其本征值的核心步骤，还能深刻理解变分基的选择对近似结果精度的影响。",
            "id": "3610839",
            "problem": "在计算核物理中，自伴哈密顿量 $h$ 的基态能量的变分表征由瑞利商 $R[\\psi] = \\langle \\psi | h | \\psi \\rangle / \\langle \\psi | \\psi \\rangle$ 给出，而瑞利-里兹 (RR) 方法通过在有限维子空间上最小化 $R[\\psi]$ 来近似基态。考虑一个一维笛卡尔坐标系中的单体哈密顿量，\n$$\nh = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\omega^{2} x^{2},\n$$\n其中质量为 $m$，用于构建谐振子 (HO) 基的参考频率参数为 $\\Omega$，定义 $h$ 的物理频率为 $\\omega$。令 $\\{ \\phi_{0}(x;\\Omega), \\phi_{1}(x;\\Omega) \\}$表示参考哈密顿量\n$$\nh_{\\Omega} = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\Omega^{2} x^{2}.\n$$\n的前两个归一化谐振子本征函数。仅使用正则对易关系 $[x,p] = i \\hbar$ 以及 $h_{\\Omega}$ 的谐振子基态的正交归一性和升降算符结构，构建 $h$ 在由 $\\{ \\phi_{0}, \\phi_{1} \\}$ 张成的子空间中的 $2 \\times 2$ 矩阵表示，并确定该子空间上的最小瑞利商，即投影哈密顿量的最小本征值。$h$ 的精确基态能量为 $E_{0} = \\frac{1}{2} \\hbar \\omega$。请以相对误差的形式给出你的比较\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}},\n$$\n其中 $E_{\\mathrm{var}}$ 是在指定子空间中的最小瑞利商。请用一个只含 $\\Omega$ 和 $\\omega$ 的单一闭式解析表达式来表示你的最终答案。不需要进行数值取整，并且由于该量是无量纲的，因此无需报告单位。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它在科学上基于量子力学的原理，特别是谐振子和瑞利-里兹变分法。该问题提法恰当、客观，并包含得出唯一解所需的所有必要信息。\n\n任务是，在一个双态试探空间内，求出谐振子哈密顿量 $h$ 的最低能量变分近似值 $E_{\\mathrm{var}}$，然后计算其相对于精确基态能量 $E_0$ 的相对误差。\n\n物理系统的哈密顿量由下式给出：\n$$\nh = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\omega^{2} x^{2}\n$$\n变分子空间由参考谐振子哈密顿量 $h_{\\Omega}$ 的前两个正交归一的本征函数 $\\{ \\phi_{0}, \\phi_{1} \\}$ 张成：\n$$\nh_{\\Omega} = \\frac{p^{2}}{2 m} + \\frac{1}{2} m \\Omega^{2} x^{2}\n$$\n本征函数 $\\phi_n \\equiv \\phi_n(x; \\Omega)$ 满足 $h_{\\Omega} \\phi_n = E_n^{(\\Omega)} \\phi_n$，其本征值为 $E_n^{(\\Omega)} = (n + \\frac{1}{2})\\hbar\\Omega$。\n\n瑞利-里兹方法要求我们在基 $\\{ \\phi_{0}, \\phi_{1} \\}$ 中构建哈密顿量 $h$ 的矩阵表示，并找出其最低本征值。该本征值对应于最小瑞利商 $E_{\\mathrm{var}}$。矩阵元为 $H_{ij} = \\langle \\phi_i | h | \\phi_j \\rangle$。\n\n为简化矩阵元的计算，我们可以用 $h_{\\Omega}$ 来表示 $h$：\n$$\nh = h_{\\Omega} - \\frac{1}{2} m \\Omega^{2} x^{2} + \\frac{1}{2} m \\omega^{2} x^{2} = h_{\\Omega} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) x^{2}\n$$\n因此，矩阵元为：\n$$\nH_{ij} = \\langle \\phi_i | h_{\\Omega} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) x^{2} | \\phi_j \\rangle\n$$\n利用 $\\phi_j$ 是 $h_{\\Omega}$ 的本征函数以及基是正交归一的（$\\langle \\phi_i | \\phi_j \\rangle = \\delta_{ij}$）这一事实：\n$$\nH_{ij} = \\langle \\phi_i | E_j^{(\\Omega)} | \\phi_j \\rangle + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_i | x^{2} | \\phi_j \\rangle\n$$\n$$\nH_{ij} = E_j^{(\\Omega)} \\delta_{ij} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_i | x^{2} | \\phi_j \\rangle\n$$\n谐振子的本征函数具有确定的宇称：$\\phi_n(-x) = (-1)^n \\phi_n(x)$。因此，$\\phi_0$ 是偶函数，$\\phi_1$ 是奇函数。算符 $x^2$ 是偶算符，因为 $x^2 = (-x)^2$。矩阵元 $\\langle \\phi_i | x^2 | \\phi_j \\rangle$ 涉及形式为 $\\int \\phi_i^*(x) x^2 \\phi_j(x) dx$ 的积分。对于非对角元（$i \\neq j$），被积函数是一个偶函数（$\\phi_0$）、一个偶函数（$x^2$）和一个奇函数（$\\phi_1$）的乘积。总的被积函数是奇函数，其在对称区间 $(-\\infty, \\infty)$ 上的积分为零。\n因此，$\\langle \\phi_0 | x^{2} | \\phi_1 \\rangle = 0$ 且 $\\langle \\phi_1 | x^{2} | \\phi_0 \\rangle = 0$。\n这意味着 $h$ 在此基下的矩阵表示是对角的：\n$$\nH = \\begin{pmatrix} H_{00} & 0 \\\\ 0 & H_{11} \\end{pmatrix}\n$$\n本征值就是对角元 $H_{00}$ 和 $H_{11}$。我们现在必须计算这些矩阵元。这需要期望值 $\\langle \\phi_0 | x^2 | \\phi_0 \\rangle$ 和 $\\langle \\phi_1 | x^2 | \\phi_1 \\rangle$。我们使用参考哈密顿量 $h_{\\Omega}$ 的升降算符形式。位置算符 $x$ 用湮灭 ($a$) 和产生 ($a^{\\dagger}$) 算符表示为：\n$$\nx = \\sqrt{\\frac{\\hbar}{2 m \\Omega}}(a + a^{\\dagger})\n$$\n将其平方得到：\n$$\nx^{2} = \\frac{\\hbar}{2 m \\Omega} (a + a^{\\dagger})^{2} = \\frac{\\hbar}{2 m \\Omega} (a^2 + (a^{\\dagger})^2 + a a^{\\dagger} + a^{\\dagger} a)\n$$\n使用对易关系 $[a, a^{\\dagger}] = 1$，我们可以写出 $a a^{\\dagger} = a^{\\dagger} a + 1$。粒子数算符为 $N = a^{\\dagger} a$。\n$$\nx^{2} = \\frac{\\hbar}{2 m \\Omega} (a^2 + (a^{\\dagger})^2 + 2N + 1)\n$$\n我们现在计算期望值。注意，由于正交性，$\\langle \\phi_n | a^2 | \\phi_n \\rangle = 0$ 且 $\\langle \\phi_n | (a^{\\dagger})^2 | \\phi_n \\rangle = 0$。\n对于态 $\\phi_0$ ($n=0$)：\n$$\n\\langle \\phi_0 | x^2 | \\phi_0 \\rangle = \\frac{\\hbar}{2 m \\Omega} \\langle \\phi_0 | 2N + 1 | \\phi_0 \\rangle = \\frac{\\hbar}{2 m \\Omega} (2(0) + 1) = \\frac{\\hbar}{2 m \\Omega}\n$$\n对于态 $\\phi_1$ ($n=1$)：\n$$\n\\langle \\phi_1 | x^2 | \\phi_1 \\rangle = \\frac{\\hbar}{2 m \\Omega} \\langle \\phi_1 | 2N + 1 | \\phi_1 \\rangle = \\frac{\\hbar}{2 m \\Omega} (2(1) + 1) = \\frac{3\\hbar}{2 m \\Omega}\n$$\n现在我们可以构建 $H$ 的对角矩阵元：\n$$\nH_{00} = E_0^{(\\Omega)} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_0 | x^{2} | \\phi_0 \\rangle = \\frac{1}{2}\\hbar\\Omega + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\frac{\\hbar}{2 m \\Omega}\n$$\n$$\nH_{00} = \\frac{1}{2}\\hbar\\Omega + \\frac{\\hbar(\\omega^{2} - \\Omega^{2})}{4\\Omega} = \\frac{\\hbar}{4\\Omega} [2\\Omega^2 + \\omega^2 - \\Omega^2] = \\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n对于 $H_{11}$：\n$$\nH_{11} = E_1^{(\\Omega)} + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\langle \\phi_1 | x^{2} | \\phi_1 \\rangle = \\frac{3}{2}\\hbar\\Omega + \\frac{1}{2} m (\\omega^{2} - \\Omega^{2}) \\frac{3\\hbar}{2 m \\Omega}\n$$\n$$\nH_{11} = \\frac{3}{2}\\hbar\\Omega + \\frac{3\\hbar(\\omega^{2} - \\Omega^{2})}{4\\Omega} = \\frac{3\\hbar}{4\\Omega} [2\\Omega^2 + \\omega^2 - \\Omega^2] = \\frac{3\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n投影哈密顿量的本征值为 $H_{00}$ 和 $H_{11}$。最小瑞利商 $E_{\\mathrm{var}}$ 是这两个值中的较小者。由于 $\\hbar, \\Omega, \\omega^2, \\Omega^2$ 均为正值，所以 $H_{00}  H_{11}$。\n因此：\n$$\nE_{\\mathrm{var}} = H_{00} = \\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)\n$$\n物理哈密顿量 $h$ 的精确基态能量为 $E_0 = \\frac{1}{2} \\hbar \\omega$。题目要求我们计算相对误差：\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}} = \\frac{E_{\\mathrm{var}}}{E_{0}} - 1\n$$\n代入 $E_{\\mathrm{var}}$ 和 $E_0$ 的表达式：\n$$\n\\frac{E_{\\mathrm{var}}}{E_{0}} = \\frac{\\frac{\\hbar}{4\\Omega}(\\Omega^2 + \\omega^2)}{\\frac{1}{2}\\hbar\\omega} = \\frac{\\Omega^2 + \\omega^2}{2\\Omega\\omega}\n$$\n那么相对误差为：\n$$\n\\frac{E_{\\mathrm{var}} - E_{0}}{E_{0}} = \\frac{\\Omega^2 + \\omega^2}{2\\Omega\\omega} - 1 = \\frac{\\Omega^2 + \\omega^2 - 2\\Omega\\omega}{2\\Omega\\omega} = \\frac{(\\Omega - \\omega)^2}{2\\Omega\\omega}\n$$\n这个结果与变分定理一致，该定理保证 $E_{\\mathrm{var}} \\ge E_0$，因为该表达式始终是非负的。只有当 $\\Omega = \\omega$ 时，误差才为零，这种情况下基态 $\\phi_0(x; \\Omega)$ 与 $h$ 的真实基态完全相同。",
            "answer": "$$\n\\boxed{\\frac{(\\Omega - \\omega)^2}{2\\Omega\\omega}}\n$$"
        },
        {
            "introduction": "在掌握了基本原理之后，我们将进入一个更接近真实研究场景的计算挑战：对一个二维核子系统进行完整的组态相互作用（CI）计算。这项编码实践要求你从第一性原理出发，构建多体哈密顿量，处理平移不变的两体相互作用，并诊断和处理因基空间截断而引入的赝质心运动污染。通过实施劳森（Lawson）惩罚项方法，你将学习一种强大的变分技术，用以滤除这些非物理的激发态，从而确保计算结果的物理可靠性。",
            "id": "3610851",
            "problem": "您将为一个一维空间中的双核子系统实现一个完整的 Rayleigh–Ritz 变分计算，以诊断并变分地滤除一个截断的组态相互作用 (CI) 空间中的质心污染。您的实现必须是一个单一的可运行程序，它能够构造多体哈密顿量，计算其最低本征态，评估每个本征态的质心哈密顿量期望值，并通过向哈密顿量增加一个质心惩罚项来应用变分滤波器。所有步骤都必须从第一性原理出发，不得使用能简化推导的闭合形式矩阵元。\n\n物理模型如下。考虑两个质量为 $m$ 的可区分核子在一维空间中运动。采用自然单位制，其中约化普朗克常数 $\\hbar = 1$ 且质量 $m = 1$。单粒子囚禁场是一个角频率为 $\\omega  0$ 的谐振子。两体相互作用是平移不变的，且仅依赖于相对坐标，其形式为强度为 $V_0$、程长为 $a  0$ 的有限程高斯势：\n$$\nV(x_1, x_2) = V_0 \\exp\\!\\left(-\\frac{(x_1 - x_2)^2}{2 a^2}\\right).\n$$\n完整的两体哈密顿量为\n$$\nH = \\sum_{i=1}^2 \\left(\\frac{p_i^2}{2 m} + \\frac{1}{2} m \\omega^2 x_i^2\\right) + V(x_1, x_2),\n$$\n在所有数值结果中均使用 $\\hbar = 1$ 和 $m = 1$。对于 $A=2$ 个粒子，一维质心 (CM) 哈密顿量为\n$$\nH_{\\mathrm{cm}} = \\frac{P_{\\mathrm{cm}}^2}{2 A m} + \\frac{1}{2} A m \\omega^2 R_{\\mathrm{cm}}^2 - \\frac{1}{2}\\,\\omega,\n$$\n其中 $A = 2$，$R_{\\mathrm{cm}} = \\frac{x_1 + x_2}{2}$，$P_{\\mathrm{cm}} = p_1 + p_2$。减去 $\\frac{1}{2}\\,\\omega$ 项可将基态 $0S$ 质心模式的期望值设为零。在具有平移不变相互作用的精确（非截断）计算中，任何具有质心基态分量的本征态都有 $\\langle H_{\\mathrm{cm}} \\rangle = 0$，而伪质心激发会产生 $\\langle H_{\\mathrm{cm}} \\rangle \\approx n_{\\mathrm{cm}} \\,\\omega$，其中整数 $n_{\\mathrm{cm}} \\ge 1$。在截断的 CI 空间中，伪混合会导致那些本应没有质心激发的态出现非零的 $\\langle H_{\\mathrm{cm}} \\rangle$。\n\n您的计算任务是在一个截断的 CI 空间中执行 Rayleigh–Ritz 计算，并量化和滤除质心污染。\n\n1. 基矢和截断。使用一维谐振子单粒子本征函数 $\\{\\varphi_n(x)\\}_{n=0}^{n_{\\max}}$ 作为每个粒子的有限基矢，其中振子长度 $b = \\sqrt{1/\\omega}$。两体 CI 基矢是直积 $\\{\\varphi_{n_1}(x_1)\\varphi_{n_2}(x_2)\\}$，其中 $0 \\le n_1, n_2 \\le n_{\\max}$，这构成了由单粒子最大量子数 $n_{\\max}$ 决定的截断。这种截断不强制总量子数守恒，因此破坏了内禀运动和质心运动的精确分解，从而使伪污染得以出现。\n\n2. 变分原理和 Rayleigh–Ritz 方法。从不含时薛定谔方程和 Rayleigh 商\n$$\n\\mathcal{E}[\\psi] = \\frac{\\langle \\psi| H | \\psi\\rangle}{\\langle \\psi|\\psi\\rangle},\n$$\n出发，通过在截断的 CI 基矢中展开试探态 $|\\psi\\rangle$ 并对角化哈密顿矩阵来应用 Rayleigh–Ritz 方法，以获得近似的本征值和本征矢量。\n\n3. 算符构造。使用正则对易关系和升降算符构造单粒子位置和动量算符，\n$$\nx = \\sqrt{\\frac{1}{2 \\omega}}\\,(a + a^\\dagger),\\qquad p = \\mathrm{i}\\sqrt{\\frac{\\omega}{2}}\\,(a^\\dagger - a),\n$$\n然后通过矩阵乘法在截断的单粒子基矢中形成 $x^2$ 和 $p^2$ 矩阵。通过 Kronecker 积组合两体算符，以在 CI 基矢上形成 $H$ 的单体部分。对于两体高斯相互作用，不要使用闭合形式的矩阵元。相反，应使用 Gauss–Hermite 求积法数值计算矩阵元\n$$\n\\langle n_1 n_2 | V | n_1' n_2' \\rangle = \\int_{-\\infty}^{\\infty}\\!\\!\\int_{-\\infty}^{\\infty} \\varphi_{n_1}(x_1)\\varphi_{n_2}(x_2) V(x_1-x_2) \\varphi_{n_1'}(x_1)\\varphi_{n_2'}(x_2)\\, \\mathrm{d}x_1 \\mathrm{d}x_2\n$$\n，并使用足够数量的点以在所提供的测试案例中获得稳定的结果。您可以利用 $\\varphi_n$ 的多项式-高斯结构，使用能够对 $e^{-y^2}$ 乘以一个平滑函数形式的函数进行积分的 Gauss–Hermite 法则，注意对普适的 $\\omega$ 使用正确的振子长度标度。\n\n4. 质心哈密顿量。在 CI 基矢上，根据单粒子算符 $x_1, x_2, p_1, p_2$ 推导并实现 $H_{\\mathrm{cm}}$，而无需变换到相对坐标和质心坐标。然后为每个 CI 本征态计算 $\\langle H_{\\mathrm{cm}} \\rangle$，作为伪污染的诊断。\n\n5. 变分滤波 (Lawson 方法)。定义惩罚哈密顿量\n$$\nH_\\beta = H + \\beta\\, H_{\\mathrm{cm}},\n$$\n其中惩罚参数 $\\beta \\ge 0$。对角化 $H_\\beta$ 以获得最低的本征态。使用一个阈值 $\\tau  0$，并在最低的 $k$ 个本征态中滤除任何满足 $\\langle H_{\\mathrm{cm}} \\rangle  \\tau$ 的态，其中 $k$ 由每个测试案例指定。\n\n实现要求：\n- 采用 $\\hbar = 1$ 和 $m = 1$ 的单位制，因此所有能量单位为 $\\omega$，长度单位为 $b = \\sqrt{1/\\omega}$。\n- 不涉及角度，因此不需要角度单位。\n- 对于每个测试案例，您的程序必须产出 $H_\\beta$ 的最低 $k$ 个本征态中，其质心期望值满足 $\\langle H_{\\mathrm{cm}} \\rangle \\le \\tau$ 的本征态的整数数量。将所有测试案例的这些计数汇总到如下所述的单行输出中。\n\n测试套件。在以下参数集上运行您的程序，每个参数集指定为一个元组 $\\left(n_{\\max}, \\omega, V_0, a, k, \\tau, \\beta\\right)$:\n- 案例 1：$\\left(4,\\, 1.0,\\, -0.6,\\, 0.8,\\, 6,\\, 0.02,\\, 0.0\\right)$\n- 案例 2：$\\left(4,\\, 1.0,\\, -0.6,\\, 0.8,\\, 6,\\, 0.02,\\, 10.0\\right)$\n- 案例 3：$\\left(3,\\, 1.2,\\, -0.6,\\, 0.5,\\, 6,\\, 0.02,\\, 10.0\\right)$\n\n最终输出格式。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于上述三个案例，输出必须是以下形式\n$$\n[\\text{count}_1,\\text{count}_2,\\text{count}_3],\n$$\n其中每个 $\\text{count}_i$ 是如上定义的整数。不应打印任何其他文本。所有数值计算都必须由您的代码执行；不要硬编码期望值。",
            "solution": "用户提供的问题是计算量子物理学中的一个有效练习。它要求在截断的组态相互作用 (CI) 空间内为一个双核子系统实现 Rayleigh-Ritz 变分计算。该问题在科学上基于量子力学原理和数值方法，特别是壳模型和变分技术。这是一个适定的问题，提供了所有必要的参数、物理模型定义和一个明确的计算目标。所指定的从第一性原理出发，使用升降算符和数值求积法计算矩阵元来构建算符的方法，是该领域中一个标准且具有指导意义的途径。包含了质心污染诊断和 Lawson 滤波方法，使其真实地代表了核结构理论中的挑战。问题中没有矛盾、歧义或不科学的前提。\n\n求解过程如下：\n首先，对于每个测试案例，我们定义模型的参数：单粒子基矢截断 $n_{\\max}$、谐振子频率 $\\omega$、相互作用强度 $V_0$ 和程长 $a$，以及 Lawson 滤波方法的参数 $k, \\tau, \\beta$。我们在自然单位制中工作，其中 $\\hbar=1$ 且核子质量 $m=1$。\n\n单粒子基矢由一维量子谐振子 (QHO) 的本征态 $\\{|n\\rangle\\}$ 组成，并在 $n=n_{\\max}$ 处截断。这个单粒子空间的维度是 $N_{sp} = n_{\\max}+1$。\n\n在这个截断的基矢中构造单粒子位置算符 $x$ 和动量算符 $p$。我们从升降算符 $a$ 和 $a^\\dagger$ 的矩阵表示开始，它们通过对基态的作用来定义，$\\langle n' | a | n \\rangle = \\sqrt{n}\\,\\delta_{n',n-1}$ 和 $\\langle n' | a^\\dagger | n \\rangle = \\sqrt{n+1}\\,\\delta_{n',n+1}$。然后使用它们在 $a$ 和 $a^\\dagger$ 方面的标准定义来形成 $x$ 和 $p$ 矩阵：\n$$\nx = \\sqrt{\\frac{1}{2 \\omega}}\\,(a + a^\\dagger),\\qquad p = \\mathrm{i}\\sqrt{\\frac{\\omega}{2}}\\,(a^\\dagger - a)\n$$\n$x^2$ 和 $p^2$ 的矩阵分别通过 $x$ 和 $p$ 矩阵的矩阵乘法获得。值得注意的是，由于基矢截断，正则对易关系 $[x,p]=i$ 并未完全满足，这是该方法的一个预期的人为结果。\n\n两体 CI 基矢是单粒子基矢的直积：$\\{|n_1 n_2\\rangle = |n_1\\rangle \\otimes |n_2\\rangle\\}$，其中 $0 \\le n_1, n_2 \\le n_{\\max}$。这个两体空间的维度是 $N_{basis} = N_{sp}^2$。两体算符通过单粒子算符的 Kronecker 积构造。例如，$x_1$ 由 $x \\otimes I$ 表示，$x_2$ 由 $I \\otimes x$ 表示，其中 $I$ 是单粒子空间中的单位矩阵。\n\n完整的哈密顿量 $H = H_{1-body} + V$ 在两体基矢中构造。代表动能和谐振子囚禁的单体部分由单粒子哈密顿矩阵 $h = p^2/2 + \\omega^2 x^2/2$ 形成，即 $H_{1-body} = h \\otimes I + I \\otimes h$。\n\n两体高斯相互作用的矩阵元 $\\langle n_1 n_2 | V | n_1' n_2' \\rangle$ 按照规定使用 Gauss-Hermite 求积法进行数值计算。该积分被变换到无量纲坐标 $y_i = x_i/b$，其中 $b=\\sqrt{1/\\omega}$ 是振子长度。由 QHO 波函数产生的 $e^{-y_1^2-y_2^2}$ 因子被吸收到求积权重中，剩下的平滑函数在求积点上进行求值。使用足够多的求积点以确保数值稳定性和准确性。\n\n质心哈密顿量 $H_{cm}$ 也从单粒子算符在两体基矢中构造，使用其定义：\n$$\nH_{\\mathrm{cm}} = \\frac{P_{\\mathrm{cm}}^2}{4} + \\omega^2 R_{\\mathrm{cm}}^2 - \\frac{\\omega}{2}\n$$\n其中 $R_{cm} = (x_1+x_2)/2$ 且 $P_{cm} = p_1+p_2$。\n\nLawson 方法通过形成惩罚哈密顿量 $H_\\beta = H + \\beta H_{cm}$ 来实现。对该矩阵进行对角化以找到其本征值和本征矢量。根据 Rayleigh-Ritz 方法，这些本征矢量代表了系统的近似本征态。\n\n最后，对于从对角化 $H_\\beta$ 得到的 $k$ 个最低能量本征态中的每一个，我们计算原始质心哈密顿量的期望值 $\\langle H_{cm} \\rangle$。然后我们计算这 $k$ 个态中有多少满足条件 $\\langle H_{cm} \\rangle \\le \\tau$。这个计数是一个测试案例的结果。对测试套件中提供的所有案例重复此过程。",
            "answer": "```python\n# language: Python\n# version: 3.12\n# libraries:\n#   name: numpy\n#   version: 1.23.5\n#   name: scipy\n#   version: 1.11.4\n\nimport numpy as np\nfrom scipy.special import roots_hermite, eval_hermite\nfrom scipy.linalg import eigh\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases.\n    It implements the Rayleigh-Ritz method for a two-nucleon system in a \n    truncated harmonic oscillator basis, including diagnostics and filtering \n    of center-of-mass excitations.\n    \"\"\"\n    \n    # Test suite from the problem statement\n    test_cases = [\n        # (n_max, omega, V0, a, k, tau, beta)\n        (4, 1.0, -0.6, 0.8, 6, 0.02, 0.0),\n        (4, 1.0, -0.6, 0.8, 6, 0.02, 10.0),\n        (3, 1.2, -0.6, 0.5, 6, 0.02, 10.0),\n    ]\n\n    results = []\n    \n    # Using a fixed large number of quadrature points for stability\n    # across all test cases.\n    N_quad = 60\n    yq, wq = roots_hermite(N_quad)\n\n    for case in test_cases:\n        n_max, omega, V0, a, k, tau, beta = case\n        \n        # 1. Setup basis and physical constants in natural units (hbar=1, m=1)\n        N_sp = n_max + 1\n        N_basis = N_sp ** 2\n        \n        hbar = 1.0\n        m = 1.0\n        b = np.sqrt(hbar / (m * omega))  # HO length scale\n\n        # 2. Construct single-particle operators in the truncated HO basis { |n }\n        # Ladder operators (annihilation and creation)\n        a_op = np.zeros((N_sp, N_sp), dtype=float)\n        for n in range(1, N_sp):\n            a_op[n - 1, n] = np.sqrt(n)\n        adag_op = a_op.T\n        \n        # Position and momentum operators from ladder operators\n        x_sp = np.sqrt(hbar / (2 * m * omega)) * (a_op + adag_op)\n        p_sp = 1j * np.sqrt(m * hbar * omega / 2) * (adag_op - a_op)\n        \n        # 3. Construct two-body operators from single-particle ones via Kronecker product\n        I_sp = np.identity(N_sp)\n        I_basis = np.identity(N_basis)\n        \n        X1 = np.kron(x_sp, I_sp)\n        X2 = np.kron(I_sp, x_sp)\n        P1 = np.kron(p_sp, I_sp)\n        P2 = np.kron(I_sp, p_sp)\n        \n        # 4. Construct the many-body Hamiltonian matrix H\n        # One-body part: H_1b = sum_i(p_i^2/2m + 1/2 m omega^2 x_i^2)\n        p2_sp = p_sp @ p_sp\n        x2_sp = x_sp @ x_sp\n        h_sp = (1 / (2 * m)) * p2_sp + (m * omega**2 / 2) * x2_sp\n        H_1body = np.kron(h_sp, I_sp) + np.kron(I_sp, h_sp)\n        \n        # Two-body part: V(x1, x2) matrix from numerical quadrature\n        # Precompute values for efficiency\n        fact = [math.factorial(i) for i in range(2 * n_max + 2)]\n        hermite_vals = np.zeros((N_sp, N_quad))\n        for n in range(N_sp):\n            hermite_vals[n, :] = eval_hermite(n, yq)\n            \n        psi_poly_parts = np.zeros((N_sp, N_quad))\n        for n in range(N_sp):\n            norm = 1.0 / np.sqrt(np.sqrt(np.pi) * (2**n) * fact[n])\n            psi_poly_parts[n, :] = norm * hermite_vals[n, :]\n            \n        V_mat = np.zeros((N_basis, N_basis))\n\n        # Helper to map a flat index to (n1, n2) quantum numbers\n        def get_n_tuple(idx, n_sp_dim):\n            return idx // n_sp_dim, idx % n_sp_dim\n\n        for i in range(N_basis):\n            for j in range(i, N_basis):  # Exploit symmetry V_ij = V_ji\n                n1, n2 = get_n_tuple(i, N_sp)\n                n1p, n2p = get_n_tuple(j, N_sp)\n\n                term_y1 = psi_poly_parts[n1, :] * psi_poly_parts[n1p, :]\n                term_y2 = psi_poly_parts[n2, :] * psi_poly_parts[n2p, :]\n                poly_part = np.outer(term_y1, term_y2)\n                \n                y1_grid, y2_grid = np.meshgrid(yq, yq)\n                exp_arg = -b**2 * (y1_grid - y2_grid)**2 / (2 * a**2)\n                interaction_part = V0 * np.exp(exp_arg)\n                \n                integrand = poly_part * interaction_part\n                integral = np.einsum('i,j,ij-', wq, wq, integrand)\n                \n                V_mat[i, j] = integral\n                if i != j:\n                    V_mat[j, i] = integral\n\n        H_mat = H_1body + V_mat\n        H_mat = np.real(H_mat)\n\n        # 5. Construct the center-of-mass Hamiltonian H_cm\n        A = 2.0  # Number of nucleons\n        R_cm_op = (X1 + X2) / A\n        P_cm_op = P1 + P2\n        \n        H_cm_mat = (1 / (2 * A * m)) * (P_cm_op @ P_cm_op) + \\\n                   (A * m * omega**2 / 2) * (R_cm_op @ R_cm_op) - \\\n                   0.5 * hbar * omega * I_basis\n        H_cm_mat = np.real(H_cm_mat)\n\n        # 6. Apply Lawson's method: create and diagonalize H_beta = H + beta*H_cm\n        H_beta_mat = H_mat + beta * H_cm_mat\n        eigenvalues, eigenvectors = eigh(H_beta_mat)\n        \n        # 7. Analyze results: count states with small"
        },
        {
            "introduction": "变分计算的效率和精度往往取决于基函数的选择，而使用依赖于非线性参数的基组是一种常见的高级策略。这项实践将引导你深入探讨当基函数本身也依赖于变分参数时，能量的梯度计算会变得如何复杂。你将推导并计算能量对基函数宽度参数的导数，并将其分解为物理的赫尔曼-费曼（Hellmann-Feynman）贡献和源于基函数依赖性的普莱（Pulay）贡献，这对于理解和实现对非线性参数的变分优化至关重要。",
            "id": "3610859",
            "problem": "考虑一个一维非相对论性粒子，采用自然单位制，其中 $\\hbar=1$ 和 $m=1$。物理哈密顿量 $H_{\\mathrm{phys}}(b)$ 定义为 $H_{\\mathrm{phys}}(b)=T+V(b)$，其中 $T=-\\frac{1}{2}\\frac{d^2}{dx^2}$ 且 $V(b)=\\frac{1}{2}\\omega(b)^2 x^2$，$\\omega(b)=b$。设试验态 $|\\psi(b)\\rangle$ 是通过 Rayleigh-Ritz 方法（变分近似）使用非正交高斯基组 $\\{\\phi_i(x;b)\\}_{i=0}^{N-1}$ 得到的，其中 $\\phi_i(x;b)=\\exp\\!\\big(-\\alpha_i(b)x^2\\big)$ 且 $\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$。这里，$N$ 是基函数数量，$\\alpha_0$ 是一个正常数标度，$r1$ 是一个几何比率，$b0$ 是变分长度参数。对于此非正交基组，Rayleigh-Ritz 广义特征值问题 (GEP) 为 $H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$，其中 $H_{ij}(b)=\\langle \\phi_i(b)|H_{\\mathrm{phys}}(b)|\\phi_j(b)\\rangle$，$S_{ij}(b)=\\langle \\phi_i(b)|\\phi_j(b)\\rangle$，而 $\\mathbf{c}$ 是近似基态 $|\\psi(b)\\rangle = \\sum_i c_i |\\phi_i(b)\\rangle$ 的系数向量。在这些单位中，所有能量和 $b$ 都是无量纲的。\n\n您的任务是在给定的 $(N,\\alpha_0,r,b)$ 下，计算解析梯度 $dE/db$，将其分解为 Hellmann–Feynman (HF) 贡献和 Pulay 贡献，并通过有限差分法验证数值一致性。具体来说：\n\n- Rayleigh-Ritz 能量是在 GEP $H(b)\\mathbf{c}=E(b)S(b)\\mathbf{c}$ 的定态解处的瑞利商 $E(b) = \\dfrac{\\mathbf{c}^\\top H(b)\\mathbf{c}}{\\mathbf{c}^\\top S(b)\\mathbf{c}}$。\n- 将 Hellmann–Feynman (HF) 贡献定义为物理哈密顿量对 $b$ 的显式导数在固定基函数下的期望值，$E_{\\mathrm{HF}}(b)=\\mathbf{c}^\\top\\big(\\partial H_{\\mathrm{phys}}(b)/\\partial b\\big)_{\\mathrm{proj}}\\mathbf{c}$，其中下标“proj”表示在固定基组 $\\{\\phi_i(x;b)\\}$ 中计算矩阵元，而不对基函数本身求导。\n- 将 Pulay 贡献定义为 $E_{\\mathrm{Pulay}}(b)=\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b)$，其中 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 是通过将变分原理应用于非正交基和广义归一化约束得到的解析导数。\n- 数值上验证 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 与中心有限差分近似 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}} \\approx \\dfrac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon}$ 在小步长 $\\varepsilon0$ 下是一致的。\n\n所有矩阵元必须通过高斯积分精确计算。对于由 $\\alpha_i(b)$ 和 $\\alpha_j(b)$ 表征的高斯函数对，定义 $\\gamma_{ij}(b)=\\alpha_i(b)+\\alpha_j(b)$，并使用以下积分公式（将在解答中推导）：\n\n- $S_{ij}(b) = \\displaystyle \\int_{-\\infty}^{\\infty} e^{-\\gamma_{ij}(b)x^2}\\,dx = \\dfrac{\\sqrt{\\pi}}{\\sqrt{\\gamma_{ij}(b)}}$。\n- $T_{ij}(b) = \\displaystyle \\frac{1}{2}\\int_{-\\infty}^{\\infty}\\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx}\\,dx = \\dfrac{\\alpha_i(b)\\alpha_j(b)\\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}}$。\n- $V_{ij}(b) = \\displaystyle \\frac{1}{2}\\omega(b)^2 \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij}(b)x^2}\\,dx = \\dfrac{\\omega(b)^2 \\sqrt{\\pi}}{4\\,\\gamma_{ij}(b)^{3/2}}$。\n\n此外，您必须利用 $\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$ 和 $\\omega(b)=b$ 的依赖关系，计算解析导数 $dS/db$ 和 $dH/db$，其中 $H=T+V$。Hellmann–Feynman 贡献仅包含在固定 $\\gamma_{ij}$ 时的显式导数 $\\partial V/\\partial b$。\n\n测试套件：\n为以下参数集 $(N,\\alpha_0,r,b,\\varepsilon)$ 提供结果：\n\n1. $(3,0.5,1.7,1.0,10^{-6})$。\n2. $(5,0.4,1.5,0.8,10^{-6})$。\n3. $(2,0.6,2.0,1.2,10^{-6})$。\n4. $(6,0.3,1.7,1.6,10^{-6})$。\n\n您的程序应：\n- 对每种情况求解广义特征值问题，以获得最低特征值 $E(b)$ 和满足 $\\mathbf{c}^\\top S(b)\\mathbf{c}=1$ 的相应 $S$-归一化特征向量 $\\mathbf{c}$。\n- 使用步长为 $\\varepsilon$ 的中心差分法，计算 $E_{\\mathrm{HF}}(b)$、$E_{\\mathrm{Pulay}}(b)$、总解析导数 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 和有限差分导数 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}}$。\n- 对于每个测试用例，返回列表 $[E_{\\mathrm{HF}}(b),E_{\\mathrm{Pulay}}(b),\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}},\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}},|\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}-\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}}|]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由逗号分隔的列表的列表，并用方括号括起来；例如，输出应如下所示：$[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],\\ldots]$。所有量均为无量纲，且必须以不带单位的浮点数形式报告。",
            "solution": "### 问题验证\n\n问题陈述经过了严格的验证过程。\n\n#### 步骤 1：提取已知条件\n\n- **系统**：一维非相对论性粒子。\n- **单位**：自然单位制，其中 $\\hbar=1$ 和 $m=1$。\n- **哈密顿量**：$H_{\\mathrm{phys}}(b)=T+V(b)$。\n- **动能算符**：$T=-\\frac{1}{2}\\frac{d^2}{dx^2}$。\n- **势能算符**：$V(b)=\\frac{1}{2}\\omega(b)^2 x^2$，其中 $\\omega(b)=b$。\n- **试验态**：通过 Rayleigh-Ritz 方法得到的变分近似 $|\\psi(b)\\rangle = \\sum_i c_i |\\phi_i(b)\\rangle$。\n- **基组**：非正交高斯基组 $\\{\\phi_i(x;b)\\}_{i=0}^{N-1}$。\n- **基函数**：$\\phi_i(x;b)=\\exp(-\\alpha_i(b)x^2)$。\n- **基参数**：$\\alpha_i(b)=\\alpha_0\\,r^{i}/b^2$，其中 $N$ 是基函数数量，$\\alpha_0  0$ 是一个标度，$r1$ 是一个比率，$b0$ 是一个变分长度参数。\n- **广义特征值问题 (GEP)**：$H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$。\n- **矩阵元**：$H_{ij}(b)=\\langle \\phi_i(b)|H_{\\mathrm{phys}}(b)|\\phi_j(b)\\rangle$，$S_{ij}(b)=\\langle \\phi_i(b)|\\phi_j(b)\\rangle$。\n- **Rayleigh-Ritz 能量**：$E(b) = \\frac{\\mathbf{c}^\\top H(b)\\mathbf{c}}{\\mathbf{c}^\\top S(b)\\mathbf{c}}$。\n- **Hellmann–Feynman 贡献**：$E_{\\mathrm{HF}}(b)=\\mathbf{c}^\\top\\big(\\partial H_{\\mathrm{phys}}(b)/\\partial b\\big)_{\\mathrm{proj}}\\mathbf{c}$。\n- **Pulay 贡献**：$E_{\\mathrm{Pulay}}(b)=\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b)$。\n- **数值验证**：比较 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{analytic}}$ 与 $\\left.\\dfrac{dE}{db}\\right|_{\\mathrm{FD}} \\approx \\dfrac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon}$。\n- **积分公式**：\n    - $S_{ij}(b) = \\frac{\\sqrt{\\pi}}{\\sqrt{\\gamma_{ij}(b)}}$ 其中 $\\gamma_{ij}(b)=\\alpha_i(b)+\\alpha_j(b)$。\n    - $T_{ij}(b) = \\frac{\\alpha_i(b)\\alpha_j(b)\\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}}$。\n    - $V_{ij}(b) = \\frac{\\omega(b)^2 \\sqrt{\\pi}}{4\\,\\gamma_{ij}(b)^{3/2}}$。\n- **测试用例**：$(N,\\alpha_0,r,b,\\varepsilon)$ 分别为 $(3,0.5,1.7,1.0,10^{-6})$、$(5,0.4,1.5,0.8,10^{-6})$、$(2,0.6,2.0,1.2,10^{-6})$、$(6,0.3,1.7,1.6,10^{-6})$。\n- **要求输出**：对于每个测试用例，输出列表 $[E_{\\mathrm{HF}}(b), E_{\\mathrm{Pulay}}(b), \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}}, \\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}, |\\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}}-\\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}|]$。\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n- **科学基础**：该问题是量子力学中变分原理的标准应用，是理论和计算物理学的基石。参数依赖基组的使用、Hellmann-Feynman 定理以及 Pulay 力的概念在电子结构理论和计算核物理领域都是公认的。哈密顿量描述的是一个量子谐振子，这是一个基本的模型系统。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。具有实对称矩阵 $H(b)$ 和正定交叠矩阵 $S(b)$ 的 GEP 保证了实数特征值和基态的稳定解。所有必要的参数和定义都已提供，可以获得唯一的数值解。\n- **客观性**：该问题以精确的数学语言陈述，并要求定量的、可验证的结果。它没有歧义和主观性。\n- **完备性**：该问题是自洽的。它提供了所有必需的公式、参数和定义。\n- **一致性**：所提供的积分公式是正确的，并且可以从标准高斯积分推导出来。定义在内部是一致的。\n\n#### 步骤 3：结论与行动\n\n问题陈述是**有效的**。这是一个严谨且定义明确的计算物理任务，基于公认的科学原理。我将继续进行解答。\n\n### 基于原理的求解设计\n\n求解过程需要计算通过 Rayleigh-Ritz 变分法获得的量子谐振子基态能量，关于同时出现在哈密顿量和基组中的参数 $b$ 的导数。\n\n#### 1. 矩阵元的推导\n\n矩阵元是通过计算高斯函数的积分来求得的。关键的标准积分是：\n$$ I_0(a) = \\int_{-\\infty}^{\\infty} e^{-ax^2}\\,dx = \\sqrt{\\frac{\\pi}{a}} $$\n$$ I_2(a) = \\int_{-\\infty}^{\\infty} x^2 e^{-ax^2}\\,dx = -\\frac{dI_0}{da} = \\frac{\\sqrt{\\pi}}{2a^{3/2}} $$\n令 $\\gamma_{ij}(b) = \\alpha_i(b) + \\alpha_j(b)$。矩阵元为：\n- **交叠矩阵 $S(b)$**：\n$$ S_{ij}(b) = \\langle\\phi_i|\\phi_j\\rangle = \\int_{-\\infty}^{\\infty} e^{-\\alpha_i x^2} e^{-\\alpha_j x^2}\\,dx = \\int_{-\\infty}^{\\infty} e^{-\\gamma_{ij} x^2}\\,dx = \\sqrt{\\frac{\\pi}{\\gamma_{ij}(b)}} $$\n- **势能矩阵 $V(b)$**：其中 $V(x,b) = \\frac{1}{2}b^2 x^2$：\n$$ V_{ij}(b) = \\langle\\phi_i|V|\\phi_j\\rangle = \\frac{1}{2}b^2 \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij} x^2}\\,dx = \\frac{1}{2}b^2 \\left(\\frac{\\sqrt{\\pi}}{2\\gamma_{ij}^{3/2}}\\right) = \\frac{b^2 \\sqrt{\\pi}}{4\\gamma_{ij}(b)^{3/2}} $$\n- **动能矩阵 $T$**：对 $\\langle\\phi_i|T|\\phi_j\\rangle = -\\frac{1}{2}\\int \\phi_i (d^2\\phi_j/dx^2) dx$ 使用分部积分法：\n$$ T_{ij}(b) = \\frac{1}{2} \\int_{-\\infty}^{\\infty} \\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx}\\,dx = \\frac{1}{2}\\int_{-\\infty}^{\\infty} (-2\\alpha_i x e^{-\\alpha_i x^2})(-2\\alpha_j x e^{-\\alpha_j x^2})\\,dx = 2\\alpha_i\\alpha_j \\int_{-\\infty}^{\\infty} x^2 e^{-\\gamma_{ij}x^2}\\,dx = 2\\alpha_i\\alpha_j \\left(\\frac{\\sqrt{\\pi}}{2\\gamma_{ij}^{3/2}}\\right) = \\frac{\\alpha_i\\alpha_j \\sqrt{\\pi}}{\\gamma_{ij}(b)^{3/2}} $$\n这些推导证实了问题陈述中提供的公式。哈密顿矩阵为 $H(b) = T(b) + V(b)$。\n\n#### 2. 广义特征值问题 (GEP)\n对于给定的参数集 $(N,\\alpha_0, r, b)$，我们构造 $N \\times N$ 矩阵 $S(b)$ 和 $H(b)$。求解 GEP $H(b)\\mathbf{c} = E(b) S(b)\\mathbf{c}$ 以找到特征值 $E_k(b)$ 和相应的特征向量 $\\mathbf{c}_k$。最低的特征值是基态能量 $E(b)$。相关的特征向量 $\\mathbf{c}$ 被归一化，使得 $\\mathbf{c}^\\top S(b)\\mathbf{c} = 1$。\n\n#### 3. 能量的总解析导数\n对于依赖于参数 $b$ 的非正交基，瑞利商在解点处的导数由广义 Hellmann-Feynman 定理给出：\n$$ \\frac{dE}{db} = \\mathbf{c}^\\top\\left(\\frac{dH}{db} - E\\frac{dS}{db}\\right)\\mathbf{c} $$\n这需要矩阵元对 $b$ 的导数。依赖关系为 $\\alpha_k(b) = \\alpha_0 r^k b^{-2}$ 和 $\\omega(b)=b$。基参数的导数为 $\\frac{d\\alpha_k}{db} = -2\\alpha_0 r^k b^{-3} = -2\\frac{\\alpha_k}{b}$。因此，$\\frac{d\\gamma_{ij}}{db} = -2\\frac{\\gamma_{ij}}{b}$。\n\n- **$S_{ij}(b)$ 的导数**：\n$$ \\frac{dS_{ij}}{db} = \\frac{d}{db}\\left(\\sqrt{\\pi}\\gamma_{ij}^{-1/2}\\right) = \\sqrt{\\pi}\\left(-\\frac{1}{2}\\gamma_{ij}^{-3/2}\\right)\\frac{d\\gamma_{ij}}{db} = -\\frac{\\sqrt{\\pi}}{2}\\gamma_{ij}^{-3/2}\\left(-2\\frac{\\gamma_{ij}}{b}\\right) = \\frac{\\sqrt{\\pi}\\gamma_{ij}^{-1/2}}{b} = \\frac{S_{ij}}{b} $$\n- **$T_{ij}(b)$ 的导数**：\n$T_{ij}$ 正比于 $\\alpha_i\\alpha_j \\gamma_{ij}^{-3/2} \\propto (b^{-4})(b^3) = b^{-1}$。\n$$ \\frac{dT_{ij}}{db} = -\\frac{T_{ij}}{b} $$\n- **$V_{ij}(b)$ 的导数**：\n$V_{ij}$ 正比于 $b^2 \\gamma_{ij}^{-3/2} \\propto b^2 b^3 = b^5$。\n$$ \\frac{dV_{ij}}{db} = \\frac{5V_{ij}}{b} $$\n因此，哈密顿矩阵的导数为 $\\frac{dH_{ij}}{db} = \\frac{dT_{ij}}{db} + \\frac{dV_{ij}}{db} = \\frac{1}{b}(-T_{ij} + 5V_{ij})$。\n将这些代入总导数的公式中：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = \\frac{1}{b}\\mathbf{c}^\\top\\left((-T + 5V) - E S\\right)\\mathbf{c} = \\frac{1}{b}(-\\langle T \\rangle + 5\\langle V \\rangle - E) $$\n其中 $\\langle O \\rangle = \\mathbf{c}^\\top O \\mathbf{c}$ 且 $\\mathbf{c}^\\top S \\mathbf{c}=1$。由于 $E=\\langle T \\rangle + \\langle V \\rangle$，我们可以简化为：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = \\frac{1}{b}(-\\langle T \\rangle + 5\\langle V \\rangle - (\\langle T \\rangle + \\langle V \\rangle)) = \\frac{2}{b}(2\\langle V \\rangle - \\langle T \\rangle) $$\n\n#### 4. Hellmann-Feynman 和 Pulay 贡献\n- **Hellmann-Feynman 项 ($E_{\\mathrm{HF}}$)**：这被定义为物理哈密顿量显式导数的期望值，同时保持基组固定。$H_{\\mathrm{phys}}(b) = T + \\frac{1}{2}b^2x^2$。显式导数为 $\\frac{\\partial H_{\\mathrm{phys}}(b)}{\\partial b} = b x^2$。该算符的矩阵为 $(\\frac{\\partial H}{\\partial b})_{\\mathrm{proj}, ij} = \\langle \\phi_i | b x^2 | \\phi_j \\rangle = b \\int x^2 e^{-\\gamma_{ij}x^2}dx$。从 $V_{ij}$ 的推导可知 $\\int x^2 e^{-\\gamma_{ij}x^2}dx = \\frac{2V_{ij}}{b^2}$，因此 $(\\frac{\\partial H}{\\partial b})_{\\mathrm{proj}, ij} = b \\left(\\frac{2V_{ij}}{b^2}\\right) = \\frac{2V_{ij}}{b}$。HF 贡献是该矩阵的期望值：\n$$ E_{\\mathrm{HF}}(b) = \\mathbf{c}^\\top \\left(\\frac{2V}{b}\\right) \\mathbf{c} = \\frac{2}{b}\\langle V \\rangle $$\n- **Pulay 项 ($E_{\\mathrm{Pulay}}$)**：这被定义为总导数的余项，它解释了基函数对 $b$ 的依赖性。\n$$ E_{\\mathrm{Pulay}}(b) = \\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} - E_{\\mathrm{HF}}(b) = \\frac{2}{b}(2\\langle V \\rangle - \\langle T \\rangle) - \\frac{2}{b}\\langle V \\rangle = \\frac{2}{b}(\\langle V \\rangle - \\langle T \\rangle) $$\n\n#### 5. 数值验证\n解析导数通过与数值中心有限差分近似进行比较来验证：\n$$ \\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}} = \\frac{E(b+\\varepsilon) - E(b-\\varepsilon)}{2\\varepsilon} $$\n这需要对两个微扰的 $b$ 值，$b+\\varepsilon$ 和 $b-\\varepsilon$，求解 GEP，以找到相应的基态能量。\n\n#### 计算算法摘要\n对于每个测试用例 $(N,\\alpha_0,r,b,\\varepsilon)$：\n1. 定义一个函数 `calculate_energy_matrices(b_val, N, alpha0, r)`，它为给定的参数 $b_{\\text{val}}$ 构建并返回矩阵 $S$、$T$ 和 $V$。\n2. 对中心值 $b$ 调用此函数以获得 $S、T、V$。构成 $H=T+V$。\n3. 求解 GEP $H\\mathbf{c}=ES\\mathbf{c}$ 以找到最低特征值 $E(b)$ 和相应的 $S$-归一化特征向量 $\\mathbf{c}$。\n4. 计算期望值 $\\langle T \\rangle = \\mathbf{c}^\\top T \\mathbf{c}$ 和 $\\langle V \\rangle = \\mathbf{c}^\\top V \\mathbf{c}$。\n5. 使用推导出的公式计算导数分量：\n   - $E_{\\mathrm{HF}}(b) = \\frac{2}{b}\\langle V \\rangle$\n   - $E_{\\mathrm{Pulay}}(b) = \\frac{2}{b}(\\langle V \\rangle - \\langle T \\rangle)$\n   - $\\left.\\frac{dE}{db}\\right|_{\\mathrm{analytic}} = E_{\\mathrm{HF}}(b) + E_{\\mathrm{Pulay}}(b)$\n6. 对 $b+\\varepsilon$ 和 $b-\\varepsilon$ 调用矩阵/能量函数以获得 $E(b+\\varepsilon)$ 和 $E(b-\\varepsilon)$。\n7. 计算有限差分导数 $\\left.\\frac{dE}{db}\\right|_{\\mathrm{FD}}$。\n8. 计算解析导数和数值导数之间的绝对差值。\n9. 将五个所需量存储在一个列表中以备最终输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It calculates the analytic and finite-difference derivatives of the ground state energy\n    of a quantum harmonic oscillator using a parameter-dependent Gaussian basis set.\n    \"\"\"\n    test_cases = [\n        (3, 0.5, 1.7, 1.0, 10**-6),\n        (5, 0.4, 1.5, 0.8, 10**-6),\n        (2, 0.6, 2.0, 1.2, 10**-6),\n        (6, 0.3, 1.7, 1.6, 10**-6),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, alpha0, r, b, epsilon = case\n        \n        # --- Step 1: Solve GEP at the central point b ---\n        S, T, V = get_matrices(b, N, alpha0, r)\n        H = T + V\n        \n        # Solve the generalized eigenvalue problem H*c = E*S*c\n        # eigh returns eigenvalues in ascending order and corresponding eigenvectors\n        # Eigenvectors are S-normalized, i.e., c.T @ S @ c = 1.\n        eigenvalues, eigenvectors = eigh(H, S)\n        \n        energy = eigenvalues[0]\n        c = eigenvectors[:, 0]\n        \n        # --- Step 2: Compute expectation values ---\n        exp_T = c.T @ T @ c\n        exp_V = c.T @ V @ c\n        \n        # Sanity check: the sum of expectation values should equal the energy\n        # assert np.isclose(exp_T + exp_V, energy)\n\n        # --- Step 3: Compute analytic derivatives ---\n        # Hellmann-Feynman contribution: E_HF = (2/b) *"
        }
    ]
}