{
    "hands_on_practices": [
        {
            "introduction": "在信号被数字化之前，其瞬时值通常必须被捕获并保持稳定。这个练习  探讨了采样保持（S&H）电路的基本限制，这是许多前端电子学中的关键组件。通过分析由简单 $RC$ 时间常数决定的充电和放电阶段，你将推导出有限的采集时间和保持间隔期间的电压下降如何共同导致幅度测量误差。",
            "id": "3511767",
            "problem": "在计算高能物理读出电路中，一个采样保持 (S&H) 前端用于对成形后的探测器脉冲进行数字化。该S&H电路由一个电容为 $C_{s}$ 的采样电容器构成，在持续时间为 $t_{a}$ 的采集（跟踪）间隔内，通过一个串联电阻 $R_{s}$ 从一个恒定幅度为 $v_{0}$ 的源充电。采集结束时，电路切换到保持状态，将电容器隔离，但存在一个等效漏电阻 $R_{\\text{leak}}$ 导致保持的电压衰减。模数转换器 (ADC) 在切换到保持状态后 $t_{h}$ 时间开始转换。假设最坏情况，即输入在采集开始时从 $0$ 阶跃到 $v_{0}$，动态过程由源自基尔霍夫电流定律的线性一阶阻容微分方程决定，并且保持期间的电压因漏电而遵循相同的一阶定律衰减。\n\n从一阶阻容微分方程\n$$\n\\frac{d v_{c}}{d t}=\\frac{v_{0}-v_{c}}{R_{s} C_{s}} \\quad \\text{(采集)}, \n\\qquad \n\\frac{d v_{c}}{d t}=-\\frac{v_{c}}{R_{\\text{leak}} C_{s}} \\quad \\text{(保持)},\n$$\n出发，推导最大允许保持时间 $t_{h,\\max}$ 的解析表达式，使得在ADC采样时刻的幅度误差满足\n$$\n\\left|v_{0}-v_{\\text{ADC}}(t_{h})\\right| \\leq \\epsilon\\, v_{0},\n$$\n其中 $v_{\\text{ADC}}(t_{h})$ 是进入保持状态后 $t_{h}$ 时刻的保持电压，而 $0<\\epsilon<1$ 是一个指定的分数误差预算。然后，对于给定的参数集\n$$\nR_{s}=1.0\\times 10^{3}\\ \\text{Ω},\\quad C_{s}=50\\times 10^{-12}\\ \\text{F},\\quad R_{\\text{leak}}=1.0\\times 10^{8}\\ \\text{Ω},\\quad t_{a}=400\\times 10^{-9}\\ \\text{s},\\quad \\epsilon=0.010.\n$$\n数值计算 $t_{h,\\max}$。以微秒为单位表示 $t_{h,\\max}$ 的最终答案。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求计算采样保持电路的最大允许保持时间 $t_{h,\\max}$，并针对一组给定参数求其数值。求解过程包括依次求解两个一阶线性常微分方程，然后应用一个误差约束。\n\n整个过程分为三个阶段：\n1.  **采集阶段：** 电容为 $C_s$ 的电容器通过电阻 $R_s$ 向电压 $v_0$ 充电。此阶段持续时间为 $t_a$。\n2.  **保持阶段：** 电容器被隔离，并通过一个大的漏电阻 $R_{\\text{leak}}$ 缓慢放电。\n3.  **ADC转换：** 模数转换器在进入保持阶段后的 $t_h$ 时刻测量电容器电压。\n\n我们首先分析采集阶段。其控制微分方程为：\n$$\n\\frac{d v_{c}}{d t}=\\frac{v_{0}-v_{c}}{R_{s} C_{s}}\n$$\n我们定义充电时间常数为 $\\tau_s = R_s C_s$。该方程可重写为：\n$$\n\\frac{d v_{c}}{d t} + \\frac{1}{\\tau_s} v_c = \\frac{v_0}{\\tau_s}\n$$\n这是一个标准的一阶线性非齐次微分方程。其通解是齐次解 $A \\exp(-t/\\tau_s)$ 和一个特解之和，通过观察可知特解为 $v_0$。\n$$\nv_c(t) = v_0 + A \\exp\\left(-\\frac{t}{\\tau_s}\\right)\n$$\n问题陈述了输入在采集开始时从 $0$ 阶跃到 $v_0$，这意味着初始条件为 $v_c(0) = 0$。我们用此条件来求出常数 $A$：\n$$\n0 = v_0 + A \\exp(0) \\implies A = -v_0\n$$\n因此，在采集阶段，电容器两端的电压为：\n$$\nv_c(t) = v_0 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_s}\\right)\\right)\n$$\n在采集间隔 $t_a$ 结束时，电容器上的电压为：\n$$\nv_c(t_a) = v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right)\n$$\n该电压作为随后的保持阶段的初始条件。我们将其表示为 $v_{\\text{hold},0} = v_c(t_a)$。\n\n接下来，我们分析保持阶段。其控制微分方程为：\n$$\n\\frac{d v_{c}}{d t}=-\\frac{v_{c}}{R_{\\text{leak}} C_{s}}\n$$\n我们定义漏电时间常数为 $\\tau_{\\text{leak}} = R_{\\text{leak}} C_s$。该方程变为：\n$$\n\\frac{d v_{c}}{d t} = -\\frac{1}{\\tau_{\\text{leak}}} v_c\n$$\n这是一个一阶齐次微分方程。我们从保持阶段开始计时。其解的形式为：\n$$\nv_c(t) = B \\exp\\left(-\\frac{t}{\\tau_{\\text{leak}}}\\right)\n$$\n此阶段的初始条件是 $v_c(0) = v_{\\text{hold},0} = v_c(t_a)$。所以，$B=v_c(t_a)$，在保持阶段的电压为：\n$$\nv_c(t) = v_c(t_a) \\exp\\left(-\\frac{t}{\\tau_{\\text{leak}}}\\right)\n$$\nADC在进入保持状态后的 $t_h$ 时刻对该电压进行采样。所以，$v_{\\text{ADC}}(t_h)$ 是：\n$$\nv_{\\text{ADC}}(t_h) = v_c(t_a) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) = v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right)\n$$\n问题指定了一个误差条件：\n$$\n\\left|v_{0}-v_{\\text{ADC}}(t_{h})\\right| \\leq \\epsilon\\, v_{0}\n$$\n由于电容器是从下方往 $v_0$ 充电的，所以 $v_c(t_a) < v_0$。在保持阶段，电压只会进一步衰减。因此，$v_{\\text{ADC}}(t_h) \\leq v_c(t_a) < v_0$，这意味着 $v_0 - v_{\\text{ADC}}(t_h)$ 这一项恒为正。我们可以去掉绝对值符号：\n$$\nv_{0}-v_{\\text{ADC}}(t_{h}) \\leq \\epsilon\\, v_{0}\n$$\n代入 $v_{\\text{ADC}}(t_h)$ 的表达式：\n$$\nv_0 - v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\leq \\epsilon v_0\n$$\n两边同除以 $v_0$（这是一个正幅度）：\n$$\n1 - \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\leq \\epsilon\n$$\n我们重新整理不等式以解出 $t_h$：\n$$\n1 - \\epsilon \\leq \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right)\n$$\n$$\n\\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\geq \\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\n$$\n对两边取自然对数：\n$$\n-\\frac{t_h}{\\tau_{\\text{leak}}} \\geq \\ln\\left(\\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\\right)\n$$\n两边同乘以 $-\\tau_{\\text{leak}}$（一个正量），不等号反向：\n$$\nt_h \\leq -\\tau_{\\text{leak}} \\ln\\left(\\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\\right)\n$$\n使用对数性质 $-\\ln(x/y) = \\ln(y/x)$：\n$$\nt_h \\leq \\tau_{\\text{leak}} \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}{1-\\epsilon}\\right)\n$$\n最大允许保持时间 $t_{h,\\max}$ 对应于等式成立的情况：\n$$\nt_{h,\\max} = \\tau_{\\text{leak}} \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}{1-\\epsilon}\\right) = R_{\\text{leak}} C_s \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{R_s C_s}\\right)}{1-\\epsilon}\\right)\n$$\n这就是所求的解析表达式。\n\n现在，我们根据给定的数值计算 $t_{h,\\max}$：\n$R_{s}=1.0\\times 10^{3}\\ \\Omega$\n$C_{s}=50\\times 10^{-12}\\ \\text{F}$\n$R_{\\text{leak}}=1.0\\times 10^{8}\\ \\Omega$\n$t_{a}=400\\times 10^{-9}\\ \\text{s}$\n$\\epsilon=0.010$\n\n首先，计算时间常数：\n充电时间常数为 $\\tau_s = R_s C_s = (1.0 \\times 10^3\\ \\Omega) \\times (50 \\times 10^{-12}\\ \\text{F}) = 50 \\times 10^{-9}\\ \\text{s}$。\n漏电时间常数为 $\\tau_{\\text{leak}} = R_{\\text{leak}} C_s = (1.0 \\times 10^8\\ \\Omega) \\times (50 \\times 10^{-12}\\ \\text{F}) = 5.0 \\times 10^{-3}\\ \\text{s}$。\n\n接下来，计算采集阶段指数的参数：\n$$\n\\frac{t_a}{\\tau_s} = \\frac{400 \\times 10^{-9}\\ \\text{s}}{50 \\times 10^{-9}\\ \\text{s}} = 8\n$$\n将这些值代入 $t_{h,\\max}$ 的表达式中：\n$$\nt_{h,\\max} = (5.0 \\times 10^{-3}\\ \\text{s}) \\times \\ln\\left(\\frac{1 - \\exp(-8)}{1-0.010}\\right)\n$$\n$$\nt_{h,\\max} = (5.0 \\times 10^{-3}) \\times \\ln\\left(\\frac{1 - \\exp(-8)}{0.99}\\right)\n$$\n现在，我们计算其数值：\n$1 - \\exp(-8) \\approx 1 - 0.0003354626 = 0.9996645374$\n$$\n\\frac{0.9996645374}{0.99} \\approx 1.009762159\n$$\n$$\n\\ln(1.009762159) \\approx 0.009714710\n$$\n$$\nt_{h,\\max} \\approx (5.0 \\times 10^{-3}) \\times 0.009714710 \\approx 4.857355 \\times 10^{-5}\\ \\text{s}\n$$\n问题要求答案以微秒 ($\\mu\\text{s}$) 为单位。$1\\ \\mu\\text{s} = 10^{-6}\\ \\text{s}$。\n$$\nt_{h,\\max} \\approx 48.57355\\ \\mu\\text{s}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\nt_{h,\\max} \\approx 48.57\\ \\mu\\text{s}\n$$",
            "answer": "$$\n\\boxed{48.57}\n$$"
        },
        {
            "introduction": "在粒子物理实验中，提取精确的时间信息与测量幅度同样重要。这项实践  深入探讨了决定系统时间分辨率的各种因素，它始于一个基本原理：电压噪声通过信号的转换速率（slew rate）转化为时间抖动。你将分析并比较两种基础的定时技术——简单的前沿甄别器（LED）和更先进的恒比定时甄别器（CFD）——以理解它们的性能和经典的“时间走动”问题。",
            "id": "3511856",
            "problem": "一个位于对撞机探测器中的快速硅传感器产生电流脉冲，经过具有单极点响应的前端放大后，在甄别器输入端表现为电压脉冲，其模型为 $v(t) = A \\bigl(1 - \\exp(-(t - t_{0})/\\tau_{r})\\bigr) u(t - t_{0})$，其中 $A$ 是脉冲幅度，$\\tau_{r}$ 是上升时间常数，$t_{0}$ 是真实到达时间，$u(\\cdot)$ 是单位阶跃函数。前端会引入加性、平稳、零均值的高斯电子学噪声，其参考到甄别器输入端的均方根 (RMS) 值为 $\\sigma_{n}$。考虑两种定时架构：一种是具有固定阈值 $V_{\\mathrm{th}}$ 的前沿甄别器 (LED)，另一种是恒比甄别器 (CFD)，其实现方式为一个延迟并缩放的副本的减法，$v_{\\mathrm{CFD}}(t) = v(t) - f\\,v(t - \\Delta)$，后接一个过零比较器。假设 CFD 减法器输入端的噪声是不相关的，并且在每个支路中具有相同的均方根值 $\\sigma_{n}$。两种架构中的比较器都表现出均方根值为 $\\sigma_{\\mathrm{disc}}$ 的内在时间抖动，该抖动与输入转换速率无关。时间-数字转换器 (TDC) 的采样时钟引入了独立的均方根抖动 $\\sigma_{\\mathrm{clk}}$。所有抖动均为零均值高斯分布且相互独立。\n\n从连接由隐式交叉条件定义的时间拾取与微小加性电压扰动对推断时间的影响的第一性原理出发，并且仅使用核心定义和线性化方法，推导出一个总时间分辨率 $\\sigma_{t}$ 的通用表达式，该表达式结合了加性电子学噪声、比较器内在抖动和 TDC 时钟抖动的贡献，适用于：\n- LED，其通过 $v(t_{\\ast}) = V_{\\mathrm{th}}$ 定义 $t_{\\ast}$，以及\n- CFD，其通过 $v_{\\mathrm{CFD}}(t_{\\ast}) = 0$ 定义 $t_{\\ast}$。\n\n对于 CFD，请将您的推导应用于给定的上升指数脉冲，并明确展示在过零点处的有效转换速率和有效均方根噪声如何依赖于分数 $f$ 和延迟 $\\Delta$，并找出在上升沿上获得有效过零所需的对 $\\Delta$ 的任何约束条件。然后，对于以下数值参数集\n- $\\tau_{r} = 250\\,\\mathrm{ps}$，\n- $A = 20\\,\\mathrm{mV}$，\n- $\\sigma_{n} = 0.5\\,\\mathrm{mV}$，\n- $V_{\\mathrm{th}} = 5\\,\\mathrm{mV}$，\n- $f = 0.2$，\n- $\\Delta = 200\\,\\mathrm{ps}$，\n- $\\sigma_{\\mathrm{disc}} = 5\\,\\mathrm{ps}$，\n- $\\sigma_{\\mathrm{clk}} = 12\\,\\mathrm{ps}$，\n\n计算 LED 和 CFD 的总时间分辨率 $\\sigma_{t}$。将您的最终数值结果四舍五入到四位有效数字，并以皮秒为单位表示 $\\sigma_{t}$。",
            "solution": "该问题提法恰当，有科学依据，并包含了推导所需时间分辨率的所有必要信息。我们将开始求解。\n\n将微小电压扰动（噪声）$\\delta v$ 与微小时间误差（抖动）$\\delta t$ 联系起来的基本原理，是通过将信号 $v(t)$ 在时间拾取点 $t_{\\ast}$ 附近进行线性化推导出来的。设拾取时间 $t_{\\ast}$ 由隐式条件 $F(v(t_{\\ast})) = C$ 定义，其中 $C$ 是一个常数。在存在微小的加性噪声电压 $n(t)$ 的情况下，该条件在一个略微不同的时间 $t_{\\ast} + \\delta t$ 得到满足，因此 $F(v(t_{\\ast} + \\delta t) + n(t_{\\ast})) = C$。\n\n对于一个简单的阈值穿越，例如在前沿甄别器 (LED) 中，条件是 $v(t_{\\ast}) = V_{\\mathrm{th}}$。有噪声时，这变为 $v(t_{\\ast} + \\delta t) + n(t_{\\ast}) = V_{\\mathrm{th}}$。将 $v(t)$ 在 $t_{\\ast}$ 附近泰勒展开到一阶，得到 $v(t_{\\ast} + \\delta t) \\approx v(t_{\\ast}) + \\frac{dv}{dt}\\big|_{t_{\\ast}} \\delta t$。将此式和原始条件 $v(t_{\\ast}) = V_{\\mathrm{th}}$ 代入受扰动的方程中，我们得到 $V_{\\mathrm{th}} + \\frac{dv}{dt}\\big|_{t_{\\ast}} \\delta t + n(t_{\\ast}) \\approx V_{\\mathrm{th}}$。这可以简化为 $\\delta t \\approx - \\frac{n(t_{\\ast})}{\\frac{dv}{dt}\\big|_{t_{\\ast}}}$。\n\n时间抖动的方差 $\\sigma_{t, \\text{noise}}^2$ 是 $(\\delta t)^2$ 的期望值。由于噪声 $n(t)$ 是一个均方根值为 $\\sigma_n$ 的平稳零均值过程，我们有 $\\mathbb{E}[n(t_{\\ast})^2] = \\sigma_n^2$。因此，由电子学噪声引起的抖动贡献由下式给出\n$$\n\\sigma_{t, \\text{noise}}^2 = \\mathbb{E}[(\\delta t)^2] = \\frac{\\mathbb{E}[n(t_{\\ast})^2]}{\\left(\\frac{dv}{dt}\\big|_{t_{\\ast}}\\right)^2} = \\left(\\frac{\\sigma_n}{\\frac{dv}{dt}\\big|_{t_{\\ast}}}\\right)^2\n$$\n项 $\\frac{dv}{dt}\\big|_{t_{\\ast}}$ 是信号在穿越时间点的转换速率。同样的原理也适用于更复杂的定时信号，例如在恒比甄别器 (CFD) 中，只需使用定时信号在其过零点处的有效转换速率和有效噪声即可。\n\n总时间分辨率 $\\sigma_t$ 是所有独立抖动源的平方和。问题指明了三个这样的源：电子学噪声 ($\\sigma_{t, \\text{noise}}$)、甄别器内在抖动 ($\\sigma_{\\mathrm{disc}}$) 和 TDC 时钟抖动 ($\\sigma_{\\mathrm{clk}}$)。因此，总时间分辨率为：\n$$\n\\sigma_t = \\sqrt{\\sigma_{t, \\text{noise}}^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\n我们现在将此框架应用于 LED 和 CFD 架构。电压脉冲由 $v(t) = A \\bigl(1 - \\exp(-(t - t_{0})/\\tau_{r})\\bigr) u(t - t_{0})$ 给出，为了计算方便，不失一般性，我们可以设置 $t_0=0$。\n\n**1. 前沿甄别器 (LED)**\n\n对于 LED，时间拾取点 $t_{\\ast}$ 由 $v(t_{\\ast}) = V_{\\mathrm{th}}$ 定义。\n$$\nA \\bigl(1 - \\exp(-t_{\\ast}/\\tau_{r})\\bigr) = V_{\\mathrm{th}} \\implies \\exp(-t_{\\ast}/\\tau_{r}) = 1 - \\frac{V_{\\mathrm{th}}}{A} = \\frac{A - V_{\\mathrm{th}}}{A}\n$$\n信号的转换速率为 $\\frac{dv}{dt} = \\frac{d}{dt}\\left[A(1-\\exp(-t/\\tau_r))\\right] = \\frac{A}{\\tau_r}\\exp(-t/\\tau_r)$。\n在穿越时间 $t_{\\ast}$ 处计算转换速率：\n$$\n\\frac{dv}{dt}\\bigg|_{t_{\\ast}} = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r) = \\frac{A}{\\tau_r}\\left(\\frac{A - V_{\\mathrm{th}}}{A}\\right) = \\frac{A - V_{\\mathrm{th}}}{\\tau_r}\n$$\n则噪声对抖动的贡献为：\n$$\n\\sigma_{t, \\text{noise, LED}} = \\frac{\\sigma_n}{\\frac{dv}{dt}\\big|_{t_{\\ast}}} = \\frac{\\sigma_n}{(A - V_{\\mathrm{th}})/\\tau_r} = \\frac{\\sigma_n \\tau_r}{A - V_{\\mathrm{th}}}\n$$\nLED 的总时间分辨率为：\n$$\n\\sigma_{t, \\text{LED}} = \\sqrt{\\left(\\frac{\\sigma_n \\tau_r}{A - V_{\\mathrm{th}}}\\right)^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\n**2. 恒比甄别器 (CFD)**\n\nCFD 形成一个双极性信号 $v_{\\mathrm{CFD}}(t) = v(t) - f\\,v(t - \\Delta)$，时间拾取点 $t_{\\ast}$ 在其过零点，即 $v_{\\mathrm{CFD}}(t_{\\ast}) = 0$。这意味着 $v(t_{\\ast}) = f\\,v(t_{\\ast} - \\Delta)$。\n\n抖动由 $v_{\\mathrm{CFD}}(t)$ 的有效转换速率和该信号上的有效噪声决定。在 $t_{\\ast}$ 处的有效转换速率为：\n$$\nS_{\\text{eff}} = \\frac{dv_{\\mathrm{CFD}}}{dt}\\bigg|_{t_{\\ast}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\frac{d v(t - \\Delta)}{dt}\\bigg|_{t_{\\ast}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\frac{dv}{dt}\\bigg|_{t_{\\ast}-\\Delta}\n$$\nCFD 信号上的噪声为 $n_{\\mathrm{CFD}}(t) = n_1(t) - f n_2(t)$，其中 $n_1(t)$ 和 $n_2(t)$ 分别是来自非延迟和延迟支路的噪声贡献。问题说明它们是不相关的，并且每个支路的均方根值均为 $\\sigma_n$。有效噪声的方差为：\n$$\n\\sigma_{n, \\text{eff}}^2 = \\mathbb{E}[n_{\\mathrm{CFD}}^2] = \\mathbb{E}[(n_1 - fn_2)^2] = \\mathbb{E}[n_1^2] - 2f\\mathbb{E}[n_1 n_2] + f^2\\mathbb{E}[n_2^2] = \\sigma_n^2 + f^2\\sigma_n^2 = (1+f^2)\\sigma_n^2\n$$\n所以，有效均方根噪声为 $\\sigma_{n, \\text{eff}} = \\sigma_n \\sqrt{1+f^2}$。\n\n现在，我们针对给定的脉冲形状，以获得 $S_{\\text{eff}}$ 的更明确表达式。过零条件为：\n$$\nA(1-\\exp(-t_{\\ast}/\\tau_r)) = f A(1-\\exp(-(t_{\\ast}-\\Delta)/\\tau_r))\n$$\n$$\n1-\\exp(-t_{\\ast}/\\tau_r) = f(1-\\exp(-t_{\\ast}/\\tau_r)\\exp(\\Delta/\\tau_r))\n$$\n令 $x = \\exp(-t_{\\ast}/\\tau_r)$，我们求解 $x$：$1-x = f(1-x\\exp(\\Delta/\\tau_r)) \\implies 1-f = x(1-f\\exp(\\Delta/\\tau_r))$，得到\n$$\nx = \\exp(-t_{\\ast}/\\tau_r) = \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}\n$$\n为了得到一个有物理意义的解 ($t_{\\ast}>0$)，我们需要 $0  x  1$。由于 $f1$，分子 $1-f$ 为正。为了使分母为正，我们需要 $1-f\\exp(\\Delta/\\tau_r) > 0$，这就得出了对延迟 $\\Delta$ 的约束条件：\n$$\n\\Delta  \\tau_r \\ln(1/f)\n$$\n对于 $\\Delta0$ 和 $f1$，条件 $x1$ 总是满足的。\n\n转换速率项为：\n$\\frac{dv}{dt}\\big|_{t_{\\ast}} = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r) = \\frac{A}{\\tau_r} \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}$。\n$\\frac{dv}{dt}\\big|_{t_{\\ast}-\\Delta} = \\frac{A}{\\tau_r}\\exp(-(t_{\\ast}-\\Delta)/\\tau_r) = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r)\\exp(\\Delta/\\tau_r) = \\frac{dv}{dt}\\big|_{t_{\\ast}}\\exp(\\Delta/\\tau_r)$。\n\n因此，有效转换速率为：\n$$\nS_{\\text{eff}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\left(\\frac{dv}{dt}\\bigg|_{t_{\\ast}}\\exp(\\Delta/\\tau_r)\\right) = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} \\left(1 - f\\exp(\\Delta/\\tau_r)\\right)\n$$\n代入 $\\frac{dv}{dt}\\big|_{t_{\\ast}}$ 的表达式：\n$$\nS_{\\text{eff}} = \\left(\\frac{A}{\\tau_r} \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}\\right) \\left(1 - f\\exp(\\Delta/\\tau_r)\\right) = \\frac{A(1-f)}{\\tau_r}\n$$\n这就是有效转换速率的明确依赖关系。它取决于 $f$ 但不取决于 $\\Delta$。有效均方根噪声 $\\sigma_{n, \\text{eff}} = \\sigma_n\\sqrt{1+f^2}$ 取决于 $f$ 但不取决于 $\\Delta$。\n\nCFD 的噪声抖动贡献为：\n$$\n\\sigma_{t, \\text{noise, CFD}} = \\frac{\\sigma_{n, \\text{eff}}}{S_{\\text{eff}}} = \\frac{\\sigma_n \\sqrt{1+f^2}}{A(1-f)/\\tau_r} = \\frac{\\tau_r \\sigma_n \\sqrt{1+f^2}}{A(1-f)}\n$$\nCFD 的总时间分辨率为：\n$$\n\\sigma_{t, \\text{CFD}} = \\sqrt{\\left(\\frac{\\tau_r \\sigma_n \\sqrt{1+f^2}}{A(1-f)}\\right)^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\n**3. 数值计算**\n\n给定的参数为：\n$\\tau_{r} = 250\\,\\mathrm{ps}$，$A = 20\\,\\mathrm{mV}$，$\\sigma_{n} = 0.5\\,\\mathrm{mV}$，$V_{\\mathrm{th}} = 5\\,\\mathrm{mV}$，$f = 0.2$，$\\Delta = 200\\,\\mathrm{ps}$，$\\sigma_{\\mathrm{disc}} = 5\\,\\mathrm{ps}$，$\\sigma_{\\mathrm{clk}} = 12\\,\\mathrm{ps}$。\n\n**对于 LED：**\n噪声引起的抖动贡献为：\n$$\n\\sigma_{t, \\text{noise, LED}} = \\frac{(0.5\\,\\mathrm{mV})(250\\,\\mathrm{ps})}{20\\,\\mathrm{mV} - 5\\,\\mathrm{mV}} = \\frac{125}{15}\\,\\mathrm{ps} = \\frac{25}{3}\\,\\mathrm{ps} \\approx 8.333\\,\\mathrm{ps}\n$$\n总时间分辨率为：\n$$\n\\sigma_{t, \\text{LED}} = \\sqrt{\\left(\\frac{25}{3}\\right)^2 + 5^2 + 12^2}\\,\\mathrm{ps} = \\sqrt{\\frac{625}{9} + 25 + 144}\\,\\mathrm{ps} = \\sqrt{69.444\\dots + 169}\\,\\mathrm{ps} = \\sqrt{238.444\\dots}\\,\\mathrm{ps} \\approx 15.4416\\,\\mathrm{ps}\n$$\n四舍五入到四位有效数字，$\\sigma_{t, \\text{LED}} = 15.44\\,\\mathrm{ps}$。\n\n**对于 CFD：**\n首先，我们检查对 $\\Delta$ 的约束条件：\n$$\n\\Delta  \\tau_r \\ln(1/f) \\implies 200\\,\\mathrm{ps}  (250\\,\\mathrm{ps})\\ln(1/0.2) = (250\\,\\mathrm{ps})\\ln(5) \\approx (250\\,\\mathrm{ps})(1.6094) \\approx 402.4\\,\\mathrm{ps}\n$$\n条件 $200  402.4$ 得到满足。\n噪声引起的抖动贡献为：\n$$\n\\sigma_{t, \\text{noise, CFD}} = \\frac{(250\\,\\mathrm{ps})(0.5\\,\\mathrm{mV})\\sqrt{1 + 0.2^2}}{(20\\,\\mathrm{mV})(1-0.2)} = \\frac{125\\sqrt{1.04}}{16}\\,\\mathrm{ps} \\approx \\frac{125 \\times 1.0198}{16}\\,\\mathrm{ps} \\approx 7.9672\\,\\mathrm{ps}\n$$\n总时间分辨率为：\n$$\n\\sigma_{t, \\text{CFD}} = \\sqrt{(7.9672\\dots)^2 + 5^2 + 12^2}\\,\\mathrm{ps} = \\sqrt{63.476\\dots + 25 + 144}\\,\\mathrm{ps} = \\sqrt{232.476\\dots}\\,\\mathrm{ps} \\approx 15.2472\\,\\mathrm{ps}\n$$\n四舍五入到四位有效数字，$\\sigma_{t, \\text{CFD}} = 15.25\\,\\mathrm{ps}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 15.44  15.25 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "从模拟到数字的最终转换由ADC或TDC完成，但这些设备并非完美线性。这个动手练习  将指导你完成校准时间数字转换器（TDC）以修正其固有非线性的基本过程。通过分析来自均匀时间扫描的计数统计分布，你将学会计算差分非线性（DNL）和积分非线性（INL）等标准性能指标，并应用校准图来以最高精度重建时间戳。",
            "id": "3511823",
            "problem": "您将获得使用时间数字转换器 (TDC) 采集的数据，该转换器用于计算高能物理中探测器信号的数字化。TDC 将一个时钟周期划分为 $N$ 个离散的时间箱，由于微分非线性 (DNL) 的影响，这些时间箱的真实宽度可能不均匀。通过在整个 TDC 周期内均匀扫描注入的延迟，并统计落入每个时间箱的击中数，来执行校准。在一个物理上现实的假设下，即注入时间在整个周期内均匀分布，且每个时间箱中的计数是独立的并遵循泊松统计，时间箱宽度的最大似然估计与观测到的计数成正比。任务是实现时间箱宽度的校准，计算微分非线性 (DNL) 和积分非线性 (INL)，并使用基于最大似然原理的逐箱校准图来重构事件时间戳。\n\n使用以下基本原理：\n- 均匀照射：如果真实到达时间 $t$ 在 $[0,T)$ 上均匀分布，则 $t$ 落入时间箱 $j$ 的概率等于时间箱 $j$ 的真实宽度分数。\n- 时间箱 $j$ 中计数的泊松似然：如果在总计数为 $C=\\sum_{k=0}^{N-1} c_k$ 的情况下，在时间箱 $j$ 中观测到 $c_j$ 个事件，那么真实时间箱宽度的最大似然估计为 $\\hat{w}_j = \\frac{c_j}{C} T$。\n- 理想时间箱宽度：$w_{\\text{ideal}} = \\frac{T}{N}$。\n- 微分非线性：$\\text{DNL}_j = \\frac{\\hat{w}_j}{w_{\\text{ideal}}} - 1$。\n- 校准后的边缘：$\\hat{e}_0 = 0$ 且当 $j \\ge 1$ 时 $\\hat{e}_j = \\sum_{k=0}^{j-1} \\hat{w}_k$。\n- 理想边缘：$e_j^{\\text{ideal}} = j \\cdot w_{\\text{ideal}}$。\n- 时间箱 $j$ 上边缘处的积分非线性：对于 $j = 1,2,\\ldots,N$，$\\text{INL}_j = \\frac{\\hat{e}_j - e_j^{\\text{ideal}}}{w_{\\text{ideal}}}$。\n- 对于报告原始箱码为 $b$、没有额外箱内子信息且在箱内具有均匀先验的事件，其最大似然时间戳为：由于似然在校准后的区间 $[\\hat{e}_b,\\hat{e}_{b+1})$ 上是恒定的，最大似然估计被设为中点，即 $\\hat{t}_b = \\hat{e}_b + \\frac{1}{2}\\hat{w}_b$。\n\n实现一个程序，该程序：\n1. 使用从均匀延迟扫描计数中导出的最大似然法则，为所有时间箱 $j$ 计算 $\\hat{w}_j$。\n2. 为所有时间箱计算 $\\text{DNL}_j$ 和 $\\text{INL}_j$。\n3. 使用逐箱校准图，为提供的原始箱码 $b$ 重构事件时间戳 $\\hat{t}_b$。\n\n将重构的时间戳以纳秒为单位表示为浮点数。微分非线性和积分非线性是无量纲的，应作为十进制浮点数输出。输出中的所有浮点数必须打印到小数点后六位。\n\n测试套件：\n提供一组由元组 $(N, T, \\text{counts}, \\text{events})$ 定义的测试用例，其中 $N$ 是时间箱的数量， $T$ 是以纳秒为单位的 TDC 周期，$\\text{counts}$ 是来自延迟扫描的每箱计数列表，$\\text{events}$ 是待重构的原始箱码列表。使用以下测试用例：\n- 情况1（一般情况）：$N=8$, $T=25.0$ ns, $\\text{counts} = [110,95,90,120,130,80,85,90]$, $\\text{events} = [0,3,7]$。\n- 情况2（边界情况：零计数箱）：$N=16$, $T=10.0$ ns, $\\text{counts} = [100,90,85,95,110,120,0,80,75,70,105,115,95,85,100,100]$, $\\text{events} = [6,0,15]$。\n- 情况3（边界情况：均匀计数）：$N=4$, $T=5.0$ ns, $\\text{counts} = [250,250,250,250]$, $\\text{events} = [2,1]$。\n\n对于每个测试用例，程序必须生成一个包含三个列表的列表：$j=0,\\ldots,N-1$ 的 $\\text{DNL}_j$ 列表，$j=1,\\ldots,N$ 的 $\\text{INL}_j$ 列表，以及与给定 $\\text{events}$ 对应的重构时间戳列表。最终输出必须是单行，包含这些逐测试用例列表的逗号分隔列表，并用方括号括起来，不含空格。例如，输出的形状是 $[[\\text{DNLs}_1,\\text{INLs}_1,\\text{timestamps}_1],[\\text{DNLs}_2,\\text{INLs}_2,\\text{timestamps}_2],[\\text{DNLs}_3,\\text{INLs}_3,\\text{timestamps}_3]]$。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它在科学上基于粒子探测器信号处理的原理，特别是时间数字转换器 (TDC) 的校准。该问题定义明确、客观，并提供了一套完整且一致的定义、公式和测试数据，足以得出一个唯一的、可验证的解决方案。所有术语在实验物理学和电子仪器领域都是标准术语。因此，我们可以着手解决此问题。\n\n任务是基于均匀延迟扫描的统计数据来执行 TDC 校准。这涉及三个主要的计算步骤：\n1.  估计每个 TDC 时间箱的真实宽度。\n2.  通过微分非线性 (DNL) 和积分非线性 (INL) 的标准度量来量化 TDC 的非线性。\n3.  使用导出的校准常数来重构新探测器信号的精确到达时间。\n\n我们将使用所提供的最大似然框架系统地处理每个步骤。\n\n**1. 时间箱宽度估计 ($\\hat{w}_j$)**\n\n校准的基础建立在一个假设之上：注入的校准信号的到达时间 $t$ 在 TDC 测量周期 $[0, T)$ 内是均匀分布的。在此条件下，一个信号落入特定时间箱 $j$ 的概率与该时间箱的宽度分数成正比。给定总共 $C = \\sum_{k=0}^{N-1} c_k$ 个校准事件（击中），其中 $c_j$ 是时间箱 $j$ 中的击中数，则时间箱 $j$ 的真实宽度（表示为 $\\hat{w}_j$）的最大似然估计由下式给出：\n$$\n\\hat{w}_j = \\frac{c_j}{C} T\n$$\n该公式根据观测到的击中数，按比例将总周期 $T$ 重新分配给 $N$ 个时间箱。收集到更多击中的时间箱被推断为比收集到较少击中的时间箱更宽。所有估计宽度的总和 $\\sum_{j=0}^{N-1} \\hat{w}_j$ 正好等于总周期 $T$。\n\n**2. DNL 和 INL 的计算**\n\n微分和积分非线性是用于表征数据转换器性能的标准度量。\n\n**微分非线性 ($\\text{DNL}_j$)**\nDNL 衡量每个独立时间箱的宽度与理想宽度的偏差。对于一个在周期 $T$ 内有 $N$ 个时间箱的 TDC，所有时间箱的理想宽度是均匀的：\n$$\nw_{\\text{ideal}} = \\frac{T}{N}\n$$\n时间箱 $j$ 的 DNL 随之定义为其估计宽度与理想宽度之间的归一化差异：\n$$\n\\text{DNL}_j = \\frac{\\hat{w}_j}{w_{\\text{ideal}}} - 1\n$$\n$\\text{DNL}_j = 0$ 表示理想的时间箱宽度。$\\text{DNL}_j  0$ 表示时间箱比理想值宽，而 $\\text{DNL}_j  0$ 表示时间箱比理想值窄。$\\text{DNL}_j = -1$ 的值意味着该时间箱宽度为零，实际上是一个“丢失码”。\n\n**积分非线性 ($\\text{INL}_j$)**\nINL 衡量 DNL 的累积效应，表征了时间箱转换点（边缘）与其理想位置的偏差。首先，我们定义理想和校准后的时间箱边缘。理想边缘 $e_j^{\\text{ideal}}$ 是均匀间隔的：\n$$\ne_j^{\\text{ideal}} = j \\cdot w_{\\text{ideal}}\n$$\n校准后的边缘 $\\hat{e}_j$ 通过累加估计的时间箱宽度得到：\n$$\n\\hat{e}_0 = 0 \\quad \\text{and} \\quad \\hat{e}_j = \\sum_{k=0}^{j-1} \\hat{w}_k \\quad \\text{for } j \\ge 1\n$$\nINL 随之在每个时间箱 $j-1$ 的上边缘处（即位置 $\\hat{e}_j$）定义为与理想边缘位置的归一化偏差。对于 $j = 1, 2, \\ldots, N$：\n$$\n\\text{INL}_j = \\frac{\\hat{e}_j - e_j^{\\text{ideal}}}{w_{\\text{ideal}}}\n$$\n根据定义，$\\hat{e}_N = T$ 且 $e_N^{\\text{ideal}} = T$，这确保了 $\\text{INL}_N = 0$。INL 分布图揭示了 TDC 时间映射中的长程畸变。\n\n**3. 时间戳重构 ($\\hat{t}_b$)**\n\n一旦校准图（即所有 $\\hat{w}_j$ 和 $\\hat{e}_j$ 的集合）建立起来，它就可以用来校正后续测量的事件。一个被记录在原始 TDC 时间箱 $b$ 中的事件，其真实发生时间 $t$ 已知在 $[\\hat{e}_b, \\hat{e}_{b+1})$ 区间内。在没有任何进一步的箱内子时间信息的情况下，最大熵原理（或等效地，假设事件在箱内的到达时间具有均匀先验概率分布）导致最大似然估计为校准后时间箱区间的中点：\n$$\n\\hat{t}_b = \\hat{e}_b + \\frac{1}{2}\\hat{w}_b\n$$\n这个校正后的时间戳 $\\hat{t}_b$ 提供了一个比简单使用理想、未校准时间箱中心所能获得的更准确的事件时间估计。\n\n为提高效率，计算序列将使用向量运算来实现，特别是用于计算校准边缘所需的累积和。此方法将应用于所提供的每个测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the TDC calibration problem for the given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (8, 25.0, [110, 95, 90, 120, 130, 80, 85, 90], [0, 3, 7]),\n        (16, 10.0, [100, 90, 85, 95, 110, 120, 0, 80, 75, 70, 105, 115, 95, 85, 100, 100], [6, 0, 15]),\n        (4, 5.0, [250, 250, 250, 250], [2, 1]),\n    ]\n\n    all_results = []\n    \n    def format_list(data_list):\n        \"\"\"Formats a list of floats into the required string format.\"\"\"\n        return f\"[{','.join([f'{x:.6f}' for x in data_list])}]\"\n\n    for case in test_cases:\n        N, T, counts_list, events_list = case\n        \n        # Use NumPy arrays for efficient vector calculations\n        counts = np.array(counts_list, dtype=np.float64)\n        event_bins = np.array(events_list, dtype=int)\n        \n        # --- 1. Compute estimated bin widths ---\n        # Total number of counts from the calibration run\n        C = np.sum(counts)\n        \n        # Maximum-likelihood estimator for the true bin widths\n        # Handle the case where C=0 to avoid division by zero, though not in test data.\n        if C  0:\n            w_hat = (counts / C) * T\n        else:\n            w_hat = np.zeros_like(counts)\n\n        # --- 2. Compute DNL and INL ---\n        # Ideal bin width\n        w_ideal = T / N\n        \n        # Differential Nonlinearity (DNL)\n        # Handle w_ideal=0 case to avoid division by zero.\n        if w_ideal  0:\n            dnl = (w_hat / w_ideal) - 1.0\n        else:\n            dnl = np.zeros_like(w_hat)\n        \n        # Calibrated bin edges (e_hat)\n        # e_hat_all will have N+1 elements, from e_0=0 to e_N=T\n        e_hat_all = np.insert(np.cumsum(w_hat), 0, 0)\n\n        # Ideal bin edges (e_ideal) for j = 1, ..., N\n        e_ideal = np.arange(1, N + 1) * w_ideal\n        \n        # Integral Nonlinearity (INL) at the upper edge of each bin\n        # We need e_hat_1 to e_hat_N, which are at indices 1 to N in e_hat_all\n        e_hat_for_inl = e_hat_all[1:]\n        \n        if w_ideal  0:\n            inl = (e_hat_for_inl - e_ideal) / w_ideal\n        else:\n            inl = np.zeros(N)\n\n        # --- 3. Reconstruct event timestamps ---\n        # Look up calibrated edges and widths for each event bin\n        e_hat_events = e_hat_all[event_bins]\n        w_hat_events = w_hat[event_bins]\n        \n        # Maximum-likelihood timestamp is the midpoint of the calibrated bin\n        timestamps = e_hat_events + 0.5 * w_hat_events\n        \n        # Format results for the current case\n        dnl_str = format_list(dnl)\n        inl_str = format_list(inl)\n        timestamps_str = format_list(timestamps)\n        \n        case_result_str = f\"[{dnl_str},{inl_str},{timestamps_str}]\"\n        all_results.append(case_result_str)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}